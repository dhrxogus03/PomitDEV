define("DS/ViewPanel/ViewPanelController",["DS/VisuTools/SettingManager","DS/Visualization/ThreeJS_R57","DS/QualityManager/QMController"],function(e,i,t){"use strict";return class{constructor(a,s){this._baseSettings={materialMode:!1,visuShadingFaceMode:"Shaded",visuShadingEdgeMode:"WithEdges",visuShadingMode:"ShadingEdges",visuEnv:"Basic",visuAppearanceMode:"BASIC",axisState:!1,linesState:!0,planesState:!1,pointsState:!1,smallCurvatureState:!0,verticesState:!0,visuOutlineMode:!1,projectionMode:0},a._useQM&&!i.AutomatedTests()&&(this._baseSettings.visuEnv="WhiteExperience",t.unknownOrVeryLowGPU||(this._baseSettings.visuAppearanceMode="GASLOOK")),(s=s||{}).defaultSettings=s.defaultSettings||{},s.uiConfig=s.uiConfig||{},this.viewer=a,this.defaultSettings={},Object.assign(this.defaultSettings,this._baseSettings),Object.assign(this.defaultSettings,s.defaultSettings),this._settingsManagerParams={useLocalStorage:void 0!==s.useLocalStorage&&s.useLocalStorage,useWidget:void 0===s.useWidget||s.useWidget,name:"VisuViewSettings",familiyName:a._familiyName,importFromOldLocalStorage:void 0!==s.importFromOldLocalStorage&&s.importFromOldLocalStorage};var n=s.uiConfig;this._viewModePanelUIParams={useShadingIllustration:void 0!==n.useShadingIllustration&&n.useShadingIllustration,useOutline:void 0===n.useOutline||n.useOutline},this._keyWriter=e.Write(this._settingsManagerParams),this._eventListeners=[]}_getWidgetSettings(){var i={},t=this.defaultSettings;if(Object.assign(i,t),Object.assign(i,e.Struct(this._settingsManagerParams)),this._settingsManagerParams.importFromOldLocalStorage&&e.isEmptySettings(this._settingsManagerParams)){var a=localStorage.getItem("visuEnv");a&&a.includes("OCA")&&(a=a.replace("OCA",""),i.visuEnv=a);var s=localStorage.getItem("projectionMode");s&&(i.projectionMode=parseInt(s,10));var n=localStorage.getItem("visuShadingMode");n&&(i.visuShadingMode=n);var o=localStorage.getItem("axisState");o&&(i.axisState="true"===o,i.planesState=i.axisState);var d=localStorage.getItem("linesState");d&&(i.linesState="true"===d,i.verticesState=i.linesState);var u=localStorage.getItem("pointsState");u&&(i.pointsState="true"===u)}t=this.defaultSettings;var r=this._viewModePanelUIParams;return r.useShadingIllustration||(i.visuShadingFaceMode&&i.visuShadingFaceMode.includes("Illustration")&&(i.visuShadingFaceMode=t.visuShadingFaceMode&&t.visuShadingFaceMode.includes("Illustration")?this._baseSettings.visuShadingFaceMode:t.visuShadingFaceMode),i.visuShadingMode&&i.visuShadingMode.includes("ShadingIllustration")&&(i.visuShadingMode=t.visuShadingMode&&t.visuShadingMode.includes("ShadingIllustration")?this._baseSettings.visuShadingMode:t.visuShadingMode)),r.useOutline||(i.visuOutlineMode=!1),i}init(){var e,i=this.viewer,t=this._keyWriter,a=this._getWidgetSettings(),s=this.defaultSettings,n=this._eventListeners,o=this;e=i.onPreRender(function(){i.unsubscribe(e),n.push(i.onMaterialModeChange(function(){t.materialMode=i.getMaterialMode()!==!!s.materialMode?i.getMaterialMode():void 0})),n.push(i.onVisuShadingFaceModeChange(function(){t.visuShadingFaceMode=i.getVisuShadingFaceMode()!==s.visuShadingFaceMode?i.getVisuShadingFaceMode():void 0})),n.push(i.onVisuShadingEdgeModeChange(function(){t.visuShadingEdgeMode=i.getVisuShadingEdgeMode()!==s.visuShadingEdgeMode?i.getVisuShadingEdgeMode():void 0})),n.push(i.onVisuShadingModeChange(function(){t.visuShadingMode=i.getVisuShadingMode()!==s.visuShadingMode?i.getVisuShadingMode():void 0})),n.push(i.onVisuEnvChange(function(){var e=i.getVisuEnv();e.includes("OCA")&&(e=e.replace("OCA",""),t.visuEnv=e!==s.visuEnv?e:void 0)})),n.push(i.onVisuAppearanceModeChange(function(){t.visuAppearanceMode=i.getVisuAppearanceMode()!==s.visuAppearanceMode?i.getVisuAppearanceMode():void 0})),n.push(i.onAxisFilterChange(function(){t.axisState=i.getAxisFilter()!==!!s.axisState?i.getAxisFilter():void 0})),n.push(i.onPlanesFilterChange(function(){t.planesState=i.getPlanesFilter()!==!!s.planesState?i.getPlanesFilter():void 0})),n.push(i.onLinesFilterChange(function(){i.currentViewpoint._2DMode||(t.linesState=i.getLinesFilter()!==!!s.linesState?i.getLinesFilter():void 0)})),n.push(i.onVerticesFilterChange(function(){i.currentViewpoint._2DMode||(t.verticesState=i.getVerticesFilter()!==!!s.verticesState?i.getVerticesFilter():void 0)})),n.push(i.onSmallCurvatureEdgesFilterChange(function(){t.smallCurvatureState=i.getSmallCurvatureEdgesFilter()!==!!s.smallCurvatureState?i.getSmallCurvatureEdgesFilter():void 0})),n.push(i.onPointsFilterChange(function(){i.currentViewpoint._2DMode||(t.pointsState=i.getPointsFilter()!==!!s.pointsState?i.getPointsFilter():void 0)})),n.push(i._onVisuOutlineModeChange(function(){o._viewModePanelUIParams.useOutline&&(t.visuOutlineMode=i._getVisuOutlineMode()!==!!s.visuOutlineMode?i._getVisuOutlineMode():void 0)})),n.push(i.onProjectionTypeChange(function(){i.currentViewpoint._2DMode||(t.projectionMode=i.currentViewpoint.getProjectionType()!==s.projectionMode?i.currentViewpoint.getProjectionType():void 0)})),o._apply(a)})}_apply(e){e=e||this._getWidgetSettings();var t=this.viewer;if(void 0!==e.visuEnv){var a=e.visuEnv;a.includes("OCA")&&(a=a.replace("OCA",""));var s=t.getVisuEnv();s.includes("OCA")&&(s=s.replace("OCA","")),s!==a&&t.setVisuEnvOCA(a)}void 0!==e.materialMode&&t.setMaterialMode(e.materialMode),void 0!==e.visuShadingFaceMode&&t.setVisuShadingFaceMode(e.visuShadingFaceMode),void 0!==e.visuShadingEdgeMode&&t.setVisuShadingEdgeMode(e.visuShadingEdgeMode),void 0!==e.visuShadingMode&&t.setVisuShadingMode(e.visuShadingMode),void 0!==e.visuAppearanceMode&&t.setVisuAppearanceMode(i.DefaultAppearanceMode[e.visuAppearanceMode]),void 0!==e.pointsState&&t.setPointsFilter(e.pointsState),void 0!==e.axisState&&t.setAxisOnlyFilter(e.axisState),void 0!==e.planesState&&t.setPlanesFilter(e.planesState),void 0!==e.linesState&&t.setLinesFilter(e.linesState),void 0!==e.verticesState&&t.setVerticesFilter(e.verticesState),void 0!==e.smallCurvatureState&&t.getSmallCurvatureEdgesFilter(e.smallCurvatureState),void 0!==e.visuOutlineMode&&t._setVisuOutlineMode(e.visuOutlineMode),void 0!==e.projectionMode&&t.currentViewpoint.setProjectionType(e.projectionMode)}apply(e){var i=this.viewer,t={};Object.assign(t,e||{});var a,s=this;a=i.onPreRender(function(){i.unsubscribe(a),s._apply(t)}),i.render()}static dumpSettings(e){return{materialMode:e.getMaterialMode(),visuShadingFaceMode:e.getVisuShadingFaceMode(),visuShadingEdgeMode:e.getVisuShadingEdgeMode(),visuShadingMode:e.getVisuShadingMode(),visuEnv:e.getVisuEnv(),visuAppearanceMode:e.getVisuAppearanceMode(),pointsState:e.getPointsFilter(),axisState:e.getAxisFilter(),planesState:e.getPlanesFilter(),linesState:e.getLinesFilter(),verticesState:e.getVerticesFilter(),smallCurvatureState:e.getSmallCurvatureEdgesFilter(),visuOutlineMode:e._getVisuOutlineMode(),projectionMode:e.currentViewpoint.getProjectionType()}}_updateViewPanelUIConfiguration(e){void 0!==e.useShadingIllustration&&(this._viewModePanelUIParams.useShadingIllustration=e.useShadingIllustration),void 0!==e.useOutline&&(this._viewModePanelUIParams.useOutline=e.useOutline);var i=this.viewer;this._viewModePanelUIParams.useOutline||i._setVisuOutlineMode(!1);var t=this.defaultSettings;!this._viewModePanelUIParams.useShadingIllustration&&i.getVisuShadingMode()&&i.getVisuShadingMode().includes("ShadingIllustration")&&(t.visuShadingMode&&t.visuShadingMode.includes("ShadingIllustration")?i.setVisuShadingMode(this._baseSettings.visuShadingMode):(i.setMaterialMode(t.materialMode),i.setVisuShadingFaceMode(t.visuShadingFaceMode&&t.visuShadingFaceMode.includes("Illustration")?this._baseSettings.visuShadingFaceMode:t.visuShadingFaceMode),i.setVisuShadingEdgeMode(t.visuShadingEdgeMode),i.setVisuShadingMode(t.visuShadingMode)))}restore(){var i={},t=this.defaultSettings;Object.assign(i,t),Object.assign(i,e.Struct(this._settingsManagerParams)),this.apply(i)}dispose(){for(var e=0;e<this._eventListeners.length;e++)this.viewer.unsubscribe(this._eventListeners[e]);this._eventListeners=[]}}});var toto=function(){};toto();