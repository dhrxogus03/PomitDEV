define("DS/DMUBaseExperience/EXPToolsContext",[],function(){"use strict";var e=[];return{getParentType:function(t){return e[t]},setParentType:function(t,n){e[t]||(e[t]=n)}}}),define("DS/DMUBaseExperience/EXPUnitManagement",["DS/CATWebUXPreferences/CATWebUXPreferencesUtils"],function(e){"use strict";var t={convert:function(n,i,r,o,a){var s=r&&r.getDMUPreferenceRepository?r.getDMUPreferenceRepository().getPreference(n):null,l=n;switch(l.toLowerCase()){case"length":l="Length";break;case"area":l="Area";break;case"angle":l="Angle";break;case"volume":l="Volume"}return i*=t[l].ratio,e.convertValueToString(i,n,{unit:s,displaySpace:!0!==o&&void 0,displayUnit:!0!==a&&void 0})},getCurrentUnit:function(t){return e.getCurrentUnit(t)},Length:{ratio:Math.pow(10,-3)},Angle:{ratio:Math.PI/180},Volume:{ratio:Math.pow(10,-9)},Area:{ratio:Math.pow(10,-6)}};return Object.freeze(t)}),define("DS/DMUBaseExperience/DMUFactory",["UWA/Class"],function(e){"use strict";var t=e.singleton({init:function(){var e,t=[{name:"Compare3D",library:"DS/DMUPlayCompare/DMUCompare3D"},{name:"Compare2D",library:"DS/DMUPlayCompare/DMUCompare2D"},{name:"CompareRequirement",library:"DS/DMUPlayCompare/DMUCompareRequirement"},{name:"Slide",library:"DS/DMUPlaySlide/DMUSlide"},{name:"Format",library:"DS/DMUPlaySlide/DMUFormat"},{name:"Comment",library:"DS/DMUPlayComment/DMUComment"},{name:"Reply",library:"DS/DMUPlayComment/DMUComment"},{name:"CommentHighlight",library:"DS/DMUPlayMarker/DMUCommentHighlight"},{name:"CommentPositioned",library:"DS/DMUPlayMarker/DMUCommentPositioned"},{name:"Marker3DCircle",library:"DS/DMUPlayMarker/DMUMarker3DCircle"},{name:"Marker2DCircle",library:"DS/DMUPlayMarker/DMUMarker2DCircle"},{name:"Marker2DEllipse",library:"DS/DMUPlayMarker/DMUMarker2DEllipse"},{name:"Marker3DEllipse",library:"DS/DMUPlayMarker/DMUMarker3DEllipse"},{name:"Marker3DCloud",library:"DS/DMUPlayMarker/DMUMarker3DCloud"},{name:"Marker2DArrow",library:"DS/DMUPlayMarker/DMUMarker2DArrow"},{name:"Marker3DArrow",library:"DS/DMUPlayMarker/DMUMarker3DArrow"},{name:"Marker3DRectangle",library:"DS/DMUPlayMarker/DMUMarker3DRectangle"},{name:"Marker2DRectangle",library:"DS/DMUPlayMarker/DMUMarker2DRectangle"},{name:"Marker2DPicture",library:"DS/DMUPlayMarker/DMUMarker2DPicture"},{name:"Marker3DPicture",library:"DS/DMUPlayMarker/DMUMarker3DPicture"},{name:"Marker2DText",library:"DS/DMUPlayMarker/DMUMarker2DText"},{name:"Marker3DText",library:"DS/DMUPlayMarker/DMUMarker3DText"},{name:"Marker3DPoint",library:"DS/DMUPlayMarker/DMUMarker3DPoint"},{name:"Marker2DPoint",library:"DS/DMUPlayMarker/DMUMarker2DPoint"},{name:"Marker2DPolyline",library:"DS/DMUPlayMarker/DMUMarker2DPolyline"},{name:"Marker3DPolyline",library:"DS/DMUPlayMarker/DMUMarker3DPolyline"},{name:"Marker2DSpline",library:"DS/DMUPlayMarker/DMUMarker2DSpline"},{name:"Marker3DSpline",library:"DS/DMUPlayMarker/DMUMarker3DSpline"},{name:"Marker3DFreehand",library:"DS/DMUPlayMarker/DMUMarker3DFreehand"},{name:"Marker2DLine",library:"DS/DMUPlayMarker/DMUMarker2DLine"},{name:"Marker3DLine",library:"DS/DMUPlayMarker/DMUMarker3DLine"},{name:"Marker2DHyperlink",library:"DS/DMUPlayMarker/DMUMarker2DHyperlink"},{name:"Marker3DHyperlink",library:"DS/DMUPlayMarker/DMUMarker3DHyperlink"},{name:"Marker3DStamp",library:"DS/DMUPlayMarker/DMUMarker3DStamp"},{name:"MeasureItem",library:"DS/DMUPlayMeasure/DMUMeasure"},{name:"MeasureBetween",library:"DS/DMUPlayMeasure/DMUMeasure"},{name:"MeasureThickness",library:"DS/DMUPlayMeasure/DMUMeasure"},{name:"Measure3PointsCircle",library:"DS/DMUPlayMeasure/DMUMeasure"},{name:"Measure3PointsAngle",library:"DS/DMUPlayMeasure/DMUMeasure"},{name:"Section",library:"DS/DMUPlaySection/DMUSection"},{name:"Clipping",library:"DS/DMUPlaySection/DMUClipping"},{name:"ExternalLinks",library:"DS/DMUBaseExperience/DMULinksManager"},{name:"OccurrenceOverloader",library:"DS/DMUBaseExperience/DMUOccurrenceOverloader"},{name:"Environment",library:"DS/DMUBaseExperience/DMUEnvironment"},{name:"Review",library:"DS/DMUDeprecatedReview/DMUDeprecatedReview"},{name:"Markup",library:"DS/DMUPlayMarkup/DMUMarkup"},{name:"3DGrid",library:"DS/CATRelatedData3DGrid/CATRelatedData3DGridDMUObject"}],n=[];this.initFactory=function(i,r){e=i,n.length!==t.length?function(e,t){var i=[];e.forEach(function(e){n.includes(e.name)||i.push(e.library)}),require(i,function(){e.forEach(function(e){e.module=require(e.library),n.push(e.name)}),t()})}(t,r):r()},this.initFactoryOf=function(i,r){e=i;for(var o=0;o<r.length;o++)if(!n.includes(r[o]))for(var a=0;a<t.length;a++)if(t[a].name===r[o]&&(t[a].module=require(t[a].library),t[a].module)){n.push(t[a].name);break}},this.buildComponent=function(n,i,r,o){var a;this.initFactoryOf(e,[n]);for(var s=0;s<t.length;s++)if(n===t[s].name)return!t[s].module||"Section"!==t[s].name&&"Clipping"!==t[s].name?t[s].module?(a=new t[s].module(e,r),i&&i.addDMUObject?i.addDMUObject(a):"Comment"===t[s].name&&i&&i.addDMUComment?i.addDMUComment(a):"Reply"===t[s].name&&i&&i.deprecatedAddDMUReply&&i.deprecatedAddDMUReply(a),a):null:(a=new t[s].module({viewer:e,expParent:r,typeApps:o}),i&&i.addDMUObject&&i.addDMUObject(a),a);return null}},initFactory:function(){},initFactoryOf:function(){},buildComponent:function(){}});return{initFactory:function(e,n){return t.initFactory(e,n)},initFactoryOf:function(e,n){return t.initFactoryOf(e,n)},buildComponent:function(e,n,i,r){return t.buildComponent(e,n,i,r)}}}),define("DS/DMUBaseExperience/EXPManagerSet",["UWA/Class"],function(e){"use strict";return e.singleton({init:function(){var e=[];this.getManager=function(t){for(var n=0;n<e.length;n++)if(e[n].context===t.context&&e[n].name===t.name)return e[n].mng},this.addManager=function(t){if(t&&t.name&&t.context&&t.manager){for(var n=0;n<e.length;n++)if(e[n].context===t.context&&e[n].name===t.name)return;e.push({context:t.context,name:t.name,mng:t.manager})}},this.removeManager=function(t){for(var n=0;n<e.length;n++)e[n].context===t.context&&e[n].name===t.name&&(e[n].mng.clean&&e[n].mng.clean(),e.splice(n,1))}},getManager:function(){},addManager:function(){},removeManager:function(){}})}),define("DS/DMUBaseExperience/DMUOccurrenceOverloaderImport",["UWA/Class"],function(e){"use strict";return e.extend({init:function(e){this.importData=function(t,n,i){t&&n&&e&&(n.fillObjectAttributes(e,t,i),n.registerForPostImport(e))},this.afterImport=function(){e&&e.fireEvent("onDMUObjectInitialized",{dmuObject:e})}}})}),define("DS/DMUBaseExperience/DMULinksManagerImport",["UWA/Class"],function(e){"use strict";return e.extend({init:function(e){this.importData=function(t,n,i){t&&n&&e&&(n.fillObjectAttributes(e,t,i),e.importLinksManagerData(t),n.registerForPostImport(e))},this.afterImport=function(){e&&e.fireEvent("onDMUObjectInitialized",{dmuObject:e})}}})}),define("DS/DMUBaseExperience/EXPToolsVisualization",["require","exports","DS/Visualization/ThreeJS_DS","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUMeasurable/DMUToolsMaths"],function(e,t,n,i,r){"use strict";let o,a=!0,s=!0,l="0.001",c="1.5708";class u{static setManipulationPrefs(e){void 0!==e.snapHandlesToGrid&&(a=e.snapHandlesToGrid),void 0!==e.snapHandlesGridValue&&(l=e.snapHandlesGridValue),void 0!==e.snapRotationToggle&&(s=e.snapRotationToggle),void 0!==e.snapRotationAngle&&(c=e.snapRotationAngle)}static getSnapRotationInfos(){return{snapRotationToggle:s,snapRotationAngle:Math.round(180*parseFloat(c)/Math.PI).toString()}}static getSnapHandlesToGridInfos(){return{snapHandlesToGrid:a,snapHandlesGridValue:Math.round(1e3*parseFloat(l)).toString()}}static getViewpointInfo(e){if(e){let t=(new n.Matrix4).lookAt(new n.Vector3,e.getSightDirection(),e.getUpDirection()),i=(new n.Quaternion).setFromRotationMatrix(t),o=r.quaternionToAxisSystem(i);return{position:e.getEyePosition(),target:e.getTarget(),sight:e.getSightDirection(),right:o.X,up:e.getUpDirection(),distance:e.getTargetDistance(),angle:e.getAngle(),projectionType:e.getProjectionType(),mode360:e.viewer.get360Mode()}}}static moveViewpoint(e){if(!e||e&&!e.viewpoint)return;let t=u.getViewpointInfo(e.viewpoint),i=e.target?e.target.clone():new n.Vector3;if(i.sub((new n.Vector3).copy(e.sightDirection).multiplyScalar(e.targetDistance)),t&&(!t.position.equals(e.eyePosition?e.eyePosition:i)||!t.sight.equals(e.sightDirection)||!t.up.equals(e.upDirection)||t.distance!==e.targetDistance))if(t.mode360){let t={sightDirection:e.sightDirection,upDirection:e.upDirection,eyePosition:e.eyePosition,fov:e.fieldOfView||e.viewpoint.getAngle()};e.viewpoint.contextAwareMoveTo&&e.viewpoint.contextAwareMoveTo(t,{allow360:!0})}else e.duration?e.viewpoint.moveTo({eyePosition:e.eyePosition?e.eyePosition:i,upDirection:e.upDirection,sightDirection:e.sightDirection,distanceToTarget:e.targetDistance,duration:e.duration}):(e.viewpoint.setEyePosition(e.eyePosition?e.eyePosition:i),e.viewpoint.setSightDirection(e.sightDirection),e.viewpoint.setUpDirection(e.upDirection),e.viewpoint.setTargetDistance(e.targetDistance))}static getPickingInfo(e,t){let n,i,r=e.pick(e.getMousePosition(t),"mesh",!0);return void 0!==r&&(void 0!==r.position&&null!==r.position&&(n=r.position.clone()),void 0!==r.normal&&null!==r.normal&&(i=r.normal.clone())),{point:n,normal:i,paths:null==r?void 0:r.path}}static getNearPositionFrom2DCoordinates(e,t,n,i){if(!e||i&&!n)return;let r,o;if((r=u.getPickingInfo(t,e)).point&&r.paths&&r.paths.length&&!i)return r.point;if(n)return u.getPositionFromIntersection(t,r.point,n);let a=u.getMMPerPixelRatio(t,r.point);return a>1&&(a=1),o=t.currentViewpoint.getSightDirection().multiplyScalar(t.SCREEN_HEIGHT/2*window.devicePixelRatio*a).add(t.currentViewpoint.getEyePosition()),u.getPositionFromIntersection(t,r.point,o)}static getSelectedPathElement(e,t){let n=null,i=e.pick(e.getMousePosition(t),"mesh",!1);return i&&i.path&&i.path[0]&&(n=i.path[0]),n}static getWindowPositionFromPoint(e,t,i){let r=(new n.Projector).projectVector(t.clone(),e.viewpoints[0].getCamera()),o=Math.round((0-r.y)*(i.getContent().offsetHeight/2))+i.getContent().offsetHeight/2,a=Math.round(r.x*(i.getContent().offsetWidth/2))+i.getContent().offsetWidth/2,s=o>0&&o<i.getContent().offsetWidth&&a>0&&a<i.getContent().offsetWidth;return{top:o,left:a,bottom:i.getContent().offsetHeight-o,right:i.getContent().offsetWidth-a,inWindow:s}}static getViewerPositionFromPoint(e,t){if(!e||!e.currentViewpoint||!t)return;let i=(new n.Projector).projectVector(t.clone(),e.currentViewpoint.getCamera()),r=Math.round((0-i.y)*(e.canvas.offsetHeight/2)+e.canvas.offsetHeight/2),o=Math.round(i.x*(e.canvas.offsetWidth/2)+e.canvas.offsetWidth/2);return{top:r,left:o,bottom:e.canvas.offsetHeight-r,right:e.canvas.offsetWidth-o,inWindow:r>0&&r<e.canvas.offsetHeight&&o>0&&o<e.canvas.offsetWidth}}static get3DPositionFromScreenCoordinates(e){if(e.coords&&e.viewer){let t=u.getLineFromWindowPosition(e.viewer,e.coords.x,e.coords.y);if(t&&t.position&&t.direction&&t.position.x&&t.position.y&&t.position.z){let r=e.viewer.currentViewpoint.getSightDirection(),o=i.computeLinePlaneDistance(t.position.toArray(),t.direction.toArray(),[0,0,0],r.toArray()).aPosition;return new n.Vector3(o[0],o[1],o[2])}}return new n.Vector3(1,0,0)}static getLineFromWindowPosition(e,t,i){let r=new n.Vector3((t-window.pageXOffset)/e.canvas.offsetWidth*2-1,-(i-window.pageYOffset)/e.canvas.offsetHeight*2+1,.5),o=(new n.Projector).pickingRay(r,e.currentViewpoint.camera);return{position:o.ray.origin,direction:o.ray.direction}}static getDistanceFromPixel(e,t,n){let r=u.getViewerPositionFromPoint(e,t)||{left:0,top:0},o=u.getLineFromWindowPosition(e,r.left+n,r.top);return i.computePointLineDistance(t.toArray(),o.position.toArray(),o.direction.toArray()).distance}static getPositionFromIntersection(e,t,r,o){let s,c;if(t instanceof n.Vector3){if(s=this.getViewerPositionFromPoint(e,t)){if(o&&a){let e=1e3*parseFloat(l||""),t=this.convertModelToPixels({sizeInMM:isNaN(e)?1:e});s.left=Math.round(Math.round(s.left/t)*t),s.top=Math.round(Math.round(s.top/t)*t)}c=this.getLineFromWindowPosition(e,s.left||0,s.top||0)}}else t instanceof n.Vector2&&(c=this.getLineFromWindowPosition(e,t.x,t.y));let u=this.getViewpointInfo(e.currentViewpoint),g=i.computeLinePlaneDistance(null==c?void 0:c.position.toArray(),null==c?void 0:c.direction.toArray(),r.toArray(),null==u?void 0:u.sight.toArray());return new n.Vector3(g.aPosition[0],g.aPosition[1],g.aPosition[2])}static get2DSnappedPosition(e,t){let i=e.clone();if(a){let e=1e3*parseFloat(l||""),r=this.convertModelToPixels({sizeInMM:isNaN(e)?1:e});if("number"==typeof t){let e=new n.Vector2(i.x*Math.cos(t)-i.y*Math.sin(t),i.x*Math.sin(t)+i.y*Math.cos(t)),o=Math.round(Math.round(e.x/r)*r),a=Math.round(Math.round(e.y/r)*r);i=new n.Vector2(o*Math.cos(-t)-a*Math.sin(-t),o*Math.sin(-t)+a*Math.cos(-t))}else i.x=Math.round(Math.round(i.x/r)*r),i.y=Math.round(Math.round(i.y/r)*r)}return i}static getMMPerPixelRatio(e,t){let i,r=e.currentViewpoint;if(1===r.getProjectionType())i=r.camera.top-r.camera.bottom;else{let e=r.getAngle()*Math.PI/180,o=r.getEyePosition(),a=(new n.Vector3).copy(t),s=(new n.Vector3).subVectors(a,o);i=2*Math.tan(.5*e)*s.dot(r.getSightDirection())}return Math.abs(i/e.SCREEN_HEIGHT)}static getMMPerPtRatio(){return 2.83465}static convertModelToPixels(e){return e.coords?e.sizeInMM/u.getMMPerPixelRatio(e.viewer,e.coords):e.sizeInMM*(96/25.4)}static convertPixelToModel(e){return e.coords?e.sizeInPixels*u.getMMPerPixelRatio(e.viewer,e.coords):e.sizeInPixels/(96/25.4)}static async computeImage(e){if(!e||e&&(!e.viewer||!e.width||!e.height))return;o||(o=document.createElement("canvas"));let t=e.viewer.SCREEN_HEIGHT,n=Math.round(t*(e.width/e.height)),i=2*e.height,r=2*e.width,a=new ImageData(n,t);e.viewer.renderToTarget(a,e.viewpoint?e.viewpoint:e.viewer.currentViewpoint),o.height=i,o.width=r;let s=o.getContext("2d");if(s){let e=await createImageBitmap(a,0,0,a.width,a.height);s.clearRect(0,0,o.width,o.height),s.scale(1,-1),s.drawImage(e,0,0,o.width,-o.height),e.close()}let l=new Image;return l.src=o.toDataURL("image/jpeg"),l}}return u}),define("DS/DMUBaseExperience/DMULinksManagerExport",["require","exports"],function(e,t){"use strict";return class{static getObjectDefinition(e){let t={};return e.exportLinksManagerData(t),t}}}),define("DS/DMUBaseExperience/DMUPreferences",["UWA/Class"],function(e){"use strict";return e.extend({init:function(){this._parent();var e={};this.setPreference=function(t,n){e[t]=n},this.getPreference=function(t){return e[t]?e[t]:window.widget&&window.widget.hasPreference(t)?window.widget.getValue(t):null}}})}),define("DS/DMUBaseExperience/EXPToolsMaterial",["DS/Visualization/ThreeJS_DS","DS/Mesh/Mesh","DS/Visualization/MaterialManager"],function(e,t,n){"use strict";var i,r={createBasicMaterial:function(t){return new e.MeshBasicMaterial({color:!t.color||isNaN(t.color.r)||isNaN(t.color.g)||isNaN(t.color.b)?t.color?new e.Color(t.color):new e.Color:t.color,side:e.DoubleSide,transparent:!0,opacity:t.opacity||0===t.opacity?t.opacity:1,force:!0})},getDashType:function(e){var n=e;return isNaN(n)&&n.toUpperCase?(n=n.toUpperCase(),n={SOLID:t.LinePatternEnum.SOLID,DOTTED:t.LinePatternEnum.DOTTED,DASHED:t.LinePatternEnum.DASHED,DOT_DASHED:t.LinePatternEnum.DOTDASHED,PHANTOM:t.LinePatternEnum.PHANTOM,SMALL_DOT:t.LinePatternEnum.SMALLDOTTED,JIS_AXIS:t.LinePatternEnum.JISAXIS}[n]):n=parseFloat(n),n},createLineMaterial:function(t){return new e.LineBasicMaterial({color:!t.color||isNaN(t.color.r)||isNaN(t.color.g)||isNaN(t.color.b)?t.color?new e.Color(t.color):new e.Color:t.color,lineWidth:isNaN(t.lineWidth)?1:t.lineWidth,opacity:"number"==typeof t.opacity?t.opacity:1,transparent:!0,force:!0,dashType:r.getDashType(t.pattern),isCPUPattern:!0,polygonBorderMode:!0})},retrieveMaterialFromGAS:function(e){if(i||(i=new n),e.lineWidth||e.pattern)return r.createLineMaterial(e);if(e.symbol)return i.createPointMaterial(e);var t=i.getMaterialFromGAS({color:e.color,opacity:"number"==typeof e.opacity?e.opacity:1,transparent:!0,pattern:e.pattern,isCPUPattern:!0,polygonBorderMode:!0,size:e.size});return t&&(t.force=!0),t}};return r}),define("DS/DMUBaseExperience/EXPControllerEvents",[],function(){"use strict";var e={REVISION:"1",Events:{EXPRootDetachedEvent:"EXPRootDetachedEvent",EXPRootAttachedEvent:"EXPRootAttachedEvent",EXPRootAddedEvent:"EXPRootAddedEvent",EXPRootRemovedEvent:"EXPRootRemovedEvent",EXPBeginRootLoadingEvent:"EXPBeginRootLoadingEvent",EXPRootAlreadyExistingEvent:"EXPRootAlreadyExistingEvent",EXPLoadingStartedEvent:"EXPLoadingStartedEvent",EXPAssetChangedEvent:"EXPAssetChangedEvent",EXPExperienceDisposed:"EXPExperienceDisposed",EXPLoadingCompleteEvent:"EXPLoadingCompleteEvent",EXPLoadingFailureEvent:"EXPLoadingFailureEvent",EXPMoveEvent:"EXPMoveEvent",EXPEndReparentEvent:"EXPEndReparentEvent",EXPBeginReparentEvent:"EXPBeginReparentEvent",EXPReparentFailureEvent:"EXPReparentFailureEvent",EXPInsertExistingFailureEvent:"EXPInsertExistingFailureEvent",EXPInsertExistingEvent:"EXPInsertExistingEvent",EXPEndDeleteEvent:"EXPEndDeleteEvent",EXPBeginDeleteEvent:"EXPBeginDeleteEvent",EXPDefaultStreamChangedEvent:"EXPDefaultStreamChangedEvent",EXPStartProgressiveLoad:"EXPStartProgressiveLoad",EXPEndProgressiveLoad:"EXPEndProgressiveLoad",EXPApplyFilterBeginEvent:"EXPApplyFilterBeginEvent",EXPFilterAppliedEvent:"EXPFilterAppliedEvent",EXPRemoveFilterBeginEvent:"EXPRemoveFilterBeginEvent",EXPFilterRemovedEvent:"EXPFilterRemovedEvent",EXPRefreshEvent:"EXPRefreshEvent",EXPRefreshBeginEvent:"EXPRefreshBeginEvent",EXPRefreshCompletedEvent:"EXPRefreshCompletedEvent",EXPHideEvent:"EXPHideEvent",EXPShowEvent:"EXPShowEvent",EXPExclusiveShowEvent:"EXPExclusiveShowEvent",EXPHideShowEvent:"EXPHideShowEvent",EXPRootModifiedEvent:"EXPRootModifiedEvent",EXPLineLayoutComputationBeginEvent:"EXPLineLayoutComputationBeginEvent",EXPLineLayoutComputationEndEvent:"EXPLineLayoutComputationEndEvent",EXPModelUpdatedEvent:"EXPModelUpdatedEvent"},mapPadEvent:{EXPRootDetachedEvent:["onRootDetached"],EXPRootAttachedEvent:["onRootAttached"],EXPRootAddedEvent:["onRootAdded"],EXPRootRemovedEvent:["onRootRemoved"],EXPBeginRootLoadingEvent:["onBeginRootLoading"],EXPRootAlreadyExistingEvent:["onRootAlreadyExisting"],EXPLoadingStartedEvent:["ASSET/LOADINGSTARTED"],EXPAssetChangedEvent:["ASSET/CHANGE"],EXPExperienceDisposed:["EXPERIENCE/DISPOSE"],EXPLoadingCompleteEvent:["onLoadingComplete","ASSET/LOADINGFINISHED"],EXPLoadingFailureEvent:["onLoadingFailure"],EXPMoveEvent:["onMove"],EXPEndReparentEvent:["onEndReparent"],EXPBeginReparentEvent:["onBeginReparent"],EXPReparentFailureEvent:["onReparentFailure"],EXPInsertExistingFailureEvent:["onInsertExistingFailure"],EXPInsertExistingEvent:["onInsertExisting"],EXPEndDeleteEvent:["onEndDelete"],EXPBeginDeleteEvent:["onBeginDelete"],EXPDefaultStreamChangedEvent:["onDefaultStreamChanged"],EXPStartProgressiveLoad:["onStartProgressiveLoad"],EXPEndProgressiveLoad:["onEndProgressiveLoad"],EXPApplyFilterBeginEvent:["onBeginFilterApplied"],EXPFilterAppliedEvent:["onFilterApplied"],EXPRemoveFilterBeginEvent:["onBeginFilterRemoved"],EXPFilterRemovedEvent:["onFilterRemoved"],EXPRefreshEvent:["onRefresh"],EXPRefreshBeginEvent:["onRefreshBegin"],EXPRefreshCompletedEvent:["onRefreshCompleted"],EXPHideShowEvent:["onHide","onShow","onExclusiveShow"],EXPRootModifiedEvent:["onRootDetached","onRootAttached","onRootAdded","onRootRemoved"],EXPLineLayoutComputationBeginEvent:["onLayoutComputationBegin"],EXPLineLayoutComputationEndEvent:["onLayoutComputationEnd"],EXPModelUpdatedEvent:["onModelUpdated"]}};return e}),define("DS/DMUBaseExperience/EXPController",["UWA/Class","DS/CoreEvents/ModelEvents","DS/DMUBaseExperience/EXPControllerEvents"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e);var i=this,r=new t,o={};function a(e,t,n){return n?n.subscribe({event:e},function(e){if(i&&e)if(e.nodes)for(var n=0;n<e.nodes.length;n++)i.fireEvent(t,e.nodes[n]);else e.paths&&e.paths.length&&e.paths[0].length&&"function"!=typeof e.paths[0].getLastElement&&(e.areIdPaths=!0),i.fireEvent(t,e);else i&&i.fireEvent(t)}):null}this.fireEvent=function(e,t){r&&e&&r.publish({event:e,data:t})},this.addEvent=function(t,s){var l=n.mapPadEvent[t],c=[],u=function(e,t){if(r&&e&&t)return r.subscribe(e,t)}({event:t},s);switch(t){case n.Events.EXPHideShowEvent:e.context&&e.context.getHideShowController()&&l.forEach(function(n){c.push({PADShowController:a(n,t,e.context.getHideShowController())})});break;case n.Events.EXPRefreshEvent:case n.Events.EXPRefreshBeginEvent:case n.Events.EXPRefreshCompletedEvent:case n.Events.EXPRootAddedEvent:case n.Events.EXPRootRemovedEvent:case n.Events.EXPApplyFilterBeginEvent:case n.Events.EXPFilterAppliedEvent:case n.Events.EXPRemoveFilterBeginEvent:case n.Events.EXPFilterRemovedEvent:case n.Events.EXPRootAttachedEvent:case n.Events.EXPRootDetachedEvent:case n.Events.EXPMoveEvent:case n.Events.EXPBeginRootLoadingEvent:case n.Events.EXPRootAlreadyExistingEvent:case n.Events.EXPLoadingStartedEvent:case n.Events.EXPExperienceDisposed:case n.Events.EXPAssetChangedEvent:case n.Events.EXPLoadingCompleteEvent:case n.Events.EXPLoadingFailureEvent:case n.Events.EXPEndReparentEvent:case n.Events.EXPBeginReparentEvent:case n.Events.EXPReparentFailureEvent:case n.Events.EXPInsertExistingFailureEvent:case n.Events.EXPInsertExistingEvent:case n.Events.EXPEndDeleteEvent:case n.Events.EXPBeginDeleteEvent:case n.Events.EXPDefaultStreamChangedEvent:case n.Events.EXPRootModifiedEvent:case n.Events.EXPStartProgressiveLoad:case n.Events.EXPEndProgressiveLoad:e.context&&e.context.getController()&&l.forEach(function(n){c.push({PADController:a(n,t,e.context.getController())})});break;case n.Events.EXPLineLayoutComputationBeginEvent:case n.Events.EXPLineLayoutComputationEndEvent:case n.Events.EXPModelUpdatedEvent:l.forEach(function(n){c.push({PAD3DViewer:function(t,n){return e.context?e.context.subscribe({event:t},function(e){i&&i.fireEvent(n,e)}):null}(n,t,e.context)})})}return c&&c.length&&(o[u]=c),u},this.removeEvent=function(t){var n,i=o[t],a=e.context.getController(),s=e.context.getHideShowController();if(i&&i.length){for(var l=0;l<i.length;l++)a&&i[l].PADController&&a.unsubscribe(i[l].PADController),s&&i[l].PADShowController&&s.unsubscribe(i[l].PADShowController),e.context&&i[l].PAD3DViewer&&e.context.unsubscribe(i[l].PAD3DViewer);delete o[t]}n=t,r&&n&&r.unsubscribe(n)},this.destroy=function(){for(var e=Object.keys(o),t=e.length-1;t>=0;t--)i.removeEvent(e[t]);i=r=o=null}}})}),define("DS/DMUBaseExperience/DMUContextManager",["UWA/Class","DS/DMUBaseExperience/EXPController"],function(e,t){"use strict";var n=e.singleton({init:function(){var e=this,n=[],i=[];let r;this.getReviewContext=function(e){return function(e,t){if(e.viewer||e.context)for(var n=0;n<t.length;n++)if(e.context&&t[n].context===e.context||e.viewer&&e.viewer===t[n].context.getViewer())return t[n].controller}(e,n)},this.setCurrentReviewContext=function(e){r=e},this.getCurrentReviewContext=function(){return r},this.setReviewContext=function(e){!function(e,t){if(e.viewer||e.context){for(var n=0;n<t.length;n++)if(e.context&&t[n].context===e.context||e.viewer&&t[n].context.getViewer()===e.viewer)return void(e.controller?t[n].controller=e.controller:t.splice(n,1));t.push({context:e.context,controller:e.controller})}}(e,n)},this.removeReviewContext=function(e){!function(e,t){for(var n=0;n<t.length;n++)if(e.context&&t[n].context===e.context||e.viewer&&e.viewer===t[n].context.getViewer()){t[n].controller&&(t[n].controller.remove(),t[n].controller=null),t.splice(n,1);break}}(e,n)},this.getContextViewer=function(e){var t;for(t=0;t<n.length;t++)if(e.reviewContext&&n[t].controller===e.reviewContext||e.viewer&&n[t].context.getViewer()===e.viewer)return n[t].context;var i=require("DS/PADUtils/PADContext").get();return i&&i.getViewer()===e.viewer?i:null},this.getEventsController=function(n){if(n){var r={context:n.context};if(n.context||(r.context=e.getContextViewer(n)),r.context){for(var o=0;o<i.length;o++)if(i[o].context===r.context)return i[o].counter++,i[o].controller;var a=new t(r);return i.push({context:r.context,controller:a,counter:1}),a}}},this.giveEventsController=function(e){if(e.context||e.viewer)for(var t=0;t<i.length;t++)if(i[t].context===e.context||i[t].context.getViewer()===e.viewer)return i[t].controller},this.unreferenceEventsController=function(e){for(var t=0;t<i.length;t++)i[t].context!==e.context&&i[t].context.getViewer()!==e.viewer||(i[t].counter--,i[t].counter<=0&&(i[t].controller.destroy(),i.splice(t,1)))};var o=[];this.setAuthoringFeatureTypes=function(e){-1===o.indexOf(e)&&o.push(e)},this.getAuthoringFeatureTypes=function(){return o}}});return n.init(),n}),define("DS/DMUBaseExperience/EXPUtils",["require","exports","DS/Visualization/ThreeJS_DS","DS/CATWebUXComponents/DMUCommandsManager","DS/WebSystem/Settings","DS/DMUBaseExperience/DMUContextManager"],function(e,t,n,i,r,o){"use strict";let a;class s{static getValue(e,t){let n,i=e.getParameters().length,r=e.getAttribute(t);for(let o=0;o<i&&void 0===n;o++){let i=e.getParameters()[o];i.name===t&&(n="bool"===i.type?r:"Color"===i.type?s.colorToHex(r):s.typeToStr(r,i.type))}return"sSectionRender"===t&&(n="CutOneSide"===r),"vTranslationValue"===t&&e.getTranslationValue&&void 0!==e.getTranslationValue()&&(n=e.getTranslationValue()),n}static setValue(e,t,n){let i,r;for(let o=0;o<t.getParameters().length;o++)if((r=t.getParameters()[o]).name===n){i="bool"===r.type?e:"Color"===r.type?s.hexToColor(e):s.strToType(e,r.type);break}r&&r.name===n&&("sSectionRender"===n&&(i=i?"CutOneSide":"NoCut"),"sTextContents"===n&&i&&!Array.isArray(i)&&(i=[e]),t.set({attribute:r.name,value:i}),"vTranslationValue"===n&&t.setTranslationValue&&t.setTranslationValue(i),t.refreshNode())}static cleanJSONString(e){let t=e;return t=(t=t.replace(/\\n/g,"\\n").replace(/\\'/g,"\\'").replace(/\\"/g,'\\"').replace(/\\&/g,"\\&").replace(/\\r/g,"\\r").replace(/\\t/g,"\\t").replace(/\\b/g,"\\b").replace(/\\f/g,"\\f")).replace(/[\u0000-\u0019]+/g,"")}static convertImageDataUrl(e){let t={type:"",data:""};if(e&&0===e.indexOf("data:image/")){let n=e.indexOf(";base64,");-1!==n&&(t.type=e.substr("data:image/".length,n-"data:image/".length),t.data=e.substr(n+";base64,".length,e.length-(n+";base64,".length)))}return t}static getImageDataUrl(e,t){if(e&&t)return"data:image/"+e+";base64,"+t}static colorToHex(e){if(e&&void 0!==e.r&&void 0!==e.g&&void 0!==e.b){if(e.r<0||e.g<0||e.b<0)return null;let t=Math.round(255*e.r).toString(16);t=t.length<2?"0"+t:t;let n=Math.round(255*e.g).toString(16);n=n.length<2?"0"+n:n;let i=Math.round(255*e.b).toString(16);return"#"+t+n+(i=i.length<2?"0"+i:i)}return""}static hexToRgb(e,t){let n;if(void 0!==e)if("#"!==e.substr(0,1)){let i=/(.*?)rgb\((\d+), *(\d+), *(\d+)\)/.exec(e);i&&(n="rgba("+i[2]+","+i[3]+","+i[4]+","+t+")")}else{let i=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(i,function(e,t,n,i){return t+t+n+n+i+i});let r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(r){let e={r:parseInt(r[1],16),g:parseInt(r[2],16),b:parseInt(r[3],16)};n="rgba("+e.r+","+e.g+","+e.b+","+t+")"}}return n}static strToType(e,t){if(null==e||""===e||null==t||""===t)return;let n=null;switch(t){case"bool":n=s.strToBool;break;case"int":n=s.strToInt;break;case"float":n=s.strToFloat;break;case"Color":n=s.strToColor;break;case"Vector3":n=s.strToVect;break;case"ListVector3":n=s.strToListVect;break;case"Vector2":n=s.strToVect2;break;case"ListVector2":n=s.strToListVect2;break;case"Matrix4":n=s.strToMat4;break;case"AABB":n=s.strToAABB;break;case"ImageURL":n=s.strToImageURL;break;case"string":return e;case"listStrings":n=s.strToListStrings;break;default:return e}return n(e)}static typeToStr(e,t){if(null==e||""===e||null==t||""===t)return;let n=null;switch(t){case"bool":n=s.boolToStr;break;case"int":n=s.intToStr;break;case"float":n=s.floatToStr;break;case"Color":n=s.colorToStr;break;case"Vector3":n=s.vectToStr;break;case"ListVector3":n=s.listVectToStr;break;case"Vector2":n=s.vect2ToStr;break;case"ListVector2":n=s.listVect2ToStr;break;case"Matrix4":n=s.mat4ToStr;break;case"AABB":n=s.aabbToStr;break;case"ImageURL":n=s.imageURLToStr;break;case"string":return e;case"listStrings":n=s.listStringsToStr;break;default:return e}return n(e)}static cloneType(e,t){let n;if(void 0!==e)if(null===e)n=e;else switch(t){case"Matrix4":n=e.clone();break;case"listStrings":case"listObjects":n=(n=n=[]).concat(e);break;default:n=e}return n}static strToColor(e){let t=e.replace(/[RGB( )]/gi,"").split(",");return(new n.Color).setRGB(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))}static colorToStr(e){return!e||"object"!=typeof e||isNaN(e.r)||isNaN(e.g)||isNaN(e.b)?null:"RGB("+e.r+","+e.g+","+e.b+")"}static hexToColor(e){if(!e)return null;let t=new n.Color;return t.r=parseInt(e[1]+e[2],16)/255,t.g=parseInt(e[3]+e[4],16)/255,t.b=parseInt(e[5]+e[6],16)/255,t}static strToVect(e){if(!e)return;let t="string"==typeof e?e.split(" "):null;return t?new n.Vector3(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2])):3===e.length?new n.Vector3(e[0],e[1],e[2]):void 0}static vectToStr(e){if(e)return isNaN(e.x)||isNaN(e.y)||isNaN(e.z)?null:[e.x,e.y,e.z]}static strToListVect(e){let t=[];for(let n=0;n<e.length;n++)t.push(s.strToVect(e[n]));return t}static listVectToStr(e){let t=[];for(let n=0;n<e.length;n++)t.push(s.vectToStr(e[n]));return t}static strToVect2(e){if(!e)return;let t="string"==typeof e?e.split(" "):null;return t?new n.Vector2(parseFloat(t[0]),parseFloat(t[1])):2===e.length?new n.Vector2(e[0],e[1]):void 0}static vect2ToStr(e){if(e)return isNaN(e.x)||isNaN(e.y)?null:[e.x,e.y]}static strToListVect2(e){let t=[];for(let n=0;n<e.length;n++)t.push(s.strToVect2(e[n]));return t}static listVect2ToStr(e){let t=[];for(let n=0;n<e.length;n++)t.push(s.vect2ToStr(e[n]));return t}static strToBool(e){return"string"==typeof e?"true"===e||"false"!==e&&null:e}static boolToStr(e){return e}static strToFloat(e){return parseFloat(e)}static floatToStr(e){return isNaN(e)?null:e}static strToInt(e){return parseInt(e,10)}static intToStr(e){return isNaN(e)?null:e}static strToMat4(e){let t;if("object"==typeof e&&e.X){let i=s.strToVect(e.X),r=s.strToVect(e.Y),o=s.strToVect(e.Z),a=s.strToVect(e.Origin);t=new n.Matrix4(i.x,r.x,o.x,a.x,i.y,r.y,o.y,a.y,i.z,r.z,o.z,a.z,0,0,0,1)}else if("string"==typeof e){t=new n.Matrix4;let i=e.split(" ");for(let e=0;e<16;e++)t.elements[e]=parseFloat(i[e])}return t}static mat4ToStr(e){let t=e.elements;return{Origin:[t[12],t[13],t[14]],X:[t[0],t[1],t[2]],Y:[t[4],t[5],t[6]],Z:[t[8],t[9],t[10]]}}static strToAABB(e){let t=[0,0,0,0,0,0];if(e.split){let n=e.split(",");for(let e=0;e<n.length&&e<6;e++)t[e]=parseFloat(n[e])}else t=e;return t}static aabbToStr(e){return e}static strToImageURL(e){return e&&0===e.indexOf('"')?JSON.parse(e):e}static imageURLToStr(e){return e&&0===e.indexOf('"')?JSON.parse(e):e}static strToListStrings(e){let t=e.split?e.split(" "):null;return t||e}static listStringsToStr(e){return e&&e.length?e:null}static isEqual(e,t){return JSON.stringify(e)===JSON.stringify(t)}static getUrlVariables(){let e={};return window.location.href.replace(/[?&]+([^=&]+)(=([^&]*))?/gi,function(t,n,i,r){e[n]=void 0===r?null:r}),e}static isEnvActivated(e,t){let n=!1;return(void 0!==s.getUrlVariables()[e]||t&&void 0!==r.get(e))&&(n=!0),n}static isPersistenceAllowed(e){if(!e||"function"!=typeof e.onPersistenceAllowed||"function"!=typeof e.onPersistenceNotAllowed)return;let t=window.require("DS/DMUReadPersistence/DMUReviewPersistenceServicesSetting");t&&t.getServerContext({onComplete:function(t){let n=function(e,t){return!(t.length>e.length)&&-1!==e.indexOf(t)};if(t){if(n(t,"VPLMSecuredCrossAccess")||n(t,"VPLMViewer"))return void e.onPersistenceNotAllowed();e.onPersistenceAllowed()}},onFailure:e.onPersistenceNotAllowed})}static checkIfCommandIsRunning(e){let t=!1;return s.getCurrentCommand(e)&&(t=!0),t}static allowManipulation(e){let t=o.getContextViewer({viewer:e.viewer}),n=i.getCommand(i._getCurrent(t.getCommandContext()),t.getCommandContext());return n&&n.allowManipulation?n.allowManipulation(e):void 0}static getCurrentCommand(e){let t,n=o.getContextViewer({viewer:e}),r=i._getCurrent(n.getCommandContext());return r&&(t=i._getDefaultCommand(n.getCommandContext())),r&&t&&(r=r!==t._id?r:null),r}static _sendUsageProbe(e,t,n){if(!a)return void window.require(["DS/PADServices/utils/PADTrackerManager"].concat([]),function(e,t,n,i){a=i,s._sendUsageProbe(e,t,n)}.bind(s,e,t,n));let i=a.getPADTracker({eventCategory:"usage",eventAction:e}),r={eventLabel:t};void 0!==n&&(r.eventValue=n),i.setEventData(r),i.trackPageEvent()}}return s}),define("DS/DMUBaseExperience/DMUModelServices",["require","exports","DS/DMUBaseExperience/EXPUtils"],function(e,t,n){"use strict";const i={DMUFormat:"DS/DMUFormatEdition/DMUFormatExport",DMUSlide:"DS/DMUFormatEdition/DMUFormatExport",DMUMeasure:"DS/DMUMeasure/DMUMeasureExport",DMUExternalLinks:"DS/DMUBaseExperience/DMULinksManagerExport"};class r{static async getObjectBaseDefinition(e){async function t(e,t){let i;if(void 0!==e)switch(t){case"object":e&&(i=await r.getObjectDefinition(e));break;case"listObjects":if(e&&e.length>0){i=[];for(let t=0;t<e.length;t++){let n={};n=await r.getObjectDefinition(e[t]),i.push(n)}}break;default:i=n.typeToStr(e,t)}return i}let i={},o=e.getParameters();if(o)for(let n=0;n<o.length;n++){let r=o[n];if(r.JSONname){let n,o,a=i,s=r.JSONname.split("."),l=!0;for(;l;)if(n=s.shift()){if(0===s.length){null!=(o=await t(e.getNominalAttribute?e.getNominalAttribute(r.name):e.getAttribute(r.name),r.type))&&""!==o&&(a[n]=o),l=!1;break}void 0===a[n]&&(a[n]={}),a=a[n]}}}return i}static getObjectDefinition(e){return new Promise((t,n)=>{r.getObjectBaseDefinition(e).then(r=>{if(r){let n=i[e.getType()];n?window.require([n],n=>{if("getObjectDefinition"in n){let i=n.getObjectDefinition(e);t(Object.assign(r,i))}else t(r)}):t(r)}else n(new Error("Object definition not generated"))},n)})}}return r}),define("DS/DMUBaseExperience/EXPImportServices",["UWA/Class","DS/DMUBaseExperience/EXPUtils","DS/DMUBaseExperience/DMUFactory"],function(e,t,n){"use strict";return e.extend({init:function(e){var i,r=this,o=[],a=e?e.experience:null,s=e?e.markupRepRef:null,l=e?e.appType:null;function c(e,n,i,o){switch(n){case"object":return r.importData(e,i,o);case"listObjects":for(var a=[],s=0;s<e.length;s++)a.push(r.importData(e[s],i,o));return a;default:return t.strToType(e,n)}}this.importDataModel=function(t,i){n.initFactory(e.viewer,function(){var e=[];if(t&&t.Model&&t.Model.length)for(var n=0;n<t.Model.length;n++)e.push(r.importData(t.Model[n],a,a));i(e)})},this.importData=function(e,t,o){var a=null,c=null!=e?e.type:null;return c&&(a=n.buildComponent(c,t,o,l))&&a.importData&&(s&&"Markup"===c&&(s.setMarkupContent(a),a.setMarkupOwner(s)),a.importData(e,r,o),a.getUUIDMappingTable&&(i=a.getUUIDMappingTable())),a},this.fillObjectAttributes=function(e,t,n){if(e&&t)for(var i=e.getParameters(),r=0;r<i.length;r++){var o=i[r];if(o.JSONname)for(var a=t,s=o.JSONname.split(".");null!=a&&""!==a;)0===s.length&&e.setAttribute(o.name,c(a,o.type,e,n)),a=a[s.shift()]}},this.registerForPostImport=function(e){e&&e.afterImport&&o.push(e)},this.postImport=function(){for(var e=0;e<o.length;e++)o[e]&&o[e].afterImport(s);o.length=0},this.getUUIDMappingTable=function(){return i}}})}),define("DS/DMUBaseExperience/DMUToolsClipping",["DS/CATWebUXComponents/DMUCommandsManager","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUBaseExperience/DMUContextManager"],function(e,t,n){"use strict";var i=function(e){return e&&e.getDMUObjects?((!(n=e.getDMUObjects("DMUClipping"))||n&&0===n.length)&&(n=e.getDMUObjects("DMUSection")),n.length>0&&(t=n),t):[];var t,n};var r={getClippingCmd:function(t){let n=t&&t.getExecutionContext&&t.getExecutionContext();return n||(n=t&&t.getCommandContext?t.getCommandContext():"Default"),e.getCommandCheckHeader("LockUnlockSectionHdr",n)},getClippingCmdService:function(){var e=this;return{updateClippingCommandState:function(t,i){if(!t||!t.reviewContext)return;var r=t.reviewContext;let o=e.getClippingCmd(t.contextViewer);if(!o)return;var a=e.retriveClippingObjsFromSlide(r),s=!1;a&&a.length>0?i&&!a[0].getAttribute("bClippingActiveState")||(s=!0):s=!1;let l=t.contextViewer.getExecutionContext?t.contextViewer.getExecutionContext():void 0;if(l){let e=l.getComponent(WAfrStandardComponentKey.HandlerComponent);e.isCheckExecutable("LockUnlockSectionHdr")||e.enableCheck("LockUnlockSectionHdr")}if(o.setState(s),t.slideActivateEvent){let e=n.giveEventsController({viewer:t.contextViewer.getViewer()});e&&e.fireEvent("onSlideChanged")}},updateClippingPlaneHideShowState:function(t){if(!t||!t.reviewContext)return;var n=t.reviewContext;let i=t.state;if(null!=i){var r=e.retriveClippingObjsFromSlide(n);r&&r.length>0&&r.forEach(function(e){if(e&&"DMUSection"===e.getType()){var t=e.getAttribute("bClippingPlaneVisible");null==t&&e.setAttribute("bClippingPlaneVisible",!i)}})}},setClippingVisualizationState:function(t,n,i){n&&n.length&&(i?e.activateClipping(n,t):e.deActivateClipping(n,t,!0))}}},getEditCmd:function(t){let n="sectionCmdHdr",i="section2CmdHdr",r=t&&t.getExecutionContext&&t.getExecutionContext();r||(r=t&&t.getCommandContext?t.getCommandContext():"Default");var o=e.getCommand(n,r);if(o||(o=e.getCommand(i,r))&&(n=null),t.getExecutionContext)if(o){let e=n,r=o.cancel;n||(e=i),o.cancel=function(){let n=t&&t.getExecutionContext&&t.getExecutionContext();n&&n.getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler({id:e}),r&&r()},o.isRunning=function(){let e,r=t&&t.getExecutionContext&&t.getExecutionContext();return r&&(e=r.getComponent(WAfrStandardComponentKey.CommandsManagerComponent).getRunningCommand()),e===n||e===i}}else o={begin:function(){let e=t&&t.getExecutionContext&&t.getExecutionContext();e&&e.getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler({id:n})},isRunning:function(){let e,r=t&&t.getExecutionContext&&t.getExecutionContext();return r&&(e=r.getComponent(WAfrStandardComponentKey.CommandsManagerComponent).getRunningCommand()),e===n||e===i},isPaused:function(){return!1},cancel:function(){let e=t&&t.getExecutionContext&&t.getExecutionContext();e&&e.getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler({id:n})},end:function(){let e=t&&t.getExecutionContext&&t.getExecutionContext();e&&e.getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler({id:n})}};return o},isExplodeCmdActive:function(t){let n=t&&t.getExecutionContext&&t.getExecutionContext();n||(n=t&&t.getCommandContext?t.getCommandContext():"Default");var i=!1,r=e.getCommand("Explode",n);return r&&r.isRunning&&(i=r.isRunning()),i},cleanClippingFromSlide:function(e){if(!e)return;let t;e&&((!(t=e.getDMUObjects("DMUClipping"))||t&&0===t.length)&&(t=e.getDMUObjects("DMUSection")),t&&t.length>0&&t.forEach(function(e){if(e){let t=e.getNode();t&&t.clean()}}))},computeBoundingBox:function(e,n,i,r){var o=[],a=[],s=n;return(!s||s.length<1)&&i&&r&&i()&&(t.parseForLeafNodesOfScene(r(),o,a),s=0!==e.getVisibleSpace()?o:a),t.computeBoundingBox(e,s)},computeBoundingSphere:function(e,n,i,r){var o=[],a=[],s=n;return(!s||s.length<1)&&i&&r&&i()&&(t.parseForLeafNodesOfScene(r(),o,a),s=0!==e.getVisibleSpace()?o:a),t.computeBoundingSphereofObjects(e,s)},activateClipping:function(e,t){let n=t.getViewer();e&&e.length&&!(e.length<0)&&n&&(e.forEach(function(e){if(e&&!e.getAttribute("bClippingActiveState")){e.setAttribute("bClippingActiveState",!0),e.manageNavigatoreVisu(!0),e.setVisibleFlag(!0,!1,!0);var t=e.getNode();t&&t.update()}}),n.setSectionCapping(!0),n.render())},deActivateClipping:function(e,t,n){let i=t.getViewer();if(e&&e.length&&!(e.length<0)&&i){if(e.forEach(function(e){if(e&&e.getAttribute("bClippingActiveState")){e.setAttribute("bClippingActiveState",!1),e.manageNavigatoreVisu(!1),e.setVisibleFlag(!1,!1,!0);var t=e.getNode();t&&t.update()}}),!n){var r=this.getEditCmd(t);i.setSectionCapping(!1),(r.isRunning()||r.isPaused())&&r.cancel()}i.render()}},retriveClippingObjsFromSlide:function(e){var t=function(e){var t=function(e){var t=e;if(t){var n=t.getCurrentSessionMarkup();return(!n||n&&!n.getActiveFlag()||n&&n.getActiveFlag()&&!n.isVisible()||n&&n.getActiveFlag()&&n.isVisible()&&n.isReadOnly()||n&&n.getActiveFlag()&&n.isVisible()&&!n.isReadOnly()&&!n.getCurrentSlide())&&(n=t.getTransientReviewBag()),n}}(e);if(t)return t.getCurrentSlide&&(t=t.getCurrentSlide()),i(t)}(e);if(!t||!t.length){var n=function(e){var t=e;if(!t)return;function n(e){let t;return!!(e&&((!(t=e.getDMUObjects("DMUClipping"))||t&&0===t.length)&&(t=e.getDMUObjects("DMUSection")),t&&t.length>0))}let i,r=!1,o=!1,a=t.getCurrentSessionMarkup();a&&a.getActiveFlag()&&a.isVisible()&&a.getCurrentSlide&&(r=n(i=a.getCurrentSlide()));var s=t.getTransientReviewBag();return o=n(s),r||i&&!o?i:s}(e);t=i(n)}return t},isManipulationAllowed:function(t){if(n){let i=n.getContextViewer({viewer:t.viewer}),r=e._getCurrent(i.getCommandContext());if(r)return!!["CAT3DComposeWidgetDefaultHdr","CAT3DComposeMoveHdr","CAT3DComposeExamineSelectionHdr","DMUPositionOverloadHdr","DMUSectionPreSelectPrecisePosHdr","DMUClippingNormalUserHdr","DMUClippinPlaneWithObjectsHdr","DMUClippinSliceWithObjectsHdr","DMUClippinBoxWithObjectsHdr","sectionCmdHdr","section2CmdHdr"].includes(r)||void 0}},getStoreyNavigatorStatus:function(e){if(!e||!e.reviewContext)return;let t=e.reviewContext,n=r.retriveClippingObjsFromSlide(t);return n&&n.length?{ContructionItemId:n[0].retriveCurrentStoreyInfo()}:void 0},setStoreyNavigatorStatus:function(e){if(!e||!e.reviewContext)return;let t=e.reviewContext,n=r.retriveClippingObjsFromSlide(t);n&&n.length&&n[0].updateStoreyNav(e.ContructionItemId)}};return r}),define("DS/DMUBaseExperience/DMUObject",["require","exports","DS/DMUBaseExperience/EXPUtils","DS/DMUBaseExperience/DMUContextManager"],function(e,t,n,i){"use strict";class r{constructor(e,t){let o,a=this,s=i.getContextViewer({viewer:e}),l=!1,c=!1,u=!1,g=!0,d=!1,f=!0,p=[],v=null,h=[],m={};function E(e,t){let n=typeof e;if(typeof t!==n)return!1;if("string"===n||"number"===n||"boolean"===n)return e===t;if(Array.isArray(e)){if(!Array.isArray(t))return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!E(e[n],t[n]))return!1}else if("object"===n)return e.toArray?!!t.toArray&&E(e.toArray(),t.toArray()):e.toString?!!t.toString&&E(e.toString(),t.toString()):e===t;return!0}this.getFrameWindow=function(){return null==s?void 0:s.getFrameWindow()},this.fireEvent=function(t,n){o||(o=i.giveEventsController({viewer:e})),o&&o.fireEvent(t,n)},this.makeDirty=function(){t&&t.setDirtyFlag&&!t.isReadOnly()&&t.setDirtyFlag(!0)},this.addParameters=function(e){p=p.concat(e);for(let t=0;t<e.length;t++)void 0!==e[t].defaultValue&&a.setAttribute(e[t].name,n.cloneType(e[t].defaultValue,e[t].type))},this.getParameters=function(){return p},this.removeParameters=function(e){for(let t=0;t<e.length;t++){for(let n=p.length-1;n>=0;n--)if(p[n].name===e[t]){p.splice(n,1);break}delete m[e[t]]}},this.getNode=function(){return v},this.setNode=function(e){v||(v=e)},this.refreshNode=function(){},this.setInEdition=function(e){e!==u&&(u=e,a.fireEvent("onDMUObjectEdited",{dmuObject:a,flag:u}))},this.isInEdition=function(){return u},this.setActiveFlag=function(e){e!==g&&(g=e,a.fireEvent("onDMUObjectActiveFlagChanged",{dmuObject:a,flag:g}))},this.getActiveFlag=function(){return g},this.setVisibleFlag=function(e,t){(e!==f||t)&&(f=e,a.fireEvent("onDMUObjectVisibleFlagChanged",{dmuObject:a,flag:f}))},this.isVisible=function(){return f},this.setDisplayedFlag=function(e){e!==d&&(d=e,a.fireEvent("onDMUObjectDisplayedFlagChanged",{dmuObject:a,flag:d}))},this.isDisplayed=function(){return d},this.setReadOnly=function(e,t){e!==c&&(!e&&a.initAuthoringData?a.initAuthoringData():e&&a.removeAuthoringData&&a.removeAuthoringData(),c=e,a.fireEvent("onDMUObjectReadOnlyFlagChanged",{dmuObject:a,flag:c}),t&&a.getNode()&&a.getNode().setReadOnly&&a.getNode().setReadOnly(c))},this.isReadOnly=function(){return c},this.isEditable=function(){return!0},this.setTemporary=function(e){if(e===l)return;let t;l=e;for(let n=p.length-1;n>=0;n--)if((t=a.getAttribute(p[n].name))&&"listObjects"===p[n].type&&Array.isArray(t))for(let n=t.length-1;n>=0;n--)t[n].setTemporary&&t[n].setTemporary(e)},this.isTemporary=function(){return l},this.remove=function(){let e;if(v&&v.remove(),p){for(let t=p.length-1;t>=0;t--)if(e=a.getAttribute(p[t].name))if("listObjects"===p[t].type&&Array.isArray(e)){for(let t=e.length-1;t>=0;t--){let n=e[t];e.splice(t,1),n.remove&&n.remove()}e.splice(0,e.length)}else e instanceof r&&(e.remove(),e=null);p.length=0}a.makeDirty(),a.isTemporary()||a.fireEvent("onDMUObjectDeleted",{dmuObject:a}),v=o=null,d=f=g=!1},this.getAttribute=function(e){return m[e]},this.setAttribute=function(e,t){e&&a.hasAttribute(e)&&m[e]!==t&&(m[e]=t,a.makeDirty(),a.fireEvent("onDMUObjectAttributeModified",{dmuObject:a,attrName:e,value:t}))},this.setAttributes=function(e){if(e&&e.length)for(let t=0;t<e.length;t++)a.setAttribute(e[t].name,e[t].value)},this.hasAttribute=function(e){for(let t=0;t<p.length;t++)if(p[t].name===e)return!0;return!1},this.isAttributeReadOnly=function(e){for(let t=0;t<h.length;t++)if(h[t]===e)return!0;return!1},this.setListOfReadOnlyAttributes=function(e){h=e||[]},this.compareAttributes=function(e){if(!e||!e.length)return!1;for(let t=0;t<e.length;t++)for(let n=0;n<p.length;n++)if(p[n].name===e[t].name&&!E(e[t].value,a.getAttribute(e[t].name)))return!1;return!0},this.getType=function(){return"DMU"+a.getAttribute("sType")},this.getParent=function(){return t},this.set=function(e){if(e){let t=function(e){if(e){let t=m[e.attribute];e.mode?"addValue"===e.mode&&Array.isArray(t)&&(null!==e.index&&void 0!==e.index?t.splice(e.index,0,e.value):t.push(e.value),a.makeDirty(),a.fireEvent("onDMUObjectAttributeModified",{dmuObject:a,attrName:e.attribute,value:t})):a.setAttribute(e.attribute,e.value)}};if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else t(e)}},setTimeout(function(){a.fireEvent("onDMUObjectCreated",{dmuObject:a})})}}return r}),define("DS/DMUBaseExperience/EXPObject",["UWA/Class","DS/DMUBaseExperience/EXPUtils","DS/DMUBaseExperience/DMUContextManager"],function(e,t,n){"use strict";return e.extend({init:function(e,i){var r=this;this._viewer=e;var o=e,a=n.getContextViewer({viewer:e});a&&(this._frmWindow=a.getFrameWindow());var s,l=!1,c=!1,u=!0,g=!1,d=!0,f=!1,p=!0,v=[],h=null,m=[];function E(e,t){var n=typeof e;if(typeof t!==n)return!1;if("string"===n||"number"===n||"boolean"===n)return e===t;if(Array.isArray(e)){if(!Array.isArray(t))return!1;if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if(!E(e[i],t[i]))return!1}else if("object"===n)return e.toArray?!!t.toArray&&E(e.toArray(),t.toArray()):e.toString?!!t.toString&&E(e.toString(),t.toString()):e===t;return!0}this.getViewer=function(){return o},this.getFrameWindow=function(){return a.getFrameWindow()},this.fireEvent=function(t,i){s||(s=n.giveEventsController({viewer:e})),s&&s.fireEvent(t,i)},this.makeDirty=function(){i&&i.setDirtyFlag&&!i.isReadOnly()&&i.setDirtyFlag(!0)},this.addParameters=function(e){v=v.concat(e);for(var n=0;n<e.length;n++)void 0!==e[n].defaultValue&&(r["_"+e[n].name]=t.cloneType(e[n].defaultValue,e[n].type))},this.getParameters=function(){return v},this.removeParameters=function(e){for(let t=0;t<e.length;t++){for(let n=v.length-1;n>=0;n--)if(v[n].name===e[t]){v.splice(n,1);break}delete r["_"+e[t]]}},this.getNode=function(){return h},this.setNode=function(e){h||(h=e)},this.refreshNode=function(){},this.setInEdition=function(e){e!==g&&(g=e,r.fireEvent("onDMUObjectEdited",{dmuObject:r,flag:g}))},this.isInEdition=function(){return g},this.setActiveFlag=function(e){e!==d&&(d=e,r.fireEvent("onDMUObjectActiveFlagChanged",{dmuObject:r,flag:d}))},this.getActiveFlag=function(){return d},this.setVisibleFlag=function(e,t){(e!==p||t)&&(p=e,r.fireEvent("onDMUObjectVisibleFlagChanged",{dmuObject:r,flag:p}))},this.isVisible=function(){return p},this.setDisplayedFlag=function(e){e!==f&&(f=e,r.fireEvent("onDMUObjectDisplayedFlagChanged",{dmuObject:r,flag:f}))},this.isDisplayed=function(){return f},this.setReadOnly=function(e,t){e!==c&&(!e&&r.initAuthoringData?r.initAuthoringData():e&&r.removeAuthoringData&&r.removeAuthoringData(),c=e,r.fireEvent("onDMUObjectReadOnlyFlagChanged",{dmuObject:r,flag:c}),t&&r.getNode()&&r.getNode().setReadOnly&&r.getNode().setReadOnly(c))},this.isReadOnly=function(){return c},this.setEditable=function(e){e!==u&&(u=e)},this.isEditable=function(){return u},this.setTemporary=function(e){if(e!==l){var t;l=e;for(var n=v.length-1;n>=0;n--)if((t=r.getAttribute(v[n].name))&&"listObjects"===v[n].type&&t.length)for(var i=t.length-1;i>=0;i--)t[i].setTemporary&&t[i].setTemporary(e)}},this.isTemporary=function(){return l},this._internalRemove=function(){var e;if(h&&h.remove(),v){for(var t=v.length-1;t>=0;t--)if(e=r.getAttribute(v[t].name))if("listObjects"===v[t].type&&e.length){for(var n=e.length-1;n>=0;n--){let t=e[n];e.splice(n,1),t.remove&&t.remove()}e.splice(0,e.length)}else e.remove&&e.remove(),e=null;v.length=0}r.makeDirty(),r.isTemporary()||r.fireEvent("onDMUObjectDeleted",{dmuObject:r}),h=s=null,f=p=d=!1},this._internalGetAttribute=function(e){return void 0!==e&&void 0!==r["_"+e]?r["_"+e]:void 0},this._internalSetAttribute=function(e,t){e&&r.hasAttribute(e)&&r["_"+e]!==t&&(r["_"+e]=t,r.makeDirty(),r.fireEvent("onDMUObjectAttributeModified",{dmuObject:r,attrName:e,value:t}))},this.setAttributes=function(e){if(e&&e.length)for(var t=0;t<e.length;t++)r.setAttribute(e[t].name,e[t].value)},this.hasAttribute=function(e){for(var t=0;t<v.length;t++)if(v[t].name===e)return!0;return!1},this.isAttributeReadOnly=function(e){for(var t=0;t<m.length;t++)if(m[t]===e)return!0;return!1},this.setListOfReadOnlyAttributes=function(e){m=e||[]},this.compareAttributes=function(e){if(!e||!e.length)return!1;for(var t=0;t<e.length;t++)for(var n=0;n<v.length;n++)if(v[n].name===e[t].name&&!E(e[t].value,r.getAttribute(e[t].name)))return!1;return!0},this.getType=function(){return"DMU"+r.getAttribute("sType")},this.getParent=function(){return i},this._internalSet=function(e){if(e){var t=function(e){e&&(e.mode?"addValue"===e.mode&&(null!==e.index&&void 0!==e.index?r["_"+e.attribute].splice(e.index,0,e.value):r["_"+e.attribute].push(e.value),r.makeDirty(),r.fireEvent("onDMUObjectAttributeModified",{dmuObject:r,attrName:e.attribute,value:r["_"+e.value]})):r.setAttribute(e.attribute,e.value))};if(Array.isArray(e))for(var n=0;n<e.length;n++)t(e[n]);else t(e)}},setTimeout(function(){r.fireEvent("onDMUObjectCreated",{dmuObject:r})})},remove:function(){this._internalRemove&&this._internalRemove()},set:function(e){this._internalSet&&this._internalSet(e)},setAttribute:function(e,t){this._internalSetAttribute&&this._internalSetAttribute(e,t)},getAttribute:function(e){if(this._internalGetAttribute)return this._internalGetAttribute(e)}})}),define("DS/DMUBaseExperience/DMUOverloadableObject",["DS/DMUBaseExperience/EXPObject","DS/DMUBaseExperience/DMUContextManager","DS/DMUMeasurable/DMUToolsSceneGraph"],function(e,t,n){"use strict";var i=[{name:"sType",type:"string",JSONname:"type"},{name:"sID",type:"string",JSONname:"id"},{name:"sUuid",type:"string",JSONname:"uuid"},{name:"sName",type:"string",JSONname:"Name"},{name:"bEditable",type:"boolean",JSONname:"editable"},{name:"sDescription",type:"string",JSONname:"Description"}];return e.extend({init:function(e,t){this._parent(e,t),this.addParameters(i);var r,o=this,a=!1;this.getPathElement=function(){return r||(r=n.buildPathElement(o.getNode())),r.clone()},this.updateRepresentation=function(e,t){o.getNode().updateRepresentation(e,a),t&&(o.updateModel&&o.updateModel(e),o.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:o}))},this.setGhostMode=function(e){a=e},this.setNodePickable=function(e){o.getNode().setPickable(e)},this.isEditable=function(){return o.getAttribute("bEditable")||void 0===o.getAttribute("bEditable")}},remove:function(){for(var e=this.getParent()&&this.getParent().getSlides?this.getParent().getSlides():[],t=e.length-1;t>=0;t--)e[t]&&e[t].removeObjectOverload(e[t].getOverloadForTarget(this));this._parent()},setNominalAttribute:function(e,t){e&&this.hasAttribute(e)&&(this["_"+e]=t,this.makeDirty())},getNominalAttribute:function(e){return this["_"+e]},setAttribute:function(e,n){if(e){var i=0,r=!1,o=this.getParameters();if(o){for(i=0;i<o.length;i++)if(o[i].name===e&&"boolean"==typeof o[i].isOverloadable){r=o[i].isOverloadable;break}var a=!0;if(r){var s=null,l=t.getReviewContext({viewer:this.getViewer()});if(l&&l.getCurrentSessionMarkup()&&(s=l.getCurrentSessionMarkup().getCurrentSlide?l.getCurrentSessionMarkup().getCurrentSlide():null),s){var c=!1,u=s.getOverloadForTarget(this);if(null==u&&(u={target:this,state:{}},c=!0),u){var g=u.state;if(g){var d=u.state[e];if(void 0===d){for(var f=!1,p=0;!f&&p<o.length;p++){var v=o[p];v.name===e&&v.isOverloadable&&(g[e]=n,this.makeDirty(),a=!1,f=!0)}!0===f&&c&&s.addObjectOverload(u)}void 0!==d&&(g[e]=n,this.makeDirty(),a=!1)}}}}a&&this._parent(e,n)}}},getAttribute:function(e){var n;if(e){var i=0,r=!1,o=this.getParameters();if(o){for(i=0;i<o.length;i++)if(o[i].name===e&&"boolean"==typeof o[i].isOverloadable){r=o[i].isOverloadable;break}if(r){var a=null,s=t.getReviewContext({viewer:this.getViewer()});if(s&&s.getCurrentSessionMarkup()&&(a=s.getCurrentSessionMarkup().getCurrentSlide?s.getCurrentSessionMarkup().getCurrentSlide():null),a){var l=a.getOverloadForTarget(this);if(l&&l.state)n=l.state[e];else{var c=a.getPointedFormats?a.getPointedFormats():null;if(c&&c.length)for(i=0;i<c.length;i++)if((l=c[i].getOverloadForTarget(this))&&l.state){n=l.state[e];break}}}}void 0===n&&(n=this.getNominalAttribute(e))}}return n}})}),define("DS/DMUBaseExperience/DMUOccurrenceOverloader",["DS/DMUBaseExperience/DMUOverloadableObject","DS/Visualization/Node3D","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/DMUOccurrenceOverloaderImport"],function(e,t,n,i,r){"use strict";var o=[{name:"sTargetId",type:"string",JSONname:"targetId"},{name:"bVisible",type:"bool",JSONname:"PropertiesOccurrenceOverloader.GraphicProperties.visible",isOverloadable:!0},{name:"cColor",type:"Color",JSONname:"PropertiesOccurrenceOverloader.GraphicProperties.color",isOverloadable:!0},{name:"fOpacity",type:"float",JSONname:"PropertiesOccurrenceOverloader.GraphicProperties.opacity",isOverloadable:!0},{name:"mTransfoMatrix",type:"Matrix4",JSONname:"PropertiesOccurrenceOverloader.transformationMatrix",isOverloadable:!0},{name:"mPosition",type:"Matrix4",JSONname:"PropertiesOccurrenceOverloader.position",isOverloadable:!0}];return e.extend({init:function(e,a){this._parent(e,a),this.addParameters(o),this.setAttribute("sType","OccurrenceOverloader");var s,l=this,c=new t;c.getDMUType=function(){return l.getType()},this.setNode(c);var u=new r(this);function g(){if(!s&&l.getAttribute("sTargetId")){var e=a.getAttribute("oLinksManager");e&&(s=e.getChildWithID(l.getAttribute("sTargetId")))&&(s.idPath=e.getOccurrenceIdPath(s.path))}}this.importData=u.importData,this.afterImport=u.afterImport,this._parentRemove=this.remove,this.remove=function(){l._parentRemove(),u=null},this.setOccurrence=function(e){e&&(s=null,l.setAttribute("sTargetId",e.id),g())},this.isOverloading=function(e){if(!s||s&&!s.idPath)return!1;var t=e.idPath||n.getIdPath(e.pathElement);if(s.idPath.length!==t.length)return!1;for(var i=0;i<s.idPath.length;i++)if(s.idPath[i]!==t[i])return!1;return!0},this.isOverloadedInCurrentSlide=function(){if(!s||s&&!s.idPath)return!1;var t=i.getReviewContext({viewer:e});if(t&&t.getCurrentSessionMarkup()){var n=t.getCurrentSessionMarkup().getCurrentSlide();if(n){var r=n.getOverloadForTarget(l);return null!=r}}return!1},this._parentGetNominalAttribute=this.getNominalAttribute,this.getNominalAttribute=function(e){if("bVisible"!==e&&"cColor"!==e&&"fOpacity"!==e&&"mPosition"!==e&&"mTransfoMatrix"!==e)return l._parentGetNominalAttribute(e)},this.getOccurrencePathElement=function(){s||g();var e=a.getAttribute("oLinksManager");return e&&s?e.getOccurrencePathElement(s.id):null},this.getOccurrenceIDPath=function(){return s&&s.idPath||g(),s?s.idPath:null}}})}),define("DS/DMUBaseExperience/DMUEnvironment",["require","exports","DS/DMUBaseExperience/EXPManagerSet","DS/DMUBaseExperience/DMUOverloadableObject","DS/DMUBaseExperience/DMUToolsClipping","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPToolsVisualization"],function(e,t,n,i,r,o,a){"use strict";let s=[{name:"vViewpointPosition",type:"Vector3",JSONname:"ViewpointProperty.Position",isOverloadable:!0},{name:"vViewpointSight",type:"Vector3",JSONname:"ViewpointProperty.Sight",isOverloadable:!0},{name:"vViewpointUp",type:"Vector3",JSONname:"ViewpointProperty.Up",isOverloadable:!0},{name:"vViewpointRight",type:"Vector3",JSONname:"ViewpointProperty.Right",isOverloadable:!0},{name:"fViewpointTargetDistance",type:"float",JSONname:"ViewpointProperty.targetDistance",isOverloadable:!0},{name:"fViewpointFieldOfView",type:"float",JSONname:"ViewpointProperty.fieldOfView",isOverloadable:!0},{name:"iViewpointType",type:"int",JSONname:"ViewpointProperty.type",isOverloadable:!0},{name:"bLockUnlockSection",type:"bool",JSONname:"SessionProperty.LockUnlockSection",isOverloadable:!0},{name:"sFocusProperty",type:"listStrings",JSONname:"FocusProperty.targetId",isOverloadable:!0},{name:"fDocumentRotationAngle",type:"float",JSONname:"DocumentProperty.fDocumentRotationAngle",isOverloadable:!0},{name:"sContructionItemId",type:"string",JSONname:"SessionProperty.contructionItemId",isOverloadable:!0},{name:"sConstructionClippingMode",type:"string",JSONname:"SessionProperty.constructionClippingMode",isOverloadable:!0},{name:"b360Mode",type:"bool",JSONname:"ViewpointProperty.360mode",isOverloadable:!0}];return class extends i{constructor(e,t){super(e,t),this.setAttribute("sType","Environment"),this.addParameters(s);let i=this;this.setActiveFlag=function(t){!t&&e.currentViewpoint&&e.currentViewpoint.setAngle(45)},this.getEnvironmentInfo=function(){let t=a.getViewpointInfo(e.currentViewpoint);if(t){let a={vViewpointSight:t.sight,vViewpointRight:t.right,vViewpointUp:t.up,vViewpointPosition:t.position,fViewpointTargetDistance:t.distance,iViewpointType:t.projectionType,fViewpointFieldOfView:t.angle,b360Mode:o&&"R2V"===o.getCurrentReviewContext()?t.mode360:void 0};if(e.get2DMode()){let e=n.getManager({name:"DMU2DSheetManager",context:i.getFrameWindow()});e&&("Document"===e.getDocumentType()?a.fDocumentRotationAngle=e.getDocumentRotationAngle():e.getCurrentSheet()&&(a.sFocusProperty=[e.getCurrentSheet()]))}e._lockUnlockCmd&&(a.bLockUnlockSection=e._lockUnlockCmd.getState());let s=r.getStoreyNavigatorStatus({reviewContext:o.getReviewContext({viewer:e})});return s&&(s.ContructionItemId&&(a.sContructionItemId=s.ContructionItemId),s.storeyClippingMode&&(a.sConstructionClippingMode=s.storeyClippingMode)),a}},this.getCurrentSlideEnvironmentInfo=function(){return{vViewpointSight:i.getAttribute("vViewpointSight"),vViewpointRight:i.getAttribute("vViewpointRight"),vViewpointUp:i.getAttribute("vViewpointUp"),vViewpointPosition:i.getAttribute("vViewpointPosition"),fViewpointTargetDistance:i.getAttribute("fViewpointTargetDistance"),iViewpointType:i.getAttribute("iViewpointType"),fViewpointFieldOfView:i.getAttribute("fViewpointFieldOfView"),sFocusProperty:i.getAttribute("sFocusProperty"),fDocumentRotationAngle:i.getAttribute("fDocumentRotationAngle"),bLockUnlockSection:i.getAttribute("bLockUnlockSection"),sContructionItemId:i.getAttribute("sContructionItemId"),ConstructionClippingMode:i.getAttribute("sConstructionClippingMode"),b360Mode:i.getAttribute("b360Mode")}},this.refresh=function(t){let s=t||{};!function(t,r){if(e.get2DMode()){let e=n.getManager({name:"DMU2DSheetManager",context:i.getFrameWindow()});if(e){let n=t?t.fDocumentRotationAngle:i.getAttribute("fDocumentRotationAngle");n&&e.setDocumentRotation(n);let o=t?t.sFocusProperty:i.getAttribute("sFocusProperty");if(o&&o.length>0){let t=function(e,t){for(let n=0;n<e.length;n++)if(e[n].toString().match(t))return n;return-1}(o,/^Drw.+/);return-1===t&&(t=0),void e.setCurrentSheet({sheetID:o[t],callback:r})}}}r()}(s.envInfos,function(){let t=s.viewpoint?s.viewpoint:e.currentViewpoint,n=r.getClippingCmdService();n&&n.updateClippingPlaneHideShowState({reviewContext:o.getReviewContext({viewer:e}),state:i.getAttribute("bLockUnlockSection")});let l=i.getAttribute("sContructionItemId"),c=i.getAttribute("sConstructionClippingMode");if(!l){let t=r.getStoreyNavigatorStatus({reviewContext:o.getReviewContext({viewer:e})});t&&(t.ContructionItemId&&(l=t.ContructionItemId),t.storeyClippingMode&&(c=t.storeyClippingMode))}r.setStoreyNavigatorStatus({ContructionItemId:l,storeyClippingMode:c,reviewContext:o.getReviewContext({viewer:e})});let u=s.envInfos?s.envInfos.vViewpointPosition:i.getAttribute("vViewpointPosition");if(null==u)return;let g=s.envInfos?s.envInfos.vViewpointSight:i.getAttribute("vViewpointSight");if(null==g)return;let d=s.envInfos?s.envInfos.fViewpointTargetDistance:i.getAttribute("fViewpointTargetDistance");if(null==d)return;let f=s.envInfos?s.envInfos.vViewpointUp:i.getAttribute("vViewpointUp");if(null==f)return;let p=s.envInfos?s.envInfos.iViewpointType:i.getAttribute("iViewpointType");0!==p&&1!==p||p===t.getProjectionType()||t.setProjectionType(p);let v=s.envInfos?s.envInfos.fViewpointFieldOfView:i.getAttribute("fViewpointFieldOfView");v=null==v||isNaN(v)?45:v,t.setAngle(v),a.moveViewpoint({viewpoint:t,eyePosition:u,sightDirection:g,upDirection:f,targetDistance:d,duration:s.duration,fieldOfView:v})})}}}}),define("DS/DMUBaseExperience/DMULinksManager",["require","exports","DS/DMUMeasurable/DMUToolsSceneGraph","DS/Visualization/PathElement","DS/DMUBaseExperience/DMULinksManagerImport","DS/DMUBaseExperience/DMUObject"],function(e,t,n,i,r,o){"use strict";return class extends o{constructor(e,t){super(e,t),this.addParameters([{name:"sType",type:"string",JSONname:"type",defaultValue:"ExternalLinks"}]);let o=this,a=[],s=[],l=[],c=new r(this);this.importData=c.importData,this.afterImport=c.afterImport;let u=this.remove;this.remove=function(){a&&(a.length=0),s&&(s.length=0),l&&(l.length=0),u()},this.getOccurrences=function(){return s},this.getEntities=function(){return a},this.getTextGraphicRepresentations=function(){return l},this.getChildWithID=function(e){let t=null;return s.some(function(n){if(n&&n.id===e)return t=n,!0}),t||a.some(function(n){if(n&&n.id===e)return t=n,!0}),t},this.getOccurrenceIdPath=function(e){let t=[];for(let n=0;n<e.length;n++)for(let i=0;i<a.length;i++)if(a[i].id===e[n]){t.push(a[i].identifier);break}return t},this.getTesselatedRepByID=function(e){let t;for(let n=0;n<l.length;n++)if(l[n].id===e){t=l[n].textRep;break}return t},this.getOccurrence=function(e,i){if(!e)return;let r,o,l=e.idPath||[];if(e.pathElement){let t=function(e){let t=e.clone();for(t.internalPath=[];t.getElement(0)&&!n.isPLMNode(t.getElement(0));)t.externalPath.shift();for(;t&&!n.isPLMNode(t.getLastElement(!0));)t=t.getParentPath();return t}(e.pathElement);if(t)for(o=0;o<t.getLength();o++)l.push(n.getNodeID(t.getElement(o)))}if(l.length){let e,n=[],c=!0,u=[];for(o=0;o<l.length;o++){e=null;for(let t=0;t<a.length;t++)if(a[t]&&a[t].identifier&&a[t].identifier===l[o]){e=a[t];break}e?n.push(e.id):(i&&(e={id:t.computeNewID(),identifier:l[o]},u.push(e),n.push(e.id)),c=!1)}if(c){let e,t,i=!1;for(let o=0;!i&&o<s.length;o++)if(e=s[o].path,n.length===e.length){t=!0;for(let i=0;t&&i<e.length;i++)t=n[i]===e[i];i=t,t&&(r=s[o])}}i&&(a=a.concat(u),r||(r={id:t.computeNewID(),path:n},s.push(r)))}return r},this.getOccurrencePathElement=function(t){for(let r=0;r<s.length;r++)if(s[r].id===t&&s[r].path){let t,o=n.getRootBag(e),l=[o],c=s[r].path,u=0;for(let e=0;o&&e<c.length;e++){t=null;for(let i=0;i<a.length;i++)if(a[i].id===c[e]){let e=!1;if((t=a[i]).identifier){let i=o.getChildren();for(let r=0;!e&&r<i.length;r++){let a=i[r];n.getNodeID(a)&&(e=n.getNodeID(a)===t.identifier)&&(u++,o=a)}}e&&o&&l.push(o);break}}if(l.length&&u===c.length)return new i(l)}},this.exportLinksManagerData=function(e){let t,n;e.entities=[];let i=o.getEntities();for(t=0;t<i.length;t++)n=i[t],e.entities.push({id:n.id,identifier:n.identifier});e.occurrences=[];let r=o.getOccurrences();for(t=0;t<r.length;t++)n=r[t],e.occurrences.push({id:n.id,path:n.path});let a=o.getTextGraphicRepresentations();if(a.length)for(e.textGraphicRepArray=[],t=0;t<a.length;t++)n=a[t],e.textGraphicRepArray.push({id:n.id,textRep:n.textRep})},this.importLinksManagerData=function(e){let t,n;if(e.entities&&e.entities.length)for(t=0;t<e.entities.length;t++)n=e.entities[t],a.push({id:n.id,identifier:n.identifier});if(e.occurrences&&e.occurrences.length)for(t=0;t<e.occurrences.length;t++)(n=e.occurrences[t]).id&&n.path&&s.push({id:n.id,path:n.path});if(e.textGraphicRepArray&&e.textGraphicRepArray.length)for(t=0;t<e.textGraphicRepArray.length;t++)(n=e.textGraphicRepArray[t])&&n.id&&n.textRep&&l.push({id:n.id,textRep:n.textRep})}}}}),define("DS/DMUBaseExperience/DMUExperience",["require","exports","DS/DMUBaseExperience/EXPControllerEvents","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUBaseExperience/DMUToolsClipping","DS/DMUBaseExperience/DMUPreferences","DS/Visualization/Node3D","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/DMULinksManager","DS/DMUBaseExperience/DMUObject","DS/DMUBaseExperience/DMUEnvironment"],function(e,t,n,i,r,o,a,s,l,c,u){"use strict";class g extends c{constructor(e,t){super(e,t),this.setNode(new a("DMUTemporaryReviewBag"));let n=this,i=[],r=0,o=new l(e,this);this.getType=function(){return"DMUTemporaryBag"},this.getOccurence=function(e,t){if(o)return o.getOccurrence(e,t)},this.getAttribute=function(e){return"oLinksManager"===e?o:void 0},this.refreshNode=function(){for(let e=0;e<i.length;e++)i[e].refreshNode()};let s=this.setVisibleFlag;this.setVisibleFlag=function(e){s(e);for(let t=0;t<i.length;t++)i[t].setVisibleFlag(e)},this.getOrCreateOccurrenceOverloader=function(){return null},this.setDirtyFlag=function(){},this.computeNewID=function(){return(++r).toString()},this.computeNewName=function(e){if(!e||!e.object)return"";let t,n=1,r=e.prefix+"."+n,o=[];for(t=0;t<i.length;t++)e.object.getType()===i[t].getType()&&o.push(i[t].getAttribute("sName"));for(;-1!==o.indexOf(r);)n++,r=e.prefix+"."+n;return r};let c=this.remove;this.remove=function(){for(let e=0;e<i.length;e++)i[e].remove();i.length=0,c()},this.setActiveFlag=function(e){for(let t=0;t<i.length;t++)i[t].setActiveFlag(e)},this.getDMUObjectFromPathElement=function(e){if(!e)return;let t,r=e.getLastElement(!0);if(n.getNode()===r)return n;for(let n=0;n<i.length;n++){if(i[n].getNode&&i[n].getNode()===r){t=i[n];break}if(i[n].getDMUObjectFromPathElement&&(t=i[n].getDMUObjectFromPathElement(e)))return t}return t},this.addDMUObject=function(e){i.push(e),e.getNode()&&n.getNode().addChild(e.getNode()),e.setDisplayedFlag(!0),n.fireEvent("onDMUObjectAddedInObject",{dmuObject:e,parentObject:n})},this.getDMUObjects=function(e){let t=[];for(let n=0;n<i.length;n++)(!e||e&&i[n]&&i[n].getType()===e)&&t.push(i[n]);return t},this.removeDMUObjects=function(e){let t,r,o;if(Array.isArray(e)){for(t=e.length-1;t>=0;t--)for(r=i.length-1;r>=0;r--)if((o=i[r])===e[t]){n.getNode().removeChild(o.getNode()),i.splice(r,1),o.remove(),n.fireEvent("onDMUObjectRemovedFromObject",{dmuObject:o,parentObject:n});break}}else for(t=i.length-1;t>=0;t--)o=i[t],(!e||e&&o&&o.getType()===e)&&(n.getNode().removeChild(o.getNode()),i.splice(t,1),o.remove(),n.fireEvent("onDMUObjectRemovedFromObject",{dmuObject:o,parentObject:n}))}}}return class extends c{constructor(e){super(e.getViewer());let t,l,c,d,f,p=e.getViewer(),v=this,h=!1,m=new o,E=null,D=new g(e.getViewer(),this),M=[],b={},P=new u(p,v),y=null,C=!1;this.setNode(new a("DMUReviewBag")),this.getNode().addChild(D.getNode()),this.setReviewCtxInformation=function(e){y&&y.reviewId===e.reviewId&&y.fromIssue&&(e.fromIssue=y.fromIssue),y=e,v.fireEvent("onReviewCtxInformationChanged",y)},this.getReviewCtxInformation=function(){return y},this.getDMUPreferenceRepository=function(){return m},this.setCurrentSessionMarkup=function(e){var t;E&&(l||(v.getNode().removeChild(E.getNode()),c?E.setVisibleFlag(!1):(E.remove(),v.fireEvent("onReviewRemoved",{reviewId:y?y.reviewId:null,highlightId:y&&null!==(t=y.highlightId)&&void 0!==t?t:null})))),(E=e)&&!M.includes(E)?v.setVisibleMarkups(l?[...M,E]:[E]):E||v.setVisibleMarkups([]),v.fireEvent("onCurrentSessionMarkupChanged",{currentMarkup:E})},this.getCurrentSessionMarkup=function(){return E},this.getTransientReviewBag=function(){return D},this.enableMultipleMarkupVisibility=(e=>{l!==e&&((l=e)?v.setVisibleMarkups(M):v.setVisibleMarkups(E?[E]:[]))}),this.getVisibleMarkups=(()=>M),this.setVisibleMarkups=(e=>{const t=v.getNode();t&&(M.forEach(e=>{const n=e.getNode();n&&t.removeChild(n),e.setVisibleFlag(!1,!0)}),M=e.slice(),e.forEach(e=>{const n=e.getNode();n&&t.addChild(n),e.setVisibleFlag(!0,!0)}))}),this.getDMUObjectFromPathElement=function(e){if(!e)return;let t=E?E.getDMUObjectFromPathElement(e):void 0;if(!t&&c){let n=c.getMarkups();for(let i=0;i<n.length;i++){let r=n[i].getMarkupContent();if(!r&&n[i].getRepRef()&&(r=n[i].getRepRef().getMarkupContent()),!r)continue;if(t=r.getDMUObjectFromPathElement(e))return t;let o=n[i].getReplies();for(let n=0;n<o.length;n++)if(!(r=o[n].getMarkupContent())&&o[n].getRepRef()&&(r=o[n].getRepRef().getMarkupContent()),r&&(t=r.getDMUObjectFromPathElement(e)))return t}}return t||(t=D.getDMUObjectFromPathElement(e)),t},this.getUIManager=function(){return t},this.setUIManager=function(e){!t&&e&&(t=e).setActiveFlag(!0)},this.setActiveFlag=function(n){n!==h&&((h=n)?e.getViewer().getRootNode().addChild(v.getNode()):e.getViewer().getRootNode().removeChild(v.getNode()),t&&t.setActiveFlag(h),P&&P.setActiveFlag(h),E&&E.setActiveFlag(h),D&&D.setActiveFlag(h),c&&c.setActiveFlag(h))},this.getActiveFlag=function(){return h},this.refreshNode=function(){E&&E.refreshNode(),D&&D.refreshNode(),c&&c.refreshNode()};let S=this.remove;this.remove=function(){if(v.removeInternalDataModel(),D&&(v.getNode().removeChild(D.getNode()),D.remove()),P&&P.remove(),t&&(t.remove(),t=null),d){let e=Object.keys(b);for(let t=0;t<e.length;t++)d.removeEvent(b[e[t]]);b={},s.unreferenceEventsController({viewer:p})}p.getRootNode().remove(v.getNode()),E=P=y=null,S()},this.removeInternalDataModel=function(){var e;c&&(c.remove(),c=null),E&&(v.getNode().removeChild(E.getNode()),E.remove()),v.fireEvent("onReviewRemoved",{reviewId:y?y.reviewId:null,highlightId:y&&null!==(e=y.highlightId)&&void 0!==e?e:null})};let w=this.setReadOnly;this.setReadOnly=function(e){E&&E.setReadOnly(e),c&&c.setReadOnly(e),t&&t.setReadOnly(e),w(e)};let x=this.setVisibleFlag;this.setVisibleFlag=function(e){e!==v.isVisible()&&(x(e),E&&E.setVisibleFlag(e),D&&D.setVisibleFlag(e),c&&c.setVisibleFlag(e))},this.getEnvironment=function(){return P},this.getValidation=function(){return c},this.setValidation=function(e){c&&v.getNode().removeChild(c.getNode()),e&&(c=e,v.getNode().addChild(c.getNode()))},this.getRestrictions=function(e){let t;return f&&(t=f(e)),t||{review:{canEditValObj:!0,canEditState:!0},check:{canCreate:!0,canEditDef:!0,canEditState:!0,canDelete:!0},highlight:{canCreate:!0,canEditDef:!0,canEditPriority:!0,canDelete:!0},markup:{canCreate:!0,canEdit:!0,canDelete:!0},reply:{canCreate:!0,canEdit:!0,canDelete:!0}}},this.setRestrictions=function(e){f=e},function(){if(!d){d=s.getEventsController({viewer:e.getViewer()});let t=function(){let t=s.getContextViewer({viewer:p});if(t){let n=t.getRootBagPath().getChildrenPathes();if(y)for(let e=0;e<n.length;e++)if(i.getNodeID(n[e].getLastElement(!0))===y.contextId)return;if(y||!n.length){s.removeReviewContext({viewer:p});let t=r.getClippingCmdService();t&&t.updateClippingCommandState({contextViewer:s.getContextViewer({viewer:e.getViewer()}),reviewContext:s.getReviewContext({viewer:e.getViewer()})})}}},o=function(){d.removeEvent(b.EXPRootRemovedEvent),b.EXPRootRemovedEvent=-1},a=function(){b.EXPRootRemovedEvent=d.addEvent(n.Events.EXPRootRemovedEvent,t)};b.EXPApplyFilterBeginEvent=d.addEvent(n.Events.EXPApplyFilterBeginEvent,o),b.EXPFilterAppliedEvent=d.addEvent(n.Events.EXPFilterAppliedEvent,a),b.EXPLoadingFailureEvent=d.addEvent(n.Events.EXPLoadingFailureEvent,a),b.EXPRemoveFilterBeginEvent=d.addEvent(n.Events.EXPRemoveFilterBeginEvent,o),b.EXPFilterRemovedEvent=d.addEvent(n.Events.EXPFilterRemovedEvent,a),b.EXPRootRemovedEvent=d.addEvent(n.Events.EXPRootRemovedEvent,t),b.EXPAssetChangedEvent=d.addEvent(n.Events.EXPAssetChangedEvent,t),b.EXPExperienceDisposed=d.addEvent(n.Events.EXPExperienceDisposed,t),b.EXPRefreshEvent=d.addEvent(n.Events.EXPRefreshEvent,()=>{C=!0}),b.EXPRefreshBeginEvent=d.addEvent(n.Events.EXPRefreshBeginEvent,()=>{C||o()}),b.EXPRefreshCompletedEvent=d.addEvent(n.Events.EXPRefreshCompletedEvent,()=>{C?C=!1:a()})}v.setActiveFlag(!0)}()}}});