define("DS/ENOGantt/Infra",["UWA/Class","DS/Foundation2/FoundationV2Data","DS/E6WCommonUI/UIHelper","DS/ENOGantt/URLStore","DS/ENOGantt/Ven/Ext","DS/ENOGantt/Ven/Bryntum","DS/ENOProjectMgmtModels/Models/FieldsDefinition","DS/ENOGantt/Nls/Eno/"+window.languageGlobalVar,"DS/ENOGantt/Nls/Ext/"+window.languageGlobalVar,"DS/ENOGantt/Nls/Sch/"+window.languageGlobalVar,"DS/ENOGantt/Nls/Gnt/"+window.languageGlobalVar],function(e,t,n,a,r,i,o,l){"use strict";return r.ns("App"),App.Gantt={},App.csrf={name:"",value:""},App.Gantt.filter={fields:{},filterBy:{}},App.Nls=l,e.extend({init:function(e){let t=UWA.clone(e||{},!1),n=t.viewCollection,r=t.contextInfo;enoviaServer.viewId||(enoviaServer.viewId="WBSView");let i=a.getInfraURL();n.getDataModelDetails({model:r,fields:i.fields,include:i.include,customParams:i.customParams,doNotCache:!0}).then(this.handleOnCompleteInfra.bind(this,e))},handleOnCompleteInfra:function(e,t){let n=this;var a=t._attributes;e.viewCollection.getDataModelDetails({refresh:!0,doNotCache:!0,fields:"none,columns",customParams:{viewId:enoviaServer.viewId},model:e.contextInfo}).then(function(r){a.columns=r.get("columns"),n.setupInfra(t,a,e),e.loadWidget()})},setupInfra:function(e,t,i){var l=e._attributes.relelements,s=e._attributes.subTypesInfo[0],E="TRUE"==t.kindofTemplate,I="TRUE"==t.kindofBaseline,d="TRUE"==t.kindofExperiment,p="TRUE"==t.kindofConcept,u="TRUE"==t.modifyAccess,S=(n.isMobile(),!0),m=!0,c=!1,f=!0,A=!1,V={VIEW_WBS:"WBSView",VIEW_ACTUAL:"ActualWBSView",VIEW_PLAN_VERSUS_ACTUAL:"PlannedVsActualView",VIEW_BASELINE_WBS:"ProjectBaselineView",VIEW_BASELINE_VERSUS_CURRENT_BASELINE:"BaselineVsCurrentBaselineView",VIEW_BASELINE_VERSUS_CURRENT_BASELINE2:"BaselineVsCurrentBaselineView2",VIEW_EXPERIMENT_VERSUS_PROJECT:"ExperimentVsProjectView",VIEW_TEMPLATE_WBS:"ProjectTemplateView",VIEW_STATUS_REPORT:"StatusReportViewer"};E?enoviaServer.viewId=V.VIEW_TEMPLATE_WBS:I?(enoviaServer.viewId!=V.VIEW_BASELINE_VERSUS_CURRENT_BASELINE2&&enoviaServer.viewId!=V.VIEW_BASELINE_VERSUS_CURRENT_BASELINE||(c=!0,A=!0),enoviaServer.viewId=V.VIEW_BASELINE_WBS,S=!0):enoviaServer.viewId||(enoviaServer.viewId=V.VIEW_WBS);var _=enoviaServer.viewId;V.VIEW_WBS==_?(S=!u,"Cancel"==t.state&&(S=!0),m=!1,(d||p)&&((t.routeId||"Cancel"==t.experimentProjectState||"Hold"==t.experimentProjectState)&&(S=!0),m=!0)):V.VIEW_TEMPLATE_WBS==_?(S=!u,"Released"!=t.state&&"Obsolete"!=t.state||(S=!0)):V.VIEW_PLAN_VERSUS_ACTUAL==_?(m=!1,c=!0):V.VIEW_BASELINE_VERSUS_CURRENT_BASELINE==_?(m=!1,c=!0):V.VIEW_BASELINE_VERSUS_CURRENT_BASELINE2==_?c=!0:V.VIEW_EXPERIMENT_VERSUS_PROJECT==_?c=!0:V.VIEW_STATUS_REPORT==_&&(m=!1,f=!1);App.Infra={contextInfo:e,ViewId:enoviaServer.viewId,ReadOnly:S,HideView:m,BaselineRequired:c,ToolbarRequired:!0,NameFilterRequired:f,TypeOf:{ProjectTemplate:E,ProjectBaseline:I,Experiment:d},Views:V,routeId:t.routeId,showPercentComplete:!E};var v=t.columns;delete t.columns;var C=this.getColumnsInfo(v),N=C.columns,R=C.columnsIndex;App.Infra.CustomeColumnDataIndex=C.customeColumnDataIndex,App.Infra.customeColumnEditableData=C.customeColumnEditableData,App.Infra.Columns=N,App.Infra.ColumnIndex=R,App.Infra.ExtTaskArray=new Array,App.Infra.expandStatus={},App.Infra.Load={},App.Infra.projectDataElements=t,App.Infra.RootProjectname=t.title,App.Infra.projectRelElements=l,App.Infra.isCustomizedEnvironment=A,App.Infra.DerivativeTypes=s,App.Infra.hasDPMLicense=!1;var T=t.lagCalendar;App.Infra.depLagCalendar="Predecessor Task Calendar"==T?"source":"Project Default Calendar"==T?"project":"target",o.getFieldDefinitionColumn("projects","hasDPMAccess")&&(App.Infra.hasDPMLicense=!0),r.Ajax.request({url:a.getCustomizationFlagURL(),async:!1,success:function(e){var t=JSON.parse(e.responseText.trim());t.isCustomizedEnvironment&&(App.Infra.isCustomizedEnvironment=t.isCustomizedEnvironment)}})},getColumnsInfo:function(e){var t={},n=JSON.parse(e),a={},r=[],i={},o=[];t.customeColumnEditableData=i,t.customeColumnDataIndex=r,t.columns=o;for(let e=0,t=n.length;e<t;e++){if((E=n[e]).customColumn){"datecolumn"==E.xtype&&r.push(E.dataIndex);var l=E.name,s=E.editable;i[l]={isEditable:s,xtype:E.xtype}}null==E.name&&(a[E.text]=e),o.push(E)}a={};for(let e=0,t=o.length;e<t;e++){var E;a[(E=o[e]).name]=e}var I=o[a.Name];if(I.width=350,App.Infra.ViewId!=App.Infra.Views.VIEW_WBS&&App.Infra.ViewId!=App.Infra.Views.VIEW_TEMPLATE_WBS||(I.width=200,I.layout="vbox",I.items=[{id:"filterField",xtype:"textfield",width:"100%",emptyText:App.Nls["emxProgramCentral.Common.Filter"],enableKeyEvents:!0,reference:"filterByName"}]),App.Infra.ViewId!=App.Infra.Views.VIEW_STATUS_REPORT){var d=o[a.Status];d.sortable=!1,d.renderer=function(e,t,n){var a=n.get("Status"),r=App.Nls["emxProgramCentral.Gantt.TaskStatus."+a];if(r)return'<div title="'+r+'" class="status '+a+'">&nbsp;</div>'},t.columnsIndex=a;var p=a.Dependency;o[p].useSequenceNumber=!0,delete o[p].editor}return t}})});