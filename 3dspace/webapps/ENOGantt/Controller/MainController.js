var transientWidget="DS/TransientWidget/TransientWidget";define("DS/ENOGantt/Controller/MainController",["DS/ENOGantt/Ven/Ext","DS/ENOGantt/Controller/Finder","DS/ENOGantt/GanttUtil","DS/ENOGantt/GanttConstants","DS/Foundation2/FoundationV2Data","DS/ENOGantt/URLStore","DS/ENOProjectMgmtCommonComponents/utils/ProjectMgmtCloneModel",transientWidget],function(e,t,n,a,r,o,i,l){"use strict";e.define("DS/ENOGantt/Controller/MainController",{extend:"Ext.app.ViewController",alias:"controller.GanttViewController",control:{"#dpmprojectgantt":{beforetaskresize:"beforetaskresize",beforetaskdrag:"beforetaskdrag",aftertaskresize:"aftertaskresize",taskdrop:"taskdrop",dependencybeforedrag:"dependencybeforedrag",dependencydrop:"dependencydrop",beforedrop:"beforedrop",drop:"drop",selectionchange:"selectionchange",beforeprogressbarresize:"beforeprogressbarresize",afterprogressbarresize:"afterprogressbarresize"},"[reference=ganttTaskCreation]":{click:"showTaskCreationForm"},"[reference=zoomToFit]":{click:"onzoomToFit"},"[reference=undo]":{click:"onUndo"},"[reference=redo]":{click:"onRedo"},"[reference=zoomOut]":{click:"onZoomOut"},"[reference=zoomIn]":{click:"onZoomIn"},"[reference=expandAll]":{click:"onExpandAll"},"#ganttTaskCreation":{click:"showTaskCreationForm"},"#rmbExpandAll":{click:"onExpandAll"},"#expandLevel_1":{click:"onExpandNLevelHandler"},"#expandLevel_2":{click:"onExpandNLevelHandler"},"#expandLevel_3":{click:"onExpandNLevelHandler"},"#expandLevel_4":{click:"onExpandNLevelHandler"},"#expandLevel_5":{click:"onExpandNLevelHandler"},"#expandLevel_all":{click:"onExpandAll"},"[reference=highlightCrit]":{click:"onHighlightCrit"},"[reference=print]":{click:"onPrint"},"[reference=collapseGanttChart]":{click:"onCollapseGanttChart"},"[reference=SaveAll]":{click:"onSave"},"[reference=resetAll]":{click:"onReset"},"[reference=viewDropDown]":{click:"toggleView"},"[reference=showRollUpTask]":{click:"toggleRollUpTaskView"},"[reference=showHidePercentComplete]":{click:"onShowHidePercentComplete"},"[reference=refinement]":{click:"showRefinement"},"[reference=ganttConfiguration]":{click:"showForm"},"[reference=calculateFloatData]":{click:"calculateFloatData"},"[reference=calculateForecastValues]":{click:"calculateForecastValues"},"[reference=promoteSuccessor]":{click:"promoteSuccessor"},"[reference=outdentTask]":{click:"onOutdent"},"[reference=indentTask]":{click:"onIndent"},"#RMB_expandLevel_1":{click:"onExpandNLevelHandler"},"#RMB_expandLevel_2":{click:"onExpandNLevelHandler"},"#RMB_expandLevel_3":{click:"onExpandNLevelHandler"},"#RMB_expandLevel_4":{click:"onExpandNLevelHandler"},"#RMB_expandLevel_5":{click:"onExpandNLevelHandler"},"#RMB_expandLevel_all":{click:"onExpandAll"},"#rmbOpenTaskAction":{click:"openTask"},"#outdentTask":{click:"onOutdent"},"#indentTask":{click:"onIndent"},"#rmbOpenCollabTaskAction":{click:"openTaskinCollabTask"},"[reference=find]":{change:"find"},"[reference=filterByName]":{keyup:"filterByName",specialkey:"filterByName"},"[reference=filter]":{click:"filter"},"[reference=resetFilter]":{click:"resetFilter"},"[reference=hide]":{click:"hide"},"[reference=saveColumnConfiguration]":{click:"saveColumnConfiguration"},"[reference=resetToDefaultColumnConfiguration]":{click:"resetToDefaultColumnConfiguration"}},getGantt:function(){return this.getView()},beforetaskdrag:function(e,t){return"Gnt.model.Project"!==t.get("TaskType")&&(!1!==n.doBasicEditChecks(t)&&(t.isStartDateEditable()&&t.isEndDateEditable()))},beforetaskresize:function(e,t,a,r){return!1!==n.doBasicEditChecks(t)&&n.isValidTaskResize(t,a,r)},beforedrop:function(t,n,a){var r=e.ComponentQuery.query("#dpmprojectgantt")[0].crudManager;if(r.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;r.reject()}if(!0===App.Infra.BaselineRequired)return!1;if("TRUE"!==n.records[0].data.hasEditAccess)return e.MessageBox.alert(App.Nls["emxProgramCentral.TaskDragdrop.NoAccessToDragDrop"]),!1;var o=n.records[0].get("TaskProjectId"),i=a.get("TaskProjectId"),l=a.parentNode.get("EnglishType");if(void 0===o){var s=n.records[0].parentNode.get("EnglishType");o="Task"===s||"Phase"===s||"Gate"===s||"Milestone"===s?n.records[0].parentNode.get("TaskProjectId"):n.records[0].get("parentId")}if(null==i&&"ProjectSpace"!=l&&"ProjectConcept"!=l&&"Experiment"!=l){i=a.get("parentId");var c=a.parentNode.get("EnglishType");i="Task"==c||"Phase"==c||"Gate"==c||"Milestone"==c?a.parentNode.get("TaskProjectId"):a.get("parentId")}return n.records.length>1?(e.MessageBox.alert(App.Nls["emxFramework.Common.PleaseSelectOneItemOnly"]),!1):100===n.records[0].get("PercentDone")?(e.MessageBox.alert(App.Nls["emxProgramCentral.TaskDragdrop.TaskInReviewState"]),!1):100===a.parentNode.get("PercentDone")?(e.MessageBox.alert(App.Nls["emxProgramCentral.TaskDragdrop.ParentTaskInReviewCompleteState"]),!1):i===o&&(void 0!==i||void 0!==o)||(e.MessageBox.alert(App.Nls["emxProgramCentral.TaskDragdrop.CrossProjectDragdrop"]),!1)},drop:function(t,a,r,o,i){var l=e.ComponentQuery.query("#dpmprojectgantt")[0],s=l.crudManager,c=l.getTaskStore();n.getStoreTaskExpandStatus(c);var d=!1,p=s.getChangeSetPackage();if(p.tasks){var g=p.tasks;if(g.updated)for(var m=g.updated,f=0,u=m.length;f<u;f++){var C=m[f];if(C.parentId){var h=c.getModelById(C.parentId).get("PercentDone");if("FALSE"===c.getModelById(C.parentId).data.hasEditAccess){d=!0,e.MessageBox.alert(App.Nls["emxProgramCentral.TaskDragdrop.NoAccessToDragDrop"]);break}if(100===h){d=!0,e.MessageBox.alert(App.Nls["emxProgramCentral.TaskDragdrop.ParentTaskInReviewCompleteState"]);break}}}}d?s.load():(s.transport.sync.params.DragDrop=!0,l.getCrudManager().sync(),l.getCrudManager().commit())},aftertaskresize:function(e,t,n){var a=t.data,r=a.Policy,o=a.Duration;if("Project Review"!=r&&null!=o&&0==o){var i=App.Nls["emxProgramCentral.Common.ValueMustBeAPositiveReal"];return alert(i),void t.reject()}},taskdrop:function(t,n,a){var r=n.data,o=(r.Policy,r.StartDate),i=r.EndDate,l=(r.Duration,r.DurationUnit);if(null==i&&null!=o){var s=r.Duration;l=r.DurationUnit;i=e.Date.add(o,l,s)}1==t.getTaskStore().data.items[0].data.ScheduleBackwards?n.setConstraint("finishnolaterthan",i):n.setConstraint("startnoearlierthan",o)},dependencybeforedrag:function(e,t,a){return n.doBasicEditChecks(t)},dependencydrop:function(t,n,a,r){var o=e.ComponentQuery.query("#dpmprojectgantt")[0].taskStore,i=n.getSourceId(),l=o.getModelById(i);if(null!=l){var s=l.get("Name"),c=l.get("TaskSequenceId"),d=l.get("TaskProjectId");c&&(c=parseInt(c)),n.data.predTaskSeqNumber=c,n.data.predecessorTaskName=s,n.data.predProjectId=d}var p=n.getTargetId(),g=o.getModelById(p);if(null!=g){var m=g.get("Name"),f=g.get("TaskSequenceId"),u=g.get("taskWBS");f&&(f=parseInt(f)),n.data.taskSeqNumber=f,n.data.successorTaskName=m,n.data.taskWBS=u}if(!a)return!1},selectionchange:function(t,n,a){var r=n.length,o=e.getCmp("bbarSelectObjectCount");if(o&&r>0){o.setHidden(!1);var i=App.Nls["emxProgramCentral.Common.Selected"];o.setValue(r+" "+i);let e=this.view.parentView;e&&e.dispatchEvent("onSelectionChange")}else o.setHidden(!0)},beforeprogressbarresize:(t,a,r)=>!App.Infra.TypeOf.ProjectTemplate&&(0!=n.doBasicEditChecks(a)&&("Project Space Hold Cancel"!=e.ComponentQuery.query("#dpmprojectgantt")[0].taskStore.getRoot().childNodes[0].data.Policy&&1!=App.Infra.TypeOf.Experiment)),afterprogressbarresize:function(e,t,n){100===t.data.PercentDone&&t.setReadOnly(!0)},onzoomToFit:function(){var e=this.getGantt(),t=e.timeAxis.mainUnit;e.timeAxis.mainUnit="w",e.zoomToFit(),e.timeAxis.mainUnit=t},onUndo:function(){var t=this.getGantt();if(t.undoManager.undo(),0===t.undoManager.getUndoQueue().length){var n=e.getCmp("tBarActionRedo");n.isDisabled()&&(n.enable(),n.setTooltip(App.Nls["emxProgramCentral.Gantt.Redo"]))}},onRedo:function(){this.getGantt().undoManager.redo()},onZoomOut:function(){var e=this.getGantt();e.zoomKeepsOriginalTimespan=!1,e.zoomOut(),e.zoomKeepsOriginalTimespan=!0},onZoomIn:function(){var e=this.getGantt(),t=e.getTaskStore().data.items[0].getDuration();e.maxZoomLevel=t>=10?16:25,e.getCurrentZoomLevelIndex()==e.maxZoomLevel&&alert(App.Nls["emxProgramCentral.Gantt.maxZoomLevel"]),e.zoomIn()},onExpandAll:function(e,t){var a=this.getGantt();new UWA.Promise(function(t,a){var r;e.scope&&(r=e.scope.rec),n.isReadyToExpand(r,t,0)}).then(function(t){a.setLoading(!1),a.setLoading(App.Nls["emxProgramCentral.Gantt.ExpandingStructure"]),setTimeout(function(){(console.time("expand"),App.Gantt.toolbar||(App.Gantt.toolbar={expandAll:{expanded:!1}}),App.Gantt.toolbar.expandAll.expanded=!0,e.scope)?1===e.scope.rec.data.depth?a.expandAll():a.lockedGrid.getSelectionModel().selected.items[0].expand(!0):a.expandAll();a.setLoading(!1),App.Gantt.toolbar.expandAll.expanded=!1,console.timeEnd("expand"),e.scope&&e.scope.done&&e.scope.done()},50)})},onExpandNLevelHandler:function(e){var t=this.getGantt();new UWA.Promise(function(t,a){var r;if(e.scope){r=e.scope.rec;var o=0;0!=e.level&&(o=r.data.depth-1+e.level),n.isReadyToExpand(r,t,o)}else n.isReadyToExpand(r,t,e.level)}).then(function(a){t.setLoading(!1),t.setLoading(App.Nls["emxProgramCentral.Gantt.ExpandingStructure"]),setTimeout(function(){if(console.time("expand"),App.Gantt.toolbar?App.Gantt.toolbar.expandAll.expanded=!0:App.Gantt.toolbar={expandAll:{expanded:!0}},e.scope){var a=t.lockedGrid.getSelectionModel().selected.items[0];n.selectiveExpandFromRMB(a,e.level)}else n.selectiveExpand(t,e.level);t.setLoading(!1),App.Gantt.toolbar.expandAll.expanded=!1,console.timeEnd("expand"),e.done&&e.done()},100)})},onHighlightCrit:function(t){var n=this.getGantt(),a=n.getSchedulingView();if(t.pressed||t.checked){for(var r,o=(f=e.getCmp("bbarObjectCount")).getValue(),i=App.Infra.Columns,l=!1,s=0,c=i.length;s<c;s++){var d=i[s].columns;if(null!=d){for(var p=0,g=d.length;p<g;p++){if("TotalFloat"==d[p].dataIndex){r=App.Infra.Columns[s].text,l=!0;break}}if(1==l)break}}var m=r.split("(");let t=App.Nls["emxProgramCentral.Gantt.CriticalPath"]+"("+m[1];f.setValue(t+" "+o),n.setLoading(App.Nls["emxProgramCentral.Gantt.ComputingCriticalPath"]||"Computing Critical Path"),setTimeout(function(){a.highlightCriticalPaths(!0),n.setLoading(!1)},50)}else{var f=e.getCmp("bbarObjectCount");a.unhighlightCriticalPaths(!0);var u=App.Nls["emxProgramCentral.Common.Objects"];f.setValue(n.getStore().getRange().length+" "+u)}},onPrint:function(){this.getGantt().print()},onCollapseGanttChart:function(e){if(1==e.hidden)return;var t=this.getGantt();let r=t.parentView;r&&r.dispatchEvent("closePropertyPanel");var o=e.icon,i=enoviaServer.computeUrl("/common/images/"),l=i+"I_HideChart_32.png",s=i+"I_ShowChart_32.png";t.lockedGrid.getWidth()>a.gantt.lockedGrid.width&&o.contains(s)||o.contains("iconActionImportDesignSyncModule.png")?(t.normalGrid.setCollapsed(!1),t.lockedGrid.setWidth(a.gantt.lockedGrid.width),n.enableButtons(a.toolbarBtnListToEnableDisable),e.setIcon(l),e.overflowText=App.Nls["emxProgramCentral.Gantt.Toolbar.CollapseChart"],e.setTooltip(App.Nls["emxProgramCentral.Gantt.Toolbar.CollapseChart"]),e.fireEvent("iconchange",e,s,l)):(t.lockedGrid.setWidth(t.ownerGrid.getWidth()+t.normalGrid.getWidth()),t.normalGrid.collapse(!0),n.disableButtons(a.toolbarBtnListToEnableDisable),e.setIcon(s),e.overflowText=App.Nls["emxProgramCentral.Gantt.Toolbar.ExpandChart"],e.setTooltip(App.Nls["emxProgramCentral.Gantt.Toolbar.ExpandChart"]),e.fireEvent("iconchange",e,l,s))},onSave:function(){var t=this.getGantt();if(t.getCrudManager().sync(),!0===e.getCmp("tBarActionZoomToFit").pressed){var n=t.timeAxis.mainUnit;t.timeAxis.mainUnit="w",t.zoomToFit(),t.timeAxis.mainUnit=n}this.filter()},onReset:function(){var t=this.getGantt();App.Infra.OnReset=!0,t.getCrudManager().reject(),e.ComponentQuery.query("#dpmresourceutilizationpanel")[0].getStore().rejectChanges()},togglePlanView:function(t){if(1!=t.hidden){var n=t.pressed;void 0===n&&(n=t.checked);var a=this.getView(),r=enoviaServer.computeUrl("/common/images/"),o=r+"I_HidePlanActual32.png",i=r+"I_ShowPlanActual32.png";if(App.Infra.ViewId!==App.Infra.Views.VIEW_STATUS_REPORT){var l=a.taskStore.getRoot().childNodes[0].get("scheduleBasedOn"),s=a.getColumns();for(let e=0,t=s.length;e<t;e++)"BaselineDuration"!==s[e].name&&"BaselineStartDate"!==s[e].name&&"BaselineEndDate"!==s[e].name||s[e].setVisible(n),"TotalFloat"!==s[e].name&&"FreeFloat"!==s[e].name||s[e].setVisible(!n),"ExpectedEndDate"===s[e].name&&"Forecast"===l&&s[e].setVisible(n)}if(App.Infra.BaselineRequired=n,a.baselineVisible=App.Infra.BaselineRequired,a.setReadOnly(n),a.getView().refresh(),n){if(a.showBaseline(),App.Infra.ReadOnly=n,enoviaServer.viewId=App.Nls.viewStore[2].viewId,t.setTooltip(App.Nls.viewStore[0].name),t.setIcon(o),null===a.getTaskStore().data.items[0].data.BaselineStartDate&&!1===App.Infra.isCustomizedEnvironment&&alert(App.Nls["emxProgramCentral.Gantt.AlertForForecastCalculation"]),0==App.Infra.isCustomizedEnvironment){for(var c,d=(A=e.getCmp("bbarObjectCount")).getValue(),p=App.Infra.Columns,g=!1,m=0,f=p.length;m<f;m++){var u=p[m].columns;if(void 0!==u){for(var C=0,h=u.length;C<h;C++){if("BaselineDuration"===u[C].dataIndex){c=App.Infra.Columns[m].text,g=!0;break}}if(!0===g)break}}var v=c.split("(");let t=App.Nls["emxProgramCentral.Gantt.Forecast"]+"("+v[1];A.setValue(t+" "+d)}e.getCmp("tBarActionCalculateFloatAndCriticalPath").disable(),e.getCmp("tBarActionRollUpTask").disable()}else{if(a.hideBaseline(),App.Infra.ReadOnly=n,enoviaServer.viewId=App.Nls.viewStore[0].viewId,t.setTooltip(App.Nls.viewStore[2].name),t.setIcon(i),0==App.Infra.isCustomizedEnvironment){var A=e.getCmp("bbarObjectCount"),k=App.Nls["emxProgramCentral.Common.Objects"];A.setValue(a.getStore().getRange().length+" "+k)}e.getCmp("tBarActionCalculateFloatAndCriticalPath").enable(),e.getCmp("tBarActionRollUpTask").enable()}var T=e.ComponentQuery.query("panel#GanttRefinementPanel")[0];T&&T.isVisible()&&(T.hide(),this.showRefinement())}},toggleView:function(t){var a=this;0!=App.Infra.Load.Level?(App.Infra.ViewId==App.Infra.Views.VIEW_STATUS_REPORT&&(App.Infra.LoadStatusActualData=!0),new UWA.Promise(function(t,a){var r=e.ComponentQuery.query("#dpmprojectgantt")[0];n.getStoreTaskExpandStatus(r.taskStore),n.isReadyToExpand(void 0,t,0)}).then(function(e){a.togglePlanView(t)})):a.togglePlanView(t)},changeIcon:function(e,t){var n=enoviaServer.computeUrl("/common/images/")+t;t=n||"";var a=e,r=a.btnIconEl,o=a.icon||"";a.icon=n,t!==o&&(r&&r.setStyle("background-image",t?"url("+t+")":""),a.fireEvent("iconchange",a,o,n))},toggleRollUpTaskView:function(e){if(1!=e.hidden){var t=e.pressed;null==t&&(t=e.checked);var n=this.getView(),a=enoviaServer.computeUrl("/common/images/"),r=a+"I_ShowRollupTask32.png",o=a+"I_HideRollupTask32.png";n.setShowRollupTasks(t),t?(e.setTooltip(App.Nls["emxProgramCentral.Gantt.Toolbar.hideRollUpTasks"]),e.setIcon(o)):(e.setTooltip(App.Nls["emxProgramCentral.Gantt.Toolbar.showRollUpTasks"]),e.setIcon(r))}},showRefinement:function(){var t=e.ComponentQuery.query("panel#GanttRefinementPanel")[0];t.show(),t.setScrollY(0)},showForm:function(){var t=e.ComponentQuery.query("#dpmprojectgantt")[0];let n=t.parentView;n&&n.dispatchEvent("closePropertyPanel");var a=t.crudManager;if(a.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;a.reject()}var r=e.ComponentQuery.query("#ganttConfigPanel")[0];r.reset(),r.show();for(var o=t.getPlugins(),i=0,l=o.length;i<l;i++){if("RMBMenu"===o[i].id){o[i].disable();break}}},showTaskCreationForm:function(){var t=e.ComponentQuery.query("#dpmprojectgantt")[0];let a=t.parentView;a&&a.dispatchEvent("closePropertyPanel");var r=t.crudManager;if(r.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;r.reject()}var i=e.ComponentQuery.query("#ganttTaskCreationPanel")[0],l=t.lockedGrid.getSelectionModel().selected.items;if(0===l.length)alert(App.Nls["emxFramework.Common.PleaseSelectitem"]);else if(1!==l.length)alert(App.Nls["emxFramework.Common.PleaseSelectOneItemOnly"]);else{var s=n.getGanttItem(i,"insertradio");!n.isValidAddSubTask(l[0])||l[0].isMilestone()&&l[0].isLeaf()?(s.items.items[1].disable(!0),s.items.items[0].enable(!0),s.items.items[0].setValue(!0)):n.isValidAddTaskAbove(l[0])?(s.items.items[0].enable(!0),s.items.items[1].enable(!0),s.items.items[1].setValue(!0)):(s.items.items[0].disable(!0),s.items.items[1].enable(!0),s.items.items[1].setValue(!0));var c=l[0].data.ConstraintType,d=t.taskStore.getRoot().childNodes[0];if(""!=c||"ProjectSpace"!=l[0].data.EnglishType&&"ProjectConcept"!=l[0].data.EnglishType&&"Experiment"!=l[0].data.EnglishType||(c="As Late As Possible"==l[0].data.defaultConstraintType?"aslateaspossible":"assoonaspossible"),""!==c)n.getGanttItem(i,"constrainttype").setValue(c);else if("Project Finish Date"===d.get("ScheduleFrom")){n.getGanttItem(i,"constrainttype").setValue("aslateaspossible")}var p=o.getSubTypePolicyAndBadcharsURL();r.viewCollection.getDataModelDetails({model:App.Infra.contextInfo,fields:p.fields,include:p.include,customParams:p.customParams,donotPersist:!0,doNotCache:!0,refresh:!0}).then(function(e){g(JSON.parse(JSON.stringify(e)))});var g=function(t){App.Infra.PoliciesAndTypes=t.subTypesAndPolicies[0];var a=App.Infra.PoliciesAndTypes.gateMilestoneTypes,r=a.substr(1,a.length-2).split(", ");App.Infra.PoliciesAndTypes.gateMilestoneTypes=r;var o=e.create("Ext.data.Store",{fields:["abbr","name"],data:function(){var e=new Array,t=App.Infra.PoliciesAndTypes.AllTypes,n=t.substr(1,t.length-2).split(","),a=n.length;for(idx=0;idx<a;idx++){var r=n[idx].trim(),o=App.Nls["emxProgramCentral.Type."+r];null==o&&(o=r),e.push({abbr:r,name:o})}return e}()});e.getCmp("type").bindStore(o);var i=e.ComponentQuery.query("#ganttTaskCreationPanel")[0];n.getGanttItem(i,"type").setValue("Task"),n.getGanttItem(i,"duration").durationUnit="d","Manual"===App.Infra.PoliciesAndTypes.schedule&&(e.getCmp("constrainttype").setHidden(!0),e.getCmp("constraintdate").setHidden(!0)),i.show(),i.setScrollY(0),e.getCmp("tBarganttConfiguration").disable()};window.isODTRunning&&(this.type,method="GET",e.Ajax.request({url:URL,method:method,async:!1,success:function(e){e=JSON.parse(e.responseText.trim()),g(e)}}))}},openTaskinCollabTask:function(e){if(e.scope){var t={ids:e.scope.rec.getId(),x3dPlatformId:window.widget.getValue("x3dPlatformId")};l.showWidget("ENOTASK_AP","",t)}},openTask:function(e){this.getGantt();if(e.scope){var t=e.scope.rec.getId();t.indexOf("_")>=0&&(t=t.split("_")[0]);var n="../../common/emxNavigator.jsp?physicalId="+t;window.isIFWE&&(n=enoviaServer.computeUrl("/common/emxNavigator.jsp?physicalId=")+t),window.open(n)}},resetCache:function(){if(App.Gantt.filter.filterBy)for(var e in App.Gantt.filter.filterBy)"Name"!==e&&delete App.Gantt.filter.filterBy[e]},resetFilter:function(){if(this.getView().reset(),enoviaServer.resetRefinement=!0,this.resetCache(),this.filter(),0==e.Object.getSize(App.Gantt.filter.filterBy)){var t=e.ComponentQuery.query("#tBarActionRefine")[0];this.changeIcon(t,"iconActionFilter.png")}},hide:function(){this.getView().hide()},filter:function(){var t=e.ComponentQuery.query("panel#GanttRefinementPanel")[0],n=["PercentDone","Duration","BaselineDuration","TotalFloat","FreeFloat","Deviation"],a=t.getValues(),r=App.Gantt.filter.fields;for(var o in this.resetCache(),a)if(App.Gantt.filter.filterBy){var i=a[o],l=!1;if(i instanceof Array){if(""!=i.join(""))if(n.includes(o))for(var s=0,c=t.items.items.length;s<c;s++){if("cid"+o==t.items.items[s].id){var d=t.items.items[s].items.items[0];d.minValue.toString()==i[0]&&d.maxValue.toString()==i[1]?l=!1:(l=!0,i=i.join("@"));break}}else""!=i.join("")&&("datefield"==r[o].fieldDataType?(l=!0,i[0]=i[0]+"#"+e.getCmp(o+"_from_date").getValue(),i[1]=i[1]+"#"+e.getCmp(o+"_to_date").getValue(),i=i.join("@")):(l=!0,i=i.join("@")))}else i+""==""&&"Symbol"!=o&&"Pattern"!=o&&"Color"!=o||(l=!0);if(l)if(App.Gantt.filter.filterBy[o]){var p=App.Gantt.filter.filterBy[o];p=p+"@"+i.toString(),App.Gantt.filter.filterBy[o]=p}else App.Gantt.filter.filterBy[o]=i.toString()}var g=App.Gantt.filter.filterBy;g&&Object.keys(g).length>0?this.getView().store.filterTreeBy():(this.getView().store.clearTreeFilter(),App.Gantt.filter.filterBy={});var m=e.ComponentQuery.query("#tBarActionRefine")[0];e.Object.getSize(App.Gantt.filter.filterBy)>0?this.changeIcon(m,"iconActionFiltersApplied.png"):e.Object.isEmpty(App.Gantt.filter.filterBy)&&this.changeIcon(m,"iconActionFilter.png")},filterByName:function(t,n){n.getKey()===n.ESC&&(delete App.Gantt.filter.filterBy.Name,t.reset());var a=t.getValue();if(a.length>0){App.Gantt.filter.filterBy.Name=a,this.getGantt().getTaskStore().filterTreeBy();var r=e.ComponentQuery.query("#tBarActionRefine")[0];this.changeIcon(r,"iconActionFiltersApplied.png")}else if(delete App.Gantt.filter.filterBy.Name,this.getGantt().getTaskStore().filterTreeBy(!0),0==e.Object.getSize(App.Gantt.filter.filterBy)){r=e.ComponentQuery.query("#tBarActionRefine")[0];this.changeIcon(r,"iconActionFilter.png")}},find:function(n,a,r){var o=this.getView(),i=o.getTaskStore();n.focus(!1);var l=this;this.finder=new t({field:n,view:o,store:i,newValue:a,oldValue:r}),e.Function.defer(function(){0!=App.Infra.Load.Level?l.finder.ExpandAndFind(l,!1):l.finder.find(!1,!1)},500)},clear:function(e){e.focus(!1),this.finder.reset()},previous:function(e){e.focus(!1);this.finder.find(!0,!0)},next:function(e){e.focus(!1);this.finder.find(!1,!0)},calculateFloatData:function(){var t=this.getGantt();let n=t.crudManager,a=n.viewCollection;if(n.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;t.getCrudManager().reject()}var r=o.getFloatValuesURL();a.getDataModelDetails({model:App.Infra.contextInfo,fields:r.fields,include:r.include,customParams:r.customParams,donotPersist:!0,refresh:!0}).then(function(e){i(JSON.parse(JSON.stringify(e)))}),t.setLoading(!1),t.setLoading(App.Nls["emxProgramCentral.Gantt.CalculatingRollUp"]);var i=function(t){for(var n=e.ComponentQuery.query("#dpmprojectgantt")[0],a=n.getTaskStore(),r=t.getFloatValues,o=App.Infra.Columns,i=0,l=r.length;i<l;i++){var s=r[i],c=s.id;if("Last Modified"==c){var d=!1;for(let e=0,t=o.length;e<t;e++){var p=o[e].columns;if(null!=p){for(let t=0,n=p.length;t<n;t++){if("TotalFloat"==p[t].dataIndex){o[e].text=s.lastModified,d=!0;break}}if(1==d)break}}}else{var g=s.totalFloat,m=s.freeFloat,f=a.getModelById(c);f&&(f.set("TotalFloat",g),f.set("FreeFloat",m))}}n.crudManager.commit(),n.setLoading(!1)}},calculateForecastValues:function(){var t=this.getGantt();let n=t.crudManager,a=n.viewCollection;if(n.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;t.getCrudManager().reject()}var r=o.getCalculateForecastValuesURL();a.getDataModelDetails({model:App.Infra.contextInfo,fields:r.fields,include:r.include,customParams:r.customParams,donotPersist:!0,refresh:!0}).then(function(e){i(JSON.parse(JSON.stringify(e)))}),t.setLoading(!1),t.setLoading(App.Nls["emxProgramCentral.Gantt.CalculatingForecast"]);var i=function(t){for(var n=e.ComponentQuery.query("#dpmprojectgantt")[0],a=n.getTaskStore(),r=t.getForecastValues,o=App.Infra.Columns,i=0,l=r.length;i<l;i++){var s=r[i],c=s.id;if("Last Modified"==c){var d=!1;for(let e=0,t=o.length;e<t;e++){var p=o[e].columns;if(null!=p){for(let t=0,n=p.length;t<n;t++){if("BaselineDuration"==p[t].dataIndex){o[e].text=s.forecastUpdatedOn,d=!0;break}}if(1==d)break}}}else{var g=s.forecastStartDate,m=s.forecastFinishDate,f=s.forecastDuration,u=s.EstStartDate,C=s.EstFinishDate,h=s.EstDuration,v=a.getModelById(c);v&&(v.set("BaselineStartDate",g),v.set("BaselineEndDate",m),v.set("BaselineDuration",f),v.set("StartDate",u),v.set("EndDate",C),h.includes("d")&&v.set("Duration",h))}}n.crudManager.commit(),n.setLoading(!1)}},promoteSuccessor:function(){var t=this.getGantt();if(t.crudManager.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;t.getCrudManager().reject()}var n="/resources/v1/modeler/projects/"+enoviaServer.physicalId+"?$indexBasedImages=false&$include=none,promoteSuccessor";t.setLoading(!1),t.setLoading({msg:App.Infra.LoadText||t.L("loadingText")});r.ajaxRequest({url:n,type:"GET",dataType:"json",callback:function(t){for(var n=e.ComponentQuery.query("#dpmprojectgantt")[0],a=n.getTaskStore(),r=t.data[0].relateddata.promoteSuccessor,o=(App.Infra.Columns,0),i=r.length;o<i;o++){var l=r[o],s=l.id,c=l.dataelements.state,d=a.getModelById(s);d&&d.set("State",App.Nls[c])}n.crudManager.commit(),n.setLoading(!1)}})},onOutdent:function(){var t=e.ComponentQuery.query("#dpmprojectgantt")[0],a=t.crudManager;if(a.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;a.reject()}var r=t.lockedGrid.getSelectionModel().selected.items,o=!0;if(r.length>0&&0==(r=n.isValidTaskIndentation(r,!0)).length&&(o=!1),o){var i=e.Array.filter(r,function(e){return!e.isReadOnly()});t.getTaskStore().outdent(i,function(e,r){a.transport.sync.params.LeftIndent=!0,n.getStoreTaskExpandStatus(t.getTaskStore()),a.sync(),a.commit()})}},onIndent:function(){var t=e.ComponentQuery.query("#dpmprojectgantt")[0],a=t.crudManager;if(a.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;a.reject()}var r=t.lockedGrid.getSelectionModel().selected.items,o=!0;if(r.length>0&&0==(r=n.isValidTaskIndentation(r,!1)).length&&(o=!1),o){var i=e.Array.filter(r,function(e){return e.previousSibling&&!e.previousSibling.isReadOnly()});t.getTaskStore().indent(i,function(e,r){a.transport.sync.params.RightIndent=!0,n.getStoreTaskExpandStatus(t.getTaskStore()),a.sync(),a.commit()})}},onShowHidePercentComplete:function(){App.Infra.showPercentComplete=!App.Infra.showPercentComplete;var t=e.getCmp("tBarActionShowHidePercentComplete");1==App.Infra.showPercentComplete?t.setTooltip(App.Nls["emxProgramCentral.Gantt.Toolbar.HidePercentComplete"]):t.setTooltip(App.Nls["emxProgramCentral.Gantt.Toolbar.ShowPercentComplete"]);for(var n=e.ComponentQuery.query("#dpmprojectgantt")[0],a=n.getSchedulingView(),r=n.taskStore.toArray(),o=1,i=r.length;o<i;o++)a.columnRenderer(null,null,r[o]);a.refreshView()},saveColumnConfiguration:function(t){var a,r=e.ComponentQuery.query("#dpmprojectgantt")[0],l=App.Nls["emxProgramCentral.Gantt.ColumnConfig.SaveColumnConfigurationMessage"];if(1==t?(a={columnconfig:{resetToDefault:"true"}},l=App.Nls["emxProgramCentral.Gantt.ColumnConfig.ResetToDefaultColumnConfigurationMessage"]):(App.Infra.isColumnReordered&&1==App.Infra.isColumnReordered&&n.cacheColumnIndex(),a={columnconfig:App.Infra.ColumnConfig}),void 0===a.columnconfig||""==a.columnconfig||"{}"==a.columnconfig)return l=App.Nls["emxProgramCentral.Gantt.ColumnConfig.NothingToSaveColumnConfigurationMessage"],void alert(l);let s=App.Infra.contextInfo;s.set({ganttConfig:JSON.stringify(a)});let c=o.getGanttConfigURL(),d=new i(s);r.crudManager.viewCollection.processSaveDataModel(d,{fields:c.fields,include:c.include,donotShowMessage:!window.Widget,isNew:!1,customParams:c.customParams,onComplete:function(e){App.Infra.ColumnConfig="",App.Infra.isColumnReordered=!1,alert(l)},onFailure:function(e){alert(App.Nls["emxProgramCentral.Gantt.ColumnConfig.FailureSaveColumnConfigurationMessage"])}})},resetToDefaultColumnConfiguration:function(){this.saveColumnConfiguration(!0)}})});