define("DS/ENOGantt/View/GanttPlugins",["UWA/Core","UWA/Class","DS/ENOGantt/Ven/Ext","DS/ENOGantt/Ven/Bryntum","DS/PlatformAPI/PlatformAPI","DS/Foundation2/FoundationV2Data","DS/ENOGantt/View/Toolbar","DS/ENOGantt/View/GanttRefinement","DS/ENOGantt/Controller/MainController","DS/ENOGantt/GanttUtil","DS/ENOGantt/Custom/DPMGanttAll","DS/ENOGantt/GanttConstants","DS/ENOGantt/Data/ResponseUtil","DS/ENOGantt/URLStore","DS/ENOGantt/Custom/CustomPattern","DS/ENOGantt/Ven/Ux","css!DS/Sencha/packages/ux/classic/triton/resources/ux-all.css"],function(e,t,n,a,r,o,i,s,d,l,c,p,u,m,g,f){var h=l.getDateFormat();cpnl=this;var C=p.actionType,k="",A=t.extend({getPlugins:function(){return k=enoviaServer.computeUrl("/common/images/"),cpnl.getGanttPlugin()}});return this.getGanttPlugin=function(e){var t=[];t.push(this.getPrintablePlugin());var n=this.getTaskContextMenuPlugin(e);if(t.push(n),App.Infra.ViewId==App.Infra.Views.VIEW_WBS||App.Infra.ViewId==App.Infra.Views.VIEW_TEMPLATE_WBS){var a=this.getTaskEditor(e);t.push(a),t.push(this.getDependencyEditor(e));var r=this.getCellEditorPlugin(e);t.push(r);var o=this.getProgressLinePlugin();t.push(o);var i=this.getProjectEditorPlugin(e);t.push(i)}return t},this.getDependencyEditor=function(e){return n.define("DS.ENOGantt.plugin.DependencyEditor",{extend:"Gnt.plugin.DependencyEditor",id:"dependencyEditor",showLag:!0,constrain:!0,show:function(e,t){for(var a=n.ComponentQuery.query("#dpmprojectgantt")[0],r=e.getTargetTask(a.taskStore),o=r.predecessors,i=new Array,s=0;s<o.length;s++)i.push(o[s].data.From);var d=i.filter(function(e,t){return i.indexOf(e)!=t});isReadOnly=!1,d.length>0?isReadOnly=!0:isReadOnly=r.isReadOnly(),isReadOnly||this.callParent(arguments)},doSave:function(){var e=this,t=e.getForm().getValues();if(delete t[e.fromLabel.name],delete t[e.toLabel.name],e.lagField){var n=e.lagField.getDurationValue()||{value:0,unit:""};if("h"===n.unit||"d"===n.unit)t[e.model.lagField]=n.value,t[e.model.lagUnitField]=n.unit;else{var a=e.getForm()._record.data.Lag,r=e.getForm()._record.data.LagUnit,o=App.Nls["emxProgramCentral.Gantt.InvalidLagUnit"];alert(o),t[e.model.lagField]=a,t[e.model.lagUnitField]=r}}e.dependencyRecord.set(t)}}),n.create("DS.ENOGantt.plugin.DependencyEditor")},this.getPrintablePlugin=function(){return n.define("DS.ENOGantt.View.GanttPanel.Plugin.Printable",{extend:"Gnt.plugin.Printable",defaultExporter:"singlepage",showExportDialog:function(){for(me=this,me.callParent(arguments),activeDialog=this.getActiveExportDialog(),form=activeDialog.form.getForm(),fields=form.getFields(),fieldSize=fields.length,idx=0;idx<fieldSize;idx++)field=fields.getAt(idx),fieldName=field.getName(),"range"==fieldName?(store=field.getStore(),store.removeAt(3),store.removeAt(1)):"rowsRange"==fieldName?field.hide():"format"==fieldName?field.hide():"orientation"==fieldName&&field.hide()},buildExporters:function(){return["Gnt.plugin.exporter.SinglePage"]}}),n.create("DS.ENOGantt.View.GanttPanel.Plugin.Printable")},this.getTaskEditor=function(e){var t=cpnl.getPredecessorGrid(),a=cpnl.getSuccessorGrid(),r=cpnl.getTaskNotesArea();return n.create("Gnt.plugin.TaskEditor",{id:"taskEditor",reference:"taskEditor",height:350,taskFormClass:cpnl.getTaskForm(),showNotes:!1,showAdvancedForm:!1,showAssignmentGrid:!1,showDependencyGrid:!1,taskFormConfig:{effortConfig:{hidden:!0},showBaseline:!1},panelConfig:{items:[{title:App.Nls["emxProgramCentral.Gantt.TaskEditor.Predecessors"],items:t},{title:App.Nls["emxProgramCentral.Gantt.TaskEditor.Successors"],items:a},{title:App.Nls["emxProgramCentral.Common.Notes"],items:r}]},listeners:{loadTask:function(e,n){App.Infra.TypeOf.ProjectTemplate&&(e.taskForm.items.items[2].hidden=!0);var o=App.Infra.calendarData;if(o.length>0&&""!=n.data.CalendarId&&null!=n.data.CalendarId)for(var i=0;i<o.length;i++)if(o[i].Id==n.data.CalendarId){e.taskForm.items.items[3].setValue(o[i].name);break}t.loadDependencies(n),t.store.sort("predTaskSeqNumber","ASC"),a.loadDependencies(n),a.store.sort("taskSeqNumber","ASC"),r.setValue(n.getNote())}},buttons:[{text:App.Nls["emxProgramCentral.Common.Close"],reference:"taskEditorClose",style:"border-color:#368EC4;background-color:#368EC4;color:#FFFFFF !important;font-size:14px;",cls:"apply-button-text",handler:function(){this.config.$initParent.ownerCt.close()}}]})},this.getTaskNotesArea=function(){return n.create("Ext.form.field.TextArea",{grow:!0,anchor:"100%",width:"100%",height:210,readOnly:!0})},this.getPredecessorGrid=function(){return n.define("PredecessorGrid",{extend:"Gnt.widget.DependencyGrid",readOnly:!1,height:220,scrollable:!0,tbar:[],buildColumns:function(){var e=this.callParent(arguments);return e[0].renderer=function(e,t,n){return n.get("predTaskSeqNumber")},e[0].getSortParam=function(){return"predTaskSeqNumber"},e[1].renderer=function(e,t,n){return n.get("predecessorTaskName")},e[1].getSortParam=function(){return"predecessorTaskName"},e[2].sortable=!1,e[1].editor=!1,e[2].editor=!1,e[3].editor=!1,e[3].sortable=!1,e}}),n.create("PredecessorGrid")},this.getSuccessorGrid=function(){return n.define("SuccessorGrid",{extend:"Gnt.widget.DependencyGrid",readOnly:!1,direction:"successors",height:220,scrollable:!0,tbar:[],buildColumns:function(){var e=this.callParent(arguments);return e[0].renderer=function(e,t,n){return n.get("taskSeqNumber")},e[0].getSortParam=function(){return"taskSeqNumber"},e[1].renderer=function(e,t,n){return n.get("successorTaskName")},e[1].getSortParam=function(){return"successorTaskName"},e[2].sortable=!1,e[1].editor=!1,e[2].editor=!1,e[3].editor=!1,e[3].sortable=!1,e},loadDependencies:function(e){if(1!=enoviaServer.loadSucessor){var t=this;if(e=e||this.task){var r;if(this.task!==e&&this.setTask(e),"predecessors"===this.direction)r=e.getIncomingDependencies(!0),this.oppositeStore||(this.oppositeData=e.getOutgoingDependencies(!0));else{r=e.getOutgoingDependencies(!0);var o=n.ComponentQuery.query("#dpmprojectgantt")[0],i=[];if(o.crudManager.hasChanges())for(var s=o.dependencyStore.getRemovedRecords(),d=0,c=s.length;d<c;d++)i.push(s[d].data.Id);for(var p=r.length,u=m.getSuccesorTaskInfoURL(e.id,e.data.Name,e.data.TaskSequenceId,e.data.TaskProjectId,p),g=l.syncAjaxCall(u,"GET"),f=[],h=e.getDependencyStore(),C=(d=0,g.length);d<C;d++){var k=g[d];if(!(h.getModelById(k.Id)||i.indexOf(k.Id)>=0)){var A=new h.model;A.id=k.Id,A.data.Id=k.Id,A.data.From=k.From,A.data.To=k.To,A.data.Type=k.type,A.data.Lag=k.Lag,A.data.LagUnit=k.LagUnit,A.data.predTaskSeqNumber=k.predTaskSeqNumber,A.data.taskSeqNumber=k.taskSeqNumber,A.data.predecessorTaskName=k.predecessorTaskName,A.data.successorTaskName=k.successorTaskName,A.data.predProjectId=k.taskProjectId,A.data.taskWBS=k.taskWBS,delete A.crudState,delete A.crudStateWas,delete A.phantom,f.push(A)}}f.length>0&&(enoviaServer.loadSucessor=!0,o.dependencyStore.add(f),delete enoviaServer.loadSucessor,o.dependencyStore.commitChanges(),r=e.getOutgoingDependencies(!0)),this.oppositeStore||(this.oppositeData=e.getIncomingDependencies(!0))}var T=a.util.Data.cloneModelSet(r,function(e){var n=e.isValid;e.isValid=function(){return n.call(this,!1)&&t.isValidDependency(this)}});this.store.loadData(T),this.fireEvent("loaddependencies",this,this.store,T,e)}}}}),n.create("SuccessorGrid")},this.getTaskForm=function(){var e=App.Infra.TypeOf.ProjectTemplate;return n.define("MyTaskForm",{extend:"Gnt.widget.taskeditor.TaskForm",percentDoneConfig:{hidden:e,readOnly:!0,forceReadOnly:!0,editor:null},nameConfig:{readOnly:!0,forceReadOnly:!0,editor:null},durationConfig:{readOnly:!0,forceReadOnly:!0,editor:null},startConfig:{hidden:e,readOnly:!0,forceReadOnly:!0,format:h,editor:null},finishConfig:{hidden:e,readOnly:!0,forceReadOnly:!0,format:h,editor:null},scrollable:!1,constructor:function(e){this.callParent(arguments),this.add({fieldLabel:App.Nls["emxProgramCentral.Gantt.Calendar"],name:"CalendarField",readOnly:!0,forceReadOnly:!0,editor:null})}})},this.getProjectForm=function(){var e=App.Infra.TypeOf.ProjectTemplate;return n.define("MyProjectForm",{extend:"Gnt.widget.taskeditor.ProjectForm",nameConfig:{readOnly:!0,forceReadOnly:!0,editor:null},startConfig:{hidden:e,readOnly:!0,forceReadOnly:!0,format:h,editor:null},finishConfig:{hidden:e,readOnly:!0,forceReadOnly:!0,format:h,editor:null},schedulebackwardsConfig:{readOnly:!0,forceReadOnly:!0},readOnlyConfig:{hidden:!0},allowDependenciesConfig:{hidden:!0},scrollable:!1,constructor:function(e){this.callParent(arguments),this.add({fieldLabel:App.Nls["emxProgramCentral.Gantt.Calendar"],name:"CalendarField",readOnly:!0,forceReadOnly:!0,editor:null})}})},this.getCellEditorPlugin=function(){return n.create("Sch.plugin.TreeCellEditing",{clicksToEdit:2,id:"CellEditorPlugin",listeners:{beforeEdit:function(e,t,n){var a=t.field;if("Dependency"==a){for(var r=t.record.predecessors,o=t.record.data.ExternalDependencies,i=new Array,s=0;s<r.length;s++)i.push(r[s].data.From);for(var d=0;d<o.length;d++)i.push(o[d].From);if(i.filter(function(e,t){return i.indexOf(e)!=t}).length>0)return!1}"PercentDone"==a&&("Gate"===t.record.data.EnglishType||"Milestone"===t.record.data.EnglishType?t.column.editor.step=100:t.column.editor.step=10),t.originalValue,t.value},edit:function(e,t,n){t.record.modified&&cpnl.processCellEdit(e,t,n)},validateEdit:function(e,t,n){if(t.record.modified){t.record.modified.Duration;var a=t.record.modified.DurationUnit;if(null!=a&&null!=a){var r=t.record.data.DurationUnit;if("h"!=r&&"d"!=r){t.record.data.DurationUnit=t.record.modified.DurationUnit;var o=App.Nls["emxProgramCentral.Common.InvalidDuration"];alert(o)}}}if(t.originalValue!==t.value){var i=t.record,s=t.field,d=t.value;if("Dependency"==s)l.validateDependency(i,d)||(t.cancel=!0);else if("Name"==s){if(""!=d)l.validateBadNameChar(d)||(t.cancel=!0);else t.cancel=!0}}}}})},this.processCellEdit=function(e,t,n){var a={},r=t.record,o=t.field,i=t.value;t.column.customColumn;if("Dependency"==o)""!=i&&(i=l.parseDependencyString(i).actualValue),r.set("Dependency",i),a.isInlineEdit=!0,a.dependencyVal=i;else if("StartDate"==o)console.log("START DATE CHANGED.........."),a.isStartDateEdited=!0,r.setStartDate(i),1==r.getProjectScheduleBackwards()?r.setConstraint("startnolaterthan",i):r.setConstraint("startnoearlierthan",i);else if("EndDate"==o){console.log("END DATE CHANGED.........."),a.isFinishDateEdited=!0,r.setEndDate(i),1==r.getProjectScheduleBackwards()?r.setConstraint("finishnolaterthan",i):r.setConstraint("finishnoearlierthan",i)}else"Duration"==o?r.setDuration(parseFloat(i)):"PercentDone"==o&&(r.setPercentDone(parseFloat(i)),100===i&&r.setReadOnly(!0))},this.getProgressLinePlugin=function(){return{ptype:"gantt_progressline",disabled:!0}},this.getProjectEditorPlugin=function(e){return n.create("Gnt.plugin.ProjectEditor",{id:"projectEditor",reference:"projectEditor",height:350,projectFormClass:cpnl.getProjectForm(),showDescription:!1,listeners:{loadproject:function(e,t){App.Infra.TypeOf.ProjectTemplate&&(e.projectForm.items.items[2].hidden=!0);var n=App.Infra.calendarData;if(n.length>0&&""!=t.data.CalendarId&&null!=t.data.CalendarId)for(var a=0;a<n.length;a++)if(n[a].Id==t.data.CalendarId){e.projectForm.items.items[4].setValue(n[a].name);break}}},buttons:[{text:App.Nls["emxProgramCentral.Common.Close"],reference:"projectEditorClose",style:"border-color:#368EC4;background-color:#368EC4;color:#FFFFFF !important;font-size:14px;",cls:"apply-button-text",handler:function(){this.config.$initParent.ownerCt.close()}}]})},this.getTaskContextMenuPlugin=function(e){var t=new Array,a=n.ComponentQuery.query("#RMBMenu")[0];return null!=a&&a.destroy(),n.create("Gnt.plugin.TaskContextMenu",{id:"RMBMenu",taskEditorInjected:!0,createMenuItems:function(){var e={requiresTask:!0,id:"rmbOpenTaskAction",text:App.Nls["emxProgramCentral.Common.OpenInNewTab"],isValidAction:this.isValidForOpenInNewTab,icon:k+"iconActionOpenShortcuts.png",iconCls:"tBarIcon",itemId:"rmbOpenTaskAction",scope:this};if(App.Infra.ViewId==App.Infra.Views.VIEW_STATUS_REPORT)return t.push(e),t;var n=cpnl.getOpenInCTRMBConfig(this),a=cpnl.getExpandNLevelRMBConfig(this),r=cpnl.getExpandAllRMBConfig(this),o=cpnl.getCreateTaskRMBConfig(this),i=cpnl.indentLeft(this),s=cpnl.indentRight(this),d=(cpnl.getAddTaskRMBConfig(this),cpnl.getAddGateRMBConfig(this),cpnl.getAddMilestoneRMBConfig(this),cpnl.getAddPhaseRMBConfig(this),cpnl.getRemoveRMBConfig(this)),l=cpnl.getDeleteRMBConfig(this),c=cpnl.getColorMenuRMBConfig(this),p=cpnl.getPatternMenuRMBConfig(this),u=cpnl.getSymbolMenuRMBConfig(this),m=cpnl.getManageResourceRMBConfig(this);return(App.Infra.ViewId==App.Infra.Views.VIEW_WBS||App.Infra.ViewId==App.Infra.Views.VIEW_TEMPLATE_WBS&&0==App.Infra.ReadOnly)&&(window.isIFWE&&t.push(n),t.push(e),t.push({xtype:"menuseparator"}),t.push(o),t.push(i),t.push(s),t.push(d),t.push(l),t.push(c),t.push(p),t.push(u),App.Infra.ViewId==App.Infra.Views.VIEW_WBS&&(t.push({xtype:"menuseparator"}),t.push(m)),t.push({xtype:"menuseparator"})),1==App.Infra.ReadOnly&&(t.push(e),window.isIFWE&&t.push(n)),t.push(r),t.push(a),t},addOrDeleteTaskHandler:function(e){l.isValidRMBOperation(this.rec,e.id)&&cpnl.syncOnAddRemoveTask(this,e.id)},isTaskAllExpanded:function(e){var t=e.data.EnglishType;return"ProjectSpace"==t||"ProjectConcept"==t||"Experiment"==t||"ProjectTemplate"==t||"ProjectBaseline"==t||"TRUE"===e.data.isSummaryTask},isValidTaskCreation:function(e){return l.isValidAddTaskAbove(e)||l.isValidAddSubTask(e)},isValidAddTaskAbove:function(e){return l.isValidAddTaskAbove(e)},isValidAddSubTask:function(e){return l.isValidAddSubTask(e)},isValidManageResourceAction:function(e){return l.isValidManageResourceAction(e)},isRemoveSubProject:function(e){return l.isValidRemoveSubProject(e)},isValidDeleteTask:function(e){return l.isValidDeleteTask(e)},isValidForColor:function(e,t){return l.isValidForColor(e,t)},isValidForCollabTask:function(e){return l.isValidForCollabTask(e)},isValidForOpenInNewTab:function(e){return l.isValidForOpenInNewTab(e)},isValidForPattern:function(e,t){var n=!1,a=e.get("Symbol");return null!=a&&""!=a||(n=l.isValidForColor(e,t)),n},isValidForSymbol:function(e,t){var n=!1,a=e.get("Pattern");return!e.data.EnglishType||"Gate"!=e.data.EnglishType&&"Milestone"!=e.data.EnglishType||null!=a&&""!=a||(n=l.isValidForColor(e,t)),n}})},this.getOpenInCTRMBConfig=function(e){return{requiresTask:!0,id:"rmbOpenCollabTaskAction",text:App.Nls["emxProgramCentral.Common.OpenInCollabTask"]||"Open in Collaborative Task",icon:k+"iconActionOpenShortcuts.png",iconCls:"tBarIcon",itemId:"rmbOpenCollabTaskAction",scope:e,isValidAction:e.isValidForCollabTask}},this.getResourcePanelContextId=function(){var e=n.ComponentQuery.query("dpmresourceutilizationpanel")[0].context,t="";return e&&(t=e.getId()),t},this.manageResourceHandler=function(e){var t=this,a=n.ComponentQuery.query("#dpmresourceutilizationpanel")[0];a.setLoading(!1),a.setLoading(App.Nls["emxProgramCentral.Gantt.ResourceUtilization.Loading"]),a.columns[0].items.items[0].hidden=!1;var r=n.ComponentQuery.query("#dpmprojectgantt")[0];a.isHidden()&&(a.show(),a.expand()),r.resourceStore.removeAll(),r.assignmentStore.removeAll(),r.taskStore.resourceStore.commitChanges(),r.taskStore.assignmentStore.commitChanges(),App.Infra.ExtTaskArray.length>0&&(r.taskStore.remove(App.Infra.ExtTaskArray),App.Infra.ExtTaskArray=new Array,r.taskStore.commitChanges());var o=e.rec,i=o.getId(),s=o.get("TaskProjectId"),d=r.taskStore.getModelById(s),l=d.get("StartDate").getTime(),c=d.get("EndDate").getTime();"TRUE"!=o.data.changeSOVAccess&&(a.columns[0].items.items[0].hidden=!0),a.context=o,a.contextId=i;var p=App.Nls["emxProgramCentral.Common.ManageResources"]+" : "+a.context.getName();a.setTitle(p),this.data={taskId:i,taskProjectId:s,projectStart:l,projectEnd:c};var g=m.getAssignmentsUrl(i),f=function(e){for(var o=t.data.taskProjectId,i=t.data.projectStart,s=t.data.projectEnd,d=e.assignees,l=d.length,c=[],p=[],m=[],g=0;g<l;g++){var f=d[g];if(f.FirstName=f.firstname,f.LastName=f.lastname,f.Name=f.name,delete f.firstname,delete f.lastname,delete f.name,f.calendar&&f.calendar.length>0){f.hasCalendar=!0;var h=f.calendar[0].id}var C=f.WorkTime;f.WorkTime=C?parseFloat(C)/60:parseFloat("8.0");var k=f.Id;if(""==h||null==h)h="Custom:"+k;f.CalendarId=h,c.push(f);var A=f.Assignments;if(A.length>0)for(var T=A[0],y=(T.contextUser,1);y<A.length;y++){var v=A[y],S=v,D=v.relelements;u.convertToGanttKeyValues(S),u.convertToGanttKeyValues(D);var I=new Date(S.StartDate),P=new Date(S.EndDate),E=u.stdTimezoneOffset(I),x=I.getTimezoneOffset();if(I=I.getTime(),P=P.getTime(),E!==x&&(I+=60*(x-E)*1e3,P+=60*(x-E)*1e3),!(I<i||P>s)){var R={};R.TaskId=S.TaskId;var b=r.taskStore.getModelById(R.TaskId);R.isReadOnly=!1,b&&"TRUE"!=b.data.hasEditAccess&&(R.isReadOnly=!0);var O=v.type;if(T[O]&&(R.icon=T[O]),R.Id=D.Id,R.Units=D.allocation,R.ResourceId=k,S.TaskProjectId==o)R.Type="Internal";else{var M={};R.Type="External",M.Id=S.TaskId,M.Name=S.Name,M.PercentDone=S.PercentDone,M.Duration=S.Duration,S.StartDate&&(S.StartDate=n.Date.format(new Date(S.StartDate),"c")),S.EndDate&&(S.EndDate=n.Date.format(new Date(S.EndDate),"c")),M.StartDate=S.StartDate,M.EndDate=S.EndDate,M.expanded=!0,m.push(M)}p.push(R)}}}var N=r.taskStore.data.items[0],V=m.length;if(V>0)for(var G=0;G<V;G++){var w=m[G],F=w.Id;if(null==r.taskStore.getModelById(F)&&"root"!=w.Name){w.visible=!1,w.Id=F,w.Rollup=!1,w.ReadOnly=!0,w.ExternalTask=!0,w.expanded=!0;var B=n.create("DS.ENOGantt.Data.TaskModel",w),j=B.getDuration(),q=B.getStartDate();App.Infra.ExtTaskArray.push(B),N.addSubtask(B),B.setStartDate(q),B.setDuration(j),N.nextSibling="",r.taskStore.commitChanges()}}p.length;c.length>0&&r.taskStore.resourceStore.add(c),p.length>0&&r.taskStore.assignmentStore.add(p),r.taskStore.resourceStore.commitChanges(),r.taskStore.assignmentStore.commitChanges(),r.taskStore.commitChanges(),r.taskStore.filterBy(function(e){return!e.get("ExternalTask")}),a.setLoading(!1)};if(window.isODTRunning)n.Ajax.request({url:getAssignmentsUrl,async:!1,success:function(e){e=JSON.parse(e.responseText.trim()),f(e)}});else{let e=r.crudManager.viewCollection,t=e.getFieldsAndIncludeParamsForDataModelDetails({}),n=App.Infra.contextInfo.getAllTasks().get(i);e.getDataModelDetails({model:n,fields:t.fields+","+g.fields,include:t.include+","+g.include,customParams:g.customParams,donotPersist:!0,refresh:!0}).then(function(e){f(JSON.parse(JSON.stringify(e)))})}},this.getManageResourceRMBConfig=function(t){var a=t,r=this;return{requiresTask:!0,id:"rmbAssignAction",text:App.Nls["emxProgramCentral.Common.ManageResources"],isValidAction:t.isValidManageResourceAction,icon:k+"iconSmallPerson.png",iconCls:"tBarIcon",handler:function(){var t=n.ComponentQuery.query("#dpmprojectgantt")[0];let o=t.parentView;if(o&&o.dispatchEvent("closePropertyPanel"),t.crudManager.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;t.getCrudManager().reject()}0!=App.Infra.Load.Level?new e.Promise(function(e,t){var a=n.ComponentQuery.query("#dpmprojectgantt")[0];l.getStoreTaskExpandStatus(a.taskStore),l.isReadyToExpand(void 0,e,0)}).then(function(e){r.manageResourceHandler(a)}):r.manageResourceHandler(a)}}},this.getExpandNLevelRMBConfig=function(e){return{itemId:"expandTaskMenu",text:App.Nls["emxProgramCentral.Gantt.ExpandNLevel"],isValidAction:e.isTaskAllExpanded,icon:k+"iconActionSetNodeExpansionLevel.png",iconCls:"tBarIcon",menu:{plain:!0,defaults:{scope:e},items:l.getSelectiveItemArray(5,"RMB_expandLevel_",e.expandNLevelFromRMBHandler,e.expandAllFromRMBHandler)}}},this.getExpandAllRMBConfig=function(e){return{scope:e,id:"rmbExpandAll",itemId:"rmbExpandAll",text:App.Nls["emxProgramCentral.Gantt.ExpandAll"],isValidAction:e.isTaskAllExpanded,icon:k+"iconActionExpandAll.png",iconCls:"tBarIcon"}},this.indentLeft=function(e){return{scope:e,id:"outdentTask",itemId:"outdentTask",text:App.Nls["emxProgramCentral.TaskIndentaion.LeftIndent"],icon:k+"iconLeftIndent.png",isValidAction:e.isValidForColor,iconCls:"tBarIcon"}},this.indentRight=function(e){return{scope:e,id:"indentTask",itemId:"indentTask",text:App.Nls["emxProgramCentral.TaskIndentaion.RightIndent"],icon:k+"iconRightIndent.png",isValidAction:e.isValidForColor,iconCls:"tBarIcon"}},this.getAddTaskRMBConfig=function(e){var t=cpnl.getAddTaskAboveRMBConfig(e),n=cpnl.getAddSubTaskRMBConfig(e);return{text:App.Nls["emxProgramCentral.Common.AddTask"],itemId:"addTaskMenu",icon:k+"iconSmallTask.png",iconCls:"tBarIcon",menu:{plain:!0,defaults:{scope:e},items:[t,n]}}},this.getCreateTaskRMBConfig=function(e){return{scope:e,id:"ganttTaskCreation",itemId:"ganttTaskCreation",text:App.Nls["emxProgramCentral.Common.AddTask"],isValidAction:e.isValidTaskCreation,icon:k+"iconActionCreate.png",iconCls:"tBarIcon"}},this.getAddTaskAboveRMBConfig=function(e){return{handler:e.addOrDeleteTaskHandler,requiresTask:!0,id:C.ADD_TASK_ABOVE,text:App.Nls["emxProgramCentral.Common.InsertTaskAbove"],isValidAction:e.isValidAddTaskAbove,icon:k+"iconActionInsertRowBefore.png",iconCls:"tBarIcon"}},this.getAddSubTaskRMBConfig=function(e){return{handler:e.addOrDeleteTaskHandler,requiresTask:!0,id:C.ADD_SUB_TASK,text:App.Nls["emxProgramCentral.Common.AddSubtaskBelow"],isValidAction:e.isValidAddSubTask,icon:k+"iconActionInsertRowAfter.png",iconCls:"tBarIcon"}},this.getAddGateRMBConfig=function(e){return{handler:e.addOrDeleteTaskHandler,requiresTask:!0,id:C.ADD_GATE,text:App.Nls["emxProgramCentral.Common.AddGate"],isValidAction:e.isValidAddSubTask,icon:k+"iconSmallGate.png",iconCls:"tBarIcon"}},this.getAddMilestoneRMBConfig=function(e){return{handler:e.addOrDeleteTaskHandler,requiresTask:!0,id:C.ADD_MILESTONE,text:App.Nls["emxProgramCentral.Common.AddMilestone"],isValidAction:e.isValidAddSubTask,icon:k+"iconSmallMilestone.png",iconCls:"tBarIcon"}},this.getAddPhaseRMBConfig=function(e){return{handler:e.addOrDeleteTaskHandler,requiresTask:!0,id:C.ADD_PHASE,text:App.Nls["emxProgramCentral.Common.AddPhase"],isValidAction:e.isValidAddSubTask,icon:k+"iconSmallPhase.png",iconCls:"tBarIcon"}},this.getRemoveRMBConfig=function(e){return{handler:e.addOrDeleteTaskHandler,requiresTask:!0,id:C.REMOVE_SUB_PROJECT,text:App.Nls["emxProgramCentral.Common.Remove"],isValidAction:e.isRemoveSubProject,icon:k+"I_Remove22.png",iconCls:"tBarIcon"}},this.getDeleteRMBConfig=function(e){return{handler:e.addOrDeleteTaskHandler,requiresTask:!0,id:C.DELETE,text:App.Nls["emxProgramCentral.Common.Delete"],isValidAction:e.isValidDeleteTask,icon:k+"I_RemoveScenario.png",iconCls:"tBarIcon"}},this.getColorMenuRMBConfig=function(e){var t=p.defaultColorArray,a=new Array;return n.define("DS.ENOGantt.DPMGanttAll.menu.Menu",{override:"Ext.menu.Menu",onMouseOver:function(r){var o=this,i=r.getRelatedTarget(),s=!o.el.contains(i),d=o.getItemFromEvent(r),l=o.parentMenu,c=o.ownerCmp;if(s&&l&&(l.setActiveItem(c),c.cancelDeferHide(),l.mouseMonitor.mouseenter(),l.itemOverTask.cancel()),!o.disabled){if(d){if("changeColor"==d.id){for(var p=n.ComponentQuery.query("#dpmprojectgantt")[0].taskStore,u=p.data.length,m=0;m<u;m++){var g=p.data.items[m].data.Color;-1==t.indexOf(g.toUpperCase())&&-1==a.indexOf(g.toUpperCase())&&""!=g&&a.push(g.toUpperCase())}cpnl.createNewCustomColorPanel(e,a)}"touch"===r.pointerType?o.handleItemOver(r,d):o.itemOverTask.delay(o.expanded?o.mouseLeaveDelay:0,null,null,[r,d])}s&&o.fireEvent("mouseenter",o,r),o.fireEvent("mouseover",o,d,r)}}}),{text:App.Nls["emxProgramCentral.Gantt.ChangeTaskColor"],id:C.CHANGE_COLOR,icon:k+"color_icon.png",iconCls:"tBarIcon",isValidAction:e.isValidForColor,menu:{id:"colorMenu",plain:!0,defaults:{scope:e},width:180,items:[{xtype:"colorpicker",colors:t,allowReselect:!0,width:160,listeners:{select:function(t,n){cpnl.changeColorSelectedItems(n),e.hide()},scope:e}},n.create("Ext.panel.Panel",{id:"customColorPanel",bodyPadding:"5 0 5 0",layout:{type:"auto"},items:[{id:"colorpickerid",xtype:"colorpicker",width:170,colors:a}]}),n.create("Ext.panel.Panel",{id:"buttonPanel",width:120,height:30,bodyPadding:"5 0 5 0",layout:{type:"border"},items:[{region:"west",xtype:"colorbutton",value:void 0,popup:{resizable:!1},listeners:{change:function(e,n,r){r&&(-1==t.indexOf(n.toUpperCase())&&-1==a.indexOf(n.toUpperCase())&&a.push(n.toUpperCase()),cpnl.changeColorSelectedItems(n))}}},{region:"east",id:"clearColorButton",xtype:"button",width:75,text:App.Nls["emxProgramCentral.Gantt.ClearColor"],overflowText:App.Nls["emxProgramCentral.Gantt.ClearColor"],tooltip:App.Nls["emxProgramCentral.Gantt.ClearColor"],textAlign:"center",padding:"0 5 0 5",handler:function(){cpnl.changeColorSelectedItems(""),e.hide()}}]})]}}},this.getPatternMenuRMBConfig=function(e){n.create("DS.ENOGantt.picker.Pattern",{});var t=["diagonal1","diagonal2","diagonal3","diagonal4","pattern1","pattern2","pattern3","pattern4"].concat(g.pattern);return t.length<=20?App.Infra.palleteClass="eno-pattern-picker-20":App.Infra.palleteClass="eno-pattern-picker-40",{text:App.Nls["emxProgramCentral.Gantt.ChangeTaskPattern"],icon:k+"iconActionColorizeGroup.png",iconCls:"tBarIcon",itemId:"changePattern",isValidAction:e.isValidForPattern,menu:{plain:!0,defaults:{scope:e},items:[{xtype:"patternPicker",patterns:t,allowReselect:!0,listeners:{select:function(t,a){for(var r=n.ComponentQuery.query("#dpmprojectgantt")[0].lockedGrid.getSelectionModel().selected.items,o=0,i=r.length;o<i;o++)r[o].set("Pattern",a);e.hide()},scope:e}}],buttons:[{text:App.Nls["emxProgramCentral.Gantt.ClearPattern"],handler:function(){for(var e=n.ComponentQuery.query("#dpmprojectgantt")[0].lockedGrid.getSelectionModel().selected.items,t=0,a=e.length;t<a;t++)e[t].set("Pattern","")}}]}}},this.getSymbolMenuRMBConfig=function(e){n.create("DS.ENOGantt.picker.Symbol",{});return App.Infra.palleteClass="eno-symbol-picker",{text:App.Nls["emxProgramCentral.Gantt.ChangeSymbol"],icon:k+"iconActionColorizeGroup.png",iconCls:"tBarIcon",itemId:"changeSymbol",isValidAction:e.isValidForSymbol,menu:{plain:!0,defaults:{scope:e},items:[{xtype:"symbolPicker",symbols:["circle","concavesquare","ellipse","facetdiamond","heart","pentagon","rhombus","roundedRectangle","shield","star","triangle"],allowReselect:!0,listeners:{select:function(t,a){for(var r=n.ComponentQuery.query("#dpmprojectgantt")[0].lockedGrid.getSelectionModel().selected.items,o=0,i=r.length;o<i;o++)r[o].set("Symbol",a);e.hide()},scope:e}}],buttons:[{text:App.Nls["emxProgramCentral.Gantt.ClearSymbol"],handler:function(){for(var e=n.ComponentQuery.query("#dpmprojectgantt")[0].lockedGrid.getSelectionModel().selected.items,t=0,a=e.length;t<a;t++)e[t].set("Symbol","")}}]}}},this.syncOnAddRemoveTask=function(e,t,a){var r=n.ComponentQuery.query("#dpmprojectgantt")[0],i=r.crudManager,s=new Array,d=r.getTaskStore(),c=i.transport.sync.url,p=e.rec;null==p&&(p=r.lockedGrid.getSelectionModel().selected.items[0]);l.getStoreTaskExpandStatus(d);var g={};if(s.push(t),s.push(g),g=cpnl.preProcessAddRemove(s),C.DELETE==t||C.REMOVE_SUB_PROJECT==t){for(var f="",h=r.lockedGrid.getSelectionModel().selected.items,k=0,A=h.length;k<A;k++)f+=h[k].id+",";var T=this,y={AddRemoveTask:!0};(i=r.crudManager).transport.sync.params.AddRemoveTask=!0;var v=m.getPreDeleteCheckUrl(f);o.ajaxRequest({url:v,type:"GET",dataType:"json",async:!1,callback:function(a){var o=a.data;if(o){for(var p=!0,u=r.lockedGrid.getSelectionModel().selected.items,m={MandExcludeTaskIds:[],TaskIdsWithEffort:[]},f=0;f<o.length;f++){var h=o[f].dataelements,C=o[f].id;h.taskRequirement&&"Mandatory"==h.taskRequirement?m.MandExcludeTaskIds.push(C):h.effortId&&""!=h.effortId&&m.TaskIdsWithEffort.push(C)}if(m.MandExcludeTaskIds.length>0||m.TaskIdsWithEffort.length>0){var k=l.filterBy_Mandatory_Effort_Effectivity(m);0==(u=r.lockedGrid.getSelectionModel().selected.items).length?(alert(k),p=!1):p=confirm(k+" Do you want to continue deleting with other selected tasks?")}if(p){for(var A=T.getResourcePanelContextId(),y=!1,v=new Array,S=(f=0,u.length);f<S;f++)v.push(u[f].id),""!=A&&u[f].id==A&&(y=!0);if(y)n.ComponentQuery.query("#dpmresourceutilizationpanel")[0].collapse();d.removeTasks(u),(!window.ODT||window.ODT&&window.ODT.callSync)&&i.sync(),(s=new Array).push(t),s.push(c),l.isAddTask(t)?s.push(e):l.isDeleteTask(t)&&s.push(g),cpnl.postProcessAddRemove(s)}else i.reject()}}})}else{var S;switch(t){case C.ADD_PHASE:S="Phase";break;case C.ADD_GATE:S="Gate";break;case C.ADD_MILESTONE:S="Milestone";break;default:S="Task"}A=1;null!=a&&(A=parseInt(a.number));for(k=0;k<A;k++){var D=d.model;if(void 0===a){(I=new D({leaf:!0})).set(I.durationField,"1")}else{var I=new D({policy:a.policy,description:a.description,taskRequirement:a.taskRequirement,needsReview:a.needsReview,leaf:!0,deliverablesInheritance:a.deliverablesInheritance}),P=a.duration.split(" ");I.set(I.durationField,P[0]),P[1].indexOf("h")>=0?I.set(I.durationUnitField,"h"):I.set(I.durationUnitField,"d"),I.set(I.nameField,a.name),S=a.type}"Gate"!==S&&"Milestone"!==S||I.set(I.durationField,"1"),I.setPercentDone(0),I.set(I.startDateField,p.getStartDate()),I.set(I.endDateField,p.getEndDate());var E=a.policy;I.set(I.constraintTypeField,a.constrainttype),I.set(I.constraintDateField,u.getFormattedDate(new Date(a.constraintdate)));var x=I.get("ConstraintType"),R=I.get("StartDate"),b=I.get("EndDate");if("muststarton"==x||"startnoearlierthan"==x||"startnolaterthan"==x?I.get("ConstraintDate").setHours(R.getHours()):"mustfinishon"!=x&&"finishnoearlierthan"!=x&&"finishnolaterthan"!=x||I.get("ConstraintDate").setHours(b.getHours()),I.data.DisplayStartDate=p.getStartDate(),I.data.DisplayFinishDate=p.getEndDate(),C.ADD_TASK_ABOVE==t)p.addTaskAbove(I),(y={AddRemoveTask:!0})[O=I.data.PhantomId]={addTaskAbove:!0,type:S,policy:E,selectedTaskId:p.id},i.transport.sync.params.AddRemoveTask=!0,i.transport.sync.params.extraParam=y;else if(null!=a&&"above"==a.insert){p.addTaskAbove(I);var O=I.data.PhantomId;if((y={}).AddRemoveTask=!0,y[O]={addTaskAbove:!0,type:S,policy:E,selectedTaskId:p.id},i.transport.sync.params.AddRemoveTask=!0,null==i.transport.sync.params.extraParam)i.transport.sync.params.extraParam=y;else i.transport.sync.params.extraParam[O]={addTaskAbove:!0,type:S,selectedTaskId:p.id}}else{App.Infra.expandStatus[p.get("Id")]=!0,p.addSubtask(I);O=I.data.PhantomId;if((y={}).AddRemoveTask=!0,y[O]={addTaskAbove:!1,type:S,policy:E},i.transport.sync.params.AddRemoveTask=!0,null==i.transport.sync.params.extraParam)i.transport.sync.params.extraParam=y;else i.transport.sync.params.extraParam[O]={addTaskAbove:!1,type:S}}}i.sync(),(s=new Array).push(t),s.push(c),l.isAddTask(t)?s.push(e):l.isDeleteTask(t)&&s.push(g),cpnl.postProcessAddRemove(s)}},this.preProcessAddRemove=function(e){var t=n.ComponentQuery.query("#dpmprojectgantt")[0],a=e[0];if(l.isDeleteTask(a)){for(var r=e[1],o=t.lockedGrid.getSelectionModel().selected,i=o.items,s=0,d=o.length;s<d;s++){var c=i[s].id,p=t.taskStore.getModelById(c).get("TaskProjectId");r[p]||(r[p]=0);var u=r[p];r[p]=parseInt(u)+1}return r}},this.postProcessAddRemove=function(e){var t=n.ComponentQuery.query("#dpmprojectgantt")[0],a=t.crudManager,r=e[0],o=e[1];if(a.transport.sync.url=o,l.isAddTask(r)){var i=e[2].rec;if(null==i)i=t.lockedGrid.getSelectionModel().selected.items[0];var s=i.get("TaskProjectId");s=null==s?i.id:s;var d=t.taskStore.getModelById(s);g=(g=d.get("LastSequence"))||0,d.set("LastSequence",parseInt(g)+1)}else if(l.isDeleteTask(r)){var c=e[2];for(var p in c){var u=t.taskStore.getModelById(p),m=c[p],g=u.get("LastSequence");u.set("LastSequence",parseInt(g)-parseInt(m))}}a.commit()},this.getFormattedDate=function(e){return e instanceof Date?n.Date.format(e,"d-m-Y")+" "+(e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()):""},this.changeColorSelectedItems=function(e){var t=n.ComponentQuery.query("#dpmprojectgantt")[0];if(t)for(var a=t.lockedGrid.getSelectionModel().selected.items,r=0,o=a.length;r<o;r++)a[r].set("Color",e)},this.createNewCustomColorPanel=function(e,t){if(e.rendered){var a=e.queryById("customColorPanel"),r=a.queryById("colorpickerid");a.remove(r);var o=n.create({id:"colorpickerid",xtype:"colorpicker",width:170,colors:t,listeners:{select:function(t,n){cpnl.changeColorSelectedItems(n),e.hide()},scope:e}});a.add(o)}},A});