try{define("DS/ENOGantt/View/GanttView",["UWA/Drivers/Alone","UWA/Core","UWA/Class/View","DS/UIKIT/Alert","DS/ENOGantt/Ven/Ext","DS/ENOGantt/Ven/Bryntum","DS/E6WCommonUI/Views/DetailsDisplayView","DS/E6WCommonUI/Views/FoundationBaseView","DS/Foundation2/Models/ReferenceModel","DS/Foundation2/FoundationV2Data","DS/ENOProjectMgmtModels/Models/AppSettings","DS/ENOGantt/Widget/PreferenceUtils","DS/ENOGantt/Infra","DS/ENOGantt/Data/CrudManager","DS/ENOGantt/View/Toolbar","DS/ENOGantt/View/ResourceUtilizationPanel","DS/ENOGantt/View/TaskCreationPanel","DS/ENOGantt/View/GanttConfiguration","DS/ENOGantt/View/GanttRefinement","DS/ENOGantt/Data/ResponseUtil","DS/ENOGantt/GanttUtil","DS/ENOGantt/Custom/DPMGanttAll","DS/E6WCommonUI/UIHelper","DS/ENOGantt/URLStore","DS/ENOProjectMgmtModels/Collections/Projects","DS/ENOGantt/Nls/Eno/"+window.languageGlobalVar,"css!DS/Sencha/classic/theme-neptune/resources/theme-neptune-all","css!DS/Bryntum/resources/css/sch-gantt-triton-all","css!ENOGantt/GanttWidget.css","css!ENOGantt/GanttGradientPattern.css","css!ENOGantt/Custom/GanttCustomGradientPattern.css","css!ENOGantt/GanttGradientSymbol.css"],function(e,t,a,n,r,o,i,s,l,c,d,p,g,u,h,m,f,y,v,w,P,C,S,b,I,T){"use strict";var E="Project Space,Project Concept,Project Baseline",j=l.extend({get:function(e){if("canEdit"===e)return!0,!0;this._parent.apply(this,arguments)},dataForRendering:function(){return{canEdit:!0}},add:function(e,t){this._fireRelationshipChangeEvents(e,t,!0)}});return s.extend({_uwaClassName:"GanttView",ganttViewAppsettings:void 0,className:"gantt-view",id:function(){return"ganttView"},domEvents:{"dragover ":"handleDragOver","drop ":"handleDrop","drop .drop-target":"handleDrop","dragend .drop-target":"handleDragEnd"},save:function(){this.crudManager.sync()},getViewHeight:function(){return window.isIFWE?this.container.clientHeight:r.getBody().getHeight()},loadGanttView:function(e){let t=UWA.clone(e||{},!1),a=e&&e.contextModel;this.contextInfo=a.model||a;let n=this.contextInfo.id,r=t.AppSettings,o=r.get("collabspace");this.ganttViewAppsettings=r,this.parentApp=e.parentView,n?(App.ContextModel=a,this.contextInfo&&(this.initializeEvents(this.contextInfo),p.set("savedTitle",this.contextInfo.title)),this._onProjectSelected("",n,o,r)):this.hideGanttPanels()},initializeEvents:function(e){this.listenTo(e,{removeTaskFromGantt:this.removeTasksFromGanttChart,onSaveModelComplete:this.updateGanttChart,"onChange:tasks":this.handleListenersForTasks})},handleListenersForTasks:function(e){let t=this.contextInfo.getAllTasks();t&&t.forEach(e=>{this.listenTo(e,{onSaveModelComplete:this.updateGanttChart,"onChange:tasks":this.handleListenersForTasks})})},removeTasksFromGanttChart:function(){let e=r.ComponentQuery.query("#dpmprojectgantt")[0];var t=e.getTaskStore();let a=e.lockedGrid.getSelectionModel().selected.items;t.removeTasks(a),e.crudManager.commit(),e.crudManager.load()},updateGanttChart:function(e,t){if(t){let n=r.ComponentQuery.query("#dpmprojectgantt")[0],o=n.taskStore.getModelById(e.id),i=!1;if(Object.keys(t).length>3)i=!0;else for(var a in t)switch(a){case"description":o.set("Description",t[a]),n.taskStore.commitChanges();break;case"title":if(o.setName(t[a]),n.taskStore.commitChanges(),App.ContextModel.id===e.id){let n=widget.getTitle(),r=n.lastIndexOf(e._previousAttributes.name),o=n.substring(0,r)+t[a];widget.setTitle(o)}break;case"currency":case"relatedProjects":break;default:i=!0}if(i){App.Infra.loadProjectSelectable||(App.Infra.loadProjectSelectable=!0);let e=n.crudManager;P.getStoreTaskExpandStatus(n.getTaskStore()),e.load()}}},getSavedProjectPhysicalId:function(){return p.get("savedPhysicalId")},removeProjectPhysicalId:function(){p.set("savedPhysicalId",!1)},setup:function(e){let t=UWA.clone(e||{},!1);if(this.container=t.container,this.homeView=t.homeView,this.viewCollection=this.homeView&&this.homeView.viewCollection||this.homeView._viewCollection,this.ganttPlugins=e.ganttPlugins,this.mainPanel=r.create("Ext.panel.Panel",{width:"auto",id:"mainpanel",xtype:"xmainpanel",autoHeight:!0,height:this.getViewHeight(),layout:"border",renderTo:this.container}),window.isIFWE){this.alerter=new n({autoHide:!0,closable:!0}),this.alerter.inject(this.container,"top"),widget.alerter=this.alerter}},prerender:function(){},getGanttPlugins:function(){var e=new this.ganttPlugins;return e&&e.getPlugins()},renderProjectGantt:function(){var e=this;new g({viewCollection:e.viewCollection,contextInfo:e.contextInfo,loadWidget:function(t){e.searchPanel&&(e.searchPanel.setLoading(!1),e.searchPanel.setHidden(!0));var a=new u({parentView:e,viewCollection:e.viewCollection});if(e.crudManager=a.crudManager,r.ComponentQuery.query("#dpmprojectgantt")[0]){var n=r.ComponentQuery.query("#dpmprojectgantt")[0];e.panel.setReadOnly(App.Infra.ReadOnly),e.refreshGanttColumn(n),e.refreshToolbar(n),e.refreshPlugins(n),e.panel.show()}else{new C;var i=!1,s=P.getDateFormat();App.Infra.ViewId!=App.Infra.Views.VIEW_TEMPLATE_WBS&&(i=r.create("DS.ENOGantt.DPMGanttAll.TooltipTamplate",null,s));var l={ToolbarRequired:App.Infra.ToolbarRequired};e.undoManager=new o.data.undoredo.Manager({transactionBoundary:"timeout",stores:[e.crudManager.getTaskStore(),e.crudManager.getDependencyStore()],listeners:{undoqueuechange:function(e,t){var a=r.ComponentQuery.query("#dpmprojectgantt")[0].undoManager.getRedoQueue().length,n=r.getCmp("tBarActionRedo");0===a?null!=n&&(n.isDisabled()||n.disable()):null!=n&&n.isDisabled()&&(n.enable(),n.setTooltip(App.Nls["emxProgramCentral.Gantt.Redo"]))}}}),e.panel=r.create("Gnt.panel.Gantt",{xtype:"dpmprojectgantt",id:"dpmprojectgantt",rowHeight:32,region:"center",parentView:e.parentApp,rightLabelField:{renderer:function(e,t){return P.getGanttLabel(t,!0)}},leftLabelField:{renderer:function(e,t){return P.getGanttLabel(t,!1)}},dragDropConfig:{showExactDropPosition:!0},undoManager:e.undoManager,controller:"GanttViewController",columns:App.Infra.Columns,crudManager:e.crudManager,highlightWeekends:!0,tooltipTpl:i,showTodayLine:!0,showProjectLines:!1,loadMask:!0,zoomKeepsOriginalTimespan:!0,selModel:new r.selection.TreeModel({ignoreRightMouseSelection:!1,mode:"MULTI"}),autoFitOnLoad:!0,columnLines:!0,enableBaseline:!0,baselineVisible:App.Infra.BaselineRequired,enableProgressBarResize:!0,showRollupTasks:!1,allowParentTaskMove:!0,enableTaskReordering:!0,toggleParentTasksOnClick:!1,tbar:e.getTbar(l),bbar:e.getBbar(l),plugins:e.getGanttPlugins(),taskBodyTemplate:'<div class="sch-gantt-progress-bar" style="width:{progressBarWidth}px;{progressBarStyle}" unselectable="on"><span class="sch-gantt-progress-bar-label" style="display: inline-block;margin-top: 3px;padding: 0.5pt 2pt 0 0;border-radius: 2px;background-color: inherit;">{[Gnt.column.PercentDone.prototype.defaultRenderer(values.percentDone)]}%</span></div>',parentTaskBodyTemplate:'<div class="sch-gantt-progress-bar" style="width:{progressBarWidth}px;{progressBarStyle}; text-align: right" unselectable="on"><span class="sch-gantt-progress-bar-label" style="display: inline-block;margin-top: 1px;padding: 0.5pt 2pt 0 0;border-radius: 2px;background-color: inherit; font-size: 0.8em;">{[Gnt.column.PercentDone.prototype.defaultRenderer(values.percentDone)]}%</span></div>',eventRenderer:function(e,t){var a,n,o,i,s=e.get("Symbol");if(void 0!==e||void 0!==t){if((null==s||""==s)&&e.get("Color")&&""!=e.get("Color"))if(a=r.String.format("background-color: #{0}!important;border-color:#{0}!important",e.get("Color")),t.segments)for(n=t.segments,o=0;o<n.length;o++)n[o].style=a;else i={style:a}}else i={};if((null==s||""==s)&&e.get("Pattern")&&""!=e.get("Pattern")){var l=e.get("Pattern"),c=l;"Gate"!=e.get("Type")&&"Milestone"!=e.get("Type")||(c=l+"-gate"),0==e.get("leaf")&&(c=l+"-summary"),i&&i.style?(i.cls=c,i.ctcls=c):i={cls:c,ctcls:c}}if((null==s||""==s)&&e.get("Color")&&""!=e.get("Color")){var d=function(e,t){e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]);t=t||0;var a,n,r="#";for(n=0;n<3;n++)a=parseInt(e.substr(2*n,2),16),a=Math.round(Math.min(Math.max(0,a+a*t),255)).toString(16),r+=("00"+a).substr(a.length);return r}(e.get("Color"),.5);i.progressBarStyle="background-color:"+d+"!important;border-color:"+d}return void 0!==e&&("TRUE"!=e.get("isTypeMilestone")&&"TRUE"!=e.get("isTypeGate")||e.get("State")!=App.Nls.Complete||(i={style:a=r.String.format("background-color: #969696!important;border-color:#969696!important")})),i},lockedGridConfig:{width:"20%"},listeners:{taskclick:e.getTask}}),e.undoManager.start(),(enoviaServer.viewId==App.Infra.Views.VIEW_STATUS_REPORT||enoviaServer.viewId==App.Infra.Views.VIEW_BASELINE_WBS||enoviaServer.viewId==App.Infra.Views.VIEW_BASELINE_VERSUS_CURRENT_BASELINE||enoviaServer.viewId==App.Infra.Views.VIEW_BASELINE_VERSUS_CURRENT_BASELINE2||enoviaServer.viewId==App.Infra.Views.VIEW_TEMPLATE_WBS||App.Infra.routeId)&&e.panel.setReadOnly(App.Infra.ReadOnly),e.refinement=new v({taskStore:e.crudManager.getTaskStore()}),e.refinement.render(),e.resourceUtilizationPanel=new m({viewCollection:e.viewCollection}),e.ganttTaskCreationPanel=new f({parentView:e.parentApp}),e.ganttConfigPanel=new y({parentView:e.parentApp});var c={region:"center",layout:"border",items:[e.panel,{xtype:"dpmresourceutilizationpanel",id:"dpmresourceutilizationpanel",region:"south",height:"50%",partnerTimelinePanel:e.panel,hidden:!0}]};window.gantt=e.ganttPanel,r.tip.QuickTipManager.init(),e.mainPanel.add({xtype:e.refinement.panel,reference:"refinement"}),e.mainPanel.add(c),e.mainPanel.add({xtype:"ganttConfigPanel",id:"ganttConfigPanel"}),e.mainPanel.add({xtype:"ganttTaskCreationPanel",id:"ganttTaskCreationPanel"})}if(!window.isODTRunning&&enoviaServer.physicalId){(n=r.ComponentQuery.query("#dpmprojectgantt")[0]).rendered&&n.setLoading({msg:App.Infra.LoadText||n.L("loadingText")});var d=b.getCalendarURL();w.loadCalendarData(d).then(function(){console.log("resolve"),e.panel.crudManager.load(),console.log("done")},function(){console.log("Failed to load calendar data. Please check server logs")})}window.isIFWE&&widget.setTitle(p.get("savedTitle"))}})},refreshPlugins:function(e){var t=r.ComponentQuery.query("#dependencyEditor")[0],a=r.ComponentQuery.query("#taskEditor")[0],n=r.ComponentQuery.query("#projectEditor")[0],o=r.ComponentQuery.query("#customColorPanel")[0],i=r.ComponentQuery.query("#colorpickerid")[0],s=r.ComponentQuery.query("#buttonPanel")[0],l=r.ComponentQuery.query("#clearColorButton")[0];null!=t&&t.destroy(),null!=a&&a.destroy(),null!=n&&n.destroy(),null!=o&&o.destroy(),null!=i&&i.destroy(),null!=s&&s.destroy(),null!=l&&l.destroy();var c=this.panel,d=c.plugins;c.plugins=[];for(var p=this.getGanttPlugins(),g=0;g<p.length;g++)c.addPlugin(p[g]);for(g=0;g<d.length;g++)switch(d[g].$className){case"Sch.plugin.NonWorkingTime":case"Sch.plugin.CurrentTimeLine":c.addPlugin(d[g])}},refreshGanttColumn:function(e){var t=App.Infra.Columns;e.lockedGrid.setColumns(t)},refreshToolbar:function(e){for(var t=r.ComponentQuery.query("#dpmgantttbar")[0],a=App.Infra.ReadOnly,n=t.items.items,o=0;o<n.length;o++){if(n[o].hasOwnProperty("disabled")&&n[o].setDisabled(a),n[o].hasOwnProperty("hidden"))switch(n[o].id){case"tBarActionProgressLine":n[o].setHidden(App.Infra.Views.VIEW_WBS!==App.Infra.ViewId);break;case"View":n[o].setHidden(App.Infra.HideView);break;case"tBarActionShowHidePercentComplete":case"tBarActionCalculateForecastValues":n[o].setHidden(App.Infra.TypeOf.ProjectTemplate||App.Infra.TypeOf.ProjectBaseline||App.Infra.TypeOf.Experiment);break;case"tBarActionPromoteSuccessor":n[o].setHidden("true"==App.Infra.projectDataElements.checkIfPromoteReadyTaskCommandVisible||!("TRUE"==App.Infra.projectDataElements.kindOfProjectSpace&&("Active"==App.Infra.projectDataElements.state||"Assign"==App.Infra.projectDataElements.state)&&"TRUE"==App.Infra.projectDataElements.modifyAccess))}}},configureGanttLabelsData:function(e){var t=this.getGantt();if(t.crudManager.hasChanges()){if(!confirm(App.Nls["emxProgramCentral.Project.DiscardChanges"]))return!1;t.getCrudManager().reject()}var a="/resources/v1/modeler/projects/"+enoviaServer.physicalId+"?$indexBasedImages=false&$include=none,getFloatValues";t.setLoading(!1);c.ajaxRequest({url:a,type:"GET",dataType:"json",callback:function(e){alert(e)}})},changeAutoCompleteDisplaySettings:function(){this._searchBar.getElement("input");var e=this._searchBar.getElement(".chooser"),t=(this._searchBar._childrenViews[0].autoCompleteControl,T["emxProgramCentral.GanttView.SearchForProject"]);this._searchBar._childrenViews[0].autoCompleteControl.setOption("placeholder",t),this._searchBar._childrenViews[0].autoCompleteControl.setOption("position",{my:"left-1.5 top",at:"left bottom",of:e,collision:"fit",within:this.container})},hideGanttPanels:function(){var e=r.ComponentQuery.query("#dpmresourceutilizationpanel")[0];e&&e.hide();var t=r.ComponentQuery.query("#GanttRefinementPanel")[0];t&&t.hide();var a=r.ComponentQuery.query("#dpmprojectgantt")[0];a&&a.hide()},renderProjectSearch:function(){var e=r.ComponentQuery.query("#mainpanel")[0];if(e){this.searchPanel=r.ComponentQuery.query("#searchprojectpanel")[0],this.searchPanel||(this.model=new j,this._searchBar=new i({model:this.model,id:"projectSpaceSearch"}),this._searchBar.setConfig([{readWrite:"true",name:"project",attributeToDisplay:"name",imageAttribute:"image",singleObjectOnly:!0,searchTypes:E,validTypes:E,searchTitle:App.Nls["emxProgramCentral.GanttWidget.SearchTitle"],typeAheadCallback:l.typeAheadCallback,type:"object"}]),this.listenTo(this.model,"onChange:project",this._onProjectSelected),this.listenTo(widget,"onResize",function(){this._searchBar._childrenViews[0].container.setStyle("width",.75*widget.body.clientWidth)}),p.get("savedPhysicalId")?p.addClearProjectPreference():p.removeClearProjectPreference(),this._searchBar.render(),this._searchBar._childrenViews[0].container.setStyle("width",.75*widget.body.clientWidth),this._searchBar._childrenViews[0].container.toggleClassName("fluid-width",!0),this._searchBar._childrenViews[0].container.toggleClassName("visible",!0),this._searchBar._childrenViews[0].container.toggleClassName("ds-detail-display",!1),this.changeAutoCompleteDisplaySettings(),this.searchPanel=r.create("Ext.Panel",{xtype:"panel",id:"searchprojectpanel",width:"100%",region:"east",items:[r.get(this._searchBar.getContent())]}),e.add(this.searchPanel)),this.refreshPlaceHolderText(),this.hideGanttPanels(),this.searchPanel.show();var t=widget.data.collabspace,a=t.substring(t.lastIndexOf(".")+1);window.isIFWE&&widget.setTitle(a)}},refreshPlaceHolderText:function(){var e=this._searchBar.getElement("input[type=text]");e&&e.setAttribute("placeholder",T["emxProgramCentral.GanttView.SearchForProject"])},render:function(e){var t=this;if(window.isIFWE){var a=!0;if(p.get("savedPhysicalId"))if(e){var n="",r="";n=p.get("savedObject")?p.get("savedObject"):p.get("savedPhysicalId");var o=p.get("savedTitle"),i=b.getUpdatedDataURL(n,o);(new I).fetch({idList:n,refresh:!0,include:i.include,customParams:i.customParams,onComplete:function(e){s(JSON.parse(JSON.stringify(e)))}});var s=function(e){e[0].Error?(a=!1,r=e[0].Error):e[0].physicalId&&e[0].physicalId!==p.get("savedPhysicalId")&&(p.set("savedPhysicalId",e[0].physicalId),p.get("savedObject")&&p.set("savedObject",!1),p.get("savedObjectID")&&p.set("savedObjectID",!1)),a?(enoviaServer.physicalId=p.get("savedPhysicalId"),t.renderProjectGantt()):(t.alerter.setOption("autoHide",!1),t.alerter.setOption("hideDelay",5e3),t.alerter.add({message:r,className:"error"}),t.alerter.show(),p.set("savedPhysicalId",!1),t.renderProjectSearch())}}else enoviaServer.physicalId=p.get("savedPhysicalId"),t.renderProjectGantt();else p.removeClearProjectPreference(),this.renderProjectSearch()}else this.renderProjectGantt();return t},resize:function(){this.mainPanel.setWidth(r.getBody().getWidth()),this.mainPanel.setHeight(r.getBody().getHeight())},getTask:function(){var e=arguments[1];c.ajaxRequest({url:"/resources/v2/e6w/service/ObjectInfo/"+e.getId()+"?$fields=objectId",dataType:"json",callback:function(e){}})},getBbar:function(e){if(e.ToolbarRequired){var t=[];return t.push("->"),t.push({id:"bbarObjectCount",xtype:"displayfield",cls:"my-toolbar",label:"Objects",name:"Objects",value:0}),t.push({id:"bbarSelectObjectCount",xtype:"displayfield",cls:"my-toolbar",label:"Selected",hidden:!0,name:"Selected",value:0}),t}return[]},getTbar:function(e){if(e.ToolbarRequired){var t={crudManager:this.crudManager};new h(t);return{xtype:"dpmgantttbar"}}return[]},_onProjectSelected:function(e,t,a,n){if(n=n||this.ganttViewAppsettings,a=a||n.get("collabspace"),this.searchPanel&&(this.searchPanel.setLoading({msg:T["emxProgramCentral.Gantt.Loading"]}),this._searchBar.hide()),enoviaServer.physicalId=t,window.isIFWE){var r=n.get("user");r&&r.login&&(r=r.login);var o=(new Date).getTimezoneOffset(),i=widget.getUrl(),s=n.get("myAppsUrl");i=i.substring(0,i.indexOf("/webapps"));var l=window.widget.lang;window.enoviaServer={params:"",sRealURL:i,showSpace:"true",objectId:"",widgetId:"",widgetName:"",taggerContextId:"auto",appName:"",tenant:"",space:null,rows:null,preferences:{},storageUrl:s,language:l,timezone:o,_getUrl:function(){return this.storageUrl||this.sRealURL},computeUrl:function(e){return n.get("3DSpace")+e},getParams:function(){var e="";return""!==(e+="&tenant="+enoviaServer.tenant)&&(e=e.substring(1)),enoviaServer.space&&enoviaServer.space.length>0&&(e+="&SecurityContext="+encodeURIComponent(enoviaServer.space)),e},getParamsAsJSON:function(){return{}},user:r},enoviaServer.securityContext=encodeURIComponent(a)}p.set("savedPhysicalId",t),this.render(!1)},handleDrop:function(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),this.container.removeClassName("bordered");var t=S.getDataTransferJSON(e.dataTransfer);return t&&this.processDropData(t),!1},handleDragEnd:function(){this.container.removeClassName("bordered")},handleDragOver:function(e){
//!this._blockerDiv.isInjected() && this._blockerDiv.inject(this.container, 'top');
return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="copy",p.get("savedPhysicalId")&&this.container.addClassName("bordered"),!1},processDropData:function(e){var t=e.data.items[0],a=t.displayName;a&&a.length>0&&("Project Space"!==t.objectType&&"Project Baseline"!==t.objectType&&"Project Concept"!==t.objectType&&"Experiment"!==t.objectType?(this.alerter.add({message:NLS["emxProgramCentral.GanttView.NotProjectSpace"],className:"error"}),this.alerter.show()):this.parentApp.parentView.handleContextWithDroppedObj(e.data.items))}})})}catch(e){console.log("==============================================Error:======"+e.Name)}