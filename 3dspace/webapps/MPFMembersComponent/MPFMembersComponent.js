define("DS/MPFMembersComponent/MembersComponentTypes",[],function(){"use strict";return Object.freeze({SHOP:"shop",INTERNAL_SHOP:"internalShop",COMPANY:"company"})}),define("DS/MPFMembersComponent/InfoPanel",["UWA/String","UWA/Class/View","DS/MPFTooltip/Tooltip","i18n!DS/MPFMembersComponent/assets/nls/MembersComponent"],function(e,t,s,n){"use strict";return t.extend({className:"mpf-members-info-panel",setup:function(e){this.serviceTerm=e.serviceTerm,this.tooltip=e.tooltip},render:function(){return this.container.setContent([{tag:"span",class:"fonticon fonticon-2x fonticon-info"},{tag:"span",class:"mpf-short-info-label",text:e.format(n.get("invitationInformation"),this.serviceTerm)},{tag:"span",html:new s({body:this.tooltip})}]),this},destroy:function(){this._parent(),this.container=null}})}),define("DS/MPFMembersComponent/MemberDropDown",["UWA/Core","UWA/Class/View","DS/UIKIT/DropdownMenu","DS/MPFServices/ObjectService","DS/MPFPersonModel/PersonModel","DS/MPFMembersComponent/MembersComponentTypes","i18n!DS/MPFMembersComponent/assets/nls/MembersComponent"],function(e,t,s,n,i,o,r){"use strict";const a=Object.freeze({CHANGE_ROLES:"changeRoles",REMOVE_MEMBER:"removeMember",SEND_INVITATION:"sendInvitation"}),h=t.extend({className:"mpf-member-drop-down",setup:function(e){n.requiredOfPrototype(e.member,i,"options.member must be a PersonModel"),this.member=e.member,this.type=e.type,this.arrow=this._createArrow(),this.dropDown=this._createDropDown(this.arrow)},render:function(){return this.container.setContent([this.arrow,this.dropDown.hide()]),this},destroy:function(){this.dropDown.destroy(),this.arrow.destroy(),this.dropDown=null,this.arrow=null,this._parent(),this.container=null},_createArrow:function(){return e.createElement("div",{class:"fonticon fonticon-2x fonticon-open-down mpf-dropdown-arrow"})},_createDropDown:function(e){const t=[];return this.type!==o.INTERNAL_SHOP&&this.member.getState()!==i.States.ACTIVE&&t.push(this._createMenuItem("mail",r.get("sendInvitation"),a.SEND_INVITATION)),this.type===o.COMPANY?(t.push(this._createMenuItem("pencil",r.get("changeRoles"),a.CHANGE_ROLES)),t.push(this._createMenuItem("wrong",r.get("removeButton"),a.REMOVE_MEMBER))):this.type===o.INTERNAL_SHOP?t.push(this._createMenuItem("pencil",r.get("changeRoles"),a.CHANGE_ROLES)):t.push(this._createMenuItem("wrong",r.get("removeButton"),a.REMOVE_MEMBER)),new s({target:e,items:t})},_createMenuItem:function(e,t,s){return{fonticon:e,text:t,handler:this.dispatchEvent.bind(this,s,this.member)}}});return h.Events=a,h}),define("DS/MPFMembersComponent/ChangeRolesModal",["UWA/Core","UWA/Class/View","DS/UIKIT/Modal","DS/UIKIT/Input/Select","DS/UIKIT/Input/Button","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFPersonModel/PersonModel","DS/MPFMembersComponent/MembersComponentTypes","i18n!DS/MPFMembersComponent/assets/nls/MembersComponent"],function(e,t,s,n,i,o,r,a,h,l){"use strict";const m=Object.freeze({SAVE_ROLES:"saveRoles"}),c=t.extend({className:"mpf-change-roles-modal",setup:function(e){r.requiredOfPrototype(e.member,a,"options.member must be a PersonModel"),r.requiredOfType(e.type,"string","options.type must be one of the strings defined in MembersComponentTypes"),this.member=e.member,this.type=e.type,this.alert=this._createAlert(),this.okButton=this._createOkButton(),this.cancelButton=this._createCancelButton()},render:function(){return this.selectInput=this._createSelectInput(),this.modal=this._createModal(this.selectInput,this.okButton,this.cancelButton),this.container.setContent(this.modal),this},show:function(){this.modal.show()},hide:function(){this.modal.hide(),this.render()},showError:function(e){this.modal&&this.alert.add({message:e,className:"error"}).show()},destroy:function(){this._destroyModal(),this.member=null,this._parent(),this.container=null},dispatchSaveRoles:function(){if(this.selectInput){const e=this.selectInput.getValue();e.length>0?(this.setLoading(!0),this.dispatchEvent(m.SAVE_ROLES,{newRoles:e})):this.showError(l.get("noRoleError"))}},setLoading:function(e){e=!1!==e,this.okButton.load(e)},_createOkButton:function(){const e=new i({value:l.get("OK"),className:"primary"});return e.addEvent("onClick",this.dispatchSaveRoles.bind(this)),e},_createCancelButton:function(){const e=new i({value:l.get("cancel")});return e.addEvent("onClick",this.hide.bind(this)),e},_createAlert:function(){return new o({visible:!1,closable:!0,autohide:!0})},_createModal:function(e,t,n){return new s({header:l.get("changeRoles"),body:[this.alert,e],footer:[t,n]})},_createSelectInput:function(){const e=this.type===h.INTERNAL_SHOP?{style:"opacity: 0.6; pointer-events: none;"}:{},t=[{attributes:e,disabled:this.type===h.INTERNAL_SHOP,label:l.get("Admin"),selected:this.member.get("Roles").indexOf(a.Roles.EMP_ADMIN)>-1,value:a.Roles.EMP_ADMIN},{attributes:e,disabled:this.type===h.INTERNAL_SHOP,label:l.get("Buyer"),selected:this.member.get("Roles").indexOf("Buyer")>-1,value:"Buyer"}];return this.type===h.INTERNAL_SHOP&&t.push({attributes:{"data-id":"operator"},label:l.get("ShopOperator"),selected:this.member.get("Roles").indexOf(a.Roles.SHOP_OPERATOR)>-1,value:a.Roles.SHOP_OPERATOR}),new n({multiple:!0,options:t,placeholder:!1})},_destroyModal:function(){this.okButton.removeEvents(),this.cancelButton.removeEvents(),this.okButton=null,this.cancelButton=null,this.modal&&(this.modal.hide(),this.modal.destroy(),this.modal=null)}});return c.Events=m,c}),define("DS/MPFMembersComponent/InviteModal",["UWA/String","UWA/Class/View","DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Input/Text","DS/UIKIT/Modal","DS/MPFServices/ObjectService","DS/MPFPersonModel/PersonCollection","DS/MPFView/TaggerInput","DS/MPFMembersComponent/MembersComponentTypes","i18n!DS/MPFMembersComponent/assets/nls/MembersComponent"],function(e,t,s,n,i,o,r,a,h,l,m,c){"use strict";const d=Object.freeze({ON_INVITE:"onInvite"}),p=t.extend({className:"mpf-invite-members-modal",setup:function(t){a.requiredOfPrototype(t.members,h,"options.members must be a PersonCollection"),a.requiredOfType(t.serviceTerm,"string","options.serviceTerm must be a string"),this.members=t.members,this.inviteFactory=t.inviteFactory,this.companyId=t.companyId,this.shopId=t.shopId,this.serviceTerm=t.serviceTerm,this.roles=t.roles||[],this.title=t.type===m.COMPANY?c.get("inviteMembersTitle"):e.format(c.get("inviteManagersTitle"),e.ucfirst(this.serviceTerm)),this.alert=this._createAlert(),this.emailInput=this._createEmailInput(),this.roleSelect=t.type!==m.SHOP?this._createRoleSelect():null,this.messageInput=this._createMessageInput(),this.inviteButton=this._createInviteButton(),this.cancelButton=this._createCancelButton()},render:function(){return this.modal=this._createModal(this.emailInput,this.roleSelect,this.messageInput,this.inviteButton,this.cancelButton),this.container.setContent(this.modal),this},destroy:function(){this.stopListening(),this.inviteButton.removeEvents(),this.cancelButton.removeEvents(),this.emailInput.destroy(),this.roleSelect&&this.roleSelect.destroy(),this.modal&&this.modal.destroy(),this.members=null,this.inviteFactory=null,this._parent(),this.container=null},show:function(){if(!this.modal)throw Error("Modal has not been rendered yet!");this._clearModal(),this.modal.show()},hide:function(){this.modal.hide()},_createAlert:function(){return new s({visible:!1,autoHide:!0,closeOnClick:!0})},_createModal:function(e,t,s,n,i){const o=[];return o.push(this.alert),o.push(this._wrapLabelAndInput(c.get("inviteByEmailLabel"),e.render())),t&&o.push(this._wrapLabelAndInput(c.get("selectRole"),t)),o.push(this._wrapLabelAndInput(c.get("addAMessageLabel"),s)),new r({header:this.title,body:o,footer:[n,i]})},_wrapLabelAndInput:function(e,t){return{tag:"div",class:"mpf-label-with-input",html:[{tag:"div",class:"mpf-label",text:e},t]}},_clearModal:function(){this.emailInput.clear(),this.roleSelect&&this.roleSelect.clear(),this.messageInput.setValue("")},_createEmailInput:function(){const e=new l({placeholder:c.get("inviteByEmailPlaceholder"),validator:this._validateEmail.bind(this),errorMessage:c.get("invalidEmail")});return this.listenTo(e,l.Events.ITEM_ADDED,this._setInviteButtonState.bind(this)),this.listenTo(e,l.Events.ITEM_REMOVED,this._setInviteButtonState.bind(this)),this.listenTo(e,l.Events.ITEM_CHANGED,this._setInviteButtonState.bind(this)),e},_validateEmail:function(t){let s=!0,n="";return e.isEmail(t)||(s=!1,n=c.get("invalidEmail")),this._emailIsAlreadyTaken(t)&&(s=!1,n=c.get("youCantInviteAlreadyAddedMember")),{isValid:s,message:n}},_setInviteButtonState:function(){this.emailInput.getValues().length>0?this.inviteButton.enable():this.inviteButton.disable()},_emailIsAlreadyTaken:function(e){for(let t=0;t<this.members.length;t++){const s=this.members.at(t).getEmail();if(s&&s.toLowerCase()===e.toLowerCase())return!0}return!1},_createRoleSelect:function(){return new i({options:this.roles.map(e=>({value:e,label:c.get(e)})),placeholder:!1})},_createMessageInput:function(){return new o({className:"mpf-invite-message-input",multiline:!0,placeholder:c.get("inviteMessagePlaceholder")})},_createInviteButton:function(){const e=new n({value:c.get("invite"),className:"primary",disabled:!0});return e.addEvent("onClick",this._onInviteRequested.bind(this)),e},_createCancelButton:function(){const e=new n({value:c.get("cancel")});return e.addEvent("onClick",this.hide.bind(this)),e},_onInviteRequested:function(){const e=this.emailInput.getValues(),t=this.messageInput.getValue(),s=this.roleSelect?this.roleSelect.getValue():this.roles||["ShopOperator","Admin"];if(e.length>0){const n=[];for(let i=0;i<e.length;i++){const o={email:e[i],Message:t,Roles:s};this.shopId&&(o.ShopId=this.shopId),n.push(o)}this.inviteButton.load(!0),this.members.addAllPromise(n,{companyId:this.companyId}).then(()=>{this.shopId&&this.members.setParentResourceId(this.shopId),this.dispatchEvent(d.ON_INVITE,this.members)}).catch(e=>{console.log(e),this.alert.add({className:"error",message:c.get("memberInvitationFailed")}).show()}).finally(()=>{this.inviteButton.load(!1)})}}});return p.Events=d,p}),define("DS/MPFMembersComponent/MemberPanel",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/PlatformAPI/PlatformAPI","DS/MPFServices/ObjectService","DS/MPFView/InitialsDot","DS/MPFPersonModel/PersonModel","DS/MPFInviteModel/InviteFactory","DS/MPFView/ConfirmationModal","DS/MPFMembersComponent/MemberDropDown","DS/MPFMembersComponent/ChangeRolesModal","DS/MPFMembersComponent/MembersComponentTypes","i18n!DS/MPFMembersComponent/assets/nls/MembersComponent"],function(e,t,s,n,i,o,r,a,h,l,m,c,d){"use strict";const p=Object.freeze({REMOVE_MEMBER:"removeMember",UPDATE_ROLES:"updateRoles",INVITATION_SENT:"onInvitationSent",INVITATION_FAILURE:"onInvitationFailure"}),u=t.extend({className:"mpf-member-panel",setup:function(e){i.requiredOfPrototype(e.member,r,"options.member must be a PersonModel"),i.requiredOfPrototype(e.inviteFactory,a,"options.inviteFactory must be an InviteFactory"),i.requiredOfType(e.type,"string","options.type must be a string as defined in MembersComponentTypes"),this.member=e.member,this.companyId=e.companyId,this.shopId=e.shopId,this.type=e.type,this.inviteFactory=e.inviteFactory,this.isEnabled=e.isEnabled,this.isCurrentUser=this._isCurrentUser(),this.isEnabled&&!this.isCurrentUser&&(this.removeModal=this._createRemoveModal(),this.changeRolesModal=this._createChangeRolesModal(),this.dropDown=this._createDropDown(this.removeModal,this.changeRolesModal))},render:function(){const e=this.member.getState()===r.States.ACTIVE;return this.container.setContent([{tag:"div",class:"mpf-intials-dot-container",html:this._createInitialsDot(e)},{tag:"div",class:"mpf-main-column",html:[this._getFirstRow(e),this._getSecondRow(e),this._getThirdRow()]}]),this.isEnabled&&!this.isCurrentUser&&this.container.addContent([this.changeRolesModal.render(),this.removeModal.render(),this.dropDown.render()]),this},destroy:function(){this.stopListening(),this.dropDown&&this.dropDown.destroy(),this.changeRolesModal&&this.changeRolesModal.destroy(),this.removeModal&&this.removeModal.destroy(),this.dropDown=null,this.changeRolesModal=null,this.removeModal=null,this.member=null,this._parent(),this.container=null},mask:function(){s.mask(this.container)},unmask:function(){s.unmask(this.container)},_isCurrentUser:function(){return(this.member.getUserName()?this.member.getUserName():this.member.get("id"))===n.getUser().login},_createInitialsDot:function(e){return new o({title:e?this.member.getFirstName()+" "+this.member.getLastName():this.member.getEmail()})},_getFirstRow:function(t){return e.createElement("div",{class:"mpf-first-row",text:t?this.member.getFirstName()+" "+this.member.getLastName():this.member.getEmail()})},_getSecondRow:function(t){return e.createElement("div",{class:"mpf-second-row",text:t?this.member.getEmail():"("+d.get("pending")+")"})},_getThirdRow:function(){let t="";const s=this.member.get("Roles").indexOf(r.Roles.EMP_ADMIN)>-1,n=this.member.get("Roles").indexOf(r.Roles.SHOP_OPERATOR)>-1;return s&&(t+=d.get("admin")),n&&(s&&(t+=", "),t+=d.get("manager")),e.createElement("div",{class:"mpf-third-row",text:t})},_createDropDown:function(e,t){const s=new l({member:this.member,type:this.type});return this.listenTo(s,l.Events.REMOVE_MEMBER,e.show.bind(e)),this.listenTo(s,l.Events.CHANGE_ROLES,t.show.bind(t)),this.listenTo(s,l.Events.SEND_INVITATION,this._sendInvitation.bind(this)),s},_createRemoveModal:function(){const e=this.member.getState()===r.States.ACTIVE?this.member.getFirstName()+" "+this.member.getLastName():this.member.getEmail(),t=new h({header:d.get("confirmationModalTitle"),body:d.get("areYouSurToRemove",{name:e})});return this.listenTo(t,h.Events.CONFIRM,this._removeMember.bind(this)),t},_removeMember:function(){this.mask(),this.removeModal.setLoading(!0),this.dispatchEvent(p.REMOVE_MEMBER,{memberPanel:this,member:this.member})},_createChangeRolesModal:function(){const e=new m({member:this.member,roles:this.roles,type:this.type});return this.listenTo(e,m.Events.SAVE_ROLES,this._updateRoles.bind(this)),e},_updateRoles:function(e){this.mask(),this.dispatchEvent(p.UPDATE_ROLES,{memberPanel:this,newRoles:e.newRoles})},_sendInvitation:function(){const e=this.inviteFactory.createModel(a.Types.COMPANY_INVITE,null,{parentResourceId:this.companyId});e.addMemberId(this.member.get("id")),this.type===c.SHOP&&e.setShopId(this.shopId),this.mask();const t=this;e.savePromise().then(function(){t.unmask(),t.dispatchEvent(p.INVITATION_SENT)}).catch(function(e){console.log(e),t.unmask(),t.dispatchEvent(p.INVITATION_FAILURE)})}});return u.Events=p,u}),define("DS/MPFMembersComponent/InvitePanel",["UWA/Core","UWA/String","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFModel/MPFCollection","DS/MPFMembersComponent/InviteModal","DS/MPFMembersComponent/MembersComponentTypes","i18n!DS/MPFMembersComponent/assets/nls/MembersComponent"],function(e,t,s,n,i,o,r,a){"use strict";return s.extend({className:"mpf-invite-members-panel",domEvents:{"click .mpf-invite-panel-clickable-area":"_onClick"},setup:function(e){n.requiredOfPrototype(e.members,i,"options.members must be a MPFCollection"),this.members=e.members,this.companyId=e.companyId,this.shopId=e.shopId,this.roles=e.roles,this.inviteFactory=e.inviteFactory,this.type=e.type,this.serviceTerm=e.serviceTerm,this.isEnabled=e.isEnabled,this.isEnabled&&(this.inviteModal=this._createInviteModal(),this.container.addClassName("mpf-clickable"))},render:function(){const e=this.type===r.COMPANY?a.get("inviteMembersTitle"):t.format(a.get("inviteManagersTitle"),t.ucfirst(this.serviceTerm));return this.container.setContent([this.isEnabled&&this.inviteModal.render(),{tag:"div",class:"mpf-invite-panel-clickable-area",html:[{tag:"span",class:"fonticon fonticon-3x fonticon-user-add"},{tag:"span",class:"mpf-invite-panel-label",text:e}]}]),this},destroy:function(){this.inviteModal&&this.inviteModal.destroy(),this.inviteModal=null,this._parent(),this.container=null},_onClick:function(){this.isEnabled&&this.inviteModal.show()},_createInviteModal:function(){return new o({members:this.members,roles:this.roles,inviteFactory:this.inviteFactory,companyId:this.companyId,shopId:this.shopId,serviceTerm:this.serviceTerm,type:this.type})}})}),define("DS/MPFMembersComponent/MembersComponent",["UWA/Core","UWA/String","UWA/Class/View","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFPersonModel/PersonModel","DS/MPFPersonModel/PersonCollection","DS/MPFInviteModel/InviteFactory","DS/MPFMembersComponent/InvitePanel","DS/MPFMembersComponent/InfoPanel","DS/MPFMembersComponent/MemberPanel","DS/MPFMembersComponent/MembersComponentTypes","i18n!DS/MPFMembersComponent/assets/nls/MembersComponent","css!DS/MPFMembersComponent/MPFMembersComponent"],function(e,t,s,n,i,o,r,a,h,l,m,c,d){"use strict";const p=s.extend({className:"mpf-members-component",setup:function(s){i.requiredOfPrototype(s.members,r,"options.members must be a PersonCollection of type shop (for shop members) or company (for internal shop members and company members)"),i.requiredOfPrototype(s.inviteFactory,a,"options.inviteFactory must be an InviteFactory"),i.requiredOfType(s.type,"string","options.type must be a string as defined in MembersComponentTypes"),this.members=s.members,this.inviteFactory=s.inviteFactory,this.roles=s.roles,this.companyId=s.companyId,this.shopId=s.shopId,this.isEnabled=!1!==s.isEnabled,this.type=s.type||c.SHOP,this.serviceTerm=s.serviceTerm||d.get("lab"),this.tooltip=e.is(s.tooltip,"string")?s.tooltip:t.format(d.get("helpMessageInvitation"),this.serviceTerm,t.ucfirst(this.serviceTerm)),this.alert=this._createAlert(),this.invitePanel=this._createInvitePanel(),this.infoPanel=this._createInfoPanel(),this.memberPanels=this._createMemberPanels(),this.listenTo(this.members,"onAdd",this.update.bind(this)),this.listenTo(this.members,"onRemove",this.update.bind(this))},render:function(){const e=[this.alert];this.type!==c.INTERNAL_SHOP&&e.push(this._wrapInGridItem(this.invitePanel.render())),this.type===c.SHOP&&e.push(this._wrapInGridItem(this.infoPanel.render()));for(let t=0;t<this.memberPanels.length;t++)e.push(this._wrapInGridItem(this.memberPanels[t].render()));return this.container.setContent(e),this.rendered=!0,this},destroy:function(){this.stopListening(),this.invitePanel.destroy(),this.infoPanel.destroy();for(let e=0;e<this.memberPanels.length;e++)this.memberPanels[e].destroy();this._parent(),this.container=null},update:function(){this.memberPanels=this._createMemberPanels(),this.rendered&&this.render()},_showAlert(e,t="error"){this.alert.add({className:t,message:e}).show()},_wrapInGridItem:function(e){return{tag:"div",class:"col-sm-6",html:e}},_createAlert:function(){return new n({closeOnClick:!0,closeable:!0,visible:!1,autoHide:!0})},_createInvitePanel:function(){return new h({members:this.members,inviteFactory:this.inviteFactory,roles:this.roles,companyId:this.companyId,shopId:this.shopId,type:this.type,serviceTerm:this.serviceTerm,isEnabled:this.isEnabled})},_createInfoPanel:function(){return new l({tooltip:this.tooltip,serviceTerm:this.serviceTerm})},_createMemberPanels:function(){const e=[];for(let t=0;t<this.members.length;t++){const s=new m({member:this.members.at(t),inviteFactory:this.inviteFactory,companyId:this.companyId,shopId:this.shopId,type:this.type,isEnabled:this.isEnabled});this.listenTo(s,m.Events.REMOVE_MEMBER,this._removeMember.bind(this)),this.listenTo(s,m.Events.UPDATE_ROLES,this._updateRoles.bind(this)),this.listenTo(s,m.Events.INVITATION_SENT,this._showAlert.bind(this,d.get("invitationHasBeenSent"),"success")),this.listenTo(s,m.Events.INVITATION_FAILURE,this._showAlert.bind(this,d.get("memberInvitationFailed"))),e.push(s)}return e},_removeMember:function(e){const t=e.memberPanel,s=e.member,n={companyId:this.companyId,roles:[...s.get("Roles")]};this.type!==c.INTERNAL_SHOP&&n.roles.push("Admin"),-1!==n.roles.indexOf("ShopOperator")&&(n.shopID=this.shopId),this.members.removeOnePromise(s.get("id"),n).catch(this._onRemoveFailure.bind(this,t))},_onRemoveFailure:function(e,t){let s;s=t.message&&-1!==t.message.indexOf("403")?d.get("onlyManagerMsg"):d.get("errorMsg"),e.removeModal.setLoading(!1),e.removeModal.hide(),e.unmask(),this._showAlert(s)},_updateRoles:function(e){const t=e.memberPanel,s=e.newRoles,n=t.member,i=n.get("Roles");this._lastLabManagerRemoved(i,s)?(t.unmask(),t.changeRolesModal.setLoading(!1),t.changeRolesModal.showError(d.get("onlyManagerRole"))):this.members.updateRolesPromise(n.get("id"),{companyId:this.companyId,shopId:this.shopId,email:n.getEmail(),newRoles:s,previousRoles:i}).then(function(){n.set("Roles",s),t.changeRolesModal.setLoading(!1),t.changeRolesModal.hide(),t.unmask(),t.render()}).catch(function(e){t.changeRolesModal.setLoading(!1),t.unmask(),console.log(e),t.changeRolesModal.showError(d.get("errorMsg"))})},_lastLabManagerRemoved:function(e,t){const s=-1!==e.indexOf(o.Roles.SHOP_OPERATOR)&&-1===t.indexOf(o.Roles.SHOP_OPERATOR);return 1===this.members.filter(function(e){return-1!==e.get("Roles").indexOf(o.Roles.SHOP_OPERATOR)}).length&&s}});return p.Types=c,p}),define("DS/MPFMembersComponent/MembersComponentFactory",["UWA/Class","UWA/Promise","DS/MPFConnector/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFShopModel/ShopFactory","DS/MPFPersonModel/PersonFactory","DS/MPFCompanyModel/CompanyHelper","DS/MPFPersonModel/PersonModel","DS/MPFMembersComponent/MembersComponent"],function(e,t,s,n,i,o,r,a,h){"use strict";const l=e.extend({init:function(e={}){this.options=e,this.connector=e.connector,this.shopId=e.shopId,this.isInternalLab=!0===e.isInternalLab,this.roles=e.roles||["Buyer",a.Roles.EMP_ADMIN],this.shopFactory=null,this.inviteFactory=null,this.personFactory=null,this.shop=null,this.companyId=null,this.type=null},fromShop:function(){return this.type=this.isInternalLab?h.Types.INTERNAL_SHOP:h.Types.SHOP,this._getConnector().then(this._getFactories.bind(this)).then(this._getShop.bind(this)).then(this._getCompanyId.bind(this)).then(this._getMembers.bind(this)).then(this._build.bind(this))},_getConnector:function(){let e;return(e=this.connector?Promise.resolve(this.connector):s.fetchPromise(this.options)).then(e=>{this.connector=e})},_getFactories:function(){return n.getInstance(this.connector).getFactories([n.Types.SHOP,n.Types.INVITE,n.Types.PERSON]).then(e=>{this.shopFactory=e[0],this.inviteFactory=e[1],this.personFactory=e[2]})},_getShop:function(){let e;if(this.shopId)this.shop=this.shopFactory.createModel(i.Types.SHOP,{id:this.shopId}),e=this.shop.fetchPromise();else{const t=this.shopFactory.createCollection(i.Types.ME);e=t.fetchPromise().then(()=>{this.shop=t.first()})}return e},_getCompanyId:function(){return this.companyId=r.getIdFromUrl(this.shop.getOwner()),Promise.resolve()},_getMembers:function(){return this.type===h.Types.COMPANY?this.members=this.personFactory.createCollection(o.Types.COMPANY,[],{parentResourceId:this.companyId}):this.members=this.personFactory.createCollection(o.Types.SHOP,[],{parentResourceId:this.shop.get("id")}),this.members.fetchPromise()},_build:function(){const e=new h({companyId:this.companyId,shopId:this.shopId,members:this.members,inviteFactory:this.inviteFactory,type:this.type,roles:this.roles});return Promise.resolve(e)}});return l.fromMe=function(e){return new l(e).fromShop()},l.fromShopId=function(e,t=!1){return new l({shopId:e,isInternalLab:t}).fromShop()},l});