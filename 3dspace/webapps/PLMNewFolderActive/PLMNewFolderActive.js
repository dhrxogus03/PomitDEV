define("DS/PLMNewFolderActive/PLMNewFolderActiveController",["DS/ClassificationsFacet/PLMNewCommomCmpUXController","DS/FolderActive/service/FolderActiveWebServices","i18n!DS/FolderActive/assets/nls/FolderActive","DS/WebappsUtils/WebappsUtils","DS/FolderActive/commands/FolderCommands","DS/FolderActive/service/FolderTypeService","DS/WidgetServices/WidgetServices","DS/ClassificationsFacet/service/PLMNewCommonWebService","DS/FolderEditor/service/FolderEditorWebService","UWA/Utils","DS/Windows/ImmersiveFrame","DS/Controls/TooltipModel","i18n!DS/ClassificationsFacet/assets/nls/PLMNewCommCmpSel","DS/FolderActive/utils/PreferencesUtils","DS/IPClassifyUtil/IPClassifyAlert","DS/PlatformAPI/PlatformAPI","DS/IPClassifyUXUtil/service/IPClassifyUXUtilWebService"],function(e,t,o,i,n,s,r,l,a,c,d,u,m,p,h,f,v){"use strict";i.getWebappsAssetUrl("FolderEditor","icons/I_Bookmark_v2.png");var C={iconName:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-bookmark-flash "},g=i.getWebappsAssetUrl("FolderEditor","icons/folder_perso.png"),b={iconName:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-bookmark "};let S=!1;return e.extend({name:"FolderActive",_rootNodeFavorite:null,_rootNodeFolders:null,_rootNodeTrash:null,_requestInfo:{},_searchKeys:{},_pathInfo:{},_subBookmarkExpand:{},_personalSectionNode:null,_favoriteSection:"FolderSection_favorite",_allSection:"FolderSection_AllFolders",_findInTreeNLS:o,_getActiveBookmarkPromise:null,_currentActiveBookmarkId:null,_classNameMap:new Map,_parentInitMethod:null,_parentOptions:null,init:function(e){let i;this.PLMNewCommonWebService=Object.assign({},l),this.PLMNewCommonWebService.getSetting=a.getWidgetSettings,this.PLMNewCommonWebService._executeRequest=v._executeRequest,this.PLMNewCommonWebService._executeQuery=v._executeQuery,this.PLMNewCommonWebService.getRelatedBookmarks=a.getRelatedBookmarks,this.PLMNewCommonWebService.removecontent=a.removecontent,this.PLMNewCommonWebService.getSetting(e.securityContext).then(function(e){i=e}),e.multiSelectionComponent&&!e.multiSelectionComponent.NLS&&(e.multiSelectionComponent.NLS=o.multiSelectionComponent),this.PLMNewCommonWebService.addcontent=t.addcontent,this.PLMNewCommonWebService.getSearchQuery=function(){return i&&i.personal?'flattenedtaxonomies:("types/Workspace" OR  "types/Workspace Vault" OR  "types/Personal Workspace")':'flattenedtaxonomies:("types/Workspace" OR  "types/Workspace Vault")'},this.PLMNewCommonWebService.getType_filter_bo=function(){return["Workspace","Workspace Vault"]},this._getActiveBookmarkPromise=this.getCurrentPreference(),this._parent(e),this._parentOptions=e,this._parentInitMethod=this._parent,this.plmNewContextProvider=e.securityContext},_getWebServiceRef:function(){return t},onSetActive:function(e){e&&"function"==typeof e&&(this.onSetActive=e)},_getPlmType:function(e){return-1===["Workspace","Workspace Vault","Bookmark","Bookmark Root"].indexOf(e)&&e?"Content":"Folder"},_getIcon:function(e,t){var o="subFolders"!==t&&!1,i=b;return e&&e.type&&s.isPersonalFolder(e.type)?o||!i?g:i:"favorites"===t?e.inherit?C:i:o||e.iconType&&"SHARED"===e.iconType.toUpperCase()?C:i},couldBeValid:function(e){var t=e&&e.getID&&e.getID();return t&&t!==this._favoriteSection&&t!==this._allSection},getInitIcon:function(e){return e.iconType=e.folderClassification,this._getIcon(e)},removeContents:function(e){var t=this;e.classId.forEach(o=>{var i=this._classNameMap.get(o);this.PLMNewCommonWebService.removecontent({pid:o,IDs:e.IDs,isLinkedFolder:!1,onComplete:function(e){"failure"==e.status?(h.displayNotification({title:m.replace(m.errorForRemoveContentFromBks,{number:1,bkname:i}),subtitle:e.error,className:"error"}),t._isProcessing=!1,t._parentInitMethod({...t._parentOptions,isRefreshContainer:!0})):h.displayNotification({message:m.replace(m.removeBookmarkedSuccess,{number:1,bkname:i}),className:"success"})},onFailure:function(e){console.log("================",e),t._isProcessing=!1,t._parentInitMethod({...t._parentOptions,isRefreshContainer:!0})}})})},addContents:function(e){var t=this;e.classId.forEach(o=>{var i=this._classNameMap.get(o);a.addcontent({pid:o,IDs:e.IDs,isLinkedFolder:!1}).then(e=>{"failure"==e.status?(h.displayNotification({title:m.replace(m.errorForAddContentsToBks,{number:1,bkname:i}),subtitle:e.error,className:"error"}),t._isProcessing=!1,t._parentInitMethod({...t._parentOptions,isRefreshContainer:!0})):h.displayNotification({message:m.replace(m.bookmarkedSuccess,{number:1,bkname:i}),className:"success"})}).catch(()=>{console.log("error while adding content"),t._isProcessing=!1,t._parentInitMethod({...t._parentOptions,isRefreshContainer:!0})})})},fetchInitNodeProperties(e,t){l.fetch2({ids:e.id,label:"plmNewBk"+Date.now(),onComplete:function(e){if(e){let i={};if(e.results&&e.results.length>0){let n={};e.results[0].attributes.forEach(e=>{n[e.name]=e.value}),n["icon_2ddefaultthb.subtype"]&&"SHARED"===n["icon_2ddefaultthb.subtype"].toUpperCase()&&(i.icons=[{iconName:"bookmark-flash",fontIconFamily:1}]),i.tooltip=new u({title:n.label,shortHelp:n.label,mouseRelativePosition:!0}),i.label=n.label;var o=t.getChildren().length;let s=t.getNthRoot(o-1);s.select(),s.updateOptions(i),s.isSelected()&&(t.removeRoot(s),t.addRoot(s),s.select())}}},onFailure:function(e){console.error(e)}})},getAdditionalNodesAtInit:async function(e,t,o){let i=this;return new Promise((n,s)=>{t?this.addExistingChips(o).then(e=>{if(e.folders){let t=[];e.folders.length>0&&(e.folders.forEach((e,o)=>{t.push(e.id),i._classNameMap.set(e.id,e.label)}),i.PLMNewCommonWebService.getClassPaths({id:t,plmNewContextProvider:i.plmNewContextProvider,onComplete:function(t){const o=i.PLMNewCommonWebService.constructPath(t,"idPathMap");i._classPathMap=o,n(e.folders)},onFailure:function(e){console.log("================",e)}}))}}):null!=this._getActiveBookmarkPromise&&this._getActiveBookmarkPromise.then(t=>{t&&""!=t.id&&(this._currentActiveBookmarkId=t.id,t.icons=this._getIcon(t),t.label=t.label?t.label:m.loading,t.isActiveNode=!0,t.plmType="Folder",n([t]),this.fetchInitNodeProperties(t,e))})}).catch(e=>{console.log(e)})},couldBeSelected:function(e){return!!["Folder","Workspace","Bookmark","Bookmark Root","Workspace Vault","RootFolder"].includes(e)},getFavoriteKey:function(){return"FolderEditorFavoriteFolderList"},_getComponentName:function(){return o.bookmark_defaultTitle},_autoCompleteName:function(){return"Folder"},_getAutocomplete:function(e){return this.autocompleteFolder},getCurrentPreference:function(){return new Promise(function(e,t){var o=p.getCurrentWidgetBookmark(),i=p.getWidgetPreference();o.then(o=>{o&&o.FolderID&&(i={id:o.FolderID,label:o.FolderLabel}),i?e(i):p.getUserPreferences().then(t=>{e(t.startsWith("!")?null:{id:t})}).catch(t)})})},_autocompleteComponent:function(e){return this.autocompleteFolder=this.createAutocompleteComponent(this._getComponentName(),[],e,this.browseAssociations.bind(this,!0,!0)),this.autocompleteFolder},addExistingChips:function(e){let t={};return t.contentId=e,this.PLMNewCommonWebService.getRelatedBookmarks(t)},onClickSelector:function(){var e=this;let t=null;widget&&(widget.body&&(t=new d({identifier:"WebUIPanelDocumentation_IconsTitleWindows"}).inject(widget.body)),widget.addEvent("onLoad",function(e){S=!1})),require(["DS/FolderActive/FolderActive"],function(i){S||(e.folderActiveActionBar=new i({multiSelectionComponent:{withClassify:!0,launchDialog:!0,componentTitle:o.multiSelectionComponent.PLMNewBookmarkWidgetName,OKButtonLabel:o.multiSelectionComponent.button_OK,immersiveFrame:t},popOverDialogProperties:{width:250,height:350,minHeight:250,modalFlag:!0,minWidth:400,icon:"none"},dialogButtons:!0,selectionMode:"DefaultSingle",favoriteButton:!0,handleClassification:!0,OKButtonLabel:o.multiSelectionComponent.button_OK,componentTitle:o.multiSelectionComponent.PLMNewBookmarkWidgetName,isRootSelectable:!0,isClassifyMultiEveDispatch:!0,isonSetActiveEveDispatch:!1,container:widget.body,widgetName:o.multiSelectionComponent.PLMNewBookmarkWidgetName,isClassificationsFacet:!0}),e.folderActiveActionBar.nestedMenuInContext.addEvent("onClassifyMultiple",function(t){var o=t.nodeData,i=[];e.autoComplete.selectedItems&&e.autoComplete.selectedItems.length?e.autoComplete.selectedItems.forEach(e=>{i.push(e.id)}):i=[];var n=[];o.forEach(function(e){i.includes(e.getID())||n.push(e.getID()),e.updateOptions({label:e.options.label,subLabel:m.loading,icon:[e.options.icons]}),S=!1}),n.length&&e.PLMNewCommonWebService.getClassPaths({id:n,plmNewContextProvider:e.plmNewContextProvider,onComplete:function(t){const i=e.PLMNewCommonWebService.constructPath(t,"idPathMap");console.log(i),o.forEach(t=>{if(i.has(t.id)){t.updateOptions({tooltip:new u({title:t.options.label,shortHelp:i.get(t.id),mouseRelativePosition:!0}),value:{subLabel:i.get(t.id)}}),e._classNameMap.set(t.id,t.options.label),e.autoComplete._model.prepareUpdate(),e.insertInAutocomplete(e._getAutocomplete(),t),e.autoComplete._model.pushUpdate();var o=e.autoComplete._model.getChildren().length;e.autoComplete._model.getNthRoot(o-1).select()}})},onFailure:function(e){console.error(e)}}),t.handleUI()}),e.folderActiveActionBar.nestedMenuInContext.addEvent("onSelectorCancel",function(e){S=!1}),S=!0)})},saveRespectiveAssociations:function(e,t,o){let i=this;return new Promise(function(n,s){const r=[];t.forEach(t=>{r.push(new Promise(function(n,s){a.addcontent({pid:t,IDs:[e],plmNewContextProvider:o}).then(o=>{if(o&&"failure"==o.status)n("fail"+t);else{if(i._currentActiveBookmarkId===t){const o={authored:{connected:[[t,e]]}};f.publish("FolderEditor.refresh",o)}n(t)}}).catch(()=>{n("fail"+t)})}))}),Promise.allSettled(r).then(function(e){n(e)})})},setClassNameForSearchData:function(e){e.results.forEach(e=>{const t=e.attributes.find(e=>"physicalid"===e.name),o=e.attributes.find(e=>"ds6w:label"===e.name);o&&this._classNameMap.set(t.value,o.value)})}})});