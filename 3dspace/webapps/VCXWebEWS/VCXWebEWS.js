define("DS/VCXWebEWS/CATContextManager",["DS/VCXWebExperienceBase/VCXContextManager"],function(e){"use strict";var t=e.extend({init:function(){this._parent()},initialize:function(){this._parent(),this._rootInfos={componentType:"CXPExperience_Spec",productType:"Reference3D",name:"NewPresentation",id:"VCX_Root"}},uninitialize:function(){this._parent()},getRootComponentName:function(){if(!this.getCat3DXIntegration())return this._parent();var e=null,t=this.getRootComponent();t&&(e=t.QueryInterface("VCXIModifiable").GetProperty("Actor.Name").GetPropertyValue().GetValue());return e||(e=this._parent()),e},getRootComponent:function(){return this.getCat3DXIntegration()?(this._cRootComponent||(this._cRootComponent=this._experienceBase.getManager("VCXEWSManager").GetExperience()),this._cRootComponent):this._parent()},update:function(e){if(this._parent(e),this.traverseGraphMustBePerformed&&this.useTraverseGraph){var t=this.getRootComponent();if(t)for(var r=t.QueryInterface("VCXIModelNavigable").getChildren(),a=0;a<r.length;a++){var i=r[a].GetObject();i.TraverseGraph&&i.TraverseGraph(null,null,null,0)}this.traverseGraphMustBePerformed=!1}}});return Object.defineProperty(t.prototype,"componentType",{enumerable:!0,get:function(){return"VCXContextManager"}}),t}),define("DS/VCXWebEWS/VCXEWSManagerBase",["require","exports","DS/CAT3DExpModel/XCTEWSObjectModeler","DS/CAT3DExpModel/CAT3DXModel","DS/VCXWebIO/VCXLogServices","i18n!DS/VCXWebEWS/assets/nls/VCXWebEWS","DS/VCXWebSystem/VCXTimeOutPromise"],function(e,t,r,a,i,n,o){"use strict";class s{constructor(){this._physicalID=null}async IsExperienceStarted(){const e=i.generateUUID();let t;i.memoryLog("IsExperienceStarted",!0,e);try{t=await o.resolveWithTimeout(2e4,await a.IsExperienceStarted())}catch(e){throw new Error("Failed to check if experience is started")}return i.memoryLog("IsExperienceStarted",!1,e),t}GetExperience(){return a.GetExperience()}getExperiencePhysicalProduct(){return this._physicalID}set experiencePhysicalProduct(e){this._physicalID=e}async InsertProduct(e,t,r,i){return await a.InsertProduct(e,t,r,i)}async UpdateStateCollection(e,t,r){}async CreateStateCollection(e,t){}async CreateState(e,t,r,a){}async UpdateState(e,t,r,a){}async DeleteState(e,t){}SaveExperience(e){return e?a.SaveExperienceAsNew(e):a.SaveExperience()}SendCommand(e){throw new Error("Not implemented here")}SendFunction(e){throw new Error("Not implemented here")}async initialize(){await this._initializeEws()}async unInitialize(){if(this._ews){try{await this._ews.dispose(),this._physicalID=null}catch(e){console.error(e),console.error("EWS UNINIT FAILED.")}delete this._ews}}async _initializeEws(){try{let e=await this.GetFactory(),t=new r;await t.initialize({experienceBase:this._experienceBase,factory:e,interfacesTable:this.GetEWSInterfacesTable(),componentsTable:this.GetEWSComponentsTable(),managersTable:this.GetEWSManagersTable()}),console.log("initialize EWS done."),this._ews=t}catch(e){console.error(e),this._experienceBase.getManager("VCXNotificationManager").addNotification({level:"error",title:n["Notification.Error"],message:n["Notification.EWS.Message"]})}}GetEWSInterfacesTable(){return{CATIAlias:"DS/CAT3DExpModel/interfaces/CATIAlias",CATI3DExperienceObject:"DS/CAT3DExpModel/interfaces/CATI3DExperienceObject",CATI3DXAssetHolder:"DS/CAT3DExpModel/interfaces/CATI3DXAssetHolder",CATI3DXJSONProcessor:"DS/VIAIdeaExperienceScenarioModelWeb/interfaces/CATI3DXJSONProcessor",CATICXPResourcesMgr:"DS/CATCXPModel/interfaces/CATICXPResourcesMgr",CATI3DXPictureResourceAsset:"DS/StudioResourceModelWeb/interfaces/CATI3DXPictureResourceAsset",CATI3DXSoundResourceAsset:"DS/StudioResourceModelWeb/interfaces/CATI3DXSoundResourceAsset",CATI3DXURLResourceAsset:"DS/StudioResourceModelWeb/interfaces/CATI3DXURLResourceAsset",CATI3DXKeyframerResourceAsset:"DS/StudioResourceModelWeb/interfaces/CATI3DXKeyframerResourceAsset",CATI3DXAssetProperties:"DS/CATCXPModel/interfaces/CATI3DXAssetProperties",CATI3DXMaterialAsset:"DS/CAT3DExpMaterialWeb/interfaces/CATI3DXMaterialAsset",VCXIRessourceAsset:"DS/VCXWebExperienceBase/VCXIRessourceAsset"}}GetEWSComponentsTable(){return{Abstract3DExperienceObject_Spec:{extensions:{CATIAlias:"DS/CAT3DExpModel/extensions/CATEAlias",CATI3DExperienceObject:"DS/VCXWebComposer/CATE3DExperienceObjectNavigable",VCXIModelNavigable:"DS/WebApplicationBase/VCXAModelNavigable",CATI3DXAssetHolder:"DS/CAT3DExpModel/extensions/CATE3DXAssetHolder"}},CXPExperience_Spec:{extensions:{W3AISGNodeHolder:"DS/VCXWebComposer/VCXNodeHolderRoot",VCXIVisibility:"DS/VCXWebVisibility/VCXVisibility",VCXIModifiable:"DS/VCXWebEWS/VCXModifiableRoot",VCXIModifiableView:"DS/VCXWebEWS/VCXModifiableViewRoot",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXIModelNavigable:"DS/VCXWebComposer/VCXModelNavigableRoot",CATICXPResourcesMgr:"DS/CATCXPModel/extensions/CATECXPExperienceResourcesMgr"}},CXPCoveringMaterial_Spec:{extensions:{CATI3DExperienceObject:"DS/CAT3DExpModel/extensions/CATE3DExperienceObject",CATI3DXAssetProperties:"DS/CATCXPModel/extensions/CATE3DXAssetProperties"}},CXPMaterialApplication_Spec:{extensions:{CATI3DExperienceObject:"DS/CAT3DExpModel/extensions/CATE3DExperienceObject"}},ExpTrackManager_Spec:{extensions:{CATI3DExperienceObject:"DS/CAT3DExpModel/extensions/CATE3DExperienceObject",CATI3DXJSONProcessor:"DS/VCXWebExperienceLoader/CATE3DXJSONProcessorExpTrackManager_Spec",CATI3DXAssetHolder:"DS/CAT3DExpModel/extensions/CATE3DXAssetHolder"}},CXPPictureResource_Spec:{extensions:{CATI3DXPictureResourceAsset:"DS/StudioResourceModelWeb/extensions/CATE3DXPictureResourceAsset",VCXIRessourceAsset:"DS/VCXWebExperienceBase/VCXERessourcePictureAsset"}},CXPSoundResource_Spec:{extensions:{CATI3DXSoundResourceAsset:"DS/StudioResourceModelWeb/extensions/CATE3DXSoundResourceAsset"}},CXPURLResource_Spec:{extensions:{CATI3DXURLResourceAsset:"DS/StudioResourceModelWeb/extensions/CATE3DXURLResourceAsset",VCXIRessourceAsset:"DS/VCXWebExperienceBase/VCXERessourceURLAsset"}},CXPKeyframerResource_Spec:{extensions:{CATI3DXKeyframerResourceAsset:"DS/StudioResourceModelWeb/extensions/CATE3DXKeyframerResourceAsset",VCXIRessourceAsset:"DS/VCXWebExperienceBase/VCXERessourceKeyFramerAsset"}}}}GetEWSManagersTable(){return{}}}return Object.defineProperty(s.prototype,"componentType",{enumerable:!0,get:function(){return"VCXEWSManager"}}),s}),define("DS/VCXWebEWS/interfaces/VCXResultExperienceStarted",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("DS/VCXWebEWS/VCXModifiableRoot",["DS/VCXWebModifiablesImpl/VCXModifiableOccurrence","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyGroup","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables"],function(e,t,r,a,i,n,o,s){"use strict";return e.extend({init:function(){this._parent()},OnChangeProperty:function(e,t,r){if(r||(r={}),r.fromChildClass);else if(this.OnChangePropertyBegin(e,t))return!0;switch(e){case"Actor.Name":return this.QueryInterface("CATI3DExperienceObject").SetValueByName("_varName",t.Value),!0;default:return r.fromChildClass=!0,this._parent(e,t,r)}},GetProperty:function(e){var t=null;if("Actor.Name"===e){var a=this.QueryInterface("CATI3DExperienceObject").GetValueByName("_varName");if(a){var o=new n;o.SetValue(a),t=new r(new i("Actor.Name",2,!1,s),o)}}else t=this._parent(e);return t},GetProperties:function(){var e=new t;return e.AddOrModifyProperty(this.GetProperty("Actor.Name")),e.AddOrModifyProperty(this.GetProperty("GUIManager.DisplayScenarioImmersiveUI")),e},OnChangePropertiesEnd:function(){}})}),define("DS/VCXWebEWS/VCXWebEWSDictionary",[],function(){"use strict";var e={CATContextManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXActorDocManager:{CATI3DExperienceObject:"DS/CAT3DExpModel/extensions/CATE3DExperienceObject"},CAT3DXLinkManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},CAT3DXLoaderManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},ExpTrackManager_Spec:{CATI3DExperienceObject:"DS/CAT3DExpModel/extensions/CATE3DExperienceObject",CATI3DXJSONProcessor:"DS/VCXWebExperienceLoader/CATE3DXJSONProcessorExpTrackManager_Spec",CATI3DXAssetHolder:"DS/CAT3DExpModel/extensions/CATE3DXAssetHolder"},VCXDigger_Spec:{CATI3DExperienceObject:"DS/CAT3DExpModel/extensions/CATE3DExperienceObject"},VCXViewport_Spec:{CATI3DExperienceObject:"DS/CAT3DExpModel/extensions/CATE3DExperienceObject"},VCXLinearArrow_Spec:{CATI3DExperienceObject:"DS/CAT3DExpModel/extensions/CATE3DExperienceObject"},VCXCircularArrow_Spec:{CATI3DExperienceObject:"DS/CAT3DExpModel/extensions/CATE3DExperienceObject"},VCXCornerArrow_Spec:{CATI3DExperienceObject:"DS/CAT3DExpModel/extensions/CATE3DExperienceObject"},VCXCircle_Spec:{CATI3DExperienceObject:"DS/CAT3DExpModel/extensions/CATE3DExperienceObject"},VCXRedLine_Spec:{CATI3DExperienceObject:"DS/CAT3DExpModel/extensions/CATE3DExperienceObject"},VCXCompass_Spec:{CATI3DExperienceObject:"DS/CAT3DExpModel/extensions/CATE3DExperienceObject"},VCXPanel_Spec:{CATI3DExperienceObject:"DS/CAT3DExpModel/extensions/CATE3DExperienceObject"},VCXDiggerPanel_Spec:{CATI3DExperienceObject:"DS/CAT3DExpModel/extensions/CATE3DExperienceObject"},VCXLabel_Spec:{CATI3DExperienceObject:"DS/CAT3DExpModel/extensions/CATE3DExperienceObject"},VCXMeasurement_Spec:{CATI3DExperienceObject:"DS/CAT3DExpModel/extensions/CATE3DExperienceObject"},VCXSection_Spec:{CATI3DExperienceObject:"DS/CAT3DExpModel/extensions/CATE3DExperienceObject"},VCX3DGrid_Spec:{CATI3DExperienceObject:"DS/CAT3DExpModel/extensions/CATE3DExperienceObject"},VCXCallout_Spec:{CATI3DExperienceObject:"DS/CAT3DExpModel/extensions/CATE3DExperienceObject"},VCXPolyline_Spec:{CATI3DExperienceObject:"DS/CAT3DExpModel/extensions/CATE3DExperienceObject"},VCXMagnetLine_Spec:{CATI3DExperienceObject:"DS/CAT3DExpModel/extensions/CATE3DExperienceObject"},VCXPartList_Spec:{CATI3DExperienceObject:"DS/CAT3DExpModel/extensions/CATE3DExperienceObject"},VCXActorList_Spec:{CATI3DExperienceObject:"DS/CAT3DExpModel/extensions/CATE3DExperienceObject"},VCXInternalMaterial_Spec:{VCXIMaterialCache:"DS/VCXWebKernel/VCXEInternalMaterialCache"},CXPCoveringMaterial_Spec:{VCXIMaterialCache:"DS/VCXWebKernel/VCXECoveringMaterialCache"}},t={VCXIMaterialCache:"DS/VCXWebKernel/VCXIMaterialCache"},r={CAT3DXLinkManager:"DS/CAT3DExpModel/managers/CAT3DXLinkManager",CAT3DXLoaderManager:"DS/CAT3DExpModel/managers/CAT3DXLoaderManager",VCXContextManager:"DS/VCXWebEWS/CATContextManager",VCXInternalMaterial_Spec:"DS/VCXWebKernel/VCXInternalMaterial_Spec"},a=[];return{GetDictionary:function(){return{interfaces:t,components:r,extensions:e}},getNLSModules:function(){return a}}}),define("DS/VCXWebEWS/CXPExperienceObjectVCXCXPConvertor",["DS/CAT3DExpModel/extensions/CATE3DExpVCXObjectConvertor","DS/CAT3DExpModel/interfaces/CATI3DExperienceObject","DS/VCXWebProperties/VCXColor","DS/Visualization/ThreeJS_DS"],function(e,t,r,a){"use strict";var i=e.extend({init:function(){},_variablesToProperties:function(e){var t=this.QueryInterface("VCXIModifiable");for(var r in e._map)e._map.hasOwnProperty(r)&&t.OnChangeProperty(r,e._map[r].GetPropertyValue())},GetNeutralsFromVariables:function(e){let t=this.getTab();t&&t.forEach(function(t){var r;(r="Vector3"===t.type?this.variableToPropertyVector3(t.variableName,e,t.propertyName,t.NFVFunction):this.variableToProperty(t.variableName,e,t.propertyName,t.NFVFunction))&&e.AddOrModifyProperty(r)}.bind(this)),this._variablesToProperties(e)},UpdateVariablesFromNeutrals:function(e,t){let r=this.getTab();r&&r.forEach(function(r){"Vector3"===r.type?this.propertyToVariableVector3(e,r.propertyName,t,r.variableName,r.VFNFunction):this.propertyToVariable(e,r.propertyName,t,r.variableName,r.VFNFunction)}.bind(this))},variableToPropertyVector3:function(e,t,r,i){var n=this.QueryInterface("CATI3DExperienceObject");if(n&&n.HasVariable(e+" X")&&n.HasVariable(e+" Y")&&n.HasVariable(e+" Z")){var o,s=new a.Vector3(n.GetValueByName(e+" X"),n.GetValueByName(e+" Y"),n.GetValueByName(e+" Z"));o=i?i(s):s;var c=this.QueryInterface("VCXIModifiable").GetProperty(r);if(c){var l=c.Clone();if(null!=o)return l.GetPropertyValue().SetValue(o),l}}},_getMaterialVariableValue:function(e,a){const i=e.QueryInterface("CATI3DExperienceObject");if(1!==i.GetVariableMaxNumberOfValues(a))return;const n=i.GetVariableType(a),o=i.GetValueByName(a);if(void 0===o)return;switch(n){case t.VarType.Integer:case t.VarType.Double:case t.VarType.String:case t.VarType.Boolean:case t.VarType.Color:return o}const s=o.QueryInterface("CATI3DExperienceObject");switch(o.GetType()){case"Color_Spec":{let e=new r;return e.SetRGBA(s.GetValueByName("r")/255,s.GetValueByName("g")/255,s.GetValueByName("b")/255,s.GetValueByName("a")/255),e}case"Vector3D_Spec":return[s.GetValueByName("x"),s.GetValueByName("y"),s.GetValueByName("z")]}},propertyToVariableVector3:function(e,t,r,a,i){var n=this.QueryInterface("CATI3DExperienceObject");if(n&&n.HasVariable(a+" X")&&n.HasVariable(a+" Y")&&n.HasVariable(a+" Z")){var o=this.GetObject(),s=e._map[t];if(s){var c,l=s.GetPropertyValue().Value;c=i?i(l):l,r.push({object:o,variableName:a+" X",variableValues:c.x}),r.push({object:o,variableName:a+" Y",variableValues:c.y}),r.push({object:o,variableName:a+" Z",variableValues:c.z}),e.RemoveProperty(t)}}},variableToProperty:function(e,t,r,a){var i=this.QueryInterface("CATI3DExperienceObject");if(i&&i.HasVariable(e)){var n,o=this._getMaterialVariableValue(i,e);n=a?a(o):o;var s=this.QueryInterface("VCXIModifiable").GetProperty(r);if(s){var c=s.Clone();if(null!=n)return c.GetPropertyValue().SetValue(n),c}}},propertyToVariable:function(e,r,a,i,n){var o=this.QueryInterface("CATI3DExperienceObject");if(o&&o.HasVariable(i)){var s=this.GetObject(),c=e._map[r];if(c){var l,p=c.GetPropertyValue().Value;if(l=n?n(p):p,o.GetVariableType(i)===t.VarType.Object){let e=o.GetValueByName(i);const t=e.QueryInterface("CATI3DExperienceObject");switch(e.GetType()){case"Color_Spec":a.push({object:t,variableName:"r",variableValues:255*l.r}),a.push({object:t,variableName:"g",variableValues:255*l.g}),a.push({object:t,variableName:"b",variableValues:255*l.b}),a.push({object:t,variableName:"a",variableValues:255*l.a});break;case"Vector3D_Spec":a.push({object:t,variableName:"x",variableValues:l.x}),a.push({object:t,variableName:"y",variableValues:l.y}),a.push({object:t,variableName:"z",variableValues:l.z})}}else a.push({object:s,variableName:i,variableValues:l});e.RemoveProperty(r)}}},getTab:function(){return this._tab}});return Object.defineProperty(i.prototype,"componentType",{enumerable:!0,get:function(){return"CXPExperienceObjectVCXCXPConvertor"}}),i}),define("DS/VCXWebEWS/VCXModifiableViewRoot",["DS/VCXWebModifiablesImpl/VCXModifiableViewOccurrence","DS/VCXWebProperties/VCXPropertyGroup","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables","i18n!DS/VCXWebEWS/assets/nls/VCXWebEWS"],function(e,t,r,a){"use strict";return e.extend({init:function(){this._parent()},getPropertyGroups:function(e){e||(e={});var i=this.getGroupPropertiesOrders();return e["Group.Essentials"]||(e["Group.Essentials"]=new t({groupID:"Group.Essentials"}),e["Group.Essentials"].i18nGroup=r),e["Group.Essentials"].setPropertiesOrder(i["Group.Essentials"]),e["Group.Essentials"].priority=0,e["Group.Essentials"].addProperties([{propertyName:"Actor.Name",i18n:a}]),e},getGroupPropertiesOrders:function(){return{"Group.Essentials":["Actor.Name"]}}})}),define("DS/VCXWebEWS/VCXWebEWSDictionaryFD02",[],function(){"use strict";var e={CXPRenderingFeature_Spec:{CATI3DExpVCXObjectConvertor:"DS/VCXWebDressup/CXPRenderingFeatureModelVCXCXPConvertor",VCXIModifiableView:"DS/VCXWebDressup/VCXRenderingFeatureModifiableView",VCXIModifiable:"DS/VCXWebDressup/VCXRenderingFeatureModelModifiable",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeMaterial",VCXIVisibility:"DS/VCXWebVisibilityImpl/VCXVisibilityShow",CATIAlias:"DS/CAT3DExpModel/extensions/CATEAlias",CATI3DExperienceObject:"DS/VCXWebComposer/CATE3DExperienceObjectNavigable",VCXIModelNavigable:"DS/WebApplicationBase/VCXAModelNavigable",CATI3DXAssetHolder:"DS/CAT3DExpModel/extensions/CATE3DXAssetHolder"},CXPCoveringMaterial_Spec:{VCXISelectBehavior:"DS/VCXWebDressup/VCXCoveringMaterialSelectBehavior"},VCXColor:{CATIAlias:"DS/CAT3DExpModel/extensions/CATEAlias",CATI3DExperienceObject:"DS/VCXWebComposer/CATE3DExperienceObjectNavigable",VCXIModelNavigable:"DS/WebApplicationBase/VCXAModelNavigable",CATI3DXAssetHolder:"DS/CAT3DExpModel/extensions/CATE3DXAssetHolder"}},t={},r={CXPRenderingFeature_Spec:"DS/VCXWeb3DMaster/CXPRenderingFeature_Spec"},a=[];return{GetDictionary:function(){return{interfaces:t,components:r,extensions:e}},getNLSModules:function(){return a}}}),define("DS/VCXWebEWS/VCXExperienceServices",["require","exports","DS/VCXWebIO/VCXLogServices","i18n!DS/VCXWebEWS/assets/nls/VCXWebEWS","DS/VCXWebPlatform/VCX3DSpaceServices"],function(e,t,r,a,i){"use strict";class n{static async onLoadExperienceFromPhysicalID(e,t,o,s,c=!1){var l=e.getManager("VCXGUIManager").getGettingStartedUI();let p=void 0;s&&(p=s.replace("ctx::",""));let C=e.getManager("VCXNotificationManager").addProgressNotification({strObjectName:a["ProgressNotification.Loading"],strAction:a["ProgressNotification.FetchingData"],maskDisplayAdd:18}),d=await i.getObjectSecurityContextFromExperienceID(o);d&&(p=d,i.SetPreferredSecurityContext(d));let u="authoringMode";c&&(u=await e.getManager("VCXGUIManager").displayOpenOrPlayExperience(c)),localStorage.setItem("DS_PRODUCTHIGHLIGHT_OPEN_PLAY",u);let D={physicalID:o,strExperienceName:t,securityContext:p};l.curtainFade();const g=r.generateUUID();r.memoryLog("Load Experience",!0,g,{name:t,parameterName:"experience"}),e.getManager("VCXNotificationManager").endProgressNotification(C,!0),e=await n.CreateNewExperienceBase(e),D.experience=e,"record"===e.odt&&e.getManager("VCXODTManager").LogAPI("VCXOpenExperienceFromPLMId",{label:t,id:o});try{D.catexperience=await e.getManager("VCXCAT3DXModelManager").LoadExperienceFromPhysicalID(o,t,p)}catch(t){if("replay"===e.odt)throw t;var b=t.message,A="",E="A crash occured.";let r=e.getManager("VCXCAT3DXModelManager").GetScenarioType();throw-1!==b.indexOf(r)?(E="This type is not supported.",A="Hint : Please choose a "+r):"Some product's collabspace is not accessible. Please contact the experience owner."===t.message&&(E="Some product's collabspace is not accessible.",A="Please contact the experience owner."),console.log(b),D.experience=await n.CloseExperienceAndReset(e,{level:"error",title:a["Notification.ExpCantOpen.Title"],subtitle:E,message:A},t),new Error(t)}return r.memoryLog("Load Experience",!1,g,{name:t,parameterName:"experience"}),l.endLoadingExperience(),D}static async CreateNewExperienceBase(e){return e=localStorage.getItem("VCX_WebAppBaseSupport")&&"true"===localStorage.getItem("VCX_WebAppBaseSupport")?await e.webApplication.RequestNewExperienceBase():await e.webApplication.requestNewExperienceBaseAsync()}static async CloseExperienceAndReset(e,t,r){try{if(e=await this.CreateNewExperienceBase(e),t)e.getManager("VCXGUIManager").getGettingStartedUI().failLoadingExperience(),e.getManager("VCXNotificationManager").addNotification(t);return e}catch(e){throw console.error(e),new Error("CloseExperienceAndReset failed")}}static async _createNewExperience(e,t,i=!1,o){var s=!0;if(e.getManager("VCXContextManager").getRootComponent()){if(!o||"3dxml"!==o.type)return{experience:e,newExperienceCreated:!1};s=!1}e.getManager("VCXGUIManager").getGettingStartedUI().curtainFade();var c=null;let l=await e.getManager("VCXGUIManager").DisplayModalPanelInit(t,o,s);if("Close"===l)return l;if(!s)return l.newExperienceCreated=!1,l.experience=e,l;e=await this.CreateNewExperienceBase(e);const p=r.generateUUID();try{let t=18;!l||void 0!==l.insertProducts&&!0!==l.insertProducts?l&&void 0!==l.insertProducts&&!1===l.insertProducts&&(c=e.getManager("VCXNotificationManager").addProgressNotification({strObjectName:l.collabspace,strAction:a["ProgressNotification.ConnectTo"],maskDisplayAdd:t}),r.memoryLog("CreateExperience",!0,p,{name:l.experienceName,parameterName:"experience"}),await e.getManager("VCXCAT3DXModelManager").CreateExperience(l.experienceName,l)):(c=e.getManager("VCXNotificationManager").addProgressNotification({strObjectName:l.experienceName,strAction:a["ProgressNotification.Init"],maskDisplayAdd:t}),r.memoryLog("CreateExperience",!0,p,{name:l.experienceName,parameterName:"experience"}),await e.getManager("VCXCAT3DXModelManager").CreateExperience(l.experienceName,l))}catch(t){throw console.log(t.message),await n.CloseExperienceAndReset(e,{level:"error",title:a["Notification.ExpCreationFailed.Title"]},t),t}return r.memoryLog("CreateExperience",!1,p,{name:l.experienceName,parameterName:"experience"}),i&&await e.getManager("VCXCAT3DXModelManager").OnEndLoading(!0),e.getManager("VCXNotificationManager").endProgressNotification(c),l.newExperienceCreated=s,l.experience=e,l}static async SessionRecover(e){var t=e.getManager("VCXContextManager").IsLocalMode(),r=e.getManager("VCXContextManager").isSupported("Cat3DXIntegration");if(!t&&r){var i=e.getManager("VCXCAT3DXModelManager");try{let t=e.getManager("VCXNotificationManager").addProgressNotification({strAction:a["ProgressNotification.Recovering"],maskDisplayAdd:18});await i.RestoreAuthoringVariableValues(),await i.RetrieveExperienceFromServer(),e.getManager("VCXNotificationManager").endProgressNotification(t)}catch(t){throw await n.CloseExperienceAndReset(e,{level:"error",title:a["Notification.SessionNotRecovered.Title"]},t),t}return console.log("RetrieveExperienceFromServer done."),e}}static async DisplaySaveBeforeCloseModal(e){try{let t=await e.getManager("VCXGUIManager").createSaveBeforeCloseModal();return"Close"===t?Promise.resolve():("Save"===t&&await e.getManager("VCXCAT3DXModelManager").SaveExperience(),await n.CloseExperienceAndReset(e))}catch(t){throw console.error(t),e.getManager("VCXNotificationManager").addNotification({level:"error",title:a["Notification.Error"],message:a["Notification.CloseExpFailed.Message"]}),t}}static async onCreateEmptyExperience(e,t=""){try{let r=await n._createNewExperience(e,t,!0);return"Close"===r?r:(r.newExperienceCreated&&(e=r.experience),e.getManager("VCXGUIManager").getGettingStartedUI().endLoadingExperience(),r)}catch(t){throw await n.CloseExperienceAndReset(e,{level:"error",title:a["Notification.NewExpCreationFailed.Title"]},t),t}}static async onDropProduct(e,t,r,i){if(!r.getManager("VCXContextManager").isSupported("OpenProduct"))throw new Error("Products are not supported.");let o=await n._createNewExperience(r,e);o.newExperienceCreated&&(r=o.experience),"record"===r.odt&&r.getManager("VCXODTManager").LogAPI("VCXNewExperienceFromPLMId",{label:e,id:t});let s=void 0,c=!1;try{const l=r.getManager("VCXEWSManager"),p=l.getEmptyCsiParameters();p.writeString("plmId",t);const C=l.getEmptyCsiParameters();C.writeParameters("plmId","PLMID",p);const d=await l.SendFunction({name:"getPrototypeNameFromPLMIdFunc",parameters:C});if(!d||d&&"Model_VPMReference_Spec"!==d.readString("defaultPrototype"))throw new Error(a["Notification.Failed.NotSupported"]+" : "+i+"/"+d.readString("defaultPrototype"));console.log("Opening type "+i),c=!0,s=await r.getManager("VCXCAT3DXModelManager").InsertProduct(e,t,o),o.product=s}catch(e){let t=UWA.Element("div",{html:a[c?"Notification.FailedContent.Message":"Notification.Failed.NotSupported"]});const i={level:"error",title:a["Notification.Error"],subtitle:t,sticky:!0};o.newExperienceCreated?o.experience=await n.CloseExperienceAndReset(r,i,e):r.getManager("VCXNotificationManager").addNotification(i)}return o}static async onDropDocument(e,t,r){var i,o=r.getManager("VCXGUIManager").getGettingStartedUI();await r.getManager("VCXCAT3DXModelManager").IsDocumentSupported(t);let s=await n._createNewExperience(r,e);s.newExperienceCreated&&(r=s.experience);return i=r.getManager("VCXNotificationManager").addProgressNotification({strObjectName:e,strAction:a["ProgressNotification.Loading"],maskDisplayAdd:18}),await r.getManager("VCXCAT3DXModelManager").LoadLinkFromCollabSpace(t),o.endLoadingExperience(),r.getManager("VCXNotificationManager").endProgressNotification(i),s}static async onDropAmbience(e,t,r,a){var i=a.getManager("VCXGUIManager").getGettingStartedUI();let o=await n._createNewExperience(a,e);o.newExperienceCreated&&(a=o.experience);let s=await a.getManager("VCXCAT3DXModelManager").InsertAmbience(e,r,t);return o.ambience=s,i.endLoadingExperience(),o}static async onDropMaterial(e,t,r,i){var n=[];if(i.getManager("VCXSelectionManager").ProcessComponentsFromSelection("CSO",e=>{e.IsKindOf("VCXComponentOccurrenceComposer")&&(e.IsMesh()||i.getManager("VCXContextManager").isSupported("FullFeaturesOnNodes"))&&n.push(e)}),n.length)return i.getManager("VCXCAT3DXModelManager").InsertMaterial(e,r,t,n);var o;o=a["VCXPlatformServicesManager.InsertMaterialUnavailable"];var s=new Error(o);throw s.criticity="Warning",s}static async onDropCtxpInSTDA(e,t,r){r=await r.webApplication.requestNewExperienceBaseAsync(),await r.getManager("VCXCAT3DXModelManager").CreateExperience();var a=r.getManager("VCXContextManager").getRootComponent();return(await r.getManager("VCXCAT3DXModelManager").CreateCityActorExternal("CIDAsset_Spec","CIDAsset_Spec",a)).SetAssetID(e),await r.getManager("CityUrbanManager").LoadModel(t),await r.getManager("CityUrbanManager").TraverseDataModel(),await r.getManager("VCXCAT3DXModelManager").OnEndLoading(!0),r.getManager("VCXGUIManager").getGettingStartedUI().endLoadingExperience(),r}static async handle3DXML(e,t){if(!t.getManager("VCXContextManager").isSupported("OpenProduct"))throw new Error("Products are not supported.");try{let i=e&&Object.keys(e)[0],o=await n._createNewExperience(t,i,!1,{type:"3dxml"});o.newExperienceCreated&&(t=o.experience);const s=r.generateUUID();r.memoryLog("Insert3DXML",!0,s,{name:i,parameterName:"product"});let c=await t.getManager("VCXCAT3DXModelManager").Insert3DXML(e,o);return c=await n.treat3DXMLResults(c,t),r.memoryLog("Insert3DXML",!1,s,{name:i,parameterName:"product"}),c}catch(e){throw await n.CloseExperienceAndReset(t,{level:"error",title:a["Notification.NewExpCreationFailed.Title"]},e),e}}static async treat3DXMLResults(e,t){if(!e)return;let r=e.elementCounter;if(!r)return console.warn("no count of element was found"),e;let i=r.products,o=r.ambiences,s=r.materials,c=r.presentations;if(e.newExperienceCreated){let r=!1;e.insertFailed&&(r=!0),e.insertProducts||(r=!0),e.insertProducts&&0===e.productsToInsert.length&&(r=!0),r&&await n.CloseExperienceAndReset(t)}if(e.insertFailed){let e=UWA.Element("div",{html:a["Notification.InsertFailed.SubTitle"]});const r={level:"error",title:a["Notification.InsertFailed.Title"],subtitle:e,sticky:!0};t.getManager("VCXNotificationManager").addNotification(r)}else{let e=UWA.Element("div",{html:"The <b>imported file</b> contains:<br> - <b>"+i+"</b> products<br> - <b>"+o+"</b> ambiences<br> - <b>"+s+"</b> materials<br> - <b>"+c+"</b> presentations "});const r={level:"info",title:a["Notification.InsertOk.Title"],subtitle:e,sticky:!0};t.getManager("VCXNotificationManager").addNotification(r)}return e}}return n});