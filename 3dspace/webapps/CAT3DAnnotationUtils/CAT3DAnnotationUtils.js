/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/CAT3DAnnotationUtils/CAT3DAnnotationUtils",["DS/Visualization/ThreeJS_DS","DS/Mesh/Mesh","DS/Visualization/Node3D","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/WebappsUtils/WebappsUtils","DS/CATWebUXComponents/DMUCommandsManager","DS/Visualization/SceneGraphFactory","DS/PADUtils/PADSettingsMgt"],function(e,t,n,r,i,a,s,o){"use strict";var c,u,l=i.getWebappsAssetUrl("CAT3DAnnotationUtils","icons/22/"),f={setLoadedAssetType:function(e){c=e},getLoadedAssetType:function(){return c},getLoadedStream:function(e,t){return r.getLoadedStream(e,t)},getNodeInfos:function(e){var t={};return e?("3DXML"===c&&(t.name=e.name,f.isReference(e)&&(t.icon=l+"I_Reference.png"),f.isRepReference(e)&&(t.icon=l+"I_Part.png")),t):null},getNodeType:function(e){var t=r.getNodeType(e);return t||((t=e.getType?e.getType():t)?t:t=e.productType)},getNodeID:function(e){if("3DXML"===c)return e.persistentId;var t=r.getNodeID(e);return!t&&e&&e.getID&&(t=e.getID()),t},getRoots:function(e){if("3DXML"!==c)return r.getRoots(e);for(var t=e.getRootBagPath().getChildrenPathes(),n=[],i=0;i<t.length;i++)n.push(t[i].getLastElement(!0));return n},is3DLeaf:function(e){return"3DXML"!==c?r.is3DLeaf(e):f.isRepReference(e)},isPLMNode:function(e){if("3DXML"!==c)return r.isPLMNode(e);var t=f.getNodeType(e);return null!=t&&""!==t},isReference:function(e){if(e){if("3DXML"!==c){var t=r.isReference(e);return t||(t=!(!e.isPLMReference||"function"!=typeof e.isPLMReference)&&e.isPLMReference())}return!!e.productType&&"Reference3D"===e.productType}},isRepReference:function(e){if(e){if("3DXML"!==c){var t=r.isRepReference(e);return t||(t=!(!e.isPLMRepReference||"function"!=typeof e.isPLMRepReference)&&e.isPLMRepReference())}return!!e.productType&&"ReferenceRep"===e.productType}},isRepInstance:function(e){if(e){if("3DXML"!==c){var t=r.isRepInstance(e);return t||(t=!(!e.isPLMRepInstance||"function"!=typeof e.isPLMRepInstance)&&e.isPLMRepInstance())}return!!e.productType&&"InstanceRep"===e.productType}},isInstance:function(e){if(e){if("3DXML"!==c){var t=r.isInstance(e);return t||(t=!(!e.isPLMInstance||"function"!=typeof e.isPLMInstance)&&e.isPLMInstance())}return!!e.productType&&"Instance3D"===e.productType}},solveAttributeLink:function(e){if(e&&e.phyID){require(["DS/PADUtils/PADUtilsServices","DS/TransientWidget/TransientWidget"],function(t,n){var r,i;if(e)if(512&e.type||1024&e.type){var s=a.getCommand("CAT3DAnnotSemanticSolveAttrLinkHdr",e.cmdContext);e.context.getExecutionContext?s.begin({args:{getSecurityContext:function(){return o.getSetting("pad_security_ctx")},getSelectedNodes:function(){return[{attrLinkID:e.phyID,getID:function(){return this.attrLinkID}}]}}}):s.launchProperties({getSecurityContext:function(){return o.getSetting("pad_security_ctx")},getSelectedNodes:function(){return[{attrLinkID:e.phyID,getID:function(){return this.attrLinkID}}]}})}else r={appID:"X3DPLAW_AP",title:e.title?e.title:e.url,physicalid:e.phyID,type:e.phyType},i={protocol:"3DXContent",version:"0.1",source:"X3DCSMA_AP",data:{items:[{envId:t.getPlatformId(),serviceId:"3DSpace",objectId:r.physicalid,objectType:r.type,contextId:o.getSetting("pad_security_ctx")}]}},n.showWidget(r.appID,r.title,{x3dSharedId:window.widget.getValue("x3dSharedId"),x3dPlatformId:window.widget.getValue("x3dPlatformId"),X3DContentId:JSON.stringify(i)})})}},create2DClippingRepresentation:function(r){var i,a=new e.LineBasicMaterial({color:new e.Color("#FFFFFF"),lineWidth:1,opacity:1,force:!0,dashType:t.LinePatternEnum.DOTDASHED,isCPUPattern:!0,polygonBorderMode:!0});if("circular"===r.type)(i=s.createCircleNode({radius:r.radius,fill:!1,segments:30,material:a})).setMatrix((new e.Matrix4).setPosition(new e.Vector3(r.center.x,r.center.y,0)));else{var o=[];r.points.forEach(function(t){o.push(new e.Vector3(t.x,t.y,0))}),o.push(new e.Vector3(r.points[0].x,r.points[0].y,0)),i=s.createLineNode({points:o,material:a})}i.setShadow(!1),i.setPickParent(!0);var c=new n;return c.addChild(i),c},_sendUsageProbe:function(e,t,n){if(u){var r=u.getPADTracker({eventCategory:"usage",eventAction:e}),i={eventLabel:t};void 0!==n&&(i.eventValue=n),r.setEventData(i),r.trackPageEvent()}else require(["DS/PADServices/utils/PADTrackerManager"],function(e,t,n,r){u=r,this._sendUsageProbe(e,t,n)}.bind(this,e,t,n))}};return f}),define("DS/CAT3DAnnotationUtils/CAT3DAnnotationUtilsOptions",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Utils"],function(e,t,n,r){"use strict";return t.singleton(n,{init:function(){var t={};window.annotUrlComplementForODT&&(t=r.parseQuery(window.annotUrlComplementForODT)),""!==window.location.search&&(e.extend(t,r.parseQuery(window.location.search)),t.widgetDomain&&e.extend(t,r.parseQuery(t.widgetDomain)));for(var n={},i=Object.keys(t),a=0;a<i.length;a++)n[i[a]]=!0;"debug_me"in t&&(n.debug=!0),!0===window.debug&&(n.debug=!0),!0===window.AutomaticAttrScroll&&(n.AutomaticAttrScroll=!0),!0===window.CAT3DANN_FILTER_PANEL_VER1&&(n.CAT3DANN_FILTER_PANEL_VER1=!0),!0===window.testWkb&&(n.testWkb=!0),parseFloat(window.CAT3DGRID_MAXLABEL)&&(n.CAT3DGRID_MAXLABEL=parseFloat(window.CAT3DGRID_MAXLABEL)),this.setOptions(n)}})}),define("DS/CAT3DAnnotationUtils/CAT3DAnnotationStorageController",["UWA/Core","UWA/Controls/Abstract","DS/CoreEvents/ModelEvents","DS/CAT3DAnnotationUtils/CAT3DAnnotationUtils","i18n!DS/CAT3DAnnotationUtils/assets/nls/CAT3DAnnotationUtils","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/CATWebUXPreferences/CATWebUXPreferencesManager","i18n!DS/CAT3DAnnotationRsc/assets/nls/CAT3DAnnotationAttributesCategories"],function(e,t,n,r,i,a,s,o){"use strict";var c=t.singleton({init:function(){var t=new n,u=this;let l,f=null,A={},d={},b=0,p=!1;this.getUnitDetails=function(e,t){return a[e.charAt(0).toUpperCase()+e.slice(1)][t[e.charAt(0).toUpperCase()+e.slice(1)]]};this.initPrefManager=async function(e){b++,p||(b>1&&!p?await new Promise(e=>{let t=setInterval(function(){p&&(clearInterval(t),e())},100)}):(await async function(){try{let e=(await a.readPreferences([{Repository:"3DAnnotRepository",PreferenceNames:["WhiteVectorAsBlack","LoadLevelAssemblyAnnotations","LoadARMAnnotations","LoadFirstAssemblyLevelAnnotations","FirstAssemblyLevelAnnotationsPrefix","FirstAssemblyLevelAnnotationsSuffix","DisplayOnlyCaptures","UpdateThumbnails","KeepSelectedFeatures","FavoriteContextLoadMode","SemanticAttribute_3DAnnotations","SemanticAttribute_0","SemanticAttribute_1","SemanticAttribute_2","SemanticAttribute_3","SemanticAttribute_4","SemanticAttribute_5","SemanticAttribute_6","SemanticAttribute_7"]},{Repository:"cke"}])).repositories;for(let t=0;t<e.length;t++)if("3DAnnotRepository"===e[t].name){let n=e[t].preferences;for(let e=0;e<n.length;e++)"WhiteVectorAsBlack"===n[e].name?A.whiteVectorAsBlack="true"===n[e].value:"LoadLevelAssemblyAnnotations"===n[e].name?A.loadLevelAssemblyAnnotations="true"===n[e].value:"LoadARMAnnotations"===n[e].name?A.loadARMAnnotations="true"===n[e].value:"LoadFirstAssemblyLevelAnnotations"===n[e].name?A.loadFirstAssemblyLevelAnnotations="true"===n[e].value:"FirstAssemblyLevelAnnotationsPrefix"===n[e].name?A.firstAssemblyLevelAnnotationsPrefix=n[e].value:"FirstAssemblyLevelAnnotationsSuffix"===n[e].name?A.firstAssemblyLevelAnnotationsSuffix=n[e].value:"DisplayOnlyCaptures"===n[e].name?A.displayOnlyCaptures="true"===n[e].value:"UpdateThumbnails"===n[e].name?A.updateThumbnails="true"===n[e].value:"KeepSelectedFeatures"===n[e].name?A.keepSelectedFeatures="true"===n[e].value:"FavoriteContextLoadMode"===n[e].name?A.favoriteContextLoadMode=n[e].value:"SemanticAttribute_3DAnnotations"===n[e].name?A.semanticAttribute_3DAnnotations="true"===n[e].value:"SemanticAttribute_0"===n[e].name?A.semanticAttribute_0="true"===n[e].value:"SemanticAttribute_1"===n[e].name?A.semanticAttribute_1="true"===n[e].value:"SemanticAttribute_2"===n[e].name?A.semanticAttribute_2="true"===n[e].value:"SemanticAttribute_3"===n[e].name?A.semanticAttribute_3="true"===n[e].value:"SemanticAttribute_4"===n[e].name?A.semanticAttribute_4="true"===n[e].value:"SemanticAttribute_5"===n[e].name?A.semanticAttribute_5="true"===n[e].value:"SemanticAttribute_6"===n[e].name?A.semanticAttribute_6="true"===n[e].value:"SemanticAttribute_7"===n[e].name&&(A.semanticAttribute_7="true"===n[e].value)}else if("cke"===e[t].name){for(let n=0;n<e[t].preferences.length;n++)d[e[t].preferences[n].name]=e[t].preferences[n].value;d.TrailingZeros&&(d.TrailingZeros="true"===d.TrailingZeros)}}catch(e){A.whiteVectorAsBlack=!0,A.loadLevelAssemblyAnnotations=!1,A.loadARMAnnotations=!1,A.loadFirstAssemblyLevelAnnotations=!1,A.firstAssemblyLevelAnnotationsPrefix="",A.firstAssemblyLevelAnnotationsSuffix="",A.displayOnlyCaptures=!1,A.updateThumbnails=!0,A.keepSelectedFeatures=!0,A.favoriteContextLoadMode="Check",A.semanticAttribute_3DAnnotations=!0,A.semanticAttribute_0=!0,A.semanticAttribute_1=!0,A.semanticAttribute_2=!0,A.semanticAttribute_3=!0,A.semanticAttribute_4=!0,A.semanticAttribute_5=!0,A.semanticAttribute_6=!0,A.semanticAttribute_7=!0,d={TrailingZeros:!1,Length:"Millimeter",LengthDisplay:"3",LengthCalcDisplay:"3",Angle:"Degree",AngleDisplay:"3",AngleCalcDisplay:"3",Volume:"CubMm",VolumeDisplay:"3",VolumeCalcDisplay:"3",Area:"SqMm",AreaDisplay:"3",AreaCalcDisplay:"3",Mass:"Kilogram",MassDisplay:"3",MassCalcDisplay:"3"},window.console.warn("Could not get server value, default value set instead.",e)}}(),(l=s.givePreferenceManager({context:e.context}))&&(f=l.subscribe("com.ds.mep:onPrefUpdate",function(e){let n=JSON.parse(e[1].preferences);for(let e=0;e<n.repositories.length;e++)if("3DAnnotRepository"===n.repositories[e].name)for(let r=0;r<n.repositories[e].preferences.length;r++){let i=n.repositories[e].preferences;"WhiteVectorAsBlack"===i[r].name?(A.whiteVectorAsBlack="true"===i[r].value,t.publish({event:"onPreferenceModified",data:{preference:"CATWebUXMePreferences_"+i[r].name,value:A.whiteVectorAsBlack},context:this})):"LoadLevelAssemblyAnnotations"===i[r].name?(A.loadLevelAssemblyAnnotations="true"===n.repositories[e].preferences[r].value,t.publish({event:"onPreferenceModified",data:{preference:"CATWebUXMePreferences_"+i[r].name,value:A.loadLevelAssemblyAnnotations},context:this})):"LoadARMAnnotations"===i[r].name?(A.loadARMAnnotations="true"===n.repositories[e].preferences[r].value,t.publish({event:"onPreferenceModified",data:{preference:"CATWebUXMePreferences_"+i[r].name,value:A.loadARMAnnotations},context:this})):"LoadFirstAssemblyLevelAnnotations"===i[r].name?(A.loadFirstAssemblyLevelAnnotations="true"===n.repositories[e].preferences[r].value,t.publish({event:"onPreferenceModified",data:{preference:"CATWebUXMePreferences_"+i[r].name,value:A.loadFirstAssemblyLevelAnnotations},context:this})):"FirstAssemblyLevelAnnotationsPrefix"===i[r].name?(A.firstAssemblyLevelAnnotationsPrefix=n.repositories[e].preferences[r].value||"",t.publish({event:"onPreferenceModified",data:{preference:"CATWebUXMePreferences_"+i[r].name,value:A.firstAssemblyLevelAnnotationsPrefix},context:this})):"FirstAssemblyLevelAnnotationsSuffix"===i[r].name?(A.firstAssemblyLevelAnnotationsSuffix=n.repositories[e].preferences[r].value||"",t.publish({event:"onPreferenceModified",data:{preference:"CATWebUXMePreferences_"+i[r].name,value:A.firstAssemblyLevelAnnotationsSuffix},context:this})):"DisplayOnlyCaptures"===i[r].name?(A.displayOnlyCaptures="true"===i[r].value,t.publish({event:"onPreferenceModified",data:{preference:"CATWebUXMePreferences_"+i[r].name,value:A.displayOnlyCaptures},context:this})):"UpdateThumbnails"===i[r].name?(A.updateThumbnails="true"===i[r].value,t.publish({event:"onPreferenceModified",data:{preference:"CATWebUXMePreferences_"+i[r].name,value:A.updateThumbnails},context:this})):"KeepSelectedFeatures"===i[r].name?A.keepSelectedFeatures="true"===i[r].value:"FavoriteContextLoadMode"===i[r].name?A.favoriteContextLoadMode=i[r].value:"SemanticAttribute_3DAnnotations"===i[r].name?(A.semanticAttribute_3DAnnotations="true"===i[r].value,t.publish({event:"onPreferenceModified",data:{preference:"CATWebUXMePreferences_"+i[r].name,value:A.semanticAttribute_3DAnnotations},context:this})):"SemanticAttribute_0"===i[r].name?(A.semanticAttribute_0="true"===i[r].value,t.publish({event:"onPreferenceModified",data:{preference:"CATWebUXMePreferences_"+i[r].name,value:A.semanticAttribute_0},context:this})):"SemanticAttribute_1"===i[r].name?(A.semanticAttribute_1="true"===i[r].value,t.publish({event:"onPreferenceModified",data:{preference:"CATWebUXMePreferences_"+i[r].name,value:A.semanticAttribute_1},context:this})):"SemanticAttribute_2"===i[r].name?(A.semanticAttribute_2="true"===i[r].value,t.publish({event:"onPreferenceModified",data:{preference:"CATWebUXMePreferences_"+i[r].name,value:A.semanticAttribute_2},context:this})):"SemanticAttribute_3"===i[r].name?(A.semanticAttribute_3="true"===i[r].value,t.publish({event:"onPreferenceModified",data:{preference:"CATWebUXMePreferences_"+i[r].name,value:A.semanticAttribute_3},context:this})):"SemanticAttribute_4"===i[r].name?(A.semanticAttribute_4="true"===i[r].value,t.publish({event:"onPreferenceModified",data:{preference:"CATWebUXMePreferences_"+i[r].name,value:A.semanticAttribute_4},context:this})):"SemanticAttribute_5"===i[r].name?(A.semanticAttribute_5="true"===i[r].value,t.publish({event:"onPreferenceModified",data:{preference:"CATWebUXMePreferences_"+i[r].name,value:A.semanticAttribute_5},context:this})):"SemanticAttribute_6"===i[r].name?(A.semanticAttribute_6="true"===i[r].value,t.publish({event:"onPreferenceModified",data:{preference:"CATWebUXMePreferences_"+i[r].name,value:A.semanticAttribute_6},context:this})):"SemanticAttribute_7"===i[r].name&&(A.semanticAttribute_7="true"===i[r].value,t.publish({event:"onPreferenceModified",data:{preference:"CATWebUXMePreferences_"+i[r].name,value:A.semanticAttribute_7},context:this}))}})),p=!0))},this.cleanPrefManager=function(){0!==b&&0===--b&&(l&&f&&(l.unsubscribe(f),f=null),A={},d={},p=!1)};var m=function(e){for(var t=[],n=e.clone();n;){var i=n.getLastElement(!0);r.getNodeID(i)&&t.unshift(r.getNodeID(i)),n=n.getParentPath()}return t},_=function(e,t){if(e.length>t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},P=function(e,t){if(!e||!t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0};this.subscribe=function(e,n){if(e&&n)return t.subscribe({event:e},n)},this.unsubscribe=function(e){e&&t.unsubscribe(e)},this.saveA3EWidgetPref=function(t){if(t&&t.pref&&(t.path||t.rootLog||t.id)&&window.widget){var n=window.widget.getValue(t.pref);if((n=n&&e.is(n,"string")?JSON.parse(n):void 0)||(window.widget.addPreference({name:t.pref,type:"hidden"}),n=[]),t.rootLog)window.widget.setValue(t.pref,JSON.stringify(t.rootLog));else if(t.id)n.some(function(e){return e===t.id})||(n.push(t.id),window.widget.setValue(t.pref,JSON.stringify(n)));else{var r={idPath:m(t.path)};if(t.data)for(var i=Object.keys(t.data),a=0;a<i.length;a++)r[i[a]]=t.data[i[a]];for(var s=n.length-1;s>=0;s--)P(n[s].idPath,r.idPath)&&n.splice(s,1);n.push(r),window.widget.setValue(t.pref,JSON.stringify(n))}}},this.getA3EWidgetAnnotSetsLoadedPref=function(t){if(t&&t.path&&window.widget){var n=window.widget.getValue("A3EAnnotSetsLoaded");if(n=n&&e.is(n,"string")?JSON.parse(n):void 0){for(var r=[],i=m(t.path),a=0;a<n.length;a++)_(i,n[a].idPath)&&r.push({idPath:n[a].idPath,visibility:n[a].visibility,ctxTypes:n[a].ctxType?[n[a].ctxType]:null});return r}}},this.removeA3EWidgetPref=function(t){if(t&&t.pref&&(t.path||t.id)&&window.widget){var n,r=window.widget.getValue(t.pref);if(r=r&&e.is(r,"string")?JSON.parse(r):void 0)if(t.id)for(n=r.length-1;n>=0;n--)r[n]===t.id&&(r.splice(n,1),window.widget.setValue(t.pref,JSON.stringify(r)),0===r.length&&window.widget.deleteValue(t.pref));else if(t.path){var i=m(t.path);for(n=r.length-1;n>=0;n--)P(r[n].idPath,i)&&(r.splice(n,1),window.widget.setValue(t.pref,JSON.stringify(r)),0===r.length&&window.widget.deleteValue(t.pref))}else if(t.nodeID)for(n=r.length-1;n>=0;n--)-1!==r[n].idPath.indexOf(t.nodeID)&&(r.splice(n,1),window.widget.setValue(t.pref,JSON.stringify(r)),0===r.length&&window.widget.deleteValue(t.pref))}},this.deleteA3EWidgetPref=function(e){e&&e.pref&&window.widget&&window.widget.deleteValue(e.pref)},this.setPreference=function(e,n){if(e){var r=localStorage.getItem(e),i=n;switch(e){case"3DAnnotSemStd":if("string"!=typeof i)return;break;case"CATWebUXMePreferences_FavoriteContextLoadMode":if("AlwaysOpen"!==i&&"Check"!==i&&"Ignore"!==i)return;break;case"CATWebUXMePreferences_LoadLevelAssemblyAnnotations":case"CATWebUXMePreferences_LoadARMAnnotations":case"CATWebUXMePreferences_LoadFirstAssemblyLevelAnnotations":if("boolean"!=typeof i)return;break;case"CATWebUXMePreferences_FirstAssemblyLevelAnnotationsPrefix":case"CATWebUXMePreferences_FirstAssemblyLevelAnnotationsSuffix":if("string"!=typeof i)return;break;case"CATWebUXMePreferences_DisplayOnlyCaptures":case"CATWebUXMePreferences_WhiteVectorAsBlack":case"CATWebUXMePreferences_UpdateThumbnails":case"CATWebUXMePreferences_KeepSelectedFeatures":if("boolean"!=typeof i)return;break;case"CATWebUXMePreferences_3DAnnotAttributesOrderedList":return;default:if(-1!==e.indexOf("CATWebUXMePreferences_SemanticAttribute_")&&"boolean"!=typeof i)return;if(-1!==e.indexOf("CAT3DAnnotAttrRowSelection_")&&"string"!=typeof i)return;if(-1!==e.indexOf("CAT3DAnnotAttrAttrDisplay_")&&"string"!=typeof i)return}r!==i&&(localStorage.setItem(e,i),function(e,t){switch(e){case"CATWebUXMePreferences_FavoriteContextLoadMode":A.favoriteContextLoadMode=t;break;case"CATWebUXMePreferences_LoadLevelAssemblyAnnotations":A.loadLevelAssemblyAnnotations=t;break;case"CATWebUXMePreferences_LoadARMAnnotations":A.loadARMAnnotations=t;break;case"CATWebUXMePreferences_LoadFirstAssemblyLevelAnnotations":A.loadFirstAssemblyLevelAnnotations=t;break;case"CATWebUXMePreferences_FirstAssemblyLevelAnnotationsPrefix":A.firstAssemblyLevelAnnotationsPrefix=t;break;case"CATWebUXMePreferences_FirstAssemblyLevelAnnotationSuffix":A.firstAssemblyLevelAnnotationSuffix=t;break;case"CATWebUXMePreferences_DisplayOnlyCaptures":A.displayOnlyCaptures=t;break;case"CATWebUXMePreferences_WhiteVectorAsBlack":A.whiteVectorAsBlack=t;break;case"CATWebUXMePreferences_UpdateThumbnails":A.updateThumbnails=t;break;case"CATWebUXMePreferences_KeepSelectedFeatures":A.keepSelectedFeatures=t;break;default:if(-1!==e.indexOf("CATWebUXMePreferences_SemanticAttribute_")){if("CATWebUXMePreferences_SemanticAttribute_3DAnnotations"===e){A.semanticAttribute_3DAnnotations=t;break}if("CATWebUXMePreferences_SemanticAttribute_0"===e){A.semanticAttribute_0=t;break}if("CATWebUXMePreferences_SemanticAttribute_1"===e){A.semanticAttribute_1=t;break}if("CATWebUXMePreferences_SemanticAttribute_2"===e){A.semanticAttribute_2=t;break}if("CATWebUXMePreferences_SemanticAttribute_3"===e){A.semanticAttribute_3=t;break}if("CATWebUXMePreferences_SemanticAttribute_4"===e){A.semanticAttribute_4=t;break}if("CATWebUXMePreferences_SemanticAttribute_5"===e){A.semanticAttribute_5=t;break}if("CATWebUXMePreferences_SemanticAttribute_6"===e){A.semanticAttribute_6=t;break}if("CATWebUXMePreferences_SemanticAttribute_7"===e){A.semanticAttribute_7=t;break}}}}(e,i),t.publish({event:"onPreferenceModified",data:{preference:e,value:i},context:this}))}},this.getPreference=function(e){if(e){if("3DAnnotAttributesOrderedList"===e)return["2","3DAnnotations","0","1","7","3","4","6","5"];var t=localStorage.getItem(e);switch(e){case"3DAnnotSemStd":return t;case"CATWebUXMePreferences_Units":return d;case"CATWebUXMePreferences_FavoriteContextLoadMode":t=A.favoriteContextLoadMode?A.favoriteContextLoadMode:"Check";break;case"CATWebUXMePreferences_LoadLevelAssemblyAnnotations":t=!0===A.loadLevelAssemblyAnnotations;break;case"CATWebUXMePreferences_LoadARMAnnotations":t=!0===A.loadARMAnnotations;break;case"CATWebUXMePreferences_LoadFirstAssemblyLevelAnnotations":t=!0===A.loadFirstAssemblyLevelAnnotations;break;case"CATWebUXMePreferences_FirstAssemblyLevelAnnotationsPrefix":t=A.firstAssemblyLevelAnnotationsPrefix||"";break;case"CATWebUXMePreferences_FirstAssemblyLevelAnnotationsSuffix":t=A.firstAssemblyLevelAnnotationsSuffix||"";break;case"CATWebUXMePreferences_DisplayOnlyCaptures":t=!0===A.displayOnlyCaptures;break;case"CATWebUXMePreferences_WhiteVectorAsBlack":t=!1!==A.whiteVectorAsBlack;break;case"CATWebUXMePreferences_UpdateThumbnails":t=!1!==A.updateThumbnails;break;case"CATWebUXMePreferences_KeepSelectedFeatures":t=!1!==A.keepSelectedFeatures;break;default:-1!==e.indexOf("CATWebUXMePreferences_SemanticAttribute_")&&("CATWebUXMePreferences_SemanticAttribute_3DAnnotations"===e&&(t=!1!==A.semanticAttribute_3DAnnotations),"CATWebUXMePreferences_SemanticAttribute_0"===e&&(t=!1!==A.semanticAttribute_0),"CATWebUXMePreferences_SemanticAttribute_1"===e&&(t=!1!==A.semanticAttribute_1),"CATWebUXMePreferences_SemanticAttribute_2"===e&&(t=!1!==A.semanticAttribute_2),"CATWebUXMePreferences_SemanticAttribute_3"===e&&(t=!1!==A.semanticAttribute_3),"CATWebUXMePreferences_SemanticAttribute_4"===e&&(t=!1!==A.semanticAttribute_4),"CATWebUXMePreferences_SemanticAttribute_5"===e&&(t=!1!==A.semanticAttribute_5),"CATWebUXMePreferences_SemanticAttribute_6"===e&&(t=!1!==A.semanticAttribute_6),"CATWebUXMePreferences_SemanticAttribute_7"===e&&(t=!1!==A.semanticAttribute_7)),-1!==e.indexOf("CAT3DAnnotAttrRowSelection_")&&(t||"CAT3DAnnotAttrRowSelection_4"!==e&&"CAT3DAnnotAttrRowSelection_6"!==e||(t="display")),-1!==e.indexOf("CAT3DAnnotAttrAttrDisplay_")&&(t||"CAT3DAnnotAttrAttrDisplay_4"!==e&&"CAT3DAnnotAttrAttrDisplay_6"!==e||(t="rows"))}return t}},this.getPreferenceDefinitions=function(e){var t=[],n=!1,r={nls:i.preferences.annotationSectionTitle,id:"3DAnnotationPreferences",type:"section",preferences:[]};if(t.push(r),(!e||e&&!1!==e.annotDisplayPrefs)&&(n=!0,r.preferences.push({nls:i.preferences.WhiteVecAsBlackLbl,id:"WhiteVectorAsBlack",type:"checkbox",getValue:function(){return u.getPreference("CATWebUXMePreferences_WhiteVectorAsBlack")},getDefaultValue:function(){return!0},setValue:function(e){e!==u.getPreference("CATWebUXMePreferences_WhiteVectorAsBlack")&&c.setPreference("CATWebUXMePreferences_WhiteVectorAsBlack",e)}})),(!e||e&&!1!==e.loadingPrefs)&&(n=!0,r.preferences.push({nls:i.preferences.LoadARMPartsLbl,id:"LoadARMAnnotations",type:"checkbox",getValue:function(){return u.getPreference("CATWebUXMePreferences_LoadARMAnnotations")},getDefaultValue:function(){return!1},setValue:function(e){e!==u.getPreference("CATWebUXMePreferences_LoadARMAnnotations")&&c.setPreference("CATWebUXMePreferences_LoadARMAnnotations",e)}})),(!e||e&&!1!==e.thumbnailPrefs)&&(n=!0,r.preferences.push({nls:i.preferences.DisplayCapturesLbl,id:"DisplayOnlyCaptures",type:"checkbox",getValue:function(){return u.getPreference("CATWebUXMePreferences_DisplayOnlyCaptures")},getDefaultValue:function(){return!1},setValue:function(e){e!==u.getPreference("CATWebUXMePreferences_DisplayOnlyCaptures")&&c.setPreference("CATWebUXMePreferences_DisplayOnlyCaptures",e)}}),r.preferences.push({nls:i.preferences.UpdateThumbnailsLbl,id:"UpdateThumbnails",type:"checkbox",getValue:function(){return u.getPreference("CATWebUXMePreferences_UpdateThumbnails")},getDefaultValue:function(){return!0},setValue:function(e){e!==u.getPreference("CATWebUXMePreferences_UpdateThumbnails")&&c.setPreference("CATWebUXMePreferences_UpdateThumbnails",e)}})),(!e||e&&!1!==e.keepSelectedFeaturesPrefs)&&(n=!0,r.preferences.push({nls:i.preferences.keepSelectedFeatures,id:"KeepSelectedFeatures",type:"checkbox",getValue:function(){return u.getPreference("CATWebUXMePreferences_KeepSelectedFeatures")},getDefaultValue:function(){return!0},setValue:function(e){e!==u.getPreference("CATWebUXMePreferences_KeepSelectedFeatures")&&c.setPreference("CATWebUXMePreferences_KeepSelectedFeatures",e)}})),(!e||e&&!1!==e.favoriteCtxPrefs)&&(n=!0,r.preferences.push({nls:i.preferences.FavoriteContextLabel,id:"FavoriteContextLoadMode",type:"radio",getValue:function(){return u.getPreference("CATWebUXMePreferences_FavoriteContextLoadMode")},getDefaultValue:function(){return"Check"},setValue:function(e){e!==u.getPreference("CATWebUXMePreferences_FavoriteContextLoadMode")&&c.setPreference("CATWebUXMePreferences_FavoriteContextLoadMode",e)},options:[{id:"AlwaysOpen",nls:i.preferences.FavoriteContextOpen},{id:"Check",nls:i.preferences.FavoriteContextCheck},{id:"Ignore",nls:i.preferences.FavoriteContextIgnore}]})),!e||e&&!1!==e.attributePrefs){n=!0;var a={nls:i.preferences.PrefAttributesTitle,id:"3DAnnotationAttrSection",type:"section",preferences:[]};r.preferences.push(a),u.getPreference("3DAnnotAttributesOrderedList").forEach(function(e){a.preferences.push({nls:o[e],id:"SemanticAttribute_"+e,type:"checkbox",getValue:function(){return c.getPreference("CATWebUXMePreferences_SemanticAttribute_"+e)},getDefaultValue:function(){return!0},setValue:function(t){t!==u.getPreference("CATWebUXMePreferences_SemanticAttribute_"+e)&&c.setPreference("CATWebUXMePreferences_SemanticAttribute_"+e,t)}})})}return n?t:null}}});return c.init(),c});