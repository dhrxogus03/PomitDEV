define("DS/CAT3DWMediaPanel/CAT3DWMediaCardView",["UWA/Core","DS/DataDragAndDrop/DataDragAndDrop","DS/CAT3DWInfraUI/CAT3DWPointerEvents","DS/CAT3DWInfra/CAT3DWPreferenceManager","WebappsUtils/WebappsUtils","css!DS/CAT3DWMediaPanel/CAT3DWMediaPanel"],function(e,t,i,s,a){"use strict";var n=e.Class.extend({init:function(t){this.media=t.media,this.type=t.type,this.id=this.media.id,this.iconData=t.swymIcons,this.onPointerDown=t.callback.onPointerDown,this.onPointerUp=t.callback.onPointerUp,this.onPointerHit=t.callback.onPointerHit,this.onDragStart=t.callback.onDragStart,this.onDragStop=t.callback.onDragStop;let i=this.media.preview;i&&s.getPreferenceValue("M3DEMobile")&&(i=e.Data.proxifyUrl(i,{proxy:"passport"}),this.media.preview=i),this._createMediaCard(this.media,this.type)},_createMediaCard:function(t,i){this.card=e.createElement("div",{class:"cardContainer"});let s=e.createElement("div",{class:"card mediaCard"}).inject(this.card);this.imageCard=new Image,this.imageCard.onerror=function(){this.imageCard.src=a.getWebappsAssetUrl("CAT3DWInfra","placeholders/xl_thumb_waiting_processing.png")}.bind(this),this.imageCard.src=t.preview?t.preview:a.getWebappsAssetUrl("CAT3DWInfra","placeholders/xl_thumb_waiting_processing.png"),this.imageCard.className="card-img",this.imageCard.draggable=!1,s.append(this.imageCard);let n=e.createElement("div",{class:"card-selected"}).inject(s);e.createElement("span",{class:"fonticon fonticon-check"}).inject(n);let r=e.createElement("div",{class:"card-block"}).inject(s);if(e.createElement("h4",{class:"card-title",text:t.title}).inject(r),i){let e=this.generateIconType(t);e&&e.inject(s)}i&&this.setActions()},setActions:function(){this.card.addEvent(i.POINTERHIT,function(){this.pointerHit()}.bind(this)),this.card.addEvent(i.POINTERDOWN,function(){this.pointerDown()}.bind(this)),this.card.addEvent(i.POINTERUP,function(){this.pointerUp()}.bind(this))},pointerHit:function(){this.onPointerHit(this.id,this.media),this.card.firstChild.toggleClassName("selected")},pointerDown:function(){this.onPointerDown(this.id,this.media)},pointerUp:function(){this.card.firstChild.hasClassName("selected")||this.onPointerUp(this.id)},getCard:function(){return this.card},generateIconType:function(t){if(t.forced_icon){let i=e.createElement("div",{class:"card-icon"});return e.createElement("span",{class:t.forced_icon}).inject(i),i}var i=this.iconData[t.type];if(i){let t=e.createElement("div",{class:"card-icon",styles:{background:i.color}});return e.createElement("span",{class:i.fonticon}).inject(t),t}},updateClass:function(e){this.card.className=e},setSize:function(e){this.card.className="cardContainer width"+e},setDragData:function(e){t.clean(this.card.firstChild),t.draggable(this.card.firstChild,{data:e,start:this.onDragStart,stop:this.onDragStop})},setPreview:function(e){e&&""!==e&&(this.imageCard.src=e,this.media.preview=e)}});return e.namespace("DS/CAT3DWMediaPanelView/CAT3DWMediaCardView",n)}),define("DS/CAT3DWMediaPanel/CAT3DWFolderCardView",["UWA/Core","DS/CAT3DWInfraUI/CAT3DWPointerEvents","css!DS/CAT3DWMediaPanel/CAT3DWMediaPanel"],function(e,t){"use strict";var i=e.Class.extend({init:function(e){this.folder=e.folder,this.id=this.folder.id,this.onPointerHit=e.callback,this._createFolderCard(this.folder)},_createFolderCard:function(i){this.card=e.createElement("div",{class:"cardContainer",draggable:!1});let s=e.createElement("div",{class:"card folderCard"}).inject(this.card),a=this.generateIconType(i);a&&a.inject(s);let n=e.createElement("div",{class:"card-block"}).inject(s);e.createElement("h4",{class:"card-title",text:i.title}).inject(n),this.card.addEvent(t.POINTERHIT,function(){this.pointerHit()}.bind(this))},pointerHit:function(){this.onPointerHit(this.id,this.folder)},getCard:function(){return this.card},generateIconType:function(t){if(t.forced_icon){let i=e.createElement("div",{class:"card-icon"});return e.createElement("span",{class:t.forced_icon,styles:{color:"#77797c"}}).inject(i),i}if(t.type_icon){let i=e.createElement("div",{class:"card-icon"});return e.createElement("img",{src:t.type_icon,styles:{height:"100%"}}).inject(i),i}let i=e.createElement("div",{class:"card-icon"});return e.createElement("span",{class:t.shared?"fonticon fonticon-folder-share":"fonticon fonticon-folder",styles:{color:"#77797c"}}).inject(i),i},updateClass:function(e){this.card.className=e},setSize:function(e){this.card.className="cardContainer width"+e}});return e.namespace("DS/CAT3DWMediaPanelView/CAT3DWFolderCardView",i)}),define("DS/CAT3DWMediaPanel/CAT3DWMediaPanelView",["DS/CoreEvents/Events","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/DropdownMenu","DS/UIKIT/Input/File","DS/UIKIT/Spinner","DS/UIKIT/Scroller","DS/UIKIT/Popover","DS/UIKIT/Form","DS/UIKIT/Input/ButtonGroup","DS/CAT3DWInfraUI/CAT3DWPointerEvents","DS/CAT3DWMediaPanel/CAT3DWMediaCardView","DS/CAT3DWMediaPanel/CAT3DWFolderCardView","DS/CAT3DWInfra/CAT3DWMOBStylingHelper","DS/DataDragAndDrop/DataDragAndDrop","UWA/Promise","DS/WebUtils/ContextedSingleton","DS/ApplicationFrame/CommandsManager","DS/CAT3DWInfra/CAT3DWPreferenceManager","i18n!DS/CAT3DWInfra/assets/nls/CAT3DWTooltip","css!DS/CAT3DWMediaPanel/CAT3DWMediaPanel"],function(e,t,i,s,a,n,r,d,o,l,h,c,p,u,m,y,g,f,C,b){"use strict";var v=t.Class.extend({init:function(e){this.nls=e.nls,this.hand=e.hand?e.hand:"right",this.typeList=[],this.threadList=[],this.orderList=[],this.mediaList=[],this.fileServices=e.fileServices,this.icons=e.icons,this.page=0,this.pagesize=e.pagesize,this.mediaList[this.page]=[],this.uploadedList=[],this.selectedMedia=new Map,this.mediaCardList=new Map,this.folderCardList=new Map,this.filterData={type:"",label:"",subtype:[]},this.filterActive=!1,this.hierarchyActive=!0,this.hierarchyDrive=e.driveDirectory?JSON.parse(e.driveDirectory):[],this.folderIDDrive=this.hierarchyDrive&&this.hierarchyDrive.length>0?this.hierarchyDrive[this.hierarchyDrive.length-1].id:void 0,this.hierarchySpace=e.spaceDirectory?JSON.parse(e.spaceDirectory):[],this.folderIDSpace=this.hierarchySpace&&this.hierarchySpace.length>0?this.hierarchySpace[this.hierarchySpace.length-1].id:void 0,this.emojiList=e.emojis,this.shapeList=e.shapes,this.shapeCardList=[],this.panoplyManager=e.panoplyManager,this.shapeDragManager=e.shapeDragManager,this.comparisonTypes=e.comparisonTypes,this.onRequestChange=e.onRequestChange,this.onRequestNewPage=e.onRequestNewPage,this.onRequestPreviews=e.onRequestPreviews,this.onUploadNewMedias=e.onUploadNewMedias,this.onAddMedias=e.onAddMedias,this.onChangeCurrentDirectory=e.onChangeCurrentDirectory,this.onChangeOrderView=e.onChangeOrderView,this.cardCallbacks={onPointerDown:this._onPointerDownMediaCard.bind(this),onPointerUp:this._onPointerUpMediaCard.bind(this),onPointerHit:this._onPointerHitMediaCard.bind(this),onDragStart:e.onDragStart,onDragStop:e.onDragStop},this._getFileExtensions(),this.parentContainer=document.getElementById("webapp-container")?document.getElementById("webapp-container"):document.body,this.parentContainer.style.display="flex",this._onWindowResizeCBBind=this._onWindowResizeCB.bind(this),this.viewerFrameUI=e.viewerFrameUI,this.subscribeAllEvents()},subscribeAllEvents:function(){window.addEventListener("resize",this._onWindowResizeCBBind)},unsubscribeAllEvents:function(){window.removeEventListener("resize",this._onWindowResizeCBBind)},destroy:function(){this.unsubscribeAllEvents(),this.uploadedList=[],this.onRequestChange=null,this.onRequestNewPage=null,this.onUploadNewMedias=null,this.onAddMedias=null;var e=document.getElementById("mediaPanel");e&&this.mediaPanelContainer.removeChild(e)},setPanoplyManager:function(e){this.panoplyManager=e},createView:function(){this.mediaPanelContainer=t.createElement("div",{id:"rightPanel",styles:{display:"none"}}),"left"!==this.hand?(this.parentContainer.prepend(this.mediaPanelContainer),this.mediaPanelContainer.append(this._createTypesContainer()),this.mediaPanelContainer.append(this._createMediasContainer())):(this.parentContainer.append(this.mediaPanelContainer),this.mediaPanelContainer.append(this._createMediasContainer()),this.mediaPanelContainer.append(this._createTypesContainer())),u.isScreenDimensionMobilePhone()?(this._updateTypes(),this._onRequestChange()):(this.selectedType="",this.filterData={type:"",label:"",subtype:[]},this._updateTypes()),this.updateMediaPanelStyling(),this.updateRightPanelStyling()},updateMediaPanelStyling:function(e){let t=document.getElementById("rightPanel");if(!t)return;let i=Math.max(249,.3*window.innerWidth-51),s="left"===this.hand?"rtl":"ltr",a=t.getAttribute("style").split("--media-panel-width-for-not-full-screen-desktop-tab:")[0]+"--media-panel-width-for-not-full-screen-desktop-tab:"+i+"px;--media-panel-direction:"+s+";--media-panel-width-for-full-screen-desktop-tab:"+this.viewerFrameUI.getSize().width+"px;";t.setAttribute("style",a),u.isScreenDimensionMobilePhone()?(t.classList.remove("mediaPanelOpenedState"),t.classList.remove("media-panel-border-right-no-border-left")):(e&&e.toOpenMediaPanel?t.classList.add("mediaPanelOpenedState"):e&&!e.toOpenMediaPanel?t.classList.remove("mediaPanelOpenedState"):this.selectedType?t.classList.add("mediaPanelOpenedState"):t.classList.remove("mediaPanelOpenedState"),"ltr"===s?t.classList.add("media-panel-border-right-no-border-left"):t.classList.remove("media-panel-border-right-no-border-left")),this._updateMediaCard()},updateRightPanelStyling:function(){let e=document.getElementById("rightPanel");e&&(u.isScreenDimensionMobilePhone()?e.classList.remove("RightPanelStateForTabsDesktop"):e.classList.add("RightPanelStateForTabsDesktop"),this._updateMediaCard())},recreateView:function(e=!1){var t=document.getElementById("rightPanel");t&&("left"!==this.hand?(t.remove(),this.parentContainer.prepend(t)):(t.remove(),this.parentContainer.append(t))),this.selectedType.id!==this.filterData.type&&(this.filterData={type:this.selectedType.id,label:"",subtype:[]});var i,s=document.getElementById("mediaPanel");this.selectedMedia.clear(),this.mediaCardList.clear(),this.folderCardList.clear(),this.page=0,s?(s.remove(),u.isScreenDimensionMobilePhone()?"left"!==this.hand?(i=this._createMediasContainer(e),this.mediaPanelContainer.append(i)):(i=this._createMediasContainer(e),this.mediaPanelContainer.prepend(i)):u.isScreenDimensionMobilePhone()||(t.classList.contains("mediaPanelOpenedState")||this.selectedType?(i=this._createMediasContainer(e),this.mediaPanelContainer.append(i)):this.mediaPanelContainer.append(s)),this._updateTypes(),this._updateMediaCard()):this.createView(),this.updateMediaPanelStyling(),this.updateRightPanelStyling()},appendNewMedia:function(e){if(this._isResultCompatible(e))if(e){let t=this.checkNewPageNecessary(e);this._updateMediasContainer(t),t&&this.onNewPageNecessary()}else this._updateMediasContainer(),this._hideLoadingMoreContainer()},checkNewPageNecessary:function(e){return e&&e.nbPages>this.page+1&&this._isResultCompatible(e)},onNewPageNecessary:function(){this.page++,this._onRequestNewPage()},_isResultCompatible:function(e){return!(e&&e.search&&(e.search.thread!==this.selectedThread.id||e.search.type!==this.selectedType.type||"drive"===this.selectedThread.id&&e.search.folderID!==this.folderIDDrive||"space"===this.selectedThread.id&&e.search.folderID!==this.folderIDSpace||e.search.page!==this.page))},togglePanel:function(){this.mediaPanelContainer&&"inherit"===this.mediaPanelContainer.style.display?this.toggleOff():this.toggleOn()},toggleOn:function(){this.mediaPanelContainer.style.display="inherit",this._updateMediaCard(),this.updateMediaPanelStyling(),this.updateRightPanelStyling()},toggleOff:function(){this.mediaPanelContainer.style.display="none",this.mediaPanelContainer.classList.remove("mediaPanelOpenedState"),this.mediaPanelContainer.classList.remove("RightPanelStateForTabsDesktop"),this.mediaPanelContainer.classList.remove("media-panel-border-right-no-border-left")},slideOutOfView:function(){let e=this.mediaPanelContainer.querySelector("#mediaTypes").getSize().width,t=this.mediaPanelContainer.querySelector("#mediaPanel").getSize().width+e;this.mediaPanelContainer.style.left=("right"===this.hand?"-":"")+.8*t+"px"},slideBackIntoView:function(){this.mediaPanelContainer.style.left="0px"},isVisible:function(){return!("none"===this.mediaPanelContainer.style.display)},onMediaAdded:function(){u.getIsMediaPanelCoveringFullScreen()&&(u.isScreenDimensionMobilePhone()?(e.publish({event:"3DSketch.toggle.any.panoply",data:{panoplyID:"AddMedia"}}),e.publish({event:"3DSketch.toggle.any.panoply",data:{panoplyID:"Selection"}})):(this.selectedTypeCopy=this.selectedType,this.filterDataCopy={type:this.selectedType.id,label:"",subtype:this.selectedType.type},this.selectedType="",this.filterData={type:"",label:"",subtype:[]},this._updateTypes(),e.publish({event:"3DSketch.toggle.any.panoply",data:{panoplyID:"Selection"}}),this.updateMediaPanelStyling(),this.updateRightPanelStyling()))},setMediaList:function(e){this._isResultCompatible(e)&&(this.hierarchyActive&&this.selectedThread.supportHierarchy?"drive"===this.selectedThread.id?(this.mediaList[this.page]=[],e.items.forEach(t=>{this.mediaList[this.page].push({id:t.id,type_icon:"DriveFolder"!==t.type?t.icon:"",preview:void 0,isFolder:"DriveFolder"===t.type,extension:t.extension,title:t.title,envId:e.search.platformId,forced_icon:t.forced_icon,shared:t.shared})}),this._onRequestPreviews()):"space"===this.selectedThread.id&&(this.mediaList[this.page]=[],e.items.forEach(t=>{t.businessobj?this.mediaList[this.page].push({id:t.businessobj.physicalid,type:t.businessobj.type?t.businessobj.type.value:"Document",type_icon:t.businessobj.icon,preview:t.businessobj.thumbnail,isFolder:!1,extension:this._getValue(e.subjectsTags["pid://"+t.businessobj.physicalid],"ds6w:what/ds6w:docExtension"),title:t.businessobj.title,envId:e.search.platformId,forced_icon:t.forced_icon,shared:t.shared}):this.mediaList[this.page].push({id:t.name,type_icon:t.thumbnail,preview:void 0,isFolder:!0,extension:t.extension,title:t.title,envId:e.search.platformId,forced_icon:t.forced_icon,shared:t.shared})})):(this.nbResults=e.infos.nmatches,this.mediaList[this.page]=[],e.results.forEach(e=>{this.mediaList[this.page].push({id:this._getValue(e.attributes,"resourceid"),type_icon:this._getValue(e.attributes,"type_icon_url"),preview:this._getValue(e.attributes,"preview_url"),type:this._getValue(e.attributes,"ds6w:what/ds6w:type"),extension:void 0,title:this._getValue(e.attributes,"ds6w:label"),envId:this._getValue(e.attributes,"sourceid").slice(6,this._getValue(e.attributes,"sourceid").length),ressourceURL:this._getValue(e.attributes,"ResourceURL"),forced_icon:e.forced_icon})})))},setPreviews:function(e){e.items&&e.items.forEach(e=>{let t=this.mediaCardList.get(e.id);t&&t.setPreview(e.thumbnail)})},setThreadList:function(e){e?(this.threadList=e,this.selectedThread||(this.selectedThread=this.threadList[0])):console.error("Unable to set Thread List")},setTypeList:function(e){e?(this.typeList=e,this.selectedType||(this.selectedType=this.typeList[0],this.filterData={type:this.selectedType.id,label:"",subtype:[]})):console.error("Unable to set Type List")},setOrderList:function(e){var t;!e|!e.orderList?console.error("Unable to set Order List"):(this.orderList=e.orderList,this.selectedOrder||(e.orderPreference&&(t=this.orderList.find(t=>t.id===e.orderPreference)),this.selectedOrder=t||this.orderList[this.orderList.length-1]))},setHand:function(e){this.hand=e},resetSelectedMedia:function(){this.selectedMedia.clear();let e=document.getElementsByClassName("mediaCard");for(let t=0;t<e.length;t++)e[t].removeClassName("selected");let t=document.getElementsByClassName("stickerCard");for(let e=0;e<t.length;e++)t[e].removeClassName("selected");this._updateAddButton()},resetSelected:function(){this.selectedType=this.typeList[0],this.selectedThread=this.threadList[0],this.resetSelectedMedia()},_createTypesContainer:function(){this.typesContainer=t.createElement("div",{id:"mediaTypes"});for(var e=0;e<this.typeList.length;e++)this.typeList[e].visibility&&this._createTypeCard(this.typeList[e]).inject(this.typesContainer);return t.createElement("div",{class:"mediaTypeSelection",styles:{top:"0px"}}).inject(this.typesContainer.firstChild),this.typesContainer},_createTypeCard:function(e){let i=t.createElement("div",{id:e.id,class:e.selected?"mediaType selected":"mediaType","data-uid_po":"mediaPanel typeCard "+e.id});return i.setAttribute("title",b.get(e.id)),i.addEvent(h.POINTERHIT,function(){this.selectedTypeCopy=e,this.filterDataCopy={type:this.selectedTypeCopy.id,label:"",subtype:[]},u.isScreenDimensionMobilePhone()?(this.selectedType=e,this.filterData={type:this.selectedType.id,label:"",subtype:[]},this._onRequestChange()):i.classList.contains("selected")?(this.selectedType="",this.filterData={type:"",label:"",subtype:[]},this._updateTypes()):(this.selectedType=e,this.filterData={type:this.selectedType.id,label:"",subtype:[]},this._onRequestChange()),this.updateMediaPanelStyling(),this.updateRightPanelStyling()}.bind(this)),t.createElement("div",{class:"mediaTypeIcon "+e.icon}).inject(i),t.createElement("div",{class:"mediaTypeName",text:this.nls.get(e.id+".title").toUpperCase()}).inject(i),i},_createMediasContainer:function(e=!1){let i=t.createElement("div",{id:"mediaPanel"});if(this._createTitleContainer().inject(i),"upload"===this.selectedType.id){this._createUploadContainer().inject(i);let e=t.createElement("div",{id:"mediasContainer"}).inject(i);this.mediaListContainer=t.createElement("div",{id:"to-scroll",styles:{height:"100%"}}).inject(e);for(let e=0;e<this.uploadedList.length;e++){let t=this.uploadedList[e],i=t.id,s=new c({media:t,type:this.selectedType,callback:this.cardCallbacks,swymIcons:this.icons});s.getCard().inject(this.mediaListContainer),this.mediaCardList.set(i,s)}return this.scroller=new r({element:this.mediaListContainer}).inject(e),i}this._createThreadContainer().inject(i),this._createFilterContainer().inject(i),this._createHierarchyContainer().inject(i);let s=t.createElement("div",{styles:{height:"100%",width:"100%"}}).inject(i);if(this._createEmptyMediaAndFolderListContainer().inject(s),this._createLoadingContainer().inject(s),this._createMediaCardsContainer().inject(s),e&&this._displayLoadingContainer(),"library"!==this.selectedThread.id)this._updateMediaCardsContainer(e),this._updateMediaCard();else switch(this.selectedType.id){case"compare":this._updateComparisonTypesContainer();break;case"stickers":this._updateStickerCardsContainer();break;case"shapes":this._updateShapesCardContainer()}return i},_createMediaCardsContainer:function(){this.mediaListContainerScroll=t.createElement("div",{id:"mediasContainer"}),this.mediaListContainer=t.createElement("div",{id:"to-scroll",styles:{height:"100%",width:"100%"}}),this.hierarchyActive&&this.selectedThread.supportHierarchy&&(this.folderCardsContainer=t.createElement("div",{id:"folderCardsContainer"}).inject(this.mediaListContainer)),this.mediaCardsContainer=t.createElement("div",{id:"mediaCardsContainer"}).inject(this.mediaListContainer),this.emptyMediaListContainer=t.createElement("div",{id:"emptyMediaList",text:this.nls.noMedia,styles:{"margin-top":"","margin-left":""}}).inject(this.mediaListContainer),this.scroller=new r({element:this.mediaListContainer}).inject(this.mediaListContainerScroll),this.loadingMoreContainer=t.createElement("div",{id:"moreToLoadSpinner"}).inject(this.mediaListContainer);let e=new n({zIndex:2e3});return e.show(),e.inject(this.loadingMoreContainer),this.mediaListContainerScroll},_displayEmptyMediaListContainer:function(){this.emptyMediaListContainer.className="active",this._hideLoadingContainer(),this._hideLoadingMoreContainer()},_hideEmptyMediaListContainer:function(){this.emptyMediaListContainer.className=""},_displayLoadingMoreContainer:function(){this._hideLoadingContainer(),this.loadingMoreContainer.className="active"},_hideLoadingMoreContainer:function(){this.loadingMoreContainer.className=""},_updateMediaCardsContainer:function(e){let t=document.getElementsByClassName("folderCard").length,i=document.getElementsByClassName("mediaCard").length;for(var s=0;s<this.mediaList[this.page].length;s++){var a=this.mediaList[this.page][s],n=a.id;if(this.hierarchyActive&&this.selectedThread.supportHierarchy){if(a.isFolder){let e=new p({folder:a,callback:this._onPointerHitFolder.bind(this)});e.getCard().inject(this.folderCardsContainer),this._hideEmptyMediaAndFolderListContainer(),this.folderCardList.set(n,e),t++;continue}if(!this._isAcceptableExtension(a)||!a.title.includes(this.filterData.label))continue}let e=new c({media:a,type:this.selectedType,callback:this.cardCallbacks,swymIcons:this.icons});e.getCard().inject(this.mediaCardsContainer),this._hideEmptyMediaListContainer(),this.mediaCardList.set(n,e),i++}return this.hierarchyActive&&this.selectedThread.supportHierarchy||this.mediaList[this.page].length===this.pagesize&&this.nbResults>this.page*this.pagesize+this.mediaList[this.page].length&&this.scroller.elements.content.addEvent("scroll",this._onScroll.bind(this)),e?0===t&&0===i?this._displayLoadingContainer():this._displayLoadingMoreContainer():(this._hideLoadingContainer(),this._hideLoadingMoreContainer(),0!==i||"space"===this.selectedThread.id&&0===this.hierarchySpace.length||"drive"===this.selectedThread.id&&0===this.hierarchyDrive.length||(0===t?this._displayEmptyMediaAndFolderListContainer():this._displayEmptyMediaListContainer())),this.mediaListContainer},_updateStickerCardsContainer:function(){let e=document.getElementsByClassName("stickerCard").length;if(this.emojiList.forEach(i=>{if((this.filterData.subtype.includes(i.category)||0===this.filterData.subtype.length)&&this.nls.get(this.camelize(i.description)).toUpperCase().includes(this.filterData.label.toUpperCase())){let s=t.createElement("div",{class:"stickerCard",html:'<span name="'+i.description+'">'+i.emoji+"</span>",draggable:"true",title:this.nls.get(this.camelize(i.description))}).inject(this.mediaCardsContainer);e++;let a=t.createElement("div",{class:"stickerCard-selected"}).inject(s);t.createElement("span",{class:"fonticon fonticon-check"}).inject(a),s.addEvent(h.POINTERDOWN,function(){this._onPointerDownSticker(i.emoji,s),m.clean(s),m.draggable(s,{data:this._createDragData(),start:this.cardCallbacks.onDragStart,stop:this.cardCallbacks.onDragStop})}.bind(this)),s.addEvent(h.POINTERUP,function(){s.hasClassName("selected")||this._onPointerUpSticker(i.emoji)}.bind(this)),s.addEvent(h.POINTERHIT,function(){this._onPointerHitSticker(i.emoji,s),s.toggleClassName("selected")}.bind(this))}}),0===e)return this._displayEmptyMediaAndFolderListContainer(),this.mediaCardsContainer},actionOnShapeDrawCmdLaunced:function(){u.getIsMediaPanelCoveringFullScreen()||(this.selectedTypeCopy=this.selectedType,this.filterDataCopy={type:this.selectedType.id,label:"",subtype:this.selectedType.type},this.selectedType="",this.filterData={type:"",label:"",subtype:[]},this._updateTypes(),this.updateMediaPanelStyling(),this.updateRightPanelStyling())},_updateShapesCardContainer:function(){document.getElementsByClassName("shapeCard").length;this.shapeList.forEach(t=>{let i=f.getCommand(t.cmd),s=!0;if("CreateProfileDrawCmd"===i._id&&(C.getPreferenceValue("ActivateMultiDraw")||(s=!1)),s){i.setPanoplyManager(this.panoplyManager);let s=i.getButton();this.mediaCardsContainer.appendChild(s);let a=function(){var e=f.getCommand(t.cmd);e&&e.isRunning()&&e.end(),this.slideOutOfView()}.bind(this),n=function(){u.getIsMediaPanelCoveringFullScreen()&&setTimeout(function(){u.isScreenDimensionMobilePhone()?e.publish({event:"3DSketch.toggle.any.panoply",data:{panoplyID:"AddMedia"}}):(this.selectedTypeCopy=this.selectedType,this.filterDataCopy={type:this.selectedType.id,label:"",subtype:this.selectedType.type},this.selectedType="",this.filterData={type:"",label:"",subtype:[]},this._updateTypes(),this.updateMediaPanelStyling(),this.updateRightPanelStyling())}.bind(this),50)}.bind(this);this.shapeCardList.push(s),s.addEvent(h.POINTERDOWN,function(i){for(var r=0;r<this.shapeList.length;++r)if(this.shapeList[r].cmd===t.cmd);else{var d=f.getCommand(this.shapeList[r].cmd);d&&d.isRunning()&&d.end()}void 0!==this.panoplyManager.getCurrentPanoply()&&"Selection"===this.panoplyManager.getCurrentPanoply().getID()||e.publish({event:"3DSketch.toggle.any.panoply",data:{panoplyID:"Selection"}}),f.getCommand("SwitchDrawingToolCmd").applyCurrentDrawPenTool(),this.shapeDragManager.launchDrag({card:s,mediaPanelContainer:this.mediaPanelContainer,shape:t,pointerMoveCallback:a,pointerUpCallback:n},i)}.bind(this))}})},loadSVG:function(e,t){return new y(function(i){require([e],function(e){t(e),i(e)})})},_updateComparisonTypesContainer:function(){let e=t.createElement("div",{id:"comaprison-types-container",styles:{width:"100%",height:"100%",display:"flex","flex-wrap":"wrap","flex-direction":"row"}}).inject(this.mediaCardsContainer);this.comparisonTypes.forEach(i=>{let s=t.createElement("div",{class:"comparisonType-container",styles:{width:"166px",height:"186px",margin:"10px",background:"#e2e4e3",border:"1px solid #d1d4d4",display:"flex","flex-direction":"column",position:"relative","align-items":"stretch"}});s.inject(e);let a=URL.createObjectURL(new Blob([i.comparisonType_thumbnail],{type:"image/svg+xml"})),n=new t.Element("div",{class:"comparisonType-image",styles:{width:"150px",height:"150px",margin:"5px","background-image":"url("+a+")","background-repeat":"no-repeat","background-position":"center","background-size":"contain"}});n.inject(s),new t.Element("div",{class:"comparisonType-name",html:i.comparisonType,styles:{"font-family":"3ds","text-align":"center",background:"#f9f9f9",flex:1}}).inject(s);let r=new t.Element("div",{class:"comparisonType-status",styles:{position:"absolute",top:"0px",left:"0px",visibility:"hidden"}});r.inject(s),new t.Element("span",{class:"fonticon fonticon-check",styles:{color:"rgb(255, 255, 255)","background-color":"#368EC4","text-align":"center","font-size":"15px","line-height":"unset"}}).inject(r),s.addEvent(h.POINTERDOWN,function(){m.clean(s),m.draggable(n,{data:JSON.stringify({data:{items:[{type:"comparisonType",data:i.comparisonType,serviceId:"3DWhiteboard"}]}}),start:this.cardCallbacks.onDragStart,stop:this.cardCallbacks.onDragStop})}.bind(this)),s.addEvent(h.POINTERHIT,function(){s.toggleClassName("selected"),r.toggleClassName("selected"),this.selectedMedia.get(i)?this.selectedMedia.delete(i):this.selectedMedia.set(i,i),this._updateAddButton()}.bind(this))})},_createTitleContainer:function(){let a=t.createElement("div",{id:"mediaPanelTitleRoot"}),n=t.createElement("div",{id:"mediaPanelTitle",text:this.nls.get(this.selectedType.id+".longtitle")}).inject(a),r=t.createElement("div",{id:"mediaPanelTitleOptions",styles:{width:"100%"}}).inject(a),o=t.createElement("div",{id:"mediaPanelTitle_Buttons"}).inject(n);if("upload"===this.selectedType.id){var l=new i({className:"minifiedButton fonticon fonticon-i-question",buttonText:"",attributes:{"data-uid_po":"mediaPanel popoverButton"}}).inject(o),h=[{type:["picture"],name:this.nls.get("images.longtitle")},{type:["video"],name:this.nls.get("videos.longtitle")},{type:["document","pdf","office"],name:this.nls.get("files.longtitle")},{type:["3d_model"],name:this.nls.get("models.longtitle")}],c='<table class="table table-condensed">';h.forEach(e=>{c+="<tr> \n                      <th>"+e.name+"</th> \n                      <th>";var t=[];e.type.forEach(e=>{t=t.concat(this.fileServices.getSupportedExtensions(e))}),t.forEach(e=>{c+="."+e+" "}),c+="</th> <th>";var i=this.fileServices.getReadableMaxSize(e.type[0]);c+=i+"</th> </tr>"});new d({target:l.getContent(),position:"bottom right",allowedPositions:["bottom left","bottom right"],className:"mediaInfosPopover",title:this.nls.get("mediaInfosPopoverTitle"),body:c,trigger:"touch"})}else{this.buttonOrder=new i({className:"minifiedButton fonticon fonticon-"+(this.selectedOrder.fonticon?this.selectedOrder.fonticon:"alpha-sorting-a-z"),buttonText:"",attributes:{"data-uid_po":"mediaPanel orderListButton"}}).inject(o);new s({className:"orderList",renderTo:r,target:this.buttonOrder.getContent(),items:this._createOrderList(),events:{onClick:function(e,t){this.selectedOrder=t,this.onChangeOrderView(this.selectedOrder.id),this._onRequestChange()}.bind(this)}});this.buttonOrder.onClick=this.orderListButtonClick;var p=new i({className:"minifiedButton fonticon fonticon-filter"+(this.filterActive?" active":""),buttonText:"",attributes:{"data-uid_po":"mediaPanel filterButton"}}).inject(o);p.onClick=function(){p.toggleActive(),this.toggleFilter()}.bind(this)}return this.collapseButton=new i({className:"minifiedButton fonticon fonticon-close",buttonText:"",attributes:{"data-uid_po":"mediaPanel collapseButton"}}).inject(o),this.collapseButton.onClick=function(){u.isScreenDimensionMobilePhone()?e.publish({event:"3DSketch.toggle.any.panoply",data:{panoplyID:"AddMedia"}}):(this.selectedType="",this.filterData={type:"",label:"",subtype:[]},this._updateTypes()),this.updateMediaPanelStyling(),this.updateRightPanelStyling()}.bind(this),a},orderListButtonClick:function(){let e=document.getElementsByClassName("orderList")[0];e&&(e.style="")},toggleFilter:function(){this.filterContainer.toggleClassName("active"),this.filterActive=!this.filterActive},toggleHierarchy:function(){this.hierarchyContainer.toggleClassName("active"),this.hierarchyActive=!this.hierarchyActive,this._onRequestChange()},_createThreadContainer:function(){let e=t.createElement("div",{id:"mediaPanelThread"});var s,a=this._createThreadList();return a.length>1?((s=new i({value:this.selectedThread.text,className:"threadListButton",icon:this.selectedThread.icon,dropdownCaret:!0,dropdown:{className:"threadList",renderTo:e,target:e,items:a},attributes:{"data-uid_po":"mediaPanel threadListButton"}}).inject(e)).onClick=this.threadListButtonClick,s.onDropdownClick=function(e,t){this.selectedThread=t,this._onRequestChange()}.bind(this)):s=new i({value:this.selectedThread.text,className:"threadListButton",icon:this.selectedThread.icon,dropdownCaret:!1}).inject(e),e},threadListButtonClick:function(){let e=document.getElementsByClassName("threadList")[0];e&&(e.style="")},_createFilterContainer:function(){this.filterContainer=t.createElement("div",{id:"mediaPanelFilter",class:this.filterActive?"active":""});var e=t.createElement("div",{id:"nameFilter"}).inject(this.filterContainer);if(this.form=new o({className:"inline searchform",fields:[{type:"text",placeholder:"Search...",value:this.filterData.label,name:"search",attributes:{"data-uid_po":"mediaPanel searchBar"}}],buttons:[{type:"submit",value:"",className:"searchValidateButton fonticon fonticon-search",attributes:{"data-uid_po":"mediaPanel searchValidate"}}]}).inject(e),this.form.onSubmit=function(){this.filterData.label=this.form.getInput("search").getValue(),this._onRequestChange()}.bind(this),this.form.getInput("search").elements.input.addEventListener("blur",function(){this.form.onSubmit()}.bind(this)),this.form.buttons[0].getContent().addEventListener("click",function(){this.form.onSubmit()}.bind(this)),this.selectedType.type instanceof Array&&"drive"!==this.selectedThread.id&&"space"!==this.selectedThread.id){var s=t.createElement("div",{id:"typeFilter"}).inject(this.filterContainer),a=[];this.selectedType.type.forEach(e=>{a.push(new i({className:"searchbuttontype "+("library"===this.selectedThread.id?this.icons[e].fonticon:this.icons["swym:"+e].fonticon)+(this.filterData.subtype.includes(e)?" active":""),name:e,buttonText:"",attributes:{styles:{width:100/this.selectedType.type.length+"%",height:"100%",margin:0},"data-uid_po":"mediaPanel subType "+e}}))}),this.toggle=new l({type:"checkbox",buttons:a,events:{onClick:function(e,t){this.filterData.subtype=[],t.isActive()&&this.filterData.subtype.push(t.getName()),this._onRequestChange()}.bind(this)}}).inject(s)}return this.filterContainer},_createHierarchyContainer:function(){this.hierarchyContainer=t.createElement("div",{id:"mediaPanelHierarchy",class:this.hierarchyActive&&this.selectedThread.supportHierarchy?"active":""});var e=t.createElement("div",{class:"hierarchyBreadcrumbs breadcrumb"}).inject(this.hierarchyContainer);for(let s="drive"===this.selectedThread.id?this.hierarchyDrive.length-1:this.hierarchySpace.length-1;s>=0;s--){var i=t.createElement("span",{class:"hierarchyBreadcrumb breadcrumb-item",text:"drive"===this.selectedThread.id?this.hierarchyDrive[s].name:this.hierarchySpace[s].name,id:"breadcrumbs-"+s}).inject(e);t.createElement("i",{class:"hierarchyBreadcrumbDivider fonticon fonticon-chevron-right "}).inject(e),i.addEvent(h.POINTERHIT,function(){"drive"===this.selectedThread.id?(this.hierarchyDrive.splice(s+1,1/0),this.folderIDDrive=this.hierarchyDrive[s].id):"space"===this.selectedThread.id&&(this.hierarchySpace.splice(s+1,1/0),this.folderIDSpace=this.hierarchySpace[s].id),this._onRequestChange()}.bind(this))}return t.createElement("span",{class:"hierarchyBreadcrumb breadcrumb-item fonticon fonticon-home",id:"breadcrumbs-root"}).inject(e).addEvent(h.POINTERHIT,function(){"drive"===this.selectedThread.id?(this.hierarchyDrive=[],this.folderIDDrive=void 0):"space"===this.selectedThread.id&&(this.hierarchySpace=[],this.folderIDSpace=void 0),this._onRequestChange()}.bind(this)),this.hierarchyContainer},_createEmptyMediaAndFolderListContainer:function(){return this.emptyMediaFolderListContainer=t.createElement("div",{id:"emptyMediaAndFolderList"}),t.createElement("div",{text:this.nls.noMedia,styles:{"margin-top":"","margin-left":""}}).inject(this.emptyMediaFolderListContainer),this.emptyMediaFolderListContainer},_displayEmptyMediaAndFolderListContainer:function(){this.emptyMediaFolderListContainer.className="active",this._hideLoadingContainer(),this._hideLoadingMoreContainer(),this._hideEmptyMediaListContainer()},_hideEmptyMediaAndFolderListContainer:function(){this.emptyMediaFolderListContainer.className=""},_createLoadingContainer:function(){this.loadingContainer=t.createElement("div",{id:"loading"});let e=t.createElement("div",{class:"spinner",styles:{display:"unset"}}).inject(this.loadingContainer);return this.spinner=new n({zIndex:2e3}).inject(e).show(),t.createElement("div",{text:this.nls.loadingMessage,styles:{"margin-top":"10px","margin-left":"10px"}}).inject(this.loadingContainer),this.loadingContainer},_displayLoadingContainer:function(){this.loadingContainer.className="active",this._hideEmptyMediaAndFolderListContainer(),this._hideLoadingMoreContainer()},_hideLoadingContainer:function(){this.loadingContainer.className=""},_createUploadContainer:function(){let e=t.createElement("div",{id:"uploadContainer"});return new a({className:"uploadButton btn-primary btn btn-root",buttonClassName:"uploadButton fonticon fonticon-upload",input:!1,buttonText:this.nls.uploadFiles,multiple:!0,attributes:{"data-uid_po":"mediaPanel uploadButton"}}).inject(e).onChange=function(e){e&&e.target.files&&this._onUploadNewMedias(e.target.files)}.bind(this),e},_updateTypes:function(){for(var e=this.typesContainer.getChildren(),t=0;t<e.length;t++)if(this.selectedType&&e[t].id===this.selectedType.id){let i=document.getElementsByClassName("mediaType")[0];if(i){let s=getComputedStyle(i),a=i.parentElement,n=parseInt(s.height.slice(0,-2))+parseInt(s.marginTop.slice(0,-2))+parseInt(s.marginBottom.slice(0,-2)),r=parseInt(getComputedStyle(a).marginTop.slice(0,-2));e[0].lastChild.style.top=(n||80)*t+(r||0)+"px",e[0].lastChild.style.height=(n||80)+"px"}e[t].addClassName("selected")}else e[t].removeClassName("selected")},_updateMediaCard:function(){let e=this.mediaListContainer.getDimensions(),t=100;0<=e.width&&e.width<250?t=100:250<=e.width&&e.width<400?t=50:400<=e.width&&e.width<600?t=33:600<=e.width&&(t=25),this.mediaCardList.forEach(e=>{e.setSize(t)}),this.folderCardList.forEach(e=>{e.setSize(t)})},_updateMediasContainer:function(e){let t=document.getElementsByClassName("folderCard").length,i=document.getElementsByClassName("mediaCard").length;if(0!==this.mediaList[this.page].length){for(var s=0;s<this.mediaList[this.page].length;s++){var a=this.mediaList[this.page][s],n=a.id;if(this.hierarchyActive&&this.selectedThread.supportHierarchy){if(a.isFolder){let e=new p({folder:a,callback:this._onPointerHitFolder.bind(this)});e.getCard().inject(this.folderCardsContainer),this._hideEmptyMediaAndFolderListContainer(),this.folderCardList.set(n,e),t++;continue}if(!this._isAcceptableExtension(a)||!a.title.includes(this.filterData.label))continue}let e=new c({media:a,type:this.selectedType,callback:this.cardCallbacks,swymIcons:this.icons});e.getCard().inject(this.mediaCardsContainer),this._hideEmptyMediaListContainer(),this.mediaCardList.set(n,e),i++}this.mediaList[this.page].length===this.pagesize&&this.nbResults>this.page*this.pagesize+this.mediaList[this.page].length&&this.scroller.elements.content.addEvent("scroll",this._onScroll.bind(this)),e?0===t&&0===i?this._displayLoadingContainer():this._displayLoadingMoreContainer():(this._hideLoadingContainer(),this._hideLoadingMoreContainer(),0!==i||"space"===this.selectedThread.id&&0===this.hierarchySpace.length||"drive"===this.selectedThread.id&&0===this.hierarchyDrive.length||(0===t?this._displayEmptyMediaAndFolderListContainer():this._displayEmptyMediaListContainer())),this.scroller.update(),this._updateMediaCard()}else this._hideLoadingMoreContainer()},_updateAddButton:function(){let e=document.getElementById("mediaPanel"),s=document.getElementById("mediaPanelAdd");if(s&&s.remove(),this.selectedMedia.size>0&&e){let s=t.createElement("div",{id:"mediaPanelAdd"}).inject(e);new i({value:this.nls.addMedia+" ("+this.selectedMedia.size+")",className:"addButton primary",attributes:{"data-uid_po":"mediaPanel addButton"}}).inject(s).onClick=function(){this._onAddMedias(this._createDragData())}.bind(this)}},_createThreadList:function(){for(var e=[],t=0;t<this.threadList.length;t++)this.threadList[t].id===this.selectedThread.id?this.threadList[t].selected=!0:this.threadList[t].selected=!1,this.selectedType.source[this.threadList[t].id]&&e.push(this.threadList[t]);return e},_createOrderList:function(){for(var e=this.orderList,t=0;t<e.length;t++)e[t].id===this.selectedOrder.id?e[t].selected=!0:e[t].selected=!1;return e},_createDragData:function(){let e={protocol:"3DXContent",version:"2.0",source:"X3DMCTY_AP",data:{items:[]}};return this.selectedMedia.forEach(t=>{if("asset"===this.selectedThread.source)t.comparisonType?e.data.items.push({type:"comparisonType",data:t.comparisonType,serviceId:"3DWhiteboard"}):e.data.items.push({type:"sticker",data:t,serviceId:"3DWhiteboard"});else{let i={envId:t.envId,objectId:t.id,displayName:t.title,displayPreview:t.preview,defaultApp:"X3DMCTY_AP",contextId:""};"swym"===this.selectedThread.source?(i.serviceId="3DSwym",i.objectType="media",i.processAsLink="swym"===this.selectedType.id,i.ResourceURL=t.ressourceURL,i.objectSubType=this.selectedType.type):"drive"===this.selectedThread.source?(i.serviceId="3DDrive",i.objectType="DriveFile"):"3dspace"===this.selectedThread.source&&(i.serviceId="3DSpace",i.objectType=t.type),e.data.items.push(i)}}),JSON.stringify(e)},_getValue:function(e,t){for(var i=0;i<e.length;i++){if(e[i].name&&e[i].name===t)return e[i].value?e[i].value:void 0;if(e[i].sixw&&e[i].sixw===t)return e[i].object?e[i].object:e[i].dispValue?e[i].dispValue:void 0}},_getUploadType:function(){for(var e=0;e<this.typeList.length;e++)if("upload"===this.typeList[e].id)return this.typeList[e]},_getFileExtensions:function(){this.extensions={Picture:[],AnimatedPicture:[],Video:[],Document:[],Models:[]},this.inacceptableExtensions={Picture:[],AnimatedPicture:[],Video:[],Document:[],Models:[]};var e=(e,t)=>{t.forEach(t=>{e.push(t)})};this.extensions.Picture=[...this.fileServices.getSupportedExtensions("picture")],this.extensions.Picture.splice(this.extensions.Picture.indexOf("gif"),1),this.extensions.AnimatedPicture.push("gif"),this.extensions.Video=[...this.fileServices.getSupportedExtensions("video")],this.extensions.Video.splice(this.extensions.Video.indexOf("gif"),1),this.extensions.Document=[...this.fileServices.getSupportedExtensions("office")],this.extensions.Document=this.extensions.Document.concat([...this.fileServices.getSupportedExtensions("pdf")]),this.extensions.Models=[...this.fileServices.getSupportedExtensions("3d_model")],e(this.inacceptableExtensions.Picture,this.extensions.AnimatedPicture),e(this.inacceptableExtensions.Picture,this.extensions.Video),e(this.inacceptableExtensions.Picture,this.extensions.Document),e(this.inacceptableExtensions.Picture,this.extensions.Models),e(this.inacceptableExtensions.AnimatedPicture,this.extensions.Picture),e(this.inacceptableExtensions.AnimatedPicture,this.extensions.Video),e(this.inacceptableExtensions.AnimatedPicture,this.extensions.Document),e(this.inacceptableExtensions.AnimatedPicture,this.extensions.Models),e(this.inacceptableExtensions.Video,this.extensions.Picture),e(this.inacceptableExtensions.Video,this.extensions.AnimatedPicture),e(this.inacceptableExtensions.Video,this.extensions.Document),e(this.inacceptableExtensions.Video,this.extensions.Models),e(this.inacceptableExtensions.Document,this.extensions.Picture),e(this.inacceptableExtensions.Document,this.extensions.AnimatedPicture),e(this.inacceptableExtensions.Document,this.extensions.Video),e(this.inacceptableExtensions.Document,this.extensions.Models),e(this.inacceptableExtensions.Models,this.extensions.Picture),e(this.inacceptableExtensions.Models,this.extensions.AnimatedPicture),e(this.inacceptableExtensions.Models,this.extensions.Video),e(this.inacceptableExtensions.Models,this.extensions.Document)},_getAcceptableExtensions:function(){return this.selectedType.type instanceof Array&&"3dModel"===this.selectedType.type[0]?this.extensions.Models:this.extensions[this.selectedType.type]},_getInacceptableExtensions:function(){return this.selectedType.type instanceof Array&&"3dModel"===this.selectedType.type[0]?this.inacceptableExtensions.Models:this.inacceptableExtensions[this.selectedType.type]},camelize:function(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0===t?e.toLowerCase():e.toUpperCase()}).replace(/\s+/g,"")},_isFolder:function(e){return"DriveFolder"===e.type},_isAcceptableExtension:function(e){var t;if("space"===this.selectedThread.id&&"models"===this.selectedType.id){if("Workspace"===e.type)return!1;if(t=this._getInacceptableExtensions()){let i=e.extension?e.extension.toLowerCase():void 0,s=!0;return(!i||!t.includes(i))&&s}}return!!(t=this._getAcceptableExtensions())&&t.includes(e.extension?e.extension.toLowerCase():void 0)},_onRequestChange:function(){if(this.page=0,this.mediaList=[],this.mediaList[this.page]=[],this.selectedType&&!this.selectedType.source[this.selectedThread.id])for(var e=0;e<this.threadList.length;e++)if(this.selectedType.source[this.threadList[e].id]){this.selectedThread=this.threadList[e];break}!this.selectedType||"upload"!==this.selectedType.id&&"stickers"!==this.selectedType.id&&"shapes"!==this.selectedType.id?("drive"!==this.selectedThread.id&&"space"!==this.selectedThread.id||this.onChangeCurrentDirectory({drive:this.hierarchyDrive,space:this.hierarchySpace}),this.recreateView(!0),this.onRequestChange({thread:this.selectedThread.id,type:0!==this.filterData.subtype.length?this.filterData.subtype:this.selectedType.type,source:this.selectedThread.source,label:this.filterData.label,extensions:this._getAcceptableExtensions(this.selectedType.uploadable," *."),order:this.selectedOrder,page:this.page,hierarchyMode:this.hierarchyActive&&this.selectedThread.supportHierarchy,folderID:"drive"===this.selectedThread.id?this.folderIDDrive:this.folderIDSpace,search:{}})):this.recreateView()},_onRequestNewPage:function(){this.onRequestNewPage({thread:this.selectedThread.id,type:0!==this.filterData.subtype.length?this.filterData.subtype:this.selectedType.type,source:this.selectedThread.source,label:this.filterData.label,extensions:this._getAcceptableExtensions(this.selectedType.uploadable," *."),order:this.selectedOrder,page:this.page,hierarchyMode:this.hierarchyActive&&this.selectedThread.supportHierarchy,folderID:"drive"===this.selectedThread.id?this.folderIDDrive:this.folderIDSpace,search:{}})},_onPointerDownMediaCard:function(e,t){this.selectedMedia.set(e,t),this.mediaCardList.get(e).setDragData(this._createDragData())},_onPointerUpMediaCard:function(e){this.selectedMedia.delete(e)},_onPointerHitMediaCard:function(e,t){this.selectedMedia.get(e)?this.selectedMedia.delete(e):this.selectedMedia.set(e,t),this._updateAddButton()},_onPointerDownSticker:function(e,t){this.selectedMedia.set(e,e),t.lastChild.toggleClassName("selected")},_onPointerUpSticker:function(e){this.selectedMedia.delete(e)},_onPointerHitSticker:function(e,t){this.selectedMedia.get(e)?this._onPointerUpSticker(e):this._onPointerDownSticker(e,t),this._updateAddButton()},_onPointerHitFolder:function(e,t){this.page=0,"drive"===this.selectedThread.id?(this.folderIDDrive=e,this.hierarchyDrive.push({id:e,name:t.title})):"space"===this.selectedThread.id&&(this.folderIDSpace=e,this.hierarchySpace.push({id:e,name:t.title})),this._onRequestChange()},_onRequestPreviews:function(){this.onRequestPreviews({thread:this.selectedThread.id,type:0!==this.filterData.subtype.length?this.filterData.subtype:this.selectedType.type,source:this.selectedThread.source,label:this.filterData.label,extensions:this._getAcceptableExtensions(this.selectedType.uploadable," *."),order:this.selectedOrder,page:this.page,hierarchyMode:this.hierarchyActive&&this.selectedThread.supportHierarchy,folderID:"drive"===this.selectedThread.id?this.folderIDDrive:this.folderIDSpace,medias:this.mediaList[this.page],search:{}})},_onScroll:function(){this.scroller.update();var e=this.scroller._infos.y;e.scrollSize<e.scrollPosition+e.offsetSize+600&&(this.page++,this._displayLoadingMoreContainer(),this._onRequestNewPage(),this.scroller.elements.content.removeEvent("scroll"),this.scroller.update())},_onUploadNewMedias:function(e){this.onUploadNewMedias(e),this._onRequestChange()},_onAddMedias:function(e){this.onAddMedias(e),this._onRequestChange()},_onWindowResizeCB:function(){u.isScreenDimensionMobilePhone()&&!this.selectedType&&(e.publish({event:"3DSketch.toggle.any.panoply",data:{panoplyID:"AddMedia"}}),this.selectedTypeCopy&&this.filterDataCopy?(this.selectedType=this.selectedTypeCopy,this.filterData=this.filterDataCopy):(this.selectedType=this.typeList[0],this.filterData={type:this.selectedType.id,label:"",subtype:[]})),u.isScreenDimensionMobilePhone()||!1!==this.isVisible()||(e.publish({event:"3DSketch.toggle.any.panoply",data:{panoplyID:"AddMedia"}}),this.selectedType="",this.filterData={type:"",label:"",subtype:[]}),this._updateTypes(),this._updateMediaCard(),this.updateMediaPanelStyling(),this.updateRightPanelStyling(),this.recreateView()}});return t.namespace("DS/CAT3DWMediaPanelView/CAT3DWMediaPanelView",v)});