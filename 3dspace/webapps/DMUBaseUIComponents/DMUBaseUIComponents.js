define("DS/DMUBaseUIComponents/DMUCommonCommandsComponent",[],function(){"use strict";let e=null,t=null,n=null,i=[{id:"AnnotationSwitchOnOff",type:"check",localStorageID:"CAT3DAnnotationSwitchOnOffCmd"},{id:"AnnotationBlanking",type:"check",localStorageID:"CAT3DAnnotationBlankingCmd"},{id:"CATRelatedData3DGridHdr",type:"check",localStorageID:"CATRelatedData3DGridCmd"},{id:"CATWebUXGenerateIssueHdr",type:"default",init:"true"},{id:"CATWebUXGenerateIssueTemplateHdr",type:"default",init:"true"},{id:"CATWebUXGenerateCAHdr",type:"default",init:"true"},{id:"PIMWebUXGenerateIssueHdr",type:"default",init:"true",enable:"false"},{id:"PIMWebUXGenerateIssueTemplateHdr",type:"default",init:"true",enable:"false"},{id:"PIMWebUXGenerateCAHdr",type:"default",init:"true",enable:"false"},{id:"DMUCopyHdr",type:"default",enable:"false"},{id:"DMUCutHdr",type:"default",enable:"false"},{id:"DMUPasteHdr",type:"default",enable:"false"},{id:"DMUPasteSpecialHdr",type:"default",enable:"false"},{id:"CAT3DComposeExamineSelectionHdr",type:"default",enable:"false"},{id:"UPSAuthReplaceByExisting",type:"default",enable:"false"},{id:"UPSAuthUnparent",type:"default",enable:"false"},{id:"DMUSwitch3DMarkersResponsiveDisplayHdr",type:"check",localStorageID:"DMU3DMarkersResponsiveDisplay"}],o=function(e){for(let t=0;t<i.length;t++)if(i[t].id===e)return i[t];return!1};return class{constructor(i){this.initialize=function(){return(t=(e=this).getExecutionContext())&&t.getComponent&&(n=t.getComponent(WAfrStandardComponentKey.HandlerComponent)),new Promise(async e=>{for(let e=0;e<i.length;e++){let t=o(i[e].id);t&&("check"===t.type?(n.setCheckState({id:t.id,state:"true"===localStorage.getItem(t.localStorageID)}),"AnnotationSwitchOnOff"===t.id&&("true"===localStorage.getItem(t.localStorageID)?(n.enableCheck("AnnotationFilter"),n.enableCheck("AnnotationBrowser"),n.enableCheck("AnnotationSemanticBrowser")):(n.disableCheck("AnnotationFilter"),n.disableCheck("AnnotationBrowser"),n.disableCheck("AnnotationSemanticBrowser")))):"default"===t.type&&("true"===t.init&&await n.executeHandler({id:t.id}),t.enable&&("true"===t.enable?n.enableHandler(t.id):n.disableHandler(t.id))))}e()})},this.clean=function(){return new Promise(e=>{e()})},this.destroy=function(){return new Promise(e=>{e()})},this.canBeParallelized=function(){return!1}}}}),define("DS/DMUBaseUIComponents/DMURichTextServices",["require","exports","DS/CKEditor/CKEditor","DS/PADUtils/PADUtilsServices","DS/WAFData/WAFData","DS/PADUtils/PADContext","DS/WebappsUtils/WebappsUtils","UWA/Core","DS/DMUBaseExperience/DMUContextManager"],function(e,t,n,i,o,a,s,r,l){"use strict";const c=13,d="p;p{margin-*};blockquote;strong;s;u;li;ul;ol;em;a[href];br;span(DMUCKEditorReferenceCheck)[data-id,contenteditable]";["openlink","mentions","balloontoolbar","balloonpanel","autocomplete","textwatcher"].forEach(e=>{n.plugins.addExternal(e,s.getWebappsAssetUrl("DMUBaseUIComponents",`ckeditor/plugins/${e}/`),"plugin.js")});const u={1:{icon:"wux-ui-3ds-i-question",color:"rgb(0, 125, 163)"},2:{icon:"wux-ui-3ds-check",color:"#477738"},3:{icon:"wux-ui-3ds-wrong",color:"#ea4f37"}},m={1:{icon:"wux-ui-3ds-attention",color:"#007DA3"},2:{icon:"wux-ui-3ds-level-low",color:"rgb(71,119,56)"},3:{icon:"wux-ui-3ds-level-medium",color:"rgb(232,123,0)"},4:{icon:"wux-ui-3ds-level-high",color:"rgb(234,79,55)"},5:{icon:"wux-ui-3ds-check",color:"rgb(71, 119, 56)"},6:{icon:"wux-ui-3ds-alert",color:"rgb(153, 7, 7)"}};n.on("dialogDefinition",function(e){let t=e.data.name,i=e.data.definition;"link"===t&&(i.minHeight=50,i.resizable=n.DIALOG_RESIZE_NONE,i.buttons[0]=i.buttons[0].override({class:"wux-controls-abstract wux-controls-button wux-ui-state-primary wux-ui-style-normal"}),i.buttons[1]=i.buttons[1].override({class:"wux-controls-abstract wux-controls-button wux-ui-state-secondary wux-ui-style-normal"}),i.contents[0].elements[0].className="DMUCKEditorDialogNoDisplay",i.contents[0].elements[1].className="DMUCKEditorDialogNoDisplay",i.contents[0].elements[2].children[0].children[0].className="DMUCKEditorDialogNoDisplay",i.dialog.parts.dialog.getElementsByTag("td").getItem(0).setStyle("borderRadius","6px"),i.dialog.parts.dialog.getElementsByTag("td").getItem(0).setStyle("overflow","hidden"),i.dialog.parts.title.setStyles({background:"#FFFFFF",padding:"5px",fontSize:"14px"}),i.dialog.parts.close.setStyle("top ","4px"),i.dialog.parts.footer.setStyle("background ","#f1f1f1"))});const p={title:!1,extraPlugins:"balloontoolbar,openlink,link,liststyle",removePlugins:"liststyle,elementspath,magicline,exportpdf,copyformatting,editorplaceholder,resize,iframe,smiley,forms,maximize,print,save,table,tabletools,tableselection,uploadwidget,uploadimage,showblocks,showborders,contextmenu",linkShowAdvancedTab:!1,linkShowTargetTab:!1,linkDefaultProtocol:"https://",dialog_noConfirmCancel:!0,toolbar:[],height:150,startupFocus:!1,toolbarLocation:"bottom",allowedContent:d,shiftEnterMode:n.ENTER_P,removeFormatTags:"a,b,big,cite,code,del,dfn,em,font,i,ins,kbd,q,s,samp,small,span,strike,strong,sub,sup,tt,u,var",removeButtons:"PasteFromWord",enableContextMenu:!1,on:{paste:function(e){const t=e.data,i=e.editor.dataProcessor,o=new n.filter(d);t.dataValue=i.toHtml(t.dataValue,{filter:o,fixForBody:!1})},instanceReady:function(e){let t=e.editor;t.dataProcessor.writer.setRules("p",{breakAfterClose:!1}),t.ui.addButton("OpenLink",{command:"openLink",toolbar:"links,50",label:t.lang.openlink.menu}),t.balloonToolbars.create({cssSelector:"div"}).toolbar.addItems({bold:t.ui.create("Bold"),italic:t.ui.create("Italic"),underline:t.ui.create("Underline"),strike:t.ui.create("Strike"),sep1:t.ui.create("-"),numberedList:t.ui.create("NumberedList"),bulletedList:t.ui.create("BulletedList"),sep2:t.ui.create("-"),outdent:t.ui.create("Outdent"),indent:t.ui.create("Indent"),sep3:t.ui.create("-"),removeFormat:t.ui.create("RemoveFormat"),sep4:t.ui.create("-"),link:t.ui.create("Link")}),t.balloonToolbars.create({buttons:"OpenLink,Link,Unlink",cssSelector:"a[href]"})}}};let f;function h(e,t){let n="",i=t;for(;i;)n+="&#32;&#32;&#32;&#32;",i=i.getAscendant("li");let o=1;t.children.forEach(t=>{const i="ol"===e?o+". ":"- ";"li"===t.name?(t.setHtml("&#13;"+n+i+t.getHtml()),o++):t.setHtml(n+t.getHtml())})}function g(e){let t=document.createElement("textarea");return t.innerHTML=e,t.value}class w{static getMentionsFromContent(e){const t=/<a href="[^"]+login=([^"]+)&[^"]+type=([^&]+)&[^"]+">@([^<]+)<\/a>/g;let n,i=[];for(;null!==(n=t.exec(e));){const e=g(n[1].toLocaleLowerCase()),t=n[2].toLocaleLowerCase(),o=n[3];i.push({id:e,name:o,type:t})}return i}static createRichTextElement({className:e,allowMentions:t}={}){const s=r.createElement("div",{class:e});s.setAttribute("contenteditable","true");const d=t?{...p,extraPlugins:p.extraPlugins+",mentions",mentions:[{feed:async function(e,t){var a,s;null===(s=null===(a=n.currentInstance)||void 0===a?void 0:a.balloonToolbars)||void 0===s||s.hide();const r=await("boolean"==typeof f?Promise.resolve(f):new Promise(function(e){window.require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(t){t.getServiceUrl({serviceName:"usersgroup",platformId:i.getPlatformId(),onComplete:function(t){e(f="string"==typeof t&&""!==t)},onFailure:function(){e(f=!1)}})})})),l=i.get3DSearchUrl()+"/search";o.authenticatedRequest(l,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({start:0,nresults:20,tenant:i.getPlatformId(),source:["swym"].concat(r?["usersgroup"]:[]),specific_source_parameter:{usersgroup:{additional_query:`AND [ds6w:label]:(${encodeURIComponent(e.query)}*)`},swym:{additional_query:` AND personOrGroup:(${encodeURIComponent(e.query)})`}},select_predicate:["ds6w:label","ds6w:type"],label:"DMUCommentUserMention-"+Date.now(),query:'[ds6w:type]:("foaf:Group" OR "pno:Person")',with_synthesis:!1,with_synthesis_attribute:!1,locale:"en"}),onComplete:function(e){const n=JSON.parse(e).results;n&&t(n.map(e=>{var t,n,i;const o=null===(t=e.attributes.find(e=>"resourceid"===e.name))||void 0===t?void 0:t.value;if(!o)return null;const a=/(<uuid:)/g.test(o)?o:null===(n=/:(.*)/g.exec(o))||void 0===n?void 0:n.at(1);if(!a)return null;const s=null===(i=e.attributes.find(e=>"ds6w:type"===e.name))||void 0===i?void 0:i.value.split(":")[1].toLowerCase();return{id:a.toUpperCase(),type:s,avatar:e.attributes.find(e=>"preview_url"===e.name).value,fullname:e.attributes.find(e=>"ds6w:label"===e.name).value}}).filter(Boolean))}})},minChars:2,marker:"@",itemTemplate:'<li data-id="{id}" class="DMUCKEditorMentionListItem"><img src="{avatar}" /><span>{fullname} ({id})</span></li>',outputTemplate:`<a href="${i.getPlatformURL("3DDashboard")}//#app:X3DPRFL_AP/content:url=${encodeURIComponent(i.getPlatformURL("3DSwym"))}&login={id}&type={type}&facet=0">@{fullname}</a><span>&nbsp;</span>`},{feed:function(e,t){var i,o,s,r;null===(o=null===(i=n.currentInstance)||void 0===i?void 0:i.balloonToolbars)||void 0===o||o.hide();const c=l.getReviewContext({context:a.get()}),d=null===(s=null==c?void 0:c.getValidation())||void 0===s?void 0:s.getChecks(),p=(null===(r=null==c?void 0:c.getValidation())||void 0===r?void 0:r.getHighlights())||[];d&&d.length&&t(d.map(t=>{if(!t.getAttribute("sName").toLowerCase().includes(e.query.toLowerCase()))return null;const n=t.getAttribute("sPlmID"),i=p.filter(e=>(e.getAttribute("lAssociatedChecks")||[]).includes(n));let o="";i.forEach(e=>{const t=e.getAttribute("sRating"),n=5===parseInt(t)?0:parseInt(t),i=5===parseInt(o)?0:parseInt(o);(!o||n>=i)&&(o=t)});const a=o?m[o]:u[t.getAttribute("sStatus")]||u[1];return{id:n,checkName:t.getAttribute("sName"),status:t.getAttribute("sStatus"),statusIconClass:a.icon,statusColor:a.color}}).filter(Boolean))},minChars:0,marker:"&",itemTemplate:'<li data-id="{id}" class="DMUCKEditorMentionListItem"><span class="wux-ui-3ds {statusIconClass}" style="color:{statusColor}"></span><span>&nbsp;{checkName}</span></li>',outputTemplate:'<span data-id="{id}" class=DMUCKEditorReferenceCheck contenteditable="false">{checkName}</span>&nbsp;'}]}:p;let h=n.inline(s,d);const g=[];let v;h.on("contentDom",function(){let e=h.editable();e&&e.attachListener(e,"click",function(t){const i=t.data.getTarget();let o=new n.dom.elementPath(i,e).contains("a");if(o&&2!==t.data.$.button&&o.isReadOnly())return void window.open(o.getAttribute("href"));let a=new n.dom.elementPath(i,e).contains("span",!1,!0);if(a&&a.hasClass("DMUCKEditorReferenceCheck")&&2!==t.data.$.button&&g.length){let e=!1;if(!h.readOnly){const n=i.$.firstChild;let o=document.createRange();o.selectNodeContents(n);let a=o.getClientRects();if(a){const n=a[0];n&&t.data.$.clientX>n.x+n.width&&(e=!0)}}if(e)a.remove();else{const e=a.$.dataset.id;g.forEach(t=>t({id:e}))}}})}),h.on("key",e=>{e.data.keyCode===c&&(e.cancel(),h.focusManager.blur(),h.element.$.blur())}),h.on("focus",()=>{s.setAttribute("spellcheck",!0)}),h.on("blur",()=>{s.setAttribute("spellcheck",!1)});const C={focus:()=>{s.focus(),h.focus()},destroy:()=>{g.length=0,h.destroy(),s.destroy()},setReadOnly:e=>{v&&clearInterval(v),h.editable()?h.setReadOnly(e):v=setInterval(()=>{h.editable()&&(clearInterval(v),h.setReadOnly(e))},100)},blur:()=>h.focusManager.blur(!0),addEventListener:(e,t)=>{if("onNewMentions"===e){let e;h.on("focus",()=>{const t=h.getData();e=w.getMentionsFromContent(t)}),h.on("blur",()=>{const n=h.getData();let i=w.getMentionsFromContent(n).filter(t=>!(null==e?void 0:e.some(e=>e.id===t.id)));i.length&&t(i)})}else"onCheckSelected"===e?g.push(t):h.on("blur",()=>{const e=h.getData();h.checkDirty()&&(t(e),h.resetDirty())})},setData:e=>{h.setData(e)},getData:()=>h.getData(),inject:e=>(e.appendChild(s),C)};return C}static formatRichTextToExportToPDF(e){const t=new n.htmlParser.filter({elements:{p:function(e){e.setHtml("&#13;"+e.getHtml())},strong:function(e){e.attributes.style="font-weight:bold"},b:function(e){e.attributes.style="font-weight:bold"},em:function(e){e.attributes.style="font-style:italic"},i:function(e){e.attributes.style="font-style:italic"},u:function(e){e.attributes.style="text-decoration:underline"},s:function(e){e.attributes.style="text-decoration:line-through"},ol:function(e){h("ol",e),e.replaceWithChildren()},ul:function(e){h("ul",e),e.replaceWithChildren()},a:function(e){e.setHtml(e.getHtml()+` (<span style="text-decoration:underline">${e.attributes.href.replaceAll("&","&amp;")}</span>)`),e.attributes.style="color:#368EC4",delete e.attributes.href}}}),i=new n.htmlParser.filter({elementNames:[[/^strong$/,"span"],[/^em$/,"span"],[/^p$/,"span"],[/^i$/,"span"],[/^u$/,"span"],[/^s$/,"span"],[/^a$/,"span"],[/^li$/,"span"],[/^ol$/,"span"],[/^ul$/,"span"]]}),o=n.htmlParser.fragment.fromHtml(e),a=new n.htmlParser.basicWriter;return t.applyTo(o),i.applyTo(o),o.writeHtml(a),a.getHtml().replace("&#13;","").replaceAll("&#13;","\n").replaceAll(/<br ?\/?>/g,"\n").replaceAll("&nbsp;","&#32;")}}return w}),define("DS/DMUBaseUIComponents/DMUCommonWidgetComponent",["DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalModelEvents"],function(e,t){"use strict";return class{constructor(n){let i,o=[];this.initialize=function(){return i=this.getExecutionContext(),this.enableSwitchApp(),new Promise(t=>{n&&n.appOptionsFilePath?require(["text!"+n.appOptionsFilePath],function(n){let i=JSON.parse(n);e.setApp(i,"eno3dviewerinfra",!1).then(t)}):t()})},this.enableSwitchApp=function(){o.push(t.subscribe({event:"ExternalSwitchRequested"},function(e){i.switchApp(e.id+"WebApp").then(()=>{t.publish({event:"SwitchSuccessful"})})}))},this.clean=function(){return new Promise(e=>{i=void 0,e()})},this.destroy=function(){return new Promise(e=>{o.forEach(t.unsubscribe,t),e()})},this.getSessionWidget=function(){return window.widget},this.canBeParallelized=function(){return!1}}}}),define("DS/DMUBaseUIComponents/DMUCommonContextComponent",["DS/WebappsUtils/WebappsUtils","DS/Selection/CSOManager"],function(e,t){"use strict";return class{constructor(n){this._identifiers={view:n.viewIdentifier,widget:n.widgetIdentifier},this._contextConfigPath=n.ctxOptions,this._nlsAMDPath=n.nlsAMDPath,this._contextConfig=[],this._nls=null,this._nlsAMDPromises=[],this._wafrContextContainer=null,this._isContextBarVisible=!1,this._view=null,this._widget=null;let i=this,o=!1,a=function(n,o){var a=[],s=[];if(!Boolean(0===o.length&&0===t.get().length)){let e=t.get();var r=e&&e[0]&&e[0].pathElement?e[0].pathElement.getLastElement(!0):null,l=r&&r.getDMUType?r.getDMUType():"";if("DMUClipping"===l||"DMUSection"===l||"DMUMeasure"===l||"DMUSlide"===l||"DMUFormat"===l)return[];s=n.ContextMenu.onGeometry}for(var c=0;c<s.length;++c)if("openwith"===s[c].identifier){var d=s[c];let t=[];if(d.submenu){let n="ambience"===d.identifier;for(let o=0;o<d.submenu.length;++o)"SeparatorItem"===d.submenu[o].type?t.push({type:d.submenu[o].type}):t.push({title:i._nls[d.submenu[o].handlerId?d.submenu[o].handlerId:d.submenu[o].identifier],type:d.submenu[o].type,handlerId:d.submenu[o].handlerId,icon:d.submenu[o].iconPath?e.getWebappsAssetUrl(d.submenu[o].module,d.submenu[o].iconPath):void 0,state:d.submenu[o].state,action:{this:i,callback:function(e,t,n){if("WAfrCheckHandlerItem "===e[t].type&&(e[t].state="selected"===e[t].state?void 0:"selected"),!0===n){for(let t=0;t<e.length;++t)e[t].state=void 0;e[t].state="selected",window.localStorage.setItem("ENO3DViewViewerAmbience",e[t].identifier)}i.getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler({id:e[t].handlerId})}.bind(i,d.submenu,o,n)}})}const n={title:i._nls[d.handlerId?d.handlerId:d.identifier],type:d.type,handlerId:d.handlerId,icon:d.iconPath?e.getWebappsAssetUrl(d.module,d.iconPath):void 0,state:t.length>0?void 0:d.state,action:t.length>0?void 0:{this:i,callback:i.getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler.bind(i,{id:d.handlerId})}};t.length>0&&(n.submenu=t),a.push(n)}return a},s=function(e){i._x=e.clientX,i._y=e.clientY},r=function(e){return new Promise((t,n)=>{require([e],t,n)})},l=function(e){return new Promise((t,n)=>{r(`text!${e}`).then(t).catch(n)})},c=function(){return new Promise((e,t)=>{(function(e){return new Promise((t,n)=>{r(`i18n!${e}`).then(t).catch(n)})})(i._nlsAMDPath).then(t=>{i._nls=t,e()}).catch(t)})};this.getPickedPath=function(e){return i._view.get3DViewer().pick({xPix:e.XmousePositionWithDevPxRatio,yPix:e.YmousePositionWithDevPxRatio},"mesh",!0).path},this.setContextBarVisibility=function(e){var t=this._wafrContextContainer.getContextualBar();e?(this._isContextBarVisible=!0,t.show()):(this._isContextBarVisible=!1,t.hide())},this.canBeParallelized=function(){return!1},this.initialize=function(){return i._view=i.getExecutionContext().getComponent(i._identifiers.view),i._widget=i.getExecutionContext().getComponent(i._identifiers.widget),new Promise(async e=>{o||(await function(){const e=[];return new Promise((t,n)=>{for(let t=0;t<i._contextConfigPath.length;++t)e.push(new Promise(e=>{l(i._contextConfigPath[t]).then(t=>{try{i._contextConfig.push(JSON.parse(t)),e()}catch(e){i._DEBUG&&window.window.console.error("ENO3DContextMenuComponent._loadConfigurationFromFile failed to load configuration"+e),n(e)}}).catch(n)}));Promise.all(e).then(t).catch(n)})}(),await c(),await new Promise(e=>{for(let e=0;e<i._contextConfig.length;++e)for(let t=0;t<i._contextConfig[e].ContextMenu.onEmptiness.length;++t){const n=i._contextConfig[e].ContextMenu.onEmptiness[t];if(n.submenu)for(let e=0;e<n.submenu.length;++e)"ENO3DToggleStatusBarCmd"===n.submenu[e].identifier?n.submenu[e].state="true"===window.localStorage.getItem("ENO3DViewStatusBarExpandState")?"selected":void 0:n.submenu[e].identifier===window.localStorage.getItem("ENO3DViewViewerAmbience")&&(n.submenu[e].state="selected",i.getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler({id:n.submenu[e].identifier}))}e()}),await new Promise((e,t)=>{const n=i._view.getDOMElement("container");try{n.addEventListener("click",s),n.addEventListener("contextmenu",s),e()}catch(e){i._DEBUG&&window.window.console.error("ENO3DContextMenuComponent._listenContextEvent\n\t"+e),t(e)}}),await new Promise(e=>{var t=i.getExecutionContext().getComponent(WAfrStandardComponentKey.UIComponent);i._wafrContextContainer=t.getContextualUIComponentManager();for(let e=0;e<i._contextConfig.length;++e){const t={subscriberId:`ENO3DContextMenu-${e}`,merge:!0,onContextualMenuReady:function(e,t){return a(e,i.getPickedPath(t))}.bind(i,i._contextConfig[e])};i._wafrContextContainer.register(t)}e()}),o=!0),i.getExecutionContext().setContext("ContextReady",!0),e()})},this.clean=function(){return Promise.resolve()},this.destroy=function(){return new Promise(e=>{o=!1,e()})}}}}),define("DS/DMUBaseUIComponents/DMUCommonLandingPage",["DS/PADServices/views/LandingPage","DS/PADServices/utils/GlobalModelEvents","DS/DMUBaseExperience/DMUContextManager"],function(e,t,n){"use strict";return class{constructor(i){let o,a,s=null,r={widget:i.widgetIdentifier},l=null,c=null,d=null,u=null,m=!1,p=!1,f=this;this.params={widget:window.widget,readOnlyApp:!1,renderDiv:o,onLandingPageReady:function(){f._widget&&(f._widget.viewerAttachment(o),f._widget.viewerAttachment=null)}};const h=i.recentKeys,g=["ds6w:label","ds6w:type","ds6wg:revision","ds6w:status","owner","ds6w:responsible","ds6w:modified","ds6w:project","ds6w:identifier"];let w,v=[],C=[],D=[];function b(e){c&&e&&e.length&&(f.showWelcomePanel(!1),setTimeout(function(){c.addRootNodesFromContent({json3DXContent:{protocol:"3DXContent",version:"1.1",source:"X3DSEAR_AP",data:{items:e.map(function(e){return{envId:require("DS/PADUtils/PADUtilsServices").getPlatformId(),objectId:e.id,objectType:e.type,displayName:e.displayName}})}}})},500))}async function y(e){try{let t=require("DS/DMUReadPersistence/DMUWebServicesUtils"),n=await t.getParentTypes(e);return[e].concat(n)}catch{return[e]}}async function S(e){let t=!0;if(e.length>1)for(const n of e){let e=await y(n["ds6w:type"]);if(!e.includes("VPMReference")&&!e.includes("R2V_FeatureState")){t=!1;break}}t?b.call(this,e.map(function(e){return{id:e.resourceid,type:e["ds6w:type_value"],displayName:e["ds6w:label"]}})):u.dropMultiNoAutorized&&function(e,t,n){w&&(w.destroy(),w=null);try{let i=require("DS/DMUControls/EXPNotify");w=new i({body:n.getFrameWindow().getUIFrame(),type:e,message:t})}catch{return new Error("Cannot retrieve module")}}("warning",u.dropMultiNoAutorized,c)}function P(){var e=window.widget.getValue("xsceneStoredObjects");return e&&"string"==typeof e||(e='{"products":{},"filters":{}}'),JSON.parse(e)}function x(e){if(e&&e.length){t.publish({event:"ENXViews/LandingPage/addOrRefresh",data:{objects:e.map(function(e){return{resourceid:e,openWithFilter:!1,loading:!0,fromCustom:!0}})}});var i=setInterval(function(){s&&(clearInterval(i),setTimeout(function(){!function(e,t){require("DS/WAFData/WAFData").authenticatedRequest(require("DS/PADUtils/PADUtilsServices").get3DSpaceUrl()+"/cvservlet/fetch/v2?tenant="+require("DS/PADUtils/PADUtilsServices").getPlatformId(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx")},data:JSON.stringify({physicalid:e,label:"M3DFetchForWelcomePanel"+Date.now(),select_predicate:g,select_file:["icon","thumbnail_2d"]}),onComplete:t,onFailure:function(){},onTimeout:function(){}})}(e,function(e){if(s){var i=((e?JSON.parse(e):{}).results||[]).map(function(e){var t={},i=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),o=i.getRoots(c).map(function(e){return i.getNodeID(e)}),a=n.getReviewContext({context:c}),s=a?a.getReviewCtxInformation():{};s&&s.reviewId&&o.push(s.reviewId),c.getApplicativeData().getLoadedItfData&&c.getApplicativeData().getLoadedItfData().data.forEach(function(e){o=o.concat(e.metricID.length?e.metricID:[e.isrID])}),e.attributes.forEach(function(e){t[e.name]=e.value});var r=t["ds6w:type"],l={resourceid:t.resourceid,label:t["ds6w:label"],icons:[t.type_icon_url],thumbnail:t.preview_url,grid:t,subLabel:t["ds6w:responsible"]+" | "+new Date(t["ds6w:modified"]).toLocaleString(),description:t["ds6w:identifier"],openWithFilter:!1,fromCustom:!0,loading:void 0,opened:o.indexOf(t.resourceid)>-1,item2Load:{}};return l.item2Load[l.resourceid]={},"SIMItfSimulation"!==r&&"Markup"!==r&&"DMUMarkupRepReference"!==r&&"PLMPIMMetricReference"!==r&&"DIFAnnotationSet"!==r||(l.addRemoveFromViewCtx=!0),l});t.publish({event:"ENXViews/LandingPage/addOrRefresh",data:{objects:i}})}})},500))},100)}}function M(){return new Promise(e=>{var t=P(),i=Array.prototype.concat.apply([],h.map(function(e){return Object.keys(t[e.key]||[])}));x.call(f,i),C.push(c.subscribe({event:"onRootAdded"},function(e){var t=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),n=e.id,i=c.getController().getNode({id:n}),o=t.getNodeType(i);if("R2V_FeatureState"===o){var a=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),s=window.document.getElementsByClassName("DMULoadingPanel");a.length&&(a[0].dsModel.off(),a[0].dsModel.destroy(),a=null),s.length&&s[0].destroy()}if("DesignSight"===o||"DIFLayout"===o||"DIFSheet"===o||"Document"===o||"Requirement"===o||"Requirement Specification"===o){"DesignSight"===o?window.widget.setValue("mkpSession",JSON.stringify({type:"msr",plmType:o,id:n})):window.widget.setValue("mkpSession",JSON.stringify({type:"Document"===o||"Requirement"===o||"Requirement Specification"===o?o:"2D",plmType:o,id:n}));var r=P();r[o="DIFLayout"===o?"difLayout":"DIFSheet"===o?"difSheet":"Requirement"===o?"req":"Requirement Specification"===o?"reqSpec":"DesignSight"===o?"msr":"doc"]||(r[o]={}),r[o][n]={},window.widget.setValue("xsceneStoredObjects",JSON.stringify(r)),f.showWelcomePanel(!1),x.call(f,[n])}})),C.push(c.subscribe({event:"onRootRemoved"},function(e){var t=P();["difLayout","difSheet","doc","req","reqSpec","msr"].some(function(n){return t[n]&&t[n][e.id]})&&(x.call(this,[e.id]),window.widget.deleteValue("mkpSession"))}.bind(f))),C.push(c.subscribe({event:"onBeginRootLoading"},function(){var e=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),t=window.document.getElementsByClassName("DMULoadingPanel");e.length&&(e[0].dsModel.off(),e[0].dsModel.destroy(),e=null),t.length&&t[0].destroy()}));var o=n.getEventsController({viewer:c.getViewer()});D.push(o.addEvent("onReviewCtxInformationChanged",function(e){var t=P();t.mkp||(t.mkp={}),t.mku||(t.mku={}),"Markup"===e.reviewType?t.mkp[e.reviewId]={}:"DMUMarkupRepReference"===e.reviewType&&(t.mku[e.reviewId]={}),window.widget.setValue("xsceneStoredObjects",JSON.stringify(t)),x.call(f,[e.reviewId])})),D.push(o.addEvent("onReviewRemoved",function(e){var t=P();(e&&t.mkp&&t.mkp[e.reviewId]||e&&t.mku&&t.mku[e.reviewId])&&x.call(f,[e.reviewId]),window.widget.deleteValue("reviewIdInSession")})),e()})}v.push(t.subscribe({event:"ENXViews/LandingPage/refreshCustom"},x.bind(this))),v.push(t.subscribe({event:"ENXViews/LandingPage/openCustom"},function(e){var t=P(),n=[];e.customitem2open.forEach(function(e){h.some(function(i){if(t[i.key]&&t[i.key][e])return n.push({id:e,type:i.type}),!0})}),b.call(this,n)}.bind(this))),v.push(t.subscribe({event:"ENXViews/LandingPage/removeFromView"},function(e){if(e&&e.customitem2remove&&e.customitem2remove.length)if(l.getSourceApp().options.id.includes("I3D")||l.getSourceApp().options.id.includes("I3S")){var t=require("DS/PIMwebViewController/PIMwebItfCtrl").getItfCtrl({pad3DViewer:l.getComponent("Viewer")}),i=t.getLoadedData(),o=[];e.customitem2remove.forEach(function(e){i[e]&&-1===o.indexOf(e)?o.push(e):Object.keys(i).forEach(function(t){i[t].indexOf(e)>-1&&-1===o.indexOf(t)&&o.push(t)})}),o.forEach(t.removeIsr,t)}else{var a=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),s=a.getRoots(c).map(function(e){return a.getNodeID(e)}),r=n.getReviewContext({context:c}),d=r?r.getReviewCtxInformation():{},u=d?d.reviewId:null,m=[];c.getApplicativeData().getLoadedItfData&&(m=c.getApplicativeData().getLoadedItfData().data),c.getApplicativeData().removeDIFAnnotSetKeepPrd&&e.customitem2remove.forEach(e=>{c.getApplicativeData().removeDIFAnnotSetKeepPrd(e)}),e.customitem2remove.indexOf(u)>-1&&n.removeReviewContext({context:c}),m.forEach(function(t){(t.metricID.length?t.metricID:[t.isrID]).some(function(n){if(e.customitem2remove.indexOf(n)>-1)return c.getApplicativeData().removeIsrKeepContext(t.isrID),!0},this)},this),s.forEach(function(t){e.customitem2remove.indexOf(t)>-1&&c.removeRoots({pids:[t]})},this)}}.bind(this))),v.push(t.subscribe({event:"ENXViews/LandingPage/removeFromStore"},function(e){var n;if(e&&e.customitem2remove&&e.customitem2remove.length)if(l.getSourceApp().options.id.includes("I3D")||l.getSourceApp().options.id.includes("I3S")){n=this.params.widget.getValue("xsceneStoredObjects");let i=[];n=n?JSON.parse(n):{},e.customitem2remove.forEach(function(e){n.isr&&n.isr[e]&&-1===i.indexOf(e)?(i.push(e),delete n.isr[e]):n.itf&&n.itf[e]&&-1===i.indexOf(n.itf[e])&&(i.push(n.itf[e]),delete n.itf[e])}),this.params.widget.setValue("xsceneStoredObjects",JSON.stringify(n)),t.publish({event:"ENXViews/LandingPage/removeFromView",data:{customitem2remove:i}})}else{n=P();let i=[];e.customitem2remove.forEach(function(e){h.some(function(t){if(n[t.key]&&n[t.key][e]&&-1===i.indexOf(e))return i.push(e),delete n[t.key][e],!0})}),this.params.widget.setValue("xsceneStoredObjects",JSON.stringify(n)),t.publish({event:"ENXViews/LandingPage/removeFromView",data:{customitem2remove:i}})}}.bind(this))),v.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelMkp"},function(){u.mkp&&e.launchSearch({title:u.mkp,precondition:'flattenedtaxonomies:"types/Markup"OR flattenedtaxonomies:"types/DMUMarkupRepReference"',showApplyButton:!1,ok:S.bind(this)})}.bind(this))),v.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelIsr"},function(){u.isr&&e.launchSearch({title:u.isr,precondition:'flattenedtaxonomies:"types/SIMItfSimulation"',showApplyButton:!1,ok:S.bind(this)})}.bind(this))),v.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelItf"},function(){u.itf&&e.launchSearch({title:u.itf,precondition:'flattenedtaxonomies:"types/PLMPIMMetricReference"',showApplyButton:!1,ok:S.bind(this)})}.bind(this))),v.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDrw"},function(){u.drw&&e.launchSearch({title:u.drw,precondition:'flattenedtaxonomies:"types/Drawing"',showApplyButton:!1,ok:S.bind(this)})}.bind(this))),v.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDIFLayout"},function(){u.difLayout&&e.launchSearch({title:u.difLayout,precondition:'flattenedtaxonomies:"types/DIFLayout"',showApplyButton:!1,ok:S.bind(this)})}.bind(this))),v.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDIFSheet"},function(){u.difSheet&&e.launchSearch({title:u.difSheet,precondition:'flattenedtaxonomies:"types/DIFSheet"',showApplyButton:!1,ok:S.bind(this)})}.bind(this))),v.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDIFAnnotationSet"},function(){u.difAnnotSet&&e.launchSearch({title:u.difAnnotSet,precondition:'flattenedtaxonomies:"types/DIFAnnotationSet"',showApplyButton:!1,ok:S.bind(this)})}.bind(this))),v.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDocument"},function(){u.doc&&e.launchSearch({title:u.doc,precondition:'flattenedtaxonomies:"types/Document"',showApplyButton:!1,ok:S.bind(this)})}.bind(this))),v.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelRequirement"},function(){u.req&&e.launchSearch({title:u.req,precondition:'flattenedtaxonomies:"types/Requirement"',showApplyButton:!1,ok:S.bind(this)})}.bind(this))),v.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelRequirementSpec"},function(){u.reqSpec&&e.launchSearch({title:u.reqSpec,precondition:'flattenedtaxonomies:"types/Requirement Specification"',showApplyButton:!1,ok:S.bind(this)})}.bind(this))),v.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelMsr"},function(){u.msr&&e.launchSearch({title:u.msr,precondition:'flattenedtaxonomies:"types/DesignSight"',showApplyButton:!1,ok:S.bind(this)})}.bind(this))),v.push(t.subscribe({event:"ENXViews/WelcomePanel/action/welcomPanelPrefCmd"},function(){require(["DS/CATWebUXComponents/DMUCommandsManager","DS/CATWebUXPreferences/CATWebUXPreferencesManager"],function(e,t){let n=t.givePreferenceManager({context:this.pad3DViewer.getFrameWindow()});if(n)var i=n.subscribe("onPreferencesPanelDestroyed",function(){n.unsubscribe(i),this.showWelcomePanel(!0)}.bind(this));this.showWelcomePanel(!1),e&&e.getCommand("CATWebUXPreferencesHdr",this.pad3DViewer&&this.pad3DViewer.getCommandContext?this.pad3DViewer.getCommandContext():null).begin()}.bind(this))}.bind(this))),i.nls&&require(["i18n!"+i.nls],function(t){t&&(u=t,d=e.getDefaultActivities(),u.mkp&&d.activities[0].section.actions.splice(2,0,{id:"welcomePanelMkp",title:u.mkp,icon:"app-3dmarkup"}),u.difAnnotSet&&d.activities[0].section.actions.splice(5,0,{id:"welcomePanelDIFAnnotationSet",title:u.difAnnotSet,icon:"annotation"}),u.isr&&d.activities[0].section.actions.splice(i.nls.includes("I3D")?2:6,0,{id:"welcomePanelIsr",title:u.isr,icon:"interference-simulation"}),u.itf&&d.activities[0].section.actions.splice(i.nls.includes("I3D")?3:7,0,{id:"welcomePanelItf",title:u.itf,icon:"interference-metric"}),u.msr&&d.activities[0].section.actions.splice(8,0,{id:"welcomePanelMsr",title:u.msr,icon:"physics-simulation"}),u.drw&&d.activities[0].section.actions.splice(9,0,{id:"welcomePanelDrw",title:u.drw,icon:"drawing"}),u.reqSpec&&d.activities[0].section.actions.splice(10,0,{id:"welcomePanelRequirementSpec",title:u.reqSpec,icon:"requirement-specification"}),u.req&&d.activities[0].section.actions.splice(11,0,{id:"welcomePanelRequirement",title:u.req,icon:"requirement"}),u.difLayout&&d.activities[0].section.actions.splice(12,0,{id:"welcomePanelDIFLayout",title:u.difLayout,icon:"fl-diagrams"}),u.difSheet&&d.activities[0].section.actions.splice(13,0,{id:"welcomePanelDIFSheet",title:u.difSheet,icon:"fl-diagram"}),u.doc&&d.activities[0].section.actions.splice(14,0,{id:"welcomePanelDocument",title:u.doc,icon:"doc"}),u.customApp&&u.prefs&&d.activities.push({section:{id:"customizeAppSection",title:u.customApp,actions:[{id:"welcomPanelPrefCmd",title:u.prefs,icon:"cog"}]}}),f.params.widget.setValue("showWelcomePanel",!0))}),this.getWidgetComponent=function(){return this.getExecutionContext().getComponent(r.widget)},this.getWidget=function(){return this.getWidgetComponent().getSessionWidget()},this.createLandingPage=function(){return o=this.params.renderDiv=document.querySelector(".wafr-uiframe.wux-afr-framewindow"),(s=new e({widget:window.widget,appReady:!1,readOnlyApp:!1,renderDiv:this.params.renderDiv,externalViewerMgt:!0,externalViewerMgtCB:function(e,t){!0!==t&&this.showWelcomePanel("viewer"!==e)}.bind(this),globalSearchPrecond:require("DS/PADUtils/PADSettingsMgt").getSetting("landingPage_defaultSearchPrecondition"),defaultActionId:d?d.defaultActionId:void 0,activities:d?d.activities:void 0,onLandingPageReady:this.params.onLandingPageReady})).initialize()},this.getLandingPage=function(){return s},this.initialize=function(e){return l=e||this.getExecutionContext(),c=l.getComponent("Viewer"),f=this,new Promise((e,t)=>{s||f.createLandingPage().then(()=>{M().then(function(){s.options.renderDiv||(s.options.renderDiv=document.querySelector(".wafr-uiframe.wux-afr-framewindow")),p=!0,e()}).catch(e=>{i.DEBUG&&window.console.error("ENO3DLandingPageComponent.initialize\n\tFatal error during initialization",e),t(e)})}),M().then(function(){s.options.renderDiv||(s.options.renderDiv=document.querySelector(".wafr-uiframe.wux-afr-framewindow")),p=!0,e()}).catch(e=>{i.DEBUG&&window.console.error("ENO3DLandingPageComponent.initialize\n\tFatal error during initialization",e),t(e)})})},this.setViewer=function(e){c||(c=e),this.showWelcomePanel(!1)},this.appReady=function(e){if(this.isAppReady=!0,a=this.params.widget.getValue("X3DContentId"),p){let s=this.params.widget.id.indexOf("preview")>-1;if(a&&e)e.appInitFromTransition({x3dContent:JSON.parse(a),onNoActionDone:function(){f.showWelcomePanel(!1),c.addRootNodesFromContent({json3DXContent:JSON.parse(a),dispatch:!1})}});else if(!0===this.params.widget.getValue("autoreload")||!0===this.params.widget.getValue("autoreloadPreviewApp")&&!s){var t=this.params.widget.getValue("reviewIdInSession");if(t)b.call(this,[{id:JSON.parse(t).reviewID,type:JSON.parse(t).reviewType}]);else{var n=this.params.widget.getValue("mkpSession");if((n=n?JSON.parse(n):null)&&"ITF"===n.type||e){var i=this.params.widget.getValue("ItfSimuInSession");if((i=i?JSON.parse(i):null)&&!Array.isArray(i)&&"object"==typeof i){var o=Object.keys(i);if(1===o.length){var r={},d=o[0];e?(Array.isArray(i[d])&&i[d].length?r.metricID=i[d]:r.isrID=d,this.showWelcomePanel(!1),e.load(r)):Array.isArray(i[d])&&i[d].length?b.call(this,i[d].map(function(e){return{id:e,type:"PLMPIMMetricReference"}})):b.call(this,[{id:d,type:"SIMItfSimulation"}])}}}else n&&n.id&&("2D"===n.type||"Document"===n.type||"msr"===n.type)&&b.call(this,[{id:n.id,type:n.plmType}])}}s?this.params.widget.setValue("autoreloadPreviewApp",!0):this.params.widget.deleteValue("autoreloadPreviewApp")}return m||(l.getComponent("Viewer")._appReady(),m=!0),s.appReady()},this.clean=function(){return f.showWelcomePanel(!1),Promise.resolve()},this.destroy=function(){if(s){var e=n.getEventsController({viewer:c.getViewer()});D.forEach(e.removeEvent,e),D=[],C.forEach(c.unsubscribe,c),C=[],c=null,v.forEach(t.unsubscribe,t),v.length=0}return s.dispose(),s=null,a=void 0,m=!1,p=!1,d=null,Promise.resolve()},this.showWelcomePanel=function(e){let t=document.querySelector(".landing-welcome");t&&!e&&t.classList.add("landing-hidden"),e&&s.redraw()},this.canBeParallelized=function(){return!1}}}}),define("DS/DMUBaseUIComponents/DMUComment",["require","exports","DS/VisuEvents/EventsManager","UWA/Core","DS/Controls/Popup","DS/Utilities/TouchUtils","DS/Menu/ContextualMenu","DS/DMUBaseUIComponents/DMURichTextServices","i18n!DS/DMUBaseUIComponents/assets/nls/DMUBaseUIComponents","css!DS/DMUBaseUIComponents/DMUBaseUIComponents.css"],function(e,t,n,i,o,a,s,r,l){"use strict";return class{constructor(e){let t=this;const c="#77797C";let d,u,m,p,f,h,g,w,v,C,D,b,y,S,P=e.commentData,x=e.displayMode||"normal",M=!0,E=i.createElement("div",{class:"DMUCommentMainDiv"+(P.markedAsDeleted?" DMUCommentDeleted":"")+(P.isExternal?" DMUExternalComment":"")}),I={},A=!1;function k(t){let n=t.from[0].view;if(n.classList.contains("DMUCommentCtxMenu"))return;let i=t.from[0].event.composedPath(),o=!n.classList.contains("DMUCommentReplyButton")&&(n===E||i&&i.find(e=>e.classList.contains("DMUCommentMainDiv"))===E);e.onClickCB&&E&&e.onClickCB({target:P,event:t,selected:o,div:E,isEnableEdition:Boolean(o&&n.getTagName&&"p"===n.getTagName()&&!P.isReadOnly())})}function U(t){var n;if(M){const i="data"in t?t.data.event:t.from[0].event;let o=i.composedPath();!(null===(n=i.target)||void 0===n?void 0:n.isContentEditable)&&(i.target===E||o&&o.find(e=>e.classList.contains("DMUCommentMainDiv"))===E)&&e.onCtxMenuCB&&e.onCtxMenuCB({target:P,event:i})}}function R(t){e.onReplyCB&&e.onReplyCB({target:P,event:t,allowReplies:Boolean(e.allowReplies)})}function N(){if(!u)return;const e=`${P.owner.name}${P.date?" - "+P.date:""}${P.markupName?"\n"+P.markupName:""}`;u.setAttribute("title",e)}function B(){if(!E||!p||!f)return;if(P.owner){if(P.owner.color||P.isExternal){let e=P.isExternal?c:P.owner.color;u&&u.getStyle("color").replace(/\s/g,"")!==e&&u.setStyle("color",e||"")}P.owner.name&&p.getText()!==P.owner.name&&(N(),p.setText(P.owner.name)),P.owner.imageUrl&&"normal"===x&&(d?d.src!==P.owner.imageUrl&&(d.src=P.owner.imageUrl):d=i.createElement("img",{src:P.owner.imageUrl,events:{load:function(){d&&m&&u&&u.firstChild&&u.firstChild===m&&(u.removeChild(m),u.appendChild(d))},error:function(){m&&d&&u&&u.firstChild&&u.firstChild===d&&(u.removeChild(d),u.appendChild(m))}}}))}P.date&&f.getText()!==P.date&&(N(),f.setText(P.date)),S&&P.markupName&&P.markupName!==S.getText()&&S.setText(P.markupName);let t=!P.isReadOnly()&&!P.hasAlertFlag()&&!P.disableEdition;g&&(g&&g.setReadOnly(!t),g.setData(P.content)),P.isReadOnly()||P.hasAlertFlag()&&!E.hasClassName("readOnly")?(E.addClassName("readOnly"),C&&C.setStyle("display",P.hasAlertFlag()?"block":"none")):P.isReadOnly()||P.hasAlertFlag()||!E.hasClassName("readOnly")||(E.removeClassName("readOnly"),C&&C.setStyle("display","none"));const n=e.allowReplies&&!P.isReadOnly()&&!P.hasAlertFlag()&&P.allowReply;w&&w.setStyle("display",n&&!A?"":"none")}function O(){if(P.isReply&&e.allowReplies&&E.addClassName("reply"),(P.isReadOnly()||P.hasAlertFlag())&&E.addClassName("readOnly"),"normal"===x){u=i.createElement("div",{class:"DMUCommentPictureDiv"}).inject(E),m=i.createElement("i",{class:"wux-ui-3ds wux-ui-3ds-user"}).inject(u),P.isReply&&e.allowReplies||(h=i.createElement("div",{class:"DMUCommentRepliesCount"}).inject(E));let t=i.createElement("div",{class:"DMUCommentHeader"}).inject(E),s=i.createElement("div",{class:"DMUCommentHeaderInformation"}).inject(t),c=i.createElement("div",{class:"DMUCommentUserInformation"}).inject(s);if(p=i.createElement("div",{class:"DMUCommentOwner"}).inject(c),f=i.createElement("div",{class:"DMUCommentDate"}).inject(c),b=i.createElement("div",{class:"DMUCommentInformationIconDiv"}).inject(t),P.markedAsDeleted&&i.createElement("i",{class:"wux-ui-3ds-comment-delete wux-ui-3ds",title:l.commentDeleted}).inject(b),P.markupName&&!P.isReply&&(S=i.createElement("div",{class:"DMUCommentHeaderSubInformation",text:P.markupName}).inject(s)),(g=r.createRichTextElement({className:"DMUCommentContent",allowMentions:e.allowReplies}).inject(E)).addEventListener("onChange",function(t){P.disableEdition||!e.onEditionEndCB||P.isReadOnly()||P.hasAlertFlag()||e.onEditionEndCB({target:P,value:t})}),g.addEventListener("onNewMentions",function(t){P.disableEdition||e.onNewMentionsCB&&e.onNewMentionsCB({target:P,mentions:t})}),g.addEventListener("onCheckSelected",function(t){e.onCheckSelectedCB&&e.onCheckSelectedCB({target:P,check:t})}),!P.isReadOnly()&&!P.hasAlertFlag()){let t=e.allowReplies?"reply":"plus",s=e.allowReplies?l.replyButtonLabel:l.addButtonLabel;w=i.createElement("div",{class:"DMUCommentReplyButton wux-ui-3ds wux-ui-3ds-"+t}).inject(E),a.getTouchMode()&&w.addClassName("touchMode"),new o({target:w,trigger:"hover",offset:{x:e.allowReplies?-10:-35,y:10},position:"bottom",arrowBoxFlag:!0}).setBody(s),e.onReplyCB&&n.addEvent(w,"onPrimaryPointerClick",R)}C=i.createElement("div",{class:"DMUCommentAlert wux-ui-3ds wux-ui-3ds-attention ",styles:{display:P.hasAlertFlag()?"block":"none"}}).inject(E),new o({target:C,trigger:"hover",position:"left",offset:{x:-10,y:-20}}).setBody(l.pointedPageRemoved)}else if("light"===x){E.hasClassName("DMUCommentMainDivLightMode")||E.addClassName("DMUCommentMainDivLightMode"),i.createElement("i",{class:"wux-ui-3ds wux-ui-3ds-comment"}).inject(E);let e=i.createElement("div",{class:"DMUCommentHeader"}).inject(E);p=i.createElement("div",{class:"DMUCommentOwner"}).inject(e),f=i.createElement("div",{class:"DMUCommentDate"}).inject(e)}e.onClickCB&&n.addEvent(E,"onPrimaryPointerClick",k),e.onCtxMenuCB&&!D&&(v=i.createElement("div",{class:"DMUCommentCtxMenu wux-ui-3ds wux-ui-3ds-chevron-down"}).inject(E),n.addEvent(v,"onPrimaryPointerClick",U),D=s.addEventListener(E,{callback:U})),e.onEnterCB&&E.addEventListener("mouseenter",function(){E&&!E.hasClassName("hover")&&E.addClassName("hover"),e.onEnterCB&&e.onEnterCB({target:P,prehighlightedFlag:!0})}),e.onLeaveCB&&E.addEventListener("mouseleave",function(){E&&E.hasClassName("hover")&&E.removeClassName("hover"),e.onLeaveCB&&e.onLeaveCB({target:P,prehighlightedFlag:!1})}),B()}e.allowReplies&&!P.isReply&&E.style.setProperty("--last-reply-height","95px"),this.getCommentDiv=function(){return E},this.update=function(e){if(!e)return;let t=Object.keys(e);for(let n=0;n<t.length;n++)P[t[n]]!==e[t[n]]&&(P[t[n]]=e[t[n]]);B()},this.updateDisplayMode=(t=>{t!==x&&(x=t,e.onClickCB&&n.removeEvent(E,"onPrimaryPointerClick",k),e.onReplyCB&&w&&n.removeEvent(w,"onPrimaryPointerClick",R),e.onCtxMenuCB&&D&&(n.removeEvent(v,"onPrimaryPointerClick",U),s.removeEventListener(E,D),D=null),u&&u.firstChild&&u.firstChild.removeEvents(),g&&g.destroy(),E&&(E.removeEvents(),E.remove()),O())}),this.setCtxMenuAvailability=function(e){M!==e&&(M=e,B())},this.addInformationIcon=(({id:e,fontIcon:t,color:o,onClick:a})=>{b&&(I[e]?(I[e].iconDiv.setStyle("color",o||"rgb(119, 121, 124)"),I[e].iconDiv.className="DMUInformationIcon wux-ui-3ds "+t+(a?" DMUInformationIconHoverable":""),I[e].onClickToken&&(n.removeEventFromToken(I[e].onClickToken),I[e].onClickToken=void 0),a&&(I[e].onClickToken=n.addEvent(I[e].iconDiv,"onPrimaryPointerClick",()=>a()))):(I[e]={iconDiv:i.createElement("i",{class:"DMUInformationIcon wux-ui-3ds "+t+(a?" DMUInformationIconHoverable":""),styles:{color:o||"rgb(119, 121, 124)"}})},a&&(I[e].onClickToken=n.addEvent(I[e].iconDiv,"onPrimaryPointerClick",()=>a())),b.appendChild(I[e].iconDiv)))}),this.hideReplyButton=(e=>{A=e,w&&w.setStyle("display",e?"none":"")}),this.removeInformationIcon=(e=>{b&&I[e]&&(I[e].onClickToken&&n.removeEventFromToken(I[e].onClickToken),b.removeChild(I[e].iconDiv),delete I[e])}),this.updateDate=function(e){e&&f&&f.getText()!==e&&(N(),f.setText(e))},this.enableContentEdition=function(){setTimeout(function(){g&&g.focus()})},this.setInEdition=function(e){E&&(e?E.hasClassName("selected")||E.addClassName("selected"):E.hasClassName("selected")&&E.removeClassName("selected"))},this.updateRepliesCount=function(e){h&&(0===e?h.setStyle("visibility","hidden"):h.setStyle("visibility","visible"),h.setText("("+e+")")),t.updateTimelineLength()},this.setDisplayFlag=function(e,t){E&&(e?E.setStyles({"padding-left":"5px","border-left":"5px solid "+(t?"#57B847":"#368EC4")}):E.setStyles({"padding-left":"","border-left":""}))},this.setVisibleFlag=function(e){E&&(e?E.setStyle("display",""):E.setStyle("display","none"))},this.setHovered=function(e){E&&(e?E.hasClassName("hover")||E.addClassName("hover"):E.hasClassName("hover")&&E.removeClassName("hover"))},this.updateTimelineLength=function(){if(!E||P.isReply||!e.allowReplies)return;const t=E.lastChild,n=t&&t.getSize().height;n&&E.style.setProperty("--last-reply-height",n+"px")},this.setLoadingFlag=function(e){t.hideReplyButton(e),e?y=i.createElement("i",{class:"DMUCommentLoadingIcon"}).inject(E):y&&(y.remove(),y=null)},this.remove=function(){e.onClickCB&&n.removeEvent(E,"onPrimaryPointerClick",k),e.onReplyCB&&w&&n.removeEvent(w,"onPrimaryPointerClick",R),e.onCtxMenuCB&&D&&(n.removeEvent(v,"onPrimaryPointerClick",U),s.removeEventListener(E,D),D=null),I&&Object.keys(I).forEach(e=>t.removeInformationIcon(e)),u&&u.firstChild&&u.firstChild.removeEvents(),g&&g.destroy(),E&&(E.removeEvents(),E.remove(),E.destroy()),y=S=h=g=f=p=u=w=b=m=C=d=v=null},O()}}});