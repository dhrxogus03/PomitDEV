/*!  Copyright 2021 Dassault Systemes. All rights reserved. */
define("DS/DMUwebR3Mux/DMUwebR3Mlist",["UWA/Core","UWA/Class","DS/Utilities/Dom","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/Controls/TooltipModel","DS/Controls/ProgressBar","DS/CollectionView/CollectionViewStatusBar","DS/Windows/Dialog","DS/Controls/Button","i18n!DS/DMUwebR3Mux/assets/nls/DMUwebR3Mux.json","css!DS/DMUwebR3Mux/assets/css/DMUwebR3Mux"],function(e,t,n,i,a,o,r,s,l,d,c,u){"use strict";let p=window.WUXManagedFontIcons.Font3DS;var f,g,m,h,y=function(e,t,n,i){return f=n.options.grid.analysisStateNbKO,g=i.options.grid.analysisStateNbKO,m=n.options.grid.analysisStateDisp,h=i.options.grid.analysisStateDisp,m===h?f===g?0:f<g?-1:1:m<h?-1:1};return t.extend({init:function(t){let f,g,m,h={},v={},w=t.onSelect,S=t.onUnselect,b=t.onFiltersModified,I=t.onInfo,M=t.cbDnD,C=t.columns,D=t.parent,x=t.getFilterValues,P=t.getIsrTypes,_=t.onRelations,E=t.allowRelations,R=t.allowCopyLink,O=t.onCopyLink,j=t.allowUpdateSimulation,k=t.getCSIcomputeToken,F=t.onIssueCells,A=t.onMaturityState,V=t.onAnalysisState,T=t.onMetricIssue,U=t.getFeatureStateInfo,N=t.allowMaturityState,L=t.onValidationState,W=t.allowValidationState,B=t.onUpdateSimulation,q={show:!1,total:[],completed:[],failed:[]},X=["private","inwork","frozen","released","obsolete","default","exists","inprogress","failed","passed","donenoko","startedwithko","startednoko","donewithko","notcomputed","create","assign","active","review","closed"],z=[{type:l.STATUS.NB_ITEMS},{position:"far",type:l.STATUS.NB_SELECTED_ROWS}];function J(e){return{id:e.options.grid.id,parents:e.getParents().map(function(e){return e.options.grid.id})}}function K(t,n){let i=e.createElement("div",{class:"r3mtweaker "+n});return i.value=t,i.getStringFromValue=function(e){return e||""},i.computeContentSize=function(){let e=15;for(let t=i.childNodes.length-1;t>=0;--t)e+=i.childNodes[t].getDimensions().width;return e},i}function Q(e){if(g)return e&&e.nodeModel&&e.cellView?g.getCellDefaultTooltip(e,-1!==(e.nodeModel.options.grid.description||"").search("\n")):g.getCellDefaultTooltip(e)}function G(e){if(!g)return;if(!e||!e.nodeModel||!e.cellView)return g.getCellDefaultTooltip(e);let t=g.getCellDefaultTooltip(e);return{getAllInformationCB:function(){return e.nodeModel.options.grid.validStateWarning?{model:{shortHelp:e.nodeModel.options.grid.validStateWarning},updateModel:!1}:t.getAllInformationCB()}}}function H(e,t,n,i,a,o,l,d){let c;if(n){let a,o=X.indexOf(t)>-1,r=0;if("r3mCellAnalysisState_itfQueryRunning"===t?(a="r3mCellAnalysisState_itfQueryRunning",r=e&&e.nodeModel&&e.nodeModel.options.grid?e.nodeModel.options.grid.analysisStateProgress:0):a="r3mR2VCellState_itfQueryRunning"===t?"r3mR2VCellState_itfQueryRunning":"r3mCellState_"+t+i+(o?"":"_NoColor"),g._reusableCellContentManager.isRegistered(a)||g.registerReusableCellContent({id:a,buildContent:l.bind(null,n,i,o,t,d)}),r>0&&"r3mCellAnalysisState_itfQueryRunning"===t){let e=K("","r3mstatus");new s({value:r}).inject(e),c=e}else c=g.reuseCellContent(a)}e.cellView._setReusableContent(c),e.cellView.tooltipInfos=new r(o?G(e):g.getCellDefaultTooltip(e))}function Z(t,n,i,a,o){let r=K(t,"r3mstatus");return e.createElement("span",{html:t,class:i?"r3mstatuscolored r3m"+a:""}).inject(r),o&&(r.style.textAlign="start",r.style.paddingLeft="5px"),r}function Y(t){var n=e.createElement("div",{class:"spinner spinning",styles:{display:"flex","justify-content":"center",transform:"translate3d(0,0,0)"}}).inject(t);e.createElement("span",{class:"spinner-bar"}).inject(n),e.createElement("span",{class:"spinner-bar spinner-bar1"}).inject(n),e.createElement("span",{class:"spinner-bar spinner-bar2"}).inject(n),e.createElement("span",{class:"spinner-bar spinner-bar3"}).inject(n)}function $(t,n,i,a){let o=K(t,"r3mstatus");if("startedwithko"===a||"donewithko"===a){let r=e.createElement("span",{class:i?"r3mstatuscolored r3m"+a:""}).inject(o);e.createElement("span",{html:t+" "}).inject(r),e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-attention"}).inject(r),e.createElement("span",{html:" "+n}).inject(r)}else if("computed"===a){let i=e.createElement("span",{class:"r3mstatuscolored r3m"+a}).inject(o);e.createElement("span",{html:t+" "}).inject(i),e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-interference-metric"}).inject(i),e.createElement("span",{html:" "+n}).inject(i)}else if(a.contains("r3mCellAnalysisState_itfQueryRunning"))Y(o);else if("Running"===a){let n=e.createElement("span",{class:"r3mstatuscolored r3m"+a}).inject(o);e.createElement("span",{html:t+" "}).inject(n)}else e.createElement("span",{html:t,class:i?"r3mstatuscolored r3m"+a:""}).inject(o);return o}function ee(e){if(!(g&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid;t&&void 0===t.title&&"r2vsurvey"===t.serviceId?(g._reusableCellContentManager.isRegistered("r3mR2VCellState_itfQueryRunning")||g.registerReusableCellContent({id:"r3mR2VCellState_itfQueryRunning",buildContent:function(e){let t=K(e,"r3mR2V_Running");return Y(t),t}.bind(null,"r3mR2VCellState_itfQueryRunning")}),H(e,"r3mR2VCellState_itfQueryRunning","r3mR2VCellState_itfQueryRunning",0,t.id,!1,Z,!0),U({serviceId:t.serviceId,objectId:t.id,validatedObjId:e.nodeModel._parentNode._parentNode.options.grid.id,text:e.nodeModel._parentNode._options.grid.id})):H(e,t.title,t.title,0,t.id,!1,Z,!0)}function te(e){if(!(g&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid,n=(t.maturity||"").split(".");H(e,n=n[n.length-1].toLowerCase().replace("_",""),t.maturityDisp,0,t.id,!1,Z,!1)}function ne(e){if(!(g&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid;H(e,(t.validState||"").toLowerCase(),t.validStateDisp,0,t.id,!0,Z,!1)}function ie(e){if(!(g&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid,n=P();t.analysisState=t.analysisState?t.analysisState:"";let i="running"===t.analysisState||"unknown"===t.analysisState?"r3mCellAnalysisState_itfQueryRunning":t.analysisState;i=i||"",H(e,-1===n.indexOf(t.type)?"":i,t.analysisStateDisp,t.analysisStateNbKO,t.id,!0,$,!1),"unknown"===t.analysisState&&n.indexOf(t.type)>-1&&V([t.id])}function ae(t){if(!(g&&t&&t.nodeModel&&t.cellView))return;let n,i=t.nodeModel.options.grid,a=i.id,o=i.validStateWarning,s=(a&&v[a]&&i.validState||"").toLowerCase(),l=P(),d="r3mCellState_validstatewarning";if(!(l.indexOf(i.type)>-1)||g.layout.getColumnVisibleFlag("analysisStateDisp")){if(l.indexOf(i.type)>-1?d=d+(s="inprogress"===s||"failed"===s&&("computed"===i.analysisState||"notcomputed"===i.analysisState||"startednoko"===i.analysisState)?"minorWarning":"majorWarning")+i.analysisState:d+=s="inprogress"===s?"minorWarning":s,o)g._reusableCellContentManager.isRegistered(d)||g.registerReusableCellContent({id:d,buildContent:function(t,n){let i=K(t,"r3mwarning");var a,o;return(a="attention",o="minorWarning"===n?"r3miconcolor":"r3mwarningcolor",e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-"+a+" "+o})).inject(i),e.createElement("span",{html:t,class:"r3mwarningtext"}).inject(i),i}.bind(null,o,s)}),n=g.reuseCellContent(d);else if(!o&&l.indexOf(i.type)>-1&&"running"===i.analysisState){if(i.analysisStateProgress>0&&("running"===i.analysisState||"unknown"===i.analysisState))return;g._reusableCellContentManager.isRegistered("r3mCellState_itfQueryRunning")||g.registerReusableCellContent({id:"r3mCellState_itfQueryRunning",buildContent:function(e){let t=K(e,"r3mwarning");return Y(t),t}.bind(null,"r3mCellState_itfQueryRunning")}),n=g.reuseCellContent("r3mCellState_itfQueryRunning")}t.cellView._setReusableContent(n),t.cellView.tooltipInfos=new r(G(t))}}function oe(e){if(!g||!e||!e.nodeModel)return;let t=g.layout.getDataIndexFromColumnIndex(e.columnID);return Boolean(e.nodeModel.options.grid[t])}function re(e){let t=e.nodeModel.options.grid;if("Issue"===t.type)return t.r3mIssueAssignees=void 0!==t.r3mIssueAssignees?t.r3mIssueAssignees:"running",""===t.r3mIssueAssignees||"running"===t.r3mIssueAssignees||0===t.r3mIssueAssignees.length?t.r3mIssueAssignee:t.r3mIssueAssignees.map(function(e){return{label:e.label.trim(),url:""===e.url?void 0:e.url}})}function se(e){if(!g||!e||!e.nodeModel)return;let t=g.layout.getDataIndexFromColumnIndex(e.columnID),n=e.nodeModel.options.grid[t];return n?{url:e.nodeModel.options.grid[t+"Img"]?"":void 0,label:n}:void 0}function le(e){w(e.map(J))}function de(e){S(e.map(J))}function ce(){setTimeout(function(){g.reapplySortModel();var t=JSON.parse(localStorage.getItem("r3mGridFilters"));t&&t.filterModel&&!e.equals(t.filterModel,{})&&(f.setFilterModel({}),f.setFilterModel(t.filterModel))},10)}function ue(){var e=g.getNodesXSO().get();e&&0!==e.length&&g.ensureNodeModelVisible(e[0],!1)}function pe(t,n,i){let a=K(n,"");if(i.contains("r3mIssueState_Blank"))return a;if(i.contains("r3mCellIssue_QueryRunning"))Y(a);else if("r3mIssuePriority"===g.layout.getDataIndexFromColumnIndex(t.columnID)){let t="";"High"===n?t="high wux-ui-3ds wux-ui-3ds-level-high":"Low"===n?t="low wux-ui-3ds wux-ui-3ds-level-low":"Medium"===n?t="medium wux-ui-3ds wux-ui-3ds-level-medium":"Urgent"===n&&(t="urgent wux-ui-3ds wux-ui-3ds-alert"),e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-"+t+" r3mIssuePriority"+n}).inject(a),e.createElement("span",{html:"  "+n}).inject(a)}return a}function fe(e,t,n,i){let a,o;"r3mCellIssue_QueryRunning"===t?(o="r3mCellIssue_QueryRunning",e.cellView&&e.cellView.elements&&e.cellView.elements.KPIColorDiv&&e.cellView.elements.KPIColorDiv.hide()):o="r3mCellState_"+t+n,g._reusableCellContentManager.isRegistered(o)||g.registerReusableCellContent({id:o,buildContent:i.bind(null,e,n,t)}),a=g.reuseCellContent(o),e.cellView._setReusableContent(a),e.cellView.getContent().removeAttribute("no-tweaker")}function ge(e){var t=g.columns[e.columnID].dataIndex,n=[];(n=g.getTreeDocument().getSelectedNodes().filter(function(e){return!e.options.grid.isNonEditable})).length||n.push(e.nodeModel),f.withTransactionUpdate(function(){n.forEach(function(e){if(e.options.grid.hasOwnProperty(t)){var n={};n[t]=e.options.grid.r3mIssueApprovals,e.updateOptions({grid:n})}})})}function me(e){if(!e||-1===e.rowID||!e.nodeModel)return;let t=e.nodeModel.options.grid.r3mIssueApprovals;return void 0!==t&&"running"!==t&&""!==t?"independantBoolean":void 0}function he(e){if(!e||-1===e.rowID||!e.nodeModel)return;let t=e.nodeModel.options.grid.r3mIssueAssignees;return void 0!==t&&"running"!==t&&""!==t?"user":void 0}function ye(e,t){let n=void 0!==t?t:"running";if("running"!==n)return g.defaultOnCellRequest(e);fe(e,"running"===n?"r3mCellIssue_QueryRunning":n,n,pe)}function ve(e){if(!(g&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid;"Issue"!==t.type&&(t.r3mIssueApprovals=t.r3mIssueAssignees=t.r3mIssuePriority=t.r3mIssueResolvedBy="");var n=g.layout.getDataIndexFromColumnIndex(e.columnID);if("r3mIssueAssignees"===n)ye(e,t.r3mIssueAssignees);else if("r3mIssueApprovals"===n)ye(e,t.r3mIssueApprovals);else if("r3mIssueResolvedBy"===n)ye(e,t.r3mIssueResolvedBy);else if("r3mIssuePriority"===n){t.r3mIssuePriority=void 0!==t.r3mIssuePriority?t.r3mIssuePriority:"running",fe(e,"running"===t.r3mIssuePriority?"r3mCellIssue_QueryRunning":t.r3mIssuePriority,t.r3mIssuePriority,pe)}"running"===t.r3mIssueResolvedBy&&F([t.id])}function we(e){var t="";return"r3mIssueAssignees"===g.layout.getDataIndexFromColumnIndex(e.columnID)&&(t=e.cellModel.map(e=>e.label).toString()),t}this.deleteNodes=function(e,t){let n=h[e],i=h[t];n&&i&&(1===i.length?h[t]=void 0:h[t]=h[t].filter(function(e){return e.getParent()!==n[0]}),n[0].removeChildren())},this.updateValidations=function(e,t,n,i){f.withTransactionUpdate(function(){Object.keys(e).forEach(function(e){var t=n?function e(t,n){let i,a=this[n],o={label:a.title,grid:a},r=h[n];return a.icon&&(o.icons=[{iconPath:a.icon}]),t.search({match:function(e){e.nodeModel.options.grid.id===a.id&&(i=e.nodeModel)}}),r.forEach(t=>{t.updateOptions(o),Object.keys(a.children||{}).forEach(e.bind(a.children,t))}),i}.call(this,f,e):function e(t,n){let i,o=this[n],r={label:o.title,grid:o},s=h[n];o.icon&&(r.icons=[{iconPath:o.icon}]);let l=P();return-1===q.total.indexOf(o.id)&&l.indexOf(o.type)>-1&&q.total.push(o.id),(t.getChildren()||[]).some(e=>{if(e.options.grid.id===o.id)return i=e}),i||(i=new a(r),t.addChild(i),s?s.push(i):s=h[n]=[i]),o.noSort&&(i.sortChildren=function(e){e.isRecursive&&this.getChildren().forEach(function(t){t.sortChildren(e)})}),s.forEach(t=>{t.updateOptions(r),Object.keys(o.children||{}).forEach(e.bind(o.children,t))}),i}.call(this,f,e);v[e]||(v[e]=t),i&&t.expand()},e)}),t||ce()},this.updateStatusBar=function(e,t){"success"===t&&-1!==q.completed.indexOf(e)||"failure"===t&&-1!==q.failed.indexOf(e)||("success"===t&&-1===q.completed.indexOf(e)?q.completed.push(e):"failure"===t&&-1===q.failed.indexOf(e)&&q.failed.push(e),function(){let e=q.total.length;if(e>0){var t=e>0?(q.completed.length+q.failed.length)/e*100:100;if(e-(q.completed.length+q.failed.length)<=0&&(q.completed.length=q.failed.length=0,t=100),q.show){const e=z.findIndex(e=>"progressId"===e.id);-1===e&&100!==t?(z.push({type:l.STATUS.CUSTOM,id:"progressId",position:"center",dataElements:{typeRepresentation:"progress",value:t,tooltip:u.gridAnalysisFilterStatus}}),g.buildStatusBar(z)):-1!==e&&100===t?(z=z.filter(e=>"progressId"!==e.id),q.show=!1,g.buildStatusBar(z)):g.elements.statusBar.getNodeModelByID("progressId").updateOptions({grid:{data:t}})}}}())},this.checkFilterAndFetchValue=function(){if(!g||!f)return;let e=JSON.parse(localStorage.getItem("r3mGridFilters"));if(-1!==g.sortModel.findIndex(e=>"analysisStateDisp"===e.dataIndex||"validStateWarning"===e.dataIndex)||e&&e.filterModel&&(e.filterModel.hasOwnProperty("analysisStateDisp")||e.filterModel.hasOwnProperty("validStateWarning"))){let e=P();f.getAllDescendants().forEach(function(t){let n=t.options.grid;e.indexOf(n.type)>-1&&"unknown"===n.analysisState&&(q.show=!0,V([n.id],!1))})}},this.setInfoState=function(e){let t=g.getToolbar().array3[0].tweaker.elements.container,n=t.hasClassName("r3mInfoColor");n&&!e?t.removeClassName("r3mInfoColor"):!n&&e&&t.addClassName("r3mInfoColor")},this.expanReviewNode=function(e,t){setTimeout(function(){g.subscribeOnceToAllCellsRendered(function(){Object.keys(e).forEach(function(e){v[e]&&v[e].expandAll()},e);var n=[];t&&t.objects&&t.objects.forEach(function(e){g&&g.model&&g.model.forEach(function(t){t&&t.options&&t.options.grid&&t.options.grid.id&&t.options.grid.id===e.highlightId&&n.push(t)})}),f.withTransactionUpdate(function(){g.unselectAll(),g.setActiveCell(-1,!1,!1),n.forEach(function(e){g.selectNodeModel(e,!0,!1)}),g.ensureNodeModelVisible(n[0],!1,!0)})})},30)},this.getSelectedRows=function(){return g.getNodesXSO().get().map(J)},this.onTenantModified=function(e){let t={tree:"title",name:"name",typeDisp:"type",maturityDisp:"maturity",validStateDisp:"validState",description:"description",owner:"owner",originator:"originator",organization:"organization",dateModif:"dateModif",dateCreat:"dateCreat",collabSpace:"collabSpace"};m.forEach(n=>{n.text=e[t[n.dataIndex]?t[n.dataIndex]:n.dataIndex]})},this.removeValidation=function(e){f.withTransactionUpdate(function(){e.forEach(function(e){v[e]&&f.removeRoot(v[e]);let t=h[e]&&h[e].indexOf(v[e]);t>-1&&h[e].splice(t,1),!h[e].length&&delete h[e],delete v[e]}),ce()})},this.removeAll=function(){g.getNodesXSO().empty(),f.empty(),h={},v={}},function(){function t(e,t){var n=e.getSize(),i=t.getSize(),a=(i.width-n.width)/2,o=(i.height-n.height)/2;e.setStyles({left:a<0?0:a,top:o<0?0:o})}function a(){let e=this.showCustomViewsDialog();function i(){Object.keys(e.buttons).forEach(function(t){e.buttons[t].removeEventListener("click",a)}),e.removeEventListener("close",i),n.removeResizeListener(D)}t(e.elements.container,D),Object.keys(e.buttons).forEach(function(t){e.buttons[t].addEventListener("click",i)}),e.addEventListener("close",i),n.addResizeListener(D,function(){t(e.elements.container,D)})}m=[{dataIndex:"tree",text:C.title,onCellRequest:ee,groupableFlag:!1},{dataIndex:"name",text:C.name,width:150,visibleFlag:!1,groupableFlag:!1},{dataIndex:"typeDisp",text:C.type,width:150,visibleFlag:!1,groupableFlag:!1,alignment:"center"},{dataIndex:"maturityDisp",text:C.maturity,onCellRequest:te,width:90,groupableFlag:!1},{dataIndex:"validStateDisp",text:C.validState,onCellRequest:ne,width:100,groupableFlag:!1},{dataIndex:"validStateWarning",icon:{iconName:"attention",fontIconFamily:p},onCellRequest:ae,width:60,minWidth:30,groupableFlag:!1},{dataIndex:"analysisStateDisp",text:C.analysisState,onCellRequest:ie,width:150,compareFunction:y,visibleFlag:!1,groupableFlag:!1},{dataIndex:"description",text:C.description,getCellTooltip:Q,width:300,groupableFlag:!1},{dataIndex:"owner",text:C.owner,typeRepresentation:"user",hasCellValue:oe,getCellValue:se,width:150,groupableFlag:!1},{dataIndex:"originator",text:C.originator,typeRepresentation:"user",hasCellValue:oe,getCellValue:se,width:150,visibleFlag:!1,groupableFlag:!1},{dataIndex:"organization",text:C.organization,width:100,visibleFlag:!1,groupableFlag:!1},{dataIndex:"dateModif",text:C.dateModif,typeRepresentation:"datetime",width:150,groupableFlag:!1},{dataIndex:"dateCreat",text:C.dateCreat,typeRepresentation:"datetime",width:150,visibleFlag:!1,groupableFlag:!1},{dataIndex:"collabSpace",text:C.collabSpace,visibleFlag:!1,groupableFlag:!1},{dataIndex:"r3mIssueName",text:C.r3mIssueName,editableFlag:!1,visibleFlag:!1,width:"auto"},{dataIndex:"r3mIssuePriority",text:C.r3mIssuePriority,onCellRequest:ve,typeRepresentation:"url",editableFlag:!1,visibleFlag:!0,width:"auto"},{dataIndex:"r3mIssueApprovals",text:C.r3mIssueApprovals,editionPolicy:"EditionInPlace",setCellValue:ge,getCellTypeRepresentation:me,onCellRequest:ve,editableFlag:!0,visibleFlag:!1},{dataIndex:"r3mIssueAssignees",text:C.r3mIssueAssignees,getCellTypeRepresentation:he,onCellRequest:ve,getCellValue:re,getCellValueForExport:we,editableFlag:!1,visibleFlag:!1},{dataIndex:"r3mIssueResolvedBy",text:C.r3mIssueResolvedBy,onCellRequest:ve,editableFlag:!1,visibleFlag:!1}],f=new i({shouldAcceptDrag:function(){return!0},shouldAcceptDrop:function(){return!1}});var r=e.createElement("div",{class:"r3mListPlaceHolder"});e.createElement("p",{html:u.placeHolderFst,styles:{"text-align":"center"}}).inject(r);var s=e.createElement("div",{styles:{"font-weight":"normal","text-align":"center"}}).inject(r);e.createElement("span",{html:u.placeHolderSnd+" "}).inject(s),e.createElement("span",{class:"fonticon fonticon-list-filter"}).inject(s);var l={identifier:"r3mDataGridView",treeDocument:f,defaultColumnDef:{width:"auto",height:"auto",editableFlag:!1},columns:m,rowSelection:"multiple",cellSelection:{defaultValue:"none"},rowGroupingEnabledFlag:!1,sortModel:[{dataIndex:"tree",sort:"asc"}],rowDragEnabledFlag:!0,allowUnsafeHTMLContent:!1,cellDragEnabledFlag:!0,activateAllCellsRenderedEventFlag:!0,placeholder:r,recId:"r3mValidationList",onContextualEvent:function(t){if(t){var n=[],i=t.cellInfos;if(t.collectionView&&i)if(-1===i.rowID&&-1!==i.columnID){let e=g.layout.getDataIndexFromColumnIndex(t.cellInfos.columnID);"tree"===e&&(e="label");var o=["typeDisp","maturityDisp","validStateDisp","analysisStateDisp","validStateWarning","owner"].indexOf(e)>-1?"set":"string";if(f.getFilterManager().getFilters().hasOwnProperty(e)){var r=f.getFilterManager().getFilters()[e];r&&r.defaultFilterModel&&(r.defaultFilterModel=[])}else f.getFilterManager().setPropertyFilterModel(e,{filterId:o});(n=t.collectionView.buildDefaultContextualMenu(t,{pin:!0,firstColumnsVisibility:!1,sizeColumnToFit:!0,columnsManagement:!1})).push({type:"PushItem",title:u.mnuExpandAllRows,icon:{iconName:"flow-tree-expand-down",fontIconFamily:p},action:{callback:function(){f.withTransactionUpdate(function(){Object.values(v).forEach(function(e){e.expandAll()})})}}}),n.push({type:"PushItem",title:u.mnuCollapseAllRows,icon:{iconName:"flow-tree-expand-up",fontIconFamily:p},action:{callback:function(){f.withTransactionUpdate(function(){Object.values(v).forEach(function(e){e.collapseAll()})})}}}),n.push({type:"SeparatorItem",title:""}),"label"!==e&&n.push({type:"PushItem",title:u.mnuHideCol,action:{callback:function(){g.layout.setColumnVisibleFlag(g.layout.getDataIndexFromColumnIndex(t.cellInfos.columnID),!1,{isUserInteraction:!0})}}}),n.push({type:"SeparatorItem",title:""}),n.push({type:"PushItem",title:u.mnuCustomView,action:{callback:a.bind(t.collectionView)}})}else if(-1!==i.columnID&&-1!==i.rowID){var s=g.getNodesXSO().get();s.some(function(e){return e.canBeExpanded()&&(!e.isExpanded()||e.getAllDescendants().some(function(e){return e.canBeExpanded()&&!e.isExpanded()}))})&&n.push({type:"PushItem",title:u.mnuExpandAll,icon:{iconName:"flow-tree-expand-down",fontIconFamily:p},action:{callback:function(){f.withTransactionUpdate(function(){g.getNodesXSO().get().forEach(function(e){e.expandAll()})})}}}),s.some(function(e){return e.canBeExpanded()&&(e.isExpanded()||e.getAllDescendants().some(function(e){return e.canBeExpanded()&&e.isExpanded()}))})&&n.push({type:"PushItem",title:u.mnuCollapseAll,icon:{iconName:"flow-tree-expand-up",fontIconFamily:p},action:{callback:function(){f.withTransactionUpdate(function(){g.getNodesXSO().get().forEach(function(e){e.collapseAll()})})}}}),n.length&&n.push({type:"SeparatorItem"});let t=E(),i=j(),a=N(),o=W(),r=R();(t&&t.length||a&&a.length||o&&o.length)&&n.push({type:"PushItem",title:u.mnuRelations,icon:{iconName:"object-related",family:p},action:{callback:_}}),r&&r.length&&n.push({type:"PushItem",title:u.mnuCopyLink,icon:{iconName:"link",family:p},action:{callback:O}}),a&&a.length&&n.push({type:"PushItem",title:u.mnuMaturity,icon:{iconName:"collaborative-lifecycle-management",family:p},action:{callback:A}}),o&&o.length&&o[0].display&&n.push({type:"PushItem",title:u.mnuValidation,icon:{iconName:"check",family:p},action:{callback:L}}),i>0&&n.push({type:"PushItem",title:u.mnuUpdateSimulation,state:2===i?"disabled":"enabled",icon:{iconName:"update",family:p},action:{callback:function(){!function(t){k().then(function(n){let i=e.createElement("div",{class:"r3mCsiCompute"}),a=3===t?e.createElement("span",{class:"wux-ui-3ds wux-ui-3ds-4x wux-ui-3ds-attention r3mwarningcolor"}):e.createElement("span",{class:"wux-ui-3ds wux-ui-3ds-4x wux-ui-3ds-info r3mInfocolor"});a.setStyles({"vertical-align":"middle"}),a.inject(i);let o=u.replace(n>1?u.csiIsrTokens:u.csiIsrToken,{label:n}).replace(/"/g,"");e.createElement("label",{text:o,styles:{"margin-bottom":"0px",padding:"25px 10px","font-size":"14px","font-weight":"normal"}}).inject(i);var r=new d({immersiveFrame:void 0,title:u.csiIsrUpdateIsr,content:i,modalFlag:!0,activeFlag:!1,buttons:3===t?{Ok:new c({label:u.pnlCancel,onClick:function(){r.destroy()}})}:{Ok:new c({onClick:function(){r.destroy(),B()}}),Cancel:new c({onClick:function(){r.destroy()}})}})})}(i)}}})}return n}}};Object.keys(M).forEach(function(e){l[e]=M[e]}),M=null,(g=new o(l)).getContent().addClassName(l.identifier),window.__karma__&&(g.layout.addCellCoordinates=!0);var h=g.getNodesXSO();h.options.getElementID=void 0,h.onPostAdd(le),h.onPostRemove(de),g.addEventListener("DSpointerhit",function(e,t){e&&e.multipleHitCount>1&&t&&t.columnID>=0&&t&&t.rowID>=0&&I()}),f.onPostCollapse(function(){setTimeout(function(){g.invalidateLayout({updateCellLayout:!0,freePool:!0})},0)}),f.onPostExpand(function(){setTimeout(function(){g.invalidateLayout({updateCellLayout:!0,freePool:!0})},0),function(){let e=P();f.getAllDescendants().forEach(function(t){let n=t.options.grid;e.indexOf(n.type)>-1&&t.isExpanded()&&T([n.id],!1)})}()}),f.getFilterManager().subscribe("filterModelChange",function(){setTimeout(function(){let t=e.clone(f.getFilterManager().filterModel,!0);t=Object.keys(t).reduce((e,n)=>(t[n].filterModel&&Object.keys(t[n].filterModel).length>0&&(e[n]=t[n]),e),{}),localStorage.setItem("r3mGridFilters",JSON.stringify({filterModel:t})),ue()},10)}),f.getModelEvents().subscribe({event:"sortChildren"},function(){setTimeout(function(){ue()},10)});var w=e.createElement("div",{class:"r3mPanel wux-windows-window-maincontent"}).inject(D),S=e.createElement("div",{class:"wux-windows-window-header"}).inject(w);g.setToolbar({entries:[{id:"listFilter",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"list-filter",fontIconFamily:p},position:"near",value:function(){require(["DS/Controls/Button","DS/Windows/Dialog","DS/Controls/Toggle","DS/Controls/ButtonGroup"],function(i,a,o,r){let s,l,d=e.createElement("div"),c=x(),p=e.createElement("div").inject(d);var f;"1"===localStorage.getItem("R3MFromCopylink")&&(f=new o({label:u.pnlMySelection,value:"idMySelection",type:"checkbox",checkFlag:1===c.myselection}).inject(p),p=e.createElement("div",{styles:{"margin-top":"10px"}}).inject(d));var g=new e.createElement("span",{class:"fonticon fonticon-3ds-who",styles:{color:c.myselection?"#BCBCBC":"#000000"}}).inject(p),m=e.createElement("label",{text:u.pnlOwner,class:c.myselection?"r3mFilterPanelDisable":"r3mFilterOwner",styles:{"margin-left":"2px"}}).inject(p);p=e.createElement("div",{styles:{"margin-left":"20px"}}).inject(d);var h=new r({type:"radio",disabled:c.myselection}).inject(p);h.addChild(new o({label:u.pnlMe,value:0,type:"radio",checkFlag:0===c.owner,disabled:c.myselection})),h.addChild(new o({label:u.pnlOrga,value:1,type:"radio",checkFlag:1===c.owner,disabled:c.myselection})),p=e.createElement("div").inject(d);var y=e.createElement("span",{class:"fonticon fonticon-3ds-what",styles:{color:c.myselection?"#BCBCBC":"#000000"}}).inject(p),v=e.createElement("label",{text:u.pnlMaturity,class:c.myselection?"r3mFilterPanelDisable":"r3mFilterMaturity",styles:{"margin-left":"2px","margin-top":"10px"}}).inject(p);p=e.createElement("div",{styles:{"margin-left":"20px"}}).inject(d);var w=new o({label:u.pnlReleased,value:"idReleased",type:"checkbox",checkFlag:1===c.released,disabled:c.myselection}).inject(p),S=new o({label:u.pnlObsolete,value:"idObsolete",type:"checkbox",checkFlag:1===c.obsolete,disabled:c.myselection}).inject(p);p=e.createElement("div").inject(d);var I=e.createElement("span",{class:"fonticon fonticon-3ds-what",styles:{color:c.myselection?"#BCBCBC":"#000000"}}).inject(p),M=e.createElement("label",{text:u.pnlType,class:c.myselection?"r3mFilterPanelDisable":"r3mFilterType",styles:{"margin-left":"2px","margin-top":"10px"}}).inject(p);p=e.createElement("div",{styles:{"margin-left":"20px"}}).inject(d);var C=new o({label:u.pnlRvw,value:"idRvw",type:"checkbox",checkFlag:1===c.rvw,disabled:c.myselection}).inject(p),P=new o({label:u.pnlIsr,value:"idIsr",type:"checkbox",checkFlag:1===c.isr,disabled:c.myselection}).inject(p),_=new o({label:u.pnlMsr,value:"idMsr",type:"checkbox",checkFlag:1===c.msr,disabled:c.myselection}).inject(p),E=new o({label:u.pnlMkp,value:"idMkp",type:"checkbox",checkFlag:1===c.mkp,disabled:c.myselection}).inject(p);function R(e){return Array.isArray(e.value)?e.value[0]:e.checkFlag?1:0}function O(){n.removeResizeListener(D),s.destroy()}f&&f.addEventListener("buttonclick",function(){g&&(g.style.color=f.checkFlag?"#BCBCBC":"#000000"),m&&m.setAttributes({class:f.checkFlag?"r3mFilterPanelDisable":"r3mFilterOwner"}),h&&(h.getContent().children[0].dsModel.disabled=f.checkFlag?1:0,h.getContent().children[1].dsModel.disabled=f.checkFlag?1:0),y&&(y.style.color=f.checkFlag?"#BCBCBC":"#000000"),v&&v.setAttributes({class:f.checkFlag?"r3mFilterPanelDisable":"r3mFilterMaturity"}),I&&(I.style.color=f.checkFlag?"#BCBCBC":"#000000"),M&&M.setAttributes({class:f.checkFlag?"r3mFilterPanelDisable":"r3mFilterMaturity"}),w&&(w.disabled=f.checkFlag?1:0),S&&(S.disabled=f.checkFlag?1:0),C&&(C.disabled=f.checkFlag?1:0),P&&(P.disabled=f.checkFlag?1:0),_&&(_.disabled=f.checkFlag?1:0),E&&(E.disabled=f.checkFlag?1:0)});var j=new i({emphasize:"primary",label:u.pnlOK,onClick:function(){O(),q.total.length=q.completed.length=q.failed.length=0,b({rvw:R(C),isr:R(P),mkp:R(E),msr:R(_),owner:R(h),released:R(w),obsolete:R(S),myselection:f?R(f):0})}}),k=new i({label:u.pnlCancel,onClick:O});s=e.createElement("div",{class:"wux-windows-modalDialog",styles:{}}).inject(D),(l=new a({title:u.pnlTitle,ensureHeightDefinitionOnHierarchy:!0,content:d,resizableFlag:!0,height:345,position:{of:D,constraint:D},buttons:{Cancel:k,Ok:j}})).elements.container.inject(s),l.addEventListener("close",O),t(l.elements.container,D),n.addResizeListener(D,function(){t(l.elements.container,D)})})}}},{id:"sidePanel",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"info",fontIconFamily:p},position:"far",value:I}}]}).inject(S);var F=e.createElement("div",{class:"wux-windows-window-content"}).inject(w);g.inject(F),n.addEventOnElement(w,w,"dimensionsChanged",function(){var e=window.getComputedStyle(F),t=e?e.getPropertyValue("padding-top"):"";t=""===t?0:parseInt(t,10);var n=e?e.getPropertyValue("padding-bottom"):"";n=""===n?0:parseInt(n,10);var i=S.offsetHeight+t+n;F.setStyle("height",i?"calc(100% - "+i+"px)":"100%")}),g.buildStatusBar(z)}()}})}),define("DS/DMUwebR3Mapp/DMUwebR3MappMain",[],function(){"use strict";var e;return Object.freeze({getApp:function(t){if(e)return e;var n,i=t.widget,a=document.createElement("div");a.classList.add("appMain"),a.style.width="auto",a.style.height="100%",require(["UWA/Core","i18n!DS/DMUwebR3Mctrl/assets/nls/DMUwebR3Mctrl.json","css!DS/DMUwebR3Mux/assets/css/DMUwebR3Mux"],function(e,t){var n=e.createElement("div",{class:"r3mWelcome"}),a=e.createElement("div",{class:"spinner spinner-lg spinning fade in",styles:{display:"flex","justify-content":"center"}}).inject(n);e.createElement("span",{class:"spinner-bar"}).inject(a),e.createElement("span",{class:"spinner-bar spinner-bar1"}).inject(a),e.createElement("span",{class:"spinner-bar spinner-bar2"}).inject(a),e.createElement("span",{class:"spinner-bar spinner-bar3"}).inject(a),e.createElement("div",{class:"r3mWelcomeText",html:t.validationLoad}).inject(n),i.setBody(n)});var o,r=function(e){return o||(o=new Promise(function(t){e.perfoMark("requireCtrl"),require(["DS/DMUwebR3Mctrl/DMUwebR3Mctrl"],function(o){e.perfoMeasure("requireCtrl"),e.perfoMark("buildUX");var r=o.getCtrl({id:1,parent:a});r.buildUX().then(function(){e.perfoMeasure("buildUX"),n=r,i.dispatchEvent("onWidgetAndAppReady"),t()})})}))};return i.addEvent("onLoad",function(){window.top.performance.measure(i.id+"_R3M_onWidgetLoad",i.id+"_R3M_onWidgetLoad"),window.top.performance.mark(i.id+"_R3M_requireWidgetUtils"),require(["DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils"],function(e){window.top.performance.measure(i.id+"_R3M_requireWidgetUtils",i.id+"_R3M_requireWidgetUtils"),window.top.performance.mark(i.id+"_R3M_initServicesSecurityContext"),e.init({widget:i,onCompletedPlatformServices:function(t){e.perfoMeasure("initServicesSecurityContext","initServices"),t&&!0===t.success||window.console.error("TODO!!!"),r(e).then(()=>i.setBody(a))},onCompletedSecurityContext:function(){e.perfoMeasure("initServicesSecurityContext"),n?n.refresh():r(e).then(function(){n.refresh()})}})})}),i.addEvent("onDestroy",function(){n&&n.destroy(),n=null}),i.setMetas({helpPath:"DMUwebR3Mapp/assets/help"}),e=Object.freeze({})}})}),define("DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils",["DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI","i18n!DS/DMUwebR3Mutils/assets/nls/DMUwebR3Mutils.json"].concat([]),function(e,t,n){"use strict";var i,a,o,r,s,l,d,c=[];function u(){return i&&i.lang||"en"}function p(){if(!i)throw new Error("App init not done");return o||(o=i.getValue("x3dPlatformId")),o}function f(){if(!i)throw new Error("App init not done");return r||(r=i.getValue("xPref_CREDENTIAL")),"ctx::"+r}function g(e){var t,n=p();if(!Array.isArray(a))throw new Error("Platform services not initialize yet");return a.some(function(i){if(i&&i.platformId===n)return t=i[e]}),t}function m(){return g("3DSpace")}function h(t){let n=m();if(!n)return void t.onCompleted(!1);let a=new Promise(function(e){require(["DS/ENOXWidgetPreferences/js/ENOXWidgetPreferences"].concat([]),function(t){t.addCredentialPreferenceToWidget({usePreferredCredentials:!0},2).then(function(){f();let t=i.getPreferences(),n=[];t.length>1&&"xPref_CREDENTIAL"===t[0].name&&(n.push(t[1]),n.push(t[0]),i.setPreferences(n)),e(!0)})},e.bind(null,!1))}),o=new Promise(function(t){n+="/resources/modeler/pno/person?current=true&select=preferredcredentials",e.authenticatedRequest(n,{method:"GET",type:"json",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":u()},onComplete:function(e){e&&e.preferredcredentials?(s=e.preferredcredentials.organization,t(Boolean(s))):t(!1)},onFailure:function(){t(!1)}})});Promise.all([a,o]).then(function(e){t.onCompleted(e[0]&&e[1])})}return Object.freeze({init:function(e){return i?Promise.resolve():new Promise(function(t){i=e.widget,d=e.widget.data,l=i.id+"_R3M_",p(),f(),i.setPreferences([]),require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(r){r.getPlatformServices({onComplete:function(s){r.getAppInfo({appId:i.getValue("x3dAppId"),onComplete:function(r){if(a=s,r.tenantAware){a=[];for(var l=0;l<r.platforms.length;++l)for(var d=0;d<s.length;++d)if(s[d].platformId===r.platforms[l].id){a.push(s[d]);break}}if(a&&a.length){var c=p();a.some(function(e){return e.platformId===c})||(o=c="",a.length&&(i.setValue("x3dPlatformId",a[0].platformId),c=p())),c&&a.length>1&&i.addPreference({name:"x3dPlatformId",type:"list",label:n.x3dPlatformId,options:a.map(function(e){return{label:e.displayName,value:e.platformId}}),defaultValue:c}),e.onCompletedPlatformServices({success:Boolean(c)||"tenant"}),h({onCompleted:()=>{e.onCompletedSecurityContext(),t()}})}else e.onCompletedPlatformServices({success:"platformServices"})},onFailure:function(){e.onCompletedPlatformServices({success:"getAppInfo"}),t()}})},onFailure:function(){e.onCompletedPlatformServices({success:"getPlatformServices"}),t()}})}),i.addEvent("endEdit",()=>{let e=i.getValue("x3dPlatformId"),t=e!==o;if(o=e,r=i.getValue("xPref_CREDENTIAL"),t){let e=new Promise(e=>{setTimeout(()=>h({onCompleted:e}),0)});c.forEach(t=>t(e))}})})},getWidget:function(){return i},getWidgetId:function(){return i.id},getWidgetAppId:function(){return i.getValue("x3dAppId")},getLang:u,getUserLogin:function(){var e=t.getUser();return e?e.login:""},getUserOrganizationName:function(){return s?s.name:""},getPlatformId:p,getPlatformIdServices:function(){return JSON.parse(JSON.stringify(a.filter(e=>e.platformId===o)))},get3DSpaceUrl:m,get3DSearchUrl:function(){return g("3DSearch")},get3DSwymUrl:function(){return g("3DSwym")},getR2VPlatformUrl:function(){return g("r2vsurvey")},getSecurityContext:f,getDatafromContent:function(){if(!i)throw new Error("App init not done");var e={},t=[];if(void 0===i.data.X3DContentId)return e;var n=JSON.parse(i.data.X3DContentId);return n.data&&n.data.items&&n.data.items.forEach(function(e){t.push({objectId:e.objectId,objectType:e.objectType})}),e.obj=t,e},getWidgetData:function(){return d},onTenantModified:function(e){c.push(e)},perfoMark:function(e){window.top.performance.mark(l+e)},perfoMeasure:function(e,t){window.top.performance.measure(l+(t||e),l+e)}})}),define("DS/DMUwebR3Mutils/DMUwebR3McancelablePromise",[],function(){"use strict";return function(e){let t=!1,n=()=>{t=!0};const i=new Promise((i,a)=>{n=(()=>{t||i("Promise cancelled")}),t?n():e(i,a)});return i.then(e=>(t=!0,e)),i.catch(e=>(t=!0,e)),{promise:i,cancel:n}}}),define("DS/DMUwebR3Mutils/DMUwebR3MserverRequests",["DS/WAFData/WAFData","DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/DMUwebR3Mutils/DMUwebR3McancelablePromise","UWA/Core","i18n!DS/DMUwebR3Mutils/assets/nls/DMUwebR3Mutils.json"].concat([]),function(e,t,n,i,a,o){"use strict";let r,s,l,d,c,u=["ds6w:label","ds6w:identifier","ds6w:type","ds6w:status","ds6wg:dmuvalidationvalidation.v_validationstate","ds6wg:dmuvalidationvalidation.V_Validation_RestrictedEdition","bo.SIMItfSimulation.V_ValidationState","ds6wg:simitfsimulation.v_itf_executionstatus","ds6w:description","ds6w:responsible","ds6w:responsibleuid","ds6w:originator","originator","ds6w:organizationResponsible","ds6w:modified","ds6w:created","ds6w:project"],p=["ds6w:label","ds6w:identifier","ds6w:type","ds6w:status","ds6wg:dmuvalidationcheck.v_validation_checkstate","bo.SIMItfSimulation.V_ValidationState","ds6w:description","ds6w:responsible","ds6w:responsibleuid","ds6w:originator","originator","ds6w:organizationResponsible","ds6w:modified","ds6w:created","ds6w:project","ds6w:priority"],f=["icon"],g=200,m={"ds6w:label":"title","ds6w:identifier":"name","ds6w:type":"type","ds6w:status":"maturity","ds6wg:dmuvalidationvalidation.v_validationstate":"validState","ds6wg:dmuvalidationvalidation.V_Validation_RestrictedEdition":"validState","ds6wg:dmuvalidationcheck.v_validation_checkstate":"validState","bo.SIMItfSimulation.V_ValidationState":"validState","ds6wg:simitfsimulation.v_itf_executionstatus":"executionstate","ds6w:description":"description","ds6w:responsible":"owner","ds6w:responsibleuid":"ownerid","ds6w:originator":"originator",originator:"originatorid","ds6w:organizationResponsible":"organization","ds6w:modified":"dateModif","ds6w:created":"dateCreat","ds6w:project":"collabSpace",type_icon_url:"icon",resourceid:"id",physicalid:"id","ds6w:priority":"r3mIssuePriority"},h=1,y=0,v=[];function w(e){return e+"-"+t.getUserLogin()+"-"+Date.now()}function S(e){return new Promise(function(i){n.getNlsOfPropertiesValues(JSON.stringify(e),{tenantId:t.getPlatformId(),lang:t.getLang(),apiVersion:"R2019x",onComplete:function(t){Object.keys(t).forEach(function(e){s[e]=Object.assign(s[e]||{},t[e])}),Object.keys(e).forEach(function(t){e[t].forEach(e=>{s[t][e]||(s[t][e]=e)})}),e["ds6w:status"]&&Object.keys(s["ds6w:status"]).forEach(e=>{e.search(".DEFAULT")>-1&&(s["ds6w:status"][e]="")}),i()},onFailure:function(){i()}})})}function b(e){if(e){if(d.hasOwnProperty(e))return d[e];var n=t.get3DSwymUrl();return d[e]=n?n+"/api/user/getpicture/login/"+e+"/format/mini":""}}function I(e,t,n){var i={};return Object.keys(e).forEach(function(a){var o=m[a];i[o]=e[a],"ds6w:identifier"===a&&"issue"===n&&(i.r3mIssueName=e[a]),s[a]&&(s[a].hasOwnProperty([e[a]])?i[o+"Disp"]=s[a][e[a]]:(t[a]||(t[a]={values:[],objects:[]}),-1===t[a].values.indexOf(e[a])&&t[a].values.push(e[a]),t[a].objects.push(i)))}),"issue"===n&&(i.r3mIssueAssignees=i.r3mIssueResolvedBy=i.r3mIssueApprovals="running"),i.ownerImg=b(i.ownerid),i.originatorImg=b(i.originatorid),i}function M(e,t,n){return e.map(function(e){return I(e,t,n)})}function C(e,t){if(t)return t.validState="2"===e?"Passed":"3"===e?"Failed":"InProgress",t.validStateDisp=o["validState"+t.validState],t}function D(n){var i={Accept:"application/json","Content-Type":"application/json"};return n.securityContext&&(i.SecurityContext=n.securityContext),e.authenticatedRequest(n.url+"?tenant="+t.getPlatformId()+(n.securityContext?"&SecurityContext="+n.securityContext:""),{method:n.method,type:"json",headers:n.headers?n.headers:i,data:JSON.stringify(n.data),timeout:n.timeout,onComplete:n.onComplete,onFailure:n.onFailure,onTimeout:n.onTimeout||n.onFailure})}function x(n){if(n){var i=a.clone(n.config,!1);i.onComplete=n.onSuccess,i.onFailure=n.onFailure,i.method=i.verb,i.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang(),SecurityContext:t.getSecurityContext()},"object"==typeof i.data&&(i.data=JSON.stringify(i.data));var o=[];o.push("securityContext"),o.push(t.getSecurityContext()),o.push("tenant"),o.push(t.getPlatformId()),e.authenticatedRequest(t.get3DSpaceUrl()+"/"+n.url,i)}}function P(e){return{input_physical_ids:e,label:w("R3MwebIsr"),primitives:[{navigate_to_rel:{id:1,filter:{bo_type:["dsc_Model_Category_Ref"]}}},{navigate_to_rel:{id:2}},{navigate_to_sr:{id:3,filter:{semantics:["5"],role:["79"]},mode:"last"}},{navigate_to_sr:{id:4,filter:{semantics:["4"],role:["170"]},mode:"last"}},{navigate_from_rel:{id:5,filter:{rel_type:["Reference Document"],bo_type:["Issue"]}}}],patterns:{prd:[{id:1},{id:2},{id:3}],context:[{id:1},{id:2},{id:4}],issue:[{id:5}]},fileAttributes:f,attributes:p,version:3}}function _(e){return{input_physical_ids:e,label:w("R3MwebMkp"),primitives:[{navigate_from_rel:{id:1,filter:{rel_type:["Markup"]}}},{navigate_from_rel:{id:2,filter:{rel_type:["Reference Document"],bo_type:["Issue"]}}}],patterns:{context:[{id:1}],issue:[{id:2}]},fileAttributes:f,attributes:p,version:3}}function E(e){return new Promise(function(n){D({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",data:e,onComplete:function(e){n(e)},onFailure:function(){n({})}})})}function R(e){let n=Object.keys(e);return n.length?new Promise(e=>{D({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",data:function(e){return{input_physical_ids:e,label:w("R3MwebTic"),primitives:[{navigate_from_rel:{id:1,filter:{rel_type:["Reference Document"],bo_type:["Issue"]}}}],patterns:{issue:[{id:1}]},fileAttributes:f,attributes:p,version:3}}(n),onComplete:e,onFailure:function(){e()}})}):Promise.resolve()}const O=e=>new Promise(t=>{"DMUValidationValidation"===e.input_object["ds6w:type"]||"Markup"===e.input_object["ds6w:type"]?x({url:"resources/validation/service/getAll",config:{verb:"POST",data:{sValidationId:e.input_object.physicalid}},onSuccess:function(e){var n=JSON.parse(e);t(n)},onFailure:function(){t()}}):"DMUMarkupRepReference"===e.input_object["ds6w:type"]?x({url:"resources/markup/service/getMarkup",config:{verb:"POST",data:{sMarkupId:e.input_object.physicalid}},onSuccess:function(n){var i=JSON.parse(n);x({url:"/cvservlet/fetch/v2",config:{verb:"POST",data:{physicalid:i.MarkupContext.contextId?i.MarkupContext.contextId:i.MarkupContext.contextIds,label:"M3DFetchForWelcomePanel"+Date.now(),select_predicate:u,select_file:f}},onSuccess:function(n){var a=JSON.parse(n),o=[],r={physicalid:i.MarkupContext.contextId};a.results[0].attributes.forEach(function(e){r[e.name]=e.value}),o.push(r),e.outputs.context=o,t(e)},onFailure:function(){t()}})},onFailure:function(){t()}}):t()});function j(e){return new Promise(function(n){D({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",data:e,onComplete:function(e){var t={},i={},a=[],o=[],r=[],l={};e.result.forEach(function(e){var n=e.input_object.physicalid;t[n]={},["context","highlight","check","issue","ca"].forEach(function(a){e.outputs[a]&&(t[n][a]=M(e.outputs[a],i,a))}),(t[n].highlight||[]).forEach(e=>{l[e.id]=e}),(t[n].check||[]).forEach(e=>C(e.validState,e)),(e.outputs.checked||[]).forEach(function(e){let a=e.owner.physicalid;(t[n].check||[]).some(t=>{if(!t.children)return t.id===a?(t.children=M(e.elements,i),!0):void 0})}),e.outputs.validatedPath&&(t[n].validatedPath=[],e.outputs.validatedPath.forEach(function(e){if(!e.elements.length)return;let i=e.elements[0]["ds6w:type"],r="VPMInstance"===i||"VPMRepInstance"===i;t[n].validatedPath[e.app_index||e.sr_id]=e.elements.map(function(e,t){return r&&(0===t&&-1===a.indexOf(e.physicalid)&&a.push(e.physicalid),-1===o.indexOf(e.physicalid)&&o.push(e.physicalid)),e.pid=e.physicalid,e.type=e["ds6w:type"],e}),t[n].validatedPath[e.app_index||e.sr_id].instancePath=r}),t[n].validatedPath=t[n].validatedPath.filter(function(e){return e&&e.length}),t[n].validatedPath.length&&r.push(t[n])),e.outputs.prd&&(t[n].context=(t[n].context||[]).concat(M(e.outputs.prd,i)))});const d=[];e.result.map(e=>{void 0===e.outputs.context&&d.push(O(e))});const c=[];e.result.map(e=>{void 0===e.outputs.context&&"DMUMarkupRepReference"===e.input_object["ds6w:type"]&&c.push(O(e))}),Promise.all([0===c.length?Promise.resolve():Promise.all(c)]).then(function(e){var c;e[0]&&e[0].forEach(function(e){t[e.input_object.physicalid].context=M(e.outputs.context,i)}),Promise.all([a.length?E((c=a,{input_physical_ids:c,label:w("R3MwebValidFrom"),primitives:[{navigate_from_rel:{id:1}}],patterns:{root:[{id:1}]},fileAttributes:f,attributes:p,version:3})):Promise.resolve(),o.length?E(function(e){return{input_physical_ids:e,label:w("R3MwebValidTo"),primitives:[{navigate_to_rel:{id:1}}],patterns:{ref:[{id:1}]},fileAttributes:f,attributes:p,version:3}}(o)):Promise.resolve(),R(l),0===d.length?Promise.resolve():Promise.all(d)]).then(function(e){var n={},a={},o={};(e[0]&&e[0].result||[]).forEach(function(e){n[e.input_object.physicalid]={pid:e.outputs.root[0].physicalid,type:e.outputs.root[0]["ds6w:type"]},o[e.outputs.root[0].physicalid]||(o[e.outputs.root[0].physicalid]=e.outputs.root[0])}),(e[1]&&e[1].result||[]).forEach(function(e){a[e.input_object.physicalid]={pid:e.outputs.ref[0].physicalid,type:e.outputs.ref[0]["ds6w:type"]},o[e.outputs.ref[0].physicalid]||(o[e.outputs.ref[0].physicalid]=e.outputs.ref[0])}),r.forEach(function(e){e.validated=[],e.validatedPath.forEach(function(t,r){let s;if(t.instancePath){s=I(o[a[t[t.length-1].pid].pid],i);var l=[n[t[0].pid]];t.forEach(function(e){l.push(e),l.push(a[e.pid])}),s.validatedPath=l}else(s=I(t[t.length-1],i)).validatedPath=t;e.validated[r]=s,s.pid=s.id,s.id=String(h++)}),delete e.validatedPath}),(e[2]&&e[2].result||[]).forEach(e=>{let t=e.input_object.physicalid;["issue","ca"].forEach(n=>{e.outputs[n]&&(l[t][n]=M(e.outputs[n],i))})}),(e[3]||[]).forEach(e=>{void 0!==e&&void 0!==e.children&&e.children.forEach(n=>{n&&"DMUValidationContext"===n.type&&void 0===t[e.id].context&&(t[e.id].context=[{id:n.contextId,serviceId:n.serviceID}],t[e.id].validated=[{id:n.contextId,serviceId:n.serviceID}])})})}).then(function(){Object.keys(i).length?new Promise(function(){var e={};Object.keys(i).forEach(function(t){e[t]=i[t].values}),S(e).then(function(){Object.keys(i).forEach(function(e){i[e].objects.forEach(function(t){var n=m[e];t[n+"Disp"]=s[e][t[n]]})}),n(t)})}):n(t)})})},onFailure:function(){n({})}})})}function k(e){var n;D({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",timeout:6e4,data:(n=e.ctxIDs,{input_physical_ids:n,label:w("R3MPIMwebItfCtx"),primitives:[{navigate_to_sr:{id:1,filter:{semantics:["6"],role:["198"]},mode:"last"}},{navigate_to_rel:{id:2}}],patterns:{ms:[{id:1}]},attributes:["ds6w:type","bo.PLMPIMMetricReference.V_Itf_Type","bo.PLMPIMMetricReference.V_Itf_Analysis","bo.SIMItfContextOfInterference.V_Context_Validity_Status"],fileAttributes:[],version:3}),onProgress:e.onProgress,onComplete:e.onComplete,onFailure:e.onFailure})}var F,A,V,T=(F=[],A=0,V=function(e,t){A--,T(),t(e)},function(e){var t,n;e&&F.push(e),F.length&&A<5&&(A++,t=F.shift(),(n=a.clone(t,!1)).onComplete=function(e){V(e,t.onComplete)},n.onFailure=function(e){V(e,t.onFailure)},n.onTimeout=function(e){V(e,t.onTimeout||t.onFailure)},k(n))});function U(e){return{input_physical_ids:e,label:w("R3MPIMwebIsr"),primitives:[{navigate_to_rel:{id:1,filter:{bo_type:["dsc_Result_Category_Ref"]}}},{navigate_to_rel:{id:2}}],patterns:{itfCtxt:[{id:1},{id:2}]},fileAttributes:[],attributes:["ds6wg:simitfsimulation.v_itf_executionstatus"],version:3}}function N(e,n){var i={simPid:e,nbOK:0,nbKO:0};D({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",timeout:6e4,data:U(e),onComplete:function(e){let t=e.result[0];if(!t||0===Object.keys(t.outputs).length)return void n({status:"KO",issues:{}});let a=(t.outputs.itfCtxt||[]).map(function(e){return e.physicalid}),o=[];if(0!==a.length){i.nbTotalItf=a.length;for(var r=Math.floor((a.length-1)/500)+1,s=0,l=[];s<r;)T({ctxIDs:a.slice(500*s,500*(s+1)),type:"MetricIssue",onComplete:function(e){var t=[];e.result.forEach(function(e){if(e.outputs&&e.outputs.ms&&1===e.outputs.ms.length){if(o.indexOf(e.outputs.ms[0].physicalid)>-1)return;o.push(e.outputs.ms[0].physicalid)}t.push(e.input_object.physicalid)}),d({itfIDs:t})},onFailure:function(){}}),s++}else n({status:"KO",issues:{}});function d(e){var t,i,r;l.push.apply(l,e.itfIDs),t=o,i=n,r=l.length/a.length,j(P(t)).then(function(e){let t={};Object.keys(e).forEach(function(n){-1!==Object.keys(e[n]).indexOf("issue")&&e[n].issue.forEach(function(e){t[e.id]=e})}),i({status:"OK",issues:t,completed:parseInt(100*r)})})}},onFailure:function(){}})}function L(e){return new Promise(function(n){D({url:t.get3DSpaceUrl()+"/resources/dictionary/getTypeInfo",method:"POST",data:[e],onComplete:function(t){Object.keys(t).forEach(function(t){-1===l[e].indexOf(t)&&l[e].push(t)}),n()},onFailure:n})})}function W(){return c?Promise.resolve():(d={},r={},s={"ds6w:type":{},"ds6w:status":{},"ds6wg:dmuvalidationvalidation.v_validationstate":{},"ds6w:priority":{}},l={DMUValidationValidation:["DMUValidationValidation"],SIMItfSimulation:["SIMItfSimulation"],Markup:["Markup"],DMUMarkupRepReference:["DMUMarkupRepReference"],DesignSight:["DesignSight"]},Promise.all([L("DMUValidationValidation"),L("SIMItfSimulation"),new Promise(function(e){n.getResourcesInfo(u.join(","),{tenantId:t.getPlatformId(),lang:t.getLang(),apiVersion:"R2019x",onComplete:function(t){(t||[]).forEach(function(e){r[m[e.curi]]=e.label}),r.validState=o.validState,r.analysisState=o.analysisState,r.r3mIssueName=o.r3mIssueName,r.r3mIssueApprovals=o.r3mIssueApprovals,r.r3mIssueAssignees=o.r3mIssueAssignees,r.r3mIssuePriority=o.r3mIssuePriority,r.r3mIssueResolvedBy=o.r3mIssueResolvedBy,e(r)},onFailure:function(){u.forEach(function(e){r[m[e]]=e}),e(r)}})}),S({"ds6w:type":["SIMItfSimulation","DMUValidationValidation","Markup","DMUMarkupRepReference","VPMReference","Requirement","DMUValidationExposedPresentation","Member List","Drawing","ENOStrRefinementSpecification"],"ds6w:status":["VPLM_SMB_Evaluation.PRIVATE","VPLM_SMB_Evaluation.IN_WORK","VPLM_SMB_Evaluation.FROZEN","VPLM_SMB_Evaluation.RELEASED","VPLM_SMB_Evaluation.OBSOLETE","VPLM_SMB_Definition.PRIVATE","VPLM_SMB_Definition.IN_WORK","VPLM_SMB_Definition.FROZEN","VPLM_SMB_Definition.RELEASED","VPLM_SMB_Definition.OBSOLETE"],"ds6w:priority":["Low","Medium","High","Urgent"]})]).then(function(){c=!0}))}t.onTenantModified(()=>{c=!1,W().then(()=>v.forEach(e=>e()))});var B=Object.create({}),q=Object.getPrototypeOf(B);return Object.defineProperty(q,"_NB_SEARCH_RESULTS",{get:()=>g,set:e=>{g=e}}),q.getColumnsNls=function(){return W().then(function(){return r})},q.getRvwTypes=function(){return[].concat(l.DMUValidationValidation)},q.getIsrTypes=function(){return[].concat(l.SIMItfSimulation)},q.getMkpTypes=function(){return[].concat(l.Markup)},q.getNewMkpTypes=function(){return[].concat(l.DMUMarkupRepReference)},q.getMsrTypes=function(){return[].concat(l.DesignSight)},q.getMaturityNlsValue=(e=>s["ds6w:status"][e]||""),q.getValidStateNlsValue=(e=>o["validState"+e]),q.getAnalysisStateNlsValue=(e=>o["analysisState"+e]),q.updateCheckStateValue=C,q.search=function(e,n){let a=[],r=new i(function(i){if(y++,!(e.rvw||e.isr||e.mkp||e.msr))return n({},0),void i();!function r(s,l,d){var c={query:function(e){var n="(";return n+=e.mkp?'flattenedtaxonomies:"types/Markup"':"",e.mkp&&n.length>1&&(n+=" OR "),n+=e.mkp?'flattenedtaxonomies:"types/DMUMarkupRepReference"':"",e.isr&&n.length>1&&(n+=" OR "),n+=e.isr?'flattenedtaxonomies:"types/SIMItfSimulation"':"",e.rvw&&n.length>1&&(n+=" OR "),n+=e.rvw?'flattenedtaxonomies:"types/DMUValidationValidation"':"",e.msr&&n.length>1&&(n+=" OR "),n+=e.msr?'flattenedtaxonomies:"types/DesignSight"':"",n+=")",e.released||(n=n.concat(" AND NOT ([ds6w:status]:VPLM_SMB_Evaluation.RELEASED OR [ds6w:status]:VPLM_SMB_Evaluation_MajorRev.RELEASED)")),e.obsolete||(n=n.concat(" AND NOT ([ds6w:status]:VPLM_SMB_Evaluation.OBSOLETE OR [ds6w:status]:VPLM_SMB_Evaluation_MajorRev.OBSOLETE)")),0===e.owner?n+=' AND [ds6w:responsibleuid]:"'+t.getUserLogin()+'"':1===e.owner&&(n+=' AND [ds6w:organizationResponsible]:"'+t.getUserOrganizationName()+'"'),n}(s),locale:t.getLang(),tenant:t.getPlatformId(),nresults:g,label:w("R3MwebSearch_"+y),select_predicate:u,select_file:f,with_synthesis:!1,with_synthesis_attribute:!1,with_nls:!0,login:{"3dspace":{SecurityContext:t.getSecurityContext()}},source:["3dspace"]};c[0===l?"start":"next_start"]=l,a.push(D({url:t.get3DSearchUrl()+"/search",method:"POST",data:c,onComplete:function(t){var a={};(t.results||[]).forEach(function(e){if(e&&e.attributes){var t={};e.attributes.forEach(function(e){var n=(e.name||"bug").split("/"),i=n[n.length-1];m[i]&&("ds6w:type"===i?(t.type=e.value,t.typeDisp=e.dispValue):"ds6w:status"===i?(t.maturity=e.value,t.maturityDisp=e.dispValue||e.value):"ds6wg:dmuvalidationvalidation.v_validationstate"===i?(t.validState=e.value,t.validStateDisp=o["validState"+e.value]):"ds6wg:dmuvalidationvalidation.V_Validation_RestrictedEdition"===i?(t.restrictedEdition=e.value,t.restrictedEditionDisp=e.dispValue||e.value):"bo.SIMItfSimulation.V_ValidationState"===i?(t.validState=e.value,t.validStateDisp=o["validState"+e.value]):"ds6wg:simitfsimulation.v_itf_executionstatus"===i?t.executionState=e.value:t[m[i]]=e.dispValue||e.value)}),t.analysisState="unknown",t.analysisStateDisp="",t.analysisStateNbKO=0,t.analysisStateProgress=0,t.ownerImg=b(t.ownerid),t.originatorImg=b(t.originatorid),t.id&&(a[t.id]=t)}}),n(a,d),t.infos.nresults?r(e,t.infos.next_start,++d):i()},onFailure:function(){i()}}))}(e,0,0)});return r.promise.then(e=>(e&&a.forEach(e=>e.cancel()),e)),r},q.evalAnalysisStatus=function(e,n,i){!function(e,n,i){var a={simPid:e,nbTotalItf:0,nbOK:0,nbKO:0};D({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",timeout:6e4,data:U(e),onComplete:function(t){let o=t.result[0];if(!o||0===Object.keys(o.outputs).length)return o.input_object["ds6wg:simitfsimulation.v_itf_executionstatus"]&&(a.ExecStatus=o.input_object["ds6wg:simitfsimulation.v_itf_executionstatus"]),void n({status:"success",output:[a]});let r=(o.outputs.itfCtxt||[]).map(function(e){return e.physicalid}),s=[];a.ExecStatus=o.input_object["ds6wg:simitfsimulation.v_itf_executionstatus"],0===r.length&&n({status:"success",output:[a]}),a.nbTotalItf=r.length;for(var l=Math.floor((r.length-1)/500)+1,d=0,c=[],u=!1;d<l&&!u;)T({ctxIDs:r.slice(500*d,500*(d+1)),onComplete:function(t){var o,l=[];t.result.forEach(function(e){if(l.push(e.input_object.physicalid),e.input_object&&"1"!==e.input_object["bo.SIMItfContextOfInterference.V_Context_Validity_Status"])a.nbTotalItf--;else if(e.outputs&&e.outputs.ms&&1===e.outputs.ms.length){if(s.indexOf(e.outputs.ms[0].physicalid)>-1)return void a.nbTotalItf--;s.push(e.outputs.ms[0].physicalid);let t=e.outputs.ms[0];"5"===t["bo.PLMPIMMetricReference.V_Itf_Type"]||"6"===t["bo.PLMPIMMetricReference.V_Itf_Type"]?a.nbTotalItf--:"1"===t["bo.PLMPIMMetricReference.V_Itf_Analysis"]?a.nbOK++:"2"===t["bo.PLMPIMMetricReference.V_Itf_Analysis"]&&a.nbKO++}}),o={itfIDs:l},u&&n({status:"failure",simIds:[e]}),c.push.apply(c,o.itfIDs),c.length===r.length?n({status:"success",output:[a]}):i(e,r.length,c.length)},onFailure:function(){n({status:"failure",simIds:[e]}),u=!0}}),d++},onFailure:function(){n({status:"failure",simIds:[e]})}})}(e.id,n,i)},q.evalMetricIssueCells=function(e,t){N(e,t)},q.evalIssueCells=function(e,n){for(var i=[],a=0;a<e.length;a++)i.push({id:a,method:"GET",url:"resources/issues/"+e[a]});D({url:t.get3DSpaceUrl()+"/resources/issues/batch",securityContext:t.getSecurityContext(),method:"POST",data:{requests:i},onComplete:function(t){t.results.forEach(function(e){e.body.assignees.forEach(function(e){b(e.user)})}),n(t,d,e)},onFailure:function(){n({results:[]},e)}})},q.getFeatureStateInfo=function(n){return new Promise(function(i){(function(n){return new Promise((i,a)=>{e.authenticatedRequest(t.getR2VPlatformUrl(n.serviceId)+"/enovia/resources/r2v/v1/modeler/featurestate/fetch",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},data:JSON.stringify({ids:[n.objectId]}),timeout:6e4,onComplete:function(e){let t=JSON.parse(e);i(t)},onFailure:a,onTimeout:a})})})(n).then(e=>{i(e)})})},q.onTenantModified=function(e){v.push(e)},q.navigate=function(e){var t,n=[e.rvwIds.length?j((t=e.rvwIds,{input_physical_ids:t,label:w("R3MwebRvw"),primitives:[{navigate_to_rel:{id:1,filter:{rel_type:["VPLMrel/PLMConnection/V_Owner"]}}},{navigate_to_sr:{id:2,filter:{semantics:["1"],role:["78"]}}},{navigate_to_sr:{id:3,filter:{semantics:["5"],role:["110"]},mode:"path"}},{navigate_to_sr:{id:4,filter:{semantics:["5"],role:["151"]},mode:"path"}},{navigate_to_rel:{id:5,filter:{rel_type:["VPLMrel/PLMConnection/V_Owner"],bo_type:["DMUValidationCheck"]}}},{navigate_to_rel:{id:6,filter:{rel_type:["VPLMrel/PLMPort/V_Owner"],bo_type:["DMUValidationExposedPresentation"]}}},{navigate_from_rel:{id:7,filter:{rel_type:["Reference Document"],bo_type:["Issue"]}}}],patterns:{context:[{id:1},{id:2}],validatedPath:[{id:1},{id:3}],check:[{id:5}],checked:[{id:1},{id:4}],highlight:[{id:6}],issue:[{id:7}]},fileAttributes:f,attributes:p,version:3})):Promise.resolve({}),e.isrIds.length?j(P(e.isrIds)):Promise.resolve({}),e.mkpIds.length?j(_(e.mkpIds)):Promise.resolve({}),e.newMkpIds.length?j(_(e.newMkpIds)):Promise.resolve({}),e.msrIds.length?j(function(e){return{input_physical_ids:e,label:w("R3MwebMsr"),primitives:[{navigate_to_rel:{id:1,filter:{bo_type:["dsc_Model_Category_Ref"]}}},{navigate_to_rel:{id:2}},{navigate_to_sr:{id:3,filter:{semantics:["5"],role:["79"]},mode:"last"}},{navigate_to_sr:{id:4,filter:{semantics:["4"],role:["170"]},mode:"last"}},{navigate_from_rel:{id:5,filter:{rel_type:["Reference Document"],bo_type:["Issue"]}}}],patterns:{prd:[{id:1},{id:2},{id:3}],context:[{id:1},{id:2},{id:4}],issue:[{id:5}]},fileAttributes:f,attributes:p,version:3}}(e.msrIds)):Promise.resolve({})];return Promise.all(n)},B}),define("DS/DMUwebR3Mutils/DMUwebR3MCsiServices",["UWA/Core","DS/WAFData/WAFData","DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils"].concat([]),function(e,t,n){"use strict";let i={get3DSpaceUrl:()=>n.get3DSpaceUrl(),getPlatformId:()=>n.getPlatformId()};function a(e){return t.authenticatedRequest(e.url,{method:e.method,headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:e.securityContext},data:JSON.stringify(e.data),timeout:e.timeout,onComplete:e.onComplete,onFailure:e.onFailure,onTimeout:e.onTimeout||e.onFailure})}function o(t){var n=e.Promise.deferred();return function(t,n){var i=e.Promise.deferred();return require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"].concat([]),function(e){e.getServiceUrl({serviceName:t,platformId:n,onComplete:function(e){i.resolve(e)},onFailure:function(e){i.reject(new Error(e))}})}),i.promise}("djc",t).then(function(e){var t=e+"/api";n.resolve(t)}),n.promise}function r(t,n,a,r){var s=e.Promise.deferred();let l=i.getPlatformId(),d=Object.assign({},t);return d.method=n,o(l).then(function(e){d.url=e+a,r&&(d.data=r),s.resolve(d)}),s.promise}return{_computeIsr:function(e){r({onFailure:e.onFailure,onComplete:function(t){var n=JSON.parse("string"==typeof t?t:null);if(!n||!n.jobID||0!==n.status||"OK"!==n.message)return e.onFailure();e.onComplete(n)}},"POST","/v1/job/submit/interference",e.data).then(function(e){return a(e)})},_getComputeIsrJobStatus:function(e){r({onFailure:e.onFailure,onComplete:function(t){var n=JSON.parse("string"==typeof t?t:null);if(!n||!n.jobID||0!==n.status||"OK"!==n.message)return e.onFailure();e.onComplete(n)}},"GET","/v1/job/status/"+e.data.jobID,null).then(function(e){return a(e)})},_isUpdateSimulationAllowed:function(){var e,t="";if(window&&window.widget){var n="OnPremise"!==(e=window.widget).getValue("x3dPlatformId");if(e&&e.data&&e.data.appId&&(t=e.data.appId),1===window.top.__PIM_CSIExecute&&n&&("ENOR3M_AP"===t||"ENOI3S_AP"===t))return!0}return!1},_getListIfJobs:function(e){r({onFailure:e.onFailure,onComplete:function(t){var n=JSON.parse("string"==typeof t?t:null);if(!n||0!==n.status||"OK"!==n.message)return e.onFailure();e.onComplete(n)}},"GET","/v1/job/list",null).then(function(e){return a(e)})},_get3DSpaceUrlAndLoginTicket:function(n){var a=e.Promise.deferred(),o=n&&n.platformId?n.platformId:i.getPlatformId();let r=i.get3DSpaceUrl(o);return function(n,i){var a=e.Promise.deferred(),o=n+"/resources/modeler/pno/person?current=true&select=preferredcredentials";return i&&(o+="&tenant="+i),t.authenticatedRequest(o,{method:"GET",type:"json",onComplete:function(e){var t=e.preferredcredentials.role.name,n=e.preferredcredentials.organization.name,i=e.preferredcredentials.collabspace.name;a.resolve(t+"."+n+"."+i)},onFailure:function(e){a.reject(new Error(e))}}),a.promise}(r,o).then(function(n){(function(n,i,a){var o=e.Promise.deferred(),r=n+"/ticket/get?runasctx="+encodeURIComponent(i).trim();return a&&(r+="&tenant="+a),t.authenticatedRequest(r,{headers:{Accept:"application/json"},method:"GET",type:"json",onComplete:function(e){o.resolve(e.ticket)},onFailure:function(e){o.reject(new Error(e))}}),o.promise})(r,n,o).then(function(e){a.resolve({url:r,loginTicket:e})})}),a.promise},_computeItfSimulation:function(t){var a=this,o=e.Promise.deferred();return this._isUpdateSimulationAllowed()?this._get3DSpaceUrlAndLoginTicket().then(function(){var e=localStorage.getItem("PIMCSIInputI3S"),r={version:1,type:"Parameters",content:{sSecurityCtxt:{type:"string",value:n.getSecurityContext()},sIsrObjId:{type:"string",value:t.isrID},sWApp:{type:"string",value:"R3M"},sDbgVal:{type:"string",value:e},bReroot:{type:"bool",value:!1},bTrackStat:{type:"bool",value:!1}}},s={data:{items:[{objectId:t.isrID,objectType:"SIMItfSimulation"}]}};s.source=window.widget&&window.widget.getValue("x3dAppId")?window.widget.getValue("x3dAppId"):"ENOI3S_AP",s.widgetId=window.widget?window.widget.id:void 0,s.data.items[0].envId=i.getPlatformId(),s.data.items[0].serviceId="3DSpace",s.data.items[0].contextId=n.getSecurityContext().replace("ctx::",""),s="content:X3DContentId="+encodeURIComponent(JSON.stringify(s));var l={data:{title:"Interference Simulation Computation",internalID:t.isrID,inputs:JSON.stringify(r),app:{appContent:s}},onComplete:function(e){var t={data:{jobID:e.jobID},onComplete:function(){o.resolve({status:"running"})},onFailure:function(e){o.reject(e)}};a._getComputeIsrJobStatus(t)},onFailure:function(e){o.reject(e)}};a._computeIsr(l)}):o.reject("KO"),o.promise}}}),define("DS/DMUwebR3Mctrl/DMUwebR3Mctrl",["UWA/Class","UWA/Core","UWA/Utils/InterCom","DS/DMUwebR3Mux/DMUwebR3Mlist","DS/ENOXTriptych/js/ENOXTriptych","DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/utils/EditPropUtils","DS/DMUwebR3Mutils/DMUwebR3MserverRequests","DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils","DS/CoreEvents/ModelEvents","DS/PlatformAPI/PlatformAPI","DS/DMUwebR3Mutils/DMUwebR3MCsiServices","i18n!DS/DMUwebR3Mctrl/assets/nls/DMUwebR3Mctrl.json","css!DS/DMUwebR3Mux/assets/css/DMUwebR3Mux","UWA/Utils/Client"],function(e,t,n,i,a,o,r,s,l,d,c,u,p,f,g){"use strict";function m(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function h(e){return new Promise(function(e,t){require("DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices").getPlatformServices({onComplete:function(t){e(t[0]["3DDashboard"])},onFailure:t})}).then(function(t){if(e){e.content.source=d.getWidget().data.appId,e.content.data.items.forEach(function(e){e.contextId=d.getSecurityContext().replace("ctx::","")});var n=d.getWidget().data.appId;return function(e){var t,n=document.createElement("textarea");if(n.classList.add("bookmark-txt-link"),n.value=e,document.body.appendChild(n),g.Platform&&g.Platform.hasOwnProperty("ios")&&!0===g.Platform.ios){n.contentEditable=!0,n.readOnly=!0;var i=document.createRange();i.selectNodeContents(n);var a=window.getSelection();a.removeAllRanges(),a.addRange(i),n.setSelectionRange(0,n.value.length)}else n.select();try{t=document.execCommand("copy")}catch(e){window.console.log(e)}return document.body.removeChild(n),t?1:0}(t+("#app:"+n+"/content:X3DContentId=")+encodeURIComponent(JSON.stringify(e.content)))}})}var y=e.extend({init:function(e){let g,y,v,w,S,b,I,M,C,D=new c,x=e.parent,P={},_={},E=m(),R=0,O=[],j=[],k={all:[],pending:[],completed:[],timeout:[],running:[]},F=[],A=[],V=Object.freeze({rvw:1,isr:1,msr:1,mkp:0,owner:0,released:0,obsolete:0,myselection:0});function T(){return t.extend(t.clone(V,!0),JSON.parse(localStorage.getItem("R3MwebPrefs")||"{}"))}function U(){return localStorage.setItem("R3MwebPrefs",JSON.stringify(M))}function N(){var e={onComplete:function(e){e.list.length>=1&&e.list.forEach(function(e){j.push({internalID:e.internalID,status:e.status,startingTime:e.startingTime})})},onFailure:function(){}};p._getListIfJobs(e)}function L(e){if(P[e])return[e];let t=[];return Object.keys(P).forEach(n=>{(function e(t,n){if(n){if(n[t])return 1;if(n.children)return n.children&&n.children[t]?1:Object.keys(n.children).some(i=>e(t,n.children[i]))}})(e,P[n])&&t.push(n)}),t}function W(e){var t=Object.keys(P).length;d.getWidget().setTitle(e?"":0===t?f.noValidObj:f["validObj"+(1===t?"":"s")]+t)}function B(e){if(void 0===e.validState)return;if(e.validStateWarning="",l.getIsrTypes().indexOf(e.type)>-1)"InProgress"===e.validState?"donenoko"!==e.analysisState&&"donewithko"!==e.analysisState||(e.validStateWarning=f.itfwarningAnalyzed):"Failed"===e.validState?"notcomputed"===e.analysisState?e.validStateWarning=f.itfwarningNotComputed:"startednoko"===e.analysisState?e.validStateWarning=f.itfwarningNotAnalyzed:"donenoko"===e.analysisState?e.validStateWarning=f.itfwarningNotReported:"computed"===e.analysisState&&(e.validStateWarning=f.itfwarningComputed):"Passed"===e.validState&&("notcomputed"===e.analysisState?e.validStateWarning=f.itfwarningNotComputed:"startednoko"===e.analysisState||"startedwithko"===e.analysisState?e.validStateWarning=f.itfwarningNotAnalyzed:"donewithko"===e.analysisState?e.validStateWarning=f.itfwarningReported:"computed"===e.analysisState&&(e.validStateWarning=f.itfwarningComputed));else{let t=e.children&&e.children[e.id+"_check"];if(!(t=t&&t.children?Object.keys(t.children).map(e=>_[e]).filter(e=>e):null)||!t.length)return;"InProgress"!==e.validState||t.some(t=>t.validState===e.validState)?"Failed"!==e.validState||t.some(t=>t.validState===e.validState)?"Passed"!==e.validState||t.every(e=>"Passed"===e.validState)||(e.validStateWarning=f.warningpassed):e.validStateWarning=f.warningfailed:e.validStateWarning=f.warninginprogress}}function q(e,t,n){if(!e||!t)return;let i,a=n||t.issue&&t.issue.length&&t.ca&&t.ca.length;return["issue","ca"].forEach(n=>{if(!t[n]||!t[n].length)return;i=!0;let o=e.children||(e.children={});if(a){let i=e.id+"_"+n;o[i]={id:i,title:f[n+(t[n].length>1?"s":"")],children:{}},o=o[i].children}t[n].forEach(e=>{o[e.id]=e}),delete t[n]}),!n&&a&&(e.noSort=!0),i}function X(e){var t,n=[],i=[],a=[],o=[],r=[],s=l.getRvwTypes(),d=l.getIsrTypes(),c=l.getMkpTypes(),u=l.getMsrTypes(),p=l.getNewMkpTypes();Object.keys(e).forEach(function(e){t=this[e].type,s.indexOf(t)>-1?n.push(e):d.indexOf(t)>-1?i.push(e):c.indexOf(t)>-1?a.push(e):p.indexOf(t)>-1?o.push(e):u.indexOf(t)>-1&&r.push(e)},e);var g={rvwIds:n,isrIds:i,mkpIds:a,newMkpIds:o,msrIds:r};l.navigate(g).then(function(e){var t={};[0,1,2,3,4].forEach(function(e){Object.keys(this[e]).forEach(function(e){let n=P[e];if(!n)return void window.console.log("id: "+e+" not in validated objects list");let i=["validated","check","highlight","issue","ca"].some(t=>this[e][t]&&this[e][t].length);["context","validated","check","highlight"].forEach(function(t){if(!this[t]||!this[t].length)return;"context"===t&&(this[t]=this[t].filter(e=>"Specification Report"!==e.type));let a=n.children||(n.children={});if(i){let n=e+"_"+t;a[n]={id:n,title:f[t+(this[t].length>1?"s":"")],children:{}},"validated"===t&&(a[n].validatedPath=this.validatedPath),"highlight"===t&&this[t].forEach(e=>q(e,e,!1)),a=a[n].children}this[t].forEach(function(e){a[e.id]=P[e.id]||e}),delete this[t]},this[e]),q(n,this[e],!0),function e(t){t&&t.id&&(_[t.id]||(_[t.id]=t),Object.keys(t.children||{}).forEach(n=>e(t.children[n])))}(n),B(n),i&&(n.noSort=!0),t[e]=n},this[e])},e),y.updateValidations(t)})}function z(){b&&b.dialog&&b.dialog.destroy(),b=null,I&&I.clean(),I=null,O&&O.forEach(e=>e.cancel()),O=[],d.perfoMark("refreshGrid_"+ ++R);const e=t.createElement("div",{class:"r3mLoadingValidations mask wux-datagridview-emptycontentmessage"}).inject(x),n=t.createElement("div",{class:"spinner spinner-lg spinning fade in",styles:{display:"flex","justify-content":"center"}}).inject(e);t.createElement("span",{class:"spinner-bar"}).inject(n),t.createElement("span",{class:"spinner-bar spinner-bar1"}).inject(n),t.createElement("span",{class:"spinner-bar spinner-bar2"}).inject(n),t.createElement("span",{class:"spinner-bar spinner-bar3"}).inject(n),t.createElement("div",{class:"r3mWelcomeText",html:f.validationLoad,styles:{}}).inject(e),W(!0),P={},_={},A=[],k={all:[],pending:[],completed:[],timeout:[],running:[]},F=[],j=[];var i=d.getWidget(),a=d.getDatafromContent(),o={};(0!==Object.keys(a).length&&i.data&&!i.data.loadDataFromCopiedLink||0!==Object.keys(a).length&&1===M.myselection)&&(o=Object.freeze({rvw:1,isr:1,msr:1,mkp:1}));const r=l.search(0!==Object.keys(o).length?o:M,function(t,n){_=Object.assign(_,t),0===n&&y.removeAll();var o,s={},l=[],c=[];a&&0===Object.keys(a).length?localStorage.removeItem("R3MFromCopylink"):a.obj&&Array.isArray(a.obj)&&a.obj.forEach(function(e){e.objectType&&"DMUValidationExposedPresentation"===e.objectType&&l.push(e.objectId)}),(o=l,new Promise(function(e){o&&o.length>0?require("DS/WAFData/WAFData").authenticatedRequest(d.get3DSpaceUrl()+"/resources/validation/service/getValidationsFromObjectsIds?tenant="+d.getPlatformId(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:d.getSecurityContext()},data:JSON.stringify({listHighlights:o}),timeout:6e4,onComplete:function(t){let n=JSON.parse(t);e(n)},onFailure:function(){e()},onTimeout:function(){e()}}):e()})).then(n=>{var o=[];(0!==Object.keys(a).length&&i.data&&!i.data.loadDataFromCopiedLink||1===M.myselection)&&(M=T(),i.data.loadDataFromCopiedLink=!0,M.myselection=1,U(),n&&n.validations&&n.validations.length>0&&n.validations.forEach(function(e){t.hasOwnProperty(e.id)&&(c[e.id]=s[e.id]=t[e.id],o.push(e.id))}),a.obj&&a.obj.length>0&&a.obj.forEach(function(e){t.hasOwnProperty(e.objectId)&&(s[e.objectId]=t[e.objectId],o.push(e.objectId))}),localStorage.setItem("R3MFromCopylink",1)),P=s&&0===Object.keys(s).length?Object.assign(P,t):s,localStorage.setItem("r3mValidationObjects",JSON.stringify(P)),y.updateValidations(s&&0===Object.keys(s).length?t:s),y.checkFilterAndFetchValue(),X(s&&0===Object.keys(s).length?t:s),W(),y.expanReviewNode(c,n),r.promise.finally(function(){e.destroy(),d.perfoMeasure("refreshGrid_"+this)}.bind(R)),O.push(r)})});N()}function J(e,t){function n(e,t){return e.some(function(e){return t.length===e.length&&e.every(function(e,n){return e===t[n]})})}y.getSelectedRows().forEach(function(i){if(!i||!i.id||!_[i.id])return void window.console.error("Unidentified object");let a;(a=i.id.search("_")>-1?Object.values(_[i.id].children):[_[i.id]]).forEach(function(i){var a;i.validatedPath&&i.validatedPath.length>2?(a=i.validatedPath.map(function(e){return t[e.pid]||(t[e.pid]={type:e.type}),e.pid}),n(e,a)||e.push(a)):(t[i.pid||i.id]||(t[i.pid||i.id]={type:i.type}),a=[i.pid||i.id],n(e,a)||e.push(a))})})}function K(e,t,n){t.forEach(function(t){e.push({envId:d.getPlatformId(),serviceId:"3DSpace",contextId:d.getSecurityContext(),objectId:t[t.length-1],objectType:n[t[t.length-1]].type,path:t.length>2?t.map(function(e){return{resourceid:e,type:n[e].type}}):void 0})})}function Q(e,t){var n={protocol:"3DXContent",version:"1.0",source:d.getWidgetAppId(),data:{items:[]}};return K(n.data.items,e,t),n}function G(e){var t,i=[],a={};if(J(i,a),t=i.map(function(e){var t=e[e.length-1],n=a[t].type,i={getID:function(){return t},tenant:d.getPlatformId(),type:n};return e.length>2&&(i.getRelationID=function(){return e[e.length-2]}),s.getModelFromSelectedNode(i)}),g.getRightOpen()&&v.initDatas(t),!e){var o={version:"1.1",paths:i,attributes:a,tenant:d.getPlatformId()},r={uid:m(),originUid:E,timestamp:Date.now(),appid:d.getWidgetAppId(),originWidgetId:d.getWidgetId()};u.publish("DS/PADUtils/PADCommandProxy/select",{data:o,metadata:r}),w||(S=d.getWidgetAppId()+"_CompassSocket_"+d.getWidgetId(),(w=new n.Socket(S)).subscribeServer("com.ds.compass",window.parent)),i.length?w.dispatchEvent("onSetX3DContent",Q(i,a),S):w.dispatchEvent("onResetX3DContent",{},S)}}function H(){G()}function Z(){G()}function Y(e){var t;["rvw","isr","mkp","msr","owner","released","obsolete","myselection"].forEach(function(n){e[n]!==M[n]&&(t=!0,M[n]=e[n])}),t&&(z(),U())}function $(){var e=g.getRightOpen();D.publish({event:e?"triptych-hide-panel":"triptych-show-panel",data:"right"}),y.setInfoState(!e),e||G(!0)}function ee(){var e=[],t={};return J(e,t),e.filter(e=>!(e&&1===e.length&&t[e[0]]&&"DMUValidationCheck"===t[e[0]].type))}function te(){let e=y.getSelectedRows(),t=[];return e.length&&1===e.length&&e.forEach(e=>{var n;if(e.parents&&e.parents.length>0&&e.parents[0].contains("_highlight"))n=e.parents[1]?e.parents[1]:"";else{let t=P[e.id];n=t&&-1!==l.getRvwTypes().concat(l.getIsrTypes().concat(l.getMkpTypes()).concat(l.getNewMkpTypes()).concat(l.getMsrTypes())).indexOf(t.type)&&t.id}n&&t.push({physicalid:n,tenant:d.getPlatformId()})}),t}function ne(){var e={protocol:"3DXContent",version:"1.1",data:{items:[]},source:d.getWidgetAppId(),widgetId:d.getWidgetId()},t=[],n={};J(t,n),K(e.data.items,t,n);var i=h({content:e});require(["DS/PADUtils/views/PADAlert"].concat([]),function(e){i?e.displayNotification({msg:f.replace(f.copyLinkSuccess,{label:_[t[0]].title}).replace(/"/g,"'"),eventID:"success"}):e.displayNotification({msg:f.copyLinkError,eventID:"error"})})}function ie(){var e=t.Promise.deferred();return require(["DS/PIMwebPropertiesTabs/PIMwebIsrPropInfo"].concat([]),function(t){let n=y.getSelectedRows(),i=[];n.forEach(e=>{var t;let n=P[e.id];(t=n&&-1!==l.getIsrTypes().indexOf(n.type)&&n.id)&&i.push(t)});let a=require("DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils"),o={requestUtils:{get3DSpaceUrl:a.get3DSpaceUrl,getPlatformId:a.getPlatformId,getSecurityContext:a.getSecurityContext,getLang:a.getLang},isrIDs:i};t.getSpecInfo(o).then(function(t){let n=0===t.length?1:0;t.forEach(e=>{let t=Boolean(e.checkFasteners)||Boolean(e.pathwayItfs)||Boolean(e.electricalItfs)||"on"===e.specRule||"on"===e.specMCX,i=Boolean(e.volumeQuantifier)||2===e.clashGeometryStorage||3===e.clashGeometryStorage||2===e.clearanceGeometryStorage||3===e.clearanceGeometryStorage;n+=t&&i?3:t||i?2:1}),e.resolve(n)})}),e.promise}function ae(){if(!p._isUpdateSimulationAllowed())return 0;let e=1,t=y.getSelectedRows();if(t.length){let n=[];if(t.forEach(e=>{var t;let i=P[e.id];(t=i&&-1!==l.getIsrTypes().indexOf(i.type)&&i.id)&&n.push(t)}),n.length>=1){(function(e){var t=[];return e.forEach(e=>{let n=j.filter(t=>t.internalID===e);if(n.length>=1){let i=n.reduce((e,t)=>e&&e.startingTime>t.startingTime?e:t);t.push({id:e,status:i.status})}else t.push({id:e,status:"succeeded"})}),t})(n).filter(e=>"running"===e.status||"pending"===e.status).length>=1&&(e=2)}}return e}function oe(e,t,n,i){e.analysisState=t,e.analysisStateDisp=l.getAnalysisStateNlsValue(t),e.analysisStateNbKO=n;let a={};B(e),a[e.id]=e,y.updateValidations(a,i)}function re(){var e=[];J(e,{}),e.length&&e.forEach(e=>{p._computeItfSimulation({isrID:e[0],app:"R3M",platformId:d.getPlatformId()}).then(function(){let t=P[e[0]];t&&(j.push({internalID:e[0],status:"running",startingTime:Math.floor(Date.now()/1e3)}),oe(t,"Running",0))})})}function se(){require(["DS/TransientWidget/TransientWidget"].concat([]),function(e){var t=[],n={};J(t,n),e.showWidget("ENORIPE_AP","",{X3DContentId:JSON.stringify(Q(t,n))},{mode:"panel",width:700,height:800})})}function le(){let e=y.getSelectedRows();if(!e.length)return;let t=[];return e.forEach(e=>{let n=P[e.id],i=n&&-1!==l.getRvwTypes().concat(l.getIsrTypes()).indexOf(n.type)&&n.id;i&&t.push({physicalid:i,tenant:d.getPlatformId()})}),t}function de(){require(["DS/MaturityWidget/MaturityWidget"].concat([]),function(e){b&&b.dialog&&b.dialog.destroy(),(b=new e({externalSettings:d.getPlatformIdServices()})).addEvent("onMaturityCanceled",()=>{b=null}),b.addEvent("onMaturityTransitionEnd",e=>{if(!e||!e.data)return;let t={},n=[];e.data.forEach(e=>{let i=P[e.physicalid];if(!i)return;i.maturityDisp=l.getMaturityNlsValue(i.maturity="VPLM_SMB_Evaluation."+e.tostate);let a=e.tostate.toLowerCase();"released"===a&&!M.released||"obsolete"===a&&!M.obsolete?n.push(e.physicalid):t[e.physicalid]=i}),u.publish("DS/DMUwebR3Mctrl/R3MObjectModified",{modified:"maturity",data:P}),localStorage.setItem("r3mValidationObjects",JSON.stringify(P)),y.updateValidations(t),y.removeValidation(n)}),b.executeCmd(le(),{context:{getSecurityContext:()=>({SecurityContext:d.getSecurityContext()})}},()=>{})})}function ce(e){l.getFeatureStateInfo(e).then(t=>{let n=P[e.validatedObjId];if(n.children[e.text]&&n.children[e.text].children){let i=n.children[e.text].children[e.objectId];if(i){i.dateCreat=t.result[0].grid["ds6w:created"],i.dateModif=t.result[0].grid["ds6w:modified"],i.icon=t.result[0].icon,i.ownerid=t.result[0].grid.owner,i.owner=t.result[0].grid["ds6w:responsible"],i.title=t.result[0]["ds6w:label"],i.type=t.result[0].type;let e={};e[i.id]=i,y.updateValidations(e,!1,!0)}}})}function ue(e){-1===F.indexOf(e[0])&&(l.evalIssueCells(e,function(t,n){if(0===t.results.length){let t={r3mIssueApprovals:"",r3mIssueAssignees:"",r3mIssueResolvedBy:""},n={};n[e[0]]=t,y.updateValidations(n,!1,!0)}t.results.forEach(function(e){let t=e.body,i={},a={};i.r3mIssueApprovals=!("Unassigned"===t.waitingOn||""===t.waitingOn);var o=[];t.assignees.forEach(function(e){o.push({label:e.fullName,url:n[e.user]})}),i.r3mIssueAssignees=o.length>=1?o:"",i.r3mIssueResolvedBy=0===t.resolvedBy.length?"No":"Yes("+t.resolvedBy.length.toString()+")",i.r3mIssuePriority=t.priority,a[t.physicalId]=i,y.updateValidations(a,!1,!0)});let i=F.indexOf(e[0]);i>-1&&F.splice(i,1)}),F.push(e[0]))}function pe(e){-1===A.indexOf(e[0])&&(l.evalMetricIssueCells(e,function(t){let n;if(Object.keys(t.issues).length>0){if(P[e[0]].children||(P[e[0]].children={}),!P[e[0]].children[e[0]+"_issue"]){let t=Object.keys(P[e[0]].children);if(1===t.length&&"VPMReference"===P[e[0]].children[t[0]].type){let i=P[e[0]].children[t[0]];P[e[0]].children={},n=i.id,P[e[0]].children[e[0]+"_context"]={id:e[0]+"_context",title:"Context",children:{childNodeId:i}}}P[e[0]].children[e[0]+"_issue"]={id:e[0]+"_issue",title:"Issues",children:{}}}Object.assign(P[e[0]].children[e[0]+"_issue"].children,t.issues),1===Object.keys(P[e[0]].children[e[0]+"_issue"].children).length&&(P[e[0]].children[e[0]+"_issue"].title="Issue");var i={};i[e[0]]=P[e[0]],y.deleteNodes(e[0],n),y.updateValidations(i,!1,!1,!0)}}),A.push(e[0]))}function fe(e){let t=P[e[0]];if(t&&0===t.executionState)return void oe(t,"notcomputed",0);function n(e){let t=k.pending.indexOf(e);if(t>-1&&k.pending.splice(t,1),-1===(t=k.completed.indexOf(e))&&k.completed.push(e),(t=k.running.indexOf(e))>-1&&k.running.splice(t,1),k.pending.length>0){let e=k.running.length;k.pending.forEach(function(t){(0===k.running.length||k.running.length>0&&k.running.indexOf(t))&&(fe([t]),e+=1)})}}function i(e,t,n){let i=P[e];if(i){i.analysisStateProgress=Math.ceil(n/t*100);let e={};e[i.id]=i,y.updateValidations(e,!1)}}function a(e){let t="error",i=0;if("timeout"===e.status)n(e.simIds[0]);else if("failure"!==e.status&&Array.isArray(e.output))e.output.forEach(function(e){let n=e.nbTotalItf,a=e.nbOK,o=e.nbKO,r=e.nbTotalItf-(e.nbKO+e.nbOK),s=e.simPid;"0"===e.ExecStatus?t="notcomputed":a===n?t="donenoko":r&&o?(t="startedwithko",i=o):r&&0===o&&a?t="startednoko":r&&0===o&&0===a?(t="computed",i=n):n===o+a?(t="donewithko",i=o):t="startednoko",P[s]&&P[s].analysisState!==t&&(oe(P[s],t,i),y.updateStatusBar(P[s].id,"success"))}),n(e.output[0].simPid);else{let a=e.simIds?e.simIds[0]:"";P[a]&&P[a].analysisState!==t&&(oe(P[a],t,i),y.updateStatusBar(P[a].id,"failure")),n(e.simIds[0])}}let o=e[0];for(-1===k.all.indexOf(o)&&k.all.push(o),-1===k.pending.indexOf(o)&&k.pending.push(o);k.running.length<4&&-1===k.running.indexOf(o);){let e=P[o];if(!e)return;let n=l.getIsrTypes(),r=e.type;if(n.indexOf(r)>-1&&("unknown"===e.analysisState&&oe(e,"running",0,!0),-1===k.running.indexOf(o)))if(k.running.push(o),p._isUpdateSimulationAllowed()){let n=j.filter(e=>e.internalID===t.id);if(n.length>=1){let t=n.reduce((e,t)=>e&&e.startingTime>t.startingTime?e:t);"running"!==t.status&&"pending"!==t.status?l.evalAnalysisStatus(e,a,i):oe(e,"Running",0)}else l.evalAnalysisStatus(e,a,i)}else l.evalAnalysisStatus(e,a,i)}}function ge(){const e=e=>!e.restrictedEditionDisp||"Activated"!==e.restrictedEditionDisp||!(!(e=>{let t=window.widget.getValue("xPref_CREDENTIAL"),n=t.split(".");t=n[0]?n[0]:"";return d.getUserLogin()===e.ownerid||["VPLMProjectLeader","VPLMAdmin"].includes(t)})(e)||"In Work"!==e.maturityDisp);let t=y.getSelectedRows();if(1!==t.length)return;let n=[];return t.forEach(t=>{let i=P[t.id],a=i&&(-1!==l.getRvwTypes().indexOf(i.type)||-1!==l.getIsrTypes().indexOf(i.type))&&i.id;if(!a)return;let o=i.validState;o="Failed"===o?"failed":"Passed"===o?"passed":"inProgress";let r=-1!==l.getIsrTypes().indexOf(i.type);const s=e(i);n.push({title:i.title,physicalid:a,status:o,isrType:r,display:s})}),n}function me(e,t){let n=P[e];return n.validState="passed"===t?"Passed":"failed"===t?"Failed":"InProgress",n.validStateDisp=l.getValidStateNlsValue(n.validState),B(n),n}function he(){require(["DS/CATWebUXCVS/CATWebUXCVSComponent"].concat([]),function(e){I&&I.clean(),I=null;let t=ge();t&&1===t.length&&(t=t[0],I=new e({title:t.title,physicalId:t.physicalid,current:t.status,isrType:t.isrType,parent:x,platformSettings:d.getPlatformIdServices(),tenant:d.getPlatformId(),securityContext:{getSecurityContext:()=>({SecurityContext:d.getSecurityContext()})},onChangeValidationStateCompleted:function(e){if(P[t.physicalid].validState=e.sValidationState,u.publish("DS/DMUwebR3Mctrl/R3MObjectModified",{modified:"validationState",data:P}),localStorage.setItem("r3mValidationObjects",JSON.stringify(P)),I&&I.clean(),I=null,!e)return;let n=me(t.physicalid,e.sValidationState);n&&y.updateValidations({[t.physicalid]:n})},onChangeValidationStateClose:function(){I&&I.clean(),I=null},onChangeValidationStateFailure:function(){I&&I.clean(),I=null}}))})}M=T(),N(),W(),d.onTenantModified(e=>{C||(C=!0,y.removeAll(),e.then(()=>{C=!1,z()}))}),l.onTenantModified(()=>{l.getColumnsNls().then(y.onTenantModified)}),d.getWidget().addEvent("onRefresh",function(){var e=d.getWidgetData();Object.keys(e).length>0&&(window.widget.data=e,window.widget.data.loadDataFromCopiedLink=!1),C||z()}),u.subscribe("DS/PADUtils/PADCommandProxy/validationState",e=>{const{validationId:t,checkId:n,checkStatus:i}=e,a=P[t];let o=a.children&&a.children[`${a.id}_check`];o&&o.children[n]&&(o.children[n].validState=i,o.children[n].validStateDisp=i),me(t,a.validState.toLowerCase())}),this.buildUX=function(){return g?Promise.resolve():new Promise(function(e){var n=t.createElement("div",{class:"r3mMainView",styles:{width:"100%",height:"100%"}}),s=t.createElement("div",{class:"r3mRightView"});function c(e){e.stopPropagation()}function u(e,t){if(!y||!t)return!1;var n={protocol:"3DXContent",version:"1.1",data:{items:[]},source:d.getWidgetAppId(),widgetId:d.getWidgetId()},i=[],a={};return J(i,a),K(n.data.items,i,a),e.dataTransfer.setData("Text",JSON.stringify(n)),!1}s.style.height="100%",(g=new a).init({withtransition:!0,container:this,right:{withClose:!1},modelEvents:D},null,n,s),l.getColumnsNls().then(t=>{(y=new i({parent:n,onSelect:H,onUnselect:Z,getFilterValues:function(){return Object.assign({},M)},getIsrTypes:function(){return l.getIsrTypes()},getFeatureStateInfo:ce,onFiltersModified:Y,onInfo:$,allowRelations:ee,allowCopyLink:te,onCopyLink:ne,onRelations:se,allowMaturityState:le,onMaturityState:de,onAnalysisState:fe,onMetricIssue:pe,onIssueCells:ue,allowValidationState:ge,allowUpdateSimulation:ae,getCSIcomputeToken:ie,onValidationState:he,onUpdateSimulation:re,columns:t,cbDnD:{onDragStartCell:u,onDragOverCell:c,onDragEnterBlank:c,onDragOverBlank:c,onDragStartRowHeader:u,onDragOverRowHeader:c}}))&&y.checkFilterAndFetchValue(),(v=new o({className:"r3mProperties",setEditButton:!0,readOnly:!1,setCloseButton:!0,typeOfDisplay:r.ALL,displayType:r.STANDARD,selectionType:r.NO_SELECTION,multiselection:r.MULTISEL_STD,collapseTabs:!1,appId:"ENOR3M_AP",actions:[{name:"closeSidePanel",text:f.closeSidePanel,icon:"close",handler:function(){D.publish({event:"triptych-hide-panel"}),y.setInfoState(!1)}}]}).inject(s)).initDatas([]);let a=require("DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils"),d={requestUtils:{get3DSpaceUrl:a.get3DSpaceUrl,getPlatformId:a.getPlatformId,getSecurityContext:a.getSecurityContext,getLang:a.getLang},onFacetModification:function(e){let t=[];Object.keys(e||{}).forEach(function(e){let n=_[e];n&&Object.keys(this[e]||{}).forEach(function(i){let a;"sValidationState"===i?(a=!0,me(e,this[i])):"iCheckState"===i?(a=!0,l.updateCheckStateValue(this[i],n)):"title"!==i&&"description"!==i||(a=!0,n[i]=this[i]),a&&-1===t.indexOf(e)&&t.push(e)},this[e])},e);let n={};t.forEach(e=>{L(e).forEach(e=>{n[e]||(n[e]=P[e])})}),y.updateValidations(n)}};v.addFacets([{position:1,require:"DS/PIMwebPropertiesTabs/PIMwebIsrPropContextTab",supportMerge:!0,options:d,facet:{name:"interference_context",text:f.context,icon:"6w-what"}},{position:2,require:"DS/PIMwebPropertiesTabs/PIMwebIsrPropSpecTab",supportMerge:!0,options:d,facet:{name:"interference_specification",text:f.specifications,icon:"6w-how"}},{position:1,require:"DS/DMUReviewFacets/DMUwebR3MinfoRvwCheckTab",supportMerge:!0,options:d,facet:{name:"review_check",text:f.checks,icon:"check-review"}},{position:2,require:"DS/DMUReviewFacets/DMUwebR3MinfoRvwHighlightTab",supportMerge:!0,options:d,facet:{name:"review_highlight",text:f.highlights,icon:"highlight-review"}}]),e()})}.bind(this))}.bind(x),this.refresh=z,this.destroy=function(){window.console.error("TODO!!")}}}),v=[],w=function(e){return e&&e.id?(v.some(function(n){return n.id===e.id&&(t=n.enveloppe)}),t):null;var t};return Object.freeze({giveCtrl:function(e){return w(e)},getCtrl:function(e){if(!e||!e.id)return null;var t=w(e);if(!t){var n=new y({parent:e.parent}),i={buildUX:function(){return n?n.buildUX.apply(null,arguments):null},refresh:function(){return n?n.refresh.apply(null,arguments):null},destroy:function(){n&&(n.destroy.apply(null,arguments),n=null,v.some(function(e,t){if(e.enveloppe===i)return v.splice(t,1),i=null,!0}))}};Object.freeze(i),v.push({id:e.id,enveloppe:i}),t=i}return t}})});