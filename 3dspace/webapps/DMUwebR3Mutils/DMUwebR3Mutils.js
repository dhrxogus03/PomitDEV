/*!  Copyright 2021 Dassault Systemes. All rights reserved. */
define("DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils",["DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI","i18n!DS/DMUwebR3Mutils/assets/nls/DMUwebR3Mutils.json"].concat([]),function(e,t,i){"use strict";var n,o,r,a,s,u,l,c=[];function d(){return n&&n.lang||"en"}function p(){if(!n)throw new Error("App init not done");return r||(r=n.getValue("x3dPlatformId")),r}function f(){if(!n)throw new Error("App init not done");return a||(a=n.getValue("xPref_CREDENTIAL")),"ctx::"+a}function m(e){var t,i=p();if(!Array.isArray(o))throw new Error("Platform services not initialize yet");return o.some(function(n){if(n&&n.platformId===i)return t=n[e]}),t}function g(){return m("3DSpace")}function v(t){let i=g();if(!i)return void t.onCompleted(!1);let o=new Promise(function(e){require(["DS/ENOXWidgetPreferences/js/ENOXWidgetPreferences"].concat([]),function(t){t.addCredentialPreferenceToWidget({usePreferredCredentials:!0},2).then(function(){f();let t=n.getPreferences(),i=[];t.length>1&&"xPref_CREDENTIAL"===t[0].name&&(i.push(t[1]),i.push(t[0]),n.setPreferences(i)),e(!0)})},e.bind(null,!1))}),r=new Promise(function(t){i+="/resources/modeler/pno/person?current=true&select=preferredcredentials",e.authenticatedRequest(i,{method:"GET",type:"json",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":d()},onComplete:function(e){e&&e.preferredcredentials?(s=e.preferredcredentials.organization,t(Boolean(s))):t(!1)},onFailure:function(){t(!1)}})});Promise.all([o,r]).then(function(e){t.onCompleted(e[0]&&e[1])})}return Object.freeze({init:function(e){return n?Promise.resolve():new Promise(function(t){n=e.widget,l=e.widget.data,u=n.id+"_R3M_",p(),f(),n.setPreferences([]),require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(a){a.getPlatformServices({onComplete:function(s){a.getAppInfo({appId:n.getValue("x3dAppId"),onComplete:function(a){if(o=s,a.tenantAware){o=[];for(var u=0;u<a.platforms.length;++u)for(var l=0;l<s.length;++l)if(s[l].platformId===a.platforms[u].id){o.push(s[l]);break}}if(o&&o.length){var c=p();o.some(function(e){return e.platformId===c})||(r=c="",o.length&&(n.setValue("x3dPlatformId",o[0].platformId),c=p())),c&&o.length>1&&n.addPreference({name:"x3dPlatformId",type:"list",label:i.x3dPlatformId,options:o.map(function(e){return{label:e.displayName,value:e.platformId}}),defaultValue:c}),e.onCompletedPlatformServices({success:Boolean(c)||"tenant"}),v({onCompleted:()=>{e.onCompletedSecurityContext(),t()}})}else e.onCompletedPlatformServices({success:"platformServices"})},onFailure:function(){e.onCompletedPlatformServices({success:"getAppInfo"}),t()}})},onFailure:function(){e.onCompletedPlatformServices({success:"getPlatformServices"}),t()}})}),n.addEvent("endEdit",()=>{let e=n.getValue("x3dPlatformId"),t=e!==r;if(r=e,a=n.getValue("xPref_CREDENTIAL"),t){let e=new Promise(e=>{setTimeout(()=>v({onCompleted:e}),0)});c.forEach(t=>t(e))}})})},getWidget:function(){return n},getWidgetId:function(){return n.id},getWidgetAppId:function(){return n.getValue("x3dAppId")},getLang:d,getUserLogin:function(){var e=t.getUser();return e?e.login:""},getUserOrganizationName:function(){return s?s.name:""},getPlatformId:p,getPlatformIdServices:function(){return JSON.parse(JSON.stringify(o.filter(e=>e.platformId===r)))},get3DSpaceUrl:g,get3DSearchUrl:function(){return m("3DSearch")},get3DSwymUrl:function(){return m("3DSwym")},getR2VPlatformUrl:function(){return m("r2vsurvey")},getSecurityContext:f,getDatafromContent:function(){if(!n)throw new Error("App init not done");var e={},t=[];if(void 0===n.data.X3DContentId)return e;var i=JSON.parse(n.data.X3DContentId);return i.data&&i.data.items&&i.data.items.forEach(function(e){t.push({objectId:e.objectId,objectType:e.objectType})}),e.obj=t,e},getWidgetData:function(){return l},onTenantModified:function(e){c.push(e)},perfoMark:function(e){window.top.performance.mark(u+e)},perfoMeasure:function(e,t){window.top.performance.measure(u+(t||e),u+e)}})}),define("DS/DMUwebR3Mutils/DMUwebR3McancelablePromise",[],function(){"use strict";return function(e){let t=!1,i=()=>{t=!0};const n=new Promise((n,o)=>{i=(()=>{t||n("Promise cancelled")}),t?i():e(n,o)});return n.then(e=>(t=!0,e)),n.catch(e=>(t=!0,e)),{promise:n,cancel:i}}}),define("DS/DMUwebR3Mutils/DMUwebR3MserverRequests",["DS/WAFData/WAFData","DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/DMUwebR3Mutils/DMUwebR3McancelablePromise","UWA/Core","i18n!DS/DMUwebR3Mutils/assets/nls/DMUwebR3Mutils.json"].concat([]),function(e,t,i,n,o,r){"use strict";let a,s,u,l,c,d=["ds6w:label","ds6w:identifier","ds6w:type","ds6w:status","ds6wg:dmuvalidationvalidation.v_validationstate","ds6wg:dmuvalidationvalidation.V_Validation_RestrictedEdition","bo.SIMItfSimulation.V_ValidationState","ds6wg:simitfsimulation.v_itf_executionstatus","ds6w:description","ds6w:responsible","ds6w:responsibleuid","ds6w:originator","originator","ds6w:organizationResponsible","ds6w:modified","ds6w:created","ds6w:project"],p=["ds6w:label","ds6w:identifier","ds6w:type","ds6w:status","ds6wg:dmuvalidationcheck.v_validation_checkstate","bo.SIMItfSimulation.V_ValidationState","ds6w:description","ds6w:responsible","ds6w:responsibleuid","ds6w:originator","originator","ds6w:organizationResponsible","ds6w:modified","ds6w:created","ds6w:project","ds6w:priority"],f=["icon"],m=200,g={"ds6w:label":"title","ds6w:identifier":"name","ds6w:type":"type","ds6w:status":"maturity","ds6wg:dmuvalidationvalidation.v_validationstate":"validState","ds6wg:dmuvalidationvalidation.V_Validation_RestrictedEdition":"validState","ds6wg:dmuvalidationcheck.v_validation_checkstate":"validState","bo.SIMItfSimulation.V_ValidationState":"validState","ds6wg:simitfsimulation.v_itf_executionstatus":"executionstate","ds6w:description":"description","ds6w:responsible":"owner","ds6w:responsibleuid":"ownerid","ds6w:originator":"originator",originator:"originatorid","ds6w:organizationResponsible":"organization","ds6w:modified":"dateModif","ds6w:created":"dateCreat","ds6w:project":"collabSpace",type_icon_url:"icon",resourceid:"id",physicalid:"id","ds6w:priority":"r3mIssuePriority"},v=1,h=0,_=[];function y(e){return e+"-"+t.getUserLogin()+"-"+Date.now()}function S(e){return new Promise(function(n){i.getNlsOfPropertiesValues(JSON.stringify(e),{tenantId:t.getPlatformId(),lang:t.getLang(),apiVersion:"R2019x",onComplete:function(t){Object.keys(t).forEach(function(e){s[e]=Object.assign(s[e]||{},t[e])}),Object.keys(e).forEach(function(t){e[t].forEach(e=>{s[t][e]||(s[t][e]=e)})}),e["ds6w:status"]&&Object.keys(s["ds6w:status"]).forEach(e=>{e.search(".DEFAULT")>-1&&(s["ds6w:status"][e]="")}),n()},onFailure:function(){n()}})})}function w(e){if(e){if(l.hasOwnProperty(e))return l[e];var i=t.get3DSwymUrl();return l[e]=i?i+"/api/user/getpicture/login/"+e+"/format/mini":""}}function I(e,t,i){var n={};return Object.keys(e).forEach(function(o){var r=g[o];n[r]=e[o],"ds6w:identifier"===o&&"issue"===i&&(n.r3mIssueName=e[o]),s[o]&&(s[o].hasOwnProperty([e[o]])?n[r+"Disp"]=s[o][e[o]]:(t[o]||(t[o]={values:[],objects:[]}),-1===t[o].values.indexOf(e[o])&&t[o].values.push(e[o]),t[o].objects.push(n)))}),"issue"===i&&(n.r3mIssueAssignees=n.r3mIssueResolvedBy=n.r3mIssueApprovals="running"),n.ownerImg=w(n.ownerid),n.originatorImg=w(n.originatorid),n}function b(e,t,i){return e.map(function(e){return I(e,t,i)})}function P(e,t){if(t)return t.validState="2"===e?"Passed":"3"===e?"Failed":"InProgress",t.validStateDisp=r["validState"+t.validState],t}function M(i){var n={Accept:"application/json","Content-Type":"application/json"};return i.securityContext&&(n.SecurityContext=i.securityContext),e.authenticatedRequest(i.url+"?tenant="+t.getPlatformId()+(i.securityContext?"&SecurityContext="+i.securityContext:""),{method:i.method,type:"json",headers:i.headers?i.headers:n,data:JSON.stringify(i.data),timeout:i.timeout,onComplete:i.onComplete,onFailure:i.onFailure,onTimeout:i.onTimeout||i.onFailure})}function D(i){if(i){var n=o.clone(i.config,!1);n.onComplete=i.onSuccess,n.onFailure=i.onFailure,n.method=n.verb,n.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang(),SecurityContext:t.getSecurityContext()},"object"==typeof n.data&&(n.data=JSON.stringify(n.data));var r=[];r.push("securityContext"),r.push(t.getSecurityContext()),r.push("tenant"),r.push(t.getPlatformId()),e.authenticatedRequest(t.get3DSpaceUrl()+"/"+i.url,n)}}function C(e){return{input_physical_ids:e,label:y("R3MwebIsr"),primitives:[{navigate_to_rel:{id:1,filter:{bo_type:["dsc_Model_Category_Ref"]}}},{navigate_to_rel:{id:2}},{navigate_to_sr:{id:3,filter:{semantics:["5"],role:["79"]},mode:"last"}},{navigate_to_sr:{id:4,filter:{semantics:["4"],role:["170"]},mode:"last"}},{navigate_from_rel:{id:5,filter:{rel_type:["Reference Document"],bo_type:["Issue"]}}}],patterns:{prd:[{id:1},{id:2},{id:3}],context:[{id:1},{id:2},{id:4}],issue:[{id:5}]},fileAttributes:f,attributes:p,version:3}}function x(e){return{input_physical_ids:e,label:y("R3MwebMkp"),primitives:[{navigate_from_rel:{id:1,filter:{rel_type:["Markup"]}}},{navigate_from_rel:{id:2,filter:{rel_type:["Reference Document"],bo_type:["Issue"]}}}],patterns:{context:[{id:1}],issue:[{id:2}]},fileAttributes:f,attributes:p,version:3}}function R(e){return new Promise(function(i){M({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",data:e,onComplete:function(e){i(e)},onFailure:function(){i({})}})})}function E(e){let i=Object.keys(e);return i.length?new Promise(e=>{M({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",data:function(e){return{input_physical_ids:e,label:y("R3MwebTic"),primitives:[{navigate_from_rel:{id:1,filter:{rel_type:["Reference Document"],bo_type:["Issue"]}}}],patterns:{issue:[{id:1}]},fileAttributes:f,attributes:p,version:3}}(i),onComplete:e,onFailure:function(){e()}})}):Promise.resolve()}const O=e=>new Promise(t=>{"DMUValidationValidation"===e.input_object["ds6w:type"]||"Markup"===e.input_object["ds6w:type"]?D({url:"resources/validation/service/getAll",config:{verb:"POST",data:{sValidationId:e.input_object.physicalid}},onSuccess:function(e){var i=JSON.parse(e);t(i)},onFailure:function(){t()}}):"DMUMarkupRepReference"===e.input_object["ds6w:type"]?D({url:"resources/markup/service/getMarkup",config:{verb:"POST",data:{sMarkupId:e.input_object.physicalid}},onSuccess:function(i){var n=JSON.parse(i);D({url:"/cvservlet/fetch/v2",config:{verb:"POST",data:{physicalid:n.MarkupContext.contextId?n.MarkupContext.contextId:n.MarkupContext.contextIds,label:"M3DFetchForWelcomePanel"+Date.now(),select_predicate:d,select_file:f}},onSuccess:function(i){var o=JSON.parse(i),r=[],a={physicalid:n.MarkupContext.contextId};o.results[0].attributes.forEach(function(e){a[e.name]=e.value}),r.push(a),e.outputs.context=r,t(e)},onFailure:function(){t()}})},onFailure:function(){t()}}):t()});function V(e){return new Promise(function(i){M({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",data:e,onComplete:function(e){var t={},n={},o=[],r=[],a=[],u={};e.result.forEach(function(e){var i=e.input_object.physicalid;t[i]={},["context","highlight","check","issue","ca"].forEach(function(o){e.outputs[o]&&(t[i][o]=b(e.outputs[o],n,o))}),(t[i].highlight||[]).forEach(e=>{u[e.id]=e}),(t[i].check||[]).forEach(e=>P(e.validState,e)),(e.outputs.checked||[]).forEach(function(e){let o=e.owner.physicalid;(t[i].check||[]).some(t=>{if(!t.children)return t.id===o?(t.children=b(e.elements,n),!0):void 0})}),e.outputs.validatedPath&&(t[i].validatedPath=[],e.outputs.validatedPath.forEach(function(e){if(!e.elements.length)return;let n=e.elements[0]["ds6w:type"],a="VPMInstance"===n||"VPMRepInstance"===n;t[i].validatedPath[e.app_index||e.sr_id]=e.elements.map(function(e,t){return a&&(0===t&&-1===o.indexOf(e.physicalid)&&o.push(e.physicalid),-1===r.indexOf(e.physicalid)&&r.push(e.physicalid)),e.pid=e.physicalid,e.type=e["ds6w:type"],e}),t[i].validatedPath[e.app_index||e.sr_id].instancePath=a}),t[i].validatedPath=t[i].validatedPath.filter(function(e){return e&&e.length}),t[i].validatedPath.length&&a.push(t[i])),e.outputs.prd&&(t[i].context=(t[i].context||[]).concat(b(e.outputs.prd,n)))});const l=[];e.result.map(e=>{void 0===e.outputs.context&&l.push(O(e))});const c=[];e.result.map(e=>{void 0===e.outputs.context&&"DMUMarkupRepReference"===e.input_object["ds6w:type"]&&c.push(O(e))}),Promise.all([0===c.length?Promise.resolve():Promise.all(c)]).then(function(e){var c;e[0]&&e[0].forEach(function(e){t[e.input_object.physicalid].context=b(e.outputs.context,n)}),Promise.all([o.length?R((c=o,{input_physical_ids:c,label:y("R3MwebValidFrom"),primitives:[{navigate_from_rel:{id:1}}],patterns:{root:[{id:1}]},fileAttributes:f,attributes:p,version:3})):Promise.resolve(),r.length?R(function(e){return{input_physical_ids:e,label:y("R3MwebValidTo"),primitives:[{navigate_to_rel:{id:1}}],patterns:{ref:[{id:1}]},fileAttributes:f,attributes:p,version:3}}(r)):Promise.resolve(),E(u),0===l.length?Promise.resolve():Promise.all(l)]).then(function(e){var i={},o={},r={};(e[0]&&e[0].result||[]).forEach(function(e){i[e.input_object.physicalid]={pid:e.outputs.root[0].physicalid,type:e.outputs.root[0]["ds6w:type"]},r[e.outputs.root[0].physicalid]||(r[e.outputs.root[0].physicalid]=e.outputs.root[0])}),(e[1]&&e[1].result||[]).forEach(function(e){o[e.input_object.physicalid]={pid:e.outputs.ref[0].physicalid,type:e.outputs.ref[0]["ds6w:type"]},r[e.outputs.ref[0].physicalid]||(r[e.outputs.ref[0].physicalid]=e.outputs.ref[0])}),a.forEach(function(e){e.validated=[],e.validatedPath.forEach(function(t,a){let s;if(t.instancePath){s=I(r[o[t[t.length-1].pid].pid],n);var u=[i[t[0].pid]];t.forEach(function(e){u.push(e),u.push(o[e.pid])}),s.validatedPath=u}else(s=I(t[t.length-1],n)).validatedPath=t;e.validated[a]=s,s.pid=s.id,s.id=String(v++)}),delete e.validatedPath}),(e[2]&&e[2].result||[]).forEach(e=>{let t=e.input_object.physicalid;["issue","ca"].forEach(i=>{e.outputs[i]&&(u[t][i]=b(e.outputs[i],n))})}),(e[3]||[]).forEach(e=>{void 0!==e&&void 0!==e.children&&e.children.forEach(i=>{i&&"DMUValidationContext"===i.type&&void 0===t[e.id].context&&(t[e.id].context=[{id:i.contextId,serviceId:i.serviceID}],t[e.id].validated=[{id:i.contextId,serviceId:i.serviceID}])})})}).then(function(){Object.keys(n).length?new Promise(function(){var e={};Object.keys(n).forEach(function(t){e[t]=n[t].values}),S(e).then(function(){Object.keys(n).forEach(function(e){n[e].objects.forEach(function(t){var i=g[e];t[i+"Disp"]=s[e][t[i]]})}),i(t)})}):i(t)})})},onFailure:function(){i({})}})})}function j(e){var i;M({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",timeout:6e4,data:(i=e.ctxIDs,{input_physical_ids:i,label:y("R3MPIMwebItfCtx"),primitives:[{navigate_to_sr:{id:1,filter:{semantics:["6"],role:["198"]},mode:"last"}},{navigate_to_rel:{id:2}}],patterns:{ms:[{id:1}]},attributes:["ds6w:type","bo.PLMPIMMetricReference.V_Itf_Type","bo.PLMPIMMetricReference.V_Itf_Analysis","bo.SIMItfContextOfInterference.V_Context_Validity_Status"],fileAttributes:[],version:3}),onProgress:e.onProgress,onComplete:e.onComplete,onFailure:e.onFailure})}var A,U,T,k=(A=[],U=0,T=function(e,t){U--,k(),t(e)},function(e){var t,i;e&&A.push(e),A.length&&U<5&&(U++,t=A.shift(),(i=o.clone(t,!1)).onComplete=function(e){T(e,t.onComplete)},i.onFailure=function(e){T(e,t.onFailure)},i.onTimeout=function(e){T(e,t.onTimeout||t.onFailure)},j(i))});function F(e){return{input_physical_ids:e,label:y("R3MPIMwebIsr"),primitives:[{navigate_to_rel:{id:1,filter:{bo_type:["dsc_Result_Category_Ref"]}}},{navigate_to_rel:{id:2}}],patterns:{itfCtxt:[{id:1},{id:2}]},fileAttributes:[],attributes:["ds6wg:simitfsimulation.v_itf_executionstatus"],version:3}}function L(e,i){var n={simPid:e,nbOK:0,nbKO:0};M({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",timeout:6e4,data:F(e),onComplete:function(e){let t=e.result[0];if(!t||0===Object.keys(t.outputs).length)return void i({status:"KO",issues:{}});let o=(t.outputs.itfCtxt||[]).map(function(e){return e.physicalid}),r=[];if(0!==o.length){n.nbTotalItf=o.length;for(var a=Math.floor((o.length-1)/500)+1,s=0,u=[];s<a;)k({ctxIDs:o.slice(500*s,500*(s+1)),type:"MetricIssue",onComplete:function(e){var t=[];e.result.forEach(function(e){if(e.outputs&&e.outputs.ms&&1===e.outputs.ms.length){if(r.indexOf(e.outputs.ms[0].physicalid)>-1)return;r.push(e.outputs.ms[0].physicalid)}t.push(e.input_object.physicalid)}),l({itfIDs:t})},onFailure:function(){}}),s++}else i({status:"KO",issues:{}});function l(e){var t,n,a;u.push.apply(u,e.itfIDs),t=r,n=i,a=u.length/o.length,V(C(t)).then(function(e){let t={};Object.keys(e).forEach(function(i){-1!==Object.keys(e[i]).indexOf("issue")&&e[i].issue.forEach(function(e){t[e.id]=e})}),n({status:"OK",issues:t,completed:parseInt(100*a)})})}},onFailure:function(){}})}function N(e){return new Promise(function(i){M({url:t.get3DSpaceUrl()+"/resources/dictionary/getTypeInfo",method:"POST",data:[e],onComplete:function(t){Object.keys(t).forEach(function(t){-1===u[e].indexOf(t)&&u[e].push(t)}),i()},onFailure:i})})}function B(){return c?Promise.resolve():(l={},a={},s={"ds6w:type":{},"ds6w:status":{},"ds6wg:dmuvalidationvalidation.v_validationstate":{},"ds6w:priority":{}},u={DMUValidationValidation:["DMUValidationValidation"],SIMItfSimulation:["SIMItfSimulation"],Markup:["Markup"],DMUMarkupRepReference:["DMUMarkupRepReference"],DesignSight:["DesignSight"]},Promise.all([N("DMUValidationValidation"),N("SIMItfSimulation"),new Promise(function(e){i.getResourcesInfo(d.join(","),{tenantId:t.getPlatformId(),lang:t.getLang(),apiVersion:"R2019x",onComplete:function(t){(t||[]).forEach(function(e){a[g[e.curi]]=e.label}),a.validState=r.validState,a.analysisState=r.analysisState,a.r3mIssueName=r.r3mIssueName,a.r3mIssueApprovals=r.r3mIssueApprovals,a.r3mIssueAssignees=r.r3mIssueAssignees,a.r3mIssuePriority=r.r3mIssuePriority,a.r3mIssueResolvedBy=r.r3mIssueResolvedBy,e(a)},onFailure:function(){d.forEach(function(e){a[g[e]]=e}),e(a)}})}),S({"ds6w:type":["SIMItfSimulation","DMUValidationValidation","Markup","DMUMarkupRepReference","VPMReference","Requirement","DMUValidationExposedPresentation","Member List","Drawing","ENOStrRefinementSpecification"],"ds6w:status":["VPLM_SMB_Evaluation.PRIVATE","VPLM_SMB_Evaluation.IN_WORK","VPLM_SMB_Evaluation.FROZEN","VPLM_SMB_Evaluation.RELEASED","VPLM_SMB_Evaluation.OBSOLETE","VPLM_SMB_Definition.PRIVATE","VPLM_SMB_Definition.IN_WORK","VPLM_SMB_Definition.FROZEN","VPLM_SMB_Definition.RELEASED","VPLM_SMB_Definition.OBSOLETE"],"ds6w:priority":["Low","Medium","High","Urgent"]})]).then(function(){c=!0}))}t.onTenantModified(()=>{c=!1,B().then(()=>_.forEach(e=>e()))});var J=Object.create({}),W=Object.getPrototypeOf(J);return Object.defineProperty(W,"_NB_SEARCH_RESULTS",{get:()=>m,set:e=>{m=e}}),W.getColumnsNls=function(){return B().then(function(){return a})},W.getRvwTypes=function(){return[].concat(u.DMUValidationValidation)},W.getIsrTypes=function(){return[].concat(u.SIMItfSimulation)},W.getMkpTypes=function(){return[].concat(u.Markup)},W.getNewMkpTypes=function(){return[].concat(u.DMUMarkupRepReference)},W.getMsrTypes=function(){return[].concat(u.DesignSight)},W.getMaturityNlsValue=(e=>s["ds6w:status"][e]||""),W.getValidStateNlsValue=(e=>r["validState"+e]),W.getAnalysisStateNlsValue=(e=>r["analysisState"+e]),W.updateCheckStateValue=P,W.search=function(e,i){let o=[],a=new n(function(n){if(h++,!(e.rvw||e.isr||e.mkp||e.msr))return i({},0),void n();!function a(s,u,l){var c={query:function(e){var i="(";return i+=e.mkp?'flattenedtaxonomies:"types/Markup"':"",e.mkp&&i.length>1&&(i+=" OR "),i+=e.mkp?'flattenedtaxonomies:"types/DMUMarkupRepReference"':"",e.isr&&i.length>1&&(i+=" OR "),i+=e.isr?'flattenedtaxonomies:"types/SIMItfSimulation"':"",e.rvw&&i.length>1&&(i+=" OR "),i+=e.rvw?'flattenedtaxonomies:"types/DMUValidationValidation"':"",e.msr&&i.length>1&&(i+=" OR "),i+=e.msr?'flattenedtaxonomies:"types/DesignSight"':"",i+=")",e.released||(i=i.concat(" AND NOT ([ds6w:status]:VPLM_SMB_Evaluation.RELEASED OR [ds6w:status]:VPLM_SMB_Evaluation_MajorRev.RELEASED)")),e.obsolete||(i=i.concat(" AND NOT ([ds6w:status]:VPLM_SMB_Evaluation.OBSOLETE OR [ds6w:status]:VPLM_SMB_Evaluation_MajorRev.OBSOLETE)")),0===e.owner?i+=' AND [ds6w:responsibleuid]:"'+t.getUserLogin()+'"':1===e.owner&&(i+=' AND [ds6w:organizationResponsible]:"'+t.getUserOrganizationName()+'"'),i}(s),locale:t.getLang(),tenant:t.getPlatformId(),nresults:m,label:y("R3MwebSearch_"+h),select_predicate:d,select_file:f,with_synthesis:!1,with_synthesis_attribute:!1,with_nls:!0,login:{"3dspace":{SecurityContext:t.getSecurityContext()}},source:["3dspace"]};c[0===u?"start":"next_start"]=u,o.push(M({url:t.get3DSearchUrl()+"/search",method:"POST",data:c,onComplete:function(t){var o={};(t.results||[]).forEach(function(e){if(e&&e.attributes){var t={};e.attributes.forEach(function(e){var i=(e.name||"bug").split("/"),n=i[i.length-1];g[n]&&("ds6w:type"===n?(t.type=e.value,t.typeDisp=e.dispValue):"ds6w:status"===n?(t.maturity=e.value,t.maturityDisp=e.dispValue||e.value):"ds6wg:dmuvalidationvalidation.v_validationstate"===n?(t.validState=e.value,t.validStateDisp=r["validState"+e.value]):"ds6wg:dmuvalidationvalidation.V_Validation_RestrictedEdition"===n?(t.restrictedEdition=e.value,t.restrictedEditionDisp=e.dispValue||e.value):"bo.SIMItfSimulation.V_ValidationState"===n?(t.validState=e.value,t.validStateDisp=r["validState"+e.value]):"ds6wg:simitfsimulation.v_itf_executionstatus"===n?t.executionState=e.value:t[g[n]]=e.dispValue||e.value)}),t.analysisState="unknown",t.analysisStateDisp="",t.analysisStateNbKO=0,t.analysisStateProgress=0,t.ownerImg=w(t.ownerid),t.originatorImg=w(t.originatorid),t.id&&(o[t.id]=t)}}),i(o,l),t.infos.nresults?a(e,t.infos.next_start,++l):n()},onFailure:function(){n()}}))}(e,0,0)});return a.promise.then(e=>(e&&o.forEach(e=>e.cancel()),e)),a},W.evalAnalysisStatus=function(e,i,n){!function(e,i,n){var o={simPid:e,nbTotalItf:0,nbOK:0,nbKO:0};M({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",timeout:6e4,data:F(e),onComplete:function(t){let r=t.result[0];if(!r||0===Object.keys(r.outputs).length)return r.input_object["ds6wg:simitfsimulation.v_itf_executionstatus"]&&(o.ExecStatus=r.input_object["ds6wg:simitfsimulation.v_itf_executionstatus"]),void i({status:"success",output:[o]});let a=(r.outputs.itfCtxt||[]).map(function(e){return e.physicalid}),s=[];o.ExecStatus=r.input_object["ds6wg:simitfsimulation.v_itf_executionstatus"],0===a.length&&i({status:"success",output:[o]}),o.nbTotalItf=a.length;for(var u=Math.floor((a.length-1)/500)+1,l=0,c=[],d=!1;l<u&&!d;)k({ctxIDs:a.slice(500*l,500*(l+1)),onComplete:function(t){var r,u=[];t.result.forEach(function(e){if(u.push(e.input_object.physicalid),e.input_object&&"1"!==e.input_object["bo.SIMItfContextOfInterference.V_Context_Validity_Status"])o.nbTotalItf--;else if(e.outputs&&e.outputs.ms&&1===e.outputs.ms.length){if(s.indexOf(e.outputs.ms[0].physicalid)>-1)return void o.nbTotalItf--;s.push(e.outputs.ms[0].physicalid);let t=e.outputs.ms[0];"5"===t["bo.PLMPIMMetricReference.V_Itf_Type"]||"6"===t["bo.PLMPIMMetricReference.V_Itf_Type"]?o.nbTotalItf--:"1"===t["bo.PLMPIMMetricReference.V_Itf_Analysis"]?o.nbOK++:"2"===t["bo.PLMPIMMetricReference.V_Itf_Analysis"]&&o.nbKO++}}),r={itfIDs:u},d&&i({status:"failure",simIds:[e]}),c.push.apply(c,r.itfIDs),c.length===a.length?i({status:"success",output:[o]}):n(e,a.length,c.length)},onFailure:function(){i({status:"failure",simIds:[e]}),d=!0}}),l++},onFailure:function(){i({status:"failure",simIds:[e]})}})}(e.id,i,n)},W.evalMetricIssueCells=function(e,t){L(e,t)},W.evalIssueCells=function(e,i){for(var n=[],o=0;o<e.length;o++)n.push({id:o,method:"GET",url:"resources/issues/"+e[o]});M({url:t.get3DSpaceUrl()+"/resources/issues/batch",securityContext:t.getSecurityContext(),method:"POST",data:{requests:n},onComplete:function(t){t.results.forEach(function(e){e.body.assignees.forEach(function(e){w(e.user)})}),i(t,l,e)},onFailure:function(){i({results:[]},e)}})},W.getFeatureStateInfo=function(i){return new Promise(function(n){(function(i){return new Promise((n,o)=>{e.authenticatedRequest(t.getR2VPlatformUrl(i.serviceId)+"/enovia/resources/r2v/v1/modeler/featurestate/fetch",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},data:JSON.stringify({ids:[i.objectId]}),timeout:6e4,onComplete:function(e){let t=JSON.parse(e);n(t)},onFailure:o,onTimeout:o})})})(i).then(e=>{n(e)})})},W.onTenantModified=function(e){_.push(e)},W.navigate=function(e){var t,i=[e.rvwIds.length?V((t=e.rvwIds,{input_physical_ids:t,label:y("R3MwebRvw"),primitives:[{navigate_to_rel:{id:1,filter:{rel_type:["VPLMrel/PLMConnection/V_Owner"]}}},{navigate_to_sr:{id:2,filter:{semantics:["1"],role:["78"]}}},{navigate_to_sr:{id:3,filter:{semantics:["5"],role:["110"]},mode:"path"}},{navigate_to_sr:{id:4,filter:{semantics:["5"],role:["151"]},mode:"path"}},{navigate_to_rel:{id:5,filter:{rel_type:["VPLMrel/PLMConnection/V_Owner"],bo_type:["DMUValidationCheck"]}}},{navigate_to_rel:{id:6,filter:{rel_type:["VPLMrel/PLMPort/V_Owner"],bo_type:["DMUValidationExposedPresentation"]}}},{navigate_from_rel:{id:7,filter:{rel_type:["Reference Document"],bo_type:["Issue"]}}}],patterns:{context:[{id:1},{id:2}],validatedPath:[{id:1},{id:3}],check:[{id:5}],checked:[{id:1},{id:4}],highlight:[{id:6}],issue:[{id:7}]},fileAttributes:f,attributes:p,version:3})):Promise.resolve({}),e.isrIds.length?V(C(e.isrIds)):Promise.resolve({}),e.mkpIds.length?V(x(e.mkpIds)):Promise.resolve({}),e.newMkpIds.length?V(x(e.newMkpIds)):Promise.resolve({}),e.msrIds.length?V(function(e){return{input_physical_ids:e,label:y("R3MwebMsr"),primitives:[{navigate_to_rel:{id:1,filter:{bo_type:["dsc_Model_Category_Ref"]}}},{navigate_to_rel:{id:2}},{navigate_to_sr:{id:3,filter:{semantics:["5"],role:["79"]},mode:"last"}},{navigate_to_sr:{id:4,filter:{semantics:["4"],role:["170"]},mode:"last"}},{navigate_from_rel:{id:5,filter:{rel_type:["Reference Document"],bo_type:["Issue"]}}}],patterns:{prd:[{id:1},{id:2},{id:3}],context:[{id:1},{id:2},{id:4}],issue:[{id:5}]},fileAttributes:f,attributes:p,version:3}}(e.msrIds)):Promise.resolve({})];return Promise.all(i)},J}),define("DS/DMUwebR3Mutils/DMUwebR3MCsiServices",["UWA/Core","DS/WAFData/WAFData","DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils"].concat([]),function(e,t,i){"use strict";let n={get3DSpaceUrl:()=>i.get3DSpaceUrl(),getPlatformId:()=>i.getPlatformId()};function o(e){return t.authenticatedRequest(e.url,{method:e.method,headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:e.securityContext},data:JSON.stringify(e.data),timeout:e.timeout,onComplete:e.onComplete,onFailure:e.onFailure,onTimeout:e.onTimeout||e.onFailure})}function r(t){var i=e.Promise.deferred();return function(t,i){var n=e.Promise.deferred();return require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"].concat([]),function(e){e.getServiceUrl({serviceName:t,platformId:i,onComplete:function(e){n.resolve(e)},onFailure:function(e){n.reject(new Error(e))}})}),n.promise}("djc",t).then(function(e){var t=e+"/api";i.resolve(t)}),i.promise}function a(t,i,o,a){var s=e.Promise.deferred();let u=n.getPlatformId(),l=Object.assign({},t);return l.method=i,r(u).then(function(e){l.url=e+o,a&&(l.data=a),s.resolve(l)}),s.promise}return{_computeIsr:function(e){a({onFailure:e.onFailure,onComplete:function(t){var i=JSON.parse("string"==typeof t?t:null);if(!i||!i.jobID||0!==i.status||"OK"!==i.message)return e.onFailure();e.onComplete(i)}},"POST","/v1/job/submit/interference",e.data).then(function(e){return o(e)})},_getComputeIsrJobStatus:function(e){a({onFailure:e.onFailure,onComplete:function(t){var i=JSON.parse("string"==typeof t?t:null);if(!i||!i.jobID||0!==i.status||"OK"!==i.message)return e.onFailure();e.onComplete(i)}},"GET","/v1/job/status/"+e.data.jobID,null).then(function(e){return o(e)})},_isUpdateSimulationAllowed:function(){var e,t="";if(window&&window.widget){var i="OnPremise"!==(e=window.widget).getValue("x3dPlatformId");if(e&&e.data&&e.data.appId&&(t=e.data.appId),1===window.top.__PIM_CSIExecute&&i&&("ENOR3M_AP"===t||"ENOI3S_AP"===t))return!0}return!1},_getListIfJobs:function(e){a({onFailure:e.onFailure,onComplete:function(t){var i=JSON.parse("string"==typeof t?t:null);if(!i||0!==i.status||"OK"!==i.message)return e.onFailure();e.onComplete(i)}},"GET","/v1/job/list",null).then(function(e){return o(e)})},_get3DSpaceUrlAndLoginTicket:function(i){var o=e.Promise.deferred(),r=i&&i.platformId?i.platformId:n.getPlatformId();let a=n.get3DSpaceUrl(r);return function(i,n){var o=e.Promise.deferred(),r=i+"/resources/modeler/pno/person?current=true&select=preferredcredentials";return n&&(r+="&tenant="+n),t.authenticatedRequest(r,{method:"GET",type:"json",onComplete:function(e){var t=e.preferredcredentials.role.name,i=e.preferredcredentials.organization.name,n=e.preferredcredentials.collabspace.name;o.resolve(t+"."+i+"."+n)},onFailure:function(e){o.reject(new Error(e))}}),o.promise}(a,r).then(function(i){(function(i,n,o){var r=e.Promise.deferred(),a=i+"/ticket/get?runasctx="+encodeURIComponent(n).trim();return o&&(a+="&tenant="+o),t.authenticatedRequest(a,{headers:{Accept:"application/json"},method:"GET",type:"json",onComplete:function(e){r.resolve(e.ticket)},onFailure:function(e){r.reject(new Error(e))}}),r.promise})(a,i,r).then(function(e){o.resolve({url:a,loginTicket:e})})}),o.promise},_computeItfSimulation:function(t){var o=this,r=e.Promise.deferred();return this._isUpdateSimulationAllowed()?this._get3DSpaceUrlAndLoginTicket().then(function(){var e=localStorage.getItem("PIMCSIInputI3S"),a={version:1,type:"Parameters",content:{sSecurityCtxt:{type:"string",value:i.getSecurityContext()},sIsrObjId:{type:"string",value:t.isrID},sWApp:{type:"string",value:"R3M"},sDbgVal:{type:"string",value:e},bReroot:{type:"bool",value:!1},bTrackStat:{type:"bool",value:!1}}},s={data:{items:[{objectId:t.isrID,objectType:"SIMItfSimulation"}]}};s.source=window.widget&&window.widget.getValue("x3dAppId")?window.widget.getValue("x3dAppId"):"ENOI3S_AP",s.widgetId=window.widget?window.widget.id:void 0,s.data.items[0].envId=n.getPlatformId(),s.data.items[0].serviceId="3DSpace",s.data.items[0].contextId=i.getSecurityContext().replace("ctx::",""),s="content:X3DContentId="+encodeURIComponent(JSON.stringify(s));var u={data:{title:"Interference Simulation Computation",internalID:t.isrID,inputs:JSON.stringify(a),app:{appContent:s}},onComplete:function(e){var t={data:{jobID:e.jobID},onComplete:function(){r.resolve({status:"running"})},onFailure:function(e){r.reject(e)}};o._getComputeIsrJobStatus(t)},onFailure:function(e){r.reject(e)}};o._computeIsr(u)}):r.reject("KO"),r.promise}}});