define("DS/GroupByBrowsingStructureWebInWin/utils/GroupByBrowsingStructureUtils",["UWA/Core","DS/WidgetServices/WidgetServices","DS/BrowsingStructureAPI/utils/BrowsingStructureWebServicesUtil","i18n!DS/GroupByBrowsingStructureWebInWin/assets/nls/GroupByBrowsingStructureWebInWin"],function(e,t,n,i){"use strict";return{getSelectedNodesFromContext:function(){var e=["DS/PADUtils/PADContext"];return new Promise((t,n)=>{require(e,function(e){t(e.get().getSelectedNodes())})})},getXSOFromContext:function(){var e=["DS/PADUtils/PADContext"];return new Promise((t,n)=>{require(e,function(e){e.get()&&t(e.get().options.model.getXSO())})})},_parseSearchResult:function(e){var t=[];let n=e.results;if(n)for(var i=0;i<n.length;i++){for(var o=n[i].attributes,r="",s="",a="",l=0;l<o.length;l++)"ds6w:label"===o[l].name&&(r=o[l].value),"physicalid"===o[l].name?a=o[l].value:"predicatename"===o[l].name&&(s=this._getsixwfromPredicateName(o[l].value));t.push({label:r,value:{predicate:""!==s?s:r,physicalid:a}})}return t},_getsixwfromPredicateName:function(e){if(e)return"ds6w:"+e.charAt(0).toLowerCase()+e.slice(1)},_retrieveBS:function(i){var o=Math.round(1e3*Math.random()).toString(),r={};if(e.extend(r,i),!e.is(r,"object"))throw new Error("Invalid inputs for TerminologyWebService.searchTerminologies");n.get3DSearchUrl().then(function(s){var a=s+"/search",l=widget.lang?widget.lang:widget.getValue("lang");r.payload={with_nls:!1,with_indexing_date:!0,select_predicate:["ds6w:label","ds6w:identifier","ds6w:status","taxonomies","predicatename","physicalid"],order_field:"ds6w:label",order_by:"asc",nresults:100},r.payload.locale=l,r.payload.query='type: "Terminology" AND [ds6w:status]: "Terminology.Released"',r.payload.next_start=void 0,r.payload.start=void 0,r.payload.source=["3dspace"],r.payload.login={"3dspace":{SecurityContext:n.getSecurityContext()}},r.payload.tenant=t.getTenantID(),r.payload.label="GroupByBS_ListBS_"+o,null!=i.next_start?r.payload.next_start=i.next_start:r.payload.start=0,r.method="POST",r.headers={Accept:"application/json","content-type":"application/json","Accept-Language":l,SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL")},r.type="json",r.data=e.Json.encode(r.payload),r.withoutSC=!0,r.timeout=12e4,n._executeRequest(a,r,"searchTerminologies")}).catch(i.onFailure)}}}),define("DS/GroupByBrowsingStructureWebInWin/views/GroupByBrowsingStructureDialog",["UWA/Controls/Abstract","UWA/Core","DS/PlatformAPI/PlatformAPI","DS/WidgetServices/WidgetServices","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/WUXAutoComplete/AutoComplete","DS/IPClassifyUtil/IPClassifyAlert","DS/GroupByBrowsingStructureWebInWin/utils/GroupByBrowsingStructureUtils","i18n!DS/GroupByBrowsingStructureWebInWin/assets/nls/GroupByBrowsingStructureWebInWin","css!DS/GroupByBrowsingStructureWebInWin/GroupByBrowsingStructureWebInWin.css"],function(e,t,n,i,o,r,s,a,l,c,u,d){"use strict";return e.extend({content:null,previousSelection:null,isWebInWin:!1,display:function(e){return new Promise((i,a)=>{var d={onComplete:a=>{if(this.predicates=c._parseSearchResult(a),this.previousSelection=e.currentSelection?e.currentSelection:null,this.isWebInWin=!!e.hasOwnProperty("isWebInWin")&&e.isWebInWin,this.predicates&&this.predicates.length>0?this.content=this._createAutoCompleteDialog(this.predicates):this.content=this._displayNoBSMessage(),this.yesButton=new s({disabled:!0,emphasize:"primary",onClick:e=>{let t=this.content.getChipInfo();this.isWebInWin?this._sendWebInWinNotification("groupByBSSelection.Select",t):(n.publish("groupByBSSelection.Select",t),this.dialog.close())},label:u.bsChooserDialog.organizeButton}),this.cancelButton=new s({label:u.bsChooserDialog.cancelButton,emphasize:"secondary",onClick:this._closePanel.bind(this)}),this.isWebInWin){var l=t.createElement("div",{class:"groupbydialog_wiw_content"});l.inject(e.container);var d=t.createElement("div",{class:"groupbydialog_wiw_options"});this.content.inject(d),d.inject(l);let n=t.createElement("div",{class:"buttonBar"}).inject(l);this.predicates&&this.predicates.length>0&&this.yesButton.inject(n),this.cancelButton.inject(n),i(l)}else{if(void 0===e.container)throw new Error("Dialog cannot be displayed without a valid container");this.immersiveFrame=new o({}),this.immersiveFrame.inject(e.container);var g=this.dialog=new r({immersiveFrame:this.immersiveFrame,title:u.bsChooserDialog.title,content:this.content,activeFlag:!1,resizableFlag:!0,minWidth:300,modalFlag:!0,buttons:{Cancel:new s({onClick:e=>{g.close()}}),Yes:this.yesButton}});i(g)}},onFailure:()=>{l.displayNotification({message:u.webServiceError,className:"error"}),i(null)}};c._retrieveBS(d)})},_sendWebInWinNotification:function(e,t){window.dscef&&window.dscef.sendString(e,t?"string"!=typeof t?JSON.stringify(t):t:"")},_closePanel:function(){this.dialog?this.dialog.close():this._sendWebInWinNotification("onPanelClose")},_createAutoCompleteDialog:function(e){var t,n,i,o,r=new a({elementsTree:e,allowFreeInputFlag:!1,multiSearchMode:!1,getChipInfo:function(){var e="",t="",n="";return this.selectedItems&&(e=this.selectedItems.options.label,t=this.selectedItems.options.value.predicate,n=this.selectedItems.options.value.physicalid),{label:e,predicate:t,physicalid:n}}});return r.value=this.previousSelection?[(t=e,n=this.previousSelection,i=function(e){return e===n},o=t.find(e=>e.label===n||void 0!==Object.values(e.value).find(i)),o&&o.hasOwnProperty("label")?o.label:[])]:[],r.addEventListener("change",e=>{var t=e.dsModel.selectedItems?e.dsModel.selectedItems.options.label:null;t!==this.previousSelection?(this.activateGroupButton(!0),null===t?this.switchButtonLabel(u.bsChooserDialog.ungroupButton):this.switchButtonLabel(u.bsChooserDialog.organizeButton)):this.activateGroupButton(!1)}),r},activateGroupButton:function(e){this.yesButton.disabled=!e},switchButtonLabel:function(e){this.yesButton.label=e},_displayNoBSMessage:function(){var e=t.createElement("div",{class:"groupbydialog_warning_no_bs"});let n=t.createElement("div",{class:"groupbydialog_warning_no_bs_msg"});return n.innerHTML=u.noBSWarning.message+"<br/>"+u.noBSWarning.advice,n.inject(e),e}})}),define("DS/GroupByBrowsingStructureWebInWin/GroupByBSWebInWin",["DS/i3DXCompass/Data","DS/GroupByBrowsingStructureWebInWin/views/GroupByBrowsingStructureDialog"],function(e,t){"use strict";console.log("----- GroupByBSWebInWin ------");require(["DS/UWPClientCode/PublicAPI"]);var n=function(){"undefined"!=typeof dscef&&dscef.sendString("readyForInit")},i=!1;window.launchGroupByBSCommand=function(n){console.log("--\x3e Entering launchGroupByBSCommand with parameters : "),console.log(n);var o=("string"==typeof n?JSON.parse(n):n).params;console.log("-> launchGroupByBSCommand");require(["DS/PADUtils/PADProbes","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices"],function(n,r,s){widget.setValue("noCompass",!0),o.userId&&(window.top.dsUserLogin=o.userId),widget.addPreference("pad_security_ctx",o.securityContext);var a=o.securityContext.startsWith("ctx::")?o.securityContext.substring(5):o.securityContext;widget.setValue("xPref_CREDENTIAL",a),o.tenantId&&(r.setSetting("x3dPlatformId",o.tenantId),widget.setValue("x3dPlatformId",o.tenantId));let l=!widget.body;widget.body=l?UWA.createElement("div"):widget.body,widget.body.addClassName("GroupByBSDiv"),widget.body.setStyles({height:"100%",width:"100%","text-align":"initial",position:"relative"}),e.initialize({myAppsBaseUrl:o.myAppsUrl,userId:o.userId,passportUrl:"",proxyTicketUrl:""});var c=document.body.getElement("#tempDiv");c&&c.remove(),window.top.performance.mark("createWidget_begin"),s.app_initialization(function(){console.log("-> app_initialization");var e=o.nodes,n=null;if(e&&e.length>0)if(e[0].hasOwnProperty("bsApplied"))n=e[0].bsApplied,e[0].getReferenceValue=(t=>e[0][t]);else try{n=e[0].getReferenceValue("bsApplied")}catch(e){console.log(e)}else console.log("--- invalid command entry, the command should be called on a selection");var r=new t;if(i&&o.launchDialog){var s={id:"GroupByBSHdr",context:{getXSOFromContext:()=>new Promise((t,n)=>{t({onChange:()=>!0,get:()=>e})}),getSelectedNodesFromContext:()=>new Promise((t,n)=>{t(e)})}};widget.elements.wrapper=document.body,require(["DS/GroupByBrowsingStructureWebInWin/commands/GroupByBrowsingStructureCommand"],e=>{new e(s).begin()})}else r.display({isWebInWin:!0,container:widget.body,currentSelection:n}).then(e=>{window.GroupByBSDiv=e,l&&widget.body.inject(document.body,"top")})}),widget.dispatchEvent("onRefresh"),widget.dispatchEvent("onDestroy"),widget.dispatchEvent("onResize")})};var o={init:()=>{require(["UWA/Widget"],function(e){var t=window.widget=new e;t.addEvent("onLoad",o.onLoad.bind(this)),t.dispatchEvent("onLoad")})},onLoad:function(){if("undefined"==typeof dscef&&(location.search.contains("test=true")||!0===window.odt)){i=!0;require(["DS/BksStandalone/Standalone"],e=>{e({nodes:'[{"bsApplied":"BS1"}]',launchDialog:!1}).then(e=>{n(),e.nodes=e.nodes?JSON.parse(e.nodes):void 0,e.launchDialog=!!e.launchDialog&&JSON.parse(e.launchDialog),launchGroupByBSCommand({params:e})})})}n()}};o.init()}),define("DS/GroupByBrowsingStructureWebInWin/commands/GroupByBrowsingStructureCommand",["UWA/Core","DS/ApplicationFrame/Command","DS/GroupByBrowsingStructureWebInWin/views/GroupByBrowsingStructureDialog","DS/GroupByBrowsingStructureWebInWin/utils/GroupByBrowsingStructureUtils","i18n!DS/GroupByBrowsingStructureWebInWin/assets/nls/GroupByBrowsingStructureWebInWin"],function(e,t,n,i,o){"use strict";return t.extend({physicalids:[],context:null,init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1}),e.hasOwnProperty("context")&&e.context&&(this.context=e.context),(null!==this.context?this.context.getXSOFromContext():i.getXSOFromContext()).then(e=>{e&&(this._check_selection(),e.onChange(()=>{this._check_selection()}))})},_check_selection:function(){this.disable(),(null!==this.context?this.context.getXSOFromContext():i.getXSOFromContext()).then(e=>{var t=e.get();t&&t.length>0&&t.length<=1&&this.enable()})},beginExecute:function(){},execute:function(){(null!==this.context?this.context.getSelectedNodesFromContext():i.getSelectedNodesFromContext()).then(e=>{if(e&&e.length>0&&e.length<=1){this.physicalids=[e[0].id];var t=e[0].getReferenceValue("bsApplied");let i={container:widget.elements.wrapper,currentSelection:t};(new n).display(i)}})},endExecute:function(){}})});