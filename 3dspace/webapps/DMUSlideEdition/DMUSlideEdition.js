define("DS/DMUSlideEdition/DMUEditAssociatedFormatCmd",["DS/CATWebUXComponents/DMUCommand","DS/Selection/CSOManager","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseUIControllers/DMUSlidesController"],function(e,t,i,n){"use strict";return e.extend({init:function(e){e.mode="exclusive",this._parent(e);var r=this;this.beginExecute=function(){var e=t.get();if(1===e.length){var a=e[0].pathElement.getLastElement(!0);if(a&&a.getDMUType&&"DMUSlide"===a.getDMUType()){var o=i.getReviewContext({viewer:r.getFrameWindow().getViewer()});if(o){var l=o.getDMUObjectFromPathElement(e[0].pathElement);if(l&&l.getPointedFormats&&l.getPointedFormats().length){var d=l.getPointedFormats()[0],s=!o.getUIManager().getFormatEditionModeFlag();o.getUIManager().setFormatEditionModeFlag(s);var g=n.giveDMUSlidesController({context:r.getFrameWindow()});g&&g.setActiveSlide(d,{duration:0});var c=i.giveEventsController({viewer:r.getFrameWindow().getViewer()});c&&c.fireEvent(s?"onFormatsEditionModeStarted":"onFormatsEditionModeEnded")}}}}r.end()}}})}),define("DS/DMUSlideEdition/DMUSlideEdition",[],function(){}),define("DS/DMUSlideEdition/DMUCreateSlideCmd",["require","exports","DS/CATWebUXComponents/DMUCommand","DS/DMUBaseUIControllers/DMUSlidesController","DS/DMUBaseExperience/EXPManagerSet","DS/DMUBaseUIControllers/DMUSceneDisplayController","DS/DMUBaseUIControllers/DMUApplicativeContextManager","DS/DMUBaseUI/DMUToolsUsers","DS/DMUBaseUIServices/DMUSlidePreferences","DS/DMUBaseExperience/DMUContextManager","UWA/Utils","DS/DMUPlaySlide/DMUFormat","DS/DMUPlaySlide/DMUSlide","DS/DMUBaseExperience/DMUModelServices","i18n!DS/DMUSlideEdition/assets/nls/DMUSlideEdition"],function(e,t,i,n,r,a,o,l,d,s,g,c,u,D,m){"use strict";return class extends i{constructor(e){super(e,"exclusive");let t=this;s.setAuthoringFeatureTypes("Slide"),this.beginExecute=async function(){var e,i;let p=s.getReviewContext({viewer:t.getFrameWindow().getViewer()}),f=s.giveEventsController({viewer:t.getFrameWindow().getViewer()}),M=null!==(i=null===(e=d.getSlidePreferences({context:t.getFrameWindow()}))||void 0===e?void 0:e.slideNameFromfeature)&&void 0!==i&&i,U=null==p?void 0:p.getValidation();if(p){let e=U?U.getCurrentMarkup():null;for(;e&&"Markup"!==e.getValType();)e=e.getParentRepRef().getParent();e&&e.getValType&&"Markup"===e.getValType()&&(e=e.getRepRef());let i=e?e.getMarkupContent():p.getCurrentSessionMarkup(),d=[];if(i){let U,v=s.getContextViewer({viewer:t.getFrameWindow().getViewer()}),S=a.giveDMUSceneDisplayController({context:v}),h=i.isVisible()?null:S.getDisplayedAndHiddenOccurrences(),E=p.getTransientReviewBag().getDMUObjects(),C=p.getTransientReviewBag().getAttribute("oLinksManager");if(E.length){let e;f&&f.fireEvent("onBeginDMUObjectDuplication",void 0);for(let t=0;t<E.length;t++){if(-1!==E[t].getType().indexOf("Compare")&&C){let e=[],n=[],r=[],a=E[t].getAttribute("oSelections");if("DMUCompare2D"===E[t].getType()&&(r=E[t].getAttribute("oSheetIDs")),r&&2===r.length&&(r[0].id&&n.push({id:r[0].id}),r[1].id&&n.push({id:r[1].id}),2===n.length&&E[t].setAttribute("oSheetIDs",n)),2===a.length&&a[0].id&&a[1].id){let n=C.getChildWithID(a[0].id),r=null;n&&n.path?r=C.getOccurrenceIdPath(n.path):n&&n.identifier&&(r=[n.identifier]);let o=i.getOccurence({idPath:r},!0);o&&o.id&&e.push({id:o.id}),n=C.getChildWithID(a[1].id),r=null,n&&n.path?r=C.getOccurrenceIdPath(n.path):n&&n.identifier&&(r=[n.identifier]),(o=i.getOccurence({idPath:r},!0))&&o.id&&e.push({id:o.id}),2===e.length&&E[t].setAttribute("oSelections",e),S&&(E[t].setAttribute("fBalance",S.getCurrentCompareBalance()),E[t].setAttribute("bLocalAxis",S.getCurrentLocalAxisValue()))}}e=await D.getObjectDefinition(E[t]),d.push(e)}}let w,b=p.getUIManager().getFormatEditionModeFlag(),F=[{name:"sID",value:i.computeNewID()},{name:"sUuid",value:g.getUUID()}];if(b)(U=new c(t.getFrameWindow().getViewer(),i)).setAttributes(F);else{U=new u(t.getFrameWindow().getViewer(),i);let e=i.getCurrentSlide();e&&e instanceof u&&e.getAttribute("sPointedFormats")&&F.push({name:"sPointedFormats",value:e.getAttribute("sPointedFormats")}),p.getValidation()&&(F=F.concat([{name:"sOwner",value:l.getUserLogin()},{name:"fCreationDate",value:Date.now()}])),U.setAttributes(F)}if(U.updateEnvironmentOverload({target:p.getEnvironment(),state:p.getEnvironment().getEnvironmentInfo()}),b&&U instanceof c){let e;if(i.getCurrentSlide()){let t=i.getFormats();for(w=0;w<t.length;w++)if(t[w]===i.getCurrentSlide()&&w!==t.length-1){e=w+1;break}}i.addFormat(U,e),U.setReadOnly(!1),window.require(["DS/DMUBaseExperience/EXPUtils"],function(e){e._sendUsageProbe("command","CreateFormat")})}else if(U instanceof u){let e;if(i.getCurrentSlide()){let t=i.getSlides();for(w=0;w<t.length;w++)if(t[w]===i.getCurrentSlide()&&w!==t.length-1){e=w+1;break}}i.addSlide(U,e),p.getUIManager().isAPreviewRegistered()||p.getUIManager().registerElementIdAsPreview(U.getAttribute("sUuid"),i),window.require(["DS/DMUBaseExperience/EXPUtils"],function(e){e._sendUsageProbe("command","CreateSlide")})}if(d.length){let e=r.getManager({name:"DMUUserExperienceManager",context:t.getFrameWindow()});await e.duplicateDMUElements({elementDefinitions:d,parent:U,cb:function({duplicatedElements:e}){if(e&&e.length)for(w=0;w<e.length;w++)e[w].setAttributes([{name:"sID",value:i.computeNewID()},{name:"sUuid",value:g.getUUID()}])}})}if(h&&S){let e,t,i=[],n=function(t,n){var r;(e=null===(r=null==p?void 0:p.getCurrentSessionMarkup())||void 0===r?void 0:r.getOrCreateOccurrenceOverloader(t,!0))&&(i.push({target:e,state:{bVisible:n}}),U.addObjectOverload({target:e,state:{bVisible:n}}))};h.hidden&&(h.hidden.paths.forEach(function(e){n({pathElement:e},!1)}),h.hidden.idPaths.forEach(function(e){(t=e.slice())[0]===v.getController().getRootBagId()&&t.splice(0,1),n({idPath:t},!1)})),h.shown&&(h.shown.paths.forEach(function(e){n({pathElement:e},!0)}),h.shown.idPaths.forEach(function(e){(t=e.slice())[0]===v.getController().getRootBagId()&&t.splice(0,1),n({idPath:t},!0)})),i.length&&U.fireEvent("onDMUOverloadPropertiesChanged",{overloads:i})}let x=o.giveDMUApplicativeContextManager({context:v}),O=null;if(!b&&x){let e,t,i=x?x.getApplicativeControllers():[],n=[];for(let r=0;r<i.length;r++){t=i[r].getApplicativeContainerID();let a=x.getVerifiedApplicativeContainerState(t);if(a){if(e=null,(e=i[r].getCurrentAppContainerStateTitle())&&(O?O+=" - ":O="",O+=e),M&&i[r]&&i[r].getFeatureInformation){let e=i[r].getFeatureInformation();e&&e.name&&n.push(e.name)}U.setSlideApplicativeContext(t,a)}}1===n.length&&n[0]&&(O=n[0])}f&&E.length&&(p.getTransientReviewBag().removeDMUObjects(),f.fireEvent("onDMUObjectDuplicated",void 0)),i.setVisibleFlag(!0),M||(O=null),U.setAttribute("sName",i.computeNewName({object:U,prefix:b?m.normalFormatTitle:O||m.normalSlideTitle,noSuffixIfPossible:null!==O,separator:null!==O?"parenthesis":null})),U.fireEvent("onDMUObjectInitialized",{dmuObject:U,dmuCont:i,mkpRepRef:e});let P=n.giveDMUSlidesController({context:t.getFrameWindow()});P&&P.setActiveSlide(U,{duration:0,updatePreviousPreview:!0})}}t.end()}}}}),define("DS/DMUSlideEdition/DMUGenerateFormatCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUControls/EXPNotify","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPManagerSet","DS/DMUControls/DMUPasteWithOptionsPanel","DS/DMUBaseUIControllers/DMUSlidesController","i18n!DS/DMUSlideEdition/assets/nls/DMUSlideEdition"],function(e,t,i,n,r,a,o){"use strict";return e.extend({init:function(e){e.mode="exclusive",this._parent(e);var l,d=this;function s(e,i){l&&l.destroy(),l=new t({body:d.getFrameWindow().getUIFrame(),type:e,message:i})}this.beginExecute=function(){var e=!1,t=i.getReviewContext({viewer:d.getFrameWindow().getViewer()});if(t){var l=t.getCurrentSessionMarkup();if(l){var g=n.getManager({name:"DMUUserExperienceManager",context:d.getFrameWindow()});if(g){var c=g.getCCPTarget();if(c&&c.getType&&"DMUSlide"===c.getType()){c.fireEvent("onBeginDMUObjectDuplication");new r({frmWindow:d.getFrameWindow(),panelTitle:o.generateFormatTitle,prefs:{displayAssociateFormatToSlidePref:!0,applyButtonNls:o.generateAndEditLabel},cb:function(e,n){if(g){let r,u=t.getValidation();if(u){for(r=u.getCurrentMarkup();r&&"Markup"!==r.getAttribute("sValType");)r=r.getParentRepRef().getParent();r&&"Markup"===r.getAttribute("sValType")&&(r=r.getRepRef()),r&&(l=r.getMarkupContent())}g.duplicateDMUElements({elements:[c],parent:l,newType:"Format",markupRepRef:r,duplicationOptions:e,cb:function(r){if(r.duplicatedElements&&1===r.duplicatedElements.length)if(e.associateFormat){c.setAttribute("sPointedFormats",[r.duplicatedElements[0].getAttribute("sID")]);for(var l,g,u=Object.keys(e),D=0;D<u.length;D++)if("formatting"===u[D]&&e[u[D]]){for(g=(l=c.getDMUObjects("DMUSection")).length-1;g>=0;g--)c.removeDMUObject(l[g]);for(g=(l=c.getDMUObjects("DMUClipping")).length-1;g>=0;g--)c.removeDMUObject(l[g]);for(g=(l=c.getObjectOverloads()).length-1;g>=0;g--)c.removeObjectOverload(l[g])}else if("markers3D"===u[D]&&e[u[D]])for(g=(l=c.getDMUObjects()).length-1;g>=0;g--)-1===l[g].getType().indexOf("DMUMarker3D")&&-1===l[g].getType().indexOf("Measure")||c.removeDMUObject(l[g]);else if("markers2D"===u[D]&&e[u[D]])for(g=(l=c.getDMUObjects()).length-1;g>=0;g--)-1!==l[g].getType().indexOf("DMUMarker2D")&&c.removeDMUObject(l[g])}else r.duplicatedElements.forEach(function(e){e.refreshNode()});if(c.refreshNode(),d.getFrameWindow().getViewer().render(),c.fireEvent("onDMUObjectDuplicated"),r.duplicatedElements&&1===r.duplicatedElements.length&&n){var m=!t.getUIManager().getFormatEditionModeFlag();t.getUIManager().setFormatEditionModeFlag(m);var p=a.giveDMUSlidesController({context:d.getFrameWindow()});p&&p.setActiveSlide(r.duplicatedElements[0],{duration:0});var f=i.giveEventsController({viewer:d.getFrameWindow().getViewer()});f&&f.fireEvent(m?"onFormatsEditionModeStarted":"onFormatsEditionModeEnded")}else c.fireEvent("onSlidePreviewRefreshRequired",{dmuObject:c}),s(r.duplicatedElements&&r.duplicatedElements.length?"info":"error",r.duplicatedElements&&r.duplicatedElements.length?o.formatGenerated:o.formatGenerationError)}})}}})}else e=!0}else e=!0}else e=!0}else e=!0;e&&s("error",o.formatGenerationError),d.end()}}})});