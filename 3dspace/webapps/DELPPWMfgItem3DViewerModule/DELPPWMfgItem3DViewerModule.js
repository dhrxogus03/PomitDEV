define("DS/DELPPWMfgItem3DViewerModule/ScopedProductSelectionUI",["UWA/Core"],function(e){"use strict";return function(t,n,i){var o,c,l,s,a=1,r=2,d=n.getComponent("Element"),u=n.getComponent("Accordeon"),f=n.getComponent("Button"),g=n.getComponent("ComboBox"),p=n.getComponent("TooltipModel"),m=null,h=null,v=null;return o=function(o){var c,l,s;c=function(n){switch(n){case a:return function(){h.close()};case r:return function(){var t=v.rootField,n=v.occField,i=v.scopedMfgItemField;e.is(o,"function")&&e.is(t)&&e.is(n)&&e.is(i)&&o(t.value,n.value,i.value),h.close()};default:t.log("wrong option")}},l={No:new f({label:i.getNLSValue("ScopedProductSelectionUI.Close.Title"),onClick:c(a)}),Yes:new f({disabled:!1,label:i.getNLSValue("ScopedProductSelectionUI.Load.Title"),onClick:c(r)})},e.is(n)?(s={title:i.getNLSValue("ScopedProductSelectionUI.Dialog.Title"),domId:"ScopedProductSelectionUI-dialog",content:m,resizableFlag:!0,modalFlag:!1,minWidth:290,width:400,buttons:l,visibleFlag:!1},(h=n.create("Dialog",s)).close=function(){e.is(m)&&m.destroy(),this.destroy(),h=null,v=null}):t.debug("uxFactoryBehavior is not available.")},c=function(t){var n,i;return n=new e.Element("div",{class:"accordeon-section-container"}),i=new d("div",{class:"section-container"}),n.inject(m),new u({items:[{header:t,content:i,expandedFlag:!0}],style:"filled-separate"}).inject(n),i.addEvent("resize",function(){var t,n,o;o=i.getElements(".wux-field-container"),i.clientWidth<290?(t="inline-container",n="block-container"):(t="block-container",n="inline-container"),e.is(o)&&o.forEach(function(e){e.removeClassName(t),e.addClassName(n)})}),i},l=function(t,n){t.forEach(function(t){var i,o;i=new e.Element("div",{class:"wux-field-container inline-container"}),new e.Element("h6",{class:"wux-textElement",text:t.label}).inject(i).tooltipInfos=new p({shortHelp:t.label}),o=new g({elementsList:t.elementsList,actionOnClickFlag:!1,enableSearchFlag:!1,value:t.value,disabled:t.disabled}),e.is(t.onChange,"function")&&o.addEventListener("change",t.onChange.bind(null,v)),v[t.name]=o,o.inject(i),i.inject(n)})},s=function(t){var n,o,s,a,r,d={},u={};Array.isArray(t)&&t.length>0&&(s={name:"rootField",label:i.getNLSValue("ScopedProductSelectionUI.Field.Root.Title"),elementsList:[],disabled:!0,onChange:function(t){var n,i,o,c,l,s,a;n=t.rootField,o=t.occField,s=t.scopedMfgItemField,e.is(n)&&e.is(o)&&e.is(s)&&(i=n.value,e.is(d[i])&&(l=(c=d[i])[0].valueItem,o.setProperties({elementsList:c,value:l}),e.is(u[l])&&(a=u[l],s.setProperties({elementsList:a,value:a[0].valueItem}))))}},a={name:"occField",label:i.getNLSValue("ScopedProductSelectionUI.Field.Occurence.Title"),elementsList:[],disabled:!0,onChange:function(t){var n,i,o,c;n=t.occField,o=t.scopedMfgItemField,e.is(n)&&e.is(o)&&(i=n.value,e.is(u[i])&&(c=u[i],o.setProperties({elementsList:c,value:c[0].valueItem})))}},r={name:"scopedMfgItemField",label:i.getNLSValue("ScopedProductSelectionUI.Field.ScopedMfgItem.Title"),elementsList:[],disabled:!0},t.forEach(function(e){var t=[];e.occurences.forEach(function(e){var n=[];t.push({labelItem:e.label,valueItem:e.pid}),e.scopedPrd.forEach(function(e){n.push({labelItem:e.label,valueItem:e.pid})}),u[e.pid]=n}),d[e.pid]=t}),o=t[0],s.disabled=!1,s.value=o.pid,s.elementsList=t.map(function(e){return{labelItem:e.label,valueItem:e.pid}}),e.is(d[s.value])&&(a.disabled=!1,a.elementsList=d[s.value],a.value=a.elementsList[0].valueItem,e.is(u[a.value])&&(r.disabled=!1,r.elementsList=u[a.value],r.value=r.elementsList[0].valueItem)),v=[],n=c(i.getNLSValue("ImplementUI.Implementing")),l([s,a],n),n=c(i.getNLSValue("Type.VPMReference")),l([r],n))},{createDialog:function(t){!e.is(h)&&e.is(t)&&e.is(t.data)&&e.is(t.onSelectCallback)&&(m=new d("div",{class:"ScopedProductSelectionUI-Container"}),o(t.onSelectCallback),s(t.data),h.show())},isActive:function(){return!!e.is(h)&&h.visibleFlag},destroyUI:function(){e.is(h)&&h.close()}}}}),define("DS/DELPPWMfgItem3DViewerModule/MfgItem3DViewerModule",["UWA/Core","DS/TransientWidget/TransientWidget","DS/DELPPWMfgItem3DViewerModule/ScopedProductSelectionUI"],function(e,t,n){"use strict";return{behaviors:["InterWidgetComBehavior","UXFactoryBehavior","ResourceBehavior","ModelBehavior","RootsBehavior","ProductImplementBehavior"],creator:function(i,o,c,l,s,a,r){var d,u,f,g,p,m,h,v,I,P,b,S,D,L,E,w,C,R,V,M,F,W,k,y,O,U="MfgItem3DViewerModule_Preferences",A=o.isCloud()?"DELOERC_AP":"DELOER_AP";return L=function(){o.isWidgetLinked(A)?i.warn(l.getNLSValue("MfgItem3DOperationViewer.IsAlreadyAvailable")):t.showWidget(A,{})},y=function(){var t,n,i,c;const l=t=>{if(n=f(),i=n.loadedObjInfos,e.is(t.occurences)&&1===t.occurences.length){const n=t.occurences[0];if(e.is(n.scopedPrd)&&1===n.scopedPrd.length)return n.scopedPrd[0].pid===i.scopedPrdPID}return!1};if(o.isOpsViewerWidgetLinked())if(t=a.getRoots()[0],c=m(t)){const t=c.find(l);e.is(t)?P(t.pid,t.occurences[0].scopedPrd[0].pid):p()}else p()},E=function(t){var n,i;o.isOpsViewerWidgetLinked()&&(i=f(),e.is(i)||(n=m([t]),v(n)))},R=function(e){var t;if(o.isWidgetLinked(A)){const n=e.absPath;if(n.length>0){const e=n[0],i=s.getInstance(e);t=s.getAggregatingReferenceModelFromInstance(i)}else t=s.getReference(e.nodeId);const i=[t.get("PID")],o=m(i);v(o)}},V=function(t){if(o.isWidgetLinked(A)){const n=f();if(e.is(n)&&e.is(t.impactedChildren)){const i=t.impactedChildren,o=n.loadedObjInfos;if(e.is(i)&&e.is(o)){const e=i[i.length-1];e!==o.rootPID&&e!==o.scopedPrdPID||P(o.rootPID,o.scopedPrdPID)}}}},f=function(){return i.getPreferenceValue(U)},g=function(e,t){var n={loadedObjInfos:{rootPID:e,scopedPrdPID:t}};widget.setValue(U,n)},p=function(){widget.setValue(U)},m=function(t){let n=[];return Array.isArray(t)&&t.length>0&&t.forEach(function(t){let i;const o=s.getReference(t),c=r.getScopeLinksOfImplementing(t);if(c.length>0){const e=c[0].get("to");let n=[];const l=s.getReference(e);n.push({pid:e,label:l.get("PLMEntity.V_Name")}),i={pid:t,label:o.get("PLMEntity.V_Name"),occurences:[{pid:t,label:o.get("PLMEntity.V_Name"),scopedPrd:n}]}}e.is(i)&&n.push(i)}),n},v=function(t){var o;if(o=function(){var t,n;t=f(),e.is(t)&&(n=t.loadedObjInfos,e.is(n.scopedPrdPID)&&F(n.scopedPrdPID))},t.length>0){if(1===t.length){const n=t[0];if(e.is(n.occurences)&&1===n.occurences.length){const t=n.occurences[0];if(e.is(t.scopedPrd)&&1===t.scopedPrd.length){const e=t.scopedPrd[0].pid;return o(),void P(n.pid,e)}}}(u=new n(i,c,l)).createDialog({data:t,onSelectCallback:function(t,n,i){e.is(t)&&e.is(n)&&e.is(i)&&(o(),P(t,i))}})}},I=function(t,n){e.is(t)&&o.publishEvent("DS/DELExternalWidgetCom/"+t,n)},P=function(t,n){const i=s.getReferenceModel(t);e.is(i)&&(g(t,n),I("Remove2DStructure"),I("LoadData",{items:[{id:n}]}))},b=function(){setTimeout(function(){I("GetAppStatus")},10)},S=function(){e.is(u)&&u.isActive()&&u.destroyUI(),p(),i.notify("widgetUnlinked")},D=function(){var e,t;t=a.getRoots()[0],e=m(t),I("Remove2DStructure"),e.length>0&&v(e),i.notify("widgetLinked")},w=function(t,n){let i=!1;const o=n.loadedObjInfos;return e.is(o.rootPID)&&(i=t===o.rootPID||t===o.scopedPrdPID||s.getInstancesFromCollection(t).some(function(e){let t=!1;return s.getReferenceModelFromInstance(e).get("PID")===o.rootPID&&(t=!0),t})),i},C=function(t){var n,o,c,l;if(n=this.isSelected?"selectNodes":"unSelectNodes",l=function(e){var t,n=[];for(t=0;t<e.length;t++)t%2==1&&n.push(e[t]);return n},e.is(t.path)){const a=t.path.map(e=>l(e));c=[];for(let t=0;t<a.length;t++){const n=a[t];o=[];for(let t=0;t<n.length;t++){const i=s.getInstance(n[t]);if(!e.is(i))break;"VPMInstance"===i.get("type")&&o.push(n[t])}o.length>0&&c.push(o)}c.length>0&&i.notify(n,[c])}},h=function(e){var t,n,i,c;o.isOpsViewerWidgetLinked()&&(n=e.changed.isSelected?"Highlight":"UnHighlight",i=e.changed.absPath,t=[],c=s.transformToRIROccurrencePath(i.length>0?i:e.changed.nodeId),t.push(c),t.length>0&&I(n,{path:t}))},M=function(t){var n,i;n=f(),e.is(n)&&t.some(function(e){return w(e.get("PID"),n)})&&(i=n.loadedObjInfos,F(i.scopedPrdPID))},F=function(t){var n=s.getReferenceModel(t);e.is(n)&&"PRODUCT"===s.getPPRType(n)&&(p(),I("RemoveRoots",{items:[{id:t}]}))},W=function(){k()},k=function(){I("RemoveAll")},O=function(e){var t=[],n=e.absPath;o.isOpsViewerWidgetLinked()&&(t.push(s.transformToRIROccurrencePath(n.length>0?n:e.nodeId)),t.length>0&&I("Reframe",{path:t}))},{listenTo:function(){return{select:h,addRootNode:E,hideRootNode:M,Show3DViewerCmd:L,LoadIn3DViewer:R,refreshImpacted:V,HideAll:W,highlightIn3D:h,onRecentContentLoaded:y,ReframeIn3DViewer:O}},onStart:function(t,n){d=e.extend(d,t),o.isOpsViewerWidgetLinked()&&(i.notify("widgetLinked"),I("Remove2DStructure")),o.subscribeEvent("DS/DELExternalWidgetCom/onGetAppStatus",function(e){!0===e.status?D():o.subscribeEvent("DS/DELExternalWidgetCom/onAppReady",D)}),o.addEventListener("link",b),o.addEventListener("unlink",S),o.subscribeEvent("DS/DELExternalWidgetCom/onSelect",C.bind({isSelected:!0})),o.subscribeEvent("DS/DELExternalWidgetCom/onUnSelect",C.bind({isSelected:!1})),n()},onStop:function(){}}}}});