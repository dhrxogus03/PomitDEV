define("DS/DocumentCreateNew/PLMNewDocumentCmd",["UWA/Core","DS/ENONewWidget/command/NewContentCommandBase","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],function(e,t,n,i){"use strict";return t.extend({defaults:{type:"Document"},init:function(e){this._parent(e)},getType(){return this.defaults.type},execute:function(){this.launchCreationDialog()},launchCreationDialog:function(){var e=this.getCreateOptions({});this.launchCreateNew(e)},getHeaders:function(t){let i={},o=n.get();var s=e.is(o)&&e.is(o.change.id)?o.change.id:null;return i=""!=s?{SecurityContext:t,"DS-Change-Authoring-Context":"pid:"+s}:{SecurityContext:t}},getOptions:function(e){return console.log(e),{options:{typeName:"Document",preferedType:this.options.preferedType},context:{serviceBaseUrl:this.options.serviceBaseUrl,tenant:this.options.tenant,header:this.getHeaders(this.options.securityContext),getENONewContext:function(){return{}}},events:this.options.callbacks,viewType:"tabView",labelTopBar:i.get("NewDocument"),facets:[{name:"classificationFacet",facetoptions:{isBookmark:!0,isLibrary:!0,isExportControl:!0}}],notification:!1}}})}),define("DS/DocumentCreateNew/Utils/DimensionUtils",["UWA/Class","UWA/Promise","DS/WAFData/WAFData","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],function(e,t,n,i){"use strict";return e.singleton({init:function(){},Dimensions:{},getDimensions:function(e){var o=this;return o.Dimensions[e.tenantUrl]?o.Dimensions[e.tenantUrl].ready:(o.Dimensions[e.tenantUrl]={ready:t.deferred()},n.authenticatedRequest(e.tenantUrl+"/resources/dictionary/dimensions",{method:"GET",headers:{Accept:"application/json","content-type":"application/json","Accept-Language":widget.lang?widget.lang:widget.getValue("lang"),SecurityContext:e.securityContext},timeout:18e4,type:"json",onComplete:function(t){try{var n={};t.results.forEach(function(e){e.Units.forEach(function(t){e.MKSUnit==t.Name&&(n[e.Name]=t.NLSName)})}),o.Dimensions[e.tenantUrl]._dimensions=n,o.Dimensions[e.tenantUrl].ready.resolve(o.Dimensions[e.tenantUrl]._dimensions),console.info("Dimensions loaded")}catch(t){console.error("Unexpected error when fetching dimensions"),console.error(t),o.Dimensions[e.tenantUrl].ready.reject({subtitle:i.get("DIMENSIONAL_ATTRIBUTES_ARE_INVALID"),message:i.get("PLEASE_TRY_AGAIN_OR_CONTACT_SYSTEM_ADMINSTRATOR")}),delete o.Dimensions[e.tenantUrl]}},onFailure:function(t){console.error("Unable to get dimensions : "),console.error(t),o.Dimensions[e.tenantUrl].ready.reject({subtitle:i.get("FAILED_TO_FETCH_DIMENSIONAL_ATTRIBUTES"),message:(t.message||t)+" \n"+i.get("PLEASE_TRY_AGAIN_OR_CONTACT_SYSTEM_ADMINSTRATOR"),error:t}),delete o.Dimensions[e.tenantUrl]}}),o.Dimensions[e.tenantUrl].ready)}})}),define("DS/DocumentCreateNew/Utils/Credentials",["UWA/Core","UWA/Promise","DS/WAFData/WAFData","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],function(e,t,n,i){"use strict";return e.Class.singleton({init:function(){},credentials:{},getCredentialsList:function(e){var o=this;if(o.credentials[e.tenantUrl+e.tenant])return o.credentials[e.tenantUrl+e.tenant].ready;o.credentials[e.tenantUrl+e.tenant]={ready:t.deferred()};var s=[],a=e.tenantUrl+"/resources/modeler/pno/person?current=true";return a+="&select=preferredcredentials&select=collabspaces",a+="&tenant="+e.tenant,n.authenticatedRequest(a,{method:"GET",type:"json",onComplete:function(t){s=[],[];var n=!1;if(t.collabspaces&&t.collabspaces.length>0)for(var i=void 0,a=0;a<t.collabspaces.length;a++)for(var r=0;r<t.collabspaces[a].couples.length;r++){var l=t.collabspaces[a].couples[r];null==i&&(i=l.organization.name),i!=l.organization.name&&(n=!0);var c=l.role.name+"."+l.organization.name+"."+t.collabspaces[a].name;t.collabspaces[a].title||(t.collabspaces[a].title=t.collabspaces[a].name),l.organization.title||(l.organization.title=l.organization.name),l.role.nls||(l.role.nls=l.role.name);var d=t.collabspaces[a].title+" ● "+l.organization.title+" ● "+l.role.nls,u=t.collabspaces[a].title+" ● "+l.role.nls;s.push({value:c,withorg_nls:d,withoutorg_nls:u,collabspaceTitle:t.collabspaces[a].title})}o.credentials[e.tenantUrl+e.tenant].ready.resolve(s.sort(function(e,t){return n?e.withorg_nls<t.withorg_nls?-1:e.withorg_nls>t.withorg_nls?1:0:e.withoutorg_nls<t.withoutorg_nls?-1:e.withoutorg_nls>t.withoutorg_nls?1:0}).map(function(e){return{label:n?e.withorg_nls:e.withoutorg_nls,value:e.value}})),console.info("Credentials loaded")},onFailure:function(t){console.error("Failed to get credentials:",t),o.credentials[e.tenantUrl+e.tenant].ready.reject({subtitle:i.get("FAILED_TO_FETCH_CREDENTIALS"),message:err.message||err,error:err})}}),o.credentials[e.tenantUrl+e.tenant].ready},addCredentialList:function(e,n){this.credentials[e.tenantUrl+e.tenant]={ready:t.deferred()},this.credentials[e.tenantUrl+e.tenant].ready.resolve(n)}})}),define("DS/DocumentCreateNew/Utils/TypesUtils",["UWA/Class","UWA/Promise","DS/WAFData/WAFData","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],function(e,t,n,i){"use strict";return e.singleton({init:function(){},Dictionarys:{},getTypeInfos:function(e){var o=this;return o.Dictionarys[e.tenantUrl]?o.Dictionarys[e.tenantUrl].ready:(o.Dictionarys[e.tenantUrl]={ready:t.deferred()},n.authenticatedRequest(e.tenantUrl+"/resources/dictionary/Dictionary?lang="+widget.lang,{method:"GET",headers:{Accept:"application/json","content-type":"application/json","Accept-Language":widget.lang,SecurityContext:e.securityContext},timeout:18e4,type:"json",onComplete:function(t){try{o.Dictionarys[e.tenantUrl]._typeInfos=o.formatResult(t.Dictionary.Types,t.Dictionary.Interfaces,t.DictionaryNLS),o.Dictionarys[e.tenantUrl].ready.resolve(o.Dictionarys[e.tenantUrl]._typeInfos),console.info("Dictionary loaded")}catch(t){console.error("Unexpected error when fetching types infos"),console.error(t),o.Dictionarys[e.tenantUrl].ready.reject({subtitle:i.get("TYPE_INFORMATION_IS_INVALID"),message:i.get("PLEASE_TRY_AGAIN_OR_CONTACT_SYSTEM_ADMINSTRATOR")}),delete o.Dictionarys[e.tenantUrl]}},onFailure:function(t){console.error("Unable to get types infos : "),console.error(t),o.Dictionarys[e.tenantUrl].ready.reject({subtitle:i.get("FAILED_TO_FETCH_TYPE_INFORMATION"),message:(t.message||t)+" \n"+i.get("PLEASE_TRY_AGAIN_OR_CONTACT_SYSTEM_ADMINSTRATOR"),error:t}),delete o.Dictionarys[e.tenantUrl]}}),o.Dictionarys[e.tenantUrl].ready)},formatResult:function(e,t,n){console.time("formatResult");var i=this,o={},s=[];for(var a in e){var r=e[a];if("Document"==r.FirstOOTB&&"Yes"==r.Specialization&&null==r.Deprecated){o[a]||(o[a]={nls:n["Type."+a]||r.Name,icon:r.IconName,parent:r.Parent,childs:[],abstract:r.Abstract,attributes:[],interfaces:{}},s.includes(a)||s.push(a));let t=r.Parent;t&&t.trim().length>0&&(o[t]?o[t].childs.push(a):(o[t]={nls:n["Type."+t]||e[t].Name,icon:e[t].IconName,parent:e[t].Parent,childs:[a],abstract:e[t].Abstract,attributes:[],interfaces:{}},s.includes(t)||s.push(t)));var l=r.Attributes?r.Attributes:{};o[a].attributes=i.extractAttributeDef(l,n,null)}}for(var c in null==o.Document&&(o.Document={nls:n["Type.Document"]||e.Document.Name,icon:e.Document.IconName,parent:e.Document.Parent,childs:[],abstract:e.Document.Abstract,attributes:[],interfaces:{}},s.includes("Document")||s.push("Document")),o.Document.attributes=[],t){var d=n["Interface."+c];"Yes"==t[c].Automatic&&t[c].ScopeTypes&&s.forEach(e=>{t[c].ScopeTypes.includes(e)&&(console.log(e,c),o[e].interfaces[d]=i.extractAttributeDef(t[c].Attributes,n,c))})}return console.timeEnd("formatResult"),o},extractAttributeDef:function(e,t,n){var i=[];for(var o in e){var s=e[o],a={Name:o,nls_Name:null==n?t["Attribute."+o]:t["Attribute."+n+"."+o]||t["Attribute."+o],Type:s.Type,MaxLength:s.MaxLength,MultiValuated:s.MultiValuated,MultiLine:s.MultiLine,Default:s.Default};s.Dimension&&(a.Dimension=s.Dimension),"Yes"==s.HasRangeDefined&&(a.AuthorizedValues=s.AuthorizedValues.map(e=>({label:t["Range."+o+"."+e]?t["Range."+o+"."+e]:e,value:e}))),i.push(a)}return i}})}),define("DS/DocumentCreateNew/Views/CreateForm",["UWA/Core","DS/Controls/Editor","DS/Controls/LineEditor","DS/Controls/ComboBox","DS/Controls/FilePicker","DS/Controls/Accordeon","DS/DataGridView/DataGridView","DS/Tweakers/TweakerArray","DS/Tweakers/TweakerNumber","DS/Tweakers/TweakerDate","DS/Tweakers/TweakerBoolean","DS/Tweakers/TweakerString","DS/Controls/TooltipModel","DS/Controls/SelectionChipsEditor","DS/Controls/Popup"],function(e,t,n,i,o,s,a,r,l,c,d,u,p,m,g){"use strict";var f=e.Controls.Abstract.extend({init:function(e){this._parent(e),this.buildSkeleton()},buildSkeleton:function(){var e=this,t=this.options.fields;f.doctypesList=this.options.doctypes,f.dimensions=this.options.dimensions,f.elements={},f.events=this.options.events,t.forEach(function(t){"header"==t.type?e.buildHeader(t):"accordeon"==t.type?e.buildAccordeon(t):"grid"==t.type?e.buildGrid(t):e.createInputField(t,e.options.container)})},createInputField:function(s,a){var g=e.createElement("div",{class:"form-group",styles:{display:s.display}}).inject(a),y=e.createElement("label",{text:s.label,attributes:{for:s.settings.domId},styles:{display:s.display}}).inject(g);s.settings.requiredFlag&&e.createElement("span",{class:"label-field-required"}).inject(y).setHTML(' <i class="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-required "></i>');var h=null;if("block"==s.display){switch(s.type){case"text":h=new n(s.settings).inject(g);break;case"combobox":h=new i(s.settings).inject(g);break;case"textarea":h=new t(s.settings).inject(g);break;case"file":h=new o(s.settings).inject(g);break;case"multi":s.settings&&"string"==s.settings.valueType?h=new m({value:[],placeholder:"Type a unique value",uniqueValue:!0,maxLength:s.settings.maxLength}).inject(g):(h=new r(s.settings).inject(g)).getContent().setAttribute("id",s.settings.domId);break;case"multirange":s.settings&&(h=new u({value:[],allowMultipleValuesFlag:!0,possibleValues:s.settings.possibleValues}).inject(g));break;case"number":h=new l(s.settings).inject(g);break;case"date":h=new c(s.settings).inject(g);break;case"boolean":h=new d(s.settings).inject(g)}if(null!=h){var D=h.elements.container.dsModel.value;if(e.is(h.elements.container.dsModel.selectedIndex,"number")&&(D=h.elements.container.dsModel.currentLabel),h.tooltipInfos=new p({shortHelp:D}),f.elements[s.settings.domId]=h.elements.container.dsModel,s.additionalAttributes)for(var b in s.additionalAttributes)"combobox"==s.type||"text"==s.type||"multirange"==s.type?h.getContent().setAttribute(b,s.additionalAttributes[b]):h.getContent().children&&h.getContent().children[0]&&h.getContent().children[0].setAttribute(b,s.additionalAttributes[b]);if(s.events){for(var b in s.events)h.addEventListener(b,s.events[b]);"file"==s.type&&(h.value=s.settings.blob)}}}},buildHeader:function(t){e.createElement("p",t).inject(this.options.container)},buildAccordeon:function(t){var n=this,i={style:t.styles,exclusive:t.exclusive,domId:t.domId},o=[];t.items.forEach(function(e){o.push(n.buildItem(e.id,e.header,e.content))}),i.items=o;var a=e.createElement("div",{class:"attribute-accordeon",styles:{display:t.display}}).inject(this.options.container),r=new s(i).inject(a);f.elements[t.domId]=r,this.appendDynamicAttributes(f.elements.ENOX_Document_Type.value,r)},buildGrid:function(t){let n=t.treeDocument.getRoots().length;n>9&&(n=9);var i=e.createElement("div",{class:"multifile-grid",styles:{display:t.display,height:24*n+"px"}}).inject(this.options.container);new a(t).inject(i)},buildItem:function(t,n,i){var o=this,s=e.createElement("div",{class:"item-sections",id:t}),a={header:n};return i.forEach(function(e){o.createInputField(e,s)}),a.content=s,a},getFielfDef:function(t){var n={settings:{},additionalAttributes:{},events:{}};return n.label=t.nls_Name,n.display="block",n.settings.domId=t.Name.replace(" ","_"),n.settings.value=t.Default,n.additionalAttributes.Style="width:100%;",n.events=f.events,t.requiredFlag&&(n.settings.requiredFlag=t.requiredFlag),t.pattern&&(n.settings.pattern=t.pattern),t.AuthorizedValues&&"No"==t.MultiValuated?(n.type="combobox",n.settings.elementsList=t.AuthorizedValues,n.settings.enableSearchFlag=!0,n.settings.popupSizeAdjustPolicy=g.SizeAdjustPolicyEnum.AdjustToVisibleContents):t.AuthorizedValues&&"Yes"==t.MultiValuated?(n.type="multirange",n.settings.valueType=t.Type.toLowerCase(),n.settings.possibleValues=t.AuthorizedValues.filter(e=>""!=e.value)):"Yes"==t.MultiValuated?(n.type="multi",n.settings.itemEditionTrigger="in place",n.settings.valueType=t.Type.toLowerCase(),isNaN(parseInt(t.MaxLength))||(n.settings.maxLength=parseInt(t.MaxLength)),t.Dimension&&(n.label+=" (in "+f.dimensions[t.Dimension]+")")):"Integer"==t.Type||"Double"==t.Type||"Real"==t.Type?(n.type="number","Integer"==t.Type&&(n.settings.stepValue=1),t.Dimension&&(n.settings.units=f.dimensions[t.Dimension])):"Date"==t.Type?(n.type="date",e.is(t.Default,"string")&&""!=t.Default?n.settings.value=new Date(1e3*t.Default):""==t.Default&&(n.settings.value=void 0)):"Boolean"==t.Type?(n.type="boolean",null==n.settings.value&&(n.settings.value=!1)):t.MultiLine&&"Yes"==t.MultiLine?(n.type="textarea",n.settings.newLineMode="enter",n.settings.nbRows=5,n.settings.maxLength=t.MaxLength):(n.type="text",n.settings.selectAllOnFocus=!0,n.settings.displayClearFieldButtonFlag=!0,isNaN(parseInt(t.MaxLength))||(n.settings.maxLength=parseInt(t.MaxLength))),n}});return f.prototype.appendInheritedAttributes=function(e,t){if(f.doctypesList[e]&&"DOCUMENTS"!=f.doctypesList[e]){var n=f.doctypesList[e].attributes;n&&n.length>0&&n.forEach(function(e){t.attributes.unshift(e)});var i=f.doctypesList[e].interfaces;if(i)for(const e in i)if(Object.hasOwnProperty.call(i,e)){const n=i[e];t.attributes.push(...n)}this.appendInheritedAttributes(f.doctypesList[e].parent,t)}},f.prototype.appendDynamicAttributes=function(t,n){var i=this,o={attributes:[]};i.appendInheritedAttributes(t,o);var s=n.items[n.items.length-1];if(o.attributes.length>0){var a=e.createElement("div",{class:"item-sections",id:"DCN_CustomAttributes"}).inject(s.content);f.elements.DCN_CustomAttributes=a,o.attributes.forEach(function(e){var t=i.getFielfDef(e);i.createInputField(t,a)})}n.clear(),n.addItem(s)},f}),define("DS/DocumentCreateNew/CreateNew",["UWA/Core","DS/UIKIT/Mask","DS/DocumentManagement/DocumentManagement","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/TooltipModel","DS/DocumentCreateNew/Views/CreateForm","DS/DocumentCreateNew/Utils/TypesUtils","DS/DocumentCreateNew/Utils/DimensionUtils","DS/DocumentCreateNew/Utils/Credentials","DS/Controls/Loader","DS/Controls/ModalContainer","UWA/Promise","DS/DocumentCommonInfra/TrackerAPI","DS/DocumentFiles/data/Model","css!DS/DocumentCreateNew/DocumentCreateNew"],function(e,t,n,i,o,s,a,r,l,c,d,u,p,m,g,f,y,h){"use strict";var D={},b=e.Controls.Abstract.extend({name:"doco-create-new2",options:{className:""},init:function(t){var n=this;this._parent(t),widget&&widget.app&&widget.app.jobs&&"doco-jobs"==widget.app.jobs.name&&widget.app.progressPane&&"doco-progress"==widget.app.progressPane.name?(D=widget.app).jobs.MAX_PARALLEL_JOBS=1:(null==D.jobs&&require(["DS/DocumentCommands/Jobs"],function(e){null==D.jobs&&(D.jobs=new e(D),D.jobs.MAX_PARALLEL_JOBS=1)}),null==D.progressPane&&require(["DS/DocumentCommands/ProgressPane"],function(e){null==D.progressPane&&(D.progressPane=new e(D),D.progressPane.inject(widget.body))})),b.selectedFiles=[],null==t.credentialsPrefName&&(t.credentialsPrefName="credentials"),null==this.options.containerToOverlay&&(this.options.containerToOverlay=widget.body),t.securityContext&&t.securityContext.startsWith("ctx::")&&(this.options.securityContext=t.securityContext.replace("ctx::",""));var i=widget.getPreference(t.credentialsPrefName);i?(b.credentials=i.options.map(function(e){return{label:e.label,value:e.value.startsWith("ctx::")?e.value.replace("ctx::",""):e.value}}),p.addCredentialList(t,b.credentials)):p.getCredentialsList(t).promise.then(function(e){b.credentials=e}),window.documentDictionaryLoadStart=new Date,u.getDimensions(t).promise.then(function(e){b.dimensions=e},function(e){console.error("CreateNew: Failed to load Dimensions",e)}),d.getTypeInfos(t).promise.then(function(e){b.docTypesList=e},function(e){console.error("CreateNew: Failed to load Types",e)}),this.elements.container=e.createElement("div",{class:this.getClassNames()}),n.loader=new m({text:s.get("LOADING"),showButtonFlag:!0}),n.loader.canceller=f.deferred(),n.loader.elements.stopButton.addEventListener("buttonclick",function(e){n.loader.canceller.reject("usercancelled")})},generateForm:function(){var e=this;this.startLoading();var t=b.selectedFiles.length>1,n=function(t){e.valueChanged(t,e)};new c({doctypes:b.docTypesList,dimensions:b.dimensions,container:this.elements.container,events:{change:n},fields:[{type:"header",class:"header1",text:s.get("Head_Info_1").replace("{nbFiles}",b.selectedFiles.length),styles:{display:t?"block":"none"}},{type:"header",class:"header2",text:s.get("Head_Info_2"),styles:{display:t?"block":"none"}},{type:"text",label:s.get("Title"),display:t?"none":"block",settings:{domId:"Title",selectAllOnFocus:!0,displayClearFieldButtonFlag:!1,requiredFlag:!0,pattern:".*\\S+.*"},additionalAttributes:{Style:"width:100%;"},events:{change:n,uncommittedChange:n}},{type:"combobox",label:s.get("Document_Type"),display:"block",settings:{domId:"ENOX_Document_Type",elementsList:e.filteredTypes,selectedIndex:widget.getPreference("lastSelected")?widget.getPreference("lastSelected").defaultValue:0,enableSearchFlag:!0,requiredFlag:!0},additionalAttributes:{Style:"width:100%;"},events:{change:function(t){e.docTypeChanged(t,e)}}},{type:"file",label:s.get("File"),display:t?"none":"block",settings:{domId:"file",blob:b.selectedFiles[0],width:"100%",requiredFlag:!0},events:{change:e.fileChanged}},{type:"combobox",label:s.get("Credentials"),display:"block",settings:{domId:"credentials",elementsList:b.credentials,selectedIndex:0,value:e.options.securityContext,enableSearchFlag:!0,requiredFlag:!0},additionalAttributes:{Style:"width:100%;"},events:{change:n}},{type:"accordeon",items:[{doctypeDefault:"Document",id:"ShowMore",header:s.get("Show_more"),content:[{type:"textarea",display:t?"none":"block",label:s.get("Description"),settings:{domId:"Description",newLineMode:"enter",nbRows:5},additionalAttributes:{Style:"width:100%;"},events:{change:n}},{type:"text",display:t?"none":"block",label:s.get("Collaborative_Policy"),settings:{domId:"Policy",value:s.get("Policy_Name"),disabled:!0},additionalAttributes:{Style:"width:100%;"}}]}],styles:"simple",exclusive:!1,domId:"accordeon",display:t?"none":"block"},{type:"grid",display:t?"block":"none",identifier:"selectedFilesListId",treeDocument:e.generategridTree(b.selectedFiles),columns:[{text:s.get("Title"),dataIndex:"name",typeRepresentation:"string",alignment:"near",width:"100%",minWidth:"30",height:"150",alwaysVisibleFlag:!0,editableFlag:!1}],cellSelection:"none",rowSelection:"none",selectionBehavior:{selectNodeModelOnCellSelection:!1},showBackgroundFlag:!0,columnDragEnabledFlag:!1,showSelectionCheckBoxesFlag:!1,defaultColumnDef:{minWidth:30,width:"auto",sortableFlag:!0},layoutOptions:{columnsHeader:!0,rowsHeader:!1}}]}),e.finishLoading()},startLoading:function(){t.mask(this.elements.container)},finishLoading:function(){t.unmask(this.elements.container)},docTypeChanged:function(e,t){try{t.valueChanged(e,t);var n=c.elements.DCN_CustomAttributes;n&&n.remove(),c.prototype.appendDynamicAttributes(e.dsModel.value,c.elements.accordeon),widget.addPreference({name:"lastSelected",type:"hidden",defaultValue:e.dsModel.selectedIndex})}catch(e){console.error(e)}},fileChanged:function(e){let t=e.dsModel.value,n=t.name;b.selectedFiles.length=0,b.selectedFiles.push(t),n=-1==n.indexOf(".")?n:n.substring(0,n.lastIndexOf(".")),c.elements.Title&&(c.elements.Title.value.length>0?c.elements.Title.value=n:(c.elements.Title.value=n,c.elements.Title._giveFocus()))},generategridTree:function(){var e=new i;e.prepareUpdate();for(var t=0;t<b.selectedFiles.length;t++){var n=b.selectedFiles[t];e.addRoot(new o({label:n.name,grid:{name:n.name}}))}return e.expandAll(),e.pushUpdate(),e},addChilds:function(e,t,n,i){var o=this,s=b.docTypesList[e].childs;s&&s.forEach(function(s){var a={label:b.docTypesList[s].nls,icon:b.docTypesList[s].icon,value:s};t.includes(s)||i.includes(e)||"No"!=b.docTypesList[e].abstract||(n.unshift(a),i.push(e),o.addChilds(s,t,n,i))})},filterTypes:function(){var e=[],t=this.options.supportedTypes;if(!t||!t.includedTypes&&!t.excludedTypes){Object.keys(b.docTypesList).forEach(function(t){"No"==b.docTypesList[t].abstract&&e.unshift({label:b.docTypesList[t].nls,icon:b.docTypesList[t].icon,value:t})});var n=e.findIndex(e=>"Document"===e.value);if(n>0){var i=e.splice(n,1);e.unshift(i[0])}return e}var o=[];for(var s in b.docTypesList){var a={label:b.docTypesList[s].nls,icon:b.docTypesList[s].icon,value:s};!t.includedTypes.includes("*")&&!t.includedTypes.includes(s)||t.excludedTypes.includes(s)||o.includes(s)||"No"!=b.docTypesList[s].abstract||(e.unshift(a),o.push(s),this.addChilds(s,t.excludedTypes,e,o))}return e},appendInheritedAttributes:function(t,n){if(b.docTypesList[t]){var i=b.docTypesList[t].attributes;i&&i.length>0&&i.forEach(function(e){n.attributes.unshift(e)});var o=b.docTypesList[t].interfaces;o&&e.merge(n.deploy_interfaces,o),this.appendInheritedAttributes(b.docTypesList[t].parent,n)}},formatInputValues:function(e){var t=void 0;if(Array.isArray(e)){var n=[];e.forEach(function(e){n.push(e instanceof Date?e:e.toString())}),n.length>0&&(t=n)}else null!=e&&(t=e instanceof Date?e:e.toString());return t},createAndUpload:function(e){var t=this,n=b.selectedFiles.length>1;if(n||!n&&c.elements.Title&&c.elements.Title.value.trim().length>0){var i=c.elements.ENOX_Document_Type.value,o={},s={attributes:[]};c.prototype.appendInheritedAttributes(i,s),s.attributes.forEach(function(e){var n=t.formatInputValues(c.elements[e.Name.replace(" ","_")].value);n&&(o[e.Name]=n)}),b.selectedFiles.length>0?b.selectedFiles.forEach(e=>{var s={title:n?-1==e.name.indexOf(".")?e.name:e.name.substring(0,e.name.lastIndexOf(".")):c.elements.Title.value,type:i,description:n?"":c.elements.Description.value,custom_attributes:o,fileInfo:{file:e}};t.options.connector?(t.options.parentObject.parentId&&(s.relInfo={parentId:t.options.parentObject.parentId,parentRelName:t.options.parentRelName,parentDirection:"from"}),t.options.connector.uploadAttachment(s,t.options.parentObject,c.elements.credentials.value)):(t.options.parentId&&(s.relInfo={parentId:t.options.parentId,parentRelName:t.options.parentRelName,parentDirection:"from"}),t.uploadDocument(s,{tenant:t.options.tenant,securityContext:c.elements.credentials.value,documentType:c.elements.ENOX_Document_Type.value,tenantUrl:t.options.tenantUrl,getWorkUnderHeaders:t.options.getWorkUnderHeaders}))}):this.uploadDocument({title:n?"":c.elements.Title.value,description:n?"":c.elements.Description.value},{tenant:t.options.tenant,securityContext:c.elements.credentials.value,tenantUrl:t.options.tenantUrl,getWorkUnderHeaders:t.options.getWorkUnderHeaders}),e.close(),e.destroy(),t.options.onUploadStart&&t.options.onUploadStart()}else n||0!=c.elements.Title.value.trim().length||c.elements.Title.getContent().getParent().addClassName("has-error"),0==b.selectedFiles.length&&widget.getElement("#DCN_uploadBtn").dsModel.getContent().addClassName("has-error")},create:function(t){var n=this;g.createModal(n.options.containerToOverlay,this.loader.elements.container),n.loader.on(s.get("LOADING"));for(var i=0;i<t.length;i++)b.selectedFiles.push(t[i]);var o=new e.Promise(function(t,i){e.Promise.all([p.getCredentialsList(n.options).promise,d.getTypeInfos(n.options).promise,u.getDimensions(n.options).promise]).then(function(e){t(e)},function(e){i(e)})}),c=this.loader.canceller.promise;e.Promise.race([o,c]).then(function(e){var i,o,c=new Date-window.documentDictionaryLoadStart;if(n.options.connector?n.options.parentObject.parentId&&(i=n.options.parentObject.parentId,o=n.options.parentRelName):n.options.parentId&&(i=n.options.parentId,o=n.options.parentRelName),y.sendTrackerPageEvent({category:"docm.document.upload.ready",action:"click/drop",label:"Document Upload Ready",pd:{parentId:i,parentRelName:o},pv:{totalTimeTaken:c,success:1}}),n.loader.on(s.get("LOADING")),g.removeModal(n.options.containerToOverlay),b.credentials=e[0],b.docTypesList=e[1],b.dimensions=e[2],console.log(b.docTypesList),n.filteredTypes=n.filterTypes(),0==n.filteredTypes.length)n.options.onError&&n.options.onError({subtitle:s.get("INVALID_CONFIGURATION"),message:s.get("NO_DOCUMENT_TYPES_ALLOWED")});else{var d=!1;n.generateForm(),n.dialog=new a({title:s.get("Upload")+(t.length>1?" "+t.length+" - "+s.get("files"):""),content:n.getContent(),immersiveFrame:n.options.immersiveFrame,resizableFlag:!0,width:"500",modalFlag:!0,buttons:{Cancel:new r({label:s.get("Cancel"),onClick:function(e){e.dsModel.dialog.close(),e.dsModel.dialog.destroy(),n.options.onCancel&&n.options.onCancel()},tooltipInfos:new l({title:s.get("Cancel"),mouseRelativePosition:!1})}),Ok:new r({label:s.get("Upload"),emphasize:"primary",domId:"DCN_uploadBtn",onClick:function(e){d=!0,n.createAndUpload(e.dsModel.dialog)},tooltipInfos:new l({title:s.get("Upload"),mouseRelativePosition:!1})})}}),n.dialog.elements._modalDiv.addClassName("document-createNew-modal"),n.dialog.addEventListener("close",function(){d||n.options.onCancel()})}},function(e){var t,i,o=new Date-window.documentDictionaryLoadStart;n.options.connector?n.options.parentObject.parentId&&(t=n.options.parentObject.parentId,i=n.options.parentRelName):n.options.parentId&&(t=n.options.parentId,i=n.options.parentRelName),y.sendTrackerPageEvent({category:"docm.document.upload.ready",action:"click/drop",label:"Document Upload Ready",pd:{parentId:t,parentRelName:i},pv:{totalTimeTaken:o,failure:0}}),n.options.onError&&"usercancelled"!=e&&n.options.onError(e),n.options.onCancel&&"usercancelled"==e&&n.options.onCancel(),g.removeModal(n.options.containerToOverlay)})},selectFilesAndCreate:function(){var t=this,n=e.createElement("input",{attributes:{type:"file",multiple:!0},styles:{display:"none"},events:{change:function(e){var i=e.target&&e.target.files&&e.target.files.length>0?e.target.files:e.dataTransfer.files;t.create(i),n.destroy()}}}).inject(document.body);n.click()},valueChanged:function(t,n){var i=t.dsModel.value;(e.is(t.dsModel.selectedIndex,"number")&&(i=t.dsModel.currentLabel),t.dsModel.tooltipInfos.shortHelp=i,t.dsModel._properties)&&(t.dsModel._properties.requiredFlag&&n.validateInputs(t))},validateInputs:function(t){if(this.dialog&&this.dialog.buttons&&this.dialog.buttons.Ok&&this.dialog.buttons.Ok.getModel()){var n=this.dialog.buttons.Ok.getModel();n.disabled=!1;for(var i=0,o=Object.keys(c.elements),s=0;0==i&&s<o.length;s++){var a=c.elements[o[s]];if(a.requiredFlag)a.requiredFlag&&(e.is(a.valueToCommit,"string")?a.valueToCommit&&0!=a.valueToCommit.trim().length||i++:a.value&&0!=a.value.length||i++)}i>0&&(n.disabled=!0)}}});return b.prototype.uploadDocument=function(t,i){var o=this,a={tenant:i.tenantId,securityContext:i.securityContext,tenantUrl:i.tenantUrl,additionalHeaders:e.is(i.getWorkUnderHeaders,"function")?i.getWorkUnderHeaders():{},onFailure:function(e){var n=new Date-l.documentUploadStart;y.sendTrackerPageEvent({category:"docm.document.upload.complete",action:"click",label:"Document Upload Done",pd:{parentId:void 0,parentRelName:void 0,securityContext:i.securityContext,docType:t.type,fileType:h.getFileExtension(t.fileInfo.file.name),filesize:t.fileInfo.file.size},pv:{totalTimeTaken:n,failure:0}}),D.jobs.finishJob(l,"failed"),o.options.onError&&(e.internalError.contains("No create access")?o.options.onError({title:s.get("DOCUMENT_CANNOT_BE_CREATED_X",{type:i.documentType}),subtitle:s.get("Document_Create_Error_Subtitle"),message:s.get("Document_Create_Error_Message")}):o.options.onError({title:s.get("DOCUMENT_CANNOT_BE_CREATED"),message:e&&e.error||s.get("X_CANNOT_BE_CREATED",{title:t.title})}))},onProgress:function(e){l.update(e)},onComplete:function(e){var n=new Date-l.documentUploadStart;y.sendTrackerPageEvent({category:"docm.document.upload.complete",action:"click",label:"Document Upload Done",pd:{parentId:void 0,parentRelName:void 0,securityContext:i.securityContext,docType:t.type,fileType:h.getFileExtension(t.fileInfo.file.name),filesize:t.fileInfo.file.size},pv:{totalTimeTaken:n,success:1}});e.data;if(D.jobs.finishJob(l),o.options.onDocumentUpload){var a={notification:{title:s.get("DOCUMENT_CREATED"),subtitle:s.get("X_HAS_BEEN_CREATED_SUCCESSFULLY",{title:t.title})},documents:e.data};t.relInfo&&(a.relInfo=t.relInfo),o.options.onDocumentUpload(a)}},customDocumentObject:t.custom_attributes?{dataelements:t.custom_attributes}:void 0,preProcess:function(e){console.log("docJson"),console.log(e)}},r=t.title;t.fileInfo&&(r=t.fileInfo.file.name);var l={title:s.get("UPLOADING_X",{title:r}),ui:!!t.fileInfo,process:function(){l.documentUploadStart=new Date,l.xhr=n.createDocument(t,a)}};D.jobs.addJob(l)},b});