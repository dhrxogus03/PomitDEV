define("DS/CSIViewModelWebImplement/CSIVMClientObject",["UWA/Core","DS/CSIViewModelWebInterfaces/CSIVMClientStateMode"],function(e,t){"use strict";class i{constructor(){this._childrenMapping=void 0,this._children=void 0,this._parents=void 0,this._associatedObject=void 0,this._withTempoState=void 0,this._childrenTempo=void 0,this._parentsTempo=void 0,this._associatedObjectTempo=void 0}initTempoChildren(){e.is(this._childrenTempo)||(!0===this._childrenMapping?this._childrenTempo=new Map(this._children):this._childrenTempo=void 0!==this._children?this._children.slice():[],this._withTempoState=!0)}initTempoParents(){void 0===this._parentsTempo&&(this._parentsTempo=void 0!==this._parents?this._parents.slice():[],this._withTempoState=!0)}abort(){this._childrenTempo=void 0,this._parentsTempo=void 0,this._associatedObjectTempo=void 0,this._withTempoState=!1}commit(){this._withTempoState&&(void 0!==this._childrenTempo&&(this._children=this._childrenTempo),void 0!==this._parentsTempo&&(this._parents=this._parentsTempo),void 0!==this._associatedObjectTempo&&(this._associatedObject=this._associatedObjectTempo),this.abort())}getProperty(e,i){let a=void 0;switch(i){case t.Tempo:case t.TempoOrPermanent:void 0===(a=this[e+"Tempo"])&&(a=this[e]);break;case t.Permanent:a=this[e]}return a}setAssociatedObject(e){this._withTempoState=!0,this._associatedObjectTempo=e}getAssociatedObject(e){return this.getProperty("_associatedObject",e)}addChild(e){this.initTempoChildren(),!0===this._childrenMapping?this._childrenTempo.set(e.getLocalId(),e):this._childrenTempo.push(e)}addChildren(e){if(this.initTempoChildren(),!0===this._childrenMapping){let t,i=e.length;for(let a=0;a<i;++a)t=e[a],this._childrenTempo.set(t.getLocalId(),t)}else{let t=e.length,i=this._childrenTempo.length;t+=i,this._childrenTempo.length=t;for(let a=i;a<t;++a)this._childrenTempo[a]=e[a-i]}}removeChild(e){if(this.initTempoChildren(),!0===this._childrenMapping)this._childrenTempo.delete(e.getLocalId());else{let t=this._childrenTempo.indexOf(e);t>-1&&this._childrenTempo.splice(t,1)}}removeChildren(e){this.initTempoChildren();let t,i,a=e.length;if(!0===this._childrenMapping)for(t=0;t<a;++t)i=e[t],this._childrenTempo.delete(i.getLocalId());else{let r=-1;for(t=0;t<a;++t)i=e[t],(r=this._childrenTempo.indexOf(i))>-1&&this._childrenTempo.splice(r,1)}}getChildren(e){let t,i=this.getProperty("_children",e);return void 0!==i&&(t=!0===this._childrenMapping?Array.from(i.values()):i),t}getMappedChildren(e){return!0===this._childrenMapping?this.getProperty("_children",e):void 0}addParent(e){this.initTempoParents(),this._parentsTempo.push(e)}removeParent(e){this.initTempoParents();let t=this._parentsTempo.indexOf(e);t>-1&&this._parentsTempo.splice(t,1)}getParents(e){return this.getProperty("_parents",e)}}class a{constructor(e,t,i){this._ViewDatas=void 0,this._localId=t,this._idPattern=i,this._nameSpace=e,this._additionalObjects=void 0,this._dualObj=void 0,this._dualViewType=void 0,this._mainObj=void 0,this._childrenMapping=void 0}clear(){void 0!==this._ViewDatas&&delete this._ViewDatas}getLocalId(){return this._localId}getIdPattern(){return this._idPattern}getNameSpace(){return this._nameSpace}getMainObject(){return this._mainObj}addObject(){void 0===this._additionalObjects&&(this._additionalObjects=[]);let e=new a(this._nameSpace,this._localId,this._idPattern);return e._mainObj=this,e._dualObj=this._dualObj,e._dualViewType=this._dualViewType,this._additionalObjects.push(e),e}getAdditionalObjects(){return this._additionalObjects}getViewData(e){let t=void 0;return void 0!==this._ViewDatas&&(t=this._ViewDatas[e.getViewType()]),t}getOrCreateViewData(e){let t=void 0,a=e.getViewType();return void 0!==this._ViewDatas&&(t=this._ViewDatas[a]),void 0===t&&(void 0===this._ViewDatas&&(this._ViewDatas={}),t=new i,!0===this._childrenMapping&&(t._childrenMapping=!0),this._ViewDatas[a]=t),t}deleteViewData(e){if(void 0!==this._ViewDatas&&void 0!==e&&(delete this._ViewDatas[e.getViewType()],0===Object.keys(this._ViewDatas).length&&delete this._ViewDatas,void 0!==this._dualObj)){this._dualObj.getDualObject(e.getViewType())===this&&this._dualObj.setDualObject(),this.setDualObject()}}isEmpty(){if(void 0!==this._additionalObjects){let e=0,t=this._additionalObjects.length;for(e=0;e<t;e++)if(!this._additionalObjects[e].isEmpty())return!1}return void 0===this._ViewDatas&&!this.isRoot()}isTemporary(){let e=void 0,i=void 0;if(void 0!==this._ViewDatas)for(e of Object.values(this._ViewDatas))if(void 0!==(i=this.isRoot()?e.getChildren(t.Permanent):e.getParents(t.Permanent)))return!1;return!0}associateViewElt(e,t){let i=this.getOrCreateViewData(e);void 0!==i&&i.setAssociatedObject(t)}getAssociatedViewElt(e){let i=void 0,a=this.getViewData(e);return void 0!==a&&(i=a.getAssociatedObject(t.TempoOrPermanent)),i}getKey(e){let i=void 0,a=void 0;if(void 0!==this._ViewDatas)for(let r of Object.keys(this._ViewDatas)){if((a=this._ViewDatas[r].getAssociatedObject(t.Tempo))===e){i=this.getNameSpace().getTreeKeyFromViewType(r);break}if((a=this._ViewDatas[r].getAssociatedObject(t.Permanent))===e){i=this.getNameSpace().getTreeKeyFromViewType(r);break}}return i}setRoot(){this._isRoot=!0,this._nameSpace.setRootObject(this)}isRoot(){return!0===this._isRoot}isLeaf(e){let i=!0,a=this.getChildren(e,t.TempoOrPermanent);return void 0!==a&&a.length>0&&(i=!1),i}activateChildrenMapping(){this._childrenMapping=!0}addChild(e,t){let i=this.getOrCreateViewData(e);void 0!==i&&(i.addChild(t),t.addParent(e,this))}addChildren(e,t){let i=this.getOrCreateViewData(e);if(void 0!==i){i.addChildren(t);let a=t.length;for(let i=0;i<a;i++)t[i].addParent(e,this)}}addParent(e,t){let i=this.getOrCreateViewData(e);void 0!==i&&i.addParent(t)}removeChild(e,t){let i=this.getOrCreateViewData(e);void 0!==i&&(i.removeChild(t),t.removeParent(e,this))}removeChildren(e,t){let i=this.getOrCreateViewData(e);if(void 0!==i){i.removeChildren(t);let a=t.length;for(let i=0;i<a;i++)t[i].removeParent(e,this)}}removeParent(e,t){let i=this.getOrCreateViewData(e);void 0!==i&&i.removeParent(t)}getChildren(e,t){let i=void 0,a=this.getViewData(e);return void 0!==a&&(i=a.getChildren(t)),i}getMappedChildren(e,t){let i=void 0,a=this.getViewData(e);return void 0!==a&&(i=a.getMappedChildren(t)),i}getAllChildren(e){let t,i,a,r=[],s=void 0,n=void 0,o=void 0;if(void 0!==this._ViewDatas)for(s of Object.keys(this._ViewDatas))if(void 0!==(o=(n=this._ViewDatas[s]).getChildren(e)))for(t=o.length,i=0;i<t;i++)a=o[i],r.indexOf(a)<0&&r.push(a);return r}getAllParents(e){let t,i,a,r=[],s=void 0,n=void 0,o=void 0;if(void 0!==this._ViewDatas)for(s of Object.keys(this._ViewDatas))if(void 0!==(o=(n=this._ViewDatas[s]).getParents(e)))for(t=o.length,i=0;i<t;i++)a=o[i],r.indexOf(a)<0&&r.push(a);return r}getFirstParentsDefiningNameSpaceOfThis(e){let i,a=[];if(void 0===e){if((i=this.getIdPattern()._idSpace)===this.getIdPattern()._idContext)return a}else i=e;let r=this.getAllParents(t.Tempo),s=r.length;if(s)if(r[0].getIdPattern()._idContext===i)for(let e=0;e<s;e++){if(r[e].getIdPattern()._idContext!==i)return;a.push(r[e])}else{let e=0;for(;!a.length&&e<s;)a=r[e].getFirstParentsDefiningNameSpaceOfThis(i),e++}return a}getParents(e,t){let i=void 0,a=this.getViewData(e);return void 0!==a&&(i=a.getParents(t)),i}getChildrenWithId(e,t,i){let a=[];if(void 0===i)return a;if(!0===this._childrenMapping){let r=this.getMappedChildren(e,t);if(void 0!==r){let e=i.length;if(r.size===e)a=Array.from(r.values());else{let t,s,n;for(t=0;t<e;++t)"string"==typeof(n=i[t])&&(n=parseInt(n)),void 0!==(s=r.get(n))&&a.push(s)}}}else{let r=this.getChildren(e,t);if(void 0!==r){let e=r.length,t=i.length;if(e===t)a=r;else{let s,n,o=new Map;for(s=0;s<e;++s)void 0!==(n=r[s])&&o.set(n.getLocalId().toString(),n);for(s=0;s<t;++s)void 0!==(n=o.get(i[s]))&&a.push(n)}}}return a}preCommit(i){if(this._nameSpace._errManager.addContext({name:"preCommit",arguments:arguments}),void 0!==this._additionalObjects){let e,t=0,a=this._additionalObjects.length;for(t=0;t<a;t++)(e=this._additionalObjects[t]).preCommit(i)}let a=this.getViewData(i);if(void 0!==a){let r=a.getParents(t.Tempo);if(!(this.isRoot()||e.is(r)&&0!==r.length)){let e=0,r=a.getChildren(t.Tempo);if(void 0!==r){let t,a=r.length;for(e=0;e<a;e++)(t=r[e]).removeParent(i,this),t.preCommit(i)}this.deleteViewData(i)}}this._nameSpace._errManager.cleanContext(arguments)}commit(e){if(this._nameSpace._errManager.addContext({name:"commit",arguments:arguments}),void 0!==this._additionalObjects){let t,i=0,a=this._additionalObjects.length;for(i=0;i<a;i++)(t=this._additionalObjects[i]).commit(e)}let t=this.getViewData(e);void 0!==t&&t.commit(),this._nameSpace._errManager.cleanContext(arguments)}abort(e){if(this._nameSpace._errManager.addContext({name:"abort",arguments:arguments}),void 0!==this._additionalObjects){let t=0;for(t=this._additionalObjects.length-1;t>=0;t--)this._additionalObjects[t].isTemporary()?this._additionalObjects.splice(t,1):this._additionalObjects[t].abort(e)}let t=this.getViewData(e);void 0!==t&&t.abort(),void 0!==this._dualObj&&this._dualObj.setDualObject(e.getViewType(),this),this._nameSpace._errManager.cleanContext(arguments)}setDualObject(e,t){this._dualObj=t||void 0,this._dualViewType=e}getDualObject(e){let t=void 0;return e!==this._dualViewType&&void 0!==e||(t=this._dualObj),t}getGlobalId(){return this._idPattern&&this._localId?`${this._idPattern._idContext}#${this._localId}`:null}}return a}),define("DS/CSIViewModelWebImplement/CSIVMErrorManager",[],function(){function e(){this._activeState=!1,this._debugContext=[]}return e.prototype.setDebugMode=function(e){let t=this;t._activeState=1==e&&e,t._activeState&&(window.onerror=function(e,i,a,r,s){t._activeState&&(console.error("Context",t._debugContext),console.error("StackTrace",s))})},e.prototype.addContext=function(e){this._activeState&&this._debugContext.push(e)},e.prototype.cleanContext=function(e){let t=this;t._activeState&&0!=t._debugContext.length&&-1!=(index=function(){for(let i in t._debugContext)if(e==t._debugContext[i].arguments)return i;return-1}())&&t._debugContext.splice(index)},e}),define("DS/CSIViewModelWebImplement/CSIVMStringMap",[],function(){"use strict";function e(){this._data=new Map,this.clear()}return e.prototype.clear=function(){this._data.clear()},e.prototype.createValue=function(e,t){if(void 0===e)return;let i=e.toString(),a=this._data.get(i);Array.isArray(a)?a.push(t):this._data.set(i,[t])},e.prototype.size=function(e){return this._data.size},e.prototype.get=function(e){if(void 0!==e)return this._data.get(e.toString())},e.prototype.remove=function(e,t){if(void 0!==e){let i=e.toString(),a=!0;if(void 0!==t){let e=this._data.get(i);if(Array.isArray(e)){let i=e.indexOf(t);i>-1&&e.splice(i,1),e.length>0&&(a=!1)}}a&&this._data.delete(i)}},e.prototype.forEachValue=function(e,t){let i,a,r,s;if(void 0!==t){if(s=this._data.get(t.toString()),Array.isArray(s))for(a=s.length,i=0;i<a;++i)r=s[i],e(r)}else this._data.forEach(function(t){if(Array.isArray(t))for(a=t.length,i=0;i<a;++i)r=t[i],e(r)})},e.prototype.findValue=function(e){let t,i,a=this._data.values(),r=a.next();for(;!r.done&&void 0===t;)i=r.value,Array.isArray(i)&&(t=i.find(function(t){return e(t)})),r=a.next();return t},e}),define("DS/CSIViewModelWebImplement/CSIVMClientNameSpace",["UWA/Core","DS/CSIViewModelWebImplement/CSIVMClientObject","DS/CSIViewModelWebImplement/CSIVMStringMap","DS/CSIViewModelWebInterfaces/CSIVMClientTreeKey","DS/CSIViewModelWebInterfaces/CSIVMClientStateMode"],function(e,t,i,a,r){"use strict";const s="#",n="/";return class{constructor(e,t,a=!1){this._treeKeys={},this._objects=new i,this._uuid=e,this._model=t,this._errManager=t.getErrorManager(),this._rootObj=void 0,this._isMain=a}clear(e){if(void 0!==e){delete this._treeKeys[e.getViewType()];let t=e.getUUID();this._model.removeTreeKey(t)}(this.isEmpty()||void 0===e)&&(void 0!==this._objects&&this._objects.clear(),this._treeKeys={},this._rootObj=void 0)}isEmpty(){return null==this._treeKeys||0===Object.keys(this._treeKeys).length||0==this._objects.size()}addTreeKey(e){void 0!==e&&(this._treeKeys[e.getViewType()]=e)}getTreeKey(e){return this._model.getTreeKey(e)}getAllTreeKeys(){return Object.values(this._treeKeys)}getTreeKeyFromViewType(e){return this._treeKeys[e]}isNameSpaceOfTreeKey(e){return void 0!==e&&this._treeKeys[e.getViewType()]===e}setRootObject(e){this._rootObj=e}getRootObject(){return this._rootObj}getObjects(e,t){let i=[];return this._objects.forEachValue(function(t){t.getIdPattern()===e&&i.push(t)},t),i}getObjectsFromCtx(e,t){let i=[];return this._objects.forEachValue(function(t){t.getIdPattern()._idContext===e&&i.push(t)},t),i}createObject(e,i){let a=void 0;return this._model.isAnExistingIdPattern(e)&&(a=new t(this,i,e),this._objects.createValue(i,a)),a}getOrCreateObject(e,t){let i=void 0,a=this.getObjects(e,t);return i=a.length?a[0]:this.createObject(e,t)}removeObject(e){if(void 0!==e){let t=e.getLocalId();this._objects.remove(t,e);let i=e.getDualObject();void 0!==i&&i.getDualObject()===e&&i.setDualObject()}}pushNewExistingObject(e){if(0===this.getObjects(e._idPattern,e._localId).length){let t=this._objects.get(e._localId);t.length=0;let i=fromNamespace.getObjects(e._idPattern,e._localId);t.push(i[0])}}commit(e){this._errManager.addContext({name:"commit",arguments:arguments}),this._objects.forEachValue(function(t){t.preCommit(e)});let t=[];this._objects.forEachValue(function(i){i.isEmpty()?t.push(i):i.commit(e)});for(let e=t.length,i=0;i<e;++i){let e=t[i];this.removeObject(e)}this._errManager.cleanContext(arguments)}abort(e){this._errManager.addContext({name:"abort",arguments:arguments}),this._objects.forEachValue(function(t){t.abort(e)}),this._errManager.cleanContext(arguments)}buildGlobalId(e){this._errManager.addContext({name:"buildGlobalId",arguments:arguments});let t="",i="",a=null,r=null,o=null,d=!1,h=!0,l=!0;for(let c=e.length-1;c>=0;c--){let _=e[c],p=_.getIdPattern();a=p._idSpace,d=p._shared,i=(o=p._idContext)+s+_.getLocalId(),o&&a&&o===r&&(l=!0),l&&(h||(i+=n),h=!1,t=i+=t),(l=d)||(r=a)}return this._errManager.cleanContext(arguments),t}findNodesByIdentifier(e){let t=e.split(s),i=t[0],a=t[1];return this.getObjectsFromCtx(i,a)}has3D(){return e.is(this._treeKeys[a.ViewType.View3D])}}}),define("DS/CSIViewModelWebImplement/CSIVMClientModel",["DS/CSIViewModelWebImplement/CSIVMClientNameSpace","DS/CSIViewModelWebInterfaces/CSIVMClientTreeKey","DS/CSIViewModelWebInterfaces/CSIVMClientStateMode","DS/CSIViewModelWebImplement/CSIVMErrorManager"],function(e,t,i,a){"use strict";const r="/";class s{constructor(e,t,i){this._idSpace=e,this._idContext=t,this._shared=i}}return class{constructor(){this._nameSpaces=[],this._treeKeys={},this._errorManager={},this._idPatterns=[]}clear(){for(let e of this._nameSpaces)e.clear();this._nameSpaces=[],this._idPatterns=[],this._treeKeys={},this._errorManager={}}getOrCreateTreeKey(e,i,a,r){let s=this.getTreeKey(e);return void 0===s&&(s=new t(e,i,a,r),this._treeKeys[e]=s),s}getTreeKey(e){return this._treeKeys[e]}getTreeKeysFromViewType(e){let t=[];for(const i of Object.values(this._treeKeys))i.getViewType()===e&&t.push(i);return t}removeTreeKey(e){void 0!==this.getTreeKey(e)&&delete this._treeKeys[e]}getIdPattern(e,t,i){let a=void 0;if(void 0!==e&&void 0!==t&&void 0!==i){let r=0,s=this._idPatterns.length,n=null;for(r=0;r<s&&void 0===a;r++)(n=this._idPatterns[r])._idSpace===e&&n._idContext===t&&n._shared===i&&(a=n)}return a}isAnExistingIdPattern(e){let t=!1;return void 0!==e&&this._idPatterns.indexOf(e)>-1&&(t=!0),t}getOrCreateIdPattern(e,t,i){let a=void 0;return void 0!==e&&void 0!==t&&void 0!==i&&void 0===(a=this.getIdPattern(e,t,i))&&(a=new s(e,t,i),this._idPatterns.push(a)),a}getObject(e,t,i){let a=void 0,r=this.getNameSpace(e);if(void 0!==r){let e=r.getObjects(t,i);e.length&&(a=e[0])}return a}getNameSpaces(){return this._nameSpaces}createObject(e,t,i){let a=void 0,r=this.getNameSpace(e);return void 0!==r&&(a=r.createObject(t,i)),a}getOrCreateObject(e,t,i){let a=void 0,r=this.getNameSpace(e);return void 0!==r&&(a=r.getOrCreateObject(t,i)),a}getDualObject(e,t,i){let a=void 0,r=this.getTreeKeysFromViewType(e),s=0,n=r.length;for(s=0;s<n&&void 0===a;s++){let e=r[s],n=this.getNameSpace(e);if(void 0!==n){let e=n.getObjects(t,i);void 0!==e&&1===e.length&&(a=e[0])}}return a}getNameSpace(e){let t=void 0,i=0,a=this._nameSpaces.length,r=e.getNameSpaceId();for(i=0;i<a&&void 0===t;i++){let a=this._nameSpaces[i];a.isNameSpaceOfTreeKey(e)?t=a:a._uuid===r&&(t=a).addTreeKey(e)}return t}createNameSpace(t){let i=new e(t,this);return this._nameSpaces.push(i),i}getOrCreateNameSpace(e){let t=void 0;return void 0===(t=this.getNameSpace(e))&&e.getNameSpaceId().length>0&&(t=this.createNameSpace(e.getNameSpaceId())).addTreeKey(e),t}removeNameSpace(e){let t=this._nameSpaces.indexOf(e);t>-1&&this._nameSpaces.splice(t,1)}findNodesByIdentifier(e,t){let i=[],a=t,r=!1;if(t&&(i=t.findNodesByIdentifier(e)),0==i.length)for(let s of Object.values(this._nameSpaces))if(s!==t&&(i=s.findNodesByIdentifier(e)).length){a=s,r=!0;break}return[i,a,r]}addSharedObjectToNamespace(e,t,i){if(0===i.getObjects(e._idPattern,e._localId).length){i.createObject(e._idPattern,e._localId);let a=i._objects.get(e._localId);a.length=0;let r=t.getObjects(e._idPattern,e._localId);a.push(r[0])}}decodeGlobalId(e){this._errorManager.addContext({name:"decodeGlobalIdInternal",arguments:arguments}),void 0===e.State&&(e.State=i.Permanent),void 0===e.isOptimizedPath&&(e.isOptimizedPath=!0),void 0===e.namespace&&(e.namespace=this);const t=e.Node,a=e.Id,s=e.State,n=e.AuthorizePartialPath,o=e.isOptimizedPath,d=a.split(r);let h=e.namespace,l=null,c=[],_=!1,p=[],g=null,m=UWA.is(t)?t:h.getRootObject();o&&p.push(m);for(let t=0;t<d.length&&UWA.is(p);t++){let i,a=d[t],r=void 0;[i,l,_]=this.findNodesByIdentifier(a,h);let u=i.length;if(1===u)r=i[0];else if(u)for(let e=0;e<u&&!UWA.is(r);e++){let t=i[e].getFirstParentsDefiningNameSpaceOfThis(),a=t.length;for(let s=0;s<a&&!UWA.is(r);s++)p.indexOf(t[s])>=0&&(r=i[e])}if(!UWA.is(r)){p=void 0;break}if(_&&c.push(h),t===d.length-1)for(let t of c)t!==h&&(this.addSharedObjectToNamespace(r,h,t),e.onNewObjectInNamespace&&e.onNewObjectInNamespace(r,h,t));h=l;let f=r.getAdditionalObjects();if(UWA.is(f)){let e,t,i=r;r=void 0;for(let a=-1;a<f.length&&void 0===r;a++){t=(e=-1===a?i:f[a]).getAllParents(s);for(let i=0;i<t.length&&void 0===r;i++)t[i]===m&&(r=e)}}if(o){let e=r,t=[];for(;r!==m;){if(void 0===r){t=[];break}if(t.push(r),g=r.getAllParents(s),r=g[0],g.length>1){if(-1===g.indexOf(m)){console.warn("Impossible to create a full PathElement from the identifier."),!0!==n?p=void 0:p.splice(0,1);break}r=m}}if(p)for(let e=t.length-1;e>=0;e--)p.push(t[e]);m=e}else p&&p.push(r)}return this._errorManager.cleanContext(arguments),p}decodeGlobalIdToViewObjects(e,t,i,a,r){let s;this._errorManager.addContext({name:"decodeGlobalIdToViewObjects",arguments:arguments});const n=this.decodeGlobalId({Node:e,Id:i,State:a,isOptimizedPath:r,namespace:this.getNameSpace(t)});if(void 0!==n){s=[];let e=null;for(const i of n){if(void 0===(e=i.getAssociatedViewElt(t))){s=void 0;break}s.push(e)}}return this._errorManager.cleanContext(arguments),s}getErrorManager(){return Object.keys(this._errorManager).length?this._errorManager:(this._errorManager=new a,this._errorManager)}isEmpty(){for(const e of this._nameSpaces)if(!e.isEmpty())return!1;return!0}}});