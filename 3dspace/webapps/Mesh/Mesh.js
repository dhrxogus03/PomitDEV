var multiTabDecorations=function(){var e=null,t=[],i=0,r=0;this.addDecoration=function(n){e||(e=new Uint8Array(2048),t=[e]);var o=i;if(r+n.length>2048){var s=2048-r,a=r+n.length-2048;this.writeDecoration(n,0,s),r=0,e=new Uint8Array(2048),t.push(e),this.writeDecoration(n,s,a)}else this.writeDecoration(n,0,n.length);return i+=n.length,o+1},this.writeDecoration=function(t,i,n){for(var o=0;o<n;o++)e[r++]=t[i+o]},this.getConcatenatedBlocks=function(){if(0==i)return null;for(var e=new Uint8Array(i),r=0,n=0;n<t.length;n++)for(var o=0;o<2048;o++)e[r++]=t[n][o];return e}};define("DS/Mesh/Mesh",["DS/Mesh/ThreeJS_Base"],function(e){"use strict";var t=-2,i=i||{REVISION:"1"},r=new Set,n=null!=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent),o=new RegExp("Edge","i").test(navigator.userAgent);i.VertexComponentEnum={POSITION:0,NORMAL:1,DIFFUSE_COLOR:2,TEX_COORD_0:3,TEX_COORD_1:4,TEX_COORD_2:5,TEX_COORD_3:6,TEX_COORD_4:7,TEX_COORD_5:8,TEX_COORD_6:9,TEX_COORD_7:10,USER_COMPONENT_0:11},i.DataTypeEnum={UCHAR:0,USHORT:1,UINT:2,CHAR:3,SHORT:4,INT:5,FLOAT:6,DOUBLE:7},i.GeomTypeString={},function(){var t,r,n=["EDGE","WIRE_EDGE","BOUNDARY_EDGE","SHARP_EDGE","SMOOTH_EDGE","HIDDEN_SEAM_EDGE","BOUNDARY_POINT","SHARP_POINT","SMOOTH_POINT","HIDDEN_SEAM_POINT","SURFACIC_POINT","FREE_POINT","INFINITE_FACE","FACE","UNKNOWN","AXIS_SYSTEM"];for(t=0;t<n.length;t++)r=n[t],i.GeomTypeString[e.GeomTypeEnum[r]]=r;i.GeomTypeString[e.GeomTypeEnum.SMOOTH_EDGE|e.GeomTypeEnum._HIGH_CURVATURE_EDGE]="SMOOTH_EDGE"}(),i.sizeOfDataType=function(e){switch(e){case i.DataTypeEnum.FLOAT:case i.DataTypeEnum.INT:case i.DataTypeEnum.UINT:return 4;case i.DataTypeEnum.CHAR:case i.DataTypeEnum.UCHAR:return 1;case i.DataTypeEnum.SHORT:case i.DataTypeEnum.USHORT:return 2;case i.DataTypeEnum.DOUBLE:return 8;default:return 0}},i.ConnectivityTypeEnum={TRIANGLES:0,TRIANGLE_FAN:1,TRIANGLE_STRIP:2,LINES:3,LINE_STRIP:4,LINE_LOOP:5,POINTS:6},i.PointSymbolEnum={CROSS:0,PLUS:1,CONCENTRIC:2,COINCIDENT:3,FULLCIRCLE:4,FULLSQUARE:5,STAR:6,DOT:7,SMALLDOT:8,UNKNOWN:255},i.LinePatternEnum={UNKNOWN:0,SOLID:1,DOTTED:2,DASHED:3,DOTDASHED:4,PHANTOM:5,SMALLDOTTED:6,JISAXIS:7},i.NOPICKABLE=0,i.PICKABLE=1,i.PICKTHROUGH=2;var s=0;Object.defineProperty(i,"NODRAWHL",{get:function(){return s<20&&(e.getWebVisualizationLevel()>425?console.error("NODRAWHL deprecated, use PICKTHROUGH instead"):console.warn("NODRAWHL deprecated, use PICKTHROUGH instead"),s++),i.PICKTHROUGH},set:function(e){}}),i.INVISIBLE=2,i.PICK_NEVER=0,i.PICK_ALWAYS=1,i.PICK_VISIBLE=2,i.PICK_INVISIBLE=3,i.Color=function(e,t,i,r){this.r=e||0,this.g=t||0,this.b=i||0,this.a=null==r?1:r},i.Color.prototype={constructor:i.Color,setRGBA:function(e,t,i,r){this.r=e,this.g=t,this.b=i,this.a=r},copy:function(e){this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a},isEqual:function(e){return this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a},clone:function(){return new i.Color(this.r,this.g,this.b,this.a)}},i.FillAttributes=function(e,t,r){this.color=e||new i.Color,this.solid=t||this.solid||0,this.basic=r||this.basic||!1},i.FillAttributes.prototype={constructor:i.FillAttributes,isEqual:function(e){return null!==e&&this.color.isEqual(e.color)&&this.solid===e.solid&&this.basic===e.basic},clone:function(){return new i.FillAttributes(this.color.clone(),this.solid)}},i.LineAttributes=function(e,t,r){this.color=e||new i.Color,this.thickness=Math.round(t)>1?Math.round(t):1,this.pattern=r||i.LinePatternEnum.SOLID,this.forceMaterial=!1},i.LineAttributes.prototype={constructor:i.LineAttributes,isEqual:function(e){return null!==e&&this.color.isEqual(e.color)&&this.thickness===e.thickness&&this.pattern===e.pattern&&this.forceMaterial===e.forceMaterial&&(this.forceLineWidth===e.forceLineWidth||1==this.thickness)},clone:function(){return new i.LineAttributes(this.color.clone(),this.thickness,this.pattern)}},i.PointAttributes=function(e,t,r){this.color=e||new i.Color,this.size=t||1,this.symbol=r||i.PointSymbolEnum.CROSS,this.forceMaterial=!1},i.PointAttributes.prototype={constructor:i.PointAttributes,isEqual:function(e){return null!==e&&this.color.isEqual(e.color)&&this.size===e.size&&this.forceMaterial===e.forceMaterial&&this.symbol===e.symbol},clone:function(){return new i.PointAttributes(this.color.clone(),this.size,this.symbol)}};var a=new i.FillAttributes,u=new i.LineAttributes,l=new i.PointAttributes;i.PrimitiveGroup=function(e){this.identifier=0,this.nbPrimitives=0,this.primitives=[],this.nbBuffers=0,this.buffers=[],this.material=null,this.fillAttr=a,this.lineAttr=u,this.pointAttr=l,this.noz=!1,this.editable=!1,e&&(void 0!==e.fillGAS&&(this.fillAttr=e.fillGAS),void 0!==e.lineGAS&&(this.lineAttr=e.lineGAS),void 0!==e.pointGAS&&(this.pointAttr=e.pointGAS),void 0!==e.identifier&&(this.identifier=e.identifier),void 0!==e.editable&&(this.editable=e.editable),void 0!==e.noz&&(this.noz=e.noz))},i.PrimitiveGroup.prototype={constructor:i.PrimitiveGroup,addPrimitive:function(e){return this.primitives.push(e),this.nbPrimitives++,this},addBuffer:function(e,t){return this.buffers[e]=t,this.nbBuffers++,this},removeBuffer:function(e){this.buffers[e]=null,this.nbBuffers--},getBuffer:function(e){var t;for(t in this.buffers){var i=this.buffers[t];if(i.component===e)return i}return null},getBufferFromId:function(e){var t=this.buffers[e];return void 0!==t?t:null}},i.Buffer=function(e){this.indexBuffer=!1,this.size=0,this.component=i.VertexComponentEnum.POSITION,this.format=i.DataTypeEnum.FLOAT,this.dimension=3,this.data=null,e&&(e.indexBuffer&&(this.indexBuffer=!0),void 0!==e.component&&(this.component=e.component),void 0!==e.format&&(this.format=e.format),e.dimension&&(this.dimension=e.dimension),e.data&&(this.data=e.data))},i.Primitive=function(e){this.identifier=0,this.nbIndices=0,this.connectivity=i.ConnectivityTypeEnum.TRIANGLES,this.nbVertexComponents=0,this.geomType=null,this.vertexComponents=[],this.attr=null,this.material=null,e&&(void 0!==e.nbIndices&&(this.nbIndices=e.nbIndices),void 0!==e.connectivity&&(this.connectivity=e.connectivity),void 0!==e.geomType&&(this.geomType=e.geomType),void 0!==e.identifier&&(this.identifier=e.identifier),(e.fillGAS||e.lineGAS||e.pointGAS)&&(this.attr||(this.attr={fill:a,line:u,point:l}),e.fillGAS&&(this.attr.fill=e.fillGAS),e.lineGAS&&(this.attr.line=e.lineGAS),e.pointGAS&&(this.attr.point=e.pointGAS)))},i.Primitive.prototype={constructor:i.Primitive,addVertexComponent:function(e){return this.vertexComponents.push(e),this.nbVertexComponents++,this},_usedVertexColor:function(){for(var e=0;e<this.vertexComponents.length;e++)if(2==this.vertexComponents[e].component)return this.vertexComponents[e];return!1}},i.VertexComponent=function(e){this.component=i.VertexComponentEnum.POSITION,this.nbVertices=0,this.nbValuesPerVertex=0,this.format=i.DataTypeEnum.FLOAT,this.cardinality=0,this.bufferId="",this.offset=0,this.indices=null,e&&(void 0!==e.nbVertices&&(this.nbVertices=e.nbVertices),void 0!==e.cardinality&&(this.cardinality=e.cardinality),void 0!==e.bufferId&&(this.bufferId=e.bufferId),void 0!==e.indices&&(this.indices=e.indices),void 0!==e.offset&&(this.offset=e.offset))},i.IndexArray=function(e){this.format=i.DataTypeEnum.UINT,this.bufferId="",this.offset=0,e&&(void 0!==e.bufferId&&(this.bufferId=e.bufferId),void 0!==e.offset&&(this.offset=e.offset))},i.Material=function(){this.type="material",this.identifier=0,this._MaterialPropertiesActivate=1,this.colorAmbient=[],this.colorDiffuse=[],this.colorSpecular=[],this.shininess=0,this.ambientCoef=0,this.diffuseCoef=0,this.specularCoef=0,this.transparent=0,this.reflectivityCoef=0,this.textureId=-1,this.textureImageNumberComposante=0,this.textureBlending=e.TextureBlendOperations.BLEND,this.magFilter=0,this.minFilter=0,this.mappingFunction=0,this.textureWrapS=0,this.textureWrapT=0,this.addedComposantInTexEnv=0,this.shaderMaterial=null},i.Material.prototype={constructor:i.Material,clone:function(){return new i.Material}},i.SGNode=function(e){this.type=0,this.modelIdentification=null,e?(this.cgmId=void 0!==e.cgmId?e.cgmId:-1,void 0!==e.parent?this.parents=[e.parent]:void 0!==e.parents?this.parents=e.parents.slice():this.parents=[],this.solid=void 0!==e.solid&&e.solid):(this.cgmId=-1,this.parents=[],this.solid=!1)},i.SGNode.prototype={constructor:i.SGNode,getModelIdentification:function(){return this.modelIdentification},setModelIdentification:function(e){this.modelIdentification=e},getIdentificationObject:function(){return this.modelIdentification},setIdentificationObject:function(e){this.modelIdentification=e}},Object.defineProperty(i.SGNode.prototype,"parent",{get:function(){return this.parents.length?this.parents[0]:null},set:function(e){this.parents[0]=e}}),i.ThicknessTable=[1,1,2,3,4,5,6,7,8],i.GASCacheMask=4294963376,i.GraphicAttributeSet=function(e,t,i){this.set=e||0,this.rgba=t||0,this.webOverride=i||0},i.GraphicAttributeSet.prototype={constructor:i.GraphicAttributeSet,dump:function(){console.log("set  isNopick "+this.isNopick()+" isHighlight "+this.isHighlight()+" isLowlight "+this.isLowlight()+" isHidden "+this.isHidden()+" getType "+this.getType()+" isShowFree "+this.isShowFree()+" isTransparent "+this.isTransparent()+" getPriority "+this.getPriority()+" getThickness "+this.getThickness()+" getLineType "+this.getLineType()+" getColor "+this.getColor()),console.log("webOverride  getConnectivity "+this.getConnectivity()+" isBasic "+this.isBasic()+" isPBR "+this.isPBR()+" getPointSize "+this.getPointSize()+" isBlankingRep "+this.isBlankingRep()+" getVertexColor "+this.getVertexColor()+" getSymbol "+this.getSymbol()),console.log("color "+this.rgba)},setCacheValue:function(){this.set=this.set&i.GASCacheMask,this.getConnectivity()<2&&this.setBasic(!1)},setConnectivity:function(e){var t;switch(e){case i.ConnectivityTypeEnum.POINTS:t=0;break;case i.ConnectivityTypeEnum.LINES:case i.ConnectivityTypeEnum.LINE_STRIP:case i.ConnectivityTypeEnum.LINE_LOOP:t=1;break;case i.ConnectivityTypeEnum.TRIANGLES:case i.ConnectivityTypeEnum.TRIANGLE_STRIP:case i.ConnectivityTypeEnum.TRIANGLE_FAN:t=2;break;default:t=2}this._setConnectivity(t)},setNoPick:function(e){this.set&=-2,this.set|=1&e},setHighlight:function(e){this.set&=-3,this.set|=(1&e)<<1},setLowlight:function(e){this.set&=-5,this.set|=(1&e)<<2},setNoShow:function(e){this.set&=-9,this.set|=(1&e)<<3},setType:function(e){this.set&=-49,this.set|=(3&e)<<4},setShowFree:function(e){this.set&=-65,this.set|=(1&e)<<6},setTransparent:function(e){this.set&=-129,this.set|=(1&e)<<7},setPriority:function(e){this.set&=-3841,this.set|=(15&e)<<8},setLineThickness:function(e){this.set&=-258049,this.set|=(63&e)<<12},setLineType:function(e){this.set&=-16515073,this.set|=(63&e)<<18},setColor:function(e){this.set&=16777215,this.set|=(255&e)<<24},isNopick:function(){return 1&this.set},isHighlight:function(){return this.set>>1&1},isLowlight:function(){return this.set>>2&1},isHidden:function(){return this.set>>3&1},getType:function(){return this.set>>4&3},isShowFree:function(){return this.set>>6&1},isTransparent:function(){return this.set>>7&1},getPriority:function(){return this.set>>8&15},getThickness:function(){return this.set>>12&63},getLineType:function(){return this.set>>18&63},getColor:function(){return this.set>>24&255},setRGBAColor:function(e){this.rgba=e},setRGBAColorRGBChannel:function(e,t,i){this.rgba&=255,this.rgba|=(16777215&(e<<16|t<<8|i))<<8},setRGBAColorAlphaChannel:function(e){this.rgba&=-256,this.rgba|=255&e},getRGBAColor:function(){var e=[];return e[0]=this.rgba>>24&255,e[1]=this.rgba>>16&255,e[2]=this.rgba>>8&255,e[3]=255&this.rgba,e},_setConnectivity:function(e){this.webOverride&=-4,this.webOverride|=3&e},setBasic:function(e){this.webOverride&=-5,this.webOverride|=(1&e)<<2},setPBR:function(){this.webOverride&=-9,this.webOverride|=8},setPointSize:function(e){this.webOverride&=-1009,this.webOverride|=(63&e)<<4},_setBlanking:function(e){this.webOverride&=-1025,this.webOverride|=(1&e)<<10},setVertexColor:function(){this.webOverride&=-2049,this.webOverride|=2048},setSymbol:function(e){this.webOverride&=-61441,this.webOverride|=(15&e)<<12},getConnectivity:function(){return 3&this.webOverride},isBasic:function(){return this.webOverride>>2&1},isPBR:function(){return this.webOverride>>3&1},getPointSize:function(){return this.webOverride>>4&63},isBlankingRep:function(){return this.webOverride>>10&1},getVertexColor:function(){return this.webOverride>>11&1},getSymbol:function(){return this.webOverride>>12&15},isEqual:function(e,t){return!!(t&&3&this.webOverride)||this.set==e.set&&this.rgba==e.rgba&&this.webOverride==e.webOverride},getBlankingRep:function(){var e=this.getPriority();this.set=0,this.rgba=0,this.setConnectivity(i.ConnectivityTypeEnum.TRIANGLES),this.setPriority(e),this.setBasic(!0),this._setBlanking(!0)},set2DMode:function(){this.setRGBAColorAlphaChannel(255)},getDisplayedColor:function(){if(255==this.getColor())return this.getRGBAColor();var e=[];switch(this.getColor()){case 254:case 253:e[0]=0,e[1]=0,e[2]=0,e[3]=255;break;case 252:e[0]=62,e[1]=102,e[2]=85,e[3]=255;break;case 251:case 250:e[0]=255,e[1]=128,e[2]=0,e[3]=255;break;case 249:e[0]=0,e[1]=0,e[2]=0,e[3]=255;break;case 248:e[0]=255,e[1]=255,e[2]=255,e[3]=255;break;case 247:e[0]=255,e[1]=0,e[2]=0,e[3]=255;break;case 246:e[0]=0,e[1]=255,e[2]=0,e[3]=255;break;case 245:e[0]=0,e[1]=0,e[2]=255,e[3]=255;break;case 244:e[0]=255,e[1]=255,e[2]=0,e[3]=255;break;case 243:e[0]=255,e[1]=0,e[2]=255,e[3]=255;break;case 242:e[0]=0,e[1]=255,e[2]=255,e[3]=255;break;case 241:e[0]=0,e[1]=255,e[2]=0,e[3]=255;break;case 240:case 239:e[0]=255,e[1]=0,e[2]=0,e[3]=255;break;default:e[0]=0,e[1]=0,e[2]=0,e[3]=255}return e},getLineThicknessID:function(){return this.set>>12&63},getLineThickness:function(){var e=this.getLineThicknessID();return e=e>i.ThicknessTable.length?1:i.ThicknessTable[e]},isBackgroundColor:function(){return 254==this.getColor()},isForegroundColor:function(){return 253==this.getColor()},isNoZ:function(){return 0==this.getType()},isSolid:function(){return 3==this.getType()?1:0},clone:function(){return new i.GraphicAttributeSet(this.set,this.rgba,this.webOverride)}},i.SGBag=function(e){i.SGNode.call(this,e),e=e||{},this.type=1,this.attributes=void 0!==e.attributes?e.attributes:[],this.matrix=void 0!==e.matrix?e.matrix:null,this.children=void 0!==e.children?e.children:[],this.namingContext=void 0!==e.namingContext?e.namingContext:0,this.uuid_1=void 0!==e.uuid_1?e.uuid_1:null,this.uuid_2=void 0!==e.uuid_2?e.uuid_2:null,this.uuid_3=void 0!==e.uuid_3?e.uuid_3:null,this.uuid_4=void 0!==e.uuid_4?e.uuid_4:null,this.noShow=void 0!==e.noShow&&e.noShow},i.SGBag.prototype=Object.create(i.SGNode.prototype),i.SGBag.prototype.constructor=i.SGBag,i.SGBag.prototype.childClone=function(){var e=new Array;for(var t in this.children)e[t]="object"==typeof this.children[t]?this.children[t].clone():this.children[t];return e},i.SGBag.prototype.clone=function(){return new i.SGBag({cgmId:this.cgmId,type:this.type,attributes:this.attributes,children:this.childClone(),matrix:null!==this.matrix?this.matrix.clone():null,parents:this.parents,solid:this.solid,uuid_1:this.uuid_1,uuid_2:this.uuid_2,uuid_3:this.uuid_3,uuid_4:this.uuid_4,noShow:this.noShow})},i.SGBag.prototype.copyNoChildren=function(e){this.cgmId=e.cgmId,this.attributes=e.attributes,this.matrix=e.matrix,this.parents=e.parents.slice(),this.solid=e.solid,this.namingContext=e.namingContext,this.noShow=e.noShow,e.uuid_1&&(this.uuid_1=e.uuid_1,this.uuid_2=e.uuid_2,this.uuid_3=e.uuid_3,this.uuid_4=e.uuid_4)},i.SGBag.prototype.computeBoundingSphere=function(t){var i,r=new e.Sphere;for((t=t||new e.Sphere).reset(),i=0;i<this.children.length;i++)this.children[i].computeBoundingSphere(r),r.mergeWithSphere(t,t);return t},i.SGBag.prototype._computeOrientedBoundingBox=function(t,i,r,n,o){for(var s,a=new e.Box3,u=0;u<this.children.length;u++){(s=this.children[u]._computeOrientedBoundingBox(t,i,r,n,o))&&(a=a.union(s))}return a},i.UUID=function(){this.uuid_1=0,this.uuid_2=0,this.uuid_3=0,this.uuid_4=0},i.UUID.prototype={constructor:i.UUID,setFromUint32:function(e,t,i,r){this.uuid_1=e,this.uuid_2=t,this.uuid_3=i,this.uuid_4=r},toString:function(){return this.uuid_1.toString(16)+"_"+this.uuid_2.toString(16)+"_"+this.uuid_3.toString(16)+"_"+this.uuid_4.toString(16)},isEqual:function(e){return this.uuid_1===e.uuid_1&&this.uuid_2===e.uuid_2&&this.uuid_3===e.uuid_3&&this.uuid_4===e.uuid_4},clone:function(){var e=new i.UUID;return e.uuid_1=this.uuid_1,e.uuid_2=this.uuid_2,e.uuid_3=this.uuid_3,e.uuid_4=this.uuid_4,e}},i.SGRep=function(e){i.SGNode.call(this,e),this.type=2,this.attributes=[],e?(this.matrix=void 0!==e.matrix?e.matrix:null,this._primitives=void 0!==e.primitives?e.primitives:[],this.boundingSphere=void 0!==e.boundingSphere?e.boundingSphere:null,this.sag=void 0!==e.sag?e.sag:null,this.namingContext=void 0!==e.namingContext?e.namingContext:0,this.attributes=void 0!==e.attributes?e.attributes:0):(this.matrix=null,this._primitives=[],this.boundingSphere=null,this.sag=null,this.namingContext=0),this._binary=!1},i.SGRep.prototype=Object.create(i.SGNode.prototype),Object.assign(i.SGRep.prototype,{constructor:i.SGRep,primitivesClone:function(){for(var e=[],t=0;t<this._primitives.length;t++){var i=this._primitives[t];i.clone?e.push(i.clone()):e.push(i)}return e},clone:function(){var e=new i.SGRep({attributes:this.attributes,cgmId:this.cgmId,type:this.type,primitives:this.primitivesClone(),matrix:this.matrix?this.matrix.clone():null,parent:this.parent,solid:this.solid,sag:this.sag,boundingSphere:this.boundingSphere?{radius:this.boundingSphere.radius,center:[this.boundingSphere.center[0],this.boundingSphere.center[1],this.boundingSphere.center[2]]}:null});return e._binary=this._binary,e},_getIndex:function(e){var t={ind:-1,subInd:-1};if(!this._binary)return t.ind=e,t;for(var i=0,r=0;r<this._primitives.length;r++){var n=this._primitives[r];if(e<i+n.count){t.ind=r,t.subInd=e-i+n.start;break}i+=n.count}return t},getPrimitiveCgmId:function(e){var t=this._getIndex(e),i=this._primitives[t.ind];return-1!==t.subInd?i.binary.getPrimitiveCgmId(t.subInd):i.cgmId},_setPrimitiveCgmId:function(e,t){var i=this._getIndex(t),r=this._primitives[i.ind];-1===i.subInd?r.cgmId=e:r.binary._setPrimitiveCgmId(e,i.subInd)},getPrimitiveType:function(e){var t=this._getIndex(e),i=this._primitives[t.ind];return-1!==t.subInd?i.binary.getPrimitiveType(t.subInd):i.type},_getSGPrimitive:function(e,t){var i=this._getIndex(e),r=this._primitives[i.ind];return-1!==i.subInd?r.binary._getSGPrimitive(i.subInd,t):t?r:r.clone()},_getPrimitiveInternalNode:function(e){var t=this._getIndex(e),i=this._primitives[t.ind];return-1!==t.subInd?i.binary._getPrimitiveInternalNode(t.subInd):i.internalNode},_setPrimitiveRep:function(e,t){var i=this._getIndex(t),r=this._primitives[i.ind];-1===i.subInd?r.rep=e:r.binary._setPrimitiveRep(e,i.subInd)},_setPrimitiveInternalNode:function(e,t){var i=this._getIndex(t),r=this._primitives[i.ind];-1===i.subInd?r.internalNode=e:r.binary._setPrimitiveInternalNode(e,i.subInd)},getPrimitiveRep:function(e){var t=this._getIndex(e),i=this._primitives[t.ind];return-1!==t.subInd?i.binary.getPrimitiveRep(t.subInd):i.rep},_setPrimitiveStart:function(e,t){var i=this._getIndex(t),r=this._primitives[i.ind];-1===i.subInd?r.start=e:r.binary._setPrimitiveStart(e,i.subInd)},_setPrimitiveCount:function(e,t){var i=this._getIndex(t),r=this._primitives[i.ind];-1===i.subInd?r.count=e:r.binary._setPrimitiveCount(e,i.subInd)},getPrimitiveStart:function(e){var t=this._getIndex(e),i=this._primitives[t.ind];return-1!==t.subInd?i.binary.getPrimitiveStart(t.subInd):i.start},getPrimitiveCount:function(e){var t=this._getIndex(e),i=this._primitives[t.ind];return-1!==t.subInd?i.binary.getPrimitiveCount(t.subInd):i.count},getPrimitiveGroup:function(e){var t=this._getIndex(e),i=this._primitives[t.ind];return-1!==t.subInd?i.binary.getPrimitiveGroup(t.subInd):i.group},getPrimitiveDecoration:function(e){var t=this._getIndex(e),i=this._primitives[t.ind];return-1!==t.subInd?i.binary.getPrimitiveDecoration(t.subInd):i.decoration},getPrimitiveBoundingSphere:function(e){var t=this._getIndex(e),i=this._primitives[t.ind];return-1!==t.subInd?i.binary.getPrimitiveBoundingSphere(t.subInd):i.boundingSphere},setPrimitiveBoundingSphere:function(e,t){var i=this._getIndex(e),r=this._primitives[i.ind];-1===i.subInd?r.boundingSphere=t:r.binary.setPrimitiveBoundingSphere(i.subInd,t)},getPrimitivesCount:function(){if(!this._binary)return this._primitives.length;for(var e=0,t=0;t<this._primitives.length;t++){e+=this._primitives[t].count}return e},getPrimitivesCountWithGLType:function(e){let t,i=0;if(this._binary)for(t=0;t<this._primitives.length;t++){let r=this._primitives[t],n=r.binary&&r.binary.dg;n&&n.glType===e&&(i+=r.count)}else{let r=this.getPrimitivesCount();for(t=0;t<r;t++){let r=this.getPrimitiveGroup(t);r&&r.glType===e&&i++}}return i},getPrimitiveIdentificationObject:function(e){var t=this._getIndex(e),i=this._primitives[t.ind];return-1!==t.subInd?i.binary.getPrimitiveIdentificationObject(t.subInd):i.IdentObj},setPrimitiveIdentificationObject:function(e,t){var i=this._getIndex(t),r=this._primitives[i.ind];-1!==i.subInd&&r.binary.setPrimitiveIdentificationObject(e,i.subInd),r.IdentObj=e},computePrimitiveBoundingSphere:function(e){var t=this._getIndex(e),i=this._primitives[t.ind];return-1!==t.subInd?i.binary.computePrimitiveBoundingSphere(t.subInd):i.computeBoundingSphere()},startIteration:function(){return!0},endIteration:function(){return!0},computeBoundingSphere:function(t){if(!this.boundingSphere){this.boundingSphere=new e.Sphere;var i,r,n,o=new e.Sphere;for(i=0;i<this._primitives.length;i++)if(this._binary)for(n=(r=this._primitives[i]).start;n<r.start+r.count;n++)r.binary.computePrimitiveBoundingSphere(n,o),o.mergeWithSphere(this.boundingSphere,this.boundingSphere);else this._primitives[i].computeBoundingSphere(o),o.mergeWithSphere(this.boundingSphere,this.boundingSphere)}return t?(t.copy(this.boundingSphere),t):this.boundingSphere},_computeOrientedBoundingBox:function(t,i,r,n,o){var s,a,u,l,c=new e.Box3;for(s=0;s<this._primitives.length;s++)if(l=this._primitives[s],this._binary)for(a=l.start;a<l.start+l.count;a++)null!==(u=l.binary._computePrimitiveOrientedBoundingBox(a,t,i,r,n,o))&&(c=c.union(u));else null!==(u=l._computeOrientedBoundingBox(t,i,r,n,o))&&(c=c.union(u));return c},_computePrimitiveOrientedBoundingBox:function(e,t,i,r,n,o){var s=this._getIndex(e),a=this._primitives[s.ind];return-1!==s.subInd?a.binary._computePrimitiveOrientedBoundingBox(s.subInd,t,i,r,n,o):a._computeOrientedBoundingBox(t,i,r,n,o)}});var c=0;Object.defineProperty(i.SGRep.prototype,"primitives",{get:function(){if(c<10){var e=new Error,t="#PrimApi - SGRep.GetPrimitives - "+(e.stack?e.stack.split("\n")[1]+" - "+e.stack.split("\n")[2]:"");r.has(t.hashCode())||(r.add(t.hashCode()),console.error(t),c++)}return this._primitives},set:function(){throw"NO"}}),i.BinarySGPrimitiveArray=function(e,t,i,r,n){this.data=e,this.size=n,this.sgRep=i,this.dg=t,this.bSpheres=r||null,this.IdentObj=[],this.internalNodes=[]},i.BinarySGPrimitiveArray.prototype.constructor=i.BinarySGPrimitiveArray,i.BinarySGPrimitiveArray.prototype.clone=function(){return new i.BinarySGPrimitiveArray(this.data.slice(),this.dg,this.sgRep,this.bSpheres?this.bSpheres.slice():null,this.size)},i.BinarySGPrimitiveArray.prototype._compactArrays=function(){var e=this.IdentObj;this.IdentObj=new Array(e.length);for(var t=0;t<e.length;t++)this.IdentObj[t]=e[t];var i=this.internalNodes;this.internalNodes=new Array(i.length);for(t=0;t<i.length;t++)this.internalNodes[t]=i[t]},i.BinarySGPrimitiveArray.prototype._getSGPrimitive=function(e,t){var r=this.size*e,n=this.data,o=n[r]-1,s=this.getPrimitiveRep(e),a=n[r+2],u=n[r+3],l=n[r+4],c=this.getPrimitiveBoundingSphere(e),h=new i.SGPrimitive;return h.decoration=l,h.group=this.dg,h.rep=s,h.count=u,h.start=a,h.cgmId=o,h.boundingSphere=c,h},i.BinarySGPrimitiveArray.prototype.getPrimitiveCgmId=function(e){var t=this.size*e;return this.data[t]-1},i.BinarySGPrimitiveArray.prototype._setPrimitiveCgmId=function(e,t){if("number"!=typeof e)throw"Cgmid must be a number";var i=this.size*t;this.data[i]=e+1},i.BinarySGPrimitiveArray.prototype.getPrimitiveType=function(e){return 3},i.BinarySGPrimitiveArray.prototype._getPrimitiveInternalNode=function(e){return this.internalNodes[e]},i.BinarySGPrimitiveArray.prototype._setPrimitiveInternalNode=function(e,t){0===this.internalNodes.length&&(this.internalNodes=new Array(this.getPrimitivesCount())),this.internalNodes[t]=e},i.BinarySGPrimitiveArray.prototype._setPrimitiveRep=function(e,t){var i=this.sgRep.indexOf(e);i>=0?this.data[this.size*t+1]=i:(this.sgRep.push(e),this.data[this.size*t+1]=this.sgRep.length-1)},i.BinarySGPrimitiveArray.prototype.getPrimitiveRep=function(e){var t=this.data[this.size*e+1];return this.sgRep[t]},i.BinarySGPrimitiveArray.prototype.getPrimitiveStart=function(e){var t=this.size*e;return this.data[t+2]},i.BinarySGPrimitiveArray.prototype.getPrimitiveGroup=function(e){return this.dg},i.BinarySGPrimitiveArray.prototype._setPrimitiveStart=function(e,t){var i=this.size*t;this.data[i+2]=e},i.BinarySGPrimitiveArray.prototype.getPrimitiveCount=function(e){var t=this.size*e;return this.data[t+3]},i.BinarySGPrimitiveArray.prototype._setPrimitiveCount=function(e,t){var i=this.size*t;this.data[i+3]=e},i.BinarySGPrimitiveArray.prototype.getPrimitiveDecoration=function(e){var t=this.size*e;return this.data[t+4]},i.BinarySGPrimitiveArray.prototype.getPrimitiveBoundingSphere=function(t){if(null!==this.bSpheres){var i=new e.Sphere;return i.setSimple(this.bSpheres[4*t],this.bSpheres[4*t+1],this.bSpheres[4*t+2],this.bSpheres[4*t+3]),i.radius>=0?i:null}return null},i.BinarySGPrimitiveArray.prototype._computePrimitiveOrientedBoundingBox=function(e,t,i,r,n,o){return this.dg._computeOrientedBoundingBox(t,i,r,n,this.getPrimitiveStart(e),this.getPrimitiveCount(e),o)},i.BinarySGPrimitiveArray.prototype.setPrimitiveBoundingSphere=function(e,t){null===this.bSpheres&&(this.bSpheres=new Float32Array(4*this.getPrimitivesCount()),this.bSpheres.fill(-1)),null===t?(this.bSpheres[4*e]=-1,this.bSpheres[4*e+1]=-1,this.bSpheres[4*e+2]=-1,this.bSpheres[4*e+3]=-1):(this.bSpheres[4*e]=t.center.x,this.bSpheres[4*e+1]=t.center.y,this.bSpheres[4*e+2]=t.center.z,this.bSpheres[4*e+3]=t.radius)},i.BinarySGPrimitiveArray.prototype.getPrimitivesCount=function(){return this.data.length/this.size},i.BinarySGPrimitiveArray.prototype.getPrimitiveIdentificationObject=function(e){return this.IdentObj[e]},i.BinarySGPrimitiveArray.prototype.setPrimitiveIdentificationObject=function(e,t){0===this.IdentObj.length&&(this.IdentObj=new Array(this.getPrimitivesCount())),this.IdentObj[t]=e},i.BinarySGPrimitiveArray.prototype.computePrimitiveBoundingSphere=function(t,i){let r=this.getPrimitiveCount(t);if(0==r)return;let n=this.getPrimitiveStart(t);const o=this.dg.geometry;let s=o.vertexIndexArray[n],a=new e.Vector3;o.getVertexPosition(s,a);let u=(new e.Vector3).copy(a),l=(new e.Vector3).copy(a);for(let e=1;e<r;++e)s=o.vertexIndexArray[n+e],o.getVertexPosition(s,a),u.x=Math.min(u.x,a.x),u.y=Math.min(u.y,a.y),u.z=Math.min(u.z,a.z),l.x=Math.max(l.x,a.x),l.y=Math.max(l.y,a.y),l.z=Math.max(l.z,a.z);let c=(new e.Vector3).addVectors(u,l);c.multiplyScalar(.5);let h=0;for(let e=0;e<r;++e)s=o.vertexIndexArray[n+e],o.getVertexPosition(s,a),a.sub(c),h=Math.max(a.lengthSq(),h);return h=Math.sqrt(h),(i=i||new e.Sphere).set(c,h),i},i.SGPrimitive=function(e){this.type=3,this.IdentObj=null,this.internalNode=null,e?(this.cgmId=void 0!==e.cgmId?e.cgmId:-1,this.rep=void 0!==e.rep?e.rep:null,this.group=void 0!==e.group?e.group:null,this.start=void 0!==e.start?e.start:0,this.count=void 0!==e.count?e.count:0,this.boundingSphere=void 0!==e.boundingSphere?e.boundingSphere:void 0,this.decoration=void 0!==e.decoration?e.decoration:0):(this.cgmId=-1,this.rep=null,this.group=null,this.start=0,this.count=0,this.boundingSphere=void 0,this.decoration=0)},i.SGPrimitive.prototype={constructor:i.SGPrimitive,getIdentificationObject:function(){return this.IdentObj},setIdentificationObject:function(e){this.IdentObj=e},isEqual:function(e){return this.getGroup()===e.getGroup()&&this.getRep()===e.getRep()&&this.getStart()===e.getStart()&&this.getCount()===e.getCount()&&this.getCgmId()===e.getCgmId()},computeBoundingSphere:function(t){const i=this.count;if(0==i)return;const r=this.start,n=this.group.geometry,o=n.vertexIndexArray;let s=o[r],a=new e.Vector3;n.getVertexPosition(s,a);let u=(new e.Vector3).copy(a),l=(new e.Vector3).copy(a);for(let e=1;e<i;++e)s=o[r+e],n.getVertexPosition(s,a),u.x=Math.min(u.x,a.x),u.y=Math.min(u.y,a.y),u.z=Math.min(u.z,a.z),l.x=Math.max(l.x,a.x),l.y=Math.max(l.y,a.y),l.z=Math.max(l.z,a.z);let c=(new e.Vector3).addVectors(u,l);c.multiplyScalar(.5);let h=0;for(let e=0;e<i;++e)s=o[r+e],n.getVertexPosition(s,a),a.sub(c),h=Math.max(a.lengthSq(),h);return h=Math.sqrt(h),(t=t||new e.Sphere).set(c,h),t},_computeOrientedBoundingBox:function(e,t,i,r,n){return this.group._computeOrientedBoundingBox(e,t,i,r,this.start,this.count,n)},getCgmId:function(){return this.cgmId},_setCgmId:function(e){this.cgmId=e},getType:function(){return this.type},_getInternalNode:function(){return this.internalNode},_setInternalNode:function(e){this.internalNode=e},getRep:function(){return this.rep},getStart:function(){return this.start},getCount:function(){return this.count},getGroup:function(){return this.group},getDecoration:function(){return this.decoration},getBoundingSphere:function(){return this.boundingSphere},startIteration:function(){return this.group.startIteration()},endIteration:function(){return this.group.endIteration()},_copyPrimitive:function(e){this.cgmId=e.cgmId,this.rep=e.rep,this.group=e.group,this.start=e.start,this.count=e.count,this.boundingSphere=e.boundingSphere?{radius:e.boundingSphere.radius,center:[e.boundingSphere.center[0],e.boundingSphere.center[1],e.boundingSphere.center[2]]}:void 0,this.decoration=e.decoration},clone:function(){var e=new i.SGPrimitive;return e._copyPrimitive(this),e}},i.SGPrimitiveHelper=function(){this.container=null,this.index=-1},i.SGPrimitiveHelper.prototype={constructor:i.SGPrimitiveHelper,clone:function(){var e=new i.SGPrimitiveHelper;return e.set(this.container,this.index),e},set:function(e,t){if(!e instanceof i.DrawingGroup||!e instanceof i.SGRep)throw"Error: container must be a Mesh.DrawingGroup or Mesh.SGRep";this.container=e,this.index=t},isEqual:function(e){return this.getGroup()===e.getGroup()&&this.getRep()===e.getRep()&&this.getStart()===e.getStart()&&this.getCount()===e.getCount()&&this.getCgmId()===e.getCgmId()},getCgmId:function(){return this.container.getPrimitiveCgmId(this.index)},_setCgmId:function(e){this.container._setPrimitiveCgmId(e,this.index)},getType:function(){return this.container.getPrimitiveType(this.index)},_getSGPrimitive:function(e){return this.container._getSGPrimitive(this.index,e)},_getInternalNode:function(){return this.container._getPrimitiveInternalNode(this.index)},_setInternalNode:function(e){this.container._setPrimitiveInternalNode(e,this.index)},_setRep:function(e){return this.container._setPrimitiveRep(e,this.index)},getRep:function(){return this.container.getPrimitiveRep(this.index)},getStart:function(){return this.container.getPrimitiveStart(this.index)},getCount:function(){return this.container.getPrimitiveCount(this.index)},getGroup:function(){return this.container.getPrimitiveGroup(this.index)},getDecoration:function(){return this.container.getPrimitiveDecoration(this.index)},getBoundingSphere:function(){return this.container.getPrimitiveBoundingSphere(this.index)},setBoundingSphere:function(e){this.container.setPrimitiveBoundingSphere(this.index,e)},getIdentificationObject:function(){return this.container.getPrimitiveIdentificationObject(this.index)},setIdentificationObject:function(e){this.container.setPrimitiveIdentificationObject(e,this.index)},computeBoundingSphere:function(e){return this.container.computePrimitiveBoundingSphere(this.index,e)},_computeOrientedBoundingBox:function(e,t,i,r,n){return this.container._computePrimitiveOrientedBoundingBox(this.index,e,t,i,r,n)},startIteration:function(){return this.container.startIteration()},endIteration:function(){return this.container.endIteration()}};var h=0;Object.defineProperty(i.SGPrimitiveHelper.prototype,"start",{get:function(){if(h<25){var e=new Error,t="#PrimApi - helper.GetStart - "+(e.stack?e.stack.split("\n")[1]+" - "+e.stack.split("\n")[2]:"");r.has(t.hashCode())||(r.add(t.hashCode()),console.error(t)),h++}return this.getStart()},set:function(){throw"NO"}}),Object.defineProperty(i.SGPrimitiveHelper.prototype,"count",{get:function(){if(h<25){var e=new Error,t="#PrimApi - helper.GetCount - "+(e.stack?e.stack.split("\n")[1]+" - "+e.stack.split("\n")[2]:"");r.has(t.hashCode())||(r.add(t.hashCode()),console.error(t)),h++}return this.getCount()},set:function(){throw"NO"}}),Object.defineProperty(i.SGPrimitiveHelper.prototype,"cgmId",{get:function(){if(h<25){var e=new Error,t="#PrimApi - helper.GetCgmId - "+(e.stack?e.stack.split("\n")[1]+" - "+e.stack.split("\n")[2]:"");r.has(t.hashCode())||(r.add(t.hashCode()),console.error(t)),h++}return this.getCgmId()},set:function(e){if(h<25){var t=new Error,i="#PrimApi - helper.SetCgmId - "+(t.stack?t.stack.split("\n")[1]+" - "+t.stack.split("\n")[2]:"");r.has(i.hashCode())||(r.add(i.hashCode()),console.error(i)),h++}this._setCgmId(e)}}),Object.defineProperty(i.SGPrimitiveHelper.prototype,"rep",{get:function(){if(h<25){var e=new Error,t="#PrimApi - helper.GetRep - "+(e.stack?e.stack.split("\n")[1]+" - "+e.stack.split("\n")[2]:"");r.has(t.hashCode())||(r.add(t.hashCode()),console.error(t)),h++}return this.getRep()},set:function(){throw"NO"}}),Object.defineProperty(i.SGPrimitiveHelper.prototype,"boundingSphere",{get:function(){if(h<25){var e=new Error,t="#PrimApi - helper.GetBS - "+(e.stack?e.stack.split("\n")[1]+" - "+e.stack.split("\n")[2]:"");r.has(t.hashCode())||(r.add(t.hashCode()),console.error(t)),h++}return this.getBoundingSphere()},set:function(){throw"NO"}}),Object.defineProperty(i.SGPrimitiveHelper.prototype,"type",{get:function(){if(h<25){var e=new Error,t="#PrimApi - helper.GetType - "+(e.stack?e.stack.split("\n")[1]+" - "+e.stack.split("\n")[2]:"");r.has(t.hashCode())||(r.add(t.hashCode()),console.error(t)),h++}return this.getType()},set:function(){throw"NO"}}),Object.defineProperty(i.SGPrimitiveHelper.prototype,"group",{get:function(){if(h<25){var e=new Error,t="#PrimApi - helper.GetGroup - "+(e.stack?e.stack.split("\n")[1]+" - "+e.stack.split("\n")[2]:"");r.has(t.hashCode())||(r.add(t.hashCode()),console.error(t)),h++}return this.getGroup()},set:function(){throw"NO"}}),Object.defineProperty(i.SGPrimitiveHelper.prototype,"decoration",{get:function(){if(h<25){var e=new Error,t="#PrimApi - helper.GetDeco - "+(e.stack?e.stack.split("\n")[1]+" - "+e.stack.split("\n")[2]:"");r.has(t.hashCode())||(r.add(t.hashCode()),console.error(t)),h++}return this.getDecoration()},set:function(){throw"NO"}});var p={EDGE:1,WIRE_EDGE:2,BOUNDARY_EDGE:3,SHARP_EDGE:4,SMOOTH_EDGE:5,BOUNDARY_POINT:6,SHARP_POINT:7,SMOOTH_POINT:8,SURFACIC_POINT:9,FREE_POINT:10,INFINITE_FACE:11,FACE:12,UNKNOWN:13};i.getConvertedVec3=function(t,i){var r=[t[i],t[i+1],t[i+2]];return new e.Vector3(r[0],r[1],r[2])},i.isEqualGAS=function(e,t){return null==e&&null==t||!(null==e&&null!=t||null!=e&&null==t)&&(e.fill.isEqual(t.fill)&&e.line.isEqual(t.line)&&e.point.isEqual(t.point))},i.isEqualMaterial=function(e,t){return null==e&&null==t||!(null==e&&null!=t||null!=e&&null==t)&&(e.id==t.id&&e.file==t.file)},i.convertToMaterial3js=function(t,i){if(null==t)return null;var r=null,n=1,o=null;switch(i){case 0:n=null==t.point.color.a?1:t.point.color.a,o=new e.Color,t.point.color&&(o.setRGB(t.point.color.r,t.point.color.g,t.point.color.b),r={color:o,opacity:n,symbol:t.point.symbol,pointsize:t.point.size},t.point.forceMaterial&&(r.forceMaterial=!0));break;case 1:n=null==t.line.color.a?1:t.line.color.a,o=new e.Color,t.line.color&&(o.setRGB(t.line.color.r,t.line.color.g,t.line.color.b),r={color:o,opacity:n,lineWidth:t.line.thickness,pattern:t.line.pattern},t.line.forceMaterial&&(r.forceMaterial=!0));break;case 2:n=null==t.fill.color.a?1:t.fill.color.a,o=new e.Color,t.fill.color&&(o.setRGB(t.fill.color.r,t.fill.color.g,t.fill.color.b),r={color:o,opacity:n,solid:t.fill.solid,basic:t.fill.basic})}return r},i.areEqualGraphicProperties=function(e,t){return null!=e.color&&null!=t.color&&(e.color.r==t.color.r&&e.color.g==t.color.g&&e.color.b==t.color.b&&((!e.thickness||!t.thickness||e.thickness==t.thickness)&&((!e.pointsize||!t.pointsize||e.pointsize==t.pointsize)&&e.opacity==t.opacity)))},i.validatePrimitiveGroup=function(e){var t,r;for(t=0;t<e.buffers.length;t++){(s=e.buffers[t])&&(s.size=s.data.byteLength/i.sizeOfDataType(s.format),s.indexBuffer&&(s.format=i.DataTypeEnum.UINT,s.dimension=1))}for(t=0;t<e.primitives.length;t++){var n=e.primitives[t];for(n.attr||(n.attr={fill:e.fillAttr,line:e.lineAttr,point:e.pointAttr}),r=0;r<n.nbVertexComponents;r++){var o=n.vertexComponents[r],s=e.getBufferFromId(o.bufferId);o.component=s.component,o.nbValuesPerVertex=s.dimension,o.format=s.format}}},i.checkMeshOptimizable=function(e){for(var t=null,r=[],n=0;n<e.buffers.length;n++){var o=e.buffers[n];if(o)if(o.indexBuffer){if(t)return!1;t=o}else{if(r[o.component])return!1;r[o.component]=o}}for(var s=0;s<e.primitives.length;s++){var a=e.primitives[s];if(a.connectivity===i.ConnectivityTypeEnum.TRIANGLE_STRIP||a.connectivity===i.ConnectivityTypeEnum.TRIANGLE_FAN||a.connectivity===i.ConnectivityTypeEnum.LINE_STRIP)return!1}return!0},i.createGeometryOptimized=function(t,r){var n=new i.Mesh;n.rep=r;for(var o=0;o<t.buffers.length;o++){var s=t.buffers[o],a=s.component,u=s.data;if(s.indexBuffer)n.vertexIndexArray=u;else switch(a){case i.VertexComponentEnum.POSITION:n.vertexPositionArray=u;break;case i.VertexComponentEnum.NORMAL:n.vertexNormalArray=u;break;case i.VertexComponentEnum.DIFFUSE_COLOR:n.vertexColorArray=u;break;case i.VertexComponentEnum.TEX_COORD_0:n.vertexUvArray=u;break;case i.VertexComponentEnum.TEX_COORD_1:n.vertexUv2Array=u;break;case i.VertexComponentEnum.TEX_COORD_2:n.vertexTangentArray=u;break;case i.VertexComponentEnum.TEX_COORD_3:n.vertexBinormalArray=u}}var l=[],c=[],h=t.nbPrimitives;for(o=0;o<h;o++){var d=t.primitives[o],m=!!d.vertexComponents[0].indices,g=0,v=l.length;if(m){for(g=0;g<v;g++){var f=l[g];if(f.connectivity==d.connectivity&&f.geomType==d.geomType&&i.isEqualGAS(f.gas,d.attr)&&(null==f.material&&null==d.material||f.material.id==d.material.id&&f.material.file==d.material.file)){f.set.push(d),f.nbIndices+=d.nbIndices;break}}if(g===l.length){var y={connectivity:d.connectivity,geomType:d.geomType,gas:d.attr,material:d.material,nbIndices:d.nbIndices,set:[d]};l.push(y)}}else c.push(d)}l.sort(function(e,t){if(e.connectivity<t.connectivity)return-1;if(e.connectivity>t.connectivity)return 1;if(e.geomType&&t.geomType){var i=p[e.geomType],r=p[t.geomType];if(i&&r)return i-r}return 0});for(o=0;o<l.length;o++)l[o].set.sort(function(e,t){var i=e.vertexComponents[0].indices,r=t.vertexComponents[0].indices;return i&&r?i.offset-r.offset:0});for(o=0;o<l.length;o++)for(var x=l[o],b=[],I=x.set[0].vertexComponents[0].indices.offset,_=x.set[0].vertexComponents[0].indices.offset,A=0,S=0;S<x.set.length;)for(g=S;g<x.set.length;g++){var P=x.set[g];if(!P.vertexComponents[0].indices||P.vertexComponents[0].indices.offset!==_||g===x.set.length-1){g===x.set.length-1?(b.push(P),A+=P.nbIndices,S=g+1):S=g;var w=4===(B=x.connectivity===i.ConnectivityTypeEnum.TRIANGLES?4:x.connectivity===i.ConnectivityTypeEnum.LINES?1:0)?2:B;(E=new i.DrawingGroup(i.convertToMaterial3js(x.gas,w),x.material,B,I,A,void 0,void 0,e.GeomTypeEnum[x.geomType]))._geomType=x.geomType?e.GeomTypeEnum[x.geomType]:0,n.drawingGroups.push(E);for(var T=0;T<b.length;T++){var C=b[T],G=new i.SGPrimitive({cgmId:C.identifier,rep:n.rep,group:E,start:C.vertexComponents[0].indices.offset,count:C.nbIndices});E._primitives.push(G),n.rep._primitives.push(G)}I=P.vertexComponents[0].indices.offset,_=P.vertexComponents[0].indices.offset,A=0,b.length=0;break}b.push(P),_+=P.nbIndices,A+=P.nbIndices}for(o=0;o<c.length;o++){var B,E;w=4===(B=(C=c[o]).connectivity===i.ConnectivityTypeEnum.TRIANGLES?4:C.connectivity===i.ConnectivityTypeEnum.LINES?1:0)?2:B;(E=new i.DrawingGroup(i.convertToMaterial3js(C.attr,w),C.material,B,C.vertexComponents[0].offset,C.nbIndices,void 0,void 0,e.GeomTypeEnum[C.geomType]))._geomType=C.geomType?e.GeomTypeEnum[C.geomType]:0,E.nonIndexed=!0,n.drawingGroups.push(E);G=new i.SGPrimitive({cgmId:C.identifier,rep:n.rep,group:E,start:C.vertexComponents[0].offset,count:C.nbIndices});E._primitives.push(G),n.rep._primitives.push(G)}var O=new e.Color,M=new e.Color,N=new e.Color;t.fillAttr.color&&O.setRGB(t.fillAttr.color.r,t.fillAttr.color.g,t.fillAttr.color.b),t.lineAttr.color&&M.setRGB(t.lineAttr.color.r,t.lineAttr.color.g,t.lineAttr.color.b),n.gas.fill={color:O,opacity:null==t.fillAttr.color.a?1:t.fillAttr.color.a,solid:t.fillAttr.solid},n.gas.line={color:M,opacity:null==t.lineAttr.color.a?1:t.lineAttr.color.a,lineWidth:t.lineAttr.thickness,pattern:t.lineAttr.pattern||1},t.pointAttr&&(t.pointAttr.color&&N.setRGB(t.pointAttr.color.r,t.pointAttr.color.g,t.pointAttr.color.b),n.gas.point={color:N,opacity:null==t.pointAttr.color.a?1:t.pointAttr.color.a,pointsize:t.pointAttr.size});var z=[0,0,0],R=[0,0,0];if(n.vertexPositionArray){const e=n.vertexPositionArray;var D=e.length;if(D>=3){z=[e[0],e[1],e[2]],R=[e[0],e[1],e[2]];for(var V=0;V<D;V+=3)e[V]<z[0]&&(z[0]=e[V]),e[V+1]<z[1]&&(z[1]=e[V+1]),e[V+2]<z[2]&&(z[2]=e[V+2]),e[V]>R[0]&&(R[0]=e[V]),e[V+1]>R[1]&&(R[1]=e[V+1]),e[V+2]>R[2]&&(R[2]=e[V+2])}}return n.AABB={min:z,max:R},n},i.convertToGeometry3js=function(t,r,n,o,s,a,u){var l=o,c=[],h=0,d=0,m=t.nbPrimitives,g=i.isEqualGAS;a&&(g=function(e,t){return e.set==t.set&&e.rgba==t.rgba});for(var v=0;v<m;v++){var f=t.primitives[v],y=0,x=c.length;for(y=0;y<x;y++){var b=c[y];if(b.connectivity==f.connectivity&&b.geomType==f.geomType&&g(b.gas,f.attr)&&(null==b.material&&null==f.material||b.material.id==f.material.id&&b.material.file==f.material.file)){switch(h+=f.nbIndices,b.connectivity){case i.ConnectivityTypeEnum.TRIANGLE_STRIP:case i.ConnectivityTypeEnum.TRIANGLE_FAN:d+=2*(f.nbIndices-3),b.more_indices+=2*(f.nbIndices-3);break;case i.ConnectivityTypeEnum.LINE_STRIP:d+=f.nbIndices-2,b.more_indices+=f.nbIndices-2}b.set.push(f),b.nbIndices+=f.nbIndices;break}}if(y==c.length)switch((_={}).connectivity=f.connectivity,_.geomType=f.geomType,_.gas=f.attr,_.material=f.material,_.nbIndices=f.nbIndices,_.more_indices=0,_.set=[],_.set.push(f),c.push(_),h+=f.nbIndices,c[y].connectivity){case i.ConnectivityTypeEnum.TRIANGLE_STRIP:case i.ConnectivityTypeEnum.TRIANGLE_FAN:d+=2*(f.nbIndices-3),_.more_indices=2*(f.nbIndices-3);break;case i.ConnectivityTypeEnum.LINE_STRIP:d+=f.nbIndices-2,_.more_indices=f.nbIndices-2}}c.sort(function(e,t){if(e.connectivity<t.connectivity)return-1;if(e.connectivity>t.connectivity)return 1;if(e.geomType&&t.geomType){var i=p[e.geomType],r=p[t.geomType];if(i&&r)return i-r}return 0});var I=[];for(y=0;y<c.length;y++){var _=c[y];for(v=0;v<_.set.length;v++)I.push(_.set[v])}var A=null;A=null==s||"multi"==s?void 0!==r?i.deMultiIndex(I,t.buffers,r,n):i.deMultiIndex(I,t.buffers):void 0!==r?i.monoIndex(I,t.buffers,r,n):i.monoIndex(I,t.buffers);var S=new i.Mesh;S.vertexPositionArray=A.VB[0],S.vertexNormalArray=A.VB[1],S.vertexColorArray=A.VB[2],S.vertexUvArray=A.VB[3],S.vertexUv2Array=A.VB[4],S.vertexTangentArray=A.VB[5],S.vertexBinormalArray=A.VB[6];for(var P=new Uint32Array(h+d),w=0,T=0,C=0;C<c.length;C++){var G,B=null==(_=c[C]).material?t.material:_.material;switch(_.connectivity){case i.ConnectivityTypeEnum.TRIANGLES:(z=_.gas)&&!z.set&&(z=i.convertToMaterial3js(_.gas,2)),(G=new i.DrawingGroup(z,B,4,T,_.nbIndices,void 0,void 0,e.GeomTypeEnum[_.geomType],void 0,u))._geomType=_.geomType?e.GeomTypeEnum[_.geomType]:0,S.drawingGroups.push(G);for(v=0;v<_.set.length;v++){f=_.set[v];var E=new i.MeshPrimitive(f.identifier,G,T,f.nbIndices);f.cgmId&&(E.cgmId=f.cgmId),f.decoration&&(E.decoration=f.decoration),f.boundingSphere&&(E.boundingSphere=f.boundingSphere),G._primitives.push(E);for(y=0;y<f.nbIndices;y++)P[T++]=A.IB[w++]}break;case i.ConnectivityTypeEnum.TRIANGLE_FAN:(z=_.gas)&&!z.set&&(z=i.convertToMaterial3js(_.gas,2)),(G=new i.DrawingGroup(z,B,4,T,_.nbIndices+_.more_indices,void 0,void 0,e.GeomTypeEnum[_.geomType],void 0,u))._geomType=_.geomType?e.GeomTypeEnum[_.geomType]:0,S.drawingGroups.push(G);for(v=0;v<_.set.length;v++){f=_.set[v];var O=T,M=w;for(y=0;y<f.nbIndices-2;y++)P[T++]=A.IB[M],P[T++]=A.IB[w+1],P[T++]=A.IB[w+2],w++;w+=2;E=new i.MeshPrimitive(f.identifier,G,O,T-O);f.cgmId&&(E.cgmId=f.cgmId),f.decoration&&(E.decoration=f.decoration),f.boundingSphere&&(E.boundingSphere=f.boundingSphere),G._primitives.push(E)}break;case i.ConnectivityTypeEnum.TRIANGLE_STRIP:(z=_.gas)&&!z.set&&(z=i.convertToMaterial3js(_.gas,2)),(G=new i.DrawingGroup(z,B,4,T,_.nbIndices+_.more_indices,void 0,void 0,e.GeomTypeEnum[_.geomType],void 0,u))._geomType=_.geomType?e.GeomTypeEnum[_.geomType]:0,S.drawingGroups.push(G);for(v=0;v<_.set.length;v++){f=_.set[v],O=T;var N=0;for(y=0;y<f.nbIndices-2;y++)P[T++]=A.IB[w],P[T++]=A.IB[w+1+N],P[T++]=A.IB[w+2-N],w++,N=1-N;w+=2;E=new i.MeshPrimitive(f.identifier,G,O,T-O);f.cgmId&&(E.cgmId=f.cgmId),f.decoration&&(E.decoration=f.decoration),f.boundingSphere&&(E.boundingSphere=f.boundingSphere),G._primitives.push(E)}break;case i.ConnectivityTypeEnum.LINES:B&&(B.shading="Basic"),(z=_.gas)&&!z.set&&(z=i.convertToMaterial3js(_.gas,1)),(G=new i.DrawingGroup(z,B,1,T,_.nbIndices,void 0,void 0,e.GeomTypeEnum[_.geomType],void 0,u))._geomType=_.geomType?e.GeomTypeEnum[_.geomType]:0,S.drawingGroups.push(G);for(v=0;v<_.set.length;v++){f=_.set[v],E=new i.MeshPrimitive(f.identifier,G,T,f.nbIndices);f.cgmId&&(E.cgmId=f.cgmId),f.decoration&&(E.decoration=f.decoration),f.boundingSphere&&(E.boundingSphere=f.boundingSphere),G._primitives.push(E);for(y=0;y<f.nbIndices;y++)P[T++]=A.IB[w++]}break;case i.ConnectivityTypeEnum.LINE_STRIP:B&&(B.shading="Basic"),(z=_.gas)&&!z.set&&(z=i.convertToMaterial3js(_.gas,1)),(G=new i.DrawingGroup(z,B,1,T,_.nbIndices+_.more_indices,void 0,void 0,e.GeomTypeEnum[_.geomType],void 0,u))._geomType=_.geomType?e.GeomTypeEnum[_.geomType]:0,S.drawingGroups.push(G);for(v=0;v<_.set.length;v++){for(f=_.set[v],O=T,y=0;y<f.nbIndices-1;y++)P[T++]=A.IB[w++],P[T++]=A.IB[w];w++;E=new i.MeshPrimitive(f.identifier,G,O,T-O);f.cgmId&&(E.cgmId=f.cgmId),f.decoration&&(E.decoration=f.decoration),f.boundingSphere&&(E.boundingSphere=f.boundingSphere),G._primitives.push(E)}break;case i.ConnectivityTypeEnum.POINTS:var z;(z=_.gas)&&!z.set&&(z=i.convertToMaterial3js(_.gas,0)),(G=new i.DrawingGroup(z,B,0,T,_.nbIndices,void 0,void 0,e.GeomTypeEnum[_.geomType],void 0,u))._geomType=_.geomType?e.GeomTypeEnum[_.geomType]:0,S.drawingGroups.push(G);for(v=0;v<_.set.length;v++){f=_.set[v],E=new i.MeshPrimitive(f.identifier,G,T,f.nbIndices);f.cgmId&&(E.cgmId=f.cgmId),f.decoration&&(E.decoration=f.decoration),f.boundingSphere&&(E.boundingSphere=f.boundingSphere),G._primitives.push(E);for(y=0;y<f.nbIndices;y++)P[T++]=A.IB[w++]}}}S.vertexIndexArray=P;var R=new e.Color,D=new e.Color,V=new e.Color;if(t.fillAttr.color&&R.setRGB(t.fillAttr.color.r,t.fillAttr.color.g,t.fillAttr.color.b),t.lineAttr.color&&D.setRGB(t.lineAttr.color.r,t.lineAttr.color.g,t.lineAttr.color.b),S.gas.fill={color:R,opacity:null==t.fillAttr.color.a?1:t.fillAttr.color.a,solid:t.fillAttr.solid},S.gas.line={color:D,opacity:null==t.lineAttr.color.a?1:t.lineAttr.color.a,lineWidth:t.lineAttr.thickness,pattern:t.lineAttr.pattern||1},t.pointAttr&&(t.pointAttr.color&&V.setRGB(t.pointAttr.color.r,t.pointAttr.color.g,t.pointAttr.color.b),S.gas.point={color:V,opacity:null==t.pointAttr.color.a?1:t.pointAttr.color.a,pointsize:t.pointAttr.size}),!l){var k=[0,0,0],F=[0,0,0];if(S.vertexPositionArray){const e=S.vertexPositionArray;var U=e.length;if(U>=3){k=[e[0],e[1],e[2]],F=[e[0],e[1],e[2]];for(var L=0;L<U;L+=3)e[L]<k[0]&&(k[0]=e[L]),e[L+1]<k[1]&&(k[1]=e[L+1]),e[L+2]<k[2]&&(k[2]=e[L+2]),e[L]>F[0]&&(F[0]=e[L]),e[L+1]>F[1]&&(F[1]=e[L+1]),e[L+2]>F[2]&&(F[2]=e[L+2])}}S.AABB={min:k,max:F}}return S},i.monoIndex=function(t,r,n,o){for(var s=0,a=0;a<t.length;a++)s+=t[a].nbIndices;var u=[];for(a=0;a<i.NumberOfComponents;a++)u[a]=[];var l=0;for(a=0;a<r.length;a++){if(null!=(f=r[a])&&(!(f.component>=i.NumberOfComponents)&&!f.indexBuffer&&f.data.length&&(void 0===f._isPlanar||!f._isPlanar))){var c=0;if(m=u[f.component].length){var h=u[f.component][m-1];c=h.offset+h.buffer.data.length/3}u[f.component].push({buffer:f,offset:c}),f._newOffset=c,c+f.data.length/3>l&&(l=c+f.data.length/3)}}for(a=0;a<r.length;a++){if(null!=(f=r[a])&&(!(f.component>=i.NumberOfComponents)&&!f.indexBuffer&&f.data.length&&null!=f._isPlanar&&f._isPlanar)){c=l;u[f.component].push({buffer:f,offset:c}),f._newOffset=c}}var p=new Uint32Array(s),d=[];for(a=0;a<i.NumberOfComponents;a++){var m;if(m=u[a].length){var g=u[a][m-1];d[a]=new Float32Array(3*g.offset+g.buffer.data.length);c=0;for(var v=0;v<m;v++){var f,y=(f=u[a][v]).buffer.data.length,x=f.buffer.data;if(c<3*f.offset){for(var b=c;b<3*f.offset;b++)d[a][b]=0;c=3*f.offset}if(null==n)d[a].set(x,c);else for(b=0;b<y;b+=3){var I=new e.Vector3(x[b],x[b+1],x[b+2]);1==a?I.applyMatrix4(o):0==a&&I.applyMatrix4(n),d[a][c+b]=I.x,d[a][c+b+1]=I.y,d[a][c+b+2]=I.z}c+=y}}else d[a]=null}var _=0;for(a=0;a<t.length;a++){var A=t[a],S=A.vertexComponents[0],P=r[S.bufferId];if(null!=P){var w=P._newOffset;if(null!=S.indices){var T=r[S.indices.bufferId];for(b=0;b<A.nbIndices;b++)p[_+b]=T.data[S.indices.offset+b]+S.offset+w}else for(b=0;b<A.nbIndices;b++)p[_+b]=w+S.offset+b;_+=A.nbIndices}}return{IB:p,VB:d}},i.deMultiIndex=function(t,r,n,o){null!=n&&null!=o||(n=null),void 0!==o&&o instanceof e.Matrix4&&((o=(new e.Matrix4).copy(o)).elements[12]=0,o.elements[13]=0,o.elements[14]=0);for(var s=0,a=0;a<t.length;a++)s+=t[a].nbIndices;var u=[],l=[],c=0;for(a=0;a<i.NumberOfComponents;a++)u[a]=null;for(a=0;a<t.length;a++){for(var h=t[a],p=0;p<h.nbVertexComponents;p++){var d=h.vertexComponents[p];if(null==u[d.component]){u[d.component]=[],l[d.component]=d.bufferId;for(var m=0;m<s;m++)u[d.component][m]=null}r[d.bufferId];var g=null;if(null!=d.indices&&(g=r[d.indices.bufferId]),null!=g)for(m=0;m<h.nbIndices;m++)u[d.component][c+m]={bufferId:d.bufferId,index:d.offset+g.data[d.indices.offset+m]};else for(m=0;m<h.nbIndices;m++)u[d.component][c+m]={bufferId:d.bufferId,index:d.offset+m}}c+=h.nbIndices}var v=[];for(p=0;p<s;p++){(_=new i.MultiIndexMultiBuffer).old_index=p;for(a=0;a<i.NumberOfComponents;a++)null!==u[a]&&(_.comp[a]=u[a][p]);v.push(_)}v.sort(function(e,t){for(var r=0,n=0,o=0;o<i.NumberOfComponents;o++)if(null!=e.comp[o]&&null!=t.comp[o]){if(e.comp[o].index<t.comp[o].index)return-1;if(e.comp[o].index>t.comp[o].index)return 1;if(e.comp[o].bufferId<t.comp[o].bufferId)return-1;if(e.comp[o].bufferId>t.comp[o].bufferId)return 1}else null==e.comp[o]&&r++,null==t.comp[o]&&n++;return r<n?-1:r>n?1:0});var f=new Uint32Array(s),y=[];for(a=0;a<i.NumberOfComponents;a++)if(null!==u[a]){var x=r[l[a]].dimension;y[a]=new Float32Array(x*s)}else y[a]=null;var b=-1,I=null;for(a=0;a<v.length;a++){var _,A=(_=v[a]).old_index;if(!a||!_.componentsEqual(I)){b++,I=_;for(p=0;p<i.NumberOfComponents;p++)if(null!=_.comp[p]){var S=r[_.comp[p].bufferId].data,P=r[_.comp[p].bufferId].dimension;if(null==n)for(m=0;m<P;m++)y[p][P*b+m]=S[P*u[p][_.old_index].index+m];else{var w=new e.Vector3(S[3*u[p][_.old_index].index],S[3*u[p][_.old_index].index+1],S[3*u[p][_.old_index].index+2]);1==p?(w.applyMatrix4(o),y[p][3*b]=w.x,y[p][3*b+1]=w.y,y[p][3*b+2]=w.z):0==p?(w.applyMatrix4(n),y[p][3*b]=w.x,y[p][3*b+1]=w.y,y[p][3*b+2]=w.z):(y[p][3*b]=w.x,y[p][3*b+1]=w.y,y[p][3*b+2]=w.z)}}}f[A]=b}var T=[];for(a=0;a<i.NumberOfComponents;a++){var C=y[a];if(null!==C){var G=r[l[a]].dimension*(b+1),B=new Float32Array(G);for(p=0;p<G;p++)B[p]=C[p];T[a]=B}else T[a]=null}return{IB:f,VB:T}},i.MeshContextEnum={UNKNOWN:0,DATA:1,FLOATBUFFER:2,INDEXBUFFER:3,COMPRESSEDBUFFER:4,PRIMITIVE:5,VERTEXCOMPONENT:6,GRAPHICPROPERTIES:7,APPEARANCE:8,BAG:9,MESH:10,TEXT:11},i.NumberOfComponents=7,i.MultiIndex=function(){this.old_index=0,this.comp=[],this.comp[0]=-1,this.comp[1]=-1,this.comp[2]=-1,this.comp[3]=-1,this.comp[4]=-1,this.comp[5]=-1,this.comp[6]=-1},i.MultiIndex.prototype={constructor:i.MultiIndex,componentsEqual:function(e){for(var t=0;t<i.NumberOfComponents;t++)if(-1!=this.comp[t]&&-1!=e.comp[t]&&this.comp[t]!=e.comp[t])return!1;return!0}},i.MultiIndexMultiBuffer=function(){this.old_index=0,this.comp=[];for(var e=0;e<i.NumberOfComponents;e++)this.comp[e]=null},i.MultiIndexMultiBuffer.prototype={constructor:i.MultiIndexMultiBuffer,componentsEqual:function(e){for(var t=0;t<i.NumberOfComponents;t++)if(null!=this.comp[t]&&null!=e.comp[t]){if(this.comp[t].bufferId!=e.comp[t].bufferId)return!1;if(this.comp[t].index!=e.comp[t].index)return!1}return!0}},i.Node=function(e,t,i,r,n,o,s){this.id=void 0!==e?e:"",this.type=void 0!==t?t:"Bag",this.childNodes=void 0!==i?i:[],this.matrix=void 0!==r?r:null,this.position=void 0!==n?n:{},this.rotation=void 0!==o?o:{},this.scale=void 0!==s?s:{}},i.Node.prototype={constructor:i.Node,add:function(e){null!=e&&this.childNodes.push(e)},childClone:function(){var e=new Array;for(var t in this.childNodes)e[t]="object"==typeof this.childNodes[t]?this.childNodes[t].clone():this.childNodes[t];return e},matrixClone:function(){if(this.matrix){var t=new e.Matrix4;return t.copy(this.matrix),t}},clone:function(){return new i.Node(this.id,this.type,this.childClone(),this.matrixClone(),this.position,this.rotation,this.scale)}},i.Mesh=function(e,t,r,n,o,s,a,u,l,c,h,p,d){this.id=void 0!==e?e:"",this.type=void 0!==t?t:"Mesh",this.vertexPositionArray=void 0!==r?r:null,this.vertexNormalArray=void 0!==n?n:null,this.vertexIndexArray=void 0!==o?o:null,this.vertexUvArray=void 0!==s?s:null,this.drawingGroups=void 0!==a?a:[],this._advancedInheritanceIndex=void 0!==d?d:-1,this.gas=void 0!==u?u:{fill:{},line:{}},this.AABB=void 0!==l?l:{},this._radius=0,this.material=void 0!==c?c:null,this.matrix=void 0!==p?p:null,this.rep=void 0!==h?new i.SGRep({cgmId:h.cgmId}):new i.SGRep},i.Mesh.prototype={constructor:i.Mesh,setMatrix:function(e){this.matrix=e},indexCopy:function(){if(this.vertexIndexArray instanceof Uint32Array)return new Uint32Array(this.vertexIndexArray)},tabCopy:function(e){if(e instanceof Float32Array)return new Float32Array(e)},gasCopy:function(){var e;return this.gas&&(e={fill:this.gas.fill,line:this.gas.line}),e},AABBCopy:function(){return this.AABB.min&&this.AABB.max?{min:[this.AABB.min[0],this.AABB.min[1],this.AABB.min[2]],max:[this.AABB.max[0],this.AABB.max[1],this.AABB.max[2]]}:{}},dGCopy:function(){var e=new Array;for(var t in this.drawingGroups)e[t]="object"==typeof this.drawingGroups[t]?this.drawingGroups[t].clone():this.drawingGroups[t];return e},clone:function(){var e=new i.Mesh(this.id,this.type,this.tabCopy(this.vertexPositionArray),this.tabCopy(this.vertexNormalArray),this.indexCopy(),this.tabCopy(this.vertexUvArray),this.dGCopy(),this.gasCopy(),this.AABBCopy(),this.material,this.rep,null,this._advancedInheritanceIndex);return this.vertexBinormalArray&&(e.vertexBinormalArray=this.tabCopy(this.vertexBinormalArray)),this.vertexTangentArray&&(e.vertexTangentArray=this.tabCopy(this.vertexTangentArray)),e}},i.MeshPrimitive=function(e,t,i,r,n){this.cgmId=e||0,this.groupIndex=t||0,this.start=i||0,this.count=r||0,this.boundingSphere=void 0,this.rep=0,this.decoration=n||0},i.MeshPrimitive.prototype={constructor:i.MeshPrimitive,clone:function(){if(this.boundingSphere){var e=new i.MeshPrimitive(this.cgmId,this.groupIndex,this.start,this.count,this.decoration);return e.boundingSphere={center:this.boundingSphere.center,radius:this.boundingSphere.radius},e}return this}},i.DrawingGroup=function(e,t,r,n,o,s,a,u,l,c,h,p){this.gas=e||null,this.material=t||null,this.glType=r,this._geomType=u||0,this.gasIndex=l,this.start=n||0,this.count=o||0,this._primitives=void 0!==s?s:[],this.geometry=null,this.vbStart=-1,this._noZPriority=void 0!==c?c:-1,this.ib=null,this._advancedInheritanceIndex=void 0!==h?h:-1,this.nonIndexed=!1,this.cullingData=null,this._nonBinary=!(this._primitives instanceof i.BinarySGPrimitiveArray),this._dimension=-1,this._instancingInfos=null,this._dependentDGs=null,this._updateLineWithShapes=null,this._completeSolid=!1,this._noPick=p||!1},i.DrawingGroup.prototype={constructor:i.DrawingGroup,clone:function(){var e=new i.DrawingGroup(this.gas,this.material,this.glType,this.start,this.count,void 0,void 0,this._geomType,this.gasIndex,this._noZPriority,this._advancedInheritanceIndex,this._noPick);if(e.copyPrimitives(this._primitives),e.geometry=this.geometry,e._dimension=this._dimension,e._instancingInfos=this._instancingInfos,e._instancingInfos){const t=e._instancingInfos.instanceAttribArrays;for(let e in t)"id"!==e&&(t[e].buffer=null)}return e._updateLineWithShapes=this._updateLineWithShapes,e._completeSolid=this._completeSolid,e},setInstancingParameters:function(e,i,r){let n={};if(null!==this._instancingInfos){let e=this._instancingInfos.instanceAttribArrays;for(let t in e)"id"!==t&&null!==e[t].buffer&&void 0!==e[t].buffer&&(n[t]=e[t].buffer)}t--,this._instancingInfos={nbInstances:e,instancingSelectionMode:r||"instance",instanceAttribArrays:{id:t},pickedInstanceId:-1,staleGLBuffers:[],useDefaultInstancing:!1};let o=this._instancingInfos.instanceAttribArrays,s=new Float32Array(e);for(var a=0;a<e;a++)s[a]=5+5*a;o.instanceId={},o.instanceId.array=s,o.instanceId.buffer=null,o.instanceId.itemSize=1,o.instanceId.type="f";for(let t=0;t<i.length;t++){const r=i[t];switch(o[r.attribName]={isMat4:!1,itemSize:0,array:r.isFlattened?new Float32Array(r.data):null,buffer:null,type:r.type},r.type){case"f":o[r.attribName].itemSize=1;break;case"v2":o[r.attribName].itemSize=2;break;case"v3":o[r.attribName].itemSize=3;break;case"v4":o[r.attribName].itemSize=4;break;case"m4":o[r.attribName].itemSize=4,o[r.attribName].isMat4=!0}if(!r.isFlattened)switch(r.type){case"v2":o[r.attribName].array=new Float32Array(2*e);for(var u=0;u<e;u++)o[r.attribName].array[2*u+0]=r.data[u].x,o[r.attribName].array[2*u+1]=r.data[u].y;break;case"v3":o[r.attribName].array=new Float32Array(3*e);for(u=0;u<e;u++)o[r.attribName].array[3*u+0]=r.data[u].x,o[r.attribName].array[3*u+1]=r.data[u].y,o[r.attribName].array[3*u+2]=r.data[u].z;break;case"v4":o[r.attribName].array=new Float32Array(4*e);for(u=0;u<e;u++)o[r.attribName].array[4*u+0]=r.data[u].x,o[r.attribName].array[4*u+1]=r.data[u].y,o[r.attribName].array[4*u+2]=r.data[u].z,o[r.attribName].array[4*u+3]=r.data[u].w;break;case"m4":o[r.attribName].array=new Float32Array(16*r.data.length);for(var l=0;l<r.data.length;l++){var c=new Float32Array(16);c=r.data[l].elements;for(a=0;a<16;a++)o[r.attribName].array[16*l+a]=c[a]}}}for(let e in n)void 0!==o[e]?(o[e].buffer=n[e],o[e].isDynamic=!0):this._instancingInfos.staleGLBuffers.push(n[e]);if(this.material._PDSFXData&&this.material._PDSFXData.PDSFX){const e=this.material;e._PDSFXData.pdsfxAttributesInternal={};for(let t=0;t<i.length;t++)e._PDSFXData.pdsfxAttributesInternal[i[t].attribName]={type:i[t].type,instancing:!0}}},_compactArrays:function(){if(this._nonBinary){var e=this._primitives;this._primitives=new Array(e.length);for(var t=0;t<e.length;t++)this._primitives[t]=e[t]}else this._primitives._compactArrays()},_getDimension:function(e,t){var i=2,r=this;if(r._geomType)i=e[r._geomType];else switch(r.glType){case 0:i=0;break;case 1:i=1;break;default:i=2}return 2===i&&(i=r.gas&&0===r.gas.side?5:2),this._dimension=i,i},copyPrimitives:function(e){var t=null;if(e instanceof i.BinarySGPrimitiveArray)return this._primitives=e.clone(),void(this._nonBinary=!1);this._nonBinary=!0,this._primitives=new Array(e.length);for(var r=0;r<e.length;r++)if((t=e[r])instanceof i.SGPrimitive)this._primitives[r]=t.clone();else{var n=new i.SGPrimitive;n.cgmId=t.cgmId,n.rep=t.rep,n.group=this,n.start=t.start,n.count=t.count,this._primitives[r]=n}},_computeOrientedBoundingBox:function(t,i,r,n,o,s,a){if(!t||this.isFiltered(i,a)||n&&r===e.FixedSizeFiltering.Exclude)return null;if(n&&r===e.FixedSizeFiltering.CenterOnly)return new e.Box3(new e.Vector3(0,0,0),new e.Vector3(0,0,0)).applyMatrix4(t);var u=new e.Vector3,l=new e.Vector3,c=new e.Vector3,h=new e.Vector3,p=null!==o?o:this.start,d=null!==s?s:this.count,m=this.geometry.vertexIndexArray;if(this.geometry.getVertexCount()){var g=m[p];this.geometry.getVertexPosition(g,h),l.set(h.x,h.y,h.z).applyMatrix4(t),c.set(h.x,h.y,h.z).applyMatrix4(t);for(var v=p+1;v<p+d;v++)g=m[v],this.geometry.getVertexPosition(g,h),u.set(h.x,h.y,h.z).applyMatrix4(t),u.x<l.x&&(l.x=u.x),u.y<l.y&&(l.y=u.y),u.z<l.z&&(l.z=u.z),u.x>c.x&&(c.x=u.x),u.y>c.y&&(c.y=u.y),u.z>c.z&&(c.z=u.z)}return new e.Box3(l,c)},_computePrimitiveOrientedBoundingBox:function(e,t,i,r,n,o){return this._nonBinary?this._primitives[e]._computeOrientedBoundingBox(t,i,r,n,o):this._primitives._computePrimitiveOrientedBoundingBox(e,t,i,r,n,o)},disabled:function(e,t,i){return console.warn("Deprecated, use isFiltered instead"),t=t||0,this.isFiltered(e&~t,i)},isFiltered:function(e,t){var i=t||this._geomType;return!(e<0||0===i)&&!((i&e)>0)},getPrimitiveCgmId:function(e){return this._nonBinary?this._primitives[e].cgmId:this._primitives.getPrimitiveCgmId(e)},_setPrimitiveCgmId:function(e,t){this._nonBinary?this._primitives[t].cgmId=e:this._primitives._setPrimitiveCgmId(e,t)},getPrimitiveType:function(e){return this._nonBinary?this._primitives[e].type:this._primitives.getPrimitiveType(e)},getPrimitiveRep:function(e){return this._nonBinary?this._primitives[e].rep:this._primitives.getPrimitiveRep(e)},_getSGPrimitive:function(e,t){return this._nonBinary?t?this._primitives[e]:this._primitives[e].clone():this._primitives._getSGPrimitive(e,t)},_getPrimitiveInternalNode:function(e){return this._nonBinary?this._primitives[e].internalNode:this._primitives._getPrimitiveInternalNode(e)},_setPrimitiveRep:function(e,t){this._nonBinary?this._primitives[t].rep=e:this._primitives._setPrimitiveRep(e,t)},_setPrimitiveInternalNode:function(e,t){this._nonBinary?this._primitives[t].internalNode=e:this._primitives._setPrimitiveInternalNode(e,t)},_setPrimitiveStart:function(e,t){this._nonBinary?this._primitives[t].start=e:this._primitives._setPrimitiveStart(e,t)},_setPrimitiveCount:function(e,t){this._nonBinary?this._primitives[t].count=e:this._primitives._setPrimitiveCount(e,t)},getPrimitiveStart:function(e){return this._nonBinary?this._primitives[e].start:this._primitives.getPrimitiveStart(e)},getPrimitiveCount:function(e){return this._nonBinary?this._primitives[e].count:this._primitives.getPrimitiveCount(e)},getPrimitiveGroup:function(e){return this._nonBinary?this._primitives[e].group:this._primitives.getPrimitiveGroup(e)},getPrimitiveDecoration:function(e){return this._nonBinary?this._primitives[e].decoration:this._primitives.getPrimitiveDecoration(e)},getPrimitiveBoundingSphere:function(e){return this._nonBinary?this._primitives[e].boundingSphere:this._primitives.getPrimitiveBoundingSphere(e)},setPrimitiveBoundingSphere:function(e,t){this._nonBinary?this._primitives[e].boundingSphere=t:this._primitives.setPrimitiveBoundingSphere(e,t)},getPrimitivesCount:function(){return this._nonBinary?this._primitives.length:this._primitives.getPrimitivesCount()},getPrimitiveIdentificationObject:function(e){return this._nonBinary?this._primitives[e].IdentObj:this._primitives.getPrimitiveIdentificationObject(e)},setPrimitiveIdentificationObject:function(e,t){this._nonBinary?this._primitives[t].IdentObj=e:this._primitives.setPrimitiveIdentificationObject(e,t)},computePrimitiveBoundingSphere:function(e,t){return this._nonBinary?this._primitives[e].computeBoundingSphere(t):this._primitives.computePrimitiveBoundingSphere(e,t)},startIteration:function(){return!0},endIteration:function(){return!0},computeCompleteSolidStatus:function(){let e=!0;if(4===this.glType){let t,i=new Map,r=new Set,n=this.getPrimitivesCount();for(t=0;e&&t<n;t++){let n=this.getPrimitiveRep(t);if(n&&1===n.solid){let e=i.get(n)||0;e++,i.set(n,e),r.add(n)}else e=!1}r.forEach(t=>{if(t){i.get(t)!==t.getPrimitivesCountWithGLType(4)&&(e=!1)}else e=!1})}else e=!1;e&&(this._completeSolid=!0)}},Object.defineProperty(i.DrawingGroup.prototype,"geomType",{get:function(){return console.warn("[Mesh.DrawingGroup] DOT NOT ACCESS geomType directly !\n"),i.GeomTypeString[this._geomType]},set:function(t){console.warn("[Mesh.DrawingGroup] DOT NOT ACCESS geomType directly !\n"),this._geomType=e.GeomTypeEnum[t]}});var d=0;Object.defineProperty(i.DrawingGroup.prototype,"primitives",{get:function(){if(d<10){var e=new Error,t="#PrimApi - DG.GetPrimitives - "+(e.stack?e.stack.split("\n")[1]+" - "+e.stack.split("\n")[2]:"");r.has(t.hashCode())||(r.add(t.hashCode()),console.error(t)),d++}return this._primitives},set:function(){throw"NO"}}),i.SelectionGroup=function(){this.geometries={}},i.SelectionGroup.prototype={constructor:i.SelectionGroup,contains:function(e){for(var t in this.geometries)for(var i=this.geometries[t],r=0;r<i.length;r++)for(var n=i[r].primitives,o=0;o<n.length;o++)if(n[o].isEqual(e))return!0;return!1},getFirstPrimitive:function(){for(var e in this.geometries){var t=this.geometries[e];if(t.length&&t[0].primitives.length)return t[0].primitives[0]}return null},getPrimitives:function(){var e=[];for(var t in this.geometries)for(var i=this.geometries[t],r=0;r<i.length;r++)for(var n=i[r].primitives,o=0;o<n.length;o++)e.push(n[o]);return e},applyToPrimitives:function(e){for(var t in this.geometries)for(var i=this.geometries[t],r=0;r<i.length;r++)for(var n=i[r].primitives,o=0;o<n.length;o++)e&&e(n[o])},addPrimitive:function(e){var t=0,i=e.getGroup(),r=i.geometry.id,n=this.geometries[r];for(n||(n=[],this.geometries[r]=n),t=0;t<n.length;t++)if(n[t].drawingGroup===i){n[t].primitives.push(e);break}t===n.length&&n.push({drawingGroup:i,primitives:[e]})},clone:function(){var e=new i.SelectionGroup;for(var t in this.geometries){var r=this.geometries[t];e.geometries[t]=[];for(var n=0;n<r.length;n++)e.geometries[t][n]={drawingGroup:r[n].drawingGroup,primitives:r[n].primitives.slice()}}return e},getIdentificationObject:function(){var e,t=this.getFirstPrimitive();return t&&t.getIdentificationObject&&(e=t.getIdentificationObject()),e},computeBoundingSphere:function(){for(var t=null,i=new e.Sphere,r=this.getPrimitives(),n=0;n<r.length;n++){r[n].computeBoundingSphere(i),t?i.mergeWithSphere(t,t):t=i.clone()}return t},_computeOrientedBoundingBox:function(t,i,r,n,o){for(var s,a=new e.Box3,u=this.getPrimitives(),l=0;l<u.length;l++){(s=u[l]._computeOrientedBoundingBox(t,i,r,n,o))&&(a=a.union(s))}return a}},i.processRepsCGR=function(t,r,n,o,s,a){var u=0,l=0,c=!r,h=[];a&&(h=a);for(var p=o||{},d=!1,m=!1,g=!1,v=!1,f=!1,y=!1,x=0;x<t.length;x++)u+=t[x].vertexPositionArray?t[x].vertexPositionArray.length:0,l+=t[x].vertexIndexArray.length,d||null===t[x].vertexNormalArray||(d=!0),m||null===t[x].vertexUvArray||(m=!0),!g&&t[x].vertexUv2Array&&(g=!0),!v&&t[x].vertexTangentArray&&(v=!0),!f&&t[x].vertexBinormalArray&&(f=!0),!y&&t[x].vertexColorArray&&(y=!0);var b,I=new Float32Array(u);b=u/3<65535?new Uint16Array(l):new Uint32Array(l);var _=d?new Float32Array(u):null,A=m?new Float32Array(u):null,S=g?new Float32Array(u):null,P=v?new Float32Array(u):null,w=f?new Float32Array(u):null,T=y?new Float32Array(4*u/3):null,C=0;for(x=0;x<t.length;x++){var G=t[x],B=G.vertexPositionArray;B&&(I.set(B,C),null!==_&&G.vertexNormalArray&&_.set(G.vertexNormalArray,C),null!==A&&G.vertexUvArray&&A.set(G.vertexUvArray,C),null!==S&&G.vertexUv2Array&&S.set(G.vertexUv2Array,C),null!==P&&G.vertexTangentArray&&P.set(G.vertexTangentArray,C),null!==w&&G.vertexBinormalArray&&w.set(G.vertexBinormalArray,C),null!==T&&G.vertexColorArray&&T.set(G.vertexColorArray,C));for(var E=0;E<G.drawingGroups.length;E++){var O=G.drawingGroups[E];-1!==G._advancedInheritanceIndex&&(O._advancedInheritanceIndex=G._advancedInheritanceIndex),O.vbStart=C/3,O.ib=G.vertexIndexArray,O.geometry=t[x],null==O.gas&&(4==O.glType||5==O.glType?O.gas=t[x].gas.fill:1==O.glType?O.gas=t[x].gas.line:0==O.glType&&(O.gas=t[x].gas.point));for(var M=0;M<O._primitives.length;M++){if((se=O._primitives[M]).rep=G.rep,se.boundingSphere){var N=new e.Vector3(se.boundingSphere.center[0],se.boundingSphere.center[1],se.boundingSphere.center[2]);!!G.globalMatrix&&!G.globalMatrix.isIdentity()&&(N.applyMatrix4(t[x].globalMatrix),se.boundingSphere.center=[N.x,N.y,N.z],se.boundingSphere.radius*=t[x].globalMatrix.getMaxScaleOnAxis())}}o.withSceneGraphOrder||h.push(O)}C+=B?B.length:0}o.withSceneGraphOrder||h.sort(function(e,t){if(e.glType<t.glType)return 1;if(e.glType>t.glType)return-1;if(null==e.material&&null!=t.material)return-1;if(null!=e.material&&null==t.material)return 1;if(null!=e.material&&null!=t.material){if(e.material.id<t.material.id)return-1;if(e.material.id>t.material.id)return 1;if(e.material.file<t.material.file)return-1;if(e.material.file>t.material.file)return 1}if(null==e.gas&&null!=t.gas)return-1;if(null!=e.gas&&null==t.gas)return-1;if(null!=e.gas&&null!=t.gas){if(e.gas.set<t.gas.set)return 1;if(t.gas.set<e.gas.set)return-1;if(e.gas.rgba<t.gas.rgba)return 1;if(t.gas.rgba<e.gas.rgba)return-1}if(e._geomType&&t._geomType){if(e._geomType<t._geomType)return-1;if(e._geomType>t._geomType)return 1;if(n){if(e.geometry._radius<t.geometry._radius)return 1;if(e.geometry._radius>t.geometry._radius)return-1}}if(n){if(e.geometry._radius<t.geometry._radius)return 1;if(e.geometry._radius>t.geometry._radius)return-1}return 0});var z=[],R=h.length>0?h[0].gas:null,D=h.length>0?h[0].material:null,V=h.length>0?h[0].glType:0,k=h.length>0?h[0]._advancedInheritanceIndex:-1,F=h.length>0?h[0]._geomType:0,U=0,L=0,j=0,H=0,q=R,W=[],X=[],K=p.withBoundingElement;for(x=0;x<h.length;x++){if((O=h[x]).glType==V&&O._geomType===F&&O._advancedInheritanceIndex===k&&R.isEqual(O.gas)&&(null==D&&null==O.material||null!=D&&null!=O.material&&D.id==O.material.id&&D.file==O.material.file)){n&&W.push({start:U,count:O.count,radius:O.geometry._radius,rep:O.geometry.rep}),j+=O.count,X.push(O);for(E=0;E<O.count;E++)b[U++]=O.vbStart+O.ib[O.start+E]}else{var Y=null;if(j>0){Y=new i.DrawingGroup(R,h[x-1].material,V,L,j,void 0,void 0,F,H,-1,k),n&&(Y.cullingData=W&&W.length>1?W:null);for(var J=0,Z=0;Z<X.length;++Z)J+=X[Z]._primitives.length;var Q=new Uint32Array(5*J),$=null;K&&Y.glType>0&&($=new Float32Array(4*J));for(var ee=0,te=L,ie=[],re=0;re<X.length;++re){var ne=X[re],oe=5*ee;if(ne.geometry.noShow&&p.containNoShow)for(Z=0;Z<ne._primitives.length;Z++){var se=ne._primitives[Z];if(ie.push(ee),Q[oe++]=se.cgmId+1,Q[oe++]=se.rep,Q[oe++]=te,Q[oe++]=se.count,Q[oe++]=se.decoration,$&&se.boundingSphere)$[ae=4*ee]=se.boundingSphere.center[0],$[ae+1]=se.boundingSphere.center[1],$[ae+2]=se.boundingSphere.center[2],$[ae+3]=se.boundingSphere.radius;ee++,te+=se.count}else for(Z=0;Z<ne._primitives.length;Z++){se=ne._primitives[Z];if(Q[oe++]=se.cgmId+1,Q[oe++]=se.rep,Q[oe++]=te,Q[oe++]=se.count,Q[oe++]=se.decoration,$&&se.boundingSphere)$[ae=4*ee]=se.boundingSphere.center[0],$[ae+1]=se.boundingSphere.center[1],$[ae+2]=se.boundingSphere.center[2],$[ae+3]=se.boundingSphere.radius;ee++,te+=se.count}}Y._primitives=$?{prims:Q,bs:$}:Q,ie.length&&(Y.noShowPrim=ie),z.push(Y)}X=[],W=[],q.isEqual(O.gas)||(q=O.gas,H++),V=O.glType,k=O._advancedInheritanceIndex,F=O._geomType,R=O.gas,D=O.material,L=U,j=O.count,X.push(O),n&&W.push({start:U,count:O.count,radius:O.geometry._radius,rep:O.geometry.rep});for(E=0;E<O.count;E++)b[U++]=O.vbStart+O.ib[O.start+E]}}if(j>0){Y=new i.DrawingGroup(R,h[h.length-1].material,V,L,j,void 0,void 0,F,H,-1,k);n&&(Y.cullingData=W&&W.length>1?W:null);for(J=0,Z=0;Z<X.length;++Z)J+=X[Z]._primitives.length;Q=new Uint32Array(5*J),$=null;K&&Y.glType>0&&($=new Float32Array(4*J));for(te=L,ee=0,ie=[],re=0;re<X.length;++re){oe=5*ee;if((O=X[re]).geometry.noShow&&p.containNoShow)for(Z=0;Z<O._primitives.length;Z++){se=O._primitives[Z];if(ie.push(ee),Q[oe++]=se.cgmId+1,Q[oe++]=se.rep,Q[oe++]=te,Q[oe++]=se.count,Q[oe++]=se.decoration,$&&se.boundingSphere)$[ae=4*ee]=se.boundingSphere.center[0],$[ae+1]=se.boundingSphere.center[1],$[ae+2]=se.boundingSphere.center[2],$[ae+3]=se.boundingSphere.radius;ee++,te+=se.count}else for(Z=0;Z<O._primitives.length;Z++){var ae;se=O._primitives[Z];if(Q[oe++]=se.cgmId+1,Q[oe++]=se.rep,Q[oe++]=te,Q[oe++]=se.count,Q[oe++]=se.decoration,$&&se.boundingSphere)$[ae=4*ee]=se.boundingSphere.center[0],$[ae+1]=se.boundingSphere.center[1],$[ae+2]=se.boundingSphere.center[2],$[ae+3]=se.boundingSphere.radius;ee++,te+=se.count}}Y._primitives=$?{prims:Q,bs:$}:Q,ie.length&&(Y.noShowPrim=ie),z.push(Y)}var ue=new i.Mesh;if(ue.vertexPositionArray=I,ue.vertexNormalArray=_,ue.vertexUvArray=A,ue.vertexUv2Array=S,ue.vertexTangentArray=P,ue.vertexBinormalArray=w,ue.vertexIndexArray=b,ue.vertexColorArray=T,ue.drawingGroups=z,void 0===t[0]){var le=new e.Color;le.setRGB(.5,.5,.5),ue.gas.fill={color:le,opacity:1,solid:0},ue.gas.line={color:le,opacity:1,lineWidth:1},ue.gas.point={color:le,opacity:1,pointsize:1}}else ue.gas=t[0].gas;if(c){var ce=[0,0,0],he=[0,0,0];if(u>=3){ce=[I[0],I[1],I[2]],he=[I[0],I[1],I[2]];for(x=0;x<u;x+=3)I[x]<ce[0]&&(ce[0]=I[x]),I[x+1]<ce[1]&&(ce[1]=I[x+1]),I[x+2]<ce[2]&&(ce[2]=I[x+2]),I[x]>he[0]&&(he[0]=I[x]),I[x+1]>he[1]&&(he[1]=I[x+1]),I[x+2]>he[2]&&(he[2]=I[x+2])}ue.AABB={min:ce,max:he}}return ue},i.processReps=function(t,r,n){for(var o=0,s=0,a=!r,u=[],l=!1,c=!1,h=!1,p=!1,d=!1,m=0;m<t.length;m++)o+=t[m].vertexPositionArray?t[m].vertexPositionArray.length:0,s+=t[m].vertexIndexArray.length,l||null===t[m].vertexNormalArray||(l=!0),c||null===t[m].vertexUvArray||(c=!0),!h&&t[m].vertexUv2Array&&(h=!0),!p&&t[m].vertexTangentArray&&(p=!0),!d&&t[m].vertexBinormalArray&&(d=!0);var g,v=new Float32Array(o);g=o/3<65535?new Uint16Array(s):new Uint32Array(s);var f=l?new Float32Array(o):null,y=c?new Float32Array(o):null,x=h?new Float32Array(o):null,b=p?new Float32Array(o):null,I=d?new Float32Array(o):null,_=0;for(m=0;m<t.length;m++){if(t[m].vertexPositionArray)for(var A=0;A<t[m].vertexPositionArray.length;A++)v[_+A]=t[m].vertexPositionArray[A],null!==f&&(f[_+A]=null!==t[m].vertexNormalArray?t[m].vertexNormalArray[A]:0),null!==y&&(y[_+A]=null!==t[m].vertexUvArray?t[m].vertexUvArray[A]:0),null!==x&&(x[_+A]=t[m].vertexUv2Array?t[m].vertexUv2Array[A]:0),null!==b&&(b[_+A]=t[m].vertexTangentArray?t[m].vertexTangentArray[A]:0),null!==I&&(I[_+A]=t[m].vertexBinormalArray?t[m].vertexBinormalArray[A]:0);for(A=0;A<t[m].drawingGroups.length;A++){(V=t[m].drawingGroups[A]).vbStart=_/3,V.ib=t[m].vertexIndexArray,V.geometry=t[m],null==V.gas&&(4==V.glType||5==V.glType?V.gas=t[m].gas.fill:1==V.glType?V.gas=t[m].gas.line:0==V.glType&&(V.gas=t[m].gas.point));for(var S=0;S<V._primitives.length;S++){if((U=V._primitives[S]).rep=t[m].rep,U.boundingSphere){var P=new e.Vector3(U.boundingSphere.center[0],U.boundingSphere.center[1],U.boundingSphere.center[2]);!!t[m].globalMatrix&&!t[m].globalMatrix.isIdentity()&&(P.applyMatrix4(t[m].globalMatrix),U.boundingSphere.center=[P.x,P.y,P.z],U.boundingSphere.radius*=t[m].globalMatrix.getMaxScaleOnAxis())}}u.push(V)}_+=t[m].vertexPositionArray?t[m].vertexPositionArray.length:0}u.sort(function(e,t){if(e.glType<t.glType)return-1;if(e.glType>t.glType)return 1;if(null==e.material&&null!=t.material)return-1;if(null!=e.material&&null==t.material)return 1;if(null!=e.material&&null!=t.material){if(e.material.id<t.material.id)return-1;if(e.material.id>t.material.id)return 1;if(e.material.file<t.material.file)return-1;if(e.material.file>t.material.file)return 1}if(null==e.gas&&null!=t.gas)return-1;if(null!=e.gas&&null==t.gas)return-1;if(null!=e.gas&&null!=t.gas){var r=i.compareGASMaterial(e.gas,t.gas);if(r)return r}if(e._geomType&&t._geomType){if(e._geomType<t._geomType)return-1;if(e._geomType>t._geomType)return 1;if(e.geometry._radius<t.geometry._radius)return 1;if(e.geometry._radius>t.geometry._radius)return-1}return e.geometry._radius<t.geometry._radius?1:e.geometry._radius>t.geometry._radius?-1:0});var w=[],T=[],C=u.length>0?u[0].gas:null,G=u.length>0?u[0].material:null,B=u.length>0?u[0].glType:0,E=u.length>0?u[0]._geomType:0,O=0,M=0,N=0,z=0,R=C,D=[];for(m=0;m<u.length;m++){var V;if((V=u[m]).glType==B&&V._geomType===E&&!i.compareGASMaterial(C,V.gas)&&(null==G&&null==V.material||null!=G&&null!=V.material&&G.id==V.material.id&&G.file==V.material.file)){n&&D.push({start:O,count:V.count,radius:V.geometry._radius,rep:V.geometry.rep}),N+=V.count;for(var k=O,F=0;F<V._primitives.length;F++){var U=V._primitives[F],L=new i.SGPrimitive({cgmId:U.cgmId,rep:U.rep,start:k,count:U.count});U.decoration&&(L.decoration=U.decoration),U.boundingSphere&&(L.boundingSphere=U.boundingSphere),T.push(L),U.rep._primitives.push(L),k+=U.count}for(A=0;A<V.count;A++)g[O++]=V.vbStart+V.ib[V.start+A]}else{var j=null;if(N>0){(j=new i.DrawingGroup(C,G,B,M,N,void 0,void 0,E,z))._primitives=T,n&&(j.cullingData=D&&D.length>1?D:null);for(var H=0;H<T.length;H++)T[H].group=j;w.push(j)}T=[],D=[],0!==i.compareGASMaterial(R,V.gas)&&(R=V.gas,z++),B=V.glType,E=V._geomType,C=V.gas,G=V.material,M=O,N=V.count,n&&D.push({start:O,count:V.count,radius:V.geometry._radius,rep:V.geometry.rep});for(k=O,F=0;F<V._primitives.length;F++){U=V._primitives[F],L=new i.SGPrimitive({cgmId:U.cgmId,rep:U.rep,start:k,count:U.count});U.decoration&&(L.decoration=U.decoration),U.boundingSphere&&(L.boundingSphere=U.boundingSphere),T.push(L),U.rep._primitives.push(L),k+=U.count}for(A=0;A<V.count;A++)g[O++]=V.vbStart+V.ib[V.start+A]}}if(N>0){(j=new i.DrawingGroup(C,G,B,M,N,void 0,void 0,E,z))._primitives=T,n&&(j.cullingData=D&&D.length>1?D:null);for(H=0;H<T.length;H++)T[H].group=j;w.push(j)}var q=new i.Mesh;if(q.vertexPositionArray=v,q.vertexNormalArray=f,q.vertexUvArray=y,q.vertexUv2Array=x,q.vertexTangentArray=b,q.vertexBinormalArray=I,q.vertexIndexArray=g,q.drawingGroups=w,void 0===t[0]){var W=new e.Color;W.setRGB(.5,.5,.5),q.gas.fill={color:W,opacity:1,solid:0},q.gas.line={color:W,opacity:1,lineWidth:1},q.gas.point={color:W,opacity:1,pointsize:1}}else q.gas=t[0].gas;if(a){var X=[0,0,0],K=[0,0,0];if(o>=3){X=[v[0],v[1],v[2]],K=[v[0],v[1],v[2]];for(m=0;m<o;m+=3)v[m]<X[0]&&(X[0]=v[m]),v[m+1]<X[1]&&(X[1]=v[m+1]),v[m+2]<X[2]&&(X[2]=v[m+2]),v[m]>K[0]&&(K[0]=v[m]),v[m+1]>K[1]&&(K[1]=v[m+1]),v[m+2]>K[2]&&(K[2]=v[m+2])}q.AABB={min:X,max:K}}return q},i.divideRep=function(e,t,r){var n=e.vertexPositionArray?e.vertexPositionArray.length:0,o=(e.vertexIndexArray.length,[]),s=r||{};if(t)for(var a=0,u=(s=r||{}).withBoundingElement,l=0;l<e.drawingGroups.length;l++){null==(x=e.drawingGroups[l]).gas&&(4==x.glType||5==x.glType?x.gas=e.gas.fill:1==x.glType?x.gas=e.gas.line:0==x.glType&&(x.gas=e.gas.point)),a=x._primitives.length;var c=new Uint32Array(5*a),h=null;u&&x.glType>0&&(h=new Float32Array(4*a));var p=0,d=0,m=[];if(e.noShow&&s.containNoShow)for(var g=0;g<x._primitives.length;g++){var v=x._primitives[g];m.push(g),c[p++]=v.cgmId+1,c[p++]=e.rep,c[p++]=v.start,c[p++]=v.count,c[p++]=v.decoration,h&&v.boundingSphere&&(h[d++]=v.boundingSphere.center[0],h[d++]=v.boundingSphere.center[1],h[d++]=v.boundingSphere.center[2],h[d++]=v.boundingSphere.radius)}else for(g=0;g<x._primitives.length;g++){v=x._primitives[g];c[p++]=v.cgmId+1,c[p++]=e.rep,c[p++]=v.start,c[p++]=v.count,c[p++]=v.decoration,h&&v.boundingSphere&&(h[d++]=v.boundingSphere.center[0],h[d++]=v.boundingSphere.center[1],h[d++]=v.boundingSphere.center[2],h[d++]=v.boundingSphere.radius)}x._primitives=h?{prims:c,bs:h}:c,m.length&&(x.noShowPrim=m)}else for(g=0;g<e.drawingGroups.length;g++){null==(x=e.drawingGroups[g]).gas&&(4==x.glType||5==x.glType?x.gas=e.gas.fill:1==x.glType?x.gas=e.gas.line:0==x.glType&&(x.gas=e.gas.point));for(l=0;l<x._primitives.length;l++){v=x._primitives[l];var f=new i.SGPrimitive({cgmId:v.cgmId,rep:e.rep,group:x,start:v.start,count:v.count});v.decoration&&(f.decoration=v.decoration),v.boundingSphere&&(f.boundingSphere=v.boundingSphere),x._primitives[l]=f,e.rep._primitives.push(f)}}var y,x,b=e.vertexIndexArray;y=n/3<65535?new Uint16Array(b.length):new Uint32Array(b.length);for(var g=0;g<b.length;g++)y[g]=b[g];return e.vertexIndexArray=y,i.unindexPoints(e),o.push(e),o},i.unindexPoints=function(e){if(!n&&!o)return!1;if(!e.vertexPositionArray)return!1;var t,i,r=!1,s=e.vertexPositionArray.length/3,a=new Int32Array(s);for(t=0;t<s;t++)a[t]=-1;var u=0;for(t=0;t<e.drawingGroups.length;t++){if(!((c=e.drawingGroups[t]).glType>0)){for(r=!0,i=c.start;i<c.start+c.count;i++){-1===a[h=e.vertexIndexArray[i]]?(e.vertexIndexArray[i]=u,a[h]=u,u++):e.vertexIndexArray[i]=a[h]}c.nonIndexed=!0,c.start=e.vertexIndexArray[c.start]}}if(!r)return!1;var l=u;for(t=0;t<u;t++)if(-1===a[t])for(;l<s;){if(-1!==a[l]){a[t]=l,l++;break}a[l]=l,l++}for(;l<s;)-1===a[l]&&(a[l]=l),l++;for(t=0;t<e.drawingGroups.length;t++){var c;if(0!==(c=e.drawingGroups[t]).glType)for(i=c.start;i<c.start+c.count;i++){var h=e.vertexIndexArray[i];e.vertexIndexArray[i]=a[h]}}var p=[];e.vertexPositionArray&&p.push(e.vertexPositionArray),e.vertexNormalArray&&p.push(e.vertexNormalArray),e.vertexUvArray&&p.push(e.vertexUvArray),e.vertexUv2Array&&p.push(e.vertexUv2Array),e.vertexTangentArray&&p.push(e.vertexTangentArray),e.vertexBinormalArray&&p.push(e.vertexBinormalArray);var d=new Float32Array(3*p.length),m=new Float32Array(3*p.length);for(t=0;t<s;t++){var g=t,v=a[g];if(v!==g&&-1!==v){for(i=0;i<p.length;i++){var f=p[i];d[3*i]=f[3*g],d[3*i+1]=f[3*g+1],d[3*i+2]=f[3*g+2]}for(;-1!==v;){for(i=0;i<p.length;i++){f=p[i];m[3*i]=f[3*v],m[3*i+1]=f[3*v+1],m[3*i+2]=f[3*v+2],f[3*v]=d[3*i],f[3*v+1]=d[3*i+1],f[3*v+2]=d[3*i+2],d[3*i]=m[3*i],d[3*i+1]=m[3*i+1],d[3*i+2]=m[3*i+2]}a[g]=-1,v=a[g=v]}}}return!0},i.compareGASMaterial=function(e,t){if(e.opacity<t.opacity)return-1;if(e.opacity>t.opacity)return 1;if(e.color.r<t.color.r)return-1;if(e.color.r>t.color.r)return 1;if(e.color.g<t.color.g)return-1;if(e.color.g>t.color.g)return 1;if(e.color.b<t.color.b)return-1;if(e.color.b>t.color.b)return 1;if(e.thickness&&t.thickness){if(e.thickness<t.thickness)return-1;if(e.thickness>t.thickness)return 1}if(e.lineWidth&&t.lineWidth){if(e.pattern<t.pattern)return-1;if(e.pattern>t.pattern)return 1;if(e.lineWidth<t.lineWidth)return-1;if(e.lineWidth>t.lineWidth)return 1;if((e.forceMaterial||t.forceMaterial)&&(!e.forceMaterial||!t.forceMaterial))return e.forceMaterial?-1:1}if(e.pointsize&&t.pointsize){if(e.pointsize<t.pointsize)return-1;if(e.pointsize>t.pointsize)return 1;if((e.forceMaterial||t.forceMaterial)&&(!e.forceMaterial||!t.forceMaterial))return e.forceMaterial?-1:1}if(e.symbol&&t.symbol){if(e.symbol<t.symbol)return-1;if(e.symbol>t.symbol)return 1;if(e.symbol.id<t.symbol.id)return-1;if(e.symbol.id>t.symbol.id)return 1}if(null!=e.solid&&null!=t.solid){if(e.solid<t.solid)return-1;if(e.solid>t.solid)return 1}return 0},i.applyMat=function(t,i,r,n){if(null!=i){if(t.vertexNormalArray)for(var o=0;o<t.vertexNormalArray.length;o+=3){(s=new e.Vector3(t.vertexNormalArray[o],t.vertexNormalArray[o+1],t.vertexNormalArray[o+2])).applyMatrix4(n),t.vertexNormalArray[o]=s.x,t.vertexNormalArray[o+1]=s.y,t.vertexNormalArray[o+2]=s.z}if(t.vertexPositionArray){for(o=0;o<t.vertexPositionArray.length;o+=3){var s;(s=new e.Vector3(t.vertexPositionArray[o],t.vertexPositionArray[o+1],t.vertexPositionArray[o+2])).applyMatrix4(i),t.vertexPositionArray[o]=s.x,t.vertexPositionArray[o+1]=s.y,t.vertexPositionArray[o+2]=s.z}var a=t.drawingGroups;for(o=0;o<a.length;++o){var u=(d=a[o]).material;if(!(!u||u.id<0||(r[u.id].physicalMaterial&&r[u.id].physicalMaterial.PhysicalMaterial.MappingOperator?"None"==r[u.id].physicalMaterial.PhysicalMaterial.MappingOperator.Type:!r[u.id].mapping||r[u.id].mapping.type<0))){var l=(new e.Matrix4).getInverse(i),c=JSON.parse(JSON.stringify(r[u.id])),h=c.physicalMaterial&&c.physicalMaterial.PhysicalMaterial.MappingOperator;h||(h=c.mapping),h&&h.UvTransformation&&(h.UvTransformation=h.UvTransformation.slice(0));var p=new e.Matrix4;h&&h.ObjectTransformation&&(p.elements=h.ObjectTransformation.slice(0)),p.multiply(l),h.ObjectTransformation=p.elements,d.material.id=r.length,r.push(c)}}if(i.determinant()<0)for(o=0;o<a.length;++o){var d;if(4==(d=a[o]).glType)for(var m=d.count/3,g=0;g<m;g++){var v=t.vertexIndexArray[d.start+3*g],f=t.vertexIndexArray[d.start+3*g+1];t.vertexIndexArray[d.start+3*g]=f,t.vertexIndexArray[d.start+3*g+1]=v}}}}},i.computeBB=function(e){var t=[0,0,0],i=[0,0,0];if(e.vertexPositionArray){var r=e.vertexPositionArray.length;if(r>=3){t=[e.vertexPositionArray[0],e.vertexPositionArray[1],e.vertexPositionArray[2]],i=[e.vertexPositionArray[0],e.vertexPositionArray[1],e.vertexPositionArray[2]];for(var n=0;n<r;n+=3)e.vertexPositionArray[n]<t[0]&&(t[0]=e.vertexPositionArray[n]),e.vertexPositionArray[n+1]<t[1]&&(t[1]=e.vertexPositionArray[n+1]),e.vertexPositionArray[n+2]<t[2]&&(t[2]=e.vertexPositionArray[n+2]),e.vertexPositionArray[n]>i[0]&&(i[0]=e.vertexPositionArray[n]),e.vertexPositionArray[n+1]>i[1]&&(i[1]=e.vertexPositionArray[n+1]),e.vertexPositionArray[n+2]>i[2]&&(i[2]=e.vertexPositionArray[n+2])}}e.AABB={min:t,max:i}},i._getCurrentSag=function(e,t){if(!e)return console.warn("No sag setting"),.2;let i=.2,r=e.scale?e.scale:1;switch(e.sagMode){case 0:t>0&&(i=.01*t*e.sag);break;case 1:i=e.sag*r;break;case 2:i=.2*r;break;case 3:i=.4*r}return i<.01&&(i=.01),t>0&&i>.1*t&&(i=.1*t),i},i._computeMaxAngleStep=function(e,t){let i=2*Math.acos(1-e/t);return i<.001&&(i=.001),i},i._computeAngleStep=function(e,t){return e/t},i._computeNbCirclePoints=function(e,t){let i=Math.PI/4;t>i&&(t=i);let r=Math.ceil(e/t);return r<3&&(r=3),[r,t=this._computeAngleStep(e,r)]},i._createCustomCylindricalMesh=function(t,r,n,o,s,a,u,l,c,h,p){var d=o>0,m=n>0,g=new e.Vector3(r[0],r[1],r[2]),x=new e.Vector3(t[0],t[1],t[2]),b=new e.Vector4;b.subVectors(g,x),b.w=0,b.normalize();var I=new e.Matrix4;0===b.x&&0===b.y?I.identity():I.set(b.x/Math.sqrt(b.x*b.x+b.y*b.y),b.y/Math.sqrt(b.x*b.x+b.y*b.y),0,0,-b.y/Math.sqrt(b.x*b.x+b.y*b.y),b.x/Math.sqrt(b.x*b.x+b.y*b.y),0,0,0,0,1,0,0,0,0,1);var _=new e.Matrix4;0===b.x&&0===b.y&&0===b.z?_.identity():_.set(b.z/Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z),0,-Math.sqrt(b.x*b.x+b.y*b.y)/Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z),0,0,1,0,0,Math.sqrt(b.x*b.x+b.y*b.y)/Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z),0,b.z/Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z),0,0,0,0,1);var A=new e.Matrix4;A.multiplyMatrices(_,I),A.transpose();var S=new e.Vector3(x.x,x.y,x.z),P=A.clone();A.elements[12]=S.x,A.elements[13]=S.y,A.elements[14]=S.z;var w=Math.sqrt((x.x-g.x)*(x.x-g.x)+(x.y-g.y)*(x.y-g.y)+(x.z-g.z)*(x.z-g.z));let T=Math.max(n,o),C=this._getCurrentSag(u,T),G=this._computeMaxAngleStep(C,T),B=0;[B,G]=this._computeNbCirclePoints(2*Math.PI,G);var E=(n-o)/w,O=6*B,M=2*B,N=2*B;d&&(O+=3*(B-2),p||(O+=2*B),B,N+=B,M+=B),m&&(O+=3*(B-2),p||(O+=2*B),B,N+=B,M+=B);for(var z=new Uint16Array(O),R=z,D=0,V=0;V<B-1;++V){var k=V+1;R[D++]=V,R[D++]=k,R[D++]=B+k,R[D++]=V,R[D++]=B+k,R[D++]=B+V}k=0;if(R[D++]=B-1,R[D++]=k,R[D++]=B+k,R[D++]=B-1,R[D++]=B+k,R[D++]=B+B-1,d)for(V=0;V<B-2;V++)R[D++]=2*B,R[D++]=2*B+V+1,R[D++]=2*B+V+2;if(m)if(d)for(V=0;V<B-2;V++)R[D++]=3*B,R[D++]=3*B+V+2,R[D++]=3*B+V+1;else for(V=0;V<B-2;V++)R[D++]=2*B,R[D++]=2*B+V+2,R[D++]=2*B+V+1;if(!p){if(d){for(V=0;V<B-1;++V)R[D++]=B+V,R[D++]=B+V+1;R[D++]=B+B-1,R[D++]=B}if(m){for(V=0;V<B-1;++V)R[D++]=V,R[D++]=V+1;R[D++]=B-1,R[D++]=0}}var F=new Float32Array(3*M),U=new Float32Array(3*M),L=F,j=U,H=0;for(V=0;V<B;V++,H+=3){var q=V/B*2*Math.PI;L[H]=n*Math.cos(q),L[H+1]=n*Math.sin(q),L[H+2]=0,j[H]=V/B,j[H+1]=1,j[H+2]=0}H=3*B;for(V=0;V<B;V++,H+=3){q=V/B*2*Math.PI;L[H]=o*Math.cos(q),L[H+1]=o*Math.sin(q),L[H+2]=w,j[H]=V/B,j[H+1]=0,j[H+2]=0}if(d){q=0;for(var W=0;W<B;W++)q=W/B*2*Math.PI,L[H]=L[3*(B+W)],j[H++]=(Math.cos(q)+1)/2,L[H]=L[3*(B+W)+1],j[H++]=1-(Math.sin(q)+1)/2,L[H]=L[3*(B+W)+2],j[H++]=0}if(m)for(q=0,W=0;W<B;W++)q=W/B*2*Math.PI,L[H]=L[3*W],j[H++]=(Math.cos(q)+1)/2,L[H]=L[3*W+1],j[H++]=1-(Math.sin(q)+1)/2,L[H]=L[3*W+2],j[H++]=0;var X=new Float32Array(3*N);L=X;H=0;for(var K=0;K<2;K++)for(V=0;V<B;V++){q=V/B*2*Math.PI;(Y=new e.Vector3).x=F[3*V],Y.y=F[3*V+1],Y.z=F[3*V+2],Y.z=Math.sqrt(Y.x*Y.x+Y.y*Y.y)*E,Y.normalize(),L[H++]=Y.x,L[H++]=Y.y,L[H++]=Y.z}if(d)for(K=0;K<B;K++)L[H++]=0,L[H++]=0,L[H++]=1;if(m)for(K=0;K<B;K++)L[H++]=0,L[H++]=0,L[H++]=-1;for(W=0;W<M;W++){(Y=new e.Vector3).x=F[3*W],Y.y=F[3*W+1],Y.z=F[3*W+2],Y.applyMatrix4(A),F[3*W]=Y.x,F[3*W+1]=Y.y,F[3*W+2]=Y.z}for(W=0;W<N;W++){var Y;(Y=new e.Vector3).x=X[3*W],Y.y=X[3*W+1],Y.z=X[3*W+2],Y.applyMatrix4(P),X[3*W]=Y.x,X[3*W+1]=Y.y,X[3*W+2]=Y.z}var J,Z=new i.Mesh;Z.vertexPositionArray=F,Z.vertexNormalArray=X,Z.vertexUVArray=U,Z.vertexIndexArray=z,Z.gas=s,Z.matId=a,l?(s.setConnectivity(0),(J=h).setConnectivity(3)):J=s.line?s.line:s;var Q=6*B+(d?3*(B-2):0)+(m?3*(B-2):0),$=p?0:(d?2*B:0)+(m?2*B:0);let ee=0,te=[r[0]-t[0],r[1]-t[1],r[2]-t[2]];var ie=new i.DrawingGroup(s,a,4,0,Q,[],null,e.GeomTypeEnum.FACE);if(!p){var re=new i.DrawingGroup(J,a,1,Q,$,[],null,e.GeomTypeEnum.SHARP_EDGE);if(d||m){let e=new i.SGPrimitive({cgmId:ee++,group:re,start:Q,count:2*B});if(re._primitives.push(e),c){let i;i=d?y(r,te,o):y(t,te,n),e.decoration=c.addDecoration(i)}}if(d&&m){let e=new i.SGPrimitive({cgmId:ee++,group:re,start:Q+2*B,count:2*B});if(re._primitives.push(e),c){let i=y(t,te,n);e.decoration=c.addDecoration(i)}}Z.drawingGroups.push(re)}var ne=new i.SGPrimitive({cgmId:ee++,group:ie,start:0,count:6*B});if(ie._primitives.push(ne),c)if(o==n){let e=v(t,te,o);ne.decoration=c.addDecoration(e)}else{if(o>n){let e=t;t=r,r=e,e=n,n=o,o=e}let i=[t[0]-r[0],t[1]-r[1],t[2]-r[2]],s=new e.Vector3(i[0],i[1],i[2]).length(),a=s/(1-o/n);i[0]*=a/s,i[1]*=a/s,i[2]*=a/s;let u=[t[0]-i[0],t[1]-i[1],t[2]-i[2]],l=180*Math.atan(n/a)/Math.PI,h=f(u,i,l);ne.decoration=c.addDecoration(h)}return(d||m)&&(ne=new i.SGPrimitive({cgmId:ee++,group:ie,start:6*B,count:3*(B-2)}),ie._primitives.push(ne)),d&&m&&(ne=new i.SGPrimitive({cgmId:ee++,group:ie,start:6*B+3*(B-2),count:3*(B-2)}),ie._primitives.push(ne)),Z.drawingGroups.push(ie),i.computeBB(Z),Z},i._createCustomSphereMesh=function(t,r,n,o,s,a,u,l,c,h,p,d){var g=new e.Vector3(a[0],a[1],a[2]),v=new e.Vector3(u[0],u[1],u[2]),f=g.length();t<-Math.PI/2&&(t=-Math.PI/2),t>Math.PI/2&&(t=Math.PI/2),r<-Math.PI/2&&(r=-Math.PI/2),r>Math.PI/2&&(r=Math.PI/2);var y=r-t;y<0&&(y=0),n<0&&(n=0),n>2*Math.PI&&(n=2*Math.PI),o<0&&(o=0),o>2*Math.PI&&(o=2*Math.PI);var x=o-n;x<0&&(x=0);let b=this._getCurrentSag(h,f),I=this._computeMaxAngleStep(b,f),_=0,A=0,S=0,P=0;[_,S]=this._computeNbCirclePoints(x,I),[A,P]=this._computeNbCirclePoints(2*y,I),_+=1,A+=1;this._computeAngleStep(x,_-1),this._computeAngleStep(y,A-1);for(var w=3*(_+1)*A,T=6*_*(A-1),C=new Float32Array(w),G=new Float32Array(w),B=new Float32Array(w),E=new Uint16Array(T),O=C,M=G,N=B,z=g.normalize(),R=v.normalize(),D=(new e.Vector3).crossVectors(z,R),V=E,k=0,F=0;F<A-1;F++)for(K=0;K<_;K++)V[k++]=F*(_+1)+K,V[k++]=(F+1)*(_+1)+K+1,V[k++]=(F+1)*(_+1)+K,V[k++]=F*(_+1)+K,V[k++]=F*(_+1)+K+1,V[k++]=(F+1)*(_+1)+K+1;k=0;var U=1/(A-1),L=(new e.Vector3,new e.Vector3),j=new e.Vector3,H=new e.Vector3;for(F=0;F<A;F++)for(var q=F*U,W=Math.sin(t+q*y),X=Math.cos(t+q*y),K=0;K<=_;K++,k+=3){var Y=K/_,J=Math.sin(n+Y*x),Z=Math.cos(n+Y*x);L.copy(z),L.multiplyScalar(Z),j.copy(R),j.multiplyScalar(J),H.copy(D),H.multiplyScalar(W),L.add(j),L.multiplyScalar(X),L.add(H);var Q=L;M[k]=Q.x,O[k]=s[0]+Q.x*f,N[k]=Y,M[k+1]=Q.y,O[k+1]=s[1]+Q.y*f,N[k+1]=F/A,M[k+2]=Q.z,O[k+2]=s[2]+Q.z*f,N[k+2]=0}var $=new i.Mesh;$.vertexPositionArray=C,$.vertexNormalArray=G,$.vertexUVArray=B,$.vertexIndexArray=E,$.gas=l,$.matId=c,p&&l.setConnectivity(0);var ee=new i.DrawingGroup(l,c,4,0,T,[],null,e.GeomTypeEnum.FACE),te=new i.SGPrimitive({cgmId:0,group:ee,start:0,count:T});if(d){let e=m(s,f);te.decoration=d.addDecoration(e)}return ee._primitives.push(te),$.drawingGroups.push(ee),i.computeBB($),$},i._buildCurvedPipeDataFromTorus=function(t,i,r,n,o,s){var a=[],u=(new e.Vector3).copy(i),l=(new e.Vector3).copy(r);let c=u.length();s&&(c+=s);let h=this._getCurrentSag(o,c),p=this._computeMaxAngleStep(h,c),d=0;[d,p]=this._computeNbCirclePoints(n,p);for(var m=0,g=0;g<d+1;g++){var v=Math.cos(m),f=Math.sin(m);u.copy(i).multiplyScalar(v),l.copy(r).multiplyScalar(f),u.add(l).add(t),a.push(u.x),a.push(u.y),a.push(u.z),m+=p}if(i.normalize(),r.normalize(),n==2*Math.PI){a.push(a[0]),a.push(a[1]),a.push(a[2]);var y=[-r.x,-r.y,-r.z],x=[r.x,r.y,r.z]}else{y=[-r.x,-r.y,-r.z];u.crossVectors(i,r);var b=a.length;l.set(a[b-3],a[b-2],a[b-1]).sub(t).normalize(),u.cross(l).normalize();x=[u.x,u.y,u.z]}return{centers:a,startNormal:y,endNormal:x}},i._createTorusMesh=function(t,r,n,o,s,a,u,l,c){var h=new e.Vector3,p=new e.Vector3;h.subVectors(r[0],t);let d=h.length();p.crossVectors(h,o).normalize();let m=this._getCurrentSag(u,n[0]),v=this._computeMaxAngleStep(m,n[0]),f=0;[f,v]=this._computeNbCirclePoints(2*Math.PI,v);for(var y=3*r.length*f,x=6*f*(r.length-1),b=new Float32Array(y),I=new Float32Array(y),_=new Float32Array(y),A=new Uint16Array(x),S=b,P=I,w=_,T=A,C=new e.Vector3,G=new e.Vector3,B=new e.Vector3,E=new e.Vector3,O=0,M=0;M<r.length;M++){0==M||M==r.length-1?C.copy(o).negate():(B.subVectors(r[M],r[M-1]),C.subVectors(r[M+1],r[M]),C.add(B)),C.normalize(),G.crossVectors(C,p),G.normalize();for(var N=0,z=0;z<f;z++)B.copy(G).multiplyScalar(Math.cos(N)),E.copy(p).multiplyScalar(Math.sin(N)),B.add(E),P[O]=B.x,P[O+1]=B.y,P[O+2]=B.z,B.multiplyScalar(n[M]),B.add(r[M]),S[O]=B.x,S[O+1]=B.y,S[O+2]=B.z,w[O++]=z/f,w[O++]=M/r.length,w[O++]=0,N+=v}O=0;for(M=0;M<r.length-1;M++)for(z=0;z<f;z++){var R=(z+1)%f;T[O++]=M*f+z,T[O++]=(M+1)*f+z,T[O++]=(M+1)*f+R,T[O++]=M*f+z,T[O++]=(M+1)*f+R,T[O++]=M*f+R}var D=new i.Mesh;D.vertexPositionArray=b,D.vertexNormalArray=I,D.vertexUVArray=_,D.vertexIndexArray=A,D.gas=s,D.matId=a,l&&s.setConnectivity(0);var V=new i.DrawingGroup(s,a,4,0,x,[],null,e.GeomTypeEnum.FACE),k=new i.SGPrimitive({cgmId:0,group:V,start:0,count:6*f*(r.length-1)});if(V._primitives.push(k),c){let e=g(t,p,n[0],d);k.decoration=c.addDecoration(e)}return D.drawingGroups.push(V),i.computeBB(D),D},i._createCurvedPipeMesh=function(t,r,n,o,s,a,u,l,c,h,p,d,m){let v=r[0];for(let e=1;e<r.length;e++)r[e]>v&&(v=r[e]);let f=this._getCurrentSag(l,v),y=this._computeMaxAngleStep(f,v),x=0;[x,y]=this._computeNbCirclePoints(2*Math.PI,y);var b=3*t.length*x,I=6*x*(t.length-1),_=0;s&&(b+=6*x,I+=6*(x-2),_=m?0:4*x);var A=new Float32Array(b),S=new Float32Array(b),P=new Float32Array(b),w=new Uint16Array(I+_),T=A,C=S,G=P,B=w,E=new e.Vector3,O=new e.Vector3,M=new e.Vector3,N=new e.Vector3,z=new e.Vector3;if(t.length>=3)N.subVectors(t[1],t[0]),M.subVectors(t[2],t[1]),E.crossVectors(N,M).normalize(),N.copy(n).negate(),M.crossVectors(N,E);else{N.copy(n).negate();var R=Math.abs(N.x),D=Math.abs(N.y),V=Math.abs(N.z),k=.001;R>D?D>V?z.set(0,D+k,V+k):R>V?z.set(0,D+k,V+k):z.set(R+k,D+k,0):R>V?z.set(R+k,0,V+k):D>V?z.set(R+k,0,V+k):z.set(R+k,D+k,0),M.crossVectors(N,z)}for(var F=0,U=0;U<t.length;U++){M.normalize(),0==U?O.copy(n).negate():U==t.length-1?O.copy(o):(N.subVectors(t[U],t[U-1]),O.subVectors(t[U+1],t[U]),O.add(N)),O.normalize(),E.crossVectors(M,O),E.normalize(),U>0&&M.crossVectors(O,E);for(var L=0,j=0;j<x;j++)N.copy(M).multiplyScalar(Math.cos(L)),z.copy(E).multiplyScalar(Math.sin(L)),N.add(z),C[F]=N.x,C[F+1]=N.y,C[F+2]=N.z,N.multiplyScalar(r[U]),N.add(t[U]),T[F]=N.x,T[F+1]=N.y,T[F+2]=N.z,G[F++]=j/x,G[F++]=U/t.length,G[F++]=0,L+=y}if(s){for(j=0;j<x;j++)C[F]=n.x,C[F+1]=n.y,C[F+2]=n.z,T[F++]=T[3*j],T[F++]=T[3*j+1],T[F++]=T[3*j+2];var H=x*(t.length-1)*3;for(j=0;j<x;j++)C[F]=o.x,C[F+1]=o.y,C[F+2]=o.z,T[F++]=T[H+3*j],T[F++]=T[H+3*j+1],T[F++]=T[H+3*j+2]}F=0;for(U=0;U<t.length-1;U++)for(j=0;j<x;j++){var q=(j+1)%x;B[F++]=U*x+j,B[F++]=(U+1)*x+j,B[F++]=(U+1)*x+q,B[F++]=U*x+j,B[F++]=(U+1)*x+q,B[F++]=U*x+q}if(s){for(U=0;U<x-2;U++)B[F++]=t.length*x,B[F++]=t.length*x+U+1,B[F++]=t.length*x+U+2;for(U=0;U<x-2;U++)B[F++]=(t.length+1)*x,B[F++]=(t.length+1)*x+U+2,B[F++]=(t.length+1)*x+U+1;if(!m){for(U=0;U<x;U++)B[F++]=t.length*x+U,B[F++]=t.length*x+(U+1)%x;for(U=0;U<x;U++)B[F++]=(t.length+1)*x+U,B[F++]=(t.length+1)*x+(U+1)%x}}var W=new i.Mesh;W.vertexPositionArray=A,W.vertexNormalArray=S,W.vertexUVArray=P,W.vertexIndexArray=w,W.gas=a,W.matId=u,c&&a.setConnectivity(0);var X=new i.DrawingGroup(a,u,4,0,I,[],null,e.GeomTypeEnum.FACE);let K=0;var Y=new i.SGPrimitive({cgmId:K++,group:X,start:0,count:6*x*(t.length-1)});if(X._primitives.push(Y),h&&p){let t=new e.Vector3(p.center[0],p.center[1],p.center[2]),i=new e.Vector3(p.firstAxis[0],p.firstAxis[1],p.firstAxis[2]),n=i.length(),o=new e.Vector3(p.secondAxis[0],p.secondAxis[1],p.secondAxis[2]),s=(new e.Vector3).crossVectors(i.normalize(),o.normalize()),a=g(t,s,r[0],n);Y.decoration=h.addDecoration(a)}if(Y=new i.SGPrimitive({cgmId:K++,group:X,start:6*x*(t.length-1),count:3*(x-2)}),X._primitives.push(Y),Y=new i.SGPrimitive({cgmId:K++,group:X,start:6*x*(t.length-1)+3*(x-2),count:3*(x-2)}),X._primitives.push(Y),W.drawingGroups.push(X),_){var J;c?(J=d).setConnectivity(3):J=a.line?a.line:a;var Z=new i.DrawingGroup(J,u,1,I,_,[],null,e.GeomTypeEnum.SHARP_EDGE);Y=new i.SGPrimitive({cgmId:K++,group:Z,start:I,count:_/2}),Z._primitives.push(Y),Y=new i.SGPrimitive({cgmId:K++,group:Z,start:I+_/2,count:_/2}),Z._primitives.push(Y),W.drawingGroups.push(Z)}return i.computeBB(W),W},i._createCuboidMesh=function(t,r,n,o,s,a,u,l,c,h){var p=new i.Mesh;p.gas=s,p.matId=a;var d=new e.Vector3(t[0],t[1],t[2]),m=new e.Vector3(r[0],r[1],r[2]),g=new e.Vector3(n[0],n[1],n[2]),v=(new e.Vector3).crossVectors(m,g).normalize().multiplyScalar(o);p.vertexPositionArray=new Float32Array(72),p.vertexNormalArray=new Float32Array(72),p.vertexUVArray=new Float32Array(72);var f=p.vertexPositionArray,y=p.vertexNormalArray,x=p.vertexUVArray,b=new e.Vector3,I=new e.Vector3;I.copy(v).normalize();var _=new e.Vector3;_.copy(I).negate();var A=new e.Vector3;A.copy(g).normalize();var S=new e.Vector3;S.copy(A).negate();var P=new e.Vector3;P.copy(m).normalize();var w=new e.Vector3;w.copy(P).negate();var T=new e.Vector3(d.x,d.y,d.z),C=new e.Vector3(d.x,d.y,d.z),G=new e.Vector3(0,0,0),B=new e.Vector3(1,0,0),E=new e.Vector3(1,1,0),O=new e.Vector3(0,1,0);b.addVectors(d,v),T.min(b),C.max(b),f[9]=b.x,f[10]=b.y,f[11]=b.z,f[24]=b.x,f[25]=b.y,f[26]=b.z,f[48]=b.x,f[49]=b.y,f[50]=b.z,y[9]=I.x,y[10]=I.y,y[11]=I.z,y[24]=S.x,y[25]=S.y,y[26]=S.z,y[48]=w.x,y[49]=w.y,y[50]=w.z,x[9]=O.x,x[10]=O.y,x[11]=O.z,x[24]=G.x,x[25]=G.y,x[26]=G.z,x[48]=G.x,x[49]=G.y,x[50]=G.z,b.add(m),T.min(b),C.max(b),f[6]=b.x,f[7]=b.y,f[8]=b.z,f[27]=b.x,f[28]=b.y,f[29]=b.z,f[60]=b.x,f[61]=b.y,f[62]=b.z,y[6]=I.x,y[7]=I.y,y[8]=I.z,y[27]=S.x,y[28]=S.y,y[29]=S.z,y[60]=P.x,y[61]=P.y,y[62]=P.z,x[6]=E.x,x[7]=E.y,x[8]=E.z,x[27]=B.x,x[28]=B.y,x[29]=B.z,x[60]=G.x,x[61]=G.y,x[62]=G.z,b.add(g),T.min(b),C.max(b),f[3]=b.x,f[4]=b.y,f[5]=b.z,f[36]=b.x,f[37]=b.y,f[38]=b.z,f[63]=b.x,f[64]=b.y,f[65]=b.z,y[3]=I.x,y[4]=I.y,y[5]=I.z,y[36]=A.x,y[37]=A.y,y[38]=A.z,y[63]=P.x,y[64]=P.y,y[65]=P.z,x[3]=B.x,x[4]=B.y,x[5]=B.z,x[36]=G.x,x[37]=G.y,x[38]=G.z,x[63]=B.x,x[64]=B.y,x[65]=B.z,b.addVectors(d,v),b.add(g),T.min(b),C.max(b),f[0]=b.x,f[1]=b.y,f[2]=b.z,f[39]=b.x,f[40]=b.y,f[41]=b.z,f[57]=b.x,f[58]=b.y,f[59]=b.z,y[0]=I.x,y[1]=I.y,y[2]=I.z,y[39]=A.x,y[40]=A.y,y[41]=A.z,y[57]=w.x,y[58]=w.y,y[59]=w.z,x[0]=G.x,x[1]=G.y,x[2]=G.z,x[39]=B.x,x[40]=B.y,x[41]=B.z,x[57]=O.x,x[58]=O.y,x[59]=O.z,b.addVectors(d,g),T.min(b),C.max(b),f[21]=b.x,f[22]=b.y,f[23]=b.z,f[42]=b.x,f[43]=b.y,f[44]=b.z,f[54]=b.x,f[55]=b.y,f[56]=b.z,y[21]=_.x,y[22]=_.y,y[23]=_.z,y[42]=A.x,y[43]=A.y,y[44]=A.z,y[54]=w.x,y[55]=w.y,y[56]=w.z,x[21]=O.x,x[22]=O.y,x[23]=O.z,x[42]=E.x,x[43]=E.y,x[44]=E.z,x[54]=E.x,x[55]=E.y,x[56]=E.z,b.add(m),T.min(b),C.max(b),f[18]=b.x,f[19]=b.y,f[20]=b.z,f[45]=b.x,f[46]=b.y,f[47]=b.z,f[66]=b.x,f[67]=b.y,f[68]=b.z,y[18]=_.x,y[19]=_.y,y[20]=_.z,y[45]=A.x,y[46]=A.y,y[47]=A.z,y[66]=P.x,y[67]=P.y,y[68]=P.z,x[18]=E.x,x[19]=E.y,x[20]=E.z,x[45]=O.x,x[46]=O.y,x[47]=O.z,x[66]=E.x,x[67]=E.y,x[68]=E.z,b.addVectors(d,m),T.min(b),C.max(b),f[15]=b.x,f[16]=b.y,f[17]=b.z,f[30]=b.x,f[31]=b.y,f[32]=b.z,f[69]=b.x,f[70]=b.y,f[71]=b.z,y[15]=_.x,y[16]=_.y,y[17]=_.z,y[30]=S.x,y[31]=S.y,y[32]=S.z,y[69]=P.x,y[70]=P.y,y[71]=P.z,x[15]=B.x,x[16]=B.y,x[17]=B.z,x[30]=E.x,x[31]=E.y,x[32]=E.z,x[69]=O.x,x[70]=O.y,x[71]=O.z,f[12]=d.x,f[13]=d.y,f[14]=d.z,f[33]=d.x,f[34]=d.y,f[35]=d.z,f[51]=d.x,f[52]=d.y,f[53]=d.z,y[12]=_.x,y[13]=_.y,y[14]=_.z,y[33]=S.x,y[34]=S.y,y[35]=S.z,y[51]=w.x,y[52]=w.y,y[53]=w.z,x[12]=G.x,x[13]=G.y,x[14]=G.z,x[33]=O.x,x[34]=O.y,x[35]=O.z,x[51]=B.x,x[52]=B.y,x[53]=B.z,p.vertexIndexArray=new Uint16Array(60);for(var M=p.vertexIndexArray,N=0,z=0;z<6;z++)M[N++]=4*z,M[N++]=4*z+2,M[N++]=4*z+1,M[N++]=4*z,M[N++]=4*z+3,M[N++]=4*z+2;if(!h){for(z=0;z<2;z++)M[N++]=4*z,M[N++]=4*z+1,M[N++]=4*z+1,M[N++]=4*z+2,M[N++]=4*z+2,M[N++]=4*z+3,M[N++]=4*z+3,M[N++]=4*z;M[N++]=0,M[N++]=7,M[N++]=1,M[N++]=6,M[N++]=2,M[N++]=5,M[N++]=3,M[N++]=4}u&&s.setConnectivity(0);var R=new i.DrawingGroup(s,a,4,0,36,[],null,e.GeomTypeEnum.FACE);let D=0;for(z=0;z<6;z++){var V=new i.SGPrimitive({cgmId:D++,cgmId:z,group:R,start:6*z,count:6});R._primitives.push(V)}if(p.drawingGroups.push(R),!h){var k;u?(k=c).setConnectivity(3):k=s.line?s.line:s;var F=new i.DrawingGroup(k,a,1,36,24,[],null,e.GeomTypeEnum.SHARP_EDGE);for(z=0;z<12;z++){V=new i.SGPrimitive({cgmId:D++,cgmId:z,group:F,start:36+2*z,count:2});F._primitives.push(V)}p.drawingGroups.push(F)}var U=[T.x,T.y,T.z],L=[C.x,C.y,C.z];return p.AABB={min:U,max:L},p};let m=function(e,t){let i=[0,52,53];return I(i,e[0]),I(i,e[1]),I(i,e[2]),I(i,t),i[0]=i.length,i},g=function(e,t,i,r){let n=[0,52,56];return I(n,e.x),I(n,e.y),I(n,e.z),I(n,t.x),I(n,t.y),I(n,t.z),I(n,r),I(n,i),n[0]=n.length,n},v=function(e,t,i){let r=[0,52,51];return I(r,e[0]),I(r,e[1]),I(r,e[2]),I(r,t[0]),I(r,t[1]),I(r,t[2]),I(r,i),r[0]=r.length,r},f=function(e,t,i){let r=[0,52,52];return I(r,e[0]),I(r,e[1]),I(r,e[2]),I(r,t[0]),I(r,t[1]),I(r,t[2]),I(r,i),r[0]=r.length,r},y=function(e,t,i){let r=[0,52,55];return I(r,e[0]),I(r,e[1]),I(r,e[2]),I(r,t[0]),I(r,t[1]),I(r,t[2]),I(r,i),r[0]=r.length,r},x=new Uint8Array(8),b=new DataView(x.buffer,0,8),I=function(e,t){b.setFloat64(0,t),e.push(x[0]),e.push(x[1]),e.push(x[2]),e.push(x[3]),e.push(x[4]),e.push(x[5]),e.push(x[6]),e.push(x[7])},_=new Uint8Array(4);new DataView(_.buffer,0,4);return i}),define("Mesh/Mesh",["DS/Mesh/Mesh","DS/DSMigration/DSMigration"],function(e,t){return t.deprecateModule("Mesh/Mesh"),e});