define("DS/PLMNewLibraryActive/PLMNewLibraryActiveController",["DS/ClassificationsFacet/PLMNewCommomCmpUXController","DS/ClassificationsFacet/service/PLMNewCommonWebService","i18n!DS/LibraryActive/assets/nls/LibraryActive","DS/LibraryActive/service/LibraryTypeService","DS/IPClassifyUtil/IPClassifyUtility","DS/WidgetServices/WidgetServices","DS/LibraryActive/service/LibraryActiveWebService","DS/LibraryActive/LibraryActive","DS/IPClassifyUtil/service/IPClassifyUtilWebService","DS/Windows/ImmersiveFrame","DS/Controls/TooltipModel","i18n!DS/ClassificationsFacet/assets/nls/PLMNewCommCmpSel","DS/LibraryEditor/service/LibraryEditorWebService","DS/ClassificationProp/utils/ClassifPropControl","DS/IPClassifyUtil/IPClassifyAlert"],function(e,t,i,a,s,n,o,r,l,c,u,p,f,d,m){let g=!1;return e.extend({name:"PLMNewLibraryActive",_rootNodeFavorite:null,_rootNodeFolders:null,_rootNodeTrash:null,_requestInfo:{},_searchKeys:{},_pathInfo:{},_subBookmarkExpand:{},_favoriteSection:a.TYPE_FAVORITES_SECTION,_allSection:a.TYPE_LIBRARIES_SECTION,_supportedTypesForDropAtFindIn:["General Class"],_classPathMap:new Map,_attributeMap:new Map,_classUsageMap:new Map,_parentOptions:null,_parentInitMethod:null,_classNameMap:new Map,init:function(e){this.PLMNewCommonWebService=Object.assign({},t),this.PLMNewCommonWebService.getSearchQuery=function(){if(e.multiSelectionComponent&&e.multiSelectionComponent.rootLibraries){var t=e.multiSelectionComponent.rootLibraries;if(Array.isArray(t)&&t.length>0){var i="";return t.forEach(function(e){i=i?i+" OR "+e:e}),"physicalid: ("+i+') AND flattenedtaxonomies:"types/General Library"'}return'flattenedtaxonomies:"types/General Library"'}return'flattenedtaxonomies:("types/General Class")'},this.PLMNewCommonWebService.navigatePathRelArray=function(){return["Subclass"]},this.PLMNewCommonWebService.getType_filter_bo=function(){return["General Library","General Class"]},this.PLMNewCommonWebService.generateSearchQuery=function(e,t){return'(flattenedtaxonomies:("types/General Library" OR "types/General Class")) AND (label: *'+e+"*)"+(t?' AND NOT physicalid: "'+t+'"':"")},this.PLMNewCommonWebService.getLabel=function(e){return"IPClass-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime()},this.PLMNewCommonWebService.getRefineSearch=function(){var e=d.getSearchQueryFilter();return e?{"ds6w:what/ds6w:status":[{object:"Classification.Active",type:"string",field:"internal"}],"ds6w:what/ds6w:classificationUsage":[{object:e,type:"string",field:"internal"}]}:{"ds6w:what/ds6w:status":[{object:"Classification.Active",type:"string",field:"internal"}]}},this.PLMNewCommonWebService.getSpecific_source_parameter=function(e,t){return{"3dspace":{search_in_context:{expand:{root_physicalid:e,expand_iter:t?"-1":"1",type_filter_bo:["General Library","General Class"]}}}}},this._parent(e),this.plmNewContextProvider=e.securityContext,this.getAttributesForNLS().then(()=>{}).catch(()=>{}),this._parentOptions=e,this._parentInitMethod=this._parent},_getWebServiceRef:function(){return this.PLMNewCommonWebService},_getIcon:function(e){var t="Definition";if(!e)return{iconName:"library-class"};t=e.classUsage||e["ds6w:classificationUsage"];var i="";return"General Class"==e.type||"General Class"==e["ds6w:type"]||"General Class"==e.plmType?(i={iconName:"library-class"},"Definition"==t&&(i={iconName:"library-class-filled"})):"General Library"!=e.type&&"General Library"!=e["ds6w:type"]&&"General Library"!=e.plmType||(i={iconName:"library"},"Standard"==t&&(i={iconName:"library-lined"})),i},couldBeValid:function(e){e&&e.getID&&e.getID();if(e&&e.getType){if(e.getType())return"General Class"===e.getType();if("General Class"===e.plmType)return!0}return!1},_getComponentName:function(){return i.name_Section_AllLibraries},_autoCompleteName:function(){return i.name_Section_AllLibraries},_getAutocomplete:function(e){return this.autocompleteLibrary},couldBeSelected:function(e){return!!["General Class"].includes(e)},getAttributesForNLS:function(){var e=this;return e._attributesInfo={dimensions:[],integers:[],predicates:{},rangeAttributes:{}},new Promise(function(t,i){s.initURLSAsync().then(()=>{l.getDictionaryCusto1({tenant:n.getTenantID(),package:"ClassificationDefaultPack",lang:"en;de;fr;ja;ko;ru;zh",onComplete:function(i){var a;(i="string"==typeof i?JSON.parse(i):i).Response&&i.Response;i.Dictionary.Interfaces.ClassificationAttributes&&(a=i.Dictionary.Interfaces.ClassificationAttributes.Attributes);var s="DictionaryNLS_"+(widget.lang?widget.lang:widget.getValue("lang"));for(const t in a){var n=a[t];if("Yes"===n.HasRangeDefined){var o=n.AuthorizedValues,r=n.Name;e._attributesInfo.rangeAttributes[r]=[];for(const t in o){var l=o[t];let a="Range."+n.Name+"."+l;e._attributesInfo.rangeAttributes[r][l]=i[s][a]}}}t(e._attributesInfo)},onFailure:function(e){window.isReplayODT&&1==window.isReplayODT?t():(console.log("NLS webservice failed."),i("rejected"))}})})})},_autocompleteComponent:function(e){return this.autocompleteLibrary=this.createAutocompleteComponent(this._getComponentName(),[],e,this.browseAssociations.bind(this,!0,!0)),this.autocompleteLibrary},saveRespectiveAssociations:function(e,t,i){return new Promise(function(a,s){const n=[];n.push(new Promise(function(a,s){o.performMultiClassify({data:{Classifications:t,ItemsToClassify:[e]},plmNewContextProvider:i,onComplete:function(e){a(e)},onFailure:function(e,t){a("fail")}})})),Promise.all(n).then(function(e){a(e)}).catch(()=>{console.log("Issue with the Save Classification")})})},onClickSelector:function(){var e=this;let t=null;widget&&(widget.body&&(t=new c({identifier:"WebUIPanelDocumentation_IconsTitleWindows"}).inject(widget.body)),widget.addEvent("onLoad",function(e){g=!1})),g||(e.libraryActiveActionBar=new r({multiSelectionComponent:{withClassify:!0,launchDialog:!0,componentTitle:i.multiSelectionComponent.PLMNewLibraryWidgetName,OKButtonLabel:i.multiSelectionComponent.PLMNewbutton_OK,immersiveFrame:t},popOverDialogProperties:{width:250,height:350,minHeight:250,modalFlag:!0,minWidth:400,icon:"none"},dialogButtons:!0,selectionMode:"DefaultMulti",favoriteButton:!0,handleClassification:!0,isRootSelectable:!0,isClassifyMultiEveDispatch:!0,isonSetActiveEveDispatch:!1,container:widget.body,widgetName:i.multiSelectionComponent.PLMNewLibraryWidgetName,isClassificationsFacet:!0}),e.libraryActiveActionBar.addEvent("onClassifyMultiple",function(t){var i=t.nodeData,a=[];e.autoComplete.selectedItems&&e.autoComplete.selectedItems.length?e.autoComplete.selectedItems.forEach(e=>{a.push(e.id)}):a=[];var s=[];i.forEach(function(t){a.includes(t.getID())||s.push(t.getID()),t.updateOptions({label:t.options.label,subLabel:p.loading,icon:[t.options.icons]}),t._options&&t._options.classUsage&&(e._classUsageMap.set(t.getID(),t._options.classUsage),e.classifPropertiesUI.setClassUsage(e.getClassUsage())),g=!1}),s.length&&e.PLMNewCommonWebService.getClassPaths({id:s,plmNewContextProvider:e.plmNewContextProvider,onComplete:function(t){const a=e.PLMNewCommonWebService.constructPath(t,"idPathMap");console.log(a),i.forEach(t=>{if(a.has(t.id)){t.updateOptions({tooltip:new u({title:t.options.label,shortHelp:a.get(t.id),mouseRelativePosition:!0}),value:{subLabel:a.get(t.id)}}),e._classPathMap.set(t.id,a.get(t.id)),e._classNameMap.set(t.id,t.options.label),e.classifPropertiesUI.setClassPath(e.getClassPath()),e.autoComplete._model.prepareUpdate(),e.insertInAutocomplete(e._getAutocomplete(),t),e.autoComplete._model.pushUpdate();var i=e.autoComplete._model.getChildren().length;e.autoComplete._model.getNthRoot(i-1).select()}})},onFailure:function(e){console.error(e)}}),t.handleUI()}),e.libraryActiveActionBar.nestedMenuInContext.addEvent("onSelectorCancel",function(e){g=!1}),g=!0)},getAdditionalNodesAtInit:async function(e,t,i){let a=this;return t&&new Promise((e,s)=>{f.fetchExistingClassesAndAttributes({objectId:i,onComplete:function(i){if(i){let s=JSON.parse(i),n=[];s.length>0&&(s.forEach((e,t)=>{n.push(e.id),a._classNameMap.set(e.id,e.label)}),a.PLMNewCommonWebService.getClassPaths({id:n,plmNewContextProvider:a.plmNewContextProvider,onComplete:function(i){const n=a.PLMNewCommonWebService.constructPath(i,"idPathMap");let o=[];s.forEach(e=>{let t={...e};t.icons=[{iconName:a._getIcon(t).iconName,fontIconFamily:1}],t.plmType=e.type,t.id=e.id,a._attributeMap.set(e.id,{attribute:e.attribute,isExisting:!0}),a._classUsageMap.set(e.id,e.classUsage),o.push(t)}),a._classPathMap=n,"function"==typeof a.getAttribute&&(a.classifPropertiesUI.setClassPath(a.getClassPath()),a.classifPropertiesUI.setExistingClassAttributes(a.getAttribute()),a.classifPropertiesUI.setClassUsage(a.getClassUsage()),a.classifPropertiesUI.setIsInformationPanel(t)),e(o)},onFailure:function(e){console.log("================",e)}}))}},onFailure:function(e){console.log("================",e)}})})},getAttributesandClassPathsForExistingClasses:function(){return{_attributeMap:this._attributeMap,_classPathMap:this._classPathMap}},setClassPathForSearchData:function(e){console.log("data===",e),e.results.forEach(e=>{const t=e.attributes.find(e=>"physicalid"===e.name),i=e.attributes.find(e=>"ds6w:classificationUsage"===e.name||"ds6w:what/ds6w:classificationUsage"===e.name);i&&this._classUsageMap.set(t.value,i.value)})},removeContents:function(e){let t=this;e.classId.forEach(i=>{t._attributeMap.delete(i),t._classUsageMap.delete(i),t._classPathMap.delete(i);var a=t._classNameMap.get(i);f.removecontent({pid:i,IDs:e.IDs,onComplete:function(e){JSON.parse(e).failedCount?(m.displayNotification({title:p.replace(p.declassificationFailureMesaageTitle,{classname:a}),subtitle:p.declassificationFailureMesaageSubTitle,className:"error"}),t._isProcessing=!1,t._parentInitMethod({...t._parentOptions,isRefreshContainer:!0})):m.displayNotification({message:p.replace(p.declassificationSuccessMesaage,{number:1,classname:a}),className:"success"})},onFailure:function(e){m.displayNotification({title:p.replace(p.declassificationFailureMesaageTitle,{classname:a}),subtitle:p.declassificationFailureMesaageSubTitle,className:"error"}),t._isProcessing=!1,t._parentInitMethod({...t._parentOptions,isRefreshContainer:!0})}})})},setClassUsageForSearchData:function(e){this._classPathMap=e},addContents:function(e){let t=this;e.classId.forEach(i=>{new Promise(function(a,s){var n=t._classNameMap.get(i);f.addcontent({pid:i,IDs:e.IDs,onComplete:function(e){JSON.parse(e).failedCount?(m.displayNotification({title:p.classificationFailureMesaageTitle,subtitle:p.replace(p.classificationFailureMesaageSubTitle,{classname:n}),className:"error"}),t._isProcessing=!1,t._parentInitMethod({...t._parentOptions,isRefreshContainer:!0})):(m.displayNotification({message:p.replace(p.classificationSuccessMesaage,{number:1,classname:n}),className:"success"}),f.getClassificationAttributesForClassifedObjectOnOneClass({data:{classId:i,objId:d.getObjectId()},onComplete:function(e){a(JSON.parse(e))},onFailure:function(e){t._isProcessing=!1,t._parentInitMethod({...t._parentOptions,isRefreshContainer:!0}),s(e)}}))},onFailure:function(e){m.displayNotification({title:p.classificationFailureMesaageTitle,subtitle:p.replace(p.classificationFailureMesaageSubTitle,{classname:n}),className:"error"}),t._isProcessing=!1,t._parentInitMethod({...t._parentOptions,isRefreshContainer:!0}),s(e)}})}).then(function(e){e&&d.getClassifPropController()&&d.getClassifPropController().onAttributesLoad(e[0])},function(e){console.log("error while classifying"+e)})})},getClassUsage:function(){return this._classUsageMap},getClassPath:function(){return this._classPathMap},getAttribute:function(){return this._attributeMap},updateAttribute:function(e){return f.updateAttributesFromInformationPanel(e)},getClassificationAttributesForAClass:function(e){return f.getClassificationAttributesForClassifedObjectOnOneClass({data:e.payload,onComplete:function(e){return e},onFailure:function(e){console.log(e)}})},setClassNameForSearchData:function(e){e.results.forEach(e=>{const t=e.attributes.find(e=>"physicalid"===e.name),i=e.attributes.find(e=>"ds6w:label"===e.name);i&&this._classNameMap.set(t.value,i.value)})}})});