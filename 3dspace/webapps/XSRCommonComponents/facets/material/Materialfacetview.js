define("DS/XSRCommonComponents/facets/material/Materialfacetview",["DS/XSRCommonComponents/createform/view/NewForm","DS/XSRCommonComponents/utils/XInfraRequestUtil","DS/XSRCommonComponents/utils/IndexServiceProvider","DS/XSRCommonComponents/utils/XSRSearch","i18n!DS/XSRCommonComponents/assets/nls/XSRCommonComponents"],function(e,t,a,s,l){"use strict";const r={formName:"materialsfacet",formStyle:"horizontal",showWorkUnderIndicator:!1,formFields:[{tabName:"materials",fields:[{name:"Material",mandatory:!1,label:"label_Material",placeholder:"placeholder_Material",disabled:!1,type:"searchselect",clearIcon:!0}]}]};return class{constructor(e){this.selectedType=e,this.searchKeyMappings={coreMaterials:{resourceid:"physicalid","ds6w:what/ds6w:status":"CURRENT","ds6w:label":"LABEL","ds6w:identifier":"name","ds6w:what/ds6w:type":"type","ds6w:who/ds6w:responsible":"owner"}}}build(){var t=this;this.newForm=new e(r).render(),this.newForm.listenTo(this.newForm,"EVENT_SEARCH_GLOBAL",e=>t.evt_SearchGlobal(e)),this.formFields=this.newForm.formfieldControls,this.container=this.newForm.container,this.loadMaterials()}loadMaterials(){var e=this;e.setKeyMappings(e.searchKeyMappings),(new a).searchGlobal(["id","ds6w:originator","ds6w:identifier","ds6w:label","ds6w:created","ds6w:policy","ds6w:type"],{key:"query",value:'(flattenedtaxonomies:"types/dsc_matref_ref_Core")'},null).then(function(t){var a;if((a="string"==typeof t?JSON.parse(t):t)&&a.infos.nresults>0){var s=a.results;t=[],Object.keys(s).forEach(function(e){let a=s[e].attributes;var l={};Object.keys(a).forEach(function(e){"resourceid"===a[e].name&&(l.valueItem=a[e].value),"ds6w:label"===a[e].name&&(l.labelItem=a[e].value)}),t[e]=l}),e.newForm.updateField(t,"Material",!1)}else e.newForm.updateField(null,"Material",!1)}).catch(function(t){e.newForm.updateField(null,"Material",!1),Mask.unmaskLoader(e.container),Notification.clearNotifications()})}setKeyMappings(e){this._keyMappings=e}evt_SearchGlobal(e){var t=this;let a,l=t.formFields[e].inputfield[0];a=l.selectedItems?l.selectedItems._options.label:l.value;let r=t.getAllowedTypesToSearch();var o;new s(o={allowedTypes:r,role:"",subType:"",multiSel:!1,criteria:a,precondition:"",in_apps_callback:function(a){t.newForm.setValueInAutocomplete(a[0]["ds6w:label"],a[0].id,e),t.newForm.checkDirtyFields.call(t)},excludeList:[]}).launchSearch(o)}getAllowedTypesToSearch(){return["dsc_matref_ref_Core"]}getSelectedCoreMaterial(){return this.formFields.Material.inputfield[0].value}}});