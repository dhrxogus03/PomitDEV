define("DS/XSRCommonComponents/utils/XInfraRequestUtil",["UWA/Class/Model","UWA/Promise","DS/XSRCommonComponents/utils/RequestUtil","DS/XSRCommonComponents/utils/TypeUtils","DS/XSRCommonComponents/utils/TypeServicesUtil","DS/XSRCommonComponents/utils/Constants"],function(e,t,n,s,i,o){"use strict";return e.extend({setup:function(e){this.id=e.id,this.securityContext=e.securityContext,this.xInfraAppVersion="v1",this.corpus="dsspec"},urlForInvoke:function(){return"resources/"+this.xInfraAppVersion+"/modeler/"+this.corpus+"/"+this.uriType+"/"+this.corpus+":"+this.id},urlForClasses:function(){return"resources/"+this.xInfraAppVersion+"/modeler/"+this.corpus+"/"+this.corpus+":"+this.id},urlForGet:function(e){var t=s.getKeyMapping(e);return"resources/"+this.xInfraAppVersion+"/modeler/"+this.corpus+"/"+this.corpus+":"+t+"/"+this.id},urlForGetSubTypes:function(e){if(this.id="getRawMaterialSubTypes")return o.RM_BASE_URL+"Raw_Material/getRawMaterialSubTypes";var t=s.getKeyMapping(e);return"resources/"+this.xInfraAppVersion+"/modeler/"+this.corpus+"/"+this.corpus+":"+t+"/"+this.id},urlForUpdate:function(e){var t=s.getKeyMapping(e);return"resources/"+this.xInfraAppVersion+"/modeler/"+this.corpus+"/"+this.corpus+":"+t+"/"+this.id},invoke:function(e){var s;this.uriType="invoke",s=e&&e.data?JSON.stringify(e.data):'{"dummy" : "dummy"}';var i=e&&e.mask?this.urlForInvoke()+"?$mask="+this.corpus+":"+e.mask:this.urlForInvoke();return new t(function(e,t){n.send3DSpaceRequest(i,"POST",{type:"json",headers:{"Content-type":"application/json"},data:s},function(t){var n=t;t&&"string"==typeof t&&(n=JSON.parse(t),e(n)),e(n)},t)})},create:function(e){this.uriType="classes";var s=e&&e.data?JSON.stringify(e.data):"",i=e&&e.mask?this.urlForClasses()+"?$mask="+this.corpus+":"+e.mask:this.urlForClasses(),o={"Content-type":"application/json"};return this.securityContext&&(o.SecurityContext=this.securityContext),new t(function(e,t){n.send3DSpaceRequest(i,"POST",{type:"json",headers:o,data:s},function(t){var n=t;t&&"string"==typeof t&&(n=JSON.parse(t),e(n)),e(n)},t)})},get:function(e){this.uriType="resources";e&&e.typeName&&e.typeName;return this.keyMappingForGetUpdate(e).then(s=>{var i=e&&e.mask?s+"?$mask="+this.corpus+":"+e.mask:s;return new t(function(e,t){n.send3DSpaceRequest(i,"GET",{type:"json",headers:{"Content-type":"application/json"}},e,t)})})},getSubtypes:function(e){var s=e&&e.typeName?e.typeName:"",i=this.urlForGetSubTypes(s);return new t(function(e,t){n.send3DSpaceRequest(i,"GET",{type:"json",headers:{"Content-type":"application/json"}},e,t)})},getAllSubtypes:function(e){var s={};return s.prdType=e,new t(function(e,t){n.send3DSpaceRequest(o.TYPES_BASE_URL+"dsspec:getSubTypes","POST",{type:"json",headers:{"Content-type":"application/json"},data:JSON.stringify(s)},e,t)})},getInstanceTypeData:function(e){return new t(function(t,s){n.send3DSpaceRequest(o.TYPES_BASE_URL+"dsspec:getInstanceAttributes","POST",{type:"json",headers:{"Content-type":"application/json"},data:JSON.stringify(e)},t,s)})},saveBOMConfiguration:function(e,s){return new t(function(t,i){e[0].columnsVisibleFlag.tab=s,n.send3DSpaceRequest(o.ADMIN_BASE_URL+"Config/bom-configuration/","POST",{type:"json",headers:{"Content-type":"application/json"},data:e[0].columnsVisibleFlag?JSON.stringify(e[0].columnsVisibleFlag):""},t,i)})},getBOMConfiguration:function(e){return new t(function(t,s){n.send3DSpaceRequest(o.ADMIN_BASE_URL+"Config/bom-configuration?tab="+e,"GET",{type:"json",headers:{"Content-type":"application/json"}},t,s)})},getAttributes:function(){let e=(new Date).getTime();return new t(function(t,s){n.send3DSpaceRequest(o.ATTRIBUTES_BASE_URL+"displayAttributes=true&tenant="+n.getPlatformId()+"&_="+e+"xrequestedwith=xmlhttprequest","GET",{type:"json",headers:{"Content-type":"application/json"}},t,s)})},getDetails:function(e){let s=(new Date).getTime();return new t(function(t,i){n.send3DSpaceRequest(o.GET_UPDATE_DETAILS_URL+"read?tenant="+n.getPlatformId()+"&_="+s+"xrequestedwith=xmlhttprequest","POST",{type:"json",headers:{"Content-type":"application/json"},data:JSON.stringify(e)},t,i)})},getNLS:function(e){return new t(function(t,s){n.send3DSpaceRequest(o.NLS_URL+"?tenant="+n.getPlatformId()+"&xrequestedwith=xmlhttprequest","POST",{type:"json",headers:{"Content-type":"application/json"},data:e},t,s)})},getAdminSavedConfiguration:function(e){var s="Raw_Material"==e?"RawMaterial":"ProductSpecification",i=o.ADMIN_BASE_URL+"Config/AdminConfiguration/"+s;return new t(function(e,t){n.send3DSpaceRequest(i,"GET",{type:"json",headers:{"Content-type":"application/json"}},e,t)})},update:function(e){this.uriType="resources";var s=e&&e.data?JSON.stringify(e.data):"",i=e&&e.typeActualName?e.typeActualName:e.typeName,o=e&&e.mask?this.urlForUpdate(i)+"?$mask="+this.corpus+":"+e.mask:this.urlForUpdate(i);return new t(function(e,t){n.send3DSpaceRequest(o,"PATCH",{type:"json",headers:{"Content-type":"application/json"},data:s},e,t)})},keyMappingForGetUpdate:function(e){var n=this;return new t((t,o)=>{var r=s.getKeyMapping(e.typeActual||e.typeName),a="resources/"+n.xInfraAppVersion+"/modeler/"+n.corpus+"/"+n.corpus+":"+r+"/"+n.id;"notfound"==r?(console.log(e.typeActual),(new i).isValidItemToOpen(e.typeActual||e.typeName).then(i=>{if(i.isValidType){var o={objectType:e.typeActual,displayType:e.typeName};i.isRawM?s.addToRawMaterial([o]):s.addToPhysicalProduct([o]),a="resources/"+n.xInfraAppVersion+"/modeler/"+n.corpus+"/"+n.corpus+":PhysicalProduct/"+n.id,t(a)}})):t(a)})}})});