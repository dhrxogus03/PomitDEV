define("DS/XSRCommonComponents/service/CommandsService",["UWA/Class","UWA/Class/Promise","DS/ApplicationFrame/CommandsManager","DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/alternate/services/XSpecsAlternateCtxManager","DS/XSRCommonComponents/utils/Notification","text!DS/XSRCommonComponents/assets/config/Commands.json","DS/XSRCommonComponents/utils/ContextManager","i18n!DS/XSRCommonComponents/assets/nls/XSRCommonComponents"],function(e,t,a,n,o,i,m,d,c){"use strict";return e.singleton({init:function(e){this._commandConfig=JSON.parse(m)},initialize:function(e){var t=this;t.modelEvents=e.modelEvents,t.modelEvents.subscribe({event:n.EVENT_LAUNCH_COMMAND},function(e){t._commandsListener(e)}),t._loadAllCommands(e),widget&&void 0!==widget.data&&widget.data.appId===n.XSR_APP_ID&&(widget.appMediator=t.modelEvents)},_commandsListener:function(e){var t=this,o=["UPSAuthUnparent","UPSAuthReorderProduct","UPSAuthReplaceByRevision","UPSReplaceByLatestRevision"];if(!e.commandId)throw new Error("commandId is a mandatory parameter");if(!t._commandConfig[e.commandId])throw new Error("command doesn't existing");var i=t._commandConfig[e.commandId];t.commandLoaderStatus.then(function(m){var d;UWA.is(m,"array")&&m.length>0&&m.forEach(function(e){e&&e.value&&e.value._id===i.commandHdr&&(d=e.value._ctx)});var c=t.prepareCmdInput(e.context,e.commandId);e.commandId!==n.SUBSCRIBE_CMD&&e.commandId!==n.UNSUBSCRIBE_CMD&&e.commandId!==n.EDIT_SUBSCRIBE_CMD&&e.commandId!==n.MY_SUBSCRIPTIONS_CMD||(c._selectedItems[0].options.type=c._selectedItems[0].getTypeActualName()),e.commandId===n.INFORMATION_CMD&&(e.context.item&&e.context.item.cmdLaunchAt&&(c.cmdLaunchAt=e.context.item.cmdLaunchAt),c.commandId=e.commandId);var r=a.getCommand(i.commandHdr,d),s=function(){o.includes(e.commandId)?r.begin(c):r.execute(c)};t.modelEvents&&t.modelEvents.getEventByName(n.EVENT_SPEC_OTHER_ACTION_CLICK_SLIDEIN_OPEN)?t.modelEvents.publish({event:n.EVENT_SPEC_OTHER_ACTION_CLICK_SLIDEIN_OPEN,data:{callBackFunc:s,cmdId:e.commandId,selNodes:c._selectedItems}}):s()}).catch(function(e){console.log(e)})},_loadAllCommands:function(e){var a=this,n=[];for(var o in a._commandConfig)if(a._commandConfig.hasOwnProperty(o)){var i=a._commandConfig[o],m=new t(function(t,n){a.loadCommand(i,e,t,n)});n.push(m)}return a.commandLoaderStatus=t.allSettled(n),a.commandLoaderStatus},loadCommand:function(e,t,a,n){if(!e||!e.commandHdr||!e.AmdLoader)return console.error("Oups ! no valid command description"),void n("Oups ! no valid command description");var o=this;return require([e.AmdLoader,t],function(n){var i={context:t.appContext?t.appContext.contextManager:d.getContext(),ID:e.commandHdr,modelEvents:o.modelEvents};n&&a(new n(i))},function(e){n(e)})},_getObjectAdditionnalData:function(e){return{type:e.getTypeActualName(),name:e.getTitle(),displayName:e.getTitle(),revision:e.getRevision(),physicalid:e.getID()}},prepareCmdInput:function(e,t){var a={},i=[];if(e.item){var m=[],c=e.item.data||e.item;if(c)if(Array.isArray(c))for(var r=0;r<c.length;r++)i.push(this._getObjectAdditionnalData(c[r])),m.push(c[r]);else c=[e.item.data||e.item],m.push(e.item.data||e.item);var s=m.length>1;if(e.item.nodeModels){let t=e.item.nodeModels;d.setGridChildNodes(t)}d.addSelection(m);let p=e.item.selectFacet?e.item.selectFacet:void 0;if(a={_selectedItems:c},t)switch(t){case n.ENGINEERING_ITEM_REVISE:case n.DUPLICATE_CMD:case n.CHANGE_OWNER_CMD:case n.MULTI_OWNERSHIP_CMD:a.type=c[0].getTypeActualName(),a.typeDisplayName=c[0].getType(),a.name=c[0].getTitle(),a.displayName=c[0].getTitle(),a.revision=c[0].getRevision(),a.physicalid=c[0].getID();break;case n.MATURITY_GRAPH_CMD:s?(a=i)._selectedItems=c:(a.physicalid=c[0].getID(),a.type=c[0].getTypeActualName?c[0].getTypeActualName():c[0].getType(),a.typeDisplayName=c[0].getType(),a.name=c[0].getTitle?c[0].getTitle():c[0].getLabel(),a.displayName=c[0].getTitle?c[0].getTitle():c[0].getLabel(),a.revision=c[0].getRevision?c[0].getRevision():c[0].getReferenceVersion());break;case n.INFORMATION_CMD:if(a.physicalid=c[0].getID(),a.propWidth=e.item.propWidth,a.selectFacet=p,c[0].appCore){c[0].appCore.contextManager=o.getContext();let e=null;(e=c[0].getParent()&&c[0].getParent().getID?c[0].getParent():c[0].appCore.specRouteManager.getActiveSpecItem())?c[0].appCore.contextManager.setActiveEngItem(e):c[0].appCore.contextManager.setActiveEngItem(c[0]),c[0].appCore.contextManager.setSelectedNodes([c[0]])}break;case n.FILTER_CMD:a.commandId=t,a.appCore=e.item.appCore;break;case n.SUBSCRIBE_CMD:case n.UNSUBSCRIBE_CMD:case n.EDIT_SUBSCRIBE_CMD:case n.MY_SUBSCRIPTIONS_CMD:a.type=c[0].getTypeActualName();break;case n.OPEN_ALTERNATES:if(a.physicalid=c[0].getID(),c[0].appCore){c[0].appCore.orgContextManager=c[0].appCore.contextManager,c[0].appCore.contextManager=o.getContext();let e=null;void 0===c[0].appCore.specRouteManager?e=c[0].parentNode:null==(e=c[0].appCore.specRouteManager.getActiveSpecItem())&&(e=c[0].parentNode),c[0].appCore.contextManager.setActiveEngItem(e),c[0].appCore.contextManager.setSelectedNodes([c[0]])}a.commandId=n.OPEN_ALTERNATES;break;case n.OPEN_INFO_WIDGET:if(a.physicalid=c[0].getID(),c[0].appCore){c[0].appCore.orgContextManager=c[0].appCore.contextManager,c[0].appCore.contextManager=o.getContext();let e=null;void 0===c[0].appCore.specRouteManager?e=c[0].parentNode:null==(e=c[0].appCore.specRouteManager.getActiveSpecItem())&&(e=c[0].parentNode),c[0].appCore.contextManager.setActiveEngItem(e),c[0].appCore.contextManager.setSelectedNodes([c[0]])}a.commandId=n.OPEN_INFO_WIDGET;break;default:a.physicalid=c?c[0].getID():e.item.physicalid}return a}}})});