define("DS/XSRCommonComponents/service/XSpecsMenuBuilder",["UWA/Core","UWA/Class","UWA/Promise","DS/Menu/Menu","DS/XSRCommonComponents/utils/Utils","DS/XSRCommonComponents/utils/TypeUtils","DS/XSRCommonComponents/service/XSpecsActionsFactory","DS/XSRCommonComponents/utils/XSpecLocalStorage","DS/XSRCommonComponents/utils/RequestUtil","DS/XSRCommonComponents/utils/Constants","text!DS/XSRCommonComponents/assets/config/subscribeActions.json","text!DS/XSRCommonComponents/assets/config/replaceByActions.json","i18n!DS/XSRCommonComponents/assets/nls/XSRCommonComponents"],function(e,t,n,a,i,o,s,r,u,c,l,d,f){"use strict";return t.singleton({init:function(e){this._parent(e)},initialize:function(e){s.setOptions(e)},isTypeOf:function(e){},_nodeMenuBuilder:function(e,t,a){var i=this;return new n(function(n,o){n(i._buildMenu(e,t,a))})},_drawMenu:function(e,t,n,a,u,h,p,m,A,M,y,_,g){if(u.subCommand){var I=s.getActionMetaData(u.subCommand),S=h>1?"":u.access&&this.checkAccess(u.access)?"":"disabled";I&&(I.applicableAt.indexOf(atPlace)>=0||I.applicableAt.indexOf("all")>=0)?n.push(this._buildMenuEntry(s.getActionMetaData(a),"PushItem",e,S,a)):t.push(this._buildMenuEntry(s.getActionMetaData(a),"PushItem",e,S,a))}else{var b=h>1?"":u.access&&this.checkAccess(u.access)?"":"disabled";if("CompareWith"===a)h<=2&&t.push(this._buildMenuEntry(s.getActionMetaData(a),"PushItem",e,b,a));else if("DownloadReport"===a)b=""===b?g?"":"disabled":b,t.push(this._buildMenuEntry(s.getActionMetaData(a),"PushItem",e,b,a));else if("OpenWith"===a){var P=i._getSupportedAppsList();P&&P.length>0&&t.push(this._buildMenuGroup(s.getActionMetaData(a),"PushItem",P,e)),t.push({type:"SeparatorItem"})}else if("Subscriptions"===a){var E=[],O=JSON.parse(l).actions;O.forEach(function(t){var n=t.nls_key;E.push({type:"PushItem",title:f[n],fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+t.fonticon,family:WUXManagedFontIcons.Font3DS},action:{this:this,callback:function(n){s.fireAction(t,e)}}})}),O&&O.length>0&&t.push(this._buildMenuGroup(s.getActionMetaData(a),"PushItem",E,e))}else if("UPSAuthReplaceByRevision"!==a||M)if("VersionExplorer"===a||"ActionBar_ChangeOwner"===a||"DeleteItem"===a){if(t.push({type:"SeparatorItem"}),!(e.data instanceof Array)&&o.isPerformanceSpecChar(e.data.getTypeActualName())){let t=o.isPerformanceSpecification(e.data.getTypeActualName())?e.data:e.data.getParent();if("VersionExplorer"===a){b=t.isReleased&&t.isReleased()||t.isObsolete&&t.isObsolete()?"":"disabled"}else"DeleteItem"===a&&(b=t.getParentMaturityState()===c.MATURITY_IN_WORK&&t.isInWork&&t.isInWork()?"":"disabled")}t.push(this._buildMenuEntry(s.getActionMetaData(a),"PushItem",e,b,a))}else"MultiOwnership"===a?(t.push(this._buildMenuEntry(s.getActionMetaData(a),"PushItem",e,b,a)),t.push({type:"SeparatorItem"})):"UPSAuthPaste"===a?(r&&void 0!==r.xSpecData&&!r.xSpecData.hasOwnProperty("clipboard")&&(b="disabled"),t.push(this._buildMenuEntry(s.getActionMetaData(a),"PushItem",e,b,a))):("addPerformanceCharacteristics"===a&&(b=e.data.isInWork()?"":"disabled"),t.push(this._buildMenuEntry(s.getActionMetaData(a),"PushItem",e,b,a)));else{var C=[],R=JSON.parse(d).actions;R.forEach(function(t){var n=t.nls_key;C.push({type:"PushItem",title:f[n],fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+t.fonticon,family:WUXManagedFontIcons.Font3DS},action:{this:this,callback:function(n){s.fireAction(t,e)}}})}),R&&R.length>0&&t.push(this._buildMenuGroup(s.getActionMetaData(a),"PushItem",C,e))}}n.length>0&&menuNotPushed&&(t.push(this._buildMenuGroup(s.getActionMetaData(u.subCommand),"PushItem",n,e)),menuNotPushed=!1)},_buildMenu:function(e,t,n){var a=this;!e.data||void 0!==e.data.length&&1!==e.data.length||i._setSupportedAppsList(e.data);var o=function(e,o){var s,r=!1;if(Array.isArray(e.data))s=e.data.length,r=1!=s||!!e.data[0].isReportCheckedIn&&e.data[0].isReportCheckedIn();else{if(s=1,!e.data.getID)return;a.currentAccess=e.data.getCurrentAccess(),r=!!e.data.isReportCheckedIn&&e.data.isReportCheckedIn()}var u=[],l=[];return Object.keys(o).forEach(function(d){var f=d,h=o[d],p=h.applicableType;let m=h.excludeType;var A=h.applicableAt,M=a.isApplicableType(e.data,p);if(!a.isExcludeType(e.data,m)&&M&&A&&(A.indexOf(t)>=0||A.indexOf("all")>=0)){var y=!!(n&&n.length>0&&n.indexOf(f)>=0),_=h.isVisibleForMEI,g=i.isMEIItem(e.data);if(e.data.length&&e.data.length>1&&g){if("SetPartNumber"===f||"DownloadReport"===f||"OpenSpecificationView"===f||"UPSAuthReorderProduct"===f)return;a._drawMenu(e,u,l,f,h,s,p,A,M,y,_,g,r)}else if(e.data.length&&1===e.data.length){var I=i.isMEIItem(e.data[0]);y||"undefined"===e.data[0].currentTabKey||e.data[0].currentTabKey===c.MEI_TAB||I?I&&_&&(g||e.data[0].currentTabKey===c.MEI_TAB)&&A&&(A.indexOf(t)>=0||A.indexOf("all")>=0)&&a._drawMenu(e,u,l,f,h,s,p,A,M,y,_,I,r):a._drawMenu(e,u,l,f,h,s,p,A,M,y,_,I,r)}else if(y||"undefined"===e.data.currentTabKey||e.data.currentTabKey===c.MEI_TAB||g)g&&_&&(e.data.currentTabKey===c.MEI_TAB||g)&&A&&(A.indexOf(t)>=0||A.indexOf("all")>=0)&&a._drawMenu(e,u,l,f,h,s,p,A,M,y,_,g,r);else{if("UPSAuthReplaceByRevision"==f){let t;for(t=0;t<e.data.length;t++)if(e.data[t].options.grid.madeFromRelationId)return}a._drawMenu(e,u,l,f,h,s,p,A,M,y,_,g,r)}}}),u};return Array.isArray(e.data)&&e.data.length>1?o(e,s.getMultiSelActions()):o(e,s.getAllActions())},isApplicableType:function(e,t){var n=!1,a=function(e){return o.isPhysicalProduct(e)?-1!==t.indexOf("PhysicalProduct")||-1!==t.indexOf("all"):!(!i.isDocument(e)||-1===t.indexOf("Documents")&&-1===t.indexOf("all"))||(!(!o.isTechnicalSpecification(e)||-1===t.indexOf("TechnicalSpecs")&&-1===t.indexOf("all"))||(!(!i.isCoreMaterial(e)||-1===t.indexOf(c.TYPE_CORE_MATERIAL)&&-1===t.indexOf(c.TYPE_CORE_MATERIAL_NAME)&&-1===t.indexOf("all"))||(!(!i.isCoveringMaterial(e)||-1===t.indexOf(c.TYPE_COVERING_MATERIAL)&&-1===t.indexOf(c.TYPE_COVERING_MATERIAL_NAME)&&-1===t.indexOf("all"))||(!!(i.isPerformanceSpec(e)&&-1!==t.indexOf(c.TYPE_PERFORMANCE_SPEC)||i.isPerformanceChar(e)&&-1!==t.indexOf(c.TYPE_PERFORMANCE_CHAR))||-1!==t.indexOf("all")))))};if(Array.isArray(e))for(var s=0;s<e.length;s++){if(!(n=a(e[s].getTypeActualName())))break}else if(e){n=a(e.getTypeActualName()||e.getType())}return n},isExcludeType:function(e,t){return!(e instanceof Array)&&(!!t.includes(e.getTypeActualName())||(!(!t.includes(c.TYPE_PERFORMANCE_SPEC)||!o.isPerformanceSpecification(e.getTypeActualName()))||!(!t.includes(c.TYPE_PERFORMANCE_CHAR)||!o.isPerformanceCharacteristics(e.getTypeActualName()))))},_isParentInReleaseOrObsolete:function(e){let t=!1;if(e.data)if(e.data instanceof Array)for(let n=0;n<e.data.length;n++){let a=e.data[n];if(a.parentNodeModel&&"function"==typeof a.parentNodeModel.getMaturityActualName&&("RELEASED"===a.parentNodeModel.getMaturityActualName()||"OBSOLETE"===a.parentNodeModel.getMaturityActualName())){t=!0;break}}else{let n=e.data;!n.parentNodeModel||"function"!=typeof n.parentNodeModel.getMaturityActualName||"RELEASED"!==n.parentNodeModel.getMaturityActualName()&&"OBSOLETE"!==n.parentNodeModel.getMaturityActualName()||(t=!0)}return t},_getMenuState:function(e,t,n){let a=!0;if(t.data&&"RemoveChild"!==n)if(t.data instanceof Array){if("UPSAuthUnparent"!==n&&"DeleteItem"!==n||!this._isParentInReleaseOrObsolete(t)||(a=!1,e="disabled"),a)for(var o=0;o<t.data.length;o++){var s=t.data[o];if(i.isOriginatedInGLS(s)){e="disabled";break}}}else"UPSAuthUnparent"!==n&&"DeleteItem"!==n||!this._isParentInReleaseOrObsolete(t)||(a=!1,e="disabled"),a&&(e=i.isOriginatedInGLS(t.data)?"disabled":e);return e},_buildMenuEntry:function(e,t,n,a,o){var r,c,l=e.nls_key;u.isSafarionIPadorPod()?(c=e.touchFonticon?e.touchFonticon:e.fonticon,l=e.touch_nls_key?e.touch_nls_key:e.nls_key,r=e.touchIcon?i.getIconFormXSR(e.touchIcon):""):(c=e.fonticon,l=e.nls_key,r=e.icon?i.getIconFormPerfSpec(e.icon):""),a=this._getMenuState(a,n,o);var d={title:f[l],type:t,state:a,action:{this:this,callback:function(t){s.fireAction(e,n)}}};return c?d.fonticon={family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-"+c}:d.icon=r,d.fIcon=c,d.cmdID=o,d},_buildMenuGroup:function(e,t,n,a){var o,s=e.nls_key;u.isSafarionIPadorPod()?(o=e.touchFonticon?e.touchFonticon:e.fonticon,s=e.touch_nls_key?e.touch_nls_key:e.nls_key,e.touchIcon&&i.getIconFormXSR(e.touchIcon)):(o=e.fonticon,s=e.nls_key);var r=this._getMenuState("enabled",a,""),c={title:f[s],type:t,submenu:n,state:r};return c.fonticon={family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-"+o},c},checkAccess:function(e){var t=!0;if(this.currentAccess)for(var n=0;n<e.length;n++){var a=e[n];if(!(t=this.currentAccess.indexOf("all")>=0||-1!==this.currentAccess.indexOf(a)))break}return t},showMenu:function(e,t){e&&Array.isArray(t)&&a.show(t,{position:{x:e.x?e.x:e.left,y:e.y?e.y:e.bottom}})},getIdCardMenu:function(e,t){var n=this;if(!t)return this._nodeMenuBuilder(e,"ItemIDCard");this._nodeMenuBuilder(e,"ItemIDCard",["Information"]).then(function(e){n.showMenu(t,e)})},getSpecListMenuView:function(e,t){var n=t||[];return i.hasAdminDisabledTemplate&&n.push("DownloadReport"),this._nodeMenuBuilder(e,"LandingPageActions",n)},getTabActions:function(e,t,n){var a=n||[];return i.hasAdminDisabledTemplate&&a.push("DownloadReport"),this._build(e,t,"ItemTabActions",a)},getQuickViewMenu:function(e,t,n){return this._build(e,t,"ItemTabQuickView",n)},_build:function(e,t,n,a){var i=this;if(!t)return this._nodeMenuBuilder(e,n);this._nodeMenuBuilder(e,n,a).then(function(e){i.showMenu(t,e)})}})});