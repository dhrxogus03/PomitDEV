define("DS/XSRCommonComponents/createform/util/TableFormGridCol",["DS/XSRCommonComponents/utils/Constants","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Controls/ComboBox","DS/Controls/Toggle","DS/Controls/LineEditor","DS/XSRCommonComponents/utils/TypeUtils","i18n!DS/XSRCommonComponents/assets/nls/XSRCommonComponents","css!DS/XSRCommonComponents/createform/view/TableForm.css"],function(e,t,o,n,l,i,a,s){"use strict";return class{constructor(e){this.isMBMF=e.isMBMF,this.parentTitle=e.parentTitle,this.dataCount=e.dataCount}getCols(){let e=[{dataIndex:"tree",text:s.label_Title,pinned:"left",editableFlag:!1},{dataIndex:"ContextualMenuColumn",text:s.label_Action,pinned:"left",hasCellValue:e=>!0},{dataIndex:"uomupdated",text:s.label_Quantity,width:350,typeRepresentation:"UWAObject",editableFlag:!1,allowUnsafeHTMLContent:!1,autoRowHeightFlag:!1,exportFlag:!0,visibleFlag:!0,editionPolicy:"EditionOnOver",getCellValue:this.getCellValue_uom},{dataIndex:"type",text:s.label_Type,editableFlag:!1},{dataIndex:"referenceName",text:s.label_ReferenceName,editableFlag:!0,typeRepresentation:"string",editionPolicy:"EditionOnOver",width:105,value:""},{dataIndex:"connectCM",icon:"product-made-from-part",typeRepresentation:"independantBoolean",editionPolicy:"EditionInPlace",width:40,editableFlag:!0,getCellTooltip:this.getCellTooltip_connectCM.bind(this),getCellSemantics:this.getCellSemantics_connectCM},{dataIndex:"revision",text:s.label_RevisionsExplore,editableFlag:!1,width:60},{dataIndex:"current",text:s.label_Current,editableFlag:!1,width:90}],t=[];return e.forEach(e=>{t.push(e)}),t}getToolbar(){return{entries:[{id:"delete",dataElements:{typeRepresentation:"functionIcon",icon:this.getJsonValues("delete","icon","toolbar"),tooltip:this.getJsonValues("delete","tooltip","toolbar"),position:"far",category:"separate"}},{id:"duplicate",dataElements:{typeRepresentation:"functionIcon",icon:this.getJsonValues("duplicate","icon","toolbar"),tooltip:this.getJsonValues("duplicate","tooltip","toolbar"),position:"far",category:"integrate"}}]}}getMenuItems(e,t){let o=[],n={type:"PushItem",title:s.label_Remove,icon:this.getJsonValues("delete","icon","menu"),tooltip:this.getJsonValues("delete","tooltip","menu"),action:{callback:this.deleteCallBack.bind(t)}},l={type:"PushItem",title:s.label_Duplicate,icon:this.getJsonValues("duplicate","icon","menu"),tooltip:this.getJsonValues("duplicate","tooltip","menu"),action:{callback:this.duplicateCallBack.bind(t)}};return Array.isArray(e)||(e=[e]),e.forEach(e=>{switch(e){case"delete":o.push(n);break;case"duplicate":o.push(l)}}),o}getJsonValues(e,t,o){let n={};switch(e){case"delete":switch(t){case"tooltip":"toolbar"===o||null==o?(n.title=s.label_Remove,n.shortHelp=s.text_DeleteSelected):"menu"===o&&(n=s.text_DeleteSelected);break;case"icon":n.iconName="trash",n.fontIconFamily=1}break;case"duplicate":switch(t){case"tooltip":"toolbar"===o||null==o?(n.title=s.label_Duplicate,n.shortHelp=s.text_DuplicateSelected):"menu"===o&&(n=s.text_DuplicateSelected);break;case"icon":n.iconName="duplicate",n.fontIconFamily=1}}return n}contextualEvent(e){let t=this,o=[];return e&&e.collectionView&&e.cellInfos&&o.push(...t.getMenuItems(["delete","duplicate"],e.cellInfos)),o}getCellTooltip_connectCM(e){let t=this,o=!!e.nodeModel&&e.nodeModel,n={};if(o){let e=o.options.grid;e.canConnectCM?(n.title=s.text_connectCM+" "+e.coreMaterial[0].V_Name,n.shortHelp=s.replace(s.get("text_connectCMFromTo"),{modeTitle:e.title,parentTitle:t.parentTitle})):(n.title=s.text_cannotConnectCM,n.shortHelp=e.connectCM_Msg)}else n.shortHelp=s.text_connectCMTo+t.parentTitle;return n}getCellSemantics_connectCM(e){let t=!!e.nodeModel&&e.nodeModel;return!!t&&{disabled:!t.options.grid.canConnectCM}}deleteCallBack(){let e=this.manager.getTreeDocument();e.prepareUpdate();let t=e.getNthRoot(this.rowID);e.removeRoot(t),e.pushUpdate(2)}duplicateCallBack(){let e=this.manager.getTreeDocument();e.prepareUpdate();let t=e.options.dataModelSet,n=this.nodeModel.options.grid.copy,l=o.createTreeNodeDataModel(t,{label:n.title,grid:n});this.nodeModel.getParent().addRoot(l,this.nodeModel._getLocalID()+1),e.pushUpdate(1);let i=l._getRowID();this.manager.insertRowCallback(l,i,this),this.manager.ensureNodeModelVisible(l,!0),this.manager.flashEffectOnNodeModel("ui-modified",l)}getCellValue_uom(e){console.log("calling UOM cont");var t=e.nodeModel,o=UWA.createElement("div",{class:"uom-container","data-cellInfos":e}),d=!0,r=[],c=new Map;if(t&&"EA"===t.options.grid.unitDB)d=!1,r.push(t.options.grid.unitDB);else{var p=t.options.grid.dimension||t.options.grid._dimensionDB,u=Object.entries(a.getUOMUnits(p));u&&u.forEach(function(e){r.push(e[1]),c.set(e[1],e[0])})}var g=t.options.grid.quantity||"",m=t.options.grid.unit,h=t.options.grid.asRequired,C=-1;null!=m&&(C=r.indexOf(m));var b=UWA.createElement("div").inject(o),M=new l({label:s.label_AsNeeded,type:"switch",checkFlag:h});M.getContent().addClassName("xsr-grid-wux-inline"),M.addEventListener("buttonclick",function(e){var o=e.dsModel.checkFlag;t.options.grid.asRequired=o,t.updateOptions({grid:t.options.grid})});var x=d?"([0-9]*[.])?[0-9]+":"[0-9]+",f=new i({placeholder:s.placeholder_Quantity,value:g,pattern:x}).inject(b),_=new n({elementsList:r,selectedIndex:C,placeholder:s.placeholder_dropdown}).inject(b);return M.inject(b),_.getContent().addClassName("xsr-grid-combobox"),f.getContent().addClassName("xsr-grid-lineeditor"),f.addEventListener("change",function(e){let o=""===e.dsModel.value?"":parseFloat(e.dsModel.value);t.options.grid.quantity=o,t.updateOptions({grid:t.options.grid})}),_.addEventListener("change",function(e){let o=e.dsModel.value;null!=o&&(t.options.grid.unit=o,t.options.grid.unitDB=c.get(o),t.updateOptions({grid:t.options.grid}))}),d||(_.destroy(),M.destroy(),f.destroy()),o}}});