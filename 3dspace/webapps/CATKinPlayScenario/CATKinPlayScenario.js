define("DS/CATKinPlayScenario/utilsWS/WSUtils",["DS/WAFData/WAFData"],function(e){"use strict";var t={ExpandForAnimDiscipline:function(e,i,n,a){if(e.args.input.asset.serverurl&&e.args.input.asset.tenant){var r=e.args.input.asset.serverurl+"/cvservlet/progressiveexpand/v2?tenant="+e.args.input.asset.tenant;r+="&SecurityContext="+encodeURIComponent(e.args.input.asset.contextid),r+="&output_format=cvjson";var s={timeout:6e4,onComplete:n,onCancel:a,onFailure:a,onTimeout:a,method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":"en"}},o={batch:{expands:[{label:"AnimationPlayer",root:{physical_id:i},filter:{all:1},graph:{descending_condition_object:{uql:"(taxonomies:CATANIMDISCIPLINE)"}}}]},outputs:{select_object:["physicalid","pathsr","bo.streamdescriptors","type"]}};return s.data=JSON.stringify(o),t.executeExpandRequest(r,s)}},Fetch:function(e,i,n,a){if(e.args.input.asset.serverurl&&e.args.input.asset.tenant){var r=e.args.input.asset.serverurl+"/cvservlet/fetch/v2?tenant="+e.args.input.asset.tenant,s={timeout:6e4,onComplete:n,onCancel:a,onFailure:a,onTimeout:a,method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":"en"}},o={physicalid:i,fcs_url_mode:"REDIRECT",select_file:["anm"],select_predicate:["physicalid"],label:"AnimationPlayer",tenant:e.args.input.asset.tenant,locale:"en"};return s.data=JSON.stringify(o),t.executeFetchRequest(r,s)}},executeExpandRequest:function(t,i){e.authenticatedRequest(t,i)},executeExpand3dRequest:function(t,i){e.authenticatedRequest(t,i)},executeFetchRequest:function(t,i){e.authenticatedRequest(t,i)}};return t}),define("DS/CATKinPlayScenario/CATKinPlayScenario",["DS/3DPlay/PlayScenario3D","DS/CoreEvents/Events","DS/SIMAnimationWebMdl/SIMAnimationServices","DS/WebSystem/App"],function(e,t,i,n){"use strict";return e.extend({init:function(e){this._parent(e)},launch:function(){n.is3DPlay()?this.loadWorkbench({module:"CATKinPlayScenario",name:"CATKinPlayScenarioWithSidePanel"},!0,{sections:[{id:"PlayAnimation",nls:"CATKinPlayScenario/CATKinPlayScenario",rsc:"CATKinPlayScenario/CATKinPlayScenario"},{id:"ChooseAnimation",nls:"CATKinPlayScenario/CATKinPlayScenario",rsc:"CATKinPlayScenario/CATKinPlayScenario"},{id:"RightSidePanel",nls:"PADUtils/PADUtils",rsc:"PADUtils/PADUtils"}]}):this.loadWorkbench({module:"CATKinPlayScenario",name:"CATKinPlayScenario"},!0,{sections:[{id:"PlayAnimation",nls:"CATKinPlayScenario/CATKinPlayScenario",rsc:"CATKinPlayScenario/CATKinPlayScenario"},{id:"ChooseAnimation",nls:"CATKinPlayScenario/CATKinPlayScenario",rsc:"CATKinPlayScenario/CATKinPlayScenario"}]}),require(["DS/CoreEvents/Events"],function(e){e.publish({event:"CATKINPLAYSCENARIO/KINSCENARIOSELECTED",data:{}})})},isMobileCompatible:function(){return!0}})}),define("DS/CATKinPlayScenario/CATKinPlayRegister",["DS/3DPlay/3DPlayRegister","DS/CATKinPlayScenario/CATKinPlayScenario","DS/SIMAnimationWebMdl/SIMAnimationServices","DS/Visualization/PathElement","UWA/Promise","DS/PADUtils/utilsWS/WSAccessV1","DS/Visualization/Utils","DS/WAFData/WAFData","DS/SIMAnimationWebMdl/Ox4FeatureModeler","DS/WebSystem/Environment","DS/PADUtils/PADUtilsServices","DS/CoreEvents/Events","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/Visualization/Node3D","DS/Visualization/IdPath","DS/CATKinPlayScenario/utilsWS/WSUtils"],function(e,t,i,n,a,r,s,o,c,l,u,p,S,A,d,I){"use strict";var C=[];return e.extend({init:function(e){var t=this,r=l.isSet("3DPlay.KinDebug");this._parent(e),this.hasCATANIMDISCIPLINE=0,this.CATANIMDISCIPLINEarray={},this._Experience=this.scenarioManager.getExperience(),this._OOCActive=!1,this._Experience.RuntimeMode.OOC&&(this._OOCActive=this._Experience.RuntimeMode.OOC),this._largeDataStructure=null,this._initScenarios(),this._Experience&&this._Experience.EventDisposer.add(this._Experience.subscribe("ASSET/LOADINGFINISHED",function(){var e=function(e){t.scenarioManager.setAvailability(e,{iRegisterID:t.registerID,iScenarioID:C[0]})},s=function(){var n=t._Experience.getRootBag(),a=new i,r=a.getAnimations(n),s=a.getKeyFramer(n);self.keyFramer=s,e(r&&r.length>0),p.publish({event:"ANIMATION_SEARCH_COMPLETE",data:r})};e(!1);var u,d,D,h=!l.isBoolActive("3DPlay.Debug.SkipKinIndex");if(t._largeDataStructure=t._Experience.pad3DViewer.getController().isLargeDataStructure(),t._Experience.args.input.asset&&t._Experience.args.input.asset.physicalid&&"EV6"===t._Experience.args.input.asset.provider&&h){u=t._Experience.args.input.asset.physicalid,d=function(i){var l;try{l=JSON.parse(i)}catch(e){l={results:[]}}if(l.results.forEach(function(e){var i,n,a={};void 0!==e.pathsr&&(a.pathsr=e.pathsr),void 0!==e["bo.streamdescriptors"]&&(a["bo.streamdescriptors"]=e["bo.streamdescriptors"]),void 0!==e.resourceid&&(n=e.resourceid),void 0!==e.type&&"CATANIMDISCIPLINE"===e.type&&(i=!0),i&&(t.CATANIMDISCIPLINEarray[n]=a,t.hasCATANIMDISCIPLINE++)}),e(t.hasCATANIMDISCIPLINE>0),0!=t.hasCATANIMDISCIPLINE){var u=function(){for(var e in t.CATANIMDISCIPLINEarray)if(t.CATANIMDISCIPLINEarray[e].pathsr)for(var i=t.CATANIMDISCIPLINEarray[e].pathsr.split(" Sep "),n=0;n<i.length;n++){var a=i[n].split(" "),r=a[2],s="rootBag",o=r.split("_"),c=(parseInt(o[1]),a.indexOf("PS")),l=a.indexOf("PE");if(-1!==c&&-1!==l)for(var u=c+1;u<l;u++){s=a[u];var p=t._Experience.pad3DViewer.getController().getInstanceParentReferenceId(s);if(!p)return!1}}return!0}(),p=[],d=t._Experience.getRootBag().children[0];for(var C in d&&d.traverse(function(e){var i;(i=!0===t._OOCActive?S.getNodeID(e)?S.getNodeID(e):e.id:e.getID?e.getID():e.id)&&(0,p[i]=e),e.id=i}),t.CATANIMDISCIPLINEarray)if(t.CATANIMDISCIPLINEarray[C].pathsr)for(var D=t.CATANIMDISCIPLINEarray[C].pathsr.split(" Sep "),h=D.length,v=0;v<h;v++){var P=D[v].split(" "),f=P[2],y=p[C];if(u&&!y&&!0===t._OOCActive&&(y=new A(C),p[C]=y),y)if(!0===t._OOCActive){var g=[],m="rootBag";g.push(m),y.SemanticRelations=y.SemanticRelations||{};var E=f.split("_"),T=parseInt(E[1]),N=P.indexOf("PS"),_=P.indexOf("PE");if(-1!==N&&-1!==_){for(var x=N+1;x<_;x++){m=P[x];var O=t._Experience.pad3DViewer.getController().getInstanceParentReferenceId(m);if(O)-1===(f=g.indexOf(O))&&g.push(O);g.push(m)}r&&console.log("PATH ",R.getKey())}else r&&console.log("Error parsing SemanticRelations ",D[v]);y.SemanticRelations[T]=g}else{var R=new n;R.addElement(d),y.SemanticRelations=y.SemanticRelations||{};E=f.split("_"),T=parseInt(E[1]),N=P.indexOf("PS"),_=P.indexOf("PE");if(-1!==N&&-1!==_){for(x=N+1;x<_;x++){var K=p[P[x]];K&&(R.addElement(K),x<_-1&&1==K.children.length&&R.addElement(K.children[0]))}r&&console.log("PATH ",R.getKey())}else r&&console.log("Error parsing SemanticRelations ",D[v]);y.SemanticRelations[T]=R}}d.traverse(function(e){e.SemanticRelations&&r&&console.log("DEBUG",e.SemanticRelations)});var M=[];for(var C in t.CATANIMDISCIPLINEarray)t.CATANIMDISCIPLINEarray[C]["bo.streamdescriptors"]&&M.push(C);I.Fetch(t._Experience,M,function(e){var i,n={};try{i=JSON.parse(e).results}catch(e){}for(var l=i.length;l--;){var u=i[l];if(u){for(var A,I,C=u.attributes.length;C--;){var D=u.attributes[C];"anm"===D.name?A=D.value:"physicalid"===D.name&&(I=D.value)}n[I]=A}}c.init();var h=[],v=function(e,i,n,a){var r;void 0!==i&&(r=!0===t._OOCActive?S.getNodeID(i)||i.name:i.getID?i.getID():i.id,c.loadRepresentation(i,r,new Blob([e],{type:"application/octet-stream"}),function(e){!function(e,i){var n;n=!0===t._OOCActive?S.getNodeID(e)||e.name:e.getID?e.getID():e.id;var a=c.listRootFeatures(n);e.AnimFeatures=a,i.AnimFeaturesList=i.AnimFeaturesList||[],Array.prototype.push.apply(i.AnimFeaturesList,e.AnimFeatures)}(i,d),n()}))};Object.keys(n).forEach(function(e){h.push(new a(function(t,i){var a,s,c;a=n[e],s=function(i){r&&console.log(i),v(i,p[e],t)},c=function e(){r&&console.log(e),i()},o.handleRequest(a,{authentication:"passport",method:"GET",type:"arraybuffer",timeout:5e4,onComplete:s,onTimeout:c,onFailure:c,onCancel:c})}))}),a.all(h).then(function(){n=null,p=null,h=[],s()})},function(){r&&console.error(arguments)})}},!0===t._OOCActive&&I.ExpandForAnimDiscipline(t._Experience,u,d,D)}else s()}))},onClick:function(e){},_initScenarios:function(){var e=this;C.push(this.scenarioManager.addScenario({registerID:this.registerID,scenario:t.extend({launch:function(){e.onClick(this._parent.bind(this)),this._parent()}}),available:!1,name:"Animation"}))}})});