define("DS/CATW3DCommands/CATW3DMoveBarUX",["UWA/Class","DS/CATWebUXComponents/CATWebUXNotifBar","i18n!DS/CATW3DCommands/assets/nls/CATW3DMoveBarUX"],function(e,t,n){"use strict";return e.extend({init:function(e){let o,i,a,l,s;o=n.PositionModifiedLbl,i=n.PositionModifiedOK,a=n.PositionModifiedCancel,l=n.PositionLockedLbl,s=n.PositionLockedLink;var r,c,d,h,u=e.nlsModifLbl||o;this.show=function(){r||(r=new t({className:"c3dMoveCmdDlg"}).inject(e.uiFrame),this.hide(),c=r.add({msgType:"primary",message:u||o,closable:!1,buttons:[{className:"spinner"},{className:"primary",label:i,onClick:e.onSave},{className:"default",label:a,onClick:e.onCancel}]}),this.hideSpinner(),this.hideSave(),(d=r.add({msgType:"warning",message:l,closable:!1,buttons:[{className:"link",label:s,onClick:e.onCancelLocked}]})).hide()),r.getContent().parentElement.parentElement.setStyle({overflow:"hidden"}),r.show()},this.showSave=function(){this.hideSpinner(),c&&(c.buttons[1].show(),h=!0)},this.showSpinner=function(){!1===h&&c.buttons[0].show()},this.showLock=function(){d&&d.show()},this.hide=function(){r&&r.hide()},this.hideSave=function(){c&&(h=!1,c.buttons[1].hide())},this.hideSpinner=function(){c&&c.buttons[0].hide()},this.hideLock=function(){d&&d.hide()},this.destroy=function(){r&&r.destroy(),r=c=d=null}}})}),define("DS/CATW3DCommands/CATW3DSetIdentityMatrixCmd",["DS/CATWebUXComponents/DMUCommand","DS/Selection/CSOManager","DS/Visualization/ThreeJS_DS","DS/CATW3DMoveManager/CATW3DMoveReferent","DS/CATW3DMoveManager/CATW3DMoveManager","DS/PADUtils/PADContext"],function(e,t,n,o,i,a){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"shared",isAsynchronous:!1}),this.setRepeatMode(!1),this.beginExecute=function(){var e=[],l=a.get(),s=i.giveMoveManager({context:l}),r=o.getMoveReferentManager({context:l});t.get().forEach(function(t){var n=r.getMoveReferent(t.pathElement);n&&e.push({path:n})}),e.length&&(s.onMoveBegin({objectsMoved:e,from:this,moveMode:"Persistent"}),s.onMove({objectsMoved:e,from:this,leafMatrix:new n.Matrix4}),s.onMoveEnd({from:this,status:"Moved"})),this.done()}}})}),define("DS/CATW3DCommands/CATW3DCmdsUtils",["DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"],function(e){"use strict";var t={},n=["PPRContext","Drawing"];return t.isPLMNode=function(t){return t&&e.isPLMNode(t)},t.isPLMReferenceNode=function(t){return t&&e.isReference(t)},t.isPLMInstanceNode=function(t){return t&&e.isInstance(t)},t.isPLMLeafNode=function(t){return t&&e.is3DLeaf(t)},t.getLevelSelectorLevels=function(o){if(o){var i,a,l,s=o.pathElement,r=o.pathElementCurrent,c=o.onInfoCompleted,d=o.context,h=d.getController(),u=["ds6w:label","type_icon_url"];if(s&&d){var f,g,m=[],v=[],C=null,D={levels:m},p=s.clone();for(p.internalPath.length=0,g=p.getLastElement(!0);g;){var M={};if(f=e.getNodeType(g),t.isPLMInstanceNode(g)){if(0===m.length&&1===g.children.length){M.pathElement=p.clone();var E=g.children[0];M.pathElement.addElement(E),v.push(M.idRef=e.getNodeID(E)),v.push(M.idInst=e.getNodeID(g)),C=1}}else if(t.isPLMReferenceNode(g))M.pathElement=p.clone(),v.push(M.idRef=e.getNodeID(g)),l=p.externalPath.length>1?p.externalPath[p.externalPath.length-2]:null,t.isPLMInstanceNode(l)&&v.push(M.idInst=e.getNodeID(l));else if(t.isPLMLeafNode(g)&&(!o.fromFirstRef||p.getParentPath()&&p.getParentPath().isEqual(d.getRootBagPath())))M.pathElement=p.clone(),v.push(M.idRef=e.getNodeID(g));else if(g.getDibInfo&&!a)a=!0,M.pathElement=p.clone(),v.push(M.idRef=g.getDibInfo().id),(l=p.externalPath.length>1?p.externalPath[p.externalPath.length-2]:null)&&l.getDibInfo&&v.push(M.idInst=l.getDibInfo().id);else if(n.indexOf(f)>-1&&t.isPLMNode(g)){var x=p.externalPath.length>1?p.externalPath[p.externalPath.length-2]:null;t.isPLMNode(x)||(M.pathElement=p.clone(),v.push(M.idRef=e.getNodeID(g)))}M.pathElement&&(null===C&&r&&r.isEqual(M.pathElement)&&(C=m.length),m.push(M)),g=(p=p.getParentPath())?p.getLastElement(!0):void 0}return null!==C&&(D.currentLevel=C),h.isColorizeActivated()&&h.isStandalone()&&u.push(i=h.getBIColorMap().predicate),d.getController().getAttributes({ids:v,attributes:u,callbacks:{onComplete:function(e){m.forEach(function(t){t.name=e[t.idRef]?e[t.idRef]["ds6w:label"]:"",t.idInst&&e[t.idInst]&&e[t.idInst]["ds6w:label"]&&(t.name+=" ("+e[t.idInst]["ds6w:label"]+")"),t.icon=e[t.idRef]?e[t.idRef].type_icon_url:void 0,i&&(t.canvasColor=h.getColorValueForPredicate(e[t.idRef][i])),delete t.idRef,delete t.idInst}),c&&c()},onFailure:function(){m.forEach(function(e){delete e.idRef,delete e.idInst})}}}),D}}},Object.freeze(t)}),define("DS/CATW3DCommands/CATW3DLevelSelectorCmd",["DS/CATWebUXComponents/DMUCommand","DS/LevelSelector/LevelSelector","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/VisuEvents/EventsManager","DS/VisuEvents/ScreenEvent","DS/CATW3DMoveManager/CATW3DMoveReferent","DS/CATW3DCommands/CATW3DCmdsUtils","DS/PADUtils/PADContext","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"],function(e,t,n,o,i,a,l,s,r,c){"use strict";let d,h,u=e.extend({init:function(e){this._parent(e,{mode:"shared",isAsynchronous:!0}),this.options=e;var u,f,g,m,v,C,D,p,M=this,E=r.get(),x=d||"DMULevelSelectorHdr"!==e.ID,S=function(e){v=null,e&&e.from&&1===e.from.length&&e.from[0].event&&"touchend"===e.from[0].event.type&&1===e.from[0].event.changedTouches.length&&(v=e.from[0])};d=x,h=e.ID,i.addEvent(document,"onRelease",S),this.beginExecute=function(){p=!0,m=n.onChange(function(){p=!1,E.getExecutionContext?M.cancelExecute():M.cancel()}),C=[];var e=u;if(!e){var r=n.get();u=r.length>0?r[r.length-1]:void 0,e=u,f=u?u.pathElement:void 0;for(var d=0;d<r.length-1;++d)C.push(r[d])}if(D&&(D=n.get()),e&&e.pathElement){E.getFrameWindow().getContextualUIManager().hideContextualMenus();var h={x:0,y:0};if(v){var S=v.event.changedTouches[0];h.x=S.clientX,h.y=S.clientY}else{var P=i.getMouseEvents(a.MouseButton.NONE);P&&P.length&&(h.x=P[0].event.clientX,h.y=P[0].event.clientY)}v=null;var L=f;if(x){var b=(L=l.getMoveReferentManager({context:E}).getMoveReferent(f))?L.getLastElement(!0):null;b&&c.isInstance(b)&&b.children.length&&L.addElement(b.children[0])}var R={display:{type:"position",x:h.x,y:h.y},uiFrame:E.getFrameWindow().getUIFrame(),getLevels:function(t){var n=s.getLevelSelectorLevels({fromFirstRef:!1,pathElement:e.pathElement,pathElementCurrent:L,onInfoCompleted:t,context:E});if(n&&x){var o=l.getMoveReferentManager({context:E});n.selectColor="#ff821e",n.selectOverColor="#ffb477";for(var i=n.levels.length-1;i>=0;--i){var a=n.levels[i],r=a.pathElement.getLastElement(!0);if(c.isReference(r))if(c.isRepReference(r))a.selection="notCurrent";else o.getMoveReferent(a.pathElement)||(a.selection="notCurrent");else a.selection="notCurrent"}}return n},onHover:function(e){o.empty(),o.add(e)},onLeave:function(e){u&&(o.remove(e),o.add(u))},onSelect:function(e){if(m=n.unsubscribe(m),e&&e.pathElement&&0===e.pathElement.internalPath.length){x&&l.getMoveReferentManager({context:E}).addMoveReferent(e.pathElement),u.pathElement=e.pathElement,o.empty(),D||n.empty();var t=C.concat(D||u),i=g,a=D;setTimeout(function(){o.add(t),a||n.add(t),i&&i(e),E.getExecutionContext?E.getFrameWindow().getContextualUIManager()._showContextualBar({hideWithDistance:!0}):E.getFrameWindow().getContextualUIManager().showContextualBar({hideWithDistance:!0})},E.getExecutionContext?50:0)}p=!1,E.getExecutionContext?M.cancelExecute():M.cancel()}};t.createView(R)}else E.getExecutionContext?M.cancelExecute():M.cancel()},this.cancelExecute=function(){p&&(D||u)&&(o.empty(),o.add(D||u)),m=n.unsubscribe(m),g=void 0,u=void 0,f=void 0,D=void 0,t.destroyView(),this.done()},this.pauseExecute=function(){M.cancelExecute()},this.resumeExecute=function(){M.beginExecute()},"CATW3DRobotLevelSelectorHdr"===e.ID&&(x=!1,this.setRobotParams=function(e){g=e.selectCB,D=e.doNotModifyCSO,u={pathElement:e.pathContext.clone()},f=e.pathCurrent.clone()}),"DMULevelSelectorHdr"===e.ID&&(this.showReferentLevel=function(e){x=e});var P=this._destroy;this._destroy=function(){M&&(i.removeEvent(document,"onRelease",S),P.call(M),M=E=null)}}});return u.displayReferentLevel=function(e){"DMULevelSelectorHdr"===h&&(d=e)},u});