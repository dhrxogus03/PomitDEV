define("DS/CAT3DExpAmbienceModelWeb/interfaces/CATI3DXAmbienceAsset",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(e,t){"use strict";return t.singleton({interfaceName:"CATI3DXAmbienceAsset",required:{getAmbience:function(){}},optional:{}})}),define("DS/CAT3DExpAmbienceModelWeb/extensions/CATECXPAmbienceEnvironmentActivate",["UWA/Core","UWA/Class/Listener","DS/Visualization/ThreeJS_DS"],function(e,t,i){"use strict";return e.Class.extend(t,{init:function(){this._parent(),this._ambience=null,this._frameChanges={},this._refreshAtNextFrame=!1},Dispose:function(){this._parent(),this._frameChanges={},this._refreshAtNextFrame=!1,this._ambience&&this.Deactivate()},Activate:async function(){this._ambience=await this.QueryInterface("CATI3DXAmbienceAsset").getAmbience();const e=this.GetObject()._experienceBase.getManager("CAT3DXEnvironmentManager");e.isTransparentBackground()?this._ambience.getBackground().setActivated(!1):this._ambience.getBackground().setActivated(!0),e._getViewer().setAmbience(this._ambience,!0),this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"Exposure.CHANGED",()=>{this._addFrameChanges("exposure",this._refreshExposure)}),this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"Dome Radius.CHANGED",()=>{this._addFrameChanges("domeRadius",this._refreshDomeRadius)}),this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"Finite Dome.CHANGED",()=>{this._addFrameChanges("domeFinite",this._refreshDomeFinite)}),this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"Dome Origin X.CHANGED",()=>{this._addFrameChanges("domeTransform",this._refreshDomeTransform)}),this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"Dome Origin Y.CHANGED",()=>{this._addFrameChanges("domeTransform",this._refreshDomeTransform)}),this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"Dome Origin Z.CHANGED",()=>{this._addFrameChanges("domeTransform",this._refreshDomeTransform)}),this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"Dome Rotation X.CHANGED",()=>{this._addFrameChanges("domeTransform",this._refreshDomeTransform)}),this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"Dome Rotation Y.CHANGED",()=>{this._addFrameChanges("domeTransform",this._refreshDomeTransform)}),this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"Dome Rotation Z.CHANGED",()=>{this._addFrameChanges("domeTransform",this._refreshDomeTransform)}),this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"Ground Scale Ratio.CHANGED",()=>{this._addFrameChanges("groundScale",this._refreshGroundScaleRatio)}),this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"Ground Offset.CHANGED",()=>{this._addFrameChanges("groundOffset",this._refreshGroundOffset)}),this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"Ground Reflectivity.CHANGED",()=>{this._addFrameChanges("groundReflectivity",this._refreshGroundReflectivity)}),this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"Ground Glossiness.CHANGED",()=>{this._addFrameChanges("groundGlossiness",this._refreshGroundGlossiness)}),this._addFrameChanges("exposure",this._refreshExposure),this._addFrameChanges("domeRadius",this._refreshDomeRadius),this._addFrameChanges("domeFinite",this._refreshDomeFinite),this._addFrameChanges("domeTransform",this._refreshDomeTransform),this._addFrameChanges("groundScale",this._refreshGroundScaleRatio),this._addFrameChanges("groundOffset",this._refreshGroundOffset),this._addFrameChanges("groundReflectivity",this._refreshGroundReflectivity),this._addFrameChanges("groundGlossiness",this._refreshGroundGlossiness)},_refreshExposure:function(){},_refreshDomeRadius:function(){var e=this.QueryInterface("CATI3DExperienceObject").GetValueByName("Dome Radius");0===e||"backplate"===this._ambience.getBackground().getType()?this._ambience.setFiniteMode(!1):(this._ambience.setGroundRadius(e),this._ambience.setFiniteMode(!0))},_refreshDomeFinite:function(){this.QueryInterface("CATI3DExperienceObject").HasVariable("Finite Dome")&&(this.QueryInterface("CATI3DExperienceObject").GetValueByName("Finite Dome")?this._ambience.setFiniteMode(!0):this._ambience.setFiniteMode(!1))},_refreshDomeTransform:function(){var e=this.QueryInterface("CATI3DExperienceObject").GetValueByName("Dome Origin X"),t=this.QueryInterface("CATI3DExperienceObject").GetValueByName("Dome Origin Y"),s=this.QueryInterface("CATI3DExperienceObject").GetValueByName("Dome Origin Z"),r=this.QueryInterface("CATI3DExperienceObject").GetValueByName("Dome Rotation X"),n=this.QueryInterface("CATI3DExperienceObject").GetValueByName("Dome Rotation Y"),a=this.QueryInterface("CATI3DExperienceObject").GetValueByName("Dome Rotation Z"),o=new i.Matrix4;o.setRotationFromEuler(new i.Vector3(r*Math.PI/180,n*Math.PI/180,a*Math.PI/180)),o.setPosition(new i.Vector3(e,t,s)),this._ambience.setTransform(o);var h=new i.Matrix4;h.setRotationFromEuler(new i.Vector3(r*Math.PI/180,n*Math.PI/180,a*Math.PI/180)),this._ambience.setEnvironmentLightMatrix(h)},_refreshGroundScaleRatio:function(){var e=this.QueryInterface("CATI3DExperienceObject").GetValueByName("Ground Scale Ratio");this._ambience.setGroundHeight(new i.Vector3(0,0,e/6))},_refreshGroundOffset:function(){var e=this.QueryInterface("CATI3DExperienceObject").GetValueByName("Ground Offset");this._ambience.setGroundOffset(e)},_refreshGroundReflectivity:function(){var e=this.QueryInterface("CATI3DExperienceObject").GetValueByName("Ground Reflectivity");this._ambience.setGroundReflectivitiy(e/100)},_refreshGroundGlossiness:function(){var e=this.QueryInterface("CATI3DExperienceObject").GetValueByName("Ground Glossiness");this._ambience.setGroundGlossiness(e/100)},Deactivate:function(){this.stopListening(),this._ambience=null,this._frameChanges={}},_addFrameChanges:function(e,t){this._frameChanges[e]=t,this._refreshAtNextFrame||(this._refreshAtNextFrame=!0,this.GetObject()._experienceBase.getManager("CAT3DXEnvironmentManager")._refreshEnvironment(this))},Refresh:function(){for(var e in this._refreshAtNextFrame=!1,this._frameChanges)this._frameChanges.hasOwnProperty(e)&&(this._frameChanges[e].call(this),delete this._frameChanges[e])}})}),define("DS/CAT3DExpAmbienceModelWeb/extensions/CATE3DXAmbienceAsset",["UWA/Core","UWA/Class","UWA/Class/Listener","UWA/Class/Events","DS/CAT3DExpModel/XCTEWSTracesHelper","DS/CAT3DExpModel/XCTExp3DSpaceAsset"],function(e,t,i,s,r,n){"use strict";return t.extend(i,s,{init:function(){},Build:function(){this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"ASSET_CHANGED",()=>{this._clearAmbience(),this.dispatchEvent("AMBIENCE_CHANGED")})},Dispose:function(){this._clearAmbience()},_clearAmbience:function(){delete this._ambience,delete this._ambiencePromise},isPLMAmbience:async function(){return this.QueryInterface("CATI3DXAssetHolder")._resolveAsset().then(e=>e instanceof n)},getAmbience:function(){if(this._ambience)return e.Promise.resolve(this._ambience);if(this._ambiencePromise)return this._ambiencePromise;const t=r.createTrace("EWS_LoadAmbience_"+this.QueryInterface("CATI3DExperienceObject").GetValueByName("_varName"));return this._ambiencePromise=this.QueryInterface("CATI3DXAssetHolder")._resolveAsset().then(e=>this._getAmbienceFromAsset(e)).then(e=>(this._ambience=e,delete this._ambiencePromise,t.end(!0),this._ambience)).catch(t=>(delete this._ambiencePromise,e.Promise.reject(t))),this._ambiencePromise},_getAmbienceFromAsset:function(){return e.Promise.reject(new Error("CATE3DXAmbienceAsset._getAmbienceFromAsset : Must be implemented by derived class"))}})});