define("DS/IssueComponents/external/RelationalExplorer",[],function(){"use strict";var e={WIDTH:700,HEIGHT:800};return{execute:function(t){require(["DS/TransientWidget/TransientWidget","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices"],function(s,n,i){var o=n.get("widget"),a=[];if(t.forEach(function(e){a.push({envId:i.getTenant(),serviceId:e.serviceId?e.serviceId:"3DSpace",contextId:o.id,objectId:e.id,objectType:"",displayName:""})}),a.length>0){var r={protocol:"3DXContent",version:"1.1",source:n.get("widget").name,data:{items:a}},l={mode:"panel",height:e.HEIGHT,width:e.WIDTH};s.showWidget("ENORIPE_AP","",{X3DContentId:JSON.stringify(r),x3dPlatformId:i.getTenant()},l)}})}}}),define("DS/IssueComponents/team/MembersFilterView",["UWA/Class/View","i18n!DS/IssueComponents/assets/nls/IssueComponents","UWA/Core"],function(e,t,s){return e.extend({name:"teamfilter",tagName:"div",className:"iss-member-view",setup:function(){this.template='                                                <div class="'+this.getClassNames("-role-filter")+'">                                                    <table class="filter-table table">                                                        <tr >                                                            <td style="color: gray;">'+t.team.filter.filterByName+'</td>                                                            <td>                                                                <div class="filter-input">                                                                    <input type="text" placeholder="'+t.team.filter.searchPlaceholder+'" class="form-control form-control-root filtertext">                                                                    <div class="clear-filter fonticon fonticon-cancel-circled"></div>                                                                </div>                                                            </td>                                                        </tr>                                                      </table>                                                   </div>'},init:function(e){e=s.clone(e||{},!1),this._parent.call(this,e)},render:function(){this.name,this.cid;this.container.empty(),containerReference=this.container;var e=UWA.createElement("div",{class:"iss-member-view-role-filter",styles:{height:"10%"}});return e.addContent(this.template),e.inject(containerReference),this},domEvents:{"keyup .filtertext":function(e){var t=e.target.value,s=this.container.getElement(".clear-filter");t.length>0?s.setStyle("visibility","visible"):s.setStyle("visibility","hidden"),this.dispatchEvent("memberFilterKeyUp",arguments)},"click .clear-filter":function(e){this.container.getElement(".clear-filter").setStyle("visibility","hidden");var t=this.container.getElement(".filtertext");if(t){t.value=""}this.dispatchEvent("memberFilterKeyUp",{target:{value:""}})},"focus .filtertext":function(){var e=document.getElementsByClassName("searchfiler-input-container");e.addClassName("highlighted-border"),e.removeClassName("border-without-focus")}}})}),define("DS/IssueComponents/templates/TemplatesContextualMenu",["UWA/Class/Promise","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","DS/IssueServices/services/PlatformServices","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,s,n,i,o,a){"use strict";var r="DS/IssueManagement/components/ContextualMenu";return{getContextualMenu:function(t){try{s.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryViewTemplateActions"}})}catch(e){}finally{this.templateComponet=n.get("templateComponentDialog")?n.get("templateComponentDialog"):n.get("templateComponent");var i=t.document.getSelectedTemplateNodes();if(this.user=o.getUserName(),0===i.length)return e.resolve([]);var a=i.reduce(function(e,t){var s=t.options.id.split(","),n=s[s.length-1],i=t.options.grid.Approvals;return e.push({physicalId:n,path:t.options.id,parentId:t.options.data.issue,relationToIssue:t.options.data.relationToIssue,type:t.options.type,baseType:t.options.baseType,name:t.options.name,title:t.options.title,state:t.options.state,approvals:i,kind:t.options.kind,owner:t.options.owner}),e},[]);return this._getMenu({objects:a})}},_getMenu:function(t){return 0===(Array.isArray(t.objects)?t.objects:[]).length?e.resolve([]):(i.start(r+" _getMenu"),this._getBasicMenu(t))},_getApprovalMenu:function(t){var s=[];if(1===t.objects.length){var n={type:"CheckItem",icon:"check",state:"unselected"};t.approvals?(n.state="selected",n.title=a.approvalOnCommand):n.title=a.approvalOffCommand,s.push(n),s.push({type:"SeparatorItem"})}return e.resolve(s)},_getBasicMenu:function(n){var o=this;i.start(r+" _getBasicMenu");var l=[],c=Array.isArray(n.objects)?n.objects:[];if(0===c.length)return l;var d=new e(function(e){e()});return d=d.then(function(){return l.push({name:"CollaborativeLifecycle",title:a.collaborativeLifecycleCommand,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-collaborative-lifecycle-management"},data:null,action:{callback:function(){t.getCommand("CollaborativeLifecycle").begin();try{s.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"IssueTemplate",pd2:"DataGridView",pd3:"SummaryViewTemplateActions",pd4:"Maturity",pd5:"IssueTemplate/DataGridView/SummaryViewTemplateActions/Maturity"}})}catch(e){}}}}),l.push({type:"SeparatorItem"}),l.push({name:"Move",title:a.moveCommand,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-move-to"},data:null,action:{callback:function(){t.getCommand("Move").begin();try{s.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"IssueTemplate",pd2:"DataGridView",pd3:"SummaryViewTemplateActions",pd4:"Move",pd5:"IssueTemplate/DataGridView/SummaryViewTemplateActions/Move"}})}catch(e){}}}}),l.push({type:"SeparatorItem"}),l.push({name:"Share",title:a.shareCommand,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-forward"},data:null,action:{callback:function(){o.templateComponet.shareTemplateHandler()}}}),1==c.length&&l.push({name:"information",title:a.informationCommand,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-info-open-in-a-new-window"},data:null,action:{callback:function(){s.viewProperties(c[0].physicalId,"3DSpace");try{s.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"IssueTemplate",pd2:"DataGridView",pd3:"SummaryViewTemplateActions",pd4:"Information",pd5:"IssueTemplate/DataGridView/SummaryViewTemplateActions/Information"}})}catch(e){}}}}),l.push({name:"Delete",title:a.deleteCommand,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-trash"},data:null,action:{callback:function(){o.templateComponet._removeTemplateHandler();try{s.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"IssueTemplate",pd2:"DataGridView",pd3:"SummaryViewTemplateActions",pd4:"Delete",pd5:"IssueTemplate/DataGridView/SummaryViewTemplateActions/Delete"}})}catch(e){}}}}),l.push({type:"SeparatorItem"}),i.end(r+" _getBasicMenu"),l})}}}),define("DS/IssueComponents/routes/Routes",["UWA/Class/View","UWA/Core","UWA/Class/Promise","DS/Logger/Logger","DS/Tree/TreeListView","DS/TreeModel/TreeNodeModel","DS/UIKIT/Scroller","DS/UIKIT/Tooltip","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f){"use strict";var h={STATES:{CREATE:0,ASSIGN:1,ACTIVE:2,REVIEW:3,CLOSED:4},STATES_ORDER:{0:"CREATE",1:"ASSIGN",2:"ACTIVE",3:"REVIEW",4:"CLOSED"},CSS:{ELEMENTS:{SCROLLCONTENT:"im-routes-scroll-content",SCROLLCONTAINER:"im-routes-scroll-container",TABLE_CONTAINER:"im-routes-table-container",TABLE_HEADER:"im-routes-table-header",TABLE_HEADER_STATES:"im-routes-table-header-states",TABLE_HEADER_ROUTES:"im-routes-table-header-routes",TABLE_ROWS_CONTAINER:"im-routes-table-rows-container",TABLE_ROW:"im-routes-table-row",TABLE_ROW_STATES_CELL:"im-routes-table-row-states-cell",TABLE_ROW_STATES_CELL_STATE_BLOCK:"im-routes-table-row-states-cell-state-block",TABLE_ROW_STATES_CELL_STATE_BLOCK_CURRENT:"im-routes-table-row-states-cell-state-block-curr",TABLE_ROW_STATES_CELL_STATE_BLOCK_CREATE:"im-routes-table-row-states-cell-state-block-create",TABLE_ROW_STATES_CELL_STATE_BLOCK_ASSIGN:"im-routes-table-row-states-cell-state-block-assign",TABLE_ROW_STATES_CELL_STATE_BLOCK_ACTIVE:"im-routes-table-row-states-cell-state-block-active",TABLE_ROW_STATES_CELL_STATE_BLOCK_REVIEW:"im-routes-table-row-states-cell-state-block-review",TABLE_ROW_STATES_CELL_STATE_BLOCK_CLOSED:"im-routes-table-row-states-cell-state-block-closed",TABLE_ROW_STATES_CELL_ARROW_ASC:"fonticon fonticon-2x fonticon-double-chevron-down im-lifecycle-approve-modal-preview-arrow",TABLE_ROW_STATES_CELL_ARROW_DESC:"fonticon fonticon-2x fonticon-double-chevron-up im-lifecycle-approve-modal-preview-arrow",TABLE_ROW_ROUTES_CELL:"im-routes-table-row-routes-cell",TABLE_ROW_ROUTES_CELL_STATUS:"im-routes-table-row-routes-cell-status",TABLE_ROW_ROUTES_CELL_MULTI:"im-routes-table-row-routes-cell-multi",TABLE_ROW_ROUTES_CELL_DECISION_ROW:"im-routes-table-row-routes-cell-decision-row",TABLE_ROW_ROUTES_CELL_DECISION_STATUS:"im-routes-table-row-routes-cell-decision-status",ICON_APPROVED:"fonticon fonticon-check im-routes-icon-approved",ICON_REJECTED:"fonticon fonticon-wrong im-routes-icon-rejected",ICON_ABSTAINED:"fonticon fonticon-minus im-routes-icon-abstained",ICON_INPROGRESS:"fonticon fonticon-clock im-routes-icon-inprogress",CELL_DECISION_TEXT:"im-routes-table-row-routes-cell-decision-text",CELL_DECISION_TOOLTIP_TEXT:"im-routes-table-row-routes-cell-decision-tooltip-text",WEBUX_CELL_SINGLE:"im-routes-wux-datagrid-cell-single",WEBUX_CELL_MULTI:"im-routes-wux-datagrid-cell-multi"}},TREELIST:{CELLHEIGHT:32,GRID:{allowUnsafeHTMLContent:!1,height:"100%",apiVersion:2,defaultCellHeight:26,headersDimensions:{width:void 0,height:26},useTransparentScroller:!1,useNativeScroller:!1,useAsyncPreExpand:!0,resize:{columns:!0,rows:!1},selection:{unselectAllOnEmptyArea:!0,toggle:!1,canMultiSelect:!0,enableListSelection:!0,renderingMode:"adaptive"},columns:[{dataIndex:"tree",isHidden:!0,isSortable:!1},{dataIndex:"status",width:55,isDraggable:!1,text:"",isSortable:!1},{width:37,dataIndex:"decisionStatus",isDraggable:!1,text:"",isSortable:!1},{width:"auto",dataIndex:"reviewer",isDraggable:!1,text:f.routes.columns.reviewer,isSortable:!1},{width:"auto",dataIndex:"date",isDraggable:!1,text:f.routes.columns.date,isSortable:!1},{width:"auto",dataIndex:"reason",isDraggable:!1,text:f.routes.columns.reason,isSortable:!1},{width:"auto",dataIndex:"attachments",isDraggable:!1,text:f.routes.columns.attachments,isSortable:!1}]}}};return e.extend({name:"DS/IssueComponents/routes/Routes",tagName:"div",className:"im-routes-component",_logger:null,domEvents:{},defaultOptions:{ids:[],states:["Create","Assign","Active","Review","Closed"]},setup:function(e){var t=this;p.start(t.name+" setup"),t._parent(e),t._logger=n.getLogger(t.name),t.elements={},t._tooltips=[],t._deferred={},t.isLoaded=new s(function(e,s){t._deferred.resolve=e,t._deferred.reject=s}),t.physicalId=e.physicalId,t.order="descending",t.routes=null,t.treeLists=null,t.isEmpty=!1,p.end(t.name+" setup")},render:function(){p.start(this.name+" render");var e=this.elements.tableContainer=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_CONTAINER+" "+h.CSS.ELEMENTS.SCROLLCONTENT});e.inject(this.container);var s=this.elements.tableHeader=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_HEADER});s.inject(e),t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_HEADER_STATES,html:f.routes.header.states,title:f.routes.header.states}).inject(s),t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_HEADER_ROUTES,html:f.routes.header.routes}).inject(s),(this.elements.tableRowsContainer=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROWS_CONTAINER})).inject(e);var n=this.elements.scrollContainer=t.createElement("div",{class:h.CSS.ELEMENTS.SCROLLCONTAINER}).inject(this.container);return this._scroller=new a({element:e}).inject(n),this.refresh(this.physicalId),this},refresh:function(e){var s=this;return s.physicalId=e,s.setOption("physicalId",e),u.routes.retrieve({data:{objects:[{physicalId:e}]}}).then(function(e){if(s.reset(),Array.isArray(e.results)&&1===e.results.length){var n=s.routes=e.results[0].body,a={create:[],assign:[],active:[],review:[],closed:[]};s.treeLists={create:null,assign:null,active:null,review:null,closed:null};var r=d.get("maturityGraph");n.history.forEach(function(e){a[e.from.toLowerCase()].push(e)}),Object.keys(a).forEach(function(e){a[e]=a[e].sort(function(e,t){var n=0;if(e.date)if(t.date){n=new Date(e.date)-new Date(t.date)}else n=1;else n=-1;return n*("ascending"===s.order?1:-1)}),a[e].forEach(function(e){e.decisions=e.decisions.sort(function(e,t){var n=0;if(e.date)if(t.date){n=new Date(e.date)-new Date(t.date)}else n=1;else n=-1;return n*("ascending"===s.order?1:-1)})})}),n.current&&n.current.from&&("ascending"===s.order?a[n.current.from.toLowerCase()].push(n.current):a[n.current.from.toLowerCase()].unshift(n.current)),s.isEmpty=Object.keys(a).every(function(e){return 0===a[e].length});var l=Object.keys(a);"ascending"!==s.order&&(l=l.reverse()),l.forEach(function(e){var l=a[e];if(l.length>0){var c=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW});c.setData("state",e),c.inject(s.elements.tableRowsContainer);var d=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_STATES_CELL});d.inject(c);var u=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase(),m=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_STATES_CELL_STATE_BLOCK+" "+h.CSS.ELEMENTS["TABLE_ROW_STATES_CELL_STATE_BLOCK_"+e.toUpperCase()]+" "+h.CSS.ELEMENTS.TABLE_ROW_STATES_CELL_STATE_BLOCK_CURRENT,html:r[u]});m.inject(d),m.setStyle("order","ascending"===s.order?1:3);var p=t.createElement("span",{class:"ascending"===s.order?h.CSS.ELEMENTS.TABLE_ROW_STATES_CELL_ARROW_ASC:h.CSS.ELEMENTS.TABLE_ROW_STATES_CELL_ARROW_DESC});p.inject(d),p.setStyle("order",2);var g=h.STATES_ORDER[h.STATES[e.toUpperCase()]+1].toLowerCase(),v=g.substring(0,1).toUpperCase()+g.substring(1).toLowerCase(),b=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_STATES_CELL_STATE_BLOCK+" "+h.CSS.ELEMENTS["TABLE_ROW_STATES_CELL_STATE_BLOCK_"+g.toUpperCase()],html:r[v]});b.inject(d),b.setStyle("order","ascending"===s.order?3:1);var C=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL});C.inject(c);var y=t.clone(h.TREELIST.GRID);y.id="im-routes-component-treelist-"+e;var I=l.reduce(function(e,t){return t.decisions.length>e&&(e=t.decisions.length),e},1);y.defaultCellHeight=h.TREELIST.CELLHEIGHT*I,y.columns=s._customizeColumnRendering(y.columns);var E=new i(y);E.options.shouldDisplayTooltip=function(e){if(!e.isHeader){var t="";if("status"==e.dataIndex)switch(e.nodeModel.options.grid.status){case"inProgress":t=f.routes.status.inProgress;break;case"approved":t=f.routes.status.approved;break;case"rejected":t=f.routes.status.rejected}return{longHelp:t}}},E.onNodeClick(function(){Object.keys(s.treeLists).forEach(function(e){null!==s.treeLists[e]&&s.treeLists[e]!==E&&s.treeLists[e].getManager().unselectAll()})}),E.inject(C),l.forEach(function(e){var s={id:e.physicalId,grid:t.clone(e)};s.grid.issueId=n.physicalId;var i=new o(s);E.addRoot(i)}),c.setStyle("height",(l.length*I+1)*h.TREELIST.CELLHEIGHT+20),E.elements.container.setStyle("height","100%"),s.treeLists[e]=E}})}}).then(function(){s.resize(),s.dispatchEvent("onReady")}).catch(function(e){s.dispatchEvent("onFailure",e)})},resize:function(){},reset:function(){this.elements.tableRowsContainer.empty();try{this._tooltips.forEach(function(e){e.destroy()})}catch(e){}this._tooltips=[]},destroy:function(){this.reset()},selectRoute:function(e){var t=this;Object.keys(t.treeLists).forEach(function(e){null!==t.treeLists[e]&&t.treeLists[e].getManager().unselectAll()});var s=t.treeLists[e.from.toLowerCase()];null!=s&&s.getRoots().forEach(function(t){t.options.id===e.physicalId&&(t.highlight(),t.select())})},_customizeColumnRendering:function(e){var s=this,n=t.clone(e);return n.forEach(function(e){switch(e.dataIndex){case"status":e.onCellRequest=s._columnRenderer.status.bind(s);break;case"decisionStatus":e.onCellRequest=s._columnRenderer.decisionStatus.bind(s);break;case"reviewer":e.onCellRequest=s._columnRenderer.reviewer.bind(s);break;case"date":e.onCellRequest=s._columnRenderer.date.bind(s);break;case"reason":e.onCellRequest=s._columnRenderer.reason.bind(s);break;case"attachments":e.onCellRequest=s._columnRenderer.attachments.bind(s)}}),n},_columnRenderer:{status:function(e){if(!e.isHeader){var s=e.nodeModel.options.grid,n=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_STATUS}),i=h.CSS.ELEMENTS["ICON_"+s.status.toUpperCase()];t.createElement("div",{class:i}).inject(n),e.cellView.getContent().addClassName(h.CSS.ELEMENTS.WEBUX_CELL_SINGLE),e.cellView.getContent().setContent(n)}},decisionStatus:function(e){if(!e.isHeader){var s=e.nodeModel.options.grid,n=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_MULTI});s.decisions.forEach(function(i){e.cellView.getContent().addClassName(h.CSS.ELEMENTS.WEBUX_CELL_MULTI);var o=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_DECISION_ROW}),a=Math.floor(1/s.decisions.length*100);o.setStyle("height",a+"%"),o.inject(n);var r=h.CSS.ELEMENTS["ICON_"+i.status.toUpperCase()];t.createElement("span",{class:r}).inject(o)}),e.cellView.getContent().setContent(n)}},reviewer:function(e){var s=this;if(!e.isHeader){var n=e.nodeModel.options.grid,i=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_MULTI});n.decisions.forEach(function(o){e.cellView.getContent().addClassName(h.CSS.ELEMENTS.WEBUX_CELL_MULTI);var a=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_DECISION_ROW}),l=Math.floor(1/n.decisions.length*100);a.setStyle("height",l+"%"),a.inject(i);var c=o.reviewer.fullName,d=t.createElement("div",{class:h.CSS.ELEMENTS.CELL_DECISION_TEXT,html:c});d.inject(a),s._tooltips.push(new r({position:"bottom",target:d,body:t.createElement("span",{class:h.CSS.ELEMENTS.CELL_DECISION_TOOLTIP_TEXT,html:c})}))}),e.cellView.getContent().setContent(i)}},date:function(e){var s=this;if(!e.isHeader){var n=e.nodeModel.options.grid,i=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_MULTI});n.decisions.forEach(function(o){e.cellView.getContent().addClassName(h.CSS.ELEMENTS.WEBUX_CELL_MULTI);var a=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_DECISION_ROW}),l=Math.floor(1/n.decisions.length*100);a.setStyle("height",l+"%"),a.inject(i);var c=o.date?new Date(o.date).toLocaleString(d.get("widget").lang):"",u=t.createElement("div",{class:h.CSS.ELEMENTS.CELL_DECISION_TEXT,html:c});u.inject(a),s._tooltips.push(new r({position:"bottom",target:u,body:t.createElement("span",{class:h.CSS.ELEMENTS.CELL_DECISION_TOOLTIP_TEXT,html:c})}))}),e.cellView.getContent().setContent(i)}},reason:function(e){var s=this;if(!e.isHeader){var n=e.nodeModel.options.grid,i=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_MULTI});n.decisions.forEach(function(o){e.cellView.getContent().addClassName(h.CSS.ELEMENTS.WEBUX_CELL_MULTI);var a=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_DECISION_ROW}),l=Math.floor(1/n.decisions.length*100);a.setStyle("height",l+"%"),a.inject(i);var d=o.reason||o.comment,u=t.createElement("div",{class:h.CSS.ELEMENTS.CELL_DECISION_TEXT,html:c.getTextFromHTML(d)});u.inject(a),s._tooltips.push(new r({position:"bottom",target:u,body:t.createElement("span",{class:h.CSS.ELEMENTS.CELL_DECISION_TOOLTIP_TEXT,html:c.getTextFromHTML(d)})}))}),e.cellView.getContent().setContent(i)}},attachments:function(e){if(!e.isHeader){var s=e.nodeModel.options.grid,n=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_MULTI});e.cellView.getContent().addClassName(h.CSS.ELEMENTS.WEBUX_CELL_MULTI);var i=t.createElement("div",{class:h.CSS.ELEMENTS.TABLE_ROW_ROUTES_CELL_DECISION_ROW}),o=Math.floor(1/s.decisions.length*100);i.setStyle("height",o+"%"),i.inject(n);var a=t.createElement("span",{class:"fonticon fonticon-popup"}),r=t.createElement("div",{class:h.CSS.ELEMENTS.CELL_DECISION_TEXT+" clickable",html:a});r.inject(i),r.addEventListener("click",function(){l.getCommand("AttachmentManager").selectedObject={physicalId:s.issueId,title:f.replace(f.routes.attachmentsManagerTitle,{fromState:f.maturity[s.from.toLowerCase()],toState:f.maturity[s.approveTo.toLowerCase()]})},l.getCommand("AttachmentManager").begin()}),e.cellView.getContent().setContent(n)}}}})}),define("DS/IssueComponents/create/AutoComplete",["UWA/Core","DS/Utilities/Dom","DS/Controls/Abstract","DS/Controls/SelectionChips","DS/Controls/LineEditor","DS/Controls/Popup","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Core/PointerEvents"],function(e,t,s,n,i,o,a,r,l,c){"use strict";var d=[{text:"Text",dataIndex:"tree",autoRowHeightFlag:!0}];return s.inherit({name:"autoComplete",publishedProperties:{placeholder:{defaultValue:"",type:"string"},selectedValues:{defaultValue:[],type:"array"},rangeValues:{defaultValue:[],type:"array"},dataType:{defaultValue:"string",type:"string"}},buildView:function(e){this.elements.container.addClassName("wux-controls-autoComplete"),this.selectedItems=[],this._nbItemsToDisplay=-1},_postBuildView:function(){if(void 0===this._editor){var e="";"integer"===this.dataType?e="[0-9]+":"real"===this.dataType&&(e="[0-9]+|([0-9]+.[0-9]+)"),this._editor=new i({placeholder:this.placeholder,displayStyle:"text",fireOnlyFromUIInteractionFlag:!0,pattern:e}),this._editor.getContent().setStyle("width","100%"),this._editor.getContent().addClassName("iss-controls-autoComplete-editor")}(function(){this._selectionChips=new n({fireOnlyFromUIInteractionFlag:!0}),this._selectionChips.getContent().addClassName("wux-controls-autoComplete-selectionChips");var e=this;t.addEventOnElement(this,this._selectionChips,"onPostRemove",function(t){if(t.options.chips.length>1)e.selectedItems=[];else for(var s=t.options.chips[0].chipOptions.value,n=0;n<e.selectedItems.length;n++)if(e.selectedItems[n].value===s){e.selectedItems.splice(n,1);break}e.fire("change")}),t.addEventOnElement(this,this._selectionChips,"change",function(e){e.stopPropagation()})}).call(this),this._editor._myInput.style.width="70%",this._editor.displayStyle="lite",this._editor.displayStyle="lite",this._selectionChips.addLastWidget(this._editor),this._selectionChips.inject(this.elements.container),void 0!==this.selectedValues&&this.selectedValues.length>0&&this._addChips(this.selectedValues)},_showPopup:function(){if(!this.elements.popup){var t={target:this,position:"bottom",offset:{x:0,y:4},className:"wux-controls-autoComplete-popup wux-controls-popup",constraint:"screen",alignment:"near",overlap:!1,trigger:"",overlapCallback:function(e){}};if(this.elements.popup=new o(t),this._dataGridViewContainer=new e.Element("div"),this.elements.popup.setBody(this._dataGridViewContainer),this._dataGridViewContainer.addClassName("wux-controls-autoComplete-dataGridViewContainer"),this._model=new r,this.rangeValues.length>0)for(var s=0;s<this.rangeValues.length;s++){this._model.prepareUpdate();var n=new l({label:this.rangeValues[s],id:this.rangeValues[s]});this._model.addRoot(n),this._model.pushUpdate()}var i={treeDocument:this._model,columns:d,cellSelection:"none",selectionBehavior:{toggle:!0},showAlternateBackgroundFlag:!1,showRowBorderFlag:!0};this._dataGridView=new a(i),this._dataGridView.layout.columnsHeader=!1,this._dataGridView.layout.rowsHeader=!1,this._dataGridView.getContent().addClassName("wux-controls-autoComplete-dataGridView"),this._dataGridView.inject(this._dataGridViewContainer);var c=this;this._dataGridView.getTreeDocument().getXSO().onAdd(function(e){if(c._dataGridView.unselectAll(),c._hidePopup(),!c._selectionChips.getAllChipsAsLabels().includes(e.options.label)){var t=[];t.push(e.options.label),c._addChips(t)}c._editor._myInput.value="",!c.rangeValues.length>0&&c._editor._myInput.focus()})}this._updateNbDisplayedElements(this),this._updatePopupHeight(this);var u=this.elements.container.getBoundingClientRect().width;this._dataGridViewContainer.style.width=u+"px",this.elements.popup.visibleFlag=!0,this.fire("show")},_addChips:function(e){var t=this;e.forEach(function(e){e=e.toString(),t._selectionChips.addChip({label:e,value:e}),t.selectedItems.push({label:e,value:e}),t.fire("change")})},_updateNbDisplayedElements:function(e){var t=0;this._model.processDescendants({onlyVisibleNodes:!0,processNode:function(e){t++}}),this._nbItemsToDisplay=t<10?t:10},_updatePopupHeight:function(){if(this._dataGridViewContainer){var e=27*this._nbItemsToDisplay+"px";this._nbItemsToDisplay<10&&0!=this._nbItemsToDisplay?this._dataGridViewContainer.style.height!==e&&(this._dataGridViewContainer.style.height=e):0==this._nbItemsToDisplay?this._dataGridViewContainer.style.height="27px":(e=27*this._nbItemsToDisplay+"px",this._dataGridViewContainer.style.height=e),null!=this.elements.popup&&this.elements.popup._updateView()}},_hidePopup:function(){this.elements.popup&&this.elements.popup.visibleFlag&&(this.elements.popup.visibleFlag=!1,this.fire("hide"))},handleEvents:function(){var e=this;t.addEventOnElement(this,this._editor,"change",function(e){e.stopPropagation()}),t.addEventOnElement(this,this._editor._myInput,"focus",function(t){e.rangeValues.length>0&&e._showPopup()}),t.addEventOnElement(this,this._editor._myInput,"input",function(t){if(""==e._editor._myInput.value)!e.rangeValues.length>0&&e._hidePopup();else if(e._editor.validFlag){if(e._showPopup(),!e.rangeValues.length>0){e._model.empty();var s=new l({label:e._editor._myInput.value,id:e._editor._myInput.value});e._model.addRoot(s)}}else e._hidePopup()}),t.addEventOnElement(this,this._editor._myInput,"keyup",function(t){if(13===t.keyCode)if(e.rangeValues.length>0&&e.rangeValues.includes(e._editor._myInput.value)||!e.rangeValues.length>0&&e._editor.validFlag){if(!e._selectionChips.getAllChipsAsLabels().includes(e._editor._myInput.value)){var s=[];s.push(e._editor._myInput.value),e._addChips(s)}e._editor._myInput.value="",e._hidePopup(),e._editor._myInput.focus()}else e._editor._myInput.value=""}),t.addEventOnElement(this,document,c.POINTERDOWN,function(t){e.elements.container&&e.elements.popup&&(e.elements.container.contains(event.target)||e.elements.popup.elements.container.contains(event.target)||e._hidePopup())})}})}),define("DS/IssueComponents/search/PeopleSearchUI",["DS/SearchWidget/componentUI/SearchWidgetUI","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t){"use strict";var s="js-selected";return e.extend({init:function(e){var t=this;t._parent(e);var n=t.searchInput.options.events.onKeyDown;t.searchInput.removeEvent("onKeyDown"),t.searchInput.addEvent("onKeyDown",function(e){if(13===e.which){var i=t.filterAreaContent.getElement("."+s);if(null!==i)t._elementIsButton(i)?(t.selectNextOrPreviousResult("previous"),i.click(),t.selectNextOrPreviousResult("next")):t.__setInput(i),e.stopPropagation();else t.hideLoadingGif(),t.ClearDialog(),t.dispatchEvent("onExpressSearch",t.searchInput.getValue()),""!=t.searchInput.getValue()&&e.stopPropagation()}else 38===e.which||40===e.which?n(e):(t.hideLoadingGif(),t.ClearDialog(),n(e))}),t._raiseError=t.raiseError,t.raiseError=function(e){t.customRaiseError(e)}},customRaiseError:function(e){"SW_WarningNotFound"===e.customClass&&this.searchInput.getValue().contains(";")&&(e.code="info",e.message=t.search.info.expressSearch),this._raiseError(e)}})}),define("DS/IssueComponents/team/MembersDataGridViewToolbar",["i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e){var t=Object.create(null);return t.toolbar=null,t.propagate={menu:[{type:"PushItem",title:e.team.toolbar.propagateCoowners,action:{module:"DS/IssueComponents/team/MembersDataGridLayout",func:"propagateCoowners"},tooltip:e.team.toolbar.propagateCoowners},{type:"PushItem",title:e.team.toolbar.propagateAssignees,action:{module:"DS/IssueComponents/team/MembersDataGridLayout",func:"propagateAssignees"},tooltip:e.team.toolbar.propagateAssignees},{type:"PushItem",title:e.team.toolbar.propagateContributors,action:{module:"DS/IssueComponents/team/MembersDataGridLayout",func:"propagateContributors"},tooltip:e.team.toolbar.propagateContributors},{type:"PushItem",title:e.team.toolbar.propagateInformedUsers,action:{module:"DS/IssueComponents/team/MembersDataGridLayout",func:"propagateInformedUsers"},tooltip:e.team.toolbar.propagateInformedUsers}]},t.writetoolbarDefinition=function(){var t={entries:[{id:"assigntoself",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"user-ok",fontIconFamily:1},tooltip:e.team.toolbar.assignToSelf,position:"far",category:"add",action:{module:"DS/IssueComponents/team/AddMembersLayout",func:"assignToSelf"}}},{id:"add",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"user-add",fontIconFamily:1},tooltip:e.team.toolbar.addMember,position:"far",category:"add",action:{module:"DS/IssueComponents/team/AddMembersLayout",func:"launchAddMemberPanel"}}},{id:"remove",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"remove",fontIconFamily:1},tooltip:e.team.toolbar.remove,position:"far",disabled:!0,category:"modify",action:{module:"DS/IssueComponents/team/MembersDataGridLayout",func:"removeHandler"}}},{id:"filter",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"filter",fontIconFamily:1},tooltip:e.team.toolbar.filter,position:"far",category:"modify",action:{module:"DS/IssueComponents/team/MembersFilterLayout",func:"launchFilterMemberPanel"}}},{id:"propagate",dataElements:{typeRepresentation:"sortingdropdown",icon:{iconName:"propagate",fontIconFamily:1},tooltip:e.team.menu.propagate,value:this.propagate},position:"far",category:"modify"}]};return JSON.stringify(t)},t}),define("DS/IssueComponents/konami/Konami",["UWA/Core","DS/WebappsUtils/WebappsUtils","css!DS/IssueComponents/IssueComponents.css"],function(e,t){"use strict";return{kojima:function(){this.onKonamiCode(function(){new Audio(t.getWebappsAssetUrl("IssueComponents","others/kojima.png")).play()})},onKonamiCode:function(e){var t="",s="38384040373937396665";document.addEventListener("keydown",function(n){if((t+=n.keyCode.toString())===s)return e();s.indexOf(t)&&(t=n.keyCode.toString())})}}}),define("DS/IssueComponents/open/Open",["UWA/Class/Promise","UWA/Core","UWA/Utils/InterCom","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/WAFData/WAFData","DS/IssueCommon/utils/Selector","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/LocalStorage","DS/IssueServices/utils/Performance","DS/IssueServices/utils/Views","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r,l,c,d,u,m){"use strict";var p="DS/IssueComponents/open/Open",f=6e5,h="ENXISSU_AP",g="ENX3DIR_AP",v={expand:function(s){var n=r.get("widget");return new e(function(e,i){var a={method:"POST"};a.headers={Accept:"application/json","Accept-Language":n.lang,"Content-Type":"application/json",SecurityContext:"ctx::"+l.getSecurityContext()},a.timeout=f,a.onComplete=function(s){var n=t.is(s,"string")?JSON.parse(s):s;e(n)},a.onFailure=function(e){i(e)};var r=s.reduce(function(e,t){return e.push([t]),e},[]),c={label:n.name+"-"+l.getUserName()+"-"+Date.now(),authored:!1,root_path_physicalid:r,intent:"explore_2D","q.iterative_filter_query_bo":'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"',no_type_filter_rel:["XCADBaseDependency"],include_param_Attributes:!0,paths:r,level:"-1",source:"cstorage"};a.data=JSON.stringify(c),o.authenticatedRequest(l.assembleURLFor3DSpace("/resources/enopad/lwc/expand"),a)})},generateFileContent:function(e,s){var n={version:"2.2",results:[],structures:[],viewpoint:[]};return this.expand(e).then(function(i){var o=i.results,a={},r={};if("ENOUSWC_AP"==s)for(var l=0;l<o.length;l++){if(o[l]&&Array.isArray(o[l].attributes)){for(var c=o[l].attributes,d="",u="",m="",p=0;p<c.length;p++)""===d&&"did"===c[p].name&&(d=c[p].value),""===u&&"physicalid"===c[p].name&&(u=c[p].value),""===m&&"ds6w:cadMaster"===c[p].name&&(m=c[p].value);""!==d&&(a[d]={did:d,physicalId:u},e.find(function(e){e==u&&n.results.push({id:d,phid:u,CADOrigin:m})}))}if(o[l]&&Array.isArray(o[l].path))for(var f=o[l].path,h=null,g=0;g<f.length;g++)null===h&&(t.is(r[f[g]],"object")?h=r[f[g]]:(r[f[g]]={},h=r[f[g]]))}else for(l=0;l<o.length;l++){if(o[l]&&Array.isArray(o[l].attributes)){for(c=o[l].attributes,d="",u="",p=0;p<c.length;p++)""===d&&"did"===c[p].name&&(d=c[p].value),""===u&&"physicalid"===c[p].name&&(u=c[p].value);""!==d&&(a[d]={did:d,physicalId:u},n.results.push({id:d,phid:u,CADOrigin:"CATIAV5"}))}if(o[l]&&Array.isArray(o[l].path))for(f=o[l].path,h=null,g=0;g<f.length;g++)null===h?t.is(r[f[g]],"object")?h=r[f[g]]:(r[f[g]]={},h=r[f[g]]):t.is(h[f[g]],"object")?h=h[f[g]]:(h[f[g]]={},h=h[f[g]])}var v=function(e,t){for(var s in e)if(e.hasOwnProperty(s)){var n=[],i={id:s,show:!0,children:n,select:!0};t.push(i),v(e[s],n)}},b=[];v(r,b);for(var C=0;C<b.length;C++)n.structures.push({structure:b[C]});return n},function(e){throw new Error("An error occurred during the expand "+e)})}};return{socket:"",compass:null,setTypesCallbackForOFW:function(e,n){d.start(p+" setTypesCallbackForOFW");var o=r.get("widget"),c=u.getCompassPubSub();if(!1===n.setTypesCallbackSubscribe&&(this.socket="compass_"+o.id,this.compass=new s.Socket(this.socket),this.compass.subscribeServer("com.ds.compass",window.parent),c.subscribe("setTypesCallback",function(e){d.start(p+" setTypesCallbackForOFW setTypesCallback");var t=r.get("widget");if(e.widgetId===t.id){var s=[];s=e.data&&Array.isArray(e.data.items)?e.data.items.reduce(function(e,t){return e.push(t.objectId),e},[]):a.getSelection().physicalIds,Array.isArray(s)&&s.length>0?v.generateFileContent(s,e.appId).then(function(t){var s={appId:e.appId,widgetId:e.widgetId,fileName:"-file",fileContent:JSON.stringify(t)};c.publish("launchApp",s)},function(){i.displayNotification({msg:m.open.error,eventID:"error"})}):c.publish("launchApp",{appId:e.appId,widgetId:e.widgetId}),d.end(p+" setTypesCallbackForOFW setTypesCallback")}})),e.length>0){var f=e.map(function(e){if(o.name===h){var s="",n="",i="";return t.is(e.options,"object")?(s=e.options.physicalId,n=e.options.type,i=e.options.title+" ("+e.options.name+")"):(s=e.physicalId,n=e.type,i=e.title+" ("+e.name+")"),{envId:l.getTenant(),serviceId:"3DSpace",contextId:o.id,objectId:s,objectType:n,displayName:i}}return o.name===g?{envId:l.getTenant(),serviceId:"3DSpace",contextId:o.id,objectId:e.id,objectType:e.type,displayName:e.title+" ("+e.name+")"}:{}});this.compass.dispatchEvent("onSetX3DContent",{protocol:"3DXContent",version:"1.1",source:o.name,widgetId:o.id,data:{items:f}},this.socket),c.publish("setTypes",{widgetId:r.get("widget").id})}else this.compass.dispatchEvent("onResetX3DContent",{},this.socket),c.publish("resetTypes");d.end(p+" setTypesCallbackForOFW")},modal:null,openWith:function(){var e=this,s=r.get("widget"),n="";s.name===h?n="DS/IssueManagement/components/ContextualMenu":s.name===g&&(n="DS/Issue3DReview/components/ContextualMenu"),require(["UWA/Class/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Input/Toggle","DS/ENOFloatingPanel/ENOFloatingPanel",n],function(n,i,o,a,r,l){l.getContextualMenu().then(function(e){for(var t=0;t<e.length;t++)if("Open"===e[t].name)return e[t];return{submenu:[]}}).then(function(n){var l=c.getItem("open"),d={};d=t.is(l,"object")?{type:l.type?l.type:"",app:l.app?l.app:""}:{type:"",app:""};var u=null,p=null,f=null,h=null,g=null,v=null,b=null,C={},y=function(e,s){null!==g&&t.is(e,"object")&&Array.isArray(e.submenu)&&0!==e.submenu.length&&(g.remove(),C={},e.submenu.forEach(function(e){e&&t.is(e.name,"string")&&(g.add({value:e.name,label:e.title,selected:e.name===s}),C[e.name]=e.action.callback,e.name===s&&v.enable())}))};n.submenu.forEach(function(e){"contexts"===e.name&&((u=new a({className:"primary contexts-chooser",name:"typeChooser",value:"contexts",label:"",checked:"contexts"===d.type,events:{onChange:function(){d.type="contexts",c.setItem("open",d),y(e,d.app)}}})).elements.label.setContent([t.createElement("i",{class:"where-to-open-icon where-to-open-contexts wux-ui-3ds wux-ui-3ds-3d-object"}),m.open.labels.contexts]),"contexts"===d.type&&(b=e)),"reportedAgainst"===e.name&&((p=new a({className:"primary reported-against-chooser",name:"typeChooser",value:"reportedAgainst",label:"",checked:"reportedAgainst"===d.type,events:{onChange:function(){d.type="reportedAgainst",c.setItem("open",d),y(e,d.app)}}})).elements.label.setContent([t.createElement("i",{class:"where-to-open-icon where-to-open-reported-against wux-ui-3ds wux-ui-3ds-location"}),m.open.labels.reportedAgainst]),"reportedAgainst"===d.type&&(b=e)),"resolvedBy"===e.name&&((f=new a({className:"primary resolved-by-chooser",name:"typeChooser",value:"resolvedBy",label:"",checked:"resolvedBy"===d.type,events:{onChange:function(){d.type="resolvedBy",c.setItem("open",d),y(e,d.app)}}})).elements.label.setContent([t.createElement("i",{class:"where-to-open-icon where-to-open-contexts-resolved-by fonticon fonticon-docs"}),m.open.labels.resolvedBy]),"resolvedBy"===d.type&&(b=e)),"resolvedItems"===e.name&&((h=new a({className:"primary resolved-items-chooser",name:"typeChooser",value:"resolvedItems",label:"",checked:"resolvedItems"===d.type,events:{onChange:function(){d.type="resolvedItems",c.setItem("open",d),y(e,d.app)}}})).elements.label.setContent([t.createElement("i",{class:"where-to-open-icon where-to-open-contexts-resolved-items fonticon fonticon-docs"}),m.open.labels.resolvedItems]),"resolvedItems"===d.type&&(b=e))});var I=null;n.submenu.length>0?(g=new o({custom:!1,multiple:!1,placeholder:m.open.labels.placeholder,options:[],events:{onChange:function(){var e=this.getValue();e.length>0&&""===e[e.length-1]?v.disable():(d.app=e[e.length-1],c.setItem("open",d),v.enable())}}}),I=t.createElement("div",{html:[u,p,h,f,g]})):I=t.createElement("div",{class:"nothing-to-open",html:t.createElement("span",{class:"nothing-to-open-label",html:m.open.labels.nothing})}),e.modal=new r({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"open-issues-dialog",title:m.open.dialog.title,header:null,body:I,footer:[v=new i({value:m.open.dialog.open,className:"primary",events:{onClick:function(){var s=g.getValue();s.length>0&&s[s.length-1]&&t.is(C[s[s.length-1]],"function")&&C[s[s.length-1]].call(),e.modal.destroy()}},disabled:!0}),new i({value:m.open.dialog.cancel,events:{onClick:function(){e.modal.destroy()}}})],events:{onClose:function(){this.destroy()}}}).inject(s.body),null!==b&&y(b,d.app)})})}}}),define("DS/IssueComponents/external/3DMarkup",[],function(){"use strict";var e={WIDTH:700,HEIGHT:800},t="Issue";return{execute:function(s){require(["DS/TransientWidget/TransientWidget","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices"],function(n,i,o){var a=i.get("widget"),r=[];if(s.forEach(function(e){r.push({envId:o.getTenant(),serviceId:"3DSpace",contextId:a.id,objectId:e,objectType:t,displayName:""})}),r.length>0){var l={protocol:"3DXContent",version:"1.1",source:i.get("widget").name,data:{items:r}},c={mode:"panel",height:e.HEIGHT,width:e.WIDTH};n.showWidget("ENOR3D_AP","",{X3DContentId:JSON.stringify(l),x3dPlatformId:o.getTenant()},c)}})}}}),define("DS/IssueComponents/users/Users",["UWA/Class/Promise","UWA/Core","DS/UIKIT/Popover","DS/UIKIT/Spinner","DS/WAFData/WAFData","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/SwymServices","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r,l){"use strict";var c=function(e){return t.createElement("div",{class:"issue-user-content",html:[{class:"issue-user-image",html:e.image},{class:"issue-user-info",html:e.info}]})},d=function(e){return t.createElement("div",{class:"issue-user-image-sub",html:t.createElement("img",{class:"issue-user-image-sub-img img-circle",src:a.getUserImage(e.user)})})},u=function(e){return t.createElement("div",{class:"issue-user-info-sub",html:[{class:"issue-user-info-sub-id",html:[{class:"issue-user-info-sub-name",html:e.name},{class:"issue-user-info-sub-user",html:"("+e.user+")"}]},{class:"issue-user-info-sub-email",html:e.email},{class:"issue-user-info-sub-address",html:[{class:"issue-user-info-sub-address-city",html:e.city},{class:"issue-user-info-sub-address-city",html:e.country}]},{class:"issue-user-info-sub-more",html:l.users.more,events:{click:function(){a.getUserProfile(e.user)}}}]})};return{create:function(e){for(var s,n=t.createElement("div",{class:"issue-users-list"}),i=0;i<e.users.length;i++)"group"===e.users[i].type?t.createElement("div",{class:"user-group wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-users-group"}).inject(n):(s=e.users[i],t.createElement("div",{class:"issue-user-image",html:a.getUserImageElement(s,!0,{cssClass:"issue-user-image-img",Title:""})})).inject(n);return n},display:function(e){var i=new n,o=t.createElement("div",{class:"issue-user-info-ph",html:i}),a=d({user:e.user}),l=null;(l=new s({className:"issue-user-popover",target:e.target,body:c({image:a,info:o})})).show(),l.updatePosition(),i.show(),r.users.retrieve({user:e.user}).then(function(e){i.destroy(),o.parentNode.replaceChild(u(e),o),l.updatePosition()})},open:function(e){var t=e.user;a.getUserProfile(t)}}}),define("DS/IssueComponents/create/Form",["UWA/Controls/Form"],function(e){"use strict";return e.extend({init:function(e){this.autocompletes=[],this.fields=e.fields,this.events={onInvalid:function(){}},this._parent(e)},unvalidate:function(){return this.getContent().getElements(".has-error").forEach(function(e){e.removeClassName("has-error")}),this},validate:function(e,t){var s=[];return this.unvalidate(),this.fields.forEach(function(e){switch(e.name){case"button":case"submit":break;case"buttonGroup":if("radio"===e.type)if(e.requiredFlag&&!e.disabled)!(e.value.length>1)&&s.push(e);break;case"checkbox":e.requiredFlag&&!1===e.checked&&!e.disabled&&s.push(e);break;case"lineEditor":case"editor":case"email":case"url":case"tel":e.requiredFlag&&""===e.value&&!e.disabled&&s.push(e);break;case"autoComplete":!e.requiredFlag||""!==e.value&&void 0!==e.value||e.disabled||s.push(e);break;default:e.requiredFlag&&""===e.value&&!e.disabled&&s.push(e)}}),this.dispatchEvent(0===s.length?"onValid":"onInvalid"),0===s.length}})}),define("DS/IssueComponents/team/AddMembersView",["UWA/Class/View","i18n!DS/IssueComponents/assets/nls/IssueComponents","UWA/Core"],function(e,t,s){return e.extend({name:"iss-add-member",tagName:"div",className:"iss-add-member",setup:function(){this.template='                                                <div class="'+this.getClassNames("-container")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-body")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t<table class="add-member-table table">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr class="'+this.getClassNames("-coowner")+'" >\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>'+t.team.addMember.coowner+'</td>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td class="'+this.getClassNames("-coowner-field-container")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-coowner-field")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="fonticon fonticon-search coowner-field-search">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr class="'+this.getClassNames("-assignee")+'" >\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>'+t.team.addMember.assignee+'</td>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td class="'+this.getClassNames("-assignee-field-container")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-assignee-field")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="fonticon fonticon-search assignee-field-search">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr class="'+this.getClassNames("-contributor")+'" >\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>'+t.team.addMember.contributor+'</td>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td class="'+this.getClassNames("-contributor-field-container")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-contributor-field")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="fonticon fonticon-search contributor-field-search">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr class="'+this.getClassNames("-informeduser")+'" >\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>'+t.team.addMember.informedUser+'</td>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td class="'+this.getClassNames("-informedUser-field-container")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-informedUser-field")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="fonticon fonticon-search informedUser-field-search">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </tr>\t\t\t\t\t\t\t\t\t\t\t\t\t\t</table>\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-button")+'">\t\t\t\t\t\t\t\t\t\t\t\t\t</div>                                                </div>'},init:function(e){e=s.clone(e||{},!1),this._parent.call(this,e)},render:function(){this.name,this.cid;this.container.empty(),containerReference=this.container;var e=UWA.createElement("div",{class:"iss-member-view",styles:{height:"10%"}});return e.addContent(this.template),e.inject(containerReference),this},domEvents:{"click .assignee-field-search":function(){this.dispatchEvent("searchMember","Assignee")},"click .coowner-field-search":function(){this.dispatchEvent("searchMember","Coowner")},"click .contributor-field-search":function(){this.dispatchEvent("searchMember","Contributor")},"click .informedUser-field-search":function(){this.dispatchEvent("searchMember","InformedUser")}}})}),define("DS/IssueComponents/utils/Utils",["UWA/Class/Promise","UWA/Controls/Input","UWA/Core","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/WebappsUtils/WebappsUtils","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/ENOCustomAttributeUtils/scripts/CustomAttributeUtils","i18n!DS/IssueCommon/assets/nls/IssueCommon","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,s,n,i,o,a,r,l,c,d,u){"use strict";var m="Issue",p="Create",f="Assign",h="Active",g="Review",v="Closed",b="Private",C="Public",y=["created","modified","estimatedStartDate","estimatedEndDate","actualStartDate","actualEndDate","resolutionDate"];return{getIconByState:function(e,t,s){var n="";if(t!=m&&""!=s)n=r.get3DSpaceUrl()+"/"+s;else switch(e){case p:n=o.getWebappsAssetUrl("IssueCommon","icons/32/states/iconCreateState.png");break;case f:n=o.getWebappsAssetUrl("IssueCommon","icons/32/states/iconAssignState.png");break;case h:n=o.getWebappsAssetUrl("IssueCommon","icons/32/states/iconActiveState.png");break;case g:n=o.getWebappsAssetUrl("IssueCommon","icons/32/states/iconReviewState.png");break;case v:n=o.getWebappsAssetUrl("IssueCommon","icons/32/states/iconClosedState.png")}return n},getColorByState:function(e){var t="";switch(e){case p:t="#9B2C98";break;case f:t="#E03400";break;case h:t="#007DA3";break;case g:t="#018308";break;case v:t="#757575";break;case b:t="#9B2C98";break;case C:t="#018308"}return t},getFormattedDate:function(e,t){for(var s=window.widget.lang,n=y,i=0;i<n.length;i++)isNaN(Date.parse(e[n[i]]))?e[n[i]]="":e[n[i]]=new Date(e[n[i]]).toLocaleString(s,t);return e},getTextFromHTML:function(e){var t=s.createElement("div",{html:e});return t.textContent||t.innerText||""},timeSince:function(e){var t=Math.floor((new Date-e)/1e3),s=Math.floor(t/31536e3);return s>1?d.replace(d.dates.years,{number:s}):(s=Math.floor(t/2592e3))>1?d.replace(d.dates.months,{number:s}):(s=Math.floor(t/86400))>1?d.replace(d.dates.days,{number:s}):(s=Math.floor(t/3600))>1?d.replace(d.dates.hours,{number:s}):(s=Math.floor(t/60))>1?d.replace(d.dates.minutes,{number:s}):d.replace(d.dates.seconds,{number:Math.floor(t>=0?t:0)})},getFilesFromDrop:function(e){var t=[];if(e.dataTransfer.items)for(var s=0;s<e.dataTransfer.items.length;s++)"file"===e.dataTransfer.items[s].kind&&t.push(e.dataTransfer.items[s].getAsFile());else for(var n=0;n<e.dataTransfer.files.length;n++)t.push(e.dataTransfer.files[n]);return t},uploadImages:function(s){var n=this;return new e(function(e){var n=new t.File("Input.File",{visibility:"hidden",styles:{display:"none"}});n.elements.container.setStyle("display","none"),n.elements.input.multiple=void 0===s||s,n.elements.input.accept="image/png, image/jpeg",n.elements.input.addEventListener("change",function(t){n.destroy(),n=null,e(t.target.files)},!1),n.elements.input.addEventListener("click",function(e){e.stopPropagation()}),n.elements.input.click()}).then(function(t){if(0===(t=Array.from(t)).length)return e.reject(new Error("No selected files to be uploaded"));var s=[];return t.forEach(function(e){s.push(n.isImage(e))}),e.all(s)}).then(function(t){return 0===(t=t.reduce(function(e,t){return"success"===t.status?e.push(t.file):i.displayNotification({msg:d.replace(d.images.errorUpload,{name:t.file.name}),eventID:"error"}),e},[])).length?e.reject(new Error("No valid files to be uploaded")):e.resolve(t)})},isImage:function(t){var s=new FileReader;return new e(function(e){s.onload=function(s){var n=s.target.result,i=new Uint8Array(n);255===i[0]&&216===i[1]&&255===i[i.byteLength-2]&&217===i[i.byteLength-1]?e({status:"success",file:t}):137===i[0]&&80===i[1]&&78===i[2]&&71===i[3]?e({status:"success",file:t}):71===i[0]&&73===i[1]&&70===i[2]&&56===i[3]?e({status:"error",file:t}):(66===i[0]&&i[1],e({status:"error",file:t}))},s.readAsArrayBuffer(t)})},readImageURI:function(t){var s=new FileReader;return new e(function(e){s.onload=function(t){e(t.target.result)},s.readAsDataURL(t)})},getDroppableData:function(t){for(var n=this,i={},o=s.is(t.dataTransfer.types.indexOf,"function")?"indexOf":"contains",a="",r=["text/searchitems","text/plain","Text"],l=0;l<r.length&&""===a;l++){var c=t.dataTransfer.types[o](r[l]);(s.is(c,"number")&&c>=0||s.is(c,"boolean")&&!0===c)&&(a=r[l])}var d={};if(""===a)throw new Error("Unknown type in DnD");d=t.dataTransfer.getData(a);try{let t=[];return(i=JSON.parse(d)).data.items.forEach(e=>{e.objectType==m?e.isIssue=!0:t.push(e.objectType)}),t.length>0?new e(function(e){n.getTypesHierarchy(t).then(t=>{i.data.items.forEach(function(e,s){t[e.objectType]&&t[e.objectType].hierarchy.includes(m)&&(e.isIssue=!0)}),e(i)})}):e.resolve(i)}catch(t){i={data:{items:[]}},e.resolve(i)}},setDroppableData:function(e){for(var t=a.get("widget")||window.widget,s={protocol:"3DXContent",version:"2.1",source:t.name,widgetId:t.id,data:{items:[]}},n=0;n<e.length;n++){var i=e[n],o=i.options.id.split(","),l=o[o.length-1];s.data.items.push({envId:r.getTenant(),serviceId:"3DSpace",contextId:"",objectId:l,objectId:i.options.pid?i.options.pid:i.options.id,i3dx:i.options.id.includes("i3dx")?i.options.id:"",objectType:i.options.type,displayName:i.options.name,displayType:i.options.type})}var c="text/plain";try{(window.navigator.userAgent.indexOf("MSIE ")>0||navigator.userAgent.match(/Trident.*rv\:11\./))&&(c="text")}catch(e){}return 0===s.data.items.length?null:{type:c,data:s}},buildCustomViewOptions:function(e,t){e.columns.forEach(e=>{"ContextualMenuColumn"===e.dataIndex&&(e.isOOTBColumn=!0,e.ds6wIndexMapping="contextualMenuColumn")});let s=e.columns.filter(e=>1==e.isOOTBColumn),n=e.custom_view_options;n.dgvHandle=e,n.ootb_columns=[...s],n.dgvDiv=t,n.settings={...n.settings,url:r.get3DSpaceUrl(),securityContext:r.getSecurityContexts().securityContext,isNative:a.get("isNatifEnvironnement")},e.columnDefinitionUpdated=!1},restoreCustomViews:function(e){var t=a.get("widget")||window.widget;if(t.getValue("wux-collectionView-dataGridView")){const s=JSON.parse(t.getValue("wux-collectionView-dataGridView"))[t.id+"_ISUSummaryView"],n=JSON.parse(t.getValue("wux-collectionView-dataGridView"))[t.id+"Template"],i=JSON.parse(t.getValue("wux-collectionView-dataGridView"))[t.id+"_contents"],o=JSON.parse(t.getValue("wux-collectionView-dataGridView"))[e.identifier];let a="";void 0!==o?a=o:("ISUSummaryView"===e.identifier&&(a=s),"ISUTemplateSummaryView"===e.identifier&&(a=n),"ISUContentsView"===e.identifier&&(a=i)),a&&(a.currentCustomViewIdentifier=a.currentCustomViewId?a.currentCustomViewId:"DefaultConfiguration",c.restoreCustomViews(a,e.custom_view_options))}e.columnDefinitionUpdated=!1,e.multiIssuesSelected&&1==e.multiIssuesSelected?e.layout.setColumnVisibleFlag("common",!0):e.multiIssuesSelected&&0==e.multiIssuesSelected&&e.layout.setColumnVisibleFlag("common",!1)},launchCustomViewManager:function(e){e.columns.forEach(e=>{"ContextualMenuColumn"===e.dataIndex&&(e.isOOTBColumn=!0,e.ds6wIndexMapping="contextualMenuColumn")});let t=e.columns.filter(e=>1==e.isOOTBColumn);e.custom_view_options.ootb_columns=t,c.launchCustomViewManager(e.custom_view_options)},applyCustomAttributes:function(e,t,s){c.applyCustomAttributes(e,t,s)},processColumnsVisibility:function(e,t,s){c.processCustomViews(e,t,s)},loadCustomViews:function(e){var t=a.get("widget")||window.widget;if(t.getValue("wux-collectionView-dataGridView")){const s=JSON.parse(t.getValue("wux-collectionView-dataGridView"))[e.identifier];s&&e.loadCustomViews(s.customViews,s.currentCustomViewId)}},refreshOOTBColumnList:function(e){let t=e.columns.filter(e=>1==e.isOOTBColumn);e.custom_view_options.ootb_columns=t},registerCustomEventsOnDGV:function(e){const t=["sortModelChange","columnOrderChange","columnWidthChange","columnVisibleStateChange"];if(!e)return;const n=e;for(let i=0;i<t.length;i++)e.addEventListener(t[i],function(e){n.identifier;const o=n.getCustomViewsManager().getCurrentCustomViewIdentifier(),a=o||"DefaultConfiguration";let r=!1,l=!1,d={};const u={columnWidthChange:void 0,columnVisibleStateChange:void 0};switch(t[i]){case"sortModelChange":n.getCustomViewsManager().getCustomView(a).sortModel=e.dsModel.sortModel,n.getCustomViewsManager().getCustomView(a).columnsSortModel=e.dsModel.sortModel,r=!0;break;case"columnOrderChange":break;case"columnWidthChange":s.is(e.options.columnID)&&(u.columnWidthChange=e.options.columnID),s.is(e.options.columnIDs)&&(d=e.options.columnIDs,l=!0),r=!0;break;case"columnVisibleStateChange":s.is(e.options.columnID)&&(u.columnVisibleStateChange=e.options.columnID),r=!0}!0===r&&(!0===l?c.processSizeAllColumnsToFitCustomData(n.getCustomViewsManager().getCustomViews(),a,n.custom_view_options,d):c.processCustomViews(n.getCustomViewsManager().getCustomViews(),a,n.custom_view_options,u))})},_printPreferences:function(e){var t=a.get("widget")||window.widget;if(t.getValue("wux-collectionView-dataGridView")){JSON.parse(t.getValue("wux-collectionView-dataGridView"))[e.identifier]}},createGhostDrag:function(e,t){var n=s.createElement("div",{class:"issue-ghost-container",html:[s.createElement("div",{class:"issue-ghost-panel",html:[s.createElement("img",{class:"issue-ghost-image",src:e.icons[e.icons.length-1]}),s.createElement("div",{class:"issue-ghost-title",html:e.title+" ("+e.name+")"})]}),s.createElement("span",{class:"issue-ghost-counter",html:t})]});return n.setStyle("transform","translate3d(0,0,0)"),n},template:{getDocuments:function(t){return new e((e,s)=>{require(["DS/IssueAttachmentManager/services/AttachmentServices"],function(s){s.getDocumentsFrom(t).then(function(t){var s=[];return Array.isArray(t.attachments)&&(s=t.attachments.map(function(e){return e.id})),e(s)}).catch(function(t){e(t),that._logger.error("Could not fetch the documents: %o",t)})})})},getPrimary:function(t){return new e((e,n)=>{require(["DS/IssueAttachmentManager/services/AttachmentServices"],function(n){n.getPrimary(t).then(function(t){var n="",i=JSON.parse(t);return s.is(i.documentId,"string")&&""!==i.documentId&&(n=i.documentId),e(n)}).catch(function(t){e(t),that._logger.error("Could not fetch the primary attachment: %o",t)})})})},formatMemebersValues:function(e){return e.reduce(function(e,t){return e[t.user]={fullName:t.fullName,user:t.user,type:t.type},e},{})}},classification:{getCSRFToken:function(t){return new e((e,n)=>{l.classification.getcsrf().then(function(s){var n={issueId:t.physicalId,csrf:s.csrf.value,isEdit:t.isEdit};e(n)}).catch(function(e){e&&s.is(e.body,"object")&&s.is(e.body.message,"string")?i.displayNotification({msg:e.body.message,eventID:"error"}):i.displayNotification({msg:u.create.classificationFailed,eventID:"error"}),n(e)})})},classifyObject:function(t,n){var o=[];return t.forEach(function(t){var a=new e(function(e,o){l.classification.classify({classID:t,issueID:n.issueId,token:n.csrf}).then(function(t){"KO"===t.body.StatusOfObjects[n.issueId].status?(i.displayNotification({msg:u.create.classificationFailed,eventID:"error"}),o(n)):e(n)}).catch(function(e){e&&s.is(e.body,"object")&&s.is(e.body.message,"string")?i.displayNotification({msg:e.body.message,eventID:"error"}):i.displayNotification({msg:u.create.classificationFailed,eventID:"error"}),o(e)})});o.push(a)}),e.all(o).then(function(e){return e[0]})},deClassifyObject:function(t,n){var o=[];return t.forEach(function(t){var a=new e(function(e,o){l.classification.deClassify({classID:t,issueID:n.issueId,token:n.csrf}).then(function(t){"OK"!=t.body.StatusOfObjects[n.issueId]?(i.displayNotification({msg:u.create.classificationFailed,eventID:"error"}),o(n)):e(n)}).catch(function(e){e&&s.is(e.body,"object")&&s.is(e.body.message,"string")?i.displayNotification({msg:e.body.message,eventID:"error"}):i.displayNotification({msg:u.create.classificationFailed,eventID:"error"}),o(e)})});o.push(a)}),e.all(o).then(function(e){return e[0]})},getClassAttrVals:function(e){return this.getClassificationAttrValues(e.issueId).then(function(t){var s=t.member[0]?t.member[0].cestamp:"";return{issueId:e.issueId,csrf:e.csrf,cestamp:s}}).catch(function(e){e&&s.is(e.body,"object")&&s.is(e.body.message,"string")?i.displayNotification({msg:e.body.message,eventID:"error"}):i.displayNotification({msg:u.create.setAttributesFailed,eventID:"error"})})},getClassificationAttrValues:function(t){return new e((e,s)=>{l.classification.getClassificationAttributesOfClassifiedItem({issueId:t}).then(function(t){e(t)}).catch(function(e){s(e)})})},setClassificationValues:function(t,n){return new e((e,o)=>{l.classification.setClassificationAttributes({issueId:n.issueId,attributes:t,cestamp:n.cestamp,csrf:n.csrf}).then(t=>{e(n)}).catch(e=>{e&&s.is(e.body,"object")&&s.is(e.body.message,"string")?i.displayNotification({msg:e.body.message,eventID:"error"}):i.displayNotification({msg:u.create.setAttributesFailed,eventID:"error"}),o(e)})})},addClassificationColumn:function(e,t,n){for(var i in e.attributes)if(s.is(t)&&s.is(t.attributes)&&!t.attributes.includes(i)&&"cestamp"!==i){t.attributes.push(i);var o={column:{text:i,dataIndex:i,isDraggable:!0,isHidden:!0,visibleFlag:!1,export:{value:!0,lock:!1},moveable:!0,width:120,minWidth:5,isCustomColumn:"Classification",isOOTBColumn:!0,ds6wIndexMapping:i}},a={that:t,attr:{name:i}};"template"==n?(o.column.getCellValue=t.dataGrid.rendering.classificationAttributes.bind(a),t.dataGrid.getColumns().filter(e=>e.dataIndex==o.column.dataIndex).length<=0&&t.dataGrid.getManager().addColumnOrGroup(o.column)):(o.column.getCellValue=t.list.rendering.classificationAttributes.bind(a),t.list.getManager().getColumns().filter(e=>e.dataIndex==o.column.dataIndex).length<=0&&t.list.getManager().addColumnOrGroup(o.column))}}},getRecentlyUsedTemplates:function(){return new e((e,t)=>{l.preferences.get({data:{name:"recentUsedTemplates"}}).then(function(t){e(t)}).catch(function(e){})})},setRecentlyUsedTemplates:function(t){return new e((e,s)=>{l.preferences.set({data:{name:"recentUsedTemplates",value:JSON.stringify(t)}}).catch(function(e){s(e)})})},isJson:function(e){try{JSON.parse(e)}catch(e){return!1}return!0},utils:{isInteger:function(e){return Number.isInteger?Number.isInteger(e):"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}},addTypeToNonIndexIds:function(t){var s=this,n=t,i=s.nonIndexIds(t);return new e(function(e){i.length>0?l.fetch({data:{objects:i.map(function(e){return{physicalId:e}})},onComplete:function(t){const i=s.mapAttributes(t.body.results);n=s.updateResponse(n,i),e(n)},onFailure:function(t){e(n)}}):e(n)})},nonIndexIds:function(e){var t=[];return e.forEach(e=>{e.reportedAgainst.length>0&&e.reportedAgainst.forEach(e=>{0==e.index&&t.push(e.physicalId)}),e.contexts.length>0&&e.contexts.forEach(e=>{0==e.index&&t.push(e.physicalId)}),e.resolvedBy.length>0&&e.resolvedBy.forEach(e=>{0==e.index&&t.push(e.physicalId)}),e.resolvedItems.length>0&&e.resolvedItems.forEach(e=>{0==e.index&&t.push(e.physicalId)})}),[...new Set(t)]},mapAttributes:function(e){let t={};return e.forEach(e=>{let n={};var i="";e.attributes.forEach(e=>{switch(s.is(e.name,"string")?e.name.replace("ds6w:what/","").replace("ds6w:when/","").replace("ds6w:who/",""):e.name){case"resourceid":n.pid=e.value,""==i&&(i=e.value);break;case"ds6w:label":n.title=e.value;break;case"ds6w:type":n.type=e.value;break;case"ds6w:i3dx":i=e.value}}),t[i]=n}),t},updateResponse:function(e,t){return e.forEach(e=>{e.reportedAgainst.forEach(e=>{t[e.physicalId]&&(e.type=e.objectType=t[e.physicalId].type,e.title=t[e.physicalId].title,e.pid=t[e.physicalId].pid)}),e.resolvedItems.forEach(e=>{t[e.physicalId]&&(e.type=e.objectType=t[e.physicalId].type,e.title=t[e.physicalId].title,e.pid=t[e.physicalId].pid)}),e.resolvedBy.forEach(e=>{t[e.physicalId]&&(e.type=e.objectType=t[e.physicalId].type,e.title=t[e.physicalId].title,e.pid=t[e.physicalId].pid)}),e.contexts.forEach(e=>{t[e.physicalId]&&(e.type=e.objectType=t[e.physicalId].type,e.title=t[e.physicalId].title,e.pid=t[e.physicalId].pid)})}),e},getTypesHierarchy:function(t){return new e(e=>{l.getTypesHierarchy({types:t}).then(t=>{var n={};s.is(t.types_hierarchies,"array")&&t.types_hierarchies.forEach(function(e,t){var s={};s.hierarchy=e.hierarchy,n[e.type]=s}),e(n)})})}}}),define("DS/IssueComponents/team/MembersMakeDroppable",["DS/DataDragAndDrop/DataDragAndDrop","DS/PADUtils/views/PADAlert","DS/UIKIT/Mask","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,s,n){"use strict";var i={makeDroppable:function(s,o){e.droppable(s,{drop:function(e,a,r){if(r.stopPropagation&&r.stopPropagation(),r.preventDefault&&r.preventDefault(),r.dataTransfer&&r.dataTransfer.dropEffect&&(r.dataTransfer.dropEffect="copy"),UWA.is(e)&&""!=e){var l=JSON.parse(e);i.ExecuteDrop(l,o)}else t.displayNotification({msg:n.team.error.dropNotSupported,eventID:"error"});s.style.borderWidth="0px"},over:function(){arguments[0].setStyles({borderStyle:"solid",borderColor:"#368ec4",borderWidth:"1px"})},leave:function(){arguments[0].setStyle("borderWidth","0px")}})},ExecuteDrop:function(e,s){if(e){var i=e.data.items;UWA.is(i)&&UWA.is(i.length)&&i.length>0&&s(i)}else t.displayNotification({msg:n.team.error.dropNotSupported,eventID:"error"})}};return i}),define("DS/IssueComponents/external/CollaborativeLifecycle",[],function(){"use strict";return{execute:function(e){require(["DS/LifecycleCmd/MaturityCmd","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices"],function(t,s,n){s.get("widget");var i=[];if(e.forEach(function(e){i.push({physicalId:e})}),i.length>0){var o={};o.context={getSecurityContext:function(){return n.getSecurityContext()}},new t(o).executeAsync(i).then(function(){})}})}}}),define("DS/IssueComponents/models/TreeNodeModel",["UWA/Core","DS/TreeModel/TreeNodeModel"],function(e,t){"use strict";function s(s){s=e.extend({id:"",label:"",icons:[],grid:{},type:""},s),t.call(this,s)}return s.prototype=Object.create(t.prototype),s.prototype.getID=function(){return this.options.id},s}),define("DS/IssueComponents/external/Compare",[],function(){"use strict";var e={WIDTH:700,HEIGHT:800};return{execute:function(t){require(["DS/TransientWidget/TransientWidget","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices"],function(s,n,i){var o=[];n.get("widget");if(t.forEach(function(e){o.push({envId:i.getTenant(),serviceId:e.serviceId?e.serviceId:"3DSpace",contextId:i.getSecurityContext(),objectId:e.physicalId,objectType:e.type,displayName:""})}),o.length>0){var a={protocol:"3DXContent",version:"1.1",source:n.get("widget").name,data:{items:o}},r={mode:"panel",height:e.HEIGHT,width:e.WIDTH};s.showWidget("ENOCOMP_AP","",{X3DContentId:JSON.stringify(a),x3dPlatformId:i.getTenant()},r)}})}}}),define("DS/IssueComponents/create/Attachments",["UWA/Class/View","UWA/Class/Promise","UWA/Core","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Form","DS/UIKIT/Iconbar","DS/Controls/TooltipModel","DS/UIKIT/Mask","DS/IssueAttachmentManager/components/Collection","DS/IssueAttachmentManager/components/Item","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueAttachmentManager/views/Catalog","i18n!DS/IssueAttachmentManager/assets/nls/IssueAttachmentManager","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","DS/2DAnnotation/2DAnnotation","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f,h,g,v,b,C,y,I,E,S){"use strict";var w="ENX3DIR_AP",T=/[/\\?%*:|"<>]/g;return e.extend({name:"DS/IssueComponents/create/Attachments",tag:"div",className:"create-view-content-subview create-attachments",isInit:null,_deferredInit:{resolve:null,reject:null},setup:function(e){var s=this;s._parent(e),s.parent=e.parent,s.annotateCommand=e.annotateCommand||{enable:!1,addTextbox:!1,getText:function(){return""}},s.searchAttachmentCommand=e.searchAttachmentCommand||{getSearchQuery:function(){return t.resolve("")}},s.isInit=new t(function(e,t){s._deferredInit.resolve=e,s._deferredInit.reject=t}),s._logger=i.getLogger(s.name),s.form=null,s.formElements={attachments:null},s.formElementsToggler={attachments:null},s.fields={attachments:{container:null,iconBar:null,title:null}},s.collection=new u({id:Date.now().toString()}),s._deferredInit.resolve()},destroy:function(){this.form=null,this.formElements={attachments:null},this.formElementsToggler={attachments:null},this.fields={attachments:{container:null,iconBar:null,title:null}},this.collection=null,this.catalog=null},render:function(){return this._renderAttachmentsField(),this.form=new r({className:"create-attachments-form",fields:[],events:{onInvalid:function(){}}}).inject(this.container),s.createElement("div",{class:"create-form-content",html:[this.formElements.attachments=s.createElement("div",{class:"create-form-element create-attachments-form-element-attachments",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[this.formElementsToggler.attachments=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[this.fields.attachments.title,this.fields.attachments.container]},{tag:"div",class:"create-form-help-tooltip",html:[this.fields.attachments.help]}]})]}).inject(this.form.elements.container),this},_renderAttachmentsField:function(){var e=this;e.fields.attachments.help=s.createElement("div",{html:[s.createElement("span",{class:"fonticon fonticon-help"})]}),e.fields.attachments.help.tooltipInfos=new c({shortHelp:S.create.attachments.labels.attachmentsshortHelper,longHelp:S.create.attachments.labels.attachmentslongHelper}),e.fields.attachments.title=s.createElement("div",{class:"create-form-title-with-iconbar",html:[{tag:"h5",html:S.create.attachments.labels.attachments}]}),e.fields.attachments.iconBar=new l({renderTo:e.fields.attachments.title,items:[{id:"annotate",fonticon:"highlighter",text:S.create.attachments.annotate,selectable:!0,handler:function(){e._annotate()}},{id:"screenshot",fonticon:"camera",text:S.create.attachments.screenshotAvailable,selectable:!0,handler:function(){e._screenshot()}},{id:"attachFromLocalDisk",fonticon:"upload",text:S.create.attachments.attach.fromLocalDisk,selectable:!1,handler:function(){e._onRequestAttachFromLocalDisk()}},{id:"attachFrom3DX",text:S.create.attachments.attach.from3DX,fonticon:"plus",selectable:!1,handler:function(){e.searchAttachmentCommand.getSearchQuery().then(function(t){e._onRequestAttachFrom3DX(t)})}},{className:"divider"},{id:"setAsPrimary",fonticon:"star",text:h.views.Header.Iconbar.actions.setAsPrimary,selectable:!0,handler:function(){var t=e.collection.getSelectedItems()[0];if(e.collection.filter(function(e){return!0===e.get("isPrimary")}).some(function(e){return e.get("id")===t.get("id")}))t.set("isPrimary",!1);else for(var s=0;s<e.collection.size();s++){var n=e.collection.at(s);n.id!==t.id?n.set("isPrimary",!1):n.set("isPrimary",!0)}}},{id:"remove",fonticon:"remove",text:S.create.attachments.remove,selectable:!1,handler:function(){var t=e.collection.getSelectedItems();e.collection.unselectAll(),e.collection.remove(t)}},{className:"divider"},{id:"switchCatalogLayout",type:"checkbox",fonticon:"view-list",text:h.views.Header.Iconbar.actions.switchCatalogLayout,selectable:!0,handler:function(){e.catalog.switchLayout(e.catalog.layout%2+1)}}]}),e.fields.attachments.iconBar.disableItem("remove"),e.fields.attachments.iconBar.disableItem("setAsPrimary"),e.annotateCommand.enable||e.fields.attachments.iconBar.getItem("annotate").elements.container.hide(),e.fields.attachments.container=s.createElement("div",{class:"create-form-attachments-container",tabindex:"-1"}),e.catalog=new f({collection:e.collection,layout:1,searchAttachmentCommand:{getSearchQuery:e.searchAttachmentCommand.getSearchQuery}}).render().inject(e.fields.attachments.container),e.listenTo(e.catalog,"onSwitchLayout",e._onCatalogSwitchLayout.bind(e)),e.listenTo(e.catalog,"request:attachFrom3DX",e._onRequestAttachFrom3DX.bind(e)),e.listenTo(e.catalog,"request:attachFromLocalDisk",e._onRequestAttachFromLocalDisk.bind(e)),e.listenTo(e.collection,"onSelect",e._onCollectionSelect.bind(this)),e.listenTo(e.collection,"onUnselect",e._onCollectionSelect.bind(this)),e._addDropEvent(e.catalog.container)},reset:function(){var e=this;return new t(function(t){e.collection.reset(),e.fields.attachments.iconBar.disableItem("remove"),e.fields.attachments.iconBar.disableItem("setAsPrimary"),t()})},getValues:function(e){var t={attachments:[],primaryAttachment:null};return e&&(t.attachments=this.collection.filter(function(e){return!e.get("isFile")}).map(function(e){return e.get("isPrimary")&&(t.primaryAttachment=e.id),e.get("id")})),t},getHiddenAttributes:function(){var e={};for(var t in this.formElements)s.is(this.formElementsToggler[t])&&(e[t]=this.formElementsToggler[t].hasClassName("fonticon-eye-off"));return e},applyTemplate:function(e){var n=this;return n.reset().then(function(){if(s.is(e.hidden,"object")&&s.is(n.formElements,"object")&&s.is(n.formElementsToggler,"object")){var i=n.formElements,a=n.formElementsToggler;for(var r in i)!0===e.hidden[r]&&(n.parent.isTemplate?(s.is(i[r])&&i[r].toggleClassName("visibility-masked",!0),s.is(a[r])&&(a[r].toggleClassName("fonticon-eye-off",!0),a[r].toggleClassName("fonticon-eye",!1))):s.is(i[r])&&i[r].hide())}return s.is(e.data,"object")&&e.data.hasOwnProperty("attachments")&&e.data.attachments.length>0?p.getDocuments(e.data.attachments).then(function(i){if(s.is(i.attachments,"array")){if(i.attachments.length!==e.data.attachments.length&&(o.displayNotification({msg:S.create.templateApplyWarningAttachments,eventID:"warning"}),0===i.attachments.length))return t.resolve();var a=i.attachments.map(function(e){return e.id});return p.fetch(a).then(function(t){if(s.is(t.results,"array")&&t.results.length===a.length){var i=t.results.map(function(e){return p.parseFromFetch(e)});if(e.data.primaryAttachment)for(var o=0;o<i.length;o++)e.data.primaryAttachment===i[o].id&&(i[o].isPrimary=!0);return n._addObjects(i)}return b.fetcher.recent(a).then(function(t){if(s.is(t.results,"array")){if(t.results.length!==a.length){var i=[];t.results.filter(function(e,t){null!=e.attributes.find(e=>e.value==a)&&i.push(p.parseFromFetch(e))})}else i=t.results.map(function(e){return p.parseFromFetch(e)});if(e.data.primaryAttachment)for(var o=0;o<i.length;o++)e.data.primaryAttachment===i[o].id&&(i[o].isPrimary=!0);return n._addObjects(i)}throw new Error("Unexpected number of fetch results for attachments.")})})}return t.resolve()}).catch(function(e){e&&e.error&&e.error.includes("Invalid Business Object Specified")&&o.displayNotification({msg:S.create.templateApplyWarningAttachments,eventID:"warning"}),t.reject(e)}):t.resolve()})},_addFiles:function(e){for(var t=this,s=[],n=0;n<e.length;n++){var i=e[n],o="temporary_"+Math.floor(Date.now())+"_"+n,r=i.type,l={id:o,title:i.name,type:"Document",dispType:h.views.Attachment.types.Document,owner:{firstName:a.getUser().firstName,fullName:a.getUser().firstName.trim()+" "+a.getUser().lastName.trim(),lastName:a.getUser().lastName,user:a.getUser().login},relOwner:{firstName:a.getUser().firstName,fullName:a.getUser().firstName.trim()+" "+a.getUser().lastName.trim(),lastName:a.getUser().lastName,user:a.getUser().login},relOriginated:(new Date).toString()};i.hasOwnProperty("lastModifiedDate")?i.lastModifiedDate instanceof Date?(l.modified=i.lastModifiedDate.toString(),l.created=i.lastModifiedDate.toString()):(l.modified=new Date(i.lastModifiedDate).toString(),l.created=new Date(i.lastModifiedDate).toString()):(l.modified=(new Date).toString(),l.created=(new Date).toString());var c=new m(l);c.setDocumentTypeByMIME(r),c.set("isFile",!0),c.set("file",i),s.push(c)}return t.collection.add(s),s.forEach(function(e){"image"===e.get("documentType")&&(v.readImageURI(e.get("file")).then(function(t){e.set("thumbnailUrl",t),e.set("contentUrl",t)}),1===t.collection.size()&&e.set("isPrimary",!0))}),s},_addObjects:function(e){var n=this,i=e.filter(function(e){return void 0===n.collection.get(e.id)});if(i.length!==e.length&&o.displayNotification({msg:h.replace(h.notifications.Attach.alreadyAttached,{count:e.length-i.length}),eventID:"warning"}),i.length>0){for(var r=[],l=0;l<i.length;l++){var c=i[l];c.relOwner={firstName:a.getUser().firstName,fullName:a.getUser().firstName.trim()+" "+a.getUser().lastName.trim(),lastName:a.getUser().lastName,user:a.getUser().login};var d=new m(c);r.push(d)}n.collection.add(r);for(var u=[],f=[],g=0;g<r.length;g++){var v=r[g];u.push(v.id),"Document"===v.get("type")&&f.push(v.id)}var C=[t.resolve()];u.length>0&&C.push(p.fetch(u).then(function(e){s.is(e.results,"array")?n.downloadAdditionalData(e.results):C.push(b.fetcher.recent(u).then(function(e){var t;s.is(e.results,"array")?(t=e.results.length!==u.length?e.results.filter(function(e){e.attributes.find(e=>e.value==u)}):e.results,n.downloadAdditionalData(t)):o.displayNotification({msg:S.replace(h.notifications.Fetch.failure),eventID:"error"})}).catch(function(e){o.displayNotification({msg:S.replace(h.notifications.Fetch.failure),eventID:"error"}),n._logger.error(e)}))}).catch(function(e){o.displayNotification({msg:S.replace(h.notifications.Fetch.failure),eventID:"error"}),n._logger.error(e)})),f.length>0&&C.push(p.downloadDocuments(f).then(function(e){for(var t=0;t<e.length;t++){var s=e[t].id,i=n.collection.get(s);i&&e[t].downloadUrl&&void 0===e[t].errorMessage&&i.set("contentUrl",e[t].downloadUrl)}}).catch(function(e){o.displayNotification({msg:S.replace(h.notifications.Download.failure),eventID:"error"}),n._logger.error(e)}))}},downloadAdditionalData:function(e){for(var t=0;t<e.length;t++){var s=e[t].attributes.find(function(e){return"resourceid"===e.name}).value,n=this.collection.get(s);if(n){n.set("isProcessing",!0);var i=e[t].attributes.find(function(e){return"owner"===e.name}),o=e[t].attributes.find(function(e){return"ds6w:responsible"===e.name});i&&i.value&&o&&o.value&&n.set("owner",{user:i.value,fullName:o.value,firstName:"",lastName:""});var a=e[t].attributes.find(function(e){return"ds6w:docextension"===e.name});a&&a.value&&n.setDocumentType(a.value),1===this.collection.size()&&"image"===n.get("documentType")&&n.set("isPrimary",!0),n.set("isProcessing",!1)}}},_screenshot:function(){var e=this,t=y.get("widget").name===w;if(s.is(e.parent)&&s.is(e.parent.elements)&&s.is(e.parent.elements.dialog)&&e.parent.elements.dialog.hide(),t){y.get("component").utils.takeAnnotation(function(t){var s=t.blob;s.lastModifiedDate=new Date;var n=(new Date).toLocaleString();n=n.replace(T,"-"),s.name="screenshot_"+n+".png",e._addFiles([s]),e.parent.elements.dialog.show()},function(){e.parent.elements.dialog.show()},function(t){e._logger.error(t)})}else{var n=y.get("component"),i=n.taskManager.addTakeScreenshotTask(function(t){for(var o=t.data,a=t.fileName,r=t.fileType,l=t.lastModified,c=atob(o.split(",")[1]),d=new ArrayBuffer(c.length),u=new Uint8Array(d),m=0;m<c.length;m++)u[m]=c.charCodeAt(m);var p=new File([d],a,{type:r,lastModified:l});e._addFiles([p]),s.is(e.parent)&&s.is(e.parent.elements)&&s.is(e.parent.elements.dialog)&&e.parent.elements.dialog.show(),n.unmaskForTask(i)},function(){s.is(e.parent)&&s.is(e.parent.elements)&&s.is(e.parent.elements.dialog)&&e.parent.elements.dialog.show(),n.unmaskForTask(i)});n.maskForTask(i,S.tasks.addAttachments)}},_onCollectionSelect:function(){var e=this.collection.getSelectedItems();e.length>0?(this.fields.attachments.iconBar.enableItem("remove"),1===e.length&&"image"===e[0].get("documentType")?(this.fields.attachments.iconBar.enableItem("setAsPrimary"),this.fields.attachments.iconBar.enableItem("annotate")):(this.fields.attachments.iconBar.disableItem("setAsPrimary"),this.fields.attachments.iconBar.disableItem("annotate"))):(this.fields.attachments.iconBar.disableItem("remove"),this.fields.attachments.iconBar.disableItem("setAsPrimary"),this.fields.attachments.iconBar.enableItem("annotate"))},_onCatalogSwitchLayout:function(){this.fields.attachments.iconBar.getItem("switchCatalogLayout").elements.icon.toggleClassName("fonticon-view-small-thb",(this.catalog.layout+1)%2==1),this.fields.attachments.iconBar.getItem("switchCatalogLayout").elements.icon.toggleClassName("fonticon-view-list",this.catalog.layout%2==1)},_onDrop:function(e){var t=this;e.preventDefault(),e.stopPropagation();var n=p.parseFromDragEvent(e);if(n.hasOwnProperty("files")&&n.files instanceof FileList)t._addFiles(n.files);else if(v.isValid3DXContent(n)){var i=n.data.items.map(function(e){return e.objectId});p.fetch(i).then(function(e){if(!s.is(e.results,"array"))throw new Error("Unexpected empty fetch results.");var n=e.results.map(function(e){return p.parseFromFetch(e)});t._addObjects(n)}).catch(function(e){o.displayNotification({msg:S.replace(h.notifications.Attach.failure,{count:i.length}),eventID:"error"}),t._logger.error(e)})}else o.displayNotification({msg:S.notifications.Drop.unsupported,eventID:"error"})},_onRequestAttachFrom3DX:function(e){var t=this,n=y.get("application");if(s.is(n,"object")&&n.isStandalone){var i=y.get("component"),o=i.taskManager.addObjectsTask(function(e){if(Array.isArray(e)&&null==e.physicalIds){let t=e.map(e=>e.physicalId);(e={}).physicalIds=t}if(Array.isArray(e.physicalIds)){var n=e.physicalIds;p.fetch(n).then(function(e){if(s.is(e.results,"array")&&e.results.length===n.length){var i=e.results.map(function(e){return p.parseFromFetch(e)});return t._addObjects(i)}throw new Error("Unexpected number of fetch results for attachments.")}).finally(function(){s.is(t.parent)&&s.is(t.parent.elements)&&s.is(t.parent.elements.dialog)&&t.parent.elements.dialog.show(),i.unmaskForTask(o)})}else t.parent.elements.dialog.show(),i.unmaskForTask(o)},function(){t.parent.elements.dialog.show(),i.unmaskForTask(o)});i.maskForTask(o,S.tasks.addAttachments)}else C.search({title:h.Attach.SearchTitle,default_search_criteria:s.is(e,"string")?e:"",multiSel:!0,callback:function(e){var s=e.map(function(e){return p.parseFromSearch(e)});t._addObjects(s)},cancel:function(){}})},_onRequestAttachFromLocalDisk:function(){var e=this;p.browseFileFromLocalDisk(e.container).then(e._addFiles.bind(e)).catch(function(t){o.displayNotification({msg:h.replace(h.notifications.BrowseFile.failure),eventID:"error"}),e._logger.error(t)})},_addDropEvent:function(e){var t=this,s=0;e.addEventListener("drop",function(){e.removeClassName("dragenter"),t._onDrop.apply(t,arguments)}),e.addEventListener("dragenter",function(){e.addClassName("dragenter"),s++}),e.addEventListener("dragleave",function(){--s<=0&&e.removeClassName("dragenter")}),e.addEventListener("mouseleave",function(){--s<=0&&e.removeClassName("dragenter")}),document.addEventListener("dragover",function(e){e.preventDefault()})},_annotate:function(){var e=this,t=y.get("widget");v.Mask.mask(t.body);var s=e.collection.getSelectedItems()[0],n={className:"approve-annotation",saveCallback:e._annotationSaveCallback.bind(e),exitCallback:function(){e.annotation.destroy(),e.annotation=null}};if(s&&s.get("contentUrl"))n.imageURL=s.get("contentUrl");else{var i=t.body.getDimensions();n.defaultDimensions={width:i.width-50,height:i.height-50}}var a=new E(n);a.render(),a.isLoaded.then(function(){a.container.inject(t.body),e.annotation=a;var s=e.annotateCommand.getText();if(e.annotateCommand.addTextbox&&s){var n={text:s,centered:!0},i=new Event("onAddNewObject");i.data={tool:"createText",options:n,select:!0},e.annotation.dispatchEvent("onAddNewObject",i)}}).catch(function(t){e.annotation&&(e.annotation.destroy(),e.annotation=null),o.displayNotification({msg:S.replace(h.notifications.Annotation.initFailure),eventID:"error"}),e._logger.error(t)}).finally(function(){v.Mask.unmask(t.body)})},_annotationSaveCallback:function(e){var t=(new Date).toLocaleString();t=t.replace(T,"-");var s=h.replace(h.annotate.defaultName,{date:t}),n=new File([e.blob],s,{type:"image/png",lastModified:Date.now()}),i=this.collection.getSelectedItems(),o=null;if(1===i.length){var a=i[0];o=a.get("isPrimary"),this.collection.remove(a)}var r=this._addFiles([n]);r&&r[0]&&(this.collection.select(r[0].id),o&&r[0].set("isPrimary",!0)),this.annotation.destroy(),this.annotation=null}})}),define("DS/IssueComponents/create/Custom",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Form","DS/UIKIT/Input/Date","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/UIKIT/Input/Number","DS/UIKIT/Input/Toggle","DS/IssueServices/services/IssueServices","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r,l,c,d){"use strict";return t.extend({})}),define("DS/IssueComponents/duplicate/Duplicate",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Tooltip","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/Controls/SpinBox","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","i18n!DS/IssueComponents/assets/nls/IssueComponents","text!DS/IssueCommon/assets/Settings.json","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f,h,g,v,b,C,y){"use strict";return t.extend({name:"DS/IssueComponents/duplicate/Duplicate",tag:"div",className:"duplicate-view",_logger:null,defaultOptions:{physicalIds:[]},physicalIds:[],issues:{},duplicateIssues:[],modal:null,confirm:null,validate:null,isLoaded:null,_deferred:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s._logger=u.getLogger("DS/IssueComponents/components"),s._logger.log("Initializing the duplicate component"),s.settings=JSON.parse(y),s.issues={},s.modal=null,s.validate=null,s.confirm=null,s.isLoaded=null,s._deferred={resolve:null,reject:null},s.isLoaded=new e(function(e,t){s._deferred.resolve=e,s._deferred.reject=t})},render:function(){var e=this;return v.start(e.name+" render"),e.dialog().then(function(){e._deferred.resolve()},function(){e._deferred.reject()}),v.end(e.name+" render"),e},destroy:function(){v.start(this.name+" destroy"),this.physicalIds=[],this.issues={},this.duplicateIssues=[],this.confirm.destroy(),this.confirm=null,this.modal.destroy(),this.modal=null,this.validate=null,this.isLoaded=null,this._deferred={resolve:null,reject:null},v.end(this.name+" destroy")},dialog:function(){var e=this,t=f.get("widget")||window.widget;return r.mask(e.container),e.modal=new d({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"duplicate-issues-dialog",title:C.duplicate.preparing,header:null,body:e.container,footer:[e.validate=new n({value:C.duplicate.duplicate,className:"primary",events:{onClick:function(){e._duplicate()}},disabled:!0}),new n({value:C.duplicate.cancel,events:{onClick:function(){e.destroy()}}})],events:{onClose:function(){e.destroy()}}}).inject(t.body),e.build().then(function(t){new l({element:t}).inject(e.container),e.elements.optionsButton=new a({type:"switch",className:"options-button",checked:!1,label:C.duplicate.advancedOptions,events:{onChange:function(){e.displayOptions()}}}).inject(e.container),e.elements.Options=s.createElement("div",{class:"options-view"}).inject(e.container),e.elements.keepRelated=new a({type:"checkbox",className:"keep-related toggle-primary",checked:!0,label:C.duplicate.keepRelated}).inject(e.elements.Options),e.elements.keepAttachments=new a({type:"checkbox",className:"keep-attachments toggle-primary",checked:!1,label:C.duplicate.keepAttachments}).inject(e.elements.Options),e.settings.enableCopies&&(e.elements.copyCount=s.createElement("div",{class:"copy-count",html:[{tag:"span",class:"title-copy-count",html:C.duplicate.copyCount},e.count=new c({minValue:1,maxValue:e.settings.maxNumberOfCopies,stepValue:1,pageStepValue:1})]}).inject(e.elements.Options)),e.elements.titleOptions=s.createElement("div",{class:"title-options-view",html:[{tag:"span",class:"title-modifier",html:C.duplicate.titleModifier}]}).inject(e.elements.Options),new l({element:e.elements.Options}).inject(e.container),s.createElement("div",{class:"advanced-options-item",html:[{tag:"span",class:"advanced-options-label",html:C.duplicate.replace},e.replaceHelp=s.createElement("span",{class:"fonticon fonticon-help"}),e.replace=new i({className:"advanced-options-text",placeholder:C.duplicate.replacePlaceholder})]}).inject(e.elements.titleOptions),s.createElement("div",{class:"advanced-options-item",html:[{tag:"span",class:"advanced-options-label",html:C.duplicate.suffix},e.suffixHelp=s.createElement("span",{class:"fonticon fonticon-help"}),e.suffix=new i({className:"advanced-options-text",placeholder:C.duplicate.suffixPlaceholder})]}).inject(e.elements.titleOptions),s.createElement("div",{class:"advanced-options-item",html:[{tag:"span",class:"advanced-options-label",html:C.duplicate.prefix},e.prefixHelp=s.createElement("span",{class:"fonticon fonticon-help"}),e.prefix=new i({className:"advanced-options-text",placeholder:C.duplicate.prefixPlaceholder})]}).inject(e.elements.titleOptions),e.settings.enableCopies&&(s.createElement("div",{class:"advanced-options-item",html:[{tag:"span",class:"advanced-options-label",html:C.duplicate.iterator},e.iteratorHelp=s.createElement("span",{class:"fonticon fonticon-help"}),e.iterator=new i({className:"advanced-options-text",placeholder:C.duplicate.iteratorPlaceholder})]}).inject(e.elements.titleOptions),e.suffixTooltip=new o({target:e.iteratorHelp,body:C.duplicate.iteratorHelp})),e.replaceTooltip=new o({target:e.replaceHelp,body:C.duplicate.replaceHelp}),e.suffixTooltip=new o({target:e.suffixHelp,body:C.duplicate.suffixHelp}),e.suffixTooltip=new o({target:e.prefixHelp,body:C.duplicate.prefixHelp}),e.elements.Options.hide(),e.validate.enable(),e.physicalIds.length>1?e.modal.setTitle(C.replace(C.duplicate.titleMultiple,{number:e.physicalIds.length})):e.modal.setTitle(C.replace(C.duplicate.titleSingle,{number:e.physicalIds.length})),e.buildConfirmationDialog(),e.confirm.hide(),e.validate.focus(),r.unmask(e.container)})},build:function(){var e=this;return v.start(e.name+" build"),g.preferences.getApprovalEnablement({data:{}}).then(function(t){e.adminPreference=t.body.ApprovalProcess}),e._check(e.getOption("physicalIds")).then(function(t){for(var n=[],i=0;i<e.physicalIds.length;i++){var o=t[e.physicalIds[i]],a=o.title+" ("+o.name+")";n.push(s.createElement("li",{html:[{tag:"span",class:"fonticon fonticon-issue-type "},s.String.escapeHTML(a)],title:a}))}return v.end(e.name+" build"),s.createElement("div",{html:[{tag:"div",class:"duplicate-issues-label",html:[{tag:"span",class:"duplicate-issues-label",html:C.duplicate.content}]},{tag:"div",class:"duplicate-issues-content",html:s.createElement("ul",{html:n,class:"duplicate-issues-content-list"})}]})})},displayOptions:function(){var e=null,t=null;this.elements.optionsButton.isChecked()?(this.elements.Options.show(),e=this.elements.Options.getSize(),(t=this.modal.elements.container.getSize()).height=t.height+e.height,this.modal.setNewSize(t)):(e=this.elements.Options.getSize(),(t=this.modal.elements.container.getSize()).height=t.height-e.height,this.modal.setNewSize(t),this.elements.Options.hide())},_check:function(e){var t=this;return v.start(t.name+" _check"),g.issues.retrieve({data:{objects:e.reduce(function(e,t){return e.push({physicalId:t}),e},[])}}).then(function(s){for(var n={},i=0;i<s.results.length;i++){var o=s.results[i].body;n[o.physicalId]={physicalId:o.physicalId,name:o.name,state:o.state,title:o.title?o.title:""}}return t.physicalIds=e,t.issues=n,n},function(e){if(t._logger.error(e),e.error.message.includes("'business object' does not exist")){var s=b.getErrorMessage("0");b.displayErrorMessage(s,"error"),t.modal.destroy()}else m.displayNotification({msg:C.duplicate.error,eventID:"error"})}).finally(function(){v.end(t.name+" _check")})},_duplicate:function(){var e=this;v.start(e.name+" _duplicate"),e.duplicateIssues=[];for(var t=!0,s=!1,n=1,i=e.elements.optionsButton.isChecked(),o=e.physicalIds.length,a="",r="",l=0;l<o;l++){var c=e.physicalIds[l],d=e.issues[c].title,u=void 0!==d&&""!==d?d:e.issues[c].name;if(i){t=e.elements.keepRelated.isChecked(),s=e.elements.keepAttachments.isChecked(),n=e.count?e.count.value:1;var m="",p="",f=e.replace.getValue();null!==f&&f.length>1&&(m=f.split(":")[0],p=f.split(":")[1]);var h=e.suffix.getValue(),g=e.prefix.getValue();if(a=e.iterator?e.iterator.getValue():"",m.length>0&&p.length>0&&(u=e.replaceTitle(u,m,p)),a.length>0){r=e.findIterator(d,a);var b=e.nextIterator(r);null!==b&&b.length>0&&(u=e.replaceIterator(u,r,b)),r=b}g.length>0&&(u=g+u),h&&(u+=h)}e.duplicateIssues.push({issue:e.issues[c],newTitle:u,keepRelated:t,keepAttachments:s});for(var C=1;C<n;C++){if(a.length>0){var y=e.nextIterator(r);u=e.replaceIterator(u,r,y),r=y}e.duplicateIssues.push({issue:e.issues[c],newTitle:u,keepRelated:t,keepAttachments:s})}}i?e.confirmDuplication():e.duplicate(e.duplicateIssues).then(function(){e.destroy()})},duplicate:function(e){var t=this,n=t.count?t.count.value:1;v.start(t.name+" duplicate"),t.validate.setDisabled(),t.confirmButton.setDisabled();var i,o=f.get("widget")||window.widget;return r.mask(o.body),i="Always"==t.adminPreference?"Analyst":"Never"==t.adminPreference?"Unassigned":"",g.issues.duplicate({data:{objects:e.map(function(e){return{physicalId:e.issue.physicalId,title:e.newTitle,related:e.keepRelated,attachments:e.keepAttachments,actualStartDate:"",actionTaken:"",resolutionStatement:"",adminPreference:i}})}}).then(function(e){var s="";s=n>1?C.replace(C.duplicate.multipleCopiesSuccess,{number:t.physicalIds.length,multiplication:n}):1===t.physicalIds.length?C.replace(C.duplicate.singleSuccess,{title:t.issues[t.physicalIds[t.physicalIds.length-1]].title+" ("+t.issues[t.physicalIds[t.physicalIds.length-1]].name+")"}):C.replace(C.duplicate.multipleSuccess,{number:t.physicalIds.length}),r.unmask(o.body),m.displayNotification({msg:s,eventID:"success"});var i=e.results.reduce(function(e,t){return e.push([t.body.physicalId]),e},[]),a=e.results.reduce(function(e,t){return e[t.body.physicalId]=t.body,e},{});v.end(t.name+" _duplicate"),p.publish("DS/Object/create",{metadata:{appId:o.id,appName:o.name,timestamp:Math.floor(Date.now())},data:{paths:i,attributes:a},version:"1.0"})},function(e){if(r.unmask(o.body),s.is(e.error.internal)&&e.error.internal.includes("ErrorCode:2003")){var n=b.getErrorMessage("2");b.displayErrorMessage(n,"error")}else if(s.is(e.error.internal)&&e.error.internal.includes("No create access to business object")){n=b.getErrorMessage("2");b.displayErrorMessage(n,"error")}else m.displayNotification({msg:C.duplicate.error,eventID:"error"});t._logger.error("Cannot duplicate the selected issue(s) because %o",e),v.end(t.name+" _duplicate")})},replaceTitle:function(e,t,s){if(0===t.length||0===s.length)return e;var n=t,i=(n=n.replace(/[-[\]{}()*+?\\^$]/g,"\\$&")).concat("|",t),o=null;try{o=new RegExp(i,"i")}catch(e){o=new RegExp(n,"i")}return e.replace(o,s)},findIterator:function(e,t){var s=null;try{s=new RegExp(t,"i")}catch(e){t=t.replace(/[-[\]{}()*+?\\^$]/g,"\\$&"),s=new RegExp(t,"i")}var n=s.exec(e),i=null;return null!==n&&(i=n[n.length-1]),i},nextIterator:function(e){var t=null;if(null!==e){var s=new RegExp("[0-9]+").exec(e);if(null!==s){var n="";s.forEach(function(e){n+=e});var i=parseInt(n),o=i+1;t=e.replace(i.toString(),o.toString())}}return t},replaceIterator:function(e,t,s){var n=e;if(null!==s&&s.length>0){var i=e.lastIndexOf(t);if(-1!==i)n=e.substring(0,i)+s+e.substring(i+t.length)}return n},buildConfirmationDialog:function(){var e=this,t=f.get("widget")||window.widget;e.confirmMsgCont=new l,e.confirm=new d({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!1,className:"duplicate-confirm-dialog",title:C.replace(C.duplicate.confirmTitle,{number:e.physicalIds.length}),header:null,body:e.confirmMsgCont,footer:[e.confirmButton=new n({value:C.duplicate.confirm,className:"primary",events:{onClick:function(){e.duplicate(e.duplicateIssues).then(function(){e.destroy()})}},disabled:!1}),new n({value:C.duplicate.cancel,events:{onClick:function(){e.modal.show(),e.confirm.hide()}}})],events:{onClose:function(){e.modal.show(),e.confirm.hide()}}}).inject(t.body)},confirmDuplication:function(){var e=this;e.modal.hide(),e.confirmMsgCont.getInnerElement().empty();var t={};Object.keys(e.issues).forEach(function(s){t[s]={title:e.issues[s].title,newTitles:[]}}),e.duplicateIssues.forEach(function(e){t[e.issue.physicalId].newTitles.push(e.newTitle)});var n=s.createElement("div",{}),i="";Object.keys(t).forEach(function(e,n){i+=C.replace(C.duplicate.confirmMsg,{title:s.String.escapeHTML(t[e].title)}),t[e].newTitles.forEach(function(e){i=i+"<br> - "+s.String.escapeHTML(e)}),n<Object.keys(t).length-1&&(i+="<hr>")}),s.createElement("span",{html:i}).inject(n),e.confirm.show(),n.inject(e.confirmMsgCont.getInnerElement()),e.confirm.onResize()}})}),define("DS/IssueComponents/delete/Delete",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/Controls/ProgressBar","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f,h,g){"use strict";var v="Create";return t.extend({name:"DS/IssueComponents/delete/Delete",tag:"div",className:"delete-view",_logger:null,defaultOptions:{physicalIds:[]},physicalIds:[],issues:{},titles:[],names:[],indelible:[],modal:null,validate:null,isLoaded:null,_deferred:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s._logger=l.getLogger("DS/IssueComponents/components"),s._logger.log("Initializing the delete component"),s.issues={},s.titles=[],s.names=[],s.indelible=[],s.validate=null,s.modal=null,s.isLoaded=null,s._deferred={resolve:null,reject:null},s.isLoaded=new e(function(e,t){s._deferred.resolve=e,s._deferred.reject=t})},render:function(){var e=this;return f.start(e.name+" render"),e.dialog().then(function(){e._deferred.resolve()},function(){e._deferred.reject()}),f.end(e.name+" render"),e},destroy:function(){f.start(this.name+" destroy"),this.physicalIds=[],this.issues={},this.titles=[],this.names=[],this.indelible=[],this.validate=null,this.modal.destroy(),this.modal=null,this.isLoaded=null,this._deferred={resolve:null,reject:null},f.end(this.name+" destroy")},dialog:function(){var e=this,t=u.get("widget")||window.widget;return i.mask(e.container),e.modal=new r({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"delete-issues-dialog",title:g.delete.preparing,header:null,body:e.container,footer:[e.validate=new n({value:g.delete.delete,className:"primary",events:{onClick:function(){e.container.getChildren()[0].addClassName("disableContent"),e.modal.elements.footer.addClassName("disableContent"),e.buildProgressBar().inject(e.container),e._delete().then(function(){e.destroy()})}},disabled:!0}),new n({value:g.delete.cancel,events:{onClick:function(){e.destroy()}}})],events:{onClose:function(){e.destroy()}}}).inject(t.body),e.build().then(function(t){t.inject(e.container),e.physicalIds.length>0?(e.validate.enable(),e.modal.setTitle(g.replace(g.delete.title,{number:e.physicalIds.length})),0===e.indelible.length&&(e.container.getElement(".no-delete-issues-label").addClassName("hidden"),e.container.getElement(".no-delete-issues-content").addClassName("hidden"))):(e.validate.disable(),e.modal.setTitle(g.delete.nothing),e.container.getElement(".delete-issues-label").addClassName("hidden"),e.container.getElement(".delete-issues-content").addClassName("hidden")),e.validate.focus(),i.unmask(e.container),new o({element:e.container}).inject(e.modal.getBody())})},build:function(){var e=this;return f.start(e.name+" build"),e._check(e.getOption("physicalIds")).then(function(t){for(var n=t.deletable,i=t.indelible,o={physicalIds:[],titles:[],icons:[]},a=0;a<n.length;a++)o.physicalIds.push(n[a].physicalId),o.titles.push(n[a].title+" ("+n[a].name+")"),o.icons.push({tag:"span",class:"fonticon fonticon-issue-type "+n[a].state.toLowerCase()});var r=[];o.titles.forEach(function(e,t){r.push(s.createElement("li",{html:[o.icons[t],s.String.escapeHTML(e)],title:e}))});for(var l={physicalIds:[],titles:[],icons:[]},c=0;c<i.length;c++)l.physicalIds.push(i[c].physicalId),l.titles.push(i[c].title+" ("+i[c].name+")"),l.icons.push({tag:"span",class:"fonticon fonticon-issue-type "});var d=[];return l.titles.forEach(function(e,t){d.push(s.createElement("li",{html:[l.icons[t],s.String.escapeHTML(e)],title:e}))}),e.physicalIds=o.physicalIds,e.titles=o.titles,e.indelible=l.physicalIds,f.end(e.name+" build"),s.createElement("div",{html:[{tag:"div",class:"delete-issues-label",html:[{tag:"span",class:"delete-issues-label-first",html:g.delete.warning},{tag:"span",class:"delete-issues-label-second",html:g.delete.deletable}]},{tag:"div",class:"delete-issues-content",html:s.createElement("ul",{html:r,class:"delete-issues-content-list"})},{tag:"div",class:"no-delete-issues-label",html:g.delete.indelible},{tag:"div",class:"no-delete-issues-content",html:s.createElement("ul",{html:d,class:"no-delete-issues-content-list"})}]})})},buildProgressBar:function(){return new a({shape:"circular",infiniteFlag:!0})},_check:function(e){var t=this;return f.start(t.name+" _check"),p.issues.retrieve({data:{objects:e.map(function(e){return{physicalId:e}})}}).then(function(e){for(var s={deletable:[],indelible:[]},n=0;n<e.results.length;n++){var i=e.results[n].body;!0===t.utils.isDeletable(i)?s.deletable.push({physicalId:i.physicalId,name:i.name,state:i.state,title:i.title?i.title:""}):s.indelible.push({physicalId:i.physicalId,name:i.name,state:i.state,title:i.title?i.title:""})}return t.issues=s,f.end(t.name+" _check"),s},function(e){if(t._logger.error(e),e.error.message.includes("'business object' does not exist")){var s=h.getErrorMessage("0");h.displayErrorMessage(s,"error"),t.destroy()}else c.displayNotification({msg:g.delete.error,eventID:"error"});f.end(t.name+" _check")})},_delete:function(){var e=this;f.start(e.name+" _delete");var t=u.get("widget")||window.widget;return i.mask(t.body),p.issues.delete({data:{objects:e.physicalIds.map(function(e){return{physicalId:e}})}}).then(function(){var s="";s=1===e.physicalIds.length?g.replace(g.delete.singleSuccess,{title:e.titles[e.titles.length-1]}):g.replace(g.delete.multipleSuccess,{number:e.physicalIds.length}),i.unmask(t.body),c.displayNotification({msg:s,eventID:"success"});var n=e.physicalIds.reduce(function(e,t){return e.push([t]),e},[]),o=e.physicalIds.reduce(function(t,s,n){return t[s]=e.issues.deletable[n],t},{});f.end(e.name+" _delete"),d.publish("DS/Object/delete",{metadata:{appId:t.id,appName:t.name,timestamp:Math.floor(Date.now())},data:{paths:n,attributes:o},version:"1.0"})},function(s){if(i.unmask(t.body),s.report[0].error.includes(g.delete.deletePrivilege)){var n=g.delete.deletePrivilege;c.displayNotification({msg:n,eventID:"error"})}else if(s.report[0].error.includes("1500028")){var o=h.getErrorMessage("1500028");h.displayErrorMessage(o,"error")}else c.displayNotification({msg:g.delete.error,eventID:"error"});f.end(e.name+" _delete"),e._logger.error("Cannot delete the selected issue(s) because %o",s)})},utils:{isDeletable:function(e){return e.state===v}}})}),define("DS/IssueComponents/templates/TemplatesToolbar",["DS/IssueServices/Contexts","DS/IssueCommon/utils/Utils","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,s){var n=Object.create(null);return n.toolbar=null,n._templateCommands={single:{enable:["clone","edit","delete","share","customizeDatagridView"],disable:[]},multi:{enable:["delete","share","customizeDatagridView"],disable:["clone","edit"]},empty:{enable:["customizeDatagridView"],disable:["clone","edit","delete","share"]},idling:["clone","edit","delete","share","customizeDatagridView"]},n.writetoolbarDefination=function(){var e={entries:[{id:"create",dataElements:{typeRepresentation:"functionIcon",visibleFlag:!0,icon:{iconName:"plus",fontIconFamily:1},action:{module:"DS/IssueComponents/templates/TemplatesToolbar",func:"createTemplate"},position:"far",category:"create",priority:1,label:s.templates.iconBar.create}},{id:"fromIssue",dataElements:{typeRepresentation:"functionIcon",visibleFlag:!0,icon:{iconName:"export",fontIconFamily:1},action:{module:"DS/IssueComponents/templates/TemplatesToolbar",func:"createFromIssue"},position:"far",category:"create",priority:1,label:s.templates.iconBar.fromIssue}},{id:"clone",dataElements:{typeRepresentation:"functionIcon",visibleFlag:!0,icon:{iconName:"duplicate",fontIconFamily:1},action:{module:"DS/IssueComponents/templates/TemplatesToolbar",func:"duplicateTemplate"},disabled:!0,visibleFlag:!1,position:"far",category:"create",priority:1,label:s.templates.iconBar.clone}},{id:"edit",dataElements:{typeRepresentation:"functionIcon",visibleFlag:!0,icon:{iconName:"pencil",fontIconFamily:1},action:{module:"DS/IssueComponents/templates/TemplatesToolbar",func:"editTemplate"},disabled:!0,visibleFlag:!1,position:"far",category:"modify",priority:1,label:s.templates.iconBar.edit}},{id:"delete",dataElements:{typeRepresentation:"functionIcon",visibleFlag:!0,icon:{iconName:"trash",fontIconFamily:1},action:{module:"DS/IssueComponents/templates/TemplatesToolbar",func:"removeTemplate"},disabled:!0,visibleFlag:!1,position:"far",category:"modify",priority:1,label:s.templates.iconBar.delete}},{id:"share",dataElements:{typeRepresentation:"functionIcon",visibleFlag:!0,icon:{iconName:"forward",fontIconFamily:1},action:{module:"DS/IssueComponents/templates/TemplatesToolbar",func:"shareTemplate"},disabled:!0,visibleFlag:!1,position:"far",category:"actions",priority:1,label:s.templates.iconBar.share}},{id:"customizeDatagridView",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"cog",fontIconFamily:1},action:{module:"DS/IssueComponents/templates/TemplatesToolbar",func:"customizeColumnView"},disabled:!0,visibleFlag:!1,priority:1,position:"far",category:"actions",label:s.templates.iconBar.columnCustomization}}]};return JSON.stringify(e)},n.createTemplate=function(e){e._event="createTemplate",n.toolbar.onToolbarClickCallback(e);try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"IssueTemplate",pd2:"DataGridView",pd3:"TemplateToolbar",pd4:"NewIssueTemplate",pd5:"IssueTemplate/DataGridView/TemplateToolbar/NewIssueTemplate"}})}catch(e){}},n.createFromIssue=function(e){e._event="fromIssue",n.toolbar.onToolbarClickCallback(e);try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"IssueTemplate",pd2:"DataGridView",pd3:"TemplateToolbar",pd4:"NewFromIssue",pd5:"IssueTemplate/DataGridView/TemplateToolbar/NewFromIssue"}})}catch(e){}},n.duplicateTemplate=function(e){e._event="duplicateTemplate",n.toolbar.onToolbarClickCallback(e);try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"IssueTemplate",pd2:"DataGridView",pd3:"TemplateToolbar",pd4:"Duplicate",pd5:"IssueTemplate/DataGridView/TemplateToolbar/Duplicate"}})}catch(e){}},n.editTemplate=function(e){e._event="editTemplate",n.toolbar.onToolbarClickCallback(e);try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"IssueTemplate",pd2:"DataGridView",pd3:"TemplateToolbar",pd4:"Edit",pd5:"IssueTemplate/DataGridView/TemplateToolbar/Edit"}})}catch(e){}},n.removeTemplate=function(e){e._event="removeTemplate",n.toolbar.onToolbarClickCallback(e);try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"IssueTemplate",pd2:"DataGridView",pd3:"TemplateToolbar",pd4:"Remove",pd5:"IssueTemplate/DataGridView/TemplateToolbar/Remove"}})}catch(e){}},n.shareTemplate=function(e){e._event="shareTemplate",n.toolbar.onToolbarClickCallback(e);try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"IssueTemplate",pd2:"DataGridView",pd3:"TemplateToolbar",pd4:"Share",pd5:"IssueTemplate/DataGridView/TemplateToolbar/Share"}})}catch(e){}},n.customizeColumnView=function(e){e._event="columnCustomization",n.toolbar.onToolbarClickCallback(e);try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"IssueTemplate",pd2:"DataGridView",pd3:"TemplateToolbar",pd4:"CustomView",pd5:"IssueTemplate/DataGridView/TemplateToolbar/CustomView"}})}catch(e){}},n.select=function(e){var t=[],s=[];e&&0!==e.length?1==e.length?(t=t.concat(n._templateCommands.single.enable),s=s.concat(n._templateCommands.single.disable)):(t=t.concat(n._templateCommands.multi.enable),s=s.concat(n._templateCommands.multi.disable)):(t=t.concat(n._templateCommands.empty.enable),s=s.concat(n._templateCommands.empty.disable)),n.enable(t),n.disable(s)},n.idling=function(){n.disable(n._templateCommands.idling)},n.enable=function(e){var t=this;e.forEach(e=>{t.toolbar.updateNodeModel(e,{disabled:!1,visibleFlag:!0})})},n.disable=function(e){var t=this;e.forEach(e=>{t.toolbar.updateNodeModel(e,{disabled:!0,visibleFlag:!1})})},n}),define("DS/IssueComponents/templates/model/TemplatesTreeNodeModel",["UWA/Core","DS/TreeModel/TreeNodeModel"],function(e,t){"use strict";function s(s){s=e.extend({id:"",physicalId:"",label:"",icons:[],grid:{},type:"",children:[],useAsyncPreExpand:!0,matchSearchNavigation:!1},s),t.call(this,s)}function n(e){e._getFilterInfo||(e.filterInChild=s.prototype.filterInChild.bind(e),e.filterOutChild=s.prototype.filterOutChild.bind(e),e._getFilterInfo=s.prototype._getFilterInfo.bind(e),e._getChildrenFilterInfo=s.prototype._getChildrenFilterInfo.bind(e),e._removeChildrenFilterInfo=s.prototype._removeChildrenFilterInfo.bind(e))}return s.prototype=Object.create(t.prototype),s.prototype.getOccurrencePath=function(t){if(e.is(t,"function")&&t(this),!this.isRoot()&&this.getParent()){var s=this.getParent().getOccurrencePath(t);return s.push(this.options.id),s.push(this.options.data.relationToIssue),s}return[this.options.id]},s.prototype.getNodesById=function(e){var t={listOfNodesFound:[]};return this._getNodesById(e,t),t.listOfNodesFound},s.prototype._getNodesById=function(e,t){var s=!1;if(this.options.id===e)t.listOfNodesFound.push(this),s=!0;else{var n=this.getChildren();if(n)for(var i=0;i<n.length;i++)s=n[i]._getNodesById(e,t)||s}return s},s.prototype.matchSearchNavigation=function(){this.options.matchSearchNavigation=!0},s.prototype.unmatchSearchNavigation=function(){this.options.matchSearchNavigation=!1},s.prototype.getID=function(){return this.options.id},s.prototype.filterOut=function(){var e=this.isRoot()?this.getTreeDocument():this.getParent();null!==e&&(n(e),e.filterOutChild(this))},s.prototype.filterOutChild=function(t){var s=this.getChildren();if(s.indexOf(t)<0)throw new Error("This is not a child");var n=this._getChildrenFilterInfo(!0);if(!n.childrenBeforeFiltering){n.childrenBeforeFiltering=s&&s.length>0?s.slice(0):[];e.is(this._expandState)&&(n.expandStateBeforeFiltering={noExpandState:"noChildren",expandingState:"expanding",partiallyExpandedState:"partiallyExpanded",collapseState:"expanded",expandState:"collapsed"}[this._expandState])}t._getFilterInfo(!0).parentBeforeFiltering=this,e.is(this.removeChild,"function")?this.removeChild(t):this.removeRoot(t,!0,!0),e.is(this.setState,"function")&&this.setState({state:n.expandStateBeforeFiltering}),n.filteredOutChildren||(n.filteredOutChildren=[]),n.filteredOutChildren.push(t)},s.prototype.filterIn=function(e){var t=this._getFilterInfo();if(t&&t.parentBeforeFiltering){var s=t.parentBeforeFiltering;n(s),s.filterInChild(this)}if(!0===e){var i=null,o=this._getChildrenFilterInfo();(i=o&&o.childrenBeforeFiltering?o.childrenBeforeFiltering:this.getChildren())&&Array.isArray(i)&&i.forEach(function(t){t.filterIn(e)})}},s.prototype.filterInChild=function(t){var s=this._getChildrenFilterInfo();if(s&&s.childrenBeforeFiltering){var n=s.childrenBeforeFiltering.indexOf(t);if(n>=0){var i=t._getFilterInfo();if(i&&i.parentBeforeFiltering===this){var o=this.getChildren(),a=null;if(o&&Array.isArray(o))for(var r=0;r<o.length;r++){var l=o[r];if(s.childrenBeforeFiltering.indexOf(l)>n){a=l;break}}delete i.parentBeforeFiltering,t.options&&t.options.isRootAttached?!0===t.options.isRootAttached&&this.insertBefore(t,a):this.insertBefore(t,a),e.is(this.setState,"function")&&this.setState({state:s.expandStateBeforeFiltering}),t._removeFilterInfo();var c=s.filteredOutChildren.indexOf(t);s.filteredOutChildren.splice(c,1),0===s.filteredOutChildren.length&&this._removeChildrenFilterInfo()}}}},s.prototype._removeFilterInfo=function(){delete this.options._filterInfo},s.prototype._removeChildrenFilterInfo=function(){delete this.options._childrenFilterInfo},s.prototype._getFilterInfo=function(e){return!this.options._filterInfo&&e&&(this.options._filterInfo={}),this.options._filterInfo},s.prototype._getChildrenFilterInfo=function(e){return!this.options._childrenFilterInfo&&e&&(this.options._childrenFilterInfo={}),this.options._childrenFilterInfo},s}),define("DS/IssueComponents/reopen/Reopen",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f,h,g){"use strict";var v="Closed";return t.extend({name:"DS/IssueComponents/reopen/Reopen",tag:"div",className:"isu-reopen-view",_logger:null,defaultOptions:{physicalIds:[]},physicalIds:[],issues:{},titles:[],names:[],indelible:[],modal:null,validate:null,isLoaded:null,_deferred:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s._logger=l.getLogger("DS/IssueComponents/components"),s._logger.log("Initializing the reopen component"),s.issues={},s.titles=[],s.names=[],s.indelible=[],s.fields={},s.validate=null,s.modal=null,s.isLoaded=null,s._deferred={resolve:null,reject:null},s.isLoaded=new e(function(e,t){s._deferred.resolve=e,s._deferred.reject=t})},render:function(){return f.start(this.name+" render"),this.dialog().then(this._deferred.resolve,this._deferred.reject),f.end(this.name+" render"),this},destroy:function(){f.start(this.name+" destroy"),this.physicalIds=[],this.issues={},this.titles=[],this.names=[],this.indelible=[],this.fields={},this.validate=null,this.modal.destroy(),this.modal=null,this.isLoaded=null,this._deferred={resolve:null,reject:null},f.end(this.name+" destroy")},dialog:function(){var e=this,t=u.get("widget");return o.mask(e.container),e.modal=new r({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"isu-reopen-dialog",title:g.reopen.preparing,header:null,body:e.container,footer:[e.validate=new n({value:g.reopen.reopen,className:"primary",events:{onClick:function(){e.reopen().then(function(){e.destroy()})}},disabled:!0}),new n({value:g.reopen.cancel,events:{onClick:function(){e.destroy()}}})],events:{onClose:function(){e.destroy()}}}).inject(t.body),e.build().then(function(t){t.inject(e.container),e.physicalIds.length>0?(e.validate.enable(),e.modal.setTitle(g.replace(g.reopen.title,{number:e.physicalIds.length})),0===e.indelible.length&&(e.container.getElement(".isu-reopen-no-issues-label").addClassName("hidden"),e.container.getElement(".isu-reopen-no-issues-content").addClassName("hidden"))):(e.validate.disable(),e.modal.setTitle(g.reopen.nothing),e.container.getElement(".isu-reopen-label").addClassName("hidden"),e.container.getElement(".isu-reopen-content").addClassName("hidden")),e.validate.focus(),o.unmask(e.container),new a({element:e.container}).inject(e.modal.getBody())})},build:function(){var e=this;return f.start(e.name+" build"),e._check(e.getOption("physicalIds")).then(function(t){var n="";s.is(t,"object")&&s.is(t.closable,"array")&&1===t.closable.length&&(n=t.closable[0].resolutionRecommendation);for(var o=s.createElement("div",{class:"isu-reopen-form",html:[{tag:"h5",class:"",html:g.create.properties.labels.resolutionRecommendation},e.fields.resolutionRecommendation=new i({name:"isu-reopen-resolution-recommendation ",id:"isu-reopen-resolution-recommendation",className:"isu-reopen-resolution-recommendation",value:n,multiline:!0,required:!1,placeholder:g.create.properties.labels.resolutionRecommendationPlaceholder})]}),a=t.closable,r=t.indelible,l={physicalIds:[],titles:[],icons:[]},c=0;c<a.length;c++)l.physicalIds.push(a[c].physicalId),l.titles.push(a[c].title+" ("+a[c].name+")"),l.icons.push({tag:"span",class:"fonticon fonticon-issue-type "+a[c].state.toLowerCase()});var d=[];l.titles.forEach(function(e,t){d.push(s.createElement("li",{html:[l.icons[t],s.String.escapeHTML(e)],title:e}))});for(var u={physicalIds:[],titles:[],icons:[]},m=0;m<r.length;m++)u.physicalIds.push(r[m].physicalId),u.titles.push(r[m].title+" ("+r[m].name+")"),u.icons.push({tag:"span",class:"fonticon fonticon-issue-type "+r[m].state.toLowerCase()});var p=[];u.titles.forEach(function(e,t){p.push(s.createElement("li",{html:[u.icons[t],s.String.escapeHTML(e)],title:e}))}),e.physicalIds=l.physicalIds,e.titles=l.titles,e.indelible=u.physicalIds,f.end(e.name+" build");var h=s.createElement("div",{class:"isu-reopen-list",html:[{tag:"div",class:"isu-reopen-label",html:[{tag:"span",class:"isu-reopen-label-first",html:g.reopen.warning},{tag:"span",class:"isu-reopen-label-second",html:g.reopen.closable}]},{tag:"div",class:"isu-reopen-content",html:s.createElement("ul",{html:d,class:"isu-reopen-content-list"})},{tag:"div",class:"isu-reopen-no-issues-label",html:g.reopen.indelible},{tag:"div",class:"isu-reopen-no-issues-content",html:s.createElement("ul",{html:p,class:"isu-reopen-no-issues-content-list"})}]}),v=s.createElement("div",{html:[]});return e.physicalIds.length>0&&o.inject(v),h.inject(v),v})},_check:function(e){var t=this;return f.start(t.name+" _check"),p.issues.retrieve({data:{objects:e.map(function(e){return{physicalId:e}})}}).then(function(e){for(var s={closable:[],indelible:[]},n=0;n<e.results.length;n++){var i=e.results[n].body;!0===t.utils.isReopenable(i)?s.closable.push({physicalId:i.physicalId,name:i.name,state:i.state,title:i.title?i.title:"",resolutionRecommendation:i.resolutionRecommendation}):s.indelible.push({physicalId:i.physicalId,name:i.name,state:i.state,title:i.title?i.title:"",resolutionRecommendation:i.resolutionRecommendation})}return t.issues=s,f.end(t.name+" _check"),s},function(e){t._logger.error(e),c.displayNotification({msg:g.reopen.error,eventID:"error"}),f.end(t.name+" _check")})},reopen:function(){var e=this;f.start(e.name+" reopen");var t=u.get("widget");o.mask(t.body);var s=e.fields.resolutionRecommendation.getValue().trim();return p.issues.reopen({data:{objects:e.physicalIds.map(function(e){var t={physicalId:e};return""!==s&&(t.resolutionRecommendation=s),t})}}).then(function(s){var n=[],i=[];s.results.forEach(e=>{e.body&&e.body.error&&e.body.error.length>0&&e.body.error.forEach(e=>{n.includes(e)||n.push(e)}),e.body&&e.body.warning&&e.body.warning.length>0&&e.body.warning.forEach(e=>{i.includes(e)||i.push(e)})});var a="";a=1===e.physicalIds.length&&0==n.length&&0==i.length?g.replace(g.reopen.singleSuccess,{title:e.titles[e.titles.length-1]}):g.replace(g.reopen.multipleSuccess,{number:""}),o.unmask(t.body);const r=e.physicalIds.length-i.length-n.length;if(i.length>0&&0==r){a="";i.forEach(e=>{a+=e}),n.forEach(e=>{a+=warning}),c.displayNotification({msg:a,eventID:"warning"})}else if(n.length>0&&0==r){a="";n.forEach(e=>{a+=e}),c.displayNotification({msg:a,eventID:"error"})}else(i.length>0||n.length>0)&&0!=r?c.displayNotification({msg:g.successPartial,eventID:"warning"}):c.displayNotification({msg:a,eventID:"success"});var l=e.physicalIds.reduce(function(e,t){return e.push([t]),e},[]),u=e.physicalIds.reduce(function(t,s,n){return t[s]=e.issues.closable[n],t[s].state="Create",t[s].type="Issue",t[s].modifiedAttributes=["state"],t},{});f.end(e.name+" reopen"),d.publish("DS/Object/update",{metadata:{appId:t.id,appName:t.name,timestamp:Math.floor(Date.now())},data:{paths:l,attributes:u},version:"1.0"})},function(s){if(o.unmask(t.body),s.error&&s.error.internal&&s.error.internal.includes("You do not have the permissions to perform this action")){var n=h.getErrorMessage("1005");h.displayErrorMessage(n,"error")}else c.displayNotification({msg:s.error.message,eventID:"error"});f.end(e.name+" reopen"),e._logger.error("Cannot reopen the selected issue(s) because %o",s)})},utils:{isReopenable:function(e){return e.state===v}}})}),define("DS/IssueComponents/team/MembersMenu",["UWA/Core","DS/IssueServices/services/PlatformServices","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,s,n,i,o){"use strict";var a={showRMBMenuOnGrid:function(e,s){return new Promise(function(n,i){var o={},r=s.cellInfos.nodeModel.getTreeDocument().getSelectedNodes(),l=r[0].options.grid.roles;o.currentObjType=r[0].options.grid.type;var c=0,d=[];require(["DS/IssueComponents/team/MembersDataGridLayout"],function(i){l.indexOf("Co-owner")>=0?(o.Coowner="DISCONNECT",c++):o.Coowner="CONNECT",l.indexOf("Contributor")>=0?(o.Contributor="DISCONNECT",c++):o.Contributor="CONNECT",l.indexOf("Assignee")>=0?(o.Assignee="DISCONNECT",c++):o.Assignee="CONNECT",l.indexOf("InformedUser")>=0?(o.InformedUser="DISCONNECT",c++):o.InformedUser="CONNECT";var u=l.indexOf("Owner")>=0,m="Owner"===s.cellInfos.nodeModel.getParent().options.grid.role;if(1==r.length){if(1==i.issues.length){if(u||1!=c||(o.showConfirmation=!0),"group"!==s.cellInfos.nodeModel.options.grid.type){var p=t.getUserName(),f=i.issues[0].coOwners.filter(function(e){return e.user===p});(p===i.issues[0].owner.user||f.length>0)&&(u||d.push(a.getCoownerMenu(e,s,o)))}d.push(a.getAssigneeMenu(e,s,o)),"group"!==s.cellInfos.nodeModel.options.grid.type&&d.push(a.getContributorMenu(e,s,o)),d.push(a.getInformedUserMenu(e,s,o)),d.push({type:"SeparatorItem"})}m&&d.push(a.getChangeOwnerMenu(e,s,o)),""!==t.get3DSwymUrl()&&"group"!==s.cellInfos.nodeModel.options.grid.type&&d.push(a.getViewProfileMenu(e,s,o))}if(i.issues.length>1){var h=s.cellInfos.nodeModel.options.grid.common,g=s.cellInfos.nodeModel.options.grid.isRoot;u="Owner"===s.cellInfos.nodeModel.getParent().options.grid.role;if(1!=r.length||g||u||h){if(r.length>1){var v=r.every(function(e){return"Owner"===e.getParent().options.grid.role}),b=r.every(function(e){return void 0===e.options.grid.common||e.options.grid.common});v||b||d.push(a.getPropagateMenu(e,r,o))}}else d.push(a.getPropagateMenu(e,r,o))}u=l.indexOf("Owner")>=0;(1==r.length&&(!u||l.length>1)||r.length>1)&&d.push(a.getRemoveMenu(e,s,o)),n(d)})})},getCoownerMenu:function(e,t,s){var n={type:"CheckItem",title:o.team.menu.coowner,tooltip:o.create.team.labels.coOwnersHelper,action:{callback:function(){require(["DS/IssueComponents/team/MembersDataGridLayout"],function(e){s.role="Coowner",e.updatePersonRole(t.cellInfos,s)})}}};return"DISCONNECT"==s.Coowner&&(n.state="selected"),n},getContributorMenu:function(e,t,s){var n={type:"CheckItem",title:o.team.menu.contributor,tooltip:o.create.team.labels.contributorHelper,action:{callback:function(){require(["DS/IssueComponents/team/MembersDataGridLayout"],function(e){s.role="Contributor",e.updatePersonRole(t.cellInfos,s)})}}};return"DISCONNECT"==s.Contributor&&(n.state="selected"),n},getAssigneeMenu:function(e,t,s){var n={type:"CheckItem",title:o.team.menu.assignee,tooltip:o.create.team.labels.assigneesHelper,action:{callback:function(){require(["DS/IssueComponents/team/MembersDataGridLayout"],function(e){s.role="Assignee",e.updatePersonRole(t.cellInfos,s)})}}};return"DISCONNECT"==s.Assignee&&(n.state="selected"),n},getInformedUserMenu:function(e,t,s){var n={type:"CheckItem",title:o.team.menu.informedUser,tooltip:o.create.team.labels.informedUserHelper,action:{callback:function(){require(["DS/IssueComponents/team/MembersDataGridLayout"],function(e){s.role="InformedUser",e.updatePersonRole(t.cellInfos,s)})}}};return"DISCONNECT"==s.InformedUser&&(n.state="selected"),n},getRemoveMenu:function(e,t,s){var a={type:"PushItem",title:o.team.menu.remove,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove"},action:{callback:function(){require(["DS/IssueComponents/team/MembersDataGridLayout"],function(e){s.role=[],s.role.push("Contributor"),s.role.push("Coowner"),s.role.push("Assignee"),s.role.push("InformedUser"),s.Coowner="DISCONNECT",s.Assignee="DISCONNECT",s.Contributor="DISCONNECT",s.InformedUser="DISCONNECT",s.showConfirmation=!0,s.remove=!0,e.updatePersonRole(t.cellInfos,s)})}}};try{var r=i.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:r,pd3:"MembersActions",pd4:"Remove",pd5:"Issue/"+r+"/MembersActions/Remove"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"MembersActions"}})}catch(e){}return a},getViewProfileMenu:function(e,s,n){return{type:"PushItem",title:o.team.menu.profile,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-eye"},action:{callback:function(){t.getUserProfile(s.cellInfos.nodeModel.options.grid.user)}}}},getPropagateMenu:function(e,t,s){return{type:"PushItem",title:o.team.menu.propagate,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-propagate"},action:{callback:function(){require(["DS/IssueComponents/team/MembersDataGridLayout"],function(e){e.propagateMember(t)})}}}},getChangeOwnerMenu:function(e,t,a){return{type:"PushItem",title:o.team.menu.changeOwner,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-user-change"},action:{callback:function(){s.getCommand("ChangeOwner").begin();try{var e=i.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"MembersActions",pd4:"ChangeOwner",pd5:"Issue/"+e+"/MembersActions/ChangeOwner"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"MembersActions"}})}catch(e){}}}}}};return a}),define("DS/IssueComponents/close/Close",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/Controls/ComboBox","DS/Controls/Editor","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f,h,g,v,b){"use strict";var C="Closed",y="Issue Resolved",I="Issue Cancelled";return t.extend({name:"DS/IssueComponents/close/Close",tag:"div",className:"isu-close-view",_logger:null,defaultOptions:{physicalIds:[]},physicalIds:[],issues:{},titles:[],names:[],indelible:[],modal:null,validate:null,isLoaded:null,_deferred:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s._logger=d.getLogger("DS/IssueComponents/components"),s._logger.log("Initializing the close component"),s.issues={},s.titles=[],s.names=[],s.indelible=[],s.fields={},s.validate=null,s.modal=null,s.isLoaded=null,s._deferred={resolve:null,reject:null},s.isLoaded=new e(function(e,t){s._deferred.resolve=e,s._deferred.reject=t})},render:function(){return g.start(this.name+" render"),this.dialog().then(this._deferred.resolve,this._deferred.reject),g.end(this.name+" render"),this},destroy:function(){g.start(this.name+" destroy"),this.physicalIds=[],this.issues={},this.titles=[],this.names=[],this.indelible=[],this.fields={},this.validate=null,this.modal.destroy(),this.modal=null,this.isLoaded=null,this._deferred={resolve:null,reject:null},g.end(this.name+" destroy")},dialog:function(){var t=this;p.get("widget")||window.widget;return o.mask(t.container),t.build().then(function(s){if(0==t.listOfDropdownElement)return u.displayNotification({msg:b.completionNotAllowed,eventID:"error"}),new e(e=>{e()});if(t.createDialog(),s.inject(t.container),t.physicalIds.length>0&&t.listOfDropdownElement.length>0){t.validate.enable();var n="";n=t.physicalIds.length>1?b.replace(b.close.titleMultiple,{number:t.physicalIds.length}):b.replace(b.close.titleSingle,{number:t.physicalIds.length}),t.modal.setTitle(n),0===t.indelible.length&&(t.container.getElement(".isu-close-no-issues-label").addClassName("hidden"),t.container.getElement(".isu-close-no-issues-content").addClassName("hidden"))}else t.validate.disable(),t.modal.setTitle(b.close.nothing),t.container.getElement(".isu-close-label").addClassName("hidden"),t.container.getElement(".isu-close-content").addClassName("hidden");t.validate.focus(),o.unmask(t.container),new a({element:t.container}).inject(t.modal.getBody())})},build:function(){var e=this;return g.start(e.name+" build"),e._check(e.getOption("physicalIds")).then(function(t){var n=t.closable,i=t.indelible,o=e.getToBeClosedInfo(n);e.listOfDropdownElement=e.getDropdownElement(o);var a=e.getComboboxForm(e.listOfDropdownElement);e.completionForm=e.getCompletionForm(t,e.fields.myComboBox.value);var r=[];o.titles.forEach(function(e,t){r.push(s.createElement("li",{html:[o.icons[t],s.String.escapeHTML(e)],title:e}))});for(var l={physicalIds:[],titles:[],icons:[]},c=0;c<i.length;c++)l.physicalIds.push(i[c].physicalId),l.titles.push(i[c].title+" ("+i[c].name+")"),l.icons.push({tag:"span",class:"fonticon fonticon-issue-type "});var d=[];l.titles.forEach(function(e,t){d.push(s.createElement("li",{html:[l.icons[t],s.String.escapeHTML(e)],title:e}))}),e.physicalIds=o.physicalIds,e.titles=o.titles,e.indelible=l.physicalIds,g.end(e.name+" build");var u=s.createElement("div",{class:"isu-close-list",html:[{tag:"div",class:"isu-close-label",html:[{tag:"span",class:"isu-close-label-first",html:b.close.warning},{tag:"span",class:"isu-close-label-second",html:b.close.closable}]},{tag:"div",class:"isu-close-content",html:s.createElement("ul",{html:r,class:"isu-close-content-list"})},{tag:"div",class:"isu-close-no-issues-label",html:b.close.indelible},{tag:"div",class:"isu-close-no-issues-content",html:s.createElement("ul",{html:d,class:"isu-close-no-issues-content-list"})}]}),m=s.createElement("div",{html:[]});return e.physicalIds.length>0&&(a.inject(m),e.completionForm.inject(m),e.ele=e.completionForm.getElementsByClassName("isu-completion-form-required-label highlight wux-ui-3ds-required wux-ui-3ds")[0],1==o.allowedClosureTypes.length&&o.allowedClosureTypes[0]===y&&(e.ele.hide(),e.fields.completionStatement.requiredFlag=!1)),u.inject(m),m})},getToBeClosedInfo:function(e){for(var t={physicalIds:[],titles:[],icons:[],allowedClosureTypes:[]},s=0;s<e.length;s++){t.physicalIds.push(e[s].physicalId),t.titles.push(e[s].title+" ("+e[s].name+")"),t.icons.push({tag:"span",class:"fonticon fonticon-issue-type "});for(var n=0;n<e[s].allowedClosureTypes.length;n++)t.allowedClosureTypes.includes(e[s].allowedClosureTypes[n])||t.allowedClosureTypes.push(e[s].allowedClosureTypes[n])}return t},getDropdownElement:function(e){for(var t=[],s=0;s<e.allowedClosureTypes.length;s++){var n=e.allowedClosureTypes[s];if(n){var i={label:n===I?b[I]:b[y],value:n===I?I:y};t[s]=i}}return t},getComboboxForm:function(e){var t=this,n=s.createElement("div",{class:"isu-close-comboboxForm",html:[{tag:"h5",class:"",html:b.completionType},t.fields.myComboBox=new r({enableSearchFlag:!1,elementsList:e,value:e.length>1?I:e[0],selectedIndex:1,disabled:!(e.length>1)})]});return n.addEventListener("change",function(e){var s=t.fields.myComboBox.value;s===y&&(t.ele.hide(),t.fields.completionStatement.requiredFlag=!1),s===I&&(t.ele.show(),t.fields.completionStatement.requiredFlag=!0)}),n},_check:function(e){var t=this;return g.start(t.name+" _check"),h.issues.retrieve({data:{objects:e.map(function(e){return{physicalId:e}})}}).then(function(e){for(var s={closable:[],indelible:[]},n=0;n<e.results.length;n++){var i=e.results[n].body;!0===t.utils.isClosable(i)?s.closable.push({physicalId:i.physicalId,name:i.name,state:i.state,title:i.title?i.title:"",resolutionStatement:i.resolutionStatement,allowedClosureTypes:i.allowedClosureTypes}):s.indelible.push({physicalId:i.physicalId,name:i.name,state:i.state,title:i.title?i.title:"",resolutionStatement:i.resolutionStatement})}return t.issues=s,g.end(t.name+" _check"),s},function(e){t._logger.error(e),u.displayNotification({msg:b.close.error,eventID:"error"}),g.end(t.name+" _check")})},close:function(){var t=this;g.start(t.name+" close");var n=p.get("widget")||window.widget;o.mask(n.body);var i="",a=t.fields.myComboBox.value;return a===y&&t.fields.completionStatement.value&&(i=t.fields.completionStatement.value.trim()),a===I&&(t.fields.completionStatement.value&&(i=t.fields.completionStatement.value.trim()),0===i.length)?new e(function(e,t){u.displayNotification({msg:b.create.validationFailed,eventID:"error"}),o.unmask(n.body),t()}):h.issues.close({data:{objects:t.physicalIds.map(function(e){var s={physicalId:e};return""!==i&&(s.resolutionStatement=i),s.completionType=t.fields.myComboBox.value,s})}}).then(function(e){var s=[],i=[];e.results.forEach(e=>{e.body&&e.body.error&&e.body.error.length>0&&e.body.error.forEach(e=>{s.includes(e)||s.push(e)}),e.body&&e.body.warning&&e.body.warning.length>0&&e.body.warning.forEach(e=>{i.includes(e)||i.push(e)})});var a="";a=1===t.physicalIds.length&&0==s.length&&0==i.length?b.replace(b.close.singleSuccess,{title:t.titles[t.titles.length-1]}):b.replace(b.close.multipleSuccess,{number:""}),o.unmask(n.body);const r=t.physicalIds.length-i.length-s.length;if(i.length>0&&0==r){a="";i.forEach(e=>{a+=e}),s.forEach(e=>{a+=warning}),u.displayNotification({msg:a,eventID:"warning"})}else if(s.length>0&&0==r){a="";s.forEach(e=>{a+=e}),u.displayNotification({msg:a,eventID:"error"})}else(i.length>0||s.length>0)&&0!=r?u.displayNotification({msg:b.successPartial,eventID:"warning"}):u.displayNotification({msg:a,eventID:"success"});var l=t.physicalIds.reduce(function(e,t){return e.push([t]),e},[]),c=t.physicalIds.reduce(function(e,s,n){return e[s]=t.issues.closable[n],e[s].state="Closed",e[s].type="Issue",e[s].modifiedAttributes=["state"],e},{});g.end(t.name+" close"),m.publish("DS/Object/update",{metadata:{appId:n.id,appName:n.name,timestamp:Math.floor(Date.now())},data:{paths:l,attributes:c},version:"1.0"})},function(e){o.unmask(n.body);var i="";if(e&&e.error&&s.is(e.error.message,"string")&&(i=e.error.message),e.error&&e.error.internal&&e.error.internal.includes("You do not have the permissions to perform this action")){var a=v.getErrorMessage("1005");v.displayErrorMessage(a,"error")}else if(i.includes("Action Taken and Resolution Statement are not filled in")){var r=v.getErrorMessage("5");v.displayErrorMessage(r,"error")}else if(i.includes("Action Taken field is not filled in")){r=v.getErrorMessage("6");v.displayErrorMessage(r,"error")}else if(i.includes("Resolution Statement field is not filled in")){r=v.getErrorMessage("7");v.displayErrorMessage(r,"error")}else if(i.includes("Resolution Date is not filled in")){r=v.getErrorMessage("8");v.displayErrorMessage(r,"error")}else u.displayNotification({msg:e.error.message,eventID:"error"});g.end(t.name+" close"),t._logger.error("Cannot close the selected issue(s) because %o",e)})},getCompletionForm:function(e,t){var n,i="";return s.is(e,"object")&&s.is(e.closable,"array")&&1===e.closable.length&&(i=e.closable[0].resolutionStatement),n=s.createElement("div",{class:"isu-completion-form",html:[s.createElement("h5",{class:"isu-completion-header",html:[s.createElement("span",{tag:"h5",class:"isu-completion-statement-label",html:b.cancellationStatement}),s.createElement("span",{class:"isu-completion-form-required-label highlight wux-ui-3ds-required wux-ui-3ds"})]})]}),this.fields.completionStatement=new l({value:i,enableSearchFlag:!1,widthInCharNumber:100,nbRows:2,newLineMode:"shiftEnter",requiredFlag:t==I,resizableFlag:!0}),this.fields.completionStatement._myInput.setStyle("width","100%"),this.fields.completionStatement.inject(n),n},utils:{isClosable:function(e){return e.state!==C}},createDialog:function(){var e=this;e.modal=new c({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"isu-close-dialog",title:b.close.preparing,header:null,body:e.container,footer:[e.validate=new n({value:b.close.close,className:"primary",events:{onClick:function(){e.close().then(function(){e.destroy()}).catch(e=>{console.log(e)})}},disabled:!0}),new n({value:b.close.cancel,events:{onClick:function(){e.destroy()}}})],events:{onClose:function(){e.destroy()}}}).inject(widget.body)}})}),define("DS/IssueComponents/related/RelatedContentActionBar",["DS/IssueServices/Contexts","DS/IssueCommon/utils/Utils","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,s){var n=Object.create(null);return n.toolbar=null,n.viewData={menu:[{type:"PushItem",title:s.toolbar.ISU_TOOLTIP_GRID_VIEW,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-view-list"},action:{module:"DS/ENOChgActionGridUX/scripts/View/ChgDataGridLayout",func:"changeView"},tooltip:s.toolbar.ISU_TOOLTIP_GRID_VIEW},{type:"PushItem",title:s.toolbar.ISU_TOOLTIP_TILE_VIEW,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-view-small-tile"},action:{module:"DS/ENOChgActionGridUX/scripts/View/ChgTileViewLayout",func:"changeView"},tooltip:s.toolbar.ISU_TOOLTIP_TILE_VIEW}]},n.writetoolbarDefination=function(e){var t={entries:[{id:"customViewSettings",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"cog",fontIconFamily:1},action:{module:"DS/IssueComponents/related/RelatedContentActionBar",func:"customViewSettings"},category:"settings",readOnly:!1,position:"far",tooltip:s.toolbar.columnSettings}},{id:"addExistingCommand",dataElements:{typeRepresentation:"functionMenuIcon",icon:{iconName:"plus",fontIconFamily:1},category:"add",readOnly:!1,position:"far",tooltip:s.toolbar.addCommand},children:[{id:"addAffectedItem",dataElements:{typeRepresentation:"PushItem",label:s.toolbar.addAffectedItem,action:{module:"DS/IssueComponents/related/RelatedContentActionBar",func:"addAffectedItem"},icon:{iconName:"location",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"0.75x"}}},{id:"addContexts",dataElements:{typeRepresentation:"PushItem",label:s.toolbar.addContexts,action:{module:"DS/IssueComponents/related/RelatedContentActionBar",func:"addContexts"},icon:{iconName:"3d-object",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"0.75x"}}},{id:"addResolvedItems",dataElements:{typeRepresentation:"PushItem",label:s.toolbar.addResolvedItems,action:{module:"DS/IssueComponents/related/RelatedContentActionBar",func:"addResolvedItems"},icon:{iconName:"markup-review",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"0.75x"}}},{id:"addResolvedby",dataElements:{typeRepresentation:"PushItem",label:s.toolbar.addResolvedBy,action:{module:"DS/IssueComponents/related/RelatedContentActionBar",func:"addResolvedBy"},icon:{iconName:"docs",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"0.75x"}}}]},{id:"pickCommand",dataElements:{typeRepresentation:"functionMenuIcon",icon:{iconName:"location",fontIconFamily:1},category:"add",readOnly:!1,position:"far",tooltip:s.toolbar.pickCommand},children:[{id:"pickAffectedItem",dataElements:{typeRepresentation:"PushItem",label:s.toolbar.pickAffectedItem,action:{module:"DS/IssueComponents/related/RelatedContentActionBar",func:"pickAffectedItem"},icon:{iconName:"location",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"0.75x"}}},{id:"pickContexts",dataElements:{typeRepresentation:"PushItem",label:s.toolbar.pickContext,action:{module:"DS/IssueComponents/related/RelatedContentActionBar",func:"pickContexts"},icon:{iconName:"3d-object",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"0.75x"}}},{id:"pickResolvedItems",dataElements:{typeRepresentation:"PushItem",label:s.toolbar.pickResolvedItems,action:{module:"DS/IssueComponents/related/RelatedContentActionBar",func:"pickResolvedItems"},icon:{iconName:"markup-review",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"0.75x"}}}]}]};return JSON.stringify(t)},n.pickAffectedItem=function(s){s._event="pickAffectedItem",n.toolbar.onToolbarClickCallback(s);var i=e.get("component").getCurrentView();try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"ContentToolbar",pd4:"PickAffectedItemsUsingSelector",pd5:"Issue/"+i+"/ContentToolbar/PickAffectedItemsUsingSelector"}})}catch(e){}},n.pickResolvedBy=function(e){e._event="pickResolvedBy",n.toolbar.onToolbarClickCallback(e)},n.pickResolvedItems=function(s){s._event="pickResolvedItems",n.toolbar.onToolbarClickCallback(s);var i=e.get("component").getCurrentView();try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"ContentToolbar",pd4:"PickResolvedItemsUsingSelector",pd5:"Issue/"+i+"/ContentToolbar/PickResolvedItemsUsingSelector"}})}catch(e){}},n.pickContexts=function(s){s._event="pickContexts",n.toolbar.onToolbarClickCallback(s);var i=e.get("component").getCurrentView();try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"ContentToolbar",pd4:"PickContextsUsingSelector",pd5:"Issue/"+i+"/ContentToolbar/PickContextsUsingSelector"}})}catch(e){}},n.addAffectedItem=function(s){s._event="addAffectedItem",n.toolbar.onToolbarClickCallback(s);var i=e.get("component").getCurrentView();try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"ContentToolbar",pd4:"AddAffectedItemsUsingSearch",pd5:"Issue/"+i+"/ContentToolbar/AddAffectedItemsUsingSearch"}})}catch(e){}},n.addResolvedBy=function(s){s._event="addResolvedBy",n.toolbar.onToolbarClickCallback(s);var i=e.get("component").getCurrentView();try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"ContentToolbar",pd4:"AddResolvedByUsingSearch",pd5:"Issue/"+i+"/ContentToolbar/AddResolvedByUsingSearch"}})}catch(e){}},n.addResolvedItems=function(s){s._event="addResolvedItems",n.toolbar.onToolbarClickCallback(s);var i=e.get("component").getCurrentView();try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"ContentToolbar",pd4:"AddResolvedItemsUsingSearch",pd5:"Issue/"+i+"/ContentToolbar/AddResolvedItemsUsingSearch"}})}catch(e){}},n.addContexts=function(s){s._event="addContexts",n.toolbar.onToolbarClickCallback(s);var i=e.get("component").getCurrentView();try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"ContentToolbar",pd4:"AddContextsUsingSearch",pd5:"Issue/"+i+"/ContentToolbar/AddContextsUsingSearch"}})}catch(e){}},n.customViewSettings=function(s){s._event="customViewSettings",n.toolbar.onToolbarClickCallback(s);var i=e.get("component").getCurrentView();try{t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"ContentToolbar",pd4:"CustomView",pd5:"Issue/"+i+"/ContentToolbar/CustomView"}})}catch(e){}},n}),define("DS/IssueComponents/helper/Helper",["UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Scroller","DS/UIKIT/Toggler","DS/ENOFloatingPanel/ENOFloatingPanel","DS/IssueComponents/utils/Utils","DS/WebappsUtils/WebappsUtils","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r){"use strict";var l="Create",c="Assign",d="Active",u="Review",m="Closed",p="minimized";return{name:"DS/IssueComponents/helper/Helper",show:function(t){var n=this;if(n.modal)return null;var o=e.createElement("div",{class:"helper-dialog-body",html:n.getDialogBody()}),a=new i({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!1,resizable:!0,visible:!0,persistId:"ISUHelper",className:"helper-dialog",title:r.helper.dialog.title,header:null,body:o,events:{onClose:function(){a.destroy(),n.modal=null,n.views=null}}}).inject(t),l=e.createElement("span",{class:"right-actions minimize fonticon fonticon-minus"}),c=a.rightButtons.querySelector(".fonticon-cancel");a.rightButtons.insertBefore(l,c),l.addEventListener("click",function(){n.minimize()}),n.views.minimize={},n.views.minimize.icon=l,a.addEvent("onResizeFloating",function(){"44px"!==a.elements.container.getStyle("height")&&n.views.minimize.icon.hasClassName(p)&&n.views.minimize.icon.removeClassName(p)});var d=new s({element:n.views.contentsBody});return a.show(),n.modal=a,d},getBody:function(){for(var t=e.createElement("div",{class:"tooltip-header-body"}),s=[],n=[l,c,d,u,m],i=0;i<n.length;i++){var o="";i===n.length-1&&(o="th-last-row"),s.push(this.getStateHelper(n[i],o))}var a=e.createElement("table");return a.setContent(s),t.setContent(a),t},getStateHelper:function(t,s){var n=[e.createElement("th",{class:"th-title "+s,html:e.createElement("span",{class:"state-title",html:e.createElement("span",{class:"state-content",html:r.maturity[t.toLowerCase()]}),styles:{"background-color":o.getColorByState(t)}})}),e.createElement("th",{class:"th-description "+s,html:e.createElement("span",{class:"state-description",html:r.helper.states[t.toLowerCase()]})})];return e.createElement("tr",{class:"helper-state",html:n})},getDialogBody:function(){var t=this,s=e.createElement("nav",{class:"tab",html:[e.createElement("li",{class:"tab-item active",id:"state",html:[e.createElement("span",{class:"fonticon fonticon-issue-type "}),r.helper.dialog.tabStates]}),e.createElement("li",{class:"tab-item",id:"shortcut",html:[e.createElement("span",{class:"fonticon fonticon-keyboard"}),r.helper.dialog.tabShortcuts]}),e.createElement("li",{class:"tab-item",id:"workflow",html:[e.createElement("span",{class:"fonticon fonticon-route"}),r.helper.dialog.workflow]})]}),i=new n({container:s,events:{onToggle:function(e){"id"in e&&(Object.keys(t.views.contents).forEach(function(e){t.views.contents[e].hide()}),t.views.contents[e.id].show())}}});t.views={},t.views.contents={},t.views.contents.state=t.state(),t.views.contents.shortcut=t.shortcut(),t.views.contents.workflow=t.workflow(),t.views.contents.shortcut.hide(),t.views.contents.workflow.hide();var o=e.createElement("div",{class:"helper-content-main",html:[t.views.contents.state,t.views.contents.shortcut,t.views.contents.workflow]});return t.views.contentsBody=o,[i,o]},workflow:function(){var t=this,s=e.createElement("div",{class:"helper-content-workflow helper-content-state"});t.lifecycle={Create:{name:"Create",type:"state",index:0,next:["route1","Closed"],organisation:"Reporting",previous:""},route1:{name:"Confirm",type:"route",index:1,organisation:"Reporting",next:["Assign"],previous:""},Assign:{name:"Assign",type:"state",index:2,organisation:"Responsible",next:["route2","Closed"],previous:""},route2:{name:"Approve",type:"route",index:3,organisation:"Responsible",next:["Active"],previous:"Create"},Active:{name:"Active",type:"state",index:4,organisation:"Responsible",next:["route3","Closed"],previous:""},route3:{name:"Confirm",type:"route",index:5,organisation:"Responsible",next:["Review"],previous:""},Review:{name:"Review",type:"state",index:6,organisation:"Reporting",next:["route4","Closed"],previous:""},route4:{name:"Approve",type:"route",index:7,organisation:"Reporting",next:["Closed"],previous:"Active"},Closed:{name:"Closed",type:"state",index:8,organisation:"Reporting",next:[],previous:""}};var n=Object.keys(t.lifecycle);t.grid=e.createElement("table",{class:"helper-workflow-grid"}).inject(s);var i=0,o=0,a=[];n.forEach(function(e){t.lifecycle[e].next.length>0&&(i=i+t.lifecycle[e].next.length-1),""!==t.lifecycle[e].previous&&(o+=1),t.lifecycle[e].organisation.length>0&&(a.includes(t.lifecycle[e].organisation)||a.push(t.lifecycle[e].organisation))});var l=a.length,c=n.length+2*(n.length-1)+1,d=i+o+5+l+2*(l-1),u=0,m=0;for(u=0;u<d;u++){var p=e.createElement("tr",{class:"helper-workflow-grid-row"}).inject(t.grid);for(m=0;m<c;m++)e.createElement("td",{class:"helper-workflow-grid-cell",html:e.createElement("div",{class:"lifecycle-cell-content"})}).inject(p)}t.grid.getElementsByTagName("tr")[11].setStyle("height","65px");var f=new Array(d);for(u=0;u<d;u++)f[u]=new Array(c);for(var h=0;h<d;h++)for(var g=0;g<c;g++)f[h][g]=t.grid.getChildren()[h].getChildren()[g].getElement(".lifecycle-cell-content");t.graphComponents.cells=f,t.nodes=[];var v=0===i?0:i+2;t.createNodes(f,v,a);var b={forward:t.grid.getChildren().length-1,reverse:1},C=[];t.nodes.forEach(function(e){var s=t.connectNodes(e,f,b);C=C.concat(s)});var y=[];if(a.length>1){var I=0,E=v+1;for(u=0;u<a.length;u++){var S={name:a[u],start:I,end:E};E=(I=S.end+1)+2,u===a.length-1&&(S.end=d-1),y.push(S)}t.grid.setStyle("background","#f9f9f9"),t.grid.setStyle("border","1px solid");var w=t.grid.getChildren();for(w.forEach(function(e){e.getChildren()[0].getChildren()[0].setStyle("width","30px"),e.getChildren()[0].setStyle("border-right","1px solid")}),u=0;u<y.length;u++){var T=y[u].name;for(I=y[u].start,E=y[u].end,m=I;m<=E;m++)if(u%2==0&&w[m].setStyle("background","#f0f8ff"),m===E){w[m].setStyle("border-bottom","1px solid");var D=w[m].getChildren()[0].getChildren()[0];y[u].caption=e.createElement("div",{class:"lifecycle-helper-caption-wrapper",html:e.createElement("div",{class:"lifecycle-helper-caption",html:r.lifecycle.orgs[T]})}).inject(D)}}}return s.show=function(){s.setStyle("display","table"),C.forEach(function(e){var t=0,s=0,n=0;e.end.c-e.start.c>0?(s=e.start.c,n=e.end.c):(s=e.end.c,n=e.start.c);for(var i=e.start.r,o=s+1;o<n;o++)t+=f[i][o].getSize().width;e.caption.setStyle("width",t)}),y.forEach(function(e){for(var t=0,s=e.start;s<=e.end-1;s++)t+=f[s][0].getSize().height;e.caption.setStyle("width",t),e.caption.setStyle("padding","15px"),e.caption.setStyle("transform-origin","left"),e.caption.setStyle("transform","rotate(-90deg)")})},s},createNodes:function(e,t,s){for(var n=Object.keys(this.lifecycle),i=1,o=0;o<n.length;o++){var a={},r=s.indexOf(this.lifecycle[n[o]].organisation),l=0;l=0!==r?t+r+2*r:t,a.cell=this.createNode(this.lifecycle[n[o]],l,i),a.index={r:l,c:i},a.state=this.lifecycle[n[o]],this.nodes.push(a),i+=3}},createNode:function(e,t,s){var n=null;return"state"===e.type?n=this.graphComponents.createStateNode(e,t,s):"route"===e.type&&(n=this.graphComponents.createRouteNode(e,t,s)),n},connectNodes:function(t,s,n){for(var i=this,o=t.state.next.length,a=0,l=0,c=0,d=0,u=[],m=null,p=function(e,t){return i.nodes.find(function(e){return e.state.index===t.index})},f=function(e,t){return i.nodes.find(function(e){return e.state.index===t.index})},h=0;h<o;h++){var g=i.lifecycle[t.state.next[h]],v=p(0,g),b=g.index-t.state.index,C=v.index.r-t.index.r;if(1===b)if(a=t.index.r,l=t.index.c+1,0===C){if(i.graphComponents.createHorizontalLine().inject(s[a][l]),l+=1,"Approve"===t.state.name){i.graphComponents.createHorizontalLine().inject(s[a][l]);var y=e.createElement("span",{class:"lifecycle-helper-caption",html:r.lifecycle.paths.approve}).inject(s[a][l]);y.setStyle("position","inherit"),y.setStyle("white-space","pre")}i.graphComponents.createHorizontalConnectorArrowRight(a,l)}else C>0?(i.graphComponents.createHorizontalConnector(0,"left",a,l,"start"),a=(m=i.graphComponents.createVerticalConnector(C-1,"down",a,l)).end.r,l=m.end.c,i.graphComponents.createHorizontalConnector(0,"Right",a,l,"start"),l+=1,i.graphComponents.createHorizontalConnectorArrowRight(a,l)):C<0&&(C=Math.abs(C),i.graphComponents.createHorizontalConnector(0,"left",a,l,"start"),a=(m=i.graphComponents.createVerticalConnector(C-1,"up",a,l)).end.r,l=m.end.c,i.graphComponents.createHorizontalConnector(0,"Right",a,l,"start"),l+=1,i.graphComponents.createHorizontalConnectorArrowRight(a,l));else if(b>1){var I=n.forward-t.index.r-1;b=v.index.c-t.index.c-1,n.forward=n.forward-1,a=t.index.r+1,l=t.index.c,a=(m=i.graphComponents.createVerticalConnector(I,"down",a,l,"end")).end.r,l=m.end.c,a=(m=i.graphComponents.createHorizontalConnector(b,"Right",a,l)).end.r,l=m.end.c,c=m.start.c+1,d=m.start.r,"Create"==t.state.name?m.caption=e.createElement("div",{class:"lifecycle-helper-caption-wrapper",html:e.createElement("div",{class:"lifecycle-helper-caption",html:r.draftStateToClose})}).inject(s[d][c]):m.caption=e.createElement("div",{class:"lifecycle-helper-caption-wrapper",html:e.createElement("div",{class:"lifecycle-helper-caption",html:r.lifecycle.paths.anyStateToClose})}).inject(s[d][c]),u.push(m),I=a-v.index.r-1,a=(m=i.graphComponents.createVerticalConnector(I-1,"up",a,l,"start")).end.r,l=m.end.c,a=(m=i.graphComponents.createVerticalConnectorArrowUp(a,l)).end.r,l=m.end.c}var E=i.lifecycle[t.state.previous];if(void 0!==E){var S=t.index.r-n.reverse-1,w=f(0,E);b=t.index.c-w.index.c-1,a=t.index.r-1,l=t.index.c,a=(m=i.graphComponents.createVerticalConnector(S,"up",a,l,"end")).end.r,l=m.end.c,a=(m=i.graphComponents.createHorizontalConnector(b,"Left",a,l)).end.r,l=m.end.c,c=m.end.c+1,d=m.start.r,m.caption=e.createElement("div",{class:"lifecycle-helper-caption-wrapper",html:e.createElement("div",{class:"lifecycle-helper-caption",html:r.lifecycle.paths.reject})}).inject(s[d][c]),u.push(m),S=w.index.r-a-1,a=(m=i.graphComponents.createVerticalConnector(S-1,"down",a,l,"start")).end.r,l=m.end.c,a=(m=i.graphComponents.createVerticalConnectorArrowDown(a,l)).end.r,l=m.end.c}}return u},state:function(){var t=e.createElement("div",{class:"helper-content helper-content-state"}),s=e.createElement("div",{class:"helper-content-header-container",html:e.createElement("div",{class:"helper-content-header-title",html:r.helper.dialog.tabStates})}),n=e.createElement("div",{class:"helper-content-body-container"}),i=function(t,s){var n=[e.createElement("th",{class:"th-title "+s,html:e.createElement("span",{class:"state-title",html:e.createElement("span",{class:"state-content",html:r.maturity[t.toLowerCase()]}),styles:{"background-color":o.getColorByState(t)}})}),e.createElement("th",{class:s,html:e.createElement("span",{class:"th-description",html:r.helper.dialog.states[t.toLowerCase()]})})];return e.createElement("tr",{class:"helper-state",html:n})};t.addContent(s),t.addContent(n);for(var a=[],p=[l,c,d,u,m],f=0;f<p.length;f++){var h="";f===p.length-1&&(h="th-last-row"),a.push(i(p[f],h))}var g=e.createElement("table");return g.setContent(a),n.addContent(g),t},shortcut:function(){var t=e.createElement("div",{class:"helper-content"}),s=function(t,s,n){var i=[e.createElement("th",{class:"th-helper-dialog-key "+n,html:e.createElement("span",{class:"default-helper-title key-shortcut-key",html:e.createElement("span",{class:"default-helper-content ",html:null!=r.helper.dialog.shortcut.key[s][t]||null!=r.helper.dialog.shortcut.key[s][t]?r.helper.dialog.shortcut.key[s][t]:""})})}),e.createElement("th",{class:n,html:e.createElement("span",{class:"th-helper-dialog-description",html:null!=r.helper.dialog.shortcut.detail[s][t]||null!=r.helper.dialog.shortcut.detail[s][t]?r.helper.dialog.shortcut.detail[s][t]:""})})];return e.createElement("tr",{class:"helper-state",html:i})},n=function(t,n,i,o){var a=e.createElement("div",{class:"helper-content-header-container",html:e.createElement("div",{class:"helper-content-header-title",html:n})}),r=e.createElement("div",{class:"helper-content-body-container default-content-body-container"});t.addContent(a),t.addContent(r);for(var l=[],c=0;c<i.length;c++){var d="";c===i.length-1&&(d="th-last-row"),l.push(s(i[c],o,d))}var u=e.createElement("table");u.setContent(l),r.addContent(u)};return n(t,r.helper.dialog.subtitleShortcuts,["arrowUp","arrowDown","arrowLeft","arrowRight","shiftArrow","ctrlA","ctrlC","delete","enter","ctrlEnter"],"shortcut"),n(t,r.helper.dialog.subtitleMouseOperation,["ctrlClick","shiftClick","doubleClick"],"mouse"),t},minimize:function(){this.views.minimize.icon.hasClassName(p)?(this.views.minimize.icon.removeClassName(p),this.modal.elements.container.setStyle("height",this.views.minimize.height)):(this.views.minimize.icon.addClassName(p),this.views.minimize.height=this.modal.elements.container.getStyle("height"),this.modal.elements.container.setStyle("height","44px"))},graphComponents:{createRouteNode:function(t,s,n){var i=a.getWebappsAssetUrl("IssueComponents","images/decisionBox.PNG");return e.createElement("div",{class:"lifecycle-decision-box",html:[e.createElement("img",{src:i}),e.createElement("div",{class:"route-content",html:r.routes[t.name.toLowerCase()]})]}).inject(this.cells[s][n])},createStateNode:function(t,s,n){return e.createElement("div",{class:"state-content",html:e.createElement("span",{class:"state-title",html:e.createElement("span",{class:"state-content",html:r.maturity[t.name.toLowerCase()]}),styles:{"background-color":o.getColorByState(t.name)}})}).inject(this.cells[s][n])},createHorizontalLine:function(){return e.createElement("div",{class:"lifecycle-horizontal-line",html:e.createElement("hr",{class:"horizontal-line"})})},createVerticalLine:function(){return e.createElement("div",{class:"lifecycle-vertical-line",html:e.createElement("div",{class:"vertical-line"})})},createVerticalConnector:function(e,t,s,n,i){return"up"===t?this.createVerticalConnectorUp(e,s,n,i):this.createVerticalConnectorDown(e,s,n,i)},createVerticalConnectorUp:function(t,s,n,i){var o={div:e.createElement("div"),start:{r:s,c:n},end:{r:s,c:n}};"end"!==i&&(this.createVerticalLine().inject(this.cells[s][n]).getChildren()[0].setStyle("height","50%"),s--);for(var a=0;a<t;a++)this.createVerticalLine().inject(this.cells[s][n]),s--;if("start"!==i){var r=this.createVerticalLine().inject(this.cells[s][n]);r.getChildren()[0].setStyle("height","50%"),r.style.transform="rotateZ(180deg)"}return o.end.r=s,o.end.c=n,o},createVerticalConnectorDown:function(t,s,n,i){var o={div:e.createElement("div"),start:{r:s,c:n},end:{r:s,c:n}};if("end"!==i){var a=this.createVerticalLine().inject(this.cells[s][n]);a.getChildren()[0].setStyle("height","50%"),a.style.transform="rotateZ(180deg)",s++}for(var r=0;r<t;r++)this.createVerticalLine().inject(this.cells[s][n]),s++;"start"!==i&&this.createVerticalLine().inject(this.cells[s][n]).getChildren()[0].setStyle("height","50%");return o.end.r=s,o.end.c=n,o},createHorizontalConnector:function(e,t,s,n,i){return"Right"===t?this.createHorizontalConnectorRight(e,s,n,i):this.createHorizontalConnectorLeft(e,s,n,i)},createHorizontalConnectorRight:function(t,s,n,i){var o={div:e.createElement("div"),start:{r:s,c:n},end:{r:s,c:n}};if("end"!==i){var a=this.createHorizontalLine().inject(this.cells[s][n]);a.getChildren()[0].setStyle("width","50%"),a.style.transform="rotate(180deg)"}n++;for(var r=0;r<t;r++)this.createHorizontalLine().inject(this.cells[s][n]),n++;"start"!==i&&this.createHorizontalLine().inject(this.cells[s][n]).getChildren()[0].setStyle("width","50%");return o.end.r=s,o.end.c=n,o},createHorizontalConnectorLeft:function(t,s,n,i){var o={div:e.createElement("div"),start:{r:s,c:n},end:{r:s,c:n}};"end"!==i&&this.createHorizontalLine().inject(this.cells[s][n]).getChildren()[0].setStyle("width","50%");n--;for(var a=0;a<t;a++)this.createHorizontalLine().inject(this.cells[s][n]),n--;if("start"!==i){var r=this.createHorizontalLine().inject(this.cells[s][n]);r.getChildren()[0].setStyle("width","50%"),r.style.transform="rotate(180deg)"}return o.end.r=s,o.end.c=n,o},createVerticalConnectorArrowUp:function(t,s){var n={div:e.createElement("div"),start:{r:t,c:s},end:{r:t,c:s}};return e.createElement("div",{class:"lifecycle-vertical-arrow-up",html:[e.createElement("div",{class:"lifecycle-vertical-line",html:e.createElement("div",{class:"vertical-line"})}),e.createElement("div"),{class:"lifecycle-helper-arrow",html:e.createElement("div",{class:"vertical-arrow-up"})}]}).inject(this.cells[t][s]),n.end.r=t,n.end.c=s,n},createVerticalConnectorArrowDown:function(t,s){var n={div:e.createElement("div"),start:{r:t,c:s},end:{r:t,c:s}};return e.createElement("div",{class:"lifecycle-vertical-arrow-down",html:[e.createElement("div",{class:"lifecycle-vertical-line",html:e.createElement("div",{class:"vertical-line"})}),e.createElement("div"),{class:"lifecycle-helper-arrow",html:e.createElement("div",{class:"vertical-arrow-down"})}]}).inject(this.cells[t][s]),n.end.r=t,n.end.c=s,n},createHorizontalConnectorArrowRight:function(t,s){e.createElement("div",{class:"lifecycle-horizontal-arrow-right",html:[this.createHorizontalLine(),e.createElement("div"),{class:"lifecycle-helper-arrow",html:e.createElement("div",{class:"lifecycle-arrow"})}]}).inject(this.cells[t][s])},createHorizontalConnectorArrowleft:function(t,s){e.createElement("div",{class:"lifecycle-horizontal-arrow-left",html:[e.createElement("div"),{class:"lifecycle-helper-arrow",html:e.createElement("div",{class:"lifecycle-arrow"}).setStyle("transform","rotate(180deg)")},this.createHorizontalLine()]}).inject(this.cells[t][s])}}}}),define("DS/IssueComponents/lifecycle/Lifecycle",["UWA/Class/View","UWA/Core","UWA/Class/Promise","DS/Logger/Logger","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Tooltip","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/PADUtils/views/PADAlert","DS/IssueAttachmentManager/components/Collection","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueAttachmentManager/views/UploadDialog","i18n!DS/IssueAttachmentManager/assets/nls/IssueAttachmentManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/create/Attachments","DS/IssueComponents/close/Close","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f,h,g,v,b,C,y,I){"use strict";var E={STATES:{CREATE:0,ASSIGN:1,ACTIVE:2,REVIEW:3,CLOSED:4},STATES_ORDER:{0:"CREATE",1:"ASSIGN",2:"ACTIVE",3:"REVIEW",4:"CLOSED"},STATES_VALUES:{CREATE:"Create",ASSIGN:"Assign",ACTIVE:"Active",REVIEW:"Review",CLOSED:"Closed"},CSS:{ELEMENTS:{GRAPH_CONTAINER:"im-lifecycle-graph-container",GRAPH_NOT_SUPPORTED:"im-lifecycle-graph-not-supported",GRAPH_NOT_SUPPORTED_TEXT:"im-lifecycle-graph-not-supported-text",GRAPH_ARIADNE:"im-lifecycle-graph-ariadne",GRAPH_ARIADNE_PLACEHOLDER:"im-lifecycle-graph-ariadne-placeholder",GRAPH_ARIADNE_ROPE:"im-lifecycle-graph-ariadne-rope",GRAPH_STATES_CONTAINER:"im-lifecycle-graph-states-ctn",GRAPH_STATE:"im-lifecycle-graph-state",GRAPH_STATE_TEXT:"im-lifecycle-graph-state-text",GRAPH_STATE_OVERLAY:"im-lifecycle-graph-state-overlay",GRAPH_STATE_PREV:"im-lifecycle-graph-state-prev",GRAPH_STATE_CURR:"im-lifecycle-graph-state-curr",GRAPH_STATE_NEXT:"im-lifecycle-graph-state-next",GRAPH_STATE_CLICKABLE:"im-lifecycle-graph-state-clickable",GRAPH_STATE_REQUIRES_APPROVAL:"im-lifecycle-graph-state-requires-approval",GRAPH_STATE_CREATE:"im-lifecycle-graph-state-create",GRAPH_STATE_ASSIGN:"im-lifecycle-graph-state-assign",GRAPH_STATE_ACTIVE:"im-lifecycle-graph-state-active",GRAPH_STATE_REVIEW:"im-lifecycle-graph-state-review",GRAPH_STATE_CLOSED:"im-lifecycle-graph-state-closed",GRAPH_STATE_CURRENT_INDICATOR:"fonticon fonticon-expand-down im-lifecycle-graph-state-current-indicator",GRAPH_STATE_APPROVE:"fonticon fonticon-thumbs-up im-lifecycle-graph-state-approve",GRAPH_STATE_REJECT:"fonticon fonticon-thumbs-down im-lifecycle-graph-state-reject",GRAPH_STATE_INPROGRESS:"fonticon fonticon-clock im-lifecycle-graph-state-inprogress",GRAPH_HISTORY_CONTAINER:"im-lifecycle-graph-history-container",GRAPH_HISTORY_APPROVED:"fonticon fonticon-check im-lifecycle-graph-history-approved ",GRAPH_HISTORY_REJECTED:"fonticon fonticon-wrong im-lifecycle-graph-history-rejected",GRAPH_HISTORY_MORE:"fonticon fonticon-menu-dot im-lifecycle-graph-history-more",GRAPH_HISTORY_TOOLTIP:"im-lifecycle-graph-history-tooltip",GRAPH_HISTORY_TOOLTIP_TITLE:"im-lifecycle-graph-history-tooltip-title",STATE_APPROVE_MODAL:"im-lifecycle-approve-modal",STATE_APPROVE_MODAL_HEIGHT:490,STATE_APPROVE_MODAL_WIDTH:510,STATE_APPROVE_MODAL_BODY:"im-lifecycle-approve-modal-body",STATE_APPROVE_MODAL_REASON:"im-lifecycle-approve-modal-reason",STATE_APPROVE_MODAL_ATTACHMENTS:"im-lifecycle-approve-modal-attachments"}}};return e.extend({name:"DS/IssueComponents/lifecycle/Lifecycle",tagName:"div",className:"im-lifecycle-graph-component",_logger:null,domEvents:{"click div.im-lifecycle-graph-state":"_onStateClick"},defaultOptions:{ids:[],state:"Create",states:["Create","Assign","Active","Review","Closed"]},setup:function(e){var t=this;y.start(t.name+" setup"),t._parent(e),t._logger=n.getLogger(t.name),t.elements={},t._tooltips=[],t._statesTooltips=[],t._deferred={},t.isLoaded=new s(function(e,s){t._deferred.resolve=e,t._deferred.reject=s}),t.physicalIds=[],t._isProcessing=!1,y.end(t.name+" setup")},render:function(){var e=this;y.start(e.name+" render");var s=e.elements.graph=t.createElement("div",{class:E.CSS.ELEMENTS.GRAPH_CONTAINER});s.inject(e.container),(e.elements.notSupported=t.createElement("span",{class:E.CSS.ELEMENTS.GRAPH_NOT_SUPPORTED_TEXT,html:I.lifecycle.notSupported,title:I.lifecycle.notSupported})).inject(s);var n=t.createElement("div",{class:E.CSS.ELEMENTS.GRAPH_ARIADNE});t.createElement("div",{class:E.CSS.ELEMENTS.GRAPH_ARIADNE_PLACEHOLDER}).inject(n),(e.elements.ariadneRope=t.createElement("div",{class:E.CSS.ELEMENTS.GRAPH_ARIADNE_ROPE})).inject(n),n.inject(s);var i=t.createElement("div",{class:E.CSS.ELEMENTS.GRAPH_STATES_CONTAINER});i.inject(s);var o=Object.keys(E.STATES);return e.elements.states={create:null,assign:null,active:null,review:null,closed:null},e.elements.routesContainer={create:null,assign:null,active:null,review:null},o.sort(function(e,t){return E.STATES[e.toUpperCase()]-E.STATES[t.toUpperCase()]}).forEach(function(s,n){var r=E.CSS.ELEMENTS["GRAPH_STATE_"+s.toUpperCase()],l=I.maturity[s.toLowerCase()],c=t.createElement("span",{class:E.CSS.ELEMENTS.GRAPH_STATE_TEXT,html:l}),d=t.createElement("div",{class:E.CSS.ELEMENTS.GRAPH_STATE_OVERLAY}),u=t.createElement("div",{class:E.CSS.ELEMENTS.GRAPH_STATE+" "+r,html:[d,c]});if(u.setData("state",s.toLowerCase()),e.elements.states[s.toLowerCase()]=u,u.inject(i),u.hide(),e._statesTooltips.push(new a({position:"top",target:c,body:I.lifecycle[s.toLowerCase()]})),n<o.length-1){var m=t.createElement("div",{class:E.CSS.ELEMENTS.GRAPH_HISTORY_CONTAINER});e.elements.routesContainer[s.toLowerCase()]=m,m.inject(i),m.hide()}}),y.end(e.name+" render"),e},_renderApproveRejectButtons:function(e){var s=this,n=v.get("widget")||window.widget,d=e[0];s.elements.states[d.current.approveTo.toLowerCase()].toggleClassName(E.CSS.ELEMENTS.GRAPH_STATE_REQUIRES_APPROVAL,!0);var m=I.maturity[d.current.approveTo.toLowerCase()],p=s.maturityGraph,g=E.STATES[d.current.approveTo.toUpperCase()];""!==p&&null!=p&&(m=p[g].stateUserName);var b=t.createElement("span",{class:E.CSS.ELEMENTS.GRAPH_STATE_APPROVE});s._tooltips.push(new a({position:"left",target:b,body:I.replace(I.lifecycle.approveModal.header,{approveTo:m})})),b.addEventListener("click",function(){var e=t.createElement("div",{class:E.CSS.ELEMENTS.STATE_APPROVE_MODAL_BODY}),a=t.createElement("div",{class:E.CSS.ELEMENTS.STATE_APPROVE_MODAL_REASON});a.inject(e),t.createElement("label",{html:I.lifecycle.approveModal.reasonLabel}).inject(a);var d=new o({multiline:!0,rows:4,placeholder:I.lifecycle.approveModal.reasonPlaceholder});d.inject(a),d.getContent().toggleClassName("highlight",""===d.getValue()),d.getContent().addEventListener("keyup",function(){d.getContent().toggleClassName("highlight",""===d.getValue())});var p=t.createElement("div",{class:E.CSS.ELEMENTS.STATE_APPROVE_MODAL_ATTACHMENTS});p.inject(e);var g=new h({parent:s,annotateCommand:{enable:!0,addTextbox:!0,getText:function(){var e=null,t=d.getValue();t&&(e=C.getFullName()+"\n"+(new Date).toLocaleString(n.lang,{})+"\n"+t);return e}},searchAttachmentCommand:{getSearchQuery:function(){return u.getSearchQuery(s.physicalIds)}}});g.render(),g.inject(p),s.approveComponents={},s.approveComponents.attachments=g,s.approveComponents.reasonInput=d;var v={},b=new r({element:e}),y=new l({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:E.CSS.ELEMENTS.STATE_APPROVE_MODAL,header:t.createElement("h4",{html:I.replace(I.lifecycle.approveModal.header,{approveTo:m})}),body:b,footer:[v.okButton=new i({value:I.lifecycle.approveModal.okButton,className:"primary",events:{onClick:function(){""!==d.getValue()?(f.Mask.mask(e),v.okButton.elements.container.addClassName("disabled"),v.cancelButton.elements.container.addClassName("disabled"),s._approveRoutes(s.routes,d.getValue(),g).then(function(){y.destroy(),s.approveComponents=null}).catch(function(t){var n=I.lifecycle.error;if(null!=t&&void 0!==t&&null!=t.error&&(n=t.error.message),n.includes("Action Taken and Resolution Statement are not filled in")){v.cancelButton.elements.container.removeClassName("disabled");var i=f.getErrorMessage("5");f.displayErrorMessage(i,"error")}else if(n.includes("Action Taken field is not filled in")){v.cancelButton.elements.container.removeClassName("disabled");i=f.getErrorMessage("6");f.displayErrorMessage(i,"error")}else if(n.includes("Resolution Statement field is not filled in")){v.cancelButton.elements.container.removeClassName("disabled");i=f.getErrorMessage("7");f.displayErrorMessage(i,"error")}else if(n.includes("Resolution Date is not filled in")){v.cancelButton.elements.container.removeClassName("disabled");i=f.getErrorMessage("8");f.displayErrorMessage(i,"error")}else c.displayNotification({msg:n,eventID:"error"});s._logger.error(t),f.Mask.unmask(e)})):c.displayNotification({msg:I.lifecycle.approveModal.reasonRequired,eventID:"warning"})}}}),v.cancelButton=new i({value:I.lifecycle.approveModal.cancelButton,className:"default",events:{onClick:function(){y.destroy(),s.approveComponents=null}}})]});y.inject(n.body),y.elements.container.setStyle("height",E.CSS.ELEMENTS.STATE_APPROVE_MODAL_HEIGHT),y.elements.container.setStyle("width",E.CSS.ELEMENTS.STATE_APPROVE_MODAL_WIDTH),y.show(),d.focus()}),s.elements.approve=b,b.inject(s.elements.states[d.current.approveTo.toLowerCase()]);var y=t.createElement("span",{class:E.CSS.ELEMENTS.GRAPH_STATE_REJECT});s._tooltips.push(new a({position:"left",target:y,body:I.replace(I.lifecycle.rejectModal.header,{approveTo:m})})),y.addEventListener("click",function(){var e=t.createElement("div",{class:E.CSS.ELEMENTS.STATE_APPROVE_MODAL_BODY}),a=t.createElement("div",{class:E.CSS.ELEMENTS.STATE_APPROVE_MODAL_REASON});a.inject(e),t.createElement("label",{html:I.lifecycle.rejectModal.reasonLabel}).inject(a);var d=new o({multiline:!0,rows:4,placeholder:I.lifecycle.rejectModal.reasonPlaceholder});d.inject(a),d.getContent().toggleClassName("highlight",""===d.getValue()),d.getContent().addEventListener("keyup",function(){d.getContent().toggleClassName("highlight",""===d.getValue())});var p=t.createElement("div",{class:E.CSS.ELEMENTS.STATE_APPROVE_MODAL_ATTACHMENTS});p.inject(e);var g=new h({parent:s,annotateCommand:{enable:!0,addTextbox:!0,getText:function(){var e=null,t=d.getValue();t&&(e=C.getFullName()+"\n"+(new Date).toLocaleString(n.lang,{})+"\n"+t);return e}},searchAttachmentCommand:{getSearchQuery:function(){return u.getSearchQuery(s.physicalIds)}}});g.render(),g.inject(p),s.rejectComponents={},s.rejectComponents.attachments=g,s.rejectComponents.reasonInput=d;var v={},b=new r({element:e}),y=new l({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:E.CSS.ELEMENTS.STATE_APPROVE_MODAL,header:t.createElement("h4",{html:I.replace(I.lifecycle.rejectModal.header,{approveTo:m})}),body:b,footer:[v.okButton=new i({value:I.lifecycle.rejectModal.okButton,className:"primary",events:{onClick:function(){if(""===d.getValue())return c.displayNotification({msg:I.lifecycle.rejectModal.reasonRequired,eventID:"warning"}),void d.elements.container.addClassName("highlight");f.Mask.mask(e),v.okButton.elements.container.addClassName("disabled"),v.cancelButton.elements.container.addClassName("disabled"),s._rejectRoutes(s.routes,d.getValue(),g).then(function(){y.destroy()}).catch(function(t){c.displayNotification({msg:I.lifecycle.error,eventID:"error"}),s._logger.error(t),f.Mask.unmask(e)})}}}),v.cancelButton=new i({value:I.lifecycle.rejectModal.cancelButton,className:"default",events:{onClick:function(){y.destroy()}}})]});y.inject(n.body),y.elements.container.setStyle("height",E.CSS.ELEMENTS.STATE_APPROVE_MODAL_HEIGHT),y.elements.container.setStyle("width",E.CSS.ELEMENTS.STATE_APPROVE_MODAL_WIDTH),y.show(),d.focus()}),s.elements.reject=y,y.inject(s.elements.states[d.current.approveTo.toLowerCase()])},_renderInProgressIndicator:function(e){var s=t.createElement("span",{class:E.CSS.ELEMENTS.GRAPH_STATE_INPROGRESS});this.elements.inProgressIndicator=s;var n=t.createElement("div",{class:E.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP}),i=e[0];if(e.length>1)this._tooltips.push(new a({position:"bottom",target:s,body:"<span>"+I.lifecycle.routeIndicatorTooltip.inProgressTooltip.multiSelectionTitle+"</span>"})),s.inject(this.elements.states[i.current.approveTo.toLowerCase()]);else if(1===e.length){var o=i.current.reviewers,r=i.current.decisions.filter(function(e){return"approved"===e.status||"rejected"===e.status}).map(function(e){return e.reviewer.user}),l=o.filter(function(e){return-1===r.indexOf(e.user)});if(l.length>0){var c=t.createElement("div",{html:'<span class="'+E.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP_TITLE+'">'+I.lifecycle.routeIndicatorTooltip.inProgressTooltip.title+"</span>"});l.forEach(function(e){t.createElement("span",{html:"<span>"+e.fullName+"</span>"}).inject(c)}),c.inject(n)}var d=i.current.decisions.filter(function(e){return"approved"===e.status});if(d.length>0){var u=t.createElement("div",{html:'<span class="'+E.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP_TITLE+'">'+I.lifecycle.routeIndicatorTooltip.approvalTitle+"</span>"});d.forEach(function(e){var s=I.replace(I.lifecycle.routeIndicatorTooltip.approvalText,{name:e.reviewer.fullName,date:new Date(e.date).toLocaleString(v.get("widget").lang)});t.createElement("span",{html:"<span>"+s+"</span>"}).inject(u)}),u.inject(n)}this._tooltips.push(new a({position:"bottom",target:s,body:n})),s.inject(this.elements.states[i.current.approveTo.toLowerCase()])}},_renderRoutesHistory:function(e){var s=this;if(Array.isArray(e.history)&&e.history.length>0){s.elements.routesIndicators={create:{more:null,last:null,nonLast:[]},assign:{more:null,last:null,nonLast:[]},active:{more:null,last:null,nonLast:[]},review:{more:null,last:null,nonLast:[]}};var n={create:[],assign:[],active:[],review:[]};e.history.forEach(function(e){n[e.from.toLowerCase()].push(e)}),Object.keys(n).forEach(function(i){s.elements.routesContainer[i].empty();var o=t.createElement("div",{class:E.CSS.ELEMENTS.GRAPH_HISTORY_MORE});o.inject(s.elements.routesContainer[i]),o.hide(),s.elements.routesIndicators[i].more={element:o,tooltip:null},n[i]=n[i].sort(function(e,t){return e.date?t.date?new Date(e.date)-new Date(t.date):-1:1}),n[i].forEach(function(o,r){var l="approved"===o.status?E.CSS.ELEMENTS.GRAPH_HISTORY_APPROVED:E.CSS.ELEMENTS.GRAPH_HISTORY_REJECTED,c=t.createElement("div",{class:l});c.addEventListener("click",function(){s.dispatchEvent("request:openRoute",{issueId:e.physicalId,route:o})});var d=s.elements.routesContainer[i];c.inject(d),r===n[i].length-1?s.elements.routesIndicators[i].last={data:o,element:c}:s.elements.routesIndicators[i].nonLast.unshift({data:o,element:c});var u=t.createElement("div",{class:E.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP}),m=o.decisions.filter(function(e){return"rejected"===e.status});if(m.length>0){var p=t.createElement("div",{html:'<span class="'+E.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP_TITLE+'">'+I.lifecycle.routeIndicatorTooltip.rejectionTitle+"</span>"});m.forEach(function(e){var s=I.replace(I.lifecycle.routeIndicatorTooltip.rejectionText,{name:e.reviewer.fullName,date:new Date(e.date).toLocaleString(v.get("widget").lang)});t.createElement("span",{html:"<span>"+s+"</span>"}).inject(p)}),p.inject(u)}var f=o.decisions.filter(function(e){return"approved"===e.status});if(f.length>0){var h=t.createElement("div",{html:'<span class="'+E.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP_TITLE+'">'+I.lifecycle.routeIndicatorTooltip.approvalTitle+"</span>"});f.forEach(function(e){var s=I.replace(I.lifecycle.routeIndicatorTooltip.approvalText,{name:e.reviewer.fullName,date:new Date(e.date).toLocaleString(v.get("widget").lang)});t.createElement("span",{html:"<span>"+s+"</span>"}).inject(h)}),h.inject(u)}s._tooltips.push(new a({position:"bottom",target:c,body:u}))})})}},refresh:function(e){var s=this;s.physicalIds=e;var n=e[0],i=[];return b.issues.getMaturityGraph({data:{id:n}}).then(function(n){""!==n&&null!=n&&(i=n.data.policies[0].maturityGraph.states,s.maturityGraph=i),b.routes.retrieve({data:{objects:e.map(function(e){return{physicalId:e}})}}).then(function(n){s.reset(),s.routes=n.results.map(function(e){return e.body});var o=s.routes.every(function(e){return e.state===s.routes[0].state});if(e.length===n.results.length&&o){var a=t.is(s.routes[0].current,"object")&&t.is(s.routes[0].current.from,"string");if(s.routes.every(function(e){return(t.is(e.current,"object")&&t.is(e.current.from,"string"))===a})){var r=s.routes[0],l=r.state,c=E.STATES[l.toUpperCase()],d=E.STATES_ORDER[c+1],u=E.STATES_ORDER[c-1];if(Object.keys(s.elements.states).forEach(function(e){if(e!==E.STATES_VALUES.CLOSED.toLowerCase()?s.elements.states[e].toggleClassName(E.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!1):s.elements.states[e].toggleClassName(E.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!0),s.elements.states[e].removeClassName(E.CSS.ELEMENTS.GRAPH_STATE_CURR),e===r.state.toLowerCase()&&(s.elements.states[e].addClassName(E.CSS.ELEMENTS.GRAPH_STATE_CURR),s.elements.currentIndicator=t.createElement("span",{class:E.CSS.ELEMENTS.GRAPH_STATE_CURRENT_INDICATOR}),s.elements.currentIndicator.inject(s.elements.states[e])),null!=i&&""!==i){var n=E.STATES[e.toUpperCase()],o=i[n].stateUserName;s.getContent().getElementsByClassName(E.CSS.ELEMENTS.GRAPH_STATE_TEXT)[n].setText(o);s._statesTooltips[n].getBody();var a=I.lifecycle[e.toUpperCase()];if(null!=a&&""!==a){var l=I.replace(I.lifecycle[e.toUpperCase()],{stateDisplayName:o});s._statesTooltips[n].setBody(l)}}}),r.current&&r.current.from===l){void 0!==d&&s.elements.states[d.toLowerCase()].toggleClassName(E.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!1),void 0!==u&&u!=E.STATES_ORDER[Object.keys(E.STATES_ORDER).length-2]&&s.elements.states[u.toLowerCase()].toggleClassName(E.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!1);var m=C.getUserName();if(s.routes.every(function(e){return-1!==e.current.reviewers.map(function(e){return e.user}).indexOf(m)}))s.routes.some(function(e){return-1===e.current.decisions.filter(function(e){return"approved"===e.status||"rejected"===e.status}).map(function(e){return e.reviewer.user}).indexOf(m)})?s._renderApproveRejectButtons(s.routes):s._renderInProgressIndicator(s.routes);else s._renderInProgressIndicator(s.routes)}else void 0!==d&&(s.elements.states[d.toLowerCase()].toggleClassName(E.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!0),s.elements.states[E.STATES_VALUES.CLOSED.toLowerCase()].toggleClassName(E.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!0)),void 0!==u&&u!=E.STATES_ORDER[Object.keys(E.STATES_ORDER).length-2]&&s.elements.states[u.toLowerCase()].toggleClassName(E.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!0)}else s.container.addClassName(E.CSS.ELEMENTS.GRAPH_NOT_SUPPORTED);1===s.routes.length&&s._renderRoutesHistory(s.routes[0])}else s.container.addClassName(E.CSS.ELEMENTS.GRAPH_NOT_SUPPORTED)}).then(function(){s.resize(),s.dispatchEvent("onReady")})})},resize:function(){var e=this;if(Array.isArray(e.routes)&&0!==e.routes.length){var s=Object.keys(e.elements.states),n=e.routes[0].state.toLowerCase(),i=E.STATES[n.toUpperCase()],o=e.container.offsetWidth,r=Math.floor(o/140);if(r=r>s.length?5:r,s.forEach(function(t){e.elements.states[t].hide(),void 0!==e.elements.routesContainer[t]&&null!==e.elements.routesContainer[t]&&e.elements.routesContainer[t].hide()}),e.elements.states[n].show(),void 0!==e.elements.routesContainer[n]&&null!==e.elements.routesContainer[n]&&e.elements.routesContainer[n].show(),"closed"===n){var l=i-1,c=E.STATES_ORDER[l].toLowerCase();e.elements.states[c].show(),void 0!==e.elements.routesContainer[c]&&null!==e.elements.routesContainer[c]&&e.elements.routesContainer[c].show()}else{var d=i+1,u=E.STATES_ORDER[d].toLowerCase();e.elements.states[u].show()}if(r>=2)for(var m="closed"===n?i-1:i,p=0;p<r-2;p++){var f=m-p-1;if(f>=0){var h=E.STATES_ORDER[f].toLowerCase();e.elements.states[h].show(),void 0!==e.elements.routesContainer[h]&&null!==e.elements.routesContainer[h]&&e.elements.routesContainer[h].show()}else{f=p+2;var g=E.STATES_ORDER[f].toLowerCase();e.elements.states[g].show();var b=E.STATES_ORDER[f-1].toLowerCase();void 0!==e.elements.routesContainer[b]&&null!==e.elements.routesContainer[b]&&e.elements.routesContainer[b].show()}}var C=(o-100*r)/(r-1);Object.keys(e.elements.routesContainer).forEach(function(s){if(e.elements.routesContainer[s].setStyle("width",C),void 0!==e.elements.routesIndicators&&null!==e.elements.routesIndicators)if(null!==e.elements.routesIndicators[s].last&&e.elements.routesIndicators[s].last.element.show(),Array.isArray(e.elements.routesIndicators[s].nonLast)&&1===e.elements.routesIndicators[s].nonLast.length)e.elements.routesIndicators[s].nonLast[0].element.show(),e.elements.routesIndicators[s].more.element.hide();else if(e.elements.routesIndicators[s].nonLast.length>1){var n=Math.floor(C/26)-1,i=0;e.elements.routesIndicators[s].nonLast.forEach(function(t,o){i<n?i===n-1&&o<e.elements.routesIndicators[s].nonLast.length-1?(t.element.hide(),i+=1):(t.element.show(),i+=1):t.element.hide()});var o=e.elements.routesIndicators[s].nonLast.filter(function(e){return e.element.isHidden()});if(o.length>0){if(e.elements.routesIndicators[s].more.element.show(),null!==e.elements.routesIndicators[s].more.tooltip)try{e.elements.routesIndicators[s].more.tooltip.destroy()}catch(e){}for(var r=t.createElement("div",{class:E.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP,html:'<span class="'+E.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP_TITLE+'">'+I.replace(I.lifecycle.routeIndicatorTooltip.moreTooltip.title,{number:o.length})+"</span>"}),l=o.length-1;l>=0;l--){var c=o[l].data.date,d="approved"===o[l].data.status?"approvalText":"rejectionText";t.createElement("div",{html:"<span>"+I.replace(I.lifecycle.routeIndicatorTooltip.moreTooltip[d],{date:new Date(c).toLocaleString(v.get("widget").lang)})+"</span>"}).inject(r)}e.elements.routesIndicators[s].more.tooltip=new a({position:"bottom",target:e.elements.routesIndicators[s].more.element,body:r})}else if(e.elements.routesIndicators[s].more.element.hide(),null!==e.elements.routesIndicators[s].more.tooltip)try{e.elements.routesIndicators[s].more.tooltip.destroy()}catch(e){}}});var y=e.elements.states[n].offsetLeft;e.elements.ariadneRope.setStyles({width:y+"px"})}},reset:function(){var e=this;e.container.removeClassName(E.CSS.ELEMENTS.GRAPH_NOT_SUPPORTED),Object.keys(e.elements.states).forEach(function(t){t!==E.STATES_VALUES.CLOSED.toLowerCase()?e.elements.states[t].toggleClassName(E.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!1):e.elements.states[t].toggleClassName(E.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE,!0),e.elements.states[t].removeClassName(E.CSS.ELEMENTS.GRAPH_STATE_CURR),e.elements.states[t].removeClassName(E.CSS.ELEMENTS.GRAPH_STATE_REQUIRES_APPROVAL),void 0!==e.elements.routesContainer[t]&&e.elements.routesContainer[t].empty()}),e.elements.currentIndicator&&e.elements.currentIndicator.destroy(),e.elements.approve&&e.elements.approve.destroy(),e.elements.reject&&e.elements.reject.destroy(),e.elements.inProgressIndicator&&e.elements.inProgressIndicator.destroy();try{e._tooltips.forEach(function(e){e.destroy()})}catch(e){}e._tooltips=[],e._isProcessing=!1},destroy:function(){this.reset();try{this._statesTooltips.forEach(function(e){e.destroy()})}catch(e){}this._statesTooltips=[]},_onStateClick:function(e){var s=this;if(!s._isProcessing){var n=null;if(e.target.hasClassName(E.CSS.ELEMENTS.GRAPH_STATE)?n=e.target:e.target.getParent().hasClassName(E.CSS.ELEMENTS.GRAPH_STATE)&&(n=e.target.getParent()),null!==n&&n.hasClassName(E.CSS.ELEMENTS.GRAPH_STATE_CLICKABLE)){var i=s.routes[0].state.toLowerCase(),o=n.getData("state"),a=E.STATES[o.toUpperCase()]-E.STATES[i.toUpperCase()];if(1===a||-1===a){s._isProcessing=!0,f.Mask.mask(s.container);var r=1===a?"promote":"demote",l=s.routes.map(function(e){return{physicalId:e.physicalId,state:E.STATES_VALUES[o.toUpperCase()]}});b.issues[r]({data:{objects:l}}).then(function(){1===a?s.dispatchEvent("onPromotionCompleted",{issues:l}):s.dispatchEvent("onDemotionCompleted",{issues:l})}).catch(function(e){var n=I.lifecycle.error,i="";if(e&&e.error&&t.is(e.error.message,"string")&&(i=e.error.message),i.includes("Action Taken and Resolution Statement are not filled in")){n=f.getErrorMessage("5");f.displayErrorMessage(n,"error")}else if(i.includes("Action Taken field is not filled in")){n=f.getErrorMessage("6");f.displayErrorMessage(n,"error")}else if(i.includes("Resolution Statement field is not filled in")){n=f.getErrorMessage("7");f.displayErrorMessage(n,"error")}else if(i.includes("Resolution Date is not filled in")){n=f.getErrorMessage("8");f.displayErrorMessage(n,"error")}else if(i.includes("User does not have necessary privileges or selected object is not in correct maturity state for this operation.")){var o=f.getErrorMessage("1005_1");f.displayErrorMessage(o,"error")}else if(e.error&&e.error.internal&&(e.error.internal.includes("Message:No privilege for operation Severity:2 ErrorCode:1500019")||e.error.internal.includes("User does not have necessary privileges"))){o=f.getErrorMessage("1005");f.displayErrorMessage(o,"error")}else if(e.error&&e.error.internal&&e.error.internal.includes("You need at least one assignee to promote or demote this issue, as a validation process is attached to the issue for assignees")){o=f.getErrorMessage("1004");f.displayErrorMessage(o,"error")}else if(e.error&&e.error.internal&&e.error.internal.includes("Issue object cannot be demoted, as atleast one Resolving Item connected to Issue has Passed IN Work state.")){o=f.getErrorMessage("9");f.displayErrorMessage(o,"error")}else if(e.error&&e.error.internal&&e.error.internal.includes("Issue object cannot be promoted, as atleast one Resolving Item connected to Issue is not Completed.")){o=f.getErrorMessage("13");f.displayErrorMessage(o,"error")}else e&&e.error&&t.is(e.error.message,"string")&&(n=e.error.message,c.displayNotification({msg:n,eventID:"error"}));s._logger.error(e)}).finally(function(){s.refresh(s.physicalIds).then(function(){f.Mask.unmask(s.container),s._isProcessing=!1})})}else if(o===E.STATES_VALUES.CLOSED.toLowerCase()&&1!==a){var d=s.routes.map(function(e){return e.physicalId});new g({physicalIds:d}).render()}else c.displayNotification({msg:I.replace(a>0?I.kanban.dnd.unsupportedPromote:I.kanban.dnd.unsupportedDemote,{currState:i,state:o}),eventID:"error"}),s._logger.error(new Error("Unexpected or unsupported promotion/demotion."))}}},_approveRoutes:function(e,t,s){var n=this,i=e.map(function(e){return e.physicalId});return f.Mask.mask(n.container),n._connectAttachments(i,s).then(function(){return b.routes.approve({data:{objects:e.map(function(e){return{physicalId:e.physicalId,comment:t}})}}).then(function(e){var t=e.results.map(function(e){return{physicalId:e.body.physicalId,task:e.body.task}});n.dispatchEvent("onApprovalCompleted",{issues:t,modifiedAttributes:["attachments"]})})}).finally(function(){n.refresh(n.physicalIds).then(function(){f.Mask.unmask(n.container)})})},_rejectRoutes:function(e,t,s){var n=this,i=e.map(function(e){return e.physicalId});return f.Mask.mask(n.container),n._connectAttachments(i,s).then(function(){return b.routes.reject({data:{objects:e.map(function(e){return{physicalId:e.physicalId,reason:t}})}}).then(function(e){var t=e.results.map(function(e){return{physicalId:e.body.physicalId,task:e.body.task}});n.dispatchEvent("onRejectionCompleted",{issues:t,modifiedAttributes:["attachments"]})})}).finally(function(){n.refresh(n.physicalIds).then(function(){f.Mask.unmask(n.container)})})},_connectAttachments:function(e,t){var n=this,i=v.get("widget")||window.widget,o=t.collection,a=o.filter(function(e){return!0===e.get("isFile")}).map(function(e){var t=e.clone();return t.set("isProcessing",!0),t}),r=[];if(a.length>0){var l=new d({id:"uploadAttachmentsToRoutes",attachments:a});new m({container:i.body,collection:l}).render(),r=a.map(function(e){var t=u.uploadFile(e.get("file"),null,{onCheckinStart:function(e){this.set("isCancelable",!0),this.set("request",e)}.bind(e),onCheckinProgress:function(e){if(e.lengthComputable){var t=e.loaded/e.total;this.set("requestProgress",t)}}.bind(e),onCheckinComplete:function(){this.set("isCancelable",!1),this.set("request",null)}.bind(e)});return t=t.then(function(t){t&&t.data&&t.data.length>0&&t.data[0].id&&(o.get(e.id).set("isFile",!1),o.get(e.id).set("id",t.data[0].id),e.set("id",t.data[0].id),e.set("isFile",!1),e.set("isProcessing",!1))}).catch(function(t){e.set("isFailed",!0),e.set("isProcessing",!1),e.set("isCancelable",!1),e.set("request",null),t instanceof Error&&(c.displayNotification({msg:p.replace(p.notifications.Upload.failure,{count:1}),eventID:"error"}),n._logger.error(t))})})}return s.all(r).then(function(){var t=o.filter(function(e){return!0!==e.get("isFile")}).map(function(e){return e.clone()}),i=[];return t.length>0&&e.forEach(function(e){var s=t.map(function(e){return e.id});i.push(u.connectDocumentsToParent(s,e).catch(function(e){c.displayNotification({msg:p.replace(p.notifications.Attach.failure,{count:1}),eventID:"error"}),n._logger.error(e)}))}),s.all(i)}).then(function(){var t=[],i=o.filter(function(e){return!0===e.get("isPrimary")});if(1===i.length){var a=i[0];return e.forEach(function(e){t.push(u.setAsPrimary(a.get("id"),e,!0).then(function(){}).catch(function(e){c.displayNotification({msg:p.notifications.SetAsPrimary.failure,eventID:"error"}),n._logger.error(e)}))}),s.all(t)}return s.resolve()})}})}),define("DS/IssueComponents/team/MembersGridUtil",["i18n!DS/IssueComponents/assets/nls/IssueComponents","DS/IssueComponents/team/MembersDataGridViewToolbar"],function(e,t){"use strict";var s=Object.create(null);return s.getColumns=function(){return[{dataIndex:"propagate",visibleFlag:!1,width:35,allowUnsafeHTMLContent:!0,icon:"propagate",sortableFlag:!1},{text:e.team.columns.title,dataIndex:"tree",editableFlag:!1,alwaysVisibleFlag:!0,allowUnsafeHTMLContent:!0,width:"200",getCellGroupingKey:function(e){return e.nodeModel.options.grid.fullName}},{text:e.team.columns.name,dataIndex:"username",editableFlag:!1},{text:e.team.columns.memberof,dataIndex:"memberof",editableFlag:!1,visibleFlag:!1}]},s.changeView=function(s){if("GridView"==s){this.currentView="Grid",widget.setValue("membersView","GridView");var n=t.toolbar.getNodeModelByID("view");n&&"view-list"!=n.options.grid.semantics.icon.iconName&&n.updateOptions({grid:{semantics:{icon:{iconName:"view-list"}}},tooltip:e.team.toolbar.gridView});var i=document.querySelector(".toolbar-member-grid-div .wux-ui-3ds-view-list");i&&i.addClassName("currentView");var o=document.querySelector(".toolbar-member-grid-div .wux-ui-3ds-view-small-tile");o&&o.removeClassName("currentView");var a=document.querySelector(".iss-member-grid-div");a&&(a.removeClassName("hideView"),a.removeClassName("nonVisible"),a.addClassName("showView"));var r=document.querySelector(".membertileView");r&&(r.removeClassName("showView"),r.addClassName("hideView"))}},s.getRoleNLSValue=function(t){let s="";switch(t){case"Owner":s=e.team.owner.label;break;case"Co-owner":s=e.team.coOwners.label;break;case"Assignee":s=e.team.assignees.label;break;case"Contributor":s=e.team.contributors.label;break;case"InformedUser":s=e.team.informedUsers.label}return s},s.removeRole=function(e,t){let s=","+t,n=", "+t,i=t+",",o=t+" ,";return e.includes(s)?e=e.replace(s,""):e.includes(n)?e=e.replace(n,""):e.includes(i)?e=e.replace(i,""):e.includes(o)&&(e=e.replace(o,"")),e},s}),define("DS/IssueComponents/search/PeopleSearch",["DS/PADUtils/views/PADAlert","DS/SearchWidget/controllers/SW_FullPos_Controller","DS/IssueComponents/search/PeopleSearchUI","DS/IssueServices/services/PlatformServices","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,s,n,i){"use strict";return t.extend({init:function(e){var t=this;t._parent(e);var n=e.events;null===n&&(n={}),n.onExpressSearch=function(){t.expressSearch()},e.events=n,t.searchWidgetUI.destroy(),t.searchWidgetUI=t.container=new s(e)},expressSearch:function(){var t=this,s=[],o="",a=function(){if(s.length>0){var n=Object.assign({},s);t.dispatchEvent("onValidUsers",n)}o.length>0&&(o=(o=o.trim()).replace(/.$/,""),e.displayNotification({msg:i.replace(i.search.error.usersNotFound,{users:o}),eventID:"error"}))},r=t.searchWidgetUI.searchInput.getValue().trim(),l=0,c=r.split(";");(c=c.filter(function(e){return""!==e})).length>0&&c.forEach(function(e){e=e.trim(),n.getUserInfo(e,{onComplete:function(e){l+=1;var t=JSON.parse(e);s.push(t),l===c.length&&a()},onFailure:function(){o=o+e+", ",(l+=1)===c.length&&a()}})})}})}),define("DS/IssueComponents/team/Team",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Iconbar","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/UIKIT/Tooltip","DS/Controls/TooltipModel","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/SearchWidget/SearchWidgetConstant","DS/IssueCommon/commands/CommandsManager","DS/IssueComponents/search/PeopleSearch","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f,h,g,v,b,C,y,I){"use strict";return t.extend({})}),define("DS/IssueComponents/create/CustomNew",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/IssueComponents/create/Form","DS/Controls/DatePicker","DS/Controls/LineEditor","DS/Controls/Editor","DS/Controls/ComboBox","DS/Controls/SpinBox","DS/Controls/Toggle","DS/WUXAutoComplete/AutoComplete","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/IssueServices/services/IssueServices","DS/IssueServices/Contexts","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f,h){"use strict";var g={READ_ONLY:"ReadOnly",NONE:"None"},v={MEMO:"textarea",DATE:"timestamp",TEXT:"string",INT:"integer",REAL:"real",BOOL:"boolean"},b="TRUE";return t.extend({name:"DS/IssueComponents/create/Custom",tag:"div",className:"create-view-content-subview create-custom",isInit:null,_deferredInit:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s.parent=t.parent,s.isInit=new e(function(e,t){s._deferredInit.resolve=e,s._deferredInit.reject=t}),s.formElements={},s.formElementsToggler={},s.fields={},s.requiredLabels={},s.noShow=!0;let n={};var i=[];s._customProperties=[],new e(function(t,o){i.push(p.custom.getCustomAttributes(n)),i.push(p.type.getProperties("Issue")),e.all(i).then(e=>{var n={};e.length>1&&void 0!==e[1]&&(Array.isArray(e[1].classPredicates)&&e[1].classPredicates.length>0&&e[1].classPredicates[0].vocabularyPredicateInfo.forEach(e=>{e.userAccess&&(n[e.name]=e.nlsName)}));if(e.length&&Array.isArray(e[0].body)&&e[0].body.length){const t=new Map(e[0].body.map(e=>[e.name,e]));f.add("ISU_DeploymentAttributes",t),e[0].body.forEach(e=>{n[e.name]&&(e.title=n[e.name])}),s._customProperties=e[0].body,s.noShow=!1}t()})}).then(s._deferredInit.resolve).catch(s._deferredInit.reject)},destroy:function(){var e=this;e.form=null,Object.keys(e.fields).forEach(function(t){e.fields[t]=null,e.parent.formElements[t]=null,e.parent.formElementsToggler[t]=null})},render:function(){var e=this;e.form=new n({className:"create-properties-form",fields:[],events:{onInvalid:function(){}}}).inject(e.container),e.form.getContent().setAttribute("novalidate",!1);var t=s.createElement("div",{class:"create-form-content"}),i=[],o=[];return e._customProperties.forEach(function(t,s){var n=[];if(""!==t.range){var a=t.NLSRange.split("%@separator%");t.range.split(",").forEach(function(e,t){n.push({labelItem:a[t],valueItem:e})})}t.type==v.DATE&&""==t.defaults&&(t.defaults=void 0);var r={};if(r.index=s,r.element=t.name,r.value=t.defaults,r.required="Yes"===t.mandatory,r.placeholder=e.getPlaceholder(t),r.help=e.getHelper(t),r.type=t.type,r.label=e.getLabel(t),r.rangeItems=n,r.UIAccess=t.UIAccess,r.requiredText=h.create.required,r.selectedIndex=-1,r.MultiValuated=t.valuetype,r.multiline=t.multiline,r.type!==v.INT&&r.type!==v.REAL||r.rangeItems.sort(function(e,t){return e.valueItem-t.valueItem}),r.rangeItems.length>0&&r.rangeItems.forEach(function(e,t){r.value===e&&(r.selectedIndex=t)}),g.NONE!=t.UIAccess&&g.READ_ONLY!=t.UIAccess){var l=e.createFormElement(r);r.required?i.push(l):o.push(l)}}),i.forEach(function(e){e.inject(t)}),o.forEach(function(e){e.inject(t)}),t.inject(e.form.elements.container),e},createFormElement:function(e){var t="create-form-element create-properties-form-element-"+e.element,n=this.parent.formElements[e.element]=s.createElement("div",{class:t});this.parent.parent.isTemplate&&!e.required&&this.createVisibilityMask(e).inject(n);return this.createFormGroup(e).inject(n),n},createFormGroup:function(e){var t=s.createElement("div",{class:"create-form-field form-group"});return(e.required?this.createRequiredLabel(e):this.createLabel(e)).inject(t),this.createFormField(e).inject(t),t},createVisibilityMask:function(e){return s.createElement("div",{html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[this.parent.formElementsToggler[e.element]=s.createElement("span",{class:"fonticon fonticon-eye"})]}]})},createRequiredLabel:function(e){e.element;var t="required-form-field-title-label"+(this.parent.parent.isTemplate?"":" highlight"),n="required-form-field-required-label"+(this.parent.parent.isTemplate?"":" highlight");return this.requiredLabels[e.element]=s.createElement("h5",{class:"required-form-field",html:[s.createElement("span",{class:t,html:e.label}),s.createElement("div",{class:n+" wux-ui-3ds-required wux-ui-3ds"})]})},createLabel:function(e){e.element;return s.createElement("h5",{class:"create-form-field-label",html:e.label})},createFormField:function(e){var t=this,n=s.createElement("div",{name:e.name,id:e.id}),i=null;if(e.rangeItems.length>0&&e.type!==v.BOOL)i=t.createComboBox(e);else switch(e.type){case v.TEXT:case v.MEMO:if(s.is(e.MultiValuated)&&"multival"==e.MultiValuated)(i=t.createComboBox(e)).allowFreeInputFlag=!0;else(i=t.createTextField(e)).getContent().querySelectorAll("input, div").forEach(function(e){e.style.width="100%",e.style.fontSize="medium"});break;case v.DATE:(i=t.createDateField(e)).getContent().querySelectorAll("input").forEach(function(e){e.style.fontSize="medium"});break;case v.BOOL:i=t.createBooleanField(e);break;case v.INT:case v.REAL:if(s.is(e.MultiValuated)&&"multival"==e.MultiValuated){var o="";e.type===v.INT?o="[0-9]+":e.type===v.REAL&&(o="[0-9]+|([0-9]+.[0-9]+)"),(i=t.createComboBox(e)).allowFreeInputFlag=!0,i._editor.pattern=o}else i=t.createNumberField(e),t.fields[e.element].getContent().style.height="auto",i.getContent().style.width="100%",i.getContent().querySelectorAll("input").forEach(function(e){e.style.fontSize="medium"})}return i.getContent().addEventListener("change",function(){switch(e.type){case v.TEXT:case v.MEMO:t._customProperties[e.index].value=t.fields[e.element].value;break;case v.DATE:var s=t.fields[e.element].value;t._customProperties[e.index].value=s.getMonth()+1+"/"+s.getDate()+"/"+s.getFullYear();break;case v.BOOL:t._customProperties[e.index].value=t.fields[e.element].checkFlag?"true":"false";break;case v.INT:case v.REAL:var n=t.fields[e.element].value,i=t._customProperties[e.index].valuetype;t._customProperties[e.index].value=null!=n&&""!==n&&"singleval"==i?n.toString():n}}),i.inject(n),n},createTextField:function(e){var t=null;"false"===e.multiline?(t=this.fields[e.element]=new o({value:e.value,requiredFlag:e.required&&!this.parent.parent.isTemplate,placeholder:e.placeholder})).getContent().setStyle("width","100%"):((t=this.fields[e.element]=new a({value:e.value,nbRows:4,requiredFlag:e.required&&!this.parent.parent.isTemplate,placeholder:e.placeholder,newLineMode:"enter"})).getContent().setStyle("width","100%"),t.getContent().querySelectorAll("textarea").forEach(function(e){e.style.width="100%",e.style.fontSize="medium",e.style.resize="vertical",e.style.overflow="auto"}));return t},createDateField:function(e){return this.fields[e.element]=new i({value:e.value,minValue:e.minValue,maxValue:e.maxValue})},createNumberField:function(e){var t="integer"===e.type?parseInt(e.value):parseFloat(e.value);return this.fields[e.element]=new l({value:t,stepValue:"integer"===e.type?1:.1,maxValue:"integer"===e.type?2147483646:999999999999999})},createComboBox:function(e){var t=e.rangeItems,n=function(){var e=new u;e.prepareUpdate();for(var s=0;s<t.length;s++){var n=t[s].labelItem,i=t[s].valueItem,o=new m({label:n,value:i});e.addRoot(o)}return e.pushUpdate(),e}(),i=!1;s.is(e.MultiValuated)&&"multival"==e.MultiValuated&&(i=!0);var o=[];t.length>0&&t.forEach(function(t,s){e.value===t.valueItem&&o.push(n.getRoots()[s])});var a=e.required,r=(e.placeholder,this.fields[e.element]=new d({elementsTree:n,multiSearchMode:i,selectedItems:o,allowFreeInputFlag:!1}));return(1==i||t.length>0)&&r.getContent().addEventListener("keydown",function(e){13==e.keyCode&&e.stopPropagation()}),r.requiredFlag=a,r},createBooleanField:function(e){var t=this.fields[e.element]=new c({type:"switch",checkFlag:e.value===b});return t.getContent().addEventListener("keydown",function(e){13==e.keyCode&&e.stopPropagation()}),t},show:function(){this._parent(),this.fields[this._customProperties[0].name]&&"focus"in this.fields[this._customProperties[0].name]&&this.fields[this._customProperties[0].name].focus()},hide:function(){this._parent()},validate:function(){return this.form.fields=Object.values(this.fields).filter(function(e){return null!==e}),this.form.validate(!1,!1)},getValues:function(){var e={custom:{}};return this._customProperties.forEach(function(t){t.range.length>0?""!=t.value&&(e.custom[t.path]=t.value):e.custom[t.path]=t.value}),e},getHiddenAttributes:function(){var e={custom:{}};for(var t in this.parent.formElements)s.is(this.parent.formElementsToggler[t])&&(e.custom[t]=this.parent.formElementsToggler[t].hasClassName("fonticon-eye-off"));return e},reset:function(){var e=this;e._customProperties.forEach(function(t){if(t.value=t.defaults,e.fields[t.name])switch(t.type){case v.TEXT:case v.MEMO:e.fields[t.name].value=t.defaults;break;case v.DATE:break;case v.BOOL:e.fields[t.name].checkFlag="true"===t.defaults.toLowerCase();break;case v.INT:case v.REAL:e.fields[t.name].value=""===t.defaults?0:"integer"===t.type?parseInt(t.defaults):parseFloat(t.defaults)}})},applyTemplate:function(t){var n=this;if(n.reset(),s.is(t.data,"object")&&s.is(t.data.custom,"object")&&n._customProperties.forEach(function(e){if(s.is(t.data.custom[e.path],"string")){if(e.value=t.data.custom[e.path],n.fields[e.name])switch(e.type){case v.TEXT:case v.MEMO:case v.DATE:n.fields[e.name].value=e.value;break;case v.BOOL:n.fields[e.name].checkFlag="true"===e.value.toLowerCase();break;case v.INT:case v.REAL:n.fields[e.name].value=""===e.value?"0":e.value}}else s.is(t.data.custom[e.path],"array")&&(e.value=[],e.value=t.data.custom[e.path],e.type==v.BOOL&&(t.data.custom[e.path].length>0?e.value="true"===t.data.custom[e.path][0].toLowerCase():e.value=!1,n.fields[e.name].checkFlag=e.value),n.fields[e.name].value=e.value)}),s.is(t.hidden,"object")&&s.is(t.hidden.custom,"object")&&s.is(n.parent.formElements,"object")&&s.is(n.parent.formElementsToggler,"object")){var i=n.parent.formElements,o=n.parent.formElementsToggler;for(var a in i)!0===t.hidden.custom[a]&&(n.parent.parent.isTemplate?(s.is(i[a])&&i[a].toggleClassName("visibility-masked",!0),s.is(o[a])&&(o[a].toggleClassName("fonticon-eye-off",!0),o[a].toggleClassName("fonticon-eye",!1))):s.is(i[a])&&i[a].hide())}return e.resolve()},getLabel:function(e){var t="",s=h.create.properties.custom;if(void 0!==s){var n=s[e.name];void 0!==n&&(t=n.label)}return""!==t&&void 0!==t||(t=e.title),""!==t&&void 0!==t||(t=e.name),t},getPlaceholder:function(e){var t="",s=h.create.properties.custom;if(void 0!==s){var n=s[e.name];void 0!==n&&(t=n.placeholder)}return""!==t&&void 0!==t||(t=e.title),""!==t&&void 0!==t||(t=e.name),t},getHelper:function(e){var t="",s=h.create.properties.custom;if(void 0!==s){var n=s[e.name];void 0!==n&&(t=n.helper)}return""!==t&&void 0!==t||(t=e.title),""!==t&&void 0!==t||(t=e.name),t}})}),define("DS/IssueComponents/team/MembersDataGridModel",["UWA/Class/Model","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/IssueComponents/team/MembersGridUtil","DS/IssueServices/services/IssueServices","i18n!DS/IssueComponents/assets/nls/IssueComponents","DS/IssueServices/services/PlatformServices","DS/IssueCommon/utils/Utils","DS/PADUtils/views/PADAlert","DS/UIKIT/Mask","DS/Controls/Button"],function(e,t,s,n,i,o,a,r,l,c,d){"use strict";var u=e.extend({init:function(e){this.contextID=e},setTreeDocument:function(e){this.treeDocument=e},getTreeDocument:function(){return this.treeDocument},createTreeDocument:function(){var e=new t({useAsyncPreExpand:!0,id:"issMembers",shouldBeSelected:function(e){return 1!=e.options.grid.isRoot}});return this.setTreeDocument(e),e},loadMembersData:function(e,t,n,i,a,r){e.prepareUpdate(),e.empty(),this.owner=new s({label:o.team.owner.title+" (0)",icons:[{iconName:"user"}],grid:{isRoot:!0,role:"Owner"}}),this.coowners=new s({label:o.team.coOwners.title+" (0)",icons:[{iconName:"user"}],grid:{isRoot:!0,role:"Co-owner"}}),this.assignees=new s({label:o.team.assignees.title+" (0)",icons:[{iconName:"user"}],grid:{isRoot:!0,role:"Assignee"}}),this.contributors=new s({label:o.team.contributors.title+" (0)",icons:[{iconName:"user"}],grid:{isRoot:!0,role:"Contributor"}}),this.informedUsers=new s({label:o.team.informedUsers.title+" (0)",icons:[{iconName:"user"}],grid:{isRoot:!0,role:"InformedUser"}}),e.addRoot(this.owner),e.addRoot(this.coowners),e.addRoot(this.assignees),e.addRoot(this.contributors),e.addRoot(this.informedUsers);var l=this.createTreeDocumentNodeModel(t,"owner");this.owner.addChild(l),this.owner.setLabel(o.team.owner.title+" ("+l.length+")"),this.owner.expandAll(),l=this.createTreeDocumentNodeModel(n,"coowners"),this.coowners.addChild(l),this.coowners.setLabel(o.team.coOwners.title+" ("+l.length+")"),this.coowners.expandAll(),l=this.createTreeDocumentNodeModel(i,"assignees"),this.assignees.addChild(l),this.assignees.setLabel(o.team.assignees.title+" ("+l.length+")"),this.assignees.expandAll(),l=this.createTreeDocumentNodeModel(a,"contributors"),this.contributors.addChild(l),this.contributors.setLabel(o.team.contributors.title+" ("+l.length+")"),this.contributors.expandAll(),l=this.createTreeDocumentNodeModel(r,"informedUsers"),this.informedUsers.addChild(l),this.informedUsers.setLabel(o.team.informedUsers.title+" ("+l.length+")"),this.informedUsers.expandAll(),e.pushUpdate();var d=document.getElementById("iss-outer-member-grid-div");d&&c.isMasked(d)&&c.unmask(d)},createTreeDocumentNodeModel:function(e,t){var s=[];for(var n in e){var i=this.createTreeNode(e[n],t);s.push(i)}return s},createTreeDocumentNodeModelForNewMember:function(e,t){for(var s=[],n=0;n<e.length;n++){var i=this.createTreeNode(e[n],t);s.push(i)}return s},createTreeNode:function(e,t){e.username=e.user,e.root=t,e.role="",e.roleList="";for(var i=0;i<e.roles.length;i++){var o=e.roles[i],r=n.getRoleNLSValue(o);e.role+=o,e.roleList+=r,i!=e.roles.length-1&&(e.role+=",",e.roleList+=", ")}var l=e.roleList;a.get3DSpaceUrl();return"group"===e.type&&(e.username="","OnPremise"!==a.getTenant()&&e.uri&&(e.user=e.uri)),new s({subLabel:"",description:l,grid:e})},createCustomPersonNameField:function(e){var t="",s=a.get3DSwymUrl();t="person"===e.type?e.fullName+" ("+e.user+")":e.fullName;var n=new UWA.Element("div",{class:"members "+e.root,title:t}),i="";if((i="group"===e.type?UWA.createElement("span",{class:"user-group wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-users-group"}):this.getPersonImageDiv(e)).addClassName("assignee"),"group"==e.type)(o=new d({domId:"hyperlinkButton-members",displayStyle:"lite",label:e.fullName})).addEventListener("click",function(){a.getUserGroupProfile(e.uri)});else if(s){(o=new d({domId:"hyperlinkButton-members",displayStyle:"lite",label:e.fullName})).addEventListener("click",function(){a.getUserProfile(e.user)})}else var o=UWA.createElement("span",{class:"userName",html:e.fullName});return i.inject(n),o.inject(n),n},getPersonImageDiv:function(e,t){var s="/api/user/getpicture/login/"+e.user+"/format/normal",n=a.get3DSwymUrl(),i=new UWA.Element("div",{}),o="";if(""!==n)(o=UWA.createElement("img",{class:"userIcon",src:n+s})).addEventListener("click",function(){a.getUserProfile(e.user)});else{var r=a.getAvatarDetails(e.fullName);o=UWA.createElement("div",{html:r.avatarStr}),1==t?(o.addClassName("member-profile-picture"),o.addClassName("member-profile-text")):o.addClassName("avatarIcon"),o.style.setProperty("background",r.avatarColor)}return o.inject(i),i},addNodesInLayoutModel:function(e,t,s){var n=u.prototype.createTreeDocumentNodeModelForNewMember(t,s);e.prepareUpdate(),"coowners"===s?(this.coowners.addChild(n),this.coowners.setLabel(o.team.coOwners.title+" ("+this.coowners.getNumberOfChildren()+")")):"assignees"===s?(this.assignees.addChild(n),this.assignees.setLabel(o.team.assignees.title+" ("+this.assignees.getNumberOfChildren()+")")):"contributors"===s?(this.contributors.addChild(n),this.contributors.setLabel(o.team.contributors.title+" ("+this.contributors.getNumberOfChildren()+")")):"informedUsers"===s&&(this.informedUsers.addChild(n),this.informedUsers.setLabel(o.team.informedUsers.title+" ("+this.informedUsers.getNumberOfChildren()+")")),this.coowners.expandAll(),this.assignees.expandAll(),this.contributors.expandAll(),this.informedUsers.expandAll(),e.pushUpdate()},removeChildren:function(){var e=this,t=(e.contextID,document.getElementById("iss-outer-member-grid-div")),s=e.treeDocument.getSelectedNodes();if(0!=s.length){for(var n=[],a=[],d=[],u=[],m=[],p=!1,f=0;f<s.length;f++){let e=s[f].options.grid;var h=e.roles;m.includes(e.user)||(h.includes("Owner")&&(p=!0),h.includes("Co-owner")&&d.push({user:e.user}),h.includes("Assignee")&&a.push({user:e.user,type:e.type}),h.includes("Contributor")&&n.push({user:e.user}),h.includes("InformedUser")&&u.push({user:e.user,type:e.type}),m.push(e.user))}d.length>0||a.length>0||n.length>0||u.length>0?require(["DS/IssueComponents/team/MembersDataGridLayout"],function(m){var p=[];c.mask(t);for(var f=0;f<m.issues.length;f++){var h={physicalId:m.issues[f].id};d.length>0&&(h.coOwners=d),a.length>0&&(h.assignees=a),n.length>0&&(h.contributors=n),u.length>0&&(h.informedUsers=u),p.push(h)}i.people.delete({data:{objects:p}}).then(function(){for(var n=!1,i=0;i<s.length;i++){var a=s[i].options.grid.roles,r=a.indexOf("Owner")>=0,d=a.indexOf("Co-owner")>=0,u=a.indexOf("Assignee")>=0,p=a.indexOf("Contributor")>=0,f=a.indexOf("InformedUser")>=0,h=s[i].options.grid.user;if(r&&(n=!0),d){var g=e.coowners.getAllDescendants().filter(e=>e.options.grid.user==h);g.length>0&&(g[0].remove(),a=a.filter(function(e){return"Co-owner"!=e}),s[i].options.grid.roles=a,e.coowners.setLabel(o.team.coOwners.title+" ("+e.coowners.getNumberOfChildren()+")"))}if(u){var v=e.assignees.getAllDescendants().filter(e=>e.options.grid.user==h);v.length>0&&(v[0].remove(),a=a.filter(function(e){return"Assignee"!=e}),s[i].options.grid.roles=a,e.assignees.setLabel(o.team.assignees.title+" ("+e.assignees.getNumberOfChildren()+")"))}if(p){var b=e.contributors.getAllDescendants().filter(e=>e.options.grid.user==h);b.length>0&&(b[0].remove(),a=a.filter(function(e){return"Contributor"!=e}),s[i].options.grid.roles=a,e.contributors.setLabel(o.team.contributors.title+" ("+e.contributors.getNumberOfChildren()+")"))}if(f){var C=e.informedUsers.getAllDescendants().filter(e=>e.options.grid.user==h);C.length>0&&(C[0].remove(),a=a.filter(function(e){return"InformedUser"!=e}),s[i].options.grid.roles=a,e.informedUsers.setLabel(o.team.informedUsers.title+" ("+e.informedUsers.getNumberOfChildren()+")"))}}n&&(e.owner.getAllDescendants()[0].options.grid.roles=["Owner"],l.displayNotification({msg:o.team.error.skipRemoveOwner,eventID:"info"}));m.view.dispatchEvent("onUpdate",{issues:m.issues}),c.unmask(t)}).catch(function(e){if(c.unmask(t),e.error.message.includes("'business object' does not exist")){var s=r.getErrorMessage("0");r.displayErrorMessage(s,"error")}else if(UWA.is(e.error.internal)&&(e.error.internal.includes("No 'modify' access on Attribute 'Co-Owners' for")||e.error.internal.includes("No 'read' access on Attribute 'Co-Owners' for")||e.error.internal.includes("You do not have the permissions to perform this action"))){s=r.getErrorMessage("1");r.displayErrorMessage(s,"error")}else l.displayNotification({msg:e.error.message,eventID:"error"})})}):p&&l.displayNotification({msg:o.team.error.skipRemoveOwner,eventID:"info"})}}});return u}),define("DS/IssueComponents/create/Classification",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/Controls/DatePicker","DS/Controls/LineEditor","DS/Controls/ComboBox","DS/Controls/Toggle","DS/Controls/Expander","DS/Controls/SpinBox","DS/WUXAutoComplete/AutoComplete","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/IssueComponents/create/AutoComplete","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f,h){"use strict";var g={DATE:"timestamp",TEXT:"string",INT:"integer",REAL:"real",BOOL:"boolean"},v="true";return t.extend({name:"DS/IssueComponents/create/Classify",tag:"div",className:"create-view-content-subview create-classify",isInit:null,_deferredInit:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s.parent=t.parent,s.isInit=new e(function(e,t){s._deferredInit.resolve=e,s._deferredInit.reject=t}),s.formElements={},s.formElementsToggler={},s.fields={},s.noShow=!t.classification,s._classes=[],s._classificationData=t.classification?t.classification.data:[],s.templateAttributes=t.classification.attributes?t.classification.attributes:{},s.selectedData=t.classification.selectedData?t.classification.selectedData:[],s.classModel=t.classification.classModel?t.classification.classModel:{},s._deferredInit.resolve()},destroy:function(){var e=this;e.form=null,Object.keys(e.fields).forEach(function(t){e.fields[t]=null,e.formElements[t]=null,e.formElementsToggler[t]=null})},render:function(){return this.form=s.createElement("div",{class:"classify-form"}),this.renderClassificationAttributes(),this},renderClassificationAttributes:function(){var e=this;e._classificationData.forEach(function(t,n){e._classes.push(t.classId);var i=s.createElement("div",{}),o=[];t.classAttributes.sort((e,t)=>e.name>t.name?1:-1),t.classAttributes.forEach(function(i,a){var r=e.getPlaceholder(i),l=i.authorizedValues,c=!!i.multivalued&&i.multivalued,d=[];l&&i.authorizedValues.forEach(function(e){d.push(e)});var u=s.createElement("h5",{class:"form-field",html:[s.createElement("span",{html:e.getLabel(i)})]});switch(i.type){case g.DATE:var m=e.formElements[i.name]=s.createElement("div",{class:"create-form-element create-properties-form-element-date",html:[{tag:"div",class:"classify-form-field",html:[{html:u},e.fields[i.name]=e.getDateField(e._classificationData[n].classAttributes[a],i.default,e.templateAttributes[i.name])]}]});if(e.selectedData.attributeFields[i.name]){p=e.selectedData.attributeFields[i.name].fields,f={classPath:t.classPath,field:e.fields[i.name]};p.push(f)}else{var p=[],f={classPath:t.classPath,field:e.fields[i.name]};p.push(f),e.selectedData.attributeFields[i.name]={},e.selectedData.attributeFields[i.name].fields=p}o.push(m);break;case g.INT:case g.REAL:var h=e.formElements[i.name]=s.createElement("div",{class:"create-form-element create-properties-form-element-number",html:[{tag:"div",class:"classify-form-field",html:[{html:u},e.fields[i.name]=l?e.getComboBox(e._classificationData[n].classAttributes[a],d,c,e.templateAttributes[i.name]):e.getNumberField(e._classificationData[n].classAttributes[a],r,c,e.templateAttributes[i.name])]}]});if(e.selectedData.attributeFields[i.name]){p=e.selectedData.attributeFields[i.name].fields,f={classPath:t.classPath,field:e.fields[i.name]};p.push(f)}else{var p=[],f={classPath:t.classPath,field:e.fields[i.name]};p.push(f),e.selectedData.attributeFields[i.name]={},e.selectedData.attributeFields[i.name].fields=p}o.push(h);break;case g.BOOL:var b=e.formElements[i.name]=s.createElement("div",{class:"create-form-element create-properties-form-element-boolean",html:[{tag:"div",class:"classify-form-field",html:[{html:u},e.fields[i.name]=e.getBooleanField(e._classificationData[n].classAttributes[a],i.default===v,e.templateAttributes[i.name])]}]});if(e.selectedData.attributeFields[i.name]){p=e.selectedData.attributeFields[i.name].fields,f={classPath:t.classPath,field:e.fields[i.name]};p.push(f)}else{p=[],f={classPath:t.classPath,field:e.fields[i.name]};p.push(f),e.selectedData.attributeFields[i.name]={},e.selectedData.attributeFields[i.name].fields=p}o.push(b);break;case g.TEXT:var C=e.formElements[i.name]=s.createElement("div",{class:"create-form-element create-properties-form-element-text",html:[{tag:"div",class:"classify-form-field",html:[{html:u},e.fields[i.name]=l?e.getComboBox(e._classificationData[n].classAttributes[a],d,c,e.templateAttributes[i.name]):e.getTextField(e._classificationData[n].classAttributes[a],r,c,e.templateAttributes[i.name])]}]});if(e.selectedData.attributeFields[i.name]){p=e.selectedData.attributeFields[i.name].fields,f={classPath:t.classPath,field:e.fields[i.name]};p.push(f)}else{p=[],f={classPath:t.classPath,field:e.fields[i.name]};p.push(f),e.selectedData.attributeFields[i.name]={},e.selectedData.attributeFields[i.name].fields=p}o.push(C)}}),o.forEach(function(e){e.inject(i)});var a=s.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-close"});a.addEvent("click",function(){delete e.selectedData.classes[t.classId];for(var s=e.selectedData._classificationData,n=0;n<s.length;n++)s[n][0].classId===t.classId&&s.splice(n,1);var i=l.header,o=(l.body.getChildren(),l.body.querySelectorAll("h5"));o.length>0&&o.forEach(function(t){for(var s=e.selectedData.attributeFields[t.textContent].fields,n=0;n<s.length;n++)if(s[n].classPath===i){s.splice(n,1);break}0===s.length&&delete e.selectedData.attributeFields[t.textContent]}),l.destroy()});var l=new r({header:t.classPath,body:i,customHeader:a,expandedFlag:!0});l.inject(e.form)})},show:function(){this._parent()},hide:function(){this._parent()},getLabel:function(e){var t="",s=h.create.properties.classification;if(void 0!==s){var n=s[e.name];void 0!==n&&(t=n.label)}return""!==t&&void 0!==t||(t=e.name),t},getPlaceholder:function(e){var t="",s=h.create.properties.classification;if(void 0!==s){var n=s[e.name];void 0!==n&&(t=n.placeholder)}return""!==t&&void 0!==t||(t=e.name),t},getDateField:function(e,t,s){var i=this,o="";if(i.selectedData.attributeFields[e.name]&&void 0!==i.selectedData.attributeFields[e.name].value)e.value=i.selectedData.attributeFields[e.name].value,i.selectedData.attributes[e.name]=e.value,o=e.value;else if(void 0!==s)e.value=s,i.selectedData.attributes[e.name]=s,o=new Date(s);else if(void 0!==t){var a=t.substr(8,2),r=t.substr(5,2)-1,l=t.substr(0,4);o=new Date(l,r,a)}else o=void 0;var c=new n({value:o});return c.getContent().addEventListener("change",function(){var t=c.value;null!==t&&(e.value=t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear(),i.selectedData.attributes[e.name]=e.value,i.selectedData.attributeFields[e.name].fields.forEach(function(e){e.field.value=t}),i.selectedData.attributeFields[e.name].value=t)}),c},getTextField:function(e,t,s,n){var o=this,a=(e.type,void 0===e.default?"":e.default);o.selectedData.attributeFields[e.name]&&void 0!==o.selectedData.attributeFields[e.name].value?(e.value=o.selectedData.attributeFields[e.name].value,o.selectedData.attributes[e.name]=e.value,a=e.value):void 0!==n&&(e.value=n,o.selectedData.attributes[e.name]=n,a=n);var r=null;return s?r=o.getMultiValueField(e,a,n):((r=new i({placeholder:t,value:a})).getContent().setStyle("width","100%"),r.addEventListener("change",function(){e.value=r.value,o.selectedData.attributes[e.name]=e.value,o.selectedData.attributeFields[e.name].fields.forEach(function(t){t.field.value=e.value}),o.selectedData.attributeFields[e.name].value=e.value})),r},getNumberField:function(e,t,s,n){var i=this,o=e.type,a=void 0===e.default?0:e.default;i.selectedData.attributeFields[e.name]&&void 0!==i.selectedData.attributeFields[e.name].value?(e.value=i.selectedData.attributeFields[e.name].value,i.selectedData.attributes[e.name]=e.value,a=e.value):void 0!==n&&(e.value=n,i.selectedData.attributes[e.name]=n,a=n);var r=null;if(s)r=i.getMultiValueField(e,a,n);else{var c=e.maximum,d=e.minimum;c=void 0!==c?o===g.INT?parseInt(c):parseFloat(c):o===g.INT?2147483646:999999999999999,(r=new l({value:o===g.INT?parseInt(a):parseFloat(a),stepValue:o===g.INT?1:.1,minValue:d?o===g.INT?parseInt(d):parseFloat(d):"",maxValue:c,decimals:o===g.INT?0:6})).addEventListener("change",function(){e.value=r.value,i.selectedData.attributes[e.name]=e.value,i.selectedData.attributeFields[e.name].fields.forEach(function(t){t.field.value=e.value}),i.selectedData.attributeFields[e.name].value=e.value})}return r},getComboBox:function(e,t,s,n){var i=this,o=null,a=e.type,r=e.default;if(i.selectedData.attributeFields[e.name]&&void 0!==i.selectedData.attributeFields[e.name].value?(e.value=i.selectedData.attributeFields[e.name].value,i.selectedData.attributes[e.name]=e.value,r=e.value):void 0!==n&&(e.value=n,i.selectedData.attributes[e.name]=n,r=n),a!==g.INT&&a!==g.REAL||t.sort(function(e,t){return e-t}),s)if(""!==t&&t.length>0){var l=[];""!==t&&t.forEach(function(e,t){l.push({labelItem:e,valueItem:e})});var m=function(e,t){return new u({label:e,value:t})},p=function(){var e=new d;e.prepareUpdate();for(var t=0;t<l.length;t++){var s=l[t].labelItem,n=l[t].valueItem,i=m(s,n);e.addRoot(i)}return e.pushUpdate(),e}(),f=!0,h=[];l.length>0&&l.forEach(function(e,t){var s=[];if(null!=r)for(var n=0;n<r.length;n++)s[n]=r[n]+"";null!=r&&s.includes(e.valueItem)&&h.push(p.getRoots()[t])}),(o=new c({elementsTree:p,multiSearchMode:f,selectedItems:h,allowFreeInputFlag:!1})).addEventListener("change",function(){for(var t=o.selectedItems,s=[],n=i.selectedData.attributeFields[e.name].fields,a=0;a<t.length;a++)s.push(t[a].options.value);n.forEach(function(e){e.field.selectedItems=t}),e.value=s,i.selectedData.attributes[e.name]=e.value,i.selectedData.attributeFields[e.name].value=e.value})}else o=i.getMultiValueField(e,r,n,t);else{var v=void 0===r?"":r;l=[];""!==t&&t.forEach(function(e,t){l.push({labelItem:e,valueItem:e})});m=function(e,t){return new u({label:e,value:t})},p=function(){var e=new d;e.prepareUpdate();for(var t=0;t<l.length;t++){var s=l[t].labelItem,n=l[t].valueItem,i=m(s,n);e.addRoot(i)}return e.pushUpdate(),e}(),f=!1,h=[];l.length>0&&l.forEach(function(e,t){v+""===e.valueItem&&h.push(p.getRoots()[t])}),(o=new c({elementsTree:p,multiSearchMode:f,selectedItems:h,allowFreeInputFlag:!1})).addEventListener("change",function(){e.value=o.value,i.selectedData.attributes[e.name]=e.value,i.selectedData.attributeFields[e.name].fields.forEach(function(t){t.field.value=e.value}),i.selectedData.attributeFields[e.name].value=e.value})}return o.getContent().addEventListener("keydown",function(e){13==e.keyCode&&e.stopPropagation()}),o},getBooleanField:function(e,t,s){var n=this;e.multivalued&&Array.isArray(s)&&(s=s.length>0&&s[0]),n.selectedData.attributeFields[e.name]&&void 0!==n.selectedData.attributeFields[e.name].value?(e.value=n.selectedData.attributeFields[e.name].value,n.selectedData.attributes[e.name]=e.value,t=e.value):void 0!==s&&(e.value=s,n.selectedData.attributes[e.name]=e.value,t=s);var i=new a({type:"switch",checkFlag:t});return i.addEventListener("change",function(){e.value=i.checkFlag,n.selectedData.attributes[e.name]=e.value,n.selectedData.attributeFields[e.name].fields.forEach(function(t){t.field.checkFlag=e.value}),n.selectedData.attributeFields[e.name].value=e.value}),i.getContent().addEventListener("keydown",function(e){13==e.keyCode&&e.stopPropagation()}),i},getMultiValueField:function(e,t,s,n){var i=this;s=t||s,n=n||[];var o=new m({dataType:e.type,selectedValues:s,rangeValues:n});return o.addEventListener("change",function(){var t=o.selectedItems,s=[];i.selectedData.attributeFields[e.name].fields.forEach(function(e){e.field._selectionChips.removeAllChips(),e.field.selectedItems=[],s=[];for(var n=0;n<t.length;n++)s.push(t[n].value),e.field._selectionChips.addChip({label:t[n].value,value:t[n].value}),e.field.selectedItems.push({label:t[n].value,value:t[n].value})}),e.value=s,i.selectedData.attributes[e.name]=e.value,i.selectedData.attributeFields[e.name].value=e.value}),o.getContent().addEventListener("keydown",function(e){13==e.keyCode&&e.stopPropagation()}),o}})}),define("DS/IssueComponents/team/AddMembersLayout",["DS/IssueComponents/team/AddMembersView","DS/IssueComponents/team/MembersGridUtil","DS/IssueComponents/team/MembersMakeDroppable","DS/IssueComponents/team/MembersDataGridModel","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","DS/Controls/Button","DS/WUXAutoComplete/AutoComplete","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/PADUtils/views/PADAlert","DS/UIKIT/Mask","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f){"use strict";var h={createAddMemberPanel:function(t){h.teamlayoutModel=t.model,new e({events:{searchMember:function(e){var t='(flattenedtaxonomies:"types/Person" AND policycurrent:"Person.Active")';if("Assignee"===e||"InformedUser"===e){t+="OnPremise"===o.getTenant()?' OR (flattenedtaxonomies:"types/Group" AND current:"active")':" OR ([ds6w:type]:(Group))"}o.search({title:f.team.addMember[e.toLowerCase()],default_search_criteria:"",precond:t,multiSel:!0,callback:function(t){for(var s=[],n=0;n<t.length;n++)s.push({objectId:t[n].id,identifier:t[n]["ds6w:identifier"],objectType:t[n]["ds6w:type"],displayType:t[n]["ds6w:type_value"],displayName:t[n]["ds6w:label"],serviceId:t[n].sourceid});var i={data:{}};i.data.items=s,h.ExecuteDropForAddMemberPanel(i,e)},cancel:function(){}})}}}).render().inject(t.target);var n=t.target.querySelector(".iss-add-member-coowner-field"),a=t.target.querySelector(".iss-add-member-assignee-field"),r=t.target.querySelector(".iss-add-member-contributor-field"),m=t.target.querySelector(".iss-add-member-informedUser-field"),p=t.target.querySelector(".iss-add-member-button"),g=t.target.querySelector(".iss-add-member-coowner-field-container"),v=t.target.querySelector(".iss-add-member-assignee-field-container"),b=t.target.querySelector(".iss-add-member-contributor-field-container"),C=t.target.querySelector(".iss-add-member-informedUser-field-container");s.makeDroppable(g,h.ExecuteDropForCoownerField),s.makeDroppable(v,h.ExecuteDropForAssigneeField),s.makeDroppable(b,h.ExecuteDropForContributorField),s.makeDroppable(C,h.ExecuteDropForInformedUserField),h.addButton=new l({label:f.team.addMember.add,emphasize:"primary",disabled:!0}).inject(p),h.cancelButton=new l({label:f.team.addMember.cancel,emphasize:"secondary"}).inject(p),h.modelForCoowner=new d,h.modelForContributor=new d,h.modelForAssignee=new d,h.modelForInformedUser=new d,h.autoCompleteAssignee=new c({elementsTree:function(e){return new Promise(function(t,s){setTimeout(function(){h.modelForAssignee.empty(),i.getMembers({text:e}).then(function(e){h.modelForAssignee.prepareUpdate(),require(["DS/IssueComponents/team/MembersDataGridLayout"],function(s){let n={};s.issues;var i=s.membersDataGridModel.assignees.getChildren()?s.membersDataGridModel.assignees.getChildren():[];for(let e=0;e<i.length;e++){let t=i[e].options.grid;n[t.user]=t.role}for(var o=h.autoCompleteAssignee.selectedItems,a=0;a<e.length;a++){var r=e[a].identifier,l=[];if(o&&o.length>0&&(l=o.filter(t=>"person"===e[a].type.toLowerCase()?t.options.identifier===e[a].identifier:t.options.identifier===e[a].id)),!o||0==o.length||0==l.length)if("person"===e[a].type.toLowerCase()){var c=e[a].name+" ("+e[a].identifier.toUpperCase()+")";if(!n.hasOwnProperty(r)||!n[r].contains("Assignee")){var d=new u({label:c,value:e[a].identifier,name:e[a].name,identifier:e[a].identifier,type:e[a].type.toLowerCase()});h.modelForAssignee.addRoot(d)}}else if(!("group"!==e[a].type.toLowerCase()||n.hasOwnProperty(e[a].id)&&n[e[a].id].contains("Assignee"))){d=new u({label:e[a].name,value:e[a].identifier,name:e[a].name,identifier:e[a].id,type:e[a].type.toLowerCase()});h.modelForAssignee.addRoot(d)}}h.modelForAssignee.pushUpdate(),t(h.modelForAssignee)})},function(e){t(h.modelForAssignee)})},1e3)})},placeholder:f.team.addMember.typeToSearch,customFilterMessage:f.team.addMember.noSearchFound,multiSearchMode:!0,allowFreeInputFlag:!1,minLengthBeforeSearch:3,keepSearchResultsFlag:!1}).inject(a),h.autoCompleteCoowner=new c({elementsTree:function(e){return new Promise(function(t,s){setTimeout(function(){h.modelForCoowner.empty(),i.getMembers({text:e}).then(function(e){h.modelForCoowner.prepareUpdate(),require(["DS/IssueComponents/team/MembersDataGridLayout"],function(s){let n={};s.issues;var i=s.membersDataGridModel.coowners.getChildren()?s.membersDataGridModel.coowners.getChildren():[];for(let e=0;e<i.length;e++){let t=i[e].options.grid;n[t.user]=t.role}for(var o=h.autoCompleteCoowner.selectedItems,a=0;a<e.length;a++){var r=e[a].identifier,l=[];o&&o.length>0&&(l=o.filter(t=>t.options.identifier===e[a].identifier));var c=(s.membersDataGridModel.owner.getChildren()?s.membersDataGridModel.owner.getChildren():[]).filter(t=>t.options.grid.user===e[a].identifier);if((!o||0==o.length||0==l.length)&&0==c.length&&"person"===e[a].type.toLowerCase()){var d=e[a].name+" ("+e[a].identifier.toUpperCase()+")";if(!n.hasOwnProperty(r)||!n[r].contains("Co-owner")){var m=new u({label:d,value:e[a].identifier,name:e[a].name,identifier:e[a].identifier,type:e[a].type.toLowerCase()});h.modelForCoowner.addRoot(m)}}}h.modelForCoowner.pushUpdate(),t(h.modelForCoowner)})},function(e){t(h.modelForCoowner)})},1e3)})},placeholder:f.team.addMember.typeToSearch,customFilterMessage:f.team.addMember.noSearchFound,multiSearchMode:!0,allowFreeInputFlag:!1,minLengthBeforeSearch:3,keepSearchResultsFlag:!1}).inject(n),h.autoCompleteContributor=new c({elementsTree:function(e){return new Promise(function(t,s){setTimeout(function(){h.modelForContributor.empty(),i.getMembers({text:e}).then(function(e){h.modelForContributor.prepareUpdate(),require(["DS/IssueComponents/team/MembersDataGridLayout"],function(s){let n={};s.issues;var i=s.membersDataGridModel.contributors.getChildren()?s.membersDataGridModel.contributors.getChildren():[];for(let e=0;e<i.length;e++){let t=i[e].options.grid;n[t.user]=t.role}for(var o=h.autoCompleteContributor.selectedItems,a=0;a<e.length;a++){var r=e[a].identifier,l=[];if(o&&o.length>0&&(l=o.filter(t=>t.options.identifier===e[a].identifier)),(!o||0==o.length||0==l.length)&&"person"===e[a].type.toLowerCase()){var c=e[a].name+" ("+e[a].identifier.toUpperCase()+")";if(!n.hasOwnProperty(r)||!n[r].contains("Contributor")){var d=new u({label:c,value:e[a].identifier,name:e[a].name,identifier:e[a].identifier,type:e[a].type.toLowerCase()});h.modelForContributor.addRoot(d)}}}h.modelForContributor.pushUpdate(),t(h.modelForContributor)})},function(e){t(h.modelForContributor)})},1e3)})},placeholder:f.team.addMember.typeToSearch,customFilterMessage:f.team.addMember.noSearchFound,multiSearchMode:!0,allowFreeInputFlag:!1,minLengthBeforeSearch:3,keepSearchResultsFlag:!1}).inject(r),h.autoCompleteInformedUser=new c({elementsTree:function(e){return new Promise(function(t,s){setTimeout(function(){h.modelForInformedUser.empty(),i.getMembers({text:e}).then(function(e){h.modelForInformedUser.prepareUpdate(),require(["DS/IssueComponents/team/MembersDataGridLayout"],function(s){let n={};s.issues;var i=s.membersDataGridModel.informedUsers.getChildren()?s.membersDataGridModel.informedUsers.getChildren():[];for(let e=0;e<i.length;e++){let t=i[e].options.grid;n[t.user]=t.role}for(var o=h.autoCompleteInformedUser.selectedItems,a=0;a<e.length;a++){var r=e[a].identifier,l=[];if(o&&o.length>0&&(l=o.filter(t=>"person"===e[a].type.toLowerCase()?t.options.identifier===e[a].identifier:t.options.identifier===e[a].id)),!o||0==o.length||0==l.length)if("person"===e[a].type.toLowerCase()){var c=e[a].name+" ("+e[a].identifier.toUpperCase()+")";if(!n.hasOwnProperty(r)||!n[r].contains("InformedUser")){var d=new u({label:c,value:e[a].identifier,name:e[a].name,identifier:e[a].identifier,type:e[a].type.toLowerCase()});h.modelForInformedUser.addRoot(d)}}else if(!("group"!==e[a].type.toLowerCase()||n.hasOwnProperty(e[a].id)&&n[e[a].id].contains("InformedUser"))){d=new u({label:e[a].name,value:e[a].identifier,name:e[a].name,identifier:e[a].id,type:e[a].type.toLowerCase()});h.modelForInformedUser.addRoot(d)}}h.modelForInformedUser.pushUpdate(),t(h.modelForInformedUser)})},function(e){t(h.modelForInformedUser)})},1e3)})},placeholder:f.team.addMember.typeToSearch,customFilterMessage:f.team.addMember.noSearchFound,multiSearchMode:!0,allowFreeInputFlag:!1,minLengthBeforeSearch:3,keepSearchResultsFlag:!1}).inject(m),h.autoCompleteAssignee.addEventListener("change",function(){h.enableAddButton()}),h.autoCompleteCoowner.addEventListener("change",function(){h.enableAddButton()}),h.autoCompleteContributor.addEventListener("change",function(){h.enableAddButton()}),h.autoCompleteInformedUser.addEventListener("change",function(){h.enableAddButton()}),h.enableAddButton=function(){var e=h.autoCompleteAssignee.selectedItems?h.autoCompleteAssignee.selectedItems.length:0,t=h.autoCompleteCoowner.selectedItems?h.autoCompleteCoowner.selectedItems.length:0,s=h.autoCompleteContributor.selectedItems?h.autoCompleteContributor.selectedItems.length:0,n=h.autoCompleteInformedUser.selectedItems?h.autoCompleteInformedUser.selectedItems.length:0;h.addButton.disabled=!(e>0||t>0||s>0||n>0)},h.addButton.addEventListener("buttonclick",function(e){t.target.hide(),document.querySelector(".toolbar-member-grid-div .wux-ui-3ds-user-add").removeClassName("member-toolbar-active");var s=document.querySelector(".iss-member-grid-div"),n=document.querySelector(".membertileView");s.removeClassName("teamview-opaque"),n.removeClassName("teamview-opaque");var i=[],o=[],a=[],r=[];if(null!=h.autoCompleteCoowner.selectedItems)for(var l=0;l<h.autoCompleteCoowner.selectedItems.length;l++){let e=h.autoCompleteCoowner.selectedItems[l].options;i.push(e)}if(null!=h.autoCompleteAssignee.selectedItems)for(l=0;l<h.autoCompleteAssignee.selectedItems.length;l++){let e=h.autoCompleteAssignee.selectedItems[l].options;o.push(e)}if(null!=h.autoCompleteContributor.selectedItems)for(l=0;l<h.autoCompleteContributor.selectedItems.length;l++){let e=h.autoCompleteContributor.selectedItems[l].options;a.push(e)}if(null!=h.autoCompleteInformedUser.selectedItems)for(l=0;l<h.autoCompleteInformedUser.selectedItems.length;l++){let e=h.autoCompleteInformedUser.selectedItems[l].options;r.push(e)}(i.length>0||o.length>0||a.length>0||r.length>0)&&(h.autoCompleteCoowner.selectedItems=h.autoCompleteAssignee.selectedItems=h.autoCompleteContributor.selectedItems=h.autoCompleteInformedUser.selectedItems=void 0,h.addMembers(i,o,a,r))}),h.cancelButton.addEventListener("buttonclick",function(e){t.target.hide(),document.querySelector(".toolbar-member-grid-div .wux-ui-3ds-user-add").removeClassName("member-toolbar-active");var s=document.querySelector(".iss-member-grid-div"),n=document.querySelector(".membertileView");s.removeClassName("teamview-opaque"),n.removeClassName("teamview-opaque")})},launchAddMemberPanel:function(){var e=document.querySelector(".toolbar-member-grid-div .wux-ui-3ds-user-add"),t=document.querySelector(".toolbar-member-grid-div .wux-ui-3ds-filter"),s=document.querySelector(".addmemberView"),n=document.querySelector(".memberfilterView"),i=document.querySelector(".iss-member-grid-div"),o=document.querySelector(".membertileView");n.hide(),t.removeClassName("member-toolbar-active"),i.removeClassName("teamview-opaque"),o.removeClassName("teamview-opaque"),"block"==s.style.display?(s.hide(),e.removeClassName("member-toolbar-active")):(s.show(),e.addClassName("member-toolbar-active"),i.addClassName("teamview-opaque"),o.addClassName("teamview-opaque"))},addMembers:function(e,t,s,n,o,l,c){require(["DS/IssueComponents/team/MembersDataGridLayout"],function(d){var u=document.getElementById("iss-outer-member-grid-div");p.mask(u);for(var g=d.issues,v=[],b=0;b<g.length;b++){var C=g[b],y={physicalId:C.id},I=!1;if(e=e.filter(function(e){return e.identifier===C.owner.user&&(I=!0),e.identifier!==C.owner.user}),I&&m.displayNotification({msg:f.replace(f.team.error.isOwner,{name:C.owner.fullName}),eventID:"info"}),e.length>0){y.coOwners=e.map(function(e){return{user:e.identifier}});try{var E=r.get("component").getCurrentView();a.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:E,pd3:"MembersToolbar",pd4:"AddCoordinators",pd5:"Issue/"+E+"/MembersToolbar/AddCoordinators"}})}catch(e){}}if(t.length>0){y.assignees=t.map(function(e){return{user:e.identifier,type:e.type}});try{E=r.get("component").getCurrentView();a.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:E,pd3:"MembersToolbar",pd4:"AddAssignees",pd5:"Issue/"+E+"/MembersToolbar/AddAssignees"}})}catch(e){}}if(s.length>0){y.contributors=s.map(function(e){return{user:e.identifier}});try{E=r.get("component").getCurrentView();a.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:E,pd3:"MembersToolbar",pd4:"AddContributors",pd5:"Issue/"+E+"/MembersToolbar/AddContributors"}})}catch(e){}}if(n.length>0){y.informedUsers=n.map(function(e){return{user:e.identifier,type:e.type}});try{E=r.get("component").getCurrentView();a.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:E,pd3:"MembersToolbar",pd4:"AddInformedUsers",pd5:"Issue/"+E+"/MembersToolbar/AddInformedUsers"}})}catch(e){}}v.push(y)}try{a.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"MembersToolbar"}})}catch(e){}i.people.update({data:{objects:v}}).then(function(){for(var i=[],a=d.membersDataGridModel.coowners.getChildren()?d.membersDataGridModel.coowners.getChildren():[],r=[],m=0;m<e.length;m++){var f=(I=e[m]).identifier;I.fullName=I.name,I.user=I.identifier,I.roles=[],I.roles.push("Co-owner");for(var g=!1,v=0;v<a.length;v++)if(f==a[v].options.grid.user){g=!0;break}if(1==g);else d.membersDataGridModel.treeDocument.getAllDescendants().forEach(function(e){e.options.grid.user===I.user&&(e.options.grid.roles.includes("Co-owner")||e.options.grid.roles.push("Co-owner"),I.roles=e.options.grid.roles)}),i.push(I.user),r.push(I)}r.length>0&&d.addNodesInLayout(r,"coowners");var b=d.membersDataGridModel.assignees.getChildren()?d.membersDataGridModel.assignees.getChildren():[];r=[];for(m=0;m<t.length;m++){f=(I=t[m]).identifier;I.user=I.identifier,I.fullName=I.name,I.roles=[],I.roles.push("Assignee");for(g=!1,v=0;v<b.length;v++)if(f==b[v].options.grid.user){g=!0;break}if(1==g);else d.membersDataGridModel.treeDocument.getAllDescendants().forEach(function(e){e.options.grid.user===I.user&&(e.options.grid.roles.includes("Assignee")||e.options.grid.roles.push("Assignee"),I.roles=e.options.grid.roles)}),r.push(I)}r.length>0&&d.addNodesInLayout(r,"assignees");var C=d.membersDataGridModel.contributors.getChildren()?d.membersDataGridModel.contributors.getChildren():[];r=[];for(m=0;m<s.length;m++){f=(I=s[m]).identifier;I.user=I.identifier,I.fullName=I.name,I.roles=[],I.roles.push("Contributor");for(g=!1,v=0;v<C.length;v++)if(f==C[v].options.grid.user){g=!0;break}if(1==g);else d.membersDataGridModel.treeDocument.getAllDescendants().forEach(function(e){e.options.grid.user===I.user&&(e.options.grid.roles.includes("Contributor")||e.options.grid.roles.push("Contributor"),I.roles=e.options.grid.roles)}),r.push(I)}r.length>0&&d.addNodesInLayout(r,"contributors");var y=d.membersDataGridModel.informedUsers.getChildren()?d.membersDataGridModel.informedUsers.getChildren():[];r=[];for(m=0;m<n.length;m++){var I;f=(I=n[m]).identifier;I.user=I.identifier,I.fullName=I.name,I.roles=[],I.roles.push("InformedUser");for(g=!1,v=0;v<y.length;v++)if(f==y[v].options.grid.user){g=!0;break}if(1==g);else d.membersDataGridModel.treeDocument.getAllDescendants().forEach(function(e){e.options.grid.user===I.user&&(e.options.grid.roles.includes("InformedUser")||e.options.grid.roles.push("InformedUser"),I.roles=e.options.grid.roles)}),r.push(I)}if(r.length>0&&d.addNodesInLayout(r,"informedUsers"),c&&c.updateOptions({grid:{common:!0}}),!0===o){var E=[];"coOwners"==l?E=d.membersDataGridModel.coowners.getChildren()?d.membersDataGridModel.coowners.getChildren():[]:"assignees"==l?E=d.membersDataGridModel.assignees.getChildren()?d.membersDataGridModel.assignees.getChildren():[]:"contributors"==l?E=d.membersDataGridModel.contributors.getChildren()?d.membersDataGridModel.contributors.getChildren():[]:"informedUsers"==l&&(E=d.membersDataGridModel.informedUsers.getChildren()?d.membersDataGridModel.informedUsers.getChildren():[]),E.forEach(function(e){e.updateOptions({grid:{common:!0}})})}h.modelForCoowner.empty(),h.modelForAssignee.empty(),h.modelForContributor.empty(),h.modelForInformedUser.empty(),d.view.dispatchEvent("onUpdate",{issues:d.issues}),p.unmask(u)}).catch(function(e){if(p.unmask(u),h.modelForCoowner.empty(),h.modelForAssignee.empty(),h.modelForContributor.empty(),h.modelForInformedUser.empty(),e.error.message.includes("'business object' does not exist")){var t=a.getErrorMessage("0");a.displayErrorMessage(t,"error")}else if(UWA.is(e.error.internal)&&e.error.internal.includes("You do not have the permissions to perform this action")){t=a.getErrorMessage("1");a.displayErrorMessage(t,"error")}else if(UWA.is(e.error.internal)&&e.error.internal.includes("No toconnect access to business object")){t=a.getErrorMessage("10");a.displayErrorMessage(t,"error")}else if(UWA.is(e.error.internal)&&e.error.internal.includes("No 'modify' access on Attribute 'Co-Owners' for")){t=a.getErrorMessage("2005");a.displayErrorMessage(t,"error")}else m.displayNotification({msg:e.error.message,eventID:"error"})})})},assignToSelf:function(){require(["DS/IssueComponents/team/MembersDataGridLayout"],function(e){var t=o.getUserName(),s=o.getFullName(),n=h.modelForAssignee.getAllDescendants(),i=(d=e.membersDataGridModel.assignees.getChildren()?e.membersDataGridModel.assignees.getChildren():[]).filter(e=>e.options.grid.user===t),a=h.autoCompleteAssignee.selectedItems,r=n.filter(e=>e.options.identifier===t),l=h.autoCompleteAssignee.selectedItems,c=[];if(l&&l.length>0&&(c=l.filter(e=>e.options.identifier===t)),i.length>0)m.displayNotification({msg:f.team.memberAlreadyAdded,eventID:"info"});else if(0==r.length&&0==i.length&&0==c.length){if(document.querySelector(".addmemberView").isHidden()){var d;(d=[]).push({identifier:t,name:s,type:"person"}),h.addMembers([],d,[],[])}else{a=h.autoCompleteAssignee.selectedItems;h.modelForAssignee.prepareUpdate();var p=s+" ("+t.toUpperCase()+")",g=new u({label:p,value:t,name:s,identifier:t,type:"person"});h.modelForAssignee.addRoot(g),a?(a=a.concat(g),h.autoCompleteAssignee.selectedItems=a):(a=[g],h.autoCompleteAssignee.selectedItems=a),h.modelForAssignee.pushUpdate()}}else 1==r.length&&(a=a.concat(r[0]),h.autoCompleteAssignee.selectedItems=a)});try{var e=r.get("component").getCurrentView();a.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"MembersToolbar",pd4:"AssignToSelf",pd5:"Issue/"+e+"/MembersToolbar/AssignToSelf"}}),a.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"MembersToolbar"}})}catch(e){}},ExecuteDropForCoownerField:function(e){var t={data:{}};t.data.items=e,h.ExecuteDropForAddMemberPanel(t,"Coowner")},ExecuteDropForContributorField:function(e){var t={data:{items:[]}};t.data.items=e,h.ExecuteDropForAddMemberPanel(t,"Contributor")},ExecuteDropForAssigneeField:function(e){var t={data:{}};t.data.items=e,h.ExecuteDropForAddMemberPanel(t,"Assignee")},ExecuteDropForInformedUserField:function(e){var t={data:{}};t.data.items=e,h.ExecuteDropForAddMemberPanel(t,"InformedUser")},ExecuteDropForAddMemberPanel:function(e,t){if(e&&e.data&&e.data.items){var s=e.data.items;if(UWA.is(s)&&UWA.is(s.length)&&s.length>0){for(var n=[],o=[],a=[],r=[],l=[],c=0;c<s.length;c++)if(s[c].objectId){var d=s[c].serviceId.toLowerCase();d.includes("3dspace")?n.push(s[c].objectId):d.includes("3dswym")&&"pno:Person"==s[c].objectType?(o.push(s[c].objectId.replace("iam:","")),a.push(s[c].displayName),r.push(s[c])):d.includes("usersgroup")&&l.push(s[c])}n.length>0&&i.getAdditionalObjectInfo({pidArray:n}).then(function(e){require(["DS/IssueComponents/team/MembersDataGridLayout"],function(s){for(var i=0;i<n.length;i++){var o=e.additionObjectInfo[n[i]];if("Coowner"===t){var a=h.modelForCoowner.getAllDescendants(),r=s.membersDataGridModel.coowners.getChildren()?s.membersDataGridModel.coowners.getChildren():[],l=s.membersDataGridModel.owner.getChildren()?s.membersDataGridModel.owner.getChildren():[],c=h.autoCompleteCoowner.selectedItems,d=a.filter(e=>e.options.identifier===o.objectTitle),p=[];(w=h.autoCompleteCoowner.selectedItems)&&w.length>0&&(p=w.filter(e=>e.options.identifier===o.objectTitle));var g=r.filter(e=>e.options.grid.user===o.objectTitle),v=l.filter(e=>e.options.grid.user===o.objectTitle);if(0==d.length&&0==g.length&&0==p.length&&0==v.length){if("person"===o.type.toLowerCase()){h.modelForCoowner.prepareUpdate();var b=o.fullName+" ("+o.objectTitle.toUpperCase()+")",C=new u({label:b,value:o.objectTitle,name:o.fullName,identifier:o.objectTitle,type:o.type.toLowerCase()});h.modelForCoowner.addRoot(C),d.push(C),c?(c=c.concat(C),h.autoCompleteCoowner.selectedItems=c):(c=[C],h.autoCompleteCoowner.selectedItems=c),h.modelForCoowner.pushUpdate()}}else 1==d.length&&(c=c.concat(d[0]),h.autoCompleteCoowner.selectedItems=c);g.length>0?m.displayNotification({msg:f.team.memberAlreadyAdded,eventID:"info"}):v.length>0?m.displayNotification({msg:f.replace(f.team.error.isOwner,{name:o.objectName}),eventID:"info"}):0==d.length&&0==p.length&&m.displayNotification({msg:f.team.error.notSupportedObjects,eventID:"warning"})}else if("Contributor"===t){a=h.modelForContributor.getAllDescendants();var y=s.membersDataGridModel.contributors.getChildren()?s.membersDataGridModel.contributors.getChildren():[];c=h.autoCompleteContributor.selectedItems,d=a.filter(e=>e.options.identifier===o.objectTitle),p=[];(w=h.autoCompleteContributor.selectedItems)&&w.length>0&&(p=w.filter(e=>e.options.identifier===o.objectTitle));g=y.filter(e=>e.options.grid.user===o.objectTitle);if(0==d.length&&0==g.length&&0==p.length){if("person"===o.type.toLowerCase()){h.modelForContributor.prepareUpdate();b=o.fullName+" ("+o.objectTitle.toUpperCase()+")";var I=new u({label:b,value:o.objectTitle,name:o.fullName,identifier:o.objectTitle,type:o.type.toLowerCase()});h.modelForContributor.addRoot(I),d.push(I),c?(c=c.concat(I),h.autoCompleteContributor.selectedItems=c):(c=[I],h.autoCompleteContributor.selectedItems=c),h.modelForContributor.pushUpdate()}}else 1==d.length&&(c=c.concat(d[0]),h.autoCompleteContributor.selectedItems=c);g.length>0?m.displayNotification({msg:f.team.memberAlreadyAdded,eventID:"info"}):0==d.length&&0==p.length&&m.displayNotification({msg:f.team.error.notSupportedObjects,eventID:"warning"})}else if("Assignee"===t){a=h.modelForAssignee.getAllDescendants();var E=s.membersDataGridModel.assignees.getChildren()?s.membersDataGridModel.assignees.getChildren():[];c=h.autoCompleteAssignee.selectedItems,d=a.filter(e=>"person"===o.type.toLowerCase()?e.options.identifier===o.objectTitle:e.options.identifier===o.pid),p=[];(w=h.autoCompleteAssignee.selectedItems)&&w.length>0&&(p=w.filter(e=>"person"===o.type.toLowerCase()?e.options.identifier===o.objectTitle:e.options.identifier===o.pid));g=E.filter(e=>"person"===o.type.toLowerCase()?e.options.grid.user===o.objectTitle:e.options.grid.user===o.pid);if(0==d.length&&0==g.length&&0==p.length){if("person"===o.type.toLowerCase()){h.modelForAssignee.prepareUpdate();b=o.fullName+" ("+o.objectTitle.toUpperCase()+")";var S=new u({label:b,value:o.objectTitle,name:o.fullName,identifier:o.objectTitle,type:o.type.toLowerCase()});h.modelForAssignee.addRoot(S),d.push(S),c?(c=c.concat(S),h.autoCompleteAssignee.selectedItems=c):(c=[S],h.autoCompleteAssignee.selectedItems=c),h.modelForAssignee.pushUpdate()}else if("group"===o.type.toLowerCase()){h.modelForAssignee.prepareUpdate();S=new u({label:o.objectTitle,value:o.objectTitle,name:o.objectTitle,identifier:o.pid,type:o.type.toLowerCase()});h.modelForAssignee.addRoot(S),d.push(S),c?(c=c.concat(S),h.autoCompleteAssignee.selectedItems=c):(c=[S],h.autoCompleteAssignee.selectedItems=c),h.modelForAssignee.pushUpdate()}}else 1==d.length&&(c=c.concat(d[0]),h.autoCompleteAssignee.selectedItems=c);g.length>0?m.displayNotification({msg:f.team.memberAlreadyAdded,eventID:"info"}):0==d.length&&0==p.length&&m.displayNotification({msg:f.team.error.notSupportedObjects,eventID:"warning"})}else if("InformedUser"===t){a=h.modelForInformedUser.getAllDescendants();var w,T=s.membersDataGridModel.informedUsers.getChildren()?s.membersDataGridModel.informedUsers.getChildren():[];c=h.autoCompleteInformedUser.selectedItems,d=a.filter(e=>"person"===o.type.toLowerCase()?e.options.identifier===o.objectTitle:e.options.identifier===o.pid),p=[];(w=h.autoCompleteInformedUser.selectedItems)&&w.length>0&&(p=w.filter(e=>"person"===o.type.toLowerCase()?e.options.identifier===o.objectTitle:e.options.identifier===o.pid));g=T.filter(e=>"person"===o.type.toLowerCase()?e.options.grid.user===o.objectTitle:e.options.grid.user===o.pid);if(0==d.length&&0==g.length&&0==p.length){if("person"===o.type.toLowerCase()){h.modelForInformedUser.prepareUpdate();b=o.fullName+" ("+o.objectTitle.toUpperCase()+")";var D=new u({label:b,value:o.objectTitle,name:o.fullName,identifier:o.objectTitle,type:o.type.toLowerCase()});h.modelForInformedUser.addRoot(D),d.push(D),c?(c=c.concat(D),h.autoCompleteInformedUser.selectedItems=c):(c=[D],h.autoCompleteInformedUser.selectedItems=c),h.modelForInformedUser.pushUpdate()}else if("group"===o.type.toLowerCase()){h.modelForInformedUser.prepareUpdate();D=new u({label:o.objectTitle,value:o.objectTitle,name:o.objectTitle,identifier:o.pid,type:o.type.toLowerCase()});h.modelForInformedUser.addRoot(D),d.push(D),c?(c=c.concat(D),h.autoCompleteInformedUser.selectedItems=c):(c=[D],h.autoCompleteInformedUser.selectedItems=c),h.modelForInformedUser.pushUpdate()}}else 1==d.length&&(c=c.concat(d[0]),h.autoCompleteInformedUser.selectedItems=c);g.length>0?m.displayNotification({msg:f.team.memberAlreadyAdded,eventID:"info"}):0==d.length&&0==p.length&&m.displayNotification({msg:f.team.error.notSupportedObjects,eventID:"warning"})}}})},function(e){return Promise.reject(e)}),o.length>0&&require(["DS/IssueComponents/team/MembersDataGridLayout"],function(e){for(var s=0;s<o.length;s++){var n=o[s],i=r[s];if("Coowner"===t){var a=h.modelForCoowner.getAllDescendants(),l=e.membersDataGridModel.coowners.getChildren()?e.membersDataGridModel.coowners.getChildren():[],c=e.membersDataGridModel.owner.getChildren()?e.membersDataGridModel.owner.getChildren():[],d=h.autoCompleteCoowner.selectedItems,p=a.filter(e=>e.options.identifier===n),g=[];(T=h.autoCompleteCoowner.selectedItems)&&T.length>0&&(g=T.filter(e=>e.options.identifier===n));var v=l.filter(e=>e.options.grid.user===n),b=c.filter(e=>e.options.grid.user===n);if(0==p.length&&0==v.length&&0==g.length&&0==b.length){if("pno:person"===i.objectType.toLowerCase()){h.modelForCoowner.prepareUpdate();var C=i.displayName+" ("+o[s].toUpperCase()+")",y=new u({label:C,value:o[s],name:i.displayName,identifier:o[s],type:"person"});h.modelForCoowner.addRoot(y),p.push(y),d?(d=d.concat(y),h.autoCompleteCoowner.selectedItems=d):(d=[y],h.autoCompleteCoowner.selectedItems=d),h.modelForCoowner.pushUpdate()}}else 1==p.length&&(d=d.concat(p[0]),h.autoCompleteCoowner.selectedItems=d);v.length>0?m.displayNotification({msg:f.team.memberAlreadyAdded,eventID:"info"}):b.length>0?m.displayNotification({msg:f.replace(f.team.error.isOwner,{name:n}),eventID:"info"}):0==p.length&&0==g.length&&m.displayNotification({msg:f.team.error.notSupportedObjects,eventID:"warning"})}else if("Contributor"===t){a=h.modelForContributor.getAllDescendants();var I=e.membersDataGridModel.contributors.getChildren()?e.membersDataGridModel.contributors.getChildren():[];d=h.autoCompleteContributor.selectedItems,p=a.filter(e=>e.options.identifier===n),g=[];(T=h.autoCompleteContributor.selectedItems)&&T.length>0&&(g=T.filter(e=>e.options.identifier===n));v=I.filter(e=>e.options.grid.user===n);if(0==p.length&&0==v.length&&0==g.length){if("pno:person"===i.objectType.toLowerCase()){h.modelForContributor.prepareUpdate();C=i.displayName+" ("+o[s].toUpperCase()+")";var E=new u({label:C,value:o[s],name:i.displayName,identifier:o[s],type:"person"});h.modelForContributor.addRoot(E),p.push(E),d?(d=d.concat(E),h.autoCompleteContributor.selectedItems=d):(d=[E],h.autoCompleteContributor.selectedItems=d),h.modelForContributor.pushUpdate()}}else 1==p.length&&(d=d.concat(p[0]),h.autoCompleteContributor.selectedItems=d);v.length>0?m.displayNotification({msg:f.team.memberAlreadyAdded,eventID:"info"}):0==p.length&&0==g.length&&m.displayNotification({msg:f.team.error.notSupportedObjects,eventID:"warning"})}else if("Assignee"===t){a=h.modelForAssignee.getAllDescendants();var S=e.membersDataGridModel.assignees.getChildren()?e.membersDataGridModel.assignees.getChildren():[];d=h.autoCompleteAssignee.selectedItems,p=a.filter(e=>e.options.identifier===n),g=[];(T=h.autoCompleteAssignee.selectedItems)&&T.length>0&&(g=T.filter(e=>e.options.identifier===n));v=S.filter(e=>e.options.grid.user===n);if(0==p.length&&0==v.length&&0==g.length){if("pno:person"===i.objectType.toLowerCase()){h.modelForAssignee.prepareUpdate();C=i.displayName+" ("+o[s].toUpperCase()+")";var w=new u({label:C,value:o[s],name:i.displayName,identifier:o[s],type:"person"});h.modelForAssignee.addRoot(w),p.push(w),d?(d=d.concat(w),h.autoCompleteAssignee.selectedItems=d):(d=[w],h.autoCompleteAssignee.selectedItems=d),h.modelForAssignee.pushUpdate()}}else 1==p.length&&(d=d.concat(p[0]),h.autoCompleteAssignee.selectedItems=d);v.length>0?m.displayNotification({msg:f.team.memberAlreadyAdded,eventID:"info"}):0==p.length&&0==g.length&&m.displayNotification({msg:f.team.error.notSupportedObjects,eventID:"warning"})}else if("InformedUser"===t){a=h.modelForInformedUser.getAllDescendants();var T,D=e.membersDataGridModel.informedUsers.getChildren()?e.membersDataGridModel.informedUsers.getChildren():[];d=h.autoCompleteInformedUser.selectedItems,p=a.filter(e=>e.options.identifier===n),g=[];(T=h.autoCompleteInformedUser.selectedItems)&&T.length>0&&(g=T.filter(e=>e.options.identifier===n));v=D.filter(e=>e.options.grid.user===n);if(0==p.length&&0==v.length&&0==g.length){if("pno:person"===i.objectType.toLowerCase()){h.modelForInformedUser.prepareUpdate();C=i.displayName+" ("+o[s].toUpperCase()+")";var A=new u({label:C,value:o[s],name:i.displayName,identifier:o[s],type:"person"});h.modelForInformedUser.addRoot(A),p.push(A),d?(d=d.concat(A),h.autoCompleteInformedUser.selectedItems=d):(d=[A],h.autoCompleteInformedUser.selectedItems=d),h.modelForInformedUser.pushUpdate()}}else 1==p.length&&(d=d.concat(p[0]),h.autoCompleteInformedUser.selectedItems=d);v.length>0?m.displayNotification({msg:f.team.memberAlreadyAdded,eventID:"info"}):0==p.length&&0==g.length&&m.displayNotification({msg:f.team.error.notSupportedObjects,eventID:"warning"})}}}),l.length>0&&require(["DS/IssueComponents/team/MembersDataGridLayout"],function(e){for(var s=0;s<l.length;s++){var n=l[s],i=l[s].objectId;if("Assignee"===t){var o=h.modelForAssignee.getAllDescendants(),a=e.membersDataGridModel.assignees.getChildren()?e.membersDataGridModel.assignees.getChildren():[],r=h.autoCompleteAssignee.selectedItems,c=o.filter(e=>e.options.identifier===i),d=[];(v=h.autoCompleteAssignee.selectedItems)&&v.length>0&&(d=v.filter(e=>e.options.identifier===i));var p=a.filter(e=>e.options.grid.user===i);if(0==c.length&&0==p.length&&0==d.length){h.modelForAssignee.prepareUpdate();var g=new u({label:n.displayName,value:n.displayName,name:n.displayName,identifier:i,type:"group"});h.modelForAssignee.addRoot(g),c.push(g),r?(r=r.concat(g),h.autoCompleteAssignee.selectedItems=r):(r=[g],h.autoCompleteAssignee.selectedItems=r),h.modelForAssignee.pushUpdate()}else 1==c.length&&(r=r.concat(c[0]),h.autoCompleteAssignee.selectedItems=r);p.length>0?m.displayNotification({msg:f.team.memberAlreadyAdded,eventID:"info"}):0==c.length&&0==d.length&&m.displayNotification({msg:f.team.error.notSupportedObjects,eventID:"warning"})}else if("InformedUser"===t){o=h.modelForInformedUser.getAllDescendants();var v,b=e.membersDataGridModel.informedUsers.getChildren()?e.membersDataGridModel.informedUsers.getChildren():[];r=h.autoCompleteInformedUser.selectedItems,c=o.filter(e=>e.options.identifier===i),d=[];(v=h.autoCompleteInformedUser.selectedItems)&&v.length>0&&(d=v.filter(e=>e.options.identifier===i));p=b.filter(e=>e.options.grid.user===i);if(0==c.length&&0==p.length&&0==d.length){h.modelForInformedUser.prepareUpdate();var C=new u({label:n.displayName,value:n.displayName,name:n.displayName,identifier:i,type:"group"});h.modelForInformedUser.addRoot(C),c.push(C),r?(r=r.concat(C),h.autoCompleteInformedUser.selectedItems=r):(r=[C],h.autoCompleteInformedUser.selectedItems=r),h.modelForInformedUser.pushUpdate()}else 1==c.length&&(r=r.concat(c[0]),h.autoCompleteInformedUser.selectedItems=r);p.length>0?m.displayNotification({msg:f.team.memberAlreadyAdded,eventID:"info"}):0==c.length&&0==d.length&&m.displayNotification({msg:f.team.error.notSupportedObjects,eventID:"warning"})}}}),0==n.length&&0==o.length&&0==l.length&&m.displayNotification({msg:f.team.error.dropNotSupported,eventID:"error"})}}}};return h}),define("DS/IssueComponents/helper/TemplateHelper",["UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Scroller","DS/UIKIT/Toggler","DS/ENOFloatingPanel/ENOFloatingPanel","DS/IssueComponents/utils/Utils","DS/WebappsUtils/WebappsUtils","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r){"use strict";var l="Private",c="Public",d="minimized";return{name:"DS/IssueComponents/helper/Helper",show:function(t){var n=this;if(n.modal)return null;var o=e.createElement("div",{class:"helper-dialog-body",html:n.getDialogBody()}),a=new i({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!1,resizable:!0,visible:!0,persistId:"ISUHelper",className:"helper-dialog",title:r.helper.dialog.title,header:null,body:o,events:{onClose:function(){a.destroy(),n.modal=null,n.views=null}}}).inject(t),l=e.createElement("span",{class:"right-actions minimize fonticon fonticon-minus"}),c=a.rightButtons.querySelector(".fonticon-cancel");a.rightButtons.insertBefore(l,c),l.addEventListener("click",function(){n.minimize()}),n.views.minimize={},n.views.minimize.icon=l,a.addEvent("onResizeFloating",function(){"44px"!==a.elements.container.getStyle("height")&&n.views.minimize.icon.hasClassName(d)&&n.views.minimize.icon.removeClassName(d)});var u=new s({element:n.views.contentsBody});return a.show(),n.modal=a,u},getBody:function(){for(var t=e.createElement("div",{class:"tooltip-header-body"}),s=[],n=[l,c],i=0;i<n.length;i++){var o="";i===n.length-1&&(o="th-last-row"),s.push(this.getStateHelper(n[i],o))}var a=e.createElement("table");return a.setContent(s),t.setContent(a),t},getStateHelper:function(t,s){var n=[e.createElement("th",{class:"th-title "+s,html:e.createElement("span",{class:"state-title",html:e.createElement("span",{class:"state-content",html:r[t.toLowerCase()]}),styles:{"background-color":o.getColorByState(t)}})}),e.createElement("th",{class:"th-description "+s,html:e.createElement("span",{class:"state-description",html:r.templateHelper[t.toLowerCase()]})})];return e.createElement("tr",{class:"helper-state",html:n})},getDialogBody:function(){var t=this,s=e.createElement("nav",{class:"tab",html:[e.createElement("li",{class:"tab-item active",id:"state",html:[e.createElement("span",{class:"fonticon fonticon-issue-type "}),r.helper.dialog.tabStates]}),e.createElement("li",{class:"tab-item",id:"shortcut",html:[e.createElement("span",{class:"fonticon fonticon-keyboard"}),r.helper.dialog.tabShortcuts]})]}),i=new n({container:s,events:{onToggle:function(e){"id"in e&&(Object.keys(t.views.contents).forEach(function(e){t.views.contents[e].hide()}),t.views.contents[e.id].show())}}});t.views={},t.views.contents={},t.views.contents.state=t.state(),t.views.contents.shortcut=t.shortcut(),t.views.contents.shortcut.hide();var o=e.createElement("div",{class:"helper-content-main",html:[t.views.contents.state,t.views.contents.shortcut]});return t.views.contentsBody=o,[i,o]},createNodes:function(e,t,s){for(var n=Object.keys(this.lifecycle),i=1,o=0;o<n.length;o++){var a={},r=s.indexOf(this.lifecycle[n[o]].organisation),l=0;l=0!==r?t+r+2*r:t,a.cell=this.createNode(this.lifecycle[n[o]],l,i),a.index={r:l,c:i},a.state=this.lifecycle[n[o]],this.nodes.push(a),i+=3}},state:function(){var t=e.createElement("div",{class:"helper-content helper-content-state"}),s=e.createElement("div",{class:"helper-content-header-container",html:e.createElement("div",{class:"helper-content-header-title",html:r.helper.dialog.tabStates})}),n=e.createElement("div",{class:"helper-content-body-container"}),i=function(t,s){var n=[e.createElement("th",{class:"th-title "+s,html:e.createElement("span",{class:"state-title",html:e.createElement("span",{class:"state-content",html:r[t.toLowerCase()]}),styles:{"background-color":o.getColorByState(t)}})}),e.createElement("th",{class:s,html:e.createElement("span",{class:"th-description",html:r["templateHelper_"+t.toLowerCase()]})})];return e.createElement("tr",{class:"helper-state",html:n})};t.addContent(s),t.addContent(n);for(var a=[],d=[l,c],u=0;u<d.length;u++){var m="";u===d.length-1&&(m="th-last-row"),a.push(i(d[u],m))}var p=e.createElement("table");return p.setContent(a),n.addContent(p),t},shortcut:function(){var t=e.createElement("div",{class:"helper-content"}),s=function(t,s,n){var i=[e.createElement("th",{class:"th-helper-dialog-key "+n,html:e.createElement("span",{class:"default-helper-title key-shortcut-key",html:e.createElement("span",{class:"default-helper-content ",html:null!=r.helper.dialog.shortcut.key[s][t]||null!=r.helper.dialog.shortcut.key[s][t]?r.helper.dialog.shortcut.key[s][t]:""})})}),e.createElement("th",{class:n,html:e.createElement("span",{class:"th-helper-dialog-description",html:null!=r.helper.dialog.shortcut.detail[s][t]||null!=r.helper.dialog.shortcut.detail[s][t]?r.helper.dialog.shortcut.detail[s][t]:""})})];return e.createElement("tr",{class:"helper-state",html:i})},n=function(t,n,i,o){var a=e.createElement("div",{class:"helper-content-header-container",html:e.createElement("div",{class:"helper-content-header-title",html:n})}),r=e.createElement("div",{class:"helper-content-body-container default-content-body-container"});t.addContent(a),t.addContent(r);for(var l=[],c=0;c<i.length;c++){var d="";c===i.length-1&&(d="th-last-row"),l.push(s(i[c],o,d))}var u=e.createElement("table");u.setContent(l),r.addContent(u)};return n(t,r.helper.dialog.subtitleShortcuts,["arrowUp","arrowDown","arrowLeft","arrowRight","shiftArrow","ctrlA","ctrlC","ctrlEnter"],"shortcut"),n(t,r.helper.dialog.subtitleMouseOperation,["ctrlClick","shiftClick"],"mouse"),t},minimize:function(){this.views.minimize.icon.hasClassName(d)?(this.views.minimize.icon.removeClassName(d),this.modal.elements.container.setStyle("height",this.views.minimize.height)):(this.views.minimize.icon.addClassName(d),this.views.minimize.height=this.modal.elements.container.getStyle("height"),this.modal.elements.container.setStyle("height","44px"))}}}),define("DS/IssueComponents/templates/TemplateDelete",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/Controls/ProgressBar","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f,h,g,v){"use strict";var b="PRIVATE";return t.extend({name:"DS/IssueComponents/templates/TemplateDelete",tag:"div",className:"Templatedelete-view",_logger:null,defaultOptions:{physicalIds:[]},physicalIds:[],issues:{},titles:[],names:[],indelible:[],modal:null,validate:null,isLoaded:null,_deferred:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s._logger=l.getLogger("DS/IssueComponents/components"),s._logger.log("Initializing the delete component"),s.templates={},s.titles=[],s.names=[],s.indelible=[],s.validate=null,s.modal=null,s.isLoaded=null,s._deferred={resolve:null,reject:null},s.currentUser=m.getUserName(),s.isLoaded=new e(function(e,t){s._deferred.resolve=e,s._deferred.reject=t})},render:function(){return f.start(this.name+" render"),this.dialog(),f.end(this.name+" render"),this},destroy:function(){f.start(this.name+" destroy"),this.physicalIds=[],this.templates={},this.titles=[],this.names=[],this.indelible=[],this.validate=null,this.modal.destroy(),this.modal=null,this.isLoaded=null,this._deferred={resolve:null,reject:null},f.end(this.name+" destroy")},dialog:function(){var e=this,t=u.get("widget")||window.widget,s=u.get("templateComponentDialog")?u.get("templateComponentDialog"):u.get("templateComponent");i.mask(e.container),e.modal=new r({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"delete-templates-dialog",title:v.delete.preparing,header:null,body:e.container,footer:[e.validate=new n({value:v.delete.delete,className:"primary",events:{onClick:function(){e.container.getChildren()[0].addClassName("disableContent"),e.modal.elements.footer.addClassName("disableContent"),e.buildProgressBar().inject(e.container),e.removeTemplates(e.physicalIds).then(function(){var t="",n=[];g.getRecentlyUsedTemplates().then(function(t){""!==t.body&&(n=t.body),n.length>0&&(n=n.filter(t=>!e.physicalIds.includes(t.physicalId)),g.setRecentlyUsedTemplates(n).catch(function(t){e._logger.error("Could not save the preferences: %o",t)}))}).finally(function(){t=1===e.physicalIds.length?v.replace(v.singleDeleteSuccess,{title:e.titles[e.titles.length-1]}):v.replace(v.multipleDeleteSuccess,{number:e.physicalIds.length}),s&&s.document.removeRootsById(e.physicalIds),e.destroy(),c.displayNotification({msg:t,eventID:"success"})})}).catch(function(t){e.destroy(),c.displayNotification({msg:v.templates.errors.remove,eventID:"error"})})}},disabled:!0}),new n({value:v.delete.cancel,events:{onClick:function(){e.destroy()}}})],events:{onClose:function(){e.destroy()}}}).inject(t.body),e.build().inject(e.container),e.physicalIds.length>0?(e.validate.enable(),e.modal.setTitle(v.replace(v.templateDeleteTitle,{number:e.physicalIds.length})),0===e.indelible.length&&(e.container.getElement(".no-delete-templates-label").addClassName("hidden"),e.container.getElement(".no-delete-templates-content").addClassName("hidden"))):(e.validate.disable(),e.modal.setTitle(v.templateNothingToDel),e.container.getElement(".delete-templates-label").addClassName("hidden"),e.container.getElement(".delete-templates-content").addClassName("hidden")),e.validate.focus(),i.unmask(e.container),new o({element:e.container}).inject(e.modal.getBody())},buildProgressBar:function(){return new a({shape:"circular",infiniteFlag:!0})},build:function(){f.start(this.name+" build");for(var e=this._check(this.getOption("selectedNodes")),t=e.deletable,n=e.indelible,i={physicalIds:[],titles:[],icons:[]},o=0;o<t.length;o++)i.physicalIds.push(t[o].physicalId),i.titles.push(t[o].title+" ("+t[o].name+")"),i.icons.push({tag:"span",class:"fonticon fonticon-issue-type "+t[o].state.toLowerCase()});var a=[];i.titles.forEach(function(e,t){a.push(s.createElement("li",{html:[i.icons[t],s.String.escapeHTML(e)],title:e}))});for(var r={physicalIds:[],titles:[],icons:[]},l=0;l<n.length;l++)r.physicalIds.push(n[l].physicalId),r.titles.push(n[l].title+" ("+n[l].name+")"),r.icons.push({tag:"span",class:"fonticon fonticon-issue-type "});var c=[];r.titles.forEach(function(e,t){c.push(s.createElement("li",{html:[r.icons[t],s.String.escapeHTML(e)],title:e}))}),this.physicalIds=i.physicalIds,this.titles=i.titles,this.indelible=r.physicalIds;var d=u.get("templateMaturityGraph");return f.end(this.name+" build"),s.createElement("div",{html:[{tag:"div",class:"delete-templates-label",html:[{tag:"span",class:"delete-templates-label-first",html:v.delete.warning},{tag:"span",class:"delete-templates-label-second",html:v.templates.confirmDelete.text}]},{tag:"div",class:"delete-templates-content",html:s.createElement("ul",{html:a,class:"delete-templates-content-list"})},{tag:"div",class:"no-delete-templates-label",html:v.replace(v.templateIndelible,{state:d[b]?d[b]:"Public"})},{tag:"div",class:"no-delete-templates-content",html:s.createElement("ul",{html:c,class:"no-delete-templates-content-list"})}]})},_check:function(e){f.start(this.name+" _check");for(var t={deletable:[],indelible:[]},s=0;s<e.length;s++){var n=e[s].options;!0===this.utils.isPrivate(n)&&1==this.utils.isOwned(n,this.currentUser)?t.deletable.push({physicalId:n.physicalId,name:n.name,state:n.state,title:n.title?n.title:""}):t.indelible.push({physicalId:n.physicalId,name:n.name,state:n.state,title:n.title?n.title:""})}return t},removeTemplates:function(e){return p.issues.delete({data:{objects:e.map(function(e){return{physicalId:e}})}}).then(function(e){})},utils:{isPrivate:function(e){return e.state===b},isOwned:function(e,t){return e.owner.user===t}}})}),define("DS/IssueComponents/create/Properties",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Form","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Input/Date","DS/UIKIT/Input/Text","DS/CKEditor/CKEditor","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/WebappsUtils/WebappsUtils","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Parser","DS/IssueServices/utils/Performance","DS/WUXAutoComplete/AutoComplete","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/IssueComponents/create/Classification","i18n!DS/IssueComponents/assets/nls/IssueComponents","text!DS/IssueCommon/assets/Settings.json","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f,h,g,v,b,C,y,I,E,S,w,T){"use strict";return t.extend({})}),define("DS/IssueComponents/create/Team",["UWA/Class/View","UWA/Class/Promise","UWA/Core","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/SearchWidget/SearchWidgetConstant","DS/UIKIT/Form","DS/UIKIT/Input/Select","DS/UIKIT/Input/Toggle","DS/UIKIT/Tooltip","DS/Controls/TooltipModel","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/search/PeopleSearch","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f,h,g,v,b,C){"use strict";var y="_PRJ",I={OWNER:"owner",CO_OWNERS:"coOwners",ASSIGNEES:"assignees",CONTRIBUTORS:"contributors",INFORMEDUSERS:"informedUsers"};return e.extend({name:"DS/IssueComponents/create/Team",tag:"div",className:"create-view-content-subview create-team",isInit:null,_deferredInit:{resolve:null,reject:null},setup:function(e){var s=this;s._parent(e),s.parent=e.parent,s.isInit=new t(function(e,t){s._deferredInit.resolve=e,s._deferredInit.reject=t}),s.form=null,s.formElements={owner:null,coOwners:null,assigness:null,contributors:null,informedUsers:null},s.formElementsToggler={owner:null,coOwners:null,assigness:null,contributors:null,informedUsers:null},s.fields={assignToMe:null,addOwner:null,addCoOwners:null,addAssignees:null,addReviewers:null,addContributors:null,addInformedUsers:null},s.values={owner:{},coOwners:{},assignees:{},contributors:{},informedUsers:{}},s.listenTo(s.parent,"related-add-reportedAgainst",function(e){let t={user:e.data.owner,fullName:e.data.responsible};s._addUser(t,"assignees")}),h.organizations.getCompanies({onComplete:function(e){s.organizations=e.body},onFailure:function(){s.organizations=[]}}).finally(function(){s._deferredInit.resolve()})},destroy:function(){this.form=null,this.formElements={coOwners:null,assigness:null,contributors:null},this.formElementsToggler={coOwners:null,assigness:null,contributors:null},this.fields={assignToMe:null},this.values={coOwners:{},assignees:{},contributors:{}}},render:function(){var e=this;return e.form=new r({className:"create-team-form",fields:[],events:{onInvalid:function(){}}}).inject(e.container),s.createElement("div",{class:"create-form-content",html:[e.formElements.owner=s.createElement("div",{class:"create-form-element create-team-form-element-owner",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.owner=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[s.createElement("div",{class:"create-form-element-title",html:[{tag:"h5",html:C.create.team.labels.owner}]}),{tag:"div",class:"issue-owner-search-container",html:[s.createElement("div",{class:"form-group-owner",html:e.fields.addOwner=e._peopleSearch(I.OWNER)}),e.fields.owner=s.createElement("div",{class:"form-group-owner-holder"}),e.fields.owner.ownerHelper=s.createElement("div",{html:[s.createElement("span",{class:"fonticon fonticon-help"})]})]}]},{tag:"div",class:"create-form-help-tooltip",html:[e.fields.owner.ownerHelper]}]}),e.formElements.coOwners=s.createElement("div",{class:"create-form-element create-team-form-element-coowners",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.coOwners=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[s.createElement("div",{class:"create-form-element-title",html:[{tag:"h5",html:C.create.team.labels.coOwners}]}),{tag:"div",class:"issue-coowners-search-container",html:[s.createElement("div",{class:"form-group-coowners",html:e.fields.addCoOwners=e._peopleSearch(I.CO_OWNERS)}),e.fields.coOwners=s.createElement("div",{class:"form-group-coowners-holder"}),e.fields.coOwners.coOwnersHelper=s.createElement("div",{html:[s.createElement("span",{class:"fonticon fonticon-help"})]})]}]},{tag:"div",class:"create-form-help-tooltip",html:[e.fields.coOwners.coOwnersHelper]}]}),e.formElements.assignees=s.createElement("div",{class:"create-form-element create-team-form-element-assignees",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.assignees=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[s.createElement("div",{class:"create-form-element-title",html:[{tag:"h5",html:C.create.team.labels.assignees},{tag:"span",class:"issue-assign-to-me",html:e.fields.assignToMe=new c({type:"checkbox",value:"assign-me",label:C.create.team.labels.assignToMe,checked:!1,className:"primary",events:{onChange:function(){this.isChecked()?e._addUser({user:g.getUserName(),fullName:g.getFullName(),position:0},I.ASSIGNEES):e._removeUser({user:g.getUserName(),fullName:g.getFullName()},I.ASSIGNEES)}}})}]}),{tag:"div",class:"issue-assignees-search-container",html:[s.createElement("div",{class:"form-group-assignees",html:e.fields.addAssignees=e._peopleSearch(I.ASSIGNEES)}),e.fields.assignees=s.createElement("div",{class:"form-group-assignees-holder"}),e.fields.assignees.assigneesHelper=s.createElement("div",{html:[s.createElement("span",{class:"fonticon fonticon-help"})]})]}]},{tag:"div",class:"create-form-help-tooltip",html:[e.fields.assignees.assigneesHelper]}]}),e.formElements.contributors=s.createElement("div",{class:"create-form-element create-team-form-element-contributors",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.contributors=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[s.createElement("div",{class:"create-form-element-title",html:[{tag:"h5",html:C.create.team.labels.contributors}]}),{tag:"div",class:"issue-contributors-search-container",html:[s.createElement("div",{class:"form-group-contributors",html:e.fields.addContributors=e._peopleSearch(I.CONTRIBUTORS)}),e.fields.contributors=s.createElement("div",{class:"form-group-contributors-holder"}),e.fields.contributors.contributorHelper=s.createElement("div",{html:[s.createElement("span",{class:"fonticon fonticon-help"})]})]}]},{tag:"div",class:"create-form-help-tooltip",html:[e.fields.contributors.contributorHelper]}]}),e.formElements.informedUsers=s.createElement("div",{class:"create-form-element create-team-form-element-informedUsers",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.informedUsers=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[s.createElement("div",{class:"create-form-element-title",html:[{tag:"h5",html:C.create.team.labels.informedUsers}]}),{tag:"div",class:"issue-informedUsers-search-container",html:[s.createElement("div",{class:"form-group-informedUsers",html:e.fields.addInformedUsers=e._peopleSearch(I.INFORMEDUSERS)}),e.fields.informedUsers=s.createElement("div",{class:"form-group-informedUsers-holder"}),e.fields.informedUsers.informedUserHelper=s.createElement("div",{html:[s.createElement("span",{class:"fonticon fonticon-help"})]})]}]},{tag:"div",class:"create-form-help-tooltip",html:[e.fields.informedUsers.informedUserHelper]}]})]}).inject(e.form.elements.container),e.fields.owner.ownerHelper.tooltipInfos=new u({shortHelp:C.create.team.labels.ownerHelper}),e.fields.coOwners.coOwnersHelper.tooltipInfos=new u({shortHelp:C.create.team.labels.coOwnersHelper}),e.fields.assignees.assigneesHelper.tooltipInfos=new u({shortHelp:C.create.team.labels.assigneesHelper}),e.fields.contributors.contributorHelper.tooltipInfos=new u({shortHelp:C.create.team.labels.contributorHelper}),e.fields.informedUsers.informedUserHelper.tooltipInfos=new u({shortHelp:C.create.team.labels.informedUserHelper}),e.reset().then(e._deferredInit.resolve),e},getValues:function(){return{owner:{user:Object.keys(this.values.owner)[0]},coOwners:Object.keys(this.values.coOwners).map(function(e){return{user:e}}),assignees:Object.values(this.values.assignees).map(function(e){return{user:e.user,type:e.type}}),contributors:Object.keys(this.values.contributors).map(function(e){return{user:e}}),informedUsers:Object.values(this.values.informedUsers).map(function(e){return{user:e.user,type:e.type}})}},getUIValues:function(){return{owner:this.values.owner,coOwners:this.values.coOwners,assignees:this.values.assignees,contributors:this.values.contributors,informedUsers:this.values.informedUsers}},getHiddenAttributes:function(){var e={};for(var t in this.formElements)s.is(this.formElementsToggler[t])&&(e[t]=this.formElementsToggler[t].hasClassName("fonticon-eye-off"));return e},applyTemplate:function(e){var n=this;return n.reset().then(function(){if(s.is(e.ui)&&(s.is(e.ui.owner,"object")&&n._addUser({user:g.getUserName(),fullName:g.getFullName(),position:0},I.OWNER),s.is(e.ui.coOwners,"object")&&Object.keys(e.ui.coOwners).forEach(function(t){n._addUser(e.ui.coOwners[t],I.CO_OWNERS)}),s.is(e.ui.assignees,"object")&&Object.keys(e.ui.assignees).forEach(function(t){n._addUser(e.ui.assignees[t],I.ASSIGNEES)}),s.is(e.ui.contributors,"object")&&Object.keys(e.ui.contributors).forEach(function(t){n._addUser(e.ui.contributors[t],I.CONTRIBUTORS)}),s.is(e.ui.informedUsers,"object")&&Object.keys(e.ui.informedUsers).forEach(function(t){n._addUser(e.ui.informedUsers[t],I.INFORMEDUSERS)})),s.is(e.hidden,"object")&&s.is(n.formElements,"object")&&s.is(n.formElementsToggler,"object")){var i=n.formElements,o=n.formElementsToggler;for(var a in i)!0===e.hidden[a]&&(n.parent.isTemplate?(s.is(i[a])&&i[a].toggleClassName("visibility-masked",!0),s.is(o[a])&&(o[a].toggleClassName("fonticon-eye-off",!0),o[a].toggleClassName("fonticon-eye",!1))):s.is(i[a])&&i[a].hide())}return t.resolve()})},reset:function(){var e=this;return new t(function(t){Object.keys(e.values.owner).forEach(function(t){e._removeUser(e.values.owner[t],I.OWNER)}),e._addUser({user:g.getUserName(),fullName:g.getFullName()},I.OWNER),Object.keys(e.values.coOwners).forEach(function(t){e._removeUser(e.values.coOwners[t],I.CO_OWNERS)}),Object.keys(e.values.assignees).forEach(function(t){e._removeUser(e.values.assignees[t],I.ASSIGNEES)}),Object.keys(e.values.contributors).forEach(function(t){e._removeUser(e.values.contributors[t],I.CONTRIBUTORS)}),Object.keys(e.values.informedUsers).forEach(function(t){e._removeUser(e.values.informedUsers[t],I.INFORMEDUSERS)}),t()})},_peopleSearch:function(e){var t=this,s="";e!==I.ASSIGNEES&&e!==I.INFORMEDUSERS||(s=a.EXTTYPE_USERGRP);var n=new f({className:"searchPeople_TransferOwnership",MaxNumber:"5",MaxSize:"300",position:"auto",showEmptyCategory:!1,type:a.TYPE_PERSON,exttype:s,events:{onValid:function(){var s=n.getNewOwner().person,i=n.getNewOwner().userGrp;void 0!==s?t._addUser({user:s.personID.replace(y,""),fullName:s.personFullName,type:"person"},e):void 0!==i&&t._addUser({user:i.id,fullName:i.label,type:"group"},e),n.clearInput(),n.getContent().searchInput.focus()},onUnvalid:function(){},onError:function(){o.displayNotification({msg:C.team.error.notFound,eventID:"info"})},onValidUsers:function(s){Object.keys(s).map(function(e){return s[e]}).forEach(function(s){var n={};n.user=s.name,n.fullName=s.firstname+" "+s.lastname,t._addUser(n,e)}),n.clearInput(),n.getContent().searchInput.focus()}}});return n.setSelectedItemList([{objectID:t.organizations[0].physicalId}]),n},_addUser:function(e,t){var n=this;if(t===I.OWNER&&(Object.keys(n.values.owner).forEach(function(e){n._removeUser(n.values.owner[e],I.OWNER)}),n.values.coOwners.hasOwnProperty(e.user)&&n._removeUser(n.values.coOwners[e.user],I.CO_OWNERS)),t===I.CO_OWNERS&&n.values.owner.hasOwnProperty(e.user))o.displayNotification({msg:C.create.team.cannotAddOwnerAsCoOwner,eventID:"error"});else if(n.values[t][e.user])o.displayNotification({msg:C.replace(C.create.team.alreadyAssigned,{name:e.fullName}),eventID:"info"});else{var i=n._createUserHTML(e,t);if(t!==I.OWNER){var a=s.createElement("span",{class:"team-content-user-remove wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove"}).inject(i),r=new d({position:"left",target:a,body:C.create.team.removeAssignee,animate:!1});a.addEventListener("click",function(){n._removeUser(e,t),r.destroy()})}n._isInteger(e.position)?n.fields[t].insertBefore(i,n.fields[t].children[e.position]):n.fields[t].appendChild(i),t!==I.ASSIGNEES||e.user!==g.getUserName()||n.fields.assignToMe.isChecked()||n.fields.assignToMe.check(),e.element=i,n.values[t][e.user]=e}},_removeUser:function(e,t){this.values[t][e.user]&&(t===I.ASSIGNEES&&e.user===g.getUserName()&&!0===this.fields.assignToMe.isChecked()&&this.fields.assignToMe.uncheck(),this.values[t][e.user].element.destroy(),delete this.values[t][e.user])},_createUserHTML:function(e,t){var n=s.createElement("div",{id:t+"-"+p.getTextFromHTML(e.user),class:"team-content-user-container"});("group"===e.type?s.createElement("span",{class:"team-content-user-group wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-users-group",title:e.fullName}):g.getUserImageElement(e,!0,{cssClass:"team-content-user-img",Title:p.getTextFromHTML(e.fullName+" ("+e.user+")")})).inject(n);var i=s.createElement("div",{class:"team-content-user-info"}).inject(n);return"group"===e.type?s.createElement("span",{class:"team-content-user-group-label",html:p.getTextFromHTML(e.fullName)}).inject(i):(s.createElement("span",{class:"team-content-user-full-name",html:p.getTextFromHTML(e.fullName)}).inject(i),s.createElement("span",{class:"team-content-user-id",html:p.getTextFromHTML(e.user)}).inject(i)),n},_isInteger:function(e){return Number.isInteger?Number.isInteger(e):"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}})}),define("DS/IssueComponents/templates/footer/TemplateStatus",["UWA/Class/View","UWA/Core","DS/UIKIT/Tooltip","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Controls/Loader","DS/IssueComponents/helper/TemplateHelper","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,s,n,i,o,a,r,l){"use strict";var c="Issue",d=1e3;return e.extend({name:"DS/IssueManagement/components/footer/Status",tagName:"div",className:"status-container",_logger:null,isVisible:!0,_pin:null,setup:function(e){r.start(this.name+" setup"),this._parent(e),this.isVisible=!0,this.loading.init(),r.end(this.name+" setup")},render:function(){return r.start(this.name+" render"),this.helper().inject(this.container),this.info().inject(this.container),this.loading.container.inject(this.container),r.end(this.name+" render"),this},refresh:function(){this.destroy(),this.render()},destroy:function(){this.container.empty()},loading:{container:t.createElement("div",{class:"im-status-loader"}),clickCallback:null,isVisible:!1,_loader:new i({text:"Loading...",fadeDuration:500,showButtonFlag:!1}),init:function(){this._loader.inject(this.container)},start:function(e){this._loader.height=18,this._loader._loaderCounter=0,this._loader.elements.progressBar.infiniteFlag=!0,this._loader.elements.progressBar._applyInfiniteFlag(),t.is(e,"object")&&this.container.toggleClassName("is-clickable",e.isClickable),this._loader.on(),this.isVisible=!0},update:function(e){this._loader.text=e},stop:function(e){this._loader.text=e,this._loader._loaderCounter=0,this._loader.elements.progressBar.infiniteFlag=!1,this._loader.elements.progressBar.value=100,this._loader.elements.progressBar._applyInfiniteFlag()},hide:function(e){var s=this;s.isVisible&&(s._loader.text=e,setTimeout(function(){new t.Fx(s._loader.elements.container,{duration:d,transition:"linear",events:{onStart:function(){},onComplete:function(){t.is(s._loader,"object")&&s._loader.off(),s.isVisible=!1}}}).start({opacity:[1,0]})},0),s.container.toggleClassName("is-clickable",!1))},setClickListener:function(e){t.is(this.clickCallback,"function")&&this.container.removeEventListener("click",this.clickCallback),this.clickCallback=e,this.container.addEventListener("click",this.clickCallback)}},helper:function(){var e=a.get("widget")||window.widget,n=t.createElement("span",{class:"issue-status-left-helper fonticon fonticon-help-circled"}),i=new s({className:"helper-tooltip",position:"top",target:n,body:l.templateHelper});return n.addEventListener("click",function(){i.hide(),o.show(e.body)}),n},info:function(){var e=this,n=t.createElement("span",{class:"issue-status-right fonticon fonticon-info"});return new s({className:"im-status-tooltip",trigger:"touch",target:n,events:{onShow:function(){r.start(e.name+" render status");a.get("component");for(var s=a.get("templateComponentDialog")?a.get("templateComponentDialog"):a.get("templateComponent"),n=s.document.getSelectedNodes(),i=s.document.getRoots(!1).length,o=0,d=0;d<n.length;d++)n[d].options.baseType===c&&(o+=1);var u=t.createElement("div",{class:"im-status-msg"});t.createElement("div",{class:"im-status-msg-issues",text:l.replace(l.templatesinfo,{number:i})}).inject(u),t.createElement("div",{class:"im-status-msg-selection",text:l.replace(l.selectedTemplates,{number:o})}).inject(u),this.setBody(u),r.end(e.name+" render status")}}}),n},utils:{}})}),define("DS/IssueComponents/create/Finalize",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Form","DS/UIKIT/Input/Text","DS/UIKIT/Input/Toggle","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/LineEditor","DS/Controls/Editor","DS/Controls/ComboBox","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/IssueComponents/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f,h,g,v,b,C,y,I){"use strict";var E="Analyst";return t.extend({name:"DS/IssueComponents/create/Finalize",tag:"div",className:"create-view-content-subview create-finalize",isInit:null,_deferredInit:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s.parent=t.parent,s.isInit=new e(function(e,t){s._deferredInit.resolve=e,s._deferredInit.reject=t}),s.form=null,s.formElements={enableApproval:null,saveAsTemplate:null,assignContentOwner:null},s.formElementsToggler={enableApproval:null,saveAsTemplate:null,assignContentOwner:null},s.fields={automation:{enableApproval:null,saveAsTemplate:null,assignContentOwner:null},saveAsTemplate:{name:null,description:null,securityContexts:null}},s._appliedTemplate=null,s._deferredInit.resolve()},destroy:function(){this.form=null,this.formElements={enableApproval:null,saveAsTemplate:null,assignContentOwner:null},this.formElementsToggler={enableApproval:null,saveAsTemplate:null,assignContentOwner:null},this.fields={automation:{enableApproval:null,saveAsTemplate:null,assignContentOwner:null},saveAsTemplate:{name:null,description:null}},this._appliedTemplate=null},render:function(){var e=this;v.get("widget")||window.widget;b.preferences.getApprovalEnablement({data:{}}).then(function(t){var n=t.body.ApprovalProcess;e.adminPreference=n,"Always"==n?(e.fields.automation.enableApproval.checkFlag=!0,e.fields.automation.enableApproval.disabled=!0):"Never"==n?(e.fields.automation.enableApproval.checkFlag=!1,e.fields.automation.enableApproval.disabled=!0):e._appliedTemplate?Array.isArray(e._appliedTemplate.data.automationTasks)&&(e._appliedTemplate.data.automationTasks.indexOf("enableApproval")>-1?(e.fields.automation.enableApproval.checkFlag=!0,e.fields.automation.enableApproval.disabled=!1):(e.fields.automation.enableApproval.checkFlag=!1,e.fields.automation.enableApproval.disabled=!1)):b.preferences.get({data:{name:"approvalPreference"}}).then(function(t){if(!e._appliedTemplate){var s=t.body;e.fields.automation.enableApproval.checkFlag=s,e.fields.automation.enableApproval.disabled=!1}}).catch(function(e){e&&s.is(e.error,"object")&&s.is(e.error.message,"string")&&PADAlert.displayNotification({msg:e.error.message,eventID:"error"})})}),e.form=new n({className:"create-finalize-form",fields:[],events:{onInvalid:function(){}}}).inject(e.container);var t=s.createElement("div",{class:"create-form-content",html:[e._renderContentField(),e._renderApprovalField(),e._renderTemplateField(),e._renderTemplateForm()]});return b.preferences.get({data:{name:"assignPreference"}}).then(function(t){if(!e._appliedTemplate){var s=t.body;e.fields.automation.assignContentOwner.checkFlag=s,localStorage.setItem("assignPreferenceTemplate",s)}}),new u({element:t}).inject(e.form.elements.container),e.parent.isTemplate&&(t.style.minHeight="251px"),e},_renderContentField:function(){var e=this,t=new r({type:"checkbox"}),n=e.fields.automation.assignContentOwner=new a({type:"checkbox",label:I.create.finalize.assignContentOwner,value:0});return n.addEventListener("buttonclick",function(t){t.dsModel.checkFlag?(localStorage.setItem("assignPreferenceTemplate",!0),b.preferences.set({data:{name:"assignPreference",value:!0}}).catch(function(t){e._logger.error("Could not save the preferences: %o",t)})):(localStorage.setItem("assignPreferenceTemplate",!1),b.preferences.set({data:{name:"assignPreference",value:!1}}).catch(function(t){e._logger.error("Could not save the preferences: %o",t)}))}),t.addChild(n),e.formElements.assignContentOwner=s.createElement("div",{class:"create-form-element",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.assignContentOwner=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field create-form-settings",html:[t]}]})},_renderApprovalField:function(){var e=this,t=new r({type:"checkbox"}),n=e.fields.automation.enableApproval=new a({type:"checkbox",label:I.create.finalize.enableApproval,value:1});return n.addEventListener("buttonclick",function(t){t.dsModel.checkFlag?b.preferences.set({data:{name:"approvalPreference",value:!0}}).catch(function(t){e._logger.error("Could not save the preferences: %o",t)}):b.preferences.set({data:{name:"approvalPreference",value:!1}}).catch(function(t){e._logger.error("Could not save the preferences: %o",t)})}),t.addChild(n),e.formElements.enableApproval=s.createElement("div",{class:"create-form-element",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.enableApproval=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field create-form-settings",html:[t]}]})},_renderTemplateField:function(){var e=new r({type:"checkbox"}),t=!1,n=!1;this.parent.isTemplate&&(t=!0,n=!0);var i=this.fields.automation.saveAsTemplate=new a({type:"checkbox",label:I.create.finalize.saveAsTemplateToggle,value:2,checkFlag:t,disabled:n});return i.addEventListener("change",function(e){e.dsModel.checkFlag?(document.querySelector(".create-expander-body-template").style.display="block",widget.getElement(".create-finalize-form .create-form-content").style.minHeight="251px"):(document.querySelector(".create-expander-body-template").style.display="none",widget.getElement(".create-finalize-form .create-form-content").style.minHeight="95px")}),e.addChild(i),this.formElements.saveAsTemplate=s.createElement("div",{class:"create-form-element",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[this.formElementsToggler.saveAsTemplate=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field create-form-settings",html:[e]}]})},_renderTemplateForm:function(){var e=this,t=v.get("widget")||window.widget;e.templateContainer=new s.Element("div",{class:"create-expander-body-template"}),e.templateContainer.style.display="none",e.parent.isTemplate&&(e.templateContainer.style.display="block");var n="required-form-field-title-label"+(e.isTemplate?"":" highlight"),i="required-form-field-required-label"+(e.isTemplate?"":" highlight");s.createElement("h5",{class:"required-form-field",html:[s.createElement("span",{class:n,html:I.create.templateName}),s.createElement("div",{class:i+" wux-ui-3ds-required wux-ui-3ds"})]}).inject(e.templateContainer);var o=e.fields.saveAsTemplate.name=new l({requiredFlag:!0});o.getContent().setStyle("width","100%"),e.fields.saveAsTemplate.name.addEventListener("keyup",function(){var t=e.fields.saveAsTemplate.name.valueToCommit;e._onTemplateNameChange(t)}),o.inject(e.templateContainer);var a=s.createElement("h5",{class:"create-form-field-label",html:I.create.properties.labels.credentials});a.inject(e.templateContainer),e.parent.options.editMode&&a.hide();let r=C.getSecurityContexts().cspaces;var d=e.fields.saveAsTemplate.securityContexts=e.createCredential({element:"securityContexts",rangeItems:r.map(e=>({labelItem:e.label,valueItem:e.value})),value:t.getPreference("pad_security_ctx")?t.getPreference("pad_security_ctx").value:r[0].value,enableSearchFlag:!1});d.getContent().setStyle("width","100%"),d.inject(e.templateContainer),s.createElement("h5",{class:"create-form-field-label",html:I.create.templateDesc}).inject(e.templateContainer);var u=e.fields.saveAsTemplate.description=new c({nbRows:4,newLineMode:"enter"});return u.getContent().setStyle("width","100%"),u.inject(e.templateContainer),e.templateContainer},createCredential:function(e){var t=e.rangeItems,s=function(){var e=new f;e.prepareUpdate();for(var s=0;s<t.length;s++){var n=t[s].labelItem,i=t[s].valueItem,o=new h({label:n,grid:{valueItem:i}});e.addRoot(o)}return e.pushUpdate(),e}();return new d({elementsTree:s,value:e.value,enableSearchFlag:1==e.enableSearchFlag})},validate:function(){return!0!==this.fields.automation.saveAsTemplate.checkFlag||""!==this.fields.saveAsTemplate.name.value},getTasks:function(){var e=this,t=[];return Object.keys(e.fields.automation).forEach(function(s){e.fields.automation[s].checkFlag&&!0===e.fields.automation[s].checkFlag&&t.push(s)}),t},getApprovalValue:function(){return this.fields.automation.enableApproval.checkFlag},getContentValue:function(){return this.fields.automation.assignContentOwner.checkFlag},getTemplateValue:function(){return this.fields.automation.saveAsTemplate.checkFlag},getValues:function(){var e={};return!0===this.getApprovalValue()&&(e.waitingOn=E),!0===this.getContentValue()&&(e.assignContentOwner=!0),!0===this.getTemplateValue()&&(e.saveAsTemplate=!0),e},getHiddenAttributes:function(){var e={};for(var t in this.formElements)s.is(this.formElementsToggler[t])&&(e[t]=this.formElementsToggler[t].hasClassName("fonticon-eye-off"));return e},getTemplateValues:function(){return{name:this.fields.saveAsTemplate.name.value,description:this.fields.saveAsTemplate.description.value,securityContexts:this.fields.saveAsTemplate.securityContexts.value}},applyTemplate:function(t){var n=this;return new e(function(e){if(n._appliedTemplate=t,Array.isArray(t.data.automationTasks)&&Object.keys(n.fields.automation).forEach(function(e){"saveAsTemplate"===e||-1===t.data.automationTasks.indexOf(e)?("saveAsTemplate"===e&&n.parent.isTemplate?n.fields.automation[e].checkFlag=!0:"assignContentOwner"===e?null!=t.applyIssue&&t.applyIssue||(n.fields.automation[e].checkFlag=!1,localStorage.setItem("assignPreferenceTemplate",!1)):"enableApproval"===e&&"UserChoice"==n.adminPreference&&(n.fields.automation[e].checkFlag=!1,n.fields.automation[e].disabled=!1),"assignContentOwner"===e&&localStorage.setItem("assignPreferenceTemplate",!1)):"saveAsTemplate"===e?n.fields.automation[e].checkFlag=!0:"assignContentOwner"===e?(n.fields.automation[e].checkFlag=!0,localStorage.setItem("assignPreferenceTemplate",!0)):"enableApproval"===e&&"UserChoice"==n.adminPreference&&(n.fields.automation[e].checkFlag=!0,n.fields.automation[e].disabled=!1)}),s.is(t.info,"object")&&(!0===s.is(t.info.name,"string")&&(n.fields.saveAsTemplate.name.value=t.info.name,n._onTemplateNameChange(t.info.name)),!0===s.is(t.info.description,"string")&&(n.fields.saveAsTemplate.description.value=t.info.description),!0===s.is(t.info.securityContexts,"string")&&(n.fields.saveAsTemplate.securityContexts.value=t.info.securityContexts)),n.parent.options.editMode&&n.fields.saveAsTemplate.securityContexts.hide(),s.is(t.hidden,"object")&&s.is(n.formElements,"object")&&s.is(n.formElementsToggler,"object")){var i=n.formElements,o=n.formElementsToggler;for(var a in i)!0===t.hidden[a]&&(n.parent.isTemplate?(s.is(i[a])&&i[a].toggleClassName("visibility-masked",!0),s.is(o[a])&&(o[a].toggleClassName("fonticon-eye-off",!0),o[a].toggleClassName("fonticon-eye",!1))):s.is(i[a])&&(i[a].hide(),"saveAsTemplate"===a&&n.templateContainer.hide()))}e()})},_onTemplateNameChange:function(e){"fields"in this&&"saveAsTemplate"in this.fields&&"name"in this.fields.saveAsTemplate&&this.parent&&this.parent.isTemplate&&this.parent.updateTitle(e)}})}),define("DS/IssueComponents/related/TreeListView",["UWA/Core","UWA/Class","UWA/Controls/Abstract","UWA/Class/Promise","DS/CoreEvents/Events","DS/Logger/Logger","DS/UIKIT/Iconbar","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/UIKIT/Tooltip","DS/Menu/Menu","DS/TreeModel/TreeDocument","DS/Tree/TreeListView","DS/LifecycleServices/LifecycleServicesSettings","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Parser","DS/IssueServices/utils/Performance","DS/IssueServices/utils/Views","DS/IssueComponents/models/TreeNodeModel","DS/IssueComponents/utils/Utils","DS/IssueCommon/utils/Utils","DS/ENOFloatingPanel/ENOFloatingPanel","DS/PADUtils/views/PADAlert","DS/PADUtils/PADUtilsServices","DS/PlatformAPI/PlatformAPI","DS/UIBehaviors/ContextualMenuManager","DS/WebappsUtils/WebappsUtils","DS/IssueCommon/utils/DocumentUtils","DS/IssueAttachmentManager/services/AttachmentServices","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f,h,g,v,b,C,y,I,E,S,w,T,D,A,_,O,N,R,M){"use strict";return s.extend({name:"DS/IssueComponents/related/TreeListView",_preventEvents:!1,_syncSort:!1,_logger:null})}),define("DS/IssueComponents/related/Related",["UWA/Class/View","UWA/Class/Promise","UWA/Core","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Iconbar","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","DS/IssueComponents/related/TreeListView","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","css!DS/IssueComponents/IssueComponents.css","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f,h,g,v){"use strict";return e.extend({name:"DS/IssueComponents/related/Related",tag:"div",className:"related-objects-view"})}),define("DS/IssueComponents/templates/model/TemplatesTreeDocument",["UWA/Core","UWA/Class/Promise","DS/Logger/Logger","DS/PlatformAPI/PlatformAPI","DS/TreeModel/TreeDocument","DS/TreeModel/BaseFilter","DS/CoreEvents/ModelEvents","DS/IssueComponents/templates/model/TemplatesTreeNodeModel","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueComponents/templates/TemplatesToolbar","DS/IssueServices/services/PlatformServices","DS/IssueCommon/utils/Utils","DS/IssueCommon/utils/ModelParser","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f,h){"use strict";var g=10,v=100,b="RELEASED",C="Issue Template Json Details",y=function(e,t,s){var n;return function(){var i=this,o=arguments,a=s&&!n;clearTimeout(n),n=setTimeout(function(){n=null,s||e.apply(i,o)},t),a&&e.apply(i,o)}},I=this;return i.extend({name:"DS/IssueComponents/templates/model/TemplatesTreeDocument",_logger:null,component:null,settings:{},_publishSelection:!1,_onNodeModelUpdateSubscriptionToken:"",init:function(t){I=this,this._logger=s.getLogger("DS/IssueComponets/Model"),this.component=t.component,t.list=e.merge(t.document||{},this.getEventOptions()),this._parent(),this._publishSelection=!1,this._subscribers(),this.initCustomFilter(),this.registerCustomFilter(),this.user=m.getUserName();var n={name:"templateModelEvents"};this.templateModelEvents=new a(n)},registerNodeModelUpdateEvent:function(){this._onNodeModelUpdateSubscriptionToken=this.onNodeModelUpdate(function(e){var t=e.data.nodeModel;if(t)e.data.attributes,t.options.physicalId})},undoRegisterNodeModelUpdateEvent:function(){this.unsubscribe(this._onNodeModelUpdateSubscriptionToken)},registerCustomFilter:function(){this.getFilterManager().registerFilter("stringRole",this.stringRoleFilter)},initCustomFilter:function(){I.filteredListOfNodes=[],this.stringRoleFilter=o.inherit({publishedProperties:{},isDataFiltered:function(e){var t=e.getAttributeValue(this.propertyId);return!(!this.filterModel||!this.filterModel.allowedRoles)&&!t.toLowerCase().includes(this.filterModel.allowedRoles.toLowerCase())},isEmpty:function(){return void 0===this.filterModel.allowedRoles}})},getEventOptions:function(){return{shouldAcceptDrag:function(){return!1},shouldAcceptDrop:function(){return!1}}},addRoots:function(e,s){var n=this;return 0===e.length?t.resolve([]):new t(function(t){n.withTransactionUpdate(function(){for(var s=[],i=0;i<e.length;i++){var o=new r(e[i]);o.options.data&&(o.options.data.isExpandMultiple=!1),o.options.children=null,o.setState({state:"noChildren"}),s.push(o)}if(s.length>1)for(var a=0;a<s.length;a++)n.addRoot(s[a]);else 1==s.length&&n.addRoot(s[0],0);t(s)})},function(){n._logger.error('An error occurred during "%s"',"addRoots")})},removeRootsById:function(e){var s=this;return 0===e.length?t.resolve():new t(function(t){s.withTransactionUpdate(function(){if(e.forEach(function(e){var t=s.searchRootById(e);null!==t&&s.removeRoot(t)}),0==s.getRoots().length){var n=l.get("templateComponentDialog")?l.get("templateComponentDialog"):l.get("templateComponent");n.templateList.dataGridContainer.addClassName("tree-list-empty"),n.templateList.treeListPlaceholder.setContent(h.templates.treeList.placeholder),u.idling()}t()})})},prepareBroadcastSelect:function(){this._publishSelection=!0},postBroadcastSelect:function(){this._publishSelection=!1},getSelectedTemplateNodes:function(){return this.getSelectedNodes()},buildBroadcastSelectForTemplate:function(){d.start(this.name+" buildBroadcastSelect");for(var e=[],t={},s=this.getSelectedTemplateNodes(),n=0;n<s.length;n++){var i=s[n];e.push([i.options.id]),t[i.options.id]={id:i.options.id,type:i.options.type,name:i.options.name,label:i.options.title}}return d.end(this.name+" buildBroadcastSelect"),{paths:e,attributes:t}},pushBroadcastSelect:y(function(){d.start(this.name+" pushBroadcastSelect");var e=this.buildBroadcastSelectForTemplate();if(this.getRoots(!1).length>0){var t=this.getSelectedTemplateNodes();u.select(t);var s=t[t.length-1];null!=s&&(this.utils.isOwnedByCurrentUser(s.options,this.user)&&s.options.state!=b?this.utils.isOwnedByCurrentUser(s.options,this.user)&&1==t&&u.enable(["edit"]):u.disable(["edit"]))}p.publishSelectAll(e),this.component.publishCompass(),this._publishSelection=!1,d.end(this.name+" pushBroadcastSelect")},100),withBroadcastSelect:function(e){var t=this;t.prepareBroadcastSelect(),e.then(function(){t.pushBroadcastSelect()},function(){t.postBroadcastSelect()})},updateObjectNodeForMaturity:function(t){var s=this,n=s.getSelectedTemplateNodes(),i=[];t.forEach(e=>{null!=e.policy&&(e.maturity=e.policy+"."+e.state,i.push(e.maturity))});var o={"ds6w:status":i};c.getNLSValuesPromise(o).then(o=>{if(e.is(o["ds6w:status"])){var a=Object.values(o["ds6w:status"])[0],r=i[0];r=r.replace("Issue Template.",""),n.filter(e=>t.some(t=>e.options.id.includes(t.physicalid))).forEach(e=>{e.updateOptions({state:r,grid:{"ds6w:state":a}})}),s.prepareBroadcastSelect(),s.pushBroadcastSelect(),s.postBroadcastSelect()}})},autoFill:{_physicalIdsForValidation:{},_physicalIdsForClassification:{},classificationAttributes:function(e,t){if(this._physicalIdsForClassification[e]){var s=this._physicalIdsForClassification[e];if(!s.attributes.some(e=>e.name===t)){var n={name:t};s.attributes.push(n)}}else{this._physicalIdsForClassification[e]={},this._physicalIdsForClassification[e].physicalId=[e];n={name:t};this._physicalIdsForClassification[e].attributes=[n]}this._autoFillClassification(this._physicalIdsForClassification)},_autoFillClassification:y(function(e){c.classification.retrieve({data:{objects:e}}).then(function(t){for(var s={},n=0;n<t.results.length;n++){var i=t.results[n].body,o=i.physicalId;s[o]=[];for(var a=e[o].attributes,r=0;r<a.length;r++){var l=a[r].name,c=i[l].substring(1,i[l].length-1),d={};d.attrName=l,d.attrValue=c,s[o].push(d)}}var u=I.getAllDescendants();for(r=0;r<u.length;r++){var m=u[r];if(s[m.options.physicalId]){a=s[m.options.physicalId];for(var p=0;p<a.length;p++){var f=a[p].attrName,h=a[p].attrValue,g={grid:{}};g.grid[f]=h,m.updateOptions(g)}}}})},v)},getComponent:function(){return this.component},getRoots:function(t){var s=this._parent();if(!0===t&&e.is(this._getChildrenFilterInfo,"function")){var n=this._getChildrenFilterInfo();if(n&&e.is(n.childrenBeforeFiltering,"array")){var i=s;s=n.childrenBeforeFiltering.slice(0),i.forEach(function(e){s.indexOf(e)<0&&s.push(e)})}}return s},getNodesById:function(e){var t=[];d.start(this.name+" getNodesById");for(var s=this.getRoots(!1),n=0;n<s.length;n++)t=t.concat(s[n].getNodesById(e));return d.end(this.name+" getNodesById"),t},_subscribers:function(){var e=this;e.getXSO().onEmpty(function(){e.component._destroyPopover(),e.templateModelEvents.publish({event:"template-xso-empty"}),e.prepareBroadcastSelect(),setTimeout(function(){0===e.getSelectedTemplateNodes().length&&e.pushBroadcastSelect()},g),e.postBroadcastSelect()}),e.getXSO().onChange(function(){e.component._destroyPopover(),e.prepareBroadcastSelect(),e.pushBroadcastSelect(),e.templateModelEvents.publish({event:"template-xso-change"}),e.postBroadcastSelect()}),n.subscribe("Lifecycle.Modification",function(t){var s=JSON.parse(t).Refresh.modified;if(Array.isArray(s)){var n=s.filter(function(e){return"Issue Template"==e.policy}).map(function(e){return e});n.length>0&&e.updateObjectNodeForMaturity(n)}})},utils:{isJson:function(e){try{JSON.parse(e)}catch(e){return!1}return!0},isShared:function(t){return!0===e.is(t.info.share,"object")},isOwnedBy:function(e,t){return!0===this.isShared(e)&&e.info.share.owner&&e.info.share.owner.user===t},isOwnedByCurrentUser:function(e,t){return e.owner.user===t},setDroppableData:function(e,t){var s=l.get("widget")||window.widget,n={protocol:"3DXContent",version:"2.1",source:s.name,widgetId:s.id,data:{items:[]}};null!=t&&(n.data.options=t);for(var i=0;i<e.length;i++){var o=e[i],a=o.options.physicalId.split(","),r=a[a.length-1],c={envId:m.getTenant(),serviceId:"3DSpace",contextId:s.id,objectId:r,objectType:o.options.type,displayName:o.options.display,displayType:o.options.type};n.data.items.push(c)}var d="text/plain";try{(window.navigator.userAgent.indexOf("MSIE ")>0||navigator.userAgent.match(/Trident.*rv\:11\./))&&(d="text")}catch(e){}return{type:d,data:JSON.stringify(n)}}},getTemplateModelEvents:function(){return this.templateModelEvents},refreshNodesById:function(e){var s=this;d.start(s.name+" refreshNodesById");var n=[],i=[],o=[];return new t(function(t,s){e.isEdit?(n.push(e.physicalId),i.push(e.physicalId)):(n.push(e.physicalId),o.push(e.physicalId)),n.length>0&&c.templates.retrieve({data:{objects:{physicalId:n[0]}},onComplete:function(e){var s={},n=e.body;n.attribute.forEach(e=>{switch(Object.keys(e)[0]){case C:s=JSON.parse(e[C])}}),n.data={},n.data.id=n.physicalId,n.data.data=s.data,n.data.info=s.info,n.data.hidden=s.hidden;var i=f.parse(e.body);t(i)},onFailure:function(e){s(e)}})}).then(function(e){var t=[],n=[];return o.length>=1&&t.push(e),i.length>=1&&(n.push(e),[].push([e.id]),{}[e.id]={id:e.id,type:e.type,name:e.name,title:e.title}),s.addRoots(t,!0).then(function(e){var t=l.get("templateComponentDialog")?l.get("templateComponentDialog"):l.get("templateComponent"),i=[];return e.length>0&&(s.unselectAll(),e.forEach(e=>{e.select()}),t.templateList.dataGridContainer.removeClassName("tree-list-empty")),s.withTransactionUpdate(function(){n.forEach(function(e){var t=s.searchRootById(e.physicalId);null!==t&&(f.update(t.options,e),t.updateOptions(e),i.push(t),t.select())})}),d.end(s.name+" refreshNodesById"),{created:e,modified:i}})})},searchRootById:function(e){var t=null;d.start(this.name+" searchRootById");for(var s=this.getRoots(),n=0;n<s.length;n++)if(s[n].options.id===e){t=s[n];break}return d.end(this.name+" searchRootById"),t}})}),define("DS/IssueComponents/templates/TemplateMigration",["UWA/Class/Promise","UWA/Core","DS/Controls/ProgressBar","DS/DocumentManagement/DocumentManagement","DS/PADUtils/views/PADAlert","DS/IssueComponents/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueServices/services/PlatformServices","DS/PlatformAPI/PlatformAPI","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,s,n,i,o,a,r,l,c,d,u){"use strict";var m="ISU_TEMPLATES",p="In_Progress",f="Completed",h="DiffWidget";return{processLegacyTemplates:function(){var t=this,s=a.get("widget")||window.widget;return t.templateComponent=a.get("templateComponentDialog")?a.get("templateComponentDialog"):a.get("templateComponent"),t.migrationStatus().then(n=>n==h?void d.subscribe("DS/ENXISSU_AP/TemplateMigration",function(e){"Completed"!=e.data.status||i.displayNotification({msg:"Templates are migrated, please refresh your widget.",eventID:"info"})}):n==f?void 0:t.getTemplates().then(e=>t.filterTemplateList(e)).then(e=>t.createTemplateList(e)).then(e=>t.getSharedTemplateData(e.shared).then(t=>({templateList:e,result:t}))).then(e=>{var s=t.getContentIdAndData(e),n=s.consolidated,i=s.listOfContent;return t.fetchDataforContent(i).then(e=>({consolidated:n,result:e}))}).then(e=>{let s=t.getMembersOfTemplate(e.consolidated);return t.fetchDataforMembers(s).then(t=>({consolidated:e.consolidated,result:e.result,memberResult:t}))}).then(e=>t.formatDataForLegacy(e)).then(s=>{var n=[];return t.totalLegacyTemplate=s.length,s.forEach(e=>{n.push(t.migrateIssueTemplate(e))}),e.all(n).then(e=>t.getTemplates().then(s=>(0==s.length&&t.setMigrationStatus(f),e)),function(e){t.templateComponent._logger.error('The templatemigration failed "%s"',e)})}).then(e=>(d.publish("DS/ENXISSU_AP/TemplateMigration",{metadata:{appId:s.id,appName:s.name,timestamp:Math.floor(Date.now())},data:{status:"Completed"},version:"1.0"}),e)).catch(e=>{}))},getTemplates:function(){var e=this,t=[];return r.preferences.get({data:{name:m}}).then(function(s){return t=s.body,e.legacyTemplates=t,e.migratedTemplateCount=0,t}).catch(function(t){return e.templateComponent._logger.error("Could not fetch the templates from the preferences: %o",t),[]})},migrationStatus:function(){var t=this,s=a.get("widget")||window.widget,n="";return new e((e,i)=>{t.getMigrationStatus().then(i=>{let o=i.status;if(""==o||null==o)t.setMigrationStatus(s.id+"-"+p),n=p;else if(o==s.id+"-"+p)n=p;else if(o==f)n=f;else if(n=h,c.isCloudEnvironment())return t.getTemplates().then(i=>{i.length>0?(n=p,t.setMigrationStatus(s.id+"-"+p)):(n=f,t.setMigrationStatus(f)),e(n)});e(n)}).catch(t=>{e(n=p)})})},filterTemplateList:function(e){var s=[],n=[];return s=e.filter(function(e){return e.info.tenant===c.getTenant()}),c.isCloudEnvironment()?(n=e.filter(function(e){return("OnPremise"===e.info.tenant||""===e.info.tenant||null==e.info.tenant)&&!0===t.is(e.info.share,"object")}),this.fetchDocumentForCloud(n).then(e=>(n=e,s.concat(n)))):s},fetchDocumentForCloud:function(t){var s=this,i=[];if(0===t.length)return e.resolve(i);var o=t.reduce(function(e,t){return e.push(t.info.share.file),e},[]);return new e(function(e){n.downloadDocuments(o,{tenantUrl:c.get3DSpaceUrl(),tenant:c.getTenant(),securityContext:decodeURIComponent(c.getSecurityContext()),onComplete:function(n){var o=n.length,a=0;n.forEach(function(n){n.downloadUrl?s.getContentFromURL(n.id,n.downloadUrl).then(s=>{var n=t.filter(e=>e.info.share.file==s.id);Array.isArray(n)&&(n[0].info.tenant=c.getTenant(),i.push(n[0])),++a==o&&e()}).catch(e=>{}):++a==o&&e()})},onFailure:function(t){s.templateComponent._logger.error('The download call failed "%s"',t);var n=0,i=t.length;t.forEach(e=>{null==e.downloadUrl&&n++}),n==i&&e()}})}).then(function(){return i})},createTemplateList:function(e){var s={shared:[],non_shared:[]};if(Array.isArray(e)){if(!(e.length>0))return s;this.showMigrationProgressBar(),e.forEach(e=>{!0===t.is(e.info.share,"object")?s.shared.push(e):s.non_shared.push(e)})}return s},getSharedTemplateData:function(s){var i=this,o=t.clone(s),a={array:[],map:{}};if(0===o.length)return e.resolve(a);var r=o.reduce(function(e,t){return e.push(t.info.share.file),e},[]);return new e(function(e){n.downloadDocuments(r,{tenantUrl:c.get3DSpaceUrl(),tenant:c.getTenant(),securityContext:decodeURIComponent(c.getSecurityContext()),onComplete:function(s){var n=s.length,r=0;s.forEach(function(s){s.downloadUrl?i.getContentFromURL(s.id,s.downloadUrl).then(s=>{var i=s,l=o.filter(e=>e.info.share.file==s.id),d=t.clone(i.content);d.id=l[0].id,d.info.lastUsed=l[0].info.lastUsed,d.data.share={file:l[0].info.share.file,document:l[0].info.share.document};var u=d.info.version;t.is(u,"string")||(u=d.info.version=""),d.info.tenant=c.getTenant(),a.array.push(d),a.map[d.id]=d,++r==n&&e()}).catch(e=>{}):++r==n&&e()})},onFailure:function(t){i.templateComponent._logger.error('The download call failed "%s"',t);var s=0,n=t.length;t.forEach(e=>{null==e.downloadUrl&&(s++,i.legacyTemplates=i.legacyTemplates.filter(function(t){return t.info.share?t.info.share.file!=e.id:t}))}),s==n&&e()}})}).then(function(){return i.setTemplates(i.legacyTemplates),a})},getContentFromURL:function(t,s){var n=this,i=new XMLHttpRequest;return new e(function(e,o){i.open("GET",s,!0),i.responseType="blob",i.onload=function(){var s=new FileReader;s.readAsDataURL(i.response),s.onload=function(s){try{e({id:t,content:JSON.parse(n.base64.decode(s.target.result.split(",").pop()))})}catch(e){o(new Error("The shared template from the URL is not a JSON "+e))}}},i.onerror=function(){o(new Error("Could not read the shared template from the URL "+s))},i.send()})},getContentIdAndData:function(e){var t=[],s=[];e.templateList.non_shared.forEach(e=>{t.push(e),(e.data.reportedAgainst.length>0||e.data.contexts.length>0)&&(e.data.reportedAgainst.forEach(e=>{s.push(e.physicalId)}),e.data.contexts.forEach(e=>{s.push(e.physicalId)}))}),e.result.array.forEach(e=>{t.push(e),(e.data.reportedAgainst.length>0||e.data.contexts.length>0)&&(e.data.reportedAgainst.forEach(e=>{s.push(e.physicalId)}),e.data.contexts.forEach(e=>{s.push(e.physicalId)}))});var n=[...new Set(s)];return{consolidated:t,listOfContent:n}},getMembersOfTemplate:function(e){let t={user:[],userGroup:[]};e.forEach(e=>{e.data.assignees&&e.data.assignees.forEach(e=>{e.type&&"group"==e.type?t.userGroup.push(e):t.user.push(e)}),e.data.coOwners&&e.data.coOwners.forEach(e=>{e.type&&"group"==e.type?t.userGroup.push(e):t.user.push(e)}),e.data.contributors&&e.data.contributors.forEach(e=>{e.type&&"group"==e.type?t.userGroup.push(e):t.user.push(e)}),e.data.informedUsers&&e.data.informedUsers.forEach(e=>{e.type&&"group"==e.type?t.userGroup.push(e):t.user.push(e)})});const s=[...new Map(t.user.map(e=>[e.user,e])).values()],n=[...new Map(t.userGroup.map(e=>[e.user,e])).values()];return t.user=s,t.userGroup=n,t},fetchDataforContent:function(t){return new e((e,s)=>{t.length>0?r.fetch({data:{objects:t.map(function(e){return{physicalId:e}})}}).then(t=>{var s=t.body,n={};s.infos&&s.infos.nresults&&s.infos.nresults>0&&s.results.forEach(e=>{var t="",s="";e.attributes.forEach(e=>{"resourceid"==e.name&&(t=e.value),"ds6w:type"==e.name&&(s=e.value)}),n[t]={physicalId:t,type:s}}),e(n)}).catch(e=>{}):e()})},fetchDataforMembers:function(t){return new e((e,s)=>{t.user.length>0||t.userGroup.length>0?r.templates.getMembers(t).then(t=>{var s={};t.forEach(e=>{s[e.identifier]={...e}}),e(s)}).catch(e=>{}):e()})},formatDataForLegacy:function(e){var s=[],n=e.result,i=e.memberResult;return e.consolidated.forEach(e=>{e.data.reportedAgainst.slice(0).forEach(t=>{null==n[t.physicalId]?e.data.reportedAgainst.splice(e.data.reportedAgainst.indexOf(t),1):(t.objectType=n[t.physicalId].type,t.serviceId="3dspace",t.envId=c.getTenant())}),e.data.contexts.slice(0).forEach(t=>{null==n[t.physicalId]?e.data.contexts.splice(e.data.contexts.indexOf(t),1):(t.objectType=n[t.physicalId].type,t.serviceId="3dspace",t.envId=c.getTenant())}),t.is(e.data.custom)&&Object.values(e.data.custom)&&Object.values(e.data.custom).forEach((t,s)=>{Array.isArray(t)&&(e.data.custom[Object.keys(e.data.custom)[s]]=t.toString())}),Array.isArray(e.data.assignees)&&e.data.assignees.slice(0).forEach(t=>{null==i[t.user]&&e.data.assignees.splice(e.data.assignees.indexOf(t),1)}),Array.isArray(e.data.coOwners)&&e.data.coOwners.slice(0).forEach(t=>{null==i[t.user]&&e.data.coOwners.splice(e.data.coOwners.indexOf(t),1)}),Array.isArray(e.data.contributors)&&e.data.contributors.slice(0).forEach(t=>{null==i[t.user]&&e.data.contributors.splice(e.data.contributors.indexOf(t),1)}),Array.isArray(e.data.informedUsers)&&e.data.informedUsers.slice(0).forEach(t=>{null==i[t.user]&&e.data.informedUsers.splice(e.data.informedUsers.indexOf(t),1)})}),e.consolidated.forEach(e=>{e.data.templateTitle=e.info.name,e.data.templateDescription=e.info.description,e.data.oldTemplateId=e.id;var t={id:"",data:e.data,metadata:{hidden:e.hidden,info:e.info,data:{securityContexts:e.data.securityContexts,title:e.data.title,description:e.data.description,automationTasks:e.data.automationTasks}}};s.push(t)}),s},migrateIssueTemplate:function(e){var t=this,s=e.data.securityContexts,n=c.getSecurityContexts();return n.cspaces.some(e=>e.value==s)||(e.data.securityContexts=n.securityContext,e.metadata.data.securityContexts=n.securityContext),t.createIssueTemplate(e).then(function(s){var n={physicalId:s.body.physicalId,isEdit:!0};return e.data.attachments.length>0?t._connectAttachments(n,e):n}).then(function(t){return Array.isArray(e.data.classes)&&e.data.classes.length>0||Array.isArray(e.data.existingClassification)&&e.data.existingClassification.length>0?o.classification.getCSRFToken(t).then(t=>o.classification.classifyObject(e.data.classes,t)).then(e=>o.classification.getClassAttrVals(e)).then(t=>{if(t.cestamp){var s=e.data.attributes;return o.classification.setClassificationValues(s,t)}return t}).then(t=>{var s=a.get("templateComponentDialog")?a.get("templateComponentDialog"):a.get("templateComponent");return s&&o.classification.addClassificationColumn(e,s.templateList,"template"),t}).catch(e=>{return{issueId:t.physicalId}}):{issueId:t.physicalId}}).then(function(t){return e.data.share?r.templates.promoteTemplate(t,e).then(e=>t).catch(e=>t):t}).then(function(t){return e.data.share?r.templates.changeTemplateOwner(t,e).then(e=>t).catch(e=>t):t}).then(function(t){return e.data.share&&r.templates.deleteDocument({data:e.data.share.document}),e}).then(function(s){return t.updateProgress(),t.legacyTemplates=t.legacyTemplates.filter(function(t){return t.id!=e.data.oldTemplateId}),t.setTemplates(t.legacyTemplates),!0})},createIssueTemplate:function(t){var s=this;return new e((e,n)=>{r.templates.createTemplate({data:t}).then(function(t){e(t)}).catch(function(t){e(t),s.templateComponent._logger.error("Could not create the template: %o",t)})})},_connectAttachments:function(t,s){null!=s.data.primaryAttachment&&null!=s.data.primaryAttachment&&l.setAsPrimary(s.data.primaryAttachment,t.physicalId,!0);var n=[];return s.data.attachments.forEach(e=>{n.push(l.connectDocumentToParent(e,t.physicalId))}),e.all(n).then(e=>t).catch(e=>t)},showMigrationProgressBar:function(){var e=a.get("widget")||window.widget,n=t.createElement("span",{html:u.templateMigrationMsg,class:"migration-msg"}),o=t.createElement("br",{}),r=t.createElement("span",{html:u.templateMigrationSubMsg,class:"migration-subMsg"});this.migrationProgressBar=new s({shape:"linear"});var l=t.createElement("div",{}),c=t.createElement("div",{class:"migration-progressBar"});this.migrationProgressBar.inject(c),n.inject(l),o.inject(l),r.inject(l),c.inject(l),this.migrationProgressBar.value=0,this.migrationProgressBar.gradientAnimationFlag=!1,this.templateComponent.templateList.dataGridContainer.addClassName("tree-list-empty"),this.templateComponent.templateList.treeListPlaceholder.setContent(l),e.getValue("IsIssueSummaryView")&&i.displayNotification({msg:u.templateMigrationMsg+"\n"+u.templateMigrationSubMsg,eventID:"info"})},updateProgress:function(){this.migratedTemplateCount++;var e=this.migratedTemplateCount/this.totalLegacyTemplate*100;this.migrationProgressBar.value=e},setTemplates:function(e){var t=this;return r.preferences.set({data:{name:m,value:JSON.stringify(e)}}).catch(function(e){t.templateComponent._logger.error("Could not save the preferences: %o",e)})},setMigrationStatus:function(e){var t=this;let s={status:e};r.preferences.set({data:{name:"ISUTemplateMigration",value:JSON.stringify(s)}}).catch(function(e){t.templateComponent._logger.error("Could not save the preferences: %o",e)})},getMigrationStatus:function(e){var t=this;return r.preferences.get({data:{name:"ISUTemplateMigration"}}).then(function(e){return e.body}).catch(function(e){return t.templateComponent._logger.error("Could not save the preferences: %o",e),""})},base64:{decode:function(e){return decodeURIComponent(Array.prototype.map.call(atob(e),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}}}}),define("DS/IssueComponents/create/Specialization",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/IssueComponents/create/Form","DS/Controls/DatePicker","DS/Controls/LineEditor","DS/Controls/Editor","DS/Controls/ComboBox","DS/Controls/SpinBox","DS/Controls/Toggle","DS/WUXAutoComplete/AutoComplete","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/IssueServices/services/IssueServices","DS/IssueServices/Contexts","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f,h){"use strict";var g={UI_ACCESS:{READ_ONLY:"ReadOnly",NONE:"None"},CUSTOM_PROPERTY_TYPE:{MEMO:"textarea",DATE:"timestamp",TEXT:"string",INT:"integer",REAL:"real",BOOL:"boolean"},ISSUE_TYPE:"Issue",BOOL_TRUE:"TRUE"};return t.extend({name:"DS/IssueComponents/create/Specialization",tag:"div",className:"create-view-content-subview create-specialize",isInit:null,_deferredInit:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s.parent=t.parent,s.DefaultType=g.ISSUE_TYPE,s.isInit=new e(function(e,t){s._deferredInit.resolve=e,s._deferredInit.reject=t}),s.formElements={},s.formElementsToggler={},s.fields={},s.requiredLabels={},s.noShow=!0,s.noShowSubType=!0,s._customProperties=[],s.subTypeRes={};var n=[],i=s.getSubTypes();n.push(i),e.all(n).then(s._deferredInit.resolve).catch(s._deferredInit.reject)},destroy:function(){var e=this;e.form=null,Object.keys(e.fields).forEach(function(t){e.fields[t]=null,e.formElements[t]=null,e.formElementsToggler[t]=null})},render:function(){return this.form=new n({className:"create-properties-form",fields:[],events:{onInvalid:function(){}}}).inject(this.container),this.form.getContent().setAttribute("novalidate",!1),this.setFormContent(),this},getSubTypeAttributes:function(t){let s=[];var n={type:g.ISSUE_TYPE};return s.push(p.type.getSubTypesAllAttributes(n)),s.push(p.type.getSubTypesAllAttributes(t)),s.push(p.type.getProperties(t.type)),s.push(p.custom.getCustomAttributes({subType:t.type})),e.all(s).then(t=>{let s=[];if(t.length>3&&t[3].body&&t[3].body.length>0){const e=f.get("ISU_DeploymentAttributes");t[3].body.forEach(t=>{if(null===e||null!==e&&!e.get(t.name)){const e={Name:t.name,NLS:t.title,Type:t.type,DefaultValue:t.defaults,HasDefault:"",MultiValuated:"",MultiLine:t.multiline,UIAccess:t.UIAccess};s.push(e)}})}s.length&&s.forEach(e=>{t[1].Attributes&&t[1].Attributes.push(e)});var n={};if(t.length>1&&void 0!==t[2]){let e=t[2];if(Array.isArray(e.classPredicates)&&e.classPredicates.length>0)e.classPredicates[0].vocabularyPredicateInfo.forEach(e=>{e.userAccess&&(n[e.name]=e)})}let i=t[0].Attributes.map(e=>e.Name);var o=t[1].Attributes.filter(e=>!i.includes(e.Name));return t[1].Attributes=o,t[1].Attributes.length&&t[1].Attributes.forEach(e=>{n[e.Name]&&(e.NLS=n[e.Name].nlsName)}),e.resolve(t[1])})},updateTypeAttributeOnSelect:function(t){var n,i,o=this,a=new e((e,t)=>{i=t,n=e}),r=[];if(o.form.elements.container.empty(),o._customProperties=[],o.noShow=!1,void 0!==t&&o.DefaultType!=t.type){var l=new e((e,n)=>{o.getSubTypeAttributes(t).then(t=>{if(void 0!==t&&Array.isArray(t.Attributes)&&t.Attributes.length>0){var n=t.Attributes.map(e=>{var t=e.Type.toLowerCase();switch(t){case"date":t=g.CUSTOM_PROPERTY_TYPE.DATE;break;case"double":t=g.CUSTOM_PROPERTY_TYPE.REAL}var n=[],i=[];return"Yes"===e.HasRangeDefined&&e.AuthorizedValues.forEach(function(e){n.push(e.Name),i.push(e.NLS)}),{title:e.NLS,name:e.Name,type:t,defaults:e.DefaultValue,NLSRange:i,range:n,path:e.Name,UIAccess:s.is(e.UIAccess)?e.UIAccess:"",multiline:"Yes"==e.MultiLine?"true":"false"}});e(n)}else e()})});r.push(l)}return e.all(r).then(e=>{e.forEach(e=>{s.is(e,"array")&&(o._customProperties=o._customProperties.concat(e))}),o.setFormContent(),n()}).catch(e=>{i()}),a},getSubTypes:function(t){var s=this;return new e(t=>{p.type.getSubType().then(t=>(s.subTypeRes=t,null!=s.subTypeRes&&Object.keys(s.subTypeRes).length>1&&(s.noShowSubType=!1),e.resolve(t))).catch(function(){return s.subTypeRes=null,e.resolve({Issue:{}})}).then(t)})},setFormContent:function(e){var t=this;if(t._customProperties.length>0){var n=s.createElement("div",{class:"create-form-content"}),i=[],o=[];t._customProperties.forEach(function(e,s){var n=[],a={};if(null!==e.range){var r=e.NLSRange;e.range.forEach(function(e,t){n.push({labelItem:r[t],valueItem:e})})}if(e.type==g.CUSTOM_PROPERTY_TYPE.DATE&&""==e.defaults&&(e.defaults=void 0),a.index=s,a.element=e.name,a.value=e.defaults,a.required="Yes"===e.mandatory,a.placeholder=t.getPlaceholder(e),a.help=t.getHelper(e),a.type=e.type,a.label=t.getLabel(e),a.rangeItems=n,a.UIAccess=e.UIAccess,a.requiredText=h.create.required,a.selectedIndex=-1,a.multiline=e.multiline,a.type!==g.CUSTOM_PROPERTY_TYPE.INT&&a.type!==g.CUSTOM_PROPERTY_TYPE.REAL||a.rangeItems.sort(function(e,t){return e-t}),a.rangeItems.length>0&&a.rangeItems.forEach(function(e,t){a.value===e&&(a.selectedIndex=t)}),g.UI_ACCESS.NONE!=e.UIAccess&&g.UI_ACCESS.READ_ONLY!=e.UIAccess){var l=t.createFormElement(a);a.required?i.push(l):o.push(l)}}),i.forEach(function(e){e.inject(n)}),o.forEach(function(e){e.inject(n)}),n.inject(t.form.elements.container)}},createFormElement:function(e){var t="create-form-element create-properties-form-element-"+e.element,n=this.formElements[e.element]=s.createElement("div",{class:t});this.parent.parent.isTemplate&&!e.required&&this.createVisibilityMask(e).inject(n);return this.createFormGroup(e).inject(n),n},createFormGroup:function(e){var t=s.createElement("div",{class:"create-form-field form-group"});return(e.required?this.createRequiredLabel(e):this.createLabel(e)).inject(t),this.createFormField(e).inject(t),t},createVisibilityMask:function(e){var t,n,i,o=s.createElement("div",{html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[this.formElementsToggler[e.element]=s.createElement("span",{class:"fonticon fonticon-eye"})]}]});return this.formElementsToggler[e.element].addEventListener("click",(t=this.formElements,n=this.formElementsToggler,i=e.element,function(){s.is(t[i])&&t[i].toggleClassName("visibility-masked"),s.is(n[i])&&(n[i].toggleClassName("fonticon-eye"),n[i].toggleClassName("fonticon-eye-off"))})),o},createRequiredLabel:function(e){e.element;var t="required-form-field-title-label"+(this.parent.parent.isTemplate?"":" highlight"),n="required-form-field-required-label"+(this.parent.parent.isTemplate?"":" highlight");return this.requiredLabels[e.element]=s.createElement("h5",{class:"required-form-field",html:[s.createElement("span",{class:t,html:e.label}),s.createElement("span",{class:n,html:e.requiredText})]})},createLabel:function(e){e.element;return s.createElement("h5",{class:"create-form-field-label",html:e.label})},createFormField:function(e){var t=this,n=s.createElement("div",{name:e.name,id:e.id}),i=null;if(e.rangeItems.length>0&&e.type!==g.CUSTOM_PROPERTY_TYPE.BOOL)i=t.createComboBox(e);else switch(e.type){case g.CUSTOM_PROPERTY_TYPE.TEXT:case g.CUSTOM_PROPERTY_TYPE.MEMO:(i=t.createTextField(e)).getContent().querySelectorAll("input, div").forEach(function(e){e.style.width="100%",e.style.fontSize="medium"});break;case g.CUSTOM_PROPERTY_TYPE.DATE:(i=t.createDateField(e)).getContent().querySelectorAll("input").forEach(function(e){e.style.fontSize="medium"});break;case g.CUSTOM_PROPERTY_TYPE.BOOL:i=t.createBooleanField(e);break;case g.CUSTOM_PROPERTY_TYPE.INT:case g.CUSTOM_PROPERTY_TYPE.REAL:i=t.createNumberField(e),t.fields[e.element].getContent().style.height="auto",i.getContent().style.width="100%",i.getContent().querySelectorAll("input").forEach(function(e){e.style.fontSize="medium"})}return i.getContent().addEventListener("change",function(){switch(e.type){case g.CUSTOM_PROPERTY_TYPE.TEXT:case g.CUSTOM_PROPERTY_TYPE.MEMO:t._customProperties[e.index].value=t.fields[e.element].value;break;case g.CUSTOM_PROPERTY_TYPE.DATE:var s=t.fields[e.element].value;t._customProperties[e.index].value=s.getMonth()+1+"/"+s.getDate()+"/"+s.getFullYear();break;case g.CUSTOM_PROPERTY_TYPE.BOOL:t._customProperties[e.index].value=t.fields[e.element].checkFlag?"true":"false";break;case g.CUSTOM_PROPERTY_TYPE.INT:case g.CUSTOM_PROPERTY_TYPE.REAL:var n=t.fields[e.element].value;t._customProperties[e.index].value=null!=n&&""!==n?n.toString():n}}),i.inject(n),n},createTextField:function(e){var t=null;"false"===e.multiline?(t=this.fields[e.element]=new o({value:e.value,requiredFlag:e.required&&!this.parent.parent.isTemplate,placeholder:e.placeholder})).getContent().setStyle("width","100%"):((t=this.fields[e.element]=new a({value:e.value,nbRows:4,requiredFlag:e.required&&!this.parent.parent.isTemplate,placeholder:e.placeholder,newLineMode:"enter"})).getContent().setStyle("width","100%"),t.getContent().querySelectorAll("textarea").forEach(function(e){e.style.width="100%",e.style.fontSize="medium",e.style.resize="vertical",e.style.overflow="auto"}));return t},createDateField:function(e){return this.fields[e.element]=new i({value:e.value,minValue:e.minValue,maxValue:e.maxValue})},createNumberField:function(e){var t="integer"===e.type?parseInt(e.value):parseFloat(e.value);return this.fields[e.element]=new l({value:t,stepValue:"integer"===e.type?1:.1,maxValue:"integer"===e.type?2147483646:999999999999999})},createComboBox:function(e){var t=e.rangeItems,n=function(){var e=new u;e.prepareUpdate();for(var s=0;s<t.length;s++){var n=t[s].labelItem,i=t[s].valueItem,o=new m({label:n,value:i});e.addRoot(o)}return e.pushUpdate(),e}(),i=!1;s.is(e.MultiValuated)&&(i=!0);var o=[];t.length>0&&t.forEach(function(t,s){e.value===t.labelItem&&o.push(n.getRoots()[s])});var a=e.required,r=(e.placeholder,this.fields[e.element]=new d({elementsTree:n,multiSearchMode:i,selectedItems:o,allowFreeInputFlag:!1}));return(1==i||t.length>0)&&r.getContent().addEventListener("keydown",function(e){13==e.keyCode&&e.stopPropagation()}),r.requiredFlag=a,r},createBooleanField:function(e){var t=this.fields[e.element]=new c({type:"switch",checkFlag:e.value.toLowerCase()===g.BOOL_TRUE.toLowerCase()});return t.getContent().addEventListener("keydown",function(e){13==e.keyCode&&e.stopPropagation()}),t},show:function(){this._parent(),this._customProperties.length>0&&this.fields[this._customProperties[0].name]&&"focus"in this.fields[this._customProperties[0].name]&&this.fields[this._customProperties[0].name].focus()},hide:function(){this._parent()},validate:function(){return this.form.fields=Object.values(this.fields).filter(function(e){return null!==e}),this.form.validate(!1,!1)},getValues:function(){var e={specialization:{}};return s.is(this.subTypeSelector,"object")&&(e.type=this.subTypeSelector.value),this._customProperties.forEach(function(t){"undefined"!=t.value&&(e.specialization[t.path]=t.value)}),e},getHiddenAttributes:function(){var e={custom:{}};for(var t in this.formElements)s.is(this.formElementsToggler[t])&&(e.custom[t]=this.formElementsToggler[t].hasClassName("fonticon-eye-off"));return e},reset:function(){var e=this;e._customProperties.forEach(function(t){if(t.value=t.defaults,e.fields[t.name])switch(t.type){case g.CUSTOM_PROPERTY_TYPE.TEXT:case g.CUSTOM_PROPERTY_TYPE.MEMO:e.fields[t.name].value=t.defaults;break;case g.CUSTOM_PROPERTY_TYPE.DATE:break;case g.CUSTOM_PROPERTY_TYPE.BOOL:e.fields[t.name].checkFlag="true"===t.defaults.toLowerCase();break;case g.CUSTOM_PROPERTY_TYPE.INT:case g.CUSTOM_PROPERTY_TYPE.REAL:e.fields[t.name].value=""===t.defaults?0:"integer"===t.type?parseInt(t.defaults):parseFloat(t.defaults)}})},applyTemplate:function(t){var n,i=this;i.reset();var o=new e((e,t)=>{t,n=e});if(s.is(i.subTypeSelector,"object")){i.subTypeSelector.removeEventListener("change",i.subTypeSelectorClick),i.subTypeSelector.value=s.is(t.data.type,"string")?t.data.type:i.DefaultType,i.subTypeSelector.addEventListener("change",i.subTypeSelectorClick);var a={type:i.subTypeSelector.value}}return i.parent.parent.options.editMode&&(i.subTypeSelector.disabled=!0),i.updateTypeAttributeOnSelect(a).then(()=>{if(s.is(t.data,"object")&&s.is(t.data.specialization,"object")&&i._customProperties.forEach(function(e){if(s.is(t.data.specialization[e.path],"string")&&(e.value=t.data.specialization[e.path],i.fields[e.name]))switch(e.type){case g.CUSTOM_PROPERTY_TYPE.TEXT:case g.CUSTOM_PROPERTY_TYPE.MEMO:case g.CUSTOM_PROPERTY_TYPE.DATE:i.fields[e.name].value=e.value;break;case g.CUSTOM_PROPERTY_TYPE.BOOL:i.fields[e.name].checkFlag="true"===e.value.toLowerCase();break;case g.CUSTOM_PROPERTY_TYPE.INT:case g.CUSTOM_PROPERTY_TYPE.REAL:i.fields[e.name].value=""===e.value?"0":e.value}}),s.is(t.hidden,"object")&&s.is(t.hidden.custom,"object")&&s.is(i.formElements,"object")&&s.is(i.formElementsToggler,"object")){var e=i.formElements,o=i.formElementsToggler;for(var a in e)!0===t.hidden.custom[a]&&(i.parent.parent.isTemplate?(s.is(e[a])&&e[a].toggleClassName("visibility-masked",!0),s.is(o[a])&&(o[a].toggleClassName("fonticon-eye-off",!0),o[a].toggleClassName("fonticon-eye",!1))):s.is(e[a])&&e[a].hide())}n()}),o},getLabel:function(e){var t="",s=h.create.properties.custom;if(void 0!==s){var n=s[e.name];void 0!==n&&(t=n.label)}return""!==t&&void 0!==t||(t=e.title),""!==t&&void 0!==t||(t=e.name),t},getPlaceholder:function(e){var t="",s=h.create.properties.custom;if(void 0!==s){var n=s[e.name];void 0!==n&&(t=n.placeholder)}return""!==t&&void 0!==t||(t=e.title),""!==t&&void 0!==t||(t=e.name),t},getHelper:function(e){var t="",s=h.create.properties.custom;if(void 0!==s){var n=s[e.name];void 0!==n&&(t=n.helper)}return""!==t&&void 0!==t||(t=e.title),""!==t&&void 0!==t||(t=e.name),t},getSubTypePicker:function(e){var t=this;t.myTreeDocument=new u;var n=new m({label:t.DefaultType});t.myTreeDocument.addRoot(n),t.subTypeRes=s.is(e,"object")?e:t.subTypeRes;var i={"ds6w:type":[]};if(null!=t.subTypeRes&&Object.keys(t.subTypeRes).length>1){var o=Object.keys(t.subTypeRes);o.sort(function(e,t){return e.localeCompare(t)}),o.forEach(e=>{var s={label:e,grid:{valueItem:e}};e!=t.DefaultType&&(t.myTreeDocument.addRoot(new m(s)),i["ds6w:type"].push(e))}),t.noShow=!1}t.myTreeDocument.expandAll(),i["ds6w:type"].length>0&&p.getNLSValuesPromise(i).then(e=>{s.is(e)&&s.is(e["ds6w:type"])&&t.myTreeDocument.getAllDescendants().forEach(t=>{var n=t.options.grid.valueItem;s.is(e["ds6w:type"][n])&&(t.options.label=e["ds6w:type"][n])})});var a=t.subTypeSelector=new r({enableSearchFlag:!1,elementsTree:t.myTreeDocument});a.getContent().style.width="100%";var l=a.getContent().querySelectorAll("button")[0];l.onfocusin=function(){a.getContent().style.borderColor="#368ec4"},l.onmouseout=function(){a.getContent().style.borderColor="#b4b6ba"},l.onmouseover=function(){a.getContent().style.borderColor="#77797c"},a.getContent().querySelectorAll("button").forEach(function(e){e.style.background="white"}),t.subTypeSelectorClick=function(e){var s={type:t.subTypeSelector.value};t.updateTypeAttributeOnSelect(s)},t.subTypeSelector.addEventListener("change",t.subTypeSelectorClick);var c=s.createElement("div",{class:"issue-comboBox-Type"});return t.subTypeSelector.inject(c),t.subTypeSelector}})}),define("DS/IssueComponents/related/DatagridView",["UWA/Core","UWA/Class","UWA/Controls/Abstract","UWA/Class/Promise","DS/CoreEvents/Events","DS/Logger/Logger","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/PlatformAPI/PlatformAPI","DS/TreeModel/TreeDocument","DS/IssueComponents/models/TreeNodeModel","DS/DataGridView/DataGridView","DS/Controls/TooltipModel","DS/IssueServices/utils/Performance","DS/IssueServices/utils/Parser","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueServices/Contexts","DS/IssueServices/utils/Views","DS/IssueComponents/utils/Utils","DS/IssueCommon/utils/Utils","DS/IssueCommon/utils/DocumentUtils","DS/LifecycleServices/LifecycleServicesSettings","DS/ENOFloatingPanel/ENOFloatingPanel","DS/PADUtils/views/PADAlert","DS/WebappsUtils/WebappsUtils","DS/Utilities/Dom","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f,h,g,v,b,C,y,I,E,S,w,T,D,A,_,O){"use strict";var N={ISSUE_TYPE:"Issue",TIMEOUT_UPDATE_COLUMN_WITH:250,REVISION_TARGETS:{STABLE_LATEST:"STABLE_LATEST",RELEASE_LATEST:"RELEASE_LATEST",LATEST:"LATEST"},CATEGORY_REPORTED_AGAINST:"reportedAgainst",CATEGORY_RESOLVED_BY:"resolvedBy",CATEGORY_CONTEXTS:"contexts",CATEGORY_RESOLVED_ITEMS:"resolvedItems",CATEGORY_REPORTED_AGAINST_INSTANCE:"reportedAgainst_instance",CATEGORY_RESOLVED_BY_INSTANCE:"resolvedBy_instance",CATEGORIES:[{CATEGORY_NAME:"reportedAgainst",CATEGORY_LABEL:O.open.labels.reportedAgainst,CATEGORY_ICON:"location"},{CATEGORY_NAME:"contexts",CATEGORY_LABEL:O.open.labels.contexts,CATEGORY_ICON:"3d-object"},{CATEGORY_NAME:"resolvedItems",CATEGORY_LABEL:O.open.labels.resolvedItems,CATEGORY_ICON:"markup-review"},{CATEGORY_NAME:"resolvedBy",CATEGORY_LABEL:O.open.labels.resolvedBy,CATEGORY_ICON:"docs"}],CATEGORY_NLS:{reportedAgainst:O.open.labels.reportedAgainst,resolvedBy:O.open.labels.resolvedBy,resolvedItems:O.open.labels.resolvedItems,contexts:O.open.labels.contexts}};return s.extend({name:"relatedcontent-datagridview",parentView:null,_logger:null,_publishSelection:!1,defaultOptions:{grid:{cellSelection:"none",cellDragEnabledFlag:!0,showRowIndexFlag:!1,showContextualMenuColumnFlag:!0,allowUnsafeHTMLContent:!0,apiVersion:2,defaultCellHeight:26,height:"100%",useAsyncPreExpand:!0,rowGroupingEnabledFlag:!1,useWidgetPreferencesFlag:!0,isEditable:!1,isSortable:!0,resize:{columns:!0},headersDimensions:{height:26},selection:{unselectAllOnEmptyArea:!0,toggle:!1,canMultiSelect:!0,enableListSelection:!0,renderingMode:"adaptive"},performances:{buildLinks:!1,enableColumnVirtualization:!0,useRequestAnimationFrameRendering:!0,preloadPool:!0},enableExpandOnDoubleClick:!0,placeholder:O.placeholder.emptyRelatedDatagridView,columns:[{text:O.resolveIssues.common,description:O.resolveIssues.propagate,dataIndex:"common",visibleFlag:!1,width:20,isDraggable:!0,ds6wIndexMapping:"ds6w:common",isOOTBColumn:!0,icon:"propagate"},{text:O.resolveIssues.label,dataIndex:"tree",alwaysVisibleFlag:!0,ds6wIndexMapping:"ds6w:label",width:200,isOOTBColumn:!0,isDraggable:!0},{text:O.create.related.treelist.occurrence,dataIndex:"occurrence",width:"auto",ds6wIndexMapping:"ds6w:occurrence",visibleFlag:!1,isOOTBColumn:!0,isDraggable:!0},{text:O.resolveIssues.type,dataIndex:"typeNLS",ds6wIndexMapping:"ds6w:type",width:150,isOOTBColumn:!0,isDraggable:!0},{text:O.resolveIssues.name,dataIndex:"name",ds6wIndexMapping:"ds6w:name",width:200,isOOTBColumn:!0,isDraggable:!0},{text:O.resolveIssues.revision,dataIndex:"revision",ds6wIndexMapping:"ds6w:revision",width:150,isDraggable:!0,className:"revisionPopup",isOOTBColumn:!0,typeRepresentation:"url"},{text:O.resolveIssues.state,dataIndex:"dispState",ds6wIndexMapping:"ds6w:status",width:150,isDraggable:!0,typeRepresentation:"tag",isOOTBColumn:!0,className:"lc-maturity-state"},{text:O.resolveIssues.isLastRevision,dataIndex:"isLastRevision",ds6wIndexMapping:"ds6w:isLastRevision",width:150,isOOTBColumn:!0,isDraggable:!0},{text:O.columns.actionsColumn,width:50,isOOTBColumn:!0,dataIndex:"ContextualMenuColumn"}]}},callbacks:{onModifyGrid:null},destroy:function(){this.dgView&&(this.dgView=null)},init:function(e,t,s,i){var a=this;f.start(a.name+" init"),a._logger=o.getLogger("DS/IssueCommon/components/IssueContextsDatagridView"),a.relatedObjects=[],a.parentView=s,a._deferred={resolve:null,reject:null},a.dgView=null,a.tooltips=[],a.timestampLastRefresh=null,a.container=e,a._dnd=i,a.custom_view_options={dgvHandle:null,ootb_columns:[],dgvDiv:null,settings:{url:v.get3DSpaceUrl(),securityContext:v.getSecurityContexts().securityContext,isNative:C.get("isNatifEnvironnement")}},a.treeDocument=new d({useAsyncPreExpand:!0,shouldAcceptDrag:function(e){return 1!=e.options.grid.isCategory},shouldBeSelected:function(e){return 1!=e.options.grid.isCategory}}),a._customizeColumnRendering(a.defaultOptions.grid.columns);C.get("widget")||window.widget;a.defaultOptions.grid.identifier="ISUContentsView";var r=a.defaultOptions.grid;a.dgView=new m(r),a.dgView.treeDocument=a.treeDocument,a.dgView.custom_view_options=a.custom_view_options,a.dgView.inject(e),a.container.addClassName("issue-tree-list-view"),I.buildCustomViewOptions(a.dgView,a.container),I.registerCustomEventsOnDGV(a.dgView),a.dgView.getCustomViewsManager().onCustomViewsSave=function(e,t){I.applyCustomAttributes(e,t,a.custom_view_options)},a.dgView.getCellTooltip=function(e){return a.dgView.getCellDefaultTooltip(e)},a.dgView.onContextualEvent=function(t){if(t&&t.cellInfos){var s=t.cellInfos;if(-1===s.rowID&&t.collectionView){var i=document.getElementsByClassName("issue-relatedContent-dropzones dropzone-flex");return i.length>0&&(a._dnd.count=0,i[0].hide(),e&&a.container.setStyle("opacity",1)),t.collectionView.buildDefaultContextualMenu(t,{pin:!1,firstColumnsVisibility:!1,columnsManagement:!1,sizeColumnToFit:!0})}if(s.nodeModel.options.grid.isCategory)return!1;if(s.nodeModel){var o,r=a._getTreeDocument().getSelectedNodes();r.length>1?(o=r,a._removeCategoryRootsFromSelection(o)):s.nodeModel&&(a.dgView.unselectAll(),s.nodeModel.select(),o=[s.nodeModel]);var l="blank";return o&&o.length>0&&(l="children"),a.getContextualMenu({type:l,models:o||[]})}return n.resolve()}return n.resolve()},a.dgView.onDragStartCell=function(e,t){var s=a._getTreeDocument().getSelectedNodes();if(0===s.length)return!1;var n=I.setDroppableData(s),i={type:n.type,data:JSON.stringify(n.data)},o=n.data.data.items.length;return e.dataTransfer.setData(i.type,i.data),a._ghost&&(a._ghost.destroy(),a._ghost=null),a._ghost=I.createGhostDrag(t.nodeModel.options,o),document.body.appendChild(a._ghost),e.dataTransfer.setDragImage(a._ghost,e.offsetX,e.offsetY),!0},c.subscribe("Lifecycle.Modification",function(e){var t=JSON.parse(e).Refresh.modified;if(Array.isArray(t)){var s=t.filter(function(e){return null!=e.policy}).map(function(e){return e});s.length>0&&a.updateObjectNode(s)}})},updateObjectNode:function(t){var s=this.dgView.getTreeDocument().getSelectedNodes(),n=[];t.forEach(e=>{null!=e.policy&&(e.maturity=e.policy+"."+e.state,n.push(e.maturity))});var i={"ds6w:status":n};g.getNLSValuesPromise(i).then(i=>{if(e.is(i["ds6w:status"])){var o=Object.values(i["ds6w:status"])[0],a=n[0];s.filter(e=>t.some(t=>e.options.pid.includes(t.physicalid))).forEach(e=>{e.updateOptions({state:a,grid:{dispState:o}})})}})},_removeCategoryRoots:function(){this.dgView.getTreeDocument().removeRoots()},_getCategoryRoots:function(){return this.dgView.getTreeDocument().getRoots()},_getCategoryRoot:function(e){return this._getCategoryRoots().filter(t=>{if(t.options.grid.Name===e&&1==t.options.grid.isCategory)return t})[0]},_getTreeDocument:function(){return this.dgView.getTreeDocument()},_customizeColumnRendering:function(e){var t=this;e.forEach(function(e){switch(e.dataIndex){case"tree":break;case"common":e.onCellRequest=t.rendering.common.bind(t);break;case"isLastRevision":e.onCellRequest=t.rendering.isLastRevision.bind(t);break;case"revision":e.onCellRequest=t.rendering.revision.bind(t);break;case"ContextualMenuColumn":e.hasCellValue=t.rendering.contextualMenuColumn.bind(t);break;case"dispState":e.getCellClassName=t.styling.state.bind(t)}})},rendering:{common:function(t){f.start(this.name+" rendering common");var s="",n=null;let i="";if(t.nodeModel.options.grid.isCategory)n=e.createElement("span",{}),t.cellView.setReusableContent(n);else{var o=t.nodeModel.options.common;n=e.createElement("span",{class:"clickable-column",html:e.createElement("span",{class:s})}),o||(s="wux-ui-3ds wux-ui-3ds-propagate wux-ui-3ds-lg related-propagate",n.addContent(e.createElement("span",{class:s})),i=O.resolveIssues.tooltips.propagateTooltip,n.addEventListener("click",function(){let e=t.nodeModel.getParent().options.grid.Name;this.propagate&&this.propagate([t.nodeModel],e)}.bind(this))),t.cellView.setReusableContent(n)}n&&(n.tooltipInfos=new p({shortHelp:i,mouseRelativePosition:!1,position:"bottom"})),f.end(this.name+" rendering common")},isLastRevision:function(t){f.start(this.name+" rendering isLastRevision");var s="";let n="";""!=t.nodeModel.options.type&&""!=t.nodeModel.options.revision&&null!=t.nodeModel.options.revision&&null!=t.nodeModel.options.isLastRevision&&null!=t.nodeModel.options.isLastRevision?1==t.nodeModel.options.isLastRevision?(s=e.createElement("div",{class:"isLastRevisionTrue wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check"}),n=O.resolveIssues.tooltips.isLastRevision,t.cellView.setReusableContent(s)):0==t.nodeModel.options.isLastRevision&&(s=e.createElement("div",{class:"isLastRevisionFalse wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong"}),n=O.resolveIssues.tooltips.isNotLastRevision,t.cellView.setReusableContent(s)):(s=e.createElement("div",{}),n="",t.cellView.setReusableContent(s)),s.tooltipInfos=new p({shortHelp:n,mouseRelativePosition:!1,position:"bottom"}),f.end(this.name+" rendering isLastRevision")},revision:function(t){var s="";s=e.createElement("div",{html:t.nodeModel.options.revision,class:"revisionColumn"}),null!=t.nodeModel.options.revision&&""!=t.nodeModel.options.revision&&"-"!=t.nodeModel.options.revision&&s.addEventListener("click",function(){E.showRevisionModal(t)}.bind(this)),t.cellView.setReusableContent(s)},contextualMenuColumn:function(e){let t=!0;return t=!e.nodeModel.options.grid.isCategory}},styling:{state:function(e){if(e.nodeModel&&e.nodeModel.options.state){var t,s;return(t=e.nodeModel.options.state)&&(s=this.styling.getAndCreateMaturityClass(t,"wux-controls-label")),s}},getAndCreateMaturityClass:function(e,t){return"lc-status-"+this.cleanStatusForCSS(e)+(t?"-withClass":"")},cleanStatusForCSS:function(e){return e.replace(/(\.| )/g,"-")}},load:function(e){var t=this;return f.start(t.name+" load"),new n((s,i)=>{t.isLoaded=new n(function(e,s){t._deferred.resolve=e,t._deferred.reject=s}),t.issues=e;for(let e=t.dgView.columns.length-1;e>=0;e--)t.dgView.columns[e].isOOTBColumn||t.dgView.columns.splice(e,1);1===e.length?(t.dgView.layout.setColumnVisibleFlag("common",!1),t.dgView.multiIssuesSelected=!1):e.length>1&&(t.dgView.layout.setColumnVisibleFlag("common",!0),t.dgView.multiIssuesSelected=!0),t._removeCategoryRoots();var o=t.computeRelatedObjectsCommon(N.CATEGORIES[0].CATEGORY_NAME),a=t.computeRelatedObjectsCommon(N.CATEGORIES[1].CATEGORY_NAME),r=t.computeRelatedObjectsCommon(N.CATEGORIES[2].CATEGORY_NAME),l=t.computeRelatedObjectsCommon(N.CATEGORIES[3].CATEGORY_NAME);let c=[];c.push(o),c.push(a),c.push(r),c.push(l);var d=0;if(t.timestampLastRefresh=null,o.length||a.length||r.length||l.length){t._createCategoryRoots();const e=[];for(let s=0;s<c.length;s++){let n=t.fetchRelatedObjects(c[s],!1);e.push(n),n.then(function(e){t.dgView.getTreeDocument().withTransactionUpdate(function(){d+=e.length,t.timestampLastRefresh=Math.floor(Date.now());let n=t._getCategoryRoots()[s].options.grid.Name,i=t._getCategoryRoots()[s];for(let s=0;s<e.length;s++){let o=e[s];t.relatedObjects[n].objects[o.options.id]&&(o.options.common=t.relatedObjects[n].objects[o.options.id].common),i.addChild(o),t._refreshItemCount(i,n),t.relatedObjects[n].objects[o.options.id].model=o}e.length&&i.expandAll()},function(){t._logger.error('An error occurred during "%s"',"load")})})}n.all(e).then((e,n)=>{null!=C.get("information")&&C.get("information").customModelEvents.publish({event:"im-update-tab-count",data:{tabs:["relatedObjects"],count:[d]}}),t._deferred.resolve(),s()})}else t._deferred.resolve(),s()})},_createCategoryRoots:function(){let e=N.CATEGORIES;for(let s=0;s<e.length;s++){var t=new u({label:e[s].CATEGORY_LABEL+" (0)",icons:[{iconName:e[s].CATEGORY_ICON}],grid:{isCategory:!0,Name:e[s].CATEGORY_NAME}});this.dgView.getTreeDocument().addRoot(t)}},updateRelatedObjectsCommon:function(e,t){var s=this;e.forEach(function(e){e.options.common=s.relatedObjects[t].objects[e.options.id].common})},computeRelatedObjectsCommon:function(e){var t=this,s=[];return t.issues.forEach(function(n){for(var i=t.utils.getRelatedObjects(n,e),o=0;o<i.length;o++){var a=i[o];void 0===s.find(e=>e.id==a.id)&&s.push(a)}}),t.relatedObjects[e]={},t.relatedObjects[e].objects={},s.forEach(function(s){for(var n=!0,i=0;i<t.issues.length;i++){var o=t.utils.getRelatedObjects(t.issues[i],e);if(o&&void 0===o.find(e=>e.id==s.id)){n=!1;break}}t.relatedObjects[e].objects[s.id]={},t.relatedObjects[e].objects[s.id].common=n}),s},fetch:function(e){var t=this;return f.start(t.name+" fetch"),new n(function(s,n){0!==e.length?g.fetch({data:{objects:e.map(function(e){return{physicalId:e}})},onComplete:function(i){var o=i.body;t._logger.log("fetch :Success..."),f.end(t.name+" fetch"),o.results&&o.results.length===e.length?s(o.results):o.results&&o.results.length>0?(D.displayNotification({msg:O.resolveIssues.errorFetch,eventID:"error"}),s(o.results)):(t._logger.error("fetch :Failure... Not indexed."),n(new Error("fetch :Failure... Not indexed.")))},onFailure:function(e){t._logger.error("fetch :Failure..."),t._logger.error(e),f.end(t.name+" fetch"),n(new Error("fetch :Failure..."))}}):s([])})},fetchRelatedObjects:function(e){for(var t=[],s=0;s<e.length;s++)for(var i=e[s].id.split(","),o=0;o<i.length;o++)0!=o&&o%2!=1&&o!=i.length-1||t.push(i[o]);var a=[...e];t=[...new Set(t)];var l=this;return new n(function(s){var n=[];r.mask(l.container),l.fetch(t).then(function(t){for(var i={},o=[],c=0;c<t.length;c++){var d=h.parseFetchResponse(t[c]);i[d.value.id]=d}for(var m=0;m<a.length;m++){var p=e[m].id.split(","),f=p[p.length-1];if(i[f]){var g=i[f],v="";p.length>0&&(v=i[p[p.length-1]].display.title);for(var b="",C=0;C<p.length;C++)i[p[C]]&&C!=p.length-1&&(b+=i[p[C]].display.title,C!=p.length-2&&(b+=" \\ "));g.value["ds6w:policy"]&&o.push(g.value["ds6w:policy"]);var y="3dspace"===e[m].serviceId.toLowerCase()?"LEGACY_3DSPACE":"CSD",I=new u({id:e[m].id,pid:g.value.physicalId,name:g.value.name?g.value.name:"",title:v,type:g.value.type,dispTypeValue:g.display.type,revision:g.value.revision,label:v,icons:[g.value.typeIcon],isLastRevision:g.value.isLastRevision,common:!0,state:g.value.state,serviceId:e[m].serviceId,elementType:y,kind:g.value["ds6w:kind"],grid:{name:g.display.name?g.display.name:"",type:g.value.type,typeNLS:g.display.type,revision:g.display.revision,dispState:g.display.state,id:f,interfaces:g.value.interface,occurrence:b,sourceType:y}});n.push(I)}}o.length>0&&(o=[...new Set(o)],l.setClassContentType({policies:o})),r.unmask(l.container),s(n)},function(){D.displayNotification({msg:O.resolveIssues.errorFetch,eventID:"error"}),r.unmask(l.container),l._deferred.reject()})})},addObjects:function(e,t,s){var n=this;f.start(n.name+" addObjects");var i=[].concat(e);i&&i.length&&i.forEach(function(e){for(var t=0,s=0;s<i.length;s++){e===i[s]&&t++,t>1&&(i.splice(s,1),s--,n._logger.log("remove the same id from object-id list"))}}),n.addRelatedObjects(i,t,s),f.end(n.name+" addObjects")},addRelatedObjects:function(e,t,s){var n=this,i=[],o=[],a=!1;if(t!=N.CATEGORY_REPORTED_AGAINST)for(var r=0;r<e.length;r++){var l=e[r].id.split(",");e[r].id=l[l.length-1]}for(var c=function(e,t){for(var s=[].concat(t),n=0;n<e.length;n++)for(var i=e[n],o=0;o<s.length;o++)if(i.id===s[o].id){s.splice(o,1);break}return s},d=0;d<n.issues.length;d++){var u={physicalId:n.issues[d].id};u[t]={};var m=[].concat(e);if(t==N.CATEGORY_RESOLVED_BY){var p=m.map(function(e){return e.id}).indexOf(u.physicalId);if(p>-1&&m.splice(p,1),0==m.length){a=!0,D.displayNotification({msg:O.resolveIssues.errorSameIssue,eventID:"error"});continue}e=m}if((m=c(n.utils.getRelatedObjects(n.issues[d],t),m)).length>0){u[t]=m.map(function(e){var t=[];e.id.contains(",")?t=e.id.split(","):t.push(e.id);var n={physicalId:t[t.length-1],path:t,envId:v.getTenant(),serviceId:e.serviceId,objectType:e.objectType};if(s)for(var i=0;i<s.length;i++)s[i].id===e.id&&(n.position=s[i],n.position.id=t[t.length-1]);return n}),i.push(u);var f={id:n.issues[d].id,issue:n.issues[d]};o.push(f)}}if(i.length>0){var h=n.timestampLastRefresh;n.updateIssues(i).then(function(s){n.fetchRelatedObjects(e,!0).then(function(e){n.timestampLastRefresh===h&&(0==n._getCategoryRoots().length&&n._createCategoryRoots(),n.dgView.getTreeDocument().withTransactionUpdate(function(){let i=n._getCategoryRoot(s.category),o=i.getChildren();var a=[],r=[],l="",c="";s.result.forEach(t=>{t.body&&t.body.responce&&t.body.responce.forEach(t=>{t.warning.length>2?(e=e.filter(e=>!(e.options.id==t.physicalId.slice(1,-1))),a.push(t.warning.slice(1,-1))):t.error.length>2&&(e=e.filter(e=>!(e.options.id==t.physicalId.slice(1,-1))),r.push(t.error.slice(1,-1)))})});for(let a=0;a<e.length;a++){let r=e[a],l=-1;n.relatedObjects[s.category].objects[r.options.id]&&n.relatedObjects[s.category].objects[r.options.id].model&&(l=o.indexOf(n.relatedObjects[s.category].objects[r.options.id].model)),-1!==l?(o.splice(l,1),n._getCategoryRoot(t).addChild(r,l)):(i.addChild(r,0),n._refreshItemCount(i,s.category)),n.relatedObjects[s.category].objects[r.options.id]={},n.relatedObjects[s.category].objects[r.options.id].model=r,n.relatedObjects[s.category].objects[r.options.id].common=!0;for(var d=0;d<n.issues.length;d++){var u=n.utils.getRelatedObjects(n.issues[d],s.category);-1===u.indexOf(r.options.id)&&u.push({id:r.options.id,serviceId:r.options.serviceId})}}e.length&&i.expandAll(),a=new Set(a),r=new Set(r),a.forEach(e=>{l+=e}),r.forEach(e=>{c+=e}),l.length>0&&0==e.length?D.displayNotification({msg:l,eventID:"warning"}):c.length>0&&0==e.length?D.displayNotification({msg:c,eventID:"error"}):(l.length>0||c.length>0)&&e.length>0?1==n.issues.length?D.displayNotification({msg:O.successPartial,eventID:"warning"}):D.displayNotification({msg:O.replace(O.resolveIssues.attachSuccessMultiple[s.category],{count:e.length}),eventID:"success"}):1==n.issues.length?D.displayNotification({msg:O.replace(O.resolveIssues.attachSuccess[s.category],{count:e.length,issue:n.issues[0].title+" ("+n.issues[0].name+")"}),eventID:"success"}):D.displayNotification({msg:O.replace(O.resolveIssues.attachSuccessMultiple[s.category],{count:e.length}),eventID:"success"})},function(){n._logger.error('An error occurred during "%s"',"add child")}),n.dispatchEvent("onUpdate",{issues:o,relation:s.category}))})},function(){})}else a||D.displayNotification({msg:O.resolveIssues.nothingToAdd,eventID:"info"})},updateIssues:function(t,s){var i=this;if(f.start(i.name+" updateIssues"),Array.isArray(t[0].reportedAgainst))for(var o=0;o<t[0].reportedAgainst.length;o++)if(!("path"in t[0].reportedAgainst[o])){var a=t[0].reportedAgainst[o].physicalId,l=(a=a.split(","))[a.length-1];t[0].reportedAgainst[o].physicalId=l+"",t[0].reportedAgainst[o].path=a}return new n(function(n,o){r.mask(i.container);var a=s?"delete":"update";g.related[a]({data:{objects:t},onComplete:function(e){r.unmask(i.container);var s={};let o="";Object.keys(t[0]).includes(N.CATEGORY_REPORTED_AGAINST)?o=N.CATEGORY_REPORTED_AGAINST:Object.keys(t[0]).includes(N.CATEGORY_RESOLVED_BY)?o=N.CATEGORY_RESOLVED_BY:Object.keys(t[0]).includes(N.CATEGORY_RESOLVED_ITEMS)?o=N.CATEGORY_RESOLVED_ITEMS:Object.keys(t[0]).includes(N.CATEGORY_CONTEXTS)&&(o=N.CATEGORY_CONTEXTS),s.result=e.results,s.category=o,i.dispatchEvent("onUpdateComplete"),n(s)},onFailure:function(t){i._logger.error(t),e.is(t.error)&&e.is(t.error.internal)&&"'business object' does not exist"==t.error.internal?E.displayErrorMessage(E.getErrorMessage("0"),"error"):e.is(t.error)&&e.is(t.error.internal)&&t.error.internal.includes("ErrorCode:2005")?E.displayErrorMessage(E.getErrorMessage("2005"),"error"):e.is(t.error)&&e.is(t.error.internal)&&(t.error.internal.includes("No fromdisconnect access to object")||t.error.internal.includes("User should be Owner or Co-owner or Assignee for this operation")||t.error.internal.includes("If the issue is open, your responsibility does not permit you to add Reported Against, Contexts or Resolved by. If the issue is closed, related objects or contexts cannot be added"))?E.displayErrorMessage(E.getErrorMessage("10"),"error"):D.displayNotification({msg:t.error.message,eventID:"error"}),r.unmask(i.container),i.dispatchEvent("onUpdateFailure"),i.parentView&&i.parentView.refresh(),o(new Error("Failed to update issues..."))}})})},_refreshItemCount:function(e,t){let s=null!==e.getChildren()?e.getChildren().length:0;e.setLabel(N.CATEGORY_NLS[t]+" ("+s+")")},getContextualMenu:function(e){var t=this;f.start(t.name+" getContextualMenu");var s=[],i=e.models,o=null,a=null,r=null,l=null,c=null,d=null,u=null,m=null,p=null,h=new n(function(e){o={name:"Remove",title:O.resolveIssues.contextualMenus.remove,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove"},data:i,action:{callback:function(e){t.dgView.getTreeDocument().withTransactionUpdate(function(){let s=t.extractCategoryObjects(e.context);t.removeRelatedObjects(s)},function(){t._logger.error('An error occurred during "%s"',"removeCommand")})},context:i}},a={title:O.resolveIssues.contextualMenus.propagate,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-propagate"},data:i,action:{callback:function(e){t.propagate(e.context)},context:i}},r={name:"Maturity State",title:O.resolveIssues.contextualMenus.maturity,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-collaborative-lifecycle-management"},data:i,action:{callback:function(e){require(["DS/IssueComponents/external/CollaborativeLifecycle"],function(t){for(var s=[],n=e.context,i=0;i<n.length;i++)s.push(n[i].options.pid);t.execute(s);try{var o=C.get("component").getCurrentView();E.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:o,pd3:"ContentActions",pd4:"Maturity",pd5:"Issue/"+o+"/ContentActions/Maturity"}})}catch(e){}})},context:i}},l={name:"Compare",title:O.resolveIssues.contextualMenus.compare,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-compare-on"},data:i,action:{callback:function(e){require(["DS/IssueComponents/external/Compare"],function(t){for(var s=[],n=e.context,i=0;i<n.length;i++)s.push({physicalId:n[i].options.pid,type:n[i].options.type});t.execute(s);try{var o=C.get("component").getCurrentView();E.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:o,pd3:"ContentActions",pd4:"Compare",pd5:"Issue/"+o+"/ContentActions/Compare"}})}catch(e){}})},context:i}},c={name:"WhereUsed",title:O.resolveIssues.contextualMenus.relationalExplorer,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-object-related"},data:i,action:{callback:function(e){require(["DS/IssueComponents/external/RelationalExplorer"],function(t){for(var s=[],n=e.context,i=0;i<n.length;i++)s.push({id:n[i].options.pid,serviceId:n[i].options.serviceId});t.execute(s);try{var o=C.get("component").getCurrentView();E.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:o,pd3:"ContentActions",pd4:"Relations",pd5:"Issue/"+o+"/ContentActions/Relations"}})}catch(e){}})},context:i}},d={name:"ReplaceByLatestRevision",title:O.resolveIssues.contextualMenus.replaceByLatestRevision,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-step-3"},data:i,action:{callback:function(e){let s=t.extractCategoryObjects(e.context);t.replaceByRevision(s,N.REVISION_TARGETS.LATEST);try{var n=C.get("component").getCurrentView();E.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:n,pd3:"ContentActions",pd4:"ReplaceByLatestRevision",pd5:"Issue/"+n+"/ContentActions/ReplaceByLatestRevision"}})}catch(e){}},context:i}},u={name:"ReplaceByReleasedLatestRevision",title:O.resolveIssues.contextualMenus.replaceByReleasedLatestRevision,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-step-1"},data:i,action:{callback:function(e){let s=t.extractCategoryObjects(e.context);t.replaceByRevision(s,N.REVISION_TARGETS.RELEASE_LATEST);try{var n=C.get("component").getCurrentView();E.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:n,pd3:"ContentActions",pd4:"ReplaceByReleasedLatestRevision",pd5:"Issue/"+n+"/ContentActions/ReplaceByReleasedLatestRevision"}})}catch(e){}},context:i}},m={name:"ReplaceByStableLatestRevision",title:O.resolveIssues.contextualMenus.replaceByStableLatestRevision,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-step-2"},data:i,action:{callback:function(e){let s=t.extractCategoryObjects(e.context);t.replaceByRevision(s,N.REVISION_TARGETS.STABLE_LATEST);try{var n=C.get("component").getCurrentView();E.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:n,pd3:"ContentActions",pd4:"ReplaceByStableLatestRevision",pd5:"Issue/"+n+"/ContentActions/ReplaceByStableLatestRevision"}})}catch(e){}},context:i}},p={name:"information",title:O.resolveIssues.contextualMenus.information,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-info-open-in-a-new-window"},data:null,action:{callback:function(){E.viewProperties(i[0].options.pid,i[0].options.serviceId);try{var e=C.get("component").getCurrentView();E.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"ContentActions",pd4:"Information",pd5:"Issue/"+e+"/ContentActions/Information"}})}catch(e){}}}},e()});if(1===i.length&&"Document"===i[0].options.type){var g=null,v=null,y=null,I=null,w=null;h=h.then(function(){return b.getDocuments([i[0].options.id]).then(function(e){g=e.data[0]})}).then(function(){var e={data:g,from:"related"},s=[];s.push(i[0].options);var n={data:g,from:"related",menu:t,selected:s};v={name:"Preview",title:O.resolveIssues.contextualMenus.preview,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-eye"},data:null,action:{callback:function(){S.preview(n)}}},""===g.relateddata.files[0].dataelements.locker?y={name:"Edit",title:O.resolveIssues.contextualMenus.edit,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-pencil"},data:null,action:{callback:function(){S.edit(e)}}}:(I={name:"UndoEdit",title:O.resolveIssues.contextualMenus.undoEdit,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-undo"},data:null,action:{callback:function(){S.undoEdit(e)}}},w={name:"Update",title:O.resolveIssues.contextualMenus.update,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-upload"},data:null,action:{callback:function(){S.update(e)}}})})}if(i.every(e=>"Document"==e.options.type)){for(var T=null,D=[],A=0;A<i.length;A++)D.push(i[A].options);var _={from:"related",menu:t,selected:D};T={name:"Download",title:O.resolveIssues.contextualMenus.download,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-download"},data:null,action:{callback:function(){S.download(_)}}}}return h=h.then(function(){return t._getOpenWithMenu(e).then(function(n){if(s=s.concat(n),"children"===e.type){if(s.push({type:"SeparatorItem"}),1===e.models.length&&"Document"===e.models[0].options.type&&(v&&(s.push(v),s.push({type:"SeparatorItem"})),null!==y&&s.push(y),null!==I&&s.push(I),null!==w&&s.push(w)),e.models[0].options.type!==N.ISSUE_TYPE){var h=[],g={name:"ReplaceByRevision",type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-replace-by-existing"},title:O.resolveIssues.contextualMenus.replaceByRevision,submenu:h};h.push(u),h.push(m),h.push(d),s.push(g)}s.push({type:"SeparatorItem"}),s.push(r),e.models.length<=2&&s.push(l),s.push({type:"SeparatorItem"}),e.models.every(e=>"Document"==e.options.type)&&null!==T&&s.push(T),s.push(c),1===i.length&&s.push(p),s.push(o);for(var b=0;b<e.models.length;b++)if(!e.models[b].options.common){s.push(a);break}}return f.end(t.name+" getContextualMenu"),s})})},_getOpenWithMenu:function(t){try{C.get("component").getCurrentView()}catch(e){}finally{f.start(name+" getMenu");var s=[],i=t.models||[];return 0===i.length||"blank"===t.type?n.resolve([]):new n(function(t){f.start(name+" getOpenWithMenu");var n=[],o=[],a=[N.ISSUE_TYPE];g.type.getSubType().then(r=>{var l=r;null!=l&&Object.keys(l).length>1&&(a=Object.keys(l));for(var c=0;c<i.length;c++){var d=i[c],u=[];u.push(d.options.type),d.options.kind&&""!=d.options.kind&&u.push(d.options.kind),a.includes(d.options.type)||(o.push(d.options.type),n.push({envId:v.getTenant(),serviceId:"3DSpace",objectId:d.options.pid,objectType:d.options.type,objectTaxonomies:u,displayName:d.options.title?d.options.title:d.options.name})),a.includes(d.options.type)&&(d.options.children?d.options.children.forEach(function(e){var t=[];t.push(e.options.type),e.options.kind&&""!=e.options.kind&&t.push(e.options.kind),o.push(e.options.type),n.push({envId:v.getTenant(),serviceId:"3DSpace",objectId:e.options.pid,objectType:e.options.type,objectTaxonomies:t,displayName:e.options.title?e.options.title:e.options.name})}):(o.push(d.options.type),n.push({envId:v.getTenant(),serviceId:"3DSpace",objectId:d.options.id,objectType:d.options.type,objectTaxonomies:u,displayName:d.options.title?d.options.title:d.options.name})))}g.getTypesHierarchy({types:o,onComplete:function(i){if(e.is(i.types_hierarchies,"array")&&i.types_hierarchies.forEach(function(e,t){n.forEach(function(t,s){t.objectTaxonomies[0]===e.type&&(t.objectTaxonomies=t.objectTaxonomies.concat(e.hierarchy))})}),0===n.length)return f.end(name+" getOpenWithMenu"),void t(s);var o=C.get("widget")||window.widget;y.getOpenWith().set3DXContent({protocol:"3DXContent",version:"1.1",source:o.name,widgetId:o.id,data:{items:n}},!0).retrieveCompatibleApps(function(e){if(e&&e.length>0){var n=[],i=[];if(e.forEach(function(e){i={name:e.text.replace(/ /g,""),type:"PushItem",title:e.text,action:{callback:e.handler}},null!=e.fonticon?i.fonticon={content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon}:e.className&&1==e.className.contains("app-widget")?i.icon={iconPath:e.icon,className:"issue-widget"}:i.icon=e.icon,n.push(i)}),n.length>0){var o={name:"OpenWith",type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-open-menu-dot"},title:O.resolveIssues.contextualMenus.openWith,submenu:n};s.push(o),s.push({type:"SeparatorItem"})}}t(s)}),f.end(name+" getOpenWithMenu")},onFailure:function(e){t(s)}})}).catch(()=>{})})}},extractCategoryObjects:function(e){let t=[],s=[],n=[],i=[];for(let o=0;o<e.length;o++)if(!e[o].options.grid.isCategory){switch(e[o].getParent().options.grid.Name){case N.CATEGORY_REPORTED_AGAINST:t.push(e[o]);break;case N.CATEGORY_RESOLVED_BY:s.push(e[o]);break;case N.CATEGORY_RESOLVED_ITEMS:n.push(e[o]);break;case N.CATEGORY_CONTEXTS:i.push(e[o])}}let o=[];return t.length&&o.push({category:N.CATEGORY_REPORTED_AGAINST,objs:t}),s.length&&o.push({category:N.CATEGORY_RESOLVED_BY,objs:s}),n.length&&o.push({category:N.CATEGORY_RESOLVED_ITEMS,objs:n}),i.length&&o.push({category:N.CATEGORY_CONTEXTS,objs:i}),o},removeRelatedObjects:function(e){for(var t=this,s=[],n=[],i=function(e,t){for(var s=[].concat(t),n=0;n<s.length;n++){var i=s[n];-1===e.map(function(e){return e.id}).indexOf(i)&&(s.splice(n,1),n--)}return s},o=0;o<t.issues.length;o++)for(let c=0;c<e.length;c++){var a={physicalId:t.issues[o].id};let d=e[c].category,u=e[c].objs,m=[];u.forEach(function(e){m.push(e.options.id)}),a[d]={};var r=[].concat(m);(r=i(t.utils.getRelatedObjects(t.issues[o],d),r)).length>0&&(a[d]=r.map(function(e){return{physicalId:e}})),s.push(a);var l={id:t.issues[o].id,issue:t.issues[o]};n.push(l)}if(s.length>0){var c=t.timestampLastRefresh;t.confirmDetach(e).then(function(){for(let i=0;i<s.length;i++)t.updateIssues([s[i]],!0).then(function(s){var i=s.category;t.timestampLastRefresh===c&&(t.dgView.getTreeDocument().withTransactionUpdate(function(){let s=[];for(let t=0;t<e.length;t++)e[t].category==i&&(s=e[t].objs);for(var n=0;n<s.length;n++){var o=s[n];o.remove(),t.relatedObjects[i].objects[o.options.id]=null,delete t.relatedObjects[i].objects[o.options.id];for(var a=0;a<t.issues.length;a++){var r=t.utils.getRelatedObjects(t.issues[a],i),l=r.map(function(e){return e.id}).indexOf(o.options.id);l>-1&&r.splice(l,1)}let e=t._getCategoryRoot(i);t._refreshItemCount(e,i)}D.displayNotification({msg:O.resolveIssues.successResolved,eventID:"success"})},function(){t._logger.error('An error occurred during "%s"',"remove child")}),t.dispatchEvent("onUpdate",{issues:n}))},function(){t._logger.error('An error occurred during "%s"',"remove child in withTransactionUpdate")})},function(){t._logger.log('User cancel the operation. "%s"',"Detach related objects")})}},_removeCategoryRootsFromSelection:function(e){for(let t=0;t<e.length;t++)e[t].options.grid.isCategory&&(e.splice(t,1),t--)},confirmDetach:function(e){for(var t=[],s=0;s<e.length;s++){e[s].objs.forEach(function(e){var s=e.options.title;s=e.options.name?s+" ("+e.options.name+")":s,t.push(s)})}return this._showConfirm(t,O.resolveIssues.confirmDialog.confirmDetach,O.resolveIssues.confirmDialog.detachTitle)},_showConfirm:function(t,s,i){var o=this,r=C.get("widget")||window.widget,c=t,d=[];c.forEach(function(t){d.push(e.createElement("li",{html:t,title:t}))});var u=e.createElement("div",{html:[s,e.createElement("ul",{class:"related-confirm-dialog-ul",html:d})]}),m=O.replace(i,{number:c.length,issues:o.issues.length});return new n(function(e,t){var s,n=o.dialog=new T({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"related-confirm-dialog",title:m,header:null,body:u,footer:[s=new a({value:O.resolveIssues.okButton,className:"primary related-confirm-dialog-ok",events:{onClick:function(){n.destroy(),o.dialog=null,e()}}}),new a({value:O.resolveIssues.cancel,className:"default related-confirm-dialog-cancel",events:{onClick:function(){n.destroy(),o.dialog=null,t(new Error("The dialog has been closed by the end user"))}}})],events:{onClose:function(){n.destroy(),o.dialog=null,t(new Error("The dialog has been closed by the end user"))}}}).inject(r.body);new l({element:u}).inject(n.getBody()),n.show(),s.focus()})},propagate:function(e,t){var s=this;s.confirmPropagate(e,t).then(function(){s.extractCategoryObjects(e).forEach(e=>{for(var t=[],n=0;n<e.objs.length;n++)t.push({id:e.objs[n].options.id,serviceId:e.objs[n].options.serviceId,objectType:e.objs[n].options.type});s.addRelatedObjects(t,e.category);try{var i="";N.CATEGORY_REPORTED_AGAINST===e.category&&(i="PropogateAffectedItems"),N.CATEGORY_RESOLVED_BY===e.category&&(i="PropogateResolvedBy"),N.CATEGORY_CONTEXTS===e.category&&(i="PropogateContexts"),N.CATEGORY_RESOLVED_ITEMS===e.category&&(i="PropogateResolvedItems");var o=C.get("component").getCurrentView();E.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:o,pd3:"ContentActions",pd4:i,pd5:"Issue/"+o+"/ContentActions/"+i}})}catch(e){}})},function(){s._logger.log('User cancel the operation. "%s"',"Propagate related objects")})},confirmPropagate:function(e,t){for(var s=[],n=0;n<e.length;n++){var i=e[n],o=i.options.title;o=i.options.name?o+" ("+i.options.name+")":o,s.push(o)}return this._showConfirm(s,O.resolveIssues.confirmDialog.confirmPropagate,O.resolveIssues.confirmDialog.propagateTitle)},replaceByRevision:function(e,t){var s=this;let n=[],i=[];e.forEach(e=>{n.indexOf(e.category)&&n.push(e.category),i.push(...e.objs)}),s.getRevisions(i).then(function(i){var o=[],a=[];i.forEach(function(e){(e.targetModel.getParent().options.grid.isCategory&&(e.category=e.targetModel.getParent().options.grid.Name),null!==e[t])&&((e[t].contents?e[t].contents[0].id:e[t].id)!==e.pid&&(o.push(e),a.push(e)))});var r={issuesToAdd:[],issuesToRemove:[]},l=[],c=[];for(let n=0;n<s.issues.length;n++)for(let i=0;i<e.length;i++){let a=e[i].category;var d={physicalId:s.issues[n].id};d[a]=[];var u={physicalId:s.issues[n].id};if(u[a]=[],o.forEach(function(e){var i=s.utils.getRelatedObjects(s.issues[n],a).map(function(e){return e.id}).indexOf(e.id);e[t]&&i>-1&&(-1===u[a].indexOf(e.id)&&u[a].push({physicalId:e.id}),-1===d[a].indexOf(e[t].id)&&(d[a].push({physicalId:e[t].contents?e[t].contents[0].id:e[t].id,envId:v.getTenant(),objectType:e[t].contents?e[t].contents[0].type:e[t].type,serviceId:e.targetModel.options.serviceId}),-1===c.indexOf(e[t].id)&&c.push({id:e[t].id,serviceId:e.targetModel.options.serviceId})))}),u[a].length>0||d[a].length>0){r.issuesToAdd.push(d),r.issuesToRemove.push(u);var m={id:s.issues[n].id,issue:s.issues[n]};l.push(m)}}if(r.issuesToAdd.length>0||r.issuesToRemove.length>0){var p=s.timestampLastRefresh;s.confirmReplaceByRevision(a,t).then(function(){s.updateIssues(r.issuesToAdd,!1).then(function(){s.updateIssues(r.issuesToRemove,!0).then(function(){s.fetchRelatedObjects(c,!0).then(function(e){var i={};e.forEach(function(e){i[e.options.id]=e}),s.timestampLastRefresh===p&&(s._getTreeDocument().withTransactionUpdate(function(){n.forEach(n=>{let a=s._getCategoryRoot(n),r=a.getChildren(),l=r.map(e=>e.options.id);o.forEach(function(e){var o=r.indexOf(e.targetModel);if(o>-1){e.targetModel.remove();var c=i[e[t].id];c&&(-1==l.indexOf(c.options.id)&&a.addChild(c,o),i[e[t].id]=null)}s.issues.forEach(function(i){var o=s.utils.getRelatedObjects(i,n),a=o.map(function(e){return e.id}).indexOf(e.id);a>-1&&(o.splice(a,1),o.map(function(e){return e.id}).indexOf(e[t].id)>-1||o.splice(a,0,{id:e[t].id,serviceId:e.targetModel.options.serviceId}))})}),s.computeRelatedObjectsCommon(n),s.updateRelatedObjectsCommon(a.getChildren(),n),e.length&&a.expandAll(),D.displayNotification({msg:O.resolveIssues.successResolved,eventID:"success"})})},function(){s._logger.error('An error occurred during "%s"',"add child")}),s.dispatchEvent("onUpdate",{issues:l}))})},function(){s._logger.error('An error occurred during "%s"',"removing in replace revision in withTransactionUpdate")})},function(){s._logger.error('An error occurred during "%s"',"adding in replace revision in withTransactionUpdate")})},function(){s._logger.log('User cancel the operation. "%s"',"replace revision")})}else D.displayNotification({msg:O.resolveIssues.nothingToReplace,eventID:"info"})},function(){})},getRevisions:function(e){var t=this;return f.start(t.name+" getRevisions"),new n(function(s,n){if(e&&0!==e.length){var i={graphRequests:[]},o=[];e.forEach(function(e){o.push(e.options.pid)}),(o=[...new Set(o)]).forEach(function(e){i.graphRequests.push({id:e})}),g.getRevisions({data:i,onComplete:function(n){var i=n.body;t._logger.log("getRevisions :Success...");var o=[];e.forEach(function(e){for(var s=null,n=null,a=null,r=null,l=null,c=i.graphs,d=0;d<c.length;d++){var u=c[d];if(u.versions)for(var m=0;m<u.versions.length;m++){var p=u.versions[m].contents?u.versions[m].contents[0].id:u.versions[m].id;if(e.options.pid===p){s=u.versions;break}}if(s)break}if(s){for(var f=0;f<s.length;f++)if(s[f].isLastVersion){n=s[f];break}for(var h=s.length-1;h>=0;h--)if("RELEASED"===s[h].maturity){l=s[h];break}for(var g=s.length-1;g>=0;g--)if("RELEASED"===s[g].maturity||"FROZEN"===s[g].maturity){r=s[g];break}for(var v=0;v<s.length;v++){if((s[v].contents?s[v].contents[0].id:s[v].id)===e.options.pid){a=s[v];break}}}else t._logger.log("getRevisions :no revision -> "+e.options.pid);var b={id:e.options.id,pid:e.options.pid,targetModel:e,revisionFamily:s,CURRENT:a,STABLE_LATEST:r,RELEASE_LATEST:l,LATEST:n};o.push(b)}),f.end(t.name+" getRevisions"),s(o)},onFailure:function(e){t._logger.error("getRevisions :Failure..."),t._logger.error(e),D.displayNotification({msg:O.resolveIssues.errorResolved,eventID:"error"}),f.end(t.name+" getRevisions"),n(e)}})}else s([])})},confirmReplaceByRevision:function(e,t){var s=O.resolveIssues.confirmDialog.replaceByLatestRevisionTitle,n=O.resolveIssues.confirmDialog.confirmReplaceByLatestRevision;t===N.REVISION_TARGETS.RELEASE_LATEST?(s=O.resolveIssues.confirmDialog.replaceByReleasedLatestRevisionTitle,n=O.resolveIssues.confirmDialog.confirmReplaceByReleasedLatestRevision):t===N.REVISION_TARGETS.STABLE_LATEST&&(s=O.resolveIssues.confirmDialog.replaceByStableLatestRevisionTitle,n=O.resolveIssues.confirmDialog.confirmReplaceByStableLatestRevision);for(var i=[],o=0;o<e.length;o++){var a=e[o].targetModel;s=a.options.title;s=a.options.name?s+" ("+a.options.name+")":s;var r=O.replace(O.resolveIssues.confirmDialog.confirmReplaceByTitleMessage,{target:s+a.options.revision,latest:e[o][t].code});i.push(r)}return this._showConfirm(i,n,s)},setClassContentType:function(e){var t={data:e};return new n(function(e,s){g.issues.getStatesAttributes(t).then(function(t){E.addCSSMaturityClasses("wux-controls-label",t),e()})}).catch(function(e){return e})},utils:{_debounceTimeouts:[],debounce:function(e,t,s){var n,i=this;return function(){var o=this,a=arguments,r=s&&!n;clearTimeout(n);var l=i._debounceTimeouts.indexOf(n);-1!==l&&i._debounceTimeouts.splice(l,1),n=setTimeout(function(){n=null,s||e.apply(o,a)},t),i._debounceTimeouts.push(n),r&&e.apply(o,a)}},getRelatedObjects:function(e,t){return e.relatedObjects[t]},sortJudgment:function(e,t){return(e=e||"")<(t=t||"")?-1:e>t?1:0}}})}),define("DS/IssueComponents/related/RelatedContent",["UWA/Class/View","UWA/Class/Promise","UWA/Core","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","DS/IssueComponents/related/DatagridView","DS/IssueComponents/related/RelatedContentActionBar","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","DS/Utilities/Dom","css!DS/IssueComponents/IssueComponents.css","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f,h){"use strict";var g={ISSUE_TYPE:"Issue",CATEGORY_REPORTED_AGAINST:"reportedAgainst",CATEGORY_RESOLVED_BY:"resolvedBy",CATEGORY_CONTEXTS:"contexts",CATEGORY_RESOLVED_ITEMS:"resolvedItems",CATEGORY_REPORTED_AGAINST_INSTANCE:"reportedAgainst_instance",CATEGORY_RESOLVED_BY_INSTANCE:"resolvedBy_instance",CATEGORY_NLS:{reportedAgainst:"Affected Items",resolvedBy:"Resolvedby",contexts:"Contexts",resolvedItems:"Resolved Items"},CATEGORIES_TO_ADD_ISSUE_TYPE_OBJECT:["resolvedBy"],ISSUE_3D_REVIEW:"ENX3DIR_AP"},v={actual:null,count:0};return e.extend({name:"DS/IssueComponents/related/RelatedContent",tag:"div",className:"relatedContent-objects-view",_deferred:{resolve:null,reject:null},setup:function(e){m.start(this.name+" setup"),this._logger=n.getLogger(this.name),this._logger.log("Initializing related"),this._parent(e),this.options.ids=e.ids,this.issues={},this.views={},this.views.relatedContent={},this.grids={},this.isLoaded=null,m.end(this.name+" setup")},render:function(){return this.build(),this.load(this.options.ids),m.end(this.name+" init"),this},build:function(){var e=this;m.start(e.name+" build"),e.views.main=s.createElement("div",{styles:{width:"100%",height:"100%",display:"inline-block"},class:"relatedContent-objects-view-main",html:e.createRelatedContent()}),e.views.main.inject(e.container),e.grids.relatedContent=new r(e.views.relatedContent.dgView,g.CATEGORY_CONTEXTS,void 0,v),l.toolbar=e.grids.relatedContent.dgView.setToolbar(l.writetoolbarDefination()),l.toolbar.onToolbarClickCallback=this.onToolbarClickCallback.bind(e),l.toolbar.inject(e.views.relatedContent.relatedContentHeader),e._addDropEvent(e.views.relatedContent.droppable);for(var t=[{id:g.CATEGORY_REPORTED_AGAINST,icon:"location",title:h.open.labels.reportedAgainst},{id:g.CATEGORY_CONTEXTS,icon:"3d-object",title:h.open.labels.contexts},{id:g.CATEGORY_RESOLVED_ITEMS,icon:"markup-review",title:h.open.labels.resolvedItems},{id:g.CATEGORY_RESOLVED_BY,icon:"docs",title:h.open.labels.resolvedBy}],n=0;n<t.length;n++){var i=s.createElement("div",{class:"relatedcontent-dgv-dropZoneGlobal "+t[n].id,draggable:!1}),o=s.createElement("div",{class:"relatedcontent-dgv-dropZone "+t[n].id,draggable:!1}).inject(i),a=s.createElement("div",{class:"relatedcontent-dgv-dropIconAndText "+t[n].id}).inject(o);s.createElement("i",{class:"relatedcontent-dgv_img wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-"+t[n].icon}).inject(a),s.createElement("h5",{class:"relatedcontent-dgv_txt "+t[n].id,text:t[n].title}).inject(a),i.inject(e.views.relatedContent.dropzones)}e.views.relatedContent.dropzones.hide(),e.grids.relatedContent.callbacks.onModifyGrid=e._refreshItemCount.bind(e),e.listenTo(e.grids.relatedContent,"onUpdate",function(t){var n={issues:s.clone(t.issues).map(function(e){return e.issue}),relation:t.relation};e.dispatchEvent("onUpdate",n)}),m.end(e.name+" build")},onToolbarClickCallback:function(e){"addAffectedItem"==e._event&&this._addItem(g.CATEGORY_REPORTED_AGAINST),"addResolvedBy"==e._event&&this._addItem(g.CATEGORY_RESOLVED_BY),"addResolvedItems"==e._event&&this._addItem(g.CATEGORY_RESOLVED_ITEMS),"addContexts"==e._event&&this._addItem(g.CATEGORY_CONTEXTS),"pickAffectedItem"==e._event&&this._pickItem(g.CATEGORY_REPORTED_AGAINST),"pickResolvedBy"==e._event&&this._pickItem(g.CATEGORY_RESOLVED_BY),"pickResolvedItems"==e._event&&this._pickItem(g.CATEGORY_RESOLVED_ITEMS),"pickContexts"==e._event&&this._pickItem(g.CATEGORY_CONTEXTS),"customViewSettings"==e._event&&this._customViewSettings(),e._event},_customViewSettings:function(){a.launchCustomViewManager(this.grids.relatedContent.dgView)},_pickItem:function(e){var t=this,s=c.get("component"),n=c.get("widget").name===g.ISSUE_3D_REVIEW,o=!1;if(e===g.CATEGORY_REPORTED_AGAINST&&(o=!0),n)s.isInspected()?i.displayNotification({msg:h.resolveIssues.pickupError_needtoExitInspectionMode,eventID:"error"}):s.utils.selectIn3D(function(s,n){var i=[{id:s,x:n[s].x,y:n[s].y,z:n[s].z}];t.grids.relatedContent.addObjects([s],e,i)});else{var a=s.taskManager.addSelectIn3DTask(function(n){var i=n.target,o=n.positions,r=[{id:i,x:o[i].x,y:o[i].y,z:o[i].z}];t.grids.relatedContent.addObjects([{id:i,serviceId:n.serviceId?n.serviceId:"3dspace",objectType:n.objectType}],e,r),s.unmaskForTask(a)},function(){s.unmaskForTask(a)},{isOccurenceSelection:o});s.maskForTask(a,h.tasks.selectIn3D)}},_addItem:function(e){var t=this,n=c.get("application");if(s.is(n,"object")&&n.isStandalone){var o=c.get("component"),r=o.taskManager.addObjectsTask(function(s){if(Array.isArray(s)){for(var n=[],i=0;i<s.length;i++)n.push({id:s[i].physicalId,serviceId:s[i].serviceId,objectType:s[i].objectType});t.grids.relatedContent.addObjects(n,e)}o.unmaskForTask(r)},function(){o.unmaskForTask(r)});o.maskForTask(r,h.tasks.addObjects)}else{u.getTenant();let s=h.open.labels[e];u.search({title:s,default_search_criteria:"",callback:function(s){var n=[g.ISSUE_TYPE];try{var o=[],r=[],l=0;s.forEach(e=>{r.push(e["ds6w:type_value"])}),r.length>0&&a.getTypesHierarchy(r).then(a=>{for(var r=0;r<s.length;r++){var c=s[r];if(c.hasOwnProperty("sourceid_value")){if(c.sourceid_value.includes(":")){const e=c.sourceid_value.split(":");c.sourceid_value=e[0]}var d=c.sourceid_value.toLowerCase();if(-1===d.indexOf("3dspace")&&(!c.hasOwnProperty("ds6w:i3dx_value")||""==c["ds6w:i3dx_value"]))throw new Error("Object not supported")}if(!a[c["ds6w:type_value"]].hierarchy.includes(n[0])&&c["ds6w:type_value"]!==n[0]||g.CATEGORIES_TO_ADD_ISSUE_TYPE_OBJECT.includes(e)){var u=c["ds6w:i3dx_value"]&&""!=c["ds6w:i3dx_value"]?c["ds6w:i3dx_value"]:c.id;o.push({id:u,serviceId:d,objectType:c["ds6w:type_value"]})}else l++}o.length>0&&t.grids.relatedContent.addObjects(o,e),0===l||i.displayNotification({msg:h.replace(h.resolveIssues.issueNotDroppable,{number:l}),eventID:"error"})})}catch(e){return i.displayNotification({msg:h.resolveIssues.errorNotSupportedObject,eventID:"warning"}),null}},cancel:function(){}})}},_refreshItemCount:function(){},createRelatedContent:function(){return m.start(this.name+" createRelatedContent"),this.views.relatedContent.main=s.createElement("div",{styles:{width:"100%",height:"100%",display:"inline-block"},class:"issue-relatedContent-main",html:[this.views.relatedContent.relatedContentHeader=s.createElement("div",{styles:{width:"100%",height:"40px",display:"flex","align-items":"center"},class:"issue-relatedContent-header"}),this.views.relatedContent.droppable=s.createElement("div",{styles:{width:"100%",position:"relative"},class:"issue-relatedContent-droppable",html:[this.views.relatedContent.dgView=s.createElement("div",{styles:{width:"100%",height:"100%",position:"absolute"},class:"issue-relatedContent-datagridview"}),this.views.relatedContent.tileView=s.createElement("div",{styles:{width:"100%",height:"100%",position:"absolute",display:"none"},class:"issue-relatedContent-tileview",html:"Test"}),this.views.relatedContent.dropzones=s.createElement("div",{styles:{position:"absolute","z-index":5e4,"justify-content":"space-around","align-items":"center","margin-top":"30px","margin-bottom":"30px"},class:"issue-relatedContent-dropzones"})]})]}),m.end(this.name+" createRelatedContent"),this.views.relatedContent.main},clear:function(){this.issues={}},destroy:function(){this.views.main&&this.views.main.destroy(),this.stopListening(this.grids.relatedContent,"onUpdate"),this.grids.relatedContent&&(this.grids.relatedContent.destroy(),this.grids.relatedContent=null),this.views={},this.grids={},this._timestampUpdate=0},reBuildPanel:function(e){m.start(this.name+" reBuildPanel"),this.clear(),this.options.ids=e,this.load(this.options.ids),m.end(this.name+" reBuildPanel")},refresh:function(e){m.start(this.name+" refresh");var t=e;return t||(t=this.options.ids),this.reBuildPanel(t),m.end(this.name+" refresh"),this.isLoaded},load:function(e){var n=this;n.isLoaded=new t(function(e,t){n._deferred.resolve=e,n._deferred.reject=t}),n.fetchIssuesAndRelatedObjects(e).then(function(e){if(n.issues=e.issues,n.issues.length>0){n.grids.relatedContent.load(e.issues).then(()=>{a.buildCustomViewOptions(n.grids.relatedContent.dgView,n.container),a.restoreCustomViews(n.grids.relatedContent.dgView),o.setColumnFilteringOnAllColumns(n.grids.relatedContent.dgView)});var t=0,s=0,i=function(e){e||s++,1===++t&&(s>0?(n._deferred.reject(),n.dispatchEvent("onFailure",{error:"Cannot load the related view"})):(n._deferred.resolve(),n.dispatchEvent("onReady",{})))};n.grids.relatedContent.isLoaded.then(function(){i(!0)},function(){i(!1)})}},function(e){s.is(e.error)&&s.is(e.error.internal)&&"'business object' does not exist"==e.error.internal?o.displayErrorMessage(o.getErrorMessage("0"),"error"):i.displayNotification({msg:h.resolveIssues.errorGetIssues,eventID:"error"}),n._deferred.reject()})},fetchIssuesAndRelatedObjects:function(e){var s=this;return new t(function(t,n){d.issues.retrieve({timestamp:s._timestampUpdate?s._timestampUpdate:null,data:{objects:e.map(function(e){return{physicalId:e}})},onComplete:function(e){if(Array.isArray(e.results)){for(var s={issues:[]},i=0;i<e.results.length;i++){var o=e.results[i].body,a={id:o.physicalId,name:o.name,title:o.title,type:o.type,revision:"",state:o.state,description:o.description,rowNumForEmpty:{},relatedObjects:{}};s.issues.push(a),a.relatedObjects[g.CATEGORY_REPORTED_AGAINST]=[],a.relatedObjects[g.CATEGORY_RESOLVED_BY]=[],a.relatedObjects[g.CATEGORY_RESOLVED_ITEMS]=[],a.relatedObjects[g.CATEGORY_CONTEXTS]=[];for(var r=0;r<o.reportedAgainst.length;r++)a.relatedObjects[g.CATEGORY_REPORTED_AGAINST].push({id:o.reportedAgainst[r].path.join(),serviceId:o.reportedAgainst[r].serviceId,elementType:o.reportedAgainst[r].elementType});for(let e=0;e<o.resolvedBy.length;e++)a.relatedObjects[g.CATEGORY_RESOLVED_BY].push({id:o.resolvedBy[e].physicalId,serviceId:o.resolvedBy[e].serviceId,elementType:o.resolvedBy[e].elementType});for(let e=0;e<o.resolvedItems.length;e++)a.relatedObjects[g.CATEGORY_RESOLVED_ITEMS].push({id:o.resolvedItems[e].physicalId,serviceId:o.resolvedItems[e].serviceId,elementType:o.resolvedItems[e].elementType});for(var l=0;l<o.contexts.length;l++)a.relatedObjects[g.CATEGORY_CONTEXTS].push({id:o.contexts[l].physicalId,serviceId:o.contexts[l].serviceId,elementType:o.contexts[l].elementType})}t(s)}else n(new Error("Unexpected response when retrieving issues."))},onFailure:function(e){s._logger.log("getIssues :Failure..."+e),n(e)}})})},_addDropEvent:function(e){var t=this,s=0;let n=t.views.relatedContent.dropzones;document.addEventListener("dragover",function(e){e.preventDefault()}),e.addEventListener("drop",function(s){if(e.removeClassName("dragenter"),t.views.relatedContent.dgView.style.opacity="1",n.hide(),v.count=0,s.stopPropagation(),!s.defaultPrevented){s.preventDefault();let e=[g.CATEGORY_REPORTED_AGAINST,g.CATEGORY_RESOLVED_BY,g.CATEGORY_RESOLVED_ITEMS,g.CATEGORY_CONTEXTS];var i="";for(let t=0;t<e.length;t++)if(v.actual.classList.contains(e[t])){i=e[t];break}t.getDroppedInfo(s,i).then(e=>{e&&t.grids.relatedContent.addObjects(e,i)})}}),e.addEventListener("dragenter",function(i){0===v.count&&(t.views.relatedContent.dgView.style.opacity="0.4",e.addClassName("dragenter"),n.show(),n.addClassName("dropzone-flex"));var o=p.firstParentWithClass(i.target,"relatedcontent-dgv-dropZoneGlobal");if(o){var a=o.querySelector(".relatedcontent-dgv-dropZone");v.actual!==a&&(v.actual&&v.actual.classList.remove("zoneHighlighted"),a.classList.add("zoneHighlighted"),v.actual=a)}v.count++,s++,i.stopPropagation()}),e.addEventListener("mouseenter",function(){e.hasClassName("dragenter")&&s++}),e.addEventListener("mouseleave",function(){e.hasClassName("dragenter")&&--s<=0&&e.removeClassName("dragenter")}),e.addEventListener("dragleave",function(i){v.count--,0===v.count&&(t.views.relatedContent.dgView.style.opacity="1",e.removeClassName("dragenter"),n.hide()),i.target===v.actual&&(v.actual.classList.remove("zoneHighlighted"),v.actual=null),0===--s&&(e.removeClassName("dragenter"),n.hide()),i.stopPropagation()}.bind(t))},getDroppedInfo:function(e,t){var n=[];try{return a.getDroppableData(e).then(e=>{var o=e.data.items;if(0==o.length)throw new Error("Object not supported");var a=0;return o.forEach(function(e){if(e.isIssue&&!g.CATEGORIES_TO_ADD_ISSUE_TYPE_OBJECT.includes(t))a++;else{if(!e.hasOwnProperty("serviceId")||!s.is(e.serviceId,"string")||!e.serviceId.toLowerCase().includes("3dspace")&&!e.hasOwnProperty("i3dx")||!e.serviceId.toLowerCase().includes("3dspace")&&e.hasOwnProperty("i3dx")&&""==e.i3dx)throw new Error("Object not supported");if(-1===n.indexOf(e.objectId)){e.serviceId.includes(":")&&(e.serviceId=e.serviceId.split(":")[0]);var i=e.i3dx&&""!=e.i3dx?e.i3dx:e.objectId;n.push({id:i,serviceId:e.serviceId,objectType:e.objectType})}}}),0!==a&&i.displayNotification({msg:h.replace(h.resolveIssues.issueNotDroppable,{number:a}),eventID:"error"}),n.length>0?n:null})}catch(e){return i.displayNotification({msg:h.resolveIssues.errorNotSupportedObject,eventID:"warning"}),null}return n},utils:{pushObjectIdIntoArrayOnce:function(e,t){return t.indexOf(e)>-1&&(t.push(e),!0)}}})}),define("DS/IssueComponents/create/Related",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Form","DS/UIKIT/Iconbar","DS/Controls/TooltipModel","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/Tree/TreeListView","DS/TreeModel/TreeNodeModel","DS/Visualization/ThreeJS_DS","DS/IssueCommon/commands/CommandsManager","DS/IssueComponents/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Parser","DS/IssueServices/utils/Performance","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f,h,g,v,b,C){"use strict";var y={NONSUPPORTED_TYPES:["Change Action","Change Order","Change Request","Change Analysis","Route","Country","Business Role","Issue"],ISSUE_MANAGEMENT:"ENXISSU_AP",ISSUE_3D_REVIEW:"ENX3DIR_AP",ISSUE_TYPE:"Issue",PATH_TO_PARSE:0,RELATED_OBJECTS_TYPES:{CONTEXTS:"contexts",REPORTED_AGAINST:"reportedAgainst"}};return t.extend({name:"DS/IssueComponents/create/Related",tag:"div",className:"create-view-content-subview create-related",defaultOptions:{treelist:{grid:{height:"100%",apiVersion:2,defaultCellHeight:26,useTransparentScroller:!1,useNativeScroller:!1,useAsyncPreExpand:!0,resize:{columns:!0,rows:!1},selection:{unselectAllOnEmptyArea:!0,toggle:!1,canMultiSelect:!0,enableListSelection:!0,renderingMode:"adaptive"},columns:[{text:C.create.related.treelist.tree,dataIndex:"tree",width:"auto",isDraggable:!1},{text:C.create.related.treelist["ds6w:type"],width:"auto",dataIndex:"ds6w:type",isDraggable:!1},{text:C.create.related.treelist["ds6w:identifier"],width:"auto",dataIndex:"ds6w:identifier",isDraggable:!1},{text:C.create.related.treelist["ds6wg:revision"],width:"auto",dataIndex:"ds6wg:revision",isDraggable:!1}]}}},isInit:null,_deferredInit:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s.parent=t.parent,s.isInit=new e(function(e,t){s._deferredInit.resolve=e,s._deferredInit.reject=t}),s.form=null,s.formElements={reportedAgainst:null,contexts:null},s.formElementsToggler={reportedAgainst:null,contexts:null},s.fields={reportedAgainst:{},contexts:{},balloons:null},s._deferredInit.resolve()},destroy:function(){this.fields.reportedAgainst.treeList&&this.fields.reportedAgainst.treeList.getRoots().forEach(function(e){if(e.options.position&&e.options.position.balloons&&e.options.position.balloons.length)for(var t=e.options.position.balloons,s=0;s<t.length;s++)e.options.position.balloons[s].destroy()}),this.form=null,this.formElements={reportedAgainst:null,contexts:null},this.formElementsToggler={reportedAgainst:null,contexts:null},this.fields={reportedAgainst:{},contexts:{},balloons:null}},render:function(){if(this._renderReportedAgainstField(),this._renderContextField(),!this.parent.isTemplate&&"IFB"===this.parent.options.issueCreationType&&widget.getValue("createSetting")&&widget.getValue("selectedContext")){var e=widget.getValue("selectedContext").id,t=widget.getValue("selectedContext").type,i=widget.getValue("selectedContext").serviceId;i.includes(":")&&(i=i.split(":")[0]);var o=[],a=f.get("ISU_TYPE_NLS");if(s.is(a["ds6w:type"])&&(o=Object.keys(a["ds6w:type"])),!o.includes(t)){var r=widget.getValue("affectedItemCreateSetting"),l=widget.getValue("contextCreateSetting");r&&this._addNodes([{id:e,serviceId:i}],y.RELATED_OBJECTS_TYPES.REPORTED_AGAINST),l&&this._addNodes([{id:e,serviceId:i}],y.RELATED_OBJECTS_TYPES.CONTEXTS)}}return this.form=new n({className:"create-related-form",fields:[],events:{onInvalid:function(){}}}).inject(this.container),s.createElement("div",{class:"create-form-content",html:[this.formElements.reportedAgainst=s.createElement("div",{class:"create-form-element create-related-form-element-reported-against",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[this.formElementsToggler.reportedAgainst=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[this.fields.reportedAgainst.title,this.fields.reportedAgainst.treeListContainer]},{tag:"div",class:"create-form-help-tooltip",html:[this.fields.reportedAgainst.help]}]}),this.formElements.contexts=s.createElement("div",{class:"create-form-element create-related-form-element-contexts",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[this.formElementsToggler.contexts=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[this.fields.contexts.title,this.fields.contexts.treeListContainer]},{tag:"div",class:"create-form-help-tooltip",html:[this.fields.contexts.help]}]})]}).inject(this.form.elements.container),this},getValues:function(){var e=[];this.fields.reportedAgainst.treeList.getDocument().getRoots().forEach(function(t){var s=t.options.id.split(","),n={physicalId:s[s.length-1],path:s,envId:t.options.envId,serviceId:t.options.serviceId,objectType:t.options.type};e.push(n),t.options.hasOwnProperty("position")&&null!==t.options.position&&void 0!==t.options.position&&(n.position={x:t.options.position.x,y:t.options.position.y,z:t.options.position.z})});var t=[];return this.fields.contexts.treeList.getDocument().getRoots().forEach(function(e){var s={physicalId:e.options.id,envId:e.options.envId,serviceId:e.options.serviceId,objectType:e.options.type};t.push(s)}),{reportedAgainst:e,contexts:t}},getHiddenAttributes:function(){var e={};for(var t in this.formElements)s.is(this.formElementsToggler[t])&&(e[t]=this.formElementsToggler[t].hasClassName("fonticon-eye-off"));return e},applyTemplate:function(t){var n=this;return n.reset().then(function(){var i=[];if(Array.isArray(t.data.reportedAgainst)&&t.data.reportedAgainst.length>0&&t.data.reportedAgainst.forEach(function(t){var o=t.position&&s.is(t.position,"object"),a=[],r=t.serviceId;Array.isArray(t.path)?a=t.path:a.push(t.physicalId);var l=s.merge(t.automation||{},{assignee:!1,context:!1});if(!0===o){var c=f.get("widget").name===y.ISSUE_3D_REVIEW,d=f.get("component"),u=d&&"getManager"in d&&d.getManager(),m=[],p={};if(p[a.join()]={x:Number(t.position.x),y:Number(t.position.y),z:Number(t.position.z),balloons:[]},c&&u&&(m=d.getManager().getNodesById(t.physicalId)),m.hasOwnProperty("nodes")&&m.nodes.length>0){for(var h=[],g=0;g<m.nodes.length;g++){m.paths[g].toString().includes(a.toString())&&h.push(new e(function(e){n._addBalloon(p[a.join()],t.physicalId,m.paths[g],function(){p[a.join()].balloons.push(this),e()})}))}i.push(e.all(h).then(function(){return n.parent.elements.dialog.show(),n._addNodes([{id:a.join(),serviceId:r}],y.RELATED_OBJECTS_TYPES.REPORTED_AGAINST,p,!l.assignee)}))}else i.push(n._addNodes([{id:a.join(),serviceId:r}],y.RELATED_OBJECTS_TYPES.REPORTED_AGAINST,p,!l.assignee))}else i.push(n._addNodes([{id:a.join(),serviceId:r}],y.RELATED_OBJECTS_TYPES.REPORTED_AGAINST,null,!l.assignee))}),Array.isArray(t.data.contexts)&&t.data.contexts.length>0&&i.push(n._addNodes(t.data.contexts.map(function(e){return{id:e.physicalId,serviceId:e.serviceId}}),y.RELATED_OBJECTS_TYPES.CONTEXTS)),s.is(t.hidden,"object")&&s.is(n.formElements,"object")&&s.is(n.formElementsToggler,"object")){var o=n.formElements,a=n.formElementsToggler;for(var r in o)!0===t.hidden[r]&&(n.parent.isTemplate?(s.is(o[r])&&o[r].toggleClassName("visibility-masked",!0),s.is(a[r])&&(a[r].toggleClassName("fonticon-eye-off",!0),a[r].toggleClassName("fonticon-eye",!1))):s.is(o[r])&&o[r].hide())}return e.all(i)})},reset:function(){var t=this;return new e(function(e){var s=t.fields.reportedAgainst.treeList.getRoots();t._removeNodes(s,y.RELATED_OBJECTS_TYPES.REPORTED_AGAINST),t._removeNodes(t.fields.contexts.treeList.getRoots(),y.RELATED_OBJECTS_TYPES.CONTEXTS),e()})},_renderReportedAgainstField:function(){var t=this,n=f.get("widget").name===y.ISSUE_3D_REVIEW;t.fields.reportedAgainst.help=s.createElement("div",{html:[s.createElement("span",{class:"fonticon fonticon-help"})]}),t.fields.reportedAgainst.help.tooltipInfos=new o({shortHelp:C.create.related.labels.reportedAgainstshortHelper,longHelp:C.create.related.labels.reportedAgainstlongHelper}),t.fields.reportedAgainst.title=s.createElement("div",{class:"create-form-title-with-iconbar",html:[{tag:"h5",html:C.create.related.labels.reportedAgainst}]}),t.fields.reportedAgainst.iconBar=new i({renderTo:t.fields.reportedAgainst.title,items:[{id:"location",fonticon:"location",text:C.create.related.addBalloonAvailable,handler:function(){var i=f.get("component"),o=function(i,o,a,r){for(var l=i.split(","),c=[],d=0;d<a.nodes.length;d++){var u=a.paths[d].toString().includes(l.toString());n?u&&c.push(new e(function(e){t._addBalloon(o[i],i,a.paths[d],function(){o[i].balloons.push(this),e()})})):c.push(e.resolve())}e.all(c).then(function(){t.parent.elements.dialog.show();var e=[t._addNodes([{id:i,serviceId:"3dspace"}],y.RELATED_OBJECTS_TYPES.REPORTED_AGAINST,o)];return s.is(r,"string")&&e.push(t._addNodes([{id:r,serviceId:"3dspace"}],y.RELATED_OBJECTS_TYPES.CONTEXTS)),e})};if(n)t.parent.elements.dialog.hide(),i.utils.selectIn3D(function(e,t,s,n){o(e,t,s,n)},function(){t.parent.elements.dialog.show()},[{isOccurenceSelection:!0}]);else{s.is(t.parent)&&s.is(t.parent.elements)&&s.is(t.parent.elements.dialog)&&t.parent.elements.dialog.hide();var a=i.taskManager.addSelectIn3DTask(function(e){var n=e.target,r=e.positions,l=e.nodes,c=e.context;o(n,r,l,c),s.is(t.parent)&&s.is(t.parent.elements)&&s.is(t.parent.elements.dialog)&&t.parent.elements.dialog.show(),i.unmaskForTask(a)},function(){s.is(t.parent)&&s.is(t.parent.elements)&&s.is(t.parent.elements.dialog)&&t.parent.elements.dialog.show(),i.unmaskForTask(a)},{isOccurenceSelection:!0});i.maskForTask(a,C.tasks.selectIn3D)}}},{id:"addReported",text:C.create.related.search,fonticon:"plus",handler:function(){var e=f.get("application");if(s.is(e,"object")&&e.isStandalone){var n=f.get("component"),i=n.taskManager.addObjectsTask(function(e){if(Array.isArray(e)){for(var s=[],o=0;o<e.length;o++)s.push({id:e[o].physicalId,serviceId:e[o].serviceId});t._addNodes(s,y.RELATED_OBJECTS_TYPES.REPORTED_AGAINST)}n.unmaskForTask(i)},function(){n.unmaskForTask(i)});n.maskForTask(i,C.tasks.addObjects)}else{var o=y.NONSUPPORTED_TYPES;h.type.getSubType().then(e=>{var s=e;null!=s&&Object.keys(s).length>1&&(o=Object.keys(s)),g.search({title:C.create.related.labels.reportedAgainst,default_search_criteria:"",callback:function(e){for(var s=[],n=0,i=!0,a=0;a<e.length;a++)if(o.includes(e[a]["ds6w:type_value"]))n++;else{var r=e[a];if(r.sourceid.includes(":")){const e=r.sourceid.split(":");r.sourceid=e[0]}if(r.sourceid.toLowerCase().includes("3dspace")||r.hasOwnProperty("ds6w:i3dx_value")&&""!=r["ds6w:i3dx_value"]){var c=r["ds6w:i3dx_value"]&&""!=r["ds6w:i3dx_value"]?r["ds6w:i3dx_value"]:r.id;s.push({id:c,serviceId:r.sourceid})}else i=!1}i||l.displayNotification({msg:C.create.related.dropError,eventID:"warning"}),0===n?t._addNodes(s,y.RELATED_OBJECTS_TYPES.REPORTED_AGAINST):l.displayNotification({msg:C.replace(C.resolveIssues.issueNotDroppable,{number:n}),eventID:"error"})},cancel:function(){}})})}}},{id:"removeReported",text:C.create.related.remove,fonticon:"remove",handler:function(){t._removeSelectedNodes(y.RELATED_OBJECTS_TYPES.REPORTED_AGAINST)}}]}),t.fields.reportedAgainst.iconBar.disableItem("removeReported"),t.fields.reportedAgainst.treeListContainer=s.createElement("div",{class:"create-form-treelist treelist-empty",id:y.RELATED_OBJECTS_TYPES.REPORTED_AGAINST,tabindex:"-1"}),t.fields.reportedAgainst.treeListPlaceholder=s.createElement("span",{class:"treelist-placeholder",html:C.create.related.labels.reportedAgainstPlaceholder}).inject(t.fields.reportedAgainst.treeListContainer),t._addDropEvent(t.fields.reportedAgainst.treeListContainer);var a=s.clone(t.options.treelist.grid);a.id=y.RELATED_OBJECTS_TYPES.REPORTED_AGAINST,a.onDropBlank=t._onTreeListDrop.bind(t),a.onDropCell=t._onTreeListDrop.bind(t),a.onDragStartCell=t._onDragStartCell.bind(t),a.allowUnsafeHTMLContent=!1,t.addOccurencePathColumn(a),t.fields.reportedAgainst.treeList=new c(a),t.fields.reportedAgainst.treeList.inject(t.fields.reportedAgainst.treeListContainer)},addOccurencePathColumn:function(e){e.columns.splice(1,0,{text:C.create.related.treelist.occurrence,dataIndex:"occurrence",width:"auto",isDraggable:!1})},_renderContextField:function(){var e=this,t=f.get("widget").name===y.ISSUE_3D_REVIEW;e.fields.contexts.help=s.createElement("div",{html:[s.createElement("span",{class:"fonticon fonticon-help"})]}),e.fields.contexts.help.tooltipInfos=new o({shortHelp:C.create.related.labels.contextshortHelper,longHelp:C.create.related.labels.contextlongHelper}),e.fields.contexts.title=s.createElement("div",{class:"create-form-title-with-iconbar",html:[{tag:"h5",html:C.create.related.labels.contexts}]}),e.fields.contexts.iconBar=new i({renderTo:e.fields.contexts.title,items:[{id:"location",fonticon:"location",text:C.create.related.selectContextIn3D,handler:function(){var n=f.get("component");if(t)e.parent.elements.dialog.hide(),n.utils.selectIn3D(function(t){e.parent.elements.dialog.show(),e._addNodes([{id:t,serviceId:"3dspace"}],y.RELATED_OBJECTS_TYPES.CONTEXTS)},function(){e.parent.elements.dialog.show()});else{s.is(e.parent)&&s.is(e.parent.elements)&&s.is(e.parent.elements.dialog)&&e.parent.elements.dialog.hide();var i=n.taskManager.addSelectIn3DTask(function(t){var o=t.target;s.is(e.parent)&&s.is(e.parent.elements)&&s.is(e.parent.elements.dialog)&&e.parent.elements.dialog.show(),n.unmaskForTask(i),e._addNodes([{id:o,serviceId:"3dspace"}],y.RELATED_OBJECTS_TYPES.CONTEXTS)},function(){s.is(e.parent)&&s.is(e.parent.elements)&&s.is(e.parent.elements.dialog)&&e.parent.elements.dialog.show(),n.unmaskForTask(i)});n.maskForTask(i,C.tasks.selectIn3D)}}},{id:"addContext",text:C.create.related.search,fonticon:"plus",handler:function(){var t=f.get("application");if(s.is(t,"object")&&t.isStandalone){var n=f.get("component"),i=n.taskManager.addObjectsTask(function(t){if(Array.isArray(t)){for(var s=[],o=0;o<t.length;o++)s.push({id:t[o].physicalId,serviceId:t[o].serviceId});e._addNodes(s,y.RELATED_OBJECTS_TYPES.CONTEXTS)}n.unmaskForTask(i)},function(){n.unmaskForTask(i)});n.maskForTask(i,C.tasks.addObjects)}else{var o=y.NONSUPPORTED_TYPES;h.type.getSubType().then(t=>{var s=t;null!=s&&Object.keys(s).length>1&&(o=Object.keys(s)),g.search({title:C.create.related.labels.contexts,default_search_criteria:"",multiSel:!0,callback:function(t){for(var s=[],n=0,i=!0,a=0;a<t.length;a++)if(o.includes(t[a]["ds6w:type_value"]))n++;else{var r=t[a];if(r.sourceid.includes(":")){const e=r.sourceid.split(":");r.sourceid=e[0]}if(r.sourceid.toLowerCase().includes("3dspace")||r.hasOwnProperty("ds6w:i3dx_value")&&""!=r["ds6w:i3dx_value"]){var c=r["ds6w:i3dx_value"]&&""!=r["ds6w:i3dx_value"]?r["ds6w:i3dx_value"]:r.id;s.push({id:c,serviceId:r.sourceid})}else i=!1}i||l.displayNotification({msg:C.create.related.dropError,eventID:"warning"}),0===n?e._addNodes(s,y.RELATED_OBJECTS_TYPES.CONTEXTS):l.displayNotification({msg:C.replace(C.resolveIssues.issueNotDroppable,{number:n}),eventID:"error"})},cancel:function(){}})})}}},{id:"removeContext",text:C.create.related.remove,fonticon:"remove",handler:function(){e._removeSelectedNodes(y.RELATED_OBJECTS_TYPES.CONTEXTS)}}]}),e.fields.contexts.iconBar.disableItem("removeContext"),e.fields.contexts.treeListContainer=s.createElement("div",{class:"create-form-treelist treelist-empty",id:y.RELATED_OBJECTS_TYPES.CONTEXTS,tabindex:"-1"}),e.fields.contexts.treeListPlaceholder=s.createElement("span",{class:"treelist-placeholder",html:C.create.related.labels.contextPlaceholder}).inject(e.fields.contexts.treeListContainer),e._addDropEvent(e.fields.contexts.treeListContainer);var n=s.clone(e.options.treelist.grid);n.id=y.RELATED_OBJECTS_TYPES.CONTEXTS,n.onDropBlank=e._onTreeListDrop.bind(e),n.onDropCell=e._onTreeListDrop.bind(e),n.onDragStartCell=e._onDragStartCell.bind(e),e.fields.contexts.treeList=new c(n),e.fields.contexts.treeList.inject(e.fields.contexts.treeListContainer)},_addNodesReportedAgainst:function(t,s,n,i){var o=this,a=o.fields[s].treeList;return new e(function(e,r){var c={skipped:{ids:[]},error:{ids:[]},result:{ids:[]}},u=[],m=t.map(e=>e.id);a.getRoots().forEach(function(e){var t=m.indexOf(e.options.id);-1!==t&&(m.splice(t,1),c.skipped.ids.push(e.options.id),u.push(e))}),u.forEach(function(e){if(n&&e.options.id in n){for(var t=e.options.position.balloons||[],s=0;s<t.length;s++)t[s].destroy();e.options.position=n[e.options.id]}});for(var p=[],f=0;f<m.length;f++)if(m[f]){var b=m[f].split(",");p.push(b[b.length-1])}else p.push(m);m.length?h.fetch({data:{objects:p.map(function(e){return{physicalId:e}})},onComplete:function(u){var f=u.body;f.infos&&f.infos.nresults&&p.length!==f.infos.nresults&&l.displayNotification({msg:C.create.templateApplyWarningRelated,eventID:"warning"});var h=[];f.infos&&f.infos.nresults&&f.infos.nresults>0?(a.getDocument().withTransactionUpdate(function(){if("results"in f){var e={};f.results.forEach(function(t){var s=v.parseFetchResponse(t);e[s.value.id]=s},r)}else r(u);for(var l=0;l<m.length;l++){var p={label:null,icons:[],grid:{}},b=m[l].split(","),C=e[b[b.length-1]];p.icons.push(C.value.typeIcon),p.id=m[l],p.grid["ds6w:label"]=C.display.title,p.label=C.display.title,p.title=C.display.title,p.grid["ds6w:type"]=C.display.type,p.type=C.value.type,p.grid["ds6w:identifier"]=C.display.name,p.name=C.value.name?C.value.name:"",p.grid["ds6wg:revision"]=C.display.revision,p.revision=C.value.revision,p.grid["ds6w:organizationResponsible"]=C.display.organization,p.organizationResponsible=C.value.organization,p.grid["ds6w:responsible"]=C.display.responsible,p.responsible=C.value.responsible,p.grid.owner=C.display.owner,p.owner=C.value.owner;var I=t.find(e=>e.id.includes(C.display.id));if(p.serviceId=I.serviceId,p.envId=g.getTenant(),"Issue"===p.type)c.error.ids.push(p.id);else{var E=new d(p);if(n&&E.options.id in n&&(E.options.position=n[E.options.id]),E.onSelect(function(e){s===y.RELATED_OBJECTS_TYPES.REPORTED_AGAINST?o.fields.reportedAgainst.iconBar.enableItem("removeReported"):s===y.RELATED_OBJECTS_TYPES.CONTEXTS&&o.fields.contexts.iconBar.enableItem("removeContext")}),E.onUnselect(function(e){0===a.getDocument().getSelectedNodes().length&&(s===y.RELATED_OBJECTS_TYPES.REPORTED_AGAINST?o.fields.reportedAgainst.iconBar.disableItem("removeReported"):s===y.RELATED_OBJECTS_TYPES.CONTEXTS&&o.fields.contexts.iconBar.disableItem("removeContext"))}),a.addRoot(E),h.push(E),c.result.ids.push(p.id),!i&&s===y.RELATED_OBJECTS_TYPES.REPORTED_AGAINST)"true"===localStorage.getItem("assignPreferenceTemplate")&&o.parent.dispatchEvent("related-add-reportedAgainst",{data:E.options})}}}),o.fetchOccurencePath(h,m,a),a.getDocument().getRoots().length&&o.fields[s].treeListContainer.removeClassName("treelist-empty"),e(c)):e(c)},onFailure:function(e){r(e)}}):e(c)})},_addNodes:function(t,s,n,i){var o=this;if(s==y.RELATED_OBJECTS_TYPES.REPORTED_AGAINST)return o._addNodesReportedAgainst(t,s,n,i);var a=o.fields[s].treeList;return new e(function(e,r){var c={skipped:{ids:[]},error:{ids:[]},result:{ids:[]}},u=[],m=t.map(e=>e.id);a.getRoots().forEach(function(e){var t=m.indexOf(e.options.id);-1!==t&&(m.splice(t,1),c.skipped.ids.push(e.options.id),u.push(e))}),u.forEach(function(e){if(n&&e.options.id in n){for(var t=e.options.position.balloons||[],s=0;s<t.length;s++)t[s].destroy();e.options.position=n[e.options.id]}}),m.length?h.fetch({data:{objects:m.map(function(e){return{physicalId:e}})},onComplete:function(u){var p=u.body;p.infos&&p.infos.nresults&&m.length!==p.infos.nresults&&l.displayNotification({msg:C.create.templateApplyWarningRelated,eventID:"warning"}),p.infos&&p.infos.nresults&&p.infos.nresults>0?(a.getDocument().withTransactionUpdate(function(){"results"in p?p.results.forEach(function(e){var r={label:null,icons:[],grid:{}},l=v.parseFetchResponse(e);r.icons.push(l.value.typeIcon),r.id=l.value.id,r.grid["ds6w:label"]=l.display.title,r.label=l.value.title,r.title=l.value.title,r.grid["ds6w:type"]=l.display.type,r.type=l.value.type,r.grid["ds6w:identifier"]=l.display.name,r.name=l.value.name?l.value.name:"",r.grid["ds6wg:revision"]=l.display.revision,r.revision=l.value.revision,r.grid["ds6w:organizationResponsible"]=l.display.organization,r.organizationResponsible=l.value.organization,r.grid["ds6w:responsible"]=l.display.responsible,r.responsible=l.value.responsible,r.grid.owner=l.display.owner,r.owner=l.value.owner;var u=t.find(e=>e.id.includes(l.display.id));if(r.serviceId=u.serviceId,r.envId=g.getTenant(),"Issue"===r.type)c.error.ids.push(r.id);else{var m=new d(r);if(n&&m.options.id in n&&(m.options.position=n[m.options.id]),m.onSelect(function(e){s===y.RELATED_OBJECTS_TYPES.REPORTED_AGAINST?o.fields.reportedAgainst.iconBar.enableItem("removeReported"):s===y.RELATED_OBJECTS_TYPES.CONTEXTS&&o.fields.contexts.iconBar.enableItem("removeContext")}),m.onUnselect(function(e){0===a.getDocument().getSelectedNodes().length&&(s===y.RELATED_OBJECTS_TYPES.REPORTED_AGAINST?o.fields.reportedAgainst.iconBar.disableItem("removeReported"):s===y.RELATED_OBJECTS_TYPES.CONTEXTS&&o.fields.contexts.iconBar.disableItem("removeContext"))}),a.addRoot(m),c.result.ids.push(r.id),!i&&s===y.RELATED_OBJECTS_TYPES.REPORTED_AGAINST)"true"===localStorage.getItem("assignPreferenceTemplate")&&o.parent.dispatchEvent("related-add-reportedAgainst",{data:m.options})}},r):r(u)}),a.getDocument().getRoots().length&&o.fields[s].treeListContainer.removeClassName("treelist-empty"),e(c)):e(c)},onFailure:function(e){r(e)}}):e(c)})},_addBalloon:function(e,t,s,n){f.get("component").utils.createBalloon({id:t,position:e,path:s,color:"red",parent:this,temporary:!0}).then(function(e){n.call(e)})},_removeSelectedNodes:function(e){var t=this.fields[e].treeList.getDocument().getSelectedNodes();t.length?this._removeNodes(t,e):l.displayNotification({msg:C.create.related.removeErrorNoSelection,eventID:"warning"})},_removeNodes:function(e,t){var s=this.fields[t].treeList;s.getDocument().withTransactionUpdate(function(){for(var t=e.length-1;t>=0;t--){var n=e[t];if(n.options.position&&n.options.position.balloons&&n.options.position.balloons.length)for(var i=n.options.position.balloons,o=0;o<i.length;o++)n.options.position.balloons[o].destroy();s.getDocument().removeRoot(n)}}),0===s.getDocument().getRoots().length&&this.fields[t].treeListContainer.addClassName("treelist-empty")},_addDropEvent:function(e){var t=0;e.addEventListener("drop",this._onTreeListDrop.bind(this)),e.addEventListener("dragenter",function(){e.addClassName("drag-enter"),t++}),e.addEventListener("dragleave",function(){0===--t&&e.removeClassName("drag-enter")}),document.addEventListener("dragover",function(e){e.preventDefault()})},_onTreeListDrop:function(e,t){e.currentTarget.removeClassName("drag-enter"),e.preventDefault();var s,n=this;if(s=t?t.parent.options.id:e.currentTarget.id,""!==e.dataTransfer.getData("text/searchitems"))JSON.parse(e.dataTransfer.getData("text/searchitems"));else if(""!==e.dataTransfer.getData("text/plain"))try{JSON.parse(e.dataTransfer.getData("text/plain"))}catch(e){}p.getDroppableData(e).then(e=>{var t=e.data.items;if(t){var i=[],o=!0;t.forEach(function(e){if(e.serviceId.includes(":")){const t=e.serviceId.split(":");e.serviceId=t[0]}y.NONSUPPORTED_TYPES.includes(e.objectType)||e.isIssue?o=!1:e.serviceId.toLowerCase().includes("3dspace")||e.hasOwnProperty("i3dx")&&""!=e.i3dx?"i3dx"in e&&""!=e.i3dx?i.push({id:e.i3dx,serviceId:e.serviceId}):"objectId"in e&&i.push({id:e.objectId,serviceId:e.serviceId}):o=!1}),o||l.displayNotification({msg:C.create.related.dropError,eventID:"warning"}),n._addNodes(i,s).then(function(e){e.error&&e.error.ids&&e.error.ids.length>0&&l.displayNotification({msg:C.create.related.dropError,eventID:"error"})})}else l.displayNotification({msg:C.create.related.dropError,eventID:"error"})})},_onDragStartCell:function(e,t){var n="";n=s.is(t,"object")?t.parent.options.id:e.currentTarget.id;var i=this.fields[n].treeList.getDocument().getSelectedNodes();if(0===i.length)return!1;var o=p.setDroppableData(i),a={type:o.type,data:JSON.stringify(o.data)};return e.dataTransfer.setData(a.type,a.data),this._ghost&&(this._ghost.destroy(),this._ghost=null),this._ghost=p.createGhostDrag(t.nodeModel.options,i.length),document.body.appendChild(this._ghost),e.dataTransfer.setDragImage(this._ghost,e.offsetX,e.offsetY),!0},fetchOccurencePath:function(e,t,s){var n=[];if(0!=e.length){for(var i=0;i<t.length;i++)if(t[i])for(var o=t[i].split(","),a=0;a<o.length;a++)0!=a&&a%2!=1&&a!=o.length-1||n.push(o[a]);h.fetch({data:{objects:n.map(function(e){return{physicalId:e}})},onComplete:function(t){var i=t.body;if(i.infos&&i.infos.nresults&&n.length!==i.infos.nresults&&l.displayNotification({msg:C.create.templateApplyWarningRelated,eventID:"warning"}),i.infos&&i.infos.nresults&&i.infos.nresults>0){var o={};e.forEach(function(e){o[e.options.id]="NewNode"}),s.getDocument().withTransactionUpdate(function(){var e={};"results"in i&&i.results.forEach(function(t){var s=v.parseFetchResponse(t);e[s.value.id]=s});for(var t=s.getRoots(),n=0;n<t.length;n++)if("NewNode"==o[t[n].options.id]){var a=t[n].options.id.split(","),r="",l="";a.length>0&&(r=e[a[a.length-1]].display.title);for(var c=0;c<a.length;c++)e[a[c]]&&c!=a.length-1&&(l+=e[a[c]].display.title,c!=a.length-2&&(l+="\\"));var d=t[n]._options.grid;1==a.length?(d.occurrence="",d["ds6w:label"]=r):(d.occurrence=l,d["ds6w:label"]=l),t[n].updateOptions({grid:d}),t[n].setLabel(r),t[n].options.title=r}})}},onFailure:function(e){}})}}})}),define("DS/IssueComponents/create/PropertiesNew",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/IssueComponents/create/Form","DS/Controls/Button","DS/Controls/ButtonGroup","DS/Controls/Editor","DS/Controls/LineEditor","DS/Controls/DatePicker","DS/Controls/TooltipModel","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/WebappsUtils/WebappsUtils","DS/PADUtils/views/PADAlert","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","DS/IssueComponents/create/CustomNew","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Parser","DS/IssueServices/utils/Performance","DS/WUXAutoComplete/AutoComplete","DS/Controls/ComboBox","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/IssueComponents/create/Classification","DS/IssueComponents/create/Specialization","DS/IssueComponents/search/PeopleSearch","DS/SearchWidget/SearchWidgetConstant","i18n!DS/IssueComponents/assets/nls/IssueComponents","text!DS/IssueCommon/assets/Settings.json","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f,h,g,v,b,C,y,I,E,S,w,T,D,A,_,O,N,R,M){"use strict";var L="ISU_TYPE_NLS",P=1e3;return t.extend({name:"DS/IssueComponents/create/PropertiesNew",tag:"div",className:"create-view-content-subview create-properties",isInit:null,_deferredInit:{resolve:null,reject:null},setup:function(t){var s=this;s._parent(t),s.parent=t.parent,s.isInit=new e(function(e,t){s._deferredInit.resolve=e,s._deferredInit.reject=t}),s.settings=JSON.parse(M),s.form=null,s.formElements={title:null,type:null,similarIssues:null,description:null,classifications:null,resolutionRecommendation:null,priority:null,resolutionDate:null,reportingOrganization:null,responsibleOrganization:null},s.formElementsToggler={description:null,classifications:null,resolutionRecommendation:null,priority:null,resolutionDate:null,reportingOrganization:null,responsibleOrganization:null},s.fields={title:null,titleLabel:null,similarIssues:null,similarIssuesLabel:null,description:null,escalationRequired:null,classifications:null,attributes:null,resolutionRecommendation:null,priority:null,resolutionDate:null,reportingOrganization:null,responsibleOrganization:null},s.values={libIDs:[],classIDs:[],classNames:[],reportingOrganization:null,responsibleOrganization:null,reportingOrganizationTitle:null,responsibleOrganizationTitle:null},s.selected={classes:{},attributes:{},_classificationData:[],templateAttributes:{},attributeFields:{}};var n=[];if(s.customPropertiesView=new v({parent:s}),n.push(s.customPropertiesView.isInit),s.specializeProperties=new _({parent:s}),n.push(s.specializeProperties.isInit),s.settings.enableClassification){var i=new e(function(e,t){C.classification.getLibraries().then(function(e){return e.member}).then(function(e){s.classModel=new T({shouldBeSelected:function(e){return"Class"===e.options.grid.type},useAsyncPreExpand:!0}),s.classModel.prepareUpdate(),e.forEach(function(e){if("Active"==e.state&&"Standard"!=e.libraryUsage){s.values.libIDs.push(e.id);var t=s._createNode(e.title,e.id,"library","Library",e.libraryName,e.id);s.classModel.addRoot(t)}}),s.classModel.onPreExpand(function(e){var t=e.data.nodeModel;t.hasChildren()?e.target.preExpandDone():C.classification.getClasses({libId:t.options.id}).then(function(n){var i=n.member[0].ChildClasses.member,o=""!==n.member[0].title?n.member[0].title:n.member[0].name;s.classModel.prepareUpdate(),i.forEach(function(n){if("Active"==n.state&&"Standard"!=n.classUsage){s.values.classIDs.push(n.id);var i=""!==n.title?n.title:n.name;s.values.classNames.push(i);var a=o+" > "+i,r=t.options.id+","+n.id,l=s._createNode(i,n.id,"library-class","Class",a,r);e.target.addChild(l);var c=function(e,t){e.ChildClasses&&e.ChildClasses.member&&e.ChildClasses.member.forEach(function(e){if("Active"==e.state&&"Standard"!=e.classUsage){s.values.classIDs.push(e.id);var n=""!==e.title?e.title:e.name;s.values.classNames.push(n),r=t.options.grid.idPath+","+e.id,a=t.options.grid.path+" > "+n;var i=s._createNode(n,e.id,"library-class","Class",a,r);t.addChild(i),c(e,i)}})};c(n,l)}}),s.classModel.pushUpdate(),e.target.preExpandDone()})}),s.classModel.pushUpdate()}).finally(function(){e()})});n.push(i)}var o=new e(function(e,t){C.organizations.getCompanies({onComplete:function(e){s.organizations=e.body},onFailure:function(){s.organizations=[]}}).finally(function(){e()})});n.push(o),e.all(n).then(s._deferredInit.resolve).catch(function(e){s._deferredInit.reject(e)}),s._similarIssues=[],s._debouncedSearch=h.debounce(s._searchSimilarIssues.bind(s),P)},_createNode:function(e,t,s,n,i,o){return new D({label:e,id:t,icons:[s],grid:{idPath:o,type:n,path:i},children:"Library"===n?[]:null})},_addClasesForLibraries:function(){var t=this,s=[],n=!0;return t.classModel.getRoots().forEach(function(i){if(!i.isExpanded()){n=!1;var o=new e(e=>{t._addClassesForLibrary(i).then(e)});s.push(o)}}),n?e.resolve():e.all(s)},_addClassesForLibrary:function(t){var s=this;return new e(e=>{C.classification.getClasses({libId:t.options.id}).then(function(n){if(t.isExpanded())e();else{s.classModel.prepareUpdate();var i=n.member[0].ChildClasses.member,o=""!==n.member[0].title?n.member[0].title:n.member[0].name;i.forEach(function(e){if("Active"==e.state&&"Standard"!=e.classUsage){s.values.classIDs.push(e.id);var n=""!==e.title?e.title:e.name;s.values.classNames.push(n);var i=o+" > "+n,a=t.options.id+","+e.id,r=s._createNode(n,e.id,"library-class","Class",i,a);t.addChild(r);var l=function(e,t){e.ChildClasses&&e.ChildClasses.member&&e.ChildClasses.member.forEach(function(e){if("Active"==e.state&&"Standard"!=e.classUsage){s.values.classIDs.push(e.id);var n=""!==e.title?e.title:e.name;s.values.classNames.push(n),a=t.options.grid.idPath+","+e.id,i=t.options.grid.path+" > "+n;var o=s._createNode(n,e.id,"library-class","Class",i,a);t.addChild(o),t.expandAll(),l(e,o)}})};l(e,r)}}),t.expandAll(),s.classModel.pushUpdate(),e()}})})},destroy:function(){this.form=null,this.formElements={title:null,type:null,similarIssues:null,description:null,classifications:null,resolutionRecommendation:null,priority:null,resolutionDate:null},this.formElementsToggler={description:null,classifications:null,resolutionRecommendation:null,priority:null,resolutionDate:null},this.fields={title:null,type:null,titleLabel:null,similarIssues:null,similarIssuesLabel:null,description:null,classifications:null,attributes:null,resolutionRecommendation:null,priority:null,resolutionDate:null},this.values={libIDs:[],classIDs:[],classNames:[]},this.selected={classes:{},attributes:{},_classificationData:[],templateAttributes:{},attributeFields:{}},this._issuesForSimilarity=null,s.is(this.specializeProperties,"object")&&this.specializeProperties.destroy(),s.is(this.customPropertiesView,"object")&&this.customPropertiesView.destroy()},render:function(){var e=this,t=b.get("widget")||window.widget;e.form=new n({className:"create-properties-form"}).inject(e.container),e.form.getContent().setAttribute("novalidate",!1);var i=new Date,o=new Date(i);o.setDate(o.getDate()-1);var a=new Date(i);a.setDate(a.getDate()+7);var r=s.createElement("div",{class:"create-form-content"}),l={id:"",name:"",element:"",type:"",placeholder:"",required:!1,value:"",minValue:"",maxValue:"",cssClass:"create-form-field",help:"",label:"",emphasize:"",icons:"",requiredText:R.create.required};l.element="title",l.type="text",l.placeholder="",l.required=!0,l.help=R.create.properties.labels.titleHelper,l.label=R.create.properties.labels.title,(d=e.createFormElement(l)).inject(r),l.element="type",l.type="subType",l.placeholder=R.create.properties.labels.titlePlaceholder,l.required=!1,l.help=R.create.properties.labels.typeHelper,l.label=R.create.properties.labels.type;var d=e.createFormElement(l);e.specializeProperties.noShowSubType||d.inject(r),l.element="securityContexts",l.type="comboBox",l.required=!1,l.label=R.create.properties.labels.credentials;let u=y.getSecurityContexts().cspaces;l.rangeItems=u.map(e=>({labelItem:e.label,valueItem:e.value})),l.value=t.getPreference("pad_security_ctx")?t.getPreference("pad_security_ctx").value:u[0].value,l.enableSearchFlag=!1;let m=e.createFormElement(l);u.length>1&&m.inject(r),e.parent.isTemplate&&m.hide();e.formElements.title.getElementsByClassName("form-group")[0].querySelectorAll("input, div");e.formElements.title.querySelectorAll("input")[0].oninput=function(t){var s=this.value;e.parent&&!e.parent.isTemplate&&e.parent.updateTitle(s),e.parent.isTemplate?(e.fields.titleLabel.getElement(".required-form-field-required-label").removeClassName("highlight"),e.fields.titleLabel.getElement(".required-form-field-title-label").removeClassName("highlight")):(e.fields.titleLabel.getElement(".required-form-field-required-label").addClassName("highlight"),e.fields.titleLabel.getElement(".required-form-field-title-label").addClassName("highlight")),e._debouncedSearch()},e.fields.title.addEventListener("change",function(t){var s=e.formElements.title.querySelectorAll("input")[0];if(!t||document.activeElement!==s){var n=e.fields.title.value.trim();e.fields.title.value=n,e.parent.isTemplate?(e.fields.titleLabel.getElement(".required-form-field-required-label").removeClassName("highlight"),e.fields.titleLabel.getElement(".required-form-field-title-label").removeClassName("highlight")):(e.fields.titleLabel.getElement(".required-form-field-required-label").addClassName("highlight"),e.fields.titleLabel.getElement(".required-form-field-title-label").addClassName("highlight")),e._debouncedSearch()}});var p=e.similarIssueDiv();e.formElements.similarIssues=p,p.inject(r),e.formElements.similarIssues.hide(),l.element="description",l.type="memo",l.placeholder=R.create.properties.labels.descriptionPlaceholder,l.required=!1,l.help=R.create.properties.labels.descriptionHelper,l.label=R.create.properties.labels.description,l.value="",l.rangeItems=[],e.createFormElement(l).inject(r),e.formElements.description.getElementsByClassName("form-group")[0].querySelectorAll("textarea").forEach(function(e){e.style.width="100%",e.style.fontSize="medium",e.style.resize="vertical",e.style.overflow="auto"}),e.createClassificationField(l).inject(r),l.element="resolutionRecommendation",l.type="memo",l.placeholder=R.create.properties.labels.resolutionRecommendationPlaceholder,l.required=!1,l.value="",l.minValue="",l.maxValue="",l.cssClass="",l.label=R.create.properties.labels.resolutionRecommendation,l.help=R.create.properties.labels.resolutionRecommendationHelper,e.createFormElement(l).inject(r),e.formElements.resolutionRecommendation.getElementsByClassName("form-group")[0].querySelectorAll("textarea").forEach(function(e){e.style.width="100%",e.style.fontSize="medium",e.style.resize="vertical",e.style.overflow="auto"}),l.element="priority",l.type="buttonToggle",l.placeholder=R.create.properties.labels.priority,l.required=!1,l.id=["Low","Medium","High","Urgent"],l.value=["low","medium","high","urgent"],l.emphasize=["success","info","medium-attention","high-attention"],l.icons=["level-low","level-medium","level-high","alert"],l.minValue="",l.maxValue="",l.cssClass="",l.label=R.priorities.title,l.help=R.create.properties.labels.priorityHelper,e.createFormElement(l).inject(r);var f=b.get("ISU_AUTO_DATES");l.element="resolutionDate",l.type="date",l.placeholder=R.create.properties.labels.dueDatePlaceholder,l.required=!1,l.value="true"==f?a:void 0,l.emphasize="",l.icons="",l.minValue=o,l.maxValue="",l.cssClass="",l.label=R.create.properties.labels.dueDate,l.help=R.create.properties.labels.dueDatePlaceholder,e.createFormElement(l).inject(r),e.formElements.resolutionDate.getElementsByClassName("form-group")[0].querySelectorAll("input").forEach(function(e){e.style.fontSize="medium"}),l.element="escalationRequired",l.name="escalationRequired",l.id="escalationRequired_id",l.type="comboBox",l.label=R.create.properties.labels.escalationRequired,l.rangeItems=[{labelItem:R.create.properties.labels.escalationRequired_No,valueItem:"No"},{labelItem:R.create.properties.labels.escalationRequired_Yes,valueItem:"Yes"}],l.value="No",l.selectedIndex=0,l.enableSearchFlag=!1,e.createFormElement(l).inject(r);let h=e.formElements.reportingOrganization=s.createElement("div",{class:"create-form-element create-properties-form-element-reporting-organization",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.reportingOrganization=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[{tag:"h5",html:R.create.team.labels.reportingOrganization},{tag:"div",html:[e.fields.addReportingOrganization=e._orgSearch("reportingOrganization"),e.fields.reportingOrganization=s.createElement("div",{class:"form-group-reporting-organization-holder"}),e.fields.reportingOrganization.reportingOrganizationHelper=s.createElement("div",{html:[s.createElement("span",{class:"fonticon fonticon-help"})]})]}]},{tag:"div",class:"create-form-help-tooltip",html:[e.fields.reportingOrganization.reportingOrganizationHelper]}]});e._setOrganization(y.getCurrentCredentials().organization,"reportingOrganization",y.getCurrentCredentials().details.orgNls),e.fields.reportingOrganization.reportingOrganizationHelper.tooltipInfos=new c({shortHelp:R.create.team.labels.reportingOrganizationHelper}),h.inject(r);let g=e.formElements.responsibleOrganization=s.createElement("div",{class:"create-form-element create-properties-form-element-responsible-organization",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[e.formElementsToggler.responsibleOrganization=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[{tag:"h5",html:R.create.team.labels.responsibleOrganization},{tag:"div",html:[e.fields.addResponsibleOrganization=e._orgSearch("responsibleOrganization"),e.fields.responsibleOrganization=s.createElement("div",{class:"form-group-responsible-organization-holder"}),e.fields.responsibleOrganization.responsibleOrganizationHelper=s.createElement("div",{html:[s.createElement("span",{class:"fonticon fonticon-help"})]})]}]},{tag:"div",class:"create-form-help-tooltip",html:[e.fields.responsibleOrganization.responsibleOrganizationHelper]}]});return e._setOrganization(y.getCurrentCredentials().organization,"responsibleOrganization",y.getCurrentCredentials().details.orgNls),e.fields.responsibleOrganization.responsibleOrganizationHelper.tooltipInfos=new c({shortHelp:R.create.team.labels.responsibleOrganizationHelper}),g.inject(r),r.inject(e.form.elements.container),e.values.libIDs.length>0?e.formElements.classifications.show():e.formElements.classifications.hide(),s.is(e.specializeProperties,"object")&&!e.specializeProperties.noShow&&e.form.elements.container.addContent(e.specializeProperties.render()),s.is(e.customPropertiesView,"object")&&!e.customPropertiesView.noShow&&e.form.elements.container.addContent(e.customPropertiesView.render()),e},similarIssueDiv:function(){return this.formElements.similarIssues=s.createElement("div",{class:"create-form-element create-properties-form-element-similar-issues",html:[{tag:"div",class:"create-form-field form-group",html:[this.fields.similarIssuesLabel=s.createElement("h5",{class:"create-form-field-similar-issues-label",html:R.create.properties.labels.similarIssues}),this.fields.similarIssues=s.createElement("div",{class:"create-form-field-similar-issues"})]}]}),this.formElements.similarIssues},createClassificationField:function(e){return this.formElements.classifications=s.createElement("div",{class:"create-form-element",html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[this.formElementsToggler.classifications=s.createElement("span",{class:"fonticon fonticon-eye"})]},{tag:"div",class:"create-form-field form-group",html:[{tag:"h5",html:R.create.properties.labels.classification},{tag:"div",html:[s.createElement("div",{class:"form-field-classification",html:this.fields.classifications=this._getClassificationField()}),this.fields.attributes=s.createElement("div",{class:"form-field-attributes"})]}]}]})},createFormElement:function(e){var t="create-form-element create-properties-form-element-"+e.element,n=this.formElements[e.element]=s.createElement("div",{class:t});this.parent.isTemplate&&!e.required&&this.createVisibilityMask(e).inject(n);return this.createFormGroup(e).inject(n),n},createFormGroup:function(e){var t=s.createElement("div",{class:"create-form-field form-group"});return(e.required?this.createRequiredLabel(e):this.createLabel(e)).inject(t),this.createFormField(e).inject(t),t},createVisibilityMask:function(e){return s.createElement("div",{html:[{tag:"div",class:"create-form-visibility-mask"},{tag:"div",class:"create-form-visibility-toggle",html:[this.formElementsToggler[e.element]=s.createElement("span",{class:"fonticon fonticon-eye"})]}]})},createRequiredLabel:function(e){var t=e.element+"Label",n="required-form-field-title-label"+(this.parent.isTemplate?"":" highlight"),i="required-form-field-required-label"+(this.parent.isTemplate?"":" highlight");return this.fields[t]=s.createElement("h5",{class:"required-form-field",html:[s.createElement("span",{class:n,html:R.create.properties.labels[e.element]}),s.createElement("div",{class:i+" wux-ui-3ds-required wux-ui-3ds"})]})},createLabel:function(e){e.element;return s.createElement("h5",{class:"create-form-field-label",html:e.label})},createFormField:function(e){var t=s.createElement("div",{name:e.name,id:e.id}),n=null;switch(e.type){case"text":case"memo":n=this.createTextField(e);break;case"date":n=this.createDateField(e);break;case"buttonToggle":n=this.createButtonToggle(e);break;case"subType":n=this.createSubTypePicker(e);break;case"comboBox":n=this.createComboBox(e)}return n.inject(t),t},createTextField:function(e){var t=null;return"text"===e.type?(t=this.fields[e.element]=new r({value:e.value,requiredFlag:e.required&&!this.parent.isTemplate,placeholder:e.placeholder})).getContent().setStyle("width","100%"):(t=this.fields[e.element]=new a({value:e.value,nbRows:4,requiredFlag:e.required&&!this.parent.isTemplate,placeholder:e.placeholder,newLineMode:"enter"})).getContent().setStyle("width","100%"),t},createDateField:function(e){return this.fields[e.element]=new l({value:e.value,minValue:e.minValue,maxValue:e.maxValue})},createButtonToggle:function(e){var t=this.fields[e.element]=new o({type:"radio"}),s=[];return e.value.forEach(function(n,o){var a=new i({label:R.priorities[n],value:e.id[o],icon:{iconName:e.icons[o],fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"},emphasize:e.emphasize[o],checkFlag:0===o});t.addEventListener("buttonclick",function(e){e.dsModel.checkFlag=!0}),s.push(a),t.addChild(a)}),t},createSubTypePicker:function(e){var t=null;return"type"==e.element&&(t=this.specializeProperties.getSubTypePicker()),t},show:function(){s.is(this.specializeProperties,"object")&&!this.specializeProperties.noShow&&this.specializeProperties.show(),s.is(this.customPropertiesView,"object")&&!this.customPropertiesView.noShow&&this.customPropertiesView.show(),this._parent(),this.formElements.title.querySelectorAll("input").length>0&&this.formElements.title.querySelectorAll("input")[0].focus()},hide:function(){s.is(this.specializeProperties,"object")&&this.specializeProperties.hide(),s.is(this.customPropertiesView,"object")&&this.customPropertiesView.hide(),this._parent()},validate:function(){var e=!1;return this.form.fields=Object.values(this.fields).filter(function(e){return null!==e}),e=this.form.validate(!1,!1),s.is(this.specializeProperties,"object")&&!this.specializeProperties.noShow&&(e=e?this.specializeProperties.validate():e),s.is(this.customPropertiesView,"object")&&!this.customPropertiesView.noShow&&(e=e?this.customPropertiesView.validate():e),e},getValues:function(){var e,t,n,i=this,o=new Date,a=i.fields.resolutionDate.value;null!=a&&""!==a&&(n=a.toString()),"true"==b.get("ISU_AUTO_DATES")&&(e=o.toString(),t=o.toString());var r;r=s.String.escapeHTML(i.fields.description.value);var l=[],c={};i.selected._classificationData.forEach(function(e){l.push(e[0].classId),e[0].classAttributes.forEach(function(e){c[e.name]=i.selected.attributes[e.name]?i.selected.attributes[e.name]:e.value})});var d={title:i.fields.title.value,description:r,securityContexts:i.fields.securityContexts.value,resolutionRecommendation:i.fields.resolutionRecommendation.value,priority:i.fields.priority.value[0],escalationRequired:i.fields.escalationRequired.value,resolutionDate:n,estimatedStartDate:e,estimatedEndDate:t,classes:l,attributes:c,classification:i.selected._classificationData,reportingOrganization:i.values.reportingOrganization,responsibleOrganization:i.values.responsibleOrganization,reportingOrganizationTitle:i.values.reportingOrganizationTitle,responsibleOrganizationTitle:i.values.responsibleOrganizationTitle,existingClassification:i.existingClassificationIds?i.existingClassificationIds:[]};return s.is(i.specializeProperties,"object")&&s.merge(d,i.specializeProperties.getValues()),s.is(i.customPropertiesView,"object")&&s.merge(d,i.customPropertiesView.getValues()),d},getHiddenAttributes:function(){var e={};for(var t in this.formElements)s.is(this.formElementsToggler[t])&&(e[t]=this.formElementsToggler[t].hasClassName("fonticon-eye-off"));return s.is(this.specializeProperties,"object")&&!this.specializeProperties.noShow&&s.merge(e,this.specializeProperties.getHiddenAttributes()),s.is(this.customPropertiesView,"object")&&!this.customPropertiesView.noShow&&s.merge(e,this.customPropertiesView.getHiddenAttributes()),e},applyTemplate:function(t){var n=this,i=b.get("widget")||window.widget;return n.reset().then(function(){var o=[];s.is(t.data.title)&&(n.fields.title.value=t.data.title,n.formElements.title.querySelectorAll("input")[0].oninput(),n.parent&&!n.parent.isTemplate&&n.parent.updateTitle(t.data.title));s.is(t.data.description)&&(n.fields.description.value=g.getTextFromHTML(t.data.description)),s.is(t.data.resolutionRecommendation)&&(n.fields.resolutionRecommendation.value=t.data.resolutionRecommendation),s.is(t.data.priority)&&(n.fields.priority.getButtonFromValue(t.data.priority).checkFlag=!0),s.is(t.data.resolutionDate)&&(n.fields.resolutionDate.value=t.data.resolutionDate),s.is(t.data.escalationRequired)&&(n.fields.escalationRequired.value=t.data.escalationRequired);let a=y.getSecurityContexts().cspaces;if(n.fields.securityContexts.value=i.getPreference("pad_security_ctx")?i.getPreference("pad_security_ctx").value:a[0].value,n.selected.templateAttributes=t.data.attributes,s.is(t.data.classification,"array")&&n.applyClass(t.data.classification),s.is(t.hidden,"object")&&s.is(n.formElements,"object")&&s.is(n.formElementsToggler,"object")){var r=n.formElements,l=n.formElementsToggler;for(var c in r)!0===t.hidden[c]&&(n.parent.isTemplate?(s.is(r[c])&&r[c].toggleClassName("visibility-masked",!0),s.is(l[c])&&(l[c].toggleClassName("fonticon-eye-off",!0),l[c].toggleClassName("fonticon-eye",!1))):s.is(r[c])&&r[c].hide())}return s.is(n.specializeProperties,"object")&&!n.specializeProperties.noShow&&o.push(n.specializeProperties.applyTemplate(t)),s.is(n.customPropertiesView,"object")&&!n.customPropertiesView.noShow&&o.push(n.customPropertiesView.applyTemplate(t)),s.is(t.data.responsibleOrganization)&&(t.data.responsibleOrganizationTitle?n._setOrganization(t.data.responsibleOrganization,"responsibleOrganization",t.data.responsibleOrganizationTitle):n._setOrganization(t.data.responsibleOrganization,"responsibleOrganization")),s.is(t.data.reportingOrganization)&&""!=t.data.reportingOrganization&&(t.data.reportingOrganizationTitle?n._setOrganization(t.data.reportingOrganization,"reportingOrganization",t.data.reportingOrganizationTitle):n._setOrganization(t.data.reportingOrganization,"reportingOrganization")),e.all(o)})},applyClass:function(t){var n=this;n.existingClassificationIds=t;var i=[],o=[];s.is(t)&&s.is(t[0])&&s.is(t[0][0])&&s.is(t[0][0].classIdPath)?t.forEach(function(t){var s=new e(e=>{var s=t[0],i=s.classIdPath.substring(0,s.classIdPath.indexOf(",")),a=n.classModel.getAllDescendants().filter(e=>e.options.grid.idPath==i);if(1==a.length)if(a[0].isExpanded()){var r={model:a[0],data:[t]};e(r)}else n._addClassesForLibrary(a[0]).then(()=>{var s={model:a[0],data:[t]};e(s)});else o.push(s),e()});i.push(s)}):i.push(new e(e=>{n._addClasesForLibraries().then(()=>{var s={model:n.classModel,data:t};e(s)})})),e.all(i).then(e=>{e.forEach(function(e){var t;e&&(t=e.model,e.data.forEach(function(e){var s=e[0],n=t.getAllDescendants().filter(e=>e.options.id===s.classId);0==n.length?o.push(s):n.map(e=>{e.select()})}))});var t=n.autoCompleteMultiSel.selectedItems;if(n.autoCompleteMultiSel._selectionChips.removeAllChips(),n.addBtn.disabled=!0,t&&t.length>0&&n._addClass(t),o.length>0){var s=o.map(e=>e.className).join(", ");p.displayNotification({msg:R.replace(R.templates.errors.classificationApplyTemplateFailed,{ClassNames:s}),eventID:"error"})}})},reset:function(){var t=this;return new e(function(e){t.fields.title.value="",t.formElements.title.querySelectorAll("input")[0].oninput();var s=new Date,n=new Date(s);n.setDate(n.getDate()+7);var i=b.get("ISU_AUTO_DATES");t.fields.resolutionRecommendation.value="",t.fields.priority.getButton(0).checkFlag=!0,t.fields.resolutionDate.value="true"==i?n:void 0,t.fields.description.value="",e()})},_searchSimilarIssues:function(){var e=this;if(s.is(e.fields)&&s.is(e.fields.title)&&s.is(e.fields.similarIssues)&&s.is(e.fields.similarIssuesLabel)&&s.is(e.formElements)&&s.is(e.formElements.similarIssues)){var t="";if(e.formElements.title.querySelectorAll("input").length>0)t=e.formElements.title.querySelectorAll("input")[0].value;t.length>0?C.search({data:{query:"(3dexpiss:#all) "+t,select_predicate:["resourceid","ds6w:created","ds6w:modified","ds6w:identifier","owner","ds6w:responsible","ds6wg:revision","ds6w:status","ds6w:label","ds6w:type"]}}).then(function(t){if(Array.isArray(t.body.results)?e._similarIssues=t.body.results.map(function(e){return I.parseFetchResponse(e).value}):e._similarIssues=[],e._similarIssues.length>0){e.fields.similarIssues.empty();for(var n=0;n<e._similarIssues.length;n++){var i=s.clone(e._similarIssues[n]),o=e._similarIssues[n].name+"  "+R.create.properties.labels.Created+" "+h.timeSince(new Date(i.created))+" "+R.create.properties.labels.ago+" by "+i.responsible+"  "+R.create.properties.labels.Updated+" "+h.timeSince(new Date(i.modified))+" "+R.create.properties.labels.ago,a=h.computeSharedIssuesURL([i.physicalId]);s.createElement("div",{class:"create-form-field-similar-issues-line",html:[s.createElement("a",{html:[s.createElement("div",{class:"create-form-field-similar-issues-line-title",html:[s.createElement("img",{src:h.getIconByState(i.state,i.type,i.typeIcon),title:R.maturity[i.state.toLowerCase()]}),s.createElement("span",{html:s.String.escapeHTML(e._similarIssues[n].title)})]}),s.createElement("div",{class:"create-form-field-similar-issues-line-info",html:h.getTextFromHTML(o)})],href:a,target:"_blank"})]}).inject(e.fields.similarIssues)}var r=h.computeSharedIssuesURL(e._similarIssues.map(function(e){return e.physicalId}));e.fields.similarIssuesLabel.setContent([R.create.properties.labels.similarIssues," (",{tag:"a",html:e._similarIssues.length,href:r,target:"_blank"},")"]),e.formElements.similarIssues.show()}else e.formElements.similarIssues.hide()}).catch(function(){e.formElements.similarIssues.hide()}):e.formElements.similarIssues.hide()}},_getClassificationField:function(){var e=this;return e.classificationField=new s.Element("div",{class:"classification-container"}),e.autoCompleteMultiSel=new S({elementsTree:e.classModel,placeholder:R.create.properties.labels.classificationPlaceholder}),e.autoCompleteMultiSel.addEventListener("change",function(){var t=e.autoCompleteMultiSel.selectedItems;e.selectedClasses=t,0===e.autoCompleteMultiSel._selectionChips.getNumberOfChips()&&(e.addBtn.disabled=!0);for(var s=!1,n=t.length-1;n>=0;n--)if(!e.values.classNames.includes(t[n].options.label)){e.autoCompleteMultiSel._selectionChips.removeChip(t[n].options.label),e.autoCompleteMultiSel.selectedItems.splice(n,1),s=!0;break}!s&&e.autoCompleteMultiSel._selectionChips.getNumberOfChips()>0&&(e.addBtn.disabled=!1)}),e.autoCompleteMultiSel.getContent().addEventListener("keydown",function(e){13==e.keyCode&&e.stopPropagation()}),e.autoCompleteMultiSel.inject(e.classificationField),e.addBtn=new i({label:R.create.properties.labels.classificationAddBtn,domId:"addBtn",disabled:!0}),e.addBtn.getContent().addEventListener("buttonclick",function(){e.autoCompleteMultiSel._selectionChips.removeAllChips(),e._addClass(e.selectedClasses),e.addBtn.disabled=!0}),e.addBtn.inject(e.classificationField),e.classificationField},_addClass:function(t){var s=this;s.classModel.unselectAll();var n=[];t.forEach(function(t){if(!s.selected.classes[t.options.id]){s.selected.classes[t.options.id]={};var i=new e(function(e){C.classification.getClassificationAttributesOfClass({id:t.options.id,onFailure:function(e){}}).then(function(s){e({data:s,item:t})})});n.push(i)}}),e.all(n).then(function(e){e.forEach(function(e){var t=[{classId:e.data.member[0].id,className:e.data.member[0].name,classPath:e.item.options.grid.path,classIdPath:e.item.options.grid.idPath,classAttributes:e.data.member[0].ClassAttributes.member}];s.classification=new A({classification:{data:t,attributes:s.selected.templateAttributes,selectedData:s.selected,classModel:s.classModel}});var n=s.classification.render();s.selected._classificationData.push(n._classificationData);var i=n.form;i.inject(s.fields.attributes,"top");var o={classId:e.data.member[0].id,element:i};s.selected.classes[e.item.options.id]=o})})},createComboBox:function(e){var t=e.rangeItems,s=function(){var e=new T;e.prepareUpdate();for(var s=0;s<t.length;s++){var n=t[s].labelItem,i=t[s].valueItem,o=new D({label:n,grid:{valueItem:i}});e.addRoot(o)}return e.pushUpdate(),e}();return this.fields[e.element]=new w({elementsTree:s,value:e.value,enableSearchFlag:1==e.enableSearchFlag})},_orgSearch:function(e){var t=this,s=new O({className:"searchPeople_TransferOwnership",MaxNumber:"5",MaxSize:"300",position:"auto",showEmptyCategory:!1,type:N.TYPE_ORGANIZATION,events:{onValid:function(){var n=s.getNewOwner().organization;t._setOrganization(n.orgID,e,n.orgTitle),s.clearInput(),s.getContent().searchInput.focus()},onUnvalid:function(){},onError:function(){p.displayNotification({msg:R.search.error.orgNotFound,eventID:"info"})}}});return s.setSelectedItemList([{objectID:t.organizations[0].physicalId}]),s},_setOrganization:function(e,t,n){if(!s.is(n)||""==n){n=e;var i=b.get(L);s.is(i)&&s.is(i["ds6w:organizationResponsible"][e])&&(n=i["ds6w:organizationResponsible"][e])}var o=s.createElement("div",{class:"team-content-org-container",html:[s.createElement("span",{class:"team-content-org-icon fonticon view-icon fonticon-users"}),s.createElement("span",{class:"team-content-org-info",html:h.getTextFromHTML(n)})]});this.fields[t].empty(),this.fields[t].appendChild(o),this.values[t]=e,this.values[t+"Title"]=n}})}),define("DS/IssueComponents/create/Create",["UWA/Class/Events","UWA/Class/Promise","UWA/Controls/Abstract","DS/Controls/TabBar","UWA/Core","DS/UIKIT/Iconbar","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/UIKIT/Toggler","DS/UIKIT/Tooltip","DS/Controls/ComboBox","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/Controls/Expander","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/LineEditor","DS/Controls/Editor","DS/IssueAttachmentManager/components/Collection","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueAttachmentManager/views/UploadDialog","i18n!DS/IssueAttachmentManager/assets/nls/IssueAttachmentManager","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/create/Custom","DS/IssueComponents/create/CustomNew","DS/IssueComponents/create/Attachments","DS/IssueComponents/create/Finalize","DS/IssueComponents/create/Properties","DS/IssueComponents/create/PropertiesNew","DS/IssueComponents/create/Related","DS/IssueComponents/create/Team","DS/IssueComponents/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","text!DS/IssueCommon/assets/Settings.json","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f,h,g,v,b,C,y,I,E,S,w,T,D,A,_,O,N,R,M,L,P,U,x,k,F,j,V,B){"use strict";var G="Issue",z={MULTI_STEP:"multi-step",FULL_VIEW:"full-view"},W={MULTI_STEP:"view-big-tile",FULL_VIEW:"view-list"},H="IssueCommon",Y=100,q="IssueTemplatesEnabled",K=600,X=600,J=13;return s.extend(e,{name:"DS/IssueComponents/create/Create",isLoaded:null,_deferred:{resolve:null,reject:null},_tooltips:[],_defaultViewMode:null,defaultOptions:{editMode:!1,isTemplate:!1,escapeToClose:!0,resizable:!0},overwrite:null,init:function(e,t){this._parent(t),this.parentContainer=e,this._logger=p.getLogger(this.name),this._logger.log("Initializing the creation component"),this.elements={dialog:null,header:null,body:null,footer:null},this.modeToggler={iconBar:null},this.navigator={container:null,toggler:null},this.content={container:null},this.scroller=null,this.buttons={create:null,saveAsDraft:null,cancel:null},this._tooltips=[],this.isTemplate=this.options.isTemplate,this.isIssueNewTemplate_Enabled=x.get(q),this._allViewsHaveBeenRendered=!1,this._defaultViewMode=localStorage.getItem("IssueCommonCreateViewMode"),this.activeMode=null,this.activeView=null,this.views={},this.settings=JSON.parse(V),this.views={properties:{id:0,key:"properties",label:B.create.views.properties,fonticon:"view-icon fonticon-newspaper",view:this.settings.enableClassification?new M({parent:this}):new R({parent:this}),order:2},related:{id:1,key:"related",label:B.create.views.relatedObjects,fonticon:"view-icon fonticon-location",view:new L({parent:this}),order:4},attachments:{id:2,key:"attachments",label:B.create.views.attachments,fonticon:"view-icon fonticon-attach",view:new O({parent:this}),order:5},team:{id:3,key:"team",label:B.create.views.team,fonticon:"view-icon fonticon-users",view:new P({parent:this}),order:6}}},destroy:function(){var e=this,t=x.get("component");t&&t._tasks&&t._tasks.current&&"SELECT_IN_3D"===t._tasks.current.taskType&&t.taskManager.cancel(t._tasks.current.taskId),e._tooltips.forEach(function(e){e.destroy()}),Object.keys(e.views).forEach(function(t){e.views[t].view.destroy(),e.views[t]=null}),e.elements={dialog:null,header:null,body:null,footer:null},e.modeToggler={iconBar:null},e.navigator={container:null,toggler:null},e.content={container:null},e.scroller.destroy(),e.scroller=null,e.buttons={create:null},e._tooltips=[],e._allViewsHaveBeenRendered=!1,e._defaultViewMode=null,e.activeMode=null,e.activeView=null,e.sortedViewsIds=null,e.views={},e.parentContainer=null},render:function(){var e=this;e.isLoaded=new t(function(t,s){e._deferred.resolve=t,e._deferred.reject=s});var s=Object.keys(e.views).map(function(t){return e.views[t].view.isInit});t.all(s).then(function(){Object.keys(e.views).forEach(function(t){e.views[t].view.noShow&&delete e.views[t]}),e.sortedViewsIds=Object.keys(e.views),e.sortedViewsIds.sort(function(t,s){return e.views[t].order-e.views[s].order}),e.footer(),e.body(),e.dialog(e.parentContainer)}).catch(e._deferred.reject)},dialog:function(e){var t=this,s=D.throttle(function(){t.onResize()},Y);t.elements.dialog=new m({animate:!0,autocenter:!0,closable:!0,escapeToClose:t.options.escapeToClose,limitParent:!1,overlay:!1,resizable:t.options.resizable,visible:!0,className:"create-view-dialog",title:"",body:t.elements.body,footer:t.elements.footer,events:{onShow:function(){t.build()},onResizeFloating:function(){s()},onMove:function(){},onClose:function(){t.dispatchEvent("onCreateDialogClose"),t.elements.dialog.destroy(),t.destroy()}}}),t.updateTitle(),e.hasOwnProperty("body")?t.elements.dialog.inject(e.body):t.elements.dialog.inject(e)},body:function(){var e=this;e.elements.body=i.createElement("div",{class:"create-view-body multi-step"+(e.isTemplate?" template-mode":"")}),e.elements.body.addEventListener("keydown",function(t){t.which===J&&e._create(!1)});var t=e.finalize=new N({parent:e}).render(),s=!1;e.isTemplate&&(s=!0),e.settingsExpander=new g({header:"",body:t,orientation:"horizontal",icon:"cog",expandedFlag:s}).inject(e.elements.body),e.settingsExpander.elements.header.title=B.create.settings,e.createContainer=i.createElement("div",{class:"create-container"}).inject(e.elements.body),e.navigator.container=i.createElement("nav",{class:"create-view-navigator-container"}).inject(e.createContainer),e._createPanelTabBar(["strip"],e.navigator.container),e.content.container=i.createElement("div",{class:"create-view-content"}).inject(e.createContainer),e.content.scrollable=i.createElement("div",{class:"create-view-scrollable-content"}),e.scroller=new l({element:e.content.scrollable}).inject(e.content.container),e.sortedViewsIds.forEach(function(t){var s=e.views[t];s.view&&(s.view.inject(e.scroller.getInnerElement()),s.view.hide())});var n={scroll:e._onScroll.bind(e)};e.scroller.elements.content.addEvents(n)},_createPanelTabBar:function(e,t,s){var i=this;s||(s="properties"),i.createPanelTabs&&i.createPanelTabs.destroy(),i.createPanelTabs=new n({displayStyle:e,minWidth:"100%"}),i.createPanelTabs.add({label:B.create.views.properties,isSelected:"properties"==s,icon:{iconName:"newspaper",fontIconFamily:WUXManagedFontIcons.Font3DS}}),i.createPanelTabs.add({label:B.create.views.relatedObjects,isSelected:"related"==s,icon:{iconName:"location",fontIconFamily:WUXManagedFontIcons.Font3DS}}),i.createPanelTabs.add({label:B.create.views.attachments,isSelected:"attachments"==s,icon:{iconName:"attach",fontIconFamily:WUXManagedFontIcons.Font3DS}}),i.createPanelTabs.add({label:B.create.views.team,isSelected:"team"==s,icon:{iconName:"users",fontIconFamily:WUXManagedFontIcons.Font3DS}}),i.createPanelTabs.inject(t),i.createPanelTabs.addEventListener("tabButtonClick",function(e,t){let s=e.dsModel.value[0],n=i._getViewIdFromTabValue(s);i.switchView(n)})},footer:function(){var e=this;e.elements.footer=i.createElement("div",{class:"create-view-footer"}),e.modeToggler.iconBar=new o({renderTo:e.elements.footer,items:[{name:"SwitchView",fonticon:e._defaultViewMode===z.FULL_VIEW?W.MULTI_STEP:W.FULL_VIEW,text:e._defaultViewMode===z.FULL_VIEW?B.create.modeToggler.tooltipMultiStep:B.create.modeToggler.tooltipFullView,handler:function(){var t=e.modeToggler.iconBar.getItem("SwitchView").elements.icon,s=e.modeToggler.iconBar.getItem("SwitchView").tooltip;!0===t.hasClassName("fonticon-"+W.MULTI_STEP)?(t.removeClassName("fonticon-"+W.MULTI_STEP),t.addClassName("fonticon-"+W.FULL_VIEW),s.setBody(B.create.modeToggler.tooltipFullView),e.switchViewMode(z.MULTI_STEP)):(t.removeClassName("fonticon-"+W.FULL_VIEW),t.addClassName("fonticon-"+W.MULTI_STEP),s.setBody(B.create.modeToggler.tooltipMultiStep),e.switchViewMode(z.FULL_VIEW))}}]});var t=i.createElement("div",{class:"create-view-footer-btn-container"}).inject(e.elements.footer);((e.buttons.create=new a({value:e.isTemplate?B.create.saveButton:B.create.sendButton,id:"create-view-footer-create-btn",className:"primary"}).inject(t)).addEvent("onClick",function(){e._create()}),e.isTemplate)||(e.buttons.saveAsDraft=new a({value:B.create.saveAsDraftButton,id:"create-view-footer-save-as-draft-btn",className:"default"}).inject(t)).addEvent("onClick",function(){e._create(!0)});(e.buttons.cancel=new a({value:B.create.cancelButton,id:"create-view-footer-cancel-btn",className:"default"}).inject(t)).addEvent("onClick",function(){e.cancel()})},build:function(){var e=this;if(!e._allViewsHaveBeenRendered){var t=function(e,t,s){return function(){i.is(e[s])&&e[s].toggleClassName("visibility-masked"),i.is(t[s])&&(t[s].toggleClassName("fonticon-eye"),t[s].toggleClassName("fonticon-eye-off"))}};Object.keys(e.views).forEach(function(s){var n=e.views[s];if(n.view&&(n.view.render(),e.isTemplate&&i.is(n.view.formElements,"object")&&i.is(n.view.formElementsToggler,"object"))){var o=n.view.formElements,a=n.view.formElementsToggler;for(var r in o)i.is(a[r])&&a[r].addEventListener("click",t(o,a,r))}});var s=e.finalize.formElements,n=e.finalize.formElementsToggler;for(var o in s)i.is(n[o])&&n[o].addEventListener("click",t(s,n,o));e.switchViewMode(e._defaultViewMode?e._defaultViewMode:z.MULTI_STEP),e.switchView(e.sortedViewsIds[0]),e._allViewsHaveBeenRendered=!0,e._deferred.resolve()}},onResize:function(){var e=this.elements.dialog.elements.container.getSize(),t=e.width<K,s=e.height<X;this.elements.dialog.elements.container.toggleClassName("responsive-width-phone",t),this.elements.dialog.elements.container.toggleClassName("responsive-height-phone",s)},updateTitle:function(e){var t=this.options.editMode?B.create.titleActionEdit:B.create.titleActionCreate;t+=" ",t+=this.isTemplate?B.create.titleTemplate:B.create.title,e&&e.length&&(t+=": "+e),this.elements.dialog.setTitle(t)},_getViewIdFromTabValue:function(e){const{properties:t,related:s,attachments:n,team:i}=this.views;return[t,s,n,i].reduce((t,s)=>(s.id===e&&t.push(s),t),[])[0].key},_navItem:function(e){var t=this,s={};return s.container=i.createElement("a",{id:e.id,class:"nav-item"}),s.container.addEventListener("click",function(){t.activeMode===z.FULL_VIEW&&t.activeView===e.id&&t._highlightElement(e.view.container)}),s.container.addEventListener("dragover",function(){t.switchView(e.id)}),s.activeIndicator=i.createElement("div",{class:"nav-item-active-indicator"}).inject(s.container),i.createElement("span",{class:"fonticon fonticon-expand-down"}).inject(s.activeIndicator),s.circle=i.createElement("div",{class:"nav-item-circle"}).inject(s.container),i.createElement("span",{class:"fonticon "+e.fonticon}).inject(s.circle),s.label=i.createElement("div",{class:"nav-item-label",html:e.label}).inject(s.container),s},switchViewMode:function(e){var t=this;if(t.elements.body)if(e===z.MULTI_STEP)t._createPanelTabBar(["strip"],t.navigator.container,t.activeView),t.elements.body.addClassName("multi-step"),Object.keys(t.views).forEach(function(e){e!==t.activeView&&"view"in t.views[e]&&t.views[e].view.hide()});else if(t.elements.body.removeClassName("multi-step"),t._createPanelTabBar(["strip","vertical"],t.navigator.container,t.activeView),Object.keys(t.views).forEach(function(e){"view"in t.views[e]&&t.views[e].view.show()}),t.activeView in t.views&&"view"in t.views[t.activeView]){var s=t.views[t.activeView].view.container;t.scroller.scrollToElement(s),t._highlightElement(s)}t.activeMode=e,localStorage.setItem("IssueCommonCreateViewMode",e)},switchView:function(e){var t=this;if(t.navigator&&t.navigator.container&&t.activeView){var s=t.navigator.container.getElements("a"),n=!1;s.forEach(function(s){if(!1===n?s.removeClassName("filled").addClassName("filled"):s.removeClassName("filled"),s.id===t.activeView&&s.removeClassName("active"),s.id===e){s.addClassName("active");var i=s.getElement(".view-icon.fonticon");if(t.elements.body.hasClassName("multi-step")){var o=i.getPosition().x/t.navigator.container.getSize().width*100;o+=10,t.navigator.container.getElement(".ariadne-rope").setStyles({width:o+"%",height:"2px"})}else{var a=i.getPosition().y/t.navigator.container.getSize().height*100;t.navigator.container.getElement(".ariadne-rope").setStyles({width:"2px",height:a+"%"})}n=!0}})}if(t.activeMode===z.MULTI_STEP)t.activeView in t.views&&"view"in t.views[t.activeView]&&t.views[t.activeView].view.hide(),e in t.views&&"view"in t.views[e]&&t.views[e].view.show();else if(e in t.views&&"view"in t.views[e]&&t.scroller){var i=t.views[e].view.container;t.scroller.scrollToElement(i),t._highlightElement(i)}t.activeView=e},applyTemplate:function(e,s){var n=this;for(var i in s&&!0===s.overwrite&&(n.overwrite=e),r.mask(n.elements.dialog.getBody()),n.buttons)n.buttons.hasOwnProperty(i)&&n.buttons[i]&&n.buttons[i].disable();var o=Object.keys(n.views),a=[];if(o.forEach(function(t){var s=n.views[t];"applyTemplate"in s.view&&a.push(s.view.applyTemplate(e))}),a.push(n.finalize.applyTemplate(e)),!n.options.editMode&&!n.isTemplate){new Date;if(e.info){var l=[];U.getRecentlyUsedTemplates().then(function(t){if(""!==t.body&&(l=t.body),null!=e.id&&null!=e.info.name){var s={physicalId:e.id,name:e.info.name},i=l.findIndex(t=>t.physicalId==e.id);-1!=i?l.splice(i,1):3==l.length&&l.pop(),l.unshift(s)}U.setRecentlyUsedTemplates(l).catch(function(e){n._logger.error("Could not save the preferences: %o",e)})})}}return t.all(a).then(function(e){for(var t in r.unmask(n.elements.dialog.getBody()),n.buttons)n.buttons.hasOwnProperty(t)&&n.buttons[t]&&n.buttons[t].enable();return e})},applyIssue:function(e){var t=this,s=x.get("widget")||window.widget,n={};return k.preferences.getApprovalEnablement({data:{}}).then(function(e){var s=e.body.ApprovalProcess;t.adminPreference=s}),k.issues.retrieve({data:{objects:[{physicalId:e.id}]}}).then(function(o){var a=o.results[o.results.length-1].body;return n={id:"template-"+s.id+"-"+Date.now(),info:{description:null,name:null},ui:{assignees:U.template.formatMemebersValues(a.assignees),responsibleOrganization:a.responsibleOrganization,coOwners:U.template.formatMemebersValues(a.coOwners),contributors:U.template.formatMemebersValues(a.contributors),informedUsers:U.template.formatMemebersValues(a.informedUsers)},data:{assignees:a.assignees,automationTasks:[],contexts:a.contexts,custom:a.custom,specialization:a.specialization,description:a.description||"",escalationRequired:a.escalationRequired,priority:a.priority||"Low",reportedAgainst:a.reportedAgainst,resolutionDate:a.resolutionDate,resolutionRecommendation:a.resolutionRecommendation||"",responsibleOrganization:a.responsibleOrganization,reportingOrganization:a.reportingOrganization,responsibleOrganizationTitle:a.responsibleOrganizationTitle,reportingOrganizationTitle:a.reportingOrganizationTitle,title:a.title||"",type:a.type||G,securityContexts:a.collaborativeSpace},hidden:{},applyIssue:!0},i.is(a.waitingOn,"string")&&("Always"==t.adminPreference?(a.waitingOn="Analyst",n.data.automationTasks.push("enableApproval")):"Never"==t.adminPreference?a.waitingOn="Unassigned":(t.adminPreference="Analyst"===a.waitingOn)&&n.data.automationTasks.push("enableApproval")),U.template.getDocuments(e.id)}).then(function(t){return n.data.attachments=t,U.template.getPrimary(e.id)}).then(function(t){return n.data.primaryAttachment=t,U.classification.getClassificationAttrValues(e.id)}).then(function(s){var i=[],o={};return s.member[0].ClassificationAttributes.member.forEach(function(e){var t=[],s={classId:e.ClassID};t.push(s),i.push(t),e.Attributes.forEach(function(e){o[e.name]=e.value})}),n.data.classification=i,n.data.attributes=o,t.applyTemplate(n).then(function(){f.displayNotification({msg:B.replace(B.create.issueApplySuccess,{title:e["ds6w:label"],name:e["ds6w:identifier"]}),eventID:"info"})})}).catch(function(s){f.displayNotification({msg:B.replace(B.create.issueApplyError,{title:e["ds6w:label"],name:e["ds6w:identifier"]}),eventID:"error"}),t._logger.error(s)})},cancel:function(){this.elements.dialog.options.events.onClose()},getDialog:function(){return this.elements.dialog},_onScroll:function(){var e=this;setTimeout(function(){if(e.activeMode===z.FULL_VIEW){var t=e.scroller._infos.y.scrollPosition;Object.keys(e.views).forEach(function(s){var n=e.views[s];if(n.view&&n.view.container){var i=n.view.container;if(t>=i.offsetTop&&t<i.offsetTop+i.offsetHeight){e.activeView=s;let t=e.views[s].id;e.createPanelTabs.getButtonFromValue(t).checkFlag=!0}}})}},0)},_highlightElement:function(e){e.addClassName("highlight"),e.addEventListener("animationend",function(){e&&e.removeClassName("highlight")})},_create:function(e){var s=this,n=x.get("widget")||window.widget;for(var i in s.closeDialog=!0,r.mask(n.body),s.buttons)s.buttons.hasOwnProperty(i)&&s.buttons[i]&&s.buttons[i].disable();return s.elements.dialog.rightButtons.getElement(".fonticon-cancel").addClassName("disabled"),(s.isTemplate?s._validate().then(function(){return s._saveAsIssueTemplate()}).then(function(e){return s.setTemplateAsRecentlyUsed(e.physicalId,s.templateData),t.resolve(e)}).then(function(e){return s._connectAttachments(e.physicalId,e.isEdit),t.resolve(e)}).then(function(e){return s._publishTemplateCreateEvent(e),t.resolve(e)}).then(function(e){return Array.isArray(s.templateData.classes)&&s.templateData.classes.length>0||Array.isArray(s.templateData.existingClassification)&&s.templateData.existingClassification.length>0?U.classification.getCSRFToken(e):{issueId:e.physicalId,isEdit:e.isEdit}}).then(function(e){var t=[];return s.templateData.existingClassification.length>0&&(t=s.templateData.existingClassification.map(function(e){return e[0].classId})),t.length>0&&e.isEdit?U.classification.deClassifyObject(t,e).then(t=>e):e}).then(function(e){return Array.isArray(s.templateData.classes)&&s.templateData.classes.length>0?U.classification.classifyObject(s.templateData.classes,e):e}).then(function(e){return Array.isArray(s.templateData.classes)&&s.templateData.classes.length>0?U.classification.getClassAttrVals(e):e}).then(function(e){if(e.cestamp){var t=s.templateData.attributes;return U.classification.setClassificationValues(t,e)}return e}).then(function(e){var t=x.get("templateComponentDialog")?x.get("templateComponentDialog"):x.get("templateComponent");return t&&U.classification.addClassificationColumn(s.templateData,t.templateList,"template"),e.issueId}).catch(function(){}):s._validate().then(function(){return s._createRequest(e)}).then(function(e){var n=e.physicalId;return s._publishEvent(n,"DS/Object/create"),t.resolve(e)}).then(function(e){return new t(function(t,n){s._connectAttachments(e.physicalId).then(function(){t(e)}).catch(n)})}).then(function(e){return Array.isArray(s.createData.classes)&&s.createData.classes.length>0||Array.isArray(s.createData.existingClassification)&&s.createData.existingClassification.length>0?U.classification.getCSRFToken(e):{issueId:e.physicalId,isEdit:e.isEdit}}).then(function(e){return Array.isArray(s.createData.classes)&&s.createData.classes.length>0?U.classification.classifyObject(s.createData.classes,e):e}).then(function(e){return Array.isArray(s.createData.classes)&&s.createData.classes.length>0?U.classification.getClassAttrVals(e):e}).then(function(e){if(e.cestamp){var t=s.createData.attributes;return U.classification.setClassificationValues(t,e)}return e}).then(function(e){var t=x.get("component");return U.classification.addClassificationColumn(s.createData,t,"issue"),e.issueId}).then(function(e){var n=[];return n.push(s._execAutomationTasks(e)),t.all(n)})).catch(function(e){return s._logger.error(e),t.reject(e)}).finally(function(){for(var e in r.unmask(n.body),s.buttons)s.buttons.hasOwnProperty(e)&&null!==s.buttons[e]&&s.buttons[e].enable();s.elements.dialog.rightButtons.getElement(".fonticon-cancel").removeClassName("disabled"),s.closeDialog&&s.elements.dialog.options.events.onClose()})},_createRequest:function(e){var t=this,s=Object.keys(t.views),n={};return s.forEach(function(e){var s=t.views[e];"getValues"in s.view&&i.merge(n,s.view.getValues())}),i.merge(n,t.finalize.getValues()),t.createData=n,i.is(n.custom)&&Object.values(n.custom)&&Object.values(n.custom).forEach((e,t)=>{Array.isArray(e)&&(n.custom[Object.keys(n.custom)[t]]=e.toString())}),i.is(n.description,"string")&&(n.description=U.getTextFromHTML(n.description),n.description.match(/.*\n$/)&&(n.description=n.description.replace(/\n+$/,""))),n.state=!0!==e?"Assign":"Create",k.issues.create({data:n}).then(function(e){try{D.cloudProbeUtils.sendCreateIssueTrackerEvent(t),"CreateFrom3D"==t.options.issueCreationType&&D.cloudProbeUtils.sendI3DRCommandsTrackerEvent({options:{pd1:"Issue",pd2:"3DViewer",pd3:"Issue3DReviewToolbar",pd4:"NewIssue",pd5:"Issue/3DViewer/Issue3DReviewToolbar/NewIssue"}})}catch(e){}finally{const t=B.replace(B.create.creationSuccess,{title:n.title});return f.displayNotification({msg:t,eventID:"success"}),e.body}}).catch(function(e){if(t.closeDialog=!1,e.error&&e.error.internal&&e.error.internal.includes("You need at least one assignee to create an issue, as a validation process is attached to the issue for assignees")){var s=D.getErrorMessage("1004");D.displayErrorMessage(s,"error")}else if(i.is(e.error,"object")&&i.is(e.error.internal)&&(e.error.internal.includes("ErrorCode:2004")||e.error.internal.includes("Admin not allowed to create Issue"))){s=D.getErrorMessage("4");D.displayErrorMessage(s,"error")}else if(i.is(e.error,"object")&&i.is(e.error.internal)&&e.error.internal.includes("ErrorCode:2006")){s=(s=e.error.internal).replace("ErrorCode:2006","").replace("java.lang.Exception:",""),f.displayNotification({msg:s,eventID:"error"})}else if(i.is(e.error,"object")&&i.is(e.error.internal)&&e.error.internal.includes("exceeds maximum length")){s=e.error.message;f.displayNotification({msg:s,eventID:"error"})}else f.displayNotification({msg:B.create.creationFailed,eventID:"error"});t._logger.error(e)})},_validate:function(){var e=this,s=Object.keys(e.views);return new t(function(t,n){var i=s.every(function(t){var s=e.views[t],n=!0;return"validate"in s.view&&(n=s.view.validate()),n});i&&(i=e.finalize.validate()),i?t():(f.displayNotification({msg:B.create.validationFailed,eventID:"error"}),e.closeDialog=!1,n(new Error("invalid fields")))})},_connectAttachments:function(e,s){var n=this,i=x.get("widget")||window.widget;if("attachments"in n.views&&"collection"in n.views.attachments.view){var o=n.views.attachments.view.collection,a=n.views.attachments.view.catalog,r=function(e){this.set("isCancelable",!0),this.set("request",e)},l=function(e){if(e.lengthComputable){var t=e.loaded/e.total;this.set("requestProgress",t)}},c=function(){this.set("isCancelable",!1),this.set("request",null)};return new t((t,i)=>{if(s)return U.template.getDocuments(e).then(function(s){var i=s,a=[];o.forEach(e=>{i.includes(e.get("id"))&&a.push(e)}),a.forEach(e=>{i.splice(i.indexOf(e.get("id")),1)}),i.length>0&&E.disconnectDocumentsFromParent(i,e),a.forEach(t=>{!0===t.get("isPrimary")&&E.setAsPrimary(t.get("id"),e,!0).then(function(){f.displayNotification({msg:w.notifications.SetAsPrimary.success,eventID:"info"})}).catch(function(e){f.displayNotification({msg:w.notifications.SetAsPrimary.failure,eventID:"error"}),n._logger.error(e)}),o.remove(t)}),t()});t()}).then(s=>{var d=o.filter(function(e){return!0===e.get("isFile")}).map(function(e){var t=e.clone();return t.set("isProcessing",!0),t}),u=[];if(d.length>0){var m=new I({id:e||"template",attachments:d});new S({container:i.body,collection:m}).render(),u=d.map(function(s){t.resolve();return(null!=e?E.uploadFile(s.get("file"),e,{onCheckinStart:r.bind(s),onCheckinProgress:l.bind(s),onCheckinComplete:c.bind(s)}):E.uploadFile(s.get("file"),null,{onCheckinStart:r.bind(s),onCheckinProgress:l.bind(s),onCheckinComplete:c.bind(s)})).then(function(e){if(e&&e.data&&e.data.length>0&&e.data[0].id){var t=o.get(s.id);t&&(t.set("id",e.data[0].id),t.set("isFile",!1),a.attachments[e.data[0].id]=a.attachments[s.id],a.attachments[e.data[0].id].id=t.get("id"),a.attachments[e.data[0].id].container.id=t.get("id"),a.attachments[e.data[0].id].container.setAttribute("id","attachment-"+t.get("id")),a.attachments[e.data[0].id].container.setData("id",t.get("id")),delete a.attachments[s.id],s.set("id",e.data[0].id),s.set("isFile",!1),s.set("isProcessing",!1))}}).catch(function(e){s.set("isFailed",!0),s.set("isProcessing",!1),s.set("isCancelable",!1),s.set("request",null),e instanceof Error&&(f.displayNotification({msg:w.replace(w.notifications.Upload.failure,{count:1}),eventID:"error"}),n._logger.error(e))})})}var p=o.filter(function(e){return!0!==e.get("isFile")}).map(function(e){return e.clone()}),h=[];p.length>0&&(h=p.map(function(s){return null!=e?E.connectDocumentToParent(s.id,e).catch(function(e){f.displayNotification({msg:w.notifications.Attach.failure,eventID:"error",count:1}),n._logger.error(e)}):t.resolve()})),t.all(u.concat(h)).then(function(){var s=o.filter(function(e){return!0===e.get("isPrimary")});if(1===s.length){var i=s[0];return E.setAsPrimary(i.get("id"),e,!0).then(function(){f.displayNotification({msg:w.notifications.SetAsPrimary.success,eventID:"info"})}).catch(function(e){f.displayNotification({msg:w.notifications.SetAsPrimary.failure,eventID:"error"}),n._logger.error(e)})}return t.resolve()})}).catch(e=>{})}return t.resolve()},_execAutomationTasks:function(){var e=this,s=t.resolve();if(e.finalize){if(-1!==e.finalize.getTasks().indexOf("saveAsTemplate"))return e._saveAsIssueTemplate().then(function(s){return e.setTemplateAsRecentlyUsed(s.physicalId,e.templateData),t.resolve(s)}).then(function(s){return e._connectAttachments(s.physicalId,s.isEdit),t.resolve(s)}).then(function(s){return e._publishTemplateCreateEvent(s),t.resolve(s)}).then(function(t){return Array.isArray(e.templateData.classes)&&e.templateData.classes.length>0||Array.isArray(e.templateData.existingClassification)&&e.templateData.existingClassification.length>0?U.classification.getCSRFToken(t):{issueId:t.physicalId,isEdit:t.isEdit}}).then(function(t){return Array.isArray(e.templateData.classes)&&e.templateData.classes.length>0?U.classification.classifyObject(e.templateData.classes,t):t}).then(function(t){return Array.isArray(e.templateData.classes)&&e.templateData.classes.length>0?U.classification.getClassAttrVals(t):t}).then(function(t){if(t.cestamp){var s=e.templateData.attributes;return U.classification.setClassificationValues(s,t)}return t}).then(function(t){var s=x.get("templateComponentDialog")?x.get("templateComponentDialog"):x.get("templateComponent");return s&&U.classification.addClassificationColumn(e.templateData,s.templateList,"template"),t.issueId}).then(()=>{var e=x.get("templateComponentDialog")?x.get("templateComponentDialog"):x.get("templateComponent");e&&e.refreshTemplateList()})}else s=t.resolve();return s},_saveAsIssueTemplate:function(){x.get("widget")||window.widget;var e=this.getTemplateFinalData();return this.templateData=e.data,!0===i.is(this.overwrite,"object")&&(e.id=this.overwrite.id,!0===this.templates.isShared(this.overwrite)&&(e.metadata.info.share=this.overwrite.info.share)),this.options.editMode?this.templates.editIssueTemplate(e).then(function(e){var t=B.create.updateTemplateSuccess;return f.displayNotification({msg:t,eventID:"success"}),{physicalId:e.body.physicalId,isEdit:!0}}):this.templates.createIssueTemplate(e).then(function(e){if(!e.error){const s=e.body.templateTitle;var t=B.replace(B.create.creationTemplateSuccess,{title:s});return f.displayNotification({msg:t,eventID:"success"}),{physicalId:e.body.physicalId,isEdit:!1}}if(e.error.internal.includes("No create access to business object")){var s=D.getErrorMessage("4");D.displayErrorMessage(s,"error")}else f.displayNotification({msg:e.error.message,eventID:"error"})})},getTemplateFinalData:function(){var e=this,t=Object.keys(e.views),s={},n={};t.forEach(function(t){var o=e.views[t];"getValues"in o.view&&i.merge(s,o.view.getValues(!0)),"getHiddenAttributes"in o.view&&i.merge(n,o.view.getHiddenAttributes(!0))}),i.is(s.custom)&&Object.values(s.custom)&&Object.values(s.custom).forEach((e,t)=>{Array.isArray(e)&&(s.custom[Object.keys(s.custom)[t]]=e.toString())}),i.merge(n,e.finalize.getHiddenAttributes(!0)),s.automationTasks=e.finalize.getTasks();var o=e.finalize.getTemplateValues();return o.version=x.version,o.tenant=F.getTenant(),s.templateTitle=o.name,s.templateDescription=o.description,s.securityContexts=o.securityContexts,{id:"",data:s,metadata:{hidden:n,info:o,data:{securityContexts:s.securityContexts,title:s.title,description:s.description,automationTasks:s.automationTasks}}}},setTemplateAsRecentlyUsed:function(e,t){var s=[];U.getRecentlyUsedTemplates().then(function(n){""!==n.body&&(s=n.body);var i={physicalId:e,name:t.templateTitle},o=s.findIndex(t=>t.physicalId==e);-1!=o?s.splice(o,1):3==s.length&&s.pop(),s.unshift(i),U.setRecentlyUsedTemplates(s).catch(function(e){that._logger.error("Could not save the preferences: %o",e)})})},_publishEvent:function(e,t){var s=x.get("widget")||window.widget,n=[],i={};n.push([e]),i[e]={};var o=Math.floor(Date.now()),a={metadata:{appId:s.id,appName:H,timestamp:o,options:{}},data:{paths:n,attributes:i},version:"1.0"};h.publish(t,a)},_publishTemplateCreateEvent:function(e){this.dispatchEvent("onTemplateCreate",{isEdit:e.isEdit,physicalId:e.physicalId})},templates:{getIssueTemplates:function(){return new t(function(e,t){require(["DS/IssueComponents/templates/TemplatesDataGridLayout"],function(s){var n=new s(x.get("widget"),{editMode:!0,onClose:function(){},onEnd:function(){}});n.getIssueTemplates().then(function(t){e(t)},function(e){t(e)}).finally(function(){n=null})})})},createIssueTemplate:function(e){return new t(function(t,s){require(["DS/IssueComponents/templates/TemplatesDataGridLayout"],function(n){var i=new n(x.get("widget"),{editMode:!0,onClose:function(){},onEnd:function(){}});i.createIssueTemplate(e).then(t,s).finally(function(){i=null})})})},editIssueTemplate:function(e){return new t(function(t,s){require(["DS/IssueComponents/templates/TemplatesDataGridLayout"],function(n){var i=new n(x.get("widget"),{editMode:!0,onClose:function(){},onEnd:function(){}});i.editIssueTemplate(e).then(t,s).finally(function(){i=null})})})},isShared:function(e){return!0===i.is(e.info.share,"object")}}})}),define("DS/IssueComponents/templates/TemplatesDataGridView",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Iconbar","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Popover","DS/UIKIT/Scroller","DS/UIKIT/Input/Text","DS/UIKIT/Toggler","DS/UIKIT/Tooltip","DS/Controls/TooltipModel","DS/Core/PointerEvents","DS/DocumentManagement/DocumentManagement","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/DataGridView/DataGridView","DS/TreeModel/TreeNodeModel","DS/TreeModel/TreeDocument","DS/IssueComponents/templates/TemplatesToolbar","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/create/Create","DS/IssueComponents/users/Users","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Parser","DS/IssueServices/utils/Performance","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f,h,g,v,b,C,y,I,E,S,w,T,D,A,_,O,N,R){"use strict";return t.extend({})}),define("DS/IssueComponents/team/MembersTileViewLayout",["UWA/Core","DS/IssueComponents/team/MembersGridUtil"],function(e,t){"use strict";return{}}),define("DS/IssueComponents/team/MembersFilterLayout",["DS/IssueComponents/team/MembersFilterView","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts"],function(e,t,s){"use strict";var n={createMemberFilter:function(t){n.teamlayoutModel=t.model,this.filterMembersView;var s={events:{memberFilterKeyUp:function(e){n.enteredText=e.target.value;var t={filteringMode:"name",text:n.enteredText};n.filterCollectionAndUpdateUI(t)}}};this.filterMembersView=new e(s),this.filterMembersView.render().inject(t.target)},filterCollectionAndUpdateUI:function(e){var t=e.text;n.teamlayoutModel.setFilterModel({fullName:{filterId:"stringRegexp",filterModel:{condition1:{type:"contains",filter:t}}},role:{filterId:"stringRegexp"}});n.teamlayoutModel.getFilterManager().getFilters().role},launchFilterMemberPanel:function(){var e=document.querySelector(".toolbar-member-grid-div .wux-ui-3ds-filter"),n=document.querySelector(".toolbar-member-grid-div .wux-ui-3ds-user-add"),i=document.querySelector(".addmemberView"),o=document.querySelector(".memberfilterView"),a=document.querySelector(".iss-member-grid-div"),r=document.querySelector(".membertileView");i.hide(),n.removeClassName("member-toolbar-active"),a.removeClassName("teamview-opaque"),r.removeClassName("teamview-opaque"),"block"==o.style.display?(o.hide(),e.removeClassName("member-toolbar-active")):(o.show(),e.addClassName("member-toolbar-active"));try{var l=s.get("component").getCurrentView();t.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:l,pd3:"MembersToolbar",pd4:"Filters",pd5:"Issue/"+l+"/MembersToolbar/Filters"}}),t.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"MembersToolbar"}})}catch(e){}}};return n}),define("DS/IssueComponents/templates/TemplatesDGView",["UWA/Class/View","DS/DataGridView/DataGridView","DS/Controls/TooltipModel","DS/IssueComponents/templates/TemplatesContextualMenu","DS/IssueComponents/users/Users","DS/IssueComponents/utils/Utils","DS/IssueCommon/utils/Utils","DS/IssueServices/services/PlatformServices","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","DS/Controls/Button","text!DS/IssueComponents/assets/Settings.json","i18n!DS/IssueCommon/assets/nls/IssueCommon","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p){"use strict";var f={ISSUE_TYPE:"Issue",DS6W:"ds6w:",STATE_ENUM:{PRIVATE:1,RELEASED:2},PRIORITY_ENUM:{LOW:1,MEDIUM:2,HIGH:3,URGENT:4},LOW_PRIORITY:"Low",MEDIUM_PRIORITY:"Medium",HIGH_PRIORITY:"High",URGENT_PRIORITY:"Urgent"},h=this;return e.extend({init:function(e){this._parent(e);h=this,this.templateComponent=l.get("templateComponentDialog")?l.get("templateComponentDialog"):l.get("templateComponent"),this.templatesDatagrid={},this.custom_view_options={dgvHandle:null,ootb_columns:[],dgvDiv:null,settings:{url:r.get3DSpaceUrl(),securityContext:r.getSecurityContexts().securityContext,isNative:l.get("isNatifEnvironnement")}},this.document=e.treeDocument,this.datagridSettings=JSON.parse(u),this.render()},render:function(){try{var e=this;e.options.columns.forEach(function(t){t.text=e.getHeader(t.dataIndex)}),e.templatesDatagrid=new t(e.options),e.templatesDatagrid.custom_view_options=e.custom_view_options,setTimeout(()=>{e.setTemplateCustomView()},5e3),e.templateComponent.options.editMode&&e.templatesDatagrid.layout.setColumnOrGroupProperties("ContextualMenuColumn",{text:p.columns.actionsColumn,width:50}),e.subscribers(),e._customizeColumnSorting(e.options.columns),e._customizeColumnRendering(e.options.columns)}catch(e){}},subscribers:function(){var e=this;e.templatesDatagrid.addEventListener("click",e.doOnTreeNodeClick.bind(e)),e.templatesDatagrid.onContextualEvent=function(t){if(t&&t.cellInfos){var s=t.cellInfos;if(-1===s.rowID&&t.collectionView){return t.collectionView.buildDefaultContextualMenu(t,{pin:!0,firstColumnsVisibility:!1,columnsManagement:!1,sizeColumnToFit:!0,filter:!0})}return s.nodeModel&&(!1===s.nodeModel.isSelected()&&s.nodeModel.select(!0),e.templateComponent.options.editMode)?n.getContextualMenu(e):Promise.resolve()}return Promise.resolve()},e.templatesDatagrid.onDragStartCell=function(t,s){var n=e.document.getSelectedNodes(),i=e.document.utils.setDroppableData(n);return e.document.prepareBroadcastSelect(),e.document.pushBroadcastSelect(),t.dataTransfer.setData(i.type,i.data),null!==e._ghost&&null!=e._ghost&&(e._ghost.destroy(),e._ghost=null),e._ghost=UWA.createElement("div",{class:"issue-ghost-container"}),e._ghost.setStyle("transform","translate3d(0,0,0)"),document.body.appendChild(e._ghost),t.dataTransfer.setDragImage(e._ghost,t.offsetX,t.offsetY),!0}},doOnTreeNodeClick:function(e,t){e&&void 0!==t&&("ds6w:state"==e.dsModel.layout.getDataIndexFromColumnIndex(t.columnID)&&-1!=t.rowID&&this.templateComponent.options.editMode&&this.launchMaturityPopup(t))},launchMaturityPopup:function(){var e=this;require(["DS/IssueComponents/external/CollaborativeLifecycle"],function(t){for(var s=[],n=e.document.getSelectedTemplateNodes(),i=0;i<n.length;i++)s.push(n[i].options.id);t.execute(s)})},setTemplateCustomView:function(){var e=this;o.buildCustomViewOptions(e.templatesDatagrid,e.container),o.registerCustomEventsOnDGV(e.templatesDatagrid),o.restoreCustomViews(e.templatesDatagrid),a.setColumnFilteringOnAllColumns(e.templatesDatagrid),e.customViewsManager=e.templatesDatagrid.getCustomViewsManager(),e.customViewsManager.onCustomViewsSave=function(t,s){o.applyCustomAttributes(t,s,e.templatesDatagrid.custom_view_options)}},getHeader:function(e){var t=l.get("widget")||window.widget,s=this.datagridSettings.list.columns;return s&&s.default&&s.default[e]?p[s.default[e]]:s&&s.custom&&s.custom[e]?s.custom[e][t.lang]:e},_customizeColumnSorting:function(e){var t=this;e.forEach(function(e){var s=e.dataIndex.replace(f.DS6W,"");switch(e.dataIndex){case"tree":e.compareFunction=t.sorting.title;break;case"ds6w:name":e.compareFunction=t.sorting.name(!1);break;case"ds6w:description":e.compareFunction=t.sorting.description(!1);break;case"ds6w:created":case"ds6w:modified":case"ds6w:estimatedStartDate":case"ds6w:estimatedEndDate":case"ds6w:actualStartDate":case"ds6w:actualEndDate":case"ds6w:resolutionDate":break;case"ds6w:priority":case"ds6w:state":e.compareFunction=t.sorting.enumeration(s);break;case"ds6w:assignees":e.compareFunction=t.sorting.assignees;break;case"ds6w:contributors":e.compareFunction=t.sorting.contributors;break;case"ds6w:informedUsers":e.compareFunction=t.sorting.informedUsers;break;case"ds6w:originator":e.compareFunction=t.sorting.originator;break;case"ds6w:owner":e.compareFunction=t.sorting.owner;break;case"ds6w:coOwners":e.compareFunction=t.sorting.coOwners;break;default:!0===e.custom&&(e.compareFunction=t.sorting.custom(s))}})},_customizeColumnRendering:function(e){var t=this;e.forEach(function(e){e.dataIndex.replace(f.DS6W,"");switch(!0===e.isHidden?e.visibleFlag=!1:e.visibleFlag=!0,e.dataIndex){case"ds6w:biColor":e.onCellRequest=t.rendering.biColor;break;case"ds6w:state":e.getCellClassName=t.styling.state;break;case"ds6w:priority":e.onCellRequest=t.rendering.priority;break;case"ds6w:assignees":e.onCellRequest=t.rendering.assignees;break;case"ds6w:contributors":e.onCellRequest=t.rendering.contributors;break;case"ds6w:informedUsers":e.onCellRequest=t.rendering.informedUsers;break;case"ds6w:originator":e.onCellRequest=t.rendering.originator;break;case"ds6w:owner":e.onCellRequest=t.rendering.owner;break;case"ds6w:coOwners":e.onCellRequest=t.rendering.coOwners;break;case"ds6w:reportedAgainst":e.getCellValue=t.rendering.isReportedAgainstPresent;break;case"ds6w:contexts":e.getCellValue=t.rendering.isContextsPresent;break;case"ds6w:resolutionDate":e.onCellRequest=t.rendering.date;break;default:if(e.isCustomColumn){var s={that:t,attr:{name:e.dataIndex}};e.getCellValue=t.rendering.classificationAttributes.bind(s)}}})},getManager:function(){return this.templatesDatagrid},getColumns:function(){return this.templatesDatagrid.columns},rendering:{biColor:function(e){!1===e.manager.getColumnOptions("biColor").isHidden&&(e.isHeader||(e.cellView.reuseCellContent("biColorCell").style["background-color"]=e.nodeModel.options.grid.biColor))},priority:function(e){if(-1!==e.rowID&&e.nodeModel.options.baseType==f.ISSUE_TYPE){var t=e.nodeModel.options.priority,s="",n="",i=m.priorities[t.toLowerCase()];switch(null==i&&(i=t),t){case f.LOW_PRIORITY:n="low wux-ui-3ds wux-ui-3ds-level-low";break;case f.MEDIUM_PRIORITY:n="medium wux-ui-3ds wux-ui-3ds-level-medium";break;case f.HIGH_PRIORITY:n="high wux-ui-3ds wux-ui-3ds-level-high";break;case f.URGENT_PRIORITY:n="urgent wux-ui-3ds wux-ui-3ds-alert "}s=""==n?UWA.createElement("div",{class:"issue-list-priority",html:i}):UWA.createElement("div",{class:"issue-list-priority",html:[UWA.createElement("span",{class:"issue-list-priority-icon templatePriority "+n}),i]}),e.cellView.setReusableContent(s)}},classificationAttributes:function(e){if(-1===e.rowID||e.nodeModel.options.baseType!=f.ISSUE_TYPE)return;let t=e.nodeModel.options.grid[this.attr.name];if(void 0!==t)return UWA.is(t,"string")&&(t=t.replaceAll("",", ")),t;this.that.templateList.dataGrid.options.treeDocument.autoFill.classificationAttributes(e.nodeModel.options.physicalId,this.attr.name)},owner:function(e){if(c.start(" rendering owner"),-1!==e.rowID){var t=e.nodeModel.options,n=i.create({users:[t.owner]}).addClassName("issue-owner-container"),o=new d({domId:"hyperlinkButton",displayStyle:"lite",label:t.owner.fullName});o.addEventListener("click",function(){r.getUserProfile(t.owner.user)}),o.inject(n),e.cellView.setReusableContent(n);let a="";t.owner.fullName&&t.owner.user&&(a=t.owner.fullName+" ("+t.owner.user+")"),n.tooltipInfos=new s({shortHelp:a,mouseRelativePosition:!1,position:"bottom"})}c.end(" rendering owner")},originator:function(e){if(c.start(" rendering originator"),-1!==e.rowID){var t=e.nodeModel.options,n=i.create({users:[t.originator]}).addClassName("issue-owner-container"),o=new d({domId:"hyperlinkButton",displayStyle:"lite",label:t.originator.fullName});o.addEventListener("click",function(){r.getUserProfile(t.originator.user)}),o.inject(n),e.cellView.setReusableContent(n);let a="";t.originator.fullName&&t.originator.user&&(a=t.originator.fullName+" ("+t.originator.user+")"),n.tooltipInfos=new s({shortHelp:a,mouseRelativePosition:!1,position:"bottom"})}c.end(" rendering originator")},assignees:function(e){if(c.start(" rendering assignees"),-1!==e.rowID){var t=h.templatesDatagrid.reuseCellContent("dummy"),n=e.nodeModel.options;if(n.assignees&&n.assignees.length){var o=n.assignees.map(function(e){return e}),a=i.create({users:o});e.cellView.setReusableContent(a);let t="";o.forEach(e=>{""!=t&&(t+=", "),"person"===e.type?t+=e.fullName+" ("+e.user+")":t+=e.fullName}),a.tooltipInfos=new s({shortHelp:t,mouseRelativePosition:!1,position:"bottom"})}else e.cellView.setReusableContent(t)}c.end(" rendering assignees")},contributors:function(e){if(c.start(" rendering contributors"),-1!==e.rowID){var t=h.templatesDatagrid.reuseCellContent("dummy"),n=e.nodeModel.options;if(n.contributors&&n.contributors.length){var o=n.contributors.map(function(e){return e}),a=i.create({users:o});e.cellView.setReusableContent(a);let t="";o.forEach(e=>{""!=t&&(t+=", "),t+=e.fullName+" ("+e.user+")"}),a.tooltipInfos=new s({shortHelp:t,mouseRelativePosition:!1,position:"bottom"})}else e.cellView.setReusableContent(t)}c.end(" rendering contributors")},informedUsers:function(e){if(c.start(" rendering informedUsers"),-1!==e.rowID){var t=h.templatesDatagrid.reuseCellContent("dummy"),n=e.nodeModel.options;if(n.informedUsers&&n.informedUsers.length){var o=n.informedUsers.map(function(e){return e}),a=i.create({users:o});e.cellView.setReusableContent(a);let t="";o.forEach(e=>{""!=t&&(t+=", "),"person"===e.type?t+=e.fullName+" ("+e.user+")":t+=e.fullName}),a.tooltipInfos=new s({shortHelp:t,mouseRelativePosition:!1,position:"bottom"})}else e.cellView.setReusableContent(t)}c.end(" rendering informedUsers")},coOwners:function(e){if(c.start(" rendering coOwners"),-1!==e.rowID){var t=h.templatesDatagrid.reuseCellContent("dummy"),n=e.nodeModel.options;if(n.coOwners&&n.coOwners.length){var o=n.coOwners.map(function(e){return e}),a=i.create({users:o});e.cellView.setReusableContent(a);let t="";o.forEach(e=>{""!=t&&(t+=", "),t+=e.fullName+" ("+e.user+")"}),a.tooltipInfos=new s({shortHelp:t,mouseRelativePosition:!1,position:"bottom"})}else e.cellView.setReusableContent(t)}c.end(" rendering coOwners")},array:function(e){return function(t){if(c.start(" rendering array"),t.nodeModel.options.baseType===f.ISSUE_TYPE){var s=t.nodeModel.options[e];if(!0===(e in t.nodeModel.options&&s.length>0))if(s.length<f.RENDERING_LIMIT_ARRAY)t.cellView.reuseCellContent("arrayLengthIs"+s.length);else{var n=UWA.createElement("div",{class:"issue-list-cell-related",html:p.replace(p.listHasRelated,{number:s.length})});t.cellView.getContent().setContent(n)}else t.cellView.reuseCellContent("arrayLengthEmpty")}c.end(" rendering array")}},isContextsPresent:function(e){if(c.start(" rendering isContextsPresent"),e.nodeModel.options.baseType===f.ISSUE_TYPE)return e.nodeModel.options.contexts.length;c.end(" rendering isContextsPresent")},isReportedAgainstPresent:function(e){if(c.start(" rendering isReportedAgainstPresent"),e.nodeModel.options.baseType===f.ISSUE_TYPE)return e.nodeModel.options.reportedAgainst.length;c.end(" rendering isReportedAgainstPresent")},date:function(e){var t="";if(""!=e.nodeModel.options.resolutionDate){var s=l.get("widget")||window.widget,n=parseInt(s.getValue("approaching"),10),i="",o=new Date;o.setHours(0,0,0,0);var a=new Date(e.nodeModel.options.resolutionDate);a.setHours(0,0,0,0),i=""===(i=Math.ceil(Math.abs(a-o)/864e5)<=n&&a>o?"approaching":"")&&a<=o?"overdue":i;var r=a.toLocaleString("default",{month:"short"})+" "+a.getDate()+", "+a.getFullYear();t=UWA.is(i,"string")&&""!==i?UWA.createElement("div",{class:"target-approaching-overdue",html:[{class:"approaching"===i?"fonticon fonticon-clock":"fonticon fonticon-attention"},{html:r}]}):UWA.createElement("div",{class:"target-approaching-overdue",html:r})}e.cellView.setReusableContent(t)},updateColumnStyles:function(e,t){var s={};void 0!==t.color&&(s.color=t.color+";"),void 0!==t["background-color"]&&(s["background-color"]=t["background-color"]+";");var n=[],i=document.styleSheets[0];i.cssRules?n=i.cssRules:i.rules&&(n=i.rules);var o='.issue-list-container .wux-datagrid-cell[data-index="'+e+'"]:not(.wux-datagrid-header)',a=this._getBrowserSelector(o),r=function(e,t,s){for(var n=e.length;--n;){var i=e[n];if(s(t,i))return{item:i,index:n}}return null}(n,a,function(e,t){return t.selectorText===e});null!==r&&i.deleteRule(r.index);var l="{}";UWA.is(t,"object")&&(l=(l=(l=JSON.stringify(s)).replace(/"/g,"")).replace(/,/g,"")),"{}"!==l&&i.insertRule(a+l,n.length)},_getBrowserSelector:function(e){var t=document.styleSheets,s=t[t.length-1],n=-1,i=null;try{n=s.insertRule(e+"{}",s.cssRules.length),i=(s.cssRules||s.rules)[n].selectorText}finally{n>=0&&s.deleteRule(n)}return i}},styling:{state:function(e){if(e.nodeModel){var t="";if(t="Issue-Template."+e.nodeModel.options.state){var s="lc-status-"+t.replace(/(\.| )/g,"-")+"-withClass";return s=s+" "+(t=t.replace("Issue-Template.",""))+" ISU-template-maturity"}}},cleanStatusForCSS:function(e){return e.replace(/(\.| )/g,"-")}},sorting:{custom:function(e){return function(e,t,s,n,i){var o=!(i in s.options.custom)||null===s.options.custom[i],a=!(i in n.options.custom)||null===n.options.custom[i];if(o||a)return o&&!a?-1:!o&&a?1:0;var r=s.options.custom[i],l=n.options.custom[i];return isNaN(r)||isNaN(l)?r>l?1:r<l?-1:0:(r=parseFloat(r))>(l=parseFloat(l))?1:r<l?-1:0}},title:function(e,t,s,n,i){return s.options.baseType!==f.ISSUE_TYPE||n.options.baseType,s.options.label<n.options.label?-1:s.options.label>n.options.label?1:0},name:function(e){return function(t,s,n,i,o){return n.options.name<i.options.name?e?1:-1:n.options.name>i.options.name?e?-1:1:0}},description:function(e){return function(t,s,n,i,o){var r=a.getTextFromHTML(n.options.description),l=a.getTextFromHTML(i.options.description);return r<l?e?1:-1:r>l?e?-1:1:0}},array:function(e){return function(e,t,s,n,i){return s.options[i].length-n.options[i].length}},date:function(e){return function(e,t,s,n,i){if(s.options[i]&&n.options[i]){var o=s.options[i]<n.options[i]?-1:1;try{var a=new Date(s.options[i]),r=new Date(n.options[i]);o=a>r?1:a<r?-1:0}catch(e){}return o}return!s.options[i]&&n.options[i]?-1:!n.options[i]&&s.options[i]?1:0}},enumeration:function(e){var t={};switch(e){case"state":t=f.STATE_ENUM;break;case"priority":t=f.PRIORITY_ENUM;break;default:t=f.STATE_ENUM}return function(e,s,n,i,o){var a=0;o=o.replace("ds6w:","");try{o in n.options&&o in i.options&&(e=n.options[o].toUpperCase(),s=i.options[o].toUpperCase(),a=t[e]-t[s])}catch(e){}return a}},assignees:function(e,t,s,n,i){var o=0;if("assignees"in s.options&&"assignees"in n.options){var a=s.options.assignees,r=n.options.assignees;o=a.length>=r.length?1:-1}return o},contributors:function(e,t,s,n,i){var o=0;if("contributors"in s.options&&"contributors"in n.options){var a=s.options.contributors,r=n.options.contributors;o=a.length>=r.length?1:-1}return o},informedUsers:function(e,t,s,n,i){var o=0;if("informedUsers"in s.options&&"informedUsers"in n.options){var a=s.options.informedUsers,r=n.options.informedUsers;o=a.length>=r.length?1:-1}return o},originator:function(e,t,s,n,i){return s.options.originator.lastName<n.options.originator.lastName?-1:s.options.originator.lastName>n.options.originator.lastName?1:0},owner:function(e,t,s,n,i){return s.options.owner.lastName<n.options.owner.lastName?-1:s.options.owner.lastName>n.options.owner.lastName?1:0},coOwners:function(e,t,s,n,i){var o=0;if("coOwners"in s.options&&"coOwners"in n.options){var a=s.options.coOwners,r=n.options.coOwners;o=a.length>=r.length?1:-1}return o}}})}),define("DS/IssueComponents/team/MembersDataGridView",["UWA/Class/View","DS/DataGridView/DataGridView","DS/CollectionView/ResponsiveTilesCollectionView","DS/IssueComponents/team/MembersDataGridViewToolbar","DS/IssueComponents/team/MembersFilterLayout","DS/IssueComponents/team/AddMembersLayout","DS/IssueComponents/team/MembersMenu","DS/IssueServices/services/PlatformServices","DS/CollectionView/CollectionViewStatusBar","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,s,n,i,o,a,r,l,c){"use strict";return e.extend({init:function(e){this._parent(e);this.membersDatagridView="","undefined"!=this.options.target&&null!=this.options.target&&(this.render(),this.membersDatagridView.inject(this.options.target),this.membersDatagridView.setStyle("width",this.options.target.offsetWidth))},render:function(){try{var e=this.processColumns(),l=this,d={treeDocument:this.options.treeDocument,columns:e,cellSelection:"none",rowSelection:"multiple",columnDragEnabledFlag:!1,cellDragEnabledFlag:!1,showRowIndexFlag:!1,identifier:widget.id+"_members",isEditable:!1,defaultColumnDef:{width:"auto",resizableFlag:!0,sortableFlag:!0},resize:{columns:!0},headersDimensions:{height:26},selection:{unselectAllOnEmptyArea:!0,toggle:!1,canMultiSelect:!0,enableListSelection:!0,renderingMode:"adaptive"},performances:{buildLinks:!1,enableColumnVirtualization:!0,useRequestAnimationFrameRendering:!0,preloadPool:!0},showContextualMenuColumnFlag:!0,enableExpandOnDoubleClick:!0,onContextualEvent:function(e){var t=[];if(e&&e.collectionView&&e.cellInfos){if(e.cellInfos.rowID>-1)return a.showRMBMenuOnGrid(l,e).then(function(e){return e});e.collectionView.columns.length,e.cellInfos.columnID;t=e.collectionView.buildDefaultContextualMenu(e,{pin:!0,firstColumnsVisibility:!0,columnsManagement:!1,sizeColumnToFit:!0})}return t}};d=UWA.merge(d,this.options);var u={model:this.options.treeDocument,height:"inherit",allowUnsafeHTMLContent:!0,displayedOptionalCellProperties:["contextualMenu","description","propertiesList","activeFlag"]};this.membersDatagrid=new t(d),this.membersDatagrid.layout.setColumnOrGroupProperties("ContextualMenuColumn",{text:c.team.columns.actions,width:60,isHidden:!1,visibleFlag:!0,defaultVisibility:!0,pinned:"right"}),this.tileView=new s(u);var m={callback:function(e){if(e&&e.cellInfos&&e.cellInfos.cellModel)return a.showRMBMenuOnGrid(l,e).then(function(e){return e})}};this.tileView.onContextualEvent=m;this.membersDatagrid.getTypeRepresentationFactory().registerTypeRepresentations({sortingdropdown:{stdTemplate:"functionMenuIcon",semantics:{label:"action",icon:"plus"}}}),n.toolbar=this.membersDatagrid.setToolbar(n.writetoolbarDefinition()),this.toolbar=n.toolbar,(l=this).membersDatagrid.getTreeDocument().getXSO().onAdd(function(e){if(e.getTreeDocument()){var t=e.getTreeDocument().getSelectedNodes().length;require(["DS/IssueComponents/team/MembersDataGridLayout"],function(e){0===t?e.membersDataGridView.membersDatagrid.getToolbar().updateNodeModel("remove",{disabled:!0}):e.membersDataGridView.membersDatagrid.getToolbar().updateNodeModel("remove",{disabled:!1})})}}),l.membersDatagrid.getTreeDocument().getXSO().onRemove(function(e){0==e.getTreeDocument().getSelectedNodes().length&&require(["DS/IssueComponents/team/MembersDataGridLayout"],function(e){e.membersDataGridView.membersDatagrid.getToolbar().updateNodeModel("remove",{disabled:!0})})}),l.membersDatagrid.getTreeDocument().onNodeModelUpdate(function(e){require(["DS/IssueComponents/team/MembersDataGridLayout"],function(e){var t=r.getUserName();(e.membersDataGridModel.assignees.getChildren()?e.membersDataGridModel.assignees.getChildren():[]).filter(e=>e.options.grid.user===t).length>0?e.membersDataGridView.membersDatagrid.getToolbar().updateNodeModel("assigntoself",{visibleFlag:!1}):e.membersDataGridView.membersDatagrid.getToolbar().updateNodeModel("assigntoself",{visibleFlag:!0})})}),this.membersDatagridView=UWA.createElement("div",{id:"iss-outer-member-grid-div",class:"outer-member-grid-div"});var p=UWA.createElement("div",{styles:{width:"100%"},class:"toolbar-member-grid-div"});this.toolbar.inject(p);var f=UWA.createElement("div",{class:"iss-member-grid-div expanded-header-height hideView"}),h=UWA.createElement("div",{class:"iss-member-tile-div membertileView expanded-header-height"}),g=UWA.createElement("div",{styles:{position:"relative"},class:"iss-member-filter-div memberfilterView hideView"}),v=UWA.createElement("div",{styles:{position:"relative"},class:"iss-add-member-div addmemberView hideView"}),b=UWA.createElement("div",{class:"hideView",id:"issMemberEmptyTileViewDiv"});UWA.createElement("div",{html:c.team.datagridPlaceholder}).inject(b);var C={target:g,model:this.options.treeDocument},y={target:v,model:this.options.treeDocument};this.membersFilterLayout=i,i.createMemberFilter(C),o.createAddMemberPanel(y),this.membersDatagrid.inject(f),this.tileView.inject(h),b.inject(h),this.membersDatagridView.addContent(p),this.membersDatagridView.addContent(g),this.membersDatagridView.addContent(v),this.membersDatagridView.addContent(f),this.membersDatagridView.addContent(h)}catch(e){}},processColumns:function(){return this.options.columns},reapplySortModel:function(){this.membersDatagrid.reapplySortModel()}})}),define("DS/IssueComponents/templates/TemplatesDataGridLayout",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/IssueComponents/open/Open","DS/IssueComponents/templates/TemplatesDGView","DS/IssueComponents/templates/TemplateDelete","DS/IssueComponents/templates/TemplateMigration","DS/IssueCommon/utils/ModelParser","DS/IssueComponents/templates/model/TemplatesTreeDocument","DS/IssueComponents/templates/TemplatesToolbar","DS/IssueComponents/utils/Utils","DS/IssueCommon/utils/Utils","DS/IssueComponents/create/Create","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueComponents/templates/footer/TemplateStatus","text!DS/IssueComponents/assets/Settings.json","text!DS/IssueComponents/assets/IssueTemplates.DataGrid.json","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f,h,g,v,b,C,y,I,E,S,w,T,D){"use strict";var A="CUSTOM_ATTR_INFOS",_="CUSTOM_ATTR_NLS",O="IssueTemplatesEnabled",N="Issue Template Json Details";return t.extend({name:"DS/IssueComponents/templates/TemplatesDataGridLayout",_logger:null,isLoaded:null,_deferred:{resolve:null,reject:null},_isRendered:!1,init:function(e,t){this._parent(t),this.container=e,this._logger=r.getLogger(this.name),this._logger.log("Initializing the templates component"),this.status=null,this.elements={dialog:null,header:null,body:null,footer:null},this.templateList={container:null,title:null,dataGridContainer:null,dataGrid:null,toolBarContainer:null,toolBar:null,attributes:[]},this.templateLastUsed={container:null,header:null,previews:{container:null,templates:{}}},this.buttons={cancel:null,select:null},this._tooltips=[],this.attributes=[],this.user=E.getUserName(),this.userInfo=c.getUser(),this.popover=null,this.isIssueNewTemplate_Enabled=y.get(O),this.onClose=t.onClose.bind(this),this.onEnd=t.onEnd.bind(this),this.utils._setTypesCallbackSubscribe=!1},destroy:function(){this._tooltips.forEach(function(e){e.destroy()}),this._tooltips=[],this.elements={header:null,body:null},this.templateList={container:null,title:null,dataGridContainer:null,dataGrid:null,toolBarContainer:null,iconBar:null,attributes:[]},this.templateLastUsed={container:null,header:null,previews:{container:null,templates:{}}},this.buttons={cancel:null,select:null},this.user="",this.userInfo="",this._destroyPopover(),this.utils._setTypesCallbackSubscribe=!1,y.remove("templateComponentDialog")},render:function(){y.add("templateComponent",this),this.renderTemplateData(),this.setFooter()},renderTemplateData:function(){var t=this;t.isLoaded=new e(function(e,s){t._deferred.resolve=e,t._deferred.reject=s}),t.setBody(),t.createTemplateDocument(),t.createTemplateDGView(),t.setTemplateToolbar(),t.updateUXForEditMode(),t.templateModelEvents=t.document.getTemplateModelEvents()},renderDialog:function(){y.add("templateComponentDialog",this),this.renderTemplateData()},setBody:function(){this.elements.body=s.createElement("div",{class:"create-template-chooser-body hide-last-used"}),!0===this.options.editMode&&this.elements.body.addClassName("edit-mode"),this.templateList.container=s.createElement("div",{class:"create-template-chooser-list"}).inject(this.elements.body),this.templateList.toolBarContainer=s.createElement("div",{class:"create-template-chooser-list-iconbar"}).inject(this.templateList.container)},createTemplateDocument:function(){var e=JSON.parse(w);this.document=new h({component:this,settings:e,document:{}})},createTemplateDGView:function(){y.get("widget")||window.widget;var e=JSON.parse(T);this.templateList.dataGrid=new u({columns:e.columns,defaultColumnDef:{width:"auto",typeRepresentation:"string"},treeDocument:this.document,showNodeKPIColorFlag:!0,showRowBorderFlag:!0,showAlternateBackgroundFlag:!0,cellSelection:"none",showRowIndexFlag:!1,rowGroupingEnabledFlag:!1,useWidgetPreferencesFlag:!0,identifier:"ISUTemplateSummaryView",cellDragEnabledFlag:!0,filter:!0,showContextualMenuColumnFlag:this.options.editMode}),this.templateList.dataGridContainer=s.createElement("div",{class:"create-template-chooser-list-tree-list tree-list-empty"}).inject(this.templateList.container),this.templateList.treeListPlaceholder=s.createElement("span",{class:"tree-list-placeholder"}).inject(this.templateList.dataGridContainer),this.customViewsManager=this.templateList.dataGrid.templatesDatagrid.getCustomViewsManager()},setTemplateToolbar:function(){this.templateToolbar=g,g.toolbar&&g.toolbar.destroy(),g.toolbar=this.templateList.dataGrid.templatesDatagrid.setToolbar(g.writetoolbarDefination()),this.registerToolbarCallback(),this.templateList.toolBarContainer.appendChild(g.toolbar.getContent()),this.toolBar=g.toolbar,this.templateList.dataGrid.templatesDatagrid.inject(this.templateList.dataGridContainer)},setFooter:function(){this.status=(new S).render(),this.elements.footer=s.createElement("div",{class:"im-template-footer"}),this.status.inject(this.elements.footer),this.elements.footer.inject(this.templateList.container)},registerToolbarCallback:function(){g.toolbar.onToolbarClickCallback=this.onToolbarClickCallback.bind(this)},build:function(){var e=this;!1===e._isRendered&&e.refreshTemplateList().then(function(){e._isRendered=!0,e._deferred.resolve()}).catch(function(t){e._deferred.reject(t)})},refreshTemplateList:function(){var e=this;return p.processLegacyTemplates().then(function(){return i.mask(e.elements.body),e.getIssueTemplates()}).then(function(t){e.document.removeRoots();var s=f.parse(t);t.length>0?(e.templateList.dataGridContainer.removeClassName("tree-list-empty"),e.document.addRoots(s),e.updateNLSValuesInDatagrid(s),e.updateApprovalInDatagrid(s),e.addClassificationAttrToColumnsList(s),e.addCustomAttrToColumnsList(),e.getCustomAttrValues().then(t=>{e.updateCustomAttrValuesInDatagrid(t)})):(e.templateList.dataGridContainer.addClassName("tree-list-empty"),e.templateList.treeListPlaceholder.setContent(D.templates.treeList.placeholder)),y.get("widget").dispatchEvent("onTitleChange")}).then(function(){}).catch(function(e){l.displayNotification({msg:D.templates.errors.get,eventID:"error"})}).finally(function(){var t=e.document.getRoots();i.unmask(e.elements.body),0==t?g.idling():g.enable(["customizeDatagridView"])})},updateNLSValuesInDatagrid:function(e){var t=this,s=[],n=[];e.forEach(e=>{s.push(e.organization),n.push(e.collaborativeSpace),s.push(e.responsibleOrganization),s.push(e.reportingOrganization)});var i={"ds6w:organizationResponsible":s,"ds6w:project":n};I.getNLSValuesPromise(i).then(s=>{if(null!=s&&Object.keys(s).length>0){var n=s["ds6w:organizationResponsible"],i=s["ds6w:project"];t.document.withTransactionUpdate(function(){for(var s={},o=0;o<e.length;o++){var a=e[o],r=a.physicalId,l={};Object.keys(n).forEach(function(e){e==a.organization&&(l.organization=n[e]),e==a.responsibleOrganization&&(l.responsibleOrganizationTitle=n[e]),e==a.reportingOrganization&&(l.reportingOrganizationTitle=n[e])}),Object.keys(i).forEach(function(e){e==a.collaborativeSpace&&(l.collaborativeSpaceTitle=i[e])}),s[r]=l}for(var c=t.document.getRoots(!1),d=0;d<c.length;d++){var u=c[d];if(s[u.options.physicalId]){var m=s[u.options.physicalId];u.updateOptions({grid:{"ds6w:collaborativeSpace":m.collaborativeSpaceTitle,"ds6w:organization":m.organization,"ds6w:responsibleOrganization":m.responsibleOrganizationTitle,"ds6w:reportingOrganization":m.reportingOrganizationTitle},collaborativeSpaceTitle:m.collaborativeSpaceTitle,organization:m.organization,reportingOrganization:m.reportingOrganizationTitle,responsibleOrganization:m.responsibleOrganizationTitle})}}})}})},updateApprovalInDatagrid:function(e){var t={};for(let o=0;o<e.length;o++){var s=e[o].data.data,n=e[o].physicalId,i={};s&&Array.isArray(s.automationTasks)&&(i.approval=s.automationTasks.includes("enableApproval"),t[n]=i)}for(var o=this.document.getRoots(!1),a=0;a<o.length;a++){var r=o[a];if(t[r.options.physicalId]){var l=t[r.options.physicalId];r.updateOptions({grid:{Approvals:l.approval},collaborativeSpaceTitle:l.collaborativeSpaceTitle,organization:l.organization,reportingOrganization:l.reportingOrganizationTitle,responsibleOrganization:l.responsibleOrganizationTitle})}}},addClassificationAttrToColumnsList:function(e){let t=[];e.map(e=>{if(e.data.attribute&&null!=e.data.attribute){let s=e.data.attribute["to[Classified Item].from.id"];""!=s&&(s=(s=(s=s.replace("[","")).replace("]","")).split(", "),t.push(...s))}});let s=[...new Set(t)];s.length&&this.getClassificationAttributeValues(s)},getClassificationAttributeValues:async function(e){var t=this;await t.getClassificationAttrInfo(e).then(e=>{t.templateList.attributes=[],e.forEach(function(e){e.classAttributes.forEach(function(e){if(!t.templateList.attributes.includes(e.name)){t.templateList.attributes.push(e.name);var s={column:{text:e.name,dataIndex:e.name,isDraggable:!0,visibleFlag:!1,moveable:!0,width:120,minWidth:5,isCustomColumn:"Classification",isOOTBColumn:!0,ds6wIndexMapping:e.name}},n={that:t,attr:e};s.column.getCellValue=t.templateList.dataGrid.rendering.classificationAttributes.bind(n),t.templateList.dataGrid.getColumns().filter(e=>e.dataIndex==s.column.dataIndex).length<=0&&(t.templateList.dataGrid.getManager().removeColumnOrGroup(e.name),t.templateList.dataGrid.getManager().addColumnOrGroup(s.column),b.setColumnFilteringOnColumn(t.templateList.dataGrid.templatesDatagrid,s.column))}})})})},getClassificationAttrInfo:function(t){var s=[];return t.forEach(function(t){var n=new e(function(e){I.classification.getClassificationAttributesOfClass({id:t,onFailure:function(e){}}).then(function(s){if(s.member){var n={classAttributes:s.member[0].ClassAttributes.member,classID:t};e(n)}else e()})});s.push(n)}),e.all(s)},addCustomAttrToColumnsList:function(){var e=this;let t={...y.get("CustomAttributesPredicates")};e.templateList.dataGrid.templatesDatagrid.prepareUpdateView();let s=y.get(A);Array.isArray(s)&&s.forEach(function(s){const n=b.getTypeRepOfAttribute(s);var i={column:{name:s.name,text:s.nlsName,dataIndex:s.selectable,isDraggable:!0,visibleFlag:!1,moveable:!0,width:120,minWidth:5,isCustomColumn:"Attribute",isOOTBColumn:!0,typeRepresentation:n,ds6wIndexMapping:s.uri}};e.templateList.dataGrid.getColumns().filter(e=>e.dataIndex==i.column.dataIndex).length<=0&&(e.templateList.dataGrid.getManager().removeColumnOrGroup(s.selectable),e.templateList.dataGrid.getManager().addColumnOrGroup(i.column),b.setColumnFilteringOnColumn(e.templateList.dataGrid.templatesDatagrid,i.column)),t[s.selectable]||(t[s.selectable]=i.column)}),y.add("CustomAttributesPredicates",t),e.templateList.dataGrid.templatesDatagrid.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)},getCustomAttrValues:function(){var t=[];let s=y.get(A);return Array.isArray(s)?(s.forEach(e=>{let s=e.selectable,n={predicate:e.uri,selectable:s};t.push(n)}),JSON.parse(T).columns.forEach(e=>{if(e.isGenericResource){let s={predicate:e.predicate,selectable:e.selectable};t.push(s)}}),I.templates.getCustomAttributes({version:"2.0",data:{customAttrInfo:t}})):e.reject()},updateCustomAttrValuesInDatagrid:function(e){var t={};if(Array.isArray(e.body))for(let a=0;a<e.body.length;a++){var s=e.body[a].attribute,n=e.body[a].physicalId,i={};if(s&&Array.isArray(s)){for(var o=0;o<s.length;o++){let e=Object.keys(s[o])[0],t=s[o][e],n=b.getFormattedValueAsPerTypeRepresentation(e,t);if(null!=n&&""!=n&&"["==(n=n.trim())[0]&&"]"==n[n.length-1]&&(n=n.substring(1,n.length-1)),null!=y.get(_)||null!=y.get(_)){let t=y.get(_)[e];if(t&&""!=n){let e=b.getNLSValueForCustomAttr(n,t);0!=e.length&&(n=e.toString())}}i[e=(e=e.replace("attribute[","")).replace("]","")]=n}t[n]=i}}var a=this.document.getRoots(!1);this.document.withTransactionUpdate(function(){for(var e=0;e<a.length;e++){var s=a[e];if(t[s.options.physicalId]){var n=t[s.options.physicalId];s.updateOptions({grid:n})}}})},getIssueTemplates:function(){var e=this;return I.templates.getTemplates({}).then(function(t){var s=t.body;return s.sort(function(e,t){return new Date(t.modified)-new Date(e.modified)}),s.forEach(function(e){var t={},s="";e.attribute.forEach(e=>{switch(Object.keys(e)[0]){case N:t=JSON.parse(e[N]);break;case"to[Classified Item].from.id":s=e}}),e.data={},e.data.id=e.physicalId,e.data.data=t.data,e.data.info=t.info,e.data.hidden=t.hidden,e.data.attribute=s}),e.checkRecentlyUsedTemplateList(s),s})},checkRecentlyUsedTemplateList:function(e){var t=this,s=[];v.getRecentlyUsedTemplates().then(function(n){""!==n.body&&Array.isArray(n.body)&&(s=n.body);const i=s.filter(t=>e.find(({physicalId:e})=>t.physicalId===e));v.setRecentlyUsedTemplates(i).catch(function(e){t._logger.error("Could not save the preferences: %o",e)})})},createIssueTemplate:function(t){var s=this;return new e((e,n)=>{I.templates.createTemplate({data:t}).then(function(s){s.body.templateTitle=t.data.templateTitle,e(s)}).catch(function(t){e(t),s._logger.error("Could not create the template: %o",t)})})},editIssueTemplate:function(e){var t=this;return I.templates.editTemplate({data:e}).catch(function(e){t._logger.error("Could not update the template: %o",e)})},onEndCallback:function(){var e=this.document.getSelectedTemplateNodes(),t=e[e.length-1].options;this.onEnd(t)},shareTemplateHandler:function(){var e=this;e.templates=e.document.getSelectedTemplateNodes(),require(["DS/ENOCollabSharingCmds/BaseModels/ResultElement","DS/SharePopup/SharePopup"],function(t,s){var n=e.templates.map(function(e){return new t({physicalId:e.options.id,Revision:"1",typeDisplayName:"Issue Template",name:e.options.data.info.name,organizationTitle:e.options.responsibleOrganization,collabSpaceTitle:"3DS Collab Space",responsibleName:e.options.owner.user})}),i=y.get("widget")||window.widget;new s(i,i.body,{removeAtClose:!0,events:{onClose:function(){}}}).show(n)})},_columnCustomizationHandler:function(){v.refreshOOTBColumnList(this.templateList.dataGrid.templatesDatagrid),this.customViewsManager.showCustomViewsDialog()},_listenToCreateEvents:function(e){var t=this;t.listenTo(e,"onTemplateCreate",function(e){t.document.refreshNodesById(e)}),t.listenTo(e,"onCreateDialogClose",function(){t.templateModelEvents.publish({event:"show-template-dialog-container"})})},_destroyPopover:function(){if(null!==this.popover){try{this.popover.destroy()}catch(e){}this.popover=null}},onToolbarClickCallback:function(e){"createTemplate"==e._event&&this._createTemplateHandler(),"fromIssue"==e._event&&this._fromIssueHandler(),"duplicateTemplate"==e._event&&this._duplicateTemplateHandler(),"editTemplate"==e._event&&this._editTemplateHandler(),"removeTemplate"==e._event&&this._removeTemplateHandler(),"shareTemplate"==e._event&&this.shareTemplateHandler(),"columnCustomization"==e._event&&this._columnCustomizationHandler();try{b.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"TemplateToolbar"}})}catch(e){}},_createTemplateHandler:function(){this.templateModelEvents.publish({event:"hide-template-dialog-container"});var e=new C(this.container,{isTemplate:!0});this.utils.isAlreadyRunning()||(e.render(),this._listenToCreateEvents(e))},_fromIssueHandler:function(){var e=this,t=y.get("application");if(s.is(t,"object")&&t.isStandalone){var n=y.get("component"),i=n.taskManager.addObjectsTask(function(t){if(Array.isArray(t.physicalIds)){e.templateModelEvents.publish({event:"hide-template-dialog-container"});var s=new C(e.container,{isTemplate:!0});if(e.utils.isAlreadyRunning())return;s.render(),s.isLoaded.then(function(){var e={id:t.physicalIds[t.physicalIds.length-1]};s.applyIssue(e)}).finally(function(){e._listenToCreateEvents(s)})}n.unmaskForTask(i)},function(){n.unmaskForTask(i)});n.maskForTask(i,D.tasks.addObjects)}else E.search({title:D.create.start.actionPage.template.fromIssue,default_search_criteria:"",precond:'(flattenedtaxonomies:"types/Issue")',multiSel:!1,callback:function(t){e.templateModelEvents.publish({event:"hide-template-dialog-container"});var s=new C(e.container,{isTemplate:!0});e.utils.isAlreadyRunning()||(s.render(),s.isLoaded.then(function(){s.applyIssue(t[t.length-1])}).finally(function(){e._listenToCreateEvents(s)}))},cancel:function(){}})},_duplicateTemplateHandler:function(){var e=this,t=e.document.getSelectedTemplateNodes(),n=y.get("widget")||window.widget;if(1!==t.length)return;var i=t[t.length-1].options,o=s.clone(i.data);e.templateModelEvents.publish({event:"hide-template-dialog-container"});var a=new C(e.container,{isTemplate:!0});let r=E.getSecurityContexts().cspaces;e.updateDataPresentOnNode(i.physicalId,o).then(t=>{o.info.name=D.replace(D.templates.clonePrefix,{name:o.info.name}),o.info.securityContexts=n.getPreference("pad_security_ctx")?n.getPreference("pad_security_ctx").value:r[0].value,o.data.securityContexts=n.getPreference("pad_security_ctx")?n.getPreference("pad_security_ctx").value:r[0].value,e.updateTemplateData(o).then(function(){e.utils.isAlreadyRunning()||(a.render(),a.isLoaded.then(function(){return a.applyTemplate(o,{overwrite:!1}).catch(function(t){e._logger.error('Could not apply template "%s"',t),l.displayNotification({msg:D.replace(D.create.templateApplyError,{name:o.info.name}),eventID:"error"})})}).finally(function(){e._listenToCreateEvents(a)}))})}).catch(e=>{})},_editTemplateHandler:function(){var e=this,t=e.document.getSelectedTemplateNodes();if(1===t.length){var s=t[t.length-1].options,n=s.data;e.templateModelEvents.publish({event:"hide-template-dialog-container"});var i=new C(e.container,{editMode:!0,isTemplate:!0});e.updateDataPresentOnNode(s.physicalId,n).then(t=>{e.updateTemplateData(n).then(function(){e.utils.isAlreadyRunning()||(i.render(),i.isLoaded.then(function(){return i.applyTemplate(n,{overwrite:!0}).catch(function(t){e._logger.error('Could not apply template "%s"',t),l.displayNotification({msg:D.replace(D.create.templateApplyError,{name:n.info.name}),eventID:"error"})})}).finally(function(){e._listenToCreateEvents(i)}))})}).catch(e=>{})}},_removeTemplateHandler:function(){var e=this.document.getSelectedTemplateNodes();new m({selectedNodes:e}).render()},publishCompass:function(){this.utils.setTypesCallbackForOFW(this.document.getSelectedTemplateNodes())},updateTemplateData:function(e){var t=this;return v.template.getDocuments(e.id).then(function(t){return e.data.attachments=t,v.template.getPrimary(e.id)}).then(function(t){return e.data.primaryAttachment=t,v.classification.getClassificationAttrValues(e.id)}).then(function(t){var s=[],n={};t.member[0].ClassificationAttributes.member.forEach(function(e){var t=[],i={classId:e.ClassID};t.push(i),s.push(t),e.Attributes.forEach(function(e){n[e.name]=e.value})}),e.data.classification=s,e.data.attributes=n}).catch(function(e){e&&s.is(e.body,"object")&&s.is(e.body.message,"string")?l.displayNotification({msg:e.body.message,eventID:"error"}):l.displayNotification({msg:D.create.setAttributesFailed,eventID:"error"}),t._logger.error(e)})},updateDataPresentOnNode:function(e,t){return I.templates.retrieve({data:{objects:{physicalId:e}}}).then(e=>{var s=t,n=e.body,i="";n.attribute.forEach(e=>{switch(Object.keys(e)[0]){case N:i=JSON.parse(e[N]);break;case"to[Classified Item].from.id":e}}),s.data.classes=n.classification,s.data.escalationRequired=n.escalationRequired,s.data.reportedAgainst=n.reportedAgainst,s.data.contexts=n.contexts,s.data.type=n.type,s.data.priority=n.priority,s.data.resolutionDate=n.resolutionDate,s.data.resolutionRecommendation=n.resolutionRecommendation,s.data.reportingOrganization=n.reportingOrganization,s.data.reportingOrganizationTitle=n.reportingOrganizationTitle,s.data.responsibleOrganization=n.responsibleOrganization,s.data.responsibleOrganizationTitle=n.responsibleOrganizationTitle,s.data.custom=n.custom,s.data.securityContexts=i.data.securityContexts,s.data.automationTasks=i.data.automationTasks,s.data.title=i.data.title,s.data.description=i.data.description,s.data.specialization=n.specialization,s.info.description=n.description,s.info.name=n.title,s.info.version=i.info.version,s.info.tenant=i.info.tenant,s.info.securityContexts=i.info.securityContexts,s.ui={},s.ui.owner=n.owner,s.ui.assignees=v.template.formatMemebersValues(n.assignees),s.ui.coOwners=v.template.formatMemebersValues(n.coOwners),s.ui.contributors=v.template.formatMemebersValues(n.contributors),s.ui.informedUsers=v.template.formatMemebersValues(n.informedUsers),s.hidden=i.hidden,s.id=n.physicalId}).catch(e=>{if(e.error.internal&&e.error.internal.includes("No business object")){var t=b.getErrorMessage("0");b.displayErrorMessage(t,"error")}})},utils:{_setTypesCallbackSubscribe:!1,setTypesCallbackForOFW:function(e){d.setTypesCallbackForOFW(e,{setTypesCallbackSubscribe:this._setTypesCallbackSubscribe}),this._setTypesCallbackSubscribe=!0},isAlreadyRunning:function(){return null!==(y.get("widget")||window.widget).body.getElement(".create-view-dialog")}},updateUXForEditMode:function(){this.options.editMode||(this.templateList.toolBarContainer.hide(),this.templateList.dataGridContainer.addClassName("isu-template-dialog-full-height-without-toolbar"))}})}),define("DS/IssueComponents/templates/TemplatesDialog",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/ENOFloatingPanel/ENOFloatingPanel","DS/IssueComponents/templates/TemplatesDataGridLayout","DS/IssueCommon/utils/Utils","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,s,n,i,o,a,r,l,c,d,u){var m="templateMaturityGraph",p="Issue",f="ISU_TYPE_NLS",h="CUSTOM_ATTR_INFOS",g="ISSUE_EXTENSIONS",v="CUSTOM_ATTR_NLS";return t.extend({name:"DS/IssueComponents/templates/TemplatesDialog",isLoaded:null,_deferred:{resolve:null,reject:null},_isRendered:!1,init:function(e,t){this.container=e,this.options=t,this.elements={dialog:null,footer:null},this.buttons={select:null,cancel:null},this.onClose=t.onClose.bind(this)},render:async function(){await this.getTemplateMaturityGraph(),await this.setClassContentType({policies:["Issue Template"]}),await this.getIssueTypeInfo(),await this.getIssueProperties(),this.templateComponent=new c(this.container,this.options),this.templateComponent.renderDialog(),this.setFooter(),this.dialog(this.container),this.templateModelEvents=this.templateComponent.document.getTemplateModelEvents(),this.subscribers()},getTemplateMaturityGraph:function(){return r.issues.getIssueMaturityGraph({}).then(e=>{if(null!=e&&""!==e&&""!==e.body){var t=e.body[m];a.add(m,t)}}).catch(e=>{})},setClassContentType:function(t){var s={data:t};return new e(function(e,t){r.issues.getStatesAttributes(s).then(function(t){d.addCSSMaturityClasses("wux-controls-label",t),e()})}).catch(function(e){return e})},getIssueTypeInfo:async function(){var e=[p];let t=await r.type.getSubType();null!=t&&Object.keys(t).length>0&&(e=Object.keys(t));var s={"ds6w:type":await this.getTypeExtensions(e)};let n=await r.getNLSValuesPromise(s);a.add(f,n)},getIssueProperties:async function(){var t=this;let n=[],i=[],o=a.get(f),l=[];s.is(o["ds6w:type"])&&(l=Object.keys(o["ds6w:type"]));for(let e of l){n.push(e);let t=r.type.getProperties(e);i.push(t)}await e.all(i).then(e=>{if(Array.isArray(e)){let s=e.map(e=>{if(null!=e&&e.classPredicates&&e.classPredicates.length)return e.classPredicates[0].vocabularyPredicateInfo}).filter(function(e){return void 0!==e}),n=[];s.map(e=>{let t=e.filter(e=>{if(e.hasOwnProperty("userAccess"))return e});n.push(...t)});const i=[...new Set(n.map(e=>JSON.stringify(e)))].map(e=>JSON.parse(e));a.add(h,i),t.customAttrRangeVals(i)}})},customAttrRangeVals:function(e){const t=e.reduce(function(e,t){return null!=t.rangeValues&&(e[t.name]=t.rangeValues),e},{});a.add(v,t)},getTypeExtensions:function(t){return new e(function(s,n){let i=[],o=[],l=[];for(let e of t){i.push(e);let t=r.type.getClassExtensionInterface(e);l.push(t)}e.all(l).then(e=>{for(let t of e)if(t.extensions.length>0)for(let e of t.extensions)o.includes(e.curi)||o.push(e.curi);a.add(g,o),i.push(...o),s(i)})})},dialog:function(e){var t=this;t._closeCallbackEnabled=!0,t.elements.dialog=new l({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!1,resizable:!0,visible:!0,className:"create-template-chooser-dialog",title:t.options.editMode?u.templates.titleEdit:u.templates.title,header:null,footer:t.elements.footer,events:{onShow:function(){t.build()},onResizeFloating:function(){},onMove:function(){},onClose:function(){!0===t._closeCallbackEnabled&&(t.elements.dialog.destroy(),t.dispatchEvent("onTemplatesDialogClose"),t.onClose(),t.destroy(),t.templateComponent.destroy())}}}),new o({element:t.templateComponent.elements.body}).inject(t.elements.dialog.getBody()),t.elements.dialog.inject(e)},setFooter:function(){var e=this;e.elements.footer=s.createElement("div",{class:"create-template-chooser-footer"});var t=s.createElement("div",{class:"create-template-chooser-footer-btn-container"}).inject(e.elements.footer);if(!1===e.options.editMode){var i=e.buttons.select=new n({value:u.templates.selectButton,id:"create-template-chooser-footer-select-btn",className:"primary"}).inject(t);i.disable(),i.addEvent("onClick",function(){e.templateComponent.onEndCallback(),e.destroyDialog(),e.destroy(),e.templateComponent.destroy()})}(e.buttons.cancel=new n({value:e.options.editMode?u.templates.closeButton:u.templates.cancelButton,id:"create-template-chooser-footer-cancel-btn",className:"default"}).inject(t)).addEvent("onClick",function(){e.elements.dialog.options.events.onClose()})},build:function(){var e=this;!1===e._isRendered&&e.templateComponent.refreshTemplateList().then(function(){e._isRendered=!0}).catch(function(e){})},show:function(){this.elements.dialog.show(),this._closeCallbackEnabled=!0},hide:function(){this._closeCallbackEnabled=!1,this.elements.dialog.hide()},_listenToCreateEvents:function(e){var t=this;t.listenTo(e,"onTemplateCreate",function(){t.templateComponent.refreshTemplateList()}),t.listenTo(e,"onCreateDialogClose",function(){t.show()})},destroyDialog:function(){this.elements.dialog.destroy()},subscribers:function(){var e=this;e.templateModelEvents.subscribe({event:"template-xso-empty"},function(){e.buttons.select&&e.buttons.select.disable()}),e.templateModelEvents.subscribe({event:"template-xso-change"},function(){1==e.templateComponent.document.getSelectedTemplateNodes().length&&e.buttons.select?e.buttons.select.enable():e.buttons.select&&e.buttons.select.disable()}),e.templateModelEvents.subscribe({event:"hide-template-dialog-container"},function(){e.hide()}),e.templateModelEvents.subscribe({event:"show-template-dialog-container"},function(){e.show()})},destroy:function(){this.elements={dialog:null,footer:null},this.buttons={select:null,cancel:null}}})}),define("DS/IssueComponents/team/MembersDataGridLayout",["DS/IssueComponents/team/MembersDataGridView","DS/IssueComponents/team/MembersTileViewLayout","DS/IssueComponents/team/MembersGridUtil","DS/IssueComponents/team/MembersDataGridModel","DS/IssueComponents/team/AddMembersLayout","DS/IssueComponents/team/MembersDataGridViewToolbar","DS/IssueServices/services/IssueServices","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/TooltipModel","DS/PADUtils/views/PADAlert","DS/UIKIT/Mask","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,s,n,i,o,a,r,l,c,d,u,m,p,f,h){"use strict";var g={createMembersView:function(t){this.view=t;var i={};(i=UWA.merge(i,t.options)).columns=s.getColumns(),this.membersDataGridModel=new n(t.options.id),i.treeDocument=this.membersDataGridModel.createTreeDocument(),this.membersTreeModel=i.treeDocument;var o=new e(i);this.membersDataGridView=o,this._customizeColumnRendering(i.columns);this.membersDataGridView.membersDatagrid;return this.loadContent(i.physicalIds)},loadContent:function(e){var t=this;return t.physicalIds=e,t.membersTreeModel.removeRoots(),new Promise(function(s,n){a.issues.retrieve({timestamp:t._timestampUpdate?t._timestampUpdate:null,data:{objects:e.map(function(e){return{physicalId:e}})},onComplete:function(e){var i;t.physicalIds.length>1?(t.membersDataGridView.membersDatagrid.layout.setColumnVisibleFlag("propagate",!0),t.membersDataGridView.membersDatagrid.layout.setColumnVisibleFlag("memberof",!0),!(i=o.toolbar.getNodeModelByID("propagate"))||0!=i.options.grid.semantics.visibleFlag&&void 0!==i.options.grid.semantics.visibleFlag||i.updateOptions({grid:{semantics:{visibleFlag:!0}}})):(t.membersDataGridView.membersDatagrid.layout.setColumnVisibleFlag("propagate",!1),t.membersDataGridView.membersDatagrid.layout.setColumnVisibleFlag("memberof",!1),!(i=o.toolbar.getNodeModelByID("propagate"))||1!=i.options.grid.semantics.visibleFlag&&void 0!==i.options.grid.semantics.visibleFlag||i.updateOptions({grid:{semantics:{visibleFlag:!1}}}));if(Array.isArray(e.results)){for(var a=e.results.map(function(e){return e.body}),r=[],l=0;l<a.length;l++){var c={id:a[l].physicalId,name:a[l].name,state:a[l].state,title:a[l].title?a[l].title:"",type:a[l].type,assignees:a[l].assignees,coOwners:a[l].coOwners,owner:a[l].owner,contributors:a[l].contributors,informedUsers:a[l].informedUsers};r.push(c)}t.issues=r;r&&r.length>0&&(t.owners=t.getUsersMap(r,"owner"),Object.keys(t.owners),Object.assign({},t.owners),t.coOwners=t.getUsersMap(r,"coOwners"),t.assignees=t.getUsersMap(r,"assignees"),t.contributors=t.getUsersMap(r,"contributors"),t.informedUsers=t.getUsersMap(r,"informedUsers"),Object.keys(t.owners).forEach(function(e){t.coOwners.hasOwnProperty(e)&&(t.owners[e].roles.includes("Co-owner")||t.owners[e].roles.push("Co-owner")),t.assignees.hasOwnProperty(e)&&(t.owners[e].roles.includes("Assignee")||t.owners[e].roles.push("Assignee")),t.contributors.hasOwnProperty(e)&&(t.owners[e].roles.includes("Contributor")||t.owners[e].roles.push("Contributor")),t.informedUsers.hasOwnProperty(e)&&(t.owners[e].roles.includes("InformedUser")||t.owners[e].roles.push("InformedUser"))}),Object.keys(t.coOwners).forEach(function(e){t.owners.hasOwnProperty(e)&&(t.coOwners[e].roles.includes("Owner")||t.coOwners[e].roles.push("Owner")),t.assignees.hasOwnProperty(e)&&(t.coOwners[e].roles.includes("Assignee")||t.coOwners[e].roles.push("Assignee")),t.contributors.hasOwnProperty(e)&&(t.coOwners[e].roles.includes("Contributor")||t.coOwners[e].roles.push("Contributor")),t.informedUsers.hasOwnProperty(e)&&(t.coOwners[e].roles.includes("InformedUser")||t.coOwners[e].roles.push("InformedUser"))}),Object.keys(t.assignees).forEach(function(e){t.owners.hasOwnProperty(e)&&(t.assignees[e].roles.includes("Owner")||t.assignees[e].roles.push("Owner")),t.coOwners.hasOwnProperty(e)&&(t.assignees[e].roles.includes("Co-owner")||t.assignees[e].roles.push("Co-owner")),t.contributors.hasOwnProperty(e)&&(t.assignees[e].roles.includes("Contributor")||t.assignees[e].roles.push("Contributor")),t.informedUsers.hasOwnProperty(e)&&(t.assignees[e].roles.includes("InformedUser")||t.assignees[e].roles.push("InformedUser"))}),Object.keys(t.contributors).forEach(function(e){t.owners.hasOwnProperty(e)&&(t.contributors[e].roles.includes("Owner")||t.contributors[e].roles.push("Owner")),t.assignees.hasOwnProperty(e)&&(t.contributors[e].roles.includes("Assignee")||t.contributors[e].roles.push("Assignee")),t.coOwners.hasOwnProperty(e)&&(t.contributors[e].roles.includes("Co-owner")||t.contributors[e].roles.push("Co-owner")),t.informedUsers.hasOwnProperty(e)&&(t.contributors[e].roles.includes("InformedUser")||t.contributors[e].roles.push("InformedUser"))}),Object.keys(t.informedUsers).forEach(function(e){t.owners.hasOwnProperty(e)&&(t.informedUsers[e].roles.includes("Owner")||t.informedUsers[e].roles.push("Owner")),t.assignees.hasOwnProperty(e)&&(t.informedUsers[e].roles.includes("Assignee")||t.informedUsers[e].roles.push("Assignee")),t.coOwners.hasOwnProperty(e)&&(t.informedUsers[e].roles.includes("Co-owner")||t.informedUsers[e].roles.push("Co-owner")),t.contributors.hasOwnProperty(e)&&(t.informedUsers[e].roles.includes("Contributor")||t.informedUsers[e].roles.push("Contributor"))})),t.membersDataGridModel.loadMembersData(t.membersTreeModel,t.owners,t.coOwners,t.assignees,t.contributors,t.informedUsers),g.changeView(),s()}else n(new Error("Unexpected response when retrieving issues."))},onFailure:function(e){p.displayNotification({msg:h.team.error.loadContent,eventID:"error"}),n(e)}})})},getUsersMap:function(e,t){var s={},n="";switch(t){case"owner":n="Owner";break;case"coOwners":n="Co-owner";break;case"assignees":n="Assignee";break;case"contributors":n="Contributor";break;case"informedUsers":n="InformedUser"}return e&&e.length>0&&(s=e.reduce(function(s,i){if(i[t])if(Array.isArray(i[t]))for(var o=i[t],a=0;a<o.length;a++)i[t][a].roles=[n],i[t][a].type=o[a].type,void 0!==s[i[t][a].user]?(i[t][a].count=s[i[t][a].user].count+1,i[t][a].count==e.length?i[t][a].common=!0:i[t][a].common=!1):(i[t][a].count=1,i[t][a].common=!1),s[i[t][a].user]=i[t][a];else i[t].roles=[n],i[t].type="person",s[i[t].user]=i[t];return s},{})),s},_customizeColumnRendering:function(e){var t=this;e.forEach(function(e){switch(e.dataIndex){case"tree":e.onCellRequest=t.rendering.title.bind(t);break;case"propagate":e.onCellRequest=t.rendering.propagate.bind(t);break;case"user":break;case"memberof":e.onCellRequest=t.rendering.memberOf.bind(t);break;case"ContextualMenuColumn":e.hasCellValue=t.rendering.contextualMenuColumn.bind(t)}})},rendering:{title:function(e){var t="";if(e.nodeModel.options.grid.isRoot){var s=e.nodeModel.getNumberOfChildren();"Owner"===e.nodeModel.options.grid.role?t=UWA.createElement("span",{class:"member-title",html:h.team.owner.title+" ("+s+")"}):"Co-owner"===e.nodeModel.options.grid.role?t=UWA.createElement("span",{class:"member-title",html:h.team.coOwners.title+" ("+s+")"}):"Assignee"===e.nodeModel.options.grid.role?t=UWA.createElement("span",{class:"member-title",html:h.team.assignees.title+" ("+s+")"}):"Contributor"===e.nodeModel.options.grid.role?t=UWA.createElement("span",{class:"member-title",html:h.team.contributors.title+" ("+s+")"}):"InformedUser"===e.nodeModel.options.grid.role&&(t=UWA.createElement("span",{class:"member-title",html:h.team.informedUsers.title+" ("+s+")"}))}else t=this.membersDataGridModel.createCustomPersonNameField(e.nodeModel.options.grid);t.computeContentSize=function(){return this.getChildren().length>0&&this.getChildren()[1]?this.getChildren()[1].getDimensions().width+50:this.getDimensions().width+50},e.cellView.setReusableContent(t)},propagate:function(e){var t=this,s="",n=null;let i="";if(e.nodeModel.options.grid.isRoot||"Owner"===e.nodeModel.getParent().options.grid.role||1==t.physicalIds.length)n=UWA.createElement("span",{}),e.cellView.setReusableContent(n);else{var o=e.nodeModel.options.grid.common;n=UWA.createElement("span",{class:"propagate-column",html:UWA.createElement("span",{class:s})}),0==o&&(s="wux-ui-3ds wux-ui-3ds-propagate wux-ui-3ds-lg members-propagate",n.addContent(UWA.createElement("span",{class:s})),i=h.resolveIssues.tooltips.propagateTooltip,n.addEventListener("click",function(){var s=[e.nodeModel];t.propagateMember(s)}.bind(t))),e.cellView.setReusableContent(n)}n&&(n.tooltipInfos=new m({shortHelp:i,mouseRelativePosition:!1,position:"bottom"}))},memberOf:function(e){var t=null;if(e.nodeModel.options.grid.isRoot||"Owner"===e.nodeModel.getParent().options.grid.role)t=UWA.createElement("span",{}),e.cellView.setReusableContent(t);else{var s=e.nodeModel.options.grid.common;t=UWA.createElement("span",{class:"memberof-column"}),0==s&&this.physicalIds.length>1?t.addContent(UWA.createElement("span",{class:"memberof",html:h.team.common.varies})):t.addContent(UWA.createElement("span",{class:"memberof",html:h.team.common.allIssues})),e.cellView.setReusableContent(t)}},contextualMenuColumn:function(e){let t=!0;return t=!e.nodeModel.options.grid.isRoot}},propagateMember:function(e){for(var t=0;t<e.length;t++){var s=e[t].getParent().options.grid.role,n={identifier:e[t].options.grid.user,name:e[t].options.grid.fullName,type:e[t].options.grid.type},o=[],a=[],c=[],d=[];"Co-owner"==s?o.push(n):"Assignee"==s?a.push(n):"Contributor"==s?c.push(n):"InformedUser"==s&&d.push(n),i.addMembers(o,a,c,d,!1,"",e[t])}try{var u=l.get("component").getCurrentView();r.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:u,pd3:"MembersActions",pd4:"Propogate",pd5:"Issue/"+u+"/MembersActions/Propogate"}}),r.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"MembersActions"}})}catch(e){}},propagateCoowners:function(e){e.role="coOwners",g.propagateMembers(e)},propagateAssignees:function(e){e.role="assignees",g.propagateMembers(e)},propagateContributors:function(e){e.role="contributors",g.propagateMembers(e)},propagateInformedUsers:function(e){e.role="informedUsers",g.propagateMembers(e)},propagateMembers:function(e){var t=[],s=[],n=[],o=[];if("coOwners"==e.role){var a=g.coOwners;for(var r in a){var l=a[r],c={identifier:l.user,name:l.fullName};t.push(c)}}if("assignees"==e.role){var d=g.assignees;for(var r in d){var u=d[r];c={identifier:u.user,name:u.fullName,type:u.type};s.push(c)}}if("contributors"==e.role){var m=g.contributors;for(var r in m){var p=m[r];c={identifier:p.user,name:p.fullName};n.push(c)}}if("informedUsers"==e.role){var f=g.informedUsers;for(var r in f){var h=f[r];c={identifier:h.user,name:h.fullName,type:h.type};o.push(c)}}i.addMembers(t,s,n,o,!0,e.role)},changeView:function(e){s.changeView("GridView")},addNodesInLayout:function(e,t){g.membersDataGridModel.addNodesInLayoutModel(this.membersTreeModel,e,t)},removeHandler:function(){var e=g.membersDataGridModel.treeDocument.getSelectedNodes(),t=e[0].options.grid.roles,s=(t.indexOf("Owner"),1==t.length&&t.indexOf("Owner")>=0);if(1==e.length&&s)p.displayNotification({msg:h.team.error.warnRemoveOwner,eventID:"warning"});else{var n=new c({}),i=document.getElementById("iss-outer-member-grid-div");n.inject(i),new d({immersiveFrame:n,title:h.team.removeTitle,content:h.team.removeMessage,activeFlag:!1,modelFlag:!0,width:500,buttons:{No:new u({domId:"removeMemberNo",onClick:function(e){n.destroy()}}),Yes:new u({domId:"removeMemberYes",onClick:function(e){n.destroy(),g.membersDataGridModel.removeChildren()}})}}).addEventListener("close",function(e){n&&n.destroy()})}try{var o=l.get("component").getCurrentView();r.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:o,pd3:"MembersToolbar",pd4:"Remove",pd5:"Issue/"+o+"/MembersToolbar/Remove"}}),r.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"MembersToolbar"}})}catch(e){}},updatePersonRole:function(e,t){var s=g.membersTreeModel.getSelectedNodes();if(s.length>0){for(var n=[],i=[],o=[],a=[],r=t.role,l=Array.isArray(r)?t[r[0]]:t[r],c=[],d=0;d<s.length;d++){var u=s[d].options.grid.user,m=s[d].options.grid.type;s[d].options.grid.roles;c.includes(u)||(r.indexOf("Contributor")>=0&&n.push({user:u}),r.indexOf("Assignee")>=0&&i.push({user:u,type:m}),r.indexOf("Coowner")>=0&&o.push({user:u}),r.indexOf("InformedUser")>=0&&a.push({user:u,type:m}),c.push(u))}"DISCONNECT"==l&&1==t.showConfirmation?g.showConfirmationDialog(l,o,i,n,a):g.updateMembers(l,o,i,n,a,!1)}},showConfirmationDialog:function(e,t,s,n,i){var o=new c({}),a=document.getElementById("iss-outer-member-grid-div");o.inject(a),new d({immersiveFrame:o,title:h.team.removeTitle,content:h.team.removeMessage,activeFlag:!1,modelFlag:!0,width:500,buttons:{No:new u({domId:"removeMemberNo",onClick:function(e){o.destroy()}}),Yes:new u({domId:"removeMemberYes",onClick:function(a){o.destroy(),g.updateMembers(e,t,s,n,i,!0)}})}}).addEventListener("close",function(e){o&&o.destroy()})},updateMembers:function(e,t,n,i,o,l){var c=this,d=[],u="",m=document.getElementById("iss-outer-member-grid-div");f.mask(m);for(var v=0;v<c.issues.length;v++){var b={physicalId:c.issues[v].id};t.length>0&&(b.coOwners=t,u="Co-owner"),n.length>0&&(b.assignees=n,u="Assignee"),i.length>0&&(b.contributors=i,u="Contributor"),o.length>0&&(b.informedUsers=o,u="InformedUser"),d.push(b)}"CONNECT"===e?a.people.update({data:{objects:d}}).then(function(){var e=g.membersTreeModel,t=e.getSelectedNodes()[0];e.prepareUpdate();var n=t.options.grid.role,i=t.options.description,o=s.getRoleNLSValue(u);let a=","+u,r=", "+o;var l=i.concat(r);g.membersDataGridModel.treeDocument.getAllDescendants().forEach(function(e){e.options.grid.user===t.options.grid.user&&(e.setAttribute("roleList",l),e.options.description=l,e.options.grid.role=n.concat(a),e.options.grid.roles.push(u))});var d={};d.user=t.options.grid.user,d.fullName=t.options.grid.fullName,d.roles=t.options.grid.roles,d.type=t.options.grid.type,"Co-owner"===u?g.addNodesInLayout([d],"coowners"):"Assignee"===u?g.addNodesInLayout([d],"assignees"):"Contributor"===u?g.addNodesInLayout([d],"contributors"):"InformedUser"===u&&g.addNodesInLayout([d],"informedUsers"),e.pushUpdate(),c.view.dispatchEvent("onUpdate",{issues:g.issues}),f.unmask(m)}).catch(function(e){if(f.unmask(m),e.error.message.includes("'business object' does not exist")){var t=r.getErrorMessage("0");r.displayErrorMessage(t,"error")}else if(UWA.is(e.error.internal)&&e.error.internal.includes("You do not have the permissions to perform this action")){t=r.getErrorMessage("1");r.displayErrorMessage(t,"error")}else if(UWA.is(e.error.internal)&&e.error.internal.includes("No toconnect access to business object")){t=r.getErrorMessage("10");r.displayErrorMessage(t,"error")}else if(UWA.is(e.error.internal)&&e.error.internal.includes("No 'modify' access on Attribute 'Co-Owners' for")){t=r.getErrorMessage("2005");r.displayErrorMessage(t,"error")}else p.displayNotification({msg:e.error.message,eventID:"error"})}):"DISCONNECT"===e&&a.people.delete({data:{objects:d}}).then(function(){var e=g.membersTreeModel,t=e.getSelectedNodes(),n=!1;if(1==l)for(var i=0;i<t.length;i++){t[i].options.grid.roles.indexOf("Owner")>=0&&(n=!0),(a=g.membersDataGridModel.treeDocument.getAllDescendants()).forEach(function(e){e.options.grid.user===t[i].options.grid.user&&("Owner"!=e.getParent().options.grid.role?e.remove():e.options.grid.roles=["Owner"])})}else{e.prepareUpdate();var o=e.getSelectedNodes()[0],a=g.membersDataGridModel.treeDocument.getAllDescendants(),r=o.options.grid.role,d=o.options.description,v=s.getRoleNLSValue(u),b=s.removeRole(d,v);a.forEach(function(e){if(e.options.grid.user===o.options.grid.user)if(e.getParent().options.grid.role==u)e.remove();else{e.setAttribute("roleList",b),e.options.description=b,e.options.grid.role=s.removeRole(r,u);var t=o.options.grid.roles.filter(function(e,t,s){return e!=u});e.options.grid.roles=t}}),e.pushUpdate()}g.membersDataGridModel.coowners.setLabel(h.team.coOwners.title+" ("+g.membersDataGridModel.coowners.getNumberOfChildren()+")"),g.membersDataGridModel.assignees.setLabel(h.team.assignees.title+" ("+g.membersDataGridModel.assignees.getNumberOfChildren()+")"),g.membersDataGridModel.contributors.setLabel(h.team.contributors.title+" ("+g.membersDataGridModel.contributors.getNumberOfChildren()+")"),g.membersDataGridModel.informedUsers.setLabel(h.team.informedUsers.title+" ("+g.membersDataGridModel.informedUsers.getNumberOfChildren()+")"),n&&p.displayNotification({msg:h.team.error.skipRemoveOwner,eventID:"info"}),c.view.dispatchEvent("onUpdate",{issues:g.issues}),f.unmask(m)}).catch(function(e){if(f.unmask(m),e.error.message.includes("'business object' does not exist")){var t=r.getErrorMessage("0");r.displayErrorMessage(t,"error")}else if(UWA.is(e.error.internal)&&(e.error.internal.includes("No 'modify' access on Attribute 'Co-Owners' for")||e.error.internal.includes("No 'read' access on Attribute 'Co-Owners' for")||e.error.internal.includes("You do not have the permissions to perform this action"))){t=r.getErrorMessage("1");r.displayErrorMessage(t,"error")}else p.displayNotification({msg:e.error.message,eventID:"error"})})}};return g}),define("DS/IssueComponents/team/TeamNew",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Mask","DS/Logger/Logger","DS/IssueComponents/team/MembersDataGridLayout","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/IssueComponents/IssueComponents.css"],function(e,t,s,n,i,o,a){"use strict";return t.extend({name:"DS/IssueComponents/team/TeamNew",tag:"div",className:"team-view-panel",setup:function(e){this._logger=i.getLogger("DS/IssueComponents/team/TeamNew"),this._logger.log("Initializing the team component"),this.isLoaded=null,this._deferred={resolve:null,reject:null},this.physicalIds=e.physicalIds,this.issues=[],this.options=e,this.reset()},reset:function(){var t=this;t.isLoaded=new e(function(e,s){t._deferred.resolve=e,t._deferred.reject=s}),s.is(t.view,"object")&&t.view.container&&t.view.container.destroy(),t.view={container:null}},destroy:function(){for(var e in this.view&&this.view.container&&this.view.container.destroy(),this)this.hasOwnProperty(e)&&delete this[e]},render:function(){var e=this;return n.mask(e.container),e.view={},e.view.container=s.createElement("div",{class:"team-view-container"}),e.options.target=e.view.container,e.view.container.inject(e.container),e.layout=o,o.createMembersView(e).then(function(){n.unmask(e.container),e._deferred.resolve()},function(t){n.unmask(e.container),e._deferred.reject(t),e.dispatchEvent("onFailure",{error:t})}),e},refresh:function(e){return Array.isArray(e)&&(this.physicalIds=e,this.setOption("physicalIds",e)),this.loadMembers(this.physicalIds),this.isLoaded},loadMembers:function(e){var t=this;return n.mask(t.container),o.loadContent(e).then(function(){n.unmask(t.container),t._deferred.resolve()},function(e){n.unmask(t.container),t._deferred.reject(e),t.dispatchEvent("onFailure",{error:e})}),t}})});