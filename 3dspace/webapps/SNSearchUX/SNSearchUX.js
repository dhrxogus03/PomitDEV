/*!  COPYRIGHT DASSAULT SYSTEMES 2014   */
define("DS/SNSearchUX/dropdown/SearchDropDownUtils",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","UWA/Element","UWA/Promise","DS/PubSub/PubSub","DS/i3DXCompassServices/i3DXCompassPubSub","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/UIKIT/Modal","DS/WebappsUtils/WebappsUtils","DS/Controls/Toggle","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/ServiceDelegationLoader","DS/SNInfraUX/utils/SNCompassUtils","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchSettings","DS/SNResultUX/utils/SearchTagsTransformation","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/ExternalComponentHelpers","DS/SNResultUX/collections/SearchCollection","DS/SNResultUX/layouts/SNSkeletonMgt_v2","DS/SNSearchUX/SuggestionUXHelper","DS/SNSearchUX/dropdown/myContentView","DS/SNSearchUX/dropdown/categoryContentView","DS/SNSearchUX/dropdown/resultsContentView","DS/SNSearchUX/dropdown/guidedContentView","text!DS/SNSearchUX/assets/templates/SearchDropDown/headerSections.html","text!DS/SNSearchUX/assets/templates/SearchDropDown/SearchDropDown.html","text!DS/SNSearchUX/assets/templates/SearchDropDown/SearchDropDownNoHistory.html","text!DS/SNSearchUX/assets/templates/GuidedMode/GuidedMode.html","text!DS/SNSearchUX/assets/templates/GuidedMode/GuidedModeExample.html","text!DS/SNSearchUX/assets/templates/GuidedMode/GuidedModeBeta.html","text!DS/SNSearchUX/assets/templates/GuidedMode/GuidedModeBetaNotif.html","text!DS/SNSearchUX/assets/templates/GuidedMode/GuidedMode.json","i18n!DS/SNSearchUX/assets/nls/SearchDropDown.json","i18n!DS/SNSearchUX/assets/nls/GuidedMode.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","i18n!DS/SNSearchUX/assets/nls/SNSearchUX.json"],function(e,t,i,n,s,o,a,r,c,l,d,u,h,p,g,_,m,S,f,v,C,y,w,b,D,E,I,T,x,M,A,N,k,P,O,U,V,L,F,B,R){"use strict";var H=t.singleton(n,i,{name:"DS_SearchDropDownUtils",_myContentView:null,_categoryContentView:[],_guidedContentView:null,_resultsContentView:null,_taggerProxy:null,_resutlsContentcollection:null,_searchtabbuttonscontainer:null,_nlsPromises:{},_modal:null,_modalVisibility:!1,_modalBody:null,_SmartQueryController:null,_guidedModeDiv:null,_SearchDropDownSettings:null,_SearchDropDownPQs:null,_settingsDisplay:!1,_helpsDisplay:!1,_dropdown:null,_inContextMode:!1,_toggleactivation:!1,_toggle:null,_togglecontainer:null,_togglecontainerDropdown:null,_skeleton:null,_guidedModeBetaClose:null,init:function(){this._init()},_init:function(){this._myContentView=null,this._categoryContentView=[],this._guidedContentView=null,this._resultsContentView=null,this._taggerProxy=null,this._resutlsContentcollection=null,this._searchtabbuttonscontainer=null,this._nlsPromises={},this._modal=null,this._modalBody=null,this._SmartQueryController=null,this._guidedModeDiv=null,this._SearchDropDownSettings=null,this._SearchDropDownPQs=null,this._settingsDisplay=!1,this._helpsDisplay=!1,this._dropdown=null,this._inContextMode=!1,this._toggle=null,this._togglecontainer=null,this._togglecontainerDropdown=null,this._modalVisibility=!1,this._toggleactivation=!1,this._skeleton=null,this._guidedModeBetaClose=S.getItem("guidedModeBetaClose")},clean:function(){document.body.removeEventListener("click",this._onClickbody.bind(this)),this._myContentView&&e.is(this._myContentView.destroy,"function")&&this._myContentView.destroy(),this._categoryContentView=[],this._guidedContentView&&e.is(this._guidedContentView.destroy,"function")&&this._guidedContentView.destroy(),this._resultsContentView&&e.is(this._resultsContentView.destroy,"function")&&this._resultsContentView.destroy(),this._resutlsContentcollection&&e.is(this._resutlsContentcollection.destroy,"function")&&this._resutlsContentcollection.destroy(),this._modal&&e.is(this._modal.destroy,"function")&&this._modal.destroy(),this._SmartQueryController&&e.is(this._SmartQueryController.destroy,"function")&&this._SmartQueryController.destroy(),this._SearchDropDownSettings&&e.is(this._SearchDropDownSettings.destroy,"function")&&this._SearchDropDownSettings.destroy(),this._SearchDropDownPQs&&e.is(this._SearchDropDownPQs.destroy,"function")&&this._SearchDropDownPQs.destroy(),this._toggle&&e.is(this._toggle.destroy,"function")&&this._toggle.destroy(),this._init()},getSNSkeleton:function(){return this._initSkeletonMgt()},getGuidedmodeStatus:function(){return this._toggleactivation},getMyContentView:function(){return this._myContentView&&this._myContentView.multiViewContainer},getCategoryContentView:function(e){return this._categoryContentView[e]&&this._categoryContentView[e].multiViewContainer},getGuidedContentView:function(){return this._guidedContentView&&this._guidedContentView.multiViewContainer},getResultsContentView:function(){return this._resultsContentView&&this._resultsContentView.multiViewContainer},setController:function(e){this._SmartQueryController=e},getController:function(e){return this._SmartQueryController},buildToggleActivation:function(t){let i=this;h.log("SearchDropDownUtils::buildToggleActivation options: ",t);const{container:n,dropdown:o,state:a=!1}=t;i._toggle&&e.is(i._toggle.destroy,"function")&&i._toggle.destroy(),i._toggle=null,i._toggleactivation=a,i._buildGuideModeBetaNotif(t),e.is(i._toggle)||(i._togglecontainerDropdown=n,i._activationcontent=s.create("div",{class:"smart-queries-activation-content"}),y.tooltip(i._activationcontent,{title:p.escapeHtml(F.get("toggleGuided.title")),position:"bottom",reshowDelay:2.5,mouseRelativePosition:!0,longHelp:p.escapeHtml(F.get("toggleGuided.LongHelp"))}),i._toggle=new u({type:"switch",touchMode:!0,label:L.get("smart.mode.activation"),checkFlag:i._toggleactivation}),i._toggle.inject(i._activationcontent),!1===i._toggleactivation?(i._activationcontent.hide(),i._activationcontent.inject(i._togglecontainerDropdown)):i._activationGuidedMode(t),i._toggle.addEventListener("buttonclick",function(n){if(e.is(n)&&e.is(n.dsModel)){let s=n.dsModel;e.is(s)&&(i._toggleactivation=s.checkFlag,!0===i._toggleactivation?i._activationGuidedMode(t):(i._backToStandard(),setTimeout(function(){i._activationcontent.inject(i._togglecontainerDropdown)},100),!0===o.webInwin&&o.eventManager.dispatchEvent("onGuidedMode",!1)))}}))},_activationGuidedMode:function(t){let i=this;const{dropdown:n}=t;setTimeout(function(){i._activationcontent&&i._activationcontent.inject(i._togglecontainer)},100),n&&n.onBlur(void 0,!0),i._activationcontent.show(),i._toggleactivation=!0,i.modalVisibility(!0);let s=!1;"3DSwym"!==p.identifyClientInfo().identifier&&(s=!0);let o={dropdown:n,srcRessource:n._srcRessource,webInwin:n.webInwin,eventManager:n.eventManager,inputValue:n.getInputValue(),placeHolderValue:n.getPlaceHolderValue(),favoriteSearch:s,SimilarSearch:e.is(n.getOption("SimilarSearch"))?n.getOption("SimilarSearch"):void 0,PartSupply:e.is(n.getOption("PartSupply"))?n.getOption("PartSupply"):void 0,Relations:e.is(n.getOption("Relations"))?n.getOption("Relations"):void 0,noresult:()=>{n.elements.myContentEmptyView&&n.elements.myContentEmptyView.show()}};H.buildFullDropDown(o),S.setItem("smartMode",i._toggleactivation),S.commit(),!0===n.webInwin&&n.eventManager.dispatchEvent("onGuidedMode",!0)},buildFullDropDown:function(t){let i=this;if(h.log("SearchDropDownUtils::buildFullDropDown options: ",t),e.is(i._modal)||(i._modal=new l({className:"search-drop-down",closable:!1,body:"",events:{onHide:function(){h.log("SearchDropDownUtils::buildFullDropDown onHide");let t=e.extendElement(document.body.querySelector(".modal-overlay"));t&&t.removeClassName("search"),i.modalVisibility(!1)}}}).inject(document.body),i._resources=t.srcRessource,i._promiseVocabNLS("ds6w",{resources:i._resources}),i._buildModalContent(t)),e.is(i._modal)){i.modalVisibility(!0),i._SmartQueryController&&0===i._SmartQueryController._smartQuery.length()&&(i._SmartQueryController&&i._SmartQueryController.setInputValue(t.inputValue),t.inputValue.length?i._SmartQueryController._buildSuggestion(void 0,t.inputValue):i._SmartQueryController.clean()&&i._SmartQueryController._buildListOfTypes()),setTimeout(function(){i._SmartQueryController&&i._SmartQueryController.focusEditor()},100);let n=e.extendElement(document.body.querySelector(".modal-overlay"));n&&n.addClassName("searchdropdown")}},_buildModalContent:function(t){let i=this;h.log("SearchDropDownUtils::buildFullDropDown options: ",t);const{srcRessource:n,dropdown:o,eventManager:a,webInwin:r,favoriteSearch:c,SimilarSearch:l,PartSupply:d,Relations:u,inputValue:g,placeHolderValue:_}=t;if(!e.is(i._modal)||e.is(i._modalBody))return;i._dropdown=o;let m=p.escapeHtml(F.get("smart.mode.section.history")),S=p.escapeHtml(F.get("nohistory")),f=p.escapeHtml(F.get("noresultfound")),v=p.escapeHtml(F.get("noresultfound.text")),C=p.escapeHtml(L.get("search.tab.settings")),y=p.escapeHtml(L.get("search.tab.help")),w=p.escapeHtml(L.get("smart.mode.activation")),b=p.escapeHtml(F.get("instant.empty"));N=(N=N.replace("###searchhistory###",m)).replace("###nohistory###",S),A=(A=(A=(A=(A=(A=A.replace("###noresultfound###",f)).replace("###noresultfound.text###",v)).replace("###instant.empty###",b)).replace("###settings###",C)).replace("###help###",y)).replace("###dropdownback###",w);let D=p.escapeHtml(L.get("search.myContent.title")),E=p.escapeHtml(L.get("search.favoriteSearch")),I=p.escapeHtml(L.get("search.advancedSearch")),T=p.escapeHtml(L.get("search.DDM_SomeCommands_SimilarSearch_Header")),x=p.escapeHtml(L.get("search.PartSupplyHeader")),M=p.escapeHtml(L.get("search.DDM_SomeCommands_RelNavWbWn_Header")),k=p.escapeHtml(L.get("smart.mode.examples.title"));A=(A=(A=(A=(A=(A=(A=A.replace("###myContent###",D)).replace("###myfavorite###",E)).replace("###advSearch###",I)).replace("###DDM_SomeCommands_SimilarSearch_Header###",T)).replace("###PartSupplyHeader###",x)).replace("###DDM_SomeCommands_RelNavWbWn_Header###",M)).replace("###examples###",k),i._modalBody=s.create("div",{class:"search-drop-down-full"}),i._modalBody.innerHTML=A,i._modal.setBody(i._modalBody);let P=e.extendElement(i._modalBody.querySelector(".suggestion-container-empty"));P&&(P.innerHTML=N),require(["DS/SNSearchUX/helpers/SmartQueryController"],function(n){let s=e.extendElement(i._modalBody.querySelector(".search-dropdown-input")),h=e.extendElement(i._modalBody.querySelector(".custom-suggestion-container-content")),p=e.extendElement(i._modalBody.querySelector(".searchResults-container")),m=e.extendElement(i._modalBody.querySelector(".instant-search-empty-view")),S=e.extendElement(i._modalBody.querySelector(".instant-search-apps")),f=e.extendElement(i._modalBody.querySelector(".search-empty-view")),v=e.extendElement(i._modalBody.querySelector(".guidedmode-content"));i._togglecontainer=e.extendElement(i._modalBody.querySelector(".search-guided-mode")),!0===i._toggleactivation&&i._activationcontent&&i._activationcontent.inject(i._togglecontainer),i._SmartQueryController=new n({dropdown:o,containerinput:s,containersuggestion:h,containerresult:p,instantSearchEmptyView:m,instantSearch:S,instantSearchEmpty:f,dropdownFull:!0}),i._SmartQueryController.render(s),i._SmartQueryController.setInputValue(g),i._SmartQueryController.setPlaceHolderValue(_);let C={container:v,dropdown:o,eventManager:a,webInwin:r,myContent:!0,favoriteSearch:c,SimilarSearch:l,PartSupply:d,Relations:u,strmycontent:D,strmyfav:E,stradvSearch:I,strSimilarSearch:T,strPartSupply:x,strRelations:M};i.buildheaderSection(C),i.buildguidedModeDiv({fullContainer:i._modalBody}),i._SmartQueryController._buildListOfTypes(),i._buildSettingsHelp(t),setTimeout(function(){i._SmartQueryController&&i._SmartQueryController.focusEditor(),document.body.addEventListener("click",i._onClickbody.bind(i))},150)})},buildMyContent:function(t){let i=this;h.log("SearchDropDownUtils::buildMyContent options: ",t);const{container:n,count:s,srcRessource:o,dropdown:a,eventManager:r,webInwin:c,noresult:l,onComplete:d}=t;if(e.is(i._myContentView))return i._myContentView.collection&&i._myContentView.collection.dispatchEvent("OnGroupingChange",{noresult:l,onComplete:d}),void h.log("SearchDropDownUtils::buildMyContent OnGroupingChange");i._dropdown=a,i._promiseVocabNLS("ds6w",{resources:o});let u=new w;u.setSearchRessources(o),u._fromDropDown=!0,u._isCategoryHelperCollection=!0,i._myContentView=new E({collection:u,id:"myContentDropdown"}),i._myContentView.collection.nresults=s,i._myContentView.collection._fromDropDown=!0,i._myContentView.container=n,i._myContentView.render(),i._myContentView.getCurrentViewId=function(){return i._myContentView.getViewId()},i._myContentView._clickOnHeader=function(t){e.is(a)&&(i.modalVisibility(!1),a.eventManager.dispatchEvent("myContent",{value:p.SearchTypeEnum.MY_CONTENT,adv_search:!1}),a.setPlaceHolderValue(L.get("search.myContent.title")),a._changeIcon("user"))},i._myContentView.mask=function(){i._mask(n)},i._myContentView.unmask=function(){i._unmask(n)},i._myContentView.onItemTitleClick=function(e,t){let n={dropdown:a,eventManager:r,webInwin:c};i._onItemTitleClick(e,t,n)},u&&u.dispatchEvent("OnGroupingChange",{noresult:l,onComplete:d})},buildcategoryContent:function(t){let i=this;h.log("SearchDropDownUtils::buildcategoryContent options: ",t);const{id:n,container:s,dropdown:o,srcRessource:a,eventManager:r,webInwin:c,query:l,count:d,noresult:u}=t;let p={query:l,noresult:u};if(e.is(i._categoryContentView,"array")){let t=i._categoryContentView[n]&&i._categoryContentView[n].collection;if(e.is(t))return void(t&&t.dispatchEvent("OnGroupingChange",p))}let g=new w;g.setSearchRessources(a),g._fromDropDown=!0;let _=new I({collection:g,id:n});i._categoryContentView[n]=_,_.container=s,_._nresults=d||2,_.render(),_.getCurrentViewId=function(){return _.getViewId()},_._clickOnHeader=function(t){if(!e.is(t)&&!e.is(t.id))return;let n={category_id:t.id,usertext:t.query,dropdown:o,eventManager:r,webInwin:c};i.onClickSection(n)},_.mask=function(){i._mask(s)},_.unmask=function(){i._unmask(s)},_.onItemTitleClick=function(e,t){let n={dropdown:o,eventManager:r,webInwin:c};i._onItemTitleClick(e,t,n)},_.collection&&_.collection.dispatchEvent("OnGroupingChange",p)},buildguidedContent:function(t){let i=this;h.log("SearchDropDownUtils::buildMyContent options: ",t);const{container:n,srcRessource:s,dropdown:o,eventManager:a,webInwin:r,query:c,count:l,noresult:d,onclickViewAll:u}=t;if(e.is(i._guidedContentView))return i._guidedContentView.collection&&i._guidedContentView.collection.dispatchEvent("OnGroupingChange",{query:c,noresult:d,onclickViewAll:u,utils:i}),void h.log("SearchDropDownUtils::buildMyContent OnGroupingChange");i._promiseVocabNLS("ds6w",{resources:s});let p=new w;p.setSearchRessources(s),p._fromDropDown=!0,i._guidedContentView=new x({collection:p,id:"guidedDropdown"}),i._guidedContentView.collection.nresults=l||5,i._guidedContentView.container=n,i._guidedContentView.render(),i._guidedContentView.getCurrentViewId=function(){return i._guidedContentView.getViewId()},i._guidedContentView._clickOnHeader=function(t){(e.is(t)||e.is(t.id))&&i._SmartQueryController&&i._SmartQueryController._applySearch()},i._guidedContentView.mask=function(){i._mask(n)},i._guidedContentView.unmask=function(){i._unmask(n)},i._guidedContentView.onItemTitleClick=function(e,t){let n={dropdown:o,eventManager:a,webInwin:r};i._onItemTitleClick(e,t,n)},p&&p.dispatchEvent("OnGroupingChange",{query:c,noresult:d,onclickViewAll:u,utils:i})},buildresutlsContent:function(t){let i=this;h.log("SearchDropDownUtils::buildresutlsContent options: ",t);const{container:n,dropdown:s,srcRessource:o,eventManager:a,webInwin:r,query:c,noresult:l}=t;if(e.is(i._resultsContentView))return void i._resultsContentView.fetch({query:c,count:2,noresult:l});i._resutlsContentcollection=new w,i._resutlsContentcollection.setSearchRessources(o),i._resutlsContentcollection.setTagsTransformer(new v({isTransientWidget:!0})),i._resutlsContentcollection._fromDropDown=!0;require(["DS/TagNavigatorProxy/TagNavigatorProxy"],function(e){i._resutlsContentcollection.setTaggerProxy(i._createTaggerProxy(e,o))}),i._resultsContentView=new T({collection:i._resutlsContentcollection,id:"resutlsDropdown"}),i._resultsContentView.container=n,i._resultsContentView._nresults=2,i._resultsContentView.render(),i._resultsContentView.getCurrentViewId=function(){return i._resultsContentView.getViewId()},i._resultsContentView._clickOnHeader=function(t){if(!e.is(t)&&!e.is(t.id))return;let n={category_id:t.id,usertext:t.query,dropdown:s,eventManager:a,webInwin:r};i.onClickSection(n)},i._resultsContentView.mask=function(){i._mask(n)},i._resultsContentView.unmask=function(){i._unmask(n)},i._resultsContentView.onItemTitleClick=function(e,t){let n={dropdown:s,eventManager:a,webInwin:r};i._onItemTitleClick(e,t,n)},i._resultsContentView.fetch({query:c,count:2,noresult:l})},buildheaderSection:function(e){h.log("SearchDropDownUtils::buildheaderSection options: ",e);const{container:t,dropdown:i,eventManager:n,webInwin:s,myContent:o,favoriteSearch:a,SimilarSearch:r,PartSupply:c,Relations:l}=e;let d=p.escapeHtml(L.get("search.myContent.title")),u=p.escapeHtml(L.get("search.favoriteSearch")),g=p.escapeHtml(L.get("search.advancedSearch")),_=p.escapeHtml(L.get("search.DDM_SomeCommands_SimilarSearch_Header")),m=p.escapeHtml(L.get("search.PartSupplyHeader")),S=p.escapeHtml(L.get("search.DDM_SomeCommands_RelNavWbWn_Header")),f=p.escapeHtml(L.get("smart.mode.examples.title"));M=(M=(M=(M=(M=(M=(M=(M=M.replace("###myContent###",d)).replace("###myFavorite###",u)).replace("###advSearch###",g)).replace("###DDM_SomeCommands_SimilarSearch_Header###",_)).replace("###PartSupplyHeader###",m)).replace("###DDM_SomeCommands_RelNavWbWn_Header###",S)).replace("###DDM_SomeCommands_RelNavWbWn_Header###",S)).replace("###examples###",f),this._searchtabbuttonscontainer=t,this._searchtabbuttonscontainer.innerHTML=M;let v={container:this._searchtabbuttonscontainer,dropdown:i,eventManager:n,webInwin:s,myContent:o,favoriteSearch:a,SimilarSearch:r,PartSupply:c,Relations:l,strmycontent:d,strmyfav:u,stradvSearch:g,strSimilarSearch:_,strPartSupply:m,strRelations:S};this._buildheaderSection(v)},buildguidedModeDiv:function(t){if(!e.is(t))return;let i=e.extendElement(t.fullContainer.querySelector(".guidedmode-examples"));return i&&i.show(),this._guidedModeDiv=i,this._buildexamplesList(),this._guidedModeDiv},hideAllContainer:function(){let t=this;if(e.is(t._modalBody)){let i=e.extendElement(t._modalBody.querySelector(".instant-search-empty-view"));i&&i.hide();let n=e.extendElement(t._modalBody.querySelector(".searchResults-container"));n&&n.hide();let s=e.extendElement(t._modalBody.querySelector(".instant-search-apps"));s&&s.hide();let o=e.extendElement(t._modalBody.querySelector(".search-empty-view"));o&&o.hide();let a=e.extendElement(t._modalBody.querySelector(".guidedmode-content"));a&&a.hide()}},showguidedContainer:function(){let t=this;if(e.is(t._modalBody)){let i=e.extendElement(t._modalBody.querySelector(".guidedmode-content"));this._buildexamplesList(),i&&i.show()}},showguidedResultsContainer:function(){let t=this;if(e.is(t._modalBody)){let i=e.extendElement(t._modalBody.querySelector(".searchResults-container"));i&&i.show()}},showhidehistoryContainer:function(t){let i=this;if(e.is(i._modalBody)){let n=e.extendElement(i._modalBody.querySelector(".custom-suggestion-container-content")),s=e.extendElement(i._modalBody.querySelector(".suggestion-container-empty"));t?n.show()&&s.hide():n.hide()&&s.show()}},showSettingsHelpsContainer:function(t){let i=this;if(e.is(i._modalBody)){let n=e.extendElement(i._modalBody.querySelector(".search-setting-pq"));n&&(t?n.show():n.hide())}},onClickObject:function(t){h.log("SearchDropDownUtils::onClickObject: ",t);const{model:i,text:n,webInwin:s,eventManager:o}=t;let l=i.getSourceID(),d=i.getServiceID(),u=i.getPlatformID(),_=i.get("resourceid"),m=C.buildCompassSelectionData({widgetId:"",selectedModels:[i]});r.publish("setX3DContent",m),"3dspace"===l?e.is(n)&&(a.dispatch("onViewSearch",[{displayString:n,query:'[ds6w:label]:"'+n+'"'}]),s&&!0===s&&o&&o.dispatchEvent("onViewSearch",{displayString:n,query:'[ds6w:label]:"'+n+'"'})):c.getServiceUrl({serviceName:d,platformId:u,onComplete:function(t){g.load({serviceID:d,platformID:u,serviceURL:t}).then(function(n){if(e.is(n.getDoubleClickAction,"function")){let s={model:i,serviceURL:t,appID:p.getSearchAppId(),client_feature:"search_topbar_suggest",onComplete:function(t){e.is(t)&&e.is(t.id,"string")&&e.is(t.sourceJS,"string")&&t.sourceJS.length>0&&require([t.sourceJS],function(e){e.executeAction({action_id:t.id,actionsHelper:{getModel:function(){return i},getPlatformID:function(){return u},getClientInfo:function(){return p.identifyClientInfo("")},getValue:function(e){let t=e.predicate?e.predicate:e.attribute;return i.get(t+"_value")}},object_ids:[_]})})},onFailure:function(e){h.log("SearchDropDownUtils::onClickObject onFailure: ",e)}};n.getDoubleClickAction.call(void 0,s)}})}})},onClickSection:function(t){const{category_id:i,usertext:n,dropdown:s,eventManager:o,webInwin:r}=t;let c=this;D.getSuggestHelper().then(function(){let t=D.buildSearchParams({category_id:i,search_text:n});t.objectToPreview="instantSearch",a.dispatch("onViewSearch",[e.extend({displayString:n},t)]),e.is(r)&&!0===r&&o&&o.dispatchEvent("onViewSearch",e.extend({displayString:n},t)),c.modalVisibility(!1)})},onClickApp:function(t){const{appId:i,webInwin:n,eventManager:s}=t;e.is(i)&&(n&&!0===n?s&&s.dispatchEvent("onClickApp",{appId:i}):_.launchApplicationFormCompass(i).then(function(e){C._displayAlert({message:e,className:"success"})},function(e){C._displayAlert({message:e,className:"error"})}))},getHistoryListFromLocalStorage:function(){return e.is(localStorage.SNSearchBoxStore)?JSON.parse(localStorage.SNSearchBoxStore).reverse():[]},removeHistoryFromLocalStorage:function(e,t){let i=this.getHistoryListFromLocalStorage();i.reverse();let n=i.filter(function(t){return t!==e});i.length!==n.length&&(localStorage.SNSearchBoxStore=JSON.stringify(n))},clearHistoryFromLocalStorage:function(){localStorage.SNSearchBoxStore=JSON.stringify([]),this._SmartQueryController&&(this._SmartQueryController._historyList=[])&&this._SmartQueryController.hideHistory()},removeHistoryElement:function(t){let i=this,n=t.getParent();if(e.is(n)){let e=n.getText();n.remove(),i.removeHistoryFromLocalStorage(e,n.id)}},getGuidedListFromLocalStorage:function(){return e.is(localStorage.SNSearchGuidedStore)?JSON.parse(localStorage.SNSearchGuidedStore).reverse():[]},saveToLocalStorage:function(t){if(!e.is(t))return;let i=this.getGuidedListFromLocalStorage().reverse();i[i.length]=JSON.stringify(t._query),localStorage.SNSearchGuidedStore=JSON.stringify(i)},removeGuidedFromLocalStorage:function(e){let t=this.getGuidedListFromLocalStorage();t.splice(e,1),t.reverse(),localStorage.SNSearchGuidedStore=JSON.stringify(t),this._buildexamplesList()},_mask:function(e){y.showOverlayLoader(void 0,e)},_unmask:function(e){y.hideOverlayLoader(e)},_onItemTitleClick:function(t,i,n){let s=this;if(e.is(n)&&e.is(t)&&e.is(i)&&!0!==s._inContextMode){let e=i&&i._models[t._rowID];s.modalVisibility(!1);let o={model:e,text:e.getDisplayName(),webInwin:n.webInwin,eventManager:n.eventManager};h.log("SearchDropDownUtils::_onItemTitleClick: ",o),s.onClickObject(o)}},_promiseVocabNLS:function(t,i){let n=this;return n._nlsPromises[t]?n._nlsPromises[t]:(n._nlsPromises[t]=new o(function(n,s){m.setResources(i),m.loadVocabulary(t,function(t){e.is(t)&&"success"===t.status?n():s()})}),n._nlsPromises[t])},modalVisibility:function(e,t){let i=this,n=i._modalBody&&i._modalBody.getParent();n&&n.removeClassName("escape"),n&&n.removeClassName("display"),!0===e?(n&&n.addClassName("display"),i._modal&&i._modal.show(),i._modalVisibility=!0,h.log("SearchDropDownUtils::modalVisibility true")):(n&&n.addClassName("escape"),i._dropdown&&i._dropdown.onBlur(void 0,!0),i._modal&&i._modal.hide(),i._modalVisibility=!1,t&&t.currentTarget&&t.currentTarget.focus(),h.log("SearchDropDownUtils::modalVisibility false"))},setInContextMode:function(t,i){let n=this;if(n._inContextMode=t,!0===t){let t=e.extendElement(n._searchtabbuttonscontainer.querySelector("#myFavoriteDropdown"));t&&t.hide()}else{let t=e.extendElement(n._searchtabbuttonscontainer.querySelector("#myFavoriteDropdown"));t&&t.show()}!0===n._toggleactivation&&n._inContextGuidedMode(n._inContextMode,i)},getInContextMode:function(){return this._inContextMode},_buildheaderSection:function(t){let i=this;if(!e.is(t))return;const{container:n,dropdown:s,eventManager:o,webInwin:a,myContent:r,favoriteSearch:c,SimilarSearch:l,PartSupply:d,Relations:u,strmycontent:h,strmyfav:g,stradvSearch:_,strSimilarSearch:m,strPartSupply:S,strRelations:f}=t;let v=e.extendElement(n.querySelector("#myContentDropdown"));e.is(v)&&e.is(r)&&!0===r&&(y.tooltip(v,{title:h,position:"bottom",reshowDelay:2.5,mouseRelativePosition:!0,longHelp:p.escapeHtml(L.get("search.myContent.LongHelp"))}),v.show(),v.addEventListener("click",function(e){i.modalVisibility(!1,e),o&&o.dispatchEvent("myContent",{value:p.SearchTypeEnum.MY_CONTENT,adv_search:!1}),s&&(s.setPlaceHolderValue(L.get("search.myContent.title")),s.elements.input.readOnly=!0,s._changeIcon("user"))})),v=e.extendElement(n.querySelector("#myFavoriteDropdown")),e.is(v)&&(e.is(c)&&!0===c?(y.tooltip(v,{title:g,position:"bottom",reshowDelay:2.5,mouseRelativePosition:!0,longHelp:p.escapeHtml(L.get("search.favoriteSearch.LongHelp"))}),v.show(),v.addEventListener("click",function(e){i.modalVisibility(!1,e),o&&o.dispatchEvent("favoriteSearches",{value:p.SearchTypeEnum.FAVORITE_SEARCH,adv_search:!1}),s&&(s.setPlaceHolderValue(L.get("search.favoriteSearch")),s.elements.input.readOnly=!0,s._changeIcon("on"))})):v.hide()),v=e.extendElement(n.querySelector("#advSearchDropdown")),e.is(v)&&(y.tooltip(v,{title:_,position:"bottom",reshowDelay:2.5,mouseRelativePosition:!0,longHelp:p.escapeHtml(L.get("search.advancedSearch.LongHelp"))}),v.addEventListener("click",function(e){i.modalVisibility(!1,e),o&&o.dispatchEvent("advancedSearch",{value:p.SearchTypeEnum.ADVANCED_SEARCH,adv_search:!0}),s&&(s.setPlaceHolderValue(L.get("search.advancedSearch")),s.elements.input.readOnly=!0,s._changeIcon("cog"))})),v=e.extendElement(n.querySelector("#DDM_SomeCommands_SimilarSearch_Header")),e.is(v)&&e.is(l)&&!0===l&&(y.tooltip(v,{title:m,position:"bottom",reshowDelay:2.5,mouseRelativePosition:!0,longHelp:p.escapeHtml(L.get("search.DDM_SomeCommands_SimilarSearch_Header.LongHelp"))}),v.show(),v.addEventListener("click",function(e){i.modalVisibility(!1,e),o&&o.dispatchEvent("otherCommand",{value:"SimilarSearch"}),s&&s.setPlaceHolderValue(m)})),v=e.extendElement(n.querySelector("#PartSupplyHeader")),e.is(v)&&e.is(d)&&!0===d&&(y.tooltip(v,{title:S,position:"bottom",reshowDelay:2.5,mouseRelativePosition:!0,longHelp:p.escapeHtml(L.get("search.PartSupplyHeader.LongHelp"))}),v.show(),v.addEventListener("click",function(e){i.modalVisibility(!1,e),o&&o.dispatchEvent("otherCommand",{value:"PartSupplyHeader"}),s&&s.setPlaceHolderValue(S)})),v=e.extendElement(n.querySelector("#DDM_SomeCommands_RelNavWbWn_Header")),e.is(v)&&e.is(u)&&!0===u&&(y.tooltip(v,{title:f,position:"bottom",reshowDelay:2.5,mouseRelativePosition:!0,longHelp:p.escapeHtml(L.get("search.DDM_SomeCommands_RelNavWbWn_Header.LongHelp"))}),v.show(),v.addEventListener("click",function(e){i.modalVisibility(!1,e),o&&o.dispatchEvent("otherCommand",{value:"RelationalExplorer"}),s&&s.setPlaceHolderValue(f)}))},_buildGuidedFromCache:function(t){let i=this,n=i.getGuidedListFromLocalStorage();if(n.length>0){let s=0;n.slice(0,10).forEach(function(n){if(e.is(n)){let o=JSON.parse(n),a=o.length;if(a){let n=[],r="";for(let t=0;t<a;t++){let s=o[t];if(e.is(s)){let e=i._buildDisplayValue(s);n.push(e),r+=e+" "}}let c=i._buildExample(t);if(e.is(c)){let t=i._buildblock(n,r);c.querySelector(".examples-text").innerHTML=t;let a=e.extendElement(c.querySelector(".examples-content"));e.is(a)&&(a.model=o,a.addEventListener("click",function(e){i._SmartQueryController&&i._SmartQueryController.addGuidedFromModel(this.model)}.bind(a))),a=e.extendElement(c.querySelector("#guidedDelete")),e.is(a)&&(y.tooltip(a,{title:p.escapeHtml(F.get("smart.mode.save.unpin")),position:"bottom",reshowDelay:2.5,mouseRelativePosition:!0,longHelp:p.escapeHtml(F.get("smart.mode.save.unpin.LongHelp"))}),a.show(),a.id=s,a.addEventListener("click",function(e){this.getParent().remove(),i.removeGuidedFromLocalStorage(parseInt(this.id))}.bind(a))),s++}}}})}},_buildDisplayValue:function(t){let i=t.displayValue;if(t&&e.is(t.data,"array")){let n=t.data.length;i=n>1?"@0 "+F.get("date.and")+" @1":"@0";let s=void 0;for(let o=0;o<n;o++){let n=new Date(t.data[o]);if(e.is(n)){let a=e.is(n.toISOString,"function")?n.toISOString().split("T")[0]:t.data[o];s=i.replace("@"+o.toString(),a),i=s}}}return i},_buildexamplesList:function(){let t=this,i=t.getGuidedListFromLocalStorage(),n=e.extendElement(t._guidedModeDiv.querySelector(".examples"));t.clearcontainer(n),i.length>0&&t._buildGuidedFromCache(n),JSON.parse(V).Examples.forEach(function(i){let s=i.title,o=t._buildExample(n);if(e.is(o)){let n=i.blocks,a=i.display,r=t._buildblock(a,s);o.querySelector(".examples-text").innerHTML=r;let c=e.extendElement(o.querySelector(".examples-content"));e.is(c)&&(c.model=n,c.addEventListener("click",function(e){t._SmartQueryController&&t._SmartQueryController.addGuidedFromModel(this.model)}.bind(c)))}})},_buildExample:function(t){if(!e.is(t))return;let i=P.replace("###NlsKey###",p.escapeHtml(F.get("smart.mode.example.add"))),n=s.create("div",{class:"example"});return n.innerHTML=i,n.inject(t),e.extendElement(n)},_buildblock:function(t,i){if(!e.is(t))return;let n,s=t.length,o=i;for(let e=0;e<s;e++){let i=t[e];n=o.replace(i,'<span class="block">'+i+"</span>"),o=n}return o},_buildSettingsHelp:function(t){let i=this;if(!e.is(t)||!e.is(i._modalBody))return;const{srcRessource:n,dropdown:s,eventManager:o,webInwin:a}=t;require(["DS/SNSearchUX/dropdown/SearchDropDownSettings","DS/SNSearchUX/dropdown/SearchDropDownPQs"],function(t,r){let c=e.extendElement(i._modalBody.querySelector("#settings-content"));i._SearchDropDownSettings=new t({eventManager:o,webInwin:a,searchDropDown:s}),i._SearchDropDownSettings.buildSettings(c),i._SearchDropDownSettings.initSettings(n),i._SearchDropDownSettings.elements.closeLink.onClick=function(){i._manageSettingsHelp({settings:!1})},c=e.extendElement(i._modalBody.querySelector("#helps-content")),i._SearchDropDownPQs=new r({eventManager:o,webInwin:a,searchDropDown:s}),i._SearchDropDownPQs.buildHelp(c),i._SearchDropDownPQs.createPredefinedQueriesComponent(),i._SearchDropDownPQs.elements.closeLink.onClick=function(){i._manageSettingsHelp({helps:!1})};let l=e.extendElement(i._modalBody.querySelector("#settings"));l&&l.addEventListener("click",function(e){e.stopPropagation(),i._manageSettingsHelp({settings:!i._settingsDisplay})}),y.tooltip(l,{title:p.escapeHtml(R.get("SearchOptions")),position:"bottom",reshowDelay:2.5,mouseRelativePosition:!0,longHelp:p.escapeHtml(R.get("SearchOptions.shortHelp"))}),(l=e.extendElement(i._modalBody.querySelector("#help")))&&l.addEventListener("click",function(e){e.stopPropagation(),i._manageSettingsHelp({helps:!i._helpsDisplay})}),y.tooltip(l,{title:p.escapeHtml(R.get("PredefinedQuery")),position:"bottom",reshowDelay:2.5,mouseRelativePosition:!0,longHelp:p.escapeHtml(R.get("PredefinedQuery.shortHelp"))})})},_backToStandard:function(t){let i=this;e.is(i._toggle)&&e.is(i._dropdown)&&(e.is(i._guidedModebtClose)&&i._guidedModebtClose>0?(i._guideModeBetaNotif&&i._guideModeBetaNotif.hide(),i._activationcontent&&i._activationcontent.show()):(i._guideModeBetaNotif&&i._guideModeBetaNotif.show(),i._activationcontent&&i._activationcontent.hide(),i._toggleBeta&&(i._toggleBeta.checkFlag=!1)),i._toggleactivation=!1,i._toggle.checkFlag=i._toggleactivation,i.modalVisibility(i._toggleactivation),setTimeout(function(){i._dropdown&&i._dropdown.onFocus()},100),!0===i._dropdown.webInwin&&i._dropdown.eventManager.dispatchEvent("onGuidedMode",i._toggleactivation),S.setItem("smartMode",i._toggleactivation),S.commit())},_manageSettingsHelp:function(t){let i=this;if(!e.is(t)||!e.is(i._modalBody))return;const{settings:n,helps:s}=t;e.is(n)&&(!0===n?(i._modalBody.removeClassName("helps"),i._modalBody.removeClassName("settings"),i._modalBody.addClassName("settings"),i._helpsDisplay=!1):i._modalBody.removeClassName("settings"),i._settingsDisplay=n),e.is(s)&&(!0===s?(i._modalBody.removeClassName("helps"),i._modalBody.removeClassName("settings"),i._modalBody.addClassName("helps"),i._settingsDisplay=!1):i._modalBody.removeClassName("helps"),i._helpsDisplay=s)},_createTaggerProxy:function(t,i){if(!e.is(i))return;if(e.is(this._taggerProxy))return this._taggerProxy;let n={enablePLM:!1,tenant:i.active_tenant,filteringMode:"FilteringOnServer",disableAutoComplete:!0,searchMoreTagsOnDemand:!0,freeInput:!1,defaultDatePicker:!0,preciseCount:!1,exclude:!0,simplified:{data_location:!0,type_categorization:!0,person_data:!0,editTagsRelationships:!0},enableGrouping:{maxLevels:1,withIconInfo:!0},contextId:"DropDownContext",widgetId:"SearchDropDown",embeddedTagger:{target:"#dropdown-search-global-embedded",rootw:{"ds6w:what":{}},multiselect:!1},events:{addGroupingChangeListener:this._OnGroupingChange.bind(this)}};return this._taggerProxy=t.createProxy(n),this._taggerProxy},_OnGroupingChange:function(t){let i=this;e.is(t,"object")&&i._resutlsContentcollection&&i._resutlsContentcollection.dispatchEvent("OnGroupingChange",t),e.is(i._taggerProxy)&&i._taggerProxy.setStatus({action:"grouping",status:!0,message:"Grouping sucessful"})},_onClickbody:function(t){let i=this;if(!1===i._modalVisibility||!0===i._inContextMode)return;let n=t,s=["modal-open","wux-","btn-root","sn-search-field","fonticon-cancel"],o=[f.getOption("command_id.add_tag"),B.get("add_tag.add_tag_header"),f.getOption("command_id.new_preview"),B.get("previewTitle"),"exportAs",B.get("exportAs")];if(n.target){let t=!0;for(let e=0;e<s.length&&!0!==(t=n.target.className.contains(s[e]));e++);if(!1===t){let a=i._modalBody&&i._modalBody.contains(n.target);if(!1===a){let i=document.body.querySelector("#search-lightbox");if(e.is(i))a=i.contains(n.target);else if(n.target.className.contains("item")){a=!1;let e=n.target.getText()&&n.target.getText().length?n.target.getText():n.target.id;for(let i=0;i<s.length;i++)if(!0===(t=e.contains(o[i]))){a=!0;break}}}!1===a&&(h.log("SearchDropDownUtils::_onClickbody and onblur"),i.modalVisibility(!1))}}},_initSkeletonMgt:function(){let e=this;return null===e._skeleton&&(e._skeleton=new b({messagingChannel:void 0,resources:e._resources,tagger_proxy:void 0,powerByOptions:void 0,in_apps_search:void 0,furtive:!1,widgetId:""}),e._skeleton.informationsAction=!1,e._modalBody.currentViewId="searchdropdown",e._modalBody.contentsViews=[],e._modalBody.contentsViews.searchdropdown=e._modalBody,e._modalBody.isMultiSelMode=function(){return!1},e._skeleton._skeleton.placeHolder=e._modalBody,e._skeleton._skeleton.getViewAt=function(t){return e._modalBody},e._skeleton._skeleton.isMultiSelMode=function(){return!1}),e._skeleton},clearcontainer:function(t){let i=this;if(e.is(t)){let e=t.getChildren();e.length>0&&e.forEach(function(e){i._clearcontainer(e),e.remove()}),t.empty()}},_clearcontainer:function(t){if(e.is(t)){let e=t.getChildren();e.length>0&&e.forEach(function(e){e.remove()}),t.empty()}},_inContextGuidedMode:function(t,i){e.is(this._SmartQueryController)&&this._SmartQueryController.setInContextMode(t,i)},_buildGuideModeBetaContent:function(t){let i=this;h.log("SearchDropDownUtils::buildGuideModeBetaContent options: ",t);const{guidedModeBetaContainer:n,dropdown:o}=t;if(e.is(i._guideModeBeta))return void(e.is(o)&&(i._toggleBeta&&(i._toggleBeta.checkFlag=!1),i._toggleBetaActivation&&(i._toggleBetaActivation.checkFlag=!1),o.switchActiveTab(o.elements.guidedModeBetaContainer,null),o.showSettingPQs()));let a=p.escapeHtml(F.get("GuidedModeBeta")),r=p.escapeHtml(F.get("efficiency")),c=p.escapeHtml(F.get("efficiency.help")),l=p.escapeHtml(F.get("powerfull")),g=p.escapeHtml(F.get("powerfull.help")),_=p.escapeHtml(F.get("holistic")),m=p.escapeHtml(F.get("holistic.help")),S=p.escapeHtml(F.get("friendly")),f=p.escapeHtml(F.get("friendly.help"));O=(O=(O=(O=(O=(O=(O=(O=(O=(O=O.replace("###GuidedModeBeta###",a)).replace("###efficiency###",r)).replace("###efficiency.help###",c)).replace("###powerfull###",l)).replace("###powerfull.help###",g)).replace("###holistic###",_)).replace("###holistic.help###",m)).replace("###friendly###",S)).replace("###friendly.help###",f)).replace("###IconToReplace###",d.getWebappsAssetUrl("SNSearchUX","images/GuidedModeBeta.png")),i._guideModeBeta=s.create("div",{class:"guideModeBeta"}),i._guideModeBeta.innerHTML=O,i._guideModeBeta.inject(n);let v=e.extendElement(i._guideModeBeta.querySelector(".wux-ui-style-lite"));v&&v.addEvent("click",function(t){if(t&&t.stopPropagation(),e.is(t)&&e.is(t.target)){let t=e.extendElement(i._guideModeBetaNotif.querySelector(".wux-ui-3ds-wrong"));t&&t.show(),i._toggleBeta&&(i._toggleBeta.checkFlag=!1),o&&o.hideSettingPQs()}}),y.tooltip(v,{title:p.escapeHtml(F.get("GuidedModeBetaClose")),position:"bottom",reshowDelay:2.5,mouseRelativePosition:!0});let C=e.extendElement(i._guideModeBeta.querySelector(".guideModeBeta-activation"));y.tooltip(C,{title:p.escapeHtml(F.get("toggleGuided.title")),position:"bottom",reshowDelay:2.5,mouseRelativePosition:!0,longHelp:p.escapeHtml(F.get("toggleGuided.LongHelp"))}),i._toggleBetaActivation=new u({type:"switch",touchMode:!0,label:F.get("guideModebetaInfo"),checkFlag:!1}),i._toggleBetaActivation.inject(C),i._toggleBetaActivation.addEventListener("buttonclick",function(n){if(e.is(n)&&e.is(n.dsModel)){let s=n.dsModel;e.is(s)&&!0===s.checkFlag&&(i._toggle.checkFlag=!0,i._activationGuidedMode(t))}}),e.is(o)&&(o.switchActiveTab(o.elements.guidedModeBetaContainer,null),o.showSettingPQs())},_buildGuideModeBetaNotif:function(t){let i=this;if(h.log("SearchDropDownUtils::buildGuideModeBetaContent options: ",t),e.is(i._guideModeBetaNotif))return void(e.is(i._guidedModebtClose)&&i._guidedModebtClose>0?(i._guideModeBetaNotif.hide(),i._activationcontent.show()):(i._guideModeBetaNotif.show(),i._activationcontent.hide()));const{container:n}=t;let o=p.escapeHtml(F.get("GuidedModeBeta")),a=p.escapeHtml(F.get("guideModebetaInfo"));U=(U=U.replace("###GuidedModeBeta###",o)).replace("###guideModebetaInfo###",a),i._guideModeBetaNotif=s.create("div",{class:"guideModeBetaNotif"}),i._guideModeBetaNotif.innerHTML=U,i._guideModeBetaNotif.inject(n);let r=e.extendElement(i._guideModeBetaNotif.querySelector(".wux-ui-3ds-wrong"));e.is(i._guidedModeBetaClose)?r&&r.show():(S.setItem("guidedModeBetaClose",1),S.commit()),y.tooltip(r,{title:p.escapeHtml(F.get("GuidedModeBetaClose")),position:"bottom",reshowDelay:2.5,mouseRelativePosition:!0}),r&&r.addEvent("click",function(e){e&&e.stopPropagation(),i._guideModeBetaNotif.hide(),i._activationcontent.show(),i._guidedModebtClose=1});let c=e.extendElement(i._guideModeBetaNotif.querySelector(".guideModeBeta-toogle"));y.tooltip(c,{title:p.escapeHtml(F.get("toggleGuided.title")),position:"bottom",reshowDelay:2.5,mouseRelativePosition:!0,longHelp:p.escapeHtml(F.get("toggleGuided.LongHelp"))}),i._toggleBeta=new u({type:"switch",touchMode:!0,label:L.get("smart.mode.activation"),checkFlag:!1}),i._toggleBeta.inject(c),i._toggleBeta.addEventListener("buttonclick",function(n){if(e.is(n)&&e.is(n.dsModel)){let s=n.dsModel;e.is(s)&&!0===s.checkFlag&&i._buildGuideModeBetaContent(t)}})},getQueryStringFromLNP:function(t){h.log("SearchDropDownUtils:getQueryStringFromLNP");const{queryinput:i}=t;return new o(function(t,n){e.is(i)&&0!==i.length||n()})}});return H}),define("DS/SNSearchUX/helpers/SmartQueryUtils",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","UWA/Element","UWA/Promise","DS/WebappsUtils/WebappsUtils","DS/PubSub/PubSub","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/utils/SNCompassUtils","DS/SNInfraUX/SNSuggestionHelper","DS/SNSearchUX/dropdown/SearchDropDownUtils","i18n!DS/SNSearchUX/assets/nls/GuidedMode.json","text!DS/SNSearchUX/assets/templates/GuidedMode/suggestionTab.html"],function(e,t,i,n,s,o,a,r,c,l,d,u,h,p,g){"use strict";var _=t.singleton(n,i,{name:"DS_SmartQueryUtils",_controller:null,_maxDiplay:10,_Appssuggestions:null,_appsPromise:null,_dropdownFull:!1,_maxSuggests:5,init:function(){this._controller=null,this._appsPromise=null,this._maxDiplay=10,this._Appssuggestions=[],this._dropdownFull=!1,this._maxSuggests=5,this.sections=["commTag","user","optr","type","intf","tags","clat","keys","tagv"]},clean:function(){this._Appssuggestions=[],this.hidesuggestionTab({controller:this._controller})},setMaxToDisplay:function(t){let i=this;c.log("SmartQueryUtils::setMaxToDisplay value: ",t),e.is(t)?i._maxDiplay=t:i._maxDiplay=10},setController:function(e){c.log("SmartQueryUtils::setController"),this._controller=e},setdropdownFull:function(e){c.log("SmartQueryUtils::setdropdownFull"),this._dropdownFull=e},clearcontainer:function(e){h.clearcontainer(e)},_clearcontainer:function(e){h._clearcontainer(e)},_buildMoreLess:function(t){let i=this;if(!e.is(t))return;const{showall:n,container:o,containerTitle:a,sectioncontent:r}=t;if(e.is(n)&&!1===n){let e=s.create("div",{class:"show-more-container"});e.inject(r),e.innerHTML="...",e.title=l.escapeHtml(p.get("showAll")),e.addEventListener("click",function(e){e.stopPropagation(),t.showall=!t.showall,t.mouseupCB.call(i,t)})}a.addEventListener("click",function(e){e.stopPropagation(),t.showall=!t.showall,t.mouseupCB.call(i,t)})},_buildWhosuggestions:function(t){c.log("SmartQueryUtils::_buildWhosuggestions");const{suggestions:i,controller:n,container:s}=t;let o=i.length,a=0,r=e.extendElement(s);for(;a<o;a++){let t=i[a];if(e.is(t)){let i=t.imageUrlPromise;e.is(i)&&i.then(function(i){let n=e.clone(t.displayValue).replace(/ /g,""),s=r&&r.querySelector("#"+n);s&&(s.src=i)})}}return o},displaySections:function(t){let i=this;const{dropdown:n,value:s,controller:o,historyOnly:a,container:r}=t;h.showhidehistoryContainer(!0),i._createAllSectionHeaders(t);let c={dropdown:n,value:s,controller:o,showall:!1,suggestions:o._listOfFreesuggestions,container:o._freeContainer,font:"fonticon-expand-right",classname:"section-content-free",nls:"smart.mode.section.free",maincontainer:r};if(i._buildServerSuggestions(c),!0===o.getmainLayoutSimplified()&&!e.is(a))for(let e=0;e<i.sections.length;e++)c={dropdown:n,value:s,controller:o,showall:!1,suggestions:o["_"+i.sections[e]+"List"],container:o["_"+i.sections[e]+"Container"],font:"fonticon-expand-right",nls:"smart.mode.section."+i.sections[e],classname:"section-content-"+i.sections[e],maincontainer:r},i._populateSectionSuggestions(c);!0===i._dropdownFull?0===o._smartQuery.length()&&i._buildHistory(t):(c={dropdown:n,value:s,controller:o,showall:!1,suggestions:o._listOfAppssuggestions,container:o._appsContainer,font:"fonticon-expand-right",classname:"section-content-Apps",nls:"smart.mode.section.App",maincontainer:r},i._populateSectionSuggestions(c)),r.scroll({top:0,behavior:"smooth"})},buildCategories:function(t){if(!e.is(t))return;let i=this;const{controller:n,suggestions:s,value:o=""}=t;n._listOfFreesuggestions=[],n._listOfAppssuggestions=[];for(let e=0;e<i.sections.length;e++)n["_"+i.sections[e]+"List"]=[];n.getmainLayoutSimplified();let a=!1,r=s.length,l={displayValue:o,type:"USER_TEXT",uri:"",iconClass:"fonticon-pencil",value:o};if(n._listOfFreesuggestions.push(l),r){let t=0;for(;t<r;t++){let i=s[t];if(e.is(i)){let e=i.type;switch("PREDICATE"===e&&i.isClassAttribute&&(e="CLASS_ATTR"),e){case"TYPE":case"TYPE_GROUP":n._typeList.push(i);break;case"INTERFACE":n._intfList.push(i);break;case"L_OPERATOR":case"R_OPERATOR":case"U_OPERATOR":case"CLOSE_PARENT":case"OPEN_PARENT":n._optrList.push(i);break;case"PREDICATE":n._tagsList.push(i);break;case"CLASS_ATTR":n._clatList.push(i);break;case"PREDICATE_VALUE":case"VALUE_KEYWORD":n._tagvList.push(i);break;case"COMPANY_TAG":case"COMMUNITY_TAG":case"USER_TAG":n._commTagList.push(i);break;case"KEYWORD":case"KEY_KEYWORD":n._keysList.push(i);break;case"USER_TEXT":n._userList.push(i);break;default:console.log("Error")}}}i._computeRankingList(s,n._listOfFreesuggestions)}else e.is(o)&&o.length>0&&(a=!0);if((3===i._maxDiplay||o.length>0)&&(a=!0),!0===a&&0===n._smartQuery.length()&&!1===i._dropdownFull){let e={query:o,oncomplete:function(e){n._listOfAppssuggestions=e;let t={dropdown:n._dropdown,value:o,controller:n,showall:!1,suggestions:n._listOfAppssuggestions,container:n._appsContainer,font:"fonticon-expand-right",classname:"section-content-Apps",nls:"smart.mode.section.App"};n._appsContainer=i._populateSectionSuggestions(t)}};i.getApps(e)}c.groupCollapsed("******** SmartQueryUtils::buildCategories ********"),c.log("SmartQueryUtils::buildCategories: list Of suggestions: ",s),c.log("SmartQueryUtils::buildCategories: list Of Search suggestions = ",n._listOfFreesuggestions);for(let e=0;e<i.sections.length;e++)c.log("SmartQueryUtils::buildCategories: list Of "+i.sections[e]+" suggestions = ",n["_"+i.sections[e]+"List"]);c.log("SmartQueryUtils::buildCategories: list Of Apps suggestions = ",n._listOfAppssuggestions),c.groupEnd("******** SmartQueryUtils::buildCategories ********")},_createAllSectionHeaders:function(t){if(!e.is(t))return;let i=this;const{dropdown:n,value:s,controller:o,container:a}=t;i.clearcontainer(a),o._appsContainer=null,o._freeContainer=null,o._histories=null;for(let e=0;e<i.sections.length;e++)o["_"+i.sections[e]+"Container"]=null;o._freeContainer=i._createSectionHeaders({container:o._freeContainer,classname:"section-content-free",maincontainer:a}),o._histories=i._createSectionHeaders({container:o._histories,classname:"section-content-history",maincontainer:a});for(let e=0;e<i.sections.length;e++)o["_"+i.sections[e]+"Container"]=i._createSectionHeaders({container:o["_"+i.sections[e]+"Container"],classname:"section-content-"+i.sections[e],maincontainer:a});!1===i._dropdownFull&&(o._appsContainer=i._createSectionHeaders({container:o._appsContainer,classname:"section-content-Apps",maincontainer:a}))},_createSectionHeaders:function(t){if(!e.is(t))return;let i=this;const{container:n,maincontainer:o,classname:a=""}=t;c.log("SmartQueryUtils::_createSectionHeaders Section: ",a);let r=n;return e.is(r)?i._clearcontainer(r):r=s.create("div",{class:a}).inject(o),r.hide(),r},_populateSectionSuggestions:function(t){if(!e.is(t))return;const{suggestions:i,dropdown:n,value:o,controller:r,container:d,maincontainer:u,showall:h,font:g="",nls:_="",classname:m=""}=t;c.log("SmartQueryUtils::_populateSectionSuggestions Section: ",m);let S=0;e.is(i)&&(S=i.length);let f=[],v=this;if(0===S||!e.is(d))return;let C=d;e.is(C)&&v._clearcontainer(C),C.show();let y=void 0,w=s.create("div",{class:"section-title"}).inject(C);if(g.length){(y=s.create("div",{class:"item-circle"}).inject(w)).hide();let e=g;!0===h&&(e=g.replace("right","down")),s.create("span",{class:"fonticon "+e}).inject(y)}w&&s.create("div",{class:"section-title-text",text:l.escapeHtml(p.get(_))+(/section\-content\-(commTag|user|type|intf|tags|clat|tagv)/.test(m)?"   [ "+S+" ]":"")}).inject(w);let b=s.create("div",{class:"section-content"}).inject(C),D=S;!1===h&&S>v._maxDiplay&&(D=v._maxDiplay,/section\-content\-(commTag|user|optr|type|intf|tags|clat|keys|tagv|history)/.test(m)&&(D=4));let E={controller:r,suggestions:i,container:C};v._buildWhosuggestions(E);for(let t=0;t<D;t++){let n=i[t];e.is(n)&&f.push({text:n.displayValue,imageUrl:n.imageUrl,iconClass:n.iconClass,imageUrlPromise:n.imageUrlPromise,highLight:n.highLight,type:e.is(n.type)?n.type:void 0})}f.map(t=>t.mouseupCB=((t,i)=>{c.log("SmartQueryUtils::_populateSectionSuggestions select value: ",t),e.is(i)&&"USER_TEXT"===i?r._buildUserFreeText(t,i):(v.setMaxToDisplay(),r._pressEnter=!0,r._buildChipAndSuggestion(t,i))}).bind(n));let I=a.getWebappsBaseUrl()+"TagNavigator/assets/icons/generic_user.png";f.forEach(function(t){let i=s.create("div",{class:"suggestion-content",title:t.text}).inject(b);if(i.type=t.type,i.addEvent("click",function(i){if(e.is(t.mouseupCB))return t.mouseupCB.call(this,i.currentTarget&&i.currentTarget.getText(),t.type),i}.bind(n)),e.is(t.imageUrlPromise)){let e=s.create("span",{class:"suggestion-image"}).inject(i);s.create("img",{src:I,class:"image",width:"17px",height:"auto",id:t.text.replace(/ /g,"")}).inject(e)}else if(e.is(t.imageUrl)){let e=s.create("span",{class:"suggestion-image"}).inject(i);s.create("img",{src:t.imageUrl,class:"image",width:"17px",height:"auto"}).inject(e)}else if(e.is(t.iconClass)){s.create("span",{class:"fonticon "+t.iconClass+" suggestion-icon"}).inject(i)}let o=s.create("div",{class:"suggestion-text"}).inject(i),a=v._createspan({value:t.highLight,valuetrue:t.text});o.innerHTML=a||t.text}),S>v._maxDiplay&&(y&&y.show(),t.container=C,t.containerTitle=w,t.sectioncontent=b,t.mouseupCB=v._populateSectionSuggestions,v._buildMoreLess(t))},_populateHistorySection:function(t){if(!e.is(t))return;const{suggestions:i,dropdown:n,value:o,controller:a,container:d,maincontainer:u,showall:g,font:_="",classname:m="",nls:S="",history:f=!0}=t;let v=0;e.is(i)&&(v=i.length);let C=[],y=this,w=d;if(e.is(w)?y._clearcontainer(w):w=s.create("div",{class:m}).inject(u),w.show(),0===v)return w.hide(),w;let b=l.escapeHtml(p.get(S)),D=l.escapeHtml(p.get("search.history.clear")),E=s.create("div",{class:"section-title"}).inject(w);if(!0===f){let e=s.create("div",{class:"item-circle"}).inject(E);s.create("span",{class:"fonticon fonticon-trash",title:D+" "+b}).inject(e);e&&e.addEvent("click",function(e){e.stopPropagation(),n.displayClearHistoryModal(e),n.noBlur=!0})}E&&s.create("div",{class:"section-title-text",text:b}).inject(E);let I=s.create("div",{class:"section-content"}).inject(w),T=v;for(let t=0;t<T;t++){let n=i[t];e.is(n)&&C.push({text:n.displayValue,iconClass:n.iconClass,highLight:n.highLight,action:n.action,type:e.is(n.type)?n.type:"history",model:e.is(n.model)?n.model:void 0,id:e.is(n.id)?n.id:void 0})}return C.map(e=>e.mouseupCB=((e,t,i)=>{if(c.log("SmartQueryUtils::_populateHistorySection select value: ",e),0===a._smartQuery.length()){n.onBlur(),h.modalVisibility(!1);let t=e;n.setFieldValue(t),r.dispatch("onViewSearch"),!0===n.webInwin&&n.eventManager&&n.eventManager.dispatchEvent("onViewSearch",{displayString:t,query:t}),a._pressEnter=!0}else a._buildUserFreeText(e)})),C.forEach(function(t){let i=s.create("div",{class:"suggestion-content",title:t.text,id:e.is(t.id)?t.id:void 0}).inject(I);if(i.type=t.type,i.addEvent("click",function(i){if(e.is(t.mouseupCB))return t.mouseupCB.call(n,i.currentTarget&&i.currentTarget.getText(),t.type,t.model),i}),e.is(t.iconClass)){s.create("span",{class:"fonticon "+t.iconClass+" suggestion-icon"}).inject(i)}let o=s.create("div",{class:"suggestion-text"}).inject(i),a=y._createspan({value:t.highLight,valuetrue:t.text});if(o.innerHTML=a||t.text,e.is(t.action)){s.create("span",{class:"search-history-delete fonticon fonticon-close",title:D+" '"+t.text+"'"}).inject(i).addEvent("click",function(e){setTimeout(function(){y._controller&&y._controller.focusEditor()},150),h.removeHistoryElement(e.currentTarget),e.stopPropagation()})}}),w},_createspan:function(t){if(!e.is(t))return;const{value:i,valuetrue:n}=t;if(!e.is(i)||0===i.length)return;let s=e.clone(i),o=s=(s=s.replace(/  +/g," ").trim()).toLowerCase();s=o.replace(/[!"#$%&'()*+,-./:;<=>?@[\]^_`{|}~]/g,"");let a=[...o.matchAll(/[^A-Za-z0-9 ]/g)],r=o;a.forEach((e,t)=>{let i=e.index;r=r.slice(0,i+t)+"\\"+r.slice(i+t)});let c=new RegExp(r,"i"),l=n.match(c),d=n;if(e.is(l))for(let e=0;e<l.length;e++){let t=l[e];t.length&&(d=n.replace(t,'<span class="highlightedSearchCriteria">'+t+"</span>"))}let u='<span title="">';return u+='<span class="searchItemSpan">',u+=d,u+="</span>",u+="</span>"},populateAppsSection:function(t){if(!e.is(t))return;const{suggestions:i,dropdown:n,value:o,controller:a,container:r,maincontainer:d,showall:u,classname:h="",nls:g="",font:_=""}=t;let m=0;if(e.is(i)&&(m=i.length),0===m)return;let S=[],f=this,v=r;e.is(v)?f._clearcontainer(v):v=s.create("div",{class:h}).inject(d);let C=s.create("div",{class:"section-title"}).inject(v),y=s.create("div",{class:"item-circle"}).inject(C);s.create("span",{class:"fonticon "+_}).inject(y);s.create("div",{class:"section-title-text",text:l.escapeHtml(p.get(g))}).inject(C);let w=s.create("div",{class:"section-content"}).inject(v),b=m;!1===u&&m>f._maxDiplay&&(b=f._maxDiplay);for(let t=0;t<b;t++){let n=i[t];e.is(n)&&S.push({text:n.displayValue,imageUrl:e.is(n.imageUrl)?n.imageUrl:void 0})}return S.map(e=>e.mouseupCB=(e=>{c.log("SmartQueryUtils::populateAppsSection select value: ",e),f.setMaxToDisplay(),a._pressEnter=!0,a._buildChipAndSuggestion(e)}).bind(n)),S.forEach(function(t){let i=s.create("div",{class:"app-item",title:t.text}).inject(w);i.addEvent("mouseup",function(i){if(e.is(t.mouseupCB))return t.mouseupCB.call(this,i.currentTarget&&i.currentTarget.getText()),i}.bind(n));s.create("div",{class:"img-unselect",styles:{"background-image":"url("+t.imageUrl+")"}}).inject(i);s.create("div",{class:"item-view-content-wrapper",text:t.text}).inject(i)}),v},_getAppsFromCompassPromise:function(){let t=this;return t._appsPromise||(t._appsPromise=new o(function(i,n){d.getApplicationsFromCompass("",1e3).then(function(s){e.is(s)&&e.is(s.count)&&e.is(s.data)?(s.data.forEach(function(e){t._Appssuggestions.push({displayValue:e.title,type:"USER_TEXT",uri:"",value:e.title,imageUrl:e.icon,appInfos:e})}),i(t._Appssuggestions)):n()})})),t._appsPromise},getApps:function(t){let i=this;if(!e.is(t))return;let n=t.query;i._getAppsFromCompassPromise().then(function(){let s=new RegExp("^"+e.String.escapeRegExp(n),"i");if(e.is(t.oncomplete)){let e=i._Appssuggestions.filter(function(e){return e=e.displayValue,s.test(e)});t.oncomplete.call(i,e)}})},launchApp:function(t){if(!e.is(t))return;const{appInfos:i,dropdown:n}=t;e.is(i)&&e.is(n)&&n._onClickApp({currentTarget:{id:i.id}})},buildTweaker:function(t){let i=this;if(!e.is(t))return;c.log("SmartQueryUtils::buildTweaker Enter ");const{suggestion:n,container:o,datevalue:a,controller:r,chip:l,buildTweaker:d,onUpdateData:u}=t;let h,g,_,m=n.type,S=(n.value,n.dataTypes),f=n.uri,v=(r._smartQuery.getAt(r._smartQuery.length()-1),!1),C=void 0,y=void 0;if("PREDICATE_VALUE"===m){let t=S;c.log("SmartQueryUtils::buildTweaker : ",S),"date"===t?(v=!0,h="DS/Tweakers/TweakerDate",e.is(n.data,"array")&&n.data.length?(g=new Date(n.data[0]),n.data.length>1&&(_=new Date(n.data[1]))):(g=new Date(Date.now()-864e5),_=new Date(Date.now()+1728e5)),c.log("SmartQueryUtils::buildTweaker Tweaker Type: ",h)):"double"!==t&&"integer"!==t||(C="number",y=.1,g=0,_=0,"integer"===t&&(C="integer",y=1,g=0,_=0),e.is(n.data,"array")&&n.data.length&&(g="integer"===t?parseInt(n.data[0]):parseFloat(n.data[0]),n.data.length>1&&("integer"===t?_=parseInt(n.data[1]):parseFloat(n.data[1]))),c.log("SmartQueryUtils::buildTweaker Number: ",t),h="DS/Tweakers/TweakerNumber",v=!0),e.is(a,"array")&&a.length&&(c.log("SmartQueryUtils::buildTweaker old date "),"custPredVal:range"===f?(c.log("SmartQueryUtils::buildTweaker REBUILD"),e.is(n.data)&&(n.data=[])):(c.log("SmartQueryUtils::buildTweaker EDITBUILD"),2===a.length&&a.pop(),n.data=a,n.data[0].getContent().inject(o),v=!1,u.call(r,n.data))),!0===v?require([h],function(e){if(c.log("SmartQueryUtils::buildTweaker create new date "),"custPredVal:range"===f){o.querySelector(".wux-chip-cell-label").hide();let t=new e({value:g,disabled:!1,units:void 0,touchMode:!1,valueType:C,stepValue:y});t.inject(o);s.create("li",{class:"wux-chip-cell-label date",text:p.get("date.and")}).inject(o);let a=new e({value:_,disabled:!1,units:void 0,touchMode:!1,valueType:C,stepValue:y});a.inject(o),t.addEventListener("change",function(e){a.disabled=!1,a.elements.internalView.elements.calendarButton&&a.elements.internalView.elements.calendarButton.getContent().click()}.bind(o)),a.addEventListener("change",function(e){let t={chip:this,readOnly:!0};i.manageTweaker(t),r.refreshTweakerToReadonly(t),r.buildQuerySearch()}.bind(l)),setTimeout(function(){t.elements.internalView.elements.calendarButton&&t.elements.internalView.elements.calendarButton.getContent().click(),t.elements.internalView.elements.inputField&&t.elements.internalView.elements.inputField.select()},100),n.data=[t.value,a.value],l.data=[t,a],u.call(r,n.data)}else{let t=new e({value:g,disabled:!1,units:void 0,touchMode:!1,valueType:C,stepValue:y});o.querySelector(".wux-chip-cell-label").hide(),t.inject(o),t.elements.internalView.elements.calendarButton.getContent().click(),n.data=[t.value],l.data=[t],u.call(r,n.data),t.addEventListener("change",function(e){let t={chip:l,readOnly:!0};n&&(n.data=[this.value]),i.manageTweaker(t),r.refreshTweakerToReadonly(t),r.buildQuerySearch()}.bind(t))}}):u.call(r)}else u.call(r);c.log("SmartQueryUtils::buildTweaker END ")},manageTweaker:function(t){if(!e.is(t))return;const{chip:i,readOnly:n}=t;let s=e.is(i.data)?i.data:void 0;if(e.is(s,"array")){let t,o=s.length;t=o>1?"@0 "+p.get("date.and")+" @1":"@0";let a=void 0,r=!1;for(let i=0;i<o;i++){let o=s[i];if(e.is(o))if(n&&!0===n){let n=e.is(o.value)&&e.is(o.value.toISOString,"function")?o.value.toISOString().split("T")[0]:o.value;a=t.replace("@"+i.toString(),n),t=a,r=!0,o.hide()}else o.show()}if(r){let t=e.is(i.associatedChipCellView)?i.associatedChipCellView.querySelector(".date"):void 0,n=e.is(i.associatedChipCellView)?i.associatedChipCellView.querySelector(".wux-chip-cell-label"):i.labelUx;n.innerHTML=a,n&&n.show(),t&&t.hide()}else{let t=e.is(i.associatedChipCellView)?i.associatedChipCellView.querySelector(".wux-chip-cell-label"):i.labelUx,n=e.is(i.associatedChipCellView)?i.associatedChipCellView.querySelector(".wux-controls-lineeditor"):i.lineEditor,s=e.is(i.associatedChipCellView)?i.associatedChipCellView.querySelector(".date"):void 0;n&&n.hide(),t&&t.hide(),s&&s.show()}}},buildChipsFromsmartQuery:function(t){let i=this;if(!e.is(t))return;c.log("SmartQueryUtils::buildChipsFromsmartQuery Enter ");const{chipsEditor:n,smartQuery:s,model:o,controller:a,buildTweaker:r}=t;n&&n._selectionChips.removeAllChips();let l=void 0;if(e.is(o)){let e=o.length;for(let t=0;t<e;t++){let e=o[t];l=i.buildChipFromModel({chipsEditor:n,object:e,controller:a},t),s.push(e)}}else{let t=s.length();for(let o=0;o<t;o++){let t=s.getAt(o);e.is(t.suggestion)||i._buildcompleteSuggestion(t),l=i.buildChipFromModel({chipsEditor:n,object:t.suggestion,controller:a,buildTweaker:r},o)}}return l},buildChipFromModel:function(t,i){let n=this;if(!e.is(t))return;c.log("SmartQueryUtils::buildChipFromModel Enter ");const{chipsEditor:s,object:o,controller:a,buildTweaker:r}=t;let l=_.buildChipData({suggestion:o}),d=s&&s._selectionChips.addChip({label:l.label,icon:l.icon,index:i,suggestion:o});if(e.is(d)&&e.is(d.associatedChipCellView)){d.associatedChipCellView.setAttribute("draggable","false"),d.associatedChipCellView.addClassName("search-"+l.type),e.is(l.predicate)&&!0===l.predicate&&d.associatedChipCellView.addClassName("predicate");let t={index:i,smartQuery:a._smartQuery};if(!0===_.ifCapsule(t)&&d.associatedChipCellView.addClassName("capsule"),e.is(r)&&!0===r){let t=void 0;e.is(a._selectedChip)&&e.is(a._selectedChip.suggestion.data)&&(t=a._selectedChip.suggestion.data);let i={suggestion:o,container:d.associatedChipCellView,datevalue:t,controller:a,chip:d,buildTweakerbool:r,onUpdateData:function(t){e.is(t)?o.data=t:a._addAfterEditor(a._lastPosIndexInEditor)}};n.buildTweaker(i)}d.associatedChipCellView.addEvent("click",a._onclickChange.bind(a))}return d},_buildcompleteSuggestion:function(t){if(!e.is(t))return;c.log("SmartQueryUtils::_buildcompleteSuggestion Enter ");let i=t.type,n={};"OPEN_PARENT"===i?(n.category="OPERATOR",n.displayValue=t.displayValue,n.type=t.type,n.uri="(",n.value=t.value):"CLOSE_PARENT"===i?(n.category="OPERATOR",n.displayValue=t.displayValue,n.type=t.type,n.uri=")",n.value=t.value):"USER_TEXT"===i&&(n.displayValue=t.displayValue,n.type=t.type,n.value=t.value),t.suggestion=n},_buildDateTweakerQuery:function(t){if(!e.is(t))return;c.log("SmartQueryUtils::_buildDateTweakerQuery START");const{smartQuery:i=i}=t;let n=i.length();i.getAt(n-1);for(let t=0;t<n;t++){let n=i.getAt(t),s=(n.type,n.value,n.dataTypes);if("PREDICATE_VALUE"===n.type&&e.is(s)){let t=n.suggestion.data;if(e.is(t,"array")){n.data=n.suggestion.data;let i=t[0],s={},o=void 0;if(2===t.length){o=t[1]}e.is(i)&&(s.from=e.is(i.toISOString,"function")?i.toISOString().split("T")[0]:i,s.to=e.is(i.toISOString,"function")?i.toISOString().split("T")[0]:i),e.is(o)&&(s.to=e.is(i.toISOString,"function")?o.toISOString().split("T")[0]:o),c.log("SmartQueryUtils::_buildDateTweakerQuery query: ",s),n.value=s}}}c.log("SmartQueryUtils::_buildDateTweakerQuery END")},buildQuerySearch:function(t){if(!e.is(t))return;const{smartQuery:i}=t;this._buildDateTweakerQuery(t);let n=i.buildQueryString();return c.group("******** SmartQueryUtils::buildQuerySearch ********"),c.log("QueryString: ",n),c.groupEnd("******** SmartQueryUtils::buildQuerySearch ********"),n},buildChipData:function(t){if(!e.is(t))return;let i=void 0,n=void 0,s=t.suggestion.type.toLowerCase(),o=t.suggestion.category,a=(t.suggestion.uri,t.suggestion.iconClass),r=!1;return e.is(s)&&(i=t.suggestion.displayValue,n={iconName:"",fontIconFamily:WUXManagedFontIcons.Font3DS},"user_text"===s?-1!==i.indexOf("(")||-1!==i.indexOf(")")?s="user_text parenthesis":e.is(t.suggestion.appInfos)?s="user_text app":n.iconName="pencil":"keyword"===s?-1===i.indexOf("(")&&-1===i.indexOf(")")||(s="keyword parenthesis"):"predicate"===s&&(r=!0),"ds6w:who"===o?!0===r&&(n.iconName="6w-who",s="type"):"ds6w:what"===o?(n.iconName="6w-what",s="type"):"ds6w:when"===o?"value_keyword"===s?n.iconName=void 0:(n.iconName="6w-when",s="type"):"ds6w:where"===o?(n.iconName="6w-where",s="type"):"ds6w:how"===o?n.iconName="6w-how":e.is(a)&&"pencil"!==n.iconName?n.iconName=a.replace("fonticon-",""):("OPERATOR"===o||s.contains("predicate"))&&(n.iconName=void 0)),{type:s,label:i,icon:n,predicate:r}},foundCloseparenthesis:function(t,i){let n=[],s=e.is(this._controller._SelectionChipsEditor)&&this._controller._SelectionChipsEditor._selectionChips._items,o=s.length;for(let e=0;e<o;e++){let t=s[e],i=t.chipOptions.label;"("!==i&&")"!==i||n.push({label:i,chip:t}),t&&t.associatedChipCellView&&t.associatedChipCellView.removeClassName("parenthesis_bracket")}let a=n.length;n.join("");if(a){let i=[],o=0;for(o=0;o<a;o++)i.push(n[o].label);let c=i.join(""),l=void 0,d=void 0,u=void 0;function r(e,t){let i=[];for(let n=t;n>=0;n--)if(")"==e[n])i.push(e[n]);else if("("==e[n]&&(i.pop(),0==i.length))return n}if(e.is(t,"number")){l=s[t];let i=0;for(o=0;o<a;o++){if(n[o].chip.chipOptions.index===t){i=o;break}}if(e.is(l)&&e.is(l.chipOptions)){let e=l.chipOptions.label;if(")"===e)u=r(c,i);else if("("===e){u=function(e,t){let i=[];for(let n=t;n<e.length;n++)if("("==e[n])i.push(e[n]);else if(")"==e[n]&&(i.pop(),0==i.length))return n}(c,i)}}}else e.is(t,"object")&&e.is(t.chipOptions)&&")"===t.chipOptions.label&&(l=t,u=r(c,c.length-1));e.is(u)&&u<a&&(d=n[u].chip,l&&l.associatedChipCellView.addClassName("parenthesis_bracket"),d&&d.associatedChipCellView.addClassName("parenthesis_bracket"))}if(e.is(i,"boolean"))return a%2==0},_buildServerSuggestions:function(t){let i=this;const{dropdown:n,value:s,controller:o,container:a,suggestions:r}=t;let c=n._srcRessource;if(e.is(c)&&e.is(s,"string")&&s.length){let n=u.getEnterpriseConceptsSuggestions(s),a=u.getIcon(),l=!0,d=function(){i._populateSectionSuggestions(t),setTimeout(function(){h.getController()._mouveOnElement(s)},100)};l=c.getSuggestions({query:s},function(e){Promise.all([n,a]).then(function([t,n]){let a=u._prioritizeSuggestions(e,t,!0);a.length>0&&(a=a.filter(function(e){return!(e.entry.toLowerCase()===s.toLowerCase())})).slice(0,i._maxSuggests).forEach(function(e){n||(n="fonticon fonticon-lightbulb");let t={displayValue:e.entry,iconClass:n,highLight:e.highLight,type:"USER_TEXT"};r.push(t),o._listOfsuggestions.push(t)}),d()})}),e.is(l)&&!1===l&&d()}},_buildHistory:function(t){let i=this;if(!e.is(t))return;const{controller:n}=t;if(n._historyList=[],h.getHistoryListFromLocalStorage().length>0&&h.getHistoryListFromLocalStorage().slice(0,50).forEach(function(i){let s=!0,o=t.value;e.is(o)&&(s=!1,i.indexOf(o)>=0&&(s=!0)),!0===s&&n._historyList.push({displayValue:i,highLight:o,iconClass:"fonticon-clock",action:"clear",type:"history"})}),n._historyList.length){let e={dropdown:t.dropdown,value:t.value,controller:n,showall:!1,suggestions:n._historyList,container:t.controller._histories,font:"fonticon-clock",classname:"section-content-history",nls:"smart.mode.section.history",maincontainer:t.container};return t.controller._histories.show(),i._populateHistorySection(e)}},_removeObjectArray:function(e,t){let i=e.length,n=0,s=t;for(;n<i;n++){let t=e[n];s=s.filter(function(e){return e.type!==t.type&&e.displayValue!==t.displayValue})}return s},_computeRankingList:function(t,i){let n=t.length,s=0;for(n>=5&&(n=5);s<n;s++){let n=t[s];e.is(n)&&i.splice(s,0,n)}},ifCapsule:function(t){let i=!1;if(!e.is(t))return i;c.log("SmartQueryUtils::ifCapsule Enter ");const{index:n,smartQuery:s}=t;let o=s.length();if(o>0&&n<=o){let t=s.getAt(n-1);if(e.is(t)){let e=t.type;"PREDICATE"!==e&&"R_OPERATOR"!==e||(i=!0)}}return i},addsuggestionTab:function(t){if(!e.is(t))return!1;c.log("SmartQueryUtils::addsuggestionTab Enter ");const{controller:i,container:n}=t;if(!e.is(i._suggestionTab)){g=g.replace("###Tab###",l.escapeHtml(p.get("Tabulation"))),i._suggestionTab=s.create("div",{class:"autosuggest"}),i._suggestionTab.innerHTML=g,i._suggestionTab.inject(n);let t=e.extendElement(i._suggestionTab.querySelector(".guided-tab"));t&&t.addEventListener("click",function(e){let t=(i._containersuggestion?i._containersuggestion:i._dropdown.elements.customSuggestions).querySelector(".hover");t&&(i._pressEnter=!0,i._createFromInput(t.title,t.type),i._lastvalue="")})}},hidesuggestionTab:function(t){if(!e.is(t))return!1;c.log("SmartQueryUtils::hidesuggestionTab Enter ");const{controller:i}=t;i&&i._suggestionTab&&i._suggestionTab.hide()},completesuggestionTab:function(t){let i=this;if(!e.is(t)||!e.is(t.value)||0===t.value.length)return!1;c.log("SmartQueryUtils::completesuggestionTab Enter options: ",t);const{controller:n,value:s,highLight:o}=t;if(e.is(n._suggestionTab)){let t=e.extendElement(n._suggestionTab.querySelector(".guided-suggest-text"));if(e.is(t)){o&&s&&0==o.toLowerCase().indexOf(s.toLowerCase())?t.innerText=o.substring(s.length):t.innerText=o?" >>>    "+o:"";let e=t.getStyle("overflow"),a=n._suggestionTab.getStyle("font"),r=i._getTextWidth(s,a)+14+2;if(e&&"hidden"===e){let e=parseInt(t.getStyle("max-width"));t.setStyle("width",e-r+16+"px")}n._suggestionTab.setStyle("left",r+"px"),n._suggestionTab.show()}}},_getTextWidth:function(e,t){let i=(this.canvas||(this.canvas=document.createElement("canvas"))).getContext("2d");return i.font=t,i.measureText(e).width}});return _}),define("DS/SNSearchUX/helpers/SmartspeechUtils",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","UWA/Promise","DS/SNInfraUX/Logger"],function(e,t,i,n,s,o){"use strict";return t.singleton(n,i,{name:"DS_SmartspeechUtils",_SpeechRecognition:null,_SpeechGrammarList:null,init:function(){this._SpeechRecognition=null},build:function(t,i,n,s){let o=this;if(null===o._SpeechRecognition){o._SpeechRecognition=new webkitSpeechRecognition,o._SpeechGrammarList=new webkitSpeechGrammarList;let a="en-US";navigator&&navigator.languages&&e.is(navigator.languages,"array")&&navigator.languages.length>0&&(a=navigator.languages[0]),o._SpeechRecognition.lang=a,o._SpeechRecognition.onerror=s,o._SpeechRecognition.onnomatch=n,o._SpeechRecognition.onresult=t,o._SpeechRecognition.onspeechend=i}},start:function(){let t=this;e.is(t._SpeechRecognition)&&t._SpeechRecognition.start()},stop:function(){let t=this;e.is(t._SpeechRecognition)&&t._SpeechRecognition.stop()},getspeechRecognition:function(){return this._SpeechRecognition}})}),define("DS/SNSearchUX/dropdown/categoryContentView",["DS/SNResultUX/views/helpers/utils/AbstractMultiView","UWA/Core","DS/SNInfraUX/Logger","DS/TreeModel/TreeDocument","DS/Utilities/Utils","DS/SNInfraUX/SearchUtils","DS/SNResultUX/views/helpers/utils/SearchMultiViewUtils","DS/SNInfraUX/SearchSettings","DS/SNSearchUX/SuggestionUXHelper"],function(e,t,i,n,s,o,a,r,c){"use strict";return e.extend({_lastQuery:"",_initCollectionListener:function(e){let t=this;this.listenTo(this.collection,{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){},onSync:function(){},onSetTags:function(e){},OnGroupingChange:function(e){i.log("categoryContentView OnGroupingChange Event",e),t._viewAllProvide=!1,t._refreshViewFromOnGrouping(e)}})},_loadViews:function(e,r){let c=this;require(["DS/SNResultUX/views/WebUX/CollectionView/ResponsiveTilesCollectionView"],function(l){let d=c.getOptionCommon();d.height="inherit";o.getDictionnaryEntry("useDnDForAllSearchViews");d.useDragAndDrop=!(!t.is(r)||!t.is(r.useDragAndDrop))&&r.useDragAndDrop,d.displayedOptionalCellProperties=["contextualMenu","description"];let u=c.multiViewContainer&&c.multiViewContainer.getDimensions(),h=u&&u.height,p=0,g=c.collections.length;for(let o=e;o<g;o++){let e=c.collections[o];try{if(!t.is(e,"object")||0===e.totalCount&&(!t.is(r)||!t.is(r.forceToDisplaySection))){c.views[o]=null,p++;continue}let u={};u.onclick=(()=>{c._clickOnHeader(e)});let _=a.createSearchMultiViewLabel(e,c.id,u,!0);if(_.title=e.headTitle,_.id=e.id,_.inject(c.multiViewContainer),!t.is(e,"object")||0===e.totalCount)continue;let m={...d},S=new n({useAsyncPreExpand:!0,shouldAcceptDrag:function(){return!1},shouldAcceptDrop:function(){return!1}});c.collection._treeDocument=S,c.collection.generateTreeModelAsync(e._models,S),m.model=S,m.collection=e,e._treeDocument=S;let f="tile",v=t.is(f)?f:"tile",C={model:m.model,type:v,tag:o};if(-1!==e.totalCount){switch(f){case"tile":C.view=c._instantiateResponsiveCollection(l,m,o);break;default:throw new Error("[MultiView] - incorrect view model given.")}if(C.view&&C.view.onReady(()=>{c.setPoolMultiViewContainerHeight(c.container.scrollHeight);let e=s.debounce(function(e){C.view.requestDelayedModelData(e);let t=C.view._dimensions;c._heightInjected+=48,c._heightInjected+=t&&t.height,c._heightInjected<=h&&o===g-1&&(c._reachBottomEventFire=!0,c._onInfiniteScrollMulti(null,()=>{c._reachBottomEventFire=!1}))},1);C.view._updateDimensions(),C.view.invalidateLayout({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1}),C.view._onEndResizeOrOnReadyModelCompletionRequest("OnEndResize"),e("OnResize"),C.view._modelEvents.publish({event:"ENDRESIZE",context:C.view})}),c.views[o]=C,t.is(f)){let e=c.views[o]&&c.views[o].view&&c.views[o].view.getContent();e&&e.inject(c.multiViewContainer)}c._buildViewMore(e,r)}}catch(e){i.log("categoryContentView::_loadViews onFailure: ",e)}}p>0&&(c._reachBottomEventFire=!0,c._onInfiniteScrollMulti(null,()=>{c._reachBottomEventFire=!1})),c.unmask()})},_buildViewMore:function(e){},_onInitTreeDocumentAsyncCB:function(e){let n=this;const{query:s}=e;n._lastQuery!==s&&!0!==n._onGroupingCompute&&(n._emptyViews(),n._resetViews(),n._onGroupingCompute=!0,null!==n.collectionUX&&delete n.collectionUX,n.mask(),c.getSuggestHelper().then(function(){let o=c.getSuggests({search_text:s,nresults:n._nresults?n._nresults:void 0,facets:void 0,select_predicate:["ds6w:label","ds6w:containerUid","ds6w:community","ds6w:modified","ds6w:description","ds6w:responsible","owner","ds6w:responsibleUid","ds6w:type"],feature:r.getOption("fedsearch_query_label.feature_id.InstantSearch")});n.collections=[];let a=0,l=Object.keys(o),d=l.length,u=!1;for(let r=0;r<d;r++){o[l[r]].then(function(i){let o=i.collection,r=o&&o.nhits?o.nhits:o.hits;if(r>0){let e=i.nls,a=i.id,c=i.iconInfo;t.is(c)&&t.is(c.classes)||(c={classes:" fonticon-search"}),o.id=a,o.query=s,o.icon=c,o.headTitle=e,o.totalCount=r,n.collections.push(o),u=!0}++a===d&&(!0===u?(n._loadViews(0),n.multiViewContainer&&n.multiViewContainer.show(),u=!0,n._onGroupingCompute=!1,n._lastQuery=s):t.is(e.noresult)&&(n.unmask(),n.multiViewContainer&&n.multiViewContainer.hide(),e.noresult.call(void 0),u=!0),n._onGroupingCompute=!1,n._lastQuery=s)},function(o){i.log("categoryContentView::_onInitTreeDocumentAsyncCB onFailure: ",o),t.is(e.noresult)&&(n.unmask(),n.multiViewContainer&&n.multiViewContainer.hide(),u=!0,e.noresult.call(void 0)),n._onGroupingCompute=!1,n._lastQuery=s})}!1===u&&0===d&&(n.unmask(),n.multiViewContainer&&n.multiViewContainer.hide(),t.is(e.noresult)&&e.noresult.call(void 0),n._onGroupingCompute=!1,n._lastQuery=s)}))}})}),define("DS/SNSearchUX/dropdown/guidedContentView",["DS/SNSearchUX/dropdown/categoryContentView","UWA/Core","DS/MessageBus/MessageBus","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","i18n!DS/SNSearchUX/assets/nls/GuidedMode.json"],function(e,t,i,n,s,o){"use strict";return e.extend({_initCollectionListener:function(e){this._parent(e),this._onDragStartCell=i.subscribe({channel:"SearchDropDown",topic:"onDragStart",callback:this._onDragStartListen.bind(this)})},_onInitTreeDocumentAsyncCB:function(e){let i=this;const{query:s,utils:a}=e;if(i._utils=a,!0===i._onGroupingCompute)return;i._emptyViews(),i._resetViews(),i._onGroupingCompute=!0,null!==i.collectionUX&&delete i.collectionUX,i.mask();let r=window.devicePixelRatio;r<1&&(r=1/r);let c=i.multiViewContainer&&i.multiViewContainer.getDimensions(),l=c&&c.width,d=c&&c.height;d-=88;let u=Math.ceil(l/486),h=Math.ceil(d/80)*u,p=(h-=h%2?1:2)>1?h:i.collection.nresults;i.collection._resetState(),i.collection.setRequestCriteria("fed_search",{ignoreRestrictedSources:!0,order_by:"desc",order_field:"relevance",query:s,nresults:p,refine:{allfilters:{},localfilters:{}},select_file:["icon","thumbnail_2d"],source:[],with_synthesis:!1,with_synthesis_hierarchical:!1,next_start:"0"}),i.collection.setPageSize(p),i.collection.fetch({onComplete:function(s,a){n.log("guidedContentView::onComplete: ",a),i.unmask(),i.collections=[];let r=s&&s.nhits?s.nhits:s.hits;if(r>0){let t=o.get("search.searchResults.title"),n=i.id,a={classes:" fonticon-search"};s.id=n,s.icon=a,s.headTitle=t,s.totalCount=r,s.pageSize=p,s.setSNSkeleton(i._utils.getSNSkeleton()),i._utils.getSNSkeleton()._onesearch_collection=s,i.collections.push(s),i._loadViews(0,{useDragAndDrop:!0,onclickViewAll:e.onclickViewAll}),i._onGroupingCompute=!1}else t.is(e.noresult)&&(i.unmask(),i.hideEmptyView(),e.noresult.call(void 0),i._onGroupingCompute=!1)},onFailure:function(e){i.unmask(),i.hideEmptyView(),i._onGroupingCompute=!1,n.log("guidedContentView::onFailure: ",e)}})},_buildViewMore:function(e,i){let n=this,s=e,a=s.pageSize;if(s.totalCount>a){let e=o.get("search.result.view.more"),s=t.createElement("div",{class:"search-multi-view-more",content:e});s.inject(n.multiViewContainer),s.onclick=(()=>{t.is(i.onclickViewAll)&&i.onclickViewAll.call(void 0)})}},_onDragStartListen:function(e){this._utils&&this._utils.modalVisibility(!1),n.log("guidedContentView::_onDragStartListen")},destroy:function(){i.unsubscribe(this._onDragStartCell),this._parent()}})}),define("DS/SNSearchUX/dropdown/myContentView",["DS/SNSearchUX/dropdown/categoryContentView","UWA/Core","DS/SNInfraUX/Logger","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n){"use strict";return e.extend({_onInitTreeDocumentAsyncCB:function(e){let t=this;!0!==t._onGroupingCompute&&(t._emptyViews(),t._resetViews(),t._onGroupingCompute=!0,null!==t.collectionUX&&delete t.collectionUX,t.mask(),t.hideEmptyView(),t.collection._resetState(),t.collection.setRequestCriteria("fed_search",{ignoreRestrictedSources:!0,order_by:"desc",order_field:"relevance",query:"#myContent",nresults:t.collection.nresults,refine:{allfilters:{},localfilters:{}},select_file:["icon","thumbnail_2d"],source:[],with_synthesis:!1,with_nls:!0,with_synthesis_hierarchical:!1,next_start:"0"}),t.collection.setPageSize(t.collection.nresults),t.collection.fetch({onComplete:function(s,o){i.log("myContentView::onComplete: ",o),t.unmask(),t.collections=[];let a=s&&s.nhits?s.nhits:s.hits,r=n.get("myContentTitle"),c=t.id;s.id=c,s.icon={classes:" fonticon-user"},s.headTitle=r,s.totalCount=a,t.collections.push(s),t._loadViews(0,{forceToDisplaySection:!0}),t._onGroupingCompute=!1,0===a?(t.unmask(),t.hideEmptyView(),e.noresult.call(void 0)):e.onComplete.call(void 0)},onFailure:function(e){t.unmask(),t.hideEmptyView(),t._onGroupingCompute=!1,i.log("resultsContentView::onFailure: ",e)}}))}})}),define("DS/SNSearchUX/dropdown/resultsContentView",["DS/SNSearchUX/dropdown/categoryContentView","UWA/Core","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchResultCategories","DS/SNResultUX/utils/ResultCategoryUXHelper"],function(e,t,i,n,s,o){"use strict";return e.extend({_onInitTreeDocumentAsyncCB:function(e){let t=this;if(!0===t._onGroupingCompute)return;t._emptyViews(),t._resetViews(),t._onGroupingCompute=!0,null!==t.collectionUX&&delete t.collectionUX;let s=t._getEmbeddedTaggerTags(e);void 0!==s&&(t.mask(),o.getResultCategoryUXHelper().then(function(){t.collectionUX=o.getResultsCollections({search_text:t._query,nresults:t._nresults?t._nresults:void 0,categories:s.Tags,facets:t.collection.parsed_response&&t.collection.parsed_response.getTags().summaryData,feature:n.getOption("fedsearch_query_label.feature_id.6WSearch")}),t.collectionUX.getFirstPage({onComplete:function(){let e=t.collectionUX.getCategoryCollectionsList();t.collections=e,t._loadViews(0),t._onGroupingCompute=!1},onFailure:function(e){i.log("resultsContentView::_onInitTreeDocumentAsyncCB onFailure: ",e),t._onGroupingCompute=!1}})}))},fetch:function(e){i.log("resultsContentView::fetch: ",e);let n=this;n.collection._resetState(),n.collection.getTaggerProxy()&&n.collection.getTaggerProxy().unsetTags(),n.collection.setRequestCriteria("fed_search",{ignoreRestrictedSources:!0,order_by:"desc",order_field:"relevance",query:e.query,refine:{allfilters:{},localfilters:{}},select_file:["icon","thumbnail_2d"],source:[],with_synthesis:!0,with_synthesis_hierarchical:!0,next_start:"0"}),n._query=e.query,t.is(e.count)||(e.count=3),n.collection.setPageSize(e.count);let s=document.body.getElement("#dropdown-search-global-embedded");t.is(s)&&(s=(s=s.querySelector(".embedded-all"))&&s.querySelector(".root-icon-div"))&&t.Event.dispatchEvent(s,"click"),n.collection.fetch({onComplete:function(s,o){if(i.log("resultsContentView::onComplete: ",o),(s&&s.nhits?s.nhits:s.hits)>0){let e=n.collection.getTaggerProxy();if(t.is(e)){require(["DS/TagNavigator/TagNavigator"],function(e){let i=e&&e.get6WTagger("DropDownContext");i&&(i.setAsCurrent(),i.focusOnCC("SearchDropDown"));let n=document.body.getElement("#dropdown-search-global-embedded");t.is(n)&&(n=(n=n.querySelector(".embedded-what"))&&n.querySelector(".root-icon-div"))&&t.Event.dispatchEvent(n,"click")})}}else t.is(e.noresult)&&e.noresult.call(void 0)},onFailure:function(e){i.log("resultsContentView::onFailure: ",e)}})}})}),define("DS/SNSearchUX/InContextSearch",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Debug","UWA/Class/Collection","UWA/Promise","UWA/Utils","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SearchPreferences","require","DS/MessageBus/MessageBus","DS/SNInfraUX/Logger"],function(e,t,i,n,s,o,a,r,c,l,d,u,h,p,g){"use strict";return t.extend(i,n,{_socket:null,_registered_search_ctx:null,_isWidgetMaximized:!1,_pubsub_loaded:!1,init:function(t){this.setDebugMode(r.getDebugMode()),this._socket=c.createSocket({socket_id:"incontextsearch_socket_id"}),this.setOptions(t);var i=this;h(["DS/PubSub/PubSub"],function(t){i._pubsub_loaded=!0,e.is(t)&&t.add("onViewChange",function(t){var n,s,o,a=t.widgetId||t.id,c=!1;if(e.is(e.Widgets)&&e.is(e.Widgets.instances)&&(e.Widgets.instances.filter(function(t){return e.is(t.id)&&-1!==t.id.indexOf("preview")&&!t.events.onDestroy}).forEach(function(e){e.addEvent("onDestroy",function(){i.computeSearchBar&&i.computeSearchBar()})}),s=(s=e.Widgets.instances.filter(function(e){return e.id===a})).length>0?s[0]:null),o=e.is(i.getOption("addinMode"),"string")||e.is(s)&&s.getValue("stayOnSearch")||!1,e.is(s)&&!0===s.getValue("noSearchModeChange")&&(c=!0),e.is(i._registered_search_ctx)&&e.is(i.getInContextOptions(a)))(n=i.getInContextOptions(a)).id===a&&("maximized"===t.type||"fullscreen"===t.type?(i._isWidgetMaximized=!0,e.is(n.search_delegation)&&"3ddashboard"===n.search_delegation&&!o?!0===r.getOption("find_in_this_tab_default")&&i._socket.dispatchEvent("onSetFindInTab",n):o||(i._socket.dispatchEvent("onSetInAppContext",{isInAppContext:!0}),i._socket.dispatchEvent("onSetFindInApp",n))):"windowed"!==t.type&&"minimized"!==t.type||(i._isWidgetMaximized=!1,i._socket.dispatchEvent("onSetInAppContext",{isInAppContext:!1}),!0!==r.getOption("find_in_this_tab_default")||o?i._socket.dispatchEvent("clickOnChoiceSearch",{resetNLS:!0,focus:!1}):i._socket.dispatchEvent("onSetFindInTab",null)));else{if(e.is(s)&&(s&&l.checkSearchAppId(s.getValue("appId"))&&i._socket.dispatchEvent("3DSearchWidgetmaximized",t.type),s&&l.checkSearchAppId(s.getValue("appId"))&&("maximized"===t.type||"fullscreen"===t.type)||"3DSearch"===s.title&&-1<s.id.indexOf("preview")))return void(i._isWidgetMaximized=!0);"windowed"!==t.type&&"minimized"!==t.type||(i._isWidgetMaximized=!1,i._socket.dispatchEvent("onSetInAppContext",{isInAppContext:!1}),!0!==r.getOption("find_in_this_tab_default")||o||!1===c&&i._socket.dispatchEvent("onSetFindInTab",null))}})}),e.is(t.addinMode,"string")&&require(["DS/PlatformAPI/PlatformAPI"],function(e){i.log("InContextSearch: addinMode found, start subscribing to webinwin:win:notification"),e.subscribe("webinwin:win:notification",i._onWinNotif.bind(i))}),this._socket.addListener("RegisterContext",this._registerContext.bind(this)),this._socket.addListener("TemporaryBypassFedsearch",this._temporaryBypassFedsearch.bind(this)),this._socket.addListener("InContextSearch",this._inContextSearch.bind(this)),this._socket.addListener("UnregisterContext",this._unregisterContext.bind(this)),this._socket.addListener("onCloseTransient",function(){i.setIncontextSearchActive(!1)})},_onWinNotif:function(t){if(e.is(t,"object")&&e.is(t.event,"string")&&e.is(t.content,"object"))switch(t.event){case"RegisterContext":this.log("webinwin:win:notification for RegisterContext notif received, options="+JSON.stringify(t)),this._registerContext(t.content);break;case"InContextSearch":this.log("webinwin:win:notification for InContextSearch notif received, options="+JSON.stringify(t)),this._inContextSearch(t.content)}else this.log("webinwin:win:notification does not contain info in expected format")},getInContextOptions:function(t){var i,n=this._registered_search_ctx.get({id:t});return e.is(n)&&(i=n.toJSON()),i},_registerContext:function(t){this.log("Register Search Context"),g.groupCollapsed("Incontext Parameters(Register)>>"),g.log(t),g.groupEnd();this._addAdvSearchOption(t),e.is(this._registered_search_ctx)||(this._registered_search_ctx=new s),this._cleanSourceValue(t),this._cleanOrderFields(t);var i=this.getInContextOptions(t.widget_id);e.is(i)?(this.log("A Context in already registered for Widget Id "+t.widget_id+". Update it"),this._registered_search_ctx.remove({id:t.widget_id}),t.id=t.widget_id,this._registered_search_ctx.add(t)):(this.log("Register the context for Widget Id "+t.widget_id),t.id=t.widget_id,this._registered_search_ctx.add(t)),this._socket.dispatchEvent("RegisterContext_Response",t,t.app_socket_id)},_amIAMaximizedWidget:function(t){return!(!e.is(e.Widgets)||!e.is(e.Widgets.instances))&&0!==e.Widgets.instances.filter(function(e){return e.id===t&&"maximized"===e.getView().type}).length},_temporaryBypassFedsearch:function(t){if(e.is(t.bypass_url))if(e.is(this._registered_search_ctx)){var i={id:t.widget_id},n=this._registered_search_ctx.where(i);if(e.is(n)&&n.length>0)for(var s=0;s<n.length;s++)e.is(n[s])&&e.is(n[s]._attributes)&&(n[s]._attributes.bypass_url=t.bypass_url);else this.log("No context registered with Widget Id "+t.widget_id)}else this.log("No context registered")},_inContextSearch:function(t){this.log("In Context search Activated"),g.groupCollapsed("Incontext Parameters(Search)>>"),g.log(t),g.groupEnd();var i=this;i._addAdvSearchOption(t);var n={inCtx_widget_id:t.widget_id};this._promise=new o(function(n){!0===t.default_with_precond&&e.is(t.default_search_criteria)&&t.default_search_criteria.length>0?t.default_search_criteria.indexOf(":")>0?require(["DS/SNResultUX/utils/WildcardMgr"],function(e){i._socket.dispatchEvent("fetchPQsFromServer"),d.getPQFetchPromise().then(function(){var i=e.manageWildcardAddtion(t.default_search_criteria);i=l.replacePQsWithCVPrefixes(i),n(i)})}):require(["DS/SNResultUX/utils/WildcardMgr"],function(e){var i=e.manageWildcardAddtion(t.default_search_criteria,{addWildCard_inCtx:t.addWildCard});n(i)}):n()});var s=[this._promise];s.push(this.checkPreviousIncontextSearchPromise()),o.all(s).then(function(s){delete i._promise,i._promise=null,i.resetPrevIncontextSearchPromises(),i.setIncontextSearchActive(!0),s=s[0],!0===t.default_with_precond?(e.is(t.default_search_criteria)&&t.default_search_criteria.length>0&&(n.value=s,n.displayValue=e.is(t.search_criteria_to_display)?t.search_criteria_to_display:t.default_search_criteria,n.searchStringToDisplayInSearchField=e.is(t.search_criteria_to_display)?t.search_criteria_to_display:t.default_search_criteria),e.is(t.precond)&&t.precond.trim().length>0&&(e.is(n.value)&&n.value.trim().length>0?n.value=n.value+" AND "+t.precond:n.value=t.precond),e.is(t.displayValue)&&(n.searchStringToDisplayInSearchField=t.displayValue)):n.focus=!0,e.is(t.global_actions)&&(n.incontext_global_actions=t.global_actions),e.is(t.itemViewClickHandler)&&t.itemViewClickHandler.trim().length>0&&(n.itemViewClickHandler=t.itemViewClickHandler),i._cleanSourceValue(t),n.source=t.source,e.is(t.tenant)&&(n.tenant=t.tenant),e.is(t.advanced_search)&&(n.advanced_search=t.advanced_search,n.advanced_search.default_search_criteria=n.value),e.is(t.recent_search)&&(n.recent_search=t.recent_search),n.savedSearch=t.savedSearch;var o={id:t.widget_id},a=i._registered_search_ctx.where(o);if(e.is(a)&&a.length>0){if(1!==a.length)throw new Error("2 search context have been registered for the same Widget Id "+t.widget_id);i.log("A Context in already registered for Widget Id "+t.widget_id+". Update it");var r=a[0].toJSON();e.is(t.context_title,"string")?(i._registered_search_ctx.remove({id:t.widget_id}),r.context_title=t.context_title,i._registered_search_ctx.add(r)):e.is(r.context_title,"string")&&(i._registered_search_ctx.remove({id:t.widget_id}),delete r.context_title,i._registered_search_ctx.add(r))}e.is(i.getOption("addinMode"))&&(n.forceWidgetUXRecreation=!0),n.tag_filter=t.tag_filter,n.refine=t.tag_filter,l.autocompleteRendered().then(function(){function e(){i._socket.dispatchEvent("onInContextSearch",{inContextOptions:t,placeholder:void 0}),i._socket.dispatchEvent("search",n)}if(p.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"checkSidePanelStatus"}),i._hasGlobalChannelSubscriptipons()){var s=p.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"InContextInit",callback:function(){e(),p.unsubscribe(s)}});p.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"activateInContextSearch",data:t})}else e()})})},checkPreviousIncontextSearchPromise:function(){var t=this;return new o(function(i,n){"3DDashboard"===l.identifyClientInfo().identifier&&t.isIncontextSearchActive()?(e.is(t.deactivateIncontextSearchPromise)||(t.deactivateIncontextSearchPromise=o.deferred(),t.incontextSidepanelStatusPromise=o.deferred(),p.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"deactivateInContextSearch",data:{}})),o.all([t.deactivateIncontextSearchPromise.promise,t.incontextSidepanelStatusPromise.promise]).then(i)):i()})},resetPrevIncontextSearchPromises:function(){delete this.deactivateIncontextSearchPromise,this.deactivateIncontextSearchPromise=null,delete this.incontextSidepanelStatusPromise,this.incontextSidepanelStatusPromise=null},setIncontextSearchActive:function(e){this.incontextSearchActive=e},isIncontextSearchActive:function(){return this.incontextSearchActive},_addAdvSearchOption:function(t){!0===r.getOption("forceAdvancedSearch",{tenant:t.tenant?t.tenant:l.getActiveTenant()})&&"socket_id_#saved_search_edit#"!=t.app_socket_id&&e.is(t.advanced_search,"object")&&(t.advanced_search.showByDefault=!0,t.advanced_search.searchOnInit=!1)},_hasGlobalChannelSubscriptipons:function(){var t=p.getSubscriptions({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"activateInContextSearch"});return e.is(t,"array")&&t.length>0},_cleanOrderFields:function(t){e.is(t.order_field,"array")&&t.order_field.length>0&&e.is(t.order_by,"array")&&t.order_by.length>0?(t.order_field=t.order_field[0],t.order_by=t.order_by[0]):(t.order_field=void 0,t.order_by=void 0)},_cleanSourceValue:function(t){e.is(t.source)&&e.is(t.source,"string")&&(t.source=[t.source])},_unregisterContext:function(t){this.log("Unregister search Context"),g.groupCollapsed("Incontext Parameters(Un-Register)>>"),g.log(t),g.groupEnd();var i=t;if(e.is(i,"string")&&(i={widget_id:t,widgetId:t}),e.is(this._registered_search_ctx)){var n={id:i.widget_id},s=this._registered_search_ctx.where(n);e.is(s)&&s.length>0?this._registered_search_ctx.remove({id:i.widget_id}):this.log("No context registered with Widget Id "+i.widget_id)}else this.log("No context registered")}})}),define("DS/SNSearchUX/dropdown/SearchDropDownSettings",["UWA/Core","UWA/Element","UWA/Promise","UWA/Controls/Abstract","DS/UIKIT/SuperModal","DS/Controls/ComboBox","DS/Controls/Button","DS/SNInfraUX/SessionSecurityContextServices","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchUtils","DS/MessageBus/MessageBus","DS/PubSub/PubSub","DS/SNSearchResultsCusto/views/SearchResultsCustomizationPanel","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationPreferences","DS/SNResultUX/utils/ExternalComponentHelpers","DS/SNResultUX/utils/SearchServices","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","i18n!DS/SNInfraUX/assets/nls/SNInfraUX.json","i18n!DS/SNSearchUX/assets/nls/SearchDropDown.json"],function(e,t,i,n,s,o,a,r,c,l,d,u,h,p,g,_,m,S,f,v){"use strict";return n.extend({settings:{},_searchDropDown:null,_webInwin:!1,_eventManager:void 0,_srcRessource:void 0,init:function(t){let i=this;i._parent(t),e.is(t)&&(e.is(t.eventManager)&&(i._eventManager=t.eventManager),e.is(t.searchDropDown)&&(i._searchDropDown=t.searchDropDown),e.is(t.webInwin)&&(i._webInwin=t.webInwin),i._srcRessource=null)},initCustoSettings:function(e){this._CustoPanel=new p,this._CustoPanel.setup(e)},initSettings:function(t){e.is(t)&&(this._srcRessource=t,this._initDefaultSettings())},_initDefaultSettings:function(){let t=this;if(t.initialSettings={},!e.is(t.elements))return;if("3DSpace"!==d.identifyClientInfo().identifier&&t.elements.settingCheckbox_2){let i=l.getItem("search_tabbed_ui");t.elements.settingCheckbox_2.checked=!!e.is(i)&&i,t.initialSettings.searchTabbedUI=t.elements.settingCheckbox_2.checked}if(!0===t._webInwin&&t.elements.settingCheckbox_2_1){let i=l.getItem("search_double_click_open");t.elements.settingCheckbox_2_1.checked=!!e.is(i)&&i,t.initialSettings.doubleclickopen=t.elements.settingCheckbox_2_1.checked}var i=[];let n=c.getOption("csvSeparatorArray");e.is(n)&&n.length>0&&(n.forEach(function(e){i.push({label:S.get("csvSeparatorUI.values."+e.id),value:e.value})}),t.elements.settingsSelect_3.elementsList=i);let s=c.getOption("date_display_mode_array");i=[],e.is(s)&&s.length>0&&(s.forEach(function(e){i.push({label:S.get(e.id+".title"),value:e.value})}),t.elements.settingsSelect_4.elementsList=i);let o=g.getActiveCustomization();if(e.is(o)?this.initialSettings.resultAttributesCustomization=o.customizationId||o.getCustomizationId():this.initialSettings.resultAttributesCustomization="Default",l.getItemPromise("optionMode",t._srcRessource.active_tenant).then(function(i){e.is(i)&&(t.elements.settingsSelect_3.value=c.getOption("csvSeparator"),e.is(i.csvMode)&&e.is(i.csvMode.valueItem)&&(t.elements.settingsSelect_3.value=i.csvMode.valueItem),t.initialSettings.csvSeparator=t.elements.settingsSelect_3.elementsList[t.elements.settingsSelect_3.selectedIndex].label,e.is(i.dateDisplayMode)&&e.is(i.dateDisplayMode.id)?Array.from(t.elements.settingsSelect_4.elementsList).forEach(function(e,n){e.label===S.get(i.dateDisplayMode.id+".title")&&(t.elements.settingsSelect_4.selectedIndex=n)}):t.elements.settingsSelect_4.selectedIndex=0,t.initialSettings.dateFormat=t.elements.settingsSelect_4.elementsList[t.elements.settingsSelect_4.selectedIndex>=0?t.elements.settingsSelect_4.selectedIndex:0].label)}),i=[],d.isRoleAvailable(["CSV"],t._srcRessource.active_tenant,function(n){if(!0===n){let n=c.getOption("show_search_results_revision_array");e.is(n)&&n.length>0&&(n.forEach(function(e){i.push({label:S.get(e.id+".title"),value:e.exprn,name:e.id})}),t.elements.settingsSelect_5.elementsList=i);let s=e.is(l.getItem("revisionDisplayType"))?l.getItem("revisionDisplayType"):c.getOption("defaultRevision",{tenant:t._srcRessource.active_tenant});e.is(s)?(Array.from(t.elements.settingsSelect_5.elementsList).forEach(function(e,i){e.label===S.get(s.id+".title")&&(t.elements.settingsSelect_5.selectedIndex=i)}),t.initialSettings.searchResultRevisions=t.elements.settingsSelect_5.elementsList[t.elements.settingsSelect_5.selectedIndex].label):(t.elements.settingsSelect_5.selectedIndex=0,t.initialSettings.searchResultRevisions=t.elements.settingsSelect_5.elementsList[0].label)}}),i=[],"3DSpace"!==d.identifyClientInfo().identifier&&!1===t._webInwin){let n=d.identifyClientInfo(void 0),s=!1;if(e.is(n)&&e.is(n.identifier)&&("3DDashboard"===n.identifier||"3DSwym"===n.identifier)&&(s=!0),e.is(n)&&e.is(n.addinmode)&&"catiav5"===n.addinmode&&(s=!0),c.getOption("global_action_credentials")&&!0===s){var a=0;r.getSecurityContext3DSpace(t._srcRessource.active_tenant).then(function(n){var s=l.getItem("securityContext"+t._srcRessource.active_tenant);e.is(s,"string")&&(s=JSON.parse(s)),t.settings.listofCredentialObjectsArray=n,t.settings.listofCredentialObjectsArray.forEach(function(t){e.is(t.isDefault)&&!0===t.isDefault?i.unshift({label:S.get(t.displayName),value:t.name}):i.push({label:S.get(t.displayName),value:t.name})}),i.forEach(function(i,n){e.is(s)&&e.is(s.name)&&s.name===i.value&&(a=n,t.elements.settingsSelect_6.value=i.value)}),t.elements.settingsSelect_6.elementsList=i,t.initialSettings.collaborativeSpaceCredentials=t.elements.settingsSelect_6.elementsList[a].label,t.elements.settingsSelect_6.selectedIndex=a})}if(t.elements.MSF_Checkbox){let i=l.getItem("activateMSFIntegration");t.elements.MSF_Checkbox.checked=!!e.is(i)&&i,t.initialSettings.activateMSFIntegration=t.elements.MSF_Checkbox.checked}}},hasSettingsChanged:function(){var t=!1;return e.is(this.initialSettings.instantSearch)&&this.initialSettings.instantSearch!==this.elements.settingCheckbox_1.checked&&(t=!0),e.is(this.initialSettings.searchTabbedUI)&&this.initialSettings.searchTabbedUI!==this.elements.settingCheckbox_2.checked&&(t=!0),e.is(this.initialSettings.doubleclickopen)&&this.initialSettings.doubleclickopen!==this.elements.settingCheckbox_2_1.checked&&(t=!0),e.is(this.initialSettings.csvSeparator)&&this.initialSettings.csvSeparator!==this.elements.settingsSelect_3.elementsList[this.elements.settingsSelect_3.selectedIndex].label&&(t=!0),e.is(this.initialSettings.dateFormat)&&this.initialSettings.dateFormat!==this.elements.settingsSelect_4.elementsList[this.elements.settingsSelect_4.selectedIndex].label&&(t=!0),e.is(this.initialSettings.searchResultRevisions)&&this.initialSettings.searchResultRevisions!==this.elements.settingsSelect_5.elementsList[this.elements.settingsSelect_5.selectedIndex].label&&(t=!0),e.is(this.initialSettings.collaborativeSpaceCredentials)&&this.initialSettings.collaborativeSpaceCredentials!==this.elements.settingsSelect_6.elementsList[this.elements.settingsSelect_6.selectedIndex].label&&(t=!0),e.is(this.initialSettings.activateMSFIntegration)&&e.is(this.elements.MSF_Checkbox)&&this.initialSettings.activateMSFIntegration!==this.elements.MSF_Checkbox.checked&&(t=!0),e.is(this.initialSettings.resultAttributesCustomization)&&e.is(this.elements.settingsSelect_custo_selector)&&this.initialSettings.resultAttributesCustomization!==this.elements.settingsSelect_custo_selector.elementsList[this.elements.settingsSelect_custo_selector.selectedIndex]&&(t=!0),t},setButtonState:function(){this.hasSettingsChanged()?this.elements.settingsApply.disabled=!1:this.elements.settingsApply.disabled=!0},buildSettings:function(i){let n=this;if(!e.is(n._searchDropDown)||!e.is(i))return;let r=this.elements;if(r.settingsTabContainer=i,r.settingsContainer=t.create("div",{class:"settings-container"}).inject(r.settingsTabContainer),r.settingsClose=new t.create("div",{class:"settings-close"}).inject(r.settingsContainer),r.closeLink=new a({displayStyle:"lite",emphasize:"secondary",icon:{iconName:"close",fontIconSize:"1x",fontIconFamily:WUXManagedFontIcons.Font3DS},onClick:function(){n._searchDropDown.hideSettingPQs()}}).inject(r.settingsClose),r.title_1=t.create("div",{class:"setting-container"}).inject(r.settingsContainer),t.create("div",{class:"label-container-title",text:v.get("Tab.setting.layout")}).inject(r.title_1),"3DSpace"!==d.identifyClientInfo().identifier&&(r.setting_2=t.create("div",{class:"setting-container tabbed"}).inject(r.settingsContainer),r.settingContainer_2=t.create("div",{class:"option-container"}).inject(r.setting_2),r.settingCheckbox_2=t.create("input",{class:"settings-instant-search-checkbox",type:"checkbox"}).inject(r.settingContainer_2),r.settingCheckbox_2.addEventListener("change",function(e){n._searchDropDown.noBlur=!1,n.setButtonState()}),r.settingTitle_2=t.create("span",{class:"settings-instant-search-title",text:v.get("Tab.setting.show")}).inject(r.settingContainer_2)),!0===n._webInwin&&(r.setting_2_1=t.create("div",{class:"setting-container dbl-clk"}).inject(r.settingsContainer),r.settingContainer_2_1=t.create("div",{class:"option-container"}).inject(r.setting_2_1),r.settingCheckbox_2_1=t.create("input",{class:"settings-instant-search-checkbox",type:"checkbox"}).inject(r.settingContainer_2_1),r.settingCheckbox_2_1.addEvent("click",function(t){if(e.is(t)&&e.is(t.target)){let e=t.target.checked;n._eventManager&&n._eventManager.dispatchEvent("doubleclickopen",{value:e}),n.setButtonState()}}),r.settingTitle_2_1=t.create("span",{class:"settings-instant-search-title",text:v.get("search_double_click_open")}).inject(r.settingContainer_2_1)),r.title_2=t.create("div",{class:"setting-container"}).inject(r.settingsContainer),t.create("div",{class:"label-container-title",text:v.get("Tab.setting.result")}).inject(r.title_2),r.setting_4=t.create("div",{class:"setting-container date-format"}).inject(r.settingsContainer),t.create("div",{class:"label-container",text:v.get("Tab.setting.date.format")}).inject(r.setting_4),r.settingContainer_4=t.create("div",{class:"option-container-select"}).inject(r.setting_4),r.settingsSelect_4=new o({touchMode:!0,enableSearchFlag:!1}).inject(r.settingContainer_4),r.settingsSelect_4.addEventListener("change",function(e){n._searchDropDown.noBlur=!1,n.setButtonState()}),r.settingsSelect_4.elements.mainElement.addEventListener("blur",function(){n._searchDropDown.noBlur=!1,n._searchDropDown.setFocus()}),!0===g.isBETAEnabled()){r.title_custo=t.create("div",{class:"setting-container"}).inject(r.settingsContainer),t.create("div",{class:"label-container-title",text:v.get("Tab.setting.customization")}).inject(r.title_custo),r.setting_custo_selector=t.create("div",{class:"setting-container custo_selector"}).inject(r.settingsContainer),t.create("div",{class:"label-container",text:v.get("Tab.setting.active.customization")}).inject(r.setting_custo_selector),r.settingContainer_custo_selector=t.create("div",{class:"option-container-select"}).inject(r.setting_custo_selector);let i=g.buildUserCustomizationList(),s=g.getActiveCustomization();if(e.is(s))var l=s.customizationId||s.getCustomizationId(),h=i.findIndex(e=>e===l);r.settingsSelect_custo_selector=new o({elementsList:i,currentValue:i[h]||"Default",touchMode:!0,enableSearchFlag:!1}).inject(r.settingContainer_custo_selector),!0!==this._webInwin&&(r.settingsSelect_custo_button=new a({icon:{iconName:"cog",fontIconSize:"2x"}}).inject(r.settingContainer_custo_selector),r.settingsSelect_custo_button.addEventListener("click",function(){this.initCustoSettings(this)}.bind(this))),r.settingsSelect_custo_selector.addEventListener("change",function(e){n._searchDropDown.noBlur=!1,n.setButtonState()}),r.settingsSelect_custo_selector.elements.mainElement.addEventListener("blur",function(){n._searchDropDown.noBlur=!1,n._searchDropDown.setFocus()}),u.subscribe({channel:"3dSearch_results_customization",topic:"3dSearch_new_customization_in_localStorage",callback:()=>{e.is(r.settingsSelect_custo_selector)&&(r.settingsSelect_custo_selector.elementsList=g.buildUserCustomizationList())}}),u.subscribe({channel:"3dSearch_results_customization",topic:"3dSearch_customization_deleted_from_localStorage",callback:()=>{e.is(r.settingsSelect_custo_selector)&&(r.settingsSelect_custo_selector.elementsList=g.buildUserCustomizationList())}})}r.title_3=t.create("div",{class:"setting-container"}).inject(r.settingsContainer),t.create("div",{class:"label-container-title",text:v.get("Tab.setting.export")}).inject(r.title_3),r.setting_3=t.create("div",{class:"setting-container csv-separator"}).inject(r.settingsContainer),t.create("div",{class:"label-container",text:v.get("Tab.setting.csv")}).inject(r.setting_3),r.settingContainer_3=t.create("div",{class:"option-container-select"}).inject(r.setting_3),r.settingsSelect_3=new o({touchMode:!0,enableSearchFlag:!1}).inject(r.settingContainer_3),r.settingsSelect_3.addEventListener("change",function(e){n._searchDropDown.noBlur=!1,n.setButtonState()}),r.settingsSelect_3.elements.mainElement.addEventListener("blur",function(){n._searchDropDown.noBlur=!1,n._searchDropDown.setFocus()}),r.title_4=t.create("div",{class:"setting-container"}).inject(r.settingsContainer),t.create("div",{class:"label-container-title",text:v.get("Tab.setting.collaborative")}).inject(r.title_4),r.setting_5=t.create("div",{class:"setting-container results-revision"}).inject(r.settingsContainer),t.create("div",{class:"label-container",text:v.get("Tab.setting.revisions")}).inject(r.setting_5),r.settingContainer_5=t.create("div",{class:"option-container-select"}).inject(r.setting_5),r.settingsSelect_5=new o({touchMode:!0,enableSearchFlag:!1}).inject(r.settingContainer_5),r.settingsSelect_5.addEventListener("change",function(e){n._searchDropDown.noBlur=!1,n.setButtonState()}),r.settingsSelect_5.elements.mainElement.addEventListener("blur",function(){n._searchDropDown.noBlur=!1,n._searchDropDown.setFocus()}),"3DSpace"!==d.identifyClientInfo().identifier&&!1===n._webInwin&&(r.setting_6=t.create("div",{class:"setting-container credentials"}).inject(r.settingsContainer),t.create("div",{class:"label-container",text:v.get("Tab.setting.credentials")}).inject(r.setting_6),r.settingContainer_6=t.create("div",{class:"option-container-select"}).inject(r.setting_6),r.settingsSelect_6=new o({touchMode:!0,enableSearchFlag:!1}).inject(r.settingContainer_6),r.settingsSelect_6.addEventListener("change",function(e){n._searchDropDown.noBlur=!1,n.setButtonState()}),r.settingsSelect_6.elements.mainElement.addEventListener("blur",function(e){n._searchDropDown.noBlur=!1,n._searchDropDown.setFocus()}));let p=d.identifyClientInfo(c.getOption("addinmode"));if(e.is(p)&&"3DDashboard"==p.identifier&&!e.is(p.addinmode)&&"tablet"!=d.getDeviceType()){r.crossLinkCollaboration=t.create("div",{class:"setting-container"}).inject(r.settingsContainer),t.create("div",{class:"label-container-title",text:v.get("Tab.setting.cross")}).inject(r.crossLinkCollaboration),r.crossLinkContainer=t.create("div",{class:"setting-container tabbed"}).inject(r.settingsContainer),r.crossLinkOptionContainer=t.create("div",{class:"option-container"}).inject(r.crossLinkContainer),r.MSF_Checkbox=t.create("input",{class:"settings-MSF-checkbox",type:"checkbox"}).inject(r.crossLinkOptionContainer),r.MSF_Checkbox.addEventListener("change",function(e){n._searchDropDown.noBlur=!1,n.setButtonState(),n.elements.MSF_Checkbox.checked&&m._displayAlert({message:v.get("Tab.setting.microsoft_collaboration.alert")})}),r.MSF_Title=t.create("span",{class:"settings-MSF-title",text:v.get("Tab.setting.microsoft_collaboration")}).inject(r.crossLinkOptionContainer);let e=t.create("span",{class:"fonticon fonticon-info tooltip_icon"}).inject(r.crossLinkOptionContainer);e.setStyle("color","#b4b6ba"),_.tooltip(e,{position:"top",shortHelp:v.get("Tab.setting.microsoft_collaboration.tooltipMsg")})}r.settingsApply=new a({label:S.get("APPLYButton"),emphasize:"secondary",touchMode:!0,onClick:function(){new s({renderTo:document.body,className:"WarningReloadPage",okButtonText:S.get("settings-Apply")}).confirm(S.get("settings-confirm"),S.get("settings-Changes"),function(e){!0===e?n.applySettings():!1===e&&(n._initDefaultSettings(),n._searchDropDown.hideSettingPQs(),n._searchDropDown.onBlur(void 0,!0))})}}).inject(r.settingsContainer),r.settingsApply.disabled=!0,r.settingsApply.elements.container.addClassName("apply-button"),!0===g.isBETAEnabled()&&r.settingsApply.elements.container.addClassName("BETA-FUN146944")},applySettings:function(t){let i=this;e.is(i.elements.settingCheckbox_2)&&l.setItem("search_tabbed_ui",i.elements.settingCheckbox_2.checked),e.is(i.elements.settingCheckbox_2_1)&&l.setItem("search_double_click_open",i.elements.settingCheckbox_2_1.checked),e.is(i.elements.MSF_Checkbox)&&l.setItem("activateMSFIntegration",i.elements.MSF_Checkbox.checked);var n=i.elements.settingsSelect_5.elementsList[i.elements.settingsSelect_5.selectedIndex].name,s=i.elements.settingsSelect_5.elementsList[i.elements.settingsSelect_5.selectedIndex].value;l.setItem("revisionDisplayType",{id:n,exprn:s}),"3DSpace"!==d.identifyClientInfo().identifier&&!1===this.webInwin&&i.settings.listofCredentialObjectsArray.forEach(function(e){e.displayName===i.elements.settingsSelect_6.elementsList[this.elements.settingsSelect_6.selectedIndex].label&&l.setItem("securityContext"+i._srcRessource.active_tenant,JSON.stringify(e))}),l.commit();var o={labelItem:i.elements.settingsSelect_3.elementsList[i.elements.settingsSelect_3.selectedIndex].label,valueItem:i.elements.settingsSelect_3.elementsList[i.elements.settingsSelect_3.selectedIndex].value},a={};c.getOption("date_display_mode_array").forEach(function(e){S.get(e.id+".title")===i.elements.settingsSelect_4.elementsList[i.elements.settingsSelect_4.selectedIndex].label&&(a=e)});var r={csvMode:o,dateDisplayMode:a};let u;e.is(i.elements.settingsSelect_custo_selector)&&e.is(i.elements.settingsSelect_custo_selector.elementsList)&&(u=i.elements.settingsSelect_custo_selector.elementsList[i.elements.settingsSelect_custo_selector.selectedIndex],e.is(u)&&(g.switchActiveCustomization(u),i.initialSettings.resultAttributesCustomization=u)),l.setPreference({name:"optionMode",value:JSON.stringify(r),tenantId:i._srcRessource.active_tenant,onComplete:function(){!0===i._webInwin?(i._eventManager&&i._eventManager.dispatchEvent("applySettings",{name:"optionMode",value:JSON.stringify(r),tenantId:i._srcRessource.active_tenant,search_tabbed_ui:e.is(i.elements.settingCheckbox_2)&&i.elements.settingCheckbox_2.checked,search_double_click_open:e.is(i.elements.settingCheckbox_2_1)&&i.elements.settingCheckbox_2_1.checked,revisionDisplayType:{id:n,exprn:s}}),i._searchDropDown.hideSettingPQs(),i._initDefaultSettings()):location.reload(!0)},onFailure:function(e){Logger.error("Failure, Unable to save preferences :",e)}})},destroy:function(){this._parent()}})}),define("DS/SNSearchUX/SearchHistoric",["UWA/Core","UWA/Class","UWA/Class/Debug"],function(e,t,i){"use strict";return t.singleton(i,{history:{},init:function(){},getHistoric:function(){return e.is(localStorage.SNSearchBoxStore)?JSON.parse(localStorage.SNSearchBoxStore):[]},setHistoricInLocalStorage:function(){var e=this.getHistoric();localStorage.SNSearchBoxStore=JSON.stringify(e)},storeValueInDataBase:function(t){if(!e.is(t,"string"))throw new Error("null value given to SearchView._storeValueInLocalStorage!");if(!(t.trim().length<=0)){var i=this.getHistoric();if(-1===i.indexOf(t))i.length>=100&&i.shift(),i.push(t);else{var n=i.indexOf(t),s=i[n];i.splice(n,1),i.push(s)}localStorage.SNSearchBoxStore=JSON.stringify(i)}}})}),define("DS/SNSearchUX/SearchSecondaryMenu",["UWA/Core","UWA/Element","UWA/Controls/Abstract","UWA/Promise","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SNSearchTypeCusto","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/PlatformEnvServices","DS/SNResultUX/utils/ExternalComponentHelpers","DS/UIKIT/DropdownMenu","DS/UIKIT/Input/Toggle","DS/PlatformAPI/PlatformAPI","DS/MessageBus/MessageBus","DS/PubSub/PubSub","DS/UIKIT/SuperModal","i18n!DS/SNSearchUX/assets/nls/SNSearchUX.json","text!DS/SNSearchUX/assets/templates/SearchInformation.html","DS/WebappsUtils/WebappsUtils","DS/SNUQLEditor/SNUQLEditorUX"],function(e,t,i,n,s,o,a,r,c,l,d,u,h,p,g,_,m,S,f,v,C,y,w){"use strict";return i.extend({_secondaryMenu:null,_autocomplete:null,_socket:null,currentMode:null,currentSearch:null,_secondaryOptionToHide:[],searchTabId:null,src_ressource:null,_searchOptionDividerId:"searchOptionDivider",_predefinedQueryDividerId:"predifinedQueryDivider",_inAppContext:!1,_inContextOptions:null,_AsyncSearchDropdownPromise:n.deferred(),_temporarilyOutOfContext:null,init:function(e){this._buildSecondaryMenu(e)},_buildSecondaryMenu:function(t){var i=this;if(e.is(t)&&(this._secondaryOptionToHide=[],e.is(t.socket)&&(this._socket=t.socket),e.is(t)&&e.is(t.secondaryMenuOptions)&&e.is(t.secondaryMenuOptions.hideTenantMenu)&&!0===t.secondaryMenuOptions.hideTenantMenu&&(this.hideTenantMenu=!0),e.is(t.autocomplete)&&e.is(t.target))){this._autocomplete=t.autocomplete,this._autocomplete.secondaryMenu=this,this.currentSearch=v.searchNew;var n=v.get("find_in_tab.shortHelp");"3DSwym"===o.identifyClientInfo().identifier&&(n=v.get("find_in_page.shortHelp"));let s=[];o.identifyClientInfo()&&"3DSwym"===o.identifyClientInfo().identifier?s=[{text:v.searchNew,className:"secondaryMenuSearch",fonticon:"search",title:v.get("search.shortHelp")},{text:v.search_current_tab,className:"secondaryMenuSearchInCurrentTab",fonticon:"filter",title:n},{text:v.adv_search,className:"secondaryMenuAdvanced",fonticon:"search-cog",title:v.get("adv_search.shortHelp")},{id:i._searchOptionDividerId,className:"divider"},{text:v.LastSearchResults,className:"secondaryMenuLastSearch",fonticon:"search-recent",title:v.get("LastSearchResults.shortHelp")},{text:v.MySavedSearches,className:"secondaryMenuFavorite",fonticon:"favorite-on",title:v.get("MySavedSearches.shortHelp")},{text:v.mycontent,className:"secondaryMenuMyContent",fonticon:"user",title:v.get("mycontent.shortHelp")},{id:i._predefinedQueryDividerId,className:"divider"},{text:v.PredefinedQuery,className:"secondaryMenuPQ",fonticon:"help",title:v.get("PredefinedQuery.shortHelp")},{text:v.SearchOptions,className:"secondaryMenuOptions",fonticon:"cog",title:v.get("SearchOptions.shortHelp")},{text:v.get("FUN136528-activate"),className:"secondaryMenuBetaFUN124298",fonticon:"info",title:v.get("FUN136528-activate")}]:o.identifyClientInfo()&&"3DDashboard"===o.identifyClientInfo().identifier?(s=[{text:v.searchNew,className:"secondaryMenuSearch",fonticon:"search",title:v.get("search.shortHelp")},{text:v.informationAction,className:"secondaryMenuInfo",fonticon:"info",title:v.get("info.shortHelp")},{text:v.adv_search,className:"secondaryMenuAdvanced",fonticon:"search-cog",title:v.get("adv_search.shortHelp")},{id:i._searchOptionDividerId,className:"divider"},{text:v.LastSearchResults,className:"secondaryMenuLastSearch",fonticon:"search-recent",title:v.get("LastSearchResults.shortHelp")},{text:v.MySavedSearches,className:"secondaryMenuFavorite",fonticon:"favorite-on",title:v.get("MySavedSearches.shortHelp")},{text:v.mycontent,className:"secondaryMenuMyContent",fonticon:"user",title:v.get("mycontent.shortHelp")},{id:i._predefinedQueryDividerId,className:"divider"},{text:v.PredefinedQuery,className:"secondaryMenuPQ",fonticon:"help",title:v.get("PredefinedQuery.shortHelp")},{text:v.SearchOptions,className:"secondaryMenuOptions",fonticon:"cog",title:v.get("SearchOptions.shortHelp")},{text:v.get("FUN136528-activate"),className:"secondaryMenuBetaFUN124298",fonticon:"info",title:v.get("FUN136528-activate")}],!0===c.getOption("ExpertMode")&&s.push({text:"ExpertQuery",className:"secondaryMenuExpertQuery",fonticon:"text",title:"Expert Query"})):s=[{text:v.searchNew,className:"secondaryMenuSearch",fonticon:"search",title:v.get("search.shortHelp")},{text:v.adv_search,className:"secondaryMenuAdvanced",fonticon:"search-cog",title:v.get("adv_search.shortHelp")},{id:i._searchOptionDividerId,className:"divider"},{text:v.LastSearchResults,className:"secondaryMenuLastSearch",fonticon:"search-recent",title:v.get("LastSearchResults.shortHelp")},{text:v.MySavedSearches,className:"secondaryMenuFavorite",fonticon:"favorite-on",title:v.get("MySavedSearches.shortHelp")},{text:v.mycontent,className:"secondaryMenuMyContent",fonticon:"user",title:v.get("mycontent.shortHelp")},{id:i._predefinedQueryDividerId,className:"divider"},{text:v.PredefinedQuery,className:"secondaryMenuPQ",fonticon:"help",title:v.get("PredefinedQuery.shortHelp")},{text:v.SearchOptions,className:"secondaryMenuOptions",fonticon:"cog",title:v.get("SearchOptions.shortHelp")},{text:v.get("FUN136528-activate"),className:"secondaryMenuBetaFUN124298",fonticon:"info",title:v.get("FUN136528-activate")}],this._secondaryMenu=new p({className:"searchOptionMenu",maxItemsBeforeScroll:50,items:s,position:"bottom left",offset:{y:-3,x:0},target:t.target,closeOnClick:!0,events:{onClick:function(t,n){switch(m.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"dropdownbeta",persDim:{pd14:n.name,pd15:n.className}}}),n.name){case v.searchNew:var s=i._autocomplete._getClearSearchBtn();(""!==i._autocomplete.getInputValue()||e.is(s.isHidden)&&!1===s.isHidden())&&i._searchInCurrentTab(""),i._clickOnSearch(),i._autocomplete._findInthisTabOnClick(!1),""!==i._autocomplete.getInputValue()&&i._onViewSearch();break;case v.search_current_tab:"3DSwym"===o.identifyClientInfo().identifier?(i._clickOnSearchInCurrentTab(),""!==i._autocomplete.getInputValue()&&i._onViewSearch()):i._clickOnInformation();break;case v.informationAction:i._clickOnInformation();break;case v.adv_search:i._clickOnAdvancedSearch(t);break;case v.LastSearchResults:i.clickOnLastSearchResult();break;case v.MySavedSearches:i._clickOnFavoriteSearches(t);break;case v.mycontent:i._clickOnMyContent(t);break;case v.PredefinedQuery:i._autocomplete._showPQSelectionUX();break;case v.SearchOptions:i._clickOnSearchOptions(t);break;case v.get("FUN136528-activate"):i._clickOnSearchBETA(t);break;case"ExpertQuery":console.log("Expert mode query invocked..."),i._launchUQLEditor();break;default:e.is(n.className)&&n.className.contains("secondaryMenuTenant")&&!n.className.contains("Selector")&&(i._autocomplete._setPlaceHolderValue(v.search+" "+n.name),i.src_ressource.setActiveTenant(n.attributes.tenantId),i._updateMenuOnTenantSelection(n.attributes.tenantId),i._autocomplete.options.events.setSourceCStorage(i.getCurrentTenant().tenantId),""!==i._autocomplete.getInputValue()&&i._onViewSearch())}},onShow:function(){},onHide:function(){}}}),this._toggleDropDownMenuItem(v.LastSearchResults,"hide"),(e.is(c.getOption("search_compact_mode"))&&!0===c.getOption("search_compact_mode")||"tablet"===o.getDeviceType()&&"portrait"===o.getViewportOrientation())&&this._setSecondaryHiddenOptionsPermanent([v.adv_search,v.MySavedSearches,v.PredefinedQuery,v.SearchOptions],!0),("3DDashboard"!==o.identifyClientInfo().identifier||c.getOption("addinmode"))&&this._setSecondaryHiddenOptionsPermanent([v.informationAction],!1)}},_launchUQLEditor:function(){new w},_clickOnInformation:function(){var t=this._autocomplete.getInputValue();e.is(t)&&S.dispatch("3DSearch:open3DDSearchInTab",{query:t,submit:!0})},setInContextState:function(e){this._inContext=e},setInAppContext:function(t){if(!1===t.setInAppContext&&(this._inContextOptions=null),this._inAppContext=t.isInAppContext,!0===t.isInAppContext&&e.is(t.data)&&e.is(t.data.search_criteria_to_display,"string")?this._autocomplete.setFieldValue(t.data.search_criteria_to_display):this.currentMode!==v.search_current_tab&&this._autocomplete.setFieldValue(""),t.isInAppContext&&e.is(t.data)&&e.is(t.data.search_criteria))switch(t.data.search_criteria){case o.SearchTypeEnum.MY_CONTENT:this._clickOnMyContent({focus:!1});break;case o.SearchTypeEnum.FAVORITE_SEARCH:this._clickOnFavoriteSearches({focus:!1});break;case o.SearchTypeEnum.ADVANCED_SEARCH:this._clickOnAdvancedSearch({focus:!1})}this._temporarilyOutOfContext=!1},setFindInContext:function(t,i){this._setFindInContext(t),e.is(i)?this._autocomplete._setPlaceHolderValue(i):this._isMenuItemHidden(v.select_tenant)||this._autocomplete._setPlaceHolderValue(v.get("search"))},_setFindInContext:function(t){var i=this;this._autocomplete._internalSearchCriteria=null,this._autocomplete.elements.input.readOnly=!1,e.is(t.widget_id)&&"widget_id_#saved_search_edit#"!==t.widget_id?this._toggleDropDownMenuItem(v.LastSearchResults,"hide"):this.editFavoriteSearchMode(t);var n=!1;t&&t.UXOptions&&!1===t.UXOptions.menuMyFavorites&&(n=!0),n&&this._AsyncSearchDropdownPromise.promise.then(function(){i._toggleDropDownMenuItem(v.MySavedSearches,"hide")});var s=!1;t&&t.UXOptions&&!1===t.UXOptions.menuMyContent&&(s=!0),s&&this._toggleDropDownMenuItem(v.mycontent,"hide"),e.is(t)&&e.is(t.tenant)?(this._autocomplete.options.events.setSourceCStorage(t.tenant),this.setCurrentTenant(t.tenant),this._clickOnSearch({focus:!1})):this._autocomplete.options.events.setSourceCStorage(this.getCurrentTenant());var o=!0;t&&t.advanced_search&&(o=!1,t.advanced_search.exclusive&&this._toggleDropDownMenuItem(v.searchNew,"hide")),o&&this._AsyncSearchDropdownPromise.promise.then(function(){i._toggleDropDownMenuItem(v.adv_search,"hide")});this._AsyncSearchDropdownPromise.promise.then(function(){i._toggleDropDownMenuItem(v.PredefinedQuery,"hide")}),this._inContextOptions=t},restoreAppContext:function(e){if(this._inAppContext&&e&&(!e.in_apps_search||e.in_apps_search.widget_id!==this._inContextOptions.widget_id))return!1;this._autocomplete.elements.suggestsContainer.getChildren().forEach(function(e){e.show()}),e&&e.in_apps_search&&e.in_apps_search.advanced_search&&e.in_apps_search.advanced_search.exclusive&&this._toggleDropDownMenuItem(v.searchNew,"show"),this.setInAppContext({isInAppContext:!1}),this.currentMode===v.searchNew?this._clickOnSearch({focus:!1,noFocus:!0}):this.currentMode===v.search_current_tab&&this.clickOnSearchInTab()},editFavoriteSearchMode:function(t){this._toggleDropDownMenuItem(v.MySavedSearches,"hide"),this._toggleDropDownMenuItem(v.mycontent,"hide"),e.is(t)&&e.is(t.advanced_search)?this._toggleDropDownMenuItem(v.adv_search,"show"):this._toggleDropDownMenuItem(v.adv_search,"hide"),this._toggleDropDownMenuItem(v.PredefinedQuery,"hide"),this._toggleDropDownMenuItem(v.search_current_tab,"hide"),this._toggleDropDownMenuItem(v.searchNew,"show")},_onViewSearch:function(){S.dispatch("onViewSearch")},showLastSearch:function(){this._toggleDropDownMenuItem(v.LastSearchResults,"show")},_switchSearchMode:function(){d.getItem("searchMode")===v.searchNew?this._clickOnSearch():d.getItem("searchMode")===v.search_current_tab&&this._clickOnSearchInCurrentTab()},_searchInCurrentTab:function(t,i){e.is(i)?S.dispatch("SearchQuery",[t,i]):S.dispatch("SearchQuery",[t])},_toggleDropDownMenuItem:function(t,i){if(!(e.is(this._secondaryOptionToHide)&&e.is(this._secondaryOptionToHide.length)&&this._secondaryOptionToHide.length>0&&this._secondaryOptionToHide.indexOf(t)>=0)&&e.is(this._secondaryMenu)&&e.is(this._secondaryMenu.items)){if(e.is(t)){var n=this._findDropDownMenuItem(t);e.is(n)&&e.is(n.elements)&&e.is(i)&&("show"===i?this._showItem(n):"hide"===i&&this._hideItem(n))}var s=this._findDropDownMenuItem(v.LastSearchResults),o=this._findDropDownMenuItem(v.MySavedSearches),a=this._findDropDownMenuItem(v.mycontent),r=this._findDropDownMenuDivider(this._searchOptionDividerId);s.elements.container.isHidden()&&o.elements.container.isHidden()&&a.elements.container.isHidden()?this._hideItem(r):this._showItem(r);var c=this._findDropDownMenuItem(v.PredefinedQuery),l=this._findDropDownMenuDivider(this._predefinedQueryDividerId);c.elements.container.isHidden()?this._hideItem(l):this._showItem(l)}},_hideItem:function(t){var i="";e.is(t)&&e.is(t.className)&&(i=t.className+" ");var n={id:t.id,className:i+"secondaryMenuHidden"};this._secondaryMenu.updateItem(n)},_showItem:function(t){if(e.is(t)&&e.is(t.className)){var i=t.className;i.contains("secondaryMenuHidden")&&(i=i.replace(/secondaryMenuHidden/g,""));var n={id:t.id,className:i};this._secondaryMenu.updateItem(n)}},_isMenuItemHidden:function(t){if(e.is(t)){var i=this._findDropDownMenuItem(t);return!(!e.is(i.className)||!i.className.contains("secondaryMenuHidden"))}return null},_setSecondaryHiddenOptions:function(t){switch(e.is(t)||(t=""),this._toggleDropDownMenuItem(v.MySavedSearches,"show"),this._toggleDropDownMenuItem(v.mycontent,"show"),this._toggleDropDownMenuItem(v.adv_search,"show"),this._toggleDropDownMenuItem(v.Howtosearch,"show"),this._toggleDropDownMenuItem(v.search_current_tab,"show"),this._toggleDropDownMenuItem(v.SearchOptions,"show"),this._toggleDropDownMenuItem(v.PredefinedQuery,"show"),this._toggleDropDownMenuItem(v.SearchBETA,"show"),this.currentSearch===v.search_current_tab?this._toggleDropDownMenuItem(v.PredefinedQuery,"hide"):this._toggleDropDownMenuItem(v.PredefinedQuery,"show"),t){case v.searchNew:this._toggleDropDownMenuItem(v.search_current_tab,"hide");break;case v.MySavedSearches:case v.mycontent:case v.adv_search:this._toggleDropDownMenuItem(v.PredefinedQuery,"hide"),this._toggleDropDownMenuItem(v.search_current_tab,"hide");break;case"inContext":this._toggleDropDownMenuItem(v.search_current_tab,"hide"),this._toggleDropDownMenuItem(v.SearchOptions,"hide"),this._toggleDropDownMenuItem(v.SearchBETA,"hide")}e.is(this._inAppContext)&&!0===this._inAppContext&&(this._toggleDropDownMenuItem(v.SearchOptions,"hide"),this._toggleDropDownMenuItem(v.adv_search,"hide"),this._toggleDropDownMenuItem(v.MySavedSearches,"hide"),this._toggleDropDownMenuItem(v.PredefinedQuery,"hide"),this._toggleDropDownMenuItem(v.SearchBETA,"hide"))},_setSecondaryHiddenOptionsPermanent:function(t,i){if(e.is(i)&&!0===i&&(this._secondaryOptionToHide=[]),e.is(t,"array"))for(var n=0;n<t.length;n++)this._toggleDropDownMenuItem(t[n],"hide"),e.is(this._secondaryOptionToHide)&&this._secondaryOptionToHide.indexOf(t[n])<0&&this._secondaryOptionToHide.push(t[n])},_unsetSecondaryHiddenOptionsPermanent:function(t){if(e.is(t,"array")){for(var i=[],n=0;n<this._secondaryOptionToHide.length;n++)t.includes(this._secondaryOptionToHide[n])||i.push(this._secondaryOptionToHide[n]);this._secondaryOptionToHide=i;for(var s=0;s<t.length;s++)this._toggleDropDownMenuItem(t[s],"show")}},_findDropDownMenuItem:function(t){if(e.is(this._secondaryMenu)&&e.is(this._secondaryMenu.items)){for(var i=0;i<this._secondaryMenu.items.length;i++)if(this._secondaryMenu.items[i].text===t)return this._secondaryMenu.items[i];return{}}},_findDropDownMenuDivider:function(t){if(e.is(this._secondaryMenu)&&e.is(this._secondaryMenu.items)){for(var i=0;i<this._secondaryMenu.items.length;i++)if(this._secondaryMenu.items[i].id===t)return this._secondaryMenu.items[i];return{}}},initTenantOnSecondaryMenu:function(t){if(e.is(this._secondaryMenu)&&e.is(t.sources)){this.src_ressource=new a(t.sources);for(var i=this.src_ressource.getAvailableTenants(),n=this._findDropDownMenuItem(v.select_tenant),s=0;s<i.length;s++)this.src_ressource.active_tenant===i[s].tenantId&&i.length>1&&(this._autocomplete._setPlaceHolderValue(v.search+" "+i[s].displayName),this._autocomplete.setSelectedTenant(i[s].tenantId));if(i.length<=1&&(this._toggleDropDownMenuItem(v.Wheretosearch,"hide"),this._toggleDropDownMenuItem(v.select_tenant,"hide"),1===i.length&&e.is(n)&&e.is(n.elements)&&e.is(n.elements.container)&&e.is(n.elements.container.setAttribute,"function"))){let s=i[0].tenantId;n.elements.container.setAttribute("activetenant",s),e.is(t)&&e.is(t.sources)&&e.is(t.sources.available_tenants,"object")&&e.is(t.sources.available_tenants[s])&&e.is(t.sources.available_tenants[s].displayName)&&n.elements.container.setAttribute("activetenantnls",t.sources.available_tenants[s].displayName)}var r=this;e.is(this.hideTenantMenu)&&!0===this.hideTenantMenu&&this._setSecondaryHiddenOptionsPermanent([v.select_tenant]),o.isRoleAvailable(["CSV"],this.src_ressource.active_tenant,function(e){!0!==e&&r._setSecondaryHiddenOptionsPermanent([v.adv_search,v.MySavedSearches,v.PredefinedQuery,v.SearchOptions]),r._AsyncSearchDropdownPromise.resolve()}),v.search_current_tab===d.getItem("searchMode")&&o.identifyClientInfo()&&"3DDashboard"!==o.identifyClientInfo().identifier?this._clickOnSearchInCurrentTab():this._clickOnSearch()}},isSingleTenant:function(){return!(u.getAvailableTenantsForSearch().length>1)},getCurrentTenant:function(){if(e.is(this.src_ressource)){var t=this.src_ressource.getAvailableTenants();if(this._isMenuItemHidden(v.select_tenant)&&1===t.length){if(e.is(t[0].name))var i={tenantId:t[0].tenantId,tenantName:t[0].name};else i={tenantId:t[0].tenantId,tenantName:t[0].displayName};return i}for(var n=0;n<t.length;n++)if(t[n].tenantId===this.src_ressource.getActiveTenant())return{tenantId:t[n].tenantId,tenantName:t[n].displayName}}return{tenantId:null,tenantName:null}},setCurrentTenant:function(t){if(!this._isMenuItemHidden(v.select_tenant))for(var i=0;i<this._secondaryMenu.items.length;i++)if(e.is(this._secondaryMenu.items[i].attributes)&&e.is(this._secondaryMenu.items[i].attributes.tenantId)&&this._secondaryMenu.items[i].attributes.tenantId===t)return void this._secondaryMenu.toggleSelection(this._secondaryMenu.items[i]);this.src_ressource.setActiveTenant(t)},_manageSecondaryMenuOptions:function(t){var i=[];e.is(t)&&(e.is(t.enable_my_content)&&!1===t.enable_my_content&&i.push(v.mycontent),e.is(t.enable_favorite_searches)&&!1===t.enable_favorite_searches&&i.push(v.MySavedSearches),e.is(t.enable_search_in_this_tab)&&!1===t.enable_search_in_this_tab&&i.push(v.search_current_tab),e.is(t.enable_predefined_query)&&!1===t.enable_predefined_query&&this._toggleDropDownMenuItem(v.PredefinedQuery)),this._setSecondaryHiddenOptionsPermanent(i)},setSelectedPQPrefix:function(e){this._autocomplete._internalSearchCriteria=null,this._autocomplete.setFieldValue(e),this._autocomplete.elements.input.focus(),!0===this._autocomplete._pqSelect&&this._clickOnSearch({focus:!1}),this._autocomplete._pqSelect=!1},_clickOnMyRecentContent:function(t){this._autocomplete._myRecentContentIsActive=!0;this._clickOnSearch({focus:!1});var i="*";!t||"*"===t.paramsFilter||this._autocomplete.getPlaceHolder()!==v.searchNew&&this._autocomplete.getPlaceHolder()!==v.get("myrecentcontent")||(i=this._autocomplete.getInputValue()?this._autocomplete.getInputValue():t.paramsFilter,this._autocomplete.setFieldValue(i)),this._autocomplete._setInternalCriteria(null),this._autocomplete.options.events.setSourceCStorage(this.getCurrentTenant().tenantId),e.is(t,"object")&&e.is(t.focus)&&!1===t.focus||(e.is(t)?this._autocomplete.dispatchEvent("myRecentContent",{sFilter:i,widgetId:t.widgetId}):this._autocomplete.dispatchEvent("myRecentContent",{sFilter:i}))},setSearchMode:function(t){var i={focus:!1};this.currentMode===v.searchNew&&this._isMenuItemHidden(v.select_tenant)?this._clickOnSearch(i):(this.currentMode!==v.searchNew||this._isMenuItemHidden(v.select_tenant))&&(this.currentMode===v.search_current_tab?(e.is(t.noFocus)&&(i=null),this._clickOnSearchInCurrentTab(i)):this.currentMode===v.adv_search?this._clickOnAdvancedSearch(i):this.currentMode===v.mycontent?this._clickOnMyContent(i):this.currentMode===v.MySavedSearches&&this._clickOnFavoriteSearches(i))},selectTenantOnTabActivation:function(t){if(e.is(t,"object")&&e.is(t.tenant,"string")&&t.tenant.length>0){if("OnPremise"===t.tenant||this._isMenuItemHidden(v.select_tenant))return;this.setCurrentTenant(t.tenant),d.setItem("defaultTenantId",t.tenant),d.commit(),this._updateMenuOnTenantSelection(t.tenant)}},_updateMenuOnTenantSelection:function(t){var i=this;o.isRoleAvailable(["CSV"],t,function(t){!0===t?i._inAppContext?(e.is(i._inContextOptions)&&e.is(i._inContextOptions.advanced_search)?i._toggleDropDownMenuItem(v.adv_search,"show"):i._toggleDropDownMenuItem(v.adv_search,"hide"),e.is(i._inContextOptions)&&e.is(i._inContextOptions.UXOptions)&&!1===i._inContextOptions.UXOptions.menuMyFavorites?i._toggleDropDownMenuItem(v.MySavedSearches,"hide"):i._toggleDropDownMenuItem(v.MySavedSearches,"show"),i._toggleDropDownMenuItem(v.PredefinedQuery,"hide")):!0!==c.getOption("search_compact_mode")&&i._unsetSecondaryHiddenOptionsPermanent([v.adv_search,v.MySavedSearches,v.PredefinedQuery,v.SearchOptions]):i._setSecondaryHiddenOptionsPermanent([v.adv_search,v.MySavedSearches,v.PredefinedQuery,v.SearchOptions])})},setCurrentMode:function(e){if(this.currentMode=e,o.isODTMode())switch(e){case v.searchNew:this._autocomplete.elements.input.setAttribute("currentMode","search");break;case v.search_current_tab:this._autocomplete.elements.input.setAttribute("currentMode","searchInCurrentTab");break;case v.adv_search:this._autocomplete.elements.input.setAttribute("currentMode","advancedSearch");break;case v.MySavedSearches:this._autocomplete.elements.input.setAttribute("currentMode","favoriteSearch");break;case v.mycontent:this._autocomplete.elements.input.setAttribute("currentMode","myContent")}},_clickOnSearchOptions:function(t){var i=this;e.is(t)&&e.is(t.stopPropagation,"function")&&t.stopPropagation(),require(["DS/SNResultUX/views/utils/SearchOptionsUI"],function(e){new e({tenant:i.getCurrentTenant()})})},_clickOnSearchBETA:function(e){new f({renderTo:document.body,className:"search-beta-warning-reload-page",okButtonText:"OK"}).confirm(v.get("FUN136528-modal-text-activate"),v.get("FUN136528-modal-title-activate"),function(e){!0===e&&(m.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"dropdownbeta",persDim:{pd16:"activate",pd18:"activate"}}}),d.setItem("BETA-FUN136528",!0),d.commit(),location.reload())}.bind(this))},_clickOnSearch:function(t){this.setCurrentMode(v.searchNew),this.currentSearch=v.searchNew;var i=!1;if(e.is(t)&&e.is(t.resetNLS)&&(i=!0),this._autocomplete._adv_Search_activated=!1,d.setItem("searchMode",v.searchNew),d.commit(),this._inAppContext||(this._toggleDropDownMenuItem(v.PredefinedQuery,"show"),this._toggleDropDownMenuItem(v.MySavedSearches,"show")),this._toggleDropDownMenuItem(v.mycontent,"show"),e.is(t)&&e.is(t.hiddenOptions))for(let e=0;e<t.hiddenOptions.length;e++)this._toggleDropDownMenuItem(t.hiddenOptions[e],"hide");this._autocomplete.getPlaceHolder()!==this._autocomplete._findInTabNLS&&(this._autocomplete._isTypeListDone=!0,t={adv_search_field:this._isTypeValue,focus:!1});if(0===this._autocomplete._typeList.length&&(this._autocomplete._typeList=l.getSearchTypeCustoList()),this._autocomplete._isTypeListMode&&this._autocomplete._isTypeListDone&&this._autocomplete._typeList.length&&-1!==this._autocomplete._typeList.indexOf(t.adv_search_field))return this._clickOnAdvancedSearch(t),this._autocomplete._isTypeListMode=!1,void(this._autocomplete._isTypeListDone=!1);this._autocomplete._setInternalCriteria(null),this._autocomplete.elements.input.readOnly=!1,e.is(t,"object")&&e.is(t.focus)&&!0!==t.focus||this._autocomplete.elements.input.focus(),""===this._autocomplete.getInputValue()&&this._autocomplete.hideClearSearchButton();var n=v.get("search");if(e.is(this.src_ressource)&&this.src_ressource.getAvailableTenants().length>1){var s=this.getCurrentTenant();e.is(s)&&e.is(s.tenantName)&&(n+=" "+s.tenantName)}else n=v.get("searchNew");this._autocomplete._setPlaceHolderValue(n),(e.is(this.src_ressource)&&!e.is(t,"object")||!e.is(t.setTenant)||!1!==t.setTenant)&&this._autocomplete.options.events.setSourceCStorage(this.getCurrentTenant().tenantId);var o=this._autocomplete.getInputValue();i&&(o=""),this._autocomplete.setFieldValue(o)},_clickOnSearchInCurrentTab:function(t){e.is(t)?(e.is(t.name)&&(this._autocomplete._setPlaceHolderValue(v.replace(v.get("find_in_specific_tab"),{tab:t.name})),this._autocomplete._changeSearchBtnIcon("fonticon-filter")),e.is(t.id)&&(this.searchTabId=t.id)):(this._autocomplete._setPlaceHolderValue(v.search_current_tab),this._autocomplete._changeSearchBtnIcon("fonticon-filter")),!0===this._autocomplete.betaProgramState&&this._autocomplete._clearDropDown(),this.setCurrentMode(v.search_current_tab),this.currentSearch=v.search_current_tab,d.setItem("searchMode",v.search_current_tab),d.commit(),this._toggleDropDownMenuItem(v.PredefinedQuery,"hide"),this._autocomplete._findInthisTabOnClick(!0)},clickOnLastSearchResult:function(){this.setCurrentMode(v.searchNew),this.currentSearch=v.searchNew,this._autocomplete.setFieldValue(""),this._autocomplete._setPlaceHolderValue(v.searchNew),this._autocomplete.hideClearSearchButton(),this._autocomplete.dispatchEvent("onSelect",["","LastSearch"]),this._inAppContext||(this._toggleDropDownMenuItem(v.mycontent,"show"),this._toggleDropDownMenuItem(v.MySavedSearches,"show"),this._clickOnSearch({focus:!1}))},_clickOnAdvancedSearch:function(t){this.setCurrentMode(v.adv_search),this._setSecondaryHiddenOptions(v.adv_search),this._autocomplete._setInternalCriteria(null),this._autocomplete._adv_Search_activated=!0;var i=v.adv_search;e.is(this.src_ressource)&&this.src_ressource.getAvailableTenants().length>1&&(i+=" "+this.getCurrentTenant().tenantName),this._autocomplete._setPlaceHolderValue(i),this._autocomplete.setFieldValue(""),this._autocomplete.elements.input.readOnly=!0,e.is(t,"object")&&e.is(t.setTenant)&&!1===t.setTenant||this._autocomplete.options.events.setSourceCStorage(this.getCurrentTenant().tenantId),e.is(t)&&e.is(t.adv_search_field,"string")&&t.adv_search_field.length>0?this._autocomplete.dispatchEvent("advancedSearch",t.adv_search_field):e.is(t,"object")&&e.is(t.focus)&&!1===t.focus||this._autocomplete.dispatchEvent("advancedSearch")},_clickOnMyContent:function(t){this.setCurrentMode(v.mycontent),this._setSecondaryHiddenOptions(v.mycontent),this._autocomplete._setInternalCriteria(null);var i=v.mycontent;e.is(this.src_ressource)&&this.src_ressource.getAvailableTenants().length>1&&(i+=" "+this.getCurrentTenant().tenantName),this._autocomplete._setPlaceHolderValue(i),this._autocomplete.setFieldValue(""),this._autocomplete.hideClearSearchButton(),this._autocomplete.elements.input.readOnly=!0,e.is(t,"object")&&e.is(t.setTenant)&&!1===t.setTenant||this._autocomplete.options.events.setSourceCStorage(this.getCurrentTenant().tenantId),e.is(t,"object")&&e.is(t.focus)&&!1===t.focus||this._autocomplete.dispatchEvent("myContent")},_clickOnFavoriteSearches:function(t){this.setCurrentMode(v.MySavedSearches),this._setSecondaryHiddenOptions(v.MySavedSearches),this._autocomplete._setInternalCriteria(null);var i=v.MySavedSearches;e.is(this.src_ressource)&&this.src_ressource.getAvailableTenants().length>1&&(i+=" "+this.getCurrentTenant().tenantName),this._autocomplete._setPlaceHolderValue(i),this._autocomplete.setFieldValue(""),this._autocomplete.hideClearSearchButton(),this._autocomplete.elements.input.readOnly=!0,m.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"manualSwitchToView",data:{view:d.getItem("LastSearchViewMode")}}),e.is(t,"object")&&e.is(t.setTenant)&&!1===t.setTenant||this._autocomplete.options.events.setSourceCStorage(this.getCurrentTenant().tenantId),e.is(t,"object")&&e.is(t.focus)&&!1===t.focus||this._autocomplete.dispatchEvent("favoriteSearches")}})}),define("DS/SNSearchUX/helpers/SmartQueryController",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Debug","UWA/Element","UWA/Promise","DS/PubSub/PubSub","DS/MessageBus/MessageBus","DS/Controls/SelectionChipsEditor","DS/Controls/LineEditor","DS/Controls/Button","DS/SNSmartQuery/SNSmartQuery","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/Logger","DS/SNInfraUX/keywords/SNKeywordManager","DS/SNInfraUX/SearchUtils","DS/SNResultUX/utils/ExternalComponentHelpers","DS/SNResultUX/utils/SearchServices","DS/SNSearchUX/helpers/SmartQueryUtils","DS/SNSearchUX/helpers/SmartspeechUtils","DS/SNSearchUX/dropdown/SearchDropDownUtils","i18n!DS/SNSearchUX/assets/nls/GuidedMode.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o,a,r,c,l,d,u,h,p,g,_,m,S,f,v,C,y,w){"use strict";return t.extend(i,n,{_smartQuery:null,_listOfsuggestions:[],_listOfAppssuggestions:[],_listOfFreesuggestions:[],_SelectionChipsEditor:null,_container:null,_dropdown:null,_lastchip:null,_lastvalue:"",_father:null,_bresultFound:!1,_lastIndex:-1,_contentSpeech:null,_speechRecognition:null,_speechstart:0,_compassApp:!1,_selectedChip:null,_apply:null,_clearbutton:null,_appsContainer:null,_freeContainer:null,_lastselectedIndex:-1,_computesug:!1,_inEdition:!1,_inEditionEnter:!1,_pressEnter:!1,_lastPosIndexInEditor:-1,_buildQuerySearchTimeout:0,_containerinput:null,_containersuggestion:null,_containerresult:null,_containerinstantSearch:null,_containerinstantSearchEmptyView:null,_containerinstantSearchEmpty:null,_dropdownFull:!1,_buildListOfTypesDone:!1,_mainLayoutSimplified:!0,_maxToDisplay:5,_tosave:!1,_inContextMode:!1,init:function(t){this.setDebugMode(h.getDebugMode()),this.setOptions(t),this._smartQuery=new u,this._dropdown=t.dropdown?t.dropdown:null,this._container=t.container?t.container:null,this._father=t.smartQueries?t.smartQueries:null,this._containerinput=t.containerinput?t.containerinput:null,this._containersuggestion=t.containersuggestion?t.containersuggestion:null,this._containerresult=t.containerresult?t.containerresult:null,this._containerinstantSearch=t.instantSearch?t.instantSearch:null,this._containerinstantSearchEmptyView=t.instantSearchEmptyView?t.instantSearchEmptyView:null,this._containerinstantSearchEmpty=t.instantSearchEmpty?t.instantSearchEmpty:null,this._bresultFound=!1,this._lastIndex=-1,this._contentSpeech=null,this._speechRecognition=null,this._speechstart=0,this._compassApp=!1,this._selectedChip=null,this._apply=null,this._clearbutton=null,this.sections=["commTag","user","optr","type","intf","tags","clat","keys","tagv"];for(let e=0;e<this.sections.length;e++)this["_"+this.sections[e]+"Container"]=null;this._appsContainer=null,this._freeContainer=null,this._computesug=!1,this._inEdition=!1,this._inEditionEnter=!1,this._pressEnter=!1,this._lastselectedIndex=-1,this._lastPosIndexInEditor=-1,this._buildQuerySearchTimeout=0,this._dropdownFull=!!t.dropdownFull&&t.dropdownFull,this._buildListOfTypesDone=!1,this._tosave=!1,this._inContextMode=!1,f.setController(this),!1===this._dropdownFull&&C.setController(this),e.is(this._containerinstantSearchEmptyView)||(this._containerinstantSearchEmptyView=this._dropdown.elements.instantSearchEmptyView),e.is(this._containerresult)||(this._containerresult=this._dropdown.elements.searchResultsContainer),f.setdropdownFull(this._dropdownFull)},computeSmartQuery:function(t){let i=this;return p.log("SmartQueryController::computeSmartQuery parameters: ",t),new o(function(n,s){if(e.is(i._smartQuery)&&e.is(t)&&e.is(t.value)){let s=t.value;e.is(s)&&(p.log("SmartQueryController::computeSmartQuery computeSmartQuery: ",s),i._buildSuggestion(n,s,void 0,500,t))}else s(new Error("SmartQueryController error inputs values"))})},onSetSuggestion:function(t,i){let n=this;return p.log("SmartQueryController::onSetSuggestion",t),new o(function(s,o){if(e.is(n._smartQuery)&&e.is(t)){let t=i;if(e.is(t)){let i={selection:t,at:n._lastPosIndexInEditor>0?n._lastPosIndexInEditor-1:0,addParenthesis:!0},a=n._smartQuery.setSuggestion(i);if(e.is(a)){let i=a.suggestionToken;i.suggestion=t,e.is(i.value)||(i.value=t.displayValue),e.is(t.appInfos)&&(i.appInfos=t.appInfos),e.is(t.data)&&(i.data=t.data),e.is(t.dataTypes)&&(i.dataTypes=t.dataTypes),p.log("SmartQueryController::onSetSuggestion resolve: ",a),!0===a.refresh?n._refreshSuggestion():n._buildSuggestion(s)}else o(new Error("SmartQueryController onSetSuggestion error inputs values"))}else o(new Error("SmartQueryController onSetSuggestion error inputs values"))}else o(new Error("SmartQueryController onSetSuggestion error inputs values"))})},_refreshSuggestion:function(){let t=this,i={chipsEditor:t._SelectionChipsEditor,smartQuery:t._smartQuery,controller:t,buildTweaker:t._buildTweaker},n=f.buildChipsFromsmartQuery(i),s=!0;if(e.is(n)){"CLOSE_PARENT"===n.chipOptions.suggestion.type&&(s=!1)}if(t._SelectionChipsEditor.placeholder=y.get("smart.mode.holder"),t._lastPosIndexInEditor=s?t._smartQuery.length()+1:t._smartQuery.length()-1,t._lastvalue="",t._SelectionChipsEditor._lineEditor.value="",t._SelectionChipsEditor._lineEditor.valueToCommit="",t._selectedChip=null,t._addAfterEditor(t._lastPosIndexInEditor),!1===s){let e=t._SelectionChipsEditor._selectionChips;e&&e._lastWidgetDiv.removeClassName("between"),setTimeout(function(){e&&e._lastWidgetDiv.addClassName("edition")},100)}t._lastchip=n,t._buildSuggestion();let o=f.foundCloseparenthesis(n,!0);t._checkToEnableDisableSearch(o),e.is(t._clearbutton)&&(t._clearbutton.disabled=!1)},_buildSuggestion:function(t,i,n,s,o){p.log("SmartQueryController::_buildSuggestion value: ",i);let a=this,r=i;a._compassApp=!1,a._lastIndex=-1;let c=a._lastPosIndexInEditor,l=e.is(n)?n:c,d=a._lastPosIndexInEditor>=0&&a._smartQuery.getAt(a._lastPosIndexInEditor);if(c>=0){p.log("SmartQueryController::_buildSuggestion Size of _smartQuery: ",a._smartQuery.length());let t="";if(null!==a._selectedChip){t=a._selectedChip.suggestion&&a._selectedChip.suggestion.displayValue;for(let i=0;i<c;i++){let n=a._smartQuery.getAt(i);e.is(n)&&t===n.displayValue&&(d=n,l=i,i=c,p.log("SmartQueryController::_buildSuggestion Found display Name : ",t))}}}if(e.is(d)){let i=d.type;if("KEYWORD"===i){if(p.log("type === KEYWORD"),"ApplicationsFromCompass"===g.getKeywordQuery(d.value.toUpperCase())){p.log("SmartQueryController::_buildSuggestion Keyword === ApplicationsFromCompass"),a._compassApp=!0;let i={query:"",oncomplete:function(i){a._cleanlistOf(),f.clearcontainer(a._containersuggestion?a._containersuggestion:a._dropdown.elements.customSuggestions);let n={dropdown:a._dropdown,controller:a,showall:!0,suggestions:i,container:a._appsContainer,classname:"section-content-Apps",nls:"smart.mode.section.App",font:"fonticon-app"};f.populateAppsSection(n),a._compassApp=!0,a._listOfsuggestions=i,e.is(t)&&(p.groupCollapsed("SmartQueryController::_buildSuggestion populateAppsSection"),p.info("SmartQueryController::_buildSuggestion populateAppsSection : ",i),p.groupEnd("SmartQueryController::_buildSuggestion populateAppsSection"),t(i))}};f.getApps(i)}}else if("USER_TEXT"===i){let t=d.appInfos;e.is(t)?(a._compassApp=!0,a._displayApp(t)):"("===d.value&&(d.value===r&&(r=""),l--)}}if(!1===a._compassApp&&!1===a._computesug){let n=e.is(s)?s:100;clearTimeout(a._getSuggestionsTimeout),a._getSuggestionsTimeout=setTimeout(function(){C._mask(a._containersuggestion?a._containersuggestion:a._dropdown.elements.customSuggestions),a._computesug=!0,p.log("SmartQueryController::_buildSuggestion index",l),a._smartQuery.getSuggestions(l>=0?l:0,r).then(n=>{a._computesug=!1,a._cleanlistOf(),a._listOfsuggestions=n,f.buildCategories({controller:a,suggestions:n,value:i}),a._populateSuggestions(a._listOfsuggestions,i,e.is(o)&&e.is(o.historyOnly)?o.historyOnly:void 0),C._unmask(a._containersuggestion?a._containersuggestion:a._dropdown.elements.customSuggestions),e.is(t)&&t(n),p.groupCollapsed("******** SmartQueryController::_buildSuggestion getSuggestions ********"),p.info("SmartQueryController::_buildSuggestion getSuggestions for index: ",l),p.info("SmartQueryController::_buildSuggestion getSuggestions for value: ",i),p.info("SmartQueryController::_buildSuggestion _smartQuery: ",a._smartQuery._query),p.info("SmartQueryController::_buildSuggestion chips: ",a._SelectionChipsEditor._selectionChips._items),p.info("SmartQueryController::_buildSuggestion current index: ",a._lastPosIndexInEditor),p.info("SmartQueryController::_buildSuggestion getSuggestions: ",n),p.groupEnd("******** SmartQueryController::_buildSuggestion getSuggestions ********")},function(){a._cleanlistOf(),a._populateSuggestions(),a._computesug=!1,C._unmask(a._containersuggestion?a._containersuggestion:a._dropdown.elements.customSuggestions),p.log("SmartQueryController::_buildSuggestion Error")})},n)}},getmainLayoutSimplified:function(){return this._mainLayoutSimplified},clean:function(t,i){p.log("SmartQueryController::clean");let n=this;n._smartQuery&&e.is(n._smartQuery.destroy,"function")&&n._smartQuery.destroy(),n._smartQuery=new u(i),n._SelectionChipsEditor&&n._SelectionChipsEditor._selectionChips.removeAllChips(),n._SelectionChipsEditor._lineEditor.value="",n._SelectionChipsEditor._lineEditor.valueToCommit="",n._cleanlistOf(),e.is(t)||n.setStartFullDropdown(),f.clean(),n._lastchip=null,n._bresultFound=!1,n._lastIndex=-1,n._compassApp=!1,n._lastselectedIndex=-1,n._computesug=!1,n._inEdition=!1,n._inEditionEnter=!1,n._pressEnter=!1,n._lastPosIndexInEditor=-1,n._dropdownFull&&n._dropdown&&n._dropdown.setInputValue(n._lastvalue),n._moveEditortoEnd(),n._buildListOfTypes(),n._statusOK(),e.is(n._clearbutton)&&(n._clearbutton.disabled=!0),e.is(n._apply)&&n._DisableSearch(!0),n.focusEditor()},_cleanlistOf:function(){p.log("SmartQueryController::_cleanlistOf"),this._listOfsuggestions=[],this._listOfAppssuggestions=[],this._listOfFreesuggestions=[];for(let e=0;e<this.sections.length;e++)this["_"+this.sections[e]+"List"]=[]},render:function(t){if(!e.is(t))return;let i=this,n=s.create("div",{class:"smart-queries-editor"}).inject(t);i._initSelectionChipsEditor(),e.is(i._SelectionChipsEditor)&&i._SelectionChipsEditor.inject(n);let o=i._SelectionChipsEditor.getContent()&&i._SelectionChipsEditor.getContent().getChildren()[0],a=s.create("div",{class:"smart-queries-editor-speech"}).inject(o);"webkitSpeechRecognition"in window&&!0===h.getOption("smart_speech")?(i._contentSpeech=s.create("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-microphone wux-ui-3ds",styles:{fontSize:"24px"}}).inject(a),i._contentSpeech.addEvent("click",function(e){i._speech()}.bind(i))):a.hide();let r=s.create("div",{class:"smart-queries-search-clean"}).inject(i._SelectionChipsEditor.getContent()),c=s.create("div",{class:"smart-queries-search-save"}).inject(i._SelectionChipsEditor.getContent());i._savebutton=new d({label:y.get("smart.mode.save"),icon:{iconName:"pin",fontIconFamily:WUXManagedFontIcons.Font3DS},touchMode:"true",displayStyle:"lite",emphasize:"primary",disabled:!0,onClick:function(e){i._save()}.bind(i)}).inject(c),m.tooltip(i._savebutton,{title:_.escapeHtml(y.get("smart.mode.save.pin")),position:"bottom",reshowDelay:2.5,mouseRelativePosition:!0,longHelp:_.escapeHtml(y.get("smart.mode.save.pin.LongHelp"))}),i._savebutton.getContent().setAttributeNode(document.createAttribute("touch-mode")),i._apply=new d({label:y.get("smart.mode.apply"),icon:{iconName:"search",fontIconFamily:WUXManagedFontIcons.Font3DS},touchMode:"true",emphasize:"primary",disabled:!0,onClick:function(e){i._applySearch()}.bind(i)}).inject(c),i._apply.getContent().setAttributeNode(document.createAttribute("touch-mode")),i._clearbutton=new d({label:y.get("smart.mode.clear"),icon:{iconName:"trash",fontIconFamily:WUXManagedFontIcons.Font3DS},touchMode:"true",displayStyle:"lite",emphasize:"primary",disabled:!0,onClick:function(e){i._SelectionChipsEditor._selectionChips.removeAllChips(),i.clean()}.bind(i)}).inject(r),i._clearbutton.getContent().setAttributeNode(document.createAttribute("touch-mode")),m.tooltip(i._clearbutton,{title:_.escapeHtml(y.get("smart.mode.clear")),position:"bottom",reshowDelay:2.5,mouseRelativePosition:!0,longHelp:_.escapeHtml(y.get("smart.mode.clear.LongHelp"))});let l=n.querySelector("input");return e.is(l)&&l.addEventListener("keydown",i._inputEditorkeydown.bind(i)),e.is(i._containerinput)&&i._updateUI(),n},_initSelectionChipsEditor:function(){let t=this;e.is(t._SelectionChipsEditor)||(t._SelectionChipsEditor=new c({placeholder:y.get("smart.mode.holder"),selection:{toggle:!1,unselectAllOnEmptyArea:!1},touchMode:!0,customValidator:function(i){e.is(i)&&i.length&&t._SelectionChipsEditor._lineEditor&&(t._SelectionChipsEditor._lineEditor.value=i,t._SelectionChipsEditor._lineEditor.valueToCommit=i)}}),t._SelectionChipsEditor.getContent().setAttributeNode(document.createAttribute("touch-mode")),t._SelectionChipsEditor._getElementToFocus().addEventListener("focus",t._clickOnChipsEditor.bind(t)),t._SelectionChipsEditor.addEventListener("click",t.focusEditor.bind(t)),t._SelectionChipsEditor.addEventListener("onPostRemove",t._ChipChange.bind(t)),t._SelectionChipsEditor._lineEditor.addEventListener("uncommittedChange",t._inputEditoruncommittedChange.bind(t)),t._SelectionChipsEditor._lineEditor.addEventListener("change",t._inputEditorchange.bind(t)),f.addsuggestionTab({controller:t,container:t._SelectionChipsEditor._lineEditor.getContent()}))},_clickOnChipsEditor:function(t){let i=this;e.is(i._dropdown)&&(p.log("SmartQueryController::_clickOnChipsEditor"),i._dropdown.noBlur=!0,i._dropdown.noFocus=!0,!0===i._inEdition&&(i.clickOnChipsEditorTimeout&&clearTimeout(i.clickOnChipsEditorTimeout),i.clickOnChipsEditorTimeout=setTimeout(function(){i._ChipEditionClose(!0),null!==i._selectedChip&&(i._selectedChip=null,i._computesug=!1,i.buildQuerySearch(),i._buildSuggestion()),i._SelectionChipsEditor._selectionChips.unselectAllChips()},150)))},_buildListOfTypes:function(){let t=this;if(p.log("SmartQueryController::_buildListOfTypes"),!e.is(t._smartQuery))return;let i=t._smartQuery.length(),n=t._listOfsuggestions.length;0===i&&0===n&&(f.setMaxToDisplay(t._maxToDisplay),t.computeSmartQuery({value:"",historyOnly:!0}).then(function(){t._buildListOfTypesDone=!0,C.showhidehistoryContainer(t._historyList.length>0)}))},_inputEditorchange:function(t){let i=this;e.is(i._dropdown)&&(t.stopPropagation(),i.inputEditorchangeTimeout&&clearTimeout(i.inputEditorchangeTimeout),i.inputEditorchangeTimeout=setTimeout(function(){let n=t.dsModel;e.is(n)&&!1===i._pressEnter&&e.is(n.value)&&0===n.value.length&&e.is(n.valueToCommit)&&0===n.valueToCommit.length&&(p.groupCollapsed("SmartQueryController::_inputEditorchange"),p.log("SmartQueryController::_inputEditorchange _buildSuggestion"),i._buildSuggestion(),p.groupEnd()),i._pressEnter=!1},300))},_inputEditoruncommittedChange:function(t){let i=this;if(e.is(i._dropdown)&&(t.stopPropagation(),p.log("SmartQueryController::_inputEditoruncommittedChange"),e.is(t.options)&&e.is(t.options.uncommittedValue))){let n=t.options.uncommittedValue;if(e.is(n,"string")){if(f.hidesuggestionTab({controller:i}),p.log("SmartQueryController::_inputEditoruncommittedChange: ",n),!1===i._compassApp){let e=n.length;0===e?0===i._smartQuery.length()?(i._listOfsuggestions=[],i._buildListOfTypes(),i.setStartFullDropdown(),i._DisableSearch(!0)):i._buildSuggestion():(0===i._smartQuery.length()?e>2?i._DisableSearch(!1):i._DisableSearch(!0):i._DisableSearch(!1),i.populateFromKeyUpSuggestions(n))}else{let e={query:n,oncomplete:function(e){i._cleanlistOf(),f.clearcontainer(i._containersuggestion?i._containersuggestion:i._dropdown.elements.customSuggestions);let t={dropdown:i._dropdown,controller:i,showall:!0,suggestions:e,container:i._appsContainer,classname:"section-content-Apps",nls:"smart.mode.section.App"};f.populateAppsSection(t),i._listOfsuggestions=e,i._mouveOnElement(n)}};f.getApps(e)}i._buildListOfTypesDone=!1,i._lastvalue=n}else!1===i._buildListOfTypesDone&&(i._listOfsuggestions=[],i._buildListOfTypes(),f.hidesuggestionTab({controller:i}),i.setStartFullDropdown());i._dropdownFull&&i._dropdown&&i._dropdown.setInputValue(i._lastvalue)}},_inputEditorkeydown:function(t){let i=this;if(!e.is(i._dropdown))return;t.stopPropagation();let n=!1,s=i._listOfsuggestions.length,o=i._SelectionChipsEditor._selectionChips&&i._SelectionChipsEditor._selectionChips._items.length,a=o-1;if(e.is(t.code)){let r=t.key;if(p.log("SmartQueryController::_inputEditorkeydown: ",r),16===t.keyCode)return;if("Enter"===r||"Tab"===r){i._pressEnter=!0;let e=i._lastvalue;if(0===e.length&&i._lastIndex<0)return void i._applySearch();let t=void 0,n=(i._containersuggestion?i._containersuggestion:i._dropdown.elements.customSuggestions).querySelector(".hover");n&&(e=n.title,t=n.type),i._createFromInput(e,t),i._lastvalue="","Enter"===r&&null===i._selectedChip&&i.focusEditor()}else if("ArrowUp"===r)i._lastIndex--,n=!0,i._lastIndex<0&&i._lastPosIndexInEditor--;else if("ArrowLeft"===r)i._lastIndex--,n=!0,i._lastIndex<0&&i._lastPosIndexInEditor--;else if("ArrowDown"===r)n=!0,i._lastIndex++,i._lastIndex<0&&(i._lastPosIndexInEditor++,i._lastPosIndexInEditor<=a&&(i._lastIndex=0));else if("ArrowRight"===r)n=!0,i._lastIndex++,i._lastIndex<=0&&(i._lastPosIndexInEditor++,i._lastPosIndexInEditor<=a&&(i._lastIndex=-1),i._lastPosIndexInEditor>a&&i._moveEditortoEnd(!0,!0));else if("Escape"===r)i._onEscape();else if("Backspace"!==r&&"Delete"!==r||""!==i._SelectionChipsEditor._lineEditor.valueToCommit){if("?"===r&&!0===i._dropdownFull)return C._manageSettingsHelp({helps:!0}),C._SearchDropDownPQs.elements.specialCharactersExpander.getContent().dispatchEvent(new Event("collapse")),void C._SearchDropDownPQs.elements.typeShortcutsExpander.getContent().dispatchEvent(new Event("expand"));i._managecusorEdition()}else{let t=i._lastPosIndexInEditor>0?i._lastPosIndexInEditor-1:0;if(t>=0&&o>t){e.is(i._selectedChip)&&(t=i._selectedChip.index),i._SelectionChipsEditor._selectionChips.removeChip(t),i._removeQueryAt(t);let n=i._smartQuery.length();n>(o=i._SelectionChipsEditor._selectionChips&&i._SelectionChipsEditor._selectionChips._items.length)&&i._removeQueryAt(n-1),i._selectedChip=null,i._changeChipIndexAfter(t),i._lastPosIndexInEditor--,f.setMaxToDisplay(),i._buildSuggestion(),(o=i._SelectionChipsEditor._selectionChips._items.length)&&(i.buildQuerySearch(),i._lastchip=i._SelectionChipsEditor._selectionChips._items[o-1],i._manageChip(i._lastchip,!1))}i._lastPosIndexInEditor<0&&i._moveEditortoEnd(!0),0===(o=i._SelectionChipsEditor._selectionChips._items.length)?(i._checkToEnableDisableSearch(!1),e.is(i._clearbutton)&&(i._clearbutton.disabled=!0),i._bresultFound=!1,i.clean(),i._smartQuery._query=[],i._lastselectedIndex=-1,i._lastPosIndexInEditor=-1,f.setMaxToDisplay(i._maxToDisplay),i.setStartFullDropdown()):i._checkToEnableDisableSearch(),f.hidesuggestionTab({controller:i})}n&&(i._lastIndex>=0?(i._lastIndex<0&&(i._lastIndex=0),i._lastIndex>=s&&(i._lastIndex=s-1),i._mouveOnIndex()):(i._lastPosIndexInEditor<0?i._lastPosIndexInEditor=0:o===i._lastPosIndexInEditor&&(i._lastPosIndexInEditor=o,i._lastIndex=0,i._mouveOnIndex()),i._mouveOnChipEditor(),f.foundCloseparenthesis(i._lastPosIndexInEditor)))}},_removeQueryAt:function(t){let i=this._smartQuery&&this._smartQuery.removeAt(t);if(e.is(i,"array")&&i.length){let t=i[0].data;if(e.is(t,"array")){let i=t.length;for(let n=0;n<i;n++){let i=t[n];e.is(i)&&e.is(i.destroy,"function")&&(i.destroy(),i=null,t[n]=i)}}}},_createFromInput:function(t,i){let n=this;if(!e.is(n._dropdown)||!e.is(t))return;if(t.length<1)return;p.log("SmartQueryController::_createFromInput");let s=!1,o=t,a=i,r=n._haveSuggestionFrom(i,t);e.is(r)?s=!0:(r=n._listOfsuggestions.find(t=>-1!==e.clone(t.displayValue).toLowerCase().indexOf(o.toLowerCase())),e.is(r)?s=!0:(r={displayValue:o,type:"USER_TEXT",uri:"",iconClass:"fonticon-pencil",value:t},n._listOfFreesuggestions.push(r),s=!0,a="USER_TEXT")),f.setMaxToDisplay(),f.hidesuggestionTab({controller:n}),n.createFromInputTimeout&&clearTimeout(n.createFromInputTimeout),n.createFromInputTimeout=setTimeout(function(){!0===s&&e.is(r)?(p.log("SmartQueryController::_createFromInput build founded element: ",r),n._buildChipAndSuggestion(r.displayValue,a)):!1===n._inEdition&&(p.log("SmartQueryController::_createFromInput build user text: ",o),n._buildUserFreeText(o)),n._compassApp=!1},50)},_ChipChange:function(t){let i=this;if(!e.is(i._dropdown)||!e.is(i._SelectionChipsEditor))return;t.stopPropagation(),p.groupCollapsed("SmartQueryController::_ChipChange");let n=t.options;if(e.is(n))if(e.is(n.allChipsRemoved)&&!0===n.allChipsRemoved)p.log("SmartQueryController::_ChipChange Remove All"),i.clean();else{let t=n.chips;if(e.is(t)&&t.length){let t=i._SelectionChipsEditor._selectionChips.getNumberOfChips();if(t){p.log("SmartQueryController::_ChipChange index; ",t);let n=i._SelectionChipsEditor._selectionChips._items[t-1];e.is(n)&&(i._smartQuery.removeAt(t-1),i._lastchip=n,i._manageChip(i._lastchip,!1),p.log("SmartQueryController::_ChipChange last chip; ",n),i._buildSuggestion(),i.buildQuerySearch())}else i.clean()}else i.clean()}p.groupEnd()},_onEscape:function(e){this._ChipEditionClose(!0),this._moveEditortoEnd(!0,!0),f.foundCloseparenthesis()},_onclickChange:function(t){let i=this;if(!e.is(i._dropdown)||!e.is(i._SelectionChipsEditor)||!0===i._inEdition)return;if(e.is(t)&&e.is(t.stopPropagation,"function")&&t.stopPropagation(),p.log("SmartQueryController::_onclickChange"),!0===t.target.className.contains("wux-spinbox-input"))return;let n=e.is(t)&&e.is(t.dsModel)?t.dsModel:i._SelectionChipsEditor._selectionChips;if(e.is(n)){let t=n.getSelectedChipsOptions();if(e.is(t)){let n=t[0];e.is(n)&&(i._lastselectedIndex=n.index,p.log("SmartQueryController::_onclickChange selectedindex: ",i._lastselectedIndex),e.is(i._selectedChip)&&i._selectedChip.index===i._lastselectedIndex?(p.log("SmartQueryController::_onclickChange Enter to edition"),i._ChipEditionClose(!0),i._selectedChip=null,i._selectedChip=n,i._buildChipEdition(),i._inEdition=!0,i._buildSuggestion(void 0,void 0,i._lastselectedIndex)):(p.log("SmartQueryController::_onclickChange select"),i._ChipEditionClose(!0),i._selectedChip=null,i._selectedChip=n,setTimeout(function(){i.focusEditor()},100)))}}},_buildChipEdition:function(){let t=this;if(!e.is(t._dropdown)||!e.is(t._selectedChip)||e.is(t._selectedChip.lineEditor))return;p.log("SmartQueryController::_buildChipEdition");let i=t._selectedChip.index,n=t._SelectionChipsEditor._selectionChips._items.length;if(i>=0&&i<n){let n=t._SelectionChipsEditor._selectionChips._items[i];if(e.is(n)&&e.is(n.associatedChipCellView)&&e.is(n.associatedChipCellView.childNodes)){let i=n.associatedChipCellView.childNodes.length,s=void 0;for(let e=0;e<i&&"wux-chip-cell-label"!==(s=n.associatedChipCellView.childNodes[e]).className;e++);if(e.is(s)){let i=s.getDimensions();s.setStyle("display","none"),t._selectedChip.labelUx=s;let o=new l({value:t._selectedChip.label,selectAllOnFocus:!0,placeholder:t._selectedChip.label});if(o.touchMode=!1,p.log("SmartQueryController::_buildChipEdition build WUXLineEditor"),n.associatedChipCellView.insertBefore(o.getContent(),s),o.getContent().setStyle("width",i.width+"px"),t._selectedChip.lineEditor=o,t._selectedChip.lineEditor._myInput.select(),o.addEventListener("uncommittedChange",t._inputEditoruncommittedChange.bind(t)),o.addEventListener("keydown",t._inputEditorkeydown.bind(t)),e.is(t._selectedChip.suggestion.data)){let e={chip:n,readOnly:!1};f.manageTweaker(e)}}}}},_ChipEditionClose:function(t){let i=this;if(e.is(i._dropdown)){if(p.log("SmartQueryController::_ChipEditionClose"),e.is(i._lastchip)&&e.is(i._lastchip.chipOptions)&&e.is(t)){let e={chip:i._lastchip,readOnly:!0};f.manageTweaker(e)}i._checkToEnableDisableSearch(),e.is(i._selectedChip)&&e.is(i._selectedChip.lineEditor)&&(i._inEditionEnter=!1,i._inEdition=!1,i._pressEnter=!1,i._selectedChip.labelUx.setStyle("display","inline-block"),i._selectedChip.lineEditor.removeEventListener("uncommittedChange",i._inputEditoruncommittedChange.bind(i)),i._selectedChip.lineEditor.removeEventListener("keydown",i._inputEditoruncommittedChange.bind(i)),e.is(i._selectedChip.lineEditor.destroy,"function")&&i._selectedChip.lineEditor.destroy(),i._selectedChip.lineEditor=null,p.log("SmartQueryController::_ChipEditionClose delete lineEditor"))}},populateFromKeyUpSuggestions:function(t){let i=this;if(!e.is(i._dropdown))return;p.log("SmartQueryController::populateFromKeyUpSuggestions value: ",t);let n=i._SelectionChipsEditor._selectionChips&&i._SelectionChipsEditor._selectionChips._items.length;t&&t.length>0?f.setMaxToDisplay():n>0?f.setMaxToDisplay():f.setMaxToDisplay(i._maxToDisplay),i._populateFromKeyUpSuggestionsTimeout&&clearTimeout(i._populateFromKeyUpSuggestionsTimeout),i._populateFromKeyUpSuggestionsTimeout=setTimeout(function(){i.computeSmartQuery({value:t}).then(function(){if(0===i._smartQuery.length()){if(t.length>2){let e={id:"categoryDropdownGuided",query:t,count:4,instantSearchContainer:i._containerinstantSearch,noresult:()=>{i._dropdown._isContainerEmpty(i._containerinstantSearch)?(i._containerinstantSearch&&i._containerinstantSearch.show(),i._containerinstantSearchEmpty&&i._containerinstantSearchEmpty.show(),i._containerinstantSearchEmptyView&&i._containerinstantSearchEmptyView.hide()):(i._containerinstantSearch&&i._containerinstantSearch.show(),i._containerinstantSearchEmpty&&i._containerinstantSearchEmpty.hide(),i._containerinstantSearchEmptyView&&i._containerinstantSearchEmptyView.hide())},fromFull:!0};C.hideAllContainer(),i._containerinstantSearch&&i._containerinstantSearch.show(),i._dropdown._getCategoriesSuggestions(e)}else i.setStartFullDropdown()}})},100)},focusEditor:function(){e.is(this._SelectionChipsEditor)&&(this._SelectionChipsEditor._lineEditor._resetFocus(),this._SelectionChipsEditor._lineEditor._onFocusReceived())},_populateSuggestions:function(t,i,n){let s=this;if(!e.is(s._dropdown))return;for(let e=0;e<s.sections.length;e++)s["_"+s.sections[e]+"Container"]=null;s._appsContainer=null,s._freeContainer=null;e.is(n)||e.is(i)&&i.length>0||s._smartQuery.length();let o={dropdown:s._dropdown,value:i,controller:s,historyOnly:n,container:s._containersuggestion?s._containersuggestion:s._dropdown.elements.customSuggestions};f.displaySections(o)},_buildChip:function(t,i){let n=this;return new o(function(s,o){p.log("****** SmartQueryController::_buildChip: ",t),e.is(t)&&e.is(n._SelectionChipsEditor)||o(),null===n._selectedChip&&n._manageChip(n._lastchip);let a=n._haveSuggestionFrom(i,t);if(e.is(a)){let t=a.type.toLowerCase(),i=n._lastPosIndexInEditor>0?n._lastPosIndexInEditor:0;if(e.is(t)){let t=a;null!==n._selectedChip&&!0===n._inEdition&&(i=n._selectedChip.index,n._SelectionChipsEditor._selectionChips.removeChip(i)),p.log("SmartQueryController::_buildChip: index: ",i);let o=f.buildChipFromModel({chipsEditor:n._SelectionChipsEditor,object:t,controller:n},i);if(n._SelectionChipsEditor.placeholder=y.get("smart.mode.holder"),n._lastPosIndexInEditor=i+1,n._lastvalue="",n._SelectionChipsEditor._lineEditor.value="",n._SelectionChipsEditor._lineEditor.valueToCommit="",n._tosave=!0,n._changeChipIndexAfter(n._lastPosIndexInEditor),e.is(o)&&e.is(o.associatedChipCellView)){let r=void 0;e.is(n._selectedChip)&&e.is(n._selectedChip.suggestion.data)&&(r=n._selectedChip.suggestion.data);let c={suggestion:t,container:o.associatedChipCellView,datevalue:r,controller:n,chip:o,onUpdateData:function(t){e.is(t)?a.data=t:n._addAfterEditor(n._lastPosIndexInEditor),s(a)}};f.buildTweaker(c),null===n._selectedChip?(n._manageChip(o,!1),n._lastchip=o):(p.log("SmartQueryController::_buildChip: EDITION REPLACE index: ",i),p.log("SmartQueryController::_buildChip: EDITION REPLACE suggestion: ",t),n._removeQueryAt(i),n._smartQuery.spliceAt(i,t),n._lastchip=o);let l=f.foundCloseparenthesis(o,!0);n._checkToEnableDisableSearch(l),e.is(n._clearbutton)&&(n._clearbutton.disabled=!1)}}}else a=n._listOfAppssuggestions.find(e=>e.displayValue===t),e.is(a)&&(n._dropdown._onClickApp({currentTarget:{id:a.appInfos.id}}),o())})},_addAfterEditor:function(t,i){p.log("SmartQueryController::_addAfterEditor index: ",t);let n=this;if(!e.is(n._SelectionChipsEditor)||!e.is(n._SelectionChipsEditor._selectionChips))return;let s=n._SelectionChipsEditor._selectionChips;if(t>(s&&s._items&&s._items.length-1))return n._moveEditortoEnd(i),void p.log("SmartQueryController::_addAfterEditor _moveEditortoEnd");let o=s&&s._items[t];if(e.is(o)){let t=o.associatedChipCellView,a=t&&t.getParent();s._lastWidgetDiv.removeClassName("between"),s._lastWidgetDiv.addClassName("between"),a.insertBefore(s._lastWidgetDiv,t),e.is(i)&&!0===i&&(p.log("SmartQueryController::_addAfterEditor _buildSuggestion"),n._buildSuggestion()),setTimeout(function(){n.focusEditor()},100)}},_changeChipIndexAfter:function(t){p.log("SmartQueryController::_changeChipIndexAfter index: ",t);if(!e.is(this._SelectionChipsEditor)||!e.is(this._SelectionChipsEditor._selectionChips))return;let i=this._SelectionChipsEditor._selectionChips;if(e.is(i)){let n=i._items.length;for(;t<n;t++){let n=i._items[t];e.is(n)&&e.is(n.chipOptions)&&(n.chipOptions.index=t)}}},_moveEditortoEnd:function(t,i){p.log("SmartQueryController::_moveEditortoEnd");let n=this;if(!e.is(n._SelectionChipsEditor)||!e.is(n._SelectionChipsEditor._selectionChips))return;let s=n._SelectionChipsEditor._selectionChips;e.is(i)&&!0===i&&(s&&s.unselectAllChips(),n._selectedChip=null),s&&s._lastWidgetDiv.removeClassName("between"),s&&s._lastWidgetDiv.removeClassName("edition");let o=s&&s._items;if(e.is(o)&&o.length){let i=o[o.length-1].associatedChipCellView;(i&&i.getParent()).insertBefore(s._lastWidgetDiv,i.nextSibling),n._lastPosIndexInEditor=o.length,e.is(t)&&!0===t&&n._buildSuggestion(),setTimeout(function(){n.focusEditor()},100)}else n._lastPosIndexInEditor=-1},_managecusorEdition:function(){p.log("SmartQueryController::_managecusorEdition");if(!e.is(this._SelectionChipsEditor)||!e.is(this._SelectionChipsEditor._selectionChips))return;let t=this._SelectionChipsEditor._selectionChips,i=t&&t._items&&t._items.length-1;if(this._lastPosIndexInEditor<=i){t._lastWidgetDiv.className.indexOf("between")>0&&(t._lastWidgetDiv.removeClassName("between"),t._lastWidgetDiv.addClassName("edition"))}f.foundCloseparenthesis()},_buildChipAndSuggestion:function(t,i){p.log("SmartQueryController::_buildChipAndSuggestion: ",t);let n=this;f.hidesuggestionTab({controller:n}),n._buildChip(t,i).then(i=>{null===n._selectedChip&&e.is(t)&&t.length>0?n.onSetSuggestion(t,i):(n._ChipEditionClose(),n._selectedChip=null,n._buildSuggestion(),n.focusEditor()),!1===n._compassApp&&n.buildQuerySearch(),n._compassApp=!1})},_buildUserFreeText:function(t,i){p.log("SmartQueryController::_buildUserFreeText: ",t);let n={displayValue:t,type:e.is(i)?i:"USER_TEXT",uri:"",iconClass:"fonticon-pencil",value:t};this._listOfsuggestions.push(n),this._buildChipAndSuggestion(t,i)},_manageChip:function(t,i=!0){if(!e.is(t))return;e.is(t.associatedChipCellView),this._updateUI()},_updateUI:function(t){let i=this,n=e.is(i._container)?i._container:i._containerinput;if(!e.is(n))return;let s=n.getDimensions();if(e.is(i._containerresult));else{let n=s.height+5,o=i._container.getParent().getChildren(),a=o.length,r="calc(100% - "+n+"px)";if(e.is(t))for(let e=1;e<a;e++)o[e].style.removeProperty("height");else for(let e=1;e<a;e++)o[e].setStyle("height",r)}},_applySearch:function(){let t=this;if(p.log("SmartQueryController::_applySearch"),!e.is(t._dropdown)||!e.is(t._smartQuery))return;if(!0===t._inContextMode){let e={smartQuery:t._smartQuery},i=f.buildQuerySearch(e);return r.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"deactivateInContextSearch",data:{guidedMode:!0,buildQuery:i}}),C.modalVisibility(!1),void(t._dropdown&&t._dropdown.onBlur(void 0,!0))}let i=!0,n=t._smartQuery.length();if(n){let s=t._smartQuery.getAt[n-1];if(e.is(s)){let t=s.type,n=s.appInfos;"USER_TEXT"===t&&e.is(n)&&(i=!1)}}if(!0===i)if(C.modalVisibility(!1),t._dropdown&&t._dropdown.onBlur(void 0,!0),0===n)t._dropdown&&t._dropdown.setInputValue(t._lastvalue),a.dispatch("onViewSearch"),t._lastvalue.length>2&&!0!==C.getInContextMode()&&t._dropdown&&t._dropdown.switchActiveTabinstantSearchTab(t._lastvalue);else{let e={smartQuery:t._smartQuery},i=y.get("search.fromsearchResults.title"),n=f.buildQuerySearch(e);a.dispatch("onViewSearch",[{displayString:i,query:n,fromsmartSearch:!0}]),!0===t._dropdown.webInwin&&t._dropdown.eventManager&&t._dropdown.eventManager.dispatchEvent("onViewSearch",{displayString:i,query:n,fromsmartSearch:!0}),setTimeout(function(){t._dropdown&&t._dropdown.setInputValue(""),t._dropdown&&t._dropdown.setPlaceHolderValue(y.get("search.fromsearchResults.title"))},1e3)}!0===t._dropdown.webInwin&&t._dropdown.eventManager.dispatchEvent("onGuidedMode",!1)},_save:function(){let t=this;if(p.log("SmartQueryController::_save"),!0===t._inContextMode)return r.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"deactivateInContextSearch"}),C.modalVisibility(!1),void(t._dropdown&&t._dropdown.onBlur(void 0,!0));e.is(t._smartQuery)&&!1!==t._tosave&&(C.saveToLocalStorage(t._smartQuery),t._savebutton&&(t._savebutton.disabled=!0),t._tosave=!1,S._displayAlert({message:_.escapeHtml(y.get("smart.mode.save.pin.success")),className:"success",container:e.extendElement(C._modal.getContent())}))},buildQuerySearch:function(){let t=this;!0===t._checkBeforeToLaunchSearch()&&(clearTimeout(t._buildQuerySearchTimeout),t._buildQuerySearchTimeout=setTimeout(function(){let i="";if(p.log("SmartQueryController::buildQuerySearch"),!e.is(t._dropdown)||!e.is(t._smartQuery))return;let n={smartQuery:t._smartQuery};i=f.buildQuerySearch(n),t._refreshSearchResults(i)},1e3))},_refreshSearchResults:function(t){let i=this;e.is(i._dropdown)&&e.is(i._smartQuery)&&(C.hideAllContainer(),this._containerinstantSearchEmptyView&&this._containerinstantSearchEmptyView.hide(),clearTimeout(i._dropdown._categorySuggestTimeout),i._dropdown._categorySuggestTimeout=setTimeout(function(){p.log("SmartQueryController::_refreshSearchResults");let e=5;!0===i._dropdownFull&&(e=10),i._containerresult&&i._containerresult.show();let n={container:i._containerresult,dropdown:i._dropdown,srcRessource:i._dropdown._srcRessource,webInwin:i._dropdown.webInwin,eventManager:i._dropdown.eventManager,query:t,count:e,noresult:()=>{i._containerresult&&i._containerresult.hide(),i._containerinstantSearchEmptyView&&i._containerinstantSearchEmptyView.show()},onclickViewAll:()=>{i._applySearch()}};C.buildguidedContent(n)},100))},_mouveOnElement:function(t){let i=this;if(!e.is(i._dropdown))return;let n=(i._containersuggestion?i._containersuggestion:i._dropdown.elements.customSuggestions).querySelectorAll(".suggestion-content");for(const e of n)e.removeClassName("hover");let s=n[0];if(e.is(s)){let e,o;s.addClassName("hover"),e=s.title,o=s.type,i._lastIndex++,i._completesuggestionTab(t,e);let a=i._lastIndex+1,r=n.length;for(;a<r;a++){let t=n[a];if(t.title===e&&t.type===o){t.addClassName("hover");break}}}},_mouveOnIndex:function(){let t=this;if(!e.is(t._dropdown))return;let i=t._containersuggestion?t._containersuggestion:t._dropdown.elements.customSuggestions;for(const e of i.querySelectorAll(".suggestion-content"))e.removeClassName("hover");let n,s,o=0;for(const e of i.querySelectorAll(".suggestion-content")){if(o===t._lastIndex){e.addClassName("hover"),s=e.title,n=e.type;break}o++}t._completesuggestionTab(t._lastvalue,s),t._currentsuggestion=t._haveSuggestionFrom(n,s)},_mouveOnChipEditor:function(){let t=this;e.is(t._SelectionChipsEditor)&&e.is(t._SelectionChipsEditor._selectionChips)&&t._lastPosIndexInEditor>=0&&t._addAfterEditor(t._lastPosIndexInEditor,!0)},_speech:function(){let t=this;if(null===t._speechRecognition){let i=function(e){p.log("SmartQueryController::onend: ",e),t._contentSpeech.removeClassName("record"),t._speechstart=0,v.stop()},n=function(e){p.log("SmartQueryController::onnomatch: ",e),t._contentSpeech.removeClassName("record"),t._speechstart=0,v.stop()},s=function(e){p.log("SmartQueryController::onerror: ",e),t._contentSpeech.removeClassName("record"),t._speechstart=0,v.stop()},o=function(i){let n=i.results[0][0].transcript;if(e.is(n,"string")&&n.length>=0){p.log("SmartQueryController::_speech: ",n);n.split(" ");t._SelectionChipsEditor._lineEditor.value=n}};v.build(o,i,n,s),t._speechRecognition=v.getspeechRecognition()}t._contentSpeech.removeClassName("record"),0===t._speechstart?(v.start(),t._speechstart=1,t._contentSpeech.addClassName("record")):(v.stop(),t._speechstart=0)},_displayApp:function(e){this._father&&this._father._displayApp(e)},_statusOK:function(){},_statusKO:function(){},_checkToEnableDisableSearch:function(t){let i=this;if(!e.is(i._apply))return;let n=e.is(t)?t:f.foundCloseparenthesis(void 0,!0);e.is(n)&&!0===n?i._DisableSearch(!1):i._DisableSearch(!0)},_DisableSearch:function(t){let i=this,n=t;e.is(i._apply)&&(i._apply.disabled=n,i._savebutton&&(0!==i._smartQuery.length()&&!1!==i._tosave||(n=!0),!1===i._tosave&&(n=!0)),i._savebutton.disabled=n)},_checkBeforeToLaunchSearch:function(){let t=this,i=!1;if(!e.is(t._smartQuery)||0===t._smartQuery.length())return i;i=!0;let n=t._smartQuery.getAt(t._smartQuery.length()-1);if(e.is(n)){let s=n.type;if(s.contains("OPERATOR")||"PREDICATE"===s)i=!1,t._DisableSearch(!0);else if("PREDICATE_VALUE"===s){let t=n.data;if(e.is(t,"array")){let n=t.length;for(let s=0;s<n;s++){let n=t[s];if(e.is(n)&&!0===n.visibleFlag){i=!1;break}}}}i?t._DisableSearch(!1):t._DisableSearch(!0)}return i},_checkresults:function(t){let i=this;!e.is(i._contentStatus)&&!e.is(t)||e.is(t.results)?i._statusOK():e.is(t.infos)&&e.is(t.infos.nresults)&&0===t.infos.nresults&&i._containerinstantSearchEmptyView&&i._containerinstantSearchEmptyView.show()},setInputValue:function(t){e.is(this._SelectionChipsEditor)&&(this._SelectionChipsEditor._lineEditor.value=t,this._SelectionChipsEditor._lineEditor.valueToCommit=t,this._dropdown&&this._dropdown.setInputValue(t))},setPlaceHolderValue:function(t){e.is(this._SelectionChipsEditor)&&(this._SelectionChipsEditor.placeholder=t,this._dropdown&&this._dropdown.setPlaceHolderValue(t))},setStartFullDropdown:function(){this._dropdownFull&&!1===this._inContextMode&&(C.hideAllContainer(),C.showguidedContainer())},_haveSuggestionFrom:function(t,i){let n=this,s=void 0;function o(e,t,i){return e.find(function(e){return e.displayValue===i&&e.type===t})}if(s=o(n._listOfFreesuggestions,t,i),!e.is(s)&&(s=o(n._historyList,t,i),!e.is(s)))for(let e=0;e<n.sections.length&&!(s=o(n["_"+n.sections[e]+"List"],t,i));e++);return s},hideHistory:function(e){this._histories&&this._histories.hide(),C.showhidehistoryContainer(this._historyList.length>0)},refreshTweakerToReadonly:function(e){this._SelectionChipsEditor._selectionChips&&this._SelectionChipsEditor._selectionChips.unselectAllChips(),this._mouveOnChipEditor(),this._inEdition=!1,this._inEditionEnter=!1},addGuidedFromModel:function(t){e.is(t)&&(this._buildTweaker=!0,this.clean(!0),this._smartQuery._query=t,this._refreshSuggestion(),this.buildQuerySearch(),this._buildTweaker=!1)},_completesuggestionTab:function(t,i){e.is(t)&&0!==t.length&&!this._inEdition&&f.completesuggestionTab({controller:this,value:t,highLight:i})},setInContextMode:function(t,i){let n=this;n._inContextMode=t,e.is(n._apply)&&e.is(n._savebutton)&&(!0===t?(n.clean(!1,i),n._apply.label=w.get("OKButton"),n._savebutton.label=w.get("CancelButton"),n._savebutton.displayStyle="normal",n._savebutton.emphasize="secondary",n._savebutton.icon={},n._savebutton.disabled=!1,m.tooltip(n._savebutton,{title:_.escapeHtml(y.get("smart.incontext.exit")),position:"bottom",reshowDelay:2.5,mouseRelativePosition:!0}),m.tooltip(n._apply,{title:_.escapeHtml(y.get("smart.incontext.ok")),position:"bottom",reshowDelay:2.5,mouseRelativePosition:!0}),C.hideAllContainer(),C.showSettingsHelpsContainer(!1),C.showguidedResultsContainer()):(n.clean(),n._apply.label=y.get("smart.mode.apply"),n._savebutton.label=y.get("smart.mode.save"),n._savebutton.displayStyle="lite",n._savebutton.emphasize="primary",n._savebutton.icon={iconName:"pin",fontIconFamily:WUXManagedFontIcons.Font3DS},n._savebutton.disabled=!0,m.tooltip(n._savebutton,{title:_.escapeHtml(y.get("smart.mode.save.pin")),position:"bottom",reshowDelay:2.5,mouseRelativePosition:!0,longHelp:_.escapeHtml(y.get("smart.mode.save.pin.LongHelp"))}),m.tooltip(n._apply,{title:_.escapeHtml(y.get("smart.mode.apply")),position:"bottom",reshowDelay:2.5,mouseRelativePosition:!0,longHelp:_.escapeHtml(y.get("smart.mode.apply.LongHelp"))}),C.showSettingsHelpsContainer(!0)))},destroy:function(){return this._SelectionChipsEditor&&_this._SelectionChipsEditor._getElementToFocus().removeEventListener("focus",_this._clickOnChipsEditor.bind(_this)),this._SelectionChipsEditor&&_this._SelectionChipsEditor.removeEventListener("click",_this.focusEditor.bind(_this)),this._SelectionChipsEditor&&_this._SelectionChipsEditor.removeEventListener("onPostRemove",_this._ChipChange.bind(_this)),this._SelectionChipsEditor&&_this._SelectionChipsEditor._lineEditor.removeEventListener("uncommittedChange",_this._inputEditoruncommittedChange.bind(_this)),this._SelectionChipsEditor&&_this._SelectionChipsEditor._lineEditor.removeEventListener("change",_this._inputEditorchange.bind(_this)),this._SelectionChipsEditor&&e.is(this._SelectionChipsEditor.destroy,"function")&&this._SelectionChipsEditor.destroy(),this._smartQuery&&e.is(this._smartQuery.destroy,"function")&&this._smartQuery.destroy(),this._listOfSelection=[],this._parent()}})}),define("DS/SNSearchUX/dropdown/SearchDropDownPQs",["UWA/Core","UWA/Element","UWA/Promise","UWA/Controls/Abstract","DS/UIKIT/Autocomplete","DS/Controls/Button","DS/Controls/Expander","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SearchVersioning","DS/SNInfraUX/SearchUtils","text!DS/SNSearchUX/assets/templates/SearchDropDown/SpecialCharacterDocumentation.json","i18n!DS/SNSearchUX/assets/nls/SearchDropDown.json"],function(e,t,i,n,s,o,a,r,c,l,d,u,h){"use strict";return n.extend({predefinedQueriesElementList:[],_searchDropDown:null,_webInwin:!1,_eventManager:void 0,init:function(t){let i=this;i._parent(t),e.is(t)&&(e.is(t.eventManager)&&(i._eventManager=t.eventManager),e.is(t.searchDropDown)&&(i._searchDropDown=t.searchDropDown),e.is(t.webInwin)&&(i._webInwin=t.webInwin))},createPredefinedQueriesComponent:function(){let t=new r({});c.fetchPQsFromServer(t).then(function(){var t=c.getPQs(),i=c.getPQNLS(),n=[];e.is(t)&&t.PQ.forEach(function(e){n.push({id:e.pqid,value:e.value,abbreviations:e.abbreviations,title:i[e.pqid+".Title"]})}),n.sort(function(e,t){return e.title<t.title?-1:e.title>t.title?1:0}),this.loadPredefinedQueries(n)}.bind(this))},buildPredefinedQueriesComponent:function(i){let n=this;if(!e.is(n._searchDropDown))return;let o=n.elements,a=new s({noResultsMessage:!1,placeholder:h.get("PQs.find"),events:{onKeyUp:function(e){n.filterPredefinedQueries(e.currentTarget.value)}}}).inject(o.predefinedQueriesInput);a.elements.input.addClassName("predefined-queries-search-field"),a.elements.input.addEventListener("blur",function(e){n._searchDropDown.setFocus()}),a.elements.clear.addEventListener("click",function(e){n._searchDropDown.noBlur=!0,n._searchDropDown.noFocus=!0,n.filterPredefinedQueries("")}),o.predefinedQueriesTable=t.create("table",{class:"predefined-queries-table"}).inject(o.predefinedQueriesContent),o.predefinedQueriesTableBody=t.create("tbody",{class:"predefined-queries-table-body"}).inject(o.predefinedQueriesTable)},loadPredefinedQueries:function(i){let n=this;if(!e.is(n._searchDropDown))return;let s=n.elements;n.predefinedQueriesElementList=[],s.predefinedQueriesTableBody.empty(),i.forEach(function(e,i){let o;o=i%2==0?t.create("tr",{class:"predefined-queries-grey"}).inject(s.predefinedQueriesTableBody):t.create("tr",{class:"predefined-queries-white"}).inject(s.predefinedQueriesTableBody),n.predefinedQueriesElementList.push(o);let a=t.create("table").inject(o),r=t.create("tbody").inject(a);t.create("td",{text:e.title,class:"predefined-queries-content-left"}).inject(r);let c=t.create("td",{class:"predefined-queries-content-right"}).inject(r);e.abbreviations.split(",").forEach(function(e){t.create("a",{text:e+":",class:"predefined-queries-content-abbreviation"}).inject(c).addEventListener("click",function(e){let t=e.currentTarget.getText();n._searchDropDown.setInputValue(t),n._searchDropDown.setFocus(),t.length>2&&!0!==n._searchDropDown._inContextMode&&n._searchDropDown.switchActiveTabinstantSearchTab(t),!0===n._webInwin&&n._eventManager&&n._eventManager.dispatchEvent("onPQ",{displayString:t}),n._searchDropDown.hideSettingPQs()}),t.create("span",{text:" "}).inject(c)})})},filterPredefinedQueries:function(t){if(e.is(t)&&""!==t){var i=0;this.predefinedQueriesElementList.forEach(function(e,n){e.getText().toLowerCase().contains(t.toLowerCase())?(e.show(),e.removeClassName("predefined-queries-white"),e.removeClassName("predefined-queries-grey"),i%2==0?e.addClassName("predefined-queries-grey"):e.addClassName("predefined-queries-white"),i++):e.hide()})}else this.predefinedQueriesElementList.forEach(function(e,t){e.show(),e.removeClassName("predefined-queries-white"),e.removeClassName("predefined-queries-grey"),t%2==0?e.addClassName("predefined-queries-grey"):e.addClassName("predefined-queries-white")})},buildPredefinedQueriesDocumentation:function(i){var n=t.create("table",{class:"predefined-queries-table"}).inject(i),s=t.create("tbody").inject(n);JSON.parse(u).documentation.forEach(function(i){var n=t.create("tr").inject(s),o=t.create("td",{html:h.get(i.title)}).inject(n),a=t.create("td",{html:h.get(i.content)}).inject(n);e.is(i.options)&&e.is(i.options.isHeader)?(o.addClassName("predefined-queries-documentation-header"),a.addClassName("predefined-queries-documentation-header")):n.addClassName("predefined-queries-documentation-content")}.bind(this))},buildHelp:function(i){let n=this;if(!e.is(n._searchDropDown)||!e.is(i))return;let s=this.elements;s.predefinedQueriesTabContainer=i,s.predefinedQueriesDocumentationTextContainer=t.create("div",{class:"predefined-queries-documentation-container"}),this.buildPredefinedQueriesDocumentation(s.predefinedQueriesDocumentationTextContainer),s.userAssistanceContainer=new t.create("div",{class:"special-characters-link-container"}).inject(s.predefinedQueriesTabContainer),s.userAssistanceLink=new o({label:h.get("PQs.user.assistance"),emphasize:"secondary",icon:{iconName:"search-book",fontIconSize:"inherit",fontIconFamily:WUXManagedFontIcons.Font3DS},onClick:function(){let e=l.getCurrentRelease().slice(1);window.open("http://help.3ds.com/HelpDS.aspx?P=11&V="+e+"&L="+d.getLanguage()+"&F=EXP3DBasicsUserMap/exp3dbasics-m-Searching-for-content-sb.htm","_blank","popup")}}).inject(s.userAssistanceContainer),s.closeLink=new o({displayStyle:"lite",emphasize:"secondary",icon:{iconName:"close",fontIconSize:"1x",fontIconFamily:WUXManagedFontIcons.Font3DS},onClick:function(){n._searchDropDown.hideSettingPQs()}}).inject(s.userAssistanceContainer),s.specialCharactersExpander=new a({header:h.get("PQs.special.characters"),body:s.predefinedQueriesDocumentationTextContainer,style:"filled-separate",expandedFlag:!0}).inject(s.predefinedQueriesTabContainer),s.specialCharactersExpander.elements.container.addClassName("special-characters-container"),s.specialCharactersExpander.elements.container.addClassName("expanded"),s.specialCharactersExpander.getContent().addEventListener("expand",function(){s.specialCharactersExpander.elements.container.addClassName("expanded"),s.specialCharactersExpander.elements.container.removeClassName("collapsed"),s.typeShortcutsExpander.close()}),s.specialCharactersExpander.getContent().addEventListener("collapse",function(){s.specialCharactersExpander.elements.container.removeClassName("expanded"),s.specialCharactersExpander.elements.container.addClassName("collapsed")}),s.typeShortcutsContent=t.create("div",{class:"predefined-queries-container"}),s.predefinedQueriesInput=t.create("div",{class:"predefined-queries-input"}).inject(s.typeShortcutsContent),s.predefinedQueriesContent=t.create("div",{class:"predefined-queries-content"}).inject(s.typeShortcutsContent),this.buildPredefinedQueriesComponent(),s.typeShortcutsExpander=new a({header:h.get("PQs.type.shortcuts"),body:s.typeShortcutsContent,style:"filled-separate"}).inject(s.predefinedQueriesTabContainer),s.typeShortcutsExpander.elements.container.addClassName("type-shortcuts-container"),s.typeShortcutsExpander.getContent().addEventListener("expand",function(){s.typeShortcutsExpander.elements.container.addClassName("expanded"),s.typeShortcutsExpander.elements.container.removeClassName("collapsed"),s.specialCharactersExpander.close(),s.typeShortcutsExpander.expand()}),s.typeShortcutsExpander.getContent().addEventListener("collapse",function(){s.typeShortcutsExpander.elements.container.removeClassName("expanded"),s.typeShortcutsExpander.elements.container.addClassName("collapsed")})},destroy:function(){this._parent()}})}),define("DS/SNSearchUX/utils/SearchViewEvents",["UWA/Core","UWA/Utils","UWA/Controls/Abstract","DS/PubSub/PubSub","DS/PlatformAPI/PlatformAPI","DS/SNInfraUX/Logger","i18n!DS/SNSearchUX/assets/nls/SNSearchUX.json"],function(e,t,i,n,s,o,a){"use strict";return i.extend({init:function(t){e.is(t)&&e.is(t.searchView)?(this.searchView=t.searchView,this.setup()):o.error("Initialization of Search view events failed")},setup:function(){s.subscribe("search.secondaryMenu:lastSearchResults",function(){this.searchView.autocomplete.setFieldValue(""),n.dispatch("onViewSearch")}.bind(this)),n.add("search.scope:tab",function(t){e.is(that.topBarMenu)&&this.searchView.topBarMenu._clickOnSearchInCurrentTab(t)}.bind(this)),n.add("search:showLastSearchResult",function(t,i){e.is(this.searchView.topBarMenu)&&!this.searchView.topBarMenu._inAppContext&&this.searchView.topBarMenu.currentMode!==a.search_current_tab&&(this.searchView.topBarMenu.showLastSearch(),this.searchView.reSearch=!0,this.searchView.reSearchQuery={value:t,searchStringToDisplayInSearchField:i})}.bind(this)),n.add("tab:change",function(){n.dispatch("SearchQuery",[""]),e.is(this.searchView.topBarMenu)&&e.is(this.searchView.topBarMenu.currentMode)&&this.searchView.topBarMenu.currentMode===a.search_current_tab&&this.searchView.autocomplete.setFieldValue("")}.bind(this)),n.add("onViewSearch",function(t){e.is(t)&&e.is(t.displayString)&&e.is(t.query)?this.searchView.socket.dispatchEvent("search",{value:t.query,searchStringToDisplayInSearchField:t.displayString,source:t.source,testing:t.objectToPreview}):this.searchView._onSearch()}.bind(this))}})}),define("DS/SNSearchUX/SearchUxPowerBy",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Debug","UWA/Class/Collection","UWA/Promise","UWA/Utils","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/MessageBus/MessageBus","DS/SNInfraUX/Logger","DS/PlatformAPI/PlatformAPI"],function(e,t,i,n,s,o,a,r,c,l,d,u){"use strict";return t.extend(i,n,{_local_actions:"server",_mode:null,_protocol:"v1",init:function(e){this.setDebugMode(r.getDebugMode()),this.setOptions(e);var t=r.getOption("searchprotocolv2");e.addinMode&&t||c.setPowerByInitDone(),t&&(u.subscribe("webinwin:win:notification",this._onWinNotif.bind(this)),u.publish("webinwin:web:notification",JSON.stringify({event:"search_options_init",content:{}})),this._protocol="v2"),this._subscribeToLocalActionsRequests()},getPowerByOptions:function(){if("v2"==this._protocol){let e={hasPowerByActions:!1};return"sidebar"==this._mode&&(e.hasPowerByActions="none"!=this._local_actions),e}},_subscribeToLocalActionsRequests:function(){l.subscribe({channel:"SearchUXPowerByIntegration",topic:"HasPowerByActionsReq",callback:this._hasPowerByActions.bind(this)}),l.subscribe({channel:"SearchUXPowerByIntegration",topic:"PowerByActionsReq",callback:this._getPowerByActions.bind(this)})},_onWinNotif:function(t){if(e.is(t,"object")&&e.is(t.event,"string")&&e.is(t.content,"object"))switch(t.event){case"search_options_set":this.log("webinwin:win:notification for search_options_set notif received, options="+JSON.stringify(t)),this._setPowerByOptions(t.content);break;case"search_contextualaction_set":this.log("webinwin:win:notification for search_contextualaction_set notif received, options="+JSON.stringify(t)),this._setPowerByActions(t.content)}else this.log("webinwin:win:notification does not contain info in expected format")},_setPowerByOptions:function(e){["incontext","sidebar"].indexOf(e.mode)>-1&&(this._mode=e.mode),["local","server","none"].indexOf(e.local_actions)>-1?this._local_actions=e.local_actions:this._local_actions="server",c.setPowerByInitDone()},_setPowerByActions:function(e){var t=this._mapPowerByActions(e);l.publish({channel:"SearchUXPowerByIntegration",topic:"PowerByActionsRes",data:t})},_mapPowerByActions:function(e){return e.actions.forEach(function(e){e.actions.forEach(function(e){e.sourcejs="DS/SNResultUX/utils/PowerByActionsHandler"})}),e},_hasPowerByActions:function(e){l.publish({channel:"SearchUXPowerByIntegration",topic:"HasPowerByActionsRes",data:"none"===this._local_actions?"local":this._local_actions})},_getPowerByActions:function(e){if("none"===this._local_actions){var t={actions:[],status:"success"};e.objects.forEach(function(e){var i={id:e.id,actions:[]};t.actions.push(i)}),this._setPowerByActions(t)}else u.publish("webinwin:web:notification",JSON.stringify({event:"search_contextualaction_get",content:e}))}})}),define("DS/SNSearchUX/utils/SearchOptionsPopup",["UWA/Controls/Abstract","UWA/Core","UWA/Element","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/ComboBox","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SessionSecurityContextServices","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o,a,r,c,l,d,u){"use strict";return e.extend({elements:{},initialSettings:{},settings:{},tenant:null,init:function(e){this._parent(e),t.is(e)&&t.is(e.tenant)&&(this.tenant=e.tenant),t.is(this.immersiveFrame)||(this.immersiveFrame=new n({}).inject(document.body));var i=this.build();this.dialog=new s({immersiveFrame:this.immersiveFrame,title:"Search Settings",content:i,buttons:{Cancel:new o({label:"Cancel",touchMode:!0,onClick:function(e){this.dialog.close(),this.dispatchEvent("onClosePopup",[])}.bind(this)}),Ok:new o({label:"Apply",touchMode:!0,disabled:!0,onClick:function(e){var t=new s({immersiveFrame:this.immersiveFrame,title:"Apply Settings Changes",content:'<div class="search-popup-confirm-dialog">You\'re about to leave without applying your changes. Do you want to apply your changes ? The page will be reloaded.</div>',buttons:{Ok:new o({label:"Apply Changes",touchMode:!0,onClick:function(e){this.apply()}.bind(this)}),Cancel:new o({label:"Cancel",touchMode:!0,onClick:function(e){t.close()}.bind(this)})}})}.bind(this)})}}),this.load()},apply:function(){t.is(this.elements.useTabsCheckbox)&&l.setItem("search_tabbed_ui",this.elements.useTabsCheckbox.checked);var e=this.elements.resultsRevisionsSelect.elementsList[this.elements.resultsRevisionsSelect.selectedIndex].name,i=this.elements.resultsRevisionsSelect.elementsList[this.elements.resultsRevisionsSelect.selectedIndex].value;l.setItem("revisionDisplayType",{id:e,exprn:i}),"3DSpace"!==r.identifyClientInfo().identifier&&!0!==this.webInwin&&this.settings.listofCredentialObjectsArray.forEach(function(e){e.displayName===this.elements.collabSpaceCredentialsSelect.elementsList[this.elements.collabSpaceCredentialsSelect.selectedIndex].label&&l.setItem("securityContext"+this.tenant,JSON.stringify(e))}.bind(this)),l.commit();var n={labelItem:this.elements.csvSeparatorSelect.elementsList[this.elements.csvSeparatorSelect.selectedIndex].label,valueItem:this.elements.csvSeparatorSelect.elementsList[this.elements.csvSeparatorSelect.selectedIndex].value},s={};c.getOption("date_display_mode_array").forEach(function(e){u.get(e.id+".title")===this.elements.dateFormatSelect.elementsList[this.elements.dateFormatSelect.selectedIndex].label&&(s=e)}.bind(this));var o={csvMode:n,dateDisplayMode:s};l.setPreference({name:"optionMode",value:JSON.stringify(o),tenantId:this.tenant,onComplete:function(){location.reload(!0)}.bind(this),onFailure:function(e){Logger.error("Failure, Unable to save preferences :",e)}})},build:function(){var e=this.elements;return e.container=i.create("div",{class:"search-popup-content"}),e.layoutTitle=i.create("div",{class:"setting-container"}).inject(e.container),i.create("div",{class:"label-container-title",text:"Layout"}).inject(e.layoutTitle),"3DSpace"!==r.identifyClientInfo().identifier&&(e.useTabs=i.create("div",{class:"setting-container tabbed"}).inject(e.container),e.useTabsContainer=i.create("div",{class:"option-container"}).inject(e.useTabs),e.useTabsCheckbox=i.create("input",{class:"settings-tabs-checkbox",type:"checkbox"}).inject(e.useTabsContainer),e.useTabsCheckbox.addEventListener("change",function(e){this.setApplyButtonState()}.bind(this)),e.useTabsTitle=i.create("span",{class:"settings-tabs-title",text:"Use Tabs to Show Search"}).inject(e.useTabsContainer)),e.resultPresentation=i.create("div",{class:"setting-container"}).inject(e.container),i.create("div",{class:"label-container-title",text:"Result Presentation"}).inject(e.resultPresentation),e.dateFormat=i.create("div",{class:"setting-container date-format"}).inject(e.container),i.create("div",{class:"label-container",text:"Display Date Format"}).inject(e.dateFormat),e.dateFormatContainer=i.create("div",{class:"option-container-select"}).inject(e.dateFormat),e.dateFormatSelect=new a({touchMode:!0,enableSearchFlag:!1}).inject(e.dateFormatContainer),e.dateFormatSelect.addEventListener("change",function(e){this.setApplyButtonState()}.bind(this)),e.resultExport=i.create("div",{class:"setting-container"}).inject(e.container),i.create("div",{class:"label-container-title",text:"Search Result Export"}).inject(e.resultExport),e.csvSeparator=i.create("div",{class:"setting-container csv-separator"}).inject(e.container),i.create("div",{class:"label-container",text:"CSV Separator"}).inject(e.csvSeparator),e.csvSeparatorContainer=i.create("div",{class:"option-container-select"}).inject(e.csvSeparator),e.csvSeparatorSelect=new a({touchMode:!0,enableSearchFlag:!1}).inject(e.csvSeparatorContainer),e.csvSeparatorSelect.addEventListener("change",function(e){this.setApplyButtonState()}.bind(this)),e.collabSpace=i.create("div",{class:"setting-container"}).inject(e.container),i.create("div",{class:"label-container-title",text:"Collaborative Spaces"}).inject(e.collabSpace),e.resultsRevisions=i.create("div",{class:"setting-container results-revision"}).inject(e.container),i.create("div",{class:"label-container",text:"Search Results Revisions"}).inject(e.resultsRevisions),e.resultsRevisionsContainer=i.create("div",{class:"option-container-select"}).inject(e.resultsRevisions),e.resultsRevisionsSelect=new a({touchMode:!0,enableSearchFlag:!1}).inject(e.resultsRevisionsContainer),e.resultsRevisionsSelect.addEventListener("change",function(e){this.setApplyButtonState()}.bind(this)),"3DSpace"!==r.identifyClientInfo().identifier&&!0!==this.webInwin&&(e.collabSpaceCredentials=i.create("div",{class:"setting-container credentials"}).inject(e.container),i.create("div",{class:"label-container",text:"Collaborative Spaces Credentials"}).inject(e.collabSpaceCredentials),e.collabSpaceCredentialsContainer=i.create("div",{class:"option-container-select"}).inject(e.collabSpaceCredentials),e.collabSpaceCredentialsSelect=new a({touchMode:!0,enableSearchFlag:!1}).inject(e.collabSpaceCredentialsContainer),e.collabSpaceCredentialsSelect.addEventListener("change",function(e){this.setApplyButtonState()}.bind(this))),e.container},load:function(){var e=this.elements;if("3DSpace"!==r.identifyClientInfo().identifier){let i=l.getItem("search_tabbed_ui");e.useTabsCheckbox.checked=!!t.is(i)&&i,this.initialSettings.useTabs=this.elements.useTabsCheckbox.checked}let i=c.getOption("date_display_mode_array");n=[],t.is(i)&&i.length>0&&(i.forEach(function(e){n.push({label:u.get(e.id+".title"),value:e.value})}.bind(this)),this.elements.dateFormatSelect.elementsList=n);var n=[];let s=c.getOption("csvSeparatorArray");if(t.is(s)&&s.length>0&&(s.forEach(function(e){n.push({label:u.get("csvSeparatorUI.values."+e.id),value:e.value})}.bind(this)),this.elements.csvSeparatorSelect.elementsList=n),l.getItemPromise("optionMode",this.tenant).then(function(e){t.is(e)&&(this.elements.csvSeparatorSelect.value=c.getOption("csvSeparator"),t.is(e.csvMode)&&t.is(e.csvMode.valueItem)&&(this.elements.csvSeparatorSelect.value=e.csvMode.valueItem),this.initialSettings.csvSeparator=this.elements.csvSeparatorSelect.elementsList[this.elements.csvSeparatorSelect.selectedIndex].label,t.is(e.dateDisplayMode)&&t.is(e.dateDisplayMode.id)?Array.from(this.elements.dateFormatSelect.elementsList).forEach(function(t,i){t.label===u.get(e.dateDisplayMode.id+".title")&&(this.elements.dateFormatSelect.selectedIndex=i)}.bind(this)):this.elements.dateFormatSelect.selectedIndex=0,this.initialSettings.dateFormat=this.elements.dateFormatSelect.elementsList[this.elements.dateFormatSelect.selectedIndex>=0?this.elements.dateFormatSelect.selectedIndex:0].label)}.bind(this)),n=[],r.isRoleAvailable(["CSV"],this.tenant,function(e){if(!0===e){let e=c.getOption("show_search_results_revision_array");t.is(e)&&e.length>0&&(e.forEach(function(e){n.push({label:u.get(e.id+".title"),value:e.exprn,name:e.id})}.bind(this)),this.elements.resultsRevisionsSelect.elementsList=n);let i=t.is(l.getItem("revisionDisplayType"))?l.getItem("revisionDisplayType"):c.getOption("defaultRevision",{tenant:this.tenant});t.is(i)?(Array.from(this.elements.resultsRevisionsSelect.elementsList).forEach(function(e,t){e.label===u.get(i.id+".title")&&(this.elements.resultsRevisionsSelect.selectedIndex=t)}.bind(this)),this.initialSettings.searchResultRevisions=this.elements.resultsRevisionsSelect.elementsList[this.elements.resultsRevisionsSelect.selectedIndex].label):(this.elements.resultsRevisionsSelect.selectedIndex=0,this.initialSettings.searchResultRevisions=this.elements.resultsRevisionsSelect.elementsList[0].label)}}.bind(this)),n=[],"3DSpace"!==r.identifyClientInfo().identifier&&!0!==this.webInwin){let e=r.identifyClientInfo(void 0),i=!1;if(t.is(e)&&t.is(e.identifier)&&("3DDashboard"===e.identifier||"3DSwym"===e.identifier)&&(i=!0),t.is(e)&&t.is(e.addinmode)&&"catiav5"===e.addinmode&&(i=!0),c.getOption("global_action_credentials")&&!0===i){var o=0;d.getSecurityContext3DSpace(this.tenant).then(function(e){var i=l.getItem("securityContext"+this.tenant);t.is(i,"string")&&(i=JSON.parse(i)),this.settings.listofCredentialObjectsArray=e,this.settings.listofCredentialObjectsArray.forEach(function(e){t.is(e.isDefault)&&!0===e.isDefault?n.unshift({label:u.get(e.displayName),value:e.name}):n.push({label:u.get(e.displayName),value:e.name})}.bind(this)),n.forEach(function(e,n){t.is(i)&&t.is(i.name)&&i.name===e.value&&(o=n,this.elements.collabSpaceCredentialsSelect.value=e.value)}.bind(this)),this.elements.collabSpaceCredentialsSelect.elementsList=n,this.initialSettings.collaborativeSpaceCredentials=this.elements.collabSpaceCredentialsSelect.elementsList[o].label,this.elements.collabSpaceCredentialsSelect.selectedIndex=o}.bind(this))}}},isUpdated:function(){var e=!1;return t.is(this.initialSettings.useTabs)&&this.initialSettings.useTabs!==this.elements.useTabsCheckbox.checked&&(e=!0),t.is(this.initialSettings.csvSeparator)&&this.elements.csvSeparatorSelect.selectedIndex>=0&&this.initialSettings.csvSeparator!==this.elements.csvSeparatorSelect.elementsList[this.elements.csvSeparatorSelect.selectedIndex].label&&(e=!0),t.is(this.initialSettings.dateFormat)&&this.elements.dateFormatSelect.selectedIndex>=0&&this.initialSettings.dateFormat!==this.elements.dateFormatSelect.elementsList[this.elements.dateFormatSelect.selectedIndex].label&&(e=!0),t.is(this.initialSettings.searchResultRevisions)&&this.elements.resultsRevisionsSelect.selectedIndex>=0&&this.initialSettings.searchResultRevisions!==this.elements.resultsRevisionsSelect.elementsList[this.elements.resultsRevisionsSelect.selectedIndex].label&&(e=!0),t.is(this.initialSettings.collaborativeSpaceCredentials)&&this.elements.collabSpaceCredentialsSelect.selectedIndex>=0&&this.initialSettings.collaborativeSpaceCredentials!==this.elements.collabSpaceCredentialsSelect.elementsList[this.elements.collabSpaceCredentialsSelect.selectedIndex].label&&(e=!0),e},setApplyButtonState:function(){this.isUpdated()?this.dialog.buttons.Ok.disabled=!1:this.dialog.buttons.Ok.disabled=!0}})}),define("DS/SNSearchUX/SuggestionUXHelper",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Promise","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchResultCategories"],function(e,t,i,n,s,o){"use strict";return t.singleton(i,{init:function(){},getSuggestionCategories:function(){return o.getActiveCategories(this.ResultCategoryUXHelper._getTenant(),"suggestion")},getSuggestHelper:function(){var e=this;return this._suggestHelperPromise||(this._suggestHelperPromise=new n(function(t,i){require(["DS/SNResultUX/utils/ResultCategoryUXHelper"],function(i){e.ResultCategoryUXHelper=i,i.getResultCategoryUXHelper().then(function(){t()})})})),this._suggestHelperPromise},getSuggests:function(e){return this.ResultCategoryUXHelper.getCategoryResultsCollectionPromise("suggestion",e)},buildSearchParams:function(t){return this.ResultCategoryUXHelper.buildSearchParams(e.extend({group:"suggestion"},t))}})}),define("DS/SNSearchUX/utils/SearchHelpPopup",["UWA/Controls/Abstract","UWA/Core","UWA/Element","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Accordeon","DS/Controls/LineEditor","DS/Controls/Scroller","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/PredefinedQueries","text!DS/SNSearchUX/assets/templates/SearchDropDown/SpecialCharacterDocumentation.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o,a,r,c,l,d,u,h,p,g,_){"use strict";return e.extend({elements:{},init:function(e){this._parent(e),t.is(this.immersiveFrame)||(this.immersiveFrame=new n({}).inject(document.body));var i=this.build();this.dialog=new s({immersiveFrame:this.immersiveFrame,title:"Search Help",content:i,buttons:{Cancel:new o({label:"Close",touchMode:!0,onClick:function(e){this.dialog.close()}.bind(this)})}})},build:function(){var e=this.elements;return e.container=i.create("div",{class:"search-popup-content"}),e.accordeon=new a({items:[{header:"Special Characters",content:this.buildDocumentation()},{header:"Type Shortcuts",content:this.buildPredefinedQueriesComponent()}],style:"filled-separate",touchMode:!0}).inject(e.container),e.accordeon.expandItem(0),e.container},buildDocumentation:function(){var e=i.create("table",{class:"predefined-queries-table"}),n=i.create("tbody").inject(e);return JSON.parse(g).documentation.forEach(function(e){var s=i.create("tr").inject(n),o=i.create("td",{html:e.title}).inject(s),a=i.create("td",{html:e.content}).inject(s);t.is(e.options)&&t.is(e.options.isHeader)?(o.addClassName("predefined-queries-documentation-header"),a.addClassName("predefined-queries-documentation-header")):s.addClassName("predefined-queries-documentation-content")}.bind(this)),e},buildPredefinedQueriesComponent:function(){var e=i.create("div",{class:"predefined-queries-container"});new r({placeholder:"Search",displayClearFieldButtonFlag:!0,touchMode:!0}).inject(e).addEventListener("uncommittedChange",function(e){this.filterPredefinedQueries(e.currentTarget.getElement("input").value)}.bind(this)),this.elements.predefinedQueriesTable=i.create("table",{class:"predefined-queries-table"}).inject(e),this.elements.predefinedQueriesList=i.create("tbody",{class:"predefined-queries-table-body"}).inject(this.elements.predefinedQueriesTable);var n=new h({});return p.fetchPQsFromServer(n).then(function(){var e=p.getPQs(),i=p.getPQNLS(),n=[];t.is(e)&&e.PQ.forEach(function(e){n.push({id:e.pqid,value:e.value,abbreviations:e.abbreviations,title:i[e.pqid+".Title"]})}),n.sort(function(e,t){return e.title<t.title?-1:e.title>t.title?1:0}),this.loadPredefinedQueries(n)}.bind(this)),e},loadPredefinedQueries:function(e){var t=this.elements;this.predefinedQueriesElementList=[],t.predefinedQueriesList.empty();new c(t.predefinedQueriesList,{}).inject(this.elements.predefinedQueriesTable);e.forEach(function(e,n){let s;s=n%2==0?i.create("tr",{class:"predefined-queries-grey"}).inject(t.predefinedQueriesList):i.create("tr",{class:"predefined-queries-white"}).inject(t.predefinedQueriesList),this.predefinedQueriesElementList.push(s);let o=i.create("table").inject(s),a=i.create("tbody").inject(o);i.create("td",{text:e.title,class:"predefined-queries-content-left"}).inject(a);let r=i.create("td",{class:"predefined-queries-content-right"}).inject(a);e.abbreviations.split(",").forEach(function(e){i.create("a",{text:e+":",class:"predefined-queries-content-abbreviation"}).inject(r).addEventListener("click",function(e){let t=e.currentTarget.getText();this.dialog.close(),this.dispatchEvent("setFieldValue",[t])}.bind(this)),i.create("span",{text:" "}).inject(r)}.bind(this))}.bind(this))},filterPredefinedQueries:function(e){if(t.is(e)&&""!==e){var i=0;this.predefinedQueriesElementList.forEach(function(t,n){t.getText().toLowerCase().contains(e.toLowerCase())?(t.show(),t.removeClassName("predefined-queries-white"),t.removeClassName("predefined-queries-grey"),i%2==0?t.addClassName("predefined-queries-grey"):t.addClassName("predefined-queries-white"),i++):t.hide()})}else this.predefinedQueriesElementList.forEach(function(e,t){e.show(),e.removeClassName("predefined-queries-white"),e.removeClassName("predefined-queries-grey"),t%2==0?e.addClassName("predefined-queries-grey"):e.addClassName("predefined-queries-white")})}})}),define("DS/SNSearchUX/helpers/SmartQueries",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/View","UWA/Element","DS/UIKIT/Spinner","DS/Controls/Toggle","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchPreferences","DS/SNSearchUX/helpers/SmartQueryController","DS/SNSearchUX/helpers/SmartQueryUtils","DS/SNSearchUX/dropdown/SearchDropDownUtils","i18n!DS/SNSearchUX/assets/nls/GuidedMode.json"],function(e,t,i,n,s,o,a,r,c,l,d,u,h){"use strict";return n.extend(i,{_container:null,_activatecontainer:null,_content:null,_contentDiv:null,_activationcontent:null,_value:null,_smartQueryControllerInstance:null,_toggle:null,_toggleactivation:!1,_dropdown:null,_spinnerContainerTypes:null,_appContainer:null,_appContainerImage:null,_appContainerText:null,_guidedModeContent:null,init:function(e){return this._container=e.container?e.container:null,this._activatecontainer=e.activationcontainer?e.activationcontainer:null,this._dropdown=e.dropdown?e.dropdown:null,this._content=null,this._contentDiv=null,this._toggle=null,this._value=null,this._smartQueryControllerInstance&&this._smartQueryControllerInstance.destroy()&&(this._smartQueryControllerInstance=null),this._smartQueryControllerInstance=new l({dropdown:this._dropdown,container:this._container,smartQueries:this}),this._toggleactivation=c.getItem("smartMode"),this._spinnerContainerTypes=null,this._appContainer=null,this._appContainerImage=null,this._appContainerText=null,this._guidedModeContent=null,this._parent(e)},initEnd:function(){let t=this;if(!e.is(t._dropdown))return;let i=void 0;if(null===t._spinnerContainerTypes){t._spinnerContainerTypes=s.create("div",{class:"custom-suggestion-container-content-spinner-container"}).inject(t._dropdown.elements.suggestionContainer),i=(new o).inject(t._spinnerContainerTypes).show();s.create("span",{class:"spinner-container-label",text:h.get("smart.mode.loading")}).inject(t._spinnerContainerTypes)}t._smartQueryControllerInstance&&t._smartQueryControllerInstance._buildListOfTypes(),e.is(t._toggleactivation)&&!1!==t._toggleactivation?(t._toggle.inject(t._contentDiv),t._container.show(),t._dropdown.elements.customSuggestions.show(),setTimeout(function(){t._dropdown.elements.dropdownContainer.className.contains("autocomplete-hidden")&&t._dropdown.elements.dropdownContainer.removeClassName("autocomplete-hidden"),e.is(t._dropdown.elements.suggestions)&&t._dropdown.elements.suggestions.setStyle("display","none"),t._disabledInput(),t._hideSections(),t._dropdown.switchActiveTabinstantSearchTab(),t._smartQueryControllerInstance._clickOnChipsEditor()},500),!0===t._dropdown.webInwin&&t._dropdown.eventManager.dispatchEvent("onGuidedMode",!0)):(e.is(t._dropdown.elements.suggestions)&&t._dropdown.elements.suggestions.setStyle("display","block"),t._dropdown.switchActiveTab(t._dropdown.elements.searchTabContainer,t._dropdown.elements.searchTab),t._enabledInput(),t._toggle.inject(t._activationcontent),t._dropdown.elements.customSuggestions.hide());let n=e.extendElement(document.body).getElement(".main");e.is(n)&&n.addEventListener("click",t._clickOut.bind(t));let a=e.extendElement(document.body).getElement(".right");e.is(a)&&a.addEventListener("click",t._clickOut.bind(t))},render:function(){let t=this;if(!e.is(t._dropdown))return;t._content=s.create("div",{class:"smart-queries-content"}).inject(t._container),t._activationcontent=s.create("div",{class:"smart-queries-activation-content"}).inject(t._activatecontainer),t._contentDiv=s.create("div",{class:"smart-queries-content-div"}).inject(t._content);t._smartQueryControllerInstance.render(t._content);t._container.hide(),t._toggle=new a({type:"switch",touchMode:!0,label:h.get("smart.mode.activation"),checkFlag:t._toggleactivation}),t._toggle.addEventListener("buttonclick",function(i){if(e.is(i)&&e.is(i.dsModel)){let n=i.dsModel;if(e.is(n)){if(t._toggleactivation=n.checkFlag,!0===t._toggleactivation)t._toggle.inject(t._contentDiv),t._container.show(),e.is(t._dropdown.elements.suggestions)&&t._dropdown.elements.suggestions.setStyle("display","none"),t._disabledInput(),t._hideSections(),t._dropdown.switchActiveTabinstantSearchTab(),t._smartQueryControllerInstance._buildSuggestion(),t._smartQueryControllerInstance._updateUI(),t._smartQueryControllerInstance.focusEditor(),t._dropdown.elements.customSuggestions.show(),!0===t._dropdown.webInwin&&t._dropdown.eventManager.dispatchEvent("onGuidedMode",!0);else{t._dropdown.switchActiveTab(t._dropdown.elements.searchTabContainer,t._dropdown.elements.searchTab),t._enabledInput(),t._toggle.inject(t._activationcontent),t._container.hide(),e.is(t._dropdown.elements.suggestions)&&t._dropdown.elements.suggestions.setStyle("display","block"),t._smartQueryControllerInstance._updateUI(!1),t._hidesearchResultsSections(),t._dropdown.elements.customSuggestions.hide(),t._dropdown.onClick();let i=u.getMyContentView();e.is(i)||t._dropdown.refreshMyContent(),!0===t._dropdown.webInwin&&t._dropdown.eventManager.dispatchEvent("onGuidedMode",!1)}c.setItem("smartMode",t._toggleactivation),c.commit()}}})},renderRight:function(t){e.is(this._dropdown)&&(this._dropdown.elements.searchResultsContainer=s.create("div",{class:"searchResults-container"}).inject(this._dropdown.elements.instantSearchContainer).hide())},isToggleactivation:function(){return this._toggleactivation},_disabledInput:function(){let t=this;if(e.is(t._dropdown)){t._dropdown.setPlaceHolderValue(h.get("search.fromsearchResults.title")),t._dropdown.elements.input.removeClassName("enabled"),t._dropdown.elements.input.setAttribute("disabled",""),t._dropdown.elements.input.addClassName("disabled");let i=document.querySelector(".run_btn_search.fonticon.fonticon-search");e.is(i)&&e.is(i.removeClassName,"function")&&(i.removeClassName("enabled"),i.addClassName("disabled")),i=document.querySelector(".run_ctn_search.ctn_search"),e.is(i)&&e.is(i.removeClassName,"function")&&(i.removeClassName("enabled"),i.addClassName("disabled"))}},_enabledInput:function(){let t=this;if(e.is(t._dropdown)){t._dropdown.elements.input.removeAttribute("disabled"),t._dropdown.elements.input.removeClassName("disabled"),t._dropdown.elements.input.addClassName("enabled");let i=document.querySelector(".run_btn_search.fonticon.fonticon-search");e.is(i)&&e.is(i.removeClassName,"function")&&(i.removeClassName("disabled"),i.addClassName("enabled")),i=document.querySelector(".run_ctn_search.ctn_search"),e.is(i)&&e.is(i.removeClassName,"function")&&(i.removeClassName("disabled"),i.addClassName("enabled"))}},_hideSections:function(){let t=this;if(!e.is(t._dropdown))return;t._dropdown.categoryList.forEach(function(t){e.is(t)&&(t.container.hide(),t.header.hide())});let i=u.getCategoryContentView();if(i&&i.hide(),t._appContainer&&t._appContainer,!0===t._smartQueryControllerInstance._bresultFound)t._showsearchResultsSections();else{let i=t._dropdown.elements.instantSearchEmptyView;e.is(i)&&(t._dropdown.elements.instantSearchEmptyView.hide(),e.is(t._guidedModeContent)||(t._guidedModeContent=u.buildguidedModeDiv({controller:t._smartQueryControllerInstance,parent:i.getParent()})),e.is(t._guidedModeContent)&&t._guidedModeContent.show(),t._dropdown.elements.searchResultsContainer&&t._dropdown.elements.searchResultsContainer.hide())}},_showsearchResultsSections:function(){let t=void 0;if(!e.is(this._dropdown))return t;this._guidedModeContent&&this._guidedModeContent.hide(),this._dropdown.elements.instantSearchEmptyView&&this._dropdown.elements.instantSearchEmptyView.hide(),this._dropdown.elements.searchResultsContainer&&this._dropdown.elements.searchResultsContainer.show();let i=u.getCategoryContentView();return i&&i.hide(),this._dropdown.categoryList.forEach(function(e){e.title.getAttribute("title")===h.get("search.searchResults.title")&&((t=e).container.show(),t.header.show(),t.spinner.hide())}),t},_hidesearchResultsSections:function(){let t=void 0;return e.is(this._dropdown)?(this._guidedModeContent&&this._guidedModeContent.hide(),this._dropdown.elements.instantSearchEmptyView&&this._dropdown.elements.instantSearchEmptyView.hide(),this._dropdown.elements.searchResultsContainer&&this._dropdown.elements.searchResultsContainer.hide(),this._dropdown.categoryList.forEach(function(e){e.title.getAttribute("title")===h.get("search.searchResults.title")&&((t=e).container.hide(),t.header.hide(),t.spinner.hide())}),t):t},_applySearch:function(){e.is(this._smartQueryControllerInstance)&&this._smartQueryControllerInstance._applySearch()},clean:function(){this._value="",this._smartQueryControllerInstance.clean()},_displayApp:function(t){let i=this;e.is(i._dropdown)&&e.is(t)&&(null===i._appContainer&&(i._appContainer=s.create("div",{class:"instant-search-app-view",title:h.get("smart.mode.section.start").replace("###",t.title)}).inject(i._dropdown.elements.instantSearchContainer).hide(),i._appContainerImage=s.create("div",{class:"instant-search-app-view-image"}).inject(i._appContainer),i._appContainerText=s.create("div",{class:"instant-search-app-view-text",text:"No found"}).inject(i._appContainer),i._appContainer.dropdown=i._dropdown,i._appContainer.addEvent("click",function(e){d.launchApp({dropdown:this.dropdown,appInfos:this.appInfos})})),e.is(t)&&i._appContainer&&(i._appContainer.appInfos=t,i._appContainer.title=h.get("smart.mode.section.start").replace("###",t.title),i._hideSections(),i._hidesearchResultsSections(),i._dropdown.elements.instantSearchEmptyView.hide(),i._dropdown.elements.instantSearchEmptyView.hide(),i._appContainer.show(),i._appContainerImage.style.backgroundImage="url("+t.icon+")",i._appContainerText.setText(t.title)))},_clickOut:function(t){let i=this;e.is(i._dropdown)&&(i._dropdown.elements.dropdownContainer.className.contains("autocomplete-hidden")||!0===i._toggleactivation&&(r.log("SmartQueryController::_clickOut"),i._dropdown.onBlur(void 0,!0),i._enabledInput(),setTimeout(function(){i._dropdown&&i._dropdown.setInputValue(""),i._dropdown&&i._dropdown.setPlaceHolderValue(h.get("search.fromsearchResults.title"))},500)))},destroy:function(){let t=e.extendElement(document.body).getElement(".main");e.is(t)&&t.removeEventListener("click",_this._clickOut.bind(_this));let i=e.extendElement(document.body).getElement(".right");return e.is(i)&&i.removeEventListener("click",_this._clickOut.bind(_this)),this._smartQueryControllerInstance&&this._smartQueryControllerInstance.destroy(),this._parent()}})}),define("DS/SNSearchUX/SearchUX_TopBar",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Debug","UWA/Class/Options","UWA/Class/Collection","UWA/Promise","DS/TransientWidget/TransientWidget","DS/PubSub/PubSub","DS/MessageBus/MessageBus","DS/SNInfraUX/SearchVersioning","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchUtils","DS/SNSearchUX/InContextSearch","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchControlCenterFetchService","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SearchLogin","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SNInfraUX/Api/SearchApi","DS/SNInfraUX/SearchRevisionDelegator","i18n!DS/SNSearchUX/assets/nls/SNSearchUX.json","DS/SNInfraUX/Logger","DS/SNSearchUX/SearchUxPowerBy","DS/TransientWidget/Tool/TransientMessaging","DS/TransientWidget/Tool/Mapping"],function(e,t,i,n,s,o,a,r,c,l,d,u,h,p,g,_,m,S,f,v,C,y,w,b,D,E,I,T){"use strict";return t.singleton(i,n,{_resourcesMgt:null,_selectedSource:null,_url_settings:{},_socket:null,_active_3dsearch_widget:null,_wdg_ready:!0,_ctx_search:null,_currentTabId:null,_topframe_search_delegation:!1,_SWFilteringCheckDone:!0,result_ux_customization:{},_PQEvaluationPromisePC:o.deferred(),_EasyType:null,_sidePanelClose:!0,_topFrame:null,_firstInit:!1,_sidePanelHide:!1,searchUxPowerBy:null,_stackTransient:[],_prevent3dSearchSidePanelPositionBack:!1,isCtxWdg:!1,init:function(t){D.group("SearchUX_TopBar.init"),D.log("JS code level for search: ",l.getCurrentVersion()),D.log("options:",t);var i=this;this.isCtxWdg=!1,I.getInstance().on(T.TransientMessaging.ShowWidget,function(e){if(void 0!==i.getAddinMode())return;if(!0===u.getItem("integratedSearch")&&i._topFrame&&"X3DOPMR_AP"!==e.appId&&"X3DMCTY_AP"!==e.appId)return i._topFrame._frame.closePanel("right","search"),i._topFrame._onRightPanelStateChange("closed"),i._stackTransient=[],void(i._prevent3dSearchSidePanelPositionBack=!0);i._stackTransient.push(e.appId);let t=g.getSearchAppId();t!==e.appId&&-1!==i._stackTransient.indexOf(t)&&(i._stackTransient=[],a.closeWidget(t))});var n=window.location.search.substring(1);if(n){for(var s=n.split("&"),p=0;p<s.length;p++){var _=s[p].split("=");1===_.length?this._url_settings[_[0]]=!0:2===_.length&&_[0].length>0&&(this._url_settings[_[0]]=_[1])}h.urlSettings(this._url_settings)}for(let e=0,i=t.events.length;e<i;e++)void 0===t.events[e]&&unset(t.events[e]);this.setOptions(t),e.is(t)&&e.is(t.userId)?(g.setUserId(t.userId),D.log("Connected User = "+g.getUserId())):D.log("SearchTopBar:init Input options do not contain the connected userId"),!0===h.getOption("forceSearchTransientAndNoTab")?(u.setItem("integratedSearch",!1),u.commit({})):!0!==h.getOption("publicBetaUser")||"tablet"!==g.getDeviceType()&&""!==g.getDeviceCategory()||"3DSwym"===g.identifyClientInfo().identifier||"3DSpace"===g.identifyClientInfo().identifier||void 0!==this.getAddinMode()||(u.setItem("integratedSearch",!0),u.commit({})),this.searchUxPowerBy=new E({addinMode:this.getAddinMode()}),g.activateCompactOrComfortMode(),g.ensureBetaStatus().then(function(){this.setDebugMode(h.getDebugMode()),this._resourcesMgt=new d(e.is(t)?t.ressources:{}),y.setResourceMgt(this._resourcesMgt);var n=this._resourcesMgt.getActiveTenant();w.initialize(n),h.getTenantSettings(n).then(function(){g.activateCompactOrComfortMode(n),void 0!==t&&void 0!==this.options.ressources&&this._buildUI();var s=g.identifyClientInfo();e.is(s)&&"3DSwym"!==s||r.add("tab:change",function(e){i._currentTabId=e,i.computeSearchBar(e)}),r.add("dashboard:change",function(){i._socket.dispatchEvent("clearSearch",{noFocus:!0}),e.is(i._topFrame)&&(i._topFrame._frame.closePanel("right",{}),i._topFrame._onRightPanelStateChange("closed"))}),e.is(i.options.searchParams)&&(e.is(i.options.searchParams.close,"function")&&e.is(i.options.searchParams.isOpen,"function")&&e.is(i.options.searchParams.open,"function")&&(i._topframe_search_delegation=!0),i.options.searchParams.pqAccessEvalcallback&&(i.pqAccessEvalcallback=i.options.searchParams.pqAccessEvalcallback),i.options.searchParams.resultUX_customization&&i._addResultUX_customization(i.options.searchParams.resultUX_customization),e.is(i.options.searchParams.searchHelper,"function")&&(i.searchHelper=i.options.searchParams.searchHelper),e.is(i.options.searchParams.search_settings,"object")&&h.initialize({search_settings:i.options.searchParams.search_settings}),g.autocompleteRendered().then(function(){e.is(i.options.searchParams.onSearchInit,"function")&&i.options.searchParams.onSearchInit.call()}));require(["DS/TopFrame/TopFrame"],function(n){i._topFrame=n,!0===u.getItem("integratedSearch")&&(e.is(t.events)&&e.is(t.events.initFrame,"function")&&t.events.initFrame.call(void 0,i._topFrame),e.is(i._topFrame)&&e.is(i._topFrame._frame)&&(i._topFrame._frame.addEvent("onPanelClose",function(t){g.isFUN109031Active()&&e.is(t)&&e.is(t.panel)&&"left"===t.panel&&e.is(t.tag)&&"myAppsCtn"===t.tag&&(h.options.search_settings.taggerClosed=!0,c.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"showEmbeddedView"})),g.isFUN109031Active()&&e.is(t)&&e.is(t.panel)&&"left"===t.panel&&e.is(t.tag)&&"taggerCtn"===t.tag&&(h.options.search_settings.taggerClosed=!0),e.is(t)&&e.is(t.tag)&&"taggerCtn"!==t.tag&&("right"===t.panel&&c.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"datagrid_preference_force_close"}),"right"===t.panel&&(i._sidePanelStatus=g.SidePanelStatus.SIDE_PANEL_CLOSED),i._sidePanelClose=!0,i._sidePanelHide=!0,i._socket.dispatchEvent("showSearchInThisTab"),e.is(t)&&e.is(t.panel)&&"left"===t.panel&&e.is(t.tag)&&"dashboardMenuCtn"===t.tag||(i._socket.dispatchEvent("onCloseTransientTopBar"),i._socket.dispatchEvent("showSearchInThisTab"),c.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"datagrid_preference_force_close"})),"right"===t.panel&&t.tag===g.getSearchAppId()&&(c.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"sidePanelClosed"}),i._ctx_search.incontextSidepanelStatusPromise||(i._ctx_search.incontextSidepanelStatusPromise=o.deferred()),i._ctx_search.incontextSidepanelStatusPromise&&i._ctx_search.incontextSidepanelStatusPromise.resolve()),!0===g.isTaggerOpenedByCode()&&i._socket.dispatchEvent("closeTagger"))}),i._topFrame._frame.addEvent("onPanelOpen",function(t){"right"===t.panel&&!0===i._sidePanelClose&&(e.is(i._topFrame.isTaggerVisible,"function")&&!0===i._topFrame.isTaggerVisible()?g.setTaggerOpenedByCode(!1):g.setTaggerOpenedByCode(!0),i._sidePanelStatus=g.SidePanelStatus.SIDE_PANEL_OPEN),t.position&&"right"===t.panel&&"maximized"===t.position&&e.is(i._topFrame.isTaggerVisible,"function")&&!1===i._topFrame.isTaggerVisible()&&e.is(i.options.events.openTagger,"function")&&g.getSearchAppId()===t.tag&&i._isOpenTaggerSidePanelViewOnSearch()&&(!e.is(h.options.search_settings.taggerClosed)||e.is(h.options.search_settings.taggerClosed)&&0==h.options.search_settings.taggerClosed)&&(i.options.events.openTagger(),g.setTaggerOpenedByCode(!0)),setTimeout(function(){if(e.is(t)&&e.is(t.tag)&&t.tag===g.getSearchAppId()&&e.is(t.position)){var n=0,s=i._isSearchWidgetAvailable();if(n=void 0===s.maxIndex&&void 0!==s.indexSide?s.indexSide:s.maxIndex,e.is(s.wdg_search_items)&&s.wdg_search_items.length>0&&e.is(s.wdg_search_items[n])){var o=s.wdg_search_items[n].get("widget_id");if(e.is(o)){let n=g.getSearchWidget(o),s=!1;if(e.is(n)&&e.is(n.getValue,"function")&&(s=n.getValue("previewMode")),"fitted"===t.position||"maximized"===t.position)i._socket.dispatchEvent("hideSearchInThisTab"),e.is(i._topFrame.isTaggerVisible())&&i._topFrame.isTaggerVisible()&&g.getsearchType()===g.SearchTypeEnum.ADVANCED_SEARCH&&(i._socket.dispatchEvent("showAdvancedSearch",{adv_search_field:null,widgetId:o,sidePanelStatus:i._sidePanelStatus}),g.setTaggerOpenedByCode(!0)),i._socket.dispatchEvent("manageActionIconOnSidePanel",{widgetId:o,activation:!1,position:t.position});else{i._socket.dispatchEvent("showSearchInThisTab"),i._socket.dispatchEvent("manageActionIconOnSidePanel",{widgetId:o,activation:!0,position:t.position});var a=document.querySelector("#tagnavigator > div.tnmax-tagger");e.is(a)&&(a=a.getStyle("display")),e.is(a)&&"block"===a||!0===g.isTaggerOpenedByCode()&&i._socket.dispatchEvent("closeTagger")}!1===i._prevent3dSearchSidePanelPositionBack?u.setLocalStorageItem("3dSearch-sidePanelPositionBack",t.position):i._prevent3dSearchSidePanelPositionBack=!1}}require(["DS/PlatformAPI/PlatformAPI"],function(e){e.publish("sideOnPanelOpen",t)})}},1e3)})))})}.bind(i))}.bind(this)),D.groupEnd()},_isOpenTaggerSidePanelViewOnSearch:function(){return!0!==g.isFUN109031Active()||this.isCtxWdg},_setSearchFieldCurrentMode:function(t){if(!g.isODTMode())return;let i=e.extendElement(document.body).getElement(".nv-autocomplete-input");e.is(i)&&i.setAttribute("currentmode",t)},setTagPinnedToQuery:function(t){var i=JSON.parse(u.getLocalStorageItem("taggerPinned"))||{};i=i[g.getUserId()]||{};var n="3DDashboard"===g.identifyClientInfo().identifier,s="";(n=(!document.querySelector(".topbar-app-brand")||!document.querySelector(".topbar-app-brand").innerText.match(/enovia/i))&&n)||(s=window.location.hostname);var o=i[s]||{keep:[]},a={};o.keep&&o.keep.forEach(function(e){var t=JSON.parse(e.predicate),i=t.predicate;t.disptext=t.dispValue,delete t.predicate,delete t.dispValue,a[i]=[t]}),!t.refine&&e.is(a,"object")&&Object.keys(a).length>0&&(t.refine={allfilters:a})},computeSearchBar:function(t){var i,n;if(t=t||this._currentTabId||g.getCurrentTabId(),e.is(this._ctx_search)&&e.is(this._ctx_search._socket)){var s=e.Widgets.instances.filter(function(e){return e.context===t&&"maximized"===e.getView().type});1===s.length?(i=s[0],e.is(this._ctx_search._registered_search_ctx)?(n=this._ctx_search.getInContextOptions(i.id),e.is(n)&&!i.getValue("stayOnSearch")?e.is(n.search_delegation)&&"3ddashboard"===n.search_delegation?this._ctx_search._socket.dispatchEvent("onSetFindInTab",n):(this._ctx_search._socket.dispatchEvent("onSetInAppContext",!0),this._ctx_search._socket.dispatchEvent("onSetFindInApp",n)):i.getValue("stayOnSearch")||(this._ctx_search._socket.dispatchEvent("onSetInAppContext",!1),this._ctx_search._socket.dispatchEvent("onSetFindInTab",i.getValue("searchNLS")||null))):!i.getValue("stayOnSearch")&&e.is(i.getTitle,"function")&&"Unified Search"!==i.getTitle()&&this._ctx_search._socket.dispatchEvent("onSetInAppContext",!1)):(this._ctx_search._socket.dispatchEvent("onSetInAppContext",!1),!0===h.getOption("find_in_this_tab_default")?this._socket.dispatchEvent("onSetFindInTab",null):this._socket.dispatchEvent("onSetBackSearchOrFindInTab",{resetNLS:!0,focus:!1}))}},buildPQAccessMap:function(){var e=this;f.fetchPQsFromServer(e._resourcesMgt).then(function(){var t=f.getPQs();if(e.searchHelper){var i={};i.PQ={PQ:t.PQ,requested_info:["access"]},i.onComplete=function(t){var i=t.PQ.PQ;e.pqAccessMap={},i.forEach(function(t){e.pqAccessMap[t.pqid]=t.viewData.access}),e._PQEvaluationPromisePC.resolve()},e.searchHelper.call(void 0,i)}else if(e.pqAccessEvalcallback){var n={PQ:t.PQ,onComplete:function(t){e.pqAccessMap=t,e._PQEvaluationPromisePC.resolve()}};e.pqAccessEvalcallback.call(void 0,n)}else e.pqAccessMap=null,e._PQEvaluationPromisePC.resolve()})},_openEmbeddedTagger:function(){!this._isOpenTaggerSidePanelViewOnSearch()&&g.isFUN109031Active()&&e.is(this.options.events.closeTagger,"function")&&this._socket.dispatchEvent("closeTagger")&&g.setTaggerOpenedByCode(!1),setTimeout(function(){c.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"showEmbeddedView"})},500)},_buildUI:function(){if(!0===h.getOption("universal_search")){var t,i=this;this.log("User "+this.options.userId+" belong to the white list"),C.getPlatformServices({onComplete:function(t){if(e.is(t,"array")){var i=[],n=0,s=t.length;for(n=0;n<s;n++){var o=t[n],a={};a.id=o.platformId,a.name=o.displayName,a.services=[];var r=Object.getOwnPropertyNames(o);if(e.is(r,"array"))for(var c=0,l=r.length;c<l;c++)0===o[r[c]].indexOf("http")&&a.services.push({id:r[c],url:o[r[c]]});i.push(a)}g.setPlatforms(i)}},onFailure:function(){D.log("oFailure")}});var n=function(){D.groupCollapsed("loginToSources");var t="",n=i._resourcesMgt.getAvailableTenants();if(e.is(n,"array")&&1===n.length)t=n[0].tenantId,D.log("Single Tenant: "+t);else if(e.is(n,"array")&&n.length>1){var s=i._resourcesMgt.getActiveTenant();if(D.log("Multiple tenants avaialable, active tenant: "+s),"3DDashboard"===s){var o=u.getItem("defaultTenantId");D.log("Tenant from preferences: "+o),i._resourcesMgt.getTenantInfo(o)?(t=o,D.log("Tenant found in preferences is available")):(D.log("Tenant found in preferences is NOT available"),t=n[0].tenantId)}else t=s}D.log("Tenant for Login is: "+t),D.groupEnd(),v.login({resources:i._resourcesMgt,tenantID:t,onComplete:function(e){var t=[];0===(t=g.getActiveDataSource()).length&&(e.forEach(function(e){t.push(e.name)}),g.setActiveDataSource(t),g.setActiveDataSourcePromise())},onFailure:function(){}}),!0===h.getOption("force_loading_WebUX_js")&&require(["WebUX/WebUX"],function(e){D.log("WebUX is LOADED")})},s=h.getOption("fed_search_init_timeout");e.is(s,"number")&&(0===s?n.call():s>0&&setTimeout(function(){n.call()},1e3*s)),this._intializeSocket(),this._ctx_search=new _({addinMode:this.getAddinMode()}),this._ctx_search.computeSearchBar=this.computeSearchBar.bind(this),this._ctx_search._socket.addListener("addResultUX_customization",function(e){i._addResultUX_customization(e)});var l=function(n){i._EasyType=n.adv_search_field,i._updateTenantFromIncontextOptions(n);var s={selected_source:i._resourcesMgt.toJSON(),openTagger:i.options.events.openTagger,setTaggerMode:i.options.events.setTaggerMode,closeTagger:i.options.events.closeTagger};if(t=i.getResultUX_customization(),e.is(t)&&(s.result_ux_customization=t),!0===i._isWidgetReadyToLaunch()||!1===i._isSearchWidgetAvailable().wdg_available){var o=f.isAPrefixedPQSearch(n.value);if(e.is(i.searchHelper)&&e.is(o)&&!e.is(n.inCtx_widget_id)){var a=f.getPQObjFromPQPrefix(o),r={};r.PQ={PQ:[a],requested_info:["datagridview_columns","global_actions"]},r.onComplete=function(e){var t=e.PQ.PQ[0];t.viewData&&t.viewData.datagridview_columns&&(n.viewData={SearchColumnCustoDefinition:{viewId:"###"+a.pqName,viewDefinition:[]}},a.viewData.datagridview_columns.forEach(function(e){n.viewData.SearchColumnCustoDefinition.viewDefinition.push({uri:e})})),t.viewData&&t.viewData.global_actions&&(n.viewData||(n.viewData={}),n.viewData.global_actions=t.viewData.global_actions),i._launchWdg(s,n)},i.searchHelper.call(void 0,r)}else i._launchWdg(s,n)}},d=function(t,n){var s={};if(e.is(t,"object")&&(s=t),e.is(i.options)&&e.is(i.options.searchParams))if(e.is(i.options.searchParams.source,"array"))s.source=i.options.searchParams.source;else if(e.is(i.options.searchParams.getSources,"function")){var o=i.options.searchParams.getSources();e.is(o,"array")&&(s.source=o)}s.searchType=n,l(s)};this._socket.addListener("search",function(t){i._setSearchFieldCurrentMode("search"),(e.is(t.reSearch)&&!0!==t.reSearch||!e.is(t.reSearch))&&u.getItem("integratedSearch")&&!0===i._sidePanelClose&&i._socket.dispatchEvent("clearfilterbyclosesidepanel"),d(t,g.SearchTypeEnum.SEARCH);c.publish({channel:"TopBar_Suggest",topic:"CancelSuggest",data:!0}),g.setsearchType(g.SearchTypeEnum.SEARCH)}),this._socket.addListener("myContent",function(e){i._setSearchFieldCurrentMode("myContent"),(u.getItem("integratedSearch")&&!0===i._sidePanelClose||g.isFUN109031Active())&&i._socket.dispatchEvent("clearfilterbyclosesidepanel"),d(e,g.SearchTypeEnum.MY_CONTENT),g.setsearchType(g.SearchTypeEnum.MY_CONTENT),i._openEmbeddedTagger()}),this._socket.addListener("myRecentContent",function(e){d(e,g.SearchTypeEnum.MY_RECENT_CONTENT),g.setsearchType(g.SearchTypeEnum.MY_RECENT_CONTENT)}),this._socket.addListener("advancedSearch",function(e){i._setSearchFieldCurrentMode("advancedSearch"),h.getOption("debug")&&D.log("[3dSearch - adv search mode]",g.getsearchType()),u.getItem("integratedSearch")&&!0===i._sidePanelClose&&g.SearchTypeEnum.ADVANCED_SEARCH!==g.getsearchType()&&i._socket.dispatchEvent("clearfilterbyclosesidepanel"),u.setLocalStorageItem("3dSearch-sidePanelPositionBack","fitted"),d(e,g.SearchTypeEnum.ADVANCED_SEARCH),g.setsearchType(g.SearchTypeEnum.ADVANCED_SEARCH),u.setItem("errorManager:limit",void 0),r.dispatch("errorManager:clear")}),this._socket.addListener("favoriteSearches",function(e){i._setSearchFieldCurrentMode("favoriteSearch"),u.getItem("integratedSearch")&&!0===i._sidePanelClose&&i._socket.dispatchEvent("clearfilterbyclosesidepanel"),d(e,g.SearchTypeEnum.FAVORITE_SEARCH),g.setsearchType(g.SearchTypeEnum.FAVORITE_SEARCH),i._openEmbeddedTagger()}),c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"favoriteSearches",callback:function(){u.getItem("integratedSearch")&&!0===i._sidePanelClose&&i._socket.dispatchEvent("clearfilterbyclosesidepanel"),u.setLocalStorageItem("3dSearch-sidePanelPositionBack","fitted"),console.log("fitted"),d({value:g.SearchTypeEnum.FAVORITE_SEARCH,adv_search:!1,searchType:g.SearchTypeEnum.FAVORITE_SEARCH,active_tenant:"OnPremise",value:g.SearchTypeEnum.FAVORITE_SEARCH},g.SearchTypeEnum.FAVORITE_SEARCH),g.setsearchType(g.SearchTypeEnum.FAVORITE_SEARCH)}}),this._socket.addListener("focusOnSearch",l),this._socket.addListener("hideAdvancedSearch",function(){i._socket.dispatchEvent("hideAdvancedSearch",{})}),this._socket.addListener("showAdvancedSearch",function(t){if(e.is(t)&&(!0!==u.getItem("integratedSearch")||"normal"!==u.getLocalStorageItem("3dSearch-sidePanelPositionBack"))){var n=i._isSearchWidgetAvailable();if(e.is(n)&&!0===n.wdg_available){var s=void 0===n.maxIndex&&void 0!==n.indexSide?n.indexSide:n.maxIndex,o=n.wdg_search_items[s].get("widget_id");e.is(o)&&(t.widgetId=o)}t.sidePanelStatus=i._sidePanelStatus,setTimeout(function(){i._socket.dispatchEvent("showAdvancedSearch",t)},3e3)}}),this._socket.addListener("openTagger",function(){e.is(i.options.events.openTagger,"function")&&(i.options.events.openTagger(),g.setTaggerOpenedByCode(!0))}),c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"openTagger",callback:function(){e.is(i.options.events.openTagger,"function")&&(i.options.events.openTagger(),g.setTaggerOpenedByCode(!0))}}),r.add("search:refreshSearchField",function(e){i._socket.dispatchEvent("onRefreshSearchField",e)}),this._socket.addListener("setTaggerMode",function(t){if(e.is(i.options.events.setTaggerMode,"function")&&i.options.events.setTaggerMode(t),!0===i._firstInit&&e.is(t)&&"criteria"===t){var n=i._isSearchWidgetAvailable();if(e.is(n)&&!0===n.wdg_available){var s=0;s=void 0===n.maxIndex&&void 0!==n.indexSide?n.indexSide:n.maxIndex;var o=n.wdg_search_items[s].get("widget_id");e.is(o)&&(!e.is(u.getItem("integratedSearch"))||!0===u.getItem("integratedSearch")&&"normal"!==u.getLocalStorageItem("3dSearch-sidePanelPositionBack"))&&i._socket.dispatchEvent("showAdvancedSearch",{adv_search_field:null,widgetId:o,sidePanelStatus:i._sidePanelStatus})}i._firstInit=!1}}),this._socket.addListener("closeTagger",function(){e.is(i.options.events.closeTagger,"function")&&i.options.events.closeTagger()}),this._socket.addListener("clearSearch",function(){"3DDashboard"===i._resourcesMgt.getActiveTenant()&&e.is(i.options.events.clearSearch,"function")&&i.options.events.clearSearch.call(void 0,null)}),this._socket.addListener("closeTransient",function(t){e.is(i.options.events.closeTagger,"function")&&i.options.events.closeTagger.call(void 0,null),i._topframe_search_delegation?i.options.searchParams.close.call(void 0,t):h.getOption("transient_widget")&&(i._stackTransient=[],a.closeWidget(g.getSearchAppId()))}),this._socket.addListener("onDragStart",function(){i._topframe_search_delegation?i.options.searchParams.close.call():e.is(i.options)&&e.is(i.options.addinMode)&&e.is(i.options.addinMode.value,"string")&&("solidworks"===i.options.addinMode.value||"catiav5"===i.options.addinMode.value)||!1!==u.getItem("integratedSearch")||setTimeout(function(){!0===g.isTaggerOpenedByCode()&&i._socket.dispatchEvent("closeTagger"),a.hide()},250),!0===u.getItem("integratedSearch")&&e.is(i._topFrame)&&e.is(i._topFrame._frame)&&(i._topFrame._frame.isPanelMaximized("right")||i._topFrame._frame.isPanelFitted("right"))&&(i._topFrame._frame.closePanel("right",{}),i._topFrame._onRightPanelStateChange("closed"))}),this._socket.addListener("onReshow",function(){e.is(i.options)&&e.is(i.options.addinMode)&&e.is(i.options.addinMode.value,"string")&&("solidworks"===i.options.addinMode.value||"catiav5"===i.options.addinMode.value)||(i._stackTransient=[],a.closeWidget(g.getSearchAppId()))}),this._socket.addListener("onShowPQListUX",function(){i.buildPQAccessMap(),i._PQEvaluationPromisePC.promise.then(function(){require(["DS/SNResultUX/SearchPQListUX"],function(e){e.showPQSelector({pqAccessMap:i.pqAccessMap,pqSelectionCallback:function(e){i._socket.dispatchEvent("onPQPrefixSelect",e)}})})})}),this._socket.addListener("getsearchTopbarResouceJson",function(t){i._socket.dispatchEvent("searchTopbarResouceJson",{resources:i._resourcesMgt.toJSON(),tenants:i._resourcesMgt.getAvailableTenants(),active_tenant:i._resourcesMgt.getActiveTenant()},e.is(t)?t.socket_id:null)}),this._socket.addListener("fetchPQsFromServer",function(){f.fetchPQsFromServer(i._resourcesMgt)}),this._socket.addListener("hideSidePanel",function(){e.is(i._topFrame)&&e.is(i._topFrame._frame)&&(i._topFrame._frame.closePanel("right","search"),i._topFrame._onRightPanelStateChange("closed")),i._topFrame._onRightPanelStateChange("closed"),i._sidePanelHide=!0}),this._socket.addListener("3DSearchWidgetmaximized",function(e){if(!0===u.getItem("integratedSearch")&&i._topFrame&&"search"===i._topFrame._visibleXApp){var t=i._topFrame._frame.isPanelOpen("right");"windowed"===e&&!1===i._sidePanelHide?(i._topFrame._updateColumn("right","search"),i._sidePanelHide=!0):"maximized"===e&&!0===t?(i._sidePanelHide=!1,i._topFrame._frame.closePanel("right","search"),i._topFrame._onRightPanelStateChange("closed")):null===t&&"windowed"===e&&!0===i._sidePanelHide&&!0!==i._sidePanelClose&&i._topFrame._updateColumn("right","search")}}),this._socket.addListener("topBar-LastSearch-clearLocalFilter",function(){u.getItem("integratedSearch")&&!0===i._sidePanelClose&&i._socket.dispatchEvent("clearfilterbyclosesidepanel")}),c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"deactivateIncontextSearchStarted",callback:function(e){i._ctx_search.incontextSidepanelStatusPromise||(i._ctx_search.incontextSidepanelStatusPromise=o.deferred());var t=i.isIntegratedSearch();e.closeSidePanel&&t&&i._ctx_search._incontextSidepanelStatus?(i._topFrame._frame.closePanel("right",{}),i._topFrame._onRightPanelStateChange("closed"),i._socket.dispatchEvent("closeTagger")):i._ctx_search.incontextSidepanelStatusPromise.resolve(),i._ctx_search.deactivateIncontextSearchPromise||(i._ctx_search.deactivateIncontextSearchPromise=o.deferred()),o.all([i._ctx_search.deactivateIncontextSearchPromise.promise,i._ctx_search.incontextSidepanelStatusPromise.promise]).then(function(){i._ctx_search.setIncontextSearchActive(!1)})}}),c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"deactivateIncontextSearchEnded",callback:function(){i._ctx_search.deactivateIncontextSearchPromise&&i._ctx_search.deactivateIncontextSearchPromise.resolve()}}),c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"checkSidePanelStatus",callback:function(){i._ctx_search._incontextSidepanelStatus=i._sidePanelClose}}),c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"search-maximiseEditingFavoriteSearch",callback:function(){"search"===i._topFrame._visibleApp&&i._topFrame.openPanel("right",{appId:g.getSearchAppId(),fit:!0}).then(function(){i._topFrame._onRightPanelStateChange("fitted")})}}),c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"onDeactivateIncontextSearchNoTab",callback:function(){i._topFrame._frame.closePanel("right",{}),i._topFrame._onRightPanelStateChange("closed"),i._forceRelaunchSearch=!0}})}},_intializeSocket:function(){this.log("_intializeSocket");var t=this;this._active_3dsearch_widget=new s,this._socket=p.createSocket({socket_id:"searchtopbar_socket_id"}),e.is(this.options)&&e.is(this.options.x3dPlatformId,"string")&&this._resourcesMgt.setActiveTenant(this.options.x3dPlatformId),g.getSearchViewPromise().then(function(){D.log("SearchView promise resolved"),t._socket.dispatchEvent("onSetSources",{sources:t._resourcesMgt.toJSON(),searchParams:t.options.searchParams}),e.is(t.getAddinMode(),"string")&&require(["DS/PlatformAPI/PlatformAPI"],function(e){g.getPowerByInitPromise().then(function(){D.log("publishing search_ready event"),e.publish("webinwin:web:notification",JSON.stringify({event:"search_ready",source:g.getSearchAppId(),version:"1.0",content:{status:!0}}))})}),g.setSearchReady()}),this._socket.addListener("setSelectedSource",function(e){D.log("The selected source have been modified ["+e.value+"]");try{t._resourcesMgt.setActiveTenant(e.value)}catch(t){D.log("SearchRessources.setActiveTenant throw an error (invalid tenant="+e.value+")")}}),this._socket.addListener("onSearch",function(i){if(D.log("Launch command from the result wdg ["+i+"]"),e.is(i.parameters,"object")&&e.is(i.parameters.search_criteria)){if(e.is(i.tabInfo,"object")&&e.is(i.tabInfo.tenant,"string")&&!0===i.transient_widget){try{t._resourcesMgt.setActiveTenant(i.tabInfo.tenant)}catch(e){D.log("SearchRessources.setActiveTenant throw an error (invalid tenant="+i.tabInfo.tenant+")")}t._socket.dispatchEvent("onSelectTenantAfterTabActivation",{tenant:i.tabInfo.tenant})}var n={focus:!1,setTenant:!1};e.is(i.parameters.search_criteria_to_display,"string")&&(n.searchStringToDisplayInSearchField=i.parameters.search_criteria_to_display);var s=!i.in_apps_search&&e.is(i.tabInfo,"object")&&(!0===i.transient_widget||"3DDashboard"!==i.tabInfo.client_identifier);if(i.parameters.search_criteria===g.SearchTypeEnum.MY_CONTENT)s&&t._socket.dispatchEvent("clickOnChoiceMyContent",n);else if(i.parameters.search_criteria===g.SearchTypeEnum.FAVORITE_SEARCH)s&&t._socket.dispatchEvent("clickOnChoiceFavoriteSearch",n);else if(i.parameters.search_criteria===g.SearchTypeEnum.MY_RECENT_CONTENT);else if(!0===i.parameters.adv_search||i.parameters.search_criteria===g.SearchTypeEnum.ADVANCED_SEARCH)s&&t._socket.dispatchEvent("clickOnChoiceAdvancedSearch",n);else{var o=i.parameters.search_criteria;e.is(i.parameters.originalSearchCriteria,"string")&&(o=i.parameters.originalSearchCriteria),e.is(i.parameters.search_criteria_to_display,"string")&&(o=i.parameters.search_criteria_to_display);var a=o,r=i.parameters.search_criteria,c=t._isWidgetMaximized(i.widget_id,t._currentTabId);i.transient_widget||"3DSwym"===g.identifyClientInfo().identifier||c&&i.in_apps_search||(a=null,r=null);var l=!1;!0===c&&!1===i.transient_widget&&(l=!0),t._socket.dispatchEvent("onRefreshSearchField",{searchStringToDisplayInSearchField:a,internalSearchCriteria:r,isPinnedWidgetMaximized:l}),s&&(n.hiddenOptions=[b.search_current_tab],t._socket.dispatchEvent("clickOnChoiceSearch",n))}}}),this._socket.addListener("onSearchModeSwitch",function(i){e.is(i,"object")&&e.is(i.new_mode,"string")&&(t._socket.dispatchEvent("onSwitchMode",i),i.new_mode===g.SearchTypeEnum.MY_RECENT_CONTENT&&"*"===i.paramsFilter&&t._socket.dispatchEvent("onRefreshSearchField",""))}),this._socket.addListener("onSearchFromCompass",function(i){t.init3DSearchWidgetCreatedFromCompass(i);var n=h.getOption("search_compact_mode")||"tablet"===g.getDeviceType();if(!(e.is(window)&&e.is(window.innerWidth)&&!(window.innerWidth>958)||e.is(t.getAddinMode(),"string")&&-1!==["solidworks","catiav5"].indexOf(t.getAddinMode())||!1!==n||!0===h.options.search_settings.taggerClosed)){require(["DS/TopFrame/TopFrame"],function(i){var n=!1;if(e.is(i))try{e.is(i.isTaggerVisible,"function")&&!0===i.isTaggerVisible()&&(n=!0)}catch(t){e.is(i._isTaggerVisible)&&!0===i._isTaggerVisible&&(n=!0),D.log(t)}var s=u.getLocalStorageItem("3dSearch-sidePanelPositionBack")||"fitted";!1===n&&e.is(t.options.events.openTagger,"function")&&"normal"!==s&&!0!==g.isFUN109031Active()&&-1===["iphone","android"].indexOf(g.getDeviceCategory())?(t.options.events.openTagger(),g.setTaggerOpenedByCode(!0)):g.setTaggerOpenedByCode(!1)})}"windowed"!==i.mode&&("3DSwym"!==g.identifyClientInfo().identifier&&t._socket.dispatchEvent("onSetFocusInSearchField",{}),setTimeout(function(){e.is(i)&&e.is(i.x3dPlatformId,"string")&&i.x3dPlatformId.length>0&&t._socket.dispatchEvent("onSelectTenant",i.x3dPlatformId)},200))}),this._socket.addListener("onWdgEndEdit",function(){t._wdg_ready=!0}),this._socket.addListener("onWdgCreation",function(i){if(e.is(i.widget_id)){var n=!1;e.is(i.tabid)&&(t._currentTabId=i.tabid,n=!0);var s=t._currentTabId;null===s&&(s=g.getCurrentTabId());var o=t._isWidgetMaximized(i.widget_id,s);!0===n&&!0===n&&e.is(t._topFrame)&&t._topFrame.toggleTagger&&t._topFrame.toggleTagger(!0),D.log("onWdgCreation"),D.log("Widget id ["+i.widget_id+"]"),D.log("Active Tab id ["+s+"]"),D.log("isMaximized ["+o+"]"),t._active_3dsearch_widget.add({widget_id:i.widget_id,active_tab:s,isMaximized:o,isDefault:"true"===i.transient_widget}),"true"===i.transient_widget&&t._socket.dispatchEvent("hideSearchInThisTab")}t._wdg_ready=!0}),this._socket.addListener("onViewChange",function(i){D.log("onViewChange ["+i.widget_id+"]");var n={active_tab:t._currentTabId,widget_id:i.widget_id},s=t._active_3dsearch_widget.where(n);if(e.is(s)&&1===s.length){D.log("Widget ["+s[0].get("widget_id")+"] in store with maximized option "+s[0].get("isMaximized"));var o=s[0].get("widget_id"),a=t._isWidgetMaximized(o,s[0].get("active_tab"));s[0].set("isMaximized",a),D.log("Maximized option is now set to "+s[0].get("isMaximized"));var r={widgetId:o,maximized:a};t._socket.dispatchEvent("toggleProxyFocus",r)}else D.log("No widget with that id found in the store")}),this._socket.addListener("onDestroyWidget",function(e){var i=t._active_3dsearch_widget.where({widget_id:e.widget_id});t._active_3dsearch_widget.remove(i),p.unsubscribeServer(e.widget_id)}),this._socket.addListener("onCloseTransient",function(){c.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"datagrid_preference_force_close"})}),this._socket.addListener("onSetFocusInSearchField",function(){t._socket.dispatchEvent("onSetFocusInSearchField",{}),setTimeout(function(){var t=require("DS/TopBar/TopBar");e.is(t)&&e.is(t.view)&&e.is(t.view.focusOnSearch,"function")&&t.view.focusOnSearch()},100)}),this._socket.addListener("onSearchItemClick",this._manageExternalIdCardDelegation.bind(this)),g.setSearchUXTopbarSocketInitialized()},_manageExternalIdCardDelegation:function(t){if(e.is(this.options.searchParams)){var i=!0;if(t.in_apps_search&&(i=!e.is(t.in_apps_search.idcard_activated)||t.in_apps_search.idcard_activated),i){var n=!1;t.in_apps_search?n=!!e.is(t.in_apps_search.external_idcard)&&t.in_apps_search.external_idcard:e.is(this.options.searchParams.external_idcard,"function")?n=this.options.searchParams.external_idcard.call():e.is(this.options.searchParams.external_idcard)&&(n=this.options.searchParams.external_idcard),!0===n&&e.is(this.options.searchParams.idcard,"function")&&this.options.searchParams.idcard.call(void 0,t.model)}}},_addResultUX_customization:function(e){var t=this;Object.keys(e).forEach(function(i){t.result_ux_customization[i]=e[i]})},getResultUX_customization:function(e){return e?this.result_ux_customization[e]:Object.keys(this.result_ux_customization).length>0?this.result_ux_customization:void 0},_isSearchWidgetAvailable:function(t){var i={wdg_available:!1,maxIndex:void 0,indexSide:void 0,active_tab:null,wdg_search_items:null};i.active_tab=g.getCurrentTabId(),null===i.active_tab&&(i.active_tab=this._currentTabId);let n=this._active_3dsearch_widget.where({active_tab:i.active_tab}),s=this._active_3dsearch_widget.where({isDefault:!0});if(i.wdg_search_items=function(e){for(var t=e.concat(),i=0;i<t.length;++i)for(var n=i+1;n<t.length;++n)t[i]===t[n]&&t.splice(n--,1);return t}(n.concat(s)),D.log("Check if a widget is available for update"),i.wdg_available=!1,e.is(i.wdg_search_items)&&i.wdg_search_items.length>0){var o=!0;if(e.is(t,"object")&&!0===t.forceWidgetUXRecreation&&(o=!1),o){var a=i.wdg_search_items.length;if(a){D.log("A search widget is already instanciated ==> Check if it is still in the active tab");var r=0;for(r=0;r<a;r++){var c=i.wdg_search_items[r].get("widget_id");e.is(e.Widgets)&&e.is(e.Widgets.instances)&&e.Widgets.instances.length>0&&e.Widgets.instances.filter(function(n){if(n.id===c&&n.context===i.active_tab||n.getValue("search_wdg_id")===c){var s=["maximized","fullscreen"];e.is(t,"object")&&e.is(t.viewType,"string")&&t.viewType.length>0&&(s=[t.viewType]),s.includes(n.getView().type)&&(D.log("Widget available reuse it"),i.wdg_available=!0,i.maxIndex=r),"sidepanel"===n.getView().type&&(D.log("Widget available reuse it Side"),i.wdg_available=!0,i.indexSide=r),e.is(t,"object")&&e.is(t.isRecentContent,"boolean")&&t.isRecentContent&&e.is(t.widgetId)&&n.id===t.widgetId&&(D.log("Type of search is recent content"),i.wdg_available=!0,i.indexSide=r)}})}}}}else D.log("No widget registered in the active tab");return i},init3DSearchWidgetCreatedFromCompass:function(t){var i=this._isSearchWidgetAvailable({viewType:t.mode}),n={};if(n.active_tab=i.active_tab,!0===i.wdg_available){var s=0;if(void 0===i.maxIndex&&void 0!==i.indexSide){if(s=i.indexSide,e.is(t.mode)&&"windowed"===t.mode){var o=this._isSearchWidgetAvailable({viewType:"maximized"});e.is(o)&&e.is(o.maxIndex)&&void 0!==o.maxIndex&&(s=o.maxIndex)}}else s=i.maxIndex;n.ressources=new d(this.options.ressources);try{n.ressources.setActiveTenant(t.x3dPlatformId)}catch(e){D.log("SearchRessources.setActiveTenant throw an error (invalid tenant="+t.x3dPlatformId+")")}this._socket.dispatchEvent("onSearchFromCompassInit",n,"widget_socket_"+i.wdg_search_items[s].get("widget_id"))}},isIntegratedSearch:function(){return u.getItem("integratedSearch")||!1},loadViewData:function(t,i,n){let s=this;if(e.is(t.viewData)||(t.viewData={}),!e.is(t.viewData.global_actions)){var o=s.getResultUX_customization("global_actions");e.is(o)&&e.is(o.actions)&&e.is(o.app_socket_id)&&(t.viewData.global_actions=o),e.is(i)&&(e.is(n.incontext_global_actions)?t.viewData.global_actions={actions:n.incontext_global_actions,app_socket_id:i.app_socket_id}:i.global_actions&&(t.viewData.global_actions={actions:i.global_actions,app_socket_id:i.app_socket_id}))}t.incontext_global_actions=t.viewData.global_actions},_launchWdg:function(t,i){this.log("_launchWdg");var n=this,s=this.isIntegratedSearch();u.getItem("search_tabbed_ui");this.setTagPinnedToQuery(i),this.isCtxWdg=void 0!==i.inCtx_widget_id,h.options.search_settings.adv_search_field=null,e.is(i.adv_search_field,"string")&&i.adv_search_field.length>0&&(h.options.search_settings.adv_search_field=i.adv_search_field);var o=!1;i.searchType===g.SearchTypeEnum.MY_RECENT_CONTENT&&(o=!0);var r,c=this._isSearchWidgetAvailable({forceWidgetUXRecreation:i.forceWidgetUXRecreation,isRecentContent:o,widgetId:i.widgetId});if(i.active_tab=c.active_tab,i&&e.is(i.inCtx_widget_id,"string")&&(r=n._ctx_search.getInContextOptions(i.inCtx_widget_id),e.is(r)&&(i.customization_options=r)),u.getItem("integratedSearch")&&!1===s&&!0===c.wdg_available&&(c.wdg_available=!1),!0===c.wdg_available){var l,d="SearchComServer",p=0;p=void 0===c.maxIndex&&void 0!==c.indexSide?c.indexSide:c.maxIndex,!0===s&&void 0!==c.indexSide&&void 0!==c.maxIndex&&n._topFrame&&n._topFrame._frame&&!0===n._topFrame._frame.isPanelOpen("right")&&(n._topFrame._frame.isPanelMaximized("right")||n._topFrame._frame.isPanelFitted("right"))&&(p=c.indexSide),r&&n.loadViewData(i,r,i);let t=c.wdg_search_items[p].get("widget_id");t&&0===t.indexOf("preview")&&!0!==u.getItem("integratedSearch")&&void 0===this.getAddinMode()&&a.showWidget(g.getSearchAppId()),l="widget_socket_"+t;var _="SearchComServer_"+t;e.is(n._socket.servers,"array")&&n._socket.servers[_]&&(d=_);var S=!0;if(e.is(n._topFrame)&&void 0===c.maxIndex&&!0===s)if(e.is(i)&&e.is(i.fromEmptyString)&&!0===i.fromEmptyString&&(S=!1,!1===n._sidePanelClose&&(S=!0)),!0===n._sidePanelClose||"#advancedSearch"===i.searchType||n._topFrame._visibleXApp){var C={appId:g.getSearchAppId()};"fitted"===(x=u.getLocalStorageItem("3dSearch-sidePanelPositionBack")||"fitted")&&(C.fit=!0),"normal"===x&&(C.minimized=!0),"maximized"===x&&(C.fit=!0),n._topFrame.openPanel("right",C).then(function(){require(["DS/TagNavigator/TagNavigator"],function(e){n._sidePanelClose=!1;let t=Object.assign({},n._topFrame.XAPPS,n._topFrame._externalApps),i=n._topFrame._visibleApp,s=(t&&i&&t[i]||{}).widget,o=e.get6WTagger("RightPanelContext");o&&s&&s.id&&o.setAsCurrent().focusOnCC(s.id)})}),n._topFrame._visibleXApp="search"}else n._topFrame._frame.showPanelContent("right","search");if(i.active_tenant=n._resourcesMgt.getActiveTenant(),!0===i.reSearch&&(S=!0),r&&r.advanced_search&&r.advanced_search.showByDefault&&1!=r.advanced_search.searchOnInit&&(i.adv_search=!0,i.value="#advancedSearch"),!0===S&&n._socket.dispatchEvent("onSearchWdgUpd",i,l,d),"#advancedSearch"===i.searchType){var y={widgetId:t,maximized:!0};n._socket.dispatchEvent("toggleProxyFocus",y)}var w=h.getOption("search_compact_mode")||"tablet"===g.getDeviceType();!0!==h.getOption("debug_mode")&&(!e.is(window)||!e.is(window.innerWidth)||window.innerWidth>958)&&(!e.is(n.getAddinMode(),"string")||-1===["solidworks","catiav5"].indexOf(n.getAddinMode()))&&!1===w&&!0!==h.options.search_settings.taggerClosed&&!0!==h.getOption("no_TopFrame_ODT")&&e.is(n._topFrame)&&e.is(n._topFrame.isTaggerVisible,"function")&&!1===n._topFrame.isTaggerVisible()&&e.is(n.options.events.openTagger,"function")&&r&&"widget_id_#saved_search_edit#"===r.id&&!0===g.isFUN109031Active()&&(n.options.events.openTagger(),g.setTaggerOpenedByCode(!0))}else{if(!0===(!!n._topframe_search_delegation&&n.options.searchParams.isOpen.call()))D.log("A search widget is already instantiated ==> Update its content"),n._socket.dispatchEvent("onSearchWdgUpd",i),n._wdg_ready=!0;else{var b={search_ressources:t.selected_source,transient_context:"true",reSearch:i.refine,settings_topbar:h.serialize(),search_criteria_to_display:i.searchStringToDisplayInSearchField,recent_filter:i.searchStringToDisplayInSearchField};this.searchUxPowerBy&&(b.powerByOptions=this.searchUxPowerBy.getPowerByOptions()),i&&e.is(i.value,"string")&&i.value.length>0?(b.search_criteria=i.value,b.adv_search=i.adv_search,b.adv_search_field=i.adv_search_field):b.focus=!0;var E=!0;if(i){if(e.is(i.searchStringToDisplayInSearchField)&&(b.search_criteria_to_display=i.searchStringToDisplayInSearchField),e.is(r)){if(b.customization_options=r,b.customization_options&&i.advanced_search&&i.advanced_search.showByDefault&&(b.customization_options.advanced_search||(b.customization_options.advanced_search=i.advanced_search),b.adv_search=!0,!0===i.advanced_search.searchOnInit&&(E=!0),b.customization_options.advanced_search.default_search_criteria=i.advanced_search.default_search_criteria,b.search_criteria="#advancedSearch",E=!1),e.is(i.displayValue)?b.search_criteria_to_display=i.displayValue:e.is(b.search_criteria_to_display)||(b.search_criteria_to_display=""),e.is(r.bypass_url)&&("5746ca20-811a-11e4-b116-123b93f75cba"===h.options.search_settings.temp_bypass_fedsearch||"5746cf02-811a-11e4-b116-123b93f75cba"===h.options.search_settings.temp_bypass_fedsearch)){var I=b.search_ressources.available_tenants[b.search_ressources.active_tenant];e.is(I)&&e.is(I.sources)&&e.is(I.sources.search)&&(I.sources.search.url=r.bypass_url,D.log("Temporary bypass of fed_search url by app with UIID "+h.options.search_settings.temp_bypass_fedsearch+": "+I.sources.search.url))}i.recent_search&&(b.customization_options.recent_search=i.recent_search)}e.is(i.content,"string")&&(b.content=i.content),b.viewData=i.viewData,e.is(b.viewData)||(b.viewData={}),n.loadViewData(b,r,i),e.is(i.itemViewClickHandler)?b.itemViewClickHandler=i.itemViewClickHandler:e.is(r)&&e.is(r.itemViewClickHandler)&&r.itemViewClickHandler.trim().length>0&&(b.itemViewClickHandler=r.itemViewClickHandler),e.is(i.source)?b.source=i.source:e.is(r)&&e.is(r.source)&&(e.is(r.source,"array")?b.source=r.source:e.is(r.source,"string")&&(b.source=[r.source])),b.search_mode=e.is(i.search_mode)?i.search_mode:"index"}b.tag_filter=i.tag_filter,e.is(t.result_ux_customization)&&(b.result_ux_customization=t.result_ux_customization);var T=g.getSearchAppId();D.log("Widget App Id: "+T),n._wdg_ready=!1,!0===h.getOption("pcs_analysis")&&D.info("Launch widget at: "+Date.now());if(function(){v.login({resources:n._resourcesMgt,onComplete:function(){},onFailure:function(){D.log("login for helper search FAILED")}});require(["DS/SNResultUX/collections/SearchCollection","DS/SNResultUX/utils/WildcardMgr","DS/SNResultUX/utils/SNResultTypeCustoHelper"],function(t,s,o){var a=function(){if(i&&i.advanced_search&&i.advanced_search.showByDefault&&(i.advanced_search.searchOnInit&&(i.value=i.advanced_search.default_search_criteria),i.advanced_search["ds6w:type"])){var a="";i.advanced_search["ds6w:type"].forEach(function(e){var t=e.uri.split(":");a.length>0&&(a+=" OR "),a=a+'flattenedtaxonomies:"types/'+t[t.length-1]+'"'}),a.length>0&&(e.is(i.value,"string")&&i.value.length>0?i.value=i.value+" AND  ("+a+")":i.value=a)}if(i&&e.is(i.value,"string")&&i.value.length>0){var r=i.value;if(r!==g.SearchTypeEnum.ADVANCED_SEARCH&&E){var c=e.is(i.inCtx_widget_id);c||(r=s.manageWildcardAddtion(r)),m.setResources({resources:n._resourcesMgt});var l=new t(null,{event:{onSetup:function(t){t._isAHelper=!0,t.setSearchRessources(n._resourcesMgt);var s={query:r,mode:b.search_mode,with_synthesis:!g.isFetchSynthesisSeparately(),source:e.is(b.source)?b.source:[],refine:i.refine,originalSearchCriteria:i.searchStringToDisplayInSearchField};if(!e.is(s.source)||s.source.length<1){var a=n.getOption("searchParams");if(e.is(a))if(e.is(a.source,"array"))s.source=a.source;else if(e.is(a.getSources,"function")){var l=n.options.searchParams.getSources();e.is(l,"array")&&(s.source=l)}}if(!c){var d=o.getGlobalSearchTypeCustoQuery(r);e.is(d)&&g.addSourceSpecificParameter(s,{sourceIds:["3dspace"],param:{id:"additional_query",value:d}})}if(e.is(b.customization_options)&&(t._ctx_options=b.customization_options),e.is(t._ctx_options)&&(s.recent_search=t._ctx_options.recent_search,e.is(t._ctx_options.specific_source_parameter))){var u={specific_source_parameter:t._ctx_options.specific_source_parameter};s.context=u}if(t.setRequestCriteria("fed_search",s,c),i.viewData&&i.viewData.SearchColumnCustoDefinition&&i.viewData.SearchColumnCustoDefinition.viewDefinition){var h=[];i.viewData.SearchColumnCustoDefinition.viewDefinition.forEach(function(e){h.push(e.uri)}),t.setAttributesToRetrieve(h)}}},fetchSynthesisSeparately:g.isFetchSynthesisSeparately()});g.setHelperCollection(g.TRANSIENT_WIDGET_HELPER_ID,l),l.getFirstPageOfResults({reset:!0,onComplete:function(){l._currentState=g.HelperCollectionStatus.SEARCH_SUCCEEDED,D.log("helper search succeeded"),e.is(l._CBOnComplete,"function")&&(D.log("launching _CBOnComplete"),l._setTagsPromise&&l._setTagsPromise.resolve(),l._CBOnComplete.apply(l,arguments))},onFailure:function(t,i){l._currentState=g.HelperCollectionStatus.SEARCH_FAILED,D.log("helper search failed"),e.is(l._CBOnFailure,"function")?(D.log("launching _CBOnFailure"),l._CBOnFailure.apply(l,arguments)):l.fedSearch_error=i}}),D.log("helper search launched"),l._currentState=g.HelperCollectionStatus.SEARCH_IN_PROGRESS}}};i&&e.is(i.value,"string")&&i.value.indexOf(":")>0?f.fetchPQsFromServer(n._resourcesMgt).then(()=>{a.call()}):a.call()})}.call(),n._topframe_search_delegation){n.options.searchParams.open.call(void 0,{app_id:T,widget_title:"",preferences_wdg:b});w=h.getOption("search_compact_mode")||"tablet"===g.getDeviceType();!0===h.getOption("debug_mode")||e.is(window)&&e.is(window.innerWidth)&&!(window.innerWidth>958)||e.is(n.getAddinMode(),"string")&&-1!==["solidworks","catiav5"].indexOf(n.getAddinMode())||!1!==w||!0===h.options.search_settings.taggerClosed||!0===h.getOption("no_TopFrame_ODT")||!e.is(n._topFrame)||!e.is(n._topFrame.isTaggerVisible,"function")||!1!==n._topFrame.isTaggerVisible()||!e.is(n.options.events.openTagger,"function")||!0===g.isFUN109031Active()?g.setTaggerOpenedByCode(!1):(n.options.events.openTagger(),g.setTaggerOpenedByCode(!0))}else{let t=g.identifyClientInfo();if(e.is(n._topFrame)&&(!0===s||"3DSwym"===t.identifier&&!1===t.deprecated)){var x,M={appId:T,data:b,sidePanel:!0};"fitted"===(x=u.getLocalStorageItem("3dSearch-sidePanelPositionBack")||"fitted")&&(M.fit=!0),"normal"===x&&(M.minimized=!0),"maximized"===x&&(M.fit=!0),n._topFrame._visibleXApp="search",n._topFrame.openPanel("right",M).then(function(){require(["DS/TagNavigator/TagNavigator"],function(e){n._sidePanelClose=!1;let t=Object.assign({},n._topFrame.XAPPS,n._topFrame._externalApps),i=n._topFrame._visibleApp,s=(t&&i&&t[i]||{}).widget,o=e.get6WTagger("RightPanelContext");o&&s&&s.id&&o.setAsCurrent().focusOnCC(s.id)})}),n._firstInit=!0}else{b.x3dPlatformId=b.search_ressources.active_tenant,a.showWidget(T,"",b);w=h.getOption("search_compact_mode")||"tablet"===g.getDeviceType();!0===h.getOption("debug_mode")||e.is(window)&&e.is(window.innerWidth)&&!(window.innerWidth>958)||e.is(n.getAddinMode(),"string")&&-1!==["solidworks","catiav5"].indexOf(n.getAddinMode())||!1!==w||!0===h.options.search_settings.taggerClosed||!0===h.getOption("no_TopFrame_ODT")||!e.is(n._topFrame)||!e.is(n._topFrame.isTaggerVisible,"function")||!1!==n._topFrame.isTaggerVisible()||!e.is(n.options.events.openTagger,"function")||!0===g.isFUN109031Active()?g.setTaggerOpenedByCode(!1):(n.options.events.openTagger(),g.setTaggerOpenedByCode(!0))}}}}},_isWidgetReadyToLaunch:function(){return this._wdg_ready},_updateTenantFromIncontextOptions:function(t){if(e.is(t))if(e.is(t.tenant))try{this._resourcesMgt.setActiveTenant(t.tenant)}catch(e){D.log("SearchRessources.setActiveTenant throw an error (invalid tenant="+t.tenant+")")}else if(e.is(t.inCtx_widget_id,"string")){var i=this._ctx_search.getInContextOptions(t.inCtx_widget_id);if(e.is(i)&&e.is(i.tenant))try{this._resourcesMgt.setActiveTenant(i.tenant)}catch(e){D.log("SearchRessources.setActiveTenant throw an error (invalid tenant="+i.tenant+")")}else{var n=this._resourcesMgt.getAvailableTenants();1===n.length&&this._resourcesMgt.setActiveTenant(n[0].tenantId)}}},getAddinMode:function(){var t,i=this.getOption("addinMode");return e.is(i,"object")&&(t=i.value),t},_isWidgetMaximized:function(t,i){var n;if(e.Widgets){var s=u.getItem("integratedSearch");n=e.Widgets.instances.filter(function(n){return!1===s?!(!e.is(n,"object")||"maximized"!==n.getView().type||(n.id!==t||n.context!==i)&&n.getValue("search_wdg_id")!==t):!(!e.is(n,"object")||"maximized"!==n.getView().type||(n.id!==t||n.context!==i)&&n.getValue("search_wdg_id")!==t)&&(e.is(n.getValue("appId")===g.getSearchAppId())&&(n.context=i),!0)})}return n&&n.length>0}})}),define("DS/SNSearchUX/SearchDropDown2",["UWA/Core","UWA/Element","UWA/Promise","UWA/Controls/Abstract","DS/SNInfraUX/Logger","DS/SNUQLEditor/SNUQLEditorUX","DS/SNSearchUX/utils/SearchOptionsPopup","DS/SNSearchUX/utils/SearchHelpPopup","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/ServiceDelegationLoader","DS/SNInfraUX/utils/SNCompassUtils","DS/SNInfraUX/SNSuggestionHelper","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/collections/SearchCollection","DS/SNResultUX/utils/ExternalComponentHelpers","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationPreferences","DS/SNSearchUX/dropdown/SearchDropDownPQs","DS/SNSearchUX/dropdown/SearchDropDownSettings","DS/SNSearchUX/dropdown/SearchDropDownUtils","DS/UIKIT/Autocomplete","DS/UIKIT/Scroller","DS/UIKIT/SuperModal","DS/UIKIT/Spinner","DS/Controls/Button","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/PubSub/PubSub","DS/MessageBus/MessageBus","DS/PlatformAPI/PlatformAPI","DS/WebappsUtils/WebappsUtils","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/i3DXCompassServices/i3DXCompassPubSub","text!DS/SNSearchUX/assets/templates/SearchDropDown/SearchSettingsTabContent.html","css!DS/SNSearchUX/SNSearchUX.css","i18n!DS/SNSearchUX/assets/nls/SNSearchUX.json","i18n!DS/SNSearchUX/assets/nls/SearchDropDown.json","i18n!DS/SNInfraUX/assets/nls/SNInfraUX.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNInfraUX/Api/SearchApi","text!DS/SNSearchUX/assets/templates/SearchDropDown/SearchDropDownNoHistory.html"],function(e,t,i,n,s,o,a,r,c,l,d,u,h,p,g,_,m,S,f,v,C,y,w,b,D,E,I,T,x,M,A,N,k,P,O,U,V,L,F,B,R,H,Q){"use strict";return n.extend({tabContainerList:[],tabList:[],categoryList:[],categoryListFull:[],predefinedQueriesElementList:[],maxServerSuggestions:5,maxSuggests:10,limitReachedFUN141960:!1,isSuggestsCustom:!1,settings:{},webInwin:!1,maxResultDisplayedMyContent:5,_SearchDropDownPQs:null,_SearchDropDownSettings:null,_guidedMode:!1,_helpssettings:!1,_tabletorientation:null,_lastMoveIndex:-1,init:function(t){this._lastMoveIndex=-1,this._parent(t),e.is(t)&&e.is(t.eventManager)&&(this.eventManager=t.eventManager),!0===d.getOption("search_web_in_win")&&(this.webInwin=!0),this.collection=new m,this.build(t),this.initEvents()},clean:function(){document.body.removeEventListener("click",this._onClickbody.bind(this),!1),this._SearchDropDownSettings&&this._SearchDropDownSettings.destroy(),this._SearchDropDownPQs&&this._SearchDropDownPQs.destroy(),e.is(this._tabletorientation)&&A.unsubscribe(this._tabletorientation),y.clean()},initEvents:function(){M.add("search:addSuggestionsFromList",function(e){this.switchActiveTab(this.elements.instantSearchTabContainer),this.addSuggestList(e.suggestions,this.elements.suggestions)}.bind(this))},initSources:function(t){let i=this;i._srcRessource=t,i._SearchDropDownSettings&&i._SearchDropDownSettings.initSettings(i._srcRessource),l.isRoleAvailable(["CSV"],this._srcRessource.active_tenant,function(t){if(!0!==t)i.maxResultDisplayedMyContent=7,e.is(this.elements.predefinedQueriesTab)&&this.elements.predefinedQueriesTab.destroy(),e.is(this.elements.settingsTab)&&this.elements.settingsTab.destroy(),e.is(this.elements.buttonContainer)&&this.elements.buttonContainer.destroy(),e.is(this.elements.historyContainer)&&this.elements.historyContainer.setStyle("height","100%"),e.is(this.elements.myContentContainer)&&this.elements.myContentContainer.setStyle("height","100%"),e.is(this.elements.smartQueriesActivationContainer)&&this.elements.smartQueriesActivationContainer.destroy(),e.is(this.elements.smartQueriesActivationContainer)&&this.elements.smartQueriesActivationContainer.destroy(),this.elements.smartQueriesActivationContainer=null;else{let e=l.getDeviceType();if("tablet"===e||"mobile"===e)s.log("SearchDropDown2::initSources DeviceType: ",e);else if(i.elements.smartQueriesActivationContainer&&d.getOption("GuidedMode",{tenant:i._srcRessource.getActiveTenant()})){let e=!0,t=d.getOption("addinmode");if(!0===this.webInwin?e=!1:-1!==["solidworks","catiav5"].indexOf(t)&&(e=!1),!0===e){let e={container:i.elements.smartQueriesActivationContainer,dropdown:i,state:u.getItem("smartMode"),guidedModeBetaContainer:this.elements.guidedModeBetaContainer};i.elements.smartQueriesActivationContainer.show(),i._guidedMode=!0,y.buildToggleActivation(e)}}}}.bind(this))},build:function(i){let n=this;var s=this.elements;this.tabContainerList=[],this.tabList=[],document.body.addEventListener("click",n._onClickbody.bind(n),!1);var o="sn-search-field uwa-autocomplete nv-autocomplete";s.form=t.create("form",{class:o,autocomplete:"off"}),s.form.addEvent("paste",this.paste.bind(this)),s.form.addEvent("drop",this.drop.bind(this)),s.form.addEvent("submit",e=>(e.preventDefault(),!1)),s.clearSearchButton=document.body.getElement(".clear_btn_search"),e.is(s.clearSearchButton)&&(s.clearSearchButton.addEventListener("mousedown",function(e){this.elements.dropdownContainer.hasClassName("autocomplete-hidden")||(this.noBlur=!0,this.setFocus())}.bind(this)),s.clearSearchButton.addEventListener("mouseup",function(e){}.bind(this))),s.runSearchButton=document.body.getElement(".run_btn_search"),e.is(s.runSearchButton)&&s.runSearchButton.addEventListener("mousedown",function(e){this.noBlur=!1,this.elements.dropdownContainer.addClassName("autocomplete-hidden")}.bind(this)),s.inputContainer=t.create("div",{class:o+"-searchbox"}).inject(s.form),s.input=t.create("input",{class:o+"-input",placeholder:"Search",type:"text"}).inject(s.inputContainer),s.input.addEvent("keyup",this.onKeyUp.bind(this)),s.input.addEvent("keydown",this.onKeyDown.bind(this)),s.input.addEvent("focus",this.onFocus.bind(this)),s.input.addEvent("click",this.onClick.bind(this));let a=l.getDeviceType();s.dropdownContainer=t.create("div",{class:o+"-container"+("tablet"===a&&"portrait"===l.getViewportOrientation()||"mobile"===a?" searchMobileFormat":"")}).addClassName("autocomplete-hidden").inject(s.form),n._tabletorientation=A.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"bodyWidthUpdate",callback:function(){let e=l.getDeviceType(),t=l.getViewportOrientation();"tablet"===e?(s.dropdownContainer.removeClassName("searchMobileFormat"),s.dropdownContainer.removeClassName("iphone"),"portrait"===t?(n.hideSettingPQs(),s.dropdownContainer.addClassName("searchMobileFormat"),s.dropdownContainer.addClassName("iphone")):"landscape"===t&&s.dropdownContainer.addClassName("searchMobileFormat")):"mobile"===e&&(s.dropdownContainer.removeClassName("landscape"),"landscape"===t&&s.dropdownContainer.addClassName("landscape"))}});let r=l.getViewportOrientation();"mobile"===a||"iphone"===l.getDeviceCategory()?(s.dropdownContainer.addClassName("iphone"),"landscape"===r&&s.dropdownContainer.addClassName("landscape")):"tablet"===a&&"portrait"===r?s.dropdownContainer.addClassName("iphone"):"tablet"===a&&"landscape"===r&&s.dropdownContainer.addClassName("searchMobileFormat"),s.dropdownContainer.addEvent("mousedown",function(e){document.activeElement.hasClassName("sn-search-field uwa-autocomplete nv-autocomplete-input")&&(this.noBlur=!0)}.bind(this)),s.dropdownContainer.addEventListener("click",function(e){this.isDropDownVisible()&&!e.target.className.contains("predefined-queries-search-field")&&this.setFocus()}.bind(this)),-1===["iphone","ipad","android"].indexOf(l.getDeviceCategory())?s.input.addEvent("blur",this.onBlur.bind(this)):s.input.addEvent("focusout",this.onBlur.bind(this)),s.contentContainer=t.create("div",{class:"search-global-content-container"}).inject(s.dropdownContainer),s.tabContainer=t.create("div",{class:"search-global-footer-container"}).inject(s.dropdownContainer),s.contentEmbedded=t.create("div",{class:"search-global-embedded",id:"dropdown-search-global-embedded"}).inject(s.contentContainer),"iphone"===l.getDeviceCategory()&&s.tabContainer.addEventListener("touchstart",function(e){this.elements.dropdownContainer.addClassName("autocomplete-hidden"),e.stopImmediatePropagation()}.bind(this)),s.searchTabContainer=t.create("div",{class:"search-tab-container"}).inject(s.contentContainer),this.tabContainerList.push(s.searchTabContainer);var c=t.create("div",{class:"search-tab-content"}).inject(s.searchTabContainer);s.historyContainer=t.create("div",{class:"history-container"}).inject(c),s.historyContentContainer=t.create("div",{class:"history-container-content"}).inject(s.historyContainer),s.rightContentContainer=t.create("div",{class:"right-content-container"}).inject(c),s.smartQueriesActivationContainer=t.create("div",{class:"sophisticatedMode-container"}).inject(s.rightContentContainer),s.smartQueriesActivationContainer.hide(),s.myContentContainer=t.create("div",{class:"mycontent-container"}).inject(s.rightContentContainer),s.myContentEmptyView=t.create("div",{class:"mycontent-empty-view"}).inject(s.myContentContainer).hide(),s.myContentEmptyViewImage=t.create("div",{class:"mycontent-empty-view-image fonticon fonticon-search"}).inject(s.myContentEmptyView),s.myContentEmptyViewMainText=t.create("div",{class:"mycontent-empty-view-text",text:"No Results"}).inject(s.myContentEmptyView),s.myContentEmptyViewSubtext=t.create("div",{class:"mycontent-empty-view-subtext",text:"Your content will be displayed here once you start using the 3DEXPERIENCE"}).inject(s.myContentEmptyView),s.buttonContainer=t.create("div",{class:"search-tab-buttons-container"}).inject(s.rightContentContainer);let u=!1;"3DSwym"!==l.identifyClientInfo().identifier?u=!0:this.maxResultDisplayedMyContent=6;let h={dropdown:n,container:s.buttonContainer,webInwin:n.webInwin,eventManager:n.eventManager,myContent:!0,favoriteSearch:u,SimilarSearch:e.is(i.SimilarSearch)?i.SimilarSearch:void 0,PartSupply:e.is(i.PartSupply)?i.PartSupply:void 0,Relations:e.is(i.Relations)?i.Relations:void 0};y.buildheaderSection(h),s.settingsTabContainer=t.create("div",{class:"settings-tab-container"}).hide().inject(s.contentContainer),this.tabContainerList.push(s.settingsTabContainer),n._SearchDropDownSettings=new C({eventManager:n.eventManager,webInwin:n.webInwin,searchDropDown:n}),A.subscribe({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_switch_customization",callback:()=>{}}),n._SearchDropDownSettings.buildSettings(s.settingsTabContainer),s.predefinedQueriesTabContainer=t.create("div",{class:"predefined-queries-tab-container search-popup-content"}).hide().inject(s.contentContainer),n.tabContainerList.push(s.predefinedQueriesTabContainer),n._SearchDropDownPQs=new v({eventManager:n.eventManager,webInwin:n.webInwin,searchDropDown:n}),n._SearchDropDownPQs.buildHelp(s.predefinedQueriesTabContainer),s.instantSearchTabContainer=t.create("div",{class:"instant-search-tab-container"}).hide().inject(s.contentContainer),this.tabContainerList.push(s.instantSearchTabContainer),d.getOption("FUN141960")&&(s.instantSearchWarningMessage=t.create("div",{class:"instant-search-warning-message search-warning-message"}).inject(s.instantSearchTabContainer).hide(),l.buildNotification(s.instantSearchWarningMessage,function(e){y.modalVisibility(!1,e),n.eventManager&&n.eventManager.dispatchEvent("advancedSearch",{value:l.SearchTypeEnum.ADVANCED_SEARCH,adv_search:!0})},this.collection)),s.suggestionContainer=t.create("div",{class:"suggestion-container"}).inject(s.instantSearchTabContainer),s.suggestions=t.create("div",{class:"suggestion-container-content"}).inject(s.suggestionContainer),s.customSuggestions=t.create("div",{class:"custom-suggestion-container-content"}).hide().inject(s.suggestionContainer),s.instantSearchContainer=t.create("div",{class:"instant-search-container"}).inject(s.instantSearchTabContainer),s.instantSearchEmptyView=t.create("div",{class:"instant-search-empty-view"}).inject(s.instantSearchContainer).hide(),s.instantSearchEmptyViewImage=t.create("div",{class:"instant-search-empty-view-image fonticon fonticon-search"}).inject(s.instantSearchEmptyView),s.instantSearchEmptyViewIcon=t.create("div",{class:"instant-search-empty-view-icon fonticon fonticon-attention"}).inject(s.instantSearchEmptyViewImage),s.instantSearchEmptyViewMainText=t.create("div",{class:"instant-search-empty-view-text",text:"No Results Found"}).inject(s.instantSearchEmptyView),s.instantSearchEmptyViewSubtext=t.create("div",{class:"instant-search-empty-view-subtext",text:"Please check your spelling or try different keywords"}).inject(s.instantSearchEmptyView),s.predefinedQueriesTab=t.create("div",{class:"search-dropdown-tab-predefined-queries",id:"pqsDropdown"}).inject(s.tabContainer),s.predefinedQueriesTab.addEvent("click",function(t){n.switchActiveTab(s.predefinedQueriesTabContainer,t.currentTarget),e.is(n._SearchDropDownPQs)&&(n.showSettingPQs(),n._SearchDropDownPQs.elements.predefinedQueriesTableBody&&0===n._SearchDropDownPQs.elements.predefinedQueriesTableBody.getChildren().length&&n._SearchDropDownPQs.createPredefinedQueriesComponent())}),S.tooltip(s.predefinedQueriesTab,{title:l.escapeHtml(L.get("PredefinedQuery")),position:"bottom",reshowDelay:2.5,mouseRelativePosition:!0,longHelp:l.escapeHtml(L.get("PredefinedQuery.shortHelp"))}),this.tabList.push(s.predefinedQueriesTab),s.predefinedQueriesTabIcon=t.create("span",{class:"fonticon fonticon-help search-dropdown-tab-icon"}).inject(s.predefinedQueriesTab),s.predefinedQueriesTabText=t.create("div",{class:"search-dropdown-tab-text",text:F.get("search.tab.help"),title:F.get("search.tab.help")}).inject(s.predefinedQueriesTab),s.settingsTab=t.create("div",{class:"search-dropdown-tab-settings",id:"settingsDropdown"}).inject(s.tabContainer),s.settingsTab.addEvent("click",function(t){n.switchActiveTab(s.settingsTabContainer,t.currentTarget),e.is(n._SearchDropDownSettings)&&n.showSettingPQs()}),S.tooltip(s.settingsTab,{title:l.escapeHtml(L.get("SearchOptions")),position:"bottom",reshowDelay:2.5,mouseRelativePosition:!0,longHelp:l.escapeHtml(L.get("SearchOptions.shortHelp"))}),this.tabList.push(s.settingsTab),s.settingsTabIcon=t.create("span",{class:"fonticon fonticon-cog search-dropdown-tab-icon"}).inject(s.settingsTab),s.settingsTabText=t.create("div",{class:"search-dropdown-tab-text",text:F.get("search.tab.settings"),title:F.get("search.tab.settings")}).inject(s.settingsTab),s.searchTab=t.create("div",{class:"search-dropdown-tab-mycontent tab-selected"}).inject(s.tabContainer),s.searchTab.addEvent("click",function(e){this.activateSearchTab(e.currentTarget)}.bind(this)),this.tabList.push(s.searchTab),s.searchTabIcon=t.create("span",{class:"fonticon fonticon-search search-dropdown-tab-icon"}).inject(s.searchTab),s.searchTabText=t.create("div",{class:"search-dropdown-tab-text",text:F.get("search.tab.search"),title:F.get("search.tab.search")}).inject(s.searchTab),s.guidedModeBetaContainer=t.create("div",{class:"guidedModeBeta-container"}).hide().inject(s.contentContainer),this.tabContainerList.push(s.guidedModeBetaContainer),this.buildHistories({historyContainer:this.elements.historyContainer,historyContentContainer:s.historyContentContainer}),this.categoryList=this._buildCategories(),s.container=s.form,l.setAutocompleteRendered()},buildHistories:function(t){if(!e.is(t))return;const{historyContainer:i,historyContentContainer:n}=t;this.elements.historyContainer=i,this.elements.historyContentContainer=n;let s=[];this.getHistoryListFromLocalStorage().length>0?(this.destroySuggestionEmptyView(i),s.push({text:F.get("search.history"),action:"delete",isTitle:!0,icon:"clock"}),this.getHistoryListFromLocalStorage().slice(0,this.maxSuggests).forEach(function(e){s.push({text:e,icon:"clock",action:"clear"})}),this.addSuggestList(s,n)):this.createSuggestionEmptyView(i)},getServerSuggestions:function(t){if(e.is(this._srcRessource)&&e.is(t,"string")){var i=g.getEnterpriseConceptsSuggestions(t),n=g.getIcon();this._srcRessource.getSuggestions({query:t},function(t){Promise.all([i,n]).then(function([i,n]){var s=[];(s=g._prioritizeSuggestions(t,i,!0)).slice(0,this.maxServerSuggestions);var o=this.getHistoryListFromLocalStorage(),a=s.length<o.length&&s.length<5?this.maxSuggests-s.length:5,r=o.length<s.length&&o.length<5?this.maxSuggests-o.length:5;let c=[];s.length>0&&c.push({text:F.get("search.suggestions"),isTitle:!0,icon:"lightbulb"}),s.slice(0,r).forEach(function(t){e.is(t.isEnterpriseConcept)?(n||(n="lightbulb"),c.push({text:t.entry,icon:n,filter:t.highLight,type:"suggestion"})):c.push({text:t.entry,icon:"lightbulb",filter:this.getInputValue(),type:"suggestion"})}.bind(this)),c.push({text:F.get("search.history"),action:"delete",isTitle:!0,icon:"clock"});var l=0;o.forEach(function(e){e.indexOf(this.getInputValue())>=0&&l<a&&(c.push({text:e,icon:"clock",action:"clear",filter:this.getInputValue()}),l++)}.bind(this)),0===l&&(c=c.filter(e=>!(e.text===F.get("search.history")))),this.addSuggestList(c,this.elements.suggestions)}.bind(this))}.bind(this))}},refreshMyContent:function(){let e=this,t=e.maxResultDisplayedMyContent;e.elements.myContentEmptyView&&e.elements.myContentEmptyView.hide();let i={dropdown:e,container:e.elements.myContentContainer,collection:e.collection,srcRessource:e._srcRessource,count:t,webInwin:e.webInwin,eventManager:e.eventManager,noresult:()=>{e.elements.myContentEmptyView&&e.elements.myContentEmptyView.setStyle("order","1"),e.elements.myContentEmptyView&&e.elements.myContentEmptyView.setStyle("margin-top","0%"),e.elements.myContentEmptyView&&e.elements.myContentEmptyView.show(),y.getMyContentView()&&y.getMyContentView().setStyle("height","auto")},onComplete:()=>{e.elements.myContentEmptyView&&e.elements.myContentEmptyView.setStyle("order","unset"),y.getMyContentView()&&y.getMyContentView().setStyle("height","100%")}};y.buildMyContent(i)},getInputValue:function(){return void 0===this.elements.input.value?"":this.elements.input.value},setInputValue:function(e){this.elements.input.value=e},setFieldValue:function(t){this.setInputValue(t),e.is(t,"string")&&t.length>0?this.showClearSearchButton():this.hideClearSearchButton(),this.refreshHistoryList()},setPlaceHolderValue:function(e){this.elements.input.placeholder=e},getPlaceHolderValue:function(){return this.elements.input.placeholder},resetSearchField:function(t,i){this.setFieldValue(e.is(t)?t:""),this.setPlaceHolderValue(L.get("search")),e.is(i)&&(this.noFocus=i),this.activateSearchTab(this.elements.searchTab)},_setInternalCriteria:function(e){this._internalSearchCriteria=e},showClearSearchButton:function(){this.elements.clearSearchButton&&this.elements.clearSearchButton.show()},hideClearSearchButton:function(){this.elements.clearSearchButton&&this.elements.clearSearchButton.hide()},drop:function(e){var t=null,i=!!document.documentMode,n=!i&&!!window.StyleMedia;if(i||n||""===e.dataTransfer.getData("shortData")){if(""!==e.dataTransfer.getData("text")){var s=JSON.parse(e.dataTransfer.getData("text"));t=[],s.data.items&&s.data.items.forEach(function(e){t.push('"'+e.displayName+'"')})}}else e.preventDefault(),t=JSON.parse(e.dataTransfer.getData("shortData"));e.target.value=t.join(" OR "),e.stopPropagation(),e.preventDefault()},paste:function(t){var i=L.get("search"),n=this._srcRessource&&this._srcRessource.getActiveTenant()?this._srcRessource.getActiveTenant():void 0;if(e.is(n)&&"OnPremise"!==n.tenantId&&!this._srcRessource.isSingleTenant()?i+=" "+n.tenantName:i=L.get("searchNew"),this.elements.input.placeholder===i||this.elements.input.placeholder===L.get("search_current_tab")){var s=0;if(e.is(t.target)&&e.is(t.target.selectionStart)&&e.is(t.target.selectionEnd)&&(s=t.target.value.length-(t.target.selectionEnd-t.target.selectionStart)),0===s&&e.is(t)){var o=null;e.is(t.clipboardData)&&e.is(t.clipboardData.getData,"function")?(o=t.clipboardData.getData("text/plain"),this.getServerSuggestions(o)):e.is(window.clipboardData)&&e.is(window.clipboardData.getData,"function")&&(o=window.clipboardData.getData("Text"),this.getServerSuggestions(o));var a="";if(e.is(o,"string")&&o.length>0){var r=o.indexOf("\t")>=0,c=o.indexOf("\n")>=0,l=o.indexOf("||")>=0,u=o.indexOf("&&")>=0,h=o.indexOf("\\&&")>=0,p=o.indexOf("\\||")>=0;if(this._setInternalCriteria(o),!1===r&&!1===c&&!1===l&&!1===u)return void this.showClearSearchButton();var g=o.split("\n"),_="",m=!1;if(e.is(g,"array")&&g.length>0){for(var S=0,f=g.length;S<f;S++)if(e.is(g[S],"string")&&(g[S]=g[S].trim(),g[S].length>0)){var v=null,C="AND";r=(_=g[S]).indexOf("\t")>=0,l=_.indexOf("||")>=0,u=_.indexOf("&&")>=0,h=_.indexOf("\\&&")>=0,p=_.indexOf("\\||")>=0,!0===h&&(_=_.replace(/\\\&/g,"##__##")),!0===p&&(_=_.replace(/\\\|/g,"__##__")),!0===r?v=_.split("\t"):!0===u?v=_.split("&&"):!0===l?(v=_.split("||"),C="OR"):v=[_];for(var y="",w=0,b=v.length;w<b;w++)e.is(v[w],"string")&&(v[w].trim(),v[w].length>0&&(!0===h&&(v[w]=v[w].replace(/##__##/g,"&")),!0===p&&(v[w]=v[w].replace(/__##__/g,"|")),y.length>0&&(y+=" "+C+" "),v[w].length>1&&'"'===v[w][0]&&'"'===v[w][v[w].length-1]&&(v[w]=v[w].substr(1,v[w].length-2)),v[w]=v[w].replace(/\\([\s\S])|(")/g,"\\$1$2"),y+='"'+v[w]+'"'));y.length>0&&(!0===m&&(a+=" OR "),f>1&&(a+="("),a+=y,f>1&&(a+=")"),m=!0)}var D=d.getOption("maxTopBarInput");a.length>D&&(a=a.substring(0,D)),t.target.value=a,a.length>0&&this.showClearSearchButton(),t.stopPropagation(),t.preventDefault()}}}}},setFocus:function(){e.is(this.noFocus)&&!0===this.noFocus?this.noFocus=!1:this.elements.input.focus()},_createThumbnailSection:function(i){if(e.is(i)&&e.is(i.title)&&e.is(i.count)&&e.is(i.containerClassName)){var n,s=t.create("div",{class:i.containerClassName}),o=t.create("div",{id:"AppsDropdown",class:i.containerClassName+"-header"}).inject(s),a=t.create("div",{class:i.containerClassName+"-content"}).inject(s);n=t.create("div",{class:"search-multi-view-icon fonticon fonticon-app"}).inject(o);var r=e.is(i.count)?"<b>"+i.title+"</b> | "+i.count:"<b>"+i.title+"</b> | 0",c=t.create("div",{class:i.containerClassName+"-title",title:i.title,html:r}).inject(o),l=t.create("div",{class:i.containerClassName+"-link",text:F.get("search.sectionlink"),title:F.get("search.sectionlink")+" "+i.title}).inject(o),d=t.create("div",{class:i.containerClassName+"-spinner-container"}).inject(s);(new E).inject(d).show();return{container:s,header:o,image:n,title:c,content:a,link:l,spinner:d}}return null},_createThumbnailObject:function(i,n){var s=t.create("div",{class:"section-thumbnail"});if(e.is(i)){var o=t.create("div",{class:"section-thumbnail-content",title:i.title}).inject(s);e.is(n)&&(o.model=n,o.addEvent("mousedown",function(e){this.noBlur=!0}.bind(this)),o.addEvent("mouseup",function(e){this.onBlur(),this._onClickObject(e)}.bind(this))),e.is(i.id)&&(o.id=i.id,o.addEvent("mousedown",function(e){this.noBlur=!0}.bind(this)),o.addEvent("mouseup",function(e){this.onBlur(),this._onClickApp(e)}.bind(this)));t.create("img",{class:"section-thumbnail-image",src:i.image}).inject(o);if(e.is(i.type)&&"Widget"===i.type)t.create("img",{class:"section-thumbnail-image-native",src:k.getWebappsAssetUrl("SNSearchUX","images/NATIVEICON.png")}).inject(o);var a=t.create("div",{class:"section-thumbnail-title"}).inject(o);if(e.is(i.icon))t.create("img",{class:"section-thumbnail-content-icon"}).inject(a).src=i.icon;t.create("div",{class:"section-thumbnail-content-text",text:i.title}).inject(a)}return s},_buildCategories:function(e){let t=[];var i=this._createThumbnailSection({title:F.get("Application"),icon:"",containerClassName:"section-container",count:0});return i.container.inject(e||this.elements.instantSearchContainer).hide(),i.header.addEventListener("click",function(e){p.searchApplicationsInCompass(this.getInputValue()),this.onBlur(),!0===this.webInwin&&this.eventManager&&this.eventManager.dispatchEvent("OnApplication",{value:this.getInputValue()})}.bind(this)),t.push(i),t},_updateCategory:function(t,i){var n;if(t.forEach(function(e){e.title.getAttribute("title")===i.title&&(n=e)}),this._clearCategory(n.container),n.container.setAttribute("count",i.count),0!==i.count||e.is(i.noHide)){var s="<div>"+i.title+"</div>"+(this.limitReachedFUN141960?"":"<div>|</div><div>"+i.hits+"</div>");n.title.setHTML(s),n.container.show(),n.header.show();for(var o=0;o<i.results.length;o++)"Application"===i.title&&this._createThumbnailObject(i.results[o]).inject(n.content)}else n.container.hide(),n.header.hide();this._isContainerEmpty(this.elements.instantSearchContainer)?this.elements.instantSearchEmptyView.show():this.elements.instantSearchEmptyView&&this.elements.instantSearchEmptyView.hide()},_isContainerEmpty:function(e){var t=["-empty-view","section-myContent"],i=e.getChildren(),n=!0;return i.forEach(function(e){"none"===e.style.display||t.some(function(t){return e.className.indexOf(t)>=0})||(n=!1)}),n},_clearCategory:function(t){e.is(t)&&t.getChildren().forEach(function(e){(e.className.contains("section-object")&&e.destroy(),e.className.contains("section-container-content"))&&e.getChildren().forEach(function(e){e.className.contains("section-thumbnail")&&e.destroy()})})},_getCategoriesSuggestions:function(t){let i=this;const{query:n,instantSearchContainer:s,count:o,noresult:a,fromFull:r}=t;if(this.elements.instantSearchContainer=s,s&&s.removeClassName("withApps"),s&&s.removeClassName("full"),n.length>=3){let c;0===(c=e.is(r)&&!0===r?i.categoryListFull:i.categoryList).length&&(c=this._buildCategories(s),e.is(r)&&!0===r&&(i.categoryListFull=c)),clearTimeout(this._categorySuggestTimeout),this._categorySuggestTimeout=setTimeout(function(){c.forEach(function(e){"Application"===e.title.getAttribute("title")&&(this._clearCategory(e.container),e.container.show(),e.spinner.show())}.bind(this)),p.getApplicationsFromCompass(n,(e.is(r),3)).then(function(t){if(e.is(t)&&e.is(t.count)&&e.is(t.data)){var i;c.forEach(function(e){"Application"===e.title.getAttribute("title")&&(i=e,e.spinner.hide())}.bind(this));var n=[];t.data.forEach(function(e){n.push({title:e.title,image:e.icon,id:e.id,type:e.type})});var o={title:F.get("Application"),count:n.length,hits:t.count,results:n,image:k.getWebappsAssetUrl("SNSearchUX","images/APPICON.png"),category:i};this._updateCategory(c,o),s&&s.addClassName("withApps"),e.is(r)&&!0===r&&s&&s.addClassName("full")}}.bind(this));let l={id:e.is(t.id)?t.id:"categoryDropdown",container:s,dropdown:this,count:o,srcRessource:this._srcRessource,webInwin:this.webInwin,eventManager:this.eventManager,query:n,noresult:a||(()=>{i._isContainerEmpty(s)?i.elements.instantSearchEmptyView&&i.elements.instantSearchEmptyView.show():i.elements.instantSearchEmptyView&&i.elements.instantSearchEmptyView.hide()})};y.buildcategoryContent(l)}.bind(this),1e3)}},onFocus:function(){if(this.elements.dropdownContainer.className.contains("autocomplete-hidden"))if(!0===y.getGuidedmodeStatus()&&!0===this._guidedMode){let t=!1;"3DSwym"!==l.identifyClientInfo().identifier&&(t=!0);let i={dropdown:this,srcRessource:this._srcRessource,webInwin:this.webInwin,eventManager:this.eventManager,inputValue:this.getInputValue(),placeHolderValue:this.getPlaceHolderValue(),favoriteSearch:t,SimilarSearch:e.is(this.getOption("SimilarSearch"))?this.getOption("SimilarSearch"):void 0,PartSupply:e.is(this.getOption("PartSupply"))?this.getOption("PartSupply"):void 0,Relations:e.is(this.getOption("Relations"))?this.getOption("Relations"):void 0,noresult:()=>{_this.elements.myContentEmptyView&&_this.elements.myContentEmptyView.show()}};y.buildFullDropDown(i)}else{let e=this.getInputValue();this.refreshHistoryList(),this.elements.dropdownContainer.removeClassName("autocomplete-hidden"),e.length>2&&!0!==this._inContextMode?this.switchActiveTabinstantSearchTab(e):(this.refreshMyContent(),this.activateSearchTab(this.elements.searchTab))}},onBlur:function(t,i){"iphone"!==l.getDeviceCategory()&&(e.is(i)&&!0===i&&(this.noBlur=!1),e.is(t)&&e.is(t.relatedTarget)&&this.elements.dropdownContainer.contains(t.relatedTarget)&&(!e.is(i)||!1===i)||(!0===this.noBlur||!0===this._helpssettings?this.noBlur=!1:this.elements.dropdownContainer.addClassName("autocomplete-hidden")))},onClick:function(e){this.getPlaceHolderValue()!==L.search&&this.setPlaceHolderValue(L.search),this.elements.input&&(this.elements.input.readOnly=!1,this._changeIcon("search"))},_changeIcon:function(t){let i=e.extendElement(document.body).getElement(".run_btn_search");if(e.is(i))switch(i.removeClassName("fonticon-search"),i.removeClassName("fonticon-search-cog"),i.removeClassName("fonticon-favorite-on"),i.removeClassName("fonticon-user"),t){case"search":i.addClassName("fonticon-search");break;case"cog":i.addClassName("fonticon-search-cog");break;case"on":i.addClassName("fonticon-favorite-on");break;case"user":i.addClassName("fonticon-user")}},onKeyUp:function(t){let i=this,n=t.srcElement.value;if(13===t.keyCode&&(i.onBlur(),i._lastMoveIndex=-1,this.elements.input.disabled=!0,this.elements.input.disabled=!1,M.dispatch("onViewSearch")),38===t.keyCode||40===t.keyCode)return i._lastMoveIndex<=-1?i._lastMoveIndex=-1:i._lastMoveIndex,38===t.keyCode?i._lastMoveIndex--:i._lastMoveIndex++,void(i._lastMoveIndex>=0?i._mouveOnIndex():(i._mouveOnIndex(),i.setInputValue(""),i.hideClearSearchButton()));if(16!==t.keyCode){if(e.is(this.elements.input)&&"?"===this.getInputValue())return this.switchActiveTab(this.elements.predefinedQueriesTabContainer,this.elements.predefinedQueriesTab),void(e.is(this._SearchDropDownPQs)&&(this.showSettingPQs(),this._SearchDropDownPQs.elements.specialCharactersExpander.getContent().dispatchEvent(new Event("collapse")),this._SearchDropDownPQs.elements.typeShortcutsExpander.getContent().dispatchEvent(new Event("expand")),this._SearchDropDownPQs.createPredefinedQueriesComponent()));this._setInternalCriteria(null),n.length>0?this.showClearSearchButton():this.hideClearSearchButton(),n.length>2&&!0!==this._inContextMode?this.switchActiveTabinstantSearchTab(n):!1===this._helpssettings?this.switchActiveTab(this.elements.searchTabContainer,this.elements.searchTab):this.hideSettingPQs(),this.refreshHistoryList()}},_mouveOnIndex:function(){let t=this,i=t.elements.historyContentContainer.querySelectorAll(".search-history-container"),n=i.length;if(t._lastMoveIndex>=n)t._lastMoveIndex=n-1;else{for(const e of i)e.removeClassName("hover");if(t._lastMoveIndex<n){let n=i[t._lastMoveIndex];e.is(n)&&(t.setInputValue(n.title),t.showClearSearchButton(),n.addClassName("hover"))}}},onKeyDown:function(e){},_onClickObject:function(t){if(!e.is(t))return;let i={model:t.currentTarget.model,text:t.target.getText(),webInwin:this.webInwin,eventManager:this.eventManager};y.onClickObject(i)},_onClickApp:function(t){if(!e.is(t)||!e.is(t.currentTarget.id))return;let i={appId:t.currentTarget.id,webInwin:this.webInwin,eventManager:this.eventManager};y.onClickApp(i)},isDropDownVisible:function(){return!this.elements.dropdownContainer.className.contains("autocomplete-hidden")},addSuggestList:function(t,i){let n=0;this.clearHistory(i),t.forEach(function(t){n+=this.addSuggest({text:t.text,container:i,icon:t.icon,filter:t.filter,action:t.action,isTitle:t.isTitle,mouseupCB:t.mouseupCB,type:e.is(t.type)?t.type:void 0,nbTitle:n})}.bind(this))},addSuggest:function(i){if(!e.is(i.text)||!e.is(i.container))return;var n;let s=0;if(e.is(i.isTitle)&&!1!==i.isTitle?(s++,n=t.create("div",{class:"search-dropdown-suggestion-title"}).inject(i.container),i.nbTitle>0&&n.addClassName("separator")):(n=t.create("div",{class:"search-history-container",title:i.text,type:e.is(i.type)?i.type:""}).inject(i.container)).addEvent("mouseup",function(t){if(e.is(i.mouseupCB))return i.mouseupCB.call(this,t.target&&t.target.getText()),t;if(!0!==this.noSearchLaunch){this.onBlur();let e=t.currentTarget.getText();this.setFieldValue(e),M.dispatch("onViewSearch"),!0===this.webInwin&&this.eventManager&&this.eventManager.dispatchEvent("onViewSearch",{displayString:e,query:e})}else this.noSearchLaunch=!1}.bind(this)),e.is(i.icon))if(l.iconURL_check(i.icon)){var o=t.create("span",{class:"fonticon  search-history-icon"}).inject(n);t.create("img",{src:i.icon,width:"17px",height:"auto"}).inject(o)}else{i.icon.startsWith("fonticon-")&&(i.icon=i.icon.replace(/fonticon-/g,""));o=t.create("span",{class:"fonticon fonticon-"+i.icon+" search-history-icon"}).inject(n)}if(e.is(i.filter,"string")&&i.filter.length>0&&i.text.toLowerCase().indexOf(i.filter.toLowerCase())>=0){var a=i.text.toLowerCase().indexOf(i.filter.toLowerCase()),r=i.text.substr(0,a),c=i.text.substr(a,i.filter.length),d=i.text.substr(a+i.filter.length,i.text.length);t.create("div",{class:"search-history-text",text:r}).inject(n),t.create("div",{class:"search-history-text-filtered",text:c}).inject(n),t.create("div",{class:"search-history-text",text:d}).inject(n)}else t.create("div",{class:e.is(i.isTitle)&&!0===i.isTitle?"search-dropdown-suggestion-title-text":"search-history-text",text:i.text}).inject(n);if(e.is(i.action)&&"clear"===i.action){var u=t.create("span",{class:"search-history-delete fonticon fonticon-clear",title:F.get("search.history.clear")+" '"+i.text+"'"}).inject(n);u.addEvent("mousedown",function(e){this.noBlur=!0,this.noSearchLaunch=!0,e.stopPropagation()}.bind(this)),u.addEvent("mouseup",function(e){this.removeHistoryElement(e.currentTarget),this.setFocus(),e.stopPropagation()}.bind(this))}else if(e.is(i.action)&&"delete"===i.action){t.create("span",{id:"clearHistoryDropdown",class:"search-dropdown-clear-history-icon fonticon fonticon-trash",title:F.get("search.history.clear")+" "+F.get("search.history")}).inject(n).addEvent("mousedown",function(e){this.displayClearHistoryModal(e),this.noBlur=!0,e.stopPropagation()}.bind(this))}return s},refreshHistoryList:function(t){let i=this.elements.historyContentContainer;if(e.is(t)&&(i=t),!e.is(i))return;let n=[];this.getHistoryListFromLocalStorage().length>0&&n.push({text:F.get("search.history"),action:"delete",isTitle:!0,icon:"clock"}),this.getHistoryListFromLocalStorage().slice(0,this.maxSuggests).forEach(function(e){e.indexOf(this.getInputValue())>=0&&n.push({text:e,icon:"clock",action:"clear",filter:this.getInputValue()})}.bind(this)),n.length<=1?(n.pop(),this.createSuggestionEmptyView(this.elements.historyContainer)):this.destroySuggestionEmptyView(this.elements.historyContainer),this.addSuggestList(n,i)},clearHistory:function(t){if(e.is(t)){var i=t.getChildren();i.length>0&&i.forEach(function(e){e.remove()})}},removeHistoryElement:function(e){y.removeHistoryElement(e),this.refreshHistoryList()},createSuggestionEmptyView:function(e){this.destroySuggestionEmptyView(e);let i=t.create("div",{class:"suggestion-container-empty"}).inject(e);Q=(Q=Q.replace("###searchhistory###",l.escapeHtml(F.get("search.history")))).replace("###nohistory###",l.escapeHtml(F.get("search.noHistory"))),i.innerHTML=Q},destroySuggestionEmptyView:function(e){e.getChildren().forEach(function(e){e.className.contains("suggestion-container-empty")&&e.destroy()}.bind(this))},getHistoryListFromLocalStorage:function(){return y.getHistoryListFromLocalStorage()},removeHistoryFromLocalStorage:function(e){y.removeHistoryFromLocalStorage(e)},clearHistoryFromLocalStorage:function(){y.clearHistoryFromLocalStorage(),this.refreshHistoryList()},displayClearHistoryModal:function(e){new D({renderTo:document.body,className:"search-history-clear-warning",okButtonText:F.get("search.history.delete.confirm")}).confirm(F.get("search.history.delete.message"),F.get("search.history.delete.title"),function(e){let t=!1;!0===e?(this.clearHistoryFromLocalStorage(),t=!0):(this.noBlur=!1,this.setFocus()),!0===this.webInwin&&this.eventManager.dispatchEvent("clearHistory",t)}.bind(this)),!0===this.webInwin&&this.eventManager.dispatchEvent("displayClearHistory")},switchActiveTab:function(t,i,n){this.tabContainerList.forEach(function(e){e===t?e.show():e.hide()}),e.is(i)&&this.tabList.forEach(function(e){e===i?(e.addClassName("tab-selected"),!0===this.webInwin&&this.eventManager.dispatchEvent("tabSelected",{value:e.className})):e.removeClassName("tab-selected")}.bind(this)),!0!==n&&this.setFocus()},activateSearchTab:function(e){this.refreshHistoryList();let t=!1;this.getInputValue().length>=3&&(t=!0),!0===this._inContextMode&&(t=!1),!0===t?this.switchActiveTab(this.elements.instantSearchTabContainer,e):this.switchActiveTab(this.elements.searchTabContainer,e)},_getPlaceHolderTextDependingOnActiveTenant:function(t){if(!e.is(t,"string")||0===t.length)throw new Error("ERROR - INVALID ARGUMENT: need a key !");var i=L.get(t);return this._srcRessource.getAvailableTenants().length>1&&(e.is(L[t+"_in_active"])?i=L.replace(L.get(t+"_in_active"),{tenant:this._srcRessource.getTenantDisplayName(this._srcRessource.active_tenant)}):i+=" "+this._srcRessource.getTenantDisplayName(this._srcRessource.active_tenant)),i},setInContextMode:function(t,i){this._inContextMode=t,!0===t?(e.is(this.elements.smartQueriesActivationContainer)&&this.elements.smartQueriesActivationContainer.hide(),e.is(this.elements.predefinedQueriesTab)&&this.elements.predefinedQueriesTab.hide(),e.is(this.elements.settingsTab)&&this.elements.settingsTab.hide(),e.is(this.elements.expertSearchButton)&&this.elements.expertSearchButton.hide(),e.is(this.elements.deactivateFUN136528)&&this.elements.deactivateFUN136528.hide(),this.elements.contentContainer.addClassName("search-global-content-container-in-context"),this.switchActiveTab(this.elements.searchTabContainer,this.elements.searchTab,!0)):(e.is(this.elements.smartQueriesActivationContainer)&&this._guidedMode&&this.elements.smartQueriesActivationContainer.show(),e.is(this.elements.predefinedQueriesTab)&&this.elements.predefinedQueriesTab.show(),e.is(this.elements.settingsTab)&&this.elements.settingsTab.show(),e.is(this.elements.expertSearchButton)&&this.elements.expertSearchButton.show(),e.is(this.elements.deactivateFUN136528)&&this.elements.deactivateFUN136528.show(),this.elements.contentContainer.removeClassName("search-global-content-container-in-context")),y.setInContextMode(this._inContextMode,i)},getInContextMode:function(){return!!e.is(this._inContextMode)&&this._inContextMode},switchActiveTabinstantSearchTab:function(t,i){if(this.elements.dropdownContainer.className.contains("autocomplete-hidden"))return;this.switchActiveTab(this.elements.instantSearchTabContainer,null,i);var n=this.elements;d.getOption("FUN141960")&&(n.instantSearchWarningMessage&&n.instantSearchWarningMessage.hide(),H.getSearchInfo({query:t,label:"FUN141960-BackToConfidence-Dropdown"}).then(e=>{this.limitReachedFUN141960=e.estimated,this.limitReachedFUN141960?(n.instantSearchWarningMessage&&n.instantSearchWarningMessage.show(),n.instantSearchTabContainer.addClassName("limitReached"),n.rightContentContainer.addClassName("limitReached")):(n.instantSearchWarningMessage&&n.instantSearchWarningMessage.hide(),n.instantSearchTabContainer.removeClassName("limitReached"),n.rightContentContainer.removeClassName("limitReached"))}).catch(e=>{console.error(e)}));let s=[];this.getHistoryListFromLocalStorage().length>0&&s.push({text:F.get("search.history"),action:"delete",isTitle:!0,icon:"clock"}),this.getHistoryListFromLocalStorage().slice(0,this.maxSuggests).forEach(function(i){e.is(t)&&i.indexOf(t)>=0&&s.push({text:i,icon:"clock",action:"clear",filter:t})}.bind(this)),this.addSuggestList(s,this.elements.suggestions),!0!==y.getGuidedmodeStatus()&&(e.is(t)&&this.getServerSuggestions(t),e.is(t)&&this._getCategoriesSuggestions({query:t,instantSearchContainer:this.elements.instantSearchContainer}))},showSettingPQs:function(){let t=this,i=t.getContent();if(e.is(i)){let n=i.querySelector(".nv-autocomplete-container");e.is(n)&&n.removeClassName("helps-settings"),e.is(n)&&n.addClassName("helps-settings"),t._helpssettings=!0,t.elements.input&&t.elements.input.removeClassName("enabled"),t.elements.input&&t.elements.input.setAttribute("disabled",""),t.elements.input&&t.elements.input.addClassName("disabled");let s=document.querySelector(".run_btn_search.fonticon.fonticon-search");e.is(s)&&e.is(s.removeClassName,"function")&&(s.removeClassName("enabled"),s.addClassName("disabled")),s=document.querySelector(".run_ctn_search.ctn_search"),e.is(s)&&e.is(s.removeClassName,"function")&&(s.removeClassName("enabled"),s.addClassName("disabled")),!0===t.webInwin&&t.eventManager&&t.eventManager.dispatchEvent("Searchfieldenable",!1)}},hideSettingPQs:function(){let t=this,i=t.getContent();if(e.is(i)){let t=i.querySelector(".nv-autocomplete-container");e.is(t)&&t.removeClassName("helps-settings")}t.activateSearchTab(t.elements.searchTab),t._helpssettings=!1,t.elements.input&&t.elements.input.removeAttribute("disabled"),t.elements.input&&t.elements.input.removeClassName("disabled"),t.elements.input&&t.elements.input.addClassName("enabled");let n=document.querySelector(".run_btn_search.fonticon.fonticon-search");e.is(n)&&e.is(n.removeClassName,"function")&&(n.removeClassName("disabled"),n.addClassName("enabled")),n=document.querySelector(".run_ctn_search.ctn_search"),e.is(n)&&e.is(n.removeClassName,"function")&&(n.removeClassName("disabled"),n.addClassName("enabled")),!0===t.webInwin&&t.eventManager&&t.eventManager.dispatchEvent("Searchfieldenable",!0)},_onClickbody:function(e){let t=this,i=e;if(!0===t.isDropDownVisible()&&!0===t._helpssettings){let e=i.target,n=t.elements.dropdownContainer&&t.elements.dropdownContainer.contains(e);(e.className.contains("wux-controls-combobox")||e.className.contains("wux-layouts-treeview")||e.className.contains("btn-primary"))&&(n=!0),!1===n&&(t.hideSettingPQs(),t.elements.dropdownContainer&&t.elements.dropdownContainer.addClassName("autocomplete-hidden"))}}})}),define("DS/SNSearchUX/SearchDropDown",["UWA/Core","UWA/Element","UWA/Event","UWA/Utils","UWA/Controls/Abstract","UWA/Utils/InterCom","DS/MessageBus/MessageBus","require","css!DS/SNSearchUX/SNSearchUX.css","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SNSearchTypeCusto","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchLogin","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchDoubleClickHandler","UWA/Promise","DS/SNSearchUX/SuggestionUXHelper","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/PubSub/PubSub","DS/UIKIT/Spinner","DS/WebappsUtils/WebappsUtils","DS/UIKIT/DropdownMenu","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SNInfraUX/utils/SNCompassUtils","DS/SNInfraUX/ServiceDelegationLoader","DS/SNResultUX/models/SearchItemModel","DS/SNSearchUX/SearchSecondaryMenu","i18n!DS/SNSearchUX/assets/nls/SNSearchUX.json","DS/SNInfraUX/SNSuggestionHelper"],function(e,t,i,n,s,o,a,r,c,l,d,u,h,p,g,_,m,S,f,v,C,y,w,b,D,E,I,T,x,M,A,N,k,P){"use strict";var O=!1,U="";return s.extend({_clearSearch:null,_searchBtn:null,_autocompleteSuggests:null,_timeoutId:null,_suggestTimeout:null,_secondTimeoutId:null,_inAppContext:!1,_temporarilyOutOfContext:!1,_inContextOptions:null,_inContextMode:null,_previouslyActiveSource:null,_sitChoice:null,_findInTabNLS:null,_cstoreChoice:[],_cstoreSources:[],_src_ressource:null,_searchStringToDisplayInSearchField:null,_internalSearchCriteria:null,_isTypeListMode:!1,_typeList:[],_suggestionsInPipeline:0,_cancel_suggest_update:!1,_searchResourcesSet:v.deferred(),canvas:null,itemCache:{},serverSuggests:{},dataCache:{},typeTimeout:null,_betaSuggestionTimer:500,addinMode:void 0,init:function(t){if(this._parent(t),e.is(t)&&e.is(t.isBetaOn)&&!0===t.isBetaOn){if(this.betaProgramState=!0,e.is(n.parseQuery(window.location.search).debounce)){var i=parseInt(n.parseQuery(window.location.search).debounce);"number"==typeof i&&(this._betaSuggestionTimer=i)}}else this.betaProgramState=!1;t.addinMode&&(this.addinMode=t.addinMode),this.buildSkeleton(),this.attachEvents(),this._createCompassClientSocket()},_createCompassClientSocket:function(){this._compass_socket=new o.Socket("com.ds.searchdropdown"),this._compass_socket.subscribeServer("com.ds.compass",window)},_buildCategories:function(){this.elements.categoriesContainer=t.create("div",{id:"search-suggests-categories",class:"search-suggests-categories"}).inject(this.elements.suggestsContainer),this.elements.categories=[],C.getSuggestHelper().then(function(){for(var e,t=C.getSuggestionCategories(),i=0;i<t.length;i++)e=this._addCategoryToDropDown(t[i].nls,t[i].id),this._hideCategory(e)}.bind(this));let e={tenant:p.getActiveTenant()};if(!0===h.getOption("activate_instant_search_apps",e)){let e=this._addCategoryAppToDropDown("App");this._hideCategory(e)}},_getSuggestCategoriesResult:function(t){t.length>=3&&!1===this._isPredefinedQueryInstantSearch(t)?(this._showSuggestSpinner(),this._showCategoryContainer(),this.dispatchEvent("onUpdateSuggests"),clearTimeout(this._categorySuggestTimeout),this._categorySuggestTimeout=setTimeout(function(){let i={tenant:p.getActiveTenant()};!0===h.getOption("activate_instant_search_apps",i)&&x.getApplicationsFromCompass(t).then(function(t){e.is(t)&&e.is(t.count)&&e.is(t.data)&&this._updateCategoryApp(t.data,t.count)}.bind(this)),C.getSuggestHelper().then(function(){var i=C.getSuggests({search_text:t,feature:h.getOption("fedsearch_query_label.feature_id.InstantSearch")});Object.keys(i).forEach(function(t){i[t].then(function(i){this.getInputValue().length>=3&&(e.is(i.collection)&&e.is(i.nls)?this._updateCategory(t,i.collection,i.nls,i.collection.hits):e.is(i.nls)&&this._updateCategory(t,[],i.nls,0))}.bind(this),function(e){console.log(t,": ",e)})}.bind(this))}.bind(this))}.bind(this),this._betaSuggestionTimer)):this._clearDropDown()},_addCategoryToDropDown:function(e,i){var n=t.create("ul",{id:"search-suggests-categories-"+e,class:"search-suggest-category"}).inject(this.elements.categoriesContainer),s=t.create("li",{class:"search-category-label-container"}).inject(n),o=t.create("img",{class:"search-category-img"}).inject(s),r=t.create("div",{class:"search-category-label",html:k.get(e)}).inject(s),c=t.create("div",{class:"search-category-view-all",html:k.get("search.suggestion.viewAll"),title:k.replace(k.get("search.suggestion.tooltip"),{category:e})}).inject(s);return c.addEventListener("click",function(e){a.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"ClickOnViewMore",persDim:{pd1:"0"}}}),this._onClickViewAll(i,e)}.bind(this)),this.elements.categories.push({container:n,labelContainer:s,img:o,label:r,viewAll:c,item:[],model:{}}),n},_addCategoryAppToDropDown:function(e){var i=t.create("ul",{id:"search-suggests-categories-"+e,class:"search-suggest-category"}).inject(this.elements.categoriesContainer),n=t.create("li",{class:"search-category-label-container",style:"color: red"}).inject(i),s=t.create("li",{class:"search-category-item-container"}).inject(i),o=t.create("img",{class:"search-category-img",src:E.getWebappsAssetUrl("SNSearchUX","images/APPICON.png")}).inject(n),r=t.create("div",{class:"search-category-label",html:k.get(e)}).inject(n),c=t.create("div",{class:"search-category-view-all",html:k.get("search.suggestion.viewAll"),title:k.replace(k.get("search.suggestion.tooltip"),{category:e})}).inject(n);return c.addEventListener("click",function(e){a.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"ClickOnViewMore",persDim:{pd1:"0"}}}),x.searchApplicationsInCompass(this.getInputValue())}.bind(this)),this.elements.categories.push({container:i,labelContainer:n,itemContainer:s,img:o,label:r,viewAll:c,item:[],model:{}}),i},_updateCategory:function(i,n,s,o){var a=this;this._hideSuggestSpinner();var r=this.elements.categories.filter(e=>e.container.id.includes(s));if(r.length>0&&o>0){var c=r[0];this._clearCategory(c.container),this._showCategory(c.container);var l=c.label;if(l.setText(s+" ("+o+")"),l.setAttribute("count",o),l.setAttribute("title",s),n.length>0){var d,u,h,p;this._activateCategory(c,o);for(var g=0;g<n.length;g++){d=(p=n._models[g]).get("ds6w:label_value");var _="search-category-item-rounded";if(u=p.get("preview_url"),e.is(u)||(u=p.get("type_icon_url"),_=""),c.item.push(t.create("li",{class:"search-category-item"}).inject(c.container)),(h=c.item[c.item.length-1]).model=p,e.is(p)&&h.addEventListener("click",function(e){a._onClickItem(e)}),e.is(u)&&t.create("img",{src:u,class:_}).inject(h),e.is(d)){var m=t.create("div",{html:d,title:d}).inject(h);m.setAttribute("title",d),a._resizeCategorySuggestion(m)}}c.img.src=p.get("type_icon_url")}else this._deactivateCategory(c)}},_updateCategoryApp:function(i,n){var s=this.elements.categories.filter(e=>e.container.id.includes("App"));if(s.length>0&&n>0){var o=s[0];this._clearCategory(o.container),this._showCategory(o.container);var a,r=o.label;if(r.setText("App ("+n+")"),r.setAttribute("count",n),r.setAttribute("title","App"),i.length>0){this._activateCategory(o,n);for(var c=0;c<i.length;c++)if(e.is(i[c].id)){if(o.item.push(t.create("div",{class:"search-category-item-horizontal",id:i[c].id}).inject(o.itemContainer)),(a=o.item[o.item.length-1]).addEventListener("click",function(e){this._onClickItemApp(e)}.bind(this)),e.is(i[c].icon)&&t.create("img",{src:i[c].icon}).inject(a),e.is(i[c].title)){a.title=i[c].title;var l=t.create("div",{class:"search-category-item-horizontal-title",html:i[c].title}).inject(a);l.setAttribute("title",i[c].title),this._resizeCategoryAppTitle(l)}if(e.is(i[c].type)&&"Widget"===i[c].type){var d=t.create("div",{class:"search-category-app-widget-container"}).inject(a);t.create("div",{class:"search-category-app-widget-icon"}).inject(d)}}}else this._deactivateCategory(o)}},_onClickItem:function(t){var i=t.currentTarget.model,n=i.getSourceID(),s=i.getServiceID(),o=i.getPlatformID(),r=i.get("resourceid"),c=S.buildCompassSelectionData({widgetId:"",selectedModels:[i]});if(this._compass_socket.dispatchEvent("onSetX3DContent",c),a.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"ClickOnResult",persDim:{pd1:i._attributes["ds6w:label_value"],pd2:i._attributes["ds6w:responsible"],pd3:i._attributes["ds6w:created"],pd4:i._attributes["ds6w:community"],pd5:i._attributes["ds6w:type"],pd6:c.source,pd7:s}}}),"3dspace"===n){let e=t.target.title;b.dispatch("onViewSearch",[{displayString:e,query:'[ds6w:label]:"'+e+'"'}])}else T.getServiceUrl({serviceName:s,platformId:o,onComplete:function(t){M.load({serviceID:s,platformID:o,serviceURL:t}).then(function(n){if(e.is(n.getDoubleClickAction,"function")){let s={model:i,appID:p.getSearchAppId(),client_feature:"search_topbar_suggest",serviceURL:t,onComplete:function(t){e.is(t)&&e.is(t.id,"string")&&e.is(t.sourceJS,"string")&&t.sourceJS.length>0&&require([t.sourceJS],function(e){e.executeAction({action_id:t.id,actionsHelper:{getModel:function(){return i},getPlatformID:function(){return o},getClientInfo:function(){return p.identifyClientInfo("")},getValue:function(e){var t=e.predicate?e.predicate:e.attribute;return i.get(t+"_value")}},object_ids:[r]})})},onFailure:function(e){console.log(e)}};n.getDoubleClickAction.call(void 0,s)}})}})},_onClickItemApp:function(t){e.is(t.currentTarget.id)&&x.launchApplicationFormCompass(t.currentTarget.id).then(function(e){S._displayAlert({message:e,className:"success"})},function(e){S._displayAlert({message:e,className:"error"})})},_onClickViewAll:function(t,i){if(!e.is(i)||!i.target.hasClassName("search-category-label-empty")){var n=this.getInputValue(),s=C.buildSearchParams({category_id:t,search_text:n});s.objectToPreview="instantSearch",b.dispatch("onViewSearch",[e.extend({displayString:n},s)])}},_resizeCategorySuggestion:function(e){let t=window.getComputedStyle(e,null).getPropertyValue("font");if(0!==e.offsetWidth&&e.offsetWidth<=this.getTextWidth(e.textContent,t)){for(var i=e.textContent,n=0;n<50&&this.getTextWidth(i+"...")>e.offsetWidth-26;)i=i.slice(0,i.length-2),n++;e.setText(i+"...")}},_resizeCategoryAppTitle:function(e){window.getComputedStyle(e,null).getPropertyValue("font");if(0!==e.offsetWidth){for(var t=e.textContent,i=e.getParent().getParent().getSize().width,n=0;n<50&&this.getTextWidth(t+"...")>i/4;)t=t.slice(0,t.length-2),n++;n>0&&e.setText(t+"...")}},_isPredefinedQueryInstantSearch:function(e){return/^(\w{3}[:]$)/.test(e)},refreshCategories:function(){this._getSuggestCategoriesResult(this.getInputValue())},_clearDropDown:function(){this._hideSuggestSpinner();for(var e=0;e<this.elements.categories.length;e++)this._clearCategory(this.elements.categories[e].container),this._hideCategory(this.elements.categories[e].container);this._hideCategoryContainer()},_clearCategory:function(e){for(var t=e.getChildren(),i=0;i<t.length;i++)if(t[i].hasClassName("search-category-item-container"))for(var n=t[i].getChildren(),s=0;s<n.length;s++)n[s].destroy();else t[i].hasClassName("search-category-label-container")||t[i].destroy()},_hideCategory:function(e){this._clearCategory(e)&&e.hide()},_showCategory:function(e){e.show()},_activateCategory:function(t,i){t.labelContainer.hasClassName("search-category-label-empty")&&t.labelContainer.removeClassName("search-category-label-empty"),e.is(t.img)&&e.is(t.img.src)&&t.img.show(),e.is(t.viewAll)&&e.is(t.viewAll.show)&&(e.is(i)&&i<1?t.viewAll.hide():t.viewAll.show())},_deactivateCategory:function(t){t.labelContainer.hasClassName("search-category-label-empty")||t.labelContainer.addClassName("search-category-label-empty"),e.is(t.img)&&e.is(t.img.src)&&t.img.hide(),e.is(t.viewAll)&&e.is(t.viewAll.hide)&&t.viewAll.hide()},_hideSuggestSpinner:function(){e.is(this.elements.suggestSpinnerContainer)&&this.elements.suggestSpinnerContainer.hide()},_showSuggestSpinner:function(){e.is(this.elements.suggestSpinnerContainer)&&this.elements.suggestSpinnerContainer.show()},_hideCategoryContainer:function(){this.elements.categoriesContainer.isHidden()||this.elements.categoriesContainer.hide()},_showCategoryContainer:function(){this.elements.categoriesContainer.isHidden()&&this.elements.categoriesContainer.show()},isDropDownVisible:function(){return!this.elements.suggestsContainer.isHidden()},setInContextMode:function(e){this._inContextMode=e,!0===e&&!0===this.betaProgramState&&this._clearDropDown()},getInContextMode:function(){return!!e.is(this._inContextMode)&&this._inContextMode},_suggestPreviousQueries:function(t,i){var n=null,s=null;if(0===this._typeList.length&&(this._typeList=g.getSearchTypeCustoList()),this._isTypeListMode=!1,this._value=i,this._typeList.length&&0===i.length&&(n=this._typeList,this._isTypeListMode=!0),e.is(localStorage.SNSearchBoxStore)){n=JSON.parse(localStorage.SNSearchBoxStore);var o=[];i&&""!==i.replace(/\s+/g,"")?n.forEach(function(e){0===e.indexOf(i)&&e!==i&&o.push(e)}):o=n,s=o.reverse();var a=10;!0===h.getOption("search_compact_mode")&&(a=h.getOption("suggest_max")),!0===this.betaProgramState&&!0!==this._inContextMode&&this.secondaryMenu.currentMode!=k.search_current_tab&&this.getInputValue().length>=3&&(a=2),s.length>a&&(s=s.slice(0,a)),t.dispatchEvent("onUpdateSuggests",[s]),t.typeTimeout=null}else t.dispatchEvent("onUpdateSuggests",[s]);this.historySuggestions=s},getServerSuggestions:function(t){var i,n=this,s={query:t.replace(/^\s+|\s+$/g,""),input:t.replace(/^\s+|\s+$/g,"").split(" ")};if(e.is(n.secondaryMenu)&&e.is(n.secondaryMenu.getCurrentTenant)&&(i=n.secondaryMenu.getCurrentTenant()),t.length){if(!0===p.isSuggestAvailable(i)){this.getSearchResources().then(function(){m.login({resources:n._src_ressource,onComplete:function(){!function(){var t=h.getOption("suggest_length"),i=h.getOption("suggest_max_length");if(s.query.length>t-1&&s.query.length<i&&!e.is(n._inContextOptions)&&n.elements.input.placeholder===n._getPlaceHolderTextDependingOnActiveTenant("searchNew")){n._suggestionsInPipeline++;var o=P.getIcon(),a=P.getEnterpriseConceptsSuggestions(s.query);!1===n._src_ressource.getSuggestions(s,function(t){v.all([a,o]).then(function([i,s]){t=P._prioritizeSuggestions(t,i),n._suggestionsInPipeline--;var o=(t=t||[]).map(function(t){return e.is(t.isEnterpriseConcept)&&s?t.icon=s:t.icon="lightbulb",{label:t.entry,command:t.entry,icon:t.icon,highLight:e.is(t.isEnterpriseConcept)?t.highLight:void 0}});n._cancel_suggest_update||o.length>0&&0===n._suggestionsInPipeline&&n.dispatchEvent("onUpdateSuggests",{serverSuggests:o})})})&&n._suggestionsInPipeline--}}()},onFailure:function(){}})})}}else n.dispatchEvent("onUpdateSuggests",{serverSuggests:[]})},getSearchResources:function(){return this._searchResourcesSet.promise},_buildSearchChoice:function(t){var i=t.sources,n=this;a.subscribe({channel:"TopBar_Suggest",topic:"CancelSuggest",callback:function(){n._cancel_suggest_update=!0}});this.elements;if(this.elements.container.addEvent("drop",function(e){var t=null,i=!!document.documentMode,n=!i&&!!window.StyleMedia;if(i||n||""===e.dataTransfer.getData("shortData")){if(""!==e.dataTransfer.getData("text")){var s=JSON.parse(e.dataTransfer.getData("text"));t=[],s.data.items.forEach(function(e){t.push('"'+e.displayName+'"')})}}else e.preventDefault(),t=JSON.parse(e.dataTransfer.getData("shortData"));e.target.value=t.join(" OR "),e.stopPropagation(),e.preventDefault()}),this.elements.container.addEvent("paste",function(t){var i,s=k.search;if(e.is(n.secondaryMenu)&&e.is(n.secondaryMenu.getCurrentTenant)&&(i=n.secondaryMenu.getCurrentTenant()),e.is(i)&&"OnPremise"!==i.tenantId&&e.is(n.secondaryMenu)&&!n.secondaryMenu.isSingleTenant()?s+=" "+i.tenantName:s=k.searchNew,n.elements.input.placeholder===s||n.elements.input.placeholder===k.search_current_tab){var o=0;if(e.is(t.target)&&e.is(t.target.selectionStart)&&e.is(t.target.selectionEnd)&&(o=t.target.value.length-(t.target.selectionEnd-t.target.selectionStart)),0===o&&e.is(t)){var a=null;e.is(t.clipboardData)&&e.is(t.clipboardData.getData,"function")?(a=t.clipboardData.getData("text/plain"),n.getServerSuggestions(a)):e.is(window.clipboardData)&&e.is(window.clipboardData.getData,"function")&&(a=window.clipboardData.getData("Text"),n.getServerSuggestions(a));var r="";if(e.is(a,"string")&&a.length>0){var c=a.indexOf("\t")>=0,l=a.indexOf("\n")>=0,d=a.indexOf("||")>=0,u=a.indexOf("&&")>=0,p=a.indexOf("\\&&")>=0,g=a.indexOf("\\||")>=0;if(n._setInternalCriteria(a),!1===c&&!1===l&&!1===d&&!1===u)return void n.showClearSearchButton();var _=a.split("\n"),m="",S=!1;if(e.is(_,"array")&&_.length>0){for(var f=0,v=_.length;f<v;f++)if(e.is(_[f],"string")&&(_[f]=_[f].trim(),_[f].length>0)){var C=null,y="AND";c=(m=_[f]).indexOf("\t")>=0,d=m.indexOf("||")>=0,u=m.indexOf("&&")>=0,p=m.indexOf("\\&&")>=0,g=m.indexOf("\\||")>=0,!0===p&&(m=m.replace(/\\\&/g,"##__##")),!0===g&&(m=m.replace(/\\\|/g,"__##__")),!0===c?C=m.split("\t"):!0===u?C=m.split("&&"):!0===d?(C=m.split("||"),y="OR"):C=[m];for(var w="",b=0,D=C.length;b<D;b++)e.is(C[b],"string")&&(C[b].trim(),C[b].length>0&&(!0===p&&(C[b]=C[b].replace(/##__##/g,"&")),!0===g&&(C[b]=C[b].replace(/__##__/g,"|")),w.length>0&&(w+=" "+y+" "),C[b].length>1&&'"'===C[b][0]&&'"'===C[b][C[b].length-1]&&(C[b]=C[b].substr(1,C[b].length-2)),C[b]=C[b].replace(/\\([\s\S])|(")/g,"\\$1$2"),w+='"'+C[b]+'"'));w.length>0&&(!0===S&&(r+=" OR "),v>1&&(r+="("),r+=w,v>1&&(r+=")"),S=!0)}var E=h.getOption("maxTopBarInput");r.length>E&&(r=r.substring(0,E)),t.target.value=r,r.length>0&&n.showClearSearchButton(),t.stopPropagation(),t.preventDefault()}}}}}),e.is(i)||(i=this.options.allSources),!e.is(i,"object"))throw new Error("Invalid value for allSources in SearchAutocomplete._buildSearchChoice!");i.loadPredicates=!0,this._src_ressource=new d(i),this._searchResourcesSet.resolve(),this._cstoreSources=this._src_ressource.getAvailableTenants(),this._cstoreSources.length>1&&(O=!0),e.is(this._cstoreSources,"array")&&this._cstoreSources.length>0&&(U=this._cstoreSources[0].tenantId),p.setAutocompleteRendered()},_getSearchBtn:function(){return null===this._searchBtn&&(this._searchBtn=e.extendElement(document.body).getElement(".run_btn_search")),this._searchBtn},_changeSearchBtnIcon:function(t){var i=this._getSearchBtn();if(e.is(i)){for(var n=i.classList,s=new RegExp("fonticon-\\S+$"),o=0;o<n.length;o++)s.test(n[o])&&i.removeClassName(n[o]);i.addClassName(t)}},setInAppContext:function(t){!1===t.isInAppContext&&(this._inContextOptions=null),this._inAppContext=t.isInAppContext,!0===t.isInAppContext&&e.is(t.data)&&e.is(t.data.search_criteria_to_display,"string")?this.setFieldValue(t.data.search_criteria_to_display):(this.secondaryMenu.currentMode,k.search_current_tab,this.setFieldValue("")),this._temporarilyOutOfContext=!1},_setFindInApp:function(t){if(this._internalSearchCriteria=null,this._setPlaceHolderValue(k.get("find_in_app")),e.is(this._sitChoice)&&(this._sitChoice.setHTML(k.get("find_in_app")),this._sitChoice.getParent().addClassName("selected")),e.is(t)&&e.is(t.tenant)){if(this.options.events.setSourceCStorage(t.tenant),this._cstoreSources.length>1&&e.is(this._cstoreChoice)&&this._cstoreChoice.length>0)for(var i=0;i<this._cstoreSources.length;i++)this._cstoreSources[i].tenantId===t.tenant?this._cstoreChoice[i].getParent().addClassName("active"):this._cstoreChoice[i].getParent().removeClassName("active");this._setPlaceHolderValue(this._getPlaceHolderTextDependingOnActiveTenant("find_in_app"))}else this.options.events.setSourceCStorage(U);this._inContextOptions=t},setFindInApp:function(e){this.keepPreviousSearchMode(),this._setFindInApp(e)},keepPreviousSearchMode:function(){this.elements.input.placeholder===this._findInTabNLS||this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("find_in_app")?this._previouslyActiveSource=p.SearchTypeEnum.SEARCH_IN:this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("search")?this._previouslyActiveSource=p.SearchTypeEnum.SEARCH:this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("mycontent")?this._previouslyActiveSource=p.SearchTypeEnum.MY_CONTENT:this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("adv_search")?this._previouslyActiveSource=p.SearchTypeEnum.ADVANCED_SEARCH:this.elements.input.placeholder===this._getPlaceHolderTextDependingOnActiveTenant("MySavedSearches")?this._previouslyActiveSource=p.SearchTypeEnum.FAVORITE_SEARCH:this._previouslyActiveSource=p.SearchTypeEnum.SEARCH_IN},onSwitchToFindInApp:function(e){this._setFindInApp(e)},buildSkeleton:function(){var e=this.elements,i=this.options.className;e.form=t.create("form",{class:i,autocomplete:"off"}),e.inputContainer=t.create("div",{class:i+"-searchbox"}).inject(e.form),e.input=t.create("input",{class:i+"-input",placeholder:this.options.placeholder,type:"text",maxlength:h.getOption("maxTopBarInput")}).inject(e.inputContainer),this.resetInput(),e.suggestsContainer=t.create("div",{class:i+"-suggests"}).inject(e.form),e.serverSuggests=t.create("ul",{id:"search-suggests-server"}).inject(e.suggestsContainer),e.suggests=t.create("ul",{id:"search-suggests-history"}).inject(e.suggestsContainer),e.container=e.form,!0===this.betaProgramState&&(e.suggestSpinnerContainer=t.create("ul",{id:"search-suggests-spinner-container",class:"search-suggests-spinner-container"}).inject(e.suggestsContainer).hide(),e.suggestSpinner=new D({className:"search-suggests-spinner"}).inject(e.suggestSpinnerContainer).show(),this._buildCategories())},getSuggestions:function(t){var i,n,s,o=this;if(t)return this.dataCache[t]?(this.dispatchEvent("onUpdateSuggests",[this.dataCache[t]]),void(this.typeTimeout=null)):this.options.suggestUrl&&(i=(s=this.options.suggestUrl.split("?"))[0],n=s[1].replace("{text}",t),e.is(this.options.source))?(n=this.options.source.getServicesData("suggest",t),UWA.Data.request(i,{method:this.options.method||"POST",data:this.options.data||n,type:this.options.type||"json",headers:this.options.headers||{"Content-Type":"application/json"},onComplete:function(e){return(e=o.dataParse(e)).length>0&&(o.dataCache[t]=e,o.dispatchEvent("onUpdateSuggests",[e])),o.typeTimeout=null,o.typeTimeout},proxy:this.options.proxy||null})):void 0},onUpdateSuggests:function(t){this.dispatchEvent("onShowSuggests");var i,n,s,o=this.elements,r=this;null===t&&(o.suggests.empty(),o.serverSuggests.empty()),e.is(t)&&e.is(t.serverSuggests,"array")&&t.serverSuggests.length>0?(o.suggestsContainer.show(),s=t.serverSuggests,o.serverSuggests.empty(),r.serverSuggests={},s.forEach(function(e){i=r.createSuggestElement(!0,e.command,e.icon,e.highLight,o.serverSuggests,e.label),r.resizeText(i),r.serverSuggests[e.command]=r.querySuggest(e),i.addEvent("click",function(){a.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"ClickOnSuggestionIndex",persDim:{pd1:e.label}}}),r.dispatchEvent("onSelect",[e.command,r.serverSuggests[e.command]])})})):(e.is(t)&&e.is(t.history,"Array")||Array.isArray(t))&&(s=t.history||t,o.suggests.empty(),o.serverSuggests.empty(),s.forEach(function(e){n=r.getFormattedSuggest(e),i=r.createSuggestElement(!1,n,"clock",o.input.value,o.suggests),r.resizeText(i),i.addEvent("click",function(e){var t=e.currentTarget.title,i=r.historySuggestions.findIndex(e=>e===t);a.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"ClickOnSuggestionHistory",persDim:{pd1:t,pd2:"index: "+i}}}),r.dispatchEvent("onSelect",[t,e])})})),0===o.suggests.childElementCount&&0===o.serverSuggests.childElementCount&&(!1===this.betaProgramState||e.is(o.categoriesContainer)&&o.categoriesContainer.isHidden())?o.suggestsContainer.hide():o.suggestsContainer.show(),0===o.suggests.childElementCount?o.suggests.hide():o.suggests.show(),0===o.serverSuggests.childElementCount?o.serverSuggests.hide():o.serverSuggests.show()},onHideSuggests:function(){this.elements.container.removeClassName(this.options.className+"-suggestsDisplayed")},onShowSuggests:function(){this.elements.container.addClassName(this.options.className+"-suggestsDisplayed")},createSuggestElement:function(i,n,s,o,a,r){var c,l,d;(l=i?t.create("div",{class:"search-suggest-div-element",title:n}):t.create("div",{class:"search-history-div-element",title:n}),s)&&(p.iconURL_check(s)?((d=t.create("span",{class:"fonticon"})).inject(l),t.create("img",{src:s,width:"17px",height:"auto"}).inject(d)):(s.startsWith("fonticon-")&&(s=s.replace(/fonticon-/g,"")),(d=t.create("span",{class:"fonticon fonticon-"+(s||"clock")})).inject(l)));if((c=i?t.create("a",{class:"search-suggest-element"}).inject(l):t.create("a",{class:"search-history-element"}).inject(l)).setText(n),o||(o=e.String.escapeHTML(this.elements.input.value.split(" ").pop())),o&&r){(r=e.String.escapeHTML(r||""))&&n!==r&&(c.innerHTML='<span style="color:#ccc; font-size:13px;">'+function(e,t,i){let n=e;if(n){let e=n.lastIndexOf(t);e>=0&&(n=n.substring(0,e)+i+n.substring(e+t.length))}return n}(c.innerHTML,r,"</span>"+r));var u=function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}(o),h=new RegExp(u+"(?!.*"+u+")","i"),g=r.replace(h,"<strong>$&</strong>");c.innerHTML=g}return l.inject(a),l},onClick:function(e){a.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"focusOnSearchField"}}),-1===this.elements.form.className.indexOf("nv-autocomplete-suggestsDisplayed")&&this.onFocus(e),!0===this.betaProgramState&&!0!==this._inContextMode&&this.refreshCategories()},onFocus:function(){if(this._cancel_suggest_update=!1,this._inContextOptions&&this._inContextOptions.advanced_search&&this._inContextOptions.advanced_search.exclusive)this.dispatchEvent("onUpdateSuggests",[[]]);else{var e=this.getInputValue();this._suggestPreviousQueries(this,e),this.getServerSuggestions(e),this.dispatchEvent("onShowSuggests"),""===e&&!0===h.options.search_settings.search_on_keyup&&this.dispatchEvent("defaultSearch",{value:"*"})}},onBlur:function(){!0!==this.preventBlur?setTimeout(function(){this.dispatchEvent("onHideSuggests"),e.is(this.elements.searchOptions)&&this.elements.searchOptions._secondaryMenu.hide(),this._cancel_suggest_update=!0}.bind(this),200):this.preventBlur=!1},onKeyUp:function(t){var n=this;if(38!==t.keyCode&&40!==t.keyCode&&37!==t.keyCode&&39!==t.keyCode&&35!==t.keyCode&&36!==t.keyCode&&27!==t.keyCode){if(e.is(this.elements.input)&&"?"===this.getInputValue())return this.setFieldValue(""),void this._showPQSelectionUX();this._setInternalCriteria(null);var s=t.srcElement;if(s.value.length>=s.maxLength){var o={level:"warning",title:k.get("searchFieldMaxLengthTitle"),message:k.replace(k.get("searchFieldMaxLengthText"),{number:h.getOption("maxTopBarInput")}),sticky:!0,poNotifId:"search-query-long"};w.removeLastNotificationDisplayed(),y.addNotif(o)}var a,r=i.getElement(t);r.value?r.value.length>0?(this.showClearSearchButton(),this._suggestPreviousQueries(this,r.value)):(this.elements.input.placeholder!==k.search_current_tab&&this.hideClearSearchButton(),this._suggestPreviousQueries(this,r.value)):(this.elements.input.placeholder!==this._findInTabNLS&&this.elements.input.placeholder!==k.search_current_tab&&this.hideClearSearchButton(),this._suggestPreviousQueries(this,r.value)),!1===h.options.search_settings.search_on_keyup?!0===this.betaProgramState&&!0!==this._inContextMode&&this.secondaryMenu.currentMode!=k.search_current_tab?(n._getSuggestCategoriesResult(r.value),clearTimeout(this._suggestTimeout),this._suggestTimeout=setTimeout(function(){n.getServerSuggestions(r.value)},350)):(clearTimeout(this._suggestTimeout),this._suggestTimeout=setTimeout(function(){n.getServerSuggestions(r.value)},350)):(r.value&&0===r.value.length&&clearTimeout(this._secondTimeoutId),clearTimeout(this._timeoutId),this._timeoutId=setTimeout((a=r.value,function(){a&&a.length>0&&n.options.events.onSearch(a),n._suggestPreviousQueries(n,a),clearTimeout(n._suggestTimeout),n._suggestTimeout=setTimeout(function(){n.getServerSuggestions(a)},350)}),500))}},onKeyDown:function(e){var t=UWA.Event.whichKey(e);38===e.keyCode?this._arrowKeyOnSuggestions(e,-1):40===e.keyCode?this._arrowKeyOnSuggestions(e,1):27===e.keyCode?this._escapeKeyOnSuggestions(e):"ctrl+a"===t&&e.stopPropagation()},attachEvents:function(){var t;(t=this.elements).input.addEvent("keyup",this.onKeyUp.bind(this)),-1===["iphone","ipad","android"].indexOf(p.getDeviceCategory())?t.input.addEvent("blur",this.onBlur.bind(this)):t.input.addEvent("focusout",this.onBlur.bind(this)),t.input.addEvent("focus",this.onFocus.bind(this)),t.form.addEvent("submit",function(n){var s=this.itemCache[t.input.value.toLowerCase()];return a.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"HitOnEnter-SearchField",persDim:{pd1:t.input.value}}}),i.stop(n),e.is(this.serverSuggests)&&-1!==Object.keys(this.serverSuggests).indexOf(t.input.value)?(this.dispatchEvent("onSelect",[t.input.value,this.serverSuggests[t.input.value]]),t.input.blur(),this.dispatchEvent("onHideSuggests")):this.options.shouldExist&&!s||(this.options.suggestKey&&s&&(t.input.value=s[this.options.suggestKey]),this.dispatchEvent("onSelect",[t.input.value,s]),t.input.blur(),this.dispatchEvent("onHideSuggests")),!1}.bind(this)),(t=this.elements).input.addEvent("keydown",this.onKeyDown.bind(this)),t.input.addEvent("click",this.onClick.bind(this))},dataParse:function(t){var i,n,s,o=this.options.dataParser;if(e.is(o,"function"))t=o(t);else{if(Json.isJson(t))t=Json.decode(t),s=!0;else for(i in t=Json.xmlToJson(t))if(t.hasOwnProperty(i)){t=t[i];break}for(i in t)t.hasOwnProperty(i)&&(n||(n=i),Array.isArray(t[i])&&(t=t[i],s=!0));!s&&n&&(t=[t[n]])}return Array.isArray(t)?t:[]},_escapeKeyOnSuggestions:function(){this.dispatchEvent("onHideSuggests")},_arrowKeyOnSuggestions:function(t,n){var s=this._getSuggestions().getChildren()[0].getChildren().concat(this._getSuggestions().getChildren()[1].getChildren());if(!0===this.betaProgramState)for(var o=0;o<this.elements.categories.length;o++)for(var a=0;a<this.elements.categories[o].item.length;a++)s.push(this.elements.categories[o].item[a]);if(!(s.length<1)){this.dispatchEvent("onShowSuggests");var r=-1,c=-1;for(o=0;o<s.length;o++)if(s[o].hasClassName("suggestion-selected")){r=o;break}if((c=r+n)<0&&(c=s.length-1),c>s.length-1&&(c=0),r>=0&&s[r].removeClassName("suggestion-selected"),c>=0){s[c].addClassName("suggestion-selected");var l=i.getElement(t);e.is(l)&&(l.value=s[c].getText()),this.showClearSearchButton()}}},_showPQSelectionUX:function(){this.dispatchEvent("showPQListUX")},onSelect:function(t,i,n){e.is(n,"string")&&n.length>0&&(this._isTypeListMode=!0,this._value=""),this._setInputValue(t),this.dispatchEvent("onHideSuggests"),this.showClearSearchButton()},_getClearSearchBtn:function(){return null===this._clearSearch&&(this._clearSearch=e.extendElement(document.body).getElement(".clear_btn_search")),this._clearSearch},showClearSearchButton:function(){var t=this._getClearSearchBtn();if(e.is(t)&&e.is(t.show,"function")){t.setStyle("display","inline-block"),t.show();var i=e.extendElement(document.body).getElement(".nv-autocomplete-input");e.is(i)&&i.addClassName("clear-visible")}},hideClearSearchButton:function(){var t=this._getClearSearchBtn();if(e.is(t)&&e.is(t.hide,"function")){t.hide();var i=e.extendElement(document.body).getElement(".nv-autocomplete-input");e.is(i)&&i.removeClassName("clear-visible")}},_setPlaceHolderValue:function(t){if(!e.is(t,"string"))throw new Error("Bad arg in _setPlaceHolderValue!");switch(t){case k.get("MySavedSearches"):this._changeSearchBtnIcon("fonticon-favorite-on");break;case k.get("mycontent"):this._changeSearchBtnIcon("fonticon-user");break;case k.get("search"):this._changeSearchBtnIcon("fonticon-search");break;case k.get("similar_search"):this._changeSearchBtnIcon("fonticon-search-similar");break;case this._findInTabNLS:this._changeSearchBtnIcon("fonticon-filter");break;case k.get("adv_search"):this._changeSearchBtnIcon("fonticon-search-cog");break;default:this._changeSearchBtnIcon("fonticon-search")}if(!e.is(this.elements.input)||!e.is(this.elements.input.placeholder))throw new Error("placeholder not found!");this.elements.input.placeholder=t},getPlaceHolder:function(){return this.elements.input.placeholder},_getSuggestions:function(){return null===this._autocompleteSuggests&&(this._autocompleteSuggests=e.extendElement(document.body).getElement(".nv-autocomplete-suggests")),this._autocompleteSuggests},_setInputValue:function(e){this.elements.input.value=e},getInputValue:function(){return void 0===this.elements.input.value?"":this.elements.input.value},setFieldValue:function(t){this._setInputValue(t),this._searchStringToDisplayInSearchField=t,e.is(t,"string")&&t.length>0?this.showClearSearchButton():this.hideClearSearchButton()},_setInternalCriteria:function(e){this._internalSearchCriteria=e},_getPlaceHolderTextDependingOnActiveTenant:function(t){if(!e.is(t,"string")||0===t.length)throw new Error("E_INVALIDARG: need a key !");var i=k.get(t);return this._cstoreSources.length>1&&(e.is(k[t+"_in_active"])?i=k.replace(k.get(t+"_in_active"),{tenant:this.getSelectedTenant().displayName}):i+=" "+this.getSelectedTenant().displayName),i},isMultiTenantContext:function(){return O},setSelectedTenant:function(t){U=t,e.is(this._src_ressource)&&this._src_ressource.setActiveTenant(U)},getSelectedTenant:function(){if(!O)throw new Error("E_INVALIDARG: not in multi tenant context, check first using isMultiTenantContext before calling this function !");var t=null;if(e.is(this.secondaryMenu)&&e.is(this.secondaryMenu.getCurrentTenant)){var i=this.secondaryMenu.getCurrentTenant();t={tenantId:i.tenantId,displayName:i.tenantName}}return null===t&&(t={tenantId:U,displayName:U}),t},_findInthisTabOnClick:function(e){!0===e&&this._restoreActiveSearchInTab(),p.isOneSearchInternalProd()&&(u.setItem("find_in_this_tab_default",e),h.changeSettings({find_in_this_tab_default:e}),u.commit())},_restoreActiveSearchInTab:function(){var t=this;if("3DDashboard"===p.identifyClientInfo().identifier){require(["DS/Dashboard/PublicAPI"],function(i){var n=i.getActiveTab();e.is(n)&&e.is(n.shouldPropagateSearch)&&!0===n.shouldPropagateSearch&&e.is(n.shouldPropagateSearchArg,"string")&&0<n.shouldPropagateSearchArg.length&&t.setFieldValue(n.shouldPropagateSearchArg)})}},getFocus:function(){this.elements.input.focus()},querySuggest:function(e){return{search_type:"#search",value:e.command,searchStringToDisplayInSearchField:e.label,internalSearchCriteria:null,adv_search:!1}},resetInput:function(){this.elements.input.placeholder?this._setInputValue(""):this._setInputValue(this.options.placeholder),this.resetCache()},resetCache:function(){this.dataCache={},this.itemCache={}},resizeText:function(e){var t=e.getElementsByTagName("a")[0],i=e.getElementsByTagName("span")[0],n=window.getComputedStyle(t,null).getPropertyValue("font");if(0!==e.offsetWidth&&0!==i.offsetWidth&&e.offsetWidth-i.offsetWidth-20<=this.getTextWidth(t.text,n)){for(var s=t.text,o=0;o<50&&this.getTextWidth(s+"...")>e.offsetWidth-i.offsetWidth-20;)s=s.slice(0,s.length-2),o++;t.setText(s+"...")}},getTextWidth:function(t,i){e.is(this.canvas)||(this.canvas=document.createElement("canvas"));var n=this.canvas.getContext("2d");return n.font=i,n.measureText(t).width},getFormattedSuggest:function(t){return this.options.suggestFormat.replace(/\{(\w+)\}/g,function(i,n){return e.is(t,"string")?t:t[n]})}})}),define("DS/SNSearchUX/SearchView",["text!DS/SNSearchUX/assets/templates/SearchView.html","DS/Handlebars/Handlebars4","UWA/Core","UWA/Event","UWA/Class/View","UWA/Class/Debug","DS/SNInfraUX/SearchUtils","DS/SNSearchUX/SearchHistoric","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/SearchPreferences","DS/SNSearchUX/SearchDropDown","DS/SNSearchUX/SearchDropDown2","DS/SNSearchUX/SearchSecondaryMenu","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/PubSub/PubSub","DS/MessageBus/MessageBus","DS/SNInfraUX/SessionSecurityContextServices","DS/SNSearchUX/utils/SearchViewEvents","i18n!DS/SNSearchUX/assets/nls/SNSearchUX.json"],function(e,t,i,n,s,o,a,r,c,l,d,u,h,p,g,_,m,S,f,v,C,y){"use strict";return s.extend(o,{name:"DS/SNSearchUX/SearchView",uwaClassName:"SearchView",id:"global_ctn_search",className:"global_ctn_search topbar-search",domEvents:{"click div.run_ctn_search":"_onSearch","click div.clear_btn_search":"_onClearSearch","keyup input.input_search":"_onSearchInputKeyUp","keydown input.input_search":"_onSearchInputKeyDown"},template:t.compile(e),autocomplete:void 0,socket:void 0,selectedSource:void 0,searchTabId:void 0,lastSearch:void 0,secondaryOptionToHide:[],betaProgramState:void 0,currentTenant:void 0,_setSource:function(e){var t=this;l.getTenantSettings(e.sources.active_tenant).then(function(){let n=l.getOption("deactivate_FUN108944");if(["iphone","ipad","android"].indexOf(a.getDeviceCategory()),!0!==n){let n=l.getOption("activate_instant_search",{tenant:e.sources.active_tenant});u.setItem("InstantSearchSCC",n),u.commit(),!0===n&&"catiav5"!==t.addinMode&&"solidworks"!==t.addinMode?(t.betaProgramState=u.getItem("InstantSearchSCC"),i.is(t.betaProgramState)||(t.betaProgramState=!0)):t.betaProgramState=!1,t.render()}i.is(t.topBarMenu)&&t.topBarMenu.initTenantOnSecondaryMenu(e)}),require(["DS/SNSearchUX/SearchUX_TopBar"],function(n){var s=n.getAddinMode();i.is(s,"string")&&(e.searchParams=e.searchParams||{},e.searchParams.enable_search_in_this_tab=!1),i.is(t.autocomplete)&&i.is(t.autocomplete._buildSearchChoice,"function")?(i.is(e.searchParams)&&i.is(t.topBarMenu)&&(t.topBarMenu._manageSecondaryMenuOptions(e.searchParams),i.is(s,"string")&&"true"===s&&t.topBarMenu._setSecondaryHiddenOptionsPermanent([y.LastSearchResults,y.PredefinedQuery])),e.betaProgramState=t.betaProgramState,t.autocomplete._buildSearchChoice(e)):i.is(t.autocomplete)&&i.is(t.autocomplete.initSources,"function")&&t.autocomplete.initSources(n._resourcesMgt)})},setup:function(e){var t=this;if("3DSwym"===a.identifyClientInfo().identifier&&(y.search_current_tab=y.search_current_page),i.is(e)&&i.is(e.model)&&i.is(e.model.previousAttributes,"function")){let t=e.model.previousAttributes();i.is(t.addinMode)&&(this.addinMode=t.addinMode,i.is(this.addinMode,"object")&&(this.addinMode=this.addinMode.value))}i.is(e)&&i.is(e.searchMenu)&&i.is(e.searchMenu.hideTenantMenu)&&(this.hideTenantMenu=!0),!0===l.getOption("forceSearchTransientAndNoTab")&&(u.setItem("search_tabbed_ui",!1),u.commit({})),this.searchViewEventsManager=new C({searchView:this}),i.is(window.notifs)||(window.notifs=_,m.setNotificationManager(window.notifs)),S.add("search:closeTransient",function(){t.socket.dispatchEvent("hideAdvancedSearch"),t.autocomplete.setFieldValue(""),f.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"datagrid_preference_force_close"}),t.socket.dispatchEvent("clearfilterbyclosesidepanel"),i.is(t.topBarMenu)&&(t.topBarMenu._setSecondaryHiddenOptions(),t.topBarMenu._inAppContext?t.topBarMenu.restoreAppContext(localOptions):t.topBarMenu.setSearchMode({noFocus:!0}),t.topBarMenu._switchSearchMode(),t.topBarMenu._clickOnSearch())}),S.add("search:setCriteria",function(e){t.autocomplete._setInternalCriteria(e),t.autocomplete.setFieldValue(e)});require(["DS/TopBar/TopBar"],function(e){void 0===e.attributes&&(e.attributes={}),e.addEvent({events:{mobileSearchAction:function(e){switch(e.action){case"enable":i.is(t.autocomplete)&&t.autocomplete.elements.input.focus()}}}})}),f.subscribe({channel:"searchView",topic:"deactivateInContextSearch",callback:function(e){i.is(t.topBarMenu)&&t.topBarMenu.restoreAppContext(e),i.is(t.autocomplete)&&t.autocomplete.setInContextMode(!1),i.is(t.topBarMenu)&&t.topBarMenu._clickOnSearch()}}),this.socket=c.createSocket({socket_id:"searchview_socket_id"}),this.socket.addListener("onViewSearch",function(){t._onSearch()}),this.socket.addListener("onSetSources",function(e){t._setSource(e)}),this.socket.addListener("onSetFindInApp",function(e){t.autocomplete.setFindInApp(e)}),this.socket.addListener("onSetBackSearchOrFindInTab",function(e){i.is(t.topBarMenu)&&t.topBarMenu.setSearchMode(e)}),this.socket.addListener("onSetInAppContext",function(e){i.is(t.topBarMenu)&&t.topBarMenu.setInAppContext(e)}),this.socket.addListener("openTagger",function(e){t.socket.dispatchEvent("openTagger",e)}),this.socket.addListener("setTaggerMode",function(e){t.socket.dispatchEvent("setTaggerMode",e)}),this.socket.addListener("closeTagger",function(e){t.socket.dispatchEvent("closeTagger",e)}),this.socket.addListener("onSetFocusInSearchField",function(){setTimeout(function(){i.is(t.topBarMenu)&&i.is(t.topBarMenu._secondaryMenu)&&!1===t.topBarMenu._secondaryMenu.isVisible&&t.topBarMenu._secondaryMenu.toggle(),i.is(t.autocomplete)&&!t.autocomplete.isDropDownVisible()&&t.autocomplete.elements.input.focus()},100)}),this.socket.addListener("onSelectTenant",function(e){}),this.socket.addListener("onSelectTenantAfterTabActivation",function(e){i.is(t.topBarMenu)?(t.topBarMenu.selectTenantOnTabActivation(e),t.topBarMenu._clickOnSearch()):i.is(t.autocomplete.selectTenantOnTabActivation,"function")&&t.autocomplete.selectTenantOnTabActivation(e)}),this.socket.addListener("onRefreshSearchField",function(e){if(!i.is(e))throw new Error("Invalid localOptions in onRefreshSearchField");e.searchStringToDisplayInSearchField===y.get("myContent_searchFav")&&e.internalSearchCriteria!==y.get("myContent_searchFav")?i.is(t.topBarMenu)&&t.topBarMenu._clickOnSearch({focus:!1}):e.internalSearchCriteria===a.SearchTypeEnum.MY_CONTENT?i.is(t.topBarMenu)&&t.topBarMenu._clickOnMyContent({focus:!1}):e.internalSearchCriteria===a.SearchTypeEnum.FAVORITE_SEARCH?i.is(t.topBarMenu)&&t.topBarMenu._clickOnFavoriteSearches({focus:!1}):e.internalSearchCriteria!==a.SearchTypeEnum.ADVANCED_SEARCH&&e.originalSearchCriteria!==a.SearchTypeEnum.ADVANCED_SEARCH||i.is(t.topBarMenu)&&t.topBarMenu._clickOnAdvancedSearch({focus:!1}),i.is(t.topBarMenu)&&i.is(e)&&i.is(e.isPinnedWidgetMaximized)&&!0===e.isPinnedWidgetMaximized&&t.topBarMenu._toggleDropDownMenuItem(y.search_current_tab,"show"),i.is(e,"string")?(e.length>0&&i.is(t.topBarMenu)&&t.topBarMenu._clickOnSearch(),t.autocomplete.setFieldValue(e)):i.is(e,"object")&&i.is(e.searchStringToDisplayInSearchField,"string")&&i.is(e.internalSearchCriteria,"string")&&(e.searchStringToDisplayInSearchField.length>0&&i.is(t.topBarMenu)&&t.topBarMenu.currentMode!==y.search_current_tab&&t.topBarMenu._clickOnSearch({focus:!1}),e.searchStringToDisplayInSearchField.length>=3?(t.autocomplete.setFieldValue(e.searchStringToDisplayInSearchField),t.autocomplete.switchActiveTabinstantSearchTab(e.searchStringToDisplayInSearchField,!0)):t.autocomplete.resetSearchField(e.searchStringToDisplayInSearchField,!0),t.autocomplete._setInternalCriteria(e.internalSearchCriteria))}),this.socket.addListener("onSwitchMode",function(e){t._onSwitchMode(e)}),this._filterInProgress=!1,this.socket.addListener("clickOnChoiceSearch",function(e){i.is(t.topBarMenu)&&t.topBarMenu._clickOnSearch(e)}),this.socket.addListener("clickOnChoiceMyContent",function(e){i.is(t.topBarMenu)&&t.topBarMenu._clickOnMyContent(e),e.searchStringToDisplayInSearchField&&(t.autocomplete.resetSearchField("",!0),t.autocomplete.setPlaceHolderValue(e.searchStringToDisplayInSearchField))}),this.socket.addListener("clickOnChoiceAdvancedSearch",function(e){i.is(t.topBarMenu)&&t.topBarMenu._clickOnAdvancedSearch(e),e.searchStringToDisplayInSearchField&&(t.autocomplete.resetSearchField("",!0),t.autocomplete.setPlaceHolderValue(e.searchStringToDisplayInSearchField))}),this.socket.addListener("clickOnChoiceFavoriteSearch",function(e){i.is(t.topBarMenu)&&t.topBarMenu._clickOnFavoriteSearches(e),e.searchStringToDisplayInSearchField&&(t.autocomplete.resetSearchField("",!0),t.autocomplete.setPlaceHolderValue(e.searchStringToDisplayInSearchField))}),this.socket.addListener("onSetFindInTab",function(e){i.is(t.topBarMenu)&&t.topBarMenu._clickOnSearchInCurrentTab()}),this.socket.addListener("onSwitchToFindInTab",function(e){i.is(t.topBarMenu)&&t.topBarMenu._clickOnSearchInCurrentTab()}),this.socket.addListener("onSwitchToFindInApp",function(e){t.autocomplete.onSwitchToFindInApp(e)}),this.socket.addListener("hideSearchInThisTab",function(e){i.is(t.topBarMenu)&&t.topBarMenu._toggleDropDownMenuItem(y.search_current_tab,"hide")}),this.socket.addListener("showSearchInThisTab",function(e){i.is(t.topBarMenu)&&t.topBarMenu._toggleDropDownMenuItem(y.search_current_tab,"show")}),this.socket.addListener("onPQPrefixSelect",function(e){i.is(t.topBarMenu)&&t.topBarMenu.setSelectedPQPrefix(e)}),this.socket.addListener("onInContextSearch",function(e){i.is(t.topBarMenu)&&!t.topBarMenu._inAppContext?(t._prevTenant=t.topBarMenu.getCurrentTenant(),t.topBarMenu._setSecondaryHiddenOptions("inContext"),"furtive"!==e.inContextOptions.mode&&i.is(e.inContextOptions.app_socket_id,"string")&&"socket_id_#saved_search_edit#"===e.inContextOptions.app_socket_id||(t.topBarMenu.setInAppContext({isInAppContext:!0}),t.topBarMenu.setFindInContext(e.inContextOptions,e.placeholder)),i.is(e.inContextOptions.advanced_search)&&i.is(e.inContextOptions.advanced_search.showByDefault)&&!0===e.inContextOptions.advanced_search.showByDefault?t.topBarMenu._clickOnAdvancedSearch({focus:!1}):t.topBarMenu._clickOnSearch({focus:!1})):t.autocomplete._inAppContext||("furtive"===e.inContextOptions.mode||"socket_id_#saved_search_edit#"!==e.inContextOptions.app_socket_id?i.is(t.topBarMenu)&&t.topBarMenu._setSecondaryHiddenOptions("inContext"):i.is(e.inContextOptions.advanced_search)),i.is(t.autocomplete)&&t.autocomplete.setInContextMode(!0,e)}),this.socket.addListener("onCloseTransient",function(e){t._onCloseTransient(e)}),this.socket.addListener("onCloseTransientTopBar",function(e){t._onCloseTransient(e)}),this.socket.addListener("onInContextSearchDeactivated",function(e){t.socket.dispatchEvent("onCloseTransient"),i.is(t.topBarMenu)&&i.is(t.topBarMenu.restoreAppContext)&&t.topBarMenu.restoreAppContext(e),i.is(t.restoreAppContext,"function")&&t.restoreAppContext(e)&&(t.restoreAppContext=null),i.is(t.autocomplete)&&i.is(t.autocomplete.setInAppContext)&&t.autocomplete.setInAppContext({isInAppContext:!1})}),this.socket.addListener("Last_Tag_Filter",function(e){var n=t.autocomplete._inContextOptions;!i.is(n)&&i.is(t.topBarMenu)&&(n=t.topBarMenu._inContextOptions),n&&"socket_id_#saved_search_edit#"===n.app_socket_id||(t.last_tag_filter=e)}),this.socket.addListener("clearSearch",function(e){(t.autocomplete&&t.autocomplete.elements.input.placeholder===t.autocomplete._getPlaceHolderTextDependingOnActiveTenant("searchNew")||t.autocomplete.elements.input.placeholder===y.search_current_tab)&&t._onClearSearch(e)})},destroy:function(){this.stopListening(this.model),this._parent(),this.container=null},_onSearch:function(e){var t=this;i.is(e)&&"click"==e.type&&f.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"InstantSearch",action:"ClickOnLens",persDim:{pd1:this.autocomplete?this.autocomplete.getInputValue():""}}}),"3DSwym"===a.identifyClientInfo().identifier&&a.isMobile()&&t.container.parentElement.parentElement.toggleClassName("search-active");var n=this.autocomplete.getInputValue();n=n.trim();var s=l.getOption("minTopBarInput");if(this.autocomplete.elements.input.placeholder===y.get("search_current_tab")&&(s=l.getOption("minTopBarInputSiCT")),i.is(n,"string")&&n.length<=s&&n.length>0&&i.is(this.autocomplete)&&!this.autocomplete.getInContextMode()){var o={level:"info",title:y.get("search-query-too-short:title"),message:y.replace(y.get("search-query-too-short:message"),{count:l.getOption("minTopBarInput")}),sticky:!0,poNotifId:"search-query-short"};_.addNotif(o)}else{i.is(this.autocomplete.showLastSearch,"function")&&u.getItem("searchMode")!==y.search_current_tab&&this.autocomplete.showLastSearch(),i.is(this.topBarMenu)&&!this.topBarMenu._inAppContext&&this.topBarMenu.currentMode!==y.search_current_tab&&this.topBarMenu.showLastSearch(),a.setsearchType(a.SearchTypeEnum.SEARCH);var c=this.autocomplete._adv_Search_activated,d=this.autocomplete._inContextOptions;!i.is(d)&&i.is(this.topBarMenu)&&(d=this.topBarMenu._inContextOptions),i.is(n,"string")&&n.length>l.getOption("minTopBarInput")&&u.getItem("searchMode")!==y.search_current_tab&&(d&&"socket_id_#saved_search_edit#"===d.app_socket_id||(this.reSearch=!0,this.reSearchQuery={value:n,searchStringToDisplayInSearchField:this.autocomplete.getInputValue()}));if(i.is(this.topBarMenu)&&u.getItem("searchMode")===y.search_current_tab)"3DSwym"===a.identifyClientInfo().identifier?this.model.dispatchEvent("search",{value:n,searchMode:a.SearchTypeEnum.SEARCH_IN}):this.topBarMenu._searchInCurrentTab(n,this.topBarMenu.searchTabId),i.is(n)&&""!==n&&r.storeValueInDataBase(n);else if(!0===this.autocomplete._myRecentContentIsActive&&""===n&&!0!==this.reSearch)a.setsearchType(a.SearchTypeEnum.MY_RECENT_CONTENT),this.socket.dispatchEvent("myRecentContent",{value:a.SearchTypeEnum.MY_RECENT_CONTENT,adv_search:!1,sFilter:"*"});else if(""===n)this.autocomplete._inAppContext&&!1===this.autocomplete._temporarilyOutOfContext&&null!==d?p():this.autocomplete.elements.input.placeholder===this.autocomplete._getPlaceHolderTextDependingOnActiveTenant("mycontent")?(a.setsearchType(a.SearchTypeEnum.MY_CONTENT),this.socket.dispatchEvent("myContent",{value:a.SearchTypeEnum.MY_CONTENT,adv_search:!1})):this.autocomplete.elements.input.placeholder===this.autocomplete._getPlaceHolderTextDependingOnActiveTenant("MySavedSearches")?(a.setsearchType(a.SearchTypeEnum.FAVORITE_SEARCH),this.socket.dispatchEvent("myContent",{value:a.SearchTypeEnum.FAVORITE_SEARCH,adv_search:!1})):this.autocomplete.elements.input.placeholder===this.autocomplete._getPlaceHolderTextDependingOnActiveTenant("searchNew")&&this.reSearch?(this.socket.dispatchEvent("search",{value:this.reSearchQuery.value,adv_search:c,refine:this.last_tag_filter,source:[],reSearch:!0,internalSearchCriteria:this.autocomplete._internalSearchCriteria,searchStringToDisplayInSearchField:this.reSearchQuery.searchStringToDisplayInSearchField,fromEmptyString:!0}),t.autocomplete.setFieldValue(this.reSearchQuery.searchStringToDisplayInSearchField)):this.autocomplete.elements.input.placeholder===this.autocomplete._getPlaceHolderTextDependingOnActiveTenant("adv_search")?(a.setsearchType(a.SearchTypeEnum.ADVANCED_SEARCH),this.socket.dispatchEvent("advancedSearch",{value:a.SearchTypeEnum.ADVANCED_SEARCH,adv_search:!0,source:[],adv_search_field:e}),t.autocomplete._AdvancedSearchField=null):(this._filterInProgress=!1,this.autocomplete.hideClearSearchButton(),this.socket.dispatchEvent("clearSearch"),i.is(this.autocomplete.hideLastSearch,"function")&&this.autocomplete.hideLastSearch(),i.is(this.autocomplete)&&i.is(this.autocomplete.elements)&&i.is(this.autocomplete.elements.input)&&this.autocomplete.elements.input.placeholder===this.autocomplete._findInTabNLS&&this.model.hasEvent("search")&&(a.setsearchType(a.SearchTypeEnum.SEARCH_IN),this.model.dispatchEvent("search",{value:n,searchMode:a.SearchTypeEnum.SEARCH_IN})));else if(this._filterInProgress=!0,this.topBarMenu&&this.topBarMenu._inAppContext&&!1===this.topBarMenu._temporarilyOutOfContext&&null!==d)i.is(t.autocomplete.getInputValue())&&r.storeValueInDataBase(t.autocomplete.getInputValue()),p();else if(i.is(this.autocomplete)&&i.is(this.autocomplete.elements)&&i.is(this.autocomplete.elements.input)&&this.autocomplete.elements.input.placeholder===this.autocomplete._findInTabNLS)this.model.hasEvent("search")&&(a.setsearchType(a.SearchTypeEnum.SEARCH_IN),this.model.dispatchEvent("search",{value:this.autocomplete.getInputValue(),searchMode:a.SearchTypeEnum.SEARCH_IN}));else{function h(){a.executeWithPQ({wait:function(){if(n.indexOf(":")>0)return t.socket.dispatchEvent("fetchPQsFromServer"),!0},run:function(){require(["DS/SNResultUX/utils/WildcardMgr"],function(e){a.setsearchType(a.SearchTypeEnum.SEARCH),i.is(t.topBarMenu)&&!t.topBarMenu._inAppContext&&t.topBarMenu._setSecondaryHiddenOptions(y.searchNew),n=e.manageWildcardAddtion(n),n=a.replacePQsWithCVPrefixes(n),i.is(t.reSearchQuery)&&(t.reSearchQuery.value=n),i.is(t.autocomplete.resetSearchField,"function")&&t.autocomplete.resetSearchField(t.autocomplete.getInputValue(),!0),t.socket.dispatchEvent("search",{value:n,adv_search:c,internalSearchCriteria:i.is(t.autocomplete)?t.autocomplete._internalSearchCriteria:null,searchStringToDisplayInSearchField:i.is(t.autocomplete)?t.autocomplete.getInputValue():null})})}})}!0===this.autocomplete._myRecentContentIsActive&&i.is(this.topBarMenu)&&this.topBarMenu._clickOnSearch(),n===t.autocomplete.getInputValue()&&r.storeValueInDataBase(n),a.getActiveTenant()===t.selectedTenant?h():(t.selectedTenant=a.getActiveTenant(),v.getSecurityContext3DSpace(t.selectedTenant).then(function(e){h()},function(){h()}))}}function p(){a.executeWithPQ({wait:function(){if(t.autocomplete.getInputValue().indexOf(":")>0)return t.socket.dispatchEvent("fetchPQsFromServer"),!0},run:function(){require(["DS/SNResultUX/utils/WildcardMgr"],function(e){var n={inCtx_widget_id:d.widget_id},s=t.autocomplete.getInputValue();s=e.manageWildcardAddtion(s,{addWildCard_inCtx:d.addWildCard}),n.value=a.replacePQsWithCVPrefixes(s),n.searchStringToDisplayInSearchField=t.autocomplete.getInputValue(),i.is(d.precond)&&d.precond.trim().length>0&&(i.is(n.value)&&n.value.trim().length>0&&"*"!==n.value?(n.internalSearchCriteria="("+n.value+") AND ("+d.precond+")",n.value="("+n.value+") AND ("+d.precond+")"):(n.internalSearchCriteria=d.precond,n.value=d.precond),n.displayValue=t.autocomplete.getInputValue()),n.adv_search=c,n.source=d.source,i.is(n.source)||(n.source=[]),t.socket.dispatchEvent("search",n)})}})}},_onClearSearch:function(e){this.autocomplete._setInternalCriteria(null);var t=!(!i.is(e)||!i.is(e.noFocus))||null;i.is(this.autocomplete.resetSearchField)?this.autocomplete.resetSearchField("",t):this.autocomplete.setFieldValue(""),this.reSearch=!1,!0===this.betaProgramState&&i.is(this.autocomplete._clearDropDown,"function")&&this.autocomplete._clearDropDown(),i.is(this.autocomplete)&&i.is(this.autocomplete.elements)&&i.is(this.autocomplete.elements.input)&&this.autocomplete.elements.input.placeholder===this.autocomplete._findInTabNLS?this.model.hasEvent("clearSearch")&&this.model.dispatchEvent("clearSearch"):i.is(this.topBarMenu)&&u.getItem("searchMode")===y.search_current_tab&&("3DSwym"===a.identifyClientInfo().identifier?this.model.dispatchEvent("clearSearch"):(S.dispatch("SearchQuery",[""]),S.dispatch("Search:updateSearchCriteria",[""]))),this.reSearch=!0},_onCloseTransient:function(e){i.is(this.topBarMenu)&&(this._prevTenant&&this._prevTenant.tenantId&&this.topBarMenu.setCurrentTenant(this._prevTenant.tenantId),this.topBarMenu._switchSearchMode(),this.topBarMenu._clickOnSearch(),this.topBarMenu._inAppContext?this.topBarMenu.restoreAppContext(e):this.topBarMenu.setSearchMode({noFocus:!0}),this.topBarMenu._setSecondaryHiddenOptions()),i.is(this.autocomplete.resetSearchField,"function")?this.autocomplete.resetSearchField("",!0):(this.autocomplete.setFieldValue(""),this.autocomplete.elements.input.readOnly=!1)},_onSwitchMode:function(e){if(e&&a.SearchTypeEnum.MY_RECENT_CONTENT===e.new_mode)if(i.is(this.topBarMenu))this.topBarMenu._clickOnMyRecentContent(e);else{var t="*";if(!e||"*"===e.paramsFilter||this.autocomplete.getPlaceHolderValue()!==y.searchNew&&this.autocomplete.getPlaceHolderValue()!==y.get("myrecentcontent")||(t=this.autocomplete.getInputValue()?this.autocomplete.getInputValue():e.paramsFilter,this.autocomplete.setFieldValue(t)),this.autocomplete._setInternalCriteria(null),!i.is(e,"object")||!i.is(e.focus)||!1!==e.focus){var n={value:a.SearchTypeEnum.MY_RECENT_CONTENT,adv_search:!1,sFilter:i.is(t,"string")?t:"*"};i.is(e)&&i.is(e.widgetId)&&i.is(e.widgetId,"string")&&0<e.widgetId.length&&(n.widgetId=e.widgetId),this.socket.dispatchEvent("myRecentContent",n)}}},_onSearchInputKeyUp:function(e){this.autocomplete.getInputValue()?this.autocomplete.showClearSearchButton():this._filterInProgress||this.autocomplete.hideClearSearchButton(),n.stopPropagation(e)},_onSearchInputKeyDown:function(e){"return"===n.whichKey(e)&&this._onSearch(),n.stopPropagation(e)},_storeValueInLocalStorage:function(e){if(!i.is(e,"string"))throw new Error("null value given to SearchView._storeValueInLocalStorage!");if(!(e.trim().length<=0)){var t=[];if(i.is(localStorage.SNSearchBoxStore))if(-1===(t=JSON.parse(localStorage.SNSearchBoxStore)).indexOf(e))t.length>=100&&t.shift(),t.push(e),localStorage.SNSearchBoxStore=JSON.stringify(t);else{var n=t.indexOf(e),s=t[n];t.splice(n,1),t.push(s),localStorage.SNSearchBoxStore=JSON.stringify(t)}else t.push(e),localStorage.SNSearchBoxStore=JSON.stringify(t)}},_setTopbarTooltips:function(){this.container.getElement(".clear_ctn_search").title=y.get("clear.tooltip"),this.container.getElement(".run_ctn_search").title=y.get("search.tooltip");var e=this.container.getElement(".option_ctn_search");i.is(e)&&(e.title=y.get("secondaryMenu.tooltip"))},render:function(){var e,t=this;e=this.template(this.model.toJSON()),this.container.setContent(e);var n=this.container.getElement("#input_search_div");n.addClassName("searchProto");var s=this.container.getElement(".right_search"),o=i.createElement("div",{class:"option_ctn_search ctn_search"}).inject(s),c=u.getItem("BETA-FUN136528");a.isInternalProduction();if(!1!==l.getOption("FUN124298")&&!1!==c)i.is(this.autocomplete)&&this.autocomplete.clean(),this.autocomplete=new p({eventManager:t.socket}).inject(n);else{this.autocomplete=new h({suggestUrl:"tempo_deactivated?query={text}",placeholder:y.searchNew,typeDelay:500,minLength:1,suggestFormat:"{label}",dataParser:function(e){return e.suggest},className:"sn-search-field uwa-autocomplete nv-autocomplete",isBetaOn:t.betaProgramState,events:{openTagger:function(){t.socket.dispatchEvent("openTagger")},setSourceDashboard:function(){t.socket.dispatchEvent("setSelectedSource",{value:"3DDashboard"}),t.selectedSource="3DDashboard"},setSourceCStorage:function(e){t.socket.dispatchEvent("setSelectedSource",{value:e}),t.selectedSource=e,t.betaProgramState,u.setItem("defaultTenantId",e),u.commit()},onSelect:function(e,n){"LastSearch"!==n&&t.socket.dispatchEvent("topBar-LastSearch-clearLocalFilter"),i.is(t.autocomplete._isTypeListMode)&&!0===t.autocomplete._isTypeListMode&&(t.autocomplete._isTypeValue=e);var s=!1;if(i.is(arguments[2])&&"AdvSearch"===arguments[2]&&(s=!0),t.autocomplete._searchStringToDisplayInSearchField=e,i.is(t.autocomplete.elements)&&i.is(t.autocomplete.elements.input)&&i.is(t.autocomplete.getInputValue())&&t.autocomplete.getInputValue()!==e&&(t.autocomplete._searchStringToDisplayInSearchField=null,t.autocomplete._setInternalCriteria(null)),null!==t.autocomplete.getInputValue()&&!0!==s||(t.autocomplete._AdvancedSearchField=e),!1===s){if(i.is(t.topBarMenu)&&t.topBarMenu.currentMode!==y.search_current_tab){var o={hiddenOptions:[y.search_current_tab]};t.topBarMenu._clickOnSearch(o),t.topBarMenu._clickOnSearch()}t._onSearch(t.autocomplete._AdvancedSearchField)}i.is(this._value)&&this._value.length>l.getOption("minTopBarInput")&&(t.autocomplete.elements.input.value=e),t.socket.dispatchEvent("onHideSuggests"),i.is(this._value)&&this._value.length>l.getOption("minTopBarInput")&&(!i.is(n,"object")||!0===n.storeSearch)&&r.storeValueInDataBase(e)},onSearch:function(e){t._onSearch(),i.is(t.autocomplete._isTypeListMode)&&!0===t.autocomplete._isTypeListMode&&r.storeValueInDataBase(e)},myContent:function(){t.socket.dispatchEvent("myContent",{value:a.SearchTypeEnum.MY_CONTENT,adv_search:!1})},favoriteSearches:function(){t.socket.dispatchEvent("favoriteSearches",{value:a.SearchTypeEnum.FAVORITE_SEARCH,adv_search:!1})},myRecentContent:function(e){var n={value:a.SearchTypeEnum.MY_RECENT_CONTENT,adv_search:!1};i.is(e)&&i.is(e.sFilter,"string")&&0<e.sFilter.length?n.sFilter=e.sFilter:n.sFilter="*",i.is(e)&&i.is(e.widgetId,"string")&&0<e.widgetId.length&&(n.widgetId=e.widgetId),t.socket.dispatchEvent("myRecentContent",n)},hideAdvancedSearch:function(){t.socket.dispatchEvent("hideAdvancedSearch",{})},showAdvancedSearch:function(){t.socket.dispatchEvent("showAdvancedSearch",{})},advancedSearch:function(e){t.socket.dispatchEvent("advancedSearch",{value:a.SearchTypeEnum.ADVANCED_SEARCH,adv_search:!0,adv_search_field:e}),t.socket.dispatchEvent("showAdvancedSearch",{adv_search_field:e},["searchtopbar_socket_id"])},storeSuggestion:function(e){r.storeValueInDataBase(e)},showPQListUX:function(){t.socket.dispatchEvent("onShowPQListUX")}}}).inject(n);var d=i.createElement("div",{class:"option_btn_search fonticon fonticon-down-open",id:"searchFieldDropdown","data-rec-id":"option_ctn_search"}).inject(o);this.topBarMenu=new g({target:d,autocomplete:this.autocomplete,socket:this.socket,secondaryMenuOptions:_})}var _={hideTenantMenu:this.hideTenantMenu};return this._setTopbarTooltips(),a.setSearchViewRendered(),this}})});