define("DS/DELWebOEROpenControlComp/form/FormDocument",["DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel"],function(e,t){"use strict";var o=function(...t){e.apply(this,t)};return(o.prototype=Object.create(e.prototype)).constructor=o,o.prototype.removeRootNode=function(e){let t,o=this.getRoots();o&&o.length>0&&(t=o.find(function(t){return t.options.fieldId===e}))&&this.removeRoot(t)},o.prototype.createRootNode=function(e,o){var n=new t({label:o?o.label:null,fieldId:e,grid:{className:"oer-form-expander"}});return this.removeRootNode(e),this.addRoot(n),n},o.prototype.getFieldNode=function(e){let t,o=this.search({match:function(t){if(e&&t.nodeModel.options.fieldId===e)return!0}});return o&&o.length>0&&(t=o.find(t=>t.options.fieldId===e)),t},o.prototype.createFieldNode=function(e,o,n){var r,i,l={label:o?o.label:null,fieldId:e,grid:{value:void 0,fieldValue:"",typeRepresentation:"string",semantics:{}}},s=o?o.possibleValues:[];return s&&(1===s.length&&UWA.merge(l.grid,s[0]),l.grid.semantics=function(e){return e&&e.length>1?{possibleValues:e,displayStyle:"combo",allowResetToUndefinedByUIFlag:!0}:{possibleValues:e,displayStyle:"combo",disabled:!0}}(s)),this.removeFieldNode(e),i=new t(l),n&&((r=this.getRoots().find(e=>e&&e.options&&e.options.fieldId===n)).addChild(i),r.expandAll()),i},o.prototype.removeFieldNode=function(e){var t,o=this.getFieldNode(e);o&&(t=o.getParent())&&t.removeChild(o)},o.prototype.updateAttribute=function(e,t,o){let n=this.getFieldNode(e);n&&n.setAttribute(t,o)},o.prototype.disableField=function(e){let t=this.getFieldNode(e);if(t){let e=t.getAttributeValue("semantics");e&&(e.disabled=!0,t.setAttribute("semantics",e))}},o}),define("DS/DELWebOEROpenControlComp/helper/ContextHelper",[],function(){"use strict";const e={getMfgContext:function(t,o,n){var r={context:[],ids:[]},i={},l=e.getProcessContext(t,o);if(l&&l.context)for(let e of l.context)if(e.scope===n&&e.implementedScope){r.context=e.implementedScope,e.implementedScope.forEach(e=>{i[e.id]||(i[e.id]=!0,r.ids.push(e.id))});break}return r},getMfgInstallContext:function(t,o,n,r){var i={context:[],ids:[]},l=e.getMfgContext(t,o,n);if(l&&l.context)for(let e of l.context)r===e.id&&UWA.is(e.context,"array")&&(i.context=e.context,e.context.forEach(e=>{-1===i.ids.indexOf(e.parent)&&i.ids.push(e.parent)}));return i},getMfgInstallOccurrences:function(t,o,n,r){var i={context:[],ids:[]},l=e.getMfgContext(t,o,n);if(l)for(let e of l.context)r===e.id&&e.context&&(i.context=e.context,i.ids=i.ids.concat(e.context.map(e=>`${e.parent}_${e.instance}_${r}`)));return i},getMfgInstallOccurrencesForContext:function(t,o,n,r,i){var l=e.getMfgInstallOccurrences(t,o,n,r);return l.context=l.context.filter(e=>e.parent===i),l.ids=l.ids.filter(e=>e.includes(i)),l},getProcessContext:function(t,o){var n={context:[],ids:[]},r=e.getContextScope(t,o);return r&&(n.context=r,n.ids=r.map(e=>e.scope)),n},getProcessContextOccurrences:function(t,o,n){var r={context:[],ids:[]},i=e.getProcessContext(t,o);if(i&&i.context)for(let e of i.context)if(e.scope===n){r.context=i.context,r.ids=e.contextOccurrence.slice();break}return r},getContextScope:function(e,t){var o,n;return e&&UWA.is(e.member,"array")&&t&&e.member.forEach(e=>{(n=e.find(function(e){return e.refid===t}))&&(o=n.contextScope)}),o},getAllPhysicalIds:function(t,o){var n=o?[o]:[],r=e.getContextScope(t,o);return r&&r.forEach(e=>{n.push(e.scope),e.contextOccurrence&&e.contextOccurrence.forEach(e=>{n=n.concat(e.split("_"))}),e.implementedScope&&e.implementedScope.forEach(e=>{n.push(e.id),e.context&&e.context.forEach(e=>{n.push(e.parent),n.push(e.instance)})})}),n},getInstallInstanceIds:function(t,o){var n=[],r=e.getContextScope(t,o);return r&&r.forEach(e=>{e.implementedScope&&e.implementedScope.forEach(e=>{e.context&&e.context.forEach(e=>{n.push(e.instance)})})}),n}};return e}),define("DS/DELWebOEROpenControlComp/mixins/OpenControlCompWebServicesMixin",["DS/DELWebOERCommonUtils/mixins/IndexServicesMixin","DS/DELWebOERCommonUtils/utils/CommonUtils","text!DS/DELWebOEROpenControlComp/assets/json/ServicePayloads.json","text!DS/DELWebOEROpenControlComp/assets/json/Constants.json","i18n!DS/DELWebOEROpenControlComp/assets/nls/OpenControlComp"],function(e,t,o,n,r){"use strict";const i=JSON.parse(n).EffectivityAttribute;let l={computeVolumeFilter:async function(e,n,i={}){let l,s,a,c,d=this,p=JSON.parse(o);return e&&n&&(l=await async function(e){let t,o,n=p.expandV2;return n.batch.expands[0].root.physical_id=e,(t=await d.getProgressiveExpand(n))&&t.results&&t.results.length>0&&(o=t.results[0]),o}(n))&&l.boundingbox&&(s=p.publicVolumeFilterSpec,a=t.getValue(s,"specification"),c=t.getValue(a,"allVolumes"),s.rootID=e,s.rootAlias=l["ds6w:label"],!0===i.withFilter?(s.applyFilter=0,s.displayFilter=1):(s.applyFilter=1,s.displayFilter=0),a.title=r.get(a.title),a.referencedObject.identifier=e,c[0].allVolumes=[this.getVolumeFilter(e,l.boundingbox,i.installVolumeOffSet)]),s},getVolumeFilter:function(e,t,n=0){let i,l=JSON.parse(o).volumeFilter,s=function(e,t){return e.map(e=>`${e+t}`)},a=Number.isNaN(Number(n))?0:10*Number(n);var c,d;return t&&t.max&&t.min&&(i=s(t.max,a),l.displayName=r.get(l.displayName),l.parameters.root_path_physicalid=[[e]],l.parameters.corner_max=(c=i,d=t.min,c.map((e,t)=>`${e-d[t]}`)),l.parameters.transformation_matrix=[1,0,0,0,1,0,0,0,1,...function(e,t){return s(e,-t/2)}(t.min,a)]),l},getInstallOccurrencesForFilter:async function(e){let t,n=JSON.parse(o).expandV2,r=[];return n.batch.expands[0].root.physical_id=e.filterRootIds[0],n.batch.expands[0].filter=function(e){let t=[],o=[];return(e=e||{}).filter&&t.push(e.filter),e.paths.length>0&&e.paths.forEach(e=>(function(e){let t;e&&e.length>0&&(t=UWA.is(e[0],"string")?[e]:e,o=o.concat(t.map(e=>({physical_id_path:e}))))})(e)),o.length>0&&t.push({prefix_filter:{prefix_path:o}}),{and:{filters:t}}}(e),n.batch.expands[0].graph={descending_condition_relation:{uql:"((taxonomies:*DELFmiFunctionIdentifiedInstance*))"}},n.batch.expands[0].aggregation_processors=[{truncate:{max_distance_from_prefix:1,match_only_refs:1,prefix_filter:{prefix_path:[{physical_id_path:[e.filterRootIds[0]]}]}}}],(t=await this.getProgressiveExpand(n))&&t.results&&t.results.length>0&&t.results.forEach(e=>{e.Path&&r.push(e.Path)}),r},getEffectivityContent:async function(e){let t,o={ids:e,domain:"ALL",view:"ALL",format:"TXT"},n={};return(t=await this.executeRequestPromise(this.get3DSpaceUrl()+"/resources/v1/modeler/dscfg/invoke/dscfg:getEffectivityContent",{method:"POST",payload:o}))&&UWA.is(t.effectivitiesContent,"array")&&t.effectivitiesContent.forEach(e=>{n[e.id]={},Object.keys(i).forEach(t=>{n[e.id][t]=e[i[t]]?e[i[t]]:""})}),n},getUnitId:async function(e){let o,n,r,i=t.getValue(e,"model"),l=t.getValue(t.getValue(e,"unit"),"single");return l&&i&&(o=`[plc_build_unit_number]:${l} AND [plc_model_pid]:${i.identifier}`,(n=await this.searchUnits(o))&&UWA.is(n.member,"array")&&n.member.length>0&&(r=n.member[0].identifier)),r},getFilteredRep:async function(e){let t=this.getNavigateUrlOptions(),o={input_physical_ids:[],primitives:[{navigate_from_sr:{id:1,filter:{role:["591"]}}}],patterns:{Connection:[{id:1}]},attributes:["pathsr"],label:"Navigate_Rep_Connections_From_Process",version:3};if(!e)throw new Error("Invalid input, processId is mandatory to get published filtered representations");return o.input_physical_ids.push(e),t.payload=o,this.executeRequestPromise(t.url,t)},getPublishedRep:async function(e={}){let t,o,n=e.processId,r=e.unitId;if(n&&r&&(o=await this.getFilteredRep(n))&&UWA.is(o.result)){let e=o.result.find(e=>!(!e||!e.input_object)&&e.input_object.physicalid===n);if(e&&e.outputs&&UWA.is(e.outputs.Connection,"array")){let o;(o=e.outputs.Connection.find(e=>e.pathsr.contains(r)))&&(t=o.physicalid)}}return t},getPublicFilterSpecification:async function(e={}){let t=this;if(!(e&&e.proxy&&e.NGFUXId&&e.rootId))throw new Error("Invalid Input, please check input params");const o=`onGetPublicFilter_OpenControl_${(e=e||{}).NGFUXId}_${e.rootId}`;return await new Promise(n=>{e.proxy.addEvent(o,function(t={}){e.proxy.removeEvent(o),n(t)}.bind(this)),e.proxy.getPublicFilterSpecification({rootId:e.rootId,widgetId:t.getWidgetComponent().getId(),NGFUXId:e.NGFUXId,eventName:o})})},searchUnits:async function(e){let t=new URL(`${this.get3DSpaceUrl()}/resources/v1/modeler/dspfl/dspfl:Unit/search?$mask=dsmvpfl:UnitBaseMask`);return t.searchParams.set("$searchStr",e),await this.executeRequestPromise(t.toString(),{dataType:"json",method:"GET"})},getCapableResource:function(e){var t,o,n=this;return(t=n.getNavigateUrlOptions(),o={label:"Navigate",input_physical_ids:[],version:3,primitives:[{navigate_to_sr:{id:1,filter:{role:["490"]},mode:"path"}}],patterns:{resourceArea_pathSR:[{id:1}]},attributes:["ds6w:label","physicalid","ds6w:type","pathsr"]},o.input_physical_ids.push(e),t.payload=o,n.executeRequestPromise(t.url,t)).then(function(t){let o,n,r=[];return t&&t.result&&(o=t.result.find(t=>t.input_object&&t.input_object.physicalid===e))&&o.outputs&&o.outputs.resourceArea_pathSR&&(r=(n=o.outputs.resourceArea_pathSR.find(t=>t.owner&&t.owner.physicalid===e)).elements),r})},getFilterSpecXml:async function(e){let t,o={buildId:e};return o.buildId=e,t=await this.executeRequestPromise(`${this.get3DSpaceUrl()}/resources/v1/delviewerservices/private/invoke/getFilterSpec`,{method:"POST",payload:o})},getInstallPredecessors:function(e,t){var o=this,n={assemblyid:e,installinstids:[t],predecessor:!0,successor:!1,nodependency:!1,graphconstraint:!1};return o.executeRequestPromise(`${o.get3DSpaceUrl()}/resources/v1/modeler/dsmfg/invoke/dsmfg:getMfgItemInstallDependencies`,{method:"POST",payload:n}).then(function(e){return e&&e[t]&&e[t].predecessors?e[t].predecessors:[]}).fail(function(n){o.logger.debug(n),o.logger.error("Error occurred while fetching predecessors for mfg ",e," install -",t)})},getContextScope:function(e){var t=this,o={refid:e,stopDAG:"MBOM",firstParentScope:!1};return t.executeRequestPromise(`${t.get3DSpaceUrl()}/resources/v1/modeler/dsprcs/invoke/dsprcs:getScopeContext`,{method:"POST",payload:o}).fail(function(o){t.logger.debug(o),t.logger.error("Error occurred while fetching context scope for process id ",e)})}};return l=Object.assign(l,e)}),define("DS/DELWebOEROpenControlComp/form/FormColumns",[],function(){"use strict";return[{dataIndex:"tree",typeRepresentation:"string",alignment:"near",width:"175",minWidth:"15",alwaysVisibleFlag:!0,editableFlag:!1,getCellClassName:function(e){return e.nodeModel?e.nodeModel.getAttributeValue("className"):""}},{dataIndex:"value",getCellTypeRepresentation:function(e){return e.nodeModel?e.nodeModel.getAttributeValue("typeRepresentation"):"string"},getCellSemantics:function(e){return e.nodeModel?e.nodeModel.getAttributeValue("semantics"):void 0},getCellEditableState:function(e){return!e.nodeModel||!e.nodeModel.getAttributeValue("readOnly")},allowUnsafeHTMLContent:!1,width:"250",minWidth:"10",alwaysVisibleFlag:!0,editableFlag:!0,editionPolicy:"EditionInPlace"},{dataIndex:"withFilter",width:"5",typeRepresentation:"functionIcon",hasCellValue:function(e){return e.nodeModel&&!0===e.nodeModel.getAttributeValue("withFilter")},getCellSemantics:function(e){if(e.nodeModel&&!0===e.nodeModel.getAttributeValue("withFilter"))return{icon:{iconName:"filter",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"},disabled:!0}}}]}),define("DS/DELWebOEROpenControlComp/commands/DELWebOERFilterCommand",["UWA/Core","DS/ENONextGenFilterCmd/commands/ENONextGenFilterCmd","DS/Logger/Logger","DS/DELWebOERCommonUtils/utils/XSOManager","DS/DELWebOERCommonUtils/utils/NodeUtils"],function(e,t,o,n,r){"use strict";return t.extend({name:"DELWebOERFilterCommand",logger:o.getLogger("DS/DELWebOEROpenControlComp/commands/DELWebOERFilterCommand"),init:function(e={}){this.ec=e.executionContext,e.args&&(this.roots=e.args.items,this.NGFUXId=e.args.NGFUXId)},getAppParams:function(){let e=this.ec.getComponent("Viewer");var t=this.ec.getComponent("DELCommonUtilsServices");return{widgetId:t.getWidgetId(),appId:t.getAppId(),NGFUXId:this.NGFUXId?this.NGFUXId:e.getNGFUXID(),shareFilterSpec:!0}},getRoots:function(){let e=this.roots;if(!this.roots){(e=this.ec.getComponent("Viewer").getRoots())&&e.length>0&&(e=e.map(e=>({id:e.getModelIdentification(),filtered:!1})))}return e},getSelectorManager:function(){return n.getCSO()},getSelection:function(){var e=n.getCSO().get()||[],t=[];return e.forEach(e=>{t.push(r.getRirPath(e))}),{path:t}},beginExecute:function(){this.execute(),this.done()},endExecute:function(){this._parent()}})}),define("DS/DELWebOEROpenControlComp/model/Model",[],function(){"use strict";return function(){var e={};return{set:function(t,o){e[t]=o},get:function(t){return e[t]?e[t]:null},remove:function(t){delete e[t]},clear:function(){e={}}}}}),define("DS/DELWebOEROpenControlComp/form/ProcessForm",["DS/Controls/Button","DS/DELWebCommonControls/Form","DS/DELWebOEROpenControlComp/form/FormDocument","DS/DELWebOEROpenControlComp/form/FormColumns","text!DS/DELWebOEROpenControlComp/assets/json/Constants.json","text!DS/DELWebOEROpenControlComp/assets/json/FormFieldsConfig.json","i18n!DS/DELWebOEROpenControlComp/assets/nls/OpenControlComp"],(e,t,o,n,r,i,l)=>{"use strict";const s=JSON.parse(r),a=JSON.parse(i);function c(t,r){this._options=r||{},this._tokens=[],this._model=t,this._modelEvents=r.modelEvents,this._openButton=new e({onClick:(...e)=>{r.onOpen&&r.onOpen.apply(r,e)}}),this._cancelButton=new e({onClick:(...e)=>{r.onCancel&&r.onCancel.apply(r,e)}}),this._formOptions={identifier:"oer-process-form",formOptions:{maxVisibleRowCount:Object.keys(a).length,treeDocument:new o,columns:n},dialogOptions:{title:l.get("Dialog.Process.Title"),position:{my:"bottom",at:"center",offsetY:-100},buttons:{Open:this._openButton,Cancel:this._cancelButton}},frameContainer:r.container},this._subscribeEvents()}return c.prototype._subscribeEvents=function(){let e=this;[{event:"onGetFieldValue",handler:e._onGetFieldValue},{event:"onFilterApplied",handler:e._onFilterApplied},{event:"onFilterCancelled",handler:e._onFilterCancelled},{event:"onFormComplete",handler:()=>{e._openButton.disabled=!1}},{event:"onFormClean",handler:e.destroy}].forEach(t=>{e._tokens.push(e._modelEvents.subscribe({event:t.event},t.handler.bind(e)))})},c.prototype._addFormListener=function(){let e=this;e.getTreeDocument().onNodeModelUpdate(function(t){var o=t.data?t.data.nodeModel:{};if(e.getTreeDocument().prepareUpdate(),o&&o.options&&o.options.fieldId){let n=o.options.grid.semantics;if(n&&n.possibleValues){let e=n.possibleValues.find(function(e){return o.getAttributeValue("value")===e.value});o.setAttribute(s.Context.fieldValue,e[s.Context.fieldValue])}t.data.attributes.value&&e._modelEvents.publish({event:`on${o.options.fieldId}Select`,data:{data:o.getAttributeValue(s.Context.fieldValue),origin:"FormHelper"}})}e.getTreeDocument().pushUpdate()}),e._processForm.addEventListener("onClose",e._options.onCancel)},c.prototype._removeFormListener=function(){this._processForm&&this._processForm.removeEventListener("onClose",this._options.onCancel)},c.prototype._getPossibleValues=function(e,t){var o=[],n=(e,t)=>{let o="",n="",r=t?t.split(s.Context.delimeter):[];switch(e){case s.Fields.MfgInstallOccurrence:r.length>2&&(o=`${this._getAttributeValue(r[2],s.Attributes.label)} (${this._getAttributeValue(r[1],s.Attributes.label)})`,Object.keys(s.EffectivityAttribute).forEach(e=>{n+=`${l.get("Form."+e+".Title")}: ${this._getAttributeValue(r[1],e)?this._getAttributeValue(r[1],e):""}\n`}));break;case s.Fields.ProcessContextOccurrence:r.forEach(e=>{""!==o?o+=`, ${this._getAttributeValue(e,s.Attributes.label)}`:o=`${this._getAttributeValue(e,s.Attributes.label)}`}),n=o;break;default:o=`${this._getAttributeValue(r[0],s.Attributes.label)}`,n=o}return{label:o,description:n}},r=e=>{let t=e?e.split(s.Context.delimeter):[""];return this._getAttributeValue(t[t.length-1],s.Attributes.iconUrl)};return t&&t.length>0&&(o=t.map(t=>{let o=n(e,t);return{[s.Context.fieldValue]:t,value:o.label,label:o.label,withFilter:void 0,icon:{iconPath:r(t)},description:o.description}})),o},c.prototype._getParentFieldId=function(e){return e&&a[e]?a[e].parent:null},c.prototype.getPopulatedFields=function(e){var t=[],o=0;return a[e]&&(o=a[e].position,t=Object.keys(a).filter(e=>a[e].position<=o)),t.sort((e,t)=>a[e].position-a[t].position)},c.prototype._disablePopulatedFields=function(e){let t=this.getPopulatedFields(e),o=this;UWA.is(t,"array")&&t.forEach(function(e){o.disableField(e)})},c.prototype._onFilterApplied=function(e){let{fieldId:t}=e&&e.data?e.data:{};this.isVisible()&&this._disablePopulatedFields(t)},c.prototype._onFilterCancelled=function(e){let{fieldId:t}=e&&e.data?e.data:{};this._updateAttribute({fieldId:t,attribute:"withFilter",value:!1})},c.prototype._updateAttribute=function(e){let t=this.getTreeDocument();t&&t.updateAttribute(e)},c.prototype._getAttributeValue=function(e,t){var o=this._model.get("attributesMap");return o&&o[e]?o[e][t]:{}},c.prototype._onGetFieldValue=function(e){let o,n,r=this,{fieldId:i,ids:s}=e&&e.data?e.data:{},c=this._model.get("fieldToValuesMap"),d=[],p=function(e){let t=r.getTreeDocument();var o,n;r._openButton.disabled=!0,t.prepareUpdate(),o=t,(n=e)&&n.forEach(e=>{var t=r._getParentFieldId(e);e&&(t?o.createFieldNode(e,{label:l.get(a[e].label),possibleValues:r._model.get("fieldToValuesMap")[e]},t):o.createRootNode(e,{label:l.get(a[e].label)}))}),t.pushUpdate()};c||(c={},r._model.set("fieldToValuesMap",c)),s&&s.length>0&&(c[i]=r._getPossibleValues(i,s),r._processForm?(n=r._getParentFieldId(i),(o=r.getTreeDocument().getFieldNode(n))||d.push(n),d.push(i),p(d)):s.length>1&&(r._processForm=new t(r._formOptions),r._addFormListener(),p(d=r.getPopulatedFields(i))))},c.prototype.isVisible=function(){return!!this._processForm},c.prototype.disableField=function(e){let t=this.getTreeDocument();t&&t.disableField(e)},c.prototype.getTreeDocument=function(){if(this._processForm)return this._processForm.getDataGridView().getTreeDocument()},c.prototype.destroy=function(){let e=this._modelEvents;this._removeFormListener(),this._tokens.forEach(e.unsubscribe),this._processForm&&this._processForm.destroy()},c}),define("DS/DELWebOEROpenControlComp/OpenControlComp",["DS/Controls/ModalContainer","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/DELWebOERCommonUtils/DELWebBaseComponent","DS/DELWebOERCommonUtils/mixins/TypesUtilsMixin","DS/DELWebOEROpenControlComp/mixins/OpenControlCompWebServicesMixin","DS/DELWebOEROpenControlComp/model/Model","DS/DELWebOEROpenControlComp/helper/ContextHelper","DS/DELWebOEROpenControlComp/form/ProcessForm","text!DS/DELWebOEROpenControlComp/assets/json/Constants.json","i18n!DS/DELWebOEROpenControlComp/assets/nls/OpenControlComp"],function(e,t,o,n,r,i,l,s,a,c,d,p){"use strict";const u=JSON.parse(d);class f extends r{constructor(e={}){super(e),this.filterCommandHandlerId=e.filterCommandHandlerId}async initialize(){await super.initialize(),this.model=new s}async clean(){this.abortAllRequests(),await super.clean()}async destroy(){await super.destroy()}_publish(e,t){this.publish({event:e,data:{data:t,origin:"OpenController"}})}_showMask(){}_removeMask(){}async _openFilter(r={}){var i,l,s,a,c=this,d=r.items||[],u=r.showConfirmationDialog,f=r.onApply,m=r.onCancel,g=r.filterProxy,h=(r.NGFUXId,!1),b=[],C=c._getContainer(),y=function(t){e.removeModal(C),c.publish({event:"onFilterCancel",data:{data:t,origin:"DELWeb3DFilterCmd"}}),m&&m(t)};s=function(){i(),g.resetNGFilterUI({appId:c.getExecutionContext().getSourceApp().getId(),widgetId:c.getWidgetComponent().getId(),rootIds:d.map(e=>e.id)}),u?a():y({result:!1,filterData:d})},l=function(t){t&&!t.empty&&(b.push(t),h&&b.length!==d.length||(i(),e.removeModal(C),f&&f(b)))},i=function(){g.removeEvent("ApplyNGFilter",l),g.removeEvent("NGFilter_Close",s)},a=function(){var e,r,i,l=document.getElementsByClassName("wux-controls-modalContainer"),s=function(e){let t={result:e,filterData:d};r.removeEventListener("close",i),r.destroy(),y(t)};i=s.bind(s,!1),UWA.is(l,"array"),l.length>0?((e=new t({})).inject(l[0]),(r=new o({immersiveFrame:e,title:p.get("Dialog.Title"),content:p.get("Dialog.FilterCancelled.Message"),buttons:{Ok:new n({onClick:s.bind(s,!0)}),Cancel:new n({onClick:s.bind(s,!1)})}})).addEventListener("close",i)):c.logger.error("App Overlay container not found, so dialog cannot be created")},UWA.is(d,"array")&&d.length>0&&(g.addEvent("NGFilter_Close",s),g.addEvent("ApplyNGFilter",l),function(){let e=!1,t=d.filter(e=>e.filterSpec||e.publicFilterSpec);return t.length>0&&(e=!0,h=!0,t.forEach(e=>{let t={rootID:e.id,rootAlias:e.label,applyFilter:1,displayFilter:0,forceUpdate:0,serviceId:"3DSpace"};e.filterSpec?g.setFilterSpecification({...t,...e.filterSpec}):e.publicFilterSpec&&g.setPublicFilterSpecification({...t,...e.publicFilterSpec})})),e}()||(c.filterCommandHandlerId?c.executeCommand({handlerId:c.filterCommandHandlerId,args:{items:d.map(e=>({id:e.id,filtered:!1})),NGFUXId:r.NGFUXId}}):c._handleError(r,"Unable to open/apply filter as filterCommandHandlerId is not available","DELOP_E00")),e.createModal(C,document.createElement("span")))}_getContainer(){return this.mainContainer||(this.mainContainer=this.getUIFrameComponent().addLayer(UWA.Element.create("div",{class:"del-oer-open-control-container"}),{top:0,bottom:0,right:0,left:0,zIndex:1e5,pointerEvents:"none",class:"del-oer-open-control-container-layer"})),this.mainContainer}_getCVQueryFilter(e,t,o={}){let n=o.CVQueryV2;return n||(n=t.getFilterSpec(e,{V2:{}})),n.filter}async _open(e={}){let t=this,o=e.items||[],n=o.filter(e=>!0===e.withFilter||e.publicFilterSpec||e.filterSpec),r=function(e=[]){return o.forEach((t,n)=>{let r=e.find(e=>e.id===t.id);r?o[n]=r:t.withFilter=!1}),o};if(!(e&&e.items&&e.onOpen&&e.onCancel&&e.onError))throw new Error("Invalid input, mandatory params are missing, please check the input params");n.length>0?e.filterProxy&&e.NGFUXId?t._openFilter({items:n,onApply:(o=[])=>{UWA.is(o,"array")?(o.forEach((o={})=>{if(UWA.is(o,"object")){let r=UWA.is(o.filterRootIds,"array")?o.filterRootIds[0]:null;r&&n.forEach(function(n){n.id===r&&(n.withFilter=!0,n.filter=t._getCVQueryFilter(r,e.filterProxy,o))})}else t.logger.error("filterParam is not valid, filterParam should be an object")}),e.onOpen({results:r(n)})):t.logger.error("Callback is not valid, results should be an array")},onCancel:t=>{t&&t.result&&t.filterData?(t.filterData.forEach(function(e){e.withFilter=!1}),e.onOpen({results:r(n)})):e.onCancel()},showConfirmationDialog:!0,filterProxy:e.filterProxy,NGFUXId:e.NGFUXId}):t._handleError(e,"Invalid input, Unable to open/apply filter as filter Proxy and NGFUXId is mandatory and is not available ","DELOP_E01"):e.onOpen({results:o})}async _openProcess(e){let t,o,n,r=this,i=[],l=()=>{let e=r.getModelEvents();r._publish("onFormClean"),i.forEach(e.unsubscribe),r.model.remove("attributes"),r.model.remove("formData"),r.model.remove("publicFilterSpec"),r.model.remove("filterSpec")},s=async function(){var t=[],o=r.model.get("formData");r._showMask();try{t.push(async function(){let e=r.model.get("formData"),t=await r.getCapableResource(e.process.context);UWA.is(t,"array")&&t.length>0&&(e.rsc={context:t[0].physicalid,pprType:r.PPRTYPES.RESOURCE})}()),t.push(async function(){let e,t=r.model.get("formData");t.mfg&&(e=t.mfg.contextOccurrence)&&e.length>1&&(t.mfg.predecessors=await r.getInstallPredecessors(t.mfg.context,e[e.length-2]))}()),!0===e.usePublication&&t.push(async function(){let t,o,n,i=r.model.get("formData"),l=i.mfg?i.mfg.context:null,s=i.process?i.process.context:null,a=e.filterProxy,c=e.NGFUXId;s&&l&&!0===e.withFilter&&(o=await r.getPublicFilterSpecification({proxy:a,NGFUXId:c,rootId:l}),(n=await r.getUnitId(o))&&(t=await r.getPublishedRep({processId:s,unitId:n}))&&(i.publishedRep={context:t}))}()),await Promise.all(t),r._removeMask(),e.onOpen({results:[function(){let e=function(e){var t,o;return e&&(o=e.contextOccurrence&&e.contextOccurrence.length>0?e.contextOccurrence[e.contextOccurrence.length-1]:e.context,Object.assign(e,{id:o,occurrence:e.contextOccurrence?1===e.contextOccurrence.length?[]:e.contextOccurrence:[]}),delete e.context,delete e.contextOccurrence,delete e.scopedMfg,t=e),t};var t=e(o.process),n=e(o.mfg),r=e(o.rsc),i=e(o.publishedRep);return t.scopedMfg=n,t.resource=r,t.publishedRep=i,t}()]})}catch(t){r._removeMask(),r.logger.log(t),r._handleError(e,`Error occurred while fetching resource/predecessors for mfg ${o.mfg.context}`,"DELOP_E00")}finally{l()}},d=()=>{let t=r.model.get("formData");l(),e.filterProxy&&t.mfg&&t.mfg.context&&e.filterProxy.resetNGFilterUI({appId:r.getExecutionContext().getSourceApp().getId(),widgetId:r.getWidgetComponent().getId(),roots:t.mfg.context}),e.onCancel()},p=async()=>{if(!0===e.showForm){let n=await this.getAttributeForIds(a.getAllPhysicalIds(t,e.id),Object.values(u.Attributes),Object.values(u.FileAttributes)),i=a.getInstallInstanceIds(t,e.id);if(i&&i.length>0){let e=await r.getEffectivityContent(i);UWA.extend(n,e,!0)}this.model.set("attributesMap",n);let l=Object.assign({},{onOpen:s,onCancel:d,modelEvents:r.getModelEvents(),container:this._getContainer()});o=new c(this.model,l)}else r.subscribe({event:"onGetFieldValue"},t=>{let{fieldId:o,ids:n}=t&&t.data||{};n&&n.length>1&&this._handleError(e,`Multiple ids found for ${o}`,"DELOP_E02",{fieldId:o})})},f=function(){o&&o.isVisible()?r._publish("onFormComplete"):s()},m=async t=>{let n=r.model.get("formData");r._openFilter({items:[{id:n.mfg.context,type:n.mfg.type,pprType:n.mfg.pprType,withFilter:!0,filterSpec:r.model.get("filterSpec"),publicFilterSpec:r.model.get("publicFilterSpec")}],onApply:(o=[])=>{UWA.is(o,"array")?o.forEach(o=>{if(UWA.is(o,"object")){let i;o.filterRootIds&&1===o.filterRootIds.length&&(i=o.filterRootIds[0],n.mfg.context===i&&(o.CVQueryV2={filter:r._getCVQueryFilter(i,e.filterProxy,o)},n.mfg.filter=o.CVQueryV2.filter,n.mfg.withFilter=!0,n.process.filter=o.CVQueryV2.filter,r._publish("onFilterApplied",{fieldId:t.fieldId}),t.onFilterApplied&&t.onFilterApplied(o)))}else r.logger.error("filterData is not valid, filterData should be an object")}):r.logger.error("Callback is not valid, results should be an array")},onCancel:e=>{n.mfg.filter=null,n.mfg.withFilter=!1,n.process.filter=null,n.process.withFilter=!1,r._publish("onFilterCancelled",{fieldId:t.fieldId}),t.onFilterCancelled&&t.onFilterCancelled(e)},showConfirmationDialog:!o||!o.isVisible(),filterProxy:e.filterProxy,NGFUXId:e.NGFUXId})},g=function(e,t){t&&t.ids&&t.ids.length>0&&(r._publish("onGetFieldValue",{fieldId:e,ids:t.ids}),1===t.ids.length&&r._publish(`on${e}Select`,t.ids[0]))},h=async function(e){let t=r.model.get("formData"),o=(i=[],(n=[e])&&(i=n.map(e=>e.split(u.Context.delimeter)[0])),i);var n,i;o&&1===o.length&&(t.mfg.contextOccurrence=e.split(u.Context.delimeter),f())},b=function(){let o=r.model.get("formData");var n=a.getMfgInstallOccurrencesForContext(t,e.id,o.process.context,o.mfg.scopedMfg,o.mfg.context);g(u.Fields.MfgInstallOccurrence,n)},C=async function(n){let i=r.model.get("formData");i.mfg.context=n;let l,s={fieldId:u.Fields.MfgInstallContext,onFilterApplied:async function(o){let n=a.getMfgInstallOccurrencesForContext(t,e.id,i.process.context,i.mfg.scopedMfg,i.mfg.context),l=[];n&&UWA.is(n.ids,"array")&&n.ids.forEach(e=>l.push(e.split(u.Context.delimeter))),o.filter=o.CVQueryV2.filter,o.paths=l;let s=await r.getInstallOccurrencesForFilter(o);UWA.is(s,"array")&&s.length>0?(s=s.map(e=>e.join(u.Context.delimeter)),g(u.Fields.MfgInstallOccurrence,{ids:s})):f()},onFilterCancelled:function(e){e&&!0===e.result||o&&o.isVisible()?b():d()}};!0===e.installAutoApplyVolume?(l=await r.computeVolumeFilter(i.mfg.context,i.mfg.scopedMfg,{installVolumeOffSet:e.installVolumeOffSet,withFilter:e.withFilter}),r.model.set("publicFilterSpec",l),m(s)):!0===e.withFilter?m(s):b()},y=function(n){let i=r.model.get("formData"),l={fieldId:u.Fields.MfgScopedItem,onFilterApplied:function(){f()},onFilterCancelled:function(e){e&&!0===e.result||o&&o.isVisible()?f():d()}};i.mfg={context:n,scopedMfg:n,pprType:r.PPRTYPES.MBOM},a.getMfgInstallOccurrences(t,e.id,i.process.context,n).ids.length>0?function(){let o=r.model.get("formData");var n=a.getMfgInstallContext(t,e.id,o.process.context,o.mfg.context);g(u.Fields.MfgInstallContext,n)}():!0===e.withFilter?m(l):f()},x=function(o){let n=r.model.get("formData");var i;n.process.contextOccurrence=o.split(u.Context.delimeter),n.process.context,i=a.getMfgContext(t,e.id,r.model.get("formData").process.context),g(u.Fields.MfgScopedItem,i)},F=function(o){var n;r.model.get("formData").process={context:o,pprType:r.PPRTYPES.PROCESS,withFilter:e.withFilter},n=a.getProcessContextOccurrences(t,e.id,r.model.get("formData").process.context),g(u.Fields.ProcessContextOccurrence,n)};if(!(e&&e.onOpen&&e.onError&&e.onCancel))throw new Error("Invalid input, please check the input params");if(e.scopedMfg){if(e.scopedMfg=function(t){let o=t.occurrence?t.occurrence[0]:t.id,n=e.filterProxy.getFilterSpec(o,{V2:{}}),r={...t};return n&&(r.withFilter=!0,r.filter=n.filter),r}(e.scopedMfg),e.scopedMfg&&e.scopedMfg.id&&!e.scopedMfg.pprType){let t=await this.getTaxonomies([e.scopedMfg.id]);e.scopedMfg.pprType=this.getPPRType(t[e.scopedMfg.id])}if(e.resource&&e.resource.id&&!e.resource.pprType){let t=await this.getTaxonomies([e.resource.id]);e.resource.pprType=this.getPPRType(t[e.resource.id])}e.onOpen({results:[e]})}else r._showMask(),(()=>{const e={ProcessContext:F,ProcessContextOccurrence:x,MfgScopedItem:y,MfgInstallContext:C,MfgInstallOccurrence:h};for(let t in e)Object.prototype.hasOwnProperty.call(e,t)&&i.push(r.subscribe({event:`on${t}Select`},function(o){let n=o?o.data:null;r.logger.debug(`Value of the ${t} is ${n}`),e[t](n)}))})(),[t,n]=await Promise.all([r.getContextScope(e.id),async function(){let t;!0===e.withFilter&&e.buildId&&await r.getFilterSpecXml(e.buildId)&&(t={rootAlias:"X",specification:{type:e.filterProxy.CONFIG_FILTER,data:await r.getFilterSpecXml(e.buildId)}});return t}()]),r.model.set("context",t),r.model.set("filterSpec",n),await p(),r.publish({event:"COMPLETE_TPB"}),r._removeMask(),(()=>{let o;(o=a.getProcessContext(t,e.id))&&o.ids.length>0?(r.model.set("formData",{}),g(u.Fields.ProcessContext,o)):(r.model.set("formData",{process:{context:e.id,type:e.type,pprType:r.PPRTYPES.PROCESS,withFilter:e.withFilter}}),f())})()}_handleError(e,t,o="DELOP_E00",n){let r=n?u.ErrorCodes[o].replace({}):u.ErrorCodes[o],i=p.replace(p.get(r),n);if(this.logger.debug(t),!e.onError)throw this.logger.error(t),this.logger.error("onError callback function is not available, please provide onError to manage errors"),new Error(i);e.onError({results:[],error:{code:o,message:i}})}async open(e){let t,o=this;if(!(e&&UWA.is(e.items,"array")&&e.onOpen&&e.onError&&e.onCancel))throw new Error("Invalid input, please check the input params");this.logger.debug("OpenControl open invoked with params",e),e&&e.items?e.items.length>0&&(t=await this.getTaxonomies(e.items.map(e=>e.id)),e.items.forEach(function(e){e.pprType=o.getPPRType(t[e.id])}),e.items.some(e=>e.pprType===this.PPRTYPES.PROCESS)?1===e.items.length?this._openProcess({...e.items[0],showForm:e.showForm,container:e.container,onOpen:e.onOpen,onCancel:e.onCancel,onError:e.onError,filterProxy:e.filterProxy,NGFUXId:e.NGFUXId}):this._handleError(e,`${this.PPRTYPES.PROCESS} type not supported in MultiRoots Scenarios`,"DELOP_E04",{type:this.PPRTYPES.PROCESS}):this._open(e)):this._handleError(e,"items property is missing","DELOP_E01")}getProxy(){}getExposedComponent(){return this.publicAPI=super.getExposedComponent(),this.publicAPI.open=this.open.bind(this),this.publicAPI}}return f.prototype.mixinProperties(f,l),f.prototype.mixinProperties(f,i),f});