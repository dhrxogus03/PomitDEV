define("DS/XCADIFCDocument/IFCTessellatedRepresentation",["DS/XCADInputDocuments/XCADTessellatedRepresentation","DS/XCADInputDocuments/XCADRepresentation","DS/XCADInputDocuments/XCADFaceData","DS/XCADInputDocuments/XCADEdgeData","DS/Mesh/ThreeJS_Base"],function(t,e,i,r,o){"use strict";var s=/([^,]+)/g,n=/\(([^)]+)\)/g;t.KindOfNode.NOD_SolidNode,t.KindOfNode.NOD_GP,t.KindOfGP.GP_Face;return t.extend(function(t,i){this._associatedDocument=t,this._ifcTokenizeArgs=t.ifcTokenizeArgs,this._representationType=e.XCAD_TESSELLATED_REPRESENTATION,this._ifcRepresentationIndex=i;var r=[];t.ifcTokenizeArgs(t.ifcEntities[i.substr(1)],r),this._rootNodes=[],t.ifcTokenizeArgs(r[3],this._rootNodes),this._verticelist={},this._idxCoordList=void 0,this._associatedDocument.CoordSystem.Coord=!1,this._associatedDocument.CoordSystem.Origin=void 0,this._associatedDocument.CoordSystem.Axis=void 0,this._associatedDocument.CoordSystem.RefDir=void 0,this._isNodeGP=!1},{_fillVerticesList:function(t){let e=this._associatedDocument.ifcEntities[t],i=e.substr(e.indexOf("((")+2,e.indexOf("))")-2).match(n);this._verticelist[t]=[],this._idxCoordList=t;let r=[],o=0;null!=i&&(o=i.length);for(var c=0;c<o;c++)3===(r=i[c].substr(1,i[c].length-2).match(s)).length&&this._verticelist[t].push(r[0],r[1],r[2]),r=null},_processTriangleStrips:function(t,e,i){var r=e.substr(1,e.length-2).match(n),c=null==i||1===i.length;let a=r.length;for(let e=0;e<a;e++){let n=r[e].substr(1,r[e].length-2).match(s);if(null==i){var d,u,h,f=new o.Vector3,l=new o.Vector3,g=new o.Vector3;d=3*(n[0]-1);var p=new o.Vector3(this._verticelist[this._idxCoordList][d],this._verticelist[this._idxCoordList][d+1],this._verticelist[this._idxCoordList][d+2]);u=3*(n[1]-1);var m=new o.Vector3(this._verticelist[this._idxCoordList][u],this._verticelist[this._idxCoordList][u+1],this._verticelist[this._idxCoordList][u+2]);h=3*(n[2]-1);var v=new o.Vector3(this._verticelist[this._idxCoordList][h],this._verticelist[this._idxCoordList][h+1],this._verticelist[this._idxCoordList][h+2]);f.subVectors(p,m),l.subVectors(p,v),g.crossVectors(f,l),g.normalize(),t.setNormalAt(d/3,g.getComponent(0).toString(),g.getComponent(1).toString(),g.getComponent(2).toString()),t.setNormalAt(u/3,g.getComponent(0).toString(),g.getComponent(1).toString(),g.getComponent(2).toString()),t.setNormalAt(h/3,g.getComponent(0).toString(),g.getComponent(1).toString(),g.getComponent(2).toString()),t.stripTrianglesIndices.push(d/3,u/3,h/3)}else{let e=n.length;for(let r=0;r<e;r++){let e=n[r];if(e-=1,t.stripTrianglesIndices.push(e),!c){let r=i[e].substr(1,i[e].length-2).match(s);t.setNormalAt(e,r[0],r[1],r[2]),r=null}}}t.nbVertexPerStripTriangle.push(n.length),n=null}r=null},_processTriangleFans:function(t,e,i){throw"Error: not implemented method"},getChildren:function(t,e){var i=[];return i.push(t),i},getChild:function(t,e){throw"Error: not implemented method"},getChildCount:function(t,e){throw"Error: not implemented method"},getAssociatedTransfo:function(t){throw"Error: not implemented method"},getGeomSet:function(t){throw"Error: not implemented method"},getCircleData:function(t){throw"Error: not implemented method"},getConeData:function(t){throw"Error: not implemented method"},getCoordinateSystem:function(){return this._associatedDocument.CoordSystem},getCylinderData:function(t){throw"Error: not implemented method"},getVertexData:function(t){throw"Error: not implemented method"},getEdgeData:function(t){throw"Error: not implemented method"},getFaceData:function(t){var e=this._associatedDocument._ifcGetEntityType(t.substring(1)),r=[];this._ifcTokenizeArgs(e.second,r);var o=new i,s=r[0].substring(1);void 0===this._verticelist[s]&&this._fillVerticesList(s);for(var c=this._verticelist[s].length,a=0,d=0;d<c/3;d++){for(var u=0;u<3;u++)o.vertices[3*d+u]=this._verticelist[s][a+u];a+=3}if(null!=r[1]){var h=r[1].substr(1,r[1].length-2).match(n);r[3].length>2&&this._processTriangleStrips(o,r[3],h)}return o},getGPType:function(e){return t.KindOfGP.GP_Face},getNodeBoundingSphere:function(t){throw"Error: not implemented method"},getNodeColor:function(t){t=t.substring(1);var e=this._associatedDocument.overridingFaceColors[t];return void 0!==e?e:this._associatedDocument.bodyColors[t]},getNodeOrientationMatrix:function(t){throw"Error: not implemented method"},getNodeType:function(e){var i=t.KindOfNode.NOD_SolidNode;return this._isNodeGP?(this._isNodeGP=!1,i=t.KindOfNode.NOD_GP):this._isNodeGP=!0,i},getNodeUID:function(t){throw"Error: not implemented method"},getPlaneData:function(t){throw"Error: not implemented method"},getPointData:function(t){throw"Error: not implemented method"},getPolyLineData:function(t){throw"Error: not implemented method"},getRootNode:function(t){return this._rootNodes[t]},getRootNodesCount:function(){return this._rootNodes.length},getSAG:function(t){throw"Error: not implemented method"},getSphereData:function(t){throw"Error: not implemented method"},isIndexed:function(){return!0}})}),define("DS/XCADIFCDocument/IFCProductInstance",["DS/XCADInputDocuments/XCADProductInstance"],function(t){"use strict";return t.extend(function(t,e){this._document=t,this._ifcProductInstance=e},{getGeometricProperties:function(){throw"Error: not implemented method"},getInstanceAttributes:function(){var t=[];return t.push(this._ifcProductInstance.instanceName),t},getReferenceProduct:function(){return this._document.getProductReference(this._ifcProductInstance.productReferenceIdx)},getUID:function(){throw"Error: not implemented method"},getTransformation:function(){var t,e=this._ifcProductInstance.transfo;if(void 0!==e){var i=e.rotation.elements,r=e.translation;t=[[[i[0],i[1],i[2]],[i[3],i[4],i[5]],[i[6],i[7],i[8]]],[r.x,r.y,r.z]]}return t}})}),define("DS/XCADIFCDocument/IFCProductRepresentation",["DS/XCADInputDocuments/XCADProductRepresentation"],function(t){"use strict";return t.extend(function(t,e,i){this._name=i,this._associatedDocument=t,this._representationType=e,this._rootProducts=[]},{addRootProduct:function(t){this._rootProducts.push(t)}})}),define("DS/XCADIFCDocument/IFCProduct",["exports","DS/XCADInputDocuments/XCADProduct","DS/XCADIFCDocument/IFCProductInstance"],function(t,e,i){"use strict";var r=e.extend(function(t,e){this._document=t,this._ifcProduct=e},{getDocument:function(){var t,e=this._ifcProduct.geomRep;return null!=e&&((t=this._document)._internalRepresentationIndex=e.location),t},getFilePath:function(){},getGeometricProperties:function(){throw"Error: not implemented method"},getInstanceList:function(){for(var t=[],e=this._ifcProduct.childrenList.length,r=0;r<e;r++){var o=new i(this._document,this._ifcProduct.childrenList[r]);null!=o&&t.push(o)}return t},getProductAttributes:function(){var t=[];return t.push(this._ifcProduct.referenceName),t.push(""),t.push(""),t.push(""),t.push(""),t.push(e.SourceTypes.Unknown),t},getUID:function(){throw"Error: not implemented method"}});return t.IFCProduct=r,r}),define("DS/XCADIFCDocument/IFCInputDocument",["DS/XCADInputDocuments/XCADInputDocument","DS/XCADInputDocuments/XCADRepresentation","DS/XCADIFCDocument/IFCTessellatedRepresentation","DS/XCADIFCDocument/IFCProductRepresentation","DS/XCADIFCDocument/IFCProduct","DS/XCADInputDocuments/XCADFaceData","DS/Mesh/ThreeJS_Base","DS/XCADLoader/XCADError"],function(t,e,i,r,o,s,n,c){"use strict";e.XCAD_TESSELLATED_REPRESENTATION;return t.extend(function(){this.tesselatedReps=[],this.ifcEntities=[],this.bodyColors=[],this.overridingFaceColors=[],this.assyProducts=[],this.nbInstPart=0,this.rootProducts=[],this.CoordSystem={Coord:!1,Origin:void 0,Axis:void 0,RefDir:void 0}},{zipped:!1,requestResponseType:"arraybuffer",tokenizeComplexArgs:function(t,e){var i=0,r="";e.length=0;for(var o=0;o<t.length;o++)"("===t[o]?(i>=1&&(r+=t[o]),i++):")"===t[o]?--i>=1&&(r+=t[o],1===i&&(e.push(r),r="")):r+=t[o]},tokenizeArrayArgs:function(t,e){var i="";e.length=0;for(var r=0;r<t.length;r++)"("!==t[r]&&(","===t[r]||")"===t[r]?(e.push(i),i=""):i+=t[r])},ifcTokenizeArgs:function(t,e){if(void 0!==t){e.length=0;t.substr(t.indexOf("(")+1,t.lastIndexOf(")")).match(/(\'[a-zA-Z0-9\s.,+-_#()~:&$\\\"]*\')*(\([()]*(\([^()]*\)[^()]*)*\))*(\([a-zA-Z0-9\s.,-_#]*\))*(\.[a-zA-Z0-9\s.,-_#]*\.)*(\#?\-?[0-9]+[.-E0-9]*)*(\$)*/g).filter(function(t){return""!=t}).forEach(t=>{if("string"==typeof t&&t.startsWith("'")&&t.endsWith("'")&&(t=t.slice(1,-1)),t.indexOf("\\X2\\")>=0){var i=t.substr(t.indexOf("\\X2\\")+4,t.indexOf("\\X0\\")).match(/.{1,4}/g);i.forEach((t,e,i)=>{i[e]="0x"+t});var r=String.fromCharCode.apply(String,i);t=t.substr(0,t.indexOf("\\X2\\"))+r+t.substr(t.indexOf("\\X0\\")+4,t.length-1)}e.push(t)})}},_ifcGetEntityType:function(t){var e,i=this.ifcEntities[t];void 0!==i&&(e=i.match(/^\w+/)[0]);return{first:e,second:i}},close:function(){void 0!==this._internalRepresentationIndex&&delete this._internalRepresentationIndex},getProductReference:function(t){return new o(this,this.assyProducts[t])},getRootProducts:function(){return this.rootProducts},getRepresentation:function(t){var o;if(void 0!==this._internalRepresentationIndex)t===e.XCAD_TESSELLATED_REPRESENTATION&&(o=new i(this,this._internalRepresentationIndex));else if(2===Object.keys(this.assyProducts).length&&0!==this.tesselatedReps.length&&t===e.XCAD_TESSELLATED_REPRESENTATION)o=new i(this,this.tesselatedReps[0]);else if(Object.keys(this.assyProducts).length>2&&t===e.XCAD_PRODUCT_REPRESENTATION){o=new r(this,e.XCAD_PRODUCT_REPRESENTATION,"root");var s,n=this.getRootProducts();if(n.length>0)s=n[0];else for(var c in this.assyProducts)if(this.assyProducts[c].isRoot){s=c;break}var a=this.getProductReference(s);o.addRootProduct(a)}return o},initialize:async function(t){var e=[];if("string"==typeof t)e[0]=t;else{var i=new TextDecoder("utf-8");if(t.byteLength>268435456){let r=0,o=268435456,s=0;for(;o<t.byteLength;)e[s]=i.decode(t.slice(r,o)),s++,r=o+1,o+=268435456;e[s]=i.decode(t.slice(r,t.byteLength))}else e[0]=i.decode(t)}if(""!==e[0]){for(var r=1;r<e.length;r++){let t=e[r].indexOf("\n#"),i=e[r].substring(0,t+1);e[r-1]+=i,e[r]=e[r].slice(t+1,e[r].length)}if(null===e[0].match(/FILE_SCHEMA\s*\(\s*\(\s*\'\s*IFC4/))return console.error("Only IFC4 files are supported"),(o=new c).setError("XCADLoader/XCADLoader","error.IFC_UNSUPPORT",null),o;var o,s=!0;for(r=0;r<e.length;r++)null!=e[r].match(/#\d+=[ ]*IFCTRIANGULATEDFACESET/)&&(s=!1);if(!0===s)return console.error("Only IFC file with tessellated data are supported"),(o=new c).setError("XCADLoader/XCADLoader","error.NO_TESSELLATION",null),o;for(r=0;r<e.length;r++)e[r]=e[r].replace(/\r?\n/g,""),e[r]=e[r].split(";");var a=this,d=[],u=[],h="",f=[],l=[],g=[],p=/^(#[0-9]+)\=(.+)$/,m=/^\w+/,v="";for(r=0;r<e.length;r++){v=e[r];for(var D=0;D<v.length;D++){for(var C=v[D].replace(/\/\*[\s\S-'$]*?\*\/|([^\\:]|^)\/\/.*|<!--[\s\S]*?-->$/,""),A=(C=C.replace(/\s+/g,"")).test(/\/\*[\s\S-'$]*?\*\/|([^\\:]|^)\/\/.*|<!--[\s\S]*?-->$/);1==A;)A=(C=C.replace(/\/\*[\s\S-'$]*?\*\/|([^\\:]|^)\/\/.*|<!--[\s\S]*?-->$/,"")).test(/\/\*[\s\S-'$]*?\*\/|([^\\:]|^)\/\/.*|<!--[\s\S]*?-->$/);var E=C.match(p);if(null!==(E=C.match(p))){var _=E[2].match(m);if(null===_)continue;if(null===_)console.error("IFCInputDocument::initialize entityType is null for tokens : "+E);else{var P=E[1].substr(1);switch(this.ifcEntities[P]=E[2],_[0]){case"IFCSHAPEREPRESENTATION":var T=[];a.ifcTokenizeArgs(E[2],T);var y=T[2];"Tessellation"==(y=y.replace("'",""))&&this.tesselatedReps.push(E[1]);break;case"IFCPROJECT":h=P;break;case"IFCRELAGGREGATES":d.push(P);break;case"IFCINDEXEDCOLOURMAP":g.push(P);break;case"IFCRELCONTAINEDINSPATIALSTRUCTURE":u.push(P)}}}}e[r].length=0}for(var R=0;R<g.length;R++)S(g[R]);for(R=0;R<u.length;R++)I(u[R],!1);for(R=0;R<d.length;R++)I(d[R],!0);!function t(e,i){var r="#"+e;var o="#"+i;var s=[];a.ifcTokenizeArgs(a.ifcEntities[e],s);var n=[];a.ifcTokenizeArgs(a.ifcEntities[i],n);a._ifcGetEntityType(e);a._ifcGetEntityType(i);var c=s[2];var d=n[2];var u=f[e];var h=l[e];var g=0;var p=0;var m=0;void 0!==h?(g=5,p=4,m=h):void 0!==u&&(g=4,p=5,m=u);if(0!==g&&0!==m){var v=s[5].substr(1),D=a._ifcGetEntityType(v);if(void 0!==D.first||void 0!==D.second){var C=s[6].substr(1),A=a._ifcGetEntityType(C);if(void 0!==A.first||void 0!==A.second){var E=[];a.ifcTokenizeArgs(a.ifcEntities[C],E);var _=[],P=E[2];a.tokenizeArrayArgs(P,_);for(var T=0;T<_.length;T++){var y=_[T].substr(1),R=[];a.ifcTokenizeArgs(a.ifcEntities[y],R);var I=R[2];I=I.replace("'","");var S=void 0;switch(I){case"MappedRepresentation":var b=[];a.ifcTokenizeArgs(a.ifcEntities[y],b);var L=b[3].substr(2,b[3].length-3),k=[];a.ifcTokenizeArgs(a.ifcEntities[L],k);var x=k[0].substr(1),z=[];a.ifcTokenizeArgs(a.ifcEntities[x],z);var w=z[1].substr(1),X=[];a.ifcTokenizeArgs(a.ifcEntities[w],X),S=z[1];break;case"Tessellation":S=_[T]}r in a.assyProducts?a.assyProducts[r].geomRep={type:void 0,location:S}:0==a.rootProducts.length?(a.assyProducts[r]={referenceName:c,isRoot:!0,childrenList:[],geomRep:{type:void 0,location:S}},a.rootProducts.push(r)):a.assyProducts[r]={referenceName:c,isRoot:!1,childrenList:[],geomRep:{type:void 0,location:S}}}}else{var F=N(s[5]);if(0==a.rootProducts.length?(a.assyProducts[r]={referenceName:c,isRoot:!0,childrenList:[],geomRep:void 0},a.rootProducts.push(r)):a.assyProducts[r]={referenceName:c,isRoot:!1,childrenList:[],geomRep:void 0},o in a.assyProducts){var O={instanceName:c,productReferenceIdx:r,transfo:F};a.assyProducts[o].childrenList.push(O)}}}for(var G=0;G<m.length;G++){var V=[];a.ifcTokenizeArgs(a.ifcEntities[m[G]],V);var U=[],$=V[p];a.tokenizeArrayArgs($,U);for(var M=[],T=0;T<U.length;T++){var K=U[T].substr(1),B=a._ifcGetEntityType(K);a.ifcTokenizeArgs(a.ifcEntities[K],M);B.first;t(K,e)}}}else{var C=s[6].substr(1),A=a._ifcGetEntityType(C);if(void 0!==A.first||void 0!==A.second){o in a.assyProducts||(0==a.rootProducts.length?(a.assyProducts[o]={referenceName:d,isRoot:!0,childrenList:[],geomRep:void 0},a.rootProducts.push(o)):a.assyProducts[o]={referenceName:d,isRoot:!1,childrenList:[],geomRep:void 0});var E=[];a.ifcTokenizeArgs(a.ifcEntities[C],E);var _=[],P=E[2];a.tokenizeArrayArgs(P,_);for(var T=0;T<_.length;T++){var y=_[T].substr(1),R=[];a.ifcTokenizeArgs(a.ifcEntities[y],R);var I=R[2];I=I.replace("'","");var S=void 0;switch(I){case"MappedRepresentation":var b=[];a.ifcTokenizeArgs(a.ifcEntities[y],b);var L=b[3].substr(2,b[3].length-3),k=[];a.ifcTokenizeArgs(a.ifcEntities[L],k);var x=k[0].substr(1),z=[];a.ifcTokenizeArgs(a.ifcEntities[x],z);var w=z[1].substr(1),X=[];a.ifcTokenizeArgs(a.ifcEntities[w],X),S=z[1];break;case"Tessellation":S=_[T]}if(r in a.assyProducts){a.assyProducts[r].isRoot=!1;var J=a.rootProducts.indexOf(r);-1!=J&&a.rootProducts.splice(J,1)}else a.assyProducts[r]={referenceName:c,isRoot:!1,childrenList:[],geomRep:{type:void 0,location:S}}}var F=N(s[5]);o in a.assyProducts&&a.assyProducts[o].childrenList.push({instanceName:c,productReferenceIdx:r,transfo:F}),void 0!==a.assyProducts[r].geomRep&&a.nbInstPart++}else{var F=N(s[5]);if(0==a.rootProducts.length?(a.assyProducts[r]={referenceName:c,isRoot:!0,childrenList:[],geomRep:void 0},a.rootProducts.push(r)):a.assyProducts[r]={referenceName:c,isRoot:!1,childrenList:[],geomRep:void 0},o in a.assyProducts){var O={instanceName:c,productReferenceIdx:r,transfo:F};a.assyProducts[o].childrenList.push(O)}}}}(h,void 0)}function I(t,e){var i=[];if(a.ifcTokenizeArgs(a.ifcEntities[t],i),e){var r=i[4].substr(1);void 0===f[r]&&(f[r]=[]),f[r].push(t)}else{r=i[5].substr(1);void 0===l[r]&&(l[r]=[]),l[r].push(t)}}function S(t){var e=[],i=[];a.ifcTokenizeArgs(a.ifcEntities[t],i);var r=i[0].substr(1),o=i[2].substr(1),s=[];a.ifcTokenizeArgs(a.ifcEntities[o],s);var n=[];a.tokenizeComplexArgs(s[0],n);for(var c=0;c<n.length;c++)n[c]=n[c].replace(",(","("),a.ifcTokenizeArgs(n[c],e);a.bodyColors[r]=[e[0],e[1],e[2]]}function N(t){var e={},i=t.substr(1),r=a._ifcGetEntityType(i);if(void 0!==r.first||void 0!==r.second){var o=[];a.ifcTokenizeArgs(a.ifcEntities[i],o);var s=o[1].substr(1),c=[];a.ifcTokenizeArgs(a.ifcEntities[s],c);var d=[],u=[],h=[],f=[];c[0]=c[0].substr(1),c[1]=c[1].substr(1),c[2]=c[2].substr(1),a.ifcTokenizeArgs(a.ifcEntities[c[0]],d),a.ifcTokenizeArgs(d[0],u),a.ifcTokenizeArgs(a.ifcEntities[c[1]],d),a.ifcTokenizeArgs(d[0],h),a.ifcTokenizeArgs(a.ifcEntities[c[2]],d),a.ifcTokenizeArgs(d[0],f),e.rotation=new n.Matrix3;var l=new n.Vector3(h[0],h[1],h[2]),g=new n.Vector3(f[0],f[1],f[2]),p=new n.Vector3;return p.crossVectors(l,g),e.rotation.set(f[0],f[1],f[2],p.x,p.y,p.z,h[0],h[1],h[2]),e.translation=new n.Vector3(parseFloat(u[0]),parseFloat(u[1]),parseFloat(u[2])),e}}}})});