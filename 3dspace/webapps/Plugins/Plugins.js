define("DS/Plugins/RenderPass",["DS/Visualization/ThreeJS_DS","DS/Visualization/RenderMode"],function(e,s){"use strict";var t=1,i=function(i,r,n,a,o,l,h){this.scene=i,this.lockScene=!1,this.name=h,this.id="R"+t++,this.forcePolygonOffset=e.PolygonOffsetForceStatus.DEFAULT,this.overrideMaterial=n,this.renderFaceMode=null,this.renderLineMode=null,this.renderPointMode=null,!0===a?this.renderFaceMode=s.facesMask:null!=a&&(this.renderFaceMode=a||0),!0===o?this.renderLineMode=s.linesMask:null!=o&&(this.renderLineMode=o||e.HideAllRenderLineMode),!0===l?this.renderPointMode=s.pointsMask:null!=l&&(this.renderPointMode=l||0),this.forceMaterialDoubleSide=!1,this.oldRenderFaceMode=0,this.oldRenderFaces=null,this.oldRenderLineMode=e.HideAllRenderLineMode,this.oldRenderPointMode=0,this.oldRenderPoints=null,this.oldRenderSurfacicPoints=!1,this.needsSwap=!1,this.order=0,this.renderPluginsPre=!0,this.renderPluginsPost=!0,this.oldRenderPluginsPre=!0,this.oldRenderPluginsPost=!0,this.disableColorWrite=!1,this.disableDepthWrite=!1,this.disableDepthTest=!1,this.disableBackFaceCulling=!1,this.disableClippingPlanes=!1,this.enableStencilTest=!1,this.enableStencilWrite=!1,this.stencilOpFrontFaces="KEEP",this.stencilOpBackFaces="KEEP",this.stencilOpFrontFacesZFail="KEEP",this.stencilOpBackFacesZFail="KEEP",this.stencilFunc="ALWAYS",this.depthFunc=null,this.materialToUse=null,this.hideSurfacesAndUnclipedMeshes=!1,this.cullFaceMode="back",this.disableBackFaceClipPlanes=!1,this.renderCuttingElements=!1,this.cuttingScene=null,this.isCustomPass=!1,this.disableToneMapping=!1,this.stencilRef=100,this.defaults={},this.cameraName="main",this.idString="main",this.customCamera=null,this.useRenderPriorityOpacity=!1,this.isOITPass=!1,this.dlsToDisableFunc=null,this.composer=null,this.ignoreNoZ=!1,this.disabledByDefault=!1,this.order=0,this.isRobotPass=!1,this.oldRenderPointMode=null,this.renderToScreen=!1,this.renderSurfacicPoints=!1,this.renderedComposerContext=null,this.stateSortingResultFrom=null,this.stateSortingResults=new e.StateSortingResult.StateSortingResultCache(this),this.updateStateSortingResult=!0,this.forceMaterialMode=!1,this.transformProjectionMatrixCB=null,this.multiRenderCB=null,this._postRenderCB=null,this._preRenderCB=null};return i.prototype={getDefaultState:function(){return{enabled:!this.disabledByDefault,renderPlugins:!1,renderToCanvas:!1}},setMultiRenderCB:function(e){this.multiRenderCB=e},setStateSortingResultFrom:function(e,s){this.stateSortingResultFrom=e,this.updateStateSortingResult=s},setForceMaterialMode:function(e){this.forceMaterialMode=e},setRenderPluginsPre:function(e){this.renderPluginsPre=e},setRenderPluginsPost:function(e){this.renderPluginsPost=e},setMaterialToUse:function(e){this.materialToUse=e},setDisableColorWrite:function(e){this.disableColorWrite=e},setUseRenderPriorityOpacity:function(e){this.useRenderPriorityOpacity=e},setCustomCamera:function(e){this.customCamera=e},setDisableDepthWrite:function(e){this.disableDepthWrite=e},setDisableDepthTest:function(e){this.disableDepthTest=e},setDisableBackFaceCulling:function(e){this.disableBackFaceCulling=e},setForceMaterialDoubleSide:function(e){this.forceMaterialDoubleSide=e},setDisableClippingPlanes:function(e){this.disableClippingPlanes=e},setEnableStencilWrite:function(e){this.enableStencilWrite=e},setEnableStencilTest:function(e){this.enableStencilTest=e},setCameraName:function(e){this.cameraName=e},setStencilOps:function(e,s){this.stencilOpFrontFaces=e,this.stencilOpBackFaces=s,this.stencilOpFrontFacesZFail=e,this.stencilOpBackFacesZFail=s},setStencilOpsSeparate:function(e,s,t,i){this.stencilOpFrontFaces=e,this.stencilOpBackFaces=s,this.stencilOpFrontFacesZFail=t,this.stencilOpBackFacesZFail=i},setStencilFunc:function(e){this.stencilFunc=e},setCullFaceMode:function(e){this.cullFaceMode=e},setHideSurfacesAndUnclippedMeshes:function(e){this.hideSurfacesAndUnclipedMeshes=e},setDisableBackFaceClipPlanes:function(e){this.disableBackFaceClipPlanes=e},setCuttingScene:function(e){this.cuttingScene=e},setRenderCuttingElements:function(e){this.renderCuttingElements&&!e&&this.setCuttingScene(null),this.renderCuttingElements=e},setCustomPass:function(){this.isCustomPass=!0},setDisableToneMapping:function(e){this.disableToneMapping=e},setDepthFunc:function(e){this.depthFunc=e},setScene:function(e){this.scene=e},setDLsToDisableFunc:function(e){this.dlsToDisableFunc=e},setDLsState:function(e,s){if(this.dlsToDisableFunc){var t=this.dlsToDisableFunc;e.forEach(function(e){t(e)&&(e.active=s)})}},setTransformProjectionMatrixCB:function(e){this.transformProjectionMatrixCB=e},activateAllDLs:function(e){for(var s=0;s<e.length;s++)e[s].active=!0},getCamera:function(e,s){return this.customCamera||e[s]||(this.composer?this.composer.camera:null)},render:function(){var e=arguments[0].info.renderTime;if(e.push(this.name),null===this.multiRenderCB)this.render_internal.apply(this,arguments);else for(var s=0;this.multiRenderCB(this,s++);)this.render_internal.apply(this,arguments);e.pop()},_getStateSortingResult:function(s,t,i){return e.StateSortingResult._getStateSortingResult(t.materialToUse,this.scene,s,i,this.stateSortingResults)},render_internal:function(s,t,i,r,n,a,o,l,h,u){var c;s.resetPassInfo();var d=o[l],p=s.context;this.scene.overrideMaterial=this.overrideMaterial,s.forcePolygonOffset=this.forcePolygonOffset,this.renderedComposerContext=a;var f=null;this.depthFunc&&(f=s.getDepthFunc(),s.setDepthFunc(s.depthFuncs[this.depthFunc])),p&&(p.stencilFunc(p[this.stencilFunc],this.stencilRef,255),p.stencilOpSeparate(p.FRONT,p.KEEP,p[this.stencilOpFrontFacesZFail],p[this.stencilOpFrontFaces]),p.stencilOpSeparate(p.BACK,p.KEEP,p[this.stencilOpBackFacesZFail],p[this.stencilOpBackFaces]),this.enableStencilTest&&p.enable(p.STENCIL_TEST)),null!==this.renderFaceMode&&(this.oldRenderFaceMode=s.renderFaceMode,s.renderFaceMode=this.renderFaceMode),null!==this.renderLineMode&&(this.oldRenderLineMode=s.renderLineMode,s.renderLineMode=this.renderLineMode),this.forceMaterialDoubleSide&&(s.forceMaterialDoubleSide=!0),null!==this.renderPointMode&&(this.oldRenderPointMode=s.renderPointMode,s.renderPointMode=this.renderPointMode),this.oldRenderPluginsPre=s.enableRenderPluginsPre,s.enableRenderPluginsPre=this.renderPluginsPre,this.oldRenderPluginsPost=s.enableRenderPluginsPost,s.enableRenderPluginsPost=this.renderPluginsPost,s.setFaceCulling("back"==this.cullFaceMode?e.CullFaceBack:"front"==this.cullFaceMode?e.CullFaceFront:e.CullFaceNone),0!=this.disableBackFaceClipPlanes&&(s.disableBackFaceClipPlanes=this.disableBackFaceClipPlanes);var g=s.clipPlanesEnabled;this.disableClippingPlanes&&(s.clipPlanesEnabled=!1),this.disableColorWrite&&s.setDisableColorWrite(!0),this.disableDepthWrite&&s.setDisableDepthWrite(!0),this.disableDepthTest&&s.setDisableDepthTest(!0),this.enableStencilWrite&&s.setEnableStencilWrite(!0),this.disableBackFaceCulling&&s.setDisableBackFaceCulling(!0);var m=[];this.hideSurfacesAndUnclipedMeshes&&this.scene.traverse(function(s){if(s instanceof e.Mesh&&s.visible){var t=s.material;t&&!1===t.enableClipPlanes&&(m.push(s),s.visible=!1)}});var P=s.materialToUse;!e.MaterialHasPriority[P]&&this.materialToUse&&(s.materialToUse=this.materialToUse),this.cuttingScene&&(s.cuttingScene=this.cuttingScene),s.setCurrentPass(this),s.autoClearStencil=!1,s.autoClearDepth=!1,s.autoClear=!1;var C=s.gammaInput,S=s.gammaOutput;this.disableToneMapping&&(s.gammaInput=!1,s.gammaOutput=!1);var R,D=s.renderVolumesOnly;s.renderVolumesOnly=this.hideSurfacesAndUnclipedMeshes,this.useRenderPriorityOpacity&&s.materialToUse===e.MaterialToUse.originalMaterial&&(s.useRenderPriorityOpacity=!0),this.forceMaterialMode&&(R=s.materialMode,s.materialMode=!0),null!==this.transformProjectionMatrixCB&&(s.transformProjectionMatrixCB=this.transformProjectionMatrixCB);var _=this.updateStateSortingResult,b=null;if(b=this.stateSortingResultFrom&&this.stateSortingResultFrom.renderedComposerContext?this.stateSortingResultFrom._getStateSortingResult(this.stateSortingResultFrom.renderedComposerContext,s,d):this._getStateSortingResult(a,s,d),this.setDLsState(b._displayLists,!1),s.activateSplitScreenMode(!(!u&&i)),2===u){var T=s.RTTmatchViewport;s.RTTmatchViewport=!0}for(this._preRenderCB&&this._preRenderCB(s),u?s.render(this.scene,this.getCamera(o,l),null,!1,b,_):s.render(this.scene,this.getCamera(o,l),i,!1,b,_),this._postRenderCB&&this._postRenderCB(s),2===u&&(s.RTTmatchViewport=T),null!==this.transformProjectionMatrixCB&&(s.transformProjectionMatrixCB=null),this.forceMaterialMode&&(s.materialMode=R),this.activateAllDLs(b._displayLists),this.useRenderPriorityOpacity&&(s.useRenderPriorityOpacity=!1),s.renderVolumesOnly=D,s.gammaInput=C,s.gammaOutput=S,s.setCurrentPass(null),this.cuttingScene&&(s.cuttingScene=null),s.materialToUse=P,c=0;c<m.length;c++)m[c].visible=!0;s.setDisableColorWrite(!1),this.disableClippingPlanes&&(s.clipPlanesEnabled=g),this.disableBackFaceCulling&&s.setDisableBackFaceCulling(!1),s.setDisableDepthWrite(!1),s.setDisableDepthTest(!1),s.setEnableStencilWrite(!1),this.enableStencilTest&&p&&p.disable(p.STENCIL_TEST),null!==this.renderFaceMode&&(s.renderFaceMode=this.oldRenderFaceMode),null!==this.renderLineMode&&(s.renderLineMode=this.oldRenderLineMode),null!==this.renderPointMode&&(s.renderPointMode=this.oldRenderPointMode),0!=this.disableBackFaceClipPlanes&&(s.disableBackFaceClipPlanes=0),s.enableRenderPluginsPre=this.oldRenderPluginsPre,s.enableRenderPluginsPost=this.oldRenderPluginsPost,s.forceMaterialDoubleSide=!1,this.scene.overrideMaterial=null,p&&(p.stencilFunc(p.ALWAYS,0,255),p.stencilOp(p.KEEP,p.KEEP,p.KEEP)),f&&s.setDepthFunc(f),s.forcePolygonOffset=e.PolygonOffsetForceStatus.DEFAULT}},i}),define("Plugins/RenderPass",["DS/Plugins/RenderPass","DS/DSMigration/DSMigration"],function(e,s){return s.deprecateModule("Plugins/RenderPass"),e}),define("DS/Plugins/MaskPass",["DS/Visualization/ThreeJS_DS"],function(e){"use strict";return null}),define("Plugins/MaskPass",["DS/Plugins/MaskPass","DS/DSMigration/DSMigration"],function(e,s){return s.deprecateModule("Plugins/MaskPass"),e}),define("DS/Plugins/ClearMaskPass",["DS/Visualization/ThreeJS_DS"],function(e){"use strict";return null}),define("Plugins/ClearMaskPass",["DS/Plugins/ClearMaskPass","DS/DSMigration/DSMigration"],function(e,s){return s.deprecateModule("Plugins/ClearMaskPass"),e}),define("DS/Plugins/PluginPass",["DS/Visualization/ThreeJS_DS"],function(e){"use strict";var s=function(e,s,t,i,r){this.scene=e,this.camera=s,this.name=t,this.cameraName="main",this.plugin=i,this.plugin.init(r),this.composer=null};return s.prototype={getDefaultState:function(){return{enabled:!1,renderPlugins:!1}},setCameraName:function(e){this.cameraName=e},setScene:function(e){this.scene=e},render:function(e,s,t,i,r,n,a,o,l){var h=a[o];e.doRenderPlugins([this.plugin],this.scene,h,t)},dispose:function(){this.plugin.dispose()}},s}),define("Plugins/PluginPass",["DS/Plugins/PluginPass","DS/DSMigration/DSMigration"],function(e,s){return s.deprecateModule("Plugins/PluginPass"),e}),define("DS/Plugins/UserPass",["UWA/Class"],function(e){"use strict";var s=0;return e.extend({init:function(e){this.id=s++,this.manager=e.manager,this.name=e.name,this.renderList=e.renderList,this.enabled=!0,this._passes=[],this._inserted=!1,this._cameraName=null},enable:function(e){var s;for(this.enabled=!!e,s=0;s<this._passes.length;s++)this._passes[s].disabledByDefault=!this.enabled;this.manager._getMainComposer().enableCustomPassNEW(this._passes)},_setupPasses:function(){var e;for(e=0;e<this._passes.length-1;e++)this._passes[e].userPass=this},_setCameraName:function(e){this._cameraName=e}})}),define("DS/Plugins/ShaderPass_New",["DS/Visualization/ThreeJS_DS","DS/ShaderBuilders/PostPro/PostProContext","DS/Materials/PostProMaterial"],function(e,s,t){"use strict";var i=1;return class{constructor(r,n){this.id="S"+i++,this.name=n,this.material=null,r instanceof s&&(this.material=new t({postProContext:r})),this.renderToScreen=!1,this.disableDepthTest=!0,this.needsSwap=!0,this.composer=null,this.requiredComposers=[],this.forceRenderTarget=null,this.order=0,this.isCustomPass=!1,this.defaults={},this.linkedComposerContexts=[],this.idString="main",this.changeRenderTargetProperties=null,this.enableWarmStart=!1,this.beforeRenderCB=null,this.afterRenderCB=null,this.isOITPass=!1,this.composer=null,this.disabledByDefault=!1,this.order=0,this.gammaCorrectionPass=!1,this.isRobotPass=!1,this.stateSortingResults=new e.StateSortingResult.StateSortingResultCache(this),this.stateSortingResultFrom=null,this.geometry=null,this.quad=null,this.shaderPassScene=new e.Scene,this.shaderPassScene._forShaderPass=!0}initQuad(s){this.geometry=[e.createPlaneGeometryDS(2,2,s)],this.quad=new e.Mesh(this.geometry,null),this.quad.frustumCulled=!1,this.quad.visibilityFree=!0,this.shaderPassScene.add(this.quad)}compileShader(){this.material.needsUpdate=!0}setForceRenderTarget(e){this.forceRenderTarget=e}addRequiredComposer(e){this.requiredComposers.push(e)}setCustomPass(){this.isCustomPass=!0}getDefaultState(){return{enabled:!this.disabledByDefault,renderToCanvas:!1,isLastPass:!1}}addLinkedEffectComposerContext(e){this.linkedComposerContexts.indexOf(e)<0&&(this.linkedComposerContexts.push(e),e.useCount++)}shareDepth(e,s,t){var i=e.composerContext.forceRenderTarget;i&&i.shareDepthFrom===t||(i&&e.renderTargetPool.pushRenderTarget(i),(i=e.renderTargetPool.buildRenderTarget(e.composerContext.width,e.composerContext.height,e.composerContext.renderTargetProperties.options)).shareDepthFrom=t,i.generateMipmaps=!1,e.composerContext.forceRenderTarget=i)}_getStateSortingResult(s,t,i){return e.StateSortingResult._getStateSortingResult(-1,this.shaderPassScene,s,i,this.stateSortingResults)}setInput(e,s=0){this.material.setInput(e,s)}setLinkedInput(e,s=0){this.material.setLinkedInput(e,s)}getInput(e=0){return this.material.getInput(e)}render(e,s,t,i,r,n,a,o,l,h){var u,c=e.info.renderTime;for(c.push(this.name),this.quad||this.initQuad(e.use_webgpu),r||this.setInput(s),this.beforeRenderCB&&this.beforeRenderCB(s),u=0;u<this.requiredComposers.length;u++){var d=this.requiredComposers[u];d.bShareDepth&&this.shareDepth(d,e,s),d.needsCameraUpdate&&(this.requiredComposers[u].composerContext.cameraName=n.cameraName);var p=d.getAllPasses()[0];p&&p.setInput&&p.setInput(s),this.requiredComposers[u].render(void 0,void 0,a,l)}e.resetPassInfo(),this.quad.material=this.material,e.setCurrentPass(this),e.autoClearStencil=!1,e.autoClearDepth=!1,e.activateSplitScreenMode(!t),e.setDisableDepthTest(this.disableDepthTest),null!==this.forceRenderTarget&&(t=this.forceRenderTarget);var f=this._getStateSortingResult(n,e,this.composer.camera),g=e.renderFaceMode;if(e.renderFaceMode=0,2===h){var m=e.RTTmatchViewport;e.RTTmatchViewport=!0}h?(e._renderToCanvas=!0,e.render(this.shaderPassScene,this.composer.camera,null,!1,f,!0),e._renderToCanvas=!1):e.render(this.shaderPassScene,this.composer.camera,t,!1,f,!0),2===h&&(e.RTTmatchViewport=m),e.renderFaceMode=g,e.setDisableDepthTest(!1),e.setCurrentPass(null),this.afterRenderCB&&this.afterRenderCB(),c.pop()}}}),define("DS/Plugins/UserRenderList",["UWA/Class"],function(e){"use strict";var s=0;return e.extend({init:function(e){this.name=e,this.id=s++},_getIdString:function(){return"_userIdString_"+this.id+(this.name?"_"+this.name:"")}})}),define("DS/Plugins/XMLV6SmartLoaderPassPlugin",["DS/VisuLoaders/XMLV6SmartLoaderPassPlugin"],function(e){"use strict";return e}),define("Plugins/XMLV6SmartLoaderPassPlugin",["DS/Plugins/XMLV6SmartLoaderPassPlugin","DS/DSMigration/DSMigration"],function(e,s){return s.deprecateModule("Plugins/XMLV6SmartLoaderPassPlugin"),e}),define("DS/Plugins/ClearPass",["DS/Visualization/ThreeJS_DS"],function(e){"use strict";var s=1,t=function(t){this.name=t,this.id="C"+s++,this.clearColor=null,this.clearAlpha=1,this.oldClearColor=new e.Color,this.oldClearAlpha=1,this.clear=!0,this.clearbColor=!1,this.clearDepth=!1,this.needsSwap=!1,this.clearStencil=!1,this.clearStencilValue=null,this.invertTarget=!1,this.scene=null,this.idString=null,this.composer=null,this.order=0,this.disabledByDefault=!1,this.isCustomPass=!1,this.isRobotPass=!1,this.defaults={clear:!0,doClearDepth:!1}};return t.prototype={getDefaultState:function(){return{enabled:!this.disabledByDefault,clear:this.defaults.clear,clearColor:this.clearColor,clearAlpha:this.clearAlpha,doClearDepth:this.defaults.doClearDepth,renderToCanvas:!1}},setClearStencil:function(e){this.clearStencil=e},setClearDepth:function(e){this.clearDepth=e},setCustomPass:function(){this.isCustomPass=!0},setScene:function(e){this.scene=e},render:function(e,s,t,i,r,n,a,o,l,h){if(!this.idString||!this.scene||0!==this.scene.getNbWebGLObjects(this.idString)){e.resetPassInfo();var u=e.info.renderTime;u.push(this.name);var c=e.context;this.clearColor&&(this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),null!==this.clearStencilValue?c&&c.clearStencil(this.clearStencilValue):c&&c.clearStencil(100),e.autoClear=!1,e.autoClearColor=this.clear||this.clearbColor,e.autoClearDepth=this.clear||this.clearDepth,e.autoClearStencil=this.clear||this.clearStencil,e.setCurrentPass(this);var d,p=null;h||(p=this.invertTarget?s:t),e.setRenderTarget(p),e.splitScreenMode?e.activateSplitScreenMode(!p):(d=e.getScissorTest(),e._enableClearScissor||e.enableScissorTest(!1)),e.clear(this.clear||this.clearbColor,this.clear||this.clearDepth,this.clear||this.clearStencil),e.splitScreenMode||e.enableScissorTest(d),e.setCurrentPass(null),u.pop()}}},t}),define("Plugins/ClearPass",["DS/Plugins/ClearPass","DS/DSMigration/DSMigration"],function(e,s){return s.deprecateModule("Plugins/ClearPass"),e}),define("DS/Plugins/ComposerContext",["DS/Visualization/ThreeJS_DS"],function(e){"use strict";var s=1,t=30;function i(e){!e&&t>0&&(console.warn("Rendering EffectComposer without specifying a result name"),t--)}var r=30,n=function(t,i,n){if(this.id=s++,void 0===t){var a=window.innerWidth||1,o=window.innerHeight||1;e.LinearFilter,e.LinearFilter,e.RGBFormat;t=new e.WebGLRenderTargetProperties(a,o,"uint")}this.renderTargetProperties=t,this.width=this.renderTargetProperties?this.renderTargetProperties.width:void 0,this.height=this.renderTargetProperties?this.renderTargetProperties.height:void 0,this.originalRenderTargetProperties=t,this.name=n,this.readBuffer=null,this.writeBuffer=null,this.renderResults={},this.usedBy=[],this.useCount=1,this.keepResult=!1,this.forceRenderTarget=null,this.passes=[],this.passStates=[],this.composer=i,i.contexts.push(this),this.needsUpdate=!0,this.cameras=[],this.updateStates(),this.onEffectComposerChange=null,Object.defineProperty(this,"renderTarget2",{get:function(){var e;for(e in r>0&&(console.warn("Accessing renderTarget2 deprecated property"),r--),this.renderResults)return this.renderResults[e];return null}}),this.beforeRenderCB=null,this.afterRenderCB=null,this.cameraName="",this.clearReadBuffer=0,this.noIdCheck=!1,this._forbidRenderableState=0,this._internalScaleForViewport=1,this._checkCamera=!1};return n.prototype={getPassState:function(e){var s,t=this.passes.indexOf(e);return t<0&&e&&(t=this.passes.length,this.passes.push(e),(s=e.getDefaultState()).pass=e,this.passStates[t]=s),this.passStates[t]},updateStates:function(){var e,s=this.composer.getAllPasses(),t=[];for(e=0;e<s.length;e++)t.push(this.getPassState(s[e]));this.passes=s,this.passStates=t,this.onEffectComposerChange&&this.onEffectComposerChange(this)},setBeforeRenderCB:function(e){this.beforeRenderCB=e},setAfterRenderCB:function(e){this.afterRenderCB=e},enablePass:function(e,s){if(e){var t=this.getPassState(e);!!t.enabled!=!!s&&this.composer&&this.composer.renderer.resetGSSOCache(),t.enabled=s}},setAsLastPass:function(e,s){e&&(this.getPassState(e).isLastPass=s)},enableRenderCuttingElementsPasses:function(e){var s,t=0;for(t=0;t<this.passes.length;t++)(s=this.passes[t]).renderCuttingElements&&!s.disabledByDefault&&this.enablePass(s,e)},setPassClear:function(e,s,t,i){var r=this.getPassState(e);r.clear=s,void 0!==t&&(r.clearColor=t),void 0!==i&&(r.clearAlpha=i)},setPassRenderToCanvas:function(e,s){this.getPassState(e).renderToCanvas=s},setPassClearDepth:function(e,s){this.getPassState(e).doClearDepth=s},setRenderPlugins:function(e,s){this.getPassState(e).renderPlugins=s},setCamera:function(e,s){this.getPassState(e).camera=s},setCameraName:function(e){this.cameraName=e},setTransformCameraCB:function(e){this.transformCameraCB=e},clearReadBufferIfRequired:function(e,s){0!==this.clearReadBuffer&&(2!==this.clearReadBuffer&&e.pushRenderTarget(this.readBuffer),this.clearReadBuffer=0,this.readBuffer=null)},swapBuffers:function(e,s,t){var i=this.writeBuffer;this.writeBuffer=this.readBuffer,this.readBuffer=i,this.readBuffer||this.acquireReadBuffer(e,s),!this.writeBuffer&&t&&this.acquireWriteBuffer(e,s)},useWarmStart:function(e,s){var t=this.getPassState(e).warmStart[s];this.readBuffer&&(renderTargetPool.pushRenderTarget(this.readBuffer),this.readBuffer=null),this.readBuffer=t,this.clearReadBuffer=2},saveReadRenderTargetForLatterWarmStart:function(e,s,t){var i=this.getPassState(e);i.warmStart||(i.warmStart={});var r=i.warmStart[t];r&&s.pushRenderTarget(r),i.warmStart[t]=this.readBuffer,this.clearReadBuffer=2},changeRenderTargetProperties:function(e,s,t){this.clearReadBuffer=1,this.writeBuffer&&s.pushRenderTarget(this.writeBuffer,this),this.writeBuffer=null,e.width=this.width,e.height=this.height,this.renderTargetProperties=e,this.acquireWriteBuffer(s,t)},linkToShaderPassUniform:function(e,s){e.addLinkedEffectComposerContext(this),this.usedBy.indexOf(s)<0&&(s.linked=!0,this.usedBy.push(s))},linkTo_internal:function(e,s,t){var r;for(this.noIdCheck||i(t),e.value=this.renderResults[t],r=0;r<this.usedBy.length;r++)if(this.usedBy[r]===e)return;this.usedBy.push(e)},removeLinks:function(){this.usedBy=[]},updateLinks:function(e){var s;for(this.noIdCheck||i(e),s=0;s<this.usedBy.length;s++)this.usedBy[s].value=this.forceRenderTarget?this.forceRenderTarget:this.renderResults[e]},restoreOriginalRenderTargetProperties:function(e,s){e.areRenderTargetOptionsEqual(this.renderTargetProperties,this.originalRenderTargetProperties)||(this.renderTargetProperties=this.originalRenderTargetProperties,this.renderResults[s]&&(e.pushRenderTarget(this.renderResults[s]),this.renderResults[s]=null))},acquireWriteBuffer:function(e,s){this.noIdCheck||i(s),this.renderTargetProperties&&(this.renderResults[s]?(this.writeBuffer=this.renderResults[s],this.renderResults[s]=null):this.writeBuffer||(this.writeBuffer=e.buildRenderTarget(this.renderTargetProperties.width,this.renderTargetProperties.height,this.renderTargetProperties.options||this.renderTargetProperties.optionsId,this.renderTargetProperties.targetCount,this.composer.renderer.antialias)))},acquireReadBuffer:function(e,s){this.noIdCheck||i(s),this.renderTargetProperties&&(this.readBuffer||(this.readBuffer=e.buildRenderTarget(this.renderTargetProperties.width,this.renderTargetProperties.height,this.renderTargetProperties.options,this.renderTargetProperties.targetCount,this.composer.renderer.antialias)))},getResult:function(e,s){var t=this.renderResults[e];return s&&(this.renderResults[e]=null),t},selectResult:function(e,s){this.renderResults[s]=this.writeBuffer,this.writeBuffer=null,this.renderResults[s]&&(this.renderResults[s].useCount=this.useCount),this.writeBuffer&&(e.pushRenderTarget(this.writeBuffer,this),this.writeBuffer=null),this.readBuffer&&(e.pushRenderTarget(this.readBuffer,this),this.readBuffer=null)},releaseRenderTargets:function(e,s){var t=this.renderResults[s];!this.keepResult&&t&&(t.useCount--,t.useCount<=0&&(e.pushRenderTarget(t,this),this.renderResults[s]=null))},setSize:function(e,s,t,i){if(this.width===e&&this.height===s)return;let r=function(e){i?i.pushRenderTarget(e,this):e.dispose()};var n,a;for(a=0;a<this.passStates.length;a++)void 0;for(n in this.renderResults)!this.renderResults[n]||t&&n!=t||r(this.renderResults[n]);t||(this.renderResults={}),this.originalRenderTargetProperties&&(this.originalRenderTargetProperties.width=e,this.originalRenderTargetProperties.height=s),this.renderTargetProperties&&(this.renderTargetProperties.width=e,this.renderTargetProperties.height=s),this.forceRenderTarget&&r(this.forceRenderTarget),this.forceRenderTarget=null,t||(this.readBuffer&&r(this.readBuffer),this.readBuffer=null,this.writeBuffer&&r(this.writeBuffer),this.writeBuffer=null),this.width=e,this.height=s},dispose:function(){this.setSize(0,0)},setOnEffectComposerChangeCallback:function(e){this.onEffectComposerChange=e,e&&e(this)}},n}),define("Plugins/ComposerContext",["DS/Plugins/ComposerContext","DS/DSMigration/DSMigration"],function(e,s){return s.deprecateModule("Plugins/ComposerContext"),e}),define("DS/Plugins/CSSNodesPass",["DS/Visualization/ThreeJS_DS"],function(e){"use strict";var s=function(e,s){this.scene=e,this.name=s,this.cameraName="main"};return s.prototype={getDefaultState:function(){return{enabled:!1,renderPlugins:!1}},setScene:function(e){this.scene=e},render:function(e,s,t,i,r,n,a,o,l){var h=a[o];e.updateCSSNodes(this.scene,h)}},s}),define("DS/Plugins/ShaderPass",["DS/Visualization/ThreeJS_DS","DS/Plugins/ShaderPass_New"],function(e,s){"use strict";return class extends s{constructor(s,t,i){if(super(s,i),this.textureID=null!=t?t:"tDiffuse",this.defines={},s.defines&&(this.defines=Object.assign({},s.defines)),this.uniforms=e.CloneStructure(s.uniforms),"false"!==localStorage.getItem("__WEBVISU_INTERNAL_UV_CHECK__")){const e=/\b(uv;)/g;var r=[...s.vertexShader.matchAll(e)];r&&r.length>0&&(console.error("vec4 uv being used as vec2, forcefully renaming, update your code. Set __WEBVISU_INTERNAL_UV_CHECK__ to false in your local storage to identify the compilation error."),s.vertexShader=s.vertexShader.replaceAll(e,"uv.xy;"))}this.material=new e.ShaderMaterial({uniforms:this.uniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,defines:this.defines}),this.material.force=!0,this.material.polygonOffset=!0,this.material.polygonOffsetFactor=0,this.material.polygonOffsetUnits=0}_updateMaterialShader(e){this.material.dispose(),this.material.fragmentShader=e.fragmentShader,this.material.vertexShader=e.vertexShader}compileShader(e){this.quad||this.initQuad(e.use_webgpu),e&&e.initMaterial(this.material,[],this.quad,null,this.material.programManager.getProgramID(this.quad,null),null,0),this.material.needsUpdate=!0}setInput(e){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=e)}getInput(){if(this.uniforms[this.textureID])return this.uniforms[this.textureID]}}}),define("Plugins/ShaderPass",["DS/Plugins/ShaderPass","DS/DSMigration/DSMigration"],function(e,s){return s.deprecateModule("Plugins/ShaderPass"),e}),define("DS/Plugins/UserRenderPass",["DS/Plugins/UserPass","DS/Plugins/RenderPass"],function(e,s){function t(e){return!!e}return e.extend({init:function(e){this._parent(e);var t=new s(null,null,null,null,null,null,"_UserRenderPass_"+this.id+"_"+this.name);this._passes.push(t)},setDisableColorWrite:function(e){this._passes[0].setDisableColorWrite(t(e))},setDisableDepthWrite:function(e){this._passes[0].setDisableDepthWrite(t(e))},setDisableBackFaceCulling:function(e){this._passes[0].setDisableBackFaceCulling(t(e))},setEnableStencilWrite:function(e){this._passes[0].setEnableStencilWrite(t(e))},setEnableStencilTest:function(e){this._passes[0].setEnableStencilTest(t(e))},setStencilOps:function(e,s){this._passes[0].setStencilOps(e,s)},setStencilOpsSeparate:function(e,s,t,i){this._passes[0].setStencilOpsSeparate(e,s,t,i)},setStencilFunc:function(e){this._passes[0].setStencilFunc(e)},setCullFaceMode:function(e){this._passes[0].setCullFaceMode(e)},setDepthFunc:function(e){this._passes[0].setDepthFunc(e)},_setCameraName:function(e){this._parent(e),this._passes[0].setCameraName(e)}})}),define("DS/Plugins/UserClearPass",["DS/Plugins/UserPass","DS/Plugins/ClearPass"],function(e,s){return e.extend({init:function(e){this._parent(e);var t=new s("_UserClearPass_"+this.id+"_"+this.name);t.defaults.clear=!1,t.clear=!1,this._passes.push(t)},setClearDepth:function(e){this._passes[0].defaults.doClearDepth=!!e},setClearStencil:function(e,s){void 0!==s&&(this._passes[0].clearStencilValue=s),this._passes[0].clearStencil=e}})}),define("DS/Plugins/UserSceneGraphPass",["DS/Plugins/UserPass","DS/Plugins/RenderPass","DS/Visualization/RenderMode"],function(e,s,t){function i(e){return!!e}return e.extend({init:function(e){this._parent(e),this.mainPass=new s(null,null,null,null,null,null,"_UserSceneGraphPass_"+this.id+"_"+this.name),this.sectionCappingPass=new s(null,null,null,t.facesMask,!1,!1,"passSectionCappingFrontFaces"),this.sectionCappingPass.setRenderCuttingElements(!0),this.sectionCappingPass.setEnableStencilTest(!0),this.sectionCappingPass.setEnableStencilWrite(!0),this.sectionCappingPass.setDisableColorWrite(!0),this.sectionCappingPass.setDisableDepthWrite(!0),this.sectionCappingPass.setStencilFunc("ALWAYS"),this.sectionCappingPass.setStencilOps("INCR_WRAP","DECR_WRAP"),this.sectionCappingPass.setDisableBackFaceCulling(!0),this.sectionCappingPass.setHideSurfacesAndUnclippedMeshes(!0),this.sectionCappingPass.setDisableBackFaceClipPlanes(1),this.sectionCappingPass.setRenderPluginsPre(!1),this.sectionCappingPass.setRenderPluginsPost(!1),this.sectionCappingPass.ignoreNoZ=!0,this._passes.push(this.mainPass),this._passes.push(this.sectionCappingPass)},setDisableColorWrite:function(e){this._passes[0].setDisableColorWrite(i(e))},setDisableDepthWrite:function(e){this._passes[0].setDisableDepthWrite(i(e))},setDisableBackFaceCulling:function(e){this._passes[0].setDisableBackFaceCulling(i(e))},setEnableStencilWrite:function(e){this._passes[0].setEnableStencilWrite(i(e))},setEnableStencilTest:function(e){this._passes[0].setEnableStencilTest(i(e))},setStencilOps:function(e,s){this._passes[0].setStencilOps(e,s)},setStencilOpsSeparate:function(e,s,t,i){this._passes[0].setStencilOpsSeparate(e,s,t,i)},setStencilFunc:function(e){this._passes[0].setStencilFunc(e)},setCullFaceMode:function(e){this._passes[0].setCullFaceMode(e)},setDepthFunc:function(e){this._passes[0].setDepthFunc(e)}})}),define("DS/Plugins/UserPassManager",["UWA/Class","DS/Plugins/UserRenderPass","DS/Plugins/UserClearPass","DS/Plugins/UserRenderList","DS/Plugins/UserPass","DS/Plugins/UserSceneGraphPass"],function(e,s,t,i,r,n){"use strict";var a=e.extend({init:function(e){this.viewer=e,this._activeUserPasses=[],this._activeRenderLists=null,this._updateRenderLists()},createUserRenderPass:function(e,t){var i=new s({manager:this,name:e,renderList:t});return t&&this._setUserPassRenderList(i,t),i},createUserClearPass:function(e,s){var i=new t({manager:this,name:e,renderList:s});return s&&this._setUserPassRenderList(i,s),i},createUserSceneGraphPass:function(e,s){var t=new n({manager:this,name:e,renderList:s});return s&&this._setUserPassRenderList(t,s),t},getSystemPass:function(e){return o[e]||null},insertUserPassAfterPass:function(e,s){var t;e._systemPass?console.warn("ERROR: Invalid arguments"):e._inserted?console.warn("ERROR: Already inserted pass"):(s instanceof r?(t=s._passes[s._passes.length-1],e._setCameraName(s._cameraName)):(t=s._list,e._setCameraName(s._cameraName)),this._getMainComposer().insertCustomPassAfterNEW(e._passes,t)&&(e._inserted=!0,this._activeUserPasses.push(e),this._updateRenderLists()))},insertUserPassBeforePass:function(e,s){var t;e._systemPass?console.warn("ERROR: Invalid arguments"):e._inserted?console.warn("ERROR: Already inserted pass"):(s instanceof r?(t=s._passes[0],e._setCameraName(s._cameraName)):(t=s._list,e._setCameraName(s._cameraName)),this._getMainComposer().insertCustomPassBeforeNEW(e._passes,t)&&(e._inserted=!0,this._activeUserPasses.push(e),this._updateRenderLists()))},removeUserPass:function(e){var s=this._activeUserPasses.indexOf(e);s>=0&&(this._getMainComposer().removeCustomPassNEW(e._passes),this._activeUserPasses.splice(s,1),e._inserted=!1,this._updateRenderLists())},_setUserPassRenderList:function(e,s){var t;for(t=0;t<e._passes.length;t++)e._passes[t].idString=s._getIdString()},_updateRenderLists:function(){var e,s;for(this._activeRenderLists=["main","noz","noEffectNoz","afterHighlightNoZ","dialog","furtive","onTop"],e=0;e<this._activeUserPasses.length;e++)if((s=this._activeUserPasses[e]).renderList&&s.enabled){var t=s.renderList._getIdString();this._activeRenderLists.indexOf(t)<0&&this._activeRenderLists.push(t)}},_getActiveRenderLists:function(){return this._activeRenderLists},_getMainComposer:function(){return this.viewer.renderer.mainComposer},_dispose:function(){this.viewer=null,this._activeUserPasses=null,this._activeRenderLists=null}}),o={infinitePlane:{_list:"infPlane",_systemPass:!0,_cameraName:"main"},main:{_list:"main",_systemPass:!0,_cameraName:"main"},noz:{_list:"noz",_systemPass:!0,_cameraName:"main"},noEffectNoz:{_list:"noEffectNoz",_systemPass:!0,_cameraName:"mainNoJittering"},afterHighlightNoz:{_list:"afterHighlightNoz",_systemPass:!0,_cameraName:"mainNoJittering"},robot:{_list:"robot",_systemPass:!0,_cameraName:"mainNoJittering"},canvas2D:{_list:"canvas2D",_systemPass:!0,_cameraName:"mainNoJittering"},dialog:{_list:"dialog",_systemPass:!0,_cameraName:"mainNoJittering"},onTop:{_list:"onTop",_systemPass:!0,_cameraName:"mainNoJittering"},furtive:{_list:"furtive",_systemPass:!0,_cameraName:"mainNoJittering"}};return a}),define("DS/Plugins/EffectComposer",["DS/Visualization/ThreeJS_DS","DS/Plugins/ShaderPass","DS/Plugins/ComposerContext","DS/Plugins/ClearPass"],function(e,s,t,i){"use strict";var r="--\x3e";function n(e){var s=e.slice(r.length);return s.startsWith("(")&&s.endsWith(")")&&(s=s.slice(1,s.length-1),!0),{list:s,privateList:!1}}function a(e,s){var t,i,a,o,l="passes",h=!1,u=!1;if(s){if((t=s.indexOf(e.name))<0)throw new Error("unknown added pass");for(i=t;i>=0&&!h;i--)(a=s[i]).startsWith(r)&&(l=(o=n(a)).list,u=o.privateList,h=!0)}else t=e.order;return{order:t,list:l,privateList:u}}function o(e,s,t){e.splice.apply(e,[s,0].concat(t))}var l=function(e){this.name=e,this.preCustomPasses=[],this.passes=[],this.postCustomPasses=[],this.privateList=!1};l.prototype.addPass=function(e,s,t){if(this.passes.length&&void 0!==s)for(var i=0;i<this.passes.length;i++){if(s<a(this.passes[i],t).order)return void this.passes.splice(i,0,e)}this.passes.push(e)};var h=0,u=function(s,i,a,o){var u,c,d,p;if(this.renderer=s,this.renderTargetPool=a,this.orderedPassNames=o||null,this.id=h,h++,this.contexts=[],this.passLists=[],o)for(u=0;u<o.length;u++){var f;if((c=o[u]).startsWith(r))d=(p=n(c)).list,(f=new l(d)).privateList=p.privateList,this.passLists.push(f)}else this.passLists.push(new l("passes"));for(this.passListIndex={},u=0;u<this.passLists.length;u++)this.passListIndex[this.passLists[u].name]=u;this.preCustomPasses=[],this.postCustomPasses=[],this.camera=new e.OrthographicCamera(-1,1,1,-1,0,1,this.renderer.use_webgpu),this.camera._renderingRole=e._CameraRoles.FULL_SCREEN,this.geometry=[e.createPlaneGeometryDS(2,2,this.renderer.use_webgpu)],this.quad=new e.Mesh(this.geometry,null),this.quad.frustumCulled=!1,this.quad.visibilityFree=!0,this.shaderPassScene=new e.Scene,this.shaderPassScene._forShaderPass=!0,this.shaderPassScene.add(this.quad),this.renderScene=null,this.enabled=!0,this.composerContext=i?new t(i,this):null,this.bShareDepth=!1,this.needsCameraUpdate=!1,this.keepResult=!1};return u.prototype={dispose:function(){this.quad.dispose()},getAllPasses:function(e){var s,t,i=[];for(s=e=e||0;s<this.passLists.length;s++)(t=this.passLists[s]).preCustomPasses.length&&(i=i.concat(t.preCustomPasses)),i=i.concat(t.passes),t.postCustomPasses.length&&(i=i.concat(t.postCustomPasses));return i},setComposerContext:function(e){this.composerContext=e},updateComposerContexts:function(e){var s;for(s=0;s<this.contexts.length;s++)this.contexts[s].updateStates(e)},swapBuffers:function(e,s,t){this.composerContext.swapBuffers(e,s,t)},addPass:function(e){var s=a(e,this.orderedPassNames),t=s.order;this.passLists[this.passListIndex[s.list]].addPass(e,t,this.orderedPassNames),e.composer=this,this.updateComposerContexts()},insertPass:function(e,s,t){t.splice(s,0,e),e.composer=this,this.updateComposerContexts()},enablePass:function(e,s){this.composerContext.enablePass(e,s)},linkToShaderPassUniform:function(e,s,t){this.composerContext.linkToShaderPassUniform(e,s,t)},removeLinks:function(){this.composerContext.removeLinks()},updateScene:function(e){this.renderScene=e;var s,t,i=this.getAllPasses(),r=i.length;for(t=0;t<r;t++)(s=i[t]).setScene&&!s.lockScene&&s.setScene(e)},getRenderResult:function(e){return this.composerContext.renderResults[e]},render:function(e,s,t,r,n){if(this.enabled)if(this.composerContext.needsUpdate||!this.composerContext.keepResult){var a=this.renderer.info.renderTime;a.push(this.composerContext.name),this.renderer._forbidRenderableState|=this.composerContext._forbidRenderableState,this.composerContext.restoreOriginalRenderTargetProperties(this.renderTargetPool,r),this.composerContext.acquireWriteBuffer(this.renderTargetPool,r),void 0!==s&&this.composerContext.writeBuffer&&(this.composerContext.writeBuffer.activeCubeFace=s),this.composerContext.beforeRenderCB&&this.composerContext.beforeRenderCB(this.composerContext);var o,l,h,u,c=this.getAllPasses(),d=c.length,p=0;if(n){if((p=c.indexOf(n))<0)return void a.pop();this.composerContext.useWarmStart(n,r)}var f=!1,g=0===p;for(l=p;l<d;l++){var m=null;if((o=c[l]).gammaCorrectionPass&&(f=!0),h=this.composerContext.getPassState(o),void 0!==o.clear&&(o.clear=h.clear,o.clearColor=h.clearColor,o.clearAlpha=h.clearAlpha),o.setClearDepth&&o.setClearDepth(h.doClearDepth),o.setRenderPluginsPre&&o.setRenderPluginsPre(h.renderPlugins),o.setRenderPluginsPost&&o.setRenderPluginsPost(h.renderPlugins),m=h.cameraName?h.cameraName:this.composerContext.cameraName?this.composerContext.cameraName:o.cameraName,h.isLastPass)break;if(h.enabled)if(o.needsSwap&&p!==l&&!g&&this.swapBuffers(this.renderTargetPool,r,!o.changeRenderTargetProperties),o.changeRenderTargetProperties&&this.composerContext.changeRenderTargetProperties(o.changeRenderTargetProperties,this.renderTargetPool,r),o.enableWarmStart&&o!==n&&this.composerContext.saveReadRenderTargetForLatterWarmStart(o,this.renderTargetPool,r),o.setDisableToneMapping&&f&&o.setDisableToneMapping(!0),this.composerContext.forceRenderTarget?o.render(this.renderer,this.composerContext.readBuffer,this.composerContext.forceRenderTarget,e,g,this.composerContext,t,m,r,h.renderToCanvas):o.render(this.renderer,this.composerContext.readBuffer,this.composerContext.writeBuffer,e,g,this.composerContext,t,m,r,h.renderToCanvas),this.composerContext.clearReadBufferIfRequired(this.renderTargetPool,r),o instanceof i||(g=!1),o.linkedComposerContexts)for(u=0;u<o.linkedComposerContexts.length;u++)o.linkedComposerContexts[u].releaseRenderTargets(this.renderTargetPool,r)}this.composerContext.selectResult(this.renderTargetPool,r),this.composerContext.releaseRenderTargets(this.renderTargetPool,r),this.composerContext.updateLinks(r),this.composerContext.afterRenderCB&&this.composerContext.afterRenderCB(this.composerContext),this.renderer._forbidRenderableState&=~this.composerContext._forbidRenderableState,a.pop()}else this.renderer.setRenderTarget(this.composerContext.renderResults[r])},setSize:function(e,s,t){this.composerContext&&this.composerContext.setSize(e,s,null,t?this.renderTargetPool:null)},insertCustomPassAfterPass:function(e,s){var t,i=this.passLists[this.passListIndex.main],r=i.preCustomPasses,n=i.postCustomPasses;if(e.setCustomPass(),s)if((t=r.indexOf(s))>=0)r.splice(t+1,0,e);else{if(!((t=n.indexOf(s))>=0))throw new Error("Reference custom pass not found");n.splice(t+1,0,e)}else n.splice(0,0,e);this.updateComposerContexts()},insertCustomPassBefore:function(e,s){var t,i=this.passLists[this.passListIndex.main],r=i.preCustomPasses,n=i.postCustomPasses;if(e.setCustomPass(),s)if((t=r.indexOf(s))>=0)r.splice(t,0,e);else{if(!((t=n.indexOf(s))>=0))throw new Error("Reference custom pass not found");n.splice(t,0,e)}else r.push(e);this.updateComposerContexts()},getPassList:function(e){return this.passLists[this.passListIndex[e]]},insertCustomPassBeforeNEW:function(e,s){if(!s)return!1;e instanceof Array||(e=[e]);var t,i,r,n,a,l=!1;if("string"==typeof s||s instanceof String){if((r=this.getPassList(s)).privateList)return!1;o(r.preCustomPasses,r.preCustomPasses.length-1,e)}else{for(t=0;t<this.passLists.length&&!l;t++)for(a=[(r=this.passLists[t]).preCustomPasses,r.postCustomPasses],i=0;i<a.length&&!l;i++)(n=a[i].indexOf(s))>=0&&(o(a[i],n,e),l=!0);if(!l)return console.warn("ERROR: Reference custom pass not found"),!1}for(t=0;t<e.length;t++)e[t].composer=this;return this.updateComposerContexts(),!0},insertCustomPassAfterNEW:function(e,s){if(!s)return!1;e instanceof Array||(e=[e]);var t,i,r,n,a,l=!1;if("string"==typeof s||s instanceof String){if((r=this.getPassList(s)).privateList)return!1;o(r.postCustomPasses,0,e)}else{for(t=0;t<this.passLists.length&&!l;t++)for(a=[(r=this.passLists[t]).preCustomPasses,r.postCustomPasses],i=0;i<a.length&&!l;i++)(n=a[i].indexOf(s))>=0&&(o(a[i],n+1,e),l=!0);if(!l)return console.warn("ERROR: Reference custom pass not found"),!1}for(t=0;t<e.length;t++)e[t].composer=this;return this.updateComposerContexts(),!0},removeCustomPassNEW:function(e){var s,t,i,r,n,a,o=e[0];for(s=0;s<this.passLists.length&&!r;s++)for(a=[(n=this.passLists[s]).preCustomPasses,n.postCustomPasses],t=0;t<a.length&&!r;t++)(i=a[t].indexOf(o))>=0&&(a[t].splice(i,e.length),r=!0);this.updateComposerContexts()},enableCustomPassNEW:function(e){var s,t,i;for(s=0;s<e.length;s++)for(t=e[s],i=0;i<this.contexts.length;i++)this.contexts[i].enablePass(t,!t.disabledByDefault);this.updateComposerContexts()},removePasses:function(e){var s,t,i,r,n,a;for(s=0;s<this.passLists.length&&!t;s++){for(i=this.passLists[s].passes,t=!1,n=0;n<e.length;n++)(r=i.indexOf(e[n]))>=0&&(t=!0,i[r]=null);if(t){for(a=0,n=0;n<i.length;n++)i[n]&&(i[a]=i[n],a++);i.length=a}}this.updateComposerContexts()},updateLinks:function(e){this.composerContext.updateLinks(e)},getPostEffectPasses:function(){var e=this.passListIndex.postEffects1,s=[],t=0;for(t=e;t<this.passLists.length;t++)t>e&&(s=s.concat(this.passLists[t].preCustomPasses)),s=(s=s.concat(this.passLists[t].passes)).concat(this.passLists[t].postCustomPasses);return s}},u}),define("Plugins/EffectComposer",["DS/Plugins/EffectComposer","DS/DSMigration/DSMigration"],function(e,s){return s.deprecateModule("Plugins/EffectComposer"),e});