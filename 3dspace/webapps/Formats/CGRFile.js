var Uint16HalfFloatToFloat,byteArrayReader=function(e){this.buffer=e,this.currentPosition=0,this.readAt=function(e){return this.buffer[e]},this.length=function(){return buffer.length},this.getCurrentPosition=function(){return this.currentPosition},this.setPosition=function(e){this.currentPosition=e},this.read=function(){return this.buffer[this.currentPosition++]},this.readDouble=function(e,t){return new DataView(buffer.buffer).getFloat64(e,!0)},this.readUcompressedInt=function(e){return e?(this.read()<<24|this.read()<<16|this.read()<<8|this.read())>>>0:(this.read()|this.read()<<8|this.read()<<16|this.read()<<24)>>>0},this.readInt=function(e){return e?this.read()<<24|this.read()<<16|this.read()<<8|this.read():this.read()|this.read()<<8|this.read()<<16|this.read()<<24},this.clone=function(){return new byteArrayReader(this.buffer)},this.getDataViews=function(e,t){return views=[],views.push({dataView:new DataView(this.buffer.buffer,e,t),buffer:this.buffer,offset:e}),views}};{var mantissatable=new Array(2048),exponenttable=new Array(64),offsettable=new Array(64);function convertMantissa(e){for(var t=e<<13,r=0;!(8388608&t);)r-=8388608,t<<=1;return(t&=-8388609)|(r+=947912704)}mantissatable[0]=0;for(var i=1;i<1024;i++)mantissatable[i]=convertMantissa(i);for(i=1024;i<2048;i++)mantissatable[i]=939524096+(i-1024<<13);exponenttable[0]=0;for(i=1;i<31;i++)exponenttable[i]=i<<23;exponenttable[31]=1199570944,exponenttable[32]=2147483648;for(i=33;i<63;i++)exponenttable[i]=i-32+2147483648<<23;exponenttable[63]=3347054592,offsettable[0]=0,offsettable[32]=0;for(i=1;i<64;i++)32!==i&&(offsettable[i]=1024);var uint32Array=new Uint32Array(1),float32Array=new Float32Array(uint32Array.buffer);Uint16HalfFloatToFloat=function(e){return uint32Array[0]=mantissatable[offsettable[e>>10]+(1023&e)]+exponenttable[e>>10],float32Array[0]}}var one_over_65535=1/65535,Uint16PositionsToFloats=function(e,t,r,i,n){for(var s=r.length/3,a=[Math.max(n.x-i.x,1e-6)*one_over_65535,Math.max(n.y-i.y,1e-6)*one_over_65535,Math.max(n.z-i.z,1e-6)*one_over_65535],o=[Math.floor(i.x/a[0]),Math.floor(i.y/a[1]),Math.floor(i.z/a[2])],p=e;p<s+e;p++){var h=r[3*p],u=r[3*p+1],f=r[3*p+2];t[3*p]=(o[0]+h)*a[0],t[3*p+1]=(o[1]+u)*a[1],t[3*p+2]=(o[2]+f)*a[2]}},setOctohedralToFloatArray=function(e,t,r,i){var n=2*t-1,s=2*r-1,a=1-Math.abs(n)-Math.abs(s);if(a<=0){var o=(1-Math.abs(s))*(n>=0?1:-1),p=(1-Math.abs(n))*(s>=0?1:-1);n=o,s=p}var h=Math.sqrt(n*n+s*s+a*a);e[3*i]=n/h,e[3*i+1]=s/h,e[3*i+2]=a/h},Oct24NormalsToFloats=function(e,t,r){for(var i=r.length/3,n=e;n<i+e;n++){var s=r[3*n],a=r[3*n+1],o=r[3*n+2],p=(16*s+Math.floor(a/16))/4095;setOctohedralToFloatArray(t,p,(a%16*256+o)/4095,n)}},Oct16NormalsToFloats=function(e,t,r){for(var i=r.length/2,n=e;n<i+e;n++){var s=r[2*n]/255,a=r[2*n+1]/255;setOctohedralToFloatArray(t,s,a,n)}};define("DS/Formats/CGRFile",["DS/Mesh/Mesh","DS/Mesh/ThreeJS_Base"],function(e,t){"use strict";var r=!1,n=!1,s=!1,a=!1,o=!1,p=!1,h=0,u=!1,f=!1,d=!1,c=!1,l=!1,v=new Float32Array(100),m=new Int16Array(100),y=new Uint16Array(100),g=new Uint8Array(100),x=206,B=177,A=178,I=155,b=255,C=80,w=81,S=82,P=83,M=84,F=85,T=86,R=87,U=88,O=89,G=119,N=156,E=157,V=160,D=1,L=2,_=1,k=2,j=4,z=8,W=16,H=0,X=!1,Y=0,q=0,Q=(new Map([["segoeuiz.ttf",{fontName:"Segoe UI",italic:!0,bold:!0}],["segoeui.ttf",{fontName:"Segoe UI",italic:!1,bold:!1}],["segoeuib.ttf",{fontName:"Segoe UI ",italic:!1,bold:!0}],["segoeuii.ttf",{fontName:"Segoe UI ",italic:!0,bold:!1}],["seguisb.ttf",{fontName:"Segoe UI Semibold",italic:!1,bold:!1}],["DSISO1.otf",{fontName:"DS ISO 1",italic:!1,bold:!1}],["DSISO1I.otf",{fontName:"DS ISO 1",italic:!0,bold:!1}],["DSISO1BI.otf",{fontName:"DS ISO 1",italic:!0,bold:!0}],["DSISO1B.otf",{fontName:"DS ISO 1",italic:!1,bold:!0}],["DroidSerif-Bold.ttf",{fontName:"Droid Serif",italic:!1,bold:!0}],["DroidSerif.ttf",{fontName:"Droid Serif",italic:!1,bold:!1}],["DroidSerif-Italic.ttf",{fontName:"Droid Serif",italic:!0,bold:!1}],["3ds Bold Italic.ttf",{fontName:"3ds",italic:!0,bold:!0}],["3ds Bold.ttf",{fontName:"3ds",italic:!1,bold:!0}],["3ds Italic.ttf",{fontName:"3ds",italic:!0,bold:!1}],["3ds Regular.ttf",{fontName:"3ds",italic:!1,bold:!1}]]),0),J=1,Z=2,K=3,$=4,ee=5,te=6,re=7,ie=8,ne={NEAREST:0,LINEAR:1,NEAREST_MIPMAP_NEAREST:2,NEAREST_MIPMAP_LINEAR:3,LINEAR_MIPMAP_NEAREST:4,LINEAR_MIPMAP_LINEAR:5},se=1,ae=2,oe=3,pe=5,he=6,ue={LAYER_MAX:4294967295,LAYER_MAX_MINUS_ONE:4294967294,STREAM_NONE:0,STREAM_MATERIAL:1,STREAM_INHERIT_INT:2,STREAM_INHERIT_UINT:4,STREAM_INHERIT_ULONG:8,STREAM_LAYER_INT:16,STREAM_LAYER_UINT:32,STREAM_LAYER_ULONG:64,STREAM_UVTRANSFO:128,STREAM_MAPPING_INFO:256,STREAM_LIGHTMAP:512,STREAM_DECAL:1024,STREAM_ALL_INT:915,STREAM_ALL_UINT:933,STREAM_ALL_ULONG:969},fe=1,de=0,ce=1,le=3,ve=4,me=5,ye=6,ge=7,xe=function(){var e=[];return e[Q]=new Kn,e[Z]=new Kn,e[te]=new Kn,e[K]=new Kn,e[re]=new Kn,e[$]=new Kn,e[ee]=new Kn,e[J]=new Kn,e[ie]=new Kn,e},Be=function(r,i){this.name=i,this.conversion=!1,this.version=0,this.bitBoolean=0,this.bitPacking=0,this.intPacking=0,this.gasPacking=0,this.global_gas=[];var n=!0;this.expandCGR=!1;var s=[];this.isInherit=!1,this.idOrder=0,this.semanticType=0,this.multiRefReps=[],this.multiRefCount=0,this.textures=new Kn,this.materials=new Kn,this.batches=new Kn,this.fakeMultiRep=new Kn,this.reps=[xe()],this.currentDGs=[],this.currentAttr=null,this.mergeDGs=[],this.filterSceneGraphOrder=4278190216,this.infiniteGeometries=new Kn,this.advancedInheritance=new Kn,this.curvedPipes=new Kn,this.sgReps={nbRep:0,tab:[]},this.sgRep=[],this.nbRep=0,this.decorations=new multiTabDecorations,this.texts=new Kn,this.currentMatrix=[],this.flexibleMatrices=[],this.flexibleMatrixMode=!1,this.staticMode=[],this.fixedSizeMode=!1,this.multiRefNode=new Kn,this.buffer=r,this.numberOfVertices=0,this.cgrContainer=null,this.bitContainer=0,this.bitsRemaining=0,this.nbBitsPerVertex=0;var a=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215,33554431,67108863,134217727,268435455,536870911,1073741823,2147483647],o=0,p=[0,0,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9];this.isLightScenegraph=function(){return!1},this.setSemanticType=function(e){this.semanticType=e},this.getSemanticType=function(){return this.semanticType},this.createMatrix3=function(e){return[e[0],e[1],0,e[2],e[3],0,e[4],e[5],1]},this.pushReps=function(){this.reps.push(xe())},this.popReps=function(){return this.reps.pop()},this.mergeWithPreviousReps=function(){for(var e=this.reps.pop(),t=this.getCurrentReps(),r=0;r<e.length;r++)for(var i=e[r].getArray(),n=0;n<i.length;n++)t[r].add(i[n])},this.getAllReps=function(){var e=[],t=[];this.reps.length&&(t=this.reps[this.reps.length-1]);for(var r=0;r<t.length;r++)for(var i=t[r].getArray(),n=0;n<i.length;n++)e.push(i[n]);return e},this.finalizeMergeDGs=function(){this.currentDGs.sort(function(e,t){if(e.glType<t.glType)return-1;if(e.glType>t.glType)return 1;if(null==e.material&&null!=t.material)return-1;if(null!=e.material&&null==t.material)return 1;if(null!=e.material&&null!=t.material){if(e.material.id<t.material.id)return-1;if(e.material.id>t.material.id)return 1;if(e.material.file<t.material.file)return-1;if(e.material.file>t.material.file)return 1}if(null==e.gas&&null!=t.gas)return-1;if(null!=e.gas&&null==t.gas)return-1;if(null!=e.gas&&null!=t.gas){if(e.gas.set<t.gas.set)return 1;if(t.gas.set<e.gas.set)return-1;if(e.gas.rgba<t.gas.rgba)return 1;if(t.gas.rgba<e.gas.rgba)return-1;if(e.gas.webOverride<t.gas.webOverride)return 1;if(t.gas.webOverride<e.gas.webOverride)return-1}if(e._geomType&&t._geomType){if(e._geomType<t._geomType)return-1;if(e._geomType>t._geomType)return 1}return 0});for(var e=0;e<this.currentDGs.length;e++)this.mergeDGs.push(this.currentDGs[e]);this.currentDGs=[],this.currentAttr=null},this.setDGs=function(e){for(var t=0;t<e.length;t++){var r=e[t];if(this.currentDGs.length){var i=this.currentAttr.material;if((null==i&&null==r.material||null!=i&&null!=r.material&&i.id==r.material.id&&i.file==r.material.file)&&(r.gas.set&this.filterSceneGraphOrder)==this.currentAttr.set&&r.gas.rgba==this.currentAttr.rgba)this.currentDGs.push(r);else{this.currentDGs.sort(function(e,t){if(e.glType<t.glType)return-1;if(e.glType>t.glType)return 1;if(null==e.material&&null!=t.material)return-1;if(null!=e.material&&null==t.material)return 1;if(null!=e.material&&null!=t.material){if(e.material.id<t.material.id)return-1;if(e.material.id>t.material.id)return 1;if(e.material.file<t.material.file)return-1;if(e.material.file>t.material.file)return 1}if(null==e.gas&&null!=t.gas)return-1;if(null!=e.gas&&null==t.gas)return-1;if(null!=e.gas&&null!=t.gas){if(e.gas.set<t.gas.set)return 1;if(t.gas.set<e.gas.set)return-1;if(e.gas.rgba<t.gas.rgba)return 1;if(t.gas.rgba<e.gas.rgba)return-1}if(e._geomType&&t._geomType){if(e._geomType<t._geomType)return-1;if(e._geomType>t._geomType)return 1}return 0});for(var n=0;n<this.currentDGs.length;n++)this.mergeDGs.push(this.currentDGs[n]);this.currentDGs=[],this.currentDGs.push(r),this.currentAttr={mat:r.material,gas:r.gas}}}else this.currentDGs.push(r),this.currentAttr={mat:r.material,gas:r.gas}}},this.addReps=function(e,t,r,i,n){var s=(i?1:0)<<1|(t?1:0);return n&&(s=8),this.expandCGR&&(s=0),0==s&&1==h&&this.setDGs(e.drawingGroups),{renderType:s,indice:this.getCurrentReps()[s].add(e)}},this.getCurrentReps=function(){return this.reps[this.reps.length-1]},this.getReps=function(e,t){return this.getCurrentReps()[t].get(e)},this.getBytesRemain=function(){return this.buffer.getBytesRemain()},this.readString=function(e){for(var t=new String,r=0;r<e;r++){t+=String.fromCharCode(this.buffer.read())}return t},this.readStringWithLength=function(e){for(var t=new String,r=(e=this.readCompressedInt(),0);r<e;r++){t+=String.fromCharCode(this.buffer.read())}return t},this.readUnicodeString=function(e){for(var t=new String,r=0;r<e-1;r++){var i=this.readUnsignedShort();t+=String.fromCharCode(i)}return this.readUnsignedShort(),t},this.setCurrentPosition=function(e){return!(this.buffer.buffer&&e>this.buffer.buffer.length)&&(this.buffer.setPosition(e),!0)},this.getCurrentPosition=function(){return this.buffer.getCurrentPosition()},this.skip=function(e){this.buffer.setPosition(this.buffer.getCurrentPosition()+e)},this.readClassName=function(){return this.readUnsignedChar()},this.getUnstreamer=function(e){switch(e){case 97:return new Mt;case 98:return new Li;case 99:return new Ct;case 100:return new ft;case 101:return new xt;case 102:return new zi;case 103:return new wi;case 104:return new Tt;case 112:return new Hi;case 113:return new dt;case 114:return new Bt;case 115:return new Pt;case 116:return new At;case 120:return new gt;case 137:return new Wi;case 145:case 146:return new wi;case 147:return new nn;case 148:return new wi;case 149:return new mt;case 150:return new wi;case 152:return new an;case 153:return new Ft;case 154:return new on;case 158:return new It;case 159:return new bt;case 161:return new Rt;case 163:return new rn;case 170:return new St;case 171:return new wt;case 172:return new Ut;case 173:return new Ot;case 174:return new Nt;case 175:return new Et;case 176:return new Gt;case 179:return new cn;case 181:return new wi;case 182:return new yn;case 183:return new ln;case 184:return new hn;case 185:return new _i;case 186:return new ki;case 188:return new wi;case 189:return new ji;case 192:return new In;case 193:return new bn;case 194:return new Cn;case 195:return new wn;case 196:return new Sn;case 197:return new Pn;case 198:return new Mn;case 199:return new Fn;case 201:return new Tn;case 202:return new pn;case 203:return new mn;case 204:return new sn;case 205:return new dn;case 206:return new CATAdvancedLayerOverrideFilter;case 207:return new fn;case 208:return new un;case 255:return new Ci;default:return this.error="file is corrupted.  unknown className..."+e,null}},this.readGraphicAttributeSet=function(){return new e.GraphicAttributeSet(this.readUncompressedInt(),this.readUncompressedInt())},this.readMatrix=function(){var e=[],r=0;if(this.version>=210021610){var i=this.readCompressedInt(),n=this.readUnsignedChar(),s=[];this.readDoubles(s,n);var a=0;for(r=0,a=0;r<16;r++)switch((i&3<<2*r)>>2*r){case 0:e[r]=s[a++];break;case 1:case-1:e[r]=0;break;case-2:case 2:e[r]=1;break;case 3:case-3:e[r]=-1}}else for(r=0;r<16;++r)e.push(this.readFloat());var o=new t.Matrix4;return o.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]),o},this.read2DMatrix=function(){var e=[],r=0;for(r=0;r<16;++r)e.push(this.readFloat());var i=new t.Matrix4;return i.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]),i},this.readFloatArray=function(e,t,r){this.buffer.readFloatArray(e,t,r,this.conversion)},this.readFloatArrayBuffer=function(e,t){this.buffer.readFloatArrayBuffer(e,t,this.conversion)},this.readUnsignedShortArray=function(e,t,r){this.buffer.readUnsignedShortArray(e,t,r,!0)},this.readUnsignedShortArrayBuffer=function(e,t){this.buffer.readUnsignedShortArrayBuffer(e,t,this.conversion)},this.readDouble=function(){return this.buffer.readDouble(this.conversion)},this.readDoubles=function(e,t){for(var r=0;r<t;++r)e.push(this.readDouble())},this.getNumberOfVertices=function(){return this.numberOfVertices},this.setNumberOfVertices=function(e){if(this.numberOfVertices=e,this.bitPacking){if(e<500)return void(o=p[this.numberOfVertices]);o=0;var t=e;do{++o}while(t>>=1)}},this.setContainer=function(e){this.cgrContainer=e},this.getContainer=function(){return this.cgrContainer},this.readBits=function(e){var t;if(e<=this.bitsRemaining)t=this.bitContainer&a[e],this.bitContainer>>=e,this.bitsRemaining-=e;else if(e<=32){t=0;var r=e;t|=this.bitContainer&a[this.bitsRemaining],r-=this.bitsRemaining,this.bitContainer=this.readUncompressedInt(),t|=(this.bitContainer&a[r])<<this.bitsRemaining,this.bitContainer>>=r,this.bitsRemaining=32-r}else{var i=0;r=e;do{for(;this.bitsRemaining&&r;)t|=(1&this.bitContainer)<<i++,bitContainer>>=1,this.bitsRemaining--,r--;r&&(this.bitContainer=this.readUncompressedInt(),this.bitsRemaining=32)}while(r)}return t},this.readBit=function(){var e=0;return this.bitsRemaining?(e=1&this.bitContainer,this.bitContainer>>=1,this.bitsRemaining--,e):(this.bitContainer=this.readUncompressedInt(),e=1&this.bitContainer,this.bitContainer>>=1,this.bitsRemaining=31,e)},this.readBoolean=function(){return this.bitBoolean?this.readBit():this.readUnsignedChar()},this.readPositions=function(e,t,r){var i=3*e;if(this.readBoolean())this.readFloatArray(i,3*t,r);else{var n=Math.ceil(t/4),s=this.buffer.getByteView(n,g),a=this.readCompressedInt();a>v.length&&(v=new Float32Array(a)),this.readFloatArrayBuffer(a,v);for(var o=0,p=0,h=0,u=0,f=0,d=0,c=0,l=0;l<t;l++){0==p&&(c=3&s[o]),1==p&&(c=(12&s[o])>>2),2==p&&(c=(48&s[o])>>4),3==p&&(c=(192&s[o])>>6,p=-1,o++),p++;0==c?(r[i++]=v[h],r[i++]=v[h+1],r[i++]=v[h+2],u=v[h],f=v[h+1],d=v[h+2],h+=3):2==c?(r[i++]=u,r[i++]=f,r[i++]=v[h],d=v[h],h++):3==c?(r[i++]=u,r[i++]=v[h],r[i++]=v[h+1],f=v[h],d=v[h+1],h+=2):(r[i++]=u,r[i++]=f,r[i++]=d)}}},this.readQuantPositions=function(e,t){var r=0;if(this.readBoolean())this.readUnsignedShortArray(0,3*e,t);else{var i=Math.ceil(e/2),n=this.buffer.getByteView(i,g),s=this.readCompressedInt();s>y.length&&(y=new Uint16Array(s)),this.readUnsignedShortArrayBuffer(s,y);for(var a=0,o=0,p=0,h=0,u=0,f=0,d=0,c=0;c<e;c++){0==o&&(d=3&n[a]),1==o&&(d=(12&n[a])>>2),2==o&&(d=(48&n[a])>>4),3==o&&(d=(192&n[a])>>6,o=-1,a++),o++;0==d?(t[r++]=y[p],t[r++]=y[p+1],t[r++]=y[p+2],h=y[p],u=y[p+1],f=y[p+2],p+=3):2==d?(t[r++]=h,t[r++]=u,t[r++]=y[p],f=y[p],p++):3==d?(t[r++]=h,t[r++]=y[p],t[r++]=y[p+1],u=y[p],f=y[p+1],p+=2):(t[r++]=h,t[r++]=u,t[r++]=f)}}},this.readOldPositionsArrayBuffer=function(e,t,r){if(this.readBoolean())for(var i=0;i<e;++i)t[r++]=this.readFloat();else{var n=Math.ceil(e/12),s=new Uint8Array(n);this.readBytes(n,s);var a=this.readCompressedUInt(),o=new Float32Array(a);for(i=0;i<a;++i)o[i]=this.readFloat();var p=0,h=0,u=0,f=0,d=0,c=0;for(i=0;i<e/3;i++){0==h&&(flagvalue=3&s[p]),1==h&&(flagvalue=(12&s[p])>>2),2==h&&(flagvalue=(48&s[p])>>4),3==h&&(flagvalue=(192&s[p])>>6,h=-1,p++),h++;var l=3*i;0==flagvalue?(t[3*r+l]=o[u],t[3*r+l+1]=o[u+1],t[3*r+l+2]=o[u+2],f=o[u],d=o[u+1],c=o[u+2],u+=3):2==flagvalue?(t[3*r+l]=f,t[3*r+l+1]=d,t[3*r+l+2]=o[u],c=o[u],u++):3==flagvalue?(t[3*r+l]=f,t[3*r+l+1]=o[u],t[3*r+l+2]=o[u+1],d=o[u],c=o[u+1],u+=2):(t[3*r+l]=f,t[3*r+l+1]=d,t[3*r+l+2]=c)}}},this.readPositionsArrayBuffer=function(e,t,r){if(this.readBoolean())for(var i=0;i<3*e;++i)t[3*r+i]=this.readFloat();else{var n=Math.ceil(e/4),s=new Uint8Array(n);this.readBytes(n,s);var a=this.readCompressedInt(),o=new Float32Array(a);for(i=0;i<a;++i)o[i]=this.readFloat();var p=0,h=0,u=0,f=0,d=0,c=0,l=0;for(i=0;i<e;i++){0==h&&(l=3&s[p]),1==h&&(l=(12&s[p])>>2),2==h&&(l=(48&s[p])>>4),3==h&&(l=(192&s[p])>>6,h=-1,p++),h++;var v=3*i;0==l?(t[3*r+v]=o[u],t[3*r+v+1]=o[u+1],t[3*r+v+2]=o[u+2],f=o[u],d=o[u+1],c=o[u+2],u+=3):2==l?(t[3*r+v]=f,t[3*r+v+1]=d,t[3*r+v+2]=o[u],c=o[u],u++):3==l?(t[3*r+v]=f,t[3*r+v+1]=o[u],t[3*r+v+2]=o[u+1],d=o[u],c=o[u+1],u+=2):(t[3*r+v]=f,t[3*r+v+1]=d,t[3*r+v+2]=c)}}},this.readNormalsArrayBuffer=function(e,t,r){if(0!=e){var i=1/32767;if(this.version>1101220){var n=this.readCompressedInt();n>m.length&&(m=new Int16Array(n)),this.buffer.readShortArrayBuffer(n,m,this.conversion),(v=Math.ceil(e/2))>g.length&&(g=new Uint8Array(v));for(var s=this.buffer.getByteView(v,g),a=-1,o=0,p=0,h=0,u=3*e,f=3*r,d=0;d<u;d++){switch(d%2?(240&s[a])>>4:15&s[++a]){case 0:p=t[f+1]=m[o++]*i,h=t[f+2]=m[o++]*i,t[f]=Math.sqrt(1-(p*p+h*h));break;case 1:p=t[f+1]=m[o++]*i,h=t[f+2]=m[o++]*i,t[f]=-Math.sqrt(1-(p*p+h*h));break;case 2:p=t[f]=m[o++]*i,h=t[f+2]=m[o++]*i,t[f+1]=Math.sqrt(1-(p*p+h*h));break;case 3:p=t[f]=m[o++]*i,h=t[f+2]=m[o++]*i,t[f+1]=-Math.sqrt(1-(p*p+h*h));break;case 4:p=t[f]=m[o++]*i,h=t[f+1]=m[o++]*i,t[f+2]=Math.sqrt(1-(p*p+h*h));break;case 5:p=t[f]=m[o++]*i,h=t[f+1]=m[o++]*i,t[f+2]=-Math.sqrt(1-(p*p+h*h));break;case 6:t[f]=1,t[f+1]=0,t[f+2]=0;break;case 7:t[f]=-1,t[f+1]=0,t[f+2]=0;break;case 8:t[f]=0,t[f+1]=1,t[f+2]=0;break;case 9:t[f]=0,t[f+1]=-1,t[f+2]=0;break;case 10:t[f]=0,t[f+1]=0,t[f+2]=1;break;case 11:t[f]=0,t[f+1]=0,t[f+2]=-1}f+=3}}else{var c=[],l=(i=1/32767,e/3);this.readShortArray(2*l,c);var v=Math.ceil(l/8);s=new Uint8Array(v);s=this.buffer.getByteView(v,g);var y,x,B=0,A=(a=-1,0);for(o=0,d=0;A<e;A+=3,o+=2,d++){var I;if(t[A]=c[o]*i,t[A+1]=c[o+1]*i,0==(B=d%8)&&a++,(x=1-(t[A]*t[A]+t[A+1]*t[A+1]))<=0)y=0;else for(p=x<=.03?.05:.25+x*(.25+1/(1+x));;){if((I=p-(y=.5*(p+x/p)))<i&&I>-i){p=y;break}p=y}t[A+2]=s[a]&1<<B?-y:y}}}},this.readNormals=function(e,t,r){var i=3*e;if(0!=t){if(this.version>1101220){var n=this.readCompressedInt();n>m.length&&(m=new Int16Array(n)),this.buffer.readShortArrayBuffer(n,m,this.conversion);var s=Math.ceil(t/2);s>g.length&&(g=new Uint8Array(s));for(var a=this.buffer.getByteView(s,g),o=-1,p=0,h=0,u=0,f=3*t,d=0;d<f/3;d++){switch(d%2?(240&a[o])>>4:15&a[++o]){case 0:h=m[p++]*(1/32767),u=m[p++]*(1/32767),r[i++]=Math.sqrt(1-(h*h+u*u)),r[i++]=h,r[i++]=u;break;case 1:h=m[p++]*(1/32767),u=m[p++]*(1/32767),r[i++]=-Math.sqrt(1-(h*h+u*u)),r[i++]=h,r[i++]=u;break;case 2:h=m[p++]*(1/32767),u=m[p++]*(1/32767),r[i++]=h,r[i++]=Math.sqrt(1-(h*h+u*u)),r[i++]=u;break;case 3:h=m[p++]*(1/32767),u=m[p++]*(1/32767),r[i++]=h,r[i++]=-Math.sqrt(1-(h*h+u*u)),r[i++]=u;break;case 4:h=m[p++]*(1/32767),u=m[p++]*(1/32767),r[i++]=h,r[i++]=u,r[i++]=Math.sqrt(1-(h*h+u*u));break;case 5:h=m[p++]*(1/32767),u=m[p++]*(1/32767),r[i++]=h,r[i++]=u,r[i++]=-Math.sqrt(1-(h*h+u*u));break;case 6:r[i++]=1,r[i++]=0,r[i++]=0;break;case 7:r[i++]=-1,r[i++]=0,r[i++]=0;break;case 8:r[i++]=0,r[i++]=1,r[i++]=0;break;case 9:r[i++]=0,r[i++]=-1,r[i++]=0;break;case 10:r[i++]=0,r[i++]=0,r[i++]=1;break;case 11:r[i++]=0,r[i++]=0,r[i++]=-1}3}}}},this.readOctNormals=function(e,t){if(0!=e&&this.version>1101220){var r=this.readUncompressedULong();this.readBytes(r,t)}},this.readTextures=function(e,t,r,i){var n=r*t;if(3!=r){var s=0,a=0,o=new Float32Array(n);if(this.readFloatArray(0,n,o),1==r)for(s=0;s<n;s++)i[3*e+a++]=o[s],i[3*e+a++]=0,i[3*e+a++]=0;else if(2==r)for(s=0;s<n;s+=2)i[3*e+a++]=o[s],i[3*e+a++]=o[s+1],i[3*e+a++]=0}else this.readFloatArray(3*e,n,i)},this.unpackcArray=function(e,t,r){if(this.bitPacking)for(var i=0;i<e;++i)t[i+r]=this.readBits(o);else if(this.version>=1100600&&this.numberOfVertices<256)this.buffer.readBytes(r,e,t);else if(this.numberOfVertices<65536)this.buffer.readUnsignedShortArray(r,e,t,!1);else if(this.numberOfVertices<16777216)this.buffer.unpackc24(r,e,t);else for(i=0;i<e;++i)t[i+r]=this.readCompressedInt()},this.unpackc=function(){return this.bitPacking?this.readBits(o):this.version>=1100600&&this.numberOfVertices<256?this.readUnsignedChar():this.numberOfVertices<65536?this.readUnsignedChar()<<8&65280|255&this.readUnsignedChar():this.numberOfVertices<16777216?this.readUnsignedChar()<<16&16711680|this.readUnsignedChar()<<8&65280|255&this.readUnsignedChar():this.readCompressedInt()},this.getFixedMode=function(){return this.fixedSizeMode},this.setFixedMode=function(e){this.fixedSizeMode=e},this.getStaticMode=function(){if(this.staticMode.length){var e=this.staticMode[this.staticMode.length-1];if(e)return e}return null},this.pushStaticMode=function(e){null==e?this.staticMode.push(new t.Matrix4):this.staticMode.push(e)},this.popStaticMode=function(){this.staticMode.pop()},this.isASMColor=function(){return!!this.global_gas.length&&this.global_gas[this.global_gas.length-1].asmColor},this.getGAS=function(t){if(this.global_gas.length){var r=this.global_gas[this.global_gas.length-1].inherited,i=this.global_gas[this.global_gas.length-1].asmColor;return i&&t==e.ConnectivityTypeEnum.TRIANGLES&&(r.setRGBAColorRGBChannel(i[0],i[1],i[2]),r.setRGBAColorAlphaChannel(i[3])),r}},this.pushGAS=function(e,t){var r,i=0,n=null;if(this.global_gas.length){var s=this.global_gas[this.global_gas.length-1];if(i=s.inh_mode,r=s.inherited,n=s.asmColor,4&i){e.setColor(r.getColor());var a=r.getRGBAColor();e.setRGBAColorRGBChannel(a[0],a[1],a[2])}if(4096&i){a=r.getRGBAColor();e.setRGBAColorAlphaChannel(a[3])}16&i&&e.setLineThickness(r.getThickness()),64&i&&e.setLineType(r.getLineType());var o=r.isHidden();o&&e.setNoShow(o)}return 1024&t&&(n=e.getDisplayedColor()),this.global_gas.push({inh_mode:i|t,inherited:e,asmColor:n}),e},this.popGAS=function(){return this.global_gas.pop()},this.popMatId=function(){if(s.length>0){var e=s.pop();return e.inherit&&(this.isInherit=!1),e}return{file:"",id:-1}},this.pushMatId=function(e,t,r,i){var n=ue.LAYER_MAX,a=null;s.length>0&&(n=(p=s[s.length-1]).layer,a=p.rep);if(r!==n)if(r<n&&0!==t){var o=!0;1==this.isInherit&&(o=!1),this.isInherit=!0,s.push({file:e.file,id:e.id,inherit:o,layer:r,rep:i})}else{if(s.length>0)(p=s[s.length-1])&&s.push({file:p.file,id:p.id,inherit:!1,layer:p.layer,rep:p.rep})}else if(r==ue.LAYER_MAX_MINUS_ONE||a===i)if(2==t||1==t&&!this.isInherit){o=!0;1==this.isInherit&&(o=!1),this.isInherit=!0,s.push({file:e.file,id:e.id,inherit:o,layer:r,rep:i})}else if(this.isInherit||0!=t){if(s.length>0)(p=s[s.length-1])&&s.push({file:p.file,id:p.id,inherit:!1,layer:p.layer,rep:p.rep})}else s.push({file:"",id:-1,inherit:!1,layer:r,rep:i});else if(0!==t){o=!0;1==this.isInherit&&(o=!1),this.isInherit=!0,s.push({file:e.file,id:e.id,inherit:o,layer:r,rep:i})}else{var p;if(s.length>0)(p=s[s.length-1])&&s.push({file:p.file,id:p.id,inherit:!1,layer:p.layer,rep:p.rep})}},this.check=function(){0!=s.length&&console.warn("material stack length = "+s.length),0!=this.global_gas.length&&console.warn("GAS stack length = "+this.global_gas.length),0!=this.currentMatrix.length&&console.warn("currentMatrix stack length = "+this.currentMatrix.length)},this.flexibleMatrices=[],this.batch=function(e,r){this.batches.getCurrentIndex();var i=e.length?e[0]:e;if(!i.alreadyprocessed){i.alreadyprocessed=!0;var n=this.batches.add(kn.processAllReps(r,this.materials.getArray(),null,this.sgReps,!0));i.node.batchIndex=n,i.node.typeGeom=t._InfiniteGeomertryType.TESSELATION}},this.pushFlexibleBatchingContext=function(e){var t=this.getCurrentMatrix();e.externalPath||(e.node.externalMatrix=t,e.externalPath=!0),this.pushReps(),this.pushFlexibleMatrix(null)},this.popFlexibleBatchingContext=function(e){var t=this.popReps();e&&this.batch(e,t)},this.pushFlexibleMatrix=function(e){this.popMatrix(),this.pushMatrix(null)},this.popFlexibleMatrix=function(){return this.popMatrix()},this.pushMatrix=function(e){var r=this.currentMatrix;this.flexibleMatrixMode&&this.flexibleMatrices.length&&(r=this.flexibleMatrices[this.flexibleMatrices.length-1]);var i,n=r[r.length-1];return null==n?i=e:(i=new t.Matrix4).multiplyMatrices(n,e),r.push(i),i},this.popMatrix=function(){var e=this.currentMatrix;return this.flexibleMatrixMode&&this.flexibleMatrices.length&&(e=this.flexibleMatrices[this.flexibleMatrices.length-1]),e.pop()},this.getLightDataStreaming=function(){return n},this.setLightDataStreaming=function(e){n=e},this.copyStreamerInheritance=function(e){e.setLightDataStreaming(this.getLightDataStreaming()),e.conversion=this.conversion,e.version=this.version,e.global_gas=this.global_gas,e.textures=this.textures,e.materials=this.materials,e.decorations=this.decorations,e.additionalReps=this.additionalReps,e.useAdditionalReps=this.useAdditionalReps,e.advancedInheritance=this.advancedInheritance,e.sgReps=this.sgReps,e.currentDGs=this.currentDGs,e.mergeDGs=this.mergeDGs,e.currentAttr=this.currentAttr},this.getCurrentFlexibleMatrix=function(){if(this.flexibleMatrixMode&&this.flexibleMatrices.length){var e=this.flexibleMatrices[this.flexibleMatrices.length-1];if(0!=e.length)return e[e.length-1]}return null},this.getCurrentMatrix=function(){return 0!=this.currentMatrix.length?this.currentMatrix[this.currentMatrix.length-1]:null},this.getCurrentMatId=function(){var e=s[s.length-1];return e?{file:e.file,id:e.id}:null}};Be.prototype.readFloat=function(){return this.buffer.readFloat(this.conversion)},Be.prototype.readUnsignedChar=function(){return this.buffer.read()},Be.prototype.readBytes=function(e,t){for(var r=0;r<e;r++)t[r]=this.buffer.read()},Be.prototype.optimizedReadBytes=function(e,t){this.buffer.readBytes(0,e,t)},Be.prototype.readShortArray=function(e,t){this.buffer.readShortArray(0,e,t,this.conversion)},Be.prototype.readUnsignedShort=function(){return this.conversion?this.buffer.read()<<8|this.buffer.read():this.buffer.read()|this.buffer.read()<<8},Be.prototype.readShort=function(){var e=this.buffer.read(),t=this.buffer.read();if(this.conversion){var r=(127&e)<<8|t;return r-=(128&e)<<8}r=(127&t)<<8|e;return r-=(128&t)<<8},Be.prototype.readUncompressedULong=function(){return this.buffer.readUncompressedULong(this.conversion)},Be.prototype.readUncompressedUInt=function(){return this.buffer.readUncompressedInt(this.conversion)},Be.prototype.readUncompressedInt=function(){return this.buffer.readInt(this.conversion)},Be.prototype.readUncompressedIntArray=function(e,t){for(var r=0;r<e;r++)t[r]=this.readUncompressedInt()},Be.prototype.readCompressedUInt=function(){if(this.intPacking)return this.readCompressedInt();if(this.version>=1101410){var e=this.readUnsignedChar();return 255==e?this.buffer.readInt(this.conversion):e}return this.buffer.readInt(this.conversion)},Be.prototype.readCompressedInt=function(){if(this.version>=1100600){var e=this.buffer.read();return e<255?e:this.buffer.readInt(this.conversion)}return this.buffer.readInt(this.conversion)};var Ae=function(e){e.readUncompressedInt(!1),e.readUncompressedInt(!1);e.readUncompressedInt(!1);e.readUncompressedInt(!1);if((4294967295&e.readUncompressedInt(!1))<<32,Nn){e.readUncompressedInt(!1);(4294967295&e.readUncompressedInt(!1))<<32;e.readUncompressedInt(!1);(4294967295&e.readUncompressedInt(!1))<<32;e.readUncompressedInt(!1),e.readUncompressedInt(!1),e.readUncompressedInt(!1),e.readUncompressedInt(!1),e.readUncompressedInt(!1);var t=new Uint8Array(8);e.readBytes(8,t),e.readUncompressedInt(!1),e.readUncompressedInt(!1)}},Ie=function(e){this.offset=e.readUncompressedInt(!1),this.length=e.readUncompressedInt(!1);e.readUncompressedInt(!1);this.beginPos=e.readUncompressedInt(!1);e.readUncompressedInt(!1)},be=function(e,t){e.readUncompressedInt(!1);this.id=e.readUncompressedInt(!1);e.readUnsignedShort(!1),new Ae(e);var r=e.readUncompressedInt(!1);this.blocs=[];var i=[];if(r>0)for(var n=0;n<r;++n)this.blocs.push(new Ie(e));if(t>0){e.readUncompressedInt(!1),e.readUncompressedInt(!1);for(n=0;n<t;++n)i.push(new Rn(e))}this.getRootTocEntry=function(){for(var e=0;e<i.length;++e){i[e].fatherId;if(0==i[e].fatherId)return i[e]}},this.getChildEntryByFatherId=function(e,t){for(var r=0;r<i.length;++r)if(i[r].fatherId==e&&i[r].name==t)return i[r]},this.getChildEntry=function(e,t){return this.getChildEntryByFatherId(e.getId(),t)}},Ce=0,we=1,Se=-1159921408,Pe=-86375937,Me=122298,Fe=-16655622,Te=-86376192,Re=121594,Ue=-86376177,Oe=251779834,Ge=6,Ne=7,Ee=8,Ve=9,De=1,Le=2,_e=3,ke=4,je=function(e,t,r){this._xSize=e,this._ySize=t,this._format=r,this.unstream=function(e,t){var r,i,n,s,a=1,o=1;e.conversion;s=e.readCompressedInt();var p=se;if(s==Se||s==Me?r=e.readCompressedInt():s==Pe||s==Fe?r=e.readCompressedInt():s==Te||s==Re||s==Ue||s==Oe||(r=s),s!=Te&&s!=Re&&s!=Ue&&s!=Oe){i=e.readCompressedInt(),C=e.readCompressedInt(),n=e.readCompressedInt();e.readCompressedInt();if(a=e.readFloat(),o=e.readFloat(),0==n)return null;S=new Uint8Array(C),e.readBytes(C,S)}else{switch(e.readCompressedInt()){case De:return r=e.readCompressedInt(),i=e.readCompressedInt(),C=e.readCompressedInt(),n=e.readCompressedInt(),e.readCompressedInt(),a=e.readFloat(),o=e.readFloat(),-1;case Le:if(r=e.readCompressedInt(),i=e.readCompressedInt(),C=e.readCompressedInt(),n=e.readCompressedInt(),e.readCompressedInt(),a=e.readFloat(),o=e.readFloat(),4!=n)return null;n=0,S=new Uint8Array(r*i);for(var h=[0,1,2,3,new Map([[7,2],[8,3],[11,4],[12,5],[14,6],[15,7]]),new Map([[19,8],[20,9],[7,10],[8,11],[27,64],[18,128]]),new Map([[24,1664],[23,192],[8,12],[3,13],[52,14],[53,15],[42,16],[43,17],[7,1]]),new Map([[39,18],[12,19],[8,20],[23,21],[3,22],[4,23],[40,24],[43,25],[19,26],[36,27],[24,28],[55,256]]),new Map([[53,0],[2,29],[3,30],[26,31],[27,32],[18,33],[19,34],[20,35],[21,36],[22,37],[23,38],[40,39],[41,40],[42,41],[43,42],[44,43],[45,44],[4,45],[5,46],[10,47],[11,48],[82,49],[83,50],[84,51],[85,52],[36,53],[37,54],[88,55],[89,56],[90,57],[91,58],[74,59],[75,60],[50,61],[51,62],[52,63],[54,320],[55,384],[100,448],[101,512],[104,576],[103,640]]),new Map([[204,704],[205,768],[210,832],[211,896],[212,960],[213,1024],[214,1088],[215,1152],[216,1216],[217,1280],[218,1344],[219,1408],[152,1472],[153,1536],[154,1600],[155,1728]]),new Map([[15,64],[55,0],[23,16],[24,17],[8,18]]),new Map([[8,1792],[12,1856],[13,1920]]),new Map([[18,1984],[19,2048],[20,2112],[21,2176],[22,2240],[23,2304],[28,2368],[29,2432],[30,2496],[31,2560]])],u=[0,1,new Map([[3,2],[2,3]]),new Map([[3,4],[2,1]]),new Map([[3,5],[2,6]]),new Map([[3,7]]),new Map([[5,8],[4,9]]),new Map([[4,10],[5,11],[7,12]]),new Map([[4,13],[7,14]]),new Map([[24,15]]),new Map([[15,64],[23,16],[24,17],[8,18],[55,0]]),new Map([[8,1792],[12,1856],[13,1920],[103,19],[104,20],[108,21],[55,22],[40,23],[23,24],[24,25]]),new Map([[18,1984],[19,2048],[20,2112],[21,2176],[22,2240],[23,2304],[28,2368],[29,2432],[30,2496],[31,2560],[202,26],[203,27],[204,28],[205,29],[104,30],[105,31],[106,32],[107,33],[210,34],[211,35],[212,36],[213,37],[214,38],[215,39],[108,40],[109,41],[218,42],[219,43],[84,44],[85,45],[86,46],[87,47],[100,48],[101,49],[82,50],[83,51],[36,52],[55,53],[56,54],[39,55],[40,56],[88,57],[89,58],[43,59],[44,60],[90,61],[102,62],[103,63],[200,128],[201,192],[91,256],[51,320],[52,384],[53,448]]),new Map([[108,512],[109,576],[74,640],[75,704],[76,768],[77,832],[114,896],[115,960],[116,1024],[117,1088],[118,1152],[119,1216],[82,1280],[83,1344],[84,1408],[85,1472],[90,1536],[91,1600],[100,1664],[101,1728]])],f=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191],d=[4096,6144,7168,7680,7936,8064,8128,8160,8176,8184,8188,8190,8191],c=function(e,t,r){var i,n=0,s=0,a=Math.floor(r/8),o=r%8;if(t.length<a)return null;i=t[a],t.length>a+1&&(n=t[a+1]),t.length>a+2&&(s=t[a+2]);var p=e?h:u,c=e?4:2,l=0,v=0;if(o>3){v=((i&f[8-o])<<5+o)+(m=n<<o-3)+(s>>11-o)}else{var m=n;o<3&&(m=n>>3-o),v=((i&f[8-o])<<5+o)+m}for(;c<14;){var y=(v&d[c-1])>>13-c;if(null!=(l=p[c].get(y)))break;c++}return c<14?{runLength:l,codeLength:c}:null},l=0;l<i;l++){var v=!0,m=e.readCompressedInt();if(!(m>0))return null;var y=new Uint8Array(m);e.optimizedReadBytes(m,y);for(var g=0,x=0,B=0;g<r;){var A=c(v,y,x);if(!A)return null;if(B+=A.runLength,x+=A.codeLength,!(A.runLength>63)){for(var I=v?255:0,b=0;b<B;b++)S[l*r+g+b]=I;v=!v,g+=B,B=0}}}break;case _e:var C;if(r=e.readCompressedInt(),i=e.readCompressedInt(),C=e.readCompressedInt(),n=e.readCompressedInt(),e.readCompressedInt(),a=e.readFloat(),o=e.readFloat(),!(s!=Ue&&s!=Oe||n!=Ge&&n!=Ne&&n!=Ee&&n!=Ve))e.readCompressedInt();S=new Uint8Array(C),e.readBytes(C,S);break;case ke:p=oe,r=e.readCompressedInt(),i=e.readCompressedInt();var w=e.readCompressedInt();n=e.readCompressedInt(),e.readCompressedInt(),a=e.readFloat(),o=e.readFloat();var S=new Uint8Array(w);if(!w)return null;e.optimizedReadBytes(w,S)}}return{img:S,width:r,height:i,format:n,url:t,xPixelSize:a,yPixelSize:o,imgType:p}}},ze=function(e,t,r){je.call(this,e,t,r)};(ze.prototype=Object.create(je.prototype)).constructor=je;var We=function(){this.createTexture=function(e,t){var r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1,url:t,imgType:ae};if(0==e.readCompressedInt()){e.readCompressedInt();if(r.mipmapCount=e.readCompressedUInt(),r.width=e.readCompressedUInt(),r.height=e.readCompressedUInt(),r.format=e.readCompressedInt(),0==r.mipmapCount)return!1;for(var i=r.width,n=r.height,s=1;s<=r.mipmapCount;s++){var a=(new je).unstream(e,t);if(3==r.format)return a;if(3==a.imgType)return a;r.mipmaps.push({data:a.img,width:a.width,height:a.height}),(n/=2)<1&&(n=1),(i/=2)<1&&(i=1)}}return r}},He=function(){this.unstream=function(e,t){var r=(new je).unstream(e,t);if(null===r)return null;var i=e.readStringWithLength().split("\\");t=i[i.length-1];return r.url=t,r}},Xe=function(){this.unstream=function(e,t){var r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1,url:t,imgType:ae};if(0==e.readCompressedInt()){var i=e.readCompressedInt();r.mipmapCount=e.readCompressedUInt(),r.width=e.readCompressedUInt(),r.height=e.readCompressedUInt(),r.format=e.readCompressedInt(),r.streamCmpFormat=i,0==r.mipmapCount&&0;for(var n=r.width,s=r.height,a=1;a<=r.mipmapCount;a++){var o=(new je).unstream(e,t);if(3==r.format)return o;r.mipmaps.push({data:o.img,width:o.width,height:o.height}),(s/=2)<1&&(s=1),(n/=2)<1&&(n=1)}}else 0;return r}},Ye=function(){this.unstream=function(t){var r=new e.Material;r._MaterialPropertiesActivate=t.readCompressedInt();var i=t.readFloat(),n=t.readFloat(),s=t.readFloat();r.colorAmbient[0]=i,r.colorAmbient[1]=n,r.colorAmbient[2]=s;var a=t.readFloat(),o=t.readFloat(),p=t.readFloat();r.colorDiffuse[0]=a,r.colorDiffuse[1]=o,r.colorDiffuse[2]=p;var h=t.readFloat(),u=t.readFloat(),f=t.readFloat();if(r.colorSpecular[0]=h,r.colorSpecular[1]=u,r.colorSpecular[2]=f,r.shininess=t.readFloat(),r.shininess*=255,r.ambientCoef=t.readFloat(),r.diffuseCoef=t.readFloat(),r.specularCoef=t.readFloat(),r.transparent=t.readFloat(),r.reflectivityCoef=t.readFloat(),t.version>=210042310)t.readBoolean();var d=t.version<2100190&&t.version>=21e5||t.version<1102110;if(t.readUnsignedChar())if(d){if(t.readUnsignedChar()){var c;if(c=t.readCompressedInt(),t.textures.isValidMultiRefIndex(c)){var l=t.textures.getIndex(c);r.textureId=l}else{var v=(new He).unstream(t),m=t.textures.add(v);t.textures.addMultiRefIndex(c,m),r.textureId=m}}else{v=(new He).unstream(t),m=t.textures.add(v);r.textureId=m}}else{var y,g=t.getContainer();if(g&&(y=g.getResourceCGRContainer()),y){m=y.getResource(t);r.textureId=m}}switch(r.textureImageNumberComposante=t.readCompressedInt(),r.textureBlending=t.readCompressedInt(),r.magFilter=t.readCompressedInt(),r.minFilter=t.readCompressedInt(),t.readCompressedInt()){case 0:r.mappingFunction="USER_MAPPING";break;case 3:r.mappingFunction="SPHERICAL_ENV_MAP"}if((r.textureWrapS=t.readCompressedInt(),r.textureWrapT=t.readCompressedInt(),r.addedComposantInTexEnv=t.readCompressedInt(),t.skip(76),!d)&&t.readUnsignedChar()){r.textureId=-1;var x=7==t.readCompressedInt(),B=new $e;B.unstream(t),B&&(r.shaderMaterial={name:B.name,param:B.parameters,PDSFX:x})}return r}},qe=function(){this.skip=function(e){this.unstream(e,!0)},this.unstreamTexture=function(e){var t=1,r=0,i=0;if(e.version>=210041930&&(i=e.readCompressedInt(),e.textures.isValidMultiRefIndex(i)&&(r=e.textures.getIndex(i),t=0)),t){var n=(new je).unstream(e);null!=n&&(r=e.textures.add(n)),n&&e.version>=210041930&&e.textures.addMultiRefIndex(i,r)}return r},this.unstream=function(e,t){var r=-1,i={};(i._MaterialPropertiesActivate=!0,t)||(i=(new Ye).unstream(e));var n=e.readStringWithLength();i.physicalMaterial=JSON.parse(n);var s=e.readCompressedUInt(),a=e.readCompressedUInt(),o=i.physicalMaterial.Version,p=0;if(i.physicalMaterial&&i.physicalMaterial.PhysicalMaterial&&i.physicalMaterial.PhysicalMaterial.MappingOperator&&i.physicalMaterial.PhysicalMaterial.MappingOperator.UvTransformation){var h=i.physicalMaterial.PhysicalMaterial.MappingOperator.UvTransformation;i.physicalMaterial.PhysicalMaterial.MappingOperator.UvTransformation=[h[0],h[1],h[2],h[4],h[5],h[6],h[8],h[9],h[10]]}o&&o>=3&&(p=e.readCompressedUInt());var u=e.readBoolean(),f=!1;o&&o>=.2&&(f=e.readBoolean());for(var d=0;d<s;d++){var c=!1;r=-1;var l=e.readStringWithLength();if(o>0&&(c=e.readBoolean()),(r=c?this.unstreamTexture(e):Ke(e))>=0)i.physicalMaterial.PhysicalMaterial.FloatParameter[l].Texture=r}for(d=s;d<a+s;d++){c=!1;r=-1;l=e.readStringWithLength();if(o>0&&(c=e.readBoolean()),(r=c?this.unstreamTexture(e):Ke(e))>=0)i.physicalMaterial.PhysicalMaterial.Float3Parameter[l].Texture=r}r=-1;var v=null;for(i.physicalMaterial.PhysicalMaterial&&i.physicalMaterial.PhysicalMaterial.MapParameter&&(v=i.physicalMaterial.PhysicalMaterial.MapParameter.normalMap),u&&(r=Ke(e))>=0&&(v?v.Texture=r:i.physicalMaterial.PhysicalMaterial.NormalMap.Texture=r),f&&Ke(e),d=0;d<p;d++){c=!1;r=-1;l=e.readStringWithLength();var m=i.physicalMaterial.PhysicalMaterial.MapParameter[l];o>0&&(c=e.readBoolean()),(r=c?this.unstreamTexture(e):Ke(e))>=0&&m&&(m.Texture=r)}return i}};const Qe=new Uint8Array([171,75,84,88,32,50,48,187,13,10,26,10]),Je=t.TextureBlendOperations;var Ze=function(){this.unstream=function(e){var t={};t._MaterialPropertiesActivate=!0;var r;if(r=e.readCompressedInt(),e.materials.isValidMultiRefIndexWithName(r,e.name))return null!==(w=e.materials.getIndexWithName(r,e.name))&&(t=e.materials.get(w)),t;var i=e.readStringWithLength(),n=JSON.parse(i);if(n.images&&n.textures){var s,a=e.getContainer();a&&(s=a.getResourceCGRContainer());var o=[];if(s)for(var p=0;p<n.images.length;p++){var h=s.getImage(e,n.images[p].byteOffset,n.images[p].byteOffset+n.images[p].byteLength);o.push(h)}var u=[];if(n.images&&n.images.length)for(p=0;p<n.images.length;p++)u.push(!1);var f=[];for(p=0;p<n.textures.length;p++){var d=!1,c=n.textures[p];if(u[c.image]&&(d=!0),u[c.image]=!0,h.imgType===pe){for(var l=new Uint8Array(h.img.buffer),v=!0,m=0;m<Qe.length;m++)if(l[m]!==Qe[m]){v=!1;break}v&&(h.imgType=he)}var y={noTransferable:d,mipmaps:(h=o[c.image]).mipmaps,format:h.format,height:h.height,width:h.width,img:h.img,imgType:h.imgType,wrap:[1,1],filter:[1,1]};if(c.uWrap&&"REPEAT"!=c.uWrap&&(y.wrap[0]=0),c.vWrap&&"REPEAT"!=c.vWrap&&(y.wrap[1]=0),c.magFilter&&(y.filter[1]=ne[c.magFilter]),c.minFilter&&(y.filter[0]=ne[c.minFilter]),c.uvTransform){var g=c.uvTransform;1==g[0]&&0==g[1]&&0==g[2]&&1==g[3]&&0==g[4]&&0==g[5]||(y.uvTransform=c.uvTransform)}var x=e.textures.add(y);f.push(x)}}var B=n.materials[0],A=t;if("Visu.Basic"==B.type){if(t.colorDiffuse=B.DiffuseColor,t.diffuseCoef=B.DiffuseCoeff,t.colorAmbient=B.AmbientColor,t.ambientCoef=B.AmbientCoeff,t.colorSpecular=B.SpecularColor,t.specularCoef=B.SpecularCoeff,t.reflectivityCoef=B.ReflectionCoeff,t.textureId=B.Texture?f[B.Texture.texture]:void 0,null!=t.textureId){var I=e.textures.get(t.textureId);t.minFilter=I.filter[0],t.magFilter=I.filter[1],t.textureWrapS=I.wrap[0],t.textureWrapT=I.wrap[1]}switch(B.TextureFunction){case 0:t.textureBlending=Je.MODULATE;break;case 1:t.textureBlending=Je.BLEND;break;case 2:t.textureBlending=Je.DECAL;break;case 3:t.textureBlending=Je.REPLACE;break;default:t.textureBlending=Je.KEEP_DEFAULT}t.textureMapping=B.TextureMapping,t.shininess=255*B.ShininessCoeff,t.transparency=B.TransparencyCoeff,t.alphaTest=.5*B.IsAlphaTestEnabled}else if("Visu.SpecularGlossiness"==B.type||"Visu.SpecularGlossiness@17x"==B.type||"Visu.SpecularGlossiness@21x"==B.type||"Visu.EVisuPBR"==B.type||"Visu.DSPBR@21x"==B.type||"Visu.DSPBR@22x"==B.type){for(var b in B){void 0!==(C=B[b]).texture&&(C.texture=f[C.texture])}t.physicalMaterial={},(t=t.physicalMaterial).PhysicalMaterial=B,t.PhysicalMaterial.isVisDescription=!0}else if("Visu.ShaderOverride"==B.type){for(var b in B){var C;void 0!==(C=B[b]).texture&&(C.imgId=f[C.texture])}t.shaderMaterial={name:B.shaderName,param:B,PDSFX:!0}}var w=e.materials.add(A);return e.materials.addMultiRefIndexWithName(r,w,e.name),A}},Ke=function(e){var t,r=-1,i=e.getContainer();i&&(t=i.getResourceCGRContainer());return t&&(r=t.getResource(e)),r},$e=function(){this.parameters={},this.name="",this.unstream=function(e){this.parametersUnstream(e);var t,r=e.getContainer();if(r&&(t=r.getResourceCGRContainer()),t)var i=t.getResourceShader(e);if(null===i)return null;i&&(this.name=i.name)},this.parametersUnstream=function(e){for(var t=e.readCompressedInt(),r=[],i=0;i<t;++i)r[i]=e.readStringWithLength();var n=e.readCompressedInt();for(i=0;i<n;++i){switch(e.readCompressedInt()){case 0:e.readCompressedInt();break;case 1:e.readCompressedInt();var s=e.readFloat(),a=r[i];this.parameters[a]=s;break;case 2:e.readCompressedInt();var o=[];e.readFloatArray(0,4,o);a=r[i];this.parameters[a]=o;break;case 4:e.readCompressedInt();var p,h=e.getContainer();h&&(p=h.getResourceCGRContainer());var u="";if(p){var f=p.getResource(e);On[f]&&On[f].url&&(u=On[f].url)}a=r[i];this.parameters[a]={imgId:f,url:u};break;case 5:case 6:e.readCompressedInt(),o=[];e.readFloatArray(0,4,o);a=r[i];this.parameters[a]=o}}}},et=function(){this.name="",this.unstream=function(e){var t=e.readStringWithLength(),r=t.lastIndexOf("\\");-1!==r&&(t=t.substring(r+1,t.length)),-1!==(r=t.lastIndexOf("."))&&(t=t.substring(0,r));var i=e.readCompressedInt();e.skip(i),this.name=t}},tt=function(){this.unstream=function(e){for(var t=[],r=0;r<2;r++){if(e.readUnsignedChar()){var i=0;if(e.readUnsignedChar())if(i=e.readCompressedInt(),e.materials.isValidMultiRefIndexWithName(i,e.name))t[r]=e.materials.getIndexWithName(i,e.name);else{var n=(1===(a=e.readCompressedInt())?new tt:new Ye).unstream(e);if(1===a)s=n;else var s=e.materials.add(n);e.materials.addMultiRefIndexWithName(i,s,e.name),t[r]=s}else{var a;n=(1===(a=e.readCompressedInt())?new tt:new Ye).unstream(e);s=1===a?n:e.materials.add(n),t[r]=s}}}return t[0]}},rt=function(){this.posBuffer=[],this.normalBuffer=[],this.textureBuffer=[],this.uvsBuffer=[],this.binormalsBuffer=[],this.tangentsBuffer=[],this.numberOfVertices=0};rt.prototype.getNumberOfVertices=function(){return this.numberOfVertices},rt.prototype.unstream=function(e){var t;this.numberOfVertices=e.readCompressedInt(),t=e.readCompressedInt(),this.hasTextures=e.readUnsignedChar(),this.hasUVs=e.readUnsignedChar(),this.hasTangentsBinormals=e.readUnsignedChar();var r=0;if(this.hasTextures&&(r=e.readUnsignedChar(),e.readTextures(0,this.numberOfVertices,r,this.textureBuffer)),this.numberOfVertices&&e.readPositions(0,this.numberOfVertices,this.posBuffer,0),t&&e.readNormals(0,t,this.normalBuffer,0),this.hasUVs&&this.numberOfVertices)if(f)e.readTextures(0,this.numberOfVertices,2,this.textureBuffer);else{var i=new Float32Array(2*this.numberOfVertices);e.readFloatArray(0,2*this.numberOfVertices,i)}if((this.hasTangentsBinormals&&(e.readFloatArray(0,3*this.numberOfVertices,this.tangentsBuffer),e.readFloatArray(0,3*this.numberOfVertices,this.binormalsBuffer)),e.version>=210041920)&&e.readUnsignedChar()){var n=e.readCompressedInt();if(n>0)for(var s=0;s<n;++s){var a=e.readUnsignedChar();e.readStringWithLength();e.skip(4*a*this.numberOfVertices)}}},rt.prototype.allocateBuffers=function(){this.posBuffer=new Array(3*this.numberOfVertices),this.totalNumberOfNormals&&(this.normalBuffer=new Array(3*this.totalNumberOfNormals)),this.hasTextures&&(this.textureBuffer=new Array(3*this.numberOfVertices)),this.hasUVs&&(this.uvsBuffer=new Array(2*this.numberOfVertices)),this.hasTangentsBinormals&&(this.tangentsBuffer=new Array(3*this.numberOfVertices),this.binormalsBuffer=new Array(3*this.numberOfVertices))};var it=function(){rt.call(this),this.totalNumberOfNormals=0,this.nbTexCoords=0,this.hasTextures=!1,this.hasUVs=!1,this.hasTangentsBinormals=!1};(it.prototype=new rt).constructor=it,it.prototype.partUnStreamHeader=function(e){this.numberOfVertices=e.readCompressedInt(),this.totalNumberOfNormals=e.readCompressedInt();var t=e.readUnsignedChar();if(this.hasTextures=1&t,this.hasUVs=2&t,this.hasTangentsBinormals=4&t,this.hasExtraTextures=16&t,this.hasTextures&&(this.nbTexCoords=e.readUnsignedChar()),this.hasExtraTextures){this.nbExtraTextureSet=e.readCompressedInt(),this.extraTextureSet=[];for(var r=0;r<this.nbExtraTextureSet;++r){var i=e.readUnsignedChar(),n=e.readStringWithLength();this.extraTextureSet.push({dimension:i,identifier:n})}}this.allocateBuffers()},it.prototype.partUnStream=function(e,t,r,i,n){var s=X?q:0;if(i)switch(X?Y:0){case 0:e.readPositions(t,i,this.posBuffer);break;case j:var a=new Array(3*i);e.readQuantPositions(i,a),Uint16PositionsToFloats(t,this.posBuffer,a,ct,lt);break;default:throw"Uknown position quantization"}if(this.totalNumberOfNormals)switch(s){case 0:e.readNormals(r,n,this.normalBuffer);break;case z:var o=new Array(2*n);e.readOctNormals(n,o),Oct16NormalsToFloats(r,this.normalBuffer,o);break;case W:o=new Array(3*n);e.readOctNormals(n,o),Oct24NormalsToFloats(r,this.normalBuffer,o);break;default:throw"Uknown normals quantization"}if(this.hasTextures&&e.readTextures(t,i,this.nbTexCoords,this.textureBuffer),this.hasUVs&&this.numberOfVertices&&e.readFloatArray(2*t,2*i,this.uvsBuffer),this.hasTangentsBinormals&&(e.readFloatArray(3*t,3*i,this.tangentsBuffer),e.readFloatArray(3*t,3*i,this.binormalsBuffer)),this.nbExtraTextureSet>0&&e.version>=210041920)for(var p=0;p<this.nbExtraTextureSet;++p){var h=this.extraTextureSet[p].dimension;e.skip(4*h*i)}};var nt=function(){this.geomType=0,this.nbPrimitives=0,this.primitives=[],this.attribute=null,this.material={file:"",id:-1},this.skip=!1};nt.prototype.unstreamPrimSet=function(e){var t=e.readCompressedInt();this.geomType=Pi[t],this.nbPrimitives=e.readCompressedInt(),12==t?this.skip=!0:this.primitives=new Array(this.nbPrimitives);for(var r=0;r<this.nbPrimitives;++r){var i=null;switch(e.readUnsignedChar()){case 1:i=new Fi;break;case 2:i=new Gi;break;case 3:i=new Ei;break;case 4:console.log("primitive type not handled..");break;case 5:i=new Vi;break;case 6:i=new Di;break;default:console.log("primitive type not handled..")}i&&(this.skip?i.skip(e):(i.unstream(e),this.primitives[r]=i))}};var st=function(){nt.call(this)};(st.prototype=Object.create(nt.prototype)).constructor=st,st.prototype.unstream=function(t){if(this.unstreamPrimSet(t),this.skip)t.skip(8*this.nbPrimitives);else for(var r=0;r<this.primitives.length;++r){var i=t.readGraphicAttributeSet();t.pushGAS(i,0);var n=t.getGAS(this.primitives[r].connectivity);n.setConnectivity(this.primitives[r].connectivity),"WIRE_EDGE"!==this.geomType&&(n.setLineThickness(1),n.setLineType(e.LinePatternEnum.SOLID)),"BOUNDARY_EDGE"!=this.geomType&&"SHARP_EDGE"!=this.geomType&&"SMOOTH_EDGE"!=this.geomType&&"EDGE"!=this.geomType||n.setRGBAColorAlphaChannel(255),this.primitives[r].symbol&&n.setSymbol(this.primitives[r].symbol),this.primitives[r].gas=n,t.popGAS()}};var at=function(){nt.call(this)};(at.prototype=Object.create(nt.prototype)).constructor=at,at.prototype.unstream=function(t){this.unstreamPrimSet(t);var r=t.readGraphicAttributeSet();t.pushGAS(r,0);var i=t.getGAS(null);"BOUNDARY_EDGE"!=this.geomType&&"SHARP_EDGE"!=this.geomType&&"SMOOTH_EDGE"!=this.geomType&&"EDGE"!=this.geomType||i.setRGBAColorAlphaChannel(255),"WIRE_EDGE"!==this.geomType&&(i.setLineThickness(1),i.setLineType(e.LinePatternEnum.SOLID));for(var n=0;n<this.primitives.length;++n){var s=i.clone();s.setConnectivity(this.primitives[n].connectivity),this.primitives[n].symbol&&s.setSymbol(this.primitives[n].symbol),this.primitives[n].gas=s}t.popGAS()};var ot=function(){nt.call(this)};(ot.prototype=Object.create(nt.prototype)).constructor=ot,ot.prototype.unstream=function(e){st.prototype.unstream.call(this,e);for(var t=0,r=[],i=this.primitives.length,n=0;n<i;n++)r[n]=[];if(e.version>=210041800&&(t=e.readCompressedUInt()),t>0){if(e.readUnsignedChar()){for(n=0;n<t;n++){if(e.readUnsignedChar()){for(var s={material:null,inheritanceMaterial:null,layer:null},a=(e.readStringWithLength(),e.readCompressedUInt()),o=0;o<a;o++){r[e.readCompressedUInt()].push(s)}if((c=e.readCompressedUInt())>0)for(o=0;o<c;o++){var p=this.materialApplicationUnstream(e,ue.STREAM_ALL_UINT);if(o==c-1){if(p.mapping){var h=e.materials.get([p.material.id]);h&&(h.mapping=p.mapping)}p.material.primWithMaterials=!0,s.material=p.material,s.inheritanceMaterial=p.inheritanceMaterial,s.layer=p.layer}}}}for(n=0;n<i;n++){var u=this.primitives[n],f=r[n];for(o=0;o<f.length;o++)f[o].material&&e.pushMatId(f[o].material,f[o].inheritanceMaterial,f[o].layer,this);u.material=e.getCurrentMatId(),u.material&&(u.material.primWithMaterials=!0);for(o=0;o<f.length;o++)f[o].material&&e.popMatId()}e.version;var d=e.readCompressedUInt();for(n=0;n<d;++n){var c;e.readUncompressedInt();if((c=e.readCompressedUInt())>0)for(o=0;o<c;++o){p=this.materialApplicationUnstream(e,ue.streamSettings);0==c&&(e.pushMatId(p.material,p.inheritanceMaterial,p.layer,this),l=e.getCurrentMatId(),e.popMatId())}}}}else for(n=0;n<this.nbPrimitives;n++){if(e.readUnsignedChar()){var l=(p=this.materialApplicationUnstream(e,ue.STREAM_MATERIAL)).material;l.primWithMaterials=!0,this.skip||(this.primitives[n].material=l)}}},ot.prototype.unstreamMaterial=function(e){var t,r={file:"",id:-1},i=0,n=e.readUnsignedChar(),s=0,a=null;if(n){if(2==n){e.readStringWithLength();return i=e.readCompressedInt(),r.id=e.materials.add({external3DXid:i}),r}if(s=e.readCompressedInt(),e.materials.isValidMultiRefIndexWithName(s,e.name))return r={file:"",id:f=e.materials.getIndexWithName(s,e.name)}}if(e.version>=210021320){var o=e.readCompressedInt();a=1===o?new tt:4===o?new qe:9===o&&e.version>=210042100?new Ze:new Ye}else a=new Ye;t=a.unstream(e);var p=e.getCurrentPosition(),h=e.getBytesRemain();h>32&&(h=32);var u=e.readString(h);(e.setCurrentPosition(p),-1!==u.indexOf('{\n"Version" : '))&&(new qe).skip(e);if(1===o)var f=t;else{f=e.materials.add(t);t._MaterialPropertiesActivate}return r={file:"",id:f},n&&e.materials.addMultiRefIndexWithName(s,f,e.name),r},ot.prototype.materialApplicationUnstream=function(e,t){var r={material:null,inheritanceMaterial:1,layer:0};if(t&ue.STREAM_MATERIAL&&(r.material=this.unstreamMaterial(e)),e.version>=1100500?t&ue.STREAM_INHERIT_INT?r.inheritanceMaterial=e.readCompressedInt():t&ue.STREAM_INHERIT_UINT?r.inheritanceMaterial=e.readCompressedInt():t&ue.STREAM_INHERIT_ULONG&&(r.inheritanceMaterial=e.readUncompressedInt()):t&(ue.STREAM_INHERIT_INT|ue.STREAM_INHERIT_UINT|ue.STREAM_INHERIT_ULONG)&&(r.inheritanceMaterial=1),t&ue.STREAM_LAYER_INT?r.layer=e.readUncompressedInt():t&ue.STREAM_LAYER_UINT?r.layer=e.readCompressedInt():t&ue.STREAM_LAYER_ULONG&&(r.layer=e.readUncompressedUInt()),t&ue.STREAM_UVTRANSFO){if(e.version>=210041900){var i=[0,0,0,1];if(e.readBoolean()){var n=!0,s=e.readFloat(),a=e.readFloat(),o=e.readFloat(),p=e.readFloat();s!=i[0]&&(i[0]=s,n=!1),a!=i[1]&&(i[1]=a,n=!1),o!=i[2]&&(i[2]=o,n=!1),p!=i[3]&&(i[3]=p,n=!1),n||(r.mapping={type:0,ObjectTransformation:null,UvTransformation:null,UvTransfoInfos:i,transformSemantic:1})}}}if(t&ue.STREAM_MAPPING_INFO&&(e.version>=210042100&&!e.readBoolean())){var h=e.readStringWithLength();if(h=(h=JSON.parse(h)).mappings[h.uvSlots.Default],r.mapping||(r.mapping={type:0,ObjectTransformation:null,UvTransformation:null,UvTransfoInfos:null,transformSemantic:1}),h.uvTrfSemantic&&(r.mapping.transformSemantic=h.uvTrfSemantic+1),h.uvTransform&&(r.mapping.UvTransformation=e.createMatrix3(h.uvTransform)),h.operator&&(r.mapping.type=h.operator.type,h.operator.transform)){var u=h.operator.transform;r.mapping.ObjectTransformation=u}}if(t&ue.STREAM_LIGHTMAP&&(e.version>=210042320&&1==e.readCompressedInt()))e.readStringWithLength(),e.readCompressedInt(),e.readUncompressedULong();return r};var pt=function(){};pt.prototype.unstream=function(e){var t={};e.readCompressedInt();t.timestamp=e.readUncompressedULong();let r=e.readCompressedInt();r&&(t.comment=e.readStringWithLength(r)),t.sagmode3D=e.readCompressedInt(),e.version>210041930?t.sag3D=e.readDouble():t.sag3D=e.readFloat(),e.version>1101210&&(e.version>210041930?(t.curveSag3D=e.readDouble(),t.sag2DMode=e.readCompressedInt(),t.sag2D=e.readDouble()):(t.curveSag3D=e.readFloat(),t.sag2DMode=e.readCompressedInt(),t.sag2D=e.readFloat()),t.sensitiveMode=e.readCompressedInt(),t.v4Text3D=e.readCompressedInt()),e.version>=210041730&&(t.regularizationSettingForTessellation=e.readUnsignedChar(),t.maxTriangleThresholdForTessellation=e.readUncompressedULong());let i=e.readUnsignedChar();if(i&&(t.minpointx=e.readFloat(),t.minpointy=e.readFloat(),t.minpointz=e.readFloat(),t.maxpointx=e.readFloat(),t.maxpointy=e.readFloat(),t.maxpointz=e.readFloat()),e.version>=1101330&&(t.wireGaps=e.readCompressedInt(),t.edgeSmoothness=e.readCompressedInt()),i=e.readUnsignedChar()){(new ht).skip(e)}t.nbLightSources=e.readCompressedInt(),t.nbLightSources>0&&(t.lightSources=[]);for(let r=t.nbLightSources-1;r>=0;r--){(new ut).skip(e)}return e.version>=21e5&&(t.nbLODContainers=e.readCompressedInt(),t.nbLODContainers>0&&(t.LODSags=new Float32Array(t.nbLODContainers),e.readFloatArray(0,t.nbLODContainers,t.LODSags))),(e.version>=1101800&&e.version<21e5||e.version>=2100090)&&(t.toleranceSCale=e.readFloat()),e.version>=210042310?(t.cgrType=e.readUnsignedChar(),t.adaptiveQualityTessellationVersion=e.readUnsignedChar()):e.version,t};var ht=function(){};ht.prototype.skip=function(e){var t=e.readCompressedInt();e.skip(t-4)};var ut=function(){};ut.prototype.skip=function(e){var t=e.readCompressedInt();e.skip(t-4)};var ft=function(){};ft.prototype.skip=function(e,t){var r=e.readCompressedInt();r<0&&(r=-r-2),e.skip(r-4)},ft.prototype.unstream=function(e,t){var r=new pi,i=e.readCompressedInt();i<0&&(i=-i-2);e.getCurrentPosition();r.rep.unstream(e),e.setNumberOfVertices(16777216);var n,s=e.readCompressedInt();if(s<=0)return e.popMatId(),e.popGAS(),null;for(var a=0;a<s;a++){switch(n=null,e.readUnsignedChar()){case C:case w:n=new Lt;break;case S:case P:n=new Dr;break;case M:n=new Xt;break;case F:n=new Yt;break;case T:n=new qt;break;case R:n=new Wt;break;case U:n=new Ht;break;case O:n=new Jt;break;case G:n=new Zt;break;case N:n=new Kt;break;case E:n=new $t;break;case V:n=new er;break;case b:break;default:return}if(null!==n){n.unstream(e);var o=e.readGraphicAttributeSet();e.pushGAS(o,0);var p=e.getGAS(null);n.primitive&&n.primitive.symbol&&p.setSymbol(n.primitive.symbol),n.primitive&&p.setConnectivity(n.primitive.connectivity),r.addGP(n,p,e,t),e.popGAS()}else e.readGraphicAttributeSet()}r.checkGP(e,t);var h=r.addMesh(e);return r.imageRep.length?(r.imageRep.unshift(r.rep),r.imageRep):h?r.rep:null};var dt=function(){};dt.prototype.unstream=function(t){var r=new tn,i=t.readCompressedInt();i<0&&(i=-i-2),r.rep.unstream(t);var n=t.readCompressedInt(),s=new e.PrimitiveGroup;s.fillAttr=new e.FillAttributes,s.lineAttr=new e.LineAttributes,s.pointAttr=new e.PointAttributes;for(var a,o=0;o<n;++o){var u=t.readUnsignedChar();switch(2==h&&t.idOrder++,a=null,u){case 121:a=new Gr;break;case 128:a=new Vr;break;case 129:a=new Nr;break;case 130:a=new Er;break;case 131:a=new Or;break;case 132:a=new Ir;break;case 135:a=new br;break;case 136:a=new Cr;break;case 164:a=new Pr;break;case 165:a=new Sr;break;case 166:a=new wr;break;case 167:a=new Mr;break;case 168:a=new Fr;break;case 169:a=new Tr;break;case 105:a=new Rr}if(a){var f=a.unstream(t),d=t.readGraphicAttributeSet();t.pushGAS(d,0);var c=t.getGAS(a.primitive.connectivity);if(a.primitive&&a.primitive.symbol&&c.setSymbol(a.primitive.symbol),c.setBasic(!0),c.setConnectivity(a.primitive.connectivity),2==f&&d.getBlankingRep(),En&&c.set2DMode(),p&&a instanceof Rr&&a.text){var l=c.getDisplayedColor(),v=-1;c.isNoZ()&&(v=c.getPriority()),a.text._noZPriority=v;var m=new e.Color(l[0]/255,l[1]/255,l[2]/255,l[3]/255);a.text.color=m,r.texts.push(a.text)}f&&r.addGP(a,c,t),t.popGAS()}}if(r.texts.length){var y=t.texts.add(r.texts);r.rep.node.textIndice=y+1}var g=r.addMesh(t);return r.imageRep.length?(r.imageRep.push(r.rep),r.imageRep):g?r.rep:null};var ct={x:0,y:0,z:0},lt={x:0,y:0,z:0},vt=function(){};vt.prototype.unstreamRep=function(e,t){t||(t=new hi);e.readCompressedInt();if(t.rep.unstream(e),e.version>=21e5&&!l){var r=0;(y=e.readUnsignedChar())&&(t.vertexBuffer=new it,t.vertexBuffer.partUnStreamHeader(e),r=t.vertexBuffer.getNumberOfVertices());t.nbLODFaces=e.readUnsignedChar();var i=0;if(t.nbLODFaces){i=new Float32Array(t.nbLODFaces+1);e.readFloatArray(0,t.nbLODFaces+1,i)}else i=e.version>210041930?e.readDouble():e.readFloat();if(o&&(t.rep.node.sag=i),e.version>=210021620)e.readDouble();e.setNumberOfVertices(r);var n=0;t.posInNextStreamer=e.readCompressedInt();for(var s=0,a=0;n<=Si.LSG;)if(0!=t.nbLODFaces||n!=Si.LOD1&&n!=Si.LOD2&&n!=Si.LOD3&&n!=Si.FACES){if(0==t.nbLODFaces&&n==Si.LOD0){if(!(f=e.getContainer()))return e.error=" container not found",!1;var p=f.getStreamerByName("LOD0");if(e.copyStreamerInheritance(p),p){if(p.setCurrentPosition(t.posInNextStreamer),t.posInNextStreamer=p.readCompressedInt(),y){var h=p.readCompressedInt(),u=p.readCompressedInt();t.vertexBuffer.partUnStream(p,s,a,h,u),p.setNumberOfVertices(t.vertexBuffer.getNumberOfVertices())}t.unStreamFaces(p)}}else if(n==Si.LOD0){if(!(f=e.getContainer()))return e.error=" container not found",!1;p=f.getStreamerByName("LOD0");if(e.copyStreamerInheritance(p),p&&(p.setCurrentPosition(t.posInNextStreamer),t.posInNextStreamer=p.readCompressedInt(),y)){h=p.readCompressedInt(),u=p.readCompressedInt();t.vertexBuffer.partUnStream(p,s,a,h,u),s+=h,a+=u}}if(n==Si.LOD1){if(!(f=e.getContainer()))return e.error=" container not found",!1;p=f.getStreamerByName("LOD1");if(e.copyStreamerInheritance(p),p&&(p.setCurrentPosition(t.posInNextStreamer),t.posInNextStreamer=p.readCompressedInt(),y)){h=p.readCompressedInt(),u=p.readCompressedInt();t.vertexBuffer.partUnStream(p,s,a,h,u),s+=h,a+=u}}if(n==Si.LOD2){if(!(f=e.getContainer()))return e.error=" container not found",!1;p=f.getStreamerByName("LOD2");if(e.copyStreamerInheritance(p),p&&(p.setCurrentPosition(t.posInNextStreamer),t.posInNextStreamer=p.readCompressedInt(),y)){h=p.readCompressedInt(),u=p.readCompressedInt();t.vertexBuffer.partUnStream(p,s,a,h,u),s+=h,a+=u}}if(n==Si.LOD3){if(!(f=e.getContainer()))return e.error=" container not found",!1;p=f.getStreamerByName("LOD3");if(e.copyStreamerInheritance(p),p&&(p.setCurrentPosition(t.posInNextStreamer),t.posInNextStreamer=p.readCompressedInt(),y)){h=p.readCompressedInt(),u=p.readCompressedInt();t.vertexBuffer.partUnStream(p,s,a,h,u),s+=h,a+=u}}if(n==Si.FACES){if(!(f=e.getContainer()))return e.error=" container not found",!1;p=f.getStreamerByName("FACES");if(e.copyStreamerInheritance(p),p){if(p.setCurrentPosition(t.posInNextStreamer),t.posInNextStreamer=p.readCompressedInt(),y){h=p.readCompressedInt(),u=p.readCompressedInt();p.setNumberOfVertices(s+h),t.vertexBuffer.partUnStream(p,s,a,h,u),s+=h,a+=u}else p.setNumberOfVertices(0);t.unStreamFaces(p)}}if(n==Si.LSG){var f;if(!(f=e.getContainer()))return e.error=" container not found",!1;var d=f.getStreamerByName("LSG");if(d){e.copyStreamerInheritance(d),d.setNumberOfVertices(r),y?d.setNumberOfVertices(r):d.setNumberOfVertices(0),d.setCurrentPosition(t.posInNextStreamer),t.posInNextStreamer=d.readCompressedInt();var c=t.sets.length,v=d.readUnsignedChar();t.nbSets=v+c;for(var m=0;m<v;++m){switch(d.readUnsignedChar()){case 1:t.sets[m+c]=new at;break;case 2:t.sets[m+c]=new st;break;default:return void(t.sets[m+c]=null)}t.sets[m+c]&&t.sets[m+c].unstream(d)}}}n++}else n++}else{var y;(y=e.readUnsignedChar())&&(t.vertexBuffer=new it,t.vertexBuffer.unstream(e),e.setNumberOfVertices(t.vertexBuffer.getNumberOfVertices()));i=0;i=e.version>210041930?e.readDouble():e.readFloat(),t.nbLODFaces=e.readUnsignedChar(),o&&(t.rep.node.sag=i);for(m=0;m<t.nbLODFaces;++m){var g;switch(e.readUnsignedChar()){case 1:g=new Fi;break;case 4:g=new Oi}g&&[].push(g.unstream(e)),e.readFloat(),e.readUncompressedInt();e.readUncompressedInt()}t.nbSets=e.readUnsignedChar();for(m=0;m<t.nbSets;++m){switch(e.readUnsignedChar()){case 1:t.sets[m]=new at;break;case 2:t.sets[m]=new st;break;default:return void(t.sets[m]=null)}t.sets[m]&&t.sets[m].unstream(e)}}return t};var mt=function(){this.repPosInStreamer=0};mt.prototype=Object.create(vt.prototype),mt.prototype.constructor=mt,mt.prototype.unstream=function(e){var t=new hi,r=this.unstreamRep(e,t);if(t.posInNextStreamer||(t.posInNextStreamer=0),e.version<21e5&&(t.posInNextStreamer=e.readCompressedInt()),!l){if(!r)return!1;var i=e.getContainer(),n=i?i.getStreamerByName("SurfacicReps"):e;i&&n.setCurrentPosition(t.posInNextStreamer),e.copyStreamerInheritance(n);var s=new yt;if(n)s.unstreamRep(n,t);else{if(n.cgrContainer)return;s.unstream(n,t)}}return!!r&&(t.addMesh(e)?t.rep:null)};var yt=function(){};yt.prototype.unStreamEdgeIndex=function(e){e.readCompressedInt(),e.readCompressedInt()},yt.prototype.unstreamRep=function(e,t){if(!(e.version<1101410)&&t){e.setLightDataStreaming(!1);e.readCompressedInt(),e.readFloat(),e.readFloat();if(e.version>=210041720)128&e.readUnsignedChar()&&e.skip(4);if(e.version>=210042320)e.readUnsignedChar();var r=t.getSet("FACE"),i=t.getSet("EDGE"),n=r.length,s=i.length,a=t.nbLODFaces,o=e.readCompressedInt(),p=new Lt;if(n)for(var h=0;h<n;h++){var u=r[h];p.unstream(e),u.cgmId=p.node.cgmId,u.decoration=p.decoration,u.boundingSphere=p.boundingSphere}for(h=0;h<a;h++)p.unstream(e);var f=new jt;if(s&&i)for(h=0;h<s;h++){var d=i[h];f.unstream(e),d.cgmId=f.node.cgmId,d.decoration=f.decoration,this.unStreamEdgeIndex(e)}for(h=0;h<o;h++){var c=e.readCompressedInt();e.readUncompressedInt(),e.readUncompressedInt();if(e.version>=1101710&&e.version<210042440&&e.setLightDataStreaming(!0),c)for(var l=new Dr,v=0;v<c;v++)l.skip(e);e.version>=1101710&&e.version<210042440&&e.setLightDataStreaming(!1)}for(var m=t.nbSets,y=new jt,g=new Xt,x=0;x<m;++x){var B=t.sets[x],A=B.primitives;for(v=0;v<A.length;v++){var I=A[v];if("FACE"!=B.geomType&&"EDGE"!=B.geomType&&"ISOPAR"!=B.geomType){var b=null,C=e.readUnsignedChar();switch(C){case 80:case 81:b=new Lt;break;case 82:b=new Dr;break;case 84:b=g;break;case 96:case 200:b=y;break;case 162:b=new zt;break;case 134:b=new Lr;break;case 86:b=new qt;break;case 187:b=new kt;break;default:return}b&&(b.unstream(e),I.cgmId=b.node.cgmId,I.decoration=b.decoration,I.boundingSphere=b.boundingSphere),96!=C&&200!=C&&162!=C||this.unStreamEdgeIndex(e)}}}e.setLightDataStreaming(!0)}};var gt=function(){};gt.prototype.unstream=function(t){var r=new bi;t.readCompressedInt();r.nbIndicesTotal=0,r.vertexBuffer=new rt;var i=null,n=null;r.rep.unstream(t);var s=t.readFloat();o&&(r.rep.node.sag=s);t.readFloat(),t.readFloat();t.version>=210041740&&(128&t.readUnsignedChar()&&t.skip(8));if(t.version>=210042320)t.readUnsignedChar();if(r.nbElEdge=t.readCompressedInt(),r.nbElEdge)for(var a=r.nbElEdge-1;a>=0;a--){(i=new Dr).primitive.indices=r.indexBuffer,i.vertexBuffer=r.vertexBuffer,i.unstream(t),i.primitive.cgmId=i.node.cgmId,i.decoration&&(i.primitive.decoration=i.decoration),r.nbIndicesTotal+=i.primitive.count;var p=t.readGraphicAttributeSet();t.pushGAS(p,0),(c=t.getGAS(e.ConnectivityTypeEnum.LINES)).setConnectivity(e.ConnectivityTypeEnum.LINES),t.popGAS(),i.primitive.attr=c;for(var h=r.edgePrimitivesSets.length,u=0;u<h;u++){var f=r.edgePrimitivesSets[u];if(f.attr.set==i.primitive.attr.set&&f.attr.rgba==i.primitive.attr.rgba){f.set.push(i.primitive),f.nbIndices+=i.primitive.count;break}}if(u==r.edgePrimitivesSets.length)(l={}).attr=i.primitive.attr,l.nbIndices=i.primitive.count,l.set=[],l.set.push(i.primitive),r.edgePrimitivesSets.push(l)}if(r.nbElPoints=t.readCompressedInt(),r.nbElPoints){for(a=r.nbElPoints-1;a>=0;a--){(n=new Xt).vertexBuffer=r.vertexBuffer,n.primitive.indices=r.indexBuffer,n.unstream(t),n.primitive.cgmId=n.node.cgmId,n.decoration&&(n.primitive.decoration=n.decoration),r.nbIndicesTotal+=n.primitive.count;h=r.pointPrimimitivesSets.length;for(u=0;u<h;u++){var d=r.pointPrimimitivesSets[u];if(d.symbol==n.primitive.symbol){d.set.push(n.primitive),d.nbIndices+=n.primitive.count;break}}if(u==r.pointPrimimitivesSets.length)(l={}).symbol=n.primitive.symbol,l.nbIndices=n.primitive.count,l.set=[],l.set.push(n.primitive),r.pointPrimimitivesSets.push(l)}var c;p=t.readGraphicAttributeSet();t.pushGAS(p,0),(c=t.getGAS(e.ConnectivityTypeEnum.POINTS)).setConnectivity(e.ConnectivityTypeEnum.POINTS),t.popGAS();for(a=0;a<r.pointPrimimitivesSets.length;a++){var l;(l=r.pointPrimimitivesSets[a]).attr=c.clone(),l.attr.setSymbol(l.symbol)}}return r.addMesh(t)?r.rep:null};var xt=function(){};xt.prototype=Object.create(vt.prototype),xt.prototype.constructor=xt,xt.prototype.unstream=function(e){var t=new Ai,r=(e.readCompressedInt(),!0);if(t.rep.unstream(e),t.vertexBuffer=new rt,t.nbLODFaces=e.readCompressedInt(),t.nbLODFaces>0){for(var i=[],s=1;s<=t.nbLODFaces;++s)i.push(e.readFloat());var a=new Wt;r=a.unstream(e,t.vertexBuffer),t.sets.push(a),n&&(t.curveVertices=a.curveVertices,t.startNormal=a.startNormal,t.endNormal=a.endNormal,t.startSideVector=a.startSideVector,t.radius=a.radius);for(s=1;s<=t.nbLODFaces-2;s++){(new Wt).skip(e)}(new Dr).skip(e)}return r?t.addMesh(e)?t.rep:null:(e.popMatId(),e.popGAS(),null)};var Bt=function(){};Bt.prototype=Object.create(vt.prototype),Bt.prototype.constructor=Bt,Bt.prototype.unstream=function(e){var t=new ci;e.readCompressedInt();if(t.rep.unstream(e),t.vertexBuffer=new rt,t.nbLODFaces=e.readCompressedInt(),t.nbLODFaces>0){for(var r=[],i=0;i<t.nbLODFaces;++i)r.push(e.readFloat());for(i=0;i<t.nbLODFaces;++i)(new Dr).unstream(e)}return t.addMesh(e)?t.rep:null};var At=function(){};At.prototype=Object.create(vt.prototype),At.prototype.constructor=At,At.prototype.unstream=function(e){var t=new xi;e.readCompressedInt();t.rep.unstream(e);var r=new qt;r.unstream(e);var i=e.getGAS(null),n=i.getDisplayedColor(),s=r.primitive;return t.refPlane.push({rep:t.rep,origin:s.origin,xAxis:s.direction1,yAxis:s.direction2,noShow:i.isHidden(),color:n,lengthX:s.length,lengthY:s.length,mode:s.mode,type:"CAT3DPlanRep"}),t.addMesh(e)?t.rep:null};var It=function(){};It.prototype=Object.create(vt.prototype),It.prototype.constructor=It,It.prototype.unstream=function(e){var t=new di;e.readCompressedInt();if(t.rep.unstream(e),e.readUnsignedChar())(new Kt).unstream(e);return t.addMesh(e)?t.rep:null};var bt=function(){};bt.prototype=Object.create(vt.prototype),bt.prototype.constructor=bt,bt.prototype.unstream=function(e){var t=new li;e.readCompressedInt();if(t.rep.unstream(e),e.readUnsignedChar())(new Kt).unstream(e);return t.addMesh(e)?t.rep:null};var Ct=function(){};Ct.prototype=Object.create(vt.prototype),Ct.prototype.constructor=Ct,Ct.prototype.unstream=function(e){var t=new Ii;e.readCompressedInt();if(t.rep.unstream(e),t.vertexBuffer=new rt,t.nbLODFaces=e.readCompressedInt(),t.nbLODFaces>0){for(var r=[],i=1;i<=t.nbLODFaces;++i)r.push(e.readFloat());var s=new Ht;t.isGPUInstanciable=s.unstream(e,t.vertexBuffer),t.sets.push(s),t.isGPUInstanciable&&n&&(t.curveVertices=s.curveVertices,t.startNormal=s.startNormal,t.endNormal=s.endNormal,t.startSideVector=s.startSideVector,t.radius=s.radius);for(i=1;i<=t.nbLODFaces-2;i++){(new Ht).skip(e)}(new Dr).skip(e)}return t.addMesh(e)?t.rep:null};var wt=function(){};wt.prototype=Object.create(vt.prototype),wt.prototype.constructor=wt,wt.prototype.unstream=function(e){2==h&&e.idOrder++;var t=new Xi;e.readCompressedInt();if(t.rep.unstream(e),t.vertexBuffer=new rt,e.readUnsignedChar()>0){var r=new Gr;r.unstream(e),t.gp=r}return t.addMesh(e)?t.rep:null};var St=function(){};St.prototype=Object.create(vt.prototype),St.prototype.constructor=St,St.prototype.unstream=function(e){2==h&&e.idOrder++;var t=new Yi;e.readCompressedInt();t.rep.unstream(e),t.vertexBuffer=new rt;var r=new Nr;return r.unstream(e),t.gp=r,t.addMesh(e)?t.rep:null};var Pt=function(){};Pt.prototype=Object.create(vt.prototype),Pt.prototype.constructor=Pt,Pt.prototype.unstream=function(e){var t=new mi;e.readCompressedInt();if(t.rep.unstream(e),t.vertexBuffer=new rt,1==e.readUnsignedChar()){var r=new Xt;r.unstream(e),t.gp=r}return t.addMesh(e)?t.rep:null};var Mt=function(){};Mt.prototype=Object.create(vt.prototype),Mt.prototype.constructor=Mt,Mt.prototype.unstream=function(e){var t=new vi;e.readCompressedInt();t.rep.unstream(e);(new Yt).unstream(e),(new Yt).unstream(e),(new Yt).unstream(e);return t.addMesh(e)?t.rep:null};var Ft=function(){};Ft.prototype=Object.create(vt.prototype),Ft.prototype.constructor=Ft,Ft.prototype.unstream=function(e){2==h&&e.idOrder++;var t=new fi;e.readCompressedInt();if(t.rep.unstream(e),t.vertexBuffer=new rt,1==e.readUnsignedChar()){var r=new Er;r.unstream(e),t.gp=r}return t.addMesh(e)?t.rep:null};var Tt=function(){};Tt.prototype=Object.create(vt.prototype),Tt.prototype.constructor=Tt,Tt.prototype.unstream=function(e){var t=new yi;e.readCompressedInt();t.rep.unstream(e),t.vertexBuffer=new rt;var r=new Dr;return r.unstream(e),t.gp=r,t.addMesh(e)?t.rep:null};var Rt=function(){};Rt.prototype=Object.create(vt.prototype),Rt.prototype.constructor=Rt,Rt.prototype.getAxisSystemInfo=function(e){var t,r=e.getCurrentPosition();ft.prototype.skip.call(this,e);var i=0;e.version>=210042110?(t=e.readFloat(),i=e.readCompressedInt()):t=e.readCompressedInt();var n=e.readCompressedInt();return e.setCurrentPosition(r),{isMonoPlane:n,mode:i,axisLength:t}},Rt.prototype.unstream=function(e){e.readCompressedInt();var t=this.getAxisSystemInfo(e),r=ft.prototype.unstream.call(this,e,t);if(e.version>=210042110){e.readFloat();e.readCompressedInt()}else e.readCompressedInt();e.readCompressedInt();return r};var Ut=function(){};Ut.prototype=Object.create(vt.prototype),Ut.prototype.constructor=Ut,Ut.prototype.unstream=function(e){2==h&&e.idOrder++;var t=new qi;e.readCompressedInt();if(t.rep.unstream(e),t.vertexBuffer=new rt,e.readUnsignedChar()>0){var r=new Vr;r.unstream(e),t.gp=r}return t.addMesh(e)?t.rep:null};var Ot=function(){};Ot.prototype=Object.create(vt.prototype),Ot.prototype.constructor=Ot,Ot.prototype.unstream=function(e){2==h&&e.idOrder++;var t=new Zi;e.readCompressedInt();t.rep.unstream(e),t.vertexBuffer=new rt;var r=new br;return r.unstream(e),t.gp=r,t.addMesh(e)?t.rep:null};var Gt=function(){};Gt.prototype=Object.create(vt.prototype),Gt.prototype.constructor=Gt,Gt.prototype.unstream=function(e){2==h&&e.idOrder++;var t=new Ji;e.readCompressedInt();t.rep.unstream(e),t.vertexBuffer=new rt,t.unstreamPerforatedPolygon(e);for(var r=e.readCompressedInt(),i=0;i<r;i++){var n=new Or;n.unstream(e),t.gp.push(n)}return t.gp.length?t.addMesh(e)?t.rep:null:(e.popMatId(),e.popGAS(),null)};var Nt=function(){};Nt.prototype=Object.create(vt.prototype),Nt.prototype.constructor=Nt,Nt.prototype.unstream=function(e){2==h&&e.idOrder++;var t=new en;e.readCompressedInt();t.rep.unstream(e),t.vertexBuffer=new rt;var r=new Or,i=r.unstream(e);return t.gp=r,i&&t.addMesh(e)?t.rep:null};var Et=function(){};Et.prototype=Object.create(vt.prototype),Et.prototype.constructor=Et,Et.prototype.unstream=function(e){2==h&&e.idOrder++;var r=new $i;e.readCompressedInt();r.rep.unstream(e),r.vertexBuffer=new rt;var i=new wr,n=i.unstream(e);if(r.gp=i,n&&i){void 0!==i.zoomQuality&&0===i.zoomQuality&&e.setFixedMode(!0),i.point&&(e.pushStaticMode(e.getCurrentMatrix()),e.currentMatrix.push(new t.Matrix4)),i.primitive.material&&e.pushMatId(i.primitive.material,1,0,r.rep),r.gp=i;var s=r.addMesh(e);return e.setFixedMode(!1),i.primitive.material&&e.popMatId(),i.point&&(e.currentMatrix.pop(),e.popStaticMode()),s?r.rep:null}return null};var Vt=function(){this.node=new e.SGPrimitive,this.vertexBuffer=null,this.primitive=null,this.decoration=0};(Vt.prototype=Object.create(Vt.prototype)).constructor=Vt,Vt.prototype.unstreamPrimitive=function(e){if(this.node.cgmId=0,this.decoration=0,e.version>=1100700?this.node.cgmId=e.readUncompressedULong():e.version>=1100200&&(this.node.cgmId=e.readCompressedInt()),e.version>=1100800){var t=e.readUnsignedShort();if(t>0){var r=e.decorations,i=[];if(1==t){i.push(0);e.readUnsignedChar()}else if(65535==t)i.push(0);else{i.push(t);for(var n=0;n<t;n++)i.push(e.readUnsignedChar())}this.decoration=r.addDecoration(i)}}},Vt.prototype.create2DArcCircleGP=function(t,r,i,n,s,a,o,p,h,u){r.start=0,o<a&&(o+=2*Math.PI);var f=t.posBuffer.length/3;if(h){r.connectivity=e.ConnectivityTypeEnum.TRIANGLES,r.count+=3*(p-2);for(var d=0;d<p;++d){var c=a+(o-a)*d/(p-1);t.posBuffer.push(i+s*Math.cos(c)),t.posBuffer.push(n+s*Math.sin(c)),t.posBuffer.push(u.idOrder),t.normalBuffer.push(0),t.normalBuffer.push(0),t.normalBuffer.push(1)}for(d=1;d<p-1;d++)r.indices.push(0),r.indices.push(d),r.indices.push(d+1)}else{r.connectivity=e.ConnectivityTypeEnum.LINES,r.count+=2+2*(p-2);c=a;t.posBuffer.push(i+s*Math.cos(c)),t.posBuffer.push(n+s*Math.sin(c)),t.posBuffer.push(u.idOrder);for(d=1;d<p;++d)c=a+(o-a)*d/(p-1),r.indices.push(f++),t.posBuffer.push(i+s*Math.cos(c)),t.posBuffer.push(n+s*Math.sin(c)),t.posBuffer.push(u.idOrder),r.indices.push(f)}},Vt.prototype.createPolylineGP=function(t,r,i,n){switch(r.start=0,r.connectivity=e.ConnectivityTypeEnum.LINES,n){case 0:r.count+=i;for(var s=0;s<i;++s)r.indices.push(t++);break;case 1:r.count+=2+2*(i-2);for(s=1;s<i;++s)r.indices.push(t++),r.indices.push(t);break;case 2:r.count+=4+2*(i-2);var a=t;for(s=0;s<i-1;++s)r.indices.push(t++),r.indices.push(t);r.indices.push(t),r.indices.push(a);break;default:return null}},Vt.prototype.createPolygonGP=function(t,r,i,n,s,a){if(r.start=0,a){r.connectivity=e.ConnectivityTypeEnum.TRIANGLES;switch(s){case 0:case 4:r.count+=n;for(var o=0;o<n;++o)r.indices.push(i[t++]);break;case 1:case 5:r.count+=3*(n-2);var p=0;for(o=0;o<n-2;o++)r.indices.push(i[t]),r.indices.push(i[t+1+p]),r.indices.push(i[t+2-p]),t++,p=1-p;t+=2;break;case 2:case 6:r.count+=3*(n-2);var h=i[t];for(o=0;o<n-2;o++)r.indices.push(h),r.indices.push(i[t+2]),r.indices.push(i[t+1]),t++;t+=2;break;default:return null}}else{r.connectivity=e.ConnectivityTypeEnum.LINES,r.count=2+2*(n-1);for(var u=t,f=1;f<n;++f)r.indices.push(t++),r.indices.push(t);r.indices.push(t),r.indices.push(u)}return t};var Dt=function(){Vt.call(this),this.boundingBoxCenter=new Float32Array(3),this.boundingBoxDim=new Float32Array(3),this.boundingSphere=null};(Dt.prototype=Object.create(Vt.prototype)).constructor=Dt,Dt.prototype.unstreamBBox=function(e){switch(this.unstreamPrimitive(e),X?H:0){case 0:for(var t=0;t<3;t++)this.boundingBoxCenter[t]=e.readFloat();for(t=0;t<3;t++)this.boundingBoxDim[t]=e.readFloat();var r=new Array(3);for(t=0;t<3;t++)r[t]=e.readFloat();var i=e.readFloat();s&&(this.boundingSphere={center:r,radius:i});break;case _:var n=(lt.x-ct.x)*one_over_65535,a=(lt.y-ct.y)*one_over_65535,o=(lt.z-ct.z)*one_over_65535,p={x:e.readUnsignedShort()*n+ct.x,y:e.readUnsignedShort()*a+ct.y,z:e.readUnsignedShort()*o+ct.z},h={x:e.readUnsignedShort()*n+ct.x,y:e.readUnsignedShort()*a+ct.y,z:e.readUnsignedShort()*o+ct.z};this.boundingBoxCenter[0]=.5*(h.x+p.x),this.boundingBoxCenter[1]=.5*(h.y+p.y),this.boundingBoxCenter[2]=.5*(h.z+p.z),this.boundingBoxDim[0]=h.x-p.x,this.boundingBoxDim[1]=h.y-p.y,this.boundingBoxDim[2]=h.z-p.z;for(r=new Array(3),t=0;t<3;t++)r[t]=this.boundingBoxCenter[t];i=Math.max(Math.max(this.boundingBoxDim[0],this.boundingBoxDim[1]),this.boundingBoxDim[2])*Math.sqrt(2)*.5;s&&(this.boundingSphere={center:r,radius:i});break;case k:this.boundingBoxCenter[0]=.5*(lt.x+ct.x),this.boundingBoxCenter[1]=.5*(lt.y+ct.y),this.boundingBoxCenter[2]=.5*(lt.z+ct.z),this.boundingBoxDim[0]=lt.x-ct.x,this.boundingBoxDim[1]=lt.y-ct.y,this.boundingBoxDim[2]=lt.z-ct.z;for(r=new Array(3),t=0;t<3;t++)r[t]=this.boundingBoxCenter[t];i=Math.max(Math.max(this.boundingBoxDim[0],this.boundingBoxDim[1]),this.boundingBoxDim[2])*Math.sqrt(2)*.5;s&&(this.boundingSphere={center:r,radius:i})}};var Lt=function(){Dt.call(this)};Lt.prototype=Object.create(Dt.prototype),Lt.prototype.constructor=Lt,Lt.prototype.unstream=function(e){if(e.version>=1101410){this.unstreamBBox(e),e.getLightDataStreaming()&&(this.primitive=new Fi,this.primitive.unstream(e),e.readUnsignedChar()&&(this.vertexBuffer=new rt,this.vertexBuffer.unstream(e))),e.version>=1101430?e.readUnsignedChar():0}else{this.unstreamBBox(e);var t=e.readCompressedInt(),r=e.readCompressedInt(),i=e.readCompressedInt(),n=e.readCompressedInt(),s=e.readCompressedInt();this.primitive=new Fi,e.version>=1100700&&e.readUnsignedChar();var a,o=1&(a=e.readUnsignedChar())||2&a,p=4&a||8&a;if(this.vertexBuffer||(this.vertexBuffer=new rt),o)e.readFloatArray(0,t,this.vertexBuffer.posBuffer),e.readUnsignedChar()&&e.readFloatArray(0,t,this.vertexBuffer.uvBuffer),e.version>1100820&&(multiple_texture=e.readUnsignedChar());if(p)if(e.version>1000800){e.readShortArray(r,this.vertexBuffer.normalBuffer);for(var h=0;h<r;h++)this.vertexBuffer.normalBuffer[h]*=1/32767}else e.readFloatArray(0,r,this.vertexBuffer.normalBuffer);i&&(e.version>=1100600?e.unpackcArray(3*i,this.primitive.indices,0):e.version>1000500?e.unpackcArray(3*i,this.primitive.indices,0):this.primitive.indices=e.readUncompressedIntArray(3*i,this.primitive.indices));var u=[],f=this.primitive.indices.length;if(n){var d=[];for(e.version>1000500?e.unpackcArray(n,d,0):e.readUncompressedIntArray(n,d),h=n-1;h>=0;h--){var c=d[h];e.version>=1100600?e.unpackcArray(c,u,0):e.version>1000500?e.unpackcArray(c,u,0):e.readUncompressedIntArray(c,u);for(var l=2;l<c;++l)l%2?(this.primitive.indices[f++]=u[l],this.primitive.indices[f++]=u[l-1],this.primitive.indices[f++]=u[l-2]):(this.primitive.indices[f++]=u[l-1],this.primitive.indices[f++]=u[l],this.primitive.indices[f++]=u[l-2])}}if(s){var v=[];for(e.version>1000500?e.unpackcArray(s,v,0):e.readUncompressedIntArray(s,v),h=s-1;h>=0;h--){var m=v[h];e.version>=1100600?e.unpackcArray(m,u,0):e.version>1000500?e.unpackcArray(m,u,0):e.readUncompressedIntArray(m,u);for(l=2;l<m;++l)this.primitive.indices[f++]=u[0],this.primitive.indices[f++]=u[l-1],this.primitive.indices[f++]=u[l]}}e.readUnsignedChar()&&e.readFloatArray(0,2*t/3,this.vertexBuffer.uvBuffer),t||3!=r?t&&3==r&&(this.planarNormals=this.vertexBuffer.normalBuffer):this.planarNormals=this.vertexBuffer.normalBuffer}};var _t=function(){Lt.call(this)};(_t.prototype=Object.create(Lt.prototype)).constructor=_t;var kt=function(){Vt.call(this)};kt.prototype=Object.create(Vt.prototype),kt.prototype.constructor=kt,kt.prototype.unstream=function(e){if(e.version>=210021710){this.unstreamPrimitive(e);e.readCompressedUInt()}};var jt=function(){Vt.call(this),this.fref1=null,this.fref2=null,this.vizEdge=null};jt.prototype=Object.create(Vt.prototype),jt.prototype.constructor=jt,jt.prototype.unstream=function(e){if(e.version>=1101410)return this.unstreamPrimitive(e),void(e.getLightDataStreaming()&&(this.vizEdge=new Gi,this.vizEdge.unstream(e),this.vertexBuffer=new rt,this.vertexBuffer.posBuffer=vizEdge.linePos))};var zt=function(){jt.call(this)};zt.prototype=Object.create(jt.prototype),zt.prototype.constructor=zt,zt.prototype.unstream=function(e){if(jt.prototype.unstream.call(this,e),e.readBoolean()){var t=e.readCompressedUInt();t&&e.skip(3*t*4)}};var Wt=function(){Dt.call(this),this.toSkip=!1};Wt.prototype=Object.create(Dt.prototype),Wt.prototype.constructor=Wt,Wt.prototype.unstream=function(e,r){this.unstreamBBox(e);var i=e.readCompressedInt();if(0==i){var s=e.readCompressedInt();return e.skip(12),e.skip(12*i),e.skip(24),e.skip(12*s),this.toSkip=!0,!1}s=e.readCompressedInt();var a=new Float32Array(3);a[0]=e.readFloat(),a[1]=e.readFloat(),a[2]=e.readFloat();var o=1/Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]),p=new Float32Array(3);p[0]=o*a[0],p[1]=o*a[1],p[2]=o*a[2];for(var h=!0,u=!0,f=new Float32Array(12*i),d=new Float32Array(12*i),c=new Uint32Array(12*(i-1)),l=0,v=0,m=0,y=0;y<i;y++)f[l++]=e.readFloat(),f[l++]=e.readFloat(),f[l++]=e.readFloat();var g=1/i,x=[0,0,0];for(y=0;y<i;y++)x[0]+=g*f[3*y],x[1]+=g*f[3*y+1],x[2]+=g*f[3*y+2];if(n){var B=[];B[0]=x[0],B[1]=x[1],B[2]=x[2],B[3]=x[0]+a[0],B[4]=x[1]+a[1],B[5]=x[2]+a[2],this.curveVertices=B,this.startNormal=[-p[0],-p[1],-p[2]],this.endNormal=[p[0],p[1],p[2]];var A=[f[0]-x[0],f[1]-x[1],f[2]-x[2]];this.radius=Math.sqrt(A[0]*A[0]+A[1]*A[1]+A[2]*A[2]),this.startSideVector=new Float32Array([A[0]/this.radius,A[1]/this.radius,A[2]/this.radius])}var I=new Float32Array(3);for(y=0;y<3;y++)I[y]=e.readFloat();var b=new Float32Array(3);for(y=0;y<3;y++)b[y]=e.readFloat();if(n)return s>0&&e.skip(3*s*4),!0;if(i>=3){var C=new t.Vector3(I[0],I[1],I[2]),w=new t.Vector3(b[0],b[1],b[2]);C.cross(w);var S=new t.Vector3(f[3]-f[0],f[4]-f[1],f[5]-f[2]),P=new t.Vector3(f[6]-f[0],f[7]-f[1],f[8]-f[2]);if(i>4){var M=Math.trunc(i/4);P=new t.Vector3(f[3*M]-f[0],f[3*M+1]-f[1],f[3*M+2]-f[2])}S.cross(P);var F=S.dot(C);F<0&&(h=!1),P.set(a[0],a[1],a[2]),(F=P.dot(C))<0&&(u=!1)}var T=!(h^u),R=2*Math.PI/i;if(h)for(y=0;y<i;y++){var U=Math.cos(y*R),O=Math.sin(y*R);d[v++]=U*I[0]+O*b[0],d[v++]=U*I[1]+O*b[1],d[v++]=U*I[2]+O*b[2]}else for(y=i;y>0;y--){U=Math.cos(y*R),O=Math.sin(y*R);d[v++]=U*I[0]+O*b[0],d[v++]=U*I[1]+O*b[1],d[v++]=U*I[2]+O*b[2]}for(y=0;y<i;y++)f[l++]=f[3*y]+a[0],f[l++]=f[3*y+1]+a[1],f[l++]=f[3*y+2]+a[2],d[v++]=d[3*y],d[v++]=d[3*y+1],d[v++]=d[3*y+2];if(T){for(y=0;y<i-1;y++)c[m++]=y,c[m++]=y+1,c[m++]=y+i,c[m++]=y+i,c[m++]=y+1,c[m++]=y+1+i;c[m++]=0,c[m++]=i,c[m++]=i-1,c[m++]=2*i-1,c[m++]=i-1,c[m++]=i}else{for(y=0;y<i-1;y++)c[m++]=y+i,c[m++]=y+1+i,c[m++]=y,c[m++]=y,c[m++]=y+1+i,c[m++]=y+1;c[m++]=i,c[m++]=0,c[m++]=2*i-1,c[m++]=i-1,c[m++]=2*i-1,c[m++]=0}var G=l/3;for(y=0;y<i;y++)d[v++]=-p[0],d[v++]=-p[1],d[v++]=-p[2],f[l++]=f[3*y],f[l++]=f[3*y+1],f[l++]=f[3*y+2];if(T)for(y=0;y<i-2;y++)c[m++]=G,c[m++]=G+i-1-y,c[m++]=G+i-2-y;else for(y=0;y<i-2;y++)c[m++]=G,c[m++]=G+i-2-y,c[m++]=G+i-1-y;for(G=l/3,y=0;y<i;y++)d[v++]=p[0],d[v++]=p[1],d[v++]=p[2],f[l++]=f[3*(y+i)],f[l++]=f[3*(y+i)+1],f[l++]=f[3*(y+i)+2];if(T)for(y=0;y<i-2;y++)c[m++]=G,c[m++]=G+i-2-y,c[m++]=G+i-1-y;else for(y=0;y<i-2;y++)c[m++]=G,c[m++]=G+i-1-y,c[m++]=G+i-2-y;return s>0&&e.skip(3*s*4),r?(r.posBuffer=f,r.normalBuffer=d,this.indices=c):(this.vertexBuffer=new rt,this.vertexBuffer.posBuffer=f,this.vertexBuffer.normalBuffer=d,this.primitive=new Mi,this.primitive.indices=c),!0},Wt.prototype.skip=function(e){this.unstreamBBox(e);var t=e.readCompressedInt(),r=e.readCompressedInt();e.skip(12),e.skip(12*t),e.skip(24),e.skip(12*r)};var Ht=function(){Dt.call(this)};Ht.prototype=Object.create(Dt.prototype),Ht.prototype.constructor=Ht,Ht.prototype.unstream=function(e,t){var r=!0;this.unstreamBBox(e);for(var i=e.readCompressedInt(),s=new Float32Array(3*i),a=0;a<3*i;a++)s[a]=e.readFloat();var o=e.readCompressedInt(),p=o*(i+2),h=new Float32Array(3*p);for(a=0;a<o*i*3;a++)h[a]=e.readFloat();var u=new Float32Array(3);for(a=0;a<3;a++)u[a]=e.readFloat();var f=new Float32Array(3);for(a=0;a<3;a++)f[a]=e.readFloat();var d=e.readFloat(),c=o*i*3,l=o*(i+1)*3,v=new Float32Array(3),m=3*o*(i-1);if(v[0]=d*(h[m]-s[3*(i-1)]),v[1]=d*(h[m+1]-s[3*(i-1)+1]),v[2]=d*(h[m+2]-s[3*(i-1)+2]),v[0]*v[0]+v[1]*v[1]+v[2]*v[2]<.01&&(r=!1),r&&n)h[l]=h[c-3],h[l+1]=h[c-2],h[l+2]=h[c-1];else{a=0;for(var y=3*o-3;a<3*o;a+=3,y-=3)h[c+a]=h[a],h[c+a+1]=h[a+1],h[c+a+2]=h[a+2],h[l+a]=h[c-3*o+y],h[l+a+1]=h[c-3*o+y+1],h[l+a+2]=h[c-3*o+y+2]}if(r&&n){this.curveVertices=s,this.startNormal=u,this.endNormal=f,this.radius=1/d;var g=new Float32Array(3);g[0]=d*(h[0]-s[0]),g[1]=d*(h[1]-s[1]),g[2]=d*(h[2]-s[2]),this.startSideVector=g;var x=new Float32Array(3);x[0]=d*(h[3]-s[0]),x[1]=d*(h[4]-s[1]),x[2]=d*(h[5]-s[2]),u[0]=g[1]*x[2]-g[2]*x[1],u[1]=g[2]*x[0]-g[0]*x[2],u[2]=g[0]*x[1]-g[1]*x[0];var B=new Float32Array(3);B[0]=d*(h[m+3]-s[3*(i-1)]),B[1]=d*(h[m+4]-s[3*(i-1)+1]),B[2]=d*(h[m+5]-s[3*(i-1)+2]),f[0]=-v[1]*B[2]+v[2]*B[1],f[1]=-v[2]*B[0]+v[0]*B[2],f[2]=-v[0]*B[1]+v[1]*B[0];var A=e.readCompressedInt();return e.skip(3*A*4),!0}for(var I,b,C,w=new Float32Array(3*p),S=(a=0,y=o-1,0);a<o*i;a++,y--)I=(h[3*a]-s[3*S])*d,b=(h[3*a+1]-s[3*S+1])*d,C=(h[3*a+2]-s[3*S+2])*d,0==I&&0==b&&0==C?0==S?(w[3*a]=u[0],w[3*a+1]=u[1],w[3*a+2]=u[2]):(w[3*a]=f[0],w[3*a+1]=f[1],w[3*a+2]=f[2]):(w[3*a]=I,w[3*a+1]=b,w[3*a+2]=C),0==y&&(y=o,S++);for(a=0;a<3*o;a+=3)w[c+a]=u[0],w[c+a+1]=u[1],w[c+a+2]=u[2],w[l+a]=f[0],w[l+a+1]=f[1],w[l+a+2]=f[2];var P=0,M=new Uint32Array(6*(i-1)*o+6*(o-2));for(a=1;a<i;a++){for(y=0;y<o-1;y++)M[P++]=y+1+(a-1)*o,M[P++]=y+(a-1)*o,M[P++]=y+a*o,M[P++]=y+1+(a-1)*o,M[P++]=y+a*o,M[P++]=y+1+a*o;M[P++]=a*o,M[P++]=(a-1)*o,M[P++]=a*o-1,M[P++]=a*o-1,M[P++]=(1+a)*o-1,M[P++]=a*o}var F=o*i;for(a=0;a<o-2;a++)M[P++]=F,M[P++]=F+o-2-a,M[P++]=F+o-1-a;F=o*(i+1);for(a=0;a<o-2;a++)M[P++]=F,M[P++]=F+o-2-a,M[P++]=F+o-1-a;A=e.readCompressedInt();return e.skip(3*A*4),t?(t.posBuffer=h,t.normalBuffer=w,this.indices=M):(this.vertexBuffer=new rt,this.vertexBuffer.posBuffer=h,this.vertexBuffer.normalBuffer=w,this.primitive=new Mi,this.primitive.indices=M),!1},Ht.prototype.skip=function(e){this.unstreamBBox(e);var t=e.readCompressedInt();e.skip(3*t*4);var r=e.readCompressedInt();e.skip(3*r*t*4),e.skip(12),e.skip(12),e.skip(4);var i=e.readCompressedInt();e.skip(3*i*4)};var Xt=function(){Vt.call(this),this.noRender=!0,this.primitive=new Mi,this.vertexBuffer=null};Xt.prototype=Object.create(Vt.prototype),Xt.prototype.constructor=Xt,Xt.prototype.unstream=function(t){if(this.unstreamPrimitive(t),t.getLightDataStreaming()){this.vertexBuffer||(this.vertexBuffer=new rt),this.primitive.symbol=t.readCompressedInt();var r=this.vertexBuffer.posBuffer.length/3;this.primitive.start=this.primitive.indices.length,this.primitive.connectivity=e.ConnectivityTypeEnum.POINTS;var i=t.readCompressedInt();this.primitive.count=i;for(var n=0;n<i;n++)this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.readFloat()),this.primitive.indices.push(r++)}};var Yt=function(){Vt.call(this),this.noRender=!0};Yt.prototype=Object.create(Vt.prototype),Yt.prototype.constructor=Yt,Yt.prototype.unstream=function(e){this.unstreamPrimitive(e);var t,r=e.readFloat(),i=e.readFloat(),n=e.readFloat(),s=e.readFloat(),a=e.readFloat(),o=e.readFloat(),p=e.readCompressedInt();e.readCompressedInt();if(e.version<210042210){if((t=e.readCompressedInt())>0)e.readStringWithLength()}else(t=e.readUncompressedULong())>0&&e.skip(2*t);this.primitive={origin:[r,i,n],direction:[s,a,o],length:p}};var qt=function(){Vt.call(this),this.noRender=!0};qt.prototype=Object.create(Vt.prototype),qt.prototype.constructor=qt,qt.prototype.unstream=function(e){if(this.unstreamPrimitive(e),e.getLightDataStreaming()){var t=e.readFloat(),r=e.readFloat(),i=e.readFloat(),n=e.readFloat(),s=e.readFloat(),a=e.readFloat(),o=e.readFloat(),p=e.readFloat(),h=e.readFloat(),u=e.readFloat(),f=0;e.version>=1100910&&(f=e.readUnsignedChar()),this.primitive={origin:[t,r,i],direction1:[n,s,a],direction2:[o,p,h],length:u,mode:f}}};var Qt=function(){Vt.call(this),this.noRender=!0};(Qt.prototype=Object.create(Vt.prototype)).constructor=Qt,Qt.prototype.unMarshalRP=function(e){var r={},i=e[0];return 0==i>>3&&(r._wireframeMode=!!(4&i),r._labelVisibility=!!(2&i),r._orientationVisibility=!!(1&i),r._frontColor=new t.Color(e[1]/255,e[2]/255,e[3]/255),r._backColor=new t.Color(e[4]/255,e[5]/255,e[6]/255),r._opacity=e[7]),r},Qt.prototype.unstream=function(e){if(this.unstreamPrimitive(e),e.getLightDataStreaming()){var t=!1,r=!1,i=1;1==e.readUnsignedChar()&&(r=!0);var n=e.readFloat(),s=e.readFloat(),a=e.readFloat(),o=e.readFloat(),p=e.readFloat(),h=e.readFloat(),u=e.readFloat(),f=e.readFloat(),d=e.readFloat(),c=e.readFloat(),l=e.readFloat(),v=e.readUncompressedUInt(),m="";if(v){for(var y=[],g=0;g<v;g++)y.push(String.fromCharCode(e.readUnsignedShort()));m=y.join("")}var x=null;if(e.version>=210042460){var B=e.readCompressedUInt(),A=[];B&&(e.readBytes(B,A),x=this.unMarshalRP(A)),e.version>=210042510&&(t=e.readBit()),e.version>=210042610&&(i=e.readBits(3))}this.primitive={label:m,origin:[n,s,a],direction1:[o,p,h],direction2:[f,d,c],lengthX:u,lengthY:l,refPlaneData:x,mode:r,rangeScale:i,autoSize:t}}};var Jt=function(){Vt.call(this),this.noRender=!0};Jt.prototype=Object.create(Vt.prototype),Jt.prototype.constructor=Jt,Jt.prototype.unstream=function(e){this.unstreamPrimitive(e);e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readCompressedInt(),e.readCompressedInt();var t=e.readCompressedInt();if(t)e.readString(t)};var Zt=function(){Vt.call(this),this.noRender=!0};Zt.prototype=Object.create(Vt.prototype),Zt.prototype.constructor=Zt,Zt.prototype.unstream=function(e){this.unstreamPrimitive(e);var t=e.readFloat(),r=e.readFloat(),i=e.readFloat(),n=e.readFloat(),s=e.readFloat(),a=e.readFloat(),o=(e.readCompressedInt(),e.readCompressedInt());if(e.readCompressedInt())e.readStringWithLength();this.primitive={origin:[t,r,i],direction:[n,s,a],length:o}};var Kt=function(){Vt.call(this),this.noRender=!0};Kt.prototype=Object.create(Vt.prototype),Kt.prototype.constructor=Kt,Kt.prototype.unstream=function(e){this.unstreamPrimitive(e),e.skip(16),e.readCompressedInt(),e.skip(36)};var $t=function(){Vt.call(this),this.noRender=!0};$t.prototype=Object.create(Vt.prototype),$t.prototype.constructor=$t,$t.prototype.unstream=function(e){this.unstreamPrimitive(e),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readCompressedInt(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat()};var er=function(){Vt.call(this),this.vertexBuffer=null,this.primitive=new Mi,this.point=[],this.zoomQuality=0,this.imageGP=!0,this.noRender=!0};er.prototype=Object.create(Vt.prototype),er.prototype.constructor=er,er.prototype.unstream=function(t){this.unstreamPrimitive(t);if(t.readUnsignedChar()){var r=(new je).unstream(t);this.point.push(t.readFloat()),this.point.push(t.readFloat()),this.point.push(t.readFloat());t.readCompressedInt(),t.readCompressedInt(),t.readCompressedInt();if(null==r)return!1;var i=t.textures.add(r),n=r.width,s=r.height;this.vertexBuffer||(this.vertexBuffer=new rt),this.primitive.start=this.primitive.indices.length;var a=this.vertexBuffer.posBuffer.length/3;this.vertexBuffer.posBuffer.push(0),this.vertexBuffer.posBuffer.push(0),this.vertexBuffer.posBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1),this.vertexBuffer.posBuffer.push(n),this.vertexBuffer.posBuffer.push(0),this.vertexBuffer.posBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1),this.vertexBuffer.posBuffer.push(n),this.vertexBuffer.posBuffer.push(s),this.vertexBuffer.posBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1),this.vertexBuffer.posBuffer.push(0),this.vertexBuffer.posBuffer.push(s),this.vertexBuffer.posBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1),this.primitive.connectivity=e.ConnectivityTypeEnum.TRIANGLES,this.primitive.count=6,this.primitive.indices.push(a),this.primitive.indices.push(a+1),this.primitive.indices.push(a+2),this.primitive.indices.push(a+2),this.primitive.indices.push(a+3),this.primitive.indices.push(a+0),this.vertexBuffer.hasTextures=!0,this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(1),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(1),this.vertexBuffer.textureBuffer.push(1),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(1),this.vertexBuffer.textureBuffer.push(0);var o={textureId:i,shading:"Basic",primWithMaterials:!0,useAsGas:!0},p={file:"",id:t.materials.add(o)};return this.primitive.material=p,!0}return!1};var tr=1,rr=2,ir=14,nr=15,sr=16,ar=17,or=18,pr=19,hr=20,ur=21,fr=22,dr=23,cr=24,lr=25,vr=26,mr=27,yr=28,gr=29,xr=30,Br=31,Ar=32,Ir=function(){Vt.call(this),this.vertexBuffer=null,this.primitive=new Mi};Ir.prototype=Object.create(Vt.prototype),Ir.prototype.constructor=Ir,Ir.prototype.lineType=null,Ir.prototype.unstream=function(t){this.unstreamPrimitive(t);var r=t.readUnsignedChar(),i=[];t.readFloatArray(0,4,i),this.vertexBuffer||(this.vertexBuffer=new rt),this.primitive.start=this.primitive.indices.length;var n=this.vertexBuffer.posBuffer.length/3;return this.vertexBuffer.posBuffer.push(i[0]),this.vertexBuffer.posBuffer.push(i[1]),this.vertexBuffer.posBuffer.push(t.idOrder),this.vertexBuffer.posBuffer.push(i[2]),this.vertexBuffer.posBuffer.push(i[1]),this.vertexBuffer.posBuffer.push(t.idOrder),this.vertexBuffer.posBuffer.push(i[2]),this.vertexBuffer.posBuffer.push(i[3]),this.vertexBuffer.posBuffer.push(t.idOrder),this.vertexBuffer.posBuffer.push(i[0]),this.vertexBuffer.posBuffer.push(i[3]),this.vertexBuffer.posBuffer.push(t.idOrder),r?(this.primitive.connectivity=e.ConnectivityTypeEnum.TRIANGLES,this.primitive.count=6,this.primitive.indices.push(n),this.primitive.indices.push(n+1),this.primitive.indices.push(n+2),this.primitive.indices.push(n+2),this.primitive.indices.push(n+3),this.primitive.indices.push(n+0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1)):(this.primitive.connectivity=e.ConnectivityTypeEnum.LINES,this.primitive.count=8,this.primitive.indices.push(n),this.primitive.indices.push(n+1),this.primitive.indices.push(n+1),this.primitive.indices.push(n+2),this.primitive.indices.push(n+2),this.primitive.indices.push(n+3),this.primitive.indices.push(n+3),this.primitive.indices.push(n+0)),!0};var br=function(){Vt.call(this),this.vertexBuffer=null,this.primitive=new Mi,this.primitives=[]};br.prototype=Object.create(Vt.prototype),br.prototype.constructor=br,br.prototype.lineType=null,br.prototype.unstream=function(e){if(this.unstreamPrimitive(e),e.version>1101410){e.readCompressedInt();var r=[];e.readFloatArray(0,2,r);var i=e.readFloat(),n=e.readCompressedInt()}var s=[];e.readFloatArray(0,2,s);var a=new t.Vector2(s[0],s[1]);a.normalize();var o=e.readFloat(),p=i*Math.tan(o);this.vertexBuffer||(this.vertexBuffer=new rt);var h=this.vertexBuffer.posBuffer.length/3;switch(n!==Br&&(this.vertexBuffer.posBuffer.push(r[0]-a.x*i+a.y*p),this.vertexBuffer.posBuffer.push(r[1]-a.y*i-a.x*p),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(r[0]),this.vertexBuffer.posBuffer.push(r[1]),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(r[0]-a.x*i-a.y*p),this.vertexBuffer.posBuffer.push(r[1]-a.y*i+a.x*p),this.vertexBuffer.posBuffer.push(e.idOrder)),n){case ir:var u=new Mi;this.createPolylineGP(h,u,3,1),this.primitive=u;break;case nr:(u=new Mi).count=0;var f=[0,1,2];this.createPolygonGP(0,u,f,f.length,0,!1),this.primitive=u;break;case sr:case ar:(u=new Mi).count=0;f=[0,1,2];this.createPolygonGP(0,u,f,f.length,0,!0),this.primitive=u;break;case xr:u=new Mi;this.createPolylineGP(h,u,3,1);h=this.vertexBuffer.posBuffer.length/3;this.vertexBuffer.posBuffer.push(r[0]-i*a.x-a.x*i+a.y*p),this.vertexBuffer.posBuffer.push(r[1]-i*a.y-a.y*i-a.x*p),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(r[0]-i*a.x),this.vertexBuffer.posBuffer.push(r[1]-i*a.y),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(r[0]-i*a.x-a.x*i-a.y*p),this.vertexBuffer.posBuffer.push(r[1]-i*a.y-a.y*i+a.x*p),this.vertexBuffer.posBuffer.push(e.idOrder),this.createPolylineGP(h,u,3,1),this.primitive=u;break;case Ar:(u=new Mi).count=0;f=[0,1,2];this.createPolygonGP(0,u,f,f.length,0,!0);h=this.vertexBuffer.posBuffer.length/3;this.vertexBuffer.posBuffer.push(r[0]-i*a.x-a.x*i+a.y*p),this.vertexBuffer.posBuffer.push(r[1]-i*a.y-a.y*i-a.x*p),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(r[0]-i*a.x),this.vertexBuffer.posBuffer.push(r[1]-i*a.y),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(r[0]-i*a.x-a.x*i-a.y*p),this.vertexBuffer.posBuffer.push(r[1]-i*a.y-a.y*i+a.x*p),this.vertexBuffer.posBuffer.push(e.idOrder);f=[3,5,4];this.createPolygonGP(0,u,f,f.length,0,!0),this.primitive=u;break;case Br:o=Math.acos(-a.y);o=Math.asin(a.x)<0?-o:o;var d=.5*i,c=17;if(Gn){var l=Gn,v=Math.PI,m=400;if(d*Math.PI*2<Gn);else{l>d&&(l=d);var y=Math.acos(1-l/d);m=0==y?400:Math.PI/y+.5}c=Math.floor(v*m*(1/(2*Math.PI))+2.5)}var g=r[0]+d*a.y,x=r[1]-d*a.x,B=new Mi;this.create2DArcCircleGP(this.vertexBuffer,B,g,x,d,o,o+Math.PI,c,!1,e);g=r[0]-d*a.y,x=r[1]+d*a.x;this.create2DArcCircleGP(this.vertexBuffer,B,g,x,d,o+Math.PI,o,c,!1,e),this.primitive=B;break;default:B=new Mi;this.create2DArcCircleGP(this.vertexBuffer,B,r[0],r[1],i/2,0,2*Math.PI,17,!0,e),this.primitive=B}return!0};var Cr=function(){Vt.call(this),this.vertexBuffer=null,this.primitive=new Mi,this.primitives=[]};Cr.prototype=Object.create(Vt.prototype),Cr.prototype.constructor=Cr,Cr.prototype.lineType=null,Cr.prototype.unstream=function(e){this.unstreamPrimitive(e);e.readCompressedInt();var t=[];e.readFloatArray(0,2,t);var r=e.readFloat(),i=17;if(Gn){var n=r/2,s=Gn,a=2*Math.PI,o=400;if(n*Math.PI*2<Gn);else{s>n&&(s=n);var p=Math.acos(1-s/n);o=0==p?400:Math.PI/p+.5}i=Math.floor(a*o*(1/(2*Math.PI))+2.5)}var h=e.readCompressedInt();this.vertexBuffer||(this.vertexBuffer=new rt);var u=this.vertexBuffer.posBuffer.length/3;switch(h){case or:var f=new Mi;this.create2DArcCircleGP(this.vertexBuffer,f,t[0],t[1],r/2,0,2*Math.PI,i,!1,e),this.primitive=f;break;case pr:case yr:f=new Mi;this.create2DArcCircleGP(this.vertexBuffer,f,t[0],t[1],r/2,0,2*Math.PI,i,!1,e),this.primitive=f;break;case hr:f=new Mi;this.create2DArcCircleGP(this.vertexBuffer,f,t[0],t[1],r/2,0,2*Math.PI,i,!0,e),this.primitive=f;break;case ur:f=new Mi;this.create2DArcCircleGP(this.vertexBuffer,f,t[0],t[1],r/2,0,2*Math.PI,i,!0,e);var d=e.materials.add({backgoundColor:!0});f.material={file:"",id:d},this.primitives.push(f);var c=new Mi;this.create2DArcCircleGP(this.vertexBuffer,c,t[0],t[1],r/2,0,2*Math.PI,i,!1,e);var l=(g=r/2)*Math.cos(Math.PI/4),v=g*Math.sin(Math.PI/4),m=g*Math.cos(5*Math.PI/4),y=g*Math.sin(5*Math.PI/4);u=this.vertexBuffer.posBuffer.length/3;this.vertexBuffer.posBuffer.push(t[0]+l),this.vertexBuffer.posBuffer.push(t[1]+v),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]+m),this.vertexBuffer.posBuffer.push(t[1]+y),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]-l),this.vertexBuffer.posBuffer.push(t[1]-y),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]-m),this.vertexBuffer.posBuffer.push(t[1]-v),this.vertexBuffer.posBuffer.push(e.idOrder),this.createPolylineGP(u,c,4,0),this.primitives.push(c);break;case fr:case dr:case vr:case mr:var g=r/2;this.vertexBuffer.posBuffer.push(t[0]-g),this.vertexBuffer.posBuffer.push(t[1]-g),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]-g),this.vertexBuffer.posBuffer.push(t[1]+g),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]+g),this.vertexBuffer.posBuffer.push(t[1]+g),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]+g),this.vertexBuffer.posBuffer.push(t[1]-g),this.vertexBuffer.posBuffer.push(e.idOrder);var x=new Mi;x.count=0;var B=[0,1,2,0,2,3];this.createPolygonGP(0,x,B,B.length,0,!0),this.primitive=x;break;case cr:case lr:case gr:g=r/2;this.vertexBuffer.posBuffer.push(t[0]),this.vertexBuffer.posBuffer.push(t[1]+g),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]-g),this.vertexBuffer.posBuffer.push(t[1]-g),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]+g),this.vertexBuffer.posBuffer.push(t[1]-g),this.vertexBuffer.posBuffer.push(e.idOrder);var A=new Mi;A.count=0;B=[0,1,2];this.createPolygonGP(0,A,B,B.length,0,!0),this.primitive=A;break;case tr:case rr:var I=.5*r,b=1,C=0;h==tr&&(C=-(b=Math.PI/4)),b*=I,C*=I,this.vertexBuffer.posBuffer.push(t[0]+b),this.vertexBuffer.posBuffer.push(t[1]+C),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]-b),this.vertexBuffer.posBuffer.push(t[1]-C),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]-C),this.vertexBuffer.posBuffer.push(t[1]+b),this.vertexBuffer.posBuffer.push(e.idOrder),this.vertexBuffer.posBuffer.push(t[0]+C),this.vertexBuffer.posBuffer.push(t[1]-b),this.vertexBuffer.posBuffer.push(e.idOrder);var w=new Mi;this.createPolylineGP(u,w,4,0),this.primitive=w;break;default:f=new Mi;this.create2DArcCircleGP(this.vertexBuffer,f,t[0],t[1],r/2,0,2*Math.PI,i,!0,e),this.primitive=f}return!0};var wr=function(){Vt.call(this),this.vertexBuffer=null,this.primitive=new Mi,this.point=[],this.zoomQuality=2,this.imageGP=!0};wr.prototype=Object.create(Vt.prototype),wr.prototype.constructor=wr,wr.prototype.lineType=null,wr.prototype.unstream=function(t){this.unstreamPrimitive(t),t.readFloatArray(0,2,this.point),this.point.push(0);t.readCompressedInt(),t.readCompressedInt(),t.readCompressedInt(),t.readCompressedInt();this.zoomQuality=t.readCompressedInt();var r=null;t.readBoolean()&&(r=(new je).unstream(t));if(null==r)return!1;var i=t.textures.add(r),n=r.width*r.xPixelSize,s=r.height*r.yPixelSize;0==this.zoomQuality&&(n=r.width,s=r.height),this.vertexBuffer||(this.vertexBuffer=new rt),this.primitive.start=this.primitive.indices.length;var a=this.vertexBuffer.posBuffer.length/3;this.vertexBuffer.posBuffer.push(this.point[0]),this.vertexBuffer.posBuffer.push(this.point[1]),this.vertexBuffer.posBuffer.push(t.idOrder),this.vertexBuffer.posBuffer.push(this.point[0]+n),this.vertexBuffer.posBuffer.push(this.point[1]),this.vertexBuffer.posBuffer.push(t.idOrder),this.vertexBuffer.posBuffer.push(this.point[0]+n),this.vertexBuffer.posBuffer.push(this.point[1]+s),this.vertexBuffer.posBuffer.push(t.idOrder),this.vertexBuffer.posBuffer.push(this.point[0]),this.vertexBuffer.posBuffer.push(this.point[1]+s),this.vertexBuffer.posBuffer.push(t.idOrder),this.primitive.connectivity=e.ConnectivityTypeEnum.TRIANGLES,this.primitive.count=6,this.primitive.indices.push(a),this.primitive.indices.push(a+1),this.primitive.indices.push(a+2),this.primitive.indices.push(a+2),this.primitive.indices.push(a+3),this.primitive.indices.push(a+0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(1),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(1),this.vertexBuffer.textureBuffer.push(1),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(0),this.vertexBuffer.textureBuffer.push(1),this.vertexBuffer.textureBuffer.push(0);var o={textureId:i,shading:"Basic",primWithMaterials:!0,useAsGas:!0},p={file:"",id:t.materials.add(o)};return this.primitive.material=p,!0};var Sr=function(){Vt.call(this),this.vertexBuffer=null,this.primitives=[],this.primitive=new Mi};Sr.prototype=Object.create(Vt.prototype),Sr.prototype.constructor=Sr,Sr.prototype.lineType=null,Sr.prototype.unstream=function(e){return this.skip(e),!1},Sr.prototype.skip=function(e){this.unstreamPrimitive(e);e.readFloatArray(0,2,[]),e.readFloatArray(0,2,[]);e.readFloat(),e.readFloat(),e.readFloat(),e.readCompressedInt();e.readFloatArray(0,10,[]),e.readFloatArray(0,2,[]);e.readStringWithLength()};var Pr=function(){Vt.call(this),this.vertexBuffer=null,this.primitive=new Mi,this.text=null};Pr.prototype=Object.create(Vt.prototype),Pr.prototype.constructor=Pr,Pr.prototype.lineType=null,Pr.prototype.unstream=function(e){this.unstreamPrimitive(e);var t=[];e.readFloatArray(0,2,t);var r=e.readFloat();e.readCompressedInt(),e.readCompressedInt();e.readBoolean()&&e.readGraphicAttributeSet(),e.readBoolean()&&e.readGraphicAttributeSet();var i=e.readCompressedInt();if(i>0){var n="",s=[];e.readShortArray(i,s);for(var a=0;a<i;a++)n+=String.fromCharCode(s[a])}return this.text={text:n,anchor:{x:t[0],y:t[1]},height:r},!1};var Mr=function(){Vt.call(this),this.vertexBuffer=null,this.primitive=new Mi,this.nodes=[]};Mr.prototype=Object.create(Vt.prototype),Mr.prototype.constructor=Mr,Mr.prototype.lineType=null,Mr.prototype.unstream=function(t){this.unstreamPrimitive(t);var r=t.readCompressedInt(),i=t.readCompressedInt(),n=t.readCompressedInt(),s=t.readCompressedInt(),a=t.readCompressedInt(),o=t.readFloat(),p=t.readFloat(),h=t.readFloat(),u=[];if(r>0&&i>0){var f=[],d=[];t.readFloatArray(0,2*i,f),t.readFloatArray(0,r,this.nodes),t.readFloatArray(0,i,d)}if(n>0){t.readFloatArray(0,2*n,[])}this.vertexBuffer||(this.vertexBuffer=new rt),this.primitive.start=this.primitive.indices.length;var c=this.vertexBuffer.posBuffer.length/3;if(this.primitive.connectivity=e.ConnectivityTypeEnum.LINES,s){t.readFloatArray(0,2*s,u);for(var l=0;l<s;l++)this.primitive.indices.push(c++),this.vertexBuffer.posBuffer.push(u[2*l]),this.vertexBuffer.posBuffer.push(u[2*l+1]),this.vertexBuffer.posBuffer.push(t.idOrder),this.primitive.indices.push(c);return this.primitive.count=2*s-2,!0}var v=p-o;if(0==v)return!1;var m=Math.PI/Math.acos(1-.01/h)*.5+.5;m>100&&(m=100);var y,g,x,B=m+1,A=v/m;x=o;for(var I=!0,b=0;b<m+1;b++){var C,w,S,P;C=0,w=0,S=0,P=0;var M=0;for(l=0;l<i;l++)C+=(P=Math.abs(x-p)<=1e-5&&l==i-1?1:this.computeBSplineBase(l,a,x,1))*f[M]*d[l],w+=P*f[M+1]*d[l],S+=P*d[l],M+=2;S<=1e-15?B--:(y=C/S,g=w/S,this.vertexBuffer.posBuffer.push(y),this.vertexBuffer.posBuffer.push(g),this.vertexBuffer.posBuffer.push(t.idOrder),I||(this.primitive.indices.push(c++),this.primitive.indices.push(c)),I=!1),x=o+(b+1)*A}return B>0&&(this.primitive.count=2*B-2,!0)},Mr.prototype.computeBSplineBase=function(e,t,r,i){var n=0;if(1==t)n=r>=this.nodes[e]&&r<this.nodes[e+1]?1:0;else if(r<this.nodes[e]||r>=this.nodes[e+t])n=0;else{var s=this.computeBSplineBase(e,t-1,r,i),a=this.computeBSplineBase(e+1,t-1,r,i),o=1e-6*i;n=(Math.abs(this.nodes[e]-this.nodes[e+t-1])<=o?0:(r-this.nodes[e])/(this.nodes[e+t-1]-this.nodes[e]))*s+(Math.abs(this.nodes[e+1]-this.nodes[e+t])<=o?0:(this.nodes[e+t]-r)/(this.nodes[e+t]-this.nodes[e+1]))*a}return n};var Fr=function(){Vt.call(this),this.vertexBuffer=null,this.primitive=new Mi};Fr.prototype=Object.create(Vt.prototype),Fr.prototype.constructor=Fr,Fr.prototype.lineType=null,Fr.prototype.unstream=function(t){this.unstreamPrimitive(t);var r=t.readCompressedInt(),i=[];if(r>0){t.readFloatArray(0,2*r,i),this.vertexBuffer||(this.vertexBuffer=new rt),this.primitive.start=this.primitive.indices.length;var n=this.vertexBuffer.posBuffer.length/3;if(this.primitive.connectivity=e.ConnectivityTypeEnum.LINES,r<4)return!1;var s,a,o,p,h,u,f,d,c,l,v,m,y,g,x=(r-1)%3,B=r-x,A=0;s=i[0],a=i[1];for(var I=2,b=0;b<B-1;b+=3){c=(f=i[I+4])-s+3*(o=i[I])-3*(h=i[I+2]),l=(d=i[I+5])-a+3*(p=i[I+1])-3*(u=i[I+3]),v=3*(h-2*o+s),m=3*(u-2*p+a),y=3*(o-s),g=3*(p-a);var C=Math.sqrt((s-f)*(s-f)+(a-d)*(a-d))/2;A=.01;var w=0;if(C>0&&A>=0&&A<=2*C){var S=Math.acos(1-A/C);S>0&&(w=Math.floor(Math.PI/S*.5+.5))}w<=0&&(w=1),w>100&&(w=100);var P,M,F,T=w+1,R=1/w;P=s,M=a,this.vertexBuffer.posBuffer.push(P),this.vertexBuffer.posBuffer.push(M),this.vertexBuffer.posBuffer.push(t.idOrder),F=R;for(var U=0;U<w;U++)P=c*Math.pow(F,3)+v*Math.pow(F,2)+y*F+s,M=l*Math.pow(F,3)+m*Math.pow(F,2)+g*F+a,this.vertexBuffer.posBuffer.push(P),this.vertexBuffer.posBuffer.push(M),this.vertexBuffer.posBuffer.push(t.idOrder),this.primitive.indices.push(n++),this.primitive.indices.push(n),F+=R;this.primitive.count=2*T-2,s=f,a=d,I+=6}if(x>0)for(b=0;b<x+1;b++)this.vertexBuffer.posBuffer.push(i[2*(B-1+b)]),this.vertexBuffer.posBuffer.push(i[2*(B-1+b)+1]),this.primitive.indices.push(n++),this.primitive.indices.push(n);return this.primitive.count+=2*(x+1),!0}return!1};var Tr=function(){Vt.call(this),this.vertexBuffer=null,this.primitive=new Mi,this.primitives=[]};Tr.prototype=Object.create(Vt.prototype),Tr.prototype.constructor=Tr,Tr.prototype.lineType=null,Tr.prototype.unstream=function(t){this.unstreamPrimitive(t);var r=t.readCompressedInt(),i=[],n=0;t.readUncompressedIntArray(r,i);for(var s=0;s<r;++s)n+=i[s];var a=0;a=t.version<1101840||t.version>=21e5&&t.version<2100130?n:t.readCompressedInt();var o=[];t.readFloatArray(0,2*a,o),this.vertexBuffer||(this.vertexBuffer=new rt);var p=this.vertexBuffer.posBuffer.length/3;for(s=0;s<a;s++)this.vertexBuffer.posBuffer.push(o[2*s]),this.vertexBuffer.posBuffer.push(o[2*s+1]),this.vertexBuffer.posBuffer.push(t.idOrder);if(t.readCompressedInt()){var h=new Mi;h.cgmId=this.primitive.cgmId,h.start=h.indices.length,h.connectivity=e.ConnectivityTypeEnum.TRIANGLES;var u=t.readCompressedInt(),f=[],d=[],c=0,l=[];t.readUncompressedIntArray(u,f),t.readUncompressedIntArray(u,d);for(s=0;s<u;++s)c+=f[s];t.readUncompressedIntArray(c,l),h.count=0;var v=0;for(s=0;s<u;++s)switch(d[s]){case 0:case 4:h.count+=f[s];for(var m=0;m<f[s];++m)h.indices.push(l[v++]-1);break;case 1:case 5:h.count+=3*(f[s]-2);var y=0;for(m=0;m<f[s]-2;m++)h.indices.push(l[v]-1),h.indices.push(l[v+1+y]-1),h.indices.push(l[v+2-y]-1),v++,y=1-y;v+=2;break;case 2:case 6:h.count+=3*(f[s]-2);var g=l[v]-1;for(m=0;m<f[s]-2;m++)h.indices.push(g),h.indices.push(l[v+2]-1),h.indices.push(l[v+1]-1),v++;v+=2;break;default:return null}return this.primitives.push(h),!0}var x=new Mi;x.cgmId=this.primitive.cgmId,x.start=x.indices.length,x.connectivity=e.ConnectivityTypeEnum.LINES,x.count=2*a-2;for(g=p,s=1;s<a;s++)x.indices.push(p++),x.indices.push(p);return x.indices.push(p),x.indices.push(g),this.primitives.push(x),!0};var Rr=function(){Vt.call(this),this.vertexBuffer=null,this.primitive=new Mi,this.text=null,this.noRender=!0};Rr.prototype=Object.create(Vt.prototype),Rr.prototype.constructor=Rr,Rr.prototype.lineType=null,Rr.prototype.unstream=function(t){var r=t.readCompressedInt(),i=[];t.readBytes(r,i);for(var n="",s=0;s<i.length;s++)n+=String.fromCharCode(i[s]);var a=n.substring(n.length-5,n.length),o=!0;".font"!==a&&".FONT"!==a||(o=!1);var h=t.readCompressedInt(),u="";for(s=0;s<h;s++)u+=String.fromCharCode(t.readUnsignedShort());t.readUnsignedShort();t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat();var f=t.readShort();t.readFloatArray(0,4,[]);var d=t.readFloat(),c=t.readShort();t.readShort();t.readFloatArray(0,2,[]);t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat();var l=t.readShort();if(t.version>=2100020||t.version>=1101600&&t.version<21e5)t.readCompressedInt();if(t.version>=2100070||t.version>=1101730&&t.version<21e5)t.readCompressedInt();t.readCompressedInt(),t.readCompressedInt();var v=[t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat()];if(t.version>=1101330)t.readFloat();var m=[];if((t.readFloatArray(0,22,m),o&&(t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat()),t.version>=210042530)&&t.readBit()){if(this.vertexBuffer||(this.vertexBuffer=new rt),t.readBit()){var y=0,g=[];(y=t.readCompressedInt())>0&&t.readFloatArray(0,2*y,g);for(s=0;s<y;++s)this.vertexBuffer.posBuffer.push(g[2*s]),this.vertexBuffer.posBuffer.push(g[2*s+1]),this.vertexBuffer.posBuffer.push(0);var x=t.readCompressedInt(),B=[];x>0&&t.readUncompressedIntArray(x,B);for(s=0;s<x;++s)B[s]-=1;var A=[],I=[],b=0;(P=t.readCompressedInt())>0&&(t.readUncompressedIntArray(P,A),t.readUncompressedIntArray(P,I));for(s=0;s<P;s++)switch(this.primitive.connectivity=e.ConnectivityTypeEnum.TRIANGLES,I[s]){case 0:case 4:this.primitive.count+=A[s];for(var C=0;C<A[s];++C)this.primitive.indices.push(B[b++]);break;case 1:case 5:this.primitive.count+=3*(A[s]-2);var w=0;for(C=0;C<A[s]-2;C++)this.primitive.indices.push(B[b]),this.primitive.indices.push(B[b+1+w]),this.primitive.indices.push(B[b+2-w]),b++,w=1-w;b+=2;break;case 2:case 6:this.primitive.count+=3*(A[s]-2);var S=B[b];for(C=0;C<A[s]-2;C++)this.primitive.indices.push(S),this.primitive.indices.push(B[b+2]),this.primitive.indices.push(B[b+1]),b++;b+=2;break;default:return null}}else{y=0,g=[];(y=t.readCompressedInt())>0&&t.readFloatArray(0,2*y,g);for(s=0;s<y;++s)this.vertexBuffer.posBuffer.push(g[2*s]),this.vertexBuffer.posBuffer.push(g[2*s+1]),this.vertexBuffer.posBuffer.push(0);A=[];var P,M=0;(P=t.readCompressedInt())>0&&t.readUncompressedIntArray(P,A);for(s=0;s<P;s++){this.primitive.connectivity=e.ConnectivityTypeEnum.LINES,this.primitive.count+=A[s];for(C=1;C<A[s];++C)this.primitive.indices.push(M++),this.primitive.indices.push(M);M++}}return!0}if(p&&h){var F=t.getStaticMode(),T=t.getCurrentMatrix();this.text={text:u,attachedPoint:F,bbox:v,horJustif:f,verJustification:l,matrix:T,fontName:n,color:null,stroke:!1,path:c,bold:!1,italic:!1,width:m[21],orientationAngle:d}}};var Ur=function(){Vt.call(this),this.vertexBuffer=null,this.primitive=new Mi};(Ur.prototype=Object.create(Vt.prototype)).constructor=Ur,Ur.prototype.lineType=null,Ur.prototype.unstream=function(e){var t=Or.prototype.unstream.call(this,e),r=e.readCompressedInt();if(r>0){e.readUncompressedIntArray(r,[])}return t};var Or=function(){Vt.call(this),this.vertexBuffer=null,this.primitive=new Mi};Or.prototype=Object.create(Vt.prototype),Or.prototype.constructor=Or,Or.prototype.lineType=null,Or.prototype.unstream=function(t){this.unstreamPrimitive(t);var r=t.readUnsignedChar();if(t.version>=1101900&&t.version<21e5||t.version>=2100170){if(0==t.readCompressedInt())return t.readCompressedInt(),t.readCompressedInt(),!1;var i=[];if((l=t.readCompressedInt())>0){var n=[];t.readFloatArray(0,2*l,i)}var s=t.readCompressedInt();this.vertexBuffer||(this.vertexBuffer=new rt),this.primitive.start=this.primitive.indices.length;for(var a=this.vertexBuffer.posBuffer.length/3,o=0;o<l;++o)this.vertexBuffer.posBuffer.push(i[2*o]),this.vertexBuffer.posBuffer.push(i[2*o+1]),this.vertexBuffer.posBuffer.push(t.idOrder);if(s>0){if(4!=r&&3!=r||!u)for(o=0;o<l;++o)this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(1);else for(var o=0;o<l;++o)this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0),this.vertexBuffer.normalBuffer.push(0);var p=[],h=[];for(o=0;o<s;++o)p[o]=t.readUncompressedInt();for(o=0;o<s;++o)h[o]=t.readUncompressedInt();var f=0;for(o=0;o<s;o++)f+=h[o];var d=[];for(o=0;o<f;++o)d[o]=t.readUncompressedInt()-1;this.primitive.count=0;var c=a;for(o=0;o<s;++o)c=this.createPolygonGP(c,this.primitive,d,h[o],p[o],!0)}else this.createPolygonGP(a,this.primitive,void 0,l,void 0,!1);return 4!=r&&3!=r||!!u&&2}this.vertexBuffer||(this.vertexBuffer=new rt),this.primitive.connectivity=e.ConnectivityTypeEnum.TRIANGLES,this.primitive.start=this.primitive.indices.length;var l;a=this.vertexBuffer.posBuffer.length/3;if((l=t.readCompressedInt())>0){n=[];t.readFloatArray(0,2*l,n)}if(1==r){if((s=t.readCompressedInt())>0){for(p=[],h=[],o=0;o<s;++o)p[o]=t.readUncompressedInt();for(o=0;o<s;++o)h[o]=t.readUncompressedInt(),0!==p[o]&&4!==p[o]||h[o]/3,1!==p[o]&&5!==p[o]||h[o]-2,2!==p[o]&&6!==p[o]||h[o]-2;var v=0;for(o=0;o<s;o++)v+=h[o];var m=[];for(o=0;o<v;++o)m[o]=t.readUncompressedInt();var y=0;for(o=0;o<s;++o){if(0===p[o]||4===p[o]){v=h[o];for(var g=0;g<v;++g)this.primitive.indices.push(m[y++]-1+a)}if(1===p[o]||5===p[o]){var x=h[o];for(g=2;g<x;++g)g%2?(this.primitive.indices.push(m[y+g]-1+a),this.primitive.indices.push(m[y+g-1]-1+a),this.primitive.indices.push(m[y+g-2]-1+a)):(this.primitive.indices.push(m[y+g-1]-1+a),this.primitive.indices.push(m[y+g]-1+a),this.primitive.indices.push(m[y+g-2]-1+a));y+=x}if(2===p[o]||6===p[o]){var B=h[o];for(g=2;g<B;++g)this.primitive.indices.push(m[y]-1+a),this.primitive.indices.push(m[y+g-1]-1+a),this.primitive.indices.push(m[y+g]-1+a);y+=B}}this.primitive.count=this.primitive.indices.length}for(o=0;o<l;++o)this.vertexBuffer.posBuffer.push(n[2*o]),this.vertexBuffer.posBuffer.push(n[2*o+1]),this.vertexBuffer.posBuffer.push(t.idOrder)}return 4!=r&&3!=r};var Gr=function(){Vt.call(this),this.primitive=new Mi};Gr.prototype=Object.create(Vt.prototype),Gr.prototype.constructor=Gr,Gr.prototype.lineType=null,Gr.prototype.unstream=function(e){this.unstreamPrimitive(e);var t=e.readDouble(),r=e.readDouble(),i=e.readDouble(),n=e.readDouble(),s=e.readDouble(),a=e.readUnsignedChar(),o=e.readCompressedInt(),p=(e.readDouble(),e.readDouble(),17);if(Gn){var h=Gn,u=s-n,f=400;if(0==o)if(i*Math.PI*2<Gn);else{h>i&&(h=i);var d=Math.acos(1-h/i);f=0==d?400:Math.PI/d+.5}p=Math.floor(u*f*(1/(2*Math.PI))+2.5)}return this.vertexBuffer||(this.vertexBuffer=new rt),this.create2DArcCircleGP(this.vertexBuffer,this.primitive,t,r,i,n,s,p,a,e),!0};var Nr=function(){Vt.call(this),this.vertexBuffer=null,this.primitive=new Mi};Nr.prototype=Object.create(Vt.prototype),Nr.prototype.constructor=Nr,Nr.prototype.lineType=null,Nr.prototype.unstream=function(t){this.unstreamPrimitive(t),this.primitive.connectivity=e.ConnectivityTypeEnum.LINES,this.vertexBuffer||(this.vertexBuffer=new rt);var r=this.vertexBuffer.posBuffer.length/3,i=t.readCompressedInt(),n=t.readUnsignedChar(),s=!1;0==n&&1&i&&(i--,s=!0);for(var a=0;a<i;++a)this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.idOrder);if(s&&(t.readFloat(),t.readFloat()),this.createPolylineGP(r,this.primitive,i,n),t.version>=1101850&&t.version<21e5||t.version>=2100170)t.readUnsignedChar();else if(2==i){var o=this.vertexBuffer.posBuffer.length-6;this.vertexBuffer.posBuffer[o],this.vertexBuffer.posBuffer[o+3],this.vertexBuffer.posBuffer[o],this.vertexBuffer.posBuffer[o+3];(this.vertexBuffer.posBuffer[o+1]-this.vertexBuffer.posBuffer[o+4])*(this.vertexBuffer.posBuffer[o+1]-this.vertexBuffer.posBuffer[o+4])}return!0};var Er=function(){Vt.call(this),this.vertexBuffer=null,this.primitive=new Mi};Er.prototype=Object.create(Vt.prototype),Er.prototype.constructor=Er,Er.prototype.lineType=null,Er.prototype.unstream=function(t){this.unstreamPrimitive(t),this.vertexBuffer||(this.vertexBuffer=new rt),this.primitive.symbol=t.readCompressedInt();var r=this.vertexBuffer.posBuffer.length/3;this.primitive.start=this.primitive.indices.length,this.primitive.connectivity=e.ConnectivityTypeEnum.POINTS;var i=t.readCompressedInt();this.primitive.count=i;for(var n=0;n<i;n++)this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.idOrder),this.primitive.indices.push(r++);return!0};var Vr=function(){Vt.call(this),this.vertexBuffer=null,this.primitive=new Mi};Vr.prototype=Object.create(Vt.prototype),Vr.prototype.constructor=Vr,Vr.prototype.lineType=null,Vr.prototype.unstream=function(r){this.unstreamPrimitive(r);var i=r.readDouble(),n=r.readDouble(),s=r.readDouble(),a=r.readDouble(),o=r.readDouble(),p=r.readDouble(),h=r.readDouble(),u=r.readUnsignedChar(),f=r.readCompressedInt(),d=r.readDouble(),c=r.readDouble(),l=s>a?s:a;p<o&&(p+=2*Math.PI),o<0&&(o+=2*Math.PI,p+=2*Math.PI);var v=p-o,m=17;if(Gn){var y=Gn,g=(v=p-o,400);if(0==f)if(l*Math.PI*2<Gn);else y>l&&(y=l),g=0==(A=Math.acos(1-y/l))?400:Math.PI/A+.5;m=Math.floor(v*g*(1/(2*Math.PI))+2.5)}var x=v/(m-1),B=[];B[0]=d*s,B[1]=c*a,B[2]=r.idOrder;var A=a/s,I=Math.cos(x),b=Math.sin(x),C=0,w=3;for(C=1;C<m;C++)B[w]=I*B[w-3]-b*B[w-2]/A,B[w+1]=b*B[w-3]*A+I*B[w-2],B[w+2]=r.idOrder,w+=3;var S=new t.Matrix4;S.makeRotationZ(h),S.setPosition({x:i,y:n,z:0}),w=0;var P=new t.Vector4;for(C=0;C<m;C++)P.set(B[w],B[w+1],0,1),P.applyMatrix4(S),B[w]=P.x,B[w+1]=P.y,B[w+2]=r.idOrder,w+=3;this.vertexBuffer||(this.vertexBuffer=new rt),this.primitive.start=this.primitive.indices.length;var M=this.vertexBuffer.posBuffer.length/3;if(u){this.primitive.connectivity=e.ConnectivityTypeEnum.TRIANGLES,this.primitive.count=3*(m-2),this.vertexBuffer.posBuffer=B;for(C=1;C<m-1;C++)this.primitive.indices.push(0),this.primitive.indices.push(C),this.primitive.indices.push(C+1)}else{this.primitive.connectivity=e.ConnectivityTypeEnum.LINES,this.primitive.count=2+2*(m-2),this.vertexBuffer.posBuffer=B;for(C=1;C<m;++C)this.primitive.indices.push(M++),this.primitive.indices.push(M)}return!0};var Dr=function(){Vt.call(this),this.vertexBuffer=null,this.primitive=new Mi,this.noRender=!0};Dr.prototype=Object.create(Vt.prototype),Dr.prototype.constructor=Dr,Dr.prototype.lineType=null,Dr.prototype.unstream=function(t){if(this.unstreamPrimitive(t),t.getLightDataStreaming()){this.primitive.connectivity=e.ConnectivityTypeEnum.LINES,this.vertexBuffer||(this.vertexBuffer=new rt);var r=this.vertexBuffer.posBuffer.length/3;this.primitive.start=this.primitive.indices.length;var i=t.readCompressedInt(),n=t.readCompressedInt();switch(this.primitive.count=i,n){case 0:this.primitive.count=i;for(var s=0;s<i;++s)this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.readFloat()),this.primitive.indices.push(r++);break;case 1:this.primitive.count=2+2*(i-2),this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.readFloat());for(s=1;s<i;++s)this.primitive.indices.push(r++),this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.readFloat()),this.primitive.indices.push(r);break;case 2:this.primitive.count=4+2*(i-2);var a=t.readFloat(),o=t.readFloat(),p=t.readFloat();this.vertexBuffer.posBuffer.push(a),this.vertexBuffer.posBuffer.push(o),this.vertexBuffer.posBuffer.push(p);for(s=1;s<i;++s)this.primitive.indices.push(r++),this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.readFloat()),this.vertexBuffer.posBuffer.push(t.readFloat()),this.primitive.indices.push(r);this.vertexBuffer.posBuffer.push(a),this.vertexBuffer.posBuffer.push(o),this.vertexBuffer.posBuffer.push(p),this.primitive.indices.push(r++),this.primitive.indices.push(r);break;default:return null}if(2==i){var h=this.vertexBuffer.posBuffer.length-6,u=this.vertexBuffer.posBuffer,f=(u[h]-u[h+3])*(u[h]-u[h+3]);f+=(u[h+1]-u[h+4])*(u[h+1]-u[h+4]),(f+=(u[h+2]-u[h+5])*(u[h+2]-u[h+5]))>=1e12&&(this.primitive.noRender=!0)}}},Dr.prototype.skip=function(e){if(this.unstreamPrimitive(e),e.getLightDataStreaming()){var t=e.readCompressedInt();e.readCompressedInt();t>0&&e.skip(3*t*4)}};var Lr=function(){Dr.call(this)};Lr.prototype=Object.create(Dr.prototype),Lr.prototype.constructor=Lr;var _r=0,kr=1,jr=2,zr=1,Wr=2,Hr=4,Xr=8,Yr=16,qr=function(){},Qr=[],Jr=null,Zr=function(e,t,r){this.newIdx=e,this.normal=t,this.next=r},Kr=function(e,t,r){if(Jr){var i=Jr;return Jr=Jr.next,i.newIdx=e,i.normal=t,i.next=r,i}return new Zr(e,t,r)},$r=function(e){for(var t=e;t;){var r=t.next;t.next=Jr,Jr=t,t=r}};qr.prototype.computeMatrix=function(e,t){if(e){if(t.pushMatrix(e.node.matrix),e instanceof ai||e instanceof ii){if(-1!==e.repIndice)t.getReps(e.repIndice,e.renderType).globalMatrix=t.getCurrentMatrix();if(e.axisSystems)t.axisSystems.get(e.axisSystems).globalMatrix=t.getCurrentMatrix();if(e.curvedPipe>-1)t.curvedPipes.get(e.curvedPipe).globalMatrix=t.getCurrentMatrix();if(e.canonical)t.canonical.get(e.canonical).globalMatrix=t.getCurrentMatrix();return void t.popMatrix()}for(var r=e.children.length,i=0;i<r;i++)this.computeMatrix(e.children[i],t);t.popMatrix()}},qr.prototype.modifyPreviousRepInheritance=function(e,t){for(var r=0;r<nbPreviousChildren;r++)this.computeMatrix(this.rep[r],t)},qr.prototype.getReps=function(e,t,r,i){if(e&&(e instanceof ai||e instanceof ii)){if(-1!==e.repIndice){var n=t.getReps(e.repIndice,e.renderType);r[e.renderType].add(n)}}else for(var s=e.children.length,a=0;a<s;a++)this.getReps(e.children[a],t,r)},qr.prototype.batch=function(e,r,i){e.batches.getCurrentIndex();var n=r.length?r[0]:r;n.alreadyprocessed=!0;var s=e.batches.add(kn.processAllReps(i,e.materials.getArray(),null,e.sgReps,!0));n.node.batchIndex=s,n.node.typeGeom=t._InfiniteGeomertryType.TESSELATION},qr.prototype.buildRep=function(r,i,n){for(var s=r?r.posBuffer:null,a=r?r.uvsBuffer:null,o=r?r.binormalsBuffer:null,p=r?r.tangentsBuffer:null,h=r?r.normalBuffer:null,u=r?r.textureBuffer:null,f=s?s.length/3:0,d=h?h.length/3:0,c=Qr.length;c<f;++c)Qr[c]=null;var l=new e.Mesh,v=f,m=0,y=i.length,g=0;for(c=0;c<y;c++)g+=i[c].nbIndices;var x=new Uint32Array(g),B=0;for(c=0;c<y;c++){var A=0,I=i[c],b=null==I.material?n.getCurrentMatId():I.material;switch(I.connectivity){case e.ConnectivityTypeEnum.TRIANGLES:A=new e.DrawingGroup(I.gas,b,4,B,I.nbIndices,void 0,void 0,t.GeomTypeEnum[I.geomType]);break;case e.ConnectivityTypeEnum.LINES:A=new e.DrawingGroup(I.gas,b,1,B,I.nbIndices,void 0,void 0,t.GeomTypeEnum[I.geomType]);break;case e.ConnectivityTypeEnum.POINTS:A=new e.DrawingGroup(I.gas,b,0,B,I.nbIndices,void 0,void 0,t.GeomTypeEnum[I.geomType])}m=I.set.length;var C=I.set;A._primitives=new Array(m);for(var w=0;w<m;w++){var S=B,P=C[w],M=P.indices?P.indices.length:0,F=P.planarNormals,T=P.planarNormals?P.planarNormals.length:0,R=P.indices;if(0===T)M&&(x.set(R,B),B+=M);else for(var U=F[0],O=F[1],G=F[2],N=0;N<M;N++){var E=R[N];if(E<d){var V=3*E;if(h[V]===U&&h[V+1]===O&&h[V+2]===G){x[B++]=E;continue}}else null===Qr[E]&&(Qr[E]=Kr(E,F,null));for(var D=!1,L=0,_=Qr[E];null!==_;){var k=_.normal;if(k[0]===U&&k[1]===O&&k[2]===G){D=!0,L=_.newIdx;break}_=_.next}D?x[B++]=L:(Qr[E]=Kr(v,F,Qr[E]),x[B++]=v++)}var j=new e.MeshPrimitive(P.cgmId,A,S,M);P.decoration&&(j.decoration=P.decoration),P.boundingSphere&&(j.boundingSphere=P.boundingSphere),A._primitives[w]=j}l.drawingGroups.push(A)}var z=new Float32Array(3*v),W=new Float32Array(3*v),H=null,X=!!r&&r.hasUVs,Y=!!r&&r.hasTangentsBinormals,q=!!r&&r.hasTextures;X&&(H=new Float32Array(3*v));var Q=null;Y&&(Q=new Float32Array(3*v));var J=null;Y&&(J=new Float32Array(3*v));var Z=null;q&&(Z=new Float32Array(3*v));var K=h?h.length:0,$=s?s.length:0;for(c=0;c<K;++c)W[c]=h[c];for(c=0;c<$;++c)z[c]=s[c];if(X)for(c=0;c<$;++c)H[c]=a[c];if(Y)for(c=0;c<$;++c)Q[c]=o[c],J[c]=p[c];if(q)for(c=0;c<$;++c)Z[c]=u[c];for(c=0;c<f;++c)for(_=Qr[c];null!==_;){var ee=3*c,te=3*_.newIdx;z[te]=s[ee],z[te+1]=s[ee+1],z[te+2]=s[ee+2],W[te]=_.normal[0],W[te+1]=_.normal[1],W[te+2]=_.normal[2],X&&(H[te]=a[ee],H[te+1]=a[ee+1],H[te+2]=a[ee+2]),Y&&(Q[te]=o[ee],Q[te+1]=o[ee+1],Q[te+2]=o[ee+2],J[te]=p[ee],J[te+1]=p[ee+1],J[te+2]=p[ee+2]),q&&(Z[te]=u[ee],Z[te+1]=u[ee+1],Z[te+2]=u[ee+2]),_=_.next}l.vertexIndexArray=x,l.vertexPositionArray=z,l.vertexNormalArray=W,l.vertexUvArray=Z,l.vertexTangentArray=J,l.vertexBinormalArray=Q;var re=new t.Color,ie=new t.Color,ne=this.rep.repGas,se=ne>>24&255,ae=ne>>16&255,oe=ne>>8&255,pe=255&ne;re.setRGB(se,ae,oe),ie.setRGB(se,ae,oe),l.gas.fill={color:re,opacity:pe},l.gas.line={color:ie,opacity:pe,lineWidth:1};var he=[0,0,0],ue=[0,0,0],fe=z;if($>=3){var de,ce,le,ve,me,ye;de=ce=fe[0],le=ve=fe[1],me=ye=fe[2];for(var ge=3;ge<$;ge+=3){var xe=fe[ge],Be=fe[ge+1],Ae=fe[ge+2];xe<de?de=xe:xe>ce&&(ce=xe),Be<le?le=Be:Be>ve&&(ve=Be),Ae<me?me=Ae:Ae>ye&&(ye=Ae)}he=[de,le,me],ue=[ce,ve,ye]}l.AABB={min:he,max:ue};for(c=0;c<f;c++)$r(Qr[c]),Qr[c]=null;return l},qr.prototype.resolvedInheritance=function(r,i){if(i.globalMatrix=r.getCurrentMatrix(),i.axis){i.type=t._InfiniteGeomertryType.AXIS_SYSTEM;var n=r.infiniteGeometries.add(i);return this.rep.node.typeGeom=t._InfiniteGeomertryType.AXIS_SYSTEM,this.rep.node.batchIndex=n,r.popMatId(),r.popGAS(),this}if(i.curveVertices){n=r.curvedPipes.add(i);return this.rep.node.typeGeom=t._InfiniteGeomertryType.CURVED_PIPE,this.rep.node.batchIndex=n,r.popMatId(),r.popGAS(),this}if(null!=i.canonicalType){i.type=t._InfiniteGeomertryType.CANONICAL;n=r.infiniteGeometries.add(i);return this.rep.node.typeGeom=t._InfiniteGeomertryType.CANONICAL,this.rep.node.batchIndex=n,r.popMatId(),r.popGAS(),this}if(i.refPlanes){i.type=t._InfiniteGeomertryType.REF_PLANE;n=r.infiniteGeometries.add(i);return this.rep.node.typeGeom=t._InfiniteGeomertryType.REF_PLANE,this.rep.node.batchIndex=n,this}if(i.arrows){i.type=t._InfiniteGeomertryType.ARROWS;n=r.infiniteGeometries.add(i);return this.rep.node.typeGeom=t._InfiniteGeomertryType.ARROWS,this.rep.node.batchIndex=n,this}if(i.voxelRep){i.type=t._InfiniteGeomertryType.VOXEL_REP;n=r.infiniteGeometries.add(i);return this.rep.node.typeGeom=t._InfiniteGeomertryType.VOXEL_REP,this.rep.node.batchIndex=n,this}var s=r.getFixedMode(),o=r.getGAS(null),p=(o.getType(),o.isHidden()),h=o.isSolid(),u=r.getStaticMode();i.gas=o,this.rep.node.solid=h,a&&i.rep instanceof e.SGRep&&(i.rep.boundingSphere=this.rep.boundingSphere),p&&(i.noShow=!0),u&&(i.attachedPoint=u);var f=r.addReps(i,u,!1,this.rep.excludeFromBounding,s);if(f&&(this.rep.renderType=f.renderType,this.rep.repIndice=f.indice,r.multiRefCount>0&&-1==this.rep.multirefRepId)){var d=r.multiRefReps.length;r.multiRefReps.push(i.clone()),this.rep.multirefRepId=d}},qr.prototype.addMesh=function(e){var t=this.build(e);return null==t?(e.popMatId(),e.popGAS(),null):(t.rep=this.rep,this.resolvedInheritance(e,t),e.popMatId(),e.popGAS(),this)};var ei=function(){qr.call(this),this.rep=new ai};(ei.prototype=Object.create(qr.prototype)).constructor=ei;var ti=function(){qr.call(this),this.rep=new ii};(ti.prototype=Object.create(qr.prototype)).constructor=ti;var ri=function(e){e=e||{},this.repInheritanceMode=void 0!==e.repInheritanceMode?e.repInheritanceMode:0,this.repGAS=void 0!==e.repGAS?e.repGAS:0,this.materialInheritance=void 0!==e.materialInheritance?e.materialInheritance:0,this.material=void 0!==e.material?e.material:{file:"",id:-1},this.node=void 0!==e.node?e.node:null,this.boundingSphere=null};ri.prototype.unstream=function(e){this.namingContext=0,this.repInheritanceMode=e.readCompressedInt(),this.repGAS=e.readGraphicAttributeSet(),this.repGAS.isHidden()&&(this.node.noShow=!0),e.pushGAS(this.repGAS,this.repInheritanceMode),this.material={file:"",id:-1},this.materialInheritance=0;e.readCompressedInt(),e.readCompressedInt();var r=e.readFloat(),i=e.readFloat(),n=e.readFloat(),s=e.readFloat(),a=(i-r)*(i-r)+(s-n)*(s-n);if(a=.5*Math.sqrt(a),this.boundingSphere={radius:a,center:[.5*(i+r),.5*(s+n),0]},e.version>=1101303)e.readFloat();if(e.version>=210042500&&e.readUnsignedShort(),e.version>=210042700){var o=e.readUnsignedChar(),p=(248&o)>>3,h=(4&o)>>2,u=3&o;if(this.namingContext=u,this.node.namingContext=this.namingContext,0!=p){var f=t._FilterType.VIEWMODE;this.node.attributes.push({attribute:{viewMode:p,viewModeSensitivity:h},typeAttribute:f}),this.toBatch=!0}}},ri.prototype.childClone=function(){var e=new Array;for(var t in this.children)e[t]="object"==typeof this.children[t]?this.children[t].clone():this.children[t];return e};var ii=function(t){ri.call(this,t=t||{}),this.node=void 0!==t.node?t.node:new e.SGRep,this.repIndice=void 0!==t.repIndice?t.repIndice:-1,this.multirefRepId=void 0!==t.multirefRepId?t.multirefRepId:-1,this.renderType=void 0!==t.renderType?t.renderType:0};ii.prototype=Object.create(ri.prototype),ii.prototype.constructor=ii,ii.prototype.clone=function(){return new ii({multirefRepId:this.multirefRepId,repIndice:this.repIndice,renderType:this.renderType,node:this.node,namingContext:this.namingContext,materialInheritance:this.materialInheritance,currentMatId:this.currentMatId,material:this.material,repGAS:this.repGAS,repInheritanceMode:this.repInheritanceMode})};var ni=function(t){ri.call(this,t=t||{}),this.node=void 0!==t.node?t.node:new e.SGBag,this.children=void 0!==t.children?this.childClone(t.children):[]};(ni.prototype=Object.create(ri.prototype)).constructor=ni,ni.prototype.clone=function(){return new ni({children:this.childClone(),node:this.node.clone(),materialInheritance:this.materialInheritance,currentMatId:this.currentMatId,material:this.material,repGAS:this.repGAS,repInheritanceMode:this.repInheritanceMode})};var si=function(e){e=e||{},this.repInheritanceMode=void 0!==e.repInheritanceMode?e.repInheritanceMode:0,this.repGAS=void 0!==e.repGAS?e.repGAS:0,this.materialInheritance=void 0!==e.materialInheritance?e.materialInheritance:0,this.material=void 0!==e.material?e.material:{file:"",id:-1},this.layer=void 0!==e.layer?e.layer:ue.LAYER_MAX,this.node=void 0!==e.node?e.node:null,this.boundingSphere=void 0!==e.boundingSphere?e.boundingSphere:null,this.externalPath=!1,this.toBatch=!1};si.prototype.unstream=function(e){this.namingContext=0,this.repInheritanceMode=e.readCompressedUInt(),this.repGAS=e.readGraphicAttributeSet(),this.repGAS.isHidden()&&(this.node.noShow=!0),e.pushGAS(this.repGAS,this.repInheritanceMode);e.getGAS(null);this.material={file:"",id:-1},this.materialInheritance=0,2==e.readCompressedInt()&&(this.excludeFromBounding=!0);e.readCompressedInt();var r=e.readFloat(),i=(e.readFloat(),e.readFloat()),n=e.readFloat(),s=e.readFloat();(this.boundingSphere={radius:r,center:[i,n,s]},e.version>=210042410)&&(X=e.readBit(),(H===_||H===k||e.version>=210042415&&Y==j)&&X&&(ct.x=e.readFloat(),ct.y=e.readFloat(),ct.z=e.readFloat(),lt.x=e.readFloat(),lt.y=e.readFloat(),lt.z=e.readFloat()));if(e.version>1100800){this.node.cgmId=e.readUncompressedULong();e.readUnsignedShort();if(e.version>=210042600){var a=e.readUnsignedChar(),o=(248&a)>>3,p=(4&a)>>2,h=3&a;if(this.namingContext=h,this.node.namingContext=this.namingContext,0!=o){var u=t._FilterType.VIEWMODE;this.node.attributes.push({attribute:{viewMode:o,viewModeSensitivity:p},typeAttribute:u}),this.toBatch=!0}}else e.version>1101020&&(this.namingContext=e.readUnsignedChar(),this.node.namingContext=this.namingContext)}if(e.readUnsignedChar()){var f=this.materialApplicationUnstream(e,ue.STREAM_MATERIAL|ue.STREAM_INHERIT_INT);this.material=f.material,this.materialInheritance=f.inheritanceMaterial}if(e.version>=210041800){var d=e.readUnsignedChar();if(d>0){if((f=this.materialApplicationUnstream(e,ue.STREAM_LAYER_ULONG|ue.STREAM_UVTRANSFO|ue.STREAM_MAPPING_INFO|ue.STREAM_LIGHTMAP)).mapping)(m=e.materials.get([this.material.id]))&&(m.mapping=f.mapping);this.layer=f.layer;var c=e.readCompressedUInt();if(c>0)for(var l=0;l<c;++l){var v=0;2==d&&(v=e.readUnsignedChar());var m,y=ue.STREAM_ALL_ULONG;if(1!=v&&2!=v||(y|=ue.STREAM_DECAL,2==v&&(y&=~ue.STREAM_MATERIAL)),(f=this.materialApplicationUnstream(e,y)).mapping)(m=e.materials.get([f.material.id]))&&(m.mapping=f.mapping);f.decal?Ln&&(this.node.attributes.push({typeAttribute:t._FilterType.DECALS,attribute:f}),this.toBatch=!0):(f.layer<this.layer||f.layer==this.layer&&f.inheritanceMaterial>=this.materialInheritance)&&(this.layer=f.layer,this.material=f.material,this.materialInheritance=f.inheritanceMaterial)}}}if((e.pushMatId(this.material,this.materialInheritance,this.layer,this),e.version>=210041910)&&e.readUnsignedChar()){e.readBytes(6,[])}},si.prototype.materialApplicationUnstream=function(e,t){var r={material:null,inheritanceMaterial:1,layer:0};if(t&ue.STREAM_MATERIAL&&(r.material=this.unstreamMaterial(e)),e.version>=1100500?t&ue.STREAM_INHERIT_INT?r.inheritanceMaterial=e.readCompressedInt():t&ue.STREAM_INHERIT_UINT?r.inheritanceMaterial=e.readCompressedInt():t&ue.STREAM_INHERIT_ULONG&&(r.inheritanceMaterial=e.readUncompressedInt()):t&(ue.STREAM_INHERIT_INT|ue.STREAM_INHERIT_UINT|ue.STREAM_INHERIT_ULONG)&&(r.inheritanceMaterial=1),t&ue.STREAM_LAYER_INT?r.layer=e.readUncompressedInt():t&ue.STREAM_LAYER_UINT?r.layer=e.readUncompressedInt():t&ue.STREAM_LAYER_ULONG&&(r.layer=e.readUncompressedUInt()),t&ue.STREAM_UVTRANSFO){if(e.version>=210041900){var i=[0,0,0,1];if(e.readBoolean()){var n=!0,s=e.readFloat(),a=e.readFloat(),o=e.readFloat(),p=e.readFloat();s!=i[0]&&(i[0]=s,n=!1),a!=i[1]&&(i[1]=a,n=!1),o!=i[2]&&(i[2]=o,n=!1),p!=i[3]&&(i[3]=p,n=!1),n||(r.mapping={type:0,ObjectTransformation:null,UvTransformation:null,UvTransfoInfos:i,transformSemantic:1})}}}if(t&ue.STREAM_MAPPING_INFO&&(e.version>=210042100&&!e.readBoolean())){var h=e.readStringWithLength();if(h=(h=JSON.parse(h)).mappings[h.uvSlots.Default],r.mapping||(r.mapping={type:0,ObjectTransformation:null,UvTransformation:null,UvTransfoInfos:null,transformSemantic:1}),h.uvTrfSemantic&&(r.mapping.transformSemantic=h.uvTrfSemantic+1),h.uvTransform&&(r.mapping.UvTransformation=e.createMatrix3(h.uvTransform)),h.operator&&(r.mapping.type=h.operator.type,h.operator.transform)){var u=h.operator.transform;r.mapping.ObjectTransformation=u}}if(t&ue.STREAM_LIGHTMAP&&(e.version>=210042320&&1==e.readCompressedInt()))e.readStringWithLength(),e.readCompressedInt(),e.readUncompressedULong();if(t&ue.STREAM_DECAL&&(e.version>=210042710&&e.readBoolean())){var f=e.readBoolean(),d=e.readBoolean(),c=e.readCompressedInt();if(e.multiRefNode.isValidIndex(c)){if(m=e.multiRefNode.get(c)){var l={decal:m,decalApplied:f,decalAttached:d};r.decal=l}}else{var v=[];e.readDoubles(v,16);var m={decalIndex:c,decalMatrix:v,decalProjector:e.readCompressedInt(),decalBoundingGeometry:e.readCompressedInt(),decalMode:e.readCompressedInt(),decalImplicitScaleU:e.readFloat(),decalImplicitScaleV:e.readFloat()};e.multiRefNode.addAt(m,c)}if(m){l={decal:m,decalApplied:f,decalAttached:d};r.decal=l}}return r},si.prototype.unstreamMaterial=function(e){var t,r={file:"",id:-1},i=0,n=e.readUnsignedChar(),s=0,a=null;if(n){if(2==n){e.readStringWithLength();return i=e.readCompressedInt(),r.id=e.materials.add({external3DXid:i}),r}if(s=e.readCompressedInt(),e.materials.isValidMultiRefIndexWithName(s,e.name))return r={file:"",id:f=e.materials.getIndexWithName(s,e.name)}}if(e.version>=210021320){var o=e.readCompressedInt();a=1===o?new tt:4===o?new qe:9===o&&e.version>=210042100?new Ze:new Ye}else a=new Ye;t=a.unstream(e);var p=e.getCurrentPosition(),h=e.getBytesRemain();h>32&&(h=32);var u=e.readString(h);(e.setCurrentPosition(p),-1!==u.indexOf('{\n"Version" : '))&&(new qe).skip(e);if(1===o)var f=t;else{f=e.materials.add(t);t._MaterialPropertiesActivate}return r={file:"",id:f},n&&e.materials.addMultiRefIndexWithName(s,f,e.name),r},si.prototype.childClone=function(){var e=new Array;for(var t in this.children)e[t]="object"==typeof this.children[t]?this.children[t].clone():this.children[t];return e};var ai=function(t){si.call(this,t=t||{}),this.node=void 0!==t.node?t.node:new e.SGRep,this.namingContext=void 0!==t.namingContext?t.namingContext:0,this.repIndice=void 0!==t.repIndice?t.repIndice:-1,this.renderType=void 0!==t.renderType?t.renderType:0,this.multirefRepId=void 0!==t.multirefRepId?t.multirefRepId:-1,this.curvedPipe=void 0!==t.curvedPipe?t.curvedPipe:-1};ai.prototype=Object.create(si.prototype),ai.prototype.constructor=ai,ai.prototype.clone=function(){return new ai({multirefRepId:this.multirefRepId,boundingSphere:this.boundingSphere,curvedPipe:this.curvedPipe,renderType:this.renderType,repIndice:this.repIndice,node:this.node,namingContext:this.namingContext,materialInheritance:this.materialInheritance,currentMatId:this.currentMatId,material:this.material,repGAS:this.repGAS,repInheritanceMode:this.repInheritanceMode})};var oi=function(t){si.call(this,t=t||{}),this.node=void 0!==t.node?t.node:new e.SGBag,this.children=void 0!==t.children?t.children:[]};(oi.prototype=Object.create(si.prototype)).constructor=oi,oi.prototype.clone=function(){return new oi({boundingSphere:this.boundingSphere,children:this.childClone(),node:this.node.clone(),materialInheritance:this.materialInheritance,currentMatId:this.currentMatId,material:this.material,repGAS:this.repGAS,repInheritanceMode:this.repInheritanceMode})};var pi=function(){ei.call(this),this.primitiveSets=[],this.vertexBuffer=null,this.primitiveAxis=[],this.axisSystems=[],this.refPlane=[],this.arrows=[],this.useTexture=!1,this.hasTangentsBinormals=!1,this.gpList=[],this.imageRep=[]};pi.prototype=Object.create(ei.prototype),pi.prototype.constructor=pi,pi.prototype.checkGP=function(e,t){for(var r=0;r<this.gpList.length;r++)this.mergeGP(this.gpList[r].gp,this.gpList[r].att,e);if(this.primitiveAxis.length){var i=this.primitiveAxis[0].gp.primitive;this.primitiveAxis[0].att.getDisplayedColor();var n=this.primitiveAxis[0].att.getDisplayedColor();this.primitiveAxis[0].gp instanceof qt&&(this.refPlane.push({rep:this.rep.node,origin:i.origin,xAxis:i.direction1,yAxis:i.direction2,noShow:this.primitiveAxis[0].att.isHidden(),color:n,lengthX:i.length,lengthY:i.length,mode:i.mode,zoomable:!!t&&t.mode===fe,type:"CAT3DCustomRep"}),this.primitiveAxis=[]);for(r=0;r<this.primitiveAxis.length;r++){if(this.primitiveAxis[r].gp instanceof Xt||this.primitiveAxis[r].gp instanceof Dr){this.primitiveAxis[r].gp.noRender=!1;var s=this.primitiveAxis[r].gp.vertexBuffer;s&&(this.useTexture=!!s.hasTextures&&s.hasTextures,this.hasTangentsBinormals=!!s.hasTangentsBinormals&&s.hasTangentsBinormals),this.mergeGP(this.primitiveAxis[r].gp,this.primitiveAxis[r].att,e)}if(this.primitiveAxis[r].gp instanceof Yt){i=this.primitiveAxis[r].gp.primitive,n=this.primitiveAxis[r].att.getDisplayedColor();this.arrows.push({infiniteFace:3==e.getSemanticType(),rep:this.rep.node,origin:i.origin,direction:i.direction,noShow:this.primitiveAxis[r].att.isHidden(),color:n,length:i.length,type:"CAT3DCustomRep"})}}}},pi.prototype.addImage=function(e,r,i,n){var s=new Ki,a=i.getCurrentMatrix();if(s.rep.repInheritanceMode=n.repInheritanceMode,s.rep.repGAS=n.repGAS,s.rep.materialInheritance=n.materialInheritance,s.rep.repInheritanceMode=n.repInheritanceMode,s.rep.node.noShow=n.node.noShow,s.vertexBuffer=new rt,s.gp=e,e&&e.primitive){if(void 0!==e.zoomQuality&&0===e.zoomQuality&&i.setFixedMode(!0),e.point){var o,p=(new t.Matrix4).setPosition({x:e.point[0],y:e.point[1],z:e.point[2]});o=a?(new t.Matrix4).multiplyMatrices(a,p):p,i.pushStaticMode(o),i.currentMatrix.push(new t.Matrix4)}e.primitive.material&&i.pushMatId(e.primitive.material,1,0,s.rep);var h=s.build(i);s.resolvedInheritance(i,h),h.rep=s.rep,i.popStaticMode(),e.point&&(i.currentMatrix.pop(),i.popStaticMode()),e.primitive.material&&i.popMatId(),i.setFixedMode(!1)}return s.rep},pi.prototype.addGP=function(e,t,r,i){if(!e.toSkip)if(e.noRender){if(e.imageGP)return void this.imageRep.push(this.addImage(e,t,r,this.rep));if(this.primitiveAxis.push({gp:e,att:t}),(2==this.rep.namingContext||i)&&7==this.primitiveAxis.length&&this.primitiveAxis[0].gp instanceof Xt&&this.primitiveAxis[1].gp instanceof Yt&&this.primitiveAxis[2].gp instanceof Yt&&this.primitiveAxis[3].gp instanceof Yt&&this.primitiveAxis[4].gp instanceof qt&&this.primitiveAxis[5].gp instanceof qt&&this.primitiveAxis[6].gp instanceof qt){var n=this.primitiveAxis[0].att.getDisplayedColor(),s=[(a=this.primitiveAxis[0].gp.vertexBuffer.posBuffer)[(o=this.primitiveAxis[0].gp.primitive.indices)[0]],a[o[0]+1],a[o[0]+2]];this.axisSystems.push({rep:this.rep.node,origin:s,xAxis:this.primitiveAxis[1].gp.primitive.direction,yAxis:this.primitiveAxis[2].gp.primitive.direction,zAxis:this.primitiveAxis[3].gp.primitive.direction,refPlanes:[this.primitiveAxis[4].gp.primitive,this.primitiveAxis[5].gp.primitive,this.primitiveAxis[6].gp.primitive],color:n,zoomable:!1}),this.primitiveAxis=[]}if((2==this.rep.namingContext||i)&&7==this.primitiveAxis.length&&this.primitiveAxis[0].gp instanceof Xt&&this.primitiveAxis[1].gp instanceof Zt&&this.primitiveAxis[2].gp instanceof Zt&&this.primitiveAxis[3].gp instanceof Zt&&this.primitiveAxis[4].gp instanceof Dr&&this.primitiveAxis[5].gp instanceof Dr&&this.primitiveAxis[6].gp instanceof Dr){var a,o;n=this.primitiveAxis[0].att.getDisplayedColor(),s=[(a=this.primitiveAxis[0].gp.vertexBuffer.posBuffer)[(o=this.primitiveAxis[0].gp.primitive.indices)[0]],a[o[0]+1],a[o[0]+2]];this.axisSystems.push({rep:this.rep.node,origin:s,xAxis:this.primitiveAxis[1].gp.primitive.direction,yAxis:this.primitiveAxis[2].gp.primitive.direction,zAxis:this.primitiveAxis[3].gp.primitive.direction,refPlanes:[this.primitiveAxis[4].gp.vertexBuffer.posBuffer,this.primitiveAxis[5].gp.vertexBuffer.posBuffer,this.primitiveAxis[6].gp.vertexBuffer.posBuffer],color:n,zoomable:!0,length:i.axisLength}),this.primitiveAxis=[]}}else{var p=e.vertexBuffer;p&&(this.useTexture=!!p.hasTextures&&p.hasTextures,this.hasTangentsBinormals=!!p.hasTangentsBinormals&&p.hasTangentsBinormals),this.gpList.push({gp:e,att:t})}},pi.prototype.mergeGP=function(e,t,r){var i=e.primitive,n=void 0;2==this.rep.namingContext&&e instanceof Xt&&(n="FREE_POINT"),e instanceof Dr&&3==r.getSemanticType()&&(n="AXIS_SYSTEM");for(var s=this.primitiveSets.length,a=0;a<s;a++){var o=this.primitiveSets[a];if(o.connectivity==i.connectivity&&o.gas.isEqual(t)&&(null==o.material&&null==i.material||o.material.id==i.material.id&&o.material.file==i.material.file)&&(void 0===n||o.geomType===n)){o.set.push(i),o.nbIndices+=i.indices.length;break}}if(a==this.primitiveSets.length){var p={};p.connectivity=i.connectivity,p.gas=t,p.material=i.material,p.nbIndices=i.indices.length,p.more_indices=0,p.set=[],n&&(p.geomType=n),p.set.push(i),this.primitiveSets.push(p)}null==this.vertexBuffer&&(this.vertexBuffer=new rt,this.vertexBuffer.hasTextures=this.useTexture,this.vertexBuffer.hasUVs=!1,this.vertexBuffer.hasTangentsBinormals=this.hasTangentsBinormals);for(var h=e.vertexBuffer,u=i.indices,f=this.vertexBuffer.posBuffer.length/3,d=0;d<u.length;d++)u[d]=u[d]+f;for(d=0;d<h.posBuffer.length;d++)this.vertexBuffer.posBuffer.push(h.posBuffer[d]),h.normalBuffer.length?this.vertexBuffer.normalBuffer.push(h.normalBuffer[d]):this.vertexBuffer.normalBuffer.push(0),this.useTexture&&(h.textureBuffer.length?this.vertexBuffer.textureBuffer.push(h.textureBuffer[d]):this.vertexBuffer.textureBuffer.push(0)),this.hasTangentsBinormals&&(h.tangentsBuffer.length?this.vertexBuffer.tangentsBuffer.push(h.tangentsBuffer[d]):this.vertexBuffer.tangentsBuffer.push(0),h.binormalsBuffer.length?this.vertexBuffer.binormalsBuffer.push(h.binormalsBuffer[d]):this.vertexBuffer.binormalsBuffer.push(0))},pi.prototype.build=function(e){if(this.axisSystems.length>0)return{axis:this.axisSystems[0]};if(0==this.primitiveSets.length)return this.arrows&&this.arrows.length>0?{arrows:this.arrows}:this.refPlane&&this.refPlane.length>0?{refPlanes:this.refPlane}:null;var t=this.buildRep(this.vertexBuffer,this.primitiveSets,e);return this.refPlane.length>0&&(t.refPlanes=this.refPlane),this.arrows&&this.arrows.length>0&&(t.arrows=this.arrows),t};var hi=function(){ei.call(this),this.vertexBuffer=null,this.nbLODFaces=0,this.lods=[],this.lodsAttributes=[],this.sag=0,this.sags=[],this.nbSets=0,this.sets=[],this.posInNextStreamer=0};hi.prototype=Object.create(ei.prototype),hi.prototype.constructor=hi,hi.prototype.getSet=function(e){for(var t=[],r=0;r<this.sets.length;r++)if(this.sets[r].geomType==e)for(var i=this.sets[r].primitives,n=0;n<i.length;n++)t.push(i[n]);return t},hi.prototype.unStreamFaces=function(e){if(e.readUnsignedChar()){if(e.version>=2100180)switch(e.readUnsignedChar()){case 2:this.sets[0]=new st;break;case 3:this.sets[0]=new ot;break;default:this.sets[0]=null}else this.sets[0]=new st;this.sets[0]&&this.sets[0].unstream(e)}},hi.prototype.build=function(t){var r,i,n,s,a,o=null!==this.vertexBuffer,p=(this.rep.repGAS.getType(),[]);if(0==this.nbSets)return null;for(r=0;r<this.nbSets;r++)for(this.sets[r].primitive?(s=1,a=[this.sets[r].primitive]):(s=this.sets[r].primitives.length,a=this.sets[r].primitives),i=0;i<s;i++)if(n=a[i]){if(n.posBuffer){this.vertexBuffer||(this.vertexBuffer=new rt);for(var h=n.indices,u=this.vertexBuffer.posBuffer.length/3,f=0;f<h.length;f++)h[f]=h[f]+u;for(f=0;f<n.posBuffer.length;f++)this.vertexBuffer.posBuffer.push(n.posBuffer[f]),n.normalBuffer&&n.normalBuffer.length?this.vertexBuffer.normalBuffer.push(n.normalBuffer[f]):this.vertexBuffer.normalBuffer.push(0);this.vertexBuffer.hasTangentsBinormals&&(this.vertexBuffer.tangentsBuffer.push(0),this.vertexBuffer.binormalsBuffer.push(0)),this.vertexBuffer.hasTextures&&this.vertexBuffer.textureBuffer.push(0)}else if(!o)continue;n.indices.length,n.planarNormals&&n.planarNormals.length>0&&n.indices.length;var d=p.length;for(f=0;f<d;f++){var c=p[f];if(c.connectivity==n.connectivity&&c.geomType==this.sets[r].geomType&&c.gas.isEqual(n.gas)&&e.isEqualMaterial(c.material,n.material)){c.set.push(n),c.nbIndices+=n.indices.length;break}}if(f==p.length){var l={};l.connectivity=n.connectivity,l.gas=n.gas,l.geomType=this.sets[r].geomType,l.material=n.material,l.nbIndices=n.indices.length,l.more_indices=0,l.set=[],l.set.push(n),p.push(l)}}return this.vertexBuffer?this.buildRep(this.vertexBuffer,p,t):null};var ui=function(){hi.call(this)};(ui.prototype=Object.create(hi.prototype)).constructor=ui,ui.prototype.build=function(e){};var fi=function(){ti.call(this),this.gp=[]};fi.prototype=Object.create(ei.prototype),fi.prototype.constructor=fi,fi.prototype.build=function(t){var r=new e.Mesh,i=t.getCurrentMatId(),n=t.getGAS(this.gp.primitive.connectivity);this.gp.primitive.symbol&&n.setSymbol(this.gp.primitive.symbol),n.setConnectivity(this.gp.primitive.connectivity);var s=new e.DrawingGroup(n,i,0,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,s,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),s._primitives.push(a),r.drawingGroups.push(s),r.vertexIndexArray=this.gp.primitive.indices,r.vertexPositionArray=this.gp.vertexBuffer.posBuffer,r.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,r.gas=n;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],r.vertexPositionArray.length);if(h>=3){o=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]],p=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]];for(var u=0;u<h;u+=3)r.vertexPositionArray[u]<o[0]&&(o[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]<o[1]&&(o[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]<o[2]&&(o[2]=r.vertexPositionArray[u+2]),r.vertexPositionArray[u]>p[0]&&(p[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]>p[1]&&(p[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]>p[2]&&(p[2]=r.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,r.AABB={min:o,max:p},r};var di=function(){ei.call(this),this.gp=[]};di.prototype=Object.create(ei.prototype),di.prototype.constructor=di,di.prototype.build=function(e){return null};var ci=function(){ei.call(this),this.gp=[]};ci.prototype=Object.create(ei.prototype),ci.prototype.constructor=ci,ci.prototype.build=function(e){return null};var li=function(){ei.call(this),this.gp=[]};li.prototype=Object.create(ei.prototype),li.prototype.constructor=li,li.prototype.build=function(e){return null};var vi=function(){ei.call(this),this.gp=[]};vi.prototype=Object.create(ei.prototype),vi.prototype.constructor=vi,vi.prototype.build=function(e){return null};var mi=function(){ei.call(this),this.gp=[]};mi.prototype=Object.create(ei.prototype),mi.prototype.constructor=mi,mi.prototype.build=function(r){var i=new e.Mesh,n=r.getCurrentMatId(),s=r.getGAS();this.gp.primitive.symbol&&s.setSymbol(this.gp.primitive.symbol),s.setConnectivity(this.gp.primitive.connectivity);var a=0;3==r.getSemanticType()&&(a=t.GeomTypeEnum.AXIS_SYSTEM);var o=new e.DrawingGroup(s,n,0,0,this.gp.primitive.indices.length,[],null,a),p=new e.MeshPrimitive(this.gp.node.cgmId,o,0,this.gp.primitive.indices.length);this.gp.decoration&&(p.decoration=this.gp.decoration),this.gp.boundingSphere&&(p.boundingSphere=this.gp.boundingSphere),o._primitives.push(p),i.drawingGroups.push(o),i.vertexIndexArray=this.gp.primitive.indices,i.vertexPositionArray=this.gp.vertexBuffer.posBuffer,i.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,i.gas=s;var h=[0,0,0],u=[0,0,0],f=(h=[0,0,0],u=[0,0,0],i.vertexPositionArray.length);if(f>=3){h=[i.vertexPositionArray[0],i.vertexPositionArray[1],i.vertexPositionArray[2]],u=[i.vertexPositionArray[0],i.vertexPositionArray[1],i.vertexPositionArray[2]];for(var d=0;d<f;d+=3)i.vertexPositionArray[d]<h[0]&&(h[0]=i.vertexPositionArray[d]),i.vertexPositionArray[d+1]<h[1]&&(h[1]=i.vertexPositionArray[d+1]),i.vertexPositionArray[d+2]<h[2]&&(h[2]=i.vertexPositionArray[d+2]),i.vertexPositionArray[d]>u[0]&&(u[0]=i.vertexPositionArray[d]),i.vertexPositionArray[d+1]>u[1]&&(u[1]=i.vertexPositionArray[d+1]),i.vertexPositionArray[d+2]>u[2]&&(u[2]=i.vertexPositionArray[d+2])}return h[2]=-.01,u[2]=.01,i.AABB={min:h,max:u},i};var yi=function(){ei.call(this),this.gp=[]};yi.prototype=Object.create(ei.prototype),yi.prototype.constructor=yi,yi.prototype.build=function(t){var r=new e.Mesh,i=t.getCurrentMatId(),n=t.getGAS(this.gp.primitive.connectivity);n.setConnectivity(this.gp.primitive.connectivity);var s=new e.DrawingGroup(n,i,this.gp.primitive.connectivity==e.ConnectivityTypeEnum.LINES?1:4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,s,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),s._primitives.push(a),r.drawingGroups.push(s),r.vertexIndexArray=this.gp.primitive.indices,r.vertexPositionArray=this.gp.vertexBuffer.posBuffer,r.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,r.gas=n;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],r.vertexPositionArray.length);if(h>=3){o=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]],p=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]];for(var u=0;u<h;u+=3)r.vertexPositionArray[u]<o[0]&&(o[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]<o[1]&&(o[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]<o[2]&&(o[2]=r.vertexPositionArray[u+2]),r.vertexPositionArray[u]>p[0]&&(p[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]>p[1]&&(p[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]>p[2]&&(p[2]=r.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,r.AABB={min:o,max:p},r};var gi=function(){ei.call(this),this.gp=[]};(gi.prototype=Object.create(ei.prototype)).constructor=gi,gi.prototype.build=function(t){var r=new e.Mesh,i=t.getCurrentMatId(),n=t.getGAS(this.gp.primitive.connectivity);n.setConnectivity(this.gp.primitive.connectivity);var s=new e.DrawingGroup(n,i,this.gp.primitive.connectivity==e.ConnectivityTypeEnum.LINES?1:4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,s,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),s._primitives.push(a),r.drawingGroups.push(s),r.vertexIndexArray=this.gp.primitive.indices,r.vertexPositionArray=this.gp.vertexBuffer.posBuffer,r.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,r.gas=n;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],r.vertexPositionArray.length);if(h>=3){o=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]],p=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]];for(var u=0;u<h;u+=3)r.vertexPositionArray[u]<o[0]&&(o[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]<o[1]&&(o[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]<o[2]&&(o[2]=r.vertexPositionArray[u+2]),r.vertexPositionArray[u]>p[0]&&(p[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]>p[1]&&(p[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]>p[2]&&(p[2]=r.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,r.AABB={min:o,max:p},r};var xi=function(){ei.call(this),this.refPlane=[]};xi.prototype=Object.create(ei.prototype),xi.prototype.constructor=xi,xi.prototype.build=function(e){if(this.refPlane)return{refPlanes:this.refPlane}};var Bi=function(){ei.call(this),this.refPlane=[]};(Bi.prototype=Object.create(ei.prototype)).constructor=Bi,Bi.prototype.build=function(e){if(this.refPlane)return{refPlanes:this.refPlane}};var Ai=function(){ei.call(this),this.vertexBuffer=null,this.sets=[]};Ai.prototype=Object.create(ei.prototype),Ai.prototype.constructor=Ai,Ai.prototype.build=function(r){var i=new e.Mesh,s=r.getCurrentMatId(),a=r.getGAS(e.ConnectivityTypeEnum.TRIANGLES);a.setConnectivity(e.ConnectivityTypeEnum.TRIANGLES);var o=a.getDisplayedColor(),p=new t.Color;if(p.setRGB(o[0]/255,o[1]/255,o[2]/255),n)return{gas:{color:p,opacity:o[3]/255},matId:s,curveVertices:this.curveVertices,startNormal:this.startNormal,endNormal:this.endNormal,radius:this.radius,startSideVector:this.startSideVector};var h=new e.DrawingGroup(a,s,4,0,this.sets[0].indices.length),u=new e.MeshPrimitive(this.sets[0].node.cgmId,h,0,this.sets[0].indices.length);this.sets[0].decoration&&(u.decoration=this.sets[0].decoration),this.sets[0].boundingSphere&&(u.boundingSphere=this.sets[0].boundingSphere),h._primitives.push(u),i.drawingGroups.push(h),i.vertexIndexArray=this.sets[0].indices,i.vertexPositionArray=this.vertexBuffer.posBuffer,i.vertexNormalArray=this.vertexBuffer.normalBuffer,i.gas=a;var f=this.sets[0].boundingBoxCenter,d=this.sets[0].boundingBoxDim,c=[f[0]-d[0],f[1]-d[1],f[2]-d[2]],l=[f[0]+d[0],f[1]+d[1],f[2]+d[2]];return i.AABB={min:c,max:l},i};var Ii=function(){ei.call(this),this.sets=[],this.isGPUInstanciable=!0};Ii.prototype=Object.create(ei.prototype),Ii.prototype.constructor=Ii,Ii.prototype.build=function(r){var i=new e.Mesh,s=r.getCurrentMatId(),a=r.getGAS(e.ConnectivityTypeEnum.TRIANGLES);a.setConnectivity(e.ConnectivityTypeEnum.TRIANGLES);var o=a.getDisplayedColor(),p=new t.Color;if(p.setRGB(o[0]/255,o[1]/255,o[2]/255),this.isGPUInstanciable&&n)return{gas:{color:p,opacity:o[3]/255},matId:s,curveVertices:this.curveVertices,startNormal:this.startNormal,endNormal:this.endNormal,radius:this.radius,startSideVector:this.startSideVector};var h=new e.DrawingGroup(a,s,4,0,this.sets[0].indices.length),u=new e.MeshPrimitive(this.sets[0].node.cgmId,h,0,this.sets[0].indices.length);this.sets[0].decoration&&(u.decoration=this.sets[0].decoration),this.sets[0].boundingSphere&&(u.boundingSphere=this.sets[0].boundingSphere),h._primitives.push(u),i.drawingGroups.push(h),i.vertexIndexArray=this.sets[0].indices,i.vertexPositionArray=this.vertexBuffer.posBuffer,i.vertexNormalArray=this.vertexBuffer.normalBuffer,i.gas=a;var f=this.sets[0].boundingBoxCenter,d=this.sets[0].boundingBoxDim,c=[f[0]-d[0],f[1]-d[1],f[2]-d[2]],l=[f[0]+d[0],f[1]+d[1],f[2]+d[2]];return i.AABB={min:c,max:l},i};var bi=function(){ei.call(this),this.pointPrimimitivesSets=[],this.edgePrimitivesSets=[],this.vertexBuffer=null,this.indexBuffer=[],this.nbElEdge=0,this.nbElPoints=0,this.nbIndicesTotal=0};bi.prototype=Object.create(ei.prototype),bi.prototype.constructor=bi,bi.prototype.build=function(r){var i=[0,0,0],n=[0,0,0],s=r.getCurrentMatId();if(this.pointPrimimitivesSets.length||this.edgePrimitivesSets.length){var a=new e.Mesh,o=this.vertexBuffer.posBuffer.length;if(o>=3){i=[this.vertexBuffer.posBuffer[0],this.vertexBuffer.posBuffer[1],this.vertexBuffer.posBuffer[2]],n=[this.vertexBuffer.posBuffer[0],this.vertexBuffer.posBuffer[1],this.vertexBuffer.posBuffer[2]],a.vertexPositionArray=new Float32Array(o);for(var p=0;p<o;p+=3)a.vertexPositionArray[p]=this.vertexBuffer.posBuffer[p],a.vertexPositionArray[p+1]=this.vertexBuffer.posBuffer[p+1],a.vertexPositionArray[p+2]=this.vertexBuffer.posBuffer[p+2],a.vertexPositionArray[p]<i[0]&&(i[0]=a.vertexPositionArray[p]),a.vertexPositionArray[p+1]<i[1]&&(i[1]=a.vertexPositionArray[p+1]),a.vertexPositionArray[p+2]<i[2]&&(i[2]=a.vertexPositionArray[p+2]),a.vertexPositionArray[p]>n[0]&&(n[0]=a.vertexPositionArray[p]),a.vertexPositionArray[p+1]>n[1]&&(n[1]=a.vertexPositionArray[p+1]),a.vertexPositionArray[p+2]>n[2]&&(n[2]=a.vertexPositionArray[p+2])}a.AABB={min:i,max:n},a.vertexNormalArray=new Float32Array(o);for(p=0;p<o;p++)a.vertexNormalArray[p]=0;a.vertexIndexArray=new Uint32Array(this.nbIndicesTotal);var h=0;if(this.nbElEdge>0)for(p=0;p<this.edgePrimitivesSets.length;p++){var u=this.edgePrimitivesSets[p],f=new e.DrawingGroup(u.attr,s,1,h,u.nbIndices,void 0,void 0,t.GeomTypeEnum.WIRE_EDGE);a.drawingGroups.push(f);for(var d=u.set,c=0;c<d.length;c++){var l=d[c];f._primitives.push(l);for(var v=0;v<l.count;v++)a.vertexIndexArray[h++]=this.indexBuffer[l.start+v]}}if(this.nbElPoints)for(p=0;p<this.pointPrimimitivesSets.length;p++){u=this.pointPrimimitivesSets[p],f=new e.DrawingGroup(u.attr,s,0,h,u.nbIndices,void 0,void 0,t.GeomTypeEnum.BOUNDARY_POINT);a.drawingGroups.push(f);for(d=u.set,c=0;c<d.length;c++){(l=d[c]).attr=u.attr,f._primitives.push(l);for(v=0;v<l.count;v++)a.vertexIndexArray[h++]=this.indexBuffer[l.start+v]}}return a}return null};var Ci=function(){};Ci.prototype.unstream=function(e){return null};var wi=function(){};wi.prototype.unstream=function(e){var t=e.readCompressedInt();t<0&&(t=-t-2),e.skip(t-4)};var Si={LOD0:0,LOD1:1,LOD2:2,LOD3:3,FACES:4,LSG:5},Pi=["BOUNDARY_EDGE","SHARP_EDGE","SMOOTH_EDGE","BOUNDARY_POINT","SHARP_POINT","SMOOTH_POINT","SURFACIC_POINT","FREE_POINT","WIRE_EDGE","INFINITE_FACE","FACE","EDGE","ISOPAR","UNKNOWN"],Mi=function(){this.indices=[],this.cgmId=-1,this.count=0,this.start=0,this.material=null,this.connectivity=e.ConnectivityTypeEnum.TRIANGLES,this.gas=null,this.decoration=0,this.boundingSphere=null};Mi.prototype.constructor=Mi;var Fi=function(){Mi.call(this),this.planarNormals=null};Fi.prototype=Object.create(Mi.prototype),Fi.prototype.constructor=Fi;var Ti=[],Ri=[],Ui=[];Fi.prototype.unstream=function(e){var t=e.readUnsignedChar(),r=1&t,i=2&t,n=4&t,s=8&t,a=(e.isLightScenegraph(),0);r&&(a=e.readCompressedInt());var o=0;i&&(o=e.readCompressedInt());var p=0;n&&(p=e.readCompressedInt());e.readCompressedInt();s&&(this.planarNormals=new Array(3),e.readFloatArray(0,3,this.planarNormals));var h=a,u=0,f=0;if(e.version>=2100170||e.version>=1101910&&e.version<21e5){for(var d=0;d<o;++d){var c=e.readCompressedInt();Ti[d]=c,f+=c,h+=c-2}for(d=0;d<p;++d){var l=e.readCompressedInt();Ri[d]=l,u+=l,h+=l-2}}else{for(d=0;d<o;++d){c=e.unpackc();Ti[d]=c,f+=c,h+=c-2}for(d=0;d<p;++d){l=e.unpackc();Ri[d]=l,u+=l,h+=l-2}}if(!(h<=0)){this.indices=new Array(3*h);var v=3*a;e.unpackcArray(v,this.indices,0),e.unpackcArray(f+u,Ui,0);var m=0;for(d=0;d<o;++d){c=Ti[d];m+=2;for(var y=2;y<c;++y)y%2?(this.indices[v++]=Ui[m],this.indices[v++]=Ui[m-1],this.indices[v++]=Ui[m-2]):(this.indices[v++]=Ui[m-1],this.indices[v++]=Ui[m],this.indices[v++]=Ui[m-2]),m++}for(d=0;d<p;++d){var g=m;l=Ri[d];m+=2;for(y=2;y<l;++y)this.indices[v++]=Ui[g],this.indices[v++]=Ui[m-1],this.indices[v++]=Ui[m],m++}}};var Oi=function(){};Oi.prototype.unstream=function(e){var t=e.getNumberOfVertices(),r=e.unpackc();e.setNumberOfVertices(r);var i=(new Fi).unstream(e);return e.setNumberOfVertices(t),i};var Gi=function(){Mi.call(this),this.connectivity=e.ConnectivityTypeEnum.LINES};Gi.prototype=Object.create(Mi.prototype),Gi.prototype.constructor=Gi;var Ni=[];Gi.prototype.unstream=function(e){var t=e.readCompressedInt();if(t>0){e.unpackcArray(t,Ni,0);var r=1;if(t>1){this.indices=new Array(2*(t-1));this.indices[0]=Ni[0];for(var i=2;i<t;++i){var n=Ni[i-1];this.indices[r++]=n,this.indices[r++]=n}this.indices[r++]=Ni[t-1]}else this.indices=[]}e.version>=210021300&&e.readBoolean()},Gi.prototype.skip=function(e){var t=e.readCompressedInt();t>0&&e.unpackcArray(t,Ni,0),e.version>=210021300&&e.readBoolean()};var Ei=function(){Mi.call(this),this.connectivity=e.ConnectivityTypeEnum.LINES,this.posBuffer=[]};Ei.prototype=Object.create(Mi.prototype),Ei.prototype.constructor=Ei,Ei.prototype.unstream=function(e){var t=e.readCompressedInt(),r=e.readCompressedInt(),i=0;if(t)switch(r){case 0:for(var n=0;n<t;++n)this.indices.push(i++),this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat());break;case 1:if(t>0){this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat());for(n=1;n<t;++n)this.indices.push(i++),this.indices.push(i),this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat())}break;case 2:if(t>0){this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat());for(n=1;n<t;++n)this.indices.push(i++),this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat()),this.posBuffer.push(e.readFloat()),this.indices.push(i);this.indices.push(i),this.indices.push(0)}}},Ei.prototype.skip=function(e){var t=e.readCompressedInt();e.readCompressedInt();t&&e.skip(4*t*3)};var Vi=function(){Mi.call(this),this.connectivity=e.ConnectivityTypeEnum.POINTS,this.posBuffer=null,this.symbol=0};Vi.prototype=Object.create(Mi.prototype),Vi.prototype.constructor=Vi,Vi.prototype.skip=function(e){e.readCompressedInt();var t=e.readCompressedInt();e.skip(3*t*4)},Vi.prototype.unstream=function(t){this.symbol=t.readCompressedInt(),this.start=this.indices.length,this.connectivity=e.ConnectivityTypeEnum.POINTS;var r=t.readCompressedInt();this.posBuffer=new Array(3*r),t.readFloatArray(0,3*r,this.posBuffer);for(var i=0;i<r;++i)this.indices.push(i)};var Di=function(){Mi.call(this),this.connectivity=e.ConnectivityTypeEnum.TRIANGLES,this.posBuffer=[]};Di.prototype=Object.create(Mi.prototype),Di.prototype.constructor=Di,Di.prototype.unstream=function(e){e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readFloat(),e.readUnsignedChar()},Di.prototype.skip=function(e){e.skip(40),e.readUnsignedChar()};var Li=function(e){qr.call(this),this.rep=new oi(e)};Li.prototype=Object.create(qr.prototype),Li.prototype.constructor=Li,Li.prototype.unstream=function(e){(this.rep.unstream(e),e.version>=1000800)&&(e.readUnsignedChar()&&(this.rep.node.matrix=e.readMatrix()));e.pushMatrix(this.rep.node.matrix),Ln&&(this.rep.toBatch||this.rep.filterBagRep)&&e.pushFlexibleBatchingContext(this.rep);for(var t=e.readCompressedInt(),r=0;r<t;++r){if(1==e.readUnsignedChar()){Ln&&e.multiRefCount++;e.getCurrentMatrix();var i=null;Ln&&_n&&!this.rep.toBatch&&!this.rep.filterBagRep&&(this.rep.toBatch=!0,e.pushFlexibleBatchingContext(this.rep));var n=e.readCompressedInt();if(e.multiRefNode.isValidIndex(n)){if(p=e.multiRefNode.get(n)){if(!(Ln&&_n||e.expandCGR||this.rep.node.noShow)){var s=p.clone();this.addMesh(s,!1,e),this.rep.children.push(s),Ln&&e.multiRefCount--;continue}Ln&&e.multiRefCount--,this.rep.children.push(p)}}else{Ln&&_n&&e.pushFlexibleBatchingContext(this.rep);var a=e.readClassName(),o=e.getUnstreamer(a);if(e.error)return!1;var p=o.unstream(e,this.rep.node.noShow);if(i=p,e.error)return!1;if(e.multiRefNode.addAt(p,n),p)if(p.length)for(var h=0;h<p.length;h++)this.rep.children.push(p[h]);else this.rep.children.push(p)}Ln&&_n&&e.popFlexibleBatchingContext(i),Ln&&e.multiRefCount--}else{a=e.readClassName(),o=e.getUnstreamer(a);if(e.error)return!1;var u=o.unstream(e,this.rep.node.noShow);if(e.error)return!1;if(u)if(u.length)for(h=0;h<u.length;h++)this.rep.children.push(u[h]);else this.rep.children.push(u)}}e.version>=210021330&&(e.readUnsignedChar()&&(c?(this.rep.node.uuid_1=e.readUncompressedInt(),this.rep.node.uuid_2=e.readUncompressedInt(),this.rep.node.uuid_3=e.readUncompressedInt(),this.rep.node.uuid_4=e.readUncompressedInt()):e.skip(16)));return Ln&&this.rep.toBatch&&!this.rep.filterBagRep&&e.popFlexibleBatchingContext(this.rep),e.popMatId(),e.popGAS(),e.popMatrix(),this.rep},Li.prototype.addMesh=function(e,t,r){var i=!t;if(e){if(e.node.noShow)return;if(i&&(r.pushGAS(e.repGAS,e.repInheritanceMode),r.pushMatrix(e.node.matrix),r.pushMatId(e.material,e.materialInheritance,e.layer,e)),e instanceof ai||e instanceof ii){var n=null;if(-1!==e.multirefRepId&&r.multiRefCount)n=r.multiRefReps[e.multirefRepId].clone();else if(-1!==e.repIndice){n=r.getReps(e.repIndice,e.renderType).clone()}if(n){if(2==h&&(r.idOrder++,n.vertexPositionArray))for(var s=2;s<n.vertexPositionArray.length;s+=3)n.vertexPositionArray[s]=r.idOrder;n.rep=e;for(s=0;s<n.drawingGroups.length;++s){var a=n.drawingGroups;a[s].material&&a[s].material.primWithMaterials||(a[s].material=r.getCurrentMatId())}}if(!Ln){if(e.axisSystems){var o=r.axisSystems.get(e.axisSystems).axis;(n={axis:{origin:[o.origin[0],o.origin[1],o.origin[2]],xAxis:[o.xAxis[0],o.xAxis[1],o.xAxis[2]],yAxis:[o.yAxis[0],o.yAxis[1],o.yAxis[2]],zAxis:[o.zAxis[0],o.zAxis[1],o.zAxis[2]],color:o.color},globalMatrix:r.getCurrentMatrix()}).rep=e}if(e.curvedPipe>-1){var p=r.curvedPipes.get(e.curvedPipe);(n={curveVertices:p.curveVertices,startNormal:p.startNormal,endNormal:p.endNormal,radius:p.radius,startSideVector:p.startSideVector,matId:p.matId,gas:p.gas,globalMatrix:r.getCurrentMatrix()}).rep=e}if(e.canonical){var u=r.canonical.get(e.canonical);(n={type:u.type,vectors:u.vectors,floats:u.floats,matId:u.matId,gas:u.gas,globalMatrix:r.getCurrentMatrix()}).rep=e}}return null==n?(r.popMatId(),r.popMatrix(),r.popGAS(),null):(this.resolvedInheritance(r,n),void(i&&(r.popGAS(),r.popMatrix(),r.popMatId())))}}var f=e.children.length;for(s=0;s<f;s++)this.addMesh(e.children[s],!1,r);i&&(r.popGAS(),r.popMatrix(),r.popMatId())};var _i=function(e){Li.call(this),this.rep=new oi(e)};_i.prototype=Object.create(Li.prototype),_i.prototype.constructor=_i,_i.prototype.unstream=function(e){var r=new t.Vector3;if(e.pushReps(),e.setFixedMode(!0),Li.prototype.unstream.call(this,e),e.version<210021340)e.readFloat();else e.readFloat(),e.readFloat();var i=e.readUnsignedChar();1==i&&(r.x=e.readFloat(),r.y=e.readFloat(),r.z=e.readFloat()),e.setFixedMode(!1);var n=e.getAllReps();if(e.mergeWithPreviousReps(),1==i)for(var s=0;s<n.length;s++)n[s].globalMatrix||(n[s].globalMatrix=new t.Matrix4),n[s].globalMatrix.translate(r);return this.rep};var ki=function(e){Li.call(this),this.rep=new oi(e)};ki.prototype=Object.create(Li.prototype),ki.prototype.constructor=zi,ki.prototype.unstream=function(e){Li.prototype.unstream.call(this,e);var t=e.readCompressedInt();if(t>0){e.pushReps();for(var r=0;r<t;r++){e.readFloat();var i=e.readClassName(),n=e.getUnstreamer(i).unstream(e,this.rep.node.noShow);if(e.error)return!1;n&&this.rep.children.push(n)}e.popReps()}return this.rep};var ji=function(e){};ji.prototype=Object.create(Li.prototype),ji.prototype.constructor=zi,ji.prototype.unstream=function(e){var t=new Bi;if(t.rep.unstream(e),e.readBoolean()){var r=new Qt;r.unstream(e)}var i=e.getGAS(null),n=i.getDisplayedColor(),s=r.primitive;return t.refPlane.push({rep:t.rep.node,origin:s.origin,xAxis:s.direction1,yAxis:s.direction2,label:s.label,noShow:i.isHidden(),refPlaneData:s.refPlaneData,color:n,lengthX:s.lengthX,lengthY:s.lengthY,mode:s.mode,zoomable:s.mode===fe,type:"CAT3DReferencePlaneRep"}),t.addMesh(e),null};var zi=function(e){Li.call(this),this.rep=new oi(e)};zi.prototype=Object.create(Li.prototype),zi.prototype.constructor=zi,zi.prototype.unstream=function(e){this.rep.unstream(e);var t=e.getLightDataStreaming();e.setLightDataStreaming(!1);var r=e.readCompressedInt();if(r>0){var n=e.readClassName(),s=e.getUnstreamer(n).unstream(e,this.rep.node.noShow);if(e.error)return!1;s&&this.rep.children.push(s);e.readFloat()}if(r>1){for(e.pushReps(),i=1;i<r;i++){n=e.readClassName(),s=e.getUnstreamer(n).unstream(e,this.rep.node.noShow);if(e.error)return!1;s&&this.rep.children.push(s);e.readFloat()}e.popReps()}return e.popMatId(),e.popGAS(),e.setLightDataStreaming(t),this.rep};var Wi=function(e){this.rep=new oi(e)};Wi.prototype=Object.create(Li.prototype),Wi.prototype.constructor=Wi,Wi.prototype.readStaticMode=function(e){for(var r=e.readCompressedInt(),i=0;i<r;++i){if(e.readUnsignedChar()){var n=e.readCompressedInt();if(!e.fakeMultiRep.isValidIndex(n)||!e.multiRefNode.isValidIndex(n))if(e.fakeMultiRep.addAt(!0,n),112==(s=e.readClassName()))e.getUnstreamer(s).unstream(e,!0);else(new wi).unstream(e)}else{var s;if(112==(s=e.readClassName()))e.getUnstreamer(s).unstream(e,!0);else(new wi).unstream(e)}}var a=e.readCompressedInt();if(e.readFloatArray(0,3,[]),1==a&&(e.pushStaticMode(e.popMatrix()),e.currentMatrix.push(new t.Matrix4)),e.version>=1101500)e.readCompressedInt(),e.readCompressedInt(),e.readCompressedInt()},Wi.prototype.unstream=function(e){(this.rep.unstream(e),e.version>=1000800)&&(e.readUnsignedChar()&&(this.rep.node.matrix=e.readMatrix()));e.pushMatrix(this.rep.node.matrix);var t=e.getCurrentPosition();this.readStaticMode(e,[]),e.setCurrentPosition(t);for(var r=e.readCompressedInt(),i=0;i<r;++i){if(e.readUnsignedChar()){var n=e.readCompressedInt();if(e.multiRefNode.isValidIndex(n)){if(o=e.multiRefNode.get(n)){if(!e.expandCGR){var s=o.clone();this.addMesh(s,!1,e)}this.rep.children.push(o)}}else{var a=e.readClassName(),o=e.getUnstreamer(a).unstream(e);e.multiRefNode.addAt(o,n),o&&this.rep.children.push(o)}}else{a=e.readClassName();var p=e.getUnstreamer(a).unstream(e);p&&this.rep.children.push(p)}}e.popMatId(),e.popGAS(),e.popMatrix();var h=e.readCompressedInt();if(e.readFloatArray(0,3,[]),h&&e.popStaticMode(),e.version>=1101500)e.readCompressedInt(),e.readCompressedInt(),e.readCompressedInt();return this.rep};var Hi=function(e){this.rep=new ni(e)};Hi.prototype=Object.create(Li.prototype),Hi.prototype.constructor=Hi,Hi.prototype.unstream=function(e,t){(this.rep.unstream(e),e.version>=1000800)&&(e.readUnsignedChar()&&(this.rep.node.matrix=e.read2DMatrix()));e.pushMatrix(this.rep.node.matrix),Ln&&(this.rep.toBatch||this.rep.filterBagRep)&&e.pushFlexibleBatchingContext(this.rep);for(var r=e.readCompressedInt(),i=0;i<r;++i){if(1==e.readUnsignedChar()){Ln&&e.multiRefCount++;var n=null;Ln&&_n&&!this.rep.toBatch&&!this.rep.filterBagRep&&(this.rep.toBatch=!0,e.pushFlexibleBatchingContext(this.rep));var s=e.readCompressedInt();if(e.multiRefNode.isValidIndex(s)){if(t){Ln&&e.multiRefCount--;continue}if((h=e.multiRefNode.get(s))&&!(Ln&&_n||e.expandCGR||this.rep.node.noShow)){var a=h.clone();this.addMesh(a,!1,e),this.rep.children.push(a),Ln&&e.multiRefCount--;continue}Ln&&e.multiRefCount--,this.rep.children.push(h)}else{var o=e.readClassName();if(t){if(e.fakeMultiRep.isValidIndex(s)){Ln&&e.multiRefCount--;continue}if(112==o){(p=e.getUnstreamer(o)).unstream(e,!0),e.fakeMultiRep.addAt(!0,s),Ln&&e.multiRefCount--;continue}(new wi).unstream(e),Ln&&e.multiRefCount--;continue}Ln&&_n&&e.pushFlexibleBatchingContext(this.rep);var p=e.getUnstreamer(o);if(e.error)return!1;var h=p.unstream(e);if(e.error)return!1;if(e.multiRefNode.addAt(h,s),n=h,h)if(h.length)for(var u=0;u<h.length;u++)this.rep.children.push(h[u]);else this.rep.children.push(h)}Ln&&_n&&e.popFlexibleBatchingContext(n),Ln&&e.multiRefCount--}else{o=e.readClassName();if(t){if(112==o){(p=e.getUnstreamer(o)).unstream(e,!0);continue}(new wi).unstream(e);continue}if(e.error)return!1;p=e.getUnstreamer(o);if(e.error)return!1;var f=p.unstream(e);if(f)if(f.length)for(u=0;u<f.length;u++)this.rep.children.push(f[u]);else this.rep.children.push(f)}}return Ln&&this.rep.toBatch&&!this.rep.filterBagRep&&e.popFlexibleBatchingContext(this.rep),e.popMatId(),e.popGAS(),e.popMatrix(),this.rep};var Xi=function(){ti.call(this),this.gp=[]};Xi.prototype=Object.create(ti.prototype),Xi.prototype.constructor=Xi,Xi.prototype.build=function(t){var r=new e.Mesh,i=t.getCurrentMatId(),n=t.getGAS(this.gp.primitive.connectivity);n.setBasic(!0),n.setConnectivity(this.gp.primitive.connectivity);var s=new e.DrawingGroup(n,i,this.gp.primitive.connectivity==e.ConnectivityTypeEnum.LINES?1:4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,s,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),s._primitives.push(a),r.drawingGroups.push(s),r.vertexIndexArray=this.gp.primitive.indices,r.vertexPositionArray=this.gp.vertexBuffer.posBuffer,r.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,r.gas=n;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],r.vertexPositionArray.length);if(h>=3){o=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]],p=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]];for(var u=0;u<h;u+=3)r.vertexPositionArray[u]<o[0]&&(o[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]<o[1]&&(o[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]<o[2]&&(o[2]=r.vertexPositionArray[u+2]),r.vertexPositionArray[u]>p[0]&&(p[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]>p[1]&&(p[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]>p[2]&&(p[2]=r.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,r.AABB={min:o,max:p},r};var Yi=function(){ti.call(this),this.gp=[]};Yi.prototype=Object.create(ti.prototype),Yi.prototype.constructor=Yi,Yi.prototype.build=function(t){var r=new e.Mesh,i=t.getCurrentMatId(),n=t.getGAS(this.gp.primitive.connectivity);n.setConnectivity(this.gp.primitive.connectivity);var s=new e.DrawingGroup(n,i,this.gp.primitive.connectivity==e.ConnectivityTypeEnum.LINES?1:4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,s,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),s._primitives.push(a),r.drawingGroups.push(s),r.vertexIndexArray=this.gp.primitive.indices,r.vertexPositionArray=this.gp.vertexBuffer.posBuffer,r.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,r.gas=n;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],r.vertexPositionArray.length);if(h>=3){o=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]],p=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]];for(var u=0;u<h;u+=3)r.vertexPositionArray[u]<o[0]&&(o[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]<o[1]&&(o[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]<o[2]&&(o[2]=r.vertexPositionArray[u+2]),r.vertexPositionArray[u]>p[0]&&(p[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]>p[1]&&(p[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]>p[2]&&(p[2]=r.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,r.AABB={min:o,max:p},r};var qi=function(){ti.call(this),this.gp=[]};qi.prototype=Object.create(ti.prototype),qi.prototype.constructor=qi,qi.prototype.build=function(t){var r=new e.Mesh,i=t.getCurrentMatId(),n=t.getGAS(this.gp.primitive.connectivity);n.setBasic(!0),n.setConnectivity(this.gp.primitive.connectivity);var s=new e.DrawingGroup(n,i,this.gp.primitive.connectivity==e.ConnectivityTypeEnum.LINES?1:4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,s,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),s._primitives.push(a),r.drawingGroups.push(s),r.vertexIndexArray=this.gp.primitive.indices,r.vertexPositionArray=this.gp.vertexBuffer.posBuffer,r.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,r.gas=n;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],r.vertexPositionArray.length);if(h>=3){o=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]],p=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]];for(var u=0;u<h;u+=3)r.vertexPositionArray[u]<o[0]&&(o[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]<o[1]&&(o[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]<o[2]&&(o[2]=r.vertexPositionArray[u+2]),r.vertexPositionArray[u]>p[0]&&(p[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]>p[1]&&(p[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]>p[2]&&(p[2]=r.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,r.AABB={min:o,max:p},r};var Qi=function(){ti.call(this),this.gp=null,this.mat=!1};(Qi.prototype=Object.create(ti.prototype)).constructor=Qi,Qi.prototype.unstream=function(e){if(e.readBoolean()){var t=null;(e.version>=1101860&&e.version<21e5||e.version>=2100170?(t=new Ur).unstream(e):(t=new Or).unstream(e))&&(this.gp=t)}if(e.readBoolean()){var r=(new Ye).unstream(e),i=e.materials.add(r);r._MaterialPropertiesActivate;var n={file:"",id:i};if(e.pushMatId(n,1,0,this.rep),this.mat=!0,r&&void 0!==r.textureId&&this.gp&&this.gp.primitive&&6==this.gp.primitive.count){var s=this.gp.vertexBuffer.textureBuffer;s.push(0),s.push(0),s.push(0),s.push(1),s.push(0),s.push(0),s.push(1),s.push(1),s.push(0),s.push(0),s.push(1),s.push(0)}}};var Ji=function(){ti.call(this),this.gp=[],this.mat=!1};Ji.prototype=Object.create(ti.prototype),Ji.prototype.constructor=Ji,Ji.prototype.unstreamPerforatedPolygon=function(e){if(e.readBoolean()){var t=new Qi;t.unstream(e),t.gp&&(this.gp.push(t.gp),this.mat=t.mat)}},Ji.prototype.build=function(t){var r=new e.Mesh,i=t.getCurrentMatId();this.mat&&t.popMatId();var n=t.getGAS(this.gp[0].primitive.connectivity);n.isNoZ()&&n.setBasic(!0),n.setConnectivity(this.gp[0].primitive.connectivity);var s=new e.DrawingGroup(n,i,this.gp[0].primitive.connectivity==e.ConnectivityTypeEnum.LINES?1:4,0,this.gp[0].primitive.indices.length),a=new e.MeshPrimitive(this.gp[0].node.cgmId,s,0,this.gp[0].primitive.indices.length);this.gp[0].decoration&&(a.decoration=this.gp.decoration),this.gp[0].boundingSphere&&(a.boundingSphere=this.gp[0].boundingSphere),s._primitives.push(a),r.drawingGroups.push(s),r.vertexIndexArray=this.gp[0].primitive.indices,r.vertexPositionArray=this.gp[0].vertexBuffer.posBuffer,r.vertexNormalArray=this.gp[0].vertexBuffer.normalBuffer,r.vertexUvArray=this.gp[0].vertexBuffer.textureBuffer,r.gas=n;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],r.vertexPositionArray.length);if(h>=3){o=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]],p=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]];for(var u=0;u<h;u+=3)r.vertexPositionArray[u]<o[0]&&(o[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]<o[1]&&(o[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]<o[2]&&(o[2]=r.vertexPositionArray[u+2]),r.vertexPositionArray[u]>p[0]&&(p[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]>p[1]&&(p[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]>p[2]&&(p[2]=r.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,r.AABB={min:o,max:p},r};var Zi=function(){ti.call(this),this.gp=[]};Zi.prototype=Object.create(ti.prototype),Zi.prototype.constructor=Zi,Zi.prototype.build=function(t){var r=new e.Mesh,i=t.getCurrentMatId(),n=t.getGAS(this.gp.primitive.connectivity);n.setConnectivity(this.gp.primitive.connectivity);var s=new e.DrawingGroup(n,i,this.gp.primitive.connectivity==e.ConnectivityTypeEnum.LINES?1:4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,s,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),s._primitives.push(a),r.drawingGroups.push(s),r.vertexIndexArray=this.gp.primitive.indices,r.vertexPositionArray=this.gp.vertexBuffer.posBuffer,r.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,r.gas=n;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],r.vertexPositionArray.length);if(h>=3){o=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]],p=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]];for(var u=0;u<h;u+=3)r.vertexPositionArray[u]<o[0]&&(o[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]<o[1]&&(o[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]<o[2]&&(o[2]=r.vertexPositionArray[u+2]),r.vertexPositionArray[u]>p[0]&&(p[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]>p[1]&&(p[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]>p[2]&&(p[2]=r.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,r.AABB={min:o,max:p},r};var Ki=function(){ei.call(this),this.gp=[]};Ki.prototype=Object.create(ei.prototype),Ki.prototype.constructor=Ki,Ki.prototype.build=function(t){var r=new e.Mesh,i=t.getGAS(e.ConnectivityTypeEnum.TRIANGLES),n=t.getCurrentMatId();i.setConnectivity(0);var s=new e.DrawingGroup(i,n,4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,s,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),s._primitives.push(a),r.drawingGroups.push(s),r.vertexIndexArray=this.gp.primitive.indices,r.vertexPositionArray=this.gp.vertexBuffer.posBuffer,r.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,r.vertexUvArray=this.gp.vertexBuffer.textureBuffer,r.gas=i;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],r.vertexPositionArray.length);if(h>=3){o=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]],p=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]];for(var u=0;u<h;u+=3)r.vertexPositionArray[u]<o[0]&&(o[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]<o[1]&&(o[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]<o[2]&&(o[2]=r.vertexPositionArray[u+2]),r.vertexPositionArray[u]>p[0]&&(p[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]>p[1]&&(p[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]>p[2]&&(p[2]=r.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,r.AABB={min:o,max:p},r};var $i=function(){ti.call(this),this.gp=[]};$i.prototype=Object.create(ti.prototype),$i.prototype.constructor=$i,$i.prototype.build=function(t){var r=new e.Mesh,i=t.getGAS(this.gp.primitive.connectivity);i.setConnectivity(this.gp.primitive.connectivity);var n=t.getCurrentMatId(),s=new e.DrawingGroup(i,n,4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,s,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),s._primitives.push(a),r.drawingGroups.push(s),r.vertexIndexArray=this.gp.primitive.indices,r.vertexPositionArray=this.gp.vertexBuffer.posBuffer,r.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,r.vertexUvArray=this.gp.vertexBuffer.textureBuffer,r.gas=i;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],r.vertexPositionArray.length);if(h>=3){o=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]],p=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]];for(var u=0;u<h;u+=3)r.vertexPositionArray[u]<o[0]&&(o[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]<o[1]&&(o[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]<o[2]&&(o[2]=r.vertexPositionArray[u+2]),r.vertexPositionArray[u]>p[0]&&(p[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]>p[1]&&(p[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]>p[2]&&(p[2]=r.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,r.AABB={min:o,max:p},r};var en=function(){ti.call(this),this.gp=[]};en.prototype=Object.create(ti.prototype),en.prototype.constructor=en,en.prototype.build=function(t){var r=new e.Mesh,i=t.getCurrentMatId(),n=t.getGAS(this.gp.primitive.connectivity);n.setBasic(!0),n.setConnectivity(this.gp.primitive.connectivity);var s=new e.DrawingGroup(n,i,this.gp.primitive.connectivity==e.ConnectivityTypeEnum.LINES?1:4,0,this.gp.primitive.indices.length),a=new e.MeshPrimitive(this.gp.node.cgmId,s,0,this.gp.primitive.indices.length);this.gp.decoration&&(a.decoration=this.gp.decoration),this.gp.boundingSphere&&(a.boundingSphere=this.gp.boundingSphere),s._primitives.push(a),r.drawingGroups.push(s),r.vertexIndexArray=this.gp.primitive.indices,r.vertexPositionArray=this.gp.vertexBuffer.posBuffer,r.vertexNormalArray=this.gp.vertexBuffer.normalBuffer,r.gas=n;var o=[0,0,0],p=[0,0,0],h=(o=[0,0,0],p=[0,0,0],r.vertexPositionArray.length);if(h>=3){o=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]],p=[r.vertexPositionArray[0],r.vertexPositionArray[1],r.vertexPositionArray[2]];for(var u=0;u<h;u+=3)r.vertexPositionArray[u]<o[0]&&(o[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]<o[1]&&(o[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]<o[2]&&(o[2]=r.vertexPositionArray[u+2]),r.vertexPositionArray[u]>p[0]&&(p[0]=r.vertexPositionArray[u]),r.vertexPositionArray[u+1]>p[1]&&(p[1]=r.vertexPositionArray[u+1]),r.vertexPositionArray[u+2]>p[2]&&(p[2]=r.vertexPositionArray[u+2])}return o[2]=-.01,p[2]=.01,r.AABB={min:o,max:p},r};var tn=function(){ti.call(this),this.primitiveSets=[],this.vertexBuffer=null,this.imageRep=[],this.texts=[]};tn.prototype=Object.create(ti.prototype),tn.prototype.constructor=tn,tn.prototype.addGP=function(t,r,i){if(t.imageGP)this.imageRep.push(this.addImage(t,r,i,this.rep));else{null==this.vertexBuffer&&(this.vertexBuffer=new rt);for(var n=this.vertexBuffer.posBuffer.length/3,s=t.vertexBuffer,a=0;a<s.posBuffer.length;a++)this.vertexBuffer.posBuffer.push(s.posBuffer[a]),s.normalBuffer.length?this.vertexBuffer.normalBuffer.push(s.normalBuffer[a]):this.vertexBuffer.normalBuffer.push(void 0);var o=[];if(t.primitives&&t.primitives.length?o=t.primitives:o.push(t.primitive),1==h)for(a=0;a<o.length;a++){var p=o[a];(d={}).connectivity=p.connectivity,d.gas=r,d.material=p.material,d.nbIndices=p.indices.length,d.more_indices=0,d.set=[],d.set.push(p),this.primitiveSets.push(d);for(var u=p.indices,f=0;f<u.length;f++)u[f]=u[f]+n}else for(a=0;a<o.length;a++){p=o[a];var d,c=this.primitiveSets.length;for(f=0;f<c;f++){var l=this.primitiveSets[f];if(l.connectivity==p.connectivity&&l.gas.isEqual(r)&&e.isEqualMaterial(l.material,p.material)){l.set.push(p),l.nbIndices+=p.indices.length;break}}if(f==this.primitiveSets.length)(d={}).connectivity=p.connectivity,d.gas=r,d.material=p.material,d.nbIndices=p.indices.length,d.more_indices=0,d.set=[],d.set.push(p),this.primitiveSets.push(d);for(u=p.indices,f=0;f<u.length;f++)u[f]=u[f]+n}}},tn.prototype.addImage=function(e,r,i,n){var s=new $i,a=i.getCurrentMatrix();if(s.rep.repInheritanceMode=n.repInheritanceMode,s.rep.repGAS=n.repGAS,s.rep.materialInheritance=n.materialInheritance,s.rep.repInheritanceMode=n.repInheritanceMode,s.rep.node.noShow=n.node.noShow,s.vertexBuffer=new rt,s.gp=e,e&&e.primitive){if(void 0!==e.zoomQuality&&0===e.zoomQuality&&i.setFixedMode(!0),e.point){var o,p=(new t.Matrix4).setPosition({x:e.point[0],y:e.point[1],z:e.point[2]});o=a?(new t.Matrix4).multiplyMatrices(a,p):p,i.pushStaticMode(o),i.currentMatrix.push(new t.Matrix4)}e.primitive.material&&i.pushMatId(e.primitive.material,1,0,s.rep);var h=s.build(i);s.resolvedInheritance(i,h),h.rep=s.rep,i.popStaticMode(),e.point&&(i.currentMatrix.pop(),i.popStaticMode()),e.primitive.material&&i.popMatId(),i.setFixedMode(!1)}return s.rep},tn.prototype.build=function(e){return 0==this.primitiveSets.length?null:this.buildRep(this.vertexBuffer,this.primitiveSets,e)};var rn=function(){Li.call(this)};rn.prototype=Object.create(Li.prototype),rn.prototype.constructor=rn,rn.prototype.unstream=function(e){e.readCompressedInt();var t=Li.prototype.unstream.call(this,e);e.readFloat();return t};var nn=function(){Li.call(this)};nn.prototype=Object.create(Li.prototype),nn.prototype.constructor=nn,nn.prototype.unstream=function(e){var t=e.getCurrentPosition(),r=t+e.readCompressedInt();e.setCurrentPosition(r);var i=e.readUnsignedChar();e.setSemanticType(i),e.setCurrentPosition(t);e.readCompressedInt();var n=Li.prototype.unstream.call(this,e);e.readUnsignedChar();return n};var sn=function(e){Hi.call(this),this.rep=new ni(e)};sn.prototype=Object.create(Hi.prototype),sn.prototype.constructor=sn,sn.prototype.unstream=function(e){e.pushReps(),e.setFixedMode(!0),Hi.prototype.unstream.call(this,e);e.readFloat();var r=e.readUnsignedChar(),i=new t.Vector3;1==r&&(i.x=e.readFloat(),i.y=e.readFloat()),e.setFixedMode(!1);var n=e.getAllReps();if(e.mergeWithPreviousReps(),1==r)for(var s=0;s<n.length;s++)n[s].globalMatrix||(n[s].globalMatrix=new t.Matrix4),n[s].globalMatrix.translate(i);return this.rep};var an=function(){Hi.call(this)};an.prototype=Object.create(Hi.prototype),an.prototype.constructor=an,an.prototype.unstream=function(e){var t=e.readCompressedInt(),r=Hi.prototype.unstream.call(this,e);e.readCompressedInt();return t=e.readCompressedInt(),(t=Math.abs(t))>0&&e.skip(4*(2*t+1)),r};var on=function(){Li.call(this)};on.prototype=Object.create(Li.prototype),on.prototype.constructor=on,on.prototype.unstream=function(e){var r=e.getCurrentPosition()+(a=e.readCompressedInt())+1;e.getCurrentMatrix();Ln&&(this.rep.filterBagRep=!0);for(var i=Li.prototype.unstream.call(this,e),n=e.readCompressedInt(),s=0;s<n;s++){switch(e.readUnsignedChar()){case x:if(e.version>=210042600){var a=e.readUncompressedULong();for(e.readCompressedInt(),s=0;s<a;++s)e.readCompressedInt(),e.readFloat(),e.readUnsignedShort(),e.readUnsignedChar()}break;case B:var o=e.readCompressedInt();if(o>0){var p=[],h=[],u=[];e.readFloatArray(0,3*o,h),e.readFloatArray(0,3*o,u),e.readUncompressedIntArray(o,p);var f={flags:p,points:h,normals:u},d=t._FilterType.CLIPPINGFILTER;i.node.attributes.push({attribute:f,typeAttribute:d}),!0}break;case A:if(e.readBoolean())e.readGraphicAttributeSet();if(e.readBoolean())e.readMatrix();var c=[];if(e.version>=210021610){var l=e.readCompressedInt();if(l>0)e.readFloatArray(0,l,c);else{var v=e.readCompressedInt();v>0&&(e.readFloatArray(1,l,c),c[1]<0?c[0]=-1:c[0]=1,c[1]=v)}}d=t._FilterType.SCISSORFILTER;c.length&&(i.node.attributes.push({attribute:c,typeAttribute:d}),!0);break;case I:e.readBytes(1024,[]);e.readCompressedInt()}}return e.setCurrentPosition(r),Ln&&e.popFlexibleBatchingContext(i),i};var pn=function(){Hi.call(this)};pn.prototype=Object.create(pn.prototype),pn.prototype.constructor=Hi,pn.prototype.unstream=function(e){Ln&&(this.rep.filterBagRep=!0);for(var t=Hi.prototype.unstream.call(this,e),r=e.readCompressedInt(),i=0;i<r;i++){switch(e.readUnsignedChar()){case x:if(e.version>=210042600){var n=e.readUncompressedULong();for(e.readCompressedInt(),i=0;i<n;++i)e.readCompressedInt(),e.readFloat(),e.readUnsignedShort(),e.readUnsignedChar()}break;case B:var s=e.readCompressedInt();if(s>0){var a=[],o=[],p=[];e.readFloatArray(0,s,o),e.readFloatArray(0,s,p),e.readUncompressedIntArray(s,a);var h={flags:a,points:o,normals:p},u=2;t.node.attributes.push({attribute:h,typeAttribute:u}),!0}break;case A:if(e.readBoolean())e.readGraphicAttributeSet();if(e.readBoolean())e.readMatrix();var f=[];if(e.version>=210021610){var d=e.readCompressedInt();if(d>0)e.readFloatArray(0,d,f);else{var c=e.readCompressedInt();c>0&&(e.readFloatArray(1,d,f),f[1]<0?f[0]=-1:f[0]=1,f[1]=c)}}h={polygon:f},u=1;f.length&&(t.node.attributes.push({attribute:h,typeAttribute:u}),t.node.typeAttribute=1,!0);break;case I:e.readBytes(1024,[]);e.readCompressedInt()}}return Ln&&e.popFlexibleBatchingContext(t),t};var hn=function(){Li.call(this)};hn.prototype=Object.create(Li.prototype),hn.prototype.constructor=hn,hn.prototype.unstream=function(e){var t=Li.prototype.unstream.call(this,e);e.readUnsignedChar();return t};var un=function(){fn.call(this)};un.prototype=Object.create(Hi.prototype),un.prototype.constructor=fn,un.prototype.unstream=function(e){var t=fn.prototype.unstream.call(this,e);if(1==e.readUnsignedChar()&&e.version>=210042600)for(var r=e.readUncompressedULong(),i=0;i<r;++i)e.readCompressedInt(),e.readFloat(),e.readUnsignedShort(),e.readUnsignedChar();return t};var fn=function(){Hi.call(this)};fn.prototype=Object.create(Hi.prototype),fn.prototype.constructor=fn,fn.prototype.unstream=function(e){var t=Hi.prototype.unstream.call(this,e);return e.readBytes(16,[]),t};var dn=function(){Hi.call(this)};dn.prototype=Object.create(Hi.prototype),dn.prototype.constructor=dn,dn.prototype.unstream=function(e){e.pushReps();var t=Hi.prototype.unstream.call(this,e),r=(e.readUnsignedChar(),{lineWeight:e.readUnsignedChar(),lineType:e.readUnsignedShort(),lineTypeScale:e.readFloat()}),i=e.advancedInheritance.add(r),n=e.getAllReps();e.mergeWithPreviousReps();for(var s=0;s<n.length;s++)n[s]._advancedInheritanceIndex=i;return t};var cn=function(){on.call(this)};cn.prototype=Object.create(on.prototype),cn.prototype.constructor=cn,cn.prototype.unstream=function(e){e.getCurrentPosition(),e.readCompressedInt();var t=on.prototype.unstream.call(this,e);return e.readFloat(),t};var ln=function(){Li.call(this)};ln.prototype=Object.create(Li.prototype),ln.prototype.constructor=ln,ln.prototype.applyTextureMatrix=function(r,i,n){if(i.node instanceof e.SGBag)for(o=0;o<i.children.length;o++)this.applyTextureMatrix(r,i.children[o],n);else{var s=r.getReps(i.repIndice,i.renderType).vertexUvArray,a=s?s.length/3:0;if(a>0)for(var o=0,p=0,h=new t.Vector4,o=0;o<a;o++,p+=3)h.set(s[p],s[p+1],s[p+2],1),h.applyMatrix4(n),s[p]=h.x/h.w,s[p+1]=h.y/h.w,s[p+2]=h.z/h.w}},ln.prototype.unstream=function(e,t){Li.prototype.unstream.call(this,e,t);if(e.readBoolean()){var r=gn.prototype.unstream.call(this,e);void 0!==r.textureMatrix&&this.applyTextureMatrix(e,this.rep,r.textureMatrix)}return this.rep};var vn=function(e){qr.call(this),this.rep=new ai(e)};(vn.prototype=Object.create(qr.prototype)).constructor=vn,vn.prototype.convertConnectivity=function(t){switch(t){case 0:return e.ConnectivityTypeEnum.POINTS;case 1:return e.ConnectivityTypeEnum.LINES;case 2:return e.ConnectivityTypeEnum.LINE_STRIP;case 3:return e.ConnectivityTypeEnum.LINE_LOOP;case 4:return e.ConnectivityTypeEnum.TRIANGLES;case 5:return e.ConnectivityTypeEnum.TRIANGLE_STRIP;case 6:return e.ConnectivityTypeEnum.TRIANGLE_FAN;default:return e.ConnectivityTypeEnum.TRIANGLES}},vn.prototype.getByteSize=function(t){switch(t){case e.DataTypeEnum.CHAR:case e.DataTypeEnum.UCHAR:return 1;case e.DataTypeEnum.SHORT:case e.DataTypeEnum.USHORT:return 2;case e.DataTypeEnum.INT:case e.DataTypeEnum.UINT:case e.DataTypeEnum.FLOAT:return 4;case e.DataTypeEnum.DOUBLE:return 8;default:return 1}},vn.prototype.addSet=function(e){},vn.prototype.unstream=function(t){let r;t.setNumberOfVertices(16777216);var i=t.readCompressedInt();if(i<=0)return null;var n=[],s=new e.PrimitiveGroup;s.fillAttr=new e.FillAttributes,s.lineAttr=new e.LineAttributes;for(var a=0;a<i;a++){var o=0;(m=new e.Buffer).indexBuffer=t.readBoolean(),o=t.readCompressedInt(),m.format=t.readUnsignedChar(),m.dimension=t.readUnsignedChar(),m.size=o*m.dimension;var p=t.readBoolean();switch(s.addBuffer(a,m),p){case kr:m.data=new Float32Array(m.size),t.readPositionsArrayBuffer(o,m.data,0);break;case jr:m.data=new Float32Array(m.size),t.readNormalsArrayBuffer(o,m.data,0);break;case _r:switch(m.format){case e.DataTypeEnum.FLOAT:m.data=new Float32Array(m.size),t.readFloatArray(0,m.size,m.data);break;case e.DataTypeEnum.INT:m.data=new Int32Array(m.size),t.readUncompressedIntArray(m.size,m.data);break;case e.DataTypeEnum.UINT:m.data=new Uint32Array(m.size),t.readUncompressedIntArray(m.size,m.data);break;default:m.data=new Uint8Array(m.size),t.readBytes(m.size,m.data)}}}var h,u,f,d=t.readCompressedInt();if(d<=0&&i<=0)return this.rep.unstream(t),null;for(a=0;a<d;a++){var c=new e.Primitive;c.nbIndices=t.readCompressedInt(),c.connectivity=this.convertConnectivity(t.readUnsignedChar());for(var l=t.readCompressedInt(),v=0;v<l;v++){var m,y=new e.VertexComponent;if(y.component=t.readUnsignedChar(),y.cardinality=t.readUnsignedChar(),y.bufferId=t.readCompressedInt(),y.offset=t.readCompressedInt(),y.indices=null,t.version>=210042715&&(y.nbValuesPerVertex=t.readCompressedInt(),y.stride=t.readCompressedInt(),y.stride>0&&(r="mono")),null!==(m=s.getBufferFromId(y.bufferId))||null!==h){let t;if(y.stride||null===m){h&&u===y.bufferId||(h=m,u=y.bufferId,f=y.bufferId,s.removeBuffer(f)),t=this.getByteSize(h.format),y.stride/=t,y.offset/=t;let r,i=h.size/h.dimension,n=new e.Buffer;if(n.indexBuffer=0,y.component===e.VertexComponentEnum.POSITION||y.component===e.VertexComponentEnum.TEX_COORD_0||y.component===e.VertexComponentEnum.TEX_COORD_1||y.component===e.VertexComponentEnum.TEX_COORD_2||y.component===e.VertexComponentEnum.TEX_COORD_3){r=new Float32Array(3*i);for(B=0;B<i;B++)for(var g=0;g<y.nbValuesPerVertex;g++)r[3*B+g]=h.data[y.offset+y.stride*B+g];n.size=3*i,n.dimension=3,n.oldDimension=y.nbValuesPerVertex,y.nbValuesPerVertex=3}else{r=new Float32Array(i*y.nbValuesPerVertex);for(B=0;B<i;B++)for(g=0;g<y.nbValuesPerVertex;g++)r[3*B+g]=h.data[y.offset+y.stride*B+g];n.size=i*y.nbValuesPerVertex,n.dimension=y.nbValuesPerVertex}n.data=r,n.component=y.component,n.format=h.format,s.addBuffer(f,n),y.bufferId=f,f=s.nbBuffers,y.format=n.format}else{if(t=this.getByteSize(m.format),m.oldDimension?y.offset/=t*m.oldDimension:y.offset/=t*m.dimension,m.component=y.component,(m.component===e.VertexComponentEnum.POSITION||m.component===e.VertexComponentEnum.TEX_COORD_0||m.component===e.VertexComponentEnum.TEX_COORD_1||m.component===e.VertexComponentEnum.TEX_COORD_2||m.component===e.VertexComponentEnum.TEX_COORD_3)&&m.dimension<3){o=m.size/m.dimension;for(var x=new Float32Array(3*o),B=0;B<o;B++)x[3*B]=m.data[m.dimension*B],m.dimension>1?x[3*B+1]=m.data[2*B+1]:x[3*B+1]=0,x[3*B+2]=0;m.data=x,m.size=3*o,m.oldDimension=m.dimension,m.dimension=3}y.nbValuesPerVertex=m.dimension,y.format=m.format}}if(t.readBoolean()&&(y.indices=new e.IndexArray,y.indices.bufferId=t.readCompressedInt(),y.indices.offset=t.readCompressedInt(),null!==(m=s.getBufferFromId(y.indices.bufferId)))){var A=this.getByteSize(m.format);y.indices.offset/=A,y.indices.format=m.format}c.addVertexComponent(y)}var I=null;if(t.readBoolean()){var b=gn.prototype.unstream.call(this,t);b.gas&&(I=b.gas)}var C=!1;if(c)c._usedVertexColor()&&(C=!0);n.push({prim:c,gas:I,pointSize:b.size,symbol:b.symbol,usedVertexColor:C})}this.rep.unstream(t);for(a=0;a<n.length;a++){if(n[a].gas){t.pushGAS(n[a].gas,0);var w=t.getGAS(n[a].prim.connectivity);w.getDisplayedColor(),w.isTransparent(),w.getType(),w.getLineThickness();w.setConnectivity(n[a].prim.connectivity),n[a].prim.attr=w,t.popGAS()}else(w=t.getGAS(n[a].prim.connectivity)).setConnectivity(n[a].prim.connectivity),n[a].prim.attr=w;n[a].pointSize&&n[a].prim.attr.setPointSize(n.pointSize),n[a].symbol&&n[a].prim.attr.setSymbol(n[a].symbol),n[a].usedVertexColor&&n[a].prim.connectivity==e.ConnectivityTypeEnum.POINTS&&(n[a].prim.attr.setVertexColor(),n[a].prim.attr.setColor(8),n[a].symbol&&n[a].prim.attr.setSymbol(0),n[a].pointSize||n[a].prim.attr.setLineThickness(1)),s.addPrimitive(n[a].prim)}s.material=t.getCurrentMatId();var S=e.convertToGeometry3js(s,void 0,void 0,void 0,r,!0);return S.rep=this.rep,this.resolvedInheritance(t,S),t.popMatId(),t.popGAS(),this.rep};var mn=function(e){qr.call(this),this.rep=new ii(e)};mn.prototype=Object.create(vn.prototype),mn.prototype.constructor=mn;var yn=function(e){qr.call(this),this.rep=new ai(e)};yn.prototype=Object.create(vn.prototype),yn.prototype.constructor=yn;var gn=function(){};gn.prototype.constructor=gn,gn.prototype.getNbAttributes=function(e){for(var t=0;e;)1&e&&t++,e>>=1;return t},gn.prototype.getAttributeType=function(e,t){for(var r=1,i=0;i<t+1;i++){for(;!(1&e);)e>>=1,r<<=1;e>>=1,i!==t&&(r<<=1)}return r},gn.prototype.unstream=function(e){for(var r={},i=e.readCompressedInt(),n=e.getCurrentPosition(),s=e.readCompressedInt(),a=gn.prototype.getNbAttributes(i),o=0;o<a;o++){switch(gn.prototype.getAttributeType(i,o)){case zr:r.gas=e.readGraphicAttributeSet();break;case Wr:var p=[];if(e.version>=210021610){var h=e.readCompressedUInt(),u=e.readUnsignedChar(),f=[];e.readDoubles(f,u);var d=0;for(o=0,d=0;o<16;o++){switch((h&3<<2*o)>>>2*o){case 0:p.push(f[d++]);break;case 1:p.push(0);break;case 2:p.push(1);break;case 3:p.push(-1)}}}else p=new Float32Array(16),e.readFloatArray(0,16,p);var c=new t.Matrix4;c.set(p[0],p[4],p[8],p[12],p[1],p[5],p[9],p[13],p[2],p[6],p[10],p[14],p[3],p[7],p[11],p[15]),r.textureMatrix=c;break;case Hr:e.readCompressedInt();break;case Xr:r.symbol=e.readCompressedInt();break;case Yr:r.size=e.readCompressedInt()}}return e.setCurrentPosition(n+s),r};var xn=function(){return Dn?{sag:Dn.sag3D,sagMode:Dn.sagmode3D}:{sag:.2,sagMode:1}},Bn=function(){return!!Dn&&3==Dn.cgrType},An=function(e){switch(e){case"Cuboid":case"Sphere":case"PartialSphere":case"Cone":return!0;case"Cylinder":case"PartialTorus":case"Torus":case"CurvedPipe":return!n;default:console.error("wrong type : "+e)}},In=function(){ei.call(this)};In.prototype=Object.create(ei.prototype),In.prototype.constructor=In,In.prototype.unstream=function(e){return this.rep.unstream(e),this.infos={bottomCenter:[e.readFloat(),e.readFloat(),e.readFloat()],topCenter:[e.readFloat(),e.readFloat(),e.readFloat()],bottomRadius:e.readFloat(),topRadius:e.readFloat()},this.addMesh(e)?this.rep:null},In.prototype.build=function(t){var r,i=t.getCurrentMatId(),n=t.getGAS(e.ConnectivityTypeEnum.TRIANGLES);r=t.isASMColor()?t.getGAS(null):n.clone();var s=this.infos;return!An("Cone")?{gas:n,matId:i,canonicalType:de,vectors:[s.bottomCenter[0],s.bottomCenter[1],s.bottomCenter[2],s.topCenter[0],s.topCenter[1],s.topCenter[2]],floats:[s.bottomRadius,s.topRadius]}:e._createCustomCylindricalMesh(s.bottomCenter,s.topCenter,s.bottomRadius,s.topRadius,n,i,xn(),!0,t.decorations,r,Bn())};var bn=function(){ei.call(this)};bn.prototype=Object.create(ei.prototype),bn.prototype.constructor=bn,bn.prototype.unstream=function(e){return this.rep.unstream(e),this.infos={corner:[e.readFloat(),e.readFloat(),e.readFloat()],firstAxis:[e.readFloat(),e.readFloat(),e.readFloat()],secondAxis:[e.readFloat(),e.readFloat(),e.readFloat()],thirdlength:e.readFloat()},this.addMesh(e)?this.rep:null},bn.prototype.build=function(t){var r,i=t.getCurrentMatId(),n=t.getGAS(e.ConnectivityTypeEnum.TRIANGLES);r=t.isASMColor()?t.getGAS(null):n.clone();var s=this.infos;return!An("Cuboid")?{gas:n,matId:i,canonicalType:le,vectors:[s.corner[0],s.corner[1],s.corner[2],s.firstAxis[0],s.firstAxis[1],s.firstAxis[2],s.secondAxis[0],s.secondAxis[1],s.secondAxis[2]],floats:[s.thirdlength]}:e._createCuboidMesh(s.corner,s.firstAxis,s.secondAxis,s.thirdlength,n,i,!0,null,r,Bn())};var Cn=function(){ei.call(this)};Cn.prototype=Object.create(ei.prototype),Cn.prototype.constructor=Cn,Cn.prototype.unstream=function(e){this.rep.unstream(e);for(var t=e.readCompressedUInt(),r=[],i=0;i<3*t;i++)r.push(e.readFloat());return this.infos={centers:r,startN:[e.readFloat(),e.readFloat(),e.readFloat()],endN:[e.readFloat(),e.readFloat(),e.readFloat()],radius:e.readFloat()},this.addMesh(e)?this.rep:null},Cn.prototype.build=function(r){var i,n=r.getCurrentMatId(),s=r.getGAS(e.ConnectivityTypeEnum.TRIANGLES);i=r.isASMColor()?r.getGAS(null):s.clone();var a=this.infos;if(!An("CurvedPipe")){var o=[-a.startN[2],a.startN[0],-a.startN[1]],p=(a.endN[2],a.endN[0],a.endN[1],[a.startN[1]*o[2]-a.startN[2]*o[1],a.startN[2]*o[0]-a.startN[0]*o[2],a.startN[0]*o[1]-a.startN[1]*o[0]]),h=s.getDisplayedColor(),u=new t.Color;return u.setRGB(h[0]/255,h[1]/255,h[2]/255),{gas:{color:u,opacity:h[3]/255},matId:n,curveVertices:a.centers,startNormal:a.startN,endNormal:a.endN,radius:a.radius,startSideVector:p}}for(var f=[],d=[],c=0,l=0;l<a.centers.length/3;l++)d.push(a.radius),f.push(new t.Vector3(a.centers[c++],a.centers[c++],a.centers[c++]));var v=new t.Vector3(a.startN[0],a.startN[1],a.startN[2]),m=new t.Vector3(a.endN[0],a.endN[1],a.endN[2]);return e._createCurvedPipeMesh(f,d,v,m,!0,s,n,xn(),!0,null,null,i,Bn())};var wn=function(){ei.call(this)};wn.prototype=Object.create(ei.prototype),wn.prototype.constructor=wn,wn.prototype.unstream=function(e){return this.rep.unstream(e),this.infos={bottomCenter:[e.readFloat(),e.readFloat(),e.readFloat()],topCenter:[e.readFloat(),e.readFloat(),e.readFloat()],radius:e.readFloat()},this.addMesh(e)?this.rep:null},wn.prototype.build=function(r){var i,s=r.getCurrentMatId(),a=r.getGAS(e.ConnectivityTypeEnum.TRIANGLES);i=r.isASMColor()?r.getGAS(null):a.clone();var o=this.infos,p=[o.topCenter[0]-o.bottomCenter[0],o.topCenter[1]-o.bottomCenter[1],o.topCenter[2]-o.bottomCenter[2]],h=Math.sqrt(p[0]*p[0]+p[1]*p[1]+p[2]*p[2]);p[0]/=h,p[1]/=h,p[2]/=h;var u=[-p[2],p[0],-p[1]],f=[p[1]*u[2]-p[2]*u[1],p[2]*u[0]-p[0]*u[2],p[0]*u[1]-p[1]*u[0]],d=!An("Cylinder");if(n){var c=a.getDisplayedColor(),l=new t.Color;return l.setRGB(c[0]/255,c[1]/255,c[2]/255),{gas:{color:l,opacity:c[3]/255},matId:s,curveVertices:[o.bottomCenter[0],o.bottomCenter[1],o.bottomCenter[2],o.topCenter[0],o.topCenter[1],o.topCenter[2]],startNormal:[-p[0],-p[1],-p[2]],endNormal:p,radius:o.radius,startSideVector:f}}return d?{gas:a,matId:0,canonicalType:ce,vectors:[o.bottomCenter[0],o.bottomCenter[1],o.bottomCenter[2],o.topCenter[0],o.topCenter[1],o.topCenter[2]],floats:[o.radius]}:e._createCustomCylindricalMesh(o.bottomCenter,o.topCenter,o.radius,o.radius,a,s,xn(),!0,r.decorations,i,Bn())};var Sn=function(){ei.call(this)};Sn.prototype=Object.create(ei.prototype),Sn.prototype.constructor=Sn,Sn.prototype.unstream=function(e){return this.rep.unstream(e),this.infos={center:[e.readFloat(),e.readFloat(),e.readFloat()],firstAxis:[e.readFloat(),e.readFloat(),e.readFloat()],secondAxis:[e.readFloat(),e.readFloat(),e.readFloat()],meridianStartAngle:e.readFloat(),meridianEndAngle:e.readFloat(),parallelStartAngle:e.readFloat(),parallelEndAngle:e.readFloat()},this.addMesh(e)?this.rep:null},Sn.prototype.build=function(t){var r=t.getCurrentMatId(),i=t.getGAS(null),n=this.infos;return!An("PartialSphere")?{gas:i,matId:r,canonicalType:me,vectors:[n.center[0],n.center[1],n.center[2],n.firstAxis[0],n.firstAxis[1],n.firstAxis[2],n.secondAxis[0],n.secondAxis[1],n.secondAxis[2]],floats:[n.meridianStartAngle,n.meridianEndAngle,n.parallelStartAngle,n.parallelEndAngle]}:e._createCustomSphereMesh(n.parallelStartAngle,n.parallelEndAngle,n.meridianStartAngle,n.meridianEndAngle,n.center,n.firstAxis,n.secondAxis,i,r,xn(),!0,t.decorations)};var Pn=function(){ei.call(this)};Pn.prototype=Object.create(ei.prototype),Pn.prototype.constructor=Pn,Pn.prototype.unstream=function(e){return this.rep.unstream(e),this.infos={center:[e.readFloat(),e.readFloat(),e.readFloat()],firstAxis:[e.readFloat(),e.readFloat(),e.readFloat()],secondAxis:[e.readFloat(),e.readFloat(),e.readFloat()],minorRadius:e.readFloat(),majorAngle:e.readFloat()},this.addMesh(e)?this.rep:null},Pn.prototype.build=function(r){var i,s=r.getCurrentMatId(),a=r.getGAS(e.ConnectivityTypeEnum.TRIANGLES);i=r.isASMColor()?r.getGAS(null):a.clone();var o=this.infos,p=!An("PartialTorus"),h=e._buildCurvedPipeDataFromTorus(new t.Vector3(o.center[0],o.center[1],o.center[2]),new t.Vector3(o.firstAxis[0],o.firstAxis[1],o.firstAxis[2]),new t.Vector3(o.secondAxis[0],o.secondAxis[1],o.secondAxis[2]),o.majorAngle,xn(),o.minorRadius);if(n){var u=a.getDisplayedColor(),f=new t.Color;return f.setRGB(u[0]/255,u[1]/255,u[2]/255),{gas:{color:f,opacity:u[3]/255},matId:s,curveVertices:h.centers,startNormal:h.startNormal,endNormal:h.endNormal,startSideVector:o.firstAxis,radius:o.minorRadius}}if(p)return{gas:a,matId:s,canonicalType:ge,vectors:[o.center[0],o.center[1],o.center[2],o.firstAxis[0],o.firstAxis[1],o.firstAxis[2],o.secondAxis[0],o.secondAxis[1],o.secondAxis[2]],floats:[o.minorRadius,o.majorAngle]};for(var d=[],c=[],l=0,v=0;v<h.centers.length/3;v++)c.push(o.minorRadius),d.push(new t.Vector3(h.centers[l++],h.centers[l++],h.centers[l++]));var m=new t.Vector3(h.startNormal[0],h.startNormal[1],h.startNormal[2]),y=new t.Vector3(h.endNormal[0],h.endNormal[1],h.endNormal[2]);return e._createCurvedPipeMesh(d,c,m,y,!0,a,s,xn(),!0,r.decorations,o,i,Bn())};var Mn=function(){ei.call(this)};Mn.prototype=Object.create(ei.prototype),Mn.prototype.constructor=Mn,Mn.prototype.unstream=function(e){return this.rep.unstream(e),this.infos={center:[e.readFloat(),e.readFloat(),e.readFloat()],radius:e.readFloat()},this.addMesh(e)?this.rep:null},Mn.prototype.build=function(t){var r=t.getCurrentMatId(),i=t.getGAS(null),n=this.infos;return!An("Sphere")?{gas:i,matId:r,canonicalType:ve,vectors:n.center,floats:[n.radius]}:e._createCustomSphereMesh(-Math.PI/2,Math.PI/2,0,2*Math.PI,n.center,[n.radius,0,0],[0,1,0],i,r,xn(),!0,t.decorations)};var Fn=function(){ei.call(this)};Fn.prototype=Object.create(ei.prototype),Fn.prototype.constructor=Fn,Fn.prototype.unstream=function(e){return this.rep.unstream(e),this.infos={center:[e.readFloat(),e.readFloat(),e.readFloat()],planeNormal:[e.readFloat(),e.readFloat(),e.readFloat()],minorRadius:e.readFloat()},this.addMesh(e)?this.rep:null},Fn.prototype.build=function(r){var i=r.getCurrentMatId(),s=r.getGAS(null),a=this.infos,o=new t.Vector3(a.planeNormal[0],a.planeNormal[1],a.planeNormal[2]),p=o.length();o.normalize();var h=new t.Vector3(-a.planeNormal[2],a.planeNormal[0],-a.planeNormal[1]),u=new t.Vector3;u.crossVectors(o,h),u.normalize();var f=new t.Vector3;f.crossVectors(o,u),f.normalize(),u.multiplyScalar(p),f.multiplyScalar(p);var d=e._buildCurvedPipeDataFromTorus(new t.Vector3(a.center[0],a.center[1],a.center[2]),u,f,2*Math.PI,xn(),a.minorRadius),c=!An("Torus");if(n){var l=s.getDisplayedColor(),v=new t.Color;return v.setRGB(l[0]/255,l[1]/255,l[2]/255),{gas:{color:v,opacity:l[3]/255},matId:i,curveVertices:d.centers,startNormal:d.startNormal,endNormal:d.endNormal,startSideVector:[u.x,u.y,u.z],radius:a.minorRadius}}if(c)return{gas:s,matId:i,canonicalType:ye,vectors:[a.center[0],a.center[1],a.center[2],a.planeNormal[0],a.planeNormal[1],a.planeNormal[2]],floats:[a.minorRadius]};for(var m=[],y=[],g=0,x=0;x<d.centers.length/3;x++)y.push(a.minorRadius),m.push(new t.Vector3(d.centers[g++],d.centers[g++],d.centers[g++]));var B=new t.Vector3(d.startNormal[0],d.startNormal[1],d.startNormal[2]);new t.Vector3(d.endNormal[0],d.endNormal[1],d.endNormal[2]);return e._createTorusMesh(new t.Vector3(a.center[0],a.center[1],a.center[2]),m,y,B,s,i,xn(),!0,r.decorations)};var Tn=function(){ei.call(this)};Tn.prototype=Object.create(ei.prototype),Tn.prototype.constructor=Tn,Tn.prototype.unstream=function(e){if(this.rep.unstream(e),this.infos={width:e.readCompressedInt(),height:e.readCompressedInt(),depth:e.readCompressedInt(),format:e.readCompressedUInt(),encoding:e.readCompressedUInt(),bufferSize:e.readCompressedUInt(),bufferData:null},this.infos.bufferSize>0){var t=new Uint8Array(this.infos.bufferSize);e.readBytes(this.infos.bufferSize,t),this.infos.bufferData=t}return this.addMesh(e)?this.rep:null},Tn.prototype.build=function(e){return{voxelRep:this.infos}};var Rn=function(e){this.fatherId=e.readUncompressedInt(!1);new Ae(e);var t=e.readUncompressedInt(!1);this.name=e.readUnicodeString(t/2),this.blocReader=new be(e,0),this.getId=function(){return this.blocReader.id}},Un=function(e,t){this.tocEntry=t;var r=e;this.name=t.name;var i=[],n=[];this.header=null,this.getChild=function(e){},this.getStreamerByName=function(e,i){for(var s=0;s<n.length;++s)if(n[s].name==e){var a=n[s];return i&&a.setCurrentPosition(0),a}return null!=(a=r.getStreamer(t,e))&&(null!=this.header&&(a.version=this.header.version,a.conversion=this.header.conversion),a.setContainer(this),n.push(a)),a},this.getStreamer=function(){return this.getStreamerByName(this.name)},this.getChildContainer=function(t){for(var r=0;r<i.length;++r)if(i[r].name==t)return i[r];var n=e.getChildContainer(this.tocEntry,t);return n&&i.push(n),n},this.unstreamHeaderCGR=function(e){if(!this.header){this.header=e?this.getStreamerByName(e):this.getStreamer();var t=this.header.readUnsignedChar();if(this.header.conversion=!t,this.header.version=this.header.readUncompressedInt(),this.header.version>210042715)return console.log("warning cgr version not supported "+this.header.version+">210042715"),{error:"warning cgr version not supported"};this.header.version>=1101310&&this.header.readUncompressedInt()}},this.unstreamHeaderUVR=function(e){this.header=e;var t=this.header.readUnsignedChar();if(this.header.conversion=!t,this.header.version=this.header.readUncompressedInt(),this.header.version>210042715)return console.log("warning ugr version not supported"),{error:"warning ugr version not supported"}},this.getResourceCGRContainer=function(){var e=r.getRootContainer();return e?e.getChildContainer("Resources"):null},this.getResource=function(e){var t,r=null,i=e.readUnsignedChar(),n=e.readCompressedInt();if(e.textures.isValidMultiRefIndex(n))return t=e.textures.getIndex(n);var s=this.getStreamerByName("MainCGRResourceStreamer");s.setCurrentPosition(n),e.copyStreamerInheritance(s);var a=null;if(s.readUnsignedChar()){var o=s.readStringWithLength(),p=s.readStringWithLength();console.log(" providerName = "+o+"resourceUUID = "+p+"not loaded")}else if(i){r=(a=new He).unstream(s)}else{switch(s.readUnsignedChar()){case Ce:break;case we:a=new Xe}var h=s.readStringWithLength().split("\\"),u=h[h.length-1];null!=a&&(r=a.unstream(s,u))}return null!=r?(t=e.textures.add(r),e.textures.addMultiRefIndex(n,t),t):null},this.getImage=function(e,t,r){var i=null,n=this.getStreamerByName("MainCGRResourceStreamer");e.copyStreamerInheritance(n),n.setCurrentPosition(t);var s=n.readUnsignedChar();if(2==s)i=(new We).createTexture(n);else if(1==s){i=(new je).unstream(n)}else if(3==s||4==s||5==s||6==s){var a=0;i=null;5!=s&&6!=s||(a=n.readCompressedUInt());var o=n.readCompressedUInt();if(o>0)return i=new Uint8Array(o),n.readBytes(o,i),{img:i,imgType:s,format:a}}return i},this.getResourceShader=function(e){var t=0;e.readUnsignedChar()&&(t=e.readCompressedInt());var r=this.getStreamerByName("MainCGRResourceStreamer");if(r.conversion=e.conversion,r.setCurrentPosition(t),r.version=e.version,!r.readUnsignedChar()){var i=new et;i.unstream(r)}return i}},On=[],Gn=0,Nn=1,En=!1,Vn=!1,Dn=null,Ln=!1,_n=!1,kn=null,jn=function(e){this.multiPartReader=e,this.currentPositionInView=0,this.position=0,this.offsetsInStream=[],this.dataViews=[],this.currentView=null,this.currentBuffer=null,this.offsetInBuffer=0,this.currentViewIndex=0,this.intMaxOffset=0,this.shortMaxOffset=0,this.doubleMaxOffset=0};jn.prototype.addBloc=function(e){var t=this.multiPartReader.getDataViews(e.offset,e.length),r=this.dataViews.length;this.offsetsInStream.length&&this.offsetsInStream[this.offsetsInStream.length-1];this.dataViews=this.dataViews.concat(t);for(var i=r;i<this.dataViews.length;++i)0==i?this.offsetsInStream.push(0):this.offsetsInStream.push(this.offsetsInStream[i-1]+this.dataViews[i-1].dataView.byteLength);null===this.currentView&&(this.currentView=this.dataViews[0].dataView,this.currentBuffer=this.dataViews[0].buffer,this.offsetInBuffer=this.dataViews[0].offset,this.currentPositionInView=0,this.intMaxOffset=this.currentView.byteLength-4,this.shortMaxOffset=this.currentView.byteLength-2,this.doubleMaxOffset=this.currentView.byteLength-8)},jn.prototype.setFromBuffer=function(e){this.dataViews.push({dataView:new DataView(e.buffer,0,e.length),buffer:e,offset:0}),this.offsetsInStream.push(0),this.currentView=this.dataViews[0].dataView,this.currentBuffer=this.dataViews[0].buffer,this.offsetInBuffer=this.dataViews[0].offset,this.currentPositionInView=0,this.intMaxOffset=this.currentView.byteLength-4,this.shortMaxOffset=this.currentView.byteLength-2,this.doubleMaxOffset=this.currentView.byteLength-8},jn.prototype.getBytesRemain=function(){for(var e=this.currentView.byteLength-this.currentPositionInView,t=this.currentViewIndex+1;t<this.dataViews.length;t++){if(this.dataViews[t])e+=this.dataViews[t].dataView.byteLength}return e},jn.prototype.optimizedRead=function(e){return this.currentPositionInView<this.currentView.byteLength?this.currentBuffer[this.offsetInBuffer+this.currentPositionInView++]:(this.currentViewIndex++,this.currentView=this.dataViews[this.currentViewIndex].dataView,this.currentBuffer=this.dataViews[this.currentViewIndex].buffer,this.offsetInBuffer=this.dataViews[this.currentViewIndex].offset,this.currentPositionInView=0,this.intMaxOffset=this.currentView.byteLength-4,this.shortMaxOffset=this.currentView.byteLength-2,this.doubleMaxOffset=this.currentView.byteLength-8,this.currentBuffer[this.offsetInBuffer+this.currentPositionInView++])},jn.prototype.read=function(){return this.currentPositionInView<this.currentView.byteLength?this.currentBuffer[this.offsetInBuffer+this.currentPositionInView++]:(this.currentViewIndex++,this.currentView=this.dataViews[this.currentViewIndex].dataView,this.currentBuffer=this.dataViews[this.currentViewIndex].buffer,this.offsetInBuffer=this.dataViews[this.currentViewIndex].offset,this.currentPositionInView=0,this.intMaxOffset=this.currentView.byteLength-4,this.shortMaxOffset=this.currentView.byteLength-2,this.doubleMaxOffset=this.currentView.byteLength-8,this.currentBuffer[this.offsetInBuffer+this.currentPositionInView++])},jn.prototype.getCurrentPosition=function(){return this.offsetsInStream[this.currentViewIndex]+this.currentPositionInView},jn.prototype.setPosition=function(e){for(var t=0,r=0;e>t+this.dataViews[r].dataView.byteLength;)t+=this.dataViews[r].dataView.byteLength,r++;this.currentViewIndex=r,this.currentView=this.dataViews[this.currentViewIndex].dataView,this.currentBuffer=this.dataViews[this.currentViewIndex].buffer,this.offsetInBuffer=this.dataViews[this.currentViewIndex].offset,this.currentPositionInView=e-t,this.intMaxOffset=this.currentView.byteLength-4,this.shortMaxOffset=this.currentView.byteLength-2,this.doubleMaxOffset=this.currentView.byteLength-8};var zn=new Uint8Array(8),Wn=new Int32Array(zn.buffer),Hn=new Uint32Array(zn.buffer),Xn=new Int16Array(zn.buffer),Yn=new Uint16Array(zn.buffer),qn=new Float32Array(zn.buffer),Qn=new Float64Array(zn.buffer);jn.prototype.readDouble=function(e){return e?(zn[7]=this.read(),zn[6]=this.read(),zn[5]=this.read(),zn[4]=this.read(),zn[3]=this.read(),zn[2]=this.read(),zn[1]=this.read(),zn[0]=this.read()):(zn[0]=this.read(),zn[1]=this.read(),zn[2]=this.read(),zn[3]=this.read(),zn[4]=this.read(),zn[5]=this.read(),zn[6]=this.read(),zn[7]=this.read()),Qn[0]},jn.prototype.readFloatBorder=function(e){return e?(zn[3]=this.read(),zn[2]=this.read(),zn[1]=this.read(),zn[0]=this.read()):(zn[0]=this.read(),zn[1]=this.read(),zn[2]=this.read(),zn[3]=this.read()),qn[0]};var Jn=new Float32Array(1),Zn=new Uint8Array(Jn.buffer);jn.prototype.readFloat=function(e){if(this.currentPositionInView<this.intMaxOffset){var t=this.offsetInBuffer+this.currentPositionInView;return this.currentPositionInView+=4,e?(Zn[3]=this.currentBuffer[t],Zn[2]=this.currentBuffer[t+1],Zn[1]=this.currentBuffer[t+2],Zn[0]=this.currentBuffer[t+3]):(Zn[0]=this.currentBuffer[t],Zn[1]=this.currentBuffer[t+1],Zn[2]=this.currentBuffer[t+2],Zn[3]=this.currentBuffer[t+3]),Jn[0]}return this.readFloatBorder(e)},jn.prototype.readIntBorder=function(e){return e?(zn[3]=this.read(),zn[2]=this.read(),zn[1]=this.read(),zn[0]=this.read()):(zn[0]=this.read(),zn[1]=this.read(),zn[2]=this.read(),zn[3]=this.read()),Wn[0]},jn.prototype.readUIntBorder=function(e){return e?(zn[3]=this.read(),zn[2]=this.read(),zn[1]=this.read(),zn[0]=this.read()):(zn[0]=this.read(),zn[1]=this.read(),zn[2]=this.read(),zn[3]=this.read()),Hn[0]},jn.prototype.readInt=function(e){if(this.currentPositionInView<this.intMaxOffset){var t=this.offsetInBuffer+this.currentPositionInView;this.currentPositionInView+=4;var r=this.currentBuffer[t],i=this.currentBuffer[t+1],n=this.currentBuffer[t+2],s=this.currentBuffer[t+3];return e?(r<<24)+(i<<16)+(n<<8)+s:(s<<24)+(n<<16)+(i<<8)+r}return this.readIntBorder(e)},jn.prototype.readUncompressedULong=function(e){if(this.currentPositionInView<this.intMaxOffset){var t=this.currentView.getUint32(this.currentPositionInView,!e);return this.currentPositionInView+=4,t}return this.readUIntBorder(e)},jn.prototype.readUncompressedInt=function(e){if(this.currentPositionInView<this.intMaxOffset){var t=this.currentView.getUint32(this.currentPositionInView,!e);return this.currentPositionInView+=4,t}return this.readUIntBorder(e)},jn.prototype.readUnsignedShortBorder=function(e){return e?(zn[0]=this.read(),zn[1]=this.read()):(zn[1]=this.read(),zn[0]=this.read()),Yn[0]},jn.prototype.readShortBorder=function(e){return e?(zn[0]=this.read(),zn[1]=this.read()):(zn[1]=this.read(),zn[0]=this.read()),Xn[0]},jn.prototype.readUnsignedShort=function(e){if(this.currentPositionInView<this.shortMaxOffset){var t=this.offsetInBuffer+this.currentPositionInView;return this.currentPositionInView+=2,this.currentBuffer[t]<<8&65280|255&this.currentBuffer[t+1]}return this.readUnsignedShortBorder(e)},jn.prototype.readShort=function(e){if(this.currentPositionInView<this.shortMaxOffset){var t=this.offsetInBuffer+this.currentPositionInView;this.currentPositionInView+=2;var r=this.currentBuffer[t],i=this.currentBuffer[t+1];if(e){var n=(127&r)<<8|i;return n-=(128&r)<<8}n=(127&i)<<8|r;return n-=(128&i)<<8}return this.readShortBorder(e)},jn.prototype.readShortArrayBuffer=function(e,t,r){var i=2*e;if(this.currentPositionInView+2*e<this.currentView.byteLength){var n=new Uint8Array(t.buffer),s=this.offsetInBuffer+this.currentPositionInView;if(r)for(var a=0;a<e;++a)n[2*a+1]=this.currentBuffer[s+2*a],n[2*a]=this.currentBuffer[s+2*a+1];else for(a=0;a<i;++a)n[a]=this.currentBuffer[s+a];this.currentPositionInView+=i}else for(a=0;a<e;++a)t[a]=this.readShort(r)},jn.prototype.unpackc24=function(e,t,r){if(this.currentPositionInView+3*t<this.currentView.byteLength){for(var i=0;i<t;++i){var n=this.offsetInBuffer+this.currentPositionInView;r[i+e]=this.currentBuffer[n+3*i]<<16&16711680|this.currentBuffer[n+3*i+1]<<8&65280|255&this.currentBuffer[n+3*i+2]}this.currentPositionInView+=3*t}else for(i=0;i<t;++i)r[i+e]=this.read()<<16&16711680|this.read()<<8&65280|255&this.read()},jn.prototype.readShortArray=function(e,t,r,i){if(this.currentPositionInView+2*t<this.currentView.byteLength){if(this.conversion)for(var n=0;n<t;++n){var s=(127&(a=this.currentBuffer[2*n]))<<8|this.currentBuffer[2*n+1];r[e+n]=s-((128&a)<<8)}else for(n=0;n<t;++n){var a;s=(127&(a=this.currentBuffer[2*n]))<<8|this.currentBuffer[2*n+1];r[e+n]=s-((128&a)<<8)}this.currentPositionInView+=2*t}else for(n=0;n<t;++n)r[e+n]=this.readShort(i)},jn.prototype.readBytesArrayBuffer=function(e,t,r){if(this.currentPositionInView+t<this.currentView.byteLength){for(var i=this.offsetInBuffer+this.currentPositionInView,n=0;n<t;++n)r[e+n]=this.currentBuffer[i+n];this.currentPositionInView+=t}else for(n=0;n<t;++n)r[e+n]=this.read()},jn.prototype.readBytes=function(e,t,r){if(this.currentPositionInView+t<this.currentView.byteLength){for(var i=this.offsetInBuffer+this.currentPositionInView,n=0;n<t;++n)r[e+n]=this.currentBuffer[i+n];this.currentPositionInView+=t}else for(n=0;n<t;++n)r[e+n]=this.read()},jn.prototype.getByteView=function(e,t){if(this.currentPositionInView+e<this.currentView.byteLength){var r=new Uint8Array(this.currentBuffer.buffer,this.offsetInBuffer+this.currentPositionInView,e);return this.currentPositionInView+=e,r}for(var i=0;i<e;++i)t[i]=this.read();return t},jn.prototype.readUnsignedShortArray=function(e,t,r,i){if(this.currentPositionInView+2*t<this.currentView.byteLength){var n=this.offsetInBuffer+this.currentPositionInView;if(i)for(s=0;s<t;++s)zn[0]=this.currentBuffer[n+2*s],zn[1]=this.currentBuffer[n+2*s+1],r[e+s]=Yn[0];else for(var s=0;s<t;++s)zn[1]=this.currentBuffer[n+2*s],zn[0]=this.currentBuffer[n+2*s+1],r[e+s]=Yn[0];this.currentPositionInView+=2*t}else for(s=0;s<t;++s)r[e+s]=this.readUnsignedShort(i)},jn.prototype.readUnsignedShortArrayBuffer=function(e,t,r){if(this.currentPositionInView+2*e<this.currentView.byteLength){var i=new Uint8Array(t.buffer),n=2*e,s=this.offsetInBuffer+this.currentPositionInView;if(r){for(var a=0;a<e;++a)i[2*a+1]=this.currentBuffer[s+2*a],i[2*a]=this.currentBuffer[s+2*a+1];this.currentPositionInView+=4*e}else{for(a=0;a<n;++a)i[a]=this.currentBuffer[s+a];this.currentPositionInView+=n}}else for(a=0;a<e;++a)t[a]=this.readUnsignedShort(r)},jn.prototype.readFloatArrayBuffer=function(e,t,r){if(this.currentPositionInView+4*e<this.currentView.byteLength){var i=new Uint8Array(t.buffer),n=4*e,s=this.offsetInBuffer+this.currentPositionInView;if(r){for(var a=0;a<e;++a)i[4*a+3]=this.currentBuffer[s+4*a],i[4*a+2]=this.currentBuffer[s+4*a+1],i[4*a+1]=this.currentBuffer[s+4*a+2],i[4*a]=this.currentBuffer[s+4*a+3];this.currentPositionInView+=4*e}else{for(a=0;a<n;++a)i[a]=this.currentBuffer[s+a];this.currentPositionInView+=n}}else for(a=0;a<e;++a)t[a]=this.readFloat(r)},jn.prototype.readFloatArray=function(e,t,r,i){if(this.currentPositionInView+4*t<this.currentView.byteLength)for(var n=this.currentPositionInView+4*t,s=e;this.currentPositionInView<n;)r[s++]=this.readFloat(i);else for(var a=0;a<t;++a)r[e+a]=this.readFloat(i)};var Kn=function(){var e=[],t=[];this.getCurrentIndex=function(){return e.length},this.remove=function(t){e.splice(t,1)},this.add=function(t){var r=e.length;return e[r]=t,r},this.addAt=function(t,r){e[r]=t},this.isValidIndex=function(t){return t<e.length},this.get=function(t){return e[t]},this.getArray=function(){return e},this.isValidMultiRefIndex=function(e){return void 0!==t[e]},this.isValidMultiRefIndexWithName=function(e,r){if(void 0!==t[e]){for(var i=0;i<t[e].length;i++)if(t[e][i].streamerName===r)return!0;return!1}return!1},this.addMultiRefIndex=function(e,r){t[e]=r},this.addMultiRefIndexWithName=function(e,r,i){void 0!==t[e]?t[e].push({index:r,streamerName:i}):t[e]=[{index:r,streamerName:i}]},this.getIndex=function(e){return t[e]},this.getIndexWithName=function(e,r){for(var i=t[e],n=0;n<i.length;n++)if(i[n].streamerName===r)return i[n].index;return null}};return function(i,v,m,y,g,x,B,A,I,b,C,w,S,P,M,F,T){Gn=b&&b.sag2D?b.sag2D:0,b&&b.sag3D?b.sag3D:0;this.isV5=!0,this.FTA=!1,!i||i instanceof byteArrayReader?(u=P,this.expand=v,Ln=g,this.withSceneGraph=y,y,d=B,o=A,p=I,En=!!T,h=F,this.uint32Index=x,c=C,f=M):(this.expand=i.expand,this.withSceneGraph=i.withSG,this.withSceneGraph,d=i.computeSSB,o=i.sag,p=i.processText,En=i.mode2D,h=i.sceneGraphOrderMode,this.uint32Index=i.i32Idx,Ln=i.udlMode,c=i.bagUUID,u=i.withBlanking,f=i.useDefaultTCSet),r=S,s=m,a=w;var R=null,U=i,O=null,G=null,N=null;this.setFileBuffer=function(e){U=new byteArrayReader(e),{file:"",id:-1},null,On=[],Nn=1,this.isV5=!0,R=null,O=null,G=null,N=null};this.addChild=function(e){var t=e.node;if(e.children)for(var r=e.children.length,i=0;i<r;i++){var n=e.children[i].node;t.children.push(n),n.type&&(n.parent=t,this.addChild(e.children[i]))}};var E=function(e,t,r){this.cgmId=e||0,this.matrix=t||null,this.boundingSphere=r||null};this.addChildExpand=function(e){var t=new E(e.node.cgmId,e.node.matrix,e.node.boundingSphere);if(void 0!==e.node.rep?t.rep=e.node.rep:t.children=[],e.children)for(var r=e.children.length,i=0;i<r;i++){var n=this.addChildExpand(e.children[i]);t.children.push(n)}return t},this.compressedChildren=function(e,t){var r,i,n,s,a,o,p=e.node;if(t.offset>t.size&&(t.size*=2,r=new ArrayBuffer(t.size),t.result.push(r),t.view32F=new Float32Array(r),t.view32UInt=new Uint32Array(r),t.view8UInt=new Uint8Array(r)),t.view32UInt[t.offset++]=p.cgmId,t.view8UInt[4*t.offset]=p.type,t.view8UInt[4*t.offset+1]=p.solid,t.offset++,e.children){var h,u=e.children.length;for(t.view32UInt[t.offset++]=u,i=0;i<u;i++)h=e.children[i].node,p.children.push(h),h.parent=p,this.compressedChildren(e.children[i],t)}if(p.primitives)for(u=p.primitives.length,t.view32UInt[t.offset++]=u,i=0;i<u;i++){if(a=!!(n=p.primitives[i]).boundingSphere,o=!!n.decoration&&n.decoration[0],t.view32UInt[t.offset++]=n.cgmId,t.view8UInt[4*t.offset]=n.type,t.view8UInt[4*t.offset+1]=a,t.view8UInt[4*t.offset+2]=o,t.offset++,t.view32UInt[t.offset++]=n.count,t.view32UInt[t.offset++]=n.start,n.group.primitives instanceof Array?(s=t.idGroup++,n.group.primitives=s):s=n.group.primitives,t.view32UInt[t.offset++]=s,o){var f,d=n.decoration.length,c=4*t.offset;for(f=0;f<d;f++)t.view8UInt[c+f]=n.decoration[f];t.offset+=1+(d/4>>0)}a&&(t.view32F[t.offset++]=n.boundingSphere.center[0],t.view32F[t.offset++]=n.boundingSphere.center[1],t.view32F[t.offset++]=n.boundingSphere.center[2],t.view32F[t.offset++]=n.boundingSphere.radius)}},this.applyGlobalMatrix=function(r,i,n,s){for(var a=0;a<r.length;a++){r[a].rep=this.getCompressedRep(r[a].rep,s);var o=r[a].globalMatrix;if(o&&!o.isIdentity()){var p=new t.Matrix4;if(p.extractRotation(o),e.applyMat(r[a],o,i,p),p.isIdentity()){var h=new t.Vector3(r[a].AABB.min[0],r[a].AABB.min[1],r[a].AABB.min[2]).applyMatrix4(o),u=new t.Vector3(r[a].AABB.max[0],r[a].AABB.max[1],r[a].AABB.max[2]).applyMatrix4(o);r[a].AABB.min[0]=h.x,r[a].AABB.min[1]=h.y,r[a].AABB.min[2]=h.z,r[a].AABB.max[0]=u.x,r[a].AABB.max[1]=u.y,r[a].AABB.max[2]=u.z}else e.computeBB(r[a])}}},this.getCompressedRep=function(e,t){if(e.node.type){var r=t.tab,i=t.nbRep++;return r.push(e.node.cgmId+1),r.push(e.node.solid),r.push(e.node.namingContext),o&&r.push(e.node.sag),a&&(r.push(e.boundingSphere.radius),r.push(e.boundingSphere.center[0]),r.push(e.boundingSphere.center[1]),r.push(e.boundingSphere.center[2])),Ln?(r.push(e.type),r.push(e.indice)):e.node=i,i}return e.node},this.applyGlobalMatrixStatic=function(r,i,n,s){for(var a=0;a<r.length;a++){r[a].rep=this.getCompressedRep(r[a].rep,s);var o=r[a].globalMatrix;if(o&&!o.isIdentity()){var p=new t.Matrix4;if(p.extractRotation(o),e.applyMat(r[a],o,i,p),p.isIdentity()){var h=new t.Vector3(r[a].AABB.min[0],r[a].AABB.min[1],r[a].AABB.min[2]).applyMatrix4(o),u=new t.Vector3(r[a].AABB.max[0],r[a].AABB.max[1],r[a].AABB.max[2]).applyMatrix4(o);r[a].AABB.min[0]=h.x,r[a].AABB.min[1]=h.y,r[a].AABB.min[2]=h.z,r[a].AABB.max[0]=u.x,r[a].AABB.max[1]=u.y,r[a].AABB.max[2]=u.z}else e.computeBB(r[a])}}},this.applyGlobalInfiniteGeomMatrix=function(e,r,i){for(var n=null,s=new t.Matrix4,a=new t.Vector3,o=new t.Vector3,p=new t.Vector3,h=new t.Vector3,u=new t.Vector3,f=null,d=0;d<e.length;d++){var c=e[d];c.rep=this.getCompressedRep(c.rep,i);var l=!!(f=c.globalMatrix)&&!f.isIdentity();switch(c.type){case t._InfiniteGeomertryType.AXIS_SYSTEM:(n=c.axis).rep=c.rep,f=c.globalMatrix,l&&(a.set(n.origin[0],n.origin[1],n.origin[2]),o.set(n.xAxis[0],n.xAxis[1],n.xAxis[2]),p.set(n.yAxis[0],n.yAxis[1],n.yAxis[2]),h.set(n.zAxis[0],n.zAxis[1],n.zAxis[2]),s.makeBasis(o,p,h),s.setPosition(a),s.multiply(f),n.origin=[s.elements[12],s.elements[13],s.elements[14]],n.xAxis=[s.elements[0],s.elements[1],s.elements[2]],n.yAxis=[s.elements[4],s.elements[5],s.elements[6]],n.zAxis=[s.elements[8],s.elements[9],s.elements[10]]),e[d]={params:n,type:t._InfiniteGeomertryType.AXIS_SYSTEM};break;case t._InfiniteGeomertryType.REF_PLANE:for(var v=[],m=c.refPlanes,y=0;y<m.length;y++){var g=m[y];g.rep=c.rep,l&&(a.set(g.origin[0],g.origin[1],g.origin[2]),o.set(g.xAxis[0],g.xAxis[1],g.xAxis[2]),p.set(g.yAxis[0],g.yAxis[1],g.yAxis[2]),h.crossVectors(o,p),s.makeBasis(o,p,h),s.setPosition(a),s.multiply(f),g.origin=[s.elements[12],s.elements[13],s.elements[14]],g.xAxis=[s.elements[0],s.elements[1],s.elements[2]],g.yAxis=[s.elements[4],s.elements[5],s.elements[6]]),v.push(g)}e[d]={params:v,type:t._InfiniteGeomertryType.REF_PLANE};break;case t._InfiniteGeomertryType.ARROWS:var x=c.arrows,B=[];for(y=0;y<x.length;y++){var A=x[y];A.rep=c.rep,l&&(a.set(A.origin[0],A.origin[1],A.origin[2]),u.set(A.direction[0],A.direction[1],A.direction[2]),a.applyMatrix4(f),u.applyRotation(f),A.origin=[a.x,a.y,a.z],A.direction=[u.x,u.y,u.z]),B.push(A)}e[d]={params:B,type:t._InfiniteGeomertryType.ARROWS};break;case t._InfiniteGeomertryType.VOXEL_REP:e[d]={params:{voxelRep:c.voxelRep},type:t._InfiniteGeomertryType.VOXEL_REP}}}},this.applyGlobalMatrixAxis=function(e,r){for(var i=null,n=new t.Matrix4,s=new t.Vector3,a=new t.Vector3,o=new t.Vector3,p=new t.Vector3,h=0;h<e.length;h++){i=e[h].axis;var u=e[h].globalMatrix;!!u&&!u.isIdentity()&&(s.set(i.origin[0],i.origin[1],i.origin[2]),a.set(i.xAxis[0],i.xAxis[1],i.xAxis[2]),o.set(i.yAxis[0],i.yAxis[1],i.yAxis[2]),p.set(i.zAxis[0],i.zAxis[1],i.zAxis[2]),n.makeBasis(a,o,p),n.setPosition(s),n.multiply(u),i.origin=[n.elements[12],n.elements[13],n.elements[14]],i.xAxis=[n.elements[0],n.elements[1],n.elements[2]],i.yAxis=[n.elements[4],n.elements[5],n.elements[6]],i.zAxis=[n.elements[8],n.elements[9],n.elements[10]]),e[h]=i}},this.applyGlobalMatrixArrows=function(e,r){new t.Matrix4;for(var i=new t.Vector3,n=new t.Vector3,s=0;s<e.length;s++){for(var a=[],o=e[s].arrows,p=0;p<o.length;p++){var h=o[p],u=e[s].globalMatrix;!!u&&!u.isIdentity()&&(i.set(h.origin[0],h.origin[1],h.origin[2]),n.set(h.direction[0],h.direction[1],h.direction[2]),i.applyMatrix4(u),n.applyRotation(u),h.origin=[i.x,i.y,i.z],h.direction=[n.x,n.y,n.z]),a.push(h)}e[s]=a}},this.applyGlobalMatrixRefPlanes=function(e,r){for(var i=new t.Matrix4,n=new t.Vector3,s=new t.Vector3,a=new t.Vector3,o=new t.Vector3,p=0;p<e.length;p++){for(var h=[],u=e[p].refPlanes,f=0;f<u.length;f++){var d=u[f],c=e[p].globalMatrix;!!c&&!c.isIdentity()&&(n.set(d.origin[0],d.origin[1],d.origin[2]),s.set(d.xAxis[0],d.xAxis[1],d.xAxis[2]),a.set(d.yAxis[0],d.yAxis[1],d.yAxis[2]),o.crossVectors(s,a),i.makeBasis(s,a,o),i.setPosition(n),i.multiply(c),d.origin=[i.elements[12],i.elements[13],i.elements[14]],d.xAxis=[i.elements[0],i.elements[1],i.elements[2]],d.yAxis=[i.elements[4],i.elements[5],i.elements[6]]),h.push(d)}e[p]=h}},this.computePrimBS=function(e){if(s)for(var t=0;t<e.length;t++)for(var r=e[t],i=r.vertexPositionArray,n=r.vertexIndexArray,a=0;a<r.drawingGroups.length;a++){var o=r.drawingGroups[a];if(0!==o.glType)for(var p=0;p<o._primitives.length;p++){var h=o._primitives[p];if(!h.boundingSphere){for(var u=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],f=[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE],d=h.start;d<h.start+h.count;d++){var c=n[d];i[3*c]<u[0]&&(u[0]=i[3*c]),i[3*c+1]<u[1]&&(u[1]=i[3*c+1]),i[3*c+2]<u[2]&&(u[2]=i[3*c+2]),i[3*c]>f[0]&&(f[0]=i[3*c]),i[3*c+1]>f[1]&&(f[1]=i[3*c+1]),i[3*c+2]>f[2]&&(f[2]=i[3*c+2])}var l=(u[0]-f[0])*(u[0]-f[0]);l+=(u[1]-f[1])*(u[1]-f[1]),l+=(u[2]-f[2])*(u[2]-f[2]),l=.5*Math.sqrt(l);var v={center:[.5*(u[0]+f[0]),.5*(u[1]+f[1]),.5*(u[2]+f[2])],radius:l};h.boundingSphere=v}}}},this.processAllReps=function(e,r,i,n,s){var p=[],u=e.length,f=new t.Vector3,c=3;a&&(c+=4),o&&(c+=1);for(var l=0;l<u;l++){var v=[],m=e[l].getArray();if(1&l||8&l)this.computePrimBS(m),this.applyGlobalMatrixStatic(m,r,s,n),this.batch_static(m,v,r);else{this.computePrimBS(m),this.applyGlobalMatrix(m,r,s,n);for(var y=0;y<m.length;y++){var g=m[y],x=g.AABB.min,B=g.AABB.max;f.x=B[0]-x[0],f.y=B[1]-x[1],f.z=B[2]-x[2],a&&(n.tab[c*g.rep+c-4]=.5*f.length(),n.tab[c*g.rep+c-3]=.5*x[0]+.5*B[0],n.tab[c*g.rep+c-2]=.5*x[1]+.5*B[1],n.tab[c*g.rep+c-1]=.5*x[2]+.5*B[2]),d&&(m[y]._radius=.5*f.length())}0==l&&1==h?this.batch(m,v,r,i):this.batch(m,v,r)}p.push(v)}return p},this.batch=function(t,r,i,n){var a=function(e,t){e.min[0]>t.min[0]&&(e.min[0]=t.min[0]),e.min[1]>t.min[1]&&(e.min[1]=t.min[1]),e.min[2]>t.min[2]&&(e.min[2]=t.min[2]),e.max[0]<t.max[0]&&(e.max[0]=t.max[0]),e.max[1]<t.max[1]&&(e.max[1]=t.max[1]),e.max[2]<t.max[2]&&(e.max[2]=t.max[2])},p={withSceneGraphOrder:1==h,containNoShow:!1,withSAG:o,withBoundingElement:s},u=[],f=null,c=0,l=65535;this.uint32Index&&(l=524287),p.withSceneGraphOrder&&(l=4294967295);for(var v=0;v<t.length;v++)if(t[v].vertexPositionArray&&(this.FTA||!t[v].noShow)){if(f?a(f,t[v].AABB):f=t[v].AABB,c+t[v].vertexPositionArray.length/3>=l){if(0==c){for(var m=e.divideRep(t[v],!0,p),y=0;y<m.length;y++)r.push(m[y]);f=null;continue}(g=e.processRepsCGR(u,!0,d,p,i,n)).AABB={min:f.min,max:f.max},f=null,r.push(g),c=0,u=[]}if(t[v].vertexPositionArray.length/3>=l){for(m=e.divideRep(t[v],!0,p),y=0;y<m.length;y++)r.push(m[y]);f=null}else u.push(t[v]),c+=t[v].vertexPositionArray.length/3}for(v=0;v<t.length;v++)if(t[v].vertexPositionArray&&!this.FTA&&t[v].noShow&&this.withSceneGraph){if(p.containNoShow=!0,c+t[v].vertexPositionArray.length/3>=l){if(0==c){for(m=e.divideRep(t[v],!0,p,n),y=0;y<m.length;y++)r.push(m[y]);f=null;continue}var g;f||(f={min:[0,0,0],max:[0,0,0]}),(g=e.processRepsCGR(u,!0,d,p,i,n)).AABB={min:f.min,max:f.max},f=null,r.push(g),c=0,u=[]}if(t[v].vertexPositionArray.length/3>=l){for(m=e.divideRep(t[v],!0,p),y=0;y<m.length;y++)r.push(m[y]);f=null}else u.push(t[v]),c+=t[v].vertexPositionArray.length/3}u.length>0&&(f||(f={min:[0,0,0],max:[0,0,0]}),(g=e.processRepsCGR(u,!0,d,p,i,n)).AABB={min:f.min,max:f.max},g.AABB.min[0]==g.AABB.max[0]&&g.AABB.min[1]==g.AABB.max[1]&&g.AABB.min[2]==g.AABB.max[2]&&(g.AABB.min[0]-=.1,g.AABB.min[1]-=.1,g.AABB.max[0]+=.1,g.AABB.max[1]+=.1),r.push(g))},this.batch_static=function(t,r,i){for(var n=function(e,t){if(!e||!t)return!e&&!t;for(var r=0;r<16;r++)if(e.elements[r]!=t.elements[r])return!1;return!0},a=[],p=0;p<t.length;p++){for(var h=!1,u=t[p],f=0;f<a.length;f++)if(n(u.attachedPoint,a[f].attachedPoint)){a[f].reps.push(u),h=!0;break}if(!h){var d=[u];a.push({attachedPoint:u.attachedPoint,reps:d})}}for(p=0;p<a.length;p++){var c=e.processRepsCGR(a[p].reps,!1,!1,{containNoShow:!1,withSAG:o,withBoundingElement:s},i),l=[];c.AABB.min[0]==c.AABB.max[0]&&c.AABB.min[1]==c.AABB.max[1]&&c.AABB.min[2]==c.AABB.max[2]&&(c.AABB.min[0]-=.1,c.AABB.min[1]-=.1,c.AABB.max[0]+=.1,c.AABB.max[1]+=.1),l.push(c),r.push({tab:l,globalMatrix:a[p].attachedPoint})}},this.addChildHybrid=function(e){var t=e.node;if(e.children){e.externalPath&&(t.externalPath=!0);for(var r=e.children.length,i=0;i<r;i++){var n=e.children[i].node;t.children.push(n),n.added||(n.added=!0,n.type&&(n.parent=t,this.addChildHybrid(e.children[i])))}}},this.buildSceneGraph=function(t){var r=[],i=(t.axisSystems,t.refPlanes,t.arrows,t.texts);if(!this.expand){this.applyGlobalInfiniteGeomMatrix(t.infiniteGeometries,Ln,t.sgRep);var n=this.processAllReps(t.reps,t.materials,t.dgs,t.sgRep),s=null,a=null,o=[n];return Ln?(a={indice:t.batches.add(n)},t.rep&&(this.addChildHybrid(t.rep),s=t.rep.node),o=t.batches.getArray()):this.withSceneGraph&&t.rep&&(this.addChild(t.rep),s=t.rep.node),this.withSceneGraph&&t.rep,{reps:o,sceneGraph:s,resource:t.resource,material:t.materials,sgRep:t.sgRep.tab,rootBatch:a,decorations:t.decorations,advancedInheritance:t.advancedInheritance,curvedPipes:t.curvedPipes,infiniteGeometries:t.infiniteGeometries,sag:t.sag,texts:i}}var p=R.reps[Q].getArray(),h=[],u=[];s=null,rep&&(s=this.addChildExpand(rep));for(var f=0;f<p.length;f++)if(p[f].vertexPositionArray)if(p[f].vertexPositionArray.length/3>=65535){for(var d=e.divideRep(p[f],!0),c=(r=[],0);c<d.length;c++)r.push(d[c]);u.push(r)}else{r=[],h.push(p[f]);var l=e.processRepsCGR(h);r.push(l),u.push(r),h=[]}return p=[],R.all_reps=[],{mesh:u,resource:R.textures.getArray(),material:R.materials.getArray(),rep:s}},this.init=function(){var e=(R=new Be(U.clone())).readString(6),t=R.readString(2);if(O=t[0],"V5_CFV"!=e)return this.isV5=!1,{mesh:[],resource:[],material:[],excludeReps:[]};Nn=3==O?0:1,R.conversion=!0;var r=R.readUncompressedInt(!0),i=R.readUncompressedInt(!0);if(R.skip(8),R.skip(32),R.readUncompressedInt(!0),R.skip(4),Nn&&!R.setCurrentPosition(r))return{error:"file corrupted"};t=R.readString(16),R.readUnsignedChar(),R.readUnsignedShort(!0),R.readUnsignedShort(!0),R.readUnsignedShort(!0);var n=R.readUnsignedShort(!0);if(R.readUnsignedShort(!0),R.readUncompressedInt(!0),R.skip(33),Nn)G=new be(R,n);else{var s=new Uint8Array(384+i);R.readBytes(384,s);var a=new Uint8Array(i);R.setCurrentPosition(r),R.readBytes(i,a),s.set(a,384);var o=new Be(new byteArrayReader(s));o.conversion=!0,G=new be(o,n)}return R.conversion=!1,!0},this.getApplicativeContainer=function(e,t){var r,i=0,n=0,s={},a=!1;if(t)if((r=this.getRootContainer()).unstreamHeaderCGR(),r.header.version>=210042400&&(a=!0),Nn)a?(i=r.header.version,n=r.header.conversion):(i=(o=r.getChildContainer("SceneGraph")).header.version,n=o.header.conversion);else{if(!(d=r.getChildContainer("MAIN")).header&&(c=this.getEntryStreamer(d.tocEntry),d.unstreamHeaderUVR(c)))return null;i=d.header.version,n=d.header.conversion}else if(this.init(),(new Date).getTime(),(r=this.getRootContainer()).unstreamHeaderCGR(),r.header.version>=210042400&&(a=!0),Nn){var o;a?(i=r.header.version,n=r.header.conversion):((o=r.getChildContainer("SceneGraph")).unstreamHeaderCGR(),i=o.header.version,n=o.header.conversion)}else{for(var p=this.getEntryStreamer(r.tocEntry),h=(p.readUncompressedInt(!1),p.readUncompressedInt(!1),p.readUncompressedInt(!1)),u=0;u<h;u++){p.readUncompressedInt(!1),p.readUncompressedInt(!1),p.readUnsignedShort(!1);var f=p.readUncompressedInt(!1);this.name=p.readUnicodeString(f/2)}var d=r.getChildContainer("MAIN"),c=this.getEntryStreamer(d.tocEntry);d.unstreamHeaderUVR(c),i=d.header.version,n=d.header.conversion}var l=r.getChildContainer("Applicative Containers");if(!l)return null;var v=l.getChildContainer(e);if(!v)return null;var m=v.getChildContainer("MainDataStream");if(!m)return null;var y=this.getBufferFromEntry(m.tocEntry);if(0==y.length)return null;switch(e){case"V4V5_FDT":var g=this.getEntryStreamer(m.tocEntry);Nn||(g.bitBoolean=1,g.bitPacking=1,g.gasPacking=1),g.expandCGR=this.expand,g.version=i,g.conversion=n;var x=g.readCompressedInt(),B=g.readCompressedInt();s.oldSize=x,s.compressed=B,s.offset=g.getCurrentPosition(),g.skip(B),g.getBytesRemain()&&(g.readCompressedInt(),s.oldSize=g.readCompressedInt(),s.compressed=g.readCompressedInt(),s.offset=g.getCurrentPosition())}return(new Date).getTime(),{buffer:y,options:s}},this.open=function(e){kn=this;var t=this.init();if(t&&t.error)return t;if(e&&(Nn=0),!this.isV5)//!oldCGR) {
return console.log("warning cgr version not supported or corrupted file"),{error:"cgr version not supported or corrupted file"};l=!1,(new Date).getTime();var i=this.getRootContainer();if(i.unstreamHeaderCGR(),H=0,Y=0,q=0,X=!1,ct={x:0,y:0,z:0},lt={x:0,y:0,z:0},n=!!r,Vn=!1,i.header.version>=210042400){Vn=!0,i.header.readUncompressedInt(),i.header.readUncompressedInt();var s=i.header.readUncompressedInt();if(i.header.skip(s),i.header.version>=210042410){if(i.header.readBoolean())switch(i.header.readUnsignedChar()){case D:break;case L:var a=i.header.readUnsignedChar();a&_&&(H=_),a&k&&(H=k),i.header.version>=210042415&&(a&j&&(Y=j),a&z&&(q=z),a&W&&(q=W)),n=!0===r,!1===r&&(n=!1)}Dn=(new pt).unstream(i.header)}}var o=i.getChildContainer("Skeleton"),p=null,u=null;if(!Nn&&o){var f=this.getEntryStreamer(i.tocEntry);f.conversion=!0,f.readUncompressedInt(!1),f.readUncompressedInt(!1);for(var d=f.readUncompressedInt(!1),c=0;c<d;c++){f.readUncompressedInt(!1),f.readUncompressedInt(!1),f.readUnsignedShort(!1);var v=f.readUncompressedInt(!1);this.name=f.readUnicodeString(v/2)}f.conversion=!1;var m=i.getChildContainer("MAIN"),y=this.getEntryStreamer(m.tocEntry);if(A=m.unstreamHeaderUVR(y))return A;var g=i.getChildContainer("Options"),x=this.getEntryStreamer(g.tocEntry);if(x.setContainer(i),x.readUnsignedChar()>=5&&x.readUnsignedChar(),!o)return null;(u=this.getEntryStreamer(o.tocEntry)).setContainer(i),u.version=m.header.version,u.conversion=m.header.conversion,u.bitBoolean=1,u.bitPacking=1,u.gasPacking=1,u.expandCGR=this.expand;var B=u.readClassName();p=u.getUnstreamer(B).unstream(u)}else{var A,I=i,b="SceneGraph";if(Vn||(I=i.getChildContainer("SceneGraph"),b="MainDataStream"),!I)return{error:"scene graph container missing "};if(A=I.unstreamHeaderCGR("SceneGraph"))return A;(u=I.getStreamerByName(b,Vn)).expandCGR=this.expand,B=u.readClassName(),p=u.getUnstreamer(B).unstream(u)}return u.check(),1==h&&u.finalizeMergeDGs(),this.buildSceneGraph({curvedPipes:u.curvedPipes.getArray(),infiniteGeometries:u.infiniteGeometries.getArray(),advancedInheritance:u.advancedInheritance.getArray(),texts:u.texts.getArray(),resource:u.textures.getArray(),materials:u.materials.getArray(),sgRep:u.sgReps,decorations:u.decorations.getConcatenatedBlocks(),reps:u.popReps(),batches:u.batches,rep:p,dgs:u.mergeDGs,sag:Dn?Dn.sag3D:0})},this.openSceneGraph=function(e,t,r){this.FTA=!0,l=!0,r&&(p=r.processText,u=r.withBlankingRep);var i=new jn;i.setFromBuffer(e);var n=new Be(i);n.version=1101410,n.readBytes(12,[]);var s=n.readUnsignedChar();n.conversion=!s,n.version=n.readCompressedInt();var a=n.readClassName(),o=n.getUnstreamer(a).unstream(n);if(n.error&&t)return t(n.error),{reps:[],sceneGraph:null,resource:[],material:[],infiniteGeometries:[],texts:[]};n.check();var h=this.buildSceneGraph({curvedPipes:n.curvedPipes.getArray(),infiniteGeometries:n.infiniteGeometries.getArray(),advancedInheritance:n.advancedInheritance.getArray(),texts:n.texts.getArray(),resource:n.textures.getArray(),materials:n.materials.getArray(),sgRep:n.sgReps,decorations:n.decorations.getConcatenatedBlocks(),reps:n.popReps(),batches:n.batches,rep:o});return o.node.noShow&&this.withSceneGraph&&(h.sceneGraph.noShow=!0),this.withSceneGraph?h:{mesh:h.reps[0],resource:h.resource,material:h.material,curvedPipes:h.curvedPipes,infiniteGeometries:h.infiniteGeometries,texts:h.texts,excludeReps:h.reps[2]}},this.setThicknessTable=function(t){e.ThicknessTable=t},this.getBufferFromEntry=function(e){for(var t=0,r=e.blocReader.blocs,i=0;i<r.length;++i)t+=r[i].length;var n=new Uint8Array(t),s=0;for(i=0;i<r.length;++i)for(var a=r[i],o=0;o<a.length;++o)n[s]=U.buffer[a.offset+o],s++;return n},this.getRootContainer=function(){return N||((N=new Un(this,G.getRootTocEntry())).name="MAIN",N)},this.getStreamer=function(e,t){var r=G.getChildEntry(e,t);if(null==r)return null;for(var i=new jn(U.clone()),n=0;n<r.blocReader.blocs.length;++n)i.addBloc(r.blocReader.blocs[n]);var s=new Be(i);return s.name=t,s},this.getEntryStreamer=function(e){for(var t=new jn(U.clone()),r=0;r<e.blocReader.blocs.length;++r)t.addBloc(e.blocReader.blocs[r]);return new Be(t)},this.getChildContainer=function(e,t){var r=G.getChildEntry(e,t);if(r)return new Un(this,r)}}}),define("Formats/CGRFile",["DS/Formats/CGRFile","DS/DSMigration/DSMigration"],function(e,t){return t.deprecateModule("Formats/CGRFile"),e});