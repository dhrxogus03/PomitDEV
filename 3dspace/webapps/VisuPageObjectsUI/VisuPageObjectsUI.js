define("DS/VisuPageObjectsUI/VisuPageObjectsConsoleDlg",["UWA/Core","DS/WebappsUtils/WebappsUtils","DS/Controls/Button","DS/Windows/Dialog","DS/VisuTools/WebVisuPOUtils","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/VisuTools/WebVisuPOEngine","DS/Windows/Panel","DS/VisuEvents/EventsManager"],function(e,t,i,n,o,a,l,s,r,d,c,h){"use strict";var u=null,p=0,m=function(e){window.QAAutomationWebVisuConsoleDlg=this,u=this,this.options=e,this.dlg=null,this.visible=!0,this.play=!0,this.items=[],this.itemsJson=[],this.init(),o.registerConsoleDlg(this),this.addClientPropertiesCommand()};m.prototype.init=function(){this._webGLV6Viewer=d.getViewer(null),this._immersiveFrame=this.options.immersiveFrame,this._buildDialog()},m.prototype.toggleVisibility=function(){this.visible=!this.visible,this.visible?this.dlg.show():this.dlg.hide()},m.prototype._buildDialog=function(){o.dumpEvents(this._webGLV6Viewer);var e=this,t=UWA.createElement("div",{class:"wux-control-inline-container",style:{"vertical-align":"top"}});e.dlg=new n({title:"Viewer page objects console",content:t,immersiveFrame:e._immersiveFrame,resizableFlag:!0,width:640,height:480,allowedDockAreas:WUXDockAreaEnum.TopDockArea|WUXDockAreaEnum.BottomDockArea|WUXDockAreaEnum.LeftDockArea|WUXDockAreaEnum.RightDockArea}),e.dlg.getContent().id="RasterizerVisualQuality",this._setupDataGridViewConsole(t),e._displayItems(o.getConsoleItems()),e.options.cmd._windowOpen=!0,e.dlg.addEventListener("close",function(){o.consoleDlg=null,e.options.cmd._windowOpen=!1})};var g=0;return m.prototype._displayItems=function(e){var t;if(p+=e.length,this.dataGridViewConsole){var i;for(this.treeDocument.prepareUpdate(),t=0;t<e.length;t++)i=new l({label:"line"+g,grid:{Text:e[t].str}}),this.items.push(e[t].str),this.itemsJson.push(e[t].json),g++,this.treeDocument.addRoot(i);this.treeDocument.pushUpdate()}},m.prototype.dumpContent=function(){console.log(this.items.join("\n"))},m.prototype._setupDataGridViewConsole=function(e){this.treeDocument=new a;this.dataGridViewConsole=new s({treeDocument:this.treeDocument,columns:[{text:"Commands",dataIndex:"Text",sortableFlag:!1}],showRowHeaderBackgroundFlag:!1,layout:new r({columnsHeader:!1,rowsHeader:!1})});var t=this.dataGridViewConsole,i=0;t.onPostUpdateView(function(){var e=t.model;i!==e.length&&(e.length>0&&t.ensureNodeModelVisible(e[e.length-1]),i=e.length)});var n={entries:[{id:"copy",dataElements:{typeRepresentation:"function",label:"Copy",tooltip:navigator.clipboard?"Copy":"Clipboard unavailable: use CTRL-C",icon:"",category:"other",readOnly:!1,position:"near",disabled:!navigator.clipboard,action:{module:"DS/VisuPageObjectsUI/VisuPageObjectsConsoleDlg",func:"copy",argument:{isCheck:!1,mode:"all"}}},children:[]},{id:"level",dataElements:{typeRepresentation:"functionMenu",label:"XXXXXXXXX",category:"other",readOnly:!1},children:[{id:"highLevel",dataElements:{typeRepresentation:"PushItem",label:"Dump high level interactions (ex: mouseClick)",action:{module:"DS/VisuPageObjectsUI/VisuPageObjectsConsoleDlg",func:"setLevel",argument:{level:"high"}}}},{id:"lowLevel",dataElements:{typeRepresentation:"PushItem",label:"Dump low level interactions (ex: mousemove)",action:{module:"DS/VisuPageObjectsUI/VisuPageObjectsConsoleDlg",func:"setLevel",argument:{level:"low"}}}}]},{id:"clear",dataElements:{typeRepresentation:"function",label:"Clear",icon:"",category:"other",readOnly:!1,position:"near",action:{module:"DS/VisuPageObjectsUI/VisuPageObjectsConsoleDlg",func:"clear",argument:{isCheck:!1,mode:"all"}}},children:[]},{id:"play",dataElements:{typeRepresentation:"function",label:"Pause",icon:"",category:"other",readOnly:!1,position:"near",disabled:!1,action:{module:"DS/VisuPageObjectsUI/VisuPageObjectsConsoleDlg",func:"switchPlay",argument:{isCheck:!1,mode:"all"}}},children:[]},{id:"level",dataElements:{typeRepresentation:"functionMenu",label:"Screenshot",category:"other",readOnly:!1},children:[{id:"highLevel",dataElements:{typeRepresentation:"PushItem",label:"Content checker",action:{module:"DS/VisuPageObjectsUI/VisuPageObjectsConsoleDlg",func:"captureScreenshot",argument:{fullPixelChecker:!1}}}},{id:"lowLevel",dataElements:{typeRepresentation:"PushItem",label:"Full pixel checker (RESTRICTED ACCESS)",action:{module:"DS/VisuPageObjectsUI/VisuPageObjectsConsoleDlg",func:"captureScreenshot",argument:{fullPixelChecker:!0}}}}]},{id:"repPick",dataElements:{typeRepresentation:"function",label:"Rep pick",icon:"",category:"other",readOnly:!1,position:"near",disabled:!1,action:{module:"DS/VisuPageObjectsUI/VisuPageObjectsConsoleDlg",func:"repPick",argument:{}}},children:[]}]},o=document.createElement("div");o.style.width="500px",e.appendChild(o),o.className="divToolbar",this.dataGridViewConsole.getContent().style.top="50px";var l=this.dataGridViewConsole.setToolbar(JSON.stringify(n));l.dlg=this,this.toolbar=l,l.updateNodeModel("level",{label:"High"}),e.appendChild(this.dataGridViewConsole.getContent()),o.appendChild(l.getContent());var d=this.dataGridViewConsole.getCellsXSO();function c(){navigator.clipboard&&(d.get().length>0?l.updateNodeModel("copy",{disabled:!1}):l.updateNodeModel("copy",{disabled:!0}))}d.onPostAdd(c),d.onPostRemove(c);var h=this.dataGridViewConsole;h.addEventListener("dblclick",function(){m.copy({context:h})})},m.prototype._onScreenShot=function(e,t,i){var n=document.createElement("img");n.src=i;window.devicePixelRatio;n.width=e,n.height=t,this.screenshotPanel&&this.screenshotPanel.close(),this.screenshotPanel=new c({immersiveFrame:this._immersiveFrame,title:"Screenshot preview",content:n,height:t,width:e,resizableFlag:!0,identifier:"screenshotPanel",position:{my:"center",at:"center",of:this._immersiveFrame}}),this.screenshotPanel.width=e+10,this.screenshotPanel.height=t+20},m.prototype.clear=function(){o.clear(),this.dataGridViewConsole.treeDocument.removeRoots(),this.items=[],this.addClientPropertiesCommand()},m.prototype.addClientPropertiesCommand=function(){var e={devicePixelRatio:window.devicePixelRatio};this._displayItems([{str:"await viewer.applyClientProperties("+JSON.stringify(e)+");",json:{type:"applyClientProperties",data:e}}])},m.copy=function(e){var t,i=u.dataGridViewConsole.getCellsXSO().get(),n="";for(t=0;t<i.length;t++)n+=i[t].nodeModel.getAttributeValue("Text")+"\n";navigator.clipboard.writeText(n)},m.setLevel=function(e){var t=u.toolbar;"high"===e.level?(t.updateNodeModel("level",{label:"High"}),o.setLevel("high")):"low"===e.level&&(t.updateNodeModel("level",{label:"Low"}),o.setLevel("low"))},m.switchPlay=function(e){var t=u.toolbar,i=t.dlg;i.play=!i.play,i.play?t.updateNodeModel("play",{label:"Pause"}):t.updateNodeModel("play",{label:"Play"}),o.setPlay(i.play)},m._dbg_getCount=function(){return p},m.clear=function(e){window.QAAutomationWebVisuConsoleDlg.clear()},m.prototype._displayJSON=function(e){this.repPickJSONPanel&&this.repPickJSONPanel.close();var t=e.replace(/(?:\r\n|\r|\n)/g,"<br>");t=t.replace(/\s/g,"&nbsp;"),this.repPickJSONPanel=new c({immersiveFrame:this._immersiveFrame,title:"rep pick JSON preview",content:t,height:400,width:300,resizableFlag:!0,identifier:"repPickJSONPanel",position:{my:"center",at:"center",of:this._immersiveFrame}}),this.repPickJSONPanel.width=310,this.repPickJSONPanel.height=420},m.repPick=function(e){var t=u.toolbar.dlg,i=t._webGLV6Viewer;i.setPicking({primitive:2});var n=function(e){h.removeEvent(i.canvas,"onLeftClick",n),i.setPicking({primitive:!1});var a=e.from[0].getCurrentPosition();d.doRepPick({x:a.x,y:a.y},{_noCtx:!0},function(e){e&&(t._displayJSON(e),o._onRepPick(i,a.x,a.y))},null)};h.addEvent(i.canvas,"onLeftClick",n)},m.captureScreenshot=function(e){var t=u.toolbar.dlg,i=t._webGLV6Viewer,n=document.createElement("div");n.style.position="absolute",n.style.left="0px",n.style.top="0px",n.style.width=i.SCREEN_WIDTH+"px",n.style.height=i.SCREEN_HEIGHT+"px",n.style.backgroundColor="#ff0000",n.style.opacity=.2,i.canvas.parentNode.appendChild(n);var a={left:0,top:0};try{a=i.canvas.getBoundingClientRect()}catch(e){}!function(e,t,i,n,o){var a=document.createElement("div");a.style.position="absolute",a.style.border="1px dotted #000",a.style.pointerEvents="none",a.hidden=1,e.parentNode.appendChild(a);var l=0,s=0,r=0,d=0;function c(e){"Escape"===e.key&&(u(),o(!1,0,0,0,0))}function h(){var e=Math.min(l,r),t=Math.min(s,d),i=Math.max(l,r),n=Math.max(s,d);a.style.left=e+"px",a.style.top=t+"px",a.style.width=i-e+"px",a.style.height=n-t+"px"}function u(){e.parentNode.removeChild(a),e.removeEventListener("mousedown",p),e.removeEventListener("mouseup",g),e.removeEventListener("mousemove",m),n.dlg.content.removeEventListener("keydown",c)}function p(e){a.hidden=0,l=e.clientX,s=e.clientY,r=l,d=s,h()}function m(e){r=e.clientX,d=e.clientY,h()}function g(e){u();var n=Math.min(l,r),a=Math.min(s,d),c=Math.max(l,r),h=Math.max(s,d);o(!0,n-t,a-i,c-t,h-i)}n.dlg.content.addEventListener("keydown",c),e.addEventListener("mousedown",p),e.addEventListener("mousemove",m),e.addEventListener("mouseup",g),e.addEventListener("touchstart",function(e){a.hidden=0,l=Math.round(e.touches[0].clientX),s=Math.round(e.touches[0].clientY),r=l,d=s,h()}),e.addEventListener("touchmove",function(e){r=Math.round(e.touches[0].clientX),d=Math.round(e.touches[0].clientY),h()}),e.addEventListener("touchend",function(e){u();var n=Math.min(l,r),a=Math.min(s,d),c=Math.max(l,r),h=Math.max(s,d);o(!0,n-t,a-i,c-t,h-i)})}(n,a.left,a.top,t,function(a,l,s,r,c){if(i.canvas.parentNode.removeChild(n),a){var h=r-l+1,u=c-s+1;o._onScreenShot(i,l,s,h,u,e.fullPixelChecker),d.doScreenShot({x:devicePixelRatio*l,y:devicePixelRatio*s,width:devicePixelRatio*h,height:devicePixelRatio*u},{_noCtx:!0},t._onScreenShot.bind(t,h,u),null,{checkerMode:e.fullPixelChecker?"FullPixelChecker":"ContentChecker"})}})},m});