define("DS/SpecGridView/controller/GridColumn",["DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/utils/Utils","DS/Controls/LineEditor","DS/Controls/ComboBox","DS/Controls/Toggle","DS/Controls/Label","DS/XSRCommonComponents/utils/TypeUtils","DS/XSRCommonComponents/utils/RequestUtil","i18n!DS/SpecGridView/assets/nls/SpecGridView"],function(e,t,n,a,i,o,l,r,d){"use strict";function u(e){return this}return u.prototype.process=function(u){var s=this;return u&&u.forEach(function(u){u.text=u.text,u.editableFlag&&u.forbiddenCheck&&(s.columnCharValidationList[u.dataIndex]=!0),!1!==u.exportFlag&&s.exportableColums.push(u.dataIndex),u.editableFlag&&(u.getCellEditableState=function(n){var a=n.nodeModel;return"isQS"===u.dataIndex?!s.parentModel||s.parentModel.options.maturity!==e.WELCOMEPANEL_ID_RELEASED&&s.parentModel.options.grid["ds6w:status"]!==e.WELCOMEPANEL_ID_RELEASED&&s.parentModel.options.maturity!==e.WELCOMEPANEL_ID_OBSOLETE&&s.parentModel.options.grid["ds6w:status"]!==e.WELCOMEPANEL_ID_OBSOLETE:!(!a||!a.getID||t.isOriginatedInGLS(a))&&a.hasAccess("modify")}),"lossPercent"===u.dataIndex&&(u.getCellSemantics=function(t){if(t.nodeModel)return{pattern:e.LOSS_PATTERN}},u.getCellValueForExport=function(e){let t=e.nodeModel;if(t&&t.getID)return e.nodeModel.getLosspercent()},u.getCellEditableState=function(t){return!s.parentModel||s.parentModel.options.maturity!==e.WELCOMEPANEL_ID_RELEASED&&s.parentModel.options.grid["ds6w:status"]!==e.WELCOMEPANEL_ID_RELEASED&&s.parentModel.options.maturity!==e.WELCOMEPANEL_ID_OBSOLETE&&s.parentModel.options.grid["ds6w:status"]!==e.WELCOMEPANEL_ID_OBSOLETE}),"FormulaQunatityPercent"==u.dataIndex&&u.children.forEach(function(t){s.exportableColums.push(t.dataIndex),"minPercent"!==t.dataIndex&&"maxPercent"!==t.dataIndex&&"targetPercent"!==t.dataIndex||(t.getCellSemantics=function(t){var n=t.nodeModel;if(n)return n.isWeightUnitExist?"":{pattern:e.MIN_MAX_TARGET_PATTERN}},t.getCellEditableState=function(t){return!t.nodeModel.isWeightUnitExist&&(!s.parentModel||s.parentModel.options.maturity!==e.WELCOMEPANEL_ID_RELEASED&&s.parentModel.options.grid["ds6w:status"]!==e.WELCOMEPANEL_ID_RELEASED&&s.parentModel.options.maturity!==e.WELCOMEPANEL_ID_OBSOLETE&&s.parentModel.options.grid["ds6w:status"]!==e.WELCOMEPANEL_ID_OBSOLETE)}),"minPercent"!==t.dataIndex&&"maxPercent"!==t.dataIndex&&"targetPercent"!==t.dataIndex||(t.getCellValueForExport=function(e){let n=e.nodeModel;return n&&n.isWeightUnitExist?"":n&&n.getID?n.getAttributeValue(t.dataIndex):void 0})}),"FormulaQuantityRange"===u.dataIndex&&u.children.forEach(function(t){s.exportableColums.push(t.dataIndex),"targetQuantity"!==t.dataIndex&&"minQuantity"!==t.dataIndex&&"maxQuantity"!==t.dataIndex||(t.getCellValueForExport=function(e){var t=s.grid.getColumnOrGroup(e.columnID).dataIndex;let n=e.nodeModel;if(n&&!n.isWeightUnitExist)return"";if(n&&n.getID){var a=e.nodeModel.getAttributeValue("unitNLS");switch(t){case"targetQuantity":case"minQuantity":case"maxQuantity":return e.nodeModel.getAttributeValue(t)+" "+a}}},t.getCellTooltip=function(e){var t,n=s.grid.getColumnOrGroup(e.columnID).dataIndex;if(null==e.nodeModel||!e.nodeModel.isWeightUnitExist)return{shortHelp:""};switch(n){case"targetQuantity":t=e.nodeModel.getAttributeValue("targetQuantity");break;case"minQuantity":t=e.nodeModel.getAttributeValue("minQuantity");break;case"maxQuantity":t=e.nodeModel.getAttributeValue("maxQuantity")}var a=e.nodeModel.getAttributeValue("unitNLS"),i=null==t||null==t?"":t;return{shortHelp:i+" "+(null==a||null==a||""==i?"":a)}},t.getCellValue=function(t){var i=s.grid.getColumnOrGroup(t.columnID).dataIndex,r=UWA.createElement("div",{class:"uom-container"}),u=t.nodeModel;if(!t.nodeModel.isWeightUnitExist)return r;if(u&&u._canBeGrouped()){var g=!0;"function"==typeof u.IsComputed&&u.IsComputed()&&(g=!1),!s.parentModel||s.parentModel.options.maturity!==e.WELCOMEPANEL_ID_RELEASED&&s.parentModel.options.grid["ds6w:status"]!==e.WELCOMEPANEL_ID_RELEASED&&s.parentModel.options.maturity!==e.WELCOMEPANEL_ID_OBSOLETE&&s.parentModel.options.grid["ds6w:status"]!==e.WELCOMEPANEL_ID_OBSOLETE||(g=!1);u=t.nodeModel;var c=Object.entries(l.getUOMUnits("Mass")),p=[],m=new Map;c.forEach(function(e){p.push(e[1]),m.set(e[1],e[0])}),p.sort(function(e,t){return(e=e.toLowerCase())==(t=t.toLowerCase())?0:e>t?1:-1});var E,C=t.nodeModel.getUnitNLS();switch(i){case"targetQuantity":E=u.getAttributeValue("targetQuantity");break;case"minQuantity":E=u.getAttributeValue("minQuantity");break;case"maxQuantity":E=u.getAttributeValue("maxQuantity")}var M=null==E||null==E?"":E,h=-1;null!=C&&(h=p.indexOf(C));var A=M+" "+(null==C||null==C||""==M?"":C);"loading..."===C&&(A=d.loading,h=-1);var I=UWA.createElement("div",{class:"readonly-container",html:A}).inject(r),v=UWA.createElement("div",{class:"uom-container-edit xsr-grid-wux-hide"}).inject(r);g&&I.addEventListener("click",function(){document.querySelectorAll(".readonly-container").forEach(e=>{e.hasClassName("xsr-grid-wux-hide")&&e.toggleClassName("xsr-grid-wux-hide")}),document.querySelectorAll(".uom-container-edit").forEach(e=>{e.hasClassName("xsr-grid-wux-hide")||e.toggleClassName("xsr-grid-wux-hide")}),I.addClassName("xsr-grid-wux-hide"),v.toggleClassName("xsr-grid-wux-hide")});var x,f=new n({placeholder:d.placeholder_Quantity,value:M,pattern:"([0-9]*[.])?[0-9]+",selectAllOnFocus:!0}).inject(v);if(f.getContent().addClassName("xsr-grid-lineeditor-formula"),"targetQuantity"==i)(x=new a({elementsList:p,selectedIndex:h,placeholder:d.placeholder_UOM}).inject(v)).getContent().addClassName("xsr-grid-combobox-formula");else(x=new o({value:C,emphasize:C}).inject(v)).getContent().addClassName("xsr-grid-label-formula");switch(f.getContent().getChildren()[0].onpaste=function(e){e.preventDefault();let t=(e.clipboardData||window.clipboardData).getData("text");f.value=t},i){case"targetQuantity":f.addEventListener("change",function(e){let n=e.dsModel.value;s.activeCellId=t.cellID;let a=x.getModel().value;""!=n&&null!=x.value?u.updateOptions({grid:{targetQuantity:n,unitNLS:a,unit:m.get(a)}}):u.updateOptions({grid:{targetQuantity:n}})});break;case"minQuantity":f.addEventListener("change",function(e){let n=e.dsModel.value;s.activeCellId=t.cellID;let a=x.getModel().value;""!=n&&null!=x.value?u.updateOptions({grid:{minQuantity:n,unitNLS:a,unit:m.get(a)}}):u.updateOptions({grid:{minQuantity:n}})});break;case"maxQuantity":f.addEventListener("change",function(e){let n=e.dsModel.value;s.activeCellId=t.cellID;let a=x.getModel().value;""!=n&&null!=x.value?u.updateOptions({grid:{maxQuantity:n,unitNLS:a,unit:m.get(a)}}):u.updateOptions({grid:{maxQuantity:n}})})}x.addEventListener("change",function(e){e.preventDefault(),e.stopPropagation();let n=e.dsModel.value;s.activeCellId=t.cellID,u.updateOptions({grid:{unitNLS:n,unit:m.get(n)}})})}return s.activeCellId===t.cellID&&(I.addClassName("xsr-grid-wux-hide"),v.toggleClassName("xsr-grid-wux-hide")),r})}),"uomupdated"===u.dataIndex&&(u.getCellTooltip=function(e){if(null==e.nodeModel)return{shortHelp:e.cellModel};if("Formulated_Product"!==e.nodeModel.getAttributeValue("ds6w:type")&&l.isPhyProd(e.nodeModel.getAttributeValue("ds6w:type"))&&e.nodeModel.getAttributeValue("madeFrom"))return{shortHelp:""};var t=e.nodeModel.getAttributeValue("unitNLS"),n=e.nodeModel.getAttributeValue("quantity"),a=null==n||null==n?"":n;return{shortHelp:a+(null==t||null==t||""==a?"":t)+(e.nodeModel.getAttributeValue("asRequired")?" "+d.label_As_Required:"")}},u.getCellValue=function(t){var o=UWA.createElement("div",{class:"uom-container"}),r=widget.getValue(e.PERSISTENCY_BOM_VIEW);if((c=t.nodeModel)&&c._canBeGrouped()){if(!l.isFormulatedProduct(t.nodeModel.getAttributeValue("ds6w:type"))&&l.isPhyProd(c.getAttributeValue("ds6w:type"))&&c.getAttributeValue("madeFrom"))return o;var u=!0,g=!0;"function"==typeof c.getCQInstance&&c.getCQInstance()?u=!0:"boolean"!=typeof r||r?"function"==typeof c.IsComputed&&c.IsComputed()&&(u=!1):u=!1,u&&!c.options.grid.dimensionType&&(g=!1),!s.parentModel||s.parentModel.options.maturity!==e.WELCOMEPANEL_ID_RELEASED&&s.parentModel.options.grid["ds6w:status"]!==e.WELCOMEPANEL_ID_RELEASED&&s.parentModel.options.maturity!==e.WELCOMEPANEL_ID_OBSOLETE&&s.parentModel.options.grid["ds6w:status"]!==e.WELCOMEPANEL_ID_OBSOLETE||(u=!1);var c=t.nodeModel,p=Object.entries(l.getUOMUnits(c.options.grid.dimensionType)),m=[],E=new Map;p.forEach(function(e){m.push(e[1]),E.set(e[1],e[0])}),m.sort(function(e,t){return(e=e.toLowerCase())==(t=t.toLowerCase())?0:e>t?1:-1});var C=t.nodeModel.getAttributeValue("unitNLS"),M=c.getAttributeValue("quantity"),h=null==M||null==M?"":M,A=-1;null!=C&&(A=m.indexOf(C));var I=c.getAttributeValue("asRequired"),v=h+(null==C||null==C||""==h?"":C)+(I?" "+d.label_As_Required:"");""==v&&(l.isRawMaterial(c.getAttributeValue("ds6w:type_value"))||l.isFormulatedProduct(c.getAttributeValue("ds6w:type_value")))&&(v=d.placeholder_UOM_Details),"loading..."===C&&(v=d.loading,A=-1);var x=UWA.createElement("div",{class:"readonly-container",html:v}).inject(o),f=UWA.createElement("div",{class:"uom-container-edit xsr-grid-wux-hide"}).inject(o);u&&x.addEventListener("click",function(){document.querySelectorAll(".readonly-container").forEach(e=>{e.hasClassName("xsr-grid-wux-hide")&&e.toggleClassName("xsr-grid-wux-hide")}),document.querySelectorAll(".uom-container-edit").forEach(e=>{e.hasClassName("xsr-grid-wux-hide")||e.toggleClassName("xsr-grid-wux-hide")}),x.addClassName("xsr-grid-wux-hide"),f.toggleClassName("xsr-grid-wux-hide")});var S=new i({label:d.label_As_Required,type:"switch",checkFlag:I});S.getContent().addClassName("xsr-grid-wux-inline"),S.addEventListener("buttonclick",function(e){var n=e.dsModel.checkFlag;let a=c.getAttributeValue("quantity");null!=a&&parseFloat(a)<=0?(s.activeCellId=null,e.preventDefault(),e.stopPropagation(),S.checkFlag=!0):(s.activeCellId=t.cellID,c.updateOptions({grid:{asRequired:n}}))});var y=g?"([0-9]*[.])?[0-9]+":"[0-9]+",L=new n({placeholder:d.placeholder_Quantity,value:h,pattern:y,selectAllOnFocus:!0}).inject(f),b=new a({elementsList:m,selectedIndex:A,placeholder:d.placeholder_UOM});l.isPhyProd(t.nodeModel.options.grid["ds6w:type"])?L.getContent().addClassName("xsr-grid-lineeditor-product-box"):(b.inject(f),S.inject(f),L.getContent().addClassName("xsr-grid-lineeditor")),b.getContent().addClassName("xsr-grid-combobox"),L.getContent().getChildren()[0].onpaste=function(e){e.preventDefault();let t=(e.clipboardData||window.clipboardData).getData("text");L.value=t},L.addEventListener("change",function(e){let n=e.dsModel.value;s.activeCellId=t.cellID;let a=b.getModel().value;l.isPhyProd(c.getAttributeValue("ds6w:type"))?c.updateOptions({grid:{quantity:parseFloat(n)}}):""!=n&&null!=b.value&&c.updateOptions({grid:{quantity:parseFloat(n),unitNLS:a,unit:E.get(a),uom:a}})}),b.addEventListener("change",function(e){e.preventDefault(),e.stopPropagation();let n=e.dsModel.value;s.activeCellId=t.cellID,null!=L.getModel().value&&""!=L.getModel().value&&c.updateOptions({grid:{quantity:parseFloat(L.getModel().value),unitNLS:n,unit:E.get(n),uom:n}})}),g||(b.disabled=!0,S.disabled=!0)}return s.activeCellId===t.cellID&&(x.addClassName("xsr-grid-wux-hide"),f.toggleClassName("xsr-grid-wux-hide")),o},u.getCellValueForExport=function(e){var t=e.nodeModel;if(t&&t.getID){if(l.isPhyProd(t.getAttributeValue("ds6w:type"))&&t.getAttributeValue("madeFrom"))return"";if(null==t)return d.label_UOM;var n,a=t.getUnit(),i=t.getQuantity();return void 0!==t.getMadeFrom()?null!=i&&(n=i+t.getUnitNLS()):n=""==a?i+t.getUnit():i+t.getUnitNLS(),t.getAsRequired()&&(n="null"==n||null==n||"nullEA (each)"==n?d.label_As_Required:n+" "+d.label_As_Required),n}}),"madeFrom"===u.dataIndex&&(u.getCellValueForExport=function(e){var t=e.nodeModel;if(t&&t.getID)switch(s.grid.layout.getDataIndexFromColumnIndex(e.columnID)){case"madeFrom":return void 0===t.getMadeFrom()||null===t.getMadeFrom()?"":d.label_MakeFrom}},u.getCellTooltip=function(e){var t=e.nodeModel;if(t&&t.getID&&!!t.getMadeFrom())return{shortHelp:d.label_MakeFrom}}),"revisionForTMS"===u.dataIndex&&(u.getCellTooltip=function(e){var t=e.nodeModel;if(t&&t.getID)return{shortHelp:t.isLastVersion()?t.getRevision():t.getRevision()+" "+d.HigherRevExist}},u.getCellValue=function(e){var t=e.nodeModel;if(t&&t.getRevision)return t.getRevision()},u.getCellSemantics=function(e){var t=e.nodeModel;if(t&&t.isLastVersion&&!t.isLastVersion())return{icon:"flow-line"}}),"url"===u.typeRepresentation?(u.getCellValue=function(n){var a,i,o=function(e,n,a,i,o){return t.isXSRAuthoredType(a.getTypeActualName())?{label:e,icon:i,url:"#UNEXISTANT_ID",module:"DS/XSRCommonComponents/utils/GridCommonActionsManager",func:"launch",argument:{commandId:n,selectedNode:a,appCore:s.appCore,currentTabKey:s.currentTabKey,selectFacet:o}}:{label:e}},l=n.nodeModel,r=s.grid.layout.getDataIndexFromColumnIndex(n.columnID);if(l.getID){switch(r){case"partNumber":(i=void 0===l.getPartNumber()||null===l.getPartNumber()?"":l.getPartNumber())&&(a=o(i,e.SET_PART_NUMB,l));break;case"ds6wg:revision":(i=void 0===l.getRevision()||null===l.getRevision()?"":l.getRevision())&&(a=o(i,e.VERSION_GRAPH_CMD,l),l.isLastVersion&&void 0!==l.isLastVersion()&&!l.isLastVersion()&&(a.icon="flow-line")),i&&t.isOriginatedInGLS(l)&&(a=i);break;case"ds6w:status":(i=void 0===l.getMaturity()||null===l.getMaturity()?"":l.getMaturity())&&(a=o(i,e.MATURITY_GRAPH_CMD,l)),i&&t.isOriginatedInGLS(l)&&(a=i);break;case"ds6w:responsible":(i=void 0===l.getOwner()||null===l.getOwner()?"":l.getOwner())&&(a=o(i,e.CHANGE_OWNER_CMD,l)),i&&t.isOriginatedInGLS(l)&&(a=i);break;case"Alternate":var d="",u=l._options.grid.Alternate;"Yes"==(u=u?u.replace("\n",""):u)&&(d="fonticon fonticon-exchange alternateColumn"),a=o("",e.INFORMATION_CMD,l,d,e.FACET_ALTERNATE);break;case"revisionForTMS":let n=null,s=null;l&&l.getRevision&&(n=l.getRevision()),l&&l.isLastVersion&&!l.isLastVersion()&&(s="flow-line"),a={icon:s,label:n}}return a}},u.getCellGroupingKey=function(e){var t=e.nodeModel;if(t&&t.getID){var n=s.grid.layout.getDataIndexFromColumnIndex(e.columnID);return e.nodeModel.options.grid[n]}},u.getCellValueForExport=function(e){var t=e.nodeModel;if(t&&t.getID)switch(s.grid.layout.getDataIndexFromColumnIndex(e.columnID)){case"partNumber":return void 0===t.getPartNumber()||null===t.getPartNumber()?"":t.getPartNumber();case"ds6wg:revision":var n=void 0===t.getRevision()||null===t.getRevision()?"":t.getRevision();return n=n&&t.isLastVersion&&t.isLastVersion()?n:n+"("+d.HigherRevExist+")";case"ds6w:status":return void 0===t.getMaturity()||null===t.getMaturity()?"":t.getMaturity();case"ds6w:responsible":return void 0===t.getOwner()||null===t.getOwner()?"":t.getOwner()}},"ds6wg:revision"===u.dataIndex&&(u.getCellTooltip=function(e){var t=e.nodeModel;if(t&&t.getID)return{shortHelp:t.isLastVersion()?t.getRevision():t.getRevision()+" "+d.HigherRevExist}}),"Alternate"===u.dataIndex&&(u.getCellTooltip=function(e){var t=e.nodeModel;if(t&&t.getID){return{shortHelp:"Yes"==t._options.grid.Alternate?d.label_Alternate:""}}}),"ds6wg:revision"!==u.dataIndex&&"ds6w:status"!==u.dataIndex&&"ds6w:responsible"!==u.dataIndex||(u.getCellTypeRepresentation=function(e){return e.nodeModel&&t.isOriginatedInGLS(e.nodeModel)?"string":u.typeRepresentation})):"menu"===u.dataIndex&&(u.getCellValue=function(t){var n=t.nodeModel,a=widget.getValue(e.PERSISTENCY_BOM_VIEW);if(void 0===a&&(a=!0),n.getID&&n.getID()){var i=[];if(n.currentTabKey===e.FACET_MBMF&&n.appCore.contextAppId===e.XSR_APP_ID)i.push("Information"),i.push("OpenSpecificationView"),i.push("DeleteItem"),i.push("UPSAuthReorderProduct"),i.push("UPSAuthReplaceByRevision"),i.push("UPSAuthCut"),i.push("UPSAuthCopy"),i.push("UPSAuthPaste");else if(n.currentTabKey===e.FACET_MBMF&&n.appCore.contextAppId!==e.XSR_APP_ID)i=["Information","OpenSpecificationView","OpenWith","ManageFiles","SetPartNumber","UPSAuthUnparent","RemoveChild","VersionExplorer","DuplicateItem","CompareWith","RelatedObjects","MaturityGraph","ActionBar_ChangeOwner","MultiOwnership","DownloadReport","DownloadDocument","Subscriptions","DeleteItem","addExisting","RegenerateReport","Close","UPSAuthReorderProduct","UPSAuthReplaceByRevision","UPSAuthCut","UPSAuthCopy","UPSAuthPaste"];else if(n.currentTabKey===e.BOM_TAB){let e=["Information_Widget","Alternates"];i=i.concat(e);let t=n.getAttributeValue("ds6w:status");if(a){let e=["UPSAuthReorderProduct","UPSAuthCut","UPSAuthCopy","UPSAuthPaste"];i=i.concat(e)}if(n.options.grid.madeFromRelationId&&null!=n.options.grid.madeFromRelationId){let e=["UPSAuthReplaceByRevision","UPSAuthCut","UPSAuthCopy","UPSAuthPaste"];i=i.concat(e)}if(l.isFormulatedProduct(n.getAttributeValue("ds6w:type"))){let e=["UPSAuthReplaceByRevision","UPSAuthPaste"];i=i.concat(e)}if(l.isRawMaterial(n.getAttributeValue("ds6w:type"))){let e=["UPSAuthReorderProduct","UPSAuthPaste"];i=i.concat(e)}if("Released"===t||"Obsolete"===t){let e=["UPSAuthPaste"];i=i.concat(e)}if(!a){let e=["UPSAuthUnparent","DeleteItem"];i=i.concat(e)}}else n.currentTabKey===e.DOC_TAB?r.isMobile()&&i.push("DownloadDocument"):n.currentTabKey===e.FORMULABOM_TAB?i=["Information_Widget","Alternates","UPSAuthReorderProduct","UPSAuthReplaceByRevision","UPSAuthCut","UPSAuthCopy","UPSAuthPaste"]:"test-method-facet"===n.currentTabKey&&(i=["Information","OpenWith","ManageFiles","SetPartNumber","UPSAuthUnparent","RemoveChild","VersionExplorer","DuplicateItem","CompareWith","RelatedObjects","MaturityGraph","ActionBar_ChangeOwner","MultiOwnership","DownloadReport","Subscriptions","DeleteItem","addExisting","RegenerateReport","Close","Information_Widget","Alternates","UPSAuthReplaceByRevision"]);return{label:"",module:"DS/XSRCommonComponents/utils/GridCommonActionsManager",func:"getActionMenu",argument:{execludeCmds:i}}}n.options.grid.menu=""},u.hasCellValue=function(e){var t=e.nodeModel;return!(!t||!t._canBeGrouped())})}),u},u});