define("DS/VCXWebExperienceLoader/VCXExperienceSaverBase",["UWA/Class","DS/VCXWebProperties/VCXPropertyServices","DS/WebRBTree/WebRBIterator"],function(e,t,r){"use strict";return e.extend({init:function(){},_reformatObjectIDForPathOfId:function(e,t){var r,n=t.ComponentsMap.GetComponentFromID(e);n?t.getManager("VCXContextManager").getCat3DXIntegration()&&n.QueryInterface("CATI3DExperienceObject")?(r={}).pathOfIds=n.GetID().split(","):r=n.GetID():r="";return r},_MetaPropertiesDefToJson:function(e){var t=[],r=e.getManager("VCXMetaPropertyManager")._MetaPropertyDef;for(var n in r)if(r.hasOwnProperty(n)){var a=r[n],o=a.GetPropertyInfo(),i={name:n,type:a.GetType(),behavior:o.GetBehaviorType(),defaultLabel:a.GetDefaultLabel()};o.IsBounded()&&(i.bounds=o.GetBounds()),t.push(i)}return t},_PropertiesLinksToJson:function(e){var t=[];for(var r in e._links)if(e._links.hasOwnProperty(r)){var n=e._links[r];if(n)for(var a in n){var o=n[a];if(o)for(var i in o)if(o.hasOwnProperty(i)){var s=o[i];for(var p in s)if(s.hasOwnProperty(p)){var l={inID:r,inProp:a,outID:i,outProp:p};t.push(l)}}}}return t},_ComponentsMapToJson:function(e){var t=[],r=e.ComponentsMap.GetComponentTable();for(var n in r)if(r.hasOwnProperty(n)){var a=r[n];if(0!==a.GetPersistency())continue;var o=a.GetType(),i={};i.objectID=n,i.objectType=o;var s=null;a.BuildLoadData&&(s=a.BuildLoadData()),s&&(i.objectData=s),t.push(i)}return t},_W3AISGNodeHolderToJson:function(e){var t=[],r=e.ComponentsMap.GetComponentTable();for(var n in r)if(r.hasOwnProperty(n)){var a=r[n];if(2===a.GetPersistency())continue;var o={};o.objectID=n;var i=a.QueryInterface("W3AISGNodeHolder");if(i&&!i.isSelfManagedPathElement()){var s=a.QueryInterface("VCXIModelNavigable");if(s){var p=s.getAssetNavigable();if(p){var l=i.getRelativePathElement(p),f=this._BuildArrayIDsFromPathElement(l);o.PathElement=f,t.push(o)}}}}return t},_VCXIModelNavigableToJson:function(e){var t=[],r=e.ComponentsMap.GetComponentTable();for(var n in r)if(r.hasOwnProperty(n)){var a=r[n];if(2===a.GetPersistency())continue;var o={};o.objectID=n;var i=a.QueryInterface("VCXIModelNavigable");if(i)if(i.isSelfOrganized()){var s=i.getWorkingRoot();s&&(o.WorkingRoot=s.GetObject().GetID(),t.push(o))}else{var p=i.getParent();p&&(o.NavigableParent=p.GetObject().GetID(),t.push(o))}}return t},_BuildArrayIDsFromPathElement:function(e){if(e){var t=[],r=e.externalPath;if(r)for(var n=0;n<r.length;n++){var a=r[n],o=a.persistentId,i=a.id;if(o)t.push(o.toString());else if(i)t.push(i.toString());else{var s=a.name;t.push(s)}}return t}},_NeutralsToJson:function(e,t){var r=[],n=e.getManager("VCXScenarioManager")._keyframer._Neutrals;const a=[];for(var o in n._map)if(n._map.hasOwnProperty(o)){var i=e.getManager("VCXScenarioManager").ModifiableServer.GetModifiableFromHashing(o);if(!i){console.log("WARNING this hashmodifiable does not exist : "+o);continue}var s=i.GetObject(),p=s.GetPersistency();if(2===p)continue;var l=n.GetPropertySet(o),f=null,c=s.QueryInterface("CATI3DExpVCXObjectConvertor");if(l&&c&&t){var u=l.Clone();c.UpdateVariablesFromNeutrals(u,t),f=this._PropSetToJson(u,e)}f||(f=this._PropSetToJson(l,e));let h=this._reformatObjectIDForPathOfId(s.GetID(),e);if(1!==p){let e={objectID:h,properties:f};r.push(e)}else f.forEach(e=>{"string"==typeof h&&(e.name="Singleton.Property."+h+"."+e.name),a.push(e)})}return r.push({objectID:this._reformatObjectIDForPathOfId(e.getManager("VCXContextManager").getRootComponent().GetID(),e),properties:a}),r},_PropSetToJson:function(e,t){var r=[];for(var n in e._map)if(e._map.hasOwnProperty(n)){var a=e.GetProperty(n).GetPropertyValue(),o=a.GetType(),i=this._PropertyToJson(a,t);r.push({name:n,type:o,value:i})}return r},_PropMapToJson:function(e,t){var r={};for(var n in t._map)if(t._map.hasOwnProperty(n)){var a=t.GetPropertySet(n),o=e.getManager("VCXScenarioManager").ModifiableServer.GetModifiableFromHashing(n);if(!o){console.log("WARNING this hashmodifiable does not exist : "+n);continue}if(o){var i=o.GetObject().GetID(),s=this._PropSetToJson(a,e);r[i]=s}}return r},_PropertyToJson:function(e,r){return t.propertyValueToJson(e,e=>this._reformatObjectIDForPathOfId(e,r))},_ScenarioToJson:function(e,t){var r=[];t.GetListModifiables(r);const n=[];for(var a=[],o=0;o<r.length;o++){var i=r[o],s=e.getManager("VCXScenarioManager").ModifiableServer.GetModifiableFromHashing(i);if(!s){console.log("WARNING this hashmodifiable does not exist : "+i);continue}var p=s.GetObject().GetPersistency();if(2===p)continue;let l=t.GetObjectAnimation(i);if(1!==p){let t=this._TracksToJson(l,s,e);a.push(t)}else{let t=this._TracksToJson(l,s,e,s.GetObject().GetID());n.length?n[0].listTracks.push(...t.listTracks):n.push(t)}}return n.length&&a.push(...n),{name:t.GetName(),ID:t.GetID(),listMods:a}},_VisibilityToJson:function(e,t){for(var r=[],n=[],a=[],o=e.GetVisibles(),i=0;i<o.length;i++){var s=this._reformatObjectIDForPathOfId(o[i],t);r.push({objectID:s})}var p=e.GetInvisibles();for(i=0;i<p.length;i++){var l=this._reformatObjectIDForPathOfId(p[i],t);n.push({objectID:l})}var f=e.GetVisibleCollabs();for(i=0;i<f.length;i++){var c=this._reformatObjectIDForPathOfId(f[i],t);a.push({objectID:c})}return{listVisible:r,listInvisible:n,listVisibleCollabs:a}},_TracksToJson:function(e,t,r,n){var a=[];if(e){var o=[];e.GetListTrackNames(o);for(var i=0;i<o.length;i++){var s=o[i],p=e.GetTrack(s);n&&(s="Singleton.Property."+n+"."+s);var l=this._KeysToJson(p,s,r);a.push(l)}}let f;return f=n?r.getManager("VCXContextManager").getRootComponent():t.GetObject(),{objectID:this._reformatObjectIDForPathOfId(f.GetID(),r),listTracks:a}},_KeysToJson:function(e,t,n){for(var a="",o=[],i=e._treekeys,s=new r(i),p=s.next();null!==p;){var l=p.GetFrame(),f=p.GetValue();a||(a=f.GetType());var c=this._PropertyToJson(f,n);"VCXPropertyValueLink"==a&&""==c?console.log("warning VCXPropertyValueLink with no link is not saved"):o.push({time:l,value:c}),p=s.next()}return{name:t,type:a,listKeys:o}}})}),define("DS/VCXWebExperienceLoader/VCXExperienceLoaderBase",["UWA/Class","DS/VCXWebProperties/VCXPropertyServices","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebKernelCommands/VCXCmdChangeScenario","DS/VCXWebKernelCommands/VCXCmdChangeKeys","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties","DS/VCXWebModifiables/VCXMetaPropertyDef","DS/VCXWebKernelCommands/VCXCmdChangeScenarioSequence","DS/VCXWebKernelCommands/VCXCmdChangeSequence","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables"],function(e,t,r,n,a,o,i,s,p,l,f,c,u){"use strict";return e.extend({InitLoader:function(e){this._experienceBase=e,e?(this._factory=e.Factory,this._scenarioManager=e.getManager("VCXScenarioManager"),this._ComponentsMap=e.ComponentsMap):console.log("VCXExperienceLoaderBase : experience base param missing!")},_reformatObjectIDForPathOfId:function(e){if(void 0===e)return e;if(e.pathOfIds){for(var t="",r=0;r<e.pathOfIds.length;r++)0!=r&&(t+=","),t+=e.pathOfIds[r];return t}return e},BuildVCXPropertyValue:function(e,r){return t.jsonToPropertyValue(e,r,this._reformatObjectIDForPathOfId)},BuildPathElementFromArray:function(e,t,r){function n(e,t){var n=null;if(r){if(n=e.getChildById(t))return n;var a;for(a=0;a<e.children.length;a++){if((n=e.children[a]).getPersistentId&&n.getPersistentId()===t)return n;if(n.id.toString()===t)return n}}return(n=e.getChildByName(t))||null}var a=t.QueryInterface("VCXIModelNavigable");if(a){var o=a.getAssetNavigable();if(o){var i=o.QueryInterface("W3AISGNodeHolder");if(i&&i.getPathElement()){var s,p=i.getPathElement().clone();for(s=0;s<e.length;s++){var l=n(p.getLastElement(),e[s]);l?p.addElement(l):console.error("BuildPathElementFromArray : CHILD NODE NOT FOUND !! ",e[s])}return p}}}return null},LoadScenarioSequences:function(e){for(var t=0;t<e.length;t++){var r=e[t].objectID,n=this._experienceBase.ComponentsMap.GetComponentFromID(r),a=new c(this._experienceBase.getManager("VCXSequenceManager"),this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap);a._bIsLoading=!0,a.PushSequence(n),this._experienceBase.getManager("VCXCommandManager").Do(a);for(var o=e[t].listScenarioID,i=0;i<o.length;i++){var s=o[i],p=this._experienceBase.ComponentsMap.GetComponentFromID(s),l=new f(this._experienceBase.getManager("VCXSequenceManager"),this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap);l._bIsLoading=!0,l.PushScenarioInSequence(p,n.GetID()),this._experienceBase.getManager("VCXCommandManager").Do(l)}}},LoadComponents:function(e){if(e)for(var t=0;t<e.length;t++){var r=e[t].objectID,n=e[t].objectType;"VCXComponentVPMReference"===n&&(n="Model_VPMReference_Spec",console.warn("The type VCXComponentVPMReference is deprecated. Please resave the json."));var a=this._factory.BuildComponent(n);if(a){a.SetID(r),this._ComponentsMap.AddComponent(a);var o=e[t].objectData;o&&a.SetLoadData(o)}}},LoadW3AISGNodeHolder:function(e){if(e)for(var t=0;t<e.length;t++){var r=e[t].objectID,n=this._reformatObjectIDForPathOfId(r),a=this._ComponentsMap.GetComponentFromID(n);if(a){var o=a.QueryInterface("W3AISGNodeHolder");if(o){var i=e[t].PathElement;if(i){for(var s=[],p=0;p<i.length;p++)s[p]=i[p];var l=this.BuildPathElementFromArray(s,a,1);l&&o.setPathElement(l)}}}}},LoadVCXIModelNavigable:function(e){if(e)for(var t=0;t<e.length;t++){var r=e[t].objectID,n=this._reformatObjectIDForPathOfId(r),a=this._ComponentsMap.GetComponentFromID(n);if(a){var o=a.QueryInterface("VCXIModelNavigable");if(o){var i=e[t].NavigableParent;if(i){var s=this._ComponentsMap.GetComponentFromID(i);if(s){var p=s.QueryInterface("VCXIModelNavigable");p&&o.setParent(p)}}else{var l=e[t].WorkingRoot;if(l){var f=this._ComponentsMap.GetComponentFromID(l);if(f){var c=f.QueryInterface("VCXIModelNavigable");c&&o.setWorkingRoot(c)}}}}}}},LoadMetaPropertiesDef:function(e){if(e)for(var t=this._experienceBase.getManager("VCXMetaPropertyManager"),r=0;r<e.length;r++){var n=e[r],a=new o(n.name,n.behavior,!0);n.bounds&&("VCXPropertyValueFloat"===n.type?a.SetBounds(parseFloat(n.bounds.valueMin),parseFloat(n.bounds.valueMax),parseFloat(n.bounds.step)):"VCXPropertyValueFloat"===n.type&&a.SetBounds(parseInt(n.bounds.valueMin),parseInt(n.bounds.valueMax),parseInt(n.bounds.step)));var i=new l(a,n.type);a.SetGroupId("Group.UserProperties"),a.Seti18nGroup(u),a.SetMetaPropertyDef(i),i.SetDefaultLabel(n.defaultLabel),t.AddMetaPropertyDef(i)}},LoadPropertiesLinks:function(e){if(e)for(var t=this._experienceBase.getManager("VCXLinkedPropertyManager"),r=0;r<e.length;r++)t.AddLink(e[r].inID,e[r].inProp,e[r].outID,e[r].outProp,null)},LoadNeutrals:function(e){const t=this._experienceBase.getManager("VCXContextManager").getRootComponent().GetID();for(var r=new p(this._experienceBase.getManager("VCXScenarioManager")),n=0;n<e.length;n++){var a=e[n],o=this._reformatObjectIDForPathOfId(a.objectID),i=this._ComponentsMap.GetComponentFromID(o);if(i){var s=i.QueryInterface("VCXIModifiable");if(s){var l=a.properties;for(let e=0;e<l.length;e++){const n=l[e];let a=s;if(t===i.GetID()&&n.name.startsWith("Singleton.Property.")){const e=n.name.substring(19),t=e.indexOf("."),r=e.substring(0,t);a=this._ComponentsMap.GetComponentFromID(r).QueryInterface("VCXIModifiable"),n.name=e.substring(t+1)}const o=n.type,p=n.value,f=this.BuildVCXPropertyValue(o,p);f&&r.ChangeProperty(a,n.name,f)}}}else console.log("ERROR : component not found : "+o+"\n")}this._experienceBase.getManager("VCXCommandManager").Do(r)},LoadPropSet:function(e,t){for(var n=new r,i=0;i<e.length;i++){var s=e[i],p=this.BuildVCXPropertyValue(s.type,s.value);let r=null;r=t&&t.GetProperty(s.name)?t.GetProperty(s.name).GetPropertyInfo():new o(s.name);var l=new a(r,p);n.AddOrModifyProperty(l)}return n},LoadPropMap:function(e){var t=new n;for(var r in e)if(e.hasOwnProperty(r)){var a=this._ComponentsMap.GetComponentFromID(r);if(a){let n=a.QueryInterface("VCXIModifiable");var o=n.GetHashing(),i=e[r],s=this.LoadPropSet(i,n);t.AddOrModifyPropertySet(o,s)}else console.log("ERROR : LoadPropMap: component not found : "+r+"\n")}return t},LoadScenarios:function(e){const t=this._experienceBase.getManager("VCXContextManager").getRootComponent().GetID();for(var r=0;r<e.length;r++){var n=e[r],a=this._ComponentsMap.GetComponentFromID(n.ID);if(a){var o=new i(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap);o.AddScenarios(a),this._experienceBase.getManager("VCXCommandManager").Do(o),a.SetName(n.name);for(var p=new s(this._experienceBase.getManager("VCXScenarioManager")),l=n.listMods,f=0;f<l.length;f++){var c=l[f],u=this._reformatObjectIDForPathOfId(c.objectID);if(!(_=this._ComponentsMap.GetComponentFromID(u))){console.log("ERROR : LoadScenarios: component not found : "+u+"\n");continue}let e=_.QueryInterface("VCXIModifiable");if(e)for(var h=c.listTracks,C=0;C<h.length;C++){var d=h[C];let r=d.name,n=e;if(t===_.GetID()&&r.startsWith("Singleton.Property.")){const e=r.substring(19),t=e.indexOf("."),a=e.substring(0,t);n=this._ComponentsMap.GetComponentFromID(a).QueryInterface("VCXIModifiable"),r=e.substring(t+1)}var g=d.listKeys;if(g)for(var m=0;m<g.length;m++){var v=g[m],I=v.easing,b=v.value,M=this.BuildVCXPropertyValue(d.type,b);M&&p.ChangeKey(a,n,r,parseFloat(v.time),M,I)}}}this._experienceBase.getManager("VCXCommandManager").Do(p);var D=n.visibility;if(D){var P=D.listVisible;if(P)for(var y=0;y<P.length;y++){c=P[y],u=this._reformatObjectIDForPathOfId(c.objectID);(_=this._ComponentsMap.GetComponentFromID(u))&&a.GetVisibility().AddVisible(_)}var V=D.listInvisible;if(V)for(y=0;y<V.length;y++){c=V[y],u=this._reformatObjectIDForPathOfId(c.objectID);(_=this._ComponentsMap.GetComponentFromID(u))&&a.GetVisibility().AddInvisible(_)}var S=D.listVisibleCollabs;if(S)for(y=0;y<S.length;y++){var _;c=S[y],u=this._reformatObjectIDForPathOfId(c.objectID);(_=this._ComponentsMap.GetComponentFromID(u))&&a.GetVisibility().AddVisibleCollab(_)}}}else console.log("ERROR : LoadScenarios: scenario component not found : "+n.ID+"\n")}}})}),define("DS/VCXWebExperienceLoader/CATE3DXJSONProcessorExpTrackManager_Spec",["UWA/Class","DS/VCXWebExperienceLoader/VCXExperienceLoaderBase","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties","DS/VCXWebProperties/VCXPropertyValueString"],function(e,t,r,n){"use strict";return e.extend({init:function(){},Process:function(){var e=new t;e.InitLoader(this._object._experienceBase);var a=this.QueryInterface("CATI3DXAssetHolder")._getCache(),o=this._object._experienceBase.getManager("VCXScenarioManager");o.SetCurrentFrame(0),o.SetDefaultInterpolator("Actor.Hyperlink",0),o.SetDefaultInterpolator("Collab.Image.Doc.ID",0),e.LoadComponents(a.VCXObjects),e.LoadNeutrals(a.neutrals);for(var i=new r(o),s=0;s<a.ScenarioSequences.length;s++){var p=a.ScenarioSequences[s].objectID,l=this._object._experienceBase.ComponentsMap.GetComponentFromID(p).QueryInterface("VCXIModifiable"),f=a.ScenarioSequences[s].name,c=new n;c.SetValue(f),i.ChangeProperty(l,"Actor.Name",c)}var u=this._object._experienceBase.getManager("VCXCommandManager");for(var h in u.Do(i),e.LoadScenarios(a.listScenarios),o.GetScenarios()){if(o.GetScenarios().hasOwnProperty(h))o.GetScenarios()[h].SetEMSDirty(!1)}e.LoadScenarioSequences(a.ScenarioSequences)}})});