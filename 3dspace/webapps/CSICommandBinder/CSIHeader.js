define("DS/CSICommandBinder/CSIHeader",["DS/ExperienceKernel/ExperienceKernel","DS/CSICommandBinder/CSIParameters","DS/ExperienceKernel/EKBinaryHelpers","DS/CSICommandBinder/CSIValueType"],function(e,t,r,n){"use strict";var i=Object.freeze({v3:3}),s=Object.freeze({clientToServer:0,serverToClient:1,emit:3,serverCommandPostDelete:4,clientCommandInstanceDeleted:5,serverToClientSuccess:6,serverToClientProgress:7,serverToClientError:8,clientFunctionCall:9,internalMessaging:10,invalid:99}),a=Object.freeze({debug:2,discardProgress:4}),o=function(e){this.isValid_=!1;var t=new r.BinaryReader(e);if(this.guid_=t.readUint64(),t.readUint8()===i.v3){if(this.msgType_=t.readUint8(),this.flags_=t.readUint8(),this.targetVersion_=t.readUint8(),this.targetName_=t.readString(),t.remains()){var n=t.readUint64();this.arguments_=t.readArrayBuffer(n)}else this.arguments_=new ArrayBuffer(0);this.isValid_=!0}};o.prototype.isValid=function(){return this.isValid_},o.prototype.getGuid=function(){return this.guid_},o.prototype.getMessageType=function(){return this.msgType_},o.prototype.getTargetName=function(){return this.targetName_},o.prototype.getTargetVersion=function(){return this.targetVersion_},o.prototype.getArguments=function(){var e=new t;return e.fromBinary(this.arguments_)?e:new t};var g=function(){this.guid_=0,this.msgType_=s.invalid,this.flags_=0,this.targetVersion_=0,this.targetName_="",this.arguments_=null};return g.prototype.setGuid=function(e){this.guid_=e},g.prototype.setMessageType=function(e){this.msgType_=e},g.prototype.setTargetName=function(e){this.targetName_=e},g.prototype.setTargetVersion=function(e){this.targetVersion_=e},g.prototype.setArguments=function(e){this.arguments_=e},g.prototype.setDebugMode=function(e){this.setInternalFlags_(e?a.debug:0,e?0:a.debug)},g.prototype.createBinary=function(){var e=12+(4+this.targetName_.length),t=0,n=null;null!==this.arguments_&&null!==(n=this.streamArguments_())&&(t=n.byteLength),t>0&&(e+=t+8);var s=new r.BinaryWriter(e);return s.writeUint64(this.guid_),s.writeUint8(i.v3),s.writeUint8(this.msgType_),s.writeUint8(this.flags_),s.writeUint8(this.targetVersion_),s.writeString(this.targetName_),t>0&&(s.writeUint64(t),s.writeArrayBuffer(n)),s.createArrayBuffer()},g.prototype.streamArguments_=function(){if(this.arguments_ instanceof t){if(!this.arguments_.isEmpty())return this.arguments_.toBinary()}else if(this.arguments_ instanceof Object){var e=JSON.stringify(this.arguments_),i=unescape(encodeURIComponent(e)),s=new r.BinaryWriter(4+i.length);return s.writeUint32(n.CSIJsonGuid),s.writeStringInternal(i),s.createArrayBuffer()}return new ArrayBuffer(0)},g.prototype.setInternalFlags_=function(e,t){this.flags_&=~t,this.flags_|=e},{MessageBuilder:g,MessageReader:o,EProtocolVersion:i,ENodeMessageType:s,EInternalFlags:a}});