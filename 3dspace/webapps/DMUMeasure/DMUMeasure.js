define("DS/DMUMeasure/DMUMeasureBaseCmd",["DS/DMUBaseCommands/EXPStateCommand","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUBaseExperience/EXPUtils","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUMeasurable/DMUMeasurableElementAgent","DS/DMUBaseUIControllers/DMUReviewContextInitializer","DS/DMUMeasurable/DMUMeasurable","DS/Web3DUXAssistantTools/Web3DUXAssistantTools","DS/DMUPlayMeasure/DMUMeasure","DS/DMUMeasurable/DMUMeasureEnums","DS/Visualization/ThreeJS_DS","DS/Visualization/PathElement","DS/LevelSelector/LevelSelector","DS/CoreEvents/Events","DS/WebappsUtils/WebappsUtils","DS/Mesh/Mesh","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/Mesh/MeshUtils","DS/DMUBaseExperience/DMUContextManager","DS/CATWebUXComponents/DMUCommandsManager","UWA/Core","UWA/Utils","DS/CATWebUXPreferences/CATWebUXPreferencesManager","DS/CATWebUXSelectionManager/CATWebUXSelectionManager","DS/DMUMeasurable/DMUPreVisuNode3D","DS/Selection/CSOManager","DS/DMUBaseExperience/EXPControllerEvents","DS/DMUMeasurable/DMUSwitchRepService","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/DMUBaseUIControllers/DMUWebPreferencesController","DS/DMUBaseUIServices/DMUObjectsServices","DS/DMUMeasurable/DMUToolsMeasure","DS/Selection/HSOManager","DS/Selection/PSOManager","i18n!DS/DMUMeasure/assets/nls/DMUMeasure"],function(e,t,a,i,r,s,n,l,o,u,c,d,m,p,_,h,M,y,v,g,D,f,b,S,C,P,T,A,U,I,E,R,w,k,L,x){"use strict";var H,N;return e.extend({init:function(e,t,i){this._parent(e,t,i);let r=e.args?e.args:void 0;if(r){let t=Object.keys(r),a=Object.values(r);this._arguments=[];for(let e=0;e<t.length-1;e++)this._arguments.push({ID:t[e],Value:a[e]});this._isRunning=!1,e.args._pathElementAgentWithCSO&&(this._pathElementAgentWithCSO=e.args._pathElementAgentWithCSO),e.args._pathElementAgentWithoutCSO&&(this._pathElementAgentWithoutCSO=e.args._pathElementAgentWithoutCSO)}this._bEnablePrevisualization=!0,this._keepDefaultController=!0,this._notPickableList=[],this._removePreviousNonPersistent=!0,this._objAction=!1,this._bPOISelection=!1,"ProgressiveVisuLoading"===this._arguments[0].ID&&(this._measureCommandMode="ProgressiveVisuLoading"),"3dPlayProPointPoint"!==this._arguments[0].ID&&"3dPlay"!==this._arguments[0].ID||(this._measureCommandMode="3dPlay"),this._arguments[1]&&"RemoveNonPersistent"===this._arguments[1].ID&&"false"===this._arguments[1].Value&&(this._removePreviousNonPersistent=!1),this._defaultDistanceTypes=[{key:"PointPoint",value:"Distance"},{key:"PointLine",value:"MinimumDistance"},{key:"PointCurve",value:"MinimumDistance"},{key:"PointArc",value:"MinimumDistance"},{key:"PointCircle",value:"Distance"},{key:"PointPlane",value:"Distance"},{key:"PointCylinder",value:"Distance"},{key:"PointCone",value:"Distance"},{key:"PointSphere",value:"Distance"},{key:"PointSurface",value:"MinimumDistance"},{key:"PointProduct",value:"MinimumDistance"},{key:"LineLine",value:"Angle"},{key:"LineLineParallel",value:"Distance"},{key:"LineCurve",value:"MinimumDistance"},{key:"LineArc",value:"MinimumDistance"},{key:"LineCircle",value:"Distance"},{key:"LinePlane",value:"Angle"},{key:"LinePlaneNormalPerpendicular",value:"Distance"},{key:"LineCylinder",value:"Angle"},{key:"LineCylinderParallel",value:"Distance"},{key:"LineCone",value:"Angle"},{key:"LineConeParallel",value:"Distance"},{key:"LineSphere",value:"Distance"},{key:"LineSurface",value:"MinimumDistance"},{key:"LineProduct",value:"MinimumDistance"},{key:"CurveCurve",value:"MinimumDistance"},{key:"CurveArc",value:"MinimumDistance"},{key:"CurveCircle",value:"Distance"},{key:"CurvePlane",value:"MinimumDistance"},{key:"CurveCylinder",value:"Distance"},{key:"CurveCone",value:"Distance"},{key:"CurveSphere",value:"Distance"},{key:"CurveSurface",value:"MinimumDistance"},{key:"CurveProduct",value:"MinimumDistance"},{key:"ArcArc",value:"MinimumDistance"},{key:"ArcCircle",value:"MinimumDistance"},{key:"ArcPlane",value:"MinimumDistance"},{key:"ArcCylinder",value:"MinimumDistance"},{key:"ArcCone",value:"MinimumDistance"},{key:"ArcSphere",value:"MinimumDistance"},{key:"ArcSurface",value:"MinimumDistance"},{key:"ArcProduct",value:"MinimumDistance"},{key:"CircleCircle",value:"Distance"},{key:"CirclePlane",value:"Distance"},{key:"CircleCylinder",value:"Distance"},{key:"CircleCone",value:"Distance"},{key:"CircleSphere",value:"Distance"},{key:"CircleSurface",value:"Distance"},{key:"CircleProduct",value:"Distance"},{key:"PlanePlane",value:"Angle"},{key:"PlanePlaneParallel",value:"Distance"},{key:"PlaneCylinder",value:"Angle"},{key:"PlaneCone",value:"Angle"},{key:"PlaneCylinderParallel",value:"Distance"},{key:"PlaneConeParallel",value:"Distance"},{key:"PlaneSphere",value:"MinimumDistance"},{key:"PlaneSurface",value:"MinimumDistance"},{key:"PlaneProduct",value:"MinimumDistance"},{key:"CylinderCylinder",value:"Angle"},{key:"CylinderCylinderParallel",value:"Distance"},{key:"CylinderCone",value:"Angle"},{key:"CylinderConeParallel",value:"Distance"},{key:"CylinderSphere",value:"Distance"},{key:"CylinderSurface",value:"Distance"},{key:"CylinderProduct",value:"MinimumDistance"},{key:"ConeCone",value:"Angle"},{key:"ConeConeParallel",value:"Distance"},{key:"ConeSphere",value:"Distance"},{key:"ConeSurface",value:"Distance"},{key:"ConeProduct",value:"MinimumDistance"},{key:"SphereSphere",value:"Distance"},{key:"SphereSurface",value:"Distance"},{key:"SphereProduct",value:"Distance"},{key:"SurfaceSurface",value:"MinimumDistance"},{key:"SurfaceProduct",value:"MinimumDistance"},{key:"ProductProduct",value:"MinimumDistance"}];var s=this;s._switchRepInfo={clearTimeout:void 0,lockedNodeIds:[]},s._unlockNodes=function(){s._switchService&&s._switchRepInfo&s._switchRepInfo.lockedNodeIds&&s._switchRepInfo.lockedNodeIds.length&&(s._switchService.unlockNodes({nodeIDsToUnlock:s._switchRepInfo.lockedNodeIds,nodeIDsToUnlockMeshInRAM:s._switchRepInfo.lockedNodeIds}),s._switchRepInfo.lockedNodeIds=[])},s._iconDir=h.getWebappsAssetUrl("DMUMeasure","icons/32/"),!s._bEnablePrevisualization&&a.isEnvActivated("measurepreview",!0)&&(s._bEnablePrevisualization=!0);var n={};""!==window.location.search&&(f.extend(n,b.parseQuery(window.location.search)),n.widgetDomain&&f.extend(n,b.parseQuery(n.widgetDomain))),"MPVLOD"in n&&(s._mPVLOD=!0),g.setAuthoringFeatureTypes("Measure");require(["DS/PADUtils/PADSettingsMgt","DS/PADUtils/views/PADAlert"],function(e,t){H=e,N=t}),this._initPref(),this._partialMeasureDisplay=[null,null],this._firstSelectionLeafNodes=[],this._secondSelectionLeafNodes=[]},_destroy:function(){this._filterUI&&this._filterUI.clear(),this._eventController&&(this.CBTokenMeasureDelete&&this._eventController.removeEvent(this.CBTokenMeasureDelete),this.CBTokenSlideChanged&&this._eventController.removeEvent(this.CBTokenSlideChanged),this._eventController.fireEvent("onUnsetPickThroughRequest"),this._eventController=null),this._parent()},_initPref:function(){localStorage.getItem("DMUMeasureCircleRadiusPreferences")||localStorage.setItem("DMUMeasureCircleRadiusPreferences","DisplayDiameter"),localStorage.getItem("DMUMeasureRadiusResultDisplayPreferences")||localStorage.setItem("DMUMeasureRadiusResultDisplayPreferences","CENTER"),localStorage.getItem("DMUMeasure3PointsCircleRadiusResultDisplayPreferences")||localStorage.setItem("DMUMeasure3PointsCircleRadiusResultDisplayPreferences","CENTER"),localStorage.getItem("DMUMeasureArcRadiusPreferences")||localStorage.setItem("DMUMeasureArcRadiusPreferences","DisplayRadius");for(var e=0;e<this._defaultDistanceTypes.length;e++)if(!localStorage.getItem("DMUMeasureDistanceType"+this._defaultDistanceTypes[e].key+"Preferences")){var t=this._defaultDistanceTypes[e].value;localStorage.setItem("DMUMeasureDistanceType"+this._defaultDistanceTypes[e].key+"Preferences",t)}localStorage.getItem("DMUMeasProductDisplayPref")||localStorage.setItem("DMUMeasProductDisplayPref","Volume"),localStorage.getItem("DMUMeasSurfaceDisplayCylinderPref")||localStorage.setItem("DMUMeasSurfaceDisplayCylinderPref","Diameter"),localStorage.getItem("DMUMeasSurfaceDisplayConePref")||localStorage.setItem("DMUMeasSurfaceDisplayConePref","HalfAngle"),localStorage.getItem("DMUMeasSurfaceDisplaySpherePref")||localStorage.setItem("DMUMeasSurfaceDisplaySpherePref","Diameter"),localStorage.getItem("DMUMeasure3PointsDisplayPreferences")||localStorage.setItem("DMUMeasure3PointsDisplayPreferences","AngleBy3Points")},_addChild:function(e,t){t.setPickParent(!0),t.setVisibilityInTree(!1),e.addChild(t)},begin:function(){if(!this._isRunning){var e=D.getCommand(D.getCurrentCmdId(this._ctx),this._ctx),t=e&&e.getRequestedCommandMode?e.getRequestedCommandMode({cmd:"Measure"}):"exclusive";this._mode="shared"===t?"shared":"exclusive"}this._parent.apply(this,arguments)},setCommandMode:function(e){this._measureCommandMode=void 0,"PickingPointOnly"===e?this._measureCommandMode="3dAuthoringPickPoint":"ProgressiveVisuLoading"===e&&(this._measureCommandMode="ProgressiveVisuLoading"),this._filterUI&&(this._filterUI.clear(),this._filterUI=null)},removeMeasureFromSession:function(e){var t=g.getReviewContext({viewer:this.getFrameWindow().getViewer()});if(t){t.getTransientReviewBag().removeDMUObjects([e]);var a=this.getMeasureContainer();a&&a.getCurrentSlide&&a.getCurrentSlide()&&a.getCurrentSlide().removeDMUObject(e);for(var i=this._createdMeasures.length-1;i>=0;i--)this._createdMeasures[i]===e&&this._createdMeasures.splice(i,1);this._viewer.render()}},_beginExecute:async function(){var e=this;e._switchService||(e._switchService=new U({viewer:e._viewer})),e._count=0,e._interval=null,this.getMeasureContainer=function(){var t=g.getReviewContext({viewer:e.getFrameWindow().getViewer()});if(!t)return;var a=t.getCurrentSessionMarkup();let i=!0;if(a){let e=t.getRestrictions(a);e.markup&&void 0!==e.markup.canEdit&&(i=e.markup.canEdit)}return a&&a.getActiveFlag()&&a.isVisible()&&!a.isReadOnly()&&i&&a.getCurrentSlide()?a:t.getTransientReviewBag()};var t=C.giveSelectionManager({context:g.getContextViewer({viewer:e.getFrameWindow().getViewer()})});t&&t.setActiveState(!1),this._eventController||(this._eventController=g.giveEventsController({viewer:this.getFrameWindow().getViewer()})),this._eventController&&this._eventController.fireEvent("onSetPickThroughtRequest"),this._viewer.currentViewpoint.setDefaultController(!1,"FLY_WALK"),this._bKeepall=!0,this._createdMeasures=[],this._preferences=[],this._treatPrevisualize=!0;var i=g.getContextViewer({viewer:this.getFrameWindow().getViewer()});i.getController&&(this._viewerController=i.getController());var l=!1;"3dPlay"!==this._measureCommandMode&&(l=!0),this._pathElementAgentWithCSO=new s({agentId:"_pathElementAgentWithCSO",viewer:this._viewer,engWithPSOHSO:!0,multiAcquisition:!1,multiAcquisitionCtrl:!1,pickingMode:"primHybrid",prePickingMode:"primHybrid",valuedFromCSO:!0,saveToCSO:!1,activatePrePicking:!0,acceptedGeometries:[],appli:this,checkAppli:this._checkPicking,displayAppli:this._bEnablePrevisualization?this._previsualize:void 0,switchRepOnPreSelection:l,viewerController:this._viewerController}),this._pathElementAgentWithoutCSO=new s({agentId:"_pathElementAgentWithoutCSO",viewer:this._viewer,engWithPSOHSO:!0,multiAcquisition:!1,multiAcquisitionCtrl:!1,pickingMode:"primHybrid",prePickingMode:"primHybrid",valuedFromCSO:!1,saveToCSO:!1,activatePrePicking:!0,acceptedGeometries:[],appli:this,checkAppli:this._checkPicking,displayAppli:this._bEnablePrevisualization?this._previsualize:void 0,switchRepOnPreSelection:l,viewerController:this._viewerController}),"ontouchstart"in window&&this._viewer.setMagnifier({activated:!0,dim:83,shiftVector:{x:-50,y:120}}),this._measurable=[],this._measure=null,this._repeatType="None",this._lockedNodes=[],this._lockedMeshInRAM=[],this._overrideSet=null;var o=T.get(),u=!1;if("3dPlay"===this._measureCommandMode)u=!0,o.length>2&&(this.emptyCSO(),this.emptyHSO());else for(var c=o.length-1;c>=0;c--)if(o[c].pathElement.getLastElement().getDMUType)T.remove(o[c]),u=!0;else if("2D"===this._measureOnGeometryType&&c>0&&o[c].pathElement&&o[0].pathElement){var d=o[0].pathElement.externalPath,m=o[c].pathElement.externalPath;if(d&&m&&d.length>2&&m.length>2)if(d[d.length-2]!==m[m.length-2]){this.emptyCSO(),this.emptyHSO(),u=!0;break}}else{var p,_,h=[];if(this._switchService||(this._switchService=new U({viewer:this._viewer})),this._switchService.retriveNodesFromPath(o[c].pathElement,h),_=o[c].pathElement.getLastElement().sgNode,h&&h.length){for(var y=!1,v=0;v<h.length;v++)if(p=h[v],o[c].pathElement&&o[c].pathElement.getLastElement)if(_&&r.getNodeType(p)&&"cgr"!==this._viewerController.getLoadedStream(p))T.remove(o[c]),u=!0;else if(!_&&null!==this._viewerController.getLoadedStream(p)){y=!0;break}_||y||(T.remove(o[c]),u=!0)}}u&&(o=T.get()),o.length>0?this._objAction=!0:this.asyncReadPref(this),"3dAuthoringPickPoint"===this._measureCommandMode&&(this._activeFilter="pointOnly"),this._previousLinePickingMode=this._viewer.renderer.renderer.pickLinesMode,this._previousPointPickingMode=this._viewer.renderer.renderer.pickPointsMode,this._previousForcePickingPoints=this._viewer.renderer.renderer.pickPointsMode,this._viewer.setLinePickingMode(M.PICK_ALWAYS),this._viewer.setPointPickingMode(M.PICK_ALWAYS),this._viewer.setForcePickingPoints(!0),this._viewer.render({onlyPostProcess:!1}),a._sendUsageProbe("command","Measure");var D=S?S.givePreferenceManager({context:e.getFrameWindow()}):null;D&&(e._prefSubscribe=D.subscribe("com.ds.mep:onPrefUpdate",function(t){for(var a=JSON.parse(t[1].preferences).repositories[0],i=0;i<a.preferences.length;i++){let t=a.preferences[i].name;var r=e._preferences.findIndex(e=>e.name===t);-1!==r&&(e._preferences[r].value=a.preferences[i].value)}})),this._parent();var f=g.getReviewContext({viewer:this.getFrameWindow().getViewer()});if(f||(i=g.getContextViewer({viewer:this.getFrameWindow().getViewer()}),await n.createReviewContext({context:i})),f=g.getReviewContext({viewer:e.getFrameWindow().getViewer()})){var b=E.readPreferences({name:"MeasureRepository",PreferenceNames:["DMUMeasureRemovePreviousNonPersistent"]});b&&b.preferences&&b.preferences.length>0&&"true"===b.preferences[0].value&&f.getTransientReviewBag().removeDMUObjects("DMUMeasure")}},pauseExecute:function(){this._filterUI&&this._filterUI.setVisibleFlag(!1),this._preVisuNode&&this._removePreVisuNode(),this._eventController&&this._eventController.fireEvent("onUnsetPickThroughRequest"),this.done()},resumeExecute:function(){this._filterUI&&this._filterUI.setVisibleFlag(!0),this._eventController&&this._eventController.fireEvent("onSetPickThroughtRequest")},cancelExecute:function(){this._endExecute()},_endExecute:function(e){var t=this;this._eventController&&(this._eventController.fireEvent("onUnsetPickThroughRequest"),t.CBTokenMeasureDelete&&t._eventController.removeEvent(t.CBTokenMeasureDelete),t.CBTokenSlideChanged&&t._eventController.removeEvent(t.CBTokenSlideChanged)),t._count=0,t._interval&&(clearInterval(t._interval),t._interval=null);var a=S?S.givePreferenceManager({context:this.getFrameWindow()}):null;if(a&&t._prefSubscribe&&a.unsubscribe(t._prefSubscribe),t._preVisuNode&&t._removePreVisuNode(),t.cleanNotify(),t._treatPrevisualize=!0,t._lockedMeshInRAM){for(var i=0;i<t._lockedMeshInRAM.length;i++)this._viewerController.unlockRepresentationMeshInRAM(t._lockedMeshInRAM[i]);t._lockedMeshInRAM=[]}if(t._lockedNodes&&(this._viewerController.unlockNodes({ids:t._lockedNodes}),t._lockedNodes=[]),t._undisplayPartialLevel(),t.emptyHSO(),t._parent(),t._pathElementAgentWithCSO=null,t._pathElementAgentWithoutCSO=null,t._measurable=null,t._firstSelectionLeafNodes=[],t._secondSelectionLeafNodes=[],"true"===t._bVisibleMagnifier&&t._viewer.setMagnifier({activated:!1}),this._objAction=!1,t._filterUI&&t._filterUI.setVisibleFlag(!1),t._removeAssistantTools(),t._cleanLevelSelector(),t._measure)if(t._measure._bPrevisualized?(t.removeMeasureFromSession(t._measure),t._measure=t._lastMeasure,t._lastMeasure=null):t._bEnablePrevisualization&&t._unprevisualize(),t._measure&&t._measure.isPartialMeasure()&&t._measure.setPartialMeasure("partial"),"3dPlay"!==t._measureCommandMode&&"Geovia"!==t._arguments[0].ID||"MeasureBetween"===t._measure.getAttribute("sType"))if(t._isCanceled){var r=t.getMeasureContainer();r.getDMUObjects&&r.getDMUObjects("DMUMeasure")&&t._createdMeasures&&r.removeDMUObjects(t._createdMeasures)}else{t._measure.setInEdition(!1),g.getReviewContext({viewer:t.getFrameWindow().getViewer()})&&setTimeout(function(){if(t._measure&&t._measure.getNode()){if(t._createdMeasures&&t._createdMeasures.length){for(var e=0;e<t._createdMeasures.length;e++)t._createdMeasures[e].fireEvent("onDMUObjectInitialized",{dmuObject:t._createdMeasures[e]}),t._createdMeasures[e]._isInCreationState&&(t._createdMeasures[e]._isInCreationState=!1),t._createdMeasures[e]&&t._createdMeasures[e]._assistantTool&&(t._createdMeasures[e]._assistantTool=null);t._createdMeasures=null}t._measure._isInCreationState&&(t._measure._isInCreationState=!1),t._measure&&t._measure._assistantTool&&(t._measure._assistantTool=null),t.addInCSO(t._measure),t._measure=null}},10)}else t.removeMeasureFromSession(t._measure),t._measure=null;else if("Multiple"===t._repeatType&&t._isCanceled){var s=t.getMeasureContainer();s.getDMUObjects&&s.getDMUObjects("DMUMeasure")&&t._createdMeasures&&s.removeDMUObjects(t._createdMeasures)}else if(!t._isCanceled&&t._createdMeasures&&t._createdMeasures.length){for(var n=0;n<t._createdMeasures.length;n++)t._createdMeasures[n].fireEvent("onDMUObjectInitialized",{dmuObject:t._createdMeasures[n]}),t._createdMeasures[n]._isInCreationState&&(t._createdMeasures[n]._isInCreationState=!1),t._createdMeasures[n]&&t._createdMeasures[n]._assistantTool&&(t._createdMeasures[n]._assistantTool=null);t._createdMeasures=null}for(var l=0;l<t._notPickableList.length;l++){var o=t._notPickableList[l];o&&o.getNode()&&t._notPickableList[l].getNode().setPickable(v.PICKABLE)}t._viewer.setLinePickingMode(t._previousLinePickingMode),t._viewer.setPointPickingMode(t._previousPointPickingMode),t._viewer.setForcePickingPoints(t._previousForcePickingPoints),t._viewer.render({onlyPostProcess:!1});var u=C.giveSelectionManager({context:g.getContextViewer({viewer:t.getFrameWindow().getViewer()})});u&&u.setActiveState(!0),t._measure&&t._measure._isInCreationState&&(t._measure._isInCreationState=!1),t._measure&&t._measure._assistantTool&&(t._measure._assistantTool=null),t._viewer.currentViewpoint.setDefaultController(!0,"FLY_WALK"),this.restoreDefaultController(),e&&e()},buildGraph:function(){this.changeDefaultController(),this._beginExecute();var e=this.createInitialState("initialState");this.setEnterStateAction(e,this._enterInitialCallback),this.setExitStateAction(e,this._exitInitialCallback);var t=this.getFinalState(),a=this.createState("itemState");this.setEnterStateAction(a,this._enterItemCallback),this.setExitStateAction(a,this._exitItemCallback);var i=this.createState("repeatitemState");this.setEnterStateAction(i,this._enterInitialCallback),this.setExitStateAction(i,this._exitInitialCallback);var r=this.createState("betweenState");this.setEnterStateAction(r,this._enterBetweenCallback),this.setExitStateAction(r,this._exitBetweenCallback);var s=this.createState("repeatbetweenState");this.setEnterStateAction(s,this._enterItemCallback),this.setExitStateAction(s,this._exitItemCallback);var n=this.createState("repeatMultipleMeasBetweenState");this.setEnterStateAction(n,this._enterItemCallback),this.setExitStateAction(n,this._exitItemCallback);var l=this.createState("repeatMultipleMeasItemState");this.setEnterStateAction(l,this._enterItemCallback),this.setExitStateAction(l,this._exitItemCallback);var o=this.createState("threepointsState");this.setEnterStateAction(o,this._enterThreepointsCallback),this.setExitStateAction(o,this._exitThreepointsCallback);var u=this._pathElementAgentWithCSO.cso,c=u._items.length;if(c>1&&this._objAction){var d=!1;if(3===c)for(var m=0;m<c;m++)if(u._items[m].pathElement.getLastElement().sgNode){if(0!==u._items[m].pathElement.getLastElement().sgNode.container.glType){d=!1;break}d=!0}if(d){var p={iEvent:this._pathElementAgentWithCSO,iInitialState:e,iFinalState:t,iAction:function(e,t){this._computeThreepointsCallback(e,t,!0)}};this.addTransition(p)}else if(2===c){var _={iEvent:this._pathElementAgentWithCSO,iInitialState:e,iFinalState:"3dPlay"===this._measureCommandMode?t:r,iAction:function(e,t){let a=!1;a="3dPlay"===this._measureCommandMode,this._computeBetweenCallback(e,t,a)}};this.addTransition(_)}else{var h={iEvent:this._pathElementAgentWithCSO,iInitialState:e,iFinalState:s,iAction:this._computeBetweenCallback};this.addTransition(h)}}var M={iEvent:this._pathElementAgentWithCSO,iInitialState:e,iFinalState:a,iAction:this._computeItemCallback};this.addTransition(M);var y={iSender:this,iEvent:"failure",iInitialState:e,iFinalState:t,iAction:this._endExecute};if(this.addTransition(y),"3dPlay"===this._measureCommandMode||"Geovia"===this._arguments[0].ID){var v={iEvent:this._pathElementAgentWithoutCSO,iInitialState:a,iFinalState:t,iAction:function(e,t){this._computeBetweenCallback(e,t,!0)}};this.addTransition(v)}else if("Thickness"!==this._arguments[0].ID){var D={iEvent:this._pathElementAgentWithoutCSO,iInitialState:a,iFinalState:r,iAction:this._computeBetweenCallback,iCondition:this._checkForSelection};this.addTransition(D);var f={iEvent:this._pathElementAgentWithoutCSO,iInitialState:l,iFinalState:n,iAction:this._computeItemCallback,iCondition:this._checkForSelection};this.addTransition(f);var b={iEvent:this._pathElementAgentWithoutCSO,iInitialState:n,iFinalState:l,iAction:this._computeBetweenCallback,iCondition:this._checkForSelection};this.addTransition(b)}var S={iSender:this,iEvent:"OK",iInitialState:l,iFinalState:t,iAction:this._endExecute};this.addTransition(S),this.addEmptySelectionTransition(l,t,this._endExecute);var C={iSender:this,iEvent:"failure",iInitialState:l,iFinalState:t,iAction:this._endExecute};this.addTransition(C);var P={iSender:this,iEvent:"OK",iInitialState:n,iFinalState:t,iAction:this._endExecute};this.addTransition(P),this.addEmptySelectionTransition(n,t,this._endExecute);var T={iSender:this,iEvent:"failure",iInitialState:n,iFinalState:t,iAction:this._endExecute};this.addTransition(T);var A={iSender:this,iEvent:"OK",iInitialState:a,iFinalState:t,iAction:this._endExecute};this.addTransition(A);var U={iSender:this,iEvent:"failure",iInitialState:a,iFinalState:t,iAction:this._endExecute};this.addTransition(U),"3dPlay"!==this._measureCommandMode&&"Geovia"!==this._arguments[0].ID&&this.addEmptySelectionTransition(a,t,this._endExecute);var I={iSender:this,iEvent:"repeatitem",iInitialState:a,iFinalState:i};this.addTransition(I);var E={iSender:this,iEvent:"OK",iInitialState:r,iFinalState:t,iAction:this._endExecute};this.addTransition(E);var R={iSender:this,iEvent:"failure",iInitialState:r,iFinalState:t,iAction:this._endExecute};this.addTransition(R),this.addEmptySelectionTransition(r,t,this._endExecute);var w={iSender:this,iEvent:"repeatbetween",iInitialState:r,iFinalState:s};this.addTransition(w);var k={iSender:this,iEvent:"repeatbetweenMultiple",iInitialState:r,iFinalState:l};this.addTransition(k);var L={iSender:this,iEvent:"threepoints",iInitialState:r,iFinalState:o};this.addTransition(L);var x={iEvent:this._pathElementAgentWithoutCSO,iInitialState:i,iFinalState:i,iAction:this._computeItemCallback};this.addTransition(x);var H={iSender:this,iEvent:"OK",iInitialState:i,iFinalState:t,iAction:this._endExecute};this.addTransition(H),this.addEmptySelectionTransition(i,t,this._endExecute);var N={iEvent:this._pathElementAgentWithoutCSO,iInitialState:s,iFinalState:s,iAction:this._computeBetweenCallback,iCondition:this._checkForSelection};this.addTransition(N);var F={iSender:this,iEvent:"OK",iInitialState:s,iFinalState:t,iAction:this._endExecute};this.addTransition(F),this.addEmptySelectionTransition(s,t,this._endExecute);var O={iEvent:this._pathElementAgentWithoutCSO,iInitialState:o,iFinalState:o,iAction:this._computeThreepointsCallback};this.addTransition(O);var V={iSender:this,iEvent:"OK",iInitialState:o,iFinalState:t,iAction:this._endExecute};this.addTransition(V),this.addEmptySelectionTransition(o,t,this._endExecute);var G=this;this._eventController||(this._eventController=g.getEventsController({viewer:this._viewer})),this._eventController&&(this.CBTokenMeasureDelete=G._eventController.addEvent("onMeasureDeleteWhileActiveCmd",()=>{G._eventController&&!G.isPaused()&&(G._eventController.removeEvent(G.CBTokenMeasureDelete),G.CBTokenMeasureDelete=null,G._repeatType&&"None"===G._repeatType&&this.cancel())}),this.CBTokenSlideChanged=G._eventController.addEvent("onSlideChanged",()=>{G._eventController&&!G.isPaused()&&(G._measure||G._createdMeasures&&G._createdMeasures.length)&&(G._eventController.removeEvent(G.CBTokenSlideChanged),G.CBTokenSlideChanged=null,this.cancel())}))},_checkPicking:function(e,t){var a=!1;return void 0!==e&&(a=t._isItMeasurable(e)),a},_createMeasurables:function(e){if(e||e.data||e.data.length)for(var t=0;t<e.data.length;t++){var a;if(e.data[t]&&e.data[t].pathElement){if(e.data[t].pathElement.getLastElement().sgNode)a=new l({primitive:e.data[t].pathElement.getLastElement().sgNode,pathElement:e.data[t].pathElement,selpoint:e.data[t].position,selnormal:e.data[t].normal});else{var s=this.managePOISelection(e.data[t]);a=new l({canonic:{type:r.isOOCTileSetNodeInPath(e.data[t].pathElement)?i.GeometryType.PICKINGPT:s?i.GeometryType.POINT:i.GeometryType.PRODUCT,position:e.data[t].position},pathElement:e.data[t].pathElement,selpoint:e.data[t].position,selnormal:e.data[t].normal,isApprox:s,bIsPOISelection:s})}a&&(this._measurable[t]=a)}}},_treatSelection:function(e){var t,a=this,s=e&&e.data&&e.data.length?e.data[0]:null;if(s&&s.pathElement){var n=e.callback,o=s.pathElement.getLastElement().sgNode;if(void 0!==o&&function(){var e=!0;if(null!==a._getViewerLoadingMode()){var t=r.getLastRepReference(s.pathElement);if(t){var i=t.getLastElement();r.getNodeType(i)&&"cgr"!==a._viewerController.getLoadedStream(i)&&(e=!1)}}return e}()||e.load&&this._objAction)void 0!==o?this._objAction?(a._createMeasurables(e),a._measurable&&(t=a._measurable[0])):t=new l({primitive:o,pathElement:s.pathElement,selpoint:s.position,selnormal:s.normal,rayDir:s.ray&&s.ray.direction?s.ray.direction:void 0,bIsPOISelection:a._bPOISelection}):this._objAction&&(a._createMeasurables(e),a._measurable&&(t=a._measurable[0])),n&&n(t);else{var u=!1,c=!1;if("ProgressiveVisuLoading"===this._measureCommandMode||this._mPVLOD||null!==this._getViewerLoadingMode()){if(u=r.isOOCTileSetNodeInPath(s.pathElement),c=a.managePOISelection(s),!0!==e.load||u||c)if(s.position){var m=s.position.clone();if(s.pathElement.getWorldMatrix()){var p=(new d.Matrix4).getInverse(s.pathElement.getWorldMatrix());m=m.applyMatrix4(p);var _=i.GeometryType.POINT;"productOnly"===a._activeFilter&&(_=i.GeometryType.PRODUCT),r.isOOCTileSetNodeInPath(s.pathElement)&&(_=i.GeometryType.PICKINGPT),c&&(_=i.GeometryType.POINT),t=new l({canonic:{type:_,position:m},pathElement:s.pathElement,selpoint:s.position,selnormal:s.normal,isApprox:u||c,bIsPOISelection:c})}n&&a._viewerController&&n(t)}else n&&n();else if(this._viewerController){var h=[],M=[],y=null,v=r.getLastRepReference(s.pathElement);if(v&&0===v.externalPath.length||!v){y=r.getLastReference(s.pathElement).getLastElement();var g=function(e){if(e)if(r.isRepReference(e))M.push(e);else{var t=[];(t=e.getChildren()).length>0&&t.forEach(function(e){g(e)})}};g(y)}else{y=r.getLastReference(s.pathElement).getLastElement();var D=v.getLastElement();M.push(D)}M.forEach(function(e){h.push({node:e,stream:"cgr"})});var f=s.mousePos;!f&&s.eventDatas&&s.eventDatas.event&&(f=a._viewer.getMousePosition(s.eventDatas.event.getCurrentPosition(a._viewer.canvas))),this._switchNodeVisu({nodes_cgr:M,onComplete:function(e){var t=function(){var e,t,i;if(f){var r=a._viewer.pick(f,"primHybrid",!0);r&&r.path&&r.path.length>0&&(e=r.path[0],t=r.normal,i=r.position)}else{var l=a._viewer.castRay(s.ray,y,"prim");l&&l.length>0&&(e=l[0].pathElement,t=l[0].normal,i=l[0].point)}var o=!1;if(e&&(o=a._pathElementAgentWithCSO._filter(e)),!0===o){var u=[{pathElement:e,normal:t,position:i}];a._treatSelection({data:u,load:!1,callback:n})}else if("pointOnly"===a._activeFilter||"productOnly"===a._activeFilter){var c=[];c.push(s),a._treatSelection({data:c,load:!1,callback:n})}},i=[];M.forEach(function(e){i.push(r.getNodeID(e))}),0===a._firstSelectionLeafNodes.length?a._firstSelectionLeafNodes=i.slice():0===a._secondSelectionLeafNodes.length&&(a._secondSelectionLeafNodes=i.slice()),e?a._viewerController.refreshGeometry({ids:i,noMeshInRAM:!1,onComplete:function(){t()},onFailure:function(){if("pointOnly"===a._activeFilter){var e=[];e.push(s),a._treatSelection({data:e,load:!1,callback:n})}}}):t()},onFailure:function(e){if("fullMemory"===e){var t=x.notifyFullMemoryFailure;a._measurable&&a._measurable[0]&&(a._measurable[1]?a._measurable[2]||(t=x.notifyMeasureFailure):t=x.notifyMinDistanceFullMemoryFailure),N&&N.displayNotification({eventID:"error",msg:t}),a.publish({event:"failure",data:null})}else if("pointOnly"===a._activeFilter){var i=[];i.push(s),a._treatSelection({data:i,load:!1,callback:n})}}})}}else{var b=s.position.clone(),S=i.GeometryType.POINT;"productOnly"===a._activeFilter&&(S=i.GeometryType.PRODUCT),(u=r.isOOCTileSetNodeInPath(s.pathElement))?S=i.GeometryType.PICKINGPT:(c=a.managePOISelection(s))&&(S=i.GeometryType.POINT),t=new l({canonic:{type:S,position:b},pathElement:s.pathElement,selpoint:s.position,selnormal:s.normal,isApprox:u||c,bIsPOISelection:c}),n&&n(t)}}}},_selectBestType:function(e,t){var a,i=e.retrievePossibleSelectedType(t);if(this._objAction)a="3dPlay"===e._measureCommandMode?c.ViewedType.POINT:i[0];else if("pointOnly"===e._activeFilter)a=c.ViewedType.POINT;else if("productOnly"===e._activeFilter)a=c.ViewedType.PRODUCT;else{a=i[0];for(var r=!1,s=i.length,n=0;!r&&n<s;n++)for(var l=e._filteredGeometries?e._filteredGeometries.viewedGeometries.length:0,o=0;!r&&o<l;o++)e._filteredGeometries.viewedGeometries[o]===i[n]&&(a=i[n],r=!0)}return a},_removePreVisuNode:function(){this._preVisuNode&&(r.getSceneRoot(this._viewer).remove(this._preVisuNode),this._viewer.render(),this._preVisuNode.removeChildren(),this._preVisuNode.remove(),this._preVisuNode=void 0)},_preVisualizeMeasure:function(e,t){var a=this;e&&e.pathElement?t._treatSelection({data:[e],load:!1,callback:function(e){if(e){var i=t._selectBestType(t,e);e.resultType=t.retrieveItemResultType(e.getType(),i),e.drawMode="Measure","2D"===a._measureOnGeometryType&&(e.scale2D=1),a._preVisuNode?a._preVisuNode.buildPreVisuNode({data:e}):(a._preVisuNode=new P(a._viewer),a._preVisuNode.buildPreVisuNode({data:e}),a._preVisuNode.setNoZ(!0),a._preVisuNode.setPickable(v.PICKTHROUGH),a._viewer&&(r.getSceneRoot(a._viewer).add(a._preVisuNode),a._viewer.render())),a._preVisuNode.setVisibility(a._viewer.getVisibleSpace())}return!0}}):a._preVisuNode&&a._removePreVisuNode()},_previsualize:function(e,t){if(t._bPOISelection=!1,"Thickness"!==t._arguments[0].ID)return t._preVisualizeMeasure(e,t);t._viewer&&(t._bPOISelection=t.managePOISelection(e));if(t._bStartPrevisualize&&(t._bStartPrevisualize=!1),t._measure)"initialState"!==t._stateId&&"repeatitemState"!==t._stateId||t._treatPrevisualize&&e.pathElement&&(t._treatPrevisualize=!1,t._treatSelection({data:[e],load:!0,callback:function(e){if(e){var a=t._selectBestType(t,e);if(t._measure.setMeasurable(1,e),t._measure.setAttribute("sSelectedType1",a),t._measure.setAttribute("sResultingType1",t.retrieveItemResultType(t._measure.getMeasurable(1).getType(),a)),t._measure.update(),"MeasureThickness"===t._measure._sType){var i=t._measure.getMeasurable(1),r=t._measure.getMeasurable(2);if(i&&r){var s=r.getPrimitive();if(s){for(var n=new m,l=[],o=THREEDS.SubElement.getFromSGNode(s);null!==o;)l.unshift(o),o=o.getParent();n.setFromArray(i.getPathElement().externalPath,l),t.addInHSO({path:n},!1)}}}t._measure.getNode()&&t._measure.getNode().setPickable(v.PICKTHROUGH),t._notPickableList.push(t._measure)}return t._treatPrevisualize=!0,!0}}));else{var a=function(){t._treatPrevisualize&&e.pathElement&&(t._treatPrevisualize=!1,t._treatSelection({data:[e],load:!0,callback:function(a){if(a){t._measurable[0]=a;var i=t._selectBestType(t,t._measurable[0]);"Thickness"===t._arguments[0].ID&&t._bPOISelection&&(e.ray.direction=a._selNormal,e.ray.origin=e.position),t._createMeasure(i),t._measure._bPrevisualized=!0,t._measure.getNode().update(!0,!0),t._measure.getNode().setPickable(v.PICKTHROUGH),t._notPickableList.push(t._measure)}return t._treatPrevisualize=!0,!0}}))};t._objAction||0!==t._preferences.length?(a(),t._interval&&(clearInterval(t._interval),t._interval=null)):t._interval||(t._interval=setInterval(function(){t._count++,t._count>60?(0===t._preferences.length&&(t._preferences=t.getDefaultPreference()),t._preferences.length>0&&a(),clearInterval(t._interval),t._interval=null):t._preferences.length>0&&(a(),clearInterval(t._interval),t._interval=null)},100))}},_unprevisualize:function(){"Thickness"===this._arguments[0].ID&&this._measure&&this._measure.getNode()&&this._measure.getNode().setPickable(v.PICKABLE)},_enterInitialCallback:function(){var e=x.notifyinitial;"2D"===this._measureOnGeometryType&&(e=x.notifyinitial2D),"3dPlay"===this._measureCommandMode||"Geovia"===this._arguments[0].ID?e=x.notifyinitialpt:"Thickness"===this._arguments[0].ID?e=x.notifythickness:"3dAuthoringPickPoint"===this._measureCommandMode&&(e=x.notifyinitialptauth),"Item"===this._repeatType&&(e=x.notifyrepeatitem,"3dPlay"!==this._measureCommandMode&&"Geovia"!==this._arguments[0].ID||(e=x.notifyrepeatitempt),this._createAssistantTools({bOK:"3dPlay"!==this._measureCommandMode&&"Geovia"!==this._arguments[0].ID,bKeeponlylast:"3dPlay"!==this._measureCommandMode&&"Geovia"!==this._arguments[0].ID}),"productOnly"===this._activeFilter&&"ProgressiveVisuLoading"!==this._measureCommandMode&&this._createLevelSelector(!0)),this.sendNotify("info",e),this._filterUI&&"3dPlay"!==this._measureCommandMode&&"Thickness"!==this._arguments[0].ID&&"Geovia"!==this._arguments[0].ID&&"3dAuthoringPickPoint"!==this._measureCommandMode&&this._filterUI.setVisibleFlag(!0),this._bStartPrevisualize=this._bEnablePrevisualization},_exitInitialCallback:function(){this.cleanNotify(),"Item"===this._repeatType&&(this._removeAssistantTools(),this._cleanLevelSelector()),this._filterUI&&this._filterUI.setVisibleFlag(!1)},_computeItemCallback:function(e,t){t&&t.length>0&&(this._bPOISelection=this.managePOISelection(t[0])),this._measure&&this._measure._bPrevisualized&&(this.removeMeasureFromSession(this._measure),this._measure=void 0),this._removePreVisuNode(),"Item"!==this._repeatType&&"Multiple"!==this._repeatType||this._measure&&(this._measure.setInEdition(!1),this._bKeepall||this.removeMeasureFromSession(this._measure),this._measure=void 0);var a=this,i=function(){a._treatSelection({data:t,load:!0,callback:function(i){if(i){a._measurable[0]=i;var s=a._selectBestType(a,a._measurable[0]);"Multiple"===a._repeatType&&(a._measurable[0]&&a._measurable[0].setTypeWithSelFilter&&a._measurable[0].setTypeWithSelFilter(s),a._measurable[1]&&a._measurable.splice(1,a._measurable.length-1)),"Geovia"===a._arguments[0].ID&&(a._measurable[0]=a._transformMeasureToPoint(a._measurable[0]));var n=[],l=[],o=!0,u=[],c=r.getLastRepReference(a._measurable[0].getPathElement());null!==c&&0!==c.getLength()||(c=r.getLastReference(i.getPathElement()));var d=!1;let D=i&&i.getPathElement()?i.getPathElement():t[0].pathElement;if("2D"!==a._measureOnGeometryType&&!r.isOOCTileSetNodeInPath(D)&&(d=!0,c&&c.getLastElement()&&c.getLastElement().getUserData)){let e=c.getLastElement().getUserData();e&&"DesignSight"===e.type&&(d=!1)}if(d&&c&&o)if("DynamicRep"===a._getViewerLoadingMode()){if(o=a._lockNodes(c.getLastElement(!0),n,a._measurable[0].getPathElement().getParentPath()),n.lentgh)for(var m=0;m<n.length;m++)l.push(r.getNodeID(n[m].getLastElement(!0)))}else"ProgressiveFull"!==a._getViewerLoadingMode()&&"ProgressiveLarge"!==a._getViewerLoadingMode()||(o=a._getNodesToSwitchInRAM(c.getLastElement(!0),[],u,l));var p=function(t){var i=function(){!a._measure&&t&&a._createMeasure(s),a._measure&&!o&&a._measure.setPartialMeasure("partialCmd"),a._lockNodeFromMeasurable(a._measurable[0]),!a._measure||"3dPlay"!==a._measureCommandMode&&"Geovia"!==a._arguments[0].ID||(a._measure.setAttribute("bCollapsedDisplay",!1),a._measure.isMeasureDisplayed()&&a._measure.refreshNode()),a._viewer.render(),a.assistantTools&&a._measure&&a.assistantTools.updatePosition(a._measure.getAttribute("vFirstExtensionPoint3D")),a._bStartPrevisualize=a._bEnablePrevisualization,e(),a.emptyHSO(),a._measurable&&a._addElementToHSO(a._measurable[0])};a._objAction||0!==a._preferences.length?(i(),a._interval&&(clearInterval(a._interval),a._interval=null)):a._interval||(a._interval=setInterval(function(){a._count++,a._count>60?(0===a._preferences.length&&(a._preferences=a.getDefaultPreference()),a._preferences.length>0&&i(),clearInterval(a._interval),a._interval=null):a._preferences.length>0&&(i(),clearInterval(a._interval),a._interval=null)},100))};if(o||"ProgressiveFull"!==a._getViewerLoadingMode()&&"ProgressiveLarge"!==a._getViewerLoadingMode()){var _=u.concat(l);if(_.length>0){var h=function(){for(var e=0;e<_.length;e++)-1===a._lockedMeshInRAM.indexOf(_[e])&&(a._viewerController.lockRepresentationMeshInRAM(_[e]),a._lockedMeshInRAM.push(_[e])),-1===a._lockedNodes.indexOf(_[e])&&(a._viewerController.lockNodes({ids:[_[e]]}),a._lockedNodes.push(_[e]))};if(0===u.length)h(),"Multiple"===a._repeatType?p(!1):p(!0);else{var M=0,y=g.getContextViewer({viewer:a.getFrameWindow().getViewer()}),v=y.subscribe({event:"onRepresentationLoaded"},function(e){-1!==u.indexOf(e)&&M++,M===u.length&&(y.unsubscribe(v),setTimeout("Multiple"===a._repeatType?p(!1):p(!0),0))});h()}}else"Multiple"===a._repeatType?p(!1):p(!0)}else p(!1)}}})};if(a._objAction){for(var s=[],n=0;n<t.length;n++){if(t[n].pathElement)if(!t[n].pathElement.getLastElement().sgNode){var l=[];a._switchService.retriveNodesFromPath(t[n].pathElement,l),l.forEach(function(e){e&&"thumbnail"===a._viewerController.getLoadedStream(e)&&s.push(e)})}}s.length?a._switchService.switchToAV1({nodes:s,lockNodesAfterSwitch:!0,lockMeshInRAMAfterSwitch:!0,onCompleteCB:function(e){a._switchRepInfo.clearTimeout=void 0;var t=e.nodeIDsOfLockedNodes;t&&t.length>0&&(a._switchRepInfo.lockedNodeIds||(a._switchRepInfo.lockedNodeIds=[]),t.forEach(function(e){-1===a._switchRepInfo.lockedNodeIds.indexOf(e)&&a._switchRepInfo.lockedNodeIds.push(e)})),i()},onFailureCB:function(){a._switchRepInfo.clearTimeout=void 0}}):i()}else i()},_createMeasure:function(e){var t=this,a=function(){var a=t.getMeasureContainer(),i=t._arguments[0].ID;t._measure=new u(t._viewer,a,i),r.setPickability(t._measure,!1),t._measure._preferences=t._preferences,t._measure._isInCreationState=!0,t._measure._assistantTool=null,t._createdMeasures.push(t._measure),"Thickness"===t._arguments[0].ID?(t._measure.setAttribute("sType","MeasureThickness"),t._measure.setAttribute("sName",a.computeNewName({object:t._measure,prefix:x.measurethicknessname}))):(t._measure.setAttribute("sType","MeasureItem"),t._measure.setAttribute("sName",a.computeNewName({object:t._measure,prefix:x.measureitemname})),t._measureOnGeometryType&&(t._measure.setAttribute("sMeasureOnGeometryType",t._measureOnGeometryType),"Extended"===localStorage.getItem("DMUMeasureDisplayPreference")&&t._measure.setAttribute("bShortDisplay",!1))),t._measure.setAttribute("iExtensionLinesManipulable",1),t._measure.setAttribute("sID",a.computeNewID()),t._measure.setAttribute("sUuid",b.getUUID()),t._measure.setInEdition(!0),t._measure.setAttribute("sSelectedType1",e),t._measureItem(),t._measure.fireEvent("onDMUObjectInitialized",{dmuObject:t._measure}),a.addDMUObject?a.addDMUObject(t._measure):a.getCurrentSlide&&a.getCurrentSlide()&&a.getCurrentSlide().addDMUObject(t._measure),t._measure.isMeasureDisplayed()&&t._measure.refreshNode(),t._measure.setInEdition(!1),t._objAction&&t.addInCSO(t._measure),t._objAction=!1};t._objAction&&0===t._preferences.length?t.asyncReadPref(t,a):a()},_transformMeasureToPoint:function(e){var t,a=e,r=e.getType();if(r===i.GeometryType.CYLINDER||r===i.GeometryType.CONE){var s=e.getSelPoint(),n=e.getPoints(),o=e.getAxis(),u=y.computePointLineDistance(s.toArray(),n.beginPoint.toArray(),o.toArray()).aPosition;t={type:i.GeometryType.POINT,position:new d.Vector3(u[0],u[1],u[2])},a=new l({canonic:t,pathElement:e.getPathElement()})}else r!==i.GeometryType.CIRCLE&&r!==i.GeometryType.SPHERE||(t={type:i.GeometryType.POINT,position:e.getCenter()},a=new l({canonic:t,pathElement:e.getPathElement()}));return a},_enterItemCallback:function(){var e=x.notifyitem;"Thickness"===this._arguments[0].ID&&(e=x.notifythicknessitem),"3dPlay"===this._measureCommandMode||"Geovia"===this._arguments[0].ID?e=x.notifyitempt:"3dAuthoringPickPoint"===this._measureCommandMode&&(e=x.notifyrepeatbetweenpt),"None"!==this._repeatType&&(e="3dPlay"===this._measureCommandMode||"Geovia"===this._arguments[0].ID?x.notifyrepeatbetweenpt:"Multiple"===this._repeatType?this._measure&&"MeasureBetween"===this._measure.getMeasureType()?x.notifyrepeatbtwnmultimeasfirstsel:x.notifyrepeatbtwmultimeassecondsel:x.notifyrepeatbetween),this.sendNotify("info",e);var t="DMUMeasure";this._measure&&this._measure.getMeasureType&&(t=this._measure.getMeasureType());var i=!0;"Multiple"!==this._repeatType||"DMUMeasure"!==t&&"MeasureItem"!==t||(i=!1,this._measurable[0]&&(this._vAssistantPosition=this._measurable[0].getSelPoint().clone(),this._measure&&this._measure.movePosDownByPixels&&(this._vAssistantPosition=this._measure.movePosDownByPixels({position:this._measurable[0].getSelPoint().clone(),pixels:45})))),this._createAssistantTools({bOK:"3dPlay"!==this._measureCommandMode&&"Geovia"!==this._arguments[0].ID,bRepeatitem:"None"===this._repeatType&&"3dPlay"!==this._measureCommandMode&&"Geovia"!==this._arguments[0].ID,bKeeponlylast:"None"!==this._repeatType&&"3dPlay"!==this._measureCommandMode&&"Geovia"!==this._arguments[0].ID&&i}),"productOnly"===this._activeFilter&&"ProgressiveVisuLoading"!==this._measureCommandMode&&this._createLevelSelector(!0),this._filterUI&&"3dPlay"!==this._measureCommandMode&&"Thickness"!==this._arguments[0].ID&&"Geovia"!==this._arguments[0].ID&&"3dAuthoringPickPoint"!==this._measureCommandMode&&this._filterUI.setVisibleFlag(!0),a.isEnvActivated("measurecsomanagement",!0)||this.addInCSO(this._measure)},_exitItemCallback:function(){this.cleanNotify(),this._cleanLevelSelector(),this._measure&&this._measure._bPrevisualized&&(this.removeMeasureFromSession(this._measure),this._measure=this._lastMeasure,this._lastMeasure=null),this._filterUI&&this._filterUI.setVisibleFlag(!1),this._removeAssistantTools()},_computeBetweenCallback:function(e,t,a=!1){var s=this;s._removePreVisuNode(),this._lastMeasure&&(this.removeMeasureFromSession(this._lastMeasure),this._measure._bPrevisualized=!1),"Multiple"!==this._repeatType&&"Chain"!==this._repeatType&&"Fan"!==this._repeatType||(this._measure&&this._measure.setInEdition(!1),this._bKeepall&&"Multiple"!==this._repeatType||this.removeMeasureFromSession(this._measure),this._duplicateMeasureForRepeat(this._repeatType));var n=function(){s._treatSelection({data:t,load:!0,callback:function(n){if(s._unlockNodes(),n){s._objAction||(s._measurable[1]=n),"productOnly"!==s._activeFilter||"Multiple"!==s._repeatType&&"Chain"!==s._repeatType&&"Fan"!==s._repeatType||s._createLevelSelector(!1),"Geovia"===s._arguments[0].ID&&(s._measurable[1]=s._transformMeasureToPoint(s._measurable[1]));var l=function(){var n,l=function(){void 0!==s._measure.getAttribute("fDistance")||void 0!==s._measure.getAttribute("fAngle")?(s._lockNodeFromMeasurable(s._measurable[1]),s.assistantTools&&s.assistantTools.updatePosition(s._vAssistantPosition),"partialCmd"===s._measure.isPartialMeasure()&&s._displayPartialLevel(),a&&s._endExecute(),e(),s.emptyHSO(),s._measurable&&(s._addElementToHSO(s._measurable[0]),s._addElementToHSO(s._measurable[1]))):(N&&N.displayNotification({eventID:"error",msg:x.notifyMinDistanceFailure}),s.removeMeasureFromSession(s._measure),s.publish({event:"failure",data:null}))},o=s._arguments[0].ID;if(s._objAction){var d=function(){n=s.getMeasureContainer();for(var e=0;e<t.length-1;e++)s._measure=new u(s._viewer,n,o),r.setPickability(s._measure,!1),s._measure._preferences=s._preferences,s._measure._isInCreationState=!0,s._createdMeasures.push(s._measure),s._measure.setMeasurable(1,s._measurable[e+0]),s._measure.setAttribute("sResultingType1",s.retrieveItemResultType(s._measure.getMeasurable(1).getType(),s._measure.getAttribute("sSelectedType1"))),s._measure.setAttribute("sSelectedType1",s._selectBestType(s,s._measurable[e+0])),s._measure.fireEvent("onDMUObjectInitialized",{dmuObject:s._measure}),n.addDMUObject?n.addDMUObject(s._measure):n.getCurrentSlide&&n.getCurrentSlide()&&n.getCurrentSlide().addDMUObject(s._measure),s._measure.isMeasureDisplayed()&&s._measure.refreshNode(),s._measure.setAttribute("sType","MeasureBetween"),s._measure.setAttribute("sName",n.computeNewName({object:s._measure,prefix:x.measurebetweenname})),s._measure.setAttribute("iExtensionLinesManipulable",e+1),s._measure.setAttribute("sSelectedType2",s._selectBestType(s,s._measurable[e+1])),"3dPlay"!==s._measureCommandMode&&"Geovia"!==s._arguments[0].ID||s._measure.setAttribute("bCollapsedDisplay",!1),s._measure.setMeasurable(2,s._measurable[e+1]),s._measureOnGeometryType?s._measure.setAttribute("sMeasureOnGeometryType",s._measureOnGeometryType):(s._measurable[e].getType()!==i.GeometryType.CYLINDER&&s._measurable[e].getType()!==i.GeometryType.CONE||s._measure.setAttribute("sSelectedType1",c.ViewedType.AXIS),s._measurable[e+1].getType()!==i.GeometryType.CYLINDER&&s._measurable[e+1].getType()!==i.GeometryType.CONE||s._measure.setAttribute("sSelectedType2",c.ViewedType.AXIS)),s._measureBetween();var a=s._measurable.length;a>2&&(s._measurable.splice(0,a-2),s._repeatType="Chain"),l(),s._objAction=!1};0===s._preferences.length?s.asyncReadPref(s,d):d()}else n=s.getMeasureContainer(),s._measure.setAttribute("sType","MeasureBetween"),s._measure.setAttribute("sName",n.computeNewName({object:s._measure,prefix:x.measurebetweenname})),s._measure.setAttribute("iExtensionLinesManipulable",1),s._measureOnGeometryType&&s._measure.setAttribute("sMeasureOnGeometryType",s._measureOnGeometryType),s._measure.setAttribute("sSelectedType2",s._selectBestType(s,s._measurable[1])),"3dPlay"!==s._measureCommandMode&&"Geovia"!==s._arguments[0].ID||s._measure.setAttribute("bCollapsedDisplay",!1),s._measureBetween(),l()};if("ProgressiveFull"!==s._getViewerLoadingMode()&&"ProgressiveLarge"!==s._getViewerLoadingMode()||!s._measurable[0].isPartial()||r.isOOCTileSetNodeInPath(t[0].pathElement))s._measurable[0].setPartial(!1),l();else{var o=s._firstSelectionLeafNodes.concat(s._secondSelectionLeafNodes);if(s._lockedMeshInRAM){var d=[];s._lockedMeshInRAM.forEach(function(e){-1===o.indexOf(e)?s._viewerController.unlockRepresentationMeshInRAM(e):d.push(e)}),s._lockedMeshInRAM=[],s._lockedMeshInRAM=d.slice()}if(s._lockedNodes){var m=[],p=[];s._lockedNodes.forEach(function(e){-1===o.indexOf(e)?p.push(e):m.push(e)}),s._viewerController.unlockNodes({ids:p}),s._lockedNodes=[],s._lockedNodes=m.slice()}s._callMinMaxIndexService({onComplete:function(){s._measure.setPartialMeasure(!1),l()},onFailure:function(e){if("fullMemory"===e.cause)if(e.setALoadedState&&e.setBLoadedState){if("partial"===e.setALoadedState){var t=s._measurable[0].getPathElement(),a=s._measurable[0].getLevel();a&&(t=r.truncatePathElement(t,a)),s._partialMeasureDisplay[0]={path:t,lockedNodes:[],opacity:1}}if("partial"===e.setBLoadedState){var i=s._measurable[1].getPathElement(),n=s._measurable[1].getLevel();n&&(i=r.truncatePathElement(i,n)),s._partialMeasureDisplay[1]={path:i,lockedNodes:[],opacity:1}}s._measure.setPartialMeasure("partialCmd"),s._measurable[0].setLevel(null),s._measurable[0].setPartial(!1),s._measurable[1].setLevel(null),s._measurable[1].setPartial(!1),l(),N&&N.displayNotification({eventID:"error",msg:x.notifyRequestedMinDistanceFullMemoryFailure})}else N&&N.displayNotification({eventID:"error",msg:x.notifyMinDistanceFullMemoryFailure}),s.removeMeasureFromSession(s._measure),s.publish({event:"failure",data:null});else N&&N.displayNotification({eventID:"error",msg:x.notifyMinDistanceFailure}),s.removeMeasureFromSession(s._measure),s.publish({event:"failure",data:null})}})}}}})};if(s._objAction){for(var l=[],o=0;o<t.length;o++){if(t[o].pathElement)if(!t[o].pathElement.getLastElement().sgNode){var d=[];s._switchService.retriveNodesFromPath(t[o].pathElement,d),d.forEach(function(e){e&&"thumbnail"===s._viewerController.getLoadedStream(e)&&l.push(e)})}}l.length?s._switchService.switchToAV1({nodes:l,lockNodesAfterSwitch:!0,lockMeshInRAMAfterSwitch:!0,onCompleteCB:function(e){s._switchRepInfo.clearTimeout=void 0;var t=e.nodeIDsOfLockedNodes;t&&t.length>0&&(s._switchRepInfo.lockedNodeIds||(s._switchRepInfo.lockedNodeIds=[]),t.forEach(function(e){-1===s._switchRepInfo.lockedNodeIds.indexOf(e)&&s._switchRepInfo.lockedNodeIds.push(e)})),n()},onFailureCB:function(){s._switchRepInfo.clearTimeout=void 0}}):n()}else n()},_duplicateMeasureForRepeat:function(e){var t;"Chain"===e?(this._measurable[0]=this._measurable[1].clone(),t=this._measure.getAttribute("sSelectedType2")):"Fan"===e?(this._measurable[0]=this._measurable[0].clone(),t=this._measure.getAttribute("sSelectedType1")):"Multiple"===e&&this._measurable[0]&&this._measurable[0].getTypeWithSelFilter&&(t=this._measurable[0].getTypeWithSelFilter()),this._createMeasure(t)},_enterBetweenCallback:function(){this.sendNotify("info",x.notifybetween);var e=this._measure.getAttribute("sSelectedType1")===c.ViewedType.POINT&&this._measure.getAttribute("sSelectedType2")===c.ViewedType.POINT,t=!0,i=this._pathElementAgentWithCSO.cso;this._objAction&&i._items.length>2&&(t=!1),this._createAssistantTools({bOK:!0,bRepeatbetweenMultipleMeas:t&&"Multiple"!==this._repeatType&&"3dPlay"!==this._measureCommandMode&&"Geovia"!==this._arguments[0].ID,bRepeatbetweenChain:t&&"Chain"!==this._repeatType&&"3dPlay"!==this._measureCommandMode&&"Geovia"!==this._arguments[0].ID,bRepeatbetweenFan:t&&"Fan"!==this._repeatType&&"3dPlay"!==this._measureCommandMode&&"Geovia"!==this._arguments[0].ID,bThreepoints:e&&"3dPlay"!==this._measureCommandMode&&"Geovia"!==this._arguments[0].ID}),"productOnly"===this._activeFilter&&"ProgressiveVisuLoading"!==this._measureCommandMode&&this._createLevelSelector(!1),a.isEnvActivated("measurecsomanagement",!0)||this.addInCSO(this._measure)},_exitBetweenCallback:function(){this.cleanNotify(),this._cleanLevelSelector(),this._removeAssistantTools()},_enterThreepointsCallback:function(){var e="Angle"===this._threepoints?x.notify3pointsangle:"Angle"===this._threepoints?x.notify3pointscircle:x.notify3points;this.sendNotify("info",e)},_exitThreepointsCallback:function(){this.cleanNotify()},_computeThreepointsCallback:function(e,t,i=!1){var s=this;s._removePreVisuNode(),this._treatSelection({data:t,load:!0,callback:function(t){if(t){var a=function(){var t=s.getMeasureContainer();t&&(s._measure.setAttribute("sType","AngleBy3Points"===localStorage.getItem("DMUMeasure3PointsDisplayPreferences")?"Measure3PointsAngle":"Measure3PointsCircle"),s._measure.setAttribute("sName",t.computeNewName({object:s._measure,prefix:x.measurethreepointsname})),s._measure.setAttribute("iExtensionLinesManipulable",1),s._measureOnGeometryType&&s._measure.setAttribute("sMeasureOnGeometryType",s._measureOnGeometryType)),s._createAssistantTools({bOK:!0}),s._measureThreePoints(),s._lockNodeFromMeasurable(s._measurable[2]),i&&s._endExecute(),e()};if(s._objAction){var n=function(){var e=s.getMeasureContainer(),t=s._arguments[0].ID;s._measure=new u(s._viewer,e,t),r.setPickability(s._measure,!1),s._measure._preferences=s._preferences,s._measure._isInCreationState=!0,s._createdMeasures.push(s._measure),s._measure.setMeasurable(1,s._measurable[0]),s._measure.setAttribute("sResultingType1",s.retrieveItemResultType(s._measure.getMeasurable(1).getType(),s._measure.getAttribute("sSelectedType1"))),s._measure.setAttribute("sSelectedType1",s._selectBestType(s,s._measurable[0])),s._measure.fireEvent("onDMUObjectInitialized",{dmuObject:s._measure}),e.addDMUObject?e.addDMUObject(s._measure):e.getCurrentSlide&&e.getCurrentSlide()&&e.getCurrentSlide().addDMUObject(s._measure),s._measure.isMeasureDisplayed()&&s._measure.refreshNode(),s._measure.setMeasurable(2,s._measurable[1]),a(),s._objAction=!1};0===s._preferences.length?s.asyncReadPref(s,n):n()}else s._measurable[2]=t,a()}}}),a.isEnvActivated("measurecsomanagement",!0)||s.addInCSO(s._measure)},_createLevelSelector:function(e){var a,i=this,s=e?0:1;if(this.dataLevels=[],this._getLevels=function(e){i.dataLevels=[];for(var t=i._measurable[s].getPathElement(),a=r.getLastReference(t),n=[],l=a.externalPath.length,o=0;o<l;++o){var u=a.getLastElement(!0);r.isReference(u)&&(i.dataLevels.push({pathElement:a.clone(),name:u.name,internalLevel:l-o}),n.push(u)),a=a.getParentPath()}var c=g.getContextViewer({reviewContext:g.getReviewContext({viewer:i.getFrameWindow().getViewer()})});return r.getName(n,function(t){for(var a=t.length,r=0;r<a;++r)i.dataLevels[r].name=t[r];e()},c,""),{currentLevel:0,levels:i.dataLevels}},this._onLevelHover=function(e){e&&i.addInPSO({path:e.pathElement},!1)},this._onLevelSelect=function(t){for(var a=0,n=0;0===a&&n<i.dataLevels.length;++n)i.dataLevels[n].pathElement.getLength()===t.pathElement.getLength()&&(a=i.dataLevels[n].internalLevel);var l=!1;a===2*i.dataLevels.length&&(l=!0);var o=[],u=[],d=!0,m=[],p=[],_=r.getLastRepReference(t.pathElement);null!==_&&0!==_.getLength()||(_=r.getLastReference(t.pathElement)),"ProgressiveLarge"===i._getViewerLoadingMode()&&(a&&!l?(d=!1,i._measurable[s].setPartial(!0),N&&N.displayNotification({eventID:"error",msg:x.notifyPartialStructureFailure})):i._measurable[s].setPartial(!1)),d&&("DynamicRep"===i._getViewerLoadingMode()?d=i._lockNodes(_.getLastElement(!0),o,t.pathElement.getParentPath()):"ProgressiveFull"===i._getViewerLoadingMode()&&(a&&!l?(d=i._getNodesToSwitchInRAM(_.getLastElement(!0),p,m,u),i._measurable[s].setPartial(!0)):i._measurable[s].setPartial(!1)));var h=function(a){a?(i._measure&&(i._undisplayPartialLevel(),"errorBtw"===a?i._displayPartialLevel():d?(i._partialMeasureDisplay[s]=null,s>0?(i._partialMeasureDisplay[0]=null,"partialCmd"===i._measure.isPartialMeasure()&&i._displayPartialLevel(),i._partialMeasureDisplay[0]||i._measure.setPartialMeasure(!1)):i._measure.setPartialMeasure(!1)):(i._partialMeasureDisplay[s]={path:t.pathElement,lockedNodes:o},s>0&&i._displayPartialLevel(),i._measure.setPartialMeasure("partialCmd"))),i._measure&&(e?(i._measure.setAttribute("sSelectedType1",c.ViewedType.PRODUCT),i._measureItem()):(i._measure.setAttribute("sSelectedType2",c.ViewedType.PRODUCT),i._measureBetween()))):0===s&&i._measure&&i._measure.setPartialMeasure("partialCmd"),i.emptyHSO(),i._measurable&&(i._addElementToHSO(i._measurable[0]),s>0&&i._addElementToHSO(i._measurable[1])),i.assistantTools.updatePosition(i._vAssistantPosition),i._measure&&i._measure.isMeasureDisplayed()&&i._measure.refreshNode(),i._viewer.render()};i._measurable[s].setLevel(a),0===s&&i._measurable[s].isPartial()&&i._measure&&i._measure.updatePrdIDAsPerSelectedLevel&&i._measure.updatePrdIDAsPerSelectedLevel();var M=function(){for(var e=0;e<u.length;e++)-1===i._lockedMeshInRAM.indexOf(u[e])&&(i._viewerController.lockRepresentationMeshInRAM(u[e]),i._lockedMeshInRAM.push(u[e])),-1===i._lockedNodes.indexOf(u[e])&&(i._viewerController.lockNodes({ids:[u[e]]}),i._lockedNodes.push(u[e]));"DynamicRep"===i._getViewerLoadingMode()?h(!0):p.length>0||m.length>0?i._switchNodeVisu({nodes_cgr:p,nodes_MIR:m,onComplete:function(){h(!0)},onFailure:function(e){"fullMemory"===e&&(N&&N.displayNotification({eventID:"error",msg:x.notifyFullMemoryFailure}),h(!1))}}):h(!0)};if("ProgressiveFull"===i._getViewerLoadingMode()||"ProgressiveLarge"===i._getViewerLoadingMode())if(i._measurable[1])if(i._measurable[0].isPartial()||i._measurable[1].isPartial()){var y=i._firstSelectionLeafNodes.concat(i._secondSelectionLeafNodes);if(i._lockedMeshInRAM){var v=[];i._lockedMeshInRAM.forEach(function(e){-1===y.indexOf(e)?i._viewerController.unlockRepresentationMeshInRAM(e):v.push(e)}),i._lockedMeshInRAM=[],i._lockedMeshInRAM=v.slice()}if(i._lockedNodes){var g=[],D=[];i._lockedNodes.forEach(function(e){-1===y.indexOf(e)?D.push(e):g.push(e)}),i._viewerController.unlockNodes({ids:D}),i._lockedNodes=[],i._lockedNodes=g.slice()}i._callMinMaxIndexService({onComplete:function(){d=!0,h(!0)},onFailure:function(e){if("fullMemory"===e.cause)if(e.setALoadedState&&e.setBLoadedState){if("partial"===e.setALoadedState){var t=i._measurable[0].getPathElement(),a=i._measurable[0].getLevel();a&&(t=r.truncatePathElement(t,a)),i._partialMeasureDisplay[0]={path:t,lockedNodes:[],opacity:1}}if("partial"===e.setBLoadedState){var s=i._measurable[1].getPathElement(),n=i._measurable[1].getLevel();n&&(s=r.truncatePathElement(s,n)),i._partialMeasureDisplay[1]={path:s,lockedNodes:[],opacity:1}}i._measure.setPartialMeasure("partialCmd"),i._measurable[0].setLevel(null),i._measurable[0].setPartial(!1),i._measurable[1].setLevel(null),i._measurable[1].setPartial(!1),h("errorBtw"),N&&N.displayNotification({eventID:"error",msg:x.notifyRequestedMinDistanceFullMemoryFailure})}else N&&N.displayNotification({eventID:"error",msg:x.notifyMinDistanceFullMemoryFailure}),i.removeMeasureFromSession(i._measure),i.publish({event:"failure",data:null});else N&&N.displayNotification({eventID:"error",msg:x.notifyMinDistanceFailure}),i.removeMeasureFromSession(i._measure),i.publish({event:"failure",data:null})}})}else d?(i._measure.setPartialMeasure(!1),M()):h(!1);else d?M():h(!1);else d?M():i._measure&&(s>0?h(!0):(i._partialMeasureDisplay[s]={path:t.pathElement,lockedNodes:o},i._measure.setPartialMeasure("partialCmd")),i._viewer.render())},this._measure)a=this._measure.getAttribute("vLeaderBreakPoint3D");else if(this._measurable[0]){var n=this._measurable[0].getSelPoint();n||(n=this._measurable[0].getCoG()),a=n.clone()}var l=t.getWindowPositionFromPoint(this._viewer,a,this._frmWindow),o={positionX:l.left,positionY:l.top-110,uiFrame:this._frmWindow.getUIFrame(),selectedPath:this._getLevels,getLevels:this._getLevels,onHover:this._onLevelHover,onSelect:this._onLevelSelect};this._cleanLevelSelector(),p.createView(o)},_cleanLevelSelector:function(){var e=p._noAnim;p._noAnim=!0,p.destroyView(),p._noAnim=e},_measureItem:function(){if(this._measure.setMeasurable(1,this._measurable[0]),this._measure.setAttribute("sResultingType1",this.retrieveItemResultType(this._measure.getMeasurable(1).getType(),this._measure.getAttribute("sSelectedType1"))),"2D"===this._measureOnGeometryType){var e=this._measure.getMeasurable(1);this._measure.getAttribute("sSelectedType1")===c.ViewedType.POINT&&e.getType()!==i.GeometryType.POINT&&e.setType(i.GeometryType.POINT)}var a,r=this._measure.getAttribute("sResultingType1");if(r===c.ResultType.CIRCLE){var s=0;"TANGENT"===localStorage.getItem("DMUMeasureRadiusResultDisplayPreferences")&&(s=1),this._measure.getAttribute("iRadiusResultDisplayType")!==s&&this._measure.setAttribute("iRadiusResultDisplayType",s),a="DisplayRadius"===localStorage.getItem("DMUMeasureCircleRadiusPreferences"),Math.abs(2*Math.PI-this._measurable[0]._arcAngle)>.001&&("DisplayArcLength"===localStorage.getItem("DMUMeasureArcRadiusPreferences")?this._measure.setAttribute("bArcLengthDisplay",!0):(this._measure.setAttribute("bArcLengthDisplay",!1),a="DisplayRadius"===localStorage.getItem("DMUMeasureArcRadiusPreferences"))),this._measure.getAttribute("bRadiusDisplay")!==a&&this._measure.setAttribute("bRadiusDisplay",a)}else if(r===c.ResultType.CYLINDER){var n=localStorage.getItem("DMUMeasSurfaceDisplayCylinderPref");this._measure.setAttribute("sSurfaceDisplayType",n)}else if(r===c.ResultType.CONE){var l=this._measurable[0].getApex(),o=this._measurable[0].getPoints(),u=localStorage.getItem("DMUMeasSurfaceDisplayConePref");("MinimumRadius"===u||"MinimumDiameter"===u)&&l&&(Math.abs(l.x-o.beginPoint.x)<.001&&Math.abs(l.y-o.beginPoint.y)<.001&&Math.abs(l.z-o.beginPoint.z)<.001||Math.abs(l.x-o.endPoint.x)<.001&&Math.abs(l.y-o.endPoint.y)<.001&&Math.abs(l.z-o.endPoint.z)<.001)?(u="HalfAngle",this._measure.updateFeatureAndSurfaceDisplayTypePreference(u)):this._measure.setAttribute("sSurfaceDisplayType",u)}else if(r===c.ResultType.SPHERE){var d=localStorage.getItem("DMUMeasSurfaceDisplaySpherePref");this._measure.setAttribute("sSurfaceDisplayType",d)}else if(r===c.ResultType.PRODUCT){var m=localStorage.getItem("DMUMeasProductDisplayPref");this._measure.setAttribute("sProductDisplayType",m)}switch(this._measure.update(),this._measure.getAttribute("sResultingType1")){case c.ResultType.POINT:case c.ResultType.PICKINGPT:case c.ResultType.CENTER:case c.ResultType.PLANE:case c.ResultType.CURVE:case c.ResultType.SURFACE:this._vAssistantPosition=this._measure.getAttribute("vFirstExtensionPoint3D").clone();break;case c.ResultType.LINE:this._vAssistantPosition=this._measure.getAttribute("vFirstExtensionPoint3D").clone().add(this._measure.getAttribute("vSecondExtensionPoint3D")).multiplyScalar(.5);break;case c.ResultType.AXIS:this._vAssistantPosition=this._measure.getAttribute("vLeaderPointingPoint3D").clone();break;case c.ResultType.CIRCLE:var p=t.getViewpointInfo(this._viewer.currentViewpoint),_=Math.abs(this._measure.getAttribute("vNormal").angleTo(p.sight)-Math.PI/2)<Math.PI/10;this._vAssistantPosition=_?this._measure.getAttribute("vCenter").clone():this._measure.getAttribute("vLeaderPointingPoint3D").clone();break;case c.ResultType.CYLINDER:a="DisplayRadius"===localStorage.getItem("DMUMeasureCylinderRadiusPreferences"),this._vAssistantPosition=this._measure.getAttribute("vPoint1").clone().add(this._measure.getAttribute("vPoint2")).multiplyScalar(.5),this._measure.getAttribute("bRadiusDisplay")!==a&&this._measure.setAttribute("bRadiusDisplay",a);break;case c.ResultType.CONE:this._vAssistantPosition=this._measure.getAttribute("vPoint2").clone();break;case c.ResultType.SPHERE:a="DisplayRadius"===localStorage.getItem("DMUMeasureSphereRadiusPreferences"),this._vAssistantPosition=this._measure.getAttribute("vCenter").clone(),this._measure.getAttribute("bRadiusDisplay")!==a&&this._measure.setAttribute("bRadiusDisplay",a);break;case c.ResultType.PRODUCT:this._vAssistantPosition=this._measure.getAttribute("vLeaderPointingPoint3D").clone()}this._vAssistantPosition=this._measure.movePosDownByPixels({position:this._vAssistantPosition.clone(),pixels:45})},_measureBetween:function(){if(this._measure._objAction=this._objAction,this._objAction||this._measure.setMeasurable(2,this._measurable[1]),this._measure.setAttribute("sResultingType1",this.retrieveBetweenResultType({selectedType1:this._measure.getAttribute("sSelectedType1"),selectedType2:this._measure.getAttribute("sSelectedType2"),measurable:this._measurable[0]})),this._measure.setAttribute("sResultingType2",this.retrieveBetweenResultType({selectedType1:this._measure.getAttribute("sSelectedType2"),selectedType2:this._measure.getAttribute("sSelectedType1"),measurable:this._measurable[1]})),"2D"===this._measureOnGeometryType){var e=this._measure.getMeasurable(1),t=this._measure.getMeasurable(2);if(this._measure.getAttribute("sSelectedType1")===c.ViewedType.POINT&&e.getType()!==i.GeometryType.POINT&&e.setType(i.GeometryType.POINT),this._measure.getAttribute("sSelectedType2")===c.ViewedType.POINT&&e.getType()!==i.GeometryType.POINT&&t.setType(i.GeometryType.POINT),this._retrieveDistanceTypeFor2DMeasures){var a=this._retrieveDistanceTypeFor2DMeasures();this._measure.setAttribute("sDistanceType",a.distanceType),this._measure._local2DDistancePref=a.localprefName}}if(this._measure.setDistanceType(),this._measure.update(),void 0!==this._measure.getAttribute("fDistance")||void 0!==this._measure.getAttribute("fAngle")){var r=this._measure.getAttribute("vSecondExtensionPoint3D").clone();"Angle"===this._measure.getAttribute("sDistanceType")&&(r=this._measure.getMeasurable(2).getSelPoint()),this._vAssistantPosition=this._measure.movePosDownByPixels({position:r,pixels:45})}},_measureThreePoints:function(){if(this._measure.setMeasurable(3,this._measurable[2]),"Measure3PointsCircle"===this._measure.getAttribute("sType")){this._measure.setAttribute("sDistanceType","none");var e=0;"TANGENT"===localStorage.getItem("DMUMeasure3PointsCircleRadiusResultDisplayPreferences")&&(e=1),this._measure.getAttribute("iRadiusResultDisplayType")!==e&&this._measure.setAttribute("iRadiusResultDisplayType",e)}else if("Measure3PointsAngle"===this._measure.getAttribute("sType")){this._measure.setAttribute("sDistanceType","Angle");var t=this._measure.getMeasurable(3).getSelPoint();this._vAssistantPosition=this._measure.movePosDownByPixels({position:t,pixels:45})}this._measure.update(),this.assistantTools&&"Angle"===this._measure.getAttribute("sDistanceType")&&this.assistantTools.updatePosition(this._vAssistantPosition)},retrievePossibleSelectedType:function(e){var t=[],a=e.getType();return a===i.GeometryType.POINT||a===i.GeometryType.PICKINGPT?t.push(c.ViewedType.POINT):a===i.GeometryType.PLANE?(t.push(c.ViewedType.INFPLANE),t.push(c.ViewedType.POINT),t.push(c.ViewedType.SURFACE)):a===i.GeometryType.CYLINDER?(t.push(c.ViewedType.CYCOSP),t.push(c.ViewedType.AXIS),t.push(c.ViewedType.POINT),t.push(c.ViewedType.SURFACE)):a===i.GeometryType.CONE?(t.push(c.ViewedType.CYCOSP),t.push(c.ViewedType.AXIS),t.push(c.ViewedType.POINT),t.push(c.ViewedType.SURFACE)):a===i.GeometryType.SPHERE?(t.push(c.ViewedType.CYCOSP),t.push(c.ViewedType.CENTER),t.push(c.ViewedType.POINT),t.push(c.ViewedType.SURFACE)):a===i.GeometryType.LINE?(t.push(c.ViewedType.CURVE),t.push(c.ViewedType.AXIS),t.push(c.ViewedType.POINT)):a===i.GeometryType.CIRCLE?(t.push(c.ViewedType.CIRCLE),t.push(c.ViewedType.CENTER),t.push(c.ViewedType.POINT),t.push(c.ViewedType.CURVE)):a===i.GeometryType.CURVE?(t.push(c.ViewedType.CURVE),t.push(c.ViewedType.POINT)):a===i.GeometryType.SURFACE&&(t.push(c.ViewedType.SURFACE),t.push(c.ViewedType.POINT)),t.push(c.ViewedType.PRODUCT),t},retrieveItemResultType:function(e,t){var a=c.ResultType.POINT;if(t===c.ViewedType.POINT)a=c.ResultType.POINT;else if(t===c.ViewedType.PRODUCT)a=c.ResultType.PRODUCT;else switch(e){case i.GeometryType.POINT:case i.GeometryType.PICKINGPT:a=c.ResultType.POINT;break;case i.GeometryType.LINE:a=this._objAction?c.ResultType.LINE:t===c.ViewedType.AXIS?c.ResultType.AXIS:c.ResultType.LINE;break;case i.GeometryType.CIRCLE:a=this._objAction?c.ResultType.CIRCLE:t===c.ViewedType.CENTER?c.ResultType.CENTER:t===c.ViewedType.CURVE?c.ResultType.CURVE:c.ResultType.CIRCLE;break;case i.GeometryType.CURVE:a=c.ResultType.CURVE;break;case i.GeometryType.PLANE:a=this._objAction?c.ResultType.PLANE:t===c.ViewedType.SURFACE?c.ResultType.SURFACE:c.ResultType.PLANE;break;case i.GeometryType.CYLINDER:a=this._objAction?c.ResultType.CYLINDER:t===c.ViewedType.AXIS?c.ResultType.AXIS:t===c.ViewedType.SURFACE?c.ResultType.SURFACE:c.ResultType.CYLINDER;break;case i.GeometryType.CONE:a=this._objAction?c.ResultType.CONE:t===c.ViewedType.AXIS?c.ResultType.AXIS:t===c.ViewedType.SURFACE?c.ResultType.SURFACE:c.ResultType.CONE;break;case i.GeometryType.SPHERE:a=this._objAction?c.ResultType.SPHERE:t===c.ViewedType.CENTER?c.ResultType.CENTER:t===c.ViewedType.SURFACE?c.ResultType.SURFACE:c.ResultType.SPHERE;break;case i.GeometryType.SURFACE:a=c.ResultType.SURFACE}return a},retrieveBetweenResultType:function(e){var t=c.ResultType.POINT,a=e.selectedType2;switch(e.selectedType1){case c.ViewedType.POINT:case c.ViewedType.CENTER:t=c.ResultType.POINT;break;case c.ViewedType.AXIS:t=a===c.ViewedType.POINT||a===c.ViewedType.CENTER||a===c.ViewedType.AXIS||a===c.ViewedType.INFPLANE?c.ResultType.AXIS:c.ResultType.CURVE;break;case c.ViewedType.CURVE:t=c.ResultType.CURVE;break;case c.ViewedType.INFPLANE:t=a===c.ViewedType.POINT||a===c.ViewedType.CENTER||a===c.ViewedType.AXIS||a===c.ViewedType.INFPLANE?c.ResultType.PLANE:c.ResultType.SURFACE;break;case c.ViewedType.SURFACE:t=c.ResultType.SURFACE;break;case c.ViewedType.PRODUCT:t=c.ResultType.PRODUCT;break;case c.ViewedType.CIRCLE:t=c.ResultType.CURVE;break;case c.ViewedType.CYCOSP:t=c.ResultType.SURFACE}return t},_createAssistantTools:function(e){var t=x.multipleMeas,a=x.chainMeas,i=x.stackMeas,r=this;var s=[];void 0!==e.bOK&&e.bOK&&s.push({nls:x.ok,url:this._iconDir+"I_Validate.png",id:"OK",callback:function(){r.publish({event:"OK",data:null})},bstateActif:!1}),void 0!==e.bRepeatitem&&e.bRepeatitem&&s.push({nls:x.repeatitem,url:this._iconDir+"I_Repeat.png",id:"Repeat",callback:function(){r._repeatType="Item",r.publish({event:"repeatitem",data:null})},bstateActif:!1}),void 0!==e.bRepeatbetweenMultipleMeas&&e.bRepeatbetweenMultipleMeas&&s.push({nls:t,url:this._iconDir+"I_MultipleMeasure.png",id:"Multiple",callback:function(){r._repeatType="Multiple",r.publish({event:"repeatbetweenMultiple",data:null})}}),void 0!==e.bRepeatbetweenChain&&e.bRepeatbetweenChain&&s.push({nls:a,url:this._iconDir+"I_ChainedMeasure.png",id:"Chain",callback:function(){r._repeatType="Chain",r.publish({event:"repeatbetween",data:null})}}),void 0!==e.bRepeatbetweenFan&&e.bRepeatbetweenFan&&s.push({nls:i,url:this._iconDir+"I_FanMeasure.png",id:"Fan",callback:function(){r._repeatType="Fan",r.publish({event:"repeatbetween",data:null})}}),void 0!==e.bKeeponlylast&&e.bKeeponlylast&&s.push({nls:x.keepprevious,url:this._iconDir+"I_KeepOnlyLast.png",id:"Keep",callback:function(){r._bKeepall=!r._bKeepall},bstateActif:this._bKeepall}),void 0!==e.bAnglethreepoints&&e.bAnglethreepoints&&s.push({nls:x.anglethreepoints,url:this._iconDir+"I_MeasureAngle3Points.png",id:"Angle3Points",callback:function(){r._threepoints="Angle",r.publish({event:"threepoints",data:null})}}),void 0!==e.bCirclethreepoints&&e.bCirclethreepoints&&s.push({nls:x.circlethreepoints,url:this._iconDir+"I_MeasureArc3Points.png",id:"Arc3Points",callback:function(){r._threepoints="Circle",r.publish({event:"threepoints",data:null})}}),void 0!==e.bThreepoints&&e.bThreepoints&&s.push({nls:x.threepoints,url:this._iconDir+"I_Measure3Points.png",id:"3Points",callback:function(){r._threepoints="Threepoints",r.publish({event:"threepoints",data:null})}});var n=this._vAssistantPosition;this._measure&&this._measure._vAssistantPosition&&(n=this._measure._vAssistantPosition),this._removeAssistantTools(),this.assistantTools=new o({body:this._frmWindow.getUIFrame(),viewer:this._viewer,frmWindow:this._frmWindow,title:"Assistant tools Control",position:n,mode:"curve",dir:"bottom",lJsonElement:s}),this.assistantTools.build(),this._measure&&(this._measure._assistantTool=this.assistantTools)},_removeAssistantTools:function(){this.assistantTools&&(this.assistantTools.clear(),this.assistantTools=void 0),this._tokenVISUEvent&&(_.unsubscribe(this._tokenVISUEvent),this._tokenVISUEvent=null)},_isItMeasurable:function(e){var t=!1;if(void 0!==e){if("Thickness"===this._arguments[0].ID&&r.isOOCTileSetNodeInPath(e))return!1;if(r.getFirstReference(e).externalPath.length>0)t=!0;else t=g.getReviewContext({viewer:this.getFrameWindow().getViewer()}).getDMUObjectFromPathElement(e)&&!0===e.getLastElement(!0).measurable;t||(!this._activeFilter||"pointOnly"===this._activeFilter||"SeveralGeometries"===this._activeFilter&&this._filterUI&&!this._filterUI.getActiveState("center"))&&(t=r.isOOCTileSetNodeInPath(e)),t||(!this._activeFilter||"pointOnly"===this._activeFilter||"SeveralGeometries"===this._activeFilter&&this._filterUI&&!this._filterUI.getActiveState("center"))&&(t=r.isAPOIPath(e))&&"Thickness"===this._arguments[0].ID&&(t=this.managePOISelection({pathElement:e}))}return t},_lockNodeFromMeasurable:function(e){if("ProgressiveVisuLoading"===this._measureCommandMode&&this._viewerController&&e&&!r.isOOCTileSetNodeInPath(e.getPathElement())){var t=r.getLastRepReference(e.getPathElement());if(null===t&&(t=r.getLastReference(e.getPathElement())),t){var a=t.getLastElement(!0);if(a&&r.isPLMNode(a)){var i=r.getNodeID(a);this._measure.isNodeLocked(i)||(this._viewerController.lockNodes({ids:[i]}),this._measure.addLockedNode(i))}}}},_lockNodes:function(e,t,a){var i=!0,s=null;if(a&&(s=a.clone()).addElement(e),this._viewerController&&e)if(r.isRepReference(e)&&r.isPLMNode(e)){var n=r.getNodeID(e),l=this._viewerController.isReferenceComplete(n);!0===l||null===l?(-1===this._lockedNodes.indexOf(n)&&(this._viewerController.lockNodes({ids:[n]}),this._lockedNodes.push(n)),t.push(s)):i=!1}else{var o=e.getChildren();if(o)for(var u=0;u<o.length;u++){var c=this._lockNodes(o[u],t,s);i&&!c&&(i=!1)}}return i},_displayPartialLevel:function(){var e=this;this._overrideSet||(this._overrideSet=r.createSceneGraphOverrideSet(this._viewer)),this._overrideSet&&this._partialMeasureDisplay.forEach(function(t){if(t){for(var a=null,i=0;i<t.lockedNodes.length;i++)t.lockedNodes[i]&&(null===(a=e._overrideSet.getUniqueOverrideFromPathElement(t.lockedNodes[i]))&&(a=e._overrideSet.createOverride(t.lockedNodes[i])),a.setOpacity(1,!0));if(null===(a=e._overrideSet.getUniqueOverrideFromPathElement(t.path))&&(a=e._overrideSet.createOverride(t.path)),a){a.setColor(16744448,!1),a.setOpacity(t.opacity?t.opacity:.3,!1)}}})},_undisplayPartialLevel:function(){this._overrideSet&&(r.removeSceneGraphOverrideSet(this._viewer,this._overrideSet),this._overrideSet=null)},_getNodesToSwitchInRAM:function(e,t,a,i){var s=!0,n=this;if(this._viewerController&&e&&a){var l=r.getNodeID(e),o=this._viewerController.createReferenceIterator(l);if(o){var u=function(e,t,a,i){if(e){var l=e.getChildren();if(l&&l.length>0){for(var o=0;o<l.length;o++)if(u(l[o].getReferenceIterator(),t,a,i),!s){a=[],a=[];break}}else{var c=e.getNode();if(c){var d=r.getNodeID(c),m=n._viewerController.isReferenceComplete(d);if(!0===m||null===m){var p=!0;"cgr"!==n._viewerController.getLoadedStream(c)&&-1===t.indexOf(c)&&(t.push(c),p=!1),!1===n._viewerController.hasMeshInRAM(d)?-1===a.indexOf(d)&&a.push(d):!0===m&&!0===p&&i.push(d)}else s=!1}else e._reference&&e._reference.userData&&"3DShape"===e._reference.userData.type&&(s=!1)}}};u(o,t,a,i)}}return s},_checkForSelection:function(){return!0},_addElementToHSO:function(e){if(e){var t,a=new m,i=[],s=e.getPathElement(),n=e.getLevel();if(n)t=r.truncatePathElement(s,n);else{t=s;var l=e.getPrimitive();if(l)for(var o=THREEDS.SubElement.getFromSGNode(l);null!==o;)i.unshift(o),o=o.getParent()}a.setFromArray(t.externalPath,i),this.addInHSO({path:a},!0)}},_getViewerLoadingMode:function(){var e=null,t=g.getContextViewer({viewer:this.getFrameWindow().getViewer()});return t&&t.getRoots&&t.getRoots().length>0&&this._viewerController&&this._viewerController.getRootStats(r.getNodeID(t.getRoots()[0]))&&(H.getSetting("enopad3dviewer_lightNodeModel")?e=this._viewerController.isLargeSession()?"ProgressiveLarge":"ProgressiveFull":H.getSetting("enopad3dviewer_dynamicRepLoading")&&(e="DynamicRep")),e},_callMinMaxIndexService:function(e){var t=this,a=r.getFirstReference(t._measurable[0].getPathElement()).getLastElement();if(a===r.getFirstReference(t._measurable[1].getPathElement()).getLastElement()){var i=r.getNodeID(a),s=t._measurable[0].getPathElement(),n=t._measurable[0].getLevel();n&&(s=r.truncatePathElement(s,n));var l=t._measurable[1].getPathElement(),o=t._measurable[1].getLevel();o&&(l=r.truncatePathElement(l,o));var u=t._viewerController.buildArrayFromPath(s),c=t._viewerController.buildArrayFromPath(l),d=[],m=[],p=[],_=[],h=g.giveEventsController({viewer:this._viewer}),M=g.getContextViewer({viewer:t.getFrameWindow().getViewer()}),y=null,v=null,D=!1;h&&(y=h.addEvent(A.Events.EXPEndProgressiveLoad,function(a){if(a.memoryFull){var i,s;D=!0,M.unsubscribe(v),h.removeEvent(y);var n,l=0,o=0,u=0,c=0;if(d.length>0){for(var g=0;g<d.length;g++)(n=d[g].getLastElement(!0))&&"cgr"===t._viewerController.getLoadedStream(n)&&t._viewerController.hasMeshInRAM(r.getNodeID(n))&&(l++,-1!==t._firstSelectionLeafNodes.indexOf(r.getNodeID(n))&&u++);l===d.length?i="full":t._firstSelectionLeafNodes.length===u&&(i="partial")}else p.length>0&&(p.forEach(function(e){var a=t._viewerController.buildPathFromArray(e);a&&(n=a.getLastElement(!0))&&"cgr"===t._viewerController.getLoadedStream(n)&&t._viewerController.hasMeshInRAM(e[e.length-1])&&(l++,-1!==t._firstSelectionLeafNodes.indexOf(e[e.length-1])&&u++)}),l===p.length?i="full":t._firstSelectionLeafNodes.length===u&&(i="partial"));if(m.length>0){for(var f=0;f<m.length;f++)(n=m[f].getLastElement(!0))&&"cgr"===t._viewerController.getLoadedStream(n)&&t._viewerController.hasMeshInRAM(r.getNodeID(n))&&(o++,-1!==t._secondSelectionLeafNodes.indexOf(r.getNodeID(n))&&c++);o===m.length?s="full":t._secondSelectionLeafNodes.length===c&&(s="partial")}else _.length>0&&(_.forEach(function(e){var a=t._viewerController.buildPathFromArray(e);a&&(n=a.getLastElement(!0))&&"cgr"===t._viewerController.getLoadedStream(n)&&t._viewerController.hasMeshInRAM(e[e.length-1])&&(o++,-1!==t._secondSelectionLeafNodes.indexOf(e[e.length-1])&&c++)}),o===_.length?s="full":t._secondSelectionLeafNodes.length===c&&(s="partial"));e.onFailure({cause:"fullMemory",setALoadedState:i,setBLoadedState:s}),window.console.log("MCmd (full mem): MinMax fails ("+i+","+s+")")}})),t._viewerController.completeSessionWithMinMaxMeasureCandidates({rootPhID:i,mode:"MaximumDistance"===t._measure.getAttribute("sDistanceType")?"max":"min",sets:[{id:"A",paths:[u]},{id:"B",paths:[c]}],stream:"cgr",meshInRAM:!0}).then(function(a){if(a.selectedPaths.length>0&&a.sortedPaths.A.length>0&&a.sortedPaths.B.length>0){p=a.sortedPaths.A,_=a.sortedPaths.B;for(var i=[],s=0;s<a.selectedPaths.length;s++){t._viewerController.buildPathFromArray(a.selectedPaths[s])?t._viewerController.hasMeshInRAM(a.selectedPaths[s][a.selectedPaths[s].length-1])||-1!==i.indexOf(a.selectedPaths[s][a.selectedPaths[s].length-1])||i.push(a.selectedPaths[s][a.selectedPaths[s].length-1]):-1===i.indexOf(a.selectedPaths[s][a.selectedPaths[s].length-1])&&i.push(a.selectedPaths[s][a.selectedPaths[s].length-1])}var n=function(){var s=[],n=0;v=M.subscribe({event:"onRepresentationLoaded"},function(a){if(t._viewerController.hasMeshInRAM(a)){for(var i=0;i<s.length;i++)if(-1!==s[i].indexOf(a)){n++;break}n===s.length&&(M.unsubscribe(v),v=null,h.removeEvent(y),y=null,e.onComplete())}});var l,o=function(e){e.forEach(function(e){var a=e.getLastElement(!0);if(a){var i=r.getNodeID(a);-1===t._lockedNodes.indexOf(i)&&(t._viewerController.lockNodes({ids:[i]}),t._lockedNodes.push(i))}})};i.length&&t._viewerController.setForceReferencesLoad({data:i.map(function(e){return{id:e,state:!1}})});for(var u=0;u<a.sortedPaths.A.length;u++)(l=t._viewerController.buildPathFromArray(a.sortedPaths.A[u]))&&d.push(l);o(d),r.isPLMNode(t._measurable[0].getPathElement().getLastElement(!0))&&(t._measurable[0].setPartial(!0),t._measurable[0].setPartialPathElements(d));for(var c=0;c<a.sortedPaths.B.length;c++)(l=t._viewerController.buildPathFromArray(a.sortedPaths.B[c]))&&m.push(l);o(m),r.isPLMNode(t._measurable[1].getPathElement().getLastElement(!0))&&(t._measurable[1].setPartial(!0),t._measurable[1].setPartialPathElements(m)),d.length===a.sortedPaths.A.length&&m.length===a.sortedPaths.B.length&&a.selectedPaths.forEach(function(e){var a=e[e.length-1];t._lockedMeshInRAM.push(a),t._viewerController.hasMeshInRAM(a)||-1===s.indexOf(a)&&s.push(a)}),0===s.length&&(M.unsubscribe(v),v=null,h.removeEvent(y),y=null,e.onComplete())};i.length?t._viewerController.forceReferencesLoad({ids:i,callback:function(){D||n()}}):D||n()}else D||(window.console.log("MCmd: MinMax fails (no candidates)"),h.removeEvent(y),y=null,e.onFailure({cause:"noresult"}))},function(){window.console.log("MCmd: MinMax fails (reject)"),h.removeEvent(y),y=null,e.onFailure({cause:"index"})})}else window.console.log("MCmd: MinMax fails (roots)"),e.onFailure({cause:"roots"})},_switchNodeVisu:function(e){var t=this,a=[],i=[],s=!1;if(e.nodes_cgr&&e.nodes_cgr.length>0||e.nodes_MIR&&e.nodes_MIR.length>0){var n=null,l=null,o=!1,u=g.getContextViewer({viewer:t.getFrameWindow().getViewer()}),c=g.giveEventsController({viewer:t.getFrameWindow().getViewer()});c&&(l=c.addEvent(A.Events.EXPEndProgressiveLoad,function(a){a.memoryFull&&!s&&(o||(s=!0,t._viewerController.setForceReferencesLoad({data:i.map(function(e){return{id:e,state:!1}})}),u.unsubscribe(n),window.console.log("MCmd (full mem): rep loading fails"),c.removeEvent(l),e.onFailure("fullMemory")))}));var d=function(a){o=!1;var r=a.length,d=[],m=0;n=u.subscribe({event:"onRepresentationLoaded"},function(a){-1!==d.indexOf(a)&&t._viewerController.hasMeshInRAM(a)&&(s?(c.removeEvent(l),u.unsubscribe(n)):++m===d.length&&(t._viewerController.setForceReferencesLoad({data:i.map(function(e){return{id:e,state:!1}})}),c.removeEvent(l),u.unsubscribe(n),o=!0,setTimeout(e.onComplete(),0)))});for(var p=0;p<r;p++)-1===t._lockedNodes.indexOf(a[p])&&(t._viewerController.lockNodes({ids:[a[p]]}),t._lockedNodes.push(a[p])),-1===t._lockedMeshInRAM.indexOf(a[p])&&(t._viewerController.lockRepresentationMeshInRAM(a[p]),t._lockedMeshInRAM.push(a[p]),t._viewerController.hasMeshInRAM(a[p])||d.push(a[p]));0===d.length&&(t._viewerController.setForceReferencesLoad({data:i.map(function(e){return{id:e,state:!1}})}),u.unsubscribe(n),c.removeEvent(l),e.onComplete())};e.nodes_cgr.length>0?(e.nodes_cgr.forEach(function(e){a.push({node:e,stream:"cgr"}),-1!==i.indexOf(r.getNodeID(e))&&i.push(r.getNodeID(e))}),this._viewerController.setForceReferencesLoad({data:i.map(function(e){return{id:e,state:!0}}),callback:function(){t._viewerController.switchNodeVisuStreamOnDemand({data:a,callbacks:{onComplete:function(){if(o=!0,"ProgressiveFull"===t._getViewerLoadingMode()||"ProgressiveLarge"===t._getViewerLoadingMode()){var a=[];e.nodes_cgr.forEach(function(e){var t=r.getNodeID(e);-1===a.indexOf(t)&&a.push(t)}),e.nodes_MIR&&e.nodes_MIR.forEach(function(e){-1===a.indexOf(e)&&a.push(e)}),d(a)}else c.removeEvent(l),e.onComplete(!0)},onFailure:function(){window.console.log("MCmd: switchNode fails"),t._viewerController.setForceReferencesLoad({data:i.map(function(e){return{id:e,state:!1}})}),c.removeEvent(l),e.onFailure()}}})}})):e.nodes_MIR.length>0&&d(e.nodes_MIR)}else e.onFailure()},asyncReadPref:async function(e,t){if(e){try{let t=await I.readPreferences([{Repository:"MeasureRepository"}]);if(t.repositories.length>0&&t.repositories[0]&&t.repositories[0].preferences)for(var a=t.repositories[0].preferences.length,i=0;i<a;i++){var r;switch(t.repositories[0].preferences[i].datatype.toLowerCase()){case"string":r=JSON.parse(t.repositories[0].preferences[i].value);break;case"boolean":r="true"===t.repositories[0].preferences[i].value.toLowerCase();break;case"float":r=parseFloat(t.repositories[0].preferences[i].value);break;case"integer":r=parseInt(t.repositories[0].preferences[i].value);break;default:r=t.repositories[0].preferences[i].value}e._preferences.push({name:t.repositories[0].preferences[i].name,value:r})}}catch(t){window.console.log(t),e._preferences=e.getDefaultPreference()}if(g.getReviewContext({viewer:e.getFrameWindow().getViewer()}))for(var s=0;s<e._preferences.length;s++)if("DMUMeasureRemovePreviousNonPersistent"===e._preferences[s].name){e._removePreviousNonPersistent=!1,e._preferences[s].value&&(e._removePreviousNonPersistent=!0);break}t&&t()}},getDefaultPreference:function(){return[{name:"Coordinates_DisplayType",value:"MainValue"},{name:"Coordinates_MeasureType",value:!1},{name:"Coordinates_Unit",value:!0},{name:"Coordinates_ApproximatedValueSymbol",value:!1},{name:"Coordinates_Selection",value:!1},{name:"Coordinates_ComputationMode",value:!0},{name:"Line_Length_DisplayType",value:"MainValue"},{name:"Line_Length_MeasureType",value:!1},{name:"Line_Length_Unit",value:!0},{name:"Line_Length_ApproximatedValueSymbol",value:!1},{name:"Line_Length_Point1",value:!0},{name:"Line_Length_Point2",value:!0},{name:"Line_Length_Direction",value:!0},{name:"Line_Length_Selection",value:!1},{name:"Line_Length_ComputationMode",value:!1},{name:"Curve_Length_DisplayType",value:"MainValue"},{name:"Curve_Length_MeasureType",value:!0},{name:"Curve_Length_Unit",value:!0},{name:"Curve_Length_ApproximatedValueSymbol",value:!1},{name:"Curve_Length_Point1",value:!0},{name:"Curve_Length_Point2",value:!0},{name:"Curve_Length_Selection",value:!1},{name:"Curve_Length_ComputationMode",value:!1},{name:"Arc_Length_DisplayType",value:"MainValue"},{name:"Arc_Length_MeasureType",value:!0},{name:"Arc_Length_Unit",value:!0},{name:"Arc_Length_ApproximatedValueSymbol",value:!1},{name:"Arc_Length_Point1",value:!0},{name:"Arc_Length_Point2",value:!0},{name:"Arc_Length_Radius",value:!0},{name:"Arc_Length_Diameter",value:!1},{name:"Arc_Length_Selection",value:!1},{name:"Arc_Length_ComputationMode",value:!1},{name:"Cylinder_Length_DisplayType",value:"MainValue"},{name:"Cylinder_Length_MeasureType",value:!1},{name:"Cylinder_Length_Unit",value:!0},{name:"Cylinder_Length_ApproximatedValueSymbol",value:!1},{name:"Cylinder_Length_Point1",value:!1},{name:"Cylinder_Length_Point2",value:!1},{name:"Cylinder_Length_Direction",value:!1},{name:"Cylinder_Length_Radius",value:!1},{name:"Cylinder_Length_Diameter",value:!0},{name:"Cylinder_Length_Area",value:!1},{name:"Cylinder_Length_CenterOfGravity",value:!1},{name:"Cylinder_Length_Selection",value:!1},{name:"Cylinder_Length_ComputationMode",value:!1},{name:"Cone_Length_DisplayType",value:"MainValue"},{name:"Cone_Length_MeasureType",value:!1},{name:"Cone_Length_Unit",value:!0},{name:"Cone_Length_ApproximatedValueSymbol",value:!1},{name:"Cone_Length_Point1",value:!1},{name:"Cone_Length_Point2",value:!1},{name:"Cone_Length_Direction",value:!1},{name:"Cone_Length_Angle",value:!1},{name:"Cone_Length_HalfAngle",value:!0},{name:"Cone_Length_Apex",value:!1},{name:"Cone_Length_MinRadius",value:!1},{name:"Cone_Length_MaxRadius",value:!1},{name:"Cone_Length_MinDiameter",value:!0},{name:"Cone_Length_MaxDiameter",value:!0},{name:"Cone_Length_Area",value:!1},{name:"Cone_Length_CenterOfGravity",value:!1},{name:"Cone_Length_Selection",value:!1},{name:"Cone_Length_ComputationMode",value:!1},{name:"Distance_DisplayType",value:"MainValue"},{name:"Distance_MeasureType",value:!1},{name:"Distance_Unit",value:!0},{name:"Distance_ApproximatedValueSymbol",value:!1},{name:"Distance_Point1",value:!0},{name:"Distance_Point2",value:!0},{name:"Distance_Components",value:!1},{name:"Distance_Direction",value:!0},{name:"Distance_Selection1",value:!1},{name:"Distance_Selection2",value:!1},{name:"Distance_ComputationMode",value:!1},{name:"Min_Distance_DisplayType",value:"MainValue"},{name:"Min_Distance_MeasureType",value:!1},{name:"Min_Distance_Unit",value:!0},{name:"Min_Distance_ApproximatedValueSymbol",value:!1},{name:"Min_Distance_Point1",value:!0},{name:"Min_Distance_Point2",value:!0},{name:"Min_Distance_Components",value:!1},{name:"Min_Distance_Direction",value:!0},{name:"Min_Distance_Selection1",value:!1},{name:"Min_Distance_Selection2",value:!1},{name:"Min_Distance_ComputationMode",value:!1},{name:"Max_Distance_DisplayType",value:"MainValue"},{name:"Max_Distance_MeasureType",value:!0},{name:"Max_Distance_Unit",value:!0},{name:"Max_Distance_ApproximatedValueSymbol",value:!1},{name:"Max_Distance_Point1",value:!0},{name:"Max_Distance_Point2",value:!0},{name:"Max_Distance_Components",value:!1},{name:"Max_Distance_Direction",value:!0},{name:"Max_Distance_Selection1",value:!1},{name:"Max_Distance_Selection2",value:!1},{name:"Max_Distance_ComputationMode",value:!1},{name:"Local_Min_Distance_DisplayType",value:"MainValue"},{name:"Local_Min_Distance_MeasureType",value:!1},{name:"Local_Min_Distance_Unit",value:!0},{name:"Local_Min_Distance_ApproximatedValueSymbol",value:!1},{name:"Local_Min_Distance_Point1",value:!0},{name:"Local_Min_Distance_Point2",value:!0},{name:"Local_Min_Distance_Components",value:!1},{name:"Local_Min_Distance_Direction",value:!0},{name:"Local_Min_Distance_Selection1",value:!1},{name:"Local_Min_Distance_Selection2",value:!1},{name:"Local_Min_Distance_ComputationMode",value:!1},{name:"Local_Max_Distance_DisplayType",value:"MainValue"},{name:"Local_Max_Distance_MeasureType",value:!0},{name:"Local_Max_Distance_Unit",value:!0},{name:"Local_Max_Distance_ApproximatedValueSymbol",value:!1},{name:"Local_Max_Distance_Point1",value:!0},{name:"Local_Max_Distance_Point2",value:!0},{name:"Local_Max_Distance_Components",value:!1},{name:"Local_Max_Distance_Direction",value:!0},{name:"Local_Max_Distance_Selection1",value:!1},{name:"Local_Max_Distance_Selection2",value:!1},{name:"Local_Max_Distance_ComputationMode",value:!1},{name:"Angle_Btw2Selections_DisplayType",value:"MainValue"},{name:"Angle_Btw2Selections_MeasureType",value:!1},{name:"Angle_Btw2Selections_Unit",value:!0},{name:"Angle_Btw2Selections_ApproximatedValueSymbol",value:!1},{name:"Angle_Btw2Selections_Center",value:!0},{name:"Angle_Btw2Selections_Selection1",value:!1},{name:"Angle_Btw2Selections_Selection2",value:!1},{name:"Angle_Btw2Selections_ComputationMode",value:!1},{name:"Angle_By3Pts_DisplayType",value:"MainValue"},{name:"Angle_By3Pts_MeasureType",value:!1},{name:"Angle_By3Pts_Unit",value:!0},{name:"Angle_By3Pts_ApproximatedValueSymbol",value:!1},{name:"Angle_By3Pts_Point1",value:!1},{name:"Angle_By3Pts_Point2",value:!1},{name:"Angle_By3Pts_Center",value:!0},{name:"Angle_By3Pts_ComputationMode",value:!1},{name:"Cone_Angle_DisplayType",value:"MainValue"},{name:"Cone_Angle_MeasureType",value:!1},{name:"Cone_Angle_Unit",value:!0},{name:"Cone_Angle_ApproximatedValueSymbol",value:!1},{name:"Cone_Angle_Point1",value:!1},{name:"Cone_Angle_Point2",value:!1},{name:"Cone_Angle_Length",value:!0},{name:"Cone_Angle_Direction",value:!1},{name:"Cone_Angle_Apex",value:!1},{name:"Cone_Angle_MinimumRadius",value:!1},{name:"Cone_Angle_MaximumRadius",value:!1},{name:"Cone_Angle_MinimumDiameter",value:!0},{name:"Cone_Angle_MaximumDiameter",value:!0},{name:"Cone_Angle_Area",value:!1},{name:"Cone_Angle_CenterOfGravity",value:!1},{name:"Cone_Angle_Selection",value:!1},{name:"Cone_Angle_ComputationMode",value:!1},{name:"Half_Angle_DisplayType",value:"MainValue"},{name:"Half_Angle_MeasureType",value:!1},{name:"Half_Angle_Unit",value:!0},{name:"Half_Angle_ApproximatedValueSymbol",value:!1},{name:"Half_Angle_Point1",value:!1},{name:"Half_Angle_Point2",value:!1},{name:"Half_Angle_Length",value:!0},{name:"Half_Angle_Direction",value:!1},{name:"Half_Angle_Apex",value:!1},{name:"Half_Angle_MinimumRadius",value:!1},{name:"Half_Angle_MaximumRadius",value:!1},{name:"Half_Angle_MinimumDiameter",value:!0},{name:"Half_Angle_MaximumDiameter",value:!0},{name:"Half_Angle_Area",value:!1},{name:"Half_Angle_CenterOfGravity",value:!1},{name:"Half_Angle_Selection",value:!1},{name:"Half_Angle_ComputationMode",value:!1},{name:"Radius_DisplayType",value:"MainValue"},{name:"Radius_MeasureType",value:!1},{name:"Radius_Unit",value:!0},{name:"Radius_ApproximatedValueSymbol",value:!1},{name:"Radius_Center",value:!0},{name:"Radius_ArcLength",value:!0},{name:"Radius_CirclePerimeter",value:!1},{name:"Radius_Selection",value:!1},{name:"Radius_ComputationMode",value:!1},{name:"Cylinder_Radius_DisplayType",value:"MainValue"},{name:"Cylinder_Radius_MeasureType",value:!1},{name:"Cylinder_Radius_Unit",value:!0},{name:"Cylinder_Radius_ApproximatedValueSymbol",value:!1},{name:"Cylinder_Radius_Point1",value:!1},{name:"Cylinder_Radius_Point2",value:!1},{name:"Cylinder_Radius_Length",value:!0},{name:"Cylinder_Radius_Direction",value:!1},{name:"Cylinder_Radius_Area",value:!1},{name:"Cylinder_Radius_CenterOfGravity",value:!1},{name:"Cylinder_Radius_Selection",value:!1},{name:"Cylinder_Radius_ComputationMode",value:!1},{name:"Sphere_Radius_DisplayType",value:"MainValue"},{name:"Sphere_Radius_MeasureType",value:!1},{name:"Sphere_Radius_Unit",value:!0},{name:"Sphere_Radius_ApproximatedValueSymbol",value:!1},{name:"Sphere_Radius_Center",value:!0},{name:"Sphere_Radius_Area",value:!1},{name:"Sphere_Radius_Selection",value:!1},{name:"Sphere_Radius_ComputationMode",value:!1},{name:"Min_Radius_DisplayType",value:"MainValue"},{name:"Min_Radius_MeasureType",value:!1},{name:"Min_Radius_Unit",value:!0},{name:"Min_Radius_ApproximatedValueSymbol",value:!1},{name:"Min_Radius_Point1",value:!1},{name:"Min_Radius_Point2",value:!1},{name:"Min_Radius_Length",value:!0},{name:"Min_Radius_Direction",value:!1},{name:"Min_Radius_Angle",value:!1},{name:"Min_Radius_HalfAngle",value:!0},{name:"Min_Radius_Apex",value:!1},{name:"Min_Radius_MaximumRadius",value:!0},{name:"Min_Radius_Area",value:!1},{name:"Min_Radius_CenterOfGravity",value:!1},{name:"Min_Radius_Selection",value:!1},{name:"Min_Radius_ComputationMode",value:!1},{name:"Max_Radius_DisplayType",value:"MainValue"},{name:"Max_Radius_MeasureType",value:!1},{name:"Max_Radius_Unit",value:!0},{name:"Max_Radius_ApproximatedValueSymbol",value:!1},{name:"Max_Radius_Point1",value:!1},{name:"Max_Radius_Point2",value:!1},{name:"Max_Radius_Length",value:!0},{name:"Max_Radius_Direction",value:!1},{name:"Max_Radius_Angle",value:!1},{name:"Max_Radius_HalfAngle",value:!0},{name:"Max_Radius_Apex",value:!1},{name:"Max_Radius_MinimumRadius",value:!0},{name:"Max_Radius_Area",value:!1},{name:"Max_Radius_CenterOfGravity",value:!1},{name:"Max_Radius_Selection",value:!1},{name:"Max_Radius_ComputationMode",value:!1},{name:"Radius_By3Pts_DisplayType",value:"MainValue"},{name:"Radius_By3Pts_MeasureType",value:!1},{name:"Radius_By3Pts_Unit",value:!0},{name:"Radius_By3Pts_ApproximatedValueSymbol",value:!1},{name:"Radius_By3Pts_Point1",value:!1},{name:"Radius_By3Pts_Point2",value:!1},{name:"Radius_By3Pts_Point3",value:!1},{name:"Radius_By3Pts_Center",value:!0},{name:"Radius_By3Pts_ComputationMode",value:!1},{name:"Diameter_DisplayType",value:"MainValue"},{name:"Diameter_MeasureType",value:!1},{name:"Diameter_Unit",value:!0},{name:"Diameter_ApproximatedValueSymbol",value:!1},{name:"Diameter_Center",value:!0},{name:"Diameter_ArcLength",value:!0},{name:"Diameter_CirclePerimeter",value:!1},{name:"Diameter_Selection",value:!1},{name:"Diameter_ComputationMode",value:!1},{name:"Cylinder_Diameter_DisplayType",value:"MainValue"},{name:"Cylinder_Diameter_MeasureType",value:!1},{name:"Cylinder_Diameter_Unit",value:!0},{name:"Cylinder_Diameter_ApproximatedValueSymbol",value:!1},{name:"Cylinder_Diameter_Point1",value:!1},{name:"Cylinder_Diameter_Point2",value:!1},{name:"Cylinder_Diameter_Length",value:!0},{name:"Cylinder_Diameter_Direction",value:!1},{name:"Cylinder_Diameter_Area",value:!1},{name:"Cylinder_Diameter_CenterOfGravity",value:!1},{name:"Cylinder_Diameter_Selection",value:!1},{name:"Cylinder_Diameter_ComputationMode",value:!1},{name:"Sphere_Diameter_DisplayType",value:"MainValue"},{name:"Sphere_Diameter_MeasureType",value:!1},{name:"Sphere_Diameter_Unit",value:!0},{name:"Sphere_Diameter_ApproximatedValueSymbol",value:!1},{name:"Sphere_Diameter_Center",value:!0},{name:"Sphere_Diameter_Area",value:!1},{name:"Sphere_Diameter_Selection",value:!1},{name:"Sphere_Diameter_ComputationMode",value:!1},{name:"Min_Diameter_DisplayType",value:"MainValue"},{name:"Min_Diameter_MeasureType",value:!1},{name:"Min_Diameter_Unit",value:!0},{name:"Min_Diameter_ApproximatedValueSymbol",value:!1},{name:"Min_Diameter_Point1",value:!1},{name:"Min_Diameter_Point2",value:!1},{name:"Min_Diameter_Length",value:!0},{name:"Min_Diameter_Direction",value:!1},{name:"Min_Diameter_Angle",value:!1},{name:"Min_Diameter_HalfAngle",value:!0},{name:"Min_Diameter_Apex",value:!1},{name:"Min_Diameter_MaximumRadius",value:!0},{name:"Min_Diameter_Area",value:!1},{name:"Min_Diameter_CenterOfGravity",value:!1},{name:"Min_Diameter_Selection",value:!1},{name:"Min_Diameter_ComputationMode",value:!1},{name:"Max_Diameter_DisplayType",value:"MainValue"},{name:"Max_Diameter_MeasureType",value:!1},{name:"Max_Diameter_Unit",value:!0},{name:"Max_Diameter_ApproximatedValueSymbol",value:!1},{name:"Max_Diameter_Point1",value:!1},{name:"Max_Diameter_Point2",value:!1},{name:"Max_Diameter_Length",value:!0},{name:"Max_Diameter_Direction",value:!1},{name:"Max_Diameter_Angle",value:!1},{name:"Max_Diameter_HalfAngle",value:!0},{name:"Max_Diameter_Apex",value:!1},{name:"Max_Diameter_MinimumRadius",value:!0},{name:"Max_Diameter_Area",value:!1},{name:"Max_Diameter_CenterOfGravity",value:!1},{name:"Max_Diameter_Selection",value:!1},{name:"Max_Diameter_ComputationMode",value:!1},{name:"Diameter_By3Pts_DisplayType",value:"MainValue"},{name:"Diameter_By3Pts_MeasureType",value:!1},{name:"Diameter_By3Pts_Unit",value:!0},{name:"Diameter_By3Pts_ApproximatedValueSymbol",value:!1},{name:"Diameter_By3Pts_Point1",value:!1},{name:"Diameter_By3Pts_Point2",value:!1},{name:"Diameter_By3Pts_Point3",value:!1},{name:"Diameter_By3Pts_Center",value:!0},{name:"Diameter_By3Pts_ComputationMode",value:!1},{name:"Surface_Area_DisplayType",value:"MainValue"},{name:"Surface_Area_MeasureType",value:!0},{name:"Surface_Area_Unit",value:!0},{name:"Surface_Area_ApproximatedValueSymbol",value:!1},{name:"Surface_Area_CenterOfGravity",value:!0},{name:"Surface_Area_Selection",value:!1},{name:"Surface_Area_ComputationMode",value:!1},{name:"PlanarSurface_Area_DisplayType",value:"MainValue"},{name:"PlanarSurface_Area_MeasureType",value:!0},{name:"PlanarSurface_Area_Unit",value:!0},{name:"PlanarSurface_Area_ApproximatedValueSymbol",value:!1},{name:"PlanarSurface_Area_CenterOfGravity",value:!0},{name:"PlanarSurface_Area_Equation",value:!1},{name:"PlanarSurface_Area_Selection",value:!1},{name:"PlanarSurface_Area_ComputationMode",value:!1},{name:"Product_Area_DisplayType",value:"MainValue"},{name:"Product_Area_MeasureType",value:!0},{name:"Product_Area_Unit",value:!0},{name:"Product_Area_ApproximatedValueSymbol",value:!1},{name:"Product_Area_Volume",value:!0},{name:"Product_Area_CenterOfGravity",value:!0},{name:"Product_Area_Selection",value:!1},{name:"Product_Area_ComputationMode",value:!1},{name:"Volume_DisplayType",value:"MainValue"},{name:"Volume_MeasureType",value:!0},{name:"Volume_Unit",value:!0},{name:"Volume_ApproximatedValueSymbol",value:!1},{name:"Volume_Area",value:!0},{name:"Volume_CenterOfGravity",value:!0},{name:"Volume_Selection",value:!1},{name:"Volume_ComputationMode",value:!1},{name:"Thickness_DisplayType",value:"MainValue"},{name:"Thickness_MeasureType",value:!1},{name:"Thickness_Unit",value:!0},{name:"Thickness_ApproximatedValueSymbol",value:!1},{name:"Thickness_Point1",value:!0},{name:"Thickness_Point2",value:!0},{name:"Thickness_Direction",value:!0},{name:"Thickness_Selection",value:!1},{name:"Thickness_ComputationMode",value:!1},{name:"Measure_GraphicProperties_Fill",value:!0},{name:"Measure_GraphicProperties_FillColor",value:"#368ec4"},{name:"Measure_GraphicProperties_FillTransparency",value:0},{name:"Measure_GraphicProperties_LineBorder",value:!1},{name:"Measure_GraphicProperties_LineColor",value:"#3D3D3D"},{name:"Measure_GraphicProperties_LineThickness",value:"1"},{name:"Measure_GraphicProperties_LineType",value:"Solid"},{name:"Measure_GraphicProperties_TextColor",value:"#ffffff"},{name:"Measure_GraphicProperties_TextSize",value:.0035},{name:"Measure_GraphicProperties_TextBold",value:!1},{name:"Measure_GraphicProperties_TextItalic",value:!1},{name:"DMUMeasureRemovePreviousNonPersistent",value:!1}]},managePOISelection:function(e){var t=!1;if(e&&e.pathElement&&r.isAPOIPath(e.pathElement)){var a=R.getPOIInformationFromPathElement(e.pathElement);if(a&&a.position)if(e.position=a.position.clone(),"Thickness"===this._arguments[0].ID){T.remove({pathElement:e.pathElement}),k.remove({pathElement:e.pathElement});var i=w.getSightDirfor3DPoint(this._viewer,a.position.clone()),s=new d.Ray(a.position.clone(),i),n=this._viewer.castRay(s,this._viewer.getRootNode(),"primHybrid"),l=0;for(l=0;l<n.length;l++){var o=!1,u=n[l].pathElement.getElement(0);if(void 0!==u.name&&"DMUReviewBag"===u.name&&(o=!0),!o&&n[l].distance<.001){e.pathElement=n[l].pathElement,e.normal=n[l].normal,L.add({pathElement:e.pathElement}),t=!0;break}}}else t=!0}return this._bPOISelection=t,t}})}),define("DS/DMUMeasure/DMUMeasureProperties",["UWA/Core","UWA/Class","DS/Controls/Toggle","DS/DMUMeasurable/DMUGeometryEnums","i18n!DS/DMUMeasure/assets/nls/DMUMeasure"],function(e,t,a,i,r){"use strict";return t.extend({init:function(t){var s,n,l,o=t._viewer,u=null,c=null,d=null,m=null,p=null,_=null,h=null,M=null,y=null,v=null,g=null,D=null,f=null,b=null,S=null,C=null,P=null,T=null,A=null,U=null,I=null,E=null,R=null,w=null,k=null,L=null,x=null,H=null,N=null,F=null,O=null,V=null,G=null,B=null,W=null,j=[],z=null,X=null,K=null;this.getPropertiesDisplay=function(t,q){var Y=!1,Q=!1,J=!1,Z=!1,$=!1,ee=!1,te=!1,ae=!1,ie=!1,re=!1,se=!1,ne=!1,le=!1,oe=!1,ue=!1,ce=!1,de=!1,me=!1,pe=!1,_e=!1,he=!1,Me=!1,ye=!1,ve=!1,ge=!1,De=!1,fe=!1,be=!1,Se=!1,Ce=!1,Pe=!1,Te=!1,Ae=!1;function Ue(e,t,i){return new a({label:r.properties[t],value:"dmu"+t+"type",type:"checkbox",checkFlag:e,mixedState:i})}function Ie(e){switch(e){case"point1":ie=!0;break;case"point2":re=!0;break;case"direction":se=!0;break;case"selection":ne=!0;break;case"computationMode":le=!0;break;case"radius":oe=!0;break;case"diameter":ue=!0;break;case"selection1":ce=!0;break;case"selection2":de=!0;break;case"point3":me=!0;break;case"area":pe=!0;break;case"centerOfGravity":ne=!0;break;case"angle":_e=!0;break;case"halfAngle":he=!0;break;case"apex":Me=!0;break;case"minRadius":case"MinimumRadius":ye=!0;break;case"maxRadius":case"MaximumRadius":ve=!0;break;case"minDiameter":case"MinimumDiameter":ge=!0;break;case"maxDiameter":case"MaximumDiameter":De=!0;break;case"components":fe=!0;break;case"center":be=!0;break;case"length":Se=!0;break;case"arcLength":Ce=!0;break;case"circlePerimeter":Pe=!0;break;case"equation":Te=!0;break;case"volume":Ae=!0}}var Ee=0;function Re(e){var t,a=e.getAttribute("lCustomization"),i=[],r=[];if(0===a.length)for(t=e.getMainValueType(),r=e.getCustoListAsPerMainValue(t),Ee=0;Ee<r.length;Ee++)switch(i[Ee]={custoName:r[Ee],custoValue:!0},t){case"Cylinder_Radius":case"Cylinder_Diameter":"length"===i[Ee].custoName&&(i[Ee].custoValue=!1);break;case"Min_Radius":case"Max_Radius":case"Min_Diameter":case"Max_Diameter":case"Half_Angle":case"Cone_Angle":case"Cone_Length":switch(i[Ee].custoName){case"length":case"angle":case"halfAngle":case"apex":case"minDiameter":case"maxDiameter":case"minRadius":case"maxRadius":case"MinimumDiameter":case"MaximumDiameter":case"MinimumRadius":case"MaximumRadius":i[Ee].custoValue=!1}}else i=a;return i}if(u=null,c=null,d=null,m=null,z=null,X=null,K=null,n=0,l=0,s=0,j=[],t){for(Ee=0;Ee<t.length;Ee++){var we=t[Ee].getAttribute("bShortDisplay");null===u?u=we:we!==u&&(u=void 0),we=t[Ee].getAttribute("bDisplayMeasureType"),null===c?c=we:we!==c&&(c=void 0),we=t[Ee].getAttribute("bDisplayUnit"),null===d?d=we:we!==d&&(d=void 0);var ke=!1;if(null==(z=t[Ee].getAttribute("sComputationMode"))){var Le=null,xe=null,He=t[Ee].getMeasurable(1),Ne=t[Ee].getAttribute("sType");"MeasureItem"===Ne?He&&He.getMode()!==i.Mode.EXACT&&(ke=!0):"MeasureBetween"===Ne?(Le=t[Ee].getMeasurable(2),He&&Le&&(He.getMode()!==i.Mode.EXACT||Le.getMode()!==i.Mode.EXACT)&&(ke=!0)):"MeasureThickness"===Ne?ke=!0:"Measure3PointsAngle"!==Ne&&"Measure3PointsCircle"!==Ne||(Le=t[Ee].getMeasurable(2),xe=t[Ee].getMeasurable(3),He&&Le&&xe&&(He.getMode()!==i.Mode.EXACT||Le.getMode()!==i.Mode.EXACT||xe.getMode()!==i.Mode.EXACT)&&(ke=!0))}else"Approximate"===z&&(ke=!0);ke&&(we=t[Ee].getAttribute("bDisplayApproximateSymbol"),null===m?m=we:we!==m&&(m=void 0),s++),X=t[Ee].getAttribute("fRadius"),K=t[Ee].getAttribute("fVolume"),void 0!==X&&n++,void 0!==K&&l++}void 0===u?$=!0:Y=u,void 0===c?ee=!0:Q=c,void 0===d?te=!0:J=d,void 0===m?ae=!0:Z=m,p=new a({label:r.properties.mainValue,value:"DMUMainValue",type:"radio",checkFlag:Y,mixedState:$}).inject(q);var Fe=e.createElement("div",{styles:{"margin-left":"25px"}}).inject(q);Fe&&(_=new a({label:r.properties.measureType,value:"DMUMeasureTypeValue",type:"checkbox",checkFlag:Q,mixedState:ee}).inject(Fe),h=new a({label:r.properties.unit,value:"DMUMainValue",type:"checkbox",checkFlag:J,mixedState:te}).inject(Fe),s===t.length&&(M=new a({label:r.properties.approximateSymbol,value:"DMUApproximateSymbol",type:"checkbox",checkFlag:Z,mixedState:ae}).inject(Fe)),Y||(h.disabled=!0,_.disabled=!0,M&&(M.disabled=!0))),y=new a({label:r.properties.extendedDisplay,value:"DMUExtendedDisplayValue",type:"radio",checkFlag:!Y,mixedState:$}).inject(q);var Oe=e.createElement("div",{styles:{"margin-left":"25px"}}).inject(q),Ve=Re(t[0]);if(1===t.length)j=Ve;else for(var Ge=0;Ge<Ve.length;Ge++)for(var Be=!1,We=1;We<t.length;We++){for(var je=Re(t[We]),ze=0;ze<je.length;ze++)Ve[Ge].custoName===je[ze].custoName&&(Be=!0,We===t.length-1&&j.push(Ve[Ge]),Ve[Ge].custoValue!==je[ze].custoValue&&Ie(Ve[Ge].custoName));if(!Be)break}for(Ee=0;Ee<j.length;Ee++){var Xe=j[Ee].custoValue;switch(j[Ee].custoName){case"point1":ie&&(Xe=!1),(v=Ue(Xe,"point1",ie)).inject(Oe);break;case"point2":re&&(Xe=!1),(g=Ue(Xe,"point2",re)).inject(Oe);break;case"direction":se&&(Xe=!1),(D=Ue(Xe,"direction",se)).inject(Oe);break;case"selection":ne&&(Xe=!1),(f=Ue(Xe,"selection",ne)).inject(Oe);break;case"computationMode":le&&(Xe=!1),(b=Ue(Xe,"computationMode",le)).inject(Oe);break;case"radius":oe&&(Xe=!1),(S=Ue(Xe,"radius",oe)).inject(Oe);break;case"diameter":ue&&(Xe=!1),(C=Ue(Xe,"diameter",ue)).inject(Oe);break;case"selection1":ce&&(Xe=!1),(P=Ue(Xe,"selection1",ce)).inject(Oe);break;case"selection2":de&&(Xe=!1),(T=Ue(Xe,"selection2",de)).inject(Oe);break;case"point3":me&&(Xe=!1),(A=Ue(Xe,"point3",me)).inject(Oe);break;case"area":pe&&(Xe=!1),(U=Ue(Xe,"area",pe)).inject(Oe);break;case"centerOfGravity":_e&&(Xe=!1),(I=Ue(Xe,"centerOfGravity",_e)).inject(Oe);break;case"angle":0,(E=Ue(Xe,"angle",!1)).inject(Oe);break;case"halfAngle":he&&(Xe=!1),(R=Ue(Xe,"halfAngle",he)).inject(Oe);break;case"apex":Me&&(Xe=!1),(w=Ue(Xe,"apex",Me)).inject(Oe);break;case"minRadius":case"MinimumRadius":n===t.length&&(ye&&(Xe=!1),(k=Ue(Xe,"minRadius",ye)).inject(Oe));break;case"maxRadius":case"MaximumRadius":ve&&(Xe=!1),(L=Ue(Xe,"maxRadius",ve)).inject(Oe);break;case"minDiameter":case"MinimumDiameter":n===t.length&&(ge&&(Xe=!1),(x=Ue(Xe,"minDiameter",ge)).inject(Oe));break;case"maxDiameter":case"MaximumDiameter":De&&(Xe=!1),(H=Ue(Xe,"maxDiameter",De)).inject(Oe);break;case"components":fe&&(Xe=!1),(N=Ue(Xe,"components",fe)).inject(Oe);break;case"center":be&&(Xe=!1),(F=Ue(Xe,"center",be)).inject(Oe);break;case"length":Se&&(Xe=!1),(O=Ue(Xe,"length",Se)).inject(Oe);break;case"arcLength":Ce&&(Xe=!1),(V=Ue(Xe,"arcLength",Ce)).inject(Oe);break;case"circlePerimeter":Pe&&(Xe=!1),(G=Ue(Xe,"circlePerimeter",Pe)).inject(Oe);break;case"equation":Te&&(Xe=!1),(B=Ue(Xe,"equation",Te)).inject(Oe);break;case"volume":l===t.length&&(Ae&&(Xe=!1),(W=Ue(Xe,"volume",Ae)).inject(Oe))}}Y&&(v&&(v.disabled=!0),g&&(g.disabled=!0),D&&(D.disabled=!0),f&&(f.disabled=!0),b&&(b.disabled=!0),S&&(S.disabled=!0),C&&(C.disabled=!0),P&&(P.disabled=!0),T&&(T.disabled=!0),A&&(A.disabled=!0),U&&(U.disabled=!0),I&&(I.disabled=!0),E&&(E.disabled=!0),R&&(R.disabled=!0),w&&(w.disabled=!0),k&&(k.disabled=!0),L&&(L.disabled=!0),x&&(x.disabled=!0),H&&(H.disabled=!0),N&&(N.disabled=!0),F&&(F.disabled=!0),O&&(O.disabled=!0),V&&(V.disabled=!0),G&&(G.disabled=!0),B&&(B.disabled=!0),W&&(W.disabled=!0))}p.addEventListener("buttonclick",function(){h.disabled=!1,_.disabled=!1,M&&(M.disabled=!1),v&&(v.disabled=!0),g&&(g.disabled=!0),D&&(D.disabled=!0),f&&(f.disabled=!0),b&&(b.disabled=!0),S&&(S.disabled=!0),C&&(C.disabled=!0),P&&(P.disabled=!0),T&&(T.disabled=!0),A&&(A.disabled=!0),U&&(U.disabled=!0),I&&(I.disabled=!0),E&&(E.disabled=!0),R&&(R.disabled=!0),w&&(w.disabled=!0),k&&(k.disabled=!0),L&&(L.disabled=!0),x&&(x.disabled=!0),H&&(H.disabled=!0),N&&(N.disabled=!0),F&&(F.disabled=!0),O&&(O.disabled=!0),V&&(V.disabled=!0),G&&(G.disabled=!0),B&&(B.disabled=!0),W&&(W.disabled=!0)}),y.addEventListener("buttonclick",function(){h.disabled=!0,_.disabled=!0,M&&(M.disabled=!0),v&&(v.disabled=!1),g&&(g.disabled=!1),D&&(D.disabled=!1),f&&(f.disabled=!1),b&&(b.disabled=!1),S&&(S.disabled=!1),C&&(C.disabled=!1),P&&(P.disabled=!1),T&&(T.disabled=!1),A&&(A.disabled=!1),U&&(U.disabled=!1),I&&(I.disabled=!1),E&&(E.disabled=!1),R&&(R.disabled=!1),w&&(w.disabled=!1),k&&(k.disabled=!1),L&&(L.disabled=!1),x&&(x.disabled=!1),H&&(H.disabled=!1),N&&(N.disabled=!1),F&&(F.disabled=!1),O&&(O.disabled=!1),V&&(V.disabled=!1),G&&(G.disabled=!1),B&&(B.disabled=!1),W&&(W.disabled=!1)}),this.getPropertiesToSet=function(){var e=[],t=p.checkFlag,a=p.mixedState;a||t===u||(e.push({name:"bShortDisplay",value:t}),u=t),t=_.checkFlag,(a=_.mixedState)||t===c||(e.push({name:"bDisplayMeasureType",value:t}),c=t),t=h.checkFlag,(a=h.mixedState)||t===d||(e.push({name:"bDisplayUnit",value:t}),d=t),M&&(t=M.checkFlag,(a=M.mixedState)||t===m||(e.push({name:"bDisplayApproximateSymbol",value:t}),m=t));var i=[],r=0;for(Ee=0;Ee<j.length;Ee++)switch(j[Ee].custoName){case"point1":v&&!v.mixedState&&(i[r]=j[Ee],i[r++].custoValue=v.checkFlag);break;case"point2":g&&!g.mixedState&&(i[r]=j[Ee],i[r++].custoValue=g.checkFlag);break;case"direction":D&&!D.mixedState&&(i[r]=j[Ee],i[r++].custoValue=D.checkFlag);break;case"selection":f&&!f.mixedState&&(i[r]=j[Ee],i[r++].custoValue=f.checkFlag);break;case"computationMode":b&&!b.mixedState&&(i[r]=j[Ee],i[r++].custoValue=b.checkFlag);break;case"radius":S&&!S.mixedState&&(i[r]=j[Ee],i[r++].custoValue=S.checkFlag);break;case"diameter":C&&!C.mixedState&&(i[r]=j[Ee],i[r++].custoValue=C.checkFlag);break;case"selection1":P&&!P.mixedState&&(i[r]=j[Ee],i[r++].custoValue=P.checkFlag);break;case"selection2":T&&!T.mixedState&&(i[r]=j[Ee],i[r++].custoValue=T.checkFlag);break;case"point3":A&&!A.mixedState&&(i[r]=j[Ee],i[r++].custoValue=A.checkFlag);break;case"area":U&&!U.mixedState&&(i[r]=j[Ee],i[r++].custoValue=U.checkFlag);break;case"centerOfGravity":I&&!I.mixedState&&(i[r]=j[Ee],i[r++].custoValue=I.checkFlag);break;case"angle":E&&!E.mixedState&&(i[r]=j[Ee],i[r++].custoValue=E.checkFlag);break;case"halfAngle":R&&!R.mixedState&&(i[r]=j[Ee],i[r++].custoValue=R.checkFlag);break;case"apex":w&&!w.mixedState&&(i[r]=j[Ee],i[r++].custoValue=w.checkFlag);break;case"minRadius":case"MinimumRadius":k&&!k.mixedState&&(i[r]=j[Ee],i[r++].custoValue=k.checkFlag);break;case"maxRadius":case"MaximumRadius":L&&!L.mixedState&&(i[r]=j[Ee],i[r++].custoValue=L.checkFlag);break;case"minDiameter":case"MinimumDiameter":x&&!x.mixedState&&(i[r]=j[Ee],i[r++].custoValue=x.checkFlag);break;case"maxDiameter":case"MaximumDiameter":H&&!H.mixedState&&(i[r]=j[Ee],i[r++].custoValue=H.checkFlag);break;case"components":N&&!N.mixedState&&(i[r]=j[Ee],i[r++].custoValue=N.checkFlag);break;case"center":F&&!F.mixedState&&(i[r]=j[Ee],i[r++].custoValue=F.checkFlag);break;case"length":O&&!O.mixedState&&(i[r]=j[Ee],i[r++].custoValue=O.checkFlag);break;case"arcLength":V&&!V.mixedState&&(i[r]=j[Ee],i[r++].custoValue=V.checkFlag);break;case"circlePerimeter":G&&!G.mixedState&&(i[r]=j[Ee],i[r++].custoValue=G.checkFlag);break;case"equation":B&&!B.mixedState&&(i[r]=j[Ee],i[r++].custoValue=B.checkFlag);break;case"volume":W&&!W.mixedState&&(i[r]=j[Ee],i[r++].custoValue=W.checkFlag)}return e.push({name:"lCustomization",value:i}),e},this.afterSetProperties=function(e,t){if(e&&t)for(Ee=0;Ee<e.length;Ee++)e[Ee].getAttribute("bShortDisplay")?localStorage.setItem("DMUMeasureDisplayPreference","Short"):localStorage.setItem("DMUMeasureDisplayPreference","Extended"),e[Ee].refreshNode(),"Angle"===e[Ee].getAttribute("sDistanceType")&&e[Ee].updateAssistantToolPosition(),o&&o.render&&o.render()}},this.getCustomParameter=function(){return{resizableFlag:"vertical",heightToWidthRatio:j.length>5?1.2:0}}}})}),define("DS/DMUMeasure/DMUMeasureArcDisplayTypeCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager"],function(e,t,a){"use strict";return e.extend({init:function(e){this._parent(e);var i=this;this.beginExecute=function(){var e=t.getReviewContext({viewer:i.getFrameWindow().getViewer()});if(e){var r=a.get();if(r.length>0){for(var s=0;s<r.length;s++){var n=e.getDMUObjectFromPathElement(r[s].pathElement);if(n){var l;switch(this._id){case"DMUMeasureArcCenterDisplayHdr":l=0;break;case"DMUMeasureArcTangentDisplayHdr":l=1}void 0!==l&&(n.setAttribute("iRadiusResultDisplayType",l),n.updateGlobalRadiusResultDisplayPreference(l),n.refreshNode())}}a.empty(),i.getFrameWindow().getViewer().render()}}i.end?i.end():i.done()}}})}),define("DS/DMUMeasure/DMUMeasureExport",["require","exports","DS/DMUBaseExperience/EXPUtils"],function(e,t,a){"use strict";return class{static getObjectDefinition(e){let t={measurables:[]};for(let i=1;i<=3;i++)e.getMeasurable(i)&&t.measurables.push(e.getMeasurable(i).exportData(a.typeToStr));return t}}}),define("DS/DMUMeasure/DMUMeasureContextualBar",["DS/DMUBaseUI/DMUContextualBarAdapter","DS/DMUBaseExperience/DMUContextManager","DS/DMUMeasurable/DMUMeasureEnums","DS/Visualization/ThreeJS_DS","DS/CATWebUXComponents/DMUCommandsManager","DS/DMUBaseExperience/EXPUtils","DS/DMUMeasurable/DMUGeometryEnums","DS/WebappsUtils/WebappsUtils","i18n!DS/DMUMeasure/assets/nls/DMUMeasure"],function(e,t,a,i,r,s,n,l,o){"use strict";var u={Measure_DMUStylesStr:"Measure_DMUStylesList",Measure_DMUIncreaseFontSizeStr:"Measure_DMUIncreaseFontSizeHdr",Measure_DMUDecreaseFontSizeStr:"Measure_DMUDecreaseFontSizeHdr",DMUGraphicPropertiesPanelStr:"DMUGraphicPropertiesPanelHdr",DMUMeasureDeleteStr:"DMUMeasureDeleteHdr",DMUMeasureRadiusArcHdrStr:"MeasureRadiusArcHdr",DMUMeasureRadiusDiaHdrStr:"MeasureRadiusDiaHdr",DMUMeasureCylHdrStr:"MeasureCylHdr",DMUMeasureConeHdrStr:"MeasureConeHdr",DMUMeasureHalfConeHdrStr:"MeasureHalfConeHdr",DMUMeasureSphereHdrStr:"MeasureSphereHdr",DMUMeasurePrdHdrStr:"DMUMeasureProductAreaHdr",DMUMeasurePrdVolumeAreaHdrStr:"MeasurePrdVolumeAreaHdr",DMUMeasure3PointsHdrStr:"Measure3PointsHdr",DMUMeasureMinMaxHdrStr:"MeasureMinMaxHdr",DMUMeasureDistanceMinMaxHdrStr:"MeasureDistanceMinMaxHdr",DMUMeasureDistanceHdrStr:"DMUMeasureDistanceHdr",DMUMeasureAngleMinMaxHdrStr:"MeasureAngleMinMaxHdr",DMUMeasureMinMaxHdrStrLocal:"MeasureMinMaxLocalHdr",DMUMeasureDistanceMinMaxHdrStrLocal:"MeasureDistanceMinMaxLocalHdr",DMUMeasureDistanceHdrStrLocal:"MeasureDistanceLocalHdr",DMUMeasureAngleMinMaxHdrStrLocal:"MeasureAngleMinMaxLocalHdr"},c={submenuList:{DMUArrowLeaderHdr:{type:"RadioItem",identifier:"DMUArrowLeaderHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_LeaderArrow.png"},DMUBubbleLeaderHdr:{type:"RadioItem",identifier:"DMUBubbleLeaderHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_LeaderDot.png"},DMUCrossLeaderHdr:{type:"RadioItem",identifier:"DMUCrossLeaderHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_LeaderXCross.png"},DMUSquareLeaderHdr:{type:"RadioItem",identifier:"DMUSquareLeaderHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_LeaderSquare.png"},DMUNoEndLeaderHdr:{type:"RadioItem",identifier:"DMUNoEndLeaderHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_LeaderNoExtremity.png"},DMUNoLeaderHdr:{type:"RadioItem",identifier:"DMUNoLeaderHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_LeaderNoLeader.png"},DMUCrossPointTypeHdr:{type:"RadioItem",identifier:"DMUCrossPointTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_XCross.png"},DMUPlusPointTypeHdr:{type:"RadioItem",identifier:"DMUPlusPointTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_PCross.png"},DMUConcentricPointTypeHdr:{type:"RadioItem",identifier:"DMUConcentricPointTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_Concentric.png"},DMUCoincidentPointTypeHdr:{type:"RadioItem",identifier:"DMUCoincidentPointTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_Coincident.png"},DMUFullCirclePointTypeHdr:{type:"RadioItem",identifier:"DMUFullCirclePointTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_FCircle.png"},DMUFullSquarePointTypeHdr:{type:"RadioItem",identifier:"DMUFullSquarePointTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_FSquare.png"},DMUDotPointTypeHdr:{type:"RadioItem",identifier:"DMUDotPointTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_Dot.png"},DMUSmallDotPointTypeHdr:{type:"RadioItem",identifier:"DMUSmallDotPointTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_SmallDot.png"},DMUNonePointTypeHdr:{type:"RadioItem",identifier:"DMUNonePointTypeHdr",module:"DMUBaseCtxCommands"},DMUStarPointTypeHdr:{type:"RadioItem",identifier:"DMUStarPointTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_Star.png"},DMUNoneExtremityTypeHdr:{type:"RadioItem",identifier:"DMUNoneExtremityTypeHdr",module:"DMUBaseCtxCommands"},DMUSmallDotExtremityTypeHdr:{type:"RadioItem",identifier:"DMUSmallDotExtremityTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_SmallDot.png"},DMUDotExtremityTypeHdr:{type:"RadioItem",identifier:"DMUDotExtremityTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_Dot.png"},DMUStarExtremityTypeHdr:{type:"RadioItem",identifier:"DMUStarExtremityTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_Star.png"},DMUFullSquareExtremityTypeHdr:{type:"RadioItem",identifier:"DMUFullSquareExtremityTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_FSquare.png"},DMUFullCircleExtremityTypeHdr:{type:"RadioItem",identifier:"DMUFullCircleExtremityTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_FCircle.png"},DMUCoincidentExtremityTypeHdr:{type:"RadioItem",identifier:"DMUCoincidentExtremityTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_Coincident.png"},DMUConcentricExtremityTypeHdr:{type:"RadioItem",identifier:"DMUConcentricExtremityTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_Concentric.png"},DMUPlusExtremityTypeHdr:{type:"RadioItem",identifier:"DMUPlusExtremityTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_PCross.png"},DMUCrossExtremityTypeHdr:{type:"RadioItem",identifier:"DMUCrossExtremityTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_XCross.png"},DMUMeasureArcCenterDisplayHdr:{type:"PushItem",identifier:"DMUMeasureArcCenterDisplayHdr",module:"DMUMeasure",iconPath:"icons/32/I_CenterDisplay.png"},DMUMeasureArcTangentDisplayHdr:{type:"PushItem",identifier:"DMUMeasureArcTangentDisplayHdr",module:"DMUMeasure",iconPath:"icons/32/I_TangentDisplay.png"}},mainMenuList:{DMUHideShowHdr:{type:"PushItem",identifier:"DMUHideShowHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMUHideShow.png"},DMUCutHdr:{type:"PushItem",identifier:"DMUCutHdr",module:"DMUBaseCommands",iconPath:"icons/32/I_DMUCutCmd.png"},DMUCopyHdr:{type:"PushItem",identifier:"DMUCopyHdr",module:"DMUBaseCommands",iconPath:"icons/32/I_DMUCopyCmd.png"},DMUDeleteHdr:{type:"PushItem",identifier:"DMUDeleteHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMUDelete.png"},DMUSelectMeasuredPrdHdr:{type:"PushItem",identifier:"DMUSelectMeasuredPrdHdr",module:"DMUMeasure",iconPath:"icons/32/I_Meas_Product.png"},DMUPropertiesHdr:{type:"PushItem",identifier:"DMUPropertiesHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMUProperties.png"},DMUMeasureRemoveAllNonPersistentHdr:{type:"PushItem",identifier:"DMUMeasureRemoveAllNonPersistentHdr",module:"DMUMeasure"},DMUMeasureAngleSector1Hdr:{type:"RadioItem",identifier:"DMUMeasureAngleSector1Hdr",module:"DMUMeasure",iconPath:"icons/32/I_MeasureAngleSector1.png"},DMUMeasureAngleSector2Hdr:{type:"RadioItem",identifier:"DMUMeasureAngleSector2Hdr",module:"DMUMeasure",iconPath:"icons/32/I_MeasureAngleSector2.png"},DMUMeasureAngleSector3Hdr:{type:"RadioItem",identifier:"DMUMeasureAngleSector3Hdr",module:"DMUMeasure",iconPath:"icons/32/I_MeasureAngleSector3.png"},DMUMeasureAngleSector4Hdr:{type:"RadioItem",identifier:"DMUMeasureAngleSector4Hdr",module:"DMUMeasure",iconPath:"icons/32/I_MeasureAngleSector4.png"},DMUMeasureAngleSectorCHdr:{type:"CheckItem",identifier:"DMUMeasureAngleSectorCHdr",module:"DMUMeasure",iconPath:"icons/32/I_MeasureAngleComplementary.png"},DMULeaderStr:{type:"PushItem",identifier:"DMULeaderStr",module:"DMUMeasure"},DMUExtremityTypeStr:{type:"PushItem",identifier:"DMUExtremityTypeStr"},DMUPointTypeStr:{type:"PushItem",identifier:"DMUPointTypeStr"},DMUMeasureDimensionRepresentationHdr:{type:"PushItem",identifier:"DMUMeasureDimensionRepresentationHdr"}}},d=function(e){return e&&e.getComponent?e.getComponent(WAfrStandardComponentKey.HandlerComponent):void 0};return e.extend({getSharedContextualCommandList:function(e){var t=[];return e&&e.length&&e.forEach(function(e){-1===t.indexOf(e.getType())&&t.push(e.getType())}),1===t.length&&-1!==t[0].indexOf("DMUMeasure")?this.getContextualCommandList():[]},getCmdHdrsFor2DGeometries:function(){var e,t,i,r=[];if("MeasureBetween"===this._sType){switch(e="DMUMeasureMinDistanceHdr",this.getAttribute("sDistanceType")){case"Distance":e="DMUMeasureDistanceHdr";break;case"Angle":e="DMUMeasureAngleHdr";break;case"MaximumDistance":e="DMUMeasureMaxDistanceHdr";break;case"LocalMinimumDistance":e="DMUMeasureLocalMinDistanceHdr";break;case"LocalMaximumDistance":e="DMUMeasureLocalMaxDistanceHdr"}t=this._sMeasurable1.getType(),i=this._sMeasurable2.getType();var s=this.getAttribute("sSelectedType1"),l=this.getAttribute("sSelectedType2"),o=!this._objAction&&(s===a.ViewedType.POINT||s===a.ViewedType.CENTER)||t===n.GeometryType.POINT,u=!this._objAction&&(l===a.ViewedType.POINT||l===a.ViewedType.CENTER)||i===n.GeometryType.POINT;if(o&&u);else if(o&&(i===n.GeometryType.LINE||i===n.GeometryType.CURVE||i===n.GeometryType.SURFACE||i===n.GeometryType.PRODUCT)||(t===n.GeometryType.LINE||t===n.GeometryType.CURVE||t===n.GeometryType.SURFACE||t===n.GeometryType.PRODUCT)&&u)r=[{name:"DMUMeasureMinMaxHdrStr",line:1,hdr_list:["DMUMeasureMinDistanceHdr","DMUMeasureMaxDistanceHdr"],selectedHdr:e}];else if(o&&(i===n.GeometryType.CIRCLE||i===n.GeometryType.PLANE||i===n.GeometryType.CYLINDER||i===n.GeometryType.CONE||i===n.GeometryType.SPHERE)||(t===n.GeometryType.CIRCLE||t===n.GeometryType.PLANE||t===n.GeometryType.CYLINDER||t===n.GeometryType.CONE||t===n.GeometryType.SPHERE)&&u)r=[{name:"DMUMeasureDistanceMinMaxHdrStr",line:1,hdr_list:["DMUMeasureDistanceHdr","DMUMeasureMinDistanceHdr","DMUMeasureMaxDistanceHdr"],selectedHdr:e}];else if(t===n.GeometryType.CIRCLE||i===n.GeometryType.CIRCLE)r=[{name:"DMUMeasureDistanceMinMaxHdrStr",line:1,hdr_list:["DMUMeasureDistanceHdr","DMUMeasureMinDistanceHdr","DMUMeasureMaxDistanceHdr"],selectedHdr:e}];else if(t===n.GeometryType.POINT&&i===n.GeometryType.POINT)r=[{name:"DMUMeasureDistanceHdrStr",line:1,hdr_list:["DMUMeasureDistanceHdr"]}];else if(t===n.GeometryType.PRODUCT&&(i===n.GeometryType.PRODUCT||i===n.GeometryType.SURFACE||i===n.GeometryType.PLANE||i===n.GeometryType.CURVE||i===n.GeometryType.LINE||i===n.GeometryType.CYLINDER||i===n.GeometryType.CONE||u)||(t===n.GeometryType.SURFACE||t===n.GeometryType.PLANE||t===n.GeometryType.CURVE||t===n.GeometryType.LINE||t===n.GeometryType.CYLINDER||t===n.GeometryType.CONE||o)&&i===n.GeometryType.PRODUCT||t===n.GeometryType.SURFACE&&(i===n.GeometryType.SURFACE||i===n.GeometryType.PLANE||i===n.GeometryType.CURVE||i===n.GeometryType.LINE||u)||(t===n.GeometryType.PLANE||t===n.GeometryType.CURVE||t===n.GeometryType.LINE||o)&&i===n.GeometryType.SURFACE||t===n.GeometryType.PLANE&&i===n.GeometryType.CURVE||t===n.GeometryType.CURVE&&(i===n.GeometryType.CURVE||i===n.GeometryType.PLANE||i===n.GeometryType.LINE||u)||t===n.GeometryType.LINE&&u||o&&i===n.GeometryType.LINE)r=[{name:"DMUMeasureMinMaxHdrStr",line:1,hdr_list:["DMUMeasureMinDistanceHdr","DMUMeasureMaxDistanceHdr"],selectedHdr:e}];else{var c=!1;this.getAttribute("fAngle")>0&&(c=!0),r=c?[{name:"DMUMeasureAngleMinMaxHdrStr",line:1,hdr_list:["DMUMeasureAngleHdr","DMUMeasureMinDistanceHdr","DMUMeasureMaxDistanceHdr"],selectedHdr:e}]:[{name:"DMUMeasureDistanceMinMaxHdrStr",line:1,hdr_list:["DMUMeasureDistanceHdr","DMUMeasureMinDistanceHdr","DMUMeasureMaxDistanceHdr"],selectedHdr:e}]}r.length>0&&r[0].hdr_list&&this._sMeasurable1.extraPolateGeom&&(r[0].name=r[0].name+"Local",r[0].hdr_list.push("DMUMeasureLocalMinDistanceHdr"),r[0].hdr_list.push("DMUMeasureLocalMaxDistanceHdr"))}else if("MeasureItem"===this._sType){var d;if(this.getAttribute("sResultingType1")!==a.ResultType.POINT)if(t=this._sMeasurable1.getType(),a.ViewedType.CENTER!==this.getAttribute("sSelectedType1")&&t===n.GeometryType.CIRCLE)d=this.compareAttributes([{name:"bRadiusDisplay",value:!0}])?"DMUMeasureRadiusHdr":"DMUMeasureDiameterHdr",Math.abs(2*Math.PI-this.getMeasurable(1)._arcAngle)>.001?(this.getAttribute("bArcLengthDisplay")&&(d="DMUMeasureArcLengthHdr"),r=[{name:"DMUMeasureRadiusArcHdrStr",line:1,hdr_list:["DMUMeasureDiameterHdr","DMUMeasureRadiusHdr","DMUMeasureArcLengthHdr"],selectedHdr:d}]):r=[{name:"DMUMeasureRadiusDiaHdrStr",line:1,hdr_list:["DMUMeasureDiameterHdr","DMUMeasureRadiusHdr"],selectedHdr:d}];else if(t===n.GeometryType.CYLINDER)r=[{name:"DMUMeasureCylHdrStr",line:1,hdr_list:["DMUMeasureSurfaceDiameterHdr","DMUMeasureSurfaceRadiusHdr","DMUMeasureSurfaceLengthHdr","DMUMeasureSurfaceAreaHdr"],selectedHdr:d="DMUMeasureSurface"+this.getAttribute("sSurfaceDisplayType")+"Hdr"}];else if(t===n.GeometryType.CONE){let e="DMUMeasureConeHdrStr";d="DMUMeasureSurface"+this.getAttribute("sSurfaceDisplayType")+"Hdr";var m=["DMUMeasureSurfaceHalfAngleHdr","DMUMeasureSurfaceAngleHdr","DMUMeasureSurfaceLengthHdr","DMUMeasureSurfaceMaximumDiameterHdr","DMUMeasureSurfaceMaximumRadiusHdr"],p=this.getAttribute("vApex"),_=this._sMeasurable1.getPoints();p&&(Math.abs(p.x-_.beginPoint.x)<.001&&Math.abs(p.y-_.beginPoint.y)<.001&&Math.abs(p.z-_.beginPoint.z)<.001||Math.abs(p.x-_.endPoint.x)<.001&&Math.abs(p.y-_.endPoint.y)<.001&&Math.abs(p.z-_.endPoint.z)<.001)?m.push("DMUMeasureSurfaceAreaHdr"):(e="DMUMeasureHalfConeHdrStr",m.push("DMUMeasureSurfaceMinimumDiameterHdr"),m.push("DMUMeasureSurfaceMinimumRadiusHdr"),m.push("DMUMeasureSurfaceAreaHdr")),r=[{name:e,line:1,hdr_list:m,selectedHdr:d}]}else if(t===n.GeometryType.SPHERE)r=[{name:"DMUMeasureSphereHdrStr",line:1,hdr_list:["DMUMeasureSurfaceDiameterHdr","DMUMeasureSurfaceRadiusHdr","DMUMeasureSurfaceAreaHdr"],selectedHdr:d="DMUMeasureSurface"+this.getAttribute("sSurfaceDisplayType")+"Hdr"}];else if(t===n.GeometryType.PRODUCT){let e="DMUMeasurePrdHdrStr";d="DMUMeasureProduct"+this.getAttribute("sProductDisplayType")+"Hdr";var h=[];this.getAttribute("fVolume")>0&&(e="DMUMeasurePrdVolumeAreaHdrStr",h.push("DMUMeasureProductVolumeHdr")),h.push("DMUMeasureProductAreaHdr"),r=[{name:e,line:1,hdr_list:h,selectedHdr:d}]}}else"Measure3PointsCircle"!==this._sType&&"Measure3PointsAngle"!==this._sType||(e="DMUMeasureAngleHdr",r=[{name:"DMUMeasure3PointsHdrStr",line:1,hdr_list:["DMUMeasureAngleHdr","DMUMeasureDiameterHdr","DMUMeasureRadiusHdr"],selectedHdr:e="Measure3PointsAngle"===this._sType&&this.getAttribute("fAngle")>0?"DMUMeasureAngleHdr":this.compareAttributes([{name:"bRadiusDisplay",value:!0}])?"DMUMeasureRadiusHdr":"DMUMeasureDiameterHdr"}]);return r},getContextualCommandList:function(){var e=null;let r,n;if(this._executionContext&&!this._handler&&(this._handler=d(this._executionContext)),!this.isReadOnly()&&this.isInEdition()){if(this._isInCreationState&&("3dPlay"===this._typeApps||"3dPlayProPointPoint"===this._typeApps))return;if("3dPlay"===this._typeApps||"Geovia"===this._typeApps)return[{name:"DMUMeasureDeleteStr",line:1,hdr_list:["DMUMeasureDeleteHdr"]}];var l="Measure_DMUDefaultStyleHdr";this.compareAttributes([{name:"fOpacity",value:1},{name:"cFontColor",value:new i.Color("#000000")},{name:"sFontStyle",value:"normal"},{name:"cFillStyleColor",value:new i.Color("#ffffff")},{name:"bIsFilled",value:!1},{name:"bHasBorder",value:!1},{name:"sLineStylePattern",value:"1"},{name:"cLineStyleColor",value:new i.Color("#3d3d3d")},{name:"sLeaderStylePattern",value:"1"},{name:"cLeaderStyleColor",value:new i.Color("#3d3d3d")}])&&(this.compareAttributes([{name:"fLineStyleThicknessIndex",value:0}])||this.compareAttributes([{name:"fLineStyleThickness",value:1}]))&&(this.compareAttributes([{name:"fLeaderStyleThicknessIndex",value:0}])||this.compareAttributes([{name:"fLeaderStyleThickness",value:1}]))?l="Measure_DMULightStyleHdr":this.compareAttributes([{name:"fOpacity",value:1},{name:"cFontColor",value:new i.Color("#ffffff")},{name:"sFontStyle",value:"normal"},{name:"cFillStyleColor",value:new i.Color("#368ec4")},{name:"bIsFilled",value:!0},{name:"bHasBorder",value:!1},{name:"sLineStylePattern",value:"1"},{name:"cLineStyleColor",value:new i.Color("#3d3d3d")},{name:"sLeaderStylePattern",value:"1"},{name:"cLeaderStyleColor",value:new i.Color("#3d3d3d")}])&&(this.compareAttributes([{name:"fLineStyleThicknessIndex",value:0}])||this.compareAttributes([{name:"fLineStyleThickness",value:1}]))&&(this.compareAttributes([{name:"fLeaderStyleThicknessIndex",value:0}])||this.compareAttributes([{name:"fLeaderStyleThickness",value:1}]))?l="Measure_DMUMeasureStyleHdr":this.compareAttributes([{name:"fOpacity",value:1},{name:"cFontColor",value:new i.Color("#000000")},{name:"sFontStyle",value:"italic"},{name:"cFillStyleColor",value:new i.Color("#fee000")},{name:"bIsFilled",value:!0},{name:"bHasBorder",value:!1},{name:"sLineStylePattern",value:"1"},{name:"cLineStyleColor",value:new i.Color("#ff8a2e")},{name:"sLeaderStylePattern",value:"1"},{name:"cLeaderStyleColor",value:new i.Color("#ff8a2e")}])&&(this.compareAttributes([{name:"fLineStyleThicknessIndex",value:0}])||this.compareAttributes([{name:"fLineStyleThickness",value:1}]))&&(this.compareAttributes([{name:"fLeaderStyleThicknessIndex",value:0}])||this.compareAttributes([{name:"fLeaderStyleThickness",value:1}]))?l="Measure_DMUPostitStyleHdr":this.compareAttributes([{name:"fOpacity",value:1},{name:"cFontColor",value:new i.Color("#ffffff")},{name:"sFontStyle",value:"normal"},{name:"cFillStyleColor",value:new i.Color("#57b847")},{name:"bIsFilled",value:!0},{name:"bHasBorder",value:!1},{name:"sLineStylePattern",value:"1"},{name:"cLineStyleColor",value:new i.Color("#477738")},{name:"sLeaderStylePattern",value:"1"},{name:"cLeaderStyleColor",value:new i.Color("#477738")}])&&(this.compareAttributes([{name:"fLineStyleThicknessIndex",value:0}])||this.compareAttributes([{name:"fLineStyleThickness",value:1}]))&&(this.compareAttributes([{name:"fLeaderStyleThicknessIndex",value:0}])||this.compareAttributes([{name:"fLeaderStyleThickness",value:1}]))?l="Measure_DMUValidateStyleHdr":this.compareAttributes([{name:"fOpacity",value:1},{name:"cFontColor",value:new i.Color("#ffffff")},{name:"sFontStyle",value:"normal"},{name:"cFillStyleColor",value:new i.Color("#ff8a2e")},{name:"bIsFilled",value:!0},{name:"bHasBorder",value:!1},{name:"sLineStylePattern",value:"1"},{name:"cLineStyleColor",value:new i.Color("#8f4c00")},{name:"sLeaderStylePattern",value:"1"},{name:"cLeaderStyleColor",value:new i.Color("#8f4c00")}])&&(this.compareAttributes([{name:"fLineStyleThicknessIndex",value:0}])||this.compareAttributes([{name:"fLineStyleThickness",value:1}]))&&(this.compareAttributes([{name:"fLeaderStyleThicknessIndex",value:0}])||this.compareAttributes([{name:"fLeaderStyleThickness",value:1}]))?l="Measure_DMUWarningStyleHdr":this.compareAttributes([{name:"fOpacity",value:1},{name:"cFontColor",value:new i.Color("#ffffff")},{name:"sFontStyle",value:"bold"},{name:"cFillStyleColor",value:new i.Color("#cc092f")},{name:"bIsFilled",value:!0},{name:"bHasBorder",value:!1},{name:"sLineStylePattern",value:"1"},{name:"cLineStyleColor",value:new i.Color("#6d2828")},{name:"sLeaderStylePattern",value:"1"},{name:"cLeaderStyleColor",value:new i.Color("#6d2828")}])&&(this.compareAttributes([{name:"fLineStyleThicknessIndex",value:0}])||this.compareAttributes([{name:"fLineStyleThickness",value:1}]))&&(this.compareAttributes([{name:"fLeaderStyleThicknessIndex",value:0}])||this.compareAttributes([{name:"fLeaderStyleThickness",value:1}]))&&(l="Measure_DMUCautionStyleHdr");var o,c=[],m=[];if(s.isEnvActivated("measuredetaildisplay",!0)&&"2D"!==this.getAttribute("sMeasureOnGeometryType")&&(m=[{name:"DMUMeasureDisplayStr",line:1,hdr_list:["DMUMeasureDisplayHdr"]}]),this._isInCreationState)c=this.getCmdHdrsFor2DGeometries(),o=[{name:"Measure_DMUStylesStr",line:1,hdr_list:["Measure_DMUDefaultStyleHdr","Measure_DMULightStyleHdr","Measure_DMUMeasureStyleHdr","Measure_DMUPostitStyleHdr","Measure_DMUValidateStyleHdr","Measure_DMUWarningStyleHdr","Measure_DMUCautionStyleHdr"],selectedHdr:l},{name:"Measure_DMUIncreaseFontSizeStr",line:1,hdr_list:["Measure_DMUIncreaseFontSizeHdr"]},{name:"Measure_DMUDecreaseFontSizeStr",line:1,hdr_list:["Measure_DMUDecreaseFontSizeHdr"]}],m.length>0&&(o=m.concat(o));else{o=[{name:"Measure_DMUStylesStr",line:1,hdr_list:["Measure_DMUDefaultStyleHdr","Measure_DMULightStyleHdr","Measure_DMUMeasureStyleHdr","Measure_DMUPostitStyleHdr","Measure_DMUValidateStyleHdr","Measure_DMUWarningStyleHdr","Measure_DMUCautionStyleHdr"],selectedHdr:l},{name:"Measure_DMUIncreaseFontSizeStr",line:1,hdr_list:["Measure_DMUIncreaseFontSizeHdr"]},{name:"Measure_DMUDecreaseFontSizeStr",line:1,hdr_list:["Measure_DMUDecreaseFontSizeHdr"]},{name:"DMUGraphicPropertiesPanelStr",line:1,hdr_list:["DMUGraphicPropertiesPanelHdr"]}],m.length>0&&(o=m.concat(o));for(var p=t.getReviewContext({viewer:this._viewer}).getUIManager().getSelectedObjects(),_=!1,h=0;h<p.length;h++)if("Measure3PointsCircle"===p[h]._sType||"MeasureItem"===p[h]._sType&&(p[h]._sResultingType1===a.ResultType.CIRCLE||p[h]._sResultingType1===a.ResultType.CYLINDER||p[h]._sResultingType1===a.ResultType.SPHERE)){if(p[h]._sResultingType1===a.ResultType.CYLINDER||p[h]._sResultingType1===a.ResultType.SPHERE){var M=this.getAttribute("sSurfaceDisplayType");if("Radius"===M||"Diameter"===M||"MinimumRadius"===M||"MinimumDiameter"===M||"MaximumRadius"===M||"MaximumDiameter"===M){_=!0;break}}else _=!0;break}if(_){var y=this.compareAttributes([{name:"bRadiusDisplay",value:!0}])?"DMUMeasureRadiusHdr":"DMUMeasureDiameterHdr";Math.abs(2*Math.PI-this.getMeasurable(1)._arcAngle)>.001&&this.getAttribute("bArcLengthDisplay")||c.push({name:"DMUMeasureDiameterOrRadiusStr",line:1,hdr_list:["DMUMeasureDiameterHdr","DMUMeasureRadiusHdr"],selectedHdr:y})}}o&&o.length&&"Measure_DMUStylesStr"===o[0].name&&o[0].selectedHdr&&((n={}).radioGroupID=u[o[0].name],n.radioHdrID=o[0].selectedHdr.replace("_","")),c&&c.length&&c[0].name&&c[0].selectedHdr&&((r={}).radioGroupID=u[c[0].name],r.radioHdrID=c[0].selectedHdr.replace("DMU","")),e=c.length>0?c.concat(o):o,"DMUTemporaryBag"===this.getParent().getType()&&(this._isInCreationState||(e=e.concat([{name:"DMUMeasureDeleteStr",line:1,hdr_list:["DMUMeasureDeleteHdr"]}])))}let v=e;return this._executionContext&&e&&e.length>0&&(r&&this._handler&&(r.radioGroupID&&r.radioHdrID&&this._handler.setRadioItemState({id:r.radioHdrID,radioId:r.radioGroupID,state:!0,args:{ID:r.radioHdrID,Value:null}}),n.radioGroupID&&n.radioHdrID&&this._handler.setRadioItemState({id:n.radioHdrID,radioId:n.radioGroupID,state:!0,args:{ID:n.radioHdrID,Value:null}})),v=[],e.forEach(e=>{e&&e.hdr_list&&e.name&&u[e.name]&&v.push({type:"handler",identifier:u[e.name]})})),v},getSharedHeaderTypes:function(){var e=!1,t=!1,a=!1;return this.getAttribute("sLeaderEndType")&&(e=!0),this.getAttribute("sPointType")&&(t=!0),this.getAttribute("sExtremityType")&&(a=!0),{fontProperties:!0,leaderProperties:e,hideShowLeaderProperties:!1,pointTypeProperties:t,extremityTypeProperties:a}},getSharedContextualMenuCommandList:function(e){var t=[];e&&e.length&&e.forEach(function(e){-1===t.indexOf(e.getType())&&t.push(e.getType())});var i,r=!1,n=!0,u=!1,m=!1,p=!1,_=!0,h=!0,M=!0;this.cmdHdrState_list=[];for(var y=0;y<e.length;y++){if(e[y].getSharedHeaderTypes){var v=e[y].getSharedHeaderTypes();v?(v.leaderProperties?(r=!0,v.hideShowLeaderProperties&&(u=!0)):n=!1,v.pointTypeProperties&&(m=!0),v.extremityTypeProperties&&(p=!0)):(r=!1,m=!1,p=!1)}!n||e[0].getAttribute("sLeaderEndType")===e[y].getAttribute("sLeaderEndType")&&e[0].getAttribute("bHasALeader")===e[y].getAttribute("bHasALeader")||(n=!1),_&&e[0].getAttribute("sPointType")!==e[y].getAttribute("sPointType")&&(_=!1),h&&e[0].getAttribute("sExtremityType")!==e[y].getAttribute("sExtremityType")&&(h=!1),M&&e[0].getAttribute("bShortDisplay")!==e[y].getAttribute("bShortDisplay")&&(M=!1)}if(r&&(i={line:1,name:"DMULeaderStr",hdr_list:["DMUArrowLeaderHdr","DMUBubbleLeaderHdr","DMUCrossLeaderHdr","DMUSquareLeaderHdr","DMUNoEndLeaderHdr"],resourceFile:"DMUBaseCtxCommands/DMUBaseCtxCommands"},u&&i.hdr_list.push("DMUNoLeaderHdr"),e.length>0)){var g=!1,D=!1,f=!1,b=!1,S=!1,C=!1;if(n){var P=e[0].getAttribute("sLeaderEndType");switch(e[0].getAttribute("bHasALeader")||(P="None"),P){case"Arrow":g=!0;break;case"Bubble":D=!0;break;case"Cross":f=!0;break;case"Square":b=!0;break;case"No end":S=!0;break;case"None":C=!0}}for(var T=[{name:"DMUArrowLeaderHdr",state:g},{name:"DMUBubbleLeaderHdr",state:D},{name:"DMUCrossLeaderHdr",state:f},{name:"DMUSquareLeaderHdr",state:b},{name:"DMUNoEndLeaderHdr",state:S},{name:"DMUNoLeaderHdr",state:C}],A=0;A<T.length;A++)this.cmdHdrState_list.push(T[A])}if(m){var U=!1,I=!1,E=!1,R=!1,w=!1,k=!1,L=!1,x=!1,H=!1,N=!1,F=e[0].getAttribute("sPointType");if(_)switch(F){case"Cross":U=!0;break;case"Plus":I=!0;break;case"Concentric":E=!0;break;case"Coincident":R=!0;break;case"FullCircle":w=!0;break;case"FullSquare":k=!0;break;case"Star":L=!0;break;case"Dot":x=!0;break;case"SmallDot":H=!0;break;case"None":N=!0}for(var O=[{name:"DMUCrossPointTypeHdr",state:U},{name:"DMUPlusPointTypeHdr",state:I},{name:"DMUConcentricPointTypeHdr",state:E},{name:"DMUCoincidentPointTypeHdr",state:R},{name:"DMUFullCirclePointTypeHdr",state:w},{name:"DMUFullSquarePointTypeHdr",state:k},{name:"DMUStarPointTypeHdr",state:L},{name:"DMUDotPointTypeHdr",state:x},{name:"DMUSmallDotPointTypeHdr",state:H},{name:"DMUNonePointTypeHdr",state:N}],V=0;V<O.length;V++)this.cmdHdrState_list.push(O[V])}if(p){var G=e[0].getAttribute("sExtremityType"),B=!1,W=!1,j=!1,z=!1,X=!1,K=!1,q=!1,Y=!1,Q=!1,J=!1;if(h)switch(G){case"Cross":B=!0;break;case"Plus":W=!0;break;case"Concentric":j=!0;break;case"Coincident":z=!0;break;case"FullCircle":X=!0;break;case"FullSquare":K=!0;break;case"Star":q=!0;break;case"Dot":Y=!0;break;case"SmallDot":Q=!0;break;case"None":J=!0}for(var Z=[{name:"DMUCrossExtremityTypeHdr",state:B},{name:"DMUPlusExtremityTypeHdr",state:W},{name:"DMUConcentricExtremityTypeHdr",state:j},{name:"DMUCoincidentExtremityTypeHdr",state:z},{name:"DMUFullCircleExtremityTypeHdr",state:X},{name:"DMUFullSquareExtremityTypeHdr",state:K},{name:"DMUStarExtremityTypeHdr",state:q},{name:"DMUDotExtremityTypeHdr",state:Y},{name:"DMUSmallDotExtremityTypeHdr",state:Q},{name:"DMUNoneExtremityTypeHdr",state:J}],$=0;$<Z.length;$++)this.cmdHdrState_list.push(Z[$])}var ee=[],te=s.isEnvActivated("measuredetaildisplay",!0);if(!this._isInCreationState&&"MeasureItem"===this._sType&&this.getAttribute("sResultingType1")===a.ResultType.PRODUCT){var ae=this.getListPointedReferencesPath();ae&&ae.length&&ee.push({line:1,name:"DMUSelectMeasuredPrdHdrStr",hdr_list:["DMUSelectMeasuredPrdHdr"]})}if(te||ee.push({line:1,name:"DMUPropertiesStr",hdr_list:["DMUPropertiesHdr"],state:!0}),"Angle"===this.getAttribute("sDistanceType")&&this._isInCreationState){var ie=this.getAttribute("fQuadrant"),re=this.getAttribute("bComplementaryAngle");ee.push({line:1,name:"DMUAngleSectorStr1",hdr_list:["DMUMeasureAngleSector1Hdr"]}),ee.push({line:1,name:"DMUAngleSectorStr2",hdr_list:["DMUMeasureAngleSector2Hdr"]}),ee.push({line:1,name:"DMUAngleSectorStr3",hdr_list:["DMUMeasureAngleSector3Hdr"]}),ee.push({line:1,name:"DMUAngleSectorStr4",hdr_list:["DMUMeasureAngleSector4Hdr"]}),ee.push({line:1,name:"DMUAngleSectorStrC",hdr_list:["DMUMeasureAngleSectorCHdr"]}),this.cmdHdrState_list.push({name:"DMUMeasureAngleSector1Hdr",state:0===ie}),this.cmdHdrState_list.push({name:"DMUMeasureAngleSector2Hdr",state:1===ie}),this.cmdHdrState_list.push({name:"DMUMeasureAngleSector3Hdr",state:3===ie}),this.cmdHdrState_list.push({name:"DMUMeasureAngleSector4Hdr",state:2===ie}),this.cmdHdrState_list.push({name:"DMUMeasureAngleSectorCHdr",state:re})}if(1===t.length&&-1!==t[0].indexOf("DMUMeasure")){if("DMUTemporaryBag"===this.getParent().getType()){if("2D"!==this.getAttribute("sMeasureOnGeometryType")||!this._isInCreationState&&"2D"===this.getAttribute("sMeasureOnGeometryType")){var se=this.getParent().getDMUObjects("DMUMeasure");se&&se.length>1&&ee.push({line:1,name:"DMUMeasureRemoveAllNonPersistentStr",hdr_list:["DMUMeasureRemoveAllNonPersistentHdr"]})}}else{if(this.isEditable()){this._isInCreationState||(ee.push({line:1,name:"DMUCutStr",hdr_list:["DMUCutHdr"]}),ee.push({line:1,name:"DMUCopyStr",hdr_list:["DMUCopyHdr"]}),ee.push({line:1,name:"DMUHideShowStr",hdr_list:["DMUHideShowHdr"]}));var ne=!0;if(void 0!==e&&e.length>0)for(var le=0;le<e.length;le++){if(e[le].getAttribute("sResultingType1")!==a.ResultType.CIRCLE&&"Measure3PointsCircle"!==e[le].getAttribute("sType")){ne=!1;break}"2D"===e[le].getAttribute("sMeasureOnGeometryType")&&e[le].getAttribute("bArcLengthDisplay")&&(ne=!1);break}ne&&ee.push({line:1,name:"DMUMeasureDimensionRepresentationHdr",hdr_list:["DMUMeasureArcCenterDisplayHdr","DMUMeasureArcTangentDisplayHdr"],resourceFile:"DMUMeasure/DMUMeasure"})}this._isInCreationState||ee.push({line:1,name:"DMUDeleteStr",hdr_list:["DMUDeleteHdr"]})}this.isEditable()&&(r&&ee.push(i),m&&this.getPointTypeHdr&&ee.push(this.getPointTypeHdr()),p&&this.getExtremityTypeHdr&&ee.push(this.getExtremityTypeHdr()),"2D"===this.getAttribute("sMeasureOnGeometryType")&&te&&(ee.push({name:"DMUMeasure2DDisplayStr",line:1,hdr_list:["DMUMeasure2DDisplayHdr"]}),M&&this.cmdHdrState_list.push({name:"DMUMeasure2DDisplayHdr",state:!e[0].getAttribute("bShortDisplay")})))}let oe=ee;var ue,ce,de,me,pe,_e=this;this._executionContext&&ee&&ee.length>0&&(_e._handler||(_e._handler=d(this._executionContext)),oe=[],ee.forEach(e=>{if(e&&e.hdr_list&&e.hdr_list.length){let a=[];if(e.hdr_list.length>1){let i=e.hdr_list;for(var t=0;t<i.length;++t){ue=i[t];let e=c.submenuList[ue].identifier;me=c.submenuList[e].type,de=void 0;const r=_e.cmdHdrState_list.find(t=>t.name===e);"RadioItem"!==me&&"CheckItem"!==me||r&&r.state&&(de="selected"),ce=c.submenuList[e].iconPath?l.getWebappsAssetUrl(c.submenuList[e].module,c.submenuList[e].iconPath):void 0;let s={type:me,handlerId:e,title:o[e]?o[e]:e,icon:ce,state:de,action:{this:_e,callback:function(e){_e._handler||(_e._handler=d(_e._executionContext)),e&&_e._handler.executeHandler({id:e})}.bind(this,e)}};a.push(s)}}ue=e.hdr_list[0],pe=a.length>0?c.mainMenuList[e.name].identifier:c.mainMenuList[ue].identifier,me=c.mainMenuList[pe].type,ce=c.mainMenuList[pe].iconPath?l.getWebappsAssetUrl(c.mainMenuList[pe].module,c.mainMenuList[pe].iconPath):void 0,de=void 0;const i=_e.cmdHdrState_list.find(e=>e.name===pe);"RadioItem"!==me&&"CheckItem"!==me||i&&i.state&&(de="selected");let r={type:me,handlerId:pe,title:o[pe]?o[pe]:pe,icon:ce,state:de,action:a.length>0?void 0:{this:_e,callback:function(e){_e._handler||(_e._handler=d(_e._executionContext)),e&&_e._handler.executeHandler({id:e})}.bind(this,pe)}};a.length>0&&(r.submenu=a),oe.push(r)}}));return oe},register:function(e){this._parent({frmWindow:e.frmWindow,contextualBar:{type:"DMUMeasure",module:"DMUMeasure",workbenchName:"DMUMeasure"},contextualMenu:{type:"DMUMeasure",module:"DMUMeasure",workbenchName:"DMUMeasure"}})},unregister:function(e){this._parent({frmWindow:e.frmWindow,contextualBar:{type:"DMUMeasure",module:"DMUMeasure",workbenchName:"DMUMeasure"},contextualMenu:{type:"DMUMeasure",module:"DMUMeasure",workbenchName:"DMUMeasure"}})},applyStateToContextHdr:function(e){if(e.length>0)for(var t=0;t<e.length;t++){var a=r.getCommand(e[t].name,"Default");a&&a.setState&&a.setState(e[t].state)}},getPointTypeHdr:function(){return{line:1,name:"DMUPointTypeStr",hdr_list:["DMUCrossPointTypeHdr","DMUPlusPointTypeHdr","DMUConcentricPointTypeHdr","DMUCoincidentPointTypeHdr","DMUFullCirclePointTypeHdr","DMUFullSquarePointTypeHdr","DMUStarPointTypeHdr","DMUDotPointTypeHdr","DMUSmallDotPointTypeHdr","DMUNonePointTypeHdr"],resourceFile:"DMUBaseCtxCommands/DMUBaseCtxCommands"}},getExtremityTypeHdr:function(){return{line:1,name:"DMUExtremityTypeStr",hdr_list:["DMUCrossExtremityTypeHdr","DMUPlusExtremityTypeHdr","DMUConcentricExtremityTypeHdr","DMUCoincidentExtremityTypeHdr","DMUFullCircleExtremityTypeHdr","DMUFullSquareExtremityTypeHdr","DMUStarExtremityTypeHdr","DMUDotExtremityTypeHdr","DMUSmallDotExtremityTypeHdr","DMUNoneExtremityTypeHdr"],resourceFile:"DMUBaseCtxCommands/DMUBaseCtxCommands"}},setCheckCmdHdrState:function(e){this.applyStateToContextHdr&&e.length>0&&this.applyStateToContextHdr(e)}})}),define("DS/DMUMeasure/DMUMeasureContextCmd",["DS/CATWebUXComponents/DMUCommand","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/CATWebUXComponents/DMUCommandsManager","DS/DMUBaseExperience/DMUContextManager"],function(e,t,a,i,r){"use strict";var s,n,l=e.extend({init:function(e){var i=e||{};if(i.mode="shared",this._parent(i),i&&(this._executionContext=i.executionContext),!this._viewer){if(this._executionContext){let e=this._executionContext.getComponent("Viewer");e&&e.getViewer&&(this._viewer=e.getViewer())}this._viewer||(this._viewer=this.getFrameWindow().getViewer())}this._bCmdState=!1;var s=function(e,t,a){e.setAttribute("bRadiusDisplay",a),"Measure3PointsAngle"===e.getAttribute("sType")&&(e.setAttribute("sType","Measure3PointsCircle"),e.setAttribute("sDistanceType","none"),localStorage.setItem("DMUMeasure3PointsDisplayPreferences","CircleBy3Points"),e.update()),e._sMeasurable1&&e._sMeasurable1.getArcAngle&&Math.abs(2*Math.PI-e._sMeasurable1.getArcAngle())>.001&&localStorage.setItem("DMUMeasureArcRadiusPreferences",t),e.updateGlobalRadiusPreference(a),e.getAttribute("bArcLengthDisplay")&&e.setAttribute("bArcLengthDisplay",!1),e.update2DArcDisplay(),e.updateMainValueDisplayAsPerPref()},n=function(e){e.getParent().removeDMUObjects?e.getParent().removeDMUObjects([e]):e.getParent().getCurrentSlide().removeDMUObject(e)},l=function(e){"Measure3PointsCircle"===e.getAttribute("sType")?(e.setAttribute("sType","Measure3PointsAngle"),e.setAttribute("sDistanceType","Angle"),localStorage.setItem("DMUMeasure3PointsDisplayPreferences","AngleBy3Points")):e.updateFeatureAndDistanceTypePreference("Angle"),e.getNode().cleanAngleCache(),e.update()},o=function(e){e.setAttribute("bShortDisplay",!e.getAttribute("bShortDisplay")),e.getAttribute("bShortDisplay")?localStorage.setItem("DMUMeasureDisplayPreference","Short"):localStorage.setItem("DMUMeasureDisplayPreference","Extended")};this.beginExecute=function(){var e,i,u,c,d=this,m=this._viewer?this._viewer:this.getFrameWindow().getViewer(),p=t.get();p.length>0&&(e=r.getReviewContext({viewer:m}))&&("DMUSelectMeasuredPrdHdr"===d._id?function(){if(!p||!e)return;let i=[];for(var r=0;r<p.length;r++)i.push(e.getDMUObjectFromPathElement(p[r].pathElement));a.empty(),t.empty(),i.forEach(e=>{e&&e.selectPointedReferencesPath&&e.selectPointedReferencesPath()})}():function(){for(var t=0;t<p.length;t++){var a=e.getDMUObjectFromPathElement(p[t].pathElement);if(a){switch(d._id){case"DMUMeasureArcLengthHdr":a.setAttribute("bArcLengthDisplay",!0),localStorage.setItem("DMUMeasureArcRadiusPreferences","DisplayArcLength"),a.update2DArcDisplay(),a.updateMainValueDisplayAsPerPref();break;case"DMUMeasureDiameterHdr":s(a,"DisplayDiameter",!1);break;case"DMUMeasureRadiusHdr":s(a,"DisplayRadius",!0);break;case"DMUMeasure2DDisplayHdr":o(a);break;case"DMUMeasureDisplayHdr":a.setAttribute("bShortDisplay",!a.getAttribute("bShortDisplay"));break;case"DMUMeasureAngleHdr":l(a);break;case"DMUMeasureDistanceHdr":a.updateFeatureAndDistanceTypePreference("Distance"),a.update();break;case"DMUMeasureMinDistanceHdr":a.updateFeatureAndDistanceTypePreference("MinimumDistance"),a.update();break;case"DMUMeasureLocalMinDistanceHdr":a.updateFeatureAndDistanceTypePreference("LocalMinimumDistance"),a.update();break;case"DMUMeasureMaxDistanceHdr":a.updateFeatureAndDistanceTypePreference("MaximumDistance"),a.update();break;case"DMUMeasureLocalMaxDistanceHdr":a.updateFeatureAndDistanceTypePreference("LocalMaximumDistance"),a.update();break;case"DMUMeasureSurfaceRadiusHdr":a.setAttribute("bRadiusDisplay",!0),a.updateFeatureAndSurfaceDisplayTypePreference("Radius"),a.update();break;case"DMUMeasureSurfaceDiameterHdr":a.setAttribute("bRadiusDisplay",!1),a.updateFeatureAndSurfaceDisplayTypePreference("Diameter"),a.update();break;case"DMUMeasureSurfaceMaximumRadiusHdr":a.setAttribute("bRadiusDisplay",!0),a.updateFeatureAndSurfaceDisplayTypePreference("MaximumRadius"),a.update();break;case"DMUMeasureSurfaceMaximumDiameterHdr":a.setAttribute("bRadiusDisplay",!1),a.updateFeatureAndSurfaceDisplayTypePreference("MaximumDiameter"),a.update();break;case"DMUMeasureSurfaceMinimumRadiusHdr":a.setAttribute("bRadiusDisplay",!0),a.updateFeatureAndSurfaceDisplayTypePreference("MinimumRadius"),a.update();break;case"DMUMeasureSurfaceMinimumDiameterHdr":a.setAttribute("bRadiusDisplay",!1),a.updateFeatureAndSurfaceDisplayTypePreference("MinimumDiameter"),a.update();break;case"DMUMeasureSurfaceLengthHdr":a.updateFeatureAndSurfaceDisplayTypePreference("Length"),a.update();break;case"DMUMeasureSurfaceAreaHdr":a.updateFeatureAndSurfaceDisplayTypePreference("Area"),a.update();break;case"DMUMeasureSurfaceAngleHdr":a.updateFeatureAndSurfaceDisplayTypePreference("Angle"),a.update();break;case"DMUMeasureSurfaceHalfAngleHdr":a.updateFeatureAndSurfaceDisplayTypePreference("HalfAngle"),a.update();break;case"DMUMeasureProductAreaHdr":a.updateFeatureAndProductDisplayTypePreference("Area"),a.update();break;case"DMUMeasureProductVolumeHdr":a.updateFeatureAndProductDisplayTypePreference("Volume"),a.update();break;case"DMUMeasureAngleSector1Hdr":if(i=a.getAttribute("fAngle"),u=a.getAttribute("fQuadrant"),c=a.getAttribute("bComplementaryAngle"),0===u)break;1!==u&&2!==u||(c?a.setAttribute("fAngle",3*Math.PI-i):a.setAttribute("fAngle",Math.PI-i)),a.setAttribute("fQuadrant",0),a.updateAngleValues();break;case"DMUMeasureAngleSector2Hdr":if(i=a.getAttribute("fAngle"),u=a.getAttribute("fQuadrant"),c=a.getAttribute("bComplementaryAngle"),1===u)break;0!==u&&3!==u||(c?a.setAttribute("fAngle",3*Math.PI-i):a.setAttribute("fAngle",Math.PI-i)),a.setAttribute("fQuadrant",1),a.updateAngleValues();break;case"DMUMeasureAngleSector3Hdr":if(i=a.getAttribute("fAngle"),u=a.getAttribute("fQuadrant"),c=a.getAttribute("bComplementaryAngle"),3===u)break;1!==u&&2!==u||(c?a.setAttribute("fAngle",3*Math.PI-i):a.setAttribute("fAngle",Math.PI-i)),a.setAttribute("fQuadrant",3),a.updateAngleValues();break;case"DMUMeasureAngleSector4Hdr":if(i=a.getAttribute("fAngle"),u=a.getAttribute("fQuadrant"),c=a.getAttribute("bComplementaryAngle"),2===u)break;0!==u&&3!==u||(c?a.setAttribute("fAngle",3*Math.PI-i):a.setAttribute("fAngle",Math.PI-i)),a.setAttribute("fQuadrant",2),a.updateAngleValues();break;case"DMUMeasureAngleSectorCHdr":i=a.getAttribute("fAngle"),c=a.getAttribute("bComplementaryAngle"),a.setAttribute("bComplementaryAngle",!c),a.setAttribute("fAngle",2*Math.PI-i),a.updateAngleValues();break;case"DMUMeasureDeleteHdr":n(a),t--}a.refreshNode()}}}(),m.render(),e.getCurrentSessionMarkup()&&e.getCurrentSessionMarkup().isVisible()&&e.getCurrentSessionMarkup().getCurrentSlide()&&e.getCurrentSessionMarkup().getCurrentSlide().fireEvent("onSlidePreviewRefreshRequired",{dmuObject:e.getCurrentSessionMarkup().getCurrentSlide()})),this.done()}},getState:function(){return this._bCmdState},setState:function(e){this._bCmdState=e}});return l.executeContextualBarCmd=function(e,a){if(!s&&a.executionContext&&(s=a.executionContext),a&&a.args&&a.args.Value){let e=0;var l=setInterval(function(){e++;var o,u=t.get();if(1===u.length){if(!n){let e=s.getComponent("Viewer");e&&e.getViewer&&(n=e.getViewer())}if(n){var c=r.getReviewContext({viewer:n});if(c){var d=c.getDMUObjectFromPathElement(u[0].pathElement);d&&d.getType&&"DMUMeasure"===d.getType()&&(o=!0)}}}if(o){let t=i.getCommand(a.args.Value,s);t&&t.begin?(t.begin(),clearInterval(l)):e>20&&clearInterval(l)}else clearInterval(l)},100)}e&&e()},l.executeContextualBarCmdUnset=function(e){e&&e()},l}),define("DS/DMUMeasure/DMUMeasureRemoveAllNonPersistentCmd",["DS/CATWebUXComponents/DMUCommand","DS/Selection/CSOManager","DS/DMUBaseExperience/DMUContextManager","DS/DMUControls/DMUWarningPanel","i18n!DS/DMUMeasure/assets/nls/DMUMeasure"],function(e,t,a,i,r){"use strict";var s;return e.extend({init:function(e){e.mode="shared",this._parent(e)},beginExecute:function(){var e=this;if(s)e.end?e.end():e.done();else{s=new i({title:r.removeAllNonPersistentWarningPanel.title,message:r.removeAllNonPersistentWarningPanel.message,frmWindow:this.getFrameWindow(),callbacks:{onValidateCB:function(){!function(){if(t.get().length>0){var i=a.getReviewContext({viewer:e.getFrameWindow().getViewer()});if(i){var r=i.getTransientReviewBag();if(r){var s=r.getDMUObjects("DMUMeasure");r.removeDMUObjects&&r.removeDMUObjects(s)}}}e.done()}(),s=null},onCancelCB:function(){e.end?e.end():e.done(),s=null},onCloseCB:function(){e.end?e.end():e.done(),s=null}}})}},destroy:function(){s&&s.destroy(),this._parent()}})}),define("DS/DMUMeasure/DMUCreateMeasureCmd",["DS/DMUMeasure/DMUMeasureBaseCmd","DS/Web3DUXFilterBar/Web3DUXFilterBar","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUMeasurable/DMUMeasureEnums","DS/DMUBaseExperience/EXPUtils","i18n!DS/DMUMeasure/assets/nls/DMUMeasure"],function(e,t,a,i,r,s){"use strict";return e.extend({init:function(e){this._parent(e,"exclusive",!0),!this._id&&e.ID&&(this._id=e.ID)},_initPref:function(){localStorage.getItem("DMUMeasureCylinderRadiusPreferences")||localStorage.setItem("DMUMeasureCylinderRadiusPreferences","DisplayDiameter"),localStorage.getItem("DMUMeasureSphereRadiusPreferences")||localStorage.setItem("DMUMeasureSphereRadiusPreferences","DisplayDiameter"),this._parent()},_updateFilter:function(e){var t={acceptedGeometries:[],viewedGeometries:[]};return e.getActiveState("pickpoint")?t.viewedGeometries.push(i.ViewedType.POINT):e.getActiveState("product")?t.viewedGeometries.push(i.ViewedType.PRODUCT):(e.getActiveState("center")&&(t.acceptedGeometries.push(a.GeometryType.CIRCLE),t.acceptedGeometries.push(a.GeometryType.SPHERE),t.viewedGeometries.push(i.ViewedType.CENTER)),e.getActiveState("linecurve")&&(t.acceptedGeometries.push(a.GeometryType.LINE),t.acceptedGeometries.push(a.GeometryType.CIRCLE),t.acceptedGeometries.push(a.GeometryType.CURVE),t.viewedGeometries.push(i.ViewedType.CURVE)),e.getActiveState("axis")&&(t.acceptedGeometries.push(a.GeometryType.LINE),t.acceptedGeometries.push(a.GeometryType.CYLINDER),t.acceptedGeometries.push(a.GeometryType.CONE),t.viewedGeometries.push(i.ViewedType.AXIS)),e.getActiveState("circle")&&(t.acceptedGeometries.push(a.GeometryType.CIRCLE),t.viewedGeometries.push(i.ViewedType.CIRCLE)),e.getActiveState("surface")&&(t.acceptedGeometries.push(a.GeometryType.CYLINDER),t.acceptedGeometries.push(a.GeometryType.CONE),t.acceptedGeometries.push(a.GeometryType.SPHERE),t.acceptedGeometries.push(a.GeometryType.PLANE),t.acceptedGeometries.push(a.GeometryType.SURFACE),t.viewedGeometries.push(i.ViewedType.SURFACE)),e.getActiveState("plane")&&(t.acceptedGeometries.push(a.GeometryType.PLANE),t.viewedGeometries.push(i.ViewedType.INFPLANE)),e.getActiveState("cylinder")&&(t.acceptedGeometries.push(a.GeometryType.CYLINDER),t.acceptedGeometries.push(a.GeometryType.CONE),t.acceptedGeometries.push(a.GeometryType.SPHERE),t.viewedGeometries.push(i.ViewedType.CYCOSP)),e.getActiveState("allCanonicGeom")&&(t.acceptedGeometries.push(a.GeometryType.POINT),t.acceptedGeometries.push(a.GeometryType.LINE),t.acceptedGeometries.push(a.GeometryType.CIRCLE),t.acceptedGeometries.push(a.GeometryType.PLANE),t.acceptedGeometries.push(a.GeometryType.CYLINDER),t.acceptedGeometries.push(a.GeometryType.CONE),t.acceptedGeometries.push(a.GeometryType.SPHERE),t.viewedGeometries.push(i.ViewedType.POINT),t.viewedGeometries.push(i.ViewedType.CURVE),t.viewedGeometries.push(i.ViewedType.CIRCLE),t.viewedGeometries.push(i.ViewedType.INFPLANE),t.viewedGeometries.push(i.ViewedType.SURFACE),t.viewedGeometries.push(i.ViewedType.CYCOSP))),this._pathElementAgentWithCSO.options.acceptedGeometries=t.acceptedGeometries,this._pathElementAgentWithCSO.options.viewedGeometries=t.viewedGeometries,this._pathElementAgentWithoutCSO.options.acceptedGeometries=t.acceptedGeometries,this._pathElementAgentWithoutCSO.options.viewedGeometries=t.viewedGeometries,t},_createFilter:function(){var e=this,a=[];a=r.isEnvActivated("measure_OldSelectionFilter",!0)?[{nls:s.point,url:this._iconDir+"I_Meas_Point.png",id:"pickpoint",type:"element",callback:function(){e._filterUI.getActiveState("pickpoint")?e._activeFilter="pointOnly":e._activeFilter="SeveralGeometries",e._filteredGeometries=e._updateFilter(e._filterUI)},bexclude:!0,bstateActif:"3dPlay"===this._measureCommandMode||"Geovia"===this._arguments[0].ID},{type:"separator"},{nls:s.center+"/"+s.point,url:this._iconDir+"I_Meas_PointCircle.png",id:"center",type:"element",callback:function(){e._activeFilter="SeveralGeometries",e._filteredGeometries=e._updateFilter(e._filterUI)},bexclude:!1,bstateActif:!1},{nls:s.line+"/"+s.curve,url:this._iconDir+"I_Meas_LineCurve.png",id:"linecurve",type:"element",callback:function(){e._activeFilter="SeveralGeometries",e._filteredGeometries=e._updateFilter(e._filterUI)},bexclude:!1,bstateActif:!1},{nls:s.axis+"/"+s.infiniteline,url:this._iconDir+"I_Meas_AxisInfiniteLine.png",id:"axis",type:"element",callback:function(){e._activeFilter="SeveralGeometries",e._filteredGeometries=e._updateFilter(e._filterUI)},bexclude:!1,bstateActif:!1},{nls:s.circle,url:this._iconDir+"I_Meas_Circle.png",id:"circle",type:"element",callback:function(){e._activeFilter="SeveralGeometries",e._filteredGeometries=e._updateFilter(e._filterUI)},bexclude:!1,bstateActif:!1},{nls:s.surface,url:this._iconDir+"I_Meas_Surface.png",id:"surface",type:"element",callback:function(){e._activeFilter="SeveralGeometries",e._filteredGeometries=e._updateFilter(e._filterUI)},bexclude:!1,bstateActif:"Thickness"===this._arguments[0].ID},{nls:s.plane,url:this._iconDir+"I_Meas_Plane.png",id:"plane",type:"element",callback:function(){e._activeFilter="SeveralGeometries",e._filteredGeometries=e._updateFilter(e._filterUI)},bexclude:!1,bstateActif:!1},{nls:s.cylinder+"/"+s.cone+"/"+s.sphere,url:this._iconDir+"I_Meas_Cylinder.png",id:"cylinder",type:"element",callback:function(){e._activeFilter="SeveralGeometries",e._filteredGeometries=e._updateFilter(e._filterUI)},bexclude:!1,bstateActif:!1},{type:"separator"},{nls:s.product,url:this._iconDir+"I_Meas_Product.png",id:"product",type:"element",callback:function(){e._filterUI.getActiveState("product")?e._activeFilter="productOnly":e._activeFilter="SeveralGeometries",e._filteredGeometries=e._updateFilter(e._filterUI)},bexclude:!0,bstateActif:!1}]:[{nls:s.point,url:this._iconDir+"I_Meas_Point.png",id:"pickpoint",type:"element",callback:function(){e._filterUI.getActiveState("pickpoint")?e._activeFilter="pointOnly":e._activeFilter="SeveralGeometries",e._filteredGeometries=e._updateFilter(e._filterUI)},bexclude:!0,bstateActif:"3dPlay"===this._measureCommandMode||"Geovia"===this._arguments[0].ID,bManageOpacity:!1},{type:"separator"},{nls:s.centerpoint,url:this._iconDir+"I_Meas_PointCircle.png",id:"center",type:"element",callback:function(){e._activeFilter="SeveralGeometries",e._filteredGeometries=e._updateFilter(e._filterUI)},bexclude:!0,bstateActif:!1},{type:"separator"},{nls:s.canonicGeometries,url:this._iconDir+"I_Meas_AllGeom.png",id:"allCanonicGeom",type:"element",callback:function(){e._activeFilter="SeveralGeometries",e._filteredGeometries=e._updateFilter(e._filterUI)},bexclude:!0,bstateActif:!1},{type:"separator"},{nls:s.product,url:this._iconDir+"I_Meas_Product.png",id:"product",type:"element",callback:function(){e._filterUI.getActiveState("product")?e._activeFilter="productOnly":e._activeFilter="SeveralGeometries",e._filteredGeometries=e._updateFilter(e._filterUI)},bexclude:!0,bstateActif:!1}],this._filterUI=new t({body:this._frmWindow.getUIFrame(),frmWindow:this._frmWindow,title:"Filter Control",typeSeparator:"bubble",actionBar:this._frmWindow.getActionBar(),lJsonElement:a}),this._filterUI.build()},_beginExecute:function(){this._parent(),this._filterUI||this._createFilter(),this._objAction||(this._filteredGeometries=this._updateFilter(this._filterUI)),"3dPlay"!==this._measureCommandMode&&"Thickness"!==this._arguments[0].ID&&"Geovia"!==this._arguments[0].ID&&"3dAuthoringPickPoint"!==this._measureCommandMode&&"ProgressiveVisuLoading"!==this._measureCommandMode||this._filterUI.setVisibleFlag(!1)}})}),define("DS/DMUMeasure/DMUCreateMeasure2DCmd",["DS/DMUMeasure/DMUMeasureBaseCmd","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUMeasurable/DMUMeasureEnums","DS/Selection/HSOManager"],function(e,t,a,i){"use strict";return e.extend({init:function(e){this._measureOnGeometryType="2D",this._parent(e,"exclusive",!0)},_initPref:function(){localStorage.getItem("DMUMeasBetween2CirclesDistancePref")||localStorage.setItem("DMUMeasBetween2CirclesDistancePref","Distance"),localStorage.getItem("DMUMeasBetweenCircleArcDistancePref")||localStorage.setItem("DMUMeasBetweenCircleArcDistancePref","Distance"),localStorage.getItem("DMUMeasBetweenCircleAnygeomDistancePref")||localStorage.setItem("DMUMeasBetweenCircleAnygeomDistancePref","Distance"),localStorage.getItem("DMUMeasBetween2ArcsDistancePref")||localStorage.setItem("DMUMeasBetween2ArcsDistancePref","MinimumDistance"),localStorage.getItem("DMUMeasBetweenArcAnygeomDistancePref")||localStorage.setItem("DMUMeasBetweenArcAnygeomDistancePref","MinimumDistance"),localStorage.getItem("DMUMeasBetween2ParallelLinesDistancePref")||localStorage.setItem("DMUMeasBetween2ParallelLinesDistancePref","Distance"),localStorage.getItem("DMUMeasBetween2LinesDistancePref")||localStorage.setItem("DMUMeasBetween2LinesDistancePref","Angle"),localStorage.getItem("DMUMeasBetween2AnyGeomsDistancePref")||localStorage.setItem("DMUMeasBetween2AnyGeomsDistancePref","MinimumDistance"),localStorage.getItem("DMUMeasureDisplayPreference")||localStorage.setItem("DMUMeasureDisplayPreference","Short"),this._parent()},_selectBestType:function(e,t){var a,i=e.retrievePossibleSelectedType(t);return i.length&&(a=i[0]),a},retrieveBetweenResultType:function(e){return this.retrieveItemResultType(e.measurable.getType(),e.selectedType1)},retrievePossibleSelectedType:function(e){var i=[],r=e.getType();return r===t.GeometryType.LINE||r===t.GeometryType.CURVE?i.push(a.ViewedType.CURVE):r===t.GeometryType.CIRCLE?i.push(a.ViewedType.CIRCLE):i.push(a.ViewedType.POINT),i},_checkForSelection:function(e){var t=!0;if(this._measurable&&this._measurable.length&&this._measurable[0]&&this._measurable[0]._pathElement&&this._measurable[0]._pathElement.externalPath&&e&&e[0]&&e[0].pathElement&&e[0].pathElement.externalPath){var a=this._measurable[this._measurable.length-1],r=a._pathElement.externalPath,s=e[0].pathElement.externalPath;if(r&&s&&r.length>2&&s.length>2)r[r.length-2]!==s[s.length-2]&&(t=!1,i.remove(e[0]),i.add({pathElement:a._pathElement}))}return t},_retrieveDistanceTypeFor2DMeasures:function(){var e,a,i={},r="MinimumDistance",s=this._measurable[0],n=this._measurable[1];if(s.getType()!==t.GeometryType.CIRCLE&&n.getType()!==t.GeometryType.CIRCLE||(Math.abs(2*Math.PI-s._arcAngle)>.001&&(e=!0),Math.abs(2*Math.PI-n._arcAngle)>.001&&(a=!0)),e&&a)localStorage.getItem("DMUMeasBetween2ArcsDistancePref")&&(r=localStorage.getItem("DMUMeasBetween2ArcsDistancePref"),i.localprefName="DMUMeasBetween2ArcsDistancePref");else if(e&&n.getType()===t.GeometryType.CIRCLE||a&&s.getType()===t.GeometryType.CIRCLE)localStorage.getItem("DMUMeasBetweenCircleArcDistancePref")&&(r=localStorage.getItem("DMUMeasBetweenCircleArcDistancePref"),i.localprefName="DMUMeasBetweenCircleArcDistancePref");else if(e&&n.getType()!==t.GeometryType.CIRCLE||a&&s.getType()!==t.GeometryType.CIRCLE)localStorage.getItem("DMUMeasBetweenArcAnygeomDistancePref")&&(r=localStorage.getItem("DMUMeasBetweenArcAnygeomDistancePref"),i.localprefName="DMUMeasBetweenArcAnygeomDistancePref");else if(s.getType()===t.GeometryType.CIRCLE&&n.getType()===t.GeometryType.CIRCLE)localStorage.getItem("DMUMeasBetween2CirclesDistancePref")&&(r=localStorage.getItem("DMUMeasBetween2CirclesDistancePref"),i.localprefName="DMUMeasBetween2CirclesDistancePref");else if(s.getType()===t.GeometryType.CIRCLE&&n.getType()!==t.GeometryType.CIRCLE||n.getType()===t.GeometryType.CIRCLE&&n.getType()!==t.GeometryType.CIRCLE)localStorage.getItem("DMUMeasBetweenCircleAnygeomDistancePref")&&(r=localStorage.getItem("DMUMeasBetweenCircleAnygeomDistancePref"),i.localprefName="DMUMeasBetweenCircleAnygeomDistancePref");else if(s.getType()===t.GeometryType.LINE&&n.getType()===t.GeometryType.LINE){var l=s.getPoints().endPoint.clone().sub(s.getPoints().beginPoint),o=n.getPoints().endPoint.clone().sub(n.getPoints().beginPoint),u=l.normalize().dot(o.normalize());1===Math.abs(u)?localStorage.getItem("DMUMeasBetween2ParallelLinesDistancePref")&&(r=localStorage.getItem("DMUMeasBetween2ParallelLinesDistancePref"),i.localprefName="DMUMeasBetween2ParallelLinesDistancePref"):localStorage.getItem("DMUMeasBetween2LinesDistancePref")&&(r=localStorage.getItem("DMUMeasBetween2LinesDistancePref"),i.localprefName="DMUMeasBetween2LinesDistancePref")}else localStorage.getItem("DMUMeasBetween2AnyGeomsDistancePref")&&(r=localStorage.getItem("DMUMeasBetween2AnyGeomsDistancePref"),i.localprefName="DMUMeasBetween2AnyGeomsDistancePref");return i.distanceType=r,i}})});