define("DS/RenderingMaterialLib/MaterialMappingCoreServices",["DS/Visualization/ThreeJS_DS"],function(e){var a=function(e,a){let t=new Array(4);return t[0]=e[0]*a[0]+e[1]*a[2],t[1]=e[0]*a[1]+e[1]*a[3],t[2]=e[2]*a[0]+e[3]*a[2],t[3]=e[2]*a[1]+e[3]*a[3],t},t=function(t){let n=[1,0,0,1];n[0]=t.scale_u>0?1/t.scale_u:1,n[3]=t.scale_v>0?1/t.scale_v:1;let s=[1,0,0,1];s[0]=t.flip_u?-1:1,s[3]=t.flip_v?-1:1;let l=[1,0,0,1];if(0!=t.angle){let e=Math.sin(t.angle),a=Math.cos(t.angle);l=[a,e,-e,a]}let o=a(a(s,l),n);return new e.Matrix3(o[0],o[2],-t.offset_u,o[1],o[3],-t.offset_v,0,0,1)},n={CATMappingSemantic:{LegacyMapping:0,DecoupledMapping:1},CATMappingBehavior:{TextureFocused:0,SurfaceFocused:1},CATMappingType:{Planar:0,Spherical:1,Cylindrical:2,Box:3,Auto:4,Adaptive:5,UV:6,HemiSpherical:7,InfCylindrical:8},UnifyMappingScaleParams:function(e){e&&(!("scale_u"in e)&&"global_scale"in e&&(e.scale_u=e.global_scale?e.global_scale:1,delete e.global_scale),!("scale_v"in e)&&"scale_ratio"in e&&(e.scale_v=e.scale_ratio?e.scale_ratio:1,e.scale_v=e.scale_u/e.scale_v,delete e.scale_ratio))},CreateDefaultMapping:function(){return{scale_u:1,scale_v:1,offset_u:0,offset_v:0,angle:0,repeat_u:!0,repeat_v:!0,flip_u:!1,flip_v:!1,mapFocus:this.CATMappingBehavior.SurfaceFocused,type:this.CATMappingType.UV}},SanitizeMappingInfo:function(e){e.scale_u=Math.abs(e.scale_u)<1e-8?1:e.scale_u,e.scale_v=Math.abs(e.scale_v)<1e-8?1:e.scale_v},ResolveReferenceMappingInfo:function(e){let a=this.CreateDefaultMapping();return a.mapFocus=this.CATMappingBehavior.TextureFocused,Object.assign(a,e),this.SanitizeMappingInfo(a),a},ResolveChannelMappingInfo:function(e,a){let t=this.ResolveReferenceMappingInfo(e),n=Object.assign({},t);return Object.assign(n,a),n.mapFocus=t.mapFocus,n.type=t.type,this.SanitizeMappingInfo(n),n},ResolveApplicationMappingInfo:function(e,a){let t=this.CreateDefaultMapping();return t.mapFocus=a.mapFocus,t.type=a.type,t.repeat_u=a.repeat_u,t.repeat_v=a.repeat_v,Object.assign(t,e),this.SanitizeMappingInfo(t),t},Decoupled:{ApplyMapping:function(e,a){let t=Object.assign({},e);return a&&t.mapFocus==n.CATMappingBehavior.TextureFocused&&(t.scale_u*=parseFloat(a.Width),t.scale_v*=parseFloat(a.Height),t.offset_u*=t.scale_u,t.offset_v*=t.scale_v),t.type==n.CATMappingType.UV&&t.mapFocus!=n.CATMappingBehavior.TextureFocused||(t.offset_u-=.5,t.offset_v-=.5),t},ComputeObjectTransform:function(a,t){let s=null;if(t.type!=n.CATMappingType.UV&&a){s=new e.Matrix4;let l=new e.Matrix4;if(16==a.length)l.setFromArray(a);else{const e=a;l.set(e[0],e[3],e[6],e[9],e[1],e[4],e[7],e[10],e[2],e[5],e[8],e[11],0,0,0,1)}if(t.mapFocus==n.CATMappingBehavior.TextureFocused){let a=(new e.Vector3).getPositionFromMatrix(l);a.negate();let t=(new e.Matrix4).extractRotation(l);t.transpose();let n=(new e.Vector3).copy(a);n.applyMatrix4(t),(s=(new e.Matrix4).copy(t)).setPosition(n)}else{const a=!1;s=(new e.Matrix4).getInverse(l,a)}}return s},ComputeApplicationUvTransform:function(e){let a=Object.assign({},e);return t(a)},ComputeChannelUvTransform:function(e,a){let n=this.ApplyMapping(e,a);return t(n)},CombineMapping:function(a,t){let n=a,s=t,l=n.elements[6],o=n.elements[7],r=s.elements[6],i=s.elements[7],p=new e.Matrix3(1,0,l+r-.5,0,1,o+i-.5,0,0,1),u=new e.Matrix3(n.elements[0],n.elements[3],0,n.elements[1],n.elements[4],0,0,0,1),c=new e.Matrix3(s.elements[0],s.elements[3],.5,s.elements[1],s.elements[4],.5,0,0,1),_=new e.Matrix3;return _.multiplyMatrices(c,u),_.multiplyMatrices(_,p),_}},Legacy:{ApplyMapping:function(e,a){let t=Object.assign({},e);return a&&t.mapFocus==n.CATMappingBehavior.TextureFocused&&(t.scale_u*=parseFloat(a.Width),t.scale_v*=parseFloat(a.Height),t.offset_u/=t.scale_u,t.offset_v/=t.scale_v,t.offset_u-=.5,t.offset_v-=.5),t},ComputeObjectTransform:function(a){let t=null;if(a){let n=new e.Matrix4;if(16==a.length)n.setFromArray(a);else{const e=a;n.set(e[0],e[3],e[6],e[9],e[1],e[4],e[7],e[10],e[2],e[5],e[8],e[11],0,0,0,1)}const s=!1;t=(new e.Matrix4).getInverse(n,s)}return t},ComputeUvTransform:function(a,s,l){let o=new e.Matrix3;if(a.type===n.CATMappingType.UV){const e=this.ApplyMapping(s,l),n=t(e),r=t(a);o.multiplyMatrices(n,r)}else{let e=Object.assign({},s);a&&(null!=a.scale_u&&(e.scale_u*=a.scale_u),null!=a.scale_v&&(e.scale_v*=a.scale_v),null!=a.offset_u&&(e.offset_u+=a.offset_u),null!=a.offset_v&&(e.offset_v+=a.offset_v),null!=a.flip_u&&(e.flip_u^=a.flip_u),null!=a.flip_v&&(e.flip_v^=a.flip_v),null!=a.angle&&(e.angle+=a.angle)),e=this.ApplyMapping(e,l),o=t(e)}return o}},computeApplicationMapping:function(a,t,n){let s=this.ResolveReferenceMappingInfo(a),l=this.ResolveApplicationMappingInfo(t,s),o={};if(o.type=l.type,n===this.CATMappingSemantic.DecoupledMapping){o.uv_transform=this.Decoupled.ComputeApplicationUvTransform(l);const e=this.Decoupled.ComputeObjectTransform(t.object_transform,l);e&&(o.object_transform=e)}else{o.uv_transform=new e.Matrix3;const a=this.Legacy.ComputeObjectTransform(t.object_transform);a&&(o.object_transform=a)}return o},computeChannelMapping:function(e,a,t,n,s){let l=this.ResolveChannelMappingInfo(e,t);const o=this.ResolveApplicationMappingInfo(a,l);null!=o.mapFocus&&(l.mapFocus=o.mapFocus),null!=o.type&&(l.type=o.type),null!=o.repeat_u&&(l.repeat_u=o.repeat_u),null!=o.repeat_v&&(l.repeat_v=o.repeat_v);let r={};return r.repeat_u=l.repeat_u,r.repeat_v=l.repeat_v,s===this.CATMappingSemantic.DecoupledMapping?r.uv_transform=this.Decoupled.ComputeChannelUvTransform(l,n):r.uv_transform=this.Legacy.ComputeUvTransform(o,l,n),r},combineMappingResults:function(e,a,t){let n={};return n.repeat_u=a.repeat_u,n.repeat_v=a.repeat_v,n.type=e.type,t===this.CATMappingSemantic.DecoupledMapping?n.uv_transform=this.Decoupled.CombineMapping(e.uv_transform,a.uv_transform):n.uv_transform=a.uv_transform,e.object_transform&&(n.object_transform=e.object_transform),n}};return n}),define("DS/RenderingMaterialLib/MaterialMappingServices",["DS/Visualization/ThreeJS_DS"],function(e){var a=function(e){var a=n(e);return Math.abs(a)<=1e-5?e:(a=1/a,[e[3]*a,-e[1]*a,-e[2]*a,e[0]*a])},t=function(e,a){var t=new Array(4);return t[0]=e[0]*a[0]+e[1]*a[2],t[1]=e[0]*a[1]+e[1]*a[3],t[2]=e[2]*a[0]+e[3]*a[2],t[3]=e[2]*a[1]+e[3]*a[3],t},n=function(e){return e[0]*e[3]-e[1]*e[2]},s=function(a){let n=[1,0,0,1];n[0]=a.scale_u>0?1/a.scale_u:1,n[3]=a.scale_v>0?1/a.scale_v:1;let s=[1,0,0,1];s[0]=a.flip_u?-1:1,s[3]=a.flip_v?-1:1;let l=[1,0,0,1];if(0!=a.angle){let e=Math.sin(a.angle),t=Math.cos(a.angle);l=[t,e,-e,t]}let o=t(t(s,l),n);return new e.Matrix3(o[0],o[2],-a.offset_u,o[1],o[3],-a.offset_v,0,0,1)};return{CATMappingSemantic:{LegacyMapping:0,DecoupledMapping:1},CATMappingBehavior:{TextureFocused:0,SurfaceFocused:1},CATMappingType:{Planar:0,Spherical:1,Cylindrical:2,Box:3,Auto:4,Adaptive:5,UV:6,HemiSpherical:7,InfCylindrical:8},MappingTypeToEnum:["PLANAR","SPHERICAL","FINITE_CYLINDRICAL","CUBIC","None","None","None","None","INFINITE_CYLINDRICAL"],MappingWrapModeToEnum:["CLAMP_TO_EDGE","REPEAT"],computeMapping:function(n,s,l,o){if(!n)return null;if(n&&!s&&!l)return n;var r={};l?(r.repeat_u=l.repeat_u,r.repeat_v=l.repeat_v,r.offset_u=l.offset_u,r.offset_v=l.offset_v,r.angle=l.angle,r.flip_u=l.flip_u,r.flip_v=l.flip_v,r.scale_u=l.scale_u,r.scale_v=l.scale_v):(r.repeat_u=n.repeat_u,r.repeat_v=n.repeat_v,r.offset_u=n.offset_u,r.offset_v=n.offset_v,r.angle=n.angle,r.flip_u=n.flip_u,r.flip_v=n.flip_v,r.scale_u=n.scale_u,r.scale_v=n.scale_v),r.mapFocus=n.mapFocus,r.type=n.type;var i={};r.object_transform=s.object_transform,s&&null!=s.repeat_u&&(r.repeat_u=s.repeat_u),s&&null!=s.repeat_v&&(r.repeat_v=s.repeat_v),s&&null!=s.type&&(r.type=s.type),s&&null!=s.mapFocus&&(r.mapFocus=s.mapFocus),s&&null!=s.scale_u&&(r.scale_u*=s.scale_u),s&&null!=s.scale_v&&(r.scale_v*=s.scale_v),r.scale_v=r.scale_u/r.scale_v,o&&0==r.mapFocus&&(r.scale_u*=parseFloat(o.Width),r.scale_v*=parseFloat(o.Height)),s&&null!=s.offset_u&&(r.offset_u+=s.offset_u),s&&null!=s.offset_v&&(r.offset_v+=s.offset_v),s&&null!=s.flip_u&&(r.flip_u^=s.flip_u),s&&null!=s.flip_v&&(r.flip_v^=s.flip_v),s&&null!=s.angle&&(r.angle+=s.angle);var p,u=[r.offset_u,r.offset_v],c=[r.scale_u,0,0,r.scale_v],_=0==(p=r.angle)?[1,0,0,1]:[Math.cos(p),-Math.sin(p),Math.sin(p),Math.cos(p)],f=[r.flip_u?-1:1,0,0,r.flip_v?-1:1];return i.uv_transform=function(e,n,s,l,o){var r=a(e),i=a(n),p=a(s),u=t(t(i,p),r),c=[];return 1==o?(c[0]=-1*l[0],c[1]=-1*l[1]):(c[0]=-1*(r[0]*l[0]+r[1]*l[1])+.5,c[1]=-1*(r[2]*l[0]+r[3]*l[1])+.5),[u[0],u[1],0,0,u[2],u[3],0,0,0,0,1,0,c[0],c[1],0,1]}(c,f,_,u,r.mapFocus),i.repeat_u=this.MappingWrapModeToEnum[r.repeat_u?1:0],i.repeat_v=this.MappingWrapModeToEnum[r.repeat_v?1:0],i.type=this.MappingTypeToEnum[r.type],r.object_transform&&(i.object_transform=function(a){let t=(new e.Matrix4).setFromArray(a);let n=(new e.Matrix4).getInverse(t,!1),s=new Array(16);return n.flattenToArray(s),s}(r.object_transform)),i},computeDecoupledMapping:function(a,t,n,l){const o={scale_u:1,scale_v:1,offset_u:0,offset_v:0,angle:0,repeat_u:!0,repeat_v:!0,flip_u:!1,flip_v:!1,mapFocus:this.CATMappingBehavior.SurfaceFocused,type:this.CATMappingType.UV};let r=Object.assign({},o);r.mapFocus=a.mapFocus,r.type=a.type,Object.assign(r,t),r.scale_v=r.scale_u/r.scale_v;let i=null;if(r.type!=this.CATMappingType.UV&&r.object_transform){let a=new e.Matrix4,t=(new e.Matrix4).setFromArray(r.object_transform);if(r.mapFocus==this.CATMappingBehavior.TextureFocused){let n=(new e.Vector3).getPositionFromMatrix(t);n.negate();let s=(new e.Matrix4).extractRotation(t);s.transpose();let l=(new e.Vector3).copy(n);l.applyMatrix4(s),(a=(new e.Matrix4).copy(s)).setPosition(l)}else{const n=!1;a=(new e.Matrix4).getInverse(t,n)}i=new Array(16),a.flattenToArray(i)}let p=Object.assign({},o,a);n&&(Object.assign(p,n),p.mapFocus=a.mapFocus,p.type=a.type),p.scale_v=p.scale_u/p.scale_v,null!=r.mapFocus&&(p.mapFocus=r.mapFocus),null!=r.type&&(p.type=r.type),null!=r.repeat_u&&(p.repeat_u=r.repeat_u),null!=r.repeat_v&&(p.repeat_v=r.repeat_v),l&&p.mapFocus==this.CATMappingBehavior.TextureFocused&&(p.scale_u*=parseFloat(l.Width),p.scale_v*=parseFloat(l.Height),p.offset_u*=p.scale_u,p.offset_v*=p.scale_v),p.type==this.CATMappingType.UV&&p.mapFocus!=this.CATMappingBehavior.TextureFocused||(p.offset_u-=.5,p.offset_v-=.5);let u=s(r),c=s(p),_=u.elements[6],f=u.elements[7],g=c.elements[6],m=c.elements[7],v=new e.Matrix3(1,0,_+g-.5,0,1,f+m-.5,0,0,1),M=new e.Matrix3(u.elements[0],u.elements[3],0,u.elements[1],u.elements[4],0,0,0,1),y=new e.Matrix3(c.elements[0],c.elements[3],.5,c.elements[1],c.elements[4],.5,0,0,1),h=new e.Matrix3;h.multiplyMatrices(y,M),h.multiplyMatrices(h,v);var C={};return C.uv_transform=new Array(9),h.flattenToArray(C.uv_transform),C.repeat_u=this.MappingWrapModeToEnum[p.repeat_u?1:0],C.repeat_v=this.MappingWrapModeToEnum[p.repeat_v?1:0],C.type=this.MappingTypeToEnum[p.type],i&&(C.object_transform=i),C}}}),define("DS/RenderingMaterialLib/VisuConversionHelpers",["DS/Visualization/ThreeJS_DS","DS/RenderingMaterialLib/MaterialMappingCoreServices"],function(e,a){"use strict";const t="true"===localStorage.getItem("RmaEnableLog"),n=0,s=1,l=8,o=6|s|l,r=s,i=6|l,p={abbeNumber:"Abbe_Number",anisotropy:"Anisotropy",anisotropyRotation:"AnisotropyRotation",attenuationColor:"Attenuation_Color",attenuationDistance:"Attenuation_Distance",clearcoat:"Clearcoat",clearcoatRoughness:"Clearcoat_Roughness",clearcoatNormal:"Clearcoat_Normal",albedo:"Albedo",emissionColor:"Emission_Color",emissionEnergyNormalization:"Emission_Energy_Normalization",emissionMode:"Emission_Mode",emissionValue:"Emission_Value",flakeColor:"Flake_Color",flakeCoverage:"Flake_Density",flakeDensity:"Flake_Density",flakeRoughness:"Flake_Roughness",flakeSize:"Flake_Size",flipFlop:"Flake_Flipflop",flipFlopColor:"Flake_Flipflop_Color",ior:"IOR",metallic:"Metallic",roughness:"Roughness",sheenColor:"SheenColor",sheenRoughness:"SheenRoughness",specular:"Specular",specularTint:"Specular_Tint",subsurfaceAnisotropy:"Subsurface_Anisotropy",subsurfaceColor:"Subsurface_Color",thinWalled:"Thin_Walled",translucency:"Translucency",transparency:"Transparency",displacement:"Displacement",normal:"Normal",cutoutOpacity:"Opacity",offset_u:"Offset_U",offset_v:"Offset_V",scale_u:"ScaleU",scale_v:"ScaleV",angle:"Angle",repeat_u:"RepeatU",repeat_v:"RepeatV",flip_u:"Flip_U",flip_v:"Flip_V",type:"Mapping",behavior:"Mapping_Behavior"};class u{constructor(e,a,t){this._id=e,this._type=a,this._flags=t}get id(){return this._id}get type(){return this._type}get flags(){return this._flags}get uvTransformId(){return this.hasUvTransform()?this.id+"UvTransform":null}isSupported(){return this.flags!=n}hasValue(){return 0!=(this.flags&s)}hasUvTransform(){return 0!=(this.flags&l)}}const c=function(e,a){return new u(e,1,a=null!=a?a:o)},_=function(e){return new u(e,2,r)},f=function(e){return e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055},g={Albedo:c("diffuse"),Diffuse_Color:c("diffuse"),Anisotropy:c("anisotropy"),AnisotropyRotation:c("anisotropyAngle"),Attenuation_Color:c("attenuationColor",r),Attenuation_Distance:c("attenuationDistance",r),Clearcoat:c("clearCoat"),Clearcoat_Roughness:c("clearCoatRoughness"),Clearcoat_Normal:c("clearCoatNormal",i),Opacity:c("opacity"),Displacement:c("displacement",i),Emission_Color:c("emissionColor"),Emission_Texture:c("emissionColor"),Emissive_Color:c("emissionColor"),Emission_Energy_Normalization:c("emissionNormalized",r),Emission_Value:c("emissionValue",r),Flake_Color:c("flakesColor"),Flake_Density:c("flakesCoverage"),Flake_Flipflop:c("flipFlop"),Flake_Flipflop_Color:c("flipFlopColor"),Flake_Roughness:c("flakesRoughness"),Flake_Size:c("flakesSize"),IOR:c("ior",r),Metallic:c("metalness"),Normal:c("normal",i),Roughness:c("roughness"),SheenColor:c("sheenColor"),SheenRoughness:c("sheenRoughness"),Specular:c("specularContribution"),Specular_Tint:c("specular"),Subsurface_Anisotropy:c("subsurfaceAnisotropy",r),Subsurface_Color:c("subsurfaceColor",r),Thin_Walled:c("thinWalled",r),Translucency:c("translucency"),Transparency:c("transparency"),Abbe_Number:c(null,n),Emission_Mode:c(null,n),Angle:_("angle"),Flip_U:_("flip_u"),Flip_V:_("flip_v"),Mapping:_("type"),Mapping_Behavior:_("mapFocus"),Offset_U:_("offset_u"),Offset_V:_("offset_v"),RepeatU:_("repeat_u"),RepeatV:_("repeat_v"),Scale:_("global_scale"),ScaleU:_("scale_u"),ScaleV:_("scale_v"),Scale_Ratio:_("scale_ratio")},m={CATRmaScalar:e=>parseFloat(e),CATRmaBoolean:e=>e,CATRmaInteger:e=>parseInt(e),CATRmaVector:a=>new e.Vector3(a[0],a[1],a[2]),CATRmaColor:a=>new e.Color(a.map(f))};return{ParamType:{Material:1,Mapping:2},ParamFlag:{Unsupported:n,HasValue:s,HasTexture:2,HasMAD:4,HasUVTrf:l},ConvertValue:function(e,a){const n=m[e];return null!=n?n(a):(t&&console.warn(`[AC] No suitable conversion for type ${e} found.`),a)},GetVisMappingType:function(n){switch(n){case a.CATMappingType.Planar:return e.MappingType.PLANAR;case a.CATMappingType.Spherical:return e.MappingType.SPHERICAL;case a.CATMappingType.Cylindrical:return e.MappingType.FINITE_CYLINDRICAL;case a.CATMappingType.InfCylindrical:return e.MappingType.INFINITE_CYLINDRICAL;case a.CATMappingType.Box:return e.MappingType.CUBIC;case a.CATMappingType.UV:return e.MappingType.NONE;default:return t&&console.warn("[AC] Unsupported Mapping Type:",n),e.MappingType.NONE}},GetVisParamDesc:function(e){let a=g[e];return a||(a=g[e=p[e]]),a}}});