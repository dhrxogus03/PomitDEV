define("DS/VCXWebInteropSMG/VCXSmgLoaderCrypto",["UWA/Class"],function(e){"use strict";return e.extend({init:function(){this.CRYPTO_DELTA=1754008087,this.strKEY="a??????bc??de????????fghi????jklmno????pqrstu??????vwxyzA??????BC??DE????????FGHI????JKLMNO????PQRSTU??VWXYZ0123456789",this.m_pKey=null,this.m_pKey=[0,0,0,0];for(var e=0;e<4;e++)this.m_pKey[e]=0},SetKey:function(e){if(4===e.length)for(var t=0;t<4;t++)this.m_pKey[t]=4294967295&e[t]},TEACodelong_A:function(e){if(2!==e.length)return[];for(var t=e[0],r=e[1],a=0,o=Math.floor(this.CRYPTO_DELTA),i=32;i-- >0;)a+=4294967295&o,r=r+(((t=t+((r<<4&4294967295)+this.m_pKey[0]&4294967295^r+a&4294967295^(r>>5&4294967295)+this.m_pKey[1]&4294967295)&4294967295)<<4&4294967295)+this.m_pKey[2]&4294967295^t+a&4294967295^(t>>5&4294967295)+this.m_pKey[3]&4294967295)&4294967295;return e[0]=t,e[1]=r,e},TEACode:function(e){if(null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"number"==typeof e[0])||null===e)return this.TEACodelong_A(e);if("string"==typeof e||null===e)return this.TEACodejava_lang_String(e);throw new Error("invalid overload")},TEADecodelong_A:function(e){if(2!==e.length)return[];var t,r=32,a=e[0],o=e[1],i=Math.floor(this.CRYPTO_DELTA);for(t=i<<5&4294967295;r-- >0;)a=a-(((o=o-((a<<4&4294967295)+this.m_pKey[2]&4294967295^a+t&4294967295^((4294967295&a)>>>5)+this.m_pKey[3]&4294967295)&4294967295)<<4&4294967295)+this.m_pKey[0]&4294967295^o+t&4294967295^((4294967295&o)>>>5)+this.m_pKey[1]&4294967295)&4294967295,t-=i,t&=4294967295;return e[0]=a,e[1]=o,e},TEADecode:function(e){if(null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"number"==typeof e[0])||null===e)return this.TEADecodelong_A(e);if("string"==typeof e||null===e)return this.TEADecodejava_lang_String(e);throw new Error("invalid overload")},TEACodejava_lang_String:function(e){var t=e;if(t.split("-").join(""),t.split("_").join(""),t.split(".").join(""),t.split("/").join(""),0===t.length)return"";if(0!==t.length%16)return"";t.toUpperCase();for(var r="";t.length>0;){var a=t.substring(0,Math.min(8,t.length));a=(a=t.substring(0,Math.min(16,t.length))).substring(t.length-8,t.length),this.TEACodelong_A([0,0]);r+=void 0,t.length<=16?t="":(t=a.substring(t.length-16,t.length),t+="-")}return r},TEADecodejava_lang_String:function(e){var t=e;if(t.split("-").join(""),t.split("_").join(""),t.split(".").join(""),t.split("/").join(""),0===t.length)return"";if(0!==t.length%16)return"";t.toUpperCase();for(var r="";t.length>0;){var a=t.substring(0,Math.min(8,t.length));a=(a=t.substring(0,Math.min(16,t.length))).substring(t.length-8,t.length),this.TEADecodelong_A([0,0]);r+=void 0,t.length<=16?t="":(t=a.substring(t.length-16,t.length),t+="-")}return r}})}),define("DS/VCXWebInteropSMG/VCXSmgXmlDataStorage",["UWA/Class"],function(e){"use strict";return e.extend({init:function(){this._bIsModifMapUpdated=!1,this._smgXmlDocument=null,this._smgXmlRelativePath=null,this._components=[],this._mapComponentGuids=new Map},SetSmgXmlDocument:function(e){e&&(this._bIsModifMapUpdated=!1,this._smgXmlDocument=e)},GetSmgXmlDocument:function(){return this._smgXmlDocument},SetSmgXmlRelativePath:function(e){e&&(this._smgXmlRelativePath=e)},GetSmgXmlRelativePath:function(){return this._smgXmlRelativePath},GetSmgXmlServerModifNode:function(){if(this._smgXmlDocument){var e=this._smgXmlDocument.Server;return this.getServerFromType(e,"CLitServerModifiable")[0]}},GetSmgXmlViewsNode:function(){if(this._smgXmlDocument){var e=this._smgXmlDocument.Server;return this.getServerFromType(e,"CLitList")}},GetSmgXmlPropertyDefinitions:function(){if(this._smgXmlDocument){var e=this._smgXmlDocument.Server;return this.getServerFromType(e,"PropertyDefinitions")}},AddComponent:function(e){e&&(this._bIsModifMapUpdated=!1,this._components.push(e))},GetComponents:function(){return this._components},GetComponentsMap:function(){return!1===this._bIsModifMapUpdated&&this.ComputeModifiablesMap(),this._mapComponentGuids},ComputeModifiablesMap:function(){for(var e=0;e<this._components.length;e++){var t=this._components[e];if(t){var r=t.GetGUID();this.GetChildrenAndFillMap(t,r)}}this._bIsModifMapUpdated=!0},GetChildrenAndFillMap:function(e,t){this._mapComponentGuids.set(t,e);for(var r=e.QueryInterface("VCXIModelNavigable").getChildren(),a=0;a<r.length;a++){var o=r[a];if(o){var i=o.QueryInterface("VCXIModifiable");if(i)if(e=i.GetObject()){var n=t+"."+e.GetGUID();this.GetChildrenAndFillMap(e,n)}}}},getServerFromType:function(e,t){for(var r=[],a=0;a<e.length;a++){var o=e[a];o["@attributes"].Type===t&&r.push(o)}return r}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderInflate",["UWA/Class","ZipJS/inflate"],function(e,t){"use strict";return e.extend({Inflate:function(e){var t=gztools.getZstream(),r=new Uint8Array(512),a=!1;t.inflateInit(),t.next_out=r;var o,i,n=[],s=0,l=0;if(0!==e.length){t.next_in_index=0,t.next_in=e,t.avail_in=e.length;do{if(t.next_out_index=0,t.avail_out=512,0!==t.avail_in||a||(t.next_in_index=0,a=!0),o=t.inflate(0),a&&-5===o)return-1;if(0!==o&&1!==o)break;if(t.next_out_index&&(512===t.next_out_index?n.push(new Uint8Array(r)):n.push(new Uint8Array(r.subarray(0,t.next_out_index))),l+=t.next_out_index,1===o))break}while(t.avail_in>0||0===t.avail_out);return i=new Uint8Array(l),n.forEach(function(e){i.set(e,s),s+=e.length}),i}}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderTools",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValuePoint2D","DS/VCXWebProperties/VCXPropertyValuePoint","DS/VCXWebProperties/VCXPropertyValueLocation","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueDate","DS/VCXWebProperties/VCXPropertyValueDocId","DS/VCXWebProperties/VCXPropertyValueMap","DS/VCXWebProperties/VCXPropertyValueFont","DS/VCXWebInteropSMG/VCXSmgLoaderCrypto","i18n!DS/VCXWebInteropSMG/assets/nls/VCXWebInteropSMG"],function(e,t,r,a,o,i,n,s,l,p,u,c,C,d,g,m,V,h,y,f){"use strict";var S=e.singleton({fillMatrix:function(e,r){var a=new t.Matrix4;if(void 0===e)return a;var o=e.Origin,i=e.VX,n=e.VY,s=e.VZ;if(void 0!==o&&void 0!==i&&void 0!==n){var l,p=new t.Vector3(parseFloat(i["@attributes"].X.replace(",",".")),parseFloat(i["@attributes"].Y.replace(",",".")),parseFloat(i["@attributes"].Z.replace(",","."))),u=new t.Vector3(parseFloat(n["@attributes"].X.replace(",",".")),parseFloat(n["@attributes"].Y.replace(",",".")),parseFloat(n["@attributes"].Z.replace(",",".")));!0===r||void 0===s?((l=new t.Vector3).crossVectors(p,u),p.normalize(),l.normalize(),u.crossVectors(l,p)):l=new t.Vector3(parseFloat(s["@attributes"].X.replace(",",".")),parseFloat(s["@attributes"].Y.replace(",",".")),parseFloat(s["@attributes"].Z.replace(",","."))),a.set(p.x,u.x,l.x,parseFloat(o["@attributes"].X.replace(",",".")),p.y,u.y,l.y,parseFloat(o["@attributes"].Y.replace(",",".")),p.z,u.z,l.z,parseFloat(o["@attributes"].Z.replace(",",".")),0,0,0,1)}return a},fillPropertyValue:function(e,y,S){var v=null;switch(y){case"VCXPropertyValueString":var b;if(v=new r,e["@attributes"]&&(b="1"===e["@attributes"].Crypted?f["Property.EncryptedValue"]:e["@attributes"].Value),e.Line)for(var P=0;P<e.Line.length;P++)b?b+="\n":b="",b+=e.Line[P]["@attributes"].Value;var A=b;v.SetValue(A);break;case"VCXPropertyValueColor":var X=e["@attributes"];v=new c;var M=new t.Color;M.setRGB(X.R/255,X.G/255,X.B/255),v.SetValue(M);break;case"VCXPropertyValueVector":v=new C;X=e["@attributes"];var I=new t.Vector3(parseFloat(X.X.replace(",",".")),parseFloat(X.Y.replace(",",".")),parseFloat(X.Z.replace(",",".")));v.SetValue(I);break;case"VCXPropertyValueFloat":v=new a;var w=e["@attributes"].Value;v.SetValue(parseFloat(w));break;case"VCXPropertyValueInt":v=new o;w=e["@attributes"].Value;v.SetValue(parseInt(w));break;case"VCXPropertyValueHyperlinkId":v=w=e["@attributes"].Value;break;case"VCXPropertyValueBoolean":v=new n;var L=!1;("true"===(w=e["@attributes"].Value)||parseInt(w)>0)&&(L=!0),v.SetValue(L);break;case"VCXPropertyValueFrame":var D=this.fillMatrix(e.Frame?e.Frame:e,!1);(v=new s).SetValue(D);break;case"VCXPropertyValuePoint2D":var x=e["@attributes"];(v=new l).SetValue(new t.Vector2(parseFloat(x.X.replace(",",".")),parseFloat(x.Y.replace(",","."))));break;case"VCXPropertyValuePoint":x=e["@attributes"];(v=new p).SetValue(new t.Vector3(parseFloat(x.X.replace(",",".")),parseFloat(x.Y.replace(",",".")),parseFloat(x.Z.replace(",","."))));break;case"VCXPropertyValueLocation":var F=this.fillMatrix(e.Frame,!1),B=this.fillMatrix(e.Pivot,!1);v=new u;var _=new s;_.SetValue(F),v.SetFrame(_);var T=new s;T.SetValue(B),v.SetPivot(T);break;case"VCXPropertyValueAnchor":F=this.fillMatrix(e.Frame,!0),v=new d;var G=new s;if(G.SetValue(F),v.SetValueFrame(G),void 0!==(X=e["@attributes"])){var W=X.AttachId,N=S.ComponentsMap.GetComponentFromID(W);N&&v.SetValueLinkFromComponent(N)}break;case"VCXPropertyValueEnum":v=new i;w=e["@attributes"].Value;v.SetValue(parseInt(w));break;case"VCXPropertyValueDate":x=e["@attributes"];var k=new Date(x.Year,x.Month-1,x.Day,x.Hour,x.Min,x.Sec);v=new g(k);break;case"VCXPropertyValueDocId":(v=new m(k)).SetValue(-1);break;case"VCXPropertyValueMap":v=new V;break;case"VCXPropertyValueFont":if(v=new h,x=e["@attributes"]){if(x.FaceName){var O=x.FaceName;"MS Shell Dlg"===O&&(O="Microsoft Sans Serif"),v.SetFamily(new r(O))}if(x.Height&&v.SetHeight(new a(-parseFloat(x.Height)/1.33333)),x.Weight&&v.SetWeight(new o(parseInt(x.Weight))),x.Italic){L=!1;("true"===x.Italic||parseInt(x.Italic)>0)&&(L=!0),v.SetItalic(new n(L))}if(x.Underline){L=!1;("true"===x.Underline||parseInt(x.Underline)>0)&&(L=!0),v.SetUnderline(new n(L))}if(x.StrikeOut){L=!1;("true"===x.StrikeOut||parseInt(x.StrikeOut)>0)&&(L=!0),v.SetCrossline(new n(L))}}}return v},getPropertiesDicoFromWebComponent:function(e){S._factory&&S._factory._mapComponentConverter||console.warn("Properties dictionary is not set");var t=S._factory._mapComponentConverter.get(e);return t?t.getPropertiesDescription():(console.warn("Can't find any property name translation"),null)},getPropertiesDicoFromWebType:function(e){if(!S._factory)return null;var t=S._factory.getV1Ids();if(!t)return null;for(var r in t)if(t[r]&&t[r].classname===e){var a=new t[r].classFcntName;return a?a.getPropertiesDescription():(console.warn("Can't find any property name translation"),null)}},getPropertiesDicoFromWebTypeWithInheritance:function(e){if(!S._factory||!S._factory._mapComponentConverter)return null;var t=S.getPropertiesDicoFromWebType(e);return S._factory._mapComponentConverter.forEach(function(r,a){a&&a.IsKindOf(e)&&r&&(t=UWA.extend(t,r.getPropertiesDescription()))}),t},getPropertiesDicoFromV1Type:function(e){if(!S._factory)return null;var t=S._factory.getV1Ids();if(!t)return null;var r=new t[e].classFcntName;return r?r.getPropertiesDescription():(console.warn("Can't find any property name translation"),null)},_getAnchorIds:function(e,t){var r=[];t.forEach(function(e,t){var a=e;if("VCXPropertyValueAnchor"===a.GetType()){var o=a.GetValue();o&&o[0].Value&&r.push(o[0].Value)}});var a=e.GetHashing();if(a){var o=e.ExperienceBase.getManager("VCXScenarioManager").GetNeutrals(a);if(o&&o._map)for(var i in o._map)if(o._map.hasOwnProperty(i)){var n=o.GetProperty(i).GetPropertyValue();if(n&&"VCXPropertyValueAnchor"===n.GetType()){var s=n.GetValue();s&&s[0].Value&&r.push(s[0].Value)}}}return r},getLinkedPropertyFromParent:function(e,t,r,a){var o="";if(o="$(#"+(t||"")+"#"+e+")",r.length){var i=a[r[0]];if(t){for(var n=i.QueryInterface("VCXIModelNavigable"),s=0;s<t;++s){if(!n){console.warn("Invalid string");break}n=n.getParent()}i=n.GetObject()}if(i){var l=S.getPropertiesDicoFromWebComponent(i);l&&l[e]&&(o=o.replace(e,l[e].name))}}return o},getNeutralPropertyValue:function(e,t){var r=null;if(!e)return r;var a=e.ExperienceBase.getManager("VCXScenarioManager").GetNeutrals(e.GetHashing());if(a&&a._map.hasOwnProperty(t)){var o=a.GetProperty(t);o&&(r=o.GetPropertyValue().GetValue())}return r},translateLinkedPropertyString:function(e,t,r,a,o,i){if(!e)return o;var n=this.getNeutralPropertyValue(t,"Collab.Text.LinkedProperty"),s=this.getNeutralPropertyValue(t,"Collab.Text.LinkedParentLevel");if(!o&&!r){if(!a)return"";r=n}a||(a=s);var l=e.ComponentsMap.GetComponentTable();if(!l)return o;var p="",u=this._getAnchorIds(t,i);if(u.length>0&&r&&"Text String"!==r)p=this.getLinkedPropertyFromParent(r,a,u,l);else if(o&&a&&u.length>0&&n&&"Text String"!==n)p=this.getLinkedPropertyFromParent(n,a,u,l);else if(o){p=o;var c=o.match(/([^$]|^)\$\(([0-9a-zA-Z.|_#-\s]*)\)+/g);if(c)for(var C=0;C<c.length;++C){var d=c[C];if(d){var g=d.substring(d.indexOf("(")+1,d.lastIndexOf("#")),m=d.substring(d.lastIndexOf("#")+1,d.length-1),V=l[g],h=""!==g&&!isNaN(g);if(V||h){for(var y="",f=0;f<d.length&&"$"!==d[f];)y+=d[f++];if(y+="$(",V?y+=g+"#0":h&&(y+="#"+g),y+="#"+m+")",V||(V=u.length?l[u[0]]:t.GetObject()),V){var v=S.getPropertiesDicoFromWebComponent(V),b=v&&v[m]?v[m].name:null;if(!b){var P=e.getManager("VCXMetaPropertyManager");(P&&P._MetaPropertyDef?P._MetaPropertyDef[m]:null)&&(b=m)}b?(y=y.replace(m,b),p=p.replace(d,y)):(p=p.replace(d," ? "),console.log("Warning : a property referenced by collab string : "+m+" doesn't exist - Check if property is imported"))}}else console.log("VCXSmgLoaderTools.translateLinkedPropertyString : Regex problem")}}}else""===o&&r&&"Text String"===r&&(p=" ");return p},_reflectCRC:function(e,t){for(var r=0,a=1;a<t+1;a++)0!=(1&e)&&(r|=1<<t-a),e>>=1,e&=4294967295;return r},calcCRC:function(e){var t=e.length;if(0===e.length||0===t)return 0;for(var r=function(e){for(var t=[];e-- >0;)t.push(0);return t}(256),a=0;a<=255;a++){r[0|a]=this._reflectCRC(a,8)<<24&4294967295;for(var o=0;o<8;o++)r[a]=4294967295&(r[a]<<1&4294967295^(0!=(-2147483648&r[a]&4294967295)?79764919:0));r[a]=this._reflectCRC(r[a],32)}var i=-1,n=e,s=i;for(a=0;t-- >0;){var l=0|s,p=l>>>8,u=255&l,c=n[a++],C=255&(u^c)|0,d=r[C];s=4294967295&(p^d),t-- >0&&(s=4294967295&((p=(l=0|s)>>>8)^(d=r[C=255&((u=255&l)^(c=0))|0])))}var g=4294967295^(i=s);return g<0?g>>>0:g},_ulong:function(e){return e<0?e>>>0:e},decodeOptions:function(e,t){var r=this._ulong(t),a=[];a[0]=305419896,a[1]=591751049|r,a[2]=878082192,a[3]=247375429;for(var o=[],i=0;i<e.length;i++)o[i]=4294967295&e[i];var n=new y;n.SetKey(a);var s=n.TEADecode(o),l=0,p=s[1]&r;return p!==r&&p!==s[1]||(l=s[0]),this._ulong(l)},loadXMLString:function(e){var t;window.DOMParser?t=(new DOMParser).parseFromString(e,"text/xml"):((t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e));return t},xmlToJson:function(e){var t={};if(1===e.nodeType){if(e.attributes.length>0){t["@attributes"]={};for(var r=0;r<e.attributes.length;r++){var a=e.attributes.item(r);t["@attributes"][a.nodeName]=a.nodeValue}}}else 3===e.nodeType&&(t=e.nodeValue);if(e.hasChildNodes())for(var o=0;o<e.childNodes.length;o++){var i=e.childNodes.item(o),n=i.nodeName;if(void 0===t[n])t[n]=this.xmlToJson(i);else{if(void 0===t[n].push){var s=t[n];t[n]=[],t[n].push(s)}t[n].push(this.xmlToJson(i))}}return t},RelativeToAbsolute:function(e,t){for(var r=e.split("/"),a=t.split("/"),o=0;o<a.length;o++)"."!=a[o]&&".."!=a[o]&&r.push(a[o]);return r.join("/")}});return S}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiable",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueEnum","DS/WebRBTree/WebRBIterator"],function(e,t,r,a,o,i){"use strict";var n={"Actor.Name":{name:"Actor.Name",type:"VCXPropertyValueString"},"Text.StayOnTop":{name:"Actor.IsAlwaysOnTop",type:"VCXPropertyValueBoolean"},"Actor.ToolTip":{name:"Actor.ToolTip",type:"VCXPropertyValueString"},"Actor.LinkedToolTipPropertyName":{name:null,type:"VCXPropertyValueString"},Link:{name:"Actor.Hyperlink",type:"VCXPropertyValueHyperlinkId"},"Actor.Color":{name:"Actor.Color",type:"VCXPropertyValueColor"},"Actor.Alpha":{name:"Actor.Opacity",type:"VCXPropertyValueFloat"},"Actor.Location":{name:"Actor.Position",type:"VCXPropertyValueLocation"},"Actor.Interpolator.Location":{name:"Actor.Interpolation.Type",type:"VCXPropertyValueEnum"},"Actor.BomId":{name:"Actor.BomId",type:"VCXPropertyValueString"}};return e.extend({getPropertiesDescription:function(){return UWA.extend({},n)},getPropertiesMap:function(e,o,s,l,p){var u=new Map,c=null,C=null;for(var d in s){var g=s[d],m=n[d];if(m){var V=t.fillPropertyValue(g,m.type,o);switch(d){case"Actor.ToolTip":c=V.Value,V=null;break;case"Actor.LinkedToolTipPropertyName":C=V.Value;break;case"Actor.Color":if(void 0!==g["@attributes"]){var h=new r,y=g["@attributes"].Defined;h.SetValue("0"!==y),u.set("Actor.Color.Defined",h),V._bDefined="0"!==y}break;case"Actor.Alpha":V.Value/=255;break;case"Actor.Interpolator.Location":if(void 0!==g["@attributes"]&&void 0!==g["@attributes"].Value)switch(parseInt(g["@attributes"].Value)){case 0:V.SetValue(0);break;case 2:case 4:V.SetValue(1);break;default:V.SetValue(0)}else V=null;break;case"Actor.BomId":"string"!=typeof V.Value&&(V=null);break;case"Link":var f=t.fillPropertyValue(g,"VCXPropertyValueHyperlinkId",o),S=null;if(f.indexOf("file://")>=0){var v=f.lastIndexOf("\\"),b=f.substring(v+1),P=l[b.toLowerCase()];P&&(S=o.getManager("VCXDocManager").BuildPathFromString(P,b))}else if(f)if(f.indexOf("view://")>=0){var A=f.substring(7);S=o.getManager("VCXDocManager").BuildPathFromLink(A)}else if(f.indexOf("previous://")>=0||f.indexOf("next://")>=0||f.indexOf("first://")>=0||f.indexOf("last://")>=0){v=f.indexOf("ref:");var X=f.substring(v+4);f="scenario://"+X,S=o.getManager("VCXDocManager").BuildPathFromString(f,"")}else if(f.indexOf("http://")>=0||f.indexOf("https://")>=0||f.indexOf("ftp://")>=0)S=o.getManager("VCXDocManager").BuildPathFromString(f,"");else{var M=o.getManager("VCXSequenceManager").GetListSequencesFromType(0)[0].GetListScenariosId()[0],I=o.ComponentsMap.GetComponentFromID(M),w=null,L="";f.indexOf("play://")>=0?(w=2,L=f.substring(7)):f.indexOf("marker://")>=0?(w=3,L=f.substring(9)):f.indexOf("playmarkersequence://")>=0&&(w=4,L=f.substring(21));var D=I.GetTrackMarkers();if(D)for(var x=D._treekeys,F=new i(x),B=F.next();null!==B;){var _=B.GetValue(),T=o.ComponentsMap.GetComponentFromID(_);if(T)if(T.GetName()===L){S=o.getManager("VCXDocManager").BuildPathFromLink(_,w);break}B=F.next()}S||2!==w&&4!==w||(S=o.getManager("VCXDocManager").BuildPathFromLink(M,w))}V=o.getManager("VCXDocManager").AddOrModifyHyperlink(S)}m.name&&V&&u.set(m.name,V)}else if("Meta."===d.slice(0,5)){var G=o.getManager("VCXMetaPropertyManager").GetMetaPropertyDef(d);if(G)(V=t.fillPropertyValue(g,G.GetType(),o))?u.set(d,V):console.log("smgloader : meta fillPropertyValue FAILED");else console.log("smgloader : meta property def NOT FOUND")}}if(C||c){var W;if(C&&"Label String"!==C){var N="";C.startsWith("niveau ")>0?(N=C.substring(7),C="Actor.Name"):C.startsWith("level ")>0&&(N=C.substring(6),C="Actor.Name"),W="$(#"+N+"#"+C+")"}else W=c;if(W){W=W.replace("Actor.Alpha","Actor.Opacity");var k=new a;k.Value=W,u.set("Actor.ToolTip",k)}}return u}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressup",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiable"],function(e,t,r){"use strict";var a={};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),a)},getPropertiesMap:function(e,r,o,i,n){var s=this._parent(e,r,o,i,n);for(var l in o){var p=a[l];if(p){var u=o[l],c=t.fillPropertyValue(u,p.type,r);l,p.name&&c&&s.set(p.name,c)}}return s}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableOccurrence",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiable"],function(e,t,r){"use strict";var a={"Actor.LayerOpacity":{name:"Actor.LayerOpacity",type:"VCXPropertyValueFloat"},"Actor.Rendering":{name:"Actor.Rendering",type:"VCXPropertyValueEnum"},"Actor.Priority":{name:"Actor.Priority",type:"VCXPropertyValueEnum"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),a)},getPropertiesMap:function(e,r,o,i,n){var s=this._parent(e,r,o,i,n);for(var l in o){var p=a[l];if(p){var u=o[l],c=t.fillPropertyValue(u,p.type,r);switch(l){case"Actor.LayerOpacity":c.Value/=256}p.name&&c&&s.set(p.name,c)}}return s}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupArrow",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressup","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueBoolean","i18n!DS/VCXWebInteropSMG/assets/nls/VCXWebInteropSMG"],function(e,t,r,a,o,i){"use strict";var n=0,s=1,l=2,p=3,u=!1,c={"Actor.Color":{name:"Arrow.Body.Color",type:"VCXPropertyValueColor"},"ActorArrow.Bg.Opacity":{name:"Arrow.Body.Color.Opacity",type:"VCXPropertyValueFloat"},"Actor.Gradient":{name:null,type:"VCXPropertyValueBoolean"},"ActorArrow.Border":{name:"Collab.Border.Show",type:"VCXPropertyValueBoolean"},"ActorArrow.Border.Type":{name:"Collab.Border.Line.Type",type:"VCXPropertyValueEnum"},"ActorArrow.Border.Width":{name:"Collab.Border.Line.Width",type:"VCXPropertyValueFloat"},"ActorArrow.Border.Color":{name:"Collab.Border.Line.Color",type:"VCXPropertyValueColor"},"ActorArrow.Border.Opacity":{name:"Collab.Border.Line.Color.Opacity",type:"VCXPropertyValueFloat"},"Actor.Thickness":{name:"Arrow.Width.1",type:"VCXPropertyValueFloat"},"Actor.Thickness2":{name:"Arrow.Width.1",type:"VCXPropertyValueFloat"},"ActorArrow.Thickness":{name:"Arrow.Width.1",type:"VCXPropertyValueFloat"},"ActorArrow.Thickness2":{name:"Arrow.Width.1",type:"VCXPropertyValueFloat"},"ActorArrow.Extremity":{name:null,type:"VCXPropertyValueInt"},"ActorArrow.Extremity.Head":{name:null,type:"VCXPropertyValueFloat"},"ActorArrow.Extremity.x":{name:null,type:"VCXPropertyValueFloat"},"ActorArrow.Extremity.y":{name:null,type:"VCXPropertyValueFloat"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),c)},getPropertiesMap:function(e,r,C,d,g){var m=this._parent(e,r,C,d,g),V=!1,h=!1,y=!1,f=!1,S=!1,v=!1;if(!0===(C["ActorArrow.OldVersion"]&&C["ActorArrow.OldVersion"]["@attributes"]&&"1"===C["ActorArrow.OldVersion"]["@attributes"].Value)&&C["Actor.Thickness"]&&!e.bIsOldVersion&&(m.set("Collab.Is.Paper",new o(!0)),e.bIsOldVersion=!0,!u)){var b={level:"warning",title:i["Notification.ArrowOldVersion.Title"],message:i["Notification.ArrowOldVersion.Msg"]};r.getManager("VCXNotificationManager").addNotification(b),u=!0}for(var P in C){var A=c[P];if(A){var X=C[P],M=t.fillPropertyValue(X,A.type,r);switch(P){case"Actor.Color":v=!0,e.bodyColorPropVal=M.Clone(),m.set("Arrow.Body.2.Color",M);break;case"ActorArrow.Bg.Opacity":v=!0,M.Value/=255,e.bodyOpacity=M.Value,m.set("Arrow.Body.2.Color.Opacity",M);break;case"Actor.Gradient":v=!0,e.gradient=M.Value;break;case"ActorArrow.Border.Color":e.borderColorPropVal=M.Clone(),m.set("Collab.Border.Line.2.Color",M);break;case"ActorArrow.Border.Opacity":M.Value/=255,e.borderOpacity=M.Value,m.set("Collab.Border.Line.2.Color.Opacity",M);break;case"Actor.Thickness":if(!e.bIsOldVersion){M=null;break}M.SetValue(.25*M.GetValue()),m.set("Arrow.Width.2",M),e.smgThickness=M.Value,e.smgExtremityHead=2*e.smgThickness,e.smgExtremityX=0,e.smgPreviousExtremityY=e.smgThickness,S=!0,h=!0,y=!0,f=!0;break;case"Actor.Thickness2":if(e.bIsOldVersion)break;S=!0,e.smgThickness=M.Value,m.set("Arrow.Width.2",M);break;case"ActorArrow.Extremity":v=!0,S=!0,V=!0,e.smgExtremity=M.Value;break;case"ActorArrow.Extremity.Head":if(e.bIsOldVersion)break;S=!0,h=!0,y=!0,e.smgExtremityHead=M.Value;break;case"ActorArrow.Extremity.x":if(e.bIsOldVersion)break;S=!0,y=!0,e.smgExtremityX=M.Value;break;case"ActorArrow.Extremity.y":if(e.bIsOldVersion)break;S=!0,f=!0,e.smgPreviousExtremityY=M.Value}A.name&&M&&m.set(A.name,M)}}if(S){var I=null,w=null,L=null,D=null,x=null,F=null,B=new o,_=new o;"number"==typeof e.smgPreviousExtremityY&&"number"==typeof e.smgThickness&&(e.smgExtremityY=e.smgPreviousExtremityY-.5*e.smgThickness);var T=e.smgExtremityHead,G=e.smgExtremityY,W=-e.smgExtremityHead*e.smgExtremityX;switch(void 0!==e.smgExtremityHead&&(I=new a(T),w=new a(T)),void 0!==e.smgExtremityY&&(L=new a(G),D=new a(G)),void 0!==e.smgExtremityX&&(x=new a(W),F=new a(W)),e.smgExtremity){case n:B.SetValue(!0),_.SetValue(!1);break;case s:B.SetValue(!1),_.SetValue(!0);break;case l:B.SetValue(!0),_.SetValue(!0);break;case p:B.SetValue(!1),_.SetValue(!1)}V&&(m.set("Arrow.Head.ShowMode",B),m.set("Arrow.Head.2.ShowMode",_)),h&&(m.set("Arrow.Head.Length",I),m.set("Arrow.Head.2.Length",w)),f&&(m.set("Arrow.Head.Size",L),m.set("Arrow.Head.2.Size",D)),y&&(m.set("Arrow.Head.Shape",x),m.set("Arrow.Head.2.Shape",F))}if(v&&e.gradient){var N=new a(0);switch(e.smgExtremity){case n:m.set("Arrow.Body.2.Color.Opacity",N),m.set("Collab.Border.Line.2.Color.Opacity",N);break;case s:m.set("Arrow.Body.Color.Opacity",N),m.set("Collab.Border.Line.Color.Opacity",N)}}return m}})}),define("DS/VCXWebInteropSMG/VCXSmgGeomLoader",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Mesh/MeshUtils","DS/VCXWebInteropSMG/VCXSmgLoaderInflate","DS/VCXWebSystem/VCXMeshServices","DS/VCXWebIO/VCXLogServices","DS/VCXWebKernel/VCXDRMManager"],function(e,t,r,a,o,i,n,s){"use strict";var l=0,p=8449,u=7681,c=8448,C=260,d=3042,g=34160,m=34683,V=0,h=0,y=3;return e.extend({init:function(e){this._geoms=new Map,this._experienceBase=e,this._materialManager=this._experienceBase?this._experienceBase.getManager("VCXMaterialManager"):null,this.resources=null,this.outlines=null,this.alwaysBuildIndexedTrianglesSets=!0,this.alwaysBuildIndexedLinesSets=!0,this.ignoreGeodeMatrix=!0,this.mergeGeosets=!0,this.positionInBuffer=0,this.bufferSize=0,this.version=0,this.strFileNameAssociate="",this.checksum=0,this.ulOptionsPro=[],this.ulWatermark=[],this.ulHasExpirationDate=[],this.ulStartDate=[],this.ulEndDate=[],this.ulIsRelativeExpirationDate=[],this.bHasNormals=!1,this.cCodage=100,this.ulHasSignature=0,this.strSignaturePicturePath="",this.strAgreement="",this.ulAgreementMode=0,this.ulSignatureCRC=[],this.bHasTexture=!1,this.nTriangles=0},openZStream:function(e){if(!(e.length<=10)&&e instanceof Uint8Array){if(31===e[0]&&139===e[1]){for(var t=new Uint8Array(e.length-10),r=0;r<e.length-10;r++)t[r]=e[r+10];var a=(new o).Inflate(t),i=new ArrayBuffer(a.length),n=new Uint8Array(i);for(r=0;r<a.length;r++)n[r]=a[r];var s=new DataView(i);return this.positionInBuffer=0,this.bufferSize=s.byteLength,s}}else console.log("smgGeom : Invalid bytes")},setIgnoreGeodeMatrix:function(e){this.ignoreGeodeMatrix=e},setResources:function(e){void 0!==e&&(this.resources=e)},setOutlines:function(e){void 0!==e&&(this.outlines=e)},getMapGeodes:function(){return this._geoms},getBool:function(e){if(!(this.positionInBuffer>=this.bufferSize)){var t=0!==e.getInt8(this.positionInBuffer);return this.positionInBuffer+=1,t}},getChar:function(e){if(!(this.positionInBuffer>=this.bufferSize)){var t=e.getInt8(this.positionInBuffer);return this.positionInBuffer+=1,t}},getWChar:function(e){if(!(this.positionInBuffer>=this.bufferSize)){var t=e.getInt16(this.positionInBuffer,!0);return this.positionInBuffer+=2,t}},getWString:function(e){for(var t="",r=this.getWChar(e);0!==r&&10!==r&&void 0!==r;)t+=String.fromCharCode(r),r=this.getWChar(e);return{value:t,byteSize:2*t.length}},getString:function(e){var t="",r=0;if(this.version<6.7){for(var a=this.getChar(e);0!==a&&10!==a&&void 0!==a;)t+=String.fromCharCode(a),a=this.getChar(e);r=t.length}else{for(a=this.getWChar(e);0!==a&&10!==a&&void 0!==a;)t+=String.fromCharCode(a),a=this.getWChar(e);r=2*t.length}return{value:t,byteSize:r}},getUnsignedChar:function(e){if(!(this.positionInBuffer>=this.bufferSize)){var t=e.getUint8(this.positionInBuffer);return this.positionInBuffer+=1,t}},getCharArray:function(e,t){if(!(this.positionInBuffer>=this.bufferSize)){for(var r=new Int8Array(t),a=0;a<t;a++){var o=e.getInt8(this.positionInBuffer);this.positionInBuffer+=1,r[a]=o}return r}},getUnsignedInt8Array:function(e,t){if(!(this.positionInBuffer>=this.bufferSize)){for(var r=new Uint8Array(t),a=0;a<t;a++){var o=e.getUint8(this.positionInBuffer);this.positionInBuffer+=1,r[a]=o}return r}},getUnsignedInt16Array:function(e,t){if(!(this.positionInBuffer>=this.bufferSize)){for(var r=new Uint16Array(t),a=0;a<t;a++){var o=e.getUint16(this.positionInBuffer,!0);this.positionInBuffer+=2,r[a]=o}return r}},getDouble:function(e){if(!(this.positionInBuffer>=this.bufferSize)){var t=e.getFloat64(this.positionInBuffer,!0);return this.positionInBuffer+=8,t}},getFloat:function(e){if(!(this.positionInBuffer>=this.bufferSize)){var t=e.getFloat32(this.positionInBuffer,!0);return this.positionInBuffer+=4,t}},getLong:function(e){if(!(this.positionInBuffer>=this.bufferSize)){var t=e.getInt32(this.positionInBuffer,!0);return this.positionInBuffer+=4,t}},getUnsignedInt:function(e){if(!(this.positionInBuffer>=this.bufferSize)){var t=e.getUint32(this.positionInBuffer,!0);return this.positionInBuffer+=4,t}},getUnsignedLong:function(e){if(!(this.positionInBuffer>=this.bufferSize)){var t=e.getUint32(this.positionInBuffer,!0);return this.positionInBuffer+=4,t}},getUnsignedIntArray:function(e,t){if(!(this.positionInBuffer>=this.bufferSize)){for(var r=new Uint32Array(t),a=0;a<t;a++){var o=e.getUint32(this.positionInBuffer,!0);this.positionInBuffer+=4,r[a]=o}return r}},getUnsignedLongArray:function(e,t){if(!(this.positionInBuffer>=this.bufferSize)){for(var r=new Uint32Array(t),a=0;a<t;a++){var o=e.getUint32(this.positionInBuffer,!0);this.positionInBuffer+=4,r[a]=o}return r}},getFloatArray:function(e,t){if(!(this.positionInBuffer>=this.bufferSize)){for(var r=new Float32Array(t),a=0;a<t;a++){var o=e.getFloat32(this.positionInBuffer,!0);this.positionInBuffer+=4,r[a]=o}return r}},ReadMat:function(e){var r=this.getFloatArray(e,16),a=new t.Matrix4;return a.set(r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13],r[2],r[6],r[10],r[14],0,0,0,1),a},ReadMatrix:function(e){var r=this.getChar(e);if(void 0===r||!r)return!1;var a=this.getFloatArray(e,16),o=new t.Matrix4;return o.set(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],0,0,0,1),{hasTransfo:r,matrix:o}},DecodeFloat8:function(e,t,r){return e*(1-r/255)+t*(r/255)},DecodeFloat16:function(e,t,r){return e*(1-r/65535)+t*(r/65535)},ReadTabSglVec2f:function(e,t,r){var a=this.getChar(e);if(97!==a){var o=this.getFloat(e),i=this.getFloat(e),n=this.getFloat(e),s=this.getFloat(e);if(98===a)for(l=this.getUnsignedInt16Array(e,2*t),p=0;p<t;p++){u=2*p,c=this.DecodeFloat16(o,i,l[u++]),C=this.DecodeFloat16(n,s,l[u++]);r[2*p]=c,r[2*p+1]=C}else if(99===a)for(l=this.getUnsignedInt8Array(e,2*t),p=0;p<t;p++){u=2*p,c=this.DecodeFloat8(o,i,l[u++]),C=this.DecodeFloat8(n,s,l[u++]);r[2*p]=c,r[2*p+1]=C}}else for(var l=this.getFloatArray(e,2*t),p=0;p<t;p++){var u=2*p,c=l[u++],C=l[u++];r[2*p]=c,r[2*p+1]=C}},GetTabVector8:function(e,t,r,a,o,i,n,s,l,p,u,c,C,d,g){var m=0;if(a||o||i)for(V=0;V<t;V++)a?r[m++]=n:(r[m++]=this.DecodeFloat8(p,u,e.getUint8(this.positionInBuffer,!0)),this.positionInBuffer+=1),o?r[m++]=s:(r[m++]=this.DecodeFloat8(c,C,e.getUint8(this.positionInBuffer,!0)),this.positionInBuffer+=1),i?r[m++]=l:(r[m++]=this.DecodeFloat8(d,g,e.getUint8(this.positionInBuffer,!0)),this.positionInBuffer+=1);else for(var V=0;V<t;V++)r[m++]=this.DecodeFloat8(p,u,e.getUint8(this.positionInBuffer,!0)),this.positionInBuffer+=1,r[m++]=this.DecodeFloat8(c,C,e.getUint8(this.positionInBuffer,!0)),this.positionInBuffer+=1,r[m++]=this.DecodeFloat8(d,g,e.getUint8(this.positionInBuffer,!0)),this.positionInBuffer+=1},GetTabVector16:function(e,t,r,a,o,i,n,s,l,p,u,c,C,d,g){var m=0;if(a||o||i)for(V=0;V<t;V++)a?r[m++]=n:(r[m++]=this.DecodeFloat16(p,u,e.getUint16(this.positionInBuffer,!0)),this.positionInBuffer+=2),o?r[m++]=s:(r[m++]=this.DecodeFloat16(c,C,e.getUint16(this.positionInBuffer,!0)),this.positionInBuffer+=2),i?r[m++]=l:(r[m++]=this.DecodeFloat16(d,g,e.getUint16(this.positionInBuffer,!0)),this.positionInBuffer+=2);else for(var V=0;V<t;V++)r[m++]=this.DecodeFloat16(p,u,e.getUint16(this.positionInBuffer,!0)),this.positionInBuffer+=2,r[m++]=this.DecodeFloat16(c,C,e.getUint16(this.positionInBuffer,!0)),this.positionInBuffer+=2,r[m++]=this.DecodeFloat16(d,g,e.getUint16(this.positionInBuffer,!0)),this.positionInBuffer+=2},GetTabVector32:function(e,t,r,a,o,i,n,s,l){var p=0;if(a||o||i)for(u=0;u<t;u++)a?r[p++]=n:(r[p++]=e.getFloat32(this.positionInBuffer,!0),this.positionInBuffer+=4),o?r[p++]=s:(r[p++]=e.getFloat32(this.positionInBuffer,!0),this.positionInBuffer+=4),i?r[p++]=l:(r[p++]=e.getFloat32(this.positionInBuffer,!0),this.positionInBuffer+=4);else for(var u=0;u<t;u++)r[p++]=e.getFloat32(this.positionInBuffer,!0),this.positionInBuffer+=4,r[p++]=e.getFloat32(this.positionInBuffer,!0),this.positionInBuffer+=4,r[p++]=e.getFloat32(this.positionInBuffer,!0),this.positionInBuffer+=4},ReadIndex:function(e,t,r){if(r<256){for(var a=this.getUnsignedInt8Array(e,t),o=new Uint16Array(a.length),i=0;i<a.length;++i)o[i]=a[i];return o}return r<65536?this.getUnsignedInt16Array(e,t):this.getUnsignedIntArray(e,t)},ReadTabSglVec3f:function(e,t,r){var a=this.getChar(e),o=this.getBool(e),i=this.getBool(e),n=this.getBool(e),s=0,l=0,p=0;if(o&&(0,s=this.getFloat(e)),i&&(l=this.getFloat(e),0),n&&(p=this.getFloat(e),0),97!==a){var u=0,c=0,C=0,d=0,g=0,m=0;o||(u=this.getFloat(e),c=this.getFloat(e)),i||(C=this.getFloat(e),d=this.getFloat(e)),n||(g=this.getFloat(e),m=this.getFloat(e)),98===a?this.GetTabVector16(e,t,r,o,i,n,s,l,p,u,c,C,d,g,m):99===a&&this.GetTabVector8(e,t,r,o,i,n,s,l,p,u,c,C,d,g,m)}else this.GetTabVector32(e,t,r,o,i,n,s,l,p)},ReadTriangleSet:function(e,t,r,o){var n=this.getUnsignedInt(e),s=3*n,l=new Float32Array(3*s);this.ReadTabSglVec3f(e,s,l);var p=null;if(this.getUnsignedInt(e)!==h&&(p=new Float32Array(3*s),this.ReadTabSglVec3f(e,s,p)),this.version>=6.8)this.getUnsignedInt(e);for(var u=i.allocIndexationArray(s,s),c=0;c<s;c++)u[c]=c;return p||(p=i.computeSmoothNormalsTrianglesSet(l,u)),this.nTriangles+=n,{meshType:a.ConnectivityTypeEnum.TRIANGLES,nTriangles:n,vertexArray:l,normalsArray:p,uvArray:null,vertexIndexArray:u,normalsIndexArray:u,uvIndexArray:null,uniqueIndexation:!0,colorRGBA:new a.Color(t[0],t[1],t[2],r)}},ReadIndexedTriangleSet:function(e,r,o,n){var s=this.getUnsignedInt(e),l=this.getUnsignedInt(e),p=this.getUnsignedInt(e),u=new Float32Array(3*l);this.ReadTabSglVec3f(e,l,u);var c=this.ReadIndex(e,p,l),C=null,d=null,g=0;if(this.getUnsignedInt(e)!==h){g=this.getUnsignedInt(e);C=new Float32Array(3*g);this.ReadTabSglVec3f(e,g,C),d=this.ReadIndex(e,p,g)}else g=l,C=i.computeSmoothNormalsTrianglesSet(u,c),d=c;var m=[],V=null;if(this.version>=6.8){var f=this.getUnsignedInt(e);if(f){for(var S=this.getUnsignedInt(e),v=0;v<f;++v){if(this.getUnsignedInt(e)===y){var b=new Float32Array(2*l);this.ReadTabSglVec2f(e,l,b),m.push(b)}}V=this.ReadIndex(e,p,S);m.length&&n}}if(l!==g){console.warn("Indexed triangles set geometry should use the same indexation buffer for vertices and normals");for(var P=3*s,A=new Float32Array(3*P),X=new Float32Array(3*P),M=P<65536?new Uint16Array(P):new Uint32Array(P),I=0,w=0;w<P;++w){var L=3*c[w],D=u[L],x=u[L+1],F=u[L+2],B=C[L=3*d[w]],_=C[L+1],T=C[L+2];A[I]=D,A[I+1]=x,A[I+2]=F,X[I]=B,X[I+1]=_,X[I+2]=T,I+=3,M[w]=w}u=A,C=X,c=M,d=M}var G=this.resources&&this.resources.length?this.resources[n[0]]:null;return this.nTriangles+=s,{meshType:a.ConnectivityTypeEnum.TRIANGLES,nTriangles:s,vertexArray:u,normalsArray:C,uvArray:m.length?m[0]:null,vertexIndexArray:c,normalsIndexArray:d,uvIndexArray:m.length?V:null,uniqueIndexation:!1,colorRGBA:new a.Color(r[0],r[1],r[2],o),material:this._materialManager.getMaterialPhong((new t.Color).setRGB(r[0],r[1],r[2]),o,m.length?G:null)}},ReadIndexedTriangleStripSet:function(e,r,o,n){var s=this.getUnsignedInt(e),l=this.getUnsignedInt(e),p=this.getUnsignedInt(e),u=this.getUnsignedInt(e),c=new Float32Array(3*l);this.ReadTabSglVec3f(e,l,c);var C=this.ReadIndex(e,p,l),d=null,g=null,m=0,V=this.getUnsignedInt(e);if(V!==h){m=this.getUnsignedInt(e);d=new Float32Array(3*m);this.ReadTabSglVec3f(e,m,d),g=this.ReadIndex(e,p,m)}for(var y=this.ReadIndex(e,s,u),f=0,S=0;S<s;S++)f+=y[S]-2;if(V!==h||(m=l,d=i.computeSmoothNormalsStripSet(c,C,y),g=C),this.version>=6.8)this.getUnsignedInt(e);console.warn("[VCXSmgGeomLoader] : Geometry read from smgGeom should use the same indexation buffer for vertices and normals, convert to mono-indexation"),l=3*f;for(var v=i.allocIndexationArray(l,l),b=0;b<l;b++)v[b]=b;for(var P=new Float32Array(3*l),A=new Float32Array(3*l),X=0,M=0,I=0,w=0;w<s;++w){var L=y[w];for(b=0;b<L-2;++b){var D=3*C[M+b],x=3*g[M+b];P[X]=c[D],P[X+1]=c[D+1],P[X+2]=c[D+2],A[X]=d[x],A[X+1]=d[x+1],A[X+2]=d[x+2],X+=3,1&b?(D=3*C[M+b+2],x=3*g[M+b+2],P[X]=c[D],P[X+1]=c[D+1],P[X+2]=c[D+2],A[X]=d[x],A[X+1]=d[x+1],A[X+2]=d[x+2],X+=3,D=3*C[M+b+1],x=3*g[M+b+1],P[X]=c[D],P[X+1]=c[D+1],P[X+2]=c[D+2],A[X]=d[x],A[X+1]=d[x+1],A[X+2]=d[x+2],X+=3):(D=3*C[M+b+1],x=3*g[M+b+1],P[X]=c[D],P[X+1]=c[D+1],P[X+2]=c[D+2],A[X]=d[x],A[X+1]=d[x+1],A[X+2]=d[x+2],X+=3,D=3*C[M+b+2],x=3*g[M+b+2],P[X]=c[D],P[X+1]=c[D+1],P[X+2]=c[D+2],A[X]=d[x],A[X+1]=d[x+1],A[X+2]=d[x+2],X+=3),I++}M+=L}return this.nTriangles+=I,{meshType:a.ConnectivityTypeEnum.TRIANGLES,nTriangles:I,vertexArray:P,normalsArray:A,uvArray:null,vertexIndexArray:v,normalsIndexArray:v,uvIndexArray:null,uniqueIndexation:!0,colorRGBA:new a.Color(r[0],r[1],r[2],o),material:this._materialManager.getMaterialPhong((new t.Color).setRGB(r[0],r[1],r[2]),o,null)}},ReadMonoIndexedTriangleStripSet:function(e,t,r,o){var n=this.getUnsignedInt(e),s=this.getUnsignedInt(e),l=this.getUnsignedInt(e),p=this.getUnsignedInt(e),u=new Float32Array(3*s);this.ReadTabSglVec3f(e,s,u);var c=this.getUnsignedInt(e),C=null;if(c!==h){C=new Float32Array(3*s);this.ReadTabSglVec3f(e,s,C)}for(var d=this.ReadIndex(e,l,s),g=this.ReadIndex(e,n,p),m=0,V=0;V<n;V++)m+=g[V]-2;c===h&&(C=i.computeSmoothNormalsStripSet(u,d,g));var f=[];if(this.version>=6.8){var S=this.getUnsignedInt(e);if(S&&S>=0&&S<=2){for(var v=0;v<S;++v){if(this.getUnsignedInt(e)===y){var b=new Float32Array(2*s);this.ReadTabSglVec2f(e,s,b),f.push(b)}}f.length&&o}}this.resources&&this.resources.length&&this.resources[o[0]];return this.nTriangles+=m,{meshType:a.ConnectivityTypeEnum.TRIANGLE_STRIP,nStrips:n,vertexArray:u,normalsArray:C,uvArray:f.length?f[0]:null,vertexIndexArray:d,normalsIndexArray:d,uvIndexArray:f.length?d:null,uniqueIndexation:!0,lengthsArray:g,colorRGBA:new a.Color(t[0],t[1],t[2],r)}},ReadLineStripSet:function(e,t,r,o){var n=this.getFloat(e),s=this.getUnsignedInt(e),l=this.getUnsignedInt(e),p=this.getUnsignedInt(e),u=new Float32Array(3*l);this.ReadTabSglVec3f(e,l,u);var c=this.ReadIndex(e,s,p),C=0;c&&(C=c.length);for(var d=0,g=0;g<C;++g)d+=c[g];var m=i.allocIndexationArray(d,d);for(g=0;g<d;g++)m[g]=g;return{meshType:a.ConnectivityTypeEnum.LINE_STRIP,nStrips:C,vertexArray:u,normalsArray:null,uvArray:null,lengthsArray:c,vertexIndexArray:m,normalsIndexArray:null,uvIndexArray:null,uniqueIndexation:!0,edgeType:o,colorRGBA:new a.Color(t[0],t[1],t[2],r),thickness:n,material:null}},ReadPointSet:function(e,t,r){this.getFloat(e);var o=this.getUnsignedInt(e),n=new Float32Array(3*o);this.ReadTabSglVec3f(e,o,n);for(var s=i.allocIndexationArray(n.size,n.size),l=0;l<n.size;l++)s[l]=l;return{meshType:a.ConnectivityTypeEnum.POINTS,nStrips:o,vertexArray:n,normalsArray:null,uvArray:null,lengthsArray:null,vertexIndexArray:s,normalsIndexArray:null,uvIndexArray:null,uniqueIndexation:!0,colorRGBA:new a.Color(t[0],t[1],t[2],r),thickness:1,material:null}},ReadGeodeUserData:function(e){var t={strId:"",idLayer:-1,strAssemblyName:"",strIssuedFrom:"",volume:-1,area:-1,ucGeometryType:0,fCofG:[],fInertiaAxes:[]};if(this.version<1.1)return t;var r=2;this.version<6.7&&(r=1);var a=this.getUnsignedInt(e),o=0;if(a>o){var i=this.getString(e);t.strId=i.value,this.version<6.7&&i.byteSize>0?o+=i.byteSize*r+r:o+=t.strId.length*r+r}else t.strId="-1";if(a>o&&(t.idLayer=this.getLong(e),o+=4),a>o){i=this.getString(e);t.strAssemblyName=i.value,this.version<6.7&&i.byteSize>0?o+=i.byteSize*r+r:o+=t.strAssemblyName.length*r+r}if(a>o&&(t.volume=this.getFloat(e),o+=4),a>o&&(t.area=this.getFloat(e),o+=4),a>o&&(t.fCofG=this.getFloatArray(e,3),o+=12),a>o&&(t.fInertiaAxes=this.getFloatArray(e,9),o+=36),a>o&&(t.ucGeometryType=this.getUnsignedChar(e),o+=1),a>o){i=this.getString(e);t.strIssuedFrom=i.value,this.version<6.7&&i.byteSize>0?o+=i.byteSize*r+r:o+=t.strIssuedFrom.length*r+r}var n=1;a>o&&(n=this.getUnsignedInt(e),o+=4);var s=a-o;if(s>0)this.getCharArray(e,s);return{userdata:t,nbLOD:n}},ReadFace:function(e,r,o){this.getString(e).value;this.version>=.8&&this.version<.9?this.getLong(e).ToString():this.getString(e).value;var n=this.getFloatArray(e,3),s=(this.getFloatArray(e,3),this.getFloatArray(e,3),this.getFloat(e),this.getFloat(e)),h=0,y=[],f=[],S=[],v=[],b=[],P=[],A=[];if(this.version>=6.8){var X=0,M=this.getUnsignedInt(e);if(M>X&&(h=this.getUnsignedInt(e),X+=4),h<=2){for(var I=0;I<h;I++){var w;if(M>X)X+=2*(w=this.getString(e).value).length+2;y.push(w.replace(/^.*[\\\/]/,""))}for(I=0;I<h;I++){var L=new t.Matrix4;M>X&&(L=this.ReadMat(e),X+=64),f.push(L)}for(I=0;I<h;I++){var D=l;M>X&&(D=this.getChar(e),X+=1),S.push(D)}for(I=0;I<h;I++){var x=!1;M>X&&(x=this.getChar(e),X+=1),v.push(0!==x)}for(I=0;I<h;I++){var F=c;M>X&&(F=this.getUnsignedInt(e),X+=4);var B=F===p;B=(B=(B=(B=(B=(B=B||F===u)||F===c)||F===C)||F===d)||F===g)||F===m,b.push(B?F:c)}for(I=0;I<h;I++){var _=V;M>X&&(_=this.getChar(e),X+=1),P.push(_)}for(I=0;I<h;I++){var T=!1;M>X&&(T=this.getChar(e),X+=1),A.push(0!==T)}}var G=M-X;if(G>0)this.getCharArray(e,G)}var W=null,N=this.getChar(e);switch(N){case 97:W=this.ReadTriangleSet(e,n,s,y);break;case 98:W=this.ReadIndexedTriangleSet(e,n,s,y);break;case 99:W=this.ReadIndexedTriangleStripSet(e,n,s,y);break;case 100:W=this.ReadMonoIndexedTriangleStripSet(e,n,s,y);break;case 101:W=this.ReadLineStripSet(e,n,s,"WIRE_EDGE");break;case 102:W=this.ReadPointSet(e,n,s);break;default:console.log("smgGeom loading : Unknown geometry type")}if(W.meshType===a.ConnectivityTypeEnum.TRIANGLE_STRIP&&this.alwaysBuildIndexedTrianglesSets)W.normalsIndexArray&&W.normalsIndexArray.length!==W.vertexIndexArray.length&&console.error("Normals : Should be always mono - indexed"),W.uvIndexArray&&W.uvIndexArray.length!==W.vertexIndexArray.length&&console.error("(u, v) : Should be always mono - indexed"),(k=i.buildIndexationFromStripSet(W.meshType,W.nStrips,W.vertexIndexArray,W.lengthsArray,W.vertexArray))&&(W.meshType=a.ConnectivityTypeEnum.TRIANGLES,W.vertexIndexArray=W.vertexIndexArray?k:null,W.normalsIndexArray=W.normalsIndexArray?k:null,W.uvIndexArray=W.uvIndexArray?k:null);else if(W.meshType===a.ConnectivityTypeEnum.LINE_STRIP&&this.alwaysBuildIndexedLinesSets){var k;(k=i.buildIndexationFromStripSet(W.meshType,W.nStrips,W.vertexIndexArray,W.lengthsArray,W.vertexArray))&&(W.meshType=a.ConnectivityTypeEnum.LINES,W.vertexIndexArray=W.vertexIndexArray?k:null)}return W},BuildMeshNode:function(e){var t=null;switch(e.meshType){case a.ConnectivityTypeEnum.TRIANGLES:t=i.buildIndexedTriangleSet(e.nbTriangles,e.vertexArray,e.normalsArray,e.uvArray,e.vertexIndexArray,e.normalsIndexArray,e.uvIndexArray,e.colorRGBA,e.material,e.isSolid);break;case a.ConnectivityTypeEnum.TRIANGLE_STRIP:this.alwaysBuildIndexedTrianglesSets&&console.log("Unexpected TRIANGLE_STRIP type"),t=i.buildMonoIndexedTriangleStripSet(e.nStrips,e.vertexArray,e.normalsArray,e.uvArray,e.vertexIndexArray,e.lengthsArray,e.colorRGBA,e.material,e.isSolid);break;case a.ConnectivityTypeEnum.LINES:t=i.buildIndexedLineSet(e.vertexArray,e.vertexIndexArray,e.colorRGBA,e.thickness,e.edgeType,e.material);break;case a.ConnectivityTypeEnum.LINE_STRIP:this.alwaysBuildIndexedLinesSets&&console.log("Unexpected LINE_STRIP type"),t=i.buildLineStripSet(e.vertexArray,e.lengthsArray,e.vertexIndexArray,e.colorRGBA,e.thickness,e.edgeType,e.material);break;case a.ConnectivityTypeEnum.POINTS:t=i.buildPointSet(e.vertexArray,e.vertexIndexArray,e.material);break;case a.ConnectivityTypeEnum.DUMMY:console.log("smgGeom loading : Mesh with 0 triangles");break;default:console.error("smgGeom loading : Unknown geometry type")}return t},ReadGeode:function(e){var t=new r,a=this.ReadMatrix(e),o=a.hasTransfo,n=a.matrix,s=this.getString(e).value,l=this.ReadGeodeUserData(e),p=l.userdata,u=l.nbLOD;for(var c=[],C=0;C<u;C++){var d=this.getUnsignedInt(e);if(0===C){for(var g=0;g<d;g++)c[g]=-1;d}for(var m=[],V=0;V<d;V++){if(118!==this.getChar(e)){console.log("smgGeom loading : Unknown geometry identifier value");break}if(u>1);else{var h=this.ReadFace(e,0,-1);if(null==h)break;h.isSolid=p&&1===p.ucGeometryType;var y=null;!0===this.mergeGeosets?m[m.length]=h:(y=this.BuildMeshNode(h))?(y.setPickParent(!0),t.add(y)):console.error("smgGeom loading : failed to convert geometry"),h=null}}if(null!==this.outlines){var f=this.outlines.get(p.strId);if(null!=f)if(!0===this.mergeGeosets){if(f.broken)for(var S=0;S<f.broken.length;++S)m.push(f.broken[S]);if(f.construction)for(var v=0;v<f.construction.length;++v)m.push(f.construction[v]);if(f.smart)for(var b=0;b<f.smart.length;++b)m.push(f.smart[b])}else{if(f.broken)for(S=0;S<f.broken.length;++S){(P=this.BuildMeshNode(f.broken[S])).setPickParent(!0),t.add(P)}if(f.construction)for(v=0;v<f.construction.length;++v){(P=this.BuildMeshNode(f.construction[v])).setPickParent(!0),t.add(P)}if(f.smart)for(b=0;b<f.smart.length;++b){var P;(P=this.BuildMeshNode(f.smart[b])).setPickParent(!0),t.add(P)}}}!0===this.mergeGeosets&&(t=i.mergeGeosets(m),m=null)}return o&&!this.ignoreGeodeMatrix&&t&&t.setMatrix(n),{userdata:p,matrix:n,name:s,geode:t}},LoadGeometries:function(e){var t=this.openZStream(e);this.version=this.getDouble(t),this.strFileNameAssociate=this.getString(t).value,this.checksum=this.getLong(t);var r=this.getUnsignedInt(t),a=0;if(!(this.version<1.2)){var o=2;if(this.version<6.7&&(o=1),r>a&&(this.ulOptionsPro=this.getUnsignedLongArray(t,2),a+=8),r>a&&(this.ulWatermark=this.getUnsignedLongArray(t,2),a+=8),r>a&&(this.ulHasExpirationDate=this.getUnsignedLongArray(t,2),a+=8),r>a&&(this.ulStartDate=this.getUnsignedLongArray(t,2),a+=8),r>a&&(this.ulEndDate=this.getUnsignedLongArray(t,2),a+=8),r>a&&(this.ulIsRelativeExpirationDate=this.getUnsignedLongArray(t,2),a+=8),r>a?(this.bHasNormals=this.getChar(t),a+=1):this.bHasNormals=!0,r>a?(this.cCodage=this.getChar(t),a+=1):this.cCodage=100,r>a&&(this.ulHasSignature=this.getUnsignedLong(t),a+=4),r>a){var i=this.getString(t);this.strSignaturePicturePath=i.value,this.version<6.7&&i.byteSize>0?a+=i.byteSize*o:a+=this.strSignaturePicturePath.length*o}if(r>a){i=this.getString(t);this.strAgreement=i.value,this.version<6.7&&i.byteSize>0?a+=i.byteSize*o:a+=this.strAgreement.length*o}r>a&&(this.ulAgreementMode=this.getUnsignedLong(t),a+=4),r>a&&(this.ulSignatureCRC=this.getUnsignedLongArray(t,2),a+=8),r>a?(this.bHasTexture=this.getChar(t),a+=1):this.bHasTexture=!1;var n=r-a;if(n>0)this.getCharArray(t,n);var l=this._experienceBase.getManager("VCXGUIManager").getGUIServices();this.ulHasSignature&&this.ulAgreementMode!==s.LitSignatureMode.LIT_SIGNATURE_NO_DISPLAY?l.displaySignature(this._experienceBase,this,t):this.LoadGeometriesBody(t)}},LoadGeometriesBody:function(e){for(;;){var t=this.getChar(e);if(void 0===t)break;if(117===t){var r=this.ReadGeode(e);this._geoms.set(r.userdata.strId,r)}}},LoadOutlines:function(e,t){var r=this.openZStream(e);this.getUnsignedInt(r),this.getDouble(r);for(this.version=6.8;;){if(71!==this.getChar(r))break;for(var o={broken:[],construction:[],smart:[]},n=this.getWString(r),s=this.getUnsignedInt(r),l=0;l<s;++l){var p=this.getChar(r),u=(this.getChar(r),this.ReadLineStripSet(r,[0,0,0],1,"SHARP_EDGE"));if(u.meshType!==a.ConnectivityTypeEnum.LINE_STRIP&&console.log("Unexpected type"),this.alwaysBuildIndexedLinesSets){var c=i.buildIndexationFromStripSet(u.meshType,u.nStrips,u.vertexIndexArray,u.lengthsArray);c&&(u.meshType=a.ConnectivityTypeEnum.LINES,u.vertexIndexArray=u.vertexIndexArray?c:null)}switch(p){case 66:o.broken.push(u),u.edgeType="SHARP_EDGE";break;case 83:o.construction.push(u),u.edgeType="SMOOTH_EDGE";break;case 70:o.smart.push(u),u.edgeType="BOUNDARY_EDGE"}}t.set(n.value,o)}return t},Load:function(e){var t=i.sharing,r=i.optimized;i.sharing=!0,i.optimized=!0;try{n.memoryLog("Loading smgGeom",!0),this.LoadGeometries(e),n.memoryLog("Loading smgGeom",!1)}catch(e){return e instanceof RangeError?console.error("smgGeom loading : "+e.message):console.error("smgGeom loading error"),!1}return i.sharing=t,i.optimized=r,!0},LoadAsModel:function(e,t,a){var o=this,i=new window.FileReader;i.onloadend=function(){o.setIgnoreGeodeMatrix(!1),o.Load(new Uint8Array(i.result));var e=o.getMapGeodes();t&&e.forEach(function(e,a){var o=e.geode,i=a,n=new r;n.productType="Instance3D",n.name=i,null!==o&&(n.add(o),o.productType="InstanceRep",o.name="rep_"+i),t.add(n)}),a()},i.readAsArrayBuffer(e)}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableOccurrenceComposer",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableOccurrence","DS/VCXWebSystem/VCXEnums"],function(e,t,r,a,o,i,n){"use strict";var s={"Texture.Frame.Gen":{name:"Actor.Texture.Frame.Gen",type:"VCXPropertyValueFrame"},"Texture.Map.Path":{name:"Actor.Texture.Map.Path",type:"VCXPropertyValueDocId"},"Texture.Frame.2D":{name:"Actor.Texture.Frame.2D",type:"VCXPropertyValueFrame"},"Texture.Transparency":{name:"Actor.Texture.Transparency",type:"VCXPropertyValueBoolean"},"Texture.Blending.Mode":{name:"Actor.Texture.Blending.Mode",type:"VCXPropertyValueBoolean"},"Texture.Border.Mode":{name:"Actor.Texture.Border.Mode",type:"VCXPropertyValueBoolean"},"Texture.UV.Scale":{name:"Actor.Texture.UV.Scale",type:"VCXPropertyValueInt"},"Texture.UV.Ratio":{name:"Actor.Texture.UV.Ratio",type:"VCXPropertyValueInt"},"Actor.Env.Effect":{name:"Actor.Env.Effect",type:"VCXPropertyValueEnum"},"Actor.Pulse":{name:"Actor.Pulse.Period",type:"VCXPropertyValueEnum"},"Actor.Pulse.Color":{name:"Pulse.Actor.Color",type:"VCXPropertyValueColor"},"Actor.Prop.Area":{name:"Actor.Prop.Area",type:"VCXPropertyValueFloat"},"Actor.Prop.Volume":{name:"Actor.Prop.Volume",type:"VCXPropertyValueFloat"}};return i.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),s)},getPropertiesMap:function(e,i,l,p,u){var c=this._parent(e,i,l,p,u);if(!e.GetObject().IsMesh())return c;for(var C in l){var d=s[C];if(d){var g=l[C],m=t.fillPropertyValue(g,d.type,i);switch(C){case"Texture.Frame.Gen":if(void 0!==g["@attributes"]&&void 0!==g["@attributes"].ProjectionMode){var V=parseInt(g["@attributes"].ProjectionMode),h=new r;switch(V){case 1:h.SetValue(n.TextureMapping.Planar);break;case 4:default:h.SetValue(n.TextureMapping.None)}c.set("Actor.Texture.Projection.Type",h)}break;case"Texture.Map.Path":var y=-1;if(void 0!==g["@attributes"]&&void 0!==g["@attributes"].Value){var f=g["@attributes"].Value.split("\\").pop().split("/").pop().toLowerCase(),S=p[f];if(void 0!==S){var v=i.getManager("VCXDocManager").BuildPathFromString(S,f);y=i.getManager("VCXDocManager").AddOrModifyDoc(v).Value}}m.SetValue(y);break;case"Actor.Pulse":if((h=new r).SetValue(0),c.set("Actor.Pulse.Type",h),m.GetValue()>0){m.SetValue(m.GetValue()-1),h.SetValue(1);var b=new a;b.SetValue(!0),c.set("Actor.Pulse.PauseAnim",b)}if(!l["Actor.Pulse.Color"]){var P=new o;P.GetValue().SetRGB(0,1,0),c.set("Pulse.Actor.Color",P)}}d.name&&m&&c.set(d.name,m)}}return c}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupPolyline",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressup","DS/VCXWebProperties/VCXPropertyValueString"],function(e,t,r,a){"use strict";var o={"ActorCurve.Line.Color":{name:"Collab.Body.Line.Color",type:"VCXPropertyValueColor"},"ActorCurve.Line.Opacity":{name:"Collab.Body.Line.Color.Opacity",type:"VCXPropertyValueFloat"},"ActorCurve.Line.Type":{name:"Collab.Body.Line.Type",type:"VCXPropertyValueEnum"},"ActorCurve.Close":{name:"Polyline.Is.Closed",type:"VCXPropertyValueBoolean"},"Actor.CurveLine.FrontStipplingMotif":{name:"Collab.Body.Line.StipplingMotif",type:"VCXPropertyValueString"},"ActorCurve.UseHiddenStyle":{name:"Collab.Body.Line.UseHiddenStyle",type:"VCXPropertyValueBoolean"},"ActorCurve.BackLine.Color":{name:"Collab.Body.Line.Back.Color",type:"VCXPropertyValueColor"},"ActorCurve.BackLine.Opacity":{name:"Collab.Body.Line.Back.Color.Opacity",type:"VCXPropertyValueFloat"},"ActorCurve.BackLine.Type":{name:"Collab.Body.Line.Back.Type",type:"VCXPropertyValueEnum"},"ActorCurve.BackLine.Width":{name:"Collab.Body.Line.Back.Width",type:"VCXPropertyValueFloat"},"Actor.CurveLine.BackStipplingMotif":{name:"Collab.Body.Line.Back.StipplingMotif",type:"VCXPropertyValueString"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),o)},getPropertiesMap:function(e,r,a,i,n){var s=this._parent(e,r,a,i,n);for(var l in a){var p=a[l];if("Anchor."===l.substring(0,7)){var u=t.fillPropertyValue(p,"VCXPropertyValueAnchor",r),c="Actor.Anchor."+l.substring(7);s.set(c,u)}else{var C=o[l];if(C){u=t.fillPropertyValue(p,C.type,r);switch(l){case"ActorCurve.Line.Opacity":case"ActorCurve.BackLine.Opacity":u.Value/=255;break;case"ActorCurve.Line.Width":case"ActorCurve.BackLine.Width":u.Value*=2}C.name&&u&&s.set(C.name,u)}}}return s}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableBomManager",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebProperties/VCXPropertyValueMap"],function(e,t,r){"use strict";var a={"BOM.Sort.PropertyName":{name:"BOM.Sort.PropertyName",type:"VCXPropertyValueString"},"BOM.Filter":{name:"BOM.Filter",type:"VCXPropertyValueInt"},"BOM.Sort.Ascendant":{name:"BOM.Sort.Ascendant",type:"VCXPropertyValueBoolean"},"ColumnTreeList.ColumnList":{name:"ColumnTreeList.ColumnList",type:"VCXPropertyValueMap"}};return e.extend({getPropertiesDescription:function(){return UWA.extend({},a)},getPropertiesMap:function(e,o,i,n,s,l){var p=new Map,u=t.getPropertiesDicoFromWebTypeWithInheritance("VCXComponentOccurrenceSMG");for(var c in i){var C=a[c];if(C){var d=i[c],g=t.fillPropertyValue(d,C.type,o);switch(c){case"ColumnTreeList.ColumnList":for(var m=d.ColumnTree,V=0;V<m.length;V++){var h=m[V],y=new r,f=0;for(var S in h)if(h.hasOwnProperty(S)){var v=h[S];switch(S){case"ColumnTree.Name":var b=(A=t.fillPropertyValue(v,"VCXPropertyValueString"))?A.GetValue():null;u&&u[b]&&A.SetValue(u[b].name),y.SetValueAtIndex(f,A),y._value[f++].name=S;break;case"ColumnTree.Width":case"ColumnTree.CommonRoot":var P=t.fillPropertyValue(v,"VCXPropertyValueInt");y.SetValueAtIndex(f,P),y._value[f++].name=S;break;case"ColumnTree.Label":var A=t.fillPropertyValue(v,"VCXPropertyValueString");y.SetValueAtIndex(f,A),y._value[f++].name=S}}g.SetValueAtIndex(V,y)}}C.name&&g&&p.set(C.name,g)}}return p}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableBomInfo",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebProperties/VCXPropertyValueMap"],function(e,t,r){"use strict";var a={GroupInfoPropSet:{name:"GroupInfoPropSet",type:"VCXPropertyValueMap"}};return e.extend({getPropertiesDescription:function(){return UWA.extend({},a)},getPropertiesMap:function(e,o,i,n,s,l){var p=new Map,u=t.getPropertiesDicoFromWebTypeWithInheritance("VCXComponentOccurrenceSMG");for(var c in i){var C=a[c];if(C){var d=i[c],g=t.fillPropertyValue(d,C.type,o);switch(c){case"GroupInfoPropSet":var m=d["GroupInfo.List"];if(!m)break;if(!(m=m.GroupInfo))break;for(var V=0;V<m.length;V++){var h=m[V],y=new r,f=0;for(var S in h)if(h.hasOwnProperty(S)){var v=h[S];switch(S){case"Name":var b=t.fillPropertyValue(v,"VCXPropertyValueString"),P=b?b.GetValue():null;u&&u[P]&&b.SetValue(u[P].name),y.SetValueAtIndex(f,b),y._value[f++].name=S;break;case"Id":var A=t.fillPropertyValue(v,"VCXPropertyValueInt");y.SetValueAtIndex(f,A),y._value[f++].name=S}}g.SetValueAtIndex(V,y)}}C.name&&g&&p.set(C.name,g)}}return p}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableGround",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressup"],function(e,t,r){"use strict";var a={"Ground.LocalLocation":{name:"Actor.Position",type:"VCXPropertyValueLocation"},"Ground.Color":{name:"Environment.Ground.Color",type:"VCXPropertyValueColor"},"Ground.FallOff":{name:"Environment.Ground.FallOff",type:"VCXPropertyValueFloat"},"Ground.Grid.Show":{name:"Environment.Ground.Grid.Show",type:"VCXPropertyValueBoolean"},"Ground.Grid.Color":{name:"Environment.Ground.Grid.Color",type:"VCXPropertyValueColor"},"Ground.Auto.Size":{name:"Environment.Ground.Diameter.Auto",type:"VCXPropertyValueBoolean"},"Ground.Diameter":{name:"Environment.Ground.Diameter",type:"VCXPropertyValueFloat"},"Ground.Border.Show":{name:"Environment.Ground.Border.Show",type:"VCXPropertyValueBoolean"},"Ground.Border.Color":{name:"Environment.Ground.Border.Color",type:"VCXPropertyValueColor"},"Viewport.Render.GroundShadows":{name:"Environment.Ground.Shadows.Show",type:"VCXPropertyValueBoolean"},"Viewport.Render.GroundReflect":{name:"Environment.Ground.Mirror.Show",type:"VCXPropertyValueBoolean"},"Viewport.Render.GroundReflect.Blur":{name:"Environment.Ground.Mirror.Blurry",type:"VCXPropertyValueBoolean"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),a)},getPropertiesMap:function(e,r,o,i,n){var s=this._parent(e,r,o,i,n);for(var l in o){var p=a[l];if(p){var u=o[l],c=t.fillPropertyValue(u,p.type,r);switch(l){case"Ground.FallOff":c.Value*=.01}p.name&&c&&s.set(p.name,c)}}return s}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupPath",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupPolyline","DS/VCXWebProperties/VCXPropertyValueString"],function(e,t,r,a){"use strict";var o={"ActorCurvePath.AxeOrder":{name:"Collab.Path.AxesOrder",type:"VCXPropertyValueEnum"},"ActorCurvePath.Full":{name:"Collab.Path.IsFull",type:"VCXPropertyValueBoolean"},"ActorCurvePath.IsFromNeutral":{name:"Collab.Path.IsFromNeutral",type:"VCXPropertyValueBoolean"},"ActorCurvePath.Mode":{name:"Collab.Path.ConstructMode",type:"VCXPropertyValueEnum"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),o)},getPropertiesMap:function(e,r,a,i){var n=this._parent(e,r,a,i);for(var s in a){var l=a[s];if("Anchor."===s.substring(0,7)){var p=t.fillPropertyValue(l,"VCXPropertyValueAnchor",r),u="Actor.Anchor."+s.substring(7);n.set(u,p)}else{var c=o[s];if(c){p=t.fillPropertyValue(l,c.type,r);s,c.name&&p&&n.set(c.name,p)}}}return n}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupSection",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressup","DS/VCXWebProperties/VCXPropertyValueBoolean"],function(e,t,r,a){"use strict";var o={"CuttingPlane.Enable":{name:"Section.Enable",type:"VCXPropertyValueBoolean"},"CuttingPlane.AutoFlip":{name:"Section.AutoFlip",type:"VCXPropertyValueBoolean"},"CuttingPlane.Capping":{name:"Section.Capping",type:"VCXPropertyValueBoolean"},"CuttingPlane.Capping.Color":{name:"Section.Capping.Color",type:"VCXPropertyValueColor"},"CuttingPlane.Capping.ActorColor":{name:"Section.Capping.ActorColor",type:"VCXPropertyValueBoolean"},"CuttingPlane.Hatch":{name:"Section.Hatching.Frequency",type:"VCXPropertyValueInt"},"CuttingPlane.HatchAngle":{name:"Section.Hatching.Angle",type:"VCXPropertyValueFloat"},"CuttingPlane.SpaceBackAlpha":{name:"Section.SpaceBackAlpha",type:"VCXPropertyValueFloat"},"CuttingPlane.SpaceFrontAlpha":{name:"Section.SpaceFrontAlpha",type:"VCXPropertyValueFloat"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),o)},getPropertiesMap:function(e,r,i,n,s){var l=this._parent(e,r,i,n,s);for(var p in i){var u=o[p];if(u){var c=i[p],C=t.fillPropertyValue(c,u.type,r);switch(p){case"CuttingPlane.SpaceBackAlpha":case"CuttingPlane.SpaceFrontAlpha":C.Value/=255;break;case"CuttingPlane.Enable":l.set("Section.Plane.Enable",new a(C.Value))}u.name&&C&&l.set(u.name,C)}}return l}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableCurveWire",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableOccurrence"],function(e,t,r){"use strict";var a={"ActorCurve.Width":{name:"ActorCurve.Width",type:"VCXPropertyValueInt"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),a)},getPropertiesMap:function(e,r,o,i,n){var s=this._parent(e,r,o,i,n);for(var l in o){var p=a[l];if(p){var u=o[l],c=t.fillPropertyValue(u,p.type,r);l,p.name&&c&&s.set(p.name,c)}}return s}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupArrowLinear",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupArrow","DS/VCXWebProperties/VCXPropertyValueBoolean"],function(e,t,r,a){"use strict";var o={"Anchor.0":{name:"Actor.Anchor.0",type:"VCXPropertyValueAnchor"},"Anchor.1":{name:"Actor.Anchor.1",type:"VCXPropertyValueAnchor"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),o)},getPropertiesMap:function(e,r,i,n,s){var l=this._parent(e,r,i,n,s),p=!1,u=!1;for(var c in i){var C=o[c];if(C){var d=i[c],g=t.fillPropertyValue(d,C.type,r);switch(c){case"Anchor.0":p=!0;break;case"Anchor.1":u=!0}C.name&&g&&l.set(C.name,g)}}if(p&&u){var m=new a;m.SetValue(!1),l.set("Collab.Is.Paper",m)}return l}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupCompass",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgGeomLoader","DS/VCXWebProperties/VCXPropertyValueDocId","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressup"],function(e,t,r,a,o){"use strict";var i={"Navigator.Compass.GeomPath":{name:"Compass.GeomPath",type:"VCXPropertyValueDocId"},"Navigator.Compass.AbsoluteSize":{name:"Compass.AbsoluteSize",type:"VCXPropertyValueBoolean"},"Navigator.Compass.Size":{name:"Compass.Size",type:"VCXPropertyValueFloat"},"Navigator.Compass.SizePixel":{name:"Compass.SizePixel",type:"VCXPropertyValueInt"},"Navigator.Compass.Translation":{name:"Compass.Translation",type:"VCXPropertyValuePoint"},"Navigator.Compass.Frame.Alignment":{name:"Compass.Alignment",type:"VCXPropertyValueFrame"}};return o.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),i)},getPropertiesMap:function(e,a,o,n,s){var l=e.QueryInterface("W3AISGNodeHolder");l&&l._sgNode&&l._sgNode.setGeomConverter(function(e,t){var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="arraybuffer",o.onerror=function(){t&&void 0!==t&&t(new Map)},o.onload=function(e){if(200===this.status){var o=new r(a);o.setIgnoreGeodeMatrix(!1),o.Load(new Uint8Array(this.response)),t&&void 0!==t&&t(o.getMapGeodes())}else t&&void 0!==t&&t(new Map)},o.send()});var p=this._parent(e,a,o,n);for(var u in o){var c=i[u];if(c){var C=o[u],d=t.fillPropertyValue(C,c.type,a);switch(u){case"Navigator.Compass.Visibility":break;case"Navigator.Compass.GeomPath":var g=-1;if(C["@attributes"]&&C["@attributes"].Value){var m=C["@attributes"].Value.split("\\").pop().split("/").pop().toLowerCase(),V=n[m];if(V){var h=a.getManager("VCXDocManager").BuildPathFromString(V,m);g=a.getManager("VCXDocManager").AddOrModifyDoc(h).Value}d.SetValue(g)}}c.name&&d&&p.set(c.name,d)}}return p}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupArrowCorner",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupArrow","DS/VCXWebProperties/VCXPropertyValueBoolean"],function(e,t,r,a){"use strict";var o={"Anchor.0":{name:"Actor.Anchor.0",type:"VCXPropertyValueAnchor"},"Actor.Length2":{name:"Arrow.Corner.Length.1",type:"VCXPropertyValueFloat"},Length:{name:"Arrow.Corner.Length.2",type:"VCXPropertyValueFloat"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),o)},getPropertiesMap:function(e,r,i,n,s){var l=this._parent(e,r,i,n,s),p=!1;for(var u in i){var c=o[u];if(c){var C=i[u],d=t.fillPropertyValue(C,c.type,r);switch(u){case"Anchor.0":p=!0}c.name&&d&&l.set(c.name,d)}}if(!e.bIsOldVersion&&p){var g=new a;g.SetValue(!1),l.set("Collab.Is.Paper",g)}return l}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableMeshPrimitive",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableOccurrenceComposer"],function(e,t,r){"use strict";var a={"Domain1.DomainType":{name:"ActorMeshPrimitive.Domain1.DomainType",type:"VCXPropertyValueEnum"},"Domain1.Height":{name:"ActorMeshPrimitive.Domain1.Height",type:"VCXPropertyValueFloat"},"Cube.Depth":{name:"ActorMeshPrimitive.Cube.Depth",type:"VCXPropertyValueFloat"},"Cube.Width":{name:"ActorMeshPrimitive.Cube.Width",type:"VCXPropertyValueFloat"},"Domain1.OuterRadius":{name:"ActorMeshPrimitive.Domain1.OuterRadius",type:"VCXPropertyValueFloat"},"Domain1.TopRadius":{name:"ActorMeshPrimitive.Domain1.TopRadius",type:"VCXPropertyValueFloat"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),a)},getPropertiesMap:function(e,r,o,i,n){var s=this._parent(e,r,o,i,n);for(var l in o){var p=a[l];if(p){var u=o[l],c=t.fillPropertyValue(u,p.type,r);l,p.name&&c&&s.set(p.name,c)}}return s}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableRedLine",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressup"],function(e,t,r){"use strict";var a={"Anchor.0":{name:"Actor.Anchor.0",type:"VCXPropertyValueAnchor"},"Line.Width":{name:"Collab.Body.Line.Width",type:"VCXPropertyValueFloat"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),a)},getPropertiesMap:function(e,r,o,i,n){var s=this._parent(e,r,o,i,n);for(var l in o){var p=a[l];if(p){var u=o[l],c=t.fillPropertyValue(u,p.type,r);l,p.name&&c&&s.set(p.name,c)}}return s}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupArrowCircular",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupArrow","DS/VCXWebProperties/VCXPropertyValueBoolean"],function(e,t,r,a){"use strict";var o={"Anchor.0":{name:"Actor.Anchor.0",type:"VCXPropertyValueAnchor"},"Actor.Angle":{name:"Arrow.Circular.Angle",type:"VCXPropertyValueFloat"},"Actor.Flat":{name:"Arrow.Circular.Flat",type:"VCXPropertyValueEnum"},"Actor.Radius":{name:"Arrow.Circular.Radius",type:"VCXPropertyValueFloat"},"Actor.Step":{name:"Arrow.Circular.Step",type:"VCXPropertyValueInt"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),o)},getPropertiesMap:function(e,r,i,n,s){var l=this._parent(e,r,i,n,s),p=!1;for(var u in i){var c=o[u];if(c){var C=i[u],d=t.fillPropertyValue(C,c.type,r);switch(u){case"Anchor.0":p=!0}c.name&&d&&l.set(c.name,d)}}if(!e.bIsOldVersion&&p){var g=new a;g.SetValue(!1),l.set("Collab.Is.Paper",g)}return l}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiablePoint",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableOccurrence"],function(e,t,r){"use strict";var a={"ActorPoint.Width":{name:"ActorPoint.Width",type:"VCXPropertyValueInt"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),a)},getPropertiesMap:function(e,r,o,i,n){var s=this._parent(e,r,o,i,n);for(var l in o){var p=a[l];if(p){var u=o[l],c=t.fillPropertyValue(u,p.type,r);l,p.name&&c&&s.set(p.name,c)}}return s}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupCamera",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressup","DS/VCXWebProperties/VCXPropertyValueAnchor"],function(e,t,r,a){"use strict";var o={"Navigator.Camera.Location":{name:null,type:"VCXPropertyValueLocation"},"Anchor.1":{name:"Actor.Anchor.1",type:"VCXPropertyValueAnchor"},"Anchor.2":{name:"Actor.Anchor.2",type:"VCXPropertyValueAnchor"},"Navigator.Camera.Fov":{name:"Camera.Angle",type:"VCXPropertyValueFloat"},"Navigator.Camera.Height":{name:"Camera.Height",type:"VCXPropertyValueFloat"},"Navigator.Camera.Proj.Persp":{name:"Camera.Ortho",type:"VCXPropertyValueBoolean"},"Navigator.Camera.Arcball":{name:"Camera.Arcball",type:"VCXPropertyValueBoolean"},"Navigator.Camera.Interpolator":{name:"Actor.Interpolation.Type",type:"VCXPropertyValueEnum"},"Camera.Pitch":{name:"Camera.Pitch",type:"VCXPropertyValueBoolean"},"Camera.Roll":{name:"Camera.Roll",type:"VCXPropertyValueBoolean"},"Camera.Yaw":{name:"Camera.Yaw",type:"VCXPropertyValueBoolean"},"Camera.LockDistCOI":{name:"Camera.LockDistCOI",type:"VCXPropertyValueBoolean"},"Camera.DistCOI":{name:"Camera.DistCOI",type:"VCXPropertyValueFloat"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),o)},getPropertiesMap:function(e,r,i,n,s){var l=this._parent(e,r,i,n,s);for(var p in i){var u=o[p];if(u){var c=i[p],C=t.fillPropertyValue(c,u.type,r);switch(p){case"Navigator.Camera.Location":var d=new a;d.SetValueFrame(C.GetFrame()),l.set("Actor.Anchor.1",d);var g=new a;g.SetValueFrame(C.GetPivot()),l.set("Actor.Anchor.2",g);break;case"Navigator.Camera.Fov":C.Value=180*C.Value/Math.PI;break;case"Navigator.Camera.Proj.Persp":C.Value=!C.Value}u.name&&C&&l.set(u.name,C)}}return l}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupPanel",["UWA/Class","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebDressup/VCXMarkupModifiable","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressup","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueDocId","DS/VCXWebProperties/VCXPropertyValueFont","DS/VCXWebProperties/VCXColor"],function(e,t,r,a,o,i,n,s,l,p,u,c,C,d){"use strict";var g={"Text.Position":{name:"Collab.3D.Paper.3D.Text.Position",type:"VCXPropertyValuePoint"},"Actor.Location":{name:"Actor.Anchor.Location",type:"vcxPropertyValueAnchor"},"Text.PreString":{name:"Collab.Measurement.PreString",type:"VCXPropertyValueString"},"Text.MiddleString":{name:"Collab.Measurement.MiddleString",type:"VCXPropertyValueString"},"Text.PostString":{name:"Collab.Measurement.PostString",type:"VCXPropertyValueString"},"Actor.PreSymbol":{name:"Collab.Measurement.PreSymbol",type:"VCXPropertyValueEnum"},"Actor.MiddleSymbol":{name:"Collab.Measurement.MiddleSymbol",type:"VCXPropertyValueEnum"},"Actor.PostSymbol":{name:"Collab.Measurement.PostSymbol",type:"VCXPropertyValueEnum"},"Actor.DisplayValue":{name:"Collab.Measurement.DisplayValue",type:"VCXPropertyValueBoolean"},"Text.Foreground.Color":{name:"Collab.Text.Color",type:"VCXPropertyValueColor"},"Text.Bk":{name:"Collab.Body.Shape",type:"VCXPropertyValueEnum"},"VectorImage.Shape":{name:"Collab.Body.Shape",type:"VCXPropertyValueEnum"},"Widget.Shape":{name:"Collab.Body.Shape",type:"VCXPropertyValueEnum"},"VectorImage.BackGround.Enable":{name:"Collab.Background.Show",type:"VCXPropertyValueBoolean"},"Widget.Background":{name:"Collab.3D.Paper.Is.Background",type:"VCXPropertyValueBoolean"},"Text.Bk.Opacity":{name:"Collab.Background.Color.Opacity",type:"VCXPropertyValueFloat"},"VectorImage.BackGround.Opacity":{name:"Collab.Background.Color.Opacity",type:"VCXPropertyValueFloat"},"ActorArrow.Bg.Opacity":{name:"Collab.Background.Color.Opacity",type:"VCXPropertyValueFloat"},"VectorImage.Scale":{name:"Collab.Image.Scale",type:"VCXPropertyValueFloat"},"Actor.Color":{name:"Collab.Background.Color",type:"VCXPropertyValueColor"},"VectorImage.BackGround.Color":{name:"Collab.Background.Color",type:"VCXPropertyValueColor"},"ActorCurve.Border":{name:"Collab.Border.Show",type:"VCXPropertyValueBoolean"},"Text.Label.Line.Show":{name:"Collab.Border.Show",type:"VCXPropertyValueBoolean"},"Text.Label.Line.Opacity":{name:"Collab.Border.Line.Color.Opacity",type:"VCXPropertyValueFloat"},"ActorCurve.Border.Opacity":{name:"Collab.Border.Line.Color.Opacity",type:"VCXPropertyValueFloat"},"Text.Label.Line.Color":{name:"Collab.Border.Line.Color",type:"VCXPropertyValueColor"},"ActorCurve.Border.Color":{name:"Collab.Border.Line.Color",type:"VCXPropertyValueColor"},"Text.LineWidth":{name:"Collab.Border.Line.Width",type:"VCXPropertyValueFloat"},"ActorCurve.Border.Width":{name:"Collab.Border.Line.Width",type:"VCXPropertyValueFloat"},"Text.Attach.Line.Color":{name:"Collab.Attach.Line.Color",type:"VCXPropertyValueColor"},"Text.Attach.Line.Width":{name:"Collab.Attach.Line.Width",type:"VCXPropertyValueFloat"},"Text.Attach.Line.Type":{name:"Collab.Attach.Line.Type",type:"VCXPropertyValueEnum"},"Text.Attach.Line.Curvature":{name:"Collab.Attach.Curvature",type:"VCXPropertyValueFloat"},"Text.String":{name:null,type:"VCXPropertyValueString"},"Text.Alignment":{name:"Collab.Text.HAlignment",type:"VCXPropertyValueEnum"},"Text.LinkedPropertyName":{name:"Collab.Text.LinkedProperty",type:"VCXPropertyValueString"},"Text.LinkedParentLevel":{name:"Collab.Text.LinkedParentLevel",type:"VCXPropertyValueInt"},"Text.Font":{name:"Collab.Text.Font",type:"VCXPropertyValueFont"},"Texture.Map.Path":{name:"Collab.Image.Doc.ID",type:"VCXPropertyValueDocId"},"VectorImage.Filepath":{name:"Collab.Image.Doc.ID",type:"VCXPropertyValueDocId"},"Text.CalloutAlignment":{name:"Collab.3D.Paper.Positioning.Type",type:"VCXPropertyValueEnum"},"Text.DrawAnchor":{name:"Collab.Attach.Preset",type:"VCXPropertyValueEnum"},"Text.Attach.Type":{name:"Collab.Measurement.Attach.Type",type:"VCXPropertyValueFloat"},"Text.ShowEndPoints":{name:"Collab.Measurement.ShowEndPoints",type:"VCXPropertyValueBoolean"},"Text.ShowConstruction":{name:"Collab.Measurement.ShowConstructionLines",type:"VCXPropertyValueBoolean"},"Text.ShowRedline":{name:"Collab.Measurement.ShowRedlines",type:"VCXPropertyValueBoolean"},"Text.ShowPlanes":{name:"Collab.Measurement.ShowPlanes",type:"VCXPropertyValueBoolean"},"Text.Callout2D":{name:null,type:"VCXPropertyValuePoint"},"Widget.Arrow.Origin":{name:"Collab.Attach.Origin",type:"VCXPropertyValuePoint"},"Widget.Top":{name:null,type:"VCXPropertyValueFloat"},"Widget.Left":{name:null,type:"VCXPropertyValueFloat"},"Widget.Depth":{name:"Collab.3D.Paper.Depth",type:"VCXPropertyValueFloat"},"Widget.Width":{name:"Collab.Body.Width",type:"VCXPropertyValueFloat"},"Panel.Width":{name:"Collab.Body.Width",type:"VCXPropertyValueFloat"},"Widget.Height":{name:"Collab.Body.Height",type:"VCXPropertyValueFloat"},"Panel.Height":{name:"Collab.Body.Height",type:"VCXPropertyValueFloat"},"Widget.Autofit":{name:"Collab.Body.FitToText",type:"VCXPropertyValueBoolean"},"ActorComposite.KeepAspectRatio":{name:"Collab.Body.KeepAspectRatio",type:"VCXPropertyValueBoolean"},"Widget.KeepAspectRatio":{name:"Collab.Body.KeepAspectRatio",type:"VCXPropertyValueBoolean"},"Widget.BOM.FilterOnVisibleCallouts":{name:"Collab.BOM.FilterOnVisibleCallouts",type:"VCXPropertyValueBoolean"},"Widget.BOM.TextLabelColor":{name:"Collab.BOM.Header.Text.Color",type:"VCXPropertyValueColor"},"Widget.BOM.TextCellColor":{name:"Collab.Text.Color",type:"VCXPropertyValueColor"},"Widget.BOM.LabelCellColor":{name:"Collab.BOM.Header.Background.Color",type:"VCXPropertyValueColor"},"Widget.BOM.OddCellColor":{name:"Collab.BOM.OddRow.Background.Color",type:"VCXPropertyValueColor"},"Widget.BOM.EvenCellColor":{name:"Collab.BOM.EvenRow.Background.Color",type:"VCXPropertyValueColor"},"Widget.BOM.Position":{name:"Collab.3D.Paper.Positioning.Type",type:"VCXPropertyValueEnum"},"Widget.BOM.Percentage":{name:"Collab.3D.Paper.BOM.Percentage",type:"VCXPropertyValueFloat"},"Widget.ShadowEnable":{name:"Collab.Body.Shadow.Show",type:"VCXPropertyValueBoolean"},"Widget.ShadowDistance":{name:"Collab.Body.Shadow.Distance",type:"VCXPropertyValueFloat"},"Widget.ShadowOrientation":{name:"Collab.Body.Shadow.Orientation",type:"VCXPropertyValueFloat"},"Widget.ShadowOpacity":{name:"Collab.Body.Shadow.Opacity",type:"VCXPropertyValueFloat"},"Widget.ShadowBlur":{name:"Collab.Body.Shadow.Blur",type:"VCXPropertyValueFloat"},"Actor.Radius":{name:"Collab.Measurement.Radius",type:"VCXPropertyValueFloat"},"Actor.Prop.Area":{name:"Collab.Measurement.Area",type:"VCXPropertyValueFloat"},"Actor.Prop.Volume":{name:"Collab.Measurement.Volume",type:"VCXPropertyValueFloat"},Length:{name:"Collab.Measurement.Length",type:"VCXPropertyValueFloat"},"Actor.Length1":{name:"Collab.Measurement.Length1",type:"VCXPropertyValueFloat"},"Actor.Length2":{name:"Collab.Measurement.Length2",type:"VCXPropertyValueFloat"},"Actor.Radius1":{name:"Collab.Measurement.Radius1",type:"VCXPropertyValueFloat"},"Actor.Radius2":{name:"Collab.Measurement.Radius2",type:"VCXPropertyValueFloat"},"Actor.Pulse":{name:"Actor.Pulse.Period",type:"VCXPropertyValueEnum"},"Actor.Pulse.Color":{name:"Pulse.Collab.Image.Color",type:"VCXPropertyValueColor"},"Widget.Freeze":{name:"Actor.Freeze",type:"VCXPropertyValueEnum"},Billboard:{name:"Collab.3D.Paper.Billboard.Type",type:"VCXPropertyValueEnum"},"Text.Autohide":{name:"Collab.HideIfOutsideAnchorFrustrum",type:"VCXPropertyValueBoolean"},"Text.Border.Color":{name:"Collab.Border.Line.Color",type:"VCXPropertyValueColor"},"Text.Border.Opacity":{name:"Collab.Border.Line.Color.Opacity",type:"VCXPropertyValueFloat"},"Text.Border.Width":{name:"Collab.Border.Line.Width",type:"VCXPropertyValueFloat"}};return o.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),g)},getPropertiesMap:function(e,o,C,m,V){var h=this._parent(e,o,C,m,V),y=null,f=null,S=null,v=null,b=!1,P=null,A=null,X=null;for(var M in C){var I,w=C[M];if("Anchor."===M.substring(0,7)){if(I=a.fillPropertyValue(w,"VCXPropertyValueAnchor",o),parseInt(M.substring(7))<1e3){var L="Actor.Anchor."+M.substring(7);h.set(L,I)}else if(("CLitTextMultiplePoints"===V||"CLitCalloutMP"===V)&&parseInt(M.substring(7))>1002){L="Actor.Anchor."+M.substring(7);h.set(L,I)}}else if("CLitDrawText"===V&&"Draw.Location"===M)w.Frame=void 0,w.Pivot=void 0,I=a.fillPropertyValue(w,"VCXPropertyValueAnchor",o),h.set("Actor.Anchor.0",I);else{var D=g[M];if(D){switch(I=a.fillPropertyValue(w,D.type,o),M){case"Widget.BOM.Position":switch(I.GetValue()){case 0:I.SetValue(1e3);break;case 1:I.SetValue(3);break;case 2:I.SetValue(7);break;case 3:I.SetValue(10);break;case 4:I.SetValue(12)}break;case"Actor.Location":var x=a.fillPropertyValue(w,"VCXPropertyValueLocation",o);(I=new l).SetValueFrame(x.GetFrame());break;case"Text.Bk":switch(I.GetValue()){case 0:I.SetValue(0);break;case 1:I.SetValue(10);break;case 2:I.SetValue(20);break;case 3:I.SetValue(3);break;case 4:I.SetValue(4);break;case 5:I.SetValue(5);break;case 6:I.SetValue(1)}break;case"VectorImage.Shape":switch(I.GetValue()){case 0:case 1:I.SetValue(1);break;case 2:case 3:I.SetValue(3)}break;case"Widget.Shape":switch(I.GetValue()){case 0:I.SetValue(1);break;case 1:I.SetValue(6);break;case 2:I.SetValue(7);break;case 3:I.SetValue(4);break;case 4:I.SetValue(5)}break;case"Billboard":switch(I.GetValue()){case 0:I.SetValue(0);break;case 1:case 2:I.SetValue(2);break;case 3:I.SetValue(0)}break;case"Text.Bk.Opacity":case"VectorImage.BackGround.Opacity":case"ActorArrow.Bg.Opacity":I.Value/=255;break;case"VectorImage.Scale":I.Value*=.01;break;case"Actor.Color":"CLitDrawText"===V?h.set("Collab.Text.Color",I):h.set("Collab.Image.Color",I);break;case"VectorImage.BackGround.Color":h.set("Collab.Image.Color",new u((new d).SetRGBA(1,1,1,1)));break;case"Text.Label.Line.Opacity":case"ActorCurve.Border.Opacity":case"Text.Border.Opacity":I.Value/=255;break;case"Text.Border.Width":I.Value*=2;break;case"Text.LineWidth":case"ActorCurve.Border.Width":case"Text.Attach.Line.Width":I.Value*=2;break;case"Text.String":P=I.Value,e._textString=P;break;case"Text.Alignment":h.set("Collab.Text.HAlignment",I);break;case"Text.LinkedPropertyName":"Text String"===(A=I.Value)&&(P=e._textString,X=0,e._textString=null);break;case"Text.LinkedParentLevel":X=I.Value;break;case"Texture.Map.Path":case"VectorImage.Filepath":var F=a.fillPropertyValue(w,"VCXPropertyValueString",o),B=F.Value.slice(F.Value.lastIndexOf("\\")+1).toLowerCase();if(B){var _=m[B];if(!_)_=m[B.replace(/^.*[\\\/]/,"")];var T=o.getManager("VCXDocManager").BuildPathFromString(_,B);T&&(I=o.getManager("VCXDocManager").AddOrModifyDoc(T))}I||(I=new c);break;case"Text.Autohide":h.set("Collab.HideIfOutsideAnchorFrustrum",I);break;case"Text.Position":"CLitText2dPaperSpace"===V&&(f=parseFloat(w["@attributes"].X),y=parseFloat(w["@attributes"].Y)),b=!0;break;case"Text.Callout2D":v=parseFloat(w["@attributes"].X),S=parseFloat(w["@attributes"].Y);break;case"Widget.Arrow.Origin":h.set("Collab.Attach.CenteredOrigin",new n(!1));break;case"Widget.Top":y=I.Value;break;case"Widget.Left":f=I.Value;break;case"Widget.ShadowOpacity":I.Value/=255;break;case"Text.DrawAnchor":if(I.Value){var G=I.Value;9===G&&(G=30),h.set("Collab.Attach.Show",new n(!0));var W,N=r.GetAttachPresets(G);(W=new i).SetValue(N["Collab.Attach.LeadType"]),h.set("Collab.Attach.LeadType",W),(W=new i).SetValue(N["Collab.Attach.ExtremityType"]),h.set("Collab.Attach.ExtremityType",W),(W=new s).SetValue(N["Collab.Attach.Curvature"]),h.set("Collab.Attach.Curvature",W),(W=new n).SetValue(N["Collab.Attach.Background.Gradient"]),h.set("Collab.Attach.Background.Gradient",W),(W=new n).SetValue(N["Collab.Attach.Border.Gradient"]),h.set("Collab.Attach.Border.Gradient",W),(W=new n).SetValue(N["Collab.Attach.BentDot"]),h.set("Collab.Attach.BentDot",W)}else h.set("Collab.Attach.Show",new n(!0)),h.set("Collab.Attach.LeadType",new i(I.Value));break;case"Actor.Pulse":var k=new i;if(k.SetValue(0),I.GetValue()>0){I.SetValue(I.GetValue()-1),k.SetValue(1);var O=new n;O.SetValue(!0),h.set("Actor.Pulse.PauseAnim",O)}h.set("Actor.Pulse.Type",k);break;case"Actor.Pulse.Color":h.get("Actor.Pulse.Type")?h.set("Pulse.Collab.Background.Color",I):I=null;break;case"ActorCurve.Border":h.set("Collab.Border.Show",1);break;case"Text.Label.Line.Show":"CLit2dWidgetImagePaperSpaceFromCropArea"===V&&(I.Value=!1);break;case"Text.CalloutAlignment":var R=I.Value;for(var E in I.Value=t.EPositionType.Free3D,t.EPositionType)t.EPositionType[E]===R&&(I.Value=R)}D.name&&I&&h.set(D.name,I)}}}var U=a.translateLinkedPropertyString(o,e,A,X,P,h);if(U){var H=new p;H.Value=U,h.set("Collab.Text",H);var z=new n;z.Value=!0,h.set("Collab.Text.Show",z);var Q=new s;Q.SetValue(1),h.set("Collab.Body.InnerMargin",Q)}var K=!1;if(S&&(y=S*o.getManager("VCXPaperManager").Size.y,K=!0),v&&(f=v*o.getManager("VCXPaperManager").Size.x,K=!0),null!==f||null!==y){if(null!==f){var Y=new s;Y.SetValue(f),h.set("Collab.3D.Paper.Paper.Position.X",Y)}if(null!==y){var j=new s;j.SetValue(y),h.set("Collab.3D.Paper.Paper.Position.Y",j)}var Z=new i,q=new i;"CLitTextMultiplePoints"!==V&&"CLitText2dPaperSpace"!==V||null==P||(1===P.trim().split(" ").length&&-1===P.indexOf("\n")?q.SetValue(1):q.SetValue(0),h.set("Collab.Text.HAlignment",q)),b?Z.SetValue(2):K?Z.SetValue(2):Z.SetValue(0),h.set("Collab.Body.VAlignment",Z)}return h}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableViewport",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools"],function(e,t){"use strict";var r={"Viewport.CameraToSeeInterface":{name:"Viewport.ActiveCamera",type:"VCXPropertyValueInt"},"Navigator.Camera.Vertical":{name:"Environment.Vertical",type:"VCXPropertyValueEnum"},"Viewport.Render.BackCulling":{name:"Environment.BackFaceCulling",type:"VCXPropertyValueBoolean"},"Viewport.Render.SSAO":{name:"Environment.SSAO",type:"VCXPropertyValueEnum"},"Viewport.Render.HLGlow":{name:"Environment.Bloom",type:"VCXPropertyValueBoolean"},"Viewport.Render.Mode":{name:"Render.Mode",type:"VCXPropertyValueEnum"},"Viewport.Render.ShowSharedEdges":{name:"Render.OutlineType",type:"VCXPropertyValueEnum"},"Viewport.Bk.Color":{name:"Environment.Background.Color",type:"VCXPropertyValueColor"},"Viewport.Bk.Alpha":{name:"Environment.Background.Color.Opacity",type:"VCXPropertyValueFloat"},"Viewport.BkFoot.Color":{name:"Environment.Background.Foot.Color",type:"VCXPropertyValueColor"},"Viewport.BkGradient":{name:"Environment.Background.Gradient",type:"VCXPropertyValueBoolean"},"Viewport.Bk.Image.Path":{name:"Environment.Background.Image",type:"VCXPropertyValueDocId"},"Viewport.Lights.Diffuse":{name:"Render.Lighting.Intensity",type:"VCXPropertyValueFloat"},"Viewport.Render.Lighting.Mode":{name:"Render.Lighting.Mode",type:"VCXPropertyValueEnum"}};return e.extend({getPropertiesDescription:function(){return UWA.extend({},r)},getPropertiesMap:function(e,a,o,i,n){var s=new Map,l=a.getManager("VCXContextManager").getExperienceIn3DPlay();for(var p in o){var u=r[p];if(u){var c=o[p],C=t.fillPropertyValue(c,u.type,a);switch(p){case"Viewport.Render.SSAO":C.Value?C.Value=2:C.Value=1;break;case"Viewport.Bk.Alpha":case"Viewport.Lights.Diffuse":C.Value/=255;break;case"Viewport.Bk.Image.Path":var d=t.fillPropertyValue(c,"VCXPropertyValueString",a),g=d.Value.slice(d.Value.lastIndexOf("\\")+1).toLowerCase();if(g){var m=i[g],V=a.getManager("VCXDocManager").BuildPathFromString(m,g);V&&(C=a.getManager("VCXDocManager").AddOrModifyDoc(V))}}if(u.name&&C){if(!l&&"Viewport.Lights.Diffuse"===p)continue;s.set(u.name,C)}}}return s}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupCircle",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressup"],function(e,t,r){"use strict";var a={"Anchor.0":{name:"Actor.Anchor.0",type:"VCXPropertyValueAnchor"},"Actor.Color":{name:"Collab.Background.Color",type:"VCXPropertyValueColor"},"Actor.Circle.Background":{name:"Circle.Background.Type",type:"VCXPropertyValueEnum"},"ActorCurve.Line.Color":{name:"Collab.Body.Line.Color",type:"VCXPropertyValueColor"},"ActorCurve.Line.Opacity":{name:"Collab.Body.Line.Color.Opacity",type:"VCXPropertyValueFloat"},"ActorCurve.Line.Type":{name:"Collab.Body.Line.Type",type:"VCXPropertyValueEnum"},"ActorCurve.Line.Width":{name:"Collab.Body.Line.Width",type:"VCXPropertyValueFloat"},"ActorCurve.Border":{name:"Collab.Border.Show",type:"VCXPropertyValueBoolean"},"ActorCurve.Border.Color":{name:"Collab.Border.Line.Color",type:"VCXPropertyValueColor"},"ActorCurve.Border.Opacity":{name:"Collab.Border.Line.Color.Opacity",type:"VCXPropertyValueFloat"},"ActorCurve.Border.Type":{name:"Collab.Border.Line.Type",type:"VCXPropertyValueEnum"},"ActorCurve.Border.Width":{name:"Collab.Border.Line.Width",type:"VCXPropertyValueFloat"},"Actor.Radius":{name:"Circle.Radius",type:"VCXPropertyValueFloat"},"Actor.Thickness":{name:"Circle.Thickness",type:"VCXPropertyValueFloat"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),a)},getPropertiesMap:function(e,r,o,i,n){var s=this._parent(e,r,o,i,n);for(var l in o){var p=a[l];if(p){var u=o[l],c=t.fillPropertyValue(u,p.type,r);switch(l){case"ActorCurve.Line.Opacity":case"ActorCurve.Border.Opacity":c.Value/=255}p.name&&c&&s.set(p.name,c)}}return s}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiablePmi",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableOccurrence"],function(e,t,r){"use strict";var a={"ActorCompositePmi.MirroringRepresentation":{name:"ActorCompositePmi.MirroringRepresentation",type:"VCXPropertyValueEnum"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),a)},getPropertiesMap:function(e,r,o,i,n){var s=this._parent(e,r,o,i,n);for(var l in o){var p=a[l];if(p){var u=o[l],c=t.fillPropertyValue(u,p.type,r);l,p.name&&c&&s.set(p.name,c)}}return s}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupDigger",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebProperties/VCXPropertyValueFrame"],function(e,t,r){"use strict";var a={"Inspector.Enabled":{name:"Actor.Opacity",type:"VCXPropertyValueFloat"},"Digger.Radius":{name:"Digger.Radius",type:"VCXPropertyValueFloat"},"Digger.Position":{name:"Digger.Position",type:"VCXPropertyValuePoint2D"},"Digger.Renderer":{name:"Digger.Mode",type:"VCXPropertyValueEnum"},"Digger.COIOn":{name:"Digger.Attach",type:"VCXPropertyValueBoolean"},"Digger.COIPos":{name:"Actor.Anchor.0",type:"VCXPropertyValueAnchor"},"Digger.Depth":{name:null,type:"VCXPropertyValueFloat"}};return e.extend({getPropertiesDescription:function(){return UWA.extend({},a)},getPropertiesMap:function(e,o,i,n,s){var l=new Map;for(var p in i){var u=a[p];if(u){var c=i[p],C=t.fillPropertyValue(c,u.type,o);switch(p){case"Digger.Renderer":switch(C.GetValue()){case 0:C.Value=1;break;case 1:C.Value=2;break;case 2:case 3:C.Value=0}break;case"Digger.COIPos":var d=t.fillPropertyValue(c,"VCXPropertyValueVector",o);C.SetValueFrame((new r).SetValueFromVector(d.GetValue()));break;case"Digger.Depth":"DigZoom"===e.loadParentMode?l.set("Digger.ZoomFactor",C):l.set("Digger.DepthFactor",C)}u.name&&C&&l.set(u.name,C)}}return l}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableHotSpot",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiable"],function(e,t,r){"use strict";var a={"HotSpot.Show":{name:"Actor.Enable",type:"VCXPropertyValueBoolean"},"HotSpot.Color":{name:"Actor.Color",type:"VCXPropertyValueColor"},"HotSpot.Tooltip":{name:"Actor.ToolTip",type:"VCXPropertyValueString"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),a)},getPropertiesMap:function(e,r,o,i,n){var s=this._parent(e,r,o,i,n);for(var l in o){var p=a[l];if(p){var u=o[l],c=t.fillPropertyValue(u,p.type,r);l,p.name&&c&&s.set(p.name,c)}}return s}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderModifiableFactory",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiable","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableViewport","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableGround","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableOccurrenceComposer","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableMeshPrimitive","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiablePmi","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableCurveWire","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiablePoint","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableRedLine","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupCamera","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupPath","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupArrowLinear","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupArrowCircular","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupArrowCorner","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupCircle","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupPolyline","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableBomManager","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableBomInfo","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupPanel","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupDigger","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableHotSpot","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupCompass","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupSection","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueBoolean"],function(e,t,r,a,o,i,n,s,l,p,u,c,C,d,g,m,V,h,y,f,S,v,b,P,A,X,M){"use strict";var I={CLitViewport:{classname:"VCXViewport_Spec",classFcntName:a,additionalProperties:{"Environment.Background.Override":new M(!0),"Render.Lighting.Override":new M(!0),"Render.ShowConstructions":new M(!0)}},CLitActorGround:{classname:"VCXComponentGround",classFcntName:o},CLitVectorImageBOM:{classname:"VCXBOM_Spec",classFcntName:S},CLitKBOMManager:{classname:"VCXComponentBomManager",classFcntName:y},CLitBOMInfo:{classname:"VCXBOMInfoComponent",classFcntName:f},CLitActor:{classname:"VCXComponentOccurrenceSMG",classFcntName:r},CLitAssyGroup:{classname:"VCXComponentOccurrenceSMG",classFcntName:i},CLitActorMesh:{classname:"VCXComponentOccurrenceSMG",classFcntName:i},CLitActorPoint:{classname:"VCXComponentPoint",classFcntName:p},CLitActorCurveWire:{classname:"VCXComponentCurveWire",classFcntName:l},CLitActorCompositePmi:{classname:"VCXComponentCompositePmi",classFcntName:s},CLitCameraActor:{classname:"CXPCameraActor_Spec",classFcntName:c},CLitRedline:{classname:"VCXRedLine_Spec",classFcntName:u},CLitActorCurvePolyline:{classname:"VCXPolyline_Spec",classFcntName:h},CLitQuotationArc:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new X(110),"Collab.Lead.AlwaysVisible":new M(!0)}},CLitQuotationAngle:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new X(120),"Collab.Lead.AlwaysVisible":new M(!0)}},CLitQuotationLinear:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new X(130),"Collab.Lead.AlwaysVisible":new M(!0)}},CLitQuotationDiameter:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new X(140),"Collab.Lead.AlwaysVisible":new M(!0)}},CLitQuotationBetweenAxis:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new X(160),"Collab.Lead.AlwaysVisible":new M(!0)}},CLitQuotationBetweenCentres:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new X(170),"Collab.Lead.AlwaysVisible":new M(!0)}},CLitQuotationBetweenPlanes:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new X(180),"Collab.Lead.AlwaysVisible":new M(!0)}},CLitQuotationPlanePoint:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new X(190),"Collab.Lead.AlwaysVisible":new M(!0)}},CLitQuotationBetweenPoints:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new X(200),"Collab.Lead.AlwaysVisible":new M(!0)}},CLitQuotationBetweenObjects:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new X(210),"Collab.Lead.AlwaysVisible":new M(!0)}},CLitQuotationArea:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new X(220),"Collab.Lead.AlwaysVisible":new M(!0)}},CLitQuotationVolume:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new X(230),"Collab.Lead.AlwaysVisible":new M(!0)}},CLitQuotationAreaMultiplePoints:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new X(250),"Collab.Lead.AlwaysVisible":new M(!0)}},CLitQuotationVolumeMultiplePoints:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new X(260),"Collab.Lead.AlwaysVisible":new M(!0)}},CLitQuotationBetweenLines:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new X(280),"Collab.Lead.AlwaysVisible":new M(!0)}},CLitQuotationLinePoint:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new X(290),"Collab.Lead.AlwaysVisible":new M(!0)}},CLitQuotationRadius:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new X(300),"Collab.Lead.AlwaysVisible":new M(!0)}},CLitQuotationCoord:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new X(310),"Collab.Lead.AlwaysVisible":new M(!0)}},CLitRLCircle:{classname:"VCXCircle_Spec",classFcntName:V,additionalProperties:{"Collab.Is.Paper":new M(!1),"Collab.Border.AlwaysVisible":new M(!0)}},CLitRLArrow:{classname:void 0,classFcntName:void 0},CLitRLArrowLinear:{classname:"VCXLinearArrow_Spec",classFcntName:d,additionalProperties:{"Collab.Is.Paper":new M(!1),"Collab.Border.AlwaysVisible":new M(!0)}},CLitRLArrowCircular:{classname:"VCXCircularArrow_Spec",classFcntName:g,additionalProperties:{"Collab.Is.Paper":new M(!1),"Collab.Border.AlwaysVisible":new M(!0)}},CLitRLArrowCorner:{classname:"VCXCornerArrow_Spec",classFcntName:m,additionalProperties:{"Collab.Is.Paper":new M(!1),"Collab.Border.AlwaysVisible":new M(!0)}},CLit2dWidgetImage:{classname:"VCXPanel_Spec",classFcntName:S,additionalProperties:{"Collab.Attach.3DAttach":new M(!1)}},CLit2dWidgetImagePaperSpace:{classname:"VCXPanel_Spec",classFcntName:S,additionalProperties:{"Collab.Attach.3DAttach":new M(!1),"Collab.Lead.AlwaysVisible":new M(!0)}},CLit2dWidgetImageFromDigger:{classname:"VCXDiggerPanel_Spec",classFcntName:S,additionalProperties:{"Collab.Attach.3DAttach":new M(!1)}},CLit2dWidgetImagePaperSpaceFromDigger:{classname:"VCXDiggerPanel_Spec",classFcntName:S,additionalProperties:{"Collab.Attach.3DAttach":new M(!1),"Collab.Lead.AlwaysVisible":new M(!0)}},CLit2dWidgetImagePaperSpaceFromCropArea:{classname:"VCXPanel_Spec",classFcntName:S,additionalProperties:{"Collab.Attach.3DAttach":new M(!1),"Collab.Lead.AlwaysVisible":new M(!0)}},CLit2dWidgetArea:{classname:"VCXPanel_Spec",classFcntName:S,additionalProperties:{"Collab.Attach.3DAttach":new M(!1)}},CLit2dWidgetText:{classname:"VCXPanel_Spec",classFcntName:S,additionalProperties:{"Collab.Background.Show":new M(!0),"Collab.Text.Availability":new X(1),"Collab.Attach.3DAttach":new M(!1)}},CLit2dWidgetTextPaperSpace:{classname:"VCXPanel_Spec",classFcntName:S,additionalProperties:{"Collab.Background.Show":new M(!0),"Collab.Text.Availability":new X(1),"Collab.Attach.3DAttach":new M(!1),"Collab.Text.VAlignment":new X(1),"Collab.Text.Wordwrap":new M(!1),"Collab.Lead.AlwaysVisible":new M(!0)}},CLitVectorImage:{classname:"VCXPanel_Spec",classFcntName:S,additionalProperties:{"Collab.Attach.3DAttach":new M(!1),"Collab.Lead.AlwaysVisible":new M(!0)}},CLitVectorImageFromDetailView:{classname:"VCXPanel_Spec",classFcntName:S,additionalProperties:{"Collab.Attach.3DAttach":new M(!1),"Collab.Lead.AlwaysVisible":new M(!0)}},CLitVectorImage3D:{classname:"VCXPanel_Spec",classFcntName:S,additionalProperties:{"Collab.3D.Paper.Positioning.Type":new X(1001),"Collab.3D.Paper.Billboard.Type":new X(0),"Collab.3D.Paper.Size.Control.Type":new X(0),"Actor.IsAlwaysOnTop":new M(!1)}},CLitPanel:{classname:"VCXPanel_Spec",classFcntName:S,additionalProperties:{"Collab.3D.Paper.Positioning.Type":new X(1001),"Collab.3D.Paper.Billboard.Type":new X(0),"Collab.3D.Paper.Size.Control.Type":new X(0),"Actor.IsAlwaysOnTop":new M(!1)}},CLitText2d:{classname:"VCXLabel_Spec",classFcntName:S,additionalProperties:{"Collab.Body.HAlignment":new X(0),"Collab.Body.VAlignment":new X(0),"Collab.Text.Availability":new X(1),"Collab.Text.HAlignment":new X(0),"Collab.Lead.AlwaysVisible":new M(!0)}},CLitText2dPaperSpace:{classname:"VCXPanel_Spec",classFcntName:S,additionalProperties:{"Collab.Body.HAlignment":new X(0),"Collab.Body.VAlignment":new X(0),"Collab.Background.Show":new M(!0),"Collab.Text.Availability":new X(1),"Collab.3D.Paper.Positioning.Type":new X(101),"Collab.UseDepthFromAnchor":new M(!0),"Collab.Text.Wordwrap":new M(!1),"Collab.Text.HAlignment":new X(1),"Collab.Text.VAlignment":new X(1),"Collab.Lead.AlwaysVisible":new M(!0)}},CLitTextMultiplePoints:{classname:"VCXLabel_Spec",classFcntName:S,additionalProperties:{"Collab.Body.HAlignment":new X(0),"Collab.Body.VAlignment":new X(1),"Collab.3D.Paper.UsesBarycenter":new M(!1),"Collab.Lead.AlwaysVisible":new M(!0),"Collab.HideIfOutsideAnchorFrustrum":new M(!1)}},CLitDrawText:{classname:"VCXLabel_Spec",classFcntName:S,additionalProperties:{"Collab.Is.Paper":new M(!1),"Collab.3D.Paper.Positioning.Type":new X(1001),"Collab.3D.Paper.Size.Control.Type":new X(0),"Collab.Markup.SubType":new X(2),"Collab.Body.HAlignment":new X(0),"Collab.Body.VAlignment":new X(2),"Collab.3D.Paper.UsesBarycenter":new M(!1),"Collab.Text.HAlignment":new X(1),"Collab.3D.Paper.Billboard.Type":new X(0),"Collab.Attach.Show":new M(!1),"Collab.Attach.Preset":new X(0)}},CLitCalloutMP:{classname:"VCXCallout_Spec",classFcntName:S,additionalProperties:{"Collab.Lead.AlwaysVisible":new M(!0),"Collab.HideIfOutsideAnchorFrustrum":new M(!1)}},CLitCallout:{classname:"VCXCallout_Spec",classFcntName:S,additionalProperties:{"Collab.Lead.AlwaysVisible":new M(!0),"Collab.HideIfOutsideAnchorFrustrum":new M(!1)}},CLitActorComposite:{classname:void 0,classFcntName:void 0},CLitActorCompositeIntersect:{classname:void 0,classFcntName:void 0},CLitCS:{classname:void 0,classFcntName:void 0},CLitGrid:{classname:void 0,classFcntName:void 0},CLitLight:{classname:void 0,classFcntName:void 0},CLitActorBBox:{classname:void 0,classFcntName:void 0},CLitActorPrim:{classname:"VCXComponentMeshPrimitive",classFcntName:n},CLitActorCompass:{classname:"VCXCompass_Spec",classFcntName:P},CLitActorAxis:{classname:void 0,classFcntName:void 0},CLitDigger:{classname:"VCXDigger_Spec",classFcntName:v},CLitActorMagnetLine:{classname:void 0,classFcntName:void 0},CLitSelectionHotSpot:{classname:"VCXComponentHotspot",classFcntName:b},CLitTargetObject:{classname:void 0,classFcntName:void 0},CLitCuttingPlane:{classname:"VCXSection_Spec",classFcntName:A,additionalProperties:{"Section.ComposerSMG":new M(!0)}},CLitActorCurvePolylinePath:{classname:"VCXComponentPath",classFcntName:C},CLitActorCurvePolylinePathAssociative:{classname:"VCXComponentAssociativePath",classFcntName:C}};return e.extend({init:function(){this._Converters={},this._mapComponentConverter=new Map,t.mapConverters&&console.warn("Converters map should be undefined"),t._factory=this},clear:function(){this._Converters=null,this._mapComponentConverter=null,delete t._factory},getV1Ids:function(){return I},createPropertiesMap:function(e,t,r,a,o){if(e){var i=this._mapComponentConverter.get(e.GetObject());if(!i)for(var n in I)I[n].classname===e.GetObject().GetType()&&(i=new I[n].classFcntName,this._Converters[I[n].classname]=i,this._mapComponentConverter.set(e.GetObject(),i));if(i)return i.getPropertiesMap(e,t,r,a,o);console.warn("Can't find properties set converter")}return console.warn("Can't create properties set"),new Map},create:function(e,t,r,a,o){var i=I[t];if(!i||!i.classname)return null;var n=e.Factory.BuildComponent(i.classname);if(!n)return console.warn("Unable to build component "+i.classname),null;"CLitActorMesh"===t&&n.SetIsMesh(!0);var s=n.QueryInterface("VCXIModifiable");for(var l in i.additionalProperties)i.additionalProperties.hasOwnProperty(l)&&s.OnChangeProperty(l,i.additionalProperties[l]);if(r&&(n.SetID(r),n.IsDressup?e.getManager("VCXDressupManager").AddDressups([n]):n.QueryInterface("W3AISGNodeHolder")&&a&&n.QueryInterface("W3AISGNodeHolder").setPathElement(a),e.ComponentsMap.AddComponent(n)),o&&void 0!==o&&!n.IsDressup){var p=n.QueryInterface("VCXIModelNavigable"),u=o.QueryInterface("VCXIModelNavigable");p&&u&&p.setParent(u)}var c=this._Converters[i.classname];return c||(c=new i.classFcntName,this._Converters[i.classname]=c),this._mapComponentConverter.set(n,c),n}})}),define("DS/VCXWebInteropSMG/VCXSmgXmlLoader",["UWA/Class","DS/CoreEvents/Events","DS/Visualization/PathElement","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Mesh/MeshUtils","DS/VCXKeyFramer/VCXScenario","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueLink","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueMap","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueBin","DS/VCXWebModifiables/VCXMetaPropertyDef","DS/VCXWebInteropSMG/VCXSmgLoaderModifiableFactory","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableBomManager","DS/VCXWebKernelCommands/VCXCmdChangeSequence","DS/VCXWebKernelCommands/VCXCmdChangeScenarioSequence","DS/VCXWebKernelCommands/VCXCmdChangeKeys","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdGoToScenario","DS/VCXWebKernel/VCXCmdChangeMarker","DS/VCXWebSystem/VCXMeshServices","DS/VCXWebUnits/VCXUnitType","DS/VCXWebIO/VCXLogServices","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgXmlDataStorage","i18n!DS/VCXWebInteropSMG/assets/nls/VCXWebInteropSMG","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables","DS/VCXWebSystem/VCXMathTools"],function(e,t,r,a,o,n,s,l,p,u,c,C,d,g,m,V,h,y,f,S,v,b,P,A,X,M,I,w,L,D,x,F,B,_,T,G,W){"use strict";var N=e.extend({init:function(){this._vcxViewport=null,this._vcxCompass=null,this._vcxBom=null,this._vcxBomInfo=null,this._vcxDigger=null,this._vcxScenarioAnimationSmg=null,this._mapGeodes=null,this._mapSequences={},this._resources=null,this._experienceBase=null,this._allPMIs=[],this._allPmisConstructionGeometries=[],this._modifiableFactory=new v,this._materialManager=null,this._documentProperties={},this._v1ComponentType={},this._smgViewFile=null,this._smgSceFile=null,this._smgXmlMasterFile=null,this._smgXmlMap=null,this._smgSceFileParsing=!1,this._listSmgXmlRootNodes=[],this._statNb3DNodes=0},loadXMLDoc:function(e){var t;(t=window.ActiveXObject?new ActiveXObject("Msxml2.XMLHTTP"):new XMLHttpRequest).open("GET",e,!1);try{t.responseType="msxml-document"}catch(e){}return t.send(""),t.responseXML},getNodes:function(e){if(void 0===e)return[];if(e instanceof Array)return e;var t=[];return t.push(e),t},getServerFromType:function(e,t){for(var r=[],a=0;a<e.length;a++){var o=e[a];o["@attributes"].Type===t&&r.push(o)}return r},SetSMGXMLs:function(e){this._smgXmlMap=e},GetSMGXMLs:function(e){this._smgXmlMap=e},SetSMGViewFile:function(e){this._smgViewFile=e},GetSMGViewFile:function(){return this._smgViewFile},SetSMGSceFile:function(e){this._smgSceFile=e},GetSMGSceFile:function(){return this._smgSceFile},SetMasterFileName:function(e){this._smgXmlMasterFile=e},concatArray:function(e){if(e instanceof Array){for(var t="",r=0;r<e.length;r++)t+=e[r];e=t}return e},createGroupSelectionSet:function(e){var t=e["@attributes"],r=t.Name,a=t.Ident,o=this._experienceBase.Factory.BuildComponent("VCXComponentGroupSelectionSet");o.SetID(a),this._experienceBase.ComponentsMap.AddComponent(o);for(var i=[],n=this.getNodes(e.CLitSelection),s=0;s<n.length;s++){var l=this.createSelectionSet(n[s]);l&&(l.GroupID=a,i.push(l.GetID()))}o.SetArrayActors(i),o.SetName(r);var p=o.QueryInterface("VCXIModifiable"),u=new M(this._experienceBase.getManager("VCXScenarioManager"));u.CaptureNeutralProperties(p),this._experienceBase.getManager("VCXCommandManager").Do(u)},createSelectionSet:function(e){var t=e["@attributes"],r=t.Name,a=t.Ident,o=this._experienceBase.Factory.BuildComponent("VCXComponentSelectionSet");o.SetID(a),this._experienceBase.ComponentsMap.AddComponent(o);var i=[],n=e["#text"];if(n){(i=this.concatArray(n).split("#")).pop();var s=i.indexOf("-1");-1!==s&&(i[s]="VCX_RootSMG")}o.SetName(r),o.SetArrayActors(i);var l=o.QueryInterface("VCXIModifiable"),p=new M(this._experienceBase.getManager("VCXScenarioManager"));return p.CaptureNeutralProperties(l),this._experienceBase.getManager("VCXCommandManager").Do(p),o},parseListSelection:function(e){console.log("PARSE SELECTION SETS");for(var t=this.getNodes(e.CLitSelection),r=0;r<t.length;r++){var a=t[r];a.CLitSelection?this.createGroupSelectionSet(a):this.createSelectionSet(a)}},parseDocumentSMGXML:function(e){var r=e["@attributes"].VersionSeemage;if(parseFloat(r)<7){var a=!!localStorage&&localStorage.getItem("DS_COMPOSER_DONT_SHOW_AGAIN_UNSUPPORTED_FILE_WARNING");if("true"!==a&&"1"!==a){var o=T["Notification.UnsupportedVersion"],i=T["Notification.Donotshowagain"];this._experienceBase.getManager("VCXNotificationManager").addNotification({level:"warning",title:"warning",message:o,action:{label:i,callback:function(){localStorage&&(localStorage.setItem("DS_COMPOSER_DONT_SHOW_AGAIN_UNSUPPORTED_FILE_WARNING",!0),this.getParent()&&this.getParent().destroy())}}})}}var n=this._experienceBase.getManager("VCXContextManager");if(n.getExperienceInConnectedPlayer()&&n._supportedFeatures._SMGFileOpenFromSwym){let e=r.lastIndexOf(".");if(r.slice(0,e)<"7.7.4"){o=T["Notification.OlderVersionWithBadImagePreview"];this._experienceBase.getManager("VCXNotificationManager").addNotification({level:"warning",title:"warning",message:o,action:{label:"OK",callback:function(){this.getParent()&&this.getParent().destroy()}}})}}this._mapSequences={},this._allPMIs=[];var l=e.Server,C=this.getServerFromType(l,"CLitIOManager");for(var d in C[0])C[0][d]["@attributes"]&&(this._documentProperties[d]=C[0][d]["@attributes"]);for(var g=this.getServerFromType(l,"PropertyDefinitions"),V=0;V<g.length;V++){var h=g[V];this.parseMetaPropertyDefinitions(h)}var y=this.GetFPSAndInterFrames(l),f=y.fps,S=y.interframeMax,v=this.getServerFromType(l,"CLitKKeyframer")[0];v&&v.Play&&v.Play["@attributes"]&&(v.Play["@attributes"].FPS&&(f=parseFloat(v.Play["@attributes"].FPS)),v.Play["@attributes"].InterFramesMax&&(S=parseInt(v.Play["@attributes"].InterFramesMax)));var b=1e3,X=this.getServerFromType(l,"CLitViewportManager")[0];X&&X.CameraSmoothTime&&X.CameraSmoothTime["@attributes"]&&X.CameraSmoothTime["@attributes"].Value&&(b=2*parseFloat(X.CameraSmoothTime["@attributes"].Value));var L=new c(S),D=new p(new m("ScenarioManager.InterFramesMax",2),L),F=new u(f),B=new p(new m("ScenarioManager.FPS",2),F),_=new u(b),G=new p(new m("ScenarioManager.TransitionTime",2),_),W=this._experienceBase.getManager("VCXScenarioManager"),k=W.QueryInterface("VCXIModifiable"),O=new I(W,this._experienceBase.getManager("VCXCommandManager"),!0);O.ChangeProperty(k,B),O.ChangeProperty(k,D),O.ChangeProperty(k,G),this._experienceBase.getManager("VCXCommandManager").Do(O),W.SetCurrentFrame(0),this._experienceBase.getManager("VCXGUIManager").InitGUI(),this._experienceBase.getManager("VCXExperience").InitImagePanels();var R,E=this._experienceBase.Factory.BuildComponent("VCXScenarioSequence"),U=E.QueryInterface("VCXIModifiable");R=T["Sequence.Animation"],E.SetName(R),E.SetSequenceType(0);var H=new M(this._experienceBase.getManager("VCXScenarioManager"));H.CaptureNeutralProperties(U),this._experienceBase.getManager("VCXCommandManager").Do(H);var z=this._experienceBase.getManager("VCXSequenceManager"),Q=new P(z,this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap);Q.PushSequence(E),this._experienceBase.getManager("VCXCommandManager").Do(Q);var K=this._experienceBase.Factory.BuildComponent("VCXScenario"),Y=K.QueryInterface("VCXIModifiable");K.SetID("AnimationSmgID"),K.SetName("Animation smg"),K.SetScenarioType(s.EScenarioType.Scenario),this._vcxScenarioAnimationSmg=K;var j=this._resources["image.bmp"],Z=this._experienceBase.getManager("VCXDocManager").BuildPathFromString(j,"image.bmp");if(Z){var q=this._experienceBase.getManager("VCXDocManager").AddOrModifyDoc(Z);Y.OnChangeProperty("Actor.DocID",q)}var J=new A(z,this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap);J.PushScenarioInSequence(K,E.GetID()),this._experienceBase.getManager("VCXCommandManager").Do(J);var $=new w(W,this._experienceBase.getManager("VCXCommandManager"));$.GoToScenario(K.GetID()),this._experienceBase.getManager("VCXCommandManager").Do($);var ee=this.getServerFromType(l,"CLitKKeyframer");this.parseMarkers(ee[0],K);var te=this.getServerFromType(l,"CLitServerModifiable");this._layerAnimation=te[0].CLitViewport?te[0].CLitViewport.CLitView:null,this.parseServerModifiable(te[0],K);var re=this.getServerFromType(l,"CLitKBOMManager");if(this._experienceBase.getManager("VCXComponentBomManager")){var ae=this._experienceBase.getManager("VCXComponentBomManager").QueryInterface("VCXIModifiable");this._modifiableFactory.createPropertiesMap(ae,this._experienceBase,re[0],this._experienceBase.ComponentsMap,this._resources,"CLitKBOMManager").forEach(function(e,t){var r=t,a=e;ae.OnChangeProperty(r,a)})}var oe=-1,ie=-1,ne=this.getServerFromType(l,"CLitPaperOutputManager");for(V=0;V<ne.length;V++){var se=ne[V];if(se["Vectorize.Paper.Width"]&&se["Vectorize.Paper.Height"]&&se["Vectorize.Paper.Landscape"]){var le=parseInt(se["Vectorize.Paper.Landscape"]["@attributes"].Value),pe=parseFloat(se["Vectorize.Paper.Width"]["@attributes"].Value),ue=parseFloat(se["Vectorize.Paper.Height"]["@attributes"].Value);1===le&&ue>pe||0===le&&ue<pe?(oe=ue,ie=pe):(oe=pe,ie=ue)}else se["Vectorize.Paper.Width"]&&(oe=parseFloat(se["Vectorize.Paper.Width"]["@attributes"].Value)),se["Vectorize.Paper.Height"]&&(ie=parseFloat(se["Vectorize.Paper.Height"]["@attributes"].Value))}var ce=this._experienceBase.getManager("VCXContextManager").getActiveViewport();if(ce){var Ce=ce.QueryInterface("VCXIModifiable");Ce&&(oe>=0&&Ce.OnChangeProperty("Paper.Width",new u(oe)),ie>=0&&Ce.OnChangeProperty("Paper.Height",new u(ie)))}var de=this._experienceBase.getManager("VCXUnitManager");if(de){var ge=this.getServerFromType(l,"CLitUnitManager");for(V=0;V<ge.length;V++){var me=ge[V];if(me)for(var Ve in me)if("Unit."===Ve.substring(0,5)){var he=Ve.substring(5),ye=de.getUnitType(he);if(ye){var fe=me[Ve];switch(ye.Precision=parseInt(fe["@attributes"].Precision),ye.SymbolDisplay=parseInt(fe["@attributes"].ShowName),ye.DisplayUnit=N.unitsTranslation[he][fe["@attributes"].Range],ye.InternUnit=N.unitsTranslation[he][fe["@attributes"].RangeLitToSI],fe["@attributes"].Separator){case"44":ye.LanguageDisplay=x.ELanguageDisplay.fr;break;case"46":ye.LanguageDisplay=x.ELanguageDisplay.en;break;case"59":ye.LanguageDisplay=x.ELanguageDisplay.local}}}}}for(g=this.getServerFromType(l,"PropertyDefinitions"),V=0;V<g.length;V++){h=g[V];this.parseMetaPropertyDefinitions(h)}if(this.parseSceFileIfExists(),this.GetSMGViewFile()){var Se=this.GetSMGViewFile().ViewsSMG.Server,ve=this.getServerFromType(Se,"CLitList");for(V=0;V<ve.length;V++){(Xe=ve[V]).CLitView&&this.parseViews(Xe)}}for(ve=this.getServerFromType(l,"CLitList"),V=0;V<ve.length;V++){(Xe=ve[V]).CLitSelection?this.parseListSelection(Xe):Xe.CLitView&&this.parseViews(Xe)}for(V=0;V<this._listSmgXmlRootNodes.length;V++){var be=this._listSmgXmlRootNodes[V];if(be)for(var Pe=be.GetSmgXmlViewsNode(),Ae=0;Ae<Pe.length;Ae++){var Xe;(Xe=Pe[Ae]).CLitSelection&&(this._experienceBase.getManager("VCXContextManager").setSmgXmlRoot(be),this.parseListSelection(Xe),this._experienceBase.getManager("VCXContextManager").setSmgXmlRoot())}}var Me=this._documentProperties.LaunchAction;Me&&"1"===Me.Value&&this._experienceBase.getManager("VCXExperience").SetViewMode(1),this._experienceBase.getManager("VCXHotspotManager")&&this._experienceBase.getManager("VCXHotspotManager").UpdateHotspotsHyperlinks(),this._experienceBase.getManager("SUIManager")&&this._experienceBase.getManager("SUIManager").syncCameraSystemModifiables(),t.publish({event:"VCX_REFRESH_ICON",data:K}),t.publish({event:"VCX_KEYS_CHANGED"})},GetFPSAndInterFrames:function(e){var t=null,r={};if(this.GetSMGSceFile()){var a=this.GetSMGSceFile().ScenarioSMG.Server;t=this.getServerFromType(a,"CLitKKeyframer")}else t=this.getServerFromType(e,"CLitKKeyframer");if(t){var o=t[0];o&&o.Play&&o.Play["@attributes"]&&(o.Play["@attributes"].FPS&&(r.fps=parseFloat(o.Play["@attributes"].FPS)),o.Play["@attributes"].InterFramesMax&&(r.interframeMax=parseInt(o.Play["@attributes"].InterFramesMax)))}return r},parseSceFileIfExists:function(){if(this.GetSMGSceFile()){this._smgSceFileParsing=!0;var e=this.GetSMGSceFile().ScenarioSMG.Server,t=this.getServerFromType(e,"CLitServerModifiable");if(1==t.length){var r=t[0];for(var a in this._modifiableFactory.getV1Ids()){var o=this.getNodes(r[a]);if(o.length)for(var i=0;i<o.length;i++){var n=o[i],s="",l=n["@attributes"];if(l){var p=l.NetGuid,u=l.Ident;p?s=l.NetGuid:u&&(s=l.Ident);var c=this._experienceBase.ComponentsMap.GetComponentFromID(s),C=c?c.QueryInterface("VCXIModifiable"):null;C&&(this.parseNeutrals(n,C,a),this.parseTracks(n,C,a))}}}}this._smgSceFileParsing=!1}},parseMarkers:function(e,t){if(void 0!==e&&void 0!==e.Markers&&e.Markers.CLitMarker){var r=[];e.Markers.CLitMarker.length?r=e.Markers.CLitMarker:r.push(e.Markers.CLitMarker);for(var a=this._experienceBase.getManager("VCXCommandManager"),o=new L(this._experienceBase.getManager("VCXScenarioManager"),a,this._experienceBase.ComponentsMap),i=new I(this._experienceBase.getManager("VCXScenarioManager"),a,!0),n=0;n<r.length;n++){var s=r[n],l=s["@attributes"].Pos,u=s["@attributes"].Label,d=s["@attributes"].Milestone,V=u+"_"+l,h=this._experienceBase.Factory.BuildComponent("VCXComponentMarker");h.SetID(V),o.AddMarkerToScenario(h,t,parseInt(l,10));var y=new c;y.FromString(l);var f=new p(new m("Actor.TimePos",2),y),S=new C(u),v=new p(new m("Actor.Name",2),S),b=new g;b.FromString(d);var P=new p(new m("Actor.IsMilestone",2),b),A=h.QueryInterface("VCXIModifiable");i.ChangeProperty(A,f),i.ChangeProperty(A,v),i.ChangeProperty(A,P)}a.Do(i),a.Do(o);var X=t.QueryInterface("VCXIModifiable"),w=new M(this._experienceBase.getManager("VCXScenarioManager"));w.CaptureNeutralProperties(X),this._experienceBase.getManager("VCXCommandManager").Do(w)}},parseMetaPropertyDefinitions:function(e){for(var t=e.MetaProperties,r=this.getNodes(t.Meta),a=0;a<r.length;a++){var o=r[a],i="VCXPropertyValueString";switch(o["@attributes"].Type){case"String":i="VCXPropertyValueString";break;case"Bool":i="VCXPropertyValueBoolean";break;case"Color":i="VCXPropertyValueColor";break;case"Date":i="VCXPropertyValueDate";break;case"Float":i="VCXPropertyValueFloat";break;case"Int":i="VCXPropertyValueInt";break;default:i="VCXPropertyValueString"}var n=new m(o["@attributes"].Name,0,!0);"1"===o["@attributes"].Bounded&&("VCXPropertyValueInt"===i?n.SetBounds(parseInt(o["@attributes"].MinValue),parseInt(o["@attributes"].MaxValue)):"VCXPropertyValueFloat"===i&&n.SetBounds(parseFloat(o["@attributes"].MinValue),parseFloat(o["@attributes"].MaxValue))),n.SetGroupId("Group.UserProperties"),n.Seti18nGroup(G);var s=new S(n,i);s.SetDefaultLabel(o["@attributes"].DefaultLabel),n.SetMetaPropertyDef(s),this._experienceBase.getManager("VCXMetaPropertyManager").AddMetaPropertyDef(s)}},parseViews:function(e){F.memoryLog("VCXSmgXmlLoader parseViews",!0);for(var t=this.getNodes(e.CLitView),r=0;r<t.length;r++)this.parseView(t[r]);F.memoryLog("VCXSmgXmlLoader parseViews",!1)},parseView:function(e){if("1"!==(G=e["@attributes"]).IsUsedByUpdatableCapture){var t=this._experienceBase.Factory.BuildComponent("VCXScenario"),r=G.Ident;G.Type!==N.ViewType.CadViews&&G.Type!==N.ViewType.CadCaptures||(r+=G.Type),t.SetID(r),"1"===G.AppliedToObject&&"1"===G.AppliedToProperties&&"0"===G.AppliedToSelection||t.SetApplyNeutralAtGoToScenario(!1);var a="1"===G.AppliedZoomFitAll||G.Type===N.ViewType.CadViews;t.SetZoomFitAll(a);var o=G.Type===N.ViewType.CadViews;if(!o&&e.Neutral){var i=e.Neutral["CADView.AppliedToPMIOnly"];if(i){var n=i["@attributes"];n&&(o="1"===n.Value)}}var l="view"+G.Ident+".jpg";l=l.toLowerCase();var p=this._resources[l],u=t.QueryInterface("VCXIModifiable"),c=this._experienceBase.getManager("VCXDocManager").BuildPathFromString(p,l);if(c){var C=this._experienceBase.getManager("VCXDocManager").AddOrModifyDoc(c);u.OnChangeProperty("Actor.DocID",C)}var d=!1,g=G.CollectionName;void 0!==g&&""!==g&&(d=!0);var m="Unknown",V=s.EScenarioType.Scenario;if(d?m=g:(G.Type===N.ViewType.Views?m="Views":G.Type===N.ViewType.Layers?(m="Layers",V=s.EScenarioType.Layer):G.Type===N.ViewType.CadViews?(m="CADViews",V=s.EScenarioType.CADView):G.Type===N.ViewType.CadCaptures&&(m="CADCaptures",V=s.EScenarioType.CADCapture),m=T["Sequence."+m]),t.SetName(G.Name),t.SetScenarioType(V),this.parseViewVisibility(t,e,o),!o&&"1"===G.AppliedToObject&&"1"===G.AppliedToVisibility&&"1"!==G.AppliedToSelection)if(this._documentProperties["View.VisibleBehavior"])switch(this._documentProperties["View.VisibleBehavior"].Value){case N.ViewCompressionV1.VisibleActors:case N.ViewCompressionV1.VisibleAssemblies:t.GetVisibility().SetMode(1),t.GetVisibility().AddVisibleToGroups(this._experienceBase.getManager("VCXContextManager").getRootComponent());break;case N.ViewCompressionV1.HiddenActors:case N.ViewCompressionV1.HiddenAssemblies:t.GetVisibility().SetMode(2);break;default:t.GetVisibility().SetMode(0)}else t.GetVisibility().SetMode(1),t.GetVisibility().AddVisibleToGroups(this._experienceBase.getManager("VCXContextManager").getRootComponent());(R=new M(this._experienceBase.getManager("VCXScenarioManager"))).CaptureNeutralProperties(u),this._experienceBase.getManager("VCXCommandManager").Do(R),this._vcxCamera||(this._vcxCamera=this.createCamera(),this._experienceBase.getManager("VCXContextManager").setActiveCamera(this._vcxCamera));var h=e.Camera;if(h)for(var y=this.getNodes(h.CLitModifiable),f=0;f<y.length;f++)this.addModifiableNodeToView(t,y[f],null);else{var S=e.Navigator;if(void 0!==S){var v=this._vcxCamera.QueryInterface("VCXIModifiable");this.addModifiableToView(t,v,S)}}if(void 0!==e.Navigator&&this._vcxCompass){var b=this._vcxCompass.QueryInterface("VCXIModifiable");this.addModifiableToView(t,b,e.Navigator)}var X=e.Viewport;if(X&&this._vcxViewport){var I=this._vcxViewport.QueryInterface("VCXIModifiable");this.addModifiableToView(t,I,X)}var w=e.Configuration;if(w){var L=this.getNodes(w.CLitModifiable);if(void 0!==L)for(var D=0;D<L.length;D++){var x=L[D];this.addModifiableNodeToView(t,x)}}var F=e.BOMInfo;if(void 0!==F){var B=this._vcxBomInfo.QueryInterface("VCXIModifiable");this.addModifiableToView(t,B,F)}var _=e.Digger,G=e["@attributes"];if(void 0!==_&&G&&"1"===G.AppliedToDigger){var W=null,k=this._experienceBase.ComponentsMap.GetComponentFromID("VCX_Digger.-1");if(k||(k=this._modifiableFactory.create(this._experienceBase,"CLitDigger","VCX_Digger.-1",void 0),this._v1ComponentType["VCX_Digger.-1"]="CLitDigger"),k&&(W=k.QueryInterface("VCXIModifiable")),W)if(this.addModifiableToView(t,W,_),W.loadParentMode="DigZoom",this.addModifiableToView(t,W,e.DigZoom),W.loadParentMode="DigOnionSkin",this.addModifiableToView(t,W,e.DigOnionSkin),W.loadParentMode="DigXRay",this.addModifiableToView(t,W,e.DigXRay),_["Inspector.Enabled"])if("1"===_["Inspector.Enabled"]["@attributes"].Value)t.GetVisibility().AddVisibleCollab(k)}var O=this._mapSequences[m];if(!O){var R,E=(O=this._experienceBase.Factory.BuildComponent("VCXScenarioSequence")).QueryInterface("VCXIModifiable");O.SetName(m),O.SetSequenceType(V),(R=new M(this._experienceBase.getManager("VCXScenarioManager"))).CaptureNeutralProperties(E),this._experienceBase.getManager("VCXCommandManager").Do(R);var U=new P(this._experienceBase.getManager("VCXSequenceManager"),this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap);U.PushSequence(O),this._experienceBase.getManager("VCXCommandManager").Do(U),this._mapSequences[m]=O}if(O){var H=new A(this._experienceBase.getManager("VCXSequenceManager"),this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap);H.PushScenarioInSequence(t,O.GetID()),this._experienceBase.getManager("VCXCommandManager").Do(H)}}},parseActorList:function(e){if(void 0!==e){var t=[],r=e["#text"];if(void 0!==r){var a=this.concatArray(r).split("#");a.pop();for(var o=0;o<a.length;o++){var i=a[o];"-1"===i&&(i="VCX_RootSMG");var n=new d(i);t.push(n)}}if(t.length)return new V(t)}return null},parseViewVisibility:function(e,t,r){if(t){var a=e.GetVisibility();if(a){if(r)a.SetMode(0),a.AddInvisibles(this._allPMIs.slice(0).concat(this._allPmisConstructionGeometries.slice(0)));else if(e.GetApplyNeutralAtGoToScenario()){var o=e.QueryInterface("VCXIModifiable"),i=new h;if(this._documentProperties["View.VisibleBehavior"])switch(this._documentProperties["View.VisibleBehavior"].Value){case N.ViewCompressionV1.VisibleActors:case N.ViewCompressionV1.VisibleAssemblies:i.SetValue(1),a.AddVisibleToGroups(this._experienceBase.getManager("VCXContextManager").getRootComponent());break;case N.ViewCompressionV1.HiddenActors:case N.ViewCompressionV1.HiddenAssemblies:i.SetValue(2);break;default:a.SetMode(0)}else i.SetValue(1),a.AddVisibleToGroups(this._experienceBase.getManager("VCXContextManager").getRootComponent());var n=new M(this._experienceBase.getManager("VCXScenarioManager"));n.ChangeProperty(o,"Scenario.Visibility.Mode",i),this._experienceBase.getManager("VCXCommandManager").Do(n)}else a.SetMode(0);var s=t.Living;if(void 0!==s){var l=s["#text"];if(void 0!==l)for(var p=this.concatArray(l).split("#"),u=0;u<p.length;u++){var c=p[u];if("-1"===c&&(c="VCX_RootSMG"),S=this._experienceBase.ComponentsMap.GetComponentFromID(c))if(S.IsKindOf("VCXComponentCompositePmi")&&!0===S._isSWPMI){a.AddVisible(S);for(var C=S.QueryInterface("VCXIModelNavigable").getChildren(),d=0;d<C.length;d++){var g=C[d];g&&g.GetObject().IsKindOf("VCXLabel_Spec")&&a.AddVisibleCollab(g.GetObject())}}else S.IsKindOf("VCXWebComponentOccurrence")&&!S.IsDressup?(r&&a.RemoveInvisible(S),a.AddVisibleToDescendants(S)):a.AddVisibleCollab(S)}}var m=t.Invisible;if(void 0!==m){var V=m["#text"];if(void 0!==V)for(var y=this.concatArray(V).split("#"),f=0;f<y.length;f++){var S,v=y[f];"-1"===v&&(v="VCX_RootSMG"),(S=this._experienceBase.ComponentsMap.GetComponentFromID(v))&&a.AddInvisibleToDescendants(S)}}if(this._vcxViewport&&a.AddVisibleCollab(this._vcxViewport),this._vcxCompass){var b=t.Navigator;if(void 0===b&&(b=t),void 0!==b){var P=b["Navigator.Compass.Visibility"];if(void 0!==P){var A=P["@attributes"];void 0!==A&&("0"===A.Value||"false"===A.Value?a.AddInvisible(this._vcxCompass):a.AddVisibleCollab(this._vcxCompass))}}}if(this._vcxDigger){var X=t;void 0!==X&&X.Tracks&&X.Tracks.Track&&a.AddVisibleCollab(this._vcxDigger)}}}},addModifiableToView:function(e,t,r){if(t){var a=t.GetObject().GetID(),o=this._v1ComponentType[a],i=this._modifiableFactory.createPropertiesMap(t,this._experienceBase,r,this._resources,o),n=new X(this._experienceBase.getManager("VCXScenarioManager"));n.SetLockEvents(!0),n.SetLockUpdateProperties(!0),n.SetCloneValues(!1),i.forEach(function(r,a){var o=a,i=r;n.ChangeKey(e,t,o,parseFloat(0),i)}),this._experienceBase.getManager("VCXCommandManager").Do(n)}},addModifiableNodeToView:function(e,t){if(void 0!==t){var r=t["@attributes"].Ident,a=this._experienceBase.ComponentsMap.GetComponentFromID(r);if(a){var o=a.QueryInterface("VCXIModifiable");this.addModifiableToView(e,o,t)}else console.log("Can't find component "+r)}},createNodeForRefrencedXMLGrp:function(e,t,r,a,i,n,s,l){var p=t["@attributes"],u=null,c=null;if(n){this._statNb3DNodes++,(u=new o(p.Ident)).productType="Instance3D",a.add(u),i.addElement(u);var C=r;if(""===r&&(C="VCX_RootSMG"),(c=this._modifiableFactory.create(this._experienceBase,"CLitAssyGroup",C,i,s))&&""===r&&c.SetPersistency(1),c){c.SetGUID(p.Ident);var d=c.QueryInterface("VCXIModifiable");this.parseNeutrals(t,d,"CLitAssyGroup")}l&&l.AddComponent(c)}this.parseReferencedXML(e,r,u,i.clone(),!1,n,c,l)},tryToRetrieveRefXMLPath:function(e,t){var r=null;e=e.toLowerCase();for(var a=0;"."==e[a]||"\\"==e[a]||"/"==e[a];)a++;var o=e.slice(a);if(this._smgXmlMap.has(o)&&(r=o),!r&&t){var i=t.GetSmgXmlRelativePath().replace(/\\/g,"/"),n=i.slice(0,i.lastIndexOf("/"));o=null;e.startsWith(".\\")?(o=n+"\\"+(o=e.slice(2)),this._smgXmlMap.has(o)&&(r=o)):(o=n+"\\"+e,this._smgXmlMap.has(o)&&(r=o))}return r},parseReferencedXML:function(e,t,r,a,o,i,n,s){var l=this.tryToRetrieveRefXMLPath(e,s);if(l){var p=this._smgXmlMap.get(l);if(p){var u=B.loadXMLString(p),c=B.xmlToJson(u).DocumentSMG,C=c.Server,d=this.getServerFromType(C,"CLitServerModifiable")[0].CLitAssyRoot,g=new _;if(g.SetSmgXmlDocument(c),g.SetSmgXmlRelativePath(l),i){this._listSmgXmlRootNodes.push(g);for(var m=this.getServerFromType(C,"PropertyDefinitions"),V=0;V<m.length;V++){var h=m[V];this.parseMetaPropertyDefinitions(h)}}this.parseAssyGroup(d,t,r,a,!0,i,n,g)}}},parseServerModifiable:function(e,t){var a=this._experienceBase.getManager("VCXContextManager").getRootNode(),o=this._experienceBase.getManager("VCXContextManager").getRootComponent(),i=e.CLitAssyRoot;void 0===i&&(i=e);var n=o.QueryInterface("W3AISGNodeHolder").getPathElement().clone(),s="";void 0!==i&&(this._experienceBase.getManager("VCXContextManager").setActiveBOM(this._vcxBom),F.memoryLog("VCXSmgXmlLoader Build Actors",!0),s="",this.parseAssyGroup(i,s,a,n,!0,!0,o),F.memoryLog("VCXSmgXmlLoader Build Actors",!1),F.memoryLog("VCXSmgXmlLoader Fill neutrals and tracks",!0),s="",this.parseAssyGroup(i,s,a,n,!0,!1,o),F.memoryLog("VCXSmgXmlLoader Fill neutrals and tracks",!1));var l=e.CLitVectorImageBOM;if(void 0!==l){n=new r;this._vcxBom=this.parseAnnotations("CLitVectorImageBOM",l,"",n,!0),this.parseAnnotations("CLitVectorImageBOM",l,"",n,!1),this._experienceBase.getManager("VCXContextManager").setActiveBOM(this._vcxBom)}var p=e.CLitBOMInfo;if(void 0!==p){n=null;this._vcxBomInfo=this.parseAnnotations("CLitBOMInfo",p,"CLitBOMInfoId",n,!0),this.parseAnnotations("CLitBOMInfo",p,"CLitBOMInfoId",n,!1)}var u=e.CLitActorGround;if(void 0!==u){n=new r;this._vcxGround=this.parseAnnotations("CLitActorGround",u,"",n,!0),this.parseAnnotations("CLitActorGround",u,"",n,!1),this._experienceBase.getManager("VCXContextManager").setActiveGround(this._vcxGround)}if(void 0!==(c=e.CLitViewport)){n=new r;this._vcxViewport=this.parseAnnotations("CLitViewport",c,"",n,!0),this.parseAnnotations("CLitViewport",c,"",n,!1)}if(void 0!==c&&c.CLitNavigator&&void 0!==c.CLitNavigator){n=new r;this._vcxCompass=this.parseAnnotations("CLitActorCompass",c.CLitNavigator,"VCX_Compass",n,!0),this.parseAnnotations("CLitActorCompass",c.CLitNavigator,"VCX_Compass",n,!1)}var c,C=void 0!==c?c.CLitDigger:void 0;if(void 0!==C&&C.Tracks&&C.Tracks.Track){n=new r;this._vcxDigger=this.parseAnnotations("CLitDigger",C,"VCX_Digger",n,!0),this.parseAnnotations("CLitDigger",C,"VCX_Digger",n,!1)}for(var d=this.getNodes(e.CLitCameraActor),g=0;g<d.length;g++){n=new r;this._vcxCamera||(this._vcxCamera=this.parseAnnotations("CLitCameraActor",d[g],"",n,!0)),this.parseAnnotations("CLitCameraActor",d[g],"",n,!1),this._experienceBase.getManager("VCXContextManager").setActiveCamera(this._vcxCamera)}if(void 0!==(c=e.CLitViewport)){if(!this._vcxCamera){var m=c.CLitNavigator;void 0!==m&&this.parseNavigator(m)}var V=c.CLitView;this.parseViewVisibility(t,V,!1),void 0!==c.CLitNavigator&&this.parseViewVisibility(t,c.CLitNavigator.Neutral,!1),this.parseViewVisibility(t,c.CLitDigger,!1);for(var h=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentCompositePmi"),y=0;y<h.length;y++){var f=h[y];if(f._isSWPMI)for(var S=parseInt(c.Neutral["Navigator.Camera.Vertical"]["@attributes"].Value),v=this.getMatrixToAdjustVerticalforSWPMI(S),b=f.QueryInterface("VCXIModelNavigable"),P=b&&b.getChildren(),A=0;A<P.length;A++){var X=P[A];if(X){var M=X.GetObject();if(M&&"VCXLabel_Spec"===M.GetType()){var I=M.QueryInterface("W3AISGNodeHolder");if(I){var w=I.getSGNode(),L=w.getMatrix();L.multiply(v),w.setMatrix(L)}}}}}}var D=this.getNodes(e.CLitSelectionHotSpot);this.parseHotSpots(D);for(var x=0;x<this._listSmgXmlRootNodes.length;x++){var B=this._listSmgXmlRootNodes[x];if(B){var _=B.GetSmgXmlServerModifNode(),T=this.getNodes(_.CLitSelectionHotSpot);T.length>0&&(this._experienceBase.getManager("VCXContextManager").setSmgXmlRoot(B),this.parseHotSpots(T),this._experienceBase.getManager("VCXContextManager").setSmgXmlRoot())}}},parseHotSpots:function(e){console.log("PARSE HOTSPOTS");for(var t=0;t<e.length;t++){e[t].CLitSelectionHotSpot?this.createGroupHotspot(e[t]):this.createHotspot(e[t])}},createGroupHotspot:function(e){var t=e["@attributes"],r=t.Ident,a=this._experienceBase.Factory.BuildComponent("VCXComponentGroupHotspot");a.SetID(r),this._experienceBase.ComponentsMap.AddComponent(a);var o=e.CLitSelectionHotSpot;if(o){for(var i=[],n=0;n<o.length;n++){var s=o[n],l=this.createHotspot(s);l.GroupID=r,i.push(l.GetID())}var p=t.Name;a.SetName(p),a.SetArrayActors(i);var u=a.QueryInterface("VCXIModifiable"),c=new M(this._experienceBase.getManager("VCXScenarioManager"));c.CaptureNeutralProperties(u),this._experienceBase.getManager("VCXCommandManager").Do(c)}},createHotspot:function(e){var t=e["@attributes"],r=t.Ident;this.parseAnnotations("CLitSelectionHotSpot",e,"",null,!0);var a=this._experienceBase.ComponentsMap.GetComponentFromID(r);if(a){var o=e.Actors;if(o){var i=o["#text"];if(i){var n=this.concatArray(i).split("#");n.pop();var s=n.indexOf("-1");-1!==s&&(n[s]="VCX_RootSMG")}}var l=t.Name;a.SetName(l),a.SetArrayActors(n);var p=a.QueryInterface("VCXIModifiable"),u=new M(this._experienceBase.getManager("VCXScenarioManager"));u.CaptureNeutralProperties(p),this._experienceBase.getManager("VCXCommandManager").Do(u)}return this.parseAnnotations("CLitSelectionHotSpot",e,"",null,!1),a},parseAssyGroup:function(e,t,r,a,i,n,s,l){var p=e["@attributes"];i||(t=""===t?p.Ident:t+"."+p.Ident);var u=null,c=null;if(n)if(i&&l)u=r,c=s;else{this._statNb3DNodes++,(u=new o(p.Ident)).productType="Instance3D",r.add(u),a.addElement(u);var d=t;""===t&&(d="VCX_RootSMG"),(c=this._modifiableFactory.create(this._experienceBase,"CLitAssyGroup",d,a,s))&&""===t&&c.SetPersistency(1),c&&c.SetGUID(p.Ident),l&&l.AddComponent(c)}else{var g=t;if(""===g&&(g="VCX_RootSMG"),c=this._experienceBase.ComponentsMap.GetComponentFromID(g)){var m=c.QueryInterface("VCXIModifiable");if(this.parseNeutrals(e,m,"CLitAssyGroup"),this.parseTracks(e,m,"CLitAssyGroup"),i&&m){var V=m.GetProperty("Actor.Name");if(V)if("-1"===V.GetPropertyValue().GetValue()){var h=new C;h.SetValue("Root"),m.OnChangeProperty("Actor.Name",h)}}}for(var y=this.getNodes(e.CLitCADView),f=0;f<y.length;f++)this.parseView(y[f])}for(var S in this._modifiableFactory.getV1Ids()){var v=this.getNodes(e[S]);if(v.length)switch(S){case"CLitAssyGroup":for(var b=0;b<v.length;b++){var P=v[b]["@attributes"],A=P.IsInstanceOf;if(A){var X="";X=""===t?P.Ident:t+"."+P.Ident,this.createNodeForRefrencedXMLGrp(A,v[b],X,u,a.clone(),n,c,l)}else this.parseAssyGroup(v[b],t,u,a.clone(),!1,n,c,l)}break;case"CLitActorMesh":case"CLitActor":case"CLitActorCurveWire":case"CLitActorPoint":case"CLitActorPrim":case"CLitActorCompositePmi":case"CLitRedline":for(var M=0;M<v.length;M++)this.parseActor(v[M],S,t,u,a.clone(),n,c,l);break;default:for(M=0;M<v.length;M++)this.parseAnnotations(S,v[M],t,a.clone(),n,l)}}if(n&&p&&("0"===p.NeutralVisibility&&this._vcxScenarioAnimationSmg&&!this._layerAnimation)){var I=this._vcxScenarioAnimationSmg.GetVisibility();I&&I.AddInvisible(c)}},getActorCompositePmiArray:function(e,t){var r=e[t];if(!r)return null;if(void 0===r.Data){if("points"===t){var a=[];for(var o in r){if("@attributes"!==o)(n=r[o]["@attributes"])&&(a.push(parseFloat(n.X)),a.push(parseFloat(n.Y)),a.push(parseFloat(n.Z)))}return a}var i=[];for(var o in r){var n;if("@attributes"!==o)(n=r[o]["@attributes"])&&i.push(parseFloat(n.Value))}return i}var s=r["@attributes"];if(!s)return null;var l=parseInt(s.size),p=r.Data["@attributes"];if(!p)return null;for(var u=atob(p.Value),c=new ArrayBuffer(u.length),C=0;C<u.length;C++)c[C]=u.charCodeAt(C);var d=new DataView(c);for(C=0;C<u.length;C++)d.setUint8(C,u.charCodeAt(C));var g=0;if("points"===t){for(a=new Float32Array(3*l),C=0;C<l;C++){var m=3*C;a[m]=d.getFloat32(4*g++,!0),a[m+1]=d.getFloat32(4*g++,!0),a[m+2]=d.getFloat32(4*g++,!0)}return a}var V=new Uint32Array(l);for(C=0;C<l;C++)V[C]=d.getUint32(4*g++,!0);return V},parseActorCompositePmiRepresentation:function(e,t="0"){this._statNb3DNodes++;var r=new o,n="1"===t?this.parseDrawPolylineSW(e):this.parseDrawPolyline(e);if(null!==n&&(r.add(n),n.productType="InstanceRep",n.setPickParent(!0)),"1"===t)for(var s=this.getNodes(e.CLitDrawExtremity),l=0;l<s.length;l++){var p=s[l];switch(parseInt(p.Neutral["ActorCurve.Extremity.Start"]["@attributes"].Value)){case 1:var u=parseFloat(p.Neutral["ActorCurve.Extremity.Size"]["@attributes"].Value),c=p.Neutral["Draw.Location"].Frame.Origin["@attributes"],C=p.Neutral["Draw.Location"].Frame.VX["@attributes"],d=p.Neutral["Draw.Location"].Frame.VY["@attributes"],g=new a.Vector3(parseFloat(C.X),parseFloat(C.Y),parseFloat(C.Z)),m=new a.Vector3(parseFloat(d.X),parseFloat(d.Y),parseFloat(d.Z)),V=new a.Vector3(parseFloat(c.X),parseFloat(c.Y),parseFloat(c.Z)),h=W.getMatrixFromOVxVy(V,g,m),y=.5*u,f=[];f[0]=-u,f[1]=-y,f[2]=0,f[3]=-u,f[4]=y,f[5]=0,f[6]=0,f[7]=0,f[8]=0;var S=[];S[0]=0,S[1]=0,S[2]=1,S[3]=0,S[4]=0,S[5]=1,S[6]=0,S[7]=0,S[8]=1;var v=D.allocIndexationArray(3,3);for(i=0;i<3;i++)v[i]=i;var b=null;this._materialManager&&(b=this._materialManager.getMaterialBasic(new a.Color(0,0,0),1));var P=D.buildIndexedTriangleSet(1,f,S,null,v,v,null,null,b,!1,!0);P.setMatrix(h),r.add(P);break;case 5:u=parseFloat(p.Neutral["ActorCurve.Extremity.Size"]["@attributes"].Value),c=p.Neutral["Draw.Location"].Frame.Origin["@attributes"],C=p.Neutral["Draw.Location"].Frame.VX["@attributes"],d=p.Neutral["Draw.Location"].Frame.VY["@attributes"],g=new a.Vector3(parseFloat(C.X),parseFloat(C.Y),parseFloat(C.Z)),m=new a.Vector3(parseFloat(d.X),parseFloat(d.Y),parseFloat(d.Z)),V=new a.Vector3(parseFloat(c.X),parseFloat(c.Y),parseFloat(c.Z)),h=W.getMatrixFromOVxVy(V,g,m),y=.5*u;var A=D.getPrimitiveMeshNode(4).clone();A.setMatrix(h),r.add(A)}}for(var X=this.getNodes(e.CLitDrawSurface),M=0;M<X.length;M++){for(var I=X[M],w=this.getActorCompositePmiArray(I,"points"),L=this.getActorCompositePmiArray(I,"triangles"),x=this.getActorCompositePmiArray(I,"indices"),F=this.getActorCompositePmiArray(I,"types"),B=new Float32Array(3*w.length),_=0;_<w.length;_++){var T=3*_;B[T]=0,B[T+1]=0,B[T+2]=1}var G=D.buildIndexation(w,L,F,x);G.length%3!=0&&console.log("Invalid indexation");var N=G.length/3;if(N){var k=null;this._materialManager&&(k=this._materialManager.getMaterialBasic(new a.Color(0,0,0),1));var O=D.buildIndexedTriangleSet(N,w,B,null,G,G,null,null,k,!1,!0),R=I.Neutral;if(R){(R["Draw.Billboard"]?R["Draw.Billboard"]["@attributes"].Value:0)&&(O._billboardData.type=1);var E=R["Draw.Location"]?R["Draw.Location"].Frame:0;if(E&&E.Origin){c=E.Origin["@attributes"],C=E.VX["@attributes"],d=E.VY["@attributes"],g=new a.Vector3(parseFloat(C.X),parseFloat(C.Y),parseFloat(C.Z)),m=new a.Vector3(parseFloat(d.X),parseFloat(d.Y),parseFloat(d.Z)),V=new a.Vector3(parseFloat(c.X),parseFloat(c.Y),parseFloat(c.Z));h=W.getMatrixFromOVxVy(V,g,m),O.setMatrix(h)}}r.add(O),O.setPickParent(!0),O.productType="InstanceRep"}}return r},parseDrawPolyline:function(e,t){var r=this.getNodes(e.CLitDrawPolyline);if(t){for(var a=new Uint32Array(r.length),o=[],i=0,s=0;s<r.length;s++){if(void 0!==(g=r[s])){var l=this.getActorCompositePmiArray(g,"points");if(null!==l){for(var p=new ArrayBuffer(4*l.length),u=new Float32Array(p),c=0;c<l.length;++c)u[c]=l[c];var C=new Uint8Array(p).toString();t=window.btoa(C);o.push(t)}}}return o}a=new Uint32Array(r.length);var d=[];for(i=0,s=0;s<r.length;s++){var g;if(void 0!==(g=r[s])){var m=this.getActorCompositePmiArray(g,"points");if(null!==m){for(var V=0;V<m.length;V++)d[i++]=m[V];a[s]=m.length/3}}}for(var h=d.length/3,y=D.allocIndexationArray(h,h),f=0;f<h;f++)y[f]=f;var S=new Float32Array(d.length);for(V=0;V<d.length;++V)S[V]=d[V];return D.buildLineStripSet(S,a,y,new n.Color(0,0,0,1),1,"WIRE_EDGE")},parseActor:function(e,t,r,i,s,l,p,u){var c=e["@attributes"];r=""===r?c.Ident:r+"."+c.Ident;var d=null,g=null;if(l){this._statNb3DNodes++,(g=new o(c.Ident)).productType="Instance3D",i.add(g),s.addElement(g),d=this._modifiableFactory.create(this._experienceBase,t,r,s,p),this._v1ComponentType[r]=t,d||console.error("Failed to build VCX component"),d.SetGUID(c.Ident),u&&u.AddComponent(d);var m=null,V=null;if(c.IdentGeom)(R=this._mapGeodes.get(c.IdentGeom))&&(m=R.geode,V=R.userdata);switch(t){case"CLitActorMesh":case"CLitActor":case"CLitActorCurveWire":m||(g.name=c.Ident+" IdentGeom:"+c.IdentGeom+" not found"),V&&6===V.ucGeometryType&&this._allPmisConstructionGeometries.push(d.GetID());break;case"CLitActorPoint":g.name="VCXPoint",(m=D.buildPoint([0,0,0],new n.Color(1,0,0,1),5,null)).setNoZ(!0);break;case"CLitActorPrim":g.name="VCXPrimitive";break;case"CLitRedline":this.generateAnchorsIdsArray(e),g.name="VCXRedline";for(var h=this.parseDrawPolyline(e,!0),y=(k=d?d.QueryInterface("VCXIModifiable"):null)?k.GetPropertyValue("Collab.VertexBuffers"):[],S=0;S<h.length;++S){var v=new f;v.SetValue(h[S]),y.SetValueAtIndex(S,v)}k.OnChangeProperty("Collab.VertexBuffers",y);break;case"CLitActorCompositePmi":if(g.name="VCXFTA",g.setNoZ(!0),m){m.setMaterial(new a.MeshBasicMaterial({color:"#FFFFFF",side:a.DoubleSide,force:!0,opacity:0})),m.setPickParent(!0);var b=s.clone();b.addElement(m),g.add(m);var P=this._experienceBase.getManager("VCXContextManager").getSharedSceneGraphOverride(b,!0);P&&P.setOpacity(0,!0)}var A=e.Neutral;if(A){var X="0";if(A["ActorCompositePmi.IsFromSW"]&&(X=A["ActorCompositePmi.IsFromSW"]["@attributes"].Value),"1"===X){d._isSWPMI=!0;for(var M=this.getNodes(e.CLitDrawText),I=0;I<M.length;I++){var w=M[I],L=[];L.push(0),w.Neutral.ArrayAnchorsIds=L;var x=e["@attributes"];if(l&&x)if("0"===x.NeutralVisibility&&this._vcxScenarioAnimationSmg&&!this._layerAnimation){var F=this._vcxScenarioAnimationSmg.GetVisibility();F&&F.AddInvisible(d)}}}}if(N=this.parseActorCompositePmiRepresentation(e,X)){g.add(N),N.setPickParent(!0);var B=[];B[0]=N;var _=e.MirroringRepresentations;if(_)for(var T=this.getNodes(_.MirroringRepresentation),G=0;G<T.length;G++){var N;(N=this.parseActorCompositePmiRepresentation(T[G]))&&(g.add(N),N.setPickParent(!0),N.setVisibility(!1),B[G+1]=N)}d&&(d._representations=B,this._allPMIs.push(d.GetID()))}}m&&(m.productType="InstanceRep",g.add(m))}else{var k;if((k=(d=this._experienceBase.ComponentsMap.GetComponentFromID(r))?d.QueryInterface("VCXIModifiable"):null)&&(this.parseNeutrals(e,k,t),this.parseTracks(e,k,t),null===k._name)){var O=new C,R=null;c.IdentGeom&&(R=this._mapGeodes.get(c.IdentGeom));var E=R?R.name:"";O.SetValue(E),k.OnChangeProperty("Actor.Name",O)}}for(var t in this._modifiableFactory.getV1Ids()){var U=this.getNodes(e[t]);if(U.length)switch(t){case"CLitAssyGroup":for(var H=0;H<U.length;H++)this.parseAssyGroup(U[H],r,g,s.clone(),!1,l,d);break;case"CLitActorMesh":case"CLitActor":case"CLitActorCurveWire":case"CLitActorPoint":case"CLitActorPrim":case"CLitActorCompositePmi":case"CLitRedline":for(var z=0;z<U.length;z++)this.parseActor(U[z],t,r,g,s.clone(),l,d);break;case"CLitDrawText":for(z=0;z<U.length;z++){var Q=U[z],K=this.parseAnnotations(t,Q,r,s.clone(),l);if(K){var Y=Q.Neutral["Draw.Location"].Frame.Origin["@attributes"],j=Q.Neutral["Draw.Location"].Frame.VX["@attributes"],Z=Q.Neutral["Draw.Location"].Frame.VY["@attributes"],q=new a.Vector3(parseFloat(j.X),parseFloat(j.Y),parseFloat(j.Z)),J=new a.Vector3(parseFloat(Z.X),parseFloat(Z.Y),parseFloat(Z.Z)),$=new a.Vector3(parseFloat(Y.X),parseFloat(Y.Y),parseFloat(Y.Z)),ee=W.getMatrixFromOVxVy($,q,J),te=d.QueryInterface("VCXIModelNavigable"),re=K.QueryInterface("VCXIModelNavigable");re&&te&&re.setParent(te);var ae=K.QueryInterface("W3AISGNodeHolder");if(ae){var oe=ae.getSGNode();oe.setMatrix(ee),oe&&(oe.setVisibility(!0),oe.setVisibilityInTree(!0),g.add(oe))}this._experienceBase.getManager("VCXDressupManager")._removeDressup(K)}if(!K){var ie=r;if((c=Q["@attributes"])&&(ie=ie+"."+c.Ident),K=this._experienceBase.ComponentsMap.GetComponentFromID(ie)){var ne=K.QueryInterface("VCXIModifiable"),se=this._experienceBase.getManager("VCXScenarioManager").GetNeutrals(ne.GetHashing());if(se){var le=se._map["Collab.Text.Font"]._propertyValue._value[1];le._value*=-1.769,se._map["Collab.Text.Font"]._propertyValue._value[1]=le}}}}break;default:for(z=0;z<U.length;z++)this.parseAnnotations(t,U[z],r,s.clone(),l)}}},parseDrawPolylineSW:function(e,t){var r=this.getNodes(e.CLitDrawPolyline);if(t){new Uint32Array(r.length);for(var i=[],s=0,l=0;l<r.length;l++){if(void 0!==(m=r[l])){var p=this.getActorCompositePmiArray(m,"points");if(null!==p){for(var u=new ArrayBuffer(4*p.length),c=new Float32Array(u),C=0;C<p.length;++C)c[C]=p[C];var d=new Uint8Array(u).toString();t=window.btoa(d);i.push(t)}}}return i}var g=new o;for(l=0;l<r.length;l++){var m;if(void 0!==(m=r[l])){var V,h=[],y=(s=0,this.getActorCompositePmiArray(m,"points"));if(null!==y){var f=this.getActorCompositePmiArray(m,"indices");if(null!==f){for(var S=0;S<y.length;S++)h[s++]=y[S];var v=new Float32Array(h.length);for(S=0;S<h.length;++S)v[S]=h[S];for(var b=h.length/3,P=D.allocIndexationArray(b,b),A=0;A<b;A++)P[A]=A;V=D.buildLineStripSet(v,f,P,new n.Color(0,0,0,1),1,"WIRE_EDGE");var X=m.Neutral["Draw.Location"]?m.Neutral["Draw.Location"].Frame:0;if(X&&X.Origin){var M,I=m.Neutral["Draw.Location"].Frame.Origin["@attributes"],w=m.Neutral["Draw.Location"].Frame.VX["@attributes"],L=m.Neutral["Draw.Location"].Frame.VY?m.Neutral["Draw.Location"].Frame.VY["@attributes"]:0,x=new a.Vector3(parseFloat(w.X),parseFloat(w.Y),parseFloat(w.Z)),F=new a.Vector3(parseFloat(I.X),parseFloat(I.Y),parseFloat(I.Z));if(L){var B=new a.Vector3(parseFloat(L.X),parseFloat(L.Y),parseFloat(L.Z));M=W.getMatrixFromOVxVy(F,x,B)}var _=m.Neutral["Draw.Location"].Frame.VZ?m.Neutral["Draw.Location"].Frame.VZ["@attributes"]:0;if(_){var T=new a.Vector3(parseFloat(_.X),parseFloat(_.Y),parseFloat(_.Z));M=W.getMatrixFromOVxVz(F,x,T)}V.setMatrix(M)}g.add(V)}}}}return g},getMatrixToAdjustVerticalforSWPMI:function(e){var t=new a.Vector3(1,0,0),r=new a.Vector3(0,1,0),o=new a.Vector3(0,0,1);switch(e){case 0:t.set(0,1,0),r.set(0,0,1),o.set(1,0,0);break;case 1:t.set(0,0,1),r.set(1,0,0),o.set(0,1,0);break;case 2:break;case 3:t.set(0,0,1),r.set(0,1,0),o.set(-1,0,0);break;case 4:t.set(1,0,0),r.set(0,0,1),o.set(0,-1,0);break;case 5:t.set(0,1,0),r.set(1,0,0),o.set(0,0,-1)}var i=new a.Matrix4;return i.makeBasis(t,r,o),i},parseAnnotations:function(e,t,r,a,o,i){var n=t["@attributes"];if(""===r?r=n.Ident:n&&(r=r+"."+n.Ident),o){var s=this._modifiableFactory.create(this._experienceBase,e,r,void 0);return this._v1ComponentType[r]=e,s&&n&&s.SetGUID(n.Ident),i&&i.AddComponent(s),s}var l=(s=this._experienceBase.ComponentsMap.GetComponentFromID(r))?s.QueryInterface("VCXIModifiable"):null;if(l){var p=null;if(t.ListActors&&(p=this.parseActorList(t.ListActors)),(t.Dynamic||t.ListIdAnchor||t.Neutral&&t.Neutral["Actor.Location"]&&!s.IsKindOf("VCXComponentGround")&&!s.IsKindOf("VCXSection_Spec"))&&this.generateAnchorsIdsArray(t),this.parseNeutrals(t,l,e,p),this.parseTracks(t,l,e),void 0!==t.CLitDigZoom){var u=t.CLitDigZoom;l.loadParentMode="DigZoom",this.parseNeutrals(u,l,e),this.parseTracks(u,l,e)}if(void 0!==t.CLitDigXRay){u=t.CLitDigXRay;l.loadParentMode="DigOnionSkin",this.parseNeutrals(u,l,e),this.parseTracks(u,l,e)}if(void 0!==t.CLitDigOnionSkin){u=t.CLitDigXRay;l.loadParentMode="DigXRay",this.parseNeutrals(u,l,e),this.parseTracks(u,l,e)}}},checkForLabelAndCallout:function(e,t){var r,a=e["@attributes"];if(a){var o=a.NetGuid,i=a.Ident;o?r=a.NetGuid:i&&(r=a.Ident)}var n=this._v1ComponentType[r];return("CLitTextMultiplePoints"===n||"CLitCalloutMP"===n)&&parseInt(t)>1002},generateAnchorsIdsArray:function(e){var t=[];if(e.ListIdAnchor&&e.ListIdAnchor.AnchorId)for(var r=e.ListIdAnchor.AnchorId,a=0;a<r.length;++a){var o=e.ListIdAnchor.AnchorId[a]["@attributes"].Id;t.push(parseInt(o))}else if(e.Dynamic&&e.Dynamic.Anchor&&e.Dynamic.Anchor["#text"]){var i=e.Neutral,n=e.Dynamic.Anchor["#text"].split("#");for(a=0;a<n.length;++a){0!==(o=n[a]).length&&i&&i["Anchor."+o]&&(parseInt(o)<1e3?t.push(parseInt(o)):this.checkForLabelAndCallout(e,o)&&t.push(parseInt(o)))}}else e.Neutral["Actor.Location"]&&t.push("Location");e.Neutral.ArrayAnchorsIds=t;var s=[];if(e.Dynamic&&e.Dynamic.Anchor2D&&e.Dynamic.Anchor2D["#text"]){for(i=e.Neutral,n=e.Dynamic.Anchor2D["#text"].split("#"),a=0;a<n.length;++a){0!==(o=n[a]).length&&i&&i["Anchor."+o]&&(parseInt(o)<1e3?s.push(parseInt(o)):this.checkForLabelAndCallout(e,o)&&s.push(parseInt(o)))}e.Neutral.Array2DAnchorsIds=s}},createCamera:function(){var e=this._modifiableFactory.create(this._experienceBase,"CLitCameraActor","CameraActorId",void 0);if(this._v1ComponentType.CameraActorId="CLitCameraActor",null!==e)return e},parseNavigator:function(e){this._vcxCamera=this.createCamera(),this._experienceBase.getManager("VCXContextManager").setActiveCamera(this._vcxCamera);var t=this._vcxCamera.QueryInterface("VCXIModifiable");this.parseNeutrals(e,t,"CLitNavigator"),this.parseTracks(e,t,"CLitNavigator")},parseNeutrals:function(e,t,r,a){var o=e.Neutral;if(void 0!==o){var i;i=Array.isArray(o)&&o.length>0?o[0]:o;var n=this._experienceBase.getManager("VCXScenarioManager"),s=n.GetNeutrals(t.GetHashing());s||(s=new l);e.Dynamic;if(i.ArrayAnchorsIds){var c=new y(i.ArrayAnchorsIds),C=new m("Collab.ListAnchorsIDs",0);s.AddOrModifyProperty(new p(C,c))}if(i.Array2DAnchorsIds){c=new y(i.Array2DAnchorsIds),C=new m("Collab.List2DAnchorsIDs",0);s.AddOrModifyProperty(new p(C,c))}var d=this;if(this._modifiableFactory.createPropertiesMap(t,this._experienceBase,i,this._resources,r).forEach(function(e,t){var r=t,a=e,o=!0,i=d._experienceBase.getManager("VCXContextManager").getOpenSMGXML();if(s.GetProperty(r)&&i&&(o=!1),o){var n=new m(r,0);s.AddOrModifyProperty(new p(n,a))}}),a){C=new m("Actor.ListActors",2);s.AddOrModifyProperty(new p(C,a))}var V=t.GetObject();if(V.IsKindOf("VCXDigger_Spec")){var h=new u;h.SetValue(0);C=new m("Actor.Opacity",0);s.AddOrModifyProperty(new p(C,h))}else if(V.IsKindOf("VCXViewport_Spec")){var f=new g;f.SetValue(!0);C=new m("Environment.BackFaceCulling",1);s.AddOrModifyProperty(new p(C,f))}n.AddNeutrals(t,s)}},parseTracks:function(e,t,r){var a=e.Tracks;if(void 0!==a)for(var o=this.getNodes(a.Track),i=0;i<o.length;i++)this.parseKeys(e,t,this.getNodes(o[i].Key),r)},parseKeys:function(e,t,r,a){if(0!==r.length){var o=new X(this._experienceBase.getManager("VCXScenarioManager"));o.SetLockEvents(!0),o.SetLockUpdateProperties(!0),o.SetCloneValues(!1);for(var i=this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario()],n=0;n<r.length;n++){if(!this._smgSceFileParsing&&e.Neutral.ArrayAnchorsIds)for(var s=e.Neutral.ArrayAnchorsIds,l=Object.keys(r[n]),p=0;p<l.length;++p){var c=l[p];if(c.startsWith("Anchor.")){var C=c.replace("Anchor.","");s.includes(C)}}this.parseKey(e,t,r[n],o,i,a)}if(t.GetObject().IsKindOf("VCXDigger_Spec")){var d=new u;d.SetValue(0);var g=d,m=o._keysForDo.length;for(n=0;n<m;n++){var V=o._keysForDo[n];if("Actor.Opacity"===V.propertyName){if(null!==g){var h=V.frame-1;h>=0&&o.ChangeKey(i,t,V.propertyName,h,g)}g=V.value}}}this._experienceBase.getManager("VCXCommandManager").Do(o)}},parseKey:function(e,t,r,a,o,i){var n=r["@attributes"].Time;this._modifiableFactory.createPropertiesMap(t,this._experienceBase,r,this._resources,i).forEach(function(e,r){var i=e;if(void 0!==i){var s=r,l=parseFloat(n);a.ChangeKey(o,t,s,l,i)}})},LoadScenarioAndViewFiles:function(e,t,r){var a=this;if(e&&t)(o=new FileReader).onload=function(e){var o=B.loadXMLString(e.target.result),i=B.xmlToJson(o);a.SetSMGViewFile(i);var n=new FileReader;n.onload=function(e){var t=B.loadXMLString(e.target.result),o=B.xmlToJson(t);a.SetSMGSceFile(o),r()},n.readAsText(t)},o.readAsText(e);else if(e||t){var o,i=null;e?i=e:t&&(i=t),(o=new FileReader).onload=function(o){var i=B.loadXMLString(o.target.result),n=B.xmlToJson(i);e?a.SetSMGViewFile(n):t&&a.SetSMGSceFile(n),r()},o.readAsText(i)}else r()},Load:function(e,t,r,a,o,i,n,s,l){var p=this;this.LoadScenarioAndViewFiles(i,n,function(){var t;r.has(p._smgXmlMasterFile)&&(t=r.get(p._smgXmlMasterFile)),p.SetSMGXMLs(r);var i=a?this.loadXMLDoc(window.URL.createObjectURL(t)):B.loadXMLString(t),n=B.xmlToJson(i);i=null,p._mapGeodes=o,p._resources=s,p._experienceBase=e,p._materialManager=e?e.getManager("VCXMaterialManager"):null,F.memoryLog("VCXSmgXmlLoader parseDocumentSMGXML",!0),p.parseDocumentSMGXML(n.DocumentSMG),F.memoryLog("VCXSmgXmlLoader parseDocumentSMGXML",!1),p._mapGeodes=null,p._resources=null,p._experienceBase=null,p._materialManager=null,p._modifiableFactory.clear(),p._modifiableFactory=null,l()})}});return N.ViewType={Views:"1",Layers:"2",CadViews:"3",CadCaptures:"4"},N.ViewCompressionV1={VisibleActors:"0",HiddenActors:"1",VisibleAssemblies:"2",HiddenAssemblies:"3"},N.unitsTranslation={Length:{0:"Micrometers",1:"Millimeters",2:"Centimeters",3:"Decimeters",4:"Meters",5:"Inches",6:"Feet",7:"Yards",8:"Kilometers"},Area:{0:"SquareMicrometers",1:"SquareMillimeters",2:"SquareCentimeters",3:"SquareDecimeters",4:"SquareMeters",5:"SquareInches",6:"SquareFeet",7:"SquareYards"},Volume:{0:"CubicMicrometers",1:"CubicMillimeters",2:"CubicCentimeters",3:"CubicDecimeters",4:"CubicMeters",5:"CubicInches",6:"CubicFeet",7:"CubicYards"},Angle:{0:"Degrees",1:"Radians",2:"Grades"}},N}),define("DS/VCXWebInteropSMG/VCXSmgLoader",["UWA/Class","DS/VCXWebIO/VCXFileServices","DS/VCXWebInteropSMG/VCXSmgGeomLoader","DS/VCXWebInteropSMG/VCXSmgXmlLoader","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebIO/VCXLogServices","DS/VCXWebKernel/VCXDRMManager","i18n!DS/VCXWebInteropSMG/assets/nls/VCXWebInteropSMG"],function(e,t,r,a,o,i,n,s){"use strict";return e.extend({init:function(){this._progressBar=null,this._experienceProgressCB=null,this._mapGeodes=new Map,this._smgXmlMasterFileName=null,this._smgXMLDataResources=null,this._geomSignaturesAwaited=0},hasExtension:function(e,t){return-1!==e.toLowerCase().indexOf(t,e.length-t.length)},sendErrorNotification:function(e,t,r){var a=s[r];e.getManager("VCXNotificationManager").addNotification({level:t,title:t,message:a})},LoadJsonForRightManager:function(e,t){if(e){var r=new FileReader;r.onload=function(){var e=r.result,a=JSON.parse(e);t(a)},r.readAsText(e)}else t(null)},LoadSmgGeomOutlines:function(e,t,a,o,i,n){if(!a||0>=a.length)n(null);else for(var s=0,l=new Map,p=0;p<a.length;p++){var u=new FileReader;u.onload=function(t){s++,new r(e).LoadOutlines(new Uint8Array(t.target.result),l),s===a.length&&n(l)},u.readAsArrayBuffer(a[p])}},LoadMultipleSmgGeom:function(e,t,a,o,i,s){if(a)for(var l=this,p=0,u=[],c=function(t,c){p++;var C=new r(e);C.setResources(i),C.setOutlines(o),C.launchsmgXMLCB=l.SignatureCB,C.smgLoader=l,!1===C.Load(new Uint8Array(c))&&l.sendErrorNotification(e,"error","Notification.GeomLoadingFailed"),l._progressBar?l._progressBar.update("50%"):l._experienceProgressCB&&l._experienceProgressCB({loaded:50,total:100}),C&&C.ulHasSignature&&C.ulAgreementMode!==n.LitSignatureMode.LIT_SIGNATURE_NO_DISPLAY&&(C._pause=!0),u.push(C),C.getMapGeodes().forEach(function(e,t){l._mapGeodes.set(t,e)}),p===a.length&&s(l,u)},C=0;C<a.length;C++){var d=new FileReader;d.onload=function(e){c(e.target.docID,e.target.result)},d.docID=a[C].name,d.readAsArrayBuffer(a[C])}else s(null)},CheckIfSignatureAndRightsFromGeomFiles:function(e,t){for(var r=!0,a=e.getManager("VCXDRMManager"),i=0;i<t.length;i++){var n=t[i];if(!n){r=!1;break}for(var s=0!==o.decodeOptions(n.ulWatermark,n.nTriangles),l=[],p=0;p<n.strFileNameAssociate.length;p++)l.push(n.strFileNameAssociate.charCodeAt(p));var u=o.calcCRC(l),c=o.decodeOptions(n.ulHasExpirationDate,u),C=o.decodeOptions(n.ulStartDate,u),d=o.decodeOptions(n.ulEndDate,u),g=Date.now()/1e3,m=!0;0!==c&&(m=g<d&&g>C);o.decodeOptions(n.ulSignatureCRC,u);for(var V=n.strAgreement,h=n.strSignaturePicturePath,y=n.ulAgreementMode,f=(0!==n.ulHasSignature?"1":"2")+": "+h+" ["+V+"]-"+(y+1),S=[],v=0;v<f.length;v++)S.push(f.charCodeAt(v));o.calcCRC(S);!0;var b=0!=(32&o.decodeOptions(n.ulOptionsPro,n.nTriangles));if(a.SetDisplayWatermark(s),console.log("[DRM MANAGER] Display watermark ? : "+(s?"YES":"NO")),a.SetValidDate(m),console.log("[DRM MANAGER] Has expiration date ? : "+(0!==c?"YES ":"NO ")),0!==c){var P=new Date(1e3*C),A=new Date(1e3*d);console.log("[DRM MANAGER] Date is valid ? : "+(m?"YES ":"NO ")+"- Start : "+P.toUTCString()+" - End : "+A.toUTCString())}if(a.SetDisplayTree(b),console.log("[DRM MANAGER] Show tree allowed ? "+(b?"YES":"NO")),a.SetValidSignature(!0),console.log("[DRM MANAGER] Valid signature ? : YES"),a.GetValidDate()||(this.sendErrorNotification(e,"warning","Notification.SmgExpiration"),r=!1),a.GetValidSignature()||(this.sendErrorNotification(e,"warning","Notification.SmgInvalidSignature"),r=!1),!r)break}return r},LoadSmgXml:function(e,t){if(this._smgXMLDataResources){var r=this._smgXMLDataResources.expBase,o=this._smgXMLDataResources.viewer,n=this._smgXMLDataResources.blobSmgXmls,s=this._smgXMLDataResources.blobViewFile,l=this._smgXMLDataResources.blobSceFile,p=this._smgXMLDataResources.resources;if(n&&e)if(this.CheckIfSignatureAndRightsFromGeomFiles(r,e)){var u=this;i.memoryLog("LoadSmgXml",!0);for(var c=0,C=new Map,d=function(e,d){if(c++,e=e.toLowerCase(),C.set(e,d),n.length===c){var g=new a;u._smgXmlMasterFileName=u._smgXmlMasterFileName.toLowerCase(),g.SetMasterFileName(u._smgXmlMasterFileName),g.Load(r,o,C,!1,u._mapGeodes,s,l,p,function(){var e=i.memoryLog("LoadSmgXml",!1);console.log("[PERFO] "+e.logName+" "+e.time),console.log("[PERFO] Heap "+e.heap),r.getManager("VCXExperience").OnEndLoading(!1),o.render({updateInfinitePlane:!0}),u._progressBar?u._progressBar.update("100%"):u._experienceProgressCB&&u._experienceProgressCB({loaded:100,total:100}),t()})}},g=0;g<n.length;g++){var m=new FileReader;m.onload=function(e){d(e.target.docID,e.target.result)},m.docID=n[g].name,m.readAsText(n[g])}}else t(null);else t(null)}else t(null)},SignatureCB:function(e,t){var r=t._smgXMLDataResources.expBase,a=t._smgXMLDataResources.cbLoadEnd,o=t._smgXMLDataResources.listsmgGeomLoaders;if(e){if(!e._pause){t._geomSignaturesAwaited--,e.getMapGeodes().forEach(function(e,r){t._mapGeodes.set(r,e)}),0===t._geomSignaturesAwaited&&t.LoadSmgXml(o,function(){a(r)})}}else t._progressBar?t._progressBar.off():t._experienceProgressCB&&t._experienceProgressCB({loaded:100,total:100}),a()},ValidateSignatureAndLoadXMLFiles:function(e,t){for(var r=0;r<t.length;r++){var a=t[r];a&&a._pause&&e._geomSignaturesAwaited++}0===e._geomSignaturesAwaited?e.LoadSmgXml(t,function(){var t=e._smgXMLDataResources.expBase;(0,e._smgXMLDataResources.cbLoadEnd)(t)}):e._smgXMLDataResources.listsmgGeomLoaders=t},LoadDataFiles:function(e,t,r,a){var o=this,i=[],n=[],s=[],l=null,p=null,u=null,c=[],C=e.getManager("VCXContextManager");C&&(C.getOpenSMGXML()||(C.setOpenSMG(),o._smgXmlMasterFileName="product.smgxml")),r.forEach(function(e,t){var r=t.slice(t.lastIndexOf(".")+1);r=r.toLowerCase();var a=o._smgXmlMasterFileName.slice(0,o._smgXmlMasterFileName.lastIndexOf("."));a=a.toLowerCase();var d=t.slice(0,t.lastIndexOf("."));if("product.smggeom"===t||"smggeom"===r)n.push(e),c[t]=URL.createObjectURL(e);else if("smgoutlines"===r)s.push(e);else if(o.hasExtension(t,".json"))l=e;else if(o.hasExtension(t,".smgxml")||o.hasExtension(t,".xml"))C.getOpenSMGXML()||(e.name="product.smgxml"),i.push(e);else if(o.hasExtension(t,".smgview"))C.getOpenSMGXML()?d===a&&(p=e):p=e;else if(o.hasExtension(t,".smgsce"))C.getOpenSMGXML()?d===a&&(u=e):u=e;else if(C.getOpenSMGXML()){var g=t.slice(t.lastIndexOf("."));d=t.slice(t.lastIndexOf("/")+1,t.lastIndexOf("."));c[d+g]=URL.createObjectURL(e)}else c[t]=URL.createObjectURL(e)}),o._progressBar?o._progressBar.update("0%"):o._experienceProgressCB&&o._experienceProgressCB({loaded:0,total:100});var d={};d.expBase=e,d.viewer=t,d.blobSmgXmls=i,d.blobViewFile=p,d.blobSceFile=u,d.resources=c,d.cbLoadEnd=a,this._smgXMLDataResources=d,o.LoadJsonForRightManager(l,function(r){var i=!0;if(r){var l=e.getManager("VCXDRMManager");l.SetDisplayTree("true"===r.RightManagement.ShowTree),l.SetDisplayWatermark("true"===r.DisplayWatermark),l.SetValidDate("true"===r.ExpirationOk),l.SetValidSignature("true"===r.ValidSignatureCRC),l.GetValidDate()||(o.sendErrorNotification(e,"warning","Notification.SmgExpiration"),i=!1),l.GetValidSignature()||(o.sendErrorNotification(e,"warning","Notification.SmgInvalidSignature"),i=!1)}i?o.LoadSmgGeomOutlines(e,t,s,c,r,function(r){n.length<=0&&o.sendErrorNotification(e,"warning","Notification.SmgGeomNotFound"),o.LoadMultipleSmgGeom(e,t,n,r,c,o.ValidateSignatureAndLoadXMLFiles)}):a(e)})},LoadFromArrayBuffer:function(e,r,a,o){var i=this;t.ExtractFromArchiveData(a,function(t){i.LoadDataFiles(e,r,t,o)},function(t){var r="File contains encrypted entry."===t?"Notification.SmgOpenFailedPassword":"Notification.SmgOpenFailed";i.sendErrorNotification(e,"error",r),o()})},Load:function(e,t,r,a){var o=this;i.memoryLog("VCXSmgLoader",!0,!0),this._progressBar?this._progressBar.update("0%"):o._experienceProgressCB&&o._experienceProgressCB({loaded:0,total:100});var n=new FileReader;n.onload=function(r){o.LoadFromArrayBuffer(e,t,r.target.result,a)},n.readAsArrayBuffer(r)}})}),define("DS/VCXWebInteropSMG/VCXSmgXMLExperienceLoader",["DS/VCXWebInteropSMG/VCXSmgLoader","DS/VCXWebIO/VCXFileServices","DS/VCXWebInteropSMG/VCXSmgLoaderTools"],function(e,t,r){"use strict";return e.extend({init:function(){this._progressBar=null,this._experienceProgressCB=null,this._mapGeodes=new Map,this._smgXmlMasterFileName=null,this._smgXMLDataResources=null,this._geomSignaturesAwaited=0,this._filesToTryAgain=[]},StartLoadingExperience:function(e,a,o,i){e.getManager("VCXContextManager").setOpenSMGXML();var n=window.location.origin,s=o;o.indexOf("://")>0||0===o.indexOf("//")||(s=r.RelativeToAbsolute(n,o));var l=s.slice(s.lastIndexOf(".")),p=s.slice(0,s.lastIndexOf("/")),u=s.slice(s.lastIndexOf("/")+1,s.lastIndexOf("."));this._smgXmlMasterFileName=u+l;var c=p+"/Resources.xml",C=new Map,d=this,g=function(){d.sendErrorNotification(e,"warning","Notification.smgXmlResourcesNotFound"),i()},m=function(t){var o=r.loadXMLString(t),n=r.xmlToJson(o).Resources.Resource,s={target:{}};s.target.files=[];var l=!1,u=function(t,r){for(var o=0;o<t.target.files.length;o++){var n=t.target.files[o],s=n.name;s=s.toLowerCase(),C.set(s,n)}d.LoadDataFiles(e,a,C,i),r&&d.sendErrorNotification(e,"warning","Notification.smgXmlSomeResourcesMissing")},c=function(e,t){0!==t.length&&d._filesToTryAgain.length!==t.length||(l=!0),d._filesToTryAgain=t,d.loadResourcesForSmgXml(e,t,p,u,c,l)};d.loadResourcesForSmgXml(s,n,p,u,c,l)};t.BlobURLToText(c,m,function(){c=p+"/"+u+"_Resources.xml",t.BlobURLToText(c,m,g)})},loadResourcesForSmgXml:function(e,r,a,o,i,n){var s=r.length,l=0,p=!1,u=[];if(n)return o(e,!0);for(var c=function(r,a){if(r){var c=t.dataURLToBlob(r);c.lastModifiedDate=new Date,c.name=a,e.target.files.push(c)}else u.push(a),p=!0;++l===s&&(!p||n?o(e,p):i(e,u))},C=0;C<s;C++){var d="",g=a;if(void 0!==(d=r[C]["@attributes"]&&r[C]["@attributes"].RelativePath?r[C]["@attributes"].RelativePath:r[C])&&""!==d){var m,V=0,h=0;if("."==d[V]){for(;"."==d[V]||"\\"==d[V]||"/"==d[V];)"\\"!=d[V]&&"/"!=d[V]||h++,V++;for(;h>0;)g=g.slice(0,g.lastIndexOf("/")),h--;d=d.slice(V+0)}m=g+"/"+d,t.BlobURLToBase64(m,"",c,d,c)}}}})});