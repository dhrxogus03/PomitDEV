define("DS/WebUtils/ProbesManager",["UWA/Class","DS/WebSystem/Environment","DS/WebSystem/Downloader"],function(t,e,n){"use strict";var i=!e.isSet("3DPlay.DisableProbes"),r="3DPlay_";"undefined"!=typeof widget&&widget.id&&(r=widget.id+"_3DPlay_");var s=[],o=0;return{createProbe:function(t,e,n){if(!i)return{begin:function(){},end:function(){},getTime:function(){}};var a={probeName:t,id:r+t,strMarkBegin:e||t+"_Begin_"+o,strMarkEnd:n||t+"_End_"+o,begin:function(){return window.performance.mark(this.strMarkBegin),this},end:function(){try{window.performance.mark(this.strMarkEnd),window.performance.measure(this.id,this.strMarkBegin,this.strMarkEnd)}catch(t){console.log(this.probeName,t)}},getTime:function(){var t=window.performance.getEntriesByName(this.id).pop();return t?Math.floor(t.duration):0}};if(e&&n)try{window.performance.measure(a.id,a.strMarkBegin,a.strMarkEnd)}catch(t){}return o++,s.push(a),a},createFunctionProbe:function(t,e,n){return i?(r="string"==typeof t?this.createProbe(t).begin():t,s=e,function(){r.end(),UWA.is(s,"function")&&s.apply(r,Array.prototype.slice.call(arguments)),r=null,s=null}):e;var r,s},createNetWorkProbe:function(t,e){var n=this.createProbe(t);return e.onComplete=this.createFunctionProbe(n,e.onComplete),e.onFailure=this.createFunctionProbe(n,e.onFailure),n},_parse:function(t){var e=0;for(e=s.length;e--;)if(s[e].probeName===t)return s[e];0===e&&console.error("Probe not found : ",t)},begin:function(t){var e=this.createProbe(t);return e.begin(),e},end:function(t){var e=this._parse(t);e&&e.end()},getTime:function(t){var e=this._parse(t);return e?e.getTime():0},GetProcessedData:function(t){var e,n,i=0,r=0,s=[],o="";if(t=t||{},"undefined"!=typeof widget&&widget.id&&(o=widget.id),window["3DPlay.ProbesManager.TopWindowNotAvailable"])e=window.performance.getEntriesByName(o+"clap"),Array.isArray(e)&&(e=e[0]),i=e.startTime;else{var a=window.top.performance.getEntriesByName(o+"clap");Array.isArray(a)&&(a=a[0]),e=window.performance.getEntriesByName(o+"clap"),Array.isArray(e)&&(e=e[0]),a&&e&&(i=e.startTime,r=a.startTime-e.startTime)}if(window.performance.getEntriesByType("measure").forEach(function(e){e.duration>2&&((!t.only3DPlay||e.name.indexOf("3DPlay")>-1)&&s.push({name:e.name,startTime:e.startTime,duration:e.duration}))}),t.cleanNames)for(n=0;n<s.length;n++){var u=s[n],h=u.name.split("3DPlay_");h.length>=2&&(h=h.slice(1),u.name=h.join("_"))}return{iframeTime:r,adjustTime:i,probes:s}},GetSubProbesFrom:function(t,e){e=void 0===e||e;var n=[];if(t){var i=window.performance.getEntriesByName(t.id).pop();if(i){var r=this.GetProcessedData({topWindow:!1,cleanNames:!0}),s=i.startTime,o=s+i.duration;r.probes.forEach(function(e){t.probeName!==e.name&&e.duration>2&&e.startTime>=s&&e.startTime+e.duration<=o&&(n[e.name]=Math.floor(e.duration+.5))})}}return n},dump:function(t,e){t=t?t+"_":"";var i=new Date,r=i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate()+"-"+i.getHours()+":"+i.getMinutes(),s=[];if(e)s=this.GetProcessedData({topWindow:!1,cleanName:!0,only3DPlay:!0});else{try{s=(s=window.top.performance.getEntriesByType("measure")).concat(window.top.performance.getEntriesByType("mark"))}catch(t){}s=(s=s.concat(window.performance.getEntriesByType("mark"))).concat(window.performance.getEntriesByType("measure"))}n("3DPlay.PCS_"+t+r+".json",new Blob([JSON.stringify(s)],{type:"text/plain"}))},cleanProbes:function(){s=[],window.performance.clearMeasures()}}}),define("DS/WebUtils/StringUtils",["UWA/Class"],function(t){"use strict";var e={fileExtension:/(?:\.([^./]+)(?:\.\d)?)?$/,urlprotocol:/(^[A-Za-z]+)\:\/\//,urlhostname:/(?:\:\/\/)(?=(.+)\:|\/)/,urlhostport:/(?:\:)(?=([0-9]+))/,rooturi:/(?:\:\/\/[^\/]+\/)(?=(.+))/,isInt:/^(\-|\+)?([0-9]+|Infinity)$/};return t.singleton({init:function(t){},sprintf:function(){for(var t=arguments[0],e=0,n=arguments.length-1;e<n;e++)t=t.replace("{"+e+"}",arguments[e+1]);return t},parseUrl:function(t){var n={},i=t.match(/^(^[A-Za-z]+)\:\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);if(i)n={protocol:i[1],host:i[2],hostname:i[3],port:i[4]?parseInt(i[4]):{http:80,https:443}[i[1]],pathname:i[5].substring(1),search:i[6],hash:i[7]};else{if(n.protocol=e.urlprotocol.exec(t),null===n.protocol||void 0===n.protocol)return null;n.protocol=n.protocol[1],n.hostname=e.urlhostname.exec(t),null!==n.hostname&&void 0!==n.hostname&&(n.hostname=n.hostname[1]),n.port=e.urlhostport.exec(t),null!==n.port&&void 0!==n.port&&(n.port=n.port[1]),n.pathname=e.rooturi.exec(t),null!==n.pathname&&void 0!==n.pathname&&(n.pathname=n.pathname[1])}if(n.pathname){var r=n.pathname.indexOf("/");n.rooturi=n.pathname.substring(0,r>-1?r:n.pathname.length)}return n},getExtension:function(t){if(null==t||""===t)return"";var n,i=t.indexOf("?")+1,r=t;i&&(r=t.substring(0,t.indexOf("?")));var s=e.rooturi.exec(r);return s=null!=s?s[1]:t,null!=(n=e.fileExtension.exec(s))&&(n=n[1]),null!=n?n:""},filterInt:function(t){return e.isInt.test(t)?Number(t):NaN}})}),define("DS/WebUtils/ContextedSingleton",["UWA/Class"],function(t){"use strict";return t.singleton({data:{},init:function(){},add:function(t,e,n){var i=this.data[t];void 0===i&&(i=this.data[t]={}),i[e]=n},get:function(t,e){var n=this.data[t];return void 0!==n?n[e]:n},remove:function(t,e){var n=this.data[t];return void 0!==n&&void 0!==n[e]&&(n[e].dispose&&n[e].dispose(),n[e]=null,delete n[e]),this},removeCtx:function(t){if(this.data[t]){for(var e in this.data[t])this.remove(t,e);delete this.data[t]}return this}})}),define("DS/WebUtils/EventDisposer",["DS/CoreEvents/Events","UWA/Class"],function(t,e){"use strict";return e.extend({init:function(t){this._parent(),this.arr=[]},add:function(t){return this.arr.push(t),this},dispose:function(){for(var e=this.arr.length;e--;)t.unsubscribe(this.arr[e]),this.arr[e]=null;this.arr=null}})}),define("DS/WebUtils/MemoryProfiler",["DS/WebSystem/DetectBrowser","DS/WebInfraUI/DOMGraph"],function(t,e){"use strict";var n={update:console.log},i=1e3,r={chrome:!0},s=1073741824,o=function(){setTimeout(o,i),n.update(Math.floor(window.performance.memory.usedJSHeapSize/s))};return function(a){a=a||{};var u=t();r[u.browser.name]&&window.performance.memory?(i=a.updateTime||i,s=a.size||s,n=a.output?a.output:new e({updateLegend:a.updateLegend||"Ko",name:a.name||"Memory",container:a.container?a.container:document.body,color:a.color||"f00",length:a.length||200,updateSize:!0}),o()):console.warn('Memory Profiling is only supported by chrome whith " --enable-precise-memory-info" option')}}),define("DS/WebUtils/State",["UWA/Class"],function(t){"use strict";var e=0;return t.extend({init:function(t){this.name=t.name||"undefined"+e++,this._restore=t.restore,this.getValue=t.getValue,this.initValue=t.getValue()},getValue:function(){},restore:function(){this._restore(this.initValue)},getInitialValue:function(){return this.initValue}})}),define("DS/WebUtils/FunctionDisposer",["UWA/Class"],function(t){"use strict";return t.extend({init:function(t){this._parent(),this.disposeFunctions=[]},add:function(t){this.disposeFunctions.push(t)},dispose:function(){for(var t=this.disposeFunctions.length;t--;)this.disposeFunctions[t]&&(this.disposeFunctions[t](),this.disposeFunctions[t]=null),delete this.disposeFunctions[t]}})}),define("DS/WebUtils/3DPlayState",["DS/CefCommunication/CefCommunication"],function(t){"use strict";return{isWebinWin:function(){return t.isAvailable()}}}),define("DS/WebUtils/Clock",[],function(){"use strict";function t(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}return t.prototype={constructor:t,start:function(){this.startTime=(performance||Date).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running&&this.start(),this.running){var e=(performance||Date).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}},t}),define("DS/WebUtils/GraphicOption",["UWA/Class"],function(t){"use strict";return t.extend({init:function(t){this.name=t.name,this.settingName=t.settingName,this.defaultValue=t.defaultValue,this.nlsTitle=t.nlsTitle,this.enabled=!0,this.available=!0,this.viewer=t.viewer},enable:function(){this.enabled=!0,this.activateFunc(!0)},disable:function(){this.enabled=!1,this.activateFunc(!1)},refreshAvailability:function(){this.available=this.getCurrentState(),this.enabled=this.available},activateFunc:function(t){},getCurrentState:function(){return!0}})}),define("DS/WebUtils/Profiler",["UWA/Class"],function(t){"use strict";var e=function(){return(new Date).getTime()};function n(t,i,r){this.father=i,this.name=t,this.startTime=this.stopTime=0,this.path=i?i.path:"",this.path+=t+"/",this.addProfile=function(t,e){this.children=this.children||{};var i=this.children[t];return i||(i=new n(t,this),this.children[t]=i),i.start()},this.addProfileFromObject=function(t){var e=this.addProfile(t.name);return e.startTime=t.startTime,e},this.stop=function(t){0===this.stopTime&&(this.stopTime=e());var n=this.stopTime-this.startTime;return t&&this.father&&this.father.stop(!0),n},this.start=function(){return this.stopTime=0,this.startTime=e(),this},this.getTime=function(){return(0===this.stopTime?e():this.stopTime)-this.startTime},this.isStopped=function(){return 0!==this.stopTime},this.dumpAsJSON=function(){var t=this.isStopped()?this.getTime():-1;if(this.children){t={time:t};var e=this.children;for(var n in e)t[n]=e[n].dumpAsJSON()}return t},this.getPath=function(){return this.path},this.dispose=function(){if(this.name=null,this.path=null,this.father=null,Array.isArray(this.children))for(var t=0;t<this.children.length;t++)this.children[t].dispose();this.children=null}}return t.singleton({Profiles:{},_searchNode:function(t,e,i){var r;if(-1!=t.indexOf("/")){var s=t.split("/"),o=s.shift();(r=e&&e.children?e.children[o]:this.Profiles[o])||(e?r=e.addProfile(o):i&&(r=new n(o),this.Profiles&&(this.Profiles[o]=r))),r&&s.length>0&&(r=this._searchNode(s.join("/"),r,i))}else e?(e.children&&(r=e.children[t]),!r&&i&&(r=e.addProfile(t))):r=this.Profiles[t];return r},init:function(t){},start:function(t,e){var i=this._searchNode(t,void 0,!0);return i||(i=new n(t),this.Profiles[t]=i),i.start()},stop:function(t,e){var n=this._searchNode(t,void 0,!1);return void 0!==n?n.stop(e):(console.warn("[PROFILER] unknown profile :",t),-1)},getTime:function(t){var e=this._searchNode(t,void 0,!1);return void 0!==e?e.getTime():(console.warn("[PROFILER] unknown profile :",t),-1)},dumpAsJSON:function(){var t={},e=this.Profiles;for(var n in e)t[n]=e[n].dumpAsJSON();return t}})}),define("DS/WebUtils/Logger",["DS/WebSystem/Environment","DS/Logger/Logger"],function(t,e){"use strict";return function(n,i){var r=e.getLogger(n);return r.setLevel(i&&t.isSet(i)||t.isSet("3DPlay.Debug")?"log":"warn"),r}}),define("DS/WebUtils/PhaseProgress",["UWA/Class","DS/WebInfraUI/Progress"],function(t,e){"use strict";return t.extend({init:function(t){this.progressBarDivision=0,this.subProgressArray=[0],this._MaxValue=100,this.progress=new e(t)},registerSubProgress:function(){return this.progressBarDivision++,this.subProgressArray[this.progressBarDivision]=0,this.progressBarDivision},registerMultipleSubProgress:function(t){for(var e=[],n=0;n<t;++n)e.push(this.registerSubProgress());return e},getSubProgressDivisions:function(){return this.progressBarDivision},resetProgress:function(){this._OldValue=0,this._CurrentValue=0,this.progressBarDivision=0,this.subProgressArray=[0]},dispose:function(){this.resetProgress(),this.progressBarDivision=void 0,this.subProgressArray=[],this._MaxValue=void 0,this.progress.dispose()},advanceToMax:function(t){t&&this.setAbsoluteProgress(t,this._MaxValue)},setAbsoluteProgress:function(t,e){t&&t<=this.progressBarDivision&&(e<=100&&(this.subProgressArray[t]=e),this._advance())},setIncrementalProgress:function(t,e){t&&t<=this.progressBarDivision&&(this.subProgressArray[t]+e<=100&&(this.subProgressArray[t]+=e),this._advance())},setIndeterminateState:function(){this.progress.updateProgression(-1)},showProgressBar:function(){this.progress.visible()},hideProgressBar:function(){this.progress.hide()},getProgressBarState:function(){return this.progress.getProgressBarState()},addProgressBarIntoUI:function(t){t.appendChild(this.progress.getContent())},_getProgress:function(){return{loaded:this._CurrentValue,total:this._MaxValue}},_advance:function(){var t=0;this.subProgressArray.forEach(function(e){0!==e&&(t+=e)}),t/=this.progressBarDivision,this._CurrentValue=t,this._CurrentValue-this._OldValue>=0?(this._OldValue=this._CurrentValue,this._updateProgressBar(),this.onAdvance&&this.onAdvance(this._getProgress())):this._CurrentValue-this._MaxValue>.001&&console.error("[3DPlay/PhaseProgress] _CurrentValue > _MaxValue ("+this._CurrentValue+" > "+this._MaxValue+")")},_updateProgressBar:function(){this.progress.updateProgression(this._CurrentValue)},_CurrentValue:0,_OldValue:0})}),define("DS/WebUtils/XMPFile",["UWA/Class"],function(t){"use strict";var e=function(t){return 256*t.charCodeAt(0)+t.charCodeAt(1)};return t.extend({getHeader:function(){throw"BaseClass"},getMarker:function(){throw"BaseClass"},init:function(t){this.segments=[]},splitIntoSegments:function(t){var n=this.getHeader();if(t.slice(0,2)!=n)throw"Given data isn't valid";var i=2;for(this.segments.push(n);;){if(t.slice(i,i+2)==this.getMarker()){this.segments.push(t.slice(i));break}var r=t.slice(i+2,i+4),s=i+e(r)+2;if(this.segments.push(t.slice(i,s)),(i=s)>=t.length)throw"Wrong data."}},mergeSegments:function(){return this.segments.join("")},getXMP:function(){for(var t=0;t<this.segments.length;t++){var e=this.segments[t];if("ÿá"==e.slice(0,2))if("http://ns.adobe.com/xap/1.0/"===e.slice(4,4+"http://ns.adobe.com/xap/1.0/".length))return this.segments[t]}return null},setXMP:function(t){var e,n="ÿá"+(e="http://ns.adobe.com/xap/1.0/".length+t.length+2+1,String.fromCharCode(Math.floor(e%65536/256))+String.fromCharCode(e%256))+"http://ns.adobe.com/xap/1.0/\0"+t;if(this.getXMP())for(var i=0;i<this.segments.length;i++){var r=this.segments[i];if("ÿá"==r.slice(0,2))"http://ns.adobe.com/xap/1.0/"===r.slice(4,4+"http://ns.adobe.com/xap/1.0/".length)&&(this.segments[i]=n)}else this.segments.splice(3,0,n)},getExtendedXMP:function(){},filterXMP:function(t){var e=t.replace(/\n/g,"").trim().match(/(<\?xpacket.*<\?xpacket.*\?>)/g);if(!e.length)throw new Error("Cannot find <xpacket> element in XMP");return e[0]}})}),define("DS/WebUtils/JPEGFile",["DS/WebUtils/XMPFile","DS/WebSystem/DataUrlTools"],function(t,e){"use strict";return t.extend({getHeader:function(){return"ÿØ"},getMarker:function(){return"ÿÚ"},init:function(t){this._parent(t)},readFile:function(t,e){var n=this,i=new FileReader;i.onload=function(t){n.load.apply(n,[{onSuccess:e,data:t.target.result}]),n=null},i.readAsDataURL(t)},load:function(t){if(t)if(t.file)this.readFile(t.file,t.onSuccess);else if(t.arrayBuffer)this.readFile(new Blob([t.arrayBuffer],{type:"image/jpeg"}),t.onSuccess);else if(t.data){var e,n=t.data;if("string"!=typeof n)throw"'load' gots invalid type argument.";if("ÿØ"==n.slice(0,2))e=n;else if("data:image/jpeg;base64,"==n.slice(0,23))e=atob(n.split(",")[1]);else if("data:image/jpg;base64,"==n.slice(0,22))e=atob(n.split(",")[1]);else{if("Exif"!=n.slice(0,4))throw"'load' gots invalid file data.";e=n.slice(6)}this.splitIntoSegments(e),t.onSuccess&&t.onSuccess(this)}},save:function(){var t=this.mergeSegments(),n="data:image/jpeg;base64,"+btoa(t);return e.toBlob(n)}})}),define("DS/WebUtils/JPEG",["DS/WebUtils/JPEGFile"],function(t){"use strict";var e=function(e,n,i){var r=new t;r.load({data:e.data,arrayBuffer:e.arrayBuffer,url:e.url,onSuccess:function(t){var e,s;try{e=r.getXMP()}catch(t){i(t)}try{e=r.filterXMP(e)}catch(t){console.warn(t),n(!1)}e&&((s=e).match(/<GPano:[a-zA-Z]*>/g)&&!s.match(/<GPano:UsePanoramaViewer>False<\/GPano:UsePanoramaViewer>/))?(!function(t){return!!t.match(/GPano:ProjectionType>equirectangular/)}(e)?n({type:"unknown"}):n({type:"equirectangular"}),n(!0)):n(!1)}.bind(this)})};return{checkImageIs360:function(t){return new Promise(function(n,i){!function(t,n,i){if(t.data||t.arrayBuffer)e(t,n,i);else if(t.url){var r=new XMLHttpRequest;r.onload=function(t){e({file:t.currentTarget.response},n,i)}.bind(this),r.onerror=function(t){i(t)},r.open("GET",url,!0),r.responseType="blob",r.send()}else i(new Error("Cannot find data, arrayBuffer or url in given options."))}(t,n,i)})}}}),define("DS/WebUtils/Vector2",["UWA/Class"],function(t){"use strict";return t.extend({init:function(t,e){this.x=t||0,this.y=e||0},set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampLength:function(t,e){var n=this.length();return this.multiplyScalar(Math.max(t,Math.min(e,n))/n)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},distanceToManhattan:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.multiplyScalar(t/this.length())},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e){return this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*n-s*i+t.x,this.y=r*i+s*n+t.y,this}})}),define("DS/WebUtils/Tracker",["UWA/Class","DS/WebUtils/Logger","DS/Usage/TrackerAPI","DS/WebUtils/Profiler","DS/WebSystem/Environment"],function(t,e,n,i,r){"use strict";var s,o,a="3DPlay",u=r.isSet("3DPlay.Tracker.ProbesChecker")?"-probesChecker":"",h="X3DPLAW_AP",l=e("3DPlay.Tracker","3DPlay.Log.Tracker"),c=Date.now(),f=0;return{scenario:function(t){this.trackPageEvent("commands","scenario",t,void 0,{count:this.incCommandCounter()})},command:function(t,e){this.trackPageEvent("commands","command",t,e||void 0,{count:this.incCommandCounter()})},startCommand:function(t){i.start(t)},endCommand:function(t){this.command(t,Math.floor(i.stop(t)/1e3))},resetCommandCounter:function(){f=0},incCommandCounter:function(){return s||o||f++,f},trackPageEvent:function(t,e,i,r,f,d,p){var m,g={pd1:"undefined"!=typeof widget?widget.id:"default-widget-id"},y={pv1:Math.floor((Date.now()-c)/1e3)},v=1;if(f)for(var x in f)f.hasOwnProperty(x)&&void 0!==f[x]&&(p?v=p[x]:v++,v&&(g["pd"+v]=x,y["pv"+v]=f[x]));"undefined"!=typeof widget&&(m=widget.getValue("x3dPlatformId")),!m&&d&&(m=d);var b={};b.eventCategory=a+"-"+t+u,b.eventAction=e,b.eventLabel=i,b.eventValue=r,b.persDim=g,b.appID=h,b.tenant=m,b.persVal=y,s||o?s&&(s=!1):(n.trackPageEvent(b),l.log(b))},disableNext:function(){s=!0},pause:function(t){o=t},setAppInfos:function(t){a=t.Prefix,h=t.appId}}}),define("DS/WebUtils/Statistics",["UWA/Class","DS/WebUtils/Profiler","DS/WebSystem/Environment","UWA/Class","DS/WebSystem/FpsInfo","DS/Controls/TreeBase","DS/Controls/TreeNodeBase","DS/WebInfraUI/DOMGraph","DS/WebUtils/MemoryProfiler","DS/WebUtils/ProbesManager"],function(t,e,n,i,r,s,o,a,u,h){"use strict";var l="";return i.extend({updateProfile:function(t){if(this.UpdateProbes){this.UpdateProbes=!1;var e=this.tree.getNthRoot(0),i=h.GetProcessedData({topWindow:"full"===n.get("3DPlay.Statistics"),cleanNames:!0,only3DPlay:"full"!==n.get("3DPlay.Statistics")});if(e._children)for(;e._children&&e._children.length;)e.removeChild(e._children[0]);for(var r=function(t,e){var n;if(t._children)for(var i=0;i<t._children.length;i++){var s=t._children[i];if(e.startTime>=s.options.probeModel.startTime&&e.startTime+e.duration<=s.options.probeModel.startTime+s.options.probeModel.duration){n=s;var o=r(s,e);o&&(n=o)}}return n},s=0;s<i.probes.length;s++){var a=i.probes[s],u=(d=a).name+": "+Math.floor(d.startTime+.5)+" | "+Math.floor(d.duration+.5),l=r(e,a);l?u+=" ("+Math.floor(.5+100*a.duration/l.options.probeModel.duration)+"%)":l=e,l.addChild(new o({label:u,probeModel:a}))}if(!document.getElementById("iframedelay")){var c="undefined"!=typeof widget&&"X3DPLAW_AP"!==widget.getValue("appId")?widget.getValue("appId"):"WAFR",f=document.createElement("div");f.id="iframedelay",f.innerHTML="Time in 3DDashBoard before Widget creation : "+Math.floor(i.iframeTime)+"<br> Time in "+c+" : "+Math.floor(i.adjustTime),this.tree.getContent().insertBefore(f,this.tree.getContent().firstChild)}e.expandAll()}var d},preProcess:function(){},postProcess:function(){var t=(new Date).getTime();if(this.frames++,this.totalFrames++,t>this.prevTime+this.updatetime){var e=Math.round(1e3*this.frames/(t-this.prevTime));this.fpsInfo.min>e?this.fpsInfo.min=e:this.fpsInfo.max<e&&(this.fpsInfo.max=e),this.fpsInfo.avg=1e3*this.totalFrames/(t-this.first),this.fpsHistory.length>this.history-1&&this.fpsHistory.shift(),this.fpsHistory.push(e);var n=Math.min(this.fpsHistory.length,this.history);this.fpsInfoHistory.clear();for(var i=0;i<n;i++){var r=this.fpsHistory[i];this.fpsInfoHistory.avg+=r,this.fpsInfoHistory.min>r?this.fpsInfoHistory.min=r:this.fpsInfoHistory.max<r&&(this.fpsInfoHistory.max=r)}this.fpsInfoHistory.avg=Math.round(this.fpsInfoHistory.avg/n),this.fpsGraph.update(e),this.frames=0,this.prevTime=t,this.hidden()||(l="FPS:"+e+" ("+this.fpsInfo.toString()+") history ("+this.fpsInfoHistory.toString()+")",this.tree.getNthRoot(0).elements.label.innerText="=> Task : Start time from 3DPlay Entry point | duration time",this.updateProfile())}},clearHistory:function(){this.fpsInfo=new r,this.fpsInfoHistory=new r;for(var t=history;t--;)this.fpsGraph.update(fps);this.fpsHistory=[],this.totalFrames=0,this.frames=0,this.startTime=(new Date).getTime(),this.prevTime=this.startTime,this.first=this.startTime,this.frameduration=this.startTime,this.frames=0,this.totalFrames=0},visibility:function(t){this.stats.style.display=t?"block":"none"},show:function(){this.visibility(!0)},hide:function(){this.visibility(!1)},hidden:function(){return"none"==this.stats.style.display},dispose:function(){this.hide(),this.fpsGraph.dispose(),this.fpsGraph=null,this.cleanDiv(),this.container=null,this.stats.empty&&this.stats.empty(),this.stats=null},cleanDiv:function(){try{this.container.removeChild(this.stats)}catch(t){}},set:function(t){this.container!=t.container&&(this.container=t.container,this.cleanDiv(),this.container.appendChild(this.stats))},init:function(t){this.UpdateProbes=!1,t=t||{},this.clearHistory(),this.updatetime=void 0!==t.updatetime?t.updatetime:200;var e=n.get("Statistics.updateTime");e&&(this.updatetime=parseInt(e)),this.historySecond=void 0!==t.historySecond?t.historySecond:50,this.history=void 0!==t.history?t.history:1e3*this.historySecond/this.updatetime,(e=n.get("Statistics.history"))&&(this.history=parseInt(e));this.stats=document.createElement("div"),this.stats.id="statistics",this.stats.style.cssText="top:25px;left:25px;position:absolute;height:100%",document.getElementById("Memory")||u({container:this.stats,length:this.history,updateTime:this.updatetime,size:1048576,updateLegend:"Mo"}),this.fpsGraph=new a({name:"FrameRate",container:this.stats,color:"0b5",length:this.history,caption:function(){return l}}),this.stats.appendChild(this.fpsGraph.getContainer()),this.tree=new s,this.tree.getContent().setStyles({minHeight:400,top:0,left:0,position:"relative",opacity:.8}),this.tree.addRoot({label:"Root"}),this.tree.inject(this.stats),this.hide();var i=this;document.addEventListener("keydown",function(t){222==t.keyCode&&(i.hidden()?i.show():i.hide())},!1),setTimeout(function(){i.show()},10),this._parent({name:"Statistics"})}})}),define("DS/WebUtils/GeometryUtils",["DS/WebUtils/Vector2"],function(t){"use strict";return{convexHullCompute:function(t){for(var e=t.slice().sort(function(t,e){return t.x==e.x?t.y-e.y:t.x-e.x}),n=[],i=0;i<e.length;i++){for(;n.length>=2&&this._leftTurn(n[n.length-2],n[n.length-1],e[i]);)n.pop();n.push(e[i])}n.pop();var r=n.length+2;for(i=e.length-1;i>=0;i--){for(;n.length>=r&&this._leftTurn(n[n.length-2],n[n.length-1],e[i]);)n.pop();n.push(e[i])}return n.pop(),n},boundingBoxCompute:function(e){for(var n=Number.MAX_VALUE,i=[],r=[],s=0,o=0,a=0,u=0,h=0;h<e.length;h++)r.push(e[(h+1)%e.length].clone().sub(e[h]).normalize()),e[h].x<e[s].x&&(s=h),e[h].x>e[o].x&&(o=h),e[h].y<e[u].y&&(u=h),e[h].y>e[a].y&&(a=h);var l=new t(-1,0),c=new t(0,-1);for(h=0;h<e.length;h++){var f=[c.dot(r[s]),-c.dot(r[o]),l.dot(r[a]),-l.dot(r[u])];switch(f.indexOf(Math.max.apply(Math,f))){case 0:(l=r[s].clone()).set(l.y,-l.x),s=(s+1)%e.length;break;case 1:(l=r[o].clone().negate()).set(l.y,-l.x),o=(o+1)%e.length;break;case 2:l=r[a].clone(),a=(a+1)%e.length;break;case 3:l=r[u].clone().negate(),u=(u+1)%e.length}(c=l.clone().negate()).set(c.y,-c.x);var d=this._intersection(e[s],c,e[a]),p=this._intersection(e[o],c,e[a]),m=this._intersection(e[u],l,e[s]),g=this._intersection(e[u],l,e[o]),y=d.distanceTo(p)*d.distanceTo(m);y<n&&(i=[d,m,g,p],n=y)}return i},isIntersect:function(t,e){for(var n=0;n<t.length;n++)for(var i=0;i<e.length;i++)if(this._intersect(t[n],t[(n+1)%t.length],e[i],e[(i+1)%e.length]))return!0;return!1},isOverlap:function(t,e){var n=this.isIntersect(t,e);return!1===n&&(this._isInsidePolygon(t[0],e)&&(n=!0),this._isInsidePolygon(e[0],t)&&(n=!0)),n},getCurveLength:function(t){for(var e=0,n=0;n<t.length-1;n++)e+=t[n+1].clone().sub(t[n]).length();return e},getTopLeftPoint:function(e){new t(9999,9999);for(var n=9999,i=9999,r=0;r<e.length;r++)e[r].x<n&&(n=e[r].x),e[r].y<i&&(i=e[r].y);return new t(n,i)},getBarycenter2D:function(e){for(var n=new t,i=0;i<e.length;i++)n.x+=e[i].x,n.y+=e[i].y;return n.x/=e.length,n.y/=e.length,n},getBarycenter:function(t){for(var e={x:0,y:0,z:0},n=0;n<t.length;n++)e.x+=t[n].x,e.y+=t[n].y,e.z+=t[n].z;return e.x/=n,e.y/=n,e.z/=n,e},_isInsidePolygon:function(t,e){for(var n=0,i=0;i<e.length;i++)e[i].y<=t.y?e[(i+1)%e.length].y>t.y&&this._isLeft(e[i],e[(i+1)%e.length],t)&&n++:e[(i+1)%e.length].y<=t.y&&(this._isLeft(e[i],e[(i+1)%e.length],t)||n--);return!(0==n)},_isnearPolygon:function(t,e,n,i){var r=6;i&&(r=i),r/=n;for(var s=0;s<e.length;s++){var o=t.x-e[s].x,a=t.y-e[s].y;if(Math.sqrt(o*o+a*a)<r)return!0}return!1},_leftTurn:function(t,e,n){return(e.x-t.x)*(n.y-e.y)-(e.y-t.y)*(n.x-e.x)<=0},_isLeft:function(t,e,n){return(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)>=0},_intersect:function(t,e,n,i){return(this._isLeft(t,n,i)?1:0)^(this._isLeft(e,n,i)?1:0)&&(this._isLeft(n,t,e)?1:0)^(this._isLeft(i,t,e)?1:0)},_intersection:function(e,n,i){var r=((e.x-i.x)*n.x-(i.y-e.y)*n.y)/(-n.x*n.x-n.y*n.y);return new t(e.x+r*n.x,e.y+r*n.y)},_checkEqual:function(t,e){return Math.abs(e-t)<=.1},wrapText:function(t){var e=t.canvasCtx,n=t.text,i=t.width,r=t.height,s=[],o=0;if(!e){var a=document.createElement("canvas");a.width=i,a.height=r,(e=a.getContext("2d")).font=t.font}for(var u=n.split("\n"),h=0;h<u.length;h++){for(var l="",c="",f=u[h].split(" "),d=0;d<f.length;d++){var p=d<f.length-1?f[d]+" ":f[d],m=Math.max(e.measureText(f[d]).width,Math.abs(e.measureText(f[d]).actualBoundingBoxLeft)+Math.abs(e.measureText(f[d]).actualBoundingBoxRight));if(m<=i||this._checkEqual(m,i)){if(c+=p,(y=Math.max(e.measureText(c).width,Math.abs(e.measureText(c).actualBoundingBoxLeft)+Math.abs(e.measureText(c).actualBoundingBoxRight)))<=i||this._checkEqual(y,i))l=c;else s.push(l),o=(v=Math.max(e.measureText(l).width,Math.abs(e.measureText(l).actualBoundingBoxLeft)+Math.abs(e.measureText(l).actualBoundingBoxRight)))>o?v:o,l=c=c.substring(l.length)}else{if(l.length>0)s.push(l),o=(v=Math.max(e.measureText(l).width,Math.abs(e.measureText(l).actualBoundingBoxLeft)+Math.abs(e.measureText(l).actualBoundingBoxRight)))>o?v:o,c=c.substring(l.length),l="";for(var g=0;g<p.length;g++){var y;if(c+=p[g],(y=Math.max(e.measureText(c).width,Math.abs(e.measureText(c).actualBoundingBoxLeft)+Math.abs(e.measureText(c).actualBoundingBoxRight)))<=i||this._checkEqual(y,i))l=c;else s.push(l),o=(v=Math.max(e.measureText(l).width,Math.abs(e.measureText(l).actualBoundingBoxLeft)+Math.abs(e.measureText(l).actualBoundingBoxRight)))>o?v:o,l=c=c.substring(l.length)}}}var v;s.push(l),o=(v=Math.max(e.measureText(l).width,Math.abs(e.measureText(l).actualBoundingBoxLeft)+Math.abs(e.measureText(l).actualBoundingBoxRight)))>o?v:o}return{wrappedLines:s,width:o}}}}),define("DS/WebUtils/Network",["DS/WAFData/WAFData","DS/WebUtils/ProbesManager","DS/WebUtils/Logger","DS/WebSystem/Environment"],function(t,e,n,i){"use strict";var r=n("DS/WebUtis/Network","3DPlay.Log.Network"),s={_updateOptions:function(t){t.timeout||(t.timeout=6e5)},_createContext:function(t,n,s,o){this._updateOptions(s);var a,u,h,l,c=i.isSet("3DPlay.Log.Network"),f=e.createNetWorkProbe(o,s);f.begin(),s.onComplete=(a=s.onComplete,u=s.onStatistics,function(e){var i=f.end();c&&r.log(s.method,":",n," duration:",i," data:",s.data," header:",s.headers," Response:",e),t.stats&&u&&(t.stats.time=i,u(t.stats),u=null),a(e),n=null,s=null,a=null,t=null}),s.onFailure=(h=s.onFailure,function(e){r.error(s.method,":",n," duration:",f.end()," data:",s.data," header:",s.headers," Response:",e),h&&h(e),n=null,s=null,h=null,t=null}),s.onCancel=function(){s.onCancel;return function(e){r.error(s.method,":",n," duration:",f.end()," data:",s.data," header:",s.headers," Response:",e),onCancel&&onCancel(e),n=null,s=null,onCancel=null,t=null}}(),s.onTimeout=function(e,n){var i=s.onTimeout;return function(n){r.error(s.method,":",e," duration:",f.end()," data:",s.data," header:",s.headers," Response:",n),i&&i(n),e=null,s=null,i=null,t=null}}(),s.onProgress=(l=s.onProgress,function(e){l&&l(e),t.stats=t.stats||{},t.stats.DownloadSize=e.total,0===t.stats.DownloadSize&&(t.stats.DownloadSize=e.loaded)})},authenticatedRequest:function(e,n,i){this._createContext({},e,n,i||"authenticatedRequest"),t.authenticatedRequest(e,n)},handleRequest:function(e,n,i,r){this._createContext({},e,n,i||"handleRequest"),r?t.handleRequest_HOOKED(e,n):t.handleRequest(e,n)},hookNetwork:function(t){this.functionHandler=t,this.hookhandleRequest()},hookhandleRequest:function(){t.handleRequest_HOOKED||(t.handleRequest_HOOKED=t.handleRequest,t.handleRequest=function(e,n){var i,r,o=s.functionHandler&&s.functionHandler(e);o?(s.functionHandler=null,o.onStatistics&&(n.onStatistics=o.onStatistics),o.onProgress&&(n.onProgress=(r=n.onProgress,function(t){r&&r(t),o.onProgress(t)})),n.onComplete=(i=n.onComplete,function(){o.onComplete(),i.apply(null,Array.prototype.slice.call(arguments)),i=null,o=null}),s.handleRequest(e,n,o.id,!0)):t.handleRequest_HOOKED(e,n)})},disableHook:function(){t.handleRequest_HOOKED&&(t.handleRequest=t.handleRequest_HOOKED,delete t.handleRequest_HOOKED)}};return s.hookhandleRequest(),s}),define("DS/WebUtils/WebServices",["DS/WebUtils/Network","DS/WebUtils/ProbesManager","DS/WebUtils/Logger","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/WebSystem/Environment","DS/WAFData/WAFData"],function(t,e,n,i,r,s){"use strict";var o,a=n("DS/WebUtis/WebServices","3DPlay.Log.WebServices"),u={url:"/cvservlet/fetch/v2",method:"POST"},h={url:"/resources/modeler/pno/person?current=true&select=preferredcredentials&select=collabspaces",method:"GET"},l={url:"/resources/AppsMngt/user/preference",method:{get:"GET",put:"PUT"}},c={getSecurityContext:function(e){return o||(o=new Promise(function(t){require([].concat("DS/PADUtils/PADSecurityCtxConverter"),t)})),new Promise(function(n,i){function s(){console.error(arguments)}if(!e)return s("Tenant is missing"),void i();c.getServiceUrl({serviceName:"3DSpace",platformId:e,onError:s,onSuccess:function(i){t.authenticatedRequest(i.url+h.url+"&tenant="+e,{timeout:6e6,onComplete:function(t){o.then(function(e){var i=e.prepareForStorage(JSON.parse(t));r.set("PreferredCredentials",i.securityContext),r.set("securityContext",i.cspaces),n(i.securityContext)})},onCancel:s,onFailure:s,onTimeout:s,method:h.method,headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":"en"}},"Person")}})})},getTenant:function(t){var e="OnPremise";if(t=t||"undefined"!=typeof widget&&widget.uwaUrl){var n=t.indexOf("-");n>-1&&(e=t.substring(t.indexOf("://")+3,n).toUpperCase())}return e},getPlatformServices:function(t){e.createNetWorkProbe("i3DXCompassPlatformServices.getPlatformServices",t).begin(),i.getPlatformServices(t)},getServiceUrl:function(t){var n=t.logger?t.logger:a;if(t.onError){if(!t.onSuccess)return n.error("onSuccess required"),void t.onError();if(!t.serviceName)return n.error("serviceName required"),void t.onError();t.onSuccess=e.createFunctionProbe("getServiceURL",t.onSuccess),i.getPlatformServices({platformId:t.platformId,onComplete:function(e){var n;if(e)if(Array.isArray(e)){for(var i={url:void 0},r=0;r<e.length;r++){var s=e[r];if(n=s[t.serviceName]){i.url=n,i.platformId=s.platformId;break}}i.url?t.onSuccess(i):t.onError({serviceName:t.serviceName})}else if(n=e[t.serviceName])t.onSuccess({url:n,platformId:t.platformId});else{if(t.platformId){var o=UWA.extend({},t);delete o.platformId,t=o}c.getServiceUrl(t)}else t.onError({serviceName:t.serviceName,error:"Compass Error"})},onFailure:function(e){n.error(e),t.onError({serviceName:t.serviceName,error:"Compass Error"})}})}else n.error("onError required")},isKindOf:function(t,e,n){this.getParentsType({physicalid:e.physicalid,tenant:e.tenant,onFailure:function(){n(!1)},onComplete:function(e){n(e&&Array.isArray(e)&&e.indexOf(t)>-1)}})},getParentsType:function(t){this.fetch({contextid:t.contextid,serverUrl:t.serverUrl,tenant:t.tenant,physicalid:[t.physicalid],select_predicate:["taxonomies"],responseType:"json",dtype:t.dtype,onFailure:t.onFailure||function(t){console.error(t)},onComplete:function(e){if(e.infos&&1===e.infos.nresults&&e.results)for(var n=e.results.length;n--;){var i=e.results[n];if(i.attributes)for(var r=i.attributes,s=r.length;s--;)if("taxonomies"===r[s].name.toLowerCase()){var o=r[s].value.split("/");if(o.length&&("types"===o[0]||"reltypes"===o[0]))return void t.onComplete(o.slice(1))}}else"Document"===t.dtype?t.onComplete(["DOCUMENTS","Document"]):t.onFailure&&t.onFailure()}})},fetch:function(e){if(e.tenant||(e.tenant=this.getTenant(),e.tenant))if(e.physicalid){var n=function(i,s){var o=i.url+u.url+"?xrequestedwith=xmlhttprequest&SecurityContext="+(s||(e.contextid?e.contextid:"preferred"));e.tenant&&(o+="&tenant="+e.tenant);var a={physicalid:e.physicalid,label:e.label||"X3DPLAW_AP-"+(new Date).getTime(),locale:"en"};e.tenant&&(a.tenant=e.tenant),e.select_predicate&&(a.select_predicate=e.select_predicate),e.select_file&&(a.select_file=e.select_file);var h={timeout:6e6,data:JSON.stringify(a),onComplete:function(t){"json"===e.responseType&&"string"==typeof t&&""!==t&&(t=JSON.parse(t)),t&&t.results?e.onComplete(t):c.getSecurityContext(e.tenant).then(function(t){r.set("PreferredCredentials",t),n(i,t)})},onCancel:e.onCancel||e.onFailure,onFailure:e.onFailure,onTimeout:e.onTimeout||e.onFailure,method:u.method,headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":"en"}};e.type&&(h.type=e.type),e.requiredAuth&&(h.authentication=e.requiredAuth),t.authenticatedRequest(o,h,"Fetch")};e.serverUrl?n({url:e.serverUrl}):this.getServiceUrl({serviceName:"3DSpace",platformId:e.tenant,onError:e.onFailure,onSuccess:n})}else e.onFailure&&e.onFailure("physicalid required");else e.onFailure&&e.onFailure("tenant required")},myAppsPreference:function(e){this.getServiceUrl({serviceName:"3DCompass",onError:e.onFailure,onSuccess:function(n){var i={name:e.preferenceName},r=null!=e.value;r&&(i.value=e.value);var s={timeout:6e6,data:i,onComplete:e.onComplete,onCancel:e.onCancel||e.onFailure,onFailure:e.onFailure,onTimeout:e.onTimeout||e.onFailure,method:r?l.method.put:l.method.get,headers:{Accept:r?"application/json":"text/plain","Content-Type":r?"application/x-www-form-urlencoded":"text/plain","Accept-Language":"en"}};t.authenticatedRequest(n.url+l.url,s,r?"putpreference":"getpreference")}})},getMediaInformationFrom3DSwym:function(t){return new Promise(function(e,n){var i=t.id;i||n(new Error("Cannot find media id from Swym asset"));var r=t.tenant?t.tenant.toUpperCase():this.extractTenantFromSwymId(i);this.getServiceUrl({serviceName:"3DSwym",platformId:r,onSuccess:function(t){var r=t.url;s.authenticatedRequest(r+"/api/index/tk",{method:"GET",type:"json",onComplete:function(t){t&&t.result&&t.result.ServerToken?s.authenticatedRequest(r+"/api/media/get",{method:"POST",type:"json",headers:{"Content-Type":"application/json","X-DS-SWYM-CSRFTOKEN":t.result.ServerToken},data:JSON.stringify({request_id:0,params:{id_media:i}}),onComplete:function(t){e(t)},onFailure:function(t,e){console.error(e),n(new Error(t))}}):n(new Error("Fail"))},onFailure:function(t){n(new Error(t))}})},onError:function(t){n(new Error("Failed to retrieve service URL\n"+t))}})}.bind(this))},getMediaInformationFrom3DDrive:function(t){return new Promise(function(e,n){var i;t.id?i=t.id:t.driveAttr?i=t.driveAttr.id:t.originalAsset?i=t.originalAsset.physicalid:n(new Error("Cannot find media id from 3DDrive asset"));var r=t.tenant.toUpperCase();this.getServiceUrl({serviceName:"3DDrive",platformId:r,onSuccess:function(t){var o=t.url;this.get3DDriveTicket({url:o,tenant:r},{onComplete:function(t){var r=t.ticket,a=t.token;r?s.authenticatedRequest(o+"/resources/3ddrive/v1/bos/"+i+"/preview",{method:"GET",type:"json",headers:{"Content-Type":"application/json","X-DS-CSRFTOKEN":a},onComplete:function(t){e(t)},onFailure:function(t,e){console.error(e),n(new Error(t))}}):n(new Error("No 3DDrive ticket."))},onFailure:function(t){n(new Error(t))}})}.bind(this),onError:function(t){n(new Error("Failed to retrieve service URL\n"+t))}})}.bind(this))},get3DDriveTicket(t,e){var n=t.url+"/resources/3ddrive/v1/bos/ticket";t.tenant&&(n+="?tenant="+t.tenant),s.authenticatedRequest(n,{method:"GET",type:"json",onComplete:function(t,n,i){t&&t.actionurl&&t.ticket&&t.jobticket?e.onComplete({ticket:t,token:n["x-ds-csrftoken"]}):e.cbs&&e.onFailure()},onFailure:t.onFailure})},extractTenantFromSwymId:function(t){return t.match(/^swym:\w*:(\w*):/)[1].toUpperCase()}};return c});