define("DS/xCityBasicUtils/Geocoder",["DS/Visualization/ThreeJS_DS","DS/WebappsUtils/WebappsUtils","VENProj4js-2.7.2/js/proj4"],function(t,e,i){"use strict";var r=null;function n(){if(null!==r)throw new Error("Cannot instantiate more than one MySingleton, use MySingleton.getInstance()");this.initialize()}return window.Proj4js||(window.Proj4js=i),n.getInstance=function(){return null===r&&(r=new n),r},n.projList={},n.prototype={initialize:function(){this.baseURL="",this.earthRadius=6378137,this.defaultProjection="EPSG:900913",this.projections={}},setBaseUrl:function(t,e){this.baseURL=t;var i=!0,r=2,n=function(t){i&=t,0===--r&&void 0!==e&&e(i)};this.loadProjection("WGS84",n.bind(this)),this.loadProjection("EPSG:900913",n.bind(this))},setDefaultProjection:function(t,e){this.defaultProjection=t,this.loadProjection(this.defaultProjection,e)},getDefaultProjection:function(){return this.defaultProjection},getProjectProjection:function(){return this.defaultProjection},projectionReady:function(t){var e=n.getInstance().projections[t];return void 0!==e&&1===e.ready},loadProjection:function(t,r,o){var a,s,l,c,h=function(e){var r,a;if(a=n.getInstance().projections[t],e&&void 0===a.proj4js){var s=t;!0!==o&&(s=i.defs[t],i.defs(t,s)),a.proj4js=new i.Proj(s,function(t,e){null===t&&(a.proj4js=e,h(!0))})}for(e?console.log("GEOCODER:loadProjection -> Projection "+t+" LOADED"):console.error("GEOCODER:loadProjection -> FAILLED to load projection "+t),a.ready=e?1:-1,r=0;r<a.cb.length;++r)void 0!==a.cb[r]&&a.cb[r](e);a.cb=[]};if(void 0===this.projections[t])if(this.projections[t]={ready:0,cb:[r]},c=h.bind(this),function(e){var r=n.getInstance().projections[t];r.proj4js=new i.Proj(t,function(t,e){null===t&&(r.proj4js=e,h(!0))})}.bind(this),o)c(!0);else try{for(l in(s={}).type="text/javascript",s.src=e.getWebappsBaseUrl()+"VENProj4js/defs/"+t.replace(/:/gi,"")+".js",a=document.createElement("script"),s)a[l]=s[l];return a.onerror=function(){c(!1)},a.onload=function(){c(!0)},a.onreadystatechange=function(){"complete"!==a.readyState&&"loaded"!==a.readyState||c(!0)},document.getElementsByTagName("head")[0].appendChild(a),!0}catch(t){return c(!1),!1}else switch(this.projections[t].ready){case 0:this.projections[t].cb.push(r);break;case 1:void 0!==r&&r(!0);break;default:void 0!==r&&r(!1)}},projForWebWorker:function(e,r,n,o,a,s){var l;return void 0!==e.x&&void 0!==e.y?l=new t.Vector3(e.x,e.y):void 0!==e.lat&&void 0!==e.lon?l=new t.Vector3(e.lon,e.lat):e instanceof Array&&e.length>=2&&(l=new t.Vector3(e[0],e[1])),r&&""!==r||(r=this.defaultProjection),o&&""!==o||(o=this.defaultProjection),r!==o&&(!s||"WGS84"!==r&&"EPSG:4326"!==r&&"EPSG:4329"!==r||(l.x=Utils.toDeg(l.x),l.y=Utils.toDeg(l.y)),l=i.transform(n,a,l),!s||"WGS84"!==o&&"EPSG:4326"!==o&&"EPSG:4329"!==o||(l.x=Utils.toRad(l.x),l.y=Utils.toRad(l.y))),l},proj:function(e,r,n,o){var a;if(void 0!==e.x&&void 0!==e.y?a=new t.Vector3(e.x,e.y):void 0!==e.lat&&void 0!==e.lon?a=new t.Vector3(e.lon,e.lat):e instanceof Array&&e.length>=2&&(a=new t.Vector3(e[0],e[1])),r&&""!==r||(r=this.defaultProjection),this.loadProjection(r),n&&""!==n||(n=this.defaultProjection),this.loadProjection(n),r!==n){if(!o||"WGS84"!==r&&"EPSG:4326"!==r&&"EPSG:4329"!==r||(a.x=Utils.toDeg(a.x),a.y=Utils.toDeg(a.y)),this.projections[r].ready>0&&this.projections[n].ready>0){var s=this.projections[r].proj4js,l=this.projections[n].proj4js;a=i.transform(s,l,a)}!o||"WGS84"!==n&&"EPSG:4326"!==n&&"EPSG:4329"!==n||(a.x=Utils.toRad(a.x),a.y=Utils.toRad(a.y))}return a},latlonToMercator:function(t,e,i){return this.proj([e,t],"WGS84","EPSG:900913",i)},mercatorToLatlon:function(t,e,i){return this.proj([t,e],"EPSG:900913","WGS84",i)},proj2worldMatrix:function(e,i,r){var n=this.earthRadius+(void 0!==e.z?e.z:0),o=this.toGeographic(this.proj(e,i,"EPSG:900913",r),!0),a=n*Math.cos(o.y),s=a*Math.cos(o.x),l=a*Math.sin(o.x),c=n*Math.sin(o.y),h=(new t.Matrix4).makeRotationY(.5*Math.PI-o.y);return(new t.Matrix4).makeRotationZ(o.x).multiply(h).multiply((new t.Matrix4).makeRotationZ(.5*Math.PI)).setPosition(new t.Vector3(s,l,c))},proj2world:function(e,i,r){var n=new t.Vector3;return n.getPositionFromMatrix(this.proj2worldMatrix(e,i,r)),n},world2proj:function(t,e,i){var r=Math.atan2(t.z,Math.sqrt(t.y*t.y+t.x*t.x)),n=Math.atan2(t.y,t.x);return i||(r=Utils.toDeg(r),n=Utils.toDeg(n)),this.proj([n,r],"WGS84",e,i)},computeMercatorScaleFactor:function(t,e,i,r){if(!this.projectionReady(i))return 1;var n=this.proj([t,e],i,"WGS84",r);return r?Math.min(100,Math.max(1,1/Math.cos(n.y))):Math.min(100,Math.max(1,1/Math.cos(Utils.toRad(n.y))))},reverseGeocodingAt:function(t,e,i){i||(i=this.defaultProjection);var r=this.proj2D([t,e],"WGS84",i),n="http://nominatim.openstreetmap.org/reverse?format=json&lat="+r.y+"&lon="+r.x+"&zoom=18&addressdetails=1";return UWA.Ajax.request(n,{async:!1,cors:!0,onComplete:function(t){return JSON.parse(t).display_name}}),"nowhere"},toGeographic:function(t,e){var i=57.29577951308232*(t.x/6378137),r=i-360*Math.floor((i+180)/360),n=57.29577951308232*(1.5707963267948966-2*Math.atan(Math.exp(-1*t.y/6378137)));return n>85?n=90:n<-85&&(n=-90),e?{y:Utils.toRad(n),x:Utils.toRad(r)}:{y:n,x:r}},getLandPositionFromName:function(e,i,r,n){var o="http://nominatim.openstreetmap.org/search?q="+e+"&format=json";UWA.Ajax.request(o,{cors:!0,onComplete:function(e){if(void 0===JSON.parse(e)[0])return console.error("Error: Destination request failed!"),void r(void 0);i||(i=this.defaultProjection);var o=void 0;o=n?new t.Vector2(p.x,p.y):new t.Vector2(p.x,p.y,0),r(o)},onFailure:function(){r(void 0)}})}},n.getInstance()}),requirejs.config({paths:{react:"react/react.development","react-dom":"react-dom/react-dom.development"}}),define("DS/xCityBasicUtils/Utils",["DS/Visualization/ThreeJS_DS","DS/Visualization/PathElement","DS/VENTurfJS/turf.min","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/Visualization/RenderStyle"],function(t,e,i,r,n,o,a){"use strict";var s={IMPERIAL_SYSTEM:"imperial",TEMP_MEASURE_FOLDER_ID:"measure",MANAGED_METRIC_UNITS:["m","km"],TEMP_FOLDER_ID:"TemporaryItems",IS_MEASURE_DISTANCE_ID:"distanceMeasure",MULTIPOLYGON_TYPE:"MultiPolygon",MULTILINESTRING_TYPE:"MultiLineString",TIMING_DOUBLE_CLICK:500,CREATION_MANIPULATORS:["xCityCreatePoint","xCityCreatePolygon","xCityCreateLine","xCityCreateSketchPolygon","xCityCreateCircle","xCityCreateRectangle","xCityCreateSketchPolyline","xCityCreateHouse","xCityCreateBuilding"]},l=function(e,i){var r,n,o,a,s,l=void 0===i.min?0:i.min,c=void 0===i.max?1:i.max;e=Math.max(0,Math.min((e-l)/c,1));var h=void 0===i.minHue?0:i.minHue,u=void 0===i.maxHue?360:i.maxHue,f=void 0===i.sat?1:i.sat,p=(e*(u-h)+h)/360;function d(t,e,i){return i<0?i++:i>1&&i--,(i=255*(i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t)|0)?(i=i.toString(16)).length>1?i:"0"+i:"00"}return 0===f?r=n=o=(e=127)?(e=e.toString(16)).length>1?e:"0"+e:"00":(r=d(a=1-(s=.5+f-.5*f),s,p+1/3),n=d(a,s,p),o=d(a,s,p-1/3)),new t.Color("#"+r+n+o)},c=function(t){return UWA.is(t)},h=function(t,e){if(t&&t.parents&&1===t.parents.length){var i=t.parents[0];i.notAllowedInPathElement||(h(i,e),e.push(i))}},u=function(t){var i=[];return h(t,i),i.push(t),new e(i)},f=function(t){var e=t.userData;if(c(e)){var i=e.records;if(c(i))return e}if(!c(t.parents)||t.parents.length<1||"DataModel"===t.name)return null;var r=t.parents[0];return c(r)?f(r):void 0},p=function(t){if(c(t.mesh3js)&&c(t.mesh3js.geometry)&&t.mesh3js.geometry.length>0){var e=t.mesh3js.geometry[0];if(c(e)&&c(e.drawingGroups)&&e.drawingGroups.length>0)return e.drawingGroups[0]}return null},d=function(t){if(t&&t.mesh3js&&t.mesh3js.geometry&&t.mesh3js.geometry.length>0)for(var e=0;e<t.mesh3js.geometry.length;e++){var i=t.mesh3js.geometry[e];if(i&&i.drawingGroups&&i.drawingGroups.length>0)for(var r=0,n=i.drawingGroups.length;r<n;r++){var o=i.drawingGroups[r];o.material&&o.material.map&&o.material.map.lods&&(o.material.map.usedTexture=-1)}}for(var a=0,s=t.children.length;a<s;a++)d(t.children[a])},y=function(t){var e,i,r,n={};if(1===t.nodeType){if(t.attributes.length>0){n["@attributes"]={};for(var o=0;o<t.attributes.length;o++){var a=t.attributes.item(o);n["@attributes"][a.nodeName]=a.nodeValue}}}else 3===t.nodeType&&(n=t.nodeValue);if(t.hasChildNodes())for(var s=0;s<t.childNodes.length;s++){var l=t.childNodes.item(s),h=l.nodeName,u=(i=void 0,r=void 0,i=(e=h).indexOf(":"),(r={}).name=e.substring(i+1),i>=0&&(r.prefix=e.substring(0,i)),r),f=u.name;"#text"===f?void 0===n[f]?n[f]=y(l):n[f]+=y(l):(void 0===n[f]&&(n[f]=[]),n[f].push(y(l))),c(u.prefix)&&(c(n[f].prefix)||(n[f].prefix=u.prefix))}return n};function g(t,e){var i;if(c(t)&&c(e)){var r,n=Object.keys(t),o=n.length;for(r=0;r<o;r++){var a,s=n[r],l=t[s],h=e[s];c(l)&&(c(h)?l!==h&&(a=l instanceof Object&&h instanceof Object?m(l,h):l):a=l,c(a)&&(c(i)||(i={}),i[s]=a))}}return i}function m(t,e){var i;i=g(t,e);var r=g(e,t);return c(i)&&(i=Object.assign({},i)),c(r)&&(c(i)||(i={}),i=Object.assign(i,r)),i}function v(t){let e;return"string"==typeof t?e=t.split("."):Array.isArray(t)&&(e=t),e}function x(t){if(c(t))return!!t.get("isMeasure")}function M(t,e,i){const r=(i.y-t.y)*(e.x-t.x)-(i.x-t.x)*(e.y-t.y);if(Math.abs(r)>.001)return!1;const n=(i.x-t.x)*(e.x-t.x)+(i.y-t.y)*(e.y-t.y),o=(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y);return!(n<0||n>o)}function x(t){if(c(t))return!!t.get("isMeasure")}return{utilsVar:s,is:c,isBright:function(t){return this.computeBrightness(t)>140},isDark:function(t){return this.computeBrightness(t)<=140},computeBrightness:function(t){return 255*t.r*.299+255*t.g*.587+255*t.b*.114},clone:function(t){return JSON.parse(JSON.stringify(t))},cloneRecKeepingClasses:function(t){return Object.assign(Object.create(Object.getPrototypeOf(t)),t)},cloneQuad:function(t){return{I:t.I,J:t.J,LOD:t.LOD,dist:t.dist,key:t.key,leaf:t.leaf,timestamp:t.timestamp}},toDeg:function(t){return 57.29577951308232*t},toRad:function(t){return.017453292519943295*t},toColor:function(t,e,i,r){return l(t,{minHue:e,maxHue:i,sat:r}).getHex()},getQuadKey:function(t,e,i){return 1099511627776*t+1048576*e+i},endsWith:function(t,e){return-1!==t.indexOf(e,t.length-e.length)},loadTexture:function(e){var i=t.ImageUtils.loadTexture(e,null,null,null,!0);return i.wrapS=i.wrapS||1e3,i.wrapT=i.wrapT||1e3,i.anisotropy=i.anisotropy||8,i.minFilter=i.minFilter||1008,i.magFilter=i.magFilter||1006,i.repeat=i.repeat||{x:1,y:1},i},eulerAnglesFromQuaternion:function(e){var i,r,n,o=2*(e.w*e.x+e.y*e.z),a=1-2*(e.x*e.x+e.y*e.y);i=Math.atan2(o,a);var s=2*(e.w*e.y-e.z*e.x);r=Math.abs(s)>=1?(s>0?1:-1)*Math.PI/2:Math.asin(s);var l=2*(e.w*e.z+e.x*e.y),c=1-2*(e.y*e.y+e.z*e.z);return n=Math.atan2(l,c),new t.Vector3(i,r,n)},quaternionFromEulerAngles:function(e,i,r){var n=new t.Quaternion,o=Math.cos(.5*r),a=Math.sin(.5*r),s=Math.cos(.5*e),l=Math.sin(.5*e),c=Math.cos(.5*i),h=Math.sin(.5*i);return n.w=o*s*c+a*l*h,n.x=o*l*c-a*s*h,n.y=o*s*h+a*l*c,n.z=a*s*c-o*l*h,n},extractExtension:function(t){var e,i;return c(t)&&(i=(i=t.split("?")[0]).split(".")).length>1&&(e=i[i.length-1]),e},getUrbanPathElement:u,getColorGradient:l,getDataSource:f,displayVector:function(t){if(!this.is(t))return null;var e=" x: "+t.x.toFixed(3)+" y: "+t.y.toFixed(3);return this.is(t.z)&&(e+=" z: "+t.z.toFixed(3)),this.is(t.w)&&(e+=" w: "+t.w.toFixed(3))," "+e+" "},getAllMaterials:function(t){var e=[];c(t)&&t.traverse(function(t){if(t.material&&e.push(t.material),t.mesh3js){t.mesh3js.material&&e.push(t.mesh3js.material);var i=p(t);c(i.gas)&&e.push(i.gas),c(i.material)&&e.push(i.material)}});return e},isParent:function(t,e){return e.traverse(function(t,e){return t.id===e.parent.id},{parent:t},!0)},resetLODs:d,removeElementFromArray:function(t,e){t.splice(e,1)},getMainMaterial:function(t){if(c(t)){var e,i=t.length;for(e=0;e<i;e++){var r=t[e];if(!0===r.force)return r}return t[i-1]}},getFirstDrawingGroup:p,floatPack:function(t,e,i){c(t)||(t=0);var r=0;return e<0&&(e=0),i?t|=r=1*Math.pow(2,e):(r=1*Math.pow(2,e),t&=r=Math.pow(2,32)-1-r),t},parseXML:function(t){var e=null;if(window.DOMParser)try{e=(new DOMParser).parseFromString(t,"text/xml")}catch(t){e=null}else console.error("Could not parse XMLstring ");return e},xmlToJson:y,initColor:function(e){"object"==typeof e&&(e="rgb("+Math.floor(255*e.r)+","+Math.floor(255*e.g)+","+Math.floor(255*e.b)+")");return new t.Color(e)},sortObjectArraybyAttribute:function(t,e){t.sort(function(t,i){return t[e]<i[e]?-1:t[e]>i[e]?1:0})},simpleJSONCompare:function(t,e){return JSON.stringify(t)===JSON.stringify(e)},getDifferences:m,getParentTile:function t(e,i){var r={LOD:e.LOD-1,I:e.I>>1,J:e.J>>1};return c(i)&&r.LOD>i?t(r,i):r},isSameTile:function(t,e){return t.LOD===e.LOD&&e.I===t.I&&t.J===e.J},removeUrlEnd:function(t,e){var i=t.lastIndexOf(e);return t.slice(0,i)},startsWith:function(t,e){return 0===t.indexOf(e)},createUUID:function(){var t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?i:3&i|8).toString(16)})},getSubsetOfBinA:function t(e,i){var r;if(c(e)&&c(i)){var n,o=Object.keys(e),a=o.length;for(n=0;n<a;n++){var s,l=o[n],h=e[l],u=i[l];c(u)&&(s=h instanceof Object&&u instanceof Object?t(h,u):u),c(s)&&(c(r)||(r={}),r[l]=s)}}return r},getAllAttributeValues:function(t,e){if(c(t)){var i=[];return function t(e,i,r){var n,o,a,s;if(c(e))for(o=(n=Object.keys(e)).length,a=0;a<o;a++)(s=n[a])===i?r.push(e[i]):e[s]instanceof Object&&t(e[s],i,r)}(t,e,i),i}return null},logX:function(t,e){return Math.log(e)/Math.log(t)},compute2DPolygonCentroid:function(t){for(var e,i,r,n=t.length,o=t[0],a=0,s=0,l=0,c=0,h=n-1;c<n;h=c++)e=t[c],i=t[h],a+=r=(e.x-o.x)*(i.y-o.y)-(i.x-o.x)*(e.y-o.y),s+=(e.x+i.x-2*o.x)*r,l+=(e.y+i.y-2*o.y)*r;return{x:s/(r=3*a)+o.x,y:l/r+o.y}},computePolygonCentroidTurf:function(t){return i.pointOnSurface(t).geometry.coordinates},getBbox:function(t){return i.bbox(t)},drawCuboid:function(e,i,o,a,s=new r.Color(.8,.2,.6,.5)){var l=n.createCuboidNode({cornerPoint:e,firstAxis:new t.Vector3(i,0,0),secondAxis:new t.Vector3(0,o,0),thirdAxis:new t.Vector3(0,0,a),color:s});return l.name="cube",xCity.get3DRootNode().addChild(l),l},projectPointOnDirection:function(e,i,r){var n=new t.Vector2(i.x,i.y).sub(e).clone().normalize(),o=r.clone().sub(e),a=n.dot(o);return e.clone().add(n.clone().setLength(a))},removeDuplicateInArray:function(t){var e=[];return t.forEach(function(t){e.includes(t)||e.push(t)}),e},isEnumerable:function(t){switch(typeof t){case"object":case"array":case"string":return!0;default:return!1}},getNewCreatedName:function(t){var e,i=t;i?i+=" ":i="";for(var r=1;r<1e3;r++)if(e=i+r,!xCity.findItem({name:e}))return e},sortByDistance:function(t,e){return t.sort((t,i)=>t.pos3D.distanceTo(e.getViewpoint().getPosition())-i.pos3D.distanceTo(e.getViewpoint().getPosition()))},getComposedProperty:function(t,e){let i=v(e);if(c(i))return i.reduce((t,e)=>c(t)?t[e]:void 0,t)},setComposedProperty:function(t,e,i){return function t(e,i,r){let n=i.shift();0!==i.length?(c(e[n])||(e[n]={}),t(e[n],i,r)):e[n]=r}(t,e.split("."),i)},getArrayFromComposedPropertyName:v,generateLabelPriorities:function(t,e,i){let r,n,o,a,s;try{s=Number(t.userData.get("Content").get("levelMin"))}catch(t){}try{a=Number(t.userData.get("Content").get("priority"))}catch(t){}try{e?(o=Number(e.get("StreamPriority")),r=Number(t.userData.get("Content").get("userData").cache.dataset.analytics.attributeList.filter(t=>"StreamPriority"===t.name)[0].min),n=Number(t.userData.get("Content").get("userData").cache.dataset.analytics.attributeList.filter(t=>"StreamPriority"===t.name)[0].max)):i&&(o=Number(i.StreamPriority))}catch(t){}return{levelMin:isNaN(s)?void 0:s,priority:isNaN(a)?void 0:a,streamPriority:isNaN(o)?void 0:o,streamPriorityMin:isNaN(r)?void 0:r,streamPriorityMax:isNaN(n)?void 0:n}},getItemType:function(t){let e=t.get("className");if(t.get("isMeasure")==s.IS_MEASURE_DISTANCE_ID)e="MeasureLine";else if("BuildingSet"===e)t.isHouse()&&(e+="House");else if(e.includes("RdbLink")){let i=t.get("userData"),r=t.get("factory"),n="",o=!1;i&&(i["poi-dataset"]?(n="_POI",o=!0):"SimpleFeatureProxy"===i.datasetType?(n="_WFS",o=!0):"Furniture"===i.datasetType&&"3DXC"===t.get("type")?(n="_3DXC",o=!0):"Tree"===i.datasetType&&"3DXC"===t.get("type")&&(n="_3DXC",o=!0)),o||"FactoryModel"!==r||"3DXM"!==t.get("type")||(n="_3DXM"),o||"FactoryModel"!==r||"3DSTiles"!==t.get("type")||(n="_3DSTiles"),e+="s."+r+n}else if(e.includes("RasterOverlay")){let i=t.get("userData"),r="",n=!1;i&&i.isPreview&&(r="_Preview",n=!0),e+=r}else if("Geometry"===e){var i=t.get("objectType");c(i)&&"DesignSight"===i&&(e+="_"+i)}return e},isDrawing:function(t){if(!c(t))return;switch(this.getItemType(t)){case"SimplePointOfInterest3D":case"Line":case"Polygon":case"BuildingSet":return!0;default:return!1}},isMeasure:x,isPointOnSegment:M,coordinatesToTurfLineString:function(t){return i.lineString(t)},coordinatesToTurfPoint:function(t){return i.point(t)},coordinatesToTurfPolygon:function(t){return i.polygon(t)},turfBooleanContains:function(t,e){return i.booleanContains(t,e)},turfPointToLineDistance:function(t,e,r){return i.pointToLineDistance(t,e,r)},slideWithinRange:function(t,e,i,r,n){return t+e>r&&(i<r?t=r-e:(n&&(n.toHide=!0),t=i-e)),t},draw2Drect:function(t,e,i,r,n,o="#007700",a="#005500",s="rgba(0,100,0,0.1)"){var l=t.getContext("2d");l.strokeStyle=o,l.lineWidth=10,l.strokeRect(e,i,r,n),l.fillStyle=s,l.fillRect(e,i,r,n);var c=function(t,e,i="blue"){l.beginPath(),l.fillStyle=i,l.arc(t,e,4,0,2*Math.PI),l.fill()};c(e,i,a),c(e,i+n,a),c(e+r,i+n,a),c(e+r,i,a)},createDebugCanvas:function(){var t=document.createElement("CANVAS");t.style.position="absolute",xCity._urbanImpl.viewerContainer.appendChild(t),t.style.top=0,t.style.left=0,t.style.pointerEvents="none";var e=function(){t.width=window.innerWidth,t.height=window.innerHeight};return window.addEventListener("resize",e,!1),e(),t},structuredClone:function(t){return window.structuredClone?structuredClone(t):JSON.parse(JSON.stringify(t))},requestIdleCallback:function(t,e){window.requestIdleCallback?requestIdleCallback(t,e):setTimeout(t,e&&e.timeout?e.timeout:0)},addObserver:function(t,e){Utils.is(t.observers)||(t.observers=[]),t.observers.push(e)},getSegmentBetweenTwoArrayPoints:function(t,e){return{x1:t[0],y1:t[1],z1:t[2],x2:e[0],y2:e[1],z2:e[2]}},getSegmentGEOJSON:function(t){return{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:[[t.x1,t.y1,t.z1],[t.x2,t.y2,t.z2]]}}]}},computeLocationsOnRectangleSegment:function(t,e,i){var r,n,o,a,s=xCity.arrayToVector3(t[0]),l=xCity.arrayToVector3(t[1]),c=(xCity.arrayToVector3(t[2]),xCity.arrayToVector3(t[3]));xCity._urbanImpl.getView3D().viewpoint.getScreenPosition(s).y>xCity._urbanImpl.getView3D().viewpoint.getScreenPosition(c).y?(r=xCity.arrayToVector3(t[0]),n=xCity.arrayToVector3(t[1])):(r=xCity.arrayToVector3(t[e[0]]),n=xCity.arrayToVector3(t[e[0]+1])),xCity._urbanImpl.getView3D().viewpoint.getScreenPosition(s).x>xCity._urbanImpl.getView3D().viewpoint.getScreenPosition(l).x?(o=xCity.arrayToVector3(t[0]),a=xCity.arrayToVector3(t[3])):(o=xCity.arrayToVector3(t[1]),a=xCity.arrayToVector3(t[2]));var h=r.clone().sub(n),u=h.length();h=h.normalize().multiplyScalar(u*i[0]);var f=n.clone().add(h),p=o.clone().sub(a),d=p.length();p=p.normalize().multiplyScalar(d*i[1]);var y=a.clone().add(p);return f.z=0,y.z=0,{pointOnWidth:f,pointOnLength:y}},computeSketchSegmentLength:function(e,i,r){var n,o,a,s,l;if(0===i)s=2,n={x:e[i][0],y:e[i][1],z:e[i][2]},o={x:e[i+1][0],y:e[i+1][1],z:e[i+1][2]};else{var c,h,u=i;h=(c=u+1==(s="sketchPolygon"===r?e.length-1:e.length)?0:u+1)+1==s?0:c+1,n={x:e[u][0],y:e[u][1],z:e[u][2]},o={x:e[c][0],y:e[c][1],z:e[c][2]},a={x:e[h][0],y:e[h][1],z:e[h][2]};var f=new t.Vector3(a.x,a.y,a.z).clone().sub(new t.Vector3(o.x,o.y,o.z)).length()}return l=i+1==s?0:i+1,{firstSeg:{index:i,length:new t.Vector3(o.x,o.y,o.z).clone().sub(new t.Vector3(n.x,n.y,n.z)).length()},secondSeg:{index:l,length:f}}},computeSketchSegmentLocation:function(e,i,r,n){var o,a,s,l,c;if(0===i)l=2,o={x:e[i][0],y:e[i][1],z:e[i][2]},a={x:e[i+1][0],y:e[i+1][1],z:e[i+1][2]};else{var h,u,f=i;u=(h=f+1==(l="sketchPolygon"===n?e.length-1:e.length)?0:f+1)+1==l?0:h+1,o={x:e[f][0],y:e[f][1],z:e[f][2]},a={x:e[h][0],y:e[h][1],z:e[h][2]},s={x:e[u][0],y:e[u][1],z:e[u][2]};var p=new t.Vector3(a.x+r*(s.x-a.x),a.y+r*(s.y-a.y),a.z+r*(s.z-a.z))}return c=i+1==l?0:i+1,{firstSeg:{index:i,location:new t.Vector3(o.x+r*(a.x-o.x),o.y+r*(a.y-o.y),o.z+r*(a.z-o.z))},secondSeg:{index:c,middle:p}}},computeSegmentsMiddle:function(e){var i=[];for(let o=0;o<e.length;o++){var r=e[o],n=new t.Vector3((r.x1+r.x2)/2,(r.y1+r.y2)/2,(r.z1+r.z2)/2);i.push({index:o,segMiddle:n})}return i},findVertexFurtherOnSegment:function(e,i){var r=new t.Vector3,n=new t.Vector3(e.x1,e.y1,e.z1),o=new t.Vector3(e.x2,e.y2,e.z1);r.subVectors(o,n).normalize();var a=o.clone();return a.add(r.clone().multiplyScalar(i)),a},projectPointOnLine:function(t,e){var i=-1/e.slope,r=i,n=(t[0]-i*t[1]-e.b)/(e.slope-r);return{x:e.slope*n+e.b,y:n}},getNumberOfPointsFromRadius:function(t){const e=2*Math.PI*t,i=Math.max(24,Math.round(e/10));let r=Math.max(48,Math.round(.5*i+.5));return r=Math.min(100,r)},getCircleFromCenterPoint:function(t,e,i){const r=t[0],n=t[1],o=e||0,a=this.getNumberOfPointsFromRadius(e),s=[];for(let e=0;e<a;e++){const l=r+o*Math.cos(2*Math.PI*e/a),c=n+o*Math.sin(2*Math.PI*e/a),h=t[2];i?s.push([l,c,h]):s.push([l,c])}return s},angleWithinTolerance:function(t,e){return t<=90+e&&t>=90-e},computeAngle:function(t,e,i){var r=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2)),n=Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2)+Math.pow(e.z-i.z,2)),o=Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2)+Math.pow(i.z-t.z,2));return 180*Math.acos((Math.pow(r,2)+Math.pow(o,2)-Math.pow(n,2))/(2*r*o))/Math.PI},isPointOnSegment:M,saveBufferAsImage:function(t,e,i,r){var n=document.createElement("canvas");n.width=t,n.height=e;for(var o=n.getContext("2d"),a=o.createImageData(t,e),s=a.data,l=0;l<a.height;l++)for(var c=0;c<a.width;c++){var h=c+l*t,u=c+(e-l-1)*t;s[4*h]=i[4*u],s[4*h+1]=i[4*u+1],s[4*h+2]=i[4*u+2],s[4*h+3]=i[4*u+3]}o.putImageData(a,0,0);var f=n.toDataURL("image/png").replace("image/png","image/octet-stream"),p=document.createElement("a");p.setAttribute("download",r+".png"),p.setAttribute("href",f),p.click()},captureOrthographicView:function(e,i){var r=xCity._urbanImpl.USR,n=r.webGLV6Viewer,s=r.offscreenViewpoint,l=e.getBoundingBox(),c=e.getMatrix(),h=(l.min.applyMatrix4(c),l.max.applyMatrix4(c),2e3),f=e.getMatrixWorld();s.target.x=f.elements[12],s.target.y=f.elements[13],s.target.z=f.elements[14];var p=l.max.x-l.min.x,d=l.max.y-l.min.y,y=(l.max.z,l.min.z,e.getBoundingBox());s.target.x+=(y.max.x+y.min.x)/2,s.target.y+=(y.max.y+y.min.y)/2;var g=.5*(l.max.y-l.min.y)/Math.tan(s.camera.fov*Math.PI/360);s.control.distanceToTarget=g,s.reframe("top2",0,e.getBoundingSphere()),r._freeRobot&&r._rootShifted.removeChild(r._freeRobot),n.setBackgroundColor("#000000",0),n.ambience.getBackground().setActivated(!1),e.setVisibility(!1),n.swapVisibleSpace(),h/=p/d;var m={width:2e3,height:h=Math.floor(h),data:null},v=n.getSceneGraphOverrideSetManager(),x=new o(r._root);v.pushSceneGraphOverrideSet(x);var M=u(e),S=x.createOverride(M);i&&S.setMaterial(i);var _=new a;_.setRenderMode("Face",!0),_.setRenderMode("@Edge",!1),_.setRenderMode("@Point",!1),_.setRenderMode("Outline",!1),_.setRenderMode("SectionLine",!1),_.setRenderMode("AxisSystem",!1),_.setRenderMode("InfiniteFace",!1),S.setRenderStyle(_);var C=n.renderer.ToneMappingEffect.enabled;C&&n.setToneMapping({enable:!1}),n.renderToTarget(m,s),C&&n.setToneMapping({enable:!0}),v.clear(),n.swapVisibleSpace(),e.setVisibility(!0),r._freeRobot&&r._rootShifted.addChild(r._freeRobot),n.ambience.getBackground().setActivated(!0);var D=new t.DataTexture(m.data,m.width,m.height);return D.flipY=!1,D.needsUpdate=!0,D},isMeasure:x,computeVincentyDist:function(t,e,i,r){const n=t=>t*Math.PI/180,o=n(t),a=n(e),s=n(i),l=n(r),{a:c,b:h,f:u}={a:6378137,b:6356752.314245,f:1/298.257223563},f=l-a,p=(1-u)*Math.tan(o),d=1/Math.sqrt(1+p*p),y=p*d,g=(1-u)*Math.tan(s),m=1/Math.sqrt(1+g*g),v=g*m,x=Math.abs(f)>Math.PI/2||Math.abs(s-o)>Math.PI/2;let M=f,S=null,_=null,C=x?Math.PI:0,D=0,w=x?-1:1,b=null,P=1,T=null,V=1,O=null,j=null,z=0;do{if(b=m*(S=Math.sin(M))*(m*S)+(d*v-y*m*(_=Math.cos(M)))*(d*v-y*m*_),Math.abs(b)<Number.EPSILON)break;if(w=y*v+d*m*_,j=M,M=f+(1-(O=u/16*(V=1-(T=d*m*S/(D=Math.sqrt(b)))*T)*(4+u*(4-3*V))))*u*T*((C=Math.atan2(D,w))+O*D*((P=0!=V?w-2*y*v/V:0)+O*w*(2*P*P-1))),(x?Math.abs(M)-Math.PI:Math.abs(M))>Math.PI)throw new Error("lambda > Math.PI")}while(Math.abs(M-j)>1e-12&&++z<1e3);if(z>=1e3)throw new Error("Vincenty formula failed to converge");const I=V*(c*c-h*h)/(h*h),A=I/1024*(256+I*(I*(74-47*I)-128));return h*(1+I/16384*(4096+I*(I*(320-175*I)-768)))*(C-A*D*(P+A/4*(w*(2*P*P-1)-A/6*P*(4*D*D-3)*(4*P*P-3))))},formatDistance:function(t,e){if(Utils.is(t)){var i=t,r="m";switch(e){case this.utilsVar.IMPERIAL_SYSTEM:r="in",(i/=.0254)>12&&(r="ft",(i/=12)>100&&(r="yd",(i/=3)>500&&(i/=1760,r="mi")));break;default:i>1e3&&(i/=1e3,r="km")}return{value:i,unit:r}}},convertImperialInMetric:function(t){var e,i=t.unit,r=t.value;return"in"==i?e=.0254*r:"ft"==i?e=.3048*r:"yd"==i?e=.9144*r:"mi"==i&&(e=1609.34*r),{value:e,unit:"m"}},convertKmDistanceToMeters:function(t){var e,i=t.value;return"km"==t.unit&&(e=1e3*i),{value:e,unit:"m"}},formatArea:function(t,e){if(Utils.is(t)){var i=t,r="m2";switch(e){case this.utilsVar.IMPERIAL_SYSTEM:r="sqin",(i/=64516e-8)>144&&(r="sqft",(i/=144)>43560&&(r="ac",(i/=43560)>640&&(i/=640,r="sqmi")));break;default:i>1e4&&(r="ha",(i/=1e4)>100&&(i/=100,r="km2"))}return{value:i=Math.round(100*i)/100,unit:r}}}}}),define("DS/xCityBasicUtils/AABBox",["DS/Visualization/ThreeJS_DS"],function(t){"use strict";var e=function(e,i){this._worldSize=1;var r={x:0,y:0};void 0!==i&&(this._worldSize=i.worldSize?i.worldSize:1,r.x=i.shiftedPosition?i.shiftedPosition.x:0,r.y=i.shiftedPosition?i.shiftedPosition.y:0),void 0!==e&&(void 0!==e.min&&void 0!==e.max?(this._min=e.min.slice(),this._max=e.max.slice(),this._size={x:this._max[0]-this._min[0],y:this._max[1]-this._min[1]},this._center={x:(this._min[0]+this._max[0])/2,y:(this._min[1]+this._max[1])/2},this._centerShifted={x:this._center.x-r.x,y:this._center.y-r.y},this._minShifted=[this._min[0]-r.x,this._min[1]-r.y],this._maxShifted=[this._max[0]-r.x,this._max[1]-r.y]):void 0!==e.center&&(void 0!==e.size||void 0!==e.width&&void 0!==e.height)&&(this._center={},this._size={},void 0!==e.center.x&&void 0!==e.center.y?(this._center.x=e.center.x,this._center.y=e.center.y):(this._center.x=e.center[0],this._center.y=e.center[1]),void 0!==e.size?void 0!==e.size.x&&void 0!==e.size.y?(this._size.x=e.size.x,this._size.y=e.size.y):this._size.x=this._size.y=e.size:(this._size.x=e.width,this._size.y=e.height),this._min=[this._center.x-this._size.x/2,this._center.y-this._size.y/2],this._max=[this._center.x+this._size.x/2,this._center.y+this._size.y/2],this._centerShifted={x:this._center.x-r.x,y:this._center.y-r.y},this._minShifted=[this._min[0]-r.x,this._min[1]-r.y],this._maxShifted=[this._max[0]-r.x,this._max[1]-r.y])),void 0===this._min&&void 0===this._max&&(this._min=[r.x,r.y],this._max=[r.x+this._worldSize,r.y+this._worldSize],this._minShifted=[0,0],this._maxShifted=[this._worldSize,this._worldSize],this._size={x:this._worldSize,y:this._worldSize},this._center={x:r.x+this._worldSize/2,y:r.x+this._worldSize/2},this._centerShifted={x:this._worldSize/2,y:this._worldSize/2}),this._sizeRatio=new t.Vector2(this._size.x/this._worldSize,this._size.y/this._worldSize),this._shiftedCenterRatio=new t.Vector2(this._centerShifted.x/this._worldSize,this._centerShifted.y/this._worldSize)};return e.prototype={toJSON:function(t){var e={};return e.min=this._min.slice(),e.max=this._max.slice(),e},contains:function(t){return!(this._min[0]>t._max[0]||this._max[0]<t._min[0]||this._min[1]>t._max[1]||this._max[1]<t._min[1])},intersectIJ:function(t,e,i){var r=this._worldSize/(1<<t),n=Math.abs(r*(e+.5)-this._centerShifted.x),o=Math.abs(r*(i+.5)-this._centerShifted.y);return n<.5*(r+this._size.x)&&o<.5*(r+this._size.y)},intersectIJOrOut:function(t,e,i){var r={};return this.getIJBox(t,r),e>=r.IMax||e<=r.IMin||i<=r.JMin||i>=r.JMax},intersectIJOrOut:function(t,e,i){var r={};return this.getIJBox(t,r),e>=r.IMax||e<=r.IMin||i<=r.JMin||i>=r.JMax},getIJBox:function(t,e){var i=1<<t,r=this._shiftedCenterRatio.x*i,n=this._shiftedCenterRatio.y*i,o=.5*this._sizeRatio.x*i,a=.5*this._sizeRatio.y*i;return e.IMin=Math.floor(r-o),e.IMax=Math.floor(r+o),e.JMin=Math.floor(n-a),e.JMax=Math.floor(n+a),e},getShiftedBBox:function(t,e,i){var r=this._worldSize/(1<<t),n=Math.abs(r*(e+0)),o=Math.abs(r*(e+1));return{xMin:n,yMin:Math.abs(r*(i+0)),xMax:o,yMax:Math.abs(r*(i+1))}},getSize:function(){return this._size},getCenter:function(){return this._center},getShiftedCenter:function(){return this._centerShifted},getMin:function(){return this._min},getShiftedMin:function(){return this._minShifted},getMax:function(){return this._max},getShiftedMax:function(){return this._maxShifted}},e}),define("DS/xCityBasicUtils/DataFormatTools",["UWA/Class","DS/xCityBasicUtils/Utils"],function(t,e){var i=t.singleton({fromWKTToArray:function(t){var e=t.replace(/^[^\(]*\(/,"(");return e="["+(e=(e=(e=(e=(e=e.replace(/\(/g,"[")).replace(/,\s*/g,"],[")).replace(/\)/g,"]")).replace(/[a-z]+\s/gi,"")).replace(/\s/g,","))+"]",JSON.parse(e)},fromArrayToWKT:function(t,i){var r;return e.is(t)&&(r=this._initWKT(t,i),1===t.length?r+=this._convertDataToString(t):r+="("+this._convertDataToString(t)+")"),r},_initWKT:function(t,e){var i="LINESTRING",r="POLYGON",n="MULTIPOLYGON",o="MULTILINESTRING",a="POINT";if(1===t.length&&!Array.isArray(t[0][0]))return a;if("Polygon"===e){if(1===t.length&&!Array.isArray(t[0][0][0][0]))return r;if(t.length>1&&!Array.isArray(t[0][0][0][0]))return n}if("Line"===e||"LineString"===e){if(1===t.length&&!Array.isArray(t[0][0][0]))return i;if(t.length>1&&!Array.isArray(t[0][0][0]))return o}},_convertDataToString:function(t){for(var e="",i=0;i<t.length;i++)Array.isArray(t[i])?(Array.isArray(t[0][0])?e+="("+this._convertDataToString(t[i])+")":e+=this._convertDataToString(t[i]),i!==t.length-1&&(e+=",")):(1==i&&(e+=" "),e+=t[i]);return e},fromJSONToArray:function(t){var i,r,n=[];if(e.is(t)&&e.is(t.features)&&Array.isArray(t.features))for(i=0;i<t.features.length;i+=1)r=t.features[i],e.is(r.geometry)&&e.is(r.geometry.coordinates)&&Array.isArray(r.geometry.coordinates)&&n.push(r.geometry.coordinates);return n},fromArrayToJSON:function(t,i){var r,n;if(e.is(t))for(r=this.initGeoJsonObject(),n=0;n<t.length;n+=1)r.features[n]=this._initFeature(),r.features[n].properties={STRID:UWA.Utils.getUUID()},r.features[n]&&r.features[n].geometry&&this._setGeoJSONGeometryAttributes(r.features[n].geometry,i,t[n]);return r},initGeoJsonObject:function(){return{type:"FeatureCollection",features:[]}},_initFeature:function(){return{type:"Feature",geometry:{coordinates:[]}}},_setGeoJSONGeometryAttributes:function(t,i,r){if(e.is(t)){switch(i.toLowerCase()){case"linestring":i="LineString";break;case"polygon":i="Polygon";break;case"multilinestring":i="MultiLineString";break;case"multipolygon":i="MultiPolygon";break;case"point":i="Point";break;case"multipoint":i="MultiPoint"}t.type=i,t.coordinates=r}},_needsLinearRing:function(t){var e=t.geometry.type.toLowerCase();return"polygon"===e||"multipolygon"===e},updateGeoJSON:function(t,i,r){if(e.is(t))if(e.is(r)){var n=r[0],o=r[1],a=r[2];if(!(f=t.features[n])){t.features[n]=this._initFeature(),(f=t.features[n]).properties={STRID:UWA.Utils.getUUID()};var s=t.features[0];s&&s.geometry&&s.geometry.type&&(f.geometry.type=s.geometry.type),2===i.length&&(f.geometry.type="LineString")}var l=f.geometry.coordinates;this._needsLinearRing(f)&&(i=this.closeLinearRings(i)),e.is(o)?e.is(a)?l[o][a]=i:l[o]=i:t.features[n].geometry.coordinates=i}else{for(var c=[],h=i.length,u=0;u<h;u++){var f;(f=t.features[u])||((f=this._initFeature()).properties={STRID:UWA.Utils.getUUID()}),f&&f.geometry&&this._setGeoJSONGeometryAttributes(f.geometry,"Point",i[u]),c[u]=f}t.features=c}},removeFromGeoJSON:function(t,i){if(e.is(i)&&e.is(t)){var r=i[0],n=i[1],o=i[2],a=t.features[r].geometry.coordinates;e.is(n)?e.is(o)?delete a[n][o]:delete a[n]:t.features[r].geometry.coordinates=[]}},updateFeatureType:function(t,i,r,n){if(e.is(r)&&e.is(t)){var o=r[0];r[1],r[2];if(t.features[o].geometry.type.toLowerCase()===n.toLowerCase())this.updateGeoJSON(t,i,r);else{var a=this.fromCoodinatesToJSON(i,n);t.features[o].geometry=a.features[0].geometry}}},_containsPoints:function(t){return t.length>0&&(2===t[0].length||3===t[0].length)&&"number"==typeof t[0][0]&&"number"==typeof t[0][1]},closeLinearRings:function(t){if(e.is(t))if(this._containsPoints(t)){var i=t[0],r=t[t.length-1];i[0]===r[0]&&i[1]===r[1]&&i[2]===r[2]||t.push(t[0].slice())}else for(var n=0;n<t.length;n++)t[n]=this.closeLinearRings(t[n]);return t},fromCoodinatesToJSON:function(t,e){var i;switch(e.toLowerCase()){case"linestring":e="LineString",i=this.fromArrayToJSON([t],e);break;case"multilinestring":e="MultiLineString",i=this.fromArrayToJSON([[t]],e);break;case"polygon":e="Polygon",t=this.closeLinearRings(t),i=this.fromArrayToJSON([[t]],e);break;case"multipolygon":e="MultiPolygon",t=this.closeLinearRings(t),i=this.fromArrayToJSON([[[t]]],e);break;case"point":e="Point",i=this.fromArrayToJSON(t,e);break;case"multipoint":e="MultiPoint",i=this.fromArrayToJSON([t],e);break;case"rectangle":e="Polygon",t=this.closeLinearRings(t),i=this.fromArrayToJSON([[t]],e)}return i},fromGeometryToBbox:function(t){let e=i.fromWKTToArray(t)[0];return{height:Math.abs(e[0][1]-e[3][1]),width:Math.abs(e[0][0]-e[1][0]),xmax:Math.max(e[0][0],e[1][0]),xmin:Math.min(e[0][0],e[1][0]),ymax:Math.max(e[0][1],e[3][1]),ymin:Math.min(e[0][1],e[3][1])}}});return i}),define("DS/xCityBasicUtils/FloatGradient",["UWA/Core","UWA/Class","DS/xCityBasicUtils/Utils","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils"],function(t,e,r,n,o){"use strict";var a=0;function s(t,e){r.is(t)||(t=0),"string"==typeof t&&(t=Number(t)),this.xCityid="xCityFloatGradient_"+a++,this.currentDefaultValue=0,this.defaultFloat=1,t instanceof s||"webworkerstitle"===self.document.title&&t.isFloatGradientForWorkers?this.initFromGradient(t,e):this.initFromStructure(t,e)}return s.prototype.constructor=s,s.prototype.setDefaultValue=function(t){r.is(t)&&(this.defaultFloat=t)},s.prototype.updateInterval=function(){r.is(this.floatDescription)&&(this.intervalMax=this.floatDescription[this.floatDescription.length-1][this.dataType],this.intervalMin=this.floatDescription[0][this.dataType])},s.prototype.initFromStructure=function(t,e){if(r.is(t.intervalMax)&&(this.intervalMax=t.intervalMax),r.is(t.intervalMin)&&(this.intervalMin=t.intervalMin),t.keyframes&&(t=this.initKeyframes(t.keyframes),this.interpolation=!0),void 0!==t.start&&void 0!==t.end){var n=[t.start];void 0!==t.mid&&n.push(t.mid),n.push(t.end),t=n}if("undefined"!==typeof t&&Array.isArray(t))if(void 0!==e&&("boolean"==typeof e.interpolation?this.interpolation=e.interpolation:"string"==typeof e.interpolation&&"conditional"===e.interpolation&&(this.conditional=!0,this.interpolation=!1)),this.interpolation||t.push(t[t.length-1]),t.length<2)r.is(t[0])&&r.is(t[0].float)?this.initFromfloat(t[0].float):this._defaultGradient();else if(this.floatDescription=this._initGradient(t),this.dataType=void 0,void 0!==t[0].percent&&(this.dataType="percent"),void 0!==t[0].value&&(this.dataType="value"),void 0===this.dataType&&(this.dataType="percent"),this.intervalMax=void 0===e||void 0===e.interval||void 0===e.interval.max?t[t.length-1][this.dataType]:e.interval.max,this.intervalMin=void 0===e||void 0===e.interval||void 0===e.interval.min?t[0][this.dataType]:e.interval.min,this.crop=void 0!==e&&void 0!==e.crop&&e.crop,void 0===this.intervalMax&&(this.intervalMax=1),void 0===this.intervalMin&&(this.intervalMin=0),!0===this.conditional){let e={};for(i=0;i<t.length;i++){let r=t[i];e[r.value]=r.float}this.floatDescription=e}else this.floatDescription=this._convertToPercent(this.floatDescription,this.intervalMin,this.intervalMax,this.dataType);else this._defaultGradient()},s.prototype.initFromfloat=function(t,e){r.is(t)?this.constantValue=Number(t):this.constantValue=null},s.prototype.initFromGradient=function(t,e){this.initFromfloat(t.constantValue),this.floatDescription=t.floatDescription,this.dataType=t.dataType,this.intervalMax=t.intervalMax,this.intervalMin=t.intervalMin,this.lastValue=t.lastValue,this.crop=t.crop,this.interpolation=t.interpolation,this.conditional=t.conditional,this.computeFloat()},s.prototype.initKeyframes=function(t){var e=[];if(r.is(t)){var i,n=t.length;for(i=0;i<n;i++){var o=t[i],a=Number(o.float),s={value:o.value};s.float=a,e.push(s)}r.sortObjectArraybyAttribute(e,"value")}return e},s.prototype.copy=function(t){var e=t;if(!(t instanceof s)){if("number"==typeof t)return void this.initFromfloat(t);e=new s(t)}this.initFromGradient(e)},s.prototype.clone=function(){return new s(this)},s.prototype.setLastValue=function(t){this.lastValue=t;this.computeFloat()},s.prototype.computeFloat=function(t){if(r.is(this.constantValue))return this.constantValue;var e=0,i=t;if(r.is(i)||(i=this.lastValue),r.is(i))if(!0===this.conditional)e=this._getFloatIfValue(i);else{var n=(i-this.intervalMin)/(this.intervalMax-this.intervalMin);if("number"==typeof n&&!isNaN(n)){if(this.crop&&(n>1||n<0))return;n=Math.max(n,0),n=Math.min(n,1),e=this.getLinearGradient(n)}}return e},s.prototype.getLinearGradient=function(t){if(void 0!==this.floatDescription){var e,i=!0;0===t&&(e=this._getfloatInGradient({percent:1,float:this.floatDescription[0].float}),i=!1),1===t&&(e=this._getfloatInGradient({percent:1,float:this.floatDescription[this.floatDescription.length-1].float}),i=!1);for(var r=0;i;)if(r++,t<this.floatDescription[r].percent){var n=this.floatDescription[r].percent-this.floatDescription[r-1].percent,o=(this.floatDescription[r].percent-t)/n,a=(t-this.floatDescription[r-1].percent)/n;e=this._getfloatInGradient({percent:1-o,float:this.floatDescription[r].float},{percent:1-a,float:this.floatDescription[r-1].float}),i=!1}return e}},s.prototype._defaultGradient=function(){this.interpolation=!1,this.floatDescription=this._initGradient([{percent:0,float:[1,0,0]},{percent:.5,float:[1,.5,0]},{percent:1,float:[0,1,0]}]),this.intervalMax=1e3,this.intervalMin=0,this.crop=!1},s.prototype._initGradient=function(t){for(var e=[],i=0;i<t.length;i++)e.push(this._checkfloatValues(t,t[i]));return e},s.prototype._checkfloatValues=function(t,e){return void 0===e||void 0===e.float?e={percent:this.currentDefaultValue,float:[1,0,0,1]}:void 0===e.value&&void 0===e.percent&&(e={percent:this.currentDefaultValue,float:e.float}),this.currentDefaultValue+=1/(t.length-1),e},s.prototype._getfloatInGradient=function(t,e){return void 0===e&&((e={}).percent=0,e.float=t.float),this.interpolation?t.percent*t.float+e.percent*e.float:e.float},s.prototype._getFloatIfValue=function(t){return this.floatDescription[t]},s.prototype._convertToPercent=function(t,e,i,r){for(var n=0;n<t.length;n++){var o=(t[n][r]-e)/(i-e);t[n].percent=o}return t},s.prototype.toJSON=function(){if(r.is(this.constantValue))return this.constantValue;if(r.is(this.floatDescription)){for(var t=[],e=0;e<this.floatDescription.length;e++){var i=this.floatDescription[e];t.push({float:"#"+i.float.getHexString(),value:i.value})}return{keyframes:t}}},s}),define("DS/xCityBasicUtils/ColorGradient",["UWA/Core","UWA/Class","DS/xCityBasicUtils/Utils","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils"],function(t,e,r,n,o){"use strict";var a=0;function s(t,e){n.Color.prototype.constructor.call(this),r.is(t)||(t=new n.Color),"string"==typeof t&&(t=new n.Color(t)),this.xCityid="xCityColorGradient_"+a++,this.currentDefaultValue=0,this.defaultColor=new n.Color("white"),t instanceof s||"webworkerstitle"===self.document.title&&t.isColorGradientForWorkers?this.initFromGradient(t,e):t instanceof o.Color||t instanceof n.Color?this.initFromColor(t,e):this.initFromStructure(t,e)}return s.prototype=Object.create(n.Color.prototype),s.prototype.constructor=s,s.prototype.setDefaultValue=function(t){r.is(t)&&t instanceof n.Color&&(this.defaultColor=t)},s.prototype.updateInterval=function(){r.is(this.colorsDescription)&&(this.intervalMax=this.colorsDescription[this.colorsDescription.length-1][this.dataType],this.intervalMin=this.colorsDescription[0][this.dataType])},s.prototype.initCosine=function(t){r.is(t)?(this.cosine={},this.cosine.DCOffset=new n.Vector3(1,1,1),this.cosine.Amplitude=new n.Vector3(1,1,1),this.cosine.Frequency=new n.Vector3(1,1,1),this.cosine.Phase=new n.Vector3(1,1,1),r.is(t.DCOffset)&&(3===t.DCOffset.length?this.cosine.DCOffset.set(t.DCOffset[0],t.DCOffset[1],t.DCOffset[2]):t.DCOffset instanceof n.Vector3&&this.cosine.DCOffset.copy(t.DCOffset)),r.is(t.Amplitude)&&(3===t.Amplitude.length?this.cosine.Amplitude.set(t.Amplitude[0],t.Amplitude[1],t.Amplitude[2]):t.Amplitude instanceof n.Vector3&&this.cosine.Amplitude.copy(t.Amplitude)),r.is(t.Frequency)&&(3===t.Frequency.length?this.cosine.Frequency.set(t.Frequency[0],t.Frequency[1],t.Frequency[2]):t.Frequency instanceof n.Vector3&&this.cosine.Frequency.copy(t.Frequency)),r.is(t.Phase)&&(3===t.Phase.length?this.cosine.Phase.set(t.Phase[0],t.Phase[1],t.Phase[2]):t.Phase instanceof n.Vector3&&this.cosine.Phase.copy(t.Phase))):this.cosine=null},s.prototype.initFromStructure=function(t,e){if(r.is(t.intervalMax)&&(this.intervalMax=t.intervalMax),r.is(t.intervalMin)&&(this.intervalMin=t.intervalMin),r.is(t.cosine))this.initCosine(t.cosine);else{if(t.keyframes&&(t=this.initKeyframes(t.keyframes),this.interpolation=!0),void 0!==t.start&&void 0!==t.end){var n=[t.start];void 0!==t.mid&&n.push(t.mid),n.push(t.end),t=n}if("undefined"!==typeof t&&Array.isArray(t))if(void 0!==e&&("boolean"==typeof e.interpolation?this.interpolation=e.interpolation:"string"==typeof e.interpolation&&"conditional"===e.interpolation&&(this.conditional=!0,this.interpolation=!1)),this.interpolation||t.push(t[t.length-1]),t.length<2)r.is(t[0])&&r.is(t[0].color)?this.initFromColor(t[0].color):this._defaultGradient();else if(this.colorsDescription=this._initGradient(t),this.dataType=void 0,void 0!==t[0].percent&&(this.dataType="percent"),void 0!==t[0].value&&(this.dataType="value"),void 0===this.dataType&&(this.dataType="percent"),this.colorFct=void 0===e||void 0===e.colorFct?void 0:e.colorFct,this.intervalMax=void 0===e||void 0===e.interval||void 0===e.interval.max?t[t.length-1][this.dataType]:e.interval.max,this.intervalMin=void 0===e||void 0===e.interval||void 0===e.interval.min?t[0][this.dataType]:e.interval.min,this.crop=void 0!==e&&void 0!==e.crop&&e.crop,this.HSV=void 0!==e&&void 0!==e.HSV&&e.HSV,void 0===this.intervalMax&&(this.intervalMax=1),void 0===this.intervalMin&&(this.intervalMin=0),!0===this.conditional){let e={};for(i=0;i<t.length;i++){let r=t[i];e[r.value]=r.color}this.colorsDescription=e}else this.colorsDescription=this._convertToPercent(this.colorsDescription,this.intervalMin,this.intervalMax,this.dataType);else this._defaultGradient();if(this.HSV){var o=this._rgb2hsv(t[0].color),a=this._rgb2hsv(t[t.length-1].color);this.hsvOptions={min:this.intervalMin,max:this.intervalMax,minHue:o.hue,maxHue:a.hue,sat:Math.max(o.sat,a.sat)}}}},s.prototype.initFromColor=function(t,e){r.is(t)?(this.constantValue=new n.Color,this.constantValue.setRGB(t.r,t.g,t.b),this.setRGB(this.constantValue.r,this.constantValue.g,this.constantValue.b)):this.constantValue=null},s.prototype.initFromGradient=function(t,e){this.initFromColor(t.constantValue),this.colorsDescription=t.colorsDescription,this.dataType=t.dataType,this.intervalMax=t.intervalMax,this.intervalMin=t.intervalMin,this.lastValue=t.lastValue,this.crop=t.crop,this.interpolation=t.interpolation,this.conditional=t.conditional,this.initCosine(t.cosine),this.computeColor()},s.prototype.initKeyframes=function(t){var e=[];if(r.is(t)){var i,n=t.length;for(i=0;i<n;i++){var o=t[i],a=r.initColor(o.color),s={value:o.value};s.color=a,e.push(s)}r.sortObjectArraybyAttribute(e,"value")}return e},s.prototype.copy=function(t){var e=t;if(!(t instanceof s)){if(t instanceof n.Color)return n.Color.prototype.copy.call(this,t),void this.initFromColor(t);e=new s(t)}this.initFromGradient(e)},s.prototype.clone=function(){return new s(this)},s.prototype.setLastValue=function(t){this.lastValue=t;var e=this.computeColor();r.is(e)&&this.setRGB(e.r,e.g,e.b)},s.prototype.computeColor=function(t){if(r.is(this.constantValue))return this.constantValue.clone();var e=new n.Color,i=t;if(r.is(i)||(i=this.lastValue),r.is(i))if(!0===this.conditional)e=this._getColorIfValue(i);else{var o=(i-this.intervalMin)/(this.intervalMax-this.intervalMin);if("number"==typeof o&&!isNaN(o)){if(this.crop&&(o>1||o<0))return;if(this.HSV){var a=r.getColorGradient(i,this.hsvOptions);return[a.r,a.g,a.b,this.hsvOptions.sat]}o=Math.max(o,0),o=Math.min(o,1),e=this.cosine?this.getCosineGradient(o):this.getLinearGradient(o)}}return r.is(e)&&this.setRGB(e.r,e.g,e.b),e},s.prototype.getLinearGradient=function(t){if(void 0!==this.colorsDescription){var e,i=!0;0===t&&(e=this._getColorInGradient({percent:1,color:this.colorsDescription[0].color}),i=!1),1===t&&(e=this._getColorInGradient({percent:1,color:this.colorsDescription[this.colorsDescription.length-1].color}),i=!1);for(var r=0;i;)if(r++,t<this.colorsDescription[r].percent){var n=this.colorsDescription[r].percent-this.colorsDescription[r-1].percent,o=(this.colorsDescription[r].percent-t)/n,a=(t-this.colorsDescription[r-1].percent)/n;e=this._getColorInGradient({percent:1-o,color:this.colorsDescription[r].color},{percent:1-a,color:this.colorsDescription[r-1].color}),i=!1}return e}},s.prototype._getCosineComposant=function(t,e,i,r,n){return t+e*Math.cos(6.28318*(i*n+r))},s.prototype.getCosineGradient=function(t){var e,i,r,o=this.cosine.DCOffset,a=this.cosine.Amplitude,s=this.cosine.Frequency,l=this.cosine.Phase;return e=this._getCosineComposant(o.x,a.x,s.x,l.x,t),i=this._getCosineComposant(o.y,a.y,s.y,l.y,t),r=this._getCosineComposant(o.z,a.z,s.z,l.z,t),(new n.Color).setRGB(e,i,r)},s.prototype._defaultGradient=function(){this.interpolation=!1,this.colorsDescription=this._initGradient([{percent:0,color:[1,0,0]},{percent:.5,color:[1,.5,0]},{percent:1,color:[0,1,0]}]),this.intervalMax=1e3,this.intervalMin=0,this.crop=!1},s.prototype._initGradient=function(t){for(var e=[],i=0;i<t.length;i++)e.push(this._checkColorValues(t,t[i]));return e},s.prototype._checkColorValues=function(t,e){return void 0===e||void 0===e.color?e={percent:this.currentDefaultValue,color:[1,0,0,1]}:void 0===e.value&&void 0===e.percent&&(e={percent:this.currentDefaultValue,color:e.color}),this.currentDefaultValue+=1/(t.length-1),e},s.prototype._getColorInGradient=function(t,e){if(void 0===e&&((e={}).percent=0,e.color=t.color),this.interpolation){var i=t.percent*t.color.r+e.percent*e.color.r,r=t.percent*t.color.g+e.percent*e.color.g,o=t.percent*t.color.b+e.percent*e.color.b;return(new n.Color).setRGB(i,r,o)}return e.color},s.prototype._getColorIfValue=function(t){return this.colorsDescription[t]},s.prototype._convertToPercent=function(t,e,i,r){for(var n=0;n<t.length;n++){var o=(t[n][r]-e)/(i-e);t[n].percent=o}return t},s.prototype._rgb2hsv=function(t){var e=t[0],i=t[1],r=t[2],n=Math.min(e,Math.min(i,r)),o=Math.max(e,Math.max(i,r));return{hue:60*((e==n?3:r==n?1:5)-(e==n?i-r:r==n?e-i:r-e)/(o-n)),sat:(o-n)/o,val:o}},s.prototype.getStyle=function(){return this.computeColor(),n.Color.prototype.getStyle.call(this)},s.prototype.getHexString=function(){return this.computeColor(),n.Color.prototype.getHexString.call(this)},s.prototype.setStyle=function(t){n.Color.prototype.setStyle.call(this,t),this.initFromColor(this)},s.prototype.toJSON=function(){if(r.is(this.constantValue))return"#"+this.constantValue.getHexString();if(r.is(this.colorsDescription)){for(var t=[],e=0;e<this.colorsDescription.length;e++){var i=this.colorsDescription[e];t.push({color:"#"+i.color.getHexString(),value:i.value})}return{keyframes:t}}this.cosine&&console.error("save of cosine gradient not implemented")},s}),define("DS/xCityBasicUtils/LoadingProgressList",["UWA/Class","DS/xCityBasicUtils/Utils"],function(t,e){"use strict";return t.extend({init:function(t,i){this.loaded=0,this.total=0,this.loading={},e.is(t)&&(this._progressCallback=t),e.is(i)&&(this._loadDoneCallback=i)},updateLoading:function(t,i){e.is(this.loading[t])&&(this.loaded-=this.loading[t].loaded,this.total-=this.loading[t].total),e.is(i)&&(this.loading[t]=i,this.loaded+=i.loaded,this.total+=i.total),this.updateProgressBar()},modelLoaded:function(t){var i=1;e.is(this.loading[t])&&(i=this.loading[t].total),this.updateLoading(t,{loaded:i,total:i})},updateProgressBar:function(){e.is(this._progressCallback)&&this._progressCallback(this.getProgress()),(this.total<=0||this.loaded>=this.total)&&(e.is(this._loadDoneCallback)&&this._loadDoneCallback(this.getProgress()),this.loaded=0,this.total=0,this.loading={})},getProgress:function(){return{loaded:this.loaded,total:this.total}}})});