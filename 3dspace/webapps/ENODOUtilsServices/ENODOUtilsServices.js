define("DS/ENODOUtilsServices/DOServices",["UWA/Core","UWA/Promise","DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/Notifications/NotificationsManagerViewOnScreen","DS/Notifications/NotificationsManagerUXMessages","i18n!DS/ENODOUtilsServices/assets/nls/enodo_notifications.json","text!DS/ENODOUtilsServices/assets/enodo_webservices.json"],function(e,t,n,r,i,o,a,c,s,l){"use strict";var u=JSON.parse(l),f=null;return{DownloadURL:function(e,t){var n=new XMLHttpRequest;n.open("POST",e),n.responseType="blob",n.onload=function(){if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(n.response,t);else{var e=document.createElement("a");e.href=window.URL.createObjectURL(n.response),t&&(e.download=t),e.style.display="none",document.body.appendChild(e),e.click(),e=void 0}},n.send()},DownloadBinary:function(e,t){var n=new Blob([e],{type:"application/zip"}),r=document.createElement("a");r.href=URL.createObjectURL(n),t&&(r.download=t+".zip"),r.style.display="none",document.body.appendChild(r),r.click(),r=void 0},isAccessforDownloadDO:function(){var e=this;return new t(function(t,n){var r={webService:{url:u.getFilterValidSC.url,verb:u.getFilterValidSC.verb},callback:{onComplete:function(e){t(e)},onFailure:function(e){n(e||new Error("Issue retrieving Access for Download DO"))}}};e.SendServerRequest(r)})},retrieveSelectionInfo:function(e,n,r){var i=this;return new t(function(t,o){var a={data:{physicalid:e,label:"FetchObjectInfo_DOSP",select_predicate:n},webService:{url:u.fetch.url,verb:u.fetch.verb},callback:{onComplete:function(e){var n=UWA.is(e,"string")?JSON.parse(e):e;t(r(n))},onFailure:function(e){o(e||new Error("Issue retrieving selection informations"))}}};i.SendServerRequest(a)})},GetCurrentSecurityContext:function(){return new t(function(e,t){i.getInstance().getSecurityContext({onSuccess:function(t){var n=t.SecurityContext.replace("ctx::","");e(n)},onFailure:function(){var e={message:s.error.security_context_fail};t(e)}})})},GetCurrentRole:function(){var e=this;return new t(function(t,n){e.GetCurrentSecurityContext().then(function(e){var n=e.split(".");t(n[0])},function(e){n(e)})})},GetCurrentUser:function(){return null==f&&(f=r.getUser()),f},getUserLogin:function(){var e=this.GetCurrentUser(),t="";return void 0!==e&&(t=e.login),t},get3DSpaceUrl:function(e){if(null==e)throw new Error("Platform services not initialize yet");return this.getPlatformURL("3DSpace",e)},getPlatformId:function(){return"undefined"!=typeof widget&&widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise"},retrievePlatformUrl:function(){return new t(function(e,t){o.getPlatformServices({onComplete:function(t){e(t)},onFailure:function(e){t(e)}})})},getTenantInfo:function(e,t){for(var n={},r=0;r<t.length;r++)if(t[r].platformId===e){n=t[r];break}return n},getPlatformURL:function(e,t){if(!UWA.is(t,"array"))throw new Error("Platform services not initialize yet");var n=this.getPlatformId(),r=this.getTenantInfo(n,t);if(void 0===r[e])throw new Error("Unknown service "+e);return r[e]},_displayNotification:function(e,t,n,r){window.notifs=c,a.setNotificationManager(window.notifs);var i={level:e,title:t,subtitle:r,message:n,sticky:!1};window.notifs.addNotif(i)},SendServerRequest:function(e){var t=this,r=this.getUserLogin(),i={};i.method=e.webService.verb,t.GetCurrentSecurityContext().then(function(o){i.headers={Accept:e.webService.hasOwnProperty("accept")?e.webService.accept:"application/json","Content-Type":"application/json","Accept-Language":widget.lang,SecurityContext:encodeURIComponent("ctx::"+o),SecurityToken:encodeURIComponent(r+"|ctx::"+o+"|"+widget.lang)},i.type=e.webService.hasOwnProperty("type")?e.webService.type:"json",i.proxy="passport",i.timeout=void 0!==e.timeout?e.timeout:3e5,i.onComplete=e.callback.onComplete,i.onFailure=e.callback.onFailure,i.onTimeout=void 0!==e.callback.onTimeout?e.callback.onTimeout:e.callback.onFailure;var a=e.data;i.data=JSON.stringify(a),t.retrievePlatformUrl().then(function(r){var o=t.get3DSpaceUrl(r);n.authenticatedRequest(o+e.webService.url,i)})}).catch(function(t){e.callback.onFailure(t)})}}});