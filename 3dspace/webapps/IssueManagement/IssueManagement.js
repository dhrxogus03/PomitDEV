define("DS/IssueManagement/commands/ExportCSV",["UWA/Class","DS/ApplicationFrame/Command"],function(e,t){"use strict";return e.extend(t,{init:function(e){this._parent(e,{isAsynchronous:!0})},execute:function(){var e=this;require(["DS/IssueManagement/export/ExportCSV"],function(t){t.exportation().finally(function(){e.end()})})}})}),define("DS/IssueManagement/commands/ExportPPTX",["UWA/Class","DS/ApplicationFrame/Command"],function(e,t){"use strict";return e.extend(t,{init:function(e){this._parent(e,{isAsynchronous:!0})},execute:function(){var e=this;require(["DS/IssueManagement/export/ExportPPTX"],function(t){t.exportation().finally(function(){e.end()})})}})}),define("DS/IssueManagement/export/Print",["UWA/Class/Promise","UWA/Core","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon","css!DS/IssueManagement/IssueManagement.css"],function(e,t,n,i,s,o,a,r){"use strict";var l="DS/IssueManagement/export/Print",c="Issue",d=200;return{exportation:function(e){if(!t.is(e,"object")||!t.is(e.context))throw new Error("Invalid input parameters: context is undefined");s.start(l+" exportation");var n=e.context,i=this._createHTMLTextTable(n);return this._print(i).then(function(){s.end(l+" exportation")})},_printWindow:void 0,_createHTMLTextTable:function(e){s.start(l+" _createHTMLTextTable");var d="",u="";"datagrid"==e.list.summaryview?(d=e.getTreeListView().columns.slice(),u=e.getTreeListView().getTreeDocument().getRoots()):(d=e.getTreeListView().getManager().getColumns().slice(),u=e.getTreeListView().getManager().getRoots());for(var m=[],p=[],h=0;h<d.length;h++){var g=d[h];n.get("ISU_LISTVIEW")?g.text&&!0!==g.isHidden&&this._isExportable(g)&&m.push(g):g.text&&"ContextualMenuColumn"!=g.dataIndex&&1==g.visibleFlag&&this._isExportable(g)&&m.push(g)}for(var f=0;f<u.length;f++){var v=u[f];v.isVisible()&&v.isRoot()&&p.push(v)}var I=t.createElement("div",{class:"issue-list-print"}),b=t.createElement("div",{class:"issue-list-print-summary"});b.inject(I);var y=t.createElement("div",{class:"issue-list-print-summary-sub-ctn issue-list-print-summary-total-ctn"});y.inject(b),t.createElement("div",{class:"issue-list-print-summary-label issue-list-print-summary-total-label",html:a.export.printTotalLabel}).inject(y),t.createElement("div",{class:"issue-list-print-summary-value issue-list-print-summary-total-value",html:p.length}).inject(y);for(var S={Create:0,Assign:0,Active:0,Review:0,Closed:0},w=0;w<p.length;w++)S[p[w].options.state]++;var C=i.get3DSpaceUrl()+"/snresources/images/icons/small/iconSmallIssue.png";Object.keys(S).forEach(function(e){var i=o.getIconByState(e,c,C),s=t.createElement("div",{class:"issue-list-print-summary-sub-ctn"});s.inject(b);var a=t.createElement("div",{class:"issue-list-print-summary-label"});a.inject(s);var l=r.maturity[e.toLowerCase()],d=n.get("maturityGraph");null!=d&&""!==d&&(l=d[e]),t.createElement("span",{class:"issue-list-print-summary-label-nls",html:l}).inject(a),t.createElement("img",{class:"issue-list-print-summary-icon",src:i}).inject(a),t.createElement("div",{class:"issue-list-print-summary-value",html:S[e].toString()}).inject(s)});var T=(new Date).toLocaleString(n.get("widget").lang),E=t.createElement("div",{class:"issue-list-print-summary-sub-ctn issue-list-print-summary-date-ctn"});E.inject(b),t.createElement("div",{class:"issue-list-print-summary-value issue-list-print-summary-date-value",html:T}).inject(E);var D=t.createElement("div",{class:"issue-list-print-table"});D.inject(I);var _=t.createElement("table");_.inject(D);var A=t.createElement("tr",{class:"table-header-row"});A.inject(_),t.createElement("tr",{class:"table-spacer-row"}).inject(_),m.forEach(function(e){var n="";switch(e.dataIndex){case"ds6w:reportedAgainst":n="wux-ui-3ds wux-ui-3ds-location";break;case"ds6w:resolvedBy":n="fonticon fonticon-docs";break;case"ds6w:resolvedItems":n="wux-ui-3ds wux-ui-3ds-markup-review";break;case"ds6w:contexts":n="wux-ui-3ds wux-ui-3ds-3d-object";break;case"default":default:n=""}var i=t.createElement("th",{class:"table-headercol",html:e.text});(i.setStyle("max-width",e.width),n.length)&&(i.innerHTML="",t.createElement("span",{class:"issue-list-cell-header-icon "+n,title:a.columns[e.dataIndex+"Column"]}).inject(i));i.inject(A)});for(var M=0;M<p.length;M++){var N=p[M],x=t.createElement("tr",{class:"table-root-row"});x.inject(_);for(var O=0;O<m.length;O++){var P=m[O],k=t.createElement("th",{class:"table-root-col"}),V=t.createElement("div",{});if("tree"===P.dataIndex){var L=o.getIconByState(N.options.state,N.options.type,N.options.iconurl);t.createElement("img",{class:"tree-icon",src:L}).inject(V);var R=t.createElement("span",{class:"tree-title"});R.innerHTML=t.String.escapeHTML(N.options.title),R.inject(V)}else if(-1!==["ds6w:description"].indexOf(P.dataIndex))V.innerHTML=t.String.escapeHTML(N.options.grid[P.dataIndex]);else if(-1!==["Approvals"].indexOf(P.dataIndex)){var U=N.options.grid[P.dataIndex]?a.approvals.approvalOn:a.approvals.approvalOff;V.innerHTML=t.String.escapeHTML(U)}else if(-1!==["ds6w:state"].indexOf(P.dataIndex)){t.createElement("span",{class:"issue-list-cell-state "+N.options.state,html:t.createElement("span",{html:N.options.grid[P.dataIndex],class:" cell-state-content"})}).inject(V)}else if(-1!==["ds6w:assignees"].indexOf(P.dataIndex)){N.options.grid[P.dataIndex].split(",").forEach(e=>{var n=t.createElement("div",{html:e});V.appendChild(n)})}else void 0!==N.options.grid[P.dataIndex]?V.innerHTML=N.options.grid[P.dataIndex]:V.innerHTML="";V.inject(k),k.setStyle("max-width",P.width),-1!==["ds6w:reportedAgainst","ds6w:resolvedBy","ds6w:resolvedItems","ds6w:context"].indexOf(P.dataIndex)&&k.setStyle("text-align","center"),k.inject(x)}}return s.end(l+" _createHTMLTextTable"),I},_isPrintWindowOpened:function(){return void 0!==this._printWindow&&null!==this._printWindow&&!1===this._printWindow.closed},_print:function(t){var n=this;return s.start(l+" _print"),new e(function(e,i){n._isPrintWindowOpened()&&n._printWindow.close(),n._printWindow=window.open("/","PrintWindow","width=1024, height=768"),void 0===n._printWindow&&(e(),s.end(l+" _print")),setTimeout(()=>{n._onPrintWindowLoaded(t,e,i)},1300)})},_onPrintWindowLoaded:function(n,i,o){var a=this;a._printWindow.document.write('<html><head></head><body class="isu-print-body"></body></html>'),a._printWindow.document.close();var r=[],c=function(t){return new e(function(e){t.addEventListener("load",function(){e()},!1)})};for(var u in document.styleSheets)if(document.styleSheets.hasOwnProperty(u)){var m=t.createElement("link",{rel:"stylesheet",type:"text/css",media:"all",href:document.styleSheets[u].href});null!==document.styleSheets[u].href&&r.push(c(m)),a._printWindow.document.head.appendChild(m)}e.all(r).then(function(){a._printWindow.document.body.innerHTML=n.outerHTML;var e=a._printWindow.document.querySelectorAll("img");s.end(l+" _print");var t=setInterval(function(){for(var n=!0,s=0;s<e.length;s++)!0!==e[s].complete&&(n=!1);!0===n&&(clearInterval(t),i(),setTimeout(function(){a._printWindow.focus(),a._printWindow.print(),a._printWindow.close()},0))},d)},function(e){o(e),s.end(l+" _print")})},_isExportable:function(e){return!t.is(e.export,"object")||!1!==e.export.value}}}),define("DS/IssueManagement/components/footer/Status",["UWA/Class/View","UWA/Core","DS/UIKIT/Tooltip","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Controls/Loader","DS/IssueComponents/helper/Helper","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a,r,l){"use strict";var c="Issue",d=1e3;return e.extend({name:"DS/IssueManagement/components/footer/Status",tagName:"div",className:"status-container",_logger:null,isVisible:!0,_pin:null,setup:function(e){r.start(this.name+" setup"),this._parent(e),this.isVisible=!0,this.loading.init(),r.end(this.name+" setup")},render:function(){return r.start(this.name+" render"),this.helper().inject(this.container),this.info().inject(this.container),this.loading.container.inject(this.container),r.end(this.name+" render"),this},refresh:function(){this.destroy(),this.render()},destroy:function(){this.container.empty()},loading:{container:t.createElement("div",{class:"im-status-loader"}),clickCallback:null,isVisible:!1,_loader:new s({text:"Loading...",fadeDuration:500,showButtonFlag:!1}),init:function(){this._loader.inject(this.container)},start:function(e){this._loader.height=18,this._loader._loaderCounter=0,this._loader.elements.progressBar.infiniteFlag=!0,this._loader.elements.progressBar._applyInfiniteFlag(),t.is(e,"object")&&this.container.toggleClassName("is-clickable",e.isClickable),this._loader.on(),this.isVisible=!0},update:function(e){this._loader.text=e},stop:function(e){this._loader.text=e,this._loader._loaderCounter=0,this._loader.elements.progressBar.infiniteFlag=!1,this._loader.elements.progressBar.value=100,this._loader.elements.progressBar._applyInfiniteFlag()},hide:function(e){var n=this;n.isVisible&&(n._loader.text=e,setTimeout(function(){new t.Fx(n._loader.elements.container,{duration:d,transition:"linear",events:{onStart:function(){},onComplete:function(){t.is(n._loader,"object")&&n._loader.off(),n.isVisible=!1}}}).start({opacity:[1,0]})},0),n.container.toggleClassName("is-clickable",!1))},setClickListener:function(e){t.is(this.clickCallback,"function")&&this.container.removeEventListener("click",this.clickCallback),this.clickCallback=e,this.container.addEventListener("click",this.clickCallback)}},helper:function(){var e=a.get("widget")||window.widget,i=t.createElement("span",{class:"issue-status-left-helper fonticon fonticon-help-circled"}),s=new n({className:"helper-tooltip",position:"top",target:i,body:l.tooltips.helper});return i.addEventListener("click",function(){s.hide(),o.show(e.body)}),i},info:function(){var e=this,i=t.createElement("span",{class:"issue-status-right fonticon fonticon-info"});return new n({className:"im-status-tooltip",trigger:"touch",target:i,events:{onShow:function(){r.start(e.name+" render status");for(var n=a.get("component"),i=n.getSelectedNodes(),s=n.getTreeDocument().getRoots(!1).length,o=0,d=0;d<i.length;d++)i[d].options.baseType===c&&(o+=1);var u=t.createElement("div",{class:"im-status-msg"});t.createElement("div",{class:"im-status-msg-issues",text:l.replace(l.titles.issues,{number:s})}).inject(u),t.createElement("div",{class:"im-status-msg-selection",text:l.replace(l.tooltips.selectedIssues,{number:o})}).inject(u),this.setBody(u),r.end(e.name+" render status")}}}),i},utils:{}})}),define("DS/IssueManagement/views/facets/Placeholder",["UWA/Class/View","UWA/Core","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n){"use strict";var i="attachments",s="comments",o="history",a="relations";return e.extend({name:"DS/IssueManagement/views/facets/Placeholder",tag:"div",className:"placeholder-view fade-in-element",setup:function(){},render:function(e){this.empty();var r="",l="";switch(e){case i:r="attach",l=n.facets.attachments.placeholder;break;case s:r="chat",l=n.facets.comments.placeholder;break;case o:r="navigation-history",l=n.facets.history.placeholder;break;case a:r="object-related",l=n.facets.relations.placeholder}var c=t.createElement("div",{class:"placeholder-content",html:[t.createElement("span",{class:"fonticon fonticon-5x fonticon-"+r}),t.createElement("span",{class:"placeholder-label",html:l})]});return this.container.setContent(c),this},empty:function(){this.container.empty()}})}),define("DS/IssueManagement/utils/customization/ComboSelector",["i18n!DS/IssueManagement/assets/nls/IssueManagement_list","UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","DS/Menu/Menu"],function(e,t,n,i,s){"use strict";return n.extend(i,{init:function(e){this._parent(e)}})}),define("DS/IssueManagement/components/header/MultiSelection",["UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","DS/ApplicationFrame/CommandsManager","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a){"use strict";var r="DS/IssueManagement/components/header/MultiSelection";return{initialized:!1,_multiSelectMode:{state:null,count:null,tooltips:{state:null,actions:null}},_subscriberId:"",_subscriberTokens:[],initialize:function(){this._subscriberId=Math.random().toString(36).substr(2,9),this._subscriberTokens=[],this._subscribers()},getLayout:function(){var s=this;s.initialized||s.initialize();var o=e.createElement("div",{class:"multi-select-container"}),r=s._multiSelectMode.state=new t({className:"multi-select-toggle select-action",icon:"select-on"}).addEvent("onClick",function(e,t){this.isActive()?s.disableMultiselect():s.enableMultiselect()}).inject(o);new n({target:r.getContent(),body:a.multiSelection.toggleTooltip});s._multiSelectMode.count=e.createElement("sub",{class:"multi-select-count select-action",html:"0"}).inject(o);s._multiSelectMode.count.hide();var l=new t({className:"multi-select-dropdown select-action",icon:"chevron-down",dropdownCaret:!1,dropdown:{items:[{name:"SelectAllIssues",fonticon:"list-ok",text:a.actions.select.selectIssues,handler:function(e,t){i.getCommand("SelectAllIssues").begin()}},{name:"SelectAllRelatedObjects",fonticon:"flow-cascade-ok-2",text:a.actions.select.selectChildren,handler:function(){i.getCommand("SelectAllRelatedObjects").begin()}},{name:"UnselectAll",fonticon:"list-delete",text:a.actions.select.unselectAll,handler:function(){s._multiSelectMode.state.isActive()&&s.disableMultiselect(),i.getCommand("UnselectAll").begin()}}]}}).inject(o);return s._multiSelectMode.tooltips.actions=new n({target:l.getContent(),body:a.multiSelection.dropdownTooltip}),o},getCurrentState:function(){return this._multiSelectMode.state.isActive()},enableMultiselect:function(){this._multiSelectMode.state.toggleActive(),s.get("component").list._datagrid._cellsManager.forceMultiSelection(!0),this._multiSelectMode.count.show()},disableMultiselect:function(){this._multiSelectMode.state.toggleActive(),s.get("component").list._datagrid._cellsManager.forceMultiSelection(!1),this._multiSelectMode.count.hide(),i.getCommand("UnselectAll").begin()},_subscribers:function(){var e=this,t=s.get("eventsHandler");e._subscriberTokens.push(t.subscribe(e._subscriberId,"DS/Object/select",function(t){var n=Object.keys(t.data.attributes);e._manageSelection(n.length)}))},_manageSelection:function(e){o.start(r+" _manageSelection");var t=s.get("component").list._datagrid._cellsManager,n=this._multiSelectMode.state.isActive();this._multiSelectMode.count.innerHTML=e,e>1&&!n&&(this._multiSelectMode.state.toggleActive(),t.forceMultiSelection(!0),this._multiSelectMode.count.show()),o.end(r+" _manageSelection")}}}),define("DS/IssueManagement/commands/SelectAllRelatedObjects",["UWA/Class","DS/ApplicationFrame/Command"],function(e,t){"use strict";return e.extend(t,{name:"DS/IssueManagement/commands/SelectAllRelatedObjects",execute:function(){var e=this;require(["UWA/Class/Promise","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],function(t,n,i){var s=n.get("component").getTreeDocument();i.start(e.name+" execute"),s.withBroadcastSelect(new t(function(t){s.withTransactionUpdate(function(){s.unselectAll();for(var n=s.getRoots(!1),o=0;o<n.length;o++)n[o].processDescendants({processNode:function(e){e.nodeModel.select()}});i.end(e.name+" execute"),t()})}))})}})}),define("DS/IssueManagement/commands/Print",["UWA/Class","DS/ApplicationFrame/Command"],function(e,t){"use strict";return e.extend(t,{init:function(e){this._parent(e,{isAsynchronous:!0})},execute:function(){var e=this;require(["DS/IssueManagement/export/Print","DS/IssueServices/Contexts"],function(t,n){t.exportation({context:n.get("component")}).then(e.end.bind(e),e.end.bind(e))})}})}),define("DS/IssueManagement/commands/ExportZIP",["UWA/Class","DS/ApplicationFrame/Command"],function(e,t){"use strict";return e.extend(t,{init:function(e){this._parent(e,{isAsynchronous:!0})},execute:function(){var e=this;require(["DS/IssueManagement/export/ExportZIP"],function(t){t.exportation().finally(function(){e.end()})})}})}),define("DS/IssueManagement/commands/SwitchView",["UWA/Class","DS/ApplicationFrame/Command"],function(e,t){"use strict";return e.extend(t,{name:"DS/IssueManagement/commands/SwitchView",begin:function(e){this.execute(e)},execute:function(e){var t=this;require(["UWA/Class/Promise","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],function(n,i,s){s.start(t.name+" execute"),i.get("component").switchView(e),s.end(t.name+" execute")})}})}),define("DS/IssueManagement/utils/EventsHandler",["UWA/Class/Listener","UWA/Class/Promise","UWA/Controls/Abstract","UWA/Core","DS/IssueServices/Contexts","DS/PlatformAPI/PlatformAPI","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon","css!DS/IssueManagement/IssueManagement.css"],function(e,t,n,i,s,o){"use strict";var a={INTERNAL_APPLICATIONS:["ENXISSU_AP","ENX3DIR_AP"],SUPPORTED_EVENTS:["DS/IssueManagementTask/add","DS/IssueManagementTask/ready","DS/IssueManagementTask/exec","DS/IssueManagementTask/done","DS/IssueManagementTask/cancel","DS/Object/create","DS/Object/delete","DS/Object/update","DS/Object/select"]};return n.extend(e,{name:"DS/IssueManagement/utils/EventsHandler",_logger:null,init:function(e){var t=this;t._parent(e),t._id=Math.random().toString(36).substr(2,9),t._subscriptions={"DS/Object/update":{"*":[],issue:{"*":[]}}},t._tokens={};t._platformAPIListeners=a.SUPPORTED_EVENTS.map(function(e){return{event:e,listener:function(e){return function(n){if(i.is(n.metadata,"object")){if(i.is(n.metadata.options,"object")&&i.is(n.metadata.options.isuEventsHandlerId,"string")&&n.metadata.options.isuEventsHandlerId===t._id)return;if("DS/Object/select"===e&&n.metadata.appId!==s.get("widget").id&&"ENXISSU_AP"===n.metadata.appName)return}t.publish(t._id,e,n,!0)}}(e)}});for(var n=0;n<t._platformAPIListeners.length;n++){var r=t._platformAPIListeners[n];r.token=o.subscribe(r.event,r.listener)}},destroy:function(){this._subscriptions={}},subscribe:function(e,t,n,s){var o=this,a={id:Math.random().toString(36).substr(2,9),subscriberId:e,event:t,callback:n,conditions:i.is(s,"object")?s:null,subscriptions:[]};if(void 0===o._subscriptions[t]&&(o._subscriptions[t]={"*":[]}),i.is(s,"object")&&i.is(s.type,"string")){var r=s.type;void 0===o._subscriptions[t][r]&&(o._subscriptions[t][r]={"*":[]}),Array.isArray(s.attributes)&&s.attributes.length>0?s.attributes.forEach(function(e){void 0===o._subscriptions[t][r][e]&&(o._subscriptions[t][r][e]=[]),o._subscriptions[t][r][e].push(a.id),a.subscriptions.push({callback:n,event:t,type:r,attribute:e})}):(o._subscriptions[t][r]["*"].push(a.id),a.subscriptions.push({callback:n,event:t,type:r}))}else o._subscriptions[t]["*"].push(a.id),a.subscriptions.push({callback:n,event:t,type:"*"});return o._tokens[a.id]=a,a.id},unsubscribe:function(e){var t=this;if(t._tokens.hasOwnProperty(e)){var n=t._tokens[e];if(null===n.conditions||void 0===n.conditions){if(-1!==t._subscriptions[n.event]["*"].indexOf(e)){var s=t._subscriptions[n.event]["*"].indexOf(e);t._subscriptions[n.event]["*"].splice(s,1)}}else if(i.is(n.conditions.type,"string")&&i.is(t._subscriptions[n.event][n.conditions.type],"object"))if(Array.isArray(n.conditions.attributes))n.conditions.attributes.forEach(function(i){if(-1!==t._subscriptions[n.event][n.conditions.type][i].indexOf(e)){var s=t._subscriptions[n.event][n.conditions.type][i].indexOf(e);t._subscriptions[n.event][n.conditions.type][i].splice(s,1)}});else if(-1!==t._subscriptions[n.event][n.conditions.type]["*"].indexOf(e)){var o=t._subscriptions[n.event][n.conditions.type]["*"].indexOf(e);t._subscriptions[n.event][n.conditions.type]["*"].splice(o,1)}delete t._tokens[e]}},publish:function(e,t,n,s){var r=this;if(void 0!==r._subscriptions[t]&&i.is(n.data,"object")&&Array.isArray(n.data.paths)&&i.is(n.data.attributes,"object")){var l={};n.data.paths.forEach(function(e){if(i.is(n.data.attributes[e],"object")&&i.is(n.data.attributes[e].type,"string")){var t=n.data.attributes[e].type.toLowerCase();Array.isArray(l[t])||(l[t]=[]),l[t].push(n.data.attributes[e])}});var c=Object.keys(l);if(-1===a.INTERNAL_APPLICATIONS.indexOf(n.metadata.appName)){Object.keys(r._tokens).forEach(function(e){var s=r._tokens[e];s.event===t&&s.callback(i.clone(n))})}else{var d=[];r._subscriptions[t]["*"].forEach(function(t){var s=r._tokens[t];-1===d.indexOf(t)&&s.subscriberId!==e&&(d.push(t),s.callback(i.clone(n)))}),c.forEach(function(s){if(i.is(r._subscriptions[t][s],"object")){r._subscriptions[t][s]["*"].forEach(function(t){var s=r._tokens[t];-1===d.indexOf(t)&&s.subscriberId!==e&&(d.push(t),s.callback(i.clone(n)))});var o=l[s][0].modifiedAttributes,a=Object.keys(r._subscriptions[t][s]);if(Array.isArray(o))for(var c=0;c<a.length;c++){var u=a[c];-1===o.indexOf("*")&&-1===o.indexOf(u)||r._subscriptions[t][s][u].forEach(function(t){var s=r._tokens[t];-1===d.indexOf(t)&&s.subscriberId!==e&&(d.push(t),s.callback(i.clone(n)))})}}})}}if(!0!==s){var u=i.clone(n);i.is(u.metadata.options,"object")||(u.metadata.options={}),u.metadata.options.isuEventsHandlerId=r._id,o.publish(t,u)}}})}),define("DS/IssueManagement/commands/ColumnCustomization",["UWA/Class","DS/IssueServices/Contexts","DS/IssueComponents/utils/Utils","DS/ApplicationFrame/Command"],function(e,t,n,i){"use strict";return e.extend(i,{_padCustomizeView:null,init:function(e){this._isDisplayed=!1,this._parent(e)},execute:function(){var e=t.get("component").getTreeListView();n.launchCustomViewManager(e)}})}),define("DS/IssueManagement/components/welcomePanel/view/GlobalConfig",[],function(){"use strict";var e={LEFT_PANEL_SIZE_EXPANDED:300,LEFT_PANEL_SIZE_COLLAPSED:40,MOBILE_CUTOFF:500,TABLET_CUTOFF:768,MOBILE_BREAKPOINT:500,PATH_HOME:"/home",PATH_LANDING_PAGE:"LandingPage",PATH_IM_DETAILS:"IssueManagement",PATH_IT_DETAILS:"IssueTemplate",PATH_CREATE_IM_DETAILS:"CreateIssue",PATH_CREATE_IT_DETAILS:"CreateTemplate",PATH_WHATS_NEW_DETAILS:"WhatsNew",ROUTE_HOME:"home",ROUTE_LANDING_PAGE:"home.LandingPage",ROUTE_IM_DETAILS:"home.IMDetails",ROUTE_IT_DETAILS:"home.ITDetails",ROUTE_CREATE_IM_DETAILS:"home.CreateIMDetails",ROUTE_CREATE_IT_DETAILS:"home.CreateITDetails",ROUTE_WHATS_NEW_DETAILS:"home.WhatsNew"};return e}),define("DS/IssueManagement/commands/Subscription",["UWA/Class","DS/ApplicationFrame/Command","DS/IssueServices/Contexts","DS/IssueCommon/utils/Utils"],function(e,t,n,i){"use strict";return e.extend(t,{name:"DS/IssueManagement/commands/Subscription",begin:function(e){this.execute(e)},execute:function(e){var t=n.get("component").getSelectedNodes(),s={getSelectedNodes:()=>t},o="";switch(e){case"subscribe":require(["DS/ENOSubscriptionMgmt/Commands/Subscribe"],function(e){new e({ID:"SubscribeCmdHdr",context:s,objIDType:"modelID"}).execute()}),o="Subscribe";break;case"unSubscribe":require(["DS/ENOSubscriptionMgmt/Commands/UnSubscribe"],function(e){new e({ID:"SubscribeCmdHdr",context:s,objIDType:"modelID"}).execute()}),o="UnSubscribe";break;case"editSubscription":require(["DS/ENOSubscriptionMgmt/Commands/EditSubscribe"],function(e){new e({ID:"MySubscriptionsCmdHdr",context:s,objIDType:"modelID"}).execute()}),o="EditSubscriptions";break;case"mySubscription":require(["DS/ENOSubscriptionMgmt/Commands/MySubscriptions"],function(e){new e({ID:"MySubscriptionsCmdHdr",context:s,objIDType:"modelID"}).execute()}),o="MySubscriptions"}try{var a=n.get("component").getCurrentView();i.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:a,pd3:"SummaryToolbar",pd4:o,pd5:"Issue/"+a+"/SummaryToolbar/"+o}})}catch(e){}}})}),define("DS/IssueManagement/utils/Synchronizer",["UWA/Class/Listener","UWA/Class/Promise","UWA/Controls/Abstract","UWA/Core","DS/IssueServices/utils/Performance","DS/IssueServices/Contexts","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon","css!DS/IssueManagement/IssueManagement.css"],function(e,t,n,i,s,o){"use strict";var a=1,r=0;return n.extend(e,{name:"DS/IssueManagement/utils/Synchronizer",list:null,kanban:null,KANBAN_VIEW:"KanbanView",_selectEventFromKanbanAcked:-1,_selectEventFromListAcked:-1,init:function(e){this._parent(e),this.list=e.list,this.kanban=e.kanban,this._selectEventFromKanbanAcked=-1,this._selectEventFromListAcked=-1},destroy:function(){this.list=null,this.kanban=null,this._selectEventFromKanbanAcked=-1,this._selectEventFromListAcked=-1},start:function(){var e=this;return new t(function(t){e._subscribeToList(),e._subscribeToKanban(),t()})},_refreshKanban:function(){this.kanban.refresh()},_selectInKanban:function(){if(0!==this._selectEventFromListAcked){this._selectEventFromKanbanAcked=0,s.start(this.name+" _selectInKanban");for(var e=this.list.document.getSelectedNodes().map(function(e){return e.getID()}),t=Object.keys(this.kanban._issuesNodesMapping),n={},i=0;i<t.length;i++){var o=t[i];if(-1!==e.indexOf(o))for(var a=0;a<this.kanban._issuesNodesMapping[o].length;a++){var r=this.kanban._issuesNodesMapping[o][a];n.hasOwnProperty(r.getTreeDocument()._id)||(n[r.getTreeDocument()._id]={tree:r.getTreeDocument(),toSelect:[],toUnselect:[]}),n[r.getTreeDocument()._id].toSelect.push(r)}else for(var l=0;l<this.kanban._issuesNodesMapping[o].length;l++){var c=this.kanban._issuesNodesMapping[o][l];n.hasOwnProperty(c.getTreeDocument()._id)||(n[c.getTreeDocument()._id]={tree:c.getTreeDocument(),toSelect:[],toUnselect:[]}),n[c.getTreeDocument()._id].toUnselect.push(c)}}var d=Object.keys(n);this.kanban.preventUnselectColumns=!0;for(var u=0;u<d.length;u++){var m=n[d[u]];this.kanban.currentView===m.tree._currentKanbanView&&this.kanban._preventCurrentViewSelection||(m.toSelect.length>0||m.tree.getSelectedNodes().length>0)&&m.tree.withTransactionUpdate(function(){for(var e=0;e<m.toSelect.length;e++)m.toSelect[e].select();for(var t=0;t<m.toUnselect.length;t++)m.toUnselect[t].unselect()})}this.list.dispatchEvent("onSelectAcked"),this.kanban.dispatchEvent("onSelectAcked"),s.end(this.name+" _selectInKanban")}else this._selectEventFromListAcked=1},_selectInList:function(){var e=this;if(0!==e._selectEventFromKanbanAcked){e._selectEventFromListAcked=0;var t=e.kanban.getSelectedIssues();e.list.document.prepareBroadcastSelect(),e.list.document.withTransactionUpdate(function(){e.list.document.unselectAll();for(var n=Object.keys(e.kanban._issuesNodesMapping),i=0;i<n.length;i++){var s=n[i];-1===t.indexOf(s)||e.list.document.getNodesById(s)[r].select()}}),e.list.document.pushBroadcastSelect(),e.list.dispatchEvent("onSelectAcked"),e.kanban.dispatchEvent("onSelectAcked")}else e._selectEventFromKanbanAcked=1},_subscribeToList:function(){var e=this.utils.debounce(this._refreshKanban.bind(this),a);this.list.document.getModelEvents().subscribe({event:"setPathTags"},e),this.listenTo(o.get("component"),"setPathTags",e),this.list.document.addEventListener("nodeModelUpdate",e);var t=this.utils.debounce(this._selectInKanban.bind(this),a);this.list.document.getModelEvents().subscribe({event:"select"},t),this.list.document.getModelEvents().subscribe({event:"unselect"},t)},_subscribeToKanban:function(){var e=this.utils.debounce(this._selectInList.bind(this),a);this.listenTo(this.kanban,"onSelect",e)},utils:{_debounceTimeouts:[],debounce:function(e,t,n){var i,s=this;return function(){var o=this,a=arguments,r=n&&!i;clearTimeout(i);var l=s._debounceTimeouts.indexOf(i);-1!==l&&s._debounceTimeouts.splice(l,1),i=setTimeout(function(){i=null,n||e.apply(o,a)},t),s._debounceTimeouts.push(i),r&&e.apply(o,a)}}}})}),define("DS/IssueManagement/export/Utils",["UWA/Class/Promise","UWA/Core","DS/UIKIT/Input/Button","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/WebappsUtils/WebappsUtils","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a,r,l,c){"use strict";return{confirmation:function(s){var o=r.get("widget")||window.widget;return new e(function(e){var a=t.createElement("div",{class:"confirmation-export-issues-content",html:s.content}),r=new i({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"confirmation-export-issues-dialog",title:s.title,header:null,body:a,footer:[new n({value:c.export.confirmation.confirm,className:"primary confirmation-export-issues-dialog-confirm",events:{onClick:function(){r.destroy(),e(!0)}}}),new n({value:c.export.confirmation.cancel,className:"default confirmation-export-issues-dialog-cancel",events:{onClick:function(){r.destroy(),e(!1)}}})],events:{onClose:function(){r.destroy(),e(!1)}}}).inject(o.body);r.show()})},getIssuesToExport:function(){var e=r.get("component"),t=e.getSelectedNodes();return 0===t.length&&(t=e.getTreeDocument().getRoots(!1)),t},notifications:{exporting:function(){o.displayNotification({msg:c.export.exporting,eventID:"info"})},nothing:function(){o.displayNotification({msg:c.export.nothingToExport,eventID:"error"})},failure:function(e){o.displayNotification({msg:t.is(e,"string")?e:c.export.failure,eventID:"error"})}},download:{csv:function(e,t){var n=document.createElement("a"),i=n.href=URL.createObjectURL(new Blob(["\ufeff"+e],{encoding:"UTF-8",type:"text/csv;charset=UTF-8"}));n.setAttribute("download",t),document.body.appendChild(n),n.click(),setTimeout(function(){document.body.removeChild(n),URL.revokeObjectURL(i)},0)}}}}),define("DS/IssueManagement/components/welcomePanel/router/RouterUtils",["DS/Router5/js/Router5","DS/Router5/js/Router5BrowserPlugin","DS/Router5/js/Router5ListenersPlugin","DS/Router5/js/Router5Helpers"],function(e,t,n,i){"use strict";return{createRouter:function(i,s,o,a){var r=e.createRouter(i,s);return o&&r.usePlugin(n()),a&&r.usePlugin(t({useHash:!1})),r},listenToRouterStateChanges:function(e){e.addListener(function(t,n){var s=i.transitionPath(t,n);s.toDeactivate.forEach(function(i){if(void 0!==e.routerMethods[i]){var s=e.routerMethods[i].deactivate;void 0!==s&&s(t,n)}}),s.toActivate.forEach(function(i){if(void 0!==e.routerMethods[i]){var s=e.routerMethods[i].activate;void 0!==s&&s(t,n)}})})}}}),define("DS/IssueManagement/utils/DragAndDrop",["UWA/Core","UWA/Class/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/IssueAttachmentManager/components/Collection","DS/IssueAttachmentManager/components/Item","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueAttachmentManager/views/UploadDialog","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","DS/IssueServices/utils/Views","DS/DataDragAndDrop/DataDragAndDrop","DS/IssueComponents/utils/Utils","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueAttachmentManager/assets/nls/IssueAttachmentManager"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p,h,g,f,v,I,b,y,S,w,C){"use strict";var T="Issue",E="ISU_TYPE_NLS",D=r.getLogger("DS/IssueManagement/utils/DragAndDrop"),_={setDroppableData:function(e,t){var n=g.get("widget")||window.widget,i={protocol:"3DXContent",version:"2.1",source:n.name,widgetId:n.id,data:{items:[]}};null!=t&&(i.data.options=t);for(var s=0;s<e.length;s++){var o=e[s];if(o.options.baseType===T){var a={};["contexts","reportedAgainst","resolvedBy","resolvedItems"].forEach(function(e){a[e]=[];for(var t=0;t<o.options[e].length;t++){var i={envId:v.getTenant(),serviceId:"3DSpace",contextId:n.id,objectId:o.options[e][t].pid,i3dx:o.options[e][t].physicalId.includes("i3dx")?o.options[e][t].physicalId:"",objectType:o.options[e][t].objectType,displayName:o.options[e][t].name,displayType:o.options[e][t].objectType,isIssue:!0};"reportedAgainst"==e&&(i.path=o.options[e][t].path.join()),a[e].push(i)}}),i.data.items.push({envId:v.getTenant(),serviceId:"3DSpace",contextId:n.id,objectId:o.options.physicalId,objectType:o.options.type,displayName:o.options.title+" ("+o.options.name+")",displayType:o.options.type,isIssue:!0,relatedObjects:a})}else{var r=o.options.physicalId.split(","),l=(r[r.length-1],{envId:v.getTenant(),serviceId:"3DSpace",contextId:n.id,objectId:o.options.pid,i3dx:o.options.id.includes("i3dx")?o.options.id:"",objectType:o.options.type,displayName:o.options.display,displayType:o.options.type});i.data.items.push(l)}}var c="text/plain";try{(window.navigator.userAgent.indexOf("MSIE ")>0||navigator.userAgent.match(/Trident.*rv\:11\./))&&(c="text")}catch(e){}return{type:c,data:JSON.stringify(i)}},getDroppableData:function(t){for(var n=null,i=e.is(t.dataTransfer.types.indexOf,"function")?"indexOf":"contains",s="",o=["text/searchitems","text/plain","Text","Files"],a=0;a<o.length&&""===s;a++){var r=t.dataTransfer.types[i](o[a]);(e.is(r,"number")&&r>=0||e.is(r,"boolean")&&!0===r)&&(s=o[a])}var l={};if("Files"===s)n={files:t.dataTransfer.files};else if(""!==s){l=t.dataTransfer.getData(s);try{n=JSON.parse(l)}catch(e){}}return n},related:{whereToAddRelatedObjects:function(s,r,l){var c=this,d=g.get("widget")||window.widget,u=null;u=new i({className:"primary contexts-chooser",name:"typeChooser",value:"contexts",label:"",events:{onChange:function(){v.setDisabled(!0),I.setDisabled(!0)}}});var m=new i({className:"primary reported-against-chooser",name:"typeChooser",value:"reportedAgainst",label:"",checked:!0,events:{onChange:function(e){v.setDisabled(!1),0==T&&I.disable()}}}),p=new i({className:"primary resolved-by-chooser",name:"typeChooser",value:"resolvedBy",label:"",events:{onChange:function(){v.setDisabled(!0),I.setDisabled(!0)}}}),h=new i({className:"primary resolved-items-chooser",name:"typeChooser",value:"resolvedItems",label:"",events:{onChange:function(){v.setDisabled(!0),I.setDisabled(!0)}}}),f=new i({className:"primary attachments-chooser",name:"typeChooser",value:"attachments",label:"",events:{onChange:function(){v.setDisabled(!0),I.setDisabled(!0)}}}),v=new i({className:"primary where-to-drop-sub-icon isuReferenceInstanceChooser",name:"pathChooser",value:"reference",checked:!0,label:"",events:{onChange:function(){}}});v.elements.label.setContent([e.createElement("i",{class:"where-to-drop-reference wux-ui-3ds"}),w.dnd.references]);var I=new i({className:"primary where-to-drop-sub-icon isuReferenceInstanceChooser",name:"pathChooser",value:"instance",label:"",events:{onChange:function(){}}});I.elements.label.setContent([e.createElement("i",{class:"where-to-drop-instance wux-ui-3ds"}),w.dnd.instances]),u.elements.label.setContent([e.createElement("i",{class:"where-to-drop-icon where-to-drop-contexts wux-ui-3ds wux-ui-3ds-3d-object"}),w.columns.contextsColumn]),m.elements.label.setContent([e.createElement("i",{class:"where-to-drop-icon where-to-drop-reported-against wux-ui-3ds wux-ui-3ds-location"}),w.columns.reportedAgainstColumn]),p.elements.label.setContent([e.createElement("i",{class:"where-to-drop-icon where-to-drop-contexts-resolved-by fonticon fonticon-docs"}),w.columns.resolvedByColumn]),h.elements.label.setContent([e.createElement("i",{class:"where-to-drop-icon where-to-drop-resolved-items fonticon fonticon-markup-review"}),w.columns.resolvedItemsColumn]),f.elements.label.setContent([e.createElement("i",{class:"where-to-drop-icon where-to-drop-contexts-attachments fonticon fonticon-attach"}),w.columns.attachmentsColumn]);var b=e.createElement("div",{class:"where-to-drop-main-label",html:w.dnd.whereToDrop}),y=(r=_.getDroppableData(l).data.items).map(function(e){return e.i3dx&&""!=e.i3dx?e.i3dx:e.objectId}),S=[];r.map(function(e){e.path&&S.push(e.path.map(function(e){return e.resourceid}))});var C=[],T=0;S.map(function(e){var t=e.slice(-3);3==t.length?(C.push(t.join()),T++):1==t.length&&(C.push(t.join()),T++)}),y=y.sort().filter(function(e,t,n){return!t||e!==n[t-1]});var E=[b];E.push(m),E.push(v),E.push(I),E.push(u),E.push(f),E.push(h),E.push(p);var D=e.createElement("div",{html:E});return 0==T&&I.disable(),new t(function(e,t){var i=new a({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,minHeight:342,className:"drop-objects-issue-dialog",title:w.replace(w.dnd.dialogTitle,{number:y.length,issue:s.title+" ("+s.name+")"}),header:null,body:D,footer:[new n({value:w.dnd.attach,className:"primary drop-objects-issue-dialog-add",events:{onClick:function(){i.destroy();var t=!0===m.isChecked()?m.getValue():!0===p.isChecked()?p.getValue():!0===h.isChecked()?h.getValue():!0===f.isChecked()?f.getValue():u.getValue(),n=[];n="reportedAgainst"==t?v.isChecked()?y:C:y,e({ids:n,type:t,items:r})}}}),new n({value:w.dnd.cancel,className:"default drop-objects-issue-dialog-cancel",events:{onClick:function(){i.destroy(),c.utils.whereToAddModal=null,t(new Error("The dialog has been closed by the end user"))}}})],events:{onShow:function(){c.utils.whereToAddModal=i},onClose:function(){i.destroy(),c.utils.whereToAddModal=null,t(new Error("The dialog has been closed by the end user"))}}}).inject(d.body);new o({element:D}).inject(i.getBody()),i.show()})},addRelatedObjects:function(n,i,o){var a=this,r=g.get("widget")||window.widget,c=g.get("component");let d=[];d.push(n.node.options.physicalId),f.issues.retrieve({timestamp:null,data:{objects:d.map(function(e){return{physicalId:e}})},onComplete:function(e){n.node.options.reportedAgainst=e.results[0].body.reportedAgainst},onFailure:function(e){}}),_.related.whereToAddRelatedObjects.call(a,n,i,o).then(function(i){if(null===i)return t.resolve(null);var o=i.type,d=i.ids,u={};if(s.mask(r.body),u[n.id]={physicalId:n.id},"attachments"===o){var p=n.id,f=d,v=d.map(e=>e).indexOf(n.id);return-1!=v&&(d.splice(v,1),l.displayNotification({msg:C.notifications.Attach.sameIssueAttached,eventID:"error"}),0===d.length)?(s.unmask(r.body),!1):m.connectDocumentsToParent(d,n.id).then(function(n){if(1===f.length&&1===n.length&&n[n.length-1].response.success)return m.fetch(f).then(function(n){if(e.is(n.results,"array")){var i=n.results.map(function(e){return m.parseFromFetch(e)});if(1===i.length&&"image"===i[i.length-1].documentType){var s=i[i.length-1];return m.setAsPrimary(s.id,p).then(function(e){var t=JSON.parse(e);s.id===t.documentId&&l.displayNotification({msg:C.notifications.SetAsPrimary.success,eventID:"info"})}).catch(function(e){l.displayNotification({msg:C.notifications.SetAsPrimary.failure,eventID:"error"}),a._logger.error(e)})}return t.resolve()}throw new Error("Unexpected empty fetch results for setAsPrimary.")}).catch(function(){a._logger.error(new Error("Unexpected fetch error for setAsPrimary."))});if(1===n.length&&!n[0].response.success&&n[0].response.error.includes("Relationship already exists"))throw new Error("Already attached");if(1===n.length&&!n[0].response.success&&-1!==n[0].response.internalError.indexOf("1500028"))throw new Error("1500028");if(1===n.length&&!n[0].response.success&&-1!==n[0].response.internalError.indexOf("1500029"))throw new Error("MIB");return t.resolve()}).then(function(){var e={paths:[[p]],attributes:{}};e.attributes[p]={id:n.id,name:n.name,title:n.title,type:n.type,modifiedAttributes:["attachments"]},c.publishUpdate(e),c.document.refreshNodesById({modified:[n.id]})}).then(function(){s.unmask(r.body),l.displayNotification({msg:w.replace(w.notifications.attachSuccess.attachments,{count:f.length,issue:n.title+" ("+n.name+")"}),eventID:"success"})}).catch(function(e){D.error("Could not add attachment(s): %s",e),s.unmask(r.body),e.message.includes("Already attached")?l.displayNotification({msg:w.dnd.alreadyAttached,eventID:"info"}):e.message.includes("MIB")?l.displayNotification({msg:C.attachmentNotSupported,eventID:"error"}):e.message.includes("1500028")?h.displayErrorMessage(h.getErrorMessage("1500028_1"),"error"):l.displayNotification({msg:w.notifications.serverError,eventID:"error"})})}{if(i.items.forEach(e=>{e.serviceId.includes(":")&&(e.serviceId=e.serviceId.split(":")[0])}),"resolvedBy"==i.type){var I=d.indexOf(n.id);I>-1&&d.splice(I,1),0==d.length&&l.displayNotification({msg:w.resolvedBy.errorSameIssue,eventID:"error"})}var b=[];if(Array.isArray(n.node.options[i.type])?b=b.concat(n.node.options[i.type]):n.node.options[i.type]&&"physicalId"in n.node.options[i.type]&&b.push(n.node.options[i.type]),b.forEach(function(e){var t=d.indexOf(e.physicalId);"reportedAgainst"==i.type&&(t=d.indexOf(e.path.join())),t>-1&&(d.splice(t,1),l.displayNotification({msg:w.dnd.alreadyAttached,eventID:"info"}))}),0===d.length)return s.unmask(r.body),!1;let e=g.get(E),c=Object.keys(e["ds6w:type"]),m=[];i.items.forEach(e=>{c.includes(e.objectType)&&m.push(e.objectId)});let p=!1;switch(o){case"contexts":let e=d.filter(function(e){if(!m.includes(e))return e}).map(e=>(p=!0,{physicalId:e}));u[n.id].contexts=e.map(e=>{const t=i.items.findIndex(t=>e.physicalId.includes(t.objectId)||e.physicalId.includes(t.i3dx)),{objectType:n}=-1!==t?i.items[t]:{},{serviceId:s}=-1!==t?i.items[t]:{},{envId:o}=-1!==t?i.items[t]:{};return{...e,objectType:n,serviceId:s,envId:o}}),w.notifications.attachSuccessContexts;break;case"reportedAgainst":let t=d.sort().filter(function(e,t,n){if((!t||e!==n[t-1])&&!m.includes(e))return e}).map(function(e){return p=!0,{physicalId:e}});u[n.id].reportedAgainst=t.map(e=>{const t=i.items.findIndex(t=>e.physicalId.includes(t.objectId)||e.physicalId.includes(t.i3dx)),{objectType:n}=-1!==t?i.items[t]:{},{serviceId:s}=-1!==t?i.items[t]:{},{envId:o}=-1!==t?i.items[t]:{};return{...e,objectType:n,serviceId:s,envId:o}}),w.notifications.attachSuccessAffectedItems;break;case"resolvedBy":let s=d.sort().filter(function(e,t,n){return!t||e!==n[t-1]}).map(function(e){return p=!0,{physicalId:e}});u[n.id].resolvedBy=s.map(e=>{const t=i.items.findIndex(t=>e.physicalId.includes(t.objectId)||e.physicalId.includes(t.i3dx)),{objectType:n}=-1!==t?i.items[t]:{},{serviceId:s}=-1!==t?i.items[t]:{},{envId:o}=-1!==t?i.items[t]:{};return{...e,objectType:n,serviceId:s,envId:o}}),w.notifications.attachSuccessResolvedBy;break;case"resolvedItems":let a=d.sort().filter(function(e,t,n){if((!t||e!==n[t-1])&&!m.includes(e))return e}).map(function(e){return p=!0,{physicalId:e}});u[n.id].resolvedItems=a.map(e=>{const t=i.items.findIndex(t=>e.physicalId.includes(t.objectId)||e.physicalId.includes(t.i3dx)),{objectType:n}=-1!==t?i.items[t]:{},{serviceId:s}=-1!==t?i.items[t]:{},{envId:o}=-1!==t?i.items[t]:{};return{...e,objectType:n,serviceId:s,envId:o}}),w.notifications.attachSuccessResolvedItems}return p?a.document.addContextsOrReportedAgainstOrResolvedByOrResolvedItems(u).then(function(e){s.unmask(r.body);var t=[],i=[],a="",c="",u=0;e.forEach(e=>{e.body.responce.forEach(e=>{t.push(e.warning.slice(1,-1)),i.push(e.error.slice(1,-1)),2==e.warning.length&&2==e.error.length&&u++})}),t=new Set(t),i=new Set(i),t.forEach(e=>{a+=e}),i.forEach(e=>{c+=e}),a.length>0&&0==u?l.displayNotification({msg:a,eventID:"warning"}):c.length>0&&0==u?l.displayNotification({msg:c,eventID:"error"}):(a.length>0||c.length>0)&&0!=u?l.displayNotification({msg:w.successPartial,eventID:"warning"}):l.displayNotification({msg:w.replace(w.notifications.attachSuccess[o],{count:d.length,issue:n.title+" ("+n.name+")"}),eventID:"success"})},function(e){if(D.error("Could not add related object(s): %s",e),s.unmask(r.body),e.error.internal.includes("Verify that your responsibility and the maturity state of the Issue are compatible with this operation.ErrorCode:2005")){var t=h.getErrorMessage("2005");h.displayErrorMessage(t,"error")}else l.displayNotification({msg:e.error.message,eventID:"error"})}):(s.unmask(r.body),l.displayNotification({msg:w.dnd.partiallyNotSupported,eventID:"error"}),t.resolve(null))}})},uploadFilesAsAttachments:function(e,n){for(var i=this,s=g.get("widget")||window.widget,o=g.get("component"),a=function(e){this.set("isCancelable",!0),this.set("request",e)},r=function(e){if(e.lengthComputable){var t=e.loaded/e.total;this.set("requestProgress",t)}},h=function(){this.set("isCancelable",!1),this.set("request",null)},f=e.id,v=new d({id:f}),I=[],b=[],y=0;y<n.length;y++){var S=n[y],T="temporary_"+Math.floor(Date.now())+"_"+y,E=S.type,_={id:T,title:S.name,type:"Document",dispType:C.views.Attachment.types.Document,owner:{firstName:c.getUser().firstName,fullName:c.getUser().firstName.trim()+" "+c.getUser().lastName.trim(),lastName:c.getUser().lastName,user:c.getUser().login},relOwner:{firstName:c.getUser().firstName,fullName:c.getUser().firstName.trim()+" "+c.getUser().lastName.trim(),lastName:c.getUser().lastName,user:c.getUser().login},relOriginated:(new Date).toString()};S.hasOwnProperty("lastModifiedDate")?S.lastModifiedDate instanceof Date?(_.modified=S.lastModifiedDate.toString(),_.created=S.lastModifiedDate.toString()):(_.modified=new Date(S.lastModifiedDate).toString(),_.created=new Date(S.lastModifiedDate).toString()):(_.modified=(new Date).toString(),_.created=(new Date).toString());var A=new u(_);A.set("isProcessing",!0),A.setDocumentTypeByMIME(E),I.push(A);var M=function(e){return{file:{tempId:this.tempId,type:this.type},response:e}},N=m.uploadFile(S,v.id,{onCheckinStart:a.bind(A),onCheckinProgress:r.bind(A),onCheckinComplete:h.bind(A)});b.push(N.then(M.bind({tempId:T,type:E})).catch(M.bind({tempId:T,type:E})))}v.add(I,{sort:!1}),new p({container:s.body,collection:v}).render();var x=t.all(b).then(function(n){for(var s=0,o=0;o<n.length;o++){var a=n[o].file.tempId,r=n[o].file.type,d=n[o].response;if(d.success){s+=1,v.get(a).set("isProcessing",!1),v.remove(a);var p=d.data[0],h=m.parseDocument(p);h.relOwner={firstName:c.getUser().firstName,fullName:c.getUser().firstName.trim()+" "+c.getUser().lastName.trim(),lastName:c.getUser().lastName,user:c.getUser().login},h.relOriginated=(new Date).toString();var g=new u(h);g.set("iconUrl",g.get("thumbnailUrl")),g.setDocumentTypeByMIME(r),v.add(g)}else v.get(a).set("isFailed",!0),v.get(a).set("isProcessing",!1),v.get(a).set("isCancelable",!1),v.get(a).set("request",null),d instanceof Error&&D.error(d)}var I=t.resolve();if(s>0){if(1===v.size()&&"image"===v.at(0).get("documentType")){var b=v.at(0);I=m.setAsPrimary(b.id,f).then(function(e){var t=JSON.parse(e);b.id===t.documentId&&l.displayNotification({msg:C.notifications.SetAsPrimary.success,eventID:"info"})}).catch(function(e){l.displayNotification({msg:C.notifications.SetAsPrimary.failure,eventID:"error"}),i._logger.error(e)})}l.displayNotification({msg:w.replace(C.notifications.Upload.successIssue,{count:s,issue:e.title+" ("+e.name+")"}),eventID:"success"})}return s!==n.length&&l.displayNotification({msg:w.replace(C.notifications.Upload.failure,{count:n.length-s}),eventID:"error"}),I}).then(function(){var t={paths:[[e.id]],attributes:{}};t.attributes[e.id]={id:e.id,name:e.name,title:e.title,type:e.type,modifiedAttributes:["attachments"]},o.publishUpdate(t),o.document.refreshNodesById({modified:[e.id]})}).catch(function(e){D.error(e)});return{collection:v,promise:x}}},events:{onDropCell:function(e,t){e.preventDefault();var n=null,i=(n=t.nodeModel.options.baseType!==T?t.nodeModel.getParent():t.nodeModel).options.id,s=n.options.type,o=n.options.name,a=n.options.title,r=_.getDroppableData(e);if(!r)return l.displayNotification({msg:w.dnd.notSupported,eventID:"warning"}),!1;if(r.hasOwnProperty("files")&&r.files instanceof FileList)_.related.uploadFilesAsAttachments.call(this,{node:n,id:i,type:s,name:o,title:a},r.files);else{if(!h.isValid3DXContent(r)||!r.data.items.length)return l.displayNotification({msg:w.dnd.notSupported,eventID:"warning"}),!1;_.related.addRelatedObjects.call(this,{node:n,id:i,type:s,name:o,title:a},r.data.items,e)}return!0}},makeDroppable:function(t,n){var i=this;y.droppable(t,{drop:function(t,s,o){if(o.stopPropagation&&o.stopPropagation(),o.preventDefault&&o.preventDefault(),o.dataTransfer&&o.dataTransfer.dropEffect&&(o.dataTransfer.dropEffect="copy"),e.is(t)&&""!=t){var a=JSON.parse(t);i.ExecuteDrop(a,n)}}})},ExecuteDrop:function(t,n){if(t){var i=t.data.items;e.is(i)&&e.is(i.length)&&i.length>0&&n(i)}},onToolbarDrop:function(e){var t=[],n=[];e.forEach(e=>{e.displayType===T||e.objectType==T?t.push(e.objectId):e.hasOwnProperty("objectType")?n.push(e.objectType):n.push(e.displayType)}),S.getTypesHierarchy(n).then(n=>{e.forEach(e=>{(n[e.objectType]||n[e.displayType])&&(n[e.objectType].hierarchy.includes(T)||n[e.displayType].hierarchy.includes(T))&&t.push(e.objectId)})}).then(()=>{f.getAdditionalObjectInfo({pidArray:t}).then(e=>{for(var n=0;n<t.length;n++)if("Issue Template"==e.additionObjectInfo[t[n]].policy){const e=t.indexOf(t[n]);e>-1&&(t.splice(e,1),n=-1)}if(t.length>0){widget.setValue("filter",JSON.stringify({session:!0})),widget.setValue("roots",t),widget.dispatchEvent("onRefresh")}else l.displayNotification({msg:w.dnd.notSupported,eventID:"warning"})})})}};return _}),define("DS/IssueManagement/views/facets/Team",["UWA/Class/View","UWA/Core","DS/UIKIT/Scroller","DS/IssueComponents/team/Team","DS/IssueComponents/team/TeamNew","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","css!DS/IssueManagement/IssueManagement.css"],function(e,t,n,i,s,o,a,r){"use strict";return e.extend({name:"DS/IssueManagement/views/facets/Team",tag:"div",className:"team-view fade-in-element",defaultOptions:{physicalIds:[]},team:null,_subscriberId:"",_eventListeners:[],setup:function(e){var t=this;r.start(t.name+" setup"),t._parent(e),t.team=new s({physicalIds:t.getOption("physicalIds")}),t._subscriberId=Math.random().toString(36).substr(2,9),t.listenTo(t.team,"onReady",function(e){t.dispatchEvent("onReady",e)}),t.listenTo(t.team,"onFailure",function(e){t.dispatchEvent("onFailure",e)}),t.listenTo(t.team,"onUpdate",function(e){for(var n=[],i={},s=Object.keys(e.issues),a=0;a<s.length;a++)n.push([e.issues[s[a]].id]),i[e.issues[s[a]].id]={id:e.issues[s[a]].id,type:e.issues[s[a]].type,name:e.issues[s[a]].name,title:e.issues[s[a]].title,modifiedAttributes:["assignees"]};o.get("eventsHandler").publish(t._subscriberId,"DS/Object/update",{metadata:{appId:o.get("widget").id,appName:o.get("widget").name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:n,attributes:i},version:"1.0"})}),t._eventListeners=[{event:"DS/Object/update",listener:function(e){t.team&&t.team.physicalIds&&(e.data.paths.some(function(e){return-1!==t.team.physicalIds.indexOf(e[0])})&&t.team.refresh())},conditions:{type:"issue",attributes:["owner","assignees"]}}];for(var n=0;n<t._eventListeners.length;n++){var i=t._eventListeners[n];i.token=o.get("eventsHandler").subscribe(t._subscriberId,i.event,i.listener.bind(t),i.conditions)}r.end(t.name+" setup")},render:function(){return r.start(this.name+" render"),this.team.render().inject(this.container),r.end(this.name+" render"),this},refresh:function(e){return this.setOption("physicalIds",e),this.team.refresh(e)},destroy:function(){if(this.stopListening(this.team,"onReady"),this.stopListening(this.team,"onFailure"),this.stopListening(this.team,"onUpdate"),Array.isArray(this._eventListeners))for(var e=0;e<this._eventListeners.length;e++){var t=this._eventListeners[e];o.get("eventsHandler").unsubscribe(t.token)}this._eventListeners=[],this._subcriberId="",this.team.destroy(),this.team=null,this.container.empty()}})}),define("DS/IssueManagement/components/information/Content",["UWA/Class/View","UWA/Core","UWA/Class/Promise","DS/Controls/TabBar","DS/Controls/TooltipModel","DS/Logger/Logger","DS/IssueCommon/utils/Utils","DS/IssueCommon/commands/CommandsManager","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a,r,l,c,d){"use strict";var u={ELEMENTS:{VIEW_CONTAINER:"im-information-content-view",COMPACT:"compact"},DIMENSIONS:{MIN_WIDTH:420}},m="properties";return e.extend({name:"DS/IssueManagement/components/information/Content",tagName:"div",className:"im-information-content",_logger:null,views:{facets:{},current:"",indexes:{}},physicalIds:[],tabs:null,elements:{view:null},setup:function(e){c.start(this.name+" setup"),this._parent(e),this._logger=o.getLogger(this.name),this.views={facets:{},current:m,indexes:{}},this.customEvents=e.customEvents,this.views.facets={properties:{index:0,name:"properties",label:d.information.views.properties,icon:"newspaper",module:"DS/IssueManagement/views/facets/Properties",instance:null,isInstantiating:!1,toBeRefreshed:!1},relatedObjects:{index:1,name:"relatedObjects",label:d.information.views.relatedObjects,icon:"location",module:"DS/IssueManagement/views/facets/RelatedContent",instance:null,isInstantiating:!1,toBeRefreshed:!1},attachments:{index:2,name:"attachments",label:d.information.views.attachments,icon:"attach",module:"DS/IssueManagement/views/facets/Attachments",instance:null,isInstantiating:!1,toBeRefreshed:!1},team:{index:3,name:"team",label:d.information.views.team,icon:"users",module:"DS/IssueManagement/views/facets/Team",instance:null,isInstantiating:!1,toBeRefreshed:!1},comments:{index:4,name:"comments",label:d.information.views.comments,icon:"chat",module:"DS/IssueManagement/views/facets/Comments",instance:null,isInstantiating:!1,toBeRefreshed:!1},relations:{index:5,name:"relations",label:d.information.views.relations,icon:"object-related",module:"DS/IssueManagement/views/facets/Relations",instance:null,isInstantiating:!1,toBeRefreshed:!1},history:{index:6,name:"history",label:d.information.views.history,icon:"navigation-history",module:"DS/IssueManagement/views/facets/History",instance:null,isInstantiating:!1,toBeRefreshed:!1}},this.physicalIds=[],this.tabs=null,this.elements={view:null},c.end(this.name+" setup")},render:function(){var e=this;c.start(e.name+" render");var n=e.tabs=new i({displayStyle:"strip",showComboBoxFlag:!0,editableFlag:!1,multiSelFlag:!1,reindexFlag:!0,touchMode:!0,centeredFlag:!1,allowUnsafeHTMLOnTabButton:!0}),o=Object.keys(e.views.facets);return o.forEach(function(t){var i=e.views.facets[t],o=new s({shortHelp:i.label}),r=n.add({index:i.index,isSelected:t===e.views.current,label:i.label,icon:{iconName:i.icon,fontIconFamily:1},showTitleFlag:!0,tooltipInfos:o});0==a.get3DSwymUrl()&&"comments"==t&&(r.visibleFlag=!1),e.views.indexes[i.index]=t}),n.inject(e.container),n.addEventListener("change",function(){var i=n.value[n.value.length-1];t.is(e.views.indexes)&&t.is(e.views.indexes[i])&&(e.views.current=e.views.indexes[i],e.refresh(e.physicalIds,{force:!1}));var s="";0==i?s="Properties":1==i?s="ContentToolbar":2==i?s="AttachmentToolbar":3==i?s="MembersToolbar":5==i?s="InformationRelations":6==i&&(s="InformationHistory");try{a.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:s}})}catch(e){}}),o.forEach(function(i){var s=e.views.facets[i].index;n.buttonGroup.getButton(s).elements.container.addEventListener("dragover",function(){n.value[n.value.length-1]!==s&&n.buttonGroup.selectIndex(s)});let o=n.buttonGroup.getButton(s).elements.container;(n.buttonGroup.getButton(s).elements.iconContentCount=t.createElement("span",{class:"im-tab-content-count"})).inject(o)}),e.customEvents.subscribe({event:"im-update-tab-count"},function(t){t.tabs.forEach(function(i,s){let o=e.views.facets[i].index,a=n.buttonGroup.getButton(o).elements.iconContentCount;""===t.count[s]?a.innerHTML="":a.innerHTML=`(${t.count[s]})`})}),e.customEvents.subscribe({event:"im-information-empty-close"},function(e){r.getCommand("ToggleInformationPanel").begin({open:!1,save:!0})}),e.elements.view=t.createElement("div",{class:u.ELEMENTS.VIEW_CONTAINER}),e.elements.view.inject(e.container),c.end(e.name+" render"),e},destroy:function(){this.views={facets:{},current:"",indexes:{}},this.physicalIds=[],this.tabs.destroy(),this.tabs=null,this.elements={view:null},this.container.empty()},refresh:function(e,i){var s=this,o=n.resolve(),r=s.views.current;if(!Array.isArray(e)||0===e.length)return o;s.physicalIds=e;var l=Object.keys(s.views.facets);l.forEach(function(e){var t=s.views.facets[e];null!==t.instance&&t.instance.container.addClassName("hidden")}),a.Mask.mask(s.elements.view);var c=s.views.facets[[s.views.current]];return null===c.instance?!0!==c.isInstantiating&&(c.isInstantiating=!0,o=new n(function(e,t){require([c.module],function(n){c.instance=new n({physicalIds:s.physicalIds}),s.listenToOnce(c.instance,"onReady",function(){e()}),s.listenToOnce(c.instance,"onFailure",function(e){s._logger.error("Refresh has failed: %o",e.error),t(e.error)}),c.isInstantiating=!1,c.instance.render().inject(s.elements.view),c.instance.container.addClassName("visible"),s.views.current===c.name?c.instance.container.addClassName("visible"):c.instance.container.addClassName("hidden"),a.Mask.unmask(s.elements.view)})})):(c.instance.container.addClassName("visible"),c.instance.container.removeClassName("hidden"),i&&!0===i.force?(o=c.instance.refresh(s.physicalIds).then(function(){t.is(c.instance.resize,"function")&&c.instance.resize(),a.Mask.unmask(s.elements.view)}),l.forEach(function(e){var t=s.views.facets[e];t&&t!==c&&null!==t.instance&&(t.toBeRefreshed=!0)})):!0===c.toBeRefreshed?o=c.instance.refresh(s.physicalIds).then(function(){t.is(c.instance.resize,"function")&&c.instance.resize(),a.Mask.unmask(s.elements.view),c.toBeRefreshed=!1}):(t.is(c.instance.resize,"function")&&c.instance.resize(),a.Mask.unmask(s.elements.view))),o.then(function(){s.dispatchEvent("onReady",{view:r})})},resize:function(){var e=this;e.container.toggleClassName(u.ELEMENTS.COMPACT,e.container.getParent()&&e.container.getParent().offsetWidth<u.DIMENSIONS.MIN_WIDTH),Object.keys(e.views.facets).forEach(function(n){var i=e.views.facets[n];null!==i.instance&&t.is(i.instance.resize,"function")&&i.instance.resize()})},switchFacet:function(e){var t=this,i=t.tabs;return t.views.current===e?n.resolve(t.views.facets[e].instance):new n(function(n){t.listenToOnce(t,"onReady",function(e){n(t.views.facets[e.view].instance)}),i.buttonGroup.selectIndex(t.views.facets[e].index)})},getFacet:function(e){return this.views.facets[e]},getCurrentFacet:function(){return this.views.facets[this.views.current]},getTabs:function(){return this.tabs}})}),define("DS/IssueManagement/commands/SelectAllIssues",["UWA/Class","DS/ApplicationFrame/Command"],function(e,t){"use strict";return e.extend(t,{name:"DS/IssueManagement/commands/SelectAllIssues",execute:function(){var e=this;require(["UWA/Class/Promise","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],function(t,n,i){var s=n.get("component").getTreeDocument();i.start(e.name+" execute"),s.withBroadcastSelect(new t(function(t){s.withTransactionUpdate(function(){s.unselectAll();for(var n=s.getRoots(!1),o=0;o<n.length;o++)n[o].select();i.end(e.name+" execute"),t()})}))})}})}),define("DS/IssueManagement/commands/UnselectAll",["UWA/Class","DS/ApplicationFrame/Command"],function(e,t){"use strict";return e.extend(t,{name:"DS/IssueManagement/commands/UnselectAll",execute:function(){var e=this;require(["UWA/Class/Promise","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],function(t,n,i){var s=n.get("component").getTreeDocument();i.start(e.name+" execute"),s.withBroadcastSelect(new t(function(t){s.withTransactionUpdate(function(){s.unselectAll(),i.end(e.name+" execute"),t()})}))})}})}),define("DS/IssueManagement/commands/Find",["UWA/Class","DS/ApplicationFrame/CommandCheckHeader"],function(e,t){"use strict";return e.extend(t,{init:function(e){},execute:function(){}})}),define("DS/IssueManagement/views/facets/Related",["UWA/Core","UWA/Class/View","DS/IssueComponents/related/Related","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","css!DS/IssueManagement/IssueManagement.css"],function(e,t,n,i,s){"use strict";return t.extend({name:"DS/IssueManagement/views/facets/Related"})}),define("DS/IssueManagement/commands/SwitchLayout",["UWA/Core","UWA/Class","DS/ApplicationFrame/Command"],function(e,t,n){"use strict";return t.extend(n,{name:"DS/IssueManagement/commands/SwitchLayout",begin:function(e){this.execute(e)},execute:function(e){var t=this;require(["DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],function(n,i){i.start(t.name+" execute"),n.get("information").setLayout(e.layout),n.get("actionBar").updateLayoutSwitcher(),i.end(t.name+" execute")})}})}),define("DS/IssueManagement/components/header/Find",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Text","DS/UIKIT/Tooltip","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a){"use strict";return e.extend({name:"DS/IssueManagement/components/header/Find",tagName:"div",className:"find-container",_logger:null,domEvents:{"keyup input.find-input":"_onSearch","paste input.find-input":"_onSearch","click div.clear-cont":"_onClear","click div.fonticon-down-open":"_onNext","click div.fonticon-up-open":"_onPrevious","click div.fonticon-select-on":"_onSelect"},setup:function(e){o.start(this.name+" setup"),o.end(this.name+" setup")},render:function(){return o.start(this.name+" render"),o.end(this.name+" render"),this},destroy:function(){}})}),define("DS/IssueManagement/views/facets/Properties",["UWA/Class/Promise","UWA/Core","UWA/Class/View","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/models/EditPropModel","DS/PADUtils/views/PADAlert","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","css!DS/IssueCommon/IssueCommon.css"],function(e,t,n,i,s,o,a,r,l,c,d){"use strict";return n.extend({name:"DS/IssueCommon/views/PropertiesView",tag:"div",className:"properties-view fade-in-element",defaultOptions:{physicalIds:[]},properties:{component:"",selection:[],promises:[]},_timestampUpdate:0,_subscriberTokens:[],_subscriberId:"",_eventListeners:[],setup:function(e){c.start(this.name+" setup"),this._parent(e),this.properties={component:null,selection:[],promises:[]},this._timestampUpdate=0,this._subscriberTokens=[];var t={getSecurityContext:function(){return{SecurityContext:"ctx::"+decodeURIComponent(l.getSecurityContext())}}};this.properties.component=new s({setEditButton:!0,readOnly:!1,warningOnUnsaved:!1,selectionType:i.NO_SELECTION,typeOfDisplay:i.ONLY_EDIT_PROPERTIES,context:t,events:{onNotification:function(e){a.displayNotification({msg:e.msg,eventID:"error"})}}}),this._subscribers(),c.end(this.name+" setup")},render:function(){return c.start(this.name+" render"),this.properties.component.inject(this.container),this.refresh(this.getOption("physicalIds")),c.end(this.name+" render"),this},refresh:function(t){var n=this;try{d.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"Properties"}})}catch(e){}finally{n.setOption("physicalIds",t),n.properties.selection.forEach(function(e){e.destroy()}),n.properties.selection=[],n.properties.promises=[],t.forEach(function(t){var i=new o({metatype:"businessobject",tenant:l.getTenant(),objectId:t});i.addEvent("onChangeAttributes",function(e,t){if(e.changedValues&&(e.changedValues.hasOwnProperty("Estimated Start Date")||e.changedValues.hasOwnProperty("Resolution Date"))){var n=e._attributes["Estimated Start Date"].valueDB,i=new Date(n),s=e._attributes["Resolution Date"].valueDB;if(i>new Date(s)){var o=d.getErrorMessage("12");d.displayErrorMessage(o,"error"),t.forEach(function(t){"Estimated Start Date"==t.name?e._attributes["Estimated Start Date"].resetInitialValues():"Resolution Date"==t.name&&e._attributes["Resolution Date"].resetInitialValues()})}}}),n.properties.promises.push(new e(function(e){i.listenToOnce(i,"onSave",function(){e(this)})})),n.properties.selection.push(i)}),n.properties.component.initDatas(n.properties.selection),e.all(n.properties.promises).then(function(e){n._onSave(e)});return(n.properties.component.getListModel().length,e.resolve()).then(function(){n.dispatchEvent("onReady",{})})}},destroy:function(){this._subscriberTokens.forEach(function(e){r.get("eventsHandler").unsubscribe(e)}),this._subscriberTokens=[],this._timestampUpdate=0;try{this.properties.selection.forEach(function(e){e.destroy()})}catch(e){}try{this.properties.component.destroyComponent()}catch(e){}this.properties={component:null,selection:[],promises:[]},this.container.empty()},_onSave:function(t){var n=this;if(c.start(n.name+" _onSave"),n.properties.promises=[],n.properties.selection.forEach(function(t){n.properties.promises.push(new e(function(e){t.listenToOnce(t,"onSave",function(){e(this)})}))}),0!==n.properties.promises.length){e.all(n.properties.promises).then(function(e){n._onSave(e)});for(var i=[],s={},o=0;o<t.length;o++){var a=t[o].get("objectId");i.push([a]),s[a]={id:a,type:t[o].get("type").value,name:t[o].get("name").value,title:t[o].get("Title").value,modifiedAttributes:["*"]}}r.get("eventsHandler").publish(n._subscriberId,"DS/Object/update",{metadata:{appId:r.get("widget").id,appName:r.get("widget").name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:i,attributes:s},version:"1.0"});try{var l=r.get("component").getCurrentView();d.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:l,pd3:"Properties",pd4:"Edit",pd5:"Issue/"+l+"/Properties/Edit"}})}catch(e){}c.end(n.name+" _onSave")}},_subscribers:function(){var e=this,t=r.get("eventsHandler");e._subscriberId=Math.random().toString(36).substr(2,9),e._eventListeners=[{event:"DS/Object/update",listener:function(t){c.start(e.name+" DS/Object/update");var n=e.properties.selection.reduce(function(e,t){return e.push(t.get("objectId")),e},[]);t.data.paths.reduce(function(e,t){return e.push(t.pop()),e},[]).filter(function(e){return n.includes(e)}).length>0&&(e.properties.promises=[]),c.end(e.name+" DS/Object/update")},conditions:{type:"issue"}}];for(var n=0;n<e._eventListeners.length;n++){var i=e._eventListeners[n];i.token=t.subscribe(e._subscriberId,i.event,i.listener.bind(e),i.conditions)}}})}),define("DS/IssueManagement/commands/Detach",["UWA/Class","DS/ApplicationFrame/Command"],function(e,t){"use strict";return e.extend(t,{dialog:null,execute:function(){var e=this;require(["UWA/Core","UWA/Class/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/PADUtils/views/PADAlert","DS/IssueServices/Contexts","i18n!DS/IssueManagement/assets/nls/IssueManagement","DS/IssueManagement/commands/CommandsManager"],function(t,n,i,s,o,a,r,l,c,d){var u=l.get("widget")||window.widget;if(!u.body.getElement(".detach-objects-issue-dialog")){for(var m=l.get("component"),p=m.getSelectedNodes(),h={},g=[],f=0;f<p.length;f++){var v=p[f].options.id,I=p[f].options.data.issue,b=p[f].options.data.relationToIssue,y=p[f].options.title;y=p[f].options.name&&""!=p[f].options.name?y+" ("+p[f].options.name+")":y,g.push(y),void 0===h[I]&&(h[I]={physicalId:I}),void 0===h[I][b]&&(h[I][b]=[]),h[I][b].push({physicalId:v})}new n(function(n,s){var r=[];g.forEach(function(e){r.push(t.createElement("li",{html:e,title:e}))});var l=t.createElement("div",{html:[c.related.confirmDetach,t.createElement("ul",{class:"detach-objects-issue-dialog-ul",html:r})]}),d=null,m=e.dialog=new a({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"detach-objects-issue-dialog",title:c.replace(c.related.dialogTitle,{number:p.length,issues:Object.keys(h).length}),header:null,body:l,footer:[d=new i({value:c.related.detach,className:"primary detach-objects-issue-dialog-add",events:{onClick:function(){m.destroy(),e.dialog=null,n()}}}),new i({value:c.related.cancel,className:"default detach-objects-issue-dialog-cancel",events:{onClick:function(){m.destroy(),e.dialog=null,s(new Error("The dialog has been closed by the end user"))}}})],events:{onClose:function(){m.destroy(),e.dialog=null,s(new Error("The dialog has been closed by the end user"))}}}).inject(u.body);new o({element:l}).inject(m.getBody()),m.show(),d.focus()}).then(function(){s.mask(u.body),m.getTreeDocument().removeContextsOrReportedAgainstOrResolvedByOrResolvedItems(h).then(function(){s.unmask(u.body),r.displayNotification({msg:c.notifications.detachSuccess,eventID:"success"}),d.enable(["Export"])},function(){s.unmask(u.body)})})}})}})}),define("DS/IssueManagement/utils/BIFilter",["UWA/Class","UWA/Class/Promise","UWA/Core","DS/Logger/Logger","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a,r){"use strict";var l="IN";return e.extend({name:"DS/IssueManagement/utils/BIFilter",_loggerBIFilter:null,_biFilter:null,_isBIFilterInitialized:!1,_initializationPromiseBIFilter:null,_isBIFilterActivated:!1,_isBIFilterSelected:!1,_persistence:{filter:!1,dialog:null},initializeBIFilter:function(){var e=s.get("widget")||window.widget;o.start(this.name+" initializeBI"),this._loggerBIFilter=i.getLogger("DS/IssueManagement/View"),e.addEvent("endEdit",this._onModifyPreferences.bind(this)),this.document.addEventListener("setPathTags",this._onSetPathTags.bind(this)),this._initializationPromiseBIFilter=this._createBIFilterProxy(),this._isBIFilterActivated=!0===this.utils.isActivateBIFilter(),this.listView=s.get("ISU_LISTVIEW"),o.end(this.name+" initializeBI")},focusOnSubjects:function(e){var t=this._biFilter;if(t&&t._biFilter){if(0===e.length)return void t._biFilter.unfocus();for(var n={},i=[],s=0;s<e.length;s++)n[e[s].options.physicalId]="3DSpace",i.push("pid://"+e[s].options.physicalId);t._biFilter.myTagProxy.focusOnSubjects(i,!0,n)}},_onSetPathTags:function(e){var t=this,n=s.get("widget")||window.widget;!1!==t._isBIFilterInitialized?(t._loggerBIFilter.info("Setting the path tags for %s %s",n.name,n.id),!0===t.utils.isActivateBIFilter()&&setTimeout(function(){o.start(t.name+" _onSetPathTags");var n={nodes:[],paths:[]},i={};t.document.getRoots().forEach(function(e){if(!e.isHidden()){var t=e.getPath().map(function(e){var t=e.options.id;return i.hasOwnProperty(t)||(n.nodes.push(t),i[t]=n.nodes.length-1),i[t]});n.paths.push(t)}}),e&&null==e.data&&(e.data=!1),t._isBIFilterSelected&&!e.data||t._cleanBIFilterProxy(),t._biFilter.setTagsWithFetchSynthesis(n.nodes,function(e){if(e&&e.error){var t=a.getErrorMessage("300");a.displayErrorMessage(t,"error")}else s.get("widget").dispatchEvent("onSetPathTags")}),o.end(t.name+" _onSetPathTags")},0)):t._initializationPromiseBIFilter.then(function(){t._onSetPathTags(e)})},setLocalPathTags:function(){null!==this._persistence.dialog&&this._persistence.dialog.destroy();var e=s.get("widget").getValue("pathTags");this._persistence.filter&&n.is(e,"object")&&this._biFilter._biFilter.myTagProxy.setLocalFilter(e)},loadBIFilterPreference:function(){var e=this,t=s.get("widget")||window.widget,i=t.getValue("pathTags");e.utils.isActivateBIFilter()&&n.is(i,"object")&&(e._persistence.filter=!0,require(["DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/ENOFloatingPanel/ENOFloatingPanel"],function(n,i,s){e._persistence.dialog=new s({animate:!0,autocenter:!0,closable:!1,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"tagger-issues-dialog",title:r.tagger.waiting.title,header:null,body:null,footer:[new n({value:r.tagger.cancel,className:"primary",events:{onClick:function(){e._persistence.filter=!1,e._persistence.dialog.destroy(),e._persistence.dialog=null,t.deleteValue("pathTags")}}})]}).inject(t.body),i.mask(e._persistence.dialog.getBody(),r.tagger.waiting.label)}))},_createBIFilterProxy:function(){var e=this;o.start(e.name+" _createBIFilterProxy");var n=s.get("widget")||window.widget;return new t(function(t,i){require(["DS/ENOFilterBIUX/FilterBIComponentProxy","DS/IssueServices/services/PlatformServices"],function(s,a){var r={tenant:a.getTenant(),processingMode:"appProcessing",colorize:!0,widgetId:n.id};try{e._biFilter=new s(r),e._biFilter.addEvent("fetchFilterBIColorizeEvent",e._onFilterBIColorize,e),e._biFilter.addEvent("FilterBIUnColorize",e._onFilterBIUnColorize,e),e._biFilter.addEvent("fetchFilterBIFilteringEvent",e._onFilterBIFilteringEvent,e)}catch(e){i(new Error("The BIFilter proxy could not be initialized: "+e))}e._isBIFilterInitialized=!0,t(),o.start(e.name+" _createBIFilterProxy")})})},_cleanBIFilterProxy:function(){o.start(this.name+" cleanProxy"),this._biFilter&&this._biFilter.cleanProxy&&this._biFilter.cleanProxy(),o.end(this.name+" cleanProxy")},_onModifyPreferences:function(){var e=this;!1!==e._isBIFilterInitialized?(o.start(e.name+" _onModifyPreferences"),!0===e.utils.isActivateBIFilter()&&!1===e._isBIFilterActivated?(e._isBIFilterActivated=!0,!1===e._isBIFilterInitialized?e._initializationPromiseBIFilter=e._createBIFilterProxy():(e._biFilter.addEvent("fetchFilterBIColorizeEvent",e._onFilterBIColorize,e),e._biFilter.addEvent("FilterBIUnColorize",e._onFilterBIUnColorize,e),e._biFilter.addEvent("fetchFilterBIFilteringEvent",e._onFilterBIFilteringEvent,e),e._onSetPathTags())):!0===e._isBIFilterInitialized&&!1===e.utils.isActivateBIFilter()&&(e._isBIFilterActivated=!1,e._cleanBIFilterProxy(),e._biFilter.setPathTags({nodes:[],paths:[]}),e._biFilter.removeEvent("fetchFilterBIColorizeEvent",e._onFilterBIColorize,e),e._biFilter.removeEvent("FilterBIUnColorize",e._onFilterBIUnColorize,e),e._biFilter.removeEvent("fetchFilterBIFilteringEvent",e._onFilterBIFilteringEvent,e)),o.end(e.name+" _onModifyPreferences")):e._initializationPromiseBIFilter.then(function(){e._onSetPathTags()})},_onFilterBIColorize:function(e){var t=this;o.start(t.name+" _onFilterBIColorize"),t.listView&&!0===t.document.getComponent().getTreeListView().getManager().isColumnHidden("biColor")&&t.document.getComponent().getTreeListView().getManager().showColumn("biColor"),t.document.withTransactionUpdate(function(){for(var i=t.document.getRoots(!1),s=0;s<i.length;s++){var a={grid:{biColor:"rgba(0, 0, 0, 0)"}};i[s].updateOptions(a);for(var r=i[s].getAllDescendants(),l=0;l<r.length;l++)r[l].updateOptions(a)}let c=new Map;var d,u;i.forEach(e=>{let t=e.options.physicalId;c.set(t,e)}),d=e,u=function(e,t){let n=c.get(t);if(n){var i={grid:{biColor:e},color:e};n.updateOptions(i)}},n.is(d,"array")?d.forEach(function(e){var t=e.color,n=e.id;u(t,n)}):t._loggerBIFilter.error("Invalid Argument : %o",e),o.end(t.name+" _onFilterBIColorize")})},_onFilterBIUnColorize:function(){var e=this;e.document.withTransactionUpdate(function(){for(var t=e.document.getRoots(!1),n=0;n<t.length;n++){var i={grid:{biColor:"rgba(0, 0, 0, 0)"},color:"rgba(0, 0, 0, 0)"};t[n].updateOptions(i);for(var s=t[n].getAllDescendants(),o=0;o<s.length;o++)s[o].updateOptions(i)}}),e.listView&&!0!==e.document.getComponent().getTreeListView().getManager().isColumnHidden("biColor")&&e.document.getComponent().getTreeListView().getManager().hideColumn("biColor")},_onFilterBIFilteringEvent:function(e){var t=this;t.document.withTransactionUpdate(function(){var i=t.document.getRoots(!0).slice(0);i.forEach(function(e){e.filterIn(!0)});var o=e.matchingIDs;if(o&&Array.isArray(o)){let n=new Map;t.document.getRoots(!1).forEach(e=>{let t=e.options.physicalId;n.set(t,e)}),o.forEach(e=>{let t=n.get(e);t&&(t._filterStatus=l,t.getParents().forEach(function(e){e._filterStatus=l}))});i.forEach(function(e){var t,n;(t=e)._filterStatus===l||(t.filterOut(),n&&n.push(t)),delete t._filterStatus}),i.length!=o.length||Object.keys(e.allfilters).length>0?t._isBIFilterSelected=!0:t._isBIFilterSelected=!1}else t._loggerBIFilter.error("The filtering argument is invalid: %o",e);t.dispatchEvent("setPathTags",{});var a=s.get("widget")||window.widget;e&&n.is(e.localfilters,"object")&&Object.keys(e.localfilters).length>0?a.setValue("pathTags",e.localfilters):a.deleteValue("pathTags")})},utils:{isActivateBIFilter:function(){var e=s.get("widget")||window.widget,t=!1;if(n.is(e.getPreference("activateBIFilter"),"object")){var i=e.getValue("activateBIFilter");t=n.is(i,"boolean")?i:"true"===i}return t}}})}),define("DS/IssueManagement/components/idcard/IssueMaturity",["UWA/Class/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Tooltip","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/PADUtils/views/PADAlert","DS/LifecycleCmd/MaturityCmd","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueAttachmentManager/components/Collection","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueAttachmentManager/views/UploadDialog","i18n!DS/IssueAttachmentManager/assets/nls/IssueAttachmentManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/create/Attachments","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/ChangeMaturityWidget/ChangeMaturityWidget"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p,h,g,f,v){var I={enableMaturityActions:!1,STATES_VALUES:["Create","Assign","Active","Review","Closed"],CSS:{ELEMENTS:{GRAPH_STATE_APPROVE:"fonticon fonticon-thumbs-up im-lifecycle-new graph-state-approve",GRAPH_STATE_REJECT:"fonticon fonticon-thumbs-down im-lifecycle-new graph-state-reject",GRAPH_STATE_INPROGRESS:"fonticon-hourglass wux-ui-3ds im-lifecycle-new graph-state-inprogress",GRAPH_HISTORY_APPROVED:"fonticon fonticon-check im-lifecycle-new graph-history-approved ",GRAPH_HISTORY_REJECTED:"fonticon fonticon-wrong im-lifecycle-new graph-history-rejected",GRAPH_HISTORY_MORE:"fonticon fonticon-menu-dot im-lifecycle-new graph-history-more",GRAPH_HISTORY_TOOLTIP:"im-lifecycle-graph-history-tooltip",GRAPH_HISTORY_TOOLTIP_TITLE:"im-lifecycle-graph-history-tooltip-title",STATE_APPROVE_MODAL:"im-lifecycle-approve-modal",STATE_APPROVE_MODAL_HEIGHT:490,STATE_APPROVE_MODAL_WIDTH:510,STATE_APPROVE_MODAL_BODY:"im-lifecycle-approve-modal-body",STATE_APPROVE_MODAL_REASON:"im-lifecycle-approve-modal-reason",STATE_APPROVE_MODAL_ATTACHMENTS:"im-lifecycle-approve-modal-attachments",STATE_NEXT:"double-chevron-right wux-ui-3ds issue-maturity-next-state",STATE_PREV:"double-chevron-left wux-ui-3ds issue-maturity-prev-state",STATE_MATURITY:"collaborative-lifecycle-management wux-ui-3ds issue-maturity-state"}}};return UWA.Class.extend({init:function(e){this.bos=UWA.is(e.bos)?e.bos:[],this.showRoute=!UWA.is(e.showRoute)||e.showRoute,this.modelEvents=e.modelEvents,this.maturityCmd=new r},buildMaturityView:function(e){var t=this;return t.targetDivs=[],e.targetDivs.forEach(e=>{e.empty();let n=UWA.createElement("div",{class:"issue-maturity-div"}),i=UWA.createElement("div",{class:"issue-maturity-history-div"});i.inject(n);let s=UWA.createElement("div",{class:"issue-maturity-cmd-div"});s.inject(n);let o=UWA.createElement("div",{class:"issue-maturity-actions-div"});o.inject(n);let a=UWA.createElement("div",{class:"issue-maturity-route-div"});a.inject(n),n.inject(e),t.targetDivs.push({element:e,maturityCmdDiv:s,maturityDiv:n,maturityActionDiv:o,maturityHistoryDiv:i,maturityRouteDiv:a})}),t},refresh:function(e){var t=this;t.bos=UWA.is(e)&&UWA.is(e.bos)?e.bos:t.bos;let n=[];if(t.targetDivs.forEach(e=>{e.maturityCmdDiv.empty(),e.maturityActionDiv.empty(),e.maturityHistoryDiv.empty(),e.maturityRouteDiv.empty(),n.push(e.element)}),1==t.bos.length){let e=t.bos[0].physicalId;I.enableMaturityActions?t._renderMultiSelectRoute():t.targetDivs.forEach(n=>{t.maturityCmd.executeCompactViewAsync(widget,n.maturityCmdDiv,{SecurityContext:decodeURIComponent(d.getSecurityContext())},e).then(e=>{t.modelEvents.publish({event:"issue-idcard-maturity-update",data:{result:e}}),t.refresh()})})}t.showRoute&&t._issueRouteManagement(t.bos,n).then(e=>{"Diff"==e.renderStatus&&t.bos.length>1&&t.targetDivs.forEach(e=>{e.maturityCmdDiv.innerHTML=v.lifecycle.varies,e.maturityCmdDiv.title=v.lifecycle.notSupported})}).catch(e=>{})},_issueRouteManagement:function(t,n){var i,s=this,o=new e(e=>{i=e});return c.routes.retrieve({data:{objects:t.map(function(e){return{physicalId:e.physicalId}})}}).then(function(e){if(s.routes=e.results.map(function(e){return e.body}),t.length!=e.results.length)return void i({renderStatus:"No"});if(!s.routes.every(function(e){return e.state===s.routes[0].state}))return void i({renderStatus:"Diff"});let o=UWA.is(s.routes[0].current,"object")&&UWA.is(s.routes[0].current.from,"string");s.routes.every(function(e){return(UWA.is(e.current,"object")&&UWA.is(e.current.from,"string"))===o})?(s._renderRouteActions(),1==t.length?(s._renderRoutesHistory(s.route,n),i({renderStatus:"OK"})):(s._renderMultiSelectRoute(),i({renderStatus:"Multi"}))):i({renderStatus:"Diff"})}).catch(e=>{}),o},_renderRouteActions:function(){var e=this;let t=e.targetDivs.map(e=>e.element),n=e.route=e.routes[0],i=n.state;var s=d.getUserName();if(n.current&&n.current.basepurpose&&"standard"===n.current.basepurpose.toLowerCase())n.current&&n.current.from===i&&(c.routes.retrieveTasks({data:{objects:[{physicalId:n.physicalId}]}}).then(function(n){n.results[0].body.tasks.length>0?e._renderApproveRejectButtons(e.routes,t):e._renderInProgressIndicator(e.routes,t)}).catch(e=>{}),t.forEach(e=>{e.getElementsByClassName("issue-maturity-div")[0].addClassName("no-state-chng")}));else if(n.current&&n.current.from===i){var o=e.routes.every(function(e){return-1!==e.current.reviewers.map(function(e){return e.user}).indexOf(s)}),a=e.bos.every(function(e){return-1!==e.owners.map(function(e){return e.user}).indexOf(s)});if(o)e.routes.some(function(e){return-1===e.current.decisions.filter(function(e){return"approved"===e.status||"rejected"===e.status}).map(function(e){return e.reviewer.user}).indexOf(s)})?e._renderApproveRejectButtons(e.routes,t):e._renderInProgressIndicator(e.routes,t);else e._renderInProgressIndicator(e.routes,t);o||a||t.forEach(e=>{e.getElementsByClassName("issue-maturity-div")[0].addClassName("no-state-chng"),e.getElementsByClassName("issue-maturity-div")[0].addClassName("no-state-action")})}else{let n=e.bos.every(function(e){return-1!==e.owners.map(function(e){return e.user}).indexOf(s)}),i=e.bos.every(function(e){let t=e.assignees.map(function(e){return e.user}),n=e.assigneeFromUG.map(function(e){return e});return-1!==t.indexOf(s)||-1!==n.indexOf(s)});n||i||t.forEach(e=>{e.getElementsByClassName("issue-maturity-div")[0].addClassName("no-state-chng"),e.getElementsByClassName("issue-maturity-div")[0].addClassName("no-state-action")})}},_renderApproveRejectButtons:function(e,t){var n=this;t.forEach(e=>{let t=e.getElement(".issue-maturity-route-div");t.empty();let s=UWA.createElement("span",{class:I.CSS.ELEMENTS.GRAPH_STATE_APPROVE}),o=UWA.createElement("span",{class:I.CSS.ELEMENTS.GRAPH_STATE_REJECT});new i({position:"left",target:s,body:v.lifecycle.approveModal.okButton}),new i({position:"left",target:o,body:v.lifecycle.rejectModal.okButton}),s.inject(t),o.inject(t),s.addEventListener("click",n._onClickApprove.bind(n)),o.addEventListener("click",n._onClickReject.bind(n))})},_renderInProgressIndicator:function(e,t){var n=this;let s,o=e[0],a=o.current.reviewers;if(e.length>1)s="<span>"+v.lifecycle.routeIndicatorTooltip.inProgressTooltip.multiSelectionTitle+"</span>";else if(1===e.length){let e=o.current.decisions.filter(function(e){return"approved"===e.status||"rejected"===e.status}).map(function(e){return e.reviewer.user}),t=a.filter(function(t){return-1===e.indexOf(t.user)}),n=o.current.decisions.filter(function(e){return"approved"===e.status});if(s=UWA.createElement("div",{class:I.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP}),t.length>0){let e=UWA.createElement("div",{html:'<span class="'+I.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP_TITLE+'">'+v.lifecycle.routeIndicatorTooltip.inProgressTooltip.title+"</span>"});t.forEach(function(t){UWA.createElement("span",{html:"<span>"+t.fullName+"</span>"}).inject(e)}),e.inject(s)}if(n.length>0){let e=UWA.createElement("div",{html:'<span class="'+I.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP_TITLE+'">'+v.lifecycle.routeIndicatorTooltip.approvalTitle+"</span>"});n.forEach(function(t){let n=v.replace(v.lifecycle.routeIndicatorTooltip.approvalText,{name:t.reviewer.fullName,date:new Date(t.date).toLocaleString(l.get("widget").lang)});UWA.createElement("span",{html:"<span>"+n+"</span>"}).inject(e)}),e.inject(s)}}t.forEach(e=>{let t=e.getElement(".issue-maturity-route-div");t.empty();let o=UWA.createElement("span",{class:I.CSS.ELEMENTS.GRAPH_STATE_INPROGRESS});new i({position:"bottom",target:o,body:s}),o.inject(t),o.addEventListener("click",n._onClickInProgress.bind(n))})},_renderRoutesHistory:function(e,t){var n=this;if(Array.isArray(e.history)&&e.history.length>0){let s=e.state,o=e.history.filter(e=>s==e.rejectTo||s==e.from);o.length>0&&t.forEach(e=>{let t=e.getElement(".issue-maturity-history-div");t.empty();let s="approved"===o[o.length-1].status?I.CSS.ELEMENTS.GRAPH_HISTORY_APPROVED:I.CSS.ELEMENTS.GRAPH_HISTORY_REJECTED,a=UWA.createElement("span",{class:s});a.inject(t);let r=UWA.createElement("div",{class:I.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP,html:'<span class="'+I.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP_TITLE+'">'+v.replace(v.lifecycle.routeIndicatorTooltip.moreTooltip.title,{number:o.length})+"</span>"});o.forEach(e=>{let t=e.date,n="approved"===e.status?"approvalText":"rejectionText";UWA.createElement("div",{html:"<span>"+v.replace(v.lifecycle.routeIndicatorTooltip.moreTooltip[n],{date:new Date(t).toLocaleString(l.get("widget").lang)})+"</span>"}).inject(r)}),new i({position:"bottom",target:a,body:r}),a.addEventListener("click",n._onClickHistory.bind(n))})}},_onClickApprove:function(){var e=this,i=e.route,r=v.maturity[i.current.approveTo.toLowerCase()],l=UWA.createElement("div",{class:I.CSS.ELEMENTS.STATE_APPROVE_MODAL_BODY}),c=UWA.createElement("div",{class:I.CSS.ELEMENTS.STATE_APPROVE_MODAL_REASON});c.inject(l),UWA.createElement("label",{html:v.lifecycle.approveModal.reasonLabel}).inject(c);var u=new n({multiline:!0,rows:4,placeholder:v.lifecycle.approveModal.reasonPlaceholder});u.inject(c),u.getContent().toggleClassName("highlight",""===u.getValue()),u.getContent().addEventListener("keyup",function(){u.getContent().toggleClassName("highlight",""===u.getValue())});var p=UWA.createElement("div",{class:I.CSS.ELEMENTS.STATE_APPROVE_MODAL_ATTACHMENTS});p.inject(l);var h=new f({parent:e,annotateCommand:{enable:!0,addTextbox:!0,getText:function(){var e=null,t=u.getValue();t&&(e=d.getFullName()+"\n"+(new Date).toLocaleString(widget.lang,{})+"\n"+t);return e}},searchAttachmentCommand:{getSearchQuery:function(){return m.getSearchQuery(e.physicalIds)}}});h.render(),h.inject(p),e.approveComponents={},e.approveComponents.attachments=h,e.approveComponents.reasonInput=u;var b={},y=new s({element:l}),S=new o({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:I.CSS.ELEMENTS.STATE_APPROVE_MODAL,header:UWA.createElement("h4",{html:v.replace(v.lifecycle.approveModal.header,{approveTo:r})}),body:y,footer:[b.okButton=new t({value:v.lifecycle.approveModal.okButton,className:"primary",events:{onClick:function(){""!==u.getValue()?(g.Mask.mask(l),b.okButton.elements.container.addClassName("disabled"),b.cancelButton.elements.container.addClassName("disabled"),e._approveRoutes(e.routes,u.getValue(),h).then(function(){S.destroy(),e.approveComponents=null}).catch(function(e){var t=v.lifecycle.error;if(null!=e&&void 0!==e&&null!=e.error&&(t=e.error.message),t.includes("Action Taken and Resolution Statement are not filled in")){b.cancelButton.elements.container.removeClassName("disabled");var n=g.getErrorMessage("5");g.displayErrorMessage(n,"error")}else if(t.includes("Action Taken field is not filled in")){b.cancelButton.elements.container.removeClassName("disabled");n=g.getErrorMessage("6");g.displayErrorMessage(n,"error")}else if(t.includes("Resolution Statement field is not filled in")){b.cancelButton.elements.container.removeClassName("disabled");n=g.getErrorMessage("7");g.displayErrorMessage(n,"error")}else if(t.includes("Resolution Date is not filled in")){b.cancelButton.elements.container.removeClassName("disabled");n=g.getErrorMessage("8");g.displayErrorMessage(n,"error")}else a.displayNotification({msg:t,eventID:"error"});g.Mask.unmask(l)})):a.displayNotification({msg:v.lifecycle.approveModal.reasonRequired,eventID:"warning"})}}}),b.cancelButton=new t({value:v.lifecycle.approveModal.cancelButton,className:"default",events:{onClick:function(){S.destroy(),e.approveComponents=null}}})]});S.inject(widget.body),S.elements.container.setStyle("height",I.CSS.ELEMENTS.STATE_APPROVE_MODAL_HEIGHT),S.elements.container.setStyle("width",I.CSS.ELEMENTS.STATE_APPROVE_MODAL_WIDTH),S.show(),u.focus()},_onClickReject:function(){var e=this,i=e.route,r=v.maturity[i.current.approveTo.toLowerCase()],l=UWA.createElement("div",{class:I.CSS.ELEMENTS.STATE_APPROVE_MODAL_BODY}),c=UWA.createElement("div",{class:I.CSS.ELEMENTS.STATE_APPROVE_MODAL_REASON});c.inject(l),UWA.createElement("label",{html:v.lifecycle.rejectModal.reasonLabel}).inject(c);var u=new n({multiline:!0,rows:4,placeholder:v.lifecycle.rejectModal.reasonPlaceholder});u.inject(c),u.getContent().toggleClassName("highlight",""===u.getValue()),u.getContent().addEventListener("keyup",function(){u.getContent().toggleClassName("highlight",""===u.getValue())});var p=UWA.createElement("div",{class:I.CSS.ELEMENTS.STATE_APPROVE_MODAL_ATTACHMENTS});p.inject(l);var h=new f({parent:e,annotateCommand:{enable:!0,addTextbox:!0,getText:function(){var e=null,t=u.getValue();t&&(e=d.getFullName()+"\n"+(new Date).toLocaleString(widget.lang,{})+"\n"+t);return e}},searchAttachmentCommand:{getSearchQuery:function(){return m.getSearchQuery(e.physicalIds)}}});h.render(),h.inject(p),e.rejectComponents={},e.rejectComponents.attachments=h,e.rejectComponents.reasonInput=u;var b={},y=new s({element:l}),S=new o({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:I.CSS.ELEMENTS.STATE_APPROVE_MODAL,header:UWA.createElement("h4",{html:v.replace(v.lifecycle.rejectModal.header,{approveTo:r})}),body:y,footer:[b.okButton=new t({value:v.lifecycle.rejectModal.okButton,className:"primary",events:{onClick:function(){if(""===u.getValue())return a.displayNotification({msg:v.lifecycle.rejectModal.reasonRequired,eventID:"warning"}),void u.elements.container.addClassName("highlight");g.Mask.mask(l),b.okButton.elements.container.addClassName("disabled"),b.cancelButton.elements.container.addClassName("disabled"),e._rejectRoutes(e.routes,u.getValue(),h).then(function(){S.destroy()}).catch(function(e){a.displayNotification({msg:v.lifecycle.error,eventID:"error"}),g.Mask.unmask(l)})}}}),b.cancelButton=new t({value:v.lifecycle.rejectModal.cancelButton,className:"default",events:{onClick:function(){S.destroy()}}})]});S.inject(widget.body),S.elements.container.setStyle("height",I.CSS.ELEMENTS.STATE_APPROVE_MODAL_HEIGHT),S.elements.container.setStyle("width",I.CSS.ELEMENTS.STATE_APPROVE_MODAL_WIDTH),S.show(),u.focus()},_onClickHistory:function(){this.modelEvents.publish({event:"issue-idcard-maturity-history-click",data:{}})},_onClickInProgress:function(){this.modelEvents.publish({event:"issue-idcard-maturity-history-click",data:{}})},_approveRoutes:function(e,t,n){var i=this,s=e.map(function(e){return e.physicalId});return g.Mask.mask(i.container),i._connectAttachments(s,n).then(function(){return c.routes.approve({data:{objects:e.map(function(e){return{physicalId:e.physicalId,comment:t}})},onFailure:function(e){var t=v.lifecycle.error;null!=e&&void 0!==e&&null!=e.error&&(t=e.error.message),UWA.is(e.error)&&UWA.is(e.error.internal)&&e.error.internal.includes("None of the Resolving Change started")?g.displayErrorMessage(g.getErrorMessage("1500167_1"),"error"):a.displayNotification({msg:t,eventID:"error"})}}).then(function(e){var t=e.results.map(function(e){return{physicalId:e.body.physicalId,task:e.body.task}});i.modelEvents.publish({event:"onApprovalCompleted",data:{issues:t,modifiedAttributes:["attachments"]}})}).catch(e=>{})}).catch(e=>{}).finally(function(){i.refresh()})},_rejectRoutes:function(e,t,n){var i=this,s=e.map(function(e){return e.physicalId});return g.Mask.mask(i.container),i._connectAttachments(s,n).then(function(){return c.routes.reject({data:{objects:e.map(function(e){return{physicalId:e.physicalId,reason:t}})}}).then(function(e){var t=e.results.map(function(e){return{physicalId:e.body.physicalId,task:e.body.task}});i.modelEvents.publish({event:"onRejectionCompleted",data:{issues:t,modifiedAttributes:["attachments"]}})}).catch(e=>{i._StateChangeErrors(e)})}).catch(e=>{}).finally(function(){i.refresh()})},_connectAttachments:function(t,n){var i=l.get("widget")||window.widget,s=n.collection,o=s.filter(function(e){return!0===e.get("isFile")}).map(function(e){var t=e.clone();return t.set("isProcessing",!0),t}),r=[];if(o.length>0){var c=new u({id:"uploadAttachmentsToRoutes",attachments:o});new p({container:i.body,collection:c}).render(),r=o.map(function(e){var t=m.uploadFile(e.get("file"),null,{onCheckinStart:function(e){this.set("isCancelable",!0),this.set("request",e)}.bind(e),onCheckinProgress:function(e){if(e.lengthComputable){var t=e.loaded/e.total;this.set("requestProgress",t)}}.bind(e),onCheckinComplete:function(){this.set("isCancelable",!1),this.set("request",null)}.bind(e)});return t=t.then(function(t){t&&t.data&&t.data.length>0&&t.data[0].id&&(s.get(e.id).set("isFile",!1),s.get(e.id).set("id",t.data[0].id),e.set("id",t.data[0].id),e.set("isFile",!1),e.set("isProcessing",!1))}).catch(function(t){e.set("isFailed",!0),e.set("isProcessing",!1),e.set("isCancelable",!1),e.set("request",null),t instanceof Error&&a.displayNotification({msg:h.replace(h.notifications.Upload.failure,{count:1}),eventID:"error"})})})}return e.all(r).then(function(){var n=s.filter(function(e){return!0!==e.get("isFile")}).map(function(e){return e.clone()}),i=[];return n.length>0&&t.forEach(function(e){var t=n.map(function(e){return e.id});i.push(m.connectDocumentsToParent(t,e).catch(function(e){a.displayNotification({msg:h.replace(h.notifications.Attach.failure,{count:1}),eventID:"error"})}))}),e.all(i)}).then(function(){var n=[],i=s.filter(function(e){return!0===e.get("isPrimary")});if(1===i.length){var o=i[0];return t.forEach(function(e){n.push(m.setAsPrimary(o.get("id"),e,!0).then(function(){}).catch(function(e){a.displayNotification({msg:h.notifications.SetAsPrimary.failure,eventID:"error"})}))}),e.all(n)}return e.resolve()}).catch(e=>{})},_renderMultiSelectRoute:function(){var e=this;let n=e.bos[0].physicalId,i=I.STATES_VALUES.indexOf(e.bos[0].state);e.targetDivs.forEach(t=>{t.maturityDiv.addClassName("no-state-chng"),t.maturityDiv.addClassName("no-state-action"),e.maturityCmd.executeCompactViewAsync(widget,t.maturityCmdDiv,{SecurityContext:decodeURIComponent(d.getSecurityContext())},n).then(t=>{e.refresh()})}),e.targetDivs.forEach(n=>{let s=n.maturityActionDiv,o=[];i!=I.STATES_VALUES.length-1&&o.push({name:"NextState",fonticon:I.CSS.ELEMENTS.STATE_NEXT,text:v.lifecycle.goToNextState,selected:!1}),0!=i&&o.push({name:"PreviousState",fonticon:I.CSS.ELEMENTS.STATE_PREV,text:v.lifecycle.goToPrevState,selected:!1}),o.push({name:"maturity",fonticon:I.CSS.ELEMENTS.STATE_MATURITY,text:v.resolveIssues.state,selected:!1}),new t({className:"route-action",icon:"chevron-down",dropdown:{items:o},events:{onDropdownClick:function(t,n){"NextState"==n.name&&e._onPromote(),"PreviousState"==n.name&&e._onDemote(),"maturity"==n.name&&e.maturityCmd.execute(e.bos,function(){e.modelEvents.publish({event:"refresh-issue-header",data:{}})})}}}).inject(s)})},_onPromote:function(){var e=this;let t=I.STATES_VALUES.indexOf(e.bos[0].state);if(t==I.STATES_VALUES.length-1)return;let n=I.STATES_VALUES[t+1],i=e.bos.map(e=>({physicalId:e.physicalId,state:n}));c.issues.promote({data:{objects:i}}).then(function(t){let n=t.results;n.forEach(t=>{let n=t.body.physicalId;e.bos.forEach(e=>{e.physicalId==n&&(e.state=t.body.state)})}),e.modelEvents.publish({event:"issue-idcard-maturity-update",data:{result:n}})}).catch(function(t){e._StateChangeErrors(t)}).finally(function(){e.refresh()})},_onDemote:function(){var e=this;let t=I.STATES_VALUES.indexOf(e.bos[0].state);if(0==t)return;let n=I.STATES_VALUES[t-1],i=e.bos.map(e=>({physicalId:e.physicalId,state:n}));c.issues.demote({data:{objects:i}}).then(function(t){let n=t.results;n.forEach(t=>{let n=t.body.physicalId;e.bos.forEach(e=>{e.physicalId==n&&(e.state=t.body.state)})}),e.modelEvents.publish({event:"issue-idcard-maturity-update",data:{result:n}})}).catch(function(t){e._StateChangeErrors(t)}).finally(function(){e.refresh()})},_StateChangeErrors:function(e){var t=v.lifecycle.error,n="";if(e&&e.error&&UWA.is(e.error.message,"string")&&(n=e.error.message),n.includes("Action Taken and Resolution Statement are not filled in")){t=g.getErrorMessage("5");g.displayErrorMessage(t,"error")}else if(n.includes("Action Taken field is not filled in")){t=g.getErrorMessage("6");g.displayErrorMessage(t,"error")}else if(n.includes("Resolution Statement field is not filled in")){t=g.getErrorMessage("7");g.displayErrorMessage(t,"error")}else if(n.includes("Resolution Date is not filled in")){t=g.getErrorMessage("8");g.displayErrorMessage(t,"error")}else if(n.includes("User does not have necessary privileges or selected object is not in correct maturity state for this operation.")){var i=g.getErrorMessage("1005_1");g.displayErrorMessage(i,"error")}else if(e.error&&e.error.internal&&(e.error.internal.includes("Message:No privilege for operation Severity:2 ErrorCode:1500019")||e.error.internal.includes("User does not have necessary privileges"))){i=g.getErrorMessage("1005");g.displayErrorMessage(i,"error")}else if(e.error&&e.error.internal&&e.error.internal.includes("You need at least one assignee to promote or demote this issue, as a validation process is attached to the issue for assignees")){i=g.getErrorMessage("1004");g.displayErrorMessage(i,"error")}else if(n.includes("at least one Resolving Change started")){t=g.getErrorMessage("14");g.displayErrorMessage(t,"error")}else e&&e.error&&UWA.is(e.error.message,"string")&&(t=e.error.message,a.displayNotification({msg:t,eventID:"error"}))}})}),define("DS/IssueManagement/components/idcard/IDCardHeaderAttributes",["i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e){return{Default_Attr:[{name:"",id:"maturity",value:"",editable:!0,displayWhenMinified:!0},{name:e.columns.ownerColumn,id:"owner",value:"",type:"type-hyperlink",editable:!0,displayWhenMinified:!0,isVaries:!1},{name:e.columns.collaborativeSpaceColumn,id:"collabspace",type:"type-hyperlink",value:"",editable:!0,displayWhenMinified:!0,isVaries:!1},{name:e.columns.priorityColumn,id:"priority",type:"type-hyperlink",value:"",editable:!0,displayWhenMinified:!0},{name:e.columns.resolutionDateColumn,id:"duedate",value:"",editable:!0,displayWhenMinified:!0},{name:e.columns.modifiedColumn,id:"modifiedDate",value:"",editable:!0,displayWhenMinified:!0},{name:e.columns.responsibleOrganizationColumn,id:"responsibleOrg",value:"",type:"type-hyperlink",editable:!0,displayWhenMinified:!0},{name:e.columns.reportingOrganizationColumn,id:"reportingOrg",value:"",displayWhenMinified:!0},{name:e.completionType,id:"completionType",value:"",editable:!1,displayWhenMinified:!0}],PLMNew_DraftState:[{name:"",id:"maturity",value:"",editable:!0,displayWhenMinified:!0},{name:e.columns.ownerColumn,id:"owner",value:"",type:"type-hyperlink",editable:!0,displayWhenMinified:!0,isVaries:!1},{name:e.columns.collaborativeSpaceColumn,id:"collabspace",type:"type-hyperlink",value:"",editable:!0,displayWhenMinified:!0,isVaries:!1},{name:e.columns.priorityColumn,id:"priority",type:"type-hyperlink",value:"",editable:!0,displayWhenMinified:!0},{name:e.columns.resolutionDateColumn,id:"duedate",value:"",editable:!0,displayWhenMinified:!0},{name:e.columns.approvalColumn,id:"approvals",value:"",displayWhenMinified:!0},{name:e.columns.responsibleOrganizationColumn,id:"responsibleOrg",value:"",type:"type-hyperlink",editable:!0,displayWhenMinified:!0},{name:e.columns.reportingOrganizationColumn,id:"reportingOrg",value:"",type:"type-hyperlink",editable:!0,displayWhenMinified:!0},{name:e.columns.modifiedColumn,id:"modifiedDate",value:"",editable:!0,displayWhenMinified:!0}]}}),define("DS/IssueManagement/utils/customization/DataGridCellContent",["UWA/Core","DS/IssueServices/Contexts","DS/IssueComponents/users/Users","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon"],function(e,t,n,i,s){"use strict";return{updateCellContentForGrid:function(e){}}}),define("DS/IssueManagement/commands/ToggleInformationPanel",["UWA/Core","UWA/Class","DS/ApplicationFrame/Command"],function(e,t,n){"use strict";return t.extend(n,{name:"DS/IssueManagement/commands/ToggleInformationPanel",begin:function(e){this.execute(e)},execute:function(e){var t=this;require(["DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],function(n,i){i.start(t.name+" execute"),n.get("information").toggle(e.open,e.save),n.get("information").refreshInfo(),n.get("actionBar").updatePanelToggle(),n.get("application").updateHeaderToggle(),i.end(t.name+" execute")})}})}),define("DS/IssueManagement/views/facets/RelatedContent",["UWA/Core","UWA/Class/View","DS/IssueComponents/related/RelatedContent","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","css!DS/IssueManagement/IssueManagement.css"],function(e,t,n,i,s){"use strict";return t.extend({name:"DS/IssueManagement/views/facets/RelatedContent",tagName:"div",className:"relatedContent-view fade-in-element",defaultOptions:{physicalIds:[]},related:null,_subscriberId:"",_eventListeners:[],setup:function(e){var t=this;s.start(t.name+" setup"),t._parent(e),t.relatedContent=new n({ids:t.getOption("physicalIds"),intercom:!0}),t._subscriberId=Math.random().toString(36).substr(2,9),t.listenTo(t.relatedContent,"onReady",function(e){t.dispatchEvent("onReady",e)}),t.listenTo(t.relatedContent,"onFailure",function(e){t.dispatchEvent("onFailure",e)}),t.listenTo(t.relatedContent,"onUpdate",function(e){for(var n=[],s={},o=Object.keys(e.issues),a=0;a<o.length;a++)n.push([e.issues[o[a]].id]),s[e.issues[o[a]].id]={id:e.issues[o[a]].id,type:e.issues[o[a]].type,name:e.issues[o[a]].name,title:e.issues[o[a]].title,modifiedAttributes:e.relation};i.get("eventsHandler").publish(t._subscriberId,"DS/Object/update",{metadata:{appId:i.get("widget").id,appName:i.get("widget").name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:n,attributes:s},version:"1.0"})}),t._eventListeners=[{event:"DS/Object/update",listener:function(e){t.relatedContent&&t.relatedContent.options.ids&&(e.data.paths.some(function(e){return-1!==t.relatedContent.options.ids.indexOf(e[0])})&&t.relatedContent.refresh(t.relatedContent.options.ids))},conditions:{type:"issue",attributes:["reportedAgainst","resolvedItems","resolvedBy","contexts"]}}];for(var o=0;o<t._eventListeners.length;o++){var a=t._eventListeners[o];a.token=i.get("eventsHandler").subscribe(t._subscriberId,a.event,a.listener.bind(t),a.conditions)}s.end(t.name+" setup")},render:function(){return s.start(this.name+" render"),this.relatedContent.render().inject(this.container),s.end(this.name+" render"),this},refresh:function(e){return this.setOption("physicalIds",e),this.relatedContent.refresh(e)},destroy:function(){if(this.stopListening(this.relatedContent,"onReady"),this.stopListening(this.relatedContent,"onFailure"),this.stopListening(this.relatedContent,"onUpdate"),Array.isArray(this._eventListeners))for(var e=0;e<this._eventListeners.length;e++){var t=this._eventListeners[e];i.get("eventsHandler").unsubscribe(t.token)}this._eventListeners=[],this._subcriberId="",this.relatedContent.destroy(),this.relatedContent=null,this.container.empty()}})}),define("DS/IssueManagement/components/header/IssueDataGridToolbar",["DS/IssueServices/Contexts","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t){var n=Object.create(null);return n.toolbar=null,n._CONSTANTS={LIST_VIEW:"ListView",KANBAN_VIEW:"KanbanView",CUSTOMIZE_DATAGRID_VIEW:"customizeDatagridView",CUSTOMIZE_KANBAN_VIEW:"customizeKanbanView",PLMNEW_ENABLEMENT:"PLMNewEnablement",LAYOUT:{RIGHT:"right",BOTTOM:"bottom"}},n.selectionOptions={menu:[{type:"PushItem",id:"SelectAllIssues",title:t.actions.select.selectIssues,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-list-ok"},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"selectAll"}},{type:"PushItem",id:"SelectAllRelatedObjects",title:t.actions.select.selectChildren,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-flow-cascade-ok-2"},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"selectAllRelatedObjects"}},{type:"PushItem",id:"UnselectAll",title:t.actions.select.unselectAll,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-list-delete"},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"unselectAll"}}]},n.getMoreOptions=function(){var i=[];i.push({id:"Export",dataElements:{typeRepresentation:"PushItem",label:t.actions.export,icon:{iconName:"export",fontIconFamily:1}},children:[{id:"ExportCSV",dataElements:{typeRepresentation:"PushItem",label:t.actions.exportCSV,icon:{iconName:"doc-log",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"exportCSV"}}},{id:"ExportPPTX",dataElements:{typeRepresentation:"PushItem",label:t.actions.exportPPTX,icon:{iconName:"newspaper",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"exportPPTX"}}},{id:"ExportZIP",dataElements:{typeRepresentation:"PushItem",label:t.actions.exportZIP,icon:{iconName:"archive",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"exportZIP"}}}]}),i.push({id:"Print",dataElements:{typeRepresentation:"PushItem",label:t.actions.print,icon:{iconName:"print",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"print"}}});e.get(n._CONSTANTS.PLMNEW_ENABLEMENT);return i},n.writetoolbarDefination=function(e){var i=t.switchView,s={entries:[{id:"InlineCreate",className:"menu",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"plus",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"inlineCreate"},position:"far",category:"create",label:t.actions.create.title,priority:4},domId:"InlineCreateToolbar"},{id:"ChangeAction",className:"menu",dataElements:{typeRepresentation:"functionIcon",visibleFlag:!1,icon:{iconName:"change",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"createCA"},position:"far",category:"create",priority:1,label:t.actions.changeAction}},{id:"3DMarkup",className:"menu",dataElements:{typeRepresentation:"functionIcon",visibleFlag:!1,icon:{iconName:"app-3dmarkup",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"create3DMarkUp"},position:"far",category:"create",label:t.actions.markup3D,priority:1}},{id:"Filter",dataElements:{typeRepresentation:"functionMenuIcon",icon:{iconName:"list-filter",fontIconFamily:1},value:{menu:[]},position:"far",category:"filter",label:t.filter.title,priority:3},domId:"filterByObjectToolbar"},{id:"Subscription",dataElements:{typeRepresentation:"functionMenuIcon",icon:{iconName:"bell-list",fontIconFamily:1},value:{menu:[{id:"mySubscription",title:t.actions.subscription.mySubscriptions,type:"PushItem",icon:{iconName:"bell",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"subscribe",argument:{actionId:"mySubscription"}}}]},label:t.actions.subscription.header,priority:1,position:"far",category:"subscription"}},{id:"customizeDatagridView",className:"menu",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"cog",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"customizeColumnView"},visibleFlag:e.customizeDatagridView,priority:0,position:"far",category:"View",label:t.actions.customizeView}},{id:"customizeKanbanView",className:"menu",dataElements:{typeRepresentation:"functionMenuIcon",icon:{iconName:"cog",fontIconFamily:1},visibleFlag:e.customizeKanbanView,position:"far",category:"View",priority:0,label:t.actions.customizeView},children:[{id:"state",dataElements:{typeRepresentation:"CheckItem",label:t.columns.stateColumn,action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"customizeByState"},state:e.kanbanViewBySetting.kanbanViewByState},category:"2"},{id:"priority",dataElements:{typeRepresentation:"CheckItem",label:t.columns.priorityColumn,action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"customizeByPriority"},state:e.kanbanViewBySetting.kanbanViewByPriority},category:"2"},{id:"resolutionDate",dataElements:{typeRepresentation:"CheckItem",label:t.columns.resolutionDateColumn,action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"customizeByResDate"},state:e.kanbanViewBySetting.kanbanViewByResDate},category:"2"},{id:"all",dataElements:{typeRepresentation:"CheckItem",label:t.columns.allColumn,action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"customizeByAll"},state:e.kanbanViewBySetting.kanbanViewByAll},category:"2"}]},{id:"Selection",className:"menu",dataElements:{typeRepresentation:"functionMenuIcon",icon:{iconName:"select-on",fontIconFamily:1},value:this.selectionOptions,priority:0,position:"far",category:"View",label:t.actions.select.title}},{id:"Dynamic",className:"menu",dataElements:{typeRepresentation:"threeDotsMenu",icon:{iconName:"menu-dot",fontIconFamily:1},priority:1,position:"far",category:"View",label:t.actions.more},children:this.getMoreOptions()},{id:"SelectView",className:"menu",dataElements:{typeRepresentation:"functionMenuIcon",icon:{iconName:e.icon,fontIconFamily:1},position:"far",category:"View",value:{menu:[{id:"KanbanView",type:"CheckItem",title:t.actions.kanbanView,icon:{iconName:"chart-kanban",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"onKanbanView"},state:e.kanbanView},{id:"ListView",type:"CheckItem",title:t.actions.gridView,icon:{iconName:"view-list",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"onDataGridView"},state:e.listView}]},label:i,priority:0}},{id:"SwitchLayout",dataElements:{typeRepresentation:"chevronMenuIcon",value:{menu:[{type:"CheckItem",id:n._CONSTANTS.LAYOUT.RIGHT,title:t.information.right,state:e.switchLayout==n._CONSTANTS.LAYOUT.RIGHT?"selected":"unselected",icon:{iconName:"side-panel",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"switchRightLayout",argument:{actionId:n._CONSTANTS.LAYOUT.RIGHT}}},{type:"CheckItem",id:n._CONSTANTS.LAYOUT.BOTTOM,title:t.information.bottom,state:e.switchLayout==n._CONSTANTS.LAYOUT.BOTTOM?"selected":"unselected",icon:{iconName:"bottom-panel",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"switchBottomLayout",argument:{actionId:n._CONSTANTS.LAYOUT.BOTTOM}}}]}},position:"far",category:"View",label:t.information.layoutSwitcherTooltip,priority:2}]};return JSON.stringify(s)},n.onKanbanView=function(e){require(["DS/IssueManagement/components/header/IssueToolbarActions"],function(e){var t=n._CONSTANTS.KANBAN_VIEW,i=[{IdValue:t,StateValue:"selected"}];n._toggleViewItem(i,n.toolbarActionBar),e.switchView(t)})},n.onDataGridView=function(e){require(["DS/IssueManagement/components/header/IssueToolbarActions"],function(e){var t=n._CONSTANTS.LIST_VIEW,i=[{IdValue:t,StateValue:"selected"}];n._toggleViewItem(i,n.toolbarActionBar),e.switchView(t)})},n.switchBottomLayout=function(e){widget.setValue("infoPanelLayout","bottom"),require(["DS/IssueManagement/components/header/IssueToolbarActions"],function(e){var t=n._CONSTANTS.LAYOUT.BOTTOM,i=[{IdValue:t,StateValue:"selected"}];n._toggleLayout(i,n.toolbarActionBar),e.switchLayout(t)})},n.switchRightLayout=function(e){widget.setValue("infoPanelLayout","right"),require(["DS/IssueManagement/components/header/IssueToolbarActions"],function(e){var t=n._CONSTANTS.LAYOUT.RIGHT,i=[{IdValue:t,StateValue:"selected"}];n._toggleLayout(i,n.toolbarActionBar),e.switchLayout(t)})},n.onClickSession=function(e){require(["DS/IssueManagement/components/header/IssueToolbarActions"],function(t){t.setFilterOptionsOnWidget(e,"session")})},n.onClickResetSession=function(){widget.setValue("filter",JSON.stringify({owned:!0,assigned:!0,reported:!1,responsible:!1,contributed:!1,closed:!1,session:!1})),widget.setValue("roots",[]),widget.dispatchEvent("onRefresh")},n.onClickOwned=function(e){require(["DS/IssueManagement/components/header/IssueToolbarActions"],function(t){t.setFilterOptionsOnWidget(e,"owned")})},n.onClickAssigned=function(e){require(["DS/IssueManagement/components/header/IssueToolbarActions"],function(t){t.setFilterOptionsOnWidget(e,"assigned")})},n.onClickReported=function(e){require(["DS/IssueManagement/components/header/IssueToolbarActions"],function(t){t.setFilterOptionsOnWidget(e,"reported")})},n.onClickResponsible=function(e){require(["DS/IssueManagement/components/header/IssueToolbarActions"],function(t){t.setFilterOptionsOnWidget(e,"responsible")})},n.onClickContributed=function(e){require(["DS/IssueManagement/components/header/IssueToolbarActions"],function(t){t.setFilterOptionsOnWidget(e,"contributed")})},n.onClickClosed=function(e){require(["DS/IssueManagement/components/header/IssueToolbarActions"],function(t){t.setFilterOptionsOnWidget(e,"closed")})},n.onClickFilterByObj=function(e){require(["DS/IssueManagement/components/header/IssueToolbarActions"],function(t){t.setFilterOptionsOnWidget(e,"filterbyobject")})},n.setToolbarState=function(e,t){if(e)for(var n=0;n<e.length;n++){var i=e[n];t.updateNodeModel(i.IdValue,{disabled:i.StateValue})}},n._toggleViewItem=function(e,i){if(e)for(var s=0;s<e.length;s++){var o=e[s],a=i.getNodeModelByID("SelectView");a.options.grid.data.menu.forEach(function(e){if(e.id==o.IdValue?i.updateNodeModel(e.id,{state:"selected"}):i.updateNodeModel(e.id,{state:"undefined"}),o.IdValue==n._CONSTANTS.LIST_VIEW){var s={fontIconFamily:1,fontIconSize:"1x",iconName:"view-list"};i.updateNodeModel(a.options.id,{icon:s,label:t.switchView}),i.updateNodeModel(n._CONSTANTS.CUSTOMIZE_KANBAN_VIEW,{visibleFlag:!1}),i.updateNodeModel(n._CONSTANTS.CUSTOMIZE_DATAGRID_VIEW,{visibleFlag:!0})}else{s={fontIconFamily:1,fontIconSize:"1x",iconName:"chart-kanban"};i.updateNodeModel(a.options.id,{icon:s,label:t.switchView}),i.updateNodeModel(n._CONSTANTS.CUSTOMIZE_KANBAN_VIEW,{visibleFlag:!0}),i.updateNodeModel(n._CONSTANTS.CUSTOMIZE_DATAGRID_VIEW,{visibleFlag:!1})}})}},n._toggleLayout=function(e,t){if(e)for(var n=0;n<e.length;n++){var i=e[n];t.getNodeModelByID("SwitchLayout").options.grid.data.menu.forEach(function(e){e.id==i.IdValue?t.updateNodeModel(e.id,{state:"selected"}):t.updateNodeModel(e.id,{state:"undefined"})})}},n.toggleFilterItem=function(e,t){if(e)for(var n=0;n<e.length;n++){var i=e[n];t.getNodeModelByID("Filter").options.grid.data.menu.forEach(function(e){e.id==i.IdValue&&null!=e.state&&(e.state.includes("selected")?t.updateNodeModel(i.IdValue,{state:"undefined"}):t.updateNodeModel(i.IdValue,{state:"selected"}))})}},n.toggleKanbanCustomizeItem=function(e,t){if(e)for(var n=0;n<e.length;n++){var i=e[n];t.getNodeModelByID("customizeKanbanView").options.grid.data.menu.forEach(function(e){e.id==i.IdValue?t.updateNodeModel(e.id,{state:"selected"}):t.updateNodeModel(e.id,{state:"undefined"})})}},n.getSelectedFilterOptions=function(e){if(e){var t={};return e.getNodeModelByID("Filter").options.grid.data.menu.forEach(function(e){e.state&&e.state.includes("selected")&&(t[e.id]=!0)}),t}},n.getInformationIcon=function(e){return{iconName:"info",fontIconFamily:1,className:!0===e?"info":""}},n.openInformation=function(){require(["DS/IssueManagement/components/header/IssueToolbarActions"],function(e){var t="info"===n.toolbarActionBar.getNodeModelByID("ToggleInformationPanel").getAttributeValue("semantics").icon.className;e.openInformationPanel(!t)})},n}),define("DS/IssueManagement/views/facets/Comments",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Scroller","DS/SocialToolbar/SocialToolbar","DS/IssueServices/Contexts","DS/IssueManagement/views/facets/Placeholder","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","css!DS/IssueCommon/IssueCommon.css"],function(e,t,n,i,s,o,a,r,l,c,d){"use strict";return t.extend({name:"DS/IssueManagement/views/facets/Comments",tag:"div",className:"comments-view fade-in-element",defaultOptions:{physicalIds:[]},comments:null,elements:{target:null,scroller:null},setup:function(e){c.start(this.name+" setup"),this._parent(e),this.elements.target=n.createElement("div",{class:"comments-content"}),this.container.setContent(this.elements.target),this.elements.scroller=new i({element:this.elements.target}).inject(this.container),this.comments=null,c.end(this.name+" setup")},render:function(){var e=this;if(!1===e.isValidSelection())return e.elements.target.hide(),e.placeholder.show(e.container),setTimeout(function(){e.dispatchEvent("onReady",{})},0),e;e.placeholder.hide(e.container),e.elements.target.show(),c.start(e.name+" render");var t=e.getOption("physicalIds");return e.comments=new s({subjectURI:"pid:"+t[t.length-1],enableShare:!1,enableComment:!0,enableLike:!1,tenantId:r.getTenant(),commentProxyToken:{header:"X-DS-CSRFTOKEN"},serviceURL:r.get3DSpaceUrl()+"/resources","3DSwymUrl":r.get3DSwymUrl(),commentsNumberAtInit:8,enableUpload:!1}),e.comments.components.addEvent("onCommentCreateSuccess",function(t){e.addMentionedUser(t),e.notifyUsers(t)}),e.comments.components.addEvent("onCommentEditSuccess",function(t){e.addMentionedUser(t),e.notifyUsers(t)}),e.listenToOnce(e.comments,"onPopulate",function(){e.dispatchEvent("onReady",{})}),e.comments.inject(e.elements.scroller.getInnerElement()),c.end(e.name+" render"),e},refresh:function(t){var n=this;return null!==n.comments&&(n.comments.destroy(),n.comments=null),n.setOption("physicalIds",t),n.render(),new e(function(e){n.listenToOnce(n,"onReady",e)})},destroy:function(){this.stopListening(this,"onReady"),null!==this.comments&&(this.comments.destroy(),this.comments=null),this.container.empty()},isValidSelection:function(){var e=this.getOption("physicalIds");return Array.isArray(e)&&1===e.length},addMentionedUser:function(e){if(e&&n.is(e.get,"function")){var t="",i=e.get("subjectUri");if(i.length>0&&i.includes("pid:")){o="pid:";let e=i.indexOf(o)+o.length,n=i.length;t=i.substring(e,n)}var s=e.get("richMessage"),o='class="sum-user-link sm-link" data-login="',a=[];s.split("</a>").forEach(function(e){if(e.length>0&&e.includes(o)){let n=e.indexOf(o)+o.length,i=e.indexOf('"',n);var t=e.substring(n,i);a.push(t)}});var r=[];if(a.forEach(function(e){r.push({user:e})}),a.length>0&&t.length>0){var c=[{contributors:r,physicalId:t,userContext:"mentionedUser"}];l.people.update({data:{objects:c}}).catch(function(e){if(e.error.message.includes("'business object' does not exist")){var t=d.getErrorMessage("0");d.displayErrorMessage(t,"error")}else if(n.is(e.error.internal)&&e.error.internal.includes("You do not have the permissions to perform this action")){t=d.getErrorMessage("1");d.displayErrorMessage(t,"error")}else if(n.is(e.error.internal)&&e.error.internal.includes("No toconnect access to business object")){t=d.getErrorMessage("10");d.displayErrorMessage(t,"error")}else if(n.is(e.error.internal)&&e.error.internal.includes("No 'modify' access on Attribute 'Co-Owners' for")){t=d.getErrorMessage("2005");d.displayErrorMessage(t,"error")}else PADAlert.displayNotification({msg:e.error.message,eventID:"error"})})}}},notifyUsers:function(e){if(e&&n.is(e.get,"function")){var t="",i=e.get("subjectUri");if(i.length>0&&i.includes("pid:")){o="pid:";let e=i.indexOf(o)+o.length,n=i.length;t=i.substring(e,n)}var s=e.get("richMessage"),o='class="sum-user-link sm-link" data-login="',a=[];if(s.split("</a>").forEach(function(e){if(e.length>0&&e.includes(o)){let n=e.indexOf(o)+o.length,i=e.indexOf('"',n);var t=e.substring(n,i);a.push(t)}}),t.length>0){e={issue:t,users:a.toString()};l.comments.notify({data:e})}}},placeholder:{_view:new a,show:function(e){this._view.render("comments").inject(e),this._view.show()},hide:function(){this._view.hide(),this._view.empty()}}})}),define("DS/IssueManagement/views/facets/Attachments",["UWA/Class/Promise","UWA/Core","UWA/Class/View","DS/IssueAttachmentManager/IssueAttachmentManager","DS/IssueCommon/commands/CommandsManager","DS/IssueManagement/views/facets/Placeholder","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","css!DS/IssueCommon/IssueCommon.css","i18n!DS/IssueCommon/assets/nls/IssueCommon"],function(e,t,n,i,s,o,a,r,l,c){"use strict";var d="ENX3DIR_AP";return n.extend({name:"DS/IssueManagement/views/facets/Attachments",tag:"div",className:"attachments-view fade-in-element",manager:null,_subscriberId:"",_eventListeners:[],setup:function(n){var s=this;r.start(s.name+" setup"),s._parent(n),s._deferred={},s.isLoaded=new e(function(e,t){s._deferred.resolve=e,s._deferred.reject=t}),s.target=t.createElement("div",{class:"attachments-content"}),s.container.setContent(s.target);var o=a.get("widget"),l=a.get("component"),c=o.body.getDimensions(),u={mode:2,catalogLayout:o.getValue("attachmentLayout")?o.getValue("attachmentLayout"):1,catalogVisibility:!0,sliderVisibility:!1,annotationPreLaunchCallback:function(){if(s.hasOwnProperty("modal")&&s.modal.hide(),o.name===d)try{this.annotationCanvasTarget=t.Element.getElement.call(l.get3DContext().root.getFrameWindow().elements.viewerFrame,"canvas")}catch(e){}else this.annotationCanvasDefaultDimensions={width:c.width-50,height:c.height-50}}},m=a.get("widget").getValue("attachmentManagerPreferences");u=t.merge(u,m||{});var p=s.getOption("physicalIds");u.id=p[p.length-1],s.manager=new i(u),s._subscriberId=Math.random().toString(36).substr(2,9),r.end(s.name+" setup")},render:function(){var e=this;!1===e.isValidSelection()?(e.target.hide(),e.placeholder.show(e.container)):(e.placeholder.hide(e.container),e.target.show()),r.start(e.name+" render");var t=a.get("component");return e.manager.render().inject(e.target),e.manager.isLoaded.then(function(){e.utils._addCustomCommands.apply(e),e.manager.container.setAttribute("tabindex","0"),e.manager.container.focus(),e.manager.resize(),e.listenTo(e.manager,"onRefresh",e.utils._addCustomCommands.bind(e)),e.listenTo(t,"onResize",function(){e.manager.resize()}),e.listenTo(e.manager,"onUpdate",function(t){for(var n=[],i={},s=Object.keys(t.objects),o=0;o<s.length;o++)n.push([t.objects[s[o]].physicalId]),i[t.objects[s[o]].physicalId]={id:t.objects[s[o]].physicalId,type:t.objects[s[o]].type||"Issue",modifiedAttributes:["attachments"]};a.get("eventsHandler").publish(e._subscriberId,"DS/Object/update",{metadata:{appId:a.get("widget").id,appName:a.get("widget").name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:n,attributes:i},version:"1.0"})}),e._eventListeners=[{event:"DS/Object/update",listener:function(t){e.manager&&e.manager.id&&(t.data.paths.some(function(t){return e.manager.id===t[0]})&&e.manager.refresh())},conditions:{type:"issue",attributes:["attachments","state"]}}];for(var n=0;n<e._eventListeners.length;n++){var i=e._eventListeners[n];i.token=a.get("eventsHandler").subscribe(e._subscriberId,i.event,i.listener.bind(e),i.conditions)}e._deferred.resolve(),e.dispatchEvent("onReady",{})}),r.end(e.name+" render"),e},refresh:function(t){var n=this;return n.setOption("physicalIds",t),n.isLoaded=new e(function(e,t){n._deferred.resolve=e,n._deferred.reject=t}),!1===n.isValidSelection()?(n.target.hide(),n.placeholder.show(n.container),setTimeout(function(){n._deferred.resolve(),n.dispatchEvent("onReady",{})},0),n.isLoaded):(n.placeholder.hide(n.container),n.target.show(),n.options.physicalIds=t,n.manager.refresh(n.options.physicalIds[n.options.physicalIds.length-1]).then(function(){n._deferred.resolve()}),n.isLoaded)},resize:function(){this.manager.resize()},destroy:function(){var e=a.get("component");if(this.stopListening(e,"onResize"),this.stopListening(this.manager,"onUpdate"),this.stopListening(this.manager,"onRefresh"),Array.isArray(this._eventListeners))for(var t=0;t<this._eventListeners.length;t++){var n=this._eventListeners[t];a.get("eventsHandler").unsubscribe(n.token)}this._eventListeners=[],this._subcriberId="",null!==this.manager&&(this.manager.destroy(),this.manager=null),this.destroy()},isValidSelection:function(){var e=this.getOption("physicalIds");return Array.isArray(e)&&1===e.length},placeholder:{_view:new o,show:function(e){this._view.render("attachments").inject(e),this._view.show()},hide:function(){this._view.hide(),this._view.empty()}},utils:{_addCustomCommands:function(){var e=this,t=function(){s.getCommand("AttachmentManager").begin({authoring:e.manager.authoring})};(e.manager.views.header.iconBarFix.addItem({id:"popup",fonticon:"popup",text:c.attachments.popup,selectable:!0,handler:t}),this.manager&&this.manager.contextualMenu&&this.manager.contextualMenu.customCommands)&&(this.manager.contextualMenu.customCommands.some(function(e){return"popup"===e.name})||this.manager.contextualMenu.customCommands.push({name:"popup",title:c.attachments.popup,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-popup"},data:null,action:{callback:t}}))}}})}),define("DS/IssueManagement/views/facets/Relations",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/ENORIPE_Relations/RelationsTabSettings","DS/ENORIPE_Relations/views/RelationsTab","UWA/Class/Model","DS/IssueServices/Contexts","DS/IssueManagement/views/facets/Placeholder","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","css!DS/IssueCommon/IssueCommon.css"],function(e,t,n,i,s,o,a,r,l,c,d,u){"use strict";return t.extend({name:"DS/IssueManagement/views/facets/Relations",tag:"div",className:"relations-view fade-in-element",defaultOptions:{physicalIds:[]},relations:null,elements:{target:null},setup:function(e){d.start(this.name+" setup"),this._parent(e),this.elements.target=n.createElement("div",{class:"relations-content"}),this.container.setContent(this.elements.target),this.relations=null,d.end(this.name+" setup")},render:function(){var e=this;if(!1===e.isValidSelection())return e.elements.target.hide(),e.placeholder.show(e.container),setTimeout(function(){e.dispatchEvent("onReady",{})},0),e;e.placeholder.hide(e.container),e.elements.target.show(),d.start(e.name+" render");var t=e.getOption("physicalIds");return e.renderRelations(t[0]),d.end(e.name+" render"),e},renderRelations:function(e){var t=this,n="ctx::"+decodeURIComponent(l.getSecurityContext()),a={isDraggable:!0,isProfilesVisible:!0,appID:"ENORIPE_ISU",isExternal:!0,securityContext:n},r={getPlatformID:function(){return l.getTenant()},getServiceID:function(){return"3DSpace"}},c=new o({source:"3DSpace",tenant:l.getTenant(),objectId:e});return i.isAvailable(r,a).then(function(e){"object"==typeof e&&e.isAvailable&&void 0!==e.facetInfo&&(null!=t.relations&&null!=t.relations||(t.relations=new s,t.relations.elements.container.inject(t.elements.target)),t.relations.updateFacetOptions({securityContext:n}).then(function(){t.relations.updateFacetExternal(c)}))})},refresh:function(t){if(this.setOption("physicalIds",t),!1===this.isValidSelection())this.elements.target.hide(),this.placeholder.show(this.container);else{if(this.placeholder.hide(this.container),this.elements.target.show(),null==this.relations||null==this.relations)return this.renderRelations(t[0]);var n=new o({source:"3DSpace",tenant:l.getTenant(),objectId:t[0]});this.relations.updateFacetExternal(n)}return e.resolve()},destroy:function(){this.stopListening(this,"onReady"),null!==this.relations&&(this.relations.destroy(),this.relations=null),this.container.empty()},isValidSelection:function(){var e=this.getOption("physicalIds");return Array.isArray(e)&&1===e.length},placeholder:{_view:new r,show:function(e){this._view.render("relations").inject(e),this._view.show()},hide:function(){this._view.hide(),this._view.empty()}}})}),define("DS/IssueManagement/utils/customization/PADCustomizeView",["css!DS/UIKIT/UIKIT","css!DS/IssueManagement/IssueManagement.css","i18n!DS/IssueManagement/assets/nls/IssueManagement_list","UWA/Controls/Abstract","UWA/Class/Events","DS/Controls/Button","DS/Controls/Toggle","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Tree/TreeListView","DS/IssueServices/Contexts","DS/Core/PointerEvents","DS/IssueManagement/utils/customization/ComboSelector","DS/WidgetServices/WidgetServices"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p){"use strict";return i.extend(s,{name:"padcustomizeview",_command_id:"",_applyOnlyToThisApp:!1})}),define("DS/IssueManagement/export/ExportPPTX",["UWA/Class/Promise","UWA/Core","DS/IssueManagement/export/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a){"use strict";var r="DS/IssueManagement/export/ExportPPTX",l="Issue";return{exportation:function(){var t=this;o.start(r+" exportation");var c=i.get("component"),d=i.get("status"),u=a.export.pptx.name;return new e(function(e,t){var i=c.getSelectedNodes().filter(function(e){return e.options.baseType===l});0===i.length?(0===(i=c.getTreeDocument().getRoots(!1)).length&&(n.notifications.nothing(),t(new Error("Nothing to export as PPTX"))),n.confirmation({title:a.export.pptx.title,content:a.replace(a.export.pptx.content,{number:i.length})}).then(function(n){!0===n?e(i):t(new Error("Export PPTX canceled by user"))})):e(i)}).then(function(e){1===e.length&&(u=u+e[e.length-1].options.name+"_"),n.notifications.exporting(),d.loading.start(),d.loading.update(a.export.pptx.exporting);for(var i=[],l=0;l<e.length;l++)i.push({physicalId:e[l].options.physicalId});return s.export.pptx({data:{objects:i}}).then(function(e){t.utils.saveByteArray(e,u+(new Date).toString().split(" ").splice(1,4).join(" ")+".pptx"),d.loading.hide(a.export.pptx.done)},function(e){var t=new TextDecoder("utf-8"),i=JSON.parse(t.decode(e));n.notifications.failure(i.error.message),d.loading.hide(a.export.pptx.failure)}).finally(function(){o.end(r+" exportation")})})},utils:{saveByteArray:function(e,n){var i=t.createElement("a");document.body.appendChild(i),i.style="display: none";var s=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}),o=window.URL.createObjectURL(s);i.href=o,i.download=n,i.click(),setTimeout(function(){document.body.removeChild(i),window.URL.revokeObjectURL(o)},0)}}}}),define("DS/IssueManagement/views/facets/History",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/IssueComponents/routes/Routes","DS/IssueManagement/views/facets/Placeholder","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","DS/IssueTimeline/IssueTimeline","DS/IssueCommon/utils/Utils","css!DS/IssueCommon/IssueCommon.css"],function(e,t,n,i,s,o,a,r,l){"use strict";return t.extend({name:"DS/IssueManagement/views/facets/History",tagName:"div",className:"history-view fade-in-element",defaultOptions:{physicalIds:[]},timeline:null,_subscriberId:"",_eventListeners:[],setup:function(t){var s=this;a.start(s.name+" setup"),s._parent(t),s.target=n.createElement("div",{class:"history-content"}),s.container.setContent(s.target);var l=s.getOption("physicalIds");s.timeline=new r({physicalId:l[l.length-1]}),s.routes=new i({physicalId:l[l.length-1]});var c=new e(function(e,t){s.listenTo(s.timeline,"onReady",function(t){e(t)}),s.listenTo(s.timeline,"onFailure",function(e){t(e)})}),d=new e(function(e,t){s.listenTo(s.routes,"onReady",function(t){s.container.toggleClassName("history-view-timeline-only",s.routes.isEmpty),e(t)}),s.listenTo(s.routes,"onFailure",function(e){t(e)})});e.all([c,d]).then(function(e){s.container.toggleClassName("history-view-wide",s.container.offsetWidth>1.4*s.container.offsetHeight),s.container.toggleClassName("history-view-timeline-only",null===s.routes||s.routes.isEmpty),s.dispatchEvent("onReady",e)}).catch(function(e){s.dispatchEvent("onFailure",e)}),s._subscriberId=Math.random().toString(36).substr(2,9),s._eventListeners=[{event:"DS/Object/update",listener:function(e){s.routes&&s.routes.getOption("physicalId")&&(e.data.paths.reduce(function(e,t){return e.push(t.pop()),e},[]).indexOf(s.routes.getOption("physicalId"))>-1&&s.routes.refresh(s.routes.getOption("physicalId")).then(function(){s.container.toggleClassName("history-view-timeline-only",null===s.routes||s.routes.isEmpty)}))},conditions:{type:"issue",attributes:["state","assignees"]}},{event:"DS/Object/update",listener:function(e){s.timeline&&s.timeline.getOption("physicalId")&&(e.data.paths.reduce(function(e,t){return e.push(t.pop()),e},[]).indexOf(s.timeline.getOption("physicalId"))>-1&&s.timeline.refresh(s.timeline.getOption("physicalId")))},conditions:{type:"issue"}}];for(var u=0;u<s._eventListeners.length;u++){var m=s._eventListeners[u];m.token=o.get("eventsHandler").subscribe(s._subscriberId,m.event,m.listener.bind(s),m.conditions)}a.end(s.name+" setup")},render:function(){return!1===this.isValidSelection()?(this.elements.target.hide(),this.placeholder.show(this.container)):(this.placeholder.hide(this.container),this.target.show()),a.start(this.name+" render"),this.timeline.render().inject(this.target),this.routes.render().inject(this.target),this.container.toggleClassName("history-view-wide",this.container.offsetWidth>1.4*this.container.offsetHeight),this.container.toggleClassName("history-view-timeline-only",!0),a.end(this.name+" render"),this},refresh:function(t){var n=this;return n.setOption("physicalIds",t),!1===n.isValidSelection()?(n.target.hide(),n.placeholder.show(n.container),setTimeout(function(){n.dispatchEvent("onReady",{})},0),e.resolve()):(n.placeholder.hide(n.container),n.target.show(),e.all([n.timeline.refresh(t[t.length-1]),n.routes.refresh(t[t.length-1])]).then(function(){n.container.toggleClassName("history-view-timeline-only",null===n.routes||n.routes.isEmpty),n.dispatchEvent("onReady",{});try{l.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"InformationHistory"}})}catch(e){}}))},resize:function(){null!==this.timeline&&this.timeline.resize(),null!==this.routes&&this.routes.resize(),this.container.toggleClassName("history-view-wide",this.container.offsetWidth>1.4*this.container.offsetHeight)},destroy:function(){if(this.stopListening(this.timeline,"onReady"),this.stopListening(this.timeline,"onFailure"),Array.isArray(this._eventListeners))for(var e=0;e<this._eventListeners.length;e++){var t=this._eventListeners[e];o.get("eventsHandler").unsubscribe(t.token)}this._eventListeners=[],this._subcriberId="",this.timeline.destroy(),this.timeline=null,this.container.empty()},isValidSelection:function(){var e=this.getOption("physicalIds");return Array.isArray(e)&&1===e.length},placeholder:{_view:new s,show:function(e){this._view.render("history").inject(e),this._view.show()},hide:function(){this._view.hide(),this._view.empty()}}})}),define("DS/IssueManagement/commands/CommandsManager",["UWA/Class","UWA/Class/Events","DS/IssueManagement/components/header/IssueDataGridToolbar","DS/ApplicationFrame/CommandsManager","DS/Logger/Logger"],function(e,t,n,i,s){"use strict";var o="Issue",a="Default";return e.singleton(t,{_logger:null,init:function(){this._logger=s.getLogger("DS/IssueManagement/View")},setContext:function(e){a=e},commands:{issue:{single:["ChangeAction","3DMarkup"],multi:["Export","Subscription"],disable:[]},other:{single:[],multi:[],disable:["Export","ChangeAction","3DMarkup","Subscription"]},empty:{single:[],multi:["InlineCreate","Create","Templates","Print","ColumnCustomization","Dynamic"],disable:["ChangeAction","3DMarkup","Find","Subscription"]},common:{single:[],multi:["Print","ColumnCustomization"],disable:["Find"]}},all:["InlineCreate","Create","ChangeAction","3DMarkup","Templates","Print","ColumnCustomization","Dynamic","Subscription"],special:["Selection","Export","Dynamic","SwitchLayout","ToggleInformationPanel","Print"],idling:function(){var e=this.all;this.disable(e.filter(function(e){return!this.has(e)},new Set(["InlineCreate","Create","Templates"]))),this.dispatchEvent("onDisable",{commands:this.special,isIdle:!0}),this.enable(["InlineCreate","Create","Templates","Dynamic"])},select:function(e){this._logger.debug("Selecting elements in the list..."),this.dispatchEvent("onEnable",{commands:this.special});var t=[],n=[],i=[],s=[];if(!e||0===e.length)return t=this.all,n=this.commands.empty.multi,this.disable(t.filter(function(e){return!this.has(e)},new Set(n))),void this.enable(this.commands.empty.multi);var a=e.every(function(e){return e.options.baseType===o}),r=e.every(function(e){return e.options.baseType!==o});if(1===e.length){for(var l in this.commands)if(this.commands.hasOwnProperty(l))switch(l){case"issue":!1===a?s=s.concat(this.commands.other.disable):i=(i=i.concat(this.commands.issue.single)).concat(this.commands.issue.multi);break;default:i=i.concat(this.commands[l].single).concat(this.commands[l].multi)}}else for(var c in this.commands)if(this.commands.hasOwnProperty(c))switch(c){case"issue":!0===r?s=s.concat(this.commands.other.disable):1==a?i=i.concat(this.commands.issue.multi):!1===r&&0==a&&(s=s.concat(["Subscription"]),i=i.concat(["Export"])),s=s.concat(this.commands.issue.single);break;default:i=i.concat(this.commands[c].multi)}t=t.concat(this.all),n=i,s=s.concat(t.filter(function(e){return!this.has(e)},new Set(n))),this.disable(s),this.enable(i)},getCommand:function(e){var t=a;return i.getCommand(e,t)},getCommandCheckHeader:function(e){var t=a;return i.getCommandCheckHeader(e,t)},enable:function(e){Array.isArray(e)&&(this._switchCommands(e,!0),this.dispatchEvent("onEnable",{commands:e}))},disable:function(e){Array.isArray(e)&&(this._switchCommands(e,!1),this.dispatchEvent("onDisable",{commands:e}))},_switchCommands:function(e,t){for(var i=n.toolbarActionBar,s=0;s<e.length;s++)try{!0===t?i.updateNodeModel(e[s],{visibleFlag:!0}):"Export"!=e[s]&&"Subscription"!=e[s]&&i.updateNodeModel(e[s],{visibleFlag:!1})}catch(n){this._logger.debug("Cannot set the command %s to %s",e[s],t)}}})}),define("DS/IssueManagement/components/header/InlineCreate",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Text","DS/UIKIT/DropdownMenu","DS/UIKIT/Mask","DS/UIKIT/Tooltip","DS/Controls/LineEditor","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","DS/IssueManagement/commands/CommandsManager","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Parser","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p,h,g,f,v,I){"use strict";var b=7,y=13,S=27,w=40,C="IFB",T="IFT",E="IFRT",D="RECENT_TEMPLATES_HEADER",_="LOADING_TEMPLATES_PLACEHOLDER",A="SIMILAR_ISSUES",M="Analyst",N=250,x=100,O=0,P="Issue",k=1e3;return t.extend({name:"DS/IssueManagement/components/header/Find",tagName:"div",className:"create-container",_logger:null,domEvents:{"keyup input.create-input":"_onKeyUp","keydown input.create-input":"_onKeyDown","click .clear-create":"_onClear","click .validate-create":"_onValidate"},input:null,dropdown:null,icons:null,clear:null,validate:{button:null,tooltip:null},_onCreating:!1,_similarities:{issues:[],search:null},setup:function(e){v.start(this.name+" setup"),this._parent(e),this._logger=l.getLogger(this.name),this.input=null,this.dropdown=null,this.icons=null,this.clear=null,this.validate={button:null,tooltip:null},this._subscriberId=Math.random().toString(36).substr(2,9),this._onCreating=!1,this._similarities={issues:[],search:d.debounce(this._searchSimilarIssues.bind(this),k)},v.end(this.name+" setup")},render:function(){var e=this;v.start(e.name+" render"),e.input=new r({visibleFlag:!0,displayClearFieldButtonFlag:!1,placeholder:I.actions.create.placeholder,autoCommitFlag:!0}),e.input.addEventListener("change",()=>{e._onChangeEvent()}),e.input.getContent().getElement("input").addClassName("create-input"),e.input.getContent().setStyle("width","100%"),setTimeout(()=>{e.input.focus()},100),e.dropdown=new s({className:"im-inline-create-dropdown",target:e.input.elements.container,bound:!1,closeOnClick:!1,items:[{id:C,text:I.actions.create.issue.blank,fonticon:"issue-type"},{id:T,text:I.actions.create.issue.template,fonticon:"template"},{id:D,text:I.actions.create.issue.recentTemplate,className:"im-inline-create-recent-template-header"},{id:_,text:" "}],events:{onShow:function(){var t=e.input.elements.container.offsetWidth;e.dropdown.elements.container.setStyle("width",t);var i=e.dropdown.getItem(_);d.Mask.mask(i.elements.container),require(["DS/IssueComponents/templates/TemplatesDataGridLayout","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(t,i){new t(p.get("widget"),{editMode:!0,onClose:function(){},onEnd:function(){}});u.getRecentlyUsedTemplates().then(function(t){var n=[];if(""!==t.body&&(n=t.body),null!==e.dropdown){if(e.dropdown.removeItem(_),0===n.length)return e.dropdown.addItem({id:"empty",text:i.templates.treeList.placeholder,title:i.templates.treeList.placeholder,data:null,fonticon:"clock",disabled:!0}),null;for(var s=0;s<n.length;s++){e.dropdown.addItem({id:E+":::"+n[s].physicalId,text:d.getTextFromHTML(n[s].name),title:d.getTextFromHTML(n[s].name),data:n[s],fonticon:"clock",disabled:!1})}return n}return null},function(t){e._logger.error("Could not fetch the templates: %o",t),e.dropdown.removeItem(_),e.dropdown.addItem({id:"empty",text:i.templates.errors.get,title:i.templates.errors.get,data:null,fonticon:"attention ",disabled:!0})}).finally(function(){null,n.is(e.dropdown,"object")&&(e.dropdown.removeItem(A),e._similarities.issues.length&&e.dropdown.addItem({id:A,text:I.replace(I.actions.create.issue.similarIssues,{count:e._similarities.issues.length}),title:I.replace(I.actions.create.issue.similarIssues,{count:e._similarities.issues.length}),fonticon:"open",className:"im-inline-create-similar-issues-header"}))})})},onClick:function(t,n){var i=m.getCommand("Create"),s=e.input.value.trim();s.length>0?i.autoFillData={title:s}:i.autoFillData=null;var o=!0;switch(n.id){case C:i.mode=C,i.begin();try{var a=p.get("component").getCurrentView();d.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:a,pd3:"SummaryToolbar",pd4:"NewIssue",pd5:"Issue/"+a+"/SummaryToolbar/NewIssue"}})}catch(e){}break;case T:i.mode=T,i.begin();try{a=p.get("component").getCurrentView();d.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:a,pd3:"SummaryToolbar",pd4:"NewIssueFromTemplate",pd5:"Issue/"+a+"/SummaryToolbar/NewIssueFromTemplate"}})}catch(e){}break;case A:o=!1;var r=d.computeSharedIssuesURL(e._similarities.issues.map(function(e){return e.physicalId}));window.open(r,"_blank");break;case _:case D:return;default:if(0===n.id.indexOf(E)){i.mode=T,i.template=n.data,i.begin();try{a=p.get("component").getCurrentView();d.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:a,pd3:"SummaryToolbar",pd4:"RecentTemplates",pd5:"Issue/"+a+"/SummaryToolbar/RecentTemplates"}})}catch(e){}break}}!0===o&&e._onClose()}}});var t=null;return e.icons=n.createElement("div",{class:"icons-create",html:[t=n.createElement("div",{class:"clear-create fonticon fonticon-cancel-circled"})]}),t.setAttribute("style","font-size: 15px !important"),e.input.inject(e.container),e.icons.inject(e.container),e.clear=new a({position:"bottom",target:t,body:I.actions.create.clear}),v.end(e.name+" render"),e},destroy:function(){this.dropdown.destroy(),this.dropdown=null,this.input.destroy(),this.input=null,this.icons=null,this.clear.destroy(),this.clear=null,null!==this.validate.button&&(this.validate.button.destroy(),this.validate.tooltip.destroy(),this.validate={button:null,tooltip:null}),this._onCreating=!1,this._similarities={issues:[],search:null},this.container.remove()},focus:function(){var e=this;if(e.dropdown&&e.input){e.dropdown.show(),e.input.focus();var t=function(){setTimeout(function(){e.input&&""===e.input.value.trim()&&(n.is(e.dropdown)&&Array.isArray(e.dropdown.menus)&&e.dropdown.menus.length>0&&document.activeElement===e.dropdown.menus[O].elements.wrapper||(e.input.elements.container.removeEventListener("focusout",t),setTimeout(function(){e._onClose()},N)))},x/10)};e.input.elements.container.addEventListener("focusout",t)}},_onKeyUp:function(e){var t=this.input.value.trim();document.activeElement===e.target&&e.target===this.input.elements.inputField&&(t.length>0?(null===this.validate.button&&(this.validate.button=n.createElement("div",{class:"validate-create fonticon fonticon-check"}),this.validate.button.inject(this.icons),this.validate.button.setAttribute("style","font-size: 15px !important"),this.validate.tooltip=new a({position:"bottom",target:this.validate.button,body:I.actions.create.title})),n.is(this._similarities.search,"function")&&this._similarities.search()):this.validate.button instanceof HTMLElement&&(this.validate.button.destroy(),this.validate.tooltip.destroy(),this.validate={button:null,tooltip:null}))},_onKeyDown:function(e){var t=this;if(!0!==t._onCreating)if(e.keyCode!==S||document.activeElement!==e.target||e.target!==t.input.elements.inputField){if(e.keyCode===w&&document.activeElement===e.target&&e.target===t.input.elements.inputField){t.dropdown.menus[O].focusIt();var n=document.createEvent("Events");return n.initEvent("keydown",!0,!0),n.which=40,void t.dropdown.menus[O].elements.container.dispatchEvent(n)}var i=t.input.value.trim();if(e.keyCode===y&&document.activeElement===e.target&&e.target===t.input.elements.inputField){if(0===i.length)return t.input.elements.inputField.addClassName("has-error"),void(t.input.value="");t._onCreating=!0,t._onValidate({doNotClose:!0}).then(function(){t.validate.button instanceof HTMLElement&&(t.validate.button.destroy(),t.validate.tooltip.destroy(),t.validate={button:null,tooltip:null})}).finally(function(){t._onCreating=!1})}}else t._onClose()},_onChangeEvent:function(){0==this.input.value.trim().length&&this.validate.button instanceof HTMLElement&&(this.validate.button.destroy(),this.validate.tooltip.destroy(),this.validate={button:null,tooltip:null})},_onValidate:function(e){var t=this,i=p.get("widget")||window.widget;o.mask(i.body),t.input.elements.inputField.removeClassName("has-error");var s,a,r,l=new Date,d=new Date(l.getFullYear(),l.getMonth(),l.getDate()+b);"true"==p.get("ISU_AUTO_DATES")&&(s=l.getMonth()+1+"/"+l.getDate()+"/"+l.getFullYear(),a=d.getMonth()+1+"/"+d.getDate()+"/"+d.getFullYear(),r=d.getMonth()+1+"/"+d.getDate()+"/"+d.getFullYear());let u=g.getSecurityContexts().cspaces;var m={title:t.input.value,resolutionDate:r,estimatedStartDate:s,estimatedEndDate:a,responsibleOrganization:g.getCurrentCredentials().organization,reportingOrganization:g.getCurrentCredentials().organization,securityContexts:i.getPreference("pad_security_ctx")?i.getPreference("pad_security_ctx").value:u[0].value};if(i.getValue("createSetting")&&i.getValue("selectedContext")){var f=i.getValue("selectedContext").id,v=i.getValue("selectedContext").type,I=i.getValue("selectedContext").serviceId;I.includes(":")&&(I=I.split(":")[0]);var y=g.getTenant(),S=[],w=p.get("ISU_TYPE_NLS");if(n.is(w["ds6w:type"])&&(S=Object.keys(w["ds6w:type"])),!S.includes(v)){var C=i.getValue("affectedItemCreateSetting"),T=i.getValue("contextCreateSetting");C&&(m.reportedAgainst=[{path:[f],physicalId:f,objectType:v,serviceId:I,envId:y}]),T&&(m.contexts=[{physicalId:f,objectType:v,serviceId:I,envId:y}])}}return h.preferences.getApprovalEnablement({data:{}}).then(function(i){var s=i.body.ApprovalProcess;"Always"==s?(m.waitingOn=M,t._onCreate(e,m)):"Never"==s?t._onCreate(e,m):h.preferences.get({data:{name:"approvalPreference"}}).then(function(n){!0===n.body&&(m.waitingOn=M),t._onCreate(e,m)}).catch(function(e){e&&n.is(e.error,"object")&&n.is(e.error.message,"string")&&c.displayNotification({msg:e.error.message,eventID:"error"})})}).catch(function(e){e&&n.is(e.error,"object")&&n.is(e.error.message,"string")&&c.displayNotification({msg:e.error.message,eventID:"error"})})},_onCreate:function(e,t){var i=this,s=p.get("widget")||window.widget;h.issues.create({data:t}).then(function(n){var a=n.body;try{d.cloudProbeUtils.sendCreateIssueTrackerEvent({createData:t,options:{issueCreationType:"InlineIssue"}});var r=p.get("component").getCurrentView();d.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:r,pd3:"SummaryToolbar",pd4:"InlineCreate",pd5:"Issue/"+r+"/SummaryToolbar/InlineCreate"}}),d.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}finally{const n=I.replace(I.actions.create.success,{title:t.title});c.displayNotification({msg:n,eventID:"success"}),o.unmask(s.body);var l=p.get("eventsHandler"),u=[],m={};u.push([a.physicalId]),m[a.physicalId]={id:a.physicalId,type:P};var h={metadata:{appId:s.id,appName:s.name,timestamp:Math.floor(Date.now())},data:{paths:u,attributes:m},version:"1.0"};l.publish(i._subscriberId,"DS/Object/create",h),setTimeout(function(){i.input.value="",e&&!0!==e.doNotClose&&i._onClose()},0)}}).catch(function(e){if(o.unmask(s.body),e&&n.is(e.error,"object")&&n.is(e.error.message,"string"))if(n.is(e.error.internal)&&(e.error.internal.includes("ErrorCode:2004")||e.error.internal.includes("Admin not allowed to create Issue"))){var t=d.getErrorMessage("4");d.displayErrorMessage(t,"error")}else c.displayNotification({msg:e.error.message,eventID:"error"});else c.displayNotification({msg:I.actions.create.failure,eventID:"error"})})},_onClear:function(){null!==this.input&&(this.input.value="",this.input.focus(),this.validate.button instanceof HTMLElement&&(this.validate.button.destroy(),this.validate.tooltip.destroy(),this.validate={button:null,tooltip:null}))},_onClose:function(){this._onClear(),m.getCommandCheckHeader("InlineCreate").setState(!1,!1)},_searchSimilarIssues:function(){var e=this;if(n.is(e.input)&&n.is(e.dropdown)){var t=e.input.value.trim();t.length>0?h.search({data:{query:"(3dexpiss:#all) "+t,select_predicate:["resourceid","ds6w:created","ds6w:modified","ds6w:identifier","owner","ds6w:responsible","ds6wg:revision","ds6w:status","ds6w:label","ds6w:type"]}}).then(function(t){e.dropdown&&(Array.isArray(t.body.results)?e._similarities.issues=t.body.results.map(function(e){return f.parseFetchResponse(e).value}):e._similarities.issues=[],e.dropdown.removeItem(A),e._similarities.issues.length>0&&e.dropdown.addItem({id:A,text:I.replace(I.actions.create.issue.similarIssues,{count:e._similarities.issues.length}),title:I.replace(I.actions.create.issue.similarIssues,{count:e._similarities.issues.length}),fonticon:"open",className:"im-inline-create-similar-issues-header"}))}):(e._similarities.issues=[],e.dropdown.removeItem(A))}}})}),define("DS/IssueManagement/components/header/ActionBarDataGrid",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Iconbar","DS/UIKIT/Tooltip","DS/ApplicationFrame/ActionBar","DS/WebappsUtils/WebappsUtils","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/utils/DragAndDrop","DS/IssueServices/Contexts","DS/IssueServices/utils/LocalStorage","DS/IssueManagement/components/header/IssueDataGridToolbar","i18n!DS/IssueManagement/assets/nls/IssueManagement","css!DS/IssueManagement/IssueManagement.css"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p){"use strict";var h="ListView",g="KanbanView",f={RIGHT:"right",BOTTOM:"bottom"};return t.extend({name:"DS/IssueManagement/components/header/ActionBarDataGrid",tagName:"div",className:"action-bar",_iconBar:null,_switchers:{layout:null,information:null,tooltips:{layout:null,information:null}},setup:function(e){d.get("component");this._parent(e),this._iconBar=null,this._switchers={layout:null,information:null,tooltips:{layout:null,information:null}},this._filterModule=null,this._abar=new a({file:"IssueManagement.xml",module:"IssueManagement",context:"Default"}),this._subscribers()},render:function(){var t=this;t._filterModule=d.get("filter");var n=d.get("widget")||window.widget,i=d.get("component");t.listView=d.get("ISU_LISTVIEW"),t.container.addClassName("disabled");var s=t.utils.getCurrentView(),o="",a="",r="",u="",g="",v="";t.listView?p.actions.listView:p.actions.gridView,s===h&&t.listView?(o="view-list",p.actions.listView,a=p.actions.listView,r="selected",u="undefined",g=!0,v=!1):s===h?(o="view-list",p.actions.gridView,a=p.actions.listView,r="selected",u="undefined",g=!0,v=!1):(o="chart-kanban",p.actions.kanbanView,a=p.actions.kanbanView,r="undefined",u="selected",g=!1,v=!0);var I={kanbanViewByState:"undefined",kanbanViewByPriority:"undefined",kanbanViewByResDate:"undefined",kanbanViewByAll:"undefined"};switch(n.getValue("kanbanViewBy")||"state"){case"state":I.kanbanViewByState="selected";break;case"priority":I.kanbanViewByPriority="selected";break;case"resolutionDate":I.kanbanViewByResDate="selected";break;case"all":I.kanbanViewByAll="selected"}var b=n.getValue("infoIsOpened"),y={listView:r,kanbanView:u,tooltip:a,icon:o,customizeDatagridView:g,customizeKanbanView:v,kanbanViewBySetting:I,isOpened:e.is(b,"boolean")?b:"true"===b,switchLayout:w=e.clone(n.getValue("infoLayout"))||f.RIGHT};m.toolbarActionBar=i.list.setToolbar(m.writetoolbarDefination(y)),t.toolbar=m.toolbarActionBar,t.updateFilterMenu(),t.container.appendChild(t.toolbar.getContent()),t.registerUpdateToolbarCommandStatesEvent();var S=d.get("information"),w=S.getPreferences().current||f.RIGHT;return S.getLayout().current!==w&&l.getCommand("SwitchLayout")&&l.getCommand("SwitchLayout").begin({layout:w}),c.makeDroppable(t.toolbar.elements.container,c.onToolbarDrop),t.toolbar.elements.container.addEventListener("dragenter",function(e){t.toolbar.elements.container.addClassName("dragEnter-dnd-issue")}),t.toolbar.elements.container.addEventListener("drop",function(e){t.toolbar.elements.container.removeClassName("dragEnter-dnd-issue")}),t.toolbar.elements.container.addEventListener("dragleave",function(e){t.toolbar.elements.container.removeClassName("dragEnter-dnd-issue")}),t},refresh:function(){this.destroy(),this.render()},getToolbar:function(){return this.toolbar},destroy:function(){this.stopListening(l,"onEnable"),this.stopListening(l,"onDisable")},resize:function(){requestAnimationFrame(function(){})},enable:function(t){var n=this;Array.isArray(t)&&t.forEach(function(t){switch(t){case"ToggleInformationPanel":if(n.elements.infoIcon=document.getElementsByClassName("information-panel panel-icon-wrapper")[0],n.elements.infoIcon.classList.remove("isu-icon-disable"),l.getCommand("ToggleInformationPanel")){var i=d.get("widget").getValue("infoIsOpened"),s=e.is(i,"boolean")?i:"true"===i;n.toolbar.updateNodeModel("ToggleInformationPanel",{disabled:!1,grid:{semantics:{icon:m.getInformationIcon(s)}}}),l.getCommand("ToggleInformationPanel").begin({open:s,save:!1})}break;case"SwitchLayout":n.toolbar.updateNodeModel("SwitchLayout",{disabled:!1});break;case"Print":case"Export":var o=n.toolbar.getNodeModelByID("Dynamic").options.grid.data.menu;o.find(e=>e.id===t).state="enabled",n.toolbar.updateNodeModel("Dynamic",{grid:{data:{menu:o}}});break;case"Subscription":var a=[{id:"subscribe",type:"PushItem",title:p.actions.subscription.subscribe,icon:{iconName:"bell-add",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"subscribe",argument:{actionId:"subscribe"}}},{id:"unSubscribe",title:p.actions.subscription.unsubscribe,icon:{iconName:"bell-delete",fontIconFamily:1},type:"PushItem",action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"subscribe",argument:{actionId:"unSubscribe"}}},{id:"editSubscription",title:p.actions.subscription.editSubscription,type:"PushItem",icon:{iconName:"bell-pencil",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"subscribe",argument:{actionId:"editSubscription"}}},{id:"mySubscription",title:p.actions.subscription.mySubscriptions,type:"PushItem",icon:{iconName:"bell",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"subscribe",argument:{actionId:"mySubscription"}}}];n.toolbar.updateNodeModel("Subscription",{grid:{data:{menu:a}}});break;case"Selection":n.toolbar.updateNodeModel("Selection",{visibleFlag:!0});case"customizeDatagridView":n.toolbar.updateNodeModel("customizeDatagridView",{visibleFlag:!0})}})},registerUpdateToolbarCommandStatesEvent:function(){var e=this,t=d.get("component");e.setAddToolBarState(!1),t.list.treeDocument.getXSO().onPostAdd(function(t){var n={IdValue:"3DMarkup",StateValue:!0};t[0]._options&&(t[0]._options.reportedAgainst.length>0||t[0]._options.contexts.length>0)&&!e.isAllCSLData(t[0]._options)&&(n.StateValue=!1);var i=[{IdValue:"ChangeAction",StateValue:!1},n];m.setToolbarState(i,e.toolbar),e.setAddToolBarState(!1)}),t.list.treeDocument.getXSO().onPostRemove(function(n){if(t.list.treeDocument.getXSO().isEmpty()){var i=[{IdValue:"ChangeAction",StateValue:!0},{IdValue:"3DMarkup",StateValue:!0}];m.setToolbarState(i,e.toolbar)}})},setAddToolBarState:function(e){var t;t={IdValue:"InlineCreate",StateValue:e},m.setToolbarState([t],this.toolbar)},disable:function(e){var t=this;Array.isArray(e)&&e.forEach(function(e){switch(e){case"ToggleInformationPanel":t.elements.infoIcon=document.getElementsByClassName("information-panel panel-icon-wrapper")[0],t.elements.infoIcon.classList.add("isu-icon-disable"),t.toolbar.updateNodeModel("ToggleInformationPanel",{disabled:!0,grid:{semantics:{icon:m.getInformationIcon(!1)}}}),l.getCommand("ToggleInformationPanel")&&l.getCommand("ToggleInformationPanel").begin({open:!1,save:!1});break;case"SwitchLayout":t.toolbar.updateNodeModel("SwitchLayout",{disabled:!0});break;case"Print":case"Export":var n=t.toolbar.getNodeModelByID("Dynamic").options.grid.data.menu;n.find(t=>t.id===e).state="disabled",t.toolbar.updateNodeModel("Dynamic",{grid:{data:{menu:n}}});break;case"Subscription":let i=[{id:"mySubscription",title:p.actions.subscription.mySubscriptions,type:"PushItem",icon:{iconName:"bell",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"subscribe",argument:{actionId:"mySubscription"}}}];t.toolbar.updateNodeModel("Subscription",{grid:{data:{menu:i}}});break;case"Selection":t.toolbar.updateNodeModel("Selection",{visibleFlag:!1});case"customizeDatagridView":t.toolbar.updateNodeModel("customizeDatagridView",{visibleFlag:!1})}})},getIconBar:function(){return this.toolbar},getApplicationFrameActionBar:function(){return this._abar},updatePanelToggle:function(){},updateLayoutSwitcher:function(e){d.get("widget")||window.widget},updateFilterMenu:function(){var e=this._filterModule.getFilterMenu();this.toolbar.updateNodeModel("Filter",{grid:{data:{menu:e}}})},_subscribers:function(){var e=this,t=d.get("widget")||window.widget;e.listenTo(l,"onEnable",function(t){e.enable(t.commands),e.utils.getCurrentView()===g&&l.disable(["Selection","Find"])}),e.listenTo(l,"onDisable",function(t){e.disable(t.commands)}),e._abar.onActionBarReady(function(){l.getCommandCheckHeader("InlineCreate").onStateChange(function(){}),t.addEvent("onSearch",function(n){var i=d.get("component"),s=d.get("templateComponent");if(e.utils.getCurrentView()===g)for(var o=i.kanban.currentView,a=i.kanban.columns[o].length,r=0;r<a;r++)for(var l=i.kanban.columns[o][r].getTreeDocument().getAllDescendants(),c=0;c<l.length;c++)l[c].getLabel().contains(n)||l[c].hide();else n&&(t.getValue("IsIssueSummaryView")?i.getTreeDocument().setFilterModel({label:{filterId:"stringRole",filterModel:{allowedRoles:n}}}):s.document.setFilterModel({label:{filterId:"stringRole",filterModel:{allowedRoles:n}}}))}),t.addEvent("onResetSearch",function(){d.get("ISU_LISTVIEW");var n=d.get("component"),i=d.get("templateComponent");if(e.utils.getCurrentView()===g)for(var s=n.kanban.currentView,o=n.kanban.columns[s].length,a=0;a<o;a++)for(var r=n.kanban.columns[s][a].getTreeDocument().getAllDescendants(),l=0;l<r.length;l++)r[l].isVisible()||r[l].show();else t.getValue("IsIssueSummaryView")?n.getTreeDocument().setFilterModel({}):i.document.setFilterModel({})}),e._iconBar&&e.disable(e._iconBar.disabledCommands),e.container.removeClassName("disabled")})},utils:{getCurrentView:function(){var e=u.getItem("view");return e&&e.name?e.name:(u.setItem("view",{name:h}),h)}},isAllCSLData:function(e){var t=0;return e.contexts&&e.contexts.forEach(e=>{"LEGACY_3DSPACE"==e.elementType&&t++}),e.reportedAgainst&&e.reportedAgainst.forEach(e=>{"LEGACY_3DSPACE"==e.elementType&&t++}),!(t>0)}})}),define("DS/IssueManagement/components/header/ActionBar",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Iconbar","DS/UIKIT/Tooltip","DS/UIKIT/DropdownMenu","DS/ApplicationFrame/ActionBar","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/utils/DragAndDrop","DS/IssueServices/Contexts","DS/IssueServices/utils/LocalStorage","i18n!DS/IssueManagement/assets/nls/IssueManagement","css!DS/IssueManagement/IssueManagement.css"],function(e,t,n,i,s,o,a,r,l,c,d,u,m){"use strict";return t.extend({})}),define("DS/IssueManagement/components/ContextualMenu",["UWA/Class/Promise","DS/WebappsUtils/WebappsUtils","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/IssueManagement/commands/CommandsManager","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueServices/utils/Views","DS/IssueCommon/utils/DocumentUtils","DS/IssueCommon/utils/Utils","DS/IssueAttachmentManager/services/AttachmentServices","i18n!DS/IssueManagement/assets/nls/IssueManagement","text!DS/IssueCommon/assets/Settings.json"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p,h){"use strict";var g="Issue",f="Closed",v="ListView",I={REPORTED_AGAINST:"reportedAgainst",RESOLVED_BY:"resolvedBy",RESOLVED_ITEMS:"resolvedItems",CONTEXTS:"contexts",OPEN_WITH:"Open with",OPEN:"Open"},b={REPORTED_AGAINST:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-location",RESOLVED_BY:"wux-ui-3ds wux-ui-3ds-1x fonticon-docs",RESOLVED_ITEMS:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-3d-object",CONTEXTS:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-3d-object",OPEN_WITH:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-open-menu-dot",OPEN:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-open"},y=100,S="DS/IssueManagement/components/ContextualMenu",w=function(){var e=o.get("component").getTreeListView().getManager().getKeymapManager();e.wait(),setTimeout(function(){e.listen()},y);var t=o.get("component").getKanbanView();t.columns[t.currentView].forEach(function(e){var t=e.grid._keymapManager;t.wait(),setTimeout(function(){t.listen()},y)})};return{getContextualMenuHeader:function(t){var n=[],i=o.get("component").getTreeListView().getManager(),s=o.get("ISU_LISTVIEW");n.push({title:p.commands.sizeColumnToFit,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-arrow-double-combo"},action:{callback:function(){s&&w(),i.sizeColumnToFit(t)}}});var a=i.getColumnIDFromDataIndex(t);return"none"!==i.getColumnOrderState(a)&&n.push({title:p.commands.clearSortOrder,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-sorting"},action:{callback:function(){s&&w(),i.setColumnOrderState(a,"none"),o.get("component").getTreeListView().preferences.resetPreferences({sort:!0})}}}),e.resolve(n)},getContextualMenu:function(){var t=o.get("component").getTreeDocument().getSelectedNodes();if(0===t.length)return e.resolve([]);var n=t.reduce(function(e,t){var n=[],i=[],s=[],o=[];t.options.reportedAgainst.forEach(function(e){var t=e.physicalId.split(","),i=t[t.length-1];n.push({physicalId:i,path:e.physicalId,pid:e.pid,type:e.type,name:e.name,title:e.title?e.title:e.name,kind:e.kind,elementType:e.elementType})}),t.options.resolvedBy.forEach(function(e){i.push({physicalId:e.physicalId,pid:e.pid,type:e.type,name:e.name,title:e.title?e.title:e.name})}),t.options.resolvedItems.forEach(function(e){s.push({physicalId:e.physicalId,pid:e.pid,type:e.type,name:e.name,title:e.title?e.title:e.name,kind:e.kind,elementType:e.elementType})}),t.options.contexts.forEach(function(e){o.push({physicalId:e.physicalId,pid:e.pid,type:e.type,name:e.name,title:e.title?e.title:e.name,kind:e.kind,elementType:e.elementType})});var a=t.options.id.split(","),r=a[a.length-1],l=t.options.grid.Approvals;return e.push({physicalId:r,pid:t.options.pid,serviceId:t.options.serviceId?t.options.serviceId:"3DSpace",path:t.options.id,parentId:t.options.data.issue,relationToIssue:t.options.data.relationToIssue,type:t.options.type,baseType:t.options.baseType,name:t.options.name,title:t.options.title,state:t.options.state,reportedAgainst:n,resolvedBy:i,resolvedItems:s,contexts:o,approvals:l,kind:t.options.kind,elementType:t.options.elementType}),e},[]);return this._getMenu({objects:n,isList:o.get("component").getCurrentView()===v})},_getMenu:function(t){var n=this,i=[],s=Array.isArray(t.objects)?t.objects:[];return 0===s.length?e.resolve([]):(l.start(S+" _getMenu"),t.allObjectsAreIssues=s.every(function(e){return e.baseType===g}),t.allObjectsAreNotIssues=s.every(function(e){return e.baseType!==g}),t.atLeastOneIssueIsClosed=s.some(function(e){return e.state===f}),t.atLeastOneIssueIsNotClosed=s.some(function(e){return e.state!==f}),t.allObjectsAreIssues&&1===s.length&&(t.approvals=s[0].approvals),n._getApprovalMenu(t).then(function(e){i=i.concat(e)}).then(function(){return n._getOpenWithMenu(t)}).then(function(e){o.get("isNatifEnvironnement")||(i=i.concat(e))}).then(function(){return n._getBasicMenu(t)}).then(function(e){return i=i.concat(e),l.end(S+" _getMenu"),i}))},_getApprovalMenu:function(t){var s=[];o.get("component").getTreeDocument().getSelectedNodes();if(t.allObjectsAreIssues&&1===t.objects.length){var a={type:"CheckItem",icon:"check",state:"unselected",action:{callback:function(e,s){try{var l=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:l,pd3:"SummaryViewActions",pd4:"Approvals",pd5:"Issue/"+l+"/SummaryViewActions/Approvals"}})}catch(e){}finally{var c=a.state,d={id:t.objects[0].physicalId};"selected"===c?r.issues.disableApproval({data:d,onComplete:function(e){var n=o.get("component").getTreeDocument();n.undoRegisterNodeModelUpdateEvent(),n.withTransactionUpdate(function(){n.getSelectedNodes()[0].updateOptions({validation:{activated:!1},grid:{Approvals:!1,"ds6w:validation":{activated:!1}}})}),n.registerNodeModelUpdateEvent();var s=[[t.objects[0].physicalId]],a={};a[t.objects[0].physicalId]={id:t.objects[0].physicalId,type:"Issue",modifiedAttributes:["Approvals"]},i.publish("DS/Object/update",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now())},data:{paths:s,attributes:a},version:"1.0"})},onFailure:function(e){if(UWA.is(e.error.internal)&&e.error.internal.includes("No 'modify' access on Attribute 'Waiting On' for")){var t=u.getErrorMessage("2005");u.displayErrorMessage(t,"error")}else n.displayNotification({msg:e.error.message,eventID:"error"})}}):r.issues.enableApproval({data:d,onComplete:function(e){var n=o.get("component").getTreeDocument();n.undoRegisterNodeModelUpdateEvent(),n.withTransactionUpdate(function(){n.getSelectedNodes()[0].updateOptions({validation:{activated:!0},grid:{Approvals:!0,"ds6w:validation":{activated:!0}}})}),n.registerNodeModelUpdateEvent();var s=[[t.objects[0].physicalId]],a={};a[t.objects[0].physicalId]={id:t.objects[0].physicalId,type:"Issue",modifiedAttributes:["Approvals"]},i.publish("DS/Object/update",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now())},data:{paths:s,attributes:a},version:"1.0"})},onFailure:function(e){if(UWA.is(e.error.internal)&&e.error.internal.includes("No 'modify' access on Attribute 'Waiting On' for")){var t=u.getErrorMessage("2005");u.displayErrorMessage(t,"error")}else n.displayNotification({msg:e.error.message,eventID:"error"})}})}}}};t.approvals?(a.state="selected",a.title=p.commands.approvalOn):a.title=p.commands.approvalOff,s.push(a),s.push({type:"SeparatorItem"})}return e.resolve(s)},_getBasicMenu:function(t){var n=this,i=o.get("ISU_LISTVIEW");l.start(S+" _getBasicMenu");var a=o.get("component").getTreeDocument().getSelectedNodes(),r=[],c=Array.isArray(t.objects)?t.objects:[];if(0===c.length)return r;var g=null,f=JSON.parse(h),v=f.duplicateIssues,I=new e(function(e){e()});return I=I.then(function(){return!0===t.allObjectsAreNotIssues&&1===c.length&&"Document"===c[0].type?m.getDocuments([c[0].physicalId]).then(function(e){g=e.data[0]}):e.resolve()}).then(function(){if(!0===t.allObjectsAreIssues){if(!0===t.isList){var e=o.get("component").getTreeDocument().getIssuesFromSelectedNodes(),m=e.every(function(e){return!Array.isArray(e.getChildren())||!0===e.isExpanded()}),h=e.every(function(e){return!Array.isArray(e.getChildren())||!1===e.isExpanded()}),I=e.every(function(e){return!Array.isArray(e.getChildren())});!1===I&&(!0===h||!1===m&&!1===h)&&r.push({name:"Expand",title:p.commands.expandAll,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-flow-children-eye"},data:null,action:{callback:function(){i&&w();var e=o.get("component").getTreeDocument();e.withTransactionUpdate(function(){for(var t=e.getSelectedNodes(),n=0;n<t.length;n++)t[n].options.data.isExpandMultiple=!0,t[n].expand();t.length>0&&e.getComponent().getTreeDocument().updateNodesOnExpand(t)});try{var t=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:t,pd3:"SummaryViewActions",pd4:"ExpandAll",pd5:"Issue/"+t+"/SummaryViewActions/ExpandAll"}})}catch(e){}}}}),!1===I&&(!0===m||!1===m&&!1===h)&&r.push({name:"Collapse",title:p.commands.collapseAll,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-flow-children-eye-off"},data:null,action:{callback:function(){i&&w();var e=o.get("component").getTreeDocument();e.withTransactionUpdate(function(){for(var t=e.getSelectedNodes(),n=0;n<t.length;n++)"Issue"==t[n].options.baseType?t[n].collapse():t[n].unselect()});try{var t=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:t,pd3:"SummaryViewActions",pd4:"CollapseAll",pd5:"Issue/"+t+"/SummaryViewActions/CollapseAll"}})}catch(e){}}}}),r.push({type:"SeparatorItem"})}c.length<=v&&r.push({name:"Duplicate",title:p.commands.duplicate,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-duplicate"},data:null,action:{callback:function(){i&&w(),s.getCommand("Duplicate").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"Duplicate",pd5:"Issue/"+e+"/SummaryViewActions/Duplicate"}})}catch(e){}}}}),!0===t.atLeastOneIssueIsNotClosed&&c.length<=f.maxNumberOfIssueToClose&&r.push({name:"Close",title:p.commands.close,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-status-change"},data:null,action:{callback:function(){i&&w(),s.getCommand("Close").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"MarkAsComplete",pd5:"Issue/"+e+"/SummaryViewActions/MarkAsComplete"}})}catch(e){}}}}),!0===t.atLeastOneIssueIsClosed&&r.push({name:"Reopen",title:p.commands.reopen,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-open"},data:null,action:{callback:function(){i&&w(),s.getCommand("Reopen").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"Reopen",pd5:"Issue/"+e+"/SummaryViewActions/Reopen"}})}catch(e){}}}}),r.push({name:"CollaborativeLifecycle",title:p.commands.collaborativeLifecycle,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-collaborative-lifecycle-management"},data:null,action:{callback:function(){i&&w(),s.getCommand("CollaborativeLifecycle").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"Maturity",pd5:"Issue/"+e+"/SummaryViewActions/Maturity"}})}catch(e){}}}}),r.push({type:"SeparatorItem"}),r.push({name:"Move",title:p.commands.move,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-move-to"},data:null,action:{callback:function(){i&&w(),s.getCommand("Move").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"Move",pd5:"Issue/"+e+"/SummaryViewActions/Move"}})}catch(e){}}}}),r.push({name:"Share",title:p.commands.share,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-link"},data:null,action:{callback:function(){s.getCommand("Share").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"CopyLink",pd5:"Issue/"+e+"/SummaryViewActions/CopyLink"}})}catch(e){}}}}),r.push({type:"SeparatorItem"}),1===c.length&&(r.push({name:"Attachments",title:p.commands.attachments,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-attach"},data:null,action:{callback:function(){i&&w(),s.getCommand("AttachmentManager").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"Attachements",pd5:"Issue/"+e+"/SummaryViewActions/Attachements"}})}catch(e){}}}}),r.push({name:"information",title:p.commands.information,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-info-open-in-a-new-window"},data:null,action:{callback:function(){u.viewProperties(c[0].physicalId,"3DSpace");try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"Information",pd5:"Issue/"+e+"/SummaryViewActions/Information"}})}catch(e){}}}})),o.get("isNatifEnvironnement")||r.push({name:"RelationalExplorer",title:p.commands.relationalExplorer,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-object-related"},data:null,action:{callback:function(){i&&w(),s.getCommand("RelationalExplorer").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"Relations",pd5:"Issue/"+e+"/SummaryViewActions/Relations"}})}catch(e){}}}}),r.push({name:"subscribe",title:p.actions.subscription.header,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-bell-list"},submenu:[{type:"PushItem",title:p.actions.subscription.subscribe,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-bell-add"},action:{callback:function(){s.getCommand("Subscription").begin("subscribe");try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"Subscribe",pd5:"Issue/"+e+"/SummaryViewActions/Subscribe"}})}catch(e){}}}},{type:"PushItem",title:p.actions.subscription.unsubscribe,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-bell-delete"},action:{callback:function(){s.getCommand("Subscription").begin("unSubscribe");try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"UnSubscribe",pd5:"Issue/"+e+"/SummaryViewActions/UnSubscribe"}})}catch(e){}}}},{type:"PushItem",title:p.actions.subscription.editSubscription,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-bell-pencil"},action:{callback:function(){s.getCommand("Subscription").begin("editSubscription");try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"EditSubscriptions",pd5:"Issue/"+e+"/SummaryViewActions/EditSubscriptions"}})}catch(e){}}}},{type:"PushItem",title:p.actions.subscription.mySubscriptions,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-bell"},action:{callback:function(){s.getCommand("Subscription").begin("mySubscription");try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"MySubscriptions",pd5:"Issue/"+e+"/SummaryViewActions/MySubscriptions"}})}catch(e){}}}}]}),r.push({type:"SeparatorItem"}),r.push({name:"Delete",title:p.commands.delete,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-trash"},data:null,action:{callback:function(){i&&w(),s.getCommand("Delete").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"Delete",pd5:"Issue/"+e+"/SummaryViewActions/Delete"}})}catch(e){}}}}),r.push({type:"SeparatorItem"});try{u.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryViewActions"}})}catch(e){}}else if(!0===t.allObjectsAreNotIssues){if(r.push({type:"SeparatorItem"}),1===c.length&&"Document"===c[0].type){var b={data:g,from:"summary"};(C=[]).push(a[0].options);var y={data:g,from:"summary",menu:n,selected:C};r.push({name:"Preview",title:p.commands.preview,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-eye"},data:null,action:{callback:function(){d.preview(y)}}}),r.push({type:"SeparatorItem"}),""===g.relateddata.files[0].dataelements.locker?r.push({name:"Edit",title:p.commands.edit,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-pencil"},data:null,action:{callback:function(){d.edit(b)}}}):(r.push({name:"UndoEdit",title:p.commands.undoEdit,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-undo"},data:null,action:{callback:function(){d.undoEdit(b)}}}),r.push({name:"Update",title:p.commands.update,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-upload"},data:null,action:{callback:function(){d.update(b)}}}))}if(r.push({type:"SeparatorItem"}),r.push({name:"CollaborativeLifecycle",title:p.commands.collaborativeLifecycle,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-collaborative-lifecycle-management"},data:null,action:{callback:function(){i&&w(),s.getCommand("CollaborativeLifecycle").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewContentActions",pd4:"Maturity",pd5:"Issue/"+e+"/SummaryViewContentActions/Maturity"}})}catch(e){}}}}),o.get("isNatifEnvironnement")||c.length<=2&&(r.push({name:"Compare",title:p.commands.compare,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-compare-on"},data:null,action:{callback:function(){i&&w(),s.getCommand("Compare").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewContentActions",pd4:"Compare",pd5:"Issue/"+e+"/SummaryViewContentActions/Compare"}})}catch(e){}}}}),r.push({type:"SeparatorItem"})),c.every(e=>"Document"==e.type)){for(var C=[],T=0;T<a.length;T++)C.push(a[T].options);var E={data:g,from:"summary",menu:n,selected:C};r.push({name:"Download",title:p.commands.download,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-download"},data:null,action:{callback:function(){d.download(E)}}})}o.get("isNatifEnvironnement")||(r.push({name:"RelationalExplorer",title:p.commands.relationalExplorer,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-object-related"},data:null,action:{callback:function(){i&&w(),s.getCommand("RelationalExplorer").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewContentActions",pd4:"Relations",pd5:"Issue/"+e+"/SummaryViewContentActions/Relations"}})}catch(e){}}}}),1===c.length&&r.push({name:"information",title:p.commands.information,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-properties"},data:null,action:{callback:function(){var e=c[0].physicalId;e.includes("i3dx:")&&(e=c[0].pid),u.viewProperties(e,c[0].serviceId);try{var t=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:t,pd3:"SummaryViewContentActions",pd4:"Information",pd5:"Issue/"+t+"/SummaryViewContentActions/Information"}})}catch(e){}}}})),r.push({name:"Detach",title:p.commands.detach,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove"},data:null,action:{callback:function(){i&&w(),s.getCommand("Detach").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewContentActions",pd4:"Remove",pd5:"Issue/"+e+"/SummaryViewContentActions/Remove"}})}catch(e){}}}});try{u.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryViewContentActions"}})}catch(e){}}else r=!0===t.isList?n._getListMenu():n.getKanbanMenu(),o.get("isNatifEnvironnement")||r.push({name:"RelationalExplorer",title:p.commands.relationalExplorer,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-object-related"},data:null,action:{callback:function(){i&&w(),s.getCommand("RelationalExplorer").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewContentActions",pd4:"Relations",pd5:"Issue/"+e+"/SummaryViewContentActions/Relations"}})}catch(e){}}}});return l.end(S+" _getBasicMenu"),r})},_getOpenWithMenu:function(t){try{o.get("component").getCurrentView()}catch(e){}finally{var n=[];if(0===(Array.isArray(t.objects)?t.objects:[]).length)return e.resolve([]);if(o.get("isNatifEnvironnement"))return e.resolve([]);if(!0===t.allObjectsAreIssues){var i=[],s=[],a=[],r=[];t.objects.forEach(function(e){i=i.concat(e.contexts),s=s.concat(e.reportedAgainst),a=a.concat(e.resolvedBy),r=r.concat(e.resolvedItems)});var l=[];return e.all([this._getOpenWithSubMenu({name:I.CONTEXTS,label:p.commands.open.contexts,objects:i,icon:b.CONTEXTS}),this._getOpenWithSubMenu({name:I.REPORTED_AGAINST,label:p.commands.open.reportedAgainst,objects:s,icon:b.REPORTED_AGAINST}),this._getOpenWithSubMenu({name:I.RESOLVED_BY,label:p.commands.open.resolvedBy,objects:a,icon:b.RESOLVED_BY}),this._getOpenWithSubMenu({name:I.RESOLVED_ITEMS,label:p.commands.open.resolvedItems,objects:r,icon:b.RESOLVED_ITEMS})]).then(function(e){return(l=e.reduce(function(e,t){return e.concat(t)},[])).length>0&&(n.push({name:I.OPEN,title:p.commands.open.multiple,type:"PushItem",data:null,fonticon:{content:b.OPEN},submenu:l}),n.push({type:"SeparatorItem"})),n})}return!0===t.allObjectsAreNotIssues?this._getOpenWithSubMenu({name:I.OPEN_WITH,label:p.commands.open.single,objects:t.objects,icon:b.OPEN_WITH}):e.resolve([])}},_getListMenu:function(){var e=[],t=o.get("ISU_LISTVIEW"),n=o.get("component").getTreeDocument().getIssuesFromSelectedNodes(),i=n.every(function(e){return!Array.isArray(e.getChildren())||!0===e.isExpanded()}),a=n.every(function(e){return!Array.isArray(e.getChildren())||!1===e.isExpanded()}),r=n.every(function(e){return!Array.isArray(e.getChildren())});return!1===r&&(!0===a||!1===i&&!1===a)&&e.push({name:"Expand",title:p.commands.expandAll,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-flow-children-eye"},data:null,action:{callback:function(){t&&w();var e=o.get("component").getTreeDocument();e.withTransactionUpdate(function(){for(var t=e.getSelectedNodes(),n=0;n<t.length;n++)t[n].options.data.isExpandMultiple=!0,t[n].expand();t.length>0&&e.getComponent().getTreeDocument().updateNodesOnExpand(t)})}}}),!1===r&&(!0===i||!1===i&&!1===a)&&e.push({name:"Collapse",title:p.commands.collapseAll,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-flow-children-eye-off"},data:null,action:{callback:function(){t&&w();var e=o.get("component").getTreeDocument();e.withTransactionUpdate(function(){for(var t=e.getSelectedNodes(),n=0;n<t.length;n++)"Issue"==t[n].options.baseType?t[n].collapse():t[n].unselect()})}}}),e.push({type:"SeparatorItem"}),e.push({name:"CollaborativeLifecycle",title:p.commands.collaborativeLifecycle,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-collaborative-lifecycle-management"},data:null,action:{callback:function(){t&&w(),s.getCommand("CollaborativeLifecycle").begin()}}}),e.push({type:"SeparatorItem"}),e.push({name:"Share",title:p.commands.share,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-link"},data:null,action:{callback:function(){s.getCommand("Share").begin()}}}),"SeparatorItem"===e[e.length-1].type&&e.pop(),e},getKanbanMenu:function(){var e=[];return e.push({name:"CollaborativeLifecycle",title:p.commands.collaborativeLifecycle,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-collaborative-lifecycle-management"},data:null,action:{callback:function(){listView&&w(),s.getCommand("CollaborativeLifecycle").begin()}}}),e.push({type:"SeparatorItem"}),e.push({name:"Share",title:p.commands.share,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-link"},data:null,action:{callback:function(){s.getCommand("Share").begin()}}}),e},_getOpenWithSubMenu:function(t){if(!t||!Array.isArray(t.objects)||0===t.objects.length)return e.resolve([]);var n=[],i=[],s=t.objects;return l.start(S+" _getOpenWithSubMenu"),new e(function(e){for(var d=[],u=0;u<s.length;u++){var m=s[u],p=[];p.push(m.type),m.kind&&""!=m.kind&&p.push(m.kind),d.push(m.type),i.push({envId:a.getTenant(),contextId:"ctx::VPLMProjectLeader.MyCompany.3DS Collab Space",serviceId:"3DSpace",objectId:m.pid,objectType:m.type,objectTaxonomies:p,displayName:m.title+"("+m.name+")"})}r.getTypesHierarchy({types:d,onComplete:function(a){if(UWA.is(a.types_hierarchies,"array")&&a.types_hierarchies.forEach(function(e,t){i.forEach(function(t,n){t.objectTaxonomies[0]===e.type&&(t.objectTaxonomies=t.objectTaxonomies.concat(e.hierarchy))})}),0===i.length)return l.end(S+" _getOpenWithSubMenu"),void e(n);var r=o.get("widget")||window.widget;if(i[0].objectTaxonomies.some(e=>"catia magic"===e.toLowerCase()))var d=c.getOpenWith().set3DXContent({protocol:"3DXContent",version:"1.1",source:r.name,widgetId:r.id,data:{items:i}});else d=c.getOpenWith().set3DXContent({protocol:"3DXContent",version:"1.1",source:r.name,widgetId:r.id,data:{items:i}},!0);d.retrieveCompatibleApps(function(i){if(i&&i.length>0){var a=[],r=[];if(i.forEach(function(e){r={name:e.text.replace(/ /g,""),type:"PushItem",title:e.text,action:{callback:function(t){o.get("ISU_LISTVIEW")&&w(),o.get("component").utils.setTypesCallbackForOFW(s),e.handler.call(t)}}},null!=e.fonticon?r.fonticon={content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon}:e.className&&1==e.className.contains("app-widget")?r.icon={iconPath:e.icon,className:"issue-widget"}:r.icon=e.icon,a.push(r)}),a.length>0){var c={name:t.name,type:"PushItem",fonticon:{content:t.icon},title:t.label,submenu:a};n.push(c)}}l.end(S+" _getOpenWithSubMenu"),e(n)})},onFailure:function(t){e(n)}})})}}}),define("DS/IssueManagement/components/header/Filter",["UWA/Class/View","UWA/Core","DS/UIKIT/DropdownMenu","DS/UIKIT/Iconbar","DS/WUXAutoComplete/AutoComplete","DS/Menu/Menu","DS/Controls/Button","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/TooltipModel","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataDragAndDrop/DataDragAndDrop","DS/PADUtils/views/PADAlert","DS/IssueManagement/components/ContextualMenu","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Views","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p,h,g,f,v,I,b,y,S,w,C){"use strict";var T="contextFilter",E="selectedContext",D="affectedItemSetting",_="resolvedItemSetting",A="contextSetting",M="PLMNewEnablement",N="createSetting",x="affectedItemCreateSetting",O="contextCreateSetting";return e.extend({name:"DS/IssueManagement/components/header/Filter",tagName:"div",className:"filter-container",_logger:null,elements:{bar:null,menu:null},filter:{},setup:function(e){w.start(this.name+" setup"),this._parent(e),this.elements={bar:null,menu:null},w.end(this.name+" setup")},render:function(){return this},getFilterMenu:function(){var e=JSON.parse(widget.getValue("filter")),t="",n="",i="",s="",o="",a="",r="",l="",c="";1==e.assigned&&(t="selected"),1==e.owned&&(n="selected"),1==e.reported&&(o="selected"),1==e.responsible&&(a="selected"),1==e.contributed&&(r="selected"),1==e.closed&&(l="selected"),1==e.filterbyobject&&(c="selected");var d=widget.getValue("roots");!1===Array.isArray(d)&&(d=[]),1==e.session&&d.length>0?(i="selected|enabled",s="enabled"):0==d.length?(i="disabled",s="disabled"):d.length>0&&(i="enabled",s="enabled");var u=[{type:"TitleItem",title:C.filter.session.header},{type:"CheckItem",title:d.length>0?C.replace(C.filter.session.title,{number:d.length}):C.filter.session.nothing,state:i,id:"session",action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"onClickSession"}},{type:"CheckItem",title:C.resetSession,state:s,id:"reset-session",action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"onClickResetSession"}},{type:"CheckItem",title:C.filter.owned,state:n,id:"owned",action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"onClickOwned"}},{type:"CheckItem",title:C.filter.assigned,id:"assigned",action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"onClickAssigned"},state:t},{type:"SeparatorItem"},{type:"CheckItem",title:C.filter.others.contributed,state:r,id:"contributed",action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"onClickContributed"}},{type:"SeparatorItem"},{type:"CheckItem",title:C.filter.others.closed,state:l,id:"closed",action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"onClickClosed"}},{type:"SeparatorItem"},{type:"CheckItem",title:C.filter.filterbyobject.title,state:c,id:"filterbyobject",action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"onClickFilterByObj"}}];return(widget.getPreference("organizationFilter").value||I.get("isNatifEnvironnement"))&&u.splice(5,0,{type:"CheckItem",title:C.filter.others.reported,id:"reported",action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"onClickReported"},state:o},{type:"CheckItem",title:C.filter.others.responsible,id:"responsible",action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"onClickResponsible"},state:a}),u},showContextFilter:function(){var e=this;if(I.get("actionBar"))var n=document.getElementById("filterByObjectToolbar").getParent().getParent();if(e.filterDiv&&e.filterDiv.show(),widget.setValue(T,!0),e.autoCompleteFilter)e.autoCompleteFilter.focus();else{e.filterDiv=t.createElement("div",{class:"filter-context"}),e.makeDroppable(e.filterDiv),e.modelForFilter=new m,e.modelForRecentObjects=new m,e.recentObjects=[],b.preferences.get({data:{name:"recentFilterObjects"}}).then(function(t){""!==t.body&&(e.recentObjects=t.body.map(function(e){return"string"==typeof e?{id:e}:e}))}),e.autoCompleteFilter=new s({elementsTree:function(t){return e.modelForRecentObjects.empty(),e.modelForFilter.empty(),t.length<3?e.recentObjects.length>0?new Promise(function(t,n){b.fetch({data:{objects:e.recentObjects.map(function(e){return{physicalId:e.id}})},onComplete:function(n){var i=n.body;e.modelForRecentObjects.prepareUpdate(),i.results&&i.results.length>0&&(i.results.sort((t,n)=>{var i=e.parseFetchAttributes(t),s=e.parseFetchAttributes(n);const o=i.id,a=s.id;return e.recentObjects.findIndex(e=>e.id.includes(o))-e.recentObjects.findIndex(e=>e.id.includes(a))}),i.results.forEach(function(t){var n=e.parseFetchAttributes(t);n.revision=void 0===n.revision?"":n.revision,n.identifier=void 0===n.identifier?"":" ("+n.identifier+")";var i=n.label+" "+n.revision+n.identifier,s=e.recentObjects.find(e=>e.id.includes(n.id)),o=new p({label:i,value:n.id,name:n.identifier,id:n.id,icon:n.icon,icons:["clock",t.attributes.icon],type:n.type,serviceId:s.serviceId,kind:n.kind});e.modelForRecentObjects.addRoot(o)})),e.modelForRecentObjects.pushUpdate(),t(e.modelForRecentObjects)},onFailure:function(n){t(e.modelForRecentObjects)}})}):void 0:new Promise(function(n,i){setTimeout(function(){b.getRelatedObjects({text:t}).then(function(t){e.modelForFilter.prepareUpdate();for(var i=0;i<t.length;i++)if(t[i].serviceId.toLowerCase().includes("3dspace")||t[i].id.includes("i3dx:")){t[i].identifier;t[i].revision=void 0===t[i].revision?"":t[i].revision,t[i].identifier=void 0===t[i].identifier?"":" ("+t[i].identifier+")";var s=t[i].label+" "+t[i].revision+t[i].identifier,o=new p({label:s,value:t[i].id,name:t[i].identifier,id:t[i].id,icon:t[i].icon,type:t[i].type,serviceId:t[i].serviceId,kind:t[i].kind});e.modelForFilter.addRoot(o)}e.modelForFilter.pushUpdate(),n(e.modelForFilter)},function(t){n(e.modelForFilter)})},1e3)})},placeholder:C.filter.filterbyobject.placeholder,customFilterMessage:C.filter.filterbyobject.filterMessage,multiSearchMode:!1,allowFreeInputFlag:!1,minLengthBeforeSearch:0,keepSearchResultsFlag:!1}).inject(e.filterDiv),e.autoCompleteFilter.focus();var i=I.get("actionBar");if(n.getBoundingClientRect().left-i.container.getBoundingClientRect().left<500?(e.filterDiv.inject(i.container.parentElement),e.autoCompleteFilter.getContent().setStyle("width","inherit")):n.insertBefore(e.filterDiv,n.firstChild),widget.getValue(E)){var r=new p(widget.getValue(E));e.autoCompleteFilter.selectedItems=r}e.autoCompleteFilter.addEventListener("change",function(){var t="";if(e.autoCompleteFilter.selectedItems&&(t=e.autoCompleteFilter.selectedItems.options,null==e.recentObjects.find(e=>e.id.includes(t.id)))){if(e.recentObjects.unshift(t),e.recentObjects.length>5){for(var n=[],i=0;i<5;i++)n.push(e.recentObjects[i]);e.recentObjects=n}b.preferences.set({data:{name:"recentFilterObjects",value:JSON.stringify(e.recentObjects)}}).catch(function(t){e._logger.error("Could not save the preferences: %o",t)})}widget.setValue(E,t),widget.dispatchEvent("onRefresh",["filter"]),widget.dispatchEvent("endEdit")});var l=new a({displayStyle:"lite",label:"lite displayStyle",icon:{iconName:"search",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1}).inject(e.filterDiv);l.tooltipInfos=new c({shortHelp:C.filter.filterbyobject.search}),l.getContent().addEventListener("buttonclick",function(){e.searchContext()});var d=new a({displayStyle:"lite",label:"lite displayStyle",icon:{iconName:"chevron-down",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1}).inject(e.filterDiv);d.tooltipInfos=new c({shortHelp:C.filter.filterbyobject.menu.title}),d.getContent().addEventListener("buttonclick",function(){var t=this.getBoundingClientRect(),n={position:{x:t.left-140,y:t.top+30}};e.getContextualMenu().then(function(e){o.show(e,n)})})}e.resize()},parseFetchAttributes:function(e){var n={};return e.attributes.forEach(function(e){var i=t.is(e.name,"string")?e.name.replace("ds6w:what/","").replace("ds6w:when/","").replace("ds6w:who/",""):e.name;"ds6w:type"===i&&(n.type=e.value),"ds6w:i3dx"===i&&""!=e.value&&(n.id=e.value),"resourceid"!==i||null!=n.id&&""!=n.id||(n.id=e.value),"ds6w:identifier"===i&&(n.identifier=e.value),"ds6w:label"===i&&(n.label=e.value),"ds6wg:revision"===i&&(n.revision=e.value),"type_icon_url"===i&&(n.icon=e.value),"ds6w:kind"===i&&(n.kind=e.value)}),n},hideContextFilter:function(){this.elements.pageToolbarContainer=document.getElementsByClassName("page-toolbar-view-container")[0],this.elements.dataGridView=document.getElementsByClassName("im-layout")[0],this.elements.pageToolbarContainer.removeClassName("isu-contextFilter-enabled"),this.elements.dataGridView.removeClassName("isu-contextFilter-enabled"),this.filterDiv&&this.filterDiv.hide(),this.autoCompleteFilter.selectedItems&&(this.autoCompleteFilter.selectedItems=[]),widget.setValue(T,!1)},makeDroppable:function(e){var n=this;h.droppable(e,{drop:function(i,s,o){if(o.stopPropagation&&o.stopPropagation(),o.preventDefault&&o.preventDefault(),o.dataTransfer&&o.dataTransfer.dropEffect&&(o.dataTransfer.dropEffect="copy"),t.is(i)&&""!=i){var a=JSON.parse(i).data.items;t.is(a)&&t.is(a.length)&&a.length>0&&n.dropFilterObject(a)}else g.displayNotification({msg:C.filter.filterbyobject.dropNotSupported,eventID:"error"});e.style.borderWidth="0px"},over:function(){arguments[0].setStyles({borderStyle:"solid",borderColor:"#368ec4",borderWidth:"1px"})},leave:function(){arguments[0].setStyle("borderWidth","0px")}})},dropFilterObject:function(e){var t=this;if(e.length>0)if(e[0].serviceId.toLowerCase().includes("3dspace")||e[0].hasOwnProperty("i3dx")&&""!=e[0].i3dx){var n=e[0].i3dx&&""!=e[0].i3dx?e[0].i3dx:e[0].objectId,i=e[0].serviceId;b.fetch({data:{objects:[{physicalId:n}]},onComplete:function(e){var n=e.body;if(n.results&&n.results.length>0){t.modelForFilter.prepareUpdate();var s=n.results[0],o=t.parseFetchAttributes(s);o.revision=void 0===o.revision?"":o.revision,o.identifier=void 0===o.identifier?"":" ("+o.identifier+")";var a=o.label+" "+o.revision+o.identifier,r=new p({label:a,value:o.id,name:o.identifier,id:o.id,icon:o.icon,type:o.type,kind:o.kind,serviceId:i});t.modelForFilter.addRoot(r),t.modelForFilter.pushUpdate(),t.autoCompleteFilter.selectedItems=r}else g.displayNotification({msg:C.filter.filterbyobject.dropNotSupported,eventID:"error"})},onFailure:function(e){g.displayNotification({msg:C.filter.filterbyobject.dropNotSupported,eventID:"error"})}})}else g.displayNotification({msg:C.filter.filterbyobject.dropNotSupported,eventID:"error"})},searchContext:function(){var e=this;y.search({default_search_criteria:"",precond:"",multiSel:!1,callback:function(t){var n=t[0];if(n.sourceid.toLowerCase().includes("3dspace")||n.hasOwnProperty("ds6w:i3dx_value")&&""!=n["ds6w:i3dx_value"]){e.modelForFilter.prepareUpdate(),n["ds6wg:revision"]=void 0===n["ds6wg:revision"]?"":n["ds6wg:revision"],n["ds6w:identifier"]=void 0===n["ds6w:identifier"]?"":" ("+n["ds6w:identifier"]+")";var i=n["ds6w:label"]+" "+n["ds6wg:revision"]+n["ds6w:identifier"],s=n["ds6w:i3dx_value"]&&""!=n["ds6w:i3dx_value"]?n["ds6w:i3dx_value"]:n.id,o=new p({label:i,value:n.id,name:n["ds6w:identifier"],id:s,icon:n.type_icon_url,type:n["ds6w:type_value"],kind:n["ds6w:kind"],serviceId:n.sourceid});e.modelForFilter.addRoot(o),e.modelForFilter.pushUpdate(),e.autoCompleteFilter.selectedItems=o}},cancel:function(){}})},getContextualMenu:function(){var e=this;e.isRemoveDialogOpen=!!e.isRemoveDialogOpen&&e.isRemoveDialogOpen,e.isSettingsDialogOpen=!!e.isSettingsDialogOpen&&e.isSettingsDialogOpen;var t=[];return e.getOpenWithMenu().then(function(e){t=t.concat(e)}).then(function(){return t.push({name:"Settings",title:C.filter.filterbyobject.menu.settings.title,type:"PushItem",icon:"cog",data:null,action:{callback:function(){e.createSettingsDialog()}}}),t.push({type:"SeparatorItem"}),widget.getValue(E)&&t.push({name:"Information",title:C.filter.filterbyobject.menu.information,type:"PushItem",icon:"info-open-in-a-new-window",data:null,action:{callback:function(){var e=widget.getValue(E).id;const t=widget.getValue(E).serviceId;v.viewProperties(e,t)}}}),t})},getOpenWithMenu:function(){var e=[],n=widget.getValue(E);return""===n||void 0===n?Promise.resolve([]):new Promise(function(i){w.start(name+" getOpenWithMenu");var s=[],o=[],a=[];a.push(n.type),n.kind&&""!=n.kind&&a.push(n.kind),o.push(n.type),s.push({envId:y.getTenant(),serviceId:"3DSpace",objectId:n.id,objectType:n.type,objectTaxonomies:a,displayName:n.label?n.label:n.name}),b.getTypesHierarchy({types:o,onComplete:function(n){if(t.is(n.types_hierarchies,"array")&&n.types_hierarchies.forEach(function(e,t){s.forEach(function(t,n){t.objectTaxonomies[0]===e.type&&(t.objectTaxonomies=t.objectTaxonomies.concat(e.hierarchy))})}),0===s.length)return w.end(name+" getOpenWithMenu"),void i(e);var o=I.get("widget")||window.widget;S.getOpenWith().set3DXContent({protocol:"3DXContent",version:"1.1",source:o.name,widgetId:o.id,data:{items:s}},!0).retrieveCompatibleApps(function(t){if(t&&t.length>0){var n=[],s=[];if(t.forEach(function(e){s={name:e.text.replace(/ /g,""),type:"PushItem",title:e.text,action:{callback:e.handler}},null!=e.fonticon?s.fonticon={content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon}:e.className&&1==e.className.contains("app-widget")?s.icon={iconPath:e.icon,className:"issue-widget"}:s.icon=e.icon,n.push(s)}),n.length>0){var o={name:"OpenWith",type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-open-menu-dot"},title:C.filter.filterbyobject.menu.openwith,submenu:n};e.push(o),e.push({type:"SeparatorItem"})}}i(e)}),w.end(name+" getOpenWithMenu")},onFailure:function(t){i(e)}})})},createSettingsDialog:function(){var e=this;if(!e.isSettingsDialogOpen){var n=!1,i=t.createElement("div",{class:"context-settings"}),s=t.createElement("div",{class:"filter-settings"}),o=t.createElement("div",{class:"filter-by",html:[t.createElement("span",{class:"filter-by-label",html:C.filter.filterbyobject.menu.settings.filterby}),t.createElement("div",{class:"filter-by-label wux-ui-3ds-required wux-ui-3ds"})]}),c=void 0===widget.getValue(D)||widget.getValue(D),m=void 0===widget.getValue(_)||widget.getValue(_),p=void 0===widget.getValue(A)||widget.getValue(A);c||m||p||(n=!0);var h=new l({type:"checkbox"}),g=new r({type:"checkbox",label:C.filter.filterbyobject.menu.settings.affectedItem,checkFlag:c,value:"AffectedItem"}),f=new r({type:"checkbox",label:C.filter.filterbyobject.menu.settings.resolvedItem,checkFlag:m,value:"ResolvedItem"}),v=new r({type:"checkbox",label:C.filter.filterbyobject.menu.settings.context,checkFlag:p,value:"Context"});if(h.addChild(g),h.addChild(f),h.addChild(v),o.inject(s),h.inject(s),h.addEventListener("change",function(t){0===h.value.length?e.settingsDialog.buttons.Yes.disabled=!0:e.settingsDialog.buttons.Yes.disabled=!1}),s.inject(i),!I.get(M)){var b=t.createElement("div",{class:"create-settings"});t.createElement("div",{class:"create-label",html:C.filter.filterbyobject.menu.settings.issueCreation}).inject(b);var y=!!widget.getValue(N)&&widget.getValue(N),S=!widget.getValue(x)||widget.getValue(x),w=!!widget.getValue(O)&&widget.getValue(O),T=new r({type:"switch",label:C.filter.filterbyobject.menu.settings.createSetting,checkFlag:y,value:"createSetting"});T.inject(b),T.addEventListener("change",function(e){T.checkFlag?E.show():E.hide()});var E=new l({type:"radio"});g=new r({type:"radio",label:C.filter.filterbyobject.menu.settings.affectedItem,checkFlag:S,value:"AffectedItem"}),v=new r({type:"radio",label:C.filter.filterbyobject.menu.settings.context,checkFlag:w,value:"Context"});E.addChild(g),E.addChild(v),E.inject(b),T.checkFlag?E.show():E.hide(),b.inject(i)}var P=new d({}),k=document.getElementsByClassName("issue-list")[0];P.inject(k),e.settingsDialog=new u({immersiveFrame:P,title:C.filter.filterbyobject.menu.settings.title,content:i,activeFlag:!1,modelFlag:!0,domId:"filterSettings",width:400,buttons:{No:new a({label:C.filter.filterbyobject.menu.settings.cancel,domId:"applySettingsNo",onClick:function(t){P.destroy(),e.isSettingsDialogOpen=!1}}),Yes:new a({label:C.filter.filterbyobject.menu.settings.apply,domId:"applySettingsYes",disabled:n,onClick:function(t){widget.setValue(D,h.value.includes("AffectedItem")),widget.setValue(_,h.value.includes("ResolvedItem")),widget.setValue(A,h.value.includes("Context")),I.get(M)||(widget.setValue(N,T.checkFlag),widget.setValue(x,E.value.includes("AffectedItem")),widget.setValue(O,E.value.includes("Context"))),P.destroy(),e.isSettingsDialogOpen=!1,e.autoCompleteFilter.selectedItems&&(widget.dispatchEvent("onRefresh",["filter"]),widget.dispatchEvent("endEdit"))}})}}),e.isSettingsDialogOpen=!0,e.settingsDialog.addEventListener("close",function(t){P&&P.destroy(),e.isSettingsDialogOpen=!1})}},refresh:function(){this.destroy(),this.render(),I.get("actionBar").updateFilterMenu()},resize:function(){var e,t,n=I.get("actionBar");this.elements.pageToolbarContainer=document.getElementsByClassName("page-toolbar-view-container")[0],this.elements.dataGridView=document.getElementsByClassName("im-layout")[0],null!=document.getElementById("filterByObjectToolbar")&&null!=document.getElementById("filterByObjectToolbar")&&(t=(e=document.getElementById("filterByObjectToolbar").getParent()).getParent()),null!=this.filterDiv&&null!=e&&null!=t&&widget.getValue(T)&&(e.getBoundingClientRect().left-n.container.getBoundingClientRect().left<500?null!=this.autoCompleteFilter&&(this.filterDiv.inject(n.container.parentElement),this.elements.pageToolbarContainer.addClassName("isu-contextFilter-enabled"),this.elements.dataGridView.addClassName("isu-contextFilter-enabled"),this.autoCompleteFilter.getContent().setStyle("width","inherit")):(t.insertBefore(this.filterDiv,t.firstChild),this.elements.pageToolbarContainer.removeClassName("isu-contextFilter-enabled"),this.elements.dataGridView.removeClassName("isu-contextFilter-enabled")))},destroy:function(){this.elements={bar:null,menu:null},this.container.empty()},utils:{debounce:function(e,t,n){var i;return function(){var s=this,o=arguments,a=n&&!i;clearTimeout(i),i=setTimeout(function(){i=null,n||e.apply(s,o)},t),a&&e.apply(s,o)}}}})}),define("DS/IssueManagement/components/welcomePanel/router/Router",["UWA/Class","DS/IssueManagement/components/welcomePanel/router/RouterUtils"],function(e,t){"use strict";return e.singleton({initialize:function(e,n){null!=e&&""!=e||(e="home"),null!=n&&""!=n||(n="/home");var i=[{name:e,path:n}];this._router=t.createRouter(i,{defaultRoute:e,defaultParams:{},trailingSlash:!1,useTrailingSlash:void 0,autoCleanUp:!1,strictQueryParams:!0,allowNotFound:!1},!0,!0),this._router._isReadyToNavigate=!0,t.listenToRouterStateChanges(this._router)},canNavigate:function(){return this._router._isReadyToNavigate},changeNavigationState:function(e){this._router._isReadyToNavigate=e},addRoute:function(e){this._router.add(e)},addRouteMethods:function(e,t){this._router.routerMethods||(this._router.routerMethods={}),UWA.is(t,"object")&&(this._router.routerMethods[e]=t)},start:function(e){this._router.start.apply(this._router,arguments)},navigate:function(){this._router.navigate.apply(this._router,arguments)},getRouter:function(){return this._router},setDependency:function(e,t){this._router.setDependency(e,t)},getDependency:function(e){return this._router.getDependencies()[e]}})}),define("DS/IssueManagement/export/ExportCSV",["UWA/Class/Promise","UWA/Core","DS/IssueManagement/export/Utils","DS/IssueServices/Contexts","DS/IssueComponents/utils/Utils","DS/IssueServices/utils/Performance","i18n!DS/IssueCommon/assets/nls/IssueCommon","DS/IssueServices/services/IssueServices","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a,r,l){"use strict";var c="DS/IssueManagement/export/ExportCSV",d="Issue",u=0;return{exportation:function(){let t,s=new e(e=>{t=e});o.start(c+" exportation"),n.notifications.exporting();var a=i.get("component");new Set;var r=a.getSelectedNodes().filter(function(e){return e.options.baseType===d});return this.getCSV({type:"string",roots:r}).then(e=>{var i=l.export.csv.name;1===r.length&&(i=i+r[r.length-1].options.name+"_");var s=i+(new Date).toString().split(" ").splice(1,4).join(" ")+".csv";n.download.csv(e,s,"text/csv;encoding:utf-8"),t()}),s},getCSV:function(n){var s=this;let a,l=new e(e=>{a=e});var u="string";if(n&&t.is(n.type,"string"))switch(n.type){case"string":u="string";break;case"array":u="array";break;default:u="string"}o.start(c+" exportation");var m=i.get("component"),p=m.getTreeListView().getManager().getColumns();let h=!1;m.list.getManager().getColumns().forEach(function(e){!m.attributes.includes(e.dataIndex)||p.includes(e)||e.isHidden||p.push(e),"ds6w:validation"==e.dataIndex&&(h=e.visibleFlag)});var g=[];const f=[];for(let e=0;e<p.length;e++)if(t.is(p[e].visibleFlag)&&p[e].visibleFlag&&f.push(p[e]),t.is(p[e].children))for(let n=0;n<p[e].children.length;n++)t.is(p[e].children[n].visibleFlag)&&p[e].children[n].visibleFlag&&f.push(p[e].children[n]);let v=f.filter(e=>t.is(e.isCustomColumn)&&e.isCustomColumn);v=v.map(e=>({name:e.dataIndex})),g.push(s.utils.getCSVHeader({columns:f}));var I=n&&Array.isArray(n.roots)?n.roots:m.getSelectedNodes().filter(function(e){return e.options.baseType===d});0===I.length&&(I=m.getTreeDocument().getRoots(!1));let b={};var y=new Set,S=[];I.map(e=>{if(e.options.validation.activated&&S.push(e.options.physicalId),t.is(e.options.reportedAgainst,"array")&&e.options.reportedAgainst!=[]&&e.options.reportedAgainst.map(e=>{y.add(e.objectType)}),t.is(e.options.resolvedBy,"array")&&e.options.resolvedBy!=[]&&e.options.resolvedBy.map(e=>{y.add(e.objectType)}),t.is(e.options.resolvedItems,"array")&&e.options.resolvedItems!=[]&&e.options.resolvedItems.map(e=>{y.add(e.objectType)}),t.is(e.options.contexts,"array")&&e.options.contexts!=[]&&e.options.contexts.map(e=>{y.add(e.objectType)}),v.length>0){let t=b[e.options.physicalId]={};t.attributes=[],t.physicalId=e.options.physicalId,v.forEach(e=>t.attributes.push(e))}});var w=S.reduce(function(e,t){return e.push({physicalId:t}),e},[]);return r.routes.retrieve({data:{objects:w,validationColumnVisibility:h}}).then(function(e){"validationColumnInvisible"!==e&&s.utils.updateValidationStatus(e,I),m.loadInfo_fetchV2(I).then(()=>{var e={"ds6w:type":[...y]};r.getNLSValuesPromise(e).then(e=>e=t.is(e["ds6w:type"])?e["ds6w:type"]:{}).then(e=>{r.classification.retrieve({data:{objects:b}}).then(function(t){let n=t.results,i={};n.forEach(e=>{let t=e.body;i[t.physicalId]=[];for(var n=b[t.physicalId].attributes,s=0;s<n.length;s++){var o=n[s].name,a=t[o].substring(1,t[o].length-1),r={};r.attrName=o,r.attrValue=a,i[t.physicalId].push(r)}});for(var r=0;r<I.length;r++){let t=I[r];if(i[t.options.physicalId]){for(var l=i[t.options.physicalId],d={grid:{}},m=0;m<l.length;m++){var p=l[m].attrName,h=l[m].attrValue;d.grid[p]=h}t.updateOptions(d)}g.push(s.utils.getCSVRow({node:I[r],columns:f,typeNLS:e}))}if(o.end(c+" exportation"),"array"!==u){if("string"===u){for(var v=[],y=0;y<g.length;y++){var S=g[y].join(",");v.push(S)}a(v.join("\n"))}a(g)}else a(g)})})})}),l},utils:{getCSVHeader:function(e){o.start(c+" getCSVHeader");for(var t=[],n=0;n<e.columns.length;n++)if(this.isExportable(e.columns[n])){var i=e.columns[n].text;t.push(this.escape(i))}return o.end(c+" getCSVHeader"),t},getCSVRow:function(e){o.start(c+" getCSVRow");for(var n=[],r=e.node,d=0;d<e.columns.length;d++)if(this.isExportable(e.columns[d])){var u=e.columns[d].dataIndex;switch(u){case"tree":n.push(this.escape(e.node.getLabel()));break;case"ds6w:occurrence":let o=[];var m=r.getAllDescendants();for(let e=0;e<m.length;e++){var p=m[e].options.grid["ds6w:occurrence"];p&&o.push(p)}n.push(this.escape(o.join(",")));break;case"ds6w:reportedAgainst":for(var h=r.options.reportedAgainst,g=[],f=0;f<h.length;f++){var v=h[f].title;v=(v=h[f].name&&""!=h[f].name?v+" ("+h[f].name+")":v)+" "+(e.typeNLS[h[f].type]?e.typeNLS[h[f].type]:h[f].type),v=h[f].revision?v+" "+h[f].revision:v,g.push(v)}n.push(this.escape(g.join(", ")));break;case"ds6w:resolvedBy":for(var I=r.options.resolvedBy,b=[],y=0;y<I.length;y++){v=I[y].title;v=(v=I[y].name&&""!=I[y].name?v+" ("+I[y].name+")":v)+" "+(e.typeNLS[I[y].type]?e.typeNLS[I[y].type]:I[y].type),v=I[y].revision?v+" "+I[y].revision:v,b.push(v)}n.push(this.escape(b.join(", ")));break;case"ds6w:resolvedItems":for(var S=r.options.resolvedItems,w=[],C=0;C<S.length;C++){v=S[C].title;v=(v=S[C].name&&""!=S[C].name?v+" ("+S[C].name+")":v)+" "+(e.typeNLS[S[C].type]?e.typeNLS[S[C].type]:S[C].type),v=S[C].revision?v+" "+S[C].revision:v,w.push(v)}n.push(this.escape(w.join(", ")));break;case"ds6w:contexts":for(var T=r.options.contexts,E=[],D=0;D<T.length;D++){v=T[D].title;v=(v=T[D].name&&""!=T[D].name?v+" ("+T[D].name+")":v)+" "+(e.typeNLS[T[D].type]?e.typeNLS[T[D].type]:T[D].type),v=T[D].revision?v+" "+T[D].revision:v,E.push(v)}n.push(this.escape(E.join(", ")));break;case"ds6w:assignees":for(var _=r.options.assignees,A=[],M=0;M<_.length;M++)"person"===_[M].type?A.push(_[M].fullName+" ("+_[M].user+")"):A.push(_[M].fullName);n.push(this.escape(A.join(", ")));break;case"ds6w:coOwners":for(var N=r.options.coOwners,x=[],O=0;O<N.length;O++)x.push(N[O].fullName+" ("+N[O].user+")");n.push(this.escape(x.join(", ")));break;case"ds6w:contributors":for(var P=r.options.contributors,k=[],V=0;V<P.length;V++)k.push(P[V].fullName+" ("+P[V].user+")");n.push(this.escape(k.join(", ")));break;case"ds6w:informedUsers":for(var L=r.options.informedUsers,R=[],U=0;U<L.length;U++)R.push(L[U].fullName+" ("+L[U].user+")");n.push(this.escape(R.join(", ")));break;case"ds6w:validation":n.push(this.escape(r.options.validation.toString()));break;case"ds6w:description":var F=r.options.description;n.push(this.escape(F));break;case"ds6w:created":case"ds6w:modified":case"ds6w:actualStartDate":case"ds6w:actualEndDate":var j=u.slice(5),B={};if(t.is(r.options[j],"string")&&r.options[j].length>0){B[j]=r.options[j];var W=s.getFormattedDate(B,{});n.push(this.escape(W[j]))}else n.push(this.escape(""));break;case"ds6w:estimatedStartDate":case"ds6w:estimatedEndDate":case"ds6w:resolutionDate":var z=u.slice(5),H={};if(t.is(r.options[z],"string")&&r.options[z].length>0){H[z]=r.options[z];var G=s.getFormattedDate(H,{});n.push(this.escape(G[z]))}else n.push(this.escape(""));break;case"ds6w:state":var K=a.maturity[r.options.state.toLowerCase()],q=i.get("maturityGraph");null!=q&&""!==q&&(K=q[r.options.state]),K=this.escape(K),n.push(K);break;case"ds6w:priority":K=a.priorities[r.options.priority.toLowerCase()];K=this.escape(K),n.push(K);break;case"ds6w:originator":K=r.options.originator.fullName;K=this.escape(K),n.push(K);break;case"ds6w:owner":K=r.options.owner.fullName;K=this.escape(K),n.push(K);break;case"Approvals":K=r.options.grid.Approvals;var Y=r.options.grid.Approvals?l.approvals.approvalOn:l.approvals.approvalOff;n.push(Y);break;case"Library":for(var X=r.options.libraries,J=[],Z=0;Z<X.length;Z++)J.push(X[Z]);n.push(this.escape(J.join(", ")));break;case"LibraryClasses":for(var Q=r.options.library,$=[],ee=0;ee<Q.length;ee++)$.push(Q[ee]);n.push(this.escape($.join(", ")));break;default:var te=e.columns[d].dataIndex;if(t.is(r.options.grid[te],"string")){K=r.options.grid[te];K=this.escape(K),n.push(K)}else if(t.is(r.options.grid[te])){K=r.options.grid[te];n.push(K)}else void 0===r.options.grid[te]&&n.push("")}}return o.end(c+" getCSVRow"),n},escape:function(e){return e='"'+(e=e.replace(/"/g,'""'))+'"'},isExportable:function(e){return!t.is(e.export,"object")&&!0===e.visibleFlag||!(!t.is(e.export,"object")||!0!==e.export.value||!0!==e.visibleFlag)},updateValidationStatus:function(e,n){for(var i={},s=0;s<e.results.length;s++){var o=e.results[s].body,a={};if(t.is(o.current.status,"string"))a=t.clone(o.current);else if(Array.isArray(o.history)&&o.history.length>0){var r=o.history.sort(function(e,t){var n=0;if(e.date)if(t.date){n=new Date(e.date)-new Date(t.date)}else n=1;else n=-1;return-1*n});a=t.clone(r[u])}else a={status:"notStarted",approveTo:"",decisions:[]};i[o.physicalId]={activated:!0,fetched:!0,status:a.status,approveTo:a.approveTo,decisions:a.decisions}}for(var l=0;l<n.length;l++){var c=n[l];i[c.options.physicalId]&&c.updateOptions({validation:i[c.options.physicalId]})}}}}}),define("DS/IssueManagement/export/ExportZIP",["UWA/Core","UWA/Promise","DS/Logger/Logger","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueManagement/export/ExportCSV","DS/IssueManagement/export/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/ExternalComponents/JSZip","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a,r,l,c,d){"use strict";var u="DS/IssueManagement/export/ExportZIP",m="Issue";return{exportation:function(){var n=this;l.start(u+" exportation");var i=a.get("status"),r=[],m={},p=new c;return n.getNodes().then(function(e){return r=e,o.notifications.exporting(),i.loading.start(),i.loading.update(d.export.zip.images),n.getImages({nodes:r})}).then(function(n){m=n;var i=[];return r.forEach(function(n){var s=p.folder(n.options.name),o=m[n.options.physicalId];e.is(o,"object")&&setTimeout(function(){i.push(fetch(o.url).then(function(e){return 200===e.status||0===e.status?t.resolve(e.blob()):t.reject(new Error(e))}).then(function(e){s.file(d.export.zip.primary,e)}))},10)}),t.all(i)}).then(function(){return i.loading.update(d.export.zip.documents),n.getFiles({nodes:r})}).then(function(n){var a=[];return n.forEach(function(n){var i=p.folder(n.name),s={};s[n.name+"-"+d.export.zip.primary]=0,n.response.forEach(function(o){e.is(o,"object")&&!o.errorMessage&&a.push(fetch(o.downloadUrl).then(function(e){return 200===e.status||0===e.status?t.resolve(e.blob()):t.reject(new Error(e.statusText))}).then(function(t){var a=o.fileName;if(null!==i.file(a)){var r=/(?:\.([^.]+))?$/.exec(a)[1];e.is(r,"string")||(r="");var l=a.replace(/\.[^/.]+$/,"");s[n.name+"-"+a]+=1,a=l+" ("+s[n.name+"-"+a]+")."+r}Number.isInteger(s[n.name+"-"+a])||(s[n.name+"-"+a]=0),i.file(a,t)}))})}),t.all(a).then(function(){return s.getCSV({type:"string"})}).then(function(e){i.loading.update(d.export.zip.zipping);var t=d.export.csv.name;1===r.length&&(t=t+r[r.length-1].options.name+"_");var n=t+(new Date).toString().split(" ").splice(1,4).join(" ")+".csv";return n=n.split(":").join("_"),p.file(n,"\ufeff"+e),p.generateAsync({type:"blob"}).then(function(e){i.loading.hide(d.export.zip.done);var t=document.createElement("a"),n=t.href=URL.createObjectURL(e),s=d.export.zip.name;1===r.length&&(s=s+r[r.length-1].options.name+"_"),t.setAttribute("download",s+(new Date).toString().split(" ").splice(1,4).join(" ")+".zip"),document.body.appendChild(t),t.click(),setTimeout(function(){document.body.removeChild(t),URL.revokeObjectURL(n)},0)})},function(){o.notifications.failure()})})},getNodes:function(){var e=a.get("component");return new t(function(t,n){const i=a.get("ISU_TYPE_NLS");let s=[];Array.isArray(Object.keys(i["ds6w:type"]))?s=Object.keys(i["ds6w:type"]):s.push(m);var r=e.getSelectedNodes().filter(function(e){return s.includes(e.options.type)});0===r.length?(0===(r=e.getTreeDocument().getRoots(!1)).length&&(o.notifications.nothing(),n(new Error("Nothing to export as ZIP"))),o.confirmation({title:d.export.zip.title,content:d.replace(d.export.zip.content,{number:r.length})}).then(function(e){!0===e?t(r):n(new Error("Export ZIP canceled by user"))})):t(r)})},getFiles:function(e){var n=e.nodes,s=[];return n.forEach(function(e){s.push(i.getDocumentsFrom(e.options.physicalId).then(function(t){return{response:t,name:e.options.name}}))}),t.all(s).then(function(e){var n=[];return e.forEach(function(e){var t=e.response.attachments.reduce(function(e,t){return e.push(t.id),e},[]);n.push(i.downloadDocuments(t).then(function(t){return{response:t,name:e.name}}))}),t.all(n)})},getImages:function(t){var i=t.nodes,s={};return r.images.retrieve({data:{objects:i.map(function(e){return{physicalId:e.options.physicalId}})}}).then(function(t){for(var n=0;n<t.results.length;n++){var i=t.results[n].body;e.is(i,"object")&&e.is(i.fileName,"string")&&""!==i.fileName&&e.is(i.url,"string")&&""!==i.url&&(s[i.physicalId]=i)}return s},function(e){return n.getLogger(u).error("Cannot fetch the primary images %o",e),s})}}}),define("DS/IssueManagement/components/welcomePanel/view/WelcomePanelWrapper",["DS/Core/PointerEvents","DS/Utilities/TouchUtils","DS/ENOXWelcomePanel/js/ENOXWelcomePanel","DS/IssueManagement/components/welcomePanel/router/Router","DS/IssueManagement/components/welcomePanel/view/GlobalConfig","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o){"use strict";var a=function(){};return a.prototype.init=function(e,t,i){this._applicationChannel=e;var s=[];s.push({id:"IssueManagement",text:o.welcomePanelIssueManagement,fonticon:"issue-type",className:"action-new",isNotHighlightable:!0,tooltip:o.welcomePanelIssueManagement,category:"View"}),s.push({id:"IssueTemplate",text:o.welcomePanelIssueTemplate,fonticon:"template",className:"action-new",isNotHighlightable:!0,tooltip:o.welcomePanelIssueTemplate,category:"View"});var a=[{id:"quick_access",actions:s}],r=(o.whatsNew,{appDescription:{title:o.issueManagementAppHeader,description:o.issueManagementAppIntro},collapsed:!1,notifications:[],activities:a,parentContainer:i,modelEvents:e});new n(r).render(),this._subscribeToEvents()},a.prototype._subscribeToEvents=function(){var n=this;this._applicationChannel.subscribe({event:"welcome-panel-action-selected"},function(n){if(n&&"home"===n.id?i.navigate(s.ROUTE_LANDING_PAGE):n&&n.id==s.PATH_IM_DETAILS?i.navigate(s.ROUTE_IM_DETAILS,{data:"from welcomepanel"}):n&&n.id==s.PATH_IT_DETAILS?i.navigate(s.ROUTE_IT_DETAILS,{data:"from welcomepanel"}):n&&n.id==s.PATH_WHATS_NEW_DETAILS&&i.navigate(s.PATH_WHATS_NEW_DETAILS,{data:"from welcomepanel"}),t.getTouchMode()){var o=new MouseEvent(e.POINTERDOWN,{bubbles:!1});document.dispatchEvent(o)}}),this._applicationChannel.subscribe({event:"welcome-panel-select-action"},function(e){e&&e.id===s.PATH_IM_DETAILS?(n._applicationChannel.publish({event:"topbar-show-title",data:{id:s.ROUTE_IM_DETAILS,label:o.welcomePanelIssueManagement}}),widget.setValue("IsIssueSummaryView",!0),n._applicationChannel.publish({event:"updateToolbar",data:{side:"right"}})):e&&e.id===s.PATH_IT_DETAILS&&(n._applicationChannel.publish({event:"topbar-show-title",data:{id:s.ROUTE_IT_DETAILS,label:o.welcomePanelIssueTemplate}}),widget.setValue("IsIssueSummaryView",!1),n._applicationChannel.publish({event:"updateToolbar",data:{side:"right"}}))})},a}),define("DS/IssueManagement/components/idcard/IssueIdcard",["DS/IssueManagement/components/idcard/IssueMaturity","DS/ENOXIDCard/js/IDCard","DS/ENOFloatingPanel/ENOFloatingPanel","DS/UIKIT/Input/Button","DS/IssueServices/services/IssueServices","DS/IssueComponents/utils/Utils","DS/IssueComponents/search/PeopleSearch","DS/SearchWidget/SearchWidgetConstant","DS/Controls/TooltipModel","DS/IssueServices/Contexts","DS/IssueCommon/utils/Utils","DS/PADUtils/views/PADAlert","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p,h){var g="Low",f="Medium",v="High",I="Urgent";return t.extend({fields:{responsibleOrganization:null,reportingOrganization:null},values:{responsibleOrganization:null,responsibleOrganizationTitle:null,reportingOrganization:null,reportingOrganizationTitle:null},renderView:function(){try{d.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"IDCard"}})}catch(e){}finally{this.render(),this._removeOtherTitleSections(),this._addNavigationButtons(),this._updateActionIcon(),this._subscribeViewEvents()}return this},resize:function(){var e=this.container.offsetWidth,t=this.container.getElement(".main-section").offsetWidth;this.container.hasClassName("minified")?this._checkMinifiedAttributesOverflow():this._checkAttributesOverflow(),this.container.getElement(".free-zone-1").addClassName("hidden"),this.container.getElement(".free-zone-0").addClassName("hidden"),e<420?(this.container.addClassName("no-image-placeholder"),this.container.getElement(".image-placeholder").addClassName("hidden")):(this.container.removeClassName("no-image-placeholder"),this.container.getElement(".image-placeholder").removeClassName("hidden")),null!==this.container.getElement('.attribute-columns[data-column-index="1"]')&&(t<646?this.container.getElement('.attribute-columns[data-column-index="1"]').addClassName("hidden"):this.container.getElement('.attribute-columns[data-column-index="1"]').removeClassName("hidden")),null!==this.container.getElement('.attribute-columns[data-column-index="2"]')&&(t<1e3?this.container.getElement('.attribute-columns[data-column-index="2"]').addClassName("hidden"):this.container.getElement('.attribute-columns[data-column-index="2"]').removeClassName("hidden"))},_removeOtherTitleSections:function(){this.container.getElement(".version").addClassName("hidden"),this.container.getElement(".versionModel").addClassName("hidden"),this.container.getElement(".modelVersion").addClassName("hidden"),this.container.getElement(".ngfilter").addClassName("hidden"),this.container.getElement(".configuration").addClassName("hidden")},_addNavigationButtons:function(){var e=this;let t=e.container.getElement(".title-section-buttons"),n=UWA.createElement("div",{class:"fonticon-chevron-left wux-ui-3ds",title:m.information.header.goToPrevious,events:{click:function(){e.modelEvents.publish({event:"issue-idcard-nav-prev",data:{}});try{var t=c.get("component").getCurrentView();d.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:t,pd3:"IDCard",pd4:"PreviousIssue",pd5:"Issue/"+t+"/IDCard/PreviousIssue"}})}catch(e){}}}});UWA.createElement("div",{class:"fonticon-chevron-right wux-ui-3ds",title:m.information.header.goToNext,events:{click:function(){e.modelEvents.publish({event:"issue-idcard-nav-next",data:{}});try{var t=c.get("component").getCurrentView();d.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:t,pd3:"IDCard",pd4:"NextIssue",pd5:"Issue/"+t+"/IDCard/NextIssue"}})}catch(e){}}}}).inject(t,"top"),n.inject(t,"top"),UWA.createElement("span",{class:"wux-ui-3ds-close wux-ui-3ds",title:m.information.header.close,events:{click:function(){e.modelEvents.publish({event:"issue-idcard-nav-close",data:{}});try{var t=c.get("component").getCurrentView();d.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:t,pd3:"IDCard",pd4:"Close",pd5:"Issue/"+t+"/IDCard/Close"}})}catch(e){}}}}).inject(t)},_updateActionIcon:function(){var e=this.container.getElement(".title-section-buttons").getElementsByClassName("actions-menu-icon")[0];e.removeClassName("fonticon-open-down"),e.addClassName("fonticon-menu-dot");try{d.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"IDCardActions"}})}catch(e){}},_addMaturityComponent:function(t){var n=this.container.getElements("#maturity");if(n.forEach(e=>e.empty()),UWA.is(t)){new e({bos:t,modelEvents:this.modelEvents,showRoute:!0}).buildMaturityView({targetDivs:n}).refresh()}try{d.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"IDCard"}})}catch(e){}},_subscribeViewEvents:function(){},setAttributeValue:function(e,t,n){var i=this;i.model.get("attributes").forEach(i=>{i.id==e&&(i.value=t,i.isVaries=!!UWA.is(n,"boolean")&&n)});UWA.String.escapeHTML(t);if("priority"==e){i.container.getElements("#priority").map(e=>{let n=i._priorityDiv({priority:t});e.innerHTML=n.div,e.title=n.nls})}else{let n=`#${e}`;i.container.getElements(n).map(e=>{e.innerHTML=t,e.title=t})}},displayMaturity:function(e){this._addMaturityComponent(e)},_priorityDiv:function(e){var t=e.priority,n="",i=p.priorities[t.toLowerCase()];switch(null==i&&(i=t),e.priority){case g:n="low wux-ui-3ds wux-ui-3ds-level-low";break;case f:n="medium wux-ui-3ds wux-ui-3ds-level-medium";break;case v:n="high wux-ui-3ds wux-ui-3ds-level-high";break;case I:n="urgent wux-ui-3ds wux-ui-3ds-alert "}if(""==n)var s=UWA.createElement("div",{class:"issue-list-priority",html:i});else s=UWA.createElement("div",{class:"issue-list-priority",html:[UWA.createElement("span",{class:"issue-list-priority-icon "+n}),i]});return{div:s.outerHTML,nls:i}}})}),define("DS/IssueManagement/components/welcomePanel/router/RouteConfig",["DS/IssueManagement/components/welcomePanel/router/Router","DS/IssueManagement/components/welcomePanel/view/GlobalConfig","DS/IssueCommon/utils/Utils"],function(e,t,n){return{initialize:function(){e.initialize(t.ROUTE_HOME,t.PATH_HOME),[{name:t.ROUTE_IM_DETAILS,path:"/"+t.PATH_IM_DETAILS},{name:t.ROUTE_IT_DETAILS,path:"/"+t.PATH_IT_DETAILS},{name:t.ROUTE_CREATE_IM_DETAILS,path:"/"+t.PATH_CREATE_IM_DETAILS},{name:t.ROUTE_CREATE_IT_DETAILS,path:"/"+t.PATH_CREATE_IT_DETAILS},{name:t.ROUTE_WHATS_NEW_DETAILS,path:"/"+t.PATH_WHATS_NEW_DETAILS}].forEach(t=>{e.addRoute(t)});var i={};for(var s in i[t.ROUTE_HOME]={activate:function(){var n=e.getDependency("issueApp"),i=e.getDependency("applicationChannel");i.publish({event:"information-panel-close",data:null}),widget.getValue("IsIssueSummaryView")||null==widget.getValue("IsIssueSummaryView")||null==widget.getValue("IsIssueSummaryView")?(n._initIssueManagementContent(),i.publish({event:"welcome-panel-select-action",data:{id:t.PATH_IM_DETAILS}})):(n._initIssueTemplateContent(),i.publish({event:"welcome-panel-select-action",data:{id:t.PATH_IT_DETAILS}}))},deactivate:function(){var t=e.getDependency("issueApp");widget.getValue("IsIssueSummaryView")?t.clearIssueManagement():t.clearIssueTemplate()}},i[t.ROUTE_IM_DETAILS]={activate:function(i){var s=e.getDependency("issueApp");e.getDependency("applicationChannel").publish({event:"welcome-panel-select-action",data:{id:t.PATH_IM_DETAILS}}),s._initIssueManagementContent();try{n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"MyIssues"}})}catch(e){}},deactivate:function(){e.getDependency("issueApp").clearIssueManagement()}},i[t.ROUTE_IT_DETAILS]={activate:function(){var i=e.getDependency("issueApp"),s=e.getDependency("applicationChannel");widget.getValue("isOpened")&&s.publish({event:"information-panel-close"}),s.publish({event:"welcome-panel-select-action",data:{id:t.PATH_IT_DETAILS}}),i._initIssueTemplateContent();try{n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"MyTemplates"}})}catch(e){}},deactivate:function(){e.getDependency("issueApp").clearIssueTemplate()}},i[t.ROUTE_CREATE_IM_DETAILS]={activate:function(){t.ROUTE_CREATE_IM_DETAILS;var n=e.getDependency("issueApp");e.getDependency("applicationChannel").publish({event:"welcome-panel-select-action",data:{id:t.PATH_CREATE_IM_DETAILS}}),n.openCreateIssuePanel()}},i[t.ROUTE_CREATE_IT_DETAILS]={activate:function(){t.ROUTE_CREATE_IT_DETAILS;var n=e.getDependency("issueApp");e.getDependency("applicationChannel").publish({event:"welcome-panel-select-action",data:{id:t.PATH_CREATE_IT_DETAILS}}),n.openCreateTemplatePanel()}},i[t.ROUTE_WHATS_NEW_DETAILS]={activate:function(){t.ROUTE_CREATE_IT_DETAILS;var n=e.getDependency("issueApp");e.getDependency("applicationChannel").publish({event:"welcome-panel-select-action",data:{id:t.PATH_CREATE_IT_DETAILS}}),n.openCreateTemplatePanel()}},i)i.hasOwnProperty(s)&&e.addRouteMethods(s,i[s]);publishEventSelectionAction=function(e){applicationChannel.publish({event:"welcome-panel-select-action",data:{id:t.PATH_CREATE_IT_DETAILS}})}}}}),define("DS/IssueManagement/views/datagrid/DataGrid",["UWA/Core","UWA/Class/Promise","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/DataGridView/DataGridView","DS/Controls/TooltipModel","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","DS/IssueComponents/users/Users","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/utils/DragAndDrop","DS/IssueManagement/components/ContextualMenu","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","DS/IssueServices/services/PlatformServices","DS/Controls/Button","text!DS/IssueManagement/assets/Settings.json","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueComponents/assets/nls/IssueComponents","i18n!DS/IssueCommon/assets/nls/IssueCommon","css!DS/IssueManagement/IssueManagement.css"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p,h,g,f,v,I,b){"use strict";var y="Issue",S={CREATE:1,ASSIGN:2,ACTIVE:3,REVIEW:4,CLOSED:5},w="Low",C="Medium",T="High",E="Urgent",D={LOW:1,MEDIUM:2,HIGH:3,URGENT:4},_=10,A="ds6w:",M={COMPACT:"compact",COMFORTABLE:"comfortable",COMPACT_HEIGHT:26,COMFORTABLE_HEIGHT:38},N=this;return s.extend({name:"DS/IssueManagement/views/list/TreeList",_logger:null,component:null,document:null,settings:{},_predicates:[],_ghost:null,init:function(s){var o=this;o.container=s.container,s.cellSelection="none",s.cellDragEnabledFlag=!0,s.showRowIndexFlag=!1,o.summaryview="datagrid",p.start(o.name+" init"),N=o,o._logger=n.getLogger("DS/IssueManagement/View"),o.component=s.component,o.document=null,o.datagridSettings=s.settings,o.settings=JSON.parse(f),o.settings.loadInfoFromFetch?m.add("LoadInfoFromFetch",!0):m.add("LoadInfoFromFetch",!1),o._predicates=[],s.columns.forEach(function(e){switch(e.text=o.getHeader(e.dataIndex),e.text){case"Affected Items":e.icon={iconName:"location",fontIconFamily:WUXManagedFontIcons.Font3DS};break;case"Resolved By":e.icon={iconName:"docs",fontIconFamily:WUXManagedFontIcons.Font3DS};break;case"Contexts":e.icon={iconName:"3d-object",fontIconFamily:WUXManagedFontIcons.Font3DS}}}),o.utils._originalColumns=s.columns.slice();for(var r=0;r<s.columns.length;r++)!0===s.columns[r].isIndexed&&o._predicates.push(s.columns[r].dataIndex);return o.custom_view_options={dgvHandle:null,ootb_columns:[],dgvDiv:null,settings:{url:h.get3DSpaceUrl(),securityContext:h.getSecurityContexts().securityContext,isNative:m.get("isNatifEnvironnement"),iterateRootNodesOnly:!0}},o._parent(s),o.preferences.getViewModePreference()===M.COMFORTABLE?this.layout.cellHeight=M.COMFORTABLE_HEIGHT:this.layout.cellHeight=M.COMPACT_HEIGHT,o.layout.setColumnOrGroupProperties("ContextualMenuColumn",{text:v.columns.actionsColumn,width:55,isHidden:!1,visibleFlag:!0,defaultVisibility:!0}),o.layout.columns.filter(e=>"ContextualMenuColumn"==e.dataIndex).forEach(e=>e.export={value:!1,lock:!1}),o._customizeColumnSorting(s.columns),o._customizeColumnRendering(s.columns),o.addEventListener("columnOrderChange",function(e){o.preferences.savePreferences({columns:!0})}),o.addEventListener("click",o.doOnTreeNodeClick.bind(o)),o.addEventListener("dblclick",o.doOnTreeNodeDblClick.bind(o)),o.addEventListener("keyup",function(e){if("Delete"===e.key)c.getCommand("Delete").begin();else if("ArrowUp"===e.key||"ArrowDown"===e.key||"Enter"===e.key){var t=o.getCellInfosAt(o.getActiveCellID());o.doOnTreeNodeClick(e,t)}}),o.addEventListener("touchstart",function(e){var t=e.timeStamp;o.addEventListener("touchstart",function(e,n){e.timeStamp-t<300&&o.doOnTreeNodeDblClick(e,n)})}),o.onContextualEvent=async function(e){if(e){var n=e.cellInfos;if(void 0!==n&&-1!==n.rowID&&(this.getTreeDocument().prepareBroadcastSelect(),this.getTreeDocument().pushBroadcastSelect()),-1===n.rowID&&e.collectionView){return e.collectionView.buildDefaultContextualMenu(e,{pin:!0,firstColumnsVisibility:!1,columnsManagement:!1,sizeColumnToFit:!0,filter:!0})}if(n.nodeModel){var i=m.get("component"),s=i.getTreeDocument().getSelectedNodes().filter(e=>{if(e.options.reportedAgainst.length>0&&!e.options.reportedAgainst[0].hasOwnProperty("type")||e.options.contexts.length>0&&!e.options.contexts[0].hasOwnProperty("type")||e.options.resolvedBy.length>0&&!e.options.resolvedBy[0].hasOwnProperty("type")||e.options.resolvedItems.length>0&&!e.options.resolvedItems[0].hasOwnProperty("type"))return e});return m.get("LoadInfoFromFetch")?await i.loadInfo_fetchV2(s):await i.loadInfo(s),!1===n.nodeModel.isSelected()&&(n.nodeModel.select(!0),o.document.prepareBroadcastSelect(),o.document.pushBroadcastSelect()),u.getContextualMenu(n.nodeModel)}return t.resolve()}return t.resolve()},o._registerReusableCellContent(),o.getCellTooltip=function(e){var t="";if(-1==e.rowID)return this.component.list.getCellDefaultTooltip(e);if(void 0!==e.cellView.collectionView.columns[e.columnID]&&void 0!==e.nodeModel)switch(e.cellView.collectionView.columns[e.columnID].dataIndex){case"ds6w:assignees":(t=e.nodeModel.options.assignees.reduce(function(e,t){return e+t.fullName+" ("+t.user+"), "},"")).length>0&&(t=(t=t.trim()).substring(0,t.length-1));break;case"ds6w:contributors":(t=e.nodeModel.options.contributors.reduce(function(e,t){return e+t.fullName+" ("+t.user+"), "},"")).length>0&&(t=(t=t.trim()).substring(0,t.length-1));break;case"ds6w:informedUsers":(t=e.nodeModel.options.informedUsers.reduce(function(e,t){return e+t.fullName+" ("+t.user+"), "},"")).length>0&&(t=(t=t.trim()).substring(0,t.length-1));break;case"ds6w:coOwners":(t=e.nodeModel.options.coOwners.reduce(function(e,t){return e+t.fullName+" ("+t.user+"), "},"")).length>0&&(t=(t=t.trim()).substring(0,t.length-1));break;case"ds6w:validation":t=e.nodeModel.options.validation.toString();break;default:return this.component.list.getCellDefaultTooltip(e)}return{shortHelp:t}},o.onDragOverCell=function(e,t){return e.preventDefault(),e.dataTransfer.dropEffect="copy",e.dataTransfer.effectAllowed="copy",void 0!==t&&(t.dropPosition="middle"),!0},o.onDropCell=function(e,t){e.preventDefault();var n=null,s=(n=t.nodeModel.options.baseType!==y?t.nodeModel.getParent():t.nodeModel).options.id,o=n.options.type,r=n.options.name,l=n.options.title,c=d.getDroppableData(e);if(c.hasOwnProperty("files")&&c.files instanceof FileList)d.related.uploadFilesAsAttachments.call(this,{node:n,id:s,type:o,name:r,title:l},c.files);else{if(!a.isValid3DXContent(c)||!c.data.items.length)return i.displayNotification({msg:v.dnd.notSupported,eventID:"warning"}),!1;d.related.addRelatedObjects.call(this,{node:n,id:s,type:o,name:r,title:l},c.data.items,e)}return!0},o.onDragEndCell=function(e,t){},o.onDragStartCell=function(t,n){var i=o.document.getSelectedNodes(),s=d.setDroppableData(i);o.getTreeDocument().prepareBroadcastSelect(),o.getTreeDocument().pushBroadcastSelect(),t.dataTransfer.setData(s.type,s.data);var r=n.nodeModel.options;return null!==o._ghost&&(o._ghost.destroy(),o._ghost=null),o._ghost=e.createElement("div",{class:"issue-ghost-container",html:[e.createElement("div",{class:"issue-ghost-panel",html:[e.createElement("img",{class:"issue-ghost-image",src:n.nodeModel.options.icons[n.nodeModel.options.icons.length-1]}),e.createElement("div",{class:"issue-ghost-title",html:a.getTextFromHTML(r.title)+" ("+a.getTextFromHTML(r.name)+")"})]}),e.createElement("span",{class:"issue-ghost-counter",html:i.length})]}),o._ghost.setStyle("transform","translate3d(0,0,0)"),document.body.appendChild(o._ghost),t.dataTransfer.setDragImage(o._ghost,t.offsetX,t.offsetY),!0},p.end(o.name+" init"),o},load:function(e){var t=this;return p.start(t.name+" load"),null!=e&&(t.document=e),t.getCustomViewsManager().onCustomViewsSave=function(e,n){r.applyCustomAttributes(e,n,t.custom_view_options)},t.sortModel=[{dataIndex:"ds6w:created",sort:"desc"}],a.setColumnFilteringOnAllColumns(t),p.end(t.name+" load"),t},restoreCustomView:function(){r.buildCustomViewOptions(this,this.container),r.registerCustomEventsOnDGV(this),r.restoreCustomViews(this)},getManager:function(){return N.component.list},getColumns:function(){return N.component.list.columns},destroy:function(){this.utils._debounceTimeouts.forEach(function(e){clearTimeout(e)}),this.utils._debounceTimeouts=[],this._parent()},doOnTreeNodeClick:function(e,t){if(e&&void 0!==t){this.getTreeDocument().prepareBroadcastSelect(),this.getTreeDocument().pushBroadcastSelect();var n=e.dsModel.layout.getDataIndexFromColumnIndex(t.columnID);"ds6w:revision"==n&&"Issue"!=t.nodeModel.options.type&&""!=t.nodeModel.options.revision&&"-"!=t.nodeModel.options.revision&&this.actionOnClick(t),"ds6w:state"==n&&-1!=t.rowID&&this.launchMaturityPopup(t)}},launchMaturityPopup:function(){var e=this;require(["DS/IssueComponents/external/CollaborativeLifecycle"],function(t){for(var n=[],i=e.document.getSelectedNodes(),s=0;s<i.length;s++)n.push(i[s].options.id);t.execute(n)})},actionOnClick:function(t){t?a.showRevisionModal(t):e.log("Issue management Version Explorer : Invalid type...")},doOnTreeNodeDblClick:function(e,t){e&&void 0!==t&&-1!=t.rowID&&(widget.setValue("fromDataGridDoubleClick",!0),widget.setValue("contentFacet",!1),c.getCommand("ToggleInformationPanel")&&c.getCommand("ToggleInformationPanel").begin({save:!0}))},modifyColumnRendering:function(n){var i=this;return new t(function(t){setTimeout(function(){p.start(i.name+" modifyColumnRendering");var s=e.is(n,"string")?JSON.parse(n):n,o=i.getColumnOrGroup(s.dataIndex);if(void 0!==o){var a=o.text;if(s.headerName&&s.headerName!==a&&(o.text=s.headerName,!0),o.isHidden=!0===o.isHidden,void 0!==s.isHidden&&s.isHidden!==o.isHidden&&(o.isHidden?(N.component.list.layout.setColumnVisibleFlag(o.dataIndex,!0),o.isHidden=!1):(N.component.list.layout.setColumnVisibleFlag(o.dataIndex,!1),o.isHidden=!0)),s.column_color){o.styles=s.column_color,o.styles||(o.styles={}),o.styles.color=s.column_color.color.replace(";",""),o.styles["background-color"]=s.column_color["background-color"].replace(";","");try{i.rendering.updateColumnStyles(o.dataIndex,o.styles)}catch(e){N._logger.warn("Could not set the column styles because %",e)}}}p.end(i.name+" modifyColumnRendering"),t()},0)})},resetColumnRendering:function(){var e=this;p.start(e.name+" resetColumnRendering"),require(["text!DS/IssueManagement/assets/IssueManagement.dataGrid.json"],function(t){var n=JSON.parse(t),i=n.columns;e.component.list.getColumns().forEach(function(t){if("ContextualMenuColumn"==t.dataIndex)t.isHidden=!1,t.visibleFlag=!0,t.defaultVisibility=!0;else{var n=1==t.defaultVisibility;t.isHidden=!n}e.component.list.layout.setColumnVisibleFlag(t.dataIndex,n)}),i.forEach(function(t){t.text=e.getHeader(t.dataIndex)}),n.specificColumns.forEach(function(e){i.splice(e.colIndex,0,{width:e.width,maxWidth:e.maxWidth,minWidth:e.minWidth,dataIndex:e.dataIndex,isDraggable:e.isDraggable,isHidden:e.isHidden})}),e._customizeColumnSorting(i),e._customizeColumnRendering(i),p.end(e.name+" resetColumnRendering")})},getHeader:function(e){var t=m.get("widget")||window.widget,n=this.datagridSettings.list.columns;return n&&n.default&&n.default[e]?v.columns[n.default[e]]:n&&n.custom&&n.custom[e]?n.custom[e][t.lang]:e},getTreeDocument:function(){return this.document},getPredicates:function(){return this._predicates},_customizeColumnRendering:function(e){var t=this;e.forEach(function(e){e.dataIndex.replace(A,"");switch(!0===e.isHidden?e.visibleFlag=!1:e.visibleFlag=!0,e.dataIndex){case"ds6w:biColor":e.onCellRequest=t.rendering.biColor;break;case"ds6w:state":e.getCellClassName=t.styling.state;break;case"ds6w:assignees":e.onCellRequest=t.rendering.assignees;break;case"ds6w:priority":e.onCellRequest=t.rendering.priority;break;case"ds6w:contributors":e.onCellRequest=t.rendering.contributors;break;case"ds6w:informedUsers":e.onCellRequest=t.rendering.informedUsers;break;case"ds6w:originator":e.onCellRequest=t.rendering.originator;break;case"ds6w:validation":e.onCellRequest=t.rendering.validation;break;case"ds6w:owner":e.onCellRequest=t.rendering.owner;break;case"ds6w:coOwners":e.onCellRequest=t.rendering.coOwners;break;case"ds6w:reportedAgainst":e.onCellRequest=t.rendering.isReportedAgainstPresent;break;case"ds6w:resolvedBy":e.onCellRequest=t.rendering.isResolvedByPresent;break;case"ds6w:contexts":e.onCellRequest=t.rendering.isContextsPresent;break;case"ds6w:isLastRevision":e.onCellRequest=t.rendering.isLastRevision;break;case"ds6w:revision":e.getCellValue=t.rendering.revision;break;case"ds6w:resolutionDate":e.onCellRequest=t.rendering.date;break;default:if(e.isCustomColumn){var n={that:t,attr:{name:e.dataIndex}};e.getCellValue=t.rendering.classificationAttributes.bind(n)}}})},_customizeColumnSorting:function(e){var t=this;e.forEach(function(e){var n=e.dataIndex.replace(A,"");switch(e.dataIndex){case"tree":e.compareFunction=t.sorting.title;break;case"ds6w:name":e.compareFunction=t.sorting.name(!1);break;case"ds6w:description":e.compareFunction=t.sorting.description(!1);break;case"ds6w:created":case"ds6w:modified":case"ds6w:estimatedStartDate":case"ds6w:estimatedEndDate":case"ds6w:actualStartDate":case"ds6w:actualEndDate":case"ds6w:resolutionDate":break;case"ds6w:priority":case"ds6w:state":e.compareFunction=t.sorting.enumeration(n);break;case"ds6w:validation":e.compareFunction=t.sorting.validation(n);break;case"ds6w:assignees":e.compareFunction=t.sorting.assignees;break;case"ds6w:contributors":e.compareFunction=t.sorting.contributors;break;case"ds6w:informedUsers":e.compareFunction=t.sorting.informedUsers;break;case"ds6w:originator":e.compareFunction=t.sorting.originator;break;case"ds6w:owner":e.compareFunction=t.sorting.owner;break;case"ds6w:coOwners":e.compareFunction=t.sorting.coOwners;break;default:!0===e.custom&&(e.compareFunction=t.sorting.custom(n))}})},_registerReusableCellContent:function(){this.registerReusableCellContent({id:"biColorCell",buildContent:function(){return e.createElement("div",{class:"bi-color-cell"})}}),this.registerReusableCellContent({id:"validationloading",buildContent:function(){return e.createElement("div",{class:"container-loading-ring-cell",html:e.createElement("div",{class:"loading-ring-cell",html:"<div></div><div></div><div></div><div></div>"})})}}),this.registerReusableCellContent({id:"validation",buildContent:function(){return e.createElement("div",{class:"container-validation-none-cell",html:e.createElement("span",{class:""})})}}),this.registerReusableCellContent({id:"validationactive",buildContent:function(){return e.createElement("div",{class:"container-validation-active-cell",html:e.createElement("span",{class:"fonticon fonticon-route-start"})})}}),this.registerReusableCellContent({id:"dummy",buildContent:function(){return e.createElement("div",{class:"dummy-container"})}})},rendering:{biColor:function(e){!1===e.manager.getColumnOptions("biColor").isHidden&&(e.isHeader||(e.cellView.reuseCellContent("biColorCell").style["background-color"]=e.nodeModel.options.grid.biColor))},revision:function(e){if(e.nodeModel)return{label:e.nodeModel.options.revision}},classificationAttributes:function(t){if(-1===t.rowID||t.nodeModel.options.baseType!=y)return;let n=t.nodeModel.options.grid[this.attr.name];if(void 0!==n)return e.is(n,"string")&&(n=n.replaceAll("",", ")),n;this.that.getTreeDocument().autoFill.classificationAttributes(t.nodeModel.options.physicalId,this.attr.name)},validation:function(t){if(-1!==t.rowID){p.start(N.name+" rendering validation");var n=t.nodeModel.options.validation;if(!0!==n.activated)t.cellView.reuseCellContent("validation");else{var i=e.createElement("div",{class:"validation-cell-container"});if(!0===n.fetched){var s=null;switch(n.status){case"inProgress":i.append(e.createElement("div",{class:"im-routes-cell-status",html:e.createElement("div",{class:"fonticon fonticon-clock in-progress"})}));break;case"approved":s=e.createElement("div",{class:"fonticon fonticon-check approved"});case"rejected":s=s||e.createElement("div",{class:"fonticon fonticon-wrong rejected"}),i.append(e.createElement("div",{class:"im-routes-cell-status",html:s}));break;case"notStarted":return void t.cellView.reuseCellContent("validationactive")}for(var a=t.nodeModel.options.validation.decisions,r=[],c=0;c<a.length;c++){var d=a[c].reviewer;n.status===a[c].status&&r.push(d)}i.append(l.create({users:r})),t.cellView.setReusableContent(i);let u=t.nodeModel.options.validation.toString();i.tooltipInfos=new o({shortHelp:u,mouseRelativePosition:!1,position:"bottom"})}else t.cellView.reuseCellContent("validationloading"),this.getTreeDocument().autoFill.validation(t.nodeModel.options.physicalId)}p.end(N.name+" rendering validation")}},owner:function(t){if(p.start(N.name+" rendering owner"),-1!==t.rowID){var n=t.nodeModel.options,i=(n.owner.fullName,h.get3DSwymUrl()),s=l.create({users:[n.owner]}).addClassName("issue-owner-container");if(i)(a=new g({domId:"hyperlinkButton",displayStyle:"lite",label:n.owner.fullName})).addEventListener("click",function(){h.getUserProfile(n.owner.user)});else var a=e.createElement("span",{class:"userName issue-user-image issue-owner-full-name",html:n.owner.fullName});a.inject(s),t.cellView.setReusableContent(s);let r="";n.owner.fullName&&n.owner.user&&(r=n.owner.fullName+" ("+n.owner.user+")"),s.tooltipInfos=new o({shortHelp:r,mouseRelativePosition:!1,position:"bottom"})}p.end(N.name+" rendering owner")},originator:function(t){p.start(N.name+" rendering originator");var n=h.get3DSwymUrl();if(-1!==t.rowID){var i=t.nodeModel.options,s=l.create({users:[i.originator]}).addClassName("issue-owner-container");if(n)(a=new g({domId:"hyperlinkButton",displayStyle:"lite",label:i.originator.fullName})).addEventListener("click",function(){h.getUserProfile(i.originator.user)});else var a=e.createElement("span",{class:"userName issue-user-image issue-owner-full-name",html:i.originator.fullName});a.inject(s),t.cellView.setReusableContent(s);let r="";i.originator.fullName&&i.originator.user&&(r=i.originator.fullName+" ("+i.originator.user+")"),s.tooltipInfos=new o({shortHelp:r,mouseRelativePosition:!1,position:"bottom"})}p.end(N.name+" rendering originator")},priority:function(t){if(-1!==t.rowID){var n=N.component.list.reuseCellContent("dummy");if(t.nodeModel.options.baseType===y){var i=t.nodeModel.options.priority,s="",o="",a=b.priorities[i.toLowerCase()];switch(null==a&&(a=i),i){case w:o="low wux-ui-3ds wux-ui-3ds-level-low";break;case C:o="medium wux-ui-3ds wux-ui-3ds-level-medium";break;case T:o="high wux-ui-3ds wux-ui-3ds-level-high";break;case E:o="urgent wux-ui-3ds wux-ui-3ds-alert "}s=""==o?e.createElement("div",{class:"issue-list-priority",html:a}):e.createElement("div",{class:"issue-list-priority",html:[e.createElement("span",{class:"issue-list-priority-icon "+o}),a]}),t.cellView.setReusableContent(s)}else t.cellView.setReusableContent(n)}},assignees:function(e){if(p.start(N.name+" rendering assignees"),-1!==e.rowID){var t=N.component.list.reuseCellContent("dummy"),n=e.nodeModel.options;if(n.assignees&&n.assignees.length){var i=n.assignees.map(function(e){return e}),s=l.create({users:i});e.cellView.setReusableContent(s);let t="";i.forEach(e=>{""!=t&&(t+=", "),"person"===e.type?t+=e.fullName+" ("+e.user+")":t+=e.fullName}),s.tooltipInfos=new o({shortHelp:t,mouseRelativePosition:!1,position:"bottom"})}else e.cellView.setReusableContent(t)}p.end(N.name+" rendering assignees")},contributors:function(e){if(p.start(N.name+" rendering contributors"),-1!==e.rowID){var t=N.component.list.reuseCellContent("dummy"),n=e.nodeModel.options;if(n.contributors&&n.contributors.length){var i=n.contributors.map(function(e){return e}),s=l.create({users:i});e.cellView.setReusableContent(s);let t="";i.forEach(e=>{""!=t&&(t+=", "),t+=e.fullName+" ("+e.user+")"}),s.tooltipInfos=new o({shortHelp:t,mouseRelativePosition:!1,position:"bottom"})}else e.cellView.setReusableContent(t)}p.end(N.name+" rendering contributors")},informedUsers:function(e){if(p.start(N.name+" rendering informedUsers"),-1!==e.rowID){var t=N.component.list.reuseCellContent("dummy"),n=e.nodeModel.options;if(n.informedUsers&&n.informedUsers.length){var i=n.informedUsers.map(function(e){return e}),s=l.create({users:i});e.cellView.setReusableContent(s);let t="";i.forEach(e=>{""!=t&&(t+=", "),"person"===e.type?t+=e.fullName+" ("+e.user+")":t+=e.fullName}),s.tooltipInfos=new o({shortHelp:t,mouseRelativePosition:!1,position:"bottom"})}else e.cellView.setReusableContent(t)}p.end(N.name+" rendering informedUsers")},coOwners:function(e){if(p.start(N.name+" rendering coOwners"),-1!==e.rowID){var t=N.component.list.reuseCellContent("dummy"),n=e.nodeModel.options;if(n.coOwners&&n.coOwners.length){var i=n.coOwners.map(function(e){return e}),s=l.create({users:i});e.cellView.setReusableContent(s);let t="";i.forEach(e=>{""!=t&&(t+=", "),t+=e.fullName+" ("+e.user+")"}),s.tooltipInfos=new o({shortHelp:t,mouseRelativePosition:!1,position:"bottom"})}else e.cellView.setReusableContent(t)}p.end(N.name+" rendering coOwners")},array:function(t){return function(n){if(p.start(N.name+" rendering array"),n.nodeModel.options.baseType===y){var i=n.nodeModel.options[t];if(!0===(t in n.nodeModel.options&&i.length>0))if(i.length<_)n.cellView.reuseCellContent("arrayLengthIs"+i.length);else{var s=e.createElement("div",{class:"issue-list-cell-related",html:v.replace(v.list.hasRelated,{number:i.length})});n.cellView.getContent().setContent(s)}else n.cellView.reuseCellContent("arrayLengthEmpty")}p.end(N.name+" rendering array")}},isContextsPresent:function(t){p.start(N.name+" rendering isContextsPresent");var n=N.component.list.reuseCellContent("dummy");if(t.nodeModel.options.baseType===y){var i=t.nodeModel.options.contexts,s=e.createElement("div",{class:"is-context-present"});this.rendering.contentWithHyperlink(i).inject(s),t.cellView.setReusableContent(s)}else t.cellView.setReusableContent(n);p.end(N.name+" rendering isContextsPresent")},isResolvedByPresent:function(t){p.start(N.name+" rendering isResolvedByPresent");var n=N.component.list.reuseCellContent("dummy");if(t.nodeModel.options.baseType===y){var i=t.nodeModel.options.resolvedBy,s=e.createElement("div",{class:"is-resolvedBy-present"});this.rendering.contentWithHyperlink(i).inject(s),t.cellView.setReusableContent(s)}else t.cellView.setReusableContent(n);p.end(N.name+" rendering isResolvedByPresent")},isReportedAgainstPresent:function(t){p.start(N.name+" rendering isReportedAgainstPresent");var n=N.component.list.reuseCellContent("dummy");if(t.nodeModel.options.baseType===y){var i=t.nodeModel.options.reportedAgainst,s=e.createElement("div",{class:"is-resolvedBy-present"});this.rendering.contentWithHyperlink(i).inject(s),t.cellView.setReusableContent(s)}else t.cellView.setReusableContent(n);p.end(N.name+" rendering isReportedAgainstPresent")},isLastRevision:function(t){p.start(N.name+" rendering isLastRevision");var n="";let i;"Issue"!=t.nodeModel.options.type&&""!=t.nodeModel.options.revision&&null!=t.nodeModel.options.revision?""===t.nodeModel.options.isLastRevision?(n=e.createElement("div",{}),i="",t.cellView.setReusableContent(n)):1==t.nodeModel.options.isLastRevision?(n=e.createElement("div",{class:"isLastRevisionTrue wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check"}),i=I.resolveIssues.tooltips.isLastRevision,t.cellView.setReusableContent(n)):0==t.nodeModel.options.isLastRevision&&(n=e.createElement("div",{class:"isLastRevisionFalse wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong"}),i=I.resolveIssues.tooltips.isNotLastRevision,t.cellView.setReusableContent(n)):(n=e.createElement("div",{}),i="",t.cellView.setReusableContent(n)),n.tooltipInfos=new o({shortHelp:i,mouseRelativePosition:!1,position:"bottom"}),p.end(N.name+" rendering isLastRevision")},date:function(t){var n="";if(""!=t.nodeModel.options.resolutionDate){var i=m.get("widget")||window.widget,s=parseInt(i.getValue("approaching"),10),o="",a=new Date;a.setHours(0,0,0,0);var r=new Date(t.nodeModel.options.resolutionDate);r.setHours(0,0,0,0),o=""===(o=Math.ceil(Math.abs(r-a)/864e5)<=s&&r>a?"approaching":"")&&r<=a?"overdue":o;var l=r.toLocaleString("default",{month:"short"})+" "+r.getDate()+", "+r.getFullYear();n=e.is(o,"string")&&""!==o?e.createElement("div",{class:"target-approaching-overdue",html:[{class:"approaching"===o?"fonticon fonticon-clock":"fonticon fonticon-attention"},{html:l}]}):e.createElement("div",{class:"target-approaching-overdue",html:l})}t.cellView.setReusableContent(n)},updateColumnStyles:function(t,n){var i={};void 0!==n.color&&(i.color=n.color+";"),void 0!==n["background-color"]&&(i["background-color"]=n["background-color"]+";");var s=[],o=document.styleSheets[0];o.cssRules?s=o.cssRules:o.rules&&(s=o.rules);var a='.issue-list-container .wux-datagrid-cell[data-index="'+t+'"]:not(.wux-datagrid-header)',r=this._getBrowserSelector(a),l=function(e,t,n){for(var i=e.length;--i;){var s=e[i];if(n(t,s))return{item:s,index:i}}return null}(s,r,function(e,t){return t.selectorText===e});null!==l&&o.deleteRule(l.index);var c="{}";e.is(n,"object")&&(c=(c=(c=JSON.stringify(i)).replace(/"/g,"")).replace(/,/g,"")),"{}"!==c&&o.insertRule(r+c,s.length)},_getBrowserSelector:function(e){var t=document.styleSheets,n=t[t.length-1],i=-1,s=null;try{i=n.insertRule(e+"{}",n.cssRules.length),s=(n.cssRules||n.rules)[i].selectorText}finally{i>=0&&n.deleteRule(i)}return s},contentWithHyperlink:function(e){var t=new g({domId:"hyperlinkButton",displayStyle:"lite",label:e.length,class:"iss-hyperlink-buttons"});return t.addEventListener("click",function(){widget.setValue("fromDataGridDoubleClick",!0),widget.setValue("contentFacet",!0),c.getCommand("ToggleInformationPanel")&&c.getCommand("ToggleInformationPanel").begin({save:!0})}),t}},styling:{state:function(e){var t=!1;if(e.nodeModel){var n,i="";return"Issue"!=e.nodeModel.options.baseType||e.nodeModel.options.state.includes("Issue.")?(i=e.nodeModel.options.state,t=!1):(i="Issue."+e.nodeModel.options.state,t=!0),i&&(n=this.styling.getAndCreateMaturityClass(i,"wux-controls-label",t)+" ISU-Maturity"),n}},getAndCreateMaturityClass:function(e,t,n){let i="lc-status-"+this.cleanStatusForCSS(e)+(t?"-withClass":"");return n&&(i=i+" "+(e=e.replace("Issue.",""))),i},cleanStatusForCSS:function(e){return e.replace(/(\.| )/g,"-")}},sorting:{custom:function(e){return function(e,t,n,i,s){var o=!(s in n.options.custom)||null===n.options.custom[s],a=!(s in i.options.custom)||null===i.options.custom[s];if(o||a)return o&&!a?-1:!o&&a?1:0;var r=n.options.custom[s],l=i.options.custom[s];return isNaN(r)||isNaN(l)?r>l?1:r<l?-1:0:(r=parseFloat(r))>(l=parseFloat(l))?1:r<l?-1:0}},title:function(e,t,n,i,s){return n.options.baseType!==y||i.options.baseType,n.options.label<i.options.label?-1:n.options.label>i.options.label?1:0},name:function(e){return function(t,n,i,s,o){return i.options.name<s.options.name?e?1:-1:i.options.name>s.options.name?e?-1:1:0}},description:function(e){return function(t,n,i,s,o){var r=a.getTextFromHTML(i.options.description),l=a.getTextFromHTML(s.options.description);return r<l?e?1:-1:r>l?e?-1:1:0}},array:function(e){return function(e,t,n,i,s){return n.options[s].length-i.options[s].length}},date:function(e){return function(e,t,n,i,s){if(n.options[s]&&i.options[s]){var o=n.options[s]<i.options[s]?-1:1;try{var a=new Date(n.options[s]),r=new Date(i.options[s]);o=a>r?1:a<r?-1:0}catch(e){}return o}return!n.options[s]&&i.options[s]?-1:!i.options[s]&&n.options[s]?1:0}},enumeration:function(e){var t={};switch(e){case"state":t=S;break;case"priority":t=D;break;default:t=S}return function(e,n,i,s,o){var a=0;o=o.replace("ds6w:","");try{o in i.options&&o in s.options&&(e=i.options[o].toUpperCase(),n=s.options[o].toUpperCase(),a=t[e]-t[n])}catch(e){}return a}},validation:function(){return function(e,t,n,i,s){return n.options.validation.status<i.options.validation.status?-1:n.options.validation.status>i.options.validation.status?1:0}},assignees:function(e,t,n,i,s){var o=0;if("assignees"in n.options&&"assignees"in i.options){var a=n.options.assignees,r=i.options.assignees;o=a.length>=r.length?1:-1}return o},contributors:function(e,t,n,i,s){var o=0;if("contributors"in n.options&&"contributors"in i.options){var a=n.options.contributors,r=i.options.contributors;o=a.length>=r.length?1:-1}return o},informedUsers:function(e,t,n,i,s){var o=0;if("informedUsers"in n.options&&"informedUsers"in i.options){var a=n.options.informedUsers,r=i.options.informedUsers;o=a.length>=r.length?1:-1}return o},originator:function(e,t,n,i,s){return n.options.originator.lastName<i.options.originator.lastName?-1:n.options.originator.lastName>i.options.originator.lastName?1:0},owner:function(e,t,n,i,s){return n.options.owner.lastName<i.options.owner.lastName?-1:n.options.owner.lastName>i.options.owner.lastName?1:0},coOwners:function(e,t,n,i,s){var o=0;if("coOwners"in n.options&&"coOwners"in i.options){var a=n.options.coOwners,r=i.options.coOwners;o=a.length>=r.length?1:-1}return o}},preferences:{savePreferences:function(t){var n=m.get("widget")||window.widget,i=m.get("component").getTreeListView(),s=[];if(s=(i.layout._balancedColumnTree,i.layout._balancedColumnTree.slice()),!0===t.sort&&s.forEach(function(e){var t=manager.getColumnIDFromDataIndex(e.dataIndex);"none"!==manager.getColumnOrderState(t)&&n.setValue("IssueManagementTableSorting",JSON.stringify({columnID:t,order:manager.getColumnOrderState(t)}))}),!0===t.columns){var o=[];s.forEach(function(t){o.push({dataIndex:t.dataIndex,text:t.text,originalText:N.getHeader(t.dataIndex),export:t.export,width:t.width,visibleFlag:t.visibleFlag,isHidden:!0===t.isHidden,styles:t.styles?t.styles:{},isCustomColumn:!!e.is(t.isCustomColumn)&&t.isCustomColumn})}),n.setValue("IssueManagementTableDefinition",JSON.stringify(o))}t.hasOwnProperty("view")&&n.setValue("IssueManagementTableView",t.view)},resetPreferences:function(e){var t=m.get("widget")||window.widget;!0===e.sort&&t.setValue("IssueManagementTableSorting",""),!0===e.columns&&t.setValue("IssueManagementTableDefinition",null)},loadSortPreference:function(){var e=m.get("widget")||window.widget;p.start(N.name+" preferences loadSortPreference");var t=e.getValue("IssueManagementTableSorting");try{var n=JSON.parse(t);if(!Number.isInteger(n.columnID)||!n.order)throw new Error("The sort preference has an incorrect format");this.sort()}catch(t){e.setValue("IssueManagementTableSorting",null)}p.end(N.name+" preferences loadSortPreference")},getColumnsPreference:function(e){var t=m.get("widget")||window.widget;let n=m.get("CUSTOM_ATTR_INFOS");p.start(N.name+" preferences getColumnsPreference");var i=[];try{if((i=JSON.parse(t.getValue("IssueManagementTableDefinition"))).forEach(e=>{if("Attribute"==e.isCustom){let t=n.find(t=>t.selectable==e.dataIndex);e.text=t.nlsName}}),!Array.isArray(i))throw new Error("The columns preference has an incorrect format")}catch(e){t.setValue("IssueManagementTableDefinition",null),i=[]}for(var s=e.slice(0),o=i.slice(0),a=s.reduce(function(e,t){return e[t.dataIndex]=t,e},{}),r=o.reduce(function(e,t){return e[t.dataIndex]=t,e},{}),l=[],c=Math.max(s.length,o.length),d=0;d<c;d++){var u=o[d],h=void 0;if(void 0===(h=void 0===u||u.isCustomColumn||"ContextualMenuColumn"===u.dataIndex?u:a[u.dataIndex]));else{h.width=u.width,h.isHidden=u.isHidden,h.text!==u.originalText&&(u.originalText===u.text||(h.text=u.text)),h.styles=u.styles?u.styles:{};try{N.rendering.updateColumnStyles(u.dataIndex,h.styles)}catch(e){N._logger.warn("Could not set the column styles because %",e)}l.push(h)}}for(var g=0;g<s.length;g++){void 0===r[s[g].dataIndex]&&l.splice(g,0,s[g])}return p.end(N.name+" preferences getColumnsPreference"),l},getViewModePreference:function(){var e=m.get("widget")||window.widget;p.start(N.name+" preferences getViewModePreference");var t=M.COMPACT;try{if((t=e.getValue("IssueManagementTableView"))!==M.COMPACT&&t!==M.COMFORTABLE)throw new Error("The columns preference has an incorrect format")}catch(n){e.setValue("IssueManagementTableView",t),t=M.COMPACT,N.component.utils.isTouchDevice()&&(t=M.COMFORTABLE)}return N.component.utils.isTouchDevice()&&(t=M.COMFORTABLE),p.end(N.name+" preferences getViewModePreference"),t}},getRoots:function(){return this.document.getRoots()},resize:function(){let e=m.get("component");if(e){let t=e.list.getTreeDocument().getSelectedNodes();t[0]&&this.ensureNodeModelVisible(t[0])}},utils:{whereToAddModal:null,_originalColumns:[],_debounceTimeouts:[],getOriginalColumns:function(){return this._originalColumns},debounce:function(e,t,n){var i,s=this;return function(){var o=this,a=arguments,r=n&&!i;clearTimeout(i);var l=s._debounceTimeouts.indexOf(i);-1!==l&&s._debounceTimeouts.splice(l,1),i=setTimeout(function(){i=null,n||e.apply(o,a)},t),s._debounceTimeouts.push(i),r&&e.apply(o,a)}}}})}),define("DS/IssueManagement/components/welcomePanel/view/TriptchWrapper",["DS/ENOXTriptych/js/ENOXTriptych","DS/IssueManagement/components/welcomePanel/view/GlobalConfig","css!DS/IssueManagement/IssueManagement.css","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i){"use strict";var s=function(){};return s.prototype.init=function(n,i,s,o,a){this._left=document.createElement("div"),this._left.classList.add("isu-triptych-wrapper"),this._main=document.createElement("div"),this._main.classList.add("isu-triptych-wrapper"),this._right=document.createElement("div"),this._right.classList.add("isu-triptych-wrapper"),this._applicationChannel=n,this._triptych=new e;var r=widget.body.offsetWidth<550?"close":"open",l={left:{resizable:!1,originalSize:t.LEFT_PANEL_SIZE_EXPANDED,originalState:r,overMobile:!0,withClose:!1},right:{resizable:!0,minWidth:250,originalSize:430,originalState:"close",overMobile:!0},borderLeft:!0,container:i,withtransition:!0,modelEvents:this._applicationChannel,useNewUXGuidelines:!0};this._triptych.init(l,this._left,this._main,this._right)},s.prototype.inject=function(e){this._triptych.inject(e)},s.prototype._getTriptych=function(){return this._triptych},s.prototype.getLeftPanelContainer=function(){return this._left},s.prototype.getLeftPanelContainerTriptych=function(){return this._triptych._leftPanelContent},s.prototype.getRightPanelContainer=function(){return this._right},s.prototype.getMainPanelContainer=function(){return this._main},s}),define("DS/IssueManagement/commands/CreateIssuePLMNew",["DS/ENONewWidget/command/NewContentCommandBase","DS/IssueManagement/commands/CommandsManager","DS/PlatformAPI/PlatformAPI","DS/PADUtils/views/PADAlert","DS/IssueServices/Contexts","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,n,i,s,o){"use strict";var a="IssueCommon";return e.extend({defaults:{type:"Issue"},init:function(e){this.app=e.app,this._parent(e)},getType(){return this.defaults.type},execute:function(){this.launchCreationDialog()},launchCreationDialog(){var e=this.getCreateOptions({});this.launchCreateNew(e)},getOptions:e=>({options:{typeName:"Issue"},events:{onSuccess:function(e){let t=e.result[0].identifier;var r=s.get("widget")||window.widget,l=[],c={};l.push([t]),c[t]={};var d=Math.floor(Date.now()),u={metadata:{appId:r.id,appName:a,timestamp:d,options:{}},data:{paths:l,attributes:c},version:"1.0"};n.publish("DS/Object/create",u);const m=o.replace(o.create.creationSuccess,{title:""});i.displayNotification({msg:m.replace("''",""),eventID:"success"})},onFailure:function(e){i.displayNotification({msg:o.create.creationFailed,eventID:"error"})},onCancel:function(e){t.getCommandCheckHeader("InlineCreate").setState(!1,!1)}}}),_publishEvent:function(e,t){var i=s.get("widget")||window.widget,o=[],r={};o.push([e]),r[e]={};var l=Math.floor(Date.now()),c={metadata:{appId:i.id,appName:a,timestamp:l,options:{}},data:{paths:o,attributes:r},version:"1.0"};n.publish(t,c)}})}),define("DS/IssueManagement/commands/InlineCreate",["UWA/Class","DS/ApplicationFrame/CommandCheckHeader","DS/IssueServices/Contexts","DS/IssueManagement/commands/CreateIssuePLMNew"],function(e,t,n,i){"use strict";var s=300,o=100,a="PLMNewEnablement";return e.extend(t,{view:null,activated:!1,mini:null,init:function(e){var t=this;t._parent(e,{});var i=!1,s=t.onStateChange(function(){if(!0!==i){if(t.activated!==t.getState()){t.activated=t.getState();var e=n.get(a);!0===t.activated?t.execute():e||t.hide()}}else i=!1}),o=t._destroy;t._destroy=function(){t._modelEvents.unsubscribe(s),o.call(t)},i=!0,t.setState(!1,!0)},execute:function(){var e=this;n.get(a)?new i({app:"ISU_MGMT"}).execute():require(["UWA/Core","DS/IssueCommon/utils/Utils","DS/IssueManagement/components/header/InlineCreate","DS/IssueServices/Contexts","DS/Controls/Popup"],function(t,n,i,a,r){var l=a.get("actionBar");e.mini=null;var c=new i,d=document.getElementById("InlineCreateToolbar").getParent().getParent();e.view=c;var u=d;if(u.getBoundingClientRect().left-l.container.getBoundingClientRect().left<s){e.mini=t.createElement("div",{class:"mini-inline-create",html:[{tag:"div",class:"mini-inline-create-placeholder"},c.render()]}),e.createPopup=new r({target:a.get("actionBar").container.parentElement,trigger:"click",visibleFlag:!0,autoHide:!1,position:"bottom",alignment:"near",offset:{x:0,y:0},mouseRelativePosition:!1,constraint:"none",overlap:!0,arrowBoxFlag:!1,className:"wux-controls-popup-inline-create"});var m=a.get("actionBar").container.parentElement.offsetWidth;e.createPopup.getContent().setStyle("width",m),e.createPopup.setBody(e.mini),setTimeout(function(){c.focus()},o)}else{var p=function(){setTimeout(function(){c.focus()},o),u.removeEventListener("transitionend",p,{once:!0})};u.addEventListener("transitionend",p,{once:!0}),c.render().inject(u)}})},hide:function(){var e=this;require(["DS/IssueServices/Contexts"],function(t){e.view.destroy(),e.view=null,null!==e.mini&&(e.mini.destroy(),e.mini=null),null!=e.createPopup&&(e.createPopup.destroy(),e.createPopup=null)})},resize:function(){var e=n.get("actionBar"),t="";document.getElementById("InlineCreateToolbar")&&(t=document.getElementById("InlineCreateToolbar").getParent().getParent());var i,s=n.get("actionBar").container.getParent();if(t&&(i=t.getElementsByClassName("create-container")[0]),null!=i){if(null!=t&&null!=t&&t.getBoundingClientRect().left-e.container.getBoundingClientRect().left<90){var o=t.getElementsByClassName("create-container")[0];n.get("actionBar").container.getParent().appendChild(o);var a=n.get("actionBar").container.parentElement.offsetWidth;o.setStyle("width",a),this.view&&this.view.dropdown.updatePosition()}}else if(null!=this.createPopup){if(null!=this.createPopup.getContent().getElementsByClassName("create-container")[0]&&null!=t&&null!=t)if(t.getBoundingClientRect().left-e.container.getBoundingClientRect().left<300){a=n.get("actionBar").container.parentElement.offsetWidth;this.createPopup.getContent().setStyle("width",a)}else{o=this.mini.getElementsByClassName("create-container")[0];this.createPopup.getContent().setStyle("width",""),this.createPopup.getContent().setStyle("top",""),this.createPopup.getContent().setStyle("left",""),document.getElementById("InlineCreateToolbar").getParent().getParent().appendChild(o),o.setStyle("width",""),this.mini.destroy(),this.mini=null,this.createPopup.destroy(),this.createPopup=null,this.view&&this.view.dropdown.updatePosition()}}else if(null!=s.getElementsByClassName("create-container")[0])if(t.getBoundingClientRect().left-e.container.getBoundingClientRect().left>300){o=s.getElementsByClassName("create-container")[0];document.getElementById("InlineCreateToolbar").getParent().getParent().appendChild(o),o.setStyle("width",""),this.view&&this.view.dropdown.updatePosition()}else{a=n.get("actionBar").container.parentElement.offsetWidth;(o=s.getElementsByClassName("create-container")[0]).setStyle("width",a)}}})}),define("DS/IssueManagement/views/list/Keyboard",["UWA/Class/Promise","DS/IssueCommon/utils/Utils","DS/IssueManagement/commands/CommandsManager","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],function(e,t,n,i,s){"use strict";var o="DS/IssueManagement/views/list/Keyboard",a={ISSUE_TYPE:"Issue"},r=function(){return!(window.document.getElementsByClassName("wux-menu").length>0&&window.document.getElementsByClassName("wux-menu-container").length>0)};return{"treelistview:go-to-next-node":function(){if(!1!==r()){s.start(o+" go-to-next-node");var t=this,n=i.get("component").getTreeDocument(),a=n.getSelectedNodes(),l=[],c=function(t){return new e(function(e){t.onPostExpand(function(){e()}),t.expand()})};n.withTransactionUpdate(function(){for(var n=t.getKeymapManager(),i=0;i<a.length;i++)!a[i].isExpanded()&&a[i].getChildren()&&l.push(c(a[i]));l.length>0&&n.wait(),e.all(l).then(function(){n.listen();var e=t.getActiveNode();e&&!l.length>0&&t._goToNode(e,1)})}),s.end(o+" go-to-next-node")}},"treelistview:go-to-previous-parent-node":function(){if(!1!==r()){s.start(o+" go-to-previous-parent-node");var t=this,n=i.get("component").getTreeDocument(),a=n.getSelectedNodes(),l=[],c=function(t){return new e(function(e){t.onPostCollapse(function(){e()}),t.collapse()})};n.withTransactionUpdate(function(){for(var n=t.getKeymapManager(),i=0;i<a.length;i++)a[i].isExpanded()&&l.push(c(a[i]));l.length>0&&n.wait(),e.all(l).then(function(){n.listen();var e=t.getActiveNode();e&&!l.length>0&&t._goToNode(e,-1)})}),s.end(o+" go-to-previous-parent-node")}},"treelistview:go-to-previous-visible-node":function(){if(!1!==r()){s.start(o+" go-to-previous-visible-node");var e=this,t=e.getActiveNode(),n=e.getKeymapManager();!function t(s){if(s){var o=s.getPreviousVisibleNode();if(o)if(o.options.baseType===a.ISSUE_TYPE){n.wait(),e._goToNode(s,-1);var r=i.get("component").getTreeDocument();r.prepareBroadcastSelect(),r.pushBroadcastSelect()}else t(o)}}(t),s.end(o+" go-to-previous-visible-node")}},"treelistview:go-to-next-visible-node":function(){if(!1!==r()){s.start(o+" go-to-next-visible-node");var e=this,t=e.getActiveNode(),n=e.getKeymapManager();!function t(s){if(s){var o=s.getNextVisibleNode();if(o)if(o.options.baseType===a.ISSUE_TYPE){n.wait(),e._goToNode(s,1);var r=i.get("component").getTreeDocument();r.prepareBroadcastSelect(),r.pushBroadcastSelect()}else t(o)}}(t),s.end(o+" go-to-next-visible-node")}},"treelistview:edit-mode":function(){!1!==r()&&(s.start(o+" edit-mode"),i.get("component").getTreeDocument().getSelectedNodes().length>0&&n.getCommand("ToggleInformationPanel")&&n.getCommand("ToggleInformationPanel").begin({open:!0,save:!0}),s.end(o+" edit-mode"))},"treelistview:edit-cancel":function(){if(!1!==r()){s.start(o+" edit-cancel");var e=i.get("component").getTreeDocument();e.withTransactionUpdate(function(){e.unselectAll(),n.getCommand("ToggleInformationPanel")&&n.getCommand("ToggleInformationPanel").begin({open:!1,save:!0})}),s.end(o+" edit-cancel")}},"treelistview:select-all":function(){!1!==r()&&(s.start(o+" select-all"),n.getCommand("SelectAllIssues").begin(),s.end(o+" select-all"))},"treelistview:copy-node":function(){if(!1!==r()){s.start(o+" copy-node");var e=i.get("component").getTreeDocument().getSelectedNodes(),n=[];e.forEach(function(e){n.push(e.options.type+" "+e.options.name+" "+e.options.revision)}),t.copyTextToClipboard(n.join(", ")),s.end(o+" copy-node")}},"treelistview:delete-node":function(){if(!1!==r()){s.start(o+" delete-node");var e=i.get("component").getSelectedNodes();if(0!==e.length){for(var t=!1,l=0;l<e.length;l++)e[l].options.baseType===a.ISSUE_TYPE&&(t=!0);!0===t?n.getCommand("Delete").begin():n.getCommand("Detach").begin(),s.end(o+" delete-node")}}}}}),define("DS/IssueManagement/components/header/IssueToolbarActions",["DS/IssueManagement/commands/CommandsManager","DS/IssueServices/Contexts","DS/IssueCommon/utils/Utils"],function(e,t,n){"use strict";return{setFilterOptionsOnWidget:function(e,t){require(["DS/IssueManagement/components/header/IssueDataGridToolbar","DS/IssueServices/Contexts"],function(e,i){var s=i.get("widget")||window.widget,o=[{IdValue:t,StateValue:"selected"}];e.toggleFilterItem(o,e.toolbarActionBar);var a=e.toolbarActionBar.getNodeModelByID("Filter").options.grid.data.menu;if("session"===t)a.forEach(function(t){if("session"!==t.id&&"others"!==t.id&&"closed"!==t.id&&"selected"===t.state){var n=[{IdValue:t.id,StateValue:"selected"}];e.toggleFilterItem(n,e.toolbarActionBar)}});else if("closed"!==t){var r=a.find(e=>"session"===e.id);if(r.state.includes("selected")){o=[{IdValue:r.id,StateValue:"selected"}];e.toggleFilterItem(o,e.toolbarActionBar)}}var l=e.getSelectedFilterOptions(e.toolbarActionBar);if(s.setValue("filter",JSON.stringify(l)),"filterbyobject"!=t)s.dispatchEvent("onRefresh",["filter"]),s.dispatchEvent("endEdit");else if("filterbyobject"===t){var c=i.get("filter");!0===l[t]?c.showContextFilter():c.hideContextFilter();try{var d=i.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:d,pd3:"SummaryToolbar",pd4:"FilterByObject",pd5:"Issue/"+d+"/SummaryToolbar/FilterByObject"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}}})},inlineCreate:function(){e.getCommandCheckHeader("InlineCreate").toggleState()},createCA:function(i){e.getCommand("ChangeAction").begin();try{var s=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:s,pd3:"SummaryToolbar",pd4:"AddNewCAAsResolvedBy",pd5:"Issue/"+s+"/SummaryToolbar/AddNewCAAsResolvedBy"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},create3DMarkUp:function(i){e.getCommand("3DMarkup").begin();try{var s=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:s,pd3:"SummaryToolbar",pd4:"AddNew3DMarkupAsAttachment",pd5:"Issue/"+s+"/SummaryToolbar/AddNew3DMarkupAsAttachment"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},selectAll:function(i){e.getCommand("SelectAllIssues").begin();try{var s=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:s,pd3:"SummaryToolbar",pd4:"SelectAllIssues",pd5:"Issue/"+s+"/SummaryToolbar/SelectAllIssues"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},selectAllRelatedObjects:function(i){e.getCommand("SelectAllRelatedObjects").begin();try{var s=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:s,pd3:"SummaryToolbar",pd4:"SelectAllVisibleIssueContent",pd5:"Issue/"+s+"/SummaryToolbar/SelectAllVisibleIssueContent"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},unselectAll:function(i){e.getCommand("UnselectAll").begin();try{var s=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:s,pd3:"SummaryToolbar",pd4:"UnselectAll",pd5:"Issue/"+s+"/SummaryToolbar/UnselectAll"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},customizeColumnView:function(i){require(["DS/IssueManagement/components/header/IssueDataGridToolbar","DS/IssueServices/Contexts"],function(e,t){t.get("widget")||window.widget}),e.getCommand("ColumnCustomization").begin();try{var s=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:s,pd3:"SummaryToolbar",pd4:"CustomView",pd5:"Issue/"+s+"/SummaryToolbar/CustomView"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},customizeByState:function(){require(["DS/IssueServices/Contexts","DS/IssueManagement/components/header/IssueDataGridToolbar"],function(e,t){var n=e.get("widget"),i=[{IdValue:"state",StateValue:"selected"}];t.toggleKanbanCustomizeItem(i,t.toolbarActionBar),e.get("component").kanban.switchView("state"),n.setValue("kanbanViewBy","state"),n.dispatchEvent("endEdit")})},customizeByPriority:function(){require(["DS/IssueServices/Contexts","DS/IssueManagement/components/header/IssueDataGridToolbar"],function(e,t){var n=e.get("widget"),i="priority",s=[{IdValue:i,StateValue:"selected"}];t.toggleKanbanCustomizeItem(s,t.toolbarActionBar),e.get("component").kanban.switchView(i),n.setValue("kanbanViewBy",i),n.dispatchEvent("endEdit")})},customizeByResDate:function(){require(["DS/IssueServices/Contexts","DS/IssueManagement/components/header/IssueDataGridToolbar"],function(e,t){var n=e.get("widget"),i="resolutionDate",s=[{IdValue:i,StateValue:"selected"}];t.toggleKanbanCustomizeItem(s,t.toolbarActionBar),e.get("component").kanban.switchView(i),n.setValue("kanbanViewBy",i),n.dispatchEvent("endEdit")})},customizeByAll:function(){require(["DS/IssueServices/Contexts","DS/IssueManagement/components/header/IssueDataGridToolbar"],function(e,t){var n=e.get("widget"),i=[{IdValue:"all",StateValue:"selected"}];t.toggleKanbanCustomizeItem(i,t.toolbarActionBar),e.get("component").kanban.switchView("all"),n.setValue("kanbanViewBy","all"),n.dispatchEvent("endEdit")})},switchView:function(i){e.getCommand("SwitchView").begin(i);try{var s="DataGridView";"KanbanView"===i&&(s="KanbanView");var o=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:o,pd3:"SummaryToolbar",pd4:s,pd5:"Issue/"+o+"/SummaryToolbar/"+s}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},print:function(i){e.getCommand("Print").begin();try{var s=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:s,pd3:"SummaryToolbar",pd4:"Print",pd5:"Issue/"+s+"/SummaryToolbar/Print"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},manageTemplates:function(t){e.getCommand("Templates").begin()},exportCSV:function(i){e.getCommand("ExportCSV").begin();try{var s=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:s,pd3:"SummaryToolbar",pd4:"ExportAsCSV",pd5:"Issue/"+s+"/SummaryToolbar/ExportAsCSV"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},exportPPTX:function(i){e.getCommand("ExportPPTX").begin();try{var s=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:s,pd3:"SummaryToolbar",pd4:"ExportAsPPTX",pd5:"Issue/"+s+"/SummaryToolbar/ExportAsPPTX"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},exportZIP:function(i){e.getCommand("ExportZIP").begin();try{var s=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:s,pd3:"SummaryToolbar",pd4:"ExportAsZIP",pd5:"Issue/"+s+"/SummaryToolbar/ExportAsZIP"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},subscribe:function(t){e.getCommand("Subscription").begin(t.actionId)},switchLayout:function(i){e.getCommand("SwitchLayout").begin({layout:i,save:!0});var s="InformationPanelDisplayAtRight";"bottom"===i&&(s="InformationPanelDisplayAtBottom");try{var o=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:o,pd3:"SummaryToolbar",pd4:s,pd5:"Issue/"+o+"/SummaryToolbar/"+s}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},openInformationPanel:function(i){e.getCommand("ToggleInformationPanel").begin({open:i,save:!0});try{var s=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:s,pd3:"SummaryToolbar",pd4:"InformationPanel",pd5:"Issue/"+s+"/SummaryToolbar/InformationPanel"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},resize:function(){require(["DS/IssueServices/Contexts"],function(t){e.getCommandCheckHeader("InlineCreate")&&e.getCommandCheckHeader("InlineCreate").resize(),t&&t.get("filter")&&t.get("filter").resize()})}}}),define("DS/IssueManagement/views/list/TreeList",["UWA/Core","UWA/Class/Promise","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/Core/PointerEvents","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/Tree/TreeListView","DS/Menu/Menu","DS/IssueCommon/utils/Utils","DS/IssueComponents/users/Users","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/utils/DragAndDrop","DS/IssueManagement/components/ContextualMenu","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon","css!DS/IssueManagement/IssueManagement.css"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p,h,g,f,v,I){"use strict";return r.extend({name:"DS/IssueManagement/views/list/TreeList"})}),define("DS/IssueManagement/components/welcomePanel/view/TopBarWrapper",["UWA/Class","DS/ENOXPageToolBar/js/PageToolBar","DS/IssueManagement/components/welcomePanel/view/GlobalConfig","DS/PlatformAPI/PlatformAPI","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a){"use strict";return e.extend({initialize:function(e,n,i){this.xModelRouter=n,this._applicationChannel=e,this._isReadyToNavigate=!0;var s={withInformationButton:!0,withWelcomePanelButton:!0,modelEvents:this._applicationChannel,parentContainer:i};this.myPageToolBar=new t(s),this.myPageToolBar.render().inject(i),this.addTitleContentIntoTopBarContent(),this._subscribeToEvents()},_subscribeToEvents:function(){var e=this;this._applicationChannel.subscribe({event:"updateToolbar"},function(){var e=document.getElementsByClassName("body-content")[0],t=e.getElementsByClassName("im-header")[0],n=e.getElementsByClassName("create-template-chooser-list-iconbar")[0];widget.getValue("IsIssueSummaryView")?(n&&n.hide(),t&&t.show()):(t&&t.hide(),n&&n.show())}),this._applicationChannel.subscribe({event:"welcome-panel-collapse"},function(){e._applicationChannel.publish({event:"triptych-set-size",data:{size:n.LEFT_PANEL_SIZE_COLLAPSED,side:"left"}}),e._applicationChannel.publish({event:"triptych-show-panel",data:"left"}),widget.setValue("isCollapsed",!0);try{s.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:"DataGridView",pd3:"LandingPage",pd4:"Collapse",pd5:"Issue/DataGridView/LandingPage/Collapse"}})}catch(e){}}),this._applicationChannel.subscribe({event:"welcome-panel-expand"},function(){e._applicationChannel.publish({event:"triptych-set-size",data:{size:n.LEFT_PANEL_SIZE_EXPANDED,side:"left"}}),e._applicationChannel.publish({event:"triptych-show-panel",data:"left"}),widget.setValue("isCollapsed",!1);try{var t=o.get("component").getCurrentView();s.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:t,pd3:"LandingPage",pd4:"Expand",pd5:"Issue/"+t+"/LandingPage/Expand"}})}catch(e){}}),this._applicationChannel.subscribe({event:"information-panel-close"},function(){"right"==widget.getValue("infoPanelLayout")||null==widget.getValue("infoPanelLayout")||null==widget.getValue("infoPanelLayout")?(e._applicationChannel.publish({event:"triptych-hide-panel",data:"right"}),widget.setValue("isOpened",!1)):"bottom"==widget.getValue("infoPanelLayout")&&e._applicationChannel.publish({event:"triptych-hide-panel-bottom",data:"bottom"}),e._applicationChannel.publish({event:"resize-summary-view",data:"left"})}),this._applicationChannel.subscribe({event:"triptych-hide-panel"},function(e){"right"==e&&i.publish(`PropHeaderDeActivated:${widget.id}`)}),this._applicationChannel.subscribe({event:"information-panel-open"},function(){"right"==widget.getValue("infoPanelLayout")||null==widget.getValue("infoPanelLayout")||null==widget.getValue("infoPanelLayout")?(e._applicationChannel.publish({event:"triptych-show-panel",data:"right"}),e._applicationChannel.publish({event:"information-panel-visible",data:null})):"bottom"==widget.getValue("infoPanelLayout")&&e._applicationChannel.publish({event:"triptych-show-panel-bottom",data:"bottom"})}),this._applicationChannel.subscribe({event:"triptych-panel-hidden"},function(t){if("right"===t){if(widget.getValue("fromLayoutChange"))return void widget.setValue("fromLayoutChange",!1);e._applicationChannel.publish({event:"information-panel-hidden",data:null})}}),this._applicationChannel.subscribe({event:"topbar-show-title"},function(t){t&&(e._title.id=t.id,e._title.label=t.label,e._tileContent.setContent(t.label)),e._tileContent.show()}),this._applicationChannel.subscribe({event:"topbar-hide-title"},function(){e._tileContent.hide()})},addTitleContentIntoTopBarContent:function(){this.topbarContent=this.myPageToolBar.getBodyContent(),this._tileContent=UWA.createElement("div",{class:"page-Toolbar-container",styles:{display:"none",padding:"6px 0",fontSize:"14px",width:"150px",marginTop:"5px"}}),this._tileContent.inject(this.topbarContent),this._title={id:n.ROUTE_HOME,label:"Home"}}})}),define("DS/IssueManagement/components/information/Header",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Iconbar","DS/UIKIT/Tooltip","DS/Logger/Logger","DS/Menu/Menu","DS/SocialToolbar/SocialToolbar","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/lifecycle/Lifecycle","DS/IssueManagement/components/ContextualMenu","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p,h,g,f,v){"use strict";return t.extend({})}),define("DS/IssueManagement/components/welcomePanel/view/ApplicationFrame",["UWA/Class","DS/IssueManagement/components/welcomePanel/view/TriptchWrapper","DS/IssueManagement/components/welcomePanel/view/TopBarWrapper","css!DS/UIKIT/UIKIT.css","css!DS/IssueManagement/IssueManagement.css"],function(e,t,n){"use strict";return e.extend({initialize:function(e,t,n,i){this._applicationChannel=e,this._router=t,this._leftContent=n,this._middleContent=i,this.render()},render:function(){this.createTopBarParent(),this.createMainContainer(),this.initializeTopBarWrapper(),this.initializeTriptychWrapper(),this.createMiddleContainer(),this._middleContainer.appendChild(this._topbar),this.addSummaryViewInMainContainer(),this._applicationChannel.publish({event:"triptych-set-content",data:{side:"middle",content:this._middleContainer}}),this._subscribeEvents(),this.setMobileBreakPoint()},_subscribeEvents:function(){var e=this;e._listSubscription=[],e._listSubscription.push(e._applicationChannel.subscribe({event:"triptych-show-panel"},function(t){e._mainContainer.clientWidth<e.__mobileBreakpoint&&(e._topbar.classList.add("hide"),e._mainContainer.classList.add("full-height"))})),e._listSubscription.push(e._applicationChannel.subscribe({event:"triptych-panel-hide-started"},function(t){e._mainContainer.clientWidth<e.__mobileBreakpoint&&(e._topbar.classList.remove("hide"),e._mainContainer.classList.remove("full-height")),e._applicationChannel.publish({event:"model-conflict-panel-closed"});var n=document.querySelector("#taskViewPanelClose");n&&n.click();var i=document.querySelectorAll(".isu-triptych-wrapper");e.infoDialog=i;var s=i[0].childNodes;if("right"===t)for(var o=0;o<s.length;o++){var a=s[o].getAttribute("name");UWA.is(a)&&"EditProp_MasterContain"===a?s[o].style.display="block":s[o].style.display="none"}})),e._listSubscription.push(e._applicationChannel.subscribe({event:"triptych-entering-mobile"},function(){e._topbar.classList.remove("hide"),e._mainContainer.classList.remove("full-height"),e._applicationChannel.publish({event:"triptych-hide-panel",data:"left"})})),e._listSubscription.push(e._applicationChannel.subscribe({event:"triptych-resized"},function(e){if("right"===e.side)e.width})),e._listSubscription.push(e._applicationChannel.subscribe({event:"triptych-leaving-mobile"},function(){e._topbar.classList.remove("hide"),e._mainContainer.classList.remove("full-height"),widget.getValue("isOpened")&&"bottom"==widget.getValue("currentLayout")&&e._applicationChannel.publish({event:"information-panel-close"}),e._applicationChannel.publish({event:"triptych-show-panel",data:"left"})})),e._listSubscription.push(e._applicationChannel.subscribe({event:"welcome-panel-action-selected"},function(t){e._mainContainer.clientWidth<e.__mobileBreakpoint&&e._applicationChannel.publish({event:"triptych-hide-panel",data:"left"})}))},inject:function(e){e.appendChild(this._mainContainer)},destroy:function(){this._content=null},createTopBarParent:function(){this._topbar=UWA.createElement("div",{id:"isu-toolbar"}),this._topbar.classList.add("isu-topbar")},initializeTopBarWrapper:function(){this._pageToolBarComponent=new n,this._pageToolBarComponent.initialize(this._applicationChannel,this._router,this._topbar)},initializeTriptychWrapper:function(){this._triptychWrapper=new t,this._triptychWrapper.init(this._applicationChannel,this._mainContainer)},createMainContainer:function(){this._mainContainer=document.createElement("div"),this._mainContainer.classList.add("isu-content")},createMiddleContainer:function(){this._middleContainer=document.createElement("div"),this._middleContainer.classList.add("isu-maincontainer")},addSummaryViewInMainContainer:function(){this._applicationContent=document.createElement("div"),this._applicationContent.classList.add("isu-content-wrapper"),this._middleContainer.appendChild(this._applicationContent),this._middleContent&&this._middleContent._container&&this._applicationContent.appendChild(this._middleContent._container)},setMobileBreakPoint:function(){this.__mobileBreakpoint=this._triptychWrapper._triptych.__mobileBreakpoint}})}),define("DS/IssueManagement/IssueManagement",["UWA/Class","UWA/Class/Promise","UWA/Core","DS/CoreEvents/ModelEvents","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Migration","DS/IssueServices/utils/Performance","DS/IssueServices/utils/Support","DS/IssueCommon/utils/Utils","DS/IssueComponents/templates/TemplatesDataGridLayout","DS/WidgetServices/WidgetServices","DS/PlatformAPI/PlatformAPI","DS/IssueManagement/components/welcomePanel/view/WelcomePanelWrapper","DS/IssueManagement/components/welcomePanel/view/ApplicationFrame","DS/IssueManagement/components/welcomePanel/view/GlobalConfig","DS/IssueManagement/components/welcomePanel/router/Router","DS/IssueManagement/components/welcomePanel/router/RouteConfig","DS/PADUtils/views/PADAlert","i18n!DS/IssueComponents/assets/nls/IssueComponents","DS/Windows/ImmersiveFrame","DS/IssueTracker/IssueTracker","text!DS/IssueManagement/assets/Settings.json","i18n!DS/IssueManagement/assets/nls/IssueManagement","css!DS/IssueManagement/IssueManagement.css"],function(e,t,n,s,o,a,r,l,c,d,u,m,p,h,g,f,v,I,b,y,S,w,C,T,E){"use strict";var D="ENXISSU_AP",_="Issue",A="ISU_TYPE_NLS",M="CUSTOM_ATTR_NLS",N="CUSTOM_ATTR_INFOS",x="ISSUE_EXTENSIONS",O="X3DContentId",P="XNotifContentId",k="XTemplateContentId",V="XSharedContentId",L="maturityGraph",R="templateMaturityGraph",U="PLMNewEnablement",F="IssueTemplatesEnabled",j={DIMENSIONS:{MINIMUM_INFORMATION_WIDTH:430,MINIMUM_COMPONENT_WIDTH:260}},B=function(){for(var e='<div class="issue-list-placeholder-header"></div>',t=0;t<=50;t++)e+='<div class="issue-list-placeholder-line"></div>';return n.createElement("div",{class:"issue-list-placeholder fade-out-element",html:[n.createElement("div",{class:"issue-list-placeholder-actions",html:'<div class="issue-list-placeholder-action"></div><div class="issue-list-placeholder-action"></div><div class="issue-list-placeholder-action"></div><div class="issue-list-placeholder-action-divider"></div><div class="issue-list-placeholder-action"></div><div class="issue-list-placeholder-action"></div><div class="issue-list-placeholder-action-divider"></div><div class="issue-list-placeholder-action"></div><div class="issue-list-placeholder-action"></div><div class="issue-list-placeholder-action-divider"></div><div class="issue-list-placeholder-action"></div><div class="issue-list-placeholder-action"></div>'}),n.createElement("div",{class:"issue-list-placeholder-lines",html:e})]})},W=function(e){return n.createElement("div",{class:"placeholder-loading-container",html:[n.createElement("div",{class:"placeholder-loading",html:[n.createElement("div",{class:"pin",html:'<span class="fonticon fonticon-5x fonticon-issue-type"></span>'}),n.createElement("div",{class:"pulse"}),n.createElement("span",{class:"placeholder-loading-label saving",html:[e.NLS,{tag:"span",html:"."},{tag:"span",html:"."},{tag:"span",html:"."}]}),n.createElement("div",{class:"placeholder-loading-sub-container",html:[]})]}),n.createElement("div",{class:"placeholder-loading-background",html:""})]})},z=function(e){return n.createElement("div",{class:"loading-error-container",html:n.createElement("div",{class:"loading-error",html:[n.createElement("div",{class:"loading-error-icon",html:n.createElement("span",{class:"fonticon fonticon-5x fonticon-attention"})}),n.createElement("div",{class:"loading-error-label",html:e.label}),n.createElement("div",{class:"loading-error-sub-label",html:e.sub})]})})};return e.extend({name:"DS/IssueManagement/IssueManagement",actionBar:null,filter:null,status:null,component:null,elements:{container:null,header:null,body:null,footer:null},isLoaded:null,isStandalone:!1,_deferred:{resolve:null,reject:null},_isDOMLoaded:!1,_placeholder:null,_loading:null,_isResizing:!1,initHome:function(e){this._welcomePanelComponent=new g,this._immersiveFrame=new w({}),this._applicationContainer=document.createElement("div"),n.extendElement(this._applicationContainer),widget.body.setContent(this._applicationContainer),this._immersiveFrame.inject(this._applicationContainer),this._ApplicationFrame=new f,this._ApplicationFrame.initialize(this._applicationChannel,I,this._welcomePanelComponent),this._immersiveFrame.setContentInBackgroundLayer(this._ApplicationFrame),this.infoPanel=this._ApplicationFrame._triptychWrapper.getRightPanelContainer(),this._welcomePanelComponent.init(this._applicationChannel,I,this._ApplicationFrame._triptychWrapper.getLeftPanelContainerTriptych()),this._applicationChannel.publish({event:"triptych-set-size",data:{side:"left",size:v.LEFT_PANEL_SIZE_EXPANDED}}),I.start("/home")},init:function(e){var i=this;b.initialize();var a={name:"appChannelModleEvent"};i._applicationChannel=new s(a),I.setDependency("applicationChannel",i._applicationChannel),I.setDependency("issueApp",this),i.initHome(e),o.add("widget",window.widget),o.add("isNatifEnvironnement",p.isNatifEnvironnement()),o.get("widget").name=D,o.add("application",i),o.add("CustomAttributesPredicates",{}),E.summaryview&&E.summaryview,o.add("ISU_LISTVIEW",!1),i.component=null,i.actionBar=null,i.filter=null,i.status=null,i.elements={container:null,header:null,body:null,footer:null},i.isStandalone=!1,n.is(e,"object")&&(i.isStandalone=e.standalone||!1),i.isLoaded=new t(function(e,t){i._deferred.resolve=e,i._deferred.reject=t}),i._isDOMLoaded=!1,i._placeholder=B(),i._isResizing=!1,i.settings=JSON.parse(T),i.settings.switchToModelerAPIsForLoading?o.add("LoadData_ModelerAPI",!0):o.add("LoadData_ModelerAPI",!1),i._subscribers()},onLoad:function(){var e=this;c.start(e.name+" onLoad");var t=document.getElementsByClassName("triptych-main")[0];e._placeholder.inject(t),e._placeholder.removeClassName("fade-out-element").addClassName("fade-in-element"),widget.getValue("IsIssueSummaryView")?e._loading=W({NLS:E.issueSummaryLoading}):e._loading=W({NLS:E.templateSummaryLoading}),e._loading.inject(t),e.resizeTriptychInfoIcon();try{d.checkBrowserSupport()}catch(e){}if(!l.isUpToDate())return e._loading.destroy(),e._loading=null,void l.upgrade();o.get("widget").body.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation()});require(["DS/MSFDocumentManagement/WidgetIntegration"],function(e){o.get("widget").MSFDocumentClient=e,o.get("widget").MSFDocumentClient.ConnectWidgetWithMSF()}),a.initPlatformServices().then(function(){e.initialize().then(function(){h.subscribe("DS/PADUtils/PADCommandProxy/select",e.onSelect.bind(e)),c.end(e.name+" onLoad"),e._deferred.resolve()},function(t){c.end(e.name+" onLoad"),e._deferred.reject(t);var n=e.utils.getNLSMsg(t);o.get("widget").body.appendChild(z(n)),"Oops! Something went wrong."===n.label&&e.utils.error(t)})})},initialize:async function(e){this.setPreferences();var t=a.getCurrentCredentials();o.get("widget").setValue("xPref_CREDENTIAL",t.role+"."+t.organization+"."+t.collaborativeSpace),r.preferences.getServerSettings({}).then(e=>{e.body&&(o.add(U,e.body.IssueCreationByPLMNew),o.add(F,e.body.IssueNewTemplate))});let n=await r.issues.getIssueMaturityGraph({});if(null!=n&&""!==n&&""!==n.body){var i=n.body[L],s=n.body[R];o.add(L,i),o.add(R,s)}var l=[_];let c=await r.type.getSubType();null!=c&&Object.keys(c).length>0&&(l=Object.keys(c));var d={"ds6w:type":await this.utils.getTypeExtensions(l),"ds6w:organizationResponsible":[a.getCurrentCredentials().organization],"ds6w:project":[a.getCurrentCredentials().collaborativeSpace]};let u=await r.getNLSValuesPromise(d);o.add(A,u),this.utils.getProperties(),this.utils.setClassContentType({policies:["Issue","Issue Template"]});let m=await r.getExpressionValue({});var p=["ISU_AUTO_DATES"];return m&&m.data&&m.data.forEach(function(e){if(e.dataelements){var t=Object.keys(e.dataelements);for(var n in t)p.indexOf(t[n])>=0&&o.add([t[n]],e.dataelements[t[n]])}}),this.initializeTriptychMainContainer(),this.initializeTriptychToolbarContainer(),await this._initializeComponent({})},onSelect:function(e){var t=this;if(!e.metadata||e.metadata.originWidgetId!==widget.id){var s=[],a=[],l=[],c=t.component.getSelectedNodes(),d=o.get("ISU_TYPE_NLS");n.is(d["ds6w:type"])&&(s=Object.keys(d["ds6w:type"]));var u=e.data.paths;if(u.length>0){var m=[];u.forEach(function(e){var t=e[0];a.push(t);var n={physicalId:t};m.push(n)}),r.fetch({data:{objects:m},onComplete:function(e){var n=e.body;n.results&&n.results.length>0&&(n.results.forEach(function(e){var n=o.get("filter").parseFetchAttributes(e),a=n.type,r=n.id;if(s.includes(a)&&t.component){var d=t.component.getTreeDocument();d.withTransactionUpdate(function(){var e=t.component.getTreeListView(),n=d.getNodesById(r);n.length>0&&(c.forEach(function(e){e.unselect()}),c=[],n.forEach(function(n){t.component.listView?0!==i||e.getManager().isNodeInVisibleViewport(n)||e.getManager().scrollToNode(n,"top",!1):e.ensureNodeModelVisible(n),n.select()}),l.push(r))})}}),require(["DS/IssueManagement/commands/CommandsManager"],function(e){l.length>0&&(widget.getValue("infoIsOpened")?(o.get("information").refreshInfo(l),o.get("actionBar").updatePanelToggle(),o.get("application").updateHeaderToggle()):o.get("information").physicalIds=l,e.select(t.component.getSelectedNodes()))}))}})}}},setPreferences:function(){try{d.checkSwymSupport()}catch(e){}var e=a.getSecurityContexts(),t=a.getTenants();return this._setPreferences({securityContexts:e,tenants:t})},onRefresh:function(e){var t=void 0!==e,n=o.get("widget")||window.widget;n.setTitle(this.getTitle()+" - "+E.titles.refreshing);let i=n.getValue("filter"),s=!1;if(((i=JSON.parse(i)).reported||i.responsible)&&!0,n.getValue("IsIssueSummaryView")||null==n.getValue("IsIssueSummaryView")||null==n.getValue("IsIssueSummaryView")){if(null!==this.component)if(0===this.component.getTreeDocument().getRoots(!0).length&&!0===this.component.getTreeDocument().isBIFiltered())this.onTitleChange();else o.get("LoadData_ModelerAPI")?this.component.refresh_New(t):this.component.refresh(t);if(null!==this.information&&this.information.refreshInfo(void 0,!0),void 0!==n.getValue("xPref_CREDENTIAL")){var r=a.getCurrentCredentials();n.setValue("xPref_CREDENTIAL",r.role+"."+r.organization+"."+r.collaborativeSpace)}}else this.Templatecomponent.refreshTemplateList()},onResize:function(){this._isResizing=!1,!1!==this._isDOMLoaded&&(this._placeholder.removeClassName("fade-in-element").addClassName("fade-out-element"),this._placeholder.removeClassName("resizing"),this.elements.container.removeClassName("fade-out-element").addClassName("fade-in-element"),this.resize())},endEdit:function(){this.component.publishPreferences()},onDestroy:function(){null!==this.actionBar&&this.actionBar.destroy(),this.actionBar=null,o.remove("actionBar"),null!==this.filter&&this.filter.destroy(),this.filter=null,o.remove("filter"),null!==this.status&&this.status.destroy(),this.status=null,o.remove("status"),null!==this.component&&this.component.destroy(),this.component=null,o.remove("component"),null!==this.information&&this.information.destroy(),this.information=null,o.remove("information"),this.elements.container.destroy(),this.elements.header.destroy(),this.elements.body.destroy(),this.elements.footer.destroy(),this.elements={container:null,header:null,body:null,footer:null},o.remove("application"),o.remove("widget"),this._isDOMLoaded=!1},onTitleChange:function(){var e=o.get("widget"),t=this.getTitle(),n=o.get("templateComponent");if(e.getValue("IsIssueSummaryView")){0===(i=this.component.getTreeDocument().getRoots(!1)).length?t+=" - "+E.titles.placeholder.title:t+=" ("+i.length+")"}else{var i=[];if(n)i=n.document.getRoots(!1);0===i.length?t+=" - "+E.templateTitlePlaceholder:t+=" ("+i.length+")"}e.getTitle()!==t&&e.setTitle(t)},onSetPathTags:function(){this.component.setLocalPathTags()},resize:function(){var e=o.get("widget")||window.widget;null!==this.actionBar&&this.actionBar.resize(),e.body.offsetWidth>j.DIMENSIONS.MINIMUM_INFORMATION_WIDTH+j.DIMENSIONS.MINIMUM_COMPONENT_WIDTH?(null!==this.information&&(this.information.fullScreenMode||(this.information.fullscreenWidth=!1),this.information.resize()),null!==this.component&&(this.component.container.show(),this.component.resize()),this.elements.header):null!==this.information&&(this.information.fullscreenWidth=!0,this.information.resize()),null!==this.component&&this.component.resize()},getTitle:function(){var e=o.get("widget")||window.widget,t=e.getValue("myTitle"),n=e.getPreference("myTitle");if(e&&n){t=t&&t.trim();var i=e.getValue("IsIssueSummaryView")?E.preferences.name.default:E.templatePreferenceName;return t=t||i}return e.getValue("IsIssueSummaryView")?E.preferences.name.default:E.templatePreferenceName},getActions:function(){return this.actionBar},getInformation:function(){return this.information},getComponent:function(){return this.component},updateHeaderToggle:function(){},_initializeComponent:function(e){var n=this,i=o.get("widget")||window.widget,s=null,a=null,r=null,l=null,c=null,d=null,u=null,m=null;return new t(function(e){require(["UWA/Core","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/Component","DS/IssueManagement/components/footer/Status","DS/IssueManagement/components/header/ActionBar","DS/IssueManagement/components/header/ActionBarDataGrid","DS/IssueManagement/components/header/Filter","DS/IssueManagement/components/information/Information","DS/IssueManagement/utils/EventsHandler"],function(t,n,i,o,p,h,g,f,v){s=t,a=n,r=i,u=o,p,l=h,c=g,d=f,m=v,e()})}).then(function(){return new t(function(t,i){return n.eventsHandler=new m,o.add("eventsHandler",n.eventsHandler),n.information=(new d).render(n._applicationChannel),o.add("information",n.information),n.filter=(new c).render(),o.add("filter",n.filter),n.component=new r(s.extend(e,{events:{onReady:function(e){t(e)},onRootsAdded:function(){n.destroyPlaceholder(),n.onTitleChange(),0===n.component.getSelectedNodes().length&&a.select()},onRootsRemoved:function(){0===n.component.getTreeDocument().getRoots(!1).length?a.idling():0===n.component.getSelectedNodes().length&&a.select(),n.onTitleChange()},setPathTags:function(){n.onTitleChange(),n.component.publishFilteredIssues()}}})),o.add("component",n.component),n.actionBar=(new l).render(),o.add("actionBar",n.actionBar),n.status=(new u).render(),o.add("status",n.status),n._initializeIssueTemplateComponent(),n.showHideTemplateView(),n.component.build().catch(i)})}).then(function(e){return new t(function(t){n.elements.header=s.createElement("div",{class:"im-header"}),n.elements.body=s.createElement("div",{class:"im-body"}),n.elements.footer=s.createElement("div",{class:"im-footer"}),n.elements.layout=s.createElement("div",{class:"im-layout"}),n.actionBar.inject(n.elements.header),n.component.inject(n.elements.layout),n.status.inject(n.elements.footer),n.elements.footer.inject(n.elements.layout),n.elements.layout.inject(n.elements.body),n.elements.layout.addClassName("im-bottom-layout-closed"),"Desktop"==n.media||"Tab"==n.media?n.actionBar.container.addClassName("desktop"):n.actionBar.container.addClassName("mobile"),n.toogleInformationPanel();n.elements.container=s.createElement("div",{class:"issue-list"});n.elements.body.inject(n.elements.container),n.resizeMainComponent(),n.insertIssueSummaryViewInTriptych(),n.addToolbarInTriptychToolBarContainer(),n.updateViewAfterLogin(),document.getElementsByClassName("triptych-close-right")[0].style.display="none",0===e.roots.length?(n.onTitleChange(),a.idling()):a.select();var r=i.getValue("isOpened"),l=s.is(r,"boolean")?r:"true"===r;if(!l){var c=i.getValue(O)?JSON.parse(i.getValue(O)):null;null===c||"ENXISSU_AP"!=c.source&&"X3DSEAR_AP"!=c.source||(l=!0,n.information.fullScreenMode=!0,n.information.fullscreenWidth=!0,i.setValue("infoIsOpened",!0),o.get("actionBar").updatePanelToggle())}0===e.roots.length?n.information.toggle(!1,!1):l&&(e.roots[0].select(),n._applicationChannel.publish({event:"information-panel-open"})),i.getValue("isCollapsed")&&n._applicationChannel.publish({event:"welcome-panel-collapse"}),n._isDOMLoaded=!0,t()})}).then(function(){return n.component.onPostInitialize()})},_setPreferences:function(e){var t=o.get("widget")||window.widget;if(!0===a.isCloudEnvironment()&&n.is(e.tenants,"object")&&t.addPreference({name:"x3dPlatformId",type:"list",label:E.preferences.tenant,options:e.tenants.platforms,defaultValue:e.tenants.tenant}),n.is(e.securityContexts,"object")){t.addPreference({name:"pad_security_ctx",type:"list",label:E.preferences.securityContext,options:e.securityContexts.cspaces});var i=t.getValue("pad_security_ctx"),s=e.securityContexts.cspaces.findIndex(e=>e.value==i)>=0?i:"";""!==s?t.setValue("pad_security_ctx",s):t.setValue("pad_security_ctx",e.securityContexts.securityContext)}return t.addPreference({name:"myTitle",type:"text",label:E.preferences.name.title,onchange:"onTitleChange",defaultValue:""}),this.settings.hideNoFilterSelectionPreference||t.addPreference({name:"defaultFilterForAll",type:"list",label:E.preferences.defaultFilterForAll.title,options:[{label:E.preferences.defaultFilterForAll.organizationAndProject,value:"organization-project",isDefault:!0},{label:E.preferences.defaultFilterForAll.organization,value:"organization"},{label:E.preferences.defaultFilterForAll.project,value:"project"},{label:E.preferences.defaultFilterForAll.policy,value:"policy"}],defaultValue:"organization-project"}),t.addPreference({name:"organizationFilter",type:"boolean",label:E.preferences.organizationFilter,defaultValue:"false"}),t.addPreference({name:"approaching",type:"range",min:"0",max:"100",label:E.preferences.highlights.soon,defaultValue:"3"}),t.addPreference({name:"activateBIFilter",type:"boolean",label:E.preferences.tagger,defaultValue:"true"}),t.addPreference({name:"filter",type:"hidden",defaultValue:JSON.stringify({owned:!0,assigned:!0,reported:!1,responsible:!1,contributed:!1,closed:!1,session:!1})}),t.addPreference({name:"roots",type:"hidden",defaultValue:[]}),this._computeFilter(),this._computePreferences(),t.getPreferences()},_computeFilter:function(){var e=o.get("widget")||window.widget;try{var t=JSON.parse(e.getValue("filter")),i=e.getValue(V)?JSON.parse(e.getValue(V)):null,s=e.getValue(P)?JSON.parse(e.getValue(P)):null,r=e.getValue(O)?JSON.parse(e.getValue(O)):null,l=[];if(null!==i)l=l.concat(i.issues);else if(null!==s)l=l.concat(s.issues);else if(null!==r){var c=[],d=!1;if(r.data.items.forEach(function(e){(e.objectType===_||e.hasOwnProperty("objectTaxonomies")&&e.objectTaxonomies.includes("Issue"))&&(l.push(e.objectId),c.push(e.envId))}),1===c.length&&c[0]!==a.getTenant()&&n.is(e.getPreference("x3dPlatformId"),"object")&&n.is(e.getPreference("x3dPlatformId").options,"array")){d=!0;for(var u=e.getPreference("x3dPlatformId").options,m=0;m<u.length;m++){var p=u[m];if(p.value===c[0]){e.setValue("x3dPlatformId",p.value),require(["DS/PADUtils/views/PADAlert"],function(e){e.displayNotification({msg:E.multiTenants.differentTenant,eventID:"info"})}),d=!1;break}}}d&&require(["DS/PADUtils/views/PADAlert"],function(e){e.displayNotification({msg:E.replace(E.multiTenants.mismatchTenant,{tenant:c[0]}),eventID:"error"})})}0===l.length&&!0===t.session&&(l=e.getValue("roots")),l.length>0?(t={owned:!1,assigned:!1,reported:!1,responsible:!1,contributed:!1,closed:!1,session:!0},e.setValue("filter",JSON.stringify(t)),e.setValue("roots",l)):e.setValue("roots",[])}catch(e){}},_computePreferences:function(){var e=o.get("widget")||window.widget;return new t(function(t,n){try{var i=e.getValue(k)?JSON.parse(e.getValue(k)):null;if(null!==i){var s=i.template;s&&""!==s&&t(s)}}catch(e){n(new Error("An error occurred while adding a shared template "+e))}}).then(function(i){return new t(function(t){require(["DS/PADUtils/views/PADAlert","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(s,o){var r=!1;if(i.envId!==a.getTenant()&&n.is(e.getPreference("x3dPlatformId"),"object")&&n.is(e.getPreference("x3dPlatformId").options,"array")){r=!0;for(var l=e.getPreference("x3dPlatformId").options,c=0;c<l.length;c++){var d=l[c];if(d.value===i.envId){e.setValue("x3dPlatformId",d.value),require(["DS/PADUtils/views/PADAlert"],function(e){e.displayNotification({msg:E.multiTenants.differentTenant,eventID:"info"})}),r=!1;break}}}r&&require(["DS/PADUtils/views/PADAlert"],function(e){e.displayNotification({msg:E.replace(E.multiTenants.mismatchTenantSharedTemplate,{tenant:i.envId}),eventID:"error"})}),that.Templatecomponent.addSharedTemplateToPreferences(i).then(t).catch(function(){s.displayNotification({msg:o.templates.notifications.sharedTemplateNotAdded,eventID:"error"}),t()})})})})},_subscribers:function(){var e=this,t=o.get("widget")||window.widget;t.addEvent("onLoad",e.onLoad.bind(e)),t.addEvent("onRefresh",e.onRefresh.bind(e)),t.addEvent("onResize",e.onResize.bind(e)),t.addEvent("endEdit",e.endEdit.bind(e)),t.addEvent("onDestroy",e.onDestroy.bind(e)),t.addEvent("onTitleChange",e.onTitleChange.bind(e)),t.addEventOnce("onSetPathTags",e.onSetPathTags.bind(e)),e._isResizing=!1,window.addEventListener("resize",function(){!1!==e._isDOMLoaded&&!0!==e._isResizing&&(e._isResizing=!0,e._placeholder.addClassName("resizing"),e._placeholder.removeClassName("fade-out-element").addClassName("fade-in-element"),e.elements.container.removeClassName("fade-in-element").addClassName("fade-out-element"))},!1)},utils:{error:function(e){n.is(e,"object")&&n.is(e.error,"object")&&n.is(e.error.message,"string")&&require(["DS/PADUtils/views/PADAlert"],function(t){t.displayNotification({msg:e.error.message,eventID:"error"})})},getNLSMsg:function(e){var t={label:E.error.generic.label,sub:E.error.generic.sub},i="";return n.is(e,"object")&&n.is(e.error,"object")&&n.is(e.error.message,"string")&&(i=e.error.message),i.contains("The server cannot obtain the license for user")&&(t.label=E.error.licensing.label,t.sub=E.replace(E.error.licensing.sub,{user:a.getUserName()})),t},getPropValue:function(e,t){t.split(".").reduce((e,t)=>null==e?e:e[t],e)},getTypeExtensions:function(e){return new t(function(n,i){let s=[],a=[],l=[];for(let t of e){s.push(t);let e=r.type.getClassExtensionInterface(t);l.push(e)}t.all(l).then(e=>{for(let t of e)if(t.extensions&&t.extensions.length>0)for(let e of t.extensions)a.includes(e.curi)||a.push(e.curi);o.add(x,a),s.push(...a),n(s)})})},getProperties:function(){var e=this;let i=[],s=[],a=o.get("ISU_TYPE_NLS"),l=[];n.is(a["ds6w:type"])&&(l=Object.keys(a["ds6w:type"]));for(let e of l){i.push(e);let t=r.type.getProperties(e);s.push(t)}t.all(s).then(t=>{if(Array.isArray(t)){let n=t.map(e=>{if(null!=e&&e.classPredicates&&e.classPredicates.length)return e.classPredicates[0].vocabularyPredicateInfo}).filter(function(e){return void 0!==e}),i=[];n.map(e=>{let t=e.filter(e=>{if(e.hasOwnProperty("userAccess"))return e});i.push(...t)});const s=[...new Set(i.map(e=>JSON.stringify(e)))].map(e=>JSON.parse(e));o.add(N,s),e.customAttrRangeVals(s)}})},customAttrRangeVals:function(e){const t=e.reduce(function(e,t){return null!=t.rangeValues&&(e[t.name]=t.rangeValues),e},{});o.add(M,t)},setClassContentType:function(e){var n={data:e};return new t(function(e,t){r.issues.getStatesAttributes(n).then(function(t){u.addCSSMaturityClasses("wux-controls-label",t),e()})}).catch(function(e){return e})}},_initIssueManagementContent:function(){this.elements.mainITDiv&&this.clearIssueTemplate(),this.elements.mainIMDiv&&(this.elements.mainIMDiv.show(),this.elements.IdCardDiv.show(),this.elements.header.show(),this.elements.infoIcon.classList.remove("issueTemplate"),this.elements.triptychToolbar.removeClassName("isu-templateView"),this.onTitleChange(),this.resize())},_initIssueTemplateContent:function(){this.elements.mainIMDiv&&this.clearIssueManagement(),this._loading&&this.destroyPlaceholder(),this.elements.mainITDiv&&(this.Templatecomponent.setTemplateToolbar(),this.Templatecomponent.document.pushBroadcastSelect(),this.elements.mainITDiv.show(),this.elements.issueTemplateHeader.show(),this.elements.infoIcon.classList.add("issueTemplate"),this.elements.triptychToolbar.addClassName("isu-templateView"),this.onTitleChange())},clearIssueManagement:function(){this.elements.mainIMDiv.hide(),this.elements.IdCardDiv.hide()},clearIssueTemplate:function(){this.elements.mainITDiv.hide()},addToolbarInTriptychToolBarContainer:function(){this.elements.header.inject(this.elements.triptychToolbar),this.elements.header.hide()},showIDCardInRightLayout:function(){this.information.inject(this.elements.IdCardDiv),this.information.show(),this._applicationChannel.publish({event:"triptych-set-content",data:{side:"right",content:this.elements.IdCardDiv}}),this.information.open(),this.information.refreshInfo()},resizeTriptychInfoIcon:function(){this.elements.infoIcon=document.getElementsByClassName("information-panel panel-icon-wrapper")[0].childNodes[1],this.media=C.getDeviceUsedForOperation(),this.elements.parentInfoIcon=document.getElementsByClassName("information-panel panel-icon-wrapper")[0],this.elements.infoIcon&&(this.elements.infoIcon.className+="wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-info wux-ui-3ds-lg",this.elements.infoIcon.className=this.elements.infoIcon.className.replace("fonticon-2x",""),this.elements.infoIcon.className+=" isu-infoIcon","Desktop"==this.media||"Tab"==this.media?this.elements.parentInfoIcon.className+=" desktop":this.elements.parentInfoIcon.className+=" mobile")},toogleInformationPanel:function(){var e=this;e.elements.IdCardDiv=n.createElement("div",{class:"IDCardMainDiv"}),widget.setValue("isOpened",!1),e._applicationChannel.subscribe({event:"triptych-show-panel"},function(t){e.showIDCardInRightLayout()}),e._applicationChannel.subscribe({event:"triptych-show-panel-bottom"},()=>{e.information.inject(e.elements.body),e.information.show(),e.information.open(),e.information.refreshInfo()}),e._applicationChannel.subscribe({event:"triptych-hide-panel-bottom"},()=>{e.information.hide(),e.information.close()})},resizeMainComponent:function(){var e=this;e._applicationChannel.subscribe({event:"triptych-resized"},function(t){"right"===t.side&&e.information.resize()})},insertIssueSummaryViewInTriptych:function(){this.elements.mainIMDiv=n.createElement("div",{class:"mainIMDiv"}),this.elements.container.inject(this.elements.mainIMDiv),this.elements.mainIMDiv.inject(this.mainContainer[0])},insertTemplateSummaryViewInTriptych:function(){this.Templatecomponent=new m(o.get("widget"),{editMode:!0,onClose:function(){},onEnd:function(){}}),this.Templatecomponent.render(),this.Templatecomponent.refreshTemplateList(),this.elements.mainITDiv=n.createElement("div",{class:"mainITDiv"}),this.Templatecomponent.elements.body.inject(this.elements.mainITDiv),this.elements.mainITDiv.inject(this.mainContainer[0])},updateViewAfterLogin:function(){widget.getValue("IsIssueSummaryView")?(this.elements.header.show(),this.elements.triptychToolbar.removeClassName("isu-templateView"),this._loading&&this.destroyPlaceholder()):this.elements.mainIMDiv.hide()},_initializeIssueTemplateComponent:function(){this.insertTemplateSummaryViewInTriptych(),this.insertTemplateToolbarInTriptychToolbar()},showHideTemplateView:function(){widget.getValue("IsIssueSummaryView")?(this.elements.issueTemplateHeader.hide(),this.elements.mainITDiv.hide(),this.elements.infoIcon.classList.remove("issueTemplate")):(this.elements.infoIcon.classList.add("issueTemplate"),this.elements.triptychToolbar.addClassName("isu-templateView"),this._loading&&this.destroyPlaceholder())},insertTemplateToolbarInTriptychToolbar:function(){this.elements.issueTemplateHeader=document.getElementsByClassName("create-template-chooser-list-iconbar")[0],this.elements.issueTemplateHeader.inject(this.elements.triptychToolbar)},destroyPlaceholder:function(){null==this._loading&&null==this._loading||(this._placeholder.removeClassName("fade-in-element").addClassName("fade-out-element"),this._loading.destroy(),this._loading=null)},initializeTriptychMainContainer:function(){this.mainContainer=document.getElementsByClassName("triptych-main")},initializeTriptychToolbarContainer:function(){this.elements.triptychToolbar=document.getElementsByClassName("body-content")[0]}})}),define("DS/IssueManagement/models/TreeNodeModel",["UWA/Core","DS/IssueManagement/utils/customization/DataGridCellContent","DS/TreeModel/TreeNodeModel","DS/IssueServices/Contexts","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s){"use strict";function o(t){t=e.extend({id:"",physicalId:"",label:"",icons:[],grid:{},type:"",children:[],useAsyncPreExpand:!0,matchSearchNavigation:!1},t),this.listView=i.get("ISU_LISTVIEW"),this.listView&&null!=this.listView||this.updateGrid(t),n.call(this,t)}function a(e){e._getFilterInfo||(e.filterInChild=o.prototype.filterInChild.bind(e),e.filterOutChild=o.prototype.filterOutChild.bind(e),e._getFilterInfo=o.prototype._getFilterInfo.bind(e),e._getChildrenFilterInfo=o.prototype._getChildrenFilterInfo.bind(e),e._removeChildrenFilterInfo=o.prototype._removeChildrenFilterInfo.bind(e))}return o.prototype=Object.create(n.prototype),o.prototype.getOccurrencePath=function(t){if(e.is(t,"function")&&t(this),!this.isRoot()&&this.getParent()){var n=this.getParent().getOccurrencePath(t);return n.push(this.options.id),n.push(this.options.data.relationToIssue),n}return[this.options.id]},o.prototype.updateGrid=function(e){this.listView&&null!=this.listView||t.updateCellContentForGrid(e)},o.prototype.getNodesById=function(e){var t={listOfNodesFound:[]};return this._getNodesById(e,t),t.listOfNodesFound},o.prototype._getNodesById=function(e,t){var n=!1;if(this.options.id===e)t.listOfNodesFound.push(this),n=!0;else{var i=this.getChildren();if(i)for(var s=0;s<i.length;s++)n=i[s]._getNodesById(e,t)||n}return n},o.prototype.matchSearchNavigation=function(){this.options.matchSearchNavigation=!0},o.prototype.unmatchSearchNavigation=function(){this.options.matchSearchNavigation=!1},o.prototype.getID=function(){return this.options.id},o.prototype.filterOut=function(){var e=this.isRoot()?this.getTreeDocument():this.getParent();null!==e&&(a(e),e.filterOutChild(this))},o.prototype.filterOutChild=function(t){var n=this.getChildren();if(n.indexOf(t)<0)throw new Error("This is not a child");var i=this._getChildrenFilterInfo(!0);if(!i.childrenBeforeFiltering){i.childrenBeforeFiltering=n&&n.length>0?n.slice(0):[];e.is(this._expandState)&&(i.expandStateBeforeFiltering={noExpandState:"noChildren",expandingState:"expanding",partiallyExpandedState:"partiallyExpanded",collapseState:"expanded",expandState:"collapsed"}[this._expandState])}t._getFilterInfo(!0).parentBeforeFiltering=this,e.is(this.removeChild,"function")?this.removeChild(t):this.removeRoot(t,!0,!0),e.is(this.setState,"function")&&this.setState({state:i.expandStateBeforeFiltering}),i.filteredOutChildren||(i.filteredOutChildren=[]),i.filteredOutChildren.push(t)},o.prototype.filterIn=function(e){var t=this._getFilterInfo();if(t&&t.parentBeforeFiltering){var n=t.parentBeforeFiltering;a(n),n.filterInChild(this)}if(!0===e){var i=null,s=this._getChildrenFilterInfo();(i=s&&s.childrenBeforeFiltering?s.childrenBeforeFiltering:this.getChildren())&&Array.isArray(i)&&i.forEach(function(t){t.filterIn(e)})}},o.prototype.filterInChild=function(t){var n=this._getChildrenFilterInfo();if(n&&n.childrenBeforeFiltering){var i=n.childrenBeforeFiltering.indexOf(t);if(i>=0){var s=t._getFilterInfo();if(s&&s.parentBeforeFiltering===this){var o=this.getChildren(),a=null;if(o&&Array.isArray(o))for(var r=0;r<o.length;r++){var l=o[r];if(n.childrenBeforeFiltering.indexOf(l)>i){a=l;break}}delete s.parentBeforeFiltering,t.options&&t.options.isRootAttached?!0===t.options.isRootAttached&&this.insertBefore(t,a):this.insertBefore(t,a),e.is(this.setState,"function")&&this.setState({state:n.expandStateBeforeFiltering}),t._removeFilterInfo();var c=n.filteredOutChildren.indexOf(t);n.filteredOutChildren.splice(c,1),0===n.filteredOutChildren.length&&this._removeChildrenFilterInfo()}}}},o.prototype._removeFilterInfo=function(){delete this.options._filterInfo},o.prototype._removeChildrenFilterInfo=function(){delete this.options._childrenFilterInfo},o.prototype._getFilterInfo=function(e){return!this.options._filterInfo&&e&&(this.options._filterInfo={}),this.options._filterInfo},o.prototype._getChildrenFilterInfo=function(e){return!this.options._childrenFilterInfo&&e&&(this.options._childrenFilterInfo={}),this.options._childrenFilterInfo},o}),define("DS/IssueManagement/views/kanban/Keyboard",["UWA/Core","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/views/list/Keyboard","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],function(e,t,n,i,s){"use strict";var o="DS/IssueManagement/views/kanban/Keyboard",a=function(){return!(window.document.getElementsByClassName("wux-menu").length>0&&window.document.getElementsByClassName("wux-menu-container").length>0)};return{override:function(t){var n=this._addShouldWeProcessThisInputTrigger(t);return e.extend(n,this.commands)},_addShouldWeProcessThisInputTrigger:function(t){s.start(o+" _addShouldWeProcessThisInputTrigger");var n=e.clone(t);for(var i in t)!function(){if(t.hasOwnProperty(i)){var e=t[i];n[i]=function(){return!1===a()?null:e.apply(this,arguments)}}}();return s.end(o+" _addShouldWeProcessThisInputTrigger"),n},commands:{rightMove:function(){if(!1!==a()){s.start(o+" right");var t=i.get("component").getKanbanView();if(e.is(t.siblings.right,"object")){t.siblings.right.grid.elements.container.focus();var n=t.siblings.right.getTreeDocument().getRoots(!1);e.is(n[t.verticalLevelSelector],"object")?n[t.verticalLevelSelector].select():n.length>0&&n[n.length-1].select()}s.end(o+" right")}},leftMove:function(){if(!1!==a()){s.start(o+" left");var t=i.get("component").getKanbanView();if(e.is(t.siblings.left,"object")){t.siblings.left.grid.elements.container.focus();var n=t.siblings.left.getTreeDocument().getRoots(!1);e.is(n[t.verticalLevelSelector],"object")?n[t.verticalLevelSelector].select():n.length>0&&n[n.length-1].select()}s.end(o+" left")}},enter:e.clone(n["treelistview:edit-mode"]),escape:e.clone(n["treelistview:edit-cancel"]),copy:e.clone(n["treelistview:copy-node"]),deleteKeyPressed:e.clone(n["treelistview:delete-node"])}}}),define("DS/IssueManagement/components/idcard/IdCardModel",["UWA/Class/Promise","UWA/Class/View","UWA/Core","UWA/Class/Model","DS/CoreEvents/ModelEvents","DS/IssueManagement/components/idcard/IDCardHeaderAttributes","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a){return new i({name:"",thumbnail:"",description:"",withHomeButton:!1,withExpandCollapseButton:!1,withActionsButton:!0,withInformationButton:!1,withToggleMinifiedButton:!0,showBackButton:!1,minified:!1,modelEvents:new s,attributes:o.Default_Attr,customEvents:{homeIconClick:{event:"custom-show-landing-page-event"},expandCollapseIconClick:{event:"issue-idcard-panel-toggle"},informationIconClick:{event:"custom-information-icon-event"},configurationLabelClick:{event:"custom-show-configuration-event"},versionLabelClick:{event:"custom-show-version-explorer-event"},actionsMenuClick:{event:"issue-idcard-actions-menu-click"}}})}),define("DS/IssueManagement/views/kanban/TileList",["UWA/Core","DS/CollectionView/ResponsiveLargeTilesCollectionView","DS/IssueManagement/views/kanban/Keyboard"],function(e,t,n){"use strict";return t.inherit({_manageKeyboard:function(){this._parent();var t=n.override(this.commands);e.extend(this.commands,t)}})}),define("DS/IssueManagement/components/information/IssueHeader",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/Controls/TooltipModel","DS/WebappsUtils/WebappsUtils","DS/PlatformAPI/PlatformAPI","DS/Logger/Logger","DS/Menu/Menu","DS/ENOFloatingPanel/ENOFloatingPanel","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueCommon/utils/Utils","DS/IssueCommon/commands/CommandsManager","DS/IssueManagement/components/idcard/IssueIdcard","DS/IssueManagement/components/idcard/IdCardModel","DS/IssueManagement/components/idcard/IDCardHeaderAttributes","DS/IssueManagement/components/ContextualMenu","DS/IssueComponents/search/PeopleSearch","DS/SearchWidget/SearchWidgetConstant","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/PADUtils/views/PADAlert","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p,h,g,f,v,I,b,y,S,w,C,T){"use strict";var E={ISSUE_TYPE:"Issue",PLMNEW_ENABLEMENT:"PLMNewEnablement",CSS:{ELEMENTS:{COMPACT:"compact",MULTIPLE_SELECTION:"multiple-selection",PLACEHOLDER:"im-information-header-placeholder",PLACEHOLDER_IMAGE:"im-information-header-placeholder-image",PLACEHOLDER_CONTENT:"im-information-header-placeholder-content",IMAGE_CONTAINER:"im-information-header-image-ctn",TITLE_CONTAINER:"im-information-header-info-title",TITLE_CONTENT:"im-information-header-info-title-content",MENU_BUTTON:"im-information-header-info-title-menu-btn fonticon fonticon-2x fonticon-chevron-down",PREV_BUTTON:"im-information-header-info-title-prev-btn fonticon fonticon-2x fonticon-chevron-left",NEXT_BUTTON:"im-information-header-info-title-next-btn fonticon fonticon-2x fonticon-chevron-right",CLOSE_BUTTON:"im-information-header-info-title-close-btn wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-close",SUMMARY_CONTAINER:"im-information-header-info-summary",OWNER_CONTAINER:"im-information-header-info-owner",INFO_CONTAINER:"im-information-header-info-ctn",INFO_ELEMENT:"im-information-header-info-element",INFO_CONTEXTS:"im-information-header-info-contexts",INFO_REPORTEDAGAINST:"im-information-header-info-reportedagainst",INFO_RESOLVEDBY:"im-information-header-info-resolvedby",INFO_RESOLVEDITEMS:"im-information-header-info-resolvedItems",INFO_ASSIGNEES:"im-information-header-info-assignees",INFO_COMMENTS:"im-information-header-info-comments",INFO_ATTACHMENTS:"im-information-header-info-attachments",INFO_RESOLUTIONDATE:"im-information-header-info-resolutiondate",IMAGE:"im-information-header-image",STACK_IMAGES:"im-information-header-stack-images",STACK_ELEMENT:"im-information-header-stack-element"},DIMENSIONS:{MIN_WIDTH:420}},defaultImage:o.getWebappsAssetUrl("IssueManagement","icons/iconIssueThumbnail.png"),MAXIMUM_STACK_ELEMENTS_FOR_IMAGES:3};return t.extend({name:"DS/IssueManagement/components/information/WuxHeader",tagName:"div",className:"im-information-new-header",_logger:null,fields:{responsibleOrganization:null},values:{responsibleOrganization:null,responsibleOrganizationTitle:null},setup:function(t){var n=this;S.start(n.name+" setup"),n._parent(t),n._logger=r.getLogger(n.name),n._deferred={},n.isLoaded=new e(function(e,t){n._deferred.resolve=e,n._deferred.reject=t}),n.IssueIDCard={},n.physicalIds=[],n.customEvents=t.customEvents,n._eventListeners=[],S.end(n.name+" setup")},render:function(){var e=this;S.start(e.name+" render"),y.organizations.getCompanies({onComplete:function(t){e.organizations=t.body},onFailure:function(){e.organizations=[]}});var t=b.get("eventsHandler");e._subscriberId=Math.random().toString(36).substr(2,9),e._eventListeners=[{event:"DS/Object/update",listener:function(t){t.data.paths.length>0&&(t.data.paths.reduce(function(e,t){return e.push(t.pop()),e}).some(function(t){return-1!==e.physicalIds.indexOf(t)})&&e.refresh(e.physicalIds))},conditions:{type:"issue",attributes:["*","owner","contexts","reportedAgainst","resolvedBy","resolvedItems","assignees","attachments","state"]}}];for(var n=0;n<e._eventListeners.length;n++){var i=e._eventListeners[n];i.token=t.subscribe(e._subscriberId,i.event,i.listener.bind(e),i.conditions)}return S.end(e.name+" render"),e.IssueIDCard=new p({model:h}),e.IssueIDCard.renderView().inject(e.container),e.IssueIDCard.attachResizeSensor(),e._idCardSubscribers(),!0===widget.getValue("isIDCardCollapsed")?e.IssueIDCard.minify():e.IssueIDCard.expand(),e},refresh:function(t){var n=this,i=[];return n._deferred={},n.isLoaded=new e(function(e,t){n._deferred.resolve=e,n._deferred.reject=t}),n.physicalIds=t,0!=t.length?(i.push(n._refreshPrimaryImage(t)),i.push(n._refreshInfo(t))):t.length,e.all(i).then(function(){n.dispatchEvent("onRefresh"),n._deferred.resolve()}).catch(function(e){n._logger.error("Cannot refresh information header %o",e),n._deferred.reject(e)})},_refreshPrimaryImage:function(e){var t=this;return y.images.retrieve({data:{objects:e.map(function(e){return{physicalId:e}})}}).then(function(e){if(!Array.isArray(e.results))throw new Error("Unexpected response when retrieving images.");if(1===e.results.length){var i=e.results[0].body;n.is(i,"object")&&n.is(i.url,"string")&&""!==i.url?t.IssueIDCard.model.set("thumbnail",i.url):t.IssueIDCard.model.set("thumbnail",E.defaultImage)}else e.results.length>1&&t.IssueIDCard.model.set("thumbnail",E.defaultImage)}).catch(function(e){t._logger.error("Cannot retrieve the images: %o",e)})},_refreshInfo:function(t){var n=this,i=[],s=y.issues.retrieve({data:{objects:t.map(function(e){return{physicalId:e}})}}).then(function(e){if(Array.isArray(e.results)){if(b.get(E.PLMNEW_ENABLEMENT)&&1==e.results.length)if("Create"==e.results[0].body.state){let e=g.PLMNew_DraftState;n.IssueIDCard.model.set("attributes",e)}else{let e=g.Default_Attr;n.IssueIDCard.model.set("attributes",e)}if(n._setHeaderValues(e.results),1===e.results.length){let t=e.results[0].body,i=t.reportedAgainst.length;i+=t.resolvedBy.length,i+=t.resolvedItems.length,i+=t.contexts.length;let s=n._getMembersCount(t);n.customEvents.publish({event:"im-update-tab-count",data:{tabs:["relatedObjects","team"],count:[i,s]}})}}}).catch(function(e){n._logger.error("Cannot retrieve the info: %o",e)});return i.push(s),1==t.length?(y.comments.retrieve({data:{physicalId:t[0]}}).then(function(e){var t=0;try{t=e.body.result.nbComments}catch(e){t=0}u.isInteger(t)||(t=0),n.customEvents.publish({event:"im-update-tab-count",data:{tabs:["comments"],count:[t]}})}),d.getDocumentsFrom(t[0]).then(function(e){var t=0;try{t=e.attachments.length}catch(e){t=0}u.isInteger(t)||(t=0),n.customEvents.publish({event:"im-update-tab-count",data:{tabs:["attachments"],count:[t]}})})):n.customEvents.publish({event:"im-update-tab-count",data:{tabs:["relatedObjects","team","comments","attachments"],count:["","","",""]}}),e.all(i)},resize:function(){var e=this;setTimeout(()=>{e.container.toggleClassName(E.CSS.ELEMENTS.COMPACT,e.container.getParent()&&e.container.getParent().offsetWidth<E.CSS.DIMENSIONS.MIN_WIDTH),e.IssueIDCard.resize()},200)},destroy:function(){if(this.physicalIds=[],Array.isArray(this._eventListeners))for(var e=0;e<this._eventListeners.length;e++){var t=this._eventListeners[e];b.get("eventsHandler").unsubscribe(t.token)}this._eventListeners=[],this.container.empty()},_publishUpdate:function(e,t){for(var n=[],i={},s=0;s<e.length;s++)n.push([e[s].physicalId]),i[e[s].physicalId]={id:e[s].physicalId,type:"Issue",modifiedAttributes:Array.isArray(t)?["state"].concat(t):["state"]};b.get("eventsHandler").publish(this._subscriberId,"DS/Object/update",{metadata:{appId:b.get("widget").id,appName:b.get("widget").name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:n,attributes:i},version:"1.0"})},_scrollToNextNode:function(e){e.options.baseType===E.ISSUE_TYPE&&(this.currentSelectedIssue=e);var t=b.get("component").getTreeListView();if(n.is(t,"object")){var i=t.getManager();if(n.is(i,"object")){var s=e.getNextVisibleNode();if(s)if(s.options.baseType===E.ISSUE_TYPE){this.listView?i._goToNode(e,1):(this.currentSelectedIssue&&this.currentSelectedIssue.unselect(),s.select());var o=b.get("component").getTreeDocument();o.prepareBroadcastSelect(),o.pushBroadcastSelect()}else this._scrollToNextNode(s)}}},_scrollToPreviousNode:function(e){e.options.baseType===E.ISSUE_TYPE&&(this.currentSelectedIssue=e);var t=b.get("component").getTreeListView();if(n.is(t,"object")){var i=t.getManager();if(n.is(i,"object")){var s=e.getPreviousVisibleNode();if(s)if(s.options.baseType===E.ISSUE_TYPE){this.listView?i._goToNode(e,-1):(this.currentSelectedIssue&&this.currentSelectedIssue.unselect(),s.select());var o=b.get("component").getTreeDocument();o.prepareBroadcastSelect(),o.pushBroadcastSelect()}else this._scrollToPreviousNode(s)}}},_setHeaderValues:function(e){let t={title:"",priority:C.information.header.Varies,owner:{fullName:C.information.header.Varies,isVaries:!0},maturityState:{value:C.information.header.Varies,isVaries:!0},collaborativeSpace:{value:C.information.header.Varies,isVaries:!0},resolutionDate:C.information.header.Varies,modified:C.information.header.Varies,responsibleOrg:{value:C.information.header.Varies,isVaries:!0},reportingOrg:{value:C.information.header.Varies,isVaries:!0},completionType:{value:C.information.header.Varies,isVaries:!0}};if(e.length>1){let n=e.length;t.title=C.replace(C.information.header.multipleSelection.title,{number:n});let i=e[0].body,s=i.owner.fullName,o=i.state,a=i.priority,r=i.collaborativeSpaceTitle?i.collaborativeSpaceTitle:i.collaborativeSpace,l=i.responsibleOrganizationTitle,c=i.resolutionDate,d=i.reportingOrganizationTitle,m=i.completionType;e.every(e=>e.body.owner.fullName==s)&&(t.owner.fullName=s,t.owner.isVaries=!1),e.every(e=>e.body.priority==a)&&(t.priority=a),e.every(e=>e.body.state==o)&&(t.maturityState.value=r,t.maturityState.isVaries=!1);for(let n=0;n<e.length;n++){if((e[n].body.collaborativeSpaceTitle?e[n].body.collaborativeSpaceTitle:e[n].body.collaborativeSpace)!=r){t.collaborativeSpace.value=C.information.header.Varies,t.collaborativeSpace.isVaries=!0;break}t.collaborativeSpace.value=r,t.collaborativeSpace.isVaries=!1}if(e.every(e=>e.body.responsibleOrganizationTitle==l)&&(t.responsibleOrg.value=l,t.responsibleOrg.isVaries=!1),e.every(e=>e.body.reportingOrganizationTitle==d)&&(t.reportingOrg.value=d,t.reportingOrg.isVaries=!1),e.every(e=>e.body.completionType==m)&&(t.completionType.value=C[m],t.completionType.isVaries=!1),e.every(e=>e.body.resolutionDate==c)){t.resolutionDate=c;u.getFormattedDate(t,{year:"numeric",month:"numeric",day:"numeric"})}else t.resolutionDate=t.resolutionDate;this.IssueIDCard.setAttributeValue("duedate",t.resolutionDate,!0),this.IssueIDCard.setAttributeValue("modifiedDate",t.modified,!0),this.IssueIDCard.setAttributeValue("completionType",t.completionType.value,t.completionType.isVaries)}else if(1==e.length){let n=e[0].body;t.title=`${n.title}`,t.priority=n.priority,t.maturityState=n.state,t.owner.fullName=n.owner.fullName,t.owner.isVaries=!1,t.collaborativeSpace.value=n.collaborativeSpaceTitle?n.collaborativeSpaceTitle:n.collaborativeSpace,t.collaborativeSpace.isVaries=!1,t.resolutionDate=n.resolutionDate,t.modified=n.modified,t.completionType=C[n.completionType],""!=n.responsibleOrganizationTitle?t.responsibleOrg.value=n.responsibleOrganizationTitle:t.responsibleOrg.value=n.responsibleOrganization,t.responsibleOrg.isVaries=!1,""!=n.reportingOrganizationTitle?t.reportingOrg.value=n.reportingOrganizationTitle:t.reportingOrg.value=n.reportingOrganization,t.reportingOrg.isVaries=!1;u.getFormattedDate(t,{year:"numeric",month:"numeric",day:"numeric"});this.IssueIDCard.setAttributeValue("modifiedDate",t.modified,!1),this.IssueIDCard.setAttributeValue("duedate",t.resolutionDate),this.IssueIDCard.setAttributeValue("completionType",t.completionType,t.completionType.isVaries),this.IssueIDCard.model.set("state",t.maturityState)}else e.length;this.IssueIDCard.model.set("name",t.title),this.IssueIDCard.setAttributeValue("owner",t.owner.fullName,t.owner.isVaries),this.IssueIDCard.setAttributeValue("collabspace",t.collaborativeSpace.value,t.collaborativeSpace.isVaries),this.IssueIDCard.setAttributeValue("responsibleOrg",t.responsibleOrg.value,t.responsibleOrg.isVaries),this.IssueIDCard.setAttributeValue("reportingOrg",t.reportingOrg.value,t.reportingOrg.isVaries),this.IssueIDCard.setAttributeValue("priority",t.priority);let n=e.map(e=>({physicalId:e.body.physicalId,state:e.body.state,owners:[e.body.owner,...e.body.coOwners],assignees:e.body.assignees,assigneeFromUG:e.body.assigneeFromUsersGroup}));this.IssueIDCard.displayMaturity(n)},_idCardSubscribers:function(){var e=this;a.subscribe("Lifecycle.Modification",function(t){var n=JSON.parse(t).Refresh.modified;if(Array.isArray(n)){var i=n.reduce((e,t)=>(e["Issue"==t.policy?"issuesPhysicalIds":"objectsPhysicalIds"].push(t),e),{issuesPhysicalIds:[],objectsPhysicalIds:[]}),s=i.issuesPhysicalIds,o=i.objectsPhysicalIds;if(s.length>0){let t=[],n=[];s.forEach(e=>{t.push(e.physicalid),n.push({physicalId:e.physicalid})}),e.refresh(t),e._publishUpdate(n)}var a=o.filter(e=>null!=e.policy);a.length>0&&e.updateObjectNode(a)}}),e.IssueIDCard.modelEvents.subscribe({event:"issue-idcard-nav-prev"},function(){var t=b.get("component").getTreeListView();if(e.listView=b.get("ISU_LISTVIEW"),n.is(t,"object")){var i=t.getManager();if(n.is(i,"object")){var s="";s=e.listView?i.getActiveNode():i.getTreeDocument().getSelectedNodes()[0],e._scrollToPreviousNode(s)}}}),e.IssueIDCard.modelEvents.subscribe({event:"issue-idcard-nav-next"},function(){var t=b.get("component").getTreeListView();if(e.listView=b.get("ISU_LISTVIEW"),n.is(t,"object")){var i=t.getManager();if(n.is(i,"object")){var s="";s=e.listView?i.getActiveNode():i.getTreeDocument().getSelectedNodes()[0],e._scrollToNextNode(s)}}}),e.IssueIDCard.modelEvents.subscribe({event:"issue-idcard-nav-close"},function(e){m.getCommand("ToggleInformationPanel").begin({open:!1,save:!0})});var t=!1;e.IssueIDCard.modelEvents.subscribe({event:"idcard-expanded"},function(n){e.dispatchEvent("request:resizeContent",{state:"expanded"}),t=!1,widget.setValue("isIDCardCollapsed",t)}),e.IssueIDCard.modelEvents.subscribe({event:"idcard-minified"},function(n){e.dispatchEvent("request:resizeContent",{state:"minified"}),t=!0,widget.setValue("isIDCardCollapsed",t)}),e.IssueIDCard.modelEvents.subscribe({event:"issue-idcard-actions-menu-click"},function(t){var n=e.IssueIDCard.container.getElement(".actions-menu-icon").getBoundingClientRect(),i={position:{x:n.left,y:n.top+20}};f.getContextualMenu().then(function(e){l.show(e,i)})}),e.IssueIDCard.modelEvents.subscribe({event:"idcard-attributes-clicked"},function(t){if(n.is(t.index,"number"))switch(t.index){case 0:break;case 1:m.getCommand("ChangeOwner").begin();try{var i=b.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"IDCard",pd4:"ChangeOwner",pd5:"Issue/"+i+"/IDCard/ChangeOwner"}})}catch(e){}break;case 2:m.getCommand("Move").begin();try{i=b.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"IDCard",pd4:"Move",pd5:"Issue/"+i+"/IDCard/Move"}})}catch(e){}break;case 6:if(1==e.physicalIds.length){e.changeResponsibleOrg();try{i=b.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"IDCard",pd4:"ResponsibleOrganisation",pd5:"Issue/"+i+"/IDCard/ResponsibleOrganisation"}})}catch(e){}}break;case 7:if(1==e.physicalIds.length&&b.get(E.PLMNEW_ENABLEMENT)&&"Create"==e.IssueIDCard.model.get("state")){e.changeReportingOrg();try{i=b.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"IDCard",pd4:"ReportingOrganisation",pd5:"Issue/"+i+"/IDCard/ReportingOrganisation"}})}catch(e){}}break;case 8:break;default:e.dispatchEvent("request:switchFacet",{facetName:"properties"})}}),e.IssueIDCard.modelEvents.subscribe({event:"idcard-thumbnail-clicked"},function(e){if(1==b.get("component").getSelectedNodes().length){m.getCommand("AttachmentManager").begin();try{var t=b.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:t,pd3:"IDCard",pd4:"IssueIconAttachmentManager",pd5:"Issue/"+t+"/IDCard/IssueIconAttachmentManager"}})}catch(e){}}}),e.IssueIDCard.modelEvents.subscribe({event:"issue-idcard-maturity-update"},function(t){let n=e.physicalIds.map(e=>({physicalId:e}));e._publishUpdate(n)}),e.IssueIDCard.modelEvents.subscribe({event:"issue-idcard-responsibleOrg-update"},function(t){let n=e.physicalIds.map(e=>({physicalId:e}));var i=[[n[0].physicalId]],s={};s[n[0].physicalId]={id:n[0].physicalId,type:"Issue",modifiedAttributes:["responsibleOrg"]},a.publish("DS/Object/update",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now())},data:{paths:i,attributes:s},version:"1.0"})}),e.IssueIDCard.modelEvents.subscribe({event:"issue-idcard-reportingOrg-update"},function(t){let n=e.physicalIds.map(e=>({physicalId:e}));var i=[[n[0].physicalId]],s={};s[n[0].physicalId]={id:n[0].physicalId,type:"Issue",modifiedAttributes:["reportingOrg"]},a.publish("DS/Object/update",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now())},data:{paths:i,attributes:s},version:"1.0"})}),e.IssueIDCard.modelEvents.subscribe({event:"onApprovalCompleted"},function(t){var n=t.issues.map(function(e){return e.physicalId});1===n.length&&e._refreshInfo(n),e._refreshPrimaryImage(n),e._publishUpdate(t.issues,t.modifiedAttributes);try{var i=b.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"IDCard",pd4:"Maturity",pd5:"Issue/"+i+"/IDCard/Maturity"}})}catch(e){}}),e.IssueIDCard.modelEvents.subscribe({event:"onRejectionCompleted"},function(t){var n=t.issues.map(function(e){return e.physicalId});1===n.length&&e._refreshInfo(n),e._refreshPrimaryImage(n),e._publishUpdate(t.issues,t.modifiedAttributes);try{var i=b.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"IDCard",pd4:"Maturity",pd5:"Issue/"+i+"/IDCard/Maturity"}})}catch(e){}}),e.IssueIDCard.modelEvents.subscribe({event:"issue-idcard-maturity-history-click"},function(t){e.dispatchEvent("request:switchFacet",{facetName:"history"})}),e.IssueIDCard.modelEvents.subscribe({event:"refresh-issue-header"},function(t){e.refresh(e.physicalIds);let n=e.physicalIds.map(e=>({physicalId:e}));e._publishUpdate(n)})},_getMembersCount:function(e){let t=new Set;return t.add(e.owner.user),e.assignees.map(e=>{t.add(e.user)}),e.contributors.map(e=>{t.add(e.user)}),e.coOwners.map(e=>{t.add(e.user)}),e.informedUsers.map(e=>{t.add(e.user)}),t.size},changeResponsibleOrg:function(){var e,t=this;t.moveButton;var o=t.IssueIDCard.model.get("attributes").find(e=>"responsibleOrg"==e.id);e=new c({animate:!0,autocenter:!0,closable:!0,limitParent:!0,overlay:!0,resizable:!0,visible:!0,className:"confirm-select-in-3d-dialog",title:C.information.header.moveResponsibleOrg,header:null,body:n.createElement("div",{class:"idcard-form-element idcard-form-element-responsible-organization",html:[{tag:"div",class:"idcard-form-field form-group",html:[{tag:"h5",html:C.information.header.changeResponsibleOrg},{tag:"div",html:[t.fields.addResponsibleOrganization=t._orgSearch("responsibleOrganization"),t.fields.responsibleOrganization=n.createElement("div",{class:"idcard-responsible-organization-holder"}),t.fields.responsibleOrganization.responsibleOrganizationHelper=n.createElement("div",{html:[n.createElement("span",{class:"fonticon fonticon-help"})]})]}]},{tag:"div",class:"idcard-form-help-tooltip",html:[t.fields.responsibleOrganization.responsibleOrganizationHelper]}]}),footer:[t.moveButton=new i({value:C.information.header.move,className:"primary",disabled:!0,events:{onClick:function(){y.issues.update({data:{objects:[{physicalId:t.physicalIds[0],responsibleOrganization:t.values.responsibleOrganization}]},onComplete:function(e){w.displayNotification({msg:C.information.header.moveOrgMsg,eventID:"info"}),o.value=t.values.responsibleOrganizationTitle,t.IssueIDCard.modelEvents.publish({event:"issue-idcard-responsibleOrg-update",data:{}})},onFailure:function(e){if(e.error&&(e.error.internal.includes("You do not have the permissions to perform this action")||e.error.internal.includes("The issue is closed, you cannot update it"))){var t=u.getErrorMessage("1500167_2");u.displayErrorMessage(t,"error")}else w.displayNotification({msg:e.error.message,eventID:"error"})}}),setTimeout(function(){e.destroy(),e=null},100)}}}),new i({value:C.information.header.cancel,className:"default",events:{onClick:function(){setTimeout(function(){e.destroy(),e=null},100)}}})],events:{onClose:function(){setTimeout(function(){e.destroy(),e=null},100)}}}).inject(widget.body),t._setOrganization(o.value,"responsibleOrganization",!1),t.fields.responsibleOrganization.responsibleOrganizationHelper.tooltipInfos=new s({shortHelp:T.create.team.labels.responsibleOrganizationHelper})},changeReportingOrg:function(){var e,t=this;t.moveButton;var o=t.IssueIDCard.model.get("attributes").find(e=>"reportingOrg"==e.id);e=new c({animate:!0,autocenter:!0,closable:!0,limitParent:!0,overlay:!0,resizable:!0,visible:!0,className:"confirm-select-in-3d-dialog",title:C.information.header.moveReportingOrg,header:null,body:n.createElement("div",{class:"idcard-form-element idcard-form-element-responsible-organization",html:[{tag:"div",class:"idcard-form-field form-group",html:[{tag:"h5",html:C.information.header.changeReportingOrg},{tag:"div",html:[t.fields.addReportingOrganization=t._orgSearch("reportingOrganization"),t.fields.reportingOrganization=n.createElement("div",{class:"idcard-responsible-organization-holder"}),t.fields.reportingOrganization.reportingOrganizationHelper=n.createElement("div",{html:[n.createElement("span",{class:"fonticon fonticon-help"})]})]}]},{tag:"div",class:"idcard-form-help-tooltip",html:[t.fields.reportingOrganization.reportingOrganizationHelper]}]}),footer:[t.moveButton=new i({value:C.information.header.move,className:"primary",disabled:!0,events:{onClick:function(){y.issues.update({data:{objects:[{physicalId:t.physicalIds[0],reportingOrganization:t.values.reportingOrganization}]},onComplete:function(e){w.displayNotification({msg:C.information.header.moveReportingOrgMsg,eventID:"info"}),o.value=t.values.reportingOrganizationTitle,t.IssueIDCard.modelEvents.publish({event:"issue-idcard-reportingOrg-update",data:{}})},onFailure:function(e){w.displayNotification({msg:e.error.message,eventID:"error"})}}),setTimeout(function(){e.destroy(),e=null},100)}}}),new i({value:C.information.header.cancel,className:"default",events:{onClick:function(){setTimeout(function(){e.destroy(),e=null},100)}}})],events:{onClose:function(){setTimeout(function(){e.destroy(),e=null},100)}}}).inject(widget.body),t._setOrganization(o.value,"reportingOrganization",!1),t.fields.reportingOrganization.reportingOrganizationHelper.tooltipInfos=new s({shortHelp:T.create.team.labels.reportingOrganizationHelper})},_orgSearch:function(e){var t=this,n=new v({className:"searchPeople_TransferOwnership",MaxNumber:"5",MaxSize:"300",position:"auto",showEmptyCategory:!1,type:I.TYPE_ORGANIZATION,events:{onValid:function(){var i=n.getNewOwner().organization;t._setOrganization(i.orgID,e,i.orgTitle,!0),n.clearInput(),n.getContent().searchInput.focus()},onUnvalid:function(){},onError:function(){w.displayNotification({msg:T.team.error.orgNotFound,eventID:"info"})}}});return n.setSelectedItemList([{objectID:t.organizations[0].physicalId}]),n},_setOrganization:function(e,t,i,s){if(!n.is(i)||""==i){i=e;var o=b.get(E.BASE_NLS);n.is(o)&&n.is(o["ds6w:organizationResponsible"][e])&&(i=o["ds6w:organizationResponsible"][e])}var a=n.createElement("div",{class:"idcard-content-org-container",html:[n.createElement("span",{class:"idcard-content-org-icon fonticon view-icon fonticon-users"}),n.createElement("span",{class:"idcard-content-org-info",html:u.getTextFromHTML(i)})]});s&&this.moveButton.setDisabled(!1),this.fields[t].empty(),this.fields[t].appendChild(a),"responsibleOrganization"==t?(this.values.responsibleOrganization=e,this.values.responsibleOrganizationTitle=i):"reportingOrganization"==t&&(this.values.reportingOrganization=e,this.values.reportingOrganizationTitle=i)},_setReportingOrganization:function(e,t,i,s){if(!n.is(i)||""==i){i=e;var o=b.get(E.BASE_NLS);n.is(o)&&n.is(o["ds6w:organizationResponsible"][e])&&(i=o["ds6w:organizationResponsible"][e])}var a=n.createElement("div",{class:"idcard-content-org-container",html:[n.createElement("span",{class:"idcard-content-org-icon fonticon view-icon fonticon-users"}),n.createElement("span",{class:"idcard-content-org-info",html:u.getTextFromHTML(i)})]});s&&this.moveButton.setDisabled(!1),this.fields[t].empty(),this.fields[t].appendChild(a),this.values.reportingOrganization=e,this.values.reportingOrganizationTitle=i},updateObjectNode:function(e){var t=b.get("component").getSelectedNodes(),i=[];e.forEach(e=>{null!=e.policy&&(e.maturity=e.policy+"."+e.state,i.push(e.maturity))});var s={"ds6w:status":i};y.getNLSValuesPromise(s).then(i=>{if(n.is(i["ds6w:status"])){var s=Object.values(i["ds6w:status"])[0],o=Object.keys(i["ds6w:status"])[0];t.filter(t=>e.some(e=>t.options.physicalId.includes(e.physicalid))).forEach(e=>{e.updateOptions({state:o,grid:{"ds6w:state":s}})})}})}})}),define("DS/IssueManagement/components/information/Information",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/ENO6WPlugins/jQuery","DS/ExternalComponents/jQueryUI","DS/Logger/Logger","DS/CoreEvents/ModelEvents","DS/IssueManagement/components/information/Content","DS/IssueManagement/components/information/IssueHeader","DS/IssueManagement/components/information/Header","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","DS/IssueManagement/components/header/IssueToolbarActions","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p){"use strict";var h=!0,g="Issue",f={RIGHT:"right",BOTTOM:"bottom",CLOSED:"closed"},v={ELEMENTS:{INNER:"im-information-inner",NO_SELECTION_PLACEHOLDER:"im-information-no-selection-placeholder",FULLSCREEN_INDICATOR_RESIZING:"im-information-fullscreen-indicator-resizing",NO_SELECTION_PLACEHOLDER_TEXT:"im-information-no-selection-middleText"},LAYOUTS:{RIGHT:"layout-right",BOTTOM:"layout-bottom",CLOSED:"layout-closed"},DIMENSIONS:{RIGHT_LAYOUT:{DEFAULT_WIDTH:430,MIN_WIDTH:430},BOTTOM_LAYOUT:{DEFAULT_HEIGHT:400,MIN_HEIGHT:400},MINIMUM_REMAINING_HEIGHT:75,MINIMUM_REMAINING_WIDTH:260,MVHAW:260},STATUS:{NO_SELECTION:"no-selection",MULTI_SELECTION:"multi-selection"}};return t.extend({name:"DS/IssueManagement/components/information/Information",tagName:"div",className:"im-information-component",_logger:null,layout:{current:f.RIGHT,width:v.DIMENSIONS.RIGHT_LAYOUT.DEFAULT_WIDTH,height:v.DIMENSIONS.BOTTOM_LAYOUT.DEFAULT_HEIGHT},elements:{inner:null,placeholder:null},physicalIds:[],resizer:null,header:null,content:null,fullscreenWidth:!1,fullScreenMode:!1,_isOpened:!1,_subscriberId:"",_subscriberTokens:[],previousPhysicalIds:[],setup:function(e){u.start(this.name+" setup"),this._parent(e),this._logger=o.getLogger(this.name);var t=this.getPreferences();t.current!==f.RIGHT&&t.current!==f.BOTTOM&&(t.current=f.RIGHT,this.setPreferences({current:t.current})),this._isOpened=t.isOpened||!1,this.layout={current:t.current||f.RIGHT,isOpened:this.isOpened,width:t.width||v.DIMENSIONS.RIGHT_LAYOUT.DEFAULT_WIDTH,height:t.height||v.DIMENSIONS.BOTTOM_LAYOUT.DEFAULT_HEIGHT},this.elements={inner:null,placeholder:null},this.physicalIds=[],this.resizer=null,this._subscriberId=Math.random().toString(36).substr(2,9),this._subscriberTokens=[],this._subscribers(),u.end(this.name+" setup")},render:function(e){return this._applicationChannel=e,u.start(this.name+" render"),this.elements.inner=n.createElement("div",{class:v.ELEMENTS.INNER}),this.elements.inner.inject(this.container),this.elements.placeholder=this.utils.placeholder.bind(this)(),this.elements.placeholder.inject(this.elements.inner),this.customModelEvents=new a,this.header=h?new l({customEvents:this.customModelEvents}):new c({customEvents:this.customModelEvents}),this.header.render().inject(this.elements.inner),this._listenToHeader(),this.content=new r({customEvents:this.customModelEvents}),this.content.render().inject(this.elements.inner),this.container.toggleClassName(v.STATUS.NO_SELECTION,!0),this.container.toggleClassName(v.STATUS.MULTI_SELECTION,!1),this._resizable(),u.end(this.name+" render"),this},refreshInfo:function(e,t){widget.setValue("infoIsOpened",!0);var n=this;e&&(n.physicalIds=e);var i=1==t,s=n.content.getCurrentFacet().name;(widget.getValue("isOpened")&&!function(){if(n.previousPhysicalIds.length!==n.physicalIds.length)return!1;for(var e=0;e<n.previousPhysicalIds.length;e++)if(!1===n.physicalIds.includes(n.previousPhysicalIds[e]))return!1;return!0}()||widget.getValue("isOpened")&&"properties"==s||widget.getValue("isOpened")&&1==i)&&(n.refresh(n.physicalIds),n.resize(),n.previousPhysicalIds=n.physicalIds)},refresh:function(t){var n=this;Array.isArray(t)&&(n.physicalIds=t),n.container.toggleClassName(v.STATUS.NO_SELECTION,0===n.physicalIds.length),n.container.toggleClassName(v.STATUS.MULTI_SELECTION,n.physicalIds.length>1);var i=[n.header.refresh(n.physicalIds),n.content.refresh(n.physicalIds,{force:!0})];return e.all(i).then(function(){n.dispatchEvent("onRefresh")})},resize:function(){var e=this.container.getParent();if(this.container&&e){var t=e.getElementsByClassName("im-layout")[0],n=document.getElementsByClassName("im-information-component")[0];if(this.layout.current===f.RIGHT)n.addClassName("im-right");else if(this.layout.current===f.BOTTOM){n.removeClassName("im-right");var i=this.container.offsetHeight,s=e.offsetHeight;widget.body.offsetHeight>=v.DIMENSIONS.MVHAW&&i>s-v.DIMENSIONS.MINIMUM_REMAINING_HEIGHT?(this.container.setStyle("height",s-v.DIMENSIONS.MINIMUM_REMAINING_HEIGHT),t.setStyle("bottom",s-v.DIMENSIONS.MINIMUM_REMAINING_HEIGHT)):t.setStyle("bottom",i),this.container.style.top=""}this.header.resize(),this.content.resize(),m.resize(),d.get("component").resize()}},destroy:function(){this._subscriberTokens.forEach(function(e){d.get("eventsHandler").unsubscribe(e)}),this._subscriberTokens=[],this._subscriberId="",this.layout={current:f.RIGHT,isOpened:!1,width:v.DIMENSIONS.RIGHT_LAYOUT.DEFAULT_WIDTH,height:v.DIMENSIONS.BOTTOM_LAYOUT.DEFAULT_HEIGHT},this.elements={inner:null,placeholder:null},this.physicalIds=[],i(this.container).resizable("destroy"),this.resizer=null,this.header.destroy(),this.header=null,this.content.destroy(),this.content=null,this.container.empty()},setLayout:function(e){e!==f.RIGHT&&e!==f.BOTTOM||(this.layout.current=e,this.setPreferences({current:e}),widget.getValue("isOpened")&&this.open())},open:function(e){var t=this,n=t.container.getParent(),i=t.getPreferences();if(widget.getValue("isOpened")&&i.current!=widget.getValue("currentLayout"))return widget.setValue("infoPanelLayout",widget.getValue("currentLayout")),widget.setValue("isOpened",!1),widget.setValue("fromLayoutChange",!0),t._applicationChannel.publish({event:"information-panel-close"}),widget.setValue("infoPanelLayout",i.current),void t._applicationChannel.publish({event:"information-panel-open"});if(t.layout.current===f.RIGHT)widget.setValue("isOpened",!0),widget.setValue("currentLayout","right");else if(t.layout.current===f.BOTTOM){if(widget.setValue("isOpened",!0),t.layout.height=i.height||v.DIMENSIONS.BOTTOM_LAYOUT.DEFAULT_HEIGHT,t.container.setStyles({width:"100%",height:t.layout.height}),n){n.addClassName(v.LAYOUTS.BOTTOM);var s=n.getElementsByClassName("im-layout")[0];null==s&&null==s||(s.addClassName("im-right-layout-closed"),s.setStyle("right",0),s.removeClassName("im-bottom-layout-closed"))}widget.setValue("currentLayout","bottom"),widget.setValue("infoPanelLayout","bottom"),widget.getValue("isOpened")&&t._applicationChannel.publish({event:"information-panel-visible",data:null})}t._isOpened=!0,t.resize(),t.makeSelectedFacetVisible(),widget.getValue("contentFacet")&&(t.switchFacet("relatedObjects"),widget.setValue("contentFacet",!1)),t.setPreferences({isOpened:!0}),t._applicationChannel.subscribe({event:"resize-summary-view"},function(){setTimeout(()=>{t.content.resize(),d.get("component").resize()},320)})},close:function(e){var t=this.container.getParent(),n=t.getElementsByClassName("im-layout")[0];null==n&&null==n||(n.addClassName("im-right-layout-closed"),n.addClassName("im-bottom-layout-closed"),n.setStyle("right",0),n.setStyle("bottom",0)),this.container.setStyles({width:0,height:0}),t.addClassName(v.LAYOUTS.CLOSED),this.layout.width=0,this.layout.height=0,this._isOpened=!1,d.get("component").resize(),m.resize(),this.setPreferences({isOpened:!1}),widget.setValue("isOpened",!1),this._applicationChannel.publish({event:"triptych-panel-hidden",data:"right"})},toggle:function(e,t){widget.getValue("fromDataGridDoubleClick")&&(widget.setValue("fromDataGridDoubleClick",!1),widget.getValue("isOpened")?widget.getValue("isOpened")&&!widget.getValue("contentFacet")?this._applicationChannel.publish({event:"information-panel-close"}):widget.getValue("isOpened")&&widget.getValue("contentFacet")&&this.switchFacet("relatedObjects"):this._applicationChannel.publish({event:"information-panel-open"})),0==e&&1==t&&this._applicationChannel.publish({event:"information-panel-close"})},switchFacet:function(e){return this.content.switchFacet(e)},setPreferences:function(e){var t=d.get("widget")||window.widget;e&&n.is(e.isOpened,"boolean")&&t.setValue("infoIsOpened",e.isOpened),e&&n.is(e.current,"string")&&t.setValue("infoLayout",e.current),e&&n.is(e.width,"number")&&t.setValue("infoLayoutRightWidth",e.width),e&&n.is(e.height,"number")&&t.setValue("infoLayoutBottomHeight",e.height)},getPreferences:function(){var e=d.get("widget")||window.widget;return{current:n.is(e.getValue("infoLayout"),"string")?e.getValue("infoLayout"):f.RIGHT,isOpened:!!n.is(e.getValue("infoIsOpened"),"boolean")&&e.getValue("infoIsOpened"),width:e.getValue("infoLayoutRightWidth"),height:e.getValue("infoLayoutBottomHeight")}},getLayout:function(){return this.layout},getInformationHeader:function(){return this.header},getInformationContent:function(){return this.content},isOpened:function(){return this._isOpened},_resizable:function(){var e=this;e.resizer=i(e.container).resizable({handles:"n, w",helper:"ui-resizable-helper-information-left",minWidth:v.DIMENSIONS.RIGHT_LAYOUT.MIN_WIDTH,minHeight:v.DIMENSIONS.BOTTOM_LAYOUT.MIN_HEIGHT,start:function(t,s){if(e.fullScreenMode=!1,e.layout.current===f.RIGHT){var o=document.querySelector(".ui-resizable-helper-information-left");o&&(o.getElementsByClassName(v.ELEMENTS.FULLSCREEN_INDICATOR_RESIZING).length||(e.elements.fullscreenIndicator=n.createElement("div",{class:v.ELEMENTS.FULLSCREEN_INDICATOR_RESIZING}),n.createElement("span",{class:"fonticon fonticon-2x fonticon-move-to-start"}).inject(e.elements.fullscreenIndicator),e.elements.fullscreenIndicator.inject(o))),s.helper[s.helper.length-1].setAttribute("class","ui-resizable-helper-information-left");var a=e.container.getParent().offsetWidth;i(e.container).resizable("option","maxWidth",a)}else if(e.layout.current===f.BOTTOM){s.helper[s.helper.length-1].setAttribute("class","ui-resizable-helper-information-top");var r=e.container.getParent().offsetHeight;i(e.container).resizable("option","maxHeight",r-v.DIMENSIONS.MINIMUM_REMAINING_HEIGHT)}e.container.getParent().addClassName("information-panel-resizing")},resize:function(t){if(e.layout.current===f.RIGHT){e.fullscreenWidth=!!e.fullScreenMode||t.clientX>=0&&t.clientX<=260;var n=document.querySelector("."+v.ELEMENTS.FULLSCREEN_INDICATOR_RESIZING);n&&n.toggleClassName("visible",e.fullscreenWidth)}},stop:function(t,n){e.container.getParent().removeClassName("information-panel-resizing"),e.layout.current===f.RIGHT?(e.layout.width=n.size.width,e.setPreferences({width:e.layout.width})):e.layout.current===f.BOTTOM&&(e.layout.height=n.size.height,e.setPreferences({height:e.layout.height})),e.resize()}})},_subscribers:function(){var e=this,t=d.get("eventsHandler");e._subscriberTokens.push(t.subscribe(e._subscriberId,"DS/Object/select",function(t){var n=Object.keys(t.data.attributes),i=[];t.metadata.appId!==widget.id&&(i=0===n.length&&e.physicalIds?e.physicalIds:[]);var s=d.get("component");if(s._tasks&&s._tasks.current&&s._tasks.current.taskType&&"SELECT_IN_3D"===s._tasks.current.taskType)return!1;var o=s.getTreeDocument();if(n.forEach(function(e){var t=o.getNodesById(e);t.length>0&&t.filter(e=>e.options.baseType===g).length>0&&i.push(e)}),n.length>0&&0===i.length)return!1;e.physicalIds=i})),e._subscriberTokens.push(t.subscribe(e._subscriberId,"DS/Object/delete",function(t){for(var i=Object.keys(t.data.attributes),s=n.clone(e.physicalIds),o=0;o<i.length;o++){var a=s.indexOf(i[o]);-1!==a&&s.splice(a,1)}e.physicalIds.length!==s.length&&e._isOpened&&e.refresh(s)}))},makeSelectedFacetVisible:function(){var e=this.content.views.facets[[this.content.views.current]];null!=e.instance&&e.instance.container.addClassName("visible")},_listenToHeader:function(){var e=this;e.listenTo(e.header,"request:switchFacet",function(t){var i=e.switchFacet(t.facetName);n.is(t.callback,"function")&&i.then(t.callback)}),e.listenTo(e.header,"request:resizeContent",function(e){})},utils:{placeholder:function(){var e=this;return n.createElement("div",{class:v.ELEMENTS.NO_SELECTION_PLACEHOLDER,html:[n.createElement("span",{class:"wux-ui-3ds-close wux-ui-3ds closeIcon",title:"close",events:{click:function(){e.closeIDCard()}}}),n.createElement("div",{class:v.ELEMENTS.NO_SELECTION_PLACEHOLDER_TEXT,html:[n.createElement("span",{class:"fonticon fonticon-5x fonticon-info"}),n.createElement("span",{class:"no-selection-placeholder-label",html:p.information.views.noSelection})]})]})}},closeIDCard:function(){this._applicationChannel.publish({event:"information-panel-close"})}})}),define("DS/IssueManagement/views/kanban/Column",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Mask","DS/UIKIT/Tooltip","DS/IssueManagement/views/kanban/TileList","DS/Core/PointerEvents","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/TreeModel/TreeDocument","DS/WebappsUtils/WebappsUtils","DS/IssueComponents/users/Users","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/utils/DragAndDrop","DS/IssueManagement/components/ContextualMenu","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","DS/IssueComponents/close/Close","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p,h,g,f,v,I,b,y,S,w){"use strict";var C={STATE:"state",PRIORITY:"priority",DUE_DATE:"resolutionDate"},T="Closed",E={Create:0,Assign:1,Active:2,Review:3,Closed:4},D="Low",_="Medium",A="High",M="Urgent",N="Overdue",x="None",O="Today",P="Tomorrow",k="Week",V="Future",L=0,R=500,U=1,F=18,j=function(e){return n.createElement("div",{class:"column-header",html:[n.createElement("div",{class:"column-header-label",html:e.title}),n.createElement("div",{class:"column-header-count",html:"("+e.count+")"})]})},B=function(){return n.createElement("div",{class:"column-content",html:""})},W=function(){return n.createElement("div",{class:"column-overlay",html:[{tag:"div",class:"column-overlay-label",html:S.kanban.dnd.placeholder},{tag:"span",class:"column-overlay-icon fonticon fonticon-drag-drop"}]})};return t.extend({name:"DS/IssueManagement/views/kanban/Column",tagName:"div",className:"kanban-container-column",_logger:null,defaultOptions:{title:{},defaultImage:d.getWebappsAssetUrl("IssueManagement","icons/iconIssueThumbnail.png")},kanban:null,document:null,models:[],grid:null,attributeKeyValue:{key:null,value:null},_dnd:{dragged:!1},_cellsAwaitingPostRendering:[],setup:function(e){I.start(this.name+" setup"),this._parent(e),this._logger=r.getLogger("DS/IssueManagement/View"),this.kanban=e.kanban,this.document=new c,this.document._id=this.id,this.document._currentKanbanView=e.attributeKeyValue.key,this.models=[];for(var t=0;t<e.models.length;t++){var n=Object.keys(e.models[t]).reduce(function(n,i){return"children"!==i&&(n[i]=e.models[t][i]),n},{});n.contextualMenu=[{}],this.models.push(n)}var i=this.getEventOptions();i.allowUnsafeHTMLContent=!1,i.selectionBehavior={},i.selectionBehavior.toggle=!0,i.selectionBehavior.unselectAllOnEmptyArea=!0,i.selectionBehavior.selectNodeModelOnCellSelection=!0,i.selectionBehavior.canMultiSelect=!0,i.selectionBehavior.canInteractiveMultiselectWithCheckboxClick=!0,i.selectionBehavior.enableShiftSelection=!0,i.selectionBehavior.enableFeedbackForActiveCell=!0,this.grid=new o(i),this.setEventOptions(this.grid),this.attributeKeyValue={key:e.attributeKeyValue.key,value:e.attributeKeyValue.value},this._dnd={dragged:!1},this._cellsAwaitingPostRendering=[],this._subscribers(),I.end(this.name+" setup")},render:function(){var e=this;I.start(e.name+" render");var t=j({title:e.getOption("title"),count:e.models.length}),i=B();if(t.inject(e.container),i.inject(e.container),t.addEventListener("drop",function(t){e._onDrop(t)},!1),t.addEventListener("dragover",function(e){e.preventDefault()},!1),e.attributeKeyValue.key===C.STATE&&e.attributeKeyValue.value===T){var o=g.get("widget");if(!0!==JSON.parse(o.getValue("filter")).closed){e.container.addClassName("not-filtered");var a=n.createElement("div",{class:"not-filtered-warning",html:{tag:"span",class:"fonticon fonticon-attention"}});new s({target:a,body:S.kanban.warning.closed}),a.inject(t)}}return e.grid.inject(i),W().inject(e.container),e.load(),I.end(e.name+" render"),e},load:function(){var e=this;I.start(e.name+" load");for(var t=0;t<e.models.length;t++)e._populate(e.models[t]);e.document.withTransactionUpdate(function(){for(var t=0;t<e.models.length;t++){var n=e.document.addRoot(e.models[t]);e.kanban._issuesNodesMapping[e.models[t].id].push(n),e.models[t].isSelected&&n.select()}e.document.getRoots().sort(function(e,t){return e.name<t.name?1:e.name>t.name?-1:0})}),e.grid.model=e.document,I.end(e.name+" load")},destroy:function(){this._logger=null,this.document=null,this.models=[],this.grid.destroy(),this.grid=null,this.attributeKeyValue={key:null,value:null},this._dnd={dragged:!1},this._cellsAwaitingPostRendering=[]},getTreeDocument:function(){return this.document},getSelectedNodes:function(){return this.document.getSelectedNodes()},unselectAll:function(){this.document.unselectAll()},getEventOptions:function(){var e=this;return{useDragAndDrop:!0,onDragStartCell:function(t,n){t.stopPropagation();var i=e.kanban.getSelectedNodes();0===i.length&&(i=[]).push(n.nodeModel);var s={isKanbanView:!0,columnKeyValue:{key:e.attributeKeyValue.key,value:e.attributeKeyValue.value},models:i.map(function(e){return e.options})},o=p.setDroppableData(i,s);t.dataTransfer.setData(o.type,o.data),t.dataTransfer.effectAllowed="move",e._dnd.dragged=!0;var a=e.container.getElements(".wux-ui-state-highlighted");if(null!==a)for(var r=0;r<a.length;r++)a[r].getParent().addClassName("kanban-dragged-tile");return!1},onDropCell:function(t,n){e.utils.clean(e.kanban.container,{dragged:!0,hovered:!0,placeholder:!0}),p.events.onDropCell.call(e.kanban,t,n)},onDropBlank:e._onDrop.bind(e),onDragEnterBlank:function(t){t.preventDefault(),e.utils.clean(e.kanban.container,{hovered:!0,placeholder:!0}),!0===e._dnd.dragged||e.container.addClassName("drop-authorized")},onDragLeaveBlank:function(t){t.preventDefault(),e.container.removeClassName("drop-authorized")},onDragOverCell:function(t,n){return t.preventDefault(),e.utils.clean(e.kanban.container,{hovered:!0,placeholder:!0}),n.cellView.elements.container.addClassName("kanban-hovered-tile"),!0}}},setEventOptions:function(t){var i=this;t.onCellDoubleClick(function(){m.getCommand("ToggleInformationPanel")&&(widget.setValue("fromDataGridDoubleClick",!0),m.getCommand("ToggleInformationPanel").begin({save:!0}))}),t.onContextualEvent={callback:function(t){return!(!t||!t.cellInfos)&&new e(function(e){var n=t.cellInfos;!1===n.nodeModel.isSelected()?(i.listenTo(i.kanban,"onSelectAcked",function(){i.stopListening(i.kanban,"onSelectAcked"),h.getContextualMenu(n.nodeModel).then(function(t){e(t)})}),n.nodeModel.select(!0),i.kanban.document.prepareBroadcastSelect(),i.kanban.document.pushBroadcastSelect()):h.getContextualMenu(n.nodeModel).then(function(t){e(t)})})}},t.onDragEndCell=function(){i.utils.clean(i.kanban.container,{dragged:!0,placeholder:!0}),i._dnd.dragged=!1},t.onStatusbarIconPointerDown=function(e){var t=e.cellInfos,n=e.clickedIconIndex,s=t?t.cellView:void 0,o=s?s.contentView:void 0,a=t?t.cellModel:void 0;if(o&&a&&n>=0&&n<o.statusbarIcons.length){for(var r=[],l=[],c=0;c<o.statusbarIcons.length;c++)r.push(o.statusbarIcons[c]),l.push(o.statusbarIconsTooltips[c]);switch(i.document.unselectAll(),a.select(),r[n]){case"attach":m.getCommand("AttachmentManager").begin()}}};var s=i.kanban.utils.debounce(function(){var t=this;new e(function(e,i){if(t._cellsAwaitingPostRendering.length>0){var s=t._cellsAwaitingPostRendering.map(function(e){return{physicalId:e.nodeModel.options.physicalId}}).filter(function(e,t,n){return n.indexOf(e)===t});f.images.retrieve({data:{objects:s},onComplete:function(i){for(var s=0;s<i.results.length;s++){var o=i.results[s].body;n.is(o,"object")&&n.is(o.url,"string")&&""!==o.url&&t._cellsAwaitingPostRendering[s].nodeModel.updateOptions({thumbnail:o.url})}e()},onFailure:function(e){t._logger.error("Cannot retrieve the images: %s",e),i(new Error(e))}})}else e()}).finally(function(){t._cellsAwaitingPostRendering=[]})}.bind(i),R);t.onPostCellRequest(function(e){var t=e.cellView.elements.container;if(t&&"hidden"!==t.getStyle("visibility")){var o=e.nodeModel;e.cellView.contentView.setProperties({description:o.options.description||"",subtitle:n.createElement("div",{class:"sub-label-container",html:[i.utils.getHTMLPriority(o.options.priority),o.options.name,{tag:"span",class:"fonticon fonticon-user"},i.utils.getHTMLOwner(o.options.owner),{tag:"span",class:"fonticon fonticon-users"},i.utils.getHTMLAssignees(o.options.assignees)]})}),i._cellsAwaitingPostRendering.push(e),s()}})},_populate:function(e){e.thumbnail=this.getOption("defaultImage"),e.statusbarIcons=["attach"],e.statusbarIconsTooltips=[S.commands.attachments]},_subscribers:function(){var e=this,t=e.kanban.utils.debounce(function(t){e.dispatchEvent("onSelect",{column:e,node:t,event:"select"})}.bind(e),U);e.document.getModelEvents().subscribe({event:"select"},t);var n=e.kanban.utils.debounce(function(t){e.dispatchEvent("onSelect",{column:e,node:t,event:"unselect"})}.bind(e),U);e.document.getModelEvents().subscribe({event:"unselect"},n),e.grid.addEventListener(a.POINTERDOWN,function(t,n){var i=e.grid;if(!(!0!==i.selectionBehavior.unselectAllOnEmptyArea||n&&n.cellView)){var s=i.getViewportDimensions(),o=i.layout.getContentDimensions(),a=0;t.target===i.elements.scroller.getContent()&&("vertical"===i.layout.direction?a=s.height<o.height?F:0:"horizontal"===i.layout.direction&&(a=s.width<o.width?F:0));var r=Math.max(o.width,s.width-a),l=Math.max(o.height,s.height-a);t.offsetX<r&&t.offsetY<l&&e.dispatchEvent("onUnselectAll",{column:e})}},!1)},_onDrop:function(t){var n=this;t.preventDefault(),t.stopPropagation();var s=null;n.utils.clean(n.kanban.container,{dragged:!0,hovered:!0,placeholder:!0});try{s=p.getDroppableData(t)}catch(e){return l.displayNotification({msg:S.dnd.notSupported,eventID:"info"}),!1}if(s&&s.data)if(s.widgetId===g.get("widget").id&&s.data.options&&s.data.options.isKanbanView){var o=s.data.items,a=s.data.options.models;if(n.attributeKeyValue.key===s.data.options.columnKeyValue.key&&n.attributeKeyValue.value===s.data.options.columnKeyValue.value)return!0;i.mask(n.kanban.container),("state"===n.attributeKeyValue.key?n._onDropUpdateState(a,s.data.options.columnKeyValue.value):n._onDropUpdateIssues(a)).then(function(t){if(!1!==t){for(var i={paths:[],attributes:{}},s=0;s<o.length;s++)i.paths.push([o[s].objectId]),i.attributes[o[s].objectId]={id:o[s].objectId,name:o[s].displayName,title:o[s].displayName,type:o[s].objectType,modifiedAttributes:["state"]};return g.get("component").publishUpdate(i),n.kanban.document.refreshNodesById({modified:o.map(function(e){return e.objectId}),timestamp:Math.floor(Date.now())})}return e.resolve()}).catch(function(e){n._logger.error(e)}).finally(function(){i.unmask(n.kanban.container)})}else l.displayNotification({msg:S.dnd.notSupported,eventID:"info"});return!0},_onDropUpdateState:function(t,i){var s=this;if(!t.every(function(e){return e.state===t[L].state}))return l.displayNotification({msg:S.kanban.dnd.notAllSameStatePromote,eventID:"error"}),e.reject(new Error("Not supported dnd, all issues must be in the same state"));var o=function(e){var t="";if(e&&e.error&&n.is(e.error.message,"string")&&(t=e.error.message),t.includes("Action Taken and Resolution Statement are not filled in")){var i=b.getErrorMessage("5");b.displayErrorMessage(i,"error")}else if(t.includes("Action Taken field is not filled in")){i=b.getErrorMessage("6");b.displayErrorMessage(i,"error")}else if(t.includes("Resolution Statement field is not filled in")){i=b.getErrorMessage("7");b.displayErrorMessage(i,"error")}else if(t.includes("Resolution Date is not filled in")){i=b.getErrorMessage("8");b.displayErrorMessage(i,"error")}else if(t.includes("User does not have necessary privileges or selected object is not in correct maturity state for this operation")){i=b.getErrorMessage("1005");b.displayErrorMessage(i,"error")}else{i=S.notifications.serverError;e&&e.error&&n.is(e.error.message,"string")&&(i=e.error.message),l.displayNotification({msg:i,eventID:"error"})}s._logger.error(e)},a=-1;switch(a=s.attributeKeyValue.value===T?0:E[s.attributeKeyValue.value]-E[i]){case 0:var r=[];return t.forEach(e=>{r.push(e.physicalId)}),new y({physicalIds:r}).render();case 1:var c=t.map(function(e){return{physicalId:e.physicalId,state:s.attributeKeyValue.value}});return f.issues.promote({data:{objects:c}}).catch(function(e){o(e)});case-1:var d=t.map(function(e){return{physicalId:e.physicalId,state:s.attributeKeyValue.value}});return f.issues.demote({data:{objects:d}}).catch(function(e){o(e)});default:return l.displayNotification({msg:S.replace(a>0?S.kanban.dnd.unsupportedPromote:S.kanban.dnd.unsupportedDemote,{currState:w.maturity[i.toLowerCase()],state:w.maturity[s.attributeKeyValue.value.toLowerCase()]}),eventID:"error"}),e.reject(new Error("Unexpected dropped data, cannot update state of issue(s)"))}},_onDropUpdateIssues:function(t){var i=this,s=t.filter(function(e){return e.state!==T});if(s.length!==t.length&&l.displayNotification({msg:S.kanban.dnd.cannotEditClosedIssues,eventID:"warning"}),s.length>0){var o="";if(i.attributeKeyValue.key===C.DUE_DATE)if(i.attributeKeyValue.value===x)o="";else{var a=new Date;a.setHours(0,0,0,0);var r=new Date(a);r.setDate(r.getDate()-r.getDay()+8);var c=new Date(a);switch(i.attributeKeyValue.value){case N:c.setDate(a.getDate()-1);break;case O:break;case P:c.setDate(a.getDate()+1);break;case k:c.setDate(a.getDate()+2),c-r>=0&&(c.setDate(a.getDate()+1),c-r>=0&&c.setDate(a.getDate()-a.getDay()));break;case V:c.setDate(a.getDate()+30)}o=c.getMonth()+1+"/"+c.getDate()+"/"+c.getFullYear()}else o=i.attributeKeyValue.value;var d=s.map(function(e){var t={physicalId:e.physicalId};return t[i.attributeKeyValue.key]=o,t});return f.issues.update({data:{objects:d}}).catch(function(e){e&&n.is(e.error,"object")&&n.is(e.error.message,"string")?l.displayNotification({msg:e.error.message,eventID:"error"}):l.displayNotification({msg:S.notifications.serverError,eventID:"error"}),i._logger(e)})}return e.resolve(!1)},utils:{whereToAddModal:null,getHTMLPriority:function(e){var t="";switch(e){case D:t="low wux-ui-3ds wux-ui-3ds-level-low";break;case _:t="medium wux-ui-3ds wux-ui-3ds-level-medium";break;case A:t="high wux-ui-3ds wux-ui-3ds-level-high";break;case M:t="urgent wux-ui-3ds wux-ui-3ds-alert "}return n.createElement("div",{class:"issue-list-priority",html:[n.createElement("span",{class:"issue-list-priority-icon "+t,title:w.priorities[e.toLowerCase()]})]})},getHTMLOwner:function(e){return u.create({users:[e]})},getHTMLAssignees:function(e){var t=e;return u.create({users:t})},clean:function(e,t){if(!0===t.dragged)for(var n=e.getElements(".kanban-dragged-tile"),i=0;i<n.length;i++)n[i].getParent().removeClassName("kanban-dragged-tile");if(!0===t.hovered)for(var s=e.getElements(".kanban-hovered-tile"),o=0;o<s.length;o++)s[o].removeClassName("kanban-hovered-tile");if(!0===t.placeholder){var a=e.getElement(".drop-authorized");null!==a&&a.removeClassName("drop-authorized")}}}})}),define("DS/IssueManagement/models/TreeDocument",["UWA/Core","UWA/Class/Promise","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/TreeModel/TreeDocument","DS/TreeModel/BaseFilter","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/models/TreeNodeModel","DS/IssueCommon/utils/ModelParser","DS/IssueServices/Contexts","DS/IssueServices/utils/Parser","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueComponents/assets/nls/IssueComponents"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p,h,g,f,v){"use strict";var I="Issue",b=10,y=0,S=100,w=100,C=function(e,t,n){var i;return function(){var s=this,o=arguments,a=n&&!i;clearTimeout(i),i=setTimeout(function(){i=null,n||e.apply(s,o)},t),a&&e.apply(s,o)}},T=this;return o.extend({name:"DS/IssueManagement/models/TreeDocument",_logger:null,component:null,settings:{},_publishSelection:!1,_onNodeModelUpdateSubscriptionToken:"",init:function(t){this.listView=d.get("ISU_LISTVIEW"),T=this,this._logger=n.getLogger("DS/IssueManagement/Model"),this.component=t.component,this.settings=t.settings,t.list=e.merge(t.document||{},this.getEventOptions()),this._parent(t.document),this._publishSelection=!1,this.listView||(this.initCustomFilter(),this.registerCustomFilter()),this._subscribers()},registerNodeModelUpdateEvent:function(){var t=this;t._onNodeModelUpdateSubscriptionToken=t.onNodeModelUpdate(function(n){var o=n.data.nodeModel;if(o){var a=n.data.attributes;if("string"!=typeof a.Approvals){var r={id:o.options.physicalId};if(a.hasOwnProperty("Approvals")){try{var l=d.get("component").getCurrentView();h.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:l,pd3:"SummaryViewActions",pd4:"Approvals",pd5:"Issue/"+l+"/SummaryViewActions/Approvals"}})}catch(e){}o.options.id;a.Approvals?m.issues.enableApproval({data:r,onComplete:function(e){t.undoRegisterNodeModelUpdateEvent(),t.withTransactionUpdate(function(){o.updateOptions({validation:{activated:!0},grid:{"ds6w:validation":{activated:!0}}})}),t.registerNodeModelUpdateEvent();var n=[[o.options.physicalId]],i={};i[o.options.physicalId]={id:o.options.physicalId,type:"Issue",modifiedAttributes:["Approvals"]},s.publish("DS/Object/update",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now())},data:{paths:n,attributes:i},version:"1.0"})},onFailure:function(n){if(e.is(n.error.internal)&&n.error.internal.includes("No 'modify' access on Attribute 'Waiting On' for")){var s=h.getErrorMessage("2005");h.displayErrorMessage(s,"error")}else i.displayNotification({msg:n.error.message,eventID:"error"});t.undoRegisterNodeModelUpdateEvent(),t.withTransactionUpdate(function(){o.updateOptions({grid:{Approvals:!1}})}),t.registerNodeModelUpdateEvent()}}):m.issues.disableApproval({data:r,onComplete:function(e){t.undoRegisterNodeModelUpdateEvent(),t.withTransactionUpdate(function(){o.updateOptions({validation:{activated:!1},grid:{"ds6w:validation":{activated:!1}}})}),t.registerNodeModelUpdateEvent();var n=[[o.options.physicalId]],i={};i[o.options.physicalId]={id:o.options.physicalId,type:"Issue",modifiedAttributes:["Approvals"]},s.publish("DS/Object/update",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now())},data:{paths:n,attributes:i},version:"1.0"})},onFailure:function(n){if(e.is(n.error.internal)&&n.error.internal.includes("No 'modify' access on Attribute 'Waiting On' for")){var s=h.getErrorMessage("2005");h.displayErrorMessage(s,"error")}else i.displayNotification({msg:n.error.message,eventID:"error"});t.undoRegisterNodeModelUpdateEvent(),t.withTransactionUpdate(function(){o.updateOptions({grid:{Approvals:!0}})}),t.registerNodeModelUpdateEvent()}})}}}})},undoRegisterNodeModelUpdateEvent:function(){this.unsubscribe(this._onNodeModelUpdateSubscriptionToken)},registerCustomFilter:function(){this.getFilterManager().registerFilter("stringRole",this.stringRoleFilter)},initCustomFilter:function(){T.filteredListOfNodes=[],this.stringRoleFilter=a.inherit({publishedProperties:{},isDataFiltered:function(e){var t=e.getAttributeValue(this.propertyId);return!(!this.filterModel||!this.filterModel.allowedRoles)&&!t.toLowerCase().includes(this.filterModel.allowedRoles.toLowerCase())},isEmpty:function(){return void 0===this.filterModel.allowedRoles}})},getEventOptions:function(){return{shouldAcceptDrag:function(){return!0},shouldAcceptDrop:function(){return!0}}},addRoots:function(e,n){var i=this;return 0===e.length?t.resolve([]):new t(function(t){i.withTransactionUpdate(function(){for(var s=i.component.list,o=[],a=0;a<e.length;a++){var r=new l(e[a]);r.options.data&&(r.options.data.isExpandMultiple=!1),0===r.options.reportedAgainst.length&&0===r.options.resolvedBy.length&&0===r.options.resolvedItems.length&&0===r.options.contexts.length&&(r.options.children=null,r.setState({state:"noChildren"})),o.push(r)}for(var c=0;c<o.length;c++)i.addRoot(o[c],0);var u=d.get("widget").getValue("IssueManagementTableSorting");try{var m=JSON.parse(u);if(!Number.isInteger(m.columnID)||!m.order)throw new Error("The sort preference has an incorrect format");s.getManager().sortColumnContent(m.columnID,{sortOrder:m.order})}catch(e){"datagrid"==i.component.list.summaryview?i.getRoots().sort():i.getRoots().sort(s.sorting.name(!0))}!0===n&&setTimeout(function(){var e=s.getManager();if(1===o.length)i.listView?e.isNodeInVisibleViewport(o[y])||e.scrollToNode(o[y],"top",!1):s.ensureNodeModelVisible(o[y]);else if(o.length>1&&i.listView){if(!0===o.every(function(t){return!e.isNodeInVisibleViewport(t)})){for(var t=e.getScroller().getPosition().y,n=0,a=null,r=0;r<o.length;r++){var l=e.getRowPosition(o[r]._getRowID(!0)),c=Math.abs(t-l);0===r&&(n=c,a=o[r]),c<n&&(n=c,a=o[r])}e.scrollToNode(a,"top",!1)}}},0),i.getModelEvents().publish({event:"onRootsAdded",data:{roots:o,filterChange:i.filterChange}}),t(o)})},function(){i._logger.error('An error occurred during "%s"',"addRoots")})},updatePredicates:function(){var e=this,n=e.component.list.getPredicates(),i=e.getRoots(!1);if(0===n.length||0===i.length)return t.resolve();var s=i.map(function(e){return{physicalId:e.options.physicalId}});return m.fetch({data:{objects:s,predicates:n}}).then(function(s){return new t(function(t){e.withTransactionUpdate(function(){for(var e=0;e<s.body.results.length;e++){for(var o=s.body.results[e].attributes,a={},r=0;r<o.length;r++){var l=o[r];-1!==n.indexOf(l.name)&&(a[l.name]=l.value)}i[e].updateOptions({grid:a})}t()})})})},removeRootsById:function(e){var n=this;return 0===e.length?t.resolve():new t(function(t){n.withTransactionUpdate(function(){var i=[];e.forEach(function(e){var t=n.searchRootById(e);null!==t&&(i.push(t),n.removeRoot(t))}),n.getModelEvents().publish({event:"onRootsRemoved",data:{roots:i}}),t({roots:i})})})},prepareBroadcastSelect:function(){this._publishSelection=!0},postBroadcastSelect:function(){this._publishSelection=!1},buildBroadcastSelect:function(){p.start(this.name+" buildBroadcastSelect");for(var e=[],t={},n=this.getSelectedNodes(),i=0;i<n.length;i++){var s=n[i];e.push([s.options.id]),t[s.options.id]={id:s.options.id,type:s.options.type,name:s.options.name,label:s.options.title}}return p.end(this.name+" buildBroadcastSelect"),{paths:e,attributes:t}},buildBroadcastSelectForIssue:function(){p.start(this.name+" buildBroadcastSelectForIssue");for(var e=[],t={},n=this.getSelectedNodes(),i=0;i<n.length;i++){var s=n[i];s.options.baseType===I&&(e.push([s.options.id]),t[s.options.id]={id:s.options.id,type:s.options.type,name:s.options.name,title:s.options.title})}return p.end(this.name+" buildBroadcastSelectForIssue"),{paths:e,attributes:t}},pushBroadcastSelect:C(function(){p.start(this.name+" pushBroadcastSelect");var e=this.buildBroadcastSelect(),t=this.buildBroadcastSelectForIssue();this.component.getTreeDocument().getRoots(!1).length>0&&r.select(this.getSelectedNodes()),this.component.publishSelect(t),h.publishSelectAll(e),this.component.publishCompass(),this._publishSelection=!1,p.end(this.name+" pushBroadcastSelect")},S),withBroadcastSelect:function(e){var t=this;t.prepareBroadcastSelect(),e.then(function(){t.pushBroadcastSelect()},function(){t._publishSelection=!1})},refresh_v2:function(n){var s=this,o=d.get("widget")||window.widget;p.start(s.name+" refresh");var a=[],r=[],l=[];s.filterChange=n;var u=o.getValue("filter"),g=void 0===o.getValue("affectedItemSetting")||o.getValue("affectedItemSetting"),v=void 0===o.getValue("resolvedItemSetting")||o.getValue("resolvedItemSetting"),I=void 0===o.getValue("contextSetting")||o.getValue("contextSetting");return!0===s.utils.isJson(u)?((u=JSON.parse(u)).onlyids=!1,o.getPreference("organizationFilter").value||d.get("isNatifEnvironnement")||(u.reported=!1,u.responsible=!1,o.setValue("filter",JSON.stringify(u))),u.affectedItem=g,u.resolvedItem=v,u.context=I):u={},m.issues.filter({version:"2.0",data:{filter:u,isFilterChange:n}}).then(function(i){if(void 0!==i.success&&!1===i.success){if(i.body&&i.body.error&&i.body.error.internal&&e.is(i.body.error.internal,"string")){var o=i.body.error.internal;if(o.includes("No business object")||o.includes("not exist")){var l=h.getErrorMessage("0");h.displayErrorMessage(l,"error")}}t.resolve([])}var m=s.getRoots(!0).slice(0);return new t(function(e){s.withTransactionUpdate(function(){if(m.length>0){for(var t=0;t<m.length;t++){var o=m[t],l=o.options.physicalId;a.push(l),!0===o.isSelected()&&r.push(l)}n?s.removeIssueRoots():s.removeRoots(m)}var p=c.parse(i.body);s.addRoots(p),e(p);const g=s.getRoots();s.component.loadInfo_fetchV2(g);d.get("ISU_TYPE_NLS");s.component.addCustomAttrToColumnsList(),s.component.getClassificationIds(u).then(e=>{s.component.addClassificationAttrToColumnsList(e)}),s.component.getCustomAttrValues(u).then(e=>{s.component.updateCustomAttrValuesInDatagrid(e)}),s.component.updateNLSValuesInDatagrid(p),n&&(h.cloudProbeUtils.sendFilterIssueMgmtTrackerEvent({filter:u,noOfIssues:p.length}),h.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"FilterIssueManagement"}}))})})}).then(function(){if(l=o.getValue("expandedIds"),Array.isArray(l)){for(var e=[],t=0;t<l.length;t++){var n=s.getNodesById(l[t]);n.length>0&&Array.isArray(n)&&e.push(n[0])}e.forEach(function(e){e.options.data.isExpandMultiple=!0,e.expand()}),e.length>0&&s.updateNodesOnExpand(e)}s.withTransactionUpdate(function(){r.forEach(function(e){s.getNodesById(e).forEach(function(e){e.select()})}),s.pushBroadcastSelect()}),s.component.list.reapplySortModel(),i.displayNotification({msg:f.notifications.refresh})}).catch(function(e){s._logger.error("Refresh has failed: %o",e),i.displayNotification({msg:f.notifications.serverError,eventID:"error"})}).finally(function(){p.end(s.name+" refresh")})},refresh:function(n){var s=this,o=d.get("widget")||window.widget;p.start(s.name+" refresh");var a=[],r=[],l=[];s.filterChange=n;var u=o.getValue("filter");return!0===s.utils.isJson(u)?((u=JSON.parse(u)).onlyids=!0,o.getPreference("organizationFilter").value||(u.reported=!1,u.responsible=!1,o.setValue("filter",JSON.stringify(u)))):u={},m.issues.filter({version:"1.0",data:{filter:u,isFilterChange:n}}).then(function(i){if(void 0!==i.success&&!1===i.success){if(i.body&&i.body.error&&i.body.error.internal&&e.is(i.body.error.internal,"string")){var o=i.body.error.internal;if(o.includes("No business object")||o.includes("not exist")){var d=h.getErrorMessage("0");h.displayErrorMessage(d,"error")}}t.resolve([])}var u=s.getRoots(!0).slice(0);return new t(function(e){s.withTransactionUpdate(function(){if(u.length>0){for(var t=0;t<u.length;t++){var o=u[t],d=o.options.physicalId;a.push(d),!0===o.isSelected()&&r.push(d),!0===o.isExpanded()&&l.push(d)}n?s.removeIssueRoots():s.removeRoots(u)}var m=c.parse(i.body);s.addRoots(m).then(function(){e(m)})})})}).then(function(t){let n=d.get("ISU_TYPE_NLS"),i=[];e.is(n["ds6w:type"])&&(i=Object.keys(n["ds6w:type"]));let o={},a=i.filter(e=>"Issue"!=e);return a.length>0&&(o.subType=a.toString()),i=i.filter(e=>"Issue"!=e),m.custom.getCustomAttributes(o).then(function(t){if(e.is(t)){var n=s.component.list.getColumns().map(function(e){return e.name});s.component.attributes=n.filter(function(t){return e.is(t)}),t.body.forEach(function(e){if(!s.component.attributes.includes(e.name)){s.component.attributes.push(e.name);var t={column:{name:e.name,text:e.title,dataIndex:e.path,isDraggable:!0,isHidden:!0,visibleFlag:!1,export:{value:!0,lock:!1},moveable:!0,width:120,minWidth:5,isCustomColumn:"Attribute"}};if(s.listView)t.column.onCellRequest=s.component.list.rendering.classificationAttributes,s.component.list.getManager().getColumns().filter(e=>e.dataIndex==t.column.dataIndex).length<=0&&s.component.list.getManager().addColumn(t);else{var n={that:s,attr:e};t.column.getCellValue=s.component.list.rendering.classificationAttributes.bind(n),s.component.list.getManager().getColumns().filter(e=>e.dataIndex==t.column.dataIndex).length<=0&&(s.component.list.getManager().addColumnOrGroup(t.column),h.setColumnFilteringOnColumn(s.component.list,t.column))}}})}}),i.includes("Issue")||i.push("Issue"),m.type.getSubTypesAttributes({types:i}).then(function(t){if(e.is(t)&&t.results&&t.results.length>1){let i=t.results.filter(e=>"Issue"==e.name)[0].properties.map(e=>e.name),o=new Set;t.results.forEach(e=>{e.properties.forEach(e=>{i.includes(e.name)||o.add(e)})});var n=s.component.list.getColumns().map(function(e){return e.name});s.component.attributes=n.filter(function(t){return e.is(t)}),o.forEach(function(e){if(!s.component.attributes.includes(e.name)){s.component.attributes.push(e.name);var t={column:{name:e.name,text:e.nlsName,dataIndex:e.name,isDraggable:!0,isHidden:!0,visibleFlag:!1,export:{value:!0,lock:!1},moveable:!0,width:120,minWidth:5,isCustomColumn:"Attribute"}};if(s.listView)t.column.onCellRequest=s.component.list.rendering.classificationAttributes,s.component.list.getManager().getColumns().filter(e=>e.dataIndex==t.column.dataIndex).length<=0&&s.component.list.getManager().addColumn(t);else{var n={that:s,attr:e};t.column.getCellValue=s.component.list.rendering.classificationAttributes.bind(n),s.component.list.getManager().getColumns().filter(e=>e.dataIndex==t.column.dataIndex).length<=0&&(s.component.list.getManager().addColumnOrGroup(t.column),h.setColumnFilteringOnColumn(s.component.list,t.column))}}})}}),t}).then(function(e){for(var n=[],i=0;i<e.length;i++){var o=e[i].classification;o.length>0&&o.forEach(function(e){if(!s.component.classes.includes(e)){s.component.classes.push(e);var i=new t(function(t){m.classification.getClassificationAttributesOfClass({id:e,onFailure:function(e){}}).then(function(n){var i={classAttributes:n.member[0].ClassAttributes.member,classID:e};t(i)})});n.push(i)}})}return t.all(n)}).then(function(e){e.forEach(function(e){e.classAttributes.forEach(function(e){if(!s.component.attributes.includes(e.name)){s.component.attributes.push(e.name);var t={column:{text:e.name,dataIndex:e.name,isDraggable:!0,isHidden:!0,visibleFlag:!1,export:{value:!0,lock:!1},moveable:!0,width:120,minWidth:5,isCustomColumn:"Classification"}};if(s.listView){t.column.onCellRequest=s.component.list.rendering.classificationAttributes,s.component.list.getManager().getColumns().filter(e=>e.dataIndex==t.column.dataIndex).length<=0&&s.component.list.getManager().addColumn(t)}else{var n={that:s,attr:e};t.column.onCellRequest=s.component.list.rendering.classificationAttributes.bind(n),s.component.list.getManager().getColumns().filter(e=>e.dataIndex==t.column.dataIndex).length<=0&&(s.component.list.getManager().addColumnOrGroup(t.column),h.setColumnFilteringOnColumn(s.component.list,t.column))}}})})}).then(function(){if(Array.isArray(l)){for(var e=[],t=0;t<l.length;t++){var n=s.getNodesById(l[t]);n.length>0&&Array.isArray(n)&&e.push(n[0])}e.forEach(function(e){e.options.data.isExpandMultiple=!0,e.expand()}),e.length>0&&s.updateNodesOnExpand(e)}s.withTransactionUpdate(function(){r.forEach(function(e){s.getNodesById(e).forEach(function(e){e.select()})}),s.pushBroadcastSelect()}),s.component.list.reapplySortModel(),i.displayNotification({msg:f.notifications.refresh})}).catch(function(e){s._logger.error("Refresh has failed: %o",e),i.displayNotification({msg:f.notifications.serverError,eventID:"error"})}).finally(function(){p.end(s.name+" refresh")})},addChildren:function(e,t){var n=this,i=t.results,s=[];n.withTransactionUpdate(function(){p.start(n.name+" addChildren"),e.sortChildren=function(){return!1};for(var t=[],o=[],a=[],r=e.options.contexts.reduce(function(e,t){return e[t.physicalId]=t,t.isAdded=!1,e},{}),d=e.options.reportedAgainst.reduce(function(e,t){return e[t.path.toString()]=t,t.isAdded=!1,e},{}),u=e.options.resolvedBy.reduce(function(e,t){return e[t.physicalId]=t,t.isAdded=!1,e},{}),m=e.options.resolvedItems.reduce(function(e,t){return e[t.physicalId]=t,t.isAdded=!1,e},{}),h=1,g=1,f=1,v=1,I=0;I<i.length;I++){if((T=c.parse(i[I],{useIndex:!0,predicates:n.component.list.getPredicates()})).useAsyncPreExpand=!1,T.asyncChildren=[],T.children=null,T.label=T.title,T.display=T.title,T.grid.biColor="rgba(0, 0, 0, 0)",T.icons.length>1&&T.icons.shift(),void 0!==r[T.id]&&!r[T.id].isAdded){r[T.id].isAdded=!0,T.grid["ds6w:name"]=r[T.id].name,T.pid=T.physicalId,T.physicalId=T.id,T.elementType=r[T.id].elementType,T.kind=r[T.id].kind;var b=new l(T);b.setState({state:"noChildren"}),b.options.icons=T.icons.slice(0),1==h?(b.options.icons.length>1&&b.options.icons.shift(),b.options.icons.unshift({iconName:"3d-object"})):b.options.icons.unshift({iconName:"docs",className:"fade-out-element"}),b.options.data.relationToIssue="contexts",b.options.data.issue=e.options.physicalId,b.options.data.position=h,t.push(b),h+=1}if(void 0!==u[T.id]&&!u[T.id].isAdded){u[T.id].isAdded=!0,T.grid["ds6w:name"]=u[T.id].name,T.pid=T.physicalId,T.physicalId=T.id,T.elementType=u[T.id].elementType,T.kind=u[T.id].kind;var y=new l(T);y.setState({state:"noChildren"}),y.options.icons=T.icons.slice(0),1==f?(y.options.icons.length>1&&y.options.icons.shift(),y.options.icons.unshift({iconName:"docs"})):y.options.icons.unshift({iconName:"docs",className:"fade-out-element"}),y.options.data.relationToIssue="resolvedBy",y.options.data.issue=e.options.physicalId,y.options.data.position=f,o.push(y),f+=1}if(void 0!==m[T.id]&&!m[T.id].isAdded){m[T.id].isAdded=!0,T.grid["ds6w:name"]=m[T.id].name,T.pid=T.physicalId,T.physicalId=T.id,T.elementType=m[T.id].elementType,T.kind=m[T.id].kind;var S=new l(T);S.setState({state:"noChildren"}),S.options.icons=T.icons.slice(0),1==v?(S.options.icons.length>1&&S.options.icons.shift(),S.options.icons.unshift({iconName:"markup-review"})):S.options.icons.unshift({iconName:"markup-review",className:"fade-out-element"}),S.options.data.relationToIssue="resolvedItems",S.options.data.issue=e.options.physicalId,S.options.data.position=v,a.push(S),v+=1}}var w={};for(I=0;I<i.length;I++){w[(T=c.parse(i[I],{useIndex:!0,predicates:n.component.list.getPredicates()})).id]=T}var C=[];for(const[t,n]of Object.entries(d))if(void 0!==d[t]&&!d[t].isAdded){C.push(t),d[t].isAdded=!0;var T,E=t.split(",");(T=w[E[E.length-1]]).grid["ds6w:name"]=d[t].name,T.elementType=d[t].elementType,T.kind=d[t].kind,T.pid=T.physicalId,T.physicalId=t,T.id=t,T.children=null;var D=new l(T);D.setState({state:"noChildren"}),D.options.icons=T.icons.slice(0),1==g?(D.options.icons.length>1&&D.options.icons.shift(),D.options.icons.unshift({iconName:"location"})):D.options.icons.unshift({iconName:"docs",className:"fade-out-element"}),D.options.data.relationToIssue="reportedAgainst",D.options.data.issue=e.options.physicalId,D.options.data.position=g,s.push(D),g+=1}s.forEach(function(t){e.addChild(t)}),t.forEach(function(t){e.addChild(t)}),a.forEach(function(t){e.addChild(t)}),o.forEach(function(t){e.addChild(t)}),p.end(n.name+" addChildren")})},fetchOccurencePath:function(e){var t=this,n=[];if(0!=e.length){for(var s=0;s<e.length;s++)if(e[s].options.id)for(var o=e[s].options.id.split(","),a=0;a<o.length;a++)0!=a&&a%2!=1&&a!=o.length-1||n.push(o[a]);n=[...new Set(n)],m.fetch({data:{objects:n.map(function(e){return{physicalId:e}})},onComplete:function(s){var o=s.body;o.infos&&o.infos.nresults&&n.length!==o.infos.nresults&&i.displayNotification({msg:v.create.templateApplyWarningRelated,eventID:"warning"}),o.infos&&o.infos.nresults&&o.infos.nresults>0&&t.withTransactionUpdate(function(){var t={};"results"in o&&o.results.forEach(function(e){var n=u.parseFetchResponse(e);t[n.value.id]=n});for(var n=0;n<e.length;n++){var i=e[n].options.id.split(","),s="";i.length>0&&t[i[i.length-1]].display.title;for(var a=0;a<i.length;a++)t[i[a]]&&a!=i.length-1&&(s+=t[i[a]].display.title,a!=i.length-2&&(s+="\\"));var r=e[n]._options.grid;r["ds6w:occurrence"]=s,e[n].updateOptions({grid:r})}})},onFailure:function(e){}})}},addContextsOrReportedAgainstOrResolvedByOrResolvedItems:function(e){var t=this;p.start(t.name+" addContextsOrReportedAgainstOrResolvedByOrResolvedItems");for(var n=Object.keys(e),i=[],s=0;s<n.length;s++){var o=e[n[s]];for(s=0;o.reportedAgainst&&s<o.reportedAgainst.length;s++){var a=(r=(r=o.reportedAgainst[s].physicalId).split(","))[r.length-1];o.reportedAgainst[s].physicalId=a+"",o.reportedAgainst[s].path=r}for(s=0;o.resolvedBy&&s<o.resolvedBy.length;s++){a=(r=(r=o.resolvedBy[s].physicalId).split(","))[r.length-1];o.resolvedBy[s].physicalId=a+"",o.resolvedBy[s].path=r}for(s=0;o.resolvedItems&&s<o.resolvedItems.length;s++){a=(r=(r=o.resolvedItems[s].physicalId).split(","))[r.length-1];o.resolvedItems[s].physicalId=a+"",o.resolvedItems[s].path=r}for(s=0;o.contexts&&s<o.contexts.length;s++){var r;a=(r=(r=o.contexts[s].physicalId).split(","))[r.length-1];o.contexts[s].physicalId=a+"",o.contexts[s].path=r}i.push(o)}return m.related.update({data:{objects:i}}).then(function(i){p.end(t.name+" addContextsOrReportedAgainstOrResolvedByOrResolvedItems");var s={paths:[],attributes:{}};for(var o in e)s.paths.push([o]),s.attributes[o]={id:o,type:"Issue",modifiedAttributes:["reportedAgainst","resolvedBy","resolvedItems","contexts"]};var a=i.results;return d.get("component").publishUpdate(s),t.refreshNodesById({modified:n}).then(()=>a)})},removeContextsOrReportedAgainstOrResolvedByOrResolvedItems:function(e){var t=this;p.start(t.name+" removeContextsOrReportedAgainstOrResolvedByOrResolvedItems");for(var n=Object.keys(e),s=[],o=0;o<n.length;o++){if(Array.isArray(e[n[o]].reportedAgainst))for(var a=0;a<e[n[o]].reportedAgainst.length;a++){var r=e[n[o]].reportedAgainst[a].physicalId,l=(r=r.split(","))[r.length-1];e[n[o]].reportedAgainst[a].physicalId=l+"",e[n[o]].reportedAgainst[a].path=r}s.push(e[n[o]])}return m.related.delete({data:{objects:s},onFailure:function(e){t._logger.error(e);var n="";if(e&&e.error&&e.error.internal)n=e.error.internal;if(n.includes("No business object")||n.includes("not exist")){var s=h.getErrorMessage("0");h.displayErrorMessage(s,"error")}else if(n.includes("ErrorCode:2005")){s=h.getErrorMessage("2005");h.displayErrorMessage(s,"error")}else if(n.includes("No fromdisconnect access to object")){s=h.getErrorMessage("10");h.displayErrorMessage(s,"error")}else i.displayNotification({msg:e.error.message,eventID:"error"})}}).then(function(){p.end(t.name+" removeContextsOrReportedAgainstOrResolvedByOrResolvedItems");var i={paths:[],attributes:{}};for(var s in e)i.paths.push([s]),i.attributes[s]={id:s,type:"Issue",modifiedAttributes:["reportedAgainst","resolvedBy","resolvedItems","contexts"]};return d.get("component").publishUpdate(i),t.refreshNodesById({modified:n})})},refreshNodesById:function(n){var i=this;p.start(i.name+" refreshNodesById");var s=[],o=[],a=[];return new t(function(t,i){e.is(n.created)&&e.is(n.created,"array")&&n.created.forEach(function(e){-1===s.indexOf(e)&&(s.push(e),a.push(e))}),e.is(n.modified)&&e.is(n.modified,"array")&&n.modified.forEach(function(e){-1===s.indexOf(e)&&(s.push(e),o.push(e))}),s.length>0&&m.issues.retrieve({timestamp:n.timestamp?n.timestamp:null,data:{objects:s.map(function(e){return{physicalId:e}})},onComplete:function(e){let n=e.results.map(e=>e.body);g.addTypeToNonIndexIds(n).then(e=>{let n=e.map(e=>({body:e}));var i=c.parse(n.map(function(e){return e.body}));t(i)})},onFailure:function(e){i(e)}})}).then(function(e){var t=[],n=[],s=[],r={};return e.forEach(function(e){e.reportedAgainst.forEach(function(e){e.pid=e.physicalId}),e.contexts.forEach(function(e){e.pid=e.physicalId}),e.resolvedBy.forEach(function(e){e.pid=e.physicalId}),e.resolvedItems.forEach(function(e){e.pid=e.physicalId}),-1!==a.indexOf(e.id)&&t.push(e),-1!==o.indexOf(e.id)&&(n.push(e),s.push([e.id]),r[e.id]={id:e.id,type:e.type,name:e.name,title:e.title})}),i.addRoots(t,!0).then(function(e){var t=[];return i.withTransactionUpdate(function(){n.forEach(function(e){var n=i.searchRootById(e.id);null!==n&&(c.update(n.options,e),i.listView&&null!=i.listView||n.updateGrid(e),n.updateOptions(e),i.refreshChildrenNodeById(e.id),t.push(n))})}),p.end(i.name+" refreshNodesById"),{created:e,modified:t}})})},refreshChildrenNodeById:function(e){var t=this.searchRootById(e);if(p.start(this.name+" refreshChildrenNodeById"),0===t.options.reportedAgainst.length&&0===t.options.resolvedBy.length&&0===t.options.resolvedItems.length&&0===t.options.contexts.length)t.removeChildren(),t.setState({state:"noChildren"});else if(t.isExpanded())t.expand();else{var n=t.getChildren();Array.isArray(n)&&0!==n.length||t.addChild(new l)}p.end(this.name+" refreshChildrenNodeById")},searchRootById:function(e){var t=null;p.start(this.name+" searchRootById");for(var n=this.getRoots(),i=0;i<n.length;i++)if(n[i].options.id===e){t=n[i];break}return p.end(this.name+" searchRootById"),t},autoFill:{_physicalIdsForValidation:{},_physicalIdsForClassification:{},validation:function(e){this._physicalIdsForValidation[e]=e,this._autoFillValidation(Object.keys(this._physicalIdsForValidation))},_autoFillValidation:C(function(t){var n=t.reduce(function(e,t){return e.push({physicalId:t}),e},[]);this._physicalIdsForValidation={},m.routes.retrieve({data:{objects:n}}).then(function(t){for(var n={},i=0;i<t.results.length;i++){var s=t.results[i].body,o={};if(e.is(s.current.status,"string"))o=e.clone(s.current);else if(Array.isArray(s.history)&&s.history.length>0){var a=s.history.sort(function(e,t){var n=0;if(e.date)if(t.date){n=new Date(e.date)-new Date(t.date)}else n=1;else n=-1;return-1*n});o=e.clone(a[y])}else o={status:"notStarted",approveTo:"",decisions:[]};n[s.physicalId]={activated:!0,fetched:!0,status:o.status,approveTo:o.approveTo,decisions:o.decisions}}for(var r=T.getRoots(!1),l=0;l<r.length;l++){var c=r[l];n[c.options.physicalId]&&c.updateOptions({validation:n[c.options.physicalId]})}})},w),classificationAttributes:function(e,t){if(this._physicalIdsForClassification[e]){var n=this._physicalIdsForClassification[e];if(!n.attributes.some(e=>e.name===t)){var i={name:t};n.attributes.push(i)}}else{this._physicalIdsForClassification[e]={},this._physicalIdsForClassification[e].physicalId=[e];i={name:t};this._physicalIdsForClassification[e].attributes=[i]}this._autoFillClassification(this._physicalIdsForClassification)},_autoFillClassification:C(function(e){m.classification.retrieve({data:{objects:e}}).then(function(t){for(var n={},i=0;i<t.results.length;i++){var s=t.results[i].body,o=s.physicalId;n[o]=[];for(var a=e[o].attributes,r=0;r<a.length;r++){var l=a[r].name,c=s[l].substring(1,s[l].length-1),d={};d.attrName=l,d.attrValue=c,n[o].push(d)}}var u=T.getAllDescendants();for(r=0;r<u.length;r++){var m=u[r];if(n[m.options.physicalId]){a=n[m.options.physicalId];for(var p=0;p<a.length;p++){var g=a[p].attrName,f=a[p].attrValue;const e=h.getFormattedValueAsPerTypeRepresentation(g,f);var v={grid:{}};v.grid[g]=e,m.updateOptions(v)}}}})},w)},getComponent:function(){return this.component},getRoots:function(t){var n=this._parent();if(!0===t&&e.is(this._getChildrenFilterInfo,"function")){var i=this._getChildrenFilterInfo();if(i&&e.is(i.childrenBeforeFiltering,"array")){var s=n;n=i.childrenBeforeFiltering.slice(0),s.forEach(function(e){n.indexOf(e)<0&&n.push(e)})}}return n},removeIssueRoots:function(){if(this.removeRoots(),e.is(this._getChildrenFilterInfo,"function")){var t=this._getChildrenFilterInfo();t&&e.is(t.childrenBeforeFiltering,"array")&&(delete t.childrenBeforeFiltering,delete t.filteredOutChildren)}},getNodesById:function(e){var t=[];p.start(this.name+" getNodesById");for(var n=this.getRoots(!1),i=0;i<n.length;i++)t=t.concat(n[i].getNodesById(e));return p.end(this.name+" getNodesById"),t},getNodesByPath:function(e){function t(e,n,i,s){if(e.options.id===n[i])if(i===n.length-1)s.push(e);else{var o=e.getChildren();o&&o.length>0&&(i+=1,o.forEach(function(e){t(e,n,i,s)}))}}p.start(this.name+" getNodesByPath");for(var n=[],i=this.getRoots(!1),s=0;s<i.length;s++)t(i[s],e,0,n);return p.end(this.name+" getNodesByPath"),n},getReportedAgainstFromSelectedNodes:function(){for(var e=this.getSelectedNodes(),t=[],n=0;n<e.length;n++){var i=e[n];i.options.baseType===I?i.options.reportedAgainst.forEach(function(e){t.push(e.physicalId)}):t.push(i.options.id)}return t},getIssuesFromSelectedNodes:function(){for(var e=this.getSelectedNodes(),t=[],n=0;n<e.length;n++){var i=e[n];i.options.baseType===I&&t.push(i)}return t},isBIFiltered:function(){var t=!1;if(e.is(this._getChildrenFilterInfo,"function")){var n=this._getChildrenFilterInfo();n&&e.is(n.childrenBeforeFiltering,"array")&&(t=n.childrenBeforeFiltering.length>0)}return t},_onPreExpand:function(e){p.start(this.name+" _onPreExpand");var t=e.data.nodeModel;t.removeChildren(),t.options.data.isExpandMultiple?t.options.data.expandEvent=e:this.updateNodesOnExpand([t],e)},updateNodesOnExpand:function(t,n){var s=this;p.start(s.name+"updateNodesOnExpand");var o=function(e,t,o){!0===t?(s._logger.warn("Expand request has failed: %o",e),i.displayNotification({msg:f.notifications.serverWarning,eventID:"warning"})):(s._logger.error("Expand request has failed: %o",e),i.displayNotification({msg:f.notifications.serverError,eventID:"error"})),""==o&&null==o||(o.options.children=[],o.options.data.isExpandMultiple&&o.options.data.expandEvent?o.options.data.expandEvent.target.preExpandDone({state:"collapsed"}):""!=n&&null!=n&&n.target.preExpandDone({state:"collapsed"}))};s.retrieveContentAndFetch(t).then(function(i){if(Array.isArray(i.body.results)){let l={};var a=[];i.body.results.forEach(t=>{let n={};var i="";t.attributes.forEach(t=>{switch(e.is(t.name,"string")?t.name.replace("ds6w:what/","").replace("ds6w:when/","").replace("ds6w:who/",""):t.name){case"resourceid":n.pid=t.value,""==i&&(i=t.value);break;case"ds6w:label":n.title=t.value;break;case"ds6w:type":n.type=t.value;break;case"ds6w:identifier":n.name=t.value;break;case"ds6wg:revision":n.revision=t.value;break;case"ds6w:policy":a.push(t.value);break;case"ds6w:kind":n.kind=t.value;break;case"ds6w:i3dx":""!=t.value&&(i=t.value)}}),n.data={...t,physicalId:i},l[i]=n}),a=[...new Set(a)],s.setClassContentType({policies:a}),t.forEach(e=>{e.removeChildren();var t={},i=[];let a=e.options.contexts;t.contexts=[],a.forEach(e=>{if(l[e.physicalId]){let{data:n,...s}=l[e.physicalId];s={...e,...s},t.contexts.push(s),i.push(l[e.physicalId].data)}});let r=e.options.reportedAgainst;t.reportedAgainst=[],r.forEach(e=>{if(l[e.physicalId]){let{data:n,...s}=l[e.physicalId];s={...e,...s},t.reportedAgainst.push(s),i.push(l[e.physicalId].data)}});let c=e.options.resolvedBy;t.resolvedBy=[],c.forEach(e=>{if(l[e.physicalId]){let{data:n,...s}=l[e.physicalId];s={...e,...s},t.resolvedBy.push(s),i.push(l[e.physicalId].data)}});let d=e.options.resolvedItems;t.resolvedItems=[],d.forEach(e=>{if(l[e.physicalId]){let{data:n,...s}=l[e.physicalId];s={...e,...s},t.resolvedItems.push(s),i.push(l[e.physicalId].data)}}),e.options.contexts=t.contexts,e.options.reportedAgainst=t.reportedAgainst,e.options.resolvedBy=t.resolvedBy,e.options.resolvedItems=t.resolvedItems;let u=[...new Map(i.map(e=>[e.physicalId,e])).values()];if(u.length>0)try{s.addChildren(e,{results:u}),e.options.data.isExpandMultiple&&e.options.data.expandEvent?e.options.data.expandEvent.target.preExpandDone({state:"expanded"}):""!=n&&null!=n&&n.target.preExpandDone({state:"expanded"})}catch(t){o(t.toString(),!1,e)}else e.options.children=null,e.options.data.isExpandMultiple&&e.options.data.expandEvent?e.options.data.expandEvent.target.preExpandDone({state:"collapsed"}):""!=n&&null!=n&&n.target.preExpandDone({state:"collapsed"}),e.setState({state:"noChildren"}),e.options.contexts=[],e.options.reportedAgainst=[],e.options.resolvedBy=[],e.options.resolvedItems=[],e.options.data.isExpandMultiple=!1});var r=[];t.forEach(e=>{null!=e.getChildren()&&e.options.children.forEach(e=>{"reportedAgainst"==e.options.data.relationToIssue&&r.push(e)})}),r.length>0&&s.fetchOccurencePath(r)}else t.forEach(e=>{e.options.children=null,e.options.data.isExpandMultiple&&e.options.data.expandEvent?e.options.data.expandEvent.target.preExpandDone({state:"collapsed"}):""!=n&&null!=n&&n.target.preExpandDone({state:"collapsed"}),e.setState({state:"noChildren"}),e.options.contexts=[],e.options.reportedAgainst=[],e.options.resolvedBy=[],e.options.resolvedItems=[],e.options.data.isExpandMultiple=!1})},function(e){o(e,!1,"")}).finally(function(){p.end(s.name+" _onPreExpand")})},retrieveContentAndFetch:function(e){var n=this;let i=[];return e.forEach(e=>{e.options.reportedAgainst.forEach(e=>{i.push(e.physicalId)}),e.options.resolvedBy.forEach(e=>{i.push(e.physicalId)}),e.options.contexts.forEach(e=>{i.push(e.physicalId)}),e.options.resolvedItems.forEach(e=>{i.push(e.physicalId)})}),i=[...new Set(i)],new t((e,s)=>{var o=parseInt(i.length/1e4);i.length/1e4>parseInt(i.length/1e4)&&o++;const a=[];n.results=[];for(let e=1;e<=o;e++){var r=i.map(function(t,n){if(n>=1e4*(e-1)&&n<1e4*e)return{physicalId:t}}).filter(function(e){return void 0!==e});let t=m.fetch({data:{objects:r,predicates:n.component.list.getPredicates()}}).then(function(e){Array.isArray(e.body.results)&&n.results.push(...e.body.results)}).catch(function(e){s(e)});a.push(t)}t.all(a).then(function(){let t={body:{results:n.results}};e(t)})})},_onPostExpand:function(t){p.start(this.name+" _onPostExpand");var n=t.data.nodeModel,i=d.get("widget")||window.widget,s=e.clone(i.getValue("expandedIds"));!1===Array.isArray(s)&&(s=[]),s.includes(n.options.physicalId)||s.push(n.options.physicalId),n.options.data.isExpandMultiple=!1,i.setValue("expandedIds",s),i.dispatchEvent("endEdit"),p.end(this.name+" _onPreExpand")},_onPostCollapse:function(t){p.start(this.name+" _onPostCollapse");var n=t.data.nodeModel,i=d.get("widget")||window.widget,s=e.clone(i.getValue("expandedIds"));!1===Array.isArray(s)&&(s=[]);var o=s.indexOf(n.options.physicalId);-1!==o&&(s.splice(o,1),i.setValue("expandedIds",s),i.dispatchEvent("endEdit")),p.end(this.name+" _onPreCollapse")},_subscribers:function(){var e=this;e.getXSO().onEmpty(function(){e.prepareBroadcastSelect(),setTimeout(function(){0===e.getSelectedNodes().length&&e.pushBroadcastSelect()},b)}),e.onPreExpand(function(t){e._onPreExpand(t)}),e.onPostExpand(function(t){e._onPostExpand(t)}),e.onPostCollapse(function(t){e._onPostCollapse(t)})},setClassContentType:function(e){var n={data:e};return new t(function(e,t){m.issues.getStatesAttributes(n).then(function(t){h.addCSSMaturityClasses("wux-controls-label",t),e()}).catch(function(e){return e})})},utils:{isJson:function(e){try{JSON.parse(e)}catch(e){return!1}return!0}}})}),define("DS/IssueManagement/views/kanban/Kanban",["UWA/Class/View","UWA/Core","DS/UIKIT/Tooltip","DS/Logger/Logger","DS/IssueManagement/views/kanban/Column","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon"],function(e,t,n,i,s,o,a,r,l){"use strict";var c=260,d={STATE:"state",PRIORITY:"priority",DUE_DATE:"resolutionDate",ALL:"all"},u="Create",m="Assign",p="Active",h="Review",g="Closed",f="Low",v="Medium",I="High",b="Urgent",y="Overdue",S="None",w="Today",C="Tomorrow",T="Week",E="Future",D="All",_={RIGHT:"right",BOTTOM:"bottom",CLOSED:"closed"},A=1,M=0;return e.extend({name:"DS/IssueManagement/views/kanban/Kanban",tagName:"div",className:"kanban-container",_logger:null,component:null,document:null,settings:{},columns:{state:[],priority:[],resolutionDate:[],all:[]},chizu:{container:null,tooltips:[],position:0},currentView:null,columnsListeners:[],siblings:{right:null,left:null},verticalLevelSelector:-1,_issuesNodesMapping:{},preventUnselectColumns:!1,_ctrlKey:!1,_subscribed:!1,setup:function(e){a.start(this.name+" setup"),this._parent(e),this._logger=i.getLogger("DS/IssueManagement/View"),this.component=e.component,this.document=null,this.settings=e.settings,this.columns={state:[],priority:[],resolutionDate:[],all:[]},this.chizu={container:null,tooltips:[],position:0},this.currentView=null,this.columnsListeners=[],this.siblings={right:null,left:null},this.verticalLevelSelector=-1,this._issuesNodesMapping={},this.preventUnselectColumns=!1,this._ctrlKey=!1,this._subscribed=!1,a.end(this.name+" setup")},render:function(){var e=this;a.start(e.name+" render"),e.columns.state.forEach(function(t){t.render().inject(e.container)}),e.columns.priority.forEach(function(t){t.render().inject(e.container)}),e.columns.resolutionDate.forEach(function(t){t.render().inject(e.container)}),e.columns.all.forEach(function(t){t.render().inject(e.container)});var i=o.get("widget").getValue("kanbanViewBy")||"state";return e.switchView(i),e.arrow=t.createElement("div",{class:"arrow-fonticon"}).inject(e.container),e.arrow.left=t.createElement("span",{class:"fonticon fonticon-2x fonticon-left-open"}).inject(e.arrow),e.arrow.leftTooltip=new n({position:"bottom",target:e.arrow.left,body:r.kanban.tooltips.leftArrow}),e.arrow.right=t.createElement("span",{class:"fonticon fonticon-2x fonticon-right-open"}).inject(e.arrow),e.arrow.rightTooltip=new n({position:"bottom",target:e.arrow.right,body:r.kanban.tooltips.rightArrow}),a.end(e.name+" render"),e},load:function(e){a.start(this.name+" load"),null!=e&&(this.document=e);var t=this.document.getRoots(!1),n={};n[u]=[],n[m]=[],n[p]=[],n[h]=[],n[g]=[];var i={};i[f]=[],i[v]=[],i[I]=[],i[b]=[];var c={};c[y]=[],c[S]=[],c[w]=[],c[C]=[],c[T]=[],c[E]=[];var _={};_[D]=[];var A=new Date;A.setHours(0,0,0,0);var M=new Date(A);M.setDate(M.getDate()-M.getDay()+8),this._issuesNodesMapping={};for(var N=0;N<t.length;N++){var x=t[N].options;if(this._issuesNodesMapping[t[N].options.id]=[],x.isSelected=t[N].isSelected(),n[x.state]&&i[x.priority]&&_[D])if(n[x.state].push(x),i[x.priority].push(x),_[D].push(x),void 0!==x.resolutionDate&&null!==x.resolutionDate&&""!==x.resolutionDate){var O=new Date(x.resolutionDate),P=O-A;if(isNaN(P))c[S].push(x);else{var k=P/1e3/60/60/24;if(k<0)c[y].push(x);else if(0<=k&&k<1)c[w].push(x);else if(1<=k&&k<2)c[C].push(x);else if(2<=k){O-M<0?c[T].push(x):c[E].push(x)}}}else c[S].push(x)}var V=o.get("maturityGraph");for(var L in n)if(n.hasOwnProperty(L)){var R=l.maturity[L.toLowerCase()];""!==V&&null!=V&&(R=V[L]);var U=new s({id:d.STATE+L.replace(/ /g,"+").toLowerCase(),kanban:this,title:R,models:n[L],attributeKeyValue:{key:d.STATE,value:L}});this.columns.state.push(U)}for(var F in i)if(i.hasOwnProperty(F)){var j=new s({id:d.PRIORITY+F.replace(/ /g,"+").toLowerCase(),kanban:this,title:l.priorities[F.toLowerCase()],models:i[F],attributeKeyValue:{key:d.PRIORITY,value:F}});this.columns.priority.push(j)}for(var B in c)if(c.hasOwnProperty(B)){var W=new s({id:d.DUE_DATE+B.replace(/ /g,"+").toLowerCase(),kanban:this,title:r.kanban.resolutionDate[B.toLowerCase()],models:c[B],attributeKeyValue:{key:d.DUE_DATE,value:B}});this.columns.resolutionDate.push(W)}for(var z in _)if(_.hasOwnProperty(z)){var H=new s({id:d.ALL,kanban:this,title:r.kanban.all,models:_[z],attributeKeyValue:{key:d.ALL,value:z}});this.columns.all.push(H)}return this._subscribers(),a.end(this.name+" load"),this},refresh:function(){for(var e in a.start(this.name+" refresh"),this.preventUnselectColumns=!0,this.container.empty(),this.columns)this.columns.hasOwnProperty(e)&&(this.columns[e].forEach(function(e){e.destroy()}),this.columns[e]=[]);this.chizu.tooltips.forEach(function(e){e.destroy(),e=null}),this.chizu.container.destroy(),this.chizu={container:null,tooltips:[],position:0},this.load(),this.render(),a.end(this.name+" refresh")},destroy:function(){this._stopListeningToColumns(),this._logger=null,this.component=null,this.document=null,this.settings={},this.columns={state:[],priority:[],resolutionDate:[],all:[]},this.chizu.tooltips.forEach(function(e){e.destroy(),e=null}),this.chizu.container.destroy(),this.chizu={container:null,tooltips:[],position:0},this.currentView=null,this.columnsListeners=[],this.siblings={right:null,left:null},this.verticalLevelSelector=-1,this._issuesNodesMapping={},this.preventUnselectColumns=!1,this._ctrlKey=!1,this._subscribed=!1},resize:function(){if(this.container&&this.container.getParent()){var e=o.get("application"),t=e.elements.body,n=e.information.container,i=t.offsetWidth,s=t.offsetHeight,a=o.get("information");a.isOpened()&&(a.getLayout().current,_.RIGHT),a.isOpened()&&a.getLayout().current===_.BOTTOM&&(s-=n.offsetHeight);var r=i,l=this.container.getElements(".kanban-container-column.visible");if(0!==l.length){var d=l[M].offsetWidth,u=r/(d=(d=d>c?c:d)<c?c:d);0==(u=Math.floor(u))&&(u=1);var m=this.chizu.position,p=m;u<l.length&&(u===l.length-m||u>l.length-m&&(p=m-(u-(l.length-m))));var h=p,g=p+u;l.forEach(function(e,t){e.setStyle("max-height",s),h<=t&&t<g?(e.show(),e.setStyle("width",d)):e.hide()}),this._setChizu(l,u,p)}}},switchView:function(e){for(var t in this.chizu.position=0,this.columns)this.columns.hasOwnProperty(t)&&(t!==e?this.columns[t].forEach(function(e){e.hide(),e.container.removeClassName("visible")}):(this.currentView=t,this._stopListeningToColumns(),this._listenToColumns(),this.columns[t].forEach(function(e,t){e.show(),0===t&&e.container.addClassName("visible first"),e.container.addClassName("visible")})));this.resize()},getSelectedNodes:function(){for(var e=[],t=0;t<this.columns[this.currentView].length;t++)e=e.concat(this.columns[this.currentView][t].getSelectedNodes());return e},getSelectedIssues:function(){for(var e=[],t=0;t<this.columns[this.currentView].length;t++){var n=this.columns[this.currentView][t].getSelectedNodes().map(function(e){return e.options.id});e=e.concat(n)}return e},_setChizu:function(e,i,s){var o=this;o.chizu.position=s;var a=[],l=[],c=0;e.forEach(function(e,d){var u="";d<s||c<i&&(u="displayed",c+=1);var m=t.createElement("div",{class:"chizu-placeholder-column "+u,events:{click:function(){var e=o.container.getElements(".kanban-container-column.visible"),t=0,n=e.length-d;n<i&&(d-=i-n);for(var s=0;s<e.length;s++)s<d?e[s].hide():t<i?(e[s].show(),e[s].setStyle("width",100/i+"%"),t+=1):e[s].hide();o._setChizu(e,i,d)}}});l.push(new n({position:"top",target:m,body:r.replace(r.kanban.tooltips.chizu,{title:o.columns[o.currentView][d].getOption("title")+" ("+o.columns[o.currentView][d].getTreeDocument().getRoots(!1).length+")"})})),a.push(m)}),null===o.chizu.container?(o.chizu.container=t.createElement("div",{class:"chizu",html:[{tag:"div",class:"chizu-placeholder-columns",html:a}]}),o.chizu.tooltips=l,o.chizu.container.inject(o.container)):(o.chizu.tooltips.forEach(function(e){e.destroy(),e=null}),o.chizu.tooltips=l,o.chizu.container.getElement(".chizu-placeholder-columns").setContent(a)),1===e.length?o.chizu.container&&!o.chizu.container.hasClassName("chizu-hidden")&&o.chizu.container.addClassName("chizu-hidden"):o.chizu.container&&o.chizu.container.hasClassName("chizu-hidden")&&o.chizu.container.removeClassName("chizu-hidden"),0===s?o.arrow.left&&!o.arrow.left.hasClassName("disable")&&o.arrow.left.addClassName("disable"):o.arrow.left&&o.arrow.left.hasClassName("disable")&&o.arrow.left.removeClassName("disable"),e.length<=c+s?o.arrow.right&&!o.arrow.right.hasClassName("disable")&&o.arrow.right.addClassName("disable"):o.arrow.right&&o.arrow.right.hasClassName("disable")&&o.arrow.right.removeClassName("disable"),o.clickLeftArrowEventListener&&o.arrow.left.removeEventListener("click",o.clickLeftArrowEventListener),o.clickLeftArrowEventListener=function(){e.forEach(function(e,t){t>=s-1&&t<=s+c-2?(e.show(),e.setStyle("width",100/c+"%")):e.hide()}),o._setChizu(e,i,s-1)},o.arrow.left.addEventListener("click",o.clickLeftArrowEventListener),o.clickRightArrowEventListener&&o.arrow.right.removeEventListener("click",o.clickRightArrowEventListener),o.clickRightArrowEventListener=function(){e.forEach(function(e,t){t>=s+1&&t<=s+c?(e.show(),e.setStyle("width",100/c+"%")):e.hide()}),o._setChizu(e,i,s+1)},o.arrow.right.addEventListener("click",o.clickRightArrowEventListener)},_listenToColumns:function(){var e=this,n=e.utils.debounce(function(n){if("select"===n.event){e.verticalLevelSelector=n.node.data.virtualRowID;for(var i=e.columns[n.column.attributeKeyValue.key],s=0;s<i.length;s++)n.column.id===i[s].id&&(e.siblings.right=t.is(i[s+1],"object")?i[s+1]:null,e.siblings.left=t.is(i[s-1],"object")?i[s-1]:null)}if(e.preventUnselectColumns)e.preventUnselectColumns=!1;else if(!e._ctrlKey&&"select"===n.event)for(var o=0;o<e.columns[e.currentView].length;o++)e.columns[e.currentView][o]!==n.column&&e.columns[e.currentView][o].unselectAll();e.dispatchEvent("onSelect")}.bind(e),A);e.columns[e.currentView].forEach(function(t){e.listenTo(t,"onSelect",n),e.columnsListeners.push({component:t,event:"onSelect"}),e.listenTo(t,"onUnselectAll",function(){for(var t=0;t<e.columns[e.currentView].length;t++)e.columns[e.currentView][t].unselectAll()}),e.columnsListeners.push({component:t,event:"onUnselectAll"})})},_stopListeningToColumns:function(){var e=this;e.columnsListeners.forEach(function(t){e.stopListening(t.component,t.event)}),e.columnsListeners=[]},_subscribers:function(){var e=this;if(!1===e._subscribed){var t=o.get("widget")||window.widget;t.body.addEventListener("keydown",function(t){e.container.getParent().isHidden()||17===t.keyCode&&(e._ctrlKey=!0)}),t.body.addEventListener("keyup",function(t){e.container.getParent().isHidden()||17===t.keyCode&&(e._ctrlKey=!1)}),e._subscribed=!0}},utils:{_debounceTimeouts:[],debounce:function(e,t,n){var i,s=this;return function(){var o=this,a=arguments,r=n&&!i;clearTimeout(i);var l=s._debounceTimeouts.indexOf(i);-1!==l&&s._debounceTimeouts.splice(l,1),i=setTimeout(function(){i=null,n||e.apply(o,a)},t),s._debounceTimeouts.push(i),r&&e.apply(o,a)}}}})}),define("DS/IssueManagement/Component",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Iconbar","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Tooltip","DS/Logger/Logger","DS/WebappsUtils/WebappsUtils","DS/PlatformAPI/PlatformAPI","DS/IssueComponents/open/Open","DS/IssueCommon/utils/TaskManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/models/TreeDocument","DS/IssueManagement/utils/BIFilter","DS/IssueCommon/utils/ModelParser","DS/IssueManagement/utils/Synchronizer","DS/IssueManagement/views/kanban/Kanban","DS/IssueManagement/views/list/TreeList","DS/IssueManagement/views/datagrid/DataGrid","DS/DataGridView/DataGridView","DS/Tree/TreeNodeView","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/LocalStorage","DS/IssueServices/utils/Performance","DS/IssueManagement/components/header/IssueDataGridToolbar","text!DS/IssueManagement/assets/Settings.json","text!DS/IssueManagement/assets/IssueManagement.1D.json","text!DS/IssueManagement/assets/IssueManagement.2D.json","text!DS/IssueManagement/assets/IssueManagement.dataGrid.json","i18n!DS/IssueManagement/assets/nls/IssueManagement"],function(e,t,n,i,s,o,a,r,l,c,d,u,m,p,h,g,f,v,I,b,y,S,w,C,T,E,D,_,A,M,N,x,O,P,k){"use strict";var V="ENXISSU_AP",L="CUSTOM_ATTR_INFOS",R=0,U=0,F="ListView",j="KanbanView",B="IFB",W={ISU_TASK_MANAGER:"ISU_TASK_MANAGER"},z={FILTER:"FILTER",PREFERENCES:"PREFERENCES",GET_FILTERED_ISSUES:"GET_FILTERED_ISSUES"};return t.extend(f,{name:"DS/IssueManagement/Component",tag:"div",className:"im-main-component",_logger:null,defaultOptions:{document:{},kanban:JSON.parse(x),settings:JSON.parse(N)},containers:{list:null,kanban:null},document:null,list:null,kanban:null,synchronizer:null,taskManager:null,_subscriberTokens:[],_tasks:{subscriberTokens:[],current:null},_timestampUpdate:0,_subscriberId:"",setup:function(e){if(this.attributes=[],this._logger=r.getLogger("DS/IssueManagement/Component"),this._parent(e),this.container.empty(),this.containers.list=n.createElement("div",{class:"issue-list-container"}),this.containers.kanban=n.createElement("div",{class:"issue-kanban-container"}),this.document=new g({component:this,settings:this.getOption("settings"),document:this.getOption("document")}),this.listView=T.get("ISU_LISTVIEW"),this.isAnyFilterSelected=!1,this.settings=JSON.parse(N),this.listView)this.setOption("list",JSON.parse(O)),this.list=new y({component:this,settings:this.getOption("settings"),list:this.getOption("list")});else{var t=JSON.parse(P);this.setOption("list",t),this.list=new S({component:this,container:this.containers.list,settings:this.getOption("settings"),treeDocument:this.document,columns:this.getOption("list").columns,showNodeKPIColorFlag:!0,showContextualMenuColumnFlag:!0,showRowBorderFlag:!0,placeholder:k.emptyDataGridPlaceHolder,showAlternateBackgroundFlag:!0,useWidgetPreferencesFlag:!0,identifier:"ISUSummaryView",columnDefinitionUpdated:!1,rowGroupingEnabledFlag:!1})}this.kanban=new b({component:this,settings:this.getOption("settings"),kanban:this.getOption("kanban")}),this.synchronizer=new I({list:this.list,kanban:this.kanban}),this._subscriberId=Math.random().toString(36).substr(2,9),this.taskManager=u,this._subscriberTokens=[],this._tasks={subscriberTokens:[],current:null},this._timestampUpdate=0,this.utils._setTypesCallbackSubscribe=!1,this.initializeBIFilter(),this._subscribers(),this._subscribersTaskManager(),this.setPADContext()},render:function(){A.start(this.name+" render"),this.containers.list.inject(this.container),this.containers.kanban.inject(this.container),this.getCurrentView()===j?(this.containers.list.addClassName("hidden"),this.containers.kanban.removeClassName("hidden")):(this.containers.list.removeClassName("hidden"),this.containers.kanban.addClassName("hidden")),this.containers.list.setContent(this.list.getContent()),this.containers.kanban.setContent(this.kanban.render());var e=this.document.getRoots();return 0===e.length&&(this.containers.list.hide(),this.containers.kanban.hide()),this.container.addEventListener("contextmenu",function(e){e.preventDefault()},this),A.end(this.name+" render"),this.dispatchEvent("onReady",{roots:e}),this},build:function(){var e=this;A.start(e.name+" build");var t=(T.get("widget")||window.widget).getValue("filter");t=JSON.parse(t);return T.get("LoadData_ModelerAPI")?e.load_v2().then(function(){return e.list.load(e.document)}).then(function(){return e.kanban.load(e.document)}).then(function(){return e.synchronizer.start()}).then(function(){e.render(),A.end(e.name+" build")}):e.load().then(function(){return e.list.load(e.document)}).then(function(){return e.kanban.load(e.document)}).then(function(){return e.synchronizer.start()}).then(function(){e.render(),A.end(e.name+" build")})},load_v2:function(){var t=this;A.start(t.name+" load");var i=T.get("widget")||window.widget,s=i.getValue("filter"),a=void 0===i.getValue("affectedItemSetting")||i.getValue("affectedItemSetting"),r=void 0===i.getValue("resolvedItemSetting")||i.getValue("resolvedItemSetting"),l=void 0===i.getValue("contextSetting")||i.getValue("contextSetting");return!0===t.utils.isJson(s)?((s=JSON.parse(s)).onlyids=!1,s.affectedItem=a,s.resolvedItem=r,s.context=l):s={},t.isAnyFilterSelected=t.isFilteringRequestEligible(),!t.isAnyFilterSelected&&t.settings.hideNoFilterSelectionPreference?(t.getTreeDocument().removeIssueRoots(),t.placeholder.show(t.container,!1),t.dispatchEvent("onRootsRemoved",{}),o.unmask(i.body),new e(function(e){e([])})):E.issues.filter({version:"2.0",data:{filter:s}}).then(function(i){if(void 0!==i.success&&!1===i.success){if(i.body&&i.body.error&&i.body.error.internal&&n.is(i.body.error.internal,"string")){var o=i.body.error.internal;if(o.includes("No business object")||o.includes("not exist")){var a=m.getErrorMessage("0");m.displayErrorMessage(a,"error")}}e.resolve([])}var r=v.parse(i.body);0===r.length&&t.placeholder.show(t.container,t.isAnyFilterSelected),t.document.addRoots(r).then(()=>{const e=t.document.getRoots();t.document.getModelEvents().publish({event:"setPathTags"}),t.loadInfo_fetchV2(e);T.get("ISU_TYPE_NLS");t.getClassificationIds(s).then(e=>{t.addClassificationAttrToColumnsList(e)}),t.getCustomAttrValues(s).then(e=>{t.updateCustomAttrValuesInDatagrid(e)}),t.updateNLSValuesInDatagrid(r)})})},addClassificationAttrToColumnsList:function(e){let t=[];e&&e.body&&Array.isArray(e.body)&&e.body.map(e=>{if(e.attribute&&Array.isArray(e.attribute)&&e.attribute.length){let n=e.attribute[0]["to[Classified Item].from.id"];""!=n&&(n=(n=(n=n.replace("[","")).replace("]","")).split(", "),t.push(...n))}});let n=[...new Set(t)];n.length?this.getClassificationAttributeValues(n):this._dispatchEventForRestoreCustomView()},addCustomAttrToColumnsList:function(){var e=this;let t={...T.get("CustomAttributesPredicates")};e.list.prepareUpdateView();let n=T.get(L);Array.isArray(n)&&n.forEach(function(n){const i=m.getTypeRepOfAttribute(n);var s={column:{name:n.name,text:n.nlsName,dataIndex:n.selectable,isDraggable:!0,isHidden:!0,visibleFlag:!1,export:{value:!0,lock:!1},moveable:!0,width:120,minWidth:5,isCustomColumn:"Attribute",ds6wIndexMapping:n.uri,isOOTBColumn:!0,typeRepresentation:i}};e.list.getManager().getColumns().filter(e=>e.dataIndex==s.column.dataIndex).length<=0&&e.list.getManager().removeColumnOrGroup(n.selectable),t[n.selectable]||(t[n.selectable]=s.column)}),T.add("CustomAttributesPredicates",t),e.list.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)},updateCustomAttrValuesInDatagrid:function(e){var t={};for(let a=0;a<e.body.length;a++){var n=e.body[a].attribute,i=e.body[a].physicalId,s={};if(n&&Array.isArray(n)){for(var o=0;o<n.length;o++){let e=Object.keys(n[o])[0],t=n[o][e];const i=m.getFormattedValueAsPerTypeRepresentation(e,t);switch(e=(e=e.replace("attribute[","")).replace("]","")){case"Waiting On":s.Approvals="Unassigned"!==i&&""!==i,s["ds6w:validation"]={},s["ds6w:validation"].activated="Unassigned"!==i&&""!==i;break;default:s[e]=i}}t[i]=s}}var a=this.document.getRoots(!1);this.document.undoRegisterNodeModelUpdateEvent(),this.document.withTransactionUpdate(function(){for(var e=0;e<a.length;e++){var n=a[e];if(t[n.options.physicalId]){var i=t[n.options.physicalId];n.updateOptions({validation:{activated:i["ds6w:validation"].activated},grid:i})}}}),this.document.registerNodeModelUpdateEvent()},updateNLSValuesInDatagrid:function(e){var t=this,n=[],i=[];e.forEach(e=>{n.push(e.organization),i.push(e.collaborativeSpace),n.push(e.responsibleOrganization),n.push(e.reportingOrganization)});var s={"ds6w:organizationResponsible":n,"ds6w:project":i};E.getNLSValuesPromise(s).then(n=>{if(null!=n){var i=n["ds6w:organizationResponsible"],s=n["ds6w:project"];t.getTreeDocument().withTransactionUpdate(function(){for(var n={},o=0;o<e.length;o++){var a=e[o],r=a.physicalId,l={};Object.keys(i).forEach(function(e){e==a.organization&&(l.organization=i[e]),e==a.responsibleOrganization&&(l.responsibleOrganizationTitle=i[e]),e==a.reportingOrganization&&(l.reportingOrganizationTitle=i[e])}),Object.keys(s).forEach(function(e){e==a.collaborativeSpace&&(l.collaborativeSpaceTitle=s[e])}),n[r]=l}for(var c=t.document.getRoots(!1),d=0;d<c.length;d++){var u=c[d];if(n[u.options.physicalId]){var m=n[u.options.physicalId];u.updateOptions({grid:{"ds6w:collaborativeSpace":m.collaborativeSpaceTitle,"ds6w:organization":m.organization,"ds6w:responsibleOrganization":m.responsibleOrganizationTitle,"ds6w:reportingOrganization":m.reportingOrganizationTitle},collaborativeSpaceTitle:m.collaborativeSpaceTitle,organization:m.organization,reportingOrganization:m.reportingOrganizationTitle,responsibleOrganization:m.responsibleOrganizationTitle})}}})}})},getCustomAttrValues:function(t){var n=[];let i=T.get(L);return Array.isArray(i)?(i.forEach(e=>{let t=e.selectable,i={predicate:e.uri,selectable:t};n.push(i)}),JSON.parse(P).columns.forEach(e=>{if(e.isGenericResource){let t={predicate:e.predicate,selectable:e.selectable};n.push(t)}}),E.issues.customAttrFilter({version:"2.0",data:{filter:t,customAttrInfo:n}})):e.reject()},getClassificationIds:function(e){return E.classification.getClassIds({version:"1.0",data:{filter:e}})},getClassificationAttributeValues:async function(e){var t=this;await t.getClassificationAttrValues(e).then(e=>{t.attributes=[];let n={...T.get("CustomAttributesPredicates")};e.forEach(function(e){e.classAttributes.forEach(function(e){const i=m.getTypeRepOfAttribute(e);if(!t.attributes.includes(e.name)){t.attributes.push(e.name);var s={column:{text:e.name,dataIndex:e.name,isDraggable:!0,isHidden:!0,visibleFlag:!1,export:{value:!0,lock:!1},moveable:!0,width:120,minWidth:5,isCustomColumn:"Classification",isOOTBColumn:!0,ds6wIndexMapping:e.name,typeRepresentation:i}},o={that:t,attr:e};s.column.getCellValue=t.list.rendering.classificationAttributes.bind(o),t.list.getManager().getColumns().filter(e=>e.dataIndex==s.column.dataIndex).length<=0&&(t.list.getManager().removeColumnOrGroup(e.name),t.list.getManager().addColumnOrGroup(s.column),m.setColumnFilteringOnColumn(t.list,s.column)),n[e.name]=s.column}})}),T.add("CustomAttributesPredicates",n),t._dispatchEventForRestoreCustomView()})},getClassificationAttrValues:function(t){var n=[];return t.forEach(function(t){var i=new e(function(e){E.classification.getClassificationAttributesOfClass({id:t,onFailure:function(e){}}).then(function(n){if(n.member){var i={classAttributes:n.member[0].ClassAttributes.member,classID:t};e(i)}else e()})});n.push(i)}),e.all(n)},loadInfo:function(t){var n=this,i=t.map(e=>e.options.physicalId);return new e(function(e,s){E.issues.retrieve({timestamp:n._timestampUpdate?n._timestampUpdate:null,data:{objects:i.map(function(e){return{physicalId:e}})},onComplete:function(i){Array.isArray(i.results)?n.getTreeDocument().withTransactionUpdate(function(){for(var n={},s=0;s<i.results.length;s++){var o=i.results[s].body,a=o.physicalId,r={};r.reportedAgainst=o.reportedAgainst,r.resolvedBy=o.resolvedBy,r.resolvedItems=o.resolvedItems,r.contexts=o.contexts,n[a]=r}for(var l=0;l<t.length;l++){var c=t[l];if(n[c.options.physicalId]){var d=n[c.options.physicalId];c.updateOptions({reportedAgainst:d.reportedAgainst,resolvedItems:d.resolvedItems,resolvedBy:d.resolvedBy,contexts:d.contexts})}}e()}):s(new Error("Unexpected response when retrieving issues."))},onFailure:function(e){n._logger.log("getIssues :Failure..."+e),s(e)}})})},loadInfo_fetchV2:function(t){var i=this;return 0==t.length?e.resolve():new e(function(e,s){i.getTreeDocument().retrieveContentAndFetch(t).then(o=>{Array.isArray(o.body.results)?i.getTreeDocument().withTransactionUpdate(function(){let i={};o.body.results.forEach(e=>{let t={};var s="";e.attributes.forEach(e=>{switch(n.is(e.name,"string")?e.name.replace("ds6w:what/","").replace("ds6w:when/","").replace("ds6w:who/",""):e.name){case"resourceid":t.pid=e.value,""==s&&(s=e.value);break;case"ds6w:label":t.title=e.value;break;case"ds6w:type":t.type=e.value,t.objectType=e.value;break;case"ds6w:identifier":t.name=e.value;break;case"ds6wg:revision":t.revision=e.value;break;case"ds6w:kind":t.kind=e.value;break;case"ds6w:i3dx":""!=e.value&&(s=e.value)}}),i[s]=t});for(var s=0;s<t.length;s++){var a=t[s],r={};let e=a.options.contexts;r.contexts=[],e.forEach(e=>{if(i[e.physicalId]){let t={};t={...e,...i[e.physicalId]},r.contexts.push(t)}});let n=a.options.reportedAgainst;r.reportedAgainst=[],n.forEach(e=>{if(i[e.physicalId]){let t={};t={...e,...i[e.physicalId]},r.reportedAgainst.push(t)}});let o=a.options.resolvedBy;r.resolvedBy=[],o.forEach(e=>{if(i[e.physicalId]){let t={};t={...e,...i[e.physicalId]},r.resolvedBy.push(t)}});let l=a.options.resolvedItems;r.resolvedItems=[],l.forEach(e=>{if(i[e.physicalId]){let t={};t={...e,...i[e.physicalId]},r.resolvedItems.push(t)}}),a.updateOptions({reportedAgainst:r.reportedAgainst,resolvedItems:r.resolvedItems,resolvedBy:r.resolvedBy,contexts:r.contexts})}e()}):s(new Error("Unexpected response when retrieving issues."))})})},onPostInitialize:function(){var e=this,t=T.get("widget")||window.widget,n=t.getValue("expandedIds");if(!0===Array.isArray(n)){for(var i=[],s=0;s<n.length;s++){var o=e.getNodesById(n[s]);o.length>0&&Array.isArray(o)&&i.push(o[0])}for(var a=0;a<i.length;a++)i[a].options.data.isExpandMultiple=!0,i[a].expand();i.length>0&&e.getTreeDocument().updateNodesOnExpand(i)}e.document.getRoots().length>0&&e.loadBIFilterPreference();var r=T.get("information");r&&r.isOpened()&&r.fullScreenMode&&((i=e.document.getRoots(!1)).length>0&&(e.document.prepareBroadcastSelect(),e.document.withTransactionUpdate(function(){e.document.unselectAll(),i[0].select(),e.document.pushBroadcastSelect()})));t.getValue("contextFilter")&&T.get("filter").showContextFilter();try{require(["DS/WebappsUtils/WebappsUtils","DS/IssueComponents/konami/Konami"],function(e,t){t.kojima()})}catch(e){}},destroy:function(){this._subscriberTokens.forEach(function(e){T.get("eventsHandler").unsubscribe(e)}),this._tasks.subscriberTokens.forEach(function(e){T.get("eventsHandler").unsubscribe(e)}),this.document.removeEventListener("onRootsAdded"),this.document.removeEventListener("onRootsRemoved"),this.document.empty(),this.document=null,this.synchronizer=null,this.list.destroy(),this.list=null,this.kanban.destroy(),this.kanban=null,this.containers={list:null,kanban:null},this._timestampUpdate=0,this._subscriberTokens=[],this.utils._setTypesCallbackSubscribe=!1,this._tasks={subscriberTokens:[],current:null},this.taskManager.destroy(),this.taskManager=null,this._subscriberId=""},refresh_New:function(t){var n=this,i=T.get("widget")||window.widget;if(o.mask(i.body),T.get("filter").refresh(),n.isAnyFilterSelected=n.isFilteringRequestEligible(),!n.isAnyFilterSelected&&n.settings.hideNoFilterSelectionPreference)return n.getTreeDocument().removeIssueRoots(),n.placeholder.show(n.container,n.isAnyFilterSelected),n.dispatchEvent("onRootsRemoved",{}),n.publishFilteredIssues(),o.unmask(i.body),new e(function(e){e([])});n.document.refresh_v2(t).then(function(){0===n.document.getRoots().length?(n.placeholder.show(n.container,n.isAnyFilterSelected),n.dispatchEvent("onRootsRemoved",{})):n.placeholder.hide(n.container),n.list.preferences.loadSortPreference(),p.buildCustomViewOptions(n.list,n.list.container),p.restoreCustomViews(n.list),n.document.getModelEvents().publish({event:"setPathTags"}),n.dispatchEvent("onRefreshComplete"),n.publishFilteredIssues(),o.unmask(i.body)})},resize:function(){null!==this.kanban&&this.kanban.resize()},switchView:function(e){(_.setItem("view",{name:e}),e===j)?(this.containers.list.addClassName("hidden"),this.containers.kanban.removeClassName("hidden"),h.disable(["Selection","Find"]),this.synchronizer._refreshKanban()):(this.containers.list.removeClassName("hidden"),this.containers.kanban.addClassName("hidden"),0===this.getTreeDocument().getRoots(!1).length?h.idling():h.enable(["Selection"]))},publishSelect:function(e){var t=T.get("widget")||window.widget;T.get("eventsHandler").publish(this._subscriberId,"DS/Object/select",{metadata:{appId:t.id,appName:t.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:e.paths,attributes:e.attributes},version:"1.0"})},publishUpdate:function(e,t){var i=T.get("widget")||window.widget;T.get("eventsHandler").publish(this._subscriberId,"DS/Object/update",{metadata:{appId:i.id,appName:i.name,timestamp:Math.floor(Date.now()),options:n.is(t,"object")?t:{}},data:{paths:e.paths,attributes:e.attributes},version:"1.0"})},publishPreferences:function(){for(var e=T.get("widget")||window.widget,t=[],n=this.getTreeDocument().getRoots(!1),i=0;i<n.length;i++)t.push(n[i].options.physicalId);T.get("eventsHandler").publish(this._subscriberId,"DS/Widget/preferences",{metadata:{appId:e.id,appName:e.name,timestamp:Math.floor(Date.now())},data:{preferences:JSON.stringify(e.getPreferences())},version:"1.0"})},publishFilteredIssues:function(){for(var e=T.get("widget"),t=[],n=this.getTreeDocument().getRoots(!1),i=0;i<n.length;i++)t.push(n[i].options.physicalId);T.get("eventsHandler").publish(this._subscriberId,"DS/ENXISSU_AP/Filter/Issues",{metadata:{appId:e.id,appName:e.name,timestamp:Math.floor(Date.now())},data:{filter:{issues:t}},version:"1.0"})},publishCompass:function(){this.utils.setTypesCallbackForOFW(this.document.getSelectedNodes())},getSelectedNodes:function(){return this.document.getSelectedNodes()},getNodesById:function(e){return this.document.getNodesById(e)},getTreeDocument:function(){return this.document},getTreeListView:function(){return this.list},getManager:function(){return this.list},getKanbanView:function(){return this.kanban},getCurrentView:function(){var e=_.getItem("view");return null!==e&&e.name?e.name:(_.setItem("view",{name:F}),F)},getSessionOrFilteredRoots:function(){var e=[],t=this.getTreeDocument();if(!0===t.isBIFiltered())for(var n=t.getRoots(!1),i=0;i<n.length;i++)e.push(n[i].options.physicalId);else{var s=T.get("widget"),o=s.getValue("filter");!0===t.utils.isJson(o)&&!0===(o=JSON.parse(o)).session&&(e=s.getValue("roots"))}return e},_subscribers:function(){var t=this,n=T.get("widget")||window.widget,i=T.get("eventsHandler");t.document.addEventListener("onRootsAdded",function(e){t.placeholder.hide(t.container),t.dispatchEvent("onRootsAdded",e)}),t.document.addEventListener("onRootsRemoved",function(e){0===t.document.getRoots().length&&t.placeholder.show(t.container),t.dispatchEvent("onRootsRemoved",e),t.document.getModelEvents().publish({event:"setPathTags"})}),t.listenTo(t,"onResize",function(){T.get("application").resize()}),t.listenTo(t,"restoreCustomViewColumns",function(){t.list.restoreCustomView()}),t._subscriberTokens.push(i.subscribe(t._subscriberId,"DS/Object/create",function(n){A.start(t.name+" DS/Object/create");var i=n.data.attributes;t.document.refreshNodesById({timestamp:n.metadata.timestamp,created:Object.keys(i)}).then(function(n){t.document.withBroadcastSelect(new e(function(e){t.document.withTransactionUpdate(function(){t.document.unselectAll();for(var i=n.created,s=0;s<i.length;s++)i[s].select();e()})})),A.end(t.name+" DS/Object/create")})})),t._subscriberTokens.push(i.subscribe(t._subscriberId,"DS/Object/update",function(e){var n=e.data.attributes;t.document.refreshNodesById({timestamp:e.metadata.timestamp,modified:Object.keys(n)}).then(function(){A.end(t.name+" DS/Object/update")})})),t._subscriberTokens.push(i.subscribe(t._subscriberId,"DS/Object/delete",function(e){A.start(t.name+" DS/Object/delete");var n=t.document,i=[];e.data.paths.forEach(function(e){i.push(e.pop())}),n.removeRootsById(i).then(function(){A.end(t.name+" DS/Object/delete")})})),t._subscriberTokens.push(i.subscribe(t._subscriberId,"DS/Object/select",function(e){var i=e.data.paths;if(e.metadata.appId!==n.id&&!(t._tasks&&t._tasks.current&&t._tasks.current.taskType&&"SELECT_IN_3D"===t._tasks.current.taskType)){A.start(t.name+" DS/Object/select");var s=t.document;s.withTransactionUpdate(function(){for(var n=t.getSelectedNodes(),o=t.getTreeListView(),a=0;a<i.length;a++){var r=s.getNodesById(i[a][R]);if(r.length>0){var l=r[R];A.start(t.name+" scrollToNode"),t.listView?0!==a||o.getManager().isNodeInVisibleViewport(l)||o.getManager().scrollToNode(l,"top",!1):o.ensureNodeModelVisible(l),A.end(t.name+" scrollToNode"),n.forEach(function(e){e.unselect()}),l.select()}}h.select(t.getSelectedNodes()),m.publishSelectAll(e.data),A.end(t.name+" DS/Object/select")})}}))},_subscribersTaskManager:function(){var t=this,i=T.get("widget")||window.widget,s=T.get("eventsHandler");t._tasks.subscriberTokens.push(s.subscribe(t._subscriberId,"DS/IssueManagementTask/add",function(e){if(A.start(t.name+" DS/IssueManagementTask/add"),n.is(e.metadata,"object")&&n.is(e.metadata.options,"object")&&n.equals(e.metadata.options[W.ISU_TASK_MANAGER],W.ISU_TASK_MANAGER)&&Array.isArray(e.data.paths)&&e.data.paths.length>0){var s=e.data.paths[R][R],o=e.data.attributes[s];if(!n.is(t._tasks.current)&&(l=i.body.getDimensions().height,c=window.getComputedStyle(i.body),0!==l&&"none"!==c.display&&-1!==Object.keys(z).indexOf(o.taskType))){var a=[],r={};a.push([s]),r[s]={taskType:o.taskType,widgetIdIM:o.widgetIdIM,widgetId3D:i.id},T.get("eventsHandler").publish(t._subscriberId,"DS/IssueManagementTask/ready",{metadata:{appId:i.id,appName:i.name,timestamp:Math.floor(Date.now()),options:n.clone(e.metadata.options)},data:{paths:a,attributes:r},version:"1.0"})}}var l,c;A.end(t.name+" DS/IssueManagementTask/add")})),t._tasks.subscriberTokens.push(s.subscribe(t._subscriberId,"DS/IssueManagementTask/exec",function(s){if(A.start(t.name+" DS/IssueManagementTask/exec"),n.is(s.metadata,"object")&&n.is(s.metadata.options,"object")&&n.equals(s.metadata.options[W.ISU_TASK_MANAGER],W.ISU_TASK_MANAGER)&&Array.isArray(s.data.paths)&&s.data.paths.length>0){var o=s.data.paths[R][R],a=s.data.attributes[o];i.name===V&&a.widgetId3D===i.id&&new e(function(e){e()}).then(function(){t._tasks.current={taskId:o,taskType:a.taskType,widgetIdIM:a.widgetIdIM,widgetId3D:i.id}}).then(function(){return n.is(t._taskHandlers[a.taskType],"function")?t._taskHandlers[a.taskType].call(t,a.args):e.resolve()}).then(function(e){n.is(e,"object")&&(t._tasks.current.cancel=e)}).catch(function(e){t._tasks.current=null,t._logger.error(e)})}A.end(t.name+" DS/IssueManagementTask/exec")})),t._tasks.subscriberTokens.push(s.subscribe(t._subscriberId,"DS/IssueManagementTask/cancel",function(e){if(A.start(t.name+" DS/IssueManagementTask/cancel"),n.is(e.metadata,"object")&&n.is(e.metadata.options,"object")&&n.equals(e.metadata.options[W.ISU_TASK_MANAGER],W.ISU_TASK_MANAGER)&&Array.isArray(e.data.paths)&&e.data.paths.length>0){var s=e.data.paths[R][R],o=e.data.attributes[s];o.taskId===t._tasks.current.taskId&&o.widgetId3D===i.id&&o.widgetIdIM===t._tasks.current.widgetIdIM&&(n.is(t._tasks.current.cancel,"function")&&t._tasks.current.cancel(),t._tasks.current=null)}A.end(t.name+" DS/IssueManagementTask/cancel")}))},_taskHandlers:{FILTER:function(t){var n=this,i=T.get("widget")||window.widget;return new e(function(e){n.listenTo(n,"onRefreshComplete",function(){var e=[],t={};e.push([n._tasks.current.taskId]),t[n._tasks.current.taskId]={taskType:n._tasks.current.taskType,widgetIdIM:n._tasks.current.widgetIdIM,widgetId3D:n._tasks.current.widgetId3D},T.get("eventsHandler").publish(n._subscriberId,"DS/IssueManagementTask/done",{metadata:{appId:i.id,appName:i.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:e,attributes:t},version:"1.0"}),n._tasks.current=null,n.stopListening(n,"onRefreshComplete")});i.setValue("filter",JSON.stringify({session:!0})),i.setValue("roots",t[U]),i.dispatchEvent("onRefresh"),e(null)})},PREFERENCES:function(){var t=this,n=T.get("widget")||window.widget;return new e(function(e){var i=[],s={};i.push([t._tasks.current.taskId]),s[t._tasks.current.taskId]={taskType:t._tasks.current.taskType,widgetIdIM:t._tasks.current.widgetIdIM,widgetId3D:t._tasks.current.widgetId3D,response:{preferences:JSON.stringify(n.getPreferences())}},T.get("eventsHandler").publish(t._subscriberId,"DS/IssueManagementTask/done",{metadata:{appId:n.id,appName:n.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:i,attributes:s},version:"1.0"}),t._tasks.current=null,e(null)})},GET_FILTERED_ISSUES:function(){var t=this,n=T.get("widget");return new e(function(e){for(var i=[],s=t.getTreeDocument().getRoots(!1),o=0;o<s.length;o++)i.push(s[o].options.physicalId);var a=[],r={};a.push([t._tasks.current.taskId]),r[t._tasks.current.taskId]={taskType:t._tasks.current.taskType,widgetIdIM:t._tasks.current.widgetIdIM,widgetId3D:t._tasks.current.widgetId3D,response:{filter:{issues:i}}},T.get("eventsHandler").publish(t._subscriberId,"DS/IssueManagementTask/done",{metadata:{appId:n.id,appName:n.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:a,attributes:r},version:"1.0"}),t._tasks.current=null,e(null)})}},getPADTreeDocument:function(){return this.getTreeDocument()},setPADContext:function(){var e=this;require(["DS/PADUtils/PADContext"],function(t){t.set(e)})},maskForTask:function(e,t){var i=this,o=T.get("widget")||window.widget;i._tasks.current={taskId:e.taskId,taskType:e.taskType,widgetIdIM:o.id,widgetId3D:""};var a=o.body;a.addClassName("masked masked-task");var r=n.createElement("div",{class:"mask mask-for-task"});n.createElement("div",{class:"mask-wrapper",html:n.createElement("div",{class:"task-mask-cancel",html:[n.createElement("div",{class:"task-select-message",html:t||k.tasks.cancelLabel}),new s({value:k.tasks.cancel,className:"default task-cancel-button",id:"task-cancel",events:{onClick:function(){null!==i._tasks.current?i.taskManager.cancel(i._tasks.current.taskId):(a.removeClassName("masked masked-task"),r.destroy())}}})]})}).inject(r),i._mask=r,r.inject(a)},unmaskForTask:function(e){var t=T.get("widget")||window.widget;e.widgetIdIM===t.id&&(t.body.removeClassName("masked masked-task"),n.is(this._mask)&&(this._mask.destroy(),this._mask=null),this._tasks.current=null)},placeholder:{show:function(e,t){var i=e.getElement(".no-issues-to-show-container");i&&i.destroy();var s=k.titles.placeholder.sub;t||(s=k.titles.placeholder.sub2),e.getChildren().forEach(function(e){e.setStyle("display","none")});var o=n.createElement("span",{class:"no-issues-to-show-filter-shortcut fonticon fonticon-list-filter"}),r=n.createElement("span",{class:"no-issues-to-show-create-shortcut fonticon fonticon-plus"}),l=n.createElement("div",{class:"no-issues-to-show-container",html:[n.createElement("div",{class:"no-issues-to-show",html:[n.createElement("div",{class:"pin",html:'<span class="fonticon fonticon-5x fonticon-issue-type"></span>'}),n.createElement("div",{class:"pulse"}),n.createElement("span",{class:"no-issues-to-show-label",html:k.titles.placeholder.label}),n.createElement("div",{class:"no-issues-to-show-sub-container",html:n.createElement("span",{html:k.replace(s,{filter:o.outerHTML,create:r.outerHTML})})})]})]});return e.appendChild(l),this._filterTooltip=new a({position:"top",target:l.getElement(".no-issues-to-show-filter-shortcut"),body:k.filter.title}),l.getElement(".no-issues-to-show-filter-shortcut").addEventListener("click",function(){document.getElementById("filterByObjectToolbar").firstChild.click()}),t&&(this._createTooltip=new a({position:"top",target:l.getElement(".no-issues-to-show-create-shortcut"),body:k.actions.create.title}),l.getElement(".no-issues-to-show-create-shortcut").addEventListener("click",function(){var e=h.getCommand("Create");e.mode=B,e.begin()})),l},hide:function(e){var t=e.getElement(".no-issues-to-show-container");null!==t&&(e.getChildren().forEach(function(e){e.setStyle("display","initial")}),t.destroy(),this._filterTooltip&&(this._filterTooltip.destroy(),this._filterTooltip=null),this._createTooltip&&(this._createTooltip.destroy(),this._createTooltip=null))}},_dispatchEventForRestoreCustomView:function(){this.dispatchEvent("restoreCustomViewColumns")},isFilteringRequestEligible:function(){T.get("actionBar");var e=M.toolbarActionBar.getNodeModelByID("Filter"),t=!1;if(e){let i=e.options.grid.data.menu.filter(e=>{if(e.state&&e.state.includes("selected"))return t=!0,e.id}).map(e=>e.id);var n=!0;(1==i.length&&("closed"==i[0]||"filterbyobject"==i[0])&&this.settings.hideNoFilterSelectionPreference||2==i.length&&i.includes("closed")&&i.includes("filterbyobject")&&this.settings.hideNoFilterSelectionPreference)&&(n=!1),n||(t=!1)}return t},utils:{_iconBarForPlaceHolder:null,_setTypesCallbackSubscribe:!1,setTypesCallbackForOFW:function(e){d.setTypesCallbackForOFW(e,{setTypesCallbackSubscribe:this._setTypesCallbackSubscribe}),this._setTypesCallbackSubscribe=!0},isJson:function(e){try{JSON.parse(e)}catch(e){return!1}return!0},isTouchDevice:function(){return"ontouchstart"in document.documentElement}}})});