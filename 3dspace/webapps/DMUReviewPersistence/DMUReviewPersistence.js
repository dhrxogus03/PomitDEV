define("DS/DMUReviewPersistence/DMUReviewMaturityChangeCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseExperience/DMUContextManager","DS/DMUReadPersistence/DMUReviewPersistenceServicesSetting"],function(e,t,n){"use strict";return e.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);var i,a=this,r=e.frameWindow||this.getFrameWindow();this.beginExecute=function(){var e=t.getReviewContext({viewer:r.getViewer()}).getValidation();if(e){var o=t.getEventsController({viewer:r.getViewer()});require(["DS/MaturityWidget/MaturityWidget"].concat([]),function(t){i&&i.dialog&&i.dialog.destroy(),(i=new t({externalSettings:n.getOption("platform_services")})).addEvent("onMaturityCanceled",function(){a.cancel()}),i.addEvent("onMaturityTransitionEnd",function(t){if(t&&t.data&&t.data.length>0){for(var n=0;n<t.data.length;n++)if(t.data[n]&&t.data[n].physicalid===e.getPlmID()&&t.data[n].tostate){e.setCurrentState(t.data[n].tostate),o&&o.fireEvent("onReviewObjectAttributesModified",{object:e,attr:[{currentState:t.data[n].tostate}]});break}a.cancel()}else a.cancel()}),n.getServerContext({onComplete:function(t){i.executeCmd([{physicalid:e.getPlmID(),tenant:n.getTenant()}],{context:{getSecurityContext:()=>({SecurityContext:t})}},()=>{})},onFailure:function(){}})})}else a.cancel()},this.cancelExecute=function(){i=null}}})}),define("DS/DMUReviewPersistence/EXPValHighlightContextualBar",["DS/DMUBaseUI/DMUContextualBarAdapter"],function(e){"use strict";return e.extend({getSharedContextualMenuCommandList:function(e){var t=[];if(e&&e.length&&e.forEach(function(e){-1===t.indexOf(e.getType())&&t.push(e.getType())}),1===t.length&&(-1!==t.indexOf("DMUValidationExposedPresentation")||-1!==t.indexOf("DMUValidationCheck"))){var n=[];return e[0].getParent().isReadOnly()||(n=this.getContextualMenuCommandList()),n}return[]},getContextualMenuCommandList:function(){return[{line:1,name:"DMUDeleteStr",hdr_list:["DMUDeleteHdr"]}]},register:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})},unregister:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})}})}),define("DS/DMUReviewPersistence/EXPValHighlightsContextualBar",["DS/DMUBaseUI/DMUContextualBarAdapter","DS/CATWebUXComponents/DMUCommandsManager","DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager","DS/DMUBaseUIControllers/DMUReviewController"],function(e,t,n,i,a){"use strict";return e.extend({getSharedContextualMenuCommandList:function(e,r){var o=i.get(),l=n.getReviewContext({viewer:r});if(l){var s=n.getContextViewer({reviewContext:l});if(s){var d=n.getEventsController({viewer:s.getViewer()}),c=a.giveDMUReviewController({context:s.getFrameWindow()}),u=[],g=0;for(let e=0;e<o.length;e++)o[e].pathElement.getLastElement().getDMUType&&"DMUValidationExposedPresentation"!==o[e].pathElement.getLastElement().getDMUType()||g++;var m=c.getRestrictions();return g>0&&!e[0].isReadOnly()&&m.highlight.canEditDef&&u.unshift({line:1,name:"DMUDeleteStr",hdr_list:["DMUDeleteHdr"]}),2===o.length&&1===g&&u.unshift({line:1,name:"DMUCopyLinkStr",hdr_list:["DMUCopyLinkHdr"]}),!e[0].isReadOnly()&&m.highlight.canEditDef&&d.fireEvent("onPrefTemplateIssueOnlyRequested",{onPrefTemplateIssueOnlyRequestedCB:function(n){if(!e[0].isReadOnly()){var i=t.getCommand("DMUSetIssueCreationTemplateTypeHdr",s.getCommandContext()),a=t.getCommand("DMUSetIssueCreationTypeHdr",s.getCommandContext());if(n)i&&i.setState(!0),a&&a.setState(!1);else{u.unshift({line:1,name:"DMUIssueTypeSubMenu",resourceFile:"DMUBaseCtxCommands/DMUBaseCtxCommands",hdr_list:["DMUSetIssueCreationTypeHdr","DMUSetIssueCreationTemplateTypeHdr"]});var r=e[0].getIssueCreationType();i&&i.setState("issueTemplate"===r),a&&a.setState("issue"===r)}}}}),u.unshift({line:1,name:"DMUHideShowThumbnailStr",hdr_list:["DMUHideShowThumbnailHdr"]}),u.unshift({line:1,name:"DMUExpandAllStr",hdr_list:["DMUExpandAllHdr"]}),u.unshift({line:1,name:"DMUCollapseAllStr",hdr_list:["DMUCollapseAllHdr"]}),u}}},getContextualMenuCommandList:function(){return[]},register:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})},unregister:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})}})}),define("DS/DMUReviewPersistence/DMUReviewStatusChangeCmd",["DS/CATWebUXComponents/DMUCommand","DS/CATWebUXCVS/CATWebUXCVSComponent","DS/DMUBaseExperience/DMUContextManager","DS/DMUReadPersistence/DMUReviewPersistenceServicesSetting","DS/CATWebUXComponents/CATWebUXNotification","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],function(e,t,n,i,a,r){"use strict";return e.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);var o,l=this,s=null,d=e.frameWindow||this.getFrameWindow();function c(){o&&o.destroy(),s&&s.clean(),l.cancel()}this.beginExecute=function(){var e=n.getReviewContext({viewer:d.getViewer()}).getValidation(),l=function(){(o=new a).build({type:"error",autoHide:!0,message:r.valStateChange.error,body:d.getUIFrame()}),c()};i.getServerContext({onComplete:function(a){s=new t({title:e.getName(),physicalId:e.getPlmID(),current:e.getStatus(),parent:d.getImmersiveFrame(),platformSettings:i.getOption("platform_services"),tenant:i.getTenant(),securityContext:{getSecurityContext:()=>({SecurityContext:a})},onChangeValidationStateCompleted:function(t){if(t){var i=[];e.setStatus(t.sValidationState),i.push({sValidationState:t.sValidationState});var a=n.getEventsController({viewer:d.getViewer()});a&&a.fireEvent("onReviewObjectAttributesModified",{object:e,attr:i}),c()}else l()},onChangeValidationStateClose:function(){c()},onChangeValidationStateFailure:function(){l()}})},onFailure:function(){l()}})},this.destroy=function(){c()}}})}),define("DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices",["UWA/Utils","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseUIControllers/DMUReviewContextInitializer","DS/DMUPersistence/DMUDOSThumbnailServices","DS/DMUPlayMarkup/DMUMarkup","DS/DMUBaseWebValidation/EXPValMarkup","DS/DMUBaseWebValidation/EXPValValidation","DS/DMUBaseWebValidation/EXPValContext","DS/DMUBaseWebValidation/EXPValValidated","DS/DMUBaseWebValidation/EXPValCheck","DS/DMUBaseWebValidation/EXPValHighlight","DS/DMUBaseExperience/DMULinksManager","DS/DMUBaseUIServices/DMUSlidePreferences","DS/DMUBaseExperience/DMUModelServices","DS/DMUBaseExperience/EXPUtils","DS/DMUValidationPersistence/DMUValidationPersistenceServices","DS/DMUPlaySlide/DMUSlide","DS/DMUBaseUI/DMUToolsUsers","DS/DMUBaseUIControllers/DMUApplicativeContextManager","DS/DMUReadPersistence/DMULoadingContextController","DS/DMUPersistence/DMUAuthPersistenceUtils","DS/DMUBaseUIControllers/DMUSlidesController","DS/DMUBaseUIControllers/DMUReqCompareController","DS/DMUBaseUIControllers/DMUCommentsController","DS/DMUMeasurable/DMUToolsSceneGraph","DS/Visualization/Node3D","DS/DMUReadPersistence/DMUReviewPersistenceServicesSetting","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],function(e,t,n,i,a,r,o,l,s,d,c,u,g,m,p,v,h,C,f,D,w,M,x,R,b,S,I,U){"use strict";var y=0,k=async function(n){if(!(n&&n.mkpData&&n.validation&&n.reviewCtx&&n.ctxViewer))return;var i=n.ctxViewer.getViewer(),o=n.ctxViewer.getFrameWindow(),l=new r(n.ctxViewer.getViewer(),n.validation);n.validation.addMarkup(l);var s={children:[],id:n.mkpData.pId,instanceId:n.mkpData.markupRefInst.pId,name:n.mkpData.name,type:"Markup",treeOrder:"4.3333",webMarkup:"true",owner:n.mkpData.owner};l.setFromJson(s);var d={children:[],id:n.mkpData.markupRepRef.pId,instanceId:n.mkpData.markupRepInst.pId,name:"Review "+n.mkpData.name,type:"ReviewMarkup",treeOrder:"4.3334",webMarkup:"true",owner:n.mkpData.markupRepRef.owner};l.addChild(d);var c=t.getReviewContext({context:n.ctxViewer}),m=c.getTransientReviewBag(),p=null,v={entities:null,occurrences:null};m&&(p=m.getAttribute("oLinksManager")),p&&p.exportLinksManagerData(v),m=new a(n.ctxViewer.getViewer(),n.reviewCtx);let D=l.getChildren();if(D&&D.length&&(D[0].setMarkupContent(m),m.setMarkupOwner(D[0]),p=new u(n.ctxViewer.getViewer(),m),n.validation.setCurrentMarkup(D[0]),n.validation.fireEvent("onDMUObjectInitialized",{dmuObject:D[0]})),(v.entities&&v.entities.length>0||v.occurrences&&v.occurrences.length>0)&&p.importLinksManagerData(v),m.setAttributes([{name:"oLinksManager",value:p},{name:"sName",value:n.mkpData.markupName}]),g.setSlidePreferences({context:o,preferences:{panelTitle:n.validation.getName()}}),n.createFirstSlide&&n.ctxViewer.getRootBagPath().getChildrenPathes().length){let a,r=1,l=x.giveReqCompareController({context:n.ctxViewer});l&&l.isRequirementCompareActive()&&(r=2);for(let o=0;o<r;o++){if((a=new h(n.ctxViewer.getViewer(),n.reviewCtx.getCurrentSessionMarkup())).setAttributes([{name:"sID",value:m.computeNewID()},{name:"sUuid",value:e.getUUID()},{name:"sOwner",value:C.getUserLogin()},{name:"fCreationDate",value:Date.now()}]),a.updateEnvironmentOverload({target:n.reviewCtx.getEnvironment(),state:n.reviewCtx.getEnvironment().getEnvironmentInfo()}),m.addSlide(a),!c.getUIManager().isAPreviewRegistered()){let e=null,t=c.getValidation().getContext()?c.getValidation().getContext().getJsonContextTypes()[0]:null;t&&(e=t.parentType?t.parentType:t.type?t.type:t),["Document","Requirement","Requirement Specification"].includes(e)||c.getUIManager().registerElementIdAsPreview(a.getAttribute("sUuid"),m)}var R=null,b=f.giveDMUApplicativeContextManager({context:t.getContextViewer({viewer:i})});if(b)for(var S,I,y=b?b.getApplicativeControllers():[],k=0;k<y.length;k++){I=y[k].getApplicativeContainerID();var V=b.getVerifiedApplicativeContainerState(I);V&&(a.setSlideApplicativeContext(I,V),null,(S=y[k].getCurrentAppContainerStateTitle())&&(R?R+=" - ":R="",R+=S)),a.setSlideApplicativeContext(I,V)}R&&!R.length&&(R=null),a.setAttribute("sName",m.computeNewName({object:a,prefix:R||U.createReview.slideTitle,noSuffixIfPossible:null!==R,separator:null!==R?"parenthesis":null})),n.validation.fireEvent("onDMUObjectInitialized",{dmuObject:a})}m.setCurrentSlide(a),n.validation.updateVisibleMarkups(),await w.copyTransientMarkersAndOverloads(m,a,n.ctxViewer,n.duplicatedEntity,n.hiddenElts);var E=M.giveDMUSlidesController({context:o});E&&E.setActiveSlide(a,{duration:0})}else n.validation.fireEvent("onCreateMarkupNoSlide");return{sessionMarkup:m,markup:l}},V=function(e){var n=t.getEventsController({viewer:e.iCtxViewer.getViewer()});var i=t.getReviewContext({viewer:e.iCtxViewer.getViewer()}).getValidation().getChecks(),a=[],r=[];if("add"===e.mode)for(let t=0;t<i.length;t++){var o=i[t].getAttribute("sPlmID");for(let n=0;n<e.checks.length;n++)o===e.checks[n]&&(e.highlight.addAssociatedCheck(i[t].getAttribute("sPlmID")),a.push(i[t]))}else"remove"===e.mode&&(e.highlight.removeAssociatedCheck(e.check.getPlmID()),r.push({highlightId:e.highlight.getPlmID(),checkId:e.check.getPlmID()}));n.fireEvent("onUpdateImpactedChecksList",{highlight:e.highlight,checks:"remove"===e.mode?r:a,mode:e.mode})},E=function(e){var n=t.getReviewContext({context:e.iCtxViewer}),i=new d(e.iCtxViewer.getViewer(),n.getValidation());i.setFromJson({type:e.type,name:e.name,id:e.id,state:e.state,description:e.description,owner:e.owner,children:""!==e.requirementDocId?[{id:e.requirementDocId,type:"Requirement",name:e.requirementName}]:[]}),n.getValidation().addCheck(i),n.getValidation().fireEvent("onDMUObjectInitialized",{dmuObject:i})},P=function(e){var n=t.getReviewContext({context:e.ctxViewer}),a=t.getEventsController({viewer:e.ctxViewer.getViewer()});let r=n.getValidation().getHighlights(),o=e.markup.getChildren()[0].getMarkupContent().getSlides();for(let e=0;e<o.length;e++){for(let t=0;t<r.length;t++){let n=r[e].getPresentationSlideID();o[e].getAttribute("sUuid")===n&&(i.deleteMarkupThumbnail("review2dthumbnail",r[t].getPlmID()),a.fireEvent("onHighlightPreviewUpdateRequested",{highlightId:r[t].getPlmID()}))}if(o[e].getDMUObjects&&o[e].getDMUObjects().length){var l=o[e].getDMUObjects();for(let e=0;e<l.length;e++)if(l[e].getDMUComments()&&l[e].getDMUComments().length){var s=l[e].getDMUComments();for(let e=0;e<s.length;e++)for(let t=0;t<r.length;t++)r[t].getPresentationSlideID()===s[e].getAttribute("sUuid")&&(i.deleteMarkupThumbnail("review2dthumbnail",r[t].getPlmID()),a.fireEvent("onHighlightPreviewUpdateRequested",{highlightId:r[t].getPlmID()}))}}}},T=function(e){if(e&&e.validation&&e.replyData&&e.viewer&&e.reviewCtx){var t,n=function(t){let n=null,i=null,r={entities:null,occurrences:null};(i=e.reviewCtx.getCurrentSessionMarkup())&&"DMUMarkup"===i.getType()&&(n=i.getAttribute("oLinksManager")),n&&n.exportLinksManagerData(r),i=new a(e.viewer,e.reviewCtx),t.setMarkupContent(i),i.setMarkupOwner(t),n=new u(e.viewer,i),(r.entities&&r.entities.length>0||r.occurrences&&r.occurrences.length>0)&&n.importLinksManagerData(r),i.setAttributes([{name:"oLinksManager",value:n},{name:"sName",value:e.replyData.name}])};if(e.existingRepRef)n(e.existingRepRef),t={replyRef:e.existingRepRef.getOwner(),replyRepRef:e.existingRepRef};else{if(!e.markupRef)return;var i={children:[],id:e.replyData.pId,instanceId:e.replyData.markupRefInst.pId,name:e.replyData.name,type:"Reply",treeOrder:"4.3333",webMarkup:"true",owner:e.replyData.owner};e.markupRef.addChild(i);let a=e.markupRef.getChildren();var r=a&&a.length?a[a.length-1]:null;if(r){var o={children:[],id:e.replyData.markupRepRef.pId,instanceId:e.replyData.markupRepInst.pId,name:"Review "+e.replyData.name,type:"ReviewMarkup",treeOrder:"4.3334",webMarkup:"true",owner:e.replyData.owner};r.addChild(o);var l=(a=r.getChildren())&&a.length?a[0]:null;l&&(n(l),t={replyRef:r,replyRepRef:l})}}return t}},A={createReview:async function(e){if(!e||!e._ctxViewer)return;var i=e._ctxViewer,a=i.getViewer(),r=t.getReviewContext({context:i});let d=t.getEventsController({viewer:i.getViewer()});r||(r=await n.createReviewContext({context:i}));let c=void 0!==e._rootData?e._rootData.valueItem:void 0,u=e._subContext?e._subContext.id:void 0,g=[];c&&g.push(c),u&&g.push(u),v.createReviewInDataBase({viewer:i,reviewName:e._reviewName,reviewPLMexternalID:e._reviewPLMexternalID,parentID:c,contextId:1===g.length?g[0]:void 0,contextIds:g&&g.length>0?g:void 0,reviewDescription:e._reviewDescription?e._reviewDescription:"",createMarkup:e._createMarkup,restrictedEdition:e._restrictedEdition,markupName:e._markupName,markupPLMexternalID:e._markupPLMexternalID,markupDescription:e._markupDescription,contextAsValidated:1===g.length?e._contextAsValidated:void 0,validatedObjects:e._validatedObjects,serviceID:c&&i.getController().getRootStats(c)&&i.getController().getRootStats(c).serviceId?i.getController().getRootStats(c).serviceId:"",onReviewCreationCompleted:function(n){new Promise(t=>{if("Activated"===n.restrictedEdition){const i=n.currentState,a=()=>{I.sendWebServiceCall({url:"resources/lifecycle/maturity/promote",config:{verb:"POST",data:JSON.stringify({data:[{physicalid:n.pId,tostate:"PRIVATE",fromstate:i,type:"DMUValidationValidation",revision:"A",policy:"VPLM_SMB_Evaluation_MajorRev",name:n.validationName,coretype:"Reference",signature:"Isolate"}],notificationTimeout:3600})},onSuccess:function(){r.getValidation().setCurrentState("PRIVATE"),d.fireEvent("onReviewObjectAttributesModified",{object:r.getValidation(),attr:[{currentState:"PRIVATE"}]})},onFailure:function(){var t=e._ctxViewer.getFrameWindow().getContent().getElementsByClassName("DMUCreateReviewInfoDiv");t.length&&t[0].dsModel&&t[0].dsModel.destroy()}})};if(e._createMarkup){if(d){const e=d.addEvent("onReviewSaved",()=>{a(),d.removeEvent(e)}),t=d.addEvent("onReviewSaveFailed",()=>{a(),d.removeEvent(t)})}t()}else a(),t()}else{var i=e._ctxViewer.getFrameWindow().getContent().getElementsByClassName("DMUCreateReviewInfoDiv");i.length&&i[0].dsModel&&i[0].dsModel.destroy(),t()}}).then(async()=>{d=t.getEventsController({viewer:i.getViewer()});let c=D.getLoadingContextController({context:i});if(!i.getRootBagPath().getChildrenPathes().length){d&&d.fireEvent("reviewNoContextModeOn");let t=d.addEvent("onLoadedReviewContext",n=>{d.removeEvent(t),["DXF","DWG","PDF"].some(t=>{t===n.rootType&&(r.getValidation().getMarkups().length||new Promise(function(e){let t;A.generateName({sListTypeName:[{sTypeName:"DMUValidationReviewReference"}],onGenerateNameCompleted:function(n){t=n.listNames[0].title,e(t)},ononGenerateNameFailed:function(){t=U.createReviewMarkup.defaultMarkupName,e(t)}})}).then(function(t){A.createReviewMarkup({ctxViewer:i,validation:r.getValidation(),mkpName:t,duplicatedEntity:[],hiddenElts:[],createFirstSlide:e.createFirstSlide,onMarkupCreationCompleted:function(e){d&&d.fireEvent("onDMUMarkupCreationSucceeded",{dmuObject:e.sessionMarkup})},onMarkupCreationFailed:function(){}})}))})}),n=i.subscribe({event:"onRootAdded"},function(e){let t;if(e.path)"Document"===(t=b.getNodeType(e.path.getLastElement(!0)))&&(t=c.getLoadMarkupCtxType()?c.getLoadMarkupCtxType():t);else{let e=i.getRootBagPath().externalPath[0].path.getChildrenPathes().length,n=i.getRootBagPath().externalPath[0].path.getChildrenPathes()[e-1];t=b.getNodeType(n.getLastElement(!0))}d.fireEvent("reviewNoContextModeOff",{rootType:t}),i.unsubscribe(n)})}if(n){let d,m;c&&(d=c.getTempObjectInformations(),m=c.getLoadedR2VInformations());let p=void 0;n.Validated.paths&&n.Validated.paths[0]&&n.Validated.paths[0].path?p=n.Validated.paths[0].path:n.Validated.path&&(p=n.Validated.path);var u={context:e._rootData,contextId:e._rootData?e._rootData.valueItem:null,subContext:e._subContext,subContextId:e._subContext?e._subContext.id:null,reviewId:n.pId,valCtxId:n.Context?n.Context.pId:null,validatedID:n.Validated.pId,validatedPath:p,reviewName:n.validationName,modifiable:!0,editionMode:e._editionMode,restrictedEdition:n.restrictedEdition,reviewDescription:n.description?n.description:"",status:n.status,currentState:n.currentState,reviewType:"DMUValidationValidation",owner:n.owner,tempObjectInfo:d,loadedR2VInfo:m},g=function(e,n,i){var a=new o(e,i);a.setFromJson({id:n.reviewId,name:n.reviewName,status:n.status,currentState:n.currentState,type:n.reviewType,owner:n.owner,restrictedEdition:n.restrictedEdition}),i.setValidation(a),i.setReviewCtxInformation(n),a.setNode(new S("DMUReviewBag"));let r=D.giveLoadingContextController({context:t.getContextViewer({viewer:e})});if(r&&["PDF","Requirement","Requirement Specification"].includes(r.getLoadMarkupCtxType())&&a.enableMultipleMarkupVisibility(!0),n.valCtxId){var d=new l(e,a);d.setFromJson({id:n.valCtxId,type:"DMUValidationContext"});let t=[];n.context&&t.push({id:n.context.valueItem,name:n.context.labelItem,type:n.context.type}),n.subContext&&t.push({id:n.subContext.id,name:n.subContext.label,type:n.subContext.type,subContext:!0}),d.setJsonContexts(t),a.setContext(d)}var c=new s(e,a);if(c.setFromJson({id:n.validatedID,type:"ValValidated"}),a.setValidated(c),n.validatedPath)if("R2V_FeatureState"===i.getValidation().getContext().getJsonContextTypes()[0])n.validatedPath.length&&n.validatedPath[0]&&n.loadedR2VInfo.forEach(e=>{e.id===n.validatedPath[0]&&(i.getValidation().getValidated().addPathElement({instanceName:e.info[0]["ds6w:label"],referenceName:e.info[0]["ds6w:label"],PathElements:[n.validatedPath[0]]}),a.fireEvent("onDMUObjectInitialized",{dmuObject:a,editionMode:n.editionMode}))});else{var u=t.getContextViewer({viewer:e}).getController(),g=[n.validatedPath];u.getAttributes({ids:g,attributes:["ds6w:label","type_icon_url"],callbacks:{onComplete:function(e){i.getValidation().getValidated().addPathElement({instanceName:e[n.validatedPath]["ds6w:label"],referenceName:e[n.validatedPath]["ds6w:label"],PathElements:n.validatedPath}),a.fireEvent("onDMUObjectInitialized",{dmuObject:a,editionMode:n.editionMode})},onFailure:function(){i.getValidation().getValidated().addPathElement({instanceName:n.tempObjectInfo.title,referenceName:n.tempObjectInfo.title,PathElements:[n.validatedPath]}),a.fireEvent("onDMUObjectInitialized",{dmuObject:a,editionMode:n.editionMode})}}})}else a.fireEvent("onDMUObjectInitialized",{dmuObject:a,editionMode:n.editionMode});return a}(a,u,r);e._createMarkup?n.markup?(await k({mkpData:n.markup,validation:g,reviewCtx:r,ctxViewer:i,duplicatedEntity:e._dmuEltsDuplicated,hiddenElts:e.hiddenElts,rootData:e._rootData,createFirstSlide:e._createFirstSlide}),e.onReviewCreationComplete({validation:g})):e.onReviewCreationFailed():e.onReviewCreationComplete()}else e.onReviewCreationFailed()})},onReviewCreationFailed:e.onReviewCreationFailed})},updateValidatedObjectsList:function(e){v.saveValidatedObject({serviceId:e.serviceId,validatedObjects:e.validatedObjects,validatedId:e.validatedId,onSaveValidatedObjectsCompleted:function(){!function(e){var n=e.ctxViewer,i=t.getContextViewer({viewer:n}).getController();const a=t.getReviewContext({viewer:e.ctxViewer});var r=[e.instanceIds,e.referenceIds];const o=n=>{var i=t.getEventsController({viewer:e.ctxViewer}),r=[],o=[];let l=null,s=a.getValidation().getContext()?a.getValidation().getContext().getMainContextType():null;if(s&&(l=s.parentType?s.parentType:s.type?s.type:s),"remove"===e.updateMode){for(let t=0;t<e.validatedToAdd.length;t++)a.getValidation().getValidated().removePathElement(e.validatedToAdd[t],e.fullPathRefs[t]);i.fireEvent("onValidatedSaved",e),["Requirement Specification","Requirement","Document","Specification Report","DesignSight","R2V_FeatureState"].includes(l)&&a.getValidation().removeValidatedNode(e.referenceIds[0])}else{for(let t=0;t<e.validatedToAdd.length;t++)a.getValidation().getValidated().addPathElement({instanceName:n[e.instanceIds[t]]["ds6w:label"],referenceName:n[e.referenceIds[t]]["ds6w:label"],PathElements:e.validatedToAdd[t]}),r.push(n[e.referenceIds[t]].type_icon_url),o.push(n[e.instanceIds[t]]["ds6w:label"]),["Requirement Specification","Requirement","Document","Specification Report","DesignSight","R2V_FeatureState"].includes(l)&&a.getValidation().addValidatedNode({docInfo:{validatedId:e.validatedId,validatedPaths:e.validatedToAdd[t],validatedName:n[e.validatedToAdd[t]]["ds6w:label"]}});e.onReviewCtxUpdateOrDropValidated?i.fireEvent("onReviewCtxUpdateOrDropValidated",{validatedId:e.validatedId,validatedNames:o,validatedPaths:e.validatedToAdd,validatedIcons:r}):i.fireEvent("onDMUValidatedCreated",{validatedId:e.validatedId,validatedNames:o,validatedPaths:e.validatedToAdd,validatedIcons:r})}};if(a)if("R2V_FeatureState"===a.getValidation().getContext().getJsonContextTypes()[0]){const e=D.getLoadingContextController({context:t.getContextViewer({viewer:n})}).getLoadedR2VInformations(),i=e[0].id,a=e[0].info[0].icon;o({[i]:{"ds6w:label":e[0].info[0]["ds6w:label"],"ds6w:type":"R2V_FeatureState",physicalid:i,type_icon_url:a}})}else i.getAttributes({ids:r,attributes:["ds6w:label","type_icon_url"],callbacks:{onComplete:o,onFailure:function(){return null}}})}(e)},onSaveValidatedObjectsFailed:e.onSaveValidatedObjectsFailed})},addCheck:function(e){v.addCheck({validationId:e.validation.getPlmID(),requirementDocId:e.requirementDocId,checkName:e.checkName,description:e.description,checkState:e.checkState,onCheckCreationCompleted:function(t){t.error||E({type:"DMUValidationCheck",name:t.name,id:t.pId,state:t.checkState,description:t.description,owner:t.owner,requirementName:e.requirementName,requirementDocId:e.requirementDocId,iCtxViewer:e.iCtxViewer})},onCheckCreationFailed:e.onCheckCreationFailed})},addChecks:function(e){var n=t.getReviewContext({context:e.iCtxViewer}).getValidation().getPlmID();v.addChecks({listObjects:e.checkList,validationId:n,onCheckCreationCompleted:function(t){t.checkObjects&&t.checkObjects.forEach(t=>{E({type:"DMUValidationCheck",name:t.name,id:t.pId,state:t.checkState,description:t.description,owner:t.owner,requirementName:t.name,requirementDocId:t.requirementDocId,iCtxViewer:e.iCtxViewer})})},onCheckCreationFailed:e.onCheckCreationFailed})},setCheckRequirement:function(e){v.setCheckRequirement({checkId:e.checkId,requirementId:e.requirementId,removeReq:e.removeReq,onSetCheckRequirementComplete:function(){e.onSetCheckRequirementComplete(e)},onSetCheckRequirementFailed:e.onSetCheckRequirementFailed})},setImpactedCheck:function(e){v.setImpactedCheck({checksId:e.checks,highlightId:e.highlight.getPlmID(),onSetImpactedCheckComplete:function(){e.mode="add",V(e),e.onSetImpactedCheckComplete()},onSetImpactedCheckFailed:e.onSetImpactedCheckFailed})},removeImpactedCheck:function(e){v.removeImpactedCheck({checkId:e.check.getPlmID(),highlightId:e.highlight.getPlmID(),onRemoveImpactedCheckComplete:function(){e.mode="remove",V(e),e.onRemoveImpactedCheckComplete()},onRemoveImpactedCheckFailed:e.onRemoveImpactedCheckFailed})},updateSessionCheckAttributes:function(e){var n=t.getReviewContext({context:e.ctxViewer}).getValidation().getPlmID();v.updateAttributes({validationId:n,objectsToModify:[{sObjectId:e.objectId,sListOfAttributesToModify:e.attributesList}],onAttributesSaveCompleted:function(n){n.modifiedObjects&&1===n.modifiedObjects.length?(n.modifiedObjects[0].iCtxViewer=e.ctxViewer,function(e){var n,i=t.getReviewContext({context:e.iCtxViewer}).getValidation().getChecks();for(n=0;n<i.length;n++)i[n].getPlmID()===e.pId&&(e.iCheckState&&i[n].setStatus(e.iCheckState),e.sDescription&&i[n].setDescription(e.sDescription),e.sName&&i[n].setName(e.sName))}(n.modifiedObjects[0]),e.onSaveCompleted()):e.onSaveFailed()},onAttributesSaveFailed:e.onSaveFailed})},addHighlight:function(e){var t=[];e.markupRepRef&&(e.markupRepRef.getParent&&e.markupRepRef.getParent()&&e.markupRepRef.getParent().getInstancePlmID&&t.push(e.markupRepRef.getParent().getInstancePlmID()),e.markupRepRef.getInstancePlmID&&(t.push(e.markupRepRef.getInstancePlmID()),t.push(e.markupRepRef.getPlmID())));var n=2;if(e.highlightRating)switch(e.highlightRating){case"Undefined":n=1;break;case"Medium":n=3;break;case"High":n=4;break;case"Processed":n=5;break;case"Urgent":n=6}v.addHighlight({validationId:e.validation.getPlmID(),markupRepRefPathIds:t,slideId:e.slide.getAttribute("sUuid"),highlightName:e.highlightName,description:e.description,rating:n,onHighlightCreationCompleted:function(t){!function(e){if(e&&e.validation&&e.iCtxViewer&&e.highlightData){var t=new c(e.iCtxViewer.getViewer(),e.validation);t.setFromJson({type:"DMUValidationExposedPresentation",name:e.highlightData.name,id:e.highlightData.pId,slideId:e.highlightData.slideId,repRefMarkupId:e.highlightData.markupRepRefId,description:e.highlightData.description,rating:e.highlightData.presentationRating,associatedCheck:[],owner:e.highlightData.owner}),e.validation.addHighlight(t);var n=M.giveDMUSlidesController({context:e.iCtxViewer.getFrameWindow()});if(n){var a=n.getSlideRepresentation(e.highlightData.slideId);if(!a){var r=R.giveDMUCommentsController({context:e.iCtxViewer.getFrameWindow()});r&&(a=r.getCommentRepresentation(e.highlightData.slideId))}a&&(a.getImage().then(function(t){i.saveObjectThumbnail("review2dthumbnail",t,e.highlightData.pId)}),a.remove())}e.validation.fireEvent("onDMUObjectInitialized",{dmuObject:t,slideObject:e.slideObj})}}({iCtxViewer:e.iCtxViewer,validation:e.validation,highlightData:t,slideObj:e.slide,presentationRating:e.presentationRating}),e.onHighlightCreationCompleted()},onHighlightCreationFailed:e.onHighlightCreationFailed})},addReply:function(e){var n=t.getContextViewer({viewer:e.viewer}),i=t.getReviewContext({context:n});if(e.existingRepRef){let t=T({ctxViewer:n,replyData:e.existingRepRef.getOwner(),existingRepRef:e.existingRepRef,reviewCtx:i,validation:e.validation,viewer:e.viewer});e.onReplyCreationCompleted(t)}else v.addReply({markupRefId:e.markupRef.getPlmID(),name:e.name,description:e.description,validationId:e.validation.getPlmID(),onReplyCreationCompleted:function(t){let a=T({ctxViewer:n,replyData:t,markupRef:e.markupRef,reviewCtx:i,validation:e.validation,viewer:e.viewer});e.validation.fireEvent("onDMUObjectInitialized",{dmuObject:a.replyRepRef}),e.onReplyCreationCompleted(a)},onReplyCreationFailed:e.onReplyCreationFailed})},deleteObject:function(e){var n=t.getReviewContext({context:e.ctxViewer}).getValidation().getPlmID();v.deleteObject({validationId:n,objectIds:e.objectIds,onObjectDeletionCompleted:function(){var n=e.ctxViewer,a=[],r=[],o=[],l=t.getReviewContext({context:n}),s=t.getEventsController({viewer:n.getViewer()});if("validationObject"===e.type){for(let t=0;t<e.objectIds.length;t++){var d=l.getValidation().getChecks(),c=l.getValidation().getHighlights();for(let n=0;n<d.length;n++)d[n].getPlmID()===e.objectIds[t]&&(r.push(e.objectIds[t]),l.getValidation().removeCheck(e.objectIds[t]));for(let n=0;n<c.length;n++)if(c[n].getPlmID()===e.objectIds[t]){let r=c[n].getAssociatedCheck();for(let e=0;e<r.length;e++)o.push({highlightId:c[n].getPlmID(),checkId:r[e]});a.push(e.objectIds[t]),l.getValidation().removeHighlight(e.objectIds[t]),i.deleteMarkupThumbnail("review2dthumbnail",e.objectIds[t])}}a.length&&(s.fireEvent("onDMUHighlightRemoveRequested",a),s.fireEvent("onUpdateImpactedChecksList",{checks:o})),r.length&&s.fireEvent("onDMUCheckRemoveRequested",r)}else if("Markup"===e.type){let t=l.getValidation().getMarkups();for(let n=0;n<t.length;n++)t[n].getPlmID()===e.objectIds[0]&&P({ctxViewer:e.ctxViewer,markup:t[n]});l.getValidation().removeMarkup(e.objectId)}else if("Reply"===e.type){let t=null,n=l.getValidation().getMarkups();for(let i=0;i<n.length;i++){let a=n[i].getReplies();for(let r=0;r<a.length;r++)if(a[r].getPlmID()===e.objectIds[0]){t=n[i],P({ctxViewer:e.ctxViewer,markup:a[r]});break}if(t)break}t&&t.removeReply(e.objectIds[0])}e.onDeleteCompleted&&e.onDeleteCompleted()},onObjectDeletionFailed:e.onDeleteFailed})},createReviewMarkup:async function(e){if(e.ctxViewer&&e.validation){var i=t.getReviewContext({context:e.ctxViewer});i||(i=await n.createReviewContext({context:e.ctxViewer})),v.addMarkup({mkpName:e.mkpName,markupPLMexternalID:e.markupPLMexternalID,validationId:e.validation.getPlmID(),onMarkupCreationCompleted:async function(t){if(t&&t.error)e.onMarkupCreationFailed();else{let n=await k({mkpData:t,validation:e.validation,reviewCtx:i,ctxViewer:e.ctxViewer,duplicatedEntity:e.duplicatedEntity,hiddenElts:e.hiddenElts,createFirstSlide:e.createFirstSlide});e.onMarkupCreationCompleted&&e.onMarkupCreationCompleted(n)}},onMarkupCreationFailed:e.onMarkupCreationFailed})}},saveReviewMarkup:function(e){e&&e.frmWindow&&p.isPersistenceAllowed({onPersistenceAllowed:async function(){var n=function(){y--};y++;var i=0,a=null,r=t.getReviewContext({viewer:e.frmWindow.getViewer()});let o=r?r.getValidation():null,l=o?o.getRepRef(e.markupRepRefId):null,s=l?l.getMarkupContent():null;if(s)if(s.isDirty()){var d;if(i=1,!e.superType||"SIMItfSimulation"!==e.superType&&"Document"!==e.superType&&"Specification Report"!==e.superType){d={Version:"1.0",Model:[]};let e=await m.getObjectDefinition(s);d.Model.push(e)}else{d={Version:"1.0",Contexts:[],Model:[]};let t=await m.getObjectDefinition(s);d.Model.push(t),d.Contexts.push({superType:e.superType,documentType:e.documentType,listData:e.listData,loadingInfos:e.loadingInfos,documentVersionInfos:e.documentVersionInfos})}a=JSON.stringify(d)}else i=2;1===i&&a?v.saveReviewMarkup({markupRepRefId:e.markupRepRefId,jsonContent:a,validationId:o?o.getPlmID():null,onSaveReviewMarkupCompleted:function(){s.setDirtyFlag(!1),s.getMarkupOwner()&&!s.getMarkupOwner().hasStream()&&s.getMarkupOwner().setAttribute("bNoStream",!1),e.onSaveCompleted(),n()},onSaveReviewMarkupFailed:function(t){e.onSaveFailed(t),n()}}):(e.onSaveFailed&&e.onSaveFailed(2===i?"NoSaveNeeded":"error"),n())},onPersistenceNotAllowed:function(){e.onSaveFailed&&e.onSaveFailed("error")}})},updateAttributes:function(e){var n=[];e.objectsToModify&&e.objectsToModify.length>0&&e.objectsToModify.forEach(function(e){var t=e.objectId;t||(t=e.object.getPlmID()),n.push({sObjectId:t,sListOfAttributesToModify:e.attributesList})});var i=t.getReviewContext({context:e.ctxViewer}).getValidation().getPlmID();v.updateAttributes({validationId:i,objectsToModify:n,onAttributesSaveCompleted:function(n){!function(e){var n;e.ctxViewer&&e.ctxViewer.getViewer&&(n=t.getEventsController({viewer:e.ctxViewer.getViewer()})),e.objects&&e.updateInfos&&e.updateInfos.length>0&&e.updateInfos.forEach(function(t){for(var i,a=[],r=0;r<e.objects.length;r++)if(e.objects[r]&&e.objects[r].object&&e.objects[r].object.getPlmID()===t.pId){i=e.objects[r].object;break}i&&(t.sValidationState?(i.setStatus(t.sValidationState),a.push({sValidationState:t.sValidationState})):t.sAlias&&(i.setName(t.sAlias),a.push({sAlias:t.sAlias})),n&&n.fireEvent("onReviewObjectAttributesModified",{object:i,attr:a}))})}({objects:e.objectsToModify,ctxViewer:e.ctxViewer,updateInfos:n.modifiedObjects}),e.onAttributesSaveCompleted(n)},onAttributesSaveFailed:e.onSaveFailed})},updateReviewContext:function(e){let n=[];e.mainContext&&e.mainContext.id&&n.push(e.mainContext.id),e.subContext&&e.subContext.id&&n.push(e.subContext.id),v.updateReviewContext({validationId:e.validation.getPlmID(),contextId:1===n.length?n[0]:void 0,contextIds:n.length>0?n:void 0,serviceID:e.ctxViewer.getController().getRootStats(e.contextId)&&e.ctxViewer.getController().getRootStats(e.contextId).serviceId?e.ctxViewer.getController().getRootStats(e.contextId).serviceId:"",onUpdateReviewContextCompleted:function(n){!function(e){if(e&&e.updateInfos&&e.validation&&e.mainContext){var n;e.ctxViewer&&e.ctxViewer.getViewer&&(n=t.getEventsController({viewer:e.ctxViewer.getViewer()}));var i=e.validation.getContext();if(!i&&e.updateInfos.Context&&((i=new l(e.ctxViewer,e.validation)).setFromJson({id:e.updateInfos.Context.pId,type:"DMUValidationContext"}),e.validation.setContext(i)),i){let t=[];e.mainContext.id&&t.push({id:e.mainContext.id,name:e.mainContext.label,type:e.mainContext.type}),e.subContext&&e.subContext.id&&t.push({id:e.subContext.id,name:e.subContext.label,type:e.subContext.type,subContext:!0}),i.setJsonContexts(t),n&&n.fireEvent("onReviewCtxLoaded",{name:e.subContext&&e.subContext.id?e.subContext.label:e.mainContext.label,icon:e.subContext&&e.subContext.id?e.subContext.icon:e.mainContext.icon,id:e.subContext&&e.subContext.id?e.subContext.id:e.mainContext.id})}}}({validation:e.validation,updateInfos:n,mainContext:e.mainContext,subContext:e.subContext,ctxViewer:e.ctxViewer}),e.onUpdateReviewContextCompleted()},onUpdateReviewContextFailed:e.onUpdateReviewContextFailed})},generateName:function(e){v.generateName({sListTypeName:e.sListTypeName,onGenerateNameCompleted:e.onGenerateNameCompleted,ononGenerateNameFailed:e.ononGenerateNameFailed})},setSlideForPreview:function(e){if(e&&e.validation){var t=e.validation,n=JSON.stringify(e.slideForPreview);this.updateAttributes({objectsToModify:[{object:e.validation,attributesList:[{sSlideForPreview:n}]}],ctxViewer:e.ctxViewer,onAttributesSaveCompleted:function(){t.setSlideForPreview(n),e.onSetSlideForPreviewCompleted()},onSaveFailed:e.onSetSlideForPreviewFailed})}},isProcessing:function(){return y>0}};return A}),define("DS/DMUReviewPersistence/DMUReviewPersistence",[],function(){}),define("DS/DMUReviewPersistence/EXPValCheckContextualBar",["DS/DMUBaseUI/DMUContextualBarAdapter"],function(e){"use strict";return e.extend({getSharedContextualMenuCommandList:function(e){var t=[];if(e&&e.length&&e.forEach(function(e){-1===t.indexOf(e.getType())&&t.push(e.getType())}),1===t.length&&(-1!==t.indexOf("DMUValidationExposedPresentation")||-1!==t.indexOf("DMUValidationCheck"))){var n=[];return e[0].getParent().isReadOnly()||(n=this.getContextualMenuCommandList()),n}return[]},getContextualMenuCommandList:function(){return[{line:1,name:"DMUDeleteStr",hdr_list:["DMUDeleteHdr"]}]},register:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})},unregister:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})}})}),define("DS/DMUReviewPersistence/EXPValChecksContextualBar",["DS/DMUBaseUI/DMUContextualBarAdapter","DS/CATWebUXComponents/DMUCommandsManager","DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager"],function(e,t,n,i){"use strict";return e.extend({getSharedContextualMenuCommandList:function(e,a){var r=[],o=i.get();if(e&&e.length&&e.forEach(function(e){-1===r.indexOf(e.getType())&&r.push(e.getType())}),1===r.length&&-1!==r.indexOf("Checks")){var l=[];e[0].isReadOnly()||l.unshift({line:1,name:"DMUDeleteStr",hdr_list:["DMUDeleteHdr"]}),l.unshift({line:1,name:"DMUExpandAllStr",hdr_list:["DMUExpandAllHdr"]}),l.unshift({line:1,name:"DMUCollapseAllStr",hdr_list:["DMUCollapseAllHdr"]});var s=n.getReviewContext({viewer:a});if(!s)return;var d=n.getContextViewer({reviewContext:s});if(!d)return;var c=t.getCommand("DMUDeleteHdr",d.getCommandContext());if(c&&c.enable(),1===o.length&&c)c.disable();else for(let e=0;e<o.length;e++)o[e].pathElement.getLastElement().getDMUType&&"DMUValidationExposedPresentation"!==o[e].pathElement.getLastElement().getDMUType()||c&&c.disable();return l}return[]},getContextualMenuCommandList:function(){return[]},register:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})},unregister:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})}})}),define("DS/DMUReviewPersistence/DMUAddHighlightCmd",["DS/CATWebUXComponents/DMUCommand","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseUIControllers/DMUCommentsController","DS/DMUBaseExperience/EXPToolsContext","DS/DMUMeasurable/DMUToolsSceneGraph","DS/Selection/CSOManager","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],function(e,t,n,i,a,r,o,l,s){"use strict";return e.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);var d,c,u=this,g=e.frameWindow||this.getFrameWindow(),m=g.getViewer(),p=null,v=null;function h(){c||(c=new t),c.build({type:"error",autoHide:!0,message:s.createHighlight.errorMessage,body:g.getUIFrame()}),d&&d.fireEvent("onHighlightCreationFailed"),u._endExecute()}this._createNewHighlight=function(e,t,i){var o=n.getReviewContext({viewer:g.getViewer()}),c=o.getValidation(),p=this.options.arguments.length&&this.options.arguments[0].Rating?this.options.arguments[0].Rating:"";if(e&&e.getParent()){var v,C="";d=n.giveEventsController({viewer:m});let i=o.getValidation().getContext().getJsonContextTypes()[0],g=a.getParentType(i)?a.getParentType(i):i;if("DMUComment"===e.getType()){var f=e.getAttribute("sTextContents");for(let t=0;t<f.length;t++){var D=e.getTextContent();C+=D,t<f[t].length-1&&(C+="\n")}if(c.getAllRepRefs().forEach(t=>{let n=t.getMarkupContent();if(n){let t=n.getComments();t&&t.forEach(t=>{if(t.getAttribute("sParentCommentId")===e.getAttribute("sUuid")){var n=t.getAttribute("sTextContents");for(let e=0;e<n.length;e++){var i=t.getTextContent();C+="\n",C+=i}}})}}),"Requirement"===g)v=c.getContext().getJsonContextNames()[0];else if("Document"===g){var w=e.getNode().getParents();let t=r.buildPathElement(w[0]),n=o.getDMUObjectFromPathElement(t).getAttribute("fPointedPageNumber");v=c.getContext().getJsonContextNames()[0]+"-"+s.page+" "+n}}l.addHighlight({iCtxViewer:n.getContextViewer({viewer:m}),validation:c,highlightRating:p,description:C,highlightName:v,markupRepRef:t,slide:e,onHighlightCreationCompleted:function(){u._endExecute()},onHighlightCreationFailed:function(){h(),u._endExecute()}})}else!1===i&&h(),u._endExecute()},this.beginExecute=function(){var e,a=n.getReviewContext({viewer:g.getViewer()}).getValidation();if(a.getCurrentMarkup()){var r=null,l="ReviewMarkup"===a.getCurrentMarkup().getValType()?a.getCurrentMarkup():a.getCurrentMarkup().getRepRef(),d=i.giveDMUCommentsController({context:g});d?(e=o.get()).length&&"DMUComment"===e[0].pathElement.getLastElement().getDMUType()?((r=d.getDMUObjectFromPathElement(e[0].pathElement))&&r.getParent&&r.getParent()&&r.getParent().getMarkupOwner&&(l=r.getParent().getMarkupOwner()),u._createNewHighlight(r,l,!0)):((v=new t).build({body:g.getUIFrame(),type:"info",notificationType:"HelpNotification",message:s.createHighlight.selectHighlight}),p=o.onAdd(function(){(e=o.get()).length>0&&e.length&&"DMUComment"===e[0].pathElement.getLastElement().getDMUType()&&((r=d.getDMUObjectFromPathElement(e[0].pathElement))&&r.getParent&&r.getParent()&&r.getParent().getMarkupOwner&&(l=r.getParent().getMarkupOwner()),u._createNewHighlight(r,l,!0))})):(r=l.getMarkupContent()&&l.getMarkupContent().getSlides().length>0?l.getMarkupContent().getCurrentSlide():null,u._createNewHighlight(r,l,!1))}else h(),this._endExecute()},this.cancelExecute=function(){this._endExecute()},this._endExecute=function(){o.unsubscribe(p),v&&v.destroy(),this.cancel()},this.destroy=function(){this._endExecute()}}})}),define("DS/DMUReviewPersistence/DMUSetImpactedCheckCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","DS/CATWebUXComponents/CATWebUXNotification","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],function(e,t,n,i,a,r){"use strict";return e.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);var o=e.frameWindow||this.getFrameWindow(),l=o.getViewer(),s=null,d=this,c=null,u=null,g=null,m=null;function p(){n.unsubscribe(s),u=null,c=null,g&&g.destroy(),m&&m.destroy(),d.cancel()}var v=function(e){var n=t.getContextViewer({viewer:l}),s=c.getAssociatedCheck();for(let i=0;i<e.length;i++)for(let l=0;l<s.length;l++)if(s[l]===e[i]){return(m=new a).build({type:"error",autoHide:!0,message:r.setImpactedCheck.duplicateError,body:o.getUIFrame()}),t.getEventsController({viewer:n.getViewer()}).fireEvent("onImpCheckFailed"),void d.cancelExecute()}i.setImpactedCheck({iCtxViewer:n,checks:e,highlight:c,onSetImpactedCheckComplete:function(){t.getEventsController({viewer:n.getViewer()}).fireEvent("onImpactedChecksCmdEnd"),p()},onSetImpactedCheckFailed:function(){(m=new a).build({type:"error",autoHide:!0,message:r.setImpactedCheck.error,body:o.getUIFrame()}),t.getEventsController({viewer:n.getViewer()}).fireEvent("onImpCheckFailed"),p()}})};this.beginExecute=function(){(g=new a).build({body:o.getUIFrame(),type:"info",notificationType:"HelpNotification",message:r.setImpactedCheck.selectCheck}),u?v(u):s=n.onAdd(function(){var e=n.get();if(e.length>0){var t=e[e.length-1].pathElement.getLastElement();t.getDMUType&&t.getOwner&&"DMUValidationCheck"===t.getDMUType()&&v([t.getOwner().getAttribute("sPlmID")])}}),this.done()},this.cancelExecute=function(){this.end(),this.done()},this.destroy=function(){p()},this.setHighlightObject=function(e){c=e},this.setCheckObject=function(e){u=e}}})}),define("DS/DMUReviewPersistence/DMUCreateReviewMarkupCmd",["UWA/Core","DS/CATWebUXComponents/DMUCommand","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUBaseExperience/DMUContextManager","DS/Controls/LineEditor","DS/Controls/Editor","DS/Windows/Dialog","DS/Controls/Button","DS/Utilities/TouchUtils","DS/DMUControls/DMUInfoModalDiv","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","DS/DMUPersistence/DMUAuthPersistenceUtils","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUBaseExperience/EXPToolsContext","DS/DMUPersistence/DMUAuthPersistenceServices","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence","css!DS/DMUReviewPersistence/DMUReviewPersistence.css"],function(e,t,n,i,a,r,o,l,s,d,c,u,g,m,p,v,h){"use strict";return t.extend({init:function(t){t.mode="shared",t.repeatMode=!1,t.isAsynchronous=!0,this._parent(t);var C,f,D,w,M,x,R,b,S,I=this,U=t.frameWindow||this.getFrameWindow(),y=U.getViewer();let k,V,E=[],P=[];function T(){x=null,R=null,S&&(S.destroy(),S=null),f&&f.destroy(),C&&C.destroy(),f=C=null,w=M=void 0,x=R=void 0,I.cancel()}function A(e){D&&c.createReviewMarkup({ctxViewer:D,validation:e.val,mkpName:x,markupPLMexternalID:b,duplicatedEntity:E,hiddenElts:P,createFirstSlide:k,onMarkupCreationCompleted:function(e){S&&(S.destroy(),S=null);let t=i.giveEventsController({viewer:y});t&&t.fireEvent("onDMUMarkupCreationSucceeded",{dmuObject:e.sessionMarkup}),T()},onMarkupCreationFailed:function(e){!function(){f||(f=new n),f.build({type:"error",autoHide:!0,message:h.createReviewMarkup.errorMessage,body:U.getUIFrame()});var e=i.giveEventsController({viewer:y});e&&e.fireEvent("onDMUMarkupCreationFailed"),T()}()}})}i.setAuthoringFeatureTypes("Markup"),this.beginExecute=function(){new Promise(function(e){c.generateName({sListTypeName:[{sTypeName:"DMUValidationReviewReference"}],onGenerateNameCompleted:function(t){x=t.listNames[0].title,b=t.listNames[0].name,e(x)},ononGenerateNameFailed:function(){x=h.createReviewMarkup.defaultMarkupName,e(x)}})}).then(async function(t){try{let e=(await g.readPreferences([{Repository:"DMURepository",PreferenceNames:["CreateFirstSlide","DisplayMarkupCreationDialog"]}])).repositories[0].preferences;for(let t=0;t<e.length;t++)"CreateFirstSlide"===e[t].name?k="true"===e[t].value:"DisplayMarkupCreationDialog"===e[t].name&&(V="true"===e[t].value)}catch(e){k=!0,V=!0,window.console.warn("Could not get server value, default value set instead.",e)}if(x=t,D=i.getContextViewer({viewer:y})){var n=i.getReviewContext({context:D});if(n){var c=async function(){(S=new d).display({modal:!0,frmWindow:U,type:"load",message:h.createReviewMarkup.loadingMessage}),P.length=0;let e="",t=n.getReviewCtxInformation();t&&t.contextId&&(e=t.contextId);let i=function(){var e=v.getPossibleRootContexts(D);if(e&&e.length){let t=m.getNodeType(e[0].getLastElement(!0));return p.getParentType(t)||t}}();if(!i||"Document"!==i&&"Requirement"!==i&&"Requirement Specification"!==i||(k=!0),k){let t=await u.getTransientMarkersAndOverloads(n,D,e);P=t.overloads,E=t.markers}A({val:n.getValidation()})},f=function(){C&&C.destroy(),c()};if(V){var b,I,F,N=e.createElement("div",{class:"DMUCreateMarkupPanelMainDiv"}),L=function(){var t=""===w.value;b.disabled=t,b.disabled||(x=w.value,R=M.value),I.innerHTML="",F.innerHTML="";var n=e.createElement("span",{class:"wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-required wux-ui-3ds-lg"});n.setStyles({color:"#E87B00",display:"inline-block","font-weight":"bold"}),t&&n.inject(I),I.setStyle("display",""!==I.innerHTML?"":"none"),F.setStyle("display",""!==F.innerHTML?"":"none")},O=e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection NoMarkupCreate"}).inject(N),j=e.createElement("div").inject(O),_=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(j);_.setStyles({marginRight:"5px"}),(I=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(j)).setStyles({color:"#E87B00",display:"none","font-weight":"bold","font-style":"italic"}),_.innerHTML=h.createReviewMarkup.nameLabel,(w=new a({placeholder:h.createReviewMarkup.namePlaceholder,value:x,selectAllOnFocus:!0,autoCommitFlag:!0}).inject(O)).elements.container.setStyles({width:"100%"}),w.elements.container.childNodes[0].setStyles({width:"100%"}),w.addEventListener("change",L);var B=e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection"}).inject(N),W=e.createElement("div").inject(B),H=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(W);(F=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(W)).setStyles({color:"red",display:"none","font-weight":"normal","font-style":"italic"}),H.innerHTML=h.createReviewMarkup.descriptionLabel,(M=new r({nbRows:5,newLineMode:"shiftEnter",placeholder:h.createReviewMarkup.descriptionPlaceholder,value:R,selectAllOnFocus:!0,autoCommitFlag:!0}).inject(B)).elements.container.setStyles({width:"100%"}),M.elements.container.childNodes[0].setStyles({width:"100%"}),M.addEventListener("change",L),(b=new l({emphasize:"primary",label:h.createReviewMarkup.createMarkupButton,onClick:f})).getContent().addClassName("reviewMarkupCreationButton");var q=new l({label:h.createReviewMarkup.cancelButton,onClick:function(){var e=i.giveEventsController({viewer:y});e&&e.fireEvent("onDMUMarkupCreationCancelled"),T()}});(C=new o({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:h.createReviewMarkup.panelTitle,resizableFlag:!0,immersiveFrame:U.getImmersiveFrame(),position:s.getTouchMode()?{my:"center bottom"}:void 0,buttons:{Ok:b,Cancel:q},width:400,content:N})).addEventListener("close",function(){T()})}else f()}else T()}else T()})},this.destroy=function(){T()},this.setDefaultInfo=function(e){x=e.title,R=e.description}}})}),define("DS/DMUReviewPersistence/DMUUpdateValidatedListCmd",["DS/CATWebUXComponents/DMUCommand","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/Visualization/PathElement","DS/DMUMeasurable/DMUToolsSceneGraph","DS/CATWebUXComponents/CATWebUXNotifBar","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","DS/DMUBaseExperience/EXPToolsContext","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],function(e,t,n,i,a,r,o,l,s,d,c){"use strict";return e.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0;var u,g=null,m=null,p=this;this._parent(e);let v=e.args;if(v){let e=Object.keys(v),t=Object.values(v);this.options.arguments=[],this.options.arguments[0]={};for(let n=0;n<e.length-1;n++)this.options.arguments[0][e[n]]=t[n]}var h,C,f=e.frameWindow||this.getFrameWindow();function D(){i.unsubscribe(g),i.unsubscribe(m),u&&u.destroy(),p.cancel()}this.contextIsAPart=function(){var e=n.getReviewContext({viewer:f.getViewer()}),t=n.getContextViewer({viewer:f.getViewer()}).getController(),i=!0;let a=e.getValidation().getContext().getJsonContextTypes()[0];if("VPMReference"!==(d.getParentType(a)?d.getParentType(a):a))i=!1;else{var o=e.getValidation().getContext().getJsonContexts()[0].id,l=[],s=t.getNode({id:o});l.push(s);var c=new r(l);if(i=c,c.externalPath.length)for(var u=c.externalPath[0].getChildren(),g=0;g<u.length;g++)u[g].userData&&"VPMInstance"===u[g].userData.type&&(i=!1)}return i},this._isValidatedDuplicated=function(e){var t=n.getReviewContext({viewer:f.getViewer()}).getValidation().getValidated().getPathElements();for(let n=0;n<t.length;n++)if(o.getIdPath(e).equals(t[n].pathElement))return!0;return!1},this.getLastInstance=function(e){return e.getLength()>1?o.isInstance(e.getLastElement(!0))&&!o.isRepInstance(e.getLastElement(!0))?e.clone():this.getLastInstance(e.getParentPath()):new r},this._createNewValidated=function(e){var i=n.getReviewContext({viewer:f.getViewer()}),a=i.getValidation().getValidated().getPathElements(),r=e.validatedPath,o=[],l=[];let s=this.options.arguments[0].Value;var d=function(e){var t=[];if(e)if(e.length>1)for(var n=1;n<e.length-1;)t.push(e[n]),n+=2;else 1===e.length&&t.push(e[0]);return t},u=-1;for(let n=0;n<a.length;n++){for(let i=0;i<e.validatedPath.length;i++)(e.refFullPath[i].equals(a[n].pathElement)||e.validatedPath[i].equals(a[n].pathElement))&&("add"===s&&(C||(C=new t),C.build({type:"information",autoHide:!0,message:c.updateValidatedListCmd.ValidatedExist,body:f.getUIFrame()})),u=n);u!==n?o.push(d(a[n].pathElement)):a.length&&a[n]&&l.push(a[n].instanceName?a[n].instanceName:void 0),u=-1}if("add"===s)for(let e=0;e<r.length;e++)o.push(d(r[e]));return{validatedObjects:o,validatedId:i.getValidation().getValidated().getPlmID()?i.getValidation().getValidated().getPlmID():null,instanceNames:l}},this.beginExecute=function(){h=f.getViewer();var e=[],t=p.contextIsAPart(),v=[],C=[],w=[],M=[],x=[],R=function(){let l,c=[],u=i.get(),g=n.getReviewContext({viewer:f.getViewer()}),m=g.getValidation().getContext().getJsonContextTypes()[0],R=d.getParentType(m)?d.getParentType(m):m,b=n.getContextViewer({viewer:f.getViewer()}).getController(),S=g.getValidation().getContext().getJsonContextIDs()[0],I=b.getNode({id:S}),U=o.buildPathElement(I),y=p.options.arguments[0].Value;if(["Requirement Specification","Requirement","Document","DesignSight","R2V_FeatureState"].includes(R)){let e=g.getValidation().getValidated().getPathElements(),t=[];e.length>0&&e.forEach(e=>{t.push(e.pathElement)}),u.forEach(e=>{if(e.pathElement.getLastElement().getDocInfo)M.push(e.pathElement.getLastElement().getDocInfo().validatedPaths[0]),x.push(e.pathElement.getLastElement().getDocInfo().validatedPaths[0]),t.forEach((n,i)=>{n[0]===e.pathElement.getLastElement().getDocInfo().validatedPaths[0]&&t.splice(i,1)}),C=e.pathElement.getLastElement().getDocInfo().validatedPaths,v.push(e.pathElement.getLastElement().getDocInfo().validatedPaths);else if(e.pathElement.getLastElement().getReqInfo){const n=e.pathElement.getLastElement().getReqInfo().id;M.push(n),x.push(n),t.forEach((e,i)=>{e[0]===n&&(C.push(e),t.splice(i,1))})}else e.pathElement.getLastElement().getModelIdentification&&(M.push(e.pathElement.getLastElement().getModelIdentification()),x.push(e.pathElement.getLastElement().getModelIdentification()),t.forEach((n,i)=>{n[0]===e.pathElement.getLastElement().getModelIdentification()&&(C.push(n),t.splice(i,1))}))}),l={validatedObjects:t,validatedId:g.getValidation().getValidated().getPlmID(),instanceNames:""}}else{for(let e=0;e<u.length;e++)U.isAParentOf(u[e].pathElement)&&c.push(u[e]);if(0===c.length){let e=n.getEventsController({viewer:f.getViewer()});i.empty(),a.empty(),e.fireEvent("onValidatedObjCancelRequested"),p.endExecute()}else{if(c.length>0)for(let n=0;n<c.length;n++){if(c[n].pathElement&&v.push(o.getIdPath(c[n].pathElement)),t&&t.externalPath&&t.externalPath.length)e.push(t);else{e.push(function(e){var t=null;if(e){t=new r;for(var n=1;n<e.getLength();n++){var i=e.getElement(n);if(o.isRepInstance(i))break;t.addElement(i)}}return t}(c[n].pathElement))}"add"!==y||p._isValidatedDuplicated(e[n])?"remove"===y&&(e[n].externalPath&&C.push(o.getIdPath(e[n])),w.push(o.getLastReference(e[n]).getLastElement()),M.push(w[n]?w[n].getModelIdentification():C[n][0]),p.getLastInstance(e[n]).getLastElement()?x.push(p.getLastInstance(e[n]).getLastElement().getModelIdentification()):x.push(M[n])):(e[n].externalPath&&C.push(o.getIdPath(e[n])),w.push(o.getLastReference(e[n]).getLastElement()),M.push(w[w.length-1]?w[w.length-1].getModelIdentification():C[C.length-1][0]),p.getLastInstance(e[n]).getLastElement()?x.push(p.getLastInstance(e[n]).getLastElement().getModelIdentification()):x.push(M[M.length-1]))}if(C.length&&C[0].length&&v.length&&v[0].length)l=p._createNewValidated({validatedPath:C,refFullPath:v});else{let e=n.getEventsController({viewer:f.getViewer()});i.empty(),a.empty(),e.fireEvent("onValidatedObjCancelRequested"),p.endExecute()}}}l&&s.updateValidatedObjectsList({fullPathRefs:v,validatedObjects:l.validatedObjects,validatedId:l.validatedId,validatedToAdd:C,referenceIds:M,instanceIds:x,instanceNames:l.instanceNames,updateMode:y,ctxViewer:h,onSaveValidatedObjectsFailed:function(){}}),D()};let b=c.updateValidatedListCmd.SelectMsg?c.updateValidatedListCmd.SelectMsg:"Select the Validated Object(s) to add",S=c.updateValidatedListCmd.OkBtn?c.updateValidatedListCmd.OkBtn:"OK",I=c.updateValidatedListCmd.CancelBtn?c.updateValidatedListCmd.CancelBtn:"OK";(u=new l({className:"R3VAddValidatedCmdDlg"}).inject(f.getUIFrame())).add({msgType:"primary",message:b,closable:!1,buttons:[{className:"primary",label:S,onClick:R},{className:"default",label:I,onClick:function(){let e=n.getEventsController({viewer:f.getViewer()});i.empty(),a.empty(),e.fireEvent("onValidatedObjCancelRequested"),D()}}]}),0===i.get().length&&(u.elements.container.getElementsByClassName("btn btn-sm btn-primary")[0].disabled=!0),"add"===this.options.arguments[0].Value?(g=i.onAdd(function(){u.elements.container.getElementsByClassName("btn btn-sm btn-primary")[0].disabled=!1,u.show()}),m=i.onRemove(function(){0===i.get().length&&(u.elements.container.getElementsByClassName("btn btn-sm btn-primary")[0].disabled=!0)})):R()},this.destroy=function(){D()}}})}),define("DS/DMUReviewPersistence/DMUAddCheckCmd",["DS/CATWebUXComponents/DMUCommand","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUBaseExperience/DMUContextManager","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],function(e,t,n,i,a){"use strict";return e.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);var r,o,l=this,s=e.frameWindow||this.getFrameWindow(),d=s.getViewer();this._createNewCheck=function(e){var c=n.getReviewContext({viewer:s.getViewer()});r=n.giveEventsController({viewer:d}),i.addCheck({iCtxViewer:n.getContextViewer({viewer:d}),validation:c.getValidation(),requirementDocId:"",checkName:e||"",description:"",checkState:1,onSaveCheckFailed:function(){o||(o=new t),o.build({type:"error",autoHide:!0,message:a.createCheck.errorMessage,body:s.getUIFrame()}),r&&r.fireEvent("onCheckCreationFailed"),l.end()}}),l.end()},this.beginExecute=function(){l._createNewCheck()}}})}),define("DS/DMUReviewPersistence/DMUCreateReviewCmd",["UWA/Core","DS/CATWebUXComponents/DMUCommand","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUBaseExperience/DMUContextManager","DS/Controls/ComboBox","DS/Controls/LineEditor","DS/Controls/Editor","DS/DMUMeasurable/DMUToolsSceneGraph","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Tab","DS/Utilities/TouchUtils","DS/DMUControls/DMUInfoModalDiv","DS/Visualization/PathElement","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","DS/DMUReadPersistence/DMULoadingContextController","DS/DMUPersistence/DMUAuthPersistenceUtils","DS/DMUPersistence/DMUAuthPersistenceServices","DS/DMUBaseExperience/EXPToolsContext","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence","css!DS/DMUReviewPersistence/DMUReviewPersistence.css"],function(e,t,n,i,a,r,o,l,s,d,c,u,g,m,p,v,h,C,f,D,w){"use strict";return t.extend({init:function(t){t.mode="shared",t.repeatMode=!1,t.isAsynchronous=!0,this._parent(t);let M,x=t.args;if(x){let e=Object.keys(x),t=Object.values(x);this._arguments=[];for(let n=0;n<e.length-1;n++)this._arguments.push({ID:e[n],Value:t[n]})}t.executionContext&&t.executionContext.getSourceApp()&&(M=t.executionContext.getSourceApp().options.id);var R,b,S,I,U,y,k,V,E,P,T,A=this,F=x?"ENOR3V_AP"===M:"DMUDesignValidation"===t.arguments[0].Value,N=t.frameWindow||this.getFrameWindow(),L=N.getViewer(),O=[],j=[],_=[],B=[];let W,H,q,X,J,G,z,$=null;function K(){U=null,k=null,V=null,$=null,O=[],j=[],b&&b.destroy(),R&&R.destroy(),b=R=null,I=void 0,U=k=V=void 0,A.end?A.end():A.done()}function Q(e){var t;T&&(T.destroy(),T=null),b||(b=new n),t="errorShape"===e?w.createReview.errorShape:w.createReview.errorMessage,b.build({type:"error",autoHide:!0,message:t,body:N.getUIFrame()});let a=i.giveEventsController({viewer:L});a&&a.fireEvent("onDMUReviewCreationFailed"),K()}function Y(e){var t="",n=i.getContextViewer({viewer:L}).getController();return O.forEach(function(i){if(i.valueItem===e){switch(f.getParentType(i.type)?f.getParentType(i.type):i.type){case"ENOStrRefinementSpecification":t="NGFilter";break;case"Requirement":t="Requirement";break;case"Requirement Specification":t="Requirement Specification";break;case"Document":t="Document";break;case"Specification Report":t="Specification Report";break;case"Drawing":t="Drawing";break;case"SIMItfSimulation":t="ITF";break;case"PLMPIMMetricReference":t="ISR";break;case"DIFSheet":t="DIFSheet";break;case"DesignSight":t="DesignSight";break;case"R2V_FeatureState":t="R2V_FeatureState";break;default:var a=[],r=n.getNode({id:e});a.push(r);var o=new m(a);if(l.isRepReference(o.getLastElement(!0)))t="RepRef";else if(l.isReference(o.getLastElement(!0))){t="Product";var s=o.externalPath[0].getChildren();if(s.length>0){t="Part";for(let e=0;e<s.length;e++)if(!l.isRepInstance(s[e])){t="Product";break}}}}}}),t}function Z(){let e=i.giveEventsController({viewer:L});var t;let n=i.getReviewContext({context:S});if(n&&n.getValidation()?i.removeReviewContext({viewer:L}):n&&n.removeInternalDataModel(),e.fireEvent("onDMURemoveSessionReview"),!S)return;var a=I?I.value:O.length?O[0].valueItem:void 0,r=null;I?O.forEach(function(e){e.valueItem===I.value&&(r=e)}):r=O[0]?O[0]:void 0;var o="false",s=[];let d;a&&(d=Y(a),["Part","Document","Specification Report","Requirement","DIFSheet","Drawing","R2V_FeatureState"].includes(d)&&("Specification Report"===d&&($||($=v.getLoadingContextController({context:S})),$&&(t=$.getSubContextInformations(a))),"ENOR3V_AP"===z&&("Specification Report"===d&&t&&t.id?s.push([t.id]):s.push([a]),o="true")));let c="Document"===d||"Specification Report"===d||W;!d||"Document"!==d&&"Specification Report"!==d&&"Requirement"!==d&&"Requirement Specification"!==d||(H=!0),p.createReview({_ctxViewer:S,_reviewName:U,_reviewPLMexternalID:P,_rootData:r,_subContext:t,_reviewDescription:k,_restrictedEdition:"ENOR3V_AP"===z?G:J,_createMarkup:c,_markupName:y,_markupPLMexternalID:E,_markupDescription:V,_contextAsValidated:o,_validatedObjects:s,_parentID:a,_dmuEltsDuplicated:_,hiddenElts:B,_editionMode:F,_createFirstSlide:H,onReviewCreationComplete:function(){if("R2V_FeatureState"===d&&(S.toggleSOITimelinesUsability(!1),e&&e.fireEvent("onR2VReviewCreationSuccess")),e&&e.fireEvent("onDMUReviewCreationSucceeded"),"ITF"===d||"ISR"===d){n=i.getReviewContext({context:S});let e=S.getRootBagPath().getChildrenPathes(),t=l.getNodeID(e[0].getLastElement(!0)),a="add";p.updateValidatedObjectsList({fullPathRefs:[[t]],validatedObjects:[[t]],validatedId:n.getValidation().getValidated().getPlmID()?n.getValidation().getValidated().getPlmID():null,validatedToAdd:[[t]],referenceIds:[t],instanceIds:[t],instanceNames:[],updateMode:a,ctxViewer:S.getViewer(),onReviewCtxUpdateOrDropValidated:!0,onSaveValidatedObjectsFailed:function(){}})}K()},onReviewCreationFailed:Q})}async function ee(){let t,n,l;try{let e=(await D.readPreferences([{Repository:"DMURepository",PreferenceNames:["DisplayMarkupCreationDialog","CreateFirstSlide","AutomaticMarkupCreationDialog","ValidationAutomaticMarkupCreationDialog","DisplayReviewCreationDialog","ReviewRestrictedAccess","ValidationRestrictedAccess"]}])).repositories[0].preferences;for(let t=0;t<e.length;t++)"CreateFirstSlide"===e[t].name?H="true"===e[t].value:"AutomaticMarkupCreationDialog"===e[t].name?n="true"===e[t].value:"ValidationAutomaticMarkupCreationDialog"===e[t].name?l="true"===e[t].value:"DisplayReviewCreationDialog"===e[t].name?q="true"===e[t].value:"DisplayMarkupCreationDialog"===e[t].name?X="true"===e[t].value:"ReviewRestrictedAccess"===e[t].name?J=e[t].value:"ValidationRestrictedAccess"===e[t].name&&(G=e[t].value)}catch(e){H=!0,n=!1,l=!0,q=!0,J="Deactivated",G="Activated",window.console.warn("Could not get server value, default value set instead.",e)}"ENOR3V_AP"===z?W=l:"ENOR3R_AP"===z&&(W=n);var m=W?[{sTypeName:"DMUValidationValidation"},{sTypeName:"DMUValidationReviewReference"}]:[{sTypeName:"DMUValidationValidation"}];U||new Promise(function(e){p.generateName({sListTypeName:m,onGenerateNameCompleted:function(t){U=t.listNames[0].title,P=t.listNames[0].name,W&&(y=t.listNames[1].title,E=t.listNames[1].name),e()},ononGenerateNameFailed:function(){U=j.length?w.createReview.defaultReviewName+"_"+j[0]:w.createReview.defaultReviewName,e()}})}).then(function(){var n,l=i.getReviewContext({context:S}),m=function(){R&&R.destroy(),async function(){(T=new g).display({modal:!0,frmWindow:N,type:"load",message:w.createReview.loadingMessage}),T.getContent().addClassName("DMUCreateReviewInfoDiv");var e=I?I.value:O.length?O[0].valueItem:void 0;if(W&&H){let t=await h.getTransientMarkersAndOverloads(l,S,e);B=t.overloads,_=t.markers}if(l)if(l.getValidation()){var t,n=l?l.getValidation():null,i=n?n.getCurrentMarkup():null;i&&"Markup"===i.getType()?t=l.getRestrictions()?l.getRestrictions().markup.canEdit:null:i&&"Reply"===i.getType()&&(t=l.getRestrictions()?l.getRestrictions().reply.canEdit:null),i&&t?p.saveReviewMarkup({markupRepRefId:i.getRepRef().getPlmID(),frmWindow:N,onSaveCompleted:Z,onSaveFailed:e=>{"NoSaveNeeded"===e&&Z()}}):Z()}else Z();else Z()}()},v=function(i,s){var d,c,u,g,m,p,v;O.length>1&&"review"===s&&(m=W?e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection"}).inject(i):e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection NoMarkupCreate"}).inject(i),e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(m).innerText=w.createReviewMarkup.multipleRootsLabel,I=new a({elementsList:O,selectedIndex:0,enableSearchFlag:!0,actionOnClickFlag:!1}).inject(m),W?m.setStyles({paddingTop:"10px",paddingBottom:"0px"}):m.setStyles({paddingBottom:"10px"}),I.elements.container.setStyles({width:"100%"}),I.elements.container.setStyles({width:"calc(100% - 3px)"}));var h,C=function(){var i,a="review"===s;i=a?""===d.value:""===c.value,n.disabled=i,n.disabled||(a?(U=d.value,k=u.value):(y=c.value,V=g.value)),p.innerHTML="",v.innerHTML="";var r=e.createElement("span",{class:"wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-required wux-ui-3ds-lg"});r.setStyles({color:"#E87B00",display:"inline-block","font-weight":"bold"}),i?(r.inject(p),t&&(t.tabBar.buttonGroup.getButton(t.value[0]).icon={iconName:"required",fontIconFamily:WUXManagedFontIcons.Font3DS},t.tabBar.buttonGroup.getButton(t.value[0]).elements.button.getChildren()[0].getChildren()[0].setStyles({color:"#E87B00","font-weight":"bold"}))):t&&(t.tabBar.buttonGroup.getButton(t.value[0]).icon={iconName:"doc",fontIconFamily:WUXManagedFontIcons.Font3DS}),p.setStyle("display",""!==p.innerHTML?"":"none"),v.setStyle("display",""!==v.innerHTML?"":"none")},f=function(e){var t=new r({placeholder:w.createReview.namePlaceholder,value:e,selectAllOnFocus:!0,autoCommitFlag:!0});return t.elements.container.setStyles({width:"100%"}),t.elements.container.childNodes[0].setStyles({width:"100%"}),t._myInput.maxLength=100,t.addEventListener("change",C),t},D=function(e){var t=new o({nbRows:5,newLineMode:"shiftEnter",placeholder:w.createReview.descriptionPlaceholder,value:e,selectAllOnFocus:!0,autoCommitFlag:!0});return t.elements.container.setStyles({width:"100%"}),t.elements.container.childNodes[0].setStyles({width:"100%"}),t.addEventListener("change",C),t};W?(h=e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection"}).inject(i)).setStyles({paddingTop:"10px"}):h=e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection NoMarkupCreate"}).inject(i);var M=e.createElement("div").inject(h),x=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(M);x.setStyles({marginRight:"5px"}),(p=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(M)).setStyles({color:"#E87B00",display:"none","font-weight":"bold","font-style":"italic"}),x.innerHTML=w.createReview.nameLabel,"review"===s?(d=f(U)).inject(h):(c=f(y)).inject(h);var R=e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection"}).inject(i),b=e.createElement("div").inject(R),S=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(b);(v=e.createElement("p",{class:"DMUCreateMarkupPanelLabel"}).inject(b)).setStyles({color:"red",display:"none","font-weight":"normal","font-style":"italic"}),S.innerHTML=w.createReview.descriptionLabel,"review"===s?(u=D(k)).inject(R):(g=D(V)).inject(R);var E=e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection"}).inject(i),P=e.createElement("div").inject(E),T=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(P),A=e.createElement("div",{class:"DMUCreateMarkupPanelItem"}).inject(P);let F;if("ENOR3V_AP"===z)F=G;else{if("ENOR3R_AP"!==z)throw new Error(`Invalid appId: ${z}`);F=J}if(T.innerHTML=`${w.createReview.restrictedEditionLabel}`,"Activated"===F?(A.innerHTML=`    ${w.createReview.restrictedEditionActivated}`,sessionStorage.setItem("validationRestrictedAccess","Activated")):"Deactivated"===F&&(A.innerHTML=`    ${w.createReview.restrictedEditionDeactivated}`,sessionStorage.setItem("validationRestrictedAccess","Deactivated")),l&&l.getValidation()){var N=e.createElement("p",{class:"DMUCreateMarkupPanelLabel"}).inject(i);N.innerHTML=w.createReview.warningMessage,N.setStyles({color:"#e87b00","font-weight":"normal","font-style":"italic",margin:"0","margin-top":"10px"})}};if(q||O.length>1||l&&l.getCurrentSessionMarkup()){var C=e.createElement("div",{class:"DMUCreateReviewPanelMainDiv"});if(X&&W){var f=e.createElement("div",{class:"DMUCreateReviewTab"}).inject(C);(t=new c({displayStyle:"strip"})).inject(f);var D=e.createElement("div",{class:"DMUCreateReviewPanelReviewTab"}),M=e.createElement("div",{class:"DMUCreateMarkupPanelReviewTab"});v(D,"review"),v(M,"markup"),t.add({label:w.createReview.labelReview,content:D,icon:{iconName:"review",fontIconFamily:WUXManagedFontIcons.Font3DS}}),t.add({label:w.createReview.labelMarkup,content:M,icon:{iconName:"markup-review",fontIconFamily:WUXManagedFontIcons.Font3DS}}),t.value=[0],t.tabBar.centeredFlag=!1}else v(C,"review");(n=new d({emphasize:"primary",label:w.createReview.createreviewButton,onClick:m})).getContent().addClassName("reviewCreationButton");var x=new d({label:w.createReview.cancelButton,onClick:function(){var e=i.giveEventsController({viewer:L});e&&e.fireEvent("onDMUMarkupCreationCancelled"),K()}});R=new s({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:w.createReview.panelTitle,resizableFlag:!0,immersiveFrame:N.getImmersiveFrame(),position:u.getTouchMode()?{my:"center bottom"}:void 0,buttons:{Ok:n,Cancel:x},width:400,content:C}),l&&l.getValidation()&&(n.emphasize="medium-attention",n.icon={iconName:"warning",fontIconFamily:WUXManagedFontIcons.font3DS}),R.addEventListener("close",function(){K()})}else m()})}i.setAuthoringFeatureTypes("Check"),i.setAuthoringFeatureTypes("Highlight"),this.beginExecute=function(){var e;if(z=window.widget.getValue("appId"),S=i.getContextViewer({viewer:L})){var t=C.getPossibleRootContexts(S),n=[];for(e=0;e<t.length;e++){var a=S.getController().isFiltered(l.getNodeID(t[e].getLastElement(!0)));if(S.getApplicativeData&&S.getApplicativeData().getLoadedItfData&&S.getApplicativeData().getLoadedItfData().data.length){S.getApplicativeData().getLoadedItfData().data.forEach(function(e){n.push({rootID:e.isrID,type:"ISR"})});break}if(a.filterId)n.push({rootID:a.filterId,type:"ENOStrRefinementSpecification"});else if(""!==l.getNodeID(t[e].getLastElement(!0))){const i=l.getNodeID(t[e].getLastElement(!0));n.push({rootID:l.getNodeID(t[e].getLastElement(!0)),type:S.getController().getRootStats(i)&&"r2vsurvey"===S.getController().getRootStats(i).serviceId?"R2V_FeatureState":l.getNodeType(t[e].getLastElement(!0))})}}n.length?new Promise(function(e){var t=0;n.forEach(function(i){if("R2V_FeatureState"===i.type){$||($=v.getLoadingContextController({context:S})),$.getLoadedR2VInformations().forEach(a=>{a.id===i.rootID&&(t++,O.push({labelItem:a.info[0]["ds6w:label"],iconItem:a.info[0].icon,valueItem:i.rootID,type:i.type}),t===n.length&&e())})}else S.getController().getAttributes({ids:[i.rootID],attributes:["ds6w:label","ds6wg:revision","type_icon_url","ds6w:type"],callbacks:{onComplete:function(n){var a,r,o,l;(t++,n[i.rootID]&&(r=n[i.rootID].type_icon_url,a=n[i.rootID]["ds6w:label"],l=n[i.rootID]["ds6w:type"],o=f.getParentType(n[i.rootID]["ds6w:type"])?f.getParentType(n[i.rootID]["ds6w:type"]):l,n[i.rootID]["ds6wg:revision"]&&(a+=" "+n[i.rootID]["ds6wg:revision"]),j.push(a),O.push({labelItem:a,iconItem:r,valueItem:i.rootID,type:o})),i)?"RepRef"===Y(i.rootID)?Q("errorShape"):e():Q()},onFailure:function(){t++;[{type:"ENOStrRefinementSpecification",label:"Filter"},{type:"Document",label:"Document"},{type:"Specification Report",label:"Specification Report"},{type:"ISR",label:"Iterference Simulation"},{type:"PLMPIMMetricReference",label:"Iterference Metric"},{type:"DesignSight",label:"Physics Simulation"},{type:"Requirement",label:"Requirement"},{type:"Requirement Specification",label:"Requirement Specification"},{type:"R2V_FeatureState",label:"R2V_FeatureState"}].some(n=>{if(i.type===n.type)return j.push(n.label),O.push({labelItem:n.label+t,valueItem:i.rootID,type:i.type}),e(),!0})}}})})}).then(function(){ee()}):ee()}else K()},this.cancelExecute=function(){K()}}})});