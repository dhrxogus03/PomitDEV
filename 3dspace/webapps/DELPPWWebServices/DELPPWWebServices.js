define("DS/DELPPWWebServices/XMLTranslater",["UWA/Core","UWA/Class"],function(e,t){"use strict";const i=function(e){return Array.isArray(e)?[...e]:[e]},n=function(e,t){let i={...e};const n=e.dataIndex.split(".");return 1===n.length?i.dataIndex=n[0]:(i.entity=n[n.length-1],2===n.length?i.dataIndex=n[0]:3===n.length&&(i.dataIndex=n[1])),i.dicoType&&"BusinessType"===i.dicoType&&delete i.dicoType,t&&(i.name=i.dataIndex,delete i.dataIndex),i},r=function(e){const t={},i=e.name?e.name.split("."):[];if(1===i.length){const n=["current","description","isbestsofar","ispublished","locked","locker","majorrevision","minorrevision","modified","name","organization","originated","owner","physicalid","policy","project","reserved","reservedby","revision"],r=i[0];t.name=r,n.includes(r)||(t.dicoType=e.dicoType||("PLM_ExternalID"===r?"PLMInstance":"PLMEntity"))}else t.name=i[1],t.dicoType=i[0];return t},s=function(e,t){const i=[],s=t?n:r;for(const n of e){let e={...n};if(Array.isArray(e.Attribute)){e.Attribute=[];for(const i of n.Attribute)e.Attribute.push(s(i,t))}else e.Attribute=s(n.Attribute,t);i.push(e)}return i},o=function(e){const t=[];for(const i of e){let e={...i};i.property&&(delete e.property,e.name=i.property),i.dicoType&&"BusinessType"===i.dicoType&&delete e.dicoType,t.push(e)}return t},a=function(e){const t=[];for(const r of e){let e={};if(e.name=r.name,r.Row){const t=i(r.Row);e.Row=[];for(const i of t)e.Row.push(n(i))}t.push(e)}return t},c=function(e){for(const t of e)t.name&&(t.name=t.name.split(".")[0]);return e};return t.singleton({name:"XMLTranslater",columnConfiguration:function(e){if(e.Label){const t=e.Label;Array.isArray(t)?(e.Label=[],t.forEach(t=>{e.Label.push(n(t))})):e.Label=n(t)}if(e.Columns&&e.Columns.Column){const t=i(e.Columns.Column);e.Columns.Column=function(e){const t=[];for(const i of e){let e={...i};const n=e.dataIndex.split(".");if("MultiType"===e.displayType){let t,r;if(delete e.dataIndex,1===n.length?t=n[0]:(r=n[n.length-1],2===n.length?t=n[0]:3===n.length&&(t=n[1])),i.dicoType&&Array.isArray(i.dicoType)&&i.dicoType.length>0){delete e.dicoType,e.Attribute=[];for(const n of i.dicoType){let i={name:t,entity:r};n.dicoType&&(i.dicoType=n.dicoType),e.Attribute.push(i)}}}else{if(1===n.length)e.dataIndex=n[0];else{const t=n[n.length-1];["reference","instance"].includes(t)&&(e.entity=n[n.length-1]),2===n.length?e.dataIndex=n[0]:3===n.length&&(e.dataIndex=n[1])}e.dicoType&&"BusinessType"===e.dicoType&&delete e.dicoType,e.dataIndex&&"PLM_ExternalID"===e.dataIndex&&(!e.dicoType||"PLMCoreInstance"!==e.dicoType&&"DELFmiFunctionIdentifiedInstance"!==e.dicoType||(e.dicoType="PLMInstance")),e.dataIndex&&"V_isLastVersion"===e.dataIndex&&e.dicoType&&"PLMCoreReference"===e.dicoType&&(e.dicoType="PLMReference"),e.dataIndex&&"V_ApplicabilityDate"===e.dataIndex&&e.dicoType&&"DELLmiProductionSystemReference"===e.dicoType&&(e.dicoType="PLMReference")}t.push(e)}return t}(t)}},exportCSVPreference:function(e){if(e.Preferences&&e.Preferences.ExportCSV&&e.Preferences.ExportCSV.Type){const t=i(e.Preferences.ExportCSV.Type);e.Preferences.ExportCSV.Type=1===t.length?{...s(t)[0]}:s(t)}},relationsColumns:function(e){if(e.RelationsDisplayAttributes){if(e.RelationsDisplayAttributes.Relation){const t=i(e.RelationsDisplayAttributes.Relation);e.RelationsDisplayAttributes.Relation=1===t.length?{...s(t)[0]}:s(t)}if(e.RelationsDisplayAttributes.Type){const t=i(e.RelationsDisplayAttributes.Type);e.RelationsDisplayAttributes.Type=1===t.length?{...s(t)[0]}:s(t)}}if(e.RelationsColumns&&e.RelationsColumns.RelationsColumn){const t=i(e.RelationsColumns.RelationsColumn);e.RelationsColumns.RelationsColumn=1===t.length?{...c(t)[0]}:c(t)}if(e.Relation){const t=i(e.Relation);e.Relation=1===t.length?{...s(t)[0]}:s(t)}if(e.Type){const t=i(e.Type);e.Type=1===t.length?{...s(t)[0]}:s(t)}},graphViewConfiguration:function(t){t.Preferences&&e.is(t.Preferences,"object")&&function e(t){for(const[n,r]of Object.entries(t))if("Info"===n){const e=i(r);delete t.Info,t.Attribute=1===e.length?{...o(e)[0]}:o(e)}else"object"==typeof r&&e(r)}(t.Preferences)},toolTipFormConfiguration:function(e){if(e.Tooltip){const t=i(e.Tooltip);e.Tooltip=1===t.length?{...s(t,!0)[0]}:s(t,!0)}},editFormConfiguration:function(e){if(e.Type){const t=i(e.Type);e.Type=1===t.length?{...s(t)[0]}:s(t)}},bomViewConfiguration:function(e){if(e.Preferences&&e.Preferences.BOMView&&e.Preferences.BOMView.Content&&e.Preferences.BOMView.Content.Type){const t=i(e.Preferences.BOMView.Content.Type);e.Preferences.BOMView.Content.Type=1===t.length?{...a(t)[0]}:a(t)}}})}),define("DS/DELPPWWebServices/CommonService",["UWA/Core","UWA/Class","DS/WebappsUtils/WebappsUtils","DS/DELPPWModelServices/ModelUtils","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/DELPPWLoggerModel/LoggerUtils"],function(e,t,i,n,r,s,o){"use strict";return t.extend({name:"CommonService",_servicesURL:{},_platformId:{},_3DSpaceServiceName:"3DSpace",_AppCloudServiceName:"3dmfgitemsmgt",_3DSearchServiceName:"3DSearch",_defaultSecurityContext:"ctx::FakeDefaultRole.FakeDefaultOrga.FakeDefaultCommonSpace",_CSRFToken:{},init:function(t){t=t||{},e.is(t.cloudServiceName)?this._AppCloudServiceName=t.cloudServiceName:o.debug(this.name,"ERROR: Cloud Service name is not provided"),this._servicesURL[this._3DSpaceServiceName]="NOT_DEFINED",this._servicesURL[this._AppCloudServiceName]="NOT_DEFINED",this._servicesURL[this._3DSearchServiceName]="NOT_DEFINED",this._platformId[this._3DSpaceServiceName]="NOT_DEFINED",this._platformId[this._AppCloudServiceName]="NOT_DEFINED",this._platformId[this._3DSearchServiceName]="NOT_DEFINED",this._CSRFToken[this._3DSpaceServiceName]=null,this._CSRFToken[this._AppCloudServiceName]=null,this._CSRFToken[this._3DSearchServiceName]=null,o.debug(this.name,"initialized")},getDefault3DSpaceBaseURL:function(t){var n=!!e.is(t,"string")&&t.length>0,r=(n?n?t:"":i.getWebappsBaseUrl()).match(/^(https?:\/\/)?([\da-z\.-]+)(:[0-9]{2,5})?([\/\w \.-]*3DDashboard\/)*/),s="";return e.is(r)&&e.is(r,"array")&&(s=(e.is(r[1])?r[1]:"")+r[2]+(e.is(r[4])?"":r[3])+(e.is(r[4])?r[4].replace(/3DDashboard\/?/,"3DSpace/"):"/3DSpace/")),s},getPlatformID:function(t){var i=null;return t=t||{serviceId:this._3DSpaceServiceName},e.is(t.serviceId,"string")?i=this._platformId[t.serviceId]:o.debug(this.name,"ERROR: Couldn't retrieve the platform ID"),i},get3DSpaceServiceName:function(){return this._3DSpaceServiceName},get3DSpaceUrl:function(){return"NOT_DEFINED"===this._servicesURL[this._3DSpaceServiceName]&&(this._servicesURL[this._3DSpaceServiceName]=this.getDefault3DSpaceBaseURL()),this._servicesURL[this._3DSpaceServiceName]},get3DSearchUrl:function(){return this._servicesURL[this._3DSearchServiceName]},getServiceUrl:function(e){var t=null;return-1!==Object.keys(this._servicesURL).indexOf(e)&&(t=this._servicesURL[e]),t},setSecurityContext:function(t){o.debug("setDefaultSecurityContext: "+e.Json.encode(t)),this._defaultSecurityContext=e.is(t)?t:""},getSecurityContext:function(){return this._defaultSecurityContext},setCSRFToken:function(t,i){e.is(i,"string")&&i.length>0&&e.is(t)&&(this._CSRFToken[i]=e.is(t.eno_csrf_token)?{eno_csrf_token:t.eno_csrf_token}:null)},getCSRFToken:function(t){var i="";return e.is(t,"string")&&this._CSRFToken[t]&&(i=this._CSRFToken[t].eno_csrf_token),i},getHeaders:function(t){var i=t||{},n=!!e.is(i.isJsonOnly)&&i.isJsonOnly,r=!!e.is(i.isAuthoringCtx)&&i.isAuthoringCtx,s=e.is(i.minorVersion)?i.minorVersion:"",o=e.is(i.serviceName)?i.serviceName:"3DSpace",a=this._getAuthoringContextHdr(),c={"Accept-Language":e.is(widget)&&e.is(widget.lang,"string")?widget.lang:"en",SecurityContext:this.getSecurityContext()};return n?(c.Accept="application/json",c["Content-Type"]="application/json"):(c.Accept="application/json,text/javascript,*/*",c["Content-Type"]="application/ds-json"),e.is(r)&&(c=e.extend(c,a)),e.is(s,"string")&&s.length>0&&(c["DS-API-Version"]=s),e.is(o,"string")&&o.length>0&&e.is(this._CSRFToken[o])&&(c=e.extend(c,this._CSRFToken[o])),c},_getAuthoringContextHdr:function(){var t=r.get();return e.is(t)&&e.is(t.AuthoringContextHeader)?t.AuthoringContextHeader:{}},getRetrieveServiceURLPromise:function(t){var i=this;return new Promise(function(n,r){var a=e.is(widget)?e.is(widget.getValue,"function")?widget.getValue("x3dPlatformId"):"noWidgetGetValue":"noWidget";e.is(a,"string")&&0<a.length||(a="OnPremise",o.warn("getRetrieveServiceURLPromise, platformId set by default !!!")),o.debug("getRetrieveServiceURLPromise: "+a),s.getServiceUrl({serviceName:t,platformId:a,onComplete:function(s){var o="";e.is(s,"array")&&0<s.length&&e.is(s[0].url,"string")?(i._servicesURL[t]=s[0].url+(t===i._3DSpaceServiceName||t===i._AppCloudServiceName?"/":""),i._platformId[t]=s[0].platformId,n("iServiceInfoArray Array (ServiceName, ServiceURL, ServicePlatformID): "+t+", "+i._servicesURL[t]+", "+i._platformId[t])):e.is(s,"string")?(i._servicesURL[t]=s+(t===i._3DSpaceServiceName||t===i._AppCloudServiceName?"/":""),i._platformId[t]=a,n("iServiceInfoArray String (ServiceName, ServiceURL, ServicePlatformID): "+t+", "+i._servicesURL[t]+", "+i._platformId[t])):e.is(i._servicesURL[t],"string")&&"NOT_DEFINED"!==i._servicesURL[t]?n("Warning (ServiceName, iServiceInfo, Default URL): "+t+", "+s+", "+i._servicesURL[t]):(o=e.is(s)?e.Json.encode(s):"No Object found",r("Error in getRetrieveServiceURLPromise (ServiceName, iServiceInfo): "+t+", "+o))},onFailure:function(e){r("i3DXCompassPlatformServices.getServiceUrl call failed: "+e)}})})},getAvailableRolesPromise:function(){return new Promise(function(e){var t=[];s.getGrantedRoles(function(i){i.forEach(function(e){t.push(e.id)}),n.setUserGrantedRoles(t),e("userGrantedRoles: "+t)})})}})}),define("DS/DELPPWWebServices/WebService",["UWA/Core","UWA/Date","DS/WAFData/WAFData","DS/DELPPWModelServices/ModelUtils","DS/DELPPWWebServices/CommonService","DS/DELPPWLoggerModel/LoggerUtils","DS/DELPPWModelServices/BehaviorUtil"],function(e,t,i,n,r,s,o){"use strict";return r.extend({name:"WebService",_webServicesCount:1,init:function(e){this._parent(e)},getServiceUrlPromises:function(){var e=[this.getRetrieveServiceURLPromise(this._3DSpaceServiceName)];return e.push(this.getRetrieveServiceURLPromise(this._3DSearchServiceName)),o.isCloud()&&e.push(this.getRetrieveServiceURLPromise(this._AppCloudServiceName)),e.push(this.getAvailableRolesPromise()),Promise.all(e)},webServiceRequest:function(r){var o,a,c,l,u,d,f,m,p,g,h,S=this;if(e.is(r))if(e.is(r.url,"string"))if(e.is(r.method,"string")){if(o=e.is(r.serviceName)?r.serviceName:"3DSpace",a=/^https?:\/\//i.test(r.url)?r.url:S.getServiceUrl(o)+"resources/"+r.url,c=!e.is(r.applyWidgetPreferenceUnit)||r.applyWidgetPreferenceUnit,a.contains("dsmfg/private")&&c){let t=function(){var t=[],i="";return["MASS","VOLUME","AREA","LENGTH","TIME"].forEach(function(i){var n=widget.getPreference(i);e.is(n)&&e.is(n.value)&&"hidden"!==n.type&&t.push(i+":"+n.value)}),t.forEach(function(e,t){i+=0===t?"DISPLAY_UNIT="+e:"+"+e}),i}();e.is(t)&&t.contains("DISPLAY_UNIT")&&(a+=a.contains("?")?"&"+t:"?"+t)}var v,C,y,D,_,b,R,P,L,T,x;l=e.is(r.type)?r.type:"json",u=e.is(r.data)?r.data:null,d=e.is(r.headers)?r.headers:S.getHeaders({serviceName:o}),f=!e.is(r.async)||r.async,m=e.is(r.context)?r.context:this,p=e.is(r.noProxy)?null:"passport",g=!e.is(r.authenticated)||r.authenticated,h=n.getTimeoutPreference(),document.body.style.cursor="wait",R=t.now(),P=S._webServicesCount+"-START- "+r.url+" request / Time: "+new t(R).toISOString(),L=S._webServicesCount+"-END- "+r.url+" request",T=S._webServicesCount+"-FAIL- "+r.url+" request",x=S._webServicesCount+"-TIME OUT- "+r.url+" request",C=function(i,n){document.body.style.cursor="default",_=t.now(),b=L+" / Duration: "+(_-R)+" ms",s.debug(b),e.is(r.onComplete)&&r.onComplete.call(m,i,n),e.is(r.logMessage)&&s.debug(r.logMessage)},y=function(t,i,n){document.body.style.cursor="default",s.warn(T),s.warn(t),s.warn(JSON.stringify(i)),e.is(r.onFailure)&&r.onFailure.call(m,t,i,n),e.is(r.logMessage)&&s.debug(r.logMessage+i)},D=function(t){document.body.style.cursor="default",s.warn(x),s.warn(t),e.is(r.onTimeout)&&r.onTimeout.call(m,t),e.is(r.logMessage)&&s.debug(r.logMessage)},s.debug(P),v={headers:d,method:r.method,type:l,onComplete:C,data:u,onFailure:y,onTimeout:D,async:f},r.noProxy||(v.proxy=p),e.is(h)&&(v.timeout=h),e.is(r.logMessage)&&s.debug(r.logMessage),g?(s.debug("Call to WAFData.authenticatedRequest(URL, options): ",a+", "+e.Json.encode(v)),i.authenticatedRequest(a,v)):(s.debug("Call to WAFData.proxifiedRequest(URL, options): ",a+", "+e.Json.encode(v)),i.proxifiedRequest(a,v)),S._webServicesCount++}else s.debug(this.name,"iOptions.method must be be defined in Webservice.webServiceRequest call.");else s.debug(this.name,"iOptions.url must be a string in Webservice.webServiceRequest call.");else s.debug(this.name,"iOptions must exist in Webservice.webServiceRequest call.")},fireGETWSInChunkIfTooBig:function(t){var i,n=this,r=0,o=null,a=[],c=[],l=null,u=null,d=null;if(e.is(t))if(e.is(t.url,"string")&&0!==t.url.length)if(e.is(t.data,"array")&&0!==t.data.length)if(i=JSON.stringify(t.data),u=e.is(t.chunk,"number")&&u>0?t.chunk:5,t.url.length+i.length>2048){for(r=0;r<t.data.length;r+=u)o=t.data.slice(r,r+u),l=new Promise(function(e,i){var r={url:t.url,method:"GET",data:{payload:JSON.stringify(o)},type:t.type,async:t.async,context:t.context,headers:t.headers,noProxy:t.noProxy,authenticated:t.authenticated,onComplete:e,onFailure:i,onTimeout:i};n.webServiceRequest(r)}),c.push(l);Promise.all(c).then(function(i){e.is(i,"array")?(a=i.flat(),e.is(t.onComplete,"function")&&t.onComplete(a)):e.is(t.onComplete,"function")&&t.onComplete()},function(i){e.is(t.onFailure,"function")&&t.onFailure(i)})}else d={url:t.url,method:"GET",data:{payload:i},type:t.type,async:t.async,context:t.context,headers:t.headers,noProxy:t.noProxy,authenticated:t.authenticated,onComplete:t.onComplete,onFailure:t.onFailure,onTimeout:t.onTimeout},n.webServiceRequest(d);else s.debug(n.name,"iOptions.data must be an array in Webservice.splitGETWebService call.");else s.debug(n.name,"iOptions.url must be a string in Webservice.splitGETWebService call.");else s.debug(n.name,"iOptions must exist in Webservice.splitGETWebService call.")}})}),define("DS/DELPPWWebServices/WebserviceUtils",["UWA/Core","UWA/Class","DS/DELPPWModelServices/ModelUtils","DS/DELPPWWebServices/WebService","DS/DELPPWModelServices/BehaviorUtil","DS/DELPPWLoggerModel/LoggerUtils","DS/DELPPWWebServices/XMLTranslater"],function(e,t,i,n,r,s,o){"use strict";return t.singleton({name:"WebServiceUtils",_xmlCache:null,_serverRawXMLCache:null,_xmlConfiguration:null,_custoParamSetPID:null,init:function(r){var o=this,a=!!e.is(r)&&(!!e.is(r.isFacet,"boolean")&&r.isFacet),c=e.is(r)&&e.is(r.resolve,"function")?r.resolve:null,l=e.is(r)&&Array.isArray(r.eligibleRoleIds)?r.eligibleRoleIds:[],u=function(){var t=a||l.some(function(e){return i.isLicenseAvailable(e)});e.is(c,"function")?c(t):s.debug(o.name,"WebserviceUtil.init(), NO outer resolve function, isLicOK: "+t)},d=e.is(r)&&e.is(r.reject,"function")?r.reject:null;i.isStandAlone()?require(["DS/DELPPWWebServicesTst/StandaloneService"],function(e){t.implement.call(o,new e),i.setUserGrantedRoles(["IFW","InternalDS"]),o._servicesURL[o._3DSpaceServiceName]="http://localhost/3DSpace",o._servicesURL[o._3DSearchServiceName]="http://localhost/federated",o._platformId[o._3DSpaceServiceName]="OnPremise",o._platformId[o._3DSearchServiceName]="OnPremise",u()}):(t.implement.call(o,new n({cloudServiceName:r.cloudServiceName})),o.getServiceUrlPromises().then(u,d))},getTenant:function(){return this.getPlatformID()},getWebServicesURL:function(){return this.get3DSpaceUrl()+"resources/dsmfg/private/V0/MfgElement"},setXMLConfiguration:function(e,t){this._xmlCache={},this._serverRawXMLCache={},this._xmlConfiguration=e,this._custoParamSetPID=t},getXMLConfiguration:function(){return this._xmlConfiguration||{}},fetchXMLValues:function(t,i,n){var a,c,l,u=this,d=e.is(this._custoParamSetPID,"string")&&this._custoParamSetPID.length>0,f=r.isCacheFullyOptimized(),m=d?f?"&custoParamSetPID="+this._custoParamSetPID:"&custoParamSetPID="+this._custoParamSetPID+"&v="+Date.now():"",p=function(n){if(s.debug(u.name,"WebserviceUtil._fetchXMLValues(), REQUEST: "+t),e.is(n)){if(e.is(u._xmlConfiguration)&&e.is(u._xmlConfiguration[t])&&n.fileContent){const e=u._xmlConfiguration[t].type,i=u._xmlConfiguration[t].rootNode;if(n.fileContent[i]&&!n.fileContent[i].version){const t=n.fileContent[i];switch(e){case"columnConfiguration":case"exportCSVPreference":case"relationsColumns":case"graphViewConfiguration":case"toolTipFormConfiguration":case"editFormConfiguration":case"bomViewConfiguration":o[e](t)}}}u._xmlCache[t]=n.fileContent,e.is(i)&&i(u._xmlCache[t]),s.debug(u.name,u._xmlCache[t])}else s.debug(u.name,"configurationXML response data is undefined for requested  XML Key : "+t)},g=function(i){s.debug(u.name,"!!! WebserviceUtil._fetchXMLValues(), ERROR: "+t),s.debug(i),e.is(n)&&n(i)},h=function(e){d&&r.isCloud()?u.webServiceRequest({url:"dsmfg/private/V0/ApplicationConfiguration?frameworkName="+a[0]+"&fileName="+a[1]+".xml",method:"GET",serviceName:u._AppCloudServiceName,onComplete:p,onFailure:g}):g(e)};e.is(this._xmlConfiguration[t])?(a=this._xmlConfiguration[t].path,c=d?"dsmfg/private/V0/invoke/configurationXML":"dsmfg/private/V0/ApplicationConfiguration",l=r.isCloud()&&!d?u._AppCloudServiceName:u._3DSpaceServiceName,a=a.split("/"),e.is(a,"array")&&2===a.length?u.webServiceRequest({url:c+"?frameworkName="+a[0]+"&fileName="+a[1]+".xml"+m,method:"GET",serviceName:l,onComplete:p,onFailure:h}):h("xmlPath is not correctly defined in configurationXML  : "+t)):g("xmlKey is not defined in configurationXML  : "+t)},fetchServerXMLsAsStrings:function(t,i){var n=this;n.webServiceRequest({url:"dsmfg/private/V0/invoke/getServerConfigurationRawXMLs?custoParamSetPID="+this._custoParamSetPID,method:"GET",serviceName:n._3DSpaceServiceName,onComplete:function(i){s.debug(n.name,"WebserviceUtil.fetchServerXMLsAsStrings()"),e.is(i)?(n._serverRawXMLCache=i,e.is(t)&&t(n._serverRawXMLCache)):s.debug(n.name,"serverConfigurationXML response data is undefined")},onFailure:function(t){s.debug(n.name,"!!! WebserviceUtil.fetchServerXMLsAsStrings(), ERROR:"),s.debug(t),e.is(i)&&i(t)}})},getXMLValues:function(t,i,n){var r=null,s={dataCache:[],convert:function(t,i){var n,r=t.split("."),s=this;if(!e.is(this.dataCache[i])){for(n=0;n<r.length;++n){if(!e.is(s[r[n]])){s=null;break}s=s[r[n]]}if(e.is(s))for("array"!==e.typeOf(s)&&(s=[s]),this.dataCache[i]={},n=0;n<s.length;++n)this.dataCache[i][s[n][i]]=s[n],delete this.dataCache[i][s[n][i]][i]}return this.dataCache[i]}};return e.is(this._xmlCache[t])?(r=e.merge(this._xmlCache[t],s),e.is(i,"function")&&i(e.clone(r))):e.is(n,"function")&&n("xmlKey is not defined in configurationXML  : "+t),e.is(r)?e.clone(r):null},getServerConfigurationRawXML:function(e){return this._serverRawXMLCache[e]}})});