/*!  Copyright 2014 Dassault Systemes. All rights reserved. */
define("DS/CAT3DWebStoreyComponents/CAT3DWebRequestServices",["UWA/Core","UWA/Controls/Abstract","UWA/Promise","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/WAFData/WAFData"],function(e,t,n,o,i){"use strict";var r=t.singleton({init:function(){r._cacheUrlMap=new Map,r._objectId=0,r._cacheSecurityContext=""},SetProductID:function(e){r._objectId=e},GetProductID:function(){return r._objectId},resetCacheUrl:function(){return r._cacheUrlMap.clear()},resetCacheUrl:function(e){r._cacheUrlMap.delete(e)},getCacheUrl:function(e){return r._cacheUrlMap.get(e)},refreshSecurityContext:function(e){r._cacheSecurityContext=e},get3DPassport:function(e){return new n(function(t,n){o.getServiceUrl({serviceName:"3DPassport",platformId:e.toUpperCase(),onComplete:function(e){e&&e[0]&&e[0].url&&(e=e[0].url);var n=e.replace(/^https?:\/\//,"");r.cacheUrl3DPassport=n,t(e)},onFailure:function(e){n(new Error("Internal Error - get3DPassport failed"))}})})},retrieveUrl:function(e,t){return new n(function(n,i){o.getServiceUrl({serviceName:t,onComplete:function(o){var i="";for(var a in o)if(""!=e&&null!=e&&o[a].platformId.toLowerCase()==e){i=o[a].url;break}if(""==i||!i){console.log("WARNING: "+t+" app has not been found on tenant "+e);for(a=0;a<o.length&&""==i;)i=o[a].url,a++}r._cacheUrlMap.set(t,i.substring(i.indexOf("https://")+8)),n(o)},onFailure:function(e){i(new Error("Internal Error - retrieveUrl failed"))}})})},logInServiceName:function(t,n){return new e.Promise(function(e,o){var a=r.cacheUrl3DPassport,s=a.split("/"),c="https://"+(s=0===s.length?a:s[0])+"/login?service=https://"+encodeURIComponent(r.getCacheUrl(t)+n);i.authenticatedRequest(c,{method:"GET",type:"json",onComplete:function(t){var n=t.x3ds_service_redirect_url;e(n)},onFailure:function(e,t,n){o(e)}})})},QueryServiceName:function(t,n){return new e.Promise(function(e,o){i.authenticatedRequest(t,{method:"POST",type:"json",timeout:12e5,data:JSON.stringify(n),headers:{"content-type":"application/json"},onComplete:function(t){e(t)}.bind(this),onFailure:function(e,t,n){o(e)}})})},getSecurityContext:function(){return r._cacheSecurityContext.replace("ctx::","")},initServiceManager:function(){return this.getTenantId().then(function(e){return r._cacheTenantId=e,r.get3DSpaceAndLoginTicket(e)}.bind(this)).then(function(e){r._cacheLoginTicket=e.loginTicket}.bind(this)).catch(function(e){console.error(e)})},get3DSpaceAndLoginTicket:function(e){return this.get3DSpace(e).then(function(t){r._cacheUrl3DSpace=t;let n=r.getSecurityContext();return this.getLoginTicket(t,n,e,!0)}.bind(this))},getUrl3DSpaceCache:function(){return r._cacheUrl3DSpace},getLoginTicketCache:function(){return r._cacheLoginTicket},getTenantIdCache:function(){return r._cacheTenantId},getLoginTicket:async function(e,t,o,a){var s;return!0===a&&(r._cacheLoginTicket=null),"string"==typeof r._cacheLoginTicket?s=r._cacheLoginTicket:this._getLoginTicketPromise?s=this._getLoginTicketPromise:widget.uwaUrl?(s=new n(function(n,a){var s={timeout:15e3,cache:-1,method:"GET",type:"json",headers:{Accept:"application/json","Accept-Language":null},onComplete:function(t){var o={loginTicket:t.ticket,url3DSpace:e};r._cacheLoginTicket=t.ticket,this._getLoginTicketPromise=null,n(o)}.bind(this),onFailure:function(){this._getLoginTicketPromise=null,a(new Error("GetLoginTicket failed"))}.bind(this)},c=e+"/ticket/get?";c+=t?"runasctx="+encodeURIComponent(t):"runasctx=preferred",o&&(c+="&tenant="+encodeURIComponent(o)),i.authenticatedRequest(c,s)}.bind(this)),this._getLoginTicketPromise=s):(r._cacheLoginTicket="",s=r._cacheLoginTicket),s},get3DSpace:async function(e){var t;return"string"==typeof r._cacheUrl3DSpace?t=r._cacheUrl3DSpace:this._get3DSpacePromise?t=this._get3DSpacePromise:widget.uwaUrl?(t=new n(function(t,n){o.getServiceUrl({serviceName:"3DSpace",platformId:e,onComplete:function(e){r._cacheUrl3DSpace=e,this._get3DSpacePromise=null,t(r._cacheUrl3DSpace)}.bind(this),onFailure:function(){this._get3DSpacePromise=null,n(new Error("get3DSpace failed"))}.bind(this)})}.bind(this)),this._get3DSpacePromise=t):(r._cacheUrl3DSpace="",t=r._cacheUrl3DSpace),t},getTenantId:async function(){var e;return r._cacheTenantId?e=r._cacheTenantId:this._getTenantIdPromise?e=this._getTenantIdPromise:widget.uwaUrl?(void 0===r._cacheTenantId&&(r._cacheTenantId=widget.getValue("x3dPlatformId")),r._cacheTenantId?e=r._cacheTenantId:(e=new n(function(e,t){o.getServiceUrl({serviceName:"3DDesign",onComplete:function(t){r._cacheTenantId=t[0].platformId,this._getTenantIdPromise=null,e(t)}.bind(this),onFailure:function(){this._getTenantIdPromise=null,t(new Error("getTenantId failed"))}.bind(this)})}.bind(this)),this._getTenantIdPromise=e)):(r._cacheTenantId="TST",e=r._cacheTenantId),e}});return e.namespace("DS/CAT3DWebStoreyComponents/CAT3DWebRequestServices",r)}),define("DS/CAT3DWebStoreyComponents/CAT3DWebStoreyNavigator",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS","DS/Controls/Slider","DS/Controls/Button","DS/WebappsUtils/WebappsUtils","DS/Utilities/Dom","DS/Controls/TooltipModel","i18n!DS/CAT3DWebStoreyComponents/assets/nls/CAT3DWebStoreyComponents","css!DS/CAT3DWebStoreyComponents/CAT3DWebStoreyComponents"],function(e,t,n,o,i,r,a,s,c){"use strict";return t.extend({init:function(t){var r=this,l=t||{};if(l.frameWindow&&l.viewer){r._parent(l),r.silentValue=!1;var u,d,f,h,m,S,p,g,C;r._reverseView=new n.Vector3(0,0,1),r._storeyContainer=t.storeyContainer,r._offsetBase=1e3,r._offset=r._offsetBase;var y={},v=!1,D=!0,T="";this.display=function(t){if(0!=r._storeyContainer.length){if(T=t.style||"","function"==typeof t.compactDisplay?t.compactDisplay:null,!u){u=e.createElement("div",{class:"CAT3DWebStoreyNavigator"}),l.frameWindow.getUIFrame().appendChild(u),r._storeySelector=new o({domId:"idStoreyNavigator",value:0,minValue:0,maxValue:r._storeyContainer.length-1,stepValue:1,displayStyle:"vertical",valuePopupFlag:!1}),r._storeySelector.customOffset=r._offset,r._storeySelector.addEventListener("change",function(e){var t=e.dsModel.value,o=r._storeyContainer.at(t);r.silentValue?r.silentValue=!1:function(e){if(void 0===e)return;let t=new n.Vector3(e.aPosition.x,e.aPosition.y,e.aPosition.z);t.z+=r._offsetBase;const o=new CustomEvent("custom:slider:StoreyChanged",{detail:{UUID:e.aUUID,OrientedDirection:r._reverseView,Position3D:t}});dispatchEvent(o)}(o),p.setHTML(o.aName),g.setHTML((o.aPosition.z/1e3).toFixed(2)+"m"),C.setHTML(r._offsetBase/1e3+"m")}),r._storeySelector.getTextFromValue=function(){return r._storeyContainer.at(this.value).aName},r._storeySelector.inject(u),d=e.createElement("div",{class:"CAT3DWebStoreyNavigatorMainDiv"}).inject(u),f=e.createElement("div",{class:"CAT3DWebStoreyNavigatorButtonContainer"}).inject(d),p=e.createElement("p",{class:"CAT3DWebStoreyNavigatorLabelPara"}).inject(d),h=e.createElement("div",{class:"CAT3DWebStoreyNavigatorSubInfoContainer"}).inject(d),S=e.createElement("div",{class:"CAT3DWebStoreyNavigatorSubInfoElevationContainer"}).inject(h),m=e.createElement("div",{class:"CAT3DWebStoreyNavigatorSubInfoOffsetContainer"}).inject(h);var b=a.generateIcon("mountains");b.tooltipInfos=new s({title:c.Slider.Icon.Elevation,shortHelp:c.Slider.Icon.ElevationShort,mouseRelativePosition:!0}),b.inject(S),g=e.createElement("p",{class:"CAT3DWebStoreyNavigatorLabelElevation"}).inject(S);var w=a.generateIcon("ruler-vertical");w.tooltipInfos=new s({title:c.Slider.Icon.Offset,shortHelp:c.Slider.Icon.OffsetShort,mouseRelativePosition:!0}),w.inject(m),C=e.createElement("p",{class:"CAT3DWebStoreyNavigatorLabelOffset"}).inject(m),g.setHTML((r._storeyContainer[0].aPosition.z/1e3).toFixed(2)+"m"),C.setHTML(r._offsetBase/1e3+"m"),p.setHTML(r._storeyContainer[0].aName),r._getDownstairButton=new i({domId:"idDownButton",displayStyle:"icon",showLabelFlag:!1,icon:{iconName:"expand-down",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"},emphasize:"secondary",tooltipInfos:new s({title:c.Slider.Button.Downstair,shortHelp:c.Slider.Button.DownstairShort,mouseRelativePosition:!0})}).inject(f),r._getDownstairButton.addEventListener("buttonclick",function(){r._storeySelector.value-=1}),r._getUpstairButton=new i({domId:"idUpButton",displayStyle:"icon",showLabelFlag:!1,icon:{iconName:"expand-up",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"},tooltipInfos:new s({title:c.Slider.Button.Upstair,shortHelp:c.Slider.Button.UpstairShort,mouseRelativePosition:!0}),emphasize:"secondary"}).inject(f),r._getUpstairButton.addEventListener("buttonclick",function(){r._storeySelector.value+=1}),r._reverseViewButton=new i({domId:"idReverseButton",displayStyle:"icon",showLabelFlag:!1,icon:{iconName:"swap-right",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"},emphasize:"secondary",tooltipInfos:new s({title:c.Slider.Button.Inverse,shortHelp:c.Slider.Button.InverseShort,mouseRelativePosition:!0})}).inject(f),r._reverseViewButton.addEventListener("buttonclick",function(){r._reverseView.z=-1*r._reverseView.z,r.DefineView(r._reverseView);const e=new CustomEvent("custom:slider:OrientationChanged",{detail:{OrientedDirection:r._reverseView}});dispatchEvent(e)}),y.onFreeZoneResize||(l.frameWindow.getImmersiveFrame().addEventListener("freeZoneResize",I),y.onFreeZoneResize=1)}I(),u.setStyles({display:D?"":"none",opacity:1}),v=!0,"webUXStyle"===T&&(p.setStyles({fontSize:"12px",marginTop:"0px"}),g.setStyles({fontSize:"12px",marginTop:"0px"}),C.setStyles({fontSize:"12px",marginTop:"0px"}))}},this.hide=function(){u&&v&&(v=!1,u.setStyles({opacity:0}),setTimeout(function(){!v&&u&&u.setStyles({display:"none"})},200))},this.EditMode=function(e){r._getDownstairButton.disabled=!e,r._getUpstairButton.disabled=!e,r._reverseViewButton.disabled=!e,r._storeySelector.disabled=!e},this.isDisplayed=function(){return v},this.setVisibleFlag=function(e){D=e,u&&u.setStyles({display:D&&v?"":"none"})},this.getVisibleFlag=function(){return D},this.DefineStoreys=function(e){r._storeyContainer=e},this.DefineCurrentStorey=function(e){let t=r._storeyContainer.findIndex(t=>t.aUUID==e);t>=0&&r._storeySelector.value!==t&&(r.silentValue=!0,r._storeySelector.value=t)},this.DefinePosition=function(e){let t=r._storeySelector.value,n=r._storeyContainer.at(t),o=r._offset;void 0!==n&&(o=e.z-n.aPosition.z),r._offset=o,C.setHTML((r._offset/1e3).toFixed(2)+"m")},this.DefineView=function(e){r._reverseView=e;let t=r._reverseView.z>0?"swap-right":"swap-left";r._reverseViewButton.icon={iconName:t,fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"}},this.GetOffset=function(){return r._offset},this.GetViewVector=function(){return r._reverseView},this.clean=function(){r.hide(),l&&l.frameWindow&&l.frameWindow.getUIFrame()&&u&&l.frameWindow.getUIFrame().removeChild(u),y.onFreeZoneResize&&l.frameWindow&&l.frameWindow.getImmersiveFrame().removeEventListener("freeZoneResize",I),u=p=g=C=f=h=m=S=null,y={}}}function I(){if(u&&l.frameWindow.getImmersiveFrame().getFreeZone().getSize().width){var e=0,t=l.frameWindow.getImmersiveFrame().getDockingElement(WUXDockAreaEnum.RightDockArea),n=t.getContainedWindows();if(n&&(1===n.length&&n[0].isAWindowGroup()&&n[0].getEmbeddedWindows().length||1===n.length&&!n[0].isAWindowGroup())){for(var o=n[0].getEmbeddedWindows?n[0].getEmbeddedWindows():n,i=!1,r=0;r<o.length;r++)o[r].visibleFlag&&(i=!0);if(i&&!t.collapseDockingZoneFlag){var a=t._collapserSize;e=t.dockingZoneSize+a}}else e=t._collapserSize,t.visibleDockingZoneFlag&&!t.collapseDockingZoneFlag&&(e+=t.dockingZoneSize);u.setStyles({right:e+"px"})}}}})}),define("DS/CAT3DWebStoreyComponents/CAT3DWebApiRequestServices",["UWA/Core","UWA/Controls/Abstract","UWA/Promise","DS/WAFData/WAFData","DS/CAT3DWebStoreyComponents/CAT3DWebRequestServices"],function(e,t,n,o,i){"use strict";var r=t.singleton({init:function(){},GET:function(e){return new n(function(t,n){var r={timeout:3e3,cache:-1,method:"GET",type:"json",headers:{Accept:"application/json","Accept-Language":null,SecurityContext:i.getSecurityContext()},onComplete:function(e){t(e)}.bind(this),onFailure:function(){n(new Error("get failed"))}.bind(this)};i.getTenantId().then(function(t){i.get3DSpace(t.toLowerCase()).then(function(t){var n=t+e;o.authenticatedRequest(n,r)})})}.bind(this))},POST:function(e,t){return new n(function(n,r){var a={timeout:300,cache:-1,method:"POST",type:"json",data:t,headers:{"content-type":"application/json",SecurityContext:i.getSecurityContext()},onComplete:function(e){n(e)}.bind(this),onFailure:function(){r(new Error("post failed"))}.bind(this)};i.getTenantId().then(function(t){i.get3DSpace(t.toLowerCase()).then(function(t){var n=t+e;o.authenticatedRequest(n,a)})})}.bind(this))},PUT:function(e,t,r){return new n(function(n,a){var s={timeout:300,cache:-1,method:"PUT",data:t,type:"json",headers:{"Content-Type":"application/json",SecurityContext:i.getSecurityContext()},onComplete:function(e){n(e)}.bind(this),onFailure:function(){a(new Error("PUT failed"))}.bind(this)};r&&(s.proxy=r),i.getTenantId().then(function(t){i.get3DSpace(t.toLowerCase()).then(function(t){var n=t+e;o.authenticatedRequest(n,s)})})}.bind(this))},PATCH:function(e,t){return new n(function(n,r){var a={timeout:300,cache:-1,method:"PATCH",type:"json",data:t,headers:{"Content-Type":"application/json",SecurityContext:i.getSecurityContext()},onComplete:function(e){n(e)}.bind(this),onFailure:function(){r(new Error("PATCH failed"))}.bind(this)};i.getTenantId().then(function(t){i.get3DSpace(t.toLowerCase()).then(function(t){var n=t+e;o.authenticatedRequest(n,a)})})}.bind(this))},DELETE:function(e){return new n(function(t,n){var r={timeout:300,cache:-1,method:"DELETE",type:"json",headers:{Accept:"application/json","Accept-Language":null,SecurityContext:i.getSecurityContext()},onComplete:function(e){t(e)}.bind(this),onFailure:function(){n(new Error("get failed failed"))}.bind(this)};i.getTenantId().then(function(t){i.get3DSpace(t.toLowerCase()).then(function(t){var n=t+e;o.authenticatedRequest(n,r)})})}.bind(this))}});return e.namespace("DS/CAT3DWebStoreyComponents/CAT3DWebApiRequestServices",r)}),define("DS/CAT3DWebStoreyComponents/CAT3DWebTreeNavigationServices",["UWA/Core","UWA/Controls/Abstract","DS/Visualization/ThreeJS_DS","DS/CAT3DWebStoreyComponents/CAT3DWebApiRequestServices"],function(e,t,n,o){"use strict";var i=t.singleton({init:function(){},searchProduct:function(e){return e&&(Ev6Uri+="?$searchStr="+e),o.GET("/resources/v1/modeler/dscstr/dscstr:CstrItem/search")},getCstrItem:function(e,t){var n="/resources/v1/modeler/dscstr/dscstr:CstrItem/"+e;return t&&(Ev6Uri+="?$mask="+t),o.GET(n)},getCstrProductInstances:function(e){var t="/resources/v1/modeler/dscstr/dscstr:CstrItem/"+e+"/dscstr:CstrInstance?$mask=dsmvcstr:CstrItemMask.Instance&$fields=dsmveno:attribute.instance.name";return o.GET(t)},bulkFetch:function([e],t){var n="/resources/v1/modeler/dscstr/dscstr:CstrItem/bulkfetch";t&&(n+="?$mask="+t);var i="[";for(const[t,n]in e.entries())i+=n,t!==e.length-1&&(i+=",");return i+="]",o.POST(n,i)},getIFCExtension:function(e,t){var n="/resources/v1/modeler/dscstr/dscstr:CstrItem/"+e+"/dsifc:"+t;return o.GET(n)},getInstances:function(e){var t="/resources/v1/modeler/dscstr/dscstr:CstrItem/"+e+"/dscstr:CstrInstance?$mask=dsmvcstr:CstrItemMask.Instance&$fields=dsmveno:attribute.instance.name";return o.GET(t).then(function(t){var n=[];return t.member.forEach(t=>{t.parentId=e,n.push(t)}),n}).catch(e=>{console.log(e)})},getInstancesOfType:function(e,t){var n="/resources/v1/modeler/dscstr/dscstr:CstrItem/"+t+"/dscstr:CstrInstance?$mask=dsmvcstr:CstrItemMask.Instance&$fields=dsmveno:attribute.instance.name";return o.GET(n).then(function(t){var n=[];return t.member.forEach(t=>{e===t.referenceType&&n.push(t)}),n}).catch(e=>{console.log(e)})},getInstancesRefsOfType:function(e,t){var n="/resources/v1/modeler/dscstr/dscstr:CstrItem/"+t+"/dscstr:CstrInstance?$mask=dsmvcstr:CstrItemMask.Instance&$fields=dsmveno:attribute.instance.name";return o.GET(n).then(function(t){var n=[];return t.member.forEach(t=>{e===t.referenceType&&n.push(t.reference)}),n}).catch(e=>{console.log(e)})},getAllOf:function(e,t){var n=[];return function e(t,o){return i.getInstances(o).then(function(o){var i=[];if(o)return o.forEach(o=>{o.referenceType===t?n.push(o):i.push(e(t,o.reference))}),Promise.all(i)}).catch(e=>{console.log(e)})}(e,t).then(function(){return n})},getFullDataAxisOf:function(e,t){let o=[],r=[];return function e(t,a,s){return i.getInstances(a).then(function(i){var a=[];if(i)return i.forEach(i=>{o.push({parentId:s,id:i.id,translation:new n.Vector3(parseFloat(i.matrix_10),parseFloat(i.matrix_11),parseFloat(i.matrix_12)),rotation:new n.Matrix3(parseFloat(i.matrix_1),parseFloat(i.matrix_4),parseFloat(i.matrix_7),parseFloat(i.matrix_2),parseFloat(i.matrix_5),parseFloat(i.matrix_8),parseFloat(i.matrix_3),parseFloat(i.matrix_6),parseFloat(i.matrix_9))}),i.referenceType===t?r.push(i):a.push(e(t,i.reference,i.id))}),Promise.all(a)}).catch(e=>{console.log(e)})}(e,t).then(function(){var e=[];return r.forEach(t=>{var i=o.findIndex(e=>e.id==t.id);if(-1!==i){var r=o[i],a=new n.Vector3(r.translation.x,r.translation.y,r.translation.z);!function e(t){let n=o.findIndex(e=>e.id===t);if(-1===n)return;let i=o[n];a.add(i.translation),e(i.parentId)}(r.parentId),t.vectorPos=a,e.push(t)}}),e})},prdIsA:function(e,t){return e.toUpperCase()===t.type.toUpperCase()},getPrdName:function(e){return e.name},getPrdRefID:function(e){return e.reference},getPrdAttributes:function(e,t){if(!(e.totalItems>1||e.member.length>1))return e.member[0][t]}});return e.namespace("DS/CAT3DWebStoreyComponents/CAT3DWebTreeNavigationServices",i)}),define("DS/CAT3DWebStoreyComponents/CAT3DWebStoreyNavigatorControler",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/CAT3DWebStoreyComponents/CAT3DWebStoreyNavigator","DS/CAT3DWebStoreyComponents/CAT3DWebRequestServices","DS/CAT3DWebStoreyComponents/CAT3DWebTreeNavigationServices","UWA/Core","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/SpinBox","DS/Controls/TooltipModel","i18n!DS/CAT3DWebStoreyComponents/assets/nls/CAT3DWebStoreyComponents","css!DS/CAT3DWebStoreyComponents/CAT3DWebStoreyComponents"],function(e,t,n,o,i,r,a,s,c,l,u){"use strict";return e.extend({init:function(e){var d,f=e||{};this.securityContext=e.securityContext,this.frameWindow=e.frameWindow,o.refreshSecurityContext(this.securityContext),this._RootStorey="",this.refStoreyArr=[],this.storeyContainer=[{aUUID:"111111",aName:"R0",aPosition:new t.Vector3(0,0,0)},{aUUID:"222222",aName:"R1",aPosition:new t.Vector3(0,0,2500)},{aUUID:"333333",aName:"R2",aPosition:new t.Vector3(0,0,3700)},{aUUID:"444444",aName:"R3",aPosition:new t.Vector3(0,0,6200)}],this._parent(f),this._LoadingPromise=void 0,this.currentStorey={aUUID:this.storeyContainer[0].aUUID,aPosition:this.storeyContainer[0].aPosition},this.CreateStoreyNavigator=function(e,o){this.DestroyStoreyNavigator(),e.storeyContainer=this.storeyContainer,d=new n(e),addEventListener("custom:slider:StoreyChanged",e=>this.StoreyChanged(e)),addEventListener("custom:slider:OrientationChanged",e=>this.OrientationChanged(e)),this.ShowStoreyNavigator(),this.currentStorey.aUUID=this.storeyContainer[0].aUUID,this.currentStorey.aDirection=d.GetViewVector();let i=new t.Vector3(this.storeyContainer[0].aPosition.x,this.storeyContainer[0].aPosition.y,this.storeyContainer[0].aPosition.z);i.z+=d.GetOffset(),this.currentStorey.aPosition=i},this.RefreshSC=function(e){this.securityContext=e,CAT3DWebRequestServices.refreshSecurityContext(e)},this.DestroyStoreyNavigator=function(){d&&d.clean()},this.ShowStoreyNavigator=function(){d&&d.display({style:"webUXStyle"})},this.HideStoreyNavigator=function(){d&&d.hide()},this.SetEditMode=function(e){d&&d.EditMode(e)},this.GetStoreys=function(e){let t=this;return t._LoadingPromise?t._LoadingPromise.then(function(){return t.storeyContainer}):Promise.resolve(t.storeyContainer)},this.SetRootForStoreys=function(e){0!=e.length&&(this._RootStorey=e[0],this.LoadStoreys())},this.GetCurrentStorey=function(){return this.currentStorey.aUUID},this.SetCurrentStorey=function(e){let t=this.storeyContainer.findIndex(t=>t.aUUID==e);-1!==t&&(this.currentStorey.aUUID=e,this.currentStorey.aPosition=this.storeyContainer[t].aPosition,d&&d.DefineCurrentStorey(e))},this.GetPosition3D=function(){return{orientedDirection:d?d.GetViewVector():new t.Vector3(0,0,1),position:this.currentStorey.aPosition}},this.SetPosition3D=function(e,t){this.currentStorey.aDirection=e,this.currentStorey.aPosition=t,d&&(d.DefinePosition(t),d.DefineView(e))},this.StoreyChanged=function(e){this.currentStorey.aUUID=e.detail.UUID,this.currentStorey.aPosition=e.detail.Position3D;const t=new CustomEvent("custom:StoreyChanged",{detail:e.detail});dispatchEvent(t)},this.OrientationChanged=function(e){const t=new CustomEvent("custom:OrientationChanged",{detail:e.detail});dispatchEvent(t)},this.LoadStoreys=function(){var e=this;e._LoadingPromise=o.initServiceManager().then(function(){return i.getFullDataAxisOf("BuildingStorey",e._RootStorey).then(function(n){e.storeyContainer.length=0;let o=[];return n.forEach(n=>{let r=i.getPrdRefID(n);o.push(i.getIFCExtension(r,"IfcBuildingStorey").then(function(o){"2"===i.getPrdAttributes(o,"compositionType")&&(n.vectorPos.z,e.storeyContainer.push({aUUID:r,aName:i.getPrdName(n),aPosition:new t.Vector3(1e3*n.vectorPos.z,1e3*n.vectorPos.z,1e3*n.vectorPos.z)}))}).catch(e=>{console.log(e)}))}),Promise.all(o).then(function(){if(0===e.storeyContainer.length)return e.UserDefaultStoreyCreation();e.storeyContainer.sort((e,t)=>e.aPosition.z-t.aPosition.z),e.RefreshNavigatorStorey()})}).catch(e=>{console.log(e)})})},this.UserDefaultStoreyCreation=function(){var e=this;if(e.frameWindow)return new Promise(function(n,o){var i=new r.createElement("div",{class:"CAT3DWebDefaultStoreyContainer"}),d=new r.createElement("div",{class:"CAT3DWebDefaultStoreyNumberContainer"}),f=new r.createElement("div",{class:"CAT3DWebDefaultStoreyElevationContainer"}),h=new r.createElement("div",{class:"CAT3DWebDefaultStoreyOffsetContainer"});r.createElement("p",{class:"CAT3DWebDefaultStoreyNumberLabel"}).inject(d).setHTML(u.Dialog.Spinbox.Numbers),r.createElement("p",{class:"CAT3DWebDefaultStoreyElevationLabel"}).inject(f).setHTML(u.Dialog.Spinbox.Elevation),r.createElement("p",{class:"CAT3DWebDefaultStoreyOffsetLabel"}).inject(h).setHTML(u.Dialog.Spinbox.Offset);var m=new c({domId:"idSpinStorey",value:3,minValue:1,maxValue:200,stepValue:1,pageStepValue:1,tooltipInfos:new l({title:u.Dialog.Spinbox.Numbers,shortHelp:u.Dialog.Spinbox.NumbersShort})});m.inject(d);var S=new c({domId:"idSpinStoreyElevation",value:2.5,units:"m",minValue:0,maxValue:100,stepValue:.1,pageStepValue:1,tooltipInfos:new l({title:u.Dialog.Spinbox.Elevation,shortHelp:u.Dialog.Spinbox.ElevationShort})});S.inject(f);var p=new c({domId:"idSpinStoreyOffset",value:0,units:"m",minValue:-1e4,maxValue:1e4,stepValue:.1,pageStepValue:1,tooltipInfos:new l({title:u.Dialog.Spinbox.Offset,shortHelp:u.Dialog.Spinbox.OffsetShort})});p.inject(h),d.inject(i),h.inject(i),f.inject(i);var g=new a({immersiveFrame:e.frameWindow.getImmersiveFrame(),height:"auto",buttons:{Ok:new s({onClick:function(o){let i=m.value,r=p.value,a=S.value;for(let n=0;n<i;++n)e.storeyContainer.push({aUUID:u.Dialog.Storey.DefaultName+n,aName:u.Dialog.Storey.DefaultName+n,aPosition:new t.Vector3(0,0,1e3*r+a*n*1e3)});e.RefreshNavigatorStorey(),n(),g.close()},tooltipInfos:new l({title:u.Dialog.Button.Ok,shortHelp:u.Dialog.Button.OkShort})}),Cancel:new s({onClick:function(e){o(),g.close()},tooltipInfos:new l({title:u.Dialog.Button.Cancel,shortHelp:u.Dialog.Button.CancelShort})})},content:i,title:u.Dialog.Title})})},this.RefreshNavigatorStorey=function(){let e=this.storeyContainer;if(d){d.clean(),d.DefineStoreys(e),this.ShowStoreyNavigator(),this.currentStorey.aUUID=e[0].aUUID,this.currentStorey.aDirection=d.GetViewVector();let n=new t.Vector3(e[0].aPosition.x,e[0].aPosition.y,e[0].aPosition.z);n.z+=d.GetOffset(),this.currentStorey.aPosition=n;const o=new CustomEvent("custom:StoreyChanged",{detail:{UUID:this.currentStorey.aUUID,OrientedDirection:d.GetViewVector(),Position3D:this.currentStorey.aPosition}});dispatchEvent(o)}const n=new CustomEvent("custom:LoadingComplete",{detail:{succeeded:this.storeyContainer.length>0,elements:this.storeyContainer.length}});dispatchEvent(n)}}})});