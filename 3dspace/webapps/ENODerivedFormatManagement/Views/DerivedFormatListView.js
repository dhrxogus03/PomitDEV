define("DS/ENODerivedFormatManagement/Views/DerivedFormatListView",["DS/Handlebars/Handlebars","UWA/Class/View","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/Popup","DS/UIKIT/Input/Button","DS/UIKIT/Popover","DS/UIKIT/Dropdown","DS/Utilities/Dom","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/TreeModel/DataModelSet","DS/TreeModel/BaseFilter","DS/DataGridView/DataGridView","DS/ENODerivedFormatManagement/Collections/DerivedFormatRules","DS/ENODerivedFormatManagement/Views/Tbar","DS/ENODerivedFormatManagement/Views/DerivedFormatCreate","DS/ENODerivedFormatManagement/Views/ParamListView","DS/UIKIT/Input/Button","DS/ENODerivedFormatManagement/Utils/DerivedFormatUtil","DS/ENO6WPlugins/jQuery","DS/ENODerivedFormatManagement/Views/DORuleDetailDialog","DS/ENO6WPlugins/jQueryUI","DS/ENODerivedFormatManagement/Collections/UserTreeDocument","css!DS/ENODerivedFormatManagement/ENODerivedFormatManagement"],function(e,t,a,n,o,i,r,l,d,s,c,u,g,m,f,p,v,D,b,S,h,w,M,y){var I,N,L;return t.extend({tagName:"div",className:"edfm-formatlistview",tapedTwice:!1,_userTreeDocument:null,setup:function(e){var t=this;derivedformatmanagementinfra.servererror||(t.setupTbar(),t.setupListView(),t.setupApplyResetToolbar(),widget.addEvent("onResize",t.adjust)),this.listenTo(t.collection,"onAdd",t.derivedFormatRuleCreatePostProcess.bind(null,t)),this.listenTo(t.collection,"onChange",t.derivedFormatRuleEditPostProcess.bind(null,t)),this.listenTo(t.collection,"onRemove",t.derivedFormatRuleDeletePostProcess.bind(null)),this.listenTo(t.collection,"onReadyDocument",function(){L.getFilterManager().setPropertyFilterModel("implicitRule",{filterId:"set",filterModel:[derivedformatmanagementinfra.getNLSData().label.no]})}),t._userTreeDocument=new y({key:"person"})},render:function(e){return e&&e.container&&this.container.inject(e.container),this},setupApplyResetToolbar:function(){var e,t,a,n,o,i=this;return e=UWA.createElement("div",{class:"dfm-list-applyResetDiv",styles:{bottom:"0",right:"0",position:"fixed"}}).inject(i.container),t=UWA.createElement("table",{class:"",id:"",width:"100%"}).inject(e),a=UWA.createElement("tr").inject(t),n=UWA.createElement("td",{width:"45%",Align:"left"}).inject(a),new b({className:"primary",id:"buttonExport",icon:"export",attributes:{disabled:!1,title:derivedformatmanagementinfra.getNLSData().button.applyTitle,text:derivedformatmanagementinfra.getNLSData().button.apply},events:{onClick:function(){i.applyParams(i)}}}).inject(n).getContent().setStyle("width",130),o=UWA.createElement("td",{width:"45%",Align:"right"}).inject(a),new b({className:"warning",icon:"loop",attributes:{disabled:!1,title:derivedformatmanagementinfra.getNLSData().button.resetTitle,text:derivedformatmanagementinfra.getNLSData().button.reset},events:{onClick:function(){i.resetButton(i)}}}).inject(o).getContent().setStyle("width",130),e},applyParams:function(e){e.collection.length&&e.collection.applyRules()},resetButton:function(e){var t=L.getChildren(),a=new Array;if(t){for(idx=0;idx<t.length;idx++)node=t[idx].options.grid,a.push(node);e.collection.remove(a)}e.collection.fetch(),e.applyFilterModel()},setupTbar:function(){var e=this;new p({actions:[{icon:"plus",label:derivedformatmanagementinfra.getNLSData().button.addRule,hasAccess:!0,handler:e.createDerivedFormatRule.bind(null,e)},{icon:"trash",label:derivedformatmanagementinfra.getNLSData().button.deleteRule,hasAccess:!0,handler:e.deleteDerivedFormatRule.bind(null,e)}]}).render({container:e.container})},createDerivedFormatRule:function(e){new v({collection:e.collection,event:e.event}).render({container:void 0})},deleteDerivedFormatRule:function(e){var t=L.getSelectedNodes(),a=new Array,n=new Array,o=!1;if(t)for(var i=t.length,r=0;r<i;r++){var l=t[r],d=e.collection.get(l.options.grid);"deleted"!=d.get("action")&&(d.id?(o=!0,n.push(d)):a.push(d))}o?S.confimationModal(function(t){e.collection.setToBeDeleted(n),e.collection.remove(a),t.hide()},"delete"):e.collection.remove(a)},setupListView:function(){var e=this;N=new u,L=new s({dataModelSet:N}),_formatListViewDiv=UWA.createElement("div",{class:"dfm-list-view",styles:{}}).inject(e.container),I=new m({scrollable:!0,treeDocument:L,cellSelection:"none",height:widget.body.clientHeight-130,rowSelection:"multiple",columns:[{text:derivedformatmanagementinfra.getNLSData().label.converter,dataIndex:"converter",width:"10%"},{text:derivedformatmanagementinfra.getNLSData().label.connector,dataIndex:"connector",width:"10%"},{text:derivedformatmanagementinfra.getNLSData().label.type,dataIndex:"source",width:"10%"},{text:derivedformatmanagementinfra.getNLSData().label.format,dataIndex:"target",width:"10%",visibleFlag:!1},{text:derivedformatmanagementinfra.getNLSData().label.alias,dataIndex:"alias",width:"10%",typeRepresentation:"url",getCellValue:function(e){if(e.nodeModel&&e.nodeModel.getAttributeValue("inputstreamid")){var t=e.nodeModel.getAttributeValue("inputstreamid").toLowerCase(),a=e.nodeModel.getAttributeValue("alias");return"authoring"!==t?{label:a,icon:"attention"}:{label:a}}}},{text:derivedformatmanagementinfra.getNLSData().label.details,dataIndex:"parameters",width:"6%",sortableFlag:!1,resizableFlag:!0,editableFlag:!1,getCellTypeRepresentation:function(e){return e.nodeModel?"seeParameters":"string"},getCellSemantics:function(e){if(e.nodeModel)return{disabled:!1,allowUnsafeHTMLLabel:!1}}},{text:derivedformatmanagementinfra.getNLSData().label.event,width:240,dataIndex:"eventDisplay"},{text:derivedformatmanagementinfra.getNLSData().label.activation,dataIndex:"activation",visibleFlag:!1},{text:derivedformatmanagementinfra.getNLSData().label.implicitRule,width:170,dataIndex:"implicitRule"},{text:derivedformatmanagementinfra.getNLSData().label.conversionMgt,dataIndex:"conversionUser",typeRepresentation:"url",getCellValue:function(e){if(e.nodeModel&&e.nodeModel.getAttributeValue("target")){var t=e.nodeModel.getAttributeValue("target").toLowerCase(),a=e.nodeModel.getAttributeValue("converter"),n=e.nodeModel.getAttributeValue("conversionUser");return"OnPremise"!==widget.getValue("x3dPlatformId")&&n&&"step"==t||"catpart"==t||"OfficeDocumentConverter"==a?{label:n,icon:"tokens"}:"step"==t||"catpart"==t||"OfficeDocumentConverter"==a?{icon:"tokens"}:{label:n}}},getCellClassName:function(e){if(e.nodeModel&&e.nodeModel.getAttributeValue("userStatus")&&1!=e.nodeModel.getAttributeValue("userStatus"))return"conversionUserStyleClass"}},{text:derivedformatmanagementinfra.getNLSData().label.forceUpdate,dataIndex:"forceUpdate",typeRepresentation:"icon",width:"9%"},{text:derivedformatmanagementinfra.getNLSData().label.deployStatus,dataIndex:"status",width:"9%",typeRepresentation:"icon"}],defaultColumnDef:{width:"auto",typeRepresentation:"string",editableFlag:!1,resizableFlag:!0,sortableFlag:!0},getCellTooltip:function(t){if(11===t.columnID&&t.nodeModel&&t.nodeModel.options.grid){var a="",n=e.collection.get(t.nodeModel.options.grid);return{shortHelp:a=derivedformatmanagementinfra.getNLSData().button[n.get("action")],mouseRelativePosition:!0}}if(10===t.columnID&&t.nodeModel&&t.nodeModel.options.grid){a="";var o=(n=e.collection.get(t.nodeModel.options.grid)).get("forceUpdate");if(a=derivedformatmanagementinfra.getNLSData().label.forceUpdateExplain,o)return{shortHelp:a,mouseRelativePosition:!0}}else if(9===t.columnID&&t.nodeModel&&t.nodeModel.options.grid){var i=(n=e.collection.get(t.nodeModel.options.grid)).get("exchangeFormat"),r=t.nodeModel.getAttributeValue("userStatus");if(1!=r&&""!=r)if(a=derivedformatmanagementinfra.getNLSData().label.conversionUserStatus)return{shortHelp:a,mouseRelativePosition:!0};if(2==i)if(a=derivedformatmanagementinfra.getNLSData().label.creditConsumptionMsg)return{shortHelp:a,mouseRelativePosition:!0}}else if(4===t.columnID&&t.nodeModel&&t.nodeModel.options.grid&&t.nodeModel.getAttributeValue("inputstreamid")){var l=t.nodeModel.getAttributeValue("inputstreamid").toLowerCase(),d=t.nodeModel.getAttributeValue("datatype").toLowerCase(),s=(t.nodeModel.getAttributeValue("converter"),t.nodeModel.getAttributeValue("sourceformat").toLowerCase());t.nodeModel.getAttributeValue("target").toLowerCase();if("authoring"!==l){if(d||("slddrw"===s||"catdrawing"===s||"dwg"===s?d="drawing":"sldprt"!==s&&"catpart"!==s&&"catpart"!==s&&"itp"!==s&&"prt"!==s||(d="part")),a=derivedformatmanagementinfra.getNLSData().label[l+d])return{shortHelp:a=a.replace("%1",t.nodeModel.getAttributeValue("target")),mouseRelativePosition:!0}}else I.getCellDefaultTooltip(t)}else if(5===t.columnID){if(a=derivedformatmanagementinfra.getNLSData().label.details)return{shortHelp:a,mouseRelativePosition:!0}}else if(12===t.cellID){if(a=derivedformatmanagementinfra.getNLSData().label.implicitRuleExplain)return{longHelp:a,mouseRelativePosition:!1,position:"bottom"}}else if(13===t.cellID){if(a=derivedformatmanagementinfra.getNLSData().label.conversionUserTooltip)return{longHelp:a,mouseRelativePosition:!1,position:"bottom"}}else if(14===t.cellID){if(a=derivedformatmanagementinfra.getNLSData().label.forceUpdateExplain)return{longHelp:a,mouseRelativePosition:!1,position:"bottom"}}else I.getCellDefaultTooltip(t)}}).inject(_formatListViewDiv),"OnPremise"==widget.getValue("x3dPlatformId")&&(I.columns[9].visibleFlag=!1);var t={seeParameters:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"eye",fontIconFamily:WUXManagedFontIcons.Font3DS}}}};I.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(t)),I.getContent().addClassName("do-datagridview"),I.onReady(function(){I.addEventListener("click",e._cellClicked.bind(e))}),d.addEventOnElement(I,I,"click",function(t,a){if(!e.tapedTwice)return e.tapedTwice=!0,setTimeout(function(){e.tapedTwice=!1},600),!1;var n=a.nodeModel.options.grid,o=e.collection.get(n);"deleted"!=o.get("action")&&new v({event:e.event,collection:e.collection,container:void 0,selection:o}).render()}),e.customizeLayout(),e.applyFilterModel()},_cellClicked:function(e,t){if(I&&t&&"parameters"===I.layout.getDataIndexFromColumnIndex(t.columnID)){if("fonticon fonticon-1x fonticon-wrong dfm-action-icon-red"===t.nodeModel.options.grid.forceUpdate)var a="fonticon fonticon-1x fonticon-wrong dfm-action-icon-red";else a="fonticon fonticon-1x fonticon-check dfm-action-icon-green";this._displayedParameters=new w({origin:t.nodeModel.options.grid.connector,format:t.nodeModel.options.grid.target,outputStreamId:t.nodeModel.options.grid.alias,forceUpdate:a,converter:t.nodeModel.options.grid.converter,parameters:t.nodeModel.options.grid.parameters},widget.body)}},applyFilterModel:function(){var e=I.treeDocument.getFilterManager();["converter","connector","source","target","alias","eventDisplay","implicitRule"].forEach(t=>{e.setPropertyFilterModel(t,{filterId:"set"})})},customizeLayout:function(){I.layout.columnHeaderHeight=40,I.layout.cellHeight=35,I.layout.collectionView.showRowBorderFlag=!0},getDeployStatusIcon:function(e){var t,a=this,n=e.get("action");switch(n){case"deployed":t=a.buildImgSpan("check","green",n);break;case"notdeployed":t=a.buildImgSpan("cog","orange",n);break;case"created":t=a.buildImgSpan("cog","black",n);break;case"updated":t=a.buildImgSpan("pencil","orange",n);break;case"deleted":t=a.buildImgSpan("trash","red",n)}return t},getForceUpdateIcon:function(e){return 1==e.get("forceUpdate")?"fonticon fonticon-1x fonticon-check dfm-action-icon-green":"fonticon fonticon-1x fonticon-wrong dfm-action-icon-red"},buildImgSpan:function(e,t,a){return"fonticon fonticon-1x fonticon-"+e+" dfm-action-icon-"+t},derivedFormatRuleCreatePostProcess:function(e,t){var a=e,n=t.get("converter"),o=t.get("target");derivedformatmanagementinfra.getNLSData()[n]&&derivedformatmanagementinfra.getNLSData()[n].target[o]&&(o=derivedformatmanagementinfra.getNLSData()[n].target[o]),L.prepareUpdate();var i=t.get("eventToDisplay"),r=t.get("stateToDisplay");i=r?i+" → "+r:i;var l=e.getDeployStatusIcon(t),d=t.get("sourceToDisplay"),s=e.getForceUpdateIcon(t),u=t.get("outputStreamId"),g=t.get("event"),m=derivedformatmanagementinfra.getNLSData().label.no;"linkable"!==u&&"authoringvisu"!==u||"onXCADSave"!==g||"3DEXPERIENCE"!==n||(m=derivedformatmanagementinfra.getNLSData().label.yes);var f=t.get("convUserLabel"),p={id:t.id,cid:t.cid,converter:n,source:d,target:o,inputstreamid:t.get("inputStreamId"),datatype:t.get("sourceType"),parameters:t.get("parameters"),alias:u,event:g,eventDisplay:i,connector:t.get("category"),status:l,forceUpdate:s,activation:derivedformatmanagementinfra.getNLSData().label[t.get("activation")],implicitRule:m,conversionUser:f,sourceformat:t.get("source"),userStatus:""},v=c.createTreeNodeDataModel(N,{label:p.text,grid:p});L.addChild(v),L.pushUpdate(),t.get("convUser")&&(f=t.get("convUserLabel")?t.get("convUserLabel"):a.convertUUID(t.get("convUser"),t))},convertUUID:function(e,t){var a='[ds6w:resourceUid]:("'+e+'")';this._userTreeDocument.x3dsearch(a,e).then(e=>{null!=e&&t.set({convUserLabel:e.label,userStatus:e.status})})},derivedFormatRuleEditPostProcess:function(e,t){L.prepareUpdate();for(var a=L.getChildren(),n=a.length,o=0;o<n;o++){var i=a[o];if(i.options.grid.cid==t.cid){var r=e.getDeployStatusIcon(t),l=e.getForceUpdateIcon(t);i.updateOptions({grid:{parameters:t.get("parameters"),status:r,alias:t.get("outputStreamId"),forceUpdate:l,conversionUser:t.get("convUserLabel"),userStatus:t.get("userStatus")}});break}}L.pushUpdate()},derivedFormatRuleDeletePostProcess:function(e){L.prepareUpdate();for(var t=L.getChildren(),a=t.length,n=0;n<a;n++){var o=t[n],i=o.options.grid.id,r=o.options.grid.cid;if(i&&i==e.id){o.remove();break}if(r&&r==e.cid){o.remove();break}}L.pushUpdate()},adjust:function(){I.height=document.getElementsByClassName("facetviews")[1].clientHeight-90}})});