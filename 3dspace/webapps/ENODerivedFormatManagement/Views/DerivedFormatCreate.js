define("DS/ENODerivedFormatManagement/Views/DerivedFormatCreate",["UWA/Class/View","DS/Handlebars/Handlebars","DS/UIKIT/Input/Select","DS/UIKIT/Form","DS/UIKIT/SuperModal","DS/ENODerivedFormatManagement/Models/DerivedFormatRule","DS/ENODerivedFormatManagement/Views/ParamListView","text!DS/ENODerivedFormatManagement/assets/templates/edfm.formatparams.html","text!DS/ENODerivedFormatManagement/assets/templates/edfm.form.html","DS/ENODerivedFormatManagement/Utils/DerivedFormatUtil","DS/ENO6WPlugins/jQuery","DS/ENO6WPlugins/jQueryUI","DS/Controls/TooltipModel","DS/Controls/Toggle","DS/WUXAutoComplete/AutoComplete","DS/ENODerivedFormatManagement/Collections/UserTreeDocument"],function(e,t,n,a,r,o,i,d,l,s,c,m,u,f,v,g){var p,y,D,E,h,I;return e.extend({className:"derivedformatformview",viewMe:this,disableFields:!1,_myTreeDocument:null,id:function(){return"derivedformatformview"},setup:function(e){var t=this;t.selection=e.selection,t.superModal=new r,t._myTreeDocument=new g({key:"person"}),t.superModal.dialog({closable:!0,body:t.getForm(),title:t.selection?derivedformatmanagementinfra.getNLSData().label.editRuleTitle:derivedformatmanagementinfra.getNLSData().label.createRuleTitle}),t.addforceUpdateCheckbox(),t.setupEvent()},addforceUpdateCheckbox:function(){var e=p.getDocument().getElementById("derivedformatfield-forceupdate-container");(I=new f({type:"checkbox",label:derivedformatmanagementinfra.getNLSData().label.forceUpdate,id:"derivedformatfield-forceupdate",touchMode:!0})).inject(e)},setupEvent:function(){var e=this;viewMe=this,p.getDocument().getElementById("derivedformatfield-converter").addEventListener("change",e.resetConverterForms.bind(null,e)),p.getDocument().getElementById("derivedformatfield-connector").addEventListener("change",e.resetFormFields.bind(null,e)),p.getDocument().getElementById("derivedformatfield-event").addEventListener("change",e.switchEventField.bind(null,e)),p.getDocument().getElementById("derivedformatfield-source").addEventListener("change",e.switchSourceFormat.bind(null,e)),p.getDocument().getElementById("derivedformatfield-target").addEventListener("change",e.switchTargetFormat.bind(null,e)),p.getDocument().getElementById("btnActionSubmit").addEventListener("click",e.save.bind(null,e)),p.getDocument().getElementById("btnActionCancel").addEventListener("click",e.cancel.bind(null,e)),e.switchEventField(),e.switchTargetFormat(e)},populateData:function(e,t){for(var n in e.innerText=null,t){var a=new Option(t[n].label,t[n].value);t[n].selected&&(a.selected=!0),e.add(a)}},populateSourceData:function(e,t){for(var n in e.innerText=null,t){var a=new Option(t[n].label,t[n].value);t[n].selected&&(a.selected=!0),t[n].partExtension&&(a.dataset.partextension=t[n].partExtension),t[n].subType&&(a.dataset.subtype=t[n].subType),a.dataset.type=t[n].type,e.add(a)}},populateEventData:function(e,t){for(var n in e.innerText=null,t){var a=new Option(t[n].label,t[n].value);a.lifecycle=t[n].lifecycle,e.add(a)}},refresh:function(){},getForm:function(){(D=this).selection&&D.selection.get("convUserLabel")&&D._myTreeDocument.addUser(D.selection.get("convUserLabel"),D.selection.get("convUser")),y=new i({selection:D.selection,parameters:D.selection?D.selection.get("parameters"):{}});var e,n,a,r,o,s,c,m,u,f,v,g;t.compile(d);p=UWA.createElement("div",{id:"divCreateDerivedFormatFormContainer"}),D.selection&&(D.disableFields=!0,e=D.selection.get("converter"),n=D.selection.get("category"),a=D.selection.get("source"),r=D.selection.get("target"),o=D.selection.get("event"),s=D.selection.get("inputStreamId"),c=D.selection.get("outputStreamId"),m=D.selection.get("partExtension"),u=D.selection.get("subType"),f=D.selection.get("sourceType"),v=D.selection.get("forceUpdate"),g=D.selection.get("convUserLabel"));var D,E=t.compile(l),h=(D=this).getConverters();e||(e=h.find(e=>e.selected).value);var I=D.getConnectors(e);n||(n=I.find(e=>e.selected).value);var b=D.getSourceFormats(e,n);a||(a=b.find(e=>e.selected).value,f=b.find(e=>e.selected).type,m=b.find(e=>e.selected).partExtension,u=b.find(e=>e.selected).subType);var S=D.getEvents(e,n);o||(o=S.find(e=>e.selected).value);var w=D.getTargetFormats(e,n,a,f);if(r||(r=w.find(e=>e.selected).value),!s||!c){var B=D.getStreamIds(e,n,a,f,r);s=B.inputStreamId,c=B.outputStreamId}return p.setHTML(E({labels:derivedformatmanagementinfra.getNLSData().label,buttons:derivedformatmanagementinfra.getNLSData().button,converters:h,connectors:I,events:D.getEvents(e,n),activation:D.getActivation(e,n,o),states:D.getStates(e,n,a),sources:b,sourceFormat:a,targets:w,disableFields:D.disableFields,inputStreamId:D.inputStreamId,outputStreamId:D.outputStreamId,partExtension:m,subType:u,sourceType:f,forceUpdate:v,conversionUser:g})),p.getElementsByClassName("derivedformatfield-formatparams")[0].append(y.getContent()),p},switchEventField:function(e){var t=p.getDocument().getElementById("derivedformatfield-event"),n=p.getDocument().getElementById("derivedformatfield-activation"),a=p.getDocument().getElementById("derivedformatfield-outputStreamId").value,r=t.selectedOptions[0].value;if((r||a)&&("checkin"==r||"onXCADSave"==r||"linkable"==a||"authoringvisu"==a?(I.checkFlag=!1,I.disabled=!0):I.disabled=!1),this.selection&&1==this.selection.get("forceUpdate")&&(I.checkFlag=!0),t&&t.selectedOptions[0]){var o=t.selectedOptions[0];"yes"==o.lifecycle||"yes"==o.getAttribute("lifecycle")?p.getDocument().getElementById("derivedformatfield-state-container").style.display="block":p.getDocument().getElementById("derivedformatfield-state-container").style.display="none";var i=viewMe.getActivation("","",o.value);viewMe.populateData(n,i),viewMe.fieldActivationTest(i,n)}},cancel:function(e){e.superModal.modals.current.hide()},switchSourceFormat:function(){var e=p.getDocument().getElementById("derivedformatfield-converter").selectedOptions[0].value,t=p.getDocument().getElementById("derivedformatfield-connector").selectedOptions[0].value,n=p.getDocument().getElementById("derivedformatfield-source").selectedOptions[0].value,a=p.getDocument().getElementById("derivedformatfield-source").selectedOptions[0].dataset.type;p.getDocument().getElementById("derivedformatfield-sourceFormat").value=n;var r=p.getDocument().getElementById("derivedformatfield-target"),o=viewMe.getTargetFormats(e,t,n,a);viewMe.populateData(r,o),viewMe.fieldActivationTest(o,r);var i=p.getDocument().getElementById("derivedformatfield-state"),d=viewMe.getStates(e,t,n);viewMe.populateData(i,d),viewMe.switchTargetFormat(this)},resetConverterForms:function(){var e=p.getDocument().getElementById("derivedformatfield-converter").selectedOptions[0].value,t=p.getDocument().getElementById("derivedformatfield-connector"),n=viewMe.getConnectors(e);viewMe.populateData(t,n),viewMe.fieldActivationTest(n,t),viewMe.resetFormFields()},fieldActivationTest:function(e,t){1==e.length?t.disabled=!0:0==viewMe.disableFields&&(t.disabled=!1)},resetFormFields:function(){var e=p.getDocument().getElementById("derivedformatfield-converter").selectedOptions[0].value,t=p.getDocument().getElementById("derivedformatfield-connector").selectedOptions[0].value,n=p.getDocument().getElementById("derivedformatfield-event"),a=p.getDocument().getElementById("derivedformatfield-state"),r=p.getDocument().getElementById("derivedformatfield-source"),o=(p.getDocument().getElementById("derivedformatfield-target"),viewMe.getEvents(e,t));viewMe.populateEventData(n,o);var i=viewMe.getStates(e,t);viewMe.populateData(a,i);var d=viewMe.getSourceFormats(e,t);viewMe.populateSourceData(r,d),viewMe.fieldActivationTest(o,n),viewMe.fieldActivationTest(i,a),viewMe.fieldActivationTest(d,r),viewMe.switchSourceFormat(),viewMe.switchEventField()},switchTargetFormat:function(e){var t,n,a,r,o,d=p.getDocument().getElementById("derivedformatfield-conversionuser-container"),l=p.getDocument().getElementById("dfm-derivedformatform-autoCompleteContainer");l.childNodes.length>=1&&l.removeChild(l.children[0]),D&&D.destroy(),E&&E.destroy(),h&&h.destroy();var s=p.getDocument().getElementById("derivedformatfield-converter"),c=p.getDocument().getElementById("derivedformatfield-connector"),m=p.getDocument().getElementById("derivedformatfield-source"),f=p.getDocument().getElementById("derivedformatfield-target");if(s&&(n=s.selectedOptions[0].value),c&&(a=c.selectedOptions[0].value),m&&(r=m.selectedOptions[0].value,o=m.selectedOptions[0].dataset.type),f&&(t=f.selectedOptions[0].value),"OnPremise"===widget.getValue("x3dPlatformId")||"3DEXPERIENCE"!==n||"step"!==t&&"STEP"!==t&&"CATPart"!==t)d.style.display="none";else{d.style.display="block",e._myTreeDocument&&!e.selection&&e._myTreeDocument.empty(),e.dynamicAutoComplete=new v({elementsTree:e._myTreeDocument,multiSearchMode:!1,allowFreeInputFlag:!1,value:e.selection?e.selection.get("convUser"):"",placeholder:derivedformatmanagementinfra.getNLSData().label.conversionUserPlaceholder,minLengthBeforeSearch:2}),e.dynamicAutoComplete.inject(l),e.dynamicAutoComplete.addEventListener("uncommittedChange",e.unCommittedChange.bind(null,e)),e.dynamicAutoComplete.addEventListener("change",e.change.bind(null,e));var g=p.getDocument().getElementById("conversionuser-tooltip-container");(h=UWA.createElement("span",{html:'<span class="fonticon fonticon-1x fonticon-info" style="font-size: 13px; height: 13px"></span>'}).inject(g)).tooltipInfos=new u({shortHelp:derivedformatmanagementinfra.getNLSData().label.conversionUserTooltip})}var b=viewMe.getStreamIds(n,a,r,o,t),S=p.getDocument().getElementById("derivedformatfield-inputStreamId"),w=p.getDocument().getElementById("derivedformatfield-outputStreamId");S&&(S.value=b.inputStreamId),w&&(w.value=b.outputStreamId),y=new i({selection:e.selection,parameters:e.selection?e.selection.get("parameters"):{},derivedForm:p});var B=p.getDocument().getElementById("derivedformatfield-event"),C=p.getDocument().getElementById("derivedformatfield-outputStreamId").value,T=B.selectedOptions[0].value;if((T||C)&&("checkin"==T||"onXCADSave"==T||"linkable"==C||"authoringvisu"==C?(I.checkFlag=!1,I.disabled=!0):I.disabled=!1),"authoring"!==S.value){var A=p.getDocument().getElementById("derivedformatfield-warning-icon");D=UWA.createElement("span",{html:'<span class="fonticon fonticon-1x fonticon-attention" style="font-size: 19px; height: 32px"></span>'}).inject(A);var M=S.value.toLowerCase(),F=o.toLowerCase();(L=derivedformatmanagementinfra.getNLSData().label[M+F])&&(L=L.replace("%1",t)),D.tooltipInfos=new u({shortHelp:L})}if("OnPremise"!==widget.getValue("x3dPlatformId")&&("OfficeDocumentConverter"==s.value||"3DEXPERIENCE"===a&&"step"===("CATPart"===t||t.toLowerCase()))){A=p.getDocument().getElementById("derivedformatfield-warning-icon");D=UWA.createElement("span",{html:'<span class="fonticon fonticon-1x fonticon-tokens" style="font-size: 19px; height: 32px"></span>'}).inject(A);var L=derivedformatmanagementinfra.getNLSData().label.creditConsumptionMsg;D.tooltipInfos=new u({shortHelp:L})}if(s&&c&&m&&f&&!f.disabled&&"3DEXPERIENCE"==s.value&&"SOLIDWORKS"==c.value&&"SLDPRT"==m.value&&"ExactGeometry"==f.value){p.getDocument().getElementById("edfm-derivedformatparamview-param-warning-row").style.display="";var x=p.getDocument().getElementById("edfm-derivedformatparamview-param-warning");UWA.createElement("span",{class:"edfm-derivedformatparamview-param-warning-msg",html:derivedformatmanagementinfra.getNLSData().label.polyhedralFalseWarning,styles:{}}).inject(x)}var U=p.getDocument().getElementById("derivedformatfield-forceupdate-tooltip");(E=UWA.createElement("span",{html:'<span class="fonticon fonticon-1x fonticon-info" style="font-size: 13px; height: 13px"></span>'}).inject(U)).tooltipInfos=new u({shortHelp:derivedformatmanagementinfra.getNLSData().label.forceUpdateExplain})},unCommittedChange:function(e,t){if(null!=t.target)var n=t.target.dsModel.getValueToCommit();else n=t;n.length>1&&e._myTreeDocument.x3dsearch(n)},change:function(e){if(e.dynamicAutoComplete.selectedItems){if(e.dynamicAutoComplete.selectedItems.options.id){var t=UWA.clone(e.dynamicAutoComplete.selectedItems.options);e.person=t}}else e.removeConvUser=!0},save:function(e){var t,n=e.getData(),a={};e.selection?((a=e.selection).set(n),t=a._previousAttributes):a=new o(n),a.get("deployed")&&!a.hasChanged()||(a.get("deployed")&&a.hasChanged()||"updated"==a.get("action")?a.set("action","updated"):a.set("action","created"));var r=e.isDuplicateRule(e,a);r&&a.isNew()?(a.set(t),e.superModal.modals.current.hide(),s.alert().add({className:"warning",message:derivedformatmanagementinfra.getNLSData().label.ruleExists})):!r&&n&&a.isValid()?(e.collection.add(a),e.superModal.modals.current.hide()):a.isNew()||(a.set(t),e.cancel(e),s.alert().add({className:"warning",message:derivedformatmanagementinfra.getNLSData().label.ruleExists}))},isDuplicateRule:function(e,t){var n=e.collection._models;for(var a in refModelAttr=t._attributes,n)if(modelAttr=n[a]._attributes,t.cid!=n[a].cid&&refModelAttr.converter===modelAttr.converter&&refModelAttr.source===modelAttr.source&&refModelAttr.target===modelAttr.target&&refModelAttr.event===modelAttr.event&&refModelAttr.category===modelAttr.category&&e.checkPartExtension(modelAttr,refModelAttr)&&e.checkSubType(modelAttr,refModelAttr)&&e.checkState(modelAttr,refModelAttr)&&e.checkParameters(modelAttr.parameters,refModelAttr.parameters))return console.log(),!0;return!1},checkPartExtension:(e,t)=>!e.partExtension||t.partExtension&&t.partExtension===e.partExtension,checkSubType:(e,t)=>!e.subType||t.subType&&t.subType===e.subType,checkState:function(e,t){return!e.state||t.state&&t.state===e.state},checkParameters:function(e,t){if(0===Object.keys(e).length&&0===Object.keys(t).length)return!0;if(Object.keys(e).length!==Object.keys(t).length)return!1;var n;if(Object.keys(e).length>0)for(var a in e)if(val=e[a],(n=t[a])!==val||void 0===n&&""==n)return!1;return!0},getData:function(){var e={};e.converter=p.getDocument().getElementById("derivedformatfield-converter").value,e.category=p.getDocument().getElementById("derivedformatfield-connector").value;var t=p.getDocument().getElementById("derivedformatfield-event").options.selectedIndex;if(e.event=p.getDocument().getElementById("derivedformatfield-event").value,e.forceUpdate=I.checkFlag,e.eventToDisplay=p.getDocument().getElementById("derivedformatfield-event").options[t]?p.getDocument().getElementById("derivedformatfield-event").options[t].innerHTML:"",e.activation=p.getDocument().getElementById("derivedformatfield-activation").value,"PROMOTE"==e.event||"promote"==e.event){var n=p.getDocument().getElementById("derivedformatfield-state").options.selectedIndex;e.state=p.getDocument().getElementById("derivedformatfield-state").value,e.stateToDisplay=p.getDocument().getElementById("derivedformatfield-state").options[n].innerHTML}else e.state="",e.stateToDisplay="";var a=p.getDocument().getElementById("derivedformatfield-source").options.selectedIndex;return e.source=p.getDocument().getElementById("derivedformatfield-source").value,e.sourceToDisplay=p.getDocument().getElementById("derivedformatfield-source").options[a].innerHTML,e.partExtension=p.getDocument().getElementById("derivedformatfield-source").options[a].dataset.partextension,e.subType=p.getDocument().getElementById("derivedformatfield-source").options[a].dataset.subtype,e.sourceType=p.getDocument().getElementById("derivedformatfield-source").options[a].dataset.type,e.target=p.getDocument().getElementById("derivedformatfield-target").value,e.updateOnly=!1,e.inputStreamId=p.getDocument().getElementById("derivedformatfield-inputStreamId").value,e.outputStreamId=p.getDocument().getElementById("derivedformatfield-outputStreamId").value,this.person&&this.person.uuid?(e.convUser=this.person.uuid,e.convUserLabel=this.person.label):this.removeConvUser?(e.convUser="",e.convUserLabel=""):this.selection&&(e.convUser=this.selection.get("convUser"),e.convUserLabel=this.selection.get("convUserLabel")),e.parameters=y.getData(),e},getConverters:function(){var e=derivedformatmanagementinfra.getInfraCollection(),t=new Array,n=e._models[0]._attributes.name;this.selection&&(n=this.selection.get("converter"));let a=derivedformatmanagementinfra.getNLSData().label.synchronous?derivedformatmanagementinfra.getNLSData().label.synchronous:"Synchronous, at save",r=derivedformatmanagementinfra.getNLSData().label.asynchronous?derivedformatmanagementinfra.getNLSData().label.asynchronous:"Asynchronous";return e.forEach(function(e,o){var i=!0===e.get("synchronous")||"true"===e.get("synchronous")?a:r;t.push({label:e.get("name")+" ("+i+")",value:e.get("name"),selected:e.get("name")==n})}),t.sort(function(e,t){var n=e.label.toUpperCase(),a=t.label.toUpperCase();return n<a?-1:n>a?1:0}),t},getConnectors:function(e){var t=derivedformatmanagementinfra.getInfraCollection().find(function(t,n){return t.get("name")==e}),n=new Array,a=t.get("connectors"),r=a[0].name;return this.selection&&(r=this.selection.get("category")),a.forEach(function(e,t){n.push({label:e.name,value:e.name,selected:e.name==r})}),n.sort(function(e,t){var n=e.label.toUpperCase(),a=t.label.toUpperCase();return n<a?-1:n>a?1:0}),n},getEvents:function(e,t){var n=new Array,a=derivedformatmanagementinfra.getInfraCollection().find(function(t,n){return t.get("name")==e});if(a){var r=a.get("connectors").find(function(e,n){return e.name==t});if(r&&r.actions){var o=r.actions,i=o[0].name;this.selection&&(i=this.selection.get("event")),o.forEach(function(e,t){n.push({label:e.value,value:e.name,selected:e.name==i,lifecycle:"lifecycle"==e.maturityGraph?"yes":"no"})})}}return n},getActivation:function(e,t,n){var a=new Array,r=derivedformatmanagementinfra.getInfraCollection();!e&&p.getDocument().getElementById("derivedformatfield-converter").selectedOptions[0]&&(e=p.getDocument().getElementById("derivedformatfield-converter").selectedOptions[0].value),!t&&p.getDocument().getElementById("derivedformatfield-connector").selectedOptions[0]&&(t=p.getDocument().getElementById("derivedformatfield-connector").selectedOptions[0].value);var o=r.find(function(t,n){return t.get("name")==e});if(o){var i=o.get("connectors").find(function(e,n){return e.name==t});if(i&&i.actions){var d=i.actions.find(function(e,t){return e.name==n});if(d){var l=d.activation.split("|"),s=l[0];this.selection&&(s=this.selection.get("activation")),l.forEach(function(e,t){a.push({label:derivedformatmanagementinfra.getNLSData().label[e],value:e,selected:e==s})})}}}return a},getStates:function(e,t,n){var a=new Array,r=derivedformatmanagementinfra.getInfraCollection().find(function(t,n){return t.get("name")==e});if(r){var o=r.get("connectors").find(function(e,n){return e.name==t});if(o&&o.actions){var i=o.actions,d=UWA.Array.detect(i,function(e){return"PROMOTE"==e.name||"promote"==e.name});if(d){var l=this.getSourceFormats(e,t).find(function(e,t){return e.value==n});if(l){var s=null;if(l.type.includes("Part")||l.type.includes("SEComponent")?s=d.states.Part:l.type.includes("Drawing")?s=d.states.Drawing:l.type.includes("Document")&&(s=d.states.Document),s){var c=s[0];this.selection&&(c=this.selection.get("state")),s.forEach(function(e,t){a.push({label:e.value,value:e.name,selected:e.name==c})})}}}}}return a},getTargetFormats:function(e,t,n,a){var r=new Array,o=derivedformatmanagementinfra.getInfraCollection().find(function(t,n){return t.get("name")==e});if(o){var i=o.get("connectors").find(function(e,n){return e.name==t});if(i){var d=i.supportedformats.find(function(e,t){return e.source.name==n&&e.source.type==a});if(d){var l=d.targets[0].target;this.selection&&(l=this.selection.get("target")),d.targets.forEach(function(t,n){var a=t.target,o=a;derivedformatmanagementinfra.getNLSData()[e]&&derivedformatmanagementinfra.getNLSData()[e].target[a]&&(o=derivedformatmanagementinfra.getNLSData()[e].target[a]),r.push({label:o,value:a,selected:a==l})})}}}return r},getStreamIds:function(e,t,n,a,r){var o={},i=derivedformatmanagementinfra.getInfraCollection().find(function(t,n){return t.get("name")==e});if(i){var d=i.get("connectors").find(function(e,n){return e.name==t});if(d){var l=d.supportedformats.find(function(e,t){return e.source.name==n&&e.source.type==a});if(l&&l.targets)l.targets.forEach(function(e,t){e.target==r&&(o.inputStreamId=e.inputStreamId,o.outputStreamId=e.outputStreamId)})}}return o},getSourceFormats:function(e,t){var n=this,a=derivedformatmanagementinfra.getInfraCollection().find(function(t,n){return t.get("name")==e}),r=new Array;if(a){var o,i,d,l=a.get("connectors").find(function(e,n){return e.name==t});if(l)n.selection?(o=n.selection.get("sourceType"),i=n.selection.get("source"),n.selection.get("partExtension"),d=n.selection.get("subType")):(o=l.supportedformats[0].source.type,i=l.supportedformats[0].source.name,l.supportedformats[0].source.partExtension,d=l.supportedformats[0].source.subtype),l.supportedformats.forEach(function(e,t){var n="";n=e.source.subtype?e.source.subtypeValue?e.source.subtypeValue:e.source.subtype:derivedformatmanagementinfra.getNLSData().label[e.source.type.toLowerCase()]?derivedformatmanagementinfra.getNLSData().label[e.source.type.toLowerCase()]:e.source.type;var a=e.source.name==i&&e.source.type==o;d&&(a=a&&e.source.subtype==d),r.push({label:n,value:e.source.name,type:e.source.type,selected:a,partExtension:e.source.partExtension,subType:e.source.subtype})})}return r},getParamListView:function(){return y}})});