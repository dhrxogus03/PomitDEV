define("DS/CAT3DWVisu/CAT3DWISOViewService",["UWA/Class","DS/ApplicationFrame/FrameWindowsManager","DS/CoreEvents/Events","DS/Visualization/ThreeJS_DS","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/Visualization/Ambience"],function(e,t,i,n,o,r){"use strict";var a=e.extend({init:function(){this._parent(),this._frameWindow=t.getFrameWindow(),this._viewpoint=this._frameWindow.getViewpoint(),this._viewer=this._frameWindow.getViewer(),this._animationTime=150,a.prototype._savedCamera||(a.prototype._savedCamera={eyePos:(new n.Vector3).copy(this._viewpoint.getEyePosition()),targetDistance:this._viewpoint.getTargetDistance(),quaternion:(new n.Quaternion).setFromRotationMatrix((new n.Matrix4).copy(this._viewpoint.getCamera().matrix)),sightDirection:this._viewpoint.getSightDirection().clone()})},_isISOViewMode:function(){return this._viewpoint.getProjectionType()===a.ORTHOGRAPHIC},setISOViewMode:function(e,t){var r=this._animationTime;if(void 0!==t&&(r=t),!this._isISOViewMode()){var s=this._viewer.onPostRender(function(){this._viewer._modelEvent.unsubscribe(s),i.publish({event:"CATLSSetISOView",data:null}),this._viewer.render()}.bind(this));a.prototype._savedCamera={eyePos:(new n.Vector3).copy(this._viewpoint.getEyePosition()),targetDistance:this._viewpoint.getTargetDistance(),quaternion:(new n.Quaternion).setFromRotationMatrix((new n.Matrix4).copy(this._viewpoint.getCamera().matrix)),sightDirection:this._viewpoint.getSightDirection().clone()},this._viewpoint.setProjectionType(a.ORTHOGRAPHIC);var p=e.getMatrix().clone(),l=p.decompose()[0],u=(new n.Vector3).copy(this._viewpoint.getEyePosition()).clone().distanceTo(l),c=new n.Vector3,h=new n.Vector3,d=new n.Vector3;p.extractBasis(c,h,d);var g=new n.Vector3,f=new n.Vector3,m=d;this._viewpoint.getSightDirection().dot(d)>0&&m.multiplyScalar(-1);var _=this._viewpoint.camera.up.dot(c),w=this._viewpoint.camera.up.dot(h);Math.abs(_)>Math.abs(w)?(g=c,_<0&&g.multiplyScalar(-1)):(g=h,w<0&&g.multiplyScalar(-1));for(var v=[new n.Vector3(1,0,0),new n.Vector3(0,1,0),new n.Vector3(0,0,1)],T=0,y=0,P=new n.Vector3(1,0,0),S=0;S<v.length;S++)y=g.dot(v[S]),Math.abs(y)>=Math.abs(T)&&Math.abs(y)>Math.abs(m.dot(v[S]))&&(T=y,P=v[S].multiplyScalar(T<0?-1:1));f.crossVectors(P,m),g.crossVectors(m,f),f.normalize(),g.normalize(),m.normalize();var E={target:l,orientation:(new n.Matrix4).set(f.x,g.x,m.x,0,f.y,g.y,m.y,0,f.z,g.z,m.z,0,0,0,0,1).decompose()[1],distanceToTarget:u},A=new n.Vector3(0,0,-1);A.applyQuaternion(E.orientation),A.normalize(),!0===o.getPreferenceValue("R2VPerspectiveModeOn")&&(this._viewer.currentViewpoint.control.setActive(!0),this._viewer.currentViewpoint.control.setZoomActive(!0),this._viewer.currentViewpoint.control.setPanActive(!0),this._viewpoint.getControl().setRotationActive(!1)),this._viewpoint.moveTo({orientation:E.orientation,eyePosition:(new n.Vector3).addVectors(E.target,A.clone().multiplyScalar(-E.distanceToTarget)),distanceToTarget:E.distanceToTarget,duration:r})}},exitISOViewMode:function(e){if(this._isISOViewMode()){var t=this._animationTime;void 0!==e&&(t=e);var s=this._viewer.onPostRender(function(){this._viewer._modelEvent.unsubscribe(s),i.publish({event:"CATLSExitISOView",data:null}),this._viewer.render()}.bind(this));if(this._viewpoint.moveTo({eyePosition:a.prototype._savedCamera.eyePos,orientation:a.prototype._savedCamera.quaternion,distanceToTarget:a.prototype._savedCamera.targetDistance,duration:t}),this._viewpoint.setProjectionType(a.PERSPECTIVE),!0===o.getPreferenceValue("R2VOrthogonalViewWasInCalibratedMode")){o.setPreferenceValue("R2VOrthogonalViewWasInCalibratedMode",!1),o.setPreferenceValue("R2VCalibratedMode",!0);var p=new r({viewer:this._viewer});this._viewer.setAmbience(p);var l=o.getPreferenceValue("ambienceImageUrl");p.setBackGroundMap({url:l,mapping:new n.SimpleEnvMappingFit,hdr:!1}),this._viewer.render();var u=o.getPreferenceValue("R2VPosition"),c=o.getPreferenceValue("R2VQuaternion");this._viewpoint.moveTo({eyePosition:u,orientation:c,duration:10}),console.log("cam pos: "+u.x+" , "+u.y+" , "+u.z),console.log("cam quat: "+c.x+" , "+c.y+" , "+c.z+" , "+c.w);var h=o.getPreferenceValue("R2VCameraSetAngle");this._viewpoint.setAngle(h),this._viewer.currentViewpoint.control.setRotationActive(!1),this._viewer.currentViewpoint.control.setTouchRotationActive(!1),this._viewer.currentViewpoint.control.setZoomActive(!1),this._viewer.currentViewpoint.control.setPanActive(!1),this._viewer.currentViewpoint.control.setActive(!1)}}},updateSavedCameraTargetDistance:function(e){e&&(a.prototype._savedCamera.targetDistance=e,a.prototype._savedCamera.eyePos=(new n.Vector3).addVectors(this._viewpoint.target,a.prototype._savedCamera.sightDirection.clone().multiplyScalar(-e)))}});return a.PERSPECTIVE=0,a.ORTHOGRAPHIC=1,a}),define("DS/CAT3DWVisu/CAT3DWSession",["DS/CoreEvents/Events","UWA/Class"],function(e,t){"use strict";return t.singleton({init:function(){},initialize:function(t){t?(this._lsSession=t,this.getDrawingPlane=function(){return this._lsSession.getDrawingPlane()},this.setDrawingPlane=function(e,t){this._lsSession.setDrawingPlane(e,t)},this.getChangeDrawingPlaneEvent=function(){return this._lsSession.getChangeDrawingPlaneEvent()},this.getSnapOnGrid=function(){return this._lsSession.getSnapOnGrid()},this.setSnapOnGrid=function(e){this.setSnapOnGrid(e)},this.getChangeSnapOnGridEvent=function(){return this._lsSession.getChangeSnapOnGridEvent()}):(this._drawingPlane=null,this.getDrawingPlane=function(){var e={plane:null,direction:null,isFloor:!1};return this._drawingPlane&&(e.plane=this._drawingPlane,e.direction=this._drawingPlane.normal),e},this.setDrawingPlane=function(t,i){this._drawingPlane=t,i||e.publish({event:this.getChangeDrawingPlaneEvent(),data:this.getDrawingPlane()})},this.getChangeDrawingPlaneEvent=function(){return"CAT3DWChangeDrawingPlaneEvent"},this._bSnapOnGrid=!1,this.getSnapOnGrid=function(){return this._bSnapOnGrid},this.setSnapOnGrid=function(t){this._bSnapOnGrid=t,e.publish({event:this.getChangeSnapOnGridEvent(),data:this._bSnapOnGrid})},this.getChangeSnapOnGridEvent=function(){return"CAT3DWSnapOnGridEvent"})}})}),define("DS/CAT3DWVisu/CAT3DWDataFactory",["UWA/Core"],function(e){"use strict";function t(){this.eventData=null,this.pickingData=null}function i(){this.eventData=null,this.gestureData=null,this.pickingData=null}function n(){this.visuEventData=null,this.path=[],this.position=null,this.normal=null,this.tangent=null,this.tangents=null,this.uv=null,this.ray=null,this.plane=null,this.matrix=null,this.snapped=!1}function o(){this.gestureTypeList={NONE:"None",PREVIEW_GESTURE:"PreviewGesture",ACQUISITION_GESTURE:"AcquisitionGesture"},this.gestureSubTypeList={UNKNOWN:0,AFTER_BEGIN_MOVE:1,AFTER_UP:2},this.nativeEventData=null,this.gestureType=null,this.gestureSubtype=null}function r(){this.createModelingGestureData=function(){return new o},this.createPickingData=function(){return new n},this.createUIData=function(){return new i},this.createSelectionData=function(){return new t}}return r.SupportTypes={NONE:0,WORKING_PLANE:1,PICKING_AREA:2,IMAGE:4,TEXT:8,FACE:16,IMAGE_MAGNET:32,AR_LINE_MAGNET:64,WEB_LINE_MAGNET:128,LINE_MAGNET:256,EDGE:512,ANNOTATION:1024,AR_POINT_MAGNET:2048,WEB_POINT_MAGNET:4096,POINT_MAGNET:8192,VERTEX:16384,PREVIEW_ITEM:32768,CONNECTION:65536,MEASUREMENT:1<<17},r.SupportTypes.GEOMETRY=r.SupportTypes.VERTEX|r.SupportTypes.EDGE|r.SupportTypes.FACE,r.SupportTypes.GEOMETRY_MAGNET=r.SupportTypes.POINT_MAGNET|r.SupportTypes.LINE_MAGNET,r.SupportTypes.MAGNET=r.SupportTypes.GEOMETRY_MAGNET|r.SupportTypes.WEB_POINT_MAGNET|r.SupportTypes.WEB_LINE_MAGNET,r.SupportTypes.AR_MAGNET=r.SupportTypes.AR_POINT_MAGNET|r.SupportTypes.AR_LINE_MAGNET,r.SupportTypes.ALL=r.SupportTypes.WORKING_PLANE|r.SupportTypes.IMAGE|r.SupportTypes.GEOMETRY|r.SupportTypes.MAGNET|r.SupportTypes.IMAGE_MAGNET|r.SupportTypes.PREVIEW_ITEM|r.SupportTypes.PICKING_AREA|r.SupportTypes.ANNOTATION|r.SupportTypes.CONNECTION,Object.freeze(r.SupportTypes),r.getLabelOf=function(e){switch(e){case r.SupportTypes.VERTEX:case r.SupportTypes.EDGE:case r.SupportTypes.FACE:case r.SupportTypes.POINT_MAGNET:case r.SupportTypes.LINE_MAGNET:case r.SupportTypes.WEB_POINT_MAGNET:case r.SupportTypes.WEB_LINE_MAGNET:case r.SupportTypes.AR_POINT_MAGNET:case r.SupportTypes.AR_LINE_MAGNET:case r.SupportTypes.IMAGE_MAGNET:case r.SupportTypes.IMAGE:case r.SupportTypes.ANNOTATION:case r.SupportTypes.PREVIEW_ITEM:case r.SupportTypes.PICKING_AREA:case r.SupportTypes.CONNECTION:for(var t in r.SupportTypes)if(r.SupportTypes[t]===e)return t;break;default:return""}},r.PickingData=function(){this.ray=null,this.path=null,this.plane=null,this.tangent=null,this.tangent=null,this.point={position:null,supportType:r.SupportTypes.NONE,supportData:null,isSnapped:function(){return this.supportType>r.SupportTypes.WORKING_PLANE}}},e.namespace("DS/CAT3DWVisu/CAT3DWDataFactory",r)}),define("DS/CAT3DWVisu/CAT3DWViewSettings",["UWA/Class","UWA/Core","DS/Plugins/UserRenderList","DS/ApplicationFrame/FrameWindowsManager","DS/Visualization/ThreeJS_DS"],function(e,t,i,n,o){"use strict";var r=e.extend({init:function(){this._frameWindow=n.getFrameWindow(),this._viewer=this._frameWindow.getViewer(),this._touchMode=!1,this._pickingTolerance=2,this._beforeNoZPass=null,this._beforeMainPass=null},setTouchMode:function(e){this._touchMode=e,this._pickingTolerance=this._touchMode?9:2},getTouchMode:function(){return this._touchMode},applyDefaultPickingSettings:function(){this._viewer.setPicking({activated:!0,displayHL:!0,gpu:!0,computeNormalDepth:!0,primitive:!0,pickingTolerance:this._pickingTolerance}),this._viewer.setPrePicking({activated:!0,displayHL:!0,gpu:!0,computeNormalDepth:!0,primitive:!0,pickingTolerance:this._pickingTolerance})},deactivateHighlights:function(){this._viewer.setPicking({displayHL:!1}),this._viewer.setPrePicking({displayHL:!1})},activatePicking:function(){this._viewer.setPicking({activated:!0})},deactivatePicking:function(){this._viewer.setPicking({activated:!1})},activatePrePicking:function(){this._viewer.setPicking({activated:!0})},deactivatePrePicking:function(){this._viewer.setPrePicking({activated:!1})},activateManipulators:function(){this._viewer.setManipulators({activated:!0})},deactivateManipulators:function(){this._viewer.setManipulators({activated:!1})},getBeforeNoZPass:function(){if(null===this._beforeNoZPass){var e=this._viewer.getUserPassManager();this._beforeNoZPass=new i("BeforeNoZ");var t=e.createUserClearPass("userClearPass",this._beforeNoZPass);t.setClearDepth(!0);var n=e.createUserRenderPass("userRenderPass",this._beforeNoZPass),o=e.getSystemPass("noz");e.insertUserPassBeforePass(t,o),e.insertUserPassAfterPass(n,t)}return this._beforeNoZPass},getBeforeMainPass:function(){if(null===this._beforeMainPass){var e=this._viewer.getUserPassManager();this._beforeMainPass=new i("BeforeMain");var t=e.createUserClearPass("userClearPass",this._beforeMainPass);t.setClearDepth(!0);var n=e.createUserRenderPass("userRenderPass",this._beforeMainPass),o=e.getSystemPass("main");e.insertUserPassBeforePass(t,o),e.insertUserPassBeforePass(n,t)}return this._beforeMainPass},setViewerSize:function(e){var t=this._frameWindow.getContent();t.removeAttribute("style"),t.dataset.x3dphotomode=e}});return r.getSelectionColor=function(){return new o.Color("#42A2DA")},r.getCoselectionColor=function(){return new o.Color("#77797C")},r.DEFAULT="default",r.WIZARD_WITHOUT_BORDERS="wizard",r.WIZARD_WITH_BORDERS="wizard-borders",t.namespace("DS/CAT3DWVisu/CAT3DWViewSettings",r)}),define("DS/CAT3DWVisu/CAT3DWTolerance",["UWA/Core"],function(e){"use strict";var t=function(){};return t.tolerance=1e-5,t.toleranceForEdgesAndPoints=1e-4,t.toleranceForUnitaryVectors=1-t.tolerance,t.toleranceForAlignments=.99,t.toleranceForPerpendicular=.2,t.toleranceForParallel=.8,t.squareTolerance=t.tolerance*t.tolerance,t.squareToleranceForUnitaryVectors=t.toleranceForUnitaryVectors*t.toleranceForUnitaryVectors,t.areAlmostEqual=function(e,t,i){return Math.pow(e-t,2)<Math.pow(i,2)},e.namespace("DS/CAT3DWVisu/CAT3DWTolerance",t)}),define("DS/CAT3DWVisu/CAT3DWReframeServices",["DS/ApplicationFrame/FrameWindowsManager","DS/Visualization/ThreeJS_DS","UWA/Class"],function(e,t,i){"use strict";var n=i.extend({init:function(){this._frameWindow=e.getFrameWindow(),this._viewer=this._frameWindow.getViewer(),this._viewpoint=this._frameWindow.getViewpoint()},reframeOnImage:function(e,i){void 0===i&&(i={});var o=e.getBoundingSphere(),r=e.getCenter(),a=e.getNormal(),s=e.getDimensions(),p=e.getCorners();o.center=r,o.radius=.5*s.height;var l=s.width/s.height,u=this._viewer.viewpoints[0].camera.aspect;l>u&&(o.radius=.5*s.width/u);var c=e.getMatrix().decompose();this._viewpoint.moveTo({orientation:c[1]});var h=(new t.Vector3).subVectors(p.bottomLeft,p.bottomRight);h.normalize(),h.applyAxisAngle(a,Math.PI),this._viewpoint.setUpDirection(h);var d=(new t.Vector3).subVectors(p.bottomLeft,p.topLeft);d.normalize(),d.applyAxisAngle(a,Math.PI),this._viewpoint.setUpDirection(d),this._viewpoint.setProjectionType(n.PERSPECTIVE);var g=this._viewer.onPostRender(function(){this._viewer._modelEvent.unsubscribe(g),setTimeout(function(){i.callback&&i.callback()},i.time)}.bind(this)),f=i.fullSize?1:1.02;this._viewpoint.onReframe(function(e,i,n,o){var r=function(e){var t=f*e.radius/Math.tan(this._viewpoint.camera.fov*Math.PI/360);return{target:e.center.clone(),orientation:this._viewpoint.control.orientation.clone(),distanceToTarget:t}}.bind(this)(n);if(r){var a=new t.Vector3(0,0,-1);a.applyQuaternion(r.orientation),a.normalize(),this._viewpoint.moveTo({orientation:r.orientation,eyePosition:(new t.Vector3).addVectors(r.target,a.clone().multiplyScalar(-r.distanceToTarget)),distanceToTarget:r.distanceToTarget})}}.bind(this)),this._viewpoint.reframe(null,i.time,o),this._viewpoint.onReframe(null)},reframeOnNode:function(e,t,i){var o=i||null,r=this._viewer.onPostRender(function(){this._viewer._modelEvent.unsubscribe(r),setTimeout(function(){t&&t()},o)}.bind(this)),a=e.getBoundingSphere("visibleSpace");a=a.radius>0?a:null,this._viewpoint.setProjectionType(n.PERSPECTIVE),this._viewpoint.resetCameraOrientation(),this._viewpoint.reframe(null,o,a)}});return n.PERSPECTIVE=0,n.ORTHOGRAPHIC=1,UWA.namespace("DS/CAT3DWVisu/CAT3DWReframeServices",n)}),define("DS/CAT3DWVisu/CAT3DWPanAndZoomService",["UWA/Class","DS/ApplicationFrame/FrameWindowsManager","DS/CoreEvents/Events","DS/Visualization/ThreeJS_DS","DS/Visualization/TrackballControls"],function(e,t,i,n,o){"use strict";var r=e.extend({init:function(){this._parent(),this._frameWindow=t.getFrameWindow(),this._webGLV6Viewer=this._frameWindow.getViewer(),this._viewpoint=this._frameWindow.getViewpoint()},setViewerZommable:function(e){this.resetZoom(),e?(this.restoreNativePanAndZoom(),this._viewpoint.setControlActive({viewpoint:!0,picking:!0}),this._rotationEnabled=!1,this.overloadPanAndZoom({overrideOnReframe:!1})):(this._viewpoint.setControlActive({viewpoint:!1,picking:!0}),this.restoreNativePanAndZoom())},resetZoom:function(){this._zoom=1,i.publish({event:"hideFitAllBtn",data:null}),this._viewpoint.setViewOffset()},getZoom:function(){return this._zoom},restoreNativePanAndZoom:function(){this._webGLV6Viewer&&this._webGLV6Viewer.currentViewpoint&&this._webGLV6Viewer.currentViewpoint.control&&(this._webGLV6Viewer.currentViewpoint.control.onPan(null),this._webGLV6Viewer.currentViewpoint.control.onRotate(null),this._webGLV6Viewer.currentViewpoint.control.onZoom(null),this._webGLV6Viewer.currentViewpoint.onReframe(null),this._webGLV6Viewer.currentViewpoint.onCenterCamera(null))},overloadPanAndZoom:function(e){if(this._zoom=1,this._panCenter=new n.Vector2(Math.floor(this._webGLV6Viewer.div.clientWidth/2),Math.floor(this._webGLV6Viewer.div.clientHeight/2)),!this._webGLV6Viewer)return!1;var t=this._webGLV6Viewer.currentViewpoint;if(!t||!t.control)return!1;this._webGLV6Viewer.currentViewpoint.control.onPan(function(e){e.defaultBehavior=!1;var i=e.gesture.events,n=e.gesture.view[0],o=i[0].getCurrentPosition(n),r=i[0].getLastPosition(n);if(o&&r){if(i[0]&&i[1]){var a=i[0].getCurrentPosition(),s=i[1].getCurrentPosition(),p=i[0].getLastPosition(),l=i[1].getLastPosition(),u=a.distanceTo(s),c=p.distanceTo(l);if(Math.abs(c-u)>=this._webGLV6Viewer.div.clientWidth/400)return}this._panCenter=this._panCenter.add(r.sub(o)),this._applyViewOffset(t)}}.bind(this)),this._webGLV6Viewer.currentViewpoint.control.onZoom(function(e){if(e.defaultBehavior=!1,!e||!e.gesture||"MouseMove"!=e.gesture.name){var r,a,s,p,l,u=this._webGLV6Viewer.currentViewpoint.control.getManipulationState();if(null!=this._xOffset&&null!=this._yOffset||(this._xOffset=0,this._yOffset=0),e.factor)if(u==o.State.ZOOM_PAN_ROTATE){r=e.factor<1?.97:1.03;var c=e.gesture.touches[0].getCurrentPosition(),h=e.gesture.touches[1].getCurrentPosition(),d=e.gesture.touches[0].getLastPosition(),g=e.gesture.touches[1].getLastPosition(),f=c.distanceTo(h),m=d.distanceTo(g);if(Math.abs(m-f)<=this._webGLV6Viewer.div.clientWidth/400)return;var _=(c.x+h.x)/2,w=(c.y+h.y)/2;a=new n.Vector2(_,w),s=this._xOffset+this._zoom*a.x,p=this._yOffset+this._zoom*a.y,a=new n.Vector2(s,p),l=(new n.Vector2).subVectors(this._panCenter,a),this._panCenter=(new n.Vector2).addVectors(l.multiplyScalar(r),a)}else r=e.factor>0?.9:1.1,a=e.evt.getCurrentPosition(T),s=this._xOffset+this._zoom*a.x,p=this._yOffset+this._zoom*a.y,a=new n.Vector2(s,p),l=(new n.Vector2).subVectors(this._panCenter,a),this._panCenter=(new n.Vector2).addVectors(l.multiplyScalar(r),a);else{var v=e.gesture.events,T=e.gesture.view[0];a=v[0].getCurrentPosition(T);var y=v[0].getLastPosition(T);r=1+.5*(a.y-y.y)/this._webGLV6Viewer.currentViewpoint.control.radiusZoom*this._webGLV6Viewer.currentViewpoint.control.zoomSpeed,l=(new n.Vector2).subVectors(y,this._panCenter).multiplyScalar(this._zoom),this._panCenter=this._panCenter.add(l)}this._zoom*=r,this._zoom>=1?(this._zoom=1,this._viewpoint.getControl().setRotationActive(this._rotationEnabled),i.publish({event:"hideFitAllBtn",data:null})):(this._viewpoint.getControl().setRotationActive(!1),i.publish({event:"showFitAllBtn",data:null})),this._applyViewOffset(t)}}.bind(this)),e.overrideOnReframe&&this._webGLV6Viewer.currentViewpoint.onReframe(function(){this._panCenter=new n.Vector2(Math.floor(this._webGLV6Viewer.div.clientWidth/2),Math.floor(this._webGLV6Viewer.div.clientHeight/2)),this._zoom=1,this._applyViewOffset(t)}.bind(this)),this._webGLV6Viewer.currentViewpoint.onCenterCamera(function(){this._panCenter=new n.Vector2(Math.floor(this._webGLV6Viewer.div.clientWidth/2),Math.floor(this._webGLV6Viewer.div.clientHeight/2)),this._zoom=1,this._applyViewOffset(t)}.bind(this))},_applyViewOffset:function(e){var t=this._webGLV6Viewer.div.clientWidth*this._zoom,i=this._webGLV6Viewer.div.clientHeight*this._zoom;t<=1||i<=1||(this._panCenter.x+t/2>this._webGLV6Viewer.div.clientWidth&&(this._panCenter.x=this._webGLV6Viewer.div.clientWidth-t/2),this._panCenter.x-t/2<0&&(this._panCenter.x=t/2),this._panCenter.y+i/2>this._webGLV6Viewer.div.clientHeight&&(this._panCenter.y=this._webGLV6Viewer.div.clientHeight-i/2),this._panCenter.y-i/2<0&&(this._panCenter.y=i/2),this._xOffset=this._panCenter.x-t/2,this._yOffset=this._panCenter.y-i/2,e.setViewOffset({fullWidth:this._webGLV6Viewer.div.clientWidth,fullHeight:this._webGLV6Viewer.div.clientHeight,x:this._xOffset,y:this._yOffset,width:t,height:i}),this._webGLV6Viewer.render())}});return UWA.namespace("DS/CAT3DWVisu/CAT3DWPanAndZoomService",r)}),define("DS/CAT3DWVisu/CAT3DWNode3DHyperlink",["DS/Visualization/Node3D","DS/CAT3DWInfraUI/CAT3DWCanvasServices","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS","DS/Visualization/MaterialApplication","UWA/Core"],function(e,t,i,n,o,r){"use strict";var a=e.extend({init:function(e,t,i,n){this._parent(n||"CAT3DWNode3DHyperlink"),0===i?this.addTextureLoader(e,t):this.addTexture(e,t,i)},addTexture:function(e,t,o){var a={width:-12,height:-12,fill:!0,noEdge:!0};this._goToUrlIconNode=i.createRectangleNode(a),this._goToUrlIconNode.setName("HyperlinkTextureNode");this.renderIconToCanvas(this._goToUrlIconNode,{id:"HyperlinkNode",value:""});var s=e;this.cornerTopRight=s.topRight,this.cornerTopLeft=s.topLeft;var p=(new n.Matrix4).getInverse(t.clone()),l=1;(r.Utils.Client.Platform.ios||r.Utils.Client.Platform.ipad)&&(l=0);let u=new n.Vector3(this.cornerTopRight.x+l,this.cornerTopRight.y-l/2,this.cornerTopRight.z).applyMatrix4(p);var c,h=(new n.Matrix4).setPosition(u);c=(new n.Matrix4).makeScale(o,o,o),h.multiplyMatrices(c,h),h.setPosition(u),this._goToUrlIconNode.setMatrix(h),this.addChild(this._goToUrlIconNode)},addTextureLoader:function(e,t){var o={width:-8,height:-8,fill:!0,noEdge:!0};this._goToUrlIconNode=i.createRectangleNode(o),this._goToUrlIconNode.setName("HyperlinkTextureNode");this.renderIconToCanvas(this._goToUrlIconNode,{id:"HyperlinkNode",value:""},1);var r=e;this.cornerTopRight=r.topRight,this.cornerTopLeft=r.topLeft;var a=(new n.Matrix4).getInverse(t.clone()),s=(new n.Matrix4).setPosition(new n.Vector3(this.cornerTopRight.x,this.cornerTopRight.y+8,this.cornerTopRight.z));this._goToUrlIconNode.setMatrix(s),this._goToUrlIconNode.applyMatrix(a),this.addChild(this._goToUrlIconNode)},renderIconToCanvas:function(e,i,r=0){var a=i.value,s=(new t).createCanvas({width:100,height:100,tag:"GoToUrlCanvas"}),p=s.getContext("2d");p.textBaseline="middle",p.textAlign="center",p.font="60px Entypo",p.fillStyle="#42A2DA";var l=90*Math.PI;r?(l/=180,p.rotate(l),p.fillText(a,35,-35,100)):(p.rotate(l),p.fillText(a,40,40,100));var u=n.ImageUtils.createTexture3DWhiteboard(s,!0);u.magFilter=n.LinearFilter,u.minFilter=n.LinearMipMapLinearFilter;var c=new n.MeshBasicMaterial({map:u,force:!0,side:n.DoubleSide});c.transparent=!0,c.color=new n.Color;var h=new o({faceMaterial:c});e.setMaterialApplication(h),e.currenttexture=u},update:function(e,t,i){var o=e;this.cornerTopRight=o.topRight,this.cornerTopLeft=o.topLeft;var a=t,s=(new n.Matrix4).getInverse(a.clone()),p=1;(r.Utils.Client.Platform.ios||r.Utils.Client.Platform.ipad)&&(p/=2);let l=new n.Vector3(this.cornerTopRight.x+p,this.cornerTopRight.y-p/2,this.cornerTopRight.z).applyMatrix4(s);var u,c=(new n.Matrix4).setPosition(l);u=(new n.Matrix4).makeScale(i,i,i),c.multiplyMatrices(u,c),c.setPosition(l),this._goToUrlIconNode.setMatrix(c)},deleteNode:function(){this.removeChild(this._goToUrlIconNode)}});return r.namespace("DS/CAT3DWVisu/CAT3DWNode3DHyperlink",a)}),define("DS/CAT3DWVisu/CAT3DWNode3D",["DS/Mesh/Mesh","DS/Visualization/Node3D","DS/Visualization/Mesh3D"],function(e,t,i){"use strict";return t.extend({init:function(e){this._parent(e)},addChild:function(e){this._parent(e),e instanceof i&&(e.excludeFromCSO(!0),e.excludeFromHighlight(!0,!0),e.setSSAO(!1),e.setShadow(!1,!1))},setPickable:function(t){this._parent(t?e.PICKABLE:e.PICKTHROUGH)}})}),define("DS/CAT3DWVisu/CAT3DWGeomFactory",["DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS","DS/Visualization/MaterialApplication","DS/SVGLoader/SVGLineMaterial"],function(e,t,i){"use strict";var n=function(){};return n.createCube=function(i){if(!i||!i.center||!i.size)return null;var n={cornerPoint:i.center.clone().addScalar(.5*-i.size),firstAxis:new t.Vector3(i.size,0,0),secondAxis:new t.Vector3(0,i.size,0),thirdAxis:new t.Vector3(0,0,i.size),fill:void 0===i.fill||i.fill,material:i.material},o=e.createCuboidNode(n);return i.node&&i.node.addChild(o),o},n.DiscretizedArc=function(e,i){if(!e||!i)return;if(3!==e.length)return;let n=e[0],o=e[1],r=e[2],a=0,s=0,p=0,l=0,u=0,c=0,h=new t.Vector2,d=new t.Vector2,g=new t.Vector2,f=new t.Vector2,m=new t.Vector2,_=new t.Vector2;f.copy(n),m.copy(o),_.copy(r),h.copy(m.sub(f)),m.copy(o),d.copy(m.sub(_)),g.copy(_.sub(f)),p=.5*Math.sqrt(Math.abs(h.x*g.y-h.y*g.x)/(h.length()*i)),l=.5*Math.sqrt(Math.abs(d.x*g.y-d.y*g.x)/(h.length()*i)),s=Math.max(p,l)+1;var w=[];if(w.push(new t.Vector3(n.x,n.y,50)),s<=2){let e=new t.Vector3(r.x,r.y,50);w.push(e)}else{f.copy(n),m.copy(o),_.copy(r),h.copy(f.sub(m).add(_.sub(o))),f.copy(n),m.copy(o),_.copy(r),d.copy(m.sub(f).multiplyScalar(2)),c=u=1/s;let e=new t.Vector2;e.copy(d);let i=new t.Vector2;for(i.copy(h),a=2;a<=s+1;a++){f.copy(n),e.copy(d),i.copy(h);let o=new t.Vector2;o.copy(f.add(e.add(i.multiplyScalar(c)).multiplyScalar(c)));let r=new t.Vector3(o.x,o.y,50);w.push(r),c+=u}}return w.push(new t.Vector3(r.x,r.y,50)),w},n.GetControlPoint=function(e,t,i,n){const o=i.clone().sub(e),r=Math.max(.25*o.length(),3*n);return t.clone().multiplyScalar(r).add(e)},n.ComputeBezierCurve=function(e,t,i,n,o){if(!(e&&t&&i&&n))return;if(3!==e.length)return;let r=e[0],a=e[1],s=e[2];var p=[];let l=[r,this.GetControlPoint(r,i,s,o),a],u=[a,this.GetControlPoint(s,n,r,o),s];return p=(p=p.concat(this.DiscretizedArc(l,t))).concat(this.DiscretizedArc(u,t))},n.ComputeLine=function(e){if(e){var i=[];for(let n=0;n<e.length;n++)i.push(new t.Vector3(e[n].x,e[n].y,50));return i}},n.ComputeArrowPoint=function(e,i,n){if(!e||!i)return;const o=Math.cos(Math.PI/5),r=Math.sin(Math.PI/5),a=new t.Vector3(e.x,e.y,50),s=new t.Vector3(i.x*o+i.y*-r,i.x*r+i.y*o,0);s.normalize().multiplyScalar(n).add(a);const p=new t.Vector3(i.x*o+i.y*r,i.x*-r+i.y*o,0);return p.normalize().multiplyScalar(n).add(a),[a,s,p,a]},n.CreateLineNode=function(n,o){if(!n&&!o)return;var r=e.createLineNode({points:n});let a=new t.SVGLineMaterial({color:new t.Color(o.color),force:!0,transparent:!1,opacity:o.opacity,lineWidth:o.thickness,linecap:"round"});if("segmented"===o.lineType){let e=new Float32Array(2);e[0]=1.5,e[1]=1,a.setDashPatternArray(e)}if("dotted"===o.lineType){let e=new Float32Array(2);e[0]=o.thickness/2,e[1]=o.thickness,a.setDashPatternArray(e)}return r.setMaterialApplication(new i({lineMaterial:a})),r},n}),define("DS/CAT3DWVisu/CAT3DWGrid",["DS/ApplicationFrame/FrameWindowsManager","DS/Mesh/MeshUtils","DS/Visualization/MaterialApplication","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS"],function(e,t,i,n,o,r){"use strict";return n.extend({init:function(t){var i=t||{};this._parent(i.name?i.name:"CAT3DWGrid");var n=e.getFrameWindow();this._viewer=n.getViewer(),this._viewpoint=n.getViewpoint(),this._size=void 0!==i.size?i.size:200,this._baseSize=this._size,this.displayGrid=void 0!==i.displayGrid?i.displayGrid:1,this.displayGridFromBelow=void 0!==i.displayGridFromBelow?i.displayGridFromBelow:1,this.gridScreenSize=void 0!==i.gridScreenSize?i.gridScreenSize:50,this.gridNbSteps=void 0!==i.gridNbSteps?i.gridNbSteps:5,this.gridUnit=void 0!==i.gridUnit?i.gridUnit:1,this.gridOffset=void 0!==i.gridOffset?i.gridOffset:new r.Vector2,this.gridCoeff=void 0!==i.gridCoeff?i.gridCoeff:1,this.gridFalloff=void 0!==i.gridFalloff?i.gridFalloff:1,this.gridColor=new r.Color(void 0!==i.gridColor?i.gridColor:"#3d3d3d"),this.displayPlane=void 0!==i.displayPlane?i.displayPlane:1,this.planeFalloff=void 0!==i.planeFalloff?i.planeFalloff:1,this.planeColor=new r.Color(void 0!==i.planeColor?i.planeColor:"#f1f1f1"),this.planeOpacity=void 0!==i.planeOpacity?i.planeOpacity:.5,this.planeTexture=void 0!==i.planeTexture?i.planeTexture:null,this.planeTextureScale=void 0!==i.planeTextureScale?i.planeTextureScale:1,this.planeBorder=!1,this.edgeColor=new r.Color,this.gridTextures={},this._position=new r.Vector3(0,0,0),this._orientation=new r.Matrix4,this._createPlaneGrid()},_createPlaneGrid:function(){this._planeNode=o.createRectangleNode({width:1,height:1,fill:!0,noEdge:!0}),this.addChild(this._planeNode),this.setPickable(t.NOPICKABLE),this.exludeFromBounding(!0),this.setPositionAndOrientation({position:this._position,orientation:this._orientation})},setPositionAndOrientation:function(e){this._position=e.position?e.position:this._position,this._orientation=e.orientation?e.orientation:this._orientation;var t=(new r.Matrix4).copy(this._orientation);t.setPosition(this._position),this.setMatrix(t),this.isVisible()&&this._update()},show:function(){this._update(),this.setVisibility(!0),this._subscribeToViewpointMove(),this._viewer.render()},hide:function(){this.setVisibility(!1),this._unsubscribeToViewpointMove(),this._planeNode.removeMaterialApplication(),this._viewer.render()},_onViewpointMove:function(){this._update()},_update:function(){if(this._baseTargetDistance){var e=this._viewpoint.getTargetDistance();this._size=e*this._baseSize/this._baseTargetDistance;var t=this._planeNode.getMatrix().decompose(),i=(new r.Matrix4).compose(new r.Vector3(-.5*this._size,-.5*this._size,0),t[1],new r.Vector3(this._size,this._size,this._size));this._planeNode.setMatrix(i),this._planeNode.removeMaterialApplication(),this._planeNode.setMaterialApplication(this._getPlaneMaterialApplication()),this._viewer.render()}else this._baseTargetDistance=this._viewpoint.getTargetDistance()},clean:function(){this._unsubscribeToViewpointMove()},_subscribeToViewpointMove:function(){this._onMoveToken||(this._onMoveToken=this._viewpoint.onMove(this._onViewpointMove.bind(this)))},_unsubscribeToViewpointMove:function(){this._viewpoint.unsubscribe(this._onMoveToken),this._onMoveToken=void 0},_getPlaneMaterialApplication:function(){var e=this._viewpoint.getWorldOrientation(),t=e.upVector,n="zup"===e._woName;this._computeGridUnit(this._viewpoint.camera,Math.abs(this._viewpoint.camera.position.dot(t)-this._position.dot(t)));var o=this.gridNbSteps*this.gridUnit;this.gridOffset.x=this._position.x-o*Math.floor(this._position.x/o),n?this.gridOffset.y=this._position.y-o*Math.floor(this._position.y/o):this.gridOffset.z=this._position.z-o*Math.floor(this._position.z/o);var a=new r.PlaneMaterial;a.setPlaneV2(!0),a.lights=!0,a.depthTest=!0,a.depthWrite=!0,a.transparent=!0,a.enableClipPlanes=!1,a.side=r.DoubleSide,a.ambient.copy(new r.Color(328965)),a.force=!0,a.updatePDSFXUniform("displayPlane",this.displayPlane),a.updatePDSFXUniform("displayGrid",this.displayGrid),a.updatePDSFXUniform("gridFromBelow",this.displayGridFromBelow),a.color.copy(this.planeColor),a.updatePDSFXUniform("planeOpacity",this.planeOpacity),(a.map&&!this.planeTexture||!a.map&&this.planeTexture)&&(a.needsUpdate=!0),a.setPlaneTexture(this.planeTexture),a.updatePDSFXUniform("uvScale",this.planeTextureScale);var s=new r.Color;s.copyToLinear(this.edgeColor,!0),a.updatePDSFXUniform("border",s),a.updatePDSFXUniform("attenuation",this._viewer.planeAttenuation?1:0),a.updatePDSFXUniform("planeBorder",this.planeBorder),a.updatePDSFXUniform("planeFalloff",this.planeFalloff),a.updatePDSFXUniform("gridFalloff",this.gridFalloff),a.updatePDSFXUniform("gridUnit",this.gridUnit),a.updatePDSFXUniform("gridOffset",this.gridOffset),a.updatePDSFXUniform("gridCoeff",this.gridCoeff);var p=new r.Color;p.copyToLinear(this.gridColor,!0),a.updatePDSFXUniform("gridColor",p),a.updatePDSFXUniform("planeSize",this._size),a.updatePDSFXUniform("nbSteps",this.gridNbSteps);var l=function(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))},u=this.gridNbSteps/2,c=l(64*u),h=l(64*u*u),d=Math.min(l(64*u*u*u),4096);return a.updatePDSFXUniform("gridTexture",this._getUnitGridTexture(64)),a.updatePDSFXUniform("gridTexture2",this._getUnitGridTexture(c)),a.updatePDSFXUniform("gridTexture3",this._getUnitGridTexture(h)),a.updatePDSFXUniform("gridTexture4",this._getUnitGridTexture(d)),new i({faceMaterial:a})},_getUnitGridTexture:function(e){if(this.gridTextures[e])return this.gridTextures[e];for(var t=new Uint8Array(e*e),i=0;i<e;++i)t[i]=255,t[e*(e-1)+i]=255,t[e*i]=255,t[e*i+e-1]=255;var n=new r.DataTexture(t,e,e,r.AlphaFormat,r.UnsignedByteType,new r.UVMapping,r.RepeatWrapping,r.RepeatWrapping,r.LinearFilter,r.LinearMipMapLinearFilter,16);return n.needsUpdate=!0,this.gridTextures[e]=n,n},_computeGridUnit:function(e,t){var i=1;e instanceof r.PerspectiveCamera?i=2*this.gridScreenSize*Math.tan(Math.PI*e.fov/360)*t/this._viewer.div.clientHeight:e instanceof r.OrthographicCamera&&(i=this.gridScreenSize*(e.top-e.bottom)/this._viewer.div.clientHeight);for(var n=1/(this.gridNbSteps*this.gridNbSteps);n<i;)1===this.gridNbSteps?n++:n*=this.gridNbSteps;this.gridUnit=n,1===this.gridNbSteps?this.gridCoeff=i-n-1:this.gridCoeff=(i-n/this.gridNbSteps)/(n-n/this.gridNbSteps)}})}),define("DS/CAT3DWVisu/CAT3DWVisuEvents",["DS/CoreEvents/Events","DS/VisuEvents/EventsManager"],function(e,t){"use strict";var i=function(){var i=null,n=null,o=0,r=null,a=null,s=void 0,p=void 0,l=void 0,u=void 0,c=void 0,h=function(){};h.prototype.init=function(e,o){i=e,n=o,t.addEvent(i,"onLeftMouseDown",g),t.addEvent(i,"onLeftMouseUp",f),t.addEvent(i,"onRightMouseDown",m),t.addEvent(i,"onRightMouseUp",_),t.addEvent(i,"onMouseMove",w),t.addEvent(i,"onTouch",g),t.addEvent(i,"onRelease",f),t.addEvent(i,"onSwipe",w)},h.prototype.clear=function(){t.removeEvent(i,"onLeftMouseDown",g),t.removeEvent(i,"onLeftMouseUp",f),t.removeEvent(i,"onMouseMove",w),t.removeEvent(i,"onRightMouseDown",m),t.removeEvent(i,"onRightMouseUp",_),t.removeEvent(i,"onTouch",g),t.removeEvent(i,"onRelease",f),t.removeEvent(i,"onSwipe",w)},h.prototype.getClickEvent=function(){return"CATLSVisuClickEvent"},h.prototype.getRightClickEvent=function(){return"CATLSVisuRightClickEvent"},h.prototype.getHoldEvent=function(){return"CATLSVisuHoldEvent"},h.prototype.getLongHoldEvent=function(){return"CATLSVisuLongHoldEvent"},h.prototype.getDragEvent=function(){return"CATLSVisuDragEvent"},h.prototype.getDoubleClickEvent=function(){return"CATLSVisuDoubleClickEvent"},h.prototype.getUpEvent=function(){return"CATLSVisuUpEvent"},h.prototype.getPalmThreshold=function(){return 30};var d=function(){v(),o=0,r=null},g=function(e){o|=h.Down,T(e),P(e),e.from.length&&e.from[0].event.preventDefault(),r=new h.EventData(e)},f=function(t){if(e.publish({event:h.prototype.getUpEvent(),data:new h.EventData(t)}),s){if(n.isMoving())return void d();if(o&h.Click)Date.now()-u>50&&(d(),e.publish({event:h.prototype.getDoubleClickEvent(),data:[a,new h.EventData(t)]}));else d(),o|=h.Click,E(t),a=new h.EventData(t),C()}else d()},m=function(){A()},_=function(t){if(c){if(n.isMoving())return void d();e.publish({event:h.prototype.getRightClickEvent(),data:new h.EventData(t)})}else d()},w=function(t){o&h.Down&&r.position.distanceTo(t.from[0].getCurrentPosition(i))>10&&(v(),e.publish({event:h.prototype.getDragEvent(),data:new h.EventData(t)}))},v=function(){y(),S(),V(),D(),M()},T=function(t){N(t)>1?d():b(t)?d():s=setTimeout(function(){e.publish({event:h.prototype.getHoldEvent(),data:new h.EventData(t)}),s=void 0},300)},y=function(){s&&(clearTimeout(s),s=void 0)},P=function(t){N(t)>1?d():b(t)?d():p=setTimeout(function(){e.publish({event:h.prototype.getLongHoldEvent(),data:new h.EventData(t)}),p=void 0},600)},S=function(){p&&(clearTimeout(p),p=void 0)},E=function(t){l=setTimeout(function(){e.publish({event:h.prototype.getClickEvent(),data:new h.EventData(t)}),l=void 0,d()},300)},A=function(){c=setTimeout(function(){c=void 0,d()},300)},V=function(){l&&(clearTimeout(l),l=void 0)},C=function(){u=Date.now()},D=function(){u&&(clearTimeout(u),u=void 0)},M=function(){c&&(clearTimeout(c),c=void 0)},N=function(e){var t=0,i=e.gesture.events[0];return i&&i.event&&i.event.touches&&(t=i.event.touches.length),t},b=function(e){if(n=navigator.userAgent,!new RegExp("Mobile").test(n)){var t=e.gesture.events[0];if(t&&t.event&&t.event.touches){var i=t.event.touches[0];if(i.radiusX>30||i.radiusY>30)return!0}}var n;return!1};return h.EventData=function(e){this.name=e.gesture.name,this.position=e.from[0].getCurrentPosition(i),this.isTouch=N(e)>0},h.Down=1,h.Click=2,h}();return UWA.namespace("DS/CAT3DWVisu/CAT3DWVisuEvents",i)}),define("DS/CAT3DWVisu/CAT3DWThreeJsExtender",["DS/Visualization/ThreeJS_DS","DS/CAT3DWInfraUI/CAT3DWCanvasServices","UWA/Core"],function(e,t,i){"use strict";var n;e.ImageUtils.createTexture3DWhiteboard=function(i,n){var o,r,a=(new t).createCanvas({width:16,height:16,tag:"3DWBTextureCanvas"}),s=new e.Texture(a,void 0);return s.needsUpdate=!0,!n||this.is_pow2(i.width)&&this.is_pow2(i.height)?s.image=i:(o=this.nearest_pow2(i.width),r=this.nearest_pow2(i.height),s.image.originalWidth=i.width,s.image.originalHeight=i.height,s.image.width=o,s.image.height=r,s.image.getContext("2d").drawImage(i,0,0,o,r)),s},e.ImageUtils.loadTexture3DWhiteboard=function(n,o,r,a,s,p,l,u){var c=(new t).createCanvas({width:16,height:16,tag:"3DWBLoadTextureCanvas"}),h=u;h?(h.image=c,h.mapping=o):h=new e.Texture(c,o),h.loadEndStatus=e.AssetLoadingStatus.LOADING;var d=null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent),g=!n.startsWith("data:");if(d&&g&&(void 0===s||!1===s)){var f={headers:{},method:"GET",authentication:"ajax",timeout:36e5,async:!0,type:"blob",onComplete:t=>{var i=URL.createObjectURL(t),n=new Image,o=new e.ImageLoader;o.addEventListener("load",()=>{var t,i;h.needsUpdate=!0,h.loadEndStatus=e.AssetLoadingStatus.READY,!p||this.is_pow2(n.width)&&this.is_pow2(n.height)?(h.image=n,h.image.originalWidth=n.width,h.image.originalHeight=n.height):(t=this.nearest_pow2(n.width),i=this.nearest_pow2(n.height),h.image.originalWidth=n.width,h.image.originalHeight=n.height,h.image.width=t,h.image.height=i,h.image.getContext("2d").drawImage(n,0,0,t,i)),r&&r(h);for(var o=0;o<h.onLoadCallbacks.length;o++)h.onLoadCallbacks[o](h)}),o.addEventListener("error",t=>{a&&a(t.message),h.loadEndStatus=e.AssetLoadingStatus.ERROR}),o.load(i,n)},onFailure:t=>{a&&a(t.message),h.loadEndStatus=e.AssetLoadingStatus.ERROR},onTimeout:t=>{a&&a(t.message),h.loadEndStatus=e.AssetLoadingStatus.ERROR}};i.Data.request(n,f)}else{var m=new Image;null!==s&&(m.crossOrigin=s?"use-credentials":"anonymous");var _=new e.ImageLoader;_.addEventListener("load",()=>{var t,i;h.needsUpdate=!0,h.loadEndStatus=e.AssetLoadingStatus.READY,!p||this.is_pow2(m.width)&&this.is_pow2(m.height)?(h.image=m,h.image.originalWidth=m.width,h.image.originalHeight=m.height):(t=this.nearest_pow2(m.width),i=this.nearest_pow2(m.height),h.image.originalWidth=m.width,h.image.originalHeight=m.height,h.image.width=t,h.image.height=i,h.image.getContext("2d").drawImage(m,0,0,t,i)),r&&r(h);for(var n=0;n<h.onLoadCallbacks.length;n++)h.onLoadCallbacks[n](h)}),_.addEventListener("error",t=>{a&&a(t.message),h.loadEndStatus=e.AssetLoadingStatus.ERROR}),m.crossOrigin&&(_.crossOrigin=m.crossOrigin),l?(h.loadEndStatus=e.AssetLoadingStatus.PAUSED,h.onRequest=function(){h.loadEndStatus=e.AssetLoadingStatus.LOADING,_.load(n,m),h.onRequest=null}):_.load(n,m),h.sourceFile=n}return h},e.Quaternion.prototype.setFromUnitVectors?console.error("No need to overload THREE.Quaternion.prototype.setFromUnitVectors anymore"):e.Quaternion.prototype.setFromUnitVectors=(n=new e.Vector3,function(e,t){return this.w=1+e.dot(t),this.w<1e-6?(this.w=0,Math.abs(e.x)>Math.abs(e.z)?(this.x=-e.y,this.y=e.x,this.z=0):(this.x=0,this.y=-e.z,this.z=e.y)):(n.crossVectors(e,t),this.x=n.x,this.y=n.y,this.z=n.z),this.normalize()}),e.Quaternion.prototype.angleTo?console.error("No need to overload THREE.Quaternion.prototype.setFromUnitVectors anymore"):e.Quaternion.prototype.angleTo=function(e){return 2*Math.acos((t=this.dot(e),i=-1,n=1,Math.max(i,Math.min(n,t))));var t,i,n},e.Matrix4.prototype.toArray?console.error("No need to overload THREE.Matrix4.prototype.toArray anymore"):e.Matrix4.prototype.toArray=function(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e},e.Matrix4.prototype.fromArray?console.error("No need to overload THREE.Matrix4.prototype.fromArray anymore"):e.Matrix4.prototype.fromArray=function(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}}),define("DS/CAT3DWVisu/CAT3DWVisuServices",["DS/ApplicationFrame/FrameWindowsManager","DS/CAT3DWInfra/CAT3DWLogger","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/CAT3DWVisu/CAT3DWDataFactory","DS/CAT3DWVisu/CAT3DWViewSettings","DS/Visualization/ThreeJS_DS","DS/VisuEvents/ScreenEvent","WebappsUtils/WebappsUtils","UWA/Class","UWA/Core"],function(e,t,i,n,o,r,a,s,p,l){"use strict";var u=null,c=p.extend({isRayCrossingNode:function(e,t){var i=!1;if(e.from){var n=e.from.externalPath;if(n)for(var o=n.length-1;!i&&o>=0;o--)n[o].name===t&&(i=!0)}return i},isPathElemCrossingNode:function(e,t){var i=!1;if(e){var n=e.externalPath;if(n)for(var o=n.length-1;!i&&o>=0;o--)n[o].name===t&&(i=!0)}return i},pick:function(t,i,n){var o=null,r=e.getFrameWindow().getViewer();if(r){var a=r.getMousePosition(t);o=r.pick(a,i,n)}return o},computePickingDataFromScreenEvent:function(t){var i=null;if(t instanceof a){var o=e.getFrameWindow().getViewer().canvas,s=t.getCurrentPosition(o),p=this.pick(s,"primHybrid",!0);(i=(new n).createPickingData())&&(i.visuEventData=t,i.path=p.path&&p.path.length?p.path[0]:null,i.position=p.position,i.normal=p.normal,i.tangent=p.tangent,i.uv=p.uv,i.ray=p.ray,i.position&&i.normal&&(i.plane=(new r.Plane).setFromNormalAndCoplanarPoint(p.normal,p.position)))}return i},computePickingDataFromOldVisuEvent:function(e){var t=null;e&&((t=(new n).createPickingData()).visuEventData=e,t.path=e.path,t.position=e.point,t.normal=e.normal,t.tangent=e.tangent,t.uv=e.uv,t.ray=e.ray,e.position&&e.normal&&(t.plane=(new r.Plane).setFromNormalAndCoplanarPoint(e.normal,e.position)));return t},computePickingDataFromEvent:function(e){var t=null,i=!1;if(e){if(e.from){var n=e.from[0];n instanceof a&&(i=!0,t=this.computePickingDataFromScreenEvent(n))}i||(t=this.computePickingDataFromOldVisuEvent(e))}return t},getMousePositionFromEvent:function(e,t){if(e&&e.from){var i=e.from[0];if(i instanceof a)return i.getCurrentPosition(t.canvas)}},computeBoundingBox:function(e){if(!e)return null;var t,i,n,o=e.getLastElement().sgNode,r=o.count,a=o.start,s=o.group.geometry,p=s.vertexIndexArray,l=s.vertexPositionArray,u=3*p[a],c=[];c[0]=l[u],c[1]=l[u+1],c[2]=l[u+2],c[3]=c[0],c[4]=c[1],c[5]=c[2];for(var h=1;h<r;h++)t=l[u=3*p[a+h]],i=l[u+1],n=l[u+2],t<c[0]?c[0]=t:t>c[3]&&(c[3]=t),i<c[1]?c[1]=i:i>c[4]&&(c[4]=i),n<c[2]?c[2]=n:n>c[5]&&(c[5]=n);return c}}),h=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60,performance.now())};c.requestAnimationFrame=function(e){return h(e)};var d=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(e){window.clearTimeout(e)};c.cancelAnimationFrame=function(e){d(e)},c.getGrid=function(){return e.getFrameWindow().getViewer()?e.getFrameWindow().getViewer():null},c.getViewpoint=function(){return e.getFrameWindow().getViewpoint()?e.getFrameWindow().getViewpoint():null};var g=function(e,t=!1,i=1){const n={color:e,force:!0,transparent:i<1,opacity:i,lineWidth:2};t&&(n.dashPattern=[1.5,1.5]);var o=new r.LineBasicMaterial(n);return o.depthTest=!0,o.depthWrite=!1,o.polite=!0,o.politeMaterial=o.clone(),o.politeMaterial.opacity=.15,o.politeMaterial.depthTest=!1,o.politeMaterial.depthWrite=!1,o};c.getSelectionMaterial=function(){return g(o.getSelectionColor())},c.getCoselectionMaterial=function(){return g(o.getCoselectionColor(),!0)},c.getCustomMaterial=function(e,t=!1,i=1){return g(e,t,i)},c.MATERIAL_TYPE={SELECTION:1,COSELECTION:2,CUSTOM:7},Object.freeze(c.MATERIAL_TYPE),c.getPlaceholderTexture=function(){if(u)return u;let e=s.getWebappsAssetUrl("CAT3DWInfra","placeholders/xl_thumb_waiting_processing.png");return"MOBILE"===window.ds.env&&(e=l.Data.proxifyUrl(e,{proxy:"passport"})),u=r.ImageUtils.loadTexture(e,void 0,null,()=>{t.error("Couldn't load placeholder texture ")},!1)},c.getBestVectorDirection=function(e,t){var i=c.getViewpoint();if(!i)return null;var n=t.clone(),o=(new r.Vector3).subVectors(i.getEyePosition(),e);return n.dot(o)<0&&n.negate(),n},c.getMaxWidthValueAtPoint=function(e){var t=c.getViewpoint();return t?new f(t).getMaxWidthValueAtPoint(e):0},c.getMaxHeightValueAtPoint=function(e){var t=c.getViewpoint();return t?new f(t).getMaxHeightValueAtPoint(e):0},c.getDefaultTranslationValue=function(e,t){var i=c.getViewpoint();return i?new f(i).getDefaultTranslationValue(e,t):0},c.compute2DPointFrom3DPoint=function(t,i){i||(i=e.getFrameWindow().getViewer());var n=i.currentViewpoint.project(t);return new r.Vector2(n.x,n.y)},c.compute3DPointFrom2DPoint=function(t,i,n){return n||(n=e.getFrameWindow().getViewer()),n.currentViewpoint.create3DRayFrom2DPoint(new r.Vector3(t.x,t.y,0),n.currentViewpoint.camera).intersectPlane(i)},c.reframe=function(t,n,o,a,s){var p,l,u,c,h,d=o||null,g=t||0;if(p=s||e.getFrameWindow().getViewer(),"whiteboard"===i.getPreferenceValue("appMode")){if(a){l=a.getCenter();let e=a.getCorners();c=Math.max(e.topRight.x,e.topLeft.x,e.bottomRight.x,e.bottomLeft.x)-Math.min(e.topRight.x,e.topLeft.x,e.bottomRight.x,e.bottomLeft.x),h=Math.max(e.topRight.y,e.topLeft.y,e.bottomRight.y,e.bottomLeft.y)-Math.min(e.topRight.y,e.topLeft.y,e.bottomRight.y,e.bottomLeft.y)}else{let e=p.getRootNode().getBoundingBox();if("perspective"===n)l=p.getRootNode().getBoundingSphere().center;else{let t=e.max.clone().sub(e.min);l=e.min.clone().add(t.multiplyScalar(.5))}c=e.max.x-e.min.x,h=e.max.y-e.min.y}if("perspective"===n)u=2*p.getRootNode().getBoundingSphere().radius;else{var f=p.currentViewpoint.getCamera().aspect;u=Math.max(c,h/f)}0===u&&(u=200);let e=new r.Sphere(l,u/2);p.currentViewpoint.reframe(d,g,e)}else if(a){l=a.getCenter();let e=a.getCorners();c=Math.max(e.topRight.x,e.topLeft.x,e.bottomRight.x,e.bottomLeft.x)-Math.min(e.topRight.x,e.topLeft.x,e.bottomRight.x,e.bottomLeft.x),h=Math.max(e.topRight.y,e.topLeft.y,e.bottomRight.y,e.bottomLeft.y)-Math.min(e.topRight.y,e.topLeft.y,e.bottomRight.y,e.bottomLeft.y);let t=Math.max(e.topRight.z,e.topLeft.z,e.bottomRight.z,e.bottomLeft.z)-Math.min(e.topRight.z,e.topLeft.z,e.bottomRight.z,e.bottomLeft.z);0===(u=Math.max(c,h,t))&&(u=200);let i=new r.Sphere(l,u/2);p.currentViewpoint.reframe(d,g,i)}else p.currentViewpoint.reframe(d,g)},c.reframeOnSceneObject=function(e,t){c.reframe(t,null,null,e)},c.reframeOnObjects=function(t,n){var o=n||0,a=e.getFrameWindow().getViewer();if("whiteboard"===i.getPreferenceValue("appMode")){for(var s=[],p=0;p<t.length;p++){var l=t[p].getCorners();s.push(l.topLeft),s.push(l.bottomLeft),s.push(l.bottomRight),s.push(l.topRight)}for(var u=s[0].z,c=[],h=[],d=0;d<s.length;++d)c.push(s[d].x),h.push(s[d].y);c.sort(function(e,t){return e-t}),h.sort(function(e,t){return e-t});var g=c.length-1;let e=new r.Vector3((c[0]+c[g])/2,(h[0]+h[g])/2,u),i=a.currentViewpoint.getCamera().aspect,n=Math.abs(c[g]-c[0]),f=Math.abs(h[g]-h[0]),m=Math.max(n,f/i);0===m&&(m=200);let _=new r.Sphere(e,m/2);a.currentViewpoint.reframe(null,o,_)}else a.currentViewpoint.reframe(null,o)};var f=function(e){var t=e.getSightDirection(),i=e.getUpDirection(),n=(new r.Vector3).crossVectors(t,i).normalize();this.rotationMatrix=new r.Matrix4,this.rotationMatrix.set(n.x,n.y,n.z,0,t.x,t.y,t.z,0,i.x,i.y,i.z,0,0,0,0,1),this.invRotationMatrix=(new r.Matrix4).getInverse(this.rotationMatrix),this.translationVector=e.getEyePosition().clone().negate(),this.near=e.camera.near,this.far=e.camera.far;var o=.5*Math.PI/180,a=Math.tan(e.camera.fov*o),s=a*this.near,p=e.camera.aspect*s;this.cameraPos=e.getEyePosition();var l=this.cameraPos.clone().add(t.clone().multiplyScalar(this.near));this.vUp=l.clone().add(i.clone().multiplyScalar(s)).sub(this.cameraPos).normalize(),this.vUp=this._getVectorInViewpointRef(this.vUp),this.vRight=l.clone().add(n.clone().multiplyScalar(p)).sub(this.cameraPos).normalize(),this.vRight=this._getVectorInViewpointRef(this.vRight),this.u=new r.Vector3(1,0,0),this.v=new r.Vector3(0,1,0),this.w=new r.Vector3(0,0,1),this.maxHeight=a*this.far,this.maxWidth=e.camera.aspect*this.maxHeight};return f.prototype.getMaxHeightValueAtPoint=function(e){return(new r.Vector3).subVectors(this.cameraPos,e).length()/this.far*this.maxHeight},f.prototype.getMaxWidthValueAtPoint=function(e){return(new r.Vector3).subVectors(this.cameraPos,e).length()/this.far*this.maxWidth},f.prototype.getDefaultTranslationValue=function(e,t){var i=this._getVectorInViewpointRef(t);if(i.normalize(),Math.abs(i.y)>.9)return 0;var n=this._getPointInViewpointRef(e);if(!this._isPointVisible(n))return 0;var o=(new r.Plane).setFromNormalAndCoplanarPoint(this.v,n),a=new r.Ray(new r.Vector3,this.vUp),s=a.intersectPlane(o),p=.2*s.z,l=.05*s.z,u=(s.z-n.z)/s.z,c=(u=u>1?1:u)*p,h=!1;c<l&&(c=l,h=!0),(c=Math.floor(c))<1&&(c=1,h=!0),o=(new r.Plane).setFromNormalAndCoplanarPoint(this.v,n);var d=(a=new r.Ray(new r.Vector3,this.vRight)).intersectPlane(o);p=.2*d.z,l=.05*d.z;var g=(u=(u=(d.z-n.z)/d.z)>1?1:u)*p;if(g<l&&(g=l,h=!0),(g=Math.floor(g))<1&&(g=1,h=!0),c=Math.max(c,g),h){var f=n.clone().add(i.multiplyScalar(c));if(!this._isPointVisible(f))return 0}return c},f.prototype._isPointVisible=function(e){if(e.y<=this.near||e.y>=this.far)return!1;var t=e.clone().normalize();return!(Math.abs(t.dot(this.w))>Math.abs(this.vUp.dot(this.w)))&&!(Math.abs(t.dot(this.u))>Math.abs(this.vRight.dot(this.u)))},f.prototype._getVectorInViewpointRef=function(e){var t=e.clone();return t.applyMatrix4(this.rotationMatrix),t},f.prototype._getVectorInWorldRef=function(e){var t=e.clone();return t.applyMatrix4(this.invRotationMatrix),t},f.prototype._getPointInViewpointRef=function(e){var t=e.clone();return t.add(this.translationVector),t.applyMatrix4(this.rotationMatrix),t},f.prototype._getPointInWorldRef=function(e){var t=e.clone();return t.applyMatrix4(this.invRotationMatrix),t.sub(this.translationVector),t},l.namespace("DS/CAT3DWVisu/CAT3DWVisuServices",c)}),define("DS/CAT3DWVisu/CAT3DWDrawPlaneServices",["DS/CAT3DWVisu/CAT3DWSession","DS/CAT3DWVisu/CAT3DWTolerance","DS/Visualization/ThreeJS_DS"],function(e,t,i){"use strict";var n=function(){};return n._u=new i.Vector3(1,0,0),n._v=new i.Vector3(0,1,0),n._w=new i.Vector3(0,0,1),n.getMostSeenVecticalPlane=function(e,t){if(!t||!t.getSightDirection)return null;var o=null,r=t.getSightDirection(),a=Math.abs(n._u.dot(r)),s=Math.abs(n._v.dot(r));return s&&(!a||a<s)?(o=new i.Plane).setFromNormalAndCoplanarPoint(n._v,e):a&&(o=new i.Plane).setFromNormalAndCoplanarPoint(n._u,e),o},n.getMostSeenPlane=function(e,t,o){var r=new i.Ray(o.getEyePosition(),o.getSightDirection()),a=r.intersectPlane(e),s=r.intersectPlane(t),p=void 0!==a&&n.isInFront(a,r,o.getEyePosition()),l=void 0!==s&&n.isInFront(s,r,o.getEyePosition());if(p){if(l){var u=e.normal.dot(o.getSightDirection()),c=t.normal.dot(o.getSightDirection());return Math.abs(u)>=Math.abs(c)?e:t}return e}return l?t:null},n.isInFront=function(e,t,n){var o=new i.Vector3,r=n||t.origin;return o.subVectors(e,r).normalize(),o.dot(t.direction)>0},n.computeBestDrawPlane=function(o,r,a,s){if(!(o&&o instanceof i.Vector3&&r&&r instanceof i.Vector3))return null;var p=new i.Vector3;if(p.subVectors(r,o),p.normalize(),s&&Math.abs(p.dot(s.normal))<t.tolerance)return s;var l=e.getDrawingPlane();if(l&&l.plane&&Math.abs(p.dot(l.plane.normal))<t.tolerance)return l.plane;var u=null,c=p.dot(n._w),h=new i.Vector3;return h.crossVectors(p,n._w),Math.abs(c)<t.tolerance?((u=new i.Plane).setFromNormalAndCoplanarPoint(n._w,o),u.projectPoint(r),u):h.length()<t.tolerance?(u=n.getMostSeenVecticalPlane(o,a))?(u.projectPoint(r),u):void 0:(u=new i.Plane,h.normalize(),u.setFromNormalAndCoplanarPoint(h,o),u)},n.getDrawPlaneFrom3Points=function(e,t,n){return(new i.Plane).setFromCoplanarPoints(e,t,n)},n.getDrawPlaneFrom2Points=function(e,o){var r=(new i.Vector3).subVectors(o,e).normalize(),a=n._w,s=a.dot(r);s*s<t.squareTolerance&&(a=n._u);var p=(new i.Vector3).crossVectors(a,r).normalize(),l=r.clone().cross(p);return(new i.Plane).setFromNormalAndCoplanarPoint(l,e)},n}),define("DS/CAT3DWVisu/CAT3DWWorkingPlane",["DS/CAT3DWVisu/CAT3DWDataFactory","DS/CAT3DWVisu/CAT3DWDrawPlaneServices","DS/CAT3DWVisu/CAT3DWTolerance","DS/Visualization/ThreeJS_DS","UWA/Class"],function(e,t,i,n,o){"use strict";var r=o.extend({init:function(e){this._bSnapOnGrid=!0,this._viewer=e,this._chosenImpl=r.ImplEnum.FREE,this._impl=new r._implementations[this._chosenImpl](this._viewer,this._bSnapOnGrid),this._impl.set()},setMode:function(e,t){this._chosenImpl!==e&&(this._chosenImpl=e,this._impl=new r._implementations[e](this._viewer,this._bSnapOnGrid)),this._impl.set(t)},getMode:function(){return this._chosenImpl},reset:function(){this._impl.reset()},pick:function(e){return this._impl.pick(e)},setSnapOnGridValues:function(e){this._bSnapOnGrid=e,this._impl.setSnapOnGridValues(this._bSnapOnGrid)},setCustomSnappingAlgo:function(e){this._impl.setCustomSnappingAlgo(e)},removeCustomSnappingAlgo:function(){this._impl.removeCustomSnappingAlgo()},getPlane:function(){return this._impl.getPlane()}});r._floorPlane=new n.Plane(new n.Vector3(0,0,1)),r.ImplEnum=Object.freeze({FREE:0,LOCKEDPLANE:1}),r._implementations=[];var a=o.extend({init:function(e,t){this._wOffset=e.internalSceneGraph.getSceneMin(),null===this._wOffset&&(this._wOffset=0),this._uNormal=new n.Vector3(1,0,0),this._vNormal=new n.Vector3(0,1,0),this._wNormal=new n.Vector3(0,0,1),this._uPlane=new n.Plane(this._uNormal),this._vPlane=new n.Plane(this._vNormal),this._wPlane=new n.Plane(this._wNormal,-this._wOffset),this._plane=this._wPlane,this._floor=null,this._viewpoint=null,this._gridSnapAlgo=function(){},this._customSnapAlgo=null,this.setSnapOnGridValues(t)},reset:function(){this._plane=r._floorPlane,this._floor=null,this._customSnapAlgo=null},setSnapOnGridValues:function(e){this._gridSnapAlgo=e?this._snapOnGrid:function(){}},setCustomSnappingAlgo:function(e){this._customSnapAlgo=e},removeCustomSnappingAlgo:function(){this._customSnapAlgo=null},_snapOnGrid:function(e){if(e.point.position&&e.plane){var t=null;this._customSnapAlgo&&(t=this._customSnapAlgo(e)),t||(t=this._snapOnTheFloor(e)),t||(t=this._snapOnGridValues(e)),t&&(e.point.position=t)}},_snapOnTheFloor:function(e){var t=null,i=.25*this._floor.getGridUnit();if(Math.abs(e.point.position.z)<i&&!l(e.plane.normal.z,1)&&!l(e.point.position.z,this._wOffset)){var o=new n.Vector3(e.point.position.x,e.point.position.y,this._wOffset),a=(new n.Vector3).subVectors(o,e.point.position).normalize();a.projectOnPlane(e.plane.normal),a.normalize();var s=new n.Ray(e.point.position,a).intersectPlane(r._floorPlane);if(void 0!==s)if(s.distanceTo(e.point.position)<i){var p=.5*this._floor.getGridUnit(),u=Math.floor(s.x/p)*p,c=Math.floor(s.y/p)*p,h=u+p,d=c+p,g=(new n.Vector3).crossVectors(e.plane.normal,new n.Vector3(0,0,1)).normalize(),f=[],m=0;if(l(g.x,0))l(g.y,0)||(f[m++]=new n.Vector3(s.x,c,this._wOffset),f[m++]=new n.Vector3(s.x,d,this._wOffset));else if(l(g.y,0))f[m++]=new n.Vector3(u,s.y,this._wOffset),f[m++]=new n.Vector3(h,s.y,this._wOffset);else{var _=g.x/g.y,w=s.y-_*s.x,v=_*u+w;v>=c&&v<=d&&(f[m++]=new n.Vector3(u,v,this._wOffset)),(v=_*h+w)>=c&&v<=d&&(f[m++]=new n.Vector3(h,v,this._wOffset));var T=(_=g.y/g.x)*c+(w=s.x-_*s.y);T>u&&T<h&&(f[m++]=new n.Vector3(T,c,this._wOffset)),(T=_*d+w)>u&&T<h&&(f[m++]=new n.Vector3(T,d,this._wOffset))}t=f[0];for(var y=s.distanceTo(f[0]),P=f.length,S=1;S<P;S++)y>s.distanceTo(f[S])&&(t=f[S]);t.z=this._wOffset}}return t},_snapOnGridValues:function(e){if(e.point.position&&e.plane){var t=e.plane.normal,i=Math.abs(this._uNormal.dot(t)),n=Math.abs(this._vNormal.dot(t)),o=Math.abs(this._wNormal.dot(t));return i<n?n<o?this._snapOnWGrid(e):this._snapOnVGrid(e):i<o?this._snapOnWGrid(e):this._snapOnUGrid(e)}},_snapOnUGrid:function(e){e.point.position=this._uPlane.projectPoint(e.point.position);var t=.5*this._floor.getGridUnit(),i=Math.round(e.point.position.y/t)*t,o=Math.round(e.point.position.z/t)*t,r=new n.Vector3(e.point.position.x,i,o);return new n.Ray(r,this._uNormal).intersectPlane(e.plane)},_snapOnVGrid:function(e){e.point.position=this._vPlane.projectPoint(e.point.position);var t=.5*this._floor.getGridUnit(),i=Math.round(e.point.position.x/t)*t,o=Math.round(e.point.position.z/t)*t,r=new n.Vector3(i,e.point.position.y,o);return new n.Ray(r,this._vNormal).intersectPlane(e.plane)},_snapOnWGrid:function(e){e.point.position=this._wPlane.projectPoint(e.point.position);var t=.5*this._floor.getGridUnit(),i=Math.round(e.point.position.x/t)*t,o=Math.round(e.point.position.y/t)*t,r=new n.Vector3(i,o,e.point.position.z);return new n.Ray(r,this._wNormal).intersectPlane(e.plane)}});function s(t,i,n,o){return t.path=i.path,t.ray=i.ray,t.plane=o?o.clone():null,t.point.position=n,t.point.supportType=e.SupportTypes.WORKING_PLANE,t.point.supportData=null,t}function p(e,t,i,n){var o=i.getEyePosition(),r=t.projectPoint(o);return e.distanceTo(r)<.25*n}function l(e,t){return(i=Math.abs(e)-Math.abs(t))*i<u;var i}r._implementations[r.ImplEnum.FREE]=a.extend({init:function(e,t){this._parent(e,t),this._point1=null,this._point2=null,this._plane1=null,this._plane2=null,this._pickingAlgo=this._algo0or1Point},set:function(e){if(this.reset(),e&&(e.viewpoint&&e.viewpoint.getEyePosition&&e.viewpoint.getSightDirection&&(this._viewpoint=e.viewpoint),e.floor&&e.floor.planeSize&&"number"==typeof e.floor.planeSize&&void 0!==e.floor.getGridUnit&&(this._floor=e.floor),e.point1&&e.point1 instanceof n.Vector3&&(this._point1=(new n.Vector3).copy(e.point1),this._uPlane.setFromNormalAndCoplanarPoint(this._uNormal,this._point1),this._vPlane.setFromNormalAndCoplanarPoint(this._vNormal,this._point1),l(this._point1.z,this._wOffset)||(this._pickingAlgo=this._algoVerticalOnly),e.point2&&e.point2 instanceof n.Vector3&&this._viewpoint&&(this._point2=(new n.Vector3).copy(e.point2),this._plane1=t.computeBestDrawPlane(this._point1,this._point2,this._viewpoint),this._plane1)))){var i=(new n.Vector3).subVectors(this._point2,this._point1).normalize(),o=this._plane1.normal,r=(new n.Vector3).crossVectors(i,o).normalize();this._plane2=(new n.Plane).setFromNormalAndCoplanarPoint(r,this._point1),this._pickingAlgo=this._algo2Points}},reset:function(){this._parent(),this._viewpoint=null,this._uPlane=new n.Plane(this._uNormal),this._vPlane=new n.Plane(this._vNormal),this._point1=null,this._point2=null,this._pickingAlgo=this._algo0or1Point},pick:function(t){this._plane=null;var i=new e.PickingData;return t&&t.ray&&this._floor&&this._viewpoint&&this._pickingAlgo(i,t)&&this._gridSnapAlgo(i),i},_algo0or1Point:function(e,i){var n=i.ray.intersectPlane(this._wPlane);if(n&&t.isInFront(n,i.ray,this._viewpoint.getEyePosition())){if(p(n,this._wPlane,this._viewpoint,this._floor.planeSize))return this._plane=this._wPlane,s(e,i,n,this._plane),!0}else n=null;return!!this._algoVerticalOnly(e,i)||(n?(this._plane=this._wPlane,s(e,i,n,this._plane),!0):(s(e,i,null,null),!1))},_algoVerticalOnly:function(e,i){var n=this._viewpoint.getSightDirection(),o=Math.abs(this._uPlane.normal.dot(n)),r=Math.abs(this._vPlane.normal.dot(n));if(r&&(!o||o<r)){var a=i.ray.intersectPlane(this._vPlane);if(a&&t.isInFront(a,i.ray,this._viewpoint.getEyePosition()))return this._plane=this._vPlane,s(e,i,a,this._plane),!0}else if(o){var p=i.ray.intersectPlane(this._uPlane);if(p&&t.isInFront(p,i.ray,this._viewpoint.getEyePosition()))return this._plane=this._uPlane,s(e,i,p,this._plane),!0}return s(e,i,null,null),!1},_algo2Points:function(e,i){var n=i.ray.intersectPlane(this._plane1);if(n&&t.isInFront(n,i.ray,this._viewpoint.getEyePosition())){if(p(n,this._plane1,this._viewpoint,this._floor.planeSize))return this._plane=this._plane1,s(e,i,n,this._plane),!0}else n=null;var o=i.ray.intersectPlane(this._plane2);return o&&t.isInFront(o,i.ray,this._viewpoint.getEyePosition())?(this._plane=this._plane2,s(e,i,o,this._plane),!0):n?(this._plane=this._plane1,s(e,i,n,this._plane),!0):(s(e,i,null,null),!1)},getPlane:function(){return this._plane.clone()}}),r._implementations[r.ImplEnum.LOCKEDPLANE]=a.extend({init:function(e,t){this._parent(e,t)},set:function(e){this.reset(),e&&(e.viewpoint&&e.viewpoint.getEyePosition&&e.viewpoint.getSightDirection&&(this._viewpoint=e.viewpoint),e.plane&&e.plane instanceof n.Plane?this._plane=new n.Plane(e.plane.normal,e.plane.constant):e.normal&&e.normal instanceof n.Vector3&&(e.point&&e.point instanceof n.Vector3?(this._plane=new n.Plane,this._plane.setFromNormalAndCoplanarPoint(e.normal,e.point)):this._plane=new n.Plane(e.normal)),e.floor&&void 0!==e.floor.getGridUnit&&(this._floor=e.floor))},reset:function(){this._parent()},pick:function(i){var n=new e.PickingData;if(i){var o=i.ray.intersectPlane(this._plane);o&&t.isInFront(o,i.ray,this._viewpoint.getEyePosition())&&(s(n,i,o,this._plane),this._floor&&this._gridSnapAlgo(n))}return n},getPlane:function(){return this._plane.clone()}});var u=i.tolerance*i.tolerance;return r}),define("DS/CAT3DWVisu/CAT3DWWorkingPlaneController",["DS/CAT3DWVisu/CAT3DWWorkingPlane","DS/CAT3DWVisu/CAT3DWSession","DS/CAT3DWVisu/CAT3DWTolerance","DS/CAT3DWVisu/CAT3DWVisuServices","DS/CoreEvents/Events","DS/Visualization/ThreeJS_DS","UWA/Class"],function(e,t,i,n,o,r,a){"use strict";return a.singleton({init:function(){},initialize:function(i,r){this._viewpoint=n.getViewpoint(),this._workingPlane=new e(i),this._isPlaneLocked=!1,this._forcePicking=!1;var a=t.getSnapOnGrid();if(this._workingPlane.setSnapOnGridValues(a),this._snapEventToken=o.subscribe({event:t.getChangeSnapOnGridEvent()},this._onSnapEvent.bind(this),!1),!r){this._planeEventToken=o.subscribe({event:t.getChangeDrawingPlaneEvent()},this._onPlaneEvent.bind(this),!1);var s=t.getDrawingPlane();if(s.plane)return void this.lockPlane(s.plane,!s.isFloor)}this._workingPlane.setMode(e.ImplEnum.FREE,{floor:n.getGrid(),viewpoint:this._viewpoint})},_onSnapEvent:function(e){this._workingPlane.setSnapOnGridValues(e)},_onPlaneEvent:function(e){e&&(e.plane?this.lockPlane(e.plane,!e.isFloor):this.unlockPlane())},pick:function(e){return this._workingPlane.pick(e)},reset:function(){return this._snapEventToken&&(o.unsubscribe(this._snapEventToken),this._snapEventToken=void 0),this._planeEventToken&&(o.unsubscribe(this._planeEventToken),this._planeEventToken=void 0),this._workingPlane.reset()},isPickedPointAuthorized:(s=.1*i.tolerance,s*=s,function(e){if(!this._isPlaneLocked||!this._forcePicking)return!0;var t=this._workingPlane.getPlane();if(t&&e){var i=t.distanceToPoint(e)/this._viewpoint.getEyePosition().distanceTo(e);if(i*i<s)return e=t.projectPoint(e),!0}return!1}),lockPoint:function(t){if(!this._isPlaneLocked&&t&&t instanceof r.Vector3){var i={floor:n.getGrid(),viewpoint:this._viewpoint,point1:t};this._workingPlane.setMode(e.ImplEnum.FREE,i)}},lockSegment:function(t,i){if(!this._isPlaneLocked&&t&&i&&t instanceof r.Vector3&&i instanceof r.Vector3){var o={floor:n.getGrid(),viewpoint:this._viewpoint,point1:t,point2:i};this._workingPlane.setMode(e.ImplEnum.FREE,o)}},unlockPoints:function(){if(!this._isPlaneLocked){var t={floor:n.getGrid(),viewpoint:this._viewpoint};this._workingPlane.setMode(e.ImplEnum.FREE,t)}},lockPlane:function(t,i){if(t){var o={plane:t,floor:n.getGrid(),viewpoint:this._viewpoint};this._isPlaneLocked=!0,this._workingPlane.setMode(e.ImplEnum.LOCKEDPLANE,o)}i?this._forcePicking=!0:!1===i&&(this._forcePicking=!1)},unlockPlane:function(){this._isPlaneLocked=!1,this._forcePicking=!1,this._workingPlane.setMode(e.ImplEnum.FREE,{floor:n.getGrid(),viewpoint:this._viewpoint})},isPlaneLocked:function(){return this._workingPlane.getMode()===e.ImplEnum.LOCKEDPLANE},getLockedPlane:function(){var e=null;return this.isPlaneLocked()&&(e=this._workingPlane.getPlane()),e},setCustomSnappingAlgo:function(e){this._workingPlane.setCustomSnappingAlgo(e)},removeCustomSnappingAlgo:function(){this._workingPlane.removeCustomSnappingAlgo()},setSnapOnGrid:function(e){this._workingPlane.setSnapOnGridValues(e)}});var s}),define("DS/CAT3DWVisu/CAT3DWPickingController",["DS/ApplicationFrame/FrameWindowsManager","DS/CAT3DWVisu/CAT3DWDataFactory","DS/CAT3DWInfra/CAT3DWLogger","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/CAT3DWVisu/CAT3DWVisuServices","DS/CAT3DWVisu/CAT3DWWorkingPlaneController","DS/Visualization/ThreeJS_DS","DS/WebUtils/ContextedSingleton"],function(e,t,i,n,o,r,a,s){"use strict";return function(){var p=null,l=null,u="",c="",h="",d=null,g=null,f=null,m=null,_=null,w="primHybrid",v=4294967295,T=[],y=null,P=null,S=function(e,t){P=n.getPreferenceValue("PickingDebug")||window.CAT3DWPickingDebug?B:H,e&&(u=(m=e).getMagnetsRootName()),t&&(c=t.getImageMagnetsRootName(),_=t)};S.prototype.sceneUINodeName="sceneUINode",S.prototype.pickingAreaRootNodeName="pickingAreaRootNode",S.prototype.annotationGroupNodeName="annotGroupNode",S.prototype.rootImageNodeName="images",S.prototype.rootModelNodeName="model3DNode",S.prototype.rootTextNodeName="texts",S.prototype.rootConnectionNodeName="connections",S.prototype.rootLinksNodeName="links",S.prototype.rootStickersNodeName="stickers",S.prototype.rootComparisonNodeName="comparisons",S.prototype.rootMeasurementNodeName="measurements",S.prototype.init=function(i,n){if(l=e.getFrameWindow().getViewer(),p=new o,v=i||t.SupportTypes.ALL,(f=r).initialize(l,n),m&&m.start(),v&t.SupportTypes.IMAGE_MAGNET&&_){var a=f.getLockedPlane();_.initialize(a)}v&t.SupportTypes.AR_MAGNET&&(h="ARPolylineRootNode"),E(),this.addPickingPriority(t.getLabelOf(t.SupportTypes.PICKING_AREA),Number.MIN_SAFE_INTEGER),this.addPickingPriority(t.getLabelOf(t.SupportTypes.IMAGE),-2),this.addPickingPriority(t.getLabelOf(t.SupportTypes.FACE),0),this.addPickingPriority(t.getLabelOf(t.SupportTypes.IMAGE_MAGNET),1),this.addPickingPriority(t.getLabelOf(t.SupportTypes.AR_LINE_MAGNET),2),this.addPickingPriority(t.getLabelOf(t.SupportTypes.WEB_LINE_MAGNET),3),this.addPickingPriority(t.getLabelOf(t.SupportTypes.LINE_MAGNET),4),this.addPickingPriority(t.getLabelOf(t.SupportTypes.EDGE),5),this.addPickingPriority(t.getLabelOf(t.SupportTypes.ANNOTATION),6),this.addPickingPriority(t.getLabelOf(t.SupportTypes.AR_POINT_MAGNET),7),this.addPickingPriority(t.getLabelOf(t.SupportTypes.WEB_POINT_MAGNET),8),this.addPickingPriority(t.getLabelOf(t.SupportTypes.POINT_MAGNET),9),this.addPickingPriority(t.getLabelOf(t.SupportTypes.VERTEX),10),this.addPickingPriority(t.getLabelOf(t.SupportTypes.PREVIEW_ITEM),11),this.addPickingPriority(t.getLabelOf(t.SupportTypes.CONNECTION),12),this.addPickingPriority(t.getLabelOf(t.SupportTypes.MEASUREMENT),13)},S.prototype.setHybridPicking=function(){w="primHybrid"},S.prototype.setCPUPicking=function(){w="prim"},S.prototype.clear=function(){f&&f.reset(),m&&m.stop(),_&&_.clear(),A(),T=[]},S.prototype.reset=function(){f.reset()},S.prototype.resetHighlights=function(){m&&m.preHandlePickedElement(),_&&_.preHandlePickedElement()},S.prototype.getMagnetsController=function(){var e=null;return m&&(e=m.getMagnetsController()),e},S.prototype.setPickingMask=function(e){v=e},S.prototype.getPickingMask=function(){return v},S.prototype.lockPoint=function(e){f.lockPoint(e),d=e},S.prototype.lockSegment=function(e,t){f.lockSegment(e,t),d=e,g=(new a.Vector3).subVectors(t,e).normalize()},S.prototype.unlockPoints=function(){f.unlockPoints(),d=null,g=null},S.prototype.lockPlane=function(e,t){void 0===t&&(t=!0),f.lockPlane(e,t)},S.prototype.unlockPlane=function(){f.unlockPlane()},S.prototype.isPlaneLocked=function(){return f.isPlaneLocked()},S.prototype.setCustomSnappingAlgo=function(e){f.setCustomSnappingAlgo(e)},S.prototype.removeCustomSnappingAlgo=function(){f.removeCustomSnappingAlgo()},S.prototype.addPickingPriority=function(e,t){T.push({id:e,priority:t}),l.setPickingPriority(T)};var E=function(){l&&(y=l.pickingPriorityMapping)&&(T=y.slice())},A=function(){l&&l.setPickingPriority(y)},V=null;S.prototype.decodeNotification=function(e,t){return V=p.getMousePositionFromEvent(e,l),V=l.getMousePosition(V),P(V,t)},S.prototype.pick=function(e,t,i){return V=l.getMousePosition(e),P(V,t,i)};var C,D,M,N,b,x,k,O,I,R,G,W,L,F,z,U,H=(C=0,D=null,M=0,N=0,b=0,x=!1,k=null,O=new a.Vector3,I=null,R={intersectFaces:!0,intersectEdges:!0,intersectPoints:!0},G=null,W=null,L=null,F=new a.Vector3,z=new a.Plane,U=null,function(e,i,o){if(m&&m.preHandlePickedElement(),_&&_.preHandlePickedElement(),!(D=l.pick(e,o?"prim":w,!0)))return null;if(D.normal&&D.position&&(D.plane=(new a.Plane).setFromNormalAndCoplanarPoint(D.normal,D.position)),U=new t.PickingData,D.path&&D.path[0]){if(x=!1,M=D.path[0],!(N=X(D.path[0])))for(C=1;C<D.path.length;C++)if(D.path[C]&&(b=X(D.path[C]))){(b&t.SupportTypes.GEOMETRY||b&t.SupportTypes.IMAGE)&&(x=!0),M=D.path[C],N=b;break}if("whiteboard"!==n.getPreferenceValue("appMode"))if(N&t.SupportTypes.MAGNET){for(C=1;C<D.path.length;C++)if(D.path[C])if((b=X(D.path[C]))>N)M=D.path[C],N=b,x=!0;else if(b<N&&b&t.SupportTypes.GEOMETRY)break}else if(N&t.SupportTypes.IMAGE||N&t.SupportTypes.ANNOTATION||N&t.SupportTypes.CONNECTION)for(C=1;C<D.path.length;C++)D.path[C]&&(b=X(D.path[C]))>N&&(M=D.path[C],N=b,x=!0);if(x&&(k=M.externalPath[M.externalPath.length-1].mesh3js,O.copy(k.geometry.boundingSphere.center),O.applyMatrix4(k.matrixWorld),R.edgeTolerance=l.currentViewpoint.camera.getWorldSizeFromPixelSize(l.picking.tolerance,O,l.renderer.deviceHeight),R.pointTolerance=R.edgeTolerance,N&t.SupportTypes.GEOMETRY?N===t.SupportTypes.FACE?(R.intersectFaces=!0,R.intersectEdges=!1,R.intersectPoints=!1):N===t.SupportTypes.EDGE?(R.intersectFaces=!1,R.intersectEdges=!0,R.intersectPoints=!1):(R.intersectFaces=!1,R.intersectEdges=!1,R.intersectPoints=!0):N&t.SupportTypes.MAGNET?(R.intersectFaces=!0,R.intersectEdges=!0,R.intersectPoints=!1):(R.intersectFaces=!0,R.intersectEdges=!0,R.intersectPoints=!0),(k=l.castRay(D.ray,M.externalPath[M.externalPath.length-1],"prim",R))&&k.length))for(C=0;C<k.length;C++)if(k[C].pathElement.internalPath[k[C].pathElement.internalPath.length-1].id===M.internalPath[M.internalPath.length-1].id&&k[C].primitive&&(!(I=k[C].primitive.getIdentificationObject())||!I.isTemporary())){D.position=k[C].point,D.tangent=k[C].tangent,k[C].normal&&k[C].point&&(D.plane=(new a.Plane).setFromNormalAndCoplanarPoint(k[C].normal,k[C].point));break}if(N){if(N&t.SupportTypes.GEOMETRY){if(i||f.isPickedPointAuthorized(D.position)){if(U.ray=D.ray,U.path=M,U.plane=D.plane,U.tangent=D.tangent,U.point.position=D.position,U.point.supportData=null,U.point.supportType=N,N===t.SupportTypes.VERTEX)return m.handleVertex(U),U;if(N===t.SupportTypes.EDGE)return m.handleEdge(U),U;if(N===t.SupportTypes.FACE)return m.handleFace(U),U}}else if(N&t.SupportTypes.MAGNET){if((W=M.externalPath[1])&&(W.snapPosition||(W=M.externalPath[2])&&W.snapPosition||(W=null)),W&&(L=W.snapPosition(D.position,d,g),i||f.isPickedPointAuthorized(L)))return U.ray=D.ray,U.path=M,U.plane=D.plane,W.getTangents&&(U.tangents=W.getTangents(L)),U.point.position=L,U.point.supportType=N,U.point.supportData={id:W.name,node:W},m.handleMagnet(U),U}else{if(N&t.SupportTypes.PREVIEW_ITEM)return U.point.supportType=t.SupportTypes.PREVIEW_ITEM,U.point.supportData=null,(W=M.externalPath[1]).isVertexManipulator&&W.getMatrix?(F.getPositionFromMatrix(W.getMatrix()),(i||f.isPickedPointAuthorized(F))&&(U.ray=D.ray,U.path=M,U.plane=D.plane,U.tangent=D.tangent,U.point.position=F.clone(),W.getAllowedForOnDemand()&&(U.point.supportData=W.getID(),m.handleManipulator(U)))):W.isGroupManipulator&&W.getMatrix&&(i||f.isPickedPointAuthorized(D.position))&&(U.ray=D.ray,U.path=M,U.plane=D.plane,U.tangent=D.tangent,U.point.position=D.position.clone()),U;if(N&t.SupportTypes.IMAGE_MAGNET){if(G=M.externalPath[1],W=M.externalPath[2],G&&W&&(F.getPositionFromMatrix(W.getMatrixWorld()),i||f.isPickedPointAuthorized(F)))return z.setFromNormalAndCoplanarPoint(G.imageNormal,F),U.ray=D.ray,U.path=M,U.plane=z.clone(),U.point.position=F.clone(),U.point.supportType=t.SupportTypes.IMAGE_MAGNET,U.point.supportData={type:1},_.handleImageMagnet(U),U}else if(N&t.SupportTypes.IMAGE){if(i||f.isPickedPointAuthorized(D.position))return U.point.supportType=t.SupportTypes.IMAGE,U.point.supportData=null,U.ray=D.ray,U.path=M,U.plane=D.plane,U.tangent=D.tangent,U.point.position=D.position,U}else if(N&t.SupportTypes.ANNOTATION){if(i||f.isPickedPointAuthorized(D.position)){U.point.supportType=t.SupportTypes.ANNOTATION,U.point.supportData=null,U.ray=D.ray,U.path=M,U.tangent=D.tangent,U.point.position=D.position;var r=U.path.externalPath[2].annotID,p=s.get(null,"ANNOTATION_MANAGER"),u=p.getPlaneAndTypeFromAnnotId(r);return u&&(U.plane=u.annotPlane,U.type=u.annotType,U.point.supportData=p.getAnnotationFromAnnotId(r)),U}}else if(N&t.SupportTypes.CONNECTION){if(i||f.isPickedPointAuthorized(D.position))return U.point.supportType=t.SupportTypes.CONNECTION,U.point.supportData=null,U.ray=D.ray,U.path=M,U.tangent=D.tangent,U.point.position=D.position,U}else if(N&t.SupportTypes.MEASUREMENT){if(i||f.isPickedPointAuthorized(D.position))return U.point.supportType=t.SupportTypes.MEASUREMENT,U.point.supportData=null,U.ray=D.ray,U.path=M,U.tangent=D.tangent,U.point.position=D.position,U}else if(N&t.SupportTypes.PICKING_AREA)return U.point.supportType=t.SupportTypes.PICKING_AREA,U.point.supportData=null,W=M.externalPath[1],(i||f.isPickedPointAuthorized(F))&&(U.ray=D.ray,U.path=M,U.plane=D.plane,U.tangent=D.tangent,U.point.position=F.clone()),U}if(N&t.SupportTypes.AR_POINT_MAGNET&&(W=M.externalPath[2].getChildByName("billBoardNode"),(i||f.isPickedPointAuthorized(D.position))&&(U.ray=D.ray,U.path=M,U.plane=D.plane,U.tangent=D.tangent,U.point.position=D.position,U.point.supportData={id:W.parents[0].name,node:W},U.point.supportType=N,N===t.SupportTypes.AR_POINT_MAGNET||N===t.SupportTypes.AR_LINE_MAGNET)))return U}}return v&t.SupportTypes.WORKING_PLANE&&(U=f.pick(D))?U:null}),B=function(e){var n=H(e);if(n&&n.point&&n.point.supportType)switch(n.point.supportType){case t.SupportTypes.VERTEX:i.log("vertex",i.Category.Picking);break;case t.SupportTypes.EDGE:i.log("edge",i.Category.Picking);break;case t.SupportTypes.FACE:i.log("face",i.Category.Picking);break;case t.SupportTypes.POINT_MAGNET:i.log("point magnet",i.Category.Picking);break;case t.SupportTypes.LINE_MAGNET:i.log("line magnet",i.Category.Picking);break;case t.SupportTypes.WEB_POINT_MAGNET:i.log("web point magnet",i.Category.Picking);break;case t.SupportTypes.WEB_LINE_MAGNET:i.log("web line magnet",i.Category.Picking);break;case t.SupportTypes.PREVIEW_ITEM:i.log("preview item",i.Category.Picking);break;case t.SupportTypes.IMAGE_MAGNET:i.log("image magnet",i.Category.Picking);break;case t.SupportTypes.AR_POINT_MAGNET:i.log("ar point magnet",i.Category.Picking);break;case t.SupportTypes.WORKING_PLANE:i.log("working plane",i.Category.Picking);break;case t.SupportTypes.IMAGE:i.log("image",i.Category.Picking);break;case t.SupportTypes.ANNOTATION:i.log("annotation",i.Category.Picking);break;case t.SupportTypes.CONNECTION:i.log("connection",i.Category.Picking);break;case t.SupportTypes.MEASUREMENT:i.log("measurement",i.Category.Picking)}return n},X=function(){var e=0,i="",n=null;return function(o){if(o.internalPath.length>1&&(o.internalPath[1].sgNode.getCgmId?o.internalPath[1].sgNode.getCgmId():o.internalPath[1].sgNode.cgmId)>0){if((n=o.internalPath[1].sgNode.getIdentificationObject())&&!0===n.isTemporary())return t.SupportTypes.NONE;if((e=o.internalPath[1].sgNode.getGroup().glType)>3&&v&t.SupportTypes.FACE)return t.SupportTypes.FACE;if(e>0&&v&t.SupportTypes.EDGE)return t.SupportTypes.EDGE;if(v&t.SupportTypes.VERTEX)return t.SupportTypes.VERTEX}else{if(!(i=o.externalPath[0].name))return"";if(i===u){if(e=o.externalPath[1].getType(),v&e)return e}else if(""===h||i!==h&&"ARShapesNode"!==i){if(i===S.prototype.sceneUINodeName&&v&t.SupportTypes.PREVIEW_ITEM)return t.SupportTypes.PREVIEW_ITEM;if(i===S.prototype.pickingAreaRootNodeName&&v&t.SupportTypes.PICKING_AREA)return t.SupportTypes.PICKING_AREA;if(i===c){if(o.externalPath[1].imageNormal&&v&t.SupportTypes.IMAGE_MAGNET)return t.SupportTypes.IMAGE_MAGNET;if(v&t.SupportTypes.IMAGE)return t.SupportTypes.IMAGE}else if(i===S.prototype.annotationGroupNodeName){if(v&t.SupportTypes.ANNOTATION)return t.SupportTypes.ANNOTATION}else if(i===S.prototype.rootConnectionNodeName){if(v&t.SupportTypes.CONNECTION)return t.SupportTypes.CONNECTION}else if(i===S.prototype.rootMeasurementNodeName){if(v&t.SupportTypes.MEASUREMENT)return t.SupportTypes.MEASUREMENT}else if("planeChoiceNode"===i){if(o.externalPath[2].getType&&(e=o.externalPath[2].getType(),v&e))return e}else if(i===S.prototype.rootImageNodeName||i===S.prototype.rootTextNodeName||i===S.prototype.rootLinksNodeName||i===S.prototype.rootStickersNodeName||i===S.prototype.rootComparisonNodeName){if(v&t.SupportTypes.IMAGE)return t.SupportTypes.IMAGE}else if("model3DNode"===i){if((e=o.externalPath[o.externalPath.length-1].getPrimitive().sgNode.getGroup().glType)>3&&v&t.SupportTypes.FACE)return t.SupportTypes.FACE;if(e>0&&v&t.SupportTypes.EDGE)return t.SupportTypes.EDGE;if(v&t.SupportTypes.VERTEX)return t.SupportTypes.VERTEX}}else if(e=o.externalPath[2].getType(),v&e)return e}return t.SupportTypes.NONE}}();return S}()}),define("DS/CAT3DWVisu/CAT3DWPickingControllerFactory",["UWA/Class","DS/CAT3DWVisu/CAT3DWPickingController"],function(e,t){"use strict";var i=e.singleton({init:function(){},createPickingController:function(e,i){this._pickingController&&(this._pickingController.clear(),this._pickingController=null),this._pickingController=new t(e,i)},clearPickingController:function(){this._pickingController&&(this._pickingController.clear(),this._pickingController=null)},getPickingController:function(){return this._pickingController},getMagnetsController:function(){var e=null;return this._pickingController&&(e=this._pickingController.getMagnetsController()),e},getAnnotationGroupNodeName:function(){return t.prototype.annotationGroupNodeName},getSceneUINodeName:function(){return t.prototype.sceneUINodeName},getRootImageNodeName:function(){return t.prototype.rootImageNodeName},getRootModelNodeName:function(){return t.prototype.rootModelNodeName},getRootTextNodeName:function(){return t.prototype.rootTextNodeName},getRootConnectionNodeName:function(){return t.prototype.rootConnectionNodeName},getRootLinksNodeName:function(){return t.prototype.rootLinksNodeName},getRootStickersNodeName:function(){return t.prototype.rootStickersNodeName},getRootComparisonNodeName:function(){return t.prototype.rootComparisonNodeName},getRootMeasurementNodeName:function(){return t.prototype.rootMeasurementNodeName}});return UWA.namespace("DS/CAT3DWVisu/CAT3DWPickingControllerFactory",i)});