define("DS/VCXWebGUI/VCXUpdateView",["UWA/Class","DS/CoreEvents/Events","DS/Controls/Tab","DS/Windows/Dialog","DS/Controls/Accordeon","DS/WebappsUtils/WebappsUtils","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],function(e,t,n,i,a,r,o){"use strict";return e.singleton({initialize:function(e,n){this._experienceBase=n,this.immersiveFrame=e;var i=this;this.event_VCX_END_LOADING_DONE=t.subscribe({event:"VCX_END_LOADING_DONE"},function(e){i.ShowNotification(),i.addDiv()})},getNameForComponentID:function(e){var t="unknown",n=this._experienceBase.ComponentsMap.GetComponentFromID(e);if(n){var i=n.QueryInterface("VCXIModifiable");if(i){var a=i.GetProperty("Actor.Name");a&&(t=a.GetPropertyValue().GetValue())}}return t},unInit:function(){this._experienceBase=null,this.event_VCX_END_LOADING_DONE&&(t.unsubscribe(this.event_VCX_END_LOADING_DONE),delete this.event_VCX_END_LOADING_DONE),this.removeDiv()},removeDiv:function(){this.DSFontIconPanel&&this.DSFontIconPanel.close(),this.DSFontIconPanel=null},addDiv:function(){if(this.immersiveFrame&&!this.DSFontIconPanel){var e=null,t=this._experienceBase.getManager("VCXExperience");if(t&&(e=t.updateLogData),e&&e.showDialog){var s=new n({displayStyle:"strip"}),l=new UWA.Element("div",{class:"XCTWebUpdateDialogTab"}),c=o["UpdateSummary.MissingAssets"],d=new UWA.Element("div",{class:"VCXMissingAssets"});(w=new UWA.Element("span",{text:c})).inject(d),d.inject(l),(C=new UWA.Element("div",{})).inject(l),C.style.paddingLeft="13px";var u=r.getWebappsAssetUrl("VCXWebTreeGUI","icons/32/I_VCX_SWXUiComponentPart3DShape.png");if(e.deletedOverides)for(var p=0;p<e.deletedOverides.length;p++){var h=e.deletedOverides[p],m=new UWA.Element("div",{class:"linePart"});(M=new UWA.Element("div",{})).style.backgroundImage="url('"+u+"')",M.style.width="22px",M.style.height="22px",M.style.backgroundSize="contain",M.inject(m),(w=new UWA.Element("span",{text:h.instanceName})).style.paddingLeft="10px",w.inject(m),m.inject(C)}s.add({isSelected:!0,label:o["UpdateSummary.Products"],content:l,icon:{iconName:"3dproduct",fontIconFamily:WUXManagedFontIcons.Font3DS}});var g=[];if(e.deletedMaterials)for(p=0;p<e.deletedMaterials.length;p++){h=e.deletedMaterials[p];var C=new UWA.Element("div",{}),v=h.id;if(I=e.impactedComponentsInverted[v]){var _=[];for(var b in I)if(I.hasOwnProperty(b)){var f=new UWA.Element("div",{});f.style.paddingLeft="25px";var S=I[b];for(var V in S)if(S.hasOwnProperty(V)){m=new UWA.Element("div",{class:"linePart"});(M=new UWA.Element("div",{})).style.backgroundImage="url('"+u+"')",M.style.width="22px",M.style.height="22px",M.style.backgroundSize="contain",M.inject(m),(w=new UWA.Element("span",{text:this.getNameForComponentID(V)})).style.paddingLeft="10px",w.inject(m),m.inject(f)}_.push({header:this.getNameForComponentID(b),content:f,icon:{iconName:"camera",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"5x"},expandedFlag:!0})}new a({items:_,style:"simple",exclusive:!1}).inject(C)}g.push({header:h.instanceName,content:C,icon:{iconName:"material",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"5x"},expandedFlag:!0})}var y=new a({items:g,style:"filled-separate",exclusive:!1}),x=new UWA.Element("div",{class:"XCTWebUpdateDialogTab"});d=new UWA.Element("div",{class:"VCXMissingAssets"}),(w=new UWA.Element("span",{text:c})).inject(d),d.inject(x),y.getContent().inject(x),s.add({isSelected:!1,label:o["UpdateSummary.Materials"],content:x,icon:{iconName:"material",fontIconFamily:WUXManagedFontIcons.Font3DS}});var P=[];if(e.deletedAmbiences)for(p=0;p<e.deletedAmbiences.length;p++){h=e.deletedAmbiences[p];(C=new UWA.Element("div",{})).style.paddingLeft="10px";var I;v=h.id;if(I=e.impactedComponentsInverted[v])for(var b in I)if(I.hasOwnProperty(b)){var M,w;m=new UWA.Element("div",{});(M=new UWA.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-camera"})).inject(m),(w=new UWA.Element("span",{text:this.getNameForComponentID(b)})).style.paddingLeft="10px",w.inject(m),m.inject(C)}P.push({header:h.instanceName,content:C,icon:{iconName:"picture",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"5x"},expandedFlag:!0})}var D=new a({items:P,style:"filled-separate",exclusive:!1}),X=new UWA.Element("div",{class:"XCTWebUpdateDialogTab"});d=new UWA.Element("div",{class:"VCXMissingAssets"}),(w=new UWA.Element("span",{text:c})).inject(d),d.inject(X),D.getContent().inject(X),s.add({label:o["UpdateSummary.Ambiences"],content:X,icon:{iconName:"picture",fontIconFamily:WUXManagedFontIcons.Font3DS}}),this.DSFontIconPanel=new i({immersiveFrame:this.immersiveFrame,identifier:"updateSolveIssuesDialog",title:o["UpdateSummary.DialogHeader"],content:s,icon:"update",horizontallyStretchableFlag:!0,verticallyStretchableFlag:!0,minWidth:10,minHeight:10,width:400,height:450}),this.DSFontIconPanel.getContent().addClassName("XCTWebUpdateDialogClass");var T=this,A=function(e){T.DSFontIconPanel.removeEventListener("close",A),T.DSFontIconPanel=null};this.DSFontIconPanel.addEventListener("close",A)}}},ShowNotification:function(){if(this._experienceBase){var e=null,t=this._experienceBase.getManager("VCXExperience");if(t&&(e=t.updateLogData),e){var n="";if(e.newOverides){n="======= NEW OCCURRENCES =======\n\n";for(var i=0;i<e.newOverides.length;i++){n+="=> "+(a=e.newOverides[i]).instanceName+"("+a.referenceName+")\n"}}if(e.deletedOverides){n+="\n======= REMOVED OCCURRENCES =======\n\n";for(i=0;i<e.deletedOverides.length;i++){n+="=> "+(a=e.deletedOverides[i]).instanceName+"("+a.referenceName+")\n"}}if(e.deletedAmbiences){n+="\n======= REMOVED AMBIENCES =======\n\n";for(i=0;i<e.deletedAmbiences.length;i++){n+="=> "+(a=e.deletedAmbiences[i]).instanceName+"("+a.referenceName+")\n"}}if(e.deletedMaterials){n+="\n======= REMOVED MATERIALS =======\n\n";for(i=0;i<e.deletedMaterials.length;i++){var a;n+="=> "+(a=e.deletedMaterials[i]).instanceName+"("+a.referenceName+")\n"}}var r=0;if(e.impactedComponents)for(var s in n+="\n======= IMPACTED COMPONENT =======\n\n",e.impactedComponents)if(e.impactedComponents.hasOwnProperty(s)){r++;var l="",c=this._experienceBase.ComponentsMap.GetComponentFromID(s);if(c){var d=c.QueryInterface("VCXIModifiable");if(d){var u=d.GetProperty("Actor.Name");u&&(l=u.GetPropertyValue().GetValue())}}n+="=> "+s+" ("+l+")\n"}if(e.showDialog){var p=this._experienceBase.getManager("VCXNotificationManager");if(p){var h="";e.newOverides.length>0&&(h+=e.newOverides.length+" "+o["UpdateNotification.ItemsAdded"]+"<br>"),e.deletedOverides.length>0&&(h+=e.deletedOverides.length+" "+o["UpdateNotification.ItemsRemoved"]+"<br>"),e.deletedAmbiences.length>0&&(h+=e.deletedAmbiences.length+" "+o["UpdateNotification.AmbiencesRemoved"]+"<br>"),e.deletedMaterials.length>0&&(h+=e.deletedMaterials.length+" "+o["UpdateNotification.MaterialsRemoved"]+"<br>"),r>0&&(h+=r+" "+o["UpdateNotification.ItemsToUpdates"]+"<br>");var m={level:"info",title:o["UpdateNotification.NotifTitle"],message:h,sticky:!0};p.addNotification(m)}}console.log(n)}}}})}),
/*!
#include "VCXUISequence.h"
  Script: VCXUISequence.js

    This file is part of UWA JS Runtime.

  About: License

    Copyright 2006-2012 Netvibes, a Dassault Systemes company.
    All rights reserved.
*/
define("DS/VCXWebGUI/VCXUISequence",["UWA/Core","UWA/Controls/Accordion","DS/Core/PointerEvents","DS/VCXWebKernel/VCXCmdChangeSelection"],function(e,t,n,i){"use strict";return t.extend({className:"VCXUISequence",defaultOptions:{className:"",title:null,multiSelect:!0,constantItemWidth:!1,contentPosition:"bottom"},init:function(e,t,n){this._parent(n),this.elements.container.addClassName(this.className),this._experience=e,this._panel=t,this.sequenceSelectedItems={},this.sequenceOpenedItems={}},unInitialize:function(){var e=this.elements.items;for(var t in e)e[t].titleDiv&&(e[t].titleDiv.removeEvent(n.POINTERUP),e[t].titleDiv.remove(),e[t].titleDiv=null);this._panel=null,this.sequenceSelectedItems=null,this.sequenceOpenedItems=null,this._experience=null},str2DOMElement:function(e){var t=document.createElement("iframe");t.style.display="none",document.body.appendChild(t),t.contentDocument.open(),t.contentDocument.write(e),t.contentDocument.close();var n=t.contentDocument.body.firstChild;return document.body.removeChild(t),n},addItem:function(t,i){var a=this,r=this.elements,o=r.items=r.items||{},s=r.containers=r.containers||{};this._parent(t,i),s[t]=e.createElement("div",{class:this.className+"-content"}).inject(o[t],"top"===this.options.contentPosition?"top":"bottom"),s[t].parentNode.addClassName("VCXUISequence-item"),i.content&&this.setContent(t,i.content);var l=t+"-title",c=r.items[t].getElementsByClassName(l)[0];r.items[t].removeChild(c);var d=i.text,u=e.createElement("div",{class:"VCXUISequence-title"});r.items[t].appendChild(u);var p=t+"-title "+this.className+"-item-arrow",h=e.createElement("div",{class:p,events:{click:function(e){var n=r.items[t];a._panel.activeSequence(n)}}});u.appendChild(h),r.items[t].titleDiv=e.createElement("span",{class:l+" VCXUISequence-item-title",text:d}),r.items[t].titleDiv.addEvent(n.POINTERUP,function(e){a.sequenceOpenedItem(t)}),u.appendChild(r.items[t].titleDiv);for(var m=[],g=0;g<r.items[t].children.length;g++)m[g]=r.items[t].children[g];r.items[t].removeChild(m[0]),r.items[t].removeChild(m[1]),r.items[t].appendChild(m[1])},deleteItem:function(e){var t=this.elements;t.itemContainer.removeChild(t.itemContainer.childNodes[e]),delete t.containers[e],delete t.items[e]},unset:function(e,t,n){var i=t;t={},i[e]=null,delete i[e];var a=0;for(var r in n&&(a=-1),i)void 0!==i[r]&&(n?a++:a=r,t[a]=i[r]);return t},isSequenceOpened:function(e){return this.sequenceOpenedItems[e]},sequenceOpenedItem:function(e,t){this.setSequenceItemOpenedState(e,!this.isSequenceOpened(e),t)},setSequenceItemOpenedState:function(t,n,i){if(this._experience.getManager("VCXSequenceManager").GetListSequences().length>1||n){var a=this.elements.items[t];i=!e.is(i)||i;var r=a.getElementsByClassName("vcx-controls-thumbnail");if(n&&0===r.length){if(n)if(0===(r=a.getElementsByClassName("vcx-controls-thumbnail")).length){a.addClassName("failOpened",n);setTimeout(function(){a.removeClassName("failOpened",n)},500)}}else this.sequenceOpenedItems[t]!==n&&(a&&a.toggleClassName("opened",n),this.sequenceOpenedItems[t]=n)}},getOpenedItems:function(){var e=[];for(var t in this.sequenceOpenedItems){if(this.sequenceOpenedItems.hasOwnProperty(t))this.sequenceOpenedItems[t]&&e.push(t)}return e},getSelectedItems:function(){var e=[];for(var t in this.sequenceSelectedItems){if(this.sequenceSelectedItems.hasOwnProperty(t))this.sequenceSelectedItems[t]&&e.push(t)}return e},isSequenceSelected:function(e){return this.sequenceSelectedItems[e]},sequenceSelectItem:function(e,t){this.setSequenceItemSelectedState(e,!this.isSequenceSelected(e),t)},setSequenceItemSelectedState:function(t,n,a){var r=this.elements.items[t];if(a=!e.is(a)||a,r||this.sequenceSelectedItems[t]!==n){if(!document._ctrlDown)for(var o in this.sequenceSelectedItems){if(this.sequenceSelectedItems.hasOwnProperty(o))if(this.sequenceSelectedItems[o])this.elements.items[o].toggleClassName("selected",!1),this.sequenceSelectedItems[o]=!1}r.toggleClassName("selected",n),this.sequenceSelectedItems[t]=n;var s=this._experience.getManager("VCXSequenceManager").GetListSequences()[t];if(n){var l=new i(this._experience.getManager("VCXSelectionManager"));document._ctrlDown?l.AddToSelection(s):l.SetSelection(s),this._experience.getManager("VCXCommandManager").Do(l)}else{(l=new i(this._experience.getManager("VCXSelectionManager"))).RemoveFromSelection(s),this._experience.getManager("VCXCommandManager").Do(l)}}},addDragOver:function(e){this._dragOverIndex=e,this.elements.items[e].toggleClassName("dragover",!0)},removeDragOver:function(){void 0!==this._dragOverIndex&&this.elements.items[this._dragOverIndex].toggleClassName("dragover",!1)}})}),define("DS/VCXWebGUI/VCXPropertiesPanelViewV2",["UWA/Class","DS/Windows/Panel","DS/Tweakers/TypeRepresentationFactory","DS/Controls/Button","DS/Controls/Accordeon","DS/WebappsUtils/WebappsUtils","DS/CoreEvents/Events","DS/Core/PointerEvents","DS/Menu/ContextualMenu","DS/VCXGUIInfrastructure/VCXMainPanel","DS/VCXGUIInfrastructure/VCXMainPanelFixed","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],function(e,t,n,i,a,r,o,s,l,c,d,u){"use strict";return e.extend({init:function(e,t){this.factory=new n,this._selectElementMessage=new UWA.Element("div",{html:"",class:"vcxPanelWatermarkContainer"});let i=new UWA.Element("div",{html:"",class:"vcxSelectEltNode vcxSelectEltIcon fonticon fonticon-touch"}),a=new UWA.Element("div",{html:u["VCXProperties.SelectObj"],class:"vcxSelectEltNode vcxSelectEltTxt"});i.inject(this._selectElementMessage),a.inject(this._selectElementMessage);var r={icon:"attributes",currentDockArea:localStorage.getItem("VCXNewFrame")?WUXDockAreaEnum.LeftDockArea:WUXDockAreaEnum.RightDockArea,title:u["VCXProperties.PanelTitle"],recId:"vcx-property-panel",immersiveFrame:e,identifier:"propertiesPanelV2"};localStorage.getItem("VCXNewFrame")?this.uiPanelClass=new d(r,t):this.uiPanelClass=new c(r,t),this.uiPanelClass.setPanelContent(this._selectElementMessage),this.panelContentContainer=new UWA.Element("div",{html:"",class:"vcxPanelContentContainer"}),this.panelContentHeader=new UWA.Element("div",{html:"",class:"vcxPanelContentHeader"}),this.panelContentHeader.inject(this.panelContentContainer),this.panelContentBody=new UWA.Element("div",{html:"",class:"vcxPanelContentBody"}),this.panelContentBody.inject(this.panelContentContainer),this.panelContentFooter=new UWA.Element("div",{html:"",class:"vcxPanelContentFooter"}),this.panelContentFooter.inject(this.panelContentContainer),this._displayedInfo={}},unInitialize:function(){this.factory=null,this._displayedInfo=null,this.uiPanelClass.unInitialize()},rebuildPanelUI:function(e,t){if(!e)return void console.error("no information is given to the UI property panel");this.emptyPanelContent();let n=Object.keys(e);this._groupsAccordeon=new a({items:[],style:"divided",exclusive:!1}),this.panelContentBody.setContent(this._groupsAccordeon),this.fillPanelWithProperties(),n.every(n=>{let i=e[n];return this.createTweakerGroup(i,t),!0}),this._groupsAccordeon.getContent().style.display="flex",this._groupsAccordeon.getContent().style.flexDirection="column",this._groupsAccordeon.getContent().addEventListener("expand",this._expanderExpandCB),this._groupsAccordeon.getContent().addEventListener("collapse",this._expanderCollapseCB)},rebuildHeaderUI:function(e){e},addPropThumbnail:function(e){new UWA.Element("img",{src:e,class:"vcxPropThumbnail"}).inject(this.panelContentHeader)},createTweakerGroup:function(e,t){let n;if(!e)return;this._displayedInfo[e.groupID]={},"boolean"==typeof e.checkbox&&(n=new UWA.Element("div",{class:"vcxPropertyGroupHeader"}),this.factory.generateView(e.checkbox,{typePath:"independantBoolean",onViewCreated:t=>{if(void 0!==t){t.inject(n),t.internalOptions={propName:e.showPropName};let i=e.showPropName+"";i=i.replaceAll(".","-"),t.getContent().addClassName(i),t.getContent().setAttribute("data-rec-id",i+"-toggle"),t.getContent().addEventListener("change",n=>{this.activateDeactivateGroup(t.value,e.name)}),this._displayedInfo[e.groupID][e.showPropName]={},this._displayedInfo[e.groupID][e.showPropName].tweakers=[],this._displayedInfo[e.groupID][e.showPropName].value=e.checkbox,this._displayedInfo[e.groupID][e.showPropName].tweakers.push(t)}else console.error("group switch creation failed")},onFailure:function(e){console.error("failed: ",e)}}));let i=!e.collapsed;void 0!==e.checkbox&&(e.checkbox||(i=!1));let a={header:e.name,customHeader:n,expandedFlag:i},r=new UWA.Element("div",{html:"",class:"vcxPropertiesContainer"});r.style.display="flex",r.style.flexDirection="column",e.arrayProps.every(t=>(this.buildPropertyLine({uiInfo:t},r,this._displayedInfo[e.groupID]),!0)),a.content=r,a.groupID=e.groupID,this._groupsAccordeon.addItem(a);let o=this.getGroupExpander(e.name);o.groupID=e.groupID,o.getContent().style.order=e.order,o.elements.header.setAttribute("data-rec-id",e.groupID.replaceAll(".","-")+"-expander");let s=t;o.disabled=s,void 0!==e.checkbox&&(e.checkbox||this.activateDeactivateGroup(!1,e.name))},getPanelDisplayedInfo:function(){return this._displayedInfo},getGroupExpander:function(e){let t=this._groupsAccordeon.getIndexFrom({header:e});return t<0?null:this._groupsAccordeon.getExpanderFromIndex(t)},activateDeactivateGroup:function(e,t){let n=this.getGroupExpander(t);!1===e?(n.expandedFlag=!1,n.getContent().style.pointerEvents="none",n.elements.headerArrow.style.color="#b1b1b1"):(n.expandedFlag=!0,n.getContent().style.pointerEvents="",n.elements.headerArrow.style.color="")},buildPropertyLine:function(e,t,n){let i=new UWA.Element("div",{class:"vcxPropertyLine",styles:{order:e.uiInfo.order}}),a=(new UWA.Element("div",{html:"",class:"vcxPropertyLineNode vcxPropertyStatusBar"}).inject(i),new UWA.Element("div",{html:e.uiInfo.label,class:"vcxPropertyLineNode vcxPropertyLabel"}));a.title=e.uiInfo.label,e.uiInfo.propSettings&&e.uiInfo.propSettings.displayInHeader?i.inject(this.panelContentHeader):(i.inject(t),a.inject(i)),a.propertyId=e.uiInfo.propertyId,a.addEventListener("click",this.onClickLabel),a.addEventListener("dblclick",this.onDoubleClickLabel);let r=new UWA.Element("div",{html:"",class:"vcxPropertyLineNode vcxPropertyTweaker"}).inject(i);e.container=r;try{this.buildTweaker(e,n)}catch(e){console.warn(e)}},buildTweaker:function(e,t){let n=e.uiInfo,i=e.container,a=n.propertyValue.GetType(),r=n.propertyId,o=r=r.replaceAll(".","-");r=a+" "+r;let s,l,c,d,u,p,h,m,g,C,v={propName:n.propertyId,dataType:a};switch(n.bounds&&(p="slider",c=n.bounds.valueMin,d=n.bounds.valueMax,u=n.bounds.step),n.propSettings&&n.propSettings.displayStyle&&(p=n.propSettings.displayStyle),(n.defined&&n.defined.propertyValue&&!n.defined.propertyValue.GetValue()||n.multipleSelectionUndefined)&&(m=!0),a){case"VCXPropertyValueDocId":l=null,n.disabled?(s="string",v.data="",C=n.propertyValue.GetValue(),n.disabled=!0):(s="blob",C=n.propertyValue.GetValue()),o+="-filepicker";break;case"VCXPropertyValueDate":break;case"VCXPropertyValueColor":s="color",m||(l="#"+n.propertyValue.GetValue().GetColorHexString()),o+="-colorpicker";break;case"VCXPropertyValueFloat":u=u||1,s="float",o+="slider"===p?"-slider":"-spinbox";break;case"VCXPropertyValueInt":s="integer",o+="slider"===p?"-slider":"-spinbox";break;case"VCXPropertyValueHyperlinkId":break;case"VCXPropertyValueBoolean":o+="-checkbox",s="boolean";break;case"VCXPropertyValuePoint2D":s="vector2",g=n.disabled,l=Object.values(n.propertyValue.GetValue()),o+="-vector2";break;case"VCXPropertyValuePoint":s="vector3",g=n.disabled,l=Object.values(n.propertyValue.GetValue()),o+="-vector3";break;case"VCXPropertyValueString":s="string",o+="-textfield";break;case"VCXPropertyValueEnum":if(n.enum){if(l=n.enum[n.enumValue]||n.enumValue,v.mapChoiceEnum=n.mapChoiceEnum,n.propSettings&&n.propSettings.enumInfo){h=[];for(const e in n.mapChoiceEnum)if(n.mapChoiceEnum.hasOwnProperty(e)){const t=n.mapChoiceEnum[e];let i=n.propSettings.enumInfo[e];i?h.push({value:t,icon:{iconName:i.iconName,iconPath:i.iconPath,fontIconFamily:1}}):h.push({value:t})}}else h=Object.values(n.enum);s="string",p="combo",o+="-combobox"}else console.error("Enum ",n.propertyId," didnt have the necessary enum arguments")}t[n.propertyId]||(t[n.propertyId]={},t[n.propertyId].tweakers=[],t[n.propertyId].containerDiv=i),t[n.propertyId].propType=a,t[n.propertyId].enumChoices=n.enum,t[n.propertyId].undefinedDisplayFlag=m,t[n.propertyId].value=C||(void 0!==l?l:n.propertyValue.GetValue());let _=m?void 0:void 0!==l?l:n.propertyValue.GetValue();if(this.factory.generateView(_,{typePath:s,disabled:n.disabled,readOnly:g,minValue:c,maxValue:d,stepValue:u,displayStyle:p,placeholder:n.placeHolder,possibleValues:h,onViewCreated:function(e){void 0!==e?(e.inject(i),e.internalOptions=v,e.getContent().addClassName(r),e.getContent().setAttribute("data-rec-id",o),t[n.propertyId].tweakers.push(e)):console.error("tweaker creation failed")},onFailure:function(e){console.error("failed: ",e)}}),"slider"===p&&this.factory.generateView(_,{typePath:s,disabled:n.disabled,minValue:c,maxValue:d,stepValue:u,onViewCreated:function(e){if(void 0!==e){e.getContent().addClassName("vcxPropertySliderSpinbox"),e.getContent().addClassName(r);let a=n.propertyId;a=r.replaceAll(".","-"),a+="-spinbox",e.getContent().setAttribute("data-rec-id",a),e.inject(i),e.internalOptions=v,t[n.propertyId].tweakers.push(e)}else console.error("tweaker creation failed")},onFailure:function(e){console.error("failed: ",e)}}),n.opacity){let e={container:i,uiInfo:{...n.opacity,disabled:n.disabled}};this.buildTweaker(e,t)}if(n.defined){let e={container:i,uiInfo:{...n.defined,disabled:n.disabled}};this.buildTweaker(e,t)}n.propSettings&&n.propSettings.buttons&&this.createPropSettingsButtons(n.propSettings,t)},updateTweakers:function(e,t,n,i){try{let a=Object.keys(this._displayedInfo);for(let r=0;r<a.length;r++){let o=a[r],s=this._displayedInfo[o][e];if(s){let a=s.tweakers;for(let n=0;n<a.length;n++)if(i)a[n].value=void 0,s.undefinedDisplayFlag=!0;else{if(a[n].possibleValues)if(a[n].possibleValues.includes(t))a[n].value=t;else{let i=s.enumChoices&&s.enumChoices[t];if(i&&a[n].possibleValues.includes(i))a[n].value=i;else{let t=!0;for(let e=0;e<a[n].possibleValues.length;e++){const r=a[n].possibleValues[e];if(i&&r.value===i){a[n].value=i,t=!1;break}}t&&console.error("Error with update of enum for: "+e)}}else a[n].value=t;s.undefinedDisplayFlag=!1}this._displayedInfo[o][e].value=n}}}catch(e){console.error(e)}},getUIGroupsInfo:function(){return this._groupsAccordeon&&[...this._groupsAccordeon._expanderItems]},createPropSettingsButtons:function(e,t){t[e.propertyName].additionalButtons||(t[e.propertyName].additionalButtons={});let n=t[e.propertyName].containerDiv;for(let a=0;a<e.buttons.length;a++){let o=e.buttons[a],s=null,c=0;if(o.available){if("Restore"===o.type)(s=new i({displayStyle:"lite",disabled:o.buttonDisabled,icon:{iconPath:r.getWebappsAssetUrl("VCXWebGUI","icons/32/VCX_Restore_grey.png")}})).elements.container.title=o.tooltip||"Restore Default Value",c=20,s.additionalButtonFunction=this.restoreFunction,s.additionalButtonFunctionArgs={data:o.data},n.addClassName("vcx-prop-restorable");else if("Clear"===o.type)(s=new i({displayStyle:"lite",disabled:o.buttonDisabled,icon:{iconName:"clear",fontIconFamily:WUXManagedFontIcons.Font3DS}})).elements.container.title=o.tooltip||"Clear Value",s.additionalButtonFunction=this.clearFunction,s.additionalButtonFunctionArgs={data:o.data};else if("NavigateTo"===o.type){n.getChildren().every(function(e){return e.hasClassName("vcx-propNode-label")||n.removeChild(e),!0}),new UWA.Element("div",{html:"Overruled",class:"vcx-prop-overruled"}).inject(n),s=new i({label:"Go to parent"}),c=20,s.additionalButtonFunction=this.goToParentFunction,s.additionalButtonFunctionArgs={data:o.data},s.getContent().addClassName("vcx-goToParent-button")}else if("Contextual"===o.type){if(!o.data instanceof Array)throw new Error("contextual button data is not an array!");s=new i({displayStyle:"lite",disabled:o.buttonDisabled,icon:{iconName:"menu-dot",fontIconFamily:WUXManagedFontIcons.Font3DS}}),c=100,s.additionalButtonFunction=this.contextualContentFunction,s.additionalButtonFunctionArgs=s,l.addEventListener(s.getContent(),{callback:()=>{let e=new Array;for(let t=0;t<o.data.length;t++){const n=o.data[t];e.push({type:"PushItem",title:n.label,fonticon:{content:"wux-ui-3ds-"+n.iconName+" wux-ui-3ds"},tooltip:{title:n.tooltipTitle,shortHelp:n.tooltip},action:{callback:n.functionCB}})}return e}})}else s=new i({displayStyle:"lite",disabled:o.buttonDisabled,icon:{iconName:o.iconName||"i-question",fontIconFamily:WUXManagedFontIcons.Font3DS}}),o.type||(o.type="defaultType",console.error("A additional setting button was created without button.type -> Only one can be created anonymously without causing issues")),s.additionalButtonFunction=o.functionCB,s.additionalButtonFunctionArgs={name:o.name,propertyName:e.propertyName,data:o.data},s.elements.container.title=o.tooltip||"";let a=e.propertyName.replaceAll(".","-")+"-"+o.type+"-button";s.getContent().setAttribute("data-rec-id",a),s.getContent().addClassName("vcx-additional-prop-button"),s.getContent().style.order=c||"",s.inject(n),t[e.propertyName].additionalButtons[o.type]&&console.error("Can't create two buttons of the same type for a single property"),t[e.propertyName].additionalButtons[o.type]={button:s,buttonInfo:o}}}},updateButtons:function(e,t,n){let i=this.getPanelDisplayedInfo(),a=i[e][t].additionalButtons;for(let r=0;r<n.length;r++){const o=n[r];if(!o.available){this.removeButtons(e,t,[o]);continue}let s=a[o.type].button;s.disabled=o.buttonDisabled,s.elements.container.title=o.tooltip,o.iconName&&(s.icon={iconName:o.iconName,fontIconFamily:WUXManagedFontIcons.Font3DS}),i[e][t].additionalButtons[o.type].buttonInfo=o}},removeButtons:function(e,t,n){let i=this.getPanelDisplayedInfo(),a=i[e][t].additionalButtons;for(let r=0;r<n.length;r++){const o=n[r];a[o.type].button.destroy(),delete i[e][t].additionalButtons[o.type]}},addButtons:function(e,t,n){let i={propertyName:t,buttons:n},a=this.getPanelDisplayedInfo()[e];this.createPropSettingsButtons(i,a)},rebuildButtons:function(e,t,n){this.removeButtons(e,t,n),this.addButtons(e,t,n)},goToParentFunction:function(){console.warn("GoToParent did nothing: GoToParent function was not given to PanelView")},restoreFunction:function(){console.warn("Restore did nothing: restore function was not given to PanelView")},contextualContentFunction:function(e){l.buildAndDisplayContextualMenu(e.getContent(),{clientX:e.getContent().getOffsets().x+e.getContent().offsetWidth,clientY:e.getContent().getOffsets().y+e.getContent().offsetHeight})},ambienceApplyFunction:function(){console.warn("button did nothing: callback was not given to PanelView")},onClickLabel:function(){},onDoubleClickLabel:function(){},uiSelect:function(e,t){let n=Object.keys(this._displayedInfo);for(let i in n){let a=n[i],r=this._displayedInfo[a];if(r[e]){let n,i=r[e].tweakers;i.length>0&&(n=i[0].getContent().closest(".vcxPropertyLine")),n.style.backgroundColor=t?"#4f91cd":""}}},selectAllProps:function(){let e=[],t=document.getElementsByClassName("vcxPropertyLabel");for(let n=0;n<t.length;n++){let i=t[n];e.includes(i.propertyId)||e.push(i.propertyId),this.uiSelect(i.propertyId,!0)}return e},deselectAllProps:function(){let e=document.getElementsByClassName("vcxPropertyLabel");for(let t=0;t<e.length;t++){let n=e[t];this.uiSelect(n.propertyId,!1)}},generateHeaders:function(e){this.uiPanelClass.generateHeaders(e)},emptyPanelContent:function(){let e=Object.keys(this._displayedInfo);for(let t in e){let n=e[t],i=Object.keys(n);for(let e in i){let n=i[e];this.destroyTweakerLine(n,t)}}this.uiPanelClass.setPanelContent(this._selectElementMessage),this._groupsAccordeon&&this._groupsAccordeon.clear(),this.uiPanelClass.getPanel().removeEventListener("change",this.changeEvent),this.panelContentHeader.replaceChildren(),this.panelContentBody.replaceChildren(),this.panelContentFooter.replaceChildren(),this._displayedInfo={}},destroyGroup:function(e){var t=this._groupsAccordeon.getIndexFromId(e._expanderId);this._groupsAccordeon.deleteItem(t),delete this._displayedInfo[e.groupID]},destroyTweakerLine:function(e){let t=Object.keys(this._displayedInfo);for(let n in t){let i=t[n],a=this._displayedInfo[i];if(a[e]){let t,n=a[e].tweakers;n.length>0&&(t=n[0].getContent().closest(".vcxPropertyLine"));for(let e of n)try{e.destroy&&e.destroy()}catch(e){console.warn("Type error is thrown by WebUX bug upon destruction of blob tweaker. ",e.message)}t&&t.destroy(),delete this._displayedInfo[i][e]}}},fillPanelWithProperties:function(){this.uiPanelClass.setPanelContent(this.panelContentContainer),this.uiPanelClass.getPanel().addEventListener("change",this.changeEvent)},changeEvent:function(e){},subscribeTweakerEvent:function(e,t){"string"==typeof e&&"function"==typeof t&&this.uiPanelClass.getPanel().addEventListener(e,t)},unsubscribeTweakerEvent:function(e,t){"string"==typeof iEventName&&"function"==typeof iEvtCb&&this.uiPanelClass.getPanel().removeEventListener(e,t)},changeFormatPainterButtonVisibility:function(e){let t=this.uiPanelClass.getPanel().getElementsByClassName("VCXSingleFormatPainterCmd")[0];t&&(e?t.removeClassName("vcxHidden"):t.addClassName("vcxHidden"))}})}),define("DS/VCXWebGUI/VCXGUIServices",["UWA/Class","DS/Windows/Dialog","DS/Controls/Button","DS/VCXWebKernel/VCXDRMManager","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],function(e,t,n,i,a){"use strict";return e.singleton({displaySignature:function(e,r,o){r.strSignaturePicturePath,r.ulSignatureCRC;var s=e.getManager("VCXContextManager").getFrameWindow(),l=(s.getUIFrame(),s.getImmersiveFrame());e.getManager("VCXContextManager").loadCssFile("VCXWebGUI/VCXWebSignature.css",1);var c=r.strAgreement.replace(/#@/g,"</p><p>");c="<p>"+c+"</p>";var d=null;if(r.resources){var u=r.strSignaturePicturePath.replace(/^.*[\\\/]/,"").toLowerCase();d=r.resources[u]}var p='<img src="'+d+'" style="max-width:100%"/>',h=new UWA.Element("div",{class:"Signature"});new UWA.Element("div",{class:"Signature_Cell",html:p}).inject(h),new UWA.Element("div",{class:"Signature_Cell",html:c}).inject(h);var m={};r.ulAgreementMode===i.LitSignatureMode.LIT_SIGNATURE_DISPLAY_AND_PASS?m.Ok=new n({label:a["Signature.Ok"],onClick:function(e){document.getElementsByClassName("wux-windows-modalDialog")[0].remove();var t=e.dsModel.dialog;t._closeOK=!0,t.remove(),t.close()}}):(m.Ok=new n({label:a["Signature.Agree"],onClick:function(e){var t=e.dsModel.dialog;t._closeOK=!0,t.remove(),t.close()}}),m.Cancel=new n({label:a["Signature.Disagree"],onClick:function(e){var t=e.dsModel.dialog;t._closeOK=!1,t.remove(),t.close()}}));var g=new t({title:a.Signature,content:h,modalFlag:!0,resizableFlag:!0,usePaddingFlag:!1,width:400,closeButtonFlag:!1,immersiveFrame:l,buttons:m});g.elements.container.parentNode.parentNode.removeChild(g.elements.container.parentNode),widget.body.appendChild(g.elements.container.parentNode);var C=r,v=o;g.addEventListener("close",function(e){g._closeOK?(C.LoadGeometriesBody(v),C._pause=!1,C.launchsmgXMLCB(C,C.smgLoader)):C.launchsmgXMLCB(null,C.smgLoader)})},hideDockingElements:async function(e,t){for(var n={freeWindowsInfo:{},visiblePanels:[],panelsToReopen:[]},i=e.getImmersiveFrame(),a=i.windows,r={},o=Object.keys(a),s=0;s<o.length;++s){var l=o[s],c=a[l];if(!c.getDockedFlag())if(r[l]=c,n.freeWindowsInfo[l]={pos:{x:c.position.offsetX,y:c.position.offsetY},dims:[c.width,c.height]},c.allowedDockAreas!==WUXDockAreaEnum.NoneDockArea)for(var d=[WUXDockAreaEnum.BottomDockArea,WUXDockAreaEnum.TopDockArea,WUXDockAreaEnum.LeftDockArea,WUXDockAreaEnum.RightDockArea],u=0;u<d.length;++u){var p=d[u];if(c.allowedDockAreas&p){await i.dockWindow(c,p),n.freeWindowsInfo[l].dockedArea=p;break}}else console.log("Some windows aren't allowed to be docked, preventing a correct immersive mode for the Guided Tour.")}var h=e.getImmersiveFrame().dockingElements;for(s=0;s<h.length;++s)t&&(h[s].collapseDockingZoneFlag||(n.panelsToReopen.push(h[s]),h[s].collapseDockingZoneFlag=!0)),h[s].visibleDockingZoneFlag&&(n.visiblePanels.push(h[s]),h[s].visibleDockingZoneFlag=!1);return n},restoreDockingElements:function(e,t){var n=e&&e.getImmersiveFrame();if(n&&t){if(t.freeWindowsInfo&&Object.keys(t.freeWindowsInfo).length>0){n.windows;for(var i in t.freeWindowsInfo)if(t.freeWindowsInfo.hasOwnProperty(i)){var a=n.windows[i];n.undockWindow(a),a.setAbsolutePosition(t.freeWindowsInfo.pos)}}for(var r=t.visiblePanels,o=t.panelsToReopen,s=0;s<o.length;++s){o[s].collapseDockingZoneFlag=!1}for(var l=0;l<r.length;++l){r[l].visibleDockingZoneFlag=!0}}else console.warn("Immersive frame and config of the panels before they were hiding are needed !")},hideActionBar:function(e,t){var n={actionBarShouldBeOpen:null};if(t){var i=e.getActionBar();if(!i||!i.elements)return;(null===i.elements.container.getAttribute("data-open")||"true"===i.elements.container.getAttribute("data-open"))&&(n.actionBarShouldBeOpen=!0,i.close()),i.hide()}return n},restoreActionBar:function(e,t){var n=e.getActionBar();n.show(),t.actionBarShouldBeOpen&&n.open()}})}),define("DS/VCXWebGUI/VCXModifiableGUIManager",["DS/VCXWebModifiables/VCXModifiable","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueBoolean"],function(e,t,n,i,a){"use strict";return e.extend({init:function(){this._parent()},OnChangeProperty:function(e,t){return console.log("property not found!"),!1},GetProperty:function(e){return null},GetProperties:function(){return new t}})}),define("DS/VCXWebGUI/VCXSceneCard",["require","exports","DS/Controls/Button","DS/Menu/ContextualMenu","DS/Controls/Loader","DS/Controls/ModalContainer","DS/VCXGUIInfrastructure/VCXUICard","i18n!DS/VCXWebProducts/assets/nls/VCXWebProductAuthoringCommands"],function(e,t,n,i,a,r,o,s){"use strict";return class extends o{constructor(e){super(e),this.updateButton=new n({emphasize:"primary",icon:{iconName:"refresh",fontIconFamily:WUXManagedFontIcons.Font3DS}}),this.updateButton.elements.container.title=s.VCXAddCameraKeyCmd;let t=this.cardElement.querySelector(".vcxUICard-descriptionActionBar");return this.updateButton.inject(t),this.updateButton.getContent().style.display="none",this.updateButton.getContent().addClassName("vcxSceneUpdate"),this.updateButton.getContent().setAttribute("data-rec-id","vcxscenecard-update-button"),this}updateInfo(e){if(e.imageUrl){let t=this.cardElement.getElementsByClassName("vcxUICard-thumbnail")[0];t&&(t.src=e.imageUrl)}if(e.scenarioIndex)throw new Error("Updating index not implemented: needs to use insertBefore");e.name&&(this.label.innerHTML=e.name)}getName(){return this.label}addRenameCardCallback(e){let t=this;this.label.addEventListener("focus",()=>{var e;null===(e=window.getSelection())||void 0===e||e.selectAllChildren(this.getName())}),this.label.addEventListener("blur",function(n){var i;let a=null===(i=null==n?void 0:n.target)||void 0===i?void 0:i.innerHTML;(null==n?void 0:n.target).scrollLeft=0,t.isCardActive()||t.label.setAttribute("contenteditable","false"),e(t.getID(),a)})}addUpdateButtonCallback(e){e&&this.updateButton.addEventListener("buttonclick",e)}customizeMenu(e){i.addEventListener(this.contextMenuButton.getContent(),{callback:()=>{let t=new Array;for(let n=0;n<e.length;n++){const i=e[n];this.isCardActive()&&i.activeSceneDisabled||t.push({type:"PushItem",title:i.label,fonticon:{content:"wux-ui-3ds-"+i.icon+" wux-ui-3ds"},action:{callback:i.action}})}return t}}),this.contextMenuButton.getContent().style.display=""}showUpdateButton(){this.updateButton.getContent().style.display=""}hideUpdateButton(){this.updateButton.getContent().style.display="none"}activateCard(){super.activateCard(),this.label.setAttribute("contenteditable","true")}deactivateCard(){super.deactivateCard(),this.label.setAttribute("contenteditable","false")}activateLoading(){var e=new a;e.on(),r.createModal(this.getView(),e.elements.container)}deactivateLoading(){r.removeModal(this.getView())}}}),define("DS/VCXWebGUI/VCXFontBoxing",["UWA/Class","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFont","DS/VCXWebProperties/VCXPropertyInfoEnum","DS/VCXWebProperties/VCXPropertyValueEnum","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],function(e,t,n,i,a,r,o,s,l,c){"use strict";return e.extend({init:function(){},GetPropertiesForGUI:function(e,a,o){var c={hiddenFields:[],propertyName:null,propertyHeight:null,propertyItalic:null,propertyBold:null},d=new l;d.SetValue(13);var u=(a.GetPropertyName()||"Collab.Text.Font")+"_",p=new s(u+"Name",null,!1,a.Geti18n()),h={0:"__DONOTTRANSLATE__Arial",1:"__DONOTTRANSLATE__Arial Black",2:"__DONOTTRANSLATE__Comic Sans MS",3:"__DONOTTRANSLATE__Courier New",4:"__DONOTTRANSLATE__Georgia",5:"__DONOTTRANSLATE__Impact",6:"__DONOTTRANSLATE__Lucida Console",7:"__DONOTTRANSLATE__Lucida Sans Unicode",8:"__DONOTTRANSLATE__Palatino Linotype",9:"__DONOTTRANSLATE__Tahoma",10:"__DONOTTRANSLATE__Times New Roman",11:"__DONOTTRANSLATE__Trebuchet MS",12:"__DONOTTRANSLATE__Verdana"};for(var m in p.SetMapChoiceEnum(h),h)if(h.hasOwnProperty(m)){var g=h[m];if(e.GetFamily().GetValue()===g){d.SetValue(parseInt(m));break}}13===d.GetValue()&&(h[13]=e.GetFamily().GetValue()),c.propertyName=new t(p,d);var C=new n(u+"Height",null,!1,a.Geti18n()),v=new i;v.SetValue(Number(e.GetHeight().GetValue())),c.propertyHeight=new t(C,v),o&&o.includes("Height")&&c.hiddenFields.push("propertyHeight");var _=new n(u+"Italic",null,!1,a.Geti18n()),b=new r;return b.SetValue(e.GetItalic().GetValue()),c.propertyItalic=new t(_,b),o&&o.includes("Italic")&&c.hiddenFields.push("propertyItalic"),_=new n(u+"Bold",null,!1,a.Geti18n()),(b=new r).SetValue(700===e.GetWeight().GetValue()),c.propertyBold=new t(_,b),o&&o.includes("Bold")&&c.hiddenFields.push("propertyBold"),c},UpdateMapForGUI:function(e,t){var n=t.propName,i=t.std;if("Collab.Text.Font_Name"===n){var a=e.propertyName,r=a.GetPropertyInfo().GetMapChoiceEnum();for(var o in a.GetPropertyValue().SetValue(13),r){if(r.hasOwnProperty(o))if(i===r[o].replace("__DONOTTRANSLATE__","")){a.GetPropertyValue().SetValue(parseInt(o));break}}}else if("Collab.Text.Font_Height"===n){e.propertyHeight.GetPropertyValue().SetValue(i)}else if("Collab.Text.Font_Italic"===n){e.propertyItalic.GetPropertyValue().SetValue(i)}else if("Collab.Text.Font_Bold"===n){e.propertyBold.GetPropertyValue().SetValue(i)}return e},BuildNewValueFromGUI:function(e){var t=new o,n=new a,i=e.propertyName.GetPropertyInfo()._mapChoiceEnum[e.propertyName.GetPropertyValue().GetValue()];n.SetValue(i.replace("__DONOTTRANSLATE__",""));var r=e.propertyHeight.GetPropertyValue(),s=e.propertyItalic.GetPropertyValue(),l=e.propertyBold.GetPropertyValue();return t.SetFamily(n),t.SetHeight(r),t.SetItalic(s),t.GetWeight().SetValue(l.GetValue()?700:400),t.ToString()},getPropertiesNamesNLS:function(e){var t={};return t[e+"_Name"]=c.get("FontBoxing_Name"),t[e+"_Height"]=c.get("FontBoxing_Height"),t[e+"_Italic"]=c.get("FontBoxing_Italic"),t[e+"_Bold"]=c.get("FontBoxing_Bold"),t}})}),define("DS/VCXWebGUI/VCXRatioPanelView",["require","exports","DS/VCXGUIInfrastructure/VCXMainPanelFixed","DS/VCXGUIInfrastructure/VCXUICard","DS/Controls/Accordeon","DS/VCXGUIInfrastructure/VCXCardTypeEnum","UWA/Core"],function(e,t,n,i,a,r,o){"use strict";return class extends n{constructor(e,t){super(e,t),this.cardLayout={ratioX:16,ratioY:9,cardWidth:120,descriptionHeight:40},this.panelAccordeon=this._buildAccordeon(),this.setPanelContent(this.panelAccordeon.getContent()),this.addExpander({header:"Standard",content:(0,o.createElement)("div",{html:"",class:"ratiosContainer"}),icon:{iconName:"badge",fontIconFamily:WUXManagedFontIcons.Font3DS},expandedFlag:!0}),this.addExpander({header:"Social Network",content:(0,o.createElement)("div",{html:"",class:""}),icon:{iconName:"users",fontIconFamily:WUXManagedFontIcons.Font3DS}}),this.addExpander({header:"E-commerce",content:(0,o.createElement)("div",{html:"",class:""}),icon:{iconName:"network",fontIconFamily:WUXManagedFontIcons.Font3DS}})}_buildAccordeon(){return new a({exclusive:!1,style:"divided",items:[]})}addExpander(e){this.panelAccordeon.addItem(e)}getExpanderFromHeader(e){let t=this.panelAccordeon.getIndexFrom({header:e});return this.panelAccordeon.getExpanderFromIndex(t)}setRatioClickFunction(e){this.ratioSelectCallback=e}generateRatioCard(e){let t={"ratio-width":e.ratioWidth,"ratio-height":e.ratioHeight,"specific-width":e.specificWidth},n={id:"ratioId",title:e.title,subTitle:"Second Title",image:e.icon,selectableFlag:!1,type:r.RATIO,data:t,cardLayout:this.cardLayout},a=new i(n),o=a.getView();this.getExpanderFromHeader("Standard").body.appendChild(o),a.addCardClickCallback(()=>{this.ratioSelectCallback&&this.ratioSelectCallback(e.ratioWidth,e.ratioHeight,e.specificWidth)})}}}),define("DS/VCXWebGUI/VCXThumbnailChooserView",["require","exports","DS/Controls/Button","UWA/Core"],function(e,t,n,i){"use strict";return class{constructor(e,t){this.index=0,this.selectIndex=-1,this.parentHoverImage=null,this.hoverImageContainer=null,this.containerDiv=(0,i.createElement)("div",{class:"VCXThumbnailChooserContainer"}).inject(e),this.options=t,this.rightButton=null,this.leftButton=null,this.pictures=[],this.buildLayout()}setupView(){let e=this.options.getNumberThumbnail();for(let e=0;e<this.options.numberShown;e++)this.setupThumbnail(e,e+this.index);this.leftButton&&(this.leftButton.disabled=0===this.index),this.rightButton&&(this.rightButton.disabled=this.index+this.options.numberShown>=e),this.select(this.selectIndex)}setupThumbnail(e,t){let n=this.options.fetchImage(t),a=this.pictures[e];if(n){let e=(0,i.createElement)("img",{class:"VCXThumbnailChooserViewThumbnail"});e.src=n,a.replaceChildren(e)}else a.replaceChildren()}select(e){this.selectIndex=e;for(let t=0;t<this.options.numberShown;t++)this.setVisibilityFlag(this.pictures[t],this.index+t===e,"VCXThumbnailChooserViewThumbnailActive")}getSelection(){return this.selectIndex}setVisibilityFlag(e,t,n){t&&!(null==e?void 0:e.hasClassName(n))&&(null==e||e.addClassName(n)),!t&&(null==e?void 0:e.hasClassName(n))&&(null==e||e.removeClassName(n))}createHoverImage(e,t){var n;if(this.parentHoverImage===e)return;if(this.parentHoverImage=e,this.hoverImageContainer&&this.hoverImageContainer.destroy(),!this.parentHoverImage)return;this.hoverImageContainer=(0,i.createElement)("div",{class:"VCXImmersiveNavTopThumbnailContainer"});let a=(0,i.createElement)("img",{class:"VCXImmersiveNavTopThumbnail VCXThumbnailChooserThumbnailChooser VCXImmersiveNavTopThumbnailHidden"}).inject(this.hoverImageContainer);this.options.onHoverCb&&(a.src=this.options.onHoverCb(t)),null===(n=this.hoverImageContainer)||void 0===n||n.inject(this.parentHoverImage),setTimeout(()=>a.removeClassName("VCXImmersiveNavTopThumbnailHidden"),10)}buildPictures(){for(let e=0;e<this.options.numberShown;e++){let t=(0,i.createElement)("div",{class:""}).inject(this.containerDiv);this.pictures.push(t),t.addEventListener("click",()=>{this.select(this.index+e)}),t.addEventListener("mouseover",()=>{this.createHoverImage(t,this.index+e)}),t.addEventListener("mouseleave",()=>{this.createHoverImage(null,this.index+e)})}}buildLayout(){var e,t;this.leftButton=new n({displayStyle:"lite",iconSize:"15px",icon:{iconName:"chevron-left",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.containerDiv),null===(e=this.leftButton)||void 0===e||e.addEventListener("buttonclick",()=>{this.index>0&&(this.index-=1,this.setupView())}),this.buildPictures(),this.rightButton=new n({displayStyle:"lite",iconSize:"15px",icon:{iconName:"chevron-right",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.containerDiv),null===(t=this.rightButton)||void 0===t||t.addEventListener("buttonclick",()=>{let e=this.options.getNumberThumbnail();this.index+this.options.numberShown<e&&(this.index+=1,this.setupView())})}}}),define("DS/VCXWebGUI/VCXUndoRedoCtrl",["UWA/Class","UWA/Element","DS/CoreEvents/Events","DS/Spreadsheet/DataGrid"],function(e,t,n,i){"use strict";return e.singleton({removeDiv:function(){if(!0===this.bInitialized){var e=document.getElementById("VCXUndoRedoCtrlID");e&&(n.unsubscribe(this._tokenUpdate),n.unsubscribe(this._tokenUndoRedo),n.unsubscribe(this._tokenEndTransaction),n.unsubscribe(this._tokenStartedTransaction),this._tokenUpdate=null,this._tokenUndoRedo=null,this._tokenEndTransaction=null,this._tokenStartedTransaction=null,e.parentNode.removeChild(e)),this.bInitialized=!1}},addDiv:function(e){if(this._vcxCommandManager=e,!0!==this.bInitialized){this.bInitialized=!0;var t=this;this._tokenUpdate=n.subscribe({event:"VCX_UNDOREDO_STACK_UPDATE"},function(){t.Redraw()}),this._tokenUndoRedo=n.subscribe({event:"VCX_UNDOREDO_DONE"},function(){t.Redraw()}),this._tokenEndTransaction=n.subscribe({event:"VCX_END_TRANSACTION"},function(){t.Redraw()}),this._tokenStartedTransaction=n.subscribe({event:"VCX_STARTED_TRANSACTION"},function(){t.Redraw()}),this._mainPanel=new UWA.Element("div",{html:"",class:"VCXUndoRedoCtrl",id:"VCXUndoRedoCtrlID",styles:{zIndex:99999,margin:"",height:"400px",width:"400px",top:"50px",left:"100px",position:"absolute",border:"1px solid grey",resize:"both",overflow:"auto",backgroundColor:"rgba(200,200,200,.9)"}}).inject(document.body),this._panelBody=new UWA.Element("div",{html:"",class:"VCXUndoRedoCtrlBody",id:"VCXUndoRedoCtrlIDBody",styles:{userSelect:"none",textAlign:"left",color:"black",fontSize:"x-small",position:"absolute",margin:"",height:"calc( 100% - 20px )",width:"100%",top:"20px",left:"0px",border:"none",backgroundColor:"rgba(200,200,200,.9)"}}).inject(this._mainPanel),this._panelHeader=new UWA.Element("div",{html:"UNDO/REDO STACK",class:"VCXUndoRedoCtrlheader",id:"VCXUndoRedoCtrlIDheader",styles:{userSelect:"none",color:"black",position:"sticky",margin:"",height:"20px",width:"100%",top:"0px",left:"0px",border:"none",backgroundColor:"rgba(150,150,150,1)"}}).inject(this._mainPanel);!function(e){var t=0,n=0,i=0,a=0;document.getElementById(e.id+"header")?(document.getElementById(e.id+"header").onmousedown=o,document.getElementById(e.id+"header").ontouchstart=o):e.onmousedown=o;var r=0;function o(e){(e=e||window.event).preventDefault();var t=(new Date).getTime()-r;if(t<300&&t>0){var n=document.getElementById("VCXUndoRedoCtrlID");"20px"==n.style.height?n.style.height="200px":n.style.height="20px"}else{var o=e.clientX,c=e.clientY;o||(o=e.touches[0].clientX),c||(c=e.touches[0].clientY),i=o,a=c,document.onmouseup=l,document.ontouchend=l,document.onmousemove=s,document.ontouchmove=s}r=(new Date).getTime()}function s(r){(r=r||window.event).preventDefault();var o=r.clientX,s=r.clientY;o||(o=r.touches[0].clientX),s||(s=r.touches[0].clientY),t=i-o,n=a-s,i=o,a=s;var l=e.offsetTop-n;l>0&&(e.style.top=l+"px"),e.style.left=e.offsetLeft-t+"px"}function l(){document.onmouseup=null,document.onmousemove=null,document.ontouchmove=null,document.ontouchend=null}}(document.getElementById("VCXUndoRedoCtrlID"));var a={defaultCellHeight:15,apiVersion:2,height:"auto",headersDimensions:{width:15,height:15},show:{rowHeaders:!1,columnHeaders:!0},resize:{columns:!0,rows:!0},isSortable:!1,className:"stack",columns:[{text:"Undo",dataIndex:"undoCmd",width:"auto"},{text:"Redo",dataIndex:"redoCmd",width:"auto"}],selection:{cells:!1}};t.datagrid=new i(a),t.datagrid.inject(this._panelBody)}else this.Redraw()},unInitialize:function(){n.unsubscribe(this._tokenUpdate),delete this._tokenUpdate,n.unsubscribe(this._tokenUndoRedo),delete this._tokenUndoRedo},Redraw:function(){var e=this._vcxCommandManager,t=document.getElementById("VCXUndoRedoCtrlIDheader");e._bTransaction?t.innerHTML="UNDO/REDO STACK (transaction running)":t.innerHTML="UNDO/REDO STACK";for(var n=[],i=0,a=e._stackCmd.length-1;a>=0&&!(i>20);a--){if((l=e._stackCmd[a])&&!l.IsLinkedCmd()){var r="UnknownCommand";void 0!==l.GetTitle&&(r=l.GetTitle()),n.push(r),i++}}var o=[];i=0;for(var s=e._stackCmdUndo.length-1;s>=0&&!(i>20);s--){var l;if((l=e._stackCmdUndo[s])&&!l.IsLinkedCmd()){var c="UnknownCommand";void 0!==l.GetTitle&&(c=l.GetTitle()),o.push(c),i++}}if(0===n.length&&0===o.length){(d=this.datagrid.getManager()).prepareUpdateView();for(a=d.getNumberOfRows()-1;a>=0;a--)d.removeRow(a);d.pushUpdateView()}else{var d;(d=this.datagrid.getManager()).prepareUpdateView(),d.empty();var u=Math.max(n.length,o.length);for(a=0;a<u;a++){var p="";a<n.length&&(p=n[a]);var h="";a<o.length&&(h=o[a]),d.addRow({undoCmd:p,redoCmd:h})}d.pushUpdateView()}}})}),define("DS/VCXWebGUI/VCXDocManagerCtrl",["UWA/Class","UWA/Element","DS/CoreEvents/Events","DS/Spreadsheet/DataGrid"],function(e,t,n,i){"use strict";return e.extend({init:function(e){var t=this;t.bIsDirty=!1,this._vcxGuiManager=e,this._tokenDocAdded=n.subscribe({event:"VCX_DOC_ADDED"},function(){t.onRedraw()}),this._mainPanel=new UWA.Element("div",{html:"",class:"VCXDocManagerCtrl",styles:{display:"none",margin:"",height:"300px",width:"500px",bottom:"100px",left:"100px",position:"absolute",border:"1px dotted black"}}).inject(t._vcxGuiManager._uiLayer);var a={apiVersion:2,height:"auto",headersDimensions:{width:15,height:15},show:{rowHeaders:!0,columnHeaders:!0},resize:{columns:!0,rows:!0},isSortable:!1,className:"documentManager",columns:[{text:"Id",dataIndex:"id",width:130},{text:"Name",dataIndex:"name",width:130},{text:"Url",dataIndex:"url",width:130}],selection:{cells:!1}};t.datagrid=new i(a),t.datagrid.inject(this._mainPanel)},unInitialize:function(){n.unsubscribe(this._tokenDocAdded),delete this._tokenDocAdded},onRedraw:function(){if("none"!==this._mainPanel.style.display){console.log("redrawPanel");var e=this._vcxGuiManager._experienceBase.getManager("VCXDocManager");if(e.IsEmpty()){(n=this.datagrid.getManager()).prepareUpdateView();for(var t=n.getNumberOfRows()-1;t>=0;t--)n.removeRow(t);n.pushUpdateView()}else{var n;(n=this.datagrid.getManager()).prepareUpdateView();for(t=n.getNumberOfRows()-1;t>=0;t--)n.removeRow(t);var i=e.NumberOfDoc();for(t=0;t<i;t++){var a=e.GetPropPath(t),r=a.GetPathType().GetValue();if(0===r){var o=a.GetValueURL().GetValue();o.indexOf("blob:")>=0&&(o=a.GetFileName().GetValue()),n.addRow({id:t.toString(),url:a.GetValueURL().GetValue(),name:a.GetFileName().GetValue()})}else if(1===r){var s=a.GetValueLink().GetValue(),l=this._vcxGuiManager._experienceBase.ComponentsMap.GetComponentFromID(s);if(l){var c=l.GetName();n.addRow({id:t.toString(),name:c})}}else if(2===r){var d=a.GetValueLink().GetValue(),u=this._vcxGuiManager._experienceBase.ComponentsMap.GetComponentFromID(d);if(u){var p=u.GetName();n.addRow({id:t.toString(),name:p})}}}n.pushUpdateView()}}}})}),define("DS/VCXWebGUI/VCXLinkedPropCtrl",["UWA/Class","DS/CoreEvents/Events","DS/Spreadsheet/DataGrid","DS/VCXGUIInfrastructure/VCXToolbarCtrl","i18n!DS/VCXWebProducts/assets/nls/VCXWebProductAuthoringCommands"],function(e,t,n,i,a){"use strict";return e.extend({init:function(e){var r=this;this._vcxGuiManager=e,this._tokenLinkAdded=t.subscribe({event:"VCX_LINKS_ADDED"},function(){r.onRedraw()}),this._tokenLinkRemoved=t.subscribe({event:"VCX_LINKS_REMOVED"},function(){r.onRedraw()}),this._mainPanel=new UWA.Element("div",{html:"",class:"VCXLinkedPropCtrl",styles:{display:"none",margin:"",height:"300px",width:"400px",bottom:"100px",left:"300px",position:"absolute",border:"1px dotted black",backgroundColor:"white"}}).inject(r._vcxGuiManager._uiLayer),this._toolbarContainer=new UWA.Element("div",{html:"",class:"wux-panels-panelbase-title vcx-panels-panelbase-title"}).inject(this._mainPanel),this._toolbar=new i({controller:r,title:"Linked Properties panel",parent:this._toolbarContainer,panel:this._mainPanel}),this._toolbar.addMainItemFixed("VCXDeleteLinkedPropCmd","","vcxToolbarButtonIcon","VCXWebDebug/VCXWebDebug",a);var o={apiVersion:2,height:"auto",headersDimensions:{width:15,height:15},show:{rowHeaders:!0,columnHeaders:!0},resize:{columns:!0,rows:!0},isSortable:!1,className:"linkedProperties",columns:[{text:"In",dataIndex:"inValue",width:180},{text:"Out",dataIndex:"outValue",width:180}],selection:{nodes:!0,cells:!1,rowHeaders:!0,columnHeaders:!1,unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!0,canMultiRowSelect:!0}};r.datagrid=new n(o);var s=r.datagrid.getManager(),l=function(e){if(!event.changedTouches){var t=e.cellModel,n=e.cellView,i=n.getVirtualCoordinates(),a=i.virtualRowID,r=i.virtualColumnID;if(!n._isBeingResized){if(-1===r&&s.options.selection.rowHeaders&&(s.prepareUpdateView(),s.options.selection.canMultiRowSelect?s.isRowSelected(a)?s.unselectRow(a,!1):s.selectRow(a,!1):(s._selectedCells.empty(),s.selectRow(a)),a,s.pushUpdateView()),-1===a){var o=s._getColumnOptionValue(r,"isSortable"),l=["sort:asc","sort:desc"],c=s._getColumnState(r);switch(cyclicIterator(l,l.indexOf(c)).getNext()){case void 0:case"select":s.prepareUpdateView(),s.options.selection.rowHeaders&&(t.removeClass("wux-ui-sort-desc"),t.removeClass("wux-ui-sort-asc"),s.selectColumn(r,!0)),s.pushUpdateView();break;case"sort:desc":o&&(s.prepareUpdateView(),s.sortColumnContent(r,{typeOfCell:"number",sortOrder:"desc"}),s.pushUpdateView());break;case"sort:asc":o&&(s.prepareUpdateView(),s.sortColumnContent(r,{typeOfCell:"number",sortOrder:"asc"}),s.pushUpdateView())}}if(-1!==a&&-1!==r&&s.options.selection.cells){if(s.prepareUpdateView(),s._preventNextUpdateView(),s.unselectAll({cells:!0,updateView:!1}),s._modeIsRange){var d,u,p,h,m,g,C=t,v=s._selectedCells.get()[0];s._selectedCells.empty(),s._selectedCells.add(v);var _=v.getView().getVirtualCoordinates(),b=C.getView().getVirtualCoordinates();for(_.virtualRowID<b.virtualRowID?(p=_.virtualRowID,h=b.virtualRowID):(h=_.virtualRowID,p=b.virtualRowID),d=p;d<=h;d++)for(_.virtualColumnID<b.virtualColumnID?(m=_.virtualColumnID,g=b.virtualColumnID):(g=_.virtualColumnID,m=b.virtualColumnID),u=m;u<=g;u++)if(d!==_.virtualRowID||u!==_.virtualColumnID){var f=s.getCell(d,u);s._selectedCells.add(f)}}else s._modeIsMultiSel?s._selectedCells.add(t):s._selectedCells.unique(t);s.pushUpdateView()}}}};r.datagrid.getManager().onCellClick=function(e){return this._modelEvents.subscribe({event:"click"},l)},r.datagrid.inject(this._mainPanel),r.datagrid.elements.formContainer.childNodes[1].style.top="30px"},GetSelectedLinks:function(){if(this.datagrid){for(var e=[],t=this.datagrid.getManager().getSelectedRows(),n=0;n<t.length;n++){var i=this._mapToFill[n];e.push(i)}return e}},unInitialize:function(){t.unsubscribe(this._tokenLinkAdded),delete this._tokenLinkAdded,t.unsubscribe(this._tokenLinkRemoved),delete this._tokenLinkRemoved,this._toolbar.unInitialize(),this._toolbar=null,this.datagrid.getManager().onCellClick=null,this.datagrid.destroy(),this._mainPanel.remove()},onRedraw:function(){if("none"!==this._mainPanel.style.display){var e=this.datagrid.getManager();e.empty();var t=this._vcxGuiManager._experienceBase.getManager("VCXLinkedPropertyManager");this._mapToFill={};var n=!0,i=0;for(var a in t._links)if(t._links.hasOwnProperty(a)){var r=t._links[a];if(r)for(var o in r)if(r.hasOwnProperty(o)){var s=r[o];if(s)for(var l in s)if(s.hasOwnProperty(l)){var c=s[l];for(var d in c)if(c.hasOwnProperty(d)){var u=a+"#"+o,p=l+"#"+d;n&&(n=!1,e.prepareUpdateView(),e.empty()),e.addRow({inValue:u,outValue:p});var h={inID:a,inProp:o,outID:l,outProp:d};this._mapToFill[i]=h,i++}}}}n||(e.pushUpdateView(),e._endResizeCallback())}}})}),define("DS/VCXWebGUI/VCXTimelineController",["DS/CoreEvents/Events","DS/WebRBTree/WebRBIterator","DS/VCXWebTimeline/VCXWebTimelineController","DS/VCXWebKernelCommands/VCXCmdChangeKeys","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdChangeTimePos","DS/VCXWebKernel/VCXCmdGoToMarker","DS/ApplicationFrame/CommandsManager","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebProperties/VCXPropertySet"],function(e,t,n,i,a,r,o,s,l,c){"use strict";return n.extend({init:function(t){this._parent(t);var n=this;this._VCX_Timeline_MODEL_STOP_PLAY=e.subscribe({event:"VCX_STOP_PLAY"},function(e){n.options.experienceBase.getManager("VCXContextManager")&&n.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0);for(var t=0;t<n._timelines.length;t++)n._timelines[t].timeline.playGUIMode();n.updateTimelineFromModel()}),this._VCX_Timeline_MODEL_PAUSE_PLAY=e.subscribe({event:"VCX_PAUSE_PLAY"},function(e){n.options.experienceBase.getManager("VCXContextManager")&&n.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0);for(var t=0;t<n._timelines.length;t++)n._timelines[t].timeline.playGUIMode()}),this._VCX_Timeline_MODEL_START_PLAY=e.subscribe({event:"VCX_START_PLAY"},function(e){n.options.experienceBase.getManager("VCXContextManager")&&n.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!1);for(var t=0;t<n._timelines.length;t++)n._timelines[t].timeline.pauseGUIMode()}),this._VCX_SCENARIO_END_REACHED=e.subscribe({event:"VCX_SCENARIO_END_REACHED"},function(){n.onScenarioEnd()}),this._VCX_GOTO_MARKER=e.subscribe({event:"VCX_GOTO_MARKER"},function(e){n.goToMarker(e)}),this._VCX_KEYS_CHANGED=e.subscribe({event:"VCX_KEYS_CHANGED"},function(e){if(null!==n._nodeClass&&null!==e){var t=[];for(var i in e.setModifiablesTrackModified)t.push(i);n._updateListOfMarkers("update",t,e.keysForDo)}}),this._VCX_TIMEPOS_CHANGED=e.subscribe({event:"VCX_TIMEPOS_CHANGED"},function(e){n.updateTimelineFromModel()})},RemoveTimelineEvents:function(){this._parent(),e.unsubscribe(this._VCX_SCENARIO_END_REACHED),e.unsubscribe(this._VCX_GOTO_MARKER),e.unsubscribe(this._VCX_KEYS_CHANGED),e.unsubscribe(this._VCX_TIMEPOS_CHANGED),e.unsubscribe(this._VCX_Timeline_MODEL_START_PLAY),e.unsubscribe(this._VCX_Timeline_MODEL_PAUSE_PLAY),e.unsubscribe(this._VCX_Timeline_MODEL_STOP_PLAY),this._VCX_SCENARIO_END_REACHED=0,this._VCX_GOTO_MARKER=0,this._VCX_KEYS_CHANGED=0,this._VCX_TIMEPOS_CHANGED=0,this._VCX_Timeline_MODEL_START_PLAY=0,this._VCX_Timeline_MODEL_PAUSE_PLAY=0,this._VCX_Timeline_MODEL_STOP_PLAY=0},onScenarioEnd:function(){this.options.experienceBase.getManager("VCXContextManager")&&this.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),this.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1);for(var e=0;e<this._timelines.length;e++)this._timelines[e].timeline.playGUIMode()},actionOnKey:function(e,t,n,a,r,o,s,l){var c=this.getModifiableFromHashing(n);this._parent(e,t,c,a,r,o,s);var d=!1;void 0===l&&(d=!0,l=new i(this.options.experienceBase.getManager("VCXScenarioManager"))),"move"==e?l.MoveKey(t,c,a,r,o):"copy"==e?l.ChangeKey(t,c,a,o,key.GetValue()):"delete"==e&&l.ChangeKey(t,c,a,r,null),d&&this.options.experienceBase.getManager("VCXCommandManager").Push(l)},ChangeTimePos:function(e,t){this._parent(e,t),"record"===this.options.experienceBase.odt&&this.getFrameFromModel()!==e&&this.options.experienceBase.getManager("VCXODTManager").LogAPI("VCXChangeTimePos",e);var n=new r(this.options.experienceBase.getManager("VCXScenarioManager")),i=void 0,a=void 0;void 0!==e.from?(i=e.from,a=e.to):"number"==typeof e&&(a=e),n.ChangeTimePos(a,i),this.options.experienceBase.getManager("VCXCommandManager").Push(n)},onTimelineGoToMarker:function(e){this._parent(e);this.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario()&&(this.options.experienceBase.getManager("VCXContextManager")&&this.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),this.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1));var t=new o(this.options.experienceBase.getManager("VCXScenarioManager"),this.options.experienceBase.getManager("VCXCommandManager"),this.getComponentsMap());t.GoToMarker(e.id),this.options.experienceBase.getManager("VCXCommandManager").Push(t)},goToMarker:function(e){this._parent();this.options.experienceBase.getManager("VCXScenarioManager").SetCurrentFrame(e),this.updateTimelineFromModel()},onTimelineNextMarker:function(){this._parent();this.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario()&&(this.options.experienceBase.getManager("VCXContextManager")&&this.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),this.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1));var e=new o(this.options.experienceBase.getManager("VCXScenarioManager"),this.options.experienceBase.getManager("VCXCommandManager"),this.getComponentsMap());e.GoToNextMarker(),this.options.experienceBase.getManager("VCXCommandManager").Push(e)},OnTimelinePreviousMarker:function(){this._parent();this.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario()&&(this.options.experienceBase.getManager("VCXContextManager")&&this.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),this.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1));var e=new o(this.options.experienceBase.getManager("VCXScenarioManager"),this.options.experienceBase.getManager("VCXCommandManager"),this.getComponentsMap());e.GoToPreviousMarker(),this.options.experienceBase.getManager("VCXCommandManager").Push(e)},onTimelineCamera:function(e){this._parent(e);var t=null,n=this.options.experienceBase.getManager("VCXContextManager");n&&(t=n.getContext());var i=s.getCommandCheckHeader("VCXCameraPlayModeCmd",t);i&&i.setState(e),this.updateTimelineFromModel()},onTimePosChangeStart:function(){this._parent()},onTimePosChangeWhile:function(e){this._startChangeTime&&this.options.experienceBase.getManager("VCXCommandManager").StartTransaction(),this._parent(e),this._startChangeTime=!1},onTimePosChangeEnd:function(e){this._parent(e),this._startChangeTime=!0,this._startChangeTime&&this.options.experienceBase.getManager("VCXCommandManager").EndTransaction()},onStartPlay:function(){if(!this.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario())this.options.experienceBase.getManager("VCXAPIManager").PlayAnimation()},onStopPlay:function(){this.options.experienceBase.getManager("VCXContextManager")&&this.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),this.ChangeTimePos(0,!1),this.options.experienceBase.getManager("VCXScenarioManager").SetIsBouncing(!1),this.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1),e.publish({event:"VCX_STOP_PLAY"}),this.updateTimelineFromModel(),this._parent()},onPausePlay:function(){this.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario()&&(this.options.experienceBase.getManager("VCXContextManager")&&this.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),this.options.experienceBase.getManager("VCXAPIManager").PauseAnimation()),this._parent()},setPropertyOnScenario:function(e,t){var n=this.options.experienceBase.getManager("VCXScenarioManager"),i=this.getScenarioM(n.GetCurrentScenario()).QueryInterface("VCXIModifiable"),r=new a(n,this.options.experienceBase.getManager("VCXCommandManager")),o=null,s=(o=i.GetProperty(e).Clone()).GetPropertyValue();s.SetValue(t),o.SetPropertyValue(s),r.ChangeProperty(i,o),this.options.experienceBase.getManager("VCXCommandManager").Push(r)},setScenarioAnimationLoop:function(e){this.setPropertyOnScenario("Scenario.bIsLoop",e)},setScenarioAnimationBounce:function(e){this.setPropertyOnScenario("Scenario.bIsBounce",e)},setScenarioAnimationReverse:function(e){this.setPropertyOnScenario("Scenario.bIsReverse",e)},onTimelineStepForward:function(){this._parent();var e=this.getFrameFromModel();if(e>this.options.maxFrame){this.options.experienceBase.getManager("VCXContextManager")&&this.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),this.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1);for(var t=0;t<this._timelines.length;t++)this._timelines[t].timeline.playGUIMode()}else{this.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario()&&(this.options.experienceBase.getManager("VCXContextManager")&&this.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),this.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1)),e++,this.ChangeTimePos(e,!0),this.updateTimelineFromModel()}},onTimelineStepBackward:function(){this._parent();var e=this.getFrameFromModel();0!=e&&(this.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario()&&(this.options.experienceBase.getManager("VCXContextManager")&&this.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),this.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1)),e--,this.ChangeTimePos(e,!0),this.updateTimelineFromModel())},getFrameFromModel:function(){return this.options.experienceBase.getManager("VCXScenarioManager").GetCurrentFrame()},getSelection:function(){return this._isFilterOnSelectionMode?this.getCurrentSelection():[]},getCurrentSelection:function(){return this.options.experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection().map(function(e){return e.QueryInterface("VCXIModifiable")})},getScenarioM:function(e){return this.options.experienceBase.getManager("VCXScenarioManager")._Scenarios[e]},getComponentsMap:function(){return this.options.experienceBase.ComponentsMap},getModifiableFromHashing:function(e){return this.options.experienceBase.getManager("VCXScenarioManager").ModifiableServer.GetModifiableFromHashing(e)},getTrackModelFromTrackNode:function(e){},convertTrackNameToDisplayName:function(e,t){var n="";switch(this.convertTrackToId(e,t)){case 0:n="Position";break;case 4:n="Properties";break;case 2:n="Opacity";break;case 1:n="Materials";break;case 5:n="Links";break;case 8:n="Others";break;case 6:n="Viewport";break;case 3:n="Camera";break;case 7:n="Digger";break;default:n="unknown"}return n},removeTrackFromModel:function(e,t,n){for(var a=new i(this.options.experienceBase.getManager("VCXScenarioManager")),r=this.getScenarioM(this.options.scenarioID),o=this.options.experienceBase.getManager("VCXScenarioManager").ModifiableServer,s=0;s<e.length;s++)for(var l=e[s].getParent().options._hash,c=o.GetModifiableFromHashing(l),d=e[s].getChildren()||[],u=0;u<d.length;u++){var p=d[u],h=p.options.strPropertyName,m=p.options.key._frame;a.ChangeKey(r,c,h,m,null)}this.options.experienceBase.getManager("VCXCommandManager").Push(a)},removeTrackFromModelFlatten:function(e,n,a){var r=new i(this.options.experienceBase.getManager("VCXScenarioManager")),o=this.getScenarioM(this.options.scenarioID),s=this.options.experienceBase.getManager("VCXScenarioManager").ModifiableServer,l=[];this.modifiables=this.getSelection(),0!==this.modifiables.length&&this.modifiables.forEach(function(e){var t=e.GetObject().GetID();t?l.push(t):console.log("VCXTimelineExtCtrl: hashing is empty !")});var c=[];if(l&&0!==l.length)for(var d=l.length,u=0;u<d;u++){var p=this.getComponentsMap(),h=l[u],m=p.GetComponentFromID(h);if(m){var g=(b=m.QueryInterface("VCXIModifiable")).GetHashing();c.push(g)}else console.log("component not found here !")}else this.getFilterOnSelectionMode()||o.GetListModifiables(c);var C=c.length;this.flattenKeysArray=[];for(var v=0;v<C;v++){var _=c[v],b=s.GetModifiableFromHashing(_),f=o.GetObjectAnimation(_),S=[];f.GetListTrackNames(S);for(var V=0;V<S.length;V++){if(this.convertTrackNameToDisplayName(S[V],b.GetObject().GetType())===e.options.label){var y=f.GetTrack(S[V]);if(y)for(var x=y._treekeys,P=new t(x),I=P.next();null!==I;){var M=I.GetFrame();n&&a&&(M<n||M>a)?I=P.next():(r.ChangeKey(o,b,S[V],M,null),I=P.next())}}}}this.options.experienceBase.getManager("VCXCommandManager").Push(r)},generateListOfMarkers:function(e,n,i,a){void 0===e&&(e="Add");var r=[];void 0===n&&(this.modifiables=this.getSelection()),0!==this.modifiables.length&&this.modifiables.forEach(function(e){var t=e.GetObject().GetID();t?r.push(t):console.log("VCXTimelineExtCtrl: hashing is empty !")}),this.options.scenarioID;var o=this.getScenarioM(this.options.scenarioID);if(o){if(void 0===n)if(n=[],r&&0!==r.length)for(var s=r.length,l=0;l<s;l++){var c=this.getComponentsMap(),d=r[l],u=c.GetComponentFromID(d);if(u){var p=(g=u.QueryInterface("VCXIModifiable")).GetHashing();n.push(p)}else console.log("component not found here !")}else this.getFilterOnSelectionMode()||o.GetListModifiables(n);var h=n.length;this.flattenKeysArray=[];for(var m=0;m<h;m++){var g,C=n[m],v=o.GetObjectAnimation(C),_=null;if((g=this.getModifiableFromHashing(C))&&(_=g.GetObject().GetID()),v&&_){var b=[];v.GetListTrackNames(b);for(var f=null,S=0;S<b.length;S++){f="#cccccc";var V=b[S],y=v.GetTrack(V);if(y){var x="";x=!0===this.options.flattenKeys?this.convertTrackToId(V,g.GetObject().GetType()):m;for(var P=y._treekeys,I=new t(P),M=I.next();null!==M;){var w=M.GetFrame();w,x,1===x&&!0===this.options.flattenKeys&&M&&M.GetValue()&&M.GetValue()&&M.GetValue().Clone()._value.GetColorHexString&&(f="#"+M.GetValue().Clone()._value.GetColorHexString());var D=null;D||(D={length:1,keyColor:f,componentHash:C,strPropertyName:V,data:M},this.options.flattenKeys,this._addKey(w,1,D.keyColor,x,D.componentHash,D.strPropertyName,D.data,a)),M=I.next()}}}}}}return[]},generateClientTreeTracks:function(e){var t=[],n=this.getScenarioM(this.options.scenarioID);n.GetListModifiables(t);for(var i=0,a=t.length,r=0;r<a;r++){var o=t[r],s=n.GetObjectAnimation(o);if(s){var l=this.getModifiableFromHashing(o),c=this.getModifiableName(l),d=this._createTrackNode(this._nodeClass,c,i,e._getTrueRoot());d._options._hash=o,i=1+d.options.id;var u=[];s.GetListTrackNames(u);for(var p=0;p<u.length;p++){var h=this._createTrackNode(this._nodeClass,u[p],i,d);i=1+h.options.id,h._options.preventDisplayChilds=!0}}}},getTrackTreeListView:function(){for(var e=0;e<this._timelines.length;e++){var t=this._timelines[e].timeline.getTrackTreeListView();if(t)return t}return null},getTimelineModel:function(){for(var e=0;e<this._timelines.length;e++){var t=this._timelines[e].timeline.getTimelineModel();if(t)return t}return null},getModifiableName:function(e){var t=e&&e.GetProperty("Actor.Name"),n=t&&t.GetPropertyValue().GetValue();""===n&&(n=e.GetHashing()+" (no name)");return n},onAddTracksKey:function(e){if(3===e.trackId)s.getCommand("VCXAddCameraKeyCmd",this.options.experienceBase.getManager("VCXContextManager").getContext())&&s.getCommand("VCXAddCameraKeyCmd",this.options.experienceBase.getManager("VCXContextManager").getContext()).begin();else{if(this.modifiables=this.getCurrentSelection(),6===e.trackId){var t=this.options.experienceBase.getManager("VCXContextManager").getActiveViewport();this.modifiables=[],this.modifiables.push(t.QueryInterface("VCXIModifiable"))}if(0!==this.modifiables.length){for(var n=new l,i=0;i<this.modifiables.length;i++){var r=new c,o=this.modifiables[i],d=o.GetProperties();if(d){for(var u in d._map)this.convertTrackToId(u,o.GetObject().GetType())===e.trackId&&r.AddOrModifyProperty(d.GetProperty(u).Clone());n.AddOrModifyPropertySet(o.GetHashing(),r)}}var p=new a(this.options.experienceBase.getManager("VCXScenarioManager"),this.options.experienceBase.getManager("VCXCommandManager"),!0);p.ChangePropertiesFromMap(n),this.options.experienceBase.getManager("VCXCommandManager").Push(p)}}},onSelectionAreaMoveFlatten:function(e){this.getTimelineModel().lock++;for(var t=Math.round(e.timeInitStart*e.timeToFrame),n=Math.round(e.timeInitEnd*e.timeToFrame),a=Math.round(e.timeFinalStart*e.timeToFrame),r=n-t,o=Math.round(e.timeFinalEnd*e.timeToFrame)-a,s=new i(this.options.experienceBase.getManager("VCXScenarioManager")),l=0;l<e.tracks.length;l++){var c=e.tracks[l]._rowID||e.tracks[l]._localID+5,d=this.flattenKeysArray[c];if(d)for(var u in d)if(!(u<t||u>n)){var p=u,h=Math.round(a+(u-t)*o/r);this.actionsOnKeys(null,"move",null,p,h,e.scenarioID,c,s)}}this.getTimelineModel().lock--,this.options.experienceBase.getManager("VCXCommandManager").Push(s)}})}),define("DS/VCXWebGUI/VCXPropertiesPanelView",["UWA/Class","DS/Controls/Accordeon","DS/Controls/LineEditor","i18n!DS/VCXWebProducts/assets/nls/VCXWebProductAuthoringCommands"],function(e,t,n,i){"use strict";var a="noSelectionHighlight",r="vcx-propertiesContainer-empty",o="vcx-properties-mainContent";return e.extend({init:function(e){this._propertiesPanelModel=e,this.createPropertiesContainer(),this.createWatermarkMessage(),this.activeTweakersList=[]},unInitialize:function(){this._tabPageFrame&&(this._tabPageFrame.unInitialize(),delete this._tabPageFrame),this._selectElementMessage.remove(),this._selectElementMessage=null,this.removeContainer(),this._container.remove(),this._container=null,this._panelContent&&(this._panelContent.remove(),this._panelContent=null),this._propertiesPanelModel=null},setFrame:function(e){this._tabPageFrame=e},getTabPageFrame:function(){return this._tabPageFrame},setPanelContent:function(e){this._panelContent=e,this._selectElementMessage.inject(this._panelContent)},getPanelContent:function(){return this._panelContent},createWatermarkMessage:function(){this._selectElementMessage=new UWA.Element("div",{html:"",class:"vcx-selectEltMsgContainer"});var e=new UWA.Element("div",{html:"",class:"vcx-selectEltMsgNode vcx-selectEltMsg-icon fonticon fonticon-touch"}),t=new UWA.Element("div",{html:i.VCXSelectElementMessage,class:"vcx-selectEltMsgNode vcx-selectEltMsg-text"});e.inject(this._selectElementMessage),t.inject(this._selectElementMessage)},createPropertiesContainer:function(){this._container=new UWA.Element("div",{html:"",class:o+" "+a,styles:{height:"100%"}}),this._groupsAccordeon=new t({items:[],style:"divided",exclusive:!1}).inject(this._container)},getPropertiesContainer:function(){return this._container},putContainer:function(){this._panelContent&&this._container&&!this._panelContent.contains(this._container)&&(this._panelContent.classList.remove(r),this._container.inject(this._panelContent))},removeContainer:function(){this.activeTweakersList.every(function(e){return e.destroy?e.destroy():console.warn("a tweaker wasnt properly destroyed: ",e),!0}),this.activeTweakersList=[],this._panelContent&&(this._container&&this._panelContent.contains(this._container)&&(this._panelContent.removeChild(this._container),this.emptyContainerContent()),this._panelContent.classList.add(r))},emptyContainerContent:function(){this._groupsAccordeon&&(this._groupsAccordeon.getContent().removeEventListener("expand",this._expanderExpandCB),this._groupsAccordeon.getContent().removeEventListener("collapse",this._expanderCollapseCB),this._expanderExpandCB=null,this._expanderCollapseCB=null)},createToolbarSearchInput:function(e,t){this._searchCB=t,this._searchView=new n({placeholder:e,selectAllOnFocus:!0,autoCommitFlag:!0,recId:"LineEditor"}),this._searchView.getContent().setStyle("display","inline-block"),this._searchView.getContent().addEvent("change",this._searchCB),this._tabPageFrame},getSearchInputValue:function(){return this._searchView.valueToCommit},createToolbarCommands:function(e,t){this._tabPageFrame&&(this._tabPageFrame._toolbar.addMainItemFixed("VCXRestoreNeutralsCmd","","vcxToolbarButton fonticon-reset ","VCXWebAuthoringCommands/VCXWebAuthoringCommands",i),this._tabPageFrame._toolbar.addMainItemFixed("VCXCaptureInNeutralsCmd","","vcxToolbarButton fonticon-floppy ","VCXWebAuthoringCommands/VCXWebAuthoringCommands",i),this._tabPageFrame._toolbar.addMainItemFixed("VCXFormatPainterCmd","vcxHidden",["vcxToolbarButtonChecked","fonticon-broom vcxFormatPainter"],"VCXWebAuthoringCommands/VCXWebAuthoringCommands",i,null,null,"VCX_FORMAT_PAINTER_START","VCX_FORMAT_PAINTER_END",!0),e&&(this._tabPageFrame._toolbar.addMainItemFixed("VCXLinkedPropCopyCmd","","vcxToolbarButtonIcon","VCXWebDebug/VCXWebDebug",i),this._tabPageFrame._toolbar.addMainItemFixed("VCXLinkedPropPasteCmd","","vcxToolbarButtonIcon","VCXWebDebug/VCXWebDebug",i)),t&&this._tabPageFrame._toolbar.addMainItemFixed("VCXCreateStyleFromSelectedPropertiesCmd","","vcxToolbarButtonIcon","VCXWebDebug/VCXWebDebug",i))},subscribeTweakerEvt:function(e,t){"string"==typeof e&&"function"==typeof t&&this._panelContent&&this._panelContent.addEventListener(e,t)},unsubscribeTweakerEvt:function(e,t){"string"==typeof e&&"function"==typeof t&&this._panelContent&&this._panelContent.removeEventListener(e,t)},updateAccordeon:function(e,t){this._emptyAndRefillAccordeon(e);for(var n=[],i=0;i<t.length;++i){var a=t[i],r=a.GetType(),o=a.QueryInterface("VCXIModifiableView");if(n.includes(r)||n.push(r),!this._propertiesPanelModel.isCollapsedGroupsSavedForComponent(r)){var s=o.getCollapsedGroupsNames();this._propertiesPanelModel.setCollapsedGroupsForComponent(r,s)}}for(var l=this._propertiesPanelModel.getCollapsedGroupsForComponents(n),c=0;c<e.length;++c){var d=e[c],u=this._groupsAccordeon.getExpanderFromIndex(c);u.groupID=d.groupID,d.hideArrow?(u.getContent().addClassName("vcx-HeaderArrowHidden"),u.hideArrow=!0):l.includes(d.groupID)||(u.expandedFlag=!0)}var p=this;this._expanderExpandCB=function(e){var t=e.options.expanderTarget.groupID;t&&p._propertiesPanelModel.removeCollapsedGroupForComponents(n,t)},this._expanderCollapseCB=function(e){var t=e.options.expanderTarget.groupID;t&&p._propertiesPanelModel.addCollapsedGroupForComponents(n,t)},this._groupsAccordeon.getContent().addEventListener("expand",this._expanderExpandCB),this._groupsAccordeon.getContent().addEventListener("collapse",this._expanderCollapseCB)},updateAccordeonForODT:function(e){this._emptyAndRefillAccordeon(e),this._groupsAccordeon.getExpanderFromIndex(0).expandedFlag=!0},_emptyAndRefillAccordeon:function(e){this._groupsAccordeon.clear();for(var t=0;t<e.length;++t){var n=e[t];n&&this._groupsAccordeon.addItem(n)}}})}),define("DS/VCXWebGUI/VCXAmbienceCard",["require","exports","DS/Menu/ContextualMenu","DS/Controls/TooltipModel","DS/VCXGUIInfrastructure/VCXUICard"],function(e,t,n,i,a){"use strict";return class extends a{constructor(e){super(e),this.activeClassName="materialCardActive",this.isDefault="-1"===e.id,this.selectCallback=(()=>console.log("Not defined")),this.unSelectCallback=(()=>console.log("Not defined"));let t=this.cardElement.querySelector(".vcxUICard-descriptionContainer");this.label.addEventListener("keydown",e=>{"Enter"===e.key&&this.label.blur()}),this.isDefault||this.label.setAttribute("contenteditable","true"),this.label.tooltipInfos=new i({shortHelp:e.title}),this.isDefault&&this.hideSelectToogle(),this.contextMenuButton.getContent().style.display="";let n=this.cardElement.querySelector(".vcxUICard-descriptionActionBar");return n.classList.add("materialDescriptionActionBar"),n.classList.add("vcxMaterialCard-descriptionActionBar"),t.classList.add("vcxMaterialCard-descriptionContainer"),this.cardElement.querySelector(".vcxUICard-descriptionTitle").classList.add("vcxMaterialCard-descriptionTitle"),this.thumbnail.addClassName("materialThumbnail"),this}getIsDefault(){return this.isDefault}setOnSelectCardCallback(e){this.selectCallback=e}setOnUnselectCardCallback(e){this.unSelectCallback=e}addRenameCardCallback(e){let t=this;this.label.addEventListener("focus",()=>{var e;null===(e=window.getSelection())||void 0===e||e.selectAllChildren(this.label)}),this.label.addEventListener("blur",function(n){var i;let a=null===(i=null==n?void 0:n.target)||void 0===i?void 0:i.innerHTML;(null==n?void 0:n.target).scrollLeft=0,e(t.getID(),a)})}customizeMenu(e){n.addEventListener(this.contextMenuButton.getContent(),{callback:()=>{let t=new Array;for(let n=0;n<e.length;n++){const i=e[n];let a="enabled";i.considerStateDefault&&this.getIsDefault()&&(a="disabled"),t.push({type:"PushItem",state:a,title:i.label,fonticon:{content:"wux-ui-3ds-"+i.icon+" wux-ui-3ds"},action:{callback:i.action}})}return t}}),this.contextMenuButton.getContent().style.display=""}}});var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXSelectionSetPanel",["require","exports","DS/Controls/Button","DS/Windows/Dialog","DS/Utilities/Dom","DS/Windows/ImmersiveFrame","DS/Controls/Toggle","DS/Controls/LineEditor","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],function(e,t,n,i,a,r,o,s,l){"use strict";l=__importDefault(l);return new class{showChoosePanel(e){return new Promise(t=>{let s=[],c=new n({label:l.default["VCXChooseSelectionSetPanel.Add"],disabled:!0,onClick:e=>{t(s),e.dsModel.dialog.close()}}),d=new r({identifier:"WebUIPanelDocumentation_ChooseSelectionSet"});var u=new n({label:l.default["VCXChooseSelectionSetPanel.Cancel"],onClick:e=>{e.dsModel.dialog.close(),t([])}});let p=UWA.Element("div",{class:"VCXChooseSelectionSetPanel-modal"}),h=UWA.Element("p",{html:l.default["VCXChooseSelectionSetPanel.Text"]}),m=UWA.Element("div",{class:"VCXChooseSelectionSetPanel-containerList"}),g=e._experienceBase.ComponentsMap.GetComponentFromType("VCXSelectionSet_Spec");for(let e=0;e<g.length;e++){let t=g[e],n=t.QueryInterface("VCXIModifiable"),i=UWA.Element("div",{class:"VCXChooseSelectionSetPanel-containerselectionset"}),r=UWA.Element("p",{html:n.GetProperty("Actor.Name").GetPropertyValue().GetValue()}),l=a.generateIcon({iconPath:"../VCXWebTreeGUI/assets/icons/32/I_VCX_Tree_SelectionSetxH.png"}),d=new o({type:"checkbox",value:e});d.inject(i),l.inject(i),r.inject(i),i.inject(m),d.addEventListener("buttonclick",function(e){if(e.dsModel.checkFlag)s.push(t);else{let e=s.indexOf(t);-1!==e&&s.splice(e)}c.disabled=0===s.length})}h.inject(p),m.inject(p),new i({immersiveFrame:d,modalFlag:!0,closeButtonFlag:!1,touchMode:!0,resizableFlag:!1,movableFlag:!1,title:l.default["VCXChooseSelectionSetPanel.title"],content:p,buttons:{Open:c,Close:u}}).addEventListener("close",()=>t([])),d.inject(e.elements.modalDialogContainer)})}showRenamePanel(e,t){return new Promise(a=>{let o=null,c=new n({label:l.default["VCXRenameSelectionSetPanel.Apply"],disabled:!0,onClick:e=>{a(o),e.dsModel.dialog.close()}}),d=new r({identifier:"WebUIPanelDocumentation_RenameSelectionSet"});var u=new n({label:l.default["VCXRenameSelectionSetPanel.Cancel"],onClick:e=>{e.dsModel.dialog.close(),a(null)}});let p=UWA.Element("div",{class:"VCXRenameSelectionSetPanel-modal"}),h=UWA.Element("p",{html:l.default["VCXRenameSelectionSetPanel.Text"]}),m=new s({value:t,sizeInCharNumber:40,selectAllOnFocus:!0,displayClearFieldButtonFlag:!0,maxLength:20});m.addEventListener("uncommittedChange",function(){o=m.valueToCommit,c.disabled=null===o||0===o.length}),h.inject(p),m.inject(p),new i({immersiveFrame:d,modalFlag:!0,closeButtonFlag:!1,touchMode:!0,resizableFlag:!1,movableFlag:!1,title:l.default["VCXRenameSelectionSetPanel.title"],content:p,buttons:{Open:c,Close:u}}).addEventListener("close",()=>a(null)),d.inject(e.elements.modalDialogContainer)})}}}),define("DS/VCXWebGUI/VCXMediaChooserServices",["UWA/Class","DS/VCXWebProperties/VCXPropertyValueDocId","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXMediaChooser/VCXChoosePicture","DS/VCXMediaChooser/VCXImageGallery"],function(e,t,n,i,a){"use strict";return e.extend({init:function(e){this._experienceBase=e},GetDocIDFromImageLoadQuery:function(){if(this._experienceBase.odt){var e=this._experienceBase.getManager("VCXDocManager").QueryInterface("VCXIModifiable"),n=e&&e.GetDefaultImageIdx();return new t(n)}var a=UWA.Promise.deferred(),r=new i(this._experienceBase);"undefined"!=typeof widget&&r.setWidget(widget),r.open(function(e,t){this._imageUrl=e,this._fileName=t}.bind(this),function(e,t){o(this._imageUrl,this._fileName)}.bind(this));var o=function(e,t){if(e){var n=this._experienceBase.getManager("VCXDocManager"),i=n.BuildPathFromString(e,t),r=n.AddOrModifyDoc(i);a.resolve(r)}else a.resolve(null)}.bind(this);return a.promise}})}),define("DS/VCXWebGUI/VCXPaperPanCmd",["DS/ApplicationFrame/Command"],function(e){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0})},beginExecute:function(){this._activatePanForPaper(!0),this._viewer=this.getFrameWindow()&&this.getFrameWindow().getViewer(),this._viewer.startPan(this)},endExecute:function(){this._activatePanForPaper(!1),this._viewer.endPan(this),this._viewer=null},_activatePanForPaper:function(e){this._experienceBase=this.getFrameWindow()._experienceBase;var t=this._experienceBase&&this._experienceBase.getManager("VCXPaperManager");t&&t.ActivatePaperPan(e)}})}),define("DS/VCXWebGUI/VCXStatsCtrl",["UWA/Class","DS/CoreEvents/Events","DS/Windows/Panel"],function(e,t,n){"use strict";return e.extend({init:function(e){var i=this;i.dataMaster={},i.dataMaster.fps="",this.options=e,i.statsContent=new UWA.Element("div"),this._panelMaster=new n({immersiveFrame:e.immersiveFrame,currentDockArea:e.currentDockArea||4,title:"Stats",content:i.statsContent}),e.immersiveFrame.addWindow(this._panelMaster);var a=new Stats,r=function(){a.update(),i.dataMaster.fps=a.domElement.childNodes[0].childNodes[0].childNodes[0].data,i.updateUI(),i.fpsReq=requestAnimationFrame(r)};this.fpsReq=requestAnimationFrame(r),this._tokenChanged=t.subscribe({event:"VCX_STATS_UPDATE"},function(e){i.updateStatsFromData(e)}),this._tokenRemove=t.subscribe({event:"VCX_STATS_REMOVE"},function(e){i.removeTrackingData(e)}),this._tokenEmpty=t.subscribe({event:"VCX_STATS_EMPTY"},function(){i.emptyTrackingData()})},destroy:function(){window.cancelAnimationFrame(this.fpsReq),this.options.immersiveFrame.removeWindow(this._panelMaster),t.unsubscribe(this._tokenChanged),this._tokenChanged=null,t.unsubscribe(this._tokenRemove),this._tokenRemove=null,t.unsubscribe(this._tokenEmpty),this._tokenEmpty=null},removeTrackingData:function(e){delete this.dataMaster[e.id]},emptyTrackingData:function(e){this.dataMaster={}},updateStatsFromData:function(e){this.dataMaster[e.id]=e.value,this.updateUI()},updateUI:function(){var e="";for(var t in this.dataMaster)e+=t+": "+this.dataMaster[t]+", ";this.statsContent.innerHTML=e}})}),define("DS/VCXWebGUI/VCXPaperCtrlV2",["UWA/Class","DS/CoreEvents/Events","DS/ApplicationFrame/CommandsManager","DS/Tweakers/GeneratedToolbar","DS/TreeModel/TreeNodeModel","DS/VCXWebKernelCommands/VCXCmdRequestChangeProperties","DS/WebappsUtils/WebappsUtils","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],function(e,t,n,i,a,r,o,s){"use strict";var l=e.extend({init:function(e,t){if(this._vcxGuiManager=e,this._experienceBase=null,null!=t&&(this._experienceBase=t),this._vcxPaperManager=this._experienceBase.getManager("VCXPaperManager"),this._touchCompliant=this._vcxGuiManager.isTouchActivated(),this._contextManager=this._experienceBase.getManager("VCXContextManager"),this._contextManager){this.listRatios={a4l:{title:s["VCXPaperCtrl.Ratio.A4L"],ratioWidth:297,ratioHeight:210,specificWidth:297,icon:o.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio16_9.png")},a4p:{title:s["VCXPaperCtrl.Ratio.A4P"],ratioWidth:210,ratioHeight:297,specificWidth:210,icon:o.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio9_16.png")},square:{title:s["VCXPaperCtrl.Ratio.Square"],ratioWidth:1,ratioHeight:1,icon:o.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio1_1.png")},default:{title:s["VCXPaperCtrl.Ratio.Wide"],ratioWidth:16,ratioHeight:9,icon:o.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio16_9.png")},_35mm:{title:s["VCXPaperCtrl.Ratio.mm35"],ratioWidth:4,ratioHeight:3,icon:o.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio4_3.png")},goldenRatio:{title:s["VCXPaperCtrl.Ratio.GoldenRatio"],ratioWidth:16,ratioHeight:10,icon:o.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio16_9.png")},wsc:{title:s["VCXPaperCtrl.Ratio.WideScreenCinema"],ratioWidth:2.35,ratioHeight:1,icon:o.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio235_1.png")},iphonexP:{title:s["VCXPaperCtrl.Ratio.iPhoneXP"],ratioWidth:9,ratioHeight:19.5,icon:o.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio9_195.png")},iphonexL:{title:s["VCXPaperCtrl.Ratio.iPhoneXL"],ratioWidth:19.5,ratioHeight:9,icon:o.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio195_9.png")}},this._aspectRatio=this.listRatios.a4l,this._isToolbarReady=!1;var n=this.getPaperCtrlBarModel(),a="scroll";this._touchCompliant&&(a="scroll"),this.paperControlToolbar=new i({overflowManagement:a,direction:"horizontal",items:n}),this.paperControlToolbar.elements.container.addClassName("VCXPaperCtrlV2"),localStorage.getItem("VCXNewFrame")?document.querySelector(".vcxTopContainer").appendChild(this.paperControlToolbar.getContent()):(this.paperControlToolbar.inject(this._vcxGuiManager.getUsableArea()),this.updateRatioDisplay()),this.registerToolbarEvents()}else console.error("No ContextManager found, paperCtrl initialization aborted..")},unInitialize:function(){this.unRegisterToolbarEvents(),this.paperControlToolbar&&this.paperControlToolbar.destroy(),this.paperControlToolbar=null,this._experienceBase=null},registerToolbarEvents:function(){var e=this;e.paperControlToolbar.addEventListener("onReady",e._onToolbarReady.bind(e)),localStorage.getItem("VCXNewFrame")||(this.tokenPaperRatio=t.subscribe({event:"VCX_PAPER_RATIO_CHANGED"},function(){e.updateRatioDisplay()}))},unRegisterToolbarEvents:function(){this.tokenPaperRatio&&t.unsubscribe(this.tokenPaperRatio),this._zoomChangedToken&&t.unsubscribe(this._zoomChangedToken),this._panChangedToken&&t.unsubscribe(this._panChangedToken)},GetAspectRatio:function(){return this._aspectRatio},SetAspectRatio:function(e){this._aspectRatio=e},updatePaperArea:function(e,t){if(this._isToolbarReady){e&&(e.top+=this.paperControlToolbar.elements.container.offsetHeight,e.height-=this.paperControlToolbar.elements.container.offsetHeight),t&&(t.top+=this.paperControlToolbar.elements.container.offsetHeight,t.height-=this.paperControlToolbar.elements.container.offsetHeight);var n=this.paperControlToolbar.elements.container.offsetWidth,i=this.paperControlToolbar.elements.nearContainer.offsetWidth+this.paperControlToolbar.elements.centerContainer.offsetWidth+this.paperControlToolbar.elements.farContainer.offsetWidth+10;i>=n&&!this._wideDisplayWidth&&(this._wideDisplayWidth=i),this._touchCompliant?this._toolbarDisplayStyle!==l.responsiveStyle.NoLabels&&this._changeBarStyle(l.responsiveStyle.NoLabels):this._wideDisplayWidth&&(n>=this._wideDisplayWidth?this._toolbarDisplayStyle!==l.responsiveStyle.Wide&&(this._changeBarStyle(l.responsiveStyle.Wide),this._wideDisplayWidth=null):n<475?this._toolbarDisplayStyle!==l.responsiveStyle.Compact&&this._changeBarStyle(l.responsiveStyle.Compact):this._toolbarDisplayStyle!==l.responsiveStyle.NoLabels&&this._changeBarStyle(l.responsiveStyle.NoLabels))}},_changeBarStyle:function(e){switch(e){default:break;case 1:var t=this._getLabelElements();Array.prototype.forEach.call(t,function(e){"none"===e.style.display&&(e.style.display="")}),this._toolbarDisplayStyle=l.responsiveStyle.Wide;break;case 2:t=this._getLabelElements();Array.prototype.forEach.call(t,function(e){e.style.display="none"}),this._toolbarDisplayStyle=l.responsiveStyle.NoLabels;break;case 3:t=this._getLabelElements();Array.prototype.forEach.call(t,function(e){e.style.display="none"}),this._toolbarDisplayStyle=l.responsiveStyle.Compact}},_getLabelElements:function(){if(this.paperControlToolbar&&this.paperControlToolbar.elements.container)return this.paperControlToolbar.elements.container.querySelectorAll(".VCXPaperCtrlV2 .wux-controls-toolbar-mask-container .wux-toolbar-items .wux-generated-toolbar-items-label, .VCXPaperCtrlV2 .wux-controls-toolbar-mask-container .wux-tweakers-string-label, .VCXPaperCtrlV2 .wux-controls-button > span")},_onToolbarReady:function(){var e=this;this._isToolbarReady=!0,this._vcxPaperManager.getPaperVisibility()&&this.paperControlToolbar.elements.farContainer.getElementsByClassName("wux-tweaker-function")[0].addClassName("vcx-state-active"),e._vcxPaperManager.AutoFit&&e.paperControlToolbar.elements.centerContainer.getElementsByClassName("wux-tweaker-function")[0]&&e.paperControlToolbar.elements.centerContainer.getElementsByClassName("wux-tweaker-function")[0].addClassName("vcx-ui-hidden");var n=this.paperControlToolbar.elements.centerContainer.getElementsByClassName("wux-tweaker-function")[0];this._zoomChangedToken=t.subscribe({event:"/VCX/Paper/ZoomChanged"},function(t){t&&n&&(t.autoFit?n.addClassName("vcx-ui-hidden"):n.removeClassName("vcx-ui-hidden")),t&&!t.updatePaper&&(e._lockupdatePaper=!0),e.paperControlToolbar.getNodeModelByID("zoomPercentage").getAttributeValue("data")!==100*e._vcxPaperManager.Zoom&&e.paperControlToolbar.updateNodeModel("zoomPercentage",{grid:{data:100*e._vcxPaperManager.Zoom}}),e._lockupdatePaper=!1,e._checkPaperSpace()}),this._panChangedToken=t.subscribe({event:"/VCX/Paper/PanChanged"},function(t){t&&n&&(t.autoFit?n.addClassName("vcx-ui-hidden"):n.removeClassName("vcx-ui-hidden")),e._checkPaperSpace()}),this._contextManager.isSupported("DisplayPaperCtrlBtns")||this.hide(),this._vcxGuiManager.updateUsableArea(),this.updatePaperArea(),this._checkPaperSpace()},_checkPaperSpace:function(){document.getElementById("divPaperSpace")&&document.getElementById("divPaperSpace").getBoundingClientRect().y<this.paperControlToolbar.elements.container.offsetHeight?this.paperControlToolbar.elements.container.style.background="#FFFFFF91 0% 0% no-repeat padding-box":this.paperControlToolbar.elements.container.style.removeProperty("background")},hide:function(){this.paperControlToolbar.elements.container.hide()},show:function(){this.paperControlToolbar.elements.container.show()},isHidden:function(){return this.paperControlToolbar&&"none"===this.paperControlToolbar.elements.container.style.display},updateRatioDisplay:function(){var e,t=!1,n=this.GetAspectRatio(),i=Math.round(this._vcxPaperManager.GetWidth()/this._vcxPaperManager.GetHeight()*1e4)/1e4;0!==Object.keys(n).length&&(i!==Math.round(n.ratioWidth/n.ratioHeight*1e4)/1e4||n.specificWidth&&n.specificWidth!==this._vcxPaperManager.GetWidth()||(t=!0));if(!t)for(var a in this.listRatios)if(this.listRatios.hasOwnProperty(a)){var r=this.listRatios[a];if(r.calculatedValue===i&&(!r.specificWidth||r.specificWidth===this._vcxPaperManager.GetWidth())){this.SetAspectRatio(r),t=!0;break}}if(t)e=this.GetAspectRatio().title;else{this.SetAspectRatio({}),e=Math.round(this._vcxPaperManager.GetWidth())+" x "+Math.round(this._vcxPaperManager.GetHeight())}this.paperControlToolbar.updateNodeModel("ratioDisplayText",{grid:{data:e}});let o=this.getPaperChooserMenu(this.GetAspectRatio());this.paperControlToolbar.updateNodeModel("PaperRatioChooser",{grid:{data:o}})},getPaperCtrlBarModel:function(){var e=this._contextManager.getContext();let t=n.getCommand("VisuPanViewPaper",e);var a={entries:[...localStorage.getItem("VCXNewFrame")?[]:[{id:"ratioIcon",dataElements:{typeRepresentation:"default",icon:{iconName:"aspect-ratio",fontIconFamily:1}},position:"near",category:"1",readOnly:!0},{id:"ratioDisplayText",dataElements:{typeRepresentation:"string",value:""},position:"near",category:"1",readOnly:!0},{id:"PaperRatioChooser",dataElements:{typeRepresentation:"chevronMenuIcon",value:{menu:[{type:"TitleItem",title:s["VCXPaperCtrlV2.CanvasAspectRatio"]}]},position:"near",category:"1"}}],...localStorage.getItem("VCXNewFrame")?[{id:"experienceName",dataElements:{typeRepresentation:"string",readOnly:!0,value:this._experienceBase.getManager("VCXContextManager").getRootComponentName(),position:"near",category:"1"}},{id:"undoButton",dataElements:{typeRepresentation:"functionIcon",value:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"executeCommand",argument:{this:this,cmdId:"VCXUndoCmd"}},icon:{iconName:"undo",fontIconFamily:1},position:"near",category:"2"}}]:[],{id:"ReframePaperButton",dataElements:{typeRepresentation:"function",action:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"reframePaper",argument:this},icon:{iconName:"zoom-fit",fontIconFamily:1},label:s["VCXPaperCtrlV2.Reframe"],position:"center",category:"1"}},{id:"ShowHidePaperButton",dataElements:{typeRepresentation:"function",action:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"showHidePaper",argument:this},icon:{iconName:"eye-windowed",fontIconFamily:1},label:s["VCXPaperCtrlV2.Canvas"],displayLabel:!localStorage.getItem("VCXNewFrame")&&void 0,position:"far",category:"1"}},...localStorage.getItem("VCXNewFrame")?[]:[{id:"ZoomMinus",dataElements:{typeRepresentation:"functionIcon",action:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"incrementZoomTweaker",argument:{this:this,increment:-10}},icon:{iconName:"minus",fontIconFamily:1},position:"far",category:"3"}},{id:"ZoomPlus",dataElements:{typeRepresentation:"functionIcon",action:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"incrementZoomTweaker",argument:{this:this,increment:10}},icon:{iconName:"plus",fontIconFamily:1},position:"far",category:"3"}}],...t?[{id:"PanPaperButton",dataElements:{position:"far",category:localStorage.getItem("VCXNewFrame")?"1":"2",typeRepresentation:"function",label:s["VCXPaperCtrlV2.Move"],displayLabel:!localStorage.getItem("VCXNewFrame")&&void 0,action:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"panPaper",argument:{this:this,panCmd:t}},icon:{iconName:"arrow-double-combo",fontIconFamily:1}}}]:[],{id:"zoomPercentage",dataElements:{typeRepresentation:"integer",stepValue:5,minValue:10,maxValue:400,value:100,units:"%",label:s["VCXPaperCtrlV2.Zoom"],position:"far",category:localStorage.getItem("VCXNewFrame")?"1":"3"},onNodeUpdate:this._percentageTweakerUpdate.bind(this)},...localStorage.getItem("VCXNewFrame")?[{id:"previewButton",dataElements:{typeRepresentation:"function",label:s["VCXPaperCtrlV2.Preview"],value:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"executeCommand",argument:{this:this,cmdId:"VCXPreviewModeCmd"}},icon:{iconName:"3d-object",fontIconFamily:1},position:"far",category:"2"}},{id:"publishButton",dataElements:{typeRepresentation:"functionIcon",value:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"executeCommand",argument:{this:this,cmdId:"VCXDisplayPanelPublishMediaCmd"}},icon:{iconName:"picture-export",fontIconFamily:1},position:"far",category:"2"}},{id:"saveButton",dataElements:{typeRepresentation:"functionIcon",value:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"executeCommand",argument:{this:this,cmdId:"VCXSaveCmd"}},icon:{iconName:"floppy",fontIconFamily:1},position:"far",category:"2"}},{id:"contextualMenuButton",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"menu-dot",fontIconFamily:1},position:"far",category:"3"}}]:[]]};if(!localStorage.getItem("VCXNewFrame"))for(var r in this.listRatios)if(this.listRatios.hasOwnProperty(r)){var o=this.listRatios[r];o.calculatedValue=Math.round(o.ratioWidth/o.ratioHeight*1e4)/1e4;var l={type:"RadioItem",title:o.title,state:"selected",action:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"changeRatio",argument:{this:this,ratio:o}},icon:o.icon};a.entries[a.entries.findIndex(function(e){return"PaperRatioChooser"===e.id})].dataElements.value.menu.push(l)}return i.prototype.createTreeDocument(a)},getPaperChooserMenu:function(e){let t={menu:[{type:"TitleItem",title:s["VCXPaperCtrlV2.CanvasAspectRatio"]}]};for(var n in console.log(e),this.listRatios)if(this.listRatios.hasOwnProperty(n)){var i=this.listRatios[n];i.calculatedValue=Math.round(i.ratioWidth/i.ratioHeight*1e4)/1e4;var a={type:"RadioItem",title:i.title,state:e.title===i.title?"selected":"",action:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"changeRatio",argument:{this:this,ratio:i}},icon:i.icon};t.menu.push(a)}return t},_percentageTweakerUpdate:function(e){if(this._experienceBase&&!this._lockupdatePaper){var t=e.getAttributeValue("data");this._vcxPaperManager.Zoom=t/100}}});return l.showHidePaper=function(e){var t=e,n=!t._vcxPaperManager.getPaperVisibility();t._vcxPaperManager.setPaperVisibility(n);var i=t.paperControlToolbar.elements.farContainer.getElementsByClassName("wux-tweaker-function")[0];n?i.addClassName("vcx-state-active"):i.removeClassName("vcx-state-active")},l.executeCommand=function(e){let t=e.this,i=e.cmdId,a=e.bToStop;if(""!==i){var r=null,o=t._vcxGuiManager._experienceBase.getManager("VCXContextManager");o&&(r=o.getContext()),n.getCommand(i,r)&&(a?n.getCommand(i,r).end():n.getCommand(i,r).begin())}},l.panPaper=function(e){var t=e.this,n=e.panCmd;if(n){var i,a=t.paperControlToolbar.elements.farContainer.getElementsByClassName("wux-tweaker-function")[1];if(n.isRunning())n.end(),a&&a.removeClassName("vcx-state-active"),t._vcxGuiManager.GetCanvasView()&&(t._vcxGuiManager.GetCanvasView().style.cursor="auto"),(i=document.getElementById("divPaperSpace"))&&i.removeClassName("paper-highlight");else n.begin(),a&&a.addClassName("vcx-state-active"),(i=document.getElementById("divPaperSpace"))&&i.addClassName("paper-highlight");n.onBegin(function(){a&&!a.classList.contains("vcx-state-active")&&a.addClassName("vcx-state-active");var e=document.getElementById("divPaperSpace");e&&!e.classList.contains("paper-highlight")&&e.addClassName("paper-highlight")}),n.onPause(function(e){n.end()}),n.onEnd(function(){a&&a.removeClassName("vcx-state-active"),t._vcxGuiManager.GetCanvasView()&&(t._vcxGuiManager.GetCanvasView().style.cursor="auto");var e=document.getElementById("divPaperSpace");e&&e.removeClassName("paper-highlight")})}},l.reframePaper=function(e){var t=e,n=t._vcxPaperManager.ToggleAutoFit(),i=t.paperControlToolbar.elements.centerContainer.getElementsByClassName("wux-tweaker-function")[0];n?i.addClassName("vcx-ui-hidden"):i.removeClassName("vcx-ui-hidden"),t._vcxGuiManager.updateUsableArea()},l.changeRatio=async function(e){var t=e.this,n=e.ratio,i=n.ratioWidth,a=n.ratioHeight,o=n.specificWidth;if(i&&a){var s=t._experienceBase.getManager("VCXContextManager").getActiveViewport();if(s){var l=s.QueryInterface("VCXIModifiable");if(l){var c=t._experienceBase.getManager("VCXCommandManager");t.SetAspectRatio(n);var d=new r(t._experienceBase.getManager("VCXScenarioManager"),c,!1),u=t._vcxPaperManager.GetWidth();if(o){u=o;var p=l.GetProperty("Paper.Width").Clone(),h=p.GetPropertyValue().Clone();h.SetValue(u),p.SetPropertyValue(h),await d.RequestModification([l],"Paper.Width",h),c.Push(d)}u*=a/i;var m=l.GetProperty("Paper.Height").Clone(),g=m.GetPropertyValue().Clone();g.SetValue(u),m.SetPropertyValue(g),await d.RequestModification([l],"Paper.Height",g),c.Push(d)}}}},l.incrementZoomTweaker=function(e){var t=e.this,n=e.increment;if(null!==t._experienceBase){var i=100*t._vcxPaperManager.Zoom+n;t.paperControlToolbar.updateNodeModel("zoomPercentage",{grid:{data:i}})}},l.responsiveStyle={Wide:1,NoLabels:2,Compact:3},l}),define("DS/VCXWebGUI/VCXMaterialCard",["require","exports","DS/Menu/ContextualMenu","UWA/Core","DS/Utilities/Dom","DS/Controls/TooltipModel","DS/VCXGUIInfrastructure/VCXUICard"],function(e,t,n,i,a,r,o){"use strict";return class extends o{constructor(e){super(e),this.activeClassName="materialCardActive",this.isInternal=!!e.hasOwnProperty("isInternal")&&e.isInternal,this.isVisible=!!e.hasOwnProperty("isVisible")&&e.isVisible,this.label.addEventListener("keydown",e=>{"Enter"===e.key&&this.label.blur()}),this.label.tooltipInfos=new r({shortHelp:e.title}),this.isInternal&&this.hideSelectToogle(),this.selectCallback=(()=>console.log("Not defined")),this.unSelectCallback=(()=>console.log("Not defined")),this.contextMenuButton.getContent().style.display="";let t=this.cardElement.querySelector(".vcxUICard-descriptionActionBar");t.classList.add("materialDescriptionActionBar"),t.classList.add("vcxMaterialCard-descriptionActionBar"),this.cardElement.querySelector(".vcxUICard-descriptionContainer").classList.add("vcxMaterialCard-descriptionContainer"),this.cardElement.querySelector(".vcxUICard-descriptionTitle").classList.add("vcxMaterialCard-descriptionTitle"),this.iconVisible=(0,i.createElement)("div",{html:"",class:"iconVisibleContainer"});let n=a.generateIcon({iconName:"raw-material",fontIconFamily:WUXManagedFontIcons.Font3DS,className:"vcxSceneUpdate materialVisibleInScene"});if(this.iconVisible.style.display="none",n.inject(this.iconVisible),this.iconVisible.inject(t),this.thumbnail.addClassName("materialThumbnail"),this.iconOverruled=(0,i.createElement)("div",{html:"",class:"vcxUICard-thumbnail vcxUICard-thumbnail overlayIndexingMaterial"}),(0,i.createElement)("div",{html:"Overruled",class:"overruledText"}).inject(this.iconOverruled),this.iconOverruled.inject(this.cardElement),this.iconIndexing=(0,i.createElement)("div",{html:"",class:"vcxUICard-thumbnail vcxUICard-thumbnail overlayIndexingMaterial"}),e.cardLayout&&e.cardLayout.ratioX&&e.cardLayout.ratioY&&e.cardLayout.cardWidth){let t=e.cardLayout.cardWidth*e.cardLayout.ratioY/e.cardLayout.ratioX;this.iconIndexing.style.height=t+"px",this.iconOverruled.style.height=t+"px"}return a.generateIcon({iconName:"clock",fontIconFamily:WUXManagedFontIcons.Font3DS,className:"iconIndexingMaterial"}).inject(this.iconIndexing),this.iconIndexing.inject(this.cardElement),this.iconIndexing.style.display="none",this.iconOverruled.style.display="none",this}updateThumbnail(e){this.thumbnail.src=e}getIndexingIcon(){return this.iconIndexing}setOverruledIcon(e){this.iconOverruled.style.display=e?"":"none"}setIndexingIcon(e){this.iconIndexing.style.display=e?"none":""}getIsInternal(){return this.isInternal}getVisibleLabel(){return this.iconVisible}activateCard(){this.cardElement.hasClassName("materialCardVisible")&&this.cardElement.removeClassName("materialCardVisible"),this.cardElement.addClassName(this.activeClassName)}deactivateCard(){this.cardElement.removeClassName(this.activeClassName),this.isVisible&&this.cardElement.addClassName("materialCardVisible")}getVisibleState(){return this.isVisible}setVisibleCardIcon(){this.isVisible=!0,this.cardElement.addClassName("materialCardVisible")}setNotVisibleCardIcon(){this.isVisible=!1,this.cardElement.removeClassName("materialCardVisible")}setOnSelectCardCallback(e){this.selectCallback=e}setOnUnselectCardCallback(e){this.unSelectCallback=e}customizeMenu(e){n.addEventListener(this.contextMenuButton.getContent(),{callback:()=>{let t=new Array;for(let n=0;n<e.length;n++){const i=e[n];let a="enabled";(i.considerStateSelect&&!this.getVisibleState()||i.considerStateDelete&&this.getIsInternal())&&(a="disabled"),t.push({type:"PushItem",state:a,title:i.label,fonticon:{content:"wux-ui-3ds-"+i.icon+" wux-ui-3ds"},action:{callback:i.action}})}return t}}),this.contextMenuButton.getContent().style.display=""}}}),define("DS/VCXWebGUI/VCXFrameBoxing",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValuePoint","DS/VCXWebProperties/VCXPropertyValueLocation","DS/VCXWebSystem/VCXMathTools","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],function(e,t,n,i,a,r,o,s,l,c){"use strict";return e.extend({init:function(){},GetPropertiesForGUI:function(e,t,a){var r,c,d=(t.GetPropertyName()||"Actor.PropertyFrame")+"_",u={hiddenFields:[],propertyPosition:null,propertyOrientation:null,propertyScale:null,propertyPivot:null};e instanceof s?(r=e.GetFrame().GetValue(),c=e.GetPivot().GetValue()):r=e.GetValue();var p=r.decompose(),h=p[0],m=p[1],g=p[2],C=new i(d+"Position",null,!1,t.Geti18n()),v=new o(h);u.propertyPosition=new n(C,v),a&&a.includes("Position")&&u.hiddenFields.push("propertyPosition");var _=new i(d+"Orientation",null,!1,t.Geti18n()),b=new o(l.getEulerFromQuaternion(m).multiplyScalar(180/Math.PI));u.propertyOrientation=new n(_,b),a&&a.includes("Orientation")&&u.hiddenFields.push("propertyOrientation");var f=new i(d+"Scale",null,!1,t.Geti18n()),S=new o(g);if(u.propertyScale=new n(f,S),a&&a.includes("Scale")&&u.hiddenFields.push("propertyScale"),c){var V=c.decompose()[0],y=new i(d+"Pivot",null,!1,t.Geti18n()),x=new o(V);u.propertyPivot=new n(y,x),a&&a.includes("Pivot")&&u.hiddenFields.push("propertyPivot")}return u},UpdateMapForGUI:function(e,n){for(var i=n.propName,a=n.value,r=["Scale","Pivot","ColumnX","ColumnY","ColumnZ","Orientation","Position"],s="",l=0;l<r.length;++l){var c=r[l];if(i.includes(c)){s="property"+c;break}}if(s){var d=e[s];return d&&(d.GetPropertyValue()instanceof o&&Array.isArray(a)&&("propertyScale"===s&&(a=a.map(function(e){return e<.01?.01:e})),a=new t.Vector3(a[0],a[1],a[2])),d.GetPropertyValue().SetValue(a)),e}console.warn("VCXFrameBoxing#UpdateMapForGUI: Couldn't find the property to replace with the new value..")},BuildNewValueFromGUI:function(e){var n=null,i=null,a=new t.Matrix4,o=e.propertyOrientation.GetPropertyValue().GetValue(),c={x:o.x*Math.PI/180,y:o.y*Math.PI/180,z:o.z*Math.PI/180,order:"XYZ"};if(e.propertyPivot){n=new s;var d=e.propertyPivot.GetPropertyValue().GetValue();i=(new t.Matrix4).setPosition(d),n.SetPivot(new r(i))}else n=new r;a=new t.Matrix4;var u=l.getQuaternionFromEuler(c),p=e.propertyPosition.GetPropertyValue().GetValue(),h=e.propertyScale.GetPropertyValue().GetValue();return a.compose(p,u,h),i?n.SetFrame(new r(a)):n.SetValue(a),n.ToString()},getPropertiesNamesNLS:function(e){var t={};return t[e+"_Position"]=c.get("FrameBoxing_Position"),t[e+"_Orientation"]=c.get("FrameBoxing_Orientation"),t[e+"_Scale"]=c.get("FrameBoxing_Scale"),t[e+"_Pivot"]=c.get("FrameBoxing_Pivot"),t}})}),define("DS/VCXWebGUI/VCXCardTypeEnum",["require","exports"],function(e,t){"use strict";var n;return function(e){e.SCENE="SCENE",e.MATERIAL="MATERIAL",e.AMBIENCE="AMBIENCE",e.RATIO="RATIO"}(n||(n={})),n}),define("DS/VCXWebGUI/VCXGettingStartedUI",["UWA/Class","DS/WebappsUtils/WebappsUtils","DS/Core/PointerEvents","DS/CoreEvents/Events","DS/UIKIT/Mask","DS/UIKIT/SuperModal","DS/VCXWebIO/VCXLogServices","DS/VCXWebEWS/VCXExperienceServices","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],function(e,t,n,i,a,r,o,s,l){"use strict";return e.singleton({init:function(){this._experienceName=null,this._collabSpace=null},initialize:function(e){this.home=UWA.Element("div",{html:"",class:"vcx-Curtain-Home"}),this.localMode=e.localMode,this.createDropZone()},unInitialize:function(){this.dropZone.remove(),this.dropZone=null,this.dndObjectOverlay.remove(),this.dndObjectOverlay=null,this.dndForbiddenOverlay.remove(),this.dndForbiddenOverlay=null,this.home.remove(),this.home=null},IsTstProvider:function(){return this.tstProvider},setParentNode:function(e){this.parentNode=e},createDropZone:function(){t.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_G_NXGDragAndDrop.png");this.dropZone=UWA.Element("div",{html:"",class:"vcx-DropZone-Main"}),this.dndObjectOverlay=new UWA.Element("div",{id:"xphoto-full-page-dnd-overlay"}),this.dndObjectOverlay.inject(this.dropZone),new UWA.Element("div",{id:"xphoto-image-dnd-icon",class:"fonticon fonticon-5x fonticon-drag-drop"}).inject(this.dndObjectOverlay),this.dndObjectOverlay.hide(),this.dndForbiddenOverlay=new UWA.Element("div",{id:"xphoto-full-page-dnd-overlay",html:[{tag:"span",class:"wux-ui-3ds wux-ui-3ds-5x wux-ui-3ds-wrong xphoto-image-dnd-icon",styles:{color:"#b4b6ba"}}]}),this.dndForbiddenOverlay.inject(this.dropZone),this.dndForbiddenOverlay.hide()},startLoadingPage:function(e){this.initWidget=UWA.Element("div",{html:"Initializing ...",class:"vcx-Curtain-InitWidget"}).inject(this.parentNode),UWA.Element("div",{html:"",class:"vcx-Curtain-InitWidget-BrandImage",styles:{backgroundImage:e}}).inject(this.initWidget)},clearInitWidget:function(){var e=document.getElementsByClassName("vcx-Curtain")[0];e&&e.destroy()},startLoadingExperience:function(){},failLoadingExperience:function(){this.removeCurtainFade()},endLoadingExperience:function(){this.dropZoneOFF(),this.home&&this.home.hide(),this.removeCurtainFade()},startExperiencePage:function(e,i,a,r,o,c,d){this.backgroundImage=a;this.home.inject(this.parentNode),this.dropZone.inject(this.parentNode),d&&this.home.addClassName("vcx-Curtain-MixedLayer"),this.experiencePage=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-container"}).inject(this.home);var u=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Title-Header"}).inject(this.experiencePage);UWA.Element("div",{html:e,class:"vcx-Curtain-Experience-Title"}).inject(u);var p=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Row"}).inject(this.experiencePage),h=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Tile"+(o?"":" vcxFreezed")}).inject(p);o&&h.addEvent(n.POINTERUP,e=>{s.onCreateEmptyExperience(this._experienceBase)});var m=UWA.Element("img",{html:"",class:"vcx-Curtain-Experience-Image"+(o?"":" vcxFreezed"),src:t.getWebappsAssetUrl("VCXWebGUI","texture/gui/"+i)}).inject(h);c||(m.style.boxShadow="unset");var g=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Footer"}).inject(h),C=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Text"}).inject(g);UWA.Element("span",{html:r,class:"vcx-Curtain-Experience-Text2"}).inject(C);g=UWA.Element("div",{html:"",class:"vcx-Curtain-Footer"+(o?"":" vcxAnimate")}).inject(this.experiencePage);c||g.hide();var v=UWA.Element("div",{html:"",class:"vcx-Curtain-Footer-row"}).inject(g);UWA.Element("img",{html:"",src:t.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_draganddrophp.png"),class:"vcx-Curtain-Footer-Image"}).inject(v),UWA.Element("span",{html:(o?l["VCXGettingStartedUI.OrDropContentMessageBegin"]:l["VCXGettingStartedUI.DropContentMessageBegin"])+l["VCXGettingStartedUI.DropContentMessageEnd"],class:"vcx-Curtain-Footer-Text"}).inject(v)},setExperienceBase:function(e){this._experienceBase=e},getHomeNode:function(){return this.home},dropZoneON:function(){0===document.getElementsByClassName("vcx-DropZone-Main").length&&(this.parentNode?this.dropZone?this.dropZone.inject(this.parentNode):console.error("/! A DOM parent element is assignated to display dropzone but Dropzone element isn't created."):this.dropZone?console.error("/! The dropzone is created but not assigned to a DOM parent."):console.error("/! No visual dropzone element is created.")),this.dropZone.addClassName("vcx-DropZone-Display"),this.dndObjectOverlay.show();for(var e=document.getElementsByClassName("vcx-Curtain-Experience-Tile"),t=0;t<e.length;t++)e[t].style.pointerEvents="none"},dropZoneOFF:function(){for(var e=document.getElementsByClassName("vcx-Curtain-Experience-Tile"),t=0;t<e.length;t++)e[t].style.pointerEvents="";this.dropZone&&this.dropZone.removeClassName("vcx-DropZone-Display"),this.dndObjectOverlay&&this.dndObjectOverlay.hide()},addTile:function(e,i,a,r,o){var s=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Tile"+(r?"":" vcxFreezed")}).inject(e);r&&s.addEvent(n.POINTERUP,function(e){o()}),UWA.Element("img",{html:"",class:"vcx-Curtain-Experience-Image"+(r?"":" vcxFreezed"),src:t.getWebappsAssetUrl("VCXWebGUI","texture/gui/"+a)}).inject(s).style.animation="unset";var l=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Footer"}).inject(s),c=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Text"}).inject(l);UWA.Element("span",{html:i,class:"vcx-Curtain-Experience-Text2"}).inject(c)},curtainFade:function(){this.experiencePage&&this.experiencePage.addClassName("vcx-Curtain-Fade")},removeCurtainFade:function(){this.experiencePage&&this.experiencePage.removeClassName("vcx-Curtain-Fade")}})}),define("DS/VCXWebGUI/VCXGettingStartedExperienceInformationModal",["UWA/Class","DS/UIKIT/Form","DS/UIKIT/Spinner","DS/UIKIT/SuperModal","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/LineEditor","DS/Controls/ComboBox","DS/Tweakers/TweakerBlob","DS/UIKIT/Accordion","DS/UIKIT/Input/File","DS/WebappsUtils/WebappsUtils","DS/Core/PointerEvents","DS/VCXWebPlatform/VCX3DSpaceServices","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],function(e,t,n,i,a,r,o,s,l,c,d,u,p,h,m){var g=null,C=null,v=null,_=null,b=null;return e.singleton({initialize:function(){this._parentDivName="vcx-Curtain-Home",this._defautSecurityContext={role:"",collabspace:"",organization:""}},unInitialize:function(){this._parentDivName=null,this._isLocalMode=null,this._experienceBase=null},displayOpenOrPlayExperience:function(e,t){this._experienceBase=t,this._isLocalMode=t.getManager("VCXContextManager").IsLocalMode();var n=this._experienceBase.getManager("VCXGUIManager").getBrandImage(),a=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Row"}),r=new i({renderTo:document.querySelector("vcx-Curtain-Home"),animate:!0,className:"vcxOpenPlayExperience"});r.dialog({title:"",body:UWA.Element("div",{html:[a]})});if(this._experienceBase.odt){var o="authoringMode";return e&&(widget.simulatePlay=!0,o="simulatePlayMode"),r.next(),UWA.Promise.resolve(o)}return new UWA.Promise((e,t)=>{this.addTile(a,"Open Experience",n,!0,()=>{r.next(),e("authoringMode")}),this.addTile(a,"Play","I_VCX_SplashPlay.png",!0,()=>{widget.simulatePlay=!0,r.next(),e("simulatePlayMode")})})},addTile:function(e,t,n,i,a){var r=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Tile"+(i?"":" vcxFreezed")}).inject(e);i&&r.addEvent(p.POINTERUP,e=>{a()}),UWA.Element("img",{html:"",class:"vcx-Curtain-Experience-Image"+(i?"":" vcxFreezed"),src:u.getWebappsAssetUrl("VCXWebGUI","texture/gui/"+n)}).inject(r).style.animation="unset";var o=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Footer"}).inject(r),s=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Text"}).inject(o);UWA.Element("span",{html:t,class:"vcx-Curtain-Experience-Text2"}).inject(s)},createSaveBeforeCloseModal:function(e){return this._experienceBase=e,this._isLocalMode=e.getManager("VCXContextManager").IsLocalMode(),this._experienceBase.odt?UWA.Promise.resolve("Discard"):new UWA.Promise((e,t)=>{var n=new i({renderTo:document.querySelector(this._parentDivName),animate:!0,className:"vcx-project-info-modal",events:{onShow:function(t){this.modals.current.elements.close.addEventListener("click",()=>{e("Close")})}}});n.dialog({title:"Confirm Saving",body:UWA.Element("div",{html:[new UWA.Element("div",{text:"Do you want to save this presentation or discard unsaved changes?"})]}),buttons:[{className:"primary",value:"Save",action:t=>{n.next(),e("Save")}},{className:"default",value:"Discard",action:t=>{n.next(),e("Discard")}}],events:{onShow:function(){this.elements.close.addEventListener("click",()=>{e("Close")})}}})})},createConfirmCancelModal:function(e){this._experienceBase=e,this._isLocalMode=e.getManager("VCXContextManager").IsLocalMode();var t=new i({renderTo:document.querySelector(this._parentDivName),animate:!0,className:"vcx-project-info-modal"});return new UWA.Promise((e,n)=>{t.dialog({title:"Cancel Recovering",body:UWA.Element("div",{html:"Are you sure you want to cancel the recovering process? <br/>The Experience will be closed, unsaved changes are lost."}),buttons:[{className:"primary",value:"Yes",action:n=>{t.next(),e("Yes")}},{className:"default",value:"No",action:n=>{t.next(),e("No")}}]})})},createNewExperienceModal:function(e,a,r){this._experienceBase=e,this._isLocalMode=e.getManager("VCXContextManager").IsLocalMode();var o=new i({renderTo:document.querySelector(this._parentDivName),animate:!0,className:"vcx-project-info-modal"}),s=new t({className:"horizontal",grid:"4 6",fields:this._createFormFields(a,r),events:{onChange:()=>{s.submit(!0),this._onUpdateForms(!0)}}});return s.getListInput("collabSpace")&&((g=s.getListInput("collabSpace")).hide(),(new n).show().inject(g.getContent().parentNode)),s.getListInput("filePicker")&&((C=s.getListInput("filePicker")).hide(),(new n).show().inject(C.getContent().parentNode)),s.getListInput("prefix")&&((C=s.getListInput("prefix")).hide(),(new n).show().inject(C.getContent().parentNode)),s.getListInput("asReference")&&((v=s.getListInput("asReference")).hide(),(new n).show().inject(v.getContent().parentNode)),s.getListInput("insertProducts")&&((_=s.getListInput("insertProducts")).hide(),(new n).show().inject(_.getContent().parentNode)),new UWA.Promise((e,t)=>{o.dialog({title:m["VCXGettingStartedExperienceInformationModal.NewExperience"],body:UWA.Element("div",{html:[s]}),buttons:[{attributes:{styles:{"margin-top":"0px"}},className:"nextButton blueButton primary disable",value:"Create",action:t=>{if(s.submit(!0),1==s.validate(!1,!1)){var n=s.getValue("projectName"),i=s.getField("collabSpace"),a=s.getField("filePicker"),o=s.getField("prefix"),l=s.getField("asReference");let c="",d="",u="",p=!1,h="",m="";if(!this._isLocalMode){let e=JSON.parse(i.value);c=e.collabspace,d=a&&a.files[0],u=o&&o.value,p=l&&l.checked,h=e.role,m=e.organization}t.hide(),e({experienceName:n,collabspace:c,file:d,prefix:u,asReference:p,role:h,organization:m,content:r})}}}]}),this._nextButton=document.querySelector(".vcx-project-info-modal .nextButton"),this._createFieldsContent()})},Import3dxmlModal:function(e,a,r,o){this._experienceBase=e,this._isLocalMode=e.getManager("VCXContextManager").IsLocalMode();var s=a&&a.replace(".3dxml",""),l=new i({renderTo:document.querySelector(this._parentDivName),animate:!0,className:"vcx-project-info-modal"}),c=UWA.Element("div",{class:"vcx-browseFile-container"}),u=UWA.Element("div",{html:a||m["VCXGettingStartedExperienceInformationModal.3dxmlPlaceholder"],class:"vcx-browseFile-text"});u.inject(c);var p=new d({attributes:{accept:".3dxml"},input:!1,icon:"folder",required:!0,events:{onChange:e=>{p.getValue()?(u.innerHTML=p.getValue(),this._nextButton.removeAttribute("disabled"),b&&!b.isDisabled()&&b.setValue(p.getValue().replace(".3dxml","")+" - Presentation ")):(u.innerHTML=m["VCXGettingStartedExperienceInformationModal.3dxmlPlaceholder"],this._nextButton.setAttribute("disabled",""),b&&!b.isDisabled()&&b.setValue(m["VCXGettingStartedExperienceInformationModal.DefaultPresentationName"]))}}});p.inject(c),p.elements.button.addClassName("btn-with-icon");var h=new UWA.Element("span",{class:"fonticon fonticon-folder"});p.elements.button.insertBefore(h,p.elements.button.firstChild);var f=new t({className:"horizontal",grid:"4 6",fields:this._create3dxmlFormFields(s,r,o),events:{onChange:()=>{f.submit(!0),this._onUpdateForms(o)}}});f.getContent().addClassName("vcx-3dxml-form");return f.getListInput("collabSpace")&&((g=f.getListInput("collabSpace")).hide(),(new n).show().inject(g.getContent().parentNode)),f.getTextInput("prefix")&&(C=f.getTextInput("prefix")),f.getBooleanInput("insertProducts")&&(_=f.getBooleanInput("insertProducts")),f.getBooleanInput("asReference")&&(v=f.getBooleanInput("asReference")),f.getTextInput("projectName")&&(b=f.getTextInput("projectName")),new UWA.Promise(async(e,t)=>{l.dialog({title:o?m["VCXGettingStartedExperienceInformationModal.import3dxmlModal"]:m["VCXGettingStartedExperienceInformationModal.insert3dxmlModal"],body:UWA.Element("div",{html:[c,f]}),buttons:[{attributes:{styles:{"margin-top":"0px"}},className:"nextButton blueButton primary disable",value:m["VCXGettingStartedExperienceInformationModal.Import"],action:t=>{if(f.submit(!0),1==f.validate(!1,!1)){var n=f.getValue("projectName"),i=f.getField("collabSpace"),a=f.getField("prefix"),o=f.getField("asReference"),s=f.getField("insertProducts");let l="",c="",d="",u=!1,h=!1,m="",g="";if(!this._isLocalMode){let e=JSON.parse(i.value);l=e.collabspace,c=p&&p.elements.input.files,d=a&&a.value,u=!s||s.checked,h=!o||o.checked,m=e.role,g=e.organization}t.hide(),e({experienceName:n,collabspace:l,files:c,prefix:d,asReference:h,insertProducts:u,role:m,organization:g,content:r})}}},{value:m["VCXGettingStartedExperienceInformationModal.Cancel"],action:e=>{e.hide()}}]}),await this._createFieldsContent(),this._nextButton=document.querySelector(".vcx-project-info-modal .nextButton"),a||this._nextButton.setAttribute("disabled","")})},_createFormFields:function(e,t){var n=[],i=null,a="";i&&(a=(a=i.firstName.substring(0,1)+""+i.lastName.substring(0,1)).toUpperCase());var r=m["VCXGettingStartedExperienceInformationModal.DefaultPresentationName"];e&&(r=e+" - Presentation "),r+=a;var o={type:"text",label:m["VCXGettingStartedExperienceInformationModal.ProjectName"],name:"projectName",value:r,pattern:"[a-zA-Z0-9]+",required:!0};if(n.push(o),!this._isLocalMode){var s={type:"list",label:m["VCXGettingStartedExperienceInformationModal.CollabSpace"],name:"collabSpace",options:[{}]};if(n.push(s),t&&"3dxml"===t.type){if(a="",(i=null)&&(a=(a=i.firstName.substring(0,1)+""+i.lastName.substring(0,1)).toUpperCase()),!e){var l={type:"file",label:m["VCXGettingStartedExperienceInformationModal.filePicker"],name:"filePicker",options:[{}]};n.push(l)}var c={type:"text",label:m["VCXGettingStartedExperienceInformationModal.Prefix"],name:"prefix",value:a,options:[{}]};n.push(c);var d={type:"checkbox",label:m["VCXGettingStartedExperienceInformationModal.AsReference"],name:"asReference",value:!1,options:[{}]};n.push(d)}}return n},_create3dxmlFormFields:function(e,t,n){var i=[],a=null,r="";a&&(r=(r=a.firstName.substring(0,1)+""+a.lastName.substring(0,1)).toUpperCase());var o=m["VCXGettingStartedExperienceInformationModal.DefaultPresentationName"];if(e&&(o=e+" - Presentation "),o+=r,n){var s={type:"text",label:m["VCXGettingStartedExperienceInformationModal.3dxmlName"],name:"projectName",value:o,pattern:"[a-zA-Z0-9]+",required:!0};i.push(s)}if(!this._isLocalMode){var l={type:"list",label:m["VCXGettingStartedExperienceInformationModal.3dxmlLocation"],name:"collabSpace",readOnly:n,options:[{}]};i.push(l),r="",(a=null)&&(r=(r=a.firstName.substring(0,1)+""+a.lastName.substring(0,1)).toUpperCase());var c={type:"text",label:m["VCXGettingStartedExperienceInformationModal.3dxmlPrefix"],placeholder:m["VCXGettingStartedExperienceInformationModal.PrefixPlaceholder"],name:"prefix",value:r,options:[{}]};if(i.push(c),n){var d={type:"checkbox",label:m["VCXGettingStartedExperienceInformationModal.InsertProducts"],name:"insertProducts",value:!0,options:[{}]};i.push(d);var u={type:"checkbox",label:m["VCXGettingStartedExperienceInformationModal.AsReference"],name:"asReference",value:!1,options:[{}]};i.push(u)}}return i},_createFieldsContent:async function(){let e=await h.GetSecurityContextInformations(),t=await h.GetPreferredSecurityContext();if(g){this._defautSecurityContext=t;var n=g.getContent().parentNode;if(e){var i=this._getCollabSpaceRoleList(e);g.remove(),g.add(i);var a=n.getElementsByClassName("spinner");a.length>0&&a[0].remove(),g.show()}}},_getCollabSpaceRoleList:function(e){let t=[];for(let n in e)if(e.hasOwnProperty(n)){let i=e[n].highPrivilegeRoleOrga,a={};a.label=n+" ● "+i.nlsrole,a.value=JSON.stringify(i),this._defautSecurityContext.collabspace===n&&(a.selected=!0),t.push(a)}return t.sort((e,t)=>{let n=JSON.parse(e.value).collabspace,i=JSON.parse(t.value).collabspace;return n.localeCompare(i)}),t},_onUpdateForms:function(e){if(g){let e=g.getValue();if(e.length){let t=JSON.parse(e[0]);h.SetPreferredSecurityContext(t)}}else console.warn("Fields not found!");_&&b&&(_.isChecked()&&b.isDisabled()?(b.setValue(m["VCXGettingStartedExperienceInformationModal.DefaultPresentationName"]),b.enable()):_.isChecked()||(b.setValue(""),b.disable())),C&&v&&(v.isChecked()&&!C.isDisabled()?(C.setValue(" "),C.disable()):v.isChecked()||(" "===C.getValue()&&C.setValue(""),C.enable()))}})}),define("DS/VCXWebGUI/VCXPlayView",["require","exports","DS/Controls/Button","DS/Controls/TooltipModel","UWA/Core","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],function(e,t,n,i,a,r){"use strict";return class{constructor(e,t){this.scenesMap=new Map,this.hoverImageContainer=null,this.parentHoverImage=null,this.containerDiv=(0,a.createElement)("div",{class:"VCXImmersiveNav"}).inject(e),this.topContainer=null,this.closeButton=null,this.immersiveNavTopBar=null,this.arrowContainer=null,this.bottomBarContainer=null,this.fullScreenActiveButton=null,this.leftButton=null,this.rightButton=null,this.canvasButton=null,this.background=null,this.fullScreenButton=null,this.playButton=null,this.immersiveNavButton=null,this.pauseButton=null,this.playPauseContainer=null,this.playPauseContainerFake=null,this.immersiveNavStatus=!1,this.canvasStatus=!1,this.options=t,this.buildLayout(),this.setActiveFullScreen(!1),this.setPlayStatus(!1),this.setAuthoringVisibility(!1)}buildLayout(){this.buildImmersiveNav()}buildImmersiveNav(){this.buildTopBar(),this.buildArrow(),this.bottomBar()}bottomBar(){this.bottomBarContainer=(0,a.createElement)("div",{class:"VCXImmersiveNavBottomContainer"}).inject(this.containerDiv);let e=(0,a.createElement)("div",{class:"VCXImmersiveNavBottomContainerButton"}).inject(this.bottomBarContainer);this.fullScreenButton=(0,a.createElement)("div",{class:"VCXImmersiveNavButtonPlay VCXImmersiveNavButtonBottomBarPlay"}).inject(e);let t=new n({displayStyle:"lite",iconSize:"22px",icon:{iconName:"group",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.fullScreenButton);t.addEventListener("buttonclick",()=>{this.setActiveFullScreen(!0),this.options.fullScreenCb&&this.options.fullScreenCb(!0)}),this.fullScreenActiveButton=(0,a.createElement)("div",{class:"VCXImmersiveNavButtonPlay VCXImmersiveNavButtonBottomBarPlay"}).inject(e),(t=new n({displayStyle:"lite",iconSize:"22px",icon:{iconName:"resize-small",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.fullScreenActiveButton)).addEventListener("buttonclick",()=>{this.setActiveFullScreen(!1),this.options.fullScreenCb&&this.options.fullScreenCb(!1)}),this.playPauseContainer=(0,a.createElement)("div",{class:"VCXImmersiveNavBottomContainerButtonPlayPause"}).inject(e),this.playButton=(0,a.createElement)("div",{class:"VCXImmersiveNavButtonPlay VCXImmersiveNavButtonBottomBarPlay"}).inject(this.playPauseContainer),(t=new n({displayStyle:"lite",iconSize:"22px",icon:{iconName:"play",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.playButton)).addEventListener("buttonclick",()=>{this.setPlayStatus(!0),this.options.playCb&&this.options.playCb(!0)}),this.pauseButton=(0,a.createElement)("div",{class:"VCXImmersiveNavButtonPlay VCXImmersiveNavButtonBottomBarPlay"}).inject(this.playPauseContainer),(t=new n({displayStyle:"lite",iconSize:"22px",icon:{iconName:"pause",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.pauseButton)).addEventListener("buttonclick",()=>{this.setPlayStatus(!1),this.options.playCb&&this.options.playCb(!1)}),(0,a.createElement)("div",{class:"VCXImmersiveNavBottomSeparatorPlayPause"}).inject(this.playPauseContainer),this.playPauseContainerFake=(0,a.createElement)("div",{class:"VCXImmersiveNavBottomContainerButtonPlayPauseFake"}).inject(this.bottomBarContainer),this.immersiveNavButton=(0,a.createElement)("div",{class:"VCXImmersiveNavButtonPlay VCXImmersiveNavButtonBottomBarAuth"}).inject(this.bottomBarContainer),(t=new n({displayStyle:"lite",iconSize:"25px",icon:{iconName:"media-controller",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.immersiveNavButton)).tooltipInfos=new i({shortHelp:r["ImmersiveNavButton.Tooltip"]}),t.addEventListener("buttonclick",()=>{this.setVisibilityImmersiveNav(!this.immersiveNavStatus),this.options.immersiveNavActiveCb&&this.options.immersiveNavActiveCb(this.immersiveNavStatus)}),this.canvasButton=(0,a.createElement)("div",{class:"VCXImmersiveNavButtonPlay VCXImmersiveNavButtonBottomBarAuth"}).inject(this.bottomBarContainer),(t=new n({displayStyle:"lite",iconSize:"22px",icon:{iconName:"eye-windowed",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.canvasButton)).addEventListener("buttonclick",()=>{this.setActiveButtonCanvas(!this.canvasStatus),this.options.canvasActiveCb&&this.options.canvasActiveCb(this.canvasStatus)}),t.tooltipInfos=new i({shortHelp:r["CanvasButton.Tooltip"]})}buildArrow(){this.arrowContainer=(0,a.createElement)("div",{class:"VCXImmersiveNavArrowContainer"}).inject(this.containerDiv),this.leftButton=(0,a.createElement)("div",{class:"VCXImmersiveNavLeftButton VCXImmersiveNavButtonPlay"}).inject(this.arrowContainer);let e=new n({displayStyle:"lite",iconSize:"22px",icon:{iconName:"chevron-left",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.leftButton);e.addEventListener("buttonclick",()=>{this.options.onPlaySceneCb&&this.options.onPlaySceneCb(null,!1)}),this.rightButton=(0,a.createElement)("div",{class:"VCXImmersiveNavRightButton VCXImmersiveNavButtonPlay"}).inject(this.arrowContainer),(e=new n({displayStyle:"lite",iconSize:"22px",icon:{iconName:"chevron-right",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.rightButton)).addEventListener("buttonclick",()=>{this.options.onPlaySceneCb&&this.options.onPlaySceneCb(null,!0)})}buildTopBar(){this.topContainer=(0,a.createElement)("div",{class:"VCXImmersiveNavTopContainer"}).inject(this.containerDiv),this.background=(0,a.createElement)("div",{class:"VCXImmersiveNavTopContainerBackGround VCXImmersiveNavTopContainerBackGroundOn"}).inject(this.topContainer),this.immersiveNavTopBar=(0,a.createElement)("div",{class:"VCXImmersiveNavTopContainerGrid"}).inject(this.topContainer),this.closeButton=(0,a.createElement)("div",{class:"VCXImmersiveNavCloseButton"}).inject(this.topContainer),new n({displayStyle:"lite",iconSize:"17px",icon:{iconName:"close",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.closeButton).addEventListener("buttonclick",()=>{this._close(),this.options.closeCallBack&&this.options.closeCallBack()})}destroy(){this.containerDiv.destroy()}updateGridContainer(e){var t;let n=Array.from(this.scenesMap.keys());if(e.length!=n.length||!n.every(function(t,n){return t==e[n]})){this.scenesMap.clear();for(let t of e){let e=(0,a.createElement)("div",{class:"VCXImmersiveNavTopContainerBar"});e.setData("scenarioId",t);let n=(0,a.createElement)("div",{class:"VCXImmersiveNavTopBar"}).inject((0,a.createElement)("div",{class:"VCXImmersiveNavTopBackground"}).inject((0,a.createElement)("div",{class:"VCXImmersiveNavTopBackgroundParent"}).inject(e)));e.addEventListener("click",()=>{this.options.onPlaySceneCb&&this.options.onPlaySceneCb(t,!1)}),e.addEventListener("mouseover",()=>{this.createHoverImage(e,t)}),e.addEventListener("mouseleave",()=>{this.createHoverImage(null,t)}),this.scenesMap.set(t,{container:e,bar:n})}null===(t=this.immersiveNavTopBar)||void 0===t||t.replaceChildren(...Array.from(this.scenesMap.values()).map(e=>e.container))}}getHeaderSize(){var e;return this.containerDiv.isHidden()||!this.topContainer?0:null===(e=this.topContainer)||void 0===e?void 0:e.offsetHeight}createHoverImage(e,t){var n;if(this.parentHoverImage===e)return;if(!this.options.onHoverCb)return;if(this.parentHoverImage=e,this.hoverImageContainer&&this.hoverImageContainer.destroy(),!this.parentHoverImage)return;this.hoverImageContainer=(0,a.createElement)("div",{class:"VCXImmersiveNavTopThumbnailContainer"});let i=(0,a.createElement)("img",{class:"VCXImmersiveNavTopThumbnail VCXImmersiveNavTopThumbnailHidden"}).inject(this.hoverImageContainer);if(this.options.onHoverCb){let e=this.options.onHoverCb(t);e&&(i.src=e)}null===(n=this.hoverImageContainer)||void 0===n||n.inject(this.parentHoverImage),setTimeout(()=>i.removeClassName("VCXImmersiveNavTopThumbnailHidden"),10)}updateActiveScenario(e,t,n=!1){var i;if(null===(i=this.immersiveNavTopBar)||void 0===i?void 0:i.getChildren())for(let i of this.scenesMap.entries())n?(i[1].bar.setStyle("width",(i[0]===e?t:0)+"%"),setTimeout(()=>{this.setVisibilityFlag(i[1].container,i[0]===e,"VCXImmersiveNavTopContainerBarActive")})):(this.setVisibilityFlag(i[1].container,i[0]===e,"VCXImmersiveNavTopContainerBarActive"),i[1].bar.setStyle("width",(i[0]===e?t:0)+"%"))}setVisibility(e){e?this.containerDiv.show():this.containerDiv.hide()}setAuthoringVisibility(e){var t,n,i,a,r,o;e?null===(t=this.immersiveNavButton)||void 0===t||t.show():null===(n=this.immersiveNavButton)||void 0===n||n.hide(),e?null===(i=this.canvasButton)||void 0===i||i.show():null===(a=this.canvasButton)||void 0===a||a.hide(),e?null===(r=this.closeButton)||void 0===r||r.show():null===(o=this.closeButton)||void 0===o||o.hide()}setVisibilityPlayPause(e){var t,n,i,a;e?null===(t=this.playPauseContainer)||void 0===t||t.show():null===(n=this.playPauseContainer)||void 0===n||n.hide(),e?null===(a=this.playPauseContainerFake)||void 0===a||a.hide():null===(i=this.playPauseContainerFake)||void 0===i||i.show()}setArrowVisibility(e,t){this.setVisibilityFlag(this.leftButton,e,"VCXImmersiveNavOpacityHidden"),this.setVisibilityFlag(this.rightButton,t,"VCXImmersiveNavOpacityHidden")}setVisibilityImmersiveNav(e){this.setVisibilityFlag(this.immersiveNavTopBar,!e,"VCXImmersiveNavHidden"),this.setVisibilityPlayPause(e),this.setVisibilityFlag(this.arrowContainer,!e,"VCXImmersiveNavHidden"),this.setActiveButtonImmersiveNav(e)}setActiveFullScreen(e){var t,n,i,a;e?null===(n=this.fullScreenButton)||void 0===n||n.hide():null===(t=this.fullScreenButton)||void 0===t||t.show(),e?null===(i=this.fullScreenActiveButton)||void 0===i||i.show():null===(a=this.fullScreenActiveButton)||void 0===a||a.hide()}setPlayStatus(e){var t,n,i,a;e?null===(n=this.playButton)||void 0===n||n.hide():null===(t=this.playButton)||void 0===t||t.show(),e?null===(i=this.pauseButton)||void 0===i||i.show():null===(a=this.pauseButton)||void 0===a||a.hide()}setActiveButtonImmersiveNav(e){this.immersiveNavStatus=e,this.setVisibilityFlag(this.immersiveNavButton,e,"VCXImmersiveNavButtonBottomBarAuthActive")}setActiveButtonCanvas(e){this.canvasStatus=e,this.setVisibilityFlag(this.canvasButton,e,"VCXImmersiveNavButtonBottomBarAuthActive")}_close(){this.setActiveFullScreen(!1),this.setPlayStatus(!1),this.setArrowVisibility(!0,!0),this.updateGridContainer([])}setVisibilityFlag(e,t,n){t&&!(null==e?void 0:e.hasClassName(n))&&(null==e||e.addClassName(n)),!t&&(null==e?void 0:e.hasClassName(n))&&(null==e||e.removeClassName(n))}}}),define("DS/VCXWebGUI/VCXTreeViewCellAbstract",["DS/Tree/TreeNodeView","DS/Core/PointerEvents","DS/CoreEvents/Events"],function(e,t,n){"use strict";function i(e){var t=e.currentTarget||e.srcElement,n=t.currentStyle||window.getComputedStyle(t,null),i=parseInt(n.borderLeftWidth,10),a=parseInt(n.borderTopWidth,10),r=t.getBoundingClientRect();return{offsetX:e.clientX-i-r.left,offsetY:e.clientY-a-r.top}}return e.extend({init:function(e){this._parent(e),(this._manager.options.resize.rows||this._manager.options.resize.columns)&&this._manageResize()},updateInternalParameters:function(){this._parent();var e=this.getCellInfos();if(e){var t=e.nodeModel,n=t.getNextNode();"collapsed"===t.getState()||n&&"noChildren"!==n.getState()?this.getContent().addClassName("wux-controls-propertylistview-expander"):this.getContent().removeClassName("wux-controls-propertylistview-expander"),t.options.children&&0==t.options.children.length?this.getContent().addClassName("vcx-controls-propertylistview-expander-hide"):this.getContent().removeClassName("vcx-controls-propertylistview-expander-hide")}},destroy:function(){document.removeEventListener(t.POINTERMOVE,this._pointerMoveOnDocumentCB),document.removeEventListener(t.POINTERUP,this._pointerUpOnDocumentCB),this._pointerMoveOnDocumentCB=null,this._pointerUpOnDocumentCB=null,this._isPressed=!1,this.wantToResize=!1,this._pointerMoved=!1,this._deltaMouseInit={},this._parent()},_manageResize:function(){var e=this;e.getGridEngine()._enableInteractiveSort();var n,a,r,o,s=5,l=this.elements.container;this.wantToResize=!1,l.addEvent(t.POINTERMOVE,function(t){if(!e._isPressed){var l=e.getCellInfos();n=l,a=l.manager,o=a.getColumnWidth(n.virtualColumnID),r=a.getRowHeight(n.virtualRowID);var c=i(t);a.options.resize.columns&&(c.offsetX<o+s&&c.offsetX>o-s?(e._setResizeStyle("r"),e.wantToResize=!0):(e._setResizeStyle(),e.wantToResize=!1)),a.options.resize.rows&&(c.offsetY<r+s&&c.offsetY>r-s?(e._setResizeStyle("b"),e.wantToResize=!0):(e._setResizeStyle(),e.wantToResize=!1))}}),this._pointerMoved=!1,this._isPressed=!1,this._deltaMouseInit={},this._newWidth,this._newHeight;UWA.extendElement(document);this.minWidth=0,this.maxWidth=1/0,l.addEvent(t.POINTERDOWN,function(t){t&&t.originalEvent&&"touchstart"===t.originalEvent.type&&(e.wantToResize=!0,s=32,n=e.getCellInfos(),a=e.getGridEngine(),o=a.getColumnWidth(n.virtualColumnID),r=a.getRowHeight(n.virtualRowID));var l=i(t);if(e.wantToResize&&(l.offsetY<r+s&&l.offsetY>r-s||l.offsetX<o+s&&l.offsetX>o-s)){t.preventDefault(),a.getScroller().getContent().addClassName("wux-ui-locked"),a.lockUI(),e._deltaMouseInit={x:t.clientX,y:t.clientY},e._newWidth=o,e._newHeight=r,e._isPressed=!0;var c=e.getGridEngine()._getColumnOptionValue(n.virtualColumnID,"maxWidth");e.maxWidth=void 0!==c?c:1/0,e.minWidth=e.getGridEngine()._getColumnOptionValue(n.virtualColumnID,"minWidth"),e.getGridEngine()._disableInteractiveSort(!0)}}),this._pointerMoveOnDocumentCB=this._pointerMoveOnDocument.bind(this),document.addEventListener(t.POINTERMOVE,this._pointerMoveOnDocumentCB),this._pointerUpOnDocumentCB=this._pointerUpOnDocument.bind(this),document.addEventListener(t.POINTERUP,this._pointerUpOnDocumentCB)},_pointerMoveOnDocument:function(e){if(this._isPressed&&this.wantToResize){var t=this.getGridEngine(),n=this.getCellInfos(),i=t.getColumnWidth(n.virtualColumnID);this._pointerMoved||this.getGridEngine()._disableInteractiveSort(),this._pointerMoved=!0;var a={};a.x=e.clientX-this._deltaMouseInit.x,a.y=e.clientY-this._deltaMouseInit.y,i+a.x>=this.minWidth&&i+a.x<=this.maxWidth&&(this._newWidth=i+a.x,this._manager._updateViewOptions={detachAllViews:!1,updateCells:!1,updateColumnsHeaders:!0},t._instance._showColumnInsertionMark(t.getScroller().getPosition().x+t.getHeadersDimensions().width+t.getColumnPosition(n.virtualColumnID)+this._newWidth))}},_pointerUpOnDocument:function(e){if(this._isPressed){e.preventDefault(),e.stopPropagation(),this._setResizeStyle(),this.elements.container&&this.elements.container.removeClassName("wux-ui-state-active");var t=this;setTimeout(function(){t.getGridEngine()._enableInteractiveSort()},300);var n=this.getGridEngine(),i=this.getCellInfos();-1!==i.virtualRowID&&n.setRowHeight(i.virtualRowID,this._newHeight),-1!==i.virtualColumnID&&(n.prepareUpdateView(),n.setColumnWidth(i.virtualColumnID,this._newWidth),n._requireFullUpdate(),this._manager._updateViewOptions={detachAllViews:!0,updateCells:!0,updateColumnsHeaders:!0},n.pushUpdateView(!0)),n._instance._hideRowInsertionMark(),n._instance._hideColumnInsertionMark(),n.unlockUI(),this._isPressed=!1,this.wantToResize=!1}}})}),define("DS/VCXWebGUI/VCXPanelCtrl",["require","exports","UWA/Core","DS/Utilities/Dom","DS/Core/PointerEvents","DS/ApplicationFrame/CommandsManager"],function(e,t,n,i,a,r){"use strict";return class{constructor(e){this.guiManager=e,this.container=(0,n.createElement)("div",{class:"vcx-Panel-Controller",html:""}),this.buttonSystem={};let t=(0,n.createElement)("button",{class:"vcx-panel-controller-button vcx-panel-controller-home-button",type:"button",html:""});t.inject(this.container),t.style.order="0",i.generateIcon("topbar-home").inject(t),(0,n.createElement)("div",{class:"vcx-panel-controller-button-text",html:"Home"}).inject(t),t.addEventListener(a.POINTERDOWN,this.goHomeCommand.bind(this))}unInitialize(){this.container.destroy(),this.buttonSystem={}}async goHomeCommand(){var e=this.guiManager._experienceBase.getManager("VCXContextManager").getContext(),t=r.getCommand("VCXCloseExperienceCmd",e);await t.doClose()}createBaseView(e){this.container.inject(e)}createButton(e,t,r,o,s=!1){let l=(0,n.createElement)("button",{class:"vcx-panel-controller-button",type:"button",html:""});l.inject(this.container),l.style.order=o.toString(),i.generateIcon(r).inject(l),(0,n.createElement)("div",{class:"vcx-panel-controller-button-text",html:t}).inject(l),l.dataset.panelName=t,this.buttonSystem[t]={panelView:e,button:l},s?l.classList.add("panelSelectedButton"):e.hide(),l.addEventListener(a.POINTERDOWN,this._onClickCallback.bind(this))}_onClickCallback(e){let t=e.currentTarget;if(t&&t.dataset.panelName){let e=t.dataset.panelName;t.classList.add("panelSelectedButton"),this.buttonSystem[e].panelView.show();for(const t in this.buttonSystem)if(Object.prototype.hasOwnProperty.call(this.buttonSystem,t)){const n=this.buttonSystem[t];e!==t&&(n.panelView.hide(),n.button.classList.remove("panelSelectedButton"))}}}}}),define("DS/VCXWebGUI/VCXHyperlinkBoxing",["UWA/Class","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyInfoEnum","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueHyperlinkId","DS/WebRBTree/WebRBIterator","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],function(e,t,n,i,a,r,o,s,l,c){"use strict";var d=e.extend({initialize:function(e){this._experienceBase=e},unInitialize:function(e){this._experienceBase=null},HyperlinkPropertyToString:function(e){var t="";if(e){var n=this._experienceBase.getManager("VCXDocManager").GetPropPath(e.GetValue());if(n){var i=n.GetFileName().GetValue();if(i)return i;t=n.GetValueURL().GetValue()}}return t},FillMapChoiceScenarios:function(e,t){var n=null,i=Object.keys(e).length,a=this._experienceBase.getManager("VCXScenarioManager").GetScenariosFromType(0);for(var r in a)if(a.hasOwnProperty(r)){var o=a[r].GetName();e[i]=o,r===t&&(n=i),i++}return n},FillMapChoiceMarkers:function(e,t){var n=null,i=Object.keys(e).length,a=this._experienceBase.getManager("VCXScenarioManager").GetScenariosFromType(0);for(var r in a)if(a.hasOwnProperty(r)){var o=a[r].GetTrackMarkers();if(o){i=0;for(var s=o._treekeys,c=new l(s),d=c.next();null!==d;){var u=d.GetValue(),p=this._experienceBase.ComponentsMap.GetComponentFromID(u).GetName();e[i]=p,u===t&&(n=i),i++,d=c.next()}}}return n},GetPropertiesForGUI:function(e,s){var l={propertyAction:null,propertyType:null,propertyHyperlink:null},u=new n("Actor.Hyperlink_Action",null,!1,s.Geti18n()),p=new o;p.SetValue(!1),l.propertyAction=new t(u,p);var h=new a;h.SetValue(1);var m=new i("Actor.Hyperlink_Type",null,!1,s.Geti18n()),g={};g[d.EHyperlinkChoices.None]="__DONOTTRANSLATE__"+c.get("VCXHyperlinkBoxing.ChoiceToSelect.None"),g[d.EHyperlinkChoices.WebAdress]="__DONOTTRANSLATE__"+c.get("VCXHyperlinkBoxing.ChoiceToSelect.WebAdress"),g[d.EHyperlinkChoices.GoToScene]="__DONOTTRANSLATE__"+c.get("VCXHyperlinkBoxing.ChoiceToSelect.GoToScene"),g[d.EHyperlinkChoices.PlayScene]="__DONOTTRANSLATE__"+c.get("VCXHyperlinkBoxing.ChoiceToSelect.PlayScene"),(this._experienceBase.getManager("VCXContextManager").getOpenSMG()||this._experienceBase.getManager("VCXContextManager").getOpenSMGXML())&&(g[d.EHyperlinkChoices.GoToMarker]="__DONOTTRANSLATE__"+c.get("VCXHyperlinkBoxing.ChoiceToSelect.GoToMarker"),g[d.EHyperlinkChoices.PlayMarkerSequence]="__DONOTTRANSLATE__"+c.get("VCXHyperlinkBoxing.ChoiceToSelect.PlayMarkerSequence")),m.SetMapChoiceEnum(g),l.propertyType=new t(m,h);var C=new i("Actor.Hyperlink_Hyperlink",null,!1,s.Geti18n());(_=new r).SetValue("http://www.3ds.com"),l.propertyHyperlink=new t(C,_);var v=null;if(e&&(v=this._experienceBase.getManager("VCXDocManager").GetPropPath(e.GetValue())),!v)return h.SetValue(0),C.SetVisible(!1),l;var _,b="",f=-1,S=v.GetPathType().GetValue();0===S&&((b=this.HyperlinkPropertyToString(e)).indexOf("scenario://")>=0?(S=1,b=b.slice(11)):(b.indexOf("http")>=0||b.indexOf("ftp")>=0?f=d.EHyperlinkChoices.WebAdress:h.SetValue(0),(_=new r).SetValue(b),l.propertyHyperlink.SetPropertyValue(_)));var V=!1,y={},x=new a,P=v.GetValueLink().GetValue();if(1===S){f=d.EHyperlinkChoices.GoToScene;for(var I=["Previous","Next","First","Last"],M=!1,w=0;w<I.length;w++){var D=I[w]+" scenario";y[w.toString()]=D,b===I[w].toLowerCase()&&(x.SetValue(w),M=!0)}var X=this.FillMapChoiceScenarios(y,P);M||null!==X&&x.SetValue(X),V=!0}else if(2===S){f=d.EHyperlinkChoices.PlayScene;var T=this.FillMapChoiceMarkers(y,P),A=this.FillMapChoiceScenarios(y,P);null!==T?x.SetValue(T):null!==A&&x.SetValue(A),V=!0}else if(3===S){f=d.EHyperlinkChoices.GoToMarker,null!==(X=this.FillMapChoiceMarkers(y,P))&&x.SetValue(X),V=!0}else if(4===S){f=d.EHyperlinkChoices.PlayMarkerSequence;T=this.FillMapChoiceMarkers(y,P),A=this.FillMapChoiceScenarios(y,P);null!==T?x.SetValue(T):null!==A&&x.SetValue(A),V=!0}if(V){for(var E in g){var G=parseInt(E);g.hasOwnProperty(G)&&f===G&&h.SetValue(G)}C.SetMapChoiceEnum(y),l.propertyHyperlink.SetPropertyValue(x)}return p.SetValue(!0),l},UpdateMapForGUI:function(e,t){var n=t.propName,i=t.std,o=d.EHyperlinkChoices.None;if("Actor.Hyperlink_Action"===n)e.propertyAction.GetPropertyValue().SetValue(i),e.propertyHyperlink.GetPropertyInfo().SetVisible(i),e.propertyType.GetPropertyInfo().SetVisible(i);else if("Actor.Hyperlink_Type"===n){var s=e.propertyType,l=s.GetPropertyInfo().GetMapChoiceEnum();for(var c in l){var u=parseInt(c);if(l.hasOwnProperty(u))if(i===l[c].replace("__DONOTTRANSLATE__","")){o=u,s.GetPropertyValue().SetValue(o);var p=Boolean(o);e.propertyAction.GetPropertyValue().SetValue(p),e.propertyHyperlink.GetPropertyInfo().SetVisible(p);break}}var h=null;if(o===d.EHyperlinkChoices.WebAdress)h=new r("http://www.3ds.com");else{var m=e.propertyHyperlink.GetPropertyInfo(),g={};switch(o){case d.EHyperlinkChoices.GoToScene:for(var C=["Previous","Next","First","Last"],v=0;v<C.length;v++){var _=C[v]+" scenario";g[v.toString()]=_}this.FillMapChoiceScenarios(g);break;case d.EHyperlinkChoices.PlayScene:this.FillMapChoiceScenarios(g),this.FillMapChoiceMarkers(g);break;case d.EHyperlinkChoices.GoToMarker:this.FillMapChoiceMarkers(g);break;case d.EHyperlinkChoices.PlayMarkerSequence:this.FillMapChoiceMarkers(g),this.FillMapChoiceScenarios(g)}m.SetMapChoiceEnum(g);h=new a(0)}e.propertyHyperlink.SetPropertyValue(h)}else if("Actor.Hyperlink_Hyperlink"===n){var b=e.propertyHyperlink;if("VCXPropertyValueString"===t.internalOptions.dataType)b.GetPropertyValue().SetValue(i);else if("VCXPropertyValueEnum"===t.internalOptions.dataType){var f=b.GetPropertyInfo().GetMapChoiceEnum();for(var c in f){if(f.hasOwnProperty(c))if(i===f[c]){b.GetPropertyValue().SetValue(parseInt(c));break}}}}return e},BuildPropPathFromScenario:function(e,t){var n=this._experienceBase.getManager("VCXScenarioManager").GetScenariosFromType(0);for(var i in n){if(n.hasOwnProperty(i))if(n[i].QueryInterface("VCXIModifiable").GetProperty("Actor.Name").GetPropertyValue().GetValue()===e)return this._experienceBase.getManager("VCXDocManager").BuildPathFromLink(i,t)}},BuildPropPathFromMarker:function(e,t){var n=this._experienceBase.getManager("VCXScenarioManager").GetScenariosFromType(0);for(var i in n)if(n.hasOwnProperty(i)){var a=n[i].GetTrackMarkers();if(a)for(var r=a._treekeys,o=new l(r),s=o.next();null!==s;){var c=s.GetValue();if(this._experienceBase.ComponentsMap.GetComponentFromID(c).GetName()===e)return this._experienceBase.getManager("VCXDocManager").BuildPathFromLink(c,t);s=o.next()}}},BuildNewValueFromGUI:function(e){var t=new s;if(e.propertyAction.GetPropertyValue().GetValue()){var n=null,i=e.propertyHyperlink,a=e.propertyType.GetPropertyValue().GetValue();if(a===d.EHyperlinkChoices.OpenDocument);else if(a===d.EHyperlinkChoices.WebAdress)n=this._experienceBase.getManager("VCXDocManager").BuildPathFromString(i.GetPropertyValue().GetValue());else{var r=i.GetPropertyInfo().GetMapChoiceEnum()[i.GetPropertyValue().GetValue()];switch(a){case d.EHyperlinkChoices.GoToScene:if(!(n=this.BuildPropPathFromScenario(r))){var o="scenario://"+r.split(" ")[0].toLowerCase();n=this._experienceBase.getManager("VCXDocManager").BuildPathFromString(o)}break;case d.EHyperlinkChoices.PlayScene:var l=2;(n=this.BuildPropPathFromScenario(r,l))||(n=this.BuildPropPathFromMarker(r,l));break;case d.EHyperlinkChoices.GoToMarker:l=3;n=this.BuildPropPathFromMarker(r,l);break;case d.EHyperlinkChoices.PlayMarkerSequence:l=4;(n=this.BuildPropPathFromMarker(r,l))||(n=this.BuildPropPathFromScenario(r,l))}}n&&(t=this._experienceBase.getManager("VCXDocManager").AddOrModifyHyperlink(n))}else t.SetValue(-1);return t},getPropertiesNamesNLS:function(e){var t={};return t[e+"_Action"]=c.get("HyperlinkBoxing_Action"),t[e+"_Type"]=c.get("HyperlinkBoxing_Type"),t[e+"_Hyperlink"]=c.get("HyperlinkBoxing_Hyperlink"),t}});return d.EHyperlinkChoices={None:0,WebAdress:1,GoToScene:2,PlayScene:3,GoToMarker:5,PlayMarkerSequence:6},d}),define("DS/VCXWebGUI/VCXTreePanelView",["require","exports","DS/VCXWebComposer/VCXLoadServices","DS/VCXGUIInfrastructure/VCXMainPanel","DS/DataGridView/DataGridView"],function(e,t,n,i,a){"use strict";return class extends i{constructor(e,t){super(e,t),this._treePanelCtrl=e.treePanelCtrl}preparePanel(e){this._treeDocument=e;const t=[{text:"Label",dataIndex:"tree",typeRepresentation:"string",getCellSemantics:e=>{const t=e.nodeModel&&e.nodeModel.getAttributeValue("type");return"VPMReference"===t?{icon:"object-reference"}:"VPMInstance"===t?{icon:"object-instance"}:"3DShape"===t||"VPMRepInstance"===t?{icon:"object-shape-split"}:"dsc_matref_ref_Covering"===t?{icon:"material"}:{icon:"object-reference"}}},{text:"Type",dataIndex:"type",typeRepresentation:"string"},{text:"PID",dataIndex:"pid",typeRepresentation:"string"},{text:"ID",dataIndex:"id",typeRepresentation:"string",getCellSemantics:e=>this._treePanelCtrl.getModelInfoFromNodeModel(e.nodeModel).id?{icon:"3d-object-database"}:{icon:"3d-object-question"}}];var i=new a({treeDocument:this._treeDocument,columns:t,defaultColumnDef:{dataIndex:"",editableFlag:!0,typeRepresentation:"string"},onContextualEvent:e=>{var t=[];if(e&&e.collectionView){t=e.collectionView.buildDefaultContextualMenu(e,{expandCollapse:!0});const a=e.cellInfos,r=a?a.columnID:-1;if(a&&r>=0){const e=this._treePanelCtrl.getModelInfoFromNodeModel(a.nodeModel);e.id||t.push({type:"PushItem",title:"Create override",icon:{iconName:"3d-object-database"},action:{callback:async()=>{const t=[];if(i.getCellsXSO()&&i.getCellsXSO().get())for(const e of i.getCellsXSO().get())t.push(this._treePanelCtrl.getModelInfoFromNodeModel(e.nodeModel).idPath);this._treeDocument&&await n.createComponentsFromPOIds(t,e.productActor)}}})}}return t}});this.setPanelContent(i.getContent())}}}),function(){"use strict";if("function"==typeof window.Event)return!1;function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}e.prototype=window.Event.prototype,window.Event=e}(),define("DS/VCXWebGUI/VCXGUIManager",["UWA/Class","DS/CoreEvents/Events","DS/CoreEvents/ModelEvents","DS/Core/PointerEvents","DS/Controls/Tooltip","DS/Controls/TooltipModel","DS/WebappsUtils/WebappsUtils","DS/VCXWebGUI/VCXScenarioCtrlExt","DS/VCXWebGUI/VCXSceneCtrl","DS/VCXWebGUI/VCXPlayCtrl","DS/VCXWebGUI/VCXPanelCtrl","DS/VCXWebGUI/VCXPaperCtrl","DS/VCXWebGUI/VCXPaperCtrlV2","DS/VCXWebGUI/VCXRatioCtrl","DS/VCXWebGUI/VCXMaterialCtrl","DS/VCXWebGUI/VCXAmbienceCtrl","DS/VCXWebGUI/VCXTreePanelCtrl","DS/VCXWebGUI/VCXPropertiesCtrlExt","DS/VCXWebGUI/VCXUndoRedoCtrl","DS/VCXWebGUI/VCXDocManagerCtrl","DS/VCXWebGUI/VCXLinkedPropCtrl","DS/VCXWebGUI/VCXStatsCtrl","DS/VCXGUIInfrastructure/VCXTabPageFrame","DS/VCXWebTreeGUI/VCXWebTabFrameCtrl","DS/VCXWebTreeGUI/VCXWebAssemblyTabFrameCtrl","DS/VCXWebTreeGUI/VCXWebDressupTabFrameCtrl","DS/VCXWebTreeGUI/VCXWebStylesTabFrameCtrl","DS/VCXWebTreeGUI/VCXWebAssemblyTreeCtrl","DS/VCXWebTreeGUI/VCXWebSelectionSetsTreeCtrl","DS/VCXWebTreeGUI/VCXWebHotspotsTreeCtrl","DS/VCXWebTreeGUI/VCXWebDressupTreeCtrl","DS/VCXWebTreeGUI/VCXWebStylesTreeCtrl","DS/Windows/WindowManager","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Loader","DS/Controls/ModalContainer","DS/ApplicationFrame/CommandsManager","DS/VCXWebGUI/VCXTimelineController","DS/VCXWebGUI/VCXGUIServices","DS/VCXWebGUI/VCXGettingStartedUI","DS/VCXWebIO/VCXLogServices","DS/VCXWebVisu/VCXModifiablesAccess","DS/VCXWebGUI/VCXLandingPage","DS/VCXWebGUI/VCXUpdateView","DS/VCXWebGUI/VCXMediaChooserServices","DS/VCXWebEWS/VCXExperienceServices","DS/VCXWebPlatform/VCX3DSpaceServices","DS/VCXWebSystem/VCXHardwareServices","DS/VCXWebGUI/VCXGettingStartedExperienceInformationModal","DS/VCXWebGUIInfra/VCXContainerDivider","DS/VCXWebGUI/VCXSelectionSetPanel","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],function(e,t,n,i,a,r,o,s,l,c,d,u,p,h,m,g,C,v,_,b,f,S,V,y,x,P,I,M,w,D,X,T,A,E,G,B,k,N,U,F,W,O,L,R,H,q,j,z,K,Z,Q,Y,J){"use strict";var $=e.extend({GetSelectedProperties:function(){if(this._vcxPropertiesCtrl&&this._vcxPropertiesCtrl.GetSelectedProperties)return this._vcxPropertiesCtrl.GetSelectedProperties()},CopyProperties:function(e,t){this._copyProperties=e,this._copyModifiables=t},GetCopiedProperties:function(){var e={};return e.properties=this._copyProperties,e.arrayMod=this._copyModifiables,e},getUsableArea:function(e){if(!this._experienceBase.getManager("VCXContextManager").isSupported("Paper"))return this.GetCanvasView();var t="wux-windows-docking-element-free-zone wux-docking-element-bottom";return"boolean"==typeof e&&e&&(t="wux-controls-abstract wux-windows-immersive-frame"),document.getElementsByClassName(t)[0]},postUpdate:function(e){this._vcxWebAssemblyTreeCtrl&&this._vcxWebAssemblyTreeCtrl.unstackSelect(),this._vcxWebSelectionSetsTreeCtrl&&this._vcxWebSelectionSetsTreeCtrl.unstackSelect(),this._vcxWebHotspotsTreeCtrl&&this._vcxWebHotspotsTreeCtrl.unstackSelect(),this._vcxWebDressupTreeCtrl&&this._vcxWebDressupTreeCtrl.unstackSelect(),this._vcxWebStylesTreeCtrl&&this._vcxWebStylesTreeCtrl.unstackSelect()},_getOptiUsableArea:function(e){var t=document.getElementsByClassName("wux-controls-abstract wux-windows-immersive-frame")[0],n=t&&t.getBoundingClientRect();if(e&&n){var i={},a=e.getBoundingClientRect();i.left=a.left-n.left,i.top=a.top-n.top,i.right=n.right-a.right,i.bottom=a.bottom,i.width=a.width,i.height=a.height;return i.left+=5,i.top+=5,i.right-=5,i.width-=10,i.bottom-=5,i.height-=10,i}},updateUsableArea:function(){this._experienceBase.getManager("VCXContextManager").isSupported("Paper");var e=this._getOptiUsableArea(this.getUsableArea()),n=this._getOptiUsableArea(this.getUsableArea(!0));e&&n&&(this._vcxPaperCtrl&&this._vcxPaperCtrl.updatePaperArea(e),this._vcxPaperCtrlV2&&this._vcxPaperCtrlV2.updatePaperArea(e,n),this._vcxPlayCtrl&&this._vcxPlayCtrl.updatePaperArea(e,n),this._experienceBase.getManager("VCXContextManager").getUrlVars().optimViewportPaper&&(this.GetCanvasView().style.position="absolute",this.GetCanvasView().style.left=e.left+"px",this.GetCanvasView().style.right=e.right+"px",this.GetCanvasView().style.top=e.top+"px",this.GetCanvasView().style.bottom=e.bottom+"px"),t.publish({event:"VCX_GUI_USABLEAREA_UPDATE",data:{area:e,areaWithoutPanels:n}}))},getUIResponsivenessParameters:function(e){var t=this._getUIResponsivenessParametersArray();if(!t)return null;for(var n=0;n<t.length;++n){var i=t[n];if(e<=i.viewportMax&&e>i.viewportMin)return i}},_getUIResponsivenessParametersArray:function(){return[{viewportMin:0,viewportMax:880,panelMinWidth:250,hidePanels:!0,fitBetweenPanels:!1},{viewportMin:880,viewportMax:1080,panelMinWidth:250,hidePanels:!1,fitBetweenPanels:!1},{viewportMin:1080,viewportMax:1/0,panelMinWidth:300,hidePanels:!1,fitBetweenPanels:!0}]},updateDockingElements:function(){if(this.immersiveFrame){var e=[],t=this.immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea);t&&e.push(t);var n=this.immersiveFrame.getDockingElement(WUXDockAreaEnum.LeftDockArea);n&&e.push(n);for(var i=this._getUIResponsivenessParametersArray(),a=document.body.clientWidth,r=null,o=null,s=!1,l=null,c=null,d=!this._previousViewportWidth,u=!!this._previousViewportWidth,p=0;p<i.length;++p){var h=!1,m=i[p];if(!s&&a<=m.viewportMax&&a>m.viewportMin&&(r=m.panelMinWidth,o=m.hidePanels,s=!0,h=!0),!d&&this._previousViewportWidth&&this._previousViewportWidth<=m.viewportMax&&this._previousViewportWidth>m.viewportMin&&(l=m.panelMinWidth,c=m.hidePanels,d=!0,h||(u=!1)),s&&d)break}if(s&&d){if(!u)for(var g=0;g<e.length;++g){var C=e[g];if(l<r)C.minSize=r,C.dockingZoneSize<C.minSize&&(C.dockingZoneSize=C.minSize);else if(l>r){var v=C.dockingZoneSize===C.minSize;C.minSize=r,v&&(C.dockingZoneSize=C.minSize)}c!==o&&C.collapseDockingZoneFlag!==o&&(C.collapseDockingZoneFlag=o)}var _=this._experienceBase.getManager("VCXContextManager");_.isSupported("PropAndScnPanelExpandOverride")&&(_.isSupported("ScenarioPanelExpand")?e[1].collapseDockingZoneFlag=!1:e[1].collapseDockingZoneFlag=!0,_.isSupported("PropertiesPanelExpand")?e[0].collapseDockingZoneFlag=!1:e[0].collapseDockingZoneFlag=!0),this._previousViewportWidth=a}else console.warn("Something went wrong: we didn't get all infos")}},unInitialize:function(){H.unInit(),this._experienceBase.getManager("VCXContextManager").unloadCssFile("VCXWebGUI/VCXGUIManager.css"),this._experienceBase.getManager("VCXContextManager").unloadCssFile("VCXWebGUI/VCXUISequence.css"),this._experienceBase.getManager("VCXContextManager").unloadCssFile("VCXWebTreeGUI/VCXWebTreeGUI.css"),this._experienceBase.getManager("VCXContextManager").unloadCssFile("VCXWebGUI/VCXWebSignature.css"),this._experienceBase.getManager("VCXContextManager").unloadCssFile("VCXWebGUI/VCXUIPaper.css",1),this._experienceBase.getManager("VCXContextManager").unloadCssFile("VCXWebGUI/VCXUIMaterial.css",1),Z.unInitialize();var e=this._experienceBase.getManager("VCXContextManager").getActionBar();if(this._ACTIONBAR_OPEN_timeout&&(clearTimeout(this._ACTIONBAR_OPEN_timeout),this._ACTIONBAR_OPEN_timeout=null),this._ACTIONBAR_CLOSE_timeout&&(clearTimeout(this._ACTIONBAR_CLOSE_timeout),this._ACTIONBAR_CLOSE_timeout=null),e&&e._modelEvents.unsubscribe(this._ACTIONBAR_OPEN),e&&e._modelEvents.unsubscribe(this._ACTIONBAR_CLOSE),this._ACTIONBAR_OPEN=0,this._ACTIONBAR_CLOSE=0,this._frmWindow){var n=this._frmWindow._sceneGraphTree.tree._sidePanel;this._VCX_GUI_PANEL_SLIDE_IN&&n&&n._modelEvents.unsubscribe(this._VCX_GUI_PANEL_SLIDE_IN),this._VCX_GUI_PANEL_SLIDE_OUT&&n&&n._modelEvents.unsubscribe(this._VCX_GUI_PANEL_SLIDE_OUT)}for(var a in this._VCX_GUI_PANEL_SLIDE_IN=0,this._VCX_GUI_PANEL_SLIDE_OUT=0,this._tokens)this._tokens.hasOwnProperty(a)&&t.unsubscribe(this._tokens[a]);if(window.detachEvent?(window.detachEvent("dimensionsChanged",this._onResizeDocking),window.detachEvent("dockIsResizing",this._onResizeDocking),window.detachEvent("dockResize",this._onResizeDocking),window.detachEvent("onresize",this._onResizeWidget)):window.removeEventListener&&(window.removeEventListener("dimensionsChanged",this._onResizeDocking,!0),window.removeEventListener("dockIsResizing",this._onResizeDocking,!0),window.removeEventListener("dockResize",this._onResizeDocking,!0),window.removeEventListener("resize",this._onResizeWidget,!0)),this.immersiveFrame)for(var r=this.immersiveFrame.dockingElements,o=0;o<r.length;o++){r[o].removeEventListener(i.POINTERUP,this._updateDockingAreaCB)}this._frmWindow=null,this._uiLayer=null,this.immersiveFrame=null,this._isIE11=null,this._init=0,this._destroyed=0,this._vcxGettingStartedUI&&(this._vcxGettingStartedUI.unInitialize(),this._vcxGettingStartedUI=null),this._vcxPanelCtrl&&(this._vcxPanelCtrl.unInitialize(),this._vcxPanelCtrl=null),this._vcxRatioCtrl&&(this._vcxRatioCtrl.unInitialize(),this._vcxRatioCtrl=null),this._vcxScenarioCtrl&&(this._vcxScenarioCtrl.unInitialize(),this._vcxScenarioCtrl=null),this._vcxPlayCtrl&&(this._vcxPlayCtrl.unInitialize(),this._vcxPlayCtrl=null),this._vcxSceneCtrl&&(this._vcxSceneCtrl.unInitialize(),this._vcxSceneCtrl=null),this._vcxMaterialCtrl&&this._vcxMaterialCtrl.unInitialize&&(this._vcxMaterialCtrl.unInitialize(),this._vcxMaterialCtrl=null),this._vcxAmbienceCtrl&&this._vcxAmbienceCtrl.unInitialize&&(this._vcxAmbienceCtrl.unInitialize(),this._vcxAmbienceCtrl=null),this._vcxTreePanelCtrl&&this._vcxTreePanelCtrl.unInitialize&&(this._vcxTreePanelCtrl.unInitialize(),this._vcxTreePanelCtrl=null),this.unInitTreesTabFrames(),this._vcxPaperCtrl&&(this._vcxPaperCtrl.unInitialize(),this._vcxPaperCtrl=null),this._vcxPaperCtrlV2&&(this._vcxPaperCtrlV2.unInitialize(),this._vcxPaperCtrlV2=null),this._vcxPropertiesCtrl&&(this._vcxPropertiesCtrl.unInitialize(),this._vcxPropertiesCtrl=null),this._vcxTimelineCtrl&&(this._vcxTimelineCtrl.unInitialize(),this._vcxTimelineCtrl=null),this._forceDisplayTimeline=null,_.removeDiv(),this._vcxDocManagerCtrl&&this._vcxDocManagerCtrl._mainPanel&&this._vcxDocManagerCtrl._mainPanel.parentNode&&(this._vcxDocManagerCtrl._mainPanel.parentNode.removeChild(this._vcxDocManagerCtrl._mainPanel),this._vcxDocManagerCtrl.unInitialize(),this._vcxDocManagerCtrl=null),this._vcxLinkedPropCtrl&&this._vcxLinkedPropCtrl._mainPanel&&this._vcxLinkedPropCtrl._mainPanel.parentNode&&(this._vcxLinkedPropCtrl._mainPanel.parentNode.removeChild(this._vcxLinkedPropCtrl._mainPanel),this._vcxLinkedPropCtrl.unInitialize(),this._vcxLinkedPropCtrl=null),this._vcxSampleCtrl&&(this._vcxSampleCtrl.unInitialize(),this._vcxSampleCtrl=null),this._usableArea&&this._usableArea.parentNode&&this._usableArea.parentNode.removeChild(this._usableArea),this._usableArea=null,this._modelEvent.publish({event:"unInitialize",data:{}}),removeEventListener("keydown",this._onKeydownEvent);var s=document.querySelectorAll(".wux-controls-abstract.wux-windows-window.wux-windows-windowgroup");for(o=0;o<s.length;o++)s[o].remove();this.landingPage&&(this.landingPage.close(),this.landingPage=null),this._touchMultiSelectionDiv&&(this._touchMultiSelectionDiv.remove(),this._touchMultiSelectionDiv=null)},initialize:function(){var e=this._experienceBase.getManager("VCXContextManager"),t=e.getPlayerMode(),i=!!e.getExperienceIn3DPlay(),a=e.getProdHighMode();this._modelEvent=new n,this._forceDisplayTimeline=!1,Z.initialize(),e.loadCssFile("VCXWebProducts/VCXWebProducts.css",1),e.loadCssFile("VCXWebGUI/VCXGUIManager.css",1),e.loadCssFile("VCXWebGUI/VCXUISequence.css",1),e.loadCssFile("VCXWebTreeGUI/VCXWebTreeGUI.css",1),e.loadCssFile("VCXWebGUI/VCXUIPaper.css",1),e.loadCssFile("VCXWebGUI/VCXPropertyPanel.css",1),e.loadCssFile("VCXWebGUI/VCXUIMaterial.css",1);var r="",s="",l="",c=!0,d=!0,u=!1,p=e.IsLocalMode();if(a&&!p){var h=this;this.landingPage=new R({widgetId:widget.id,parent:document.querySelector(".wux-afr-framewindow"),experienceBase:h._experienceBase}),this._vcxGettingStartedUI=this.landingPage._vcxGettingStartedUI}else window.loading3DXML||i&&a||(this._vcxGettingStartedUI=this.getGettingStartedUI(),this._vcxGettingStartedUI&&(this._vcxGettingStartedUI.initialize({localMode:p}),this._vcxGettingStartedUI.setExperienceBase(this._experienceBase),"undefined"!=typeof widget&&widget.body?this._vcxGettingStartedUI.setParentNode(widget.body):document.body?this._vcxGettingStartedUI.setParentNode(document.body):console.error("The widget and the document bodies are undefined.")));l=J["VCXGettingStartedUI.CreateExperience"],s=J["VCXGettingStartedUI.WelcomeMessageAuthoring"],t&&i&&!a?(r="url("+o.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Player_BackgroundLogo_In3DPlay.png")+")",s="",l="",c=!1,d=!1):t?(s=J["VCXGettingStartedUI.WelcomeMessagePlay"],r="url("+o.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Player_BackgroundLogo_CATIA.png")+")",c=!1,l="Open an smg",u=!0):a?p&&(u=!0):r="url("+o.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_BackgroundLogo_3DEXCITE_XPC.png")+")",this._firstLoad=!0,this._publishAdvancedDisplay=!1,this._vcxSampleCtrl=null,this._isPlayingGoTo=0,this._isAnimationLoop=!1,this._isCameraPlayMode=!1,this._vcxScenarioCtrl=null,this._vcxPlayCtrl=null,this._vcxSceneCtrl=null,this._vcxWebAssemblyTreeCtrl=null,this._vcxWebDressupTreeCtrl=null,this._vcxWebStylesTreeCtrl=null,this._vcxPublishRasterImageCtrl=null,this._vcxPublishVideoCtrl=null,this._vcxPaperCtrl=null,this._vcxPaperCtrlV2=null,this._vcxPropertiesCtrl=null,this._vcxDocManagerCtrl=null,this._vcxLinkedPropCtrl=null,this._frmWindow=null,this._uiLayer=null,this.immersiveFrame=null,this._backgroundDrop=null,this._backgroundDropText=null,this._dropZone=null,this._usableArea=null,this._touchMultiSelectionDiv=null,this._touchAvailable=!0,this._tokens={},this._vcxDisplayScenarioImmersiveUI=!1,this._tooltipDisplay="true"!==e.getUrlVars().DeactivateTooltipsAtStart,this.isTouchActivated()&&(this._tooltipDisplay=!1),this._init=0;var m=null;if((m=widget&&widget.getValue("X3DContentId")&&JSON.parse(widget.getValue("X3DContentId")))&&m.data&&m.data.items[0]&&m.data.items[0].objectId&&"HighlightPresentation3DCom"==m.data.items[0].objectType){var g=m.data.items[0].displayName,C=m.data.items[0].objectId;this._experienceBase.getManager("VCXAnalyticsTrackerAppManager").trackOpenPresentationEvent("xH_OpenWith"),j.onLoadExperienceFromPhysicalID(this._experienceBase,g,C),m.data=null,widget.setValue("X3DContentId",JSON.stringify(m))}else{if(this.landingPage){h=this;var v=this._vcxGettingStartedUI;return this.landingPage.initializeButtons().then(function(){return h.landingPage.displayHome()}).then(function(){"undefined"!=typeof widget&&v&&v.dropZone.inject(v.parentNode)})}if(this._vcxGettingStartedUI){var _=this.getBrandImage();this._vcxGettingStartedUI.startExperiencePage(s,_,r,l,c,d,u)}}},getBrandImage:function(){var e=this._experienceBase.getManager("VCXContextManager"),t=e.getPlayerMode(),n=!!e.getExperienceIn3DPlay(),i=e.getProdHighMode();return t&&n&&!i?"I_VCX_Player_BackgroundLogo_In3DPlay.png":i?"I_VCX_SplashComposer"+Math.floor(5*Math.random()+1)+"_.png":void 0},setPublishAdvancedDisplay:function(e){this._publishAdvancedDisplay=e,this._vcxPublishRasterImageCtrl&&this._vcxPublishRasterImageCtrl.updateAdvancedDisplay(),this._vcxPublishVideoCtrl&&this._vcxPublishVideoCtrl.updateAdvancedDisplay()},getPublishAdvancedDisplay:function(){return this._publishAdvancedDisplay},getAdditionalActionBarSections:function(e){void 0===this._experienceBase.getManager("VCXContextManager").getUrlVars().debug&&"true"!=localStorage.getItem("xHighlight_debugMode")||e.push({file:"VCXWebDebug.xml",module:"VCXWebDebug",merge:!0})},onVCXActionBarReady:function(e){const t=this._experienceBase.getManager("VCXAnalyticsTrackerAppManager");if(!this._onCommandStartToken&&t){const e=this._experienceBase.getManager("VCXContextManager"),t=e?e.getContext():"";this._onCommandStartToken=N.onCommandStart(e=>{this._experienceBase.getManager("VCXAnalyticsTrackerAppManager").trackStartCmdEvent(e.getId())},t)}this._onResizeWidgetCB(),this.recordActionBarEvent()},recordActionBarEvent:function(){var e=this._experienceBase.getManager("VCXContextManager").getActionBar();if(e){this._experienceBase.getManager("VCXContextManager").getPlayerMode()&&e.close();parseFloat(e.elements.container.style.transitionDuration);var t=this;this._ACTIONBAR_OPEN||(this._ACTIONBAR_OPEN=e._modelEvents.subscribe({event:"ACTIONBAR_OPEN"},function(){t._ACTIONBAR_OPEN_timeout=setTimeout(function(){t.updateUsableArea()},1e3*parseFloat(.4))})),this._ACTIONBAR_CLOSE||(this._ACTIONBAR_CLOSE=e._modelEvents.subscribe({event:"ACTIONBAR_CLOSE"},function(){t._ACTIONBAR_CLOSE_timeout=setTimeout(function(){t.updateUsableArea()},1e3*parseFloat(.4))}))}},postInitialize:async function(){var e=this;void 0!==this._experienceBase.getManager("VCXContextManager").getUrlVars().debug&&(window.onerror=function(t,n,i){var a;a=J["Notification.Unstable"];var r={level:"error",title:J["Notification.Crash"],message:a};e._experienceBase.getManager("VCXNotificationManager").addNotification(r)}),void 0!==this._experienceBase.getManager("VCXContextManager").getUrlVars().DSWebRecord&&(document.experienceBase=this._experienceBase);var n=this._experienceBase.getManager("VCXContextManager");this._frmWindow=n.getFrameWindow(),this._uiLayer=this._frmWindow&&this._frmWindow.getUIFrame(),this.immersiveFrame=this._frmWindow&&this._frmWindow.getImmersiveFrame(),A._activeWindow=null,this.isTouchActivated()&&this._uiLayer.addClassName("vcxTouchMode");var o=K.GetGraphicCard(),s=null===o,l=!s&&K.isLowGraphicPresent(o),c=!1;if(n.getExperienceIn3DPlay()&&(c=!0),this._experienceBase.getManager("VCXAnalyticsTrackerAppManager")&&this._experienceBase.getManager("VCXAnalyticsTrackerAppManager").trackGraphicCards(o),s||l)if(this._uiLayer.addClassName("vcxNoGraphiCard"),s){var d="Notification.NoGraphicCardDetected";K.IsFirefox()&&(d="Notification.FirefoxActivateWebGL"),this._experienceBase.getManager("VCXNotificationManager").addNotification({level:"error",title:"error",message:J[d]})}else{var u;if(c)"true"!==(u=!!localStorage&&localStorage.getItem("DS_COMPOSER_LOW_GRAPHIC_CARD_DETECTED"))&&"1"!==u&&this._experienceBase.getManager("VCXNotificationManager").addNotification({level:"warning",title:J["Notification.LowGraphicCardTitle"],message:J["Notification.LowGraphicCardAction"],action:{label:J["Notification.Confirm"],callback:function(){localStorage&&(localStorage.setItem("DS_COMPOSER_LOW_GRAPHIC_CARD_DETECTED",!0),this.getParent()&&(this.getParent().destroy(),location.reload()))}}});else"true"!==(u=!!localStorage&&localStorage.getItem("DS_COMPOSER_GUI_DONT_SHOW_AGAIN_LOW_GRAPHIC_CARD_DETECTED"))&&"1"!==u&&(console.log("Card Detected : "+o),this._experienceBase.getManager("VCXNotificationManager").addNotification({level:"warning",title:"warning",message:J["Notification.LowGraphicCardDetected"],action:{label:J["Notification.DontShowMeAgain"],callback:function(){localStorage&&(localStorage.setItem("DS_COMPOSER_GUI_DONT_SHOW_AGAIN_LOW_GRAPHIC_CARD_DETECTED",!0),this.getParent()&&this.getParent().destroy())}}}))}this._frmWindow&&this._frmWindow._sceneGraphTree&&this._frmWindow._sceneGraphTree.tree.slideOut(),this._onResizeDocking=function(t){e.updateUsableArea()},this._onResizeWidget=function(t){t.target===window&&e._onResizeWidgetCB()},window.attachEvent?(window.attachEvent("dimensionsChanged",e._onResizeDocking),window.attachEvent("dockIsResizing",e._onResizeDocking),window.attachEvent("dockResize",e._onResizeDocking),window.attachEvent("onresize",e._onResizeWidget)):window.addEventListener&&(window.addEventListener("dimensionsChanged",this._onResizeDocking,!0),window.addEventListener("dockIsResizing",e._onResizeDocking,!0),window.addEventListener("dockResize",e._onResizeDocking,!0),window.addEventListener("resize",e._onResizeWidget,!0)),e.GetCanvasView().addClassName("vcx-canvas-view");!0===n.getExperienceIn3DPlay()&&("275px","250px","-125px","-120px",""),this.recordActionBarEvent();var p=n.getPlayerMode(),h=this._experienceBase.getManager("VCXContextManager").IsLocalMode(),m="1"===this._experienceBase.getManager("VCXContextManager").getUrlVars().noSample||!h&&!p;!1===n.getExperienceIn3DPlay()&&!1===n.getExperienceInGuidedTour()&&!m&&await new Promise(t=>{require(["DS/VCXWebDebug/VCXSampleCtrl"],function(n){void 0===e._destroyed&&(e._vcxSampleCtrl=new n(e,[])),t()})}),e._updateDockingAreaCB=function(t){setTimeout(function(){e.updateUsableArea()},305)};for(var g=e.immersiveFrame&&e.immersiveFrame.dockingElements,C=0;C<g&&g.length;C++){g[C].addEventListener(i.POINTERUP,e._updateDockingAreaCB)}if(e._frmWindow&&e._frmWindow._sceneGraphTree){var v=e._frmWindow._sceneGraphTree.tree._sidePanel,_=parseFloat(v.elements.panel.style.transitionDuration);this._VCX_GUI_PANEL_SLIDE_IN=v.onSlideIn(function(){setTimeout(function(){t.publish({event:"VCX_GUI_PANEL_SLIDE_IN"})},1e3*_)}),this._VCX_GUI_PANEL_SLIDE_OUT=v.onSlideOut(function(){setTimeout(function(){t.publish({event:"VCX_GUI_PANEL_SLIDE_OUT"})},1e3*_)})}this._tokens.event_VCX_BEGIN_TRANSITION=t.subscribe({event:"VCX_BEGIN_TRANSITION"},function(){e.SetIsPlaying()}),this._tokens.event_VCX_END_TRANSITION=t.subscribe({event:"VCX_END_TRANSITION"},function(){e.UnSetIsPlaying()});var b=new a({target:e.GetCanvasView()});this._tokens._evtPreHLRemoveToken=t.subscribe({event:"VCX_PREHIGHLIGHT_REMOVE"},function(t){b&&(b.hide(),b.tooltipInfos=void 0),e.GetCanvasView().tooltipInfos=void 0}),this._tokens._evtPreHLAddToken=t.subscribe({event:"VCX_PREHIGHLIGHT_ADD"},function(t){if(t[0].event){if(!e._tooltipDisplay)return;var n="";if(t&&Array.isArray(t))for(var i=0;i<t.length;++i){var a=t[i]&&t[i].pathElement,o=L.GetModifiableFromPathElement(a,e._experienceBase);if(o){var s=o.GetProperty("Actor.ToolTip._ComputedText");s&&(n=s.GetPropertyValue().GetValue())}else console.log("no modifiable associated to pathElement.")}e.GetCanvasView().tooltipInfos=new r({shortHelp:n,initialDelay:"1000",reshowDelay:"0"}),b.mousePosition=t[0].event.currentPosition,b.target=e.GetCanvasView(),b.show()}}),this._tokens._VCX_COMPONENTS_CREATED=t.subscribe({event:"VCX_COMPONENTS_CREATED"},e=>{this._createdComponents||(this._createdComponents=[]),this._createdComponents.push(...e.components)}),this._endLoadingDone=!1,this._tokens._VCX_END_LOADING_DONE=t.subscribe({event:"VCX_END_LOADING_DONE"},function(t){e._endLoadingDone=!0})},_onResizeWidgetCB:function(){this.updateUsableArea(),this.updateDockingElements()},getTooltipDisplay:function(e){return this._tooltipDisplay},setTooltipDisplay:function(e){"boolean"==typeof e&&(this._tooltipDisplay=e)},requestPropertiesPanelRefresh:function(){this._vcxPropertiesCtrl&&this._vcxPropertiesCtrl.requestRefresh()},update:function(e){for(;this._createdComponents&&this._createdComponents.length;){let e=this._createdComponents.pop();this._vcxWebAssemblyTreeCtrl&&this._vcxWebAssemblyTreeCtrl.getOrCreateTreeNodesModelFromComponent(e)}this._firstLoad&&(this._firstLoad=!1),this._vcxTimelineCtrl&&this._vcxTimelineCtrl.updateTimelineFromModel(),this._vcxPropertiesCtrl&&this._vcxPropertiesCtrl.update(e)},setAuthoringTooltipVisibility:function(e){},InitGUI:function(){if(1===this._init)return void console.log("VCXGUIManager::InitGUI has already been done");const e=O.generateUUID();this._init=1,O.memoryLog("InitGUI",!0,e),"undefined"!=typeof widget&&widget.simulatePlay&&(this._experienceBase.getManager("VCXContextManager").setSimulatePlayMode(),this._experienceBase.getManager("VCXContextManager").setPlayerMode(),widget.simulatePlay=null);var n=this._experienceBase.getManager("VCXContextManager").getPlayerMode(),i=this._experienceBase.getManager("VCXContextManager").getProdHighMode(),a=this._experienceBase.getManager("VCXContextManager").getExperienceIn3DPlay(),r=this._experienceBase.getManager("VCXContextManager").getSimulatePlayMode(),o="",_="";a&&i?(_="VCXWeb3DPlay",o="VCXWebDsxmApp.xml"):i&&(_="VCXWebAuthoringApp",o=r?"VCXWebSimulatePlay.xml":K.isMobileDevice()?"VCXWebAuthoringAppMobile.xml":"VCXWebAuthoringApp.xml"),(x=this._experienceBase.getManager("VCXContextManager").getActionBar())&&o!==x._currentBarFile&&""!==o&&(x.loadModel({file:o,module:_,merge:!1}),x._additionalActionBarSections=null,x._currentBarFile=o,t.publish({event:"VCXActionBarLoadRequest",data:{module:_}}));a=this._experienceBase.getManager("VCXContextManager").getExperienceIn3DPlay();var S=this._experienceBase.getManager("VCXContextManager").isSupported("DisplayUI"),V=this._experienceBase.getManager("VCXDRMManager"),y=this._experienceBase.getManager("VCXContextManager").getMainViewer();if(y.getRobot()&&(y.getRobot().setVisibility(!1),y.setReferenceAxisSystem(!0)),"undefined"!=typeof widget&&r){var x;if(V.GetDisplayScenariosPanel())this.immersiveFrame.getDockingElement(WUXDockAreaEnum.LeftDockArea).collapseDockingZoneFlag=!0,(x=this._experienceBase.getManager("VCXContextManager").getActionBar())&&x.close();this._experienceBase.getManager("VCXSelectManager").unableSelectionInPlayMode()}else"undefined"!=typeof widget&&a&&(this.immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).collapseDockingZoneFlag=!0,this.immersiveFrame.getDockingElement(WUXDockAreaEnum.LeftDockArea).collapseDockingZoneFlag=!0);if(0===S&&!r)return this._experienceBase.getManager("VCXContextManager").isSupported("Paper")&&!r&&(this._experienceBase.getManager("VCXContextManager").isSupported("PaperControlV2")?this._vcxPaperCtrlV2=new p(this,this._experienceBase):this._vcxPaperCtrl=new u(this,this._experienceBase)),void O.memoryLog("InitGUI",!1,e);if(this._experienceBase.getManager("VCXContextManager").isSupported("DisplayUI")){var P="SequenceFolder.Scenarios",I="Sequence.CADViews",M="Sequence.CADCaptures",w="Sequence.Layers",D=[P=J[P],(I=J[I])+"|"+(M=J[M]),w=J[w]];this._experienceBase.getManager("VCXContextManager").isSupported("DisplayUIScenariosPanel")&&(this._experienceBase.getManager("VCXContextManager").isSupported("SceneControlV2")?(localStorage.getItem("VCXNewFrame")&&(this._vcxPanelCtrl=new d(this,n),this._vcxRatioCtrl=new h(this)),this._vcxSceneCtrl=new l(this,D,n),this._vcxPanelCtrl&&(this._vcxPanelCtrl.createBaseView(document.querySelector(".vcxLeftContainer")),this._vcxPanelCtrl.createButton(this._vcxRatioCtrl.getPanelView(),"Canvas","aspect-ratio",1,!0))):this._vcxScenarioCtrl=new s(this,D,n)),this._experienceBase.getManager("VCXContextManager").isSupported("DisplayUIPlay")&&(this._vcxPlayCtrl=new c(this._experienceBase))}if(this._experienceBase.getManager("VCXContextManager").isSupported("VCXMaterialPanel")&&!r&&(this._vcxMaterialCtrl=new m(this),this._vcxPanelCtrl&&this._vcxPanelCtrl.createButton(this._vcxMaterialCtrl._viewPanel.panel,"Materials","material",4)),this._experienceBase.getManager("VCXContextManager").isSupported("VCXAmbiencePanel")&&!r&&(this._vcxAmbienceCtrl=new g(this),this._vcxPanelCtrl&&this._vcxPanelCtrl.createButton(this._vcxAmbienceCtrl._viewPanel.panel,"Ambiences","picture-360",5)),this._experienceBase.getManager("VCXContextManager").isSupported("VCXTreePanel")&&!r&&(this._vcxTreePanelCtrl=new C(this)),this._experienceBase.getManager("VCXContextManager").isSupported("Paper")&&!r&&(this._experienceBase.getManager("VCXContextManager").isSupported("PaperControlV2")?this._vcxPaperCtrlV2=new p(this,this._experienceBase):this._vcxPaperCtrl=new u(this,this._experienceBase)),this._experienceBase.getManager("VCXContextManager").isSupported("DisplayUI")){var X=this._experienceBase.getManager("VCXContextManager").getUrlVars().ForcePropertiesWriteMode;!1!==this._experienceBase.getManager("VCXContextManager").isSupported("DisplayUIPropertiesPanel")&&V.GetDisplayPropertiesPanel()&&(this._vcxPropertiesCtrl||(this._vcxPropertiesCtrl=new v(this,!X&&n),this._vcxPanelCtrl&&this._vcxPanelCtrl.createButton(this._vcxPropertiesCtrl.getPanelView(),"Properties","parameters",10))),this._vcxDocManagerCtrl=new b(this),this._vcxLinkedPropCtrl=new f(this),this._vcxScenarioCtrl&&(this._vcxScenarioCtrl.loadScenariosFromExperience(),this._vcxScenarioCtrl.onCurrentScenarioChanged(this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario())),this._vcxSceneCtrl&&(this._vcxSceneCtrl.loadScenariosFromExperience(),this._vcxSceneCtrl.onCurrentScenarioChanged(this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario())),this._experienceBase.getManager("VCXContextManager").isSupported("Timeline")&&this.InitTimelineCtrl(this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario(),0),this.initTreesTabFrames(),this._vcxScenarioCtrl&&this._vcxScenarioCtrl._tabPageFrame&&this._vcxScenarioCtrl._tabPageFrame._panelMaster.windowGroup&&(this._vcxScenarioCtrl._tabPageFrame._panelMaster.windowGroup.multiSelFlag=!1,this._vcxScenarioCtrl._tabPageFrame._panelMaster.windowGroup.currentWindows=[this._vcxScenarioCtrl._tabPageFrame._panelMaster]),this.immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).elements.collapser.setAttribute("data-rec-id","right-dock"),this.immersiveFrame.getDockingElement(WUXDockAreaEnum.LeftDockArea).elements.collapser.setAttribute("data-rec-id","left-dock"),this.immersiveFrame.getDockingElement(WUXDockAreaEnum.TopDockArea).elements.collapser.setAttribute("data-rec-id","top-dock"),this.immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).dockingZoneSize=300,this.immersiveFrame.getDockingElement(WUXDockAreaEnum.LeftDockArea).dockingZoneSize=300,this.updateDockingElements();var T=this;this._onKeydownEvent=function(e){T.onKeydownEvent(e)},addEventListener("keydown",this._onKeydownEvent)}if(H.initialize(this.immersiveFrame,this._experienceBase),r){var A=this._experienceBase&&this._experienceBase.getManager("VCXPlayManager");A&&A.setPlayMode(!0)}if(O.memoryLog("InitGUI",!1,e),this._experienceBase.getManager("VCXContextManager").isSupported("SceneControlV2")){if(localStorage.getItem("wux-windows-window")&&localStorage.removeItem("wux-windows-window"),!localStorage.getItem("wux-windows-window")){let e=[];e=e.concat(["scenePanelV2","dressupPanelV2","assemblyPanelV2"]),this._vcxMaterialCtrl&&e.push("VCXMaterialPanel"),this._vcxAmbienceCtrl&&e.push("VCXAmbiencePanel"),this._vcxTreePanelCtrl&&e.push("VCXTreePanel");for(let t of e)this.immersiveFrame.windows[t]&&this._addWindowToDockingGroup(this.immersiveFrame.windows[t],4)}this._vcxSceneCtrl&&this._vcxSceneCtrl.getPanelView().ensureVisible&&this._vcxSceneCtrl.getPanelView().ensureVisible()}const E=O.generateUUID();this._init=1,O.memoryLog("VCX_MATERIAL_LOADED",!0,E),t.publish({event:"VCX_MATERIAL_LOADED",data:null}),O.memoryLog("VCX_MATERIAL_LOADED",!1,E);const G=O.generateUUID();O.memoryLog("VCX_AMBIENCE_LOADED",!0,G),t.publish({event:"VCX_AMBIENCE_LOADED",data:null}),O.memoryLog("VCX_AMBIENCE_LOADED",!1,G);const B=O.generateUUID();O.memoryLog("initGUIEnd",!0,B),this._modelEvent.publish({event:"initGUIEnd",data:{}}),O.memoryLog("initGUIEnd",!1,B)},_addWindowToDockingGroup:function(e,t){let n=!1;if(this.immersiveFrame){for(const[i,a]of Object.entries(this.immersiveFrame.windows))if(e!==a&&a.currentDockArea===t){e.attachToWindow(a,WUXSnapAreaEnum.InsideArea,"after")<0?console.error("the window ",e._properties.title.value," could not be attached to ",a._properties.title.value):n=!0;break}n||(e.currentDockArea=t)}},subscribe:function(e,t){return this._modelEvent.subscribe({event:e},t)},onInitEnd:function(e){return this.subscribe("initGUIEnd",e)},onUnInitialize:function(e){return this.subscribe("unInitialize",e)},unsubscribe:function(e){this._modelEvent.unsubscribe(e)},initTreesTabFrames:function(){var e=this._experienceBase.getManager("VCXDRMManager"),t=this._experienceBase.getManager("VCXContextManager");(t.isSupported("DisplayUIAssemblyPanel")&&"0"!==t.getUrlVars().tree&&e.GetDisplayTree()||0==t.getPlayerMode())&&(this._vcxWebAssemblyTabFrameCtrl=new x(this._experienceBase),this._vcxPanelCtrl&&this._vcxPanelCtrl.createButton(this._vcxWebAssemblyTabFrameCtrl.uiPanelClass.panel,"Products","3dproduct",2),this._vcxWebAssemblyTreeCtrl=new M(this._experienceBase),this._vcxWebSelectionSetsTreeCtrl=new w(this._experienceBase),this._vcxWebHotspotsTreeCtrl=new D(this._experienceBase)),(t.isSupported("DisplayUIDressupsPanel")&&"0"!==t.getUrlVars().dressuptree&&e.GetDisplayTree()||0==t.getPlayerMode())&&(this._vcxWebDressupTabFrameCtrl=new P(this._experienceBase),this._vcxPanelCtrl&&this._vcxPanelCtrl.createButton(this._vcxWebDressupTabFrameCtrl.uiPanelClass.panel,"Markups","media-annotation",3),this._vcxWebDressupTreeCtrl=new X(this._experienceBase)),"1"==t.getUrlVars().stylestree&&(this._vcxWebStylesTabFrameCtrl=new I(this._experienceBase),this._vcxWebStylesTreeCtrl=new T(this._experienceBase));var n,i=!1;if(this._vcxWebAssemblyTabFrameCtrl||this._vcxWebDressupTabFrameCtrl||!t.getExperienceIn3DPlay()||t.getProdHighMode()||(i=!0,this._vcxWebDressupTabFrameCtrl=new P(this._experienceBase),this._vcxWebDressupTreeCtrl=new X(this._experienceBase)),t.isSupported("SceneControlV2"))n=[];else{n=[this._vcxWebAssemblyTabFrameCtrl,this._vcxWebDressupTabFrameCtrl,this._vcxScenarioCtrl],t.getProdHighMode()&&(n=[this._vcxScenarioCtrl,this._vcxWebDressupTabFrameCtrl,this._vcxWebAssemblyTabFrameCtrl],this._vcxMaterialCtrl&&n.push(this._vcxMaterialCtrl),this._vcxAmbienceCtrl&&n.push(this._vcxAmbienceCtrl),this._vcxTreePanelCtrl&&n.push(this._vcxTreePanelCtrl));var a=this._vcxScenarioCtrl}a||(a=n[length-1]),this._vcxSampleCtrl&&!t.isSupported("SceneControlV2")&&n.push(this._vcxSampleCtrl),this._vcxWebStylesTabFrameCtrl&&n.push(this._vcxWebStylesTabFrameCtrl);for(var r=null,o=null,s=0;s<n.length;++s)n[s]&&(r=n[s],o&&r.getFrame().tabWith(o.getFrame()),o=r);if(a||(a=o),a&&a.getFrame()._panelMaster.windowGroup)for(var l=0;l<a.getFrame()._panelMaster.windowGroup._tab._tabContent.length;l++)if(a.getFrame()._panelMaster.windowGroup._tab._tabContent[l].content===a.getFrame()._panelMaster.elements.container){a.getFrame()._panelMaster.windowGroup._tab.value=[l];break}i&&this.unInitTreesTabFrames()},unInitTreesTabFrames:function(){this._vcxWebAssemblyTabFrameCtrl&&(this._vcxWebAssemblyTabFrameCtrl.unInitialize(),this._vcxWebAssemblyTreeCtrl&&this._vcxWebAssemblyTreeCtrl.unInitialize(),this._vcxWebSelectionSetsTreeCtrl&&this._vcxWebSelectionSetsTreeCtrl.unInitialize(),this._vcxWebHotspotsTreeCtrl&&this._vcxWebHotspotsTreeCtrl.unInitialize(),this._vcxWebAssemblyTabFrameCtrl=null,this._vcxWebAssemblyTreeCtrl=null,this._vcxWebSelectionSetsTreeCtrl=null,this._vcxWebHotspotsTreeCtrl=null),this._vcxWebDressupTabFrameCtrl&&(this._vcxWebDressupTabFrameCtrl.unInitialize(),this._vcxWebDressupTreeCtrl.unInitialize(),this._vcxWebDressupTabFrameCtrl=null,this._vcxWebDressupTreeCtrl=null),this._vcxWebStylesTabFrameCtrl&&(this._vcxWebStylesTabFrameCtrl.unInitialize(),this._vcxWebStylesTreeCtrl.unInitialize(),this._vcxWebStylesTabFrameCtrl=null,this._vcxWebStylesTreeCtrl=null)},setUpTrees:function(){if(this._vcxWebAssemblyTabFrameCtrl instanceof y)if(this._experienceBase.getManager("VCXContextManager").isSupported("SceneControlV2")&&this._vcxWebAssemblyTabFrameCtrl.uiPanelClass){let e=this._setUpTreeV2(this._vcxWebAssemblyTreeCtrl,this._vcxWebAssemblyTabFrameCtrl,1),n=this._setUpTreeV2(this._vcxWebSelectionSetsTreeCtrl,this._vcxWebAssemblyTabFrameCtrl,2),i=UWA.Element("div",{class:"vcx-container-assembly-test"}),a=UWA.Element("div",{class:"vcx-container-selectionset-test"}),r=new Q({firstElement:i,secondElement:a,defaultPlacement:0===this._experienceBase.ComponentsMap.GetComponentFromType("VCXSelectionSet_Spec").length?1:.75});r.container.addClassName("vcxcontainerdivider-assemblytree"),this._vcxWebAssemblyTabFrameCtrl.containerDivider=r,this._tokens._VCX_SELECTIONSETS_ADDED=t.subscribe({event:"VCX_SELECTIONSETS_ADDED"},()=>{1===this._experienceBase.ComponentsMap.GetComponentFromType("VCXSelectionSet_Spec").length&&r.resize(.75)}),this._tokens._VCX_SELECTIONSETS_POSTREMOVED=t.subscribe({event:"VCX_SELECTIONSETS_POSTREMOVED"},()=>{0===this._experienceBase.ComponentsMap.GetComponentFromType("VCXSelectionSet_Spec").length&&r.resize(1)}),e.inject(i),n.inject(a),this._vcxWebAssemblyTabFrameCtrl.uiPanelClass.setPanelContent(r),this._vcxWebAssemblyTabFrameCtrl.setSubTrees([this._vcxWebAssemblyTreeCtrl,this._vcxWebSelectionSetsTreeCtrl])}else this._setUpTree(this._vcxWebAssemblyTreeCtrl,this._vcxWebAssemblyTabFrameCtrl,1),this._setUpTree(this._vcxWebSelectionSetsTreeCtrl,this._vcxWebAssemblyTabFrameCtrl,2),this._setUpTree(this._vcxWebHotspotsTreeCtrl,this._vcxWebAssemblyTabFrameCtrl,3);this._vcxWebDressupTabFrameCtrl instanceof y&&(this._experienceBase.getManager("VCXContextManager").isSupported("SceneControlV2")&&this._vcxWebDressupTabFrameCtrl.uiPanelClass?this._vcxWebDressupTabFrameCtrl.uiPanelClass.setPanelContent(this._setUpTreeV2(this._vcxWebDressupTreeCtrl,this._vcxWebDressupTabFrameCtrl,1)):this._setUpTree(this._vcxWebDressupTreeCtrl,this._vcxWebDressupTabFrameCtrl,1)),this._vcxWebStylesTabFrameCtrl instanceof y&&this._setUpTree(this._vcxWebStylesTreeCtrl,this._vcxWebStylesTabFrameCtrl,1)},_setUpTree:function(e,t,n){if(e&&!e.tree){e.setTabFrameCtrl(t),e.setSlidingViewIndex(n);var i=e.createTree();i||console.warn("Creation of "+e._type+" tree UI failed!"),i&&i.inject(t.getFrame()._slidingViews.getView(n))}},_setUpTreeV2:function(e,t,n){if(e&&!e.tree){e.setTabFrameCtrl(t),e.setSlidingViewIndex(n);var i=e.createTree();return i||console.warn("Creation of "+e._type+" tree UI failed!"),i}},onKeydownEvent:function(e){if(83===e.keyCode&&this.immersiveFrame&&"BODY"===document.activeElement.nodeName)if(this._statsCtrl)this._statsCtrl.destroy(),delete this._statsCtrl;else{var t={};t.currentDockArea=WUXDockAreaEnum.BottomDockArea,t.immersiveFrame=this.immersiveFrame,this._statsCtrl=new S(t)}},toggleTouch:function(){this._touchAvailable=!this._touchAvailable,this._vcxPaperCtrl&&(this._vcxPaperCtrl.mainPanel.parentNode.removeChild(this._vcxPaperCtrl.mainPanel),this._vcxPaperCtrl=null),this._vcxPaperCtrlV2&&(this._vcxPaperCtrlV2.paperControlToolbar.destroy(),this._vcxPaperCtrlV2=null),this.isTouchAvailable()?this._uiLayer.addClassName("vcxTouchMode"):this._uiLayer.removeClassName("vcxTouchMode"),this._experienceBase.getManager("VCXContextManager").isSupported("Paper")&&(this._experienceBase.getManager("VCXContextManager").isSupported("PaperControlV2")?this._vcxPaperCtrlV2=new p(this,this._experienceBase):this._vcxPaperCtrl=new u(this,this._experienceBase)),this.RefreshGUI()},isTouchAvailable:function(){return this._touchAvailable},isTouchActivated:function(){return K.isTouchCompliantDevice()&&this.isTouchAvailable()||this._experienceBase.getManager("VCXContextManager").isSupported("ForceTouch")},lockLoading:function(){document.body.addClassName("waiting"),document.querySelector(".moduleContent")&&(document.querySelector(".moduleContent").dataset.lockLoading="true")},islockLoading:function(){return!!document.querySelector(".moduleContent")&&"true"===document.querySelector(".moduleContent").lockLoading},unlockLoading:function(){document.querySelector(".moduleContent")&&(document.querySelector(".moduleContent").dataset.lockLoading=""),document.body.removeClassName("waiting")},RefreshGUI:function(){if(!this._init)return;const e=O.generateUUID();if(O.memoryLog("RefreshGUI",!0,e),this._vcxPaperCtrl&&this._vcxScenarioCtrl&&(this._vcxPaperCtrl._experienceBase=this._experienceBase),this._vcxPaperCtrlV2&&this._vcxScenarioCtrl&&(this._vcxPaperCtrlV2._experienceBase=this._experienceBase),this._vcxScenarioCtrl){var t=this._experienceBase.getManager("VCXContextManager").getPlayerMode(),n=this._experienceBase.getManager("VCXAPIManager").HasAnimation("AnimationSmgID"),i=!1;t?t&&!n&&(i=!0):i=!0,this._vcxScenarioCtrl.onCurrentScenarioChanged(this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario()),i&&1===this._experienceBase.getManager("VCXExperience").GetViewMode()&&this._vcxScenarioCtrl.setSequenceState("Animation",!1)}O.memoryLog("RefreshGUI",!1,e),this.unlockLoading()},hidePaperCtrl:function(){this._vcxPaperCtrl&&this._vcxPaperCtrl.hide(),this._vcxPaperCtrlV2&&this._vcxPaperCtrlV2.hide()},showPaperCtrl:function(){this._vcxPaperCtrl&&this._vcxPaperCtrl.show(),this._vcxPaperCtrlV2&&this._vcxPaperCtrlV2.show()},isHiddenPaperCtrl:function(){return this._vcxPaperCtrl?this._vcxPaperCtrl.isHidden():this._vcxPaperCtrlV2?this._vcxPaperCtrlV2.isHidden():null},RefreshPourcent:function(e){},ChangeTimePos:function(e,t){this._vcxTimelineCtrl&&this._vcxTimelineCtrl.ChangeTimePos(e,t)},InitTimelineCtrl:function(e,t){if(null!==this._vcxScenarioCtrl||null!==this._vcxSceneCtrl){var n=this._experienceBase.getManager("VCXContextManager").getContext();N.getCommandCheckHeader("VCXAutoKeyCmd",n);this._vcxTimelineCtrl&&(this._vcxTimelineCtrl.unInitialize(),this._vcxTimelineCtrl=null);var i={frmWindow:this._frmWindow,experienceBase:this._experienceBase,scenarioID:e,flattenKeys:!0};if(this._vcxTimelineCtrl=new U(i),""!==e){var a=this._experienceBase.getManager("VCXContextManager"),r=null;a&&(r=a.getContext());var o=N.getCommandCheckHeader("VCXCameraPlayModeCmd",r),s=N.getCommandCheckHeader("VCXAutoKeyCmd",r),l=Math.round(this._experienceBase.getManager("VCXScenarioManager").GetMaxFrame(e));0===l&&(l=500);var c={frmWindow:this._frmWindow,parent:this._vcxScenarioCtrl?this._vcxScenarioCtrl.getFrame().getFooter():this._vcxSceneCtrl.getPanelView().getContent(),displayToolbar:!0,displaySlider:!0,displayPlayBack:!1,displayLoop:!0,displayBounce:!0,displayReverse:!0,displayMarkers:!0,displayCamera:!!o,displayCameraMode:this._isCameraPlayMode=!!o&&o.getState(),maxFrame:l,timelineGUI:VCXWebTimelineGUIEnum.Light,title:"Light Timeline"};if(this._vcxTimelineCtrl.createTimeline(c),!this._experienceBase.getManager("VCXContextManager").getPlayerMode()){var d={timelineGUI:VCXWebTimelineGUIEnum.Main,maxFrame:l,numberOfTracks:5,step_time_min:.1,scenario:this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[e],propertiesTreeWidth:130},u=c;u.displayAutoKey=!!s,u.displayAutoKeyMode=this._isAutoKeyMode=!!s&&s.getState(),u.displayRemoveTracks=!0,u.parent=null,u.displaySlider=!1,u.displayPlayBack=!1,u.displayFilterOnSelection=!0,u.filterOnSelectionMode=!1;u.customButtons=[],d.toolbar=u,this._vcxTimelineCtrl.createTimeline(d)}for(var p=[],h=this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[e].QueryInterface("VCXIModifiable").GetProperty("Actor.Scenario.Markers").GetPropertyValue().GetValue(),m=0;m<h.length;m++){var g={},C=h[m];if("VCXPropertyValueLink"===C.GetType()){var v=C.GetValue(),_=this._experienceBase.ComponentsMap.GetComponentFromID(v);m.toString();if(_&&_.GetName){g.name=_.GetName(),g.id=_.GetID(),g.component=_;var b=_.QueryInterface("VCXIModifiable");g.type=b.GetProperty("Actor.IsMilestone").GetPropertyValue().GetValue()?"milestone":"marker",g.frame=b.GetProperty("Actor.TimePos").GetPropertyValue().GetValue(),p.push(g)}}}this._vcxTimelineCtrl.addMarkers(p),this._vcxTimelineCtrl.setIndexValue(t)}}},deleteTimeline:function(){if(this._vcxTimelineCtrl){this._vcxTimelineCtrl.unInitialize(),this._vcxTimelineCtrl=null;var e=this._experienceBase.getManager("VCXContextManager").getContext(),t=N.getCommandCheckHeader("VCXAutoKeyCmd",e);if(t)this._experienceBase.getManager("VCXContextManager").getPlayerMode()||t.setState(!0);var n=N.getCommandCheckHeader("VCXCameraPlayModeCmd",e);n&&n.setState(!0)}},GoToScenarioContext:function(){this._experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario();return!this._isPlayingGoTo},SetIsPlaying:function(){this._isPlayingGoTo=1},UnSetIsPlaying:function(){this._isPlayingGoTo=0},SetPropertiesPanelVisibility:function(e){this._vcxPropertiesCtrl._mainPanel.style.display=e?"":"none"},SetDocManagerPanelVisibility:function(e){e?(this._vcxDocManagerCtrl._mainPanel.style.display="",this._vcxDocManagerCtrl.onRedraw()):this._vcxDocManagerCtrl._mainPanel.style.display="none"},SetLinkedPropPanelVisibility:function(e){e?(this._vcxLinkedPropCtrl._mainPanel.style.display="",this._vcxLinkedPropCtrl.onRedraw()):this._vcxLinkedPropCtrl._mainPanel.style.display="none"},AddDropZone:function(){this._vcxGettingStartedUI&&this._vcxGettingStartedUI.dropZoneON()},RemoveDropZone:function(){this._vcxGettingStartedUI&&this._vcxGettingStartedUI.dropZoneOFF()},GetCanvasView:function(){let e=this._experienceBase.getManager("VCXContextManager"),t=e&&e.getMainViewer();return t&&t.div},SetCursor:function(e){var t=this.GetCanvasView();t&&t.setStyle("cursor",e)},GetCursor:function(){var e=this.GetCanvasView();if(e)return e.style.cursor;console.log("viewer.div not found !!")},GetActiveSequenceId:function(){return this._vcxScenarioCtrl?this._vcxScenarioCtrl.GetActiveSequenceId():this._vcxSceneCtrl?this._vcxSceneCtrl.GetActiveSequenceId():null},getGUIServices:function(){return F},getGettingStartedUI:function(){return this.landingPage?this.landingPage:W},getGettingStartedNode:function(){if(this._vcxGettingStartedUI)return this._vcxGettingStartedUI.getHomeNode()},SetVisibilityPlay:function(e){this._vcxPlayCtrl&&this._vcxPlayCtrl.setVisibility(e)},createTabPageFrame:function(e){return new V(e)},addDivUpdateView:function(){H.addDiv()},displaySceneNeedsUpdateModal:function(e){let n="",i=J["SceneUpdate.DontUpdate"];switch(e){case"close":n=J["SceneUpdate.close"];break;case"publish":n=J["SceneUpdate.publish"],i=J["SceneUpdate.Cancel"];break;case"save":n=J["SceneUpdate.save"]}return new UWA.Promise((e,a)=>{if(!this._sceneNeedsUpdate)return e(!0);var r=new G({label:J["SceneUpdate.Update"],onClick:n=>{var i=n.dsModel,a=i.dialog;N.getCommand("VCXAddCameraKeyCmd",this._experienceBase.getManager("VCXContextManager").getContext())&&N.getCommand("VCXAddCameraKeyCmd",this._experienceBase.getManager("VCXContextManager").getContext()).begin();var r=new B;r.on(),k.createModal(i.dialog.elements.container,r.elements.container);let o=t.subscribe({event:"VCX_SCENARIO_REPLACED"},n=>{this._vcxScenarioCtrl&&this._vcxScenarioCtrl.hideNeedForUpdate&&this._vcxScenarioCtrl.hideNeedForUpdate(),k.removeModal(i.dialog.elements.container),t.unsubscribe(o),a.close(),e(!0)})}}),o=new G({label:i,onClick:t=>{t.dsModel.dialog.close(),e(!1)}});new E({immersiveFrame:document.querySelector(this._parentDivName),modalFlag:!0,closeButtonFlag:!1,touchMode:!0,resizableFlag:!1,movableFlag:!1,icon:"camera-refresh",title:J["SceneUpdate.title"],content:UWA.Element("div",{class:"vcx-updateScene-modal",html:n}),buttons:{Open:r,Close:o}});this._experienceBase.odt&&r.fire("buttonclick",{ctrlKey:!1,shiftKey:!1,altKey:!1})})},changeFormatPainterUIVisibility:function(e){this._vcxPropertiesCtrl&&this._vcxPropertiesCtrl.changeFormatPainterUIVisibility(e)},GetDocIDFromImageLoadQuery:function(){return new q(this._experienceBase).GetDocIDFromImageLoadQuery()},displayFakePropertiesForODT:function(){if(this._vcxPropertiesCtrl.displayFakePropertiesForODT)return this._vcxPropertiesCtrl.displayFakePropertiesForODT()},DisplayModalPanelInit:async function(e,t,n){if((this._experienceBase.getManager("VCXContextManager").IsLocalMode()||this._experienceBase.odt)&&!localStorage.getItem("VCX_Enable_DisplayModal"))return{};let i="";return i=t&&"3dxml"===t.type?await Z.Import3dxmlModal(this._experienceBase,e,t,n):await Z.createNewExperienceModal(this._experienceBase,e,t),this.getGettingStartedUI().removeCurtainFade(),i},displayOpenOrPlayExperience:function(e){return Z.displayOpenOrPlayExperience(e,this._experienceBase)},createSaveBeforeCloseModal:function(){return Z.createSaveBeforeCloseModal(this._experienceBase)},showSelectionSetChoosePanel:function(){return Y.showChoosePanel(this._experienceBase.getManager("VCXContextManager").getFrameWindow())},showSelectionSetRenamePanel:function(e){return Y.showRenamePanel(this._experienceBase.getManager("VCXContextManager").getFrameWindow(),e)},saveToMRU:async function(e){if(widget){let t,n=e;e||(n=await this._experienceBase.getManager("VCXCAT3DXModelManager").GetCAT3DXModel().GetExperiencePhysicalID());let i={};if(widget.getValue("MRUData")){let e=(t=(i=JSON.parse(widget.getValue("MRUData"))).arrayRecentExperiences).indexOf(n);if(-1===e){if(3===t.length){delete i[t.pop()]}t.unshift(n),i[n]=new Date}else t.splice(e,1),t.unshift(n),i[n]=new Date}else t=[n],i.arrayRecentExperiences=t,i[n]=new Date;widget.setValue("MRUData",JSON.stringify(i))}}});return Object.defineProperty($.prototype,"componentType",{enumerable:!0,get:function(){return"VCXGUIManager"}}),$});var VCXThumbnailDisplayModeEnum={List:0,Small:1,Large:2,Tile:3};define("DS/VCXWebGUI/VCXScenarioCtrlExt",["UWA/Class","DS/CoreEvents/Events","DS/Core/PointerEvents","DS/VCXWebGUI/VCXUISequence","DS/VCXKeyFramer/VCXScenario","DS/VisuEvents/EventsManager","DS/Controls/ThumbnailView","DS/WebappsUtils/WebappsUtils","DS/VCXGUIInfrastructure/VCXTabPageFrame","DS/Layouts/GridEngine","DS/ApplicationFrame/CommandsManager","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebKernelCommands/VCXCmdGoToScenarioWithInterpolation","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebVisualization/VCXPublishRasterImage","DS/VCXWebIO/VCXFileServices","DS/VCXWebKernelCommands/VCXCmdChangeScenarioSequence","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","i18n!DS/VCXWebProducts/assets/nls/VCXWebProducts","i18n!DS/VCXWebGUICommands/assets/nls/VCXWebGUICommands","i18n!DS/VCXWebProducts/assets/nls/VCXWebProductAuthoringCommands"],function(e,t,n,i,a,r,o,s,l,c,d,u,p,h,m,g,C,v,_,b,f){"use strict";return e.extend({onresizePanel:function(e,t){var n,i,a=0,r=0;for(n in e._thumbnailsList){var o=e._thumbnailsList[n];o.length>r&&(r=o.length)}if(r>0){var s=e.getItemDisplaySize()[0]+10;a=(i=Math.floor(t/s))*s}if(r>=i)for(var l in e._sequenceContent){var c=e._sequenceContent[l];c&&(c.style.width=a+"px")}e.updateToolbar()},getItemDisplaySize:function(){var e=this.getThumbnailDisplaySize(),t=e[0],n=e[1];switch(this._displayMode){case VCXThumbnailDisplayModeEnum.List:return[t,50];case VCXThumbnailDisplayModeEnum.Small:return[t,n];case VCXThumbnailDisplayModeEnum.Large:return[1.5*t,1.5*n];case VCXThumbnailDisplayModeEnum.Tile:return[1.4*t+10,n]}},getThumbnailDisplaySize:function(){return[165,118]},init:function(e,n,a){var r=this;this.playerMode=Boolean(a),this._displayMode=VCXThumbnailDisplayModeEnum.Small,this._vcxGuiManager=e,this._sequenceContent={},this._thumbnailsList=[],this.options={_experienceBase:this._vcxGuiManager._experienceBase,_uiLayer:this._vcxGuiManager._uiLayer,classBaseNameCSS:"vcx-scenarios-",sidePanel:{title:"Scenarios",icon:{iconName:"camera",fontIconFamily:WUXManagedFontIcons.Font3DS},side:"left",minWidth:300,styles:{height:"100%"},controller:this,usecallback:this.onresizePanel,currentDockArea:4},onResizeCb:this.onResize,slidingViews:{displayTabAtStart:1,activateViewOn:1,_vcxuiSequencesMaster:{},views:[]},recId:"scenarioCtrlRec"},this._vcxGuiManager.immersiveFrame&&(this.options.immersiveFrame=this._vcxGuiManager.immersiveFrame);for(var o=1,s=0;s<n.length;++s)this.options.slidingViews._vcxuiSequencesMaster[o]={},this.options.slidingViews._vcxuiSequencesMaster[o][n[s]]=new i(this._vcxGuiManager._experienceBase,this),++o,this.options.slidingViews.views.push({title:n[s],content:{html:r.options.slidingViews._vcxuiSequencesMaster[s+1][n[s]],iframe:!1}});this.options.recId="scenarioCtrlRec";v["VCXScenarios.PanelTitle"],this._vcxGuiManager.immersiveFrame,WUXDockAreaEnum.RightDockArea;this._tabPageFrame=new l(this.options),this._tabPageFrame._header.addClassName("vcxNoMenu"),this.onCreateToolBarButtons(this.getFrame().getPanel()),this.updateToolbar(),this._bSelectionMode=!1,this._updateSceneSymbol=new UWA.Element("div",{class:"wux-ui-3ds fonticon-refresh vcx-updateScene-symbol",html:[]}),this.currentViewpoint={angle:-1,eyePos:null,sightDir:null},this._activeSequence=null,this._currentScenarioId=null,this.options.immersiveFrame?(this.getFrame().getPanel().style.minHeight="100%",this.getFrame().getPanel().style.minWidth="300px"):(this.getFrame().getPanel().elements.content.style.minHeight="100%",this.getFrame().getPanel().elements.panel.style.minWidth="300px"),this.activateDisplayStyle("Small");var c=r._vcxGuiManager._experienceBase;c.getManager("VCXSequenceManager");this.onResizeCB=(()=>{var e=c.getManager("VCXScenarioManager").GetScenarios()[r._currentScenarioId];this.ChangeTimelinePosition(e,r._currentScenarioId),this.onResize()}),window.attachEvent?this._tokenResize=window.attachEvent("onresize",this.onResizeCB):window.addEventListener&&(this._tokenResize=window.addEventListener("resize",this.onResizeCB,!0)),this._tokenCreateThumb=t.subscribe({event:"VCX_CREATE_THUMBNAIL"},function(e){r.onCreateThumbnail(r,e)}),this._tokenScChanged=t.subscribe({event:"VCX_SCENARIO_CHANGED"},function(e){r.onScenarioChanged(r,e)}),this._tokenScMoved=t.subscribe({event:"VCX_SCENARIO_MOVED"},function(e){r.onScenarioMoved(r,e)}),this._tokenCurrentScenario=t.subscribe({event:"VCX_CURRENT_SCENARIO_CHANGED"},function(e){r.onCurrentScenarioChanged(e.GetID(),e)}),this._tokenBeginTrans=t.subscribe({event:"VCX_BEGIN_TRANSITION"},function(e){document.body.addClassName("waiting"),r.onCurrentScenarioChanged(e.scenario._ID,e.scenario),r.hideNeedForUpdate(),r.stopListeningToViewpointChange(),r.onBeginEndTransition(r,e)}),this._tokenBeginEndTrans=t.subscribe({event:"VCX_END_TRANSITION"},function(e){var t={};t.maxframe="number"==typeof e&&e||0,r.onBeginEndTransition(r,t),document.body.removeClassName("waiting")}),this._tokenSeqNameChanged=t.subscribe({event:"VCX_SEQUENCE_NAME_CHANGED"},function(e){r.onSequenceNameRefresh(r,e)}),this._tokenScenarioNameChanged=t.subscribe({event:"VCX_SCENARIO_NAME_CHANGED"},function(e){r.onScenarioNameRefresh(r,e)}),this._tokenScenarioReplaced=t.subscribe({event:"VCX_SCENARIO_REPLACED"},function(e){r.onScenarioReplaced(e.GetID(),e)}),this._tokenSeqChanged=t.subscribe({event:"VCX_SEQUENCE_CHANGED"},function(e){r.onSequenceChanged(r,e)}),this._tokenRefreshIcon=t.subscribe({event:"VCX_REFRESH_ICON"},function(e){r.RefreshAnimIcon(r,e)})},unInitialize:function(){for(var e in window.focus(),this._sequenceContent){(n=this._sequenceContent[e]).cbonPrimaryPointerUpUnique&&r.removeEventFromToken(n.cbonPrimaryPointerUpUnique),n.removeEvent("dragend"),n.removeEvent("dragover"),n.grid&&n.grid.onCellRequest(null)}for(var e in this._thumbnailsList)for(var n=this._thumbnailsList[e],i=0;i<n.length;i++){var a=n[i];a._pointerDownToken&&(r.removeEventFromToken(a._pointerDownToken),a._pointerDownToken=null),a._pointerUpToken&&(r.removeEventFromToken(a._pointerUpToken),a._pointerUpToken=null),a.cbdragstart&&(a.elements.picture.removeEventListener("dragstart",a.cbdragstart),a.cbdragstart=null),a.cbdragenter&&(a.elements.picture.removeEventListener("dragenter",a.cbdragenter),a.cbdragenter=null),a.cbdragend&&(a.elements.picture.removeEventListener("dragend",a.cbdragend),a.cbdragend=null),a.cbdragover&&(a.elements.picture.removeEventListener("dragover",a.cbdragover),a.cbdragover=null),a.cbCheckBoxChange&&(a.elements.checkbox.removeEventListener("change",a.cbCheckBoxChange),a.cbCheckBoxChange=null),a.cbEditScenario&&(a.elements.container.removeEventListener("keydown",a.cbEditScenario,!0),a.elements.picture.removeEventListener("keydown",a.cbEditScenario,!0),a.cbEditScenario=null),a.cbOnClickScenario&&(a.elements.container.removeEventListener("click",a.cbOnClickScenario),a.elements.title.removeEventListener("click",a.cbOnClickScenario),a.cbOnClickScenario=null)}this._sequenceContent=[],this._thumbnailsList=[],t.unsubscribe(this._tokenCreateThumb),delete this._tokenCreateThumb,t.unsubscribe(this._tokenScChanged),delete this._tokenScChanged,t.unsubscribe(this._tokenScMoved),delete this._tokenScMoved,t.unsubscribe(this._tokenCurrentScenario),delete this._tokenCurrentScenario,t.unsubscribe(this._tokenScenarioReplaced),delete this._tokenScenarioReplaced,t.unsubscribe(this._tokenBeginTrans),delete this._tokenBeginTrans,t.unsubscribe(this._tokenBeginEndTrans),delete this._tokenBeginEndTrans,t.unsubscribe(this._tokenSeqNameChanged),delete this._tokenSeqNameChanged,t.unsubscribe(this._tokenScenarioNameChanged),delete this._tokenScenarioNameChanged,t.unsubscribe(this._tokenSeqChanged),delete this._tokenSeqChanged,t.unsubscribe(this._tokenRefreshIcon),delete this._tokenRefreshIcon,this.stopListeningToViewpointChange(),this._viewpointWatcher=null,this._vcxGuiManager._vcxTimeline&&(this.getFrame().getFooter().removeChild(this._vcxGuiManager._vcxTimeline.getView().getContainer()),this._vcxGuiManager._vcxTimeline.unInitialize(),this._vcxGuiManager.RemoveTimelineEvents(),this._vcxGuiManager._vcxTimeline=null),this._scenePanelView&&this._scenePanelView.unInitialize(),this._vcxGuiManager._vcxTimelineMain&&(this._vcxGuiManager._vcxTimelineMain.unInitialize(),this._vcxGuiManager._vcxTimelineMain=null),window.attachEvent?(window.detachEvent(this._tokenResize),delete this._tokenResize):window.addEventListener&&(window.removeEventListener("resize",this.onResizeCB,!0),delete this._tokenResize),this.onResizeCB=null,this.getFrame().unInitialize()},getFrame:function(){return this._tabPageFrame},updateToolbar:function(){this.getFrame().getToolbar().updateToolbar()},onCreateToolBarButtons:function(e){var t=this,n=this.getFrame().getToolbar(),i=(o=this._vcxGuiManager._experienceBase.getManager("VCXContextManager")).getProdHighMode(),a=o.getExperienceIn3DPlay();if(this.playerMode&&(a||i)&&n.addMainItemFixed("VCXPlayGuidedTourCmd","","vcxToolbarButtonIconChecked","VCXWebProducts/VCXWebProducts",_,null,null,"VCX_PLAY_GUIDED_TOUR_START","VCX_PLAY_GUIDED_TOUR_END",!0),!this.playerMode){var r=this._vcxGuiManager._experienceBase.getManager("VCXExperience");r.updateLogData&&!0===r.updateLogData.showDialog&&n.addMainItemFixed("VCXShowUpdateViewCmd","","vcxToolbarButton wux-ui-3ds-update","VCXWebAuthoringCommands/VCXWebAuthoringCommands",f);var o,s=o&&o.getContext(),l=(d.getCommand("VCXCreateEmptyScenarioCmd",s),[]);if(l[0]=this,l[1]=this.setVisibilityAllChexkBox,l[2]=!0,n.addMainItemFixed(l,"","vcxToolbarButton vcxToolbarButtonSelect","VCXWebGUICommands/VCXWebGUICommands",b,null,"VCXSetVisibilityAllChexkBoxCmd"),n.addMainItemFixed("VCXCreateEmptyScenarioCmd","","vcxToolbarButton fonticon-doc-add","VCXWebAuthoringCommands/VCXWebAuthoringCommands",f),n.addMainItemFixed("VCXAddCameraKeyCmd","","vcxToolbarButton fonticon-camera-refresh","VCXWebAuthoringCommands/VCXWebAuthoringCommands",f),n.addMainItemFixed("VCXCreateScenarioCmd","","vcxToolbarButton fonticon-plus","VCXWebAuthoringCommands/VCXWebAuthoringCommands",f),this._scenePanelView){var c=[];c[0]=this,c[1]=function(){this._scenePanelView&&this._scenePanelView.toggleVisibility()},c[2]=!0,n.addMainItemFixed(c,"","vcxToolbarButton vcxToolbarButtonDisplaySimplified","")}(o=this._vcxGuiManager._experienceBase.getManager("VCXContextManager")).isSupported("Timeline")&&!o.getPlayerMode()&&n.addMainItem("VCXDisplayTimelineCmd","","vcxToolbarButton vcxToolbarButtonTimeline","VCXWebAuthoringAppGUICommands/VCXWebAuthoringAppGUICommands","i18n!DS/VCXWebAuthoringAppGUICommands/assets/nls/VCXWebAuthoringAppGUICommands"),n.addMainItemFixed("VCXDeleteSceneSelectionCmd","","vcxToolbarButton vcxToolbarButtonDelete","VCXWebAuthoringCommands/VCXWebAuthoringCommands",f,n.getEditToolbar()),n.addMainItemFixed("VCXReplaceScenarioCmd","","vcxToolbarButton vcxToolbarButtonUpdate","VCXWebAuthoringCommands/VCXWebAuthoringCommands",f,n.getEditToolbar()),n.addMainItemFixed("VCXApplyToSelectedCmd","","vcxToolbarButton wux-ui-3ds-propagate","VCXWebAuthoringCommands/VCXWebAuthoringCommands",f,n.getEditToolbar())}var u=function(e){t.activateDisplayStyle(e)};n.addSubItemFixed(u,"ScenarioViewOptions","vcxToolbarButton vcxToolbarButtonDisplayList","","",v["VCXScenario.Display.List"],"List"),n.addSubItemFixed(u,"ScenarioViewOptions","vcxToolbarButton vcxToolbarButtonDisplaySmall","","",v["VCXScenario.Display.Small"],"Small"),n.addSubItemFixed(u,"ScenarioViewOptions","vcxToolbarButton vcxToolbarButtonDisplayLarge","","",v["VCXScenario.Display.Large"],"Large"),n.addSubItemFixed(u,"ScenarioViewOptions","vcxToolbarButton vcxToolbarButtonDisplayTile","","",v["VCXScenario.Display.Tile"],"Tile"),n.addMenu("","vcxToolbarButtonStarterMenuRight","vcxToolbarButton vcxToolbarButtonLayout","VCXWebGUI/VCXWebGUI",v,"VCXScenarioToolbarDisplayLayout");var p=[];p[0]=this,p[1]=this.setVisibilityAllChexkBox,p[2]=!1,n.addMenu(p,"vcxToolbarButtonStarterMenuRight vcxToolbarButtonStarterMenuRightEdit","vcxToolbarButton vcxToolbarButtonExit","VCXWebGUI/VCXWebGUI",v,"VCXScenarioToolbarExit",n.getEditToolbar()),n.activeSubItemFixed("vcxToolbarButton vcxToolbarButtonDisplaySmall")},activateDisplayStyle:function(e){switch(this.getFrame().getToolbar().activeSubItemFixed("vcxToolbarButton vcxToolbarButtonDisplay"+e),this.getFrame().getPanel().removeClassName("vcx-displaySmall"),this.getFrame().getPanel().removeClassName("vcx-displayTile"),this.getFrame().getPanel().removeClassName("vcx-displayList"),this.getFrame().getPanel().removeClassName("vcx-displayLarge"),this.getFrame().getPanel().addClassName("vcx-display"+e),e){case"Tile":this._displayMode=VCXThumbnailDisplayModeEnum.Tile;break;case"List":this._displayMode=VCXThumbnailDisplayModeEnum.List;break;case"Large":this._displayMode=VCXThumbnailDisplayModeEnum.Large;break;case"Small":this._displayMode=VCXThumbnailDisplayModeEnum.Small}this.onResize()},loadScenariosFromExperience:function(){var e=this._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetListSequences();this.addSequences(this,e)},addSequences:function(e,t){for(var n=0;n<t.length;n++){var i=t[n],a=n-1;e.createSequence(i,a,e),e._scenePanelView&&e._scenePanelView.createSequenceView(i.GetID(),i.GetName(),s.getWebappsAssetUrl("VCXWebGUI","css/img/VCXSequence.png"))}},getUISequenceTarget:function(e){for(var t in this.options.slidingViews._vcxuiSequencesMaster)for(var n in this.options.slidingViews._vcxuiSequencesMaster[t]){if(e===n)return this.options.slidingViews._vcxuiSequencesMaster[t][n];var i=n.split("|");for(var a in i)if(e===i[a])return this.options.slidingViews._vcxuiSequencesMaster[t][n]}return this.options.slidingViews._vcxuiSequencesMaster[1][Object.keys(this.options.slidingViews._vcxuiSequencesMaster[1])[0]]},getUISequenceIndex:function(e,t){var n=0;for(n in e.elements.items){if(e.elements.items[n].childNodes[0].childNodes[1].innerHTML===t)break}return n},createSequence:function(e,t,n){var i=e.GetID(),a=e.GetName();"CAD Captures"!==a&&"CAD Views"!==a||n._tabPageFrame._header.removeClassName("vcxNoMenu");var o=t+1,s=this.getUISequenceTarget(a);0===o&&(o=s.itemLength),s.addItem(o,{text:a});var l=n._sequenceContent[i]=new UWA.Element("div",{class:"VCX container-fluid hidden-print vcx-fluid-content",html:[]});l.sequenceIndex=o,s.setContent(o,l),l.addEvent("dragover",function(e){if(1!==e.dataTransfer.types.length&&e.dataTransfer.types.includes("text/plain"))e.dataTransfer.dropEffect="none";else if(e.target.hasClassName("VCX container-fluid")){var t="";t=n.amIBefore(n.dragged.elements.container,n.dropTarget)?"afterend":"beforeBegin",n.dropTarget&&n.isThereBrotherAround(e)||(n.dropSequence=n.getSequenceDrop(e),n.dropTarget=n.getLastThumnbailFromSequence(n.dropSequence),t="afterend"),n.dropTarget.elements.container.insertAdjacentElement(t,n.dragged.elements.container),e.preventDefault()}}),l.addEvent("dragend",function(e){var t=n._vcxGuiManager._experienceBase,i=t.getManager("VCXSequenceManager").GetSequenceFromScenarioId(n.dragged.scenarioID),a="";i&&(a=i.GetID());var r=-1;n.dropTarget&&(n.dropSequence=n.dropTarget.elements.container.parentNode.getAttribute("sequenceid"),r=Array.prototype.indexOf.call(n.dropTarget.elements.container.parentNode.children,n.dragged.elements.container)),n.moveScenarioView(n.dragged.scenarioID,a,n.dropSequence,r);var o=new C(t.getManager("VCXSequenceManager"),t.getManager("VCXCommandManager"),t.ComponentsMap);o.MoveScenario(n.dragged.scenarioID,n.dropSequence,r),t.getManager("VCXCommandManager").Push(o)});var d=s.elements.items[o];d.sequenceId=i;var u=d.getElementsByClassName("VCXUISequence-title")[0];d.counterThumbs=new UWA.Element("div",{html:"0",class:"VCXcounterThumbs",styles:{}}),d.counterThumbs.inject(u),1===s.itemLength?(s.elements.container.childNodes[0].childNodes[0].style.opacity="0",s.elements.container.childNodes[0].childNodes[0].style.marginBottom="-15px"):(s.elements.container.childNodes[0].childNodes[0].style.opacity="",s.elements.container.childNodes[0].childNodes[0].style.marginBottom=""),n.activeSequence(d),l.cbonPrimaryPointerUpUnique=r.addEvent(l.parentNode,"onPrimaryPointerUpUnique",function(){n.activeSequence(d)}),l.sequenceID=i,l.setAttribute("SequenceID",i);for(var p=n._vcxGuiManager._experienceBase.getManager("VCXScenarioManager").GetScenarios(),h=e.GetListScenariosId(),m=(n._thumbnailsList[i]=[],0);m<h.length;m++){var g=h[m];n.createScenarioView(p[g],n,e.GetID(),m)}this.setSequenceState(a,!0),l.grid=new c({model:n._thumbnailsList[i],defaultCellWidth:300,defaultCellHeight:200,showRowsHeader:!0,showColumnsHeader:!0,headersDimensions:{width:20,height:20}}),l.grid.onCellRequest(function(e,t){var n=e.virtualColumnID;if(t._thumbnailsList[n]){var i=t._thumbnailsList[n];e.cellView.getContent().setHTML(i)}})},createScenarioView:function(e,t,i,o){var l=t._vcxGuiManager._experienceBase;l.getManager("VCXSequenceManager");if(i);else{var c=l.getManager("VCXSequenceManager").GetListSequences();i=c[0].GetID()}var d=0;-1!==o&&(d=o);var u=this._thumbnailsList[i][d],p=!1;if(!u||u.scenarioID&&u.scenarioID!==e.GetID()){p||(u=t.createThumbnailView(e,t,i,o)),(t=this).playerMode?u.elements.thumbnail.draggable=!1:u.elements.thumbnail.draggable=!0,u.cbdragstart=function(e){if(!this.draggable)return e.preventDefault(),void e.stopPropagation();t.dropTarget=u,e.dataTransfer.setData("scene",e.target.id),e.dataTransfer.effectAllowed="move",t.dragged=u,t.dragged.elements.container.classList.add("vcxDrag")},u.elements.thumbnail.addEventListener("dragstart",u.cbdragstart,!1),u.cbdragenter=function(e){if(1!==e.dataTransfer.types.length&&e.dataTransfer.types.includes("text/plain"))e.dataTransfer.dropEffect="none";else if(t.dropTarget=u,e.preventDefault(),void 0===t.dragged&&(t.dragged=u),t.dragged.elements.picture!==e.toElement){var n="";n=t.amIBefore(t.dragged.elements.container,u.elements.container)?"afterend":"beforeBegin",u.elements.container.insertAdjacentElement(n,t.dragged.elements.container),t.dropTarget=u}},u.elements.thumbnail.addEventListener("dragenter",u.cbdragenter,!1),u.cbdragover=function(e){if(1!==e.dataTransfer.types.length&&e.dataTransfer.types.includes("text/plain"))e.dataTransfer.dropEffect="none";else{if(!this.draggable)return e.preventDefault(),void e.stopPropagation();e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault()}},u.elements.thumbnail.addEventListener("dragover",u.cbdragover,!1),u.cbdragend=function(e){t.dragged.elements.container.classList.remove("vcxDrag")},u.elements.thumbnail.addEventListener("dragend",u.cbdragend,!1),u.cbdrop=function(e){(e=e||event).preventDefault()},u.elements.thumbnail.addEventListener("drop",u.cbdrop,!1);var h=e.GetName();u.setTitle(h),u.scenarioID=e.GetID(),u.scenarioIndex=d,u.elements.thumbnail._scenarioID=e.GetID(),e.HasAnimation()&&(u.elements.title.style.left="30px !important",u.elements.subtitle.style.left=u.elements.title.style.left,u.elements.icon.addClassName("hasAnimation"));var m=this._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetSequenceFromId(i),g=null,C=e.GetDocId(),v=l.getManager("VCXDocManager").GetPropPath(C);if(v)g=v.GetValueURL().GetValue();if("Animation smg"===h)u.setPicture(s.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_Animation.png")),this._scenePanelView&&this._scenePanelView.updateScenario(e.GetID(),m.GetID(),h,s.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_Animation.png"),e.GetID()===t._currentScenarioId);else if(g){var _=new XMLHttpRequest;_.open("GET",g,!0),_.responseType="blob",_.onload=function(n){if(200==this.status){var i=this.response,a=new FileReader;a.onload=function(n){u.setPicture(n.target.result),t._scenePanelView&&t._scenePanelView.updateScenario(e.GetID(),m.GetID(),h,n.target.result,e.GetID()===t._currentScenarioId)},a.readAsDataURL(i)}},_.send()}else e.GetScenarioType()===a.EScenarioType.CADView?u.setPicture(s.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_CADViews.png")):e.GetScenarioType()===a.EScenarioType.CADCapture?u.setPicture(s.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_CADCaptures.png")):e.GetScenarioType()===a.EScenarioType.Layer?u.setPicture(s.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_Layer.png")):this.onScenarioReplaced(e.GetID(),e);var b=m.GetName(),f=this.getUISequenceTarget(b);if(this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getShowRoomMode());else{t.targetInteraction=null,u._pointerDownToken=r.addEvent(u.elements.container,"onPrimaryPointerDownUnique",function(e){f.elements.items[t._sequenceContent[i].sequenceIndex];u.elements.checkbox.elements.container.focus()}),u.cbEditScenario=function(n){"F2"===n.key&&(e.GetID()===t._currentScenarioId||u.elements.container.hasClassName("vcxItemSelected"))&&setTimeout(function(){console.log("F2"),u.elements.title.focus()},0)},u.cbOnClickScenario=function(a){var r=function(e){var i=a.path&&a.path[0]||a.currentTarget;i&&i.hasClassName("vcx-controls-thumbnail-title")||(t.endRenameScenario(),document.removeEventListener(n.POINTERDOWN,r),document.removeEventListener("keydown",o))},o=function(e){"Enter"===e.key?(t.endRenameScenario(),document.removeEventListener(n.POINTERDOWN,r),document.removeEventListener("keydown",o),u.elements.title.contentEditable=!0):"Escape"===e.key&&(t.endRenameScenario(!0),document.removeEventListener(n.POINTERDOWN,r),document.removeEventListener("keydown",o),u.elements.title.contentEditable=!0)};if(!(s=a.path&&a.path[0]||a.currentTarget).hasClassName("vcx-controls-thumbnail-title")||t.playerMode||t.getFrame().getToolbar().isEditMode()){""!==t.startEditScenarioID&&(t.endRenameScenario(),document.removeEventListener(n.POINTERDOWN,r),document.removeEventListener("keydown",o));var s=a.target;if(t.targetInteraction=s,!t.targetInteraction||t.targetInteraction!=s)return void(t.targetInteraction=null);if(a&&a.gesture&&a.gesture.currentEvent[0]&&a.gesture.currentEvent[0].currentPosition.distanceTo(a.gesture.currentEvent[0].startPosition)>8)return void(t.targetInteraction=null);if(s.hasClassName("wux-ui-fa")||s.hasClassName("vcx-controls-checkbox"))return t.targetInteraction=null,!1;t.targetInteraction=null,t.activeSequence(f.elements.items[t._sequenceContent[i].sequenceIndex]);var l=e.GetID();if(t.getFrame().getToolbar().isEditMode())u.elements.checkbox.toggle();else if(t._vcxGuiManager.GoToScenarioContext()){if(t.setVisibilityAllChexkBox(!1),t.onCurrentScenarioChanged(l,e),void 0!==t._vcxGuiManager._experienceBase.getManager("VCXContextManager").getUrlVars().DSWebRecord){require(["DS/WebRecordEnabler/Adapter"],function(e){e.TraceManager.debug("ADD document.waitConditionScenario"),document.waitConditionScenario=e.WaitManager.addWaitCondition(2e4,"Wait go to scenario"),t._vcxGuiManager._experienceBase.getManager("VCXAPIManager").GoToScenario(l,function(){e.TraceManager.debug("REMOVE document.waitConditionScenario"),e.WaitManager.removeWaitCondition(document.waitConditionScenario),document.waitConditionScenario=null})})}else t._vcxGuiManager._experienceBase.getManager("VCXAPIManager").GoToScenario(l);if(t._vcxGuiManager._vcxTimelineExtCtrl&&t._vcxGuiManager._vcxTimelineExtCtrl._mainPanel){var c=t._vcxGuiManager._vcxTimelineExtCtrl._mainPanel.style.display;t._vcxGuiManager._uiLayer.removeChild(t._vcxGuiManager._vcxTimelineExtCtrl._mainPanel),t._vcxGuiManager.InitTimelineExtCtrl(l),t._vcxGuiManager._vcxTimelineExtCtrl._mainPanel.style.display=c}}}else a.stopPropagation(),document.addEventListener(n.POINTERDOWN,r),document.addEventListener("keydown",o),t.startEditScenarioID=e.GetID()},this._vcxGuiManager.isTouchActivated()?(u.elements.container.addEventListener("touchstart",u.cbOnClickScenario),u.elements.title.addEventListener("touchstart",u.cbOnClickScenario)):(u.elements.container.addEventListener("click",u.cbOnClickScenario),u.elements.title.addEventListener("click",u.cbOnClickScenario)),u.elements.container.addEventListener("keydown",u.cbEditScenario,!0),u.elements.picture.addEventListener("keydown",u.cbEditScenario,!0);var S=f.elements.items[t._sequenceContent[i].sequenceIndex];S.counterThumbs.innerHTML=parseInt(S.counterThumbs.innerHTML)+1}}else p=!0},endRenameScenario:function(e){if(e)for(var t in this._thumbnailsList)for(var n=this._thumbnailsList[t],i=0;i<n.length;i++){if((r=n[i]).scenarioID===this.startEditScenarioID){var a=(s=(o=this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager").GetScenarios()[r.scenarioID].QueryInterface("VCXIModifiable")).GetProperty("Actor.Name")).GetPropertyValue().GetValue();return r.elements.title.innerHTML=a,void(this.startEditScenarioID="")}}else for(var t in this._thumbnailsList)for(n=this._thumbnailsList[t],i=0;i<n.length;i++){var r;if((r=n[i]).scenarioID===this.startEditScenarioID){var o,s,l=r.elements.title.innerHTML,c=new h(this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager"),this._vcxGuiManager._experienceBase.getManager("VCXCommandManager"));return(s=(o=this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager").GetScenarios()[r.scenarioID].QueryInterface("VCXIModifiable")).GetProperty("Actor.Name")).GetPropertyValue().SetValue(l),c.ChangeProperty(o,s),this._vcxGuiManager._experienceBase.getManager("VCXCommandManager").Push(c),void(this.startEditScenarioID="")}}},isThereBrotherAround:function(e){var t=[{x:20,y:20},{x:20,y:-20},{x:-20,y:-20},{x:-20,y:20}],n=e.clientX,i=e.clientY,a=null;for(var r in t){var o=t[r];if(n+=o.x,i+=o.y,(a=document.elementsFromPoint(n,i)[0])&&(a.hasClassName("vcx-controls-thumbnail-picture")||a.hasClassName("vcx-controls-thumbnail-title")))return this.getThumbnailFromDiv(a)}return null},getSequenceDrop:function(e){for(var t in this._sequenceContent)if(this._sequenceContent[t]===e.target)return t},getLastThumnbailFromSequence:function(e){var t=this._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetSequenceFromId(e).GetListScenariosId().slice(-1)[0];for(var n in this._thumbnailsList)for(var i=this._thumbnailsList[n],a=0;a<i.length;a++){var r=i[a];if(r.scenarioID===t)return r}return null},getThumbnailFromDiv:function(e){for(var t in this._thumbnailsList)for(var n=this._thumbnailsList[t],i=0;i<n.length;i++){var a=n[i];if(a.elements.picture===e||a.elements.title===e)return a}return null},amIBefore:function(e,t){for(var n=t.previousElementSibling;n;){if(n===e)return!0;n=n.previousElementSibling}return!1},RefreshAnimIcon:function(e,t){var n=e._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(t.GetID()),i=n.GetIndexOfScenario(t.GetID()),a=e._thumbnailsList[n.GetID()][i];t.HasAnimation()&&(a.elements.title.style.left="30px !important",a.elements.subtitle.style.left=a.elements.title.style.left,a.elements.icon.addClassName("hasAnimation"))},RefreshTimeline:function(e,t){if(this.playerMode||this._vcxGuiManager._experienceBase.odt||this._vcxGuiManager._experienceBase.getManager("VCXContextManager").isSupported("Timeline")){var n=document.getElementsByClassName("wux-windows-docking-element-collapser wux-docking-element-left")[0].clientHeight-54-2;if(this._vcxGuiManager.deleteTimeline(),e&&e.HasAnimation()){this.getFrame().getContent().style.maxHeight=n-61+"px",this.getFrame().getFooter().style.height="50px",this.getFrame().getFooter().style.visibility="visible";var i=this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager").GetCurrentFrame();if(this._vcxGuiManager.InitTimelineCtrl(t,i),this._vcxGuiManager._vcxTimelineCtrl._timelines&&this._vcxGuiManager._vcxTimelineCtrl._timelines[1]){var a=this._vcxGuiManager._vcxTimelineCtrl._timelines[1].timeline.getView().getParentPanel().currentDockArea;this._vcxGuiManager._vcxTimelineCtrl.options.frmWindow.getImmersiveFrame().getDockingElement(a).collapseDockingZoneFlag=!1}this._vcxGuiManager._forceDisplayTimeline=!0}else this.getFrame().getContent().style.maxHeight=n+"px",this.getFrame().getFooter().style.height="0px",this.getFrame().getFooter().style.visibility="hidden"}},ChangeTimelinePosition:function(e,t){var n=document.getElementsByClassName("wux-windows-docking-element-collapser wux-docking-element-left")[0].clientHeight-54-2;if(e&&e.HasAnimation()){var i=this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager").GetCurrentFrame();null===this._vcxGuiManager._vcxTimelineCtrl&&this._vcxGuiManager.InitTimelineCtrl(t,i),this.getFrame().getContent().style.maxHeight=n-61+"px",this.getFrame().getFooter().style.height="50px",this.getFrame().getFooter().style.visibility="visible"}else this.getFrame().getContent().style.maxHeight=n+"px",this.getFrame().getFooter().style.height="0px",this.getFrame().getFooter().style.visibility="hidden"},onCreateThumbnail:function(e,t){var n=e._vcxGuiManager._experienceBase,i=t.scenario,a=t.sequenceId,r=parseInt(t.prevIndex),o=e._thumbnailsList[a],l=o[r+1];e.createThumbnailView(i,e,a,r,l),l=o[r+1],i._name&&"Animation smg"===i._name?l.setPicture(s.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_Animation.png")):e.capturePixels().then(function(e){var t=g.dataURLToBlob(e),a=window.URL.createObjectURL(t);if(l){l.setPicture(e);var r=a,o=n.getManager("VCXDocManager").BuildPathFromString(r),s=n.getManager("VCXDocManager").AddOrModifyDoc(o),c=i.QueryInterface("VCXIModifiable");i.SetDocId(s._value),n.getManager("VCXScenarioManager").AddNeutrals(c,c.GetProperties())}})},GetActiveSequenceId:function(){return this._activeSequence?this._activeSequence.sequenceId:null},activeSequence:function(e){e!==this._activeSequence&&(this._activeSequence&&this._activeSequence.removeClassName("vcxActiveSequence"),this._activeSequence=e,this._activeSequence.addClassName("vcxActiveSequence"))},setSequenceState:function(e,t){var n=this.getUISequenceTarget(e);if(n){var i=this.getUISequenceIndex(n,e);i&&n.setSequenceItemOpenedState(i,t)}},setDescription:function(e,t){var n=this._vcxGuiManager._experienceBase;let i=n.getManager("VCXSequenceManager").GetSequenceFromScenarioId(e).GetID();n.getManager("VCXSequenceManager").GetSequenceFromId(i).GetName();var a=this._thumbnailsList[i];for(var r in a){if(a[r].scenarioID===e){var o=a[r];o.elements.container.removeClassName("vcx-no-description"),o.elements.subtitle.innerHTML=t;break}}},editDescription:function(e){},createThumbnailView:function(e,t,n,i,a){if(t._activeSequence){var r=t._activeSequence;t.activeSequence(r)}var s=a;if(s);else{(s=new o({size:"small"}).inject(t._sequenceContent[n])).elements.transition=new UWA.Element("div",{html:"",class:"vcxTransition"}).inject(s.elements.container),s.elements.transitionBack=new UWA.Element("div",{html:"",class:"vcxTransitionBack"}).inject(s.elements.container),s.elements.container.id=e.GetID(),s.elements.container.setAttribute("data-rec-id",e.GetID()),s.elements.container.addClassName("vcx-controls-thumbnail"),s.elements.container.getCheckpointData=this.getThumbnailDataForRecord,t._vcxGuiManager._experienceBase.getManager("VCXContextManager").isSupported("PaperControlV2")&&s.elements.container.addClassName("vcx-ratio-compliant"),s.elements.picture.setAttribute("data-rec-id",e.GetID()+"-picture"),s.elements.picture.addClassName("vcx-controls-thumbnail-picture"),s.elements.cartouche.setAttribute("data-rec-id",e.GetID()+"-cartouche"),s.elements.cartouche.addClassName("vcx-controls-thumbnail-cartouche"),s.elements.cartouche.getChildren()[0].setAttribute("data-rec-id",e.GetID()+"-cartouche-content"),s.elements.title.setAttribute("data-rec-id",e.GetID()+"-title"),s.elements.title.addClassName("vcx-controls-thumbnail-title"),s.elements.subtitle.setAttribute("data-rec-id",e.GetID()+"-subtitle"),s.elements.subtitle.addClassName("vcx-controls-thumbnail-subtitle"),s.elements.subtitle.innerHTML="",s.elements.container.addClassName("vcx-no-description"),s.elements.icon.addClassName("vcx-controls-thumbnail-icon"),s.elements.picture.childNodes[0].addClassName("vcx-controls-checkbox");var l=0;-1!==i&&(l=i,t.insertIndex(s.elements.thumbnail,l)),t._thumbnailsList[n].splice(l,0,s),s.elements.menu.innerHTML="",s.elements.menu.addClassName("vcx-controls-thumbnail-menu");var c=t._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetSequenceFromId(n).GetName(),d=this.getUISequenceTarget(c);t.playerMode&&(s.elements.checkbox.elements.container.style.display="none"),s.cbCheckBoxChange=function(i){if(!t.playerMode){t.activeSequence(d.elements.items[t._sequenceContent[n].sequenceIndex]);var a=i.dsModel.checkFlag;a?(t.setVisibilityAllChexkBox(!0),s.elements.container.addClassName("vcxItemSelected")):(s.elements.container.removeClassName("vcxItemSelected"),t.getFrame().getToolbar().activateEditMode());var r=new u(t._vcxGuiManager._experienceBase.getManager("VCXSelectionManager"));a?r.AddToSelection(e):r.RemoveFromSelection(e),t._vcxGuiManager._experienceBase.getManager("VCXCommandManager").Do(r)}},s.elements.checkbox.addEventListener("change",s.cbCheckBoxChange)}return t.options.immersiveFrame?t.onresizePanel(t,Math.max(parseInt(t.getFrame().getPanel().style.minWidth),parseInt(t.getFrame().getPanel().offsetWidth))):t.onresizePanel(t,Math.max(parseInt(t.getFrame().getPanel().elements.panel.style.minWidth),parseInt(t.getFrame().getPanel().elements.panel.offsetWidth))),s},getThumbnailDataForRecord:function(e){var t={};t.value=this.getAttributeNames(),e(t,!0)},onResize:function(e){var t=e||this;t.getFrame()._panelMaster.elements.container.parentNode&&t.onresizePanel(t,Math.max(parseInt(0),parseInt(t.getFrame()._panelMaster.elements.container.parentNode.offsetWidth)))},index:function(e){for(var t=e.parentNode.childNodes,n=0;n<t.length;n++){if(t[n]===e)return n}return 0},insertIndex:function(e,t){var n=e.parentNode.childNodes[t];return this.index(e)>t?e.parentNode.insertBefore(e,n):e.parentNode.insertBefore(e,n.nextSibling),e},checkAllCheckBox:function(){for(var e in this._thumbnailsList)for(var t=this._thumbnailsList[e],n=0;n<t.length;n++){if(t[n].elements.checkbox.checkFlag)return!0}return!1},setVisibilityAllChexkBox:function(e){var t=this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();this.setThumbnailCheckBox(e,t)},getNbItems:function(){var e=0;for(var t in this._thumbnailsList){e+=this._thumbnailsList[t].length}return e},getNbSelectedItems:function(){var e=0;for(var t in this._thumbnailsList)for(var n=this._thumbnailsList[t],i=0;i<n.length;i++){n[i].elements.checkbox.checkFlag&&e++}return e},setThumbnailCheckBox:function(e,t){var n,i,a,r=this._activeSequence;for(var o in e?(n="VCXCheckBoxOn",i="VCXCheckBoxOff",a=!1):(n="VCXCheckBoxOff",i="VCXCheckBoxOn",a=!0),this._thumbnailsList)for(var s=this._thumbnailsList[o],l=0;l<s.length;l++){var c=s[l];c.elements.container.hasClassName(n)||(c.elements.container.removeClassName(i),c.elements.container.addClassName(n),c.elements.title.contentEditable=!!a,c===t||e||(c.elements.checkbox.checkFlag=!1,c.elements.container.removeClassName("vcxItemSelected")))}e?this.getFrame().getToolbar().activateEditMode():(this.getFrame().getToolbar().exitEditMode(),this.activeSequence(r))},onScenarioMoved:function(e,t){e.moveScenarioView(t.scenarioToAdd.GetID(),t.sequenceIdForRemove,t.sequenceIdForAdd,t.scenarioAddIdx)},onScenarioChanged:function(e,t){var n=e._vcxGuiManager._experienceBase;if(t.scenarioToAdd){var i=n.getManager("VCXSequenceManager").GetSequenceFromId(t.sequenceIdForAdd),a=i.GetIndexOfScenario(t.scenarioToAdd.GetID());e.createScenarioView(t.scenarioToAdd,e,t.sequenceIdForAdd,a);var r=n.getManager("VCXSequenceManager").GetIndexOfSequence(i),o=i.GetName(),s=e.getUISequenceTarget(o);if(!s.isSequenceOpened(r)){var l=e.getUISequenceIndex(s,o);s.sequenceOpenedItem(l)}if(t.bLinked&&e._selectedScenarioIds)for(var c=n.getManager("VCXScenarioManager").GetScenarios(),d=0;d<e._selectedScenarioIds.length;d++){var p=c[e._selectedScenarioIds[d]];if(p){var h=new u(n.getManager("VCXSelectionManager"));h.RemoveFromSelection(p),n.getManager("VCXCommandManager").Do(h)}}}else if(t.scenarioToRemove){e.removeScenarioView(t.scenarioToRemove.GetID(),t.sequenceIdForRemove);var m=n.getManager("VCXSequenceManager").GetSequenceFromId(t.sequenceIdForRemove);if(!n.getManager("VCXCommandManager")._isUnDoRunning&&!t.bLinked){var g=new u(n.getManager("VCXSelectionManager")),C=m.FindScenario(t.scenarioRemovedIdx);C&&g.SetSelection(C),n.getManager("VCXCommandManager").Do(g)}}},removeScenarioView:function(e,t){var n=this._vcxGuiManager._experienceBase.getManager("VCXSequenceManager");t||(t=n.GetSequenceFromScenarioId(e).GetID());var i=n.GetSequenceFromId(t).GetName(),a=this.getUISequenceTarget(i),r=this._thumbnailsList[t];for(var o in r){if(r[o].scenarioID===e){var s=r[o];this._sequenceContent[t].removeChild(s.elements.thumbnail),this._thumbnailsList[t].splice(o,1);var l=a.elements.items[this._sequenceContent[t].sequenceIndex];l.counterThumbs.innerHTML=parseInt(l.counterThumbs.innerHTML)-1;break}}},moveScenarioView:function(e,t,n,i){var a=this._vcxGuiManager._experienceBase.getManager("VCXSequenceManager");if(t);else{var r=a.GetSequenceFromScenarioId(e);if(null===r)return void console.log("error - Scenario "+e+" unknown in Sequence Manager");t=r.GetID()}var o=a.GetSequenceFromId(t).GetName(),s=this.getUISequenceTarget(o),l=a.GetSequenceFromId(n).GetName(),c=this.getUISequenceTarget(l),d=this._thumbnailsList[t];for(var u in d){if(d[u].scenarioID===e){var p=d[u];if(i<0&&(i=this._thumbnailsList[n].length),this._thumbnailsList[n].splice(i,0,this._thumbnailsList[t].splice(u,1)[0]),t!==n){0===this._sequenceContent[n].childNodes.length?this._sequenceContent[n].insertAdjacentElement("afterBegin",p.elements.container):i>=this._sequenceContent[n].childNodes.length?this._sequenceContent[n].insertAdjacentElement("beforeend",p.elements.container):this._sequenceContent[n].childNodes[i].insertAdjacentElement("beforeBegin",p.elements.container)}else{var h;if(this._sequenceContent[n].childNodes[i]._scenarioID!==e)h=this.amIBefore(p.elements.container,this._sequenceContent[n].childNodes[i])?"afterend":"beforeBegin",this._sequenceContent[n].childNodes[i].insertAdjacentElement(h,p.elements.container)}var m=s.elements.items[this._sequenceContent[t].sequenceIndex];m.counterThumbs.innerHTML=parseInt(m.counterThumbs.innerHTML)-1;var g=c.elements.items[this._sequenceContent[n].sequenceIndex];g.counterThumbs.innerHTML=parseInt(g.counterThumbs.innerHTML)+1;break}}},onCurrentScenarioChanged:function(e,t){if("VCX_Scenario_Transition"!==e){this.hideNeedForUpdate();var n=0,i=0;for(var a in this._thumbnailsList)for(var r=this._thumbnailsList[a],o=0;o<r.length;o++){var s=r[o];s.elements.transition.removeClassName("vcxActiveScenario"),s.elements.transitionBack.removeClassName("vcxActiveScenarioBack"),s.elements.transition.style.webkitTransition="",s.elements.transition.style.transition="",s.elements.transition.style.mozTransition="",s.elements.title.contentEditable=!0,s.scenarioID===e&&(n=s,i=a)}if(n){n.elements.transition.addClassName("vcxActiveScenario"),n.elements.transitionBack.addClassName("vcxActiveScenarioBack"),this.playerMode||this.getFrame().getToolbar().isEditMode()||(n.elements.title.contentEditable=!0),this.scrollToThumbnail(n);var l=this._vcxGuiManager._experienceBase,c=l.getManager("VCXSequenceManager").GetSequenceFromId(i),d=(l.getManager("VCXSequenceManager").GetIndexOfSequence(c),c.GetName()),u=this.getUISequenceTarget(d),p=parseInt(this.getUISequenceIndex(u,d));this.activeSequence(u.elements.items[p])}t&&e!==this._currentScenarioId&&"VCX_Scenario_Transition"!==e&&(this._currentScenarioId=e,this.RefreshTimeline(t,e)),this._currentScenarioId=e}},scrollToThumbnail:function(e){var t=this.getFrame().getContent().getElementsByClassName("wux-layouts-slidingviews-page-content");if(4!==t.length)console.error("Scene panel structure has changed. Automatic scroll will not take place.");else{var n=t[1],i=this.getFrame().getContent().scrollHeight,a=e.elements.container.scrollHeight,r=e.elements.container.offsetTop,o=n.scrollTop;if(r+a>o+i)n.scrollBy({top:r+a-(o+i),behavior:"smooth"});else{if(!(r<o))return;n.scrollBy({top:r-o-10,behavior:"smooth"})}}},onBeginEndTransition:function(e,t){if(e._currentScenarioId)for(var n in e._thumbnailsList){var i=e._thumbnailsList[n];for(var a in i){var r=i[a];if(r.scenarioID===e._currentScenarioId){r.elements.transition.removeClassName("vcxActiveScenario");r.elements.transition.offsetTop;r.elements.transition.removeClassName("vcxNOTransition");var o="height "+t.maxframe+"s linear";if(r.elements.transition.style.webkitTransition=o,r.elements.transition.style.transition=o,r.elements.transition.style.mozTransition=o,r.elements.transition.addClassName("vcxActiveScenario"),0===t.maxframe){r.elements.transition.addClassName("vcxNOTransition");r.elements.transition.offsetTop;r.elements.transition.removeClassName("vcxNOTransition")}}}}},onScenarioNameRefresh:function(e,t){var n=e._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(t.GetID());if(n)for(var i=t.GetName(),a=this._thumbnailsList[n.GetID()],r=0;r<a.length;r++){var o=a[r];if(o.scenarioID===t.GetID()){o.setTitle(i);break}}},onScenarioReplaced:function(e,t){this.onScenarioNameRefresh(this,t);var n=this,i=this._vcxGuiManager._experienceBase,a=t.GetDocId(),r=i.getManager("VCXDocManager").GetPropPath(a);if(r){var o=r.GetValueURL().GetValue();if(o){var s=new XMLHttpRequest;s.open("GET",o,!0),s.responseType="blob",s.onload=function(a){if(200==this.status){var r=this.response,o=new FileReader;o.onload=function(a){var r=i.getManager("VCXSequenceManager").GetSequenceFromScenarioId(e).GetID(),o=i.getManager("VCXSequenceManager").GetSequenceFromId(r).GetIndexOfScenario(e);n._thumbnailsList[r][o].setPicture(a.target.result),n._scenePanelView&&n._scenePanelView.updateScenario(e,r,t.GetName(),a.target.result,t.GetID()===n._currentScenarioId)},o.readAsDataURL(r)}},s.send()}}},onSequenceNameRefresh:function(e,t){e._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetIndexOfSequence(t)},onSequenceChanged:function(e,t){e._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetListSequences();if(t&&t.sequenceToRemove){var n=t.sequenceToRemove,i=n.GetName(),a=e._sequenceContent[n.GetID()].sequenceIndex-1,r=e.getUISequenceTarget(i);r.deleteItem(a),e._sequenceContent[n.GetID()]=null,delete e._thumbnailsList[n.GetID()],e.activeSequence(r.elements.items[0])}t&&t.sequenceToAdd&&(e.createSequence(t.sequenceToAdd,t.previousSeqIndex,e),e._scenePanelView&&e._scenePanelView.createSequenceView(t.sequenceToAdd.GetID(),t.sequenceToAdd.GetName(),s.getWebappsAssetUrl("VCXWebGUI","css/img/VCXSequence.png")))},capturePixels:function(){var e=this._vcxGuiManager._experienceBase,t=new m,n=this.getThumbnailDisplaySize(),i=2*n[0],a=2*n[1];return t.doThumbnailToDataUrl(e,i,a)},OpenScenario:function(e,t){if(""!==e){var n=this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager"),i=new p(n,this._vcxGuiManager._experienceBase.ComponentsMap,this._vcxGuiManager._experienceBase.getManager("VCXCommandManager")),a=n.GetScenarios()[e];this.onCurrentScenarioChanged(e,a),i.BuildTransitionTo(a),i.SetCallback(t),this._vcxGuiManager._experienceBase.getManager("VCXCommandManager").Push(i)}},displayNeedForUpdate:function(){if(!this.getLockSceneUpdateDisplay()&&!this.playerMode){let e=document.querySelector(".vcxActiveScenario")&&document.querySelector(".vcxActiveScenario").getParent(),t=document.querySelector('[data-rec-id*="VCXAddCameraKeyCmd"]');if(!e||!t)return;e.prepend(this._updateSceneSymbol),t.addClassName("vcx-update-available"),t.addEventListener(n.POINTERDOWN,this.hideNeedForUpdate.bind(this)),this.stopListeningToViewpointChange(),this._vcxGuiManager._sceneNeedsUpdate=!0}},hideNeedForUpdate:function(){if(this.playerMode||this.getLockSceneUpdateDisplay())return;this._updateSceneSymbol.remove();let e=document.querySelector('[data-rec-id*="VCXAddCameraKeyCmd"]');e&&(e.removeClassName("vcx-update-available"),e.removeEventListener(n.POINTERDOWN,this.hideNeedForUpdate.bind(this)),this._vcxGuiManager._sceneNeedsUpdate=!1,this.listenToViewpointChange())},listenToViewpointChange:function(){let e=this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getMainViewer().currentViewpoint;this.currentViewpoint.angle=e.getAngle(),this.currentViewpoint.eyePos=e.getEyePosition(),this.currentViewpoint.sightDir=e.getSightDirection(),this._tokenSceneUpdate?console.warn("tried to subscribe to existing event"):this._tokenSceneUpdate=t.subscribe({event:"/VISU/"},e=>{e&&e.viewpoint&&"@onViewpointChange"===e.eventType&&(this.currentViewpoint.angle!==e.viewpoint.getAngle()||e.viewpoint.getEyePosition().distanceTo(this.currentViewpoint.eyePos)>1e-10||e.viewpoint.getSightDirection().distanceTo(this.currentViewpoint.sightDir)>1e-10)&&this.displayNeedForUpdate()})},stopListeningToViewpointChange:function(){this._tokenSceneUpdate&&(t.unsubscribe(this._tokenSceneUpdate),delete this._tokenSceneUpdate)},unlockSceneUpdateDisplay:function(){this._lockedSceneUpdateDisplay=!1},lockSceneUpdateDisplay:function(){this._lockedSceneUpdateDisplay=!0},getLockSceneUpdateDisplay:function(){return this._lockedSceneUpdateDisplay}})}),define("DS/VCXWebGUI/VCXPaperCtrl",["UWA/Class","DS/CoreEvents/Events","UWA/Element","DS/Core/PointerEvents","DS/Controls/Timeline","DS/RuntimeView/RSCManager","DS/ApplicationFrame/CommandsManager","DS/VCXWebGUI/VCXPaperCtrlV2","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],function(e,t,n,i,a,r,o,s,l){"use strict";return e.extend({init:function(e,n){var s=this;this._vcxGuiManager=e,this._experienceBase=null,null!=n&&(s._experienceBase=n),this._touchCompliant=s._vcxGuiManager.isTouchActivated(),this._buttonsAvailable={showPaper:!1,zoomFit:!1,pan:!1,zoom:!1,zoomSlider:!1},this._zoomFactorButtons=s._touchCompliant?2:1,this._paneHeight=s._touchCompliant?50:42,this._timelineProgress=50,this._timeoutStartHideAnimation=2e3,this._speedDisplayAnimation=200,this._speedHideAnimation=700,this._iconPaperExpander="",this._iconPaperExpanderOver="",this._iconPaperBackgroundOver="rgb(231, 241, 248)",this._animateUI={},this._zoomChangedToken=null,this._panChangedToken=null;var c=this._experienceBase.getManager("VCXContextManager");if(c){var d=c.getActionBar();d&&(s._actionBar_sectionChangeToken=d._modelEvents.subscribe({event:"EVT_SECTION_CHANGE"},function(){s.CheckSize(d,s.mainPanel)}),s._actionBar_openToken=d._modelEvents.subscribe({event:"ACTIONBAR_OPEN"},function(){s.CheckSize(d,s.mainPanel)}),s._actionBar_closeToken=d._modelEvents.subscribe({event:"ACTIONBAR_CLOSE"},function(){s.CheckSize(d,s.mainPanel)})),s.mainPanel=new UWA.Element("div",{html:"",class:"VCXPaperCtrl",styles:{height:s._paneHeight},events:{touchstart:function(){s.mainPanel.addClassName("hover")},touchend:function(){s.mainPanel.removeClassName("hover")}}}).inject(this._vcxGuiManager._uiLayer);var u="VCX_UI_Paper_Ctrl_Up",p="VCX_UI_Paper_Ctrl_Bottom";"0px"===document.querySelector('div[data-type="ui-frame-2d"]').style.bottom&&(u+="_3DPlay",p+="_3DPlay"),s.mainPanel._styleUp=u,s.mainPanel._styleBottom=p;var h="";if(h=l["PaperCtrl.DisplayPaperButton"],this.buttonShowPaper=new UWA.Element("div",{html:"",class:"vcxPaperCtrlButton wux-button-icon-fi wux-ui-3ds wux-ui-3ds-discovery-project wux-ui-3ds-lg wux-afr-cmdstarter",title:h,events:{click:function(){var e=!s._experienceBase.getManager("VCXPaperManager").getPaperVisibility();s._experienceBase.getManager("VCXPaperManager").setPaperVisibility(e),e?s.buttonShowPaper.addClassName("wux-ui-state-active"):s.buttonShowPaper.removeClassName("wux-ui-state-active")},mouseover:function(){this.style.backgroundColor=s._iconPaperBackgroundOver},mouseout:function(){this.style.backgroundColor=""}}}).inject(s.mainPanel),s._experienceBase.getManager("VCXPaperManager").getPaperVisibility()&&s.buttonShowPaper.addClassName("wux-ui-state-active"),s.buttonShowPaper.addEvent(i.POINTERDOWN,function(){this.style.backgroundColor=s._iconPaperBackgroundOver}),s.buttonShowPaper.addEvent(i.POINTERUP,function(){this.style.backgroundColor=""}),this._buttonsAvailable.showPaper=!0,s._touchCompliant){var m=c.getContext(),g=(c.getMainViewer(),o.getCommand("VisuPanViewPaper",m));g&&(c.isSupported("DisplayPaperCtrlBtns")&&(h="",h=l["PaperCtrl.PanPaperButton"],s.buttonPan=new UWA.Element("div",{html:"",class:"vcxPaperCtrlButton wux-button-icon-fi wux-ui-3ds wux-ui-3ds-arrow-double-combo wux-ui-3ds-lg wux-afr-cmdstarter",title:h,events:{click:function(){g&&(g.isRunning()?(g.end(),s.buttonPan.removeClassName("wux-ui-state-active")):(g.begin(),s.buttonPan.addClassName("wux-ui-state-active")))},mouseover:function(){this.style.backgroundColor=s._iconPaperBackgroundOver},mouseout:function(){this.style.backgroundColor=""}}}).inject(s.mainPanel),s.buttonPan.addEvent(i.POINTERDOWN,function(){this.style.backgroundColor=s._iconPaperBackgroundOver}),s.buttonPan.addEvent(i.POINTERUP,function(){this.style.backgroundColor=""}),this._buttonsAvailable.pan=!0),g.onBegin(function(){s.buttonPan&&!s.buttonPan.classList.contains("wux-ui-state-active")&&s.buttonPan.addClassName("wux-ui-state-active")}),g.onPause(function(e){g.end()}),g.onEnd(function(){s.buttonPan&&s.buttonPan.removeClassName("wux-ui-state-active")}))}h="",h=l["PaperCtrl.FitPaperButton"],this.buttonZoomFit=new UWA.Element("div",{html:"",class:"vcxPaperCtrlButton wux-button-icon-fi wux-ui-3ds wux-ui-3ds-zoom-fit wux-ui-3ds-lg wux-afr-cmdstarter",title:h,events:{click:function(){s._experienceBase.getManager("VCXPaperManager").ToggleAutoFit()?s.buttonZoomFit.addClassName("wux-ui-state-active"):s.buttonZoomFit.removeClassName("wux-ui-state-active"),s._vcxGuiManager.updateUsableArea()},mouseover:function(){this.style.backgroundColor=s._iconPaperBackgroundOver},mouseout:function(){this.style.backgroundColor=""}}}).inject(s.mainPanel),s._experienceBase.getManager("VCXPaperManager")._autoFit&&s.buttonZoomFit.addClassName("wux-ui-state-active"),s.buttonZoomFit.addEvent(i.POINTERDOWN,function(){this.style.backgroundColor=s._iconPaperBackgroundOver}),s.buttonZoomFit.addEvent(i.POINTERUP,function(){this.style.backgroundColor=""}),this._buttonsAvailable.zoomFit=!0,c.isSupported("DisplayPaperCtrlBtns")||(this.buttonZoomFit.style.visibility="hidden"),h="",h=l["PaperCtrl.ZoomMinusButton"],s.buttonZoomMinus=s.createButton("wux-ui-3ds wux-ui-3ds-minus","url("+s._iconPaperZoomMinus+")",h),s.buttonZoomMinus.inject(s.mainPanel),s.AddEvents(s.buttonZoomMinus,"Minus",s,-1),h="",h=l["PaperCtrl.ZoomPlusButton"],s.buttonZoomPlus=s.createButton("wux-ui-3ds wux-ui-3ds-plus","url("+s._iconPaperZoomPlus+")",h),s.buttonZoomPlus.inject(s.mainPanel),s.AddEvents(s.buttonZoomPlus,"Plus",s,1),this._buttonsAvailable.zoom=!0,c.isSupported("DisplayPaperCtrlBtns")||(this.buttonZoomPlus.style.visibility="hidden",this.buttonZoomMinus.style.visibility="hidden"),this._vcxGuiManager.isTouchActivated()||(this._timelineDiv=new UWA.Element("div",{html:"",class:"VCXPaperCtrlTimelineDiv",styles:{}}).inject(s.mainPanel),this._timeline=new a({minValue:0,maxValue:100,value:this._timelineProgress,dynamicGraduations:!1,dynamicGaugeColor:!1,graduationsLabel:!1,graduations:0,eventsList:[{label:"100",value:100,onEvent:function(){}}],activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}),this._timeline.elements.container.style.margin="initial",this._timeline.inject(s._timelineDiv),this._buttonExpander=new UWA.Element("div",{html:"",class:"VCXPaperCtrlTimelineArrow",styles:{backgroundImage:"url("+s._iconPaperExpander+")"}}),this._buttonExpander.inject(this.mainPanel),document.querySelectorAll(".wux-Gauge-scale",".VCXPaperCtrlTimelineDiv")[0].style.opacity=0,this.UpdatePercentage(this),this._timeline.addEvent("change",function(){s._timelineProgress=s._timeline.getValue(),s.UpdatePercentage(s,0)}),this._buttonsAvailable.zoomSlider=!0,c.isSupported("DisplayPaperCtrlBtns")||(this._timelineDiv.style.visibility="hidden",this._buttonExpander.style.visibility="hidden")),this._checkSizeCB=this.checksizeFct.bind(this),window.attachEvent?(window.attachEvent("expand",this._checkSizeCB),window.attachEvent("collapse",this._checkSizeCB),window.attachEvent("dockIsResizing",this._checkSizeCB),window.attachEvent("dockResize",this._checkSizeCB)):window.addEventListener&&(window.addEventListener("expand",this._checkSizeCB,!0),window.addEventListener("collapse",this._checkSizeCB,!0),window.addEventListener("dockIsResizing",this._checkSizeCB,!0),window.addEventListener("dockResize",this._checkSizeCB,!0)),this._buttonsAvailable.zoomSlider&&r.onResourceLoaded({resourceFile:"VCXWebAuthoringApp/VCXWebAuthoringApp"},function(){s._iconPaperExpander=this.getIcon({key:"VCXPaperExpander",size:"Normal"}),s._buttonExpander.style.backgroundImage="url("+s._iconPaperExpander+")",s._iconPaperExpanderOver=this.getIcon({key:"VCXPaperExpanderOver",size:"Normal"})}),this._zoomChangedToken=t.subscribe({event:"/VCX/Paper/ZoomChanged"},function(e){e&&s.buttonZoomFit&&(e.autoFit?s.buttonZoomFit.addClassName("wux-ui-state-active"):s.buttonZoomFit.removeClassName("wux-ui-state-active")),e&&!e.updatePaper&&(s._lockupdatePaper=!0),s.SetZoomFactor(e),s._lockupdatePaper=!1}),this._panChangedToken=t.subscribe({event:"/VCX/Paper/PanChanged"},function(e){e&&s.buttonZoomFit&&(e.autoFit?s.buttonZoomFit.addClassName("wux-ui-state-active"):s.buttonZoomFit.removeClassName("wux-ui-state-active"))})}else console.log("No ContextManager found, paperCtrl initialization aborted..")},checksizeFct:function(){var e=this._experienceBase&&this._experienceBase.getManager("VCXContextManager").getActionBar();this.CheckSize(e,this.mainPanel)},unInitialize:function(){this._zoomChangedToken&&(t.unsubscribe(this._zoomChangedToken),this._zoomChangedToken=null),this._panChangedToken&&(t.unsubscribe(this._panChangedToken),this._panChangedToken=null);var e=this._experienceBase&&this._experienceBase.getManager("VCXContextManager").getActionBar();e&&(this._actionBar_sectionChangeToken&&e._modelEvents.unsubscribe(this._actionBar_sectionChangeToken),this._actionBar_openToken&&(e._modelEvents.unsubscribe(this._actionBar_openToken),this._actionBar_openToken=null),this._actionBar_closeToken&&(e._modelEvents.unsubscribe(this._actionBar_closeToken),this._actionBar_closeToken=null),e=null),this.buttonZoomFit.removeEvent(i.POINTERDOWN),this.buttonZoomFit.removeEvent(i.POINTERUP),this.buttonShowPaper.removeEvent(i.POINTERDOWN),this.buttonShowPaper.removeEvent(i.POINTERUP),this.buttonPan&&(this.buttonPan.removeEvent(i.POINTERDOWN),this.buttonPan.removeEvent(i.POINTERUP)),this.RemoveEvents(this.buttonZoomMinus),this.RemoveEvents(this.buttonZoomPlus),this._timeline&&this._timeline.removeEvent("change"),window.attachEvent?(window.detachEvent("expand",this._checkSizeCB),window.detachEvent("collapse",this._checkSizeCB),window.detachEvent("dockIsResizing",this._checkSizeCB),window.detachEvent("dockResize",this._checkSizeCB)):window.addEventListener&&(window.removeEventListener("expand",this._checkSizeCB,!0),window.removeEventListener("collapse",this._checkSizeCB,!0),window.removeEventListener("dockIsResizing",this._checkSizeCB,!0),window.removeEventListener("dockResize",this._checkSizeCB,!0)),this._checkSizeCB=null,this.mainPanel.parentNode&&this.mainPanel.parentNode.removeChild(this.mainPanel),this.mainPanel=null,this._experienceBase=null},createButton:function(e,t,n){return new UWA.Element("div",{html:"",class:e+" vcxPaperCtrlButton wux-button-icon-fi wux-ui-3ds-lg wux-afr-cmdstarter",title:n})},AddEvents:function(e,t,n,i){var a=this;e._useTouch=!1,e.addEvent("touchstart",function(){e.style.backgroundColor=a._iconPaperBackgroundOver,e._useTouch=!0;var t=e;return t.delta=5*i,n.UpdateSlider(n,t.delta,!1),t.delta+=5*i,t.waitPressTimer=window.setTimeout(function(){t.pressTimer=window.setInterval(function(){n.UpdateSlider(n,t.delta,!1),t.delta+=5*i},100)},300),!1}),e.addEvent("mouseover",function(){if(e._useTouch)return!1;e.style.backgroundColor=a._iconPaperBackgroundOver}),e.addEvent("mousemove",function(){}),e.addEvent("mouseup",function(){if(!0===e._useTouch)return!1;window.clearTimeout(e.waitPressTimer),window.clearInterval(e.pressTimer),e.style.backgroundColor=""}),e.addEvent("mousedown",function(){if(!0===e._useTouch)return!1;var t=e;return t.delta=5*i,e.style.backgroundColor=a._iconPaperBackgroundOver,n.UpdateSlider(n,t.delta,!1),t.waitPressTimer=window.setTimeout(function(){t.pressTimer=window.setInterval(function(){n.UpdateSlider(n,t.delta,!1),t.delta+=5*i},100)},300),!1}),e.addEvent("touchend",function(){window.clearTimeout(e.waitPressTimer),window.clearInterval(e.pressTimer),e.style.backgroundColor=""}),e.addEvent("mouseout",function(){e._useTouch=!1,window.clearTimeout(e.waitPressTimer),window.clearInterval(e.pressTimer),e.style.backgroundColor=""})},RemoveEvents:function(e){e.removeEvent("touchstart"),e.removeEvent("mouseover"),e.removeEvent("mousemove"),e.removeEvent("mouseup"),e.removeEvent("mousedown"),e.removeEvent("touchend"),e.removeEvent("mouseout")},UpdatePercentage:function(e){if("number"==typeof e._timelineProgress){e._timelineProgress;var t=0;t=e._timelineProgress<=49?90/49*e._timelineProgress+10:e._timelineProgress>=51?6*e._timelineProgress-200:100,e.zoomPaper=t/100,null===e._experienceBase||e._lockupdatePaper||(e._experienceBase.getManager("VCXPaperManager").Zoom=e.zoomPaper),e._timeline&&(e._timeline.elements.container.children[2].children[0].children[0].innerHTML=Math.floor(t)+" %")}},UpdateSlider:function(e,t,n){if("number"==typeof e._timelineProgress){var i=0;i=e._timelineProgress<=49?90/49*e._timelineProgress+10:e._timelineProgress>=51?6*e._timelineProgress-200:100,n?i=t:i+=t,e.zoomPaper=i/100,e._timelineProgress=i<=99?(i-10)/(90/49):i>=101?(i+200)/6:50,e._timelineProgress=Math.max(0,Math.min(100,e._timelineProgress)),e._timeline?e._timeline.setValue(e._timelineProgress):e.UpdatePercentage(e)}},CheckSize:function(e,t){if(1!==document.querySelectorAll("div.wux-ui-state-close").length){var n=0;if(e.elements.sectionsBar)n=e.elements.sectionsBar.getDimensions().outerWidth+50;else{var i=e.elements.container.childNodes[0].childNodes[2];i&&(n=i.getBoundingClientRect().left)}var a=t&&t.getBoundingClientRect().width;this._touchCompliant||n-parseInt(a)<0||0==e._isShownWhenLarge&&0==e._isShownWhenSmall?(t.classList.contains(t._styleBottom)&&t.classList.remove(t._styleBottom),!t.classList.contains(t._styleUp)&&t.classList.add(t._styleUp)):(t.classList.contains(t._styleUp)&&t.classList.remove(t._styleUp),!t.classList.contains(t._styleBottom)&&t.classList.add(t._styleBottom))}else t.classList.add(t._styleBottom)},SetZoomFactor:function(e){this.UpdateSlider(this,100*e.value,!0)},updatePaperArea:function(e){this.mainPanel.style.left=e.left+"px"},hide:function(){this.mainPanel.hide()},show:function(){this.mainPanel.show()},isHidden:function(){return this.mainPanel&&"none"===this.mainPanel.style.display}})}),define("DS/VCXWebGUI/VCXLandingPage",["UWA/Core","UWA/Class","DS/CoreEvents/Events","DS/Windows/ImmersiveFrame","DS/VCXWebGUI/VCXGettingStartedUI","DS/WebappsUtils/WebappsUtils","DS/VCXWebIO/VCXFileServices","DS/VCXWebIO/VCXLogServices","DS/VCXWebComposer/VCXExperienceLoader","DS/VCXWebEWS/VCXExperienceServices","DS/VCXWebPlatform/VCXSearchServices","DS/VCXWebPlatform/VCX3DSpaceServices","DS/VCXWebPlatform/VCXPlatformServices","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","DS/WelcomeScreenView/WelcomeScreen","DS/WelcomeScreenView/WelcomeScreenButtonController","DS/WelcomeScreenView/WelcomeScreenMRUController","DS/WebUAUtils/WebUAUtils","i18n!DS/VCXWebGUI/assets/nls/VCXLandingPage"],function(e,t,n,i,a,r,o,s,l,c,d,u,p,h,m,g,C,v,_){"use strict";return t.extend({init:function(e){const t=s.generateUUID();if(s.memoryLog("RCEB",!0,t),s.memoryLog("RNEB",!0,t),this.widgetId=e.widgetId,this.parent=e.parent,this.frmWindow=e.frmWindow,this.isRemoved=!1,this.experienceBase=e.experienceBase,this._vcxGettingStartedUI=this.getGettingStartedUI(),this._vcxGettingStartedUI&&this.experienceBase){var n=this.experienceBase.getManager("VCXContextManager").IsLocalMode();this._vcxGettingStartedUI.initialize({localMode:n}),this._vcxGettingStartedUI.setExperienceBase(this.experienceBase),"undefined"!=typeof widget?this._vcxGettingStartedUI.setParentNode(widget.body):this._vcxGettingStartedUI.setParentNode(document.body)}},initializeButtons:function(){return this.experienceBase?this.experienceBase.getManager("VCXEWSManager").IsExperienceStarted().then(async e=>{this.WelcomeScreen=new m({title:_["App.Title"],subtitle:_["App.Motto"],background:r.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_SplashComposer5_.png"),linksCategories:[{id:"ContentAndKnowledge",i18n:{title:"Content & Knowledge"},links:[{id:"Overview",i18n:{title:_["Overview.Title"]},icon:"eye-windowed",url:"https://media.3ds.com/3dexcite/3dexcite_dashboard/3DEXCITE_XCTXPR_Tips.html"},{id:"WhatsNew",i18n:{title:_["WhatsNew.Title"]},icon:"megaphone",url:v.getEmbeddedHelpFullPath("WNApps/XCTXPR_AP-index.html")},{id:"UserAssistance",i18n:{title:"User Assistance"},icon:"i-question",url:v.getHelpFullPath("XprUserMap/xctxpr-c-ov.htm")}]},{id:"SocialNetworks",i18n:{title:"Social Networks"},links:[{id:"UserCommunity",i18n:{title:_["SwymLink.Title"]},icon:"topbar-users",url:"https://r1132100503382-eu1-3dswym.3dexperience.3ds.com/#community:4"},{id:"linkedIn",i18n:{title:_["LinkedinLink.Title"]},icon:"logo-linkedin",url:"https://www.linkedin.com/company/3dexcite"}]}],dragAndDrop:{callbacks:{onDrop:e=>{var t=this.experienceBase.getManager("VCXDragDropManager");t&&t.loadDroppedFromCollabSpace(e)},onDragEnter:e=>Promise.resolve("OverFullPage")}}});let t=[];if(e.isExperienceStarted&&t.push({id:"Recover",i18n:{title:_["RecoverExperience.Title"]},icon:"refresh",controller:new g({onAction:e=>(c.SessionRecover(this.experienceBase),Promise.resolve())})}),t.push({id:"NewExperience",i18n:{title:_["NewExperience.Title"]},icon:"new-create",controller:new g({onAction:async()=>{var e,t;if(this.experienceBase.getManager("VCXAnalyticsTrackerAppManager").trackNewPresentationEvent("xH_HomePageButton"),this.experienceBase.getManager("VCXContextManager").isSupported("NoEmptyExperience")){let n=await d.SearchInApp("[ds6w:contentStructure]:Root",h.InsertToApp);if(n)return e=n.id,t=n.label,c.onDropProduct(t,e,this.experienceBase)}else c.onCreateEmptyExperience(this.experienceBase);return Promise.resolve()}})}),t.push({id:"OpenExperience",i18n:{title:_["OpenExperience.Title"]},icon:"open",controller:new g({onAction:()=>{if(this.experienceBase.getManager("VCXAnalyticsTrackerAppManager").trackOpenPresentationEvent("xH_HomePageButton"),"true"!==this.experienceBase.getManager("VCXContextManager").getUrlVars().tstProvider){var e=this.experienceBase.getManager("VCXCAT3DXModelManager").GetScenarioType(),t=this.experienceBase.getManager("VCXCAT3DXModelManager").GetApplicationName();d.SearchInApp("[ds6w:type]:"+e,"Open in "+t).then(e=>{if(e){var t=e.label,n=e.id;this.experienceBase.getManager("VCXGUIManager").saveToMRU(n),c.onLoadExperienceFromPhysicalID(this.experienceBase,t,n)}})}else{var n=prompt("Please enter your Experience Physical ID","");if(!n)return void console.warn("DEBUG: The experience physical ID is not defined. Cannot open experience.");c.onLoadExperienceFromPhysicalID(this.experienceBase,"test",n).then(e=>{e.experience.getManager("VCXContextManager").getRootComponent()?console.log("Experience Loaded success"):console.log("Experience Loaded FAILED")})}return Promise.resolve()}})}),t.push({id:"Import3dxml",i18n:{title:_["import3dxml.Title"]},icon:"import",controller:new g({onAction:async()=>{const e=await c.handle3DXML(null,this.experienceBase);if(e)for(let t of e.files)this.experienceBase.getManager("VCXAnalyticsTrackerAppManager").trackImport3dxmlEvent("xH_HomePageButton",e.insertProducts,t.size);return Promise.resolve()}})}),t.push({id:"JobMonitor",i18n:{title:_["jobMonitor.Title"]},icon:"chart-line-single",controller:new g({onAction:e=>(this.experienceBase.getManager("VCXLivePreviewRenderingManager").launchJobMonitor(void 0,!0),Promise.resolve())})}),t.push({id:"GuidedTour",i18n:{title:_["LaunchGuidedTour.Title"]},icon:"graduation-cap",controller:new g({onAction:e=>(this.launchGuidedTour(),Promise.resolve())})}),this.experienceBase.odt&&(localStorage.getItem("RecordMode")?t.push({id:"EndRecord",i18n:{title:_["EndRecord.Title"]},icon:"stop",controller:new g({onAction:()=>(localStorage.removeItem("RecordMode"),location.reload(),Promise.resolve())})}):t.push({id:"Record",i18n:{title:_["Record.Title"]},icon:"record",controller:new g({onAction:()=>(localStorage.setItem("RecordMode","1"),localStorage.removeItem("xHighlight_debugMode"),location.reload(),Promise.resolve())})})),this.WelcomeScreen.setButtons(t),document.body.appendChild(this.WelcomeScreen.getDOM()),widget.getValue("MRUData")){const e=await u.Get3DSpaceURL();let t=JSON.parse(widget.getValue("MRUData")),n=t.arrayRecentExperiences,i={items:[],controller:new C({simpleHit:!0,onHit:e=>{e&&(console.log(`Simple Hit on ${e}`),c.onLoadExperienceFromPhysicalID(this.experienceBase,e.title,e.id))}})};for(let a=0;a<n.length;a++){const r=n[a],o=e&&n&&await p.getObjectInfo(r,e);o&&i.items.push({id:r,title:o.dataelements.title,image:o.dataelements.image,modified:new Date(t[r])})}this.WelcomeScreen.setMRU(i)}let n=document.getElementsByClassName("afr-welcome-screen-link");for(let e=0;e<n.length;e++){n[e].setAttribute("target","_blank")}}):e.Promise.reject("LandingPage : experienceBase is missing.")},launchGuidedTour:function(){var t,n,i=this;window.loading3DXML=!0;var a=document.querySelector("div#experiencePath");return i.experienceBase.webApplication.activateGuidedTourMode(),a.hide(),i.experienceBase.webApplication.requestNewExperienceBaseAsync().then(function(s){var c;a.show(),t=s,i.experienceBase=s,c="GuidedTour.Loading",n=t.getManager("VCXNotificationManager").addProgressNotification({strAction:h[c],strObjectName:h["GuidedTour.Title"],maskDisplayAdd:18});var d={},u=r.getWebappsAssetUrl("VCXWebGuidedTour","experience/GuidedTour_Headphones.3dxml"),p=e.Promise.deferred();return o.PBlobURLToBlob(u,"").then(function(e){var t=window.URL.createObjectURL(e);d["GuidedTour_Headphones.3dxml"]=t;var n=r.getWebappsAssetUrl("VCXWebGuidedTour","experience/GuidedTour_Headphones.exprd");return o.PBlobURLToBlob(n,"")}).then(function(e){(new l).Load({experienceBase:s,mapAssets:d,jsonFile:e,urb:!0,endCB:function(e){window.loading3DXML=!1,"3dxml"===e&&setTimeout(function(){var e;e=n,t.getManager("VCXNotificationManager").endProgressNotification(e);require(["DS/VCXWebGuidedTour/VCXWebGuidedTourEngine"],function(e){new e({container:document.querySelector(".module.moduleUwa").getParent(),experienceBase:s,events:{stop:function(e){s.webApplication.deactivateGuidedTourMode(),s.webApplication.requestNewExperienceBaseAsync()}}}).start()})},500)}})}),p})},close:function(){this.WelcomeScreen&&(this.WelcomeScreen._private&&this.WelcomeScreen._private._mediumOrLessMediaQuery&&this.WelcomeScreen._private._mediumOrLessMediaQuery.removeListener(this.WelcomeScreen._private._boundOnMediumOrLessMediaQueryListener),this.WelcomeScreen.destroy(),this.WelcomeScreen=null),this.landingPageCore&&this.landingPageCore.clean(),this.wrapper&&this.wrapper.destroy(),this.isRemoved=!0,this.container&&(this.container.destroy(),this.container=null)},displayHome:function(){if(this.landingPageCore)return this.landingPageCore.displayHome()},getGettingStartedUI:function(){return a},endLoadingExperience:function(){this.close()},failLoadingExperience:function(){},curtainFade:function(){},clearInitWidget:function(){this.getGettingStartedUI().clearInitWidget()},removeCurtainFade:function(){}})}),define("DS/VCXWebGUI/VCXTreePanelCtrl",["require","exports","DS/Visualization/IdPath","DS/VCXWebGUI/VCXTreePanelView","DS/CoreEvents/Events","DS/TreeModel/TreeDocument"],function(e,t,n,i,a,r){"use strict";return class{constructor(e){this._events={},this._treeDocument=new r,this._events._evtOnAddAssetToken=a.subscribe({event:"VCX_PRODUCT_ADDED"},e=>{const t=e&&e.product&&e.product.productIndex&&e.product.productIndex.getInstRefRoot();t&&(this._treeDocument.prepareUpdate(),this._treeDocument.addRoot(t),t.setAttribute("id",e.product.GetID()),t.setAttribute("productID",e.product.GetID()),this._treeDocument.pushUpdate())}),this._events._evtOnAddAssetToken=a.subscribe({event:"VCX_COMPONENTS_CREATED"},async e=>{if(e&&e.components&&e.components.length&&e.product){this._treeDocument.prepareUpdate();for(let t of e.components){const n=await this.getNodeModelFromComponent(t,e.product);n&&(n.getAttributeValue("id")?n.getAttributeValue("id")!==t.GetID()&&console.error("Gosh! That's should not happen!"):n.setAttribute("id",t.GetID()))}this._treeDocument.pushUpdate()}}),this._experienceBase=e._experienceBase;let t={title:"Tree",icon:"tree-table",immersiveFrame:e.immersiveFrame,identifier:"VCXTreePanel",treePanelCtrl:this};this._viewPanel=new i(t,this._experienceBase.getManager("VCXContextManager"));let n=[{id:"defaultTreeHeader",title:"Tree",default:!0,commands:[{type:"callback",icon:"eye-partial",callback:this._changeSelectionVisibility.bind(this),i18n:"VCXTreeToolbarChgSelectionVis",hidden:!1}]}];this._viewPanel.generateHeaders(n),this.createViewPanel()}_changeSelectionVisibility(e){}getModelInfoFromNodeModel(e){const t={pathOfInstances:[]};let i=[];t.id=e.getAttributeValue&&e.getAttributeValue("id");let a,r=e;for(;r;){if(r&&r.getAttributeValue){const e=r.getAttributeValue("type"),n=r.getAttributeValue("pid");r.getAttributeValue("productID")&&(a=r.getAttributeValue("productID")),n&&("VPMInstance"===e&&t.pathOfInstances.push(n),i.push(n))}r=r.getParent()}return i=i.reverse(),t.pathOfInstances=t.pathOfInstances.reverse(),t.idPath=new n(i),a&&(t.productActor=this._experienceBase.ComponentsMap.GetComponentFromID(a)),t}getNodeModelFromPID(e,t,n,i){var a;if(!e)return null;for(let a of e)if((null==a?void 0:a.getAttributeValue("pid"))===t&&(0!==i||0===i&&n.GetID()===(null==a?void 0:a.getAttributeValue("id"))))return a;return e&&1===e.length&&"VPMInstance"!==(null===(a=e[0])||void 0===a?void 0:a.getAttributeValue("type"))?this.getNodeModelFromPID(e[0].getChildren(),t,n,i+1):null}async getNodeModelFromComponent(e,t){var n,i,a,r;let o=null===(i=null===(n=e.QueryInterface("W3AISGNodeHolder"))||void 0===n?void 0:n.getPathOfIDs())||void 0===i?void 0:i.ids;if(o||(o=await(null===(a=e.QueryInterface("CATI3DXOverrideAssetProperties"))||void 0===a?void 0:a.getPathOfPhysicalId()),o=[t._pid,...o]),!o)return null;let s=null===(r=this._treeDocument)||void 0===r?void 0:r.getRoots(),l=null,c=0;for(let e of o)l=this.getNodeModelFromPID(s,e,t,c),c++,s=null==l?void 0:l.getChildren();return l}async createViewPanel(){var e;const t=this._experienceBase.getManager("VCXCAT3DXModelManager");for(const e in t.products){let n=t.products[e];const i=n&&n.productIndex&&n.productIndex.getInstRefRoot();i&&(this._treeDocument.prepareUpdate(),this._treeDocument.addRoot(i),i.setAttribute("id",n.GetID()),i.setAttribute("productID",n.GetID()),this._treeDocument.pushUpdate())}null===(e=this._viewPanel)||void 0===e||e.preparePanel(this._treeDocument)}unInitialize(){var e;null===(e=this._viewPanel)||void 0===e||e.unInitialize(),this._viewPanel=null;for(let e in this._events)this._events.hasOwnProperty(e)&&a.unsubscribe(this._events[e])}}});__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXPreviewThumbnailCtrl",["require","exports","DS/VCXWebGUI/VCXPlayView"],function(e,t,n){"use strict";n=__importDefault(n);return class{constructor(e,t){t.addClassName("VCXSmallImmersiveNav"),this._experienceBase=e,this.playView=new n.default(t,{playCb:()=>this.setupPlayer(),fullScreenCb:()=>this.setupPlayer()}),this.playView.setVisibility(!0),this.playView.setAuthoringVisibility(!1),this.setupPlayer()}unInitialize(){this.playView.destroy()}updateScenarioRelatedView(){let e=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();if(e){var t=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(e),n=this._experienceBase.getManager("VCXSequenceManager").GetListScenariosInSequence(t).map(e=>e.GetID());this.playView.setArrowVisibility(!0,0==n.length-1),this.playView.updateGridContainer(n.length>1?n:[]),n.length<=1&&this.playView.setVisibilityPlayPause(!1),this.playView.updateActiveScenario(n[0],100)}}setupPlayer(){let e=this._experienceBase.getManager("VCXPlayManager").QueryInterface("VCXIModifiable");this.playView.setVisibilityPlayPause(e.GetPropertyValue("VCXPlayManager.showPlayStopButton")),this.playView.setActiveFullScreen(!1),this.updateScenarioRelatedView(),this.playView.setVisibilityImmersiveNav(e.GetPropertyValue("VCXPlayManager.immersiveNav"))}}}),define("DS/VCXWebGUI/VCXRatioCtrl",["require","exports","DS/VCXWebKernelCommands/VCXCmdRequestChangeProperties","UWA/Class","DS/WebappsUtils/WebappsUtils","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","DS/VCXWebGUI/VCXRatioPanelView"],function(e,t,n,i,a,r,o){"use strict";return class extends i{constructor(e){super(),this.listRatios={a4l:{title:r["VCXPaperCtrl.Ratio.A4L"],ratioWidth:297,ratioHeight:210,specificWidth:297,icon:a.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio16_9.png")},a4p:{title:r["VCXPaperCtrl.Ratio.A4P"],ratioWidth:210,ratioHeight:297,specificWidth:210,icon:a.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio9_16.png")},square:{title:r["VCXPaperCtrl.Ratio.Square"],ratioWidth:1,ratioHeight:1,icon:a.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio1_1.png")},default:{title:r["VCXPaperCtrl.Ratio.Wide"],ratioWidth:16,ratioHeight:9,icon:a.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio16_9.png")},_35mm:{title:r["VCXPaperCtrl.Ratio.mm35"],ratioWidth:4,ratioHeight:3,icon:a.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio4_3.png")},goldenRatio:{title:r["VCXPaperCtrl.Ratio.GoldenRatio"],ratioWidth:16,ratioHeight:10,icon:a.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio16_9.png")},wsc:{title:r["VCXPaperCtrl.Ratio.WideScreenCinema"],ratioWidth:2.35,ratioHeight:1,icon:a.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio235_1.png")},iphonexP:{title:r["VCXPaperCtrl.Ratio.iPhoneXP"],ratioWidth:9,ratioHeight:19.5,icon:a.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio9_195.png")},iphonexL:{title:r["VCXPaperCtrl.Ratio.iPhoneXL"],ratioWidth:19.5,ratioHeight:9,icon:a.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio195_9.png")}},this.guiManager=e,this._experienceBase=e._experienceBase,this._aspectRatio=this.listRatios.a4l;let t={title:r["VCXRatios.PanelTitle"],icon:"",immersiveFrame:this.guiManager.immersiveFrame,currentDockArea:WUXDockAreaEnum.LeftDockArea,identifier:"ratioPanel"};this._ratioPanelView=new o(t,this._experienceBase.getManager("VCXContextManager").getContext()),this._ratioPanelView.setRatioClickFunction(this.ratioSelectCallback.bind(this)),this.init()}init(){for(const e in this.listRatios)if(Object.prototype.hasOwnProperty.call(this.listRatios,e)){const t=this.listRatios[e];this._ratioPanelView.generateRatioCard(t)}}unInitialize(){this._ratioPanelView.unInitialize()}getPanelView(){return this._ratioPanelView.panel}getRatioFromInfo(e,t,n){for(const i in this.listRatios)if(Object.prototype.hasOwnProperty.call(this.listRatios,i)){const a=this.listRatios[i];if(a.ratioHeight===t&&a.ratioWidth===e&&a.specificWidth===n)return a}return null}async ratioSelectCallback(e,t,i){let a=this.getRatioFromInfo(e,t,i);if(a){var r=a.ratioWidth,o=a.ratioHeight,s=a.specificWidth;if(r&&o){var l=this._experienceBase.getManager("VCXContextManager").getActiveViewport();if(l){var c=l.QueryInterface("VCXIModifiable");if(c){var d=this._experienceBase.getManager("VCXCommandManager");this.aspectRatio=a;var u=new n(this._experienceBase.getManager("VCXScenarioManager"),d,!1),p=this._experienceBase.getManager("VCXPaperManager").GetWidth();if(s){p=s;var h=c.GetProperty("Paper.Width").Clone(),m=h.GetPropertyValue().Clone();m.SetValue(p),h.SetPropertyValue(m),await u.RequestModification([c],"Paper.Width",m)}p*=o/r;var g=c.GetProperty("Paper.Height").Clone(),C=g.GetPropertyValue().Clone();C.SetValue(p),g.SetPropertyValue(C),await u.RequestModification([c],"Paper.Height",C),d.Push(u)}}}}}get aspectRatio(){return this._aspectRatio}set aspectRatio(e){this._aspectRatio=e}}});__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXPlayCtrl",["require","exports","DS/CoreEvents/Events","UWA/Core","DS/VCXWebKernelCommands/VCXCmdGoToScenarioWithInterpolation","DS/VCXWebSystem/VCXScreenFullTools","DS/VCXWebGUI/VCXPlayView"],function(e,t,n,i,a,r,o){"use strict";o=__importDefault(o);return class{constructor(e){this.tokens={},this.blockScenarioUpdate=!1,this.isVisible=!1,this._experienceBase=e,this.playView=new o.default(document.querySelector(".Content[data-type=modal-dialog]"),{closeCallBack:this.onCloseCb.bind(this),canvasActiveCb:this.onCanvasCb.bind(this),immersiveNavActiveCb:this.onImmersiveNavCb.bind(this),fullScreenCb:this.onFullScreenCb.bind(this),playCb:this.togglePlayPause.bind(this),onPlaySceneCb:this.onPlaySceneCb.bind(this),onHoverCb:this.onHoverCb.bind(this)}),this.setVisibility(!1),this.tokenEventFullscreen=this.onFullScreenCbEvent.bind(this),r.on("change",this.tokenEventFullscreen),this._currentPlayPauseStatus=!1,this.tokens.VCX_BEGIN_TRANSITION=n.subscribe({event:"VCX_BEGIN_TRANSITION"},e=>{if(!e||!e.scenario)return;let t=e.scenario;this._currentPlayPauseStatus||this.blockScenarioUpdate||this.playView.updateActiveScenario(t.GetID(),80),this._currentPlayPauseStatus&&!this.blockScenarioUpdate&&this.playView.updateActiveScenario(t.GetID(),60)}),this.tokens.VCX_END_TRANSITION=n.subscribe({event:"VCX_END_TRANSITION"},e=>{e&&(this.updateScenarioRelatedView(),this._currentPlayPauseStatus||this.blockScenarioUpdate||this.playView.updateActiveScenario(e.GetID(),100))}),i.Element.addEvent.call(document,"keydown",e=>{var t=i.Event.whichKey(e);this.isVisible&&("right"!==t&&"down"!==t||this.onPlaySceneCb(null,!0,!1),"left"!==t&&"up"!==t||this.onPlaySceneCb(null,!1,!1))})}updatePaperArea(e,t){if(!this.isVisible)return;let n=this.playView.getHeaderSize();n-=2,e&&(e.top+=n,e.height-=n),t&&(t.top+=n,t.height-=n)}onCloseCb(){r.isFullscreen&&this.onFullScreenCb(!1),n.publish("VCX_PREVIEW_CLOSE")}onCanvasCb(e){this._experienceBase.getManager("VCXPaperManager").setPaperVisibility(e),this._experienceBase.getManager("VCXPlayManager").saveProperty("VCXPlayManager.showCanvas",e)}onImmersiveNavCb(e){this._experienceBase.getManager("VCXPlayManager").saveProperty("VCXPlayManager.immersiveNav",e)}async onFullScreenCbEvent(){r.isFullscreen||this.onFullScreenCb(!1)}async onFullScreenCb(e){e?(r.isFullscreen||(await r.request(),await this._experienceBase.getManager("VCXExperience").waitLoops(5)),this._experienceBase.getManager("VCXGUIManager").updateUsableArea()):(r.isFullscreen&&(await r.exit(),await this._experienceBase.getManager("VCXExperience").waitLoops(5)),this._experienceBase.getManager("VCXGUIManager").updateUsableArea(),this.playView.setActiveFullScreen(!1))}onHoverCb(e){if(this._currentPlayPauseStatus)return null;let t=this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[e];if(!t)return null;let n=t.GetDocId(),i=this._experienceBase.getManager("VCXDocManager").GetPropPath(n);return i?i.GetValueURL().GetValue():null}updateScenarioRelatedView(){let e=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();if(!e)return;var t=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(e),n=this._experienceBase.getManager("VCXSequenceManager").GetListScenariosInSequence(t).map(e=>e.GetID());let i=n.indexOf(e);this.playView.setArrowVisibility(0===i,i===n.length-1),this.playView.updateGridContainer(n.length>1?n:[]),n.length<=1&&(this.playView.setVisibilityPlayPause(!1),this.togglePlayPause(!1))}async onPlaySceneCb(e,t,i=!0){var a=this._experienceBase.getManager("VCXScenarioManager");if(a._scenariosToPlay.VCX_Scenario_Transition){a.StopPlayingScenario("VCX_Scenario_Transition"),n.publish({event:"VCX_SCENARIO_PLAY_END_REACHED",data:"VCX_Scenario_Transition"});var r=this._experienceBase.getManager("VCXExperience");await r.getAllActorsReadiness()}let o=a.GetCurrentScenario();var s=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(o),l=this._experienceBase.getManager("VCXSequenceManager").GetListScenariosInSequence(s).map(e=>e.GetID());let c=null;if(e)l.includes(e)&&(c=e,this.playView.createHoverImage(null,e));else{let e=l.indexOf(o);if(-1===e)return;e+=t?1:-1,i?c=l[(e+l.length)%l.length]:(t&&e<l.length||!t&&e>=0)&&(c=l[e])}c&&this.OpenScenario(c)}forceScenarioPourcent(e,t){this.playView.updateActiveScenario(e,t,!0),this.blockScenarioUpdate=!0}unBlockScenario(){this.blockScenarioUpdate=!1}togglePlayPause(e){if(this._currentPlayPauseStatus=e,this.tokens.event_VCX_SCENARIO_CHANGED&&(n.unsubscribe(this.tokens.event_VCX_SCENARIO_CHANGED),delete this.tokens.event_VCX_SCENARIO_CHANGED),this.tokens.event_onViewpointEndMove&&(n.unsubscribe(this.tokens.event_onViewpointEndMove),delete this.tokens.event_onViewpointEndMove),this._currentPlaytimer&&(clearTimeout(this._currentPlaytimer),this._currentPlaytimer=null),this._currentPlayPauseStatus){this.tokens.event_VCX_SCENARIO_CHANGED=n.subscribe({event:"VCX_CURRENT_SCENARIO_CHANGED"},this.gotoNextScenarioTimed.bind(this)),this.tokens.event_onViewpointEndMove=n.subscribe({event:"/VISU/"},e=>{e&&"@onViewpointEndMove"===e.eventType&&"controller"===e.from&&this.gotoNextScenarioTimed(),e&&"@onViewpointBeginMove"===e.eventType&&"controller"===e.from&&this.clearNextScenarioTimed()});let e=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();this.playView.updateActiveScenario(e,0),this._currentPlaytimer=setTimeout(()=>{this.onPlaySceneCb(e,!0)},2e3)}}clearNextScenarioTimed(){this._currentPlaytimer&&(clearTimeout(this._currentPlaytimer),this._currentPlaytimer=null);let e=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();this.playView.updateActiveScenario(e,0)}gotoNextScenarioTimed(){this.clearNextScenarioTimed();let e=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();this.playView.updateActiveScenario(e,100),this._currentPlaytimer=setTimeout(()=>{this.onPlaySceneCb(null,!0)},2e3)}async OpenScenario(e){if(""!==e)return new Promise(t=>{var n=this._experienceBase.getManager("VCXScenarioManager"),i=new a(n,this._experienceBase.ComponentsMap,this._experienceBase.getManager("VCXCommandManager")),r=n.GetScenarios()[e];i.BuildTransitionTo(r),i.SetCallback(()=>t()),this._experienceBase.getManager("VCXCommandManager").Do(i)})}setVisibility(e){this.togglePlayPause(!1),this.playView.setVisibility(e),this.isVisible=e}unInitialize(){this.playView.destroy(),this.tokenEventFullscreen&&r.off("change",this.tokenEventFullscreen);for(let e of Object.keys(this.tokens))n.unsubscribe(this.tokens[e])}setupPlayer(){let e=this._experienceBase.getManager("VCXPlayManager").QueryInterface("VCXIModifiable");e.GetPropertyValue("VCXPlayManager.autoPlay")&&(this.togglePlayPause(!0),this.playView.setPlayStatus(!0)),this.playView.setVisibilityPlayPause(e.GetPropertyValue("VCXPlayManager.showPlayStopButton")),this.playView.setVisibilityImmersiveNav(e.GetPropertyValue("VCXPlayManager.immersiveNav")),this.playView.setActiveButtonCanvas(this._experienceBase.getManager("VCXPaperManager").getPaperVisibility()),this.updateScenarioRelatedView()}setAuthoringVisibility(e){this.playView.setAuthoringVisibility(e)}}}),define("DS/VCXWebGUI/VCXMaterialView",["require","exports","DS/VCXGUIInfrastructure/VCXMainPanel","DS/VCXGUIInfrastructure/VCXMainPanelFixed","DS/Controls/TooltipModel","DS/WebappsUtils/WebappsUtils","DS/VCXWebGUI/VCXMaterialCard","UWA/Core","DS/Controls/Button","DS/VCXGUIInfrastructure/VCXCardTypeEnum","DS/Utilities/Dom"],function(e,t,n,i,a,r,o,s,l,c,d){"use strict";let u=n;localStorage.getItem("VCXNewFrame")&&(u=i);return class extends u{constructor(e,t){super(e,t),this.classNameIcon="",this.materialsList=[],this.cardLayout={ratioX:16,ratioY:9,cardWidth:130,descriptionHeight:24},this.subscribe("VCXCardMATERIALSelected",e=>{let t=e.id;e.checkflag&&(this.activateSelectionMode(),this.applyHeader("editHeader"));let n=this.getCardFromId(t);t&&n&&(e.checkflag?(n.selectCard(),n.selectCallback()):(n.unselectCard(),n.unSelectCallback()))})}getAllMaterialsCard(){return this.materialsList}getCardFromId(e){for(let t=0;t<this.materialsList.length;t++){const n=this.materialsList[t];if(n.getID()===e)return n}}getCardIndexInList(e){for(let t=0;t<this.materialsList.length;t++)if(this.materialsList[t].getID()===e)return t;return-1}updatePanelWithNewThumbnail(e,t){const n=this.getCardFromId(e);n&&(n.setIndexingIcon(!0),t&&n.updateThumbnail(t))}setOverruledMaterials(e){for(let t of this.materialsList)if(e.hasOwnProperty(t.getID())){const n=t;null==n||n.setOverruledIcon(e[t.getID()])}}updatePanel(e){for(let t in e)if(e.hasOwnProperty(t)){let n=this.getCardFromId(t);n&&(e[t].state?n.setVisibleCardIcon():n.setNotVisibleCardIcon(),e[t].isOverruled?n.setOverruledIcon(!0):n.setOverruledIcon(!1))}}setOverriddenMaterialHeadSection(e){this.setMiddleSection(e.middle.statusSelection,e.middle.text),this.setRightSection(e.right)}setMiddleSection(e,t){this.iconTextSection.style.opacity=e?1:.3,this.middleTextSection.setText(t),this.middleTextSection.tooltipInfos=new a({shortHelp:t})}setRightSection(e){e.restore?(this.restoreButton.getContent().style.display="",this.goToParent.getContent().style.display="none",this.restoreButton.disabled=e.restore.disabled,this.callbackRestore=e.restore.callback):this.restoreButton.getContent().style.display="none",e.goToParent?(this.restoreButton.getContent().style.display="none",this.goToParent.getContent().style.display="",this.goToParent.icon=e.goToParent.image,this.callbackGoToParent=e.goToParent.callback):this.goToParent.getContent().style.display="none"}setBulkOfActiveCards(e){for(let t=0;t<this.materialsList.length;t++){const n=this.materialsList[t];e.includes(n.getID())&&(null==n||n.activateCard())}}changeStateActiveCard(){for(let e=0;e<this.materialsList.length;e++){const t=this.materialsList[e];t.isCardActive()&&(null==t||t.deactivateCard())}}setActiveCardFromId(e){for(let t=0;t<this.materialsList.length;t++){const n=this.materialsList[t];n.getID()===e&&(null==n||n.activateCard())}}activateSelectionMode(){this.getPanelContent().addClassName("vcxSceneSelectionMode")}deactivateSelectionMode(){this.getPanelContent().removeClassName("vcxSceneSelectionMode");for(let e of this.materialsList)null==e||e.unselectCard()}preparePanel(){this.panelContainer=(0,s.createElement)("div",{class:"materialPanel",html:""}),this.headSection=(0,s.createElement)("div",{class:"headSectionMaterial",html:""});let e=(0,s.createElement)("div",{class:"panelMainMaterials",html:""});this.headSection.inject(e),this.panelContainer.inject(e),this.middleSection=(0,s.createElement)("div",{class:"section middleSection",html:""}),this.middleSection.inject(this.headSection),this.classNameIcon="vcxSceneUpdate";let t=(0,s.createElement)("div",{class:"sectionTextSection",html:""});this.iconTextSection=d.generateIcon({iconPath:r.getWebappsAssetUrl("VCXWebGUI","icons/32/I_VPMNavProduct.png"),className:this.classNameIcon}),this.middleTextSection=(0,s.createElement)("div",{class:"textB",html:"No Selection"}),this.iconTextSection.inject(t),this.middleTextSection.inject(t),t.inject(this.middleSection),this.rightSection=(0,s.createElement)("div",{class:"section rightSection",html:""}),this.restoreButtonContainer=(0,s.createElement)("div",{class:"",html:""}),this.restoreButton=new l({label:"",displayStyle:"lite",showLabelFlag:!1,icon:{iconName:"3d-object-reset",fontIconFamily:WUXManagedFontIcons.Font3DS},disabled:!1}),this.restoreButton.inject(this.rightSection),this.restoreButton.getContent().style.display="none",this.restoreButton.addEventListener("buttonclick",this.clickOnRestore.bind(this)),this.goToParent=new l({label:"Go to parent",showLabelFlag:!0,icon:{iconPath:"",iconSize:{height:"22px",width:"22px"}}}),this.goToParent.addEventListener("buttonclick",this.clickOnGoToParent.bind(this)),this.goToParentImg=(0,s.createElement)("div",{class:"goToParentImg",html:""}),this.goToParentText=(0,s.createElement)("div",{class:"goToParentText",html:"Go To Parent"}),this.goToParent.inject(this.rightSection),this.goToParent.getContent().style.display="none",this.goToParent.getContent().addClassName("buttonGoToParentSize"),this.rightSection.inject(this.headSection),this.setPanelContent(e)}clickOnGoToParent(){this.callbackGoToParent&&this.callbackGoToParent()}clickOnRestore(){this.callbackRestore&&this.callbackRestore()}updatePanelWithNewMaterials(e){for(let t of e)this.addMaterialCard(t)}destroyMaterialByID(e){const t=this.getCardFromId(e);t&&t.destroy();let n=this.getCardIndexInList(e);n&&n>-1&&this.materialsList.splice(n,1)}unInitialize(){for(let e of this.materialsList)e.destroy();super.unInitialize()}addMaterialCard(e){let t={id:e.id,title:e.name,image:e.image,isInternal:e.isInternal,selectableFlag:!0,type:c.MATERIAL,isVisible:!!e.hasOwnProperty("isVisible")&&e.isVisible,cardLayout:this.cardLayout},n=new o(t);return this.materialsList.push(n),n.setIndexingIcon(e.isIndexed),n.setOnSelectCardCallback(e.callbackOnSelectCard),n.setOnUnselectCardCallback(e.callbackOnUnselectCard),this.setContextualMenu(n,e.callbackSelect,e.callbackDelete),n.getThumbnailElement().addEventListener("click",()=>{e.callbackClickMaterial()}),n.getThumbnailElement().addEventListener("mouseover",()=>{e.callbackPrehighlight()}),n.getThumbnailElement().addEventListener("mouseout",()=>{e.callbackOnMouseOutMaterial()}),n.getIndexingIcon().addEventListener("mouseover",()=>{e.callbackPrehighlight()}),n.getIndexingIcon().addEventListener("mouseout",()=>{e.callbackOnMouseOutMaterial()}),n.getView().addClassName("materialCard"),n.getView().inject(this.panelContainer),n}setContextualMenu(e,t,n){e.customizeMenu([{icon:"raw-material",considerStateSelect:!0,action:()=>{t(),this.materialsList.forEach(e=>e.deactivateCard()),e.activateCard()},label:"Select all parts with material"},{icon:"trash",considerStateDelete:!0,action:()=>{n()},label:"Delete material"}])}}}),define("DS/VCXWebGUI/VCXMaterialCtrl",["UWA/Class","DS/VCXWebGUI/VCXMaterialView","DS/VCXWebPlatform/VCXPlatformServices","DS/VCXWebPlatform/VCX3DSpaceServices","DS/VCXWebPlatform/VCXSearchServices","DS/CoreEvents/Events","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdRequestChangeProperties","DS/VCXWebIO/VCXLogServices","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],function(e,t,n,i,a,r,o,s,l,c,d,u){"use strict";return e.extend({init:function(e){this._vcxGuiManager=e,this._experienceBase=e._experienceBase,this._materialsDescription=[],this._simulateResult=[],this._selectedMaterial=[],this._limitIndexing=0,this._materialManager=this._experienceBase.getManager("VCXMaterialManager"),this._visuManager=this._experienceBase.getManager("VCXVisuManager"),this._contextManager=this._experienceBase.getManager("VCXContextManager"),this._commandManager=this._experienceBase.getManager("VCXCommandManager"),this._selectionManager=this._experienceBase.getManager("VCXSelectionManager"),this._scenarioManager=this._experienceBase.getManager("VCXScenarioManager"),this._selectionOverridenMaterials={overridenComponent:[],materialsImpacted:{}},this._events={};let n={title:"Materials",icon:"material",immersiveFrame:e.immersiveFrame,identifier:"VCXMaterialPanel",currentDockArea:localStorage.getItem("VCXNewFrame")?WUXDockAreaEnum.LeftDockArea:void 0};this._viewPanel=new t(n,this._contextManager);let i=[{id:"defaultMaterialHeader",title:u["VCXMaterialCtrl.Title"],default:!0,commands:[{type:"callback",icon:"select-on",position:"far",i18n:u["VCXMaterialCtrl.ActivateMultiSelectionMode"],callback:()=>{this._viewPanel.activateSelectionMode(),this._viewPanel.applyHeader("editHeader")}},{type:"callback",icon:"plus",position:"far",i18n:u["VCXMaterialCtrl.InsertNewMaterial"],callback:async()=>{await this.insertNewMaterial()}}]},{id:"editHeader",title:"",commands:[{type:"callback",icon:"close",position:"near",callback:()=>{this._viewPanel.deactivateSelectionMode(),this._selectedMaterial=[],this._viewPanel.displayDefaultHeader()},i18n:u["VCXMaterialCtrl.ExitMultiSelectionMode"],hidden:!1},{type:"callback",icon:"trash",i18n:u["VCXMaterialCtrl.DeleteMaterials"],callback:async()=>{let e=[...this._selectedMaterial];for(let t of e)this.onUnselectCardMaterial(t),await this.onDeleteMaterial(t)},hidden:!1}]}];this._viewPanel.generateHeaders(i),this._events._tokenOnLoadMaterial=r.subscribe({event:"VCX_MATERIAL_LOADED"},e=>{this.createViewPanelEmpty()}),this._events._tokenOnUpdateV2Material=r.subscribe({event:"VCX_MATERIALS_PANEL_UPDATE_V2"},async e=>{await this.createViewPanel(),this.updatePanelOnChangeScene()}),this._events._tokenOnChangeScene=r.subscribe({event:"VCX_UPDATE_MATERIALS_ON_CHANGE_SCENE"},e=>{this.updatePanelOnChangeScene()}),this._events._tokenUpdatePanel=r.subscribe({event:"VCX_MATERIALS_PANEL_UPDATE"},e=>{this.updateViewPanel()}),this._events._tokenOnInsertMaterial=r.subscribe({event:"VCX_MATERIAL_INSERTED"},async e=>{this.addNewMaterial(e)}),this._events._tokenOnApplyMaterial=r.subscribe({event:"VCX_MATERIAL_APPLIED"},e=>{e&&(this._materialManager.addPartsWhereAppliedToMaterial(e.PID,e.components),this._viewPanel.changeStateActiveCard(),this._viewPanel.getCardFromId(e.PID).getVisibleState()&&this._viewPanel.getCardFromId(e.PID).activateCard())}),this._events._tokenOnDeleteMaterial=r.subscribe({event:"VCX_MATERIAL_DELETED"},e=>{this._viewPanel.destroyMaterialByID(e.materialPID),this.updateViewPanel()}),this._events._tokenOnRemoveSelection=r.subscribe({event:"VCXActiveCardMATERIAL"},e=>{const t=this._materialManager.getMaterialsPLM();let n=this.updateOverruledAndAppliedMaterial(),i={};for(let e of t){let t=e.QueryInterface("VCXIMaterialCache").GetPID();i[t]=!!this._selectionOverridenMaterials.materialsImpacted[t]}let a=this._selectionManager.GetComponentsFromSelection("CSO");a=a.filter(e=>e.IsKindOf("VCXComponentOccurrenceComposer")).map(e=>e.GetID()),this.updateViewPanel(),this.updateOverriddenMaterialsSectionInPanel(a),this._viewPanel.setOverruledMaterials(i),this._viewPanel.changeStateActiveCard(),this._viewPanel.setBulkOfActiveCards(n)})},updateOverruledAndAppliedMaterial:function(){let e=this._selectionManager.GetComponentsFromSelection("CSO");e=e.filter(e=>e.IsKindOf("VCXComponentOccurrenceComposer")).map(e=>e.GetID()),this._selectionOverridenMaterials={overridenComponent:[],materialsImpacted:{}};let t=[];for(let n of e){let e=this._experienceBase.ComponentsMap.GetComponentFromID(n);if(!e)continue;let i=e.GetCurrentMaterial(),a=!1,r=null;for(;e&&(e=e.QueryInterface("VCXIModelNavigable").getParent()).GetObject().IsKindOf("VCXComponentOccurrenceComposer");){let t=e.GetObject().GetCurrentMaterial();t&&t.IsKindOf("CXPCoveringMaterial_Spec")&&(a=!0,r=e.GetObject())}i&&t.push(i.QueryInterface("VCXIMaterialCache").GetPID()),a&&(this._selectionOverridenMaterials.overridenComponent.push(r),i&&(this._selectionOverridenMaterials.materialsImpacted[i.QueryInterface("VCXIMaterialCache").GetPID()]={materialCache:i,objectOverridingMaterial:r,status:1}))}return t},navigateToParentCmd:function(){if(this._selectionOverridenMaterials.overridenComponent.length>0){const e=new s(this._selectionManager);e.SetSelection(this._selectionOverridenMaterials.overridenComponent[0]),this._commandManager.Do(e),r.publish({event:"VCXActiveCardMATERIAL",data:null})}},checkRestoreCommandStatus:function(e){let t=["Actor.Env.Effect","Actor.PLM.Material"];for(let n=0;n<t.length;n++)if(this._scenarioManager.IsCurrentPropertyDifferentFromNeutral(e,t[n]))return!0},restoreDefaultMaterial:function(e){if(e){const c=["Actor.Env.Effect","Actor.PLM.Material"],d=e.QueryInterface("VCXIModifiable");if(d){var t=d.GetHashing();if(t){var n=this._scenarioManager.GetNeutrals(t);if(n){for(var i=0;i<c.length;i++){var a=c[i];if(n._map.hasOwnProperty(a)){var o=n.GetProperty(a);if(o){var s=new l(this._scenarioManager,this._commandManager);s.ChangeProperty(d,o),this._commandManager.Push(s)}}}r.publish({event:"VCXActiveCardMATERIAL",data:null})}}}}},updateOverriddenMaterialsSectionInPanel:function(e){let t={middle:{},right:{restore:null,goToParent:null}};if(0===e.length)console.log("0 selected component"),t.middle.text="No selection",t.middle.statusSelection=!1;else if(e.length>1||this._selectionOverridenMaterials.overridenComponent.length>1)console.log(e.length," elements"),t.middle.text=e.length+" elements",t.middle.statusSelection=!0;else{const n=this._experienceBase.ComponentsMap.GetComponentFromID(e[0]),i=n&&n.QueryInterface("VCXIModifiable");if(!i)return;const a=i.GetProperty("Actor.Name").GetPropertyValue().GetValue();let r=this._selectionOverridenMaterials.overridenComponent[0];if(r){let e=r.GetCurrentMaterial();const n=e&&e.QueryInterface("VCXIMaterialCache");n&&(t.right.goToParent={},t.right.goToParent.image=n.GetImage(),t.right.goToParent.callback=this.navigateToParentCmd.bind(this))}else{let e=this.checkRestoreCommandStatus(i);t.right.restore={},t.right.restore.disabled=!e,t.right.restore.callback=this.restoreDefaultMaterial.bind(this,n)}t.middle.text=a,t.middle.statusSelection=!0}this._viewPanel&&this._viewPanel.setOverriddenMaterialHeadSection(t)},onDeleteMaterial:async function(e){"record"===this._experienceBase.odt&&this._experienceBase.getManager("VCXODTManager").LogAPI("VCXDeleteMaterial",e);let t=this._experienceBase.getManager("VCXMaterialManager").getMaterialPLM(e);if(!t||!t.IsKindOf("CXPCoveringMaterial_Spec"))return;let n=t.QueryInterface("VCXIMaterialCache").GetWhereApplied();for(let e of n){let t=this._experienceBase.ComponentsMap.GetComponentFromID(e);this.restoreDefaultMaterial(t)}await this._experienceBase.getManager("VCXCAT3DXModelManager").DeleteMaterial([t],!1);let i=this._materialsDescription.indexOf(e);this._materialsDescription.splice(i,1),this._viewPanel.destroyMaterialByID(e),this.updateViewPanel()},updatePanelOnChangeScene:function(){const e=this._materialManager.getMaterialsPLM();let t=this.updateOverruledAndAppliedMaterial(),n={};for(let t of e){let e=t.QueryInterface("VCXIMaterialCache").GetPID();n[e]=!!this._selectionOverridenMaterials.materialsImpacted[e]}let i=this._selectionManager.GetComponentsFromSelection("CSO");i=i.filter(e=>e.IsKindOf("VCXComponentOccurrenceComposer")).map(e=>e.GetID()),this.updateViewPanel(),this.updateOverriddenMaterialsSectionInPanel(i),this._viewPanel.changeStateActiveCard(),this._viewPanel.setBulkOfActiveCards(t),this._viewPanel.setOverruledMaterials(n)},insertNewMaterial:function(){let e=[];this._selectionManager.ProcessComponentsFromSelection("CSO",t=>{t.IsKindOf("VCXComponentOccurrenceComposer")&&e.push(t)}),a.SearchInApp("[ds6w:type]:dsc_matref_ref_Covering",void 0).then(t=>{if(t&&t.id&&t.label)return this._experienceBase.getManager("VCXCAT3DXModelManager").InsertMaterial(t.label,null,t.id,e)})},updateViewPanel:function(){let e={},t=this._materialManager.getMaterialsPLM();for(let n of t){let t=n.QueryInterface("VCXIMaterialCache"),i=t.GetPID(),a=t.GetWhereApplied();a=a.filter(e=>{let t=this._experienceBase.ComponentsMap.GetComponentFromID(e),n=t&&t.QueryInterface("VCXIVisibility");return n&&1===n.GetVisibility()}),e[i]={},e[i].image=t.GetImage(),e[i].state=a.length>0,e[i].selectCallback=this.onClickMaterial.bind(this,i),e[i].isOverruled=!!this._selectionOverridenMaterials.materialsImpacted[i]}this._viewPanel.updatePanel(e)},onMouseOutMaterial:function(){WUX.Selection.PSOManager.empty(),this._selectionManager.RefreshXSO()},onMouseOverMaterial:function(e){this.prehighlightId&&window.clearTimeout(this.prehighlightId),this.prehighlightId=window.setTimeout(()=>{this.prehighlightAllPartsByMaterialId(e)},300)},prehighlightAllPartsByMaterialId:function(e){let t=this._selectionManager.GetComponentsFromSelection("CSO");if((t=t.filter(e=>e.IsKindOf("VCXComponentOccurrenceComposer")).map(e=>e.GetID()))&&t.length)return;let n=this._materialManager.getMaterialPLM(e);WUX.Selection.PSOManager.empty();let i=n.QueryInterface("VCXIMaterialCache").GetWhereApplied();i&&i.length>0&&(i.forEach(e=>{let t=this._experienceBase.ComponentsMap.GetComponentFromID(e),n=t&&t.QueryInterface("W3AISGNodeHolder").getPathElement();n&&WUX.Selection.PSOManager.add({pathElement:n})}),this._selectionManager.RefreshXSO())},selectAllPartsByMaterialId:function(e){"record"===this._experienceBase.odt&&this._experienceBase.getManager("VCXODTManager").LogAPI("VCXSelectPartsFromMaterialCard",e);const t=d.generateUUID();WUX.Selection.CSOManager.empty();let n=this._materialManager.getMaterialPLM(e).QueryInterface("VCXIMaterialCache").GetWhereApplied();if((n=[...new Set(n)])&&n.length>0){d.memoryLog("SelectPartsWithMaterial",!0,t,{N:n.length,parameterName:"parts where applied"});const e=new s(this._selectionManager);let i=[...n];n=n.map(e=>this._experienceBase.ComponentsMap.GetComponentFromID(e)).filter(e=>!!e),e.AddComponentsToSelection(n),this._commandManager.Do(e),d.memoryLog("SelectPartsWithMaterial",!1,t,{N:n.length,parameterName:"parts where applied"}),this.updateOverruledAndAppliedMaterial();let a={};const r=this._materialManager.getMaterialsPLM();for(let e of r){let t=e.QueryInterface("VCXIMaterialCache").GetPID();a[t]=!!this._selectionOverridenMaterials.materialsImpacted[t]}this._viewPanel.setOverruledMaterials(a),this.updateOverriddenMaterialsSectionInPanel(i)}},onClickMaterial:async function(e){return"record"===this._experienceBase.odt&&this._experienceBase.getManager("VCXODTManager").LogAPI("VCXApplyMaterialFromPanel",e),this._visuManager.hideDecorations("PanelMaterialLiveChange",this._contextManager.getMainViewer(),!0),this.applyMaterial(e).then(e=>{e&&(this.updateViewPanel(),this._viewPanel.changeStateActiveCard(),this._viewPanel.getCardFromId(e.QueryInterface("VCXIMaterialCache").GetPID()).getVisibleState()&&this._viewPanel.getCardFromId(e.QueryInterface("VCXIMaterialCache").GetPID()).activateCard()),this._visuManager.showDecorations("PanelMaterialLiveChange",this._contextManager.getMainViewer(),!0)})},applyMaterial:async function(e){const t=d.generateUUID();let n=this._selectionManager.GetComponentsFromSelection("CSO"),i=null;return(n=n.filter(e=>e.IsKindOf("VCXComponentOccurrenceComposer")))&&n.length&&(d.memoryLog("ApplyMaterial",!0,t,{N:n.length,parameterName:"selected parts"}),i=await this.applyMaterialToSelection(e,n,!0),d.memoryLog("ApplyMaterial",!1,t,{N:n.length,parameterName:"selected parts"})),r.publish({event:"VCXActiveCardMATERIAL",data:null}),i},applyMaterialToSelection:async function(e,t,n){const i=this._commandManager,a=this._scenarioManager,r=this._materialManager;let s=null;if(e&&(s=r.getMaterialPLM(e)),this._selectionOverridenMaterials.overridenComponent.length>0)return this._experienceBase.getManager("VCXNotificationManager").addNotification({level:"warning",title:u["VCXMaterialCtrl.ApplyMaterial.NotificationTitle"],message:u["VCXMaterialCtrl.ApplyMaterial.NotificationMessage"]}),null;try{await s.QueryInterface("VCXIMaterialCache").getMaterialVisu()}catch(e){var l={level:"error",title:u["Notification.ErrorMaterial"],message:e.toString().replace("GetMaterialAppearance fail :","")};return void this._experienceBase.getManager("VCXNotificationManager").addNotification(l)}let d=new c(a,i,!1);for(let e of t){let t=e.QueryInterface("VCXIModifiable");if(t){let n=t.GetProperty("Actor.PLM.Material").GetPropertyValue().Clone(),a=e.originalMaterial&&e._experienceBase.ComponentsMap.GetComponentFromID(e.originalMaterial);null===s||a===s.QueryInterface("VCXIMaterialCache").GetInternalMaterial()?n.SetValue(""):n.SetValue(await s.QueryInterface("VCXIMaterialCache").GetExternalID()),await d.RequestModification([t],"Actor.PLM.Material",n),await d.RequestModification([t],"Actor.Env.Effect",new o(99)),i.Push(d)}}return s},onSelectCardMaterial:function(e){const t=this._materialManager.getMaterialPLM(e),n=new s(this._selectionManager);n.AddToSelection(t),this._commandManager.Do(n),this._selectedMaterial.push(e)},onUnselectCardMaterial:function(e){const t=this._materialManager.getMaterialPLM(e),n=new s(this._selectionManager);n.RemoveFromSelection(t),this._commandManager.Do(n);let i=this._selectedMaterial.indexOf(e);i>=0&&this._selectedMaterial.splice(i,1),this._selectedMaterial.length||(this._viewPanel.deactivateSelectionMode(),this._viewPanel.displayDefaultHeader())},addNewMaterial:function(e){let t=e.QueryInterface("VCXIMaterialCache");if(!this._materialsDescription.includes(t.GetPID())){let e=t.GetWhereApplied();const n=!!t.GetInternalMaterial();e=[...new Set(e)];let i=this._viewPanel.addMaterialCard({id:t.GetPID(),name:t.GetTitle(),image:t.GetImage(),isIndexed:!0,isInternal:n,isVisible:e.length>0,callbackClickMaterial:this.onClickMaterial.bind(this,t.GetPID()),callbackPrehighlight:this.onMouseOverMaterial.bind(this,t.GetPID()),callbackOnMouseOutLabel:()=>{WUX.Selection.PSOManager.empty()},callbackOnMouseOverMaterial:null,callbackOnMouseOutMaterial:this.onMouseOutMaterial.bind(this),callbackOnSelectCard:this.onSelectCardMaterial.bind(this,t.GetPID()),callbackOnUnselectCard:this.onUnselectCardMaterial.bind(this,t.GetPID()),callbackSelect:this.selectAllPartsByMaterialId.bind(this,t.GetPID()),callbackReplace:()=>console.warn("Replace material not yet implemented !"),callbackDelete:this.onDeleteMaterial.bind(this,t.GetPID())});this.updateViewPanel(),this._viewPanel.changeStateActiveCard(),i.getVisibleState()&&i.activateCard(),this._materialsDescription.push(t.GetPID())}},createViewPanelEmpty:function(){this._viewPanel.preparePanel()},createViewPanel:async function(){let e=[];const t=this._materialManager.getMaterialsPLM();let a=!1;for(let n of t){let t=n.QueryInterface("VCXIMaterialCache");if(t.GetImage().includes("enovia")&&(a=!0,t.SetIndexingState(!1)),a=a||t.GetImage().includes("enovia"),!this._materialsDescription.includes(t.GetPID())){this._materialsDescription.push(t.GetPID());let n=t.GetWhereApplied();const i=!!t.GetInternalMaterial();n=[...new Set(n)],e.push({id:t.GetPID(),name:t.GetTitle(),image:t.GetImage(),isVisible:n.length>0,isInternal:i,isIndexed:t.GetIndexingState(),callbackClickMaterial:this.onClickMaterial.bind(this,t.GetPID()),callbackPrehighlight:this.onMouseOverMaterial.bind(this,t.GetPID()),callbackOnMouseOutLabel:()=>{WUX.Selection.PSOManager.empty()},callbackOnSelectCard:this.onSelectCardMaterial.bind(this,t.GetPID()),callbackOnUnselectCard:this.onUnselectCardMaterial.bind(this,t.GetPID()),callbackOnMouseOverMaterial:null,callbackOnMouseOutMaterial:this.onMouseOutMaterial.bind(this),callbackSelect:this.selectAllPartsByMaterialId.bind(this,t.GetPID()),callbackReplace:()=>console.warn("Replace material not yet implemented !"),callbackDelete:this.onDeleteMaterial.bind(this,t.GetPID())})}}if(a){if(!this.tsStartCheckingIndexing){const e=(new Date).getTime();this.tsStartCheckingIndexing=e/1e3}if(this.url3DSpace||(this.url3DSpace=await i.Get3DSpaceURL()),!this.securityCtx){const e=await i.GetPreferredSecurityContext();this.securityCtx=e.role+"."+e.organization+"."+e.collabspace}this.intervalID&&window.clearInterval(this.intervalID),this.intervalID=window.setInterval(async()=>{if(this._limitIndexing++,this._limitIndexing>=10){console.log("[1m[35mTentatives of checking indexation reached 10[0m"),window.clearInterval(this.intervalID);let e=this._materialManager.getMaterialsPLM();for(let t of e){let e=t.QueryInterface("VCXIMaterialCache");e.SetIndexingState(!0),this._viewPanel.updatePanelWithNewThumbnail(e.GetPID(),null)}return}const e=this.url3DSpace,t=await n.getLastIndexingDate(e,this.securityCtx,["FTS"]);if(t&&t.hasOwnProperty("FTS")){const i=t.FTS.allvaultsacl;if(i>this.tsStartCheckingIndexing){let t=this._materialManager.getMaterialsPLM(),a=0;for(let i of t){let t=i.QueryInterface("VCXIMaterialCache");if(!t.GetIndexingState()&&t.GetImage().includes("enovia")){t.SetIndexingState(!0);let i=e&&await n.getObjectInfo(t.GetPID(),e);i.dataelements&&i.dataelements.hasOwnProperty("image")&&(i.dataelements.image.includes("enovia")||(a++,t.SetImage(i.dataelements.image),this._viewPanel.updatePanelWithNewThumbnail(t.GetPID(),i.dataelements.image)))}}a===t.length?(console.log("[1m[35mAll materials with default thumbnail have been updated[0m"),window.clearInterval(this.intervalID)):a>0&&(this.tsStartCheckingIndexing=i)}}},6e4)}this._viewPanel.updatePanelWithNewMaterials(e)},unInitialize:function(){this._viewPanel.unInitialize(),this._viewPanel=null,this._limitIndexing=null;for(let e in this._events)this._events.hasOwnProperty(e)&&r.unsubscribe(this._events[e]);this.tsStartCheckingIndexing&&(this.tsStartCheckingIndexing=null),this.url3DSpace&&(this.url3DSpace=null),this.securityCtx&&(this.securityCtx=null),this._materialManager=null,this._visuManager=null,this._contextManager=null,this._commandManager=null,this._selectionManager=null,this._scenarioManager=null,this.intervalID&&(window.clearInterval(this.intervalID),this.intervalID=null)}})}),define("DS/VCXWebGUI/VCXScenePanelView",["require","exports","DS/Controls/Button","DS/VCXGUIInfrastructure/VCXMainPanel","DS/VCXGUIInfrastructure/VCXMainPanelFixed","DS/VCXGUIInfrastructure/VCXCardTypeEnum","DS/VCXWebGUI/VCXSceneCard","UWA/Core","i18n!DS/VCXWebProducts/assets/nls/VCXWebProductAuthoringCommands","DS/CoreEvents/Events"],function(e,t,n,i,a,r,o,s,l,c){"use strict";let d=i;localStorage.getItem("VCXNewFrame")&&(d=a);return class extends d{constructor(e,t){super(e,t),this.sceneList=new Array,this.cardLayout={ratioX:16,ratioY:9,cardWidth:localStorage.getItem("VCXNewFrame")?150:170,descriptionHeight:24},this.captureButton=new n({emphasize:"primary",icon:{iconName:"camera",fontIconFamily:WUXManagedFontIcons.Font3DS}}),this.captureButton.elements.container.title=l.VCXCreateScenarioCmd,this.captureButton.getContent().setAttribute("data-rec-id","New-Scene-Capture-Button"),this.newSceneButton=new n({displayStyle:"lite",icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS}}),this.newSceneButton.elements.container.title=l.VCXCreateEmptyScenarioCmd,this.newSceneButton.getContent().setAttribute("data-rec-id","New-Scene-Empty-Button"),this.preparePanel(),this.getPanelContent().addClassName("vcxDisplayModeSmall"),this.setDragDropEvents(),this.subscribe("VCXCardSCENESelected",e=>{let t=e.id;e.checkflag&&(this.activateSceneSelectionMode(),this.applyHeader("editScenesHeader")),t&&this.selectSceneCallback&&(e.checkflag?this.selectScene(t):this.deselectScene(t),this.selectSceneCallback(t,e.checkflag))})}deselectScene(e){var t;null===(t=this.getCardFromId(e))||void 0===t||t.unselectCard(),this.getSelectedSceneIds&&0===this.getSelectedSceneIds().length&&this.deactivateSceneSelectionMode()}selectScene(e){var t;null===(t=this.getCardFromId(e))||void 0===t||t.selectCard()}unInitialize(){for(let e=0;e<this.sceneList.length;e++)this.sceneList[e].destroy();super.unInitialize()}createSequenceView(e,t){console.warn("Create sequence view currently does nothing"),(0,s.createElement)("div",{class:"scenesContainer",html:"","data-sequence-id":e}).inject(this.sequenceContainer).style.gridTemplateColumns="repeat(auto-fill, "+this.cardLayout.cardWidth+"px)"}getSequenceViewFromId(e){if(this.sequenceContainer){let t=this.sequenceContainer.children;for(let n=0;n<t.length;n++){const i=t[n];if(i.getAttribute("data-sequence-id")===e)return i}}return null}activateSequence(e){console.warn("activate sequence currently does nothing: ",e)}preparePanel(){let e=(0,s.createElement)("div",{class:"panelContainer",html:""});this.sequenceContainer=(0,s.createElement)("div",{class:"sequencesContainer",html:""}).inject(e);let t=(0,s.createElement)("div",{class:"vcxScenePanelFooter",html:""}).inject(e);this.setPanelContent(e),this.captureButton.inject(t),this.captureButton.getContent().addClassName("vcxCaptureButton"),this.newSceneButton.inject(t),this.newSceneButton.getContent().addClassName("vcxNewSceneButton")}createScenario(e,t,n,i,a,s){var l;if(this.sequenceContainer){let c=this.getSequenceViewFromId(t);if(!c)return void console.warn("sequence not found");let d={id:e,title:n,image:a,selectableFlag:!0,type:r.SCENE,cardLayout:this.cardLayout},u=new o(d),p=u.getView();this.sceneList.push(u),c.insertBefore(p,c.getChildren()[i]);let h=null===(l=this.getPanelContent())||void 0===l?void 0:l.parentElement,m=document.getElementsByClassName("vcxScenePanelFooter")[0];h&&(h.scrollTop>p.offsetTop?h.scrollTo({top:p.offsetTop,behavior:"smooth"}):p.offsetTop>h.scrollTop+h.offsetHeight-p.offsetHeight-m.offsetHeight&&h.scrollTo({top:p.offsetTop-h.offsetHeight+p.offsetHeight+m.offsetHeight,behavior:"smooth"})),s&&this.changeCurrentScenario(e),this.setContextualMenu(u),this.renameSceneCallback&&u.addRenameCardCallback(this.renameSceneCallback);let g=this;u.addCardClickCallback(e=>{(e.target===u.getView()||e.target===u.getView().getElementsByClassName("vcxUICard-descriptionContainer")[0]||!u.isCardActive()&&e.target===u.getView().getElementsByClassName("vcxUICard-descriptionTitle")[0]||e.target===u.getView().querySelector("img"))&&g.sceneClickCallback&&g.sceneClickCallback(u.getID())}),u.addUpdateButtonCallback(()=>{g.updateButtonCallback()})}else console.error("tried to update a scene with no scene container in the view: this.sceneContainer")}setContextualMenu(e){e.customizeMenu([{icon:"duplicate",action:()=>{this.duplicateSceneCallback&&this.duplicateSceneCallback(e.getID())},label:"Duplicate Scene"},{icon:"camera-refresh",activeSceneDisabled:!0,action:()=>{this.replaceSceneCallback&&this.replaceSceneCallback(e.getID())},label:"Replace Scene"},{icon:"trash",action:()=>{this.deleteSceneCallback?this.deleteSceneCallback(e.getID()):console.warn("no callback set for this button")},label:"Delete Scene"},{icon:"rename",action:()=>{console.log("rename"),e!==this.getActiveCard()&&e.getName().setAttribute("contenteditable","true"),e.getName().focus()},label:"Rename"}])}removeScenario(e){let t=this.getCardFromId(e);if(!t)return;let n=this.sceneList.indexOf(t);t.destroy(),n>-1&&this.sceneList.splice(n,1)}updateScenario(e,t){let n=this.getCardFromId(e);null==n||n.updateInfo(t)}changeCurrentScenario(e){var t,n;null===(t=this.getActiveCard())||void 0===t||t.deactivateCard(),null===(n=this.getCardFromId(e))||void 0===n||n.activateCard()}getCardFromId(e){for(let t=0;t<this.sceneList.length;t++){const n=this.sceneList[t];if(n.getID()===e)return n}}getActiveCard(){for(let e=0;e<this.sceneList.length;e++){const t=this.sceneList[e];if(t.isCardActive())return t}}displaySceneUpdateButton(){var e;null===(e=this.getActiveCard())||void 0===e||e.showUpdateButton()}hideSceneUpdateButton(){for(let e=0;e<this.sceneList.length;e++)this.sceneList[e].hideUpdateButton()}updateButtonCallback(){}setSceneClickFunction(e){this.sceneClickCallback=e}setSceneRenameFunction(e){this.renameSceneCallback=e}setSceneSelectionFunction(e){this.selectSceneCallback=e}setSceneMoveFunction(e){this.moveSceneCallback=e}setSceneGetSelectedIds(e){this.getSelectedSceneIds=e}setSceneDeleteFunction(e){this.deleteSceneCallback=e}setSceneDuplicateFunction(e){this.duplicateSceneCallback=e}setSceneReplaceFunction(e){this.replaceSceneCallback=e}setCreateBaseSceneFunction(e){this.newSceneButton.addEventListener("buttonclick",e)}setCameraButtonFunction(e){this.captureButton.addEventListener("buttonclick",()=>{e();let t=c.subscribe({event:"VCX_CURRENT_SCENARIO_CHANGED"},e=>{let n=this.getCardFromId(e.GetID());n&&n.getName().focus({preventScroll:!0}),c.unsubscribe(t)})})}activateSceneSelectionMode(){this.getPanelContent().addClassName("vcxSceneSelectionMode")}deactivateSceneSelectionMode(){if(this.getPanelContent().removeClassName("vcxSceneSelectionMode"),this.displayDefaultHeader(),this.getSelectedSceneIds&&this.selectSceneCallback){let e=this.getSelectedSceneIds();for(let t=0;t<e.length;t++){const n=e[t];let i=this.getCardFromId(n);null==i||i.unselectCard()}}}getUICardIndexInSequence(e){let t=-1,n=this.getCardFromId(e);return n&&(t=Array.from(n.getView().getParent().children).indexOf(n.getView())),t}getSequenceView(e){return this.getPanelContent().querySelectorAll('[data-sequence-id="'+e+'"]')[0]}getSequenceIDfromSceneID(e){let t=null,n=this.getCardFromId(e);return n&&(t=n.getView().getParent().getAttribute("data-sequence-id")),t||""}moveSceneView(e,t,n,i){var a;let r=this.getSequenceView(t),o=this.getSequenceView(n),s=null===(a=this.getCardFromId(e))||void 0===a?void 0:a.getView();s&&(r.removeChild(s),o.insertBefore(s,o.children[i]))}setDragDropEvents(){var e,t,n,i,a;null===(e=this.getPanelContent())||void 0===e||e.addEventListener("dragstart",e=>{var t,n;let i=e.target;i.style.opacity="20%",null===(t=e.dataTransfer)||void 0===t||t.clearData(),null===(n=e.dataTransfer)||void 0===n||n.setData("draggedSceneId",i.getAttribute("data-card-id")),this.draggingScene=i,e.dataTransfer&&(e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.dropEffect="move")}),null===(t=this.getPanelContent())||void 0===t||t.addEventListener("dragend",e=>{e.target.style.opacity=""}),null===(n=this.getPanelContent())||void 0===n||n.addEventListener("dragenter",e=>{var t,n;let i=null===(t=this.draggingScene)||void 0===t?void 0:t.getAttribute("data-card-id");if(i){let t=null===(n=this.getCardFromId(i))||void 0===n?void 0:n.getView(),a=e.target.closest(".vcxUICard");if(a&&t){let e=a.getAttribute("data-card-id"),n=this.getSequenceIDfromSceneID(i),r=this.getUICardIndexInSequence(i),o=this.getSequenceIDfromSceneID(e),s=this.getUICardIndexInSequence(e);if(o!==n||i===e)return;let l=a.parentElement;s<r?(l.insertBefore(t,a),this.draggingIndex=this.getUICardIndexInSequence(i)):s>r&&(l.insertBefore(a,t),this.draggingIndex=this.getUICardIndexInSequence(i))}}}),null===(i=this.getPanelContent())||void 0===i||i.addEventListener("dragover",e=>{e.preventDefault()}),null===(a=this.getPanelContent())||void 0===a||a.addEventListener("drop",()=>{if("number"==typeof this.draggingIndex&&this.draggingScene&&this.moveSceneCallback){let e=this.draggingScene.getAttribute("data-card-id");this.moveSceneCallback(e,this.getSequenceIDfromSceneID(e),this.draggingIndex)}this.draggingScene=void 0,this.draggingIndex=void 0})}displayLoading(e){var t;null===(t=this.getCardFromId(e))||void 0===t||t.activateLoading()}hideLoading(e){var t;null===(t=this.getCardFromId(e))||void 0===t||t.deactivateLoading()}}}),define("DS/VCXWebGUI/VCXSceneCtrl",["UWA/Class","DS/CoreEvents/Events","DS/ApplicationFrame/CommandsManager","DS/VCXWebGUI/VCXScenePanelView","DS/VCXWebKernelCommands/VCXCmdGoToScenario","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdChangePropertiesVolatile","DS/VCXWebKernelCommands/VCXCmdChangeScenarioSequence","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebSystem/VCXMathTools","DS/WebappsUtils/WebappsUtils","DS/Tweakers/TypeEnums","DS/VCXKeyFramer/VCXScenario","DS/VCXWebProperties/VCXPropertySet","DS/Visualization/ThreeJS_DS","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","i18n!DS/VCXWebProducts/assets/nls/VCXWebProductAuthoringCommands"],function(e,t,n,i,a,r,o,s,l,c,d,u,p,h,m,g,C,v,_){"use strict";return e.extend({init:function(e,n,a){var r=this;this.currentScenarioID="",this._experienceBase=e._experienceBase,this.playerMode=Boolean(a);let o={title:v["VCXScenarios.PanelTitle"],icon:"camera",immersiveFrame:e.immersiveFrame,currentDockArea:localStorage.getItem("VCXNewFrame")?WUXDockAreaEnum.RightDockArea:void 0,identifier:"scenePanelV2",width:"170px"};this._scenePanelView=new i(o,this._experienceBase.getManager("VCXContextManager").getContext());let s=[{id:"defaultSceneHeader",title:v["VCXScenarios.PanelTitle"],default:!0,commands:[{type:"callback",icon:"select-on",position:"far",callback:()=>{this._scenePanelView.activateSceneSelectionMode(),this._scenePanelView.applyHeader("editScenesHeader")},i18n:v.get("VCXScenarioToolbarExit"),hidden:this.playerMode},{type:"layout",possibleValues:[h.Layout.SmallThumbnail,h.Layout.BigThumbnail,h.Layout.BigTile,h.Layout.List],value:h.Layout.SmallThumbnail,icon:"",commandID:"",i18n:"",hidden:!1}]},{id:"editScenesHeader",title:"",commands:[{type:"callback",icon:"close",position:"near",callback:()=>{this._scenePanelView.deactivateSceneSelectionMode()},i18n:v.get("VCXScenarioToolbarExit"),hidden:this.playerMode},{type:"command",icon:"propagate",commandID:"VCXApplyToSelectedCmd",i18n:_.get("VCXApplyToSelectedCmd"),hidden:this.playerMode},{type:"command",icon:"refresh",commandID:"VCXReplaceScenarioCmd",i18n:_.get("VCXReplaceScenarioCmd"),hidden:this.playerMode},{type:"command",icon:"trash",commandID:"VCXDeleteSceneSelectionCmd",i18n:_.get("VCXDeleteSceneSelectionCmd"),hidden:this.playerMode}]}];this._scenePanelView.generateHeaders(s);this._scenePanelView.setSceneClickFunction((e=>{(this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario()!==e||this._experienceBase.getManager("VCXGUIManager")._sceneNeedsUpdate)&&this._experienceBase.getManager("VCXAPIManager").GoToScenario(e)}).bind(this)),this._scenePanelView.setSceneRenameFunction(this.renameScene.bind(this)),this._scenePanelView.setSceneSelectionFunction(this.changeSceneSelection.bind(this)),this._scenePanelView.setSceneReplaceFunction(this.replaceScene.bind(this)),this._scenePanelView.setSceneDuplicateFunction(this.duplicateScene.bind(this)),this._scenePanelView.setSceneDeleteFunction(this.deleteScene.bind(this)),this._scenePanelView.setSceneGetSelectedIds(this.getSelectedSceneIDs.bind(this)),this._scenePanelView.setCreateBaseSceneFunction(this.createBaseScene.bind(this)),this._scenePanelView.setSceneMoveFunction(this.moveScenarioIndex.bind(this)),this._scenePanelView.setCameraButtonFunction(this.captureInNewSceneCallback.bind(this)),this._scenePanelView.updateButtonCallback=this.updateSceneCallback.bind(this),this.currentViewpoint={angle:-1,eyePos:null,sightDir:null},this._tokenScChanged=t.subscribe({event:"VCX_SCENARIO_CHANGED"},function(e){r.onScenarioChanged(e)}),this._tokenScMoved=t.subscribe({event:"VCX_SCENARIO_MOVED"},e=>{this.onScenarioMoved(e)}),this._tokenCurrentScenario=t.subscribe({event:"VCX_CURRENT_SCENARIO_CHANGED"},function(e){r.onCurrentScenarioChanged(e.GetID(),e)}),this._tokenBeginTrans=t.subscribe({event:"VCX_BEGIN_TRANSITION"},function(e){document.body.addClassName("waiting"),r.onCurrentScenarioChanged(e.scenario._ID,e.scenario),r.hideNeedForUpdate(),r.stopListeningToViewpointChange()}),this._tokenBeginEndTrans=t.subscribe({event:"VCX_END_TRANSITION"},function(e){document.body.removeClassName("waiting"),t.publish({event:"VCX_UPDATE_MATERIALS_ON_CHANGE_SCENE",data:null}),t.publish({event:"VCX_UPDATE_AMBIENCES_ON_CHANGE_SCENE",data:null})}),this._tokenScenarioNameChanged=t.subscribe({event:"VCX_SCENARIO_NAME_CHANGED"},function(e){r.onScenarioNameRefresh(e)}),this._tokenScenarioReplaced=t.subscribe({event:"VCX_SCENARIO_REPLACED"},function(e){r.onScenarioReplaced(e.GetID(),e)}),this._tokenSeqChanged=t.subscribe({event:"VCX_SEQUENCE_CHANGED"},function(e){r.onSequenceChanged(e)}),this._tokenSelectionRemove=t.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},e=>{this.onSelectionRemovedEvent(e)}),this.onResizeCB=function(){}},unInitialize:function(){this._scenePanelView.unInitialize(),t.unsubscribe(this._tokenScChanged),delete this._tokenScChanged,t.unsubscribe(this._tokenScMoved),delete this._tokenScMoved,t.unsubscribe(this._tokenCurrentScenario),delete this._tokenCurrentScenario,t.unsubscribe(this._tokenBeginTrans),delete this._tokenBeginTrans,t.unsubscribe(this._tokenBeginEndTrans),delete this._tokenBeginEndTrans,t.unsubscribe(this._tokenEndTrans),delete this._tokenEndTrans,t.unsubscribe(this._tokenScenarioNameChanged),delete this._tokenScenarioNameChanged,t.unsubscribe(this._tokenSelectionRemove),delete this._tokenSelectionRemove,t.unsubscribe(this._tokenSeqChanged),delete this._tokenSeqChanged,t.unsubscribe(this._tokenScenarioReplaced),delete this._tokenScenarioReplaced,window.attachEvent?(window.detachEvent(this._tokenResize),delete this._tokenResize):window.addEventListener&&(window.removeEventListener("resize",this.onResizeCB,!0),delete this._tokenResize),this.onResizeCB=null,this.stopListeningToViewpointChange()},onScenarioChanged:function(e){e.scenarioToAdd?this.createScenarioView(e.scenarioToAdd,e.sequenceIdForAdd,e.scenarioAddIdx):e.scenarioToRemove&&this.removeScenarioView(e.scenarioToRemove.GetID(),e.sequenceIdForRemove)},createScenarioView:function(e,t,n){let i=e.GetName(),a=e.GetID(),r=e.GetScenarioType();var o=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario()===a;"Animation smg"===e.GetName()?this._scenePanelView.createScenario(a,t,i,-1,p.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_Animation.png"),o):r===m.EScenarioType.CADView||r===m.EScenarioType.CADCapture||r===m.EScenarioType.Layer||(this._scenePanelView.getCardFromId(a)?this.onScenarioReplaced(a,e):(this._scenePanelView.createScenario(a,t,i,n),this.updateScenarioThumbnail(e)))},updateScenarioThumbnail:function(e){let t=this,n=e.GetID(),i=null,a=e.GetDocId(),r=this._experienceBase.getManager("VCXDocManager").GetPropPath(a);if(r){i=r.GetValueURL().GetValue()}if(i){let e=new XMLHttpRequest;e.open("GET",i,!0),e.responseType="blob",e.onload=function(e){if(200==this.status){let e=this.response,i=new FileReader;i.onload=function(e){t._scenePanelView.updateScenario(n,{imageUrl:e.target.result})},i.readAsDataURL(e)}},e.send()}else t._scenePanelView.updateScenario(n,{imageUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNgYAAAAAMAASsJTYQAAAAASUVORK5CYII="})},removeScenarioView:function(e,t){this._scenePanelView.removeScenario(e)},onScenarioNameRefresh:function(e){var t=e.GetID(),n=e.GetName();this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(t);this._scenePanelView.updateScenario(t,{name:n})},onSelectionRemovedEvent:function(e){for(let t=0;t<e.length;t++){const n=e[t];"VCXScenario"===n.GetType()&&this._scenePanelView.deselectScene(n.GetID())}},onScenarioMoved:function(e){this.moveScenarioView(e.scenarioToAdd.GetID(),e.sequenceIdForRemove,e.sequenceIdForAdd,e.scenarioAddIdx)},moveScenarioView:function(e,t,n,i){this._scenePanelView.moveSceneView(e,t,n,i)},onCurrentScenarioChanged:function(e,t){if("VCX_Scenario_Transition"!==e){if(e&&""!==e){var n=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(e);this._experienceBase.getManager("VCXSequenceManager").GetListScenariosInSequence(n);this.currentScenarioID!==e&&(this.currentScenarioID=e,this._scenePanelView.changeCurrentScenario(e))}this.hideNeedForUpdate()}},scrollToThumbnail:function(e){},activateSequence:function(e){this._scenePanelView.activateSequence(e)},onScenarioReplaced:function(e,t){this.onScenarioNameRefresh(t),this.updateScenarioThumbnail(t)},onSequenceChanged:function(e){this.createSequence(e.sequenceToAdd,e.previousSeqIndex)},createSequence:function(e,t){var n=e.GetID(),i=e.GetName();this._scenePanelView.createSequenceView(n,i,p.getWebappsAssetUrl("VCXWebGUI","css/img/VCXSequence.png")),e.GetListScenariosId().every(t=>{let i=e.GetIndexOfScenario(t),a=this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[t];return this.createScenarioView(a,n,i),!0},this)},RefreshAnimIcon:function(e,t){},loadScenariosFromExperience:function(){for(var e=this._experienceBase.getManager("VCXSequenceManager").GetListSequences(),t=0;t<e.length;t++){var n=e[t],i=t-1;this.createSequence(n,i)}},displayNeedForUpdate:function(){this.getLockSceneUpdateDisplay()||this.playerMode||(this._scenePanelView.displaySceneUpdateButton(),this.stopListeningToViewpointChange(),this._experienceBase.getManager("VCXGUIManager")._sceneNeedsUpdate=!0)},hideNeedForUpdate:function(){this.playerMode||this.getLockSceneUpdateDisplay()||(this._scenePanelView.hideSceneUpdateButton(),this._experienceBase.getManager("VCXGUIManager")._sceneNeedsUpdate=!1,this.listenToViewpointChange())},listenToViewpointChange:function(){let e=this._experienceBase.getManager("VCXContextManager").getMainViewer().currentViewpoint;this.currentViewpoint.angle=e.getAngle(),this.currentViewpoint.eyePos=e.getEyePosition(),this.currentViewpoint.sightDir=e.getSightDirection(),this._tokenSceneUpdate||(this._tokenSceneUpdate=t.subscribe({event:"/VISU/"},e=>{e&&e.viewpoint&&"@onViewpointChange"===e.eventType&&this._experienceBase.getManager("VCXContextManager").getMainViewer()===e.viewpoint.viewer&&(this.currentViewpoint.angle!==e.viewpoint.getAngle()||e.viewpoint.getEyePosition().distanceTo(this.currentViewpoint.eyePos)>1e-10||e.viewpoint.getSightDirection().distanceTo(this.currentViewpoint.sightDir)>1e-10)&&this.displayNeedForUpdate()}))},stopListeningToViewpointChange:function(){this._tokenSceneUpdate&&(t.unsubscribe(this._tokenSceneUpdate),delete this._tokenSceneUpdate)},unlockSceneUpdateDisplay:function(){this._lockedSceneUpdateDisplay=!1},lockSceneUpdateDisplay:function(){this._lockedSceneUpdateDisplay=!0},getLockSceneUpdateDisplay:function(){return this._lockedSceneUpdateDisplay},renameScene:function(e,t){var n=new r(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.getManager("VCXCommandManager")),i=this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[e].QueryInterface("VCXIModifiable"),a=i.GetProperty("Actor.Name");a.GetPropertyValue().SetValue(t),n.ChangeProperty(i,a),this._experienceBase.getManager("VCXCommandManager").Push(n)},moveScenarioIndex:function(e,t,n){var i=new s(this._experienceBase.getManager("VCXSequenceManager"),this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap);i.MoveScenario(e,t,n),this._experienceBase.getManager("VCXCommandManager").Push(i)},changeSceneSelection:function(e,t){let n=this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[e],i=new l(this._experienceBase.getManager("VCXSelectionManager"));t?i.AddToSelection(n):i.RemoveFromSelection(n),this._experienceBase.getManager("VCXCommandManager").Do(i)},deleteScene:function(e){this.changeSceneSelection(e,!0);const t=n.getCommand("VCXDeleteSceneSelectionCmd",this._experienceBase.getManager("VCXContextManager").getContext());t&&t.begin()},replaceScene:function(e){this.changeSceneSelection(e,!0);const t=n.getCommand("VCXReplaceScenarioCmd",this._experienceBase.getManager("VCXContextManager").getContext());t&&t.begin(),this.changeSceneSelection(e,!1)},duplicateScene:async function(e){const t=this._experienceBase.getManager("VCXScenarioManager"),n=this._experienceBase.getManager("VCXCommandManager");n.StartTransaction();let i=t.GetCurrentScenario();const r=new a(t,n);r.GoToScenario(e),n.Push(r);await this._experienceBase.getManager("VCXExperience").CreateNewScenario(!1,!1);const o=new a(t,n);o.GoToScenario(i),n.Push(o),n.EndTransaction()},getSelectedSceneIDs:function(){let e=this._experienceBase.getManager("VCXSelectionManager").GetScenariosComponentsFromCurrentSelection(),t=[];for(let n=0;n<e.length;n++){const i=e[n];t.push(i.GetID())}return t},captureInNewSceneCallback:function(){n.getCommand("VCXCreateScenarioCmd",this._experienceBase.getManager("VCXContextManager").getContext()).begin()},updateSceneCallback:function(){const e=n.getCommand("VCXAddCameraKeyCmd",this._experienceBase.getManager("VCXContextManager").getContext());e&&e.begin(),this.hideNeedForUpdate()},createBaseScene:async function(){let e=this._experienceBase.getManager("VCXCommandManager"),t=this._experienceBase.getManager("VCXScenarioManager");e.StartTransaction();let i=await this._experienceBase.getManager("VCXExperience").CreateNewScenario(!1,!1);const r=new a(t,e);r.GoToScenario(i.GetID()),e.Push(r),this._scenePanelView.displayLoading(i.GetID());const s=n.getCommand("VCXHideDressupsCmd",this._experienceBase.getManager("VCXContextManager").getContext());s&&s.begin();let l=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceComposer"),u=new c(t,this._experienceBase.ComponentsMap,e);u.ChangeVisibility(l,d.EVisState.Visible),e.Push(u);let p=this._experienceBase.getManager("VCXSelectionManager");p.setComponentsAsSelection(l,!0);const h=n.getCommand("VCXRestoreNeutralsCmd",this._experienceBase.getManager("VCXContextManager").getContext());h&&h.begin();let m=this._experienceBase.getManager("VCXVisuManager").getActiveViewport(),v=this._experienceBase.getManager("VCXContextManager").getMainViewer(),_=v.getSceneBoundingSphere(),b=_.radius,f=_.center,S=b/Math.tan(Math.PI*v.currentViewpoint.getAngle()/360),V=f.clone().add(new C.Vector3(1,1,1).multiplyScalar(S));v.currentViewpoint.setSightDirection(new C.Vector3(-1,-1,-1)),v.currentViewpoint.setUpDirection(new C.Vector3(0,0,1)),v.currentViewpoint.setSightDirection(new C.Vector3(-1,-1,-1)),v.currentViewpoint.setEyePosition(V);new o(this._experienceBase.getManager("VCXScenarioManager"),e,!0);const y=m&&m.QueryInterface("VCXIViewpointController"),x=(m&&m.QueryInterface("VCXIModifiable"),new g);y.fromViewpoint(x),this.updateSceneCallback(),setTimeout(()=>{this._scenePanelView.hideLoading(i.GetID()),p.removeComponentsFromSelection(l),e.EndTransaction()},2400)},getPanelView:function(){return this._scenePanelView.panel},GetActiveSequenceId:function(){let e=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario(),t=this._experienceBase.getManager("VCXSequenceManager"),n=t.GetSequenceFromScenarioId(e);return n?n.GetID():t.GetListSequences()[0].GetID()}})}),define("DS/VCXWebGUI/VCXAmbienceView",["require","exports","DS/VCXGUIInfrastructure/VCXMainPanel","DS/VCXGUIInfrastructure/VCXMainPanelFixed","DS/VCXWebGUI/VCXAmbienceCard","UWA/Core","DS/VCXGUIInfrastructure/VCXCardTypeEnum"],function(e,t,n,i,a,r,o){"use strict";let s=n;localStorage.getItem("VCXNewFrame")&&(s=i);return class extends s{constructor(e,t){super(e,t),this.ambiencesList=[],this.cardLayout={ratioX:16,ratioY:9,cardWidth:130,descriptionHeight:24},this.subscribe("VCXCardAMBIENCESelected",e=>{let t=e.id;e.checkflag&&(this.activateSelectionMode(),this.applyHeader("editHeader"));let n=this.getCardFromId(t);t&&n&&(e.checkflag?(n.selectCard(),n.selectCallback(t,!1)):(n.unselectCard(),n.unSelectCallback()))})}getCardFromId(e){for(let t=0;t<this.ambiencesList.length;t++){const n=this.ambiencesList[t];if(n.getID()===e)return n}}getCardIndexInList(e){for(let t=0;t<this.ambiencesList.length;t++)if(this.ambiencesList[t].getID()===e)return t;return-1}deleteAmbienceCardFromID(e){const t=this.getCardFromId(e);t&&t.destroy();let n=this.getCardIndexInList(e);n&&n>-1&&this.ambiencesList.splice(n,1)}changeActiveCardFromId(e){for(let t=0;t<this.ambiencesList.length;t++){const n=this.ambiencesList[t];n.isCardActive()&&(null==n||n.deactivateCard()),n.getID()===e&&(null==n||n.activateCard())}}activateSelectionMode(){this.getPanelContent().addClassName("vcxSceneSelectionMode")}deactivateSelectionMode(){this.getPanelContent().removeClassName("vcxSceneSelectionMode");for(let e of this.ambiencesList)null==e||e.unselectCard()}preparePanel(e){this.panelContainer=(0,r.createElement)("div",{class:"materialPanel",html:""});for(let t of e)this.addAmbienceCard(t);this.setPanelContent(this.panelContainer)}unInitialize(){for(let e of this.ambiencesList)e.destroy();super.unInitialize()}addAmbienceCard(e){let t={id:e.id,title:e.name,image:e.image,isInternal:"-1"===e.id,selectableFlag:!0,type:o.AMBIENCE,cardLayout:this.cardLayout},n=new a(t);this.ambiencesList.push(n),n.setOnSelectCardCallback(e.callbackOnSelectCard),n.setOnUnselectCardCallback(e.callbackOnUnselectCard),n.addRenameCardCallback(e.callbackOnRenameCard),this.setContextualMenu(n,e.callbackActivateInAllScenes,e.callbackDelete),n.getThumbnailElement().addEventListener("click",e.callbackClick),n.getView().addClassName("materialCard"),n.getView().inject(this.panelContainer)}updateAmbienceView(e,t){let n=this.getCardFromId(e);n&&t.name&&(n.getLabel().innerHTML=t.name)}setContextualMenu(e,t,n){e.customizeMenu([{icon:"parameters",considerStateDefault:!0,action:()=>{e.selectCallback(e.getID(),!0)},label:"Show properties"},{icon:"picture-360",action:()=>{t(),this.ambiencesList.forEach(e=>e.deactivateCard()),e.activateCard()},label:"Activate in all scenes"},{icon:"trash",considerStateDefault:!0,action:()=>{n()},label:"Delete ambience"},{icon:"rename",considerStateDefault:!0,action:()=>{console.log("rename"),e.getLabel().focus()},label:"Rename"}])}}}),define("DS/VCXWebGUI/VCXAmbienceCtrl",["UWA/Class","DS/VCXWebGUI/VCXAmbienceView","DS/WebappsUtils/WebappsUtils","DS/VCXWebPlatform/VCXPlatformServices","DS/VCXWebPlatform/VCX3DSpaceServices","DS/VCXWebPlatform/VCXSearchServices","DS/VCXWebKernelCommands/VCXCmdChangeKeys","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdRequestChangeProperties","DS/VCXWebKernelCommands/VCXCmdApplyTo","DS/VCXWebKernel/VCXCmdChangeSelection","DS/CoreEvents/Events","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],function(e,t,n,i,a,r,o,s,l,c,d,u,p,h){"use strict";return e.extend({init:function(e){this._vcxGuiManager=e,this._experienceBase=e._experienceBase,this._ambiencesDescription={},this._events={},this._selectedAmbiences=[],this._defaultAmbience={PID:"-1",name:h["Ambience.DefaultAmbience"],title:h["Ambience.DefaultAmbience"],type:"Ambience Environnement",typeNLS:"Ambience Environnement",image:n.getWebappsAssetUrl("VCXWebGUI","ambiences/AmbianceThumbnail_01.jpg"),id:"",ambienceObject:[]},this._ambiencesDescription[-1]=this._defaultAmbience;let r={title:h["VCXAmbienceCtrl.Title"],icon:"picture-360",immersiveFrame:e.immersiveFrame,identifier:"VCXAmbiencePanel",currentDockArea:localStorage.getItem("VCXNewFrame")?WUXDockAreaEnum.LeftDockArea:void 0};this._viewPanel=new t(r,this._experienceBase.getManager("VCXContextManager"));let o=[{id:"defaultMaterialHeader",title:"Ambiences",default:!0,commands:[{type:"callback",icon:"select-on",position:"far",i18n:h["VCXAmbienceCtrl.ActivateMultiSelectionMode"],callback:()=>{this._viewPanel.activateSelectionMode(),this._viewPanel.applyHeader("editHeader")}},{type:"callback",icon:"plus",position:"far",i18n:h["VCXAmbienceCtrl.InsertNewAmbience"],callback:async()=>{await this.onInsertNewAmbience()}}]},{id:"editHeader",title:"",commands:[{type:"callback",icon:"close",position:"near",callback:()=>{this._viewPanel.deactivateSelectionMode(),this._viewPanel.displayDefaultHeader()},i18n:h["VCXAmbienceCtrl.ExitMultiSelectionMode"],hidden:!1},{type:"callback",icon:"trash",i18n:h["VCXAmbienceCtrl.DeleteAmbiences"],callback:async()=>{await this.onDeleteAmbienceEditMode()},hidden:!1}]}];this._viewPanel.generateHeaders(o),this._events._tokenOnUpdateAmbiencesChangeScenes=p.subscribe({event:"VCX_UPDATE_AMBIENCES_ON_CHANGE_SCENE"},async e=>{const t=this._experienceBase.getManager("VCXVisuManager").getActiveViewport().QueryInterface("VCXIModifiable").GetProperty("Viewport.ActiveAmbience").GetPropertyValue().GetValue();let n,i;if(t){let e=(n=this._experienceBase.ComponentsMap.GetComponentFromID(t)).QueryInterface("CATI3DXAssetHolder");if(e){let t=e._asset;t&&t.hasOwnProperty("_physicalId")||await e._resolveAsset()}i=e._asset._physicalId}else i=(n=this._defaultAmbience).PID;this._viewPanel.changeActiveCardFromId(i)}),this._events._tokenOnLoadAmbiences=p.subscribe({event:"VCX_AMBIENCE_LOADED"},async e=>{const t=this._experienceBase.ComponentsMap.GetComponentFromType("AmbienceModel_Spec");for(let e of t){const t=await a.Get3DSpaceURL();let n=e.QueryInterface("CATI3DXAssetHolder");if(n){let a,r=n._asset;if(r&&r.hasOwnProperty("_physicalId")||await n._resolveAsset(),a=n._asset._physicalId)if(this._ambiencesDescription.hasOwnProperty(a))this._ambiencesDescription[a].ambienceObject.push(e);else{let n=t&&await i.getObjectInfo(a,t);this.addNewAmbienceFromObjectInfo(a,n,e)}}}this.createViewPanel()}),this._events._tokenOnInsertAmbience=p.subscribe({event:"VCX_AMBIENCE_INSERT"},async e=>{if(e.hasOwnProperty("PID")){if(this._ambiencesDescription.hasOwnProperty(e.PID))this._ambiencesDescription[e.PID].ambienceObject.push(e.ambienceObject);else{const t=await a.Get3DSpaceURL();let n=t&&await i.getObjectInfo(e.PID,t),r=this.addNewAmbienceFromObjectInfo(e.PID,n,e.ambienceObject);this.addNewAmbienceToViewPanel(r)}this._viewPanel.changeActiveCardFromId(e.PID),this.changeSelectionCardAmbience(e.PID,!0,!0)}}),this._events._tokenOnPropertiesChanged=p.subscribe({event:"VCX_PROPERTIES_CHANGED"},async e=>{if(e){let t=this._experienceBase.getManager("VCXScenarioManager").ModifiableServer,n=[];e.GetListModifiables&&e.GetListModifiables(n);for(let i=0;i<n.length;i++){const a=n[i];let r=e.GetPropertySet(a).GetProperty("Actor.Name");if(r){let e=t.GetModifiableFromHashing(a);if("AmbienceModel_Spec"===e.GetObject().GetType()){let t=e.GetObject().QueryInterface("CATI3DXAssetProperties")&&await e.GetObject().QueryInterface("CATI3DXAssetProperties").getPhysicalId();if(t){let e=r.GetPropertyValue().GetValue();this.updateAmbience(t,{name:e})}}}}}})},onDeleteAmbienceContextualMenu:async function(e){await this.onDeleteAmbience(e)},onDeleteAmbienceEditMode:async function(){let e=[...this._selectedAmbiences];for(let t of e)this.onUnselectCardAmbience(t),await this.onDeleteAmbience(t)},onDeleteAmbience:async function(e){if(-1===e)return;const t=this._experienceBase.getManager("VCXScenarioManager"),n=new s(t),i=new o(t);if(this._ambiencesDescription.hasOwnProperty(e)){let a=this._ambiencesDescription[e];if(a.ambienceObject&&a.ambienceObject.length)for(let r of a.ambienceObject){let o=r.GetID(),s=0,l=0;t.SearchAllValuesForOneProperty("Viewport.ActiveAmbience",o,e=>{let t=e.modifiable.GetProperty("Viewport.ActiveAmbience").GetPropertyValue().Clone();t.SetValue(""),e&&"Neutrals"===e.type&&(n.ChangeProperty(e.modifiable,"Viewport.ActiveAmbience",t),s++),e&&"Track"===e.type&&(i.ChangeKey(e.Scenario,e.modifiable,"Viewport.ActiveAmbience",e.Frame,t,e.Easing),l++)}),s&&this._experienceBase.getManager("VCXCommandManager").Push(n),l&&this._experienceBase.getManager("VCXCommandManager").Push(i),await this._experienceBase.getManager("VCXCAT3DXModelManager").DeleteAmbience(a,r),delete this._ambiencesDescription[e],this._viewPanel.deleteAmbienceCardFromID(e),this._viewPanel.changeActiveCardFromId("-1"),await this._experienceBase.getManager("VCXVisuManager").activateDefaultAmbience("")}}},onInsertNewAmbience:async function(){const e=await r.SearchInApp("[ds6w:type]:AmbienceEnvironment",void 0);e&&e.id&&e.label&&await this._experienceBase.getManager("VCXCAT3DXModelManager").InsertAmbience(e.label,null,e.id)},activateAmbienceInCurrentScene:async function(e){let t=null;var n=new c(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.getManager("VCXCommandManager"));if("-1"===e)t="";else if(this._ambiencesDescription.hasOwnProperty(e)){let n=this._ambiencesDescription[e];n&&n.ambienceObject&&n.ambienceObject.length&&(t=n.ambienceObject[0].GetID())}if(null!==t){const i=this._experienceBase.getManager("VCXVisuManager").getActiveViewport().QueryInterface("VCXIModifiable");let a=i.GetProperty("Viewport.ActiveAmbience").GetPropertyValue().Clone();a.SetValue(t),await n.RequestModification([i],"Viewport.ActiveAmbience",a),this._experienceBase.getManager("VCXCommandManager").Push(n),this._viewPanel.changeActiveCardFromId(e),this.changeSelectionCardAmbience(e,!0,!0)}},changeSelectionCardAmbience:function(e,t,n){let i;const a=new u(this._experienceBase.getManager("VCXSelectionManager"));if(e&&"-1"!==e){let r=this._ambiencesDescription[e];if(r&&r.ambienceObject&&r.ambienceObject.length&&(i=r.ambienceObject[0])){if(t)n?(a.SetSelection(i),this._selectedAmbiences.push(e)):(a.AddToSelection(i),this._selectedAmbiences.push(e));else{a.RemoveFromSelection(i);let t=this._selectedAmbiences.indexOf(e);t>=0&&this._selectedAmbiences.splice(t,1),this._selectedAmbiences.length||(this._viewPanel.deactivateSelectionMode(),this._viewPanel.displayDefaultHeader())}this._experienceBase.getManager("VCXCommandManager").Do(a)}}else"-1"===e&&(a.SetSelection(),this._experienceBase.getManager("VCXCommandManager").Do(a))},onSelectCardAmbience:function(e,t){this.changeSelectionCardAmbience(e,!0,t)},onUnselectCardAmbience:function(e){this.changeSelectionCardAmbience(e,!1)},addNewAmbienceToViewPanel:function(e){e&&this._viewPanel.addAmbienceCard({id:e.PID,name:e.title,image:e.image,callbackActivateInAllScenes:this.onCallbackActivateInAllScenes.bind(this,e.PID),callbackReplace:()=>console.warn("Replace ambience not yet implemented !"),callbackOnSelectCard:this.onSelectCardAmbience.bind(this),callbackOnRenameCard:this.onRenameCard.bind(this),callbackOnUnselectCard:this.onUnselectCardAmbience.bind(this,e.PID),callbackDelete:this.onDeleteAmbienceContextualMenu.bind(this,e.PID),callbackClick:this.activateAmbienceInCurrentScene.bind(this,e.PID)})},addNewAmbienceFromObjectInfo:function(e,t,i){let a={};if(a.PID=e,t.hasOwnProperty("type")&&(a.type=t.type),t.hasOwnProperty("dataelements")){const e=t.dataelements;e.hasOwnProperty("typeNLS")&&(a.typeNLS=e.typeNLS),e.hasOwnProperty("name")&&(a.name=e.name),a.title=i.QueryInterface("VCXIModifiable").GetProperty("Actor.Name").GetPropertyValue().GetValue(),e.hasOwnProperty("image")&&(e.image.includes("enovia")?a.image=n.getWebappsAssetUrl("VCXWebGUI","ambiences/Thumbnail_vide_ambience_v4.png"):a.image=e.image)}return a.ambienceObject=[],i&&a.ambienceObject.push(i),this._ambiencesDescription[e]=a,a},getAmbiencesDetails:function(){return this._ambiencesDescription},onCallbackActivateInAllScenes:async function(e){this.activateAmbienceInCurrentScene(e);const t=this._experienceBase.getManager("VCXCommandManager");let n={};let i=[];const a=this._experienceBase.getManager("VCXScenarioManager").GetScenarios();for(let e in a)a.hasOwnProperty(e)&&i.push(a[e]);let r=[this._experienceBase.getManager("VCXVisuManager").getActiveViewport()];n.availability=!0,n.scenario=i,n.dressups=r,n.parts=[],n.propagateCamera=!1,n.propagateViewport=!0;const o=new d(this._experienceBase,n,"all");await t.Push(o)},createViewPanel:async function(){let e=[];for(let t in this._ambiencesDescription)this._ambiencesDescription.hasOwnProperty(t)&&e.push({id:t,name:this._ambiencesDescription[t].title,image:this._ambiencesDescription[t].image,callbackActivateInAllScenes:this.onCallbackActivateInAllScenes.bind(this,t),callbackOnSelectCard:this.onSelectCardAmbience.bind(this),callbackOnUnselectCard:this.onUnselectCardAmbience.bind(this,t),callbackOnRenameCard:this.onRenameCard.bind(this),callbackReplace:()=>console.warn("Replace ambience not yet implemented !"),callbackDelete:this.onDeleteAmbienceContextualMenu.bind(this,t),callbackClick:this.activateAmbienceInCurrentScene.bind(this,t)});this._viewPanel.preparePanel(e);const t=this._experienceBase.getManager("VCXVisuManager").getActiveViewport();if(!t)return;const n=t.QueryInterface("VCXIModifiable").GetProperty("Viewport.ActiveAmbience").GetPropertyValue().GetValue();if(n){let e=this._experienceBase.ComponentsMap.GetComponentFromID(n).QueryInterface("CATI3DXAssetHolder");if(e){let t,n=e._asset;n&&n.hasOwnProperty("_physicalId")||await e._resolveAsset(),t=e._asset._physicalId,this._viewPanel.changeActiveCardFromId(t)}}else this._viewPanel.changeActiveCardFromId("-1")},updateAmbience:function(e,t){t.name&&(this._ambiencesDescription[e].title=t.name),this._viewPanel.updateAmbienceView(e,t)},onRenameCard:function(e,t){var n=new l(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.getManager("VCXCommandManager"));let i;if(this._ambiencesDescription[e]&&this._ambiencesDescription[e].ambienceObject&&this._ambiencesDescription[e].ambienceObject[0]){var a=(i=this._ambiencesDescription[e].ambienceObject[0].QueryInterface("VCXIModifiable")).GetProperty("Actor.Name");a.GetPropertyValue().SetValue(t),n.ChangeProperty(i,a),this._experienceBase.getManager("VCXCommandManager").Push(n)}else console.error("No ambience found for rename")},unInitialize:function(){this._viewPanel.unInitialize(),this._viewPanel=null;for(let e in this._events)this._events.hasOwnProperty(e)&&p.unsubscribe(this._events[e])}})}),define("DS/VCXWebGUI/VCXPropertiesPanelModel",["UWA/Class","DS/VCXWebGUI/VCXHyperlinkBoxing","DS/VCXWebGUI/VCXFontBoxing","DS/VCXWebGUI/VCXFrameBoxing"],function(e,t,n,i){"use strict";return e.extend({init:function(e){this._experienceBase=e,this._defaultCollapsedGroupsPerObjectType={},this._hyperlinkBoxing=new t,this._hyperlinkBoxing.initialize(this._experienceBase),this._fontBoxing=new n,this._frameBoxing=new i,this._currentPanelInfos=null},unInitialize:function(){this._hyperlinkBoxing&&(this._hyperlinkBoxing.unInitialize(),this._hyperlinkBoxing=null),this._fontBoxing&&(this._fontBoxing=null),this._frameBoxing&&(this._frameBoxing=null),this._experienceBase=null,this._defaultCollapsedGroupsPerObjectType=null,this._currentPanelInfos=null},getMainPropNameFromBoxedPropName:function(e){return e.replace(/(\_\w+$)/,"")},getNewValueFromBoxedProperty:function(e,t,n,i){var a=this["_"+e+"Boxing"];if(a.UpdateMapForGUI&&a.BuildNewValueFromGUI){this.getMainPropNameFromBoxedPropName(i.propName)||console.log("Issue computing mainPropName from boxedProperty name");var r=this.getUnboxedPropertiesForGUI(e,t,n),o=a.UpdateMapForGUI(r,i);return a.BuildNewValueFromGUI(o)}},getUnboxedPropertiesForGUI:function(e,t,n,i){return"hyperlink"===e?this._hyperlinkBoxing.GetPropertiesForGUI(t,n):"font"===e?this._fontBoxing.GetPropertiesForGUI(t,n,i):"frame"===e?this._frameBoxing.GetPropertiesForGUI(t,n,i):void 0},getUnboxedPropertiesNLS:function(e,t){return"hyperlink"===e?this._hyperlinkBoxing.getPropertiesNamesNLS&&this._hyperlinkBoxing.getPropertiesNamesNLS(t):"font"===e?this._fontBoxing.getPropertiesNamesNLS&&this._fontBoxing.getPropertiesNamesNLS(t):"frame"===e?this._frameBoxing.getPropertiesNamesNLS&&this._frameBoxing.getPropertiesNamesNLS(t):void 0},setPanelState:function(e,t,n){this._currentPanelInfos.propSet=e,t&&(this._currentPanelInfos.arraySelection=t),n&&(this._currentPanelInfos.additionalPropertySettings=n)},getSavedPanelState:function(){return this._currentPanelInfos},resetSavedPanelStateIfNeeded:function(e){var t=!0;if(this._currentPanelInfos&&this._currentPanelInfos.arraySelection&&e.length===this._currentPanelInfos.arraySelection.length){for(var n=0;n<e.length;++n){var i=e[n];if(!this._currentPanelInfos.arraySelection.includes(i))break}n===e.length&&(t=!1)}t&&this.resetSavedPanelState()},resetSavedPanelState:function(){this._currentPanelInfos={propSet:null,arraySelection:null}},isCollapsedGroupsSavedForComponent:function(e){return Boolean(this._defaultCollapsedGroupsPerObjectType[e])},getCollapsedGroupsForComponents:function(e){if(!e)return[];var t=e;if(Array.isArray(t)||(t=[e]),1===t.length)return this._defaultCollapsedGroupsPerObjectType[t[0]]||[];for(var n=[],i=[],a=-1,r=null,o=0;o<e.length;++o){var s=e[o];this._defaultCollapsedGroupsPerObjectType[s]?(i.push(this._defaultCollapsedGroupsPerObjectType[s]),("number"!=typeof r||r>this._defaultCollapsedGroupsPerObjectType[s].length)&&(r=this._defaultCollapsedGroupsPerObjectType[s].length,a=i.length-1)):console.warn("Couldn't find a saved list of collapsed groups for display on property panel for component "+s+".")}if(1===i.length)n=i[0];else if(0!==i.length)for(var l=i.splice(a,1)[0].slice(0);0!==l.length;){var c=l.pop();!l.includes(c)&&i.every(function(e){return e.includes(c)})&&n.push(c)}return n},setCollapsedGroupsForComponent:function(e,t){this._defaultCollapsedGroupsPerObjectType[e]=t},addCollapsedGroupForComponent:function(e,t){this._modifyCollapsedGroupForComponent(e,t,!0)},removeCollapsedGroupForComponent:function(e,t){this._modifyCollapsedGroupForComponent(e,t,!1)},_modifyCollapsedGroupForComponent:function(e,t,n){if(this._defaultCollapsedGroupsPerObjectType[e]){var i=this._defaultCollapsedGroupsPerObjectType[e].indexOf(t);n?-1===i&&this._defaultCollapsedGroupsPerObjectType[e].push(t):-1!==i&&this._defaultCollapsedGroupsPerObjectType[e].splice(i,1)}else{if(!n)return;this._defaultCollapsedGroupsPerObjectType[e]=[t]}},addCollapsedGroupForComponents:function(e,t){this._modifyCollapsedGroupForComponents(e,t,!0)},removeCollapsedGroupForComponents:function(e,t){this._modifyCollapsedGroupForComponents(e,t,!1)},_modifyCollapsedGroupForComponents:function(e,t,n){if(Array.isArray(e))for(var i=0;i<e.length;++i){var a=e[i];n?this.addCollapsedGroupForComponent(a,t):this.removeCollapsedGroupForComponent(a,t)}}})}),define("DS/VCXWebGUI/VCXPropertiesCtrlExt",["UWA/Class","DS/ApplicationFrame/CommandsManager","DS/Controls/Button","DS/CoreEvents/Events","DS/Tweakers/TweakerBlob","DS/Tweakers/TweakerBoolean","DS/Tweakers/TweakerColor","DS/Tweakers/TweakerDate","DS/Tweakers/TweakerNumber","DS/Tweakers/TweakerString","DS/Tweakers/TweakerVector","DS/Utilities/Array","DS/Utilities/Utils","DS/WebappsUtils/WebappsUtils","DS/VCXWebExperienceLoader/VCXExperienceSaverBase","DS/VCXGUIInfrastructure/VCXTabPageFrame","DS/VCXWebGUI/VCXPropertiesPanelModel","DS/VCXWebGUI/VCXPropertiesPanelView","DS/VCXWebGUI/VCXPropertiesPanelViewV2","DS/VCXWebIO/VCXFileServices","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdRequestChangeProperties","DS/VCXWebSystem/VCXObjectTools","DS/VCXWebModifiablesServices/VCXModifiablesChangeServices","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyGroup","DS/VCXWebProperties/VCXPropertyGroupSet","DS/VCXWebProperties/VCXPropertyValueDate","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueLink","DS/VCXWebPlatform/VCXPlatformServices","DS/VCXWebPlatform/VCX3DSpaceServices","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables","i18n!DS/VCXWebProducts/assets/nls/VCXWebProductAuthoringCommands"],function(e,t,n,i,a,r,o,s,l,c,d,u,p,h,m,g,C,v,_,b,f,S,V,y,x,P,I,M,w,D,X,T,A,E,G,B,k,N,U,F){"use strict";var W="vcx-properties-group-propsContainer",O="vcx-propNode-prop",L="vcx-propNode-label",R="vcx-propNode-prop-tweakers",H="vcx-button-propertiesLinked",q=e.extend({init:function(e,t){q.PlayerMode=Boolean(t),this._vcxGuiManager=e,this._propertiesPanelModel=new C(this._vcxGuiManager._experienceBase),this._cmdApplyRequestChangeProperty=new V(this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager"),this._vcxGuiManager._experienceBase.getManager("VCXCommandManager")),this._cmdSimulateRequestChangeProperty=new V(this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager"),this._vcxGuiManager._experienceBase.getManager("VCXCommandManager"));var n=this._vcxGuiManager.immersiveFrame;if(n||(n=this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getFrameWindow().getImmersiveFrame()),this._propertiesPanelViewV2=new _(n,this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getContext()),this._selectedPropsArray=[],this._disableLinkedProperties=!1,this._listTweakersWithPtrUpEvt=null,this._listButtonsLockToUnsubscribe=null,this._tokenSelectionAdd=i.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},e=>{e.includes(this._vcxGuiManager._experienceBase.ComponentsMap.GetComponentFromID("ViewpointID"))&&(this._viewportInSelection=!0),this.requestRefresh(!1)}),this._tokenSelectionRemove=i.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},e=>{e.includes(this._vcxGuiManager._experienceBase.ComponentsMap.GetComponentFromID("ViewpointID"))&&(this._viewportInSelection=!1),this.requestRefresh(!1)}),this._tokenPropertiesChanged=i.subscribe({event:"VCX_PROPERTIES_CHANGED"},()=>{this.onPropertiesChanged()}),this._tokenTimePosChanged=i.subscribe({event:"VCX_TIMEPOS_CHANGED"},()=>{this.requestRefresh(!1)}),this._textureUploadPlaceHolder="",this._imageUploadPlaceHolder="",this._textureUploadPlaceHolder=N.get("VCXProperties.TextureUploadPlaceHolder"),this._imageUploadPlaceHolder=N.get("VCXProperties.ImageUploadPlaceHolder"),!q.PlayerMode){var a="1"==this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getUrlVars().linkedProperties,r="1"==this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getUrlVars().stylestree;this._propertiesPanelView&&this._propertiesPanelView.createToolbarCommands(a,r)}this._onShowTweakerCB=this._onShowTweaker.bind(this),this._onHideTweakerCB=this._onHideTweaker.bind(this),this._onCancelEditCB=this._onCancelEdit.bind(this),this._onPreEditCB=this._onPreEdit.bind(this),this._onPostEditCB=this._onPostEdit.bind(this),this._onLiveChangeCB=this._onLiveChange.bind(this),this._onChangeCB=this._onChange.bind(this),this._onNodeModelUpdateCB=this._onNodeModelUpdate.bind(this),this._onButtonClickCB=this._onButtonClick.bind(this),this._onExpandCB=this._onExpand.bind(this),this._onCollapseCB=this._onCollapse.bind(this),this._propertiesPanelView&&(this._propertiesPanelView.subscribeTweakerEvt("show",this._onShowTweakerCB),this._propertiesPanelView.subscribeTweakerEvt("hide",this._onHideTweakerCB),this._propertiesPanelView.subscribeTweakerEvt("cancelEdit",this._onCancelEditCB),this._propertiesPanelView.subscribeTweakerEvt("preEdit",this._onPreEditCB),this._propertiesPanelView.subscribeTweakerEvt("liveChange",this._onLiveChangeCB),this._propertiesPanelView.subscribeTweakerEvt("change",this._onChangeCB),this._propertiesPanelView.subscribeTweakerEvt("postEdit",this._onPostEditCB),this._propertiesPanelView.subscribeTweakerEvt("buttonclick",this._onButtonClickCB)),this._propertiesPanelViewV2.subscribeTweakerEvent("change",this._onChangeCB),this._propertiesPanelViewV2.subscribeTweakerEvent("liveChange",this._onLiveChangeCB),this._propertiesPanelViewV2.subscribeTweakerEvent("cancelEdit",this._onCancelEditCB),this._propertiesPanelViewV2.subscribeTweakerEvent("preEdit",this._onPreEditCB),this._propertiesPanelViewV2.subscribeTweakerEvent("postEdit",this._onPostEditCB),this._propertiesPanelViewV2.subscribeTweakerEvent("buttonclick",this._onButtonClickCB),this._propertiesPanelViewV2._expanderExpandCB=this._onExpandCB,this._propertiesPanelViewV2._expanderCollapseCB=this._onCollapseCB,this._propertiesPanelViewV2.restoreFunction=this.restoreProperties.bind(this),this._propertiesPanelViewV2.goToParentFunction=this.navigateToParent.bind(this),this._propertiesPanelViewV2.executeHeaderCommand=this.executeHeaderCommand.bind(this),this._propertiesPanelViewV2.clearFunction=this.clearProperties.bind(this);let o=[{id:"defaultPropHeader",title:"Properties",default:!0,commands:[{type:"command",icon:"reset",commandID:"VCXRestoreNeutralsCmd",i18n:F.get("VCXRestoreNeutralsCmd"),hidden:q.PlayerMode},{type:"command",icon:"floppy",commandID:"VCXCaptureInNeutralsCmd",i18n:F.get("VCXCaptureInNeutralsCmd"),hidden:q.PlayerMode}],specialButtons:[{type:"clickDblClick",icon:"brush-large",commandIDClick:"VCXSingleFormatPainterCmd",commandIDDlbClick:"VCXMultipleFormatPainterCmd",i18n:F.get("VCXFormatPainterCmd"),hidden:!0}]}];this._propertiesPanelViewV2.generateHeaders(o),this._lastSelection=[],this._changeInLocks=!1,this._preventRefresh=!1},requestRefresh:function(e){this._refreshRequested=e?2:1,this._refreshMaxinterval=500},update:function(e){(2===this._refreshRequested&&(this.requestChangeInPanel(),this._refreshRequested=0),1===this._refreshRequested&&(this._refreshMaxinterval<=0&&(this.requestChangeInPanel(),this._refreshRequested=0),this._refreshMaxinterval-=e.deltaTime),this._viewportInSelection)&&(this._vcxGuiManager._experienceBase.getManager("VCXVisuManager").viewpointHasMoved&&this.requestRefresh(!1))},_onNodeModelUpdate:async function(e,t,n){if(!(e&&e.dsModel&&e.dsModel.internalOptions))return;var i=e.dsModel;i.propName=e.dsModel.internalOptions.propName,(this.modifyWhile||this._currentlyEditing)&&(i.std=i.value||void 0!==i.checkFlag&&i.checkFlag);var a={};this._vcxGuiManager._experienceBase;this.getCID4Property(i,a,e);var r=a.vcxValue,o=a.propertyName;if(this._currentLiveChangeIndex||(this._currentLiveChangeIndex=1),this._currentLiveChangeIndex++,"VCXPropertyValueColor"===i.dataType){let e=u.GetProperty(o).GetPropertyValue();if(!e)return;var s=e.GetPropertyValue().ToString(),l=r;if(l.substr(0,l.lastIndexOf(","))===s.substr(0,s.lastIndexOf(",")))return}for(var c=this._lastSelection.map(e=>e.QueryInterface("VCXIModifiable")),d=0;d<c.length;d++){var u=c[d];if(-1!==o.search("Hyperlink_")){o="Actor.Hyperlink";let e=u.GetProperty(o).GetPropertyValue(),t=u.GetProperty(o).GetPropertyInfo();r=this._propertiesPanelModel.getNewValueFromBoxedProperty("hyperlink",e,t,i).GetValue(),this._propertiesPanelModel.resetSavedPanelState()}else if(-1!==o.search("Text.Font")){o="Collab.Text.Font";let e=u.GetProperty(o).GetPropertyValue(),t=u.GetProperty(o).GetPropertyInfo();r=this._propertiesPanelModel.getNewValueFromBoxedProperty("font",e,t,i)}else if(-1!=o.search("_Position")||-1!=o.search("_Orientation")||-1!=o.search("_Scale")||-1!=o.search("_Pivot")){(o=o.replace(/(\_\w+$)/,""))||console.log("Issue computing mainPropName from boxedProperty name");let e=u.GetProperty(o).GetPropertyValue(),t=u.GetProperty(o).GetPropertyInfo();r=this._propertiesPanelModel.getNewValueFromBoxedProperty("frame",e,t,i)}}let p;if(t){p=(await this._cmdSimulateRequestChangeProperty.RequestModification(c,o,null,r)).Clone()}else{p=(await this._cmdApplyRequestChangeProperty.RequestModification(c,o,null,r)).Clone()}this.applyOrSimulate(t)},applyOrSimulate:function(e){if(!e){var t=new S(this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager"),this._vcxGuiManager._experienceBase.getManager("VCXCommandManager"));if(this.modifyWhile&&(this._preventRefresh=!0),this._vcxGuiManager._experienceBase.getManager("VCXCommandManager").Push(this._cmdApplyRequestChangeProperty),this._cmdApplyRequestChangeProperty=new V(this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager"),this._vcxGuiManager._experienceBase.getManager("VCXCommandManager")),void 0!==this._vcxGuiManager._experienceBase.odt){let e=(new m)._PropMapToJson(this._vcxGuiManager._experienceBase,t._propertyMap);console.log(e),this._vcxGuiManager._experienceBase.getManager("VCXAPIManager").ChangeProperties(e)}if(!this.modifyWhile){this._canceledEdit&&("Transaction: Canceled edit Properties via Panel",this._canceledEdit=!1)}}},_getNewPropFromNewValue:function(e,t,n){var i=!1,a=e.GetProperty(t);!0===a.GetPropertyValue()._bUndefined&&(n===a.GetPropertyValue().ToString()&&(i=!0));var r=null;i||(r=a.Clone()).GetPropertyValue().FromString(n);return r},unInitialize:function(){i.unsubscribe(this._tokenSelectionAdd),delete this._tokenSelectionAdd,i.unsubscribe(this._tokenSelectionRemove),delete this._tokenSelectionRemove,i.unsubscribe(this._tokenTimePosChanged),delete this._tokenTimePosChanged,i.unsubscribe(this._tokenPropertiesChanged),delete this._tokenPropertiesChanged,this._onPreEditCB=null,this._onPostEditCB=null,this._onLiveChangeCB=null,this._onChangeCB=null,this._onNodeModelUpdateCB=null,this._onButtonClickCB=null,this._propertiesPanelModel&&(this._propertiesPanelModel.unInitialize&&this._propertiesPanelModel.unInitialize(),this._propertiesPanelModel=null),this._propertiesPanelView&&(this._propertiesPanelView.unInitialize&&(this._propertiesPanelView.unsubscribeTweakerEvt("show",this._onShowTweakerCB),this._propertiesPanelView.unsubscribeTweakerEvt("hide",this._onHideTweakerCB),this._propertiesPanelView.unsubscribeTweakerEvt("cancelEdit",this._onCancelEditCB),this._propertiesPanelView.unsubscribeTweakerEvt("preEdit",this._onPreEditCB),this._propertiesPanelView.unsubscribeTweakerEvt("liveChange",this._onLiveChangeCB),this._propertiesPanelView.unsubscribeTweakerEvt("change",this._onChangeCB),this._propertiesPanelView.unsubscribeTweakerEvt("postEdit",this._onPostEditCB),this._propertiesPanelView.unsubscribeTweakerEvt("buttonclick",this._onButtonClickCB),this._propertiesPanelView.unInitialize()),this._propertiesPanelView=null),this._propertiesPanelViewV2&&(this._selectedPropsArray=null,this._propertiesPanelViewV2.unInitialize&&this._propertiesPanelViewV2.unInitialize(),this._propertiesPanelViewV2=null),delete q.PlayerMode,this.options&&delete this.options,this._vcxGuiManager&&delete this._vcxGuiManager},getCID4Property:function(e,t,n){if(t.propertyName=e.propName,t.vcxValue=e.value+"",e.propName.endsWith(".Availability"))t.vcxValue=e.value?3:4;else if("tweakerEnum"===e.name||"TweakerString"===e.name&&("combo"===e.displayStyle||"buttonGroup"===e.displayStyle)){var i=e.value,a={},r=this._lastSelection[0].QueryInterface("VCXIModifiable").GetProperty(t.propertyName);if(r){var o=r.GetPropertyInfo();a=e.internalOptions&&e.internalOptions.mapChoiceEnum?e.internalOptions.mapChoiceEnum:o.GetMapChoiceEnum()}for(var s in a)if(a.hasOwnProperty(s)){var l=a[s],c=l,d=c;if("1"!=this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getUrlVars().noNLS){let e=o.Geti18n();if(e&&(d=e[c]),void 0===d)this._vcxGuiManager._experienceBase.getManager("VCXStylesManager")&&(d=U[c]);void 0===d&&(d=c)}if(d===i){t.vcxValue=s;break}if(l===i){t.vcxValue=s;break}}}else if("tweakerBlob"===e.name){var u="";n&&(u=n.target.dsModel._blobName);var p=b.dataURLToBlob(t.vcxValue),h=window.URL.createObjectURL(p),m=this._vcxGuiManager._experienceBase.getManager("VCXDocManager").BuildPathFromString(h),g=new E;g.SetValue(u),m.SetFileName(g);var C=this._vcxGuiManager._experienceBase.getManager("VCXDocManager").AddOrModifyDoc(m);t.vcxValue=C.GetValue()+""}else if("TweakerColor"===e.name){var v="#"+t.vcxValue,_=new T;_.GetValue().FromHexString(v);var f=_.ToString();t.vcxValue=f}else if("TweakerVector"===e.name)t.vcxValue="["+t.vcxValue+"]";else if("TweakerString"===e.name)if(e.propName.includes("StipplingMotif")&&e.value.length>0)if(e.value===""+parseFloat(e.value))t.vcxValue=e.value;else{var S=e.value.match(/\d+(?:\.\d+)?/g),V=S&&S.map(e=>parseFloat(e));t.vcxValue=V?V.join(" "):"0"}else t.vcxValue=e.value},onPropertiesChanged:function(e){this._preventRefresh||this.requestRefresh(!1),this._preventRefresh=!1},getGroupUIInformation:function(e,t){if(!1!==e.availability){var n=e.groupID;""===n&&(n="Group.Essentials");var i={propertyGroup:e,modifiableViewList:this.getSelectedModifiableviews()},a={name:this._getTranslationI18n(i).groupName,arrayProps:[],groupID:n};t[n]=a,t[n].order=e.priority,t[n].collapsed=this.getCollapsedGroupIds().includes(n),"boolean"!=typeof e.availability&&"boolean"==typeof e.visibility&&(t[n].checkbox=e.visibility,t[n].showPropName="");var r=new D;r.AddOrModifyGroup(e.clone());var o=this._getPropertiesFromPropertyGroups(this._lastSelection,r)._map,s=e.getPropertiesIDsOrderedArray();for(var l in s){var c=s[l],d=o[c];this.getPropertyUIInformation(c,d,e,o,t[n])}0!==t[n].arrayProps.length||"checkbox"in t[n]||delete t[n]}},getPropertyUIInformation:function(e,t,n,i,a){var r={};r.touch=this._vcxGuiManager.isTouchActivated(),r.propertyId=e;var o=this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getUrlVars();if(t&&this._isPropertyDisplayed(t,o)){var s=t.GetPropertyValue();r.propertyValue=s;var l=t.GetPropertyInfo();r.propInfo=l;var c=n.additionalPropertySettings&&n.additionalPropertySettings[e];c&&(c.propertyName=e),r.propSettings=c;var d=this._lastSelection,u=!1;if(1===d.length){var p=d[0].QueryInterface("VCXIModifiable"),h=this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager");if(c&&c.overridePropertyList){for(var m=0;m<c.overridePropertyList.length;m++)if(h.IsCurrentPropertyDifferentFromNeutral(p,c.overridePropertyList[m])){u=!0;break}}else u=h.IsCurrentPropertyDifferentFromNeutral(p,e)}r.isOverriden=u;var g=n.isVisible(e);if(e!==n.PropertyControlingGroupAvailability){var C={strPropId:e,propInfo:l,propertyGroup:n,urlVariables:o,modifiableViewList:this.getSelectedModifiableviews()},v=this._getTranslationI18n(C).propName;r.label=v;var _=!1;if(this._disableLinkedProperties)for(var b=0;b<d.length;++b){var f=this._vcxGuiManager._experienceBase.getManager("VCXLinkedPropertyManager");if(_=f&&f.IsLinkedAndNotInFollow(d[b].GetID(),e))break}!0===(n.isLockable(e)?n.isLocked(e):null)&&(_=!0),r.disabled=_;var S=!l.IsDefined();if(r.multipleSelectionUndefined=S,l.IsBounded()&&(r.bounds=l.GetBounds()),n.PropertyControlingGroupVisibility===e)"boolean"!=typeof n.availability&&"boolean"==typeof n.visibility&&(a.checkbox=s.GetValue(),a.showPropName=e,a.disabled=_);else{var V=!0,y=n.getPropertiesIDsOrderedArray();if(y.indexOf(e)>=0&&(r.order=y.indexOf(e)),g&&this.isPropertyBoxed(e,t))V=!1,this.getBoxedPropertiesUIInfo(n,t,v,u,c,a.arrayProps,a.checkbox);else if(this._vcxGuiManager._experienceBase.getManager("VCXContextManager").isSupported("OpacityOverride")&&g&&(e.includes(".Defined")||("Actor.Color"===e||"Actor.Opacity"===e)&&i&&i[e+".Defined"]&&n.isVisible(e+".Defined")))if(e.includes(".Defined"))V=!1;else{var x=e+".Defined",P=i[x],I=P.GetPropertyValue(),M=P.GetPropertyInfo();r.defined={propertyId:x,propertyDefined:P,propertyValue:I,propertyInfo:M}}else if(e.includes(".Color"))if(e.includes(".Opacity")&&i[e.replace(".Opacity","")])V=!1;else{var w=e+".Opacity",D=i[w];if(D){var X=D.GetPropertyValue(),T=D.GetPropertyInfo();r.opacity={propertyId:w,propertyOpacity:D,propertyValue:X,propertyInfo:T},T.IsBounded()&&(r.opacity.bounds=T.GetBounds())}}else if("VCXPropertyValueDocId"===s.GetType()){var A=s.GetValue(),E="Upload texture.",G="";if(A>=0){var B=this._vcxGuiManager._experienceBase.getManager("VCXDocManager").GetPropPath(A);G=B&&B.GetFileName().GetValue()}E=(""===G||"I_VCX_DefaultTexture.png"===G)&&this._imageUploadPlaceHolder&&this._textureUploadPlaceHolder?e.includes("Image")?this._imageUploadPlaceHolder:this._textureUploadPlaceHolder:G,r.placeHolder=E}this.fillEnumInformationInto(e,t,n,r),V&&g&&a.arrayProps.push(r)}}else a.propControlingAvailability={propertyId:e,propertyValue:s}}},getCollapsedGroupIds:function(){var e=[],t=this.getSelectedModifiableviews(),n=this;return t.every(t=>{var i,a=t.GetObject();if(this._propertiesPanelModel.isCollapsedGroupsSavedForComponent(a)){var r=[a];i=n._propertiesPanelModel.getCollapsedGroupsForComponents(r)}else i=t.getCollapsedGroupsNames(),this._propertiesPanelModel.setCollapsedGroupsForComponent(a,i);return i.every(t=>(e.includes(t)||e.push(t),!0)),!0}),e},RebuildPanel:async function(e){this._lastSelection=e;var t=this.BuildIntersectionPropertyGroups(e).getOrderedPropertyGroupsArray(),n=this.getSelectedModifiableviews(),i={};for(var a in t){var r=t[a];this.getGroupUIInformation(r,i)}if(this._propertiesPanelViewV2.rebuildPanelUI(i,q.PlayerMode),1===n.length&&this._propertiesPanelViewV2.rebuildHeaderUI(n[0].GetObject().GetType()),this._vcxGuiManager._experienceBase.getManager("VCXContextManager").isSupported("VCXPropertyThumbnailSupport")&&1===n.length){const e=n[0].GetObject(),t=e._refid||e.QueryInterface("CATI3DXAssetProperties")&&await e.QueryInterface("CATI3DXAssetProperties").getPhysicalId(),i=await k.Get3DSpaceURL(),a=i&&t&&await B.getObjectInfo(t,i);a&&this._propertiesPanelViewV2.addPropThumbnail(a&&a.dataelements&&a.dataelements.image)}},updatePanel:function(e){var t=this.BuildIntersectionPropertyGroups(e).getOrderedPropertyGroupsArray(),n=this._propertiesPanelViewV2.getPanelDisplayedInfo(),i=Object.keys(n),a=this.getSelectedModifiableviews(),r=this._propertiesPanelViewV2.getUIGroupsInfo();if(r){this.controllerIsUpdatingUI=!0;for(var o=0;o<t.length;o++){for(var s=t[o],l={propertyGroup:s,modifiableViewList:a},c=this._getTranslationI18n(l).groupName,d=0;d<r.length;d++){r[d].groupID===s.groupID&&r.splice(d,1)}var u=this._propertiesPanelViewV2.getGroupExpander(c);if(!i.includes(s.groupID)){var p={};this.getGroupUIInformation(s,p),this._propertiesPanelViewV2.createTweakerGroup(p[s.groupID]);continue}let w=new D;w.AddOrModifyGroup(s.clone());let X=this._getPropertiesFromPropertyGroups(e,w)._map,T=Object.keys(X);for(var h=Object.keys(n[s.groupID]),m=0;m<T.length;m++){let t,i,a=T[m],r=X[a];if(h.includes(a)&&s.isVisible(a)){t=n[s.groupID][a].value,i=n[s.groupID][a].propType;let e=r.GetPropertyValue().GetValue(),o={arrayProps:[]};if(this.getPropertyUIInformation(a,r,s,X,o),a.includes(".Enabled")&&n[s.groupID][a].value!==o.checkbox&&this._propertiesPanelViewV2.updateTweakers(a,o.checkbox,e),o.arrayProps.length>0){let l=o.arrayProps.length>0&&o.arrayProps[0].defined&&!o.arrayProps[0].defined.propertyValue.GetValue();o.arrayProps.length>0&&o.arrayProps[0].multipleSelectionUndefined&&(l=l||o.arrayProps[0].multipleSelectionUndefined);let c=n[s.groupID][a].undefinedDisplayFlag;if(!l||!c){let d=this.compareValues(r,e,i,t),p=o.arrayProps.length>0&&o.arrayProps[0].propSettings&&o.arrayProps[0].propSettings.buttons,h=n[s.groupID][a].additionalButtons,m=this.comparePropSettingsButtons(p,h);m&&(this._propertiesPanelViewV2.updateButtons(s.groupID,a,m.update),this._propertiesPanelViewV2.removeButtons(s.groupID,a,m.remove),this._propertiesPanelViewV2.addButtons(s.groupID,a,m.add),this._propertiesPanelViewV2.rebuildButtons(s.groupID,a,m.rebuild)),y.deepCompare(o.arrayProps[0].enum,n[s.groupID][a].enumChoices,!1,!1)||(d.needToRebuild=!0),s.isVisible(a)?d&&d.needToRebuild?(this._propertiesPanelViewV2.destroyTweakerLine(a),o.arrayProps.length>0&&this._propertiesPanelViewV2.buildPropertyLine({uiInfo:o.arrayProps[0]},u.body,n[s.groupID])):(d&&d.needToUpdate||l!==c)&&this._propertiesPanelViewV2.updateTweakers(a,d.valueForTweaker,e,l):this._propertiesPanelViewV2.destroyTweakerLine(a)}}}else if(a.includes("Availability"));else if(a===s.PropertyControlingGroupVisibility);else if(this.isPropertyBoxed(a,r)){var g=[];let e={strPropId:a,propInfo:r.GetPropertyInfo(),propertyGroup:s,urlVariables:this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getUrlVars(),modifiableViewList:this.getSelectedModifiableviews()},o=this._getTranslationI18n(e).propName;this.getBoxedPropertiesUIInfo(s,r,o,null,null,g);for(var C=0;C<g.length;C++){var v=g[C].boxedProperty,_=g[C].propertyId,b=(g[C],g[C].propertyValue.GetValue());if(h.includes(_)){t=n[s.groupID][_].value,i=n[s.groupID][_].propType;let e={arrayProps:[]};this.getPropertyUIInformation(a,r,s,X,e);for(var f=this.compareValues(g[C].boxedProperty,b,i,t),S=0;S<e.arrayProps.length;S++)if(e.arrayProps[S].propertyId===_){e.arrayProps=[e.arrayProps[S]];break}y.deepCompare(e.arrayProps[0].enum,n[s.groupID][_].enumChoices,!1,!1)||(f.needToRebuild=!0),v.GetPropertyInfo().IsVisible()?f&&f.needToRebuild?(this._propertiesPanelViewV2.destroyTweakerLine(_),this._propertiesPanelViewV2.buildPropertyLine({uiInfo:g[C]},u.body,n[s.groupID])):f&&f.needToUpdate&&this._propertiesPanelViewV2.updateTweakers(_,f.valueForTweaker,b):this._propertiesPanelViewV2.destroyTweakerLine(a)}else this._propertiesPanelViewV2.buildPropertyLine({uiInfo:g[C]},u.body,n[s.groupID]);var V=h.indexOf(_);V>=0&&h.splice(V,1)}}else{if(!e[0].QueryInterface("VCXIModifiableView").getPropertyGroups()[s.groupID].isVisible(a))continue;var x={arrayProps:[]};this.getPropertyUIInformation(a,r,s,X,x),x.arrayProps.length>0&&this._propertiesPanelViewV2.buildPropertyLine({uiInfo:x.arrayProps[0]},u.body,n[s.groupID])}var P=h.indexOf(a);P>=0&&h.splice(P,1)}if(h.length>0)for(var I=0;I<h.length;I++){var M=h[I];this._propertiesPanelViewV2.destroyTweakerLine(M)}}if(r.length>0)for(var w=0;w<r.length;w++)this._propertiesPanelViewV2.destroyGroup(r[w]);this.controllerIsUpdatingUI=!1}},compareValues:function(e,t,n,i){var a=!1,r=!1,o=t,s=e.GetPropertyInfo().GetPropertyName();if("VCXPropertyValueDocId"===n){if(t!==i&&t>=0){var l=this._vcxGuiManager._experienceBase.getManager("VCXDocManager").GetPropPath(t);o=l&&l.GetFileName().GetValue(),a=!0}t<0&&(o=null)}else e.GetPropertyValue().GetType()!==n?r=!0:t.GetColorHexString?"#"+t.GetColorHexString()!==i&&(o=t.GetColorHexString(),a=!0):i.equals?i.equals(t.toArray())||(o=t.toArray(),a=!0):"VCXPropertyValueEnum"===e.GetPropertyValue().GetType()?e.GetPropertyInfo().GetMapChoiceEnum()[t]!==i&&(o=e.GetPropertyInfo().GetMapChoiceEnum()[t],a=!0):i!==t&&(typeof i==typeof t?a=!0:console.log("%c there is an comparison issue with property: "+s,"color: red"));return{needToRebuild:r,needToUpdate:a,valueForTweaker:o}},comparePropSettingsButtons:function(e,t){if(!e||!t)return;let n={add:[],remove:[],update:[],rebuild:[]},i={...t};for(let a=0;a<e.length;a++){let r=e[a],o=t[r.type];if(o){y.deepCompare(r,t[r.type].buttonInfo)||(r.data&&!y.deepCompare(r.data,o.buttonInfo.data)?n.rebuild.push(r):n.update.push(r)),delete i[r.type]}else n.add.push(r)}for(const e in i)if(Object.hasOwnProperty.call(i,e)){const t=i[e];n.remove.push(t.buttonInfo)}return n},getAdditionalSettingsForProp:function(e){var t=this.getSelectedModifiableviews()[0],n=t.getAdditionalPropertySettings&&t.getAdditionalPropertySettings();return n&&n[e]?n[e]:null},isPropertyBoxed:function(e,t){return!(!["Actor.Hyperlink","Collab.Text.Font"].includes(e)&&!["VCXPropertyValueLocation","VCXPropertyValueFrame"].includes(t.GetPropertyValue().GetType()))},getBoxedPropertiesUIInfo:function(e,t,n,i,a,r,o){var s=t.GetPropertyInfo().GetPropertyName(),l=t.GetPropertyValue(),c=t.GetPropertyInfo();if(e.isVisible(s)&&this.isPropertyBoxed(s,t)){var d=e.getProperties()[s]&&e.getProperties()[s].hiddenFields,u="Actor.Hyperlink"===s?"hyperlink":"Collab.Text.Font"===s?"font":"Collab.Text.Font.Container"===s?"font":"VCXPropertyValueFrame"===l.GetType()||"VCXPropertyValueLocation"===l.GetType()?"frame":null,p=null,h=this._propertiesPanelModel.getUnboxedPropertiesNLS(u,s);"Actor.Hyperlink"===s?((p=this._propertiesPanelModel.getUnboxedPropertiesForGUI(u,l,c)).propertyAction&&delete p.propertyAction,Boolean(p.propertyType.GetPropertyValue().GetValue())):"Collab.Text.Font"===s?p=this._propertiesPanelModel.getUnboxedPropertiesForGUI(u,l,c,d):["VCXPropertyValueLocation","VCXPropertyValueFrame"].includes(t.GetPropertyValue().GetType())&&this._vcxGuiManager._experienceBase.getManager("VCXContextManager").isSupported("FrameUnboxing")&&(p=this._propertiesPanelModel.getUnboxedPropertiesForGUI(u,l,c,d));var m,g=e.getPropertiesIDsOrderedArray();if(g.indexOf(s)>=0&&(m=g.indexOf(s)),p)for(var C in p)if(p.hasOwnProperty(C)){if("hiddenFields"===C)continue;var v=p[C];if(!v)continue;var _=v.GetPropertyInfo(),b=p.hiddenFields&&p.hiddenFields.includes(C);if(!_.IsVisible()||b)continue;var f=_.GetPropertyName(),S=n,V=h&&h[f];V&&("Actor.Position"===s||"Actor.Hyperlink"===s||S===s?S=V:S+=" "+V);var y;y={label:S,propertyId:f,propertyValue:v.GetPropertyValue(),touch:this._vcxGuiManager.isTouchActivated(),isOverriden:i,boxedProperty:v,order:m,propSettings:a},this.fillEnumInformationInto(f,v,e,y),r.push(y)}}},emptyPanel:function(){this._propertiesPanelViewV2&&(this._propertiesPanelViewV2.emptyPanelContent(),this._lastSelection=[],this._selectedPropsArray=[])},requestChangeInPanel:function(){var e=this._vcxGuiManager._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection(),t=!0;this._vcxGuiManager._experienceBase.getManager("VCXContextManager").isSupported("PropertyPanelV2")||(t=!1),this.modifyWhile&&(t=!1);var n=this._vcxGuiManager._experienceBase.getManager("VCXManipulatorManager").checkManipulationInProgress();for(var i in n&&(t=!1),e)if(!e[i].QueryInterface("VCXIModifiableView")){t=!1,console.warn("No modifiable view found for some elements selected");break}t&&(this._lastSelection.equals(e)?this.updatePanel(e):0===e.length?this.emptyPanel():this.RebuildPanel(e))},executeHeaderCommand:function(e){if(""!==e){var n=null,i=this._vcxGuiManager._experienceBase.getManager("VCXContextManager");i&&(n=i.getContext()),t.getCommand(e,n)&&t.getCommand(e,n).begin()}},ambienceApplyFunction:function(){var e=this._lastSelection[0],t=this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getActiveViewport();if(t){var n=t.QueryInterface("VCXIModifiable");if(n){var i=e.GetObject().GetID(),a=new G(i),r=new P(new I("Viewport.ActiveAmbience",0),a),o=new S(this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager"),this._vcxGuiManager._experienceBase.getManager("VCXCommandManager"),!0);o.ChangeProperty(n,r),this._vcxGuiManager._experienceBase.getManager("VCXCommandManager").Push(o)}}},activateLabelSelection:function(){this._propertiesPanelViewV2.onClickLabel=this.onClickLabel.bind(this),this._propertiesPanelViewV2.onDoubleClickLabel=this.onDoubleClickLabel.bind(this)},onClickLabel:function(e){if(2===e.detail)return;let t=e.target.propertyId;if(this._selectedPropsArray&&t)if(this._selectedPropsArray.includes(t)){let e=this._selectedPropsArray.indexOf(t);this._selectedPropsArray.splice(e,1),this._propertiesPanelViewV2.uiSelect(t,!1)}else this._selectedPropsArray.push(t),this._propertiesPanelViewV2.uiSelect(t,!0)},onDoubleClickLabel:function(e){if(this._selectedPropsArray.includes(e.target.propertyId)){let e=this._propertiesPanelViewV2.selectAllProps();this._selectedPropsArray=e}else this._propertiesPanelViewV2.deselectAllProps(),this._selectedPropsArray=[]},GetSelectedProperties:function(){if(this._selectedPropsArray)return this._selectedPropsArray},getSelectedModifiableviews:function(){var e=[];return this._lastSelection.every(function(t){return e.push(t.QueryInterface("VCXIModifiableView")),!0}),e},fillEnumInformationInto:function(e,t,n,i){var a=this.getSelectedModifiableviews(),r=t.GetPropertyValue(),o=t.GetPropertyInfo();if(o.GetMapChoiceEnum&&o.GetMapChoiceEnum()){var s=o.GetMapChoiceEnum(),l={propertyGroup:n,strPropId:e,propInfo:o,modifiableViewList:a},c=this._getTranslationI18n(l).choices,d=Object.keys(s);if(0===d.length)return;var u,p={};for(var h of d)c[h]?(p[s[h]]=c[h],h===r.GetValue()+""&&(u=c[h])):(p[s[h]]=s[h],h===r.GetValue()+""&&(u=s[h]));i.mapChoiceEnum=s,i.enum=p,i.enumValue=u}},_generateDivForProperty:function(e){var t=new UWA.Element("div",{class:O});if(new UWA.Element("div",{html:e.label,class:L}).inject(t),e.tweaker&&e.tweaker.inject(t),e.propSettings&&(e.propSettings.disableLiveChange&&"number"==typeof e.propSettings.disableLiveChange&&t.addEventListener("liveChange",t=>{t.stopPropagation(),this._liveChangeTimeout&&clearTimeout(this._liveChangeTimeout),this._liveChangeTimeout=setTimeout(()=>{this._onLiveChange(t),this._liveChangeTimeout=void 0},e.propSettings.disableLiveChange)}),e.propSettings.buttons))for(var i=0;i<e.propSettings.buttons.length;i++){var a=e.propSettings.buttons[i],r=null;if(a.available){if("Restore"===a.type){var o=!1;if(a.data&&a.data.propertiesToRestore&&a.data.object)for(var s=this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager"),l=a.data.object.QueryInterface("VCXIModifiable"),c=0;c<a.data.propertiesToRestore.length;c++){var d=a.data.propertiesToRestore[c];if(s.IsCurrentPropertyDifferentFromNeutral(l,d)){o=!0;break}}(r=new n({displayStyle:"lite",disabled:!o,icon:{iconPath:h.getWebappsAssetUrl("VCXWebGUI","icons/32/VCX_Restore_grey.png")}})).elements.container.title=a.tooltip||"Restore Default Value",a.location=20,r.additionalButtonFunction=this.restoreProperties.bind(this),r.additionalButtonFunctionArgs={data:a.data},t.addClassName("vcx-prop-restorable")}else if("NavigateTo"===a.type){t.getChildren().every(e=>(e.hasClassName("vcx-propNode-label")||t.removeChild(e),!0)),new UWA.Element("div",{html:"Overruled",class:"vcx-prop-overruled"}).inject(t),r=new n({label:"Go to parent"}),a.location=20,r.additionalButtonFunction=this.navigateToParent.bind(this),r.additionalButtonFunctionArgs={data:a.data},r.getContent().addClassName("vcx-goToParent-button")}else"ChangeProperties"===a.type?(r=new n({displayStyle:"lite",icon:{iconName:"3dproduct",fontIconFamily:WUXManagedFontIcons.Font3DS}}),a.location=20,r.additionalButtonFunction=this.changePropsOfModifiable.bind(this),r.additionalButtonFunctionArgs={data:a.data}):((r=new n({displayStyle:"lite",icon:{iconName:a.iconName||"i-question",fontIconFamily:WUXManagedFontIcons.Font3DS}})).additionalButtonFunction=a.functionCB,r.additionalButtonFunctionArgs={name:a.name,propertyName:e.propSettings.propertyName,data:a.data},r.elements.container.title=a.tooltip||"");a.location?a.location>t.getChildren().length?r.inject(t):t.insertBefore(r.getContent(),t.getChildren()[a.location-1]):console.warn("A button "+a.name+" was attempted to be created without location: button not created")}}return t},_generateExpanderInfosForGroup:function(e){var t={header:e.label,body:null,groupID:e.groupID};if(e.group){var n=null;"boolean"==typeof e.toggle&&"Actor.Hyperlink_Action"!==e.propName&&(n=new r({displayStyle:"switch",value:e.toggle,disabled:e.disabled||q.PlayerMode}),e.groupID&&n.elements.container.addClassName("vcx-tweaker-group-"+e.groupID.replaceAll(".","-").replaceAll("_","-")),n.internalOptions={propName:e.propName,touch:this._vcxGuiManager.isTouchActivated()},t.customHeader=n,t.hideArrow=!e.toggle,q.PlayerMode||(n.addEventListener("pointerup",this._onTweakerPointerUpCB),this._listTweakersWithPtrUpEvt.push(n)))}return t},navigateToParent:function(e){if(e&&e.data&&e.data.objectToNavigateTo){var t=this._vcxGuiManager._experienceBase.getManager("VCXCommandManager"),n=this._vcxGuiManager._experienceBase.getManager("VCXSelectionManager"),a=new f(n);a.SetSelection(e.data.objectToNavigateTo),t.Do(a),i.publish({event:"VCXActiveCardMATERIAL",data:null})}},restoreProperties:function(e){if(e&&e.data&&e.data.propertiesToRestore&&e.data.object){var t=this._vcxGuiManager._experienceBase,n=t.getManager("VCXCommandManager"),a=t.getManager("VCXScenarioManager"),r=e.data.object.QueryInterface("VCXIModifiable"),o=r.GetHashing();if(o){var s=a.GetNeutrals(o);if(s){this._preventRefresh=!0;for(var l=0;l<e.data.propertiesToRestore.length;l++){var c=e.data.propertiesToRestore[l];if(s._map.hasOwnProperty(c)){var d=s.GetProperty(c);if(d){var u=new S(a,n);u.ChangeProperty(r,d),n.Push(u)}}}i.publish({event:"VCXActiveCardMATERIAL",data:null}),this._preventRefresh=!1}}}},clearProperties:function(e){if(e&&e.data&&e.data.propertiesToClear&&e.data.object&&this._vcxGuiManager&&this._vcxGuiManager._experienceBase){let t=this._vcxGuiManager._experienceBase,n=t.getManager("VCXCommandManager"),i=t.getManager("VCXScenarioManager");for(let t=0;t<e.data.object.length;t++){let a=e.data.object[t].QueryInterface("VCXIModifiable");this._preventRefresh=!0;for(let t=0;t<e.data.propertiesToClear.length;t++){let r=e.data.propertiesToClear[t],o=a.GetProperty(r);if("Actor.PartList.ID"!==r&&"Actor.PartList.Description"!==r||(o._propertyValue._value=""),o){let e=new S(i,n);e.ChangeProperty(a,o),n.Push(e)}}}this._preventRefresh=!1}},changePropsOfModifiable:function(e){if(e&&e.data&&e.data.propertyMapToApply){var t=this._vcxGuiManager._experienceBase,n=t.getManager("VCXCommandManager"),i=new S(t.getManager("VCXScenarioManager"),n),a=e.data.propertyMapToApply,r=[];if(a&&a.GetListModifiables&&a.GetPropertySet){n.StartTransaction();var o=t.getManager("VCXScenarioManager").ModifiableServer;a.GetListModifiables(r);for(var s=0;s<r.length;s++){var l=r[s],c=a.GetPropertySet(l)._map;for(var d in c)if(c.hasOwnProperty(d)){var u=a.GetPropertySet(l).GetProperty(d);u&&i.ChangeProperty(o.GetModifiableFromHashing(l),u)}}t.getManager("VCXCommandManager").Push(i),n.EndTransaction()}else console.error("argument is not a VCXPropertyMap")}else console.warn("Arguments not suitable to change properties")},_getPropertiesFromPropertyGroups:function(e,t){for(var n=new M,i=t.getListPropertiesNames(),a=0;a<e.length;a++)for(var r=e[a],o=r&&r.QueryInterface("VCXIModifiable"),s=0;s<i.length;++s){var l=i[s],c=o.GetProperty(l);if(c){var d=n.GetProperty(l);d?d.GetPropertyValue().IsEqualTo(c.GetPropertyValue())||(d.GetPropertyInfo().SetDefined(!1),i.splice(s,1),--s):n.AddOrModifyProperty(c.Clone())}else this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getUrlVars().debug,i.splice(s,1),--s}return n},BuildIntersectionPropertyGroups:function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n].QueryInterface("VCXIModifiableView"),a=i&&i.getPropertyGroups&&i.getPropertyGroups();if(a){Object.keys(a).forEach(t=>{var n=i.getAdditionalPropertySettings&&i.getAdditionalPropertySettings(e)||{};a[t].additionalPropertySettings={},Object.keys(a[t]._propertiesInfos).forEach(e=>{n[e]&&(a[t].additionalPropertySettings[e]=n[e])})});var r=new D;r.SetFromGroupsMap(a),t.push(r)}else e.splice(n,1),--n}var o=new D;return o.Intersection(t),o},_onShowTweaker:function(e){},_onHideTweaker:function(e){},_onCancelEdit:async function(e){console.log("_onCancelEdit"),this.modifyWhile=!1,this._canceledEdit=!0;var t=this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getMainViewer();this._vcxGuiManager._experienceBase.getManager("VCXVisuManager").showDecorations("PanelPropLiveChange",t),this._currentLiveChangeIndex=1,await this._onNodeModelUpdate(e,!1),this._vcxGuiManager._experienceBase.getManager("VCXCommandManager").CancelTransaction(),this.simulateResult=[]},_onPreEdit:async function(e){console.log("_onPreEdit"),this.modifyWhile=!0,this._currentlyEditing=!0,this._vcxGuiManager._experienceBase.getManager("VCXCommandManager").StartTransaction();var t=this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getMainViewer();this._vcxGuiManager._experienceBase.getManager("VCXVisuManager").hideDecorations("PanelPropLiveChange",t),await this._onNodeModelUpdate(e,!0,!0)},_onPostEdit:async function(e){console.log("_onPostEdit"),this.modifyWhile=!1,this._currentlyEditing=!1,this.simulateResult=[];this._vcxGuiManager._experienceBase.getManager("VCXCommandManager");var t=this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getMainViewer();this._vcxGuiManager._experienceBase.getManager("VCXVisuManager").showDecorations("PanelPropLiveChange",t),this._currentLiveChangeIndex=1,await this._onNodeModelUpdate(e,!1,!0),this._vcxGuiManager._experienceBase.getManager("VCXCommandManager").EndTransaction(),this.simulateResult=null},_onLiveChange:async function(e){if(console.log("_onLiveChange"),e&&e.dsModel&&e.dsModel.internalOptions){var t=this._propertiesPanelModel.getMainPropNameFromBoxedPropName(e.dsModel.internalOptions.propName);x.RemoveStyleFromCurrentSelection(this._vcxGuiManager._experienceBase,this._lastSelection,!0,t)}await this._onNodeModelUpdate(e,!1,!1)},_onChange:async function(e){if(this.controllerIsUpdatingUI)return;this.modifyWhile=!0;this._vcxGuiManager._experienceBase.getManager("VCXCommandManager");if(e&&e.dsModel&&e.dsModel.internalOptions){var t=this._propertiesPanelModel.getMainPropNameFromBoxedPropName(e.dsModel.internalOptions.propName);x.RemoveStyleFromCurrentSelection(this._vcxGuiManager._experienceBase,this._lastSelection,!0,t)}return this._currentLiveChangeIndex=1,this._onNodeModelUpdate(e,!1,!0).then(()=>{i.publish({event:"VCXActiveCardMATERIAL",data:null}),i.publish({event:"VCX_UPDATE_AMBIENCES_ON_CHANGE_SCENE",data:null}),this.modifyWhile=!1}).catch(e=>{throw new Error(e)})},_onButtonClick:function(e){e.dsModel&&e.dsModel.additionalButtonFunction&&e.dsModel.additionalButtonFunction(e.dsModel.additionalButtonFunctionArgs)},_onExpand:function(e){var t=e.options.expanderTarget.groupID;t&&this._propertiesPanelModel.removeCollapsedGroupForComponents(this._lastSelection,t)},_onCollapse:function(e){var t=e.options.expanderTarget.groupID;t&&this._propertiesPanelModel.addCollapsedGroupForComponents(this._lastSelection,t)},_getTranslationI18n:function(e){var t=e.strPropId,n=e.propInfo,i=e.propertyGroup,a=e.urlVariables,r=e.modifiableViewList,o={};if(t){if(o.propName=t,o.choices={},n&&n.GetMetaPropertyDef()){var s=n.GetMetaPropertyDef().GetDefaultLabel();s&&(o.propName=s)}else if(!a||!a.noNLS){var l={propertyName:t,group:i};r.every(e=>{var i=e.getTranslatedProperty(l);if(o.propName===t?o.propName=i.propertyName:o.propName===i.propertyName||(console.error("Translation error, differs from one modifiable to the other for property: ",t),o.propName="error"),i.choice&&0!==Object.keys(i.choice).length&&i.choice.constructor===Object)0===Object.keys(o.choices).length?o.choices=i.choice:Object.keys(i.choice).equals(Object.keys(o.choices))&&Object.values(i.choice).equals(Object.values(o.choices))||(console.error("Enumeration error, differs from one modifiable to the other for property: ",t),o.choices={error:"error"});else if(n.GetMapChoiceEnum&&n.GetMapChoiceEnum()){o.choices=n.GetMapChoiceEnum(),Object.keys(o.choices).every(e=>(o.choices[e]=o.choices[e].replace("__DONOTTRANSLATE__",""),!0))}return!0})}}else o.groupName=i.groupID,r.every(e=>{var n={group:i},a=e.getTranslatedProperty(n)&&e.getTranslatedProperty(n).groupName;if(o.groupName===i.groupID)o.groupName=a;else if(o.groupName!==a)return console.error("Translation error, differs from one modifiable to the other for property: ",t),o.groupName="error",!1;return!0});return o},_isPropertyDisplayed:function(e,t){var n=e.GetPropertyValue();if(!n)return!1;if(!t.propertiesNoFilter&&("VCXPropertyValueVector"===n.GetType()||"VCXPropertyValueAnchor"===n.GetType()||"VCXPropertyValueMap"===n.GetType()))return!1;var i=this._vcxGuiManager._experienceBase,a=i&&i.getManager("VCXContextManager");return!!(t.propertiesNoFilter||"VCXPropertyValueFrame"!==n.GetType()&&"VCXPropertyValueLocation"!==n.GetType()||a&&a.isSupported("FrameUnboxing"))},_isPropLocked:function(e){return e.GetLockedStatus()},getPanelView:function(){return this._propertiesPanelViewV2.uiPanelClass.panel},_addLockToTweakers:function(e,t,i){var a=new n({displayStyle:"lite",icon:{iconName:"lock",fontIconFamily:WUXManagedFontIcons.Font3DS},type:"check",checkFlag:t});a.getContent().addClassName(H);var r=()=>{this._onClickTweakerLockIcon(i)};a.getContent().addEventListener("change",r),a.inject(e),this._listButtonsLockToUnsubscribe.push([a,r])},_onClickTweakerLockIcon:function(e){this._changeInLocks=!0;this._vcxGuiManager._experienceBase;for(var t=this._lastSelection.map(e=>e.QueryInterface("VCXIModifiableView")),n=0;n<t.length;n++){var i=t[n],a=i.IsPropertyLocked(e);"boolean"==typeof a&&i.SetPropertyLocked(e,!a)}this.requestChangeInPanel()},_simplifyNumberDisplay:function(e,t){if(Number.isInteger(e))return e;if(Math.abs(e)<1e-5)return 0;var n="number"==typeof t?t:2;return"number"!=typeof e?void 0===e?e:(console.warn("TweakerNumber object needs a number as input"),null):Math.abs(e)<1?Number(e.toPrecision(n)):Number(e.toFixed(n))},changeFormatPainterUIVisibility:function(e){this._propertiesPanelViewV2.changeFormatPainterButtonVisibility(e)},displayFakePropertiesForODT:function(){this._listTweakersWithPtrUpEvt=[];var e=this._generateAllTweakersTypes(),t=Object.keys(e),n=null,i=null,a=new UWA.Element("div",{class:W}),r=this._generateExpanderInfosForGroup({label:"Group ODT",group:!0,toggle:!0,disabled:!1,propName:"groupODT"});r.body=a;for(var o=0;o<t.length;++o){var s=t[o],l=e[s];n=new UWA.Element("div",{class:R+" "+s});l.inject(n),i={label:s,tweaker:n,experienceBase:this._vcxGuiManager._experienceBase,touch:!1};var c=this._generateDivForProperty(i);c&&c.inject(a)}return this._propertiesPanelView.putContainer(),this._propertiesPanelView.emptyContainerContent(),this._propertiesPanelView.updateAccordeonForODT([r]),t},_generateAllTweakersTypes:function(){var e={};e.blobEnabled=new a({placeholder:"Upload texture",disabled:!1}),e.blobDisabled=new c({value:"",disabled:!1});var t=(new X).GetValue();e.dateEnabled=new s({value:t,timePickerFlag:!0,timePickerPrecision:"sec",disabled:!1}),e.dateDisabled=new s({value:t,timePickerFlag:!0,timePickerPrecision:"sec",disabled:!0});e.colorEnabled=new o({value:"00FF00",disabled:!1}),e.colorDisabled=new o({value:"00FF00",disabled:!0}),e.colorNullEnabled=new o({value:null,disabled:!1}),e.colorNullDisabled=new o({value:null,disabled:!0});e.floatBoundedEnabled=this._createSliderTweaker(.45,0,1,.01,!1,{}),e.floatBoundedDisabled=this._createSliderTweaker(.45,0,1,.01,!0,{}),e.floatUnboundedEnabled=new l({value:this._simplifyNumberDisplay(.45),stepValue:.1,disabled:!1}),e.floatUnboundedDisabled=new l({value:this._simplifyNumberDisplay(.45),stepValue:.1,disabled:!0});e.booleanEnabled=new r({displayStyle:"switch",value:!0,disabled:!1}),e.booleanDisabled=new r({displayStyle:"switch",value:!0,disabled:!0});var n=[.654327,168532].map(e=>this._simplifyNumberDisplay(e)),i=["x","y"],u=[.654327,168532,245.24986].map(e=>this._simplifyNumberDisplay(e)),p=["x","y","z"];e.point2dEnable=new d({value:n,definition:i,readOnly:!1}),e.point2dDisable=new d({value:n,definition:i,readOnly:!0}),e.point3dEnable=new d({value:u,definition:p,readOnly:!1}),e.point3dDisable=new d({value:u,definition:p,readOnly:!0});var h=["Option 0","Option 1","Option 2","Option 3"];return e.comboEnable=new c({displayStyle:"combo",possibleValues:Object.values(h),value:h[2],disabled:!1}),e.comboDisable=new c({displayStyle:"combo",possibleValues:Object.values(h),value:h[2],disabled:!0}),e},removeFakePropertiesForODT:function(){if(Array.isArray(this._listTweakersWithPtrUpEvt)){for(var e=0;e<this._listTweakersWithPtrUpEvt.length;++e){this._listTweakersWithPtrUpEvt[e].removeEventListener("pointerup",this._onTweakerPointerUpCB)}this._listTweakersWithPtrUpEvt=null}}});return q.setChildrenDataRecID=function(e,t){for(var n=e.getChildren(),i=0;i<n.length;i++){var a=n[i],r=t+"_"+i;a.setAttribute("data-rec-id",r),q.setChildrenDataRecID(a,r)}},q});