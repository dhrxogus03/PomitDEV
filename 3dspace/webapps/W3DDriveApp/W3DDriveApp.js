define("DS/W3DDriveApp/Views/startView",["DS/W3DXComponents/Views/EmptyView","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp","css!DS/W3DContentApp/W3DContentApp.css"],function(e,t){"use strict";const n="start-view--medium",i="start-view--small";let r,o=!0;const s=Object.freeze({normal:980,small:660});function a(e,t){return e&&t in e?e[t].join?e[t].join(" "):e[t]:""}function d(e="div",t={}){const n=t.id,i=a(t,"classes");return"<"+e+(n?' id="'+n+'"':"")+(i?' class="'+i+'"':"")+">"+a(t,"content")+"</"+e+">"}return function(a={}){let l=new e({id:"start_view_0",template:function(){const e=a.icon?a.icon:"picture",n=a.title?a.title:t.get("noContent");return d("div",{id:"no-content-view",classes:"empty-view-infos"+(a.isDnD?" hidden":""),content:[d("span",{classes:"empty-view-icon center-block fonticon fonticon-5x fonticon-"+e}),d("span",{classes:"empty-view-title center-block",content:n})]})+d("div",{id:"dnd-view",classes:"start-view__drop-zone"+(a.isDnD?"":" hidden"),content:[d("div",{classes:"start-view__drop-zone-content",content:[d("span",{classes:"start-view__drop-zone-icon fonticon fonticon-5x fonticon-3dpart"}),d("span",{classes:"start-view__drop-zone-title",content:t.get("dropFiles")})]})]})}});var c;l.container.classList.add("start-view"),c=l,o=!0,r=window.requestAnimationFrame(function e(){if(o&&(setTimeout(function(){o&&(r=requestAnimationFrame(e))},500),c&&c.container)){const e=c.container.classList,t=parseInt(getComputedStyle(c.container).getPropertyValue("width").replace("px",""),10);if(t<s.small){if(e.contains(i))return;return e.remove(n),void e.add(i)}if(t<s.normal){if(e.contains(n))return;return e.remove(i),void e.add(n)}e.remove(n),e.remove(i)}}),l.toggleDnDView=(e=>{const t=l.container.querySelector("#no-content-view"),n=l.container.querySelector("#dnd-view");t&&t.classList.toggle("hidden",e),n&&n.classList.toggle("hidden",!e)});const u=l.destroy;return l.destroy=function(){l&&(l.container.removeEvents(),window.cancelAnimationFrame(r),r=null,o=!1,l.template=null,u.apply(l,arguments),l.stopListening(),l.container=null,l.model=null,l=null)},l}}),define("DS/W3DDriveApp/Views/ExternalServices/ShareContent",["UWA/Class/View","DS/UIKIT/SuperModal","DS/W3DContentApp/Utils/Helpers","DS/W3DContentApp/Utils/shareFactory","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp"],function(e,t,n,i,r){"use strict";return e.extend({setup:function(e,t={}){if(!e||!t)throw new Error("Missing input");this.inodes=[].concat(e),this.shareOptions=t,this._launch()},_launch:function(){let e="";if(this.inodes.length>1)e=r.replace(r.get("ShareSelection"),{count:this.inodes.length});else{const t=this.inodes[0];e=t.isFolder()?r.replace(r.get("ShareFolder"),{title:t.get("title")}):r.replace(r.get("ShareFile"),{title:t.get("title")})}this.modal=new t({className:"w3ddrive",renderTo:document.body}),this.modal.dialog({title:e});let i=n.getActionIds(this.inodes),o=this._extendOptions(this.inodes,this.shareOptions);this._createBody(i,o).then(e=>{const t=this.modal.modals.current.getBody();t.className="shareview__external",t.appendChild(e);const n=e.querySelector("input");n&&n.focus()})},_createBody:function(e,t){return new Promise(n=>{const o=this.modal.modals.current;let s=i.createInvitationView(this._getInputCategories(e),{placeholder:r.get("enterAnEmail")});s.container.querySelector("button.btn-primary").textContent=r.get("share");let a=s.saveProcess;s.saveProcess=function(){"function"==typeof t.onComplete&&t.onComplete(a.apply(this,arguments))},s.onClose=function(){o.hide(),s.destroy()};let d=s.destroy;s.destroy=function(){s=null,a=null,e=null,t=null,d.apply(this,arguments)},s.render(),n(s.container)})},_extendOptions:function(e,t){const n=Object.assign({},t);return n.onComplete=function(n){"function"==typeof t.onComplete&&t.onComplete(e,n)},n},_getInputCategories:function(e){return["giveReadAccess","giveEditAccess"].filter(t=>-1!==e.indexOf(t)).map(e=>{let t;switch(e){case"giveReadAccess":t="can_view";break;case"giveEditAccess":t="can_edit"}return{id:e,name:r.get(t)}})}})}),define("DS/W3DDriveApp/Utils/Actions/driveFileHistory",["UWA/Core","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/Metas/inode","DS/W3DDrive/Utils/StructureNavigation","DS/W3DContentApp/Utils/Metrics","DS/W3DContentApp/Utils/contextHelpers","DS/W3DContentApp/Utils/Actions/Iterations/Base","DS/W3DDrive/Actions/downloadAction","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp"],function(e,t,n,i,r,o,s,a,d){"use strict";return function(l){const c=new s({model:l}),u=n();return c.actions=c.actions.concat([{id:u.actionPubIds.downloadVersion,text:d.get("Download"),icon:"download",fonticon:"download",handler:function(){a({model:l})}},{id:u.actionPubIds.restore,text:d.get("Restore"),icon:"rotate-ccw",fonticon:"rotate-ccw ",handler:function(){r.trackAction({model:l,eventAction:"restoreIteration"}),i.hasRelations(l)?t.dialog({title:d.get("Restore")+" "+l.get("title"),body:e.createElement("span",{tag:"span",html:d.get("restorePointingFile")}),buttons:[{className:"primary",value:d.get("Restore"),action:function(e){e.hide(),c.dispatchIterationActions("onRestore",[l])}},{value:d.get("cancel"),action:function(e){e.hide()}}]}):c.dispatchIterationActions("onRestore",[l])}}]),c.actions=o.actionsFilters.applyCurrentContexts(c.actions),c}}),define("DS/W3DDriveApp/Views/QuotaExceededView",["UWA/Class/View","UWA/Core","DS/UIKIT/Alert","DS/UIKIT/Tooltip","DS/W3DDrive/Metas/DSDrive/inode","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp"],function(e,t,n,i,r,o){"use strict";const s=r();return e.extend({setup:function(e){const t=this;this.inode=e.inode,this.contentView=e.contentView,this.container=e.container,this.contentView.listenTo(this.inode.drive,"onChange:blockactions",function(){t.render()})},render:function(){if(this.inode.id===s.ids.root||this.isInodeOwner()){const e=this.inode.drive.get("blockactions");e&&!this.isWarningDisplayed&&this.addWarning(),!1===e&&this.isWarningDisplayed&&this.removeWarning()}},isInodeOwner:function(){let e=!1;const t=this.inode.get("owners"),n=this.inode.drive.get("user");return Array.isArray(t)&&t.forEach(t=>{t.id===n.id&&(e=!0)}),e},addWarning:function(){const e=this;this.isWarningDisplayed=!0;const r=this.container.querySelector(".scroll-view.w3ddrive");this.alertWrapper=t.createElement("div",{class:"quota-alert-wrapper"}),this.container.insertBefore(this.alertWrapper,r),this.alert=new n({className:"quota-alert",renderTo:this.alertWrapper,visible:!0,animate:!0,events:{onClick:function(){setTimeout(()=>{e.removeWarning()},500)}}});const s=t.createElement("span",{class:"quota-alert-message",text:o.get("quotaExceededWarning")}),a=t.createElement("span",{class:"fonticon fonticon-clickable fonticon-info"}),d=t.createElement("div",{html:[s,a]});this.tooltip=new i({target:a,body:{tag:"div",class:"alert-tooltip-text",html:o.get("quotaExceededDescription")},position:"bottom",autoHide:!1}),this.alert.add({message:d,className:"warning"});const l=this.alert.elements.container.querySelector(".fonticon-cancel"),c=this.alert.elements.container.querySelector(".alert-message");l.remove(),c.appendChild(l)},removeWarning:function(){this.container.removeChild(this.alertWrapper),this.isWarningDisplayed=!1},destroy:function(){this.contentView.stopListening(this.inode.drive),this.container=null,this.isWarningDisplayed&&(this.tooltip.destroy(),this.alert.destroy(),this.isWarningDisplayed=!1)}})}),define("DS/W3DDriveApp/Utils/Actions/upload-folder/FolderTree",["UWA/Class"],function(e){"use strict";return e.extend({init:function(e){this.name=e,this.children=[],this.model=null,this.parentModel=null,this.files=[]},getName:function(){return this.name},getChildren:function(){return this.children},getChild:function(e){return this.children.filter(function(t){return t.name===e}).length>1?null:this.children.filter(function(t){return t.name===e})[0]},hasChildren:function(){return this.children.length>0},doesNotHaveThisChildYet:function(e){return 0===this.children.filter(function(t){return t.getName()===e}).length},addChild:function(e){this.children.push(e)},getModel:function(){return this.model},setModel:function(e){this.model=e},getFiles:function(){return this.files},hasFiles:function(){return this.files.length>0},addFile:function(e){this.files.push(e)},getParentModel:function(){return this.parentModel},setParentModel:function(e){this.parentModel=e}})}),define("DS/W3DDriveApp/Views/ShareContentWithUsers",["UWA/Class/View","UWA/Core","UWA/Promise","DS/W3DContentApp/Components/CopyLinkToClipboard","DS/W3DContentApp/Utils/Helpers","DS/W3DContentApp/Utils/shareFactory","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Button","DS/W3DContentApp/Components/UsersInvitation","DS/W3DDrive/Metas/DSDrive/inode","DS/UIKIT/Alert","UWA/String","DS/W3DContentApp/BusEvent","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp"],function(e,t,n,i,r,o,s,a,d,l,c,u,p,h){"use strict";const f=l();return e.extend({setup:function(e,t){if(!e)throw new Error("Missing input");this.inodes=e,this.shareOptions=this.inodes.length>1?{onComplete:function(e,t){p.dispatchEvent("inodesActions:onShareAccess",[e,t])}}:{onComplete:function(e,t,n){p.dispatchEvent("inodeActions:onShareAccess",[e[0],t,n])}},this.modal=t,this.actionIds=r.getActionIds(e)},render:function(){const e=this.inodes,n=e[0].drive,i=this._extendOptions(e,n,this.shareOptions),r=t.createElement("div",{class:"sharewithusers",html:[{tag:"div",class:"shareview__description",html:this._canBeSharedWithInvite(this.inodes)?h.get("shareInfoUsersExt"):h.get("shareInfoMembers")},this._createView({actionIds:this.actionIds,inodes:e,shareOptions:i}).then(e=>{r.appendChild(e);const t=e.querySelector(".read-autocomplete input");t&&t.focus()})]});return r},_isMultipleContentShare:function(){return this.inodes.length>1},_canBeSharedByLink:function(){if(this._isMultipleContentShare())return!1;const e=this.inodes[0];return e.drive.isDsDrive&&e.get("actions").includes(f.actionPubIds.getLink)},_canBeSharedWithInvite:function(e){if(!e.length||0===e.length)return!1;return e[0].drive.get("shareWithinvitation")},_extendOptions:function(e,t,n){const i=Object.assign({},n);return i.onComplete=function(t){"function"==typeof n.onComplete&&n.onComplete(e,t)},t.get("shareWithinvitation")&&(i.onEmailAddress=o.onEmailAddress),i},_createView:function(r){let l=this;return new n(function(n){const c=r.actionIds,u=r.inodes[0],p=r.shareOptions;p.inode=u;let f=new e({className:"form-vertical form form-root"});f.render=function(){for(;f.container.firstChild;)f.container.removeChild(f.container.firstChild);l.invite=new d(c,u),f.container.appendChild(l.invite.render()),l.invite.addEvent("enableShare",()=>{l.enableShare()}),l.invite.addEvent("disableShare",()=>{l.disableShare()});const e=t.createElement("div",{class:"shareview__options2"}),n=[];-1!==c.indexOf("giveShareAccess")&&(l.reshareToggle=new s({type:"switch",id:"toggle__reshare",label:h.get("allowReshare")}),n.push(l.reshareToggle.elements.container)),n.push(o.createMessageElement()),n.reduce(function(e,t){return e.appendChild(t),e},e),f.container.appendChild(e);const r=t.createElement("div",{class:"modal-footer"});return l.buttonShare=new a({value:h.get("share"),className:"primary",disabled:!0,events:{onClick:()=>{l.shareSave(p)}}}),l.buttonShare.inject(r),new a({value:h.get("cancel"),className:"default",events:{onClick:()=>{l.modal&&l.modal.modals.current.hide()}}}).inject(r),l._canBeSharedByLink()&&(l.elements.copyLink=new i(l.inodes[0].getDirectLink(),{footerMode:!0}),r.prepend(l.elements.copyLink.getContent()),l.elements.copyLink.addEvent("onLinkCopied",()=>{l.addModalAlert(h.get("linkCopiedToClipboard"),"success")})),f.container.appendChild(r),f},f.render(),n(f.container)})},shareSave:function(e){const t=this.invite.canView&&this.invite.canView.getSelection()||[],n=this.invite.canEdit&&this.invite.canEdit.getSelection()||[],i=(this.modal.modals.current.elements.content.querySelector(".js-share-inode_message").value||"").trim(),r=(e,t)=>({id:e.hasOwnProperty("resourceid")?e.resourceid.replace(/^mailto:/,""):e.resourceid,resourceUid:e.resourceUid,type:e.type,accessright:t,message:i}),o=[...t.map(e=>r(e,"read")),...n.map(e=>r(e,"edit"))];this.reshareToggle&&this.reshareToggle.isChecked()&&o.forEach(e=>{e.accessright+="_share"}),e.onComplete(o,{}),this.modal.modals.current.hide()},enableShare:function(){this.buttonShare.enable()},disableShare:function(){this.buttonShare.disable()},addModalAlert:function(e,t){if(!this.alert){const e=this.modal&&this.modal.modals.current?this.modal.modals.current.getContent():document.body;this.alert=new c({closable:!0,visible:!0,autoHide:!0,maximumVisibleMessages:1,className:"w3ddrive-alert"}).inject(e,"top")}this.alert.add({className:t,message:"string"==typeof e?u.escapeHTML(e):e})}})}),define("DS/W3DDriveApp/Metas/permission",["DS/W3DContentApp/Metas/permission"],function(e){"use strict";return function(){var t=e();return t.roles={reader:"read",writer:"edit",delegate:"delegate",readershare:"read_share",writershare:"edit_share"},t.roleToFrontend=function(e){switch(e){case t.roles.reader:return"reader";case t.roles.writer:return"writer";case"delegate":return"delegate";case"read_share":return"readerSharer";case"edit_share":return"writerSharer";default:return""}},t}}),define("DS/W3DDriveApp/Utils/hubRequestHelper",["DS/WAFData/WAFData","DS/W3DDrive/widget"],function(e,t){"use strict";var n;return{getHeaders:function(){return{"X-DS-CSRFTOKEN":n}},getUrlWithTenant:function(e){return e+=-1!==e.indexOf("?")?"&":"?",e+="tenant="+t.getValue("x3dPlatformId")},performRequest:function(i,r){let o;i+=-1!==i.indexOf("?")?"&":"?",i+="tenant="+t.getValue("x3dPlatformId");var s=Object.assign({},r);s.type||(s.type="json"),s.headers=s.headers?s.headers:{},s.headers["X-DS-CSRFTOKEN"]=n||"",/content-type/gi.test(Object.keys(s.headers))||r.noContentType||(s.headers["Content-Type"]="application/json");var a=s.onComplete;let d;return s.onComplete=function(e,t,i){var r=Object.keys(t).filter(function(e){return-1!==e.search(/x-ds-csrftoken/i)});n=r.length>0?t[r[0]]:n,"function"==typeof a&&a(e,t,i)},s.onFailure&&(d=s.onFailure),s.onFailure=function(e,t){"function"==typeof d&&d(o.xhr.status,t,{xhr:o.xhr})},o=e.authenticatedRequest(i,s)}}}),define("DS/W3DDriveApp/Models/Permission",["UWA/Core","DS/W3DContentApp/Models/AuthModel"],function(e,t){"use strict";return t.extend({defaults:{id:void 0,displayName:"",emailAddress:"",picture:{},role:"",type:"user"},getActionIds:function(){return this.get("actions")||[]},isActionAllowed:function(e){return-1!==this.getActionIds().indexOf(e)},isActionIdoK:function(e){return this.getActionIds()[e]},destroy:function(t){return(t=e.clone(t||{},!1)).type="text",this._parent(t)}})}),define("DS/W3DDriveApp/Utils/initGuestApp",["UWA/Utils","DS/W3DDrive/initWidget","DS/PlatformAPI/PlatformAPI","DS/Usage/UsageManager","DS/UWPClientCode/PublicAPI","css!DS/W3DContentApp/W3DContentApp.css","css!DS/W3DDriveApp/W3DDriveApp.css"],function(e,t,n,i,r){"use strict";return function(o){let s=e.parseQuery(window.location.href);s.hasOwnProperty("widgetDomain")&&(s=e.parseQuery(s.widgetDomain)),o.setValue("isDrivePanelSideBarCollapsed",!0),o.setValue("firstlyLoading",!0),s.hasOwnProperty("token")?o.setValue("token",s.token):o.setValue("token",null),o.setValue("publicTenant",n.getApplicationConfiguration("app.sc.tenant"));const a=r.getUser();return"false"===r.getApplicationConfiguration("app.usage.enable")||i.init({service:"SCPresentation",uploadPath:"/upload",user:{login:a.login}}),(o=t(o)).removeEvent("onToggleDrivePanelSideBarCollapsed"),o.setValue("isStandalone",!0),o}}),define("DS/W3DDriveApp/Views/editInode",["DS/UIKIT/Form","DS/W3DContentApp/Utils/UIElementsFactory","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/BusEvent","DS/W3DContentApp/Utils/drivesInputs","DS/W3DDrive/Utils/StructureNavigation","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp"],function(e,t,n,i,r,o,s){"use strict";return function(a){if(!a)throw new Error("Missing input");const d=Boolean(a.drive.isDrivesHubDrive),l=a.getActionIds().includes("editTitle"),c=a.getActionIds().includes("changeAlias"),u=r(a),p=u.forbiddenChars.text,h=u.maxchars.maxLength,f=new e({fields:[{type:"text",name:"title",label:s.get("title"),placeholder:s.get("enterTitle"),value:a.get("alias")?a.get("alias"):a.get("title"),required:!0,spellcheck:!1,pattern:u.forbiddenChars.regex,errorText:p,maxlength:h,disabled:!c&&!l},{type:"textarea",name:"description",label:s.get("description"),placeholder:s.get("enterDescription"),value:a.get("description"),required:!1,disabled:d,spellcheck:!1,maxlength:h,errorText:s.get("charsLimitReached"),rows:4}],events:{onSubmit:function(){t.getModalSubmitButton().click()}}}),m=f.getField("title");m.addEventListener("keyup",function(e){"Escape"!==e.key&&function(){t.resetInput(m),m.value.length>=h&&t.unvalidateInput(m,{customMessage:s.get("charsLimitReached"),type:"warning"});m.checkValidity()?t.enableModalSubmitButton():(t.unvalidateInput(m,{customMessage:p,type:"error"}),t.disableModalSubmitButton());a.isFolder()&&m.value.endsWith(".")&&(t.unvalidateInput(m,{customMessage:s.get("titleCannotEndWithDot"),type:"error"}),t.disableModalSubmitButton())}()});const g=f.getField("description");if(g.addEventListener("keyup",function(e){"Escape"!==e.key&&(t.resetInput(g),this.value.length>=h&&t.unvalidateInput(g,{customMessage:s.get("charsLimitReached"),type:"warning"}))}),n.dialog({title:s.get("changeProperties"),body:f,buttons:[{className:"primary",value:s.get("Edit"),action:function(){!function(){const e=(m.value||"").trim(),t=a.get("alias")?e!==a.get("alias"):e!==a.get("title"),r=g?g.value.trim():"";if(!e)return;const d=a.get("fileExtension"),l=e.includes(".")?e.substring(e.lastIndexOf(".")+1,e.length):"",c=!a.isFolder()&&("string"==typeof d&&"string"==typeof l&&d.toLowerCase()!==l.toLowerCase());if(m.checkValidity()){if(!t&&a.get("description")===r){let e=n.modals.current;return void(e&&e.hide())}function u(t=!1){const o=()=>{const t=a.get("addtomydrive")?"inodeActions:onChangeAlias":"inodeActions:onEdit";i.dispatchEvent(t,[a,{title:e,description:r}]);let o=n.modals.current;o&&o.hide()};t?n.dialog({title:s.get("rename"),body:s.get("fileExtensionModificationDescription"),buttons:[{className:"primary",value:s.get("Yes"),action:function(){o()}},{value:s.get("No"),action:function(e){e.hide()}}]}):o()}(o.isLinkedFile(a)||o.isPart(a))&&t?n.dialog({title:s.get("renameContent",{name:a.get("title")}),body:[{tag:"span",html:s.get("confirmRenameLinkedFiles")}],buttons:[{value:s.get("rename"),action:function(){u()}},{value:s.get("cancel"),action:function(e){e.hide()}}]}):u(c)}}()}},{value:s.get("cancel"),action:function(e){e.hide()}}]}),l||c){m.focus();const e=a.isFolder()?m.value.length:m.value.toLowerCase().lastIndexOf("."+a.get("fileExtension"));m.setSelectionRange(0,e)}else g&&g.focus()}}),define("DS/W3DDriveApp/Models/InodeVersion",["UWA/Class/Model","UWA/String","UWA/Class/Promise","DS/W3DDrive/Metas/DSDrive/inode","DS/W3DContentApp/Utils/RequestHelper"],function(e,t,n,i,r){"use strict";const o=i();function s(e){return e?1e3*parseInt(e,10):null}return e.extend({drive:"",parse:function(e){return{accessright:e.accessright,actions:e.actions,created:s(e.created),description:e.description,fileExtension:e.extension,fullnameowner:e.fullnameowner,hashmd5:e.hashmd5,icon:e.icon,id:e.id,lasteditor:e.lasteditor,masterid:e.masterid,mimetype:e.mimetype,modified:s(e.modified),owner:e.owner,size:e.size,title:e.title,thumbnail:(t=this,o.thumbnails[t.collection._parentInode.get("fileExtension").toLowerCase()]||o.thumbnails.content),type:e.type};var t},getDownloadUrl:function(){const e=this,i=t.format("{0}/resources/3ddrive/v1/bos/{1}/download",this.collection._auth.getStorage().url,this.get("id"));return new n(function(t,n){r.performRequestWithOptions(i,{type:"json",onComplete:function(n){const i=n?n.url:null;e.set("downloadUrl",i),t({url:i,method:"POST"})},onFailure:n})})},setup:function(){this._parent.apply(this,arguments)},refreshPreview:function(){const e=this;this.getPreviewUrl().then(function(t){t&&t.hasOwnProperty("thumbnail")&&e.set("thumbnail",t.thumbnail)})},getPreviewUrl:function(){const e=t.format("{0}/resources/3ddrive/v1/bos/{1}/preview",this.collection._auth.getStorage().url,this.get("id"));return new n(function(t,n){r.performRequest(e,t,n)})},restoreVersion:function(){const e=this,i=this.collection,o=t.format("{0}/resources/3ddrive/v1/bos/{1}/iterations",this.collection._auth.getStorage().url,this.collection._parentInode.get("id"));return new n(function(t,n){r.performRequestWithOptions(o,{type:"json",method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},auth:e.collection._auth,data:JSON.stringify({id:e.get("id")}),onComplete:function(){i.onRestore({reset:!0,merge:!1,onComplete:t,onFailure:n})},onFailure:n})})},isActionIdoK:function(){return"download"},isActionAllowed:function(e){return!0===this.get("actions").reduce(function(e,t){return e[t]=!0,e},{})[e.replace("Version","")]},isFolder:function(){return!1}})}),define("DS/W3DDriveApp/Views/PreferencesView",["UWA/Class/View","DS/UIKIT/Input/Toggle","DS/W3DContentApp/Utils/RequestHelper","DS/W3DContentApp/Utils/Platform","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp"],function(e,t,n,i,r){"use strict";return e.extend({tagName:"div",className:"form-group preferences-view",attributes:{styles:{"margin-top":"2em"}},widget:null,events:{},currentModelTitle:null,currentNavigationFragment:null,isPinNavigationEnabled:null,savedPinNavigation:null,enablePinNavigation:null,refreshSavedPinNavigation:!1,setup:function(e={}){if(!e.widget||!e.currentModelTitle||!e.currentNavigationFragment)throw new Error("Missing options");this.widget=e.widget,this.currentModelTitle=e.currentModelTitle,this.currentNavigationFragment=e.currentNavigationFragment,this.isPinNavigationEnabled=Boolean(this.widget.getValue("enablePinNavigation")),this.savedPinNavigation=this.widget.getValue("savedPinNavigation"),this.render()},render:function(){const e=this;this._build(),this.events={endEdit:function(t){if(t.submitted){const t=null!==e.enablePinNavigation&&e.widget.getValue("enablePinNavigation")!==e.enablePinNavigation;if(t&&e.widget.setValue("enablePinNavigation",e.enablePinNavigation),t&&e.enablePinNavigation||e.refreshSavedPinNavigation){const t=new RegExp(/^drives\/([^/?]+)\/mimetype\/([^/?]+)\/inode\/([^/?]+)\/content\/([^/?]+)\/preview$/);e.currentNavigationFragment.match(t)&&(e.currentNavigationFragment=e.currentNavigationFragment.replace(/([^/?]+)\/content\//,"")),e.widget.setValue("savedPinNavigation",e.currentNavigationFragment)}const n=e.widget.getValue("selectedPlatform");n&&n!==e.widget.getValue("x3dPlatformId")&&(e.widget.setValue("x3dPlatformId",n),e.widget.deleteValue("enablePinNavigation"),e.widget.deleteValue("savedPinNavigation"),e.widget.deleteValue("saved-fragment"),window.frameElement.contentDocument.location.reload())}e.destroy()}},this.widget.addEvents(this.events)},destroy:function(){this.stopListening(),this.widget.removeEvents(this.events),this.widget=null,this.events={},this.currentModelTitle=null,this.currentNavigationFragment=null,this.isPinNavigationEnabled=null,this.savedPinNavigation=null,this.enablePinNavigation=null,this.refreshSavedPinNavigation=!1,this._parent()},_build:function(){const e=this,o=[{tag:"label",styles:{"font-size":"14px","font-weight":"bold",color:"#3d3d3d"},text:r.get("navigationPreferenceTitle")},new t({name:"preferences",className:"primary",label:r.get("defaultNavigationPreference"),checked:!this.isPinNavigationEnabled,events:{onChange:function(){e.enablePinNavigation=!1}}}),new t({name:"preferences",className:"primary",styles:{display:this._isExternalDrive()?"none":"block"},label:r.get("enablePinNavigationPreference"),checked:this.isPinNavigationEnabled,disabled:this._isExternalDrive(),events:{onChange:function(){e.enablePinNavigation=!0}}}),{tag:"div",styles:{"margin-left":"35px"},html:[{tag:"div",id:"savedPinNavigation",styles:{color:this._isExternalDrive()?"#b4b6ba":""},html:r.get("noSavedPinNavigationLabel")},new t({type:"checkbox",className:"primary",label:r.replace(r.get("refreshSavedPinNavigationPreference"),{currentNavigation:this.currentModelTitle}),disabled:this._isExternalDrive(),events:{onChange:function(){e.refreshSavedPinNavigation=this.isChecked()}}}),{tag:"div",styles:{display:this._isExternalDrive()?"block":"none","margin-top":"5px"},html:r.get("restrictSavedPinNavigation")}]}];if(this.container.addContent(o),this.isPinNavigationEnabled&&this.savedPinNavigation){this._refreshSavedPinNavigationElement(r.get("retrievingSavedPinNavigation"));const t=this.savedPinNavigation.split("/")[1],o=this.savedPinNavigation.split("/")[5];i.getAllPlatforms().then(i=>{const s=i.find(e=>e.id===t).url+"/resources/3ddrive/v1/bos/"+o;n.performRequestWithOptions(s,{method:"GET",type:"json",headers:{"Content-Type":"application/json"},onComplete:function(t){e._refreshSavedPinNavigationElement(r.replace(r.get("savedPinNavigationLabel"),{name:t.title}))},onFailure:function(){e._refreshSavedPinNavigationElement(r.get("noSavedPinNavigationLabel"))}})})}},_isExternalDrive:function(){return Boolean(this.currentNavigationFragment.match(/^drives\/(box|dropbox|google|onedrive)\/mimetype\/(.+)$/))},_refreshSavedPinNavigationElement:function(e){this.container.querySelector("#savedPinNavigation")&&(this.container.querySelector("#savedPinNavigation").innerHTML=e)}})}),define("DS/W3DDriveApp/Models/TrashInode",["UWA/String","DS/W3DContentApp/Models/Inode","DS/W3DDrive/Metas/DSDrive/inode","DS/W3DContentApp/Utils/RequestHelper"],function(e,t,n,i){"use strict";const r=n();return t.extend({parse:function(e){const t=r.actionPubIds;function n(e){if(e)return 1e3*parseInt(e,10)}var i={accessright:e.accessright,actions:function(e){if(e){var n={restore:"restore",delete:"delete"},i=e.map(function(e){return n[e]}).filter(function(e){return void 0!==e});return i.push(t.viewInformation),i}}(e.actions),addtomydrive:e.addtomydrive,blockactions:e.blockactions,createdDate:n(e.created),description:e.description,fileExtension:e.extension,owners:e.fullnameowner,id:e.id,mimeType:e.mimetype,modifiedDate:n(e.modified),oldParentId:e.oldparentid,originator:e.originator,parentId:e.parentid,root:e.root,shared:e.shared,size:e.size,title:e.title,type:e.type,thumbnailLink:this.getThumbnailLink(e),favorite:e.favorite};for(var o in i)i.hasOwnProperty(o)&&void 0===i[o]&&delete i[o];if(e.actions){var s=this.get("actions")||[],a=e.actions.length!==s.length;a||(a=s.some(function(t,n){return t!==e.actions[n]})),a&&this.dispatchEvent("onChange:actions")}return i},isContainer:function(){return!1},isFolder:function(){return this.get("mimeType")===r.mimeType.folder||this._parent()},getOwnerNames:function(){return this.get("owners")},getCreator:function(){return this.get("originator")},getThumbnailLink:function(e){var t,n=this.get("fileExtension")||e.extension||"";return e.thumbnail?t=e.thumbnail:e.type===r.boType.folder||this.get("type")===r.boType.folder?t=r.thumbnails.folder:(n=n.toLowerCase(),t=r.thumbnails[n]||r.thumbnails.content),{small:t,medium:t,large:t}},getActionIds:function(){return this.get("actions")||[]},enableDrop:function(){return!1},getDragDataType:function(){return null},getDropDataType:function(){return null},restore:function(e){e=e||{};var t=this;return new Promise(function(n,i){var r,o={url:t.url(),method:"PUT",headers:{"Content-type":"application/json; charset=UTF-8",Accept:"application/json; charset=UTF-8"},data:JSON.stringify(Object.assign({physicalid:t.id},e)),onComplete:n,onFailure:function(e){var t,n;e&&!0===e.hasOwnProperty("error")&&!0===e.error.hasOwnProperty("message")&&!0===e.error.hasOwnProperty("errorCode")&&(t=e.error.message,n=e.error.errorCode),i({status:r.xhr.status,msg:t,code:n})}};r=t.sync("update",t,o)})},loadPreview:function(){var t,n,r=this;(t=this,n=e.format("{0}/resources/3ddrive/v1/bos/{1}/preview",t._auth.getStorage().url,t.get("id")),new Promise(function(e,t){i.performRequest(n,e,t)})).then(function(e){e&&e.thumbnail&&r.set("thumbnailLink",{small:e.thumbnail,medium:e.thumbnail,large:e.thumbnail})})}})}),define("DS/W3DDriveApp/Views/Share/ShareWithExternalContainer",["UWA/Class/View","DS/W3DDriveShare/views/ShareWithExternalView","DS/UWPClientControls/PlatformNotify","DS/UIKIT/Alert","UWA/String","DS/W3DDrive/widget","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp"],function(e,t,n,i,r,o,s){"use strict";return e.extend({className:"share-with-external-container",inode:null,modal:null,setup:function(e,t){if(!e)throw new Error("Missing input");return this.inode=e,this.modal=t,this.render(),this},render:function(){const e=new t({platformId:this.inode._auth.platformId,inodeId:this.inode.get("id"),contextAppId:o.getValue("appId")});this.container.appendChild(e.container);const i=()=>{this.modal&&this.modal.modals&&this.modal.modals.current&&this.modal.modals.current.hide()};e.addEvent("onCancel",()=>{i()}),e.addEvent("onLinkCopied",()=>{this.addModalAlert(s.get("linkCopiedToClipboard"),"success")}),e.addEvent("onLinkEnabled",()=>{this.inode.set("shared",!0),this.addModalAlert(s.get("linkCreated"),"success")}),e.addEvent("onLinkActivationFailed",()=>{this.addModalAlert(s.get("linkCreationError"),"error")}),e.addEvent("onLinkDisabled",()=>{this.addModalAlert(s.get("linkDeleted"),"success")}),e.addEvent("onLinkDeactivationFailed",()=>{this.addModalAlert(s.get("linkDeletionError"),"error")}),e.addEvent("onCommentsEnabled",()=>{this.addModalAlert(s.get("guestCommentsActivationSuccess"),"success")}),e.addEvent("onCommentsActivationFailed",()=>{this.addModalAlert(s.get("guestCommentsActivationFailed"),"error")}),e.addEvent("onCommentsDisabled",()=>{this.addModalAlert(s.get("guestCommentsDeactivationSuccess"),"success")}),e.addEvent("onCommentsDeactivationFailed",()=>{this.addModalAlert(s.get("guestCommentsDeactivationFailed"),"error")}),e.addEvent("onRestrictedEnabled",()=>{this.addModalAlert(s.get("restrictedLinkActivationSuccess"),"success")}),e.addEvent("onRestrictedActivationFailed",()=>{this.addModalAlert(s.get("restrictedLinkActivationError"),"error")}),e.addEvent("onRestrictedDisabled",()=>{this.addModalAlert(s.get("restrictedLinkDeactivationSuccess"),"success")}),e.addEvent("onRestrictedDeactivationFailed",()=>{this.addModalAlert(s.get("restrictedLinkDeactivationError"),"error")}),e.addEvent("onShared",()=>{i(),n.success(s.get("authorizedUsersAdditionSuccess"))}),e.addEvent("onShareFailed",()=>{this.addModalAlert(s.get("authorizedUsersAdditionFailed"),"error")}),e.addEvent("onAuthorizedUserRemoved",()=>{this.addModalAlert(s.get("authorizedUserRemovalSuccess"),"success")}),e.addEvent("onAuthorizedUserRemovalFailed",()=>{this.addModalAlert(s.get("authorizedUserRemovalFailed"),"error")})},addModalAlert:function(e,t){if(!this.alert){const e=this.modal&&this.modal.modals.current?this.modal.modals.current.getContent():document.body;this.alert=new i({closable:!0,visible:!0,autoHide:!0,maximumVisibleMessages:1,className:"w3ddrive-alert"}).inject(e,"top")}this.alert.add({className:t,message:"string"==typeof e?r.escapeHTML(e):e})}})}),define("DS/W3DDriveApp/Models/DrivesHub/Permission",["DS/W3DContentApp/Models/AuthModel","DS/WebappsUtils/WebappsUtils"],function(e,t){"use strict";return e.extend({idAttribute:"id",parse:function(e){return{id:e.id,title:e.displayName||e.emailAddress,picture:e.thumbnail||t.getWebappsAssetUrl("W3DContentApp","thumbnails/default-people.png"),emailAddress:e.emailAddress,accessright:function(e){if(!e)throw new Error("Missing input");return{OWNER:"owner",READER:"can_view",WRITER:"can_edit"}[e.role]}(e),actions:function(e){if(!e)throw new Error("Missing input");var t=e.actions||[],n={CAN_MAKE_READER:"makeReader",CAN_MAKE_WRITER:"makeWriter",CAN_REVOKE:"removePermission"};return t.map(function(e){return n[e]})}(e)}},save:function(e,t){if(!e)return this._parent(this,t);var n=Object.assign({headers:{"Content-Type":"application/json"},data:JSON.stringify({role:e.accessright})},t);return this._parent(this,n)},getActionIds:function(){return this.get("actions")||[]},isActionAllowed:function(e){return-1!==this.getActionIds().indexOf(e)}})}),define("DS/W3DDriveApp/Utils/Actions/share-with-external",["DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/BusEvent","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp"],function(e,t,n){"use strict";return function(i){return i.actions.push({id:"removePermission",text:n.get("revokeAccess"),icon:"fonticon fonticon-block",handler:function(){var r=i.model;e.dialog({title:n.get("revokeAccess"),body:n.replace(n.get("revokeAccessDescription"),{name:r.get("displayName")}),buttons:[{className:"primary",value:n.get("Revoke"),action:function(e){e.hide(),t.dispatchEvent("permission:onRemoveLinkAuthorization",[r])}},{value:n.get("cancel"),action:function(e){e.hide()}}]})}}),i}}),define("DS/W3DDriveApp/Utils/AutoRefresh",["DS/W3DDrive/Metas/DSDrive/inode","DS/W3DContentApp/Utils/Alert","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp"],function(e,t,n){"use strict";const i=e().ids;let r,o;const s="created",a="renamed",d="moved",l="modified",c="removed",u="trashed",p="restored",h="erased",f="share.create",m="share.modify",g="removedfrommydrive",v="thumbnail";return{setw3dDriveView:function(e){r||(r=e)},setRouter:function(e){o||(o=e)},processEvent:function(e={},t){if(!t||t&&[g,v].includes(e.action)){if(r.getSecondPanel().model.drive.get("id")===e.tenant)switch(e.action){case s:this.processCreationEvent(e);break;case v:this.processThumbnailEvent(e);break;case a:this.processRenameEvent(e);break;case l:this.processModificationEvent(e);break;case d:case p:this.processMovingEvent(e);break;case c:case h:case g:this.processRemovalEvent(e);break;case u:this.processTrashedEvent(e);break;case f:this.processShareCreationEvent(e);break;case m:this.processShareModifyEvent(e)}}},processShareModifyEvent:function(e){const t=r.getSecondPanel().model,n=t.drive;e.parentid=i.sharedWithMe;const o=n.getInode(e.id,{noCreate:!0}),s=t&&o&&t.id===o.get("parentId");if(o&&s){const e=o.get("thumbnailLink");o.fetch({onComplete:function(){e&&o.set("thumbnailLink",e)}})}},processTrashedEvent:function(e){const t=r.getSecondPanel().model,n=t.drive,o=n.getInode(i.trash),s=n.getInode(e.id,{noCreate:!0}),a=t&&s&&t.id===s.get("parentId");if(t&&t.id===i.trash&&o){const t=o.inodeTable.add({items:[e]},{parse:!0});if(!Array.isArray(t)||0===t.length)return;t[0].fetch({data:{withactions:!0}})}if(s)if(a)D({currentFolder:t,inodeToRemove:s});else{const e=s.get("parentId"),n=t.drive.getInode(e,{noCreate:!0});n&&S({currentFolder:t,inodeToRemove:s,parentFolder:n})}},processThumbnailEvent:function(e){const t=r.getSecondPanel().model.drive.getInode(e.id,{noCreate:!0});t&&e.thumbnail&&t.set("thumbnailLink",{medium:e.thumbnail})},processCreationEvent:function(e){const t=r.getSecondPanel().model,n=t&&t.id===e.parentid,i=t.drive;if(n){const t=i.getInode(e.parentid,{noCreate:!0});if(!t||!t.inodeTable)return;const n=t.inodeTable.add({items:[e]},{parse:!0});if(!Array.isArray(n)||0===n.length)return;n[0].fetch()}},processShareCreationEvent:function(e){const t=r.getSecondPanel().model,n=t.drive;if(e.parentid=i.sharedWithMe,t&&t.id===e.parentid){const t=n.getInode(i.sharedWithMe).inodeTable.add({items:[e]},{parse:!0});if(!Array.isArray(t)||0===t.length)return;t[0].fetch()}},processRenameEvent:function(e){const t=r.getSecondPanel().model,n=t.drive.getInode(e.id,{noCreate:!0}),i=t&&n&&t.id===n.get("parentId");n&&i&&n.set("title",e.title)},processModificationEvent:function(){},processRemovalEvent:function(e){const t=r.getSecondPanel().model,n=t.drive.getInode(e.id,{noCreate:!0}),i=t&&t.id===n.get("parentId");if(n)if(i)D({currentFolder:t,inodeToRemove:n});else{const e=n.get("parentId"),i=t.drive.getInode(e,{noCreate:!0});i&&S({currentFolder:t,inodeToRemove:n,parentFolder:i})}},processMovingEvent:function(e){const s=r.getSecondPanel().model,a=s.drive,d=a.getInode({id:e.id},{noCreate:!0}),l=a.getInode({id:e.parentid},{noCreate:!0});if(!d)return void this.processCreationEvent(e);const c=a.getInode(d.get("parentId"));d.isFolder()&&a.getInodesPath(s).then(i=>{i.some(t=>t.id===e.id)&&t.add({message:n.get("folderMoved",{parentFolder:d.get("title")}),className:"warning"})}),l&&e.parentid!==i.root?(e.parentid===i.sharedWithMe&&a.get("user").id===e.owner&&(e.parentid=i.root),d.set(d.parse(e)),"/"+o.getLastFragment()===a.getInodePreviewURI(d)&&(d.listenToOnce(d,"onAdd",function(e){o.navigate(a.getInodePreviewURI(e),{trigger:!0})}),t.add({message:n.get("fileMoved"),className:"primary"}))):c.inodeTable.remove(d)}};function D(e={}){const i=e.currentFolder,s=e.inodeToRemove;"/"+o.getLastFragment()===i.drive.getInodePreviewURI(s)&&(t.add({message:n.get("fileDeleted"),className:"warning"}),o.navigate(i.drive.getInodePanelContentURI(i),{trigger:!1}),r.hideLightbox()),i.inodeTable.remove(s)}function S(e={}){const i=e.currentFolder,s=e.inodeToRemove,a=e.parentFolder;i.drive.getInodesPath(i).then(e=>{if(!e.some(e=>e.id===s.get("id"))||!a)return;const d=s!==i?n.get("parentFolderDeleted",{parentFolder:s.get("title")}):n.get("folderDeleted");t.add({message:d,className:"warning"}),o.navigate(i.drive.getInodePanelContentURI(a),{trigger:i.isContainer()}),r.hideLightbox()}).then(()=>{a.inodeTable.remove(s)})}}),define("DS/W3DDriveApp/Views/Share/ShareWithUsersContainer",["UWA/Class/View","DS/W3DDriveShare/views/ShareWithUsersView","DS/UWPClientControls/PlatformNotify","DS/UIKIT/Alert","UWA/String","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp"],function(e,t,n,i,r,o){"use strict";return e.extend({className:"share-with-users-container",inodes:[],modal:null,setup:function(e=[],t){if(!e&&!e.length)throw new Error("Missing input");return this.inodes=e,this.modal=t,this.render(),this},render:function(){const e=new t({platformId:this.inodes[0].drive.id,currentUserId:this.inodes[0].drive.get("user").id,shareMultiple:!0,inodes:this.inodes.map(e=>e.toJSON())});this.container.appendChild(e.container);const i=()=>{this.modal&&this.modal.modals&&this.modal.modals.current&&this.modal.modals.current.hide()};e.addEvent("onLinkCopied",()=>{this.addModalAlert(o.get("linkCopiedToClipboard"),"success")}),e.addEvent("onShare",()=>{i()}),e.addEvent("onShared",e=>{const t=(e=JSON.parse(e)).accesses||[];i(),n.success(o.get("shareSelectionSuccess")),this.inodes.forEach(e=>{e.set("shared",!0),t.forEach(t=>{const n=e.permissions.findWhere({id:t.id});n?n.set(t):e.permissions.add({items:[t]},{parse:!0})})})}),e.addEvent("onShareCancel",()=>{i()})},addModalAlert:function(e,t){if(!this.alert){const e=this.modal&&this.modal.modals.current?this.modal.modals.current.getContent():document.body;this.alert=new i({closable:!0,visible:!0,autoHide:!0,maximumVisibleMessages:1,className:"w3ddrive-alert"}).inject(e,"top")}this.alert.add({className:t,message:"string"==typeof e?r.escapeHTML(e):e})}})}),define("DS/W3DDriveApp/Views/inodePropertiesView3DDriveContainer",["UWA/Class/View","DS/W3DContentApp/Utils/Helpers","DS/W3DContentApp/Views/InodeDetailView/inodePropertiesView","DS/UIKIT/Scroller","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp"],function(e,t,n,i,r){"use strict";return function(o){if(!o||!o.model)throw new Error("Missing input");var s,a=new e,d=a.destroy,l=a.render;return o.listProperties=[{key:"originalName",attribute:"title",nls:r.get("originalName"),type:"string",value:function(e){if(e.get("alias"))return e.get("title")}},{key:"alias",attribute:"alias",nls:r.get("alias"),type:"string"},{key:"type",attribute:"mimeType",nls:r.get("type"),type:"string",value:function(e){return e.isFolder()?r.folder:r.file}},{key:"fileType",attribute:"fileExtension",nls:r.get("fileType"),type:"string",value:function(e){return t.computeFileExtension(e.get("fileExtension"))}},{key:"size",attribute:"size",nls:r.get("size"),type:"bytes"},{key:"owner",attribute:"owners",nls:r.get("owner"),type:"string",value:function(e){return e.getOwnerNames()}},{key:"originator",attribute:"originator",nls:r.get("creator"),type:"string",value:function(e){return e.get("originator")}},{key:"lastEditor",attribute:"lastEditor",nls:r.get("lastEditor"),type:"string"},{key:"createdDate",attribute:"createdDate",nls:r.get("dateCreated"),type:"date"},{key:"modifiedDate",attribute:"modifiedDate",nls:r.get("dateModified"),type:"date"},{key:"description",attribute:"description",nls:r.get("description"),type:"string"}],s=n(o),a.elements.propertiesView=s,a.container.appendChild(s.container),s.container.classList.add("inode-detail__body"),new i({element:a.container}),Object.assign(a,{render:function(){return s.render(),l(),a},destroy:function(){d.apply(a,arguments),a.container=null,a.stopListening(),a.model=null}})}}),define("DS/W3DDriveApp/Utils/Actions/addToMyDrive",["DS/W3DContentApp/Utils/Alert","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/Utils/RequestHelper","UWA/Class/Promise","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp"],function(e,t,n,i,r){"use strict";return function(n,i){n&&("add"===i.action?function(t){o({method:"POST",inode:t,data:{objectid:t.get("id"),service:"drive",tenant:t._auth.platform.id,sharer:t.drive.get("user").id,restricted:"false"}}).then(function(n){if(n[0].addtomydrive){var i=t.get("actions").slice();i.splice(i.indexOf("addToMyDrive"),1),t.set("actions",i)}e.add({message:r.get("addToMyDriveSuccess",{name:t.get("title")}),className:"success"})},function(n){Array.from(n).includes(412)?e.add({message:r.get("childAlreadyExists"),className:"error"}):e.add({message:r.get("addToMyDriveError",{name:t.get("title")}),className:"error"})})}(n):"remove"===i.action&&function(n,i){var s=i.dispatchEvent,a={title:r.get("removeElement",{name:(n.get("alias"),n.get("title"))}),body:r.get("removeElementBody"),buttons:[{className:"primary",value:r.get("remove"),action:function(t){t.hide(),o({method:"DELETE",inode:n}).then(function(){e.add({message:r.get("removeFromMyDriveSuccess",{name:n.get("alias")}),className:"success"}),s("removeFromMyDrive",n)},function(){e.add({message:r.get("removeFromMyDriveError",{name:n.get("alias")}),className:"error"})})}},{value:r.get("cancel"),action:function(e){e.hide()}}]};t.dialog(a)}(n,i))};function o(e){if(!e.inode)throw new Error("inode object parameter is expected");var t=e.inode,r=e.inode._auth.platform.url+"/resources/3ddrive/v1/sharedcontent/"+t.get("id")+"?withactions=true",o=e.requestOptions||{};return e.data&&(o.data=e.data),e.method&&(o.method=e.method),o.data&&(o.data=JSON.stringify(o.data)),new i(function(t,i){n.performRequestWithOptions(r,Object.assign({method:"GET",type:"json",auth:e.inode._auth,headers:{"Content-Type":"application/json"},onComplete:function(){return t(arguments)},onFailure:function(){return i(arguments)}},o))})}}),define("DS/W3DDriveApp/Utils/actionsFiltering",["DS/W3DContentApp/Utils/IntegrationHelper"],function(e){"use strict";var t={filterSharedWithMeChild:function(e){return e.filter(function(e){switch(e){case"edit":case"delete":case"deletefinal":case"moveTo":return!1;default:return!0}})},filterSharedByLink:function(e){return e.filter(function(e){switch(e){case"edit":case"update":case"delete":case"deletefinal":case"moveTo":case"copy":case"openWith":case"viewPermissions":return!1;default:return!0}})},filterSharedByLinkMultiSel:function(e){return e.filter(function(e){switch(e){case"edit":case"update":case"delete":case"deletefinal":case"moveTo":case"comment":case"copy":case"openWith":case"viewPermissions":case"download":return!1;default:return!0}})},manageActionOpeningForFiles:function(t,n){return e.SWIntegration&&e.SWIntegration.insertIsAvailable(JSON.stringify({fileExtension:n.get("fileExtension").toLowerCase()}))?t.concat(["insert"]):e.CATIAV5?t.filter(function(e){switch(e){case"preview":return!1;default:return!0}}):t}};return t}),define("DS/W3DDriveApp/Views/createFolder",["DS/UIKIT/Form","DS/W3DContentApp/Utils/UIElementsFactory","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/BusEvent","DS/W3DContentApp/Utils/drivesInputs","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp"],function(e,t,n,i,r,o){"use strict";return function(s){if(!s)throw new Error("Missing input");const a=Boolean(s.drive.isDrivesHubDrive),d=r(s),l=d.forbiddenChars.text,c=d.maxchars.maxLength,u=new e({fields:[{type:"text",name:"title",label:o.get("title"),placeholder:o.get("enterTitle"),required:!0,spellcheck:!1,pattern:d.forbiddenChars.regex,errorText:l,maxlength:c},{type:"textarea",name:"description",label:o.get("description"),placeholder:o.get("enterDescription"),required:!1,disabled:a,spellcheck:!1,maxlength:c,errorText:o.get("charsLimitReached"),rows:4}],events:{onSubmit:function(){t.getModalSubmitButton().click()}}}),p=u.getField("title");p.focus(),p.addEventListener("keyup",function(e){"Escape"!==e.key&&f()});const h=u.getField("description");function f(){t.resetInput(p),p.value.length>=c&&t.unvalidateInput(p,{customMessage:o.get("charsLimitReached"),type:"warning"}),p.checkValidity()?t.enableModalSubmitButton():(t.unvalidateInput(p,{customMessage:l,type:"error"}),t.disableModalSubmitButton()),(p.value||"").trim().endsWith(".")&&(t.unvalidateInput(p,{customMessage:o.get("titleCannotEndWithDot"),type:"error"}),t.disableModalSubmitButton())}h.addEventListener("keyup",function(e){"Escape"!==e.key&&(t.resetInput(h),this.value.length>=c&&t.unvalidateInput(h,{customMessage:o.get("charsLimitReached"),type:"warning"}))}),s.drive&&s.drive.isDsDrive&&s.inodeTable.autoname(o.get("newFolder")).then(e=>{p.value=e.iteration?o.get("newFolderAutoname",{title:e.title,iteration:e.iteration}):o.get("newFolder"),p.focus(),p.setSelectionRange(0,p.value.length),f()}),n.dialog({title:o.get("createFolder"),body:u,buttons:[{className:"primary",value:o.get("create"),action:function(){!function(){const e=n.modals.current,t=(p.value||"").trim(),r=(h.value||"").trim();if(!t)return;u.validate()&&(i.dispatchEvent("inodeActions:onCreateFolder",[s,"text/directory",{title:t,description:r}]),e&&e.hide())}()}},{value:o.get("cancel"),action:function(e){e.hide()}}]}),t.disableModalSubmitButton()}}),define("DS/W3DDriveApp/Utils/drivesHubConnect",["DS/WAFData/WAFData","UWA/Class/Promise","DS/W3DDriveApp/Utils/hubRequestHelper","DS/W3DContentApp/Utils/Platform"],function(e,t,n,i){"use strict";return{createAuth:d,tryFetch:function(e,n=[]){if(!e)return t.resolve([]);return t.resolve({baseURL:e,authorizedProviders:n}).then(r).then(o).then(s).catch(function(){return[]})}};function r(e={}){const i=e.baseURL+"/drive/v1/providers?expand=true";return new t((t,r)=>{n.performRequest(i,{onComplete:n=>{n=n.filter(t=>e.authorizedProviders.includes(t.driveId)),t({drives:n,url:e.baseURL})},onFailure:(e,t)=>{r(t)}})})}function o(t){let n=t.drives;const i=t.url;return n="string"==typeof n?JSON.parse(n):n,Array.isArray(n)&&0!==n.length?n.map(t=>({id:t.driveId,title:t.driveName,url:i,iconLink:e.proxifyUrl(t.driveIcon),thumbnailLink:e.proxifyUrl(t.driveIcon),isDrivesHubProvider:!0})):[]}function s(e){return t.all(e.map(e=>(function(e){const i=e.url+"/drive/v1/"+e.id+"/connect";return new t((e,t)=>{n.performRequest(i,{onComplete:t=>{e(t)},onFailure:()=>{t(Error("No auth"))}})})})(e).then(t=>e=Object.assign(e,{auth:d({drive:e,authenticated:!0}),user:{emailAddress:t.email,name:t.name}})).catch(function(){return e.auth=d({drive:e,authenticated:!1}),e})))}function a(e){const r=e.url+"/drive/v1/"+e.id+"/connect",o={box:{id:"box",scope:""},dropbox:{id:"dropbox",scope:""},google:{id:"gplus",scope:"https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/drive https://www.googleapis.com/auth/drive.file"},onedrive:{id:"live",scope:"Files.ReadWrite.All User.Read offline_access"}};return new t((s,a)=>{(function(e){return new t((t,i)=>{n.performRequest(e,{onComplete:e=>{t({authenticated:!0,email:e.email})},onFailure:(e,n)=>401!==e?i(n):t({authenticated:!1})})})})(r).then(t=>{const d=t.authenticated,l=t.email;if(d)s({authenticated:!0,email:l});else{let t;i.getPassportUrl().then(i=>{i&&(i=i.replace("/cas/",""),i+="/oauth/authenticate/"+o[e.id].id),n.performRequest(i,{data:{scope:o[e.id].scope},onComplete:e=>{const n=window.screen.width/2-375,i=window.screen.height/2-375;(t=window.open("about:blank","blank",`left=${n},top=${i},width=750,height=750,resizable=yes`))&&(t.location=e.redirect_uri)},onFailure:a})});const d=window.setInterval(()=>{t&&!t.closed||(window.clearInterval(d),n.performRequest(r,{onComplete:e=>{s({authenticated:!0,email:e.email})},onFailure:a}))},500)}},()=>{a()})})}function d(e){return{adaptater:{},adaptaterOptions:{},authenticate:(t,n)=>{a(e.drive).then(e=>{t(e)},e=>{n(e)})},data:{},hasIdentity:(t,n)=>e.authenticated?t():n()}}}),define("DS/W3DDriveApp/Utils/Actions/upload-folder/upload-folder",["DS/W3DDriveApp/Utils/Actions/upload-folder/FolderTree","DS/W3DContentApp/Actions/upload-manager/upload-manager","DS/W3DDrive/Utils/errors","DS/W3DContentApp/Utils/Alert","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp"],function(e,t,n,i,r){"use strict";const o=e=>{return e>200&&(i.add({message:r.get("tooManySubFolders",{limit:200}),className:"error"}),!0)},s=e=>{if(null!==e.getModel()){o(e.getModel(),e.getFiles)}else{(function(n,o){return new Promise(function(s,a){t.askForFolderCreation(n,o,{onComplete:function(e){e.collection&&e.cid!==e.collection.get(e.id).cid?s(e.collection.get(e.id)):s(e)},onFailure:function(){i.add({message:r.get("createError",{name:e.getName()}),className:"error"})}})})})(e.getParentModel(),e.getName()).then(function(t){e.setModel(t);const n=e.getFiles();0!==n.length&&o(t,n);for(const n of e.getChildren())n.setParentModel(t),s(n)})}function o(e,o){return new Promise(function(s){t.askForUpload(e,o,{onComplete:function(e){s(e)},onFailure:function(e,t){if(void 0!==t){var o="function"==typeof e.get?e.get("title"):e.title,s=r.get("uploadError",{name:o||""});t&&t.error&&"quotaExceed"===t.error.errorCode?s+=": "+r.get("allocatedDiskSpaceExceeded"):"Access denied"===t.message&&(s+=" "+r.get("accessDenied")),e&&e.destroy&&e.destroy(),t instanceof n.UploadError&&(s+=": "+t.message),i.add({message:s,className:"error"})}else e&&e.destroy&&e.destroy()}})})}};return{processFolderDnD:function(t,n){if(!t||!n)throw new Error("Missing input");let i=0;return new Promise(function(a){const d=[];let l;for(let e=0;e<n.items.length;e++)d.push(n.items[e].webkitGetAsEntry());!function n(c){c<d.length?new Promise(n=>{const a=d[c];a&&a.isDirectory?((l=new e(a.name)).setParentModel(t),function(t,n){const o=n.createReader();return new Promise((n,s)=>{const a=[];!function d(){o.readEntries(o=>{o.length?(a.push(Promise.all(o.map(n=>{if(n.isFile)return n.file(function(e){t.addFile(e)}),n;let o=new e(n.name);return t.addChild(o),i++,function(t,n){const o=n.createReader();return new Promise((n,s)=>{const a=[];!function d(){o.readEntries(o=>{o.length?(a.push(Promise.all(o.map(n=>{if(n.isFile)return n.file(function(e){t.addFile(e)}),n;let o=new e(n.name);return t.addChild(o),i++,r(o,n)}))),d()):n(Promise.all(a))},e=>s(e))}()})}(o,n)}))),d()):n(Promise.all(a))},e=>s(e))}()})}(l,a).then(function(e){e.length&&(o(i)||n(s(l))),n(c)})):n(c)}).then(n.bind(null,c+1)):a()}(0)});function r(t,n){const o=n.createReader();return new Promise((n,s)=>{const a=[];function d(){o.readEntries(o=>{if(!o.length){n(Promise.all(a))}else{a.push(Promise.all(o.map(n=>{if(n.isFile){n.file(function(e){t.addFile(e)});return n}let o=new e(n.name);t.addChild(o);i++;return r(o,n)})));d()}},e=>s(e))}d()})}},processFolder:function(t,n){if(!t||!n)throw new Error("Missing input");return new Promise(i=>{let r=0;const a=t[0].webkitRelativePath.split("/")[0],d=new e(a);d.setParentModel(n);for(const n of t){let t=d;const i=n.webkitRelativePath.split("/");i.shift();for(let o=0;o<i.length;o++)if(o===i.length-1)t.addFile(n);else if(t.doesNotHaveThisChildYet(i[o])){let n=new e(i[o]);t.addChild(n),t=n,r++}else t=t.getChild(i[o])}o(r)||i(s(d))})}}}),define("DS/W3DDriveApp/Views/ShareModal",["UWA/Class/View","UWA/Core","DS/UIKIT/SuperModal","DS/UIKIT/Toggler","DS/W3DDriveApp/Views/ShareContentWithUsers","DS/W3DContentApp/Views/PublishTo3DSwymService","DS/W3DDriveApp/Views/Share/ShareWithExternalContainer","DS/W3DContentApp/Utils/Helpers","DS/W3DDrive/Metas/DSDrive/inode","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp","css!DS/W3DDriveApp/W3DDriveApp.css"],function(e,t,n,i,r,o,s,a,d,l){"use strict";const c=d();return e.extend({modal:null,inodes:[],setup:function(e={}){if(!e.models)throw new Error("Missing input");this.inodes=[].concat(e.models),this._launch()},_launch:function(){let e="";if(this.inodes.length>1)e=l.replace(l.get("ShareSelection"),{count:this.inodes.length});else{e=this.inodes[0].isFolder()?l.get("ShareFolder"):l.get("ShareFile")}this.modal=new n({className:"w3ddrive share-modal",renderTo:document.body,events:{onShow:()=>{new i({container:document.querySelector("#share-tabs"),bind:document.querySelector("#share-sections"),events:{onToggle:function(e,t,n){if(n&&e&&e.classList.contains("share-with-users")){const e=this.options.bind.getElement("section.share-with-users").querySelector("input.temp-autocomplete-input");e&&e.focus()}}}})},onHide:()=>{this.modal&&this.modal.destroy(),this.destroy()}}}),this.modal.dialog({title:e,body:this._buildBody()})},_buildBody:function(){const e=t.createElement("nav",{class:"tab",id:"share-tabs",html:[this._canBeSharedWithUsers()?{tag:"a",class:"tab-item share-with-users",html:[{tag:"span",class:"fonticon fonticon-users-add"},{tag:"span",text:l.get("ShareWithUsers")}]}:"",this._canBeSharedTo3DSwym()?{tag:"a",class:"tab-item publish-to-3dswym",html:[{tag:"span",class:"fonticon fonticon-logo-3dswym"},{tag:"span",text:l.get("PublishTo3DSwym")}]}:"",this._canBeSharedWithExternal()?{tag:"a",class:"tab-item share-with-external",html:[{tag:"span",class:"fonticon fonticon-forward-globe"},{tag:"span",text:l.get("ShareWithExternal")}]}:""]});return this._canBeSharedTo3DSwym()&&(this.elements.publishFormView=new o(this.inodes[0])),[e,t.createElement("section",{id:"share-sections",html:[this._canBeSharedWithUsers()?{tag:"section",class:"hide share-with-users",html:new r(this.inodes,this.modal).render()}:"",this._canBeSharedTo3DSwym()?{tag:"section",class:"hide publish-to-3dswym",html:this.elements.publishFormView.render()}:"",this._canBeSharedWithExternal()?{tag:"section",class:"hide share-with-external",html:new s(this.inodes[0],this.modal)}:""]})]},_canBeSharedWithUsers:function(){return a.getActionIds(this.inodes).some(e=>["giveReadAccess","giveEditAccess"].includes(e))},_isMultipleContentShare:function(){return this.inodes.length>1},_canBeSharedTo3DSwym:function(){if(this._isMultipleContentShare())return!1;const e=this.inodes[0];return e.drive.isDsDrive&&!e.isFolder()&&e.get("actions").includes(c.actionPubIds.publishTo3DSwym)},_canBeSharedWithExternal:function(){if(this._isMultipleContentShare())return!1;const e=this.inodes[0],t=e.drive;return t.isDsDrive&&t.get("shareWithExternal")&&e.get("actions").includes(c.actionPubIds.shareLink)}})}),define("DS/W3DDriveApp/Models/DrivesHub/Inode",["DS/WAFData/WAFData","UWA/Class/Promise","DS/W3DContentApp/Models/Inode","DS/W3DDrive/Metas/DSDrive/inode","DS/W3DContentApp/Metas/drive","DS/W3DDriveApp/Utils/hubRequestHelper","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp"],function(e,t,n,i,r,o,s){"use strict";const a=i(),d=r();return n.extend({idAttribute:"id",defaults:{actions:[],thumbnailLink:""},url:function(e){return this.drive.url()+"/contents/"+this.id+({download:"/stream",move:"?removeParent="+this.get("parentId"),getLink:"/getlink"}[e]||"")},fetch:function(e){return e=e||{},this._parent(e)},parse:function(e){if(e){var t=e.name;"root"!==e.name&&"root"!==e.id||"hiddenroot"!==e.parentId?"sharedwithme"===e.id&&"hiddenroot"===e.parentId&&(t=s.get("sharedWithMe")):t=s.get("myFiles");var n={accessright:"owner",actions:function(e,t){if(!t)throw new Error("Missing input");const n=a.actionPubIds;var i=t.actions||[];l(t.type)||i.includes("download")&&i.push("preview");var r={"add.folder":n.createFolder,"add.file":n.upload,delete:n.del,move:n.moveTo,"edit.title":n.editTitle,copy:n.copy,download:n.download,preview:n.preview,"share.read":n.giveReadAccess,"share.edit":n.giveEditAccess,"list.permissions":n.viewAccesses,"upload.folder":n.uploadFolder,getlink:n.getLink},o=e&&e.drive?e.drive.id:e.collection._parentInode.drive.id,s=i.map(function(e){return r[e]}).filter(function(e){return"moveTo"===e&&("google"===o&&"sharedwithme"===t.parentId||"onedrive"===o)&&(e=void 0),void 0!==e});"hiddenroot"!==t.parentId&&s.push(n.viewInformation);return i.some(e=>!!["edit.title"].includes(e)&&(s.push(n.changeProperties),!0)),i.some(function(e){return!!["share.read","share.edit"].includes(e)&&(s.push(n.share),s.push(n.shareWithUsers),!0)}),s}(this,e),createdDate:e.created,fileExtension:e.extension,iconLink:function(e){if(l(e.type))return"folder";return e.icon}(e),id:e.id,mimeType:e.type,modifiedDate:e.lastModified,owner:e.owner?e.owner.replace(/"/g,""):"",owners:function(e){if(!e.owner)return{};return{displayName:e.owner.replace(/"/g,""),id:e.owner.replace(/"/g,"")}}(e),parentId:function(e,t){var n=t.collection?t.collection:"trueRootId",i=e.parentId?e.parentId.replace(/"/g,""):n;if("hiddenroot"===i)return"trueRootId";return i}(e,this),size:e.size,title:t,thumbnailLink:function(e){var t,n=e.extension,i={};e.thumbnail?t=e.thumbnail:l(e.type)?t=e.shared?a.thumbnails.sharedFolder:a.thumbnails.folder:n&&i&&(t=a.thumbnails[n.toLowerCase()]||a.thumbnails.content);t?(i.medium=t,i.small=t,i.large=t):i.medium=a.thumbnails.content;return i}(e),shared:e.shared,secondaryType:e.mimeType};for(var i in n)n.hasOwnProperty(i)&&void 0===n[i]&&delete n[i];return n}},save:function(e,t){if(!(e=e||{})||0===Object.keys(e).length)return this._parent(e,t);var n=Object.assign({},{data:JSON.stringify({name:e.title})},t);return this._parent(e,n)},sync:function(e,t,n){var i=Object.assign({ajax:o.performRequest},n);return"create"===e?(t.isFolder()&&t.set("type","drivehub/folder"),t.get("title")&&t.set("name",t.get("title")),i.url=t.collection.url()):("patch"===e&&(e="update",i&&i.data&&i.data.parentid&&(i.data.parentId=i.data.parentid),i.data=JSON.stringify(i.data)),"update"===e&&(i.data||(i.data=JSON.stringify(t._changed)),i.headers={"Content-type":"application/json; charset=UTF-8",Accept:"application/json; charset=UTF-8"})),"move"===n.action&&(i.url=this.url(n.action)),this._parent(e,t,i)},get3DPlayOptions:function(){var t=this.get("fileExtension");return t||(t=this.getDerivedFormat()),this._parent({asset:{provider:"FILE",filename:e.proxifyUrl(o.getUrlWithTenant(this.url("download"))),format:t,type:t,requestsOptions:{authentication:"passport"}}})},getDerivedFormat:function(){if(this.drive.get("id")!==d.ids.google)return null;return["application/vnd.google-apps.document","application/vnd.google-apps.presentation","application/vnd.google-apps.spreadsheet"].includes(this.get("secondaryType"))?"pdf":null},getActionIds:function(e){var t=this.get("actions");return e?t.filter(function(e){return-1!==["delete"].indexOf(e)}):t},getOwnerNames:function(){return this.get("owners").displayName},getDownloadUrl:function(){var e=o.getUrlWithTenant(this.url("download"));return t.resolve({method:"GET",url:e})},getFileUrl:function(){return t.resolve({url:o.getUrlWithTenant(this.url("download")),extension:this.get("fileExtension")})},getThumbnailLink:function(){return t.resolve(this.get("thumbnailLink"))},isFolder:function(){return"drivehub/folder"===this.get("mimeType")||this._parent()},isShared:function(){return this.get("shared")},doesExistInBackend:function(){return new t(e=>{e(!0)})},getDirectLink:function(){const e=o.getUrlWithTenant(this.url("getLink"));return new t((t,n)=>{o.performRequest(e,{method:"GET",onComplete:e=>{t(e.webViewLink)},onFailure:n})})}});function l(e){return"drivehub/folder"===e}}),define("DS/W3DDriveApp/Models/DrivesHub/InodeFactory",["DS/W3DDriveApp/Models/DrivesHub/Inode"],function(e){"use strict";var t=e.prototype.idAttribute;function n(t,n){return new e(t,n)}return n.prototype.idAttribute=t,n}),define("DS/W3DDriveApp/Collections/DrivesHub/Inodes",["DS/W3DContentApp/Collections/Inodes","DS/W3DDriveApp/Models/DrivesHub/InodeFactory","DS/W3DContentApp/Utils/scheduleTasksToGlobalSession"],function(e,t,n){"use strict";return e.extend({shouldFetch:!0,model:t,url:function(){var e=this._parentInode,t=e.id;return e.drive.url()+"/contents/"+t+"/children"},fetch:function(e){return this._parent(e)},create:function(e,t){var n=Object.assign({parentCreate:this._parent},t);return"copy"===t.action?this.copy(e,n):"text/directory"===e.mimeType?this.createFolder(e,n):this.upload(e,n)},createFolder:function(e,t){var n=Object.assign(t,{method:"POST",data:JSON.stringify({name:e.title})});return t.parentCreate.call(this,e,n)},upload:function(e,t){var n=t.file,i=new FormData;i.append("file",n);var r=Object.assign(t,{data:i,noContentType:!0,timeout:3e4});return t.parentCreate.call(this,e,r)},copy:function(e,t){var n=Object.assign(t,{method:"POST",data:JSON.stringify({id:e.duplicatedfrom})});return t.parentCreate.call(this,e,n)},destroyChildren:function(e,t){var i=this;return t=t||{},e.length?(i.shouldFetch=!1,new Promise(function(r,o){var s=e.map(function(e){return function(){return new Promise(function(n,i){e.destroy(Object.assign(t,{onComplete:n,onFailure:function(){i(e)}}))})}});n(s).then(function(){i.shouldFetch=!0,r()},function(e){i.shouldFetch=!0,o(e)})})):Promise.resolve()}})}),define("DS/W3DDriveApp/Views/versionItemView3DDrive",["DS/W3DContentApp/Views/itemView","DS/W3DDriveApp/Utils/Actions/driveFileHistory","DS/W3DContentApp/Utils/Helpers"],function(e,t,n){"use strict";return function(i){if(!i||!i.model)throw new Error("Missing input");let r,o,s=i.model,a={model:s};return a.id=s.get("physicalid"),a.title=n.getDateStr(s.get("created")),a.metas=s.get("lasteditor"),a.image=s.get("thumbnail"),a.actions=t(s).toJSON(),(o=e(a)).listenTo(s,{"onChange:thumbnail":()=>{a.image=s.get("thumbnail"),o.render()}}),r=o.destroy,o.container.addClassName("permission-item"),Object.assign(o,{destroy:function(){return s=null,a.actions&&(a.actions.model=null),a=null,r.apply(o,arguments)}})}}),define("DS/W3DDriveApp/Views/inodeFileHistoryContainer",["DS/W3DContentApp/Views/InodeDetailView/inodeFileHistoryView","DS/W3DDriveApp/Views/versionItemView3DDrive"],function(e,t){"use strict";return function(n){if(!n||!n.model)throw new Error("Missing input");return e({model:n.model,itemView:t})}}),define("DS/W3DDriveApp/Collections/DrivesHub/RootInodes",["DS/W3DDriveApp/Collections/DrivesHub/Inodes"],function(e){"use strict";return e.extend({url:function(){var e=this._parentInode.drive;return e.get("url")+("/drive/v1/"+e.id+"/contents/hiddenroot/children")}})}),define("DS/W3DDriveApp/Collections/InodeVersions",["UWA/Class/Promise","DS/W3DContentApp/Collections/AuthCollection","DS/W3DDriveApp/Models/InodeVersion","DS/W3DContentApp/Utils/RequestHelper","UWA/String"],function(e,t,n,i,r){"use strict";return t.extend({model:n,comparator:function(e){return-e.get("modified")},init:function(e,t={}){const n=t.parentInode;if(!n)throw new Error("You must specify a valid parentInode options");return this._parentInode=n,this._parent.apply(this,arguments)},setup:function(e,t){this.reset();const n=t.parentInode;this._parentInode=n;const i=this;return this._parentInode.addEvent("onChange:modifiedDate",function(){!1===i.hide&&i.fetch({})}),this._parent.apply(this,arguments)},url:function(){return!this._auth&&this._parentInode._auth&&(this._auth=this._parentInode._auth),r.format("{0}/resources/3ddrive/v1/bos/{1}/iterations",this._auth.getStorage().url,this._parentInode.get("id"))},reset:function(){return this.hide=!0,this._parent.apply(this,arguments)},fetch:function(e={}){this.hide=!1;const t=e.onComplete;return e.inode=this._parentInode,e.method="GET",e.headers=e.headers||{},e.headers["Content-Type"]="application/json",e.onComplete=function(n,i){i.items?t&&t.apply(null,arguments):e.onFailure&&e.onFailure.call(null,null,i)},this._parent.apply(this,arguments)},requestPreviews:function(t){const n=r.format("{0}/resources/3ddrive/v1/bos/previews",this._auth.getStorage().url),o=[];return t.reduce(function(r,s,a){return 30!==(r=r.concat(s)).length&&a!==t.length-1||(o.push(new e(function(e,t){i.performRequest(n,e,t,{ids:r.join(",")})})),r=[]),r},[]),o},parse:function(t){if(!t.items)return[];const n=this,i=[];return t.items.map(e=>{e.hasOwnProperty("id")&&i.push(e.id)}),e.all(this.requestPreviews(i)).then(e=>{if(0===e.length)return;const t=e[0].items.filter(e=>e.thumbnail.length>0);n.push(t,{parse:!1,merge:!0})}),t.items.sort((e,t)=>parseInt(t.created)-parseInt(e.created))},onRestore:function(e){const t=this;this._parentInode.fetch({onComplete:function(){t.fetch(e)},onFailure:function(){e.hasOwnProperty("onFailure")&&"function"==typeof e.onFailure&&e.onFailure(arguments)}}),this._parentInode.loadPreview({waitingTime:1})}})}),define("DS/W3DDriveApp/Utils/Actions/ShareAccess",["DS/W3DDriveApp/Metas/permission","DS/W3DContentApp/Views/SuperModal","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp"],function(e,t,n){"use strict";var i=e();return function(e){function r(t){var n=e.model;e.dispatchAccessActions("onUpdate",[n,t])}function o(e){return e.collection._parentInode.drive.get("isDrivesHubProvider")}return e.actions=e.actions.concat([{id:i.actionPubIds.removePermission,text:n.get("revokeAccess"),icon:"fonticon fonticon-block",handler:function(){var i=e.model;t.dialog({title:n.get("revokeAccess"),body:n.replace(n.get("revokeAccessDescription"),{name:i.get("title")}),buttons:[{className:"primary",value:n.get("Revoke"),action:function(t){t.hide(),e.dispatchAccessActions("onRemove",[i,{}])}},{value:n.get("cancel"),action:function(e){e.hide()}}]})}},{id:i.actionPubIds.makeReader,text:n.get("can_view"),icon:"fonticon fonticon-eye",handler:function(){r(o(e.model)?"READER":"read")}},{id:i.actionPubIds.makeWriter,text:n.get("can_edit"),icon:"fonticon fonticon-pencil",handler:function(){r(o(e.model)?"WRITER":"edit")}},{id:i.actionPubIds.makeReaderShare,text:n.get("can_view"),icon:"fonticon fonticon-eye",handler:function(){r("read_share")}},{id:i.actionPubIds.makeWriterShare,text:n.get("can_edit"),icon:"fonticon fonticon-pencil",handler:function(){r("edit_share")}},{id:i.actionPubIds.enableShare,text:n.get("enableSharing"),icon:"fonticon fonticon-user-add",handler:function(){r(e.model.get("accessright")+"_share")}},{id:i.actionPubIds.disableShare,text:n.get("disableSharing"),icon:"fonticon fonticon-user-delete",handler:function(){var t=e.model.get("accessright");t.indexOf("_")&&r(t.split("_")[0])}},{id:i.actionPubIds.transferOwnership,text:n.get("transferOwnership"),icon:"fonticon fonticon-user-change",handler:function(){var i,r,o,s,a;t.dialog((r=(i=e).model.get("id"),o=i.model.collection._parentInode,s=n.get("transferOwnership"),a=(a=n.replace(n.get("changeOwnerMessage1"),{user:i.model.get("title"),title:o.get("title")}))+"<p><p>"+n.replace(n.get("changeOwnerMessage2"),{shareLoc:n.get("sharedWithMe"),title:o.get("title")}),{title:s,body:a,buttons:[{className:"primary",value:n.get("continue"),action:function(e){e.hide(),i.dispatchAccessActions("onTransferOwnership",[o,r])}},{value:n.get("cancel"),action:function(e){e.hide()}}]}))}}]),e}}),define("DS/W3DDriveApp/Views/inodeAllAccessesContainer",["UWA/Class/View","DS/W3DContentApp/Views/InodeDetailView/inodeAllAccessesView","DS/UIKIT/Iconbar","DS/W3DDrive/InodeActions","DS/W3DDrive/Metas/DSDrive/inode","DS/W3DDriveApp/Utils/Actions/ShareAccess","DS/W3DContentApp/Components/SearchFilterAccesses","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp"],function(e,t,n,i,r,o,s,a){"use strict";return function(d){if(!d||!d.model)throw new Error("Missing input");const l=d.model,c=new e,u=c.destroy,p=[],h=r();if(l.get("actions").includes(h.actionPubIds.shareWithUsers)){const e=new i({model:d.model,context:"access"}).toJSON().find(e=>"share"===e.id);p.push({id:h.actionPubIds.shareWithUsers,text:a.get("AddMembers"),icon:"user-add",fonticon:"user-add",handler:e.handler})}const f=new n({className:"inode-access__topbar",items:p});function m(e){const t={};let n=[],i=[];return Object.entries(e).forEach(function(e){e[1]&&(n.push(e[0]),i.push(e[1]))}),n=n.join(),i=i.join(),n&&i&&(t.filteron=n,t.filter=i),t}if(l.drive.isDsDrive){const e={is3DDrive:!0,collection:l.permissions,searchConfig:{handler:function(){this.collection.fetch({reset:!0,data:m(this.filters)})}},filterConfig:{multiSelect:!0,items:[{className:"header",text:a.get("Responsibilities")},{category:"accessright",name:"read",fonticon:"eye",text:a.get("can_view"),selectable:!0},{category:"accessright",name:"edit",fonticon:"pencil",text:a.get("can_edit"),selectable:!0},{category:"accessright",name:"share",fonticon:"user-add",text:a.get("can_share"),selectable:!0},{className:"divider"},{className:"header",text:a.get("Types")},{category:"type",name:"Person",fonticon:"user",text:a.get("Person"),selectable:!0},{category:"type",name:"Group",fonticon:"users-group",text:a.get("Group"),selectable:!0}],handler:function(){const e=this.elements.filterMenu.getSelectedItems(),t=e.filter(e=>"accessright"===e.category).map(e=>e.name),n=t.includes("read"),i=t.includes("edit"),r=t.includes("share");let o;n?(o="read",r?o="read_share":i&&(o="read_edit")):i?(o="edit",r&&(o="edit_share")):r&&(o="share"),this.filters.accessright=o;const s=e.filter(e=>"type"===e.category).map(e=>e.name);this.filters.type=s.join(),this.collection.fetch({reset:!0,data:m(this.filters)})}}};new s(e).render().container.inject(f.getContent().querySelector(".iconbar-items-wrap"),"top")}d.shareAccessActions=o,d.emptyView={title:a.notSharedDirectly,icon:"lock"};var g=t(d);return g.render(),c.container.setContent([f,g.elements.spinner,g.elements.scrollView]),c.container.classList.add("inode-access"),Object.assign(c,{destroy:function(){u.apply(c,arguments),c.container=null,c.stopListening(),c.model=null}})}}),define("DS/W3DDriveApp/Collections/DrivesHub/Permissions",["UWA/String","DS/W3DContentApp/Collections/AuthCollection","DS/W3DDriveApp/Models/DrivesHub/Permission"],function(e,t,n){"use strict";return t.extend({model:n,url:function(){return e.format("{0}/drive/v1/{1}/contents/{2}/permissions",this._parentInode.drive.get("url"),this._parentInode.drive.get("id"),this._parentInode.id)},init:function(e,t){var n=(t=t||{}).parentInode;if(!n||!n.id)throw new Error("You must specify a valid parentInode options");return this._parentInode=n,this._parent.apply(this,arguments)},fetch:function(){return this._parent.apply(this,arguments)},parse:function(e){return e},create:function(e,t){return this._parent.call(this,{emailAddress:e.emailAddress,role:e.role?e.role.toUpperCase():""},t)}})}),define("DS/W3DDriveApp/Collections/DrivesHub/InodesFactory",["DS/W3DDriveApp/Collections/DrivesHub/Inodes","DS/W3DDriveApp/Collections/DrivesHub/RootInodes","DS/W3DDriveApp/Models/DrivesHub/InodeFactory"],function(e,t,n){"use strict";var i={};i.trueRootId=t;var r=function(t,n){var r=n.parentInode;if(r){var o=i[r.id];return o||(o=e),new o(t,n)}};return r.prototype.model=n,r}),define("DS/W3DDriveApp/Collections/DrivesHub/PermissionsFactory",["DS/W3DDriveApp/Collections/DrivesHub/Permissions","DS/W3DContentApp/Collections/Stub"],function(e,t){"use strict";var n=e.extend(t),i={};return i.root=n,i.sharedwithme=n,function(t,n){var r,o=n.parentInode;if(o)return(r=i[o.id])||(r=e),new r(t,n)}}),define("DS/W3DDriveApp/Models/DrivesHub/Drive",["DS/W3DContentApp/Models/Drive","DS/W3DDriveApp/Collections/DrivesHub/InodesFactory","DS/W3DDriveApp/Collections/DrivesHub/PermissionsFactory","DS/W3DDriveApp/Utils/hubRequestHelper","DS/W3DContentApp/Metas/drive","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp"],function(e,t,n,i,r,o){"use strict";return e.extend({_Inodes:t,_Permissions:n,defaults:{id:"driveshub",title:"DrivesHub"},isDrivesHubDrive:!0,setup:function(e){var t,n;this.auth=(t=e.auth,n=this,Object.assign({},t,{clearIdentity:function(e,t){i.performRequest(n.url("disconnect"),{onComplete:e,onFailure:t})},hasIdentity:function(e,t){return n.get("authenticated")?e():t()}})),this.set("auth",this.auth),this._parent.apply(this,arguments)},url:function(e){var t=this.get("url")+"/drive/v1/"+this.get("id");if(!e||0===e.length)return t;var n={connect:"/connect",disconnect:"/disconnect",info:"/info",revokeurl:"/permissions/revokeURL"}[e];return n?t+n:t},fetch:function(e){return this.get("url")?(this.getStorage(),this._index&&this._index.trueRootId?this._index.trueRootId.inodeTable.fetch(Object.assign({remove:!1},e)):this._parent.apply(this,arguments)):this._parent.apply(this,arguments)},parse:function(e){return e},save:function(e,t){return e.authenticated&&(t=Object.assign({},t,{url:this.url("connect")})),!1===e.authenticated&&(t=Object.assign({},t,{url:this.url("disconnect")})),this._parent(e,t)},getDefaultsAttributes:function(){return{authenticated:!1,id:this.id,iconLink:this.get("iconLink"),thumbnailLink:this.get("iconLink"),title:this.get("title"),user:{displayName:"",emailAddress:""}}},isActionIdoK:function(e){const t=r();return[t.actionPubIds.storage,t.actionPubIds.disconnect].includes(e)},getLegalInfo:function(){var e=this;return new Promise(function(t,n){i.performRequest(e.url("revokeurl"),{onComplete:function(n){var i='<a href="'+n.revokeURL+'" target="_blank">'+n.revokeURL+" </a>",r=o.replace(o.get("legalContent"),{drive:e.get("title"),url:i});t(r)},onFailure:function(i){switch(e.id){case"onedrive":t(o.get("onedriveLegalContent"));break;default:n(i)}}})})},getStorage:function(){var e=this;i.performRequest(this.url("info"),{onComplete:function(t){e.set("user",{displayName:t.user.name,emailAddress:t.user.email||e.get("user").emailAddress}),e.set("quotaBytes",{total:t.storageQuota.limit,used:t.storageQuota.usage})}})},getMeta:function(){return this.get("user").emailAddress}})}),define("DS/W3DDriveApp/Models/Access",["DS/W3DContentApp/Models/AuthModel","UWA/String","DS/W3DDriveApp/Metas/permission","DS/W3DContentApp/Utils/RequestHelper"],function(e,t,n,i){"use strict";var r=n().actionPubIds;return e.extend({idAttribute:"physicalid",defaults:{type:"",id:"",accessright:""},url:function(e){var n=e||{},r=n.action,o=n.queryStringParams,s=t.format("{0}/resources/3ddrive/v1/bos/{1}/allaccesses",this._auth.getStorage().url,this.collection._parentInode.get("id"));return"edit"!==r&&"delete"!==r||(s+="/"+this.get("physicalid")),s+="?withactions=true",o&&(s=i.addQueryStrings({url:s,queryStrings:o})),s},sync:function(e,t,n){return"create"===e?(n.method="POST",n.url=i.addQueryStrings({url:t.collection.url(),queryStrings:n.queryStrings}),n.headers=n.headers||{},n.headers["Content-Type"]="application/json",n.data={id:t.get("id"),uid:t.get("uid"),type:t.get("type"),accessright:t.get("accessright"),message:t.get("message")},"object"==typeof n.data&&(n.data=JSON.stringify(n.data))):"update"===e?(n.method="PUT",n.url=this.url({action:"edit",queryStringParams:n.queryStrings}),n.headers=n.headers||{},n.headers["Content-Type"]="application/json",n.data={accessright:t.get("accessright"),message:t.get("message")},"object"==typeof n.data&&(n.data=JSON.stringify(n.data))):"delete"===e&&(n.method="DELETE",n.url=this.url({action:"delete",queryStringParams:n.queryStrings})),this._parent(e,t,n)},save:function(e,t){return this._parent(e,t)},destroy:function(e){var t=e||{};return t.url=this.url({action:"delete",queryStringParams:t.queryStrings}),this._parent(t)},parse:function(e){return"Person"===e.type?{type:e.type,id:e.id,physicalid:e.physicalid,title:e.title,picture:o(this,e),email:e.email,accessright:e.accessright,actions:this.convertActions({accessright:e.accessright,actions:e.actions})}:{type:e.type,id:e.id,physicalid:e.physicalid,title:e.title,picture:o(this,e),members:e.members,accessright:e.accessright,actions:this.convertActions({accessright:e.accessright,actions:e.actions})}},convertActions:function(e){var t=e.accessright,n=e.actions;if(n){var i={"share.edit":this.getEditAction({accessright:t,actions:n}),"share.read":this.getReadAction({accessright:t,actions:n}),"share.remove":r.removePermission,"share.noreshare":r.disableShare,"share.reshare":r.enableShare,transferownership:r.transferOwnership};return n.map(function(e){return i[e]})}},getEditAction:function(e){var t=e.accessright;return e.actions.indexOf("share.noreshare")>-1&&t.indexOf("share")>-1?r.makeWriterShare:r.makeWriter},getReadAction:function(e){var t=e.accessright;return e.actions.indexOf("share.noreshare")>-1&&t.indexOf("share")>-1?r.makeReaderShare:r.makeReader},getActionIds:function(){return this.get("actions")||[]},isUser:function(){return"Person"===this.get("type")},isGroup:function(){return"Group"===this.get("type")},isPending:function(){return this.get("id")===this.get("email")},isActionAllowed:function(e){return-1!==this.getActionIds().indexOf(e)}});function o(e,n){return"Person"===n.type?t.format("{0}/api/user/getpicture/login/{1}/format/normal",e._auth.getSwymService(),n.id):n.picture}}),define("DS/W3DDriveApp/Models/PermissionLink",["DS/W3DDriveApp/Metas/permission","DS/W3DDriveApp/Models/Permission","DS/WebappsUtils/WebappsUtils"],function(e,t,n){"use strict";var i=e().actionPubIds;return t.extend({idAttribute:"id",type:"link",defaults:{picture:n.getWebappsAssetUrl("W3DContentApp","thumbnails/default-people.png")},parse:function(e){return{id:e.mail,displayName:e.mail,emailAddress:e.mail,domain:e.domain,actions:this.convertActions(e.actions)}},destroy:function(e){const t=this.collection._parentInode,n=t._auth.platform.url+"/resources/share/accesses/"+t.get("id")+"/restrictions";let i=e||{};return i=Object.assign(i,{url:n,method:"PUT",headers:{"Content-Type":"application/json"},data:JSON.stringify({operation:"remove",items:[{domain:this.get("domain"),mail:this.get("emailAddress")}]})}),this._parent(i)},convertActions:function(e){if(!e)return null;const t={remove:i.removePermission};return e.map(e=>t[e])},getActionIds:function(){return this.get("actions")||[]}})}),define("DS/W3DDriveApp/Collections/Accesses",["UWA/String","DS/W3DContentApp/Collections/AuthCollection","DS/W3DDriveApp/Models/Access","DS/W3DContentApp/Collections/Pagination","DS/W3DContentApp/Utils/RequestHelper"],function(e,t,n,i,r){"use strict";let o=t.extend({model:n,state:{firstPage:0,currentPage:0,pageSize:20,lastPage:0,filteron:"",filter:""},queryParams:{currentPage:"page",pageSize:"limit"},url:function(){return e.format("{0}/resources/3ddrive/v1/bos/{1}/allaccesses?withactions=true&sort=atitle",this._auth.getStorage().url,this._parentInode.get("id"))},init:function(e,t){const n=(t=t||{}).parentInode;if(!n||!n.id)throw new Error("You must specify a valid parentInode options");return this._parentInode=n,this._parent.apply(this,arguments)},fetch:function(e={}){(e.firstLoad||e.reset)&&(this.state.currentPage=0,this.state.firstPage=0,this.state.lastPage=0,this.state.filteron="",this.state.filter=""),e.data&&(e.data.filteron||e.data.filter)&&(this.state.filteron=e.data.filteron,this.state.filter=e.data.filter);const t=this,n=Object.keys(this.queryParams).reduce(function(e,n){let i=t.queryParams[n],r=t.state[n];return i="function"==typeof i?i.call(t):i,r="function"==typeof r?r.call(t):r,null!==i&&null!==r&&(e[i]=r),e},{});return this.state.filteron&&(n.filteron=this.state.filteron),this.state.filter&&(n.filter=this.state.filter),e.data=Object.assign({},e.data,n),this._parent.apply(this,arguments)},create:function(e,t){return this._parent.call(this,{id:e.id,uid:e.resourceUid,type:e.type,accessright:e.accessright,message:e.message},t)},parse:function(e){return this.updateState({totalRecords:e.total,lastPage:e.nbPages>0?e.nbPages-1:0}),e.items},updateState:function(e){this.state=Object.assign({},this.state,e)},removeOwnAccess:function(e){const t=this;return new Promise(()=>{r.performRequestWithOptions(t.url(),Object.assign({method:"DELETE",auth:t._auth},e))})}});return o=i(o)}),define("DS/W3DDriveApp/Collections/PermissionsLink",["DS/W3DContentApp/Collections/AuthCollection","DS/W3DDriveApp/Models/PermissionLink"],function(e,t){"use strict";return e.extend({model:t,url:function(){return this._parentInode._auth.platform.url+"/resources/share/accesses/"+this._parentInode.get("id")},setup:function(e,t){var n=t.parentInode;return this._parentInode=n,this._auth=n._auth,this._parent(arguments)},fetch:function(e){var t=Object.assign({},e,{headers:{"Content-Type":"application/json"}});return this._parent(t)},parse:function(e){return e&&Array.isArray(e.restrictions)?e.restrictions:[]}})}),define("DS/W3DDriveApp/Models/Inode",["DS/WAFData/WAFData","UWA/Core","UWA/Array","UWA/Utils","UWA/Class/Promise","UWA/String","DS/W3DDriveApp/Utils/actionsFiltering","DS/W3DDrive/Metas/DSDrive/inode","DS/W3DContentApp/Metas/inode","DS/W3DContentApp/Models/Inode","DS/W3DContentApp/Utils/Helpers","DS/W3DDrive/Utils/StructureNavigation","DS/W3DContentApp/Utils/RequestHelper","DS/W3DDrive/widget","DS/W3DDriveApp/Collections/PermissionsLink","DS/W3DDriveApp/Collections/InodeVersions","DS/W3DDrive/Utils/errors","DS/W3DContentApp/BusEvent","DS/W3DContentApp/Utils/Store"],function(e,t,n,i,r,o,s,a,d,l,c,u,p,h,f,m,g,v,D){"use strict";var S=d(),A=a();return l.extend({idAttribute:"id",defaults:{thumbnailLink:""},setup:function(){const e=this;return Object.keys(A.ids).map(function(t){return e.id!==A.ids[t]}).reduce(function(e,t){return e&&t},!0)&&(this.permissionsLink=new f([],{parentInode:this}),this.isFolder()||!0===h.getValue("isStandalone")||(this.inodeVersions=new m([],{parentInode:this,auth:this._auth}))),this.listenTo(v,{driveFeaturesList:function(){let t=(e.getActionIds()||[]).concat(y(e));e.set("actions",t)}}),this._parent.apply(this,arguments)},urlRoot:function(){var e="";if(this.isNew())return e;if(!this._auth)return e;var t=this._auth.getStorage();return t?e=o.format("{0}",p.getBaseUrl(t.url)):e},parse:function(e,t={}){var n,i,r,o,s=this;const a=t.drive;function d(e){return e===A.mimeType.folder}function l(e){if(e)return 1e3*parseInt(e,10)}for(n in r=function(e){var t;return t=e.parentid,s.get("id")===t&&(t=null),t}(e),o=function(e){if(!d(e.mimetype)&&e.hasOwnProperty("extension"))return e.extension}(e),i={accessright:e.accessright,actions:this.convertActions(e,a),createdDate:l(e.created),description:e.description||void 0,fileExtension:o,iconLink:function(e){return d(e.mimetype)?e.shared?"folder-shared":"folder":e.icon}(e),id:e.id,mimeType:e.mimetype,modifiedDate:l(e.modified),owners:function(e){var t=e.fullnameowner,n=e.owner;if(!t&&n&&(t=n),t&&n)return[{displayName:t,id:n}]}(e),originator:e.originator,lastEditor:e.lasteditor,parentId:r,root:e.root,size:e.size,title:e.title,alias:e.alias,addtomydrive:e.addtomydrive,shared:e.shared,thumbnailLink:function(e){var t;return(t=d(e.mimetype)?e.shared?A.thumbnails.sharedFolder:A.thumbnails.folder:e.thumbnail?e.thumbnail:e.extension?A.thumbnails[e.extension.toLowerCase()]||A.thumbnails.content:s.get("thumbnailLink")?s.get("thumbnailLink").medium:A.thumbnails.content)?{medium:t}:s.get("thumbnailLink")}(e),blockactions:e.blockactions,favorite:e.favorite})i.hasOwnProperty(n)&&void 0===i[n]&&delete i[n];if(e.actions){var c=this.get("actions")||[],u=e.actions.length!==c.length;u||(u=c.some(function(t,n){e.actions[n]})),u&&this.dispatchEvent("onChange:actions",[this,i.actions])}return t.drive&&t.drive.set("blockactions",e.blockactions),i},convertActions:function(e,t={},n=!1,i=[]){if(!e||e&&!e.actions)return;const r=e.actions,o=e.mimetype===A.mimeType.folder,s=A.actionPubIds,a={"add.folder":s.createFolder,"upload.folder":s.uploadFolder,"add.file":s.upload,copy:s.copy,delete:s.del,deletefinal:s.delFinal,download:s.download,"edit.title":s.editTitle,"edit.description":s.editDescription,openwith:s.openWith,move:s.moveTo,preview:s.preview,"share.link":s.shareLink,"share.edit":s.giveEditAccess,"share.read":s.giveReadAccess,"share.reshare":s.giveShareAccess,"share.remove":s.removeOwnAccess,update:s.update,addtomydrive:s.addToMyDrive,changealias:s.changeAlias,remove:s.removeFromMyDrive,publishto3dswym:s.publishTo3DSwym,addfavorite:s.addToFavorites,removefavorite:s.removeFromFavorites};let d=r.map(function(e){return a[e]}).filter(function(e){return void 0!==e});if(!n){if(d.push(s.viewAccesses),o||d.push(s.viewHistory),h.getValue("isStandalone")&&!D.features.isGuestCommentsEnabled||d.push(s.comment),d.push(s.viewInformation),r.some(e=>!!["share.read","share.edit","share.reshare"].includes(e)&&(d.push(s.shareWithUsers),!0)),!h.getValue("isStandalone")){D.servicesUrl.urlDashboard&&d.push(s.getLink),d.some(e=>[s.shareWithUsers,s.publishTo3DSwym,s.shareLink].includes(e))&&d.push(s.share)}r.some(e=>!!["edit.title","edit.description","changealias"].includes(e)&&(d.push(s.changeProperties),!0)),d=d.concat(y(e))}return i.length&&(d=d.filter(e=>!i.includes(e))),d},save:function(e,t){return"object"==typeof t&&t.data&&(t.headers={"Content-Type":"application/json; charset=UTF-8",Accept:"application/json; charset=UTF-8"}),e&&e.parentid&&(t.patch=!1),this._parent(e,t)},destroy:function(e){var n;return(e=t.clone(e||{},!1)).notrash&&(n=o.format("{0}/resources/3ddrive/v1/trash/{1}",this._auth.getStorage().url,this.get("id")),e.url=n),delete e.notrash,this._parent(e)},sync:function(n,s,a){if("create"!==n){var d=Object.assign({},a.queryStrings,{withactions:"true"});return a.url||(a.url=p.addQueryStrings({url:this.urlRoot()+"/"+this.id,queryStrings:d})),"object"==typeof a.data&&(a.data=JSON.stringify(a.data)),this._parent(n,s,a)}a=t.clone(a||{},!1);var l,c=this,u=this.collection._auth.getStorage(),h=a.file||{},f=function(e,t){var n;return n=Object.assign({data:{},headers:{"Content-Type":"application/json;charset=utf-8"}},t),[{title:e.title,description:e.description,duplicatedfrom:e.duplicatedfrom},n]}(function(e,t){var n,i,r,o,s,a={};e&&(e.parentId&&(n=e.parentId),e.mimeType&&(i=e.mimeType),e.description&&(r=e.description),e.title&&(o=e.title),e.duplicatedfrom&&(s=e.duplicatedfrom));n&&(a.parents=[{id:n}]);i?i===S.mimeType.folder&&(i=A.mimeType.folder):i="application/octet-stream";a.mimeType=i,r&&(a.description=r||"");o&&(a.title=o);t&&(a.uploadType="media");s&&(a.duplicatedfrom=s);return a}(a.attrs||s.toJSON(),s.isNew()),a),m=s._parent.bind(s),v=a.onFailure;if(h&&h.size>A.constants.maxFileSize)return a.onFailure(g.createUploadFileSizeErrorDSDrive(A)),null;function D(e,t,i){return a.data=t||{},a.data=e,a.queryStrings&&(a.url=p.addQueryStrings({url:c.url(),queryStrings:a.queryStrings})),i&&(a.data.receipt=i),a.data=JSON.stringify(a.data),"update"===a.action&&(n="update",a.url=o.format("{0}/{1}",p.getBaseUrl(u.url),s.id)),m(n,s,a)}a.headers=a.headers||{},a.headers["Content-Type"]="application/json;charset=UTF-8",s.isFolder()?i.setImmediate(function(){D.apply(null,function(e,t){return[Object.assign({type:A.boType.folder},e),t]}.apply(null,f))}):s.get("duplicatedfrom")?i.setImmediate(function(){D.apply(null,function(e,t){return[Object.assign({type:A.boType.document},e),t]}.apply(null,f))}):(l=function(e){return new r(function(t,n){var i;i=o.format("{0}/ticket?id={1}",p.getBaseUrl(e.url,!1),window.Date.now()),p.performRequestWithOptions(i,{method:"GET",type:"json",onComplete:function(e){t(e)},onFailure:n})})}.call(c,u).then(w).spread(function(t,n,i){return function(t,n,i,o,s){if(s.uploadCancelled)return r.reject();return new r((r,a)=>{const d={"file-name":o.name,"file-title":o.name,"file-description":o.name,[n]:i,file_0:o,__fcs__nohtml:!0},l=new FormData;Object.keys(d).forEach(e=>l.append(e,d[e]));const c=e.authenticatedRequest(t,{method:"POST",data:l,type:"text",timeout:0,onComplete:e=>r(e),onUploadProgress:s.dispatchAsEventListener("onProgress"),onFailure:a,onCancel:a});s.addEvent("onCancel",function(){c.cancel()})})}(t,n,i,h,c)}).then(b),r.all(f.concat(l).concat(h.name)).spread(W).spread(D).catch(function(e){v(e)}))},getOwnerNames:function(){return this.get("owners")[0]?this.get("owners")[0].displayName:""},getCreator:function(){return this.get("originator")},isFolder:function(){return this.get("mimeType")===A.mimeType.folder||this._parent()},isShared:function(){return this.get("shared")},getFileUrl:function(e){const t=this,n=o.format("{0}/{1}/fileurl",p.getBaseUrl(this._auth.getStorage().url),this.get("id")),i={open:!0};return u.isSupportedBy3DPlay(this)&&(i.expand=e?e.queryStrings.expand:"true"),new r(function(e,r){p.performRequestWithOptions(n,{type:"json",data:i,onComplete:function(n){var i=n?n.url:null;t.set("fileUrl",i),e(n)},onFailure:function(e,t,n){r(t)}})})},getThumbnailLink:function(){var e=this,t=this.get("fileExtension");return"jpg"===(t=t.toLowerCase())||"jpeg"===t||"png"===t||"gif"===t||"bmp"===t?this.getDownloadUrl().then(function(e){return{medium:e.url,small:e.url,large:e.url}}):new r(function(t,n){t({medium:e.get("thumbnailLink").medium,small:e.get("thumbnailLink").small,large:e.get("thumbnailLink").medium})})},getDownloadUrl:function(e){e=e||{};var t=this,n=o.format("{0}/{1}/download",p.getBaseUrl(this.drive.get("auth").getStorage().url),this.get("id"));return new r(function(i,r){e.onComplete=function(e){var n=e?e.url:null;t.set("downloadUrl",n),i({url:n,method:"POST",expandDetails:e.expandDetails||null})},e.onFailure=function(e,t,n){r({status:e,data:t,options:n})},p.performRequestWithOptions(n,e)})},amISharedWithMeChild:function(){return this.get("parentId")===A.ids.sharedWithMe},getActionIds:function(e){if(this.get("removed"))return[];var t=this.get("actions");if(!t)return[];t=s.manageActionOpeningForFiles(t,this),!0===h.getValue("isStandalone")&&(t=!0===e?s.filterSharedByLinkMultiSel(t):s.filterSharedByLink(t));const n=t.indexOf(S.actionPubIds.share);return e&&-1!==n&&t.splice(n,1),t},getDirectLink:function(){if(!0===h.getValue("isStandalone"))return null;if("trueRootId"===this.get("parentId")||"TRASH"===this.get("parentId"))return null;var e=this._auth.platform.urlDashboard,t=this._auth.platform.id,n=this.get("id"),i="file";return this.isFolder()&&(i="folder"),e&&t&&n?e+"/#app:X3DDRIV_AP/content:driveId="+t+"&contentId="+n+"&contentType="+i:null},isActionIdoK:function(e){var t=n.detect(this.getActionIds(),function(e){if("giveReadAccess"===e||"giveEditAccess"===e||"giveShareAccess"===e)return!0});return!("share"!==e||!t)||this._parent(e)},loadPreview:function(e){var t,n,i=this;(e=e||{}).add||(t=this,n=e.waitingTime,n=n||7e3,new r(function(e,i){var r;if("trueRootId"!==t.id&&"DSROOT"!==t.id)try{"/"!==(r=c.result(t,"url"))[r.length-1]&&(r+="/"),r+="preview",setTimeout(function(){p.performRequest(r,e,i)},n)}catch(e){i(e)}else e("")})).then(function(e){i.set(i.parse(e))})},get3DPlayOptions:function(){const t={asset:{provider:"3DDRIVE",type:"DriveFile",physicalid:this.get("id"),fileFormat:this.get("fileExtension"),filename:e.proxifyUrl(this.get("fileUrl")),tenant:h.getValue("isStandalone")?h.getValue("publicTenant"):this._auth.getStorage().id,requestsOptions:{proxy:"none"}}};return h.getValue("isStandalone")&&(t.user="guest"),u.isSupportedBy3DPlay(this)&&(t.asset.filename=this.get("title")+".zip",t.asset.url=e.proxifyUrl(this.get("fileUrl"))),this._parent(t)},uploadFileToSwym:function(e){var t=o.format("{0}/resources/3ddrive/v1/bos/{1}/publish",this._auth.platform.url,this.get("id")),n=this._auth;return new r(function(i,r){p.performRequestWithOptions(t,{url:t,auth:n,timeout:3e5,method:"POST",data:JSON.stringify({tenantid:e.platformId,communityid:e.threadId,isillustration:"media"===e.contentType?"false":"true",isDownloadable:"true",selectanswer:"mediaid"}),type:"json",headers:{"Content-type":"application/json; charset=UTF-8",Accept:"application/json; charset=UTF-8"},proxy:"passport",onComplete:function(e){i(e)},onTimeout:function(){var e=new Error("timeout");e.name="timeout",r(e)},onFailure:function(e,t){var n=new Error;n.name="error",n.message=t,r(n)}})})},transferOwnership:function(e){var t=this,n={url:o.format("{0}/resources/3ddrive/v1/bos/{1}/transfer",this._auth.getStorage().url,this.get("id"))};return new r(function(i,r){t.save({owner:e},Object.assign({wait:!0,onComplete:function(e,t){i(t)},onFailure:function(e,t){r(t)}},n))})},addToFavorites:function(e){const t=this,n=o.format("{0}/favorites/{1}",p.getBaseUrl(this._auth.getStorage().url),this.get("id"));return new r((i,r)=>{p.performRequestWithOptions(n,Object.assign({method:"POST",data:JSON.stringify({}),headers:{"Content-type":"application/json"},auth:t._auth,onComplete:function(){t.set("favorite",!0);let e=t.get("actions");e&&((e=e.slice()).splice(e.indexOf("addToFavorites"),1,"removeFromFavorites"),t.set("actions",e),i(t))},onFailure:function(){r(t)}},e))})},removeFromFavorites:function(e){const t=this,n=o.format("{0}/favorites/{1}",p.getBaseUrl(this._auth.getStorage().url),this.get("id"));return new r((i,r)=>{p.performRequestWithOptions(n,Object.assign({method:"DELETE",auth:t._auth,onComplete:function(){t.set("favorite",!1);let e=t.get("actions");e&&((e=e.slice()).splice(e.indexOf("removeFromFavorites"),1,"addToFavorites"),t.set("actions",e),i(t))},onFailure:function(){r(t)}},e))})}});function y(e={}){const t=A.actionPubIds,n=[],i=["edit","edit_share"].includes(e.get&&e.get("accessright")||e.accessright);return D.features.isODEFeatureAvailable&&i&&c.isOfficeDocumentSupported(e.get&&e.get("fileExtension")||e.extension)&&n.push(t.editDocument),n}function w(e){return[function(e){return e.actionurl}(e),function(e){return e.jobticket}(e),function(e){return e.ticket}(e)]}function b(e){return`${e}`.trim()}function W(e,t,n,i){var o;return o=Object.assign({type:A.boType.document,file:i,description:""},e),r.cast([o,t,n])}}),define("DS/W3DDriveApp/Collections/PermissionsFactory",["DS/W3DDriveApp/Collections/Accesses","DS/W3DContentApp/Collections/Stub","DS/W3DDrive/Metas/DSDrive/inode"],function(e,t,n){"use strict";var i=n(),r=e.extend(t),o={};return o[i.ids.root]=r,o[i.ids.sharedWithMe]=r,function(t,n){var i,r=n.parentInode;if(r)return(i=o[r.id])||(i=e),new i(t,n)}}),define("DS/W3DDriveApp/Models/TrashRoot",["DS/W3DDrive/Metas/DSDrive/inode","DS/W3DContentApp/Metas/inode","DS/W3DDriveApp/Models/Inode","DS/W3DContentApp/Models/Stub","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp"],function(e,t,n,i,r){"use strict";const o=t(),s=e();return n.extend(i,{defaults:{parentId:s.ids.trueRoot,title:r.get("Trash"),mimeType:o.mimeType.folder,iconLink:"trash",thumbnailLink:{small:s.thumbnails.folder,medium:s.thumbnails.folder,large:s.thumbnails.folder}},configuration:{emptyView:{icon:"trash",title:r.get("emptyTrash")}},getActionIds:function(){return[]},doesExistInBackend:function(){return new Promise(e=>{e(!0)})}})}),define("DS/W3DDriveApp/Models/RecentRoot",["DS/W3DDrive/Metas/DSDrive/inode","DS/W3DContentApp/Metas/inode","DS/W3DDriveApp/Models/Inode","DS/W3DContentApp/Models/Stub","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp"],function(e,t,n,i,r){"use strict";const o=t(),s=e();return n.extend(i,{defaults:{parentId:s.ids.trueRoot,title:r.get("Recent"),mimeType:o.mimeType.folder,iconLink:"clock",thumbnailLink:{small:s.thumbnails.folder,medium:s.thumbnails.folder,large:s.thumbnails.folder}},configuration:{canSort:!1,canMultiselect:!0,canChangeLayout:!1,defaultLayout:"listLayout",emptyView:{icon:"clock",title:r.get("noRecentFiles")}},getActionIds:function(){return[]},doesExistInBackend:function(){return new Promise(e=>{e(!0)})}})}),define("DS/W3DDriveApp/Models/RecentInode",["DS/W3DDriveApp/Models/Inode","DS/W3DDrive/Metas/DSDrive/inode","DS/W3DContentApp/Utils/Store","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp"],function(e,t,n,i){"use strict";const r=t();return e.extend({parse:function(e){const t=this,o=e=>e?1e3*parseInt(e,10):null,s={accessright:e.accessright,actions:(e=>{if(!e)return null;const t=r.actionPubIds;let i=[];const o={preview:t.preview,addfavorite:t.addToFavorites,removefavorite:t.removeFromFavorites,download:t.download,delete:t.del,deletefinal:t.delFinal};return i=e.map(e=>o[e]).filter(e=>void 0!==e),n.servicesUrl.urlDashboard&&i.push(t.getLink),i.push(t.openFileLocation),i.push(t.viewHistory),i})(e.actions),addtomydrive:e.addtomydrive,blockactions:e.blockactions,createdDate:o(e.created),description:e.description,fileExtension:e.extension,owners:(e=>{let t=e.fullnameowner;const n=e.owner;return!t&&n&&(t=n),t&&n?[{displayName:t,id:n}]:null})(e),id:e.id,mimeType:e.mimetype,modifiedDate:o(e.modified),originator:e.originator,parentId:"recents",root:e.root,parentContainerId:e.parentid,shared:e.shared,size:e.size,title:e.title,alias:e.alias,type:e.type,thumbnailLink:(e=>{let n;return(n=e.thumbnail?e.thumbnail:e.extension?r.thumbnails[e.extension.toLowerCase()]||r.thumbnails.content:t.get("thumbnailLink")?t.get("thumbnailLink").medium:r.thumbnails.content)?{medium:n}:t.get("thumbnailLink")})(e),interaction:(a=e.interaction,{CREATED:i.get("Created"),MODIFIED:i.get("Modified"),UPDATED:i.get("Updated"),OPENED:i.get("Opened"),RESTORED:i.get("Restored")}[a]),interactionDate:o(e.lastinteract),favorite:e.favorite};var a;for(let e in s)s[e]||delete s[e];return s},enableDrop:function(){return!1},getLocationLink:function(){return this.drive.getInodePanelContentURI(this,{containerType:"text/directory",containerId:this.get("parentContainerId")})},doesExistInBackend:function(){return new Promise(e=>{e(!0)})},destroy:function(e){return this._parent(e)}})}),define("DS/W3DDriveApp/Models/SharedWithMeRoot",["DS/W3DDrive/Metas/DSDrive/inode","DS/W3DContentApp/Metas/inode","DS/W3DDriveApp/Models/Inode","DS/W3DContentApp/Models/Stub","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp"],function(e,t,n,i,r){"use strict";const o=t(),s=e();return n.extend(i,{defaults:{parentId:s.ids.trueRoot,title:r.get("SharedWithMe"),mimeType:o.mimeType.folder,iconLink:"users",thumbnailLink:{small:s.thumbnails.folder,medium:s.thumbnails.folder,large:s.thumbnails.folder}},getActionIds:function(){return[]},doesExistInBackend:function(){return new Promise(e=>{e(!0)})}})}),define("DS/W3DDriveApp/Models/FavoritesRoot",["DS/W3DDrive/Metas/DSDrive/inode","DS/W3DContentApp/Metas/inode","DS/W3DDriveApp/Models/Inode","DS/W3DContentApp/Models/Stub","DS/W3DDrive/widget","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp"],function(e,t,n,i,r,o){"use strict";const s=t(),a=e();return n.extend(i,{defaults:{parentId:a.ids.trueRoot,title:o.get("Favorites"),mimeType:s.mimeType.folder,iconLink:"favorite-on",thumbnailLink:{small:a.thumbnails.folder,medium:a.thumbnails.folder,large:a.thumbnails.folder}},configuration:{emptyView:{icon:"favorite-on",title:o.get("noFavorites")}},getActionIds:function(){return[]},doesExistInBackend:function(){return new Promise(e=>{e(!0)})},enableDrop:function(e){return!(!e||!e.includes(this.getDropDataType()))},getDropDataType:function(){return(r.getValue("appId")+"_"+r.id+"_"+this.drive.id).toLowerCase()}})}),define("DS/W3DDriveApp/Models/MainRoot",["DS/W3DDrive/Metas/DSDrive/inode","DS/W3DContentApp/Metas/inode","DS/W3DDriveApp/Models/Inode","DS/W3DContentApp/Models/Stub","DS/W3DContentApp/Utils/Alert","i18n!DS/W3DDriveApp/assets/nls/W3DDriveApp"],function(e,t,n,i,r,o){"use strict";const s=t(),a=e();return n.extend(i,{defaults:{parentId:a.ids.trueRoot,title:o.get("myFiles"),mimeType:s.mimeType.folder,iconLink:a.icons.folder,thumbnailLink:{small:a.thumbnails.folder,medium:a.thumbnails.folder,large:a.thumbnails.folder}},getActionIds:function(){return this.inodeActionsIds||[]},doesExistInBackend:function(){const e=this;return new Promise(t=>{e.sync("GET",e,{onComplete:function(n){e.drive.set("blockactions",n.blockactions),n.actions&&(e.inodeActionsIds=e.convertActions(n,e.drive,!0),e.dispatchEvent("onChange:actions",[e,e.inodeActionsIds])),t(!0)},onFailure:function(e){e.error&&e.error.code&&r.add({message:o.get("tenantAccessError",{errorMsg:e.error.message}),className:"warning"}),t(!0)}})})}})}),define("DS/W3DDriveApp/Models/InodeFactory",["DS/W3DDrive/Metas/DSDrive/inode","DS/W3DDriveApp/Models/Inode","DS/W3DDriveApp/Models/MainRoot","DS/W3DDriveApp/Models/SharedWithMeRoot","DS/W3DDriveApp/Models/TrashRoot","DS/W3DDriveApp/Models/RecentRoot","DS/W3DDriveApp/Models/FavoritesRoot"],function(e,t,n,i,r,o,s){"use strict";const a=e(),d={};d[a.ids.root]=n,d[a.ids.sharedWithMe]=i,d[a.ids.recents]=o,d[a.ids.favorites]=s,d[a.ids.trash]=r;const l=t.prototype.idAttribute;function c(e,n){const i=e[l];let r=d[i];return r||(r=t),new r(e,n)}return c.prototype.idAttribute=l,c}),define("DS/W3DDriveApp/Collections/Inodes",["UWA/String","UWA/Class/Promise","DS/W3DContentApp/Collections/Inodes","DS/W3DContentApp/Utils/scheduleTasksToGlobalSession","DS/W3DDrive/Metas/DSDrive/inode","DS/W3DDriveApp/Models/InodeFactory","DS/W3DDrive/Utils/errors","DS/W3DContentApp/Utils/RequestHelper"],function(e,t,n,i,r,o,s,a){"use strict";var d=r();return n.extend({shouldFetch:!0,model:o,url:function(t){var n={createFolder:"?update=true&withactions=true",fetch:"?withactions=true",autoname:"/autoname"};return e.format("{0}/{1}/contents",this.serviceUrl(),this._parentInode.id)+(n[t]||n.fetch)},serviceUrl:function(){var t=this._auth.getStorage();return e.format("{0}",a.getBaseUrl(t.url))},parse:function(e){return e.items},fetch:function(n){n=n||{};var i=Object.assign({},n);return this.shouldFetch?(n.withThumbnails&&(i.onComplete=function(i,r){var o=0;(function(n){var i;i=e.format("{0}/previews",a.getBaseUrl(n._auth.getStorage().url));var r=[];return n.filter(function(e){return!e.isFolder()}).reduce(function(e,n,o,s){return 30!==(e=e.concat(n)).length&&o!==s.length-1||(r.push(new t(function(t,n){a.performRequest(i,t,n,{ids:l(e)})})),e=[]),e},[]),r})(i).map(function(e,t,s){e.then(function(e){i.push(e,{parse:!0,merge:!0}),++o===s.length&&"function"==typeof n.onComplete&&n.onComplete(i,r,n)})})}),this._parent(i)):("function"==typeof n.onComplete&&n.onComplete(this,this.toJSON(),n),void this.dispatchEvent("onSync",[this,this.toJSON(),n]))},create:function(e,t){var n=(t=Object.assign({},t)).file;return n&&n.size>d.constants.maxFileSize?(t.onFailure(e,s.createUploadFileSizeErrorDSDrive(d)),null):(t.url=this.url("createFolder"),this._parent(e,t))},shareChildren:function(e,n,r){var o=this;r=r||{};var s=e.reduce(function(e,i){if(!o.contains(i))return e;var s=i.permissions;return n.map(function(e){var n=s.findWhere({id:e.id});return n?function(){return new t(function(t,o){n.save({accessright:e.accessright},Object.assign({wait:!0,onComplete:function(e){t({inode:i,access:e})},onFailure:function(e){o({inode:i,access:e})},onTimeout:function(e){s.remove(e),o({inode:i,access:e,reason:"timeout"})}},r))})}:function(){return new t(function(t,n){s.create(e,Object.assign({wait:!0,onComplete:function(e){t({inode:i,access:e})},onFailure:function(e){s.remove(e),n({inode:i,access:e})},onTimeout:function(e){s.remove(e),n({inode:i,access:e,reason:"timeout"})}},r))})}}).concat(e)},[]);return i(s)},destroyChildren:function(e,n){var r=this;return n=n||{},e.length?(r.shouldFetch=!1,new t(function(o,s){var a=e.map(function(e){return function(){return new t(function(t,i){e.destroy(Object.assign(n,{onComplete:t,onFailure:function(){i(e)}}))})}});i(a).then(function(){r.shouldFetch=!0,o()},function(e){r.shouldFetch=!0,s(e)})})):t.resolve()},moveItems:function(e,n,r){var o=this;return r=r||{},e.length?(o.shouldFetch=!1,new t(function(s,a){var d=e.map(function(e){return function(){return new t(function(t,i){e.save({parentid:n.id},Object.assign({patch:!0,wait:!0,onComplete:function(e,n){t(n)},onFailure:function(e,t){i(e,t)}},r))})}});i(d).then(function(){o.shouldFetch=!0,s()},function(e){o.shouldFetch=!0,a(e)})})):t.resolve()},getDownloadUrl:function(n,i){i=i||{};var r=e.format("{0}/download",a.getBaseUrl(this._auth.getStorage().url));return new t(function(e,t){a.performRequest(r,function(t){var n=t?t.url:null;e({url:n,method:"POST"})},t,Object.assign({ids:l(n)},i.data))})},autoname:function(e){var n=this;return new t(function(t,i){a.performRequestWithOptions(n.url("autoname"),{method:"GET",data:{title:e},onComplete:function(e){t(e)},onFailure:function(){i(arguments)}})})}});function l(e){return e.map(function(e){return e.id}).reduce(function(e,t,n,i){var r=e;return e&&(r+=","),r+t},"")}}),define("DS/W3DDriveApp/Models/Favorite",["DS/W3DDriveApp/Models/Inode","DS/W3DDrive/Metas/DSDrive/inode"],function(e,t){"use strict";const n=t();return e.extend({convertActions:function(e,t){const i=[n.actionPubIds.moveTo];return this._parent(e,t,!1,i)},getDragDataType:function(){return null}})}),define("DS/W3DDriveApp/Collections/RootInodes",["DS/W3DDriveApp/Collections/Inodes","DS/W3DContentApp/Collections/Stub","DS/W3DDrive/Metas/DSDrive/inode"],function(e,t,n){"use strict";const i=n();return e.extend(t,{init:function(e,t){var n=[i.ids.root,i.ids.sharedWithMe,i.ids.recents,i.ids.favorites,i.ids.trash].map(function(e){var t={};return t[this.model.prototype.idAttribute]=e,t},this).map(function(t){var n,i;for(i=0;!n&&i<e.length;i++)e[i].id===t.id&&(n=e[i]);return n||t});return this._parent(n,t)}})}),define("DS/W3DDriveApp/Collections/Recent",["UWA/String","DS/W3DContentApp/Utils/RequestHelper","DS/W3DDriveApp/Collections/Inodes","DS/W3DDriveApp/Models/RecentInode"],function(e,t,n,i){"use strict";return n.extend({model:i,url:function(){return e.format("{0}/recents?withactions=true",t.getBaseUrl(this._auth.getStorage().url))},fetch:function(e){return e=Object.assign({},e,{reset:!0}),this._parent(e)},sort:function(){}})}),define("DS/W3DDriveApp/Collections/TrashInodes",["DS/W3DDriveApp/Collections/Inodes","DS/W3DDriveApp/Models/TrashInode"],function(e,t){"use strict";return e.extend({model:t,url:function(){return this._auth.getStorage().url+"/resources/3ddrive/v1/trash"},fetch:function(e){e.data={withactions:!0},this._parent.apply(this,arguments)}})}),define("DS/W3DDriveApp/Collections/SharedWithMeRootInodes",["DS/W3DDriveApp/Collections/Inodes","DS/W3DContentApp/Utils/RequestHelper"],function(e,t){"use strict";return e.extend({url:function(){return t.getBaseUrl(this._auth.getStorage().url)+"/sharedwithme/contents?withactions=true"}})}),define("DS/W3DDriveApp/Collections/Favorites",["UWA/String","DS/W3DContentApp/Utils/RequestHelper","DS/W3DDriveApp/Collections/Inodes","DS/W3DDriveApp/Models/Favorite"],function(e,t,n,i){"use strict";return n.extend({model:i,url:function(){return e.format("{0}/favorites?withactions=true",t.getBaseUrl(this._auth.getStorage().url))},fetch:function(e){return e=Object.assign({},e),this._parent(e)}})}),define("DS/W3DDriveApp/Collections/InodesFactory",["DS/W3DDriveApp/Collections/Inodes","DS/W3DDriveApp/Collections/RootInodes","DS/W3DDriveApp/Collections/SharedWithMeRootInodes","DS/W3DDriveApp/Collections/TrashInodes","DS/W3DDriveApp/Collections/Recent","DS/W3DDriveApp/Collections/Favorites","DS/W3DDrive/Metas/DSDrive/inode","DS/W3DDriveApp/Models/InodeFactory"],function(e,t,n,i,r,o,s,a){"use strict";var d=s(),l={};l[d.ids.trueRoot]=t,l[d.ids.sharedWithMe]=n,l[d.ids.recents]=r,l[d.ids.favorites]=o,l[d.ids.trash]=i;var c=function(t,n){var i=n.parentInode;if(i){var r=l[i.id];return r||(r=e),new r(t,n)}};return c.prototype.model=a,c}),define("DS/W3DDriveApp/Models/Drive",["DS/W3DContentApp/Models/DriveAbstract","DS/W3DDriveApp/Collections/InodesFactory","DS/W3DDriveApp/Collections/PermissionsFactory","DS/W3DContentApp/Utils/RequestHelper","UWA/Class/Promise","DS/W3DContentApp/Metas/drive"],function(e,t,n,i,r,o){"use strict";return e.extend({_Inodes:t,_Permissions:n,isDsDrive:!0,fetch:function(e){const t=this,n=this.get("auth"),o=this._parent.bind(this);return this.getStorage(),new r((e,r)=>{n&&"object"==typeof n?i.performRequestWithOptions(n.platform.url+"/resources/3ddrive/v1/admin/sharebylink",{method:"GET",type:"json",auth:n,headers:{"Content-Type":"application/json"},onComplete:function(n){return t.set("shareWithExternal","true"===n.sharebylink),e()},onFailure:function(){r(arguments)}}):e()}).finally(function(){return o(e)})},isActionIdoK:function(e){return[o().actionPubIds.storage].includes(e)},getStorage:function(){const e=this,t=this.get("auth");i.performRequestWithOptions(t.platform.url+"/resources/3ddrive/v1/bos/DSROOT",{method:"GET",type:"json",auth:t,headers:{"Content-Type":"application/json"},onComplete:function(t){e.set("quotaBytes",{used:t.usage||"",total:t.quota||""}),e.set("blockactions",Boolean(t.blockactions))}})},getMeta:function(){return this.get("auth").platform.displayName}})});