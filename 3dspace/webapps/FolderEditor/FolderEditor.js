var requires=["UWA/Core","DS/PADUtils/PADCommandProxy","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSharedSettings","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADContext","DS/FolderEditor/FolderComponent","DS/FolderEditor/FolderIdCardCont","DS/FolderEditor/FolderTreeCont","DS/FolderEditor/Folder_CSO","DS/FolderEditor/ActionBar/FolderCommandManager","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/commands/FolderCommands","i18n!DS/FolderEditor/assets/nls/FolderEditor","i18n!DS/PADUtils/assets/nls/PADUtils","DS/FolderEditor/service/FolderServices","DS/FolderEditor/service/FolderTypeService","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderEditorKeyboardListener","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderCommunication","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/GlobalModelEvents","DS/WidgetServices/WidgetServices","DS/IPClassifyUXUtil/CredentialsView","DS/FolderEditor/utils/WidgetHandlerUtil","DS/PADUtils/PADProbes","DS/PlatformAPI/PlatformAPI","DS/Windows/ImmersiveFrame","DS/WebUAUtils/WebUAUtils","text!DS/FolderEditor/assets/folder_settings.json","DS/FolderEditor/utils/FolderLoaderGlobal"];function initBookmark(e,t,o,n,i,r,s,a,l,d,c,u,p,g,f,h,m,v,_,S,C,b,F,y,D,E,w,A,T,I,x,P,k,N){var M=this;let O=e._subscriptionTokens;M.options=M.options||{},UWA.extend(M.options,{custo_view_title:f.name_Widget_Title}),M.checkOnCommand=!1,s.set(M),window.top.performance.mark("loadRequire_end"),window.top.performance.measure(M.probeHeader+"loadRequire","createWidget_begin","loadRequire_end");var U,R=function(e){if(e){var t=f[e.label];t=t||h[e.label],e.label=t||e.label,e.options&&e.options.forEach(function(e){e.label=f[e.label]})}},B=function(e){var t=n.getSpecificWidgetPreference(e);t&&t.length>0&&R(t[0]),"useIndexAccleration"==e&&(t[0].onchange="onUseOnlyDBChange",widget.addEvent("onUseOnlyDBChange",function(){var e=JSON.parse(JSON.stringify(widget.getPreference("autoSwitch")));widget.getValue("useIndexAccleration")?e.disabled=!1:e.disabled=!0,widget.addPreference(e),widget.dispatchEvent("onEdit")})),"autoSwitch"==e&&(t[0].disabled=!widget.getValue("useIndexAccleration")),widget.mergePreferences(t)},L=JSON.parse(k);if("function"==typeof window.updateSettings&&window.updateSettings(L),n.setApp(L.padsettings,"enopad",!0),T.initialize({padid:widget.id,padtitle:widget.getTitle()}),widget.setValue("tenantAware",!0),n.addEventOnce("onNoSecurityContext",function(e){!0!==e&&(S._getInstance()._isSecurityCTXInitialized=!1,widget.setBody(" "),UWA.createElement("div",{text:f.get("authentication_error"),class:"FolderEditor_auth_error"}).inject(widget.body))}),n.addEventOnce("onNoPlatform",function(){S._getInstance()._isTenantInitialized=!1,widget.setBody(" "),UWA.createElement("div",{text:f.get("noPlatform_error"),class:"FolderEditor_auth_error"}).inject(widget.body)}),M.updateTitle=function(){M.setTitle&&M.setTitle(M._label)},n.addEvent("onPad_security_ctx",M.updateTitle.bind(M)),n.addEvent("onPad_tenant",M.updateTitle.bind(M)),widget.addPreference({name:"pad_security_ctx",type:"hidden"}),B("drag-and-drop"),B("filtered-content"),B("allow-products-expand"),B("show-sub-folders"),B("activateBIFilter"),n.setSetting("activateTreeFilter",!1),B("useIndexAccleration"),B("autoSwitch"),!0===widget.getValue("noCompass")&&widget.setValue("autoSwitch","Never"),window.authoringModeODT&&widget.setValue("useIndexAccleration",!1),U=["x3dPlatformId"],i.addSharedSettings(widget,U),U.forEach(function(e){var t=widget.getPreference(e);R(t)}),"1"===widget.getValue("debug_me")&&(B("activateOpenWith18xFD01"),B("expandSaveLimitation"),B("resetCustomization"),B("compactModeForLeftSidebar"),B("CandABookmark")),B("activeIsLastVersionColumn"),!0===n.getSetting("Activate_relationsColumns")?B("activateRelationsColumns"):widget.addPreference({name:"activateRelationsColumns",type:"hidden"}),M.widget.addEvent("endEdit",n.updateWidgetPreferences.bind(n)),n.updateWidgetPreferences(),n.setSetting("activate_autodownload",!1),n.setSetting("EditModeActivated",!0),n.setSetting("compactMode",!0),!1!==widget.getValue("activeIsLastVersionColumn")){var V=y.getMap().defaultOrder;V.push("ds6wg:PLMReference.V_isLastVersion");var W={default:!0,order:V};y.updateAttributesList(W)}M.widget.getValue("x3dAppId")||M.widget.addPreference({name:"x3dAppId",type:"hidden",defaultValue:"ENOFOL3_AP"}),M.widget.getValue("appId")||M.widget.addPreference({name:"appId",type:"hidden",defaultValue:"ENOFOL3_AP"}),M.widget.addEvent("onPlatformIdChange",function(e,t){"x3dPlatformId"==e&&n.dispatchEvent("onPad_tenant")}),S.setWidgetRefresh(M.onRefresh.bind(M));let j={};j.onRefresh=S.getWidgetRefresh(),j.widgetCBOnPopup=S.onTenantSecurityCTXPopup,w.render(j);var q=require("DS/PADServices/utils/GlobalUtils");null==q.getSecurityContext()&&q.setSecurityContext(w.getCredential()),M.promiseCtx=new Promise(function(e){S.checkSecurityCTXandTenantInitialization(function(){e()},!0),r.app_initialization(()=>{})});let H=c.onBookmarkOpening(async()=>{let e=await m.getCurrentBookmarkInfo();e&&M.setTitle(e.getLabel())});O.push(H);var z=E.getWidgetId()+E.getTenantID()+"ENOFOL3_AP";if(I.subscribe(z,function(){A.refreshWidgetContent()}),p.onFolderRename(function(e){e.getID()===c.getCurrentBookmarkId()&&UWA.is(widget)&&M.setTitle(e.getLabel())}),M.setTitle=function(e){var t=E.getTenantID();let o=[];try{o=r.getTenantsPreference()}catch(e){console.log(e)}var n=o.filter(function(e){return e.value===t})[0];n=n?n.label:t;var i=widget.getPreference("pad_security_ctx").value;M._csName&&M._currentSC===i?M._setTitle(e,n,M._csName):require(["DS/PADUtils/PADWSAccess","DS/PADUtils/PADSecurityCtxConverter"],function(o,r){o.getscandcollab({tenant:t,onComplete:function(t){(UWA.is(t,"string")?JSON.parse(t):t).collabspaces.forEach(function(e){!!i&&i.endsWith("."+e.name)&&(M._currentSC=i,M._csName=e.title.trim())}),e&&M._setTitle(e,n,M._csName)},onFailure:function(e){}})})},M._setTitle=function(e,t,o){var n=e||"";o&&(n=o+" - "+n),M._label=e,widget.setTitle(n)},M.getEditMode=function(){var e=S.getContent();return!!e&&e.getEditMode()},M._onRefreshFolder=function(e){var t=!1,o=[];if(require("DS/FolderEditor/views/FolderMode").switchtoAuthoringMode(!0),e.authored&&UWA.is(e.authored.connected,"array")){var n=c.getCurrentBookmarkId(),i=e.authored.connected;if(i.length>0)for(var r=0;r<i.length;r++){var s=i[r];if(UWA.is(s,"array")){var a=s[0];if(s.length>1&&o.push(s[1]),a==n){t=!0;break}}}}t&&M.folderContent_Cont.loadContentAndSelect(void 0,o)},F.subscribe("FolderEditor.refresh",M._onRefreshFolder.bind(M)),M._commandProxy=o.create({events:{onRefresh:M._onRefreshFolder.bind(M)}}),null===M.folderTree_Cont||void 0===M.folderTree_Cont){M.core=t,M.widget.body.empty(),M._buildSkeleton(),N.setContainer("global",this.widget.body.globalLoaderContainer),N.addComponentsToLoad("global",{widget:""});M.widget.addEvent("endEdit",function(){M.widget.getPreferences().forEach(function(e){var t="boolean"===e.type&&UWA.is(e.value,"string")?M.convertToBool(e.value):e.value;M.widget.setValue(e.name,t)})}),M.folderGlobal_div=M.widget.body.container,M.folderTree_div=M.widget.body.left_side_div,M.folderSlide_div=M.widget.body.slide_div,M.folderTreeDoc_div=M.widget.body.right_side_div,M.folderIdCard_div=M.widget.body.top_right_side_div,M.folderContent_div=M.widget.body.bottom_right_side_div;var G=M._initializeFolderEditorComponent.bind(M);if(null===M.folderContent_Cont){var X={x3dAppId:M.widget.getValue("x3dAppId"),lang:M.widget.lang?M.widget.lang:M.widget.getValue("lang"),layout:{view_customization:null,css_view_class:M.css_view_class,store_roots_in_pref:!0,padshell:!0},authorize_setStructure:!0,settings:L};!0===n.getSetting("resetCustomization")?(localStorage.removeItem("PADTreeListDefinition."+M.widget.getValue("x3dAppId")+"_"+widget.getValue("x3dPlatformId")),G(X)):b.getContentViewPreference().then(function(e){var t=[];if(e){var o=e.preference;X.layout.view_customization=o;var n=widget.getValue("vMigration");if(o&&n!==o.version){console.log("Bookmark migration needed for preferences");var i=new Promise(function(t,o){require(["DS/FolderMigration/FolderMigration"],function(i){i.migratePreferences(e,n).then(t).catch(o)})});t.push(i)}}Promise.all(t).then(function(){G(X)})}),M.GetFilterSpec=function(e,t){return{filter:{prefix_filter:{prefix_path:t.V2.prefixPathArray}}}},M.getSelectedNodes=function(){var e=u.getTempSelection(),t=e||c.getSelectedNodes();if(1===(Array.isArray(t)?t.length:0)){var o=t[0];if(o&&"FolderSection_Trash"===o.getType()){var n=S.getTrashCont();if(n){var i=n.getSelectedNodes();Array.isArray(i)&&i.length>0&&(t=i)}}}return t},M.getCurrentFolder=function(){var e=b.getCurrentSecurityContextAndFolderData(!0);return JSON.stringify(e)},M.getSecurityContext=function(){var e=b.getTenant();return{SecurityContext:n.getSetting("pad_security_ctx"),tenant:e}},M.RefreshView=function(e){var t=!1,o=e.created,n=e.modified,i=e.deleted,r=[];if(o.forEach(function(e){"Duplicate"===e.operation||"Revise"===e.operation?t=!0:console.log("  unknown operation :",e.operation)}),i.length>0&&i.forEach(function(e){"Delete"===e.operation&&e.physicalid.length>0&&r.push(e.physicalid)}),!t&&n.length>0){var s={};s.modified=n,D.publish({event:"refresh_content_nodes",data:s})}return r.length>0&&D.publish({event:"remove_nodes",data:r}),!0===t&&D.publish({event:"refresh_content",data:{RefreshProductStructure:!0}}),e},M.beginBlockingTransaction=function(e){require(["DS/UIKIT/Mask"],function(t){t.mask(M.folderContent_div,e)})},M.endBlockingTransaction=function(){require(["DS/UIKIT/Mask"],function(e){e.unmask(M.folderContent_div)})},M.author=function(e){},M.insertNodes=function(e){var t=[];function o(e){-1===t.indexOf(e.resourceid)&&t.push(e.resourceid)}for(var n in e)e.hasOwnProperty(n)&&e[n].forEach(o);var i=t[0];M._insertOrAdd(i,"insert")},M.addRoots=function(e){if(e.pids.length>0){var t=e.pids[0];M._insertOrAdd(t,"add",!0)}},M._insertOrAdd=function(e,t,o){require("DS/FolderEditor/views/FolderMode").switchtoAuthoringMode(),D.publish({event:"refresh_tree",data:{creation:!0,expandCurrent:o}}),D.publish({event:"refresh_content",data:{objectId:e,insertMode:t}})},M.displayNotification=function(e){_.displayNotification({message:e.msg,className:e.eventID})},M.getPADTreeDocument=function(){return S.getContent()?S.getContent().getPADTreeDocument():this.options.model},M.toggleView=function(e){UWA.is(S.getContent().toggleView)&&S.getContent().toggleView(e)},M.getPADTreeListView=function(){return S.getContent().getPADTreeListView()},M.compactMode=function(e){return S.getContent().compactMode(e)}}}}function preferenceIsNotSet(e){return void 0===widget.getValue(e)||null===widget.getValue(e)}function FolderEditor(e){"use strict";var t=new Promise(function(e){require(["DS/FolderEditor/utils/FolderEditorUtil"],e)});let o=[];var n={widget:null,promiseCtx:null,promiseInit:null,folderContent_Cont:null,folderTree_div:null,folderTreeDoc_div:null,folderTree_Cont:null,folderIdCard_div:null,folderIdCard_Cont:null,core:null,widthToHideLeftPanel:300,_actionbar:null,_commandProxy:null,folderTree_W_NotLinked:!1,css_view_class:"windowed",_mouseEventsManager:{unlockMouseMove:!1,draggingXSlider:null,mouseStartXSlider:null,initialMouseStartXSlider:null,dragginDirection:null,cancelDragging:!1,spanPosition:null,widthLeftDiv:null,widthRightDiv:null,widthLeftDivSave:null,widthRightDivSave:null,widthGlobalDiv:null,newWidthGlobalDiv:null},init:function(e){var t=this;this.widget=e.widget,e.launchWithReadMode&&(this.widget.launchWithReadMode=this.widget.readOnly=e.launchWithReadMode),this.widget.folderToOpen=e.folderToOpen,this.widget.nativeAuthMode=e.nativeAuthMode,this.widget.multiselection=e.multiselection,this.reInitialize=e.reInitialize;var o=null,n={};this.widget=e.widget,this.widget.changeInPreference={},this.widget.refreshDuetoChangeInPreference=!1,this.widget.addEvent("onLoad",this.onLoad.bind(this)),this.widget.addEvent("onRefresh",this.onRefresh.bind(this)),this.widget.addEvent("onDestroy",this.onDestroy.bind(this)),this.widget.addEvent("onResize",this.onResize.bind(this)),this.widget.addEvent("onFocus",this.onFocus.bind(this)),this.widget.addEvent("onEdit",function(){o||(o=o||{},t.widget.preferences.forEach(function(e){"hidden"!==e.type&&(o[e.name]=t.widget.getValue(e.name))}))}),this.widget.addEvent("endEdit",function(e){require(["DS/FolderEditor/Folder_CSO"],e=>{e._manageOpenWith(!0)}),!(!e||!e.submitted&&!e.needRefresh)&&o&&(t.widget.changeInPreference={},Object.keys(o).forEach(function(e){if(n[e]=t.widget.getValue(e),o[e]!==n[e]){if("pad_security_ctx"===e&&n[e]){let t=require("DS/FolderEditor/service/FolderEditorWebService").setPreferredSecurityContext(n[e]);require("DS/IPClassifyUtil/IPClassifyUtility").promiseCatcher(t)}t.widget.changeInPreference[e]=n[e]}}),UWA.log(t.widget.changeInPreference),t.widget.refreshDuetoChangeInPreference=!0,o=null)})},onRefresh:function(e){var t=this;e&&e.reInitialize,require(["DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalModelEvents","DS/FolderEditor/utils/WidgetHandlerUtil","DS/FolderEditor/Folder_Clipboard"],function(o,n,i,r,s,a){var l=require("DS/FolderEditor/views/FolderMode");if(!(e&&e.authored&&UWA.is(e.authored.deleted,"array")&&(l.switchtoAuthoringMode(),r.publish({event:"remove_nodes",data:e.authored.deleted}),0==a.removeDeletedNodeFromClipboard(e.authored.deleted)&&a.ClearClipboard(),1===Object.keys(e.authored).length))){t.folderContent_Cont.addEvent("onCompleteRefreshNodes",function(){this.removeEvent("onCompleteRefreshNodes"),o.displayNotification({message:n.msg_info_refresh,className:"primary"})});var d=require("DS/FolderEditor/utils/FolderEditorcontrol").getFindInCtx();d&&d.visibleFlag&&d.closeViewafterRefresh(),l.updateIconAndSettings(!1),s.refreshWidgetContent(),require(["DS/FolderEditor/utils/FolderEditorcontrol","DS/PlatformAPI/PlatformAPI","DS/LifecycleServices/LifecycleServicesSettings"],function(e,t,o){var n=!1;o.getEnforceFolderLinkSettingAsync(function(e,t){e||(n=t)}),(n||e.isCustomizedEnv()||e.isActiveBookmarkActivated())&&t.publish("FolderEditor.ActiveFolderCheck",{})}),t.widget.refreshDuetoChangeInPreference=!1,t.widget.changeInPreference={}}})},setCtxMenu:function(e,t,o){require(["DS/FolderEditor/commands/FolderCommands"],function(o){o&&o.showWebInWinCtxMenu(e,t)})},insertSelectedSearchObjs:function(e){var t=e[0].split(",");require(["DS/FolderEditor/service/BkOperationsUtils"],function(e){!async function(){try{await e.processAddOperation(t)}catch(e){console.error("Error trying to execute command","ActiveFolder",e)}}()})},onWebInWinFilterChange:function(e){require(["DS/FolderEditor/tagger/TaggerContentProxy"],function(t){e.proxyId===t.getProxy().getProxyId()&&(["addFilterChangeListener","addCriteriaChangeListener"].indexOf(e.event_id)>=0?t.onFilterBIFilteringEvent(e.data):"colorize"==e.event_id?t.filterBIColorize(e.data):"unColorize"==e.event_id&&t.onFilterBIUnColorize(e.data))})},onClearSelection:function(){},onDestroy:function(){this.folderTree_Cont&&this.folderTree_Cont.destroy(),this.folderIdCard_Cont&&this.folderIdCard_Cont.destroy(),this.folderComponent&&this.folderComponent.destroy();let e=require("DS/PADServices/utils/GlobalModelEvents");o.forEach(t=>{e.unsubscribe(t)}),o=[]},onFocus:function(){if(widget._isFocus=!widget._isFocus,!1===widget._isFocus||void 0===widget._isFocus){var e=require("DS/FolderEditor/utils/FolderEditorcontrol").getTreeCont();if(!e)return;e.activateTreeFilter(!1)}},onResize:function(){var e=this;setTimeout(function(){e.folderGlobal_div&&e.folderIdCard_Cont&&0!==e.folderGlobal_div.clientWidth&&e.folderIdCard_Cont.updateDisplayPath()},500),require(["DS/IPClassifyUtil/IPClassifyUtility","DS/FolderEditor/utils/FolderEditorcontrol"],function(e,t){var o=t.getTreeCont();!o||widget._isFocus||e.isWidgetMaximized()||o.activateTreeFilter(!1)})},setSupportedTenant:function(){return new Promise((e,t)=>{require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],o=>{o.getAppInfo({appId:widget.getValue("x3dAppId")?widget.getValue("x3dAppId"):"ENOFOL3_AP",onComplete:function(t){t.platforms.length>0&&widget.setValue("x3dPlatformId",t.platforms[0].id),e()},onFailure:t})})})},applyExclusiveFilterAndLoadContent:function(e){require(["DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/tagger/TaggerContentProxy"],function(t,o){t.getContent().getSpecficMode("read").resetInfoIndex(),o.setLocalFilter(e),t.getContent().switchMode("read",!0)})},expandToBookmarkExternally:function(e){require(["DS/FolderEditor/utils/FolderEditorcontrol","DS/IPClassifyUtil/IPClassifyAlert"],function(t,o){var n=t.getTreeCont();t.getTreeCont().forceLoad=!0,n.expandTreeAndSelectFolder({folderToFindAndSelect:{ids:e.ids},partiallyExpandPath:e.isToBeExpandedPartially,onComplete:function(){dscef&&dscef.sendString('{"operation":"expand successful"}')},onFailure:function(e){dscef&&dscef.sendString('{"operation":"expand failed"}'),o.displayNotification({message:e instanceof Error?e.message:e,className:"error"})}})})},onLoad:function(){require(["DS/IPClassifyUtil/IPClassifyUtility"],function(e){e.setPCSEntry(widget.id+"_FolderWidgetLoad",!0)});var e=!0===widget.getValue("noCompass");if(e)widget.folderToOpen&&widget.nativeAuthMode&&"true"===widget.nativeAuthMode&&require(["DS/FolderEditor/views/FolderMode"],e=>{e.switchtoAuthoringMode()});else{require(["DS/MSFDocumentManagement/WidgetIntegration"],function(e){widget.MSFDocumentClient=e,widget.MSFDocumentClient.ConnectWidgetWithMSF()})}require(["DS/FolderEditor/Folder_CSO"],t=>{t._assignTenantFromX3DContentId();var o=widget.getValue("x3dPlatformId"),n=Promise.resolve();o||e||(n=this.setSupportedTenant()),n.then(this._preLoad.bind(this))});let t=new Promise(e=>{(window.hasOwnProperty("dsDashboardWindow")&&window!==dsDashboardWindow.top&&window.top.require?window.top.require:window.require)(["DS/Dashboard/WidgetLinkManager"],e)}),o=new Promise(e=>{require(["DS/RouteWebAppUX/Utilities/RouteLinkWidget"],e)});Promise.all([o,t]).then(e=>{let t=e[0];t.init(widget,{appIds:["ENXROUT_AP"],open:!0}),t.subscribeForRouteEvents(widget)})},_preLoad:function(){var e=this;this.probeHeader=this.widget.id+"_"+this.widget.getTitle()+"_",window.top.performance.mark("onLoad_begin"),window.top.performance.measure(this.probeHeader+"createToOnLoad","createWidget_begin","onLoad_begin");var t=!0;if(preferenceIsNotSet("vMigration")&&preferenceIsNotSet("pad_security_ctx"))widget.setValue("vMigration",7);else{var o=widget.getValue("vMigration");(o=o||0)<7&&(t=!1,console.log("Bookmark migration needed"),require(["DS/FolderMigration/FolderMigration"],function(t){t.migrate(7).then(function(){widget.migrated=!0,e._onLoad()})}))}t&&e._onLoad()},_onLoad:function(){var e=this;this.promiseInit=new Promise(function(t){!0===widget.getValue("noCompass")?require(["DS/FolderEditor/utils/FolderEditorEvents"],function(e){e.onFolderEditorReadyforWenInWin(function(){t()})}):e.widget.addEvent("onFolderEditorReady",function(){t()})}),require(["DS/PADUtils/Configuration","DS/PADServices/utils/PlatformURL","text!DS/FolderEditor/assets/FolderEditorConf.json","DS/PADServices/utils/AttributesMgtV2"],function(t,n,i,r){let s=n.retrievePlatformUrl();var a=JSON.parse(i);t.mergeConfig(a);var l=[],d=new Promise(function(e){require(requires,function(){e(arguments)})});if(l.push(d),!0!==e.reInitialize){var c=r.initialize({defaultAttributesJSON:"DS/FolderEditor/assets/FolderEditorColumns.json"});l.push(c)}l.push(s),Promise.all(l).then(function(t){initBookmark.apply(e,[{_subscriptionTokens:o},...t[0]])})})},_slidderMoveEndCallback:function(){this.folderIdCard_Cont&&this.folderIdCard_Cont.updateDisplayPath()},_buildSkeleton:function(){if(!this.core.is(this.widget.body.container)){var e=new UWA.Element("div",{class:"wux-control-inline-container",style:{"vertical-align":"top"}});e.inject(widget.body);var t=require("DS/Windows/ImmersiveFrame"),o=require("DS/WebUAUtils/WebUAUtils"),n=require("DS/WidgetServices/WidgetServices"),i=new t;i.inject(e),this.widget.immersiveFrame=i,"false"!==n.getUrlParameter("UAPanel")&&o.setPanelHelpMode({immersiveFrame:i}),this.widget.body.container=UWA.createElement("div",{class:"FolderEditor_global_container"}).inject(i.getFreeZone(),"top"),this.widget.body.globalLoaderContainer=UWA.createElement("div",{class:"FolderEditor_global_loader"}).inject(this.widget.body.container),this.widget.body.left_side_div=UWA.createElement("div",{class:"FolderEditor_left_side_div"}).inject(this.widget.body.container),this.widget.body.right_side_div=UWA.createElement("div",{class:"FolderEditor_right_side_div"}).inject(this.widget.body.container),this.widget.body.top_right_side_div=UWA.createElement("div",{class:"FolderEditor_top_right_side_div"}).inject(this.widget.body.right_side_div),this.widget.body.bottom_right_side_div=UWA.createElement("div",{class:"FolderEditor_bottom_right_side_div"}).inject(this.widget.body.right_side_div)}},convertToBool:function(e){return"true"===e.toLowerCase()},_initializeFolderEditorComponent:function(e){var t=this,o=require("DS/FolderEditor/FolderTreeCont"),n=require("DS/FolderEditor/utils/FolderEditorcontrol"),i=require("DS/FolderEditor/FolderComponent"),r=require("DS/FolderEditor/utils/FolderEditorKeyboardListener"),s=require("DS/LifecycleServices/LifecycleServicesSettings"),a=(require("DS/PADUtils/PADUtilsServices"),require("DS/PADUtils/PADProbes"),require("DS/IPClassifyUtil/IPClassifyUtility")),l=t.folderTree_Cont;t.folderTree_Cont||(l=new o({lang:t.widget.lang?t.widget.lang:t.widget.getValue("lang"),css_view_class:t.css_view_class,events:{onReady:function(){n.setTreeCont(this),t.folderTree_Cont=this,t.folderTree_Cont._commonToolSection.inject(this.elements.container,0),!0===widget.getValue("noCompass")?require(["DS/FolderEditor/utils/FolderEditorEvents"],function(e){e.notifyFolderEditorReady()}):t.widget.dispatchEvent("onFolderEditorReady")}}}));var d=t._retrieveinitializationOpts(),c=UWA.extend(e,d);c.multiselection=!1!==this.widget.multiselection,require(["UWA/Promise"],function(e){var o=[],n=new e(function(e){require(["DS/FolderEditor/views/additionalColumns/FolderIsLastRevisionColumn"],function(t){t.isAdditionalColumnsAvailable(function(o){!0===o?e(t):e()})})}),r=new e(function(e){require(["DS/FolderEditor/views/additionalColumns/BookmarkLocationColumn"],function(t){t.isAdditionalColumnsAvailable(function(o){!0===o?e(t):e()})})}),s=new e(function(e){require(["DS/FolderEditor/views/additionalColumns/ThumbnailColumn"],function(t){t.isAdditionalColumnsAvailable(function(o){!0===o?e(t):e()})})}),a=!0===window.isReplayODT?e.resolve():new e(function(e){require(["DS/FolderEditor/views/additionalColumns/ApprovalStatusColumn"],function(t){t.isAdditionalColumnsAvailable(function(o){!0===o?e(t):e()})})}),d=new e(function(e){require(["DS/FolderEditor/views/additionalColumns/FavoriteTitleColumn"],function(t){t.isAdditionalColumnsAvailable(function(o){!0===o?e(t):e()})})}),u=new e(function(e){require(["DS/IPClassifyUXUtil/views/additionalData/manipulationUnitColumns","DS/FolderEditor/dataProvider/ManipulationUnitColumnsDataProvider"],function(t,o){t.isAdditionalColumnsAvailable(o,function(o){!0===o?e(t):e()})})}),p=new e(function(e){require("DS/WidgetServices/WidgetServices").isReplayedODT()?e():require(["DS/ENORIPE_RelationsColumns/RelationsColumns"],function(t){t.isAdditionalColumnsAvailable(function(o){!0===o?(t.setPreferenceProxy(),e(t)):e()}),t.getOnCellClickCB=function(e){if(-1!==this.dataIndexes.indexOf(e))return function(t){t.nodeModel&&t.nodeModel.options.grid[e]>0&&require(["DS/FolderEditor/utils/FolderEditorEvents"],function(t){t&&t.notifyRightSidePanelOpen(e)})}}})});e.all([d,r,n,a,s,u,p]).then(function(e){var n;e.forEach(e=>{e&&o.push(e)}),(n=o).length&&(c.additionalColumnsModules=n),t.folderComponent=new i(c,l)})}),t.promiseInit.then(()=>{if(t.folderTree_Cont){t.folderTree_Cont._doScrolltotheSavedPosition(),a.setPCSEntry(widget.id+"_FolderWidgetLoad",!1),a.sendPCSTracketPageEvent("FolderWidget_Performance","FolderWidgetLoad",widget.id+"_FolderWidgetLoad");var e=window.top.performance.getEntriesByName("createWidget_begin");e&&e.length>0&&(window.top.performance.mark("createWidget_end"),window.top.performance.measure(t.probeHeader+"createWidget","createWidget_begin","createWidget_end")),setTimeout(()=>{var e=!1;s.getEnforceFolderLinkSettingAsync(function(t,o){t||(e=o)}),(e||n.isCustomizedEnv()||n.isActiveBookmarkActivated())&&require(["DS/ApplicationFrame/CommandsManager"],e=>{try{var t=e.getCommand("ActiveFolder",n.getContent());t&&t.begin()}catch(e){console.error("Error trying to execute command","ActiveFolder",e)}})})}}),t._keyboardListener||(t._keyboardListener=new r,t._keyboardListener.startObservingKeyboard())},_viewChanged:function(){require("DS/PADServices/utils/GlobalModelEvents").getModelEvents().publish({event:"ENOBook/AttributesCustomization/columnSwitchDone",data:{}})},_retrieveinitializationOpts:function(){var e=this,o=require("DS/FolderEditor/FolderIdCardCont");return{renderTo:e.folderContent_div,events:{onActionBarReadyToBuild:function(){e.elements=this.elements,e.options=this.options,e.togglePanel=this.togglePanel,null===e.folderIdCard_Cont&&new o({lang:e.widget.lang?e.widget.lang:e.widget.getValue("lang"),css_view_class:e.css_view_class,events:{onReady:function(){e.folderIdCard_Cont=this,e.folderIdCard_Cont.render().inject(e.folderIdCard_div)}}})},onReady:function(){e.folderContent_Cont=this,e.addEvent=e.folderContent_Cont.addEvent.bind(e.folderContent_Cont),e.folderContent_Cont.options.renderTo&&e.folderContent_Cont.render().inject(e.folderContent_Cont.options.renderTo),e.promiseInit.then(function(){if(e.folderTree_Cont){e.folderContent_Cont._OnPADComponentReady();var t=e.folderContent_Cont.getPADTreeListView();t&&e.folderTree_Cont.modeChange({viewMode:t.options.viewMode}),e.widget.dispatchEvent("onFolderComponentReady"),"undefined"!=typeof dscef&&dscef.sendString("BookmarkEditorReady")}}),require(["DS/IPClassifyUtil/IPClassifyCommunication"],function(t){if(!0===widget.getValue("noCompass")){var o;const n=function(n){clearTimeout(o),o=setTimeout(function(){var o=e.folderContent_Cont.getPADTreeDocument().getXSO().get(),n=[];o.forEach(function(e){n.push(e.getID())}),t.publish("onObjectSelected",n);require("DS/FolderEditor/views/FolderMode");var i=[];o.forEach(function(e){var t={id:e.getID(),label:e.getLabel(),type:e.options.type,cadMaster:e.options.grid["ds6w:cadMaster"],kind:e.options.grid["ds6w:kind"],contentStructure:e.options.grid["ds6w:contentStructure"]};i.push(t)}),t.publish("selectedObjectsInContent",i)},n)};e.folderContent_Cont.getPADTreeDocument().getXSO().onChange(function(){n(20)})}})},onCustoViewChange:function(o){t.then(function(t){t.setContentViewPreference(o,!1).then(e._viewChanged.bind(e))})},onSaveAsTemplate:function(o){t.then(function(t){t.setContentViewPreference(o,!0).then(e._viewChanged.bind(e))})},onToggleView:function(){require("DS/FolderEditor/ActionBar/FolderCommandManager").updateCommands()}}}}};return n.init(e),n}define("DS/FolderEditor/service/FolderEditorWebService",["UWA/Core","DS/WAFData/WAFData","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/IPClassifyUXUtil/CredentialsView","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUtil/IPClassifyUtility","DS/WidgetServices/WidgetServices","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/WidgetHandlerUtil","DS/FolderEditor/utils/QueriesManager","DS/IPClassifyUXUtil/utils/CancellablePromise","DS/IPClassifyUXUtil/service/IPClassifyUXUtilWebService","DS/FolderEditor/Folder_CSO","UWA/Utils/Client"],function(e,t,o,n,i,r,s,a,l,d,c,u,p,g,f,h,m){"use strict";let v=null,_=null;function S(e){return UWA.is(e,"array")?e.toString():e}var C=function(){var e=l.getWidgetValue("appId");return(e=e||l.getWidgetValue("x3dAppId"))+"-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime()};return{searchInFolder:function(e){var t={};UWA.extend(t,e);var r=null;if(e.pid){if(Array.isArray(e.pid)&&e.pid.length>200)return Promise.reject({serverErr:{error:{type:"warning",errorCode:"innerError",errorMessage:o.msg_warning_LimitInCtxSearchOnAllBookmarks}}});if(e.searchQuery&&e.searchQuery.length<3)return Promise.reject({serverErr:{error:{type:"warning",errorCode:"innerError",errorMessage:o.replace(o.SearchEnterMoreThan,{minNumber:3})}}});var s="FolderSection_AllFolders"===e.type?e.searchQuery:e.searchQuery+" AND NOT(physicalid:"+e.pid+")",a=i.get3DSearchUrl()+"/search",l=widget.lang?widget.lang:widget.getValue("lang");if(t.payload=Object.assign({},d.getSearchInfo()),t.payload.query=s,t.payload.tenant=i.getPlatformId(),t.payload.locale=l,t.payload.label="searchIn_"+C(),t.payload.source=["3dspace"],!0!==t.synthesis){t.payload.select_predicate=d.getIndexPredicates(),t.payload.with_synthesis="false";let o=d.getResultsCount();o&&(t.payload.nresults=o),t.payload.next_start=void 0,t.payload.start=void 0,t.payload.select_predicate=d.getIndexPredicates(),e.order_field&&t.payload.select_predicate.indexOf(e.order_field)>-1&&(t.payload.order_field=e.order_field,t.payload.order_by=e.order_by);var c=d.getInfoIndex();null==c||e.searchingInRoot?e.searchingInRoot&&!e.isFirstSearch?t.payload.next_start=e.next_start:t.payload.start=0:t.payload.next_start=c.next_start}var u=n.getSetting("pad_security_ctx");u&&(t.payload.login={"3dspace":{SecurityContext:u}}),"FolderSection_AllFolders"===e.type?t.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_path_physicalid:e.pid,type_filter_rel:["Data Vaults","Sub Vaults","Vaulted Objects"]}}}}:t.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_physicalid:e.pid,type_filter_rel:["Data Vaults","Sub Vaults","Vaulted Objects"]}}}},t.filters&&Object.keys(t.filters).length>0&&(t.payload.refine=t.filters),t.method="POST",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":l},t.type="json",t.data=UWA.Json.encode(t.payload),t.withoutSC=!0,t.timeout=12e4,r=f._executeQuery(a,t,"searchInFolder")}return r},loadThumbnails:function(e){return e.fetchThumbnails=!0,this.fetch(e)},getWidgetSettings:function(){return this.widgetSettings||(this.widgetSettings=new Promise((e,t)=>{f._executeQuery("/resources/v1/FolderManagement/Folder/settings",{type:"json",inSource:"3DSpace"},"loadSettings").then(e).catch(t)}),this.widgetSettings.catch(e=>{s.displayNotification({message:o.msg_error_settings,className:"error"}),console.log(e),this.widgetSettings=null})),this.widgetSettings},getServiceFromSource:function(e){let t=this.getServiceMapping()[e];return t||null},getSourceFromService:function(e){let t=this.getServiceMapping(!0)[e];return t||null},getServiceMapping:function(e){let t=e?_:v;return t||{}},getServicesPromise:function(){if(!this.serviceMapping){let e="/login",t={method:"GET",type:"json",inSource:"3DSearch"};this.serviceMapping=f._executeQuery(e,t,"getservicemapping"),this.serviceMapping=this.serviceMapping.then(e=>{v={www:"www"},_={www:"www"},e.infos.sources.forEach(e=>{v[e.name]=e.service,_[e.service]=e.name}),h.setServiceMapping(_)}),this.serviceMapping.catch(e=>{s.displayNotification({message:o.msg_error_search_login,className:"error"}),console.log(e),this.serviceMapping=null})}return this.serviceMapping},fetch:function(e){var t={};UWA.extend(t,e);var o=e.ids,r=null;if(o.length){var s=i.get3DSpaceUrl()+"/cvservlet/fetch/v2",a=l.getLanguage(),d={physicalid:o,label:C()};t.fetchThumbnails&&(d.select_file=["thumbnail_2d","icon"]),t.select_predicate&&(d.select_predicate=t.select_predicate),t.query={tenant:e.tenant};let c=n.getSetting("pad_security_ctx");t.method="POST",t.headers={Accept:"application/json","content-type":"application/json",SecurityToken:window.top.dsUserLogin+"|"+c+"|preferred","Accept-Language":a},t.type="json",t.data=UWA.Json.encode(d),t.withoutSC=!0,r=f._executeRequest(s,t,"loadThumbnails")}return r},getHeadersInformations:function(){l.get3DSpaceUrlAsync({onComplete:e=>{return{service:"3DSpace",serviceBaseUrl:e,tenant:l.getTenantID(),header:{SecurityContext:encodeURIComponent("ctx::"+widget.getValue("xPref_CREDENTIAL"))}}}})},_getProductExpandConditions:function(){return new Promise((e,t)=>{this.getWidgetSettings().then(t=>{let o="UPS"===t.modeler;e({types:o?["VPMReference","VPMRepReference","XCADNonPSBaseRepReference","Drawing","3DShape"]:["CATPart","CATProduct","CATIA Embedded Component","CATProcess","CATDrawing","CATAnalysis","CATShape"],noRel:["XCADBaseDependency","Reference Document"]})}).catch(t)})},listContent_ExpandLevel_Structures:function(e){var t=l.getCancelObject();let o=this._getProductExpandConditions().then(o=>{if(!t.isCancelled()){let l=o.types;l.push("Workspace"),l.push("Workspace Vault");let d="(taxonomies:"+l.join(") OR (taxonomies:")+")",c=o.noRel;c.push("Data Vaults"),c.push("Sub Vaults"),c.push("Linked Folders");let u="NOT (taxonomies:"+c.join(") AND NOT (taxonomies:")+")";var r=i.get3DSpaceUrl()+"/cvservlet/progressiveexpand/v2?output_format=cvjson",s={};UWA.extend(s,e);var a=new Date;let p=("listContent_ExpandLevel_Structures"+Math.random().toString(36).substring(2,9)+"_"+a.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-");s.payload={batch:{expands:[{label:p,root:{physical_id:s.pid},graph:{descending_condition_object:{uql:d},descending_condition_relation:{uql:u}},filter:{all:1},parameters:{graph_advise:1}}]},outputs:{select_object:["physicalid"],format:"entity_relation_occurrence"}};let g=n.getSetting("pad_security_ctx");s.headers={SecurityContext:g,SecurityToken:window.top.dsUserLogin+"|"+g+"|preferred","content-type":"application/json"},s.type="json",s.data=UWA.Json.encode(s.payload),s.method="POST",s.timeout=12e4,t.handler=f._executeQueryWithError(r,s,"listContent_ExpandLevel_Structures")}});return a.promiseCatcher(o),t},content:function(e){var t={};UWA.extend(t,e);var o=null;if(e.searchQuery)o=this.searchInFolder(e);else{var n=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+t.pid+"/getContent?filter="+("Yes"===t.filterChildren);t.payload={},t.payload.Content="All"===t.content?"All":void 0,t.payload.select_predicate=d.getAuthAttributes(),t.headers={"content-type":"application/json"},t.data=UWA.Json.encode(t.payload),t.method="POST",t.type="json",t.timeout=12e4,o=f._executeQuery(n,t,"content")}return o},getParentPath:function(e){var t,o={};o.IDs=e.objectIds;var n=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/getParentPath";return o.IDs&&(t=o.IDs),o.method="POST",o.type="json",o.headers={Accept:"application/json","content-type":"application/json"},o.query={},o.payload={IDs:t,parentFolderId:"parent"},o.IDs="",o.data=UWA.Json.encode(o.payload),o.timeout=12e4,f._executeQuery(n,o,"getParentPath")},getRelatedBookmarks:function(e){var t={};t.contentId=e.contentId;var o="/resources/v1/FolderManagement/Folder/"+t.contentId+"/getRelatedBookmarks";return t.type="json",t.method="GET",t.inSource="3DSpace",t.headers={Accept:"application/json"},f._executeQuery(o,t,"getRelatedBookmarks")},roots:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/roots";return t.method="POST",t.payload={},t.payload.Type="Personal Workspace"==t.type?"Personal":t.type,t.payload.CollabSpace=t.collabSpace,t.payload.select_predicate=d.getAuthAttributes(),t.headers={"content-type":"application/json"},t.data=UWA.Json.encode(t.payload),t.type="json",t.timeout=12e4,f._executeQuery(o,t,"roots")},getTreeOrder:function(e){var t,o=e,n=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/treeOrder";return o.IDs&&(t=o.IDs),o.method="POST",o.type="json",o.headers={Accept:"application/json","content-type":"application/json"},o.query={},o.payload={IDs:t,parentFolderId:o.parentId},o.IDs="",o.data=UWA.Json.encode(o.payload),o.timeout=12e4,f._executeQuery(n,o,"treeOrder")},allBookmarks:function(e){return e.start||(e.start=0),e.fetchAll=!0,e.noIcon=!0,this._performSearchQuery(e,"(type:Workspace)","allBookmarks")},fetchIndexAttributes:function(e){let t=e.idsPerAttrAndService,o=e.searchQuery,n=(o=o?o+" AND ":"").length,i=[];for(let e in t){let o=t[e];for(let t in o){let r=this.getSourceFromService(t);f.splitIdForSearch(e,o[t],n).forEach(e=>{i.push({query:e,sourceId:r})})}}return new p({maxThreadNumber:4,datas:i,fcn:t=>new Promise((n,i)=>{this._performSearchQuery({...e,sourceId:t.sourceId,fetchAll:!0,onComplete:n,onFailure:i,onTimeout:i},o+t.query,"fetchAttrs")})}).execute()},_performSearchQuery:function(e,t,o){var r={};UWA.extend(r,e);var s=i.get3DSearchUrl()+"/search";r.payload=Object.assign({},d.getSearchInfo()),r.select_predicate?r.payload.select_predicate=r.select_predicate:r.payload.select_predicate=r.payload.select_predicate;var a=new Date,l=Math.random().toString(36).substring(2,9);r.payload.label=("BookmarkSearch_"+o+l+"_"+a.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-");var c=widget.lang?widget.lang:widget.getValue("lang");r.payload.locale=c,r.payload.query=t,r.payload.tenant=i.getPlatformId(),e.fetchAll||(r.payload.next_start=e.next_start,r.payload.start=e.start),e.noIcon&&(r.payload.select_file=void 0),r.payload.source=[e.sourceId?e.sourceId:"3dspace"];var u=n.getSetting("pad_security_ctx");return u&&(r.payload.login={"3dspace":{SecurityContext:u}}),r.method="POST",r.headers={"content-type":"application/json"},r.withoutSC=!0,r.type="json",e.order_field&&(r.payload.order_field=e.order_field,r.payload.order_by=e.order_by),e.searchPageCount&&(r.payload.nresults=e.searchPageCount),!0===e.fetchAll&&(r.payload.nresults=1e3),r.filters&&Object.keys(r.filters).length>0&&(r.payload.refine=r.filters),r.data=UWA.Json.encode(r.payload),f._executeRequest(s,r,"searchInLibrary")},addExternalLink:function(e){return this.addExternalObject({id:e.id,objects:[h.getDefaultModelFromProperties({i3dx:e.url,serviceId:"www",label:e.urlTitle})]})},moveExternalObject:function(e){var t=e;let o=t.id,n=t.members;var r=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+o+"/movelinkedcontents";return t.headers={Accept:"application/json","content-type":"application/json"},t.method="POST",t.type="json",t.payload={members:n},t.data=UWA.Json.encode(t.payload),t.timeout=12e4,f._executeQuery(r,t,"moveExternalLink")},addExternalObject:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+t.id+"/addlinkedcontent";return t.headers={Accept:"application/json","content-type":"application/json"},t.method="POST",t.type="json",t.payload={data:{items:[]}},e.objects.forEach(e=>{let o={serviceId:e.getAttributeValue("serviceId"),objectId:e.getAttributeValue("i3dx")||e.getAttributeValue("uri"),displayName:"www"===e.getAttributeValue("serviceId")?e.getLabel():""};t.payload.data.items.push(o)}),t.data=UWA.Json.encode(t.payload),t.timeout=12e4,f._executeQuery(o,t,"addExternalObject")},getLinks:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+t.pid+"/getlinkedcontent";return t.type="json",t.method="GET",t.headers={Accept:"application/json"},f._executeQuery(o,t,"getlinkedcontent")},getlinkProperties:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+t.pid+"/getlinkProperties";return t.type="json",t.method="GET",t.headers={Accept:"application/json"},f._executeQuery(o,t,"getlinkProperties")},editLink:function(e){var t=e;return t.headers={Accept:"application/json","content-type":"application/json"},e.securityContext&&(t.headers.SecurityContext=e.securityContext,t.withoutSC=!0),t.method="POST",t.type="json",t.inSource="3DSpace",t.payload={},t.payload={members:t.members,selectdata:{}},t.urlTitle&&(t.payload.selectdata.appdata=t.urlTitle),t.url&&(t.payload.selectdata.uri=t.url),t.data=UWA.Json.encode(t.payload),t.timeout=12e4,f._executeQuery("/resources/v1/FolderManagement/Folder/editlinkedcontent",t,"editlinkedcontent")},removeExternalLink:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+t.id+"/removelinkedcontent";return t.headers={Accept:"application/json","content-type":"application/json"},t.method="POST",t.type="json",t.payload={},t.payload={members:e.members},t.data=UWA.Json.encode(t.payload),t.timeout=12e4,f._executeQuery(o,t,"removelinkedcontent")},AddBookmarkShortcut:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/AddBookmarkShortcut";return t.payload={},t.payload.input_physical_ids={sourceID:e.ObjetcID,targetID:e.TargetFolderID},t.type="json",t.method="POST",t.headers={"content-type":"application/json"},t.data=UWA.Json.encode(t.payload),t.timeout=12e4,f._executeRequest(o,t,"roots")},DownloadFolderStructure:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/FolderDownloadPost";t.headers={"content-type":"application/json"},t.method="POST",t.data={physicalId:t.pid,FCSurl:i.get3DSpaceUrl()},t.data=UWA.Json.encode(t.data),t.timeout=12e4,f._executeRequest(o,t,"FolderDownloadPost")},_findBookmarksInBookmark(e){const t=`${i.get3DSpaceUrl()}/cvservlet/progressiveexpand/v2?output_format=cvjson`,o=`FolderWidgetSearch_${Math.random().toString(36).substring(2,9)}_${(new Date).getTime()}`.replace(/[\s,\/]/g,e=>" "===e?"_":","===e?"":"-");var r;"string"==typeof e.pid&&(e.pid=[e.pid]),e.searchFTSquery?r=e.pid.map((t,n)=>({label:`${o}_${n}`,root:{physical_id:t},parameters:{graph_advise:1,limit_max_path:101},graph:{descending_condition_relation:{uql:"(taxonomies:Data Vaults) OR (taxonomies:Sub Vaults)"}},filter:{sequence_filter:{sequence:[{uql:`[ds6w:label]:(*${e.searchFTSquery}*)`}]}},aggregation_processors:[{truncate:{compute_matching_subpaths_lengths:1,sequence_filter:{sequence:[{uql:`[ds6w:label]:(*${e.searchFTSquery}*)`}]}}},{synthesis:{name:"xSynth",mode:"occurrence",group_by_facet:1,synthesis_only:0,exclude_root_from_count:!0}}]})):e.rscIdToSearch&&(r=e.pid.map((t,n)=>({label:`${o}_${n}`,root:{physical_id:t},parameters:{graph_advise:1,limit_max_path:101},graph:{descending_condition_relation:{uql:"(taxonomies:Data Vaults) OR (taxonomies:Sub Vaults)"}},filter:{sequence_filter:{sequence:[{uql:`(physicalid:${e.rscIdToSearch})`}]}},aggregation_processors:[{truncate:{compute_matching_subpaths_lengths:1,sequence_filter:{sequence:[{uql:`(physicalid:${e.rscIdToSearch})`}]}}},{synthesis:{name:"xSynth",mode:"occurrence",group_by_facet:1,synthesis_only:0,exclude_root_from_count:!0}}]})));const s={batch:{expands:r},outputs:{select_object:["physicalid","label"],format:"entity_relation_occurrence",matching_lengths:1}},a={...e,payload:s,headers:{SecurityContext:n.getSetting("pad_security_ctx"),"content-type":"application/json"},type:"json",data:JSON.stringify(s),method:"POST",timeout:12e4};return f._executeQueryWithError(t,a,"_findBookmarksInBookmark")},getToolbar:function(e){return l.get3DSpaceUrlAsync({onComplete:function(t){var o=e,n=t+"/resources/v1/FolderManagement/Folder/toolsCommands";o.query={touch:m.Features.touchEvents&&!m.Features.pointerEvents,activeFolder:c.isActiveBookmarkActivated(),importCSV:c.isImportCSVActivated(),customizedEnv:c.isCustomizedEnv(),readOnly:1==widget.launchWithReadMode},o.method="GET",o.headers={Accept:"text/xml,application/json"},o.withoutSC=!0,f._executeRequest(n,o,"commands")}})},getActionBar:function(e){return l.get3DSpaceUrlAsync({onComplete:function(t){var o=e,n=t+"/resources/v1/FolderManagement/Folder/commands";o.query={touch:m.Features.touchEvents&&!m.Features.pointerEvents,activeFolder:c.isActiveBookmarkActivated(),importCSV:c.isImportCSVActivated(),customizedEnv:c.isCustomizedEnv()},o.method="GET",o.headers={Accept:"text/xml,application/json"},o.withoutSC=!0,f._executeRequest(n,o,"commands")}})},setPreferredSecurityContext:function(e,t){var o=null,n=new Promise((n,i)=>{o=l.get3DSpaceUrlAsync({onComplete:r=>{var s=t||{},a=r+"/resources/pno/person/setsecuritycontext";s.query={SecurityContext:e},s.method="POST",s.withoutSC=!0,(o=f._executeQuery(a,s,"commands")).then(n).catch(i)}})});return n.cancel=(()=>{o&&o.cancel()}),n},folders:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+t.pid+"/folders";t.query={Level:t.level},t.method="GET",f._executeRequest(o,t,"folders")},folderTree:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+(t.pid||"root")+"/folderTree";if(t.headers={"content-type":"application/json"},t.data={expandList:S(t.expandList),level:t.level&&t.level+"",isRoot:t.isRoot?"true":"",isPersonalFolder:t.isPersonalFolder},t.explicitRoots&&t.explicitRoots.length>0&&(t.data.explicitRoots=t.explicitRoots),t.partialExpandList&&t.partialExpandList.length>0&&(t.data.partialExpandList=t.partialExpandList),1==e.Read){t.data.Read=!0,t.data.nresults=d.getResultsCount(u.ROOTS_PER_PAGE);var n=c.getTreeCont()._folders_SortElmt;t.data.sortOrder=n.sortOrder,t.data.sortMode="alpha"==n.sortMode?"ds6w:label":"ds6w:created",t.data.nextStart=t.nextStart,t.data.refine=t.refine}else t.data.Read=!1;t.data=UWA.Json.encode(t.data),t.method="POST",t.timeout=12e4,f._executeRequest(o,t,"folderTree")},removecontent:function(e){var t=e,o=a.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+t.pid+"/removecontent";t.headers={"content-type":"application/json"},t.IDs&&(t.data={IDs:S(t.IDs),isLinkedFolder:!0===t.isLinkedFolder?"TRUE":"FALSE"},t.data=UWA.Json.encode(t.data)),t.type="json",t.method="POST",t.timeout=12e4,f._executeRequest(o,t,"removeContent")},replaceContent:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+t.pid+"/replacebycontent";t.headers={"content-type":"application/json"},t.IDsRemoved&&t.IDsAdded&&(t.data={IDsRemoved:S(t.IDsRemoved),IDsAdded:S(t.IDsAdded)},t.data=UWA.Json.encode(t.data)),t.method="PUT",t.timeout=12e4,f._executeRequest(o,t,"replaceContent")},getlastversion:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/dslc/getlastversions?validIntents=E&";t.headers={"content-type":"application/json"};var n=t.objectsToTreat;n&&(t.data=n),t.data=UWA.Json.encode(t.data),t.method="POST",t.timeout=12e4,f._executeRequest(o,t,"getlastversion")},addcontent:function(e){var t=e,o="/resources/v1/FolderManagement/Folder/"+t.pid+"/content";if(t.headers={"content-type":"application/json"},t.IDs){var n=this._deduplicateContentId(t.IDs);t.data={IDs:S(n)},t.data=UWA.Json.encode(t.data)}return t.inSource="3DSpace",t.method="POST",t.type="json",t.timeout=12e4,f._executeQuery(o,t,"addContent")},movecontent:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+t.pid+"/content";t.headers={"content-type":"application/json"},t.IDs&&t.SourceFolderId&&(t.data={IDs:S(t.IDs),SourceFolderId:t.SourceFolderId},t.data=UWA.Json.encode(t.data)),t.method="PUT",t.type="json",t.timeout=12e4,f._executeRequest(o,t,"moveContent")},checkCopyfolder:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder";t.headers={"content-type":"application/json"},t.PhysicalId&&(o+="/checkCount",t.data={physicalIds:S(t.PhysicalId)},t.data=UWA.Json.encode(t.data)),t.method="POST",t.timeout=12e4,f._executeRequest(o,t,"copyFolder")},copyfolder:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder";t.headers={"content-type":"application/json"},t.TargetPhysicalId&&t.PhysicalId&&(o+="/"+t.TargetPhysicalId,t.data={physicalIds:S(t.PhysicalId)},e.hasOwnProperty("withContent")&&(t.data.withContent=e.withContent),e.hasOwnProperty("prefix")&&(t.data.prefix=e.prefix),e.hasOwnProperty("suffix")&&(t.data.suffix=e.suffix),t.data=UWA.Json.encode(t.data)),t.method="POST",t.timeout=12e4,f._executeRequest(o,t,"copyFolder")},getFolderProperties:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+t.pid+"/properties";t.method="GET",f._executeRequest(o,t,"getFolderProperties")},getFavoritesProperties:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/favoritesInformation";t.method="POST",t.headers={"content-type":"application/json"};var n={physicalids:t.phids};t.data=JSON.stringify(n),f._executeRequest(o,t,"getFavoritesProperties")},getContentProperties:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+t.pid+"/ContentProperties";t.method="POST",t.payload={},t.payload.select_predicate=d.getAuthAttributes(),t.headers={"content-type":"application/json"},t.data=UWA.Json.encode(t.payload),f._executeRequest(o,t,"getContentProperties")},setFolderProperties:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+t.pid+"/update";t.method="POST",t.headers={"content-type":"application/json"},t.type="json",t.data=UWA.Json.encode(t.properties),f._executeRequest(o,t,"setFolderProperties")},movefolder:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder";t.headers={"content-type":"application/json"},t.TargetPhysicalId&&t.PhysicalId&&(o+="/"+t.TargetPhysicalId,t.data={physicalIds:S(t.PhysicalId)},t.data=UWA.Json.encode(t.data)),t.method="PUT",t.timeout=12e4,f._executeRequest(o,t,"moveFolder")},getFolderPath:function(e){var t=e;return t.headers={"content-type":"application/json"},t.pids&&(t.data={folderIds:S(t.pids)},t.data=UWA.Json.encode(t.data)),t.method="POST",t.inSource="3DSpace",t.type="json",t.timeout=12e4,f._executeQuery("/resources/v1/FolderManagement/Folder/path",t,"getFolderPath")},newFolder:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/create";t.method="POST",t.type="json",t.headers={"content-type":"application/json"};let n=e.parentBookmarkId&&""!==e.parentBookmarkId?e.parentBookmarkId:void 0,r=JSON.stringify({members:[{parentId:n||void 0}]});return t.data=r,t.forcedSecurityContext&&(0!=t.forcedSecurityContext.indexOf("ctx::")&&(t.forcedSecurityContext="ctx::"+t.forcedSecurityContext),t.headers.SecurityContext=encodeURIComponent(t.forcedSecurityContext)),f._executeQuery(o,t,"newBookmark")},deleteFolder:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/lifecycle/Delete/structure";t.method="POST",t.headers={"content-type":"application/json"};var n={data:[{physicalid:t.pid}]};t.data=JSON.stringify(n),t.forcedSecurityContext&&(0!=t.forcedSecurityContext.indexOf("ctx::")&&(t.forcedSecurityContext="ctx::"+t.forcedSecurityContext),t.headers.SecurityContext=encodeURIComponent(t.forcedSecurityContext)),f._executeRequest(o,t,"deleteFolder")},personSearch:function(e){var t=e,o=i.get3DSpaceUrl()+"/resources/v2/e6w/service/PersonSearch";t.query={searchStr:t.name},t.method="GET",f._executeRequest(o,t,"personSearch")},_deduplicateContentId:function(e){var t=[],o=[];return null!=e&&Array.isArray(e)&&e.forEach(function(e){o.indexOf(e)<0&&(o.push(e),t.push(e))}),t}}}),define("DS/FolderEditor/views/xBookInitError",["css!DS/PADUtils/PADUtils","i18n!DS/PADUtils/assets/nls/PADUtils.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Options"],function(e,t,o,n,i){"use strict";return n.extend(i,{init:function(e){this._parent(e),this.elements.container=UWA.createElement("div",{class:"pad_error_all"}),this.elements.errormsg=UWA.createElement("span",{class:"pad_error_msg"}),this.elements.errormsg.innerHTML=e.msg,this.elements.errormsg.inject(this.elements.container)},render:function(){return this}})}),define("DS/FolderEditor/views/additionalColumns/ApprovalStatusColumn",["UWA/Core","UWA/Class","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/PlatformAPI/PlatformAPI","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,t,o,n,i,r,s){"use strict";return t.singleton({init:function(e){this._parent(e),r.subscribe("updateRouteContent-"+widget.id,function(e){require(["DS/RouteWebAppUX/scripts/RouteWebAppApprovalStatusUX"],t=>{let n=t.getApprovalStatusValue(e);Object.entries(n).map(e=>{var t=e[1].approvalStatus,n=e[1].approvalStatusModel;let i={};i[e[0]]={grid:{ApprovalStatus:t,approvalStatusModel:n}},o.publish({event:"updateContentNodes",data:{items:i}})})})})},isAdditionalColumnsAvailable:function(e){var t={text:s.column_ApprovalStatus,dataIndex:"ApprovalStatus",typeRepresentation:"user",editableFlag:!1,alignment:"center",sortableFlag:!1,visibleFlag:!1,customisation:{dataIndex:"ApprovalStatus",exportable:{lock:!1,value:!0},layout:{removable:!1}}};this._columnDataIndex=["ApprovalStatus"],this._columnDef={ApprovalStatus:t},e(!0)},getName:function(){return"ApprovalStatus"},getManagedColumnNames:function(){return this._columnDataIndex},toBeUpdated:function(e){return void 0===e.ApprovalStatus},updateAttributes:function(e,t){var o=[];e.pids.forEach(function(e){var t={id:e};o.push(t)});var r={},s={};s.tenant=i.getPlatformId(),s.securityContext=n.getSetting("pad_security_ctx");r={};var a={data:o,option:s};require(["DS/RouteWebAppUX/scripts/RouteWebAppApprovalStatusUX"],function(e){e.getColumnApprovalStatusValue(a).then(function(e){var o="string"==typeof e?JSON.parse(e):e;Object.entries(o).map(e=>{var t=e[1].approvalStatus,o=e[1].approvalStatusModel;r[e[0]]={ApprovalStatus:t,approvalStatusModel:o}}),t({pids:r})}).catch(function(){console.log("Exception"),t({})})})},getAdditionalColumnsUXDGV:function(t){var o=this._columnDataIndex[0],n=e.clone(this._columnDef[o]),i=!1;t.every((r,s)=>((i=r.dataIndex===o)&&(t[s]=e.extend(t[s],n,!0)),!i)),i||t.push(n)}})}),define("DS/FolderEditor/commands/ActionBar_ExpandNCmd",["UWA/Core","DS/ApplicationFrame/Command"],function(e,t){"use strict";return t.extend({labelTopBar:e.i18n("Expand N levels"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1}),require(["DS/IPClassifyUtil/IPClassifyAlert","DS/PADUtils/views/PADLevelSel","DS/FolderEditor/Folder_CSO","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorcontrol"],function(e,t,o,n,i){})},beginExecute:function(){},execute:function(){var e=require("DS/IPClassifyUtil/IPClassifyAlert"),t=require("DS/PADUtils/views/PADLevelSel"),o=require("DS/FolderEditor/Folder_CSO"),n=require("i18n!DS/FolderEditor/assets/nls/FolderEditor"),i=require("DS/FolderEditor/utils/FolderEditorcontrol").getContent().getSelectedNodes(),r=null;r=o.getSelectedBookmark(),i.length?new t({events:{onApply:function(e){i.forEach(function(t){null===t.options.children||t.expandNLevels({numberOfLevelsToExpand:parseInt(e),initialLevel:t.getNodeDepth()})})}}}):null===r?e.displayNotification({message:n.msg_warning_noselection,className:"warning"}):new t({events:{onApply:function(e){r.expand({expandLevel:parseInt(e),clearLast:!0,initialLevel:r.getNodeDepth(),_expandChildren:!1})}}})},endExecute:function(){}})}),define("DS/FolderEditor/commands/tools/ImportCSVFilesUtils",["UWA/Core"],function(e){"use strict";return{formatBytes:function(e,t){if(0===e)return"0 Byte";var o=t+1||3,n=Math.floor(Math.log(e)/Math.log(1e3));return(e/Math.pow(1e3,n)).toPrecision(o)+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][n]},getStringByte4UTF8:function(e){for(var t=[0,1,1,1,2,3,2,3,4,3],o=0,n=0;n<e.length;n++)o+=t[encodeURIComponent(e.charAt(n)).length];return o},Sanitize:{encode:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}},removeControllCode:function(e){return e.replace(/[\t\r\n]/g,"")},escapeControllCode:function(e){return e.replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/\n/g,"\\n")}}}),define("DS/FolderEditor/utils/QueriesManager",["DS/IPClassifyUXUtil/utils/CancellablePromise"],e=>{return class{constructor({maxThreadNumber:e,datas:t,fcn:o}){this._answers=null,this._globalPromise=null,this._resolveCallback=null,this._rejectCallback=null,this._maxThreadNumber=e,this._callback=o,this._queue=t,this._inProgress=[],this._failed=!1,this._answers=[]}_next(){if(this._inProgress.length<this._maxThreadNumber&&this._queue.length>0&&!0!==this._globalPromise.isCancelled){let e=this._queue.shift(),t=this._callback(e);this._inProgress.push(t),t.then(e=>{this._answers.push(e),this._failed||this._next()}).catch(e=>{this._failed=!0,console.log(e),this._rejectCallback(e)}).finally(()=>{this._inProgress.splice(this._inProgress.indexOf(t),1),0===this._inProgress.length&&0===this._queue.length&&this._resolveCallback(this._answers)})}}execute(){return this._globalPromise||(this._globalPromise=new e((e,t)=>{this._resolveCallback=e,this._rejectCallback=t}),this._globalPromise.onCancel(()=>{this._resolveCallback()}),setTimeout(()=>{this._next()})),this._globalPromise}}}),define("DS/FolderEditor/utils/FolderLoaderGlobal",["UWA/Class","DS/Controls/Loader","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,t,o){function n(e){console.log("%c"+e,"color: orange")}function i(){let e=new t({height:35,fadeDuration:0,showButtonFlag:!0}),o=new t({height:35,fadeDuration:0}),n={},i={container:null,cancellable:e,std:o,keyMapping:n,hasCancellableMessages:function(){return Object.values(n).filter(t=>t.loader===e).length>0},hasMessages:function(){return Object.keys(n).length>0},next:function(){this.container&&(this.hasMessages()?this.show():this.hide())},show:function(){this.hasCancellableMessages()?(this.std.remove(),this.cancellable.inject(i.container)):(this.cancellable.remove(),this.std.inject(i.container)),i.container.style.display="flex"},hide:function(){i.container.style.display="none"}};return i}return e.singleton({init:function(){this.loader={global:i(),contentView:i(),treeView:i()}},setContainer:function(e,t){if(this.loader.hasOwnProperty(e)){let o=this.loader[e];o.container=t,o.next()}else n('The type of loader "'+e+'" is not defined.')},addComponentsToLoad:function(e,t,i){var r;let s=this.loader[e];if(s){for(var a in t){s.keyMapping[a]&&this.removeComponentToLoad(e,a);let n=a[0].toUpperCase()+a.substring(1)+"_Loading";r=null!=o[n]?o[n]:t[a];let l=i&&i.withCancel?s.cancellable:s.std;if(l.on(r),i&&i.withCancel&&i.cancelObject){let e=()=>{i.cancelObject.cancel(),l.removeEventListener("buttonclick",e)};l.addEventListener("buttonclick",e)}s.keyMapping[a]={loader:l,message:r}}s.next()}else n('The type of loader "'+e+'" is not defined.')},updateComponentPourcent:function(e,t,o){for(var n in t)this.loader[e].keyMapping[n]&&this.loader[e].keyMapping[n].loader&&this.loader[e].keyMapping[n].loader.update(o)},removeComponentToLoad:function(e,t){let o=this.loader[e];if(o){let e=o.keyMapping[t];e&&(e.loader.off(e.message),delete o.keyMapping[t]),o.next()}else n("The type of loader "+e+" is not defined.")}})}),define("DS/FolderEditor/popup/RemoveFromFavoritesPopup",["UWA/Controls/Abstract","DS/Controls/Button","DS/Windows/Dialog","DS/WidgetServices/WidgetServices","i18n!DS/FolderEditor/assets/nls/RemoveFromFavoritesPopup"],function(e,t,o,n,i){return e.extend({init:function(e){this._parent(e),this.buildSkeleton(e)},buildSkeleton:function(e){var r=e.favorite.options.favoriteTitle,s=UWA.createElement("div",{class:"removeFromFav-commonContent",styles:{display:"flex","flex-direction":"row"}}),a=UWA.createElement("div",{class:"removeFromFav-warning",styles:{height:"100%","padding-right":"10px"}});n.get3DSpaceUrlAsync({onComplete:function(e){var t=e+"/webapps/FolderEditor/assets/images/warning.png";a.innerHTML='<img src="'+t+'"></img>'}}),a.inject(s);var l=UWA.createElement("div",{class:"removeFromFav-Label"});l.inject(s),UWA.createElement("p",{class:"removeFromFav-paragraph-title",text:i.replace(i.title,{favname:r}),styles:{"font-weight":"bold"}}).inject(l),UWA.createElement("p",{class:"removeFromFav-paragraph",text:i.subtitle}).inject(l),UWA.createElement("p",{class:"removeFromFav-paragraph",text:i.replace(i.question,{favname:r})}).inject(l);var d=i.replace(i.popuptitle,{favname:r}),c=new o({immersiveFrame:widget.immersiveFrame,title:d,content:s,activeFlag:!1,modalFlag:!0,resizableFlag:!0,width:400,buttons:{Ok:new t({label:i.buttonRemove,onClick:function(t){t.preventDefault(),t.stopPropagation(),e.callback(!0),c.destroy()}}),Cancel:new t({onClick:function(){e.callback(!1),c.destroy()}})}});c.getContent().addClassName("bookmark_removeFromFavPopUp"),c.addEventListener("close",function(t){e.callback("none"),c.destroy()})}})}),define("DS/FolderEditor/utils/FolderEditorManageSecurityContextCustomization",["UWA/Core","UWA/Class","DS/FolderEditorOpenness/FolderEditorOpenness","DS/PADUtils/PADSettingsMgt","DS/Logger/Logger"],function(e,t,o,n,i){"use strict";var r=i.getLogger("DS/FolderEditor/utils/FolderEditorManageSecurityContextCustomization");return t.singleton({name:"FolderEditorManageSecurityContextCustomization",init:function(e){this._parent(e),this._isSecurityContextComputedByOpening=o.useComputedSecurityContext()},adaptSecurityContextToCurrentFolder:function(e){if(e&&this._isSecurityContextComputedByOpening){var t,i=[],s=widget.getPreference("pad_security_ctx");if(s){var a=s.options;Array.isArray(a)?a.forEach(function(e){e.value&&i.push(e.value)}):r.warn("The widget has no options for pad_security_ctx preference")}else r.warn("The widget has no pad_security_ctx preference");if(i.length>0)try{t=o.computeSecurityContext(e,i)}catch(e){r.warn("FolderEditorOpenness throws exception",e)}t&&-1!==i.indexOf(t)?(widget.setValue("pad_security_ctx",t),n.setSetting("pad_security_ctx",t)):r.warn('SecurityContext "'+t+'" returned by FolderEditorOpenness is not valid')}}})}),define("DS/FolderEditor/views/additionalColumns/FavoriteTitleColumn",["UWA/Core","UWA/Class","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,t,o){"use strict";return t.singleton({init:function(e){this._parent(e)},isAdditionalColumnsAvailable:function(e){var t={text:o.column_FavoriteTitle,icon:{iconName:"favorite-on",fontIconFamily:WUXManagedFontIcons.Font3DS},dataIndex:"favoriteTitle",typeRepresentation:"string",editableFlag:!0,alignment:"left",sortableFlag:!0,visibleFlag:!1,editionPolicy:"DelayedEditionOnClick",customisation:{dataIndex:"favoriteTitle",exportable:{lock:!0,value:!1},layout:{removable:!1}}};this._columnDataIndex=["favoriteTitle"],this._columnDef={favoriteTitle:t},e(!0)},getName:function(){return"favoriteTitle"},getManagedColumnNames:function(){return this._columnDataIndex},toBeUpdated:function(e){return void 0===e.favoriteTitle},updateAttributes:function(e,t){},getAdditionalColumnsUXDGV:function(t){var o=this._columnDataIndex[0],n=e.clone(this._columnDef[o]),i=!1;t.every((r,s)=>((i=r.dataIndex===o)&&(t[s]=e.extend(t[s],n,!0)),!i)),i||t.push(n)}})}),define("DS/FolderEditor/commands/ActionBar_AddFileCmd",["UWA/Core","UWA/Controls/Input","DS/ApplicationFrame/Command"],function(e,t,o){"use strict";return o.extend({labelTopBar:e.i18n("Add New Document"),isInsert:!0,input_file:null,datas:{},init:function(e){this._parent(e,{isAsynchronous:!1,isEnabled:!0})},beginExecute:function(){},execute:function(){require("DS/FolderEditor/commands/FolderCommands").uploadFileCmd()},endExecute:function(){},clearInput:function(){this.input_file&&(this.input_file.destroy(),this.input_file=null)}})}),define("DS/FolderEditor/popup/BookmarkConfirmationWthCheckBx",["UWA/Class","DS/Controls/Toggle","DS/Controls/LineEditor","DS/Controls/ButtonGroup","DS/Windows/Panel","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,t,o,n,i,r,s,a,l){return e.singleton({name:"Bookmark Confirmation With CheckBox",confirmModal:null,carryOverAttrs:!0,addPrefixSelection:!1,addSuffixSelection:!1,RadioShortcutSelection:!1,prefixValue:"",suffixValue:"",launch:function(e,i,r,d){var c=e.title,u=this;u.carryOverAttrs=!0,u.addPrefixSelection=!1,u.addSuffixSelection=!1,u.RadioShortcutSelection=!1,u.prefixValue="",u.suffixValue="";var p=UWA.createElement("div",{class:"selectPasteORShortcut"}),g=new n({type:"radio"}),f=new t({type:"radio",label:l.Paste_as_Duplicate,value:0,checkFlag:!0});g.addChild(f);var h=new t({type:"radio",label:l.Paste_as_Shortcut,value:1});g.addChild(h),h.addEventListener("buttonclick",function(e){S.disabled=!0,v.disabled=!0,_.disabled=!0,u.RadioShortcutSelection=!0,b.disabled=!0,y.disabled=!0}),f.addEventListener("buttonclick",function(e){S.disabled=!1,v.disabled=!1,_.disabled=!1,u.RadioShortcutSelection=!1,b.disabled=!1,y.disabled=!1});var m=UWA.createElement("div",{class:"attrsLostMsgBody"});e.infoTitle&&(m=UWA.createElement("div",{class:"attrsLostMsgBody",styles:{position:"absolute","min-width":"160px"}}));var v=new t({type:"checkbox",label:l.AddPrefix,value:1,checkFlag:!1}),_=new t({type:"checkbox",label:l.AddSuffix,value:2,checkFlag:!1}),S=new t({type:"checkbox",label:e.mainDivContent.checkBoxParams.label,value:0,checkFlag:!0});S.addEventListener("change",function(e){u.carryOverAttrs=!u.carryOverAttrs,D&&(u.carryOverAttrs?D.setStyle("display","none"):D.setStyle("display",""))}),v.addEventListener("change",function(e){console.log("Add Prefix Checkbox Clicked"),u.addPrefixSelection=!u.addPrefixSelection,C&&(u.addPrefixSelection?C.setStyle("display",""):C.setStyle("display","none"))}),_.addEventListener("change",function(e){console.log("Add Suffux Checkbox Clicked"),u.addSuffixSelection=!u.addSuffixSelection,F&&(u.addSuffixSelection?F.setStyle("display",""):F.setStyle("display","none"))}),e.mainDivContent.divHeaderShow&&UWA.createElement("p",{text:e.mainDivContent.divHeaderShow}).inject(m),S.getContent().setStyle("margin-left",20),v.getContent().setStyle("margin-left",20),_.getContent().setStyle("margin-left",20);var C=UWA.createElement("div",{class:"addPrefixDiv"}).inject(m);C.setStyle("display","none");var b=new o({displayClearFieldButtonFlag:!0,maxLength:20});b.inject(C);var F=UWA.createElement("div",{class:"addSuffixDiv"}).inject(m);F.setStyle("display","none");var y=new o({displayClearFieldButtonFlag:!0,maxLength:20});if(y.inject(F),b.getContent().addEventListener("change",function(e){u.prefixValue=e.dsModel.value.trimStart()}),y.getContent().addEventListener("change",function(e){u.suffixValue=e.dsModel.value.trimEnd()}),C.setStyle("margin-left",40),F.setStyle("margin-left",40),f.inject(m),v.inject(m),C.inject(m),_.inject(m),F.inject(m),S.inject(m),h.inject(m),e.mainDivContent.divFooterHide){UWA.createElement("br").inject(m);var D=UWA.createElement("div",{class:"attrsLostMsg"}).inject(m);D.setStyle("display","none"),UWA.createElement("p",{text:e.mainDivContent.divFooterHide,styles:{"font-weight":"bold"}}).inject(D)}e.infoTitle&&UWA.createElement("span",{id:"InfoPanel",title:e.infoTitle,class:"fonticon fonticon-info",styles:{top:"55%",position:"fixed",right:"1%"}}).inject(m),m.inject(p);var E=p,w=widget.immersiveFrame,A=new s({className:"command_dialog move",immersiveFrame:w,title:c,content:E,width:370,height:260,resizableFlag:!0,modalFlag:!0,events:{onClose:function(e){r&&r(e),this.destroy()}},buttons:{Ok:new a({label:l.confirmation_ok_Paste,onClick:function(e){i&&i(e),A.destroy()}}),Cancel:new a({label:e.cancelLabel||l.confirmation_cancel,onClick:function(e){d&&d(e),A.destroy()}})}})},getChkBoxCheckedFlag:function(){return this.carryOverAttrs},getRadioBoxCheckedFlag:function(){return this.RadioShortcutSelection},getSuffixValue:function(){return this.suffixValue},getPrefixValue:function(){return this.prefixValue}})}),define("DS/FolderEditor/commands/FolderActionBarCmds",["DS/ApplicationFrame/Command","DS/ApplicationFrame/CommandsManager","DS/PADUtils/PADContext","DS/PADUtils/PADUtilsServices"],function(e,t,o,n){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(){var e=this,i=o.get(),r=i.options.model?i.options.model:i.getPADTreeDocument();switch(this.options.ID){case"treelistview":case"graphview":case"tileview":case"thumbnailview":case"datagridview":i.toggleView(e.options.ID);break;case"Print":case"PrintOptions":case"ExportCSV":case"ExportCSVOptions":if("Print"===e.options.ID&&n.printWindowOpen())return;e.disable(),require(["DS/FolderEditor/commands/tools/_xBookExport"],function(t){t.execute({command_id:e.options.ID,cmd:e,xnav_app:i,model:r})});break;case"ColumnVisibility":t.getCommandCheckHeader("ActionBar_FindInCtxCmd").setState(!1,!1),require(["DS/FolderEditor/commands/tools/ColumnCustomization"],function(t){var o=i.options.views?i.options.views.datagridview:void 0;t.execute({command_id:e.options.ID,cmd:e,xnav_app:i,dgv:o})})}}})}),define("DS/FolderEditor/Folder_Clipboard",["UWA/Class"],function(e){"use strict";return e.singleton({name:"folder_clipboard",_currentFolder:null,_currentSelectedNodes:null,_Mode:null,_IsEmpty:!0,_IsExternalDrop:!0,init:function(e){this._parent(e)},addInFolderClipboard:function(e,t,o){if(!UWA.is(t))throw new Error("No folderNode specified");if(!UWA.is(e))throw new Error("No selected nodes specified");o=o.toUpperCase(),this._Mode=o,this._IsEmpty=!1,this._currentFolder=t,this._currentSelectedNodes=UWA.extend([],e)},removeDeletedNodeFromClipboard:function(e){if(!this._IsEmpty)return this._currentSelectedNodes=this._currentSelectedNodes.filter(function(t){return!e.includes(t.getID())})},IsEmpty:function(){return this._IsEmpty},ClearClipboard:function(){this._IsEmpty=!0},getTreeNode:function(){return this._currentFolder},getSelectedNodes:function(){return this._currentSelectedNodes},getMode:function(){return this._Mode},SetAsExternalDrop:function(e){this._IsExternalDrop=e},IsExternalDrop:function(){return this._IsExternalDrop}})}),define("DS/FolderEditor/views/additionalColumns/ThumbnailColumn",["UWA/Class","DS/FolderEditor/service/FolderEditorWebService"],function(e,t){"use strict";var o=function(){return"thumbnail"};return e.singleton({init:function(e){this.allViewsSupported=!0,this._parent(e)},isAdditionalColumnsAvailable:function(e){e(!0)},getName:o,getManagedColumnNames:()=>["thumbnail","isThumbnailSet"],toBeUpdated:function(e,t){return!e.isThumbnailSet&&"3DSpace"===t.getAttributeValue("serviceId")},updateAttributes:function(e,o){t.loadThumbnails({ids:e.pids,onComplete:e=>{if(e){var t=e.results,n={};t?(t.forEach(function(e){var t=e.attributes,o=null,i=null,r=0;t.every(function(e){return"preview_url"===e.name?(i=e.value,r++):"resourceid"===e.name&&(o=e.value,r++),r<2}),n[o]={isThumbnailSet:!0},o&&i&&(n[o]={_root:{}},i&&(n[o].thumbnail="url("+i+")",n[o].isThumbnailSet=!0,n[o]._root.thumbnail=i))}),o({pids:n})):o({})}else o({})},onFailure:function(){o({}),console.log("Failure during thumbnail retrieval")}})}})}),define("DS/FolderEditor/utils/FolderCommunication",["DS/PlatformAPI/PlatformAPI","UWA/Utils/InterCom","DS/IPClassifyUtil/OpenWithMenuBuilder"],function(e,t,o){"use strict";let n=null;function i(){return UWA.is(widget)&&widget.id?"padcompassSocket_"+widget.id:"padcompassSocket"}function r(){return null===n&&(n=new t.Socket(i())).subscribeServer("com.ds.compass",window.parent),n}return{publish:function(t,o,n){e.publish(t,o),!1!==n&&e.publish("webinwin:web:notification",JSON.stringify({event:t,content:o}))},subscribe:function(t,o,n){var i=window,r=function(){if(i===top||i.parent)return o.apply(this,arguments);throw new Exception("widget has been destroyed")};e.subscribe(t,r),!1!==n&&e.subscribe("webinwin:win:notification",function(e){"string"==typeof e&&(e=JSON.parse(e)),e&&e.event===t&&r(e.content)})},setObject_on_compass:async function(e){if(0===e.nodes_2_open.length)r().dispatchEvent("onResetX3DContent",{},i());else{let t=await o.build3DXContent(e.nodes_2_open);0===t.data.items.length?r().dispatchEvent("onResetX3DContent",{},i()):r().dispatchEvent("onSetX3DContent",t,i())}},open_app:function(e,t){r().addListener("launchApp",function(e){UWA.is(t,"function")&&t(e)}),r().dispatchEvent("onLaunchApp",e,i())}}}),define("DS/FolderEditor/commands/ActionBar_RemoveContentCmd",["UWA/Core","DS/ApplicationFrame/Command"],function(e,t){"use strict";return t.extend({labelTopBar:e.i18n("Remove Content"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1}),require(["DS/FolderEditor/commands/FolderCommands"],function(e){})},beginExecute:function(){},execute:function(){require("DS/FolderEditor/commands/FolderCommands").RemoveContentCmd()},endExecute:function(){}})}),define("DS/FolderEditor/service/FolderTypeService",["UWA/Controls/Abstract","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,t){return e.singleton({TYPE_ROOT_FOLDER_1:"Workspace",TYPE_ROOT_FOLDER_2:"RootFolder",TYPE_FOLDER_1:"Workspace Vault",TYPE_FOLDER_2:"Folder",TYPE_FOLDER_3:"Workspace Folder",TYPE_PERSONAL_FOLDER_1:"Personal Workspace",TYPE_FOLDERS_SECTION:"FolderSection_AllFolders",TYPE_FAVORITES_SECTION:"FolderSection_favorite",init:function(){},getNlsSection:function(e){let o="-";switch(e){case this.TYPE_FOLDERS_SECTION:o=t.name_Section_AllFolders;break;case this.TYPE_FAVORITES_SECTION:o=t.name_Section_FavoriteFolders;break;case this.TYPE_PERSONAL_FOLDER_1:o=t.name_Section_Personal}return o},isRootFolder:function(e){return e===this.TYPE_ROOT_FOLDER_1||e===this.TYPE_ROOT_FOLDER_2},isFolder:function(e){return e===this.TYPE_FOLDER_1||e===this.TYPE_FOLDER_2||e===this.TYPE_FOLDER_3},isExternalObject:function(e){let t="string"==typeof e;return(t?e:e.getID()).startsWith("cid:")||!t&&(!!e.getAttributeValue("links")||!!e.getAttributeValue("serviceId")&&"3DSpace"!==e.getAttributeValue("serviceId"))},isPersonalFolder:function(e){return e===this.TYPE_PERSONAL_FOLDER_1},isBookmark:function(e){var t=e.options?e.options.type:"";return this.inFamilyFolder(t)},inFamilyFolder:function(e){return this.isRootFolder(e)||this.isFolder(e)||this.isPersonalFolder(e)},isSection:function(e){return e===this.TYPE_FOLDERS_SECTION||e===this.TYPE_FAVORITES_SECTION},isAllBookmarksSection:function(e){return e===this.TYPE_FOLDERS_SECTION},isFavoriteSection:function(e){return e===this.TYPE_FAVORITES_SECTION}})}),define("DS/FolderEditor/views/FolderRevisionReportPanel",["UWA/Core","UWA/Class","UWA/Class/Options","DS/Controls/Tab","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,t,o,n,i){"use strict";var r=t.extend(o,{name:"GenericReportPanel",_logger:null,_panel:null,options:{},init:function(e){this._parent(e);var t=this;require(["DS/Logger/Logger"],function(o){t._logger=o.getLogger(r),t.setOptions(e),t._createPanel(e)})},_fillTab:function(t,o){for(var n="<ul>",i=0,r=t.entries.length;i<r;i++)n+="<li>"+t.entries[i]+"</li>";n+="</ul>";var s=new e.Element("div",{html:n,class:"tab-content"}),a=new e.Element("div");return a.style.padding="2px",a.appendChild(s),{label:t.label+" ("+t.entries.length+")",isSelected:0===o,content:a,index:o,icon:t.icon}},_createTab:function(e,t){var o,n=0;e.information.length>0&&(o=this._fillTab({label:i.information,entries:e.information,icon:{iconName:"info",fontIconFamily:WUXManagedFontIcons.Font3DS}},n),e.tab.add(o),n++),e.success.length>0&&(o=this._fillTab({label:i.success,entries:e.success,icon:{iconName:"check",fontIconFamily:WUXManagedFontIcons.Font3DS}},n),e.tab.add(o),n++),e.warning.length>0&&(o=this._fillTab({label:i.warning,entries:e.warning,icon:{iconName:"alert",fontIconFamily:WUXManagedFontIcons.Font3DS}},n),e.tab.add(o)),e.tab.inject(t)},_createPanel:function(t){var o=this;require(["DS/Windows/Panel"],function(i){var r=new e.Element("div",{styles:{"vertical-align":"top","min-height":"286px",position:"relative"}}),s=new e.Element("div",{class:"wux-control-inline-container"});r.inject(s);var a=new e.Element("div",{class:"wux-control-container"}),l=new n({displayStyle:"strip"});l.reorderFlag=!1,l.pinFlag=!0,l.showComboBoxFlag=!1,l.editableFlag=!1,l.multiSelFlag=!0,l.centeredFlag=!1,l.touchMode=!0;var d={tab:l};void 0!==t.success&&null!==t.success&&Array.isArray(t.success)&&(d.success=t.success),void 0!==t.warning&&null!==t.warning&&Array.isArray(t.warning)&&(d.warning=t.warning),void 0!==t.information&&null!==t.information&&Array.isArray(t.information)&&(d.information=t.information),o._createTab(d,a),o._panel=new i({title:t.title,content:a,position:{my:"center",at:"center"},width:600,allowedDockAreas:0,immersiveFrame:widget.immersiveFrame,resizableFlag:!0,collapsibleFlag:!1,minWidth:600,minHeight:85}),(d.success.length>15||d.warning.length>15)&&(o._panel.height=400),o._panel.elements.container.classList.add("BookmarkReportPanel")})}});return r}),define("DS/FolderEditor/commands/ActionBar_RelationIPExplorer",["DS/ApplicationFrame/Command"],function(e){"use strict";return e.extend({labelTopBar:UWA.i18n("Where used"),isInsert:!0,datas:{},init:function(e){e.isEnabled=!1,this._parent(e,{mode:"exclusive",isAsynchronous:!1}),require(["DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,t){})},beginExecute:function(){},execute:function(){require(["DS/FolderEditor/utils/FolderCommunication"],function(e){e.open_app({appId:"ENORIPE_AP"},function(e){if("no_app"===e.response){var t=require("DS/IPClassifyUtil/IPClassifyAlert"),o=require("i18n!DS/FolderEditor/assets/nls/FolderEditor");t.displayNotification({...o.msg_error_appWhereUsedNotFound,className:"error"})}})})},endExecute:function(){}})}),define("DS/FolderEditor/utils/BkAlert",["DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,t){return{displayNotFoundBk:(o,n)=>{let i=t.get("msg_error_bookmarkNotFound");e.displayNotification({title:n?t.replace(i.title,{name1:n}):i.title2,subtitle:i.subtitle,message:i.message,id:"notFound"+o,debounce:!0,className:"error"})}}}),define("DS/FolderEditor/utils/WidgetHandlerUtil",["DS/PADUtils/PADSettingsMgt","DS/IPClassifyUtil/IPClassifyUtility","DS/PADServices/utils/GlobalModelEvents"],(e,t,o)=>{let n=new Map([["allow-products-expand",1],["filtered-content",1],["show-sub-folders",1],["activateBIFilter",1],["useIndexAccleration",1],["activateTXO",1],["activateDGV",1],["drag-and-drop",0]]);return{MAX_NUMBER_EXPAND:1e4,ROOTS_PER_PAGE:200,createSingleton:function(e){let t=function e(t){let o=t.prototype?t.prototype:t,n=Object.getOwnPropertyNames(o),i=Object.getPrototypeOf(o),r=null;return r=i?e(i):{},n.forEach(e=>{r[e]=!0}),r}(e);delete t.constructor;let o=null;return e._isInstantiated=function(){return null!==o},e._reset=function(){o=null},e._getInstance=function(){return o||(o=new e),o},Object.keys(t).forEach(t=>{"function"==typeof e.prototype[t]&&(e[t]=function(){return e._getInstance(),o[t].apply(o,arguments)})}),e},setTreeTaggerPreference:function(e,o){o=JSON.stringify(o),o=t.jsonZip(o),widget.setValue(e,o)},getTreeTaggerPreference:function(e){return function(e){if(e)try{e=t.jsonUnzip(e),e=JSON.parse(e)}catch(t){e={}}else e={};return e}(window.widget?widget.getValue(e):void 0)},isTreeTaggerActive:function(){return!0===e.getSetting("activateTreeFilter")},refreshWidgetContent:function(){var e={change:widget.changeInPreference,isPreferenceChangeCauseOfRefresh:widget.refreshDuetoChangeInPreference},t=null;if(e.isPreferenceChangeCauseOfRefresh&&Object.keys(e.change).length>0)for(var i in e.change){if(!n.has(i)){t="allRefresh";break}1!==n.get(i)||(t="contentRefresh")}e.isPreferenceChangeCauseOfRefresh&&!t||(o.publish({event:"refresh_content"}),"contentRefresh"!==t&&o.publish({event:"refresh_tree"}))}}}),define("DS/FolderEditor/views/ViewLoader",["UWA/Class","UWA/Promise"],function(e,t){"use strict";var o={graphview:"graphview",tileview:"tileview",thumbnailview:"thumbnailview",datagridview:"datagridview"};Object.freeze(o);var n=["onDragOverGraph","onDropBlankGraph","onDragLeaveGraph"],i=["onDragEnterBlank","onDragOverBlank","onDragEndBlank","onDragLeaveBlank","onDropBlank","onDragStartCell","onDragEnterCell","onDragOverCell","onDragEndCell","onDragLeaveCell","onDropCell","onDragEnterColumnHeader","onDragOverColumnHeader","onDragEndColumnHeader","onDragLeaveColumnHeader","onDropColumnHeader","onDragStartColumnHeader"],r=["onDragEnterBlank","onDragOverBlank","onDragEndBlank","onDragLeaveBlank","onDropBlank","onDragStartCell","onDragEnterCell","onDragOverCell","onDragEndCell","onDragLeaveCell","onDropCell","onDragEnterColumnHeader","onDragOverColumnHeader","onDragEndColumnHeader","onDragLeaveColumnHeader","onDropColumnHeader","onDragStartColumnHeader"],s=["onDragEnterBlank","onDragOverBlank","onDragEndBlank","onDragLeaveBlank","onDropBlank","onDragStartCell","onDragEnterCell","onDragOverCell","onDragEndCell","onDragLeaveCell","onDropCell","onDragEnterColumnHeader","onDragOverColumnHeader","onDragEndColumnHeader","onDragLeaveColumnHeader","onDropColumnHeader","onDragStartColumnHeader"];return e.extend({init:function(e){this.options=e,this.viewPromises={}},loadView:function(e,o){this.viewPromises[e]||(this.viewPromises[e]=new t(t=>{this.buildOptions(e).then(o=>{this.requireView(e,o,t)})}),this.viewPromises[e].catch(()=>{console.error("error during loading of the view"),this.viewPromises[e]=null})),this.viewPromises[e].then(o)},requireView:function(e,t,n){var i=this,r=this.options.amd[e],s=function(){i.postLoad(e),n&&n()};require([r],function(n){var r=i.options.component;r.options.views[e]=new n(t),e===o.datagridview?r.options.views[e].initialize().then(function(){s()}):s()})},postLoad:function(e){var t=this.options.component;switch(t.options.views[e].isActiveView=t.options.active_view===e,e){case o.graphview:var n=!1;t.options.views.graphview.isActiveView&&(n=!0,t.options.views.graphview.setModel(t.options.model)),t.setDnD_onGraph(),t.options.isReady.graphview=!0,n&&t.options.views.graphview.reframeAll();break;case o.thumbnailview:t.options.views.thumbnailview.isActiveView&&t.options.views.thumbnailview.setModel(t.options.model),t.options.isReady.thumbnailview=!0;break;case o.datagridview:t.options.views.datagridview.isActiveView&&t.options.views.datagridview.setModel(t.options.model),t.options.isReady.datagridview=!0;break;case o.tileview:t.options.views.tileview.isActiveView&&t.options.views.tileview.setModel(t.options.model),t.options.isReady.tileview=!0}t.options.model.applyActiveView(e)},buildOptions:function(e){switch(e){case o.graphview:return this._buildGraphViewOptions();case o.tileview:return this._buildTileViewOptions();case o.thumbnailview:return this._buildThumbnailViewOptions();case o.datagridview:return this._builddatagridViewOptions();default:throw new Error("Invalid View Trying to load")}},mapCallbacks:function(e,t){var o=t,n={};return e.forEach(function(e){UWA.is(o.options.views_cb[e],"function")?n[e]=o.options.views_cb[e]:UWA.is(o[e],"function")&&(n[e]=o[e].bind(o))}),n},_buildGraphViewOptions:function(){var e=this;return new t(function(t,o){var i=e.options.component,r={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo,multiselection:e.options.multiselection,context:i};r.active_view=UWA.clone(i.options.active_view),r.isActiveView="graphview"===r.active_view;var s=e.mapCallbacks(n,i);r=UWA.extend(r,s,!0),UWA.is(i.getOnContextualEvent)&&(r.onContextualEvent=i.getOnContextualEvent()),t(r)})},_buildTileViewOptions:function(){var e=this;return new t(function(t,o){var n=e.options.component,r={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo,multiselection:e.options.multiselection,context:n};r.active_view=UWA.clone(n.options.active_view),r.isActiveView="tileview"===r.active_view;var s=e.mapCallbacks(i,n);r=UWA.extend(r,s,!0),UWA.is(n.getOnContextualEvent)&&(r.onContextualEvent=n.getOnContextualEvent()),t(r)})},_buildThumbnailViewOptions:function(){var e=this;return new t(function(t,o){var n=e.options.component,i={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo,multiselection:e.options.multiselection,context:n};i.active_view=UWA.clone(n.options.active_view),i.isActiveView="thumbnailview"===i.active_view;var s=e.mapCallbacks(r,n);i=UWA.extend(i,s,!0),UWA.is(n.getOnContextualEvent)&&(i.onContextualEvent=n.getOnContextualEvent()),t(i)})},_builddatagridViewOptions:function(){var e=this;return new t(function(t,o){var n=e.options.component,i={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo,multiselection:e.options.multiselection,context:n};i.active_view=UWA.clone(n.options.active_view),i.isActiveView="datagridview"===i.active_view,i.view_customization=n.options.layout.view_customization,i.callbacks=e.mapCallbacks(s,n),n.options.additionalColumnsModules&&(i.additionalColumnsModules=n.options.additionalColumnsModules),t(i)})}})}),define("DS/FolderEditor/commands/tools/_xBookExport",["DS/FolderEditor/utils/FolderLoaderGlobal","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,t){"use strict";var o=null,n=!1;async function i(i,r,s){e.updateComponentPourcent("global",{exportMask:t.exportMask},"0%");for(let a=0;a<s;a+=100)if(!n){const n=a,l=Math.min(a+100,s),d=a/s*100;e.updateComponentPourcent("global",{exportMask:t.exportMask},`${d}%`),o=r.xnav_app.getPADTreeListView().options.context.updateColumns({collectionView:i,startNodeIndex:n,endNodeIndex:l,context:"OnExport"}),await o}}return{execute:function(t){require(["DS/FolderEditor/commands/tools/xBookExporter","DS/PADServices/utils/DictionaryAccess","DS/WidgetServices/WidgetServices","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(r,s,a,l){switch(t.command_id){case"Print":var d=t.xnav_app.getPADTreeListView().getManager(),c=a.isWebInWinEnvironment()||!0===widget.getValue("noCompass");d.openPrintableViewWindow(c);break;case"ExportCSV":d=t.xnav_app.getPADTreeListView().getManager();var u=s.updateNLSforexport(t.xnav_app.getPADTreeDocument());n=!1,e.addComponentsToLoad("global",{exportMask:l.exportMask},{withCancel:!0,cancelObject:{cancel:()=>{o.cancel(),n=!0,e.removeComponentToLoad("global","exportMask")}}});let p=i(d,t,d.model.length);Promise.all([u,p]).then(()=>{r.generateCsv({context:t.xnav_app,csv_base_file_name:l.csv_base_file_name})}).catch(t=>{console.error(t),e.removeComponentToLoad("global","exportMask")}).finally(()=>{e.updateComponentPourcent("global",{exportMask:l.exportMask},"100%"),e.removeComponentToLoad("global","exportMask")})}setTimeout(function(){t.cmd&&t.cmd.enable()},500)})}}}),define("DS/FolderEditor/commands/tools/xBookExporter",["i18n!DS/PADUtils/assets/nls/PADUtils.json","i18n!DS/FolderEditor/assets/nls/FolderEditor","UWA/Class","UWA/Class/Options","DS/PADServices/utils/AttributesMgtV2","DS/PADUtils/PADUtilsServices","DS/WidgetServices/WidgetServices","DS/PADUtils/Utility","DS/FolderEditor/utils/FolderLoaderGlobal"],function(e,t,o,n,i,r,s,a,l){"use strict";var d='<table style="border:1px solid black; border-collapse:collapse;">',c="</table><br/>",u='<th style="border:1px solid black; background-color:#A7C942; text-align:left; color:#FFFFFF; font-size:.8em; padding-top:5px; paddingbottom:4px;word-break:break-word;display:table-cell;">',p="</th>",g="<tr>",f="</tr>",h="<td>",m="</td>";function v(e,t,o){for(var n=e.length,i=0;i<n;i++){o(t,e[i],i)}}function _(e,t){var o=e.options.grid[t];return a.convertDateTime(o)}function S(e){return""+e}function C(e,t){if("tree"===e)return t.options.label;var o=null;if("function"==typeof E.customizedColumnRenderers[e])o=E.customizedColumnRenderers[e](t);else switch(typeof t.options.grid[e]){case"string":o=t.options.grid[e];break;case"number":o=S(t.options.grid[e]);break;case"boolean":o=(!0===t.options.grid[e])+"";break;default:o=""}return o}function b(e,t,o){var n=[];n.push(S(o.getDepth())),n.push(C("tree",o)),t.forEach(function(e){var t=(e.customisation?e.customisation:e.xnav_options).kind;if(t)switch(t){case"date":n.push(_(o,e.dataIndex));break;default:n.push(C(e.dataIndex,o))}else n.push(C(e.dataIndex,o))}),e.rows.push(n)}function F(t,o){o||(o=i.getAvailableColumns());var n={};o.forEach(function(e){n[e]=!0});var r={kept:[],labels:[],keys:["tree"]},s=null;return r.labels.push(e.export_level),r.labels.push(null),t.forEach(function(t){var o=t.customisation?t.customisation:t.xnav_options,i=!(!o||!o.exportable)&&o.exportable.value,a=void 0!==i&&!i;"tree"===t.dataIndex?s=t.text:!n[t.dataIndex]||a||E.options.columns_to_remove[t.dataIndex]||t.customisation.exportable&&!0!==t.customisation.exportable.value||(r.labels.push(function(t){var o=t.text;if(""===o||null==o){var n="treelistview_customization_"+t.dataIndex;o=UWA.is(e[n])?e[n]:t.dataIndex}return o}(t)),r.keys.push(t.dataIndex),r.kept.push(t))}),r.labels[1]=s||"unknown",r}function y(){this._str=""}function D(e){var t=e||{};this._debug=!0===t.debug,this._builder=new y}y.prototype={CRLF:"\r\n",append:function(e){this._str+=e+""},toString:function(){return this._str}},D.prototype={render:function(e){var t=this;return v(e.tables,e.columns,function(e,o){t._builder.append(d),t._builder.append("<thead><tr>"),v(e,null,function(e,o){t._builder.append(u),t._builder.append(o),t._builder.append(p)}),t._builder.append("</tr></thead>"),t._builder.append("<tbody>"),v(o.rows,null,function(e,o){t._builder.append(g),v(o,null,function(e,o){t._builder.append(h),t._builder.append(o),t._builder.append(m)}),t._builder.append(f)}),t._builder.append("</tbody>"),t._builder.append(c)}),this._builder.toString()}};var E={customizedColumnRenderers:{"ds6w:created":function(e){return _(e,"ds6w:created")},"ds6w:modified":function(e){return _(e,"ds6w:modified")},"ds6w:reserved":function(e){var o=e.options.grid["ds6w:reserved"];return o&&"true"===o.toLowerCase()?t.tooltip_reserved:t.tooltip_unreserved}},options:{columns_to_remove:{tree:!0},csv_base_file_name:e.csv_base_file_name}},w={printHtml:function(e){var t,o,n,i,s=(t=e.context,o=e.columns,n={columns:null,tables:[]},i=F(t.getPADTreeListView().getManager().layout.columns,o),n.columns=i.labels,t.options.model.getRoots().forEach(function(e){var t=null;e.isVisible()&&(t={rows:[]},n.tables.push(t),b(t,i.kept,e),e.processDescendants({processNode:function(){this.isVisible()&&b(t,i.kept,this)}}))}),n),a=(new D).render(s);r.printhtml(a)},generateCsv:function(e){e.csv_base_file_name&&(E.options.csv_base_file_name=e.csv_base_file_name);var t=e.context.getPADTreeListView().getManager(),o=e.context.getPADTreeListView().getManager().layout.columns;e.columns;e.columns||F(o).keys;l.updateComponentPourcent("global","75%");var n=t.getAsCSV({addLevelInformation:!0,forceQuotes:!0});r.downloadfile(n,E.options.csv_base_file_name+(new Date).toString().split(" ").splice(1,4).join(" ")+".csv","text/csv")}};return s.isReplayedODT()&&(w.getExportableColumns=F),o.singleton(w)}),define("DS/FolderEditor/utils/FolderEditorcontrol",["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/FolderEditorOpenness/FolderEditorOpenness","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/IPClassifyUXUtil/PlatformCredSelector","DS/FolderEditor/utils/WidgetHandlerUtil","DS/FolderEditor/utils/FolderLoaderGlobal"],function(e,t,o,n,i,r,s){class a{constructor(){this._Content=null,this._TreeCont=null,this._IdCardCont=null,this._isDebugMode=!1,this._actionBar=null,this._findInCtx=null,this._onWidgetRefresh=null,this.checkRolesAvailability()}}let l={getContent:function(){return this._Content},getTreeCont:function(){return this._TreeCont},getIdCardCont:function(){return this._IdCardCont},getTrashCont:function(){return this._TrashCont},getActionBar:function(){return this._actionBar},getFindInCtx:function(){return this._findInCtx},getWidgetRefresh:function(){return this._onWidgetRefresh},setContent:function(e){this._Content=e},setTreeCont:function(e){this._TreeCont=e},setIdCardCont:function(e){this._IdCardCont=e},setTrashCont:function(e){this._TrashCont=e},setActionBar:function(e){this._actionBar=e},setFindInCtx:function(e){this._findInCtx=e},setWidgetRefresh:function(e){this._onWidgetRefresh=e},getActiveFolder:function(){return{origin:widget.id,id:void 0!==this._activeFolderId?this._activeFolderId:null,label:this._activeFolderLabel,sc:this._activeFolderSc,disabledId:this._activeFolderDisabledId}},setActiveFolder:function(e,t,o,n){this._activeFolderId=e,this._activeFolderLabel=t,this._activeFolderSc=o,this._activeFolderDisabledId=n},isDebugMode:function(){return this._isDebugMode},setDebugMode:function(e){this._isDebugMode=e},isCustomizedEnv:function(){return void 0===this._isCustomizedEnv&&(this._isCustomizedEnv=t.useComputedSecurityContext(),this._isCustomizedEnv=!1),this._isCustomizedEnv},isActiveBookmarkActivated:function(){return void 0===this._isActiveBookmarkActivated&&(this._isActiveBookmarkActivated=t.isActiveBookmarkActivated()),this._isActiveBookmarkActivated},isImportCSVActivated:function(){return void 0===this._isImportCSVActivated&&(this._isImportCSVActivated=t.isImportCSVActivated()),this._isImportCSVActivated},checkRolesAvailability:function(t){var o=this;void 0===o._isPAUroleAvailable||void 0===o._isPARroleAvailable||void 0===o._isCSVroleAvailable?e.getGrantedRoles(function(e){o._isPAUroleAvailable=!1,o._isPARroleAvailable=!1,o._isCSVroleAvailable=!1;for(var n=0;n<e.length;n++){var i=e[n]?e[n].id:"";"CSV"===i?o._isCSVroleAvailable=!0:"PAU"===i||"CDR"===i||"EXL"===i||"InternalDS"===i?(o._isPAUroleAvailable=!0,o._isCSVroleAvailable=!0):"PAR"===i&&(o._isPARroleAvailable=!0,o._isCSVroleAvailable=!0)}t&&t(o._isPAUroleAvailable,o._isPARroleAvailable,o._isCSVroleAvailable)}):t&&t(o._isPAUroleAvailable,o._isPARroleAvailable,o._isCSVroleAvailable)},checkSecurityCTXandTenantInitialization:function(e,t){var r=this;require(["DS/IPClassifyUXUtil/CredentialsView"],function(s){if("function"==typeof e){function a(){r._isSecurityCTXInitialized&&(!0===t||r._isTenantInitialized)&&e.call()}if(void 0===r._isSecurityCTXInitialized){var l=s.getCredential();r._isSecurityCTXInitialized=!!l||void 0,r._isSecurityCTXInitialized||n.addEventOnce("onPad_security_ctx",function(e){r._isSecurityCTXInitialized=!!e,a()})}if(!0!==t&&void 0===r._isTenantInitialized){var d=o.getPlatformId();let e=!1,t=o.getTenantsPreference();if(e=!t||0==t.length||t.filter(e=>e.value===d).length<=0,e="OnPremise"!==d&&e){r.onTenantSecurityCTXPopup();let t={};t.onRefresh=r.getWidgetRefresh(),i.render(e,t)}r._isTenantInitialized=!!d,r._isTenantInitialized||n.addEventOnce("onPad_tenant",function(e){r._isTenantInitialized=!!e||void 0,a()})}a()}})},onTenantSecurityCTXPopup:function(){s.removeComponentToLoad("global","widget")},getPlaceholder:function(){return new Promise(function(e){require(["DS/FolderEditor/views/FolderPlaceHolder"],function(t){e(new t)})})}};for(let e in l)a.prototype[e]=l[e];return r.createSingleton(a)}),define("DS/FolderEditor/dataProvider/ManipulationUnitColumnsDataProvider",["UWA/Class","DS/FolderEditor/utils/FolderEditorcontrol"],function(e,t){"use strict";return e.singleton({getManipulationUnitColumns:function(){let e=[],o=t.getContent();if(!o)return e;let n=o.getPADTreeListView();return n?n.getManipulationUnitColumns():e},getColumnUnitNls:function(e){let o=t.getContent();if(!o)return null;let n=o.getPADTreeListView();if(!n)return null;let i=n.getColumnsUnitNls()[e];return i?i.convertUnit:i},getManipulationUnitVisibleValues:function(e,o){let n=[],i=t.getContent();if(!i)return n;let r=i.getPADTreeListView();return r?r.getManipulationUnitVisibleValues(e,o):n}})}),define("DS/FolderEditor/commands/tools/ColumnCustomization",["UWA/Core","DS/FolderEditor/utils/FolderEditorcontrol","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor","text!DS/FolderEditor/assets/FolderEditorColumns.json"],function(e,t,o,n,i){"use strict";var r=JSON.parse(i).allowedIndexAttributes,s=null;return{execute:function(){require(["DS/IPClassifyColumnCusto/IPClassifyColumnCusto","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/AttributesMgtV2","DS/FolderEditor/utils/FolderEditorcontrol","DS/PADServices/utils/DictionaryMgt","DS/FolderEditor/utils/FolderEditorUtil"],function(i,a,l,d,c,u){for(var p=a.getModelEvents(),g=[],f=d.getContent().getPADTreeListView(),h=f.options.dgvLayout.getOrderedColumnsIndexes(),m=0;m<h.length;m++){var v=f.options.dgv.getColumnOrGroup(h[m]);"defaultSort"!==v.dataIndex&&(v.attrDBName||v.customisation&&v.customisation.layout&&(v.customisation.layout.removable=!1),g.push(v))}var _=f?f.options.viewMode:parameters.tree.options.viewMode,S=!!f,C=f?f.options.dgvLayout.rowsHeader:void 0;f&&(f.columnOrdering=!0),s=new i({modelEvents:p,viewMode:_,appColumns:g,manageAttrFromInstance:!1,baseInstanceTypes:[],selectedTypes:l.getSelectedTypes(),selectedExtensions:l.getSelectedExtensions(),withDgv:S,dgvInfo:f,rowHeaderActivated:C,dbOnlyAttributes:!0,classificationAttributes:!0,allowedIndexAttributes:r,defaultAttributes:r,supportedIndexAttrs:["ds6w:docExtension"]});var b=[];b.push(p.subscribe({event:"ENOBook/AttributesCustomization/columnSwitchDone"},function(){s.options.dgvInfo.columnOrdering=!0})),b.push(p.subscribe({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification"},function(i){switch(i.what){case"addRemoveColumns":if(i.removedColumns&&f&&f.removeColumnCB(i.removedColumns),i.addedColumns){var r=e.clone(u.filterDBOnlyAttrs(i.addedColumns)),s=r.filter(function(e){return f.options.dgv.getColumnOrGroup(e.dataIndex)});f&&s.length>0&&f.changeDBAttributeCB(s),r=r.filter(function(e){return!f.options.dgv.getColumnOrGroup(e.dataIndex)}),f&&r.length>0&&f.addColumnCB(r)}break;case"visibilityColumn":f&&f.changeVisibilityCB(i.modifiedColumn,i.visibilityFlag);break;case"moveColumn":f&&f.moveColumnCB(i);break;case"changeTitle":if(f){for(var a=[],d=0;d<i.newTitle.length;d++)i.newTitle.charCodeAt(d)>255&&a.indexOf(i.newTitle[d])<0&&a.push(i.newTitle[d]);0===a.length?f.changeTitleCB(i.modifiedColumn,i.newTitle):o.displayNotification({message:n.replace(n.msg_error_forbiddenChar.message,{badChars:a.join(", ")}),className:"error"})}break;case"pinChange":f.changePinCB(i.modifiedColumn,i.pin);break;case"rowsHeaderModification":f.changeDgvLayout({rowsHeader:i.rowsHeader});break;case"exportColumn":f.changeExportCB(i.modifiedColumn,i.exportFlag);break;case"changeViewMode":f&&f.compactMode(i);var c=t.getTreeCont();c&&c.modeChange(i);break;case"close":i.selectedExtensions&&i.selectedTypes&&l.updateSelectedParams({selectedExtensions:i.selectedExtensions,selectedTypes:i.selectedTypes}),f&&f.saveCustoView(i.applyOnlyToThisApp),b.forEach(function(e){p.unsubscribe(e)});break;case"reset":l.resetSelectedParams(),f.reset(i.parameters),b.forEach(function(e){p.unsubscribe(e)});break;default:console.warn("Unknown column modification kind:"+i.what)}}))})},endExecute:function(){},_getColumnCusto:function(){return s}}}),define("DS/FolderEditor/Folder_CSO",["UWA/Core","UWA/Controls/Abstract","DS/Utilities/Utils","DS/IPClassifyUXUtil/CredentialsView","DS/WidgetServices/WidgetServices","DS/FolderEditor/service/FolderTypeService","DS/IPClassifyUtil/IPClassifyUtility","DS/PADServices/utils/GlobalModelEvents","DS/FolderEditor/utils/WidgetHandlerUtil"],function(e,t,o,n,i,r,s,a,l){"use strict";var d=null;let c=null;function u(){var e=s.jsonUnzip(widget.getValue("folderTreeSelectedNode")||"{}");e=JSON.parse(e);var t=i.getTenantID();return e[t||"OnPremise"]}function p(e){return function(){if(null===d){d={};var e=widget.getValue("X3DContentId");if(e){var t=UWA.is(e,"string")?JSON.parse(e):e;if(t.data&&t.data.items&&t.data.items.length>0){var o=t.data.items[0];if(o){var n=o.objectType;"Workspace"!=n&&"Workspace Vault"!=n&&null!=n||(d=o)}}widget.setValue("X3DContentId","")}}return d}()[e]}function g(e){let t=!0===e.isFavorite||"FolderSection_favorite"===e.id?"FolderSection_favorite":null;return t=t||(!0===e.isPersonal?"FolderSection_personal":"FolderSection_AllFolders")}let f={id:"",label:"",type:"",serviceId:"3DSpace",sourceId:"",links:null,i3dx:"",getID:function(){return this.id},getType:function(){return this.type},getLabel:function(){return this.label},isTreeElementType:function(){return r.inFamilyFolder(this.getType())},getSourceId:function(){if(!this.sourceId&&c){let e=this.getAttributeValue("serviceId");this.sourceId=c[e],this.sourceId=this.sourceId?this.sourceId:e}return this.sourceId},getAttributeValue:function(e){return this[e]}};function h(e){let t=e.id,o={...f,...e};return r.isSection(t)&&(o={...o,id:t,label:r.getNlsSection(t),type:t,isPersonal:!1,isFavorite:!1}),o}function m(e){return h({id:e})}let v=null,_=null;let S=o.debounce(function(){a.publish({event:"updateBMESelection",data:{}})},20);function C(e){a.publish({event:"preOpenBookmark",data:{id:v.getID()}}),a.publish({event:"openBookmark",data:{id:v.getID(),options:e}})}function b(e){D._isInstantiated()?C(e):setTimeout(()=>{C(e)})}let F={};class y{constructor(){v=m("FolderSection_AllFolders"),_="FolderSection_AllFolders",F={};let e=u();if(e){let t=e.split(",");t.length>1&&((v=m(t[t.length-1])).section=r.isSection(t[1])?t[1]:"FolderSection_personal",b())}if(widget&&widget.folderToOpen){let e=self.widget.folderToOpen;this.dispatchBookmarkIdSelection(e)}else this._manageOpenWith(void 0,!0)}clearX3DContentItem(){d&&delete d.contentId}clearX3DItem(){d=null}setServiceMapping(e){c=e}_assignTenantFromX3DContentId(){let e=widget.getValue("x3dPlatformId"),t=!1;var o=this.getX3DTenant();return o&&"OnPremise"!==o&&(t=e!==o,widget.setValue("x3dPlatformId",o)),t}_manageOpenWith(e,t){e&&this.clearX3DItem();var o=this.getX3DBookmarkId();let i=this._assignTenantFromX3DContentId(),r=this.getX3DCredentials();if(e&&!i||r&&r.startsWith("ctx::")&&n.setCredential(r),o){let e=this.getDefaultModelFromId(o);require(["DS/FolderEditor/views/FolderMode"],t=>{t.switchtoAuthoringMode(),this.dispatchBookmarkNodeSelection(e)})}}dispatchBookmarkPropsSelection(e,t){let o=this.getDefaultModelFromProperties(e);this.dispatchBookmarkNodeSelection(o,t)}dispatchBookmarkIdSelection(e,t){let o=this.getDefaultModelFromId(e);this.dispatchBookmarkNodeSelection(o,t)}dispatchBookmarkNodeSelection(e,t){let o=e.section?e.section:g(e);e&&(v.getID()!==e.getID()||v.getID()===e.getID()&&o!==v.section||t&&t.force)&&((v=e).section=void 0!==v.section?v.section:g(v),b(t))}registerTreeDocument(e,t){t.getXSO().onChange(S),F[e]=t}getCurrentBookmarkSection(){return v.section?v.section:_}getCurrentBookmarkId(e){let t=this.getCurrentBookmarkElement(e);return t?t.getID():null}getCurrentBookmarkElement(e){return e&&r.isSection(v.getID())?null:v}updateCurrentBookmarkElement(e){v.getLabel()||e.getID()!==v.getID()||(v=e)}setInfoOnTreeNode(e){for(let t in f){e[t]||(e[t]=f[t])}e.label=e.options.label,e.id=e.id?e.id:e.getID(),Object.defineProperty(e,"source",{get:function(){return"www"===this.getAttributeValue("serviceId")?"www":this.getAttributeValue("serviceId")}}),Object.defineProperty(e,"indexModeParameter",{get:function(){return"3DSpace"!==this.getAttributeValue("serviceId")&&"www"!==this.getAttributeValue("serviceId")}})}getAllSelectedNodes(){let e={};for(var t in F)e[t]=F[t].getSelectedNodes();return e}getSelectedBookmark(){let e=this.getSelectedBookmarks();return e.length>0?e[0]:null}getSelectedBookmarks(){let e=this.getAllSelectedNodes(),t=e.TREE?e.TREE:[];if(0==t.length){let e=this.getCurrentBookmarkElement();e&&e.getLabel()&&(e.options=e.options?e.options:{},t=[e])}return t}getSelectedContent(){let e=this.getAllSelectedNodes();return e.CONTENT?e.CONTENT:[]}getSelectedNodes(){let e=this.getSelectedContent();return 0==e.length&&(e=this.getSelectedBookmarks()),e}}y.prototype.getDefaultModelFromId=m,y.prototype.getDefaultModelFromProperties=h,y.prototype.getBookmarkSection=g,y.prototype.getX3DBookmarkId=p.bind(null,"objectId"),y.prototype.getX3DContentId=p.bind(null,"contentId"),y.prototype.getX3DTenant=p.bind(null,"envId"),y.prototype.getX3DCredentials=p.bind(null,"contextId"),y.prototype.getStoredSelection=u;let D=l.createSingleton(y),E={onChange:function(e){return a.subscribe({event:"updateBMESelection"},e)},onPrepareBookmarkOpening:function(e){return a.subscribe({event:"preOpenBookmark"},e)},onBookmarkOpening:function(e){return a.subscribe({event:"openBookmark"},e)}};for(var w in E)D[w]=E[w];return D}),define("DS/FolderEditor/views/additionalFacets/AttachmentsFacet",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","DS/WidgetServices/WidgetServices","DS/ENOXAttachmentsUX/AttachmentsPane","DS/FolderEditor/Folder_CSO"],function(e,t,o,n,i,r,s){return t.extend(o,n,{init:function(e){this._parent(e),this.buildView(e)},buildView:function(t){this.elements.container=e.createElement("div",{class:"doc_fitting"});var o={parentObject:{parentId:null},connectorOptions:{fetchSecurityContext:function(){return t.appContext.getSecurityContext().replace("ctx::","")},platformUrls:t.appContext.getPlatformUrls()},hideSpecifications:t.hideSpecifications,supportedTypes:t.supportedTypes,readonly:t.readonly,webinwin:i.isWebInWinEnvironment()};this.pane=new r(o),this.pane.inject(this.elements.container)},isTypeSupported:function(e){let t=["VPMReference","Document"];for(let o=0;o<t.length;++o)if(e.indexOf(t[o])>-1)return!0;return!1},updateFacet:function(){var e=this,t=this.getModel();this._currentId=t.get("objectId"),1==s.getSelectedNodes().length&&(t.addEventOnce("onChangeAttributes",function(t){t.get("_DS_ATTR_types")&&t.get("_DS_ATTR_types").valueDB&&e.isTypeSupported(t.get("_DS_ATTR_types").valueDB)&&e.selectionModified()}),(null==this._previousId||t.get("_DS_ATTR_types")&&t.get("_DS_ATTR_types").valueDB&&e.isTypeSupported(t.get("_DS_ATTR_types").valueDB))&&this.selectionModified(),this._previousId=this._currentId)},selectionModified:function(){var e={parentId:this._currentId};this.pane.setParentObject(e)}})}),define("DS/FolderEditor/commands/ActionBar_AddToFavoritesCmd",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/FolderEditor/Folder_CSO","DS/Utilities/Utils","DS/PADServices/utils/GlobalModelEvents","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/service/FolderTypeService"],function(e,t,o,n,i,r,s,a){"use strict";let l=!1;return t.extend({labelTopBar:r.label_ActionBar_AddToFavorites,isInsert:!0,datas:{},init:function(t){this._parent(t,{});var i=this;let d=n.debounce(this._adaptStateToCurrentFolder.bind(this),100);o.onChange(d),this.onStateChange(function(){if(!l)if(i.getState()){if((d=o.getSelectedNodes())&&d[0]){u=(c=d[0]).getID(),p=c.getType(),g=c.getLabel();var t=c.getAttributeValue("mxid");f=c.isPersonal;if(u&&a.inFamilyFolder(p)&&e.is(s.getTreeCont())){var n={id:u,name:g,type:p,isPersonal:f,mxid:t,inherit:"SHARED"===c.getAttributeValue("folderClassification")};s.getTreeCont().addFavorite(n).catch(e=>{o.getCurrentBookmarkId()===u&&(l=!0,i.setState(!1,!1))})}}i.labelTopBar=r.label_ActionBar_RemoveFromFavorites}else{var d;if((d=o.getSelectedNodes())&&d[0]){var c,u=(c=d[0]).getID(),p=c.getType(),g=c.getLabel(),f=c.isPersonal;if(u&&a.inFamilyFolder(p)&&e.is(s.getTreeCont())){var h={id:u,name:g,type:p,isPersonal:f};s.getTreeCont().removeFavorite(h).catch(e=>{o.getCurrentBookmarkId()===u&&(l=!0,i.setState(!0,!1))})}}i.labelTopBar=r.label_ActionBar_AddToFavorites}l=!1}),this._adaptStateToCurrentFolder()},_adaptStateToCurrentFolder:function(){var t=o.getSelectedNodes();if(t&&t[0]&&t[0].getID){var n=t[0],i=n.getID(),r=n.options.label;if(e.is(s.getTreeCont())){var a={id:i,name:r};s.getTreeCont().getFavoritesWithCheck({nodes:[a],noAttributes:!0,silent:!0}).then(e=>{l=!0,this.setState(e.alreadyExist.length>0,!1)})}}}})}),define("DS/FolderEditor/views/additionalFacets/SpecificationsFacet",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","DS/WidgetServices/WidgetServices","DS/ENOXSpecificationsUX/SpecificationsPane","DS/FolderEditor/Folder_CSO"],function(e,t,o,n,i,r,s){return t.extend(o,n,{init:function(e){this._parent(e),this.buildView(e)},buildView:function(t){this.elements.container=e.createElement("div",{class:"doc_fitting"});var o={parentObject:{parentId:null},connectorOptions:{fetchSecurityContext:function(){return t.appContext.getSecurityContext().replace("ctx::","")},platformUrls:t.appContext.getPlatformUrls()},hideAttachments:t.hideAttachments,supportedTypes:t.supportedTypes,readonly:t.readonly,webinwin:i.isWebInWinEnvironment()};this.pane=new r(o),this.pane.inject(this.elements.container)},isTypeSupported:function(e){let t=["VPMReference"];for(let o=0;o<t.length;++o)if(e.indexOf(t[o])>-1)return!0;return!1},updateFacet:function(){var e=this,t=this.getModel();this._currentId=t.get("objectId"),1==s.getSelectedNodes().length&&(t.addEventOnce("onChangeAttributes",function(t){t.get("_DS_ATTR_types")&&t.get("_DS_ATTR_types").valueDB&&e.isTypeSupported(t.get("_DS_ATTR_types").valueDB)&&e.selectionModified()}),(null==this._previousId||t.get("_DS_ATTR_types")&&t.get("_DS_ATTR_types").valueDB&&e.isTypeSupported(t.get("_DS_ATTR_types").valueDB))&&this.selectionModified(),this._previousId=this._currentId)},selectionModified:function(){var e={parentId:this._currentId};this.pane.setParentObject(e)}})}),define("DS/FolderEditor/utils/FolderSearch",["UWA/Class","DS/FolderEditor/utils/FolderEditorcontrol","DS/PADServices/utils/GlobalModelEvents","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/PADServices/utils/AttributesMgtV2","DS/IPClassifyUtil/IPClassifyUtility","DS/WidgetServices/WidgetServices"],function(e,t,o,n,i,r,s){"use strict";var a={tree:"ds6w:label"};return e.singleton({init:function(e){this._parent(e),this._currentSearch=null,this._searchInfo=null,this._indexInfo=null,this._lListener=[],this._lListenerResult=[],this._originFolder=null,this._previousViewCommand=null,this._defaultPredicates=["ds6w:label","physicalid","mxid","ds6w:type","ds6w:identifier","ds6w:classification","icon_2ddefaultthb.subtype","ds6w:reservedBy","relcount","taxonomies","ds6w:kind","ds6w:contentStructure","ds6w:cadMaster","ParentBk","owner","ds6w:responsibleUid","internal_link_vaultedobjectslink","ds6w:i3dx"],this.batchInfoIndex=new Map,this.countToShowOnBreadCrumb=0,this.countToLoadOnGrid=0,this.searchingInRoot=!1,this.combinedNresult=0,this.nextSearchResultLength=0,this.currentBatchesNresults=0,this.defaultRelPredicates=["bks.TreeOrder","physicalid"],this._attrPredicateMap=new Map,this._predAttrMapDefault=this._defaultPredicates.map(e=>[e,null]),this.defaultRelPredicates.forEach(e=>this._predAttrMapDefault.push([e,null])),this._predAttrMap=new Map(this._predAttrMapDefault);this._searchInfo={with_indexing_date:!0,select_predicate:UWA.clone(this._defaultPredicates),select_relPredicate:UWA.clone(this.defaultRelPredicates),select_file:["icon","thumbnail_2d"],order_field:"ds6w:modified",order_by:"desc",nresults:25},this._facets=null,o.getModelEvents().subscribe({event:"search_cleared"},this.clearSearch.bind(this,!0))},_getSingletonInstance:function(){return this},setInitialSearchData:function(){this.batchInfoIndex.clear(),this.rootSearchNo=0,this.countToShowOnBreadCrumb=0,this.searchingInRoot=!1,this.combinedNresult=0},setNumberResults:function(e){this._searchInfo.nresults=e},getNumberResults:function(){return this._searchInfo.nresults},setPreviousView:function(e){this._previousViewCommand=e},getPreviousView:function(){return this._previousViewCommand},setPredicates:function(e){this._attrPredicateMap.clear(),this._predAttrMap=new Map(this._predAttrMapDefault),this.addPredicates(e)},setRootBookmarks:function(e){this._roots=e},getRootBookmarks:function(){return this._roots},addPredicates:function(e){var t=this;Array.isArray(e)&&e.forEach(function(e){var o=e.ds6w;if(o&&"thumbnail"!==o){var n=null;if(e.attrDBName)for(var i in n=e.attrDBName)t._attrPredicateMap.set(n[i],o);t._predAttrMap.set(o,n)}}),this._searchInfo.select_predicate=Array.from(t._predAttrMap.keys())},removePredicates:function(e){for(var t=0;t<e.length;++t)if(this._predAttrMap.delete(e[t].dataIndex),e[t].attrDBName){var o=e[t].attrDBName;for(var n in o)this._attrPredicateMap.delete(o[n])}this._searchInfo.select_predicate=Array.from(this._predAttrMap.keys())},getAuthAttributes:function(){var e=Array.from(this._predAttrMap.values());return e=e.filter(function(e){return null!=e}),[].concat.apply([],e)},getIndexPredicates:function(){return Array.from(this._searchInfo.select_predicate)},getRelIndexPredicates:function(){return Array.from(this._searchInfo.select_relPredicate)},getAttrPredicateMap:function(){return this._attrPredicateMap},onSearchChange:function(e){"function"==typeof e&&this._lListener.push(e)},onSearchResult:function(e){"function"==typeof e&&this._lListenerResult.push(e)},_notifyChange:function(e){if(this.isSearchActive()||e){var t=this;e||(e=t._currentSearch),this._lListener.forEach(function(e){e.call(null,t._currentSearch)})}},changeSortField:function(e,t){var o=this._getDS6WFromColumnIndex(e),i=this._getColumnPredicate(o);if(!i||!i.startsWith("ds6w"))return{message:n.get("msg_info_SortNonAvailable"),className:"primary"};this._searchInfo.order_field!==i&&(this._searchInfo.order_field=i,this.setInfoIndex(null,!1)),t&&this._notifyChange()},changeOrderSort:function(e,t){null!=e&&this._searchInfo.order_by!=e&&(this._searchInfo.order_by=e,this.setInfoIndex(null,!1)),t&&this._notifyChange()},changeSearch:function(e,t){if(""===e&&(e=null),this._currentSearch!==e||!e){this.setInfoIndex(null,!e);var o=this._currentSearch;this._currentSearch=e,!0!==t&&this._notifyChange(o),e&&r.sendTrackerPageEvent("FolderWidget_iconBar","Search")}},columnIsAvailable:function(e){return null!=this._getColumnPredicate(e)},_getColumnPredicate:function(e){var t=this._getDS6WFromColumnIndex(e),o=this.getSearchInfo().select_predicate.indexOf(t)>=0?t:null;return o=!o&&this.getSearchInfo().select_predicate.indexOf(t)>=0?t.toLowerCase():o},_getDS6WFromColumnIndex:function(e){var t=a[e];return t||(t=e),t},getSearchInfo:function(){return this._searchInfo},setSearchCallResult:function(e){this.currentBatchesNresults=e.length},getSearchCallResult:function(){return this.currentBatchesNresults},getNextStartNum:function(e){return"OnPremise"!=s.getTenantID()?e.nhits-Number(e.next_start.substring(1,e.next_start.indexOf(" ",2))):e.nhits-Number(e.next_start.substring(0,e.next_start.indexOf(" ")))},setScrollEndStatus:function(e){this.nextSearchResultLength=0,0!=this.batchInfoIndex.size&&this.batchInfoIndex.forEach((e,t)=>{this.nextSearchResultLength=this.nextSearchResultLength+this.getNextStartNum(e)})},getScrollEndStatus:function(){return!(this.countToShowOnBreadCrumb>this.getResultsCount())||!(this.nextSearchResultLength>0)},setCountForBreadCrumb:function(e){this.countToShowOnBreadCrumb+=e},getCountForBreadCrumb:function(e){let t={};return t.nresults=this.combinedNresult+e.length,t.nhits=this.countToShowOnBreadCrumb,t.searchingInRoot=!0,t},setBatchInfoIndex:function(e,t,o){this.batchInfoIndex.set(e,t),o&&this.setCountForBreadCrumb(t.nhits)},getBatchInfoIndex:function(e){return 0!=this.batchInfoIndex.size?null==this.batchInfoIndex.get(e)?null:this.batchInfoIndex.get(e):null},getCountToLoadOnGrid:function(){return this.searchingInRoot?this.countToLoadOnGrid:null},setCountToLoadOnGrid:function(){let e;this.countToLoadOnGrid=0,e=this.getResultsCount()>this.getSearchCallResult()?this.getSearchCallResult():this.getResultsCount(),this.countToLoadOnGrid=this.countToLoadOnGrid+e},_updateIndexUserInfo:async function(){let e=this._indexInfo;if(e){var t=this.getDateLastIndexation();e.lastIndexation=t;let o=await new Promise(e=>require(["DS/FolderEditor/service/FolderServices"],e));var n=await o.getCurrentBookmarkInfo();e.objectName=n.getLabel()}o.getModelEvents().publish({event:"searchUpdated",data:e})},setInfoIndex:function(e,t){var o=this;this._indexInfo=e,!1!==t&&(this._lListenerResult.forEach(function(t){t.call(o,e)}),this._updateIndexUserInfo())},resetInfoIndex:function(){this._indexInfo=null},getOrderFieldForTree:function(){var e=this.getOrderField();for(var t in a)a[t]===e&&(e=t);return e},getOrderField:function(){return this.getSearchInfo()?this.getSearchInfo().order_field:null},getOrderBy:function(){return this.getSearchInfo()?this.getSearchInfo().order_by:null},getInfoIndex:function(){return this._indexInfo},getNumberLastResult:function(){return this._indexInfo?this._indexInfo.nresults:0},getNumberHits:function(){return this._indexInfo?this._indexInfo.nhits:0},getDateLastIndexation:function(){var e=null,t=this.getInfoIndex();if(t&&t.sources){var o=null;t.sources.forEach(function(e){if(e.indexingDate)var t=e.indexingDate;for(var n in t)t[n]&&-1!==t[n]&&(o?t[n]<o&&(o=t[n]):o=t[n])}),o&&(e=new Date(1e3*o))}return e},isSearchActive:function(){return!!this.getSearchValue()},isSearchInProgress:function(){return!!this._indexInfo&&!!this._currentSearch},getSearchValue:function(){return this._currentSearch},getOriginFolder:function(){return this._originFolder},setOriginFolder:function(e){this._originFolder=e},clearSearch:function(e){this.changeSearch("",e)},getResultsCount:function(e){let o=0,n=t.getContent();if(n){let e=window.widget?window.widget:document,t=n.getGridViewRowHeight(),i=e.body.getDimensions().height;t&&i&&(o=Math.ceil(i/t))}return o=o>0?10*o:10,e?Math.max(e,o):o}})}),define("DS/FolderEditor/commands/PLMNewFolderCmd",["UWA/Core","DS/IPClassifyUtil/IPClassifyAlert","DS/ENONewWidget/command/NewContentCommandBase","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/Folder_CSO","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/utils/FolderLoaderGlobal"],function(e,t,o,n,i,r,s,a,l){"use strict";return o.extend({_newType:"Workspace Vault",_commandName:"NewWorkspace",_localContext:null,ExecutedByTopBar:!1,labelTopBar:"",activeTopBar:!0,init:function(e){var o=this;this._setCommandEnableStatus(),this._parent(e,{mode:"exclusive",isAsynchronous:!0}),this._menuItem=null;try{require(["DS/TopBarProxy/TopBarProxy","DS/TopBarProxy/Menu","DS/TopBarProxy/MenuItem"],function(e,i,r){var s=new e({id:widget.id}),l=new r({label:n.label_title_NewBookmark,onExecute:function(){a.isSearchActive()?t.displayNotification({title:n.msg_warning_searchOpen.Title,subtitle:n.msg_warning_searchOpen.Details,message:n.msg_warning_searchOpen.Advice,className:"error"}):o.executeTopBar()}});o._menuItem=l,s.addContent({add:o._menuItem})})}catch(e){console.log("can't load top bar")}},_setCommandEnableStatus:function(){var e=this;require(["DS/PADUtils/PADContext"],function(t){e._localContext=t.get(),null!=e._localContext&&"function"==typeof e._localContext.getEditMode&&(!0!==t.get().getEditMode()&&e.disable(),t.get().addEvent("editModeModified",function(t){!0===t?e.enable():e.disable()}))})},getType:function(){return this._newType},getCreationDialogParameters:function(){var o=this;let a=s.getHeadersInformations();var l=[r.getCurrentBookmarkId()],d="";0==l.length?this._newType="Workspace":"FolderSection_AllFolders"===(d=l[0])?(d="",this._newType="Workspace"):this._newType="Workspace Vault";var c={type:this._newType,notification:!0,events:{onSuccess:function(r){o.ExecutedByTopBar=!1,t.displayNotification({message:n.msg_NewBookmarkSuccess.message,className:"success"}),e.is(i.getTreeCont())&&e.is(i.getContent())&&(r=e.is(r,"string")?JSON.parse(r):r,o._localContext.addRoots({pids:[r.result[0].identifier]}))},onFailure:function(e){o.ExecutedByTopBar=!1,console.log(e)},onCancel:function(e){o.ExecutedByTopBar=!1,console.log(e)}},silentMode:!1,viewType:"listView",options:{},activeTopBar:!0,labelTopBar:n.label_title_NewBookmark,commandName:this._commandName,context:a};d.length>0&&(c.options={parentPIDs:[d]}),this.launchCreateNew(c)},executeTopBar:function(){this.ExecutedByTopBar||(this.ExecutedByTopBar=!0,this.execute())},execute:function(){var e=this;this.showModalLoader(),require(["DS/ENONewWidget/ENONew/Events"],function(t){t.addEvent("onCreationDialogAction",function(t){t&&"ready"===t.action&&e.hideModalLoader()})});let t=this.getCreationDialogParameters();this.launchCreateNew(t)},hideModalLoader:function(){l.removeComponentToLoad("global","new")},showModalLoader:function(){l.addComponentsToLoad("global",{new:""})}})}),define("DS/FolderEditor/utils/FolderEditorEvents",["UWA/Class","DS/PADServices/utils/GlobalModelEvents","DS/FolderEditor/utils/FolderCommunication","DS/FolderEditor/service/FolderTypeService"],function(e,t,o,n){return e.singleton({EVT_CURRENT_FOLDER_CHANGE:"/FOLDER_EDITOR/CURRENTFOLDER_CHANGE",EVT_NODEMODEL_MODIFY:"/FOLDER_EDITOR/NODEMODEL_MODIFY",EVT_TREEFILTER_CHANGE:"/FOLDER_EDITOR/EVT_TREEFILTER_CHANGE",EVT_TREE_UPDATE:"/FOLDER_EDITOR/EVT_TREE_UPDATE",EVT_TAGGER_STATUS_CHANGE:"/FOLDER_EDITOR/EVT_TAGGER_STATUS_CHANGE",EVT_CURRENT_FOLDER_COLUMN_CHANGE:"/LIBRARY_EDITOR/CURRENT_LIBRARY_COLUMN_CHANGE",EVT_FOLDER_EDIOTR_READY:"onFolderEditorReady",_modelEvents:null,init:function(e){this._parent(e),this._modelEvents=t.getModelEvents()},createBookmarkForPublication:function(e,t){var o=e,i={From:"FolderEditor",FolderID:null,FolderLabel:null,FolderType:null,IsInDeletedItems:!1,IsFavorite:!!o&&!0===o.isFavorite,Timestamp:Date.now()};return!o||n.isSection(o.getID())&&!t||(i.FolderID=o.getID(),i.FolderLabel=o.getLabel(),i.FolderType=o.getType()),o&&"FolderSection_Trash"===o.getID()&&(i.IsInDeletedItems=!0),i},notifyFolderRename:function(e){if(!UWA.is(e,"array"))throw new Error("input parameter should be array");var t=this;e.forEach(function(e){var n=t.createBookmarkForPublication(e);o.publish("FolderEditor.FolderUpdated",JSON.stringify(n),!0),t._modelEvents.publish({event:t.EVT_NODEMODEL_MODIFY,context:e,data:e})})},notifyFolderAttrChange:function(e,t){this._modelEvents.publish({event:"TreeOrderModified",context:e,data:{data:e.folders,parentNode:t}})},notifyFolderLoadingEnd:function(e){if(!UWA.is(e))throw new Error("input parameter should be a TreeNodeModel");this._modelEvents.publish({event:this.EVT_FOLDER_LOADINGEND,context:e,data:e})},onFolderLoadingEnd:function(e){if(!UWA.is(e,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:this.EVT_FOLDER_LOADINGEND},e)},onFolderRename:function(e){if(!UWA.is(e,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:this.EVT_NODEMODEL_MODIFY},e)},onModAttr:function(e){if(!UWA.is(e,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:"TreeOrderModified"},e)},notifyCurrentFolderColumnChange:function(){this._modelEvents.publish({event:this.EVT_CURRENT_FOLDER_COLUMN_CHANGE})},onCurrentFolderColumnChange:function(e){if(!UWA.is(e,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:this.EVT_CURRENT_FOLDER_COLUMN_CHANGE},e)},notifyFolderEditorReady:function(){this._modelEvents.publish({event:this.EVT_FOLDER_EDIOTR_READY})},onFolderEditorReadyforWenInWin:function(e){if(!UWA.is(e,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:this.EVT_FOLDER_EDIOTR_READY},e)},notifyTreeUpdate:function(e){this._modelEvents.publish({event:this.EVT_TREE_UPDATE,data:e})},onTreeUpdated:function(e){this._modelEvents.subscribe({event:this.EVT_TREE_UPDATE},e)},notifyTaggerStatusChange:function(){this._modelEvents.publish({event:this.EVT_TAGGER_STATUS_CHANGE})},onTaggerStatusChange:function(e){this._modelEvents.subscribe({event:this.EVT_TAGGER_STATUS_CHANGE},e)},notifyRightSidePanelOpen:function(e){this._modelEvents.publish({event:"information-panel-open-fromDGV",data:{rdata:"right",dataIndex:e}})},subscribeEvents:function(){var e=this;return this._modelEvents.subscribe({event:"welcome-panel-collapse"},function(){e._modelEvents.publish({event:"triptych-hide-panel",data:"left"})}),this._modelEvents.subscribe({event:"welcome-panel-expand"},function(){e._modelEvents.publish({event:"triptych-show-panel",data:"left"})}),this._modelEvents.subscribe({event:"information-panel-close"},function(){e._modelEvents.publish({event:"triptych-hide-panel",data:"right"})}),this._modelEvents.subscribe({event:"information-panel-open"},function(){e._modelEvents.publish({event:"triptych-show-panel",data:"right"})}),this._modelEvents.subscribe({event:"information-panel-open-fromDGV"},function(t){e._modelEvents.publish({event:"triptych-show-panel",data:t})}),this._modelEvents},subEvent:function(e,t){if(!UWA.is(t,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:e},t)},leftPanelOpen:function(e){this.subEvent("triptych-show-panel",e)},leftPanelClose:function(e){this.subEvent("triptych-hide-panel",e)},rightPanelOpen:function(e){this.subEvent("triptych-show-panel",e)},rightPanelClose:function(e){this.subEvent("triptych-hide-panel",e)},unsubscribeAll:function(){this._modelEvents.unsubscribeAll()}})}),define("DS/FolderEditor/views/FolderMode",["UWA/Controls/Abstract","DS/Controls/TooltipModel","DS/FolderEditor/Folder_CSO","DS/Utilities/Dom","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/FolderSearch","DS/IPClassifyUtil/IPClassifyAlert","DS/CoreEvents/ModelEvents","DS/PADUtils/PADSession","DS/PADServices/utils/GlobalModelEvents","DS/FolderEditor/utils/WidgetHandlerUtil","DS/FolderEditor/utils/FolderLoaderGlobal","DS/WebUAUtils/WebUAUtils","DS/IPClassifyUtil/IPClassifyUtility"],function(e,t,o,n,i,r,s,a,l,d,c,u,p,g,f,h){"use strict";var m=null,v=null;function _(){return{icon:{iconName:widget.getValue("useIndexAccleration")?isNaN(widget.getValue("autoSwitch"))?"database hoverGlass":"database-hourglass":"database hoverGlass",fontIconFamily:1,className:"check-active"},disabled:!widget.getValue("useIndexAccleration")}}var S=e.singleton({_currentModeType:"read",_instantTime:null,_lastRefreshMode:null,_modelEvents:null,init:function(e){this._parent(e),this._tooltip=new t,u.getModelEvents().subscribe({event:"switch_to_author"},this.switchtoAuthoringMode.bind(this)),setInterval(()=>{this.updateToolTip()},1e4),this._modelEvents=new d},getToolbarEntry:function(){var e="read"==S.getCurrentModeType()?{icon:{iconName:"database-refresh",fontIconFamily:1,className:""},disabled:!1}:_(),t={id:"indexMode",dataElements:{typeRepresentation:"functionIcon",tooltip:this._tooltip,label:i.indexMode.Label,action:{module:"DS/FolderEditor/views/FolderMode",func:"switchModeButtonUI"},visibleFlag:1!=widget.launchWithReadMode}};for(var o in e)t[o]=e[o];return t},switchModeButtonUI:function(){h.sendTrackerPageEvent("FolderWidget_iconBar","Active Mode");var e;e=300,clearTimeout(v),v=setTimeout(function(){a.isSearchActive()&&(a.clearSearch(),r.getIdCardCont().switchSearch(!1)),"read"==S.getCurrentModeType()?(S.setCurrentMode("authoring"),S.updateIconAndSettings()):(S.setCurrentMode("read"),S.updateIconAndSettings());try{p.refreshWidgetContent()}catch(e){console.log("Error in tree mode"),g.removeComponentToLoad("treeView","tree"),g.removeComponentToLoad("treeView","personalTree")}},e)},updateIconAndSettings:function(e){var t=e||!0;if(widget.refreshDuetoChangeInPreference){var o=widget.changeInPreference;o.hasOwnProperty("useIndexAccleration")&&(o.useIndexAccleration?this.setCurrentMode("read"):this.setCurrentMode("authoring"),this._modelEvents.publish({event:"changeInContentFilterType"})),(o.hasOwnProperty("filtered-content")||o.hasOwnProperty("allow-products-expand"))&&this._modelEvents.publish({event:"onSpecificPreferenceChange"})}(t&&this._registerTimeandModeOfRefresh(this.getCurrentModeType()),"read"==this.getCurrentModeType())&&(this._enableIndexModeSwitch(),r.getContent().RefreshProductStructure=!0,S.stopRefresh(),(!widget.refreshDuetoChangeInPreference||Object.keys(o).length>0)&&r.getContent().getSpecficMode("read").resetInfoIndex());if("authoring"==this.getCurrentModeType())if(widget.getValue("useIndexAccleration")){var n=widget.getValue("autoSwitch");this._enableAuthoringMode(),S.setIndexModeAfterTimeInterval(n)}else this._enableAuthoringMode();this.updateToolTip()},_enableAuthoringMode:function(){if(r.getIdCardCont()){var e=_();r.getIdCardCont().updateCommand("indexMode",e)}},_enableIndexModeSwitch:function(){if(r.getIdCardCont()){var e={icon:{iconName:"database-refresh",fontIconFamily:1,className:""},disabled:!1};r.getIdCardCont().updateCommand("indexMode",e)}},getCurrentModeType:function(){return this._currentModeType},setCurrentModeType:function(e){this._currentModeType=e,"read"==e?(c.setAuthoringState(!1,null,!1),c.setUseIndexPreference(!0,null,!1)):(c.setAuthoringState(!0,null,!1),c.setUseIndexPreference(!1,null,!1))},onGlobalModeChange:function(e){this._modelEvents.subscribe({event:"changeInFolderGlobalMode"},e)},onSpecificPreferenceChange:function(e){this._modelEvents.subscribe({event:"onSpecificPreferenceChange"},e)},_registerTimeandModeOfRefresh:function(e){this._instantTime=(new Date).getTime(),this._lastRefreshMode=e},updateToolTip:function(){var e=this._instantTime,t=Math.floor(((new Date).getTime()-e)/1e3);t=t<60?t+" "+i.indexMode.seconds:t/60<60?Math.floor(t/60)+" "+i.indexMode.minutes:Math.floor(t/3600)+" "+i.indexMode.hours;var o="read"==this._currentModeType?i.indexMode.IndexModeTooltip:i.indexMode.AuthoringModeTooltip,n="read"==this._currentModeType?i.indexMode.IndexModelongHelp:i.indexMode.AuthoringModelongHelp,s="read"==this._currentModeType?i.indexMode.Index:i.indexMode.Authoring,a=i.replace(i.indexMode.activeMode,{mode:s})+"\n"+i.replace(i.indexMode.lastRefresh,{timeElapsed:t});widget.getValue("useIndexAccleration")&&"authoring"==this._currentModeType&&!isNaN(widget.getValue("autoSwitch"))&&i.replace(i.indexMode.reactIndexMode,{autoSwitch:widget.getValue("autoSwitch")});if(this._tooltip.shortHelp=o,this._tooltip.longHelp=n,this._tooltip.title=i.indexMode.title,!this._tooltip.moreHelpCB){var l={helpid:"indexMode",content:{"indexMode.PanelHelp":"ENOFol3UAPanelMap/foldereditor-c-IndexMode.htm"}},d=f.getMoreHelpCallback(l);this._tooltip.moreHelpCB=d}r.getIdCardCont()&&r.getIdCardCont().updateCommand("indexMode",{tooltip:this._tooltip})},setIndexModeAfterTimeInterval:function(e){var t=this;if(this.stopRefresh(),!isNaN(e)){var o=parseInt(e);m=setTimeout(function(){widget.getPreference("useIndexAccleration").value&&(t.setCurrentMode("read"),t.updateIconAndSettings(),l.displayNotification({message:i.replace(i.indexMode.info_msg_DataNotUptoDate,{timeElapsed:o}),title:i.indexMode.info_msg_IndexModeTitle,className:"info"}))},60*o*1e3)}},stopRefresh:function(){m&&clearTimeout(m)},setCurrentMode:function(e){var t=this._currentModeType!==e;this.setCurrentModeType(e),!a.isSearchActive()&&r.getContent()&&r.getContent().setCurrentMode(e),t&&this._modelEvents.publish({event:"changeInFolderGlobalMode"})},switchtoAuthoringMode:function(e){e="boolean"==typeof e&&e,"read"==S.getCurrentModeType()&&(a.isSearchActive()&&0==e&&(a.clearSearch(),r.getIdCardCont().switchSearch(!1)),S.setCurrentMode("authoring")),S.updateIconAndSettings()},isFolderProxyToBeUsed:function(){var e=r.getContent();return"read"==(e?e.getCurrentModeType():widget.getValue("useIndexAccleration")?"read":"authoring")}});return S}),define("DS/FolderEditor/views/FolderPlaceHolder",["UWA/Controls/Abstract","DS/Controls/Button","DS/FolderEditor/utils/FolderEditorEvents","DS/ApplicationFrame/CommandsManager","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderEditorcontrol","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/views/FolderMode"],function(e,t,o,n,i,r,s,a,l){"use strict";return e.extend({init:function(e){this._parent(e),this._buttonComponents=null,this.text={},this.buildSkeleton()},buildSkeleton:function(){var e=this,t="FolderSection_AllFolders";function o(t){e._getComponentToReplace(t).inject(e.elements.container)}i.getCurrentBookmarkId()&&(t=i.getCurrentBookmarkId()),this.elements.container=UWA.createElement("div",{class:"content-placeholder"}),this.elements.icon=UWA.createElement("div",{class:"content-placeholder-icon"}).inject(this.elements.container),this.elements.description=UWA.createElement("div",{class:"content-placeholder-description"}).inject(this.elements.container),i.onBookmarkOpening(function(t){e._removeButtonComponent(),o(i.getCurrentBookmarkId())}),a.onSearchChange(function(){a.isSearchActive()?(e._removeButtonComponent(),o()):(t=i.getCurrentBookmarkId(),e._removeButtonComponent(),o(t))}),o(t)},_buildButtonComponents:function(e){var o=[];function n(e,o){var n=e.commands[o].callback,i={label:e.commands[o].name,emphasize:e.commands[o].emphasize,icon:e.commands[o].icon},r=new t(i);return r.getContent().addEventListener("buttonclick",function(){n()}),r}function i(e,t){if(e.commands)for(var o=0;o<e.commands.length;o++){n(e,o).inject(t)}}for(var r in e){var s=this.commonCommand=UWA.createElement("div",{class:"content-placeholder-common-command"});i(e[r],s),o[r]=s,this.text[r]=e[r].text}return o},_getComponentToReplace:function(e){var t=this._getButtonComponents();if(null===t){var o=this._getOptions();t=this._buttonComponents=this._buildButtonComponents(o)}return a.isSearchActive()?(this._getText(this.text.search),t.search):"FolderSection_favorite"===e?(this._getText(this.text.favoriteSection),t.favoriteSection):"FolderSection_AllFolders"===e?widget.launchWithReadMode?(this._getText(this.text.bookmarkSection_Read),t.bookmarkSection_Read):(UWA.createElement("i",{class:"wux-ui-3ds  wux-ui-3ds-search content-placeholder-icon",styles:{color:"#b4b6ba","font-size":"72px"}}).inject(this.elements.icon),this._getText(this.text.bookmarkSection),t.bookmarkSection):widget.launchWithReadMode?(this._getText(this.text.bookmark_Read),t.bookmark_Read):(this._getText(this.text.bookmark),t.bookmark)},_getOptions:function(){let e=[{name:s.get("placeholder_CMD_UploadFile"),emphasize:"secondary",callback:function(){var e=n.getCommand("AddFile",r.getContent());e&&e.begin()}}];return widget.getView&&"sidepanel"===widget.getView().type||e.unshift({name:s.get("placeholder_CMD_AddExisting"),emphasize:"primary",callback:function(){var e=n.getCommand("AddExistingContent",r.getContent());e&&e.begin()}}),{favoriteSection:{text:s.get("placeholder_msg_favorite")},bookmarkSection:{text:s.get("placeholder_msg_section"),commands:[{name:s.get("placeholder_CreateFolder"),icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"0.5x"},emphasize:"primary",callback:function(){var e=n.getCommand("ActionBar_NewFolderCmd",r.getContent());e&&e.begin()}}]},bookmarkSection_Read:{text:s.get("placeholder_msg_folder")},bookmark:{text:s.get("placeholder_msg_folder"),commands:e},bookmark_Read:{text:s.get("placeholder_msg_folder")},search:{text:s.get("placeholder_msg_search")}}},_removeButtonComponent:function(){let e=this.getContent().getElementsByClassName("content-placeholder-common-command")[0];e&&e.remove(),this.elements.icon.getChildren().forEach(function(e){e.remove()})},_getText:function(e){let t=this.getContent().getElementsByClassName("content-placeholder-description")[0];t&&(t.innerText=e)},_getButtonComponents:function(){return this._buttonComponents}})}),define("DS/FolderEditor/tagger/TaggerContentProxy",["DS/PADServices/utils/GlobalModelEvents","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/WidgetHandlerUtil","DS/PADUtils/PADSettingsMgt","DS/IPClassifyUXUtil/tagger/TaggerIPProxy"],function(e,t,o,n,i,r){return n.createSingleton(class extends r{constructor(){super(e.getModelEvents(),{name:"Content",colorize:!0,exclude:!0,events:{addColorizeListener:e=>{this.filterBIColorize.call(this,e)},addUnColorizeListener:e=>{this.onFilterBIUnColorize.call(this,e)}}}),this._colorActives=null,this.activate(!0),o.onTaggerStatusChange(()=>{this.activate(!n.isTreeTaggerActive())})}addObjectsTags(e,t){var o=super.addObjectsTags(e,t);return o.catch(()=>{console.log("Can retrieve objects Tags")}),o}updateColorNodes(e){let o=e||this._nodesToColorize;if(this._nodesToColorize={...o},this.isActive()&&Object.keys(o).length>0&&this._colorActives&&this.facetsComputationActives()){let e={};var n=this._colorActives;for(let t=0;t<n.length;++t){let o=n[t].object,i=n[t].color;e[o]=i}t.fetchIndexAttributes({idsPerAttrAndService:o,select_predicate:n[0].predicate}).then(t=>{let o=!1;t.forEach(t=>{let i=t.results;if(i&&this._colorByNodes)for(let t=0;t<i.length;++t){let r=i[t].attributes,s=null,a=null;for(let t=0;t<r.length;++t)"resourceid"===r[t].name?s=r[t].value:-1!==n[0].predicate.indexOf(r[t].name)&&(a=e[r[t].value]);this._colorByNodes[s]=a,o=!0}}),o&&this._model.publish({event:"nodeColorUpdated",data:{}})}).catch(e=>{console.log("Failure during fetch of ID's for colorize")})}}facetsComputationActives(){return super.facetsComputationActives()||i.getSetting("activateBIFilter")}getCellKPIColor(e){var t=null;if(this.isActive()&&this._colorByNodes){var o=e.nodeModel.getID(),n=this._colorByNodes[o];t=n||"transparent"}return t}filterBIColorize(e){e&&e.tagColors&&!(e.tagColors.length<=0)&&e.tagColors[0].predicate&&this._isActive&&(this._colorByNodes={},this._colorActives=e.tagColors,this.updateColorNodes())}onFilterBIUnColorize(){this._colorByNodes=null,this._colorActives=null,this._model.publish({event:"nodeColorUpdated",data:{}})}})}),define("DS/FolderEditor/service/FolderEditorWebServiceReadMode",["DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/WidgetServices/WidgetServices","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/utils/WidgetHandlerUtil","UWA/Core","DS/IPClassifyUXUtil/service/IPClassifyUXUtilWebService"],function(e,t,o,n,i,r,s,a,l){"use strict";let d=["physicalid","ds6w:globalType","ds6w:type","ds6w:label","ro.plminstance.V_treeorder"];function c(e){let t=null;if(e){let o=[];for(let t in e){let n=e[t];if(n&&n.length>0&&Array.isArray(n)){let e=[],i=[];n.forEach(t=>{if(t.object){let o=!0===t.excluded?i:e,n=t.object;if(Array.isArray(n)){let e=[];n.forEach(t=>{e.push(t.replace("/","_47_"))}),n=e.join("/"),o.push(n+"/*")}else n=n.replace("/","_47_");o.push(n)}});let r=t.split("/"),s=r[r.length-1];e.length>0&&o.push("["+s+']:("'+e.join('" OR "')+'")'),i.length>0&&o.push("NOT(["+s+']:("'+i.join('" OR "')+'"))')}}t=o.join(" AND ")}return t}function u(e,t,o){var n=new Date;let i=(e+Math.random().toString(36).substring(2,9)+"_"+n.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),r=[];o=o||{};let s=0;for(let e in t){let n=t[e].paths.map(e=>({physical_id_path:e}));s++;let a=[{prefix_filter:{prefix_path:n}}];if(o.filters){let e=c(o.filters);e&&a.push({sequence_filter:{sequence:[{uql:e}]}})}let l=[];o.level>=0&&n.length>0&&l.push({truncate:{max_distance_from_prefix:o.level,prefix_filter:{prefix_path:n}}});let d=o.max_output_paths?o.max_output_paths:null;if(o.findIn&&o.findIn.query){d=d||301;let e={sequence:[{uql:o.findIn.query}]};a.push({sequence_filter:e}),l.push({truncate:{max_distance_from_prefix:0,compute_matching_subpaths_lengths:1,match_only_refs:1,sequence_filter:e}})}let u={label:i+"_"+s,root:{physical_id:e}};a.length>0&&(u.filter={and:{filters:a}}),l.length>0&&(u.aggregation_processors=l),d&&(u.parameters={limit_max_path:d}),o.graph&&(u.graph=o.graph),r.push(u)}let a={batch:{expands:r},outputs:{select_object:o.select_object?o.select_object:["physicalid"],select_relation:o.select_relation?o.select_relation:["physicalid"],format:"entity_relation_occurrence"}};return o.findIn&&o.findIn.query&&(a.outputs.matching_lengths=1),o.withIcons&&(a.outputs.hits={predefined_computation:["icons"]}),a}function p(e,t,o,n,i){let r=[{truncate:{max_distance_from_prefix:1,prefix_filter:{prefix_path:[{physical_id_path:[o.pid]}]}}}];return i&&r.push({synthesis:{name:"xSynth",mode:"tree_leaf",group_by_facet:1,synthesis_only:1,exclude_root_from_count:!0}}),{label:e,root:{physical_id:o.pid},graph:{descending_condition_relation:{uql:t}},filter:function(e,t,o){return e?{sequence_filter:{sequence:[{statement:"BEGIN"},{uql:"physicalid:"+t},{statement:"NEXT"},{uql:o},{statement:"NEXT"},{uql:e}]}}:{all:1}}(n,o.pid,t),parameters:{graph_advise:1,limit_max_path:i||o.noSizeLimit?0:s.MAX_NUMBER_EXPAND},aggregation_processors:r}}var g=function(){var e=null;if(i.getContent()&&i.getContent().getPADTreeListView()){var t=i.getContent().getPADTreeListView().options.dgv.sortModel;t&&t.length>0&&(e={sort:t[0].sort,dataIndex:"tree"===t[0].dataIndex||"defaultSort"===t[0].dataIndex?"ds6w:label":t[0].dataIndex})}return e};return a.extend(r,{getFilteredContent:function(e){var o={};a.extend(o,e);var i=t.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+o.pid+"/cloudViewContent?filter=true&bookmarks=false";return o.payload={},o.payload.select_object=n.getIndexPredicates(),o.headers={"content-type":"application/json"},o.data=a.Json.encode(o.payload),o.method="POST",o.type="json",o.timeout=12e4,l._executeRequest(i,o,"content")},getContentReadMode:function(o){var i={};a.extend(i,o);var r=t.get3DSearchUrl()+"/search";i.payload={},i.payload.query="NOT(physicalid:"+o.pid+")"+("All"===o.content?"":'AND NOT(type == "Workspace Vault")'),o.exceptIds&&o.exceptIds.length>0&&(i.payload.query+=" AND NOT(physicalid:"+o.exceptIds.join(") AND NOT(physicalid:")+")");var s=new Date,d=Math.random().toString(36).substring(2,9);if(i.payload.label=("Folder_getContentReadMode"+d+"_"+s.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),!0!==i.synthesis){i.payload.select_predicate=n.getIndexPredicates(),i.payload.with_synthesis="false",null!==o.next_start?i.payload.next_start=o.next_start:i.payload.start=0,i.payload.nresults=n.getResultsCount(),i.payload.select_file=["icon","thumbnail_2d"];var c=g();c&&i.payload.select_predicate.indexOf(c.dataIndex)>-1&&(i.payload.order_by=c.sort,i.payload.order_field=c.dataIndex)}else i.payload.label="tags_"+i.payload.label;var u=widget.lang?widget.lang:widget.getValue("lang");return i.filters&&Object.keys(i.filters).length>0&&(i.payload.refine=i.filters),i.payload.specific_source_parameter={"3dspace":{option:{with_Idx_Search:!0},search_in_context:{expand:{root_physicalid:o.pid,expand_iter:"1"}}}},i.payload.locale=u,i.payload.tenant=t.getPlatformId(),i.payload.source=["3dspace"],i.payload.with_indexing_date="false",i.payload.login={"3dspace":{SecurityContext:e.getSetting("pad_security_ctx")}},i.headers={"content-type":"application/json"},i.data=a.Json.encode(i.payload),i.method="POST",i.timeout=12e4,i.type="json",l._executeRequest(r,i,"getContentReadMode")},getRoots:function(o){var r={};a.extend(r,o);var d=t.get3DSearchUrl()+"/search";r.payload={},r.payload.select_predicate=o.predicates?o.predicates:["ds6w:label","physicalid","mxid","ds6w:type","ds6w:classification","icon_2ddefaultthb.subtype","ds6w:status","ds6w:description","ds6w:responsible","ds6w:modified","ds6w:created","ds6w:identifier","ds6w:reservedBy","flattenedtaxonomies"];var c=new Date,u=Math.random().toString(36).substring(2,9);if(r.payload.label=("Folder_read_getRoots"+u+"_"+c.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),!0!==r.synthesis_only){if(o.contentView){var p=g();p&&r.payload.select_predicate.indexOf(p.dataIndex)>-1&&(r.payload.order_by=p.sort,r.payload.order_field=p.dataIndex),r.payload.select_predicate=o.predicates?o.predicates:n.getIndexPredicates(),o.next_start?r.payload.next_start=o.next_start:r.payload.start=0,r.payload.nresults=n.getResultsCount(s.ROOTS_PER_PAGE)}else{var f=i.getTreeCont()._folders_SortElmt;r.payload.order_by=f.sortOrder,r.payload.order_field="alpha"==f.sortMode?"ds6w:label":"ds6w:modified";var h=i.getTreeCont()._indexModeforReadData.getNextStart();r.payload.start=h,r.payload.nresults=n.getResultsCount(s.ROOTS_PER_PAGE)}r.payload.select_file=["icon","thumbnail_2d"]}else r.payload.label="tags_"+r.payload.label;r.filters&&Object.keys(r.filters).length>0&&(r.payload.refine=r.filters),r.payload.query='flattenedtaxonomies:"types/Workspace"',o.exceptIds&&o.exceptIds.length>0&&(r.payload.query+=" AND NOT(physicalid:"+o.exceptIds.join(") AND NOT(physicalid:")+")");var m=widget.lang?widget.lang:widget.getValue("lang");return r.payload.locale=m,r.payload.tenant=t.getPlatformId(),r.payload.source=["3dspace"],r.payload.indexmode="true",r.payload.login={"3dspace":{SecurityContext:e.getSetting("pad_security_ctx")}},r.headers={"content-type":"application/json"},r.data=a.Json.encode(r.payload),r.method="POST",r.timeout=12e4,r.type="json",l._executeRequest(d,r,"Folder_read_getRoots")},expandFolder:function(o){var i=t.get3DSpaceUrl()+"/cvservlet/progressiveexpand/v2?output_format=cvjson",r={};a.extend(r,o);var s=new Date;let d=("Bookmark_Expand_"+Math.random().toString(36).substring(2,9)+"_"+s.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-");var c=n.getIndexPredicates();let u=n.getRelIndexPredicates(),p=[];r.multi_root_physicalid.forEach((e,t)=>{let o={label:d+"_"+t,root:{physical_id:e},parameters:{graph_advise:1,limit_max_path:5001},graph:{descending_condition_relation:{uql:"(taxonomies:Data Vaults) OR (taxonomies:Sub Vaults)"}},filter:{all:1}};r.level>=0&&(o.aggregation_processors=[{truncate:{max_distance_from_prefix:r.level,prefix_filter:{prefix_path:[{physical_id_path:[e]}]}}}]),p.push(o)}),r.payload={batch:{expands:p},outputs:{select_object:c,select_relation:u,format:"entity_relation_occurrence"}};let g=e.getSetting("pad_security_ctx");return r.headers={SecurityContext:g,SecurityToken:window.top.dsUserLogin+"|"+g+"|preferred","content-type":"application/json"},r.type="json",r.data=a.Json.encode(r.payload),r.method="POST",r.timeout=12e4,l._executeQueryWithError(i,r,"expandFolder")},expandProductsForDisplay:function(e,t){var i=o.getCancelObject();let r=new Promise((o,r)=>{this._getProductExpandConditions().then(s=>{if(!i.isCancelled()){let i="NOT (taxonomies:"+s.noRel.join(") AND NOT (taxonomies:")+")";let a=[...n.getIndexPredicates(),"ds6w:globalType"];t={...t,withIcons:!0,select_object:a,select_relation:d,graph:{descending_condition_object:{uql:'(typecode:0 OR typecode:1) AND ([ds6w:globaltype]:"ds6w:Document" OR [ds6w:globaltype]:"ds6w:Part")'},descending_condition_relation:{uql:i}}};let l=u("Bookmark_PrdExpandDisp_",e,t),c=l;if(t.db){let o=[];for(let t in e){let n=e[t].paths;o=o.concat(n)}l={cv:c,db:{source:"cstorage",root_path_physicalid:o,expand_iter:`${void 0!==t.level?t.level:-1}`,label:l.batch.expands[0].label+"_db",select_bo:a,select_rel:d,compute_select_bo:["icon"],types:["VPMReference","VPMInstance","VPMRepReference","3DShape"]}}}this._executePrdExpand(l,t.db).then(o).catch(r)}}).catch(r)});return r.cancel=i.cancel,r},expandOfProducts:function(e,t){let o=u("Bookmark_PrdExpand_",e,t);return this._executePrdExpand(o)},_executePrdExpand:function(o,n){let i=!0!==n?"/cvservlet/progressiveexpand/v2?output_format=cvjson":"/resources/enoauthoring/expand/v2/progressive";var r=t.get3DSpaceUrl()+i,s={};s.payload=o;let d=e.getSetting("pad_security_ctx");return s.headers={SecurityContext:d,"content-type":"application/json"},!0!==n&&(s.headers.SecurityToken=window.top.dsUserLogin+"|"+d+"|preferred"),s.type="json",s.data=a.Json.encode(s.payload),s.method="POST",s.timeout=12e4,l._executeQuery(r,s,"_executePrdExpand")},getAllLinksFromIndex:function(e){var o=t.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/getAllLinks",n={};return n.payload={rootIds:e.rootIds},n.headers={"content-type":"application/json"},n.type="json",n.data=a.Json.encode(n.payload),n.method="POST",n.timeout=12e4,l._executeQuery(o,n,"getAllLinksFromIndex")},listContent_ExpandLevel_1:function(o){var i=t.get3DSpaceUrl()+"/cvservlet/progressiveexpand/v2?output_format=cvjson",r={};a.extend(r,o);var s=new Date;let d=("listContent_ExpandLevel_1"+Math.random().toString(36).substring(2,9)+"_"+s.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-");var u=o.predicates?o.predicates:n.getIndexPredicates(),g=n.getRelIndexPredicates();let f=c(o.filters),h=[];r.payload={batch:{expands:h},outputs:{select_object:u,select_relation:g,format:"entity_relation"}},o.synthesis_only||(o.noContent||h.push(p(d+"_0","(taxonomies:Vaulted Objects)",r,f,!1)),o.content&&(h.push(p(d+"_1","(taxonomies:Data Vaults) OR (taxonomies:Sub Vaults)",r,f,!1)),h.push(p(d+"_2","(taxonomies:Linked Folders)",r,f,!1)))),o.synthesis&&(!0===o.noContent&&"synthesis"!==o.noContent||h.push(p(d+"_Synth_0","(taxonomies:Vaulted Objects)",r,f,!0)),o.content&&(h.push(p(d+"_Synth_1","(taxonomies:Data Vaults) OR (taxonomies:Sub Vaults)",r,f,!0)),h.push(p(d+"_Synth_2","(taxonomies:Linked Folders)",r,f,!0))),r.payload.outputs.synthesis=["xSynth"]),o.predicates||(r.payload.outputs.hits={predefined_computation:["icons"]});let m=e.getSetting("pad_security_ctx");return r.headers={SecurityContext:m,SecurityToken:window.top.dsUserLogin+"|"+m+"|preferred","content-type":"application/json"},r.type="json",r.data=a.Json.encode(r.payload),r.method="POST",r.timeout=12e4,l._executeQueryWithError(i,r,"listContent_ExpandLevel_1")}})}),define("DS/FolderEditor/service/FolderServices",["UWA/Core","DS/IPClassifyUtil/IPClassifyUtility","DS/FolderEditor/Folder_CSO","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/service/FolderEditorWebServiceReadMode","DS/FolderEditor/tagger/TaggerContentProxy","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/DocumentManagement/DocumentManagement","DS/FolderEditor/service/FolderTypeService","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderLoaderGlobal","DS/WidgetServices/WidgetServices","DS/ApplicationFrame/CommandsManager","DS/FolderUpload/FolderUpload","DS/FolderEditor/views/FolderMode","DS/FolderEditor/utils/WidgetHandlerUtil","DS/IPClassifyUXUtil/utils/CancellablePromise","DS/WebappsUtils/WebappsUtils","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/BkAlert"],function(e,t,o,n,i,r,s,a,l,d,c,u,p,g,f,h,m,v,_,S,C,b){"use strict";function F(e){return new Promise((t,o)=>{var i={pids:e};n.getFolderPath(i).then(e=>{e.error?o(e.error):t(e)}).catch(()=>{u.checkRolesAvailability(function(t,o,n){if(1==t||1==o||1==n){let t=null;e.length>0&&(t=e[0]),b.displayNotFoundBk(t)}else c.displayNotification({message:C.msg_error_folderPath_roles,className:"error"})}),o()})})}var y=null;let D=null,E=null;function w(e){e.label=C["Broken link"],e.service="__Unknown__",e.type="brokenLink",e.displayType=C["Broken link"],e.largeicon=S.getWebappsAssetUrl("FolderEditor","icons/BrokenLink_Thumbnail.png"),e.links=[{id:e.id,owner:e.owner}]}o.onPrepareBookmarkOpening(()=>{D&&(D.cancel(),D=null),E=null}),o.onBookmarkOpening(async()=>{let e=o.getCurrentBookmarkSection(),n=null;n="FolderSection_favorite"===e?[{id:o.getCurrentBookmarkId()}]:await y.getCurrentBookmarkPath();let i="root";d.isSection(e)&&(i+=","+e),n&&n.length>0&&n.forEach(e=>{i+=","+e.id});var r=t.jsonUnzip(widget.getValue("folderTreeSelectedNode")||"{}");(r=JSON.parse(r))[s.getPlatformId()]=i,r=JSON.stringify(r),widget.setValue("folderTreeSelectedNode",t.jsonZip(r))});let A=e.createElement("iframe",{name:"bookmarkdownloaderFrame",styles:{display:"none"}}),T=e.createElement("form",{method:"POST",enctype:"application/x-www-form-urlencoded",target:"bookmarkdownloaderFrame",html:[{tag:"input",value:"true",name:"attachment"}],styles:{display:"none"}}),I={};return y={loadLinks:function(e,t){if(t=t||{},!e||e.length>0&&"FolderSection_AllFolders"===e[0])return _.resolve();var s=o.getCurrentBookmarkId();let a=null,l=new _(async(d,c)=>{if(e&&e.length>0){let u=this.getCurrentBookmarkInfo(),g={};t&&t.expandAll?(g.rootIds=e,a=i.getAllLinksFromIndex(g)):(g.pid=e[0],a=n.getLinks(g)),(a=_.all([a,u])).then(e=>{let i=e[0],a=e[1];if(o.getCurrentBookmarkId()===s){var u=i.contents;if(u){let e={},o=[],s={},g=t.filters?Object.keys(t.filters).length:0,f=!1;u.forEach(i=>{let r=n.getSourceFromService(i.service);if(r&&"www"!==i.service&&i.uri){let t=s[i.uri],o=!!t;if(t||((t=s[i.uri]=i).links=[]),t.links.push({id:i.id,owner:i.owner}),!o){let t=e[i.service];t||(t=e[i.service]=[]),t.push(i.uri)}}else r?(!t.searchQuery||i.uri&&i.uri.indexOf(t.searchQuery)>=0||i.appdata&&i.appdata.indexOf(t.searchQuery)>=0)&&(0===g||f)&&(i.type="wwwLink",i.displayType=C.wwwLinkType,i.serviceId=i.service,i.largeicon=S.getWebappsAssetUrl("IPClassifyUXUtil","icons/I_LinkTemp.png"),i.links=[{id:i.id,owner:i.owner}],o.push(i)):("__Unknown__"!==i.service&&console.error(i.service+" is unknown"),w(i),o.push(i))});let h={nhits:o.length,nmatches:o.length,nresults:o.length},m=Promise.resolve();Object.keys(e).length>0&&(m=function(e,t,o,{filters:i,searchQuery:s,bkLeader:a}){let l=null,d={};d["[ds6w:i3dx]"]=e;let c=new _((e,c)=>{(l=n.fetchIndexAttributes({idsPerAttrAndService:d,filters:i,searchQuery:s})).then(n=>{let i={infos:{nhits:0,nmatches:0,nresults:0}};if(n&&n.forEach(e=>{e.results&&(e.results.forEach(e=>{let n=function(e){let t={},o={};return e.attributes.forEach(e=>{let n=e.name,i=n.lastIndexOf("/");i>0&&(n=n.substring(i+1));let r=e.format,s=o[n];if(!s||r===s){let i=t[n],s=e.value;i&&(s=i+","+s),t[n]=s,o[n]=r}}),t}(e),i=t[n["ds6w:i3dx"]];i&&(n.serviceId=i.service,n.i3dx=i.uri,n.links=i.links,o.push(n)),delete t[n["ds6w:i3dx"]]}),r.addTags(e)),e.infos&&(i.infos.nhits+=e.infos.nhits,i.infos.nmatches+=e.infos.nmatches,i.infos.nresults+=e.infos.nresults)}),a)for(let e in t){let n=t[e];w(n),o.push(n)}e(i)}).catch(e=>{console.log(e),c({...C.msg_error_loadIndexAttr,className:"error"})}).finally(()=>{p.removeComponentToLoad("contentView","loadAttributes")}),p.addComponentsToLoad("contentView",{loadAttributes:""},{withCancel:!0,cancelObject:{cancel:()=>{l.cancel(),e()}}})});return c.addLinkedQuery(l),c}(e,s,o,{filters:t&&t.filters,searchQuery:t&&t.searchQuery,bkLeader:t&&!0===t.brokenLinks&&a.getAttributeValue("owner")===window.top.dsUserLogin}),l.addLinkedQuery(m)),m.then(e=>{if(i.contents=o,i.infos=h,e){i.infos=e.infos;for(let t in h)e.infos[t]=e.infos[t]?e.infos[t]+h[t]:h[t]}d(i)}).catch(c)}else c({message:C.msg_error_contentnotavailable.Title,className:"error"})}}).catch(c)}else d()});return l.addLinkedQuery(a),l},getCurrentBookmarkInfo:function(){let e=o.getSelectedBookmark(),t=o.getCurrentBookmarkId();if(E)return E;if(!e||e.getID()!==t){let t=o.getCurrentBookmarkElement();e=t.getLabel()?t:null}return(E=e&&e.getID()===t?Promise.resolve(e):this.getBookmarkInfo(t)).then(e=>{o.updateCurrentBookmarkElement(e)}),E},getBookmarkInfo:function(e){let t=o.getDefaultModelFromId(e),i=this.getAvailableBookmarkInfo(e),r=null;return i?r=Promise.resolve(i):d.isSection(e)?r=Promise.resolve(t):(r=new Promise((i,r)=>{D="authoring"!==m.getCurrentModeType()?n.fetch({ids:[e],select_predicate:["type","label","physicalid","ds6w:classification","mxid"],onComplete:e=>{e.results.length>0&&(e.results[0].attributes.forEach(e=>{t[e.name]=e.value}),t.id=t.physicalid,t.folderClassification=t["ds6w:classification"]?t["ds6w:classification"].toUpperCase():"",t.isPersonal="Personal"===t["ds6w:classification"],t.isFavorite="FolderSection_favorite"===o.getCurrentBookmarkSection()),i(t)},onFailure:r}):n.getFolderProperties({pid:e,type:"json",onComplete:e=>{if(e){for(var n in e)t[n]=e[n];t.physicalid=t.id,t.isPersonal=t.folderClassification,t.isFavorite="FolderSection_favorite"===o.getCurrentBookmarkSection()}i(t)},onFailure:r})})).finally(()=>D=null),r},getAvailableCurrentBookmarkInfo:function(){return this.getAvailableBookmarkInfo(o.getCurrentBookmarkId())},getAvailableBookmarkInfo:function(e){let t=null,o=u.getTreeCont();return o&&(t=o._getVisibleNodeById(e)),t},getAvailableCurrentBookmarkPath:function(){let e=null,t=u.getTreeCont();return t&&(e=t.getExistingBookmarkPath()),e},getCurrentBookmarkPath:function(){let e=null,t=o.getCurrentBookmarkId(!0);if(t){let o=this.getAvailableCurrentBookmarkPath();e=o?Promise.resolve(o[t]):this.getBookmarkPathSoft(t)}return e},getBookmarkPathSoft:function(e){return e?new Promise(t=>{F([e]).then(o=>{t(o[e])}).catch(o=>{console.log(o);let n={title:C.NoPathFound,className:"error"};o?(n.message=o.message?o.message:o.toString(),c.displayNotification(n)):b.displayNotFoundBk(e),t()})}):Promise.resolve([])},getBookmarksPath:function(e){let t=[];if(1===e.length){let o=e[0],n=I[o];n||((I=I||{})[o]=n=F(e)),t.push(n)}else for(let o=0;o<e.length;o+=100){let n=F(e.slice(o,o+100));t.push(n)}return new Promise((e,o)=>{Promise.all(t).then(t=>{let o={};t.forEach(e=>{o={...o,...e}}),e(o)}).catch(o)})},addExternalLink:function(e){return n.addExternalLink({id:e.id,urlTitle:e.urlTitle,url:e.url})},getExternalLinks:function(e){return n.getLinks(e)},editExternalLink:function(e){return n.editLink(e)},getlinkProperties:function(e){return n.getlinkProperties(e)},AddContent:function(e){if(e.IDs.length>0){var t=e.folderId?e.folderId:o.getCurrentBookmarkId();t&&t.length?"external"!==e.IDs.key?n.addcontent({pid:t,IDs:e.IDs}).then(t=>{if(t&&t.error){var o=t.error;console.log("AddContent WebService Err : "+o),o.length>200&&(o=null),t.information&&c.displayNotification({message:t.information,className:"primary"}),e.callbacks.onFailure(t.advice?t:o)}else m.switchtoAuthoringMode(),e.callbacks.onComplete(t)}).catch(e.callbacks.onFailure):n.addExternalObject({objects:e.IDs,id:t}).then(t=>{m.switchtoAuthoringMode(),e.callbacks.onComplete({objectsAdded:t.results.length,objectsAlreadyPresent:t.objectsAlreadyPresent?t.objectsAlreadyPresent:0})}).catch(e.callbacks.onFailure):e.callbacks.onFailure(e)}else e.callbacks.onFailure(e)},RemoveContent:function(e){if(e.IDs.length>0){var t=1==e.isLinkedFolder,i=e.folderId?e.folderId:o.getCurrentBookmarkId();i&&i.length?"external"!==e.IDs.key?n.removecontent({pid:i,IDs:e.IDs,isLinkedFolder:t,onComplete:function(t){var o=t;if(o&&o.error){var n=o.error;console.log("Remove WebService Err : "+n),n.length>200&&(n=null),e.callbacks.onFailure({error:n,networkErr:!1})}else e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure}):n.removeExternalLink({members:e.IDs.map(e=>e.getAttributeValue("links")[0].id),id:i}).then(t=>{let o=t.notExist.length,n=e.IDs.length-o;e.callbacks.onComplete({NumberOfContentRemoved:n,NumberOfContentNotRemoved:o})}).catch(e.callbacks.onFailure):e.callbacks.onFailure(e)}else e.callbacks.onFailure(e)},expandProducts:function(e){if(m.switchtoAuthoringMode(),e.IDs.length>0){o.getCurrentBookmarkId()?n.listContent_ExpandLevel_Structures({pid:e.IDs,onComplete:function(t){var o=[];if(t&&t.errors){var n=t.errors[0].reason;console.log("expand WebService Err : "+n),n.length>200&&(n=null),e.callbacks.onFailure(n)}else{for(var i=t.results,r=0;r<i.length;r++)i[r].resourceid&&null==i[r].from&&o.push(i[r].resourceid);e.callbacks.onComplete(o)}},onFailure:e.callbacks.onFailure}):e.callbacks.onFailure(e)}else e.callbacks.onFailure(e)},MoveContent:function(e){if(e.IDs.length>0){var t=e.targetfolder?e.targetfolder||e.targetfolder:"",o=e.sourcefolder?e.sourcefolder||e.targetfolder:"";t&&t.length&&o&&o.length?"external"!==e.IDs.key?n.movecontent({pid:t,IDs:e.IDs,SourceFolderId:o,onComplete:function(t){if(m.switchtoAuthoringMode(),t&&t.error){var o=t.error;console.log("MoveContent WebService Err : "+o),o.length>200&&(o=null),e.callbacks.onFailure(o)}else e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure}):n.moveExternalObject({members:e.IDs.map(e=>e.getAttributeValue("links")[0].id),id:t}).then(t=>{m.switchtoAuthoringMode(),e.callbacks.onComplete({objectsMoved:t.contents.length,objectsAlreadyPresent:t.objectsAlreadyPresent})}).catch(e.callbacks.onFailure):e.callbacks.onFailure(e)}else e.callbacks.onFailure(e)},MoveFolder:function(e){m.switchtoAuthoringMode();var t=e.targetfolder,o=e.sourcefolder,i=t?t.getID():"";o&&o.id;i.length&&e.IDs.length?n.movefolder({PhysicalId:e.IDs,TargetPhysicalId:i,onComplete:function(t){var o=t?JSON.parse(t):void 0;if(o&&o.error){var n=o.error;console.log("MoveFolder WebService Err : "+n),n.length>200&&(n=null),e.callbacks.onFailure(o.advice?o:n)}else e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure}):e.callbacks.onFailure(e)},CheckCopyFolder:function(e){var t=e.sourcefolder,o=(t&&t.id,a.getSetting("pad_security_ctx"));e.IDs.length?n.checkCopyfolder({PhysicalId:e.IDs,SecurityContext:o,onComplete:function(t){parseInt(t)>200?e.callbacks.onFailure(t):e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure}):e.callbacks.onFailure(e)},isSourceAndTargetTypeSame:function(t,o){let n=!0;if(!t||!o)return n;if(e.is(t,"array")){if(!(t.length>0))return n;t=t[0]}return d.isFolder(t.getType())&&"FolderSection_AllFolders"===o.getType()?n=!1:d.isRootFolder(t.getType())&&"FolderSection_AllFolders"!==o.getType()&&(n=!1),n},CopyFolder:function(e){m.switchtoAuthoringMode();var t=e.targetfolder,o=t?t.getID():"";o&&"FolderSection_AllFolders"!==o||(o="null");var i=a.getSetting("pad_security_ctx");o.length&&e.IDs.length?n.copyfolder({PhysicalId:e.IDs,TargetPhysicalId:o,SecurityContext:i,withContent:e.withContent,prefix:e.prefix,suffix:e.suffix,onComplete:function(t){var o=t?JSON.parse(t):void 0;if(o&&o.error){var n=o.error;console.log("CopyFolder WebService Err : "+n),n.length>200&&(n=null),e.callbacks.onFailure(o.advice?o:n)}else e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure}):e.callbacks.onFailure(e)},downloadFiles:function(e){var t=s.get3DSpaceUrl(),o=a.getSetting("pad_security_ctx"),n=u.getContent().getSelectedNodes();require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/CoreEvents/ModelEvents","DS/DocumentCommands/V2/Actions/Download"],function(e,i,r){e.getPlatformServices({platformId:g.getTenantID(),onComplete:function(e){l.getDocuments(n.map(e=>e.getID()),{tenant:g.getTenantID(),securityContext:o,tenantUrl:t,onComplete:function(t){if(t.success){if(!Array.isArray(t.data))return;var o={fetchSecurityContext:function(){return a.getSetting("pad_security_ctx")},getWorkUnderHeaders:function(){},getSelectedNodes:function(){return t.data},getDocumentFromNodeModel:function(e){return e},platformUrls:e,events:new i,isFromContextMenu:!0};o.events.subscribe({event:"docv2-show-notification"},function(e){var t={title:e.title,subtitle:e.subtitle,message:e.message,className:e.level};c.displayNotification(t)});new r(o);r.execute({options:o})}}})},onFailure:function(e){console.log(e)}})})},previewFile:function(e){},FolderUpload:function(e){var t=s.get3DSpaceUrl(),n=widget.widgetDomain,i=widget.getPreference("pad_security_ctx").value.split("."),r=i[i.length-1],l=e.id,d=e.lable,c=(e={fetchSecurityContext:function(){return a.getSetting("pad_security_ctx")},fetchCollabSpaceDisplayName:function(){return r},platformUrls:{"3DSpace":t,"3DDashboard":n,platformId:g.getTenantID()}},new h(e)),u=f.getCommand("FolderUpload");c.events.subscribe({event:"operation-complete"},function(e){require("DS/FolderEditor/views/FolderMode").switchtoAuthoringMode();var t=o.getCurrentBookmarkId();e.parentId==t&&(v.refreshWidgetContent(),console.log("After Completion of the Command..."))}),c.events.subscribe({event:"enable-folder-upload-command-in-ui"},function(e){u.enable()}),c.events.subscribe({event:"disable-folder-upload-command-in-ui"},function(e){u.disable()}),c.openFolderPicker(l,d)},AddShortcut:function(e){n.AddBookmarkShortcut({ObjetcID:e.id,TargetFolderID:e.targetID,onComplete:function(t){console.log(t),e.callbacks.onComplete(t)},onFailure:function(t,o,n){e.callbacks.onFailure(t,o,n)}})},FolderDownload:function(t){return new Promise((o,i)=>{var r=new Date,s="Folder Download Start Command : "+r.getHours()+":"+r.getMinutes()+":"+r.getSeconds();console.log("NI4 : "+s),n.DownloadFolderStructure({pid:t.id,onComplete:function(t){o();var n=new Date,i="Request Ticket Complete Time: "+n.getHours()+":"+n.getMinutes()+":"+n.getSeconds();console.log("NI4 : "+i);var r=t?JSON.parse(t):void 0;if(r){if(r&&"success"==r.status){c.displayNotification({message:C.BookmarkDownload.BookmarkDownloadStarted,className:"success"});var s=(A.isInjected()||A.inject(document.body),T.isInjected()||T.inject(document.body),T.empty(),e.createElement("input",{name:"attachment",value:"true"}).inject(T),T);e.createElement("input",{name:r.ticketParamName,value:r.ticketExportStr}).inject(s),s.action=r.actionURL,s.submit()}if(r&&"failure"==r.status)if("LimitDocuments"==r.error)c.displayNotification({message:C.BookmarkDownload.BookmarkDownloadLimit,className:"warning"});else if("No_Documents"==r.error)c.displayNotification({message:C.BookmarkDownload.BookmarkNo_Documents,className:"warning"});else if("DocWithNOFileMultiFileFailure"==r.error){var a="";null!=r.msgMultiFile&&(a=C.BookmarkDownload.BookmarkDownloadMultiFileError+r.msgMultiFile),null!=r.msgNOFile&&(a+=C.BookmarkDownload.BookmarkDownloadNoFileError+r.msgNOFile),c.displayNotification({message:C.BookmarkDownload.DownloadStructureFailure+a,className:"error"})}else"DownloadStructureFailure"==r.error&&c.displayNotification({message:C.BookmarkDownload.DownloadStructureFailure,className:"error"})}},onFailure:function(e){o()}})})},replaceContent:function(e){var t=e.IDsRemoved.length;if(t===e.IDsAdded.length&&t>0){var i=o.getCurrentBookmarkId();i&&i.length?n.replaceContent({pid:i,IDsRemoved:e.IDsRemoved,IDsAdded:e.IDsAdded,onComplete:function(t){var o=t?JSON.parse(t):void 0;if(o&&o.error){var n=o.error;console.log("ReplaceContent WebService Err : "+n),n.length>200&&(n=null),o.information&&c.displayNotification({message:o.information,className:"primary"}),e.callbacks.onFailure(n)}else e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure}):e.callbacks.onFailure(e)}else e.callbacks.onFailure(e)},getlastversion:function(e){var t=e.objectsToTreat;n.getlastversion({objectsToTreat:t,onComplete:function(t){var o=t?JSON.parse(t):void 0;if(o&&o.error){var n=o.error;console.log("getlastversion WebService Err : "+n),n.length>200&&(n=null),o.information&&c.displayNotification({message:o.information,className:"primary"}),e.callbacks.onFailure(n)}else e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure})}}}),define("DS/FolderEditor/commands/tools/ImportCSVBookmarkPanel",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","UWA/Class/Options","DS/Logger/Logger","UWA/Class/Promise","DS/FolderEditor/Folder_CSO","DS/IPClassifyUtil/IPClassifyAlert","DS/UIKIT/Modal","DS/UIKIT/SuperModal","DS/UIKIT/Scroller","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","DS/UIKIT/Popover","DS/Tree/Tree","DS/TreeModel/TreeNodeModel","DS/WebappsUtils/WebappsUtils","DS/Foundation/CsvParser","i18n!DS/FolderEditor/assets/nls/ImportCSVBookmarkPanel","DS/FolderEditor/utils/FolderEditorcontrol","DS/Controls/ProgressBar","DS/UIKIT/Input/Text","DS/Windows/Panel","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/PADUtils/PADProbes","DS/PlatformAPI/PlatformAPI","css!DS/FolderEditor/FolderEditor.css","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/commands/tools/ImportCSVFilesUtils","DS/WidgetServices/WidgetServices","DS/FolderEditor/service/FolderServices","DS/PADUtils/PADWSAccess","DS/Controls/TooltipModel"],function(e,t,o,n,i,r,s,a,l,d,c,u,p,g,f,h,m,v,_,S,C,b,F,y,D,E,w,A,T,I,x,P,k,N,M,O){"use strict";var U=1e3,R=['"',"#","$","@","%","*",",","?","\\\\","<",">","\\[","\\]","|",":"],B=['"',"#","$","%","*",",","?","\\\\","<",">","\\[","\\]","|",":"],L=function(e,t){!0===t?e.addClassName("withBorder"):e.removeClassName("withBorder")},V=t.extend(n,o,{name:"ImportCSVBookmark",_logger:null,defaultOptions:{parent:null,renderTo:null,data:{level:0,name:1,description:2,aclOwner:3,aclSecurityContext:4,toModel:function(e){return{level:e[0].trim(),label:e[1].trim(),description:e[2].trim(),acl:{owner:""===e[3].trim()?"@BLANK@":e[3].trim(),securityContext:""===e[4].trim()?"@BLANK@":e[4].trim()}}}}},_droppableType:{"application/vnd.ms-excel":"csv","text/csv":"csv"},_isClosing:!0,_checkErrorRef:[],_currentFolderType:"",_currentFolder:null,_cancel:!1,_lv1SecCtxEmpty:!1,_browserLanguage:"",_mapSecurityContext:null,_errorTips:[],_errorReasons:null,init:function(t){var o=this;e.merge(t||{},o.defaultOptions);return o._browserLanguage=o.utils.getBrowserLanguage(),o._logger=i.getLogger(V),o._logger.log("init"),o._parent(t),o._mapSecurityContext={},new r(async function(t,n){o._currentFolder=await N.getCurrentBookmarkInfo(),o._currentFolderType=o._currentFolder?o._currentFolder.getType():void 0,M.getscandcollab({tenant:k.getTenantID(),onComplete:function(n){(e.is(n,"string")?JSON.parse(n):n).collabspaces.forEach(function(e){e.couples.forEach(function(t){o._mapSecurityContext[t.role.nls.trim()+"."+t.organization.name.trim()+"."+e.title.trim()]=t.role.name.trim()+"."+t.organization.name.trim()+"."+e.name.trim()})}),o.inject(widget.body),t(o)},onFailure:n})})},closeDialog:function(){this.dialog&&this.dialog.destroy()},_destroyErrorTips:function(){this._errorTips.forEach(function(e){e.destroy()}),this._errorTips=[]},clickCancelButton:function(){this._isClosing&&(this._cancel=!0,this._destroyErrorTips(),this.closeDialog())},buildTooltip:async function(e){var t=await N.getCurrentBookmarkPath(),o=" ";if(t&&t.length>0)for(var n="",i=t.length,r=0;r<i;r++)o+=n+t[r].label,n="\\";this.tips=new g({position:"bottom",target:e,body:o})},inject:function(){var t=this;t._logger.log("inject");var o=t._currentFolder?t._currentFolder.getLabel():"",n=widget.immersiveFrame,i=new e.Element("div",{html:'<div class="drop-csv"><input class="drop-csv-input" type="file" /><span class="drop-csv-label"><span class="fonticon fonticon-publish fonticon fonticon-2x"></span><p class="drop-csv-label-p"><span class="icon-label">'+S.Drop_Csv_File+'</span></p></span></div><div class="preview-csv"><div class="prev-csv-read"></div><div class="preview-csv-tree"><div class="preview-csv-tree-msg"></div></div></div>'});t.notifyArea=new F({className:"detailmsg",value:"",disabled:!0});var r=[{label:S.Label_Import,disabled:!0,role:WUXCustomButtonRoleEnum.Validate,emphasize:"primary",onClick:function(e){t.importButton.disabled=!0,t.execImportCSV()}},{label:S.Cancel,tooltipInfos:new O({shortHelp:S.Cancel_Tooltip}),role:WUXCustomButtonRoleEnum.Escape,onClick:function(e){t.clickCancelButton.call(t)}}],s=new E({immersiveFrame:n,title:S.Dialog_Title+o,width:450,height:215,resizableFlag:!0,customButtonsDefinition:r,identifier:"importCSVDialog",content:i,events:{onHide:function(){t._isClosing&&t.tips&&t.tips.destroy(),t.clickCancelButton.call(t)}}});window.top.dbg=s.elements._headerDiv;var a=s.elements._titleP;return t.notifyArea.inject(e.Element.getElement.call(s.getContent(),".wux-windows-dialog-footer"),"top"),e.Element.getElement.call(s.getContent(),".wux-windows-dialog-footer").prepend(new e.Element("div",{class:"csvstatus"})),this.buildTooltip(a),t.csvStatusArea=e.Element.getElement.call(s.getContent(),".csvstatus"),t.dialog=s,t.importButton=s.getCustomButtons()[0],t.cancelButton=s.getCustomButtons()[1],t.dropZone=e.Element.getElement.call(i,".drop-csv"),t.dropInput=e.Element.getElement.call(i,".drop-csv-input"),t.dropLabel=e.Element.getElement.call(i,".drop-csv-label"),t.dropLabelPara=e.Element.getElement.call(i,".drop-csv-label-p"),i.addClassName("dialog-csv"),i.setStyle("height","100px"),e.Element.getElement.call(s.getContent(),".wux-windows-window-content").setStyle("align-content","center"),t.droppable(t.dropZone),t},reset:function(){this._logger.log("reset"),this.filePreview&&this.filePreview.destroy(),this.tree=void 0,this.filePreview=void 0},_initProgress:function(e){this.progress&&this.progress.destroy(),this.csvStatusArea.empty(),this.progress=new b({shape:"circular",statusFlag:!1,emphasize:e,dislpayFlag:!1,displayStyle:"lite"}),this.progress.inject(this.csvStatusArea),this.progress.value=0},droppable:function(e){var t=this,o=0;function n(t){u.unmask(e),a.displayNotification({message:t,className:"error"}),e.addClassName("error"),setTimeout(function(){e.removeClassName("error")},U)}function i(o){var i=o.dataTransfer?o.dataTransfer.files:o.target.files;if(0===i.length)return!0;if(i.length>1)n(S.ErrorMsg_Drop_Multiple_File);else{var r=i[0].name.split(".");if(r.length<=1||"csv"!==r[r.length-1].toLowerCase())return console.warn("drop file:"+r[r.length-1].toLowerCase()),void n(S.ErrorMsg_Drop_File_Not_CSV);if(0===i[0].size)return n(S.ErrorMsg_Drop_File_Empty),!0;if(i[0].size>25600){var s=S.ConfirmMsg_Drop_File_Size_Large+" ("+P.formatBytes(i[0].size,2)+")";new d({renderTo:t.options.renderTo,events:{onShow:function(){t._isClosing=!1,t.dialog.hide()},onHide:function(){t._isClosing=!0,t.dialog.show()}}}).confirm(s,S.Label_Confirm_Title,function(o){o&&t._loadCsv(e,i[0])})}else t._loadCsv(e,i[0])}}t.dropInput.addEventListener("click",function(e){this.value=null,k.isReplayedODT()&&e.preventDefault()},!1),t.dropInput.addEventListener("change",i,!1),t.listeners={},t.listeners.clickable=t.dropInput.click.bind(t.dropInput),e.addEventListener("click",t.listeners.clickable),t.listeners.dragenter=function(e){L(this,!0),o++},e.addEventListener("dragenter",t.listeners.dragenter),t.listeners.dragleave=function(e){0===--o&&L(this,!1)},e.addEventListener("dragleave",t.listeners.dragleave),t.listeners.dragover=function(e){e.preventDefault()},document.addEventListener("dragover",t.listeners.dragover),t.listeners.drop=function(e){e.preventDefault();var t=e.dataTransfer.types;t&&((t.indexOf?-1!=t.indexOf("Files"):t.contains("Files"))&&i(e))},e.addEventListener("drop",t.listeners.drop)},_getOrCreateTreeContent:function(){var t=e.Element.getElement.call(this.dialog.getContent(),".preview-csv-tree");t.getElement(".tree-content")||e.createElement("div",{class:"tree-content"}).inject(t)},_loadCsv:function(t,o){if(!o.dontRead){var n=this;u.mask(t);var i=function(e){u.unmask(t),n.updateDroppedFile({name:o.name,size:o.size})};n._destroyErrorTips(),n._errorReasons=[],n.importButton.label=S.Label_Import,n.importButton.disabled=!0,n.reset(),L(t,!1),e.Element.getElement.call(n.dialog.getContent(),".wux-windows-window-content").setStyle("align-content","inherit");var s=e.Element.getElement.call(n.dialog.getContent(),".preview-csv-tree");s.setStyle("height","0px").setStyle("border","solid 0px"),s.empty(),this._getOrCreateTreeContent(),r.all([n._readFile(o)]).then(function(e){try{n._initProgress("info"),n.csvStatusArea.addClassName("active");var t=_.parse(e[0]+"\r\n");if(t.length>0){var o=t[0];o.length>0&&isNaN(o[0])&&t.splice(0,1)}r.all([n.checkLines(t),n.checkRemoteStatus(t)]).then(function(e){var o=e[0].concat(e[1]).sort(function(e,t){return Math.abs(e.linePos)!==Math.abs(t.linePos)?Math.abs(e.linePos)<Math.abs(t.linePos)?-1:1:Math.abs(e.pos)<Math.abs(t.pos)?-1:1}).filter(function(e){return""!==e.reason});n._errorReasons=o,n._prepareImportData(t,o,i)})}catch(e){handleError(e.message)}})}},_prepareImportData:function(t,o,n){var i,s=this,l=0===o.length;i=l?t:[],s.tree&&s.tree.destroy();var d=s._createTreeView(),u=s._createTreeModel(i);d.getDocument().addRoot(u),s.tree=d,s.root=u,r.all([s.resolveSecurityContextOfSelectedFolder(s.root),s._showPreview(d),s._getStructure(u.options.id,u.options.label,0,u)]).then(function(e){var o=e[0];e[1],e[2];u.options.appData.acl.securityContext=o;var n=s.root.getAllDescendants().filter(function(e){return e.options.appData.hasId});if(l){var i=t.length-n.length;if(0===i)return s.notifyMessage("info",S.InfoMsg_Create_Target_Size_Zero),s.cancelButton.label=S.Close,s.importButton.label=S.Label_Import+"(0)",void(s.importButton.disabled=!0);if(null===o&&s._lv1SecCtxEmpty)return a.displayNotification({message:S.WarnMsg_SecurityContext_MissMatch,className:"warning"}),s.cancelButton.label=S.Close,s.importButton.label=S.Label_Import+"(0)",void(s.importButton.disabled=!0);s.importButton.disabled=!1,s.importButton.label=S.Label_Import+"("+i+")"}}).catch(function(e){a.displayNotification({message:S.ErrorMsg_Rest_Error+(e&&e.message?" "+e.message:""),className:"error"})}),n(d);var p=o.map(function(e){return Math.abs(e.linePos)}).filter(function(e,t,o){return o.indexOf(e)===t}).length,f=t.length-p,h=e.Element.getElement.call(s.dialog.getContent(),".tree-content");if(l)s.notifyMessage("info","["+f+"/"+t.length+"] "+S.InfoMsg_Load_Csv_Success),s.csvStatusArea.removeClassName("active");else{s.notifyMessage("error","["+f+"/"+t.length+"]"+S.InfoMsg_Load_Csv_Error),s.progress.emphasize="high-attention",h.addClassName("csverror");var m=[S.Label_Column_Level,S.Label_Column_Name,S.Label_Column_Description,S.Label_Column_Owner,S.Label_Column_SecurityContext];o.forEach(function(o){var n=Math.abs(o.linePos),i=(s.options.data,e.createElement("div",{text:" ("+S.Label_LineNumber+":"+(n+1)+") "+o.reason,class:"errorline icon"+o.pos}));if(h.appendChild(i),o.pos){var r;r=m[o.pos]+" : "+t[n][o.pos];var a=new g({position:"bottom",target:i,body:P.Sanitize.encode(r)});s._errorTips.push(a)}})}new c({element:h}),h.addClassName("csvshow")},undroppable:function(e){this.listeners&&(e.removeEventListener("click",this.listeners.clickable),e.removeEventListener("dragenter",this.listeners.dragenter),e.removeEventListener("dragleave",this.listeners.dragleave),e.removeEventListener("dragover",this.listeners.dragover),e.removeEventListener("drop",this.listeners.drop),this.listeners=null),e.setStyle("cursor","default"),this.dropLabel.setStyle("cursor","default"),e.addClassName("drop-disabled")},updateDroppedFile:function(t){var o=this;o.dialog.width=450,o.dialog.height=350;var n=e.createElement("span",{class:"csv-file",html:'<span class="csv-file-image"></span><span class="csv-file-name">'+t.name+" ("+P.formatBytes(t.size,2)+")</span>"});o.filePreview=n,o.dropLabel.setStyle("font-size","10px").setStyle("top","-5px").setStyle("float","right").setStyle("text-align","center"),o.dropZone.setStyle("height","40px").setStyle("border","initial").setStyle("cursor","pointer");var i=e.Element.getElement.call(o.dropLabelPara,".icon-label");i.textContent=S.Change_Csv_File;var r=e.Element.getElement.call(o.dialog.getContent(),".preview-csv-tree");r.setStyle("height","calc(100% - 100px)"),r.setStyle("border","1px solid #e2e4e3").setStyle("top","75px"),this._getOrCreateTreeContent(),setTimeout(function(){if(n.inject(o.dropLabel,"before"),o.undroppable(o.dropZone),!o.iconZone&&(o.iconZone=e.Element.getElement.call(o.dropZone,".fonticon"),o.iconZone)){o.iconZone.setStyle("cursor","pointer");var t=o.dropInput.click.bind(o.dropInput);o.iconZone.addEventListener("click",t,!1);var r=i;r.setStyle("cursor","pointer"),r.addEventListener("click",t,!1)}},U/3)},_readFile:function(e){var t=this,o=new FileReader;return new r(function(n,i){o.onload=function(e){n(e.target.result)},o.readAsText(e,"ja"===t._browserLanguage?"Shift-JIS":"WINDOWS-1252")})},checkLines:function(e){var t=this;return new r(function(o,n){var i=A.createProbe("ImportCSV_checklines"),r=t.options.data,s=0,a="",l=[{}],d={},c=[],u=!0,p=new RegExp("^-*[0-9]+$");t._checkErrorRef=c;for(var g=k.isReplayedODT()?1:-1,f=0;f<e.length;f++){var h={reason:"",data:[],linePos:-1,pos:-1},m=e[f];if(m.length<5)h.reason=S.ErrorMsg_Column_Count,h.linePos=f,h.pos=null,c.push(h);else{if(u&&s>=0){h.pos=r.level;var v=m[r.level];if(!p.test(v)){h.reason=S.ErrorMsg_Level_Is_Not_Number,h.linePos=f*g,c.push(h),s=h.linePos,u=-1!==g;continue}if((v=parseInt(v))<=0){h.reason=S.ErrorMsg_Level_Origin,h.linePos=f*g,c.push(h),s=h.linePos,u=-1!==g;continue}if(!(s>=v||s+1===v)){h.pos=r.level,h.reason=S.ErrorMsg_Level_Is_Not_Sequencial,h.linePos=f*g,c.push(h),s=h.linePos,u=-1!==g;continue}if(s>=v)for(var _=s-v,C=0;C<_;C++)l.pop();if(a=m[r.name],l.length+1===v&&l.push({}),d=l[v-1]){if(d[a]){h.pos=r.name,h.reason=S.ErrorMsg_Name_Duplicate,h.linePos=f,s=v,c.push(h);continue}d[a]=!0}s=v}if(h.pos=r.name,""!==(a=m[r.name]).trim())if(P.getStringByte4UTF8(a)>=127)h.reason=S.ErrorMsg_Name_Max_Over,h.linePos=f,c.push(h);else{var b=R.join(""),F=new RegExp("["+b+"]");a=P.removeControllCode(a),m[r.name]=a,h.pos=r.description;var y=m[r.description];if(y.length>1024)h.reason=S.ErrorMsg_Desc_Max_Over,h.linePos=f,c.push(h);else{var D=F.exec(y);D?(h.reason=S.ErrorMsg_Avoid_Char+"("+D.map(function(e){return e}).join("&nbsp;")+")",h.linePos=f,c.push(h)):(y=P.escapeControllCode(y),m[r.description]=y)}}else h.reason=S.ErrorMsg_Name_Required,h.linePos=f,c.push(h)}}i.end(),o(c)})},checkRemoteStatus:function(e){var t=this;return new r(function(o,n){var i=A.createProbe("ImportCSV_checkRemoteStatus"),s=t.options.data,a={listeners:{}},l=[];t.csvStatusArea.addClassName("active"),t._lv1SecCtxEmpty=!1;var d=R.join(""),c=B.join(""),u=new RegExp("["+d+"]"),p=new RegExp("["+c+"]"),g=0,f=0,h=t.listSecurityContext(),m=-1;e.forEach(function(n,d){if(n.length<5)for(var c=n.length;c<5;c++)n.push("");var v={reason:"",data:[],linePos:-1,pos:-1};f++;var _=n[s.aclOwner];_=_.trim();var C=[],b=null;if(b=r.resolve(!0),0!==_.length){var F=p.exec(_);switch(!0){case P.getStringByte4UTF8(_)!==_.length:v.pos=s.aclOwner,v.reason=S.ErrorMsg_Owner_Is_Not_Ascii,v.linePos=d,l.push(v),b=r.resolve("NOCHECK");break;case null!==F:v.pos=s.aclOwner,v.reason=S.ErrorMsg_Avoid_Char+"("+F.map(function(e){return e}).join("&nbsp;")+")",v.linePos=d,l.push(v),b=r.resolve("NOCHECK");break;default:v.pos=s.aclOwner,b=t._checkOwner(d,_,a)}}C.push(b),v={reason:"",data:[],linePos:-1,pos:-1};var y=n[s.aclSecurityContext].trim();if(b=r.resolve(!0),0!==y.length)switch(F=u.exec(y),!0){case 3!==y.split(".").length:v.pos=s.aclSecurityContext,v.reason=S.ErrorMsg_SecCtx_Is_Invalid,v.linePos=d,l.push(v),b=r.resolve("NOCHECK");break;case null!==F:v.pos=s.aclSecurityContext,v.reason=S.ErrorMsg_Avoid_Char+"("+F.map(function(e){return e}).join("&nbsp;")+")",v.linePos=d,l.push(v),b=r.resolve("NOCHECK");break;default:v.pos=s.aclSecurityContext,b=t._checkSecurityContext(d,y,h)}else"1"===n[s.level].trim()&&(t._lv1SecCtxEmpty=!0);C.push(b);var D=d+"";r.all(C).then(function(o){if(!0===o[0]&&!0===o[1]&&0===t._checkErrorRef.filter(function(e){return Math.abs(e.linePos)===parseInt(D)}).length){var n=++g/e.length*100;m!==n&&(t.progress.value=n,m=n)}return o}).then(function(e){var t=null,r=null;e[0]||(t=S.ErrorMsg_Rest_Error,!1===e[0]&&(t=S.ErrorMsg_Owner_Does_Not_Exist)),t&&(r={reason:t,data:n,linePos:d,pos:s.aclOwner},l.push(r)),t=null,!1===e[1]&&(t=S.ErrorMsg_SecCtx_Does_Not_Exist),t&&(r={reason:t,data:n,linePos:d,pos:s.aclSecurityContext},l.push(r)),0===--f&&(i.end(),o(l))})})})},_createTreeModel:function(e){var t=this.options.data,o=[],n=A.createProbe("ImportCSV_createTreeModel"),i=new m({id:this._currentFolder.id,label:this._currentFolder.getLabel(),level:0,appData:{acl:{}},icons:[v.getWebappsAssetUrl("FolderEditor","icons/foldersectionall.png")]});return o.push(i),e.forEach(function(e){var n=t.toModel(e);n.hasId=!1;var i=new m({level:n.level,label:n.label,appData:n,icons:[v.getWebappsAssetUrl("FolderEditor","icons/folder.png")]}),r=n.level;o[r]=i,o[r-1].addChild(i)}),n.end(),i},_createTreeView:function(){var t={apiVersion:2,height:"auto",position:"relative",width:"auto",isEditable:!1,isSortable:!1,manageHeight:!1,selection:{toggle:!1,canMultiSelect:!1,unselectAllOnEmptyArea:!1,nodes:!1,rowHeaders:!1}};return this.dialog.height=323,new h(t).inject(e.Element.getElement.call(this.dialog.getContent(),".preview-csv-tree"))},notifyMessage:function(e,t){this.notifyArea.setValue(t),this.notifyArea.setClassName("detailmsg show "+e)},_showPreview:function(t){var o=this;return new r(function(n,i){!function i(){null!==e.Element.getElement.call(o.dialog.getContent(),".wux-scroller")?(setTimeout(function(){t.getDocument().expandAll(),u.unmask(e.Element.getElement.call(o.dialog.getContent(),".preview-csv-tree"))},U/10),n(t)):setTimeout(function(){i()},U/10)}()})},_getStructure:function(e,t,o,n){var i=this;return new r(function(t,s){var a=A.createProbe("ImportCSV_getStructure"),l={onComplete:function(e){for(var s={},l=[],d=(e=JSON.parse(e)).folders,c=n.getChildren()||[],u=c.map(function(e){return e.getLabel()}),p=0;p<d.length;p++){var g=d[p],f=o+1,h={id:g.id,label:g.label,level:o+1};s[g.label]=h;var m=u.indexOf(g.label);if(-1!=m){var _=c[m];_.options.id=g.id,_.options.icons=[v.getWebappsAssetUrl("FolderEditor","icons/foldersectionall.png")],_.options.appData.hasId=!0,_.options.appData.modified=new Date(Date.parse(g.modified)),_.options.appData.acl.securityContext=i.resolveCurrentSecurityContextBy(g.organizationResponsible,g.project),_.updateOptions("icons"),l.push(i._getStructure(g.id,g.label,f,_))}}r.all(l).then(function(e){t(s),a.end()})},onFailure:function(e){var t;(t=n).options.icons=[v.getWebappsAssetUrl("FolderEditor","icons/folder_ng.png")],t.updateOptions("icons"),s(n.options.label),a.end()}};0===o&&"FolderSection_AllFolders"===i._currentFolderType?(l.isRoot=!0,l.isPersonalFolder=!1,x.folderTree(l)):0===o&&"Personal Workspace"===i._currentFolderType?(l.pid=e,l.isRoot=!0,l.isPersonalFolder=!0,x.folderTree(l)):(l.pid=e,l.isPersonalFolder=!1,l.isRoot=!1,x.folderTree(l))})},resolveSecurityContextOfSelectedFolder:function(t){var o=this;return new r(function(n,i){var r=A.createProbe("ImportCSV_resolveSecurityContextOfSelectedFolder");"FolderSection_AllFolders"!==t.options.id?x.getFolderProperties({pid:t.options.id,onComplete:function(i){e.is(i,"string")&&(i=JSON.parse(i)),t.options.appData.acl.securityContext=o.resolveCurrentSecurityContextBy(i.organizationResponsible,i.project),n(t.options.appData.acl.securityContext),r.end()},onFailure:function(e){t.options.icons=[v.getWebappsAssetUrl("FolderEditor","icons/folder_ng.png")],t.updateOptions("icons"),i({type:"check",message:"("+t.options.label+")",raw:e}),r.end()}}):(t.options.appData.acl.securityContext=o.utils.getCurrentSecurityContext(),n(t.options.appData.acl.securityContext),r.end())})},resolveCurrentSecurityContextBy:function(e,t){var o=this.utils.getCurrentSecurityContext(),n=o.split("."),i=n[1],r=n[2];return i===e&&r===t?o:(this._logger.warn("can't resolve securityContext : "+e+"."+t),null)},execImportCSV:function(){var e=this,t=A.createProbe("ImportCSV_execImportCSV");e._cancel=!1,e._initProgress("success"),e.csvStatusArea.addClassName("active");for(var o=e.root.getAllDescendants(),n=[],i=0,s=0;s<o.length;s++){var l,d=o[s];d.options.appData.hasId?(l=e.getFolder(d),i++):l=e.createFolder(d),n.push(l)}var c=0,u=null,p=n.length-i;n.reduce(function(t,o){return t.then(function(t){e.progress.value=c/p*100,e.notifyMessage("info","["+c+"/"+p+"] "+S.InfoMsg_Folder_Creating),"create"===t.type&&c++}).then(o)},r.resolve({type:"dummy"})).catch(function(e){u=e.message||e}).then(function(o){e.cancelButton.label=S.Close,C.getContent().loadContentAndSelect(e._currentFolder),C.getTreeCont().updateTreeWithNewFolder(e._currentFolder),null===u?(e.progress.value=100,e.notifyMessage("info","["+p+"/"+p+"] "+S.InfoMsg_Folder_Create_Success),e.csvStatusArea.removeClassName("active"),a.displayNotification({message:S.InfoMsg_Folder_Create_Success,className:"success"})):(e.notifyMessage("error","["+c+"/"+p+"] "+S.ErrorMsg_Folder_Create_Stoped),e.progress.emphasize="high-attention",a.displayNotification({message:u,className:"error"})),t.end()})},createFolder:function(e){var t=this;return function(){return new r(function(o,n){if(t._cancel)return t._logger.log("Import operation canceled"),void n({type:"create",message:S.ErrorMsg_Folder_Create_Stoped,raw:""});var i;if(null!==(i="@BLANK@"!==e.options.appData.acl.securityContext?e.options.appData.acl.securityContext:e.getParent().options.appData.acl.securityContext)&&(t._mapSecurityContext[i]&&(i=t._mapSecurityContext[i]),e.options.appData.acl.securityContext=i),widget.odtWrongCtx||null===i)return e.options.icons=[v.getWebappsAssetUrl("FolderEditor","icons/folder_ng.png")],e.updateOptions("icons"),void n({type:"create",message:S.WarnMsg_SecurityContext_MissMatch,raw:""});let r=e.getParent().options.id;x.newFolder({parentBookmarkId:"FolderSection_AllFolders"!==r?r:null,forcedSecurityContext:i}).then(t=>{var i=[v.getWebappsAssetUrl("FolderEditor","icons/folder_ok.png")];if(null===t||t.error||!t.results||0===t.results.length){e.options.icons=[v.getWebappsAssetUrl("FolderEditor","icons/folder_ng.png")],e.updateOptions("icons");var r=t&&t.message?t.message:S.ErrorMsg_Folder_Create_Stoped;return void n({type:"create",message:r,raw:t})}var s={Title:e.options.appData.label,description:e.options.appData.description};"@BLANK@"!==e.options.appData.acl.owner&&(s.owner=e.options.appData.acl.owner);var a=t.results[0].physicalid;x.setFolderProperties({pid:a,properties:s,onComplete:function(t){e.options.id=a,e.options.icons=i,e.updateOptions("icons"),o({type:"create",message:null,raw:t})},onFailure:function(t){var o=function(){e.options.icons=[v.getWebappsAssetUrl("FolderEditor","icons/folder_ng.png")],e.updateOptions("icons"),n({type:"create",message:S.ErrorMsg_Bookmark_Create_Stoped_SetProperties,raw:t})};x.deleteFolder({pid:a,forcedSecurityContext:widget.getPreference("pad_security_ctx").value,onComplete:o,onFailure:o})}})}).catch(t=>{e.options.icons=[v.getWebappsAssetUrl("FolderEditor","icons/folder_ng.png")],e.updateOptions("icons"),n({type:"create",message:S.ErrorMsg_Rest_Error+"("+e.options.label+")",raw:t})})})}},getFolder:function(t){return function(){return new r(function(o,n){x.getFolderProperties({pid:t.options.id,onComplete:function(i){e.is(i,"string")&&(i=JSON.parse(i)),new Date(Date.parse(i.modified)).getTime()!==t.options.appData.modified.getTime()?(t.options.icons=[v.getWebappsAssetUrl("FolderEditor","icons/folder_ng.png")],t.updateOptions("icons"),n({type:"check",message:S.ErrorMsg_Exist_Folder_Modified+"("+t.options.label+")",raw:i})):o({type:"check",message:null,raw:i})},onFailure:function(e){t.options.icons=[v.getWebappsAssetUrl("FolderEditor","icons/folder_ng.png")],t.updateOptions("icons"),n({type:"check",message:S.ErrorMsg_Rest_Error+"("+t.options.label+")",raw:e})}})})}},_checkOwner:function(t,o,n){var i=this;return new r(function(t,r){var s=""===o||n[o];if(s)t(s);else{var a=void 0!==n.listeners[o],l=n.listeners[o]||[];l.push(t),n.listeners[o]=l,a||x.personSearch({name:o,onComplete:function(t){if((t=e.is(t,"string")?JSON.parse(t):t).data.length>0){let e=!1;for(let{dataelements:{name:o}}of t.data)if(o===this.name){e=!0;break}l.forEach(t=>{t(e)}),n[this.name]=e}else l.forEach(function(e){e(!1)}),n[this.name]=!1},onFailure:function(e){!0,i._logger.log("response error personSearch "),l.forEach(function(e){e(null)})}})}})},listSecurityContext:function(){var e=[],t=widget.getPreference("pad_security_ctx");if(t){var o=t.options;Array.isArray(o)&&o.forEach(function(t){t.value&&e.push(t.value.split("::")[1])})}return e},_checkSecurityContext:function(e,t,o){var n=this;return new r(function(e,i){return""===t||n._mapSecurityContext[t]?void e(!0):void e(-1!==o.indexOf(t))})},utils:{getCurrentSecurityContext:function(){var e=widget.getPreference("pad_security_ctx").value;return e.contains("ctx::")&&(e=e.split("::")[1]),e},getBrowserLanguage:function(){return k.getLanguage()}}});return V}),define("DS/FolderEditor/views/additionalColumns/FolderIsLastRevisionColumn",["UWA/Core","UWA/Class","DS/FolderEditor/service/FolderServices","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/PADServices/utils/GlobalUtils","DS/FolderEditor/utils/FolderSearch","DS/ApplicationFrame/CommandsManager","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/Folder_CSO"],function(e,t,o,n,i,r,s,a,l,d){"use strict";function c(e){return!l.inFamilyFolder(e.getType())&&"www"!==e.getAttributeValue("serviceId")}function u(e){return r.isSearchActive()||e.getDepth()>0||l.isExternalObject(e)}var p=t.singleton({init:function(e){this._parent(e)},isAdditionalColumnsAvailable:function(t){if(!1===e.is(t,"function"))throw new Error("A callback function should be defined");!function(e){var t={dataIndex:"isLastRevision",text:n.column_isLastRevision,width:100,minWidth:80,maxWidth:200,isHidden:!1,sortableFlag:!1,alignment:"center",typeRepresentation:"functionIcon",getCellSemantics:function(e){var t=e.nodeModel;let o=c(t);var n=u(t);return o&&void 0!==typeof t.options.grid.isLastRevision&&t.options.grid.isLastRevision.toString().length>0?"true"==t.options.grid.isLastRevision.toString().toLowerCase()?{icon:{iconClasses:"check wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check  dgv-lastversion-check"},disabled:n}:{icon:{iconClasses:"wrong wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong dgv-lastversion-wrong"},disabled:n}:{disabled:!0}},customisation:{dataIndex:"isLastRevision",exportable:{lock:!1,value:!0},layout:{removable:!1}}};p._columnDataIndex=["isLastRevision"],p._columnDef={isLastRevision:t},e()}(function(){t(!0)})},getName:function(){return"isLastRevision"},getManagedColumnNames:function(){return this._columnDataIndex},toBeUpdated:function(e,t){var o=!1;if(c(t))return void 0!==e.isLastRevision&&""!==e.isLastRevision||(o=!0),o},getOnCellClickCB:function(e,t){return!(e!==this.getName()||!t.target.className.contains("wux-button-icon-placeholder")&&!t.target.className.contains("wux-tweaker-function"))&&function(e){var t=e.nodeModel;if(!u(t)&&t.getDepth()<1&&!l.inFamilyFolder(t.getType())){var o=s.getCommand("UPSAuthReplaceByRevision",a.getContent());o.setNode(t),o&&o.begin()}}},updateAttributes:function(t,n){if(!1===e.is(t,"object"))throw new Error("The object ids to modify must be specify");if(!1===e.is(n,"function"))throw new Error("A callback function should be defined");var i=[];t.pids.forEach(function(e){var t={id:e};i.push(t)});var r={},s={lastVersionRequests:i};o.getlastversion({objectsToTreat:s,callbacks:{onComplete:function(e){JSON.parse(e).lastVersionRequests.forEach(function(e){var t=e.islast;r[e.id]={isLastRevision:t}});var t={pids:r};t=JSON.stringify(t),n(t)},onFailure:function(e){n({})}}})},getAdditionalColumnsUXDGV:function(t){for(var o=[],n=0;n<t.length;n++)o.push(t[n].dataIndex);for(var i=0;i<this._columnDataIndex.length;i++){var r=this._columnDataIndex[i],s=e.clone(this._columnDef[r]),a=o.indexOf(r);-1===a?t.push(s):t[a]=e.extend(t[a],s,!0)}}});return p}),define("DS/FolderEditor/models/xBookNodeModel",["DS/TreeModel/TreeNodeModel","DS/WebappsUtils/WebappsUtils","DS/FolderEditor/Folder_CSO","DS/PADServices/utils/GlobalUtils","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/PADServices/utils/AttributesMgtV2"],function(e,t,o,n,i,r){"use strict";var s={label:"",icons:[],grid:{},padgrid:{},resourceid:"",type:"",relationid:"",relationtype:"",relationOrder:-1,did:"",relcount:null,isPADHidden:!1,padstate:"collapsed",children:[],thumbnail:null,useAsyncPreExpand:!0,emptyStatusbarVisibleFlag:!0,contextualMenu:[{type:"SeparatorItem"}]},a=function(e){if(null!==(e.grid["ds6w:reserved"]?e.grid["ds6w:reserved"]:e.padgrid&&e.padgrid["ds6w:reserved"]?e.padgrid["ds6w:reserved"]:null)){let t=this.computeLockStatus(e);t.locked?(this.options.statusbarIcons=t.locked_by_me?["key"]:["lock"],this.options.statusbarIconsTooltips=[i.tooltip_reserved]):(this.options.statusbarIcons=["lock-open"],this.options.statusbarIconsTooltips=[i.tooltip_unreserved])}};function l(n){if(this.options=UWA.clone(s),n&&n.grid&&(this.options.subLabel=n.grid["ds6w:responsible"],this.options.description=n.grid["ds6w:identifier"],this.options.thumbnail=n.thumbnail?n.thumbnail:t.getWebappsAssetUrl("PADUtils","icons/32/I_DefaultThumbnail.png"),a.call(this,n),n.nodeAttrs&&n.nodeAttrs.isFavorite)){var i=n.favoriteTitle;this.options.statusbarIcons=[{label:i,icon:"favorite-on",emphasize:"primary"}]}n&&UWA.is(n.relcount)&&0===n.relcount&&(n.children=null),this.options=UWA.extend(this.options,n),this.options.grid.bi_color="rgba(0, 0, 0, 0)",this.options.grid.serviceId=this.options.grid.serviceId?this.options.grid.serviceId:"3DSpace",e.call(this,this.options),o.setInfoOnTreeNode(this)}l.prototype=Object.create(e.prototype);var d={getType:function(){return this.type||this.getAttributeValue("type")},getOccurencePath:function(e){if(UWA.is(e,"function")&&e(this),!0!==this.isRelationsObjectNode&&!this.isRoot()&&this.getParent()){var t=this.getParent().getOccurencePath(e);return t.push(this.options.relationid),t.push(this.options.resourceid),t}return[this.options.resourceid]},getOccurencePathWithType:function(){if(!this.isRoot()&&this.getParent()){var e=this.getParent().getOccurencePathWithType();return e.push({resourceid:this.options.relationid,type:this.options.relationtype}),e.push({resourceid:this.options.resourceid,type:this.options.type}),e}return[{resourceid:this.options.resourceid,type:this.options.type}]},getNodeByPath:function(e,t,o,n){if(("number"!=typeof t||t<0)&&(t=0),("number"!=typeof o||o<0||o>=e.length)&&(o=e.length-1),this.options.resourceid instanceof Array&&this.options.resourceid.indexOf(e[t])>=0||this.options.resourceid===e[t]){if(t!==o&&(this.isExpanded()||this.childComputed||void 0!==n&&!1!==n)){var i=e[t+1],r=this.getChildren();if(r&&0!==r.length){for(var s=null,a=0;a<r.length&&null===s;a++){var l=r[a];i===l.options.relationid&&(s=l)}return null===s?this:s.getNodeByPath(e,t+2,o,n)}return this}return this}},hasChildren:function(t){return e.prototype.hasChildren.call(this)||!!(t&&this.options._childrenFilterInfo&&this.options._childrenFilterInfo.filteredOutChildren.length)},getID:function(){return this.options.resourceid},getRelationID:function(){return!0===this.isRelationsObjectNode?null:this.options.relationid},getNodesById:function(e){var t={listOfFoundNodes:[]};return this._getNodesById(e,t),t.listOfFoundNodes},getChildByIds:function(e,t){var o,n=this.getChildren();if(n)for(var i=0;i<n.length;i++)if(void 0===e){if(n[i].getID()===t){o=n[i];break}}else if(n[i].getRelationID()===e){o=n[i];break}function r(o){var n;return void 0===e?o.getID()===t&&(n=o):o.getRelationID()===e&&(n=o),n}if(void 0===o&&void 0!==this.options._childrenFilterInfo&&this.options._childrenFilterInfo.filteredOutChildren&&this.options._childrenFilterInfo.filteredOutChildren.length>0)for(var s=this.options._childrenFilterInfo.filteredOutChildren,a=0;a<s.length;a++){var l=s[a];if(o=r(l))break;var d=l.getChildren();if(d)for(var c=0;c<d.length&&!(o=r(d[c]));c++);}return o},_removeFilterInfo:function(){delete this.options._filterInfo},_removeChildrenFilterInfo:function(){delete this.options._childrenFilterInfo},_getFilterInfo:function(e){return!this.options._filterInfo&&Boolean(e)&&(this.options._filterInfo={}),this.options._filterInfo},_getChildrenFilterInfo:function(e){return!this.options._childrenFilterInfo&&Boolean(e)&&(this.options._childrenFilterInfo={}),this.options._childrenFilterInfo},filterOut:function(){null!==(this.isRoot()?this.getTreeDocument():this.getParent())&&this.hide()},filterIn:function(e){if(this.isVisible()||this.show(),e){this.getChildren()&&this.getChildren().forEach(e=>{e.filterIn()})}},_getNodesById:function(e,t){var o=!1;if(this.getID()===e)"string"==typeof this.options.icons[0]&&(this.options.icons=[{iconPath:this.options.icons[0]}]),t.listOfFoundNodes.push(this),o=!0;else{var n=this.getChildren();if(n)for(var i=0;n&&i<n.length;i++)o=n[i]._getNodesById(e,t)||o}return o},updateAttributes:function(e,t){if(!UWA.is(e,"array")||!UWA.is(t,"array"))throw new Error("Invalid argument(s)");var o=t,n=t.tree?t.tree:r.getTreeColumn(),i={};e.forEach(function(e){UWA.is(e.value)&&UWA.is(e.value.replace,"function")&&(e.value=e.value.replace(/\\n/g," ")),"ds6w:type"===e.name&&(i.type=e.value),e.name===n?i.label=e.value:"type_icon_url"===e.name?(i.icons=[],i.icons.push(e.value)):"preview_url"===e.name||"thumbnail_2d"===e.name?(i.thumbnail=e.value,i.grid=i.grid?i.grid:{},i.grid.thumbnail="url("+e.value+")"):-1!==o.indexOf(e.name)&&(i.grid||(i.grid={}),i.grid[e.name]=e.value)}),this.updateOptions(i)},isDescendantOf:function(e){var t;if(t=e instanceof l?e.getID():e,this.getID()===t)return!0;if(!this.isRoot()){var o=this.getParent();if(o)return o.isDescendantOf(t)}return!1},getDepth:function(){for(var e=this,t=0;!e.isRoot();)e=e.getParent(),t++;return t},getLeaves:function(){var e=[];return this.processDescendants({processNode:function(){!1===this.hasChildren()&&e.push(this)}}),e},updateOptions:function(o){o.grid&&(this.options.thumbnail||o.thumbnail||(o.thumbnail=t.getWebappsAssetUrl("PADUtils","icons/32/I_DefaultThumbnail.png")),o.subLabel=o.grid["ds6w:responsible"]?o.grid["ds6w:responsible"]:this.options.grid&&this.options.grid["ds6w:responsible"]?this.options.grid["ds6w:responsible"]:"",o.description=o.grid["ds6w:identifier"]?o.grid["ds6w:identifier"]:this.options.grid&&this.options.grid["ds6w:identifier"]?this.options.grid["ds6w:identifier"]:"",a.call(this,o)),e.prototype.updateOptions.call(this,o)},childValidationChecker:function(){if(void 0===this.childValidationCheckerToken){this.childValidationCheckerToken=null;var e=this;this.childValidationCheckerToken=this.addEventListener("expandStateChange",function(t){"expanded"===t.data.state&&(e.removeEventListener(e.childValidationCheckerToken),e.withTransactionUpdate(function(){var t=e.getChildren().filter(function(e){return!0===e.options.waiting4validation});if(t.length>0)for(var o=0;o<t.length;o++)console.warn("NavNodeModel# Remove node to the unvalidated child "+JSON.stringify(t[o].getOccurencePath())),e.removeChild(t[o])}))})}},_isLockedByMe:function(e){var t=!0,o=e.grid["ds6w:reservedBy"]?e.grid["ds6w:reservedBy"]:e.padgrid&&e.padgrid["ds6w:reservedBy"]?e.padgrid["ds6w:reservedBy"]:"",n=e.grid["ds6w:displayName"]?e.grid["ds6w:displayName"]:e.padgrid&&e.padgrid["ds6w:displayName"]?e.padgrid["ds6w:displayName"]:"",i=require("DS/PADUtils/PADUtilsServices"),r=i.getUserLogin()?i.getUserLogin():"",s=i.getUserName()?i.getUserName():"";t=!0;return o.trim().length>0?(t=o.toUpperCase().trim()===r.toUpperCase().trim()||!1)||(t=o.toUpperCase().trim()===s.toUpperCase().trim()||!1):n.trim().length>0&&(t=s.toUpperCase().trim()===n.toUpperCase().trim()||!1),t},computeLockStatus:function(e){let t=e||this.options,o=!1,i=!1,r=t.grid["ds6w:reserved"]?t.grid["ds6w:reserved"]:t.padgrid&&t.padgrid["ds6w:reserved"]?t.padgrid["ds6w:reserved"]:"";var s=t.grid["ds6w:reservedBy"]?t.grid["ds6w:reservedBy"]:t.padgrid&&t.padgrid["ds6w:reservedBy"]?t.padgrid["ds6w:reservedBy"]:"",a=t.grid["ds6w:displayName"]?t.grid["ds6w:displayName"]:t.padgrid&&t.padgrid["ds6w:displayName"]?t.padgrid["ds6w:displayName"]:"";if(o="boolean"==typeof(r=Array.isArray(r)?r.indexOf("TRUE")>=0:r)?r:"TRUE"===r.toUpperCase()){var l=widget.userId||n.getUserLogin();l=l||"";var d=widget.fullName||n.getUserName();d=d||"",i=!0,s.trim().length>0?(i=s.toUpperCase().trim()===l.toUpperCase().trim()||!1)||(i=s.toUpperCase().trim()===d.toUpperCase().trim()||!1):a.trim().length>0&&(i=d.toUpperCase().trim()===a.toUpperCase().trim()||!1)}return{locked:o,locked_by_me:i,reserveBy:a||s}}};for(var c in d)l.prototype[c]=d[c];return l}),define("DS/FolderEditor/tagger/TaggerTreeProxy",["DS/PADServices/utils/GlobalModelEvents","DS/FolderEditor/service/FolderEditorWebService","DS/IPClassifyUXUtil/tagger/TaggerIPProxy","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/WidgetHandlerUtil","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,t,o,n,i,r,s){var a="tree_filter_v1";return r.createSingleton(class extends o{constructor(){var t=e.getModelEvents();super(t,{name:"Tree",onlyLocal:!0,exclude:!0,events:{addOpenTaggerListener:()=>{this._onOpenTagger()}}}),this.activate(!1);let o=r.getTreeTaggerPreference(a);this.setLocalFilter(o),t.subscribe({event:"filterUpdatedTree"},e=>{!function(e){r.setTreeTaggerPreference(a,e)}(this.getFilterTags())}),this._refreshNeeded=!0,i.onTaggerStatusChange(()=>{this.activate(r.isTreeTaggerActive())})}activate(e){super.activate(e),this.refresh(!0)}refresh(e){!this.isActive()||!this._refreshNeeded&&e?this._refreshNeeded=this._refreshNeeded||!e:(this.populateData(),this._refreshNeeded=!1)}_onOpenTagger(){this.refresh(!0)}removeFilters(){var e=this.getProxy().getCurrentFilter();e&&e.localfilters&&Object.keys(e.localfilters).length>0&&(this.getProxy().clearLocalFilter(),this.getProxy().dispatchEvent("onFilterChange",{localfilters:{}}),n.displayNotification({message:s.msg_info_treeFilterRemove,className:"primary"}))}populateData(){var e=this.getFilterTags();t.allBookmarks({filters:e||{},select_predicate:["physicalid"],onComplete:e=>{this.addTags(e)},onFailure:function(){console.error("Unable to update Content root node, Error in getting content Properties")}})}})}),define("DS/FolderEditor/service/BkOperationsUtils",["DS/IPClassifyUtil/IPClassifyAlert","DS/UIKIT/Mask","DS/ApplicationFrame/CommandsManager","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/service/FolderServices","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/Folder_CSO","DS/IPClassifyUXUtil/ProgressPaneExecution","i18n!DS/FolderEditor/assets/nls/FolderEditor"],(e,t,o,n,i,r,s,a,l)=>{function d(e){return e?"string"!=typeof e?Promise.resolve(e):i.getBookmarkInfo(e):i.getCurrentBookmarkInfo()}function c(t,o,n,i){i=i||"",0!==o?e.displayNotification({message:l.replace(l.msg_info_Addinfolder,{objectsAlreadyPresent:o,objectsAdded:n,targetfolder:t})+i,className:"success"}):e.displayNotification({message:l.replace(l.msg_info_Addinfolder_1,{objectsAdded:n,targetfolder:t})+i,className:"success"})}function u(o,i,r){var a=n.getContent();let d=s.getCurrentBookmarkId();if(a&&i&&d===i&&t.unmask(a._contentDiv),o&&o.advice)e.displayNotification({title:l[r],subtitle:o.advice,message:o.error,className:"error"});else if(o&&o.message&&o.message.contains("NetworkError")&&o.message.contains("500"))e.displayNotification({message:l.msg_error_objectNoLongerAccessible,className:"error"});else if("string"==typeof o&&o.contains("No modify access to relationship 'Vaulted Objects'"))e.displayNotification({message:l.msg_error_NoModifyAccess,className:"error"});else{let t={className:"error"};t.message=l[r],o&&(t.message=o,t.title=l[r]),e.displayNotification(t)}}function p(t){let o=[],n={space:[],external:[]};for(let e in n)n[e].key=e;let i={};t.forEach(t=>{let s="string"==typeof t?t:t.id;if(!i[s]){i[s]=!0;let a=r.isExternalObject(t)?"external":"space",d=n[a],c=s;if("space"!==a&&"object"!=typeof(c=t))throw e.displayNotification({...l.operationNotSupported,className:"error"}),"not supported";if(d.push(c),100===d.length){o.push(d);let e=[];e.key=a,n[a]=e}}});for(let e in n){let t=n[e];t.length>0&&o.push(t)}return{list:o,count:Object.keys(i).length}}return{processRemoveOperation:function(t,i,r){return new Promise(async s=>{if(t.length>0){let u=p(t),g=u.list;var c=o.getCommand("RemoveContent");c.disable();let f=await d(i),h=f.getLabel();a.execute({title:l.replace(l.progressPanel_remove,{objectsAdded:u.count,targetfolder:f.getLabel()}),datas:g,query:e=>this.removeContent(e,f.getID(),r)}).then(t=>{if(!r){let o=0,i=0;if(t.forEach(e=>{e&&void 0!==e.numberOfContentNotRemoved&&(o+=e.numberOfContentNotRemoved,i+=e.numberOfContentRemoved)}),0==i&&o>0)e.displayNotification({message:l.replace(l.msg_info_objetnotremoved,{number:o,foldername:h}),className:"success"});else if(0==o&&i>0)e.displayNotification({message:l.replace(l.msg_info_objetremoved,{number:i,foldername:h}),className:"success"});else if(o>0&&i>0){let t=l.replace(l.msg_info_objetremoved,{number:i,foldername:h})+" "+l.replace(l.msg_info_objetnotremoved,{number:o,foldername:h});e.displayNotification({message:t,className:"success"})}u.count>10&&(n.getContent().RefreshProductStructure=!0,n.getContent().loadContentAndSelect()),c.enable()}s(t)})}else e.displayNotification({message:l.msg_warning_nocontent,className:"warning"}),s()})},processAddOperation:async function(e,t){if(e.length>0){let o=e.length,i=p(e).list,r=await d(t),u=r.getLabel();a.execute({title:l.replace(l.progressPanel_add,{objectsAdded:o,targetfolder:u}),datas:i,query:e=>this.addContent(e,r)}).then(e=>{let t=0,o=0;e.forEach(e=>{e&&(t+=e.objectsAdded,o+=e.objectsAlreadyPresent)}),0==t&&0==o||c(u,o,t),s.getCurrentBookmarkId()==r.getID()&&(n.getContent().RefreshProductStructure=!0,n.getContent().loadContentAndSelect())})}},processMoveOperation:async function(t,o,i){if(t.length>0){let r=t.length,c=p(t).list,u=await d(i),g=u.getLabel();a.execute({title:l.replace(l.progressPanel_move,{objectsAdded:r,targetfolder:u.getLabel()}),datas:c,query:e=>this.moveContent(e,o,u.getID())}).then(t=>{let i=0,r=0;t.forEach(e=>{e&&(i+=e.objectsMoved,r+=e.objectsAlreadyPresent)}),0==i&&0==r||function(t,o,n){0!==o?e.displayNotification({message:l.replace(l.msg_info_objetmoved,{objectsAlreadyPresent:o,objectsMoved:n,targetfolder:t}),className:"success"}):e.displayNotification({message:l.replace(l.msg_info_objetmoved_1,{objectsMoved:n,targetfolder:t}),className:"success"})}(g,r,i);let a=s.getCurrentBookmarkId();a!=u.getID()&&a!=o||(n.getContent().RefreshProductStructure=!0,n.getContent().loadContentAndSelect())})}},moveContent:function(e,t,o){return new Promise(r=>{i.MoveContent({IDs:e,targetfolder:o,sourcefolder:t,callbacks:{onComplete:function(e){var o=0,i=0;e&&(o=e.objectsAlreadyPresent,i=e.objectsMoved),r({objectsMoved:i,objectsAlreadyPresent:o});var a=n.getContent(),l=s.getCurrentBookmarkId();if(a&&l&&l===t){var d=a.getPADTreeDocument();d&&d.keepExpandedState(),a.loadContentAndSelect()}},onFailure:function(e){r();let t=e.err||e.error||e;e&&e.serverErr&&e.serverErr.error&&"string"==typeof e.serverErr.error&&e.serverErr.error.length>0?u(e.serverErr.error,o,"msg_error_MoveInfolder"):("string"!=typeof t&&(t=t.toString()),u(t,o,"msg_error_MoveInfolder"))}}})})},addContent:function(e,t){return new Promise(async o=>{let n=await d(t),r={IDs:e,folderId:n.getID(),callbacks:{onComplete:function(e){var t=0,i=0,r=null;e&&(t=e.objectsAlreadyPresent,i=e.objectsAdded,r=e.information?" ("+e.information+")":r),o(r?null:{objectsAdded:i,objectsAlreadyPresent:t}),r&&c(n.getLabel(),t,i,r)},onFailure:function(e){let t;o(),e&&e.serverErr&&"string"==typeof e.serverErr.error&&e.serverErr.error.length>0&&(t=e.serverErr.error),u(t||e,n.getID(),"msg_error_Addinfolder")}}};i.AddContent(r)})},removeContent:function(e,t,o){return new Promise(r=>{i.RemoveContent({IDs:e,folderId:t,callbacks:{onComplete:function(i){let s=0,a=0;if(i){var l=i;a=e.length-l.NumberOfContentRemoved,s=l.NumberOfContentRemoved}if(!o){if(e.length<10)for(var d=0;d<e.length;d++){var c=e[d];let t="string"==typeof c?c:c.getID();n.getContent().removeNodeInContent(t)}var u=n.getContent().getObjectsInTree();n.getContent().getObjectsInTree(),0===u&&n.getContent()._addPlaceHolder()}r({bookmarkId:t,numberOfContentRemoved:s,numberOfContentNotRemoved:a})},onFailure:function(e){let n=e.err||e.error||e;if(r({bookmarkId:t,error:n,networkErr:!1!==e.networkErr}),e&&e.serverErr&&e.serverErr.error){const o=e.serverErr.error;"string"==typeof o&&o.length>0&&u(o,t,"msg_error_Removefromfolder")}else o||("string"!=typeof n&&(n=n.toString()),n.includes("Error: NetworkError")?u(n,t,"msg_error_OnRefreshCmdfailure"):u(n,t,"msg_error_Removefromfolder"))}}})})}}}),define("DS/FolderEditor/commands/ActionBar_AddExistingContentCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/IPClassifyUtil/IPClassifyCommunication","DS/FolderEditor/service/BkOperationsUtils"],function(e,t,o,n){"use strict";return t.extend({labelTopBar:e.i18n("Add Content"),isInsert:!0,datas:{},_modalChooser:null,init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1}),require(["DS/FolderEditor/Folder_CSO","DS/PADUtils/views/PADModalChooser","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/service/FolderServices","DS/PADUtils/PADUtilsServices","DS/UIKIT/Mask"],function(e,t,o,n,i,r,s){});var t=this;widget.addEvent("onRefresh",function(){UWA.is(t._modalChooser)&&(t._modalChooser.close(),t._modalChooser=null)})},beginExecute:function(){this._buildCellSkeleton()},execute:function(){var e=require("DS/FolderEditor/Folder_CSO"),t=require("DS/PADUtils/views/PADModalChooser"),n=require("DS/IPClassifyUtil/IPClassifyAlert"),i=require("i18n!DS/FolderEditor/assets/nls/FolderEditor"),r=require("DS/FolderEditor/utils/FolderEditorcontrol");if(e.getCurrentBookmarkId().length){var s=!0===widget.getValue("noCompass");if(s)s&&o.publish("SelectFromSearch",{});else{UWA.is(this._modalChooser)&&this._modalChooser.close();var a=r.getIdCardCont();Math.max(a.getContent().clientWidth/2-135,0);this._modalChooser=new t({renderTo:document.body,in_apps_search:{precond:'NOT(type:Workspace) AND NOT(type:"Workspace Vault")',in_apps_callback:this._objects_selected.bind(this)}})}}else n.displayNotification({message:i.msg_warning_nocurrentfolder,className:"warning"})},_objects_selected:function(e){var t=require("DS/FolderEditor/Folder_CSO"),o=require("DS/IPClassifyUtil/IPClassifyAlert"),i=require("i18n!DS/FolderEditor/assets/nls/FolderEditor"),r=require("DS/PADUtils/PADUtilsServices");let s=require("DS/FolderEditor/service/FolderEditorWebService");var a=[],l=r.getPlatformId(),d=!1;e.forEach(function(e){var o=e.resourceid;let n=e.sourceid,i=null,r=null;if(n){var c=n.split(":");r=c[0],c.length>1&&(i=c[1])}i&&i!==l?d=!0:a.push(t.getDefaultModelFromProperties({id:o,serviceId:s.getServiceFromSource(r),i3dx:e["ds6w:i3dx"],title:e["ds6w:label"]}))}),!0===d&&o.displayNotification({message:i.msg_warning_addnotsupported_from_different_tenant,className:"warning"}),n.processAddOperation(a)},_buildCellSkeleton:function(){var t=require("DS/FolderEditor/utils/FolderEditorcontrol");e.is(t.getContent().elements.container)||(t.getContent().elements.container=e.createElement("span",{class:"fonticon fonticon-1x fonticon-search",title:"Find in Context"}))},endExecute:function(){}})}),define("DS/FolderEditor/controllers/CommonMode",["DS/FolderEditor/tagger/TaggerContentProxy","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/utils/WidgetHandlerUtil","UWA/Controls/Abstract"],function(e,t,o,n){var i=[];return n.extend({defaultOptions:{filteringByService:!0},init:function(e){this._parent(e),this._contentHandleRequest=null},cancelQuery:function(){this._contentHandleRequest&&this._contentHandleRequest.cancel(),this._contentHandleRequest=null},cancelFacetsLoading:function(){this._taggerHandleRequest&&this._taggerHandleRequest.cancel&&this._taggerHandleRequest.cancel(),this._taggerHandleRequest=null},smartFilteringAvailable:function(){return!1},filteringByService:function(){return this.options.filteringByService},isInfiniteScrollingEnded:function(){let e=!0;if(this.withInfiniteScrolling&&this.withInfiniteScrolling()){let n=Math.min(t.getResultsCount(),o.ROOTS_PER_PAGE),i=this.getNumberLastResult();e=0===i||i<n,t.searchingInRoot&&(e=t.getScrollEndStatus())}return e},loadContents:function(){i.forEach(e=>{e.cancelQuery()}),i=[]},loadFacet:function(){var t=e.facetsComputationActives();(this.cancelFacetsLoading(),t)&&this.loadFacets.apply(this,arguments).then(t=>{let o=t.synthesis?t.synthesis:t;o="string"==typeof o?JSON.parse(o):o,e.addTags(o)}).catch(e=>console.log("Cannot load the facets"))},areFacetsCalled:function(){return!!this._taggerHandleRequest},loadContent:function(){var e=this.loadContents.apply(this,arguments);return e&&e.catch(function(e){console.log("Error: "+e)}).finally(()=>{this._contentHandleRequest=null}),i.push(this),e},disable:function(){this.cancelQuery(),this.cancelFacetsLoading()}})}),define("DS/FolderEditor/plugins/product/PrdUtils",["DS/i3DXCompassServices/i3DXCompassPubSub","DS/FolderEditor/service/FolderEditorWebServiceReadMode","DS/IPClassifyUXUtil/CredentialsView","DS/IPClassifyUtil/OpenWithMenuBuilder","DS/PADUtils/PADUtilsServices"],(e,t,o,n,i)=>{let r={version:"2.1",results:[],structures:[],viewpoint:[]};function s(e,t,o){let n=null;e.forEach(e=>{let i=o[e];if(!i){let r=Object.keys(o).length+1+"";t.results.push({id:r,phid:e}),o[e]=i={id:r,show:!0,children:[]},n&&n.children.push(o[e])}n=o[e]})}function a(e,o,n){n=void 0===n||n;var i,a=UWA.clone(r),l={};for(i=0;i<e.length;i++){let t=e[i].getRoot().getID();void 0===l[t]&&(l[t]={paths:[]});let o=e[i].getOccurencePath();l[t].paths.push(o)}let d=null,c={};d=Promise.resolve(),n&&(d=new Promise((e,o)=>{t.expandOfProducts(l).then(t=>{t.results&&t.results.forEach(e=>{if(e.Path){s(e.Path,a,c)}}),e(t.results)}).catch(o)})),d.then(t=>{if(!t||0===t.length||0===Object.keys(c).length)for(var o in l){l[o].paths.forEach(e=>{s(e,a,c)})}e.forEach(e=>{let t=c[e.getID()];t&&(t.select=!0)});for(let e in l){c[e]&&a.structures.push({structure:[c[e]]})}}).catch(e=>{console.log(e)}).finally(()=>{o(a)})}function l(e){return new Promise((t,o)=>{n.getTypeInheritance(e).then(e=>{let o=!0;for(let t in e)if(e[t].indexOf("VPMReference")<0){o=!1;break}t(o)}).catch(o)})}let d=!1;return{selectedNodesContainsOnlyVPMReference:l,buildDataForSetTypes:a,setTypesForOFW:function(t){let n={widgetId:i.getWidgetId()};d||(e.subscribe("setTypesCallback",async function(r){if(r.widgetId===i.getWidgetId()){var s=t.getSelectedNodesForOFW();if(s.length>0)if("ENOUC5C_AP"===r.appId&&1===s.length&&s[0].isRoot()){let t={objectId:s[0].getID(),envId:i.getPlatformId(),contextId:o.getCredential(),serviceId:s[0].getAttributeValue("serviceId")};e.publish("setObject",t),e.subscribe("launchAppCallback",function(t){t.appId===r.appId&&t.widgetId===r.widgetId&&e.publish("setObject",{objectId:"",envId:i.getPlatformId(),contextId:"",serviceId:"3DSpace"})});var d={appId:r.appId,widgetId:r.widgetId};e.publish("launchApp",d,function(){e.publish("setTypes",n)})}else{let t=await l(s);a(s,function(o){var n=JSON.stringify(o),i={appId:r.appId,origin:"openWith",widgetId:r.widgetId};t&&(i.fileName="-file",i.fileContent=n),e.publish("launchApp",i,function(e){console.log(e)})},!(!t||"SWXCSWK_AP"===r.appId))}else{var c={appId:r.appId,widgetId:r.widgetId};e.publish("launchApp",c,function(){e.publish("setTypes",n)})}}}),d=!0),e.publish("setTypes",n)}}}),define("DS/FolderEditor/commands/OpenInCAD",["DS/ApplicationFrame/Command","DS/PlatformAPI/PlatformAPI","DS/IPClassifyUXUtil/CredentialsView","DS/WidgetServices/WidgetServices","DS/FolderEditor/plugins/product/PrdUtils","DS/PADUtils/PADContext"],function(e,t,o,n,i,r){"use strict";function s(e){UWA.is(e.setObject,"object")?t.publish("webinwin:web:notification",JSON.stringify({operation:"open/setObject",operationVersion:"1.0",content:[{phid:e.setObject.objectId}]})):t.publish("webinwin:web:notification",JSON.stringify({operation:"open/setTypes",operationVersion:"1.0",content:e}))}return e.extend({init:function(e){this._parent(e)},execute:function(){this.getSelection()},getSelection:function(){var e=r.get().getPADTreeDocument().getSelectedNodesForOFW();if(n.isCatiaV5Environment()&&1===e.length&&e[0].isRoot()){s({setObject:{objectId:e[0].getID(),envId:n.getTenantID("OnPremise"),contextId:o.getCredential()}})}else{let t=!n.isSolidworksEnvironment();i.buildDataForSetTypes(e,function(e){s(e)},t)}}})}),define("DS/FolderEditor/popup/BookmarkLocationPopup",["UWA/Controls/Abstract","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/Button","DS/Windows/Dialog","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/Folder_CSO","DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/BookmarkLocationPopup","DS/Controls/TooltipModel","DS/FolderEditor/views/FolderMode","DS/Tree/TreeListView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel"],function(e,t,o,n,i,r,s,a,l,d,c,u,p,g,f){return e.extend({modal:null,onResize:function(){null!=this.ARWidget&&this.ARWidget.onResize()},init:function(e,a,l){this.elementsList=[],l=null!=l?l:{};var u=s.getSelectedNodes()[0].getLabel(),p=s.getCurrentBookmarkId(),g=null,f=UWA.createElement("div",{class:"bookmark_Open_Location-common-command"}),h=UWA.createElement("div",{class:"bookmark_Open_Location-common-command-div"});h.innerText=l.message,h.inject(f);let m=null,v=null,_=!1;l.radio?(m=new o({type:"radio"}),_=!0):v=UWA.createElement("ul",{class:"list-location-popup"});var S=null,C=null;let b={};for(var F=0;F<e.length;F++){let o=e[F],n=o.info[o.info.length-1],i=n.resourceid;if(b[i]=n,C=a(S=o.path.join(" > ")),l.radio){_=!1,0===F&&(_=!0,g=i);var y=new t({type:"radio",value:i,checkFlag:_});C.inject(y.getContent()),y.tooltipInfos=new c({longHelp:S}),m.addChild(y)}else{var D=UWA.createElement("div",{class:""}),E=UWA.createElement("li",{class:"list-element-location-popup"});E.tooltipInfos=new c({longHelp:S}),C.inject(D),D.inject(E),this.elementsList.push(D),E.inject(v)}}l.radio?(m.addEventListener("change",function(e){var t=e.dsModel.value;g=t[0]}),m.inject(f)):v.inject(f);var w=l.title?l.title:d.OpenLocation+" : "+u;this.dialog=new i({title:w,content:f,immersiveFrame:widget.immersiveFrame,minHeight:150,minWidth:400,modalFlag:!0,width:r.getContent().getComponentWidth()-130,resizableFlag:!0,buttons:{Ok:new n({label:l.okButtonLabel?l.okButtonLabel:"",disabled:!1,emphasize:"primary",onClick:function(t){t.dsModel.dialog.buttons.Ok.disabled=!0,l.onOkClick&&l.onOkClick({selectPathIDToNav:g,info:b[g],currNodeID:p,data:e})}}),Cancel:new n({emphasize:"secondary",onClick:function(e){e.dsModel.dialog.destroy()}})}}),this.dialog.getContent().addClassName("bookmark_Open_Location"),this.dialog.addEventListener("close",function(e){console.log("Close on dialog : "+e.dsModel.title),e.dsModel=null})},pushNotif:function(e){e.length!=this.elementsList.length&&console.log("/!\\ nb of notifs and nb of elements not equal.");for(var t=null,o=null,n=null,i=0;i<this.elementsList.length;i++)null!=e[i]&&(n=UWA.createElement("div"),"success"==e[i]&&(t=UWA.createElement("span",{class:"notif-element-location-popup green-notif",text:d.removeFromSearchNotif.success}),o=UWA.createElement("i",{class:"wux-ui-3ds-check wux-ui-3ds icon-notif-element-location-popup green-notif"})),"noChangeAllowed"==e[i]&&(t=UWA.createElement("span",{class:"notif-element-location-popup red-notif",text:d.removeFromSearchNotif.failNotAllowed}),o=UWA.createElement("i",{class:"wux-ui-3ds-alert wux-ui-3ds icon-notif-element-location-popup red-notif"})),"serverError"==e[i]&&(t=UWA.createElement("span",{class:"notif-element-location-popup red-notif",text:d.removeFromSearchNotif.serverError}),o=UWA.createElement("i",{class:"wux-ui-3ds-alert wux-ui-3ds icon-notif-element-location-popup red-notif"})),"noRelationFound"==e[i]&&(t=UWA.createElement("span",{class:"notif-element-location-popup red-notif",text:d.removeFromSearchNotif.failNoRelationFound}),o=UWA.createElement("i",{class:"wux-ui-3ds-alert wux-ui-3ds icon-notif-element-location-popup red-notif"})),o.inject(t,"top"),t.inject(n),n.inject(this.elementsList[i]))}})}),define("DS/FolderEditor/utils/BookmarkLocationUtil",["UWA/Core","UWA/Utils","UWA/Class","DS/FolderEditor/service/FolderEditorWebServiceReadMode","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/service/FolderServices","DS/FolderEditor/Folder_CSO","DS/FolderEditor/popup/BookmarkLocationPopup","DS/FolderEditor/utils/FolderEditorcontrol","i18n!DS/FolderEditor/assets/nls/BookmarkLocationPopup","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/Utilities/Dom","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/utils/FolderLoaderGlobal","DS/FolderEditor/views/FolderMode"],function(e,t,o,n,i,r,s,a,l,d,c,u,p,g,f){"use strict";return o.singleton({openBookmark:function(e){let t=e.getAttributeValue("_paths");if(t)if(1==t.length){let e=t[0].info,n=e[e.length-1];var o={id:n.resourceid,type:n.type,name:n.label};this._selectBookmarkInTree(o)}else{var n={message:d.OpenLocationPopupLable,radio:!0,okButtonLabel:d.Open,onOkClick:e=>{this.locationPopop.dialog.close();var t={id:e.info.resourceid,type:e.info.type,name:e.info.label};this._selectBookmarkInTree(t)}};this.locationPopop=new a(t,this.getHtmlElemFromPath.bind(this),n)}},updateNodesWithPath:function(e){let t=p.getRootBookmarks(),o=t?Object.keys(t):null,n=Promise.resolve();if(o&&o.length>0){let o={},s={};e.forEach(e=>{let t=e.getAttributeValue("links");(t=t||[{id:e.getID(),owner:e.getID()}]).forEach(e=>s[e.owner]=!0),o[e.getID()]=t});let a=Object.keys(s);n=new Promise(e=>{i.getParentPath({objectIds:a}).then(async n=>{if(n.expandData&&n.labelData){let s=n.expandData,l=n.labelData,d={};for(var i in a.forEach(e=>{d[e]={roots:{},paths:[],element:null}}),Object.keys(s).forEach(e=>{let o=[],n=[],i=s[e].length;if(i>0){let r=e.toString(),a=d[r],c=l[e];a.element={resourceid:e,label:c.label,type:c.type};for(let t=i-1;t>=0;t--){const r=s[e][t];!a||a.roots[s[e][t].id]&&t!==i-1||(o.push(r.label),n.push(r),"1"===r.level&&(n.push(r),a.paths.push({path:[...o],info:[...n]}),o=[],n=[]))}if(a&&1==Object.keys(t).length){let e=[];a.paths.forEach((o,n)=>{for(let n=0;n<o.info.length;n++)if(o.info[n].resourceid==Object.keys(t)){o.path.splice(0,n),o.info.splice(0,n),e.push(o);break}}),a.paths=[];for(let t=0;t<e.length;t++)a.paths.push({path:[...e[t].path],info:[...e[t].info]})}}}),d){let e=d[i];if(!e.element){let o=t[i];o?e.element={label:o.getLabel(),type:o.getType(),id:o.getID(),resourceid:o.getID()}:delete d[i]}}let u=await r.getCurrentBookmarkInfo(),p={};for(let e in o){let t=o[e],n=[];t.forEach(t=>{let o=t.owner,i=d[o];if(i){let r=i.paths;if(i.element){let n=[];o!==e?r.length>0?r.forEach(e=>{n.push({path:[...e.path,i.element.label],info:[...e.info,i.element],linkInfo:t})}):n.push({path:[i.element.label],info:[i.element],linkInfo:t}):0===r.length&&n.push({path:[u.getLabel()],info:[{resourceid:u.getID(),type:u.getType(),label:u.getLabel()}],linkInfo:t}),n.length>0&&(r=n)}r.length>0&&(n=[...n,...r])}}),n.length>0&&(p[e]={_paths:n,bookmarkLocation:n.length>1?c.replace(c.name_Section_ParentFolders,{number:n.length}):n[0].path.join(" > ")})}e({pids:p})}}).catch(t=>{console.log(t),e({})})})}return n},getResizedText:function(e,t,o,n){function i(e,t){if(e>=t.length)return t;e-="...".length;let o=t.split(">"),n=-1,i=(o=o.filter(e=>"..."!==e)).length-1,r=0;for(;n<i;){if(!(r+o[i].length+">".length<e)){++i;break}if(r+=o[i].length+">".length,--i,!(r+o[n+1].length+">".length<e)){++i;break}r+=o[++n].length+">".length}let s="";for(let e=0;e<=n;++e)s+=o[e]+">";if(s+="...",o.length-i<=1&&n<0)(s+=">"+o[o.length-1]).length>e&&(s=s.substring(0,e-"...".length)+"...");else for(let e=i;e<o.length;++e)s+=">"+o[e];return s}let r=e/t,s=Math.floor(n.length*r);if(o.indexOf(":")>=0){if(s>o.length)return o;let e="...";return e+o.substring(o.length+e.length-s,o.length)}if(-1===o.indexOf(">")){if(s>o.length)return o;let e="...";return o.substring(0,s-e.length)+e}return i(s,e>=t?o:n)},getHtmlElemFromPath:function(e,t){var o=this,n=UWA.createElement("span",{class:"bk-ellipsys-root",titlex:e}),i=UWA.createElement("span",{class:"bk-ellipsys-child"});return i.innerText=e,i.inject(n),!0!==t?(n._prevWidth=0,n.addEvent("resize",function(e){let t=this.getDimensions().width;this._prevWidth!=t&&(this._prevWidth=t,this.childNodes&&this.childNodes.length>0&&this.childNodes[0].getDimensions&&(this.childNodes[0].innerText=o.getResizedText(e.target.clientWidth,this.childNodes[0].getDimensions().width,this.getAttribute("titlex"),this.childNodes[0].innerText)))})):n.computeContentSize=function(){let e=0,t=l.getContent();if(t&&t.getPADTreeListView()){var o=t.getPADTreeListView().getFontDetails();if(o){var n=o.fontSize,i=o.fontSytle;e=Math.ceil(u.computeStringWidth(this.title,n,i,!1,!1))}}return e},n.setData=function(e){this.setAttribute("titlex",e),this.childNodes&&this.childNodes.length>0&&(this.childNodes[0].innerText=e)},n},_selectBookmarkInTree:function(e){l.getContent().nodeToSelectID=s.getSelectedNodes()[0].getID(),s.getCurrentBookmarkId()!==e.id?s.dispatchBookmarkPropsSelection({id:e.id,type:e.type,label:e.name}):p.isSearchActive()&&p.clearSearch()}})}),define("DS/FolderEditor/utils/FolderListContent_Read",["UWA/Utils","DS/FolderEditor/tagger/TaggerContentProxy","DS/FolderEditor/tagger/TaggerTreeProxy","DS/FolderEditor/service/FolderEditorWebServiceReadMode"],function(e,t,o,n){return{listContent:function(e){let i=t.getFilterTags();e.filters=i;let r=null;if("FolderSection_AllFolders"==e.pid){e.contentView=!0;let s=o.getFilterTags(),a=t.hasANDConditionInRefine(s,i);e.filters={...s,...i},a?(r=Promise.resolve({infos:{},results:[]}),e.onComplete({infos:{},results:[]})):r=n.getRoots(e)}else"Yes"!==e.filterChildren?(r=n.getContentReadMode({exceptIds:e.exceptIds,content:e.content,synthesis:e.synthesis,filterChildren:e.filterChildren,next_start:e.next_start,pid:e.pid,filters:e.filters,onComplete:e.onComplete,onFailure:e.onFailure})).appliedFilter=e.filters:e.synthesis||(r=n.getFilteredContent({content:e.content,pid:e.pid,onComplete:t=>{t.expandv2=!0,e.onComplete(t)},onFailure:function(t){console.log(t),e.onFailure(t)}}));return r},listV2Content:function(e){var o=null;let i=t.getFilterTags();return e.filters=i,"FolderSection_AllFolders"!==e.pid&&((o=n.listContent_ExpandLevel_1({pid:e.pid,noSizeLimit:e.noSizeLimit,synthesis_only:e.synthesis_only,predicates:e.predicates,content:e.content,noContent:"Yes"===e.filterChildren||!e.withSmartFiltering&&"synthesis",filters:e.filters,synthesis:e.synthesis,onComplete:e.onComplete,onFailure:e.onFailure})).appliedFilter=e.filters),o}}}),define("DS/FolderEditor/dataProvider/FolderFindInDataProvider",["UWA/Class","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderEditorEvents","DS/PADServices/utils/GlobalModelEvents","DS/FolderEditor/utils/FolderSearch","DS/ApplicationFrame/CommandsManager","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/tagger/TaggerContentProxy","i18n!DS/FolderEditor/assets/nls/FolderFindInTree","i18n!DS/FolderEditor/assets/nls/FolderFindInCtx"],function(e,t,o,n,i,r,s,a,l,d,c,u){"use strict";var p=i.getModelEvents();return e.singleton({NlsTree:c,autoCompleteKey:"BM_FindInTree_savedQueries",supportedSection:l.TYPE_FOLDERS_SECTION,unSupportedSection:l.TYPE_FAVORITES_SECTION,getSupportedTypesForDrop:function(){return["Workspace","Workspace Vault"]},getTreeGridView:function(){return o.getTreeCont()._folders_TreeView},getTreeVisibleNodesyId:function(e){return o.getTreeCont()._getVisibleNodeById(e)},getTreeSectionNodeForFind:function(e){return"FolderSection_AllFolders"==e?o.getTreeCont().getBookmarkSection():"Personal Workspace"==e?o.getTreeCont().getPersonalFolderSection():void 0},getTreeElementToAddCommand:function(){var e=o.getTreeCont().getContent(),t=null;return e&&(t=e.getElement(".FolderTree_Cont-root_treeview_container")),t},getTreeSelectedNode:function(){return t.getSelectedBookmark()},expandTreeAndSelectNode:function(e){e.withLoader=!1,o.getTreeCont().expandTreeAndSelectFolder(e)},findTreeNodes:function(e){a._findBookmarksInBookmark(e)},onTreeFilterChange:function(e){p.subscribe({event:"filterUpdatedTree"},t=>{e(t.hasFilter)})},onTreeUpdated:function(e){return n.onTreeUpdated(e)},onCurrentSelectionChange:function(e){return t.onBookmarkOpening(e)},NlsContent:u,getContentFilter:function(){return d.getProxy()},getContentGridView:function(){return o.getContent().getPADTreeListView().options.dgv},getTreeWidth:function(){var e=null;return o.getContent().folderLeftPanel.isLeftPanelOpen()&&(e=o.getTreeCont().getContent().offsetWidth),e},getContentTreeDocument:function(){return o.getContent().getPADTreeDocument()},findContentNodes:function(e){o.getContent().getPADTreeDocument()._findInCtx(e)},onContentFindClose:function(){s.getCommandCheckHeader("ActionBar_FindInCtxCmd").setState(!1,!1)},onContentSearchChange:function(e){return r.onSearchChange(e)},getContentColumnsToIgnore:function(){return["ContextualMenuColumn","isLastRevision","bookmarkLocation","ApprovalStatus","favoriteTitle"]}})}),define("DS/FolderEditor/controllers/CommonContentMode",["DS/FolderEditor/controllers/CommonMode","DS/FolderEditor/Folder_CSO","DS/FolderEditor/service/FolderServices","DS/FolderEditor/utils/FolderListContent_Read","DS/IPClassifyUXUtil/utils/CancellablePromise","DS/FolderEditor/tagger/TaggerContentProxy"],function(e,t,o,n,i,r){return e.extend({enable:function(){r.setUpdateMode(!1)},disable:function(){r.setUpdateMode(!0)},getInfoIndex:function(){return null},setInfoIndex:function(){},withInfiniteScrolling:function(){},loadIndexContents:function(e){let n={...e,next_start:null};let s=null!==this.getInfoIndex(),a=n.smartFiltering&&this.smartFilteringAvailable();n.withSmartFiltering=a,a&&!n.smartFiltering.fetchAllAttr&&(n.predicates=["physicalid"]);let l=[],d=!1;if(!s)if(r.clearTags(),"FolderSection_AllFolders"!==t.getCurrentBookmarkId()){let t=this.loadV2Objects(n),i=o.loadLinks([e.pid],{filters:r.getFilterTags()});l.push(t),l.push(i),d=!0}else n.synthesis=!0;if(!a||!d){let e=this.loadObjects({...n,content:"noBks"});l.push(e)}let c=this._contentHandleRequest=new i((e,t)=>{Promise.all(l).then(t=>{if(!c.isCancelled()){let o={};t.length>0&&((o=t[0]).inProgress=this.withInfiniteScrolling(),o.smartFiltering=a?n.smartFiltering:void 0,t.forEach((e,t)=>{t>0&&e&&e.contents&&(o.contents=[...o.contents,...e.contents])})),e(o)}}).catch(t)});return l.forEach(e=>{c.addLinkedQuery(e)}),c},loadObjects:function(e){let t={...e},o=null,r=new i((e,i)=>{let r=this.getInfoIndex();null!==r&&(t.next_start=r.next_start),t.onComplete=(o=>{null==this._indexInfo&&(this._isPageRefreshed=!0),this.setInfoIndex(o.infos);var n=o.results;n=n||[];let i=o.expandv2?n:[];o.expandv2||n.forEach(e=>{if(e.attributes){let t={};e.attributes.forEach(e=>{let o=e.name,n=e.value;o.startsWith("ds6w")&&(o=o.substring(o.lastIndexOf("/")+1));let i=t[o];i&&(n=i+","+n),t[o]=n}),i.push(t)}});var r={contents:i};!0===t.synthesis&&(r.synthesis=o),e(r)}),t.onFailure=function(e,t){i({err:e,serverErr:t})},o=n.listContent(t)});return r.addLinkedQuery(o),!0===t.synthesis&&(this.loadFacet({...e,facetPromise:r}),this._taggerHandleRequest=o),r},loadV2Objects:function(e){this.isTagSet=!1,this.cancelQuery();let t={...e},o="Yes"!==e.filterChildren&&"FolderSection_AllFolders"!=e.pid,r=null,s=new i((i,s)=>{t.next_start=null,o&&(t.synthesis=!0),t.onComplete=(n=>{o||this.loadFacet(t),null==this._indexInfo&&(this._isPageRefreshed=!0);var s=(n="string"==typeof n?JSON.parse(n):n).results;(s=s||[]).length>0&&s[0].resourceid===e.pid&&s.shift();let a=null;o&&s.length>0&&(a=s.pop().synthesis);var l={contents:s,synthesis:a,filters:r.appliedFilter,sorted:!0,inProgress:!1};i(l)}),t.onFailure=function(e,t){s({err:e,serverErr:t})},r=n.listV2Content(t),t.withSmartFiltering||(this._initialFilter=r.appliedFilter)});return s.addLinkedQuery(r),o&&(this.loadFacet({...e,facetPromise:s}),this._taggerHandleRequest=r),s},loadFacets:function(e){return e.facetPromise?e.facetPromise:new Promise((t,o)=>{let i=UWA.clone(e);i.synthesis=!0,i.synthesis_only=!0,i.onComplete=(e=>{let o=(e="string"==typeof e?JSON.parse(e):e).facets?e:{};e&&!e.facets&&e.results&&e.results.length>0&&(o=e.results.pop().synthesis),t({synthesis:o})}),i.onFailure=o,this._taggerHandleRequest=n.listContent(i)})}})}),define("DS/FolderEditor/commands/tools/DocumentCommandsMgr",["DS/PADServices/utils/GlobalModelEvents","DS/FolderEditor/utils/FolderSearch","DS/WidgetServices/WidgetServices","DS/IPClassifyUXUtil/CredentialsView","DS/PADUtils/PADUtilsServices","DS/WebappsUtils/WebappsUtils","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/views/FolderMode","DS/DocumentCommands/DocumentCommandsV2","DS/DocumentCommands/Constants","DS/CoreEvents/ModelEvents","DS/DocumentManagement/DocumentManagement","DS/PADUtils/PADSettingsMgt","DS/FolderEditor/utils/FolderEditorcontrol","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/Utilities/Utils"],(e,t,o,n,i,r,s,a,l,d,c,u,p,g,f,h)=>{let m=[],v=[d.UPDATE,d.UPDATE_AND_UNLOCK,d.OFFICE_WEB_EDITION,d.EDIT,d.LOCK_AND_DOWNLOAD,d.UNDO_EDIT,d.UNLOCK];var _=null,S={},C=null;S={};var b=function(t,n,r){return new Promise((s,a)=>{C=p.getSetting("pad_security_ctx"),spaceUrl=i.get3DSpaceUrl(),null!=t._documentMetadata&&1!=r?(e.publish({event:"document_data_loaded",data:t._documentMetadata}),n&&F().then(s)):u.getDocuments(t.map(e=>e.getID()),{tenant:o.getTenantID(),securityContext:C,tenantUrl:spaceUrl,onComplete:function(o){o.success&&Array.isArray(o.data)&&(t.length>0&&(t[0]._documentMetadata=o.data),e.publish({event:"document_data_loaded",data:o.data}),n&&F().then(s))}})})},F=function(){return _.getWebUXContextMenuItemsForCurrentSelection(m,!0)};function y(o){let n=g.getContent().getSelectedNodes();e.publish({event:"check_command_availability",data:{nodes:n,nodeModified:!0}}),t.isSearchActive()?a.switchtoAuthoringMode(!0):a.switchtoAuthoringMode(),function(t,o){let n=null,i=null;"_UnCheckedOutRemoveFlag"===t.action?(n={bottomRight:null},i={_ischeckout:"FALSE"}):"_CheckedOutAddFlag"===t.action&&(n={bottomRight:r.getWebappsAssetUrl("FolderEditor","icons/22/I_CheckOutDocument.png")},i={_ischeckout:"TRUE"});if(i){let r={attributes:i};!1!==o&&(r.badge=n);let s=t.data,a={};s.forEach(e=>{a[e.id]=r}),e.publish({event:"updateContentNodes",data:{items:a}})}}({action:o,data:[{id:n[0].getID()}]},!0)}return e.subscribe({event:"docv2-show-notification"},function(e){var t={title:e.title,subtitle:e.subtitle,message:e.message,className:e.level};s.displayNotification(t)}),e.subscribe({event:"docv2-edit-complete"},function(e){y("_CheckedOutAddFlag")}),e.subscribe({event:"docv2-update-complete"},function(e){y("_UnCheckedOutRemoveFlag")}),e.subscribe({event:"docv2-undoedit-complete"},function(e){y("_UnCheckedOutRemoveFlag")}),e.subscribe({event:"check_command_availability"},function(t){var o=t.nodes;e.publish({event:"document_data_loaded",data:[]}),1==o.length&&null!=o[0].options.checkout?b(o,!1,t.nodeModified):e.publish({event:"document_data_loaded",data:[]})}),{initialize(){var t=this;return new Promise((n,i)=>{f.getPlatformServices({platformId:o.getTenantID(),onComplete:function(t){C=p.getSetting("pad_security_ctx"),new l(S={fetchSecurityContext:function(){return C},getWorkUnderHeaders:function(){},getSelectedNodes:function(){return S.selectedDocuments},getDocumentFromNodeModel:function(e){return e},platformUrls:t,events:e}),_=new l(S),v.forEach(e=>{m.push(_.commands[e])}),n()},onFailure:function(e){console.log(e),n()}}),t.docToolbarConnection()})},docToolbarConnection(){var t=h.debounce(function(){F().then(function(t){t.length>0?(t.forEach(e=>{e.id=e.recId,e.tooltip=e.rawItem.dataElements.tooltip}),e.publish({event:"toolbar_update_command",data:{commandID:"DocumentCommands",data:{grid:{data:{menu:t}},visibleFlag:!0}}})):e.publish({event:"toolbar_update_command",data:{commandID:"DocumentCommands",data:{grid:{data:{menu:[]}},visibleFlag:!1}}})}).catch(function(e){console.log(e)})},10);e.subscribe({event:"document_data_loaded"},function(e){S.selectedDocuments=e,t()})},getContextualMenu(){e.publish({event:"document_data_loaded",data:[]});return new Promise((e,t)=>{b(g.getContent().getSelectedNodes(),!0).then(e)})}}}),define("DS/FolderEditor/popup/AddMovePopup",["UWA/Controls/Abstract","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/Button","DS/Windows/Dialog","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/Folder_CSO","DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/AddMovePopup"],function(e,t,o,n,i,r,s,a,l,d){return e.extend({init:function(e){this._parent(e),this.buildSkeleton(e),this.buttonGroup=null},buildSkeleton:function(e){var r=UWA.createElement("div",{class:"addMove-commonContent"}),s=UWA.createElement("div",{class:"addMove-Label"});s.innerText=d.operationToPerform,s.inject(r);var a=this.buttonGroup=new o({type:"radio"});a.addChild(new t({type:"radio",label:d.Add,value:"copy",checkFlag:!0})),a.addChild(new t({type:"radio",label:d.Move,value:"move"})),a.inject(r);var l=d.replace(d.get("msg_Title"),{number:e.objectValues.noOfObjects,folderName:e.objectValues.targetBookmark}),c=new i({immersiveFrame:widget.immersiveFrame,title:l,content:r,activeFlag:!1,modalFlag:!0,resizableFlag:!0,height:150,width:400,buttons:{Ok:new n({onClick:function(t){t.preventDefault(),t.stopPropagation();var o=a.getContent().dsModel.value[0];e.callback(o),c.destroy()}}),Cancel:new n({onClick:function(){e.callback("none"),c.destroy()}})}});c.getContent().addClassName("bookmark_AddMovePopUp"),c.addEventListener("close",function(t){e.callback("none"),c.destroy()})}})}),define("DS/FolderEditor/utils/FolderEditorUtil",["UWA/Utils","UWA/Core","DS/WebappsUtils/WebappsUtils","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/service/FolderServices","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUXUtil/service/IPClassifyUXUtilWebService","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/FolderCommunication","DS/FolderEditor/Folder_CSO","DS/IPClassifyActive/utils/EventsManager","DS/IPClassifyActive/utils/WidgetDataProvider","DS/IPClassifyUtil/IPClassifyUtility","DS/LifecycleServices/LifecycleServicesSettings","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/WidgetServices/WidgetServices","DS/PlatformAPI/PlatformAPI","DS/PADServices/utils/AttributesMgtV2","UWA/Utils/Client","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/popup/AddMovePopup","DS/FolderEditor/views/FolderMode","DS/ZipJS/deflate","DS/ZipJS/inflate"],function(e,t,o,n,i,r,s,a,l,d,c,u,p,g,f,h,m,v,_,S,C,b,F,y,D,E){let w={www:"link",__Unknown__:"link-off"};var A=null;var T=["VPMReference","CATIA Embedded Component","CATPart","CATProduct","CATProcess","CATDrawing","CATAnalysis","CATShape"].map(e=>"/"+e+"/");function I(){return""}function x(e,o,n){let i=e[o];i?(Array.isArray(i)||(i=[i]),t.is(n,"array")?i=[...i,...n]:i.push(n),e[o]=i):e[o]=n}function P(e){var t=h.jsonUnzip(e),o=null;try{o=JSON.parse(t)}catch(e){o=null}return o}function k(e){return h.jsonZip(JSON.stringify(e))}getStatusPref=function(){if(!A){var e=widget.getValue("view_status");A={},e&&(A=P(e))}return A||{}},saveStatus=function(e,t){var o=getStatusPref();o[e]=t,widget.setValue("view_status",k(o))},getStatus=function(e){return getStatusPref()[e]},getTreeListSort=function(e){var t=getStatus("treeSort");return t||e};var N=function(e){var t=e.toLowerCase(),o=b.getAvailableColumns(),n=null;return Array.isArray(o)&&o.every(function(e){return t==e.toLowerCase()&&(n=e),null===n}),n=n||e};function M(e,{name:t,value:o,object:n,dispValue:i}){let r={"ds6w:type":"type","ds6w:label":"label"};if("resourceid"==t||"physicalid"==t)e.resourceid=o;else if("type_icon_url"===t||"icon"==t)e.icons=[o];else if("preview_url"===t||"thumbnail_2d"==t)e.thumbnail=o;else if("taxonomies"===t)o.contains("types/DOCUMENTS/Document")&&(e.checkout=!0,e.isDownloadable=!0),e.taxonomies?e.taxonomies.push(o):e.taxonomies=[o];else if(t.startsWith("ds6w")){var s=t.split("/"),a=s[s.length-1];a="ds6wg:plmreference.v_islastversion"===a?"ds6wg:PLMReference.V_isLastVersion":a,o=(o=n||o)||i,(i=i&&"ds6w:reserved"!==a?i:o)||(i=o),O.addValueInGrid(e,a,i),"ds6wg:revision"!==a||"Workspace Vault"!==e.type&&"Workspace"!==e.type?a!=t&&(e.grid[t]=o):e.grid[t]="";var l=r[a];l&&(e[l]=o,e.grid[l]=o)}else"relcount"===t?"0"!==o&&(e.children=[]):e.grid[N(t)]=o}var O={densityHeight:{compact:26,comfortable:38},nameRules:{maxLength:127},_getManipulationColumns:function(){let e=d.getContent().getPADTreeListView(),t=[];if(e){let n=e.getManipulationUnitColumns();for(var o=0;o<n.length;++o)t.push(n[o].dataIndex)}return t},addValueInGrid:function(e,o,n){let i=d.getContent().getPADTreeListView(),r=i?i.getColumnsUnitNls():null;if(r){let i=r[o],s=n;if(i){if(t.is(n,"array")){s=[];for(let e=0;e<n.length;++e){let t=i.unit?n[e]+" "+i.unit:n[e];s.push(t)}}else s=i.unit?n+" "+i.unit:n;x(e.gridValue,o,n)}x(e.grid,o,s)}else{var s=e.grid[o];s&&!Array.isArray(s)&&(s=[s]),Array.isArray(s)&&s.push(n),Array.isArray(s)?e.grid[o]=s:e.grid[o]=n}},flattenSearchResult:function(e){let t={};return e.attributes.forEach(e=>{let o=e.name,n=o.lastIndexOf("/");n>0&&(o=o.substring(n+1));let i=t[o],r=e.value;i&&(r=i+","+r),t[o]=r}),t},convertToExaleadDataFormatFederated:function(e){var t={children:null},i=e.attributes;if(t.grid={},t.gridValue={},t.icons=[],i)i.forEach(function(e){M(t,e)});else{for(var r in e)M(t,{name:r,value:e[r]});t.taxonomies&&(t.taxonomies=t.taxonomies.length>0?t.taxonomies[0].split(","):null),t.grid["ds6w:kind"]&&"string"==typeof t.grid["ds6w:kind"]&&(t.grid["ds6w:kind"]=t.grid["ds6w:kind"].split(","))}e.id||(e.id=t.resourceid),t.padgrid={"ds6w:leaf":"False","ds6w:root":"True"};var s=d.getContent().getCurrentModeType();if("read"==s){let e=null;t.taxonomies&&t.taxonomies.every(t=>(t.startsWith("types/")&&(e=t),!e)),e||(e="types/"+t.type),e+="/",T.every(o=>{let n=e.indexOf(o)>0;return n&&(t.grid.expandable="TRUE",t.children=[]),!n})}if(("read"==s||"search"==s)&&["Workspace Vault","Workspace"].includes(t.type)){var a=t.grid["ds6w:classification"]||t.grid["icon_2ddefaultthb.subtype"];if(a&&"shared"==a.toLowerCase()){var l=o.getWebappsAssetUrl("FolderEditor","icons/I_BookmarkInherit_v2.png");t.icons=[l],t.grid["ds6w:classification"]="Shared"}else{var c=o.getWebappsAssetUrl("FolderEditor","icons/I_Bookmark_v2.png");t.icons=[c],t.grid["ds6w:classification"]=a&&"Personal"==a.toLowerCase()?"Personal":"Bookmark"}}if("read"==s&&1==t.checkout&&(t.Documentlocked=t.grid["ds6w:reserved"]?t.grid["ds6w:reserved"].toString().toUpperCase():"FALSE",t.isDownloadable=!0),t.children||(t.isNotManagedByPS=!0),t.grid.serviceId="3DSpace",t.grid.sourceid){var u=t.grid.sourceid.split(":");t.grid.serviceId=n.getServiceFromSource(u[0]),u.length>1&&(t.grid.tenantId=u[1])}return t},convertToExaleadDataFormat:function(e){if(Array.isArray(e.attributes)||e.resourceid)return this.convertToExaleadDataFormatFederated(e);var n={};n.resourceid=e.id,n.label=e.service&&"www"===e.service?e.appdata:e.label,t.is(e.TreeOrder)&&(n.relationOrder=e.TreeOrder),n.type=e.type,n.isDownloadable=e.isDownloadable||d.isCustomizedEnv()&&i.inFamilyFolder(e.type),n.checkout=e.checkout,t.is(e.mxid)&&(n.mxid=e.mxid),t.is(e.publishOnConnect)&&(n.publishOnConnect=e.publishOnConnect);var r=e.icon,s=e.largeicon,a=e.thumbnail?e.thumbnail:null;if(d.isCustomizedEnv()&&i.isRootFolder(e.type)?(r=o.getWebappsAssetUrl("FolderEditor","icons/folder_shared.png"),s=o.getWebappsAssetUrl("FolderEditor","icons/largefolder_shared.png")):d.isCustomizedEnv()&&i.isPersonalFolder(e.type)&&(r=o.getWebappsAssetUrl("FolderEditor","icons/folder_perso.png"),s=o.getWebappsAssetUrl("FolderEditor","icons/largefolder_perso.png")),n.icons=r?[r]:[],e.service&&w[e.service]){var l={iconName:w[e.service],fontIconFamily:1};n.icons=[l]}n.thumbnail=null!==a?a:null!==s?s:r,e.revision=i.inFamilyFolder(e.type)?"":e.revision,t.is(e.description)&&t.is(e.description.replace,"function")&&(e.description=e.description.replace(/\\n/g," ")),n.grid={},n.gridValue={},n.padgrid={},n.grid["ds6wg:revision"]=e.revision,n.grid["ds6w:identifier"]=e.name,t.is(e.TreeOrder)&&(n.grid.relationOrder=e.TreeOrder),n.grid.serviceId=e.service||"3DSpace";let c=e.description?e.description:"";for(var u in n.grid["ds6w:description"]=c,n.grid["ds6w:modified"]=e.modified,n.grid["ds6w:created"]=e.created,n.grid["ds6w:type"]=e.displayType?e.displayType:e.type,n.grid["ds6w:policy"]=e.policy?e.policy:"",n.grid["ds6w:organizationResponsible"]=e.organizationResponsible?e.organizationResponsible:"",n.grid["ds6w:project"]=e.project?e.project:"",n.grid["ds6w:status"]=e.status?e.status:"",e)"string"==typeof e[u]?e[u].length>0&&(n.grid[u]=e[u]):n.grid[u]=e[u];if(e.service&&"www"===e.service&&(n.grid.Link=e.uri),t.is(e.locker)&&(n.grid["ds6w:reservedBy"]=e.locker),t.is(e.locked)?n.grid["ds6w:reserved"]=e.locked:n.grid["ds6w:reserved"]="",t.is(e.isDuplicated)&&(n.grid.isDuplicated=e.isDuplicated),t.is(e.isLastMinorRevision)&&(n.grid.isLastMinorRevision=e.isLastMinorRevision),t.is(e.isLastVersion)&&(n.grid["ds6wg:PLMReference.V_isLastVersion"]=e.isLastVersion),t.is(e.svg)){var p=[{id:e.svg,format:"svg"}];n.grid.derivedOutputs=p}n.padgrid["ds6w:leaf"]="False",n.padgrid["ds6w:root"]="True",n.grid.current_nonNls=e.current_nonNls,n.grid["ds6w:responsible"]=e.responsible;var g=y.getAttrPredicateMap();return Object.keys(e).forEach(function(t){var o=g.get(t);o&&e[t].length>0&&O.addValueInGrid(n,o,e[t])}),t.is(e.logicalDeleteBy)&&(n.grid.logicalDeleteBy=e.logicalDeleteBy),t.is(e.logicalDeleteStamp)&&(n.grid.logicalDeleteStamp=e.logicalDeleteStamp),t.is(n.thumbnail)&&(n.grid.thumbnail=n.thumbnail),t.is(e.expandable)&&"TRUE"===e.expandable?n.children=[]:(n.children=null,n.isNotManagedByPS=!0),n},convertToArray:function(e){return[{name:"ds6wg:revision",value:e.grid["ds6wg:revision"]},{name:"ds6w:description",value:e.grid["ds6w:description"]},{name:"ds6w:modified",value:e.grid["ds6w:modified"]},{name:"ds6w:created",value:e.grid["ds6w:created"]},{name:"ds6w:type",value:e.grid["ds6w:type"]},{name:"ds6w:policy",value:e.grid["ds6w:policy"]},{name:"ds6w:organizationResponsible",value:e.grid["ds6w:organizationResponsible"]},{name:"ds6w:project",value:e.grid["ds6w:project"]},{name:"ds6w:reservedby",value:e.grid["ds6w:reservedby"]},{name:"ds6w:reserved",value:e.grid["ds6w:reserved"]},{name:"isDuplicated",value:e.grid.isDuplicated},{name:"isLastMinorRevision",value:e.grid.isLastMinorRevision},{name:"derivedOutputs",value:e.grid.derivedOutputs},{name:"ds6w:leaf",value:e.padgrid["ds6w:leaf"]},{name:"ds6w:root",value:e.padgrid["ds6w:root"]},{name:"ds6w:responsible",value:e.grid["ds6w:responsible"]},{name:"ds6w:status",value:e.grid["ds6w:status"]}]},generateJSON:function(e){var t,o,n,i=e.length,r={};for(t=0;t<i;++t)o={label:(n=e[t]).label,created:n.created,icon:n.icon,mxid:n.mxid,folderClassification:n.folderClassification},n.TreeOrder&&(o.relationOrder=n.TreeOrder),n.RelId&&(o.relId=n.RelId),r[n.id]=o;return r},shouldBeEditable:function(e){return i.inFamilyFolder(e.getType())},onNodeModelUpdate:function(e){var o=e.data.nodeModel;if(i.inFamilyFolder(o.getType())){var r=o._lastUpdateTime?o._lastUpdateTime:0,a=Date.now()-r;if(o._lastUpdateTime=Date.now(),!(0!==r&&a<300))if(o._resetting)o._resetting=!1;else{var u=o.getID(),p=o.options.label,g=o.options.oldLabel;if(o.isFavorite&&e.data.attributes.hasOwnProperty("favoriteTitle")&&(p=e.data.attributes.favoriteTitle,g=e.data.previousAttributes.favoriteTitle),void 0===g&&(g=""),p!==g){var f=!0;if(p&&p.trim&&(p.trim()===g.trim()&&(f=!1),p=p.trim()),void 0!==p&&0===p.trim().length&&(s.displayNotification({message:l.get("msg_error_name_empty"),className:"error"}),f=!1),f)if(o.isFavorite){if(t.is(d.getTreeCont())){var h={id:u,name:g};d.getTreeCont().renameFavorite(h,p,o)}}else E.switchtoAuthoringMode(),n.setFolderProperties({pid:u,properties:{Title:p},onComplete:function(){o.options.oldLabel=p,c.notifyFolderRename([o]),s.displayNotification({message:l.replace(l.get("msg_info_rename"),{name1:g,name2:p}),className:"success"}),d.getContent().getPADTreeListView().escape(),d.getTreeCont().escape()},onFailure:function(e){let t=l.get("msg_error_rename");s.displayNotification({title:l.replace(t.Title,{name:g}),subtitle:t.Advice,message:t.Details,className:"error"}),o._resetting=!0,setTimeout(function(){o.withTransactionUpdate(function(){this.setLabel(g)}),o._resetting=!1}),d.getContent().getPADTreeListView().escape(),d.getTreeCont().escape()}});else setTimeout(function(){o.isFavorite?o.setAttribute("favoriteTitle",g):o.withTransactionUpdate(function(){this.setLabel(g)});var e=require("DS/FolderEditor/commands/FolderCommands");o.hasOwnProperty("pathId")?e._cellToRename&&e.RenameCmd(e._cellToRename.cellInfos,"TREE"):e._cellToRename&&e.RenameCmd(e._cellToRename.cellInfos,"CONTENT")})}}}},checkMoveOrCopyAcrossSharedAndPersonal:function(e,t,o){if(!e||!t)return!0;var n=0,i="shared";if(e.isPersonal&&(n++,i="personal"),t.isPersonal&&n++,1==n){var r=l.get("Move_label");o&&(r=l.get("Copy_label"));var a="",d="";return"personal"==i?(a=l.get("Personal_label"),d=l.get("Shared_label")):(a=l.get("Shared_label"),d=l.get("Personal_label")),s.displayNotification({message:l.replace(l.get("msg_error_MoveOrCopyAcrossSharedAndPersonal"),{move_copy:r,personal_shared:a,shared_personal:d}),className:"error"}),!1}return!0},getTenant:function(){var e=_.getPlatformId(),t=null;if(e){try{_.getTenantsPreference().every(function(o){return o.value===e&&(t=o),null===t})}catch(e){t=null}null===t&&(t={label:e,value:e})}return t},getCtxAndBookmark:async function(){let e=await r.getCurrentBookmarkInfo();return this.getCurrentSecurityContextAndFolderData(void 0,e)},getCurrentSecurityContextAndFolderData:function(e,t){var o=t||p.getSelectedBookmark();!o&&p.getCurrentBookmarkId()&&(o={getLabel:I,getType:I,getID:()=>p.getCurrentBookmarkId()});var n=v.getSetting("pad_security_ctx"),i=this.getTenant(),r=c.createBookmarkForPublication(o,e);return r.Tenant=i,r.SecurityContext=n,r},objectSelectionProvider:{widgetEventsProvider:{selection:"FolderEditor.Public.Bookmark"},widgetDataProvider:{getObjectForPublication:function(e){return e&&i.inFamilyFolder(e.getType())?{FolderID:e.getID(),FolderLabel:e.getLabel()}:null}}},dipatchSecurityContextAndFolder:async function(){var e={current:null,active:null,origin:widget.id},t=await this.getCtxAndBookmark();e.current=t;var o=JSON.stringify(t);u.publish("FolderEditor.CurrentFolder",o);var n=!1;if(m.getEnforceFolderLinkSettingAsync(function(e,t){e||(n=t)}),n||d.isCustomizedEnv()||d.isActiveBookmarkActivated()){var i=d.getActiveFolder();e.active={origin:widget.id,id:"!"!==i.id?i.id:null,label:i.label,sc:i.sc},u.publish("FolderEditor.ActiveFolder",e.active)}u.publish("FolderEditor.Bookmark",e);var s=await r.getCurrentBookmarkInfo();f.setDataProvider(this.objectSelectionProvider),g.notifyObjectSelection(s)},_sortTreeColumn:function(e,t){var o=i.inFamilyFolder(e.getType()),n=i.inFamilyFolder(t.getType());return o&&!n?"asc"===this.sortOrder?-1:1:!o&&n?"asc"===this.sortOrder?1:-1:O.compareLabels(e.options.label,t.options.label)},sortingNodes:function(e){var t=this;return e.columns&&e.columns.forEach(function(e){var o=e.dataIndex;"tree"===o?e.sortFunction=t._sortTreeColumn:"ds6w:created"===o||"ds6w:modified"===o||"logicalDeleteStamp"===o||e.xnav_options&&"date"===e.xnav_options.kind?e.sortFunction=function(e,t){var n,r=i.inFamilyFolder(e.getType()),s=i.inFamilyFolder(t.getType());if(r&&!s)return"asc"===this.sortOrder?-1:1;if(!r&&s)return"asc"===this.sortOrder?1:-1;try{n=new Date(e.options.grid[o])>new Date(t.options.grid[o])?1:new Date(e.options.grid[o])<new Date(t.options.grid[o])?-1:0}catch(i){n=e.options.grid[o]<t.options.grid[o]?-1:1}finally{return n}}:e.sortFunction=function(e,t){var n=i.inFamilyFolder(e.getType()),r=i.inFamilyFolder(t.getType());if(n&&!r)return"asc"===this.sortOrder?-1:1;if(!n&&r)return"asc"===this.sortOrder?1:-1;var s=e.options.grid[o]?e.options.grid[o]:"",a=t.options.grid[o]?t.options.grid[o]:"";return O.compareLabels(s,a)}}),e},downloadFcs:function(o){if(t.is(o,"string")){var n=e.parseUrl(o),i=e.parseQuery(n.query);i.__fcs__attachment=!0,delete n.query;var r=e.composeUrl(n),s=document.createElement("form");s.style.display="none",s.method="POST",s.action=r,Object.keys(i).map(function(e){var t=document.createElement("input");t.setAttribute("name",e),t.setAttribute("value",i[e]),s.appendChild(t)}),document.body.appendChild(s),s.submit(),document.body.removeChild(s)}},downloadForTouchDevices:function(e){if(t.is(e,"string")){e+="&__fcs__attachment=true";var o=d.getContent();t.createElement("a",{href:e,styles:{display:"hidden"}}).inject(o.elements.container).click()}},isTouchDevice:function(){return"ontouchstart"in document.documentElement},compareLabels:function(e,o){if(e||(e=""),o||(o=""),t.is(e,"array")&&(e=e.length>0?e[0]:""),t.is(o,"array")&&(o=o.length>0?o[0]:""),!isNaN(o)||!isNaN(e)){if(!isNaN(o)&&!isNaN(e))return Number(e)==Number(o)?0:Number(e)>Number(o)?1:-1;o+="",e+=""}return function(e,t){let o,n,i=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),r=t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();return o=(n=i.localeCompare(r,{numeric:!0,sensitivity:"base"}))>0?1:n<0?-1:0}(e,o)},setBadge:function(e,t,o){var n={};n[t]=o,this.setBadges(e,n)},setBadges:function(e,t){var o=e.getBadges();for(var n in o=o||{},t){var i=t[n];o[n]=i?"string"==typeof i?{iconPath:i,iconSize:{width:"16px",height:"16px"}}:i:"none"}e.setBadges(o)},copyTexttoCLipboard:function(e){return navigator.clipboard.writeText(e)},getDefaultView:function(){var e=getStatus("default_view");return e&&"treelistview"!==e?e:"datagridview"},getContentSortmodel:function(){var e=getTreeListSort(),t=[{sort:"asc",dataIndex:"tree"}];return e&&(e.id?t=[{sort:e.param?e.param.sortOrder:"asc",dataIndex:e.id}]:Array.isArray(e)&&(t=e)),t},getRightPanelStatus:function(){var e=getStatus("rightPanel");return e||{rightPanelState:!1,size:300}},getLeftPanelStatus:function(){var e=getStatus("leftPanel");return e||{leftPanelState:!0,isWelcomePanelCollapsed:!1}},getTreeViewScrollerPosition:function(){var e=getStatus("TreeViewScrollerPosition");return e||{x:0,y:0}},setDefaultView:function(e){saveStatus("default_view",e)},setContentSortmodel:function(e){saveStatus("treeSort",e)},setRightPanelStatus:function(e){saveStatus("rightPanel",e)},setLeftPanelStatus:function(e){saveStatus("leftPanel",e)},setTreeViewScrollerPosition:function(e){saveStatus("TreeViewScrollerPosition",e)},getContentViewPreference:function(){return new Promise(function(e,t){var o=null,n=widget.getValue("FolderCusto_treelistview");if(n)o=P(n),e({preference:o});else{var i=new Promise(function(e){_.app_initialization(e)});Promise.all([i]).then(function(){a.getUserPreferences({name:widget.getValue("x3dAppId")+"_template"}).then(t=>{o=P(t),e({preference:o,template:!0})}).catch(e)}).catch(t)}})},setContentViewPreference:function(e,t,o){return new Promise(function(n){try{e.selectedTypes=b.getSelectedTypes(),e.selectedExtensions=b.getSelectedExtensions()}catch(e){}e.version=o||widget.getValue("vMigration"),e.hasOwnProperty("columnsOptimized")&&e.columnsOptimized.forEach(function(e){e.hasOwnProperty("label")&&delete e.label}),"only"!==t&&widget.setValue("FolderCusto_treelistview",k(e)),t?a.setUserPreferences({preferences:[{name:widget.getValue("x3dAppId")+"_template",value:k(e)}]}).then(()=>{console.log("Saved as template"),n()}).catch(()=>{console.warn("Cannot save customization template"),n()}):n()})},getAddMovePopupResults:function(e,t){new(require("DS/FolderEditor/popup/AddMovePopup"))({callback:e,objectValues:t})},setTreeTaggerPreference:function(e,t){t=JSON.stringify(t),t=h.jsonZip(t),widget.setValue(e,t)},getTreeTaggerPreference:function(e){return function(e){if(e)try{e=h.jsonUnzip(e),e=JSON.parse(e)}catch(t){e={}}else e={};return e}(window.widget?widget.getValue(e):void 0)},isTreeTaggerActive:function(){return!0===v.getSetting("activateTreeFilter")},filterDBOnlyAttrs:function(e){for(var t=[],o=0;o<e.length;++o)(!e[o].attrDBName||e[o].attrDBName.length>0)&&t.push(e[o]);return t},isRelationsColumnsActive:function(){let e=!0===v.getSetting("activateRelationsColumns"),t=!0===v.getSetting("Activate_relationsColumns"),o=!(!window||!0!==window.isReplayRelatedObjectsODT);return t&&e||o}};return O}),define("DS/FolderEditor/views/FolderRightSidePanelView",["UWA/Core","UWA/Controls/Abstract","UWA/Promise","DS/PADUtils/PADContext","DS/PADServices/utils/GlobalModelEvents","DS/Utilities/Utils","DS/WidgetServices/commandProxy/CommandProxy","DS/FolderEditor/Folder_CSO","UWA/Class/Model","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorUtil","DS/PADUtils/PADSettingsMgt","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderEditorEvents","DS/PlatformAPI/PlatformAPI","DS/IPClassifyUtil/IPClassifyUtility","DS/FolderEditor/service/BkOperationsUtils"],function(e,t,o,n,i,r,s,a,l,d,c,u,p,g,f,h,m){"use strict";var v=[];return t.extend({_context:null,_propertiesWdg:null,_callbackAdd:!1,init:function(e){this._subscriptionTokens=[],this._parent(e,{}),this._context=n.get();var t=this;if(this._propertiesWdg=null,this._context.elements.padshell){var i=new o(function(o){null==t._propertiesWdg?require(["DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/utils/EditPropUtils"],function(n,i,r){if(t.EditPropUtils=r,null==t._propertiesWdg){t._propertiesWdg=new n({className:"enxpropertiestab",setEditButton:!0,readOnly:1==widget.launchWithReadMode,typeOfDisplay:i.ALL,selectionType:i.NO_SELECTION,multiselection:i.MULTISEL_MERGE,collapseTabs:!1,context:t._context,actions:[{name:"action_close_panel",text:d.button_close,icon:"close",handler:function(){t._context.elements.padshell.getRightOpen()&&(t._context.togglePanel("right"),t._selectionChange(),t.setPreferences())}}]}),t._propertiesWdg.addFacets([{require:"DS/FolderEditor/views/additionalFacets/SpecificationsFacet",alwaysVisible:!1,supportMerge:!1,services:["3DSpace"],inheritance:!0,content:null,facet:{name:"doc_specifications",text:d.get("Specification"),icon:"doc-log"},options:{appContext:t._getAppContext(e),hideAttachments:!0,readonly:!1}},{require:"DS/FolderEditor/views/additionalFacets/AttachmentsFacet",alwaysVisible:!1,supportMerge:!1,services:["3DSpace"],inheritance:!0,content:null,facet:{name:"doc_attachments",text:d.get("Attachments"),icon:"attach"},options:{appContext:t._getAppContext(e),hideSpecifications:!0,readonly:!1,supportedTypes:{includedTypes:["Document","Drawing"],excludedTypes:[]}}},{position:3,require:"DS/ClassificationsFacet/ClassificationFacet",alwaysVisible:!1,facet:{name:"Classification",text:d.classificationFacetText,icon:"classification-book"}}]),t._propertiesWdg.removeFacets([i.FACET_VIEWS]);var s=t._context.elements.padshell.getRightPanelContent();t._propertiesWdg.inject(s),t._propertiesWdg.elements.container.getContent().addEvent("resize",function(){t.size=t._context.elements.padshell._currentRight;var e={rightPanelState:t._context.elements.padshell.getRightOpen(),size:t.size};c.setRightPanelStatus(e)});var a=c.getRightPanelStatus();a.rightPanelState?(t.size=t._context.elements.padshell._currentRight=a.size,t._context.togglePanel("right"),t.setPreferences(),t._selectionChange(),g._modelEvents.publish({event:"information-panel-visible"})):(t.size=t._context.elements.padshell._currentRight=a.size,t.setPreferences())}o()}):o()});i.then(function(e){t.addCallback()}),v.push(i)}widget.addEvent("onDestroy",this.destroy.bind(this))},destroy:function(){this._subscriptionTokens.forEach(e=>{i.unsubscribe(e)}),this._subscriptionTokens=[],this._parent()},updatePanelVisibility:function(e,t){"right"===t&&(this.setPreferences(),p.getIdCardCont().updateRightPanelIcon(e),!0===e&&h.sendTrackerPageEvent("FolderWidget_iconBar","Information"))},addCallback:function(){var e=this;if(!1===e._callbackAdd&&(f.subscribe("DS/PADUtils/PADCommandProxy/select",t=>{e._context.elements.padshell&&e._selectionChange(t.data,t)}),e._context.elements.padshell&&e._context.elements.padshell._modelEvents)){let t=e._context.elements.padshell._modelEvents.subscribe({event:"triptych-panel-hidden"},e.updatePanelVisibility.bind(this,!1));e._subscriptionTokens.push(t),t=e._context.elements.padshell._modelEvents.subscribe({event:"triptych-panel-visible"},e.updatePanelVisibility.bind(this,!0)),e._subscriptionTokens.push(t),g.rightPanelOpen(function(t){if("right"===t||"right"===t.rdata){var o=e._context.elements.padshell.getRightOpen();o?o&&t.dataIndex&&(e._selectionChange(t),e.setPreferences()):(e._context.togglePanel("right"),t.dataIndex?e._selectionChange(t):e._selectionChange(),e.setPreferences())}}),g.rightPanelClose(function(t){"right"===t&&(e._context.elements.padshell.getRightOpen()&&(e._context.togglePanel("right"),e._selectionChange(),e.setPreferences()))}),e._callbackAdd=!0}},_selectionChange:function(e,t){if(this._context.elements.padshell.getRightOpen()&&this.EditPropUtils&&(!t||t.metadata&&t.metadata.originWidgetId===widget.id&&"ENORIPE_Relations"!==t.metadata.origin)){var n=this,i=a.getSelectedNodes(),r=[];i.length&&i.forEach(function(e){if("Personal Workspace"!==e.getType()){var t=n.EditPropUtils.getModelFromSelectedNode(e);t&&r.push(t)}});n=this;var s=new o(function(t){o.all(v).then(function(){e&&e.dataIndex?require(["i18n!DS/ENORIPE_RelationsColumns/assets/nls/ENORIPE_Columns","DS/ENORIPE_Relations/RelationsTabSettings"],function(t,o){n._propertiesWdg.initDatas(r,"relations"),o.expandRelations([t.get(e.dataIndex)])}):n._propertiesWdg.initDatas(r),t()})});v.push(s)}},setPreferences:function(){var e=this._context.elements.padshell.getRightOpen(),t={rightPanelState:e,size:this.size};c.setRightPanelStatus(t),e?g._modelEvents.publish({event:"information-panel-visible"}):g._modelEvents.publish({event:"information-panel-hidden"})},_getAppContext:function(e){return{getPlatformUrls:function(){return e.platformUrls},getSecurityContext:function(){return widget.getValue("pad_security_ctx")}}}})}),define("DS/FolderEditor/FolderTrashDocument",["DS/Logger/Logger","DS/TreeModel/TreeDocument","DS/PADUtils/PADCommandProxy","DS/PADUtils/PADUtilsServices","DS/TreeModel/TreeNodeModel","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderEditorcontrol","DS/LifecycleServices/LifecycleServices"],function(e,t,o,n,i,r,s,a,l){"use strict";var d=t.extend({name:"FolderTrashDocument",_logger:null,_isActive:!1,_commandProxy:null,init:function(t){var o=t||{};UWA.is(o.shouldAcceptDrag)||(o.shouldAcceptDrag=this._shouldAcceptDrag.bind(this)),this._parent(o),this._logger=e.getLogger(d),this._isActive=!0,this._buildCommandProxy()},_buildCommandProxy:function(){this._commandProxy=o.create({events:{onRefresh:this._onRefreshTrash.bind(this)}})},_shouldAcceptDrag:function(){return!1},activateEventProxy:function(e){this._isActive=e},_onRefreshTrash:function(e){var t=this;if(this._isActive){if(UWA.is(e.authored.physicaldeleteafterlogical,"array")){var o=[];e.authored.physicaldeleteafterlogical.forEach(function(e){o=o.concat(t._getNodesById(e))}),this._deleteNodes(o)}if(UWA.is(e.authored.restored,"array")){o=[];e.authored.restored.forEach(function(e){o=o.concat(t._getNodesById(e))}),this._deleteNodes(o)}UWA.is(e.authored.deleted,"array")&&this.refreshContent()}},_getNodesById:function(e){var t=[];return this.getChildren().forEach(function(o){var n=o.getID()===e?o:null;n&&(t=t.concat(n))}),t},_deleteNodes:function(e){var t=this;this.prepareUpdate(),e.forEach(function(e){e.isRoot()?t.removeRoot(e):e.remove()}),this.pushUpdate()},refreshContent:function(){var e=a.getTrashCont();e&&e.setMask();var t=this;try{l.getDeletedItems(function(o){var n;o&&(n=o.content),t.empty(),t.prepareUpdate(),Array.isArray(n)&&n.forEach(function(e){var o=s.convertToExaleadDataFormat(e);o.children=null,o.useAsyncPreExpand=!1;var n=new i(o);n.id=e.id,n.getID=function(){return this.id},t.addRoot(n)}),e&&e.endloadingNodeEvent(),t.pushUpdate()},function(o){r.displayNotification({message:o,className:"error"}),t._logger.warn("LifecycleServices.getDeletedItems returns errorMsg : "+o),t.empty(),e&&e.unsetMask()})}catch(o){t._logger.error("Error when calling LifecycleServices.getDeletedItems",o),t.empty(),e&&e.unsetMask()}}});return d}),define("DS/FolderEditor/views/FolderLeftSidePanelView",["UWA/Core","UWA/Controls/Abstract","DS/FolderEditor/utils/FolderEditorUtil","DS/PADUtils/PADContext","DS/PADServices/utils/GlobalModelEvents","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/FolderEditorcontrol"],function(e,t,o,n,i,r,s){"use strict";return t.extend({_context:null,_callbackAdd:!1,init:function(e){this._subscriptionTokens=[],this._parent(e,{}),this._context=n.get(),this.addCallback(),widget.addEvent("onDestroy",this.destroy.bind(this))},destroy:function(){this._subscriptionTokens.forEach(e=>{i.unsubscribe(e)}),this._subscriptionTokens=[],this._parent()},updatePanelVisibility:function(e,t){"left"===t&&(this.setPreferences(),s.getIdCardCont().updateLeftPanelIcon(e))},addCallback:function(){var e=this,t=s.getTreeCont()?s.getTreeCont()._folders_TreeView:null;if(t._getScroller()&&t._getScroller().onScrollEnd(function(){o.setTreeViewScrollerPosition(t.getScrollerPosition())}),!1===this._callbackAdd&&this._context.elements.padshell&&this._context.elements.padshell._modelEvents){let t=this._context.elements.padshell._modelEvents.subscribe({event:"triptych-panel-hidden"},e.updatePanelVisibility.bind(this,!1));this._subscriptionTokens.push(t),t=this._context.elements.padshell._modelEvents.subscribe({event:"triptych-panel-visible"},e.updatePanelVisibility.bind(this,!0)),this._subscriptionTokens.push(t),r.leftPanelOpen(function(t){"left"===t&&(!e._context.elements.padshell.getLeftOpen()&&widget.body.getSize().width,e._context.togglePanel("left"),e.setPreferences())}),r.leftPanelClose(function(t){"left"===t&&(e._context.elements.padshell.getLeftOpen()&&(e._context.togglePanel("left"),e.setPreferences()))}),this._callbackAdd=!0}},setPreferences:function(){var e=this._context.elements.padshell.getLeftOpen(),t={leftPanelState:e,isWelcomePanelCollapsed:!e};o.setLeftPanelStatus(t),e?r._modelEvents.publish({event:"welcome-panel-expanded"}):r._modelEvents.publish({event:"welcome-panel-collapsed"})},isLeftPanelOpen:function(){return this._context.elements.padshell.getLeftOpen()}})}),define("DS/FolderEditor/ActionBar/FolderCommandManager",["UWA/Class","DS/TreeModel/TreeNodeModel","DS/WidgetServices/WidgetServices","DS/ApplicationFrame/CommandsManager","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUXUtil/utils/CancellablePromise","DS/FolderEditor/utils/FolderEditorcontrol","DS/LifecycleServices/LifecycleServicesSettings","DS/FolderEditor/Folder_Clipboard","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/service/FolderServices","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderSearch","DS/FolderUpload/FolderUpload","DS/FolderEditor/utils/FolderEditorUtil","DS/IPClassifyUXUtil/ActionBar/IPCommandManager","DS/FolderEditor/service/FolderEditorWebService","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADSettingsMgt","i18n!DS/FolderEditor/assets/nls/FolderEditor","text!DS/FolderEditor/assets/FolderProbesCommandMapping.json","DS/FolderEditor/commands/tools/DocumentCommandsMgr"],function(e,t,o,n,i,r,s,a,l,d,c,u,p,g,f,h,m,v,_,S,C,b,F){"use strict";var y=JSON.parse(b);function D(){return new Promise(e=>{var t={onComplete:e,onFailure:function(t,o,n){if("string"==typeof o){var r=function(e){var t="";try{t=JSON.parse(e)}catch(e){}return t}(o);r.error&&i.displayNotification({message:r.error,className:"error"})}e()}};v.getToolbar(t)})}var E=[];o.isCatiaV5Environment()?E=["VPMReference","Drawing","XCADNonPSBaseRepReference","3DShape"]:o.isSolidworksEnvironment()&&(E=["XCADModelRepReference","VPMReference","Drawing"]);var w={SubscribeHdr:{TREE:!1,CONTENT:!0},UnSubscribeHdr:{TREE:!1,CONTENT:!0},EditSubscribeHdr:{TREE:!1,CONTENT:!0},MySubscriptionsHdr:!0,PushSubscribeHdr:{TREE:!1,CONTENT:!0},ViewSubscribeHdr:{TREE:{Sections:!1},CONTENT:!0},BookmarkLocation:{search:!0,multisel:!1,CONTENT:1},OpenInCADHdr:{dashboard:!1,CONTENT:{types:E}},openInV5:{webInWin:!1,setting:"activateOpenWith18xFD01",CONTENT:{Bookmarks:!1}},openWith:{CATIAV6:!1,multisel:!1,CONTENT:1},RenameCmd:{multisel:!1,ctxFavorite:!0,TREE:{Sections:!1},CONTENT:{check:e=>!(!c.inFamilyFolder(e.getType())||"thumbnailview"===a.getContent().options.active_view||"tileview"===a.getContent().options.active_view)}},ActionBar_FindInCtxCmd:{views:["datagridview"],search:!1,TREE:{ctxMenu:!1,FavSection:!1,BookSection:!1},CONTENT:{check:e=>"VPMReference"==e.options.type&&!!e.getChildren()}},ActionBar_ActiveBookmarkCmd:{TREE:!0},AddExistingContent:{white_click:!0,search:!1,check:()=>!widget.getView||"sidepanel"!==widget.getView().type,TREE:{ctxMenu:!1,FavSection:!1,BookSection:!1}},AddExternalLink:{white_click:!0,search:!1,TREE:{ctxMenu:!1,FavSection:!1,BookSection:!1,PersonalSection:!1}},OpenExternalLink:{multisel:!1,service:{www:1},CONTENT:{service:{www:1}}},AddFile:{white_click:!0,search:!1,TREE:{ctxMenu:!1,FavSection:!1,BookSection:!1}},AddToFavorites:{ctxFavorite:!0,TREE:{ctxMenu:!1,Sections:!1},CONTENT:{FavContent:!0}},RemoveShortcut:{CONTENT:{linkedFolder:!0,check:function(e){return"TRUE"===e._options.grid.isLinkedFolder}}},RemoveContent:{multiselSearch:!1,CONTENT:{service:!0,Bookmarks:!1}},PreviewFile:{multisel:!1,CONTENT:{check:function(e){return void 0!==e.options.checkout}}},DocumentCommands:{multisel:!1,CONTENT:{check:function(e){return void 0!==e.options.checkout}}},FolderUpload:{search:!1,multisel:!1,check:function(){return!f.IsAnOperationOngoing()},TREE:{FavSection:!1}},FolderDownload:{multisel:!1,TREE:{FavSection:!1,Sections:!1},CONTENT:{Bookmarks:!0}},SelectChildren:{TREE:!1,CONTENT:{check:function(e){return null!==e.getChildren()}}},SelectParent:{TREE:!1,CONTENT:{check:function(e){return e.getDepth()>0}}},SelectAll:!0,SelectInversion:{TREE:!1,CONTENT:1},SelectSiblings:{TREE:!1,CONTENT:1},SelectLeaves:{TREE:!1,CONTENT:{check:function(e){return null!==e.getChildren()}}},DownloadFile:{TREE:{Sections:!1,custo:!0},CONTENT:{check:function(e){return e.options.isDownloadable}}},Copy:{TREE:{FavSection:!1,Sections:!1},CONTENT:{noservice:{__Unknown__:0}}},Cut:{search:!1,TREE:{Bookmark:!0},CONTENT:{noservice:{__Unknown__:0},Root:!1,childProduct:!1}},Paste:{search:!1,white_click:!0,clipboard:!0,TREE:{FavSection:!1},CONTENT:{Bookmarks:!0,rootInClipboard:!1}},ActionBar_Attributes:{TREE:{Sections:!1},CONTENT:{noservice:{__Unknown__:0}}},ActionBar_AccessRightCmd:{TREE:{Sections:!1,PersonalBookmark:!1},CONTENT:{service:{"3DSpace":1},linkedFolder:!0,PersonalBookmark:!1}},UnifiedExportCommand:{TREE:{Sections:!1},CONTENT:!0},CompareHdr:{CATIAV6:!1,CONTENT:!0},ActionBar_TransferOwnership:{TREE:{Sections:!1,PersonalBookmark:!1},CONTENT:{PersonalBookmark:!1}},MaturityHdr:{TREE:{Sections:!1,PersonalBookmark:!1},CONTENT:{PersonalBookmark:!1}},ActionBar_ChangeOwner:{TREE:{Sections:!1,PersonalBookmark:!1},CONTENT:{PersonalBookmark:!1}},ActionBar_ReserveCmd:{TREE:!1,CONTENT:{Bookmarks:!1,check:function(e){return"boolean"!=typeof e.options.isDownloadable||!e.options.isDownloadable}}},ActionBar_UnreserveCmd:{TREE:!1,CONTENT:{Bookmarks:!1,check:function(e){return"boolean"!=typeof e.options.isDownloadable||!e.options.isDownloadable}}},ActionBar_NewFolderCmd:{author:!1,white_click:!0,search:!1,TREE:{FavSection:!1}},DeleteHdr:{TREE:{Sections:!1,check:e=>!0!==e.isFavorite},CONTENT:{check:e=>!c.isPersonalFolder(e.getType())&&!0!==e.isFavorite}},datagridview:!0,tileview:{search:!1},thumbnailview:{search:!1},ExpandAll:{TREE:{treeNode:!0,FavSection:!1,Favorites:!1,BookSection:!1},CONTENT:{check:function(e){return null!==e.getChildren()}}},ExpandN:{TREE:{treeNode:!0,FavSection:!1,Favorites:!1,BookSection:!1},CONTENT:{check:function(e){return null!==e.getChildren()}}},CollapseAll:{TREE:{treeNode:!0,Favorites:!1},CONTENT:{check:function(e){return null!==e.getChildren()||!0===widget.getValue("allow-products-expand")&&"TRUE"===e.getAttributeValue("expandable")}}},Print:{search:!1,ios:!1,views:["datagridview"]},PrintOptions:{search:!1,ios:!1},ExportCSV:{ios:!1},ExportCSVOptions:{search:!1,ios:!1},ImportCSVBookmark:{search:!1,TREE:{FavSection:!1}},ImportCSV:{search:!1,TREE:{FavSection:!1}},ActiveFolder:{search:!1,check:function(){var e=!1;return l.getEnforceFolderLinkSettingAsync(function(t,o){t||(e=o)}),e||a.isCustomizedEnv()||a.isActiveBookmarkActivated()},TREE:{FavSection:!1,BookSection:!1}},WhereUsed:!0,DuplicateHdr:{TREE:!1,CONTENT:{Bookmarks:!1}},RevisionHdr:{TREE:!1,CONTENT:{Bookmarks:!1}},NewBranchHdr:{TREE:!1,CONTENT:{Bookmarks:!1}},ReviseFromHdr:{TREE:!1,multisel:!1,CONTENT:{Bookmarks:!1}},HistoryHdr:{TREE:!1,multisel:!1,CONTENT:{service:{"3DSpace":1},Bookmarks:!1}},UPSAuthReplaceByRevision:{search:!1,multisel:!1,CONTENT:{Bookmarks:!1,check:function(e){return e.getDepth()<1}}},UPSReplaceByLatestRevision:{search:!1,CONTENT:{Bookmarks:!1,check:function(e){return e.getDepth()<1}}},ActionBar_ShareBookmarkLink:{multisel:!1,TREE:{Sections:!1},CONTENT:{linkedFolder:!0,search:!1,childProduct:!1,noservice:{__Unknown__:0}}},RelationIPExplorer:{TREE:{Sections:!1},CONTENT:{service:{"3DSpace":1},linkedFolder:!0},CATIAV6:!1},ColumnVisibility:{views:["datagridview"]},CreateRouteHdr:{TREE:{Sections:!1},CONTENT:!0}};return e.singleton(m,{noSizeToFit:["bookmarkLocation"],getSingletonInstance:function(){return this},initialize:function(){let e=null;this.getModelEvents().subscribe({event:"updateBMESelection"},()=>{e&&(e.cancel(),e=null),(e=new s((e,t)=>{u.getCurrentBookmarkInfo().then(e).catch(t)})).then(e=>{0===p.getSelectedNodes().length?this.enableAllCommands(!1):this.updateCommands(void 0,e)})}),n.onCommandStart(e=>{var t=w[e.getId()];t&&!0===t.author&&this.getModelEvents().publish({event:"switch_to_author"})});var t=new Promise(e=>{D().then(e)});let o=F.initialize();return new Promise(e=>{Promise.all([t,o]).then(t=>{var o={};let n=t[0];if(n)for(var i in(o=JSON.parse(n)).headers){var r=o.headers[i],s=w[i];r.ID=i,s&&"CATAfrHeaderCheck"===r.Behavior&&(s.type="check")}if(!1===widget.multiselection){["SelectAll","SelectChildren","SelectInversion","SelectParent","SelectSiblings","SelectLeaves"].forEach(e=>{delete o.headers[e]})}e(o)})})},getAdditionalCtxCommands:function(e,t,o){var n=!1;let i=null,r=null;var s=!!o.cellInfos&&o.cellInfos.rowID<0;if(null!=e&&!s){if(!t&&e&&1==e.length){let t=e[0];var a=o&&o.collectionView?o.collectionView.getColumnOrGroup("ApprovalStatus"):void 0;if(a&&a.visibleFlag){var l=t.options?t.options.grid.approvalStatusModel:void 0;l&&l.model&&l.model.route.length>0&&(n=!0)}n&&(i=new Promise((e,o)=>{require(["DS/RouteWebAppUX/scripts/RouteWebAppApprovalStatusUX"],n=>{var i=t.options.grid.approvalStatusModel;n.getColumnApprovalStatusMenu(i).then(e).catch(o)})}))}1==e.length&&null!=e[0].options&&null!=e[0].options.checkout&&(r=new Promise((e,t)=>{F.getContextualMenu().then(t=>{t&&(t.ctxHeader="DocumentCommands",e(t))}).catch(t)}))}return[i,r]},launchCommand:function(e,t,o,n){let i=e;y&&y[e]&&(i=y[e]),"ContextualMenu"===n?r.sendTrackerPageEvent("FolderWidget_contextual",i):r.sendTrackerPageEvent("FolderWidget_iconBar",i),this._parent.apply(this,arguments)},getHeaderCtxMenu:function(e){var t=this._parent.apply(this,arguments),o=e.cellInfos;const n=o.columnID,i=o.manager.columns[n],r=!i||!i.customisation.layout||!1!==i.customisation.layout.removableFromView;return t.push({ID:"clearSort",title:C.CMDClearSort,type:"PushItem",icon:"clear",state:o.manager&&o.manager.sortModel&&o.manager.sortModel.length>0&&(o.manager.sortModel.length>1||"defaultSort"!==o.manager.sortModel[0].dataIndex)?"enabled":"disabled",action:{callback:function(){var e;(e=o).manager.prepareUpdateView(),e.manager.sortModel=[{dataIndex:"defaultSort",sort:"asc"}],e.manager.layout.saveColumnSortModelInPreferences(),e.manager.pushUpdateView({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1},!0)}}}),r&&t.push({ID:"hideColumn",title:C.CMDHideColumn,type:"PushItem",icon:"eye-off",action:{callback(){var t;t=o.manager.layout.getColumnIdentifiers(e.cellInfos.columnID).dataIndex,require(["DS/FolderEditor/utils/FolderEditorcontrol"],e=>{e.getContent().getPADTreeListView().changeVisibilityCB(t,!1)})}}}),t},areCommandsAvailable:function(e,t,o){return this._manageSwitchOfCommands(e,t,!0,o)},_manageSwitchOfCommands:function(e,n,i,r){var s=!1,l=i&&!!n&&0===n.length;e&&!l?s=e.isFavorite:n&&n.length>0&&(s=n[0].isFavorite);var u=!1,p=!1,f=!1,m=!1,v=!1,_=!1,C=!1;let b=!1;var F=d.IsEmpty(),y=!1;F||d.getSelectedNodes().every(e=>!(y=y||c.isRootFolder(e.getType())));var D=!1,E=!1,A=!1,T=!1,I=!1,x=!1,P=!1,k=!1;e&&(A="FolderSection_favorite"==e.getType(),T="FolderSection_AllFolders"==e.getType(),x="Personal Workspace"==e.getType(),I=x||e.isPersonal,D=!s&&(c.isRootFolder(e.getType())||c.isPersonalFolder(e.getType())),E=!s&&c.isFolder(e.getType()),P="Personal Workspace"===e.getType()||A||T,k=e instanceof t);var N=!1,M=h.isRelationsColumnsActive();let O=new Set;n&&n.every(function(e){u=u||c.isRootFolder(e.getType())||c.isPersonalFolder(e.getType()),p=p||c.isFolder(e.getType()),N=N||!0===e._busy,f=0!==e.getParents().length,C=!!e.isPersonal&&e.isPersonal,m=m||M&&!0===e.isRelationsObjectNode,v=v||M&&!0===e.isRelationsObjectGroupingNode,_=_||"TRUE"===e.getAttributeValue("isLinkedFolder"),b=b||!!e.getAttributeValue("links");let t=e.getAttributeValue("serviceId");return t=t||"3DSpace",O.add(t),!b||!_||!u||!p||!N||M&&(!m||!v)});let U=b?1:2,R=1===O.size&&O.has("3DSpace");var B=!0;if((A||N||(T||!e)&&n&&0===n.length)&&(B=!1),i||this.enableAllCommands(B),!N){var L={},V=Object.keys(w);return r&&(V=r),V.forEach(t=>{var r=w[t];if(r){var d=!!n&&n.length>0,c=!!e&&!d,h=!0,b=!n||n.length<=1;if("object"==typeof r){if(h&&!R&&r.service&&O.forEach(e=>{h=h&&!!r.service[e]}),h&&M&&v&&(h=!1),(h&&!1===r.TREE&&c||!1===r.CONTENT&&d)&&(h=!1),h&&l&&!0!==r.white_click&&(h=!1),h&&void 0!==r.clipboard&&(h=!F),h&&void 0!==r.multisel&&(h=b),h&&void 0!==r.search&&(h=r.search===g.isSearchActive()),h&&0==r.multiselSearch&&(h=!(!b&&g.isSearchActive())),h&&void 0!==r.custo&&(h=a.isCustomizedEnv()),h&&void 0!==r.setting&&(h=!0===S.getSetting(r.setting)),h&&r.check&&(h=r.check({oneIsRoot:u,oneIsBookmark:p,treeIsRoot:D,treeIsBookmark:E})),h&&r.views&&(h=!a.getContent()||r.views.indexOf(a.getContent().getActiveView())>=0),h&&i&&s&&!0!==r.ctxFavorite&&(h=!1),h&&!1===r.dashboard&&(h=o.isWebInWinEnvironment()),h&&!1===r.webInWin&&(h=!o.isWebInWinEnvironment()),h&&!1===r.ios&&(h=!UWA.Utils.Client.Platform.ios),h&&!1===r.CATIAV6&&(h=!0!==widget.getValue("noCompass")),c=null,h&&r.TREE&&(c=!(!e||d&&void 0!==r.CONTENT))&&(!0===r.TREE?c=!0:(c&&r.TREE.custo&&(c=a.isCustomizedEnv()),c&&r.TREE.treeNode&&(c=k),l||c&&!s&&i&&!1===r.TREE.ctxMenu&&(c=!1),!1!==c&&(!0===r.TREE.Root?c=D:!1===r.TREE.Root&&(c=!D)),!1!==c&&(!0===r.TREE.Bookmark?c=E:!1===r.TREE.Bookmark&&(c=!E)),!1!==c&&(!0===r.TREE.Bookmarks?c=E||D:!1===r.TREE.Bookmarks&&(c=!E&&!D)),!1!==c&&(!0===r.TREE.Sections?c=P:!1===r.TREE.Sections&&(c=!P)),!1!==c&&(!0===r.TREE.BookSection?c=T:!1===r.TREE.BookSection&&(c=!T)),!1!==c&&(!0===r.TREE.FavSection?c=A:!1===r.TREE.FavSection&&(c=!A)),!1!==c&&(!0===r.TREE.Favorites?c=s:!1===r.TREE.Favorites&&(c=!s)),!1!==c&&(!0===r.TREE.PersonalBookmark?c=I:!1===r.TREE.PersonalBookmark&&(c=!I)),!1!==c&&!1===r.TREE.PersonalSection&&(c=!x),!1!==c&&r.TREE.check&&(c=r.TREE.check(e)))),d=null,h&&r.CONTENT){let e=(!M||!m)&&U>=2&&R&&!_;if(d=!!n&&n.length>0)if(1===r.CONTENT||!0===r.CONTENT&&e)d=!0;else{d&&r.CONTENT.custo&&(d=a.isCustomizedEnv()),d&&_&&(d=!0===r.CONTENT.linkedFolder);let e=!1;if(d){let t=r.CONTENT.service,o=!1;!t&&r.CONTENT.noservice&&(t=r.CONTENT.noservice,o=!0),t&&(e=!0,o||!0!==t?O.forEach(e=>{d&&(d=o?0!==t[e]:t[e]>0&&t[e]<=U)}):d=!0)}if(d&&!e&&(!R||U<2)&&(d=!1),!1!==d&&(!0===r.CONTENT.Root?d=u:!1===r.CONTENT.Root&&(d=!u)),!1!==d&&(!0===r.CONTENT.Bookmark?d=p:!1===r.CONTENT.Bookmark&&(d=!p)),!1!==d&&(!0===r.CONTENT.Bookmarks?d=p||u:!1===r.CONTENT.Bookmarks&&!0!==r.linkedFolder&&(d=!p&&!u)),!1!==d&&(!0===r.CONTENT.FavContent?d=n[0].isFavorite:!1===r.CONTENT.FavContent&&(d=!n[0].isFavorite)),!1!==d&&!1===r.CONTENT.rootInClipboard&&(d=!y),!1!==d&&void 0!==r.CONTENT.search&&(d=r.CONTENT.search===g.isSearchActive()),!1!==d&&!1===r.CONTENT.childProduct&&(h=d=!f),!1!==d&&!1===r.CONTENT.PersonalBookmark&&(h=d=!C&&d),!1!==d&&(r.CONTENT.check||r.CONTENT.types)){var N=r.CONTENT.types,B=r.CONTENT.check,V=!1;n.every(function(e){return V=(V=N&&e.options&&e.options.type?N.indexOf(e.options.type)>=0:!N)&&(!B||B(e))}),d=V}}}h=h&&(!0===d||!0===c||null===d&&null===c)}L[t]=h,i||this._switchCommand(t,h,r.type)}}),L}},enableAllCommands:function(e){var t=n.getCommands();for(var o in t){var i=n.getCommand(o);UWA.is(i)&&i.enable&&(e?this._switchCommand(o,!0):"ListSnapshotsHdr"!==o&&this._switchCommand(o,!1))}},getModelEvents:function(){return _.getModelEvents()},_getCurrentFolder:function(e){return this._asyncUpdatePromise&&this._asyncUpdatePromise.cancel(),this._asyncUpdatePromise=new s((t,o)=>{e?t(e):u.getCurrentBookmarkInfo().then(t).catch(o)}),this._asyncUpdatePromise},updateCommands:async function(e,t){let o=this._parent,n=this;this._getCurrentFolder(t).then(t=>{let i=p.getSelectedContent();i=i||(e?[e]:[]),o.call(n,t,i)})}})}),define("DS/FolderEditor/models/_xBookCVParser",["DS/FolderEditor/models/xBookNodeModel","DS/PADServices/utils/AttributesMgtV2","DS/WebappsUtils/WebappsUtils","DS/PADUtils/PADPredicatesNls","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorUtil"],function(e,t,o,n,i,r){"use strict";var s="ds6w:Document",a={COLLAPSED:{state:"collapsed"},NO_CHILDREN:{state:"noChildren"},PARTIALLY_EXPANDED:{state:"partiallyExpanded"},EXPANDED:{state:"expanded"}};Object.freeze(a);var l={};function d(e,t){for(var o={},n=e||{},i=Object.getOwnPropertyNames(n),r=0;r<i.length;r++)t[i[r]]?t[i[r]]!==e[i[r]]&&(o[i[r]]=e[i[r]]):o[i[r]]=e[i[r]];return o}function c(e,t,o){var i=!1,r=null,s={};t.label!==e.options.label&&(s.label=t.label,i=!0),function(e,t){var o=!1;if(e instanceof Array&&t instanceof Array){var n=e.length;if(n===t.length){for(var i=0;i<n;i++)if(e[i]!==t[i])return!1;o=!0}}return o}(t.icons,e.options.icons)||(s.icons=t.icons,i=!0),t.thumbnail!==e.options.thumbnail&&(s.thumbnail=t.thumbnail,i=!0),t.display!==e.options.display&&(s.display=t.display,i=!0),t.type!==e.options.type&&(s.type=t.type,i=!0),null!==r||"expanding"!==e.getState()||o&&!1===o.changeState||(r=a.EXPANDED);var l=d(t.grid,e.options.grid);if(UWA.equals(l,{})||(s.grid=l,i=!0),t.padgrid){var c=d(t.padgrid,e.options.padgrid);UWA.equals(c,{})||(s.padgrid=c,i=!0)}i&&(o&&!0===o.deleteTempOptions&&(delete e.options.waiting4validation,delete e.options.alternText),e.updateOptions(s),e._manageNLS=!0,o&&o.needRequestNls&&e.isVisible()&&n.updateNLS(e)),r&&e.setState(r)}function u(e){for(var t=0,o=0;o<e.length;o++){t=e[o].options.grid.globaltype!==s?t+1:t}return t}return l.parse_attributes=function(e,t){var o=require("DS/PADUtils/PADSettingsMgt"),n={type:e["ds6w:type"],resourceid:e.resourceid,grid:{},gridValue:{}};for(let t in e){let o=e[t];UWA.is(o)&&UWA.is(o.replace,"function")&&(o=o.replace(/\n/g," "),e[t]=o),"string"==typeof o&&-1!==o.indexOf("[")&&-1!==o.indexOf("]")&&-1!==(o=(o=o.replace("[","")).replace("]","")).indexOf('"')&&(o=o.replaceAll('"',"")),r.addValueInGrid(n,t,o)}let i=e.icon||e.type_icon_url;n.icons=i?[i]:[];let s=e[t];if(s&&(n.label=s,n.display=s),o.getSetting("activateFUN085903")){let t=e["ds6w:globalType"];t&&(n.grid.globaltype=t)}return n.grid&&n.grid.owner&&!n.grid["ds6w:responsible"]&&(n.grid["ds6w:responsible"]=n.grid.owner),n},l.process={expand:function(o){o.starting_from_root=void 0===o.starting_from_root||o.starting_from_root;var n=[],i=require("DS/PADUtils/PADSettingsMgt").getSetting("activateFUN085903")&&(-1===o.expand_level||o.expand_level>1);o.treedocument.prepareBroadcastSelect();let r=o.realExpandedNodes;r=r||Object.values(o.root_nodes);let a={};const d=require("DS/PADUtils/PADPredicatesNls");var p,g;r.forEach(e=>{a[e.getID()]=e,e.getAllDescendants({onlyVisibleNodes:!0}).forEach(e=>{d.updateNLS(e),e.isExpanded()&&(a[e.getID()]=e)})}),p=o.treedocument,g=function(){var p={nodes:{}};o.response.results&&o.response.results.length>0&&o.response.results.forEach(function(e){if(e.from&&e.to){let t=p.nodes[e.from],o=p.nodes[e.to];t&&o&&(e._to=o,!0!==t._noChildren&&t._children.push(e))}else if(e.Path){if(o.selectMatches){let t=p.nodes[e.Path[e.Path.length-1]];t&&(t._select=!0),e.matching_lengths&&e.matching_lengths.length>0&&e.matching_lengths.forEach(t=>{let o=p.nodes[e.Path[t-1]];o&&(o._select=!0)})}}else{var n=l.parse_attributes(e,t.getTreeColumn());let i=a[n.resourceid];p.nodes[n.resourceid]={attributes:n,_noChildren:"refresh"===o.mode&&(!i||!i.isExpanded()&&0===i.getChildren().length),_children:[]}}});var g="expanded",f=!1;"validate_branch"===o.mode?g="partiallyExpanded":"find_in_ctx"===o.mode?(g="partiallyExpanded",i=!1):"refresh"===o.mode&&(f=!0,i=!1),r.forEach(t=>{let r=t.getID(),a=p.nodes[r];if(a){let r=o.selectMatches;!function t(o,n,i){let r=i.selectMatches,a=i.settingExpandAllNotShape,l=i.possibleParents,d=i.refresh,u=i.state;var p=o.hasChildren(!0);n._children.forEach(n=>{let d=n["ro.plminstance.V_treeorder"]||n.TreeOrder;d&&(d=parseFloat(d),d=isNaN(d)?-1:d);let u=d||-1,g=n.resourceid,f=n["ds6w:type"],h=n["ds6w:label"],m=n._to,v=p?o.getChildByIds(g,m.attributes.physicalid):null;if(UWA.is(v,"object")){var _=UWA.clone(m.attributes);_.relationOrder=u,_.grid.instanceName=h,delete v.options.waiting4validation,delete v.options.alternText;var S={needRequestNls:!0,changeState:!1};c(v,_,S)}else{var C=UWA.clone(m.attributes);C.relationid=g,C.relationtype=f,C.relationOrder=u,C.grid.instanceName=h,v=new e(C),o.addChild(v),v._manageNLS=!0}let b=!v.hasChildren(!0);a&&b?(v.setState({state:"noChildren"}),v.options.children=void 0):("noChildren"===v.getState()||"expanded"===v.getState()&&b)&&(v.setState({state:"collapsed"}),v.options.children=[]),a&&v.options.grid.globaltype===s&&l.push(o),m._children.length>0&&t(v,m,i),r&&!0===m._select&&v.select()}),!0!==d&&"expanded"!==o.getState()&&(o.setState({state:u}),o.options.padstate=u),o.childComputed=!0}(t,a,{selectMatches:r,settingExpandAllNotShape:i,possibleParents:n,refresh:f,state:g}),c(t,a.attributes,{changeState:!f}),r&&!0===a._select&&t.select(),delete t._manageNLS,d.updateNLS(t)}}),i&&function(e,t){t._collapseRepDuringExpandAll=!0;for(var o=0;o<e.length;o++){var n=e[o];1===n.getNumberOfChildren()&&0===u(n.getChildren())&&n.collapse()}delete t._collapseRepDuringExpandAll}(n,o.treedocument),o.treedocument.pushBroadcastSelect()},p.wrapInTransaction(function(){p.withTransactionUpdate(g)})},insert_temporary_branches:function(t){if(!UWA.is(t.treedocument,"object")||!UWA.is(t.branches,"array"))throw new Error("Invalid input parameters");var n=[],r=[],s=[],a=[],l=[],d=t.treedocument,c=t.node_state?t.node_state:"partiallyExpanded",u=t.branches;return d.withTransactionUpdate(function(){u.forEach(function(d){var u,p=null,g=t.treedocument.getRoots(),f=0;for(u=0;u<g.length&&null===p;u++)if(d[0]===g[u].getID()){a.push(d[0]);var h=(p=g[u]).getNodeByPath(d,void 0,void 0,!0);h&&(p=h,f=d.indexOf(p.getID()))}if(p&&p.getID()!==d[d.length-1])for(var m=f+1;m<d.length;m+=2){var v=d[m],_=d[m+1],S={resourceid:_,relationid:v,label:i.loadingText,icons:[o.getWebappsAssetUrl("ENXNav","icons/32/loading22x22.gif")],thumbnail:o.getWebappsAssetUrl("ENXNav","icons/32/loading.gif"),alternText:i.loadingText,waiting4validation:!0},C=new e(S),b=p.getState();p.addChild(C),"collapsed"===b?(c!==b&&(p.setState({state:c}),p.options.padstate=c),p.childValidationChecker()):"partiallyExpanded"===b&&(p.setState({state:b}),p.options.padstate=b,-1===r.indexOf(_)&&r.push(_),-1===s.indexOf(v)&&s.push(v)),p=C,-1===n.indexOf(_)&&n.push(_),-1===l.indexOf(v)&&l.push(v)}})}),{ids_to_fetch:n,relationids:l,rootsAlreadyLoaded:a,visibleNodesIds:r,visibleNodesRelIds:s}},refresh_nodes:function(e){if(!UWA.is(e.treedocument,"object")||!UWA.is(e.response,"object")||!UWA.is(e.refresh_parameters,"object"))throw new Error("Invalid input parameters");var o=[],i=function(e,o){let n={};o.attributes.forEach(e=>{n[e.name]=e.value});var i=l.parse_attributes(n,t.getTreeColumn());return i&&0===i.relcount&&(i.children=null),i};return e.treedocument.withTransactionUpdate(function(){e.response.results.forEach(function(t){for(var r="",s=0;s<t.attributes.length;s++){var a=t.attributes[s];if("resourceid"===a.name){r=a.value;break}}if(""===r)throw new Error("Resourceid not found in fetch result for "+JSON.stringify(t));if(e.refresh_parameters.modified&&(-1!==e.refresh_parameters.modified.indexOf(r)||-1!==e.ids_modified.indexOf(r))){e.treedocument.getRoots().forEach(function(e){e.getNodesById(r).forEach(function(e){e.updateOptions(i(0,t)),n.updateNLS(e),null===e.options.children&&e.setState({state:"noChildren"}),o.push(e)})});var l=e.treedocument.searchRootById(r);l&&(l.updateOptions(i(0,t)),n.updateNLS(l),e.treedocument.getModelEvents().publish({event:"onRootAdded",data:{nb_root:e.treedocument.getRoots().length,added_node:l}}),o.push(l))}})}),[]}},l}),define("DS/FolderEditor/views/additionalColumns/BookmarkLocationColumn",["UWA/Core","UWA/Class","DS/FolderEditor/service/FolderServices","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/service/FolderEditorWebServiceReadMode","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/PADServices/utils/GlobalUtils","DS/FolderEditor/utils/FolderSearch","DS/ApplicationFrame/CommandsManager","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/BookmarkLocationUtil","DS/Utilities/Dom","DS/Controls/TooltipModel"],function(e,t,o,n,i,r,s,a,l,d,c,u,p,g){"use strict";var f=t.singleton({init:function(e){this._parent(e)},isAdditionalColumnsAvailable:function(t){if(!1===e.is(t,"function"))throw new Error("A callback function should be defined");!function(e){var t={dataIndex:"bookmarkLocation",text:r.column_BookmarkLocation,width:100,minWidth:80,maxWidth:200,isHidden:!1,sortableFlag:!1,alignment:"left",typeRepresentation:"string",getCellClassName:function(e){return s.createCSSClass("bk-ellipsys-span-column",".bk-ellipsys-span-column:hover{text-decoration: underline;}\n.bk-ellipsys-span-column{cursor:pointer;color: #23527c;width: 100%;display: inline-block;vertical-align: middle;padding-left: 7px}"),"bk-ellipsys-span-column"},customisation:{dataIndex:"bookmarkLocation",exportable:{lock:!0,value:!1},layout:{removable:!1}}};f._columnDataIndex=["bookmarkLocation"],f._columnDef={bookmarkLocation:t},e()}(function(){t(!0)})},getName:function(){return"bookmarkLocation"},getManagedColumnNames:function(){return this._columnDataIndex},toBeUpdated:function(e,t){var o=!1;return void 0!==e.bookmarkLocation&&""!==e.bookmarkLocation||(o=!0),o},getOnCellClickCB:function(e,t){return e===this.getName()&&function(e){u.openBookmark(e.nodeModel)}},getCellReusableContent:function(){return{id:this.getName(),buildContent:function(){return u.getHtmlElemFromPath("",!0)}}},_getWidthToDisplayLocation:function(e){let t=0,o=d.getContent();if(!o)return t;let n=o.getPADTreeListView();if(!n||!n.getManager())return t;var i=n.getFontDetails(),r=i.fontSize,s=i.fontMargin,a=i.fontSytle;return s+(t=Math.ceil(p.computeStringWidth(e,r,a,!1,!1)))+s},updateAttributesOnResize:function(e,t){let o=d.getContent();if(!o)return;let n=o.getPADTreeListView();if(n&&n.getManager()){var i=n.getColumnWidth(this.getName());for(let o=0;o<e.length;++o){var r=n.getManager().layout.getCellIDFromCoordinates({rowID:e[o]._getRowID(),columnID:t});let s=n.getManager()._getViewAt(r)._getReusableContent();if(s&&s.childNodes&&s.childNodes.length>0){let e=this._getWidthToDisplayLocation(s.childNodes[0].innerText);s.childNodes[0].innerText=u.getResizedText(i,e,s.getAttribute("titlex"),s.childNodes[0].innerText),s.tooltipInfos=new g({longHelp:s.getAttribute("titlex")})}}}},onCellRequest:function(e){let t=d.getContent();if(!t)return;let o=t.getPADTreeListView();if(o&&o.getManager()){if(e&&e.cellModel){var n=o.getManager().reuseCellContent("bookmarkLocation");if(n.setData(e.cellModel),n.childNodes&&n.childNodes.length>0){var i=o.getColumnWidth(this.getName());let t=this._getWidthToDisplayLocation(n.childNodes[0].innerText);return n.childNodes[0].innerText=u.getResizedText(i,t,n.getAttribute("titlex"),n.childNodes[0].innerText),n.tooltipInfos=new g({longHelp:n.getAttribute("titlex")}),e.cellView._setReusableContent(n),!0}}}},updateAttributes:async function(t,o){if(!1===e.is(t,"object"))throw new Error("The object ids to modify must be specify");if(!1===e.is(o,"function"))throw new Error("A callback function should be defined");let n=await u.updateNodesWithPath(t.nodes);o(n=JSON.stringify(n))},getAdditionalColumnsUXDGV:function(t){for(var o=[],n=0;n<t.length;n++)o.push(t[n].dataIndex);for(var i=0;i<this._columnDataIndex.length;i++){var r=this._columnDataIndex[i],s=e.clone(this._columnDef[r]),a=o.indexOf(r);-1===a?t.push(s):t[a]=e.extend(t[a],s,!0)}},getCellClassName:function(e,t){if(t==this._columnDataIndex[0]){let e="bk-ellipsys-span-column",t=".bk-ellipsys-span-column:hover{text-decoration: underline;}\n.bk-ellipsys-span-column{cursor:pointer;color: #23527c;width: 100%;display: inline-block;vertical-align: middle;padding-left: 7px}";return s.createCSSClass(e,t),e}}});return f}),define("DS/FolderEditor/models/xTreeNodeModel",["DS/TreeModel/TreeNodeModel","DS/FolderEditor/Folder_CSO"],function(e,t){"use strict";function o(o){e.call(this,o),t.setInfoOnTreeNode(this)}return o.prototype=Object.create(e.prototype),o}),define("DS/FolderEditor/views/FolderOrderCmd",["UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/views/FolderMode","DS/FolderEditor/service/FolderTypeService"],function(e,t,o,n,i,r,s){"use strict";return e.extend(t,o,{_name:"folder_orderTools",_defaultOptions:{sortMode:"alpha",sortOrder:"asc"},init:function(e){this._parent(e),this.sortMode=widget.getValue("sortMode")||this._defaultOptions.sortMode,this.sortOrder=widget.getValue("order")||this._defaultOptions.sortOrder},toggleButton:function(){this.sortMode="alpha",this._toggleButton()},toggleButtonDate:function(){this.sortMode="date",this._toggleButton()},_toggleButton:function(e){if(void 0!==e?(this.sortMode="defaultSort",this.sortOrder="asc"):this.sortOrder&&("asc"===this.sortOrder?this.sortOrder="desc":this.sortOrder="asc"),"read"==r.getCurrentModeType()){var t=i.getTreeCont();t._indexModeforReadData.resetInfoIndex(),t._rootNodeFolders.collapse({updateView:!0}),t._rootNodeFolders.expand({updateView:!0})}else this.sortingNodesUnsensitiveCase();widget.setValue("sortMode",this.sortMode),widget.setValue("order",this.sortOrder)},isTreeSort:function(){return"defaultSort"==this.sortMode},isAlphaSort:function(){return"alpha"==this.sortMode},getSortMode:function(){return this.sortMode},sortingNodesUnsensitiveCase:function(){var e=i.getTreeCont();e&&e._folders_TreeView&&(e._folders_TreeView.sortModel=[{dataIndex:"tree",sort:this.sortOrder}],e._folders_TreeView.reapplySortModel())},sortingChildrenNodes:function(e,t){"defaultSort"==t&&(this.sortMode=t);var o=this,n=i.getTreeCont()._folders_TreeView;n.prepareUpdateView(),e.sortChildren({isRecursive:!0,sortFunction:function(e,t){return("asc"===o.sortOrder?1:-1)*o.mySortFunction(e,t)}}),n.pushUpdateView()},sortByDate:function(e,t){let o;try{o=new Date(e.options.created)>new Date(t.options.created)?1:new Date(e.options.created)<new Date(t.options.created)?-1:0}catch(n){o=e.options.created<t.options.created?-1:1}finally{return o}},mySortFunction:function(e,t){this.sortOrder;var o="FolderSection_favorite"===e.getParent().getType();if(o)return null;if(e.isRoot()&&t.isRoot()||o)return null;if("date"===this.sortMode)return this.sortByDate(e,t);if("defaultSort"==this.sortMode){if(s.isFolder(e.getType())&&s.isFolder(t.getType())){let o=parseFloat(e.options.relationOrder),n=parseFloat(t.options.relationOrder);return o>n?1:n>o?-1:0}return this.sortByDate(e,t)}return n.compareLabels(e.options.label,t.options.label)}})}),define("DS/FolderEditor/controllers/ReadMode",["DS/FolderEditor/controllers/CommonContentMode","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/views/FolderMode","DS/FolderEditor/utils/FolderListContent_Read","DS/FolderEditor/tagger/TaggerContentProxy"],function(e,t,o,n,i,r,s){return e.extend({supportClientSort:!1,init:function(e){this._parent(e);var t=this;this._indexInfo=null,this._currentFldId=null,this._isPageRefreshed=!1,this._initialFilter=null,n.onSearchChange(function(){t.resetInfoIndex()})},enable:function(){s.setUpdateMode(!1)},disable:function(){s.setUpdateMode(!0)},convertData:function(e){return t.convertToExaleadDataFormat(e)},manageError:function(e){return(e="string"==typeof e?JSON.parse(e):e).error.errorMessage},smartFilteringAvailable:function(){return!1},loadContents:function(e){return this.loadIndexContents(e)},filteringByService:function(){return"FolderSection_AllFolders"===o.getCurrentBookmarkId()||!widget.getValue("filtered-content")},withInfiniteScrolling:function(){return"read"==i.getCurrentModeType()&&!widget.getValue("filtered-content")},onSetPathTags:function(e){this.unColorizeChildren(e)},getObjectsInTree:function(){return this._indexInfo?this._indexInfo.nhits:null},onFilterFilteringEvent:function(){},unColorizeChildren:function(e){e.options.model.withTransactionUpdate(function(){e.options.model.getRoots().forEach(function(e){var t={grid:{bi_color:"rgba(0, 0, 0, 0)"}};e.getAllDescendants().forEach(function(e){delete e.options.color,e.updateOptions(t)})})})},getNumberLastResult:function(){return this._indexInfo?this._indexInfo.nresults:0},setInfoIndex:function(e){this._indexInfo=e||null},getInfoIndex:function(){return this._indexInfo},resetInfoIndex:function(){this.cancelFacetsLoading(),this._isPageRefreshed=!0,this._indexInfo=null},getModeType:function(){return"read"}})}),define("DS/FolderEditor/controllers/FavoritesMode",["DS/FolderEditor/controllers/CommonMode","DS/WebappsUtils/WebappsUtils","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/service/FolderTypeService","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,t,o,n,i,r,s){var a=t.getWebappsAssetUrl("FolderEditor","icons/I_Bookmark_v2.png"),l=t.getWebappsAssetUrl("FolderEditor","icons/I_BookmarkInherit_v2.png"),d=t.getWebappsAssetUrl("FolderEditor","icons/I_Bookmark108x144.png"),c=t.getWebappsAssetUrl("FolderEditor","icons/I_BookmarkInherit108x144.png");return e.extend({init:function(e){this._parent(e)},convertData:function(e){let t=r.isRootFolder(e.type);var o=t?"Workspace":"Workspace Vault",n=t?s.name_RootFolder_type:s.name_Folder_type,u=e;e.hasOwnProperty("toRemove")&&!e.toRemove||(u={id:e.id,type:o,displayType:n,label:e.label,name:e.name,favoriteTitle:e.name,description:"",created:"",modified:"",owner:"",responsible:"",organizationResponsible:"",project:"",revision:"",status:"",policy:"",icon:e.inherit?l:a,largeicon:e.inherit?c:d});var p=i.convertToExaleadDataFormat(u);return p.resourceid=e.id,p.nodeAttrs={},p.nodeAttrs.isFavorite=!0,p.favoriteTitle=u.favoriteTitle,p.nodeAttrs.isPersonal=e.isPersonal,p.nodeAttrs.toRemove=e.toRemove,p},loadContents:function(e){this._parent();var t=this;return new Promise(function(e,o){t._contentHandleRequest=n.getTreeCont().getFavorites({view:"CONTENT"}).then(t=>{e({contents:t})}).catch(o)})},getModeType:function(){return"favorites"}})}),define("DS/FolderEditor/xBookDocument",["UWA/Core","DS/Logger/Logger","DS/i3DXCompassServices/i3DXCompassPubSub","DS/IPClassifyUXUtil/CredentialsView","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/WidgetServices/WidgetServices","DS/TreeModel/TreeDocument","DS/FolderEditor/models/xBookNodeModel","DS/FolderEditor/models/_xBookCVParser","DS/PADUtils/PADWSAccess","DS/PADUtils/PADPredicatesNls","DS/IPClassifyUtil/IPClassifyAlert","DS/PADUtils/PADCommandProxy","DS/PADUtils/PADTransactionManager","DS/ApplicationFrame/CommandsManager","i18n!DS/PADUtils/assets/nls/PADUtils.json","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/service/FolderEditorWebServiceReadMode","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderLoaderGlobal","DS/FolderEditor/tagger/TaggerContentProxy","DS/PADServices/utils/GlobalModelEvents","DS/FolderEditor/plugins/product/PrdUtils","DS/FolderEditor/views/FolderMode","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderCommunication","DS/IPClassifyUXUtil/utils/CancellablePromise","DS/Utilities/Utils"],function(e,t,o,n,i,r,s,a,l,d,c,u,p,g,f,h,m,v,_,S,C,b,F,y,D,E,w,A,T,I,x){"use strict";function P(e){if("object"!=typeof e)throw new Error(e+" is not a json object")}function k(e,t,o){let n=t.highLightNodes;return new Promise((r,s)=>{var a=t.nodes[o];a.setState({state:"expanding"});let l={};l[a.getRoot().getID()]={paths:[a.getOccurencePath()]},S.expandProductsForDisplay(l,{db:!1,findIn:{query:t.query},filters:y.getFilterTags(),max_output_paths:i.getSetting("maxPathsForSearch")}).then(t=>{try{P(t);var o=a;o.isRoot()||(o=o.getRoot());let u={};u[o.getID()]=o;d.process.expand({treedocument:e,root_nodes:u,response:t,mode:"find_in_ctx",expand_level:-1,selectMatches:!0,realExpandedNodes:[a]});var n=b.getContent().getPADTreeListView();if(n)n.getManager().reapplySortModel()}catch(e){console.log(e),e.type&&"TimeoutError"===e.type?(p.displayNotification({message:v.find_in_context_timeout,className:"error"}),function(e){for(var t=0;t<e.length;t++){var o=e[t];setPartialIfHasChildren(o),o.childComputed=!1,o.processDescendants({processNode:function(e){setPartialIfHasChildren(this),this.childComputed=!1}})}}([a])):p.displayNotification({message:m.generic_service_failure,className:"error"})}finally{if(!0!==t.timeoutOccurs){var i=e.getXSO().get();i.forEach(function(t){e._selection.push(t.getOccurencePath())});for(var s,l={paths:[],reframe:!0,expand_level:-1},c=0;c<i.length;c++)l.paths.push(i[c].getOccurencePath());e._commandProxy.padExpand(l),0===a.options.relcount?(a.options.children=null,s="noChildren"):s="partiallyExpanded",delete a._expandAllPending,a.setState({state:s}),M(!0),e.getXSO().empty()}r()}}).catch(function(t){console.log(t),N(a),a._expandAllPending&&delete a._expandAllPending,M(!0),a.setState({state:"collapsed"}),n(e.getRoots(),[],[]),F.removeComponentToLoad("contentView","content"),t&&t.timeout&&p.displayNotification({message:v.find_in_context_timeout,className:"error"}),s()})})}function N(e){e.preExpandDone({preventExpandAll:!1,state:"collapsed"})}function M(e){var t=h.getCommand("ExpandAll");t&&(e?t.enable():t.disable())}return a.extend(f,{_broadcastSelect:!0,_selected_paths:[],id:"mainNodeModel",_selection:[],_selectedIdx:null,_focusOn:!1,_reframeFocus:!1,_currentApp:null,_emptyFromProxy:!1,_isVolumeFilter:!1,init:function(o){var n=o||{},i=this;if(this._logger=t.getLogger("DS/FolderEditor/xBookDocument"),i.renderTo=o.renderTo?o.renderTo:document.body,n.nodeModelClass=l,this._parent(n),this.options.viewport={graph:null,tree:null},this.onPreExpand(this.xnav_expand.bind(this)),this.forceSyncModel4TreeListView=function(){},this.addEvent("onTransactionEnd",function(e,t){t||("expand"!==e&&"refresh"!==e||i.addTagsForChildren(),i.fromTransactionEnd=!0)}),D.subscribe({event:"updateContentNodes"},e=>{if(e.items){let i=[];for(var t in e.items){let r=e.items[t],s=this.getNodesById(t);if(s.length>0){let e=s[0];if(r.badge&&A.setBadges(e,r.badge),r.attributes)for(var o in r.attributes)e[o]=r.attributes[o];if(r.options&&(n={grid:r.options.grid,resourceid:r.options.resourceid,label:r.options.label},e.updateOptions(n)),r.grid||r.relationOrder){var n=null;r.grid?n={grid:r.grid}:r.relationOrder&&(n={grid:{relationOrder:r.relationOrder},relationOrder:r.relationOrder}),e.updateOptions(n)}i.push(t)}}}}),!e.is(n.remove_broadcast)||!0===n.remove_broadcast){i._commandProxy=g.create({events:{onSelect:function(t,o){if(o.originWidgetId!==widget.id&&!0!==t.searchDone){if(1==t.focusOn&&t.sharedID&&t.sharedID!==r.getSharedId())return;var n=t.paths;i._selected_paths=e.clone(n);!function(){try{i._doNotBroadcastSelect=!0,i._selected_paths.length?i._selectOccurence("",!0,!0):o.appid===g.appId()&&(i._emptyFromProxy=!0,i.unselectAll(),i._directSelection=!1);for(var e=[],t=0;t<i._selected_paths.length;t++)i.getNodeByOccurencePath(i._selected_paths[t])&&e.push(i._selected_paths[t]);e.length===n.length&&e.length>0&&e.forEach(function(e){var t=e.length;if(t>2){var o=i.getNodesById(e[t-3]);o&&o.length>0&&!0}}),i._selected_paths=e}finally{setTimeout(function(){i._doNotBroadcastSelect=!1},500)}}()}}}});var s=x.debounce(async function(){if(i._directSelection=!0,i._selected_paths=[],!0!==i.searchProgress){let e=await i._buildSelectData();i._commandProxy.select(e)}i.broadcastSelect(i.getXSO().get())},300);this.getXSO().onPostAdd(function(){s(),i._focusOn=!1}),this.getXSO().onPostRemove?this.getXSO().onPostRemove(s):this.getXSO().onRemove(s),this.getXSO().onEmpty(function(){!1===i._emptyFromProxy?i._doNotBroadcastSelect=!1:i._emptyFromProxy=!1,s()}),this.getXSO().onPreEmpty(function(){!1===i._emptyFromProxy&&(i._doNotBroadcastSelect=!0)}),document.addEventListener("keyup",function(e){27===e.keyCode&&i.getXSO().empty()})}},addTagsForChildren:function(){var e=new Set,t=new Set;this.getRoots(!0).forEach(o=>{o.getAllDescendants().forEach(t=>{t.isRelationsObjectNode||e.add(t.getID())}),o.isVisible()&&t.add(o.getID())}),e.size>0&&y.addObjectsTags([...e]).then(e=>{this.filterFromIds([...e,...t],!1)}).catch(()=>console.log("Error during retrieve tags"))},updateLinksFromStatus:function(e){let t=_.getCountToLoadOnGrid(),o=this.getRoots(!0),n=!0;for(let i=o.length-1;i>=0;i--){let r=o[i],s=!!t&&i>t,a=r.getAttributeValue("links");n=n&&!!a,(a||s)&&(e||!s&&!n?r.isVisible()||!1===r.bkTempVisible||r.filterIn():r.filterOut())}},filterFromIds:function(e,t){this.wrapInTransaction(()=>{this.withTransactionUpdate(()=>{var o=new Set(e),n=this.getRoots(!0).slice(0);n.forEach(function(e){e.filterIn(!0)});var i=function(e){(o&&o.has(e.getID())||e.isRoot()&&t||e.isRelationsObjectNode)&&(delete e.bkTempVisible,e._filterStatus="IN",!0!==e.isRelationsObjectNode&&e.getParents().forEach(function(e){delete e.bkTempVisible,e._filterStatus="IN"}));var n=e.getChildren();n&&n.length>0&&n.slice(0).forEach(function(e){i(e)})},r=function(e){if("IN"===e._filterStatus){var t=e.getChildren();t&&t.length>0&&t.slice(0).forEach(function(e){r(e)})}else e.filterOut();delete e._filterStatus};n.forEach(function(e){i(e)}),n.forEach(function(e){r(e);let t=e.getVisibleChildren()?e.getVisibleChildren().length:0;(e.getChildren()?e.getChildren().length:0)>t&&(e.setState({state:"partiallyExpanded"}),e.options.padstate="partiallyExpanded")})})})},getSelectedNodesForOFW:function(){var e=[],t=this._selected_paths;t&&t.length&&this.getXSO().get().length?this.getRoots().forEach(function(o){for(var n=0;n<t.length;n++){var i=o.getNodeByPath(t[n],void 0,void 0,!0);i&&e.push(i)}}):e=this.getXSO().get();return e},_getLastViewpoint:function(e){e(null)},broadcastSelect:async function(e){if(e=e||this.getSelectedNodes(),!0===this._broadcastSelect&&!0===this.options.authorize_setStructure)if(T.setObject_on_compass({nodes_2_open:e}),!1===i.getSetting("settypes"))r.setStructure_4_open_in_cv5({nodes_2_open:e,selected_paths:this._selected_paths});else if(E.setTypesForOFW(this),!await E.selectedNodesContainsOnlyVPMReference(e)&&e&&e.length>0){var t={objectId:e[0].getID(),envId:r.getPlatformId(),contextId:n.getCredential(),serviceId:e[0].getAttributeValue("serviceId")};o.publish("setObject",t)}},prepareBroadcastSelect:function(){this._doNotBroadcastSelect=!0},pushBroadcastSelect:async function(){if(!0!==this.searchProgress){let e=await this._buildSelectData();this._commandProxy.select(e)}this.broadcastSelect(),this._doNotBroadcastSelect=!1},_findInCtx:function(t){this.searchProgress=!0,this.prepareUpdate(),this.prepareBroadcastSelect(),this._selection=[],this.getXSO().empty(),this._flatNodes=[];let o=t.highLightNodes;var n=[];if(!widget.body.contentViewLoaderContainer){var i=b.getContent().getContent(),r=null;i&&(r=i.getElement(".xbook_viewmain")),widget.body.contentViewLoaderContainer=e.createElement("div",{class:"FolderEditor_contentView_loader"}).inject(r),F.setContainer("contentView",widget.body.contentViewLoaderContainer)}F.addComponentsToLoad("contentView",{content:""}),t.nodes&&!t.findFlatInBookmark&&widget.getValue("allow-products-expand")&&n.push(function e(t,o,n){return new Promise(function(i,r){n<o.nodes.length?k(t,o,n).then(function(){e(t,o,n+1).then(i).catch(r)}):i()})}(this,t,0)),t.findFlatInBookmark&&n.push(function(e,t){return new Promise(function(o){if(t.query)e._flatNodes=e.getRoots();else for(var n=e.getRoots(),i=0;i<n.length;i++){var r=n[i];if(r.id===t.rscIdToSearch){e._flatNodes.push(r);break}}o()})}(this,t)),Promise.all(n).then(()=>{this.pushUpdate(),this.pushBroadcastSelect(),this.searchProgress=!1,this._doNotBroadcastSelect=!0,o(this.getRoots(),this._selection,this._flatNodes),F.removeComponentToLoad("contentView","content")}).catch(e=>{console.log(e),o(this.getRoots(),[],[]),F.removeComponentToLoad("contentView","content"),console.log("Find in Context finished with error"),this.searchProgress=!1})},withBroadcastSelect:function(e){this.prepareBroadcastSelect(),e(),this.pushBroadcastSelect()},xnav_expand:function(e){var t=e.data,o=t.nodeModel,n=!!t.expandAll&&t.expandAll,r=t.numberOfLevelsToExpand?t.numberOfLevelsToExpand.toString():i.getSetting("expand_iter");if(void 0!==o.options.fakeNodesTable)return;n&&(o._expandAllPending=!0,M(!1)),this.invalidateViewPort(),n&&(r="-1");var s=parseInt(r),a=i.getSetting("activateFUN085903")&&(-1===s||s>1),l=this;if("partiallyExpanded"===e.target.options.padstate&&(o.childComputed=!1),o.childComputed){var c=o.getDepth();if(function(e,t,o){function n(e){if(e.childComputed&&e.hasChildren()){var t=e.getChildren();if(1===t.length)return"ds6w:Document"===t[0].options.grid.globaltype}}var i=function(e,t,o){var r=!0;if((-1===t||o<t)&&(r=!(-1===t||t>o),e.childComputed))if(e.hasChildren()){for(var s=e.getChildren(),l=!0,d=0;d<s.length&&!0===l;d++){var c=s[d];if(!(c.childComputed&&a&&n(c))&&(c.childComputed&&"noExpandState"!==c._expandState&&(c.getDepth()<t||-1===t)&&c.setState({state:"expanded"}),void 0===(l=i(c,t,o+1))))throw new Error("Undefined no_expand_needed flag")}r=l}else r=!0;return r};return i(e,t,o)}(o,n?s:c+s,c))return e.target.preExpandDone({preventExpandAll:!0}),l._selectOccurence(),delete o._expandAllPending,void M(!0)}var u=o;o.isRoot()||(u=o.getRoot()),l.prepareUpdate();let g={};g[u.getID()]={paths:[o.getOccurencePath()]};S.expandProductsForDisplay(g,{db:"authoring"==w.getCurrentModeType(),level:r}).then(t=>{var n,i=!1;try{if(P(t),n=l.startTransaction("expand"),t.results&&0!==t.results.length){"partiallyExpanded"===o.options.padstate&&l._commandProxy.padExpand({paths:[o.getOccurencePath()],expand_level:r});var s=o,a=parseInt(r);-1!==a&&(a+=0);let e={};e[(s=u).getID()]=s,d.process.expand({treedocument:l,root_nodes:e,response:t,mode:"default",expand_level:a,selectMatches:!1,realExpandedNodes:[o]});var c=b.getContent().getPADTreeListView();if(c)c.getManager().reapplySortModel();i=!0}else p.displayNotification({message:m.generic_service_failure,className:"error"})}catch(e){console.log(e),p.displayNotification({message:m.generic_service_failure,className:"error"})}finally{var g;i&&(o.childComputed=!0,l._selectOccurence()),n&&n.end(),delete o._expandAllPending,M(!0),o.hasChildren(!0)||(g="noChildren",o.options.children=null),e.target.preExpandDone({preventExpandAll:!0,state:g}),l.pushUpdate()}}).catch(t=>{console.log(t),N(e.target),delete o._expandAllPending,M(!0),p.displayNotification({message:m.generic_service_failure,className:"error"}),l.pushUpdate()})},invalidateViewPort:function(){this.options.viewport={graph:null,tree:null,tiles:null,thumbnails:null,datagrid:null}},getNodesById:function(e){var t=[];return this.getRoots().forEach(function(o){var n=o.getNodesById(e);t=t.concat(n)}),t},getNodeByOccurencePath:function(e){for(var t=this.getRoots(),o=0;o<t.length;o++){var n=t[o].getNodeByPath(e,void 0,void 0,!0);if(n)return n}},getRoots:function(e){let t=this._parent();if(!Boolean(e)){let e=[];t.forEach(t=>{t.isVisible()&&e.push(t)}),t=e}return t},removeRoot:function(t,o,n){var i=this;if(this.wrapInTransaction(function(){i.invalidateViewPort(),i.getRoots().indexOf(t)>=0&&i._parent(t)}),!e.is(o,"boolean")||!o){var r=this.getRoots().length;this.getModelEvents().publish({event:"onRemoveRoot",data:{pid:t.getID(),remainingRoots:r}});var s=null;this.getRoots().length>0&&(s=this.getRoots()[0]),this.getModelEvents().publish({event:"onRootAdded",data:{isremove:!0,added_node:s,nb_root:r}})}},searchRootById:function(e){for(var t,o=this.getRoots(!0),n=0;n<o.length;n++)if(o[n].options.resourceid===e){t=o[n];break}return t},insertBranches:function(e,t){var o;(o=d.process.insert_temporary_branches({treedocument:this,branches:e,node_state:t.node_state,forceCollapsed:t.forceCollapsed,novalidation:t.novalidation})).ids_to_fetch.length>0||o.relationids.length>0?this.validateBranches_with_Expand(e,t):t.onComplete&&t.onComplete.call(null)},refreshNodeById:function(t){var o=[],n=this,r=[],s=[],a=function(){o.forEach(function(t){var o=n.getNodesById(t);e.is(o,"array")&&o.forEach(function(e){var t=e.getParent();e.remove(),!1===t.hasChildren()&&(t.setState({state:"collapsed"}),t.options.children=[])})});var t=m.cannot_insert_branch;0!==s.length&&(t=m.cannot_access_after_changeowner),p.displayNotification({message:t,className:"error"})};if(o=e.is(t.created)?o.concat(t.created):o,e.is(t.modified)&&e.is(t.modified,"array")&&this.withTransactionUpdate(function(){t.modified.forEach(function(t){if(e.is(t,"object")){var i=t.physicalid;if(e.is(t.attributes,"array")){var a=require("DS/PADServices/utils/AttributesMgtV2");n.getNodesById(i).forEach(function(e){e.updateAttributes(t.attributes,a.getAvailableColumns()),u.updateNLS(e)})}else{if(-1===o.indexOf(i))(l=n.getNodesById(i))&&l.length>0&&(o.push(i),r.push(i));"ownerChanged"===t.key&&s.push(i)}}else{var l;if(-1===o.indexOf(t))(l=n.getNodesById(t))&&l.length>0&&"www"!==l[0].serviceId&&"www"!==l[0].source&&(o.push(t),r.push(t))}})}),o.length>0){var l=i.getWebAPI_Options("fetch");l.include_param_Attributes=!1,c.fetch({enopad_webapis:i.getSetting("enopad_webapis"),data:l,pids:o,onComplete:function(i){n.invalidateViewPort();var s=e.is(i,"string"),l=s?i.replace(/\\u0007/g,";"):i,c=s?JSON.parse(l):l;c.results.length!==o.length&&(console.error("Inconsistent number of results"),a()),n.wrapInTransaction(function(){d.process.refresh_nodes({treedocument:n,response:c,refresh_parameters:t,ids_modified:r})}),void 0!==t.onComplete&&t.onComplete()},onFailure:function(){a()}})}},getNodesByIDPath:function(e){var t=[];return this.getRoots().forEach(function(o){!function e(t,o,n,i){if(t.getID()===o[n])if(n===o.length-1)i.push(t);else{var r=t.getChildren();r&&r.length>0&&(n+=1,r.forEach(function(t){e(t,o,n,i)}))}}(o,e,0,t)}),t},deleteNodes:function(e){var t=this;this.wrapInTransaction(function(){t.withTransactionUpdate(function(){e.forEach(function(e){e.isRoot()&&t.removeRoot(e)})})})},_selectOccurence:function(e,t,o){var n=this.getRoots(),i=this._selected_paths;if(i.length>0){var r=!1;"FocusOn"!==e&&(this._doNotBroadcastSelect=!0),this.prepareUpdate();var s=[];n.forEach(function(e){for(var t=0;t<i.length;t++){var o=e.getNodeByPath(i[t]);if(o&&(r=!0,s.push(o),!o.isVisible())){for(var n=o.getParent();!n.isVisible();)n=n.getParent();n&&-1===s.indexOf(n)&&s.push(n)}}});var a=!1;if(!0!==t||!0===r)for(var l=this.getSelectedNodes(),d=0;d<l.length;d++){var c=l[d];s.indexOf(c)<0&&(c.unselect(),a=!0)}s.forEach(function(e){e.isSelected()||(e.select(),a=!0)}),!0===o&&a&&(this._directSelection=!1),this.pushUpdate(),this._doNotBroadcastSelect=!1}},_buildSelectData:function(){var e=[];this._selected_paths;e=this.getXSO().get();var t,o={paths:[],tenant:r.getPlatformId()};o.attributes={},o.version="1.1";let n=!1;if(t=function(e){var t=e.getID();o.source=o.source||e.source,o.indexModeParameter=void 0!==o.indexModeParameter?o.indexModeParameter:e.indexModeParameter;let i=e.getAttributeValue("i3dx");n=n||!!i;let r=i||t;this.attributes.hasOwnProperty(r)||(this.attributes[r]={type:e.options.type,label:e.options.label,i3dx:e.getAttributeValue("i3dx"),serviceId:e.getAttributeValue("serviceId"),source:e.source})}.bind(o),o.paths=e.map(function(e){return e.getOccurencePath(t)}),n){let t=o.pathsI3dx=[];e.forEach(e=>{let o=e.getAttributeValue("i3dx");o&&t.push([o])})}return this._currentApp=r.getSharedId(),o.sharedID=this._currentApp,o.focusOn=!1,o},applyActiveView:function(e){this.options.active_view=e},validateBranches_with_Expand:function(t,o){let n=this;function i(){for(var i=0;i<t.length;i++)for(var r=0;r<t[i].length;r+=2){var s=t[i][r],a=n.getNodesById(s);e.is(a,"array")&&a.forEach(function(e){if(!0===e.options.waiting4validation)if(!0===e.isRoot())n.removeRoot(e);else{var t=e.getParent();e.remove(),!1===t.hasChildren()&&(t.setState({state:"collapsed"}),t.options.children=[])}})}p.displayNotification({message:m.cannot_insert_branch,className:"error"}),o.onFailure&&o.onFailure()}let r={},s={};this.getRoots().forEach(e=>{s[e.getID()]=e});let a={};t.forEach(e=>{let t=e[0],o=r[t];if(!o){let e=s[t];a[t]=e,o={paths:[]},r[t]=o}o.paths.push(e)}),S.expandProductsForDisplay(r,{db:"authoring"==w.getCurrentModeType(),level:0}).then(e=>{var t;try{P(e),t=this.startTransaction("expand"),d.process.expand({treedocument:this,root_nodes:a,response:e,mode:"validate_branch",expand_level:0,realExpandedNodes:Object.values(a)}),o.onComplete&&o.onComplete()}catch(e){console.log(e),i()}finally{t&&t.end()}}).catch(e=>{console.log(e),i()})},multiselect:function(e){var t=this.getXSO();this.prepareUpdate(),t.add(e),this.pushUpdate()},multiunselect:function(e){var t=this.getXSO();this.prepareUpdate(),t.remove(e),this.pushUpdate()},fillAttributesAsync4VisibleNodes:function(t,o){this.options.additionalColumnsModules=o;var n=this;return new I(async(o,r)=>{if(n.options.additionalColumnsModules&&n.options.additionalColumnsModules.length){var s=n.getVisibleAdditionalColumns();if(s.length){for(var a={},l=0;l<t.length;l++)i(t[l],a);for(var d=[],c=0;c<s.length;c++){var u=s[c],p=u.module.getName();if(a[p]){var g=new I(function(t){u.module.updateAttributes(a[p],function(o){var n=e.is(o,"string")?JSON.parse(o):o;t(n)},b.getContent().getPADTreeDocument())});d.push(g)}}d.length?I.all(d).then(function(e){n.withTransactionUpdate(function(){t.forEach(t=>{var o=t.getID(),n={grid:{}},i=!1;e.forEach(e=>{if(e&&e.pids){var t=e.pids[o];if(t){i=!0;var r=t._root;if(r){for(var s in r)n[s]=r[s];delete t._root}for(var s in t)n.grid[s]=t[s]}}}),i&&t.updateOptions(n)})}),o()}).catch(r):o()}}else o()});function i(e,t){for(var o=0;o<n.options.additionalColumnsModules.length;o++){for(var i=n.options.additionalColumnsModules[o],r=i.getManagedColumnNames(),s={},a=0;a<r.length;a++)s[r[a]]=e.options.grid[r[a]];if(!0===i.toBeUpdated(s,e)){var l=i.getName(),d=t[l];d||(d={pids:[],nodes:[]},t[l]=d);var c=e.getID();d.pids.push(c),d.nodes.push(e)}}}}})}),define("DS/FolderEditor/utils/FolderEditorDataConversion",["DS/FolderEditor/Folder_CSO"],function(e){return{getObjectIdsFromSearchRes:function(t){var o={};return t&&t.forEach(function(t){if(!t||!t.attributes||t.attributes.length<=0);else{let i={};for(var n=0;n<t.attributes.length;++n){let e=t.attributes[n];i[e.name]=e.value}i.id=i.physicalid,o[i.physicalid]=e.getDefaultModelFromProperties(i)}}),o},getParChildrenMapFromNavRes:function(e){var t={};return!e||!e.result||e.result.length<=0?t:(e.result.forEach(function(e){if(e&&e.input_object){var o=e.input_object.physicalid,n=o;e.outputs&&e.outputs.WORKSPACE&&e.outputs.WORKSPACE.length>0&&(n=e.outputs.WORKSPACE[0].physicalid),t[n]?t[n].push(o):t[n]=[o]}else;}),t)}}}),define("DS/FolderEditor/models/xBookDocumentRefresh",["UWA/Class","UWA/Class/Promise","DS/FolderEditor/models/_xBookCVParser","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSession","DS/FolderEditor/service/FolderEditorWebServiceReadMode","DS/PADUtils/views/PADProgressBar","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/views/FolderMode","i18n!DS/FolderEditor/assets/nls/FolderEditor.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,o,n,i,r,s,a,l,d,c){"use strict";function u(e){e.options.isNotManagedByPS||e.hasChildren()||(e.setState({state:"collapsed"}),e.childComputed=!1)}var p=e.extend({});return!0!==n.getSetting("refresh_v2")&&(p.prototype.refresh=function(e){var n=this,p=[],g=function(t){s.off(),t&&0!==t.length||(t=[{msg:d.refresh_ok}]);for(var o=0;o<t.length;o++){var n=t[o];e.cb&&e.cb(n)}},f=d.refresh_ongoing,h=(e=e||{}).roots||this.getRoots();if(h.length>0){s.on(f);var m=[],v=[];let e={},d={},F=1;if(null!=h&&h.forEach(function(t){let o=t.getID();e[o]=t,d[o]={paths:[[o]]},t.getAllDescendants().forEach(e=>{e.isExpanded()&&e.getChildren()&&0!==e.getChildren().length||(F=Math.max(F,e.getDepth()))});for(var n=[],i=[t];i.length;){var r=i.pop();if(null!=r)n.push(r.getOccurencePath()),r.getOccurencePath().forEach(function(e){v.indexOf(e)<0&&v.push(e)}),i=i.concat(r.getChildren())}m.push(n)}),0===m.length&&0===[].length)g();else{var _=[],S=i.determineAuthoredFlag(),C=!1;S&&(C=!0);let s=F;if(m.length>0){var b=new t(function(t,i){var p;r.expandProductsForDisplay(d,{db:"authoring"==l.getCurrentModeType(),level:s}).then(i=>{if(void 0!==i){p=n.startTransaction("refresh"),o.process.expand({treedocument:n,root_nodes:e,starting_from_root:!0,response:i,mode:"refresh",needNewStructure:C,expand_level:s,security_counts_HTML:null}),S&&function(e){for(var t=e.getRoots(),o=0;o<t.length;o++){var n=t[o];u(n),n.processDescendants({processNode:function(e){u(this)}})}}(n);var r=a.getContent().getPADTreeListView();if(r)r.getManager().reapplySortModel();n.invalidateViewPort(),p&&p.end()}t()}).catch(e=>{console.log(e),i(c.generic_service_failure,e)})});_.push(b)}t.all(_).catch(e=>{console.log(e),function(e,t,o){t=t||"Exception thrown during the process of the refresh answer "+(o?o.toString():""),e.push({msg:t,eventID:"error"})}(p,e)}).finally(function(){g(p)})}this.withTransactionUpdate(function(){for(var e=UWA.clone(h,!1);e.length;){var t=e.pop();null!=t&&(t.isSelected()&&t.unselect(),e=e.concat(t.getChildren()))}})}}),p}),define("DS/FolderEditor/models/FolderInfo",["UWA/Controls/Abstract","UWA/Class/Options","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/service/FolderEditorWebService"],function(e,t,o,n){"use strict";var i=e.extend(t,{_id:null,_type:null,_label:null,init:function(e){this._parent(e),this._id=e.id,this._type=e.type,this._label=e.label},getID:function(){return this._id},getType:function(){return this._type},getLabel:function(){return this._label},getChildrenInfos:function(e){var t,r=[];(t=o.getTreeCont()._getVisibleNodeById(this._id))?(t.getChildren().forEach(function(e){r.push(new i({id:e.getID(),type:e.getType()||"Workspace Vault",label:e.getLabel()}))}),e.onComplete(r)):n.folders({pid:this._id,onComplete:function(t){(t=JSON.parse(t)).folders.forEach(function(e){r.push(new i({id:e.id,type:e.type||"Workspace Vault",label:e.label}))}),e.onComplete(r)},onFailure:function(t){console.warn("WebService folders Err : "+t),e.onFailure(t)}})}});return i}),define("DS/FolderEditor/controllers/SearchMode",["DS/FolderEditor/controllers/CommonMode","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalModelEvents","DS/IPClassifyUXUtil/utils/CancellablePromise","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/ActionBar/FolderCommandManager","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/service/FolderServices","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/views/FolderMode","DS/FolderEditor/tagger/TaggerContentProxy","DS/FolderEditor/tagger/TaggerTreeProxy","DS/FolderEditor/utils/FolderEditorDataConversion","DS/IPClassifyUXUtil/ProgressPaneExecution","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/IPClassifyUtil/IPClassifyAlert"],function(e,t,o,n,i,r,s,a,l,d,c,u,p,g,f,h,m,v){return e.extend({supportClientSort:!1,init:function(e){this._parent(e),this.tempSearchData=new Map,this.objectsToSendForLoad=[],c.onSearchChange(async e=>{this.objectsToSendForLoad=[],this.tempSearchData.clear(),c.setInitialSearchData(),!c.isSearchActive()&&e||h.cancelProgress(!e);let t=a.getContent();t&&(e||t._currentMode===this)&&(e&&e.length<3?v.displayNotification({message:m.replace(m.SearchEnterMoreThan,{minNumber:3}),className:"warning"}):t.switchMode(c.isSearchActive()?"search":null,!0)),r.updateCommands()})},enable:function(){p.setUpdateMode(!1),a.getIdCardCont().switchSearch(!0),o.publish({event:"updateColumnVisibility",data:{visibility:!0,columnName:"bookmarkLocation"}});var e=a.getContent().getActiveView();c.setPreviousView(e),o.publish({event:"toolbar_update_command",data:{commandID:"display",data:{disabled:!0,grid:{data:"datagridview"}}}})},disable:function(){p.setUpdateMode(!0),this._parent(),o.getModelEvents().publish({event:"search_cleared"}),h.cancelProgress(),o.publish({event:"updateColumnVisibility",data:{visibility:!1,columnName:"bookmarkLocation"}});var e=c.getPreviousView();e&&(o.publish({event:"toolbar_update_command",data:{commandID:"display",data:{disabled:!1,grid:{data:e}}}}),r.getCommand(e).begin(),c.setPreviousView(null))},withInfiniteScrolling:function(){return!0},convertData:function(e){let t=i.convertToExaleadDataFormat(e);return t.isSearchWithinData=!0,t},manageError:function(e){if(c.isSearchActive()&&e&&"object"==typeof e&&e.error&&e.error.errorCode)return e.error.errorMessage},resetInfoIndexForRoot:function(){p.clearTags(),this.objectsToSendForLoad=[],this.tempSearchData.clear(),c.setInitialSearchData()},resetInfoIndex:function(){this.resetInfoIndexForRoot(),c.resetInfoIndex()},loadContents:function(e){this._parent();var t=this,o=c.getSearchValue();e.searchQuery=o;let n=!1,i=a.getContent();if(i){let r=i.getPADTreeListView();if(r)return n=!0,new Promise(function(n,i){r.enrichSearchValue(o).then(function(o){e.searchQuery=o,t._loadContents(e).then(function(e){n(e)},function(e){i(e)}).catch(i)}).catch(i)})}if(!n)return t._loadContents(e)},getInfoIndex:function(){return c.getInfoIndex()},sortDataToLoadOnGrid:(e,t)=>{let o,n;for(let t of e)if("ds6w:label"==t.name){o=t.value;break}for(let e of t)if("ds6w:label"==e.name){n=e.value;break}return o>n?1:-1},setTempSearchData:function(e){let t,o=[];return e.forEach(e=>{if(e.attributes){for(let n of e.attributes)if("resourceid"==n.name){t=n.value,0!=this.tempSearchData.size&&this.tempSearchData.get(t)||(this.tempSearchData.set(t,t),o.push(e));break}}else t=e.id,0!=this.tempSearchData.size&&this.tempSearchData.get(t)||(this.tempSearchData.set(t,t),o.push(e))}),o},batchWiseSearchQuery:function(e,t,o,i,r){let a,u,g,f,h;return new Promise((m,_)=>{if(t.pid=e,t.searchingInRoot)if(h=0==c.batchInfoIndex.size,g=c.getBatchInfoIndex(o)){if(!(c.getNextStartNum(g)>0))return void m({contents:[],inProgress:!0,sorted:!1,searchingInRoot:t.searchingInRoot});t.next_start=g.next_start,t.isFirstSearch=!1}else t.isFirstSearch=!0,f=!0;else a=!c.getInfoIndex();let S;a||t.searchingInRoot&&!g?(e="string"==typeof e?[e]:e,S=d.loadLinks(e,{expandAll:!0,searchQuery:t.searchQuery,filters:p.getFilterTags()})):S=Promise.resolve();let C=l.content(t);this._contentHandleRequest=n.all([C,S]),this._contentHandleRequest.then(async e=>{let n=e[0],a=e.length>1?e[1]:null;f&&this.loadFacet(t),a&&a.infos&&(n.infos.nhits+=a.infos.nhits,n.infos.nmatches+=a.infos.nmatches);var l=n.infos,d=c.isSearchInProgress();t.searchQuery&&t.searchingInRoot?c.setBatchInfoIndex(o,l,t.isFirstSearch):c.setInfoIndex(l);var p=s.getCurrentBookmarkId();if(p===t.pid||"FolderSection_AllFolders"===p){const e=n.results?n.results:[];let o=a&&a.contents&&a.contents.length>0;o&&e.push(...a.contents);let s=await i,l={};s&&(l[s.getID()]=s),c.setRootBookmarks(r||l);var g={contents:u=t.searchingInRoot?this.setTempSearchData(e):e,inProgress:d,sorted:!o,searchingInRoot:t.searchingInRoot};m(g)}}).catch(e=>{console.log(e),v.displayNotification({message:e.serverErr.error.errorMessage,className:"warning"}),_()})})},_loadContents:function(e){e.filters=p.getFilterTags(),this.cancelQuery();var t=Promise.resolve();let o=null,n=null,i=a.getContent().getPADTreeListView(),r=i?i.getManager().sortModel:null;r&&r.length>0&&("tree"===(o=r[0].dataIndex)?o="ds6w:label":"defaultSort"===o&&(o="ds6w:modified"),n=r[0].sort,e.order_field=o,e.order_by=n),"FolderSection_AllFolders"===e.pid&&(t=new Promise((e,t)=>{this._contentHandleRequest=l.allBookmarks({select_predicate:["physicalid","label","type"],filters:g.getFilterTags(),onComplete:function(t){e(f.getObjectIdsFromSearchRes(t.results))},onFailure:t})}));c.getInfoIndex();return new Promise((o,n)=>{t.then(t=>{let n=Promise.resolve();t||(n=d.getBookmarkInfo(e.pid));let i=null;t?e.pid=i=Object.keys(t):i=[e.pid];let r=0;const s=[];if("object"==typeof e.pid){for(;e.pid.length>1;)s.push(e.pid.splice(0,100));e.searchingInRoot=!0,c.searchingInRoot=!0}else s.push(e.pid);h.execute({title:m.searchLoading,isSearchquery:!0,datas:s,query:o=>this.batchWiseSearchQuery(o,e,++r,n,t)}).then(e=>{let t,n=[],i=null,r=null;t=e[0]?e[0].searchingInRoot:null,e.forEach(e=>{e&&(n.push(...e.contents),i=e.inProgress,r=e.sorted)}),t&&(c.setSearchCallResult(n),c.setInfoIndex(c.getCountForBreadCrumb(n)),c.setCountToLoadOnGrid(),c.setScrollEndStatus()),o({contents:n,inProgress:i,sorted:r})})}).catch(n)})},loadFacets:function(e){return new Promise((t,o)=>{this._taggerHandleRequest=l.content({pid:e.pid,type:e.type,searchQuery:e.searchQuery,synthesis:!0,filters:e.filters}).then(t).catch(o)})},onSetPathTags:function(e){this.unColorizeChildren(e)},getObjectsInTree:function(){return c.getNumberHits()},onFilterFilteringEvent:function(){},onInfiniteScrollAsync:function(){var e=c.getNumberLastResult();c.getSearchValue()&&e>0&&a.getContent().loadContentAndSelect()},unColorizeChildren:function(e){e.options.model.withTransactionUpdate(function(){e.options.model.getRoots().forEach(function(e){var t={grid:{bi_color:"rgba(0, 0, 0, 0)"}};e.getAllDescendants().forEach(function(e){delete e.options.color,e.updateOptions(t)})})})},getNumberLastResult:function(){return c.getNumberLastResult()},getModeType:function(){return"search"}})}),define("DS/FolderEditor/views/customize_views/_FolderDGVUtils",["i18n!DS/FolderEditor/assets/nls/FolderEditor.json","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/DictionaryAccess","DS/FolderEditor/service/FolderTypeService","DS/WebappsUtils/WebappsUtils","DS/PADServices/utils/MaturityUtils","DS/FolderEditor/views/FolderMode","DS/WidgetServices/WidgetServices","DS/ENOXVersionExplorerController/VersionExplorerController","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/FolderEditor/utils/FolderEditorUtil","DS/PADUtils/PADSettingsMgt"],function(e,t,o,n,i,r,s,a,l,d,c,u,p){"use strict";function g(e){}function f(e){return e.nodeModel?"Workspace"===e.nodeModel.getAttributeValue("type")||"Workspace Vault"===e.nodeModel.getAttributeValue("type")||"Document"===e.nodeModel.getAttributeValue("type")||"wwwLink"===e.nodeModel.getAttributeValue("type")||void 0!==e.nodeModel.options.checkout||1==widget.readOnly||n.isExternalObject(e.nodeModel):-1===e.rowID}g.prototype.buildColumns=function(e){return new Promise(function(e,n){var i=[],r=0,s=t.getColumnsOrder(void 0);t.updateAttributesWithKind(void 0).then(function(){for(r=0;r<s.length;r++){var n=t.getColumn(s[r],void 0);n&&i.push(this.buildColumnFromSetting(n))}var a=UWA.clone(i);o.updateColumnsWithNLS(a,function(t){var o={};o.columns=a,"success"===t.status&&(o.columns=t.columns),e(o)})}.bind(this)).catch(n)}.bind(this))},g.prototype.buildColumnFromSetting=function(t){var o=Object.assign({editableFlag:!1,customisation:{exportable:{lock:!1,value:!0}}},t);if(!UWA.is(o.dataIndex)){if(!UWA.is(o.ds6w))throw new Error("Wrong column definition for ["+JSON.stringify(t)+"]");o.dataIndex=o.ds6w}switch(o.kind){case"string":o.typeRepresentation="string";break;case"timestamp":case"dateTime":o.typeRepresentation="datetime",o.semantics={allowMultipleValuesFlag:!0},o.getCellValueForExport=function(e){var t=new Date(e.cellModel),o=e.cellModel;return"Invalid Date"!=t&&(o=t.toLocaleString()),o};break;case"boolean":o.typeRepresentation="boolean";break;case"image":o.typeRepresentation="image";break;case"icon":o.typeRepresentation="icon";break;case"functionIcon":o.typeRepresentation="functionIcon";break;default:o.typeRepresentation||(o.typeRepresentation="string")}switch(o.dataIndex){case"ds6wg:revision":o.getCellValue=function(e){if(e&&e.nodeModel&&e.nodeModel.options.grid){let t=e.nodeModel.options.grid;return t["ds6wg:revision"]&&"3DSpace"===t.serviceId?{label:t["ds6wg:revision"],func:function(e){!function(e){require(["DS/FolderEditor/ActionBar/FolderCommandManager"],t=>{t.launchCommand("HistoryHdr",e.context.nodeModel)})}(e)}}:t["ds6wg:revision"]?{label:t["ds6wg:revision"]}:""}},o.getCellValueForExport=function(e){return"object"==typeof e.cellModel?e.cellModel.label:e.cellModel};break;case"ds6w:cadMaster":o.typeRepresentation="image",o.alignment="center",o.getCellValue=function(e){var t;if(!0!==e.isHeader&&e&&e.nodeModel&&e.nodeModel.options.grid)return e.nodeModel.options.grid["ds6w:cadMaster"]?t=h.get(e.nodeModel.options.grid["ds6w:cadMaster"]):"VPMReference"===e.nodeModel.options.grid.type&&(t=h.get("3DEXPERIENCE")),{iconPath:t,iconSize:{height:"22px"}}};break;case"thumbnail":o.ds6w=void 0,o.typeRepresentation="image",o.text=e.column_Thumbnail,o.sortableFlag=!1;break;case"ds6w:status":o.typeRepresentation="tag",o.getCellClassName=function(e){if(e.nodeModel){var t;let n=e.nodeModel.options.grid["ds6w:status-original"],i=e.nodeModel.options.grid["ds6w:type-original"];var o;if("read"!==s.getCurrentModeType()?(t=n&&"VPMReference"==i?n:e.nodeModel.options.grid.current_nonNls)||(t=n||e.nodeModel.options.grid["ds6w:status"]):t=e.nodeModel.getReferenceValue("ds6w:status-original")?e.nodeModel.getReferenceValue("ds6w:status-original"):e.nodeModel.getReferenceValue("ds6w:status"),t){if(!1===t.contains(".")){let o=e.nodeModel.getReferenceValue("ds6w:policy-original")?e.nodeModel.getReferenceValue("ds6w:policy-original"):e.nodeModel.getReferenceValue("ds6w:policy");o&&(t=o+"."+t)}o=r.getAndCreateMaturityClass(t,"wux-controls-label")}return o}};break;case"ds6w:responsible":o.typeRepresentation="user",o.getCellValue=function(e){var t,o,n=e.nodeModel.getAttributeValue("ds6w:responsibleUid")||e.nodeModel.getAttributeValue("owner"),i=e.nodeModel?e.nodeModel.options.grid["ds6w:responsible"]:void 0;return n&&(t=function(e,t){var o,n;a.get3DSwymUrlAsync({onComplete:function(e){null!=e&&(n=e)}}),null==n||n.contains("odtUrl")||(o=n+"/api/user/getpicture/login/"+e);return o}(n)),null!=t?o={icon:{iconPath:"url("+t+")",className:"dgv-user-thumbnail"},label:i}:i&&(o={icon:void 0,label:i}),o},o.getCellValueForExport=function(e){return e.nodeModel?e.nodeModel.options.grid["ds6w:responsible"]:void 0};break;case"ds6w:reserved":o.typeRepresentation="functionIcon",o.getCellSemantics=function(e){let t=null;return e.isHeader||(t=function(e){let t=e.nodeModel.computeLockStatus();const o=f(e);let n=o?"":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock-open dgvpad_unlock";t.locked&&(n=t.locked_by_me?"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-key dgvpad_lock":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock dgvpad_lock_other");return{icon:{iconClasses:n},label:t.reserveBy,disabled:o}}(e)),t},o.alignment="center",o.getCellValueForExport=function(t){var o=t.cellModel,n=o;-1!==t.rowID&&(n=e.tooltip_unreserved,o&&"true"===o.toLowerCase()&&(n=e.tooltip_reserved));return n},o.getCellTooltip=(t=>{const o=t.nodeModel?t.nodeModel.getAttributeValue("ds6w:reservedBy"):null,n=f(t),i=!!t.nodeModel&&"Document"===t.nodeModel.getAttributeValue("type");let r={};if(!!t.nodeModel&&("Workspace"===t.nodeModel.getAttributeValue("type")||"Workspace Vault"===t.nodeModel.getAttributeValue("type"))||n&&!i)r={};else if(o&&i){r={shortHelp:`${e.get("lockStatusTooltip_locked").message} ${o}`}}else if(o){const t=e.get("lockStatusTooltip_locked");r={shortHelp:`${t.message} ${o}\n${t.subtitle}`}}else if(!o&&i)r={};else{const t=e.get("lockStatusTooltip_unlocked");r={shortHelp:`${t.message}\n${t.subtitle}`}}return r});break;case"tree":o.typeRepresentation="url",o.getCellEditableState=function(e){return 1!=widget.launchWithReadMode&&(e&&e.nodeModel&&n.inFamilyFolder(e.nodeModel.getType()))},o.editionPolicy="DelayedEditionOnClick",o.setCellValue=function(t,o){if(t.nodeModel)if(t.nodeModel&&"TRUE"===t.nodeModel._options.grid.isLinkedFolder)require(["DS/IPClassifyUtil/IPClassifyAlert"],function(t){t.displayNotification({message:e.get("msg_error_Rename_Shortcut"),className:"error"})});else{require("DS/FolderEditor/commands/FolderCommands")._cellToRename={cellInfos:t,context:"CONTENT"};let e="object"==typeof o&&null!==o?o.label:o;!function(e,t,o){e.getTreeDocument().withTransactionUpdate(function(){if("tree"===t){var n={};n.label=o,n.display=o,n.oldLabel=e.options.label,e.updateOptions(n)}})}(t.nodeModel,"tree",e)}},o.getCellSemantics=function(e){let t={};if(e.nodeModel){let o=e.nodeModel.options.grid.Link;o&&!o.startsWith("http")&&(t.hyperlinkTarget="_top")}return t},o.getCellValue=function(e){if(e.nodeModel){var t=e.nodeModel.options.grid.Link;return{label:e.nodeModel.getLabel(),url:t}}},o.getCellValueForExport=function(e){return e.nodeModel?e.nodeModel.getLabel():e.cellModel}}return o},g.prototype.buildColumnsFromStorage=function(e){var o=this;return new Promise(function(n,i){var r=[],s=0;t.updateAttributesWithKind(void 0,e).then(function(e){t.updateAttributesWithKind().then(function(){var i=[];if(e)for(s=0;s<e.length;s++)i.push(new Promise(function(n){var i=e[s].dataIndex;t.addAvailableColumn(i,e[s]).then(function(e){var t=o.buildColumnFromSetting(e);t&&r.push(t),n()})}));Promise.all(i).then(function(){var e=UWA.clone(r);n(e)})})})})};const h=new Map,m=["CATIAV5","SOLIDWORKS","NX","CREO","SOLIDEDGE","ALTIUM","INVENTOR","AUTOCAD","CAAUPSAPP","CADENCEALLEGRO","3DEXPERIENCE"];for(var v=0;v<m.length;v++)h.set(m[v],i.getWebappsAssetUrl("PADServices","icons/cadmasters/I_CADMaster"+m[v]+".png"));return g}),define("DS/FolderEditor/infra/xBookComponent",["i18n!DS/FolderEditor/assets/nls/FolderEditor","UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","UWA/Promise","DS/UIKIT/Mask","DS/Utilities/Utils","DS/WebappsUtils/WebappsUtils","DS/PADUtils/views/PADAlert","DS/PADUtils/PADPromise","DS/PADUtils/PADSession","DS/PADUtils/PADTypesMgt","DS/WidgetServices/WidgetServices","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADSettingsMgt","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderLoaderGlobal","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/tagger/TaggerContentProxy","DS/FolderEditor/utils/FolderEditorcontrol","DS/IPClassifyUXUtil/utils/CancellablePromise"],function(e,t,o,n,i,r,s,a,l,d,c,u,p,g,f,h,m,v,_,S,C,b){"use strict";function F(){var e=this,o={},n=new r(function(n){require([e.options.amd_custo.TreeDocument],function(i){(o=function(e){var o=this,n={};return["doDnDDragStart","shouldAcceptDnDDrop","doDnDDrop"].forEach(function(e){t.is(o[e],"function")&&(n[e]=o[e].bind(o))}),n}.call(e)).authorize_setStructure=e.options.authorize_setStructure,o.insert_replace=e.options.insert_replace,o.renderTo=e.options.renderTo,o.useAsyncPreExpand=!0,e.options.model=new i(o),m.registerTreeDocument("CONTENT",e.options.model),e.options.model.useAsyncPreExpand=o.useAsyncPreExpand,e.options.model.getModelEvents().subscribe({event:"onRootAdded"},function(t){if(t.data.added_node&&!1===e.options.layout.withWelcomePanel){var o=t.data.added_node.getID();e.dispatchEvent("onAddPaths",{addedPaths:[[o]]})}});var r=a.debounce(()=>{let t=e.options.model.getSelectedNodes(),o={};t.forEach(e=>{let t=e.getSourceId(),n=e.getAttributeValue("i3dx"),i=n,r=n?"[ds6w:i3dx]":"physicalid";n||(i=e.getID());let s=o[r+t];s||(s=o[r+t]={ids:[],key:r,source:t,serviceId:e.getAttributeValue("serviceId")}),s.ids.push(i)}),S.focusOnObjects(Object.values(o))},200);e.options.model.getXSO().onChange(r),e.options.model.getModelEvents().subscribe({event:"onCenterGraph"},function(t){e.options.views.treelistview?e.options.views.treelistview.getManager().scrollToNode(t.data,void 0,!1):e.options.views.datagridview.options.dgv.ensureNodeModelVisible(t.data),e.options.views.graphview&&e.options.views.graphview.reframeOn()}),e.options.model.addEventListener("beginBlockingTransaction",function(t){e.beginBlockingTransaction(t.data)}),e.options.model.addEventListener("endBlockingTransaction",function(){e.endBlockingTransaction()}),e.options.isReady.model=!0,e._probes.probe_model.end(),n()})});return n.name="build",n}function y(e){var o=this;o.elements.container.empty(),t.createElement("div",{class:"xnav_hdr"}).inject(o.elements.container),t.createElement("div",{class:"xnav_body"}).inject(o.elements.container),t.createElement("div",{class:"xnav_footer"}).inject(o.elements.container);var n=new r(function(n,i){var s=[],a=o.elements.container.querySelector(".xnav_body"),l=new r(function(n,i){require(["DS/ENOXTriptych/js/ENOXTriptych","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalModelEvents"],function(i,r,s){var a,l=t.createElement("div",{class:"xbook_viewmain"});widget.body.contentViewLoaderContainer||(widget.body.contentViewLoaderContainer=t.createElement("div",{class:"FolderEditor_contentView_loader"}).inject(l),v.setContainer("contentView",widget.body.contentViewLoaderContainer));var d=t.clone(o.options.layout.triptychOpts);d.modelEvents=s.getModelEvents(),d.container=o.elements.container.querySelector(".xnav_body"),a=t.createElement("div",{class:"xbook_viewright rightSidePanel"}),o.elements.padshell=new i,o.elements.padshell.init(d,o.createRootListSlidder2(),l,a),o.elements.padshell.togglePanel=function(e){if("left"===e)o.elements.padshell._modelEvents.publish({event:"triptych-toggle-panel",data:"left"});else{o.elements.padshell._modelEvents.publish({event:"triptych-toggle-panel",data:"right"});let e=o.elements.padshell._modelEvents.subscribe({event:"triptych-clicked-overlay"},function(e){e&&"right"===e&&s.publish({event:"onOverlayClick"})});o._subscriptionTokens.push(e)}},s.publish({event:"on2DTriptychReady"}),require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=e.getCommandCheckHeader("RootPanel");t&&t.addCallback()}),e.then(()=>{(function(e,t){var o=this;require(["DS/FolderEditor/views/ViewLoader"],function(n){var i={component:o,x3dAppId:o.options.x3dAppId,renderTo:e.renderTo,multiselection:o.options.multiselection,amd:{treelistview:o.options.amd_custo.TreeListView,tileview:o.options.amd_custo.TileGridView,thumbnailview:o.options.amd_custo.ThumbnailGridView,datagridview:o.options.amd_custo.DataGridView}};o.loader=new n(i),o.loader.loadView(o.options.active_view,function(){t()})})}).call(o,{renderTo:l},n)})})});l.name="slidder",s.push(l),r.all(s).then(function(e){!0===o.options.isReady[o.options.active_view]&&o._probes.probe_view.end(),o.elements.padstatus&&(!0===o.options.layout.padshell?o.elements.padstatus.inject(o.elements.padshell.getMainPanelContainer()):o.elements.padstatus.inject(a)),n()})});return n.name="buildSkeleton",n}return o.extend(n,i,{_dispatchReady_NotDone:!0,defaultOptions:{widget:null,elements:null,active_view:"treelistview",toolbar_opts:null,multiselection:!0,layout:{padshell:!1,title_update:!0,view_customization:null,store_roots_in_pref:!0,drop_invite:"dynamic",keyboard_inputs:!0,withWelcomePanel:!1,triptychOpts:{left:{resizable:!0,originalState:"close",overMobile:!0,minWidth:105,originalSize:300,withClose:!0},withtransition:!0,withoverflowhidden:!0,right:{resizable:!0,originalState:"close",overMobile:!0,minWidth:250,withClose:!1}}},amd_custo:{TreeDocument:"DS/FolderEditor/xBookDocument",TreeListView:null,TileGridView:null,ThumbnailGridView:null,DataGridView:null},views:{treelistview:null,graphview:null,tileview:null,thumbnailview:null,datagridview:null},views_cb:{},isReady:{model:!1,actionbar:!1,treelistview:!1,graphview:!1,tileview:!1,thumbnailview:!1}},_probes:{},setDnD_onGraph:function(){},init:function(o){this._subscriptionTokens=[],this._parent(o),this.options=t.extend(this.options,o,!0),this.elements.container=t.createElement("div",{class:"xbook_component"}),this.options.flags={};var n=this;require(["DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADProbes"],function(o,i,s){n._probes.probe_init=s.createProbe("init_xnavcomponent"),o.setSetting("lang",g.getLanguage()),i.app_initialization(function(i){if(i&&!0===i.success){n._probes.probe_model=s.createProbe("init_xnav_model");var a=F.call(n);n._probes.probe_view=s.createProbe("init_xnav_views");var l=y.call(n,a);r.all([a,l]).then(function(){n.options.model.getVisibleAdditionalColumns=function(){var e=[];if(n.options.views.treelistview)var o=n.getPADTreeListView().getManager();else o=n.options.views.datagridview;if(n.options.additionalColumnsModules&&n.options.additionalColumnsModules.length)for(var i=0;i<n.options.additionalColumnsModules.length;i++){for(var r=[],s=n.options.additionalColumnsModules[i],a=s.getManagedColumnNames(),l=0;l<a.length;l++)(s.allViewsSupported||o&&t.is(o.isColumnHidden,"function")&&!o.isColumnHidden(a[l]))&&r.push(a[l]);r.length&&e.push({module:s,columns:r})}return e},n._dispatchReady(!1),f.subscribe({event:"FolderEditor/expandStatus"},function(t){t.status&&!0===t.status.expandTooLarge&&("find_in_ctx"===t.mode?d.displayNotification({msg:e.replace(e.tooManyResultFound,{maxResult:o.getSetting("maxPathsForSearch")}),eventID:"warning"}):d.displayNotification({msg:e.expandTooLarge,eventID:"warning"}))})})}else n._initialize_failure(function(){n.dispatchEvent("onReady",{error:!0})})})})},render:function(){return this.elements.container},toggleView:function(e){if(e!==this.options.active_view){var t=this;this.loader.loadView(e,function(){t.options.views[t.options.active_view].unsetModel(),t.options.active_view=e,t.options.model.applyActiveView(t.options.active_view),t.options.views[t.options.active_view].setModel(t.options.model),"graphview"===t.options.active_view&&t.options.views.graphview.reframeOn(),t.dispatchEvent("onToggleView",t.options.active_view)})}},beginBlockingTransaction:function(e){s.mask(this.elements.container,e)},endBlockingTransaction:function(){s.unmask(this.elements.container)},onResize:function(){this.options.model.invalidateViewPort(),"graphview"===this.options.active_view&&this.options.views.graphview.setSize(),this.dispatchEvent("onParentResize")},getPADTreeDocument:function(){return this.options.model},getRoots:function(){return this.options.model.getRoots()},getPADTreeListView:function(){return this.options.views.datagridview},togglePanel:function(e,t){(this.elements.padshell?this.elements.padshell:this.elements.padinfo).togglePanel(e,t)},destroy:function(){this._subscriptionTokens.forEach(e=>{f.unsubscribe(e)}),this._subscriptionTokens=[],this._parent()},displayNotification:function(e){require(["DS/IPClassifyUtil/IPClassifyAlert"],function(t){t.displayNotification(e)})},_initialize_failure:function(t){var o=this;require(["DS/FolderEditor/views/xBookInitError"],function(n){var i=e.initialization_error;o.elements.bigerror=new n({msg:i}),o._just_error_content(),o.displayNotification({message:i,className:"error"}),t()})},_just_error_content:function(){this.elements.bigerror&&this.elements.container.setContent(this.elements.bigerror)},compactMode:function(e){this.getPADTreeListView().compactMode(e),this.dispatchEvent("onCompactMode",e)},updateAttributesDelayed:function(e){this._debounceMethod=this._debounceMethod||a.debounce(this.updateColumns.bind(this),200),!(e&&e.collectionView&&e.collectionView.getRowModelLength&&0===e.collectionView.getRowModelLength())&&this._debounceMethod(e)},updateColumns:function(e){var t=this;let o=new b(async(n,i)=>{setTimeout(()=>{var r=[];if(e.collectionView&&e.collectionView.model){var s=e.collectionView;r=e.endNodeIndex>=0?s.model.slice(e.startNodeIndex,e.endNodeIndex+1):s.model.slice(e.startNodeIndex,e.endNodeIndex)}if(r.length){var a=t.options.model.fillAttributesAsync4VisibleNodes(r,t.options.additionalColumnsModules);o.addLinkedQuery(a),a.then(()=>{var o=require("DS/PADUtils/PADPredicatesNls");if(r.forEach(e=>{e._manageNLS&&(delete e._manageNLS,o.updateNLS(e))}),"OnExport"!==e.context){let e={physicalid:{},"[ds6w:i3dx]":{}};r.forEach(t=>{let o=t.getAttributeValue("i3dx"),n=!!o;o=o||t.getID();let i=t.getAttributeValue("serviceId");i=i||"3DSpace";let r=n?e["[ds6w:i3dx]"]:e.physicalid,s=r[i];s||(r[i]=s=[]),s.push(o)}),S.updateColorNodes(e),"datagridview"===t.getActiveView()&&_.isRelationsColumnsActive()&&function(e,t){require(["DS/ENORIPE_Columns/RelationsColumns","DS/PADServices/utils/PlatformURL","DS/FolderEditor/utils/FolderSearch"],(o,n,i)=>{i.isSearchActive()||n.retrievePlatformUrl().then(()=>{o.setHardcodedConfiguration("BME");var n=new Set(e.filter(e=>!e.isRelationsObjectNode&&!e._isProcessedForRelationsColumns).map(e=>(e._isProcessedForRelationsColumns=!0,e.getID())));if(n.size>0){var i=C.getContent().getSelectedNodes();o.updateAttributes({pids:[...n]},()=>{i.forEach(e=>e.select())},t.options.model)}})})}(r,t)}n()}).catch(i)}else n()},0)});return o}})}),define("DS/FolderEditor/utils/FolderExpandUtil_Read",["UWA/Utils","DS/FolderEditor/service/FolderEditorWebServiceReadMode","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderEditorcontrol","DS/WebappsUtils/WebappsUtils","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/tagger/TaggerTreeProxy"],function(e,t,o,n,i,r,s,a){var l=i.getWebappsAssetUrl("FolderEditor","icons/I_BookmarkInherit_v2.png"),d=i.getWebappsAssetUrl("FolderEditor","icons/I_Bookmark_v2.png");return{listFolder:function(e){var o=this,i=e.pid,r=null==e.level?"UI":"All"==e.level?-1:e.level,c=(e.expandList,e.partialExpandedChildren,e.isRoot),u=e.onComplete,p=[],g=n.getTreeCont(),f=a.getFilterTags(),h=e.recordScrollForIndex;"UI"==r?(e.Read=!0,e.nextStart=h?g._indexModeforReadData.getNextStart():0,f&&(e.refine="",Object.keys(f).length>0&&(e.refine=f)),e.onComplete=function(t){var o=JSON.parse(t);if(c&&o.infos&&h){var n=o.infos;g._indexModeforReadData.setInfoIndex(n),g._indexModeforReadData.setNextStart(n.nresults+e.nextStart)}if(o.folders&&(o.folders.forEach(function(e){"shared"==e.folderClassification.toLowerCase()?e.icon=l:e.icon=d}),u(JSON.stringify(o))),o.error){var i=o.error.message;e.onFailure(i),s.displayNotification({message:i,className:"error"})}},t.folderTree(e)):(c?p.push(new Promise(function(e,t){var n=a.getFilterTags(),i=n?{filters:n}:{};o._getRootBookmarks(i).then(function(t){e(t)}).catch(function(e){t(e)})})):p.push(Promise.resolve()),Promise.all(p).then(function(e){if(c){var t={};0;var n=e[0];if(1!==r)t.level=r,o._expandRoot(t,n,u);else{var s=o.dataConversionToJson(n);s={folders:s},u(JSON.stringify(s))}}else{0,(t={}).level=r,o._expandSubFolder(t,i,u)}}).catch(function(e){e&&(console.log(e),s.displayNotification({message:"object"==typeof e?e.message:e,className:"error"})),u(JSON.stringify({folders:[]}))}))},_expandSubFolder:function(e,t,o){var n=[];n.push(t),e.multi_root_physicalid=n,e.fromBookmark=!0,this._getExpandedBookmarks(e).then(function(e){let t=e;e.error||(t={folders:t.results}),o(t)})},_expandRoot:function(e,t,o){if(e.level=-1==e.level?e.level:e.level-1,0===t.size)return{folders:[]};this._expandAllonRoot(e,t).then(function(e){let n=e;if(!e.error){let o=e.roots,r={};for(var i of(o.forEach(e=>{r[e.id]=!0}),t.keys()))r[i]||e.results.push(t.get(i));n={folders:e.results}}o(n)})},_expandAllonRoot:function(e,t){var o=this;e={level:e.level,isExpandDoneOnRoot:!0};let n=[];for(var i of t.keys())n.push(i);return e.multi_root_physicalid=n,new Promise(function(t,n){o._getExpandedBookmarks(e).then(t).catch(n)})},_getRootBookmarks:function(e){var o=this;return new Promise(function(i,s){var a=e;a||(a={}),Object.assign(a,{onComplete:function(e){var t=e,r=n.getTreeCont(),a=t.infos;r._indexModeforReadData.setInfoIndex(a);var l=r._indexModeforReadData.getNextStart()+a.nresults;r._indexModeforReadData.setNextStart(l);var d=t.results;if(d&&d.length>0){var c=o._createMapWithSearchResult(d);i(c)}else s()},onFailure:function(){s(r.errorMessageBookmarkRoot)}}),t.getRoots(a)})},_getExpandedBookmarks:function(e){var o=this;return new Promise(function(n,i){t.expandFolder({level:e.level,multi_root_physicalid:e.multi_root_physicalid,"q.query":e["q.query"],onComplete:function(t){var i=o._createMapWithExpandResult(t,e);n(i)},onFailure:function(e){console.log(e),n({error:e,results:[],roots:[]})}})})},_createMapWithSearchResult:function(e){var t=this.getMappingforProperties_Search(),o=new Map;return e.forEach(function(e){var n=e.attributes,i={},r=null;n.forEach(function(e){if(t.has(e.name)){var o=t.get(e.name);i[o]=e.value,"id"==o&&(r=e.value),"folderClassification"==o&&("shared"==e.value.toLowerCase()?(i.icon=l,i[o]="Shared"):(i.icon=d,i[o]="Bookmark"))}}),i.hasOwnProperty("folderClassification")||(i.icon=d,i.folderClassification="Bookmark"),i.level=1,o.set(r,i)}),o},_addChildrenInList:function(e,t){t.forEach(t=>{e.push(t),t._children&&(this._addChildrenInList(e,t._children),delete t._children)})},_createMapWithExpandResult:function(e,t){var o=e.results,n=this.getMappingforProperties_Expand();let i={},s=new Set,a=t.fromBookmark?0:1,c=t.fromBookmark?2:0,u=0;o.forEach(function(e){if(e.hasOwnProperty("Path")){let t=null;for(let o=0;o<e.Path.length;o+=2){let n=e.Path[o],r=i[n];r&&!r.level&&(r.level=o/2+a,t&&t._children.add(r)),t=r,o===c&&s.add(r)}}else if(e.hasOwnProperty("Path")||e.hasOwnProperty("bks.TreeOrder")){if(e.hasOwnProperty("bks.TreeOrder")){let t=i[e.to];t&&(t.RelId=e.to,t.TreeOrder=e["bks.TreeOrder"])}}else{u++;let t={};for(let o in e){let i=n.get(o);i&&(t[i]=e[o])}let o=t.folderClassification;o&&"shared"===o.toLowerCase()?(t.icon=l,t.folderClassification="Shared"):(t.icon=d,t.folderClassification="Bookmark"),t._children=new Set,i[e.resourceid]=t}});let p=[],g=void 0;return u>5e3?g=r.treeExpandTooLarge:this._addChildrenInList(p,s),{error:g,results:p,roots:s}},getMappingforProperties_Search:function(){return new Map([["physicalid","id"],["ds6w:when/ds6w:created","created"],["ds6w:when/ds6w:modified","modified"],["ds6w:label","label"],["ds6w:identifier","name"],["ds6w:what/ds6w:type","type"],["ds6w:what/ds6w:policy","policy"],["ds6w:who/ds6w:responsible/ds6w:organizationResponsible","organizationResponsible"],["ds6w:who/ds6w:responsible","responsible"],["ds6w:responsibleUid","owner"],["ds6w:what/ds6w:status","status"],["ds6w:where/ds6w:context/ds6w:project","project"],["icon_2ddefaultthb.subtype","folderClassification"],["mxid","mxid"],["ds6wg:revision","revision"]])},getMappingforProperties_Expand:function(){return new Map([["resourceid","id"],["ds6w:created","created"],["ds6w:modified","modified"],["ds6w:label","label"],["ds6w:identifier","name"],["ds6w:type","type"],["ds6w:policy","policy"],["ds6w:organizationResponsible","organizationResponsible"],["ds6w:responsible","responsible"],["ds6w:responsibleUid","owner"],["ds6w:status","status"],["ds6w:project","project"],["icon_2ddefaultthb.subtype","folderClassification"],["mxid","mxid"],["ds6wg:revision","revision"]])},dataConversionToJson:function(e){var t=[];for(let o of e.values()){Array.isArray(o)?o.forEach(function(e){t.push(e)}):t.push(o)}return t}}}),define("DS/FolderEditor/controllers/AuthoringMode",["DS/FolderEditor/controllers/CommonContentMode","DS/FolderEditor/service/FolderEditorWebService","DS/IPClassifyUXUtil/utils/CancellablePromise","DS/FolderEditor/Folder_CSO","DS/FolderEditor/service/FolderServices","DS/FolderEditor/utils/FolderEditorUtil","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,t,o,n,i,r,s){return e.extend({init:function(e){this._parent(e)},convertData:function(e){return r.convertToExaleadDataFormat(e)},smartFilteringAvailable:function(){return!0},loadContents:function(e){this._parent();var r=this;let a=e.smartFiltering&&this.smartFilteringAvailable();return e.smartFiltering&&(e.smartFiltering.fetchAllAttr=!1),a?this.loadIndexContents(e):new Promise((a,l)=>{let d=null,c=null;r._contentHandleRequest=new o((o,a)=>{d="FolderSection_AllFolders"===e.type?t.roots(e):t.content(e),c=i.loadLinks([e.pid],{brokenLinks:!0}),Promise.all([d,c]).then(t=>{if(r._contentHandleRequest&&!r._contentHandleRequest.isCancelled()){this.loadFacet(e);let r=t[0],l=t[1];if(n.getCurrentBookmarkId()===e.pid){var i=r.content;if(void 0!==(i=i||r.folders)){r.contents=i;let e=r.contents;l&&l.contents&&(e=[...r.contents,...l.contents]),r.contents=e,o(r)}else a({message:s.msg_error_contentnotavailable.Title,className:"error"})}}}).catch(a)}),r._contentHandleRequest.addLinkedQuery(d),r._contentHandleRequest.addLinkedQuery(c),r._contentHandleRequest.then(a).catch(l)})},getModeType:function(){return"authoring"}})}),define("DS/FolderEditor/utils/xBookCustoStorageOptim",["UWA/Core","DS/FolderEditor/utils/FolderEditorUtil","DS/PADUtils/PADSettingsMgt"],function(e,t,o){"use strict";var n={dataIndex:void 0,text:void 0,isDraggable:!0,visibleFlag:!0,isHidden:!1,isSortable:void 0,type:void 0,isAdditionalColumn:void 0,xnav_options:{name:void 0,dataIndex:void 0,tree:void 0,hardcoded:void 0,exportable:{lock:!1,value:!0},layout:{removable:void 0,hidden:void 0,width:150,minWidth:void 0,maxWidth:void 0},kind:void 0}},i={dataIndex:void 0,text:void 0,isDraggable:!0,visibleFlag:void 0,sortableFlag:void 0,pinned:void 0,kind:void 0,isAdditionalColumn:void 0,customisation:{layout:{width:200,minWidth:50,maxWidth:300,removable:!0,pinEditable:!0},exportable:{lock:!1,value:!0},titleModified:void 0}};function r(e,t){var o={};if(void 0===t)o=e;else for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++)if(UWA.is(e[n[i]],"object")){var s=r(e[n[i]],t[n[i]]);Object.getOwnPropertyNames(s).length>0&&(o[n[i]]=s)}else e[n[i]]!==t[n[i]]&&"text"!==n[i]&&(o[n[i]]=e[n[i]]);return o}function s(e,t,o){var n={};if(void 0===e)n=t;else{for(var i=Object.getOwnPropertyNames(t),r=Object.getOwnPropertyNames(e),a=0;a<i.length;a++)if(UWA.is(t[i[a]],"object")){if("bi_color"!==o){var l=s(e[i[a]],t[i[a]],o);Object.getOwnPropertyNames(l).length>0&&(n[i[a]]=l)}}else void 0===e[i[a]]?n[i[a]]=t[i[a]]:n[i[a]]=e[i[a]];for(var d=0;d<r.length;d++)void 0===n[r[d]]&&(n[r[d]]=e[r[d]])}return n}return{convertCusto4Preference:function(e,s,a){var l={custoOptimized:!0,viewMode:e.viewMode,defaultCellHeight:e.defaultCellHeight,defaultcolumnHeaderHeight:e.defaultcolumnHeaderHeight,rowsHeader:e.rowsHeader,selectedTypes:e.selectedTypes,selectedExtensions:e.selectedExtensions,columnsOptimized:[],lang:o.getSetting("lang")};t.setContentSortmodel(e.sortModel),e.custoFromTree&&(l.custoFromTree=e.custoFromTree);for(var d=0;d<e.columns.length;d++){var c=e.columns[d],u=n;"datagridview"===a&&(u=i);var p=r(c,u);s[c.dataIndex]&&(p.text=c.text),l.columnsOptimized.push(p)}return l},convertPreference2Custo:function(r,a){var l={viewMode:r.viewMode,defaultCellHeight:r.defaultCellHeight,defaultcolumnHeaderHeight:r.defaultcolumnHeaderHeight,rowsHeader:r.rowsHeader,selectedTypes:r.selectedTypes,selectedExtensions:r.selectedExtensions,columns:[]},d=t.getContentSortmodel();l.sortModel=d,r.custoFromTree&&(l.custoFromTree=r.custoFromTree),r.lang&&r.lang!==o.getSetting("lang")&&function(e){for(var t=0;t<e.columnsOptimized.length;t++){var o=e.columnsOptimized[t];o.xnav_options&&o.xnav_options.titleModified&&(delete o.text,delete o.xnav_options.titleModified)}}(r);for(var c=0;c<r.columnsOptimized.length;c++){var u=r.columnsOptimized[c],p=n;"datagridview"===a&&(p=i);var g=s(u,e.clone(p),u.dataIndex);l.columns.push(g)}return l}}}),define("DS/FolderEditor/views/TreeOrderCmdImpl",["UWA/Core","UWA/Class","UWA/Class/Options","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/Folder_CSO","DS/FolderEditor/service/FolderServices","DS/FolderEditor/service/FolderEditorWebService","DS/PADServices/utils/GlobalModelEvents","DS/FolderEditor/utils/FolderEditorEvents","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/WidgetServices/UIInfra/UIInfra","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/PADUtils/Configuration","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout"],function(e,t,o,n,i,r,s,a,l,d,c,u,p,g,f,h){"use strict";var m,v=null,_=[];let S,C;var b,F=null;let y;return t.extend(o,{name:"folder-tree-order-",_dialog:null,init:function(e){this._parent(e),a.subscribe({event:"TreeOrderUpdatedInPanel"},function(e){if(e.flag&&e.relIdsArray&&e.relIdsArray.length>0)_.push(...e.relIdsArray);else{let t=e.getPreviousNode(),o=e.getNextNode();_.push(t?t.options.grid.relId:"null"),_.push(e.options.grid.relId),_.push(o?o.options.grid.relId:"null")}})},displayNotification:function(e){n.displayNotification({message:e,className:"error"})},reorderTree:async function(e){var t=this;_=[];let o=[];if("FolderSection_AllFolders"==(b=await r.getCurrentBookmarkInfo()).id||"FolderSection_favorite"==b.id||b.isFavorite)this.displayNotification(d.msg_info_reorder_NonRootbks);else{var n=require("DS/FolderEditor/views/FolderMode");"read"==n.getCurrentModeType()&&n.switchtoAuthoringMode();let i={iconName:"sorting",fontIconFamily:1};e._updateSortIcon(i),e._folders_SortElmt._toggleButton("TreeOrder"),C=b.getID(),s.folderTree({expandList:[],isRoot:"",isPersonalFolder:!1,pid:C,onComplete:function(e){(e=JSON.parse(e)).folders.length<2?t.displayNotification(d.msg_info_reorder_emptyBks):(e.folders.forEach(e=>{o.push({label:e.label,relId:e.RelId,TreeOrder:e.TreeOrder,icon:e.icon,owner:e.responsible,created:e.created,modified:e.modified})}),o.sort((e,t)=>parseFloat(e.TreeOrder)-parseFloat(t.TreeOrder)),S=o,t._createPanel(o))},onFailure:function(e){console.log("error while fetching children: "+e)}})}},_disableButtons(){let e=this._dialog.buttons;e.Ok.disabled=!0,e.Reset.disabled=!0},_enableButtons(e){e.Ok.disabled=!1,e.Reset.disabled=!1},_insertInView(e){e._isMoved=!0,this._dialog.buttons.Ok.disabled&&this._enableButtons(this._dialog.buttons)},_treeOrderUpdatedEvent(e,t){this._dialog.buttons.Ok.disabled&&this._enableButtons(this._dialog.buttons),t?a.publish({event:"TreeOrderUpdatedInPanel",data:{relIdsArray:e,flag:!0}}):a.publish({event:"TreeOrderUpdatedInPanel",data:e})},_createPanel:function(t){var o=this;require(["DS/Windows/Dialog","DS/Controls/Button","DS/Controls/TooltipModel"],(n,i,r)=>{o.immersiveFrame=widget.immersiveFrame;var s=e.createElement("div",{class:"folder-tree-order-reorder-dialog-body",styles:{width:"100%",height:"100%",padding:0}});o._dialog=new n({immersiveFrame:o.immersiveFrame,title:d.tree_ordering_panel_title+b.getLabel(),className:"folder-tree-order-reorder_dialog",content:s,resizableFlag:!0,modalFlag:!0,allowMaximizeFlag:!0,maximizeButtonFlag:!0,movableFlag:!0,width:700,minWidth:500,minHeight:300,height:500,position:{},touchMode:!0,buttons:{Ok:new i({label:d.tree_ordering_Reorder_btn,disabled:!0,onClick:this._reorderDone.bind(this)}),Reset:new i({label:d.tree_ordering_reset_btn,disabled:!0,onClick:o._onReset.bind(o)}),Cancel:new i({label:d.tree_ordering_cancel_btn,onClick:function(e){e.dsModel.dialog.close()}})}}),o._dialog.addEventListener("close",o._onClosePanel.bind(o),!1),o._dialog.elements.container.classList.add("folder-tree-order-tree_reorder_Dialog"),o._dialog.elements.container.addEventListener("click",function(e){return e.preventDefault(),e.stopPropagation(),!1});var a=new e.Element("div",{class:"folder-tree-order-reorder_tree_mainContainer"}).inject(s);m=new e.Element("div",{class:"folder-tree-order-reorder-manual-listview-container",styles:{width:"calc(100% - 50px)",height:"100%",position:"relative",display:"inline-block"}}).inject(a);var l=new e.Element("div",{class:"folder-tree-order-reorder-manual-updown-container",styles:{display:"flex","flex-direction":"column","justify-content":"center","vertical-align":"top"}}).inject(a);o.reorderToTop=new i({displayStyle:"icon",icon:{iconName:"move-to-top",fontIconFamily:WUXManagedFontIcons.Font3DS},disabled:!0,type:"radio"}).inject(l),o.reorderUp=new i({displayStyle:"icon",icon:{iconName:"up",fontIconFamily:WUXManagedFontIcons.Font3DS},disabled:!0,type:"radio"}).inject(l),o.reorderDown=new i({displayStyle:"icon",icon:{iconName:"down",fontIconFamily:WUXManagedFontIcons.Font3DS},disabled:!0,type:"radio"}).inject(l),o.reorderToBottom=new i({displayStyle:"icon",icon:{iconName:"move-to-bottom",fontIconFamily:WUXManagedFontIcons.Font3DS},disabled:!0,type:"radio"}).inject(l),o.reorderToTop.addEventListener("buttonclick",o._onReorderToTop.bind(o)),o.reorderUp.addEventListener("buttonclick",o._onReorderUp.bind(o)),o.reorderDown.addEventListener("buttonclick",o._onReorderDown.bind(o)),o.reorderToBottom.addEventListener("buttonclick",o._onReorderTobottom.bind(o)),o.reorderToTop.tooltipInfos=new r({shortHelp:d.tree_ordering_movetop_btn}),o.reorderUp.tooltipInfos=new r({shortHelp:d.tree_ordering_moveup_btn}),o.reorderDown.tooltipInfos=new r({shortHelp:d.tree_ordering_movedown_btn}),o.reorderToBottom.tooltipInfos=new r({shortHelp:d.tree_ordering_movebottom_btn}),o._createTreeOrderList(t)})},_createTreeOrderList:function(t){let o=this;v=null,y=null,o.arrowEnableFlag=void 0;o.model=new u({shouldAcceptDrop:function(e){return"middle"!==e.dropPosition&&e.draggedTreeNodeModel.getParent()===e.dropNode.getParent()}}),o.model.prepareUpdate();for(var n=0;n<t.length;n++){var i=t[n],r=new p({label:i.label,grid:i});o.model.addChild(r)}o.model.expandAll(),o.model.pushUpdate();let s=e.clone(g.getConfig("dgvOptions")),a=s&&s.dgv?s.dgv:{};var l=e.extend({identifier:"DataGridView-reorderListView-"+widget.id},a);l.treeDocument=o.model,l.columns=[{dataIndex:"tree",text:d.alpha_sorting,autoRowHeightFlag:!0,allowUnsafeHTMLContent:!1,editableFlag:!1,typeRepresentation:"url",getCellValue:function(e){let t=e.nodeModel.options.grid;return{label:t.label,icon:t.icon}}},{dataIndex:"owner",text:d.ViewTooltip["ds6w:responsible"],autoRowHeightFlag:!0,allowUnsafeHTMLContent:!1,editableFlag:!1},{dataIndex:"created",text:d.date_sorting,autoRowHeightFlag:!0,allowUnsafeHTMLContent:!1,editableFlag:!1,typeRepresentation:"date"},{dataIndex:"modified",text:d.ViewTooltip["ds6w:modified"],autoRowHeightFlag:!0,allowUnsafeHTMLContent:!1,editableFlag:!1,typeRepresentation:"date"}],l.layout=new h({cellHeight:30,columnHeaderHeight:38}),l.rowSelection="single",l.selectionBehavior={canInteractiveMultiselectWithCheckboxClick:!1,canMultiSelect:!1,enableFeedbackForActiveCell:!1,enableShiftSelection:!1,toggle:!1,unselectAllOnEmptyArea:!0},l.rowHeaderActivated=!0,l.cellDragEnabledFlag=!0,l.showSelectionCheckBoxesFlag=!1,l.onContextualEvent=(()=>[]),o._treeView=new f(l),o._treeView.inject(m),o._treeView.onDropCell=function(e,t){let n,i,r;if(e.preventDefault(),t.nodeModel&&(n=t.nodeModel),t.droppedNodes[0]&&(i=t.droppedNodes[0]),t.dropPosition&&(r=t.dropPosition),n&&i&&r){let e,t;switch(r){case"top":e=n.getPreviousNode(),t=n;break;case"bottom":e=n,t=n.getNextNode()}let s=[];s.push(e?e.options.grid.relId:"null"),s.push(i?i.options.grid.relId:"null"),s.push(t?t.options.grid.relId:"null"),o._treeOrderUpdatedEvent(s,!0)}return!0},o._treeView.addEventListener("click",function(e,t){let n=t.nodeModel;v||(y=v=n,o._enableManualSortButtons(o.reorderDown,o.reorderToBottom,o.reorderToTop,o.reorderUp)),v&&v!=n&&(y=v,v=n,y._isMoved&&(o._treeOrderUpdatedEvent(y),y._isMoved=!1))})},createDropZoneElement:function(){let t=d.tree_ordering_drop_here;F=e.createElement("div",{class:"folder-tree-order-dropZoneElmt",id:"dropZoneElmt",html:{tag:"div",html:[{tag:"div",class:"fonticon fonticon-plus-circled add"},{tag:"div",text:t,class:"text"}]}})},injectDropZone:function(e){this._isLastInList(e)?e.parentNode.appendChild(F):F.inject(e,"before")},_isLastInList:function(e){return null==e.nextSibling},_enableManualSortButtons:function(e,t,o,n){e.disabled=!1,t.disabled=!1,o.disabled=!1,n.disabled=!1},_disableManualSortButtons:function(e,t,o,n){e.disabled=!0,t.disabled=!0,o.disabled=!0,n.disabled=!0},_onReorderUp:function(){let t=this,o=t.model.getSelectedNodes()[0];if(e.is(o)){let e=o._rowID;if(e>0){let n=o.getPreviousNode();t.model.prepareUpdate(),o.getParent().insertBefore(o,n),t.model.pushUpdate(),o.select(),o._rowID!=e&&(t._insertInView(o),t._treeView.ensureNodeModelVisible(o))}}},_onReorderDown:function(){let t=this,o=t.model.getSelectedNodes()[0],n=t.model.getRoots().length;if(e.is(o)){let e=o._rowID;if(e<n-1){let n=o.getNextNode();t.model.prepareUpdate(),n.getParent().insertBefore(n,o),t.model.pushUpdate(),o.select(),o._rowID!=e&&(t._insertInView(o),t._treeView.ensureNodeModelVisible(o))}}},_onReorderToTop:function(){let t=this,o=t.model.getRoots()[0],n=t.model.getSelectedNodes()[0];if(e.is(n)){let e=n._rowID;e>0&&(t.model.prepareUpdate(),n.getParent().insertBefore(n,o),t.model.pushUpdate(),n.select(),n._rowID!=e&&(t._insertInView(n),t._treeView.ensureNodeModelVisible(n)))}},_onReorderTobottom:function(){let t=this,o=t.model.getSelectedNodes()[0],n=t.model.getRoots().length;if(e.is(o)){let e=o._rowID;e<n-1&&(t.model.prepareUpdate(),o.getParent().addChild(o),t.model.pushUpdate(),o.select(),o._rowID!=e&&(t._insertInView(o),t._treeView.ensureNodeModelVisible(o)))}},_reorderDone:function(){v&&v._isMoved&&(this._treeOrderUpdatedEvent(v),v._isMoved=!1),s.getTreeOrder({parentId:C,IDs:_}).then(e=>{if("failure"==e.status)n.displayNotification({message:e.error,className:"error"});else if(e.folders&&e.folders.length>=2){let t={};e.folders.forEach(e=>{t[e.id]={relationOrder:e.TreeOrder}}),a.publish({event:"updateContentNodes",data:{items:t,sort:!0}}),l.notifyFolderAttrChange(e,b),n.displayNotification({message:d.reorderSuccess,className:"success"})}this._onClosePanel()}).catch(e=>{n.displayNotification({message:e,className:"error"}),console.log(e)})},_onReset:function(){this._disableButtons(),v=null,_=[],y=null,this._disableManualSortButtons(this.reorderDown,this.reorderToBottom,this.reorderToTop,this.reorderUp),this._dialog.content.getChildren()[0].getChildren()[0].innerHTML="",this._createTreeOrderList(S)},_onClosePanel:function(){this._dialog.destroy(),this._dialog=null}})}),define("DS/FolderEditor/PersonalFolderManager",["DS/FolderEditor/service/FolderEditorWebService","DS/WebappsUtils/WebappsUtils","DS/FolderEditor/service/FolderTypeService"],function(e,t,o){"use strict";var n=void 0,i=!1;function r(e){void 0!==e&&(n=e)}return{getPersonalFolder:function(){return n},isInitialized:function(){return!0===i},resetToPreInitializedState:function(){n=void 0,i=!1},getPersonalRootFolderInFavoriteFormat:function(){return(e=n)?{id:e.id,name:e.name,type:e.type,isPersonal:e.isPersonal}:void 0;var e},isPersonalFolderToBeKept:function(e){var t=!1;return e&&(o.isPersonalFolder(e.type)||o.isRootFolder(e.type)&&e.isPersonal)&&(t=!0),t},setupPersonalFolder:function(){return new UWA.Class.Promise(function(n,s){!0===i?s():e.roots({type:"Personal",collabSpace:"All"}).then(e=>{var s=(e=JSON.parse(e)).folders;r(null);for(var a=s?s.length:0,l=0;l<a;l++){var d=s[l];if(o.isPersonalFolder(d.type)){var c={useAsyncPreExpand:!0},u=t.getWebappsAssetUrl("FolderEditor","icons/folder_perso.png");c.label=d.label,c.icons=[u],c.children=[],c.id=d.id,c.type=d.type,c.name=c.label,c.isPersonal=!0,r(c),i=!0;break}}n()}).catch(e=>{r(null),i=!0,s(e)})})}}}),define("DS/FolderEditor/popup/BookmarkExternalURLPopup",["UWA/Controls/Abstract","DS/Controls/Button","DS/Controls/Label","DS/Controls/LineEditor","DS/Windows/Dialog","DS/FolderEditor/utils/FolderEditorcontrol","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/BookmarkExternalURLPopup"],function(e,t,o,n,i,r,s,a){return e.extend({modal:null,onResize:function(){null!=this.ARWidget&&this.ARWidget.onResize()},init:function(e){this.elementsList=[],e=null!=e?e:{};var r=UWA.createElement("div",{class:"bookmark-Add-External-Link-command"});let l=UWA.createElement("div",{class:"bm-add-link-row"});l.inject(r);new o({value:a.title,emphasize:"NONE",width:"100px",class:"bm-add-link-row-Label"}).inject(l);UWA.createElement("span",{class:"bm-add-link-row-asteric",text:" * "}).inject(l);let d=new n({}).inject(l);e.titleToChange&&(d.value=e.titleToChange),(l=UWA.createElement("div",{class:"bm-add-link-row"})).inject(r);new o({value:a.url,emphasize:"NONE",width:"100px",class:"bm-add-link-row-Label"}).inject(l);UWA.createElement("span",{class:"bm-add-link-row-asteric",text:" * "}).inject(l);var c=new n({}).inject(l);e.urlToChange&&(c.value=e.urlToChange);let u=void 0!==e.title?e.title:a.title_add_new_link;this.dialog=new i({title:u,content:r,immersiveFrame:widget.immersiveFrame,minHeight:150,minWidth:200,width:500,modalFlag:!0,resizableFlag:!0,buttons:{Ok:new t({label:a.create,disabled:!1,emphasize:"primary",onClick:function(t){""===c.value||""===d.value?s.displayNotification({message:a.msg_warning_empty_values,className:"warning"}):(t.dsModel.dialog.buttons.Ok.disabled=!0,e.onOkClick&&(e.onOkClick({dataURL:c.value,dataURLTitle:d.value}),t.dsModel.dialog.destroy()))}}),Cancel:new t({emphasize:"secondary",onClick:function(e){e.dsModel.dialog.destroy()}})}}),this.dialog.getContent().addClassName("bookmark-Add-External-Link"),this.dialog.addEventListener("close",function(e){console.log("Close on dialog : "+e.dsModel.title),e.dsModel=null})}})}),define("DS/FolderEditor/commands/FolderCommands",["UWA/Core","UWA/Utils","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUXUtil/IPClassifyConfirmation","DS/IPClassifyUXUtil/IPClassifyConfirmationWthCheckBx","DS/FolderEditor/popup/BookmarkConfirmationWthCheckBx","DS/FolderEditor/Folder_CSO","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/service/FolderServices","DS/FolderEditor/service/FolderTypeService","DS/UIKIT/Mask","DS/FolderEditor/utils/FolderEditorcontrol","DS/WebappsUtils/WebappsUtils","DS/ApplicationFrame/CommandsManager","DS/FolderEditor/Folder_Clipboard","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/FolderEditorUtil","DS/PADUtils/views/PADProgressBar","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/models/xBookNodeModel","DS/PADServices/utils/AttributesMgtV2","DS/WidgetServices/WidgetServices","DS/UIKIT/Native/Dropdown","DS/IPClassifyUtil/IPClassifyCommunication","DS/FolderEditor/ActionBar/FolderCommandManager","DS/FolderEditor/utils/BookmarkLocationUtil","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/popup/BookmarkLocationPopup","DS/FolderEditor/views/FolderRevisionReportPanel","DS/FolderEditor/views/FolderMode","DS/IPClassifyUXUtil/ProgressPaneExecution","DS/Controls/ButtonGroup","DS/Controls/Toggle","DS/FolderEditor/popup/BookmarkExternalURLPopup","DS/FolderEditor/service/BkOperationsUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADPredicatesNls","DS/PADUtils/PADSettingsMgt","DS/Menu/ContextualMenu"],function(e,t,o,n,i,r,s,a,l,d,c,u,p,g,f,h,m,v,_,S,C,b,F,y,D,E,w,A,T,I,x,P,k,N,M,O,U,R,B){"use strict";let L=!1,V=null;function W(e,t,n){var i=t;if(n&&n.advice)console.error(e,n.error),o.displayNotification({title:i,subtitle:n.advice,message:n.error,className:"error"});else{console.error(e,n);let t={className:"error"};t.message=i,!UWA.is(n)||n instanceof Error||(t.title=i,t.message=n),o.displayNotification(t)}}function j(e,t){return new Promise((o,n)=>{l.MoveFolder({IDs:e,targetfolder:t.Target_FolderNode,callbacks:{onComplete:function(t){o({status:"success",folderMoved:e.length})},onFailure:function(e){o({status:"failure",error:e})}}})})}function q(e,t){return new Promise((o,n)=>{l.CopyFolder({IDs:e,targetfolder:t.Target_FolderNode,withContent:t.withContent,prefix:t.prefix,suffix:t.suffix,callbacks:{onComplete:function(t){o({status:"success",folderCopied:e.length})},onFailure:function(e){o({status:"failure",error:e})}}})})}var H=null;return{_endProgressBarListener:function(){var e=this;u.getContent().addEvent("onCompleteRefreshNodes",function(t){this.removeEvent("onCompleteRefreshNodes"),e._offProgressBar()})},_offProgressBar:function(){if(0===v._counter)return null;v.off()},_startProgressBar:function(e){1===v._counter&&v.off(),v.on(e)},_nbItemsNotNull:function(e){var t,o=e.length,n=0;for(t=0;t<o;++t)e&&n++;return n},_activeCuttingNodes:!1,_setStateCuttingNodes:function(e){var t=0,o=e.length;if(this._activeCuttingNodes&&this._setStaUncuttingNodes(),0===o)return null;for(t=0;t<o;++t)e[t].updateOptions({isBeingCut:!0});this._activeCuttingNodes=!0},_setStaUncuttingNodes:function(){var e,t,o,n=0;if(this._activeCuttingNodes){if(0===(t=(e=f.getSelectedNodes()).length))return null;for(n=0;n<t;++n)(o=e[n]).options.isBeingCut&&o.updateOptions({isBeingCut:!1});this._activeCuttingNodes=!1}},escapCmd:function(){this._activeCuttingNodes&&(this._setStaUncuttingNodes(),f.ClearClipboard()),u.getContent().getPADTreeListView().escape(),u.getTreeCont().escape()},RenameCmd:function(e,t){var o="tree";if(t)var n=u.getTreeCont()._folders_TreeView;else{n=u.getContent().getPADTreeListView().getManager();e.nodeModel.isFavorite&&(o="favoriteTitle")}var i=n.layout.getColumnIndex(o),r=n.layout.getCellIDFromCoordinates({rowID:e.rowID,columnID:i});n.setCellInEdition(r)},CopyCmd:function(){var e=[];e=u.getContent().getSelectedNodes();var t=s.getSelectedBookmark();e=e.length>0?e:[t],this._setStaUncuttingNodes(),f.addInFolderClipboard(e,t,"COPY")},CutCmd:function(){var e=[];e=u.getContent().getSelectedNodes();var t=s.getSelectedBookmark();1===(e=e.length>0?e:[t]).length&&e[0].getID()===t.getID()?u.getTreeCont()._folders_TreeView:e.length>0&&u.getContent().getPADTreeListView(),this._setStateCuttingNodes(e),f.addInFolderClipboard(e,t,"CUT")},PasteCmd:async function(e){var t=await l.getCurrentBookmarkInfo(),n=f.getTreeNode(),i=f.getSelectedNodes(),s=f.getMode(),c=e&&d.inFamilyFolder(e.getType())?e:null;function p(e,t,o,n){if(o.id===t.id){if(UWA.is(n,"array"))for(var i=0;i<n.length;i++){if("CUT"===e)return!1;var r=u.getContent().getPADTreeDocument().searchRootById(n[i].getID());if(UWA.is(r))return!1}}else if("CUT"===e&&!d.isRootFolder(t.getType())){if(UWA.is(n,"array")&&1===n.length&&n[0]===t){var s=t.getParent();if(s&&s.id===o.id)return!1}}return!0}function g(e){return"FolderSection_AllFolders"===e.getType()&&(o.displayNotification({subtitle:a.msg_error_Addinfolder,className:"error"}),!0)}if(c||(c=t),i){if(this._setStaUncuttingNodes(),d.inFamilyFolder(c.getType()))for(var h=0;h<i.length;h++)if(d.inFamilyFolder(i[h].getType())&&!1===m.checkMoveOrCopyAcrossSharedAndPersonal(i[h],c,"COPY"==s))return void this._offProgressBar();var v=[],_=[],S=[],C=[];if(Array.isArray(i)||(i=[i]),i.length>0&&i.forEach(function(e){v.push(e.getID()),d.isFolder(e.getType())?(_.push(e.getID()),S.push(e)):d.isRootFolder(e.getType())?(_.push(e.getID()),S.push(e)):C.push(e)}),c){if("CUT"==s){if(_.length>0)if(p(s,n,c,i)){let e=_.length;for(var b=[];_.length>0;){let e=_.splice(0,1);b.push(e)}let i=a.replace(a.progressPanel_moveFolder,{objectsAdded:e,targetfolder:c.options.label}),r={};r.Target_FolderNode=c,x.launchPanel(i,b,j,r).then(e=>{let i,s=0;if(e.forEach(e=>{e&&!e.error?s+=e.folderMoved:i||(i=e.error)}),0!=s){o.displayNotification({message:a.replace(a.msg_info_foldermoved,{number:s,foldername:r.Target_FolderNode.options.label}),className:"success"});for(var l=0;l<S.length;l++){var d=null,p=S[l],g=p.getParent();if(null===g)null===(d=u.getTreeCont()._getVisibleNodeById(p.id,null))?(d=p,g=n):g=d.getParent();else d=p;u.getTreeCont().removeFromTree(d)}null!==c&&UWA.is(u.getTreeCont())&&u.getTreeCont().updateTreeWithNewFolder(c),f.ClearClipboard(),D.updateCommands(),u.getContent().loadContentAndSelect(t)}else{var h=i;i&&i.message&&i.message.contains("NetworkError")&&i.message.contains("500")?o.displayNotification({message:a.msg_error_objectNoLongerAccessible,className:"error"}):(i&&i.targetfolder&&"FolderSection_AllFolders"===i.targetfolder.getType()&&(h=a.msg_error_CutPasteToRoot),W("PasteCmd",a.msg_error_MoveFolder,h))}})}else this._offProgressBar(),o.displayNotification({title:a.msg_error_MoveInSamefolder.Title,subtitle:a.msg_error_MoveInSamefolder.Advice,className:"error"});C.length>0&&(p(s,n,c,i)?g(c)||(M.processMoveOperation(C,n.getID(),c),f.ClearClipboard()):o.displayNotification({title:a.msg_error_MoveInSamefolder.Title,subtitle:a.msg_error_MoveInSamefolder.Advice,className:"error"}))}else if("COPY"==s){if(_.length>0){var F=function(e){let n=a.replace(a.confirmation_info,{From:"FolderSection_AllFolders"===c.getType()?a.name_Folder_type:a.name_RootFolder_type,To:"FolderSection_AllFolders"===c.getType()?a.name_RootFolder_type:a.name_Folder_type});r.launch({title:a.replace(a.PasteCmdTitle,{source:1===_.length?S[0].getLabel():a.name_Section_AllFolders}),confirmLabel:a.confirmation_copy,infoTitle:l.isSourceAndTargetTypeSame(S,c)?null:n,mainDivContent:{divHeaderShow:e,checkBoxParams:{label:a.confirmation_copyMassive_checkBox}}},function(){if(r.getRadioBoxCheckedFlag()){var e=[],n={};n.id=c.id,n.targetID=_,e.push(n.id);let t=a.replace(a.msg_creating_AddShortcut,{objectsAdded:n.targetID,targetfolder:c.getLabel()});x.launchPanel(t,e,y,n).then(()=>{})}else{var i={};i.withContent=r.getChkBoxCheckedFlag(),i.prefix=r.getPrefixValue(),i.suffix=r.getSuffixValue();let e=_.length;for(var s=[];_.length>0;){let e=_.splice(0,1);s.push(e)}let n=a.replace(a.progressPanel_copyFolder,{objectsAdded:e,targetfolder:c.options.label});i.Target_FolderNode=c,x.launchPanel(n,s,q,i).then(e=>{let n,r=0;e.forEach(e=>{e&&!e.error?r+=e.folderCopied:n||(n=e.error)}),0!=r?(o.displayNotification({message:a.replace(a.msg_info_foldercopied,{number:r,foldername:i.Target_FolderNode.options.label}),className:"success"}),u.getContent().loadContentAndSelect(t),null!==t&&t.isExpanded()&&UWA.is(u.getTreeCont())&&u.getTreeCont().updateTreeWithNewFolder(t)):n&&n.message&&n.message.contains("NetworkError")&&n.message.contains("500")?o.displayNotification({message:a.msg_error_objectNoLongerAccessible,className:"error"}):W("PasteCmd",a.msg_error_CopyFolder,n)})}},function(){})},y=function(e,t){return new Promise((e,n)=>{l.AddShortcut(t),t.callbacks={onComplete:function(t){e(),I.switchtoAuthoringMode(),u.getContent().loadContentAndSelect(),o.displayNotification({title:a.msg_AddShortcutSuccess.title,subtitle:a.msg_AddShortcutSuccess.subtitle,message:a.msg_AddShortcutSuccess.message,className:"success"})},onFailure:function(t,n,i){e();var r=t;t&&n&&n.error?W("PasteCmd AddShortcut",n.error,t):t&&t.message&&t.message.contains("NetworkError")&&t.message.contains("500")?o.displayNotification({title:a.msg_AddShortcutFail.title,subtitle:a.msg_AddShortcutFail.subtitle,message:a.msg_AddShortcutFail.message,className:"error"}):W("PasteCmd",a.msg_error_AddShortcut,r)}}})};l.CheckCopyFolder({IDs:_,callbacks:{onComplete:function(e){F()},onFailure:function(e){F(a.confirmation_copyMassive_message)}}})}C.length>0&&(p(s,n,c,i)?g(c)||M.processAddOperation(C,c):o.displayNotification({title:a.msg_error_MoveInSamefolder.Title,subtitle:a.msg_error_MoveInSamefolder.Advice,className:"error"}))}}else this._offProgressBar(),o.displayNotification({message:a.msg_warning_nocurrentfolder,className:"warning"})}},expandQuery:function(e,t){return new Promise(n=>{l.expandProducts({IDs:e,callbacks:{onComplete:function(e){e.forEach(function(e){t.push(e)}),o.displayNotification({message:a.msg_info_objetexpanded,className:"success"}),n()},onFailure:function(e){n(),W("RemoveContentCmd",a.msg_info_objetexpandedError,e)}}})})},checkObjectType:function(e){for(var t=!0,o=0;o<e.length;o++)if(null==e[0].getChildren()){t=!1;break}return t},RemoveContentCmd:async function(e,t){var i=!1;if(w.isSearchActive())this.RemoveContentSearchWithinCmd();else{var r=this,d=await l.getCurrentBookmarkInfo();if(d){var c=UWA.createElement("div",{text:a.confirmation_remove_message}),u=s.getSelectedNodes(),p=new P({type:"checkbox"});p.addChild(new k({type:"checkbox",label:a.removeStructuralObject,value:0,checkFlag:!1})),!0===this.checkObjectType(u)&&p.inject(c),p.addEventListener("buttonclick",function(e){!0!==widget.getPreference("allow-products-expand").value?(o.displayNotification({title:a.msg_info_notEnabledExpand.Title,subtitle:a.msg_info_notEnabledExpand.Advice,className:"warning"}),e.dsModel.checkFlag=!1):i=e.dsModel.checkFlag});let e=u;n.launch({title:a.confirmation_remove_title,label:a.confirmation_remove_message,content:c},function(){if(!0===i){let t=[];e=[],u.forEach(function(o){o.getAttributeValue("links")?e.push(o):t.push(o.getID())}),x.execute({title:a.replace(a.progressPanel_expand,{objectsexpanded:u.length,targetfolder:d.getLabel()}),datas:t,query:t=>r.expandQuery(t,e)}).then(()=>{I.switchtoAuthoringMode(),M.processRemoveOperation(e,d)})}else I.switchtoAuthoringMode(),M.processRemoveOperation(e,d)})}else o.displayNotification({message:a.msg_warning_nocurrentfolder,className:"warning"})}},RemoveContentSearchWithinCmd:async function(){var e=this,t=u.getContent().getSelectedNodes()[0];if(null!=t){let l=t.getAttributeValue("_paths");if(!l){let e=await E.updateNodesWithPath([t]);e&&e.pids&&(l=e.pids[t.getID()]._paths)}if(l&&0!=l.length)if(l.length<=20){var n=t.getLabel(),i={title:a.replace(a.OpenLocationRemoveTitle,{label:n}),message:a.OpenLocationRemoveMessage,radio:!1,okButtonLabel:a.button_remove};i.onOkClick=(()=>{var n=g.getCommand("RemoveContent");n.disable();var i=t.getID();let r=[];l.forEach(e=>{if(t.getAttributeValue("links")){let o=e.linkInfo,n=s.getDefaultModelFromProperties(t);n.links=[o],r.push(M.processRemoveOperation([n],o.owner,!0))}else{let t=e.info;if(t.length>0){let e=t[t.length-1];r.push(M.processRemoveOperation([i],e.resourceid,!0))}}});let d={};for(var c=0;c<l.length;c++){let e=l[c],t=e.info[e.info.length-1].resourceid;d[t]=c}let u=t.options.label;Promise.all(r).then(t=>{let n=!1;var i=[];let r=0;if(t.forEach(e=>{if(n=n||!e,e&&e.length>0){let t=e[0],o=t.bookmarkId;n=n||t.error;let s=d[o];if(void 0!==s){let e="success";t.error?e=t.networkErr?"serverError":"noChangeAllowed":0===t.numberOfContentRemoved&&(r+=t.numberOfContentNotRemoved,e="noRelationFound"),i[s]=e}}}),n)e.locationPopop.dialog.buttons.Ok.visibleFlag=!1,e.locationPopop.dialog.buttons.Cancel.label=a.button_close,e.locationPopop.pushNotif(i);else{let n=r>0?" "+a.replace(a.msg_info_notConnectToBk,{number:r}):"";o.displayNotification({message:a.replace(a.msg_info_objectremovedfromfolders,{objectname:u,number:t.length-r})+n,className:"success"}),e.locationPopop.dialog.close()}}).finally(()=>{n.enable()})});var r=new A(l,E.getHtmlElemFromPath.bind(E),i);e.locationPopop=r}else o.displayNotification({title:a.msg_warning_removeContentFromSearch.title,subtitle:a.msg_warning_removeContentFromSearch.advice,message:a.msg_warning_removeContentFromSearch.details,className:"error"});else console.log("RemoveContentSearchWithinCmd"),o.displayNotification({message:a.msg_warning_contentnotavailable,className:"warning"})}else o.displayNotification({message:a.msg_warning_nocontent,className:"warning"})},RemoveShortcutCmd:async function(e,t){var i=this,r=await l.getCurrentBookmarkInfo();r?n.launch({title:a.confirmation_removeshortcut_title,content:a.confirmation_removeshortcut_message},function(){var e=s.getSelectedNodes();if(e.length>0){i._startProgressBar(a.Remove_content_loading);var t=g.getCommand("RemoveShortcut");t.disable();var n=[];e.forEach(function(e){UWA.is(e.id)&&-1===n.indexOf(e.id)&&n.push(e.id)}),I.switchtoAuthoringMode(),l.RemoveContent({IDs:n,isLinkedFolder:!0,callbacks:{onComplete:function(){if(n.length>10)u.getContent().RefreshProductStructure=!0,u.getContent().loadContentAndSelect(r);else for(var e=0;e<n.length;e++){var t=n[e];u.getContent().removeNodeInContent(t)}var s=u.getContent().getObjectsInTree();u.getContent().getObjectsInTree(),0===s&&u.getContent()._addPlaceHolder(),i._offProgressBar(),o.displayNotification({message:a.replace(a.msg_info_objetremoved,{number:n.length,foldername:r.getLabel()}),className:"success"})},onFailure:function(e){i._offProgressBar(),t.enable(),W("RemoveContentCmd",a.msg_error_Removefromfolder,e)}}})}else o.displayNotification({message:a.msg_warning_nocontent,className:"warning"})}):o.displayNotification({message:a.msg_warning_nocurrentfolder,className:"warning"})},ExpandAllCmd:function(e,t){var n=[];"TREE"===t&&e?n.push(e):n=s.getSelectedNodes();var i=null;i=s.getSelectedBookmark(),n.length?n.forEach(function(e){null===e.options.children||("TREE"===t||d.isFolder(e.getType())||"FolderSection_AllFolders"===e.getType()?e.expand({expandLevel:"All"}):e.expandAll())}):null===i?o.displayNotification({message:a.msg_warning_nocurrentfolder,className:"warning"}):i.expandAll()},CollapseAllCmd:function(e,t){var n=[],i=s.getSelectedBookmark();"TREE"===t&&e?n.push(e):n=s.getSelectedNodes(),n.length?n.forEach(function(e){e.childComputed=!1,e.options.children=[],e.setHasAsyncChildren(!0),e.collapseAll()}):null===i?o.displayNotification({message:a.msg_warning_noselection,className:"warning"}):i.collapseAll()},AccessRightCmd:function(e){D.launchCommand("ActionBar_AccessRightCmd",e)},uploadFileCmd:async function(e,t){let n=await l.getCurrentBookmarkInfo();require(["DS/DocumentCreateNew/CreateNew","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices"],(i,r,l)=>{var d=t?t.getID():s.getCurrentBookmarkId(),c=t?t.getLabel():n.getLabel(),p=new i({tenantUrl:l.get3DSpaceUrl(),securityContext:r.getSetting("pad_security_ctx"),tenant:l.getPlatformId(),immersiveFrame:widget.immersiveFrame,parentId:d,parentRelName:"Vaulted Objects",containerToOverlay:widget.body,getWorkUnderHeaders:function(){return{}},onUploadStart:function(){I.switchtoAuthoringMode()},onCancel:function(){},onError:function(e){o.displayNotification({title:e.title,message:e.message,className:"error"})},onDocumentUpload:function(e){u.getContent()._placeHolder.getContent().remove(),o.displayNotification({message:a.replace(a.get("msg_info_objetadded"),{filename:e.documents[0].dataelements.title,foldername:c}),className:"success"}),e.documents.forEach(function(e){var t=e.dataelements.parentId;t===s.getCurrentBookmarkId()&&_.getContentProperties({pid:e.id,onComplete:function(e){if(t==s.getCurrentBookmarkId()){UWA.is(e,"string")&&(e=JSON.parse(e));var o=m.convertToExaleadDataFormat(e);o.grid.isLastRevision=!0;var n=new S(o),i=u.getContent().getPADTreeDocument();i.wrapInTransaction(function(){i.addRoot(n),U.updateNLS(n)})}},onFailure:function(){console.error("Unable to update Document node, Error in getting content Properties")}})})}});e?p.create(e):p.selectFilesAndCreate()})},DownloadFileCmd:function(){var e=s.getSelectedNodes(),t=m.isTouchDevice();if(0===e.length)o.displayNotification({message:a.msg_warning_nocontent,className:"warning"});else{e[0].getType();var n=e[0].options.type;if(!t&&u.isCustomizedEnv())1===e.length?"Document"!==n&&"CATAnalysisResults"!==n&&"CATIA Design Table"!==n&&"CATIA CGR"!==n&&"CATAnalysisComputations"!==n&&require(["DS/ApplicationFrame/CommandsManager","DS/FolderEditor/utils/FolderEditorcontrol"],function(e,t){e.getCommand("BulkDownload").begin()}):require(["DS/ApplicationFrame/CommandsManager","DS/FolderEditor/utils/FolderEditorcontrol"],function(e,t){e.getCommand("BulkDownload").begin()});else l.downloadFiles(void 0)}},FolderUploadCmd:async function(){var e={},t=await l.getCurrentBookmarkInfo();if(t){e.id=t.getID(),e.lable=t.getLabel();u.getContent().getPADTreeDocument().getNodesById(e.id);l.FolderUpload(e)}},addExternalLink:async function(){const e=await l.getCurrentBookmarkInfo();if(!e)return;const t={id:e.getID(),onOkClick:async e=>{let n={id:t.id,urlTitle:e.dataURLTitle};n.url=/^[A-Za-z]+:/.test(e.dataURL)?e.dataURL:`https://${e.dataURL}`;try{await l.addExternalLink(n),I.switchtoAuthoringMode(),u.getContent().loadContentAndSelect(),o.displayNotification({title:a.msg_AddLinkSuccess.title,message:a.msg_AddLinkSuccess.message,className:"success"})}catch(e){let t=e&&e.serverErr&&e.serverErr.error?e.serverErr.error:a.msg_AddLinkFail.message;W("addLink",a.msg_AddLinkFail.title,t)}}};new N(t)},openExternalLink:function(){let e=u.getContent().getSelectedNodes();window.open(e[0].options.grid.Link)},FolderDownloadCmd:function(){var e={},t=s.getSelectedNodes(),o=[],n="function"==typeof t[0].getType?t[0].getType():null;d.inFamilyFolder(n)&&(D.getCommand("FolderDownload").disable(),e.id=t[0].getID(),o.push(e),x.execute({title:a.replace(a.progressPanel_download,{bookmarkname:t[0].getLabel()}),datas:o,query:e=>l.FolderDownload(e)}).then(()=>{D.getCommand("FolderDownload").enable(),console.log("command enabled")}))},GetContextualMenu:async function(e,t,o){return new Promise(async(n,i)=>{var r,s=!!e.white_Click&&e.white_Click,a=o?u.getContent().getSelectedNodes():[];r=!0===s?await l.getCurrentBookmarkInfo():a&&a.length>0&&"TREE"!=t?a:e.nodeModel,s&&a.length>0&&a.forEach(function(e){e.unselect()}),r&&!Array.isArray(r)&&(r=[r]),o||(o={cellInfos:e,data:{event:{pageX:0,pageY:0}}}),o.overrideAppLaunch=!0,D.getContextualMenu(r,"TREE"===t,o).then(n).catch(i)})},_addCtxItem:function(e,t,o){if("DS/ResultWebInWin/ResultWebInWinAction"==t.sourcejs){let n=t.image,i=o&&o[n]?o[n]:"",r={type:"PushItem",title:t.title,icon:i,action:{callback:()=>{var e=[s.getSelectedNodes()[0].getID()];y.publish("onActionContextualMenu",{header:t.id,ids:e})}}},a=[];t.items&&(t.items.forEach(e=>{this._addCtxItem(a,e)}),r.submenu=a),e.push(r)}},showWebInWinCtxMenu:function(e,t){var o=t;if(o&&o.actions){var n=[];o.actions.forEach(e=>{e.actions&&e.actions.forEach(e=>{this._addCtxItem(n,e,t.images)})}),this._initDropDown(n)}},_initDropDown:function(e){if(!H)return;L=!0;let t=B.addEventListener(H,{callback:function(){return e}});B.buildAndDisplayContextualMenu(H,{clientX:V.x,clientY:V.y}),B.removeEventListener(H,t),L=!1},getCtxMenu:function(e){var t=this;return e.data&&(V={x:e.data.event.pageX,y:e.data.event.pageY}),L?Promise.resolve([]):new Promise(async function(o,n){var i=null,r=null;H=e.infos?e.infos.target:void 0,i=e.graphview?(r=e.graphview).node:e.treeview?(r=e.treeview).nodeModel?r.nodeModel:r.cellModel:(r=e.cellInfos)?r.nodeModel?r.nodeModel:r.cellModel:null;var s=!0===widget.getValue("noCompass"),a=!0===widget.getValue("standalone"),l=b.isSolidworksEnvironment();if(s&&null!==i&&"object"==typeof i&&(!l&&!a))return y.publish("Create_ContextMenu",{ids:i?[i.id]:[]}),i&&!1===i.isSelected()&&i.select(!0),void o(void 0);null==r&&(r={});var d=r.rowID<0;if(r.cellView||e.graphview&&i||(r.white_Click=!0),i&&!0===i._busy)o(void 0);else{var c=null;r.white_Click||1==d?c=r:i&&(!1===i.isSelected()&&i.select(!0),!0===i.isSelected()&&(c=e.graphview?i:r)),t.GetContextualMenu(c,"CONTENT",e).then(o).catch(n)}})},previewFileCmd:function(e){require(["DS/PADUtils/PADUtilsServices","DS/DocumentCommands/ENOXDocumentCommands","DS/WidgetServices/WidgetServices"],function(t,o,n){var i=t.get3DSpaceUrl(),r=widget.widgetDomain,s=R.getSetting("pad_security_ctx"),a={document:{id:e[0].getID(),contextId:s,serviceId:"3DSpace",envId:n.getTenantID(),index:1,data:null,type:"Document"},platformUrls:{"3DSpace":i,"3DDashboard":r},onComplete:function(e){console.log("success")}},l=new o,d=l.init(a);(d=d||Promise.resolve()).then(()=>{l.render().Preview2.handler()})})},activateFolderEditorItem:function(e){let t=e.id,o=e.getType();if(t&&d.inFamilyFolder(o)){let t=null;if(!e.isFavorite){t=e.options.grid.ParentBk;let o=s.getCurrentBookmarkId();"TRUE"!==e.options.grid.isLinkedFolder&&!t&&o&&(t=o)}t&&(e._parentBk=t),e.isFavorite=!1,s.dispatchBookmarkNodeSelection(e)}else!0===D.areCommandsAvailable(null,[e],["PreviewFile"]).PreviewFile&&this.previewFileCmd([e]),console.log("Selected (Double Clicked) object is not folder")},_createLink:async function(e,t){var n=null,i=null,r=null,c=null,u="",p=null;let g=await l.getCurrentBookmarkInfo();if(e)p="function"==typeof e.getType?e.getType():null,i=e.getID(),r=e.getLabel();else{const e=s.getSelectedNodes();1==e.length&&(p="function"==typeof e[0].getType?e[0].getType():null,d.isBookmark(e[0])?(i=e[0].getID(),r=e[0].getLabel()):(u=e[0].getID(),i=g.getID(),r=g.getLabel(),c=e[0].getLabel()))}null!=i&&b.getSourceUrlAsync({platformId:b.getTenantID(),source:"3DDashboard",onComplete:function(e){var t={data:{items:[{objectId:i,contentId:u,envId:widget.getValue("x3dPlatformId")}]}};n=e+"#app:ENOFOL3_AP/content:X3DContentId="+encodeURIComponent(JSON.stringify(t)),m.copyTexttoCLipboard(n).then(()=>{c&&o.displayNotification({message:a.replace(a.msg_success_copyLink_content,{filename:c,foldername:r}),className:"success"}),d.inFamilyFolder(p)&&o.displayNotification({message:a.replace(a.msg_success_copyLink_folder,{foldername:r}),className:"success"})}).catch(e=>{console.log("%c"+e,"color: orange"),o.displayNotification({message:a.msg_error_copylink,className:"error"})})}})}}}),define("DS/FolderEditor/commands/ActionBar_UPSReplaceByLatestRevision",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/service/FolderServices","DS/WidgetServices/WidgetServices","DS/PADUtils/PADSettingsMgt","DS/FolderEditor/Folder_CSO","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorcontrol","DS/PADUtils/views/PADProgressBar","DS/FolderEditor/views/FolderRevisionReportPanel","DS/FolderEditor/views/FolderMode"],function(e,t,o,n,i,r,s,a,l,d,c,u,p){"use strict";var g=[];function f(t,o,n){var i=o;!e.is(n)||n instanceof Error||(i+="<br>"+n),a.displayNotification({message:i,className:"error"})}function h(){if(0===c._counter)return null;c.off()}return t.extend({labelTopBar:e.i18n("Replace By Latest Revision"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},execute:function(){var e={},t=[],o=s.getSelectedNodes(),i=o.length;o&&o.length<101?(o.forEach(function(e){var o={id:e.id};t.push(o)}),e={lastVersionRequests:t},n.getlastversion({objectsToTreat:e,callbacks:this._treatLatestRevision(i,o)})):a.displayNotification({message:l.msg_warning_replaceByLatestRevision_NotMorethan100Objects,className:"warning"}),this.end()},endExecute:function(){g=[]},_treatLatestRevision:function(e,t){var o=this;return{onComplete:function(i){var r=[],s=[],d=JSON.parse(i);d.lastVersionRequests.length>0&&d.lastVersionRequests.forEach(function(e){if(e.islast){var o=t.find(function(t){return t.id===e.id});if(o){var n={};n[o.options.label+" "+o.options.grid["ds6wg:revision"]]="isLatestRevision",g.push(n)}}else r.push(e.id),s.push(e.candidates[0])});var u,p=r.length;if(p>0){var f=r.length,h={numberOfSelectedObjects:e,objectsWithValidRevisions:f,idsToTreat:p};u=l.Replace_revision_loading,1===c._counter&&c.off(),c.on(u),n.replaceContent({IDsRemoved:r,IDsAdded:s,callbacks:o._treatReplacedContent(h)})}else a.displayNotification({message:l.msg_warning_replaceByLatestRevision_sameObject,className:"warning"})},onFailure:function(e){f(0,l.msg_error_ReplaceBylatestRevision,e)}}},_treatReplacedContent:function(e){var t=this;return{onComplete:function(o){var n=JSON.parse(o);if("success"===n.status){var i={numberOfSelectedObjects:e.numberOfSelectedObjects,noObjectsReplaced:n.noObjectsReplaced,noObjectsExplicitlyRemoved:n.noObjectsExplicitlyRemoved,noObjLatestRevisionAlreadyPresent:e.numberOfSelectedObjects-e.objectsWithValidRevisions};a.displayNotification({message:l.msg_info_replaceByLatestRevision,className:"success"}),h(),t._updateTheNodes(n,i)}},onFailure:function(e){h(),f(0,l.msg_error_ReplaceBylatestRevision,e)}}},_updateTheNodes:function(e,t){var o=require("DS/PADServices/utils/AttributesMgtV2"),i=require("DS/FolderEditor/utils/FolderEditorUtil");p.switchtoAuthoringMode();var r=d.getContent().getPADTreeDocument(),s=[],a=[],c=[],f=[];var h=new Promise(function(t){"replacablecontent"in e?r.wrapInTransaction(function(){r.withTransactionUpdate(function(){Object.keys(e.replacablecontent).forEach(function(t){d.getContent().getPADTreeDocument().getNodesById(t).forEach(function(n){if(0===n.getDepth()){n.collapse(),n.childComputed=!1,n.removeChildren();var r=e.replacablecontent[t];if(n.options){var a={};a[n.options.label+" "+n.options.grid["ds6wg:revision"]]=r.label+" "+r.revision,s.push(a)}var l=i.convertToExaleadDataFormat(r),d=i.convertToArray(l);n.updateAttributes(d,o.getAvailableColumns()),n.setAttribute("id",r.id),n.id=r.id,n.options.label=r.label,n.options.resourceid=r.id,n.options.type=r.type;n.updateOptions({grid:{isLastRevision:!0}}),n.select()}})}),t()})}):t()}),m=new Promise(function(t){"nodesToBeRemoved"in e?e.nodesToBeRemoved.length>0&&r.wrapInTransaction(function(){r.withTransactionUpdate(function(){e.nodesToBeRemoved.forEach(function(e){d.getContent().getPADTreeDocument().getNodesById(e).forEach(function(e){if(0===e.getDepth()&&(e.collapse(),r.removeRoot(e,!0,!1),e.options)){var t={};t[e.options.label+" "+e.options.grid["ds6wg:revision"]]="ToBeRemoved",s.push(t)}})}),t()})}):t()});Promise.all([h,m]).then(async function(){let e=await n.getCurrentBookmarkInfo();(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){"ToBeRemoved"===e[t]?a.push(l.replace(l.revisionReport.explicitlyRemoved,{prd1:t})):"isLatestRevision"===e[t]?c.push(l.replace(l.revisionReport.isLatestRevison,{prd1:t})):a.push(l.replace(l.revisionReport.successfullyReplaced,{prd1:t,prd2:e[t]}))})}),f.push(l.replace(l.revisionReport.msgObjectSelected,{object:t.numberOfSelectedObjects})),t.noObjLatestRevisionAlreadyPresent>0&&f.push(l.replace(l.revisionReport.msgObjectAlreadyLatestRevision,{object:t.noObjLatestRevisionAlreadyPresent})),t.noObjectsReplaced>0&&f.push(l.replace(l.revisionReport.msgSuccessfullyReplaced,{object:t.noObjectsReplaced})),t.noObjectsExplicitlyRemoved>0&&f.push(l.replace(l.revisionReport.msgObjectExplicitlyRemoved,{object:t.noObjectsExplicitlyRemoved}))})(s=s.concat(g)),new u({title:l.revisionReport.reportTitle+" - "+e.getLabel(),success:a,warning:c,information:f})})}})}),define("DS/FolderEditor/commands/ActionBar_PasteCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/service/FolderTypeService","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/commands/FolderCommands"],function(e,t,o,n,i,r,s){"use strict";return t.extend({labelTopBar:e.i18n("Copy"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){var e=void 0,t=o.get().getSelectedNodes();1===t.length&&i.inFamilyFolder(t[0].getType())&&(e=t[0]),s.PasteCmd(e)},endExecute:function(){}})}),define("DS/FolderEditor/FolderIdCardCont",["UWA/Core","DS/IPClassifyUXUtil/ActionBar/IPToolbar","UWA/Class/Options","DS/FolderEditor/views/FolderMode","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/service/FolderServices","DS/FolderEditor/ActionBar/FolderCommandManager","DS/FolderEditor/commands/FolderCommands","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/Folder_CSO","DS/FolderEditor/models/FolderInfo","DS/FolderEditor/utils/FolderSearch","DS/PADUtils/PADProbes","DS/FolderEditor/utils/FolderEditorUtil","DS/Tweakers/GeneratedToolbar","DS/PADServices/utils/GlobalModelEvents","DS/IPClassifyUXUtil/utils/CancellablePromise"],function(e,t,o,n,i,r,s,a,l,d,c,u,p,g,f,h,m,v,_,S){"use strict";return t.extend(o,{name:"enoFolderIdCard_Container",_currentPathNodes:null,_dropPartIDs:null,_counter:0,_probeLoadElmt:null,getCommandManager:function(){return l},createPathInfo:e=>new g({id:e.id,mxid:e.mxid,type:e.type,label:e.label}),getEntryForCommand:e=>{var t=null;return"IndexMode"===e&&(t=n.getToolbarEntry()),t},init:function(e){s.setIdCardCont(this),this._probeLoadElmt=h.createProbe("loadIdCard");var t=this,o=m.getLeftPanelStatus(),n=m.getRightPanelStatus();widget.addEvent("ontoolbarReady",()=>{var t=m.getDefaultView(),o=l.getCommand(t);o&&o.options.icon&&e.modelEvents.publish({event:"toolbar_update_command",data:{commandID:"display",data:{grid:{data:t}}}})}),e.leftOpened=o&&o.leftPanelState,e.rightOpened=n&&n.rightPanelState,e.modelEvents=_.getModelEvents(),e.searchInCurrentTab=!0,this._parent(e),this._buildSkeleton(),e.modelEvents.subscribe({event:"searchValueSet"},f.changeSearch.bind(f));let i=p.onBookmarkOpening(()=>{var e=h.createProbe("idcard_updateUI");t.setCurrentLocation(),e.end()});this.addSubscriptionToken(i),r.onFolderRename(this.setCurrentLocation.bind(this)),this.dispatchEvent.call(this,"onReady"),this._probeLoadElmt.end()},inject:function(){this._parent.apply(this,arguments),this.setCurrentLocation()},setCurrentLocation:async function(){let e=this._parent,t=null;if(i.isSection(p.getCurrentBookmarkId())){let e=await a.getCurrentBookmarkInfo();t=[{id:e.getID(),mxid:"",type:e.getType(),label:e.getLabel()}]}else t=await a.getCurrentBookmarkPath();t&&e.call(this,{objectPath:t})},isSearchAvailable:function(e){return new S(async t=>{let o=e||await a.getCurrentBookmarkInfo(),n=!1;if(o){var r=i.isSection(o.getType());n=!(!i.isAllBookmarksSection(o.getType())&&!i.isPersonalFolder(o.getType()))||!r&&o.getID()}t(n)})},render:function(){return this},_buildSkeleton:function(){this.topRightSideDiv=document.getElementsByClassName("FolderEditor_top_right_side_div"),r.subscribeEvents(),this.topRightSideDiv[0].addEventListener("dragover",this._onDragOver,!0),this.topRightSideDiv[0].addEventListener("drop",this._onDrop,!0),this.topRightSideDiv[0].addEventListener("dragenter",this._onDragEnter,!0),this.topRightSideDiv[0].addEventListener("dragleave",this._onDragLeave,!0),this.topRightSideDiv[0].addEventListener("contextmenu",this._rightClick)},_rightClick:function(e){var t=e?e.target:null;return(!t||"INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName)&&(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()),!1},_onDragOver:function(e,t,o,n){return e.preventDefault&&e.preventDefault(),!1},_onDragEnter:function(e,t,o,n){s.getIdCardCont();e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault();var i=e.target?e.target:e.detail.target;return s.getIdCardCont()._updateBorderDnD(i,!0),!0},_onDragLeave:function(e,t,o,n){return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),s.getIdCardCont()._updateBorderDnD(e.target,!1),!0},_onDrop:function(e,t,o,n){var i,r=!1,a=s.getIdCardCont();return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),s.getIdCardCont()._updateBorderDnD(e.target,!1),f.isSearchActive()||(i=a._getSerializedData(e))&&(r=a._performDropAction(i)),r},_updateBorderDnD:function(e,t){var o=this.elements.titleIdCard_container;e&&(t?(this._counter=this._counter+1,o.addClassName("dropallowed_elem")):(this._counter=this._counter-1,0===this._counter&&o.removeClassName("dropallowed_elem")))},_performDropAction:function(e){var t,o,n=null;return(n=1===(t=e.data.items.length)?(o=e.data.items[t-1]).path?this._expandDroppedPath(o):this._expandDroppedItem(o):{isDropped:!1,msg:t>1?c.msg_warning_MultipleSelection:c.msg_warning_dndnotsupported}).isDropped||u.displayNotification({message:n.msg,className:"error"}),n.isDropped},_expandDroppedItem:function(e){var t,o,n,i=!1,r=null;(t=e.objectId,n=e.displayName||"",o=this._getObjectDroppedType(e),t&&o)?(i=!0,t!==p.getCurrentBookmarkId()&&p.dispatchBookmarkPropsSelection({id:t,type:o,label:n})):(i=!1,r=c.msg_warning_notProductRoot);return{isDropped:i,msg:r}},_getObjectDroppedType:function(e){var t,o,n,r=null;if(t=e.objectType_Internal||e.objectType,Array.isArray(t)&&t.length>0){for(o=t.length,n=0;n<o;++n)if(i.inFamilyFolder(t[n])){r=t[n];break}}else i.inFamilyFolder(t)&&(r=t);return r},_expandDroppedPath:function(e){var t,o,n,i,r,a=!1,l=null,d=0,u=!1;let g=null;if(this._dropPartIDs=[],(t=e.path)&&t.length>0){if(n=t.length,r=this._getLastIndexOfFolder(t),i=p.getCurrentBookmarkId(),o=this._getObjectDroppedType(e),-1===r&&!i&&!o)return{isDropped:!1,msg:c.msg_warning_nocurrentfolder};if(r>=0?(g={id:t[r].resourceid,type:t[r].type,displayName:t[r].displayName||""},r+1<n&&(d="Vaulted Objects"===t[r+1].type?r+2:r+1,this._setProductsIDsPath(d,t)),u=i!==g.id):(u=i!==(g=o?{id:e.objectId,type:o,displayName:e.displayName||""}:{id:i}).id,this._setProductsIDsPath(d,t)),a=!0,u)this._expandNodeOfPath(g);else if(this._dropPartIDs.length>0){s.getContent().expandBranches(this._dropPartIDs)}}else a=!1,l=c.msg_warning_dndnotsupported;return{isDropped:a,msg:l}},_getLastIndexOfFolder:function(e){var t,o=-1,n=e.length;for(t=0;t<n;++t)i.inFamilyFolder(e[t].type)&&(o=t);return o},_setProductsIDsPath:function(e,t){var o,n=t.length;for(o=e=e>-1?e:0;o<n;++o)this._dropPartIDs.push(t[o].resourceid)},_getSerializedData:function(e){var t,o,n,i,r,s="";for(o=e.dataTransfer?e.dataTransfer:e.detail?e.detail:null,n=UWA.is(o.types.indexOf,"function")?"indexOf":"contains",i=["text/searchitems","text/plain","Text"],t=0;t<i.length&&""===s;t++){var a=o.types[n](i[t]);(UWA.is(a,"number")&&a>=0||UWA.is(a,"boolean")&&!0===a)&&(s=i[t])}return""!==s&&(r=o.getData(s)),r&&r.length?JSON.parse(r):null},_expandNodeOfPath:function(e){e&&p.dispatchBookmarkPropsSelection({id:e.id,type:e.type,label:e.displayName})}})}),define("DS/FolderEditor/commands/ActionBar_AddExternalLinkCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands"],function(e,t,o){"use strict";return t.extend({labelTopBar:e.i18n("Add External Link"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){o.addExternalLink(),this.end()},endExecute:function(){}})}),define("DS/FolderEditor/commands/ActionBar_ExpandAllCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/Folder_CSO","DS/FolderEditor/utils/FolderEditorcontrol","DS/PADUtils/PADContext"],function(e,t,o,n,i,r){"use strict";return t.extend({labelTopBar:e.i18n("Expand All"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){var e=n.getSelectedContent();let t=r._context.getSelectedNodes()[0];if(e.length>0&&t.getID()==e[0].getID()){var i=e[0];o.ExpandAllCmd(i,"CONTENT")}else t&&o.ExpandAllCmd(t,"TREE")},endExecute:function(){}})}),define("DS/FolderEditor/views/FolderTileView",["UWA/Controls/Abstract","UWA/Core","UWA/Class/Options","UWA/Class/Events","DS/FolderEditor/commands/FolderCommands","DS/ApplicationFrame/CommandsManager","DS/CollectionView/ResponsiveTilesCollectionView","DS/FolderEditor/utils/FolderEditorcontrol","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,t,o,n,i,r,s,a,l){"use strict";return e.extend(o,n,{name:"xBookResponsiveTileView",defaultOptions:{grid:null,model:null},init:function(e){this._parent(e),this.options=UWA.extend(this.options,e,!0),this.elements.container=UWA.createElement("div",{class:this.getClassNames()});var t=UWA.extend(e,{height:"inherit",displayedOptionalCellProperties:["contextualMenu","statusbarIcons","activeFlag"],useDragAndDrop:!0,allowUnsafeHTMLContent:!1,selectionBehavior:{canMultiSelect:this.options.multiselection}},!0);t.onDelayedModelDataRequest=this.options.context.updateAttributesDelayed.bind(this.options.context);var o=this.options.grid=new s(t);e.onContextualEvent&&(o.onContextualEvent=e.onContextualEvent),o.getContent().inject(this.elements.container),this.getOption("renderTo")&&!0===e.isActiveView&&this.elements.container.inject(this.getOption("renderTo")),o.onCellsCopy(function(e){r.getCommand("Copy").begin()}),o.onCellsPaste(function(e){r.getCommand("Paste").begin()}),o.onCellsCut(function(e){r.getCommand("Cut").begin()}),o.onDeleteKeyPressed(e=>{r.getCommand("Remove Content").begin()}),o.selectionBehavior=UWA.extend({enableFeedbackForActiveCell:!0},o.selectionBehavior),o.onPostCellRequest(function(e){e.nodeModel&&e.nodeModel.options.isBeingCut?e.cellView.getContent().addClassName("pad-state-is-being-cut"):e.cellView.getContent().removeClassName("pad-state-is-being-cut")}),o.onInfiniteScroll(function(e){a.getContent().processForInfiniteScroll(e,o)}),o.getCustomTooltip=function(e){var t=l.ViewTooltip["ds6w:label"]+": "+e.options.grid.label+"\n";return e.isFavorite&&(t+=l.ViewTooltip.favoriteTitle+": "+e.options.grid.favoriteTitle+"\n"),t+=l.ViewTooltip["ds6w:type"]+": "+e.options.grid["ds6w:type"]+"\n"+l.ViewTooltip["ds6wg:revision"]+": "+e.options.grid["ds6wg:revision"]+"\n"+l.ViewTooltip["ds6w:status"]+": "+e.options.grid["ds6w:status"]+"\n"+l.ViewTooltip["ds6w:responsible"]+": "+e.options.grid["ds6w:responsible"]+"\n"+l.ViewTooltip["ds6w:modified"]+": "+e.options.grid["ds6w:modified"]+"\n"+l.ViewTooltip["ds6w:project"]+": "+e.options.grid["ds6w:project"]+"\n"+l.ViewTooltip["ds6w:identifier"]+": "+e.options.grid["ds6w:identifier"]},UWA.is(this.options.grid.onCellDoubleClick,"function")&&this.options.grid.onCellDoubleClick(function(e){var t=e.nodeModel;i.activateFolderEditorItem(t)})},setModel:function(e){this.options.model=e,this.options.grid.loadGridViewModel(e),this.elements.container.inject(this.getOption("renderTo")),this.options.isActiveView=!0,this.options.grid.layout.invalidate(),null!==e.options.viewport.thumbnails&&void 0!==e.options.viewport.thumbnails&&this.options.grid.setScrollerPosition(e.options.viewport.thumbnails)},unsetModel:function(){this.getScrollerPosition&&(this.options.model.options.viewport.thumbnails=this.getScrollerPosition()),this.getOption("renderTo").removeChild(this.elements.container),this.options.isActiveView=!1,this.options.grid.unloadGridViewModel()},updateView:function(){this.options.grid.layout.invalidate({updateCellContent:!0})}})}),define("DS/FolderEditor/commands/ActionBar_FolderDownloadCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands"],function(e,t,o){"use strict";return t.extend({labelTopBar:e.i18n("Folder Download"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){o.FolderDownloadCmd(),this.end()},endExecute:function(){}})}),define("DS/FolderEditor/commands/ActionBar_ShareBookmarkLink",["UWA/Core","DS/ApplicationFrame/Command","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/commands/FolderCommands"],function(e,t,o,n){"use strict";return t.extend({labelTopBar:e.i18n("Share Bookmark Link"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){n._createLink()},endExecute:function(){}})}),define("DS/FolderEditor/commands/CtxCommands",["DS/ApplicationFrame/Command","DS/PADUtils/PADSettingsMgt","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/BookmarkLocationUtil","DS/PADUtils/PADContext"],function(e,t,o,n,i,r){"use strict";return e.extend({execute:function(){var e=r.get().ctxInfo;switch(this.options.ID){case"RenameCmd":!function(e){var t=e.options.cellInfos,n=e.options.isTree;o.RenameCmd(t,n)}(e);break;case"BookmarkLocation":!function(e){var t=e.nodes;t.length>0&&i.openBookmark(t[0])}(e);break;case"openInV5":!function(e){var o=e.nodes;require(["DS/FolderEditor/plugins/product/PrdUtils","DS/PADUtils/PADUtilsServices","DS/i3DXCompassServices/i3DXCompassPubSub"],function(e,n,i){if(1!==o.length||!o[0].isRoot()||UWA.is(o[0].options.config_filter)||UWA.is(o[0].options.sequence_filter))e.buildDataForSetTypes(o,function(e){var t=JSON.stringify(e),o={appId:"ENOUC5C_AP",widgetId:n.getWidgetId(),fileName:"-file",fileContent:t};i.publish("launchApp",o)},!0);else{var r={objectId:o[0].getID(),envId:n.getPlatformId(),serviceId:"3DSpace",contextId:t.getSetting("pad_security_ctx")};i.publish("setObject",r);var s={appId:"ENOUC5C_AP",widgetId:n.getWidgetId()};i.publish("launchApp",s)}})}(e);break;case"PreviewFile":o.previewFileCmd(e.nodes)}}})}),define("DS/FolderEditor/views/FolderThumbnailView",["UWA/Controls/Abstract","UWA/Core","UWA/Class/Options","UWA/Class/Events","DS/CollectionView/ResponsiveThumbnailsCollectionView","DS/ApplicationFrame/CommandsManager","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/utils/FolderEditorcontrol","i18n!DS/FolderEditor/assets/nls/FolderEditor"],function(e,t,o,n,i,r,s,a,l){"use strict";return e.extend(o,n,{name:"xBookResponsiveThumbnailView",defaultOptions:{grid:null,model:null},init:function(e){this._parent(e),this.options=UWA.extend(this.options,e,!0),this.elements.container=UWA.createElement("div",{class:this.getClassNames()});var t=UWA.extend(e,{height:"inherit",displayedOptionalCellProperties:["contextualMenu","statusbarIcons","activeFlag"],useDragAndDrop:!0,allowUnsafeHTMLContent:!1,selectionBehavior:{canMultiSelect:this.options.multiselection}},!0);t.onDelayedModelDataRequest=this.options.context.updateAttributesDelayed.bind(this.options.context);var o=this.options.grid=new i(t);e.onContextualEvent&&(o.onContextualEvent=e.onContextualEvent),this._originalApplyAttributes=o._applyAttributesOnCell.bind(o),o._applyAttributesOnCell=this._applyAttributesOnCell.bind(this),o.getContent().inject(this.elements.container),this.getOption("renderTo")&&!0===e.isActiveView&&this.elements.container.inject(this.getOption("renderTo")),o.onCellsCopy(function(e){r.getCommand("Copy").begin()}),o.onCellsPaste(function(e){r.getCommand("Paste").begin()}),o.onCellsCut(function(e){r.getCommand("Cut").begin()}),o.onDeleteKeyPressed(e=>{r.getCommand("Remove Content").begin()}),o.selectionBehavior=UWA.extend({enableFeedbackForActiveCell:!0},o.selectionBehavior),o.onPostCellRequest(function(e){e.nodeModel&&e.nodeModel.options.isBeingCut?e.cellView.getContent().addClassName("pad-state-is-being-cut"):e.cellView.getContent().removeClassName("pad-state-is-being-cut")}),o.onInfiniteScroll(function(e){a.getContent().processForInfiniteScroll(e,o)}),o.getCustomTooltip=function(e){var t=l.ViewTooltip["ds6w:label"]+": "+e.options.grid.label+"\n";return e.isFavorite&&(t+=l.ViewTooltip.favoriteTitle+": "+e.options.grid.favoriteTitle+"\n"),t+=l.ViewTooltip["ds6w:type"]+": "+e.options.grid["ds6w:type"]+"\n"+l.ViewTooltip["ds6wg:revision"]+": "+e.options.grid["ds6wg:revision"]+"\n"+l.ViewTooltip["ds6w:status"]+": "+e.options.grid["ds6w:status"]+"\n"+l.ViewTooltip["ds6w:responsible"]+": "+e.options.grid["ds6w:responsible"]+"\n"+l.ViewTooltip["ds6w:modified"]+": "+e.options.grid["ds6w:modified"]+"\n"+l.ViewTooltip["ds6w:project"]+": "+e.options.grid["ds6w:project"]+"\n"+l.ViewTooltip["ds6w:identifier"]+": "+e.options.grid["ds6w:identifier"]},UWA.is(this.options.grid.onCellDoubleClick,"function")&&this.options.grid.onCellDoubleClick(function(e){var t=e.nodeModel;s.activateFolderEditorItem(t)})},setModel:function(e){this.options.model=e,this.options.grid.loadGridViewModel(e),this.elements.container.inject(this.getOption("renderTo")),this.options.isActiveView=!0,this.options.grid.layout.invalidate(),null!==e.options.viewport.thumbnails&&void 0!==e.options.viewport.thumbnails&&this.options.grid.setScrollerPosition(e.options.viewport.thumbnails)},unsetModel:function(){this.getScrollerPosition&&(this.options.model.options.viewport.thumbnails=this.getScrollerPosition()),this.getOption("renderTo").removeChild(this.elements.container),this.options.isActiveView=!1,this.options.grid.unloadGridViewModel()},updateView:function(){this.options.grid.layout.invalidate({updateCellContent:!0})},_applyAttributesOnCell:function(e){var t=e;void 0===e.nodeModel&&(t.nodeModel=this.options.grid._getModelAt(e.cellID),t.cellView=this.options.grid._getViewAt(e.cellID)),t.nodeModel.options.isBeingCut?t.cellView.getContent().addClassName("pad-state-is-being-cut"):t.cellView.getContent().removeClassName("pad-state-is-being-cut"),this._originalApplyAttributes(e)}})}),define("DS/FolderEditor/commands/ActionBar_DownloadFileCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands"],function(e,t,o){"use strict";return t.extend({labelTopBar:e.i18n("Download "),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){o.DownloadFileCmd()},endExecute:function(){}})}),define("DS/FolderEditor/commands/ActionBar_OpenExternalLinkCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands"],function(e,t,o){"use strict";return t.extend({labelTopBar:e.i18n("Open Link"),isInsert:!0,init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){o.openExternalLink(),this.end()},endExecute:function(){}})}),define("DS/FolderEditor/commands/ActionBar_RemoveShortCutCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands"],function(e,t,o){"use strict";return t.extend({labelTopBar:e.i18n("Remove Shortcut"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){o.RemoveShortcutCmd(),this.end()},endExecute:function(){}})}),define("DS/FolderEditor/commands/ActionBar_FolderUploadCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands"],function(e,t,o){"use strict";return t.extend({labelTopBar:e.i18n("Folder Upload"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){o.FolderUploadCmd(),this.end()},endExecute:function(){}})}),define("DS/FolderEditor/commands/ActionBar_CollapseAllCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/Folder_CSO","DS/PADUtils/PADContext"],function(e,t,o,n,i){"use strict";return t.extend({labelTopBar:e.i18n("Collase All"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){var e=n.getSelectedContent();let t=i._context.getSelectedNodes()[0];if(e.length>0&&t.getID()==e[0].getID()){var r=e[0];o.CollapseAllCmd(r,"CONTENT")}else t&&o.CollapseAllCmd(t,"TREE")},endExecute:function(){}})}),define("DS/FolderEditor/commands/ActionBar_ImportCSVBookmarkCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/views/FolderMode"],function(e,t,o,n){"use strict";return t.extend({labelTopBar:e.i18n("Import CVS Bookmark Structure"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1}),require(["DS/FolderEditor/commands/tools/ImportCSVBookmarkPanel"],function(e){})},beginExecute:function(){},execute:function(){require(["DS/FolderEditor/commands/tools/ImportCSVBookmarkPanel","DS/FolderEditor/views/FolderMode"],function(e,t){t.switchtoAuthoringMode(),new e})},endExecute:function(){}})}),define("DS/FolderEditor/commands/ActionBar_CopyCmd",["UWA/Core","DS/ApplicationFrame/Command","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/commands/FolderCommands"],function(e,t,o,n){"use strict";return t.extend({labelTopBar:e.i18n("Copy"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){n.CopyCmd()},endExecute:function(){}})}),define("DS/FolderEditor/commands/ActionBar_UPSAuthReplaceByRevision",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands","DS/ENOXVersionExplorerController/VersionExplorerController","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerViews/VersionExplorerModal","DS/FolderEditor/utils/FolderEditorUtil","DS/PADUtils/PADSettingsMgt","DS/FolderEditor/Folder_CSO","DS/FolderEditor/service/FolderServices","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/views/FolderMode"],function(e,t,o,n,i,r,s,a,l,d,c,u,p,g,f){"use strict";return t.extend({labelTopBar:e.i18n("Replace By Revision"),isInsert:!0,_selectedNodes:null,init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},execute:function(){var e=null;if(1==(e=null===this._selectedNodes?d.getSelectedNodes():this._selectedNodes).length){var t=this.validPhysicalIDtobeReplaced=e[0].getID();this._launchVersionExplorer(t),this.end()}},endExecute:function(){this._selectedNodes=null},_launchVersionExplorer:function(t){var o=this,d=e.createElement("div",{class:"revisionUpdate-dialog-versionexplorer"}).inject(document.body);this._myVersionExplorer=new n({versionGraphContainer:null,selectionMode:r.SELECTION_MODES.SINGLE_SELECT_ONLY,widget:widget}),this._myVersionExplorer.disableDrag(),this._myVersionExplorer.showDialog({x:100,y:100},d,!0),i.loadUserSettingsPromise({displayMode:r.DISPLAY_MODES.SUBWAY_VIEW,displayLegend:!0},!0),this._myVersionExplorer.publishEvent("ENOXVersionExplorerLoadVersionModel",{id:o.validPhysicalIDtobeReplaced,tenantId:a.getTenant()?a.getTenant().value:"",securityContext:l.getSetting("pad_security_ctx"),onComplete:function(){},dataModelType:r.DATA_MODEL_TYPES.MODEL_HISTORY}),this._myVersionExplorer.subscribeEvent("ENOXVersionExplorerModalOK",this._onVersionExplorerModalOK.bind(this,t),!1),this._myVersionExplorer.subscribeEvent("ENOXVersionExplorerModalCancel",this._onVersionExplorerModalCancel.bind(this,t),!1),this._dlgVersionExplorer=s._dlg,s._dlg&&s._dlg.rightButtons&&s._dlg.rightButtons.addEventListener("click",this._onVersionExplorerModalCancel.bind(this,t)),this._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!0,this._dlgVersionExplorer.setTitle(p.dialog_replaceByLatestRevision),this._myVersionExplorer.subscribeEvent("select",function(e){o._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!1}),this._myVersionExplorer.subscribeEvent("unselect",function(e){o._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!0})},_onVersionExplorerModalCancel:function(e){this._myVersionExplorer.unsubscribeAll()},_onVersionExplorerModalOK:function(t){var o=this;this._myVersionExplorer.unsubscribeAll();var n=this._myVersionExplorer.getSelectedNodes().shift().getAttributeValue("id");if(n!==o.validPhysicalIDtobeReplaced){var i=[],r=[];i.push(o.validPhysicalIDtobeReplaced),r.push(n),c.replaceContent({IDsRemoved:i,IDsAdded:r,callbacks:{onComplete:function(e){var t=JSON.parse(e);if("success"===t.status){o._updateTheNodes(t);var n=t.noObjectsExplicitlyRemoved;n>0?u.displayNotification({message:p.replace(p.msg_info_replaceByLatestRevision_removed,{number:n}),className:"primary"}):u.displayNotification({message:p.msg_info_replaceByRevision,className:"success"})}},onFailure:function(t){!function(t,o,n){var i=o;!e.is(n)||n instanceof Error||(i+="<br>"+n),u.displayNotification({message:i,className:"error"})}(0,p.msg_error_ReplaceBylatestRevision,t)}}})}else u.displayNotification({...p.msg_warning_replaceByRevision_sameObject,className:"warning"})},_updateTheNodes:function(t){var o=require("DS/PADServices/utils/AttributesMgtV2"),n=require("DS/FolderEditor/utils/FolderEditorUtil"),i=require("UWA/Promise");f.switchtoAuthoringMode();var r=g.getContent().getPADTreeDocument();"replacablecontent"in t&&r.wrapInTransaction(function(){r.withTransactionUpdate(function(){Object.keys(t.replacablecontent).forEach(function(r){g.getContent().getPADTreeDocument().getNodesById(r).forEach(function(s){if(s.getDepth()<1){s.collapse(),s.childComputed=!1,s.removeChildren();var a=t.replacablecontent[r],l=n.convertToExaleadDataFormat(a),d=n.convertToArray(l);s.updateAttributes(d,o.getAvailableColumns()),s.setAttribute("id",a.id),s.id=a.id,s.options.label=a.label,s.options.resourceid=a.id,s.options.type=a.type,new i(function(t){require(["DS/FolderEditor/service/FolderServices"],function(o){var n={lastVersionRequests:[{id:a.id}]};o.getlastversion({objectsToTreat:n,callbacks:{onComplete:function(e){var o=JSON.parse(e).lastVersionRequests[0].islast;void 0!==o&&t(o)},onFailure:function(t){e.log("Replace content Service has failed")}}})})}).then(function(e){var t={grid:{isLastRevision:e}};s.updateOptions(t),s.select()})}})})})}),"nodesToBeRemoved"in t&&t.nodesToBeRemoved.length>0&&r.wrapInTransaction(function(){r.withTransactionUpdate(function(){t.nodesToBeRemoved.forEach(function(e){g.getContent().getPADTreeDocument().getNodesById(e).forEach(function(e){e.getDepth()<1&&(e.collapse(),r.removeRoot(e,!0,!1))})})})})},_getVersionExploreforODT:function(){return this._myVersionExplorer?this._myVersionExplorer:null},setNode:function(e){this._selectedNodes=[e]}})}),define("DS/FolderEditor/commands/ActionBar_FindinCtxCmd",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/FolderEditor/commands/FolderCommands","DS/IPClassifyFindInContext/FindInContent","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/service/FolderServices","DS/FolderEditor/Folder_CSO","i18n!DS/FolderEditor/assets/nls/FolderFindInCtx","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/dataProvider/FolderFindInDataProvider","DS/ApplicationFrame/CommandsManager"],function(e,t,o,n,i,r,s,a,l,d,c,u){"use strict";return t.extend({labelTopBar:e.i18n("FindinCtx"),isInsert:!0,datas:{},launchType:"ActionBar",findInCtx:null,init:function(t){var o=this;this._parent(t,{mode:"exclusive",isAsynchronous:!1}),this.onStateChange(async function(){if(i.getContent()){var n=!!i.getFindInCtx()&&i.getFindInCtx().visibleFlag;if(n&&!this.getState()&&i.getFindInCtx().close(),!n&&this.getState()){var r=o._getInformationforNodes(),s=r.nodes,l=r.isContentPresentInBookmark,d=r.findInBookmark,u=null;if(s.length>0||l){var p=await o.getTitle(s,d);if(u={target:i.getContent().getPADTreeListView().getManager().getContent(),placeholder:a.placeholder_findInCtx,nodesForFindInCtx:s,title:p,findInBookmark:d,dataProvider:c,multiselection:i.getContent().options.multiselection},"ActionBar"!==o.launchType&&(t.position=o.position),null==o.findInCtx){var g=require("DS/IPClassifyFindInContext/FindInContent");o.findInCtx=new g,i.setFindInCtx(o.findInCtx)}o.findInCtx.buidUI(u)}o.launchType="ActionBar"}n&&this.getState()&&e.log("Panel is already launched")}})},_getInformationforNodes:function(){var e=i.getContent().getSelectedNodes();if(0==e.length){var t=i.getContent().getPADTreeDocument().getRoots();return{nodes:this._getNodes(t,20),findInBookmark:!0,isContentPresentInBookmark:t.length>0}}return{nodes:this._getNodes(e,20),findInBookmark:!1,isContentPresentInBookmark:!0}},_getNodes:function(e,t){var o=[];if(e.length>0){if(widget.getPreference("allow-products-expand").value){for(var n=0;n<e.length;n++){if(!(o.length<t)){l.displayNotification({title:a.title_warning_FindInCtx_objectsLimit,message:a.replace(a.get("msg_warning_FindInCtx_objectsLimit"),{limit:t}),className:"info"});break}"VPMReference"==e[n].options.type&&o.push(e[n])}return o.length>0?o:[]}return[]}return l.displayNotification({title:a.title_warning_FindInCtx_novalidobject,message:a.msg_warning_FindInCtx_novalidobject,className:"warning"}),this.setState(!1,!1),[]},setLaunchType:function(e){this.launchType=e.type,this.position=e.position},getTitle:async function(e,t){let o=await r.getCurrentBookmarkInfo();return t?o.getLabel():1==e.length?e[0].options.label:e.length+" "+a.findInCtxSearchView.objects}})}),define("DS/FolderEditor/commands/ActionBar_CutCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/FolderEditor/commands/FolderCommands"],function(e,t,o){"use strict";return t.extend({labelTopBar:e.i18n("Copy"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){o.CutCmd()},endExecute:function(){}})}),define("DS/FolderEditor/views/FolderGlobalActiveBookmark",["UWA/Core","UWA/Class","DS/IPClassifyUXUtil/service/IPClassifyUXUtilWebService","DS/FolderEditor/service/FolderServices","DS/FolderEditor/utils/FolderEditorcontrol","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/Controls/TooltipModel","DS/FolderEditor/models/xBookNodeModel","DS/Menu/ContextualMenu","DS/FolderEditor/commands/FolderCommands","DS/WebappsUtils/WebappsUtils","DS/IPClassifyUtil/IPClassifyAlert","DS/Logger/Logger","DS/FolderEditor/utils/FolderCommunication","DS/PlatformAPI/PlatformAPI","DS/FolderEditorOpenness/FolderEditorOpenness","DS/FolderEditor/utils/FolderLoaderGlobal","DS/WAFData/WAFData","DS/PADUtils/PADUtilsServices","DS/FolderEditor/service/FolderEditorWebService","DS/WidgetServices/WidgetServices","DS/FolderEditor/Folder_CSO","DS/PADServices/utils/GlobalModelEvents","DS/FolderEditor/ActionBar/FolderCommandManager"],function(e,t,o,n,i,r,s,a,l,d,c,u,p,g,f,h,m,v,_,S,C,b,F,y){"use strict";var D={iconName:"pin",fontIconSize:"1x"},E={iconName:"pin-off",fontIconSize:"1x"},w=t.singleton({name:"ActiveFolder",ICON_ACTIVE:D,ICON_ACTIVE_DISABLED:E,ACTIVE_FOLDER_PREFERENCE:"ActiveFolder_FolderID",DEFAULT_VALUE:"!",_logger:null,_isInitialized:!1,_container:null,_cellElement:null,_nameElement:null,_activeFolder:{id:null,label:"",node:null,sc:""},_disabledActiveFolder:{id:null,label:"",node:null,sc:""},_tooltipDisplayButton:null,_tooltipTextSwitch:"",_labelSwitch:null,init:function(e){var t=this;return t._logger=p.getLogger(w),t._logger.log("init"),t._parent(e),t.activeFolderCallBack(),this.retrieveActiveFolderFromPreference().then(function(e){t._buildSkeleton(),t._isInitialized=!0}).catch(function(e){console.log("Error: "+e)}),F.subscribe({event:"activeBkFailure"},e=>{let t=this.getActiveBookmark();t&&t.id===e.id&&this._unsetAfterError()}),t},initialize:function(){},_buildSkeleton:function(){var t=this,o=i.getTreeCont().getCommonToolSection().getElement("#buttonSection");this._container=new e.createElement("div",{id:"active_folder_container"}).inject(o),this._cellElement=e.createElement("div",{id:"active_folder_cell",class:"wux-tweakers"}).inject(this._container,"top"),this._activeBookmarkIcon=e.createElement("div",{id:"active_folder_icon",class:"wux-ui-3ds wux-ui-3ds-bookmark-pin"}).inject(t._cellElement,"bottom"),this._nameElement=e.createElement("div",{id:"active_folder_label",class:"wux-tweakers wux-tweakers-string wux-tweakers-string-label",events:{click:function(){t.centerTreeToActiveFolder(null!==t._disabledActiveFolder.id?t._disabledActiveFolder.id:t._activeFolder.id)}}}).inject(t._cellElement,"bottom"),this._nameElement.tooltipInfos=this._tooltipDisplayButton=new s({shortHelp:r.tooltip_noDefaultLocation,initialDelay:0,mouseRelativePosition:!1}),this._dropDownMenu=e.createElement("div",{id:"active_folder_down_button",class:"fonticon fonticon-down-open",events:{click:function(){var e=new Event("contextmenu");e.pageX=(this.getBoundingClientRect().left+this.getBoundingClientRect().right)/2,e.pageY=(this.getBoundingClientRect().top+this.getBoundingClientRect().bottom)/2,this.dispatchEvent(e)}}}).inject(t._cellElement,"bottom");var n=null!==this._disabledActiveFolder.id?this._disabledActiveFolder.label:this._activeFolder.label;this._updateUI(n),this._buildContextualMenu()},_getNodeModel:function(){var e=null!==this._disabledActiveFolder.id?this._disabledActiveFolder:this._activeFolder,t=new a({resourceid:e.id,label:e.label,type:"Workspace Vault"});return t.isPersonal=e.isPersonal,t.getType=(()=>"Workspace Vault"),t},_buildContextualMenu:function(){var e=this;l.addEventListener(this._dropDownMenu,{callback:()=>{var t=[],o={type:"PushItem",title:r.CMDUnsetGlobalActiveFolder,icon:"bookmark-pin",action:{callback:async()=>{m.addComponentsToLoad("global",{unsetActiveFolder:r.UnsetActiveBookmark_Loading});let t=e._activeFolder.id;var o=await n.getCurrentBookmarkInfo();t===o.getID()?y.launchCommand("ActiveFolder",o,null,"ContextualMenu"):this.activeFolderCommand(this._getNodeModel())}}},i={type:"PushItem",title:r.CMDShowInBookmarks,icon:"bookmark",action:{callback:function(){var t=null!==e._disabledActiveFolder.id?e._disabledActiveFolder.id:e._activeFolder.id;e.centerTreeToActiveFolder(t)}}},s={type:"PushItem",title:r.CMDAccessRightCmd,icon:"forward",action:{callback:function(){var t=e._getNodeModel();d.AccessRightCmd(t)}}},a={type:"PushItem",title:r.CMDShareBookmarkLink,icon:"link",action:{callback:function(){var t=e._getNodeModel();d._createLink(t)}}},l=null!==e._disabledActiveFolder.id?"play":"pause",c={type:"PushItem",title:e._labelSwitch,fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-"+l},tooltip:e._tooltipTextSwitch,action:{callback:function(){e.switchActiveFolderState()}}};let u=y.areCommandsAvailable(this._getNodeModel(),null,["ActionBar_AccessRightCmd"]);return t.push(o),t.push(i),u.ActionBar_AccessRightCmd&&t.push(s),t.push(a),C.isReplayedODT()&&t.push(c),t}})},_updateUI:function(e){null!=this._container&&(this._nameElement.setHTML("<p id='active_folder_label_text'>"+e+"</p>"),this._tooltipDisplayButton.shortHelp=r.replace(r.tooltip_defaultLocation,{folderLabel:e}),null==this._disabledActiveFolder.id?(this._tooltipTextSwitch=r.replace(r.tooltip_disableDefaultLocation,{folderLabel:e}),this._labelSwitch=r.CMDDisableGlobalActiveBookmark,this._nameElement.setStyle("color","#368ec4"),this._activeBookmarkIcon.setStyle("color","#368ec4"),this._updateTreeIcons(this._activeFolder.id,D)):(this._tooltipTextSwitch=r.replace(r.tooltip_enableDefaultLocation,{folderLabel:e}),this._labelSwitch=r.CMDEnableGlobalActiveBookmark,this._nameElement.setStyle("color","#b4b6ba"),this._activeBookmarkIcon.setStyle("color","#b4b6ba"),this._updateTreeIcons(this._activeFolder.id,null),this._updateTreeIcons(this._disabledActiveFolder.id,E)))},_updateTreeIcons:function(e,t){var o=i.getTreeCont()._getVisibleNodeById(e,null);null!==o&&o.setBadges({topRight:t});var n=i.getContent();n&&n.updateActiveBookmarkNode(null,null===t)},centerTreeToActiveFolder:function(e){b.dispatchBookmarkIdSelection(e,{force:!0,events:{treeFailure:"activeBkFailure",treeGiveUp:"activeBkFailure"}})},switchActiveFolderState:function(){var e=this;null!==this._disabledActiveFolder.id?(m.addComponentsToLoad("global",{enableActiveFolder:r.EnableActiveBookmark_Loading}),this._checkFolderStatus(this._disabledActiveFolder.id).then(function(){return e.setActiveFolder(e._disabledActiveFolder)}).then(function(){m.removeComponentToLoad("global","enableActiveFolder"),u.displayNotification({message:r.replace(r.msg_info_enable_successfully,{folderLabel:e._activeFolder.label}),className:"success"})}).catch(function(t){e._unsetAfterError(),m.removeComponentToLoad("global","enableActiveFolder")})):(m.addComponentsToLoad("global",{disableActiveFolder:r.DisableActiveBookmark_Loading}),this._disabledActiveFolder=this._activeFolder,this._checkFolderStatus(this._activeFolder.id).then(function(){return e.unsetActiveFolder()}).then(function(){return e.services.setUserPreferences(e.ACTIVE_FOLDER_PREFERENCE,e.DEFAULT_VALUE+e._disabledActiveFolder.id)}).then(function(){m.removeComponentToLoad("global","disableActiveFolder"),u.displayNotification({message:r.replace(r.msg_info_disable_successfully,{folderLabel:e._disabledActiveFolder.label}),className:"success"})},function(t){e._unsetAfterError(),m.removeComponentToLoad("global","disableActiveFolder")}))},activeFolderCommand:function(e){var t=this,o=t._activeFolder,n=t._disabledActiveFolder,i={id:e.getID(),label:e.getLabel(),isPersonal:e.isPersonal,node:e},s=o.id!==i.id,a=!(n.id===i.id)&&s;a?m.addComponentsToLoad("global",{setActiveFolder:r.SetActiveBookmark_Loading}):m.addComponentsToLoad("global",{unsetActiveFolder:r.UnsetActiveBookmark_Loading}),this.unsetActiveFolder().then(function(){if(!a)return m.removeComponentToLoad("global","unsetActiveFolder"),u.displayNotification({message:r.replace(r.msg_info_inactive_successfully,{folderLabel:i.label}),className:"success"}),!1;t.setActiveFolder(i).then(function(e){m.removeComponentToLoad("global","setActiveFolder"),u.displayNotification({message:r.replace(r.msg_info_active_successfully,{folderLabel:t._activeFolder.label}),className:"success"})}).catch(function(e){console.log("Error: "+e)})}).catch(function(e){console.log("Error: "+e)})},setActiveFolder:function(e){var t=this;return t.services.setUserPreferences(t.ACTIVE_FOLDER_PREFERENCE,e.id).then(function(o){return t._activeFolder=e,null!=t._disabledActiveFolder.id&&(t._updateTreeIcons(t._disabledActiveFolder.id,null),t._disabledActiveFolder={id:null,label:"",node:null,sc:""}),i.setActiveFolder(t._activeFolder.id,t._activeFolder.label,t._activeFolder.sc,null),t._updateUI(t._activeFolder.label),null!=t._container&&t._container.show(),t._setCustomSecurityContext(),f.publish("FolderEditor.ActiveFolder",{id:t._activeFolder.id!==t.DEFAULT_VALUE?t._activeFolder.id:null,label:t._activeFolder.label,sc:t._activeFolder.sc}),o}).catch(function(e){console.log("Error: "+e)})},getActiveBookmark:function(){var e=this._activeFolder.id!=this.DEFAULT_VALUE&&null!=this._activeFolder.id,t=null!=this._disabledActiveFolder.id;return e?this._activeFolder:t?this._disabledActiveFolder:null},unsetActiveFolder:function(){var e=this;return e.services.setUserPreferences(e.ACTIVE_FOLDER_PREFERENCE,e.DEFAULT_VALUE).then(function(t){let o=e._activeFolder.id!=e.DEFAULT_VALUE&&null!=e._activeFolder.id,n=e.getActiveBookmark();return null!=n&&e._updateTreeIcons(n.id,null),e._activeFolder={id:e.DEFAULT_VALUE,label:"",node:null,sc:""},o||(e._disabledActiveFolder={id:null,label:"",node:null,sc:""}),i.setActiveFolder(e.DEFAULT_VALUE,"","",e._disabledActiveFolder.id),o&&e._updateUI(e._disabledActiveFolder.label),null==e._disabledActiveFolder.id&&null!=e._container&&e._container.hide(),f.publish("FolderEditor.ActiveFolder",{id:null,label:"",sc:""}),t}).catch(function(e){console.log("Error: "+e)})},_unsetAfterError:function(e){this._disabledActiveFolder={id:null,label:"",node:null,sc:""},this.unsetActiveFolder().then(function(){0!=e&&u.displayNotification({...r.msg_error_rest_GetActiveFolder,className:"warning"})}).catch(function(e){console.log("Error: "+e)})},retrieveActiveFolderFromPreference:function(){var e=this;return e._getUserPreference().then(function(t){return t===e.DEFAULT_VALUE&&t.length===e.DEFAULT_VALUE.length?Promise.reject():(t.indexOf(e.DEFAULT_VALUE)>=0&&(t=t.slice(1,t.length),e._disabledActiveFolder={id:t,label:"",node:null,sc:""}),e._checkFolderStatus(t))}).then(function(t){return null!==e._disabledActiveFolder.id?(e._disabledActiveFolder.label=t.label,e._disabledActiveFolder.isPersonal=t.isPersonal,i.setActiveFolder(e.DEFAULT_VALUE,e._disabledActiveFolder.label,"",e._disabledActiveFolder.id),Promise.resolve(t)):(e._activeFolder=t,e._setCustomSecurityContext(),i.setActiveFolder(e._activeFolder.id,e._activeFolder.label,e._activeFolder.sc,e._disabledActiveFolder.id),g.publish("FolderEditor.ActiveFolder",Object.assign({},t,{node:""})),Promise.resolve(t))}).catch(function(t){e._unsetAfterError(!1)})},_getUserPreference:function(){return this.services.getUserPreferences(this.ACTIVE_FOLDER_PREFERENCE).then(function(e){return e.value}).catch(e=>(u.displayNotification({...e,className:"error"}),this.DEFAULT_VALUE))},_checkFolderStatus:function(e){var t=this;return new Promise(function(o,n){null!==e&&""!==e&&e!==t.DEFAULT_VALUE?t.services.getProperties({folderid:e,onComplete:function(e){void 0===e.id?n():o({isPersonal:"Personal"===e.folderClassification,id:e.id,label:e.label})},onFailure:function(e){n()}}):n()})},_setCustomSecurityContext:function(){if(h.useComputedSecurityContext()){var e=[],t=widget.getPreference("pad_security_ctx");if(t){var o=t.options;Array.isArray(o)?o.forEach(function(t){t.value&&e.push(t.value)}):this._logger.warn("The widget has no options for pad_security_ctx preference")}else this._logger.warn("The widget has no pad_security_ctx preference");var n="";if(e.length>0)try{n=h.computeSecurityContext(this._activeFolder.id,e)}catch(e){this._logger.warn("FolderEditorOpenness throws exception",e)}this._activeFolder.sc=n}else this._activeFolder.sc=""},activeFolderCallBack:function(e){var t=this;f.subscribe("FolderEditor.ActiveFolderCallBack",function(e){null!==e?u.displayNotification({message:r.replace(r.msg_info_defaultLocation,{folderLabel:e.label}),className:"info"}):f.publish("FolderEditor.ActiveFolder",{id:t._activeFolder.id!==t.DEFAULT_VALUE?t._activeFolder.id:null,label:t._activeFolder.label,sc:t._activeFolder.sc})}),f.subscribe("FolderEditor.ActiveFolderCheck",function(e){var o=t._activeFolder.id===t.DEFAULT_VALUE;t._checkFolderStatus(t._activeFolder.id).then(function(){},function(){null!==t._disabledActiveFolder.id?t._checkFolderStatus(t._disabledActiveFolder.id).then(function(){},function(){t._unsetAfterError()}):o||t._unsetAfterError()})})},services:{getUserPreferences:function(e){return new Promise(function(t,n){o.getUserPreferences({name:e}).then(o=>{t({keyname:e,value:o,message:null})}).catch(()=>{n({keyname:e,value:null,...r.msg_error_rest})})})},setUserPreferences:function(e,t){return new Promise(function(n,i){o.saveUserPreferences({name:e,value:t}).then(()=>{n({keyname:e,value:t,message:null})}).catch(()=>{i()})})},getProperties:function(e){var t=_.get3DSpaceUrl()+"/resources/v1/FolderManagement/Folder/"+e.folderid+"/properties",o={method:"GET",type:"json",headers:{"Content-Type":"application/json",SecurityContext:widget.getPreference("pad_security_ctx").value},proxy:"passport",timeout:12e4};o.onComplete=e.onComplete,o.onFailure=e.onFailure,v.authenticatedRequest(t,o)}}});return w}),define("DS/FolderEditor/commands/ActionBar_ActiveFolderCmd",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/FolderEditor/Folder_CSO","DS/Utilities/Utils","DS/FolderEditor/utils/FolderEditorcontrol","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/views/FolderGlobalActiveBookmark","DS/FolderEditor/service/FolderServices"],function(e,t,o,n,i,r,s,a){"use strict";return t.extend({labelTopBar:"test",isInsert:!0,datas:{},_hasCommandBeenClicked:!0,init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1}),s.initialize();let t=n.debounce(this._onChangeCurrentFolder.bind(this),100);o.onChange(t),this.onStateChange(async function(){if(this._hasCommandBeenClicked){var e=await a.getCurrentBookmarkInfo();s.activeFolderCommand(e)}this._hasCommandBeenClicked=!0})},_onChangeCurrentFolder:function(){this._hasCommandBeenClicked=!1;var t=o.getCurrentBookmarkId();if(e.is(i.getTreeCont())){var n=i.getTreeCont().isFolderActiveDefined(t);this.setState(n,!1)}}})}),define("DS/FolderEditor/service/FolderDnDServices",["DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUXUtil/IPClassifyConfirmation","DS/IPClassifyUXUtil/utils/CancellablePromise","DS/FolderEditor/Folder_CSO","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/service/FolderServices","DS/FolderEditor/service/FolderTypeService","DS/UIKIT/Mask","DS/FolderEditor/utils/FolderEditorcontrol","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderSearch","DS/WidgetServices/WidgetServices","DS/FolderUpload/FolderUpload","DS/ApplicationFrame/CommandsManager","DS/PlatformAPI/PlatformAPI","DS/IPClassifyUtil/IPClassifyUtility","DS/FolderEditor/utils/WidgetHandlerUtil","DS/FolderEditor/service/BkOperationsUtils","DS/TreeModel/TreeNodeModel","DS/PADServices/utils/GlobalModelEvents"],function(e,t,o,n,i,r,s,a,l,d,c,u,p,g,f,h,m,v,_,S,C,b,F){"use strict";var y=!1,D="";return{setStartDrag:function(e){y=!0===e},isDragging:function(){return y},setDragFrom:function(e){D=e},getDragFrom:function(e){return D},shouldAcceptDrag:()=>!p.isRelationsColumnsActive()||!function(){let e=!1;var t=n.getSelectedContent();if(t&&t.length>0)for(let o=0;o<t.length;++o)if(!0===t[o].isRelationsObjectGroupingNode){e=!0;break}return e}(),isLinkedBookmark:e=>!!e.some(e=>"TRUE"===e._options.grid.isLinkedFolder),retrieveDroppedDataFromDropEvent:function(e){for(var t,o,n=UWA.is(e.dataTransfer.types.indexOf,"function")?"indexOf":"contains",i="",r=["text/searchitems","text/plain","Text"],s=0;s<r.length&&""===i;s++){var a=e.dataTransfer.types[n](r[s]);(UWA.is(a,"number")&&a>=0||UWA.is(a,"boolean")&&!0===a)&&(i=r[s])}if(""===i)throw new Error("Unknown type in DnD");if(o=e.dataTransfer.getData(i),!(t=JSON.parse(o)).data||!t.data.items)throw new Error("Wrong DnD protocol used");return t},hasFilesInEvent:function(e){var t=e.dataTransfer?e.dataTransfer:e.detail?e.detail:null;if(t){if(t.items||!t.types||!t.types[0]||"application/x-moz-file"!==t.types[0]&&"Files"!==t.types[0]){var o=e.dataTransfer.types[UWA.is(e.dataTransfer.types.indexOf,"function")?"indexOf":"contains"]("Files");return!!(UWA.is(o,"number")&&o>=0||UWA.is(o,"boolean")&&!0===o)}return!0}return!1},isExternalDroppedDataOnFolderEditor:function(e){var t=!0;return e&&e.widget_id&&e.widget_id==this.getWidgetId()&&(t=!1),t},isExternalDroppedDataFromSameSource:function(e){var t=!1;return e&&e.source&&"ENOFOL3_AP"==e.source&&(t=!0),t},getSortedDroppedDataByType:function(e,t){var o=[],i=[],r=[];if(!!(e&&e.data&&e.data.items&&Array.isArray(e.data.items)))for(var a=0;a<e.data.items.length;a++){var l=e.data.items[a],d=l.objectId;if((u=l.objectType_Internal)||(u=l.objectType),Array.isArray(u)){for(var c=u.length,u=c>0?u[c-1]:void 0,p=0;p<c;++p)if(s.inFamilyFolder(u[p])){u=u[p];break}u=u}var g=l.displayName;g||(g=u),g||(g=d);var f=l.folderId,h=s.isPersonalFolder(u)||l.isPersonalFolder,m=l.envId,v=l.serviceId,_=l.folderClassification;let t=l.links;var S={id:d,type:u,name:g,label:g,sourceFolder_id:f,isPersonal:h,serviceId:v,tenantId:m,i3dx:l.i3dx,uri:l.uri,links:t,folderClassification:_};S["ds6w:type"]=l.displayType,S=n.getDefaultModelFromProperties(S),s.isRootFolder(u)||s.isPersonalFolder(u)?o.push(S):s.isFolder(u)?i.push(S):r.push(S)}t.RootFolder_itemList=o,t.Folder_itemList=i,t.Content_itemList=r},getWidgetId:function(){return self.widget.id},isMoveDnDSetting:function(){return"Move"===self.widget.getValue("drag-and-drop")&&!g.isSearchActive()},getDragDataForSelectedNodesInCurrentFolderContent:function(e){for(var t=n.getCurrentBookmarkId(),o=r.getAvailableCurrentBookmarkPath(),i=[],a=Array.isArray(o)?o.length:0,u=0;u<a;u++){var p=o[u];if(!s.inFamilyFolder(p.type))break;i.push({resourceid:p.id,type:p.type})}var g=[];return(e&&e.draggedNodes?e.draggedNodes:l.getContent().getSelectedNodes()).forEach(function(e){if(e){var o=e.options.type;let a=e.getAttributeValue("serviceId");var n={envId:d.getPlatformId(),serviceId:a||"3DSpace",contextId:c.getSetting("pad_security_ctx")?c.getSetting("pad_security_ctx"):void 0,objectId:e.getID(),objectType:o,i3dx:e.getAttributeValue("i3dx"),uri:e.getAttributeValue("uri"),links:e.getAttributeValue("links"),displayName:e.getLabel(),displayType:e.options.grid["ds6w:type"],folderClassification:e.options.grid.folderClassification,folderId:t,isPersonalFolder:e.isPersonal};if(!s.inFamilyFolder(o)){var r=e.getOccurencePathWithType?e.getOccurencePathWithType():void 0;e.isRelationsObjectNode?n.path=[r[r.length-1]]:n.path=r}s.inFamilyFolder(o)&&e.isFavorite||(n.folderPath=i),g.push(n)}}),{protocol:"3DXContent",version:"2.1",source:"ENOFOL3_AP",widget_id:this.getWidgetId(),data:{items:g}}},uploadFilesInFolder:function(e,t){e&&e.getType()&&s.inFamilyFolder(e.getType())?n.getCurrentBookmarkId()===e.getID()?u.uploadFileCmd(t):u.uploadFileCmd(t,e):console.log("  Error in FolderDnDServices.uploadFilesInFolder, dropTarget_Info is not a Folder")},uploadFoldersInFolder:function(e,t){if(e&&e.getID()){_.sendTrackerPageEvent("FolderWidget_DnD","Folder Upload");var o=d.get3DSpaceUrl(),i=widget.widgetDomain,r=e.getID(),s=e.label,a=widget.title.split("-"),l={fetchSecurityContext:function(){return c.getSetting("pad_security_ctx")},fetchCollabSpaceDisplayName:function(){return a[0]},platformUrls:{"3DSpace":o,"3DDashboard":i,platformId:f.getTenantID()}},u=new h(l),p=m.getCommand("FolderUpload");u.events.subscribe({event:"operation-complete"},function(e){require("DS/FolderEditor/views/FolderMode").switchtoAuthoringMode();var t=n.currentBookmarkId();e.parentId==t&&(S.refreshWidgetContent(),console.log("After Completion of the Command..."))}),u.events.subscribe({event:"enable-folder-upload-command-in-ui"},function(e){p.enable()}),u.events.subscribe({event:"disable-folder-upload-command-in-ui"},function(e){p.disable()}),u.handleDnD(r,t.dataTransfer,s)}else console.log("  Error in FolderDnDServices.uploadFilesInFolder, dropTarget_Info is not a Folder")},preAddContentInFolder:function(e,t,o,i,a){let l=new Map;var d=o.filter(e=>{const t=l.get(e.id);return t||l.set(e.id,e),!t});return new Promise(async o=>{if(d.length<1)return console.log("  Error in FolderDnDServices.addContentInFolder, lContentObjects list is empty"),o();if(e&&s.inFamilyFolder(e.getType())&&d){var l=!1,c=null;if((!0===this.isMoveDnDSetting()&&!0!==i||a)&&t)if(a)c=n.getDefaultModelFromId(t),l=!0;else{var u=await r.getCurrentBookmarkInfo();u&&u.getID()===t&&(c=u,l=!0)}const o=e=>e?"function"==typeof e.getID?e.getID():e.id:null,s=o(c),p=o(e);l&&(null!=s&&null!=p&&s!==p)?C.processMoveOperation(d,c.getID(),e):C.processAddOperation(d,e)}else console.log("  Error in FolderDnDServices.addContentInFolder, dropTarget_FolderNodeModel is not a Folder");o()})},addFoldersInFolder:function(t,d,c,p,g){var f=this;return new o(function(o,h){if(t&&t.getType()&&s.inFamilyFolder(t.getType())&&c){u._startProgressBar(i.Paste_content_loading);var m=c,v=m.length;if(v<1)return console.warn("  Error in FolderDnDServices.addFoldersInFolder, lContentId list is empty"),void h();var _=!1;if((!0===f.isMoveDnDSetting()&&!0!==p||g)&&(_=!0),_){if(t.getID()===d)return u._offProgressBar(),e.displayNotification({title:i.msg_error_MoveInSamefolder.Title,subtitle:i.msg_error_MoveInSamefolder.Advice,className:"error"}),void h();for(var S=0;S<m.length;S++){var C,y=m[S];if(t.getID()===y)return u._offProgressBar(),e.displayNotification({title:i.msg_error_MoveInSamefolder.Title,subtitle:i.msg_error_MoveInSamefolder.Advice,className:"error"}),void h();var D=l.getTreeCont();if(D&&(C=D._getVisibleNodeById(y,null)),C&&t instanceof b&&C.isAscendantOf(t))return u._offProgressBar(),e.displayNotification({title:i.msg_error_MoveFolder,message:i.msg_error_MoveFolder_parent,className:"error"}),void h()}r.MoveFolder({IDs:m,targetfolder:t,selectedIds:m,callbacks:{onComplete:function(r){o();let s=n.getSelectedBookmark(),c=n.getCurrentBookmarkId();var p=!1,g=!1;s&&(-1!=m.indexOf(s.id)&&(p=!0,g=!0));var f=l.getTreeCont();let h=null;if(f){var _=f._getVisibleNodeById(d,null);if(m.forEach(function(e){var t=f._getVisibleNodeById(e,_);t&&l.getTreeCont().removeFromTree(t)}),(h=f._getVisibleNodeById(t.getID(),null))&&h.isExpanded())p&&g&&c,h.collapse(),h.expand(),null&&(g=!1)}var S=l.getContent();if(S&&c){let e=null;if(c===d)e={},u._endProgressBarListener(),(C=S.getPADTreeDocument())&&C.keepExpandedState();else if(c===t.getID()){var C;e={objectId:m[v-1]},u._endProgressBarListener(),(C=S.getPADTreeDocument())&&C.keepExpandedState(),a.unmask(S._contentDiv)}else u._offProgressBar(),p&&g&&(s&&s.unselect(),h&&h.select(),s=null,g=!1);e&&F.publish({event:"refresh_content",data:e})}else u._offProgressBar();e.displayNotification({message:i.replace(i.msg_info_foldermoved,{number:m.length,foldername:t.label}),className:"success"})},onFailure:function(o){h();var r=l.getContent(),s=n.getCurrentBookmarkId();if(r&&s&&s===t.getID()&&a.unmask(r._contentDiv),u._offProgressBar(),o&&o.advice)e.displayNotification({title:i.msg_error_MoveFolder,subtitle:o.advice,message:o.error,className:"error"});else if(o&&o.message&&o.message.contains("NetworkError")&&o.message.contains("500"))e.displayNotification({message:i.msg_error_objectNoLongerAccessible,className:"error"});else{let t={className:"error"};t.message=i.msg_error_MoveFolder,o&&(t.message=o,t.title=i.msg_error_MoveFolder),e.displayNotification(t)}}}})}else r.CopyFolder({IDs:m,targetfolder:t,selectedIds:m,callbacks:{onComplete:function(o){h();var r=l.getTreeCont();if(r){var s=r._getVisibleNodeById(t.getID(),null);s&&s.isExpanded()&&r.updateTreeWithNewFolder(s)}var d=l.getContent(),c=n.getCurrentBookmarkId();if(d&&c)if(c===t.getID()){u._endProgressBarListener();var p=d.getPADTreeDocument();p&&p.keepExpandedState(),F.publish({event:"refresh_content",data:{objectId:m[v-1]}}),a.unmask(d._contentDiv)}else u._offProgressBar();else u._offProgressBar();e.displayNotification({message:i.replace(i.msg_info_foldercopied,{number:m.length,foldername:t.label}),className:"success"})},onFailure:function(o){h();var r=l.getContent(),s=n.getCurrentBookmarkId();if(u._offProgressBar(),r&&s&&s===t.getID()&&a.unmask(r._contentDiv),o&&o.advice)e.displayNotification({title:i.msg_error_CopyFolder,subtitle:o.advice,message:o.error,className:"error"});else if(o&&o.message&&o.message.contains("NetworkError")&&o.message.contains("500"))e.displayNotification({message:i.msg_error_objectNoLongerAccessible,className:"error"});else{let t={className:"error"};t.message=i.msg_error_CopyFolder,o&&(t.message=o,t.title=i.msg_error_CopyFolder),e.displayNotification(t)}}}})}else console.warn("  Error in FolderDnDServices.addFoldersInFolder, dropTarget_Info is not a Folder or RootFolder"),h()})},processDroppedDataOnFolderEditorNode:function(t,o){var n=this;function r(e){if(Array.isArray(e)&&e.length>0)for(var t=d.getPlatformId(),o=e.length-1;o>=0;o--){var n=e[o];if(n&&n.tenantId!==t)return!1}return!0}if(o&&t){var a=n.isExternalDroppedDataOnFolderEditor(o),c=!1;a&&(c=this.isExternalDroppedDataFromSameSource(o));var u={};n.getSortedDroppedDataByType(o,u);var g=u.RootFolder_itemList,h=u.Folder_itemList,m=u.Content_itemList;if(!r(g)||!r(h)||!r(m))return void e.displayNotification({message:i.msg_warning_dndnotsupported_from_different_tenant,className:"warning"});if(!function(e){if(Array.isArray(e)&&e.length>0)for(var t=e.length-1;t>=0;t--){var o=e[t];if(!o||s.isExternalObject(o)&&!o.i3dx&&"www"!==o.serviceId)return!1}return!0}(m)){let t="";return m.length>0&&(t=(t=m[0].getAttributeValue("ds6w:type"))||m[0].type),void e.displayNotification({title:i.replace(i.msg_warning_dndnotsupported_from_different_source.title,{objectType:t}),subtitle:i.msg_warning_dndnotsupported_from_different_source.subtitle,className:"warning"})}if(s.inFamilyFolder(t.getType()))Array.isArray(g)&&g.length>0&&e.displayNotification({message:i.msg_warning_dndnotsupported,className:"warning"}),new Promise(function(e,o){var n=h.length+m.length;if(c&&n>0){var i={targetBookmark:t.label,noOfObjects:n};p.getAddMovePopupResults(function(t){var n=t;"move"==n?e({isMoveExpectedfromExternalDrop:!0}):"copy"==n?e({isMoveExpectedfromExternalDrop:!1}):o()},i)}else e({isMoveExpectedfromExternalDrop:!1})}).then(function(e){var i=e.isMoveExpectedfromExternalDrop,r=[];if(Array.isArray(h)&&h.length>0)for(;h.length>0&&h[0];){var s=h[0],l=s.sourceFolder_id;let e=[];for(var d=h.length-1;d>=0;d--){var c=h[d];c?c.sourceFolder_id===l&&(e.push(c.id),h.splice(d,1)):h.splice(d,1)}if(!a&&!p.checkMoveOrCopyAcrossSharedAndPersonal({isPersonal:s.isPersonal},t,!n.isMoveDnDSetting()))return;r.push(n.addFoldersInFolder(t,l,e,a,i))}if(Array.isArray(m)&&m.length>0){let e={};m.forEach(t=>{let o=t.sourceFolder_id,n=e[o];n||(n=e[o]=[]),n.push(t)});for(let o in e){let s=e[o];r.push(n.preAddContentInFolder(t,o,s,a,i))}}Promise.allSettled(r).then(function(e){if(i){for(var t=!1,n=0;n<e.length;n++)if("fulfilled"==e[n].status){t=!0;break}if(t){var r=o.widget_id+f.getTenantID()+"ENOFOL3_AP";v.publish(r)}}}).catch(function(e){})});else if("FolderSection_favorite"==t.getType()){if(Array.isArray(g)&&g.length>0){var _=[];(S=l.getTreeCont())?(g.forEach(function(e){var t=!1;"SHARED"===e.folderClassification&&(t=!1);var o={id:e.id,name:e.name,type:e.type?e.type:"Workspace",isPersonal:e.isPersonal,inherit:t};_.push(o)}),_&&_.length>0&&S.addFavorite(_).catch(e=>{})):console.warn("  FolderDnDServices performDropOnFolderEditorNode FolderTreeCont is undefined")}if(Array.isArray(h)&&h.length>0)if(a)e.displayNotification({message:i.msg_warning_dndnotsupported_external_on_Section_FavoriteFolders,className:"warning"});else{var S;_=[];(S=l.getTreeCont())?(h.forEach(function(e){var t=!1;"SHARED"===e.folderClassification&&(t=!0);var o={id:e.id,name:e.name,type:e.type?e.type:"Workspace Vault",isPersonal:e.isPersonal,inherit:t};_.push(o)}),_&&_.length>0&&S.addFavorite(_).catch(e=>{})):console.warn("  FolderDnDServices performDropOnFolderEditorNode FolderTreeCont is undefined")}Array.isArray(m)&&m.length>0&&e.displayNotification({message:i.msg_warning_dndnotsupported,className:"warning"})}else console.warn("  FolderDnDServices processDroppedDataOnFolderEditorNode dropTarget_Info type is not in Folder family")}else console.warn("  FolderDnDServices processDroppedDataOnFolderEditorNode invalid argument(s)")},performDropOnFolderEditorNode:async function(o,a){var l=this,c=!0;o||console.log("  Error in FolderDnDServices.performDropOnFolderEditorNode, dropTarget_NodeModel is undefined");var u="FolderSection_favorite"==o.getID(),p=d.getPlatformId(),g=l.hasFilesInEvent(a),f=f||(o?null:i.msg_warning_dndnotsupported);if(f)e.displayNotification({message:f,className:"warning"}),c=!1;else if(s.inFamilyFolder(o.getType())){if(g){var h=function(e){for(var t=!1,o=e.dataTransfer.items,n=0;n<o.length;n++){let e=o[n].webkitGetAsEntry();if(e&&e.isDirectory){t=!0;break}}return t};if(0!=p.localeCompare("OnPremise"))if(h(a))l.uploadFoldersInFolder(o,a);else{var m=a.dataTransfer?a.dataTransfer.files:a.detail.files;l.uploadFilesInFolder(o,m)}else if(h(a))e.displayNotification({message:i.msg_warning_dndWindowsFoldernotsupported,className:"warning"});else{m=a.dataTransfer?a.dataTransfer.files:a.detail.files;l.uploadFilesInFolder(o,m)}c=!1}}else if(u)g&&(e.displayNotification({message:i.msg_warning_dndnotsupported,className:"warning"}),c=!1);else if(g&&0!=p.localeCompare("OnPremise")){if(g){for(var v=a.dataTransfer.items,_=0;_<v.length;_++){let e=v[_].webkitGetAsEntry();e&&e.isDirectory&&(isDirectoryItem=!0)}"FolderSection_AllFolders"==o.getID()&&(l.uploadFoldersInFolder(o,a),c=!1)}}else e.displayNotification({message:i.msg_warning_dndnotsupported,className:"warning"}),c=!1;var S=null;if(c)try{S=l.retrieveDroppedDataFromDropEvent(a)}catch(t){S=null,c=!1,console.log(t),e.displayNotification({message:i.msg_warning_dndnotsupported,className:"warning"})}if(self.widget&&this.isMoveDnDSetting()&&c&&S&&o&&"bookmark"===this.getDragFrom()&&n.getCurrentBookmarkId()!==o.getID()&&"FolderSection_favorite"!==o.getType()){let e=await r.getCurrentBookmarkInfo();var C=e.getLabel(),b=i.replace(i.confirmation_move_message,{source:C,target:o.label});S.hasOwnProperty("data")&&S.data.hasOwnProperty("items")&&(S.data.items.length>1?b=i.replace(i.confirmation_move_message_multisel,{nth:S.data.items.length,source:C,target:o.label}):S.data.items[0].hasOwnProperty("displayName")&&(b=S.data.items[0].objectId!==e.getID()?i.replace(i.confirmation_move_message_monosel,{selection:S.data.items[0].displayName,source:C,target:o.label}):i.replace(i.confirmation_move_message_mono_from_tree,{source:C,target:o.label}))),t.launch({title:i.confirmation_move_title,confirmLabel:i.confirmation_move_button,content:b},function(){l.processDroppedDataOnFolderEditorNode(o,S)}),l.setDragFrom("")}else c&&S&&o&&l.processDroppedDataOnFolderEditorNode(o,S)}}}),define("DS/FolderEditor/FolderTreeDocument",["DS/Logger/Logger","DS/FolderEditor/xBookDocument","DS/FolderEditor/Folder_CSO","DS/FolderEditor/service/FolderDnDServices","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/service/FolderServices","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/ActionBar/FolderCommandManager","DS/FolderEditor/models/xBookDocumentRefresh","DS/LifecycleServices/LifecycleServicesSettings","DS/PADUtils/PADProbes","DS/PADUtils/PADUtilsServices","DS/WebappsUtils/WebappsUtils","DS/Utilities/Utils","DS/FolderEditor/utils/FolderEditorcontrol","DS/PADServices/utils/GlobalModelEvents","DS/FolderEditor/Folder_Clipboard","DS/PADUtils/PADPredicatesNls"],function(e,t,o,n,i,r,s,a,l,d,c,u,p,g,f,h,m,v,_){"use strict";var S=t.extend(d,{name:"FolderTreeDocument",_doNotAddFolder:!1,init:function(t){t.shouldAcceptDrag=this.shouldAcceptDrag.bind(this),t.shouldAcceptDrop=this.shouldAcceptDrop.bind(this),t.allowUnsafeHTMLContent=!1,t.insert=this.insert.bind(this),t.authorize_setStructure=!0,t.shouldBeEditable=a.shouldBeEditable,this._parent(t),this.onNodeModelUpdate(a.onNodeModelUpdate);var o=this;m.subscribe({event:"refresh_content_nodes"},this.refreshNodeById.bind(this)),this._commandProxy&&this._commandProxy.addProxyEvents({events:{onRefresh:function(e){if((UWA.is(e.authored.created,"array")||UWA.is(e.authored.modified,"array"))&&o.refreshNodeById({created:e.authored.created,modified:e.authored.modified}),UWA.is(e.authored.deleted,"array")){var t=[];e.authored.deleted.forEach(function(e){t=t.concat(o.getNodesById(e))}),o.deleteNodes(t,!0),0==v.removeDeletedNodeFromClipboard(e.authored.deleted)&&v.ClearClipboard()}}}}),this._logger=e.getLogger(S),this._logger.log("init");o=this;this.selection_broadcast_fn=f.debounce(function(){var e=h.getIdCardCont();e&&e.updateSelectionCount(o.getSelectedNodes().length)},100),this.getXSO().onChange(o.selection_broadcast_fn),this.getXSO().onEmpty(function(){o._doNotAddFolder=!1,o.selection_broadcast_fn()}),this.getXSO().onPreEmpty(function(){o._doNotAddFolder=!0})},_buildSelectData:async function(){var e=this._parent();if(e){var t=await s.getCurrentBookmarkInfo();if(Array.isArray(e.paths)&&e.paths.length>=1){if(t&&i.inFamilyFolder(t.getType())){for(var o=await s.getCurrentBookmarkPath(),n=[],r=Array.isArray(o)?o.length:0,a=0;a<r;a++)n.push({resourceid:o[a].id,type:o[a].type});e.folderPath=n}}else if(t&&i.inFamilyFolder(t.getType())){o=await s.getCurrentBookmarkPath();var l=[];for(r=Array.isArray(o)?o.length:0,a=0;a<r-1;a++)l.push({resourceid:o[a].id,type:o[a].type});var d={};if(r>=1){let e=o[r-1];e.id&&(d[e.id]={type:e.type,label:e.label})}e.paths=[[t.getID()]],e.attributes=d,e.folderPath=l}}return e},prepareBroadcastSelect:function(){this._doNotAddFolder=!0,this._parent()},pushBroadcastSelect:function(){this._doNotAddFolder=!1,this.selection_broadcast_fn(),this._parent()},shouldAcceptDrag:function(e){var t=[];if((t=this.getSelectedNodes()).length>0){var o=t[0].getType();if(i.isPersonalFolder(o)||"Busy"==o)return!1}return!0},shouldAcceptDrop:function(e){return!(e&&e.parentTreeNodeModel&&e.draggedTreeNodeModel)||i.isFolder(e.parentTreeNodeModel.getType())},insert:function(e,t,o){if(e&&t){var i=n.getDragDataForSelectedNodesInCurrentFolderContent();n.processDroppedDataOnFolderEditorNode(t,i)}return!1},keepExpandedState:function(){var e=h.getContent().getPADTreeDocument();if(e){var t=e.getRoots(),o=0,n=t.length;for(o=0;o<n;o++){t[o].options.type;if(t[o].isExpanded()){h.getContent().RefreshProductStructure=!0;break}}}},deleteNodes:function(e){var t,o=e.length,n=!1;for(t=0;t<o;++t){if("noExpandState"!==e[t]._expandState&&!0===widget.getBool("filtered-content")){n=!0;break}}if(n){var i=this.getSelectedNodes().map(e=>e.getID());h.getContent().RefreshProductStructure=!0,h.getContent().loadContentAndSelect(void 0,i)}else{this._parent(e),0===h.getContent().getObjectsInTree()&&h.getContent()._addPlaceHolder()}},refreshNodeById:function(e){var t=this,o=e.modified,n=[],s=[],l=!1,d=this.getRoots();let u={};d.forEach(e=>{u[e.getID()]=e});let p=[];if(o.forEach(e=>{let t="object"==typeof e,o=t?e.physicalid:e,r=u[o],a=!1,d=r&&i.isExternalObject(r);if(r&&!d){let d=i.inFamilyFolder(r.getType()),c=function(e){var t=!1;return 1==e.options.isSearchWithinData&&(l=!0),e.options.isNotManagedByPS&&(t=e.options.isNotManagedByPS),t}(r),u=d?n:s;if(d||c){if(t){let t=e.key;t&&"ownerChanged"===t&&(l=!0)}a=!0,u.push(o)}}d||r&&(!r||a)||p.push(e)}),e.modified=p,l){this.keepExpandedState();var f=this.getSelectedNodes(),m=[];f.forEach(function(e){m.push(e.getID())}),h.getContent().loadContentAndSelect(void 0,m)}else n.length>0&&n.forEach(function(e){r.getFolderProperties({pid:e,onComplete:function(o){UWA.is(o,"string")&&(o=JSON.parse(o));var n=a.convertToExaleadDataFormat(o),i=t.searchRootById(e);if(i){if(i._resetting=!0,i.options.oldLabel=n.label,_.updateNLS(i),i.options.publishOnConnect!==o.publishOnConnect){var r="TRUE"===o.publishOnConnect?g.getWebappsAssetUrl("FolderEditor","icons/folderPublishBadge.png"):"";i.setBadges({bottomRight:r})}c.getEnforceFolderLinkSettingAsync(function(e,t){e||t}),t.wrapInTransaction(function(){i.updateOptions(n)})}},onFailure:function(){console.error("Unable to update Tree Label, Error in getting folder Properties")}})}),s.length>0&&s.forEach(function(e){r.getContentProperties({pid:e,onComplete:function(o){if(UWA.is(o,"string")){o=JSON.parse(o);var n=a.convertToExaleadDataFormat(o),i=t.searchRootById(e);if(i){var r=null;i._ischeckout="TRUE"===o.Documentlocked||"[TRUE]"===o.Documentlocked?"TRUE":"FALSE",t.wrapInTransaction(function(){let e=i.getChildren();e&&e.length>0&&delete n.children,i.updateOptions(n),"TRUE"===i._ischeckout&&(r=g.getWebappsAssetUrl("FolderEditor","icons/22/I_CheckOutDocument.png"),a.setBadge(i,"bottomRight",r))})}}},onFailure:function(){console.error("Unable to update Content root node, Error in getting content Properties")}})}),this._parent(e)}});return S}),define("DS/FolderEditor/utils/FolderEditorKeyboardListener",["UWA/Core","UWA/Class","UWA/Event","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/ActionBar/FolderCommandManager","DS/FolderEditor/Folder_CSO","DS/FolderEditor/service/FolderTypeService","DS/Logger/Logger"],function(e,t,o,n,i,r,s,a,l){var d=function(){var e=document.activeElement;return!(!e||"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName)};launchCommandForKey=function(e,t){var o=r.getCommand(t),n=null;return o&&o.isEnabled()?d()?n="Info : '"+e+"' key pressed in INPUT field, no command launched":o.begin():n="Info : '"+e+"' key pressed, but command '"+t+"' is disabled",n};var c=t.extend({name:"FolderEditorKeyboardListener",init:function(e){this._parent(e),this._logger=l.getLogger(c)},startObservingKeyboard:function(){e.Element.addEvent.call(document,"keydown",this._onKeyDown.bind(this))},_onKeyDown:function(e){var t=o.whichKey(e);if("ctrl+a"!=t||e.target.className.indexOf("FolderTreeListView")>=0){var n=this.launchKeyAction(t);n&&!0===n.stopPropagation&&o.stop(e)}},launchKeyAction:function(e){var t=this,o={stopPropagation:!1};switch(_launchCommandForKey=function(e,n,i){var r=launchCommandForKey(e,n);o.stopPropagation=!1!==i,r&&(t._logger.log(r),o.stopPropagation=!1)},e){case"ctrl+a":_launchCommandForKey(e,"SelectAll");break;case"del":_launchCommandForKey(e,"DeleteHdr");break;case"ctrl+c":_launchCommandForKey(e,"Copy",!1);break;case"ctrl+x":_launchCommandForKey(e,"Cut");break;case"ctrl+v":_launchCommandForKey(e,"Paste");break;case"ctrl+f":var r=n.getIdCardCont();r.isSearchAvailable()&&(r.switchSearch(!0),o.stopPropagation=!0);break;case"alt+return":_launchCommandForKey(e,"ActionBar_Attributes");break;case"f2":if(d())this._logger.log("Info : '"+e+"' key pressed in INPUT field, no command launched");else{var l=s.getSelectedNodes(),c=s.getSelectedBookmark();if((Array.isArray(l)?l.length:0)>=1){var u=l[0];if(u&&a.inFamilyFolder(u.getType()))if(c.getID()==u.getID()){var p=n.getTreeCont();p&&p.switchFolderTreeNodeLabelToWriteView&&p.switchFolderTreeNodeLabelToWriteView(c)}else{var g=n.getContent();g&&g.switchFolderTreeNodeLabelToWriteView&&g.switchFolderTreeNodeLabelToWriteView(u)}else this._logger.log("Info : '"+e+"' key pressed but selected element is not a Folder, no command launched")}else this._logger.log("Info : '"+e+"' key pressed when no element selected, no command launched")}break;case"esc":i.escapCmd()}return o}});return c}),define("DS/FolderEditor/FolderTreeMechanism",["UWA/Controls/Abstract","UWA/Class/Events","DS/FolderEditor/views/FolderMode"],function(e,t,o){return e.extend(t,{_folderTree:null,_isAsynchronousExpansion:!1,_currentRootNodes:[],limit:5,_expandedFolder:"",_processes:[],_partiallyExpandedFolder:[],init:function(e){this._parent(e);var t=this.treeNodeModel=e.treeNodeModel,n=this._folderTree=e.folderTree;"read"===o.getCurrentModeType()?this.executeExpansionForScroll_Index(e):this._initializeMechanism(n,t)},executeExpansionForScroll_Index:function(e){this._isAsynchronousExpansion=!0,this._neutralizePath(),0==this._folderTree._indexModeforReadData.getNextStart()?this._initializeMechanism(this.folderTree,this.treeNodeModel):(this._processes=["loadRoots","ExpandRootsandChildrenAsynchronously"],this.processExpansion(this.treeNodeModel,!0,e.explicitMethodToBeExecuted))},_initializeMechanism:function(e,t){var o=this;this._isAsynchronousExpansion=!0,this.preProcessInitialization(this).then(function(){o.processExpansion(t,!1)})},preProcessInitialization:function(e){var t=this;return this._processes=["loadRoots","ExpandRootsandChildrenAsynchronously"],new Promise(function(e){var o=t._folderTree._folderStructurePreference.getSelection();t.selectedpath=o&&o.split(",").length>2?[o.replace("root,FolderSection_AllFolders,","").split(",")]:[],e()})},getRoots:function(e){return 0==Object.entries(e).length?null:e.root?e.root.FolderSection_AllFolders||e.root._X_FolderSection_AllFolders||e.root._P_FolderSection_AllFolders:e._P_root?e._P_root.FolderSection_AllFolders||e._P_root._X_FolderSection_AllFolders||e._P_root._P_FolderSection_AllFolders:void 0},_getPartialExpandRoot:function(){let e=this._folderTree._folderStructurePreference._getStoredFolderTreeStructure(),t=e._P_root||e.root,o=[];if(!(!t||!t._P_FolderSection_AllFolders))for(let e in t._P_FolderSection_AllFolders){let t=e.replace(/^_(X|P)_/,"");o.push(["root",t])}return o},constructPaths:function(e){var t=this._folderTree._folderStructurePreference._getStoredFolderTreeStructure();let o=!(!t._P_root||!t._P_root._P_FolderSection_AllFolders);this.pathsTobeLoadedAsynchronouly=[];var n=this.getRoots(t);if(n)for(const t of Object.entries(n)){let n=!(i=t[0]).startsWith("_");var i=n?i:i.replace(/^_(X|P)_/,"");if(e.indexOf(i)>-1){var r=[],s="root,FolderSection_AllFolders,"+i;this._folderTree._folderStructurePreference.getExpandedChildren(s,function(e){r=e}),n&&r.unshift(i);var a=[];this._folderTree._folderStructurePreference.getExpandedChildren(s,function(e){o&&e.forEach(e=>{e.unshift("root")}),a=e},!0,!0),this.pathsTobeLoadedAsynchronouly.push([r,a,i])}}},processExpansion:function(e,t,o){var n=this;this._neutralizePath();var i=this.currentProcess=this._processes.length>1?this._processes.shift():this._processes[0];if("loadRoots"==i){let n=this._getPartialExpandRoot();setTimeout(()=>{this._updateLoadingOnNode(e),e.expand({_expandChildren:!1,updateView:!0,expandEvent:this._expansionEvent.bind(this),currentRootNodes:[],expandedFolder:[],partiallyExpandedFolder:n,isAsynchronousExpansion:!0,recordScrollForIndex:!0,doNotRemoveNodes:t,explicitMethodToBeExecuted:o})})}else"ExpandRootsandChildrenAsynchronously"==i&&setTimeout(()=>{this.createBatch(),this._currentRootNodes.length>0&&(this._currentRootNodes.forEach(e=>{e=n._folderTree._getNodesById(e);this._updateLoadingOnNode(e[0])}),e.expand({updateView:!0,expandEvent:this._expansionEvent.bind(this),currentRootNodes:n._currentRootNodes,expandedFolder:n._expandedFolder,partiallyExpandedFolder:n._partiallyExpandedFolder,isAsynchronousExpansion:!0,doNotRemoveNodes:t}))})},_neutralizePath:function(){this._currentRootNodes=[],this._expandedFolder=[],this._partiallyExpandedFolder=[]},getLimit:function(){return this.limit},createBatch:function(){for(var e=this,t=0,o=this.getLimit();t<o;){if(0==this.pathsTobeLoadedAsynchronouly.length){this._isAsynchronousExpansion=!1;break}var n=this.pathsTobeLoadedAsynchronouly.shift(),i=n[2];this._folderTree._getNodesById(i)&&this._folderTree._getNodesById(i).length>0&&(t+=1,this._currentRootNodes.push(i),n[0].length>0&&(0==this._expandedFolder.length?this._expandedFolder=n[0].toString():this._expandedFolder=e._expandedFolder+","+n[0].toString()),n[1].length>0&&n[1].forEach(t=>{e._partiallyExpandedFolder.push(t)}))}},_updateLoadingOnNode:function(e){var t=this._folderTree._folders_TreeView.layout,o=t.getCellsFromNodeModel(e);if(o){var n=t.collectionView._getViewAt(o[0]);n&&n.__applyExpanderState("expanding")}},_expansionEvent:function(e,t){var o=this,n=this.treeNodeModel;e&&e.forEach(function(e){(e=o._folderTree._getNodesById(e))&&e[0].setState({state:"expanded"})}),"loadRoots"==this.currentProcess&&this.constructPaths(t),o._isAsynchronousExpansion&&this.processExpansion(n,!0)}})}),define("DS/FolderEditor/FolderTreeCont",["UWA/Core","UWA/Utils","DS/Utilities/Utils","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","UWA/Promise","DS/Logger/Logger","DS/Tree/Tree","DS/TreeModel/TreeDocument","DS/WebappsUtils/WebappsUtils","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/views/FolderGlobalActiveBookmark","DS/FolderEditor/models/xTreeNodeModel","DS/FolderEditor/Folder_CSO","DS/PADUtils/PADCommandProxy","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUtil/IPClassifyUtility","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/utils/FolderEditorEvents","i18n!DS/FolderEditor/assets/nls/FolderEditor","DS/FolderEditor/service/FolderDnDServices","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/service/FolderServices","DS/FolderEditor/commands/FolderCommands","DS/PlatformAPI/PlatformAPI","DS/FolderEditor/Folder_Clipboard","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/PADServices/utils/GlobalModelEvents","DS/FolderEditor/PersonalFolderManager","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/utils/FolderCommunication","DS/FolderEditor/utils/FolderEditorKeyboardListener","DS/FolderEditor/views/FolderOrderCmd","DS/LifecycleServices/LifecycleServicesSettings","DS/PADUtils/PADProbes","DS/FolderEditor/tagger/TaggerTreeProxy","DS/DataGridView/DataGridView","DS/Core/PointerEvents","DS/PADUtils/Configuration","DS/DataGridView/DataGridViewLayout","DS/WidgetServices/WidgetServices","DS/FolderEditor/utils/FolderLoaderGlobal","DS/Menu/Menu","DS/IPClassifyFindInContext/FindInTree","i18n!DS/FolderEditor/assets/nls/FolderFindInTree","i18n!DS/IPClassifyFindInContext/assets/nls/FindInTree","DS/FolderEditor/utils/FolderExpandUtil_Read","DS/FolderEditor/views/FolderMode","text!DS/FolderEditor/assets/FolderEditorConf.json","DS/FolderEditor/dataProvider/FolderFindInDataProvider","DS/IPClassifyUtil/IPClassifyCommunication","DS/IPClassifyUXUtil/service/IPClassifyUXUtilWebService","DS/FolderEditor/FolderTreeMechanism","DS/Tweakers/GeneratedToolbar","DS/FolderEditor/views/TreeOrderCmdImpl","DS/FolderEditor/utils/BkAlert","DS/IPClassifyUXUtil/utils/CancellablePromise"],function(e,t,o,n,i,r,s,a,l,d,c,u,p,g,f,h,m,v,_,S,C,b,F,y,D,E,w,A,T,I,x,P,k,N,M,O,U,R,B,L,V,W,j,q,H,z,G,X,J,K,Q,Y,Z,$,ee,te,oe,ne,ie){"use strict";var re=new N,se=c.getWebappsAssetUrl("FolderEditor","icons/I_Bookmark_v2.png"),ae=c.getWebappsAssetUrl("FolderEditor","icons/I_BookmarkInherit_v2.png"),le=c.getWebappsAssetUrl("FolderEditor","icons/folder_shared.png"),de=c.getWebappsAssetUrl("FolderEditor","icons/folder_perso.png");function ce(e){return e._modelEvents}let ue=o.debounce(function(e){e&&e.root&&e.root.e&&(e={});var t=function e(t){let o=0;return t&&Object.values(t).forEach(t=>{o+=e(t)+1}),o}(e);if(!1!==widget.getValue("expandSaveLimitation")&&t>this.options.limitExpand){if(!this.options.limitExpandExceeded){let e=C.get("msg_warning_expandSaveLimitation");m.displayNotification({title:e.Title,subtitle:e.Advice,message:e.Details,className:"warning",id:"expandLimitation",debounce:!0}),this.options.limitExpandExceeded=!0}}else{let t=JSON.stringify(e);t=v.jsonZip(t),this.options.limitExpandExceeded=!1,widget.setValue("folderTreeStructure",t)}},300);var pe=n.extend(i,r,{name:"FolderTree_Cont",time_to_expand_node:1500,_folders_TreeDocument:null,_folders_TreeView:null,_logger:null,_commandProxy:null,_rootNodePersonal:null,_rootNodePersonal_id:null,_rootNodeFavorite:null,_rootNodeFolders:null,_rootNodeTrash:null,_folders_SortElmt:null,_probeLoadElmt:null,_currentDragEnterFolder:null,_timerDragEnter:null,propIDCard:"not initialized!",defaultOptions:{limitExpand:100,limitExpandExceeded:!1},_subscribe:function(e,t){let o=I.subscribe(e,t);this._subscriptionTokens.push(o)},init:function(e){var t=this;this._probeLoadElmt=U.createProbe("loadTreeCont"),this._parent(e),this._subscriptionTokens=[],this._folderStructurePreference.options=this.options,this.elements.container=UWA.createElement("div",{class:this.getClassNames()+"_container"});var o=widget.getValue("useIndexAccleration")?K.getCurrentModeType():"authoring";K.setCurrentModeType(o),this._donNotApplyFilterForRead=!1,T.app_initialization(function(){t._buildUI()}),this._subscribe({event:"refresh_tree"},this.refreshView.bind(this)),this._subscribe({event:"remove_nodes"},this.refreshOnDelete.bind(this)),this._subscribe({event:"select_breadcrumb_object"},({id:e,type:t,name:o})=>{let n=f.getDefaultModelFromId(e);n.type=t,n.name=o,f.dispatchBookmarkNodeSelection(n)}),this._subscribe({event:"filterUpdatedTree"},e=>{let t="read"===K.getCurrentModeType();this._indexModeforReadData.resetInfoIndex(),this._applyFilter(t||e.hasFilter?e.matchingIds:null),this._updateFilterIconOnToolbox(),t||void 0===e.matchingIds?this.refreshView():R.reloadObjects()})},_waitBookmarkPathReady:function(e){let t=e.shift();"root"===t&&(t=e.shift());let o=this._getNodesById(t),n=s.resolve();if(o&&o.length>0){let t=o[0],i=s.resolve();"expanding"===t.getState()&&(i=new s(e=>{let o=t.onPostExpand(()=>{t.removeEventListener(o),e(t)})})),n=new s(t=>{i.then(o=>{this._waitBookmarkPathReady(e).then(e=>{t(e||o)})})})}return n},_openBookmark:async function(e){var t=U.createProbe("treeCont_updateUI");let o=await y.getCurrentBookmarkInfo(),n=o.getType();this._updateTreeOrderVisibility(n);let i=this._getSelectedBookmark(),r=!i||i.getID()!==o.getID();if(r){"read"==K.getCurrentModeType()&&(this.forceLoad=!0);let t={};o._parentBk&&(t[o.getID()]=o._parentBk),this.expandTreeAndSelectFolder({folderToFindAndSelect:{ids:[o.getID()],type:o.getType(),name:o.getLabel()},parents:t,partiallyExpandPath:!0,onComplete:function(e){console.log(" expandTreeAndSelectFolder:onComplete")},onGiveUp:function(){console.log(" expandTreeAndSelectFolder:onGiveUp"),e&&e.options&&e.options.events&&e.options.events.treeGiveUp&&I.publish({event:e.options.events.treeGiveUp,data:{id:o.getID()}})},onFailure:function(t){console.log(t),e&&e.options&&e.options.events&&e.options.events.treeFailure?I.publish({event:e.options.events.treeFailure,data:{id:o.getID()}}):ne.displayNotFoundBk(o.getID(),o.getLabel())}}),this._scrollOnPostUpdateView(o.getID())}if(r||!0===o.userSelectFromTree){if(o&&o.getID()&&F.inFamilyFolder(o.getType())){for(var s=this.getExistingBookmarkPath(),a=[],l=Array.isArray(s)?s.length:0,d=0;d<l-1;d++)a.push({resourceid:s[d].id,type:s[d].type});var c={};if(l>=1){var u=l-1;s[u].id&&(c[s[u].id]={type:s[u].type,label:s[u].label})}var p=[];F.isSection(o.getType())||(o.options||(o.options={type:o.getType(),grid:{}}),p=[o]),k.setObject_on_compass({nodes_2_open:p}),this._commandProxy.select({paths:[[o.getID()]],attributes:c,folderPath:a,doNotSetOnCompass:!0}),require(["DS/IPClassifyUtil/IPClassifyCommunication"],function(e){if(!0===widget.getValue("noCompass")){var t={id:o.getID(),label:o.getLabel(),type:o.getType()};e.publish("selectedBookmarkInTree",t)}})}else F.isSection(o.getType())&&(this._commandProxy.select({paths:[],attributes:{},folderPath:[],doNotSetOnCompass:!0}),k.setObject_on_compass({nodes_2_open:[]}));_.dipatchSecurityContextAndFolder(),t.end(),delete o.userSelectFromTree}},_buildUI:function(){this._rootServiceHandler=null,this._logger=a.getLogger(pe);var e=this;this._commandProxy=h.create({events:{onRefresh:e._onRefresh.bind(e)}}),S.onFolderRename(function(t){var o=t.getID(),n=t.getLabel();e.updateNodeLabel(o,n)}),S.onModAttr(function(t){e.updateNodeAttr(t)}),k.subscribe("FolderEditor.RequestCurrentFolder",function(){_.dipatchSecurityContextAndFolder()});let t=f.onBookmarkOpening(this._openBookmark.bind(this));this._subscriptionTokens.push(t),e._buildSkeleton(),e._folders_SortElmt=new M,e._folders_TreeOrderElmt=new oe;let o=I.getModelEvents();e._folders_FindInTree=new z({dataProvider:Y,modelEvents:o,createButton:!1}),e._commonToolSection=UWA.createElement("div",{class:"folder-common-tool-Section",id:"folder-common-tool-Section"}),j.isTouchDevice()&&e._commonToolSection.setAttributeNode(document.createAttribute("touch-mode"));let n=this._getSortingIcon();var i=n.alphaIcon,r=n.dateIcon,l=n.toolbarIcon;let d={iconName:"sorting",fontIconFamily:1},p=this._folders_SortElmt.isTreeSort()?d:l;var g={entries:[{id:"findInTree",dataElements:{typeRepresentation:"functionIcon",label:X.toolTip,icon:{iconName:"find",fontIconFamily:1},value:function(){e._folders_FindInTree.clickEvent()},position:"far",category:"1",priority:2}},{id:"Filter",dataElements:{typeRepresentation:"icon",value:"filter",position:"far",category:"1",priority:2,label:C.fonticon_filter,visibleFlag:!1}},{id:"tree-reorder",dataElements:{typeRepresentation:"functionIcon",label:C.button_treeOrder,icon:{iconName:"tree-reorder",fontIconFamily:1},value:function(){e._launchReorderPanel()},priority:2,position:"far",category:"1",visibleFlag:!0}},{id:"alphaSortingContainer",dataElements:{priority:2,icon:p,position:"far",category:"1",label:C.fonticon_sort,typeRepresentation:"functionMenuIcon",value:{menu:[{id:"alphaSort",type:"PushItem",title:C.alpha_sorting,icon:i,action:{callback:function(){e._folders_SortElmt.toggleButton(),e._updateSortingIcon()}}},{id:"dateSort",type:"PushItem",title:C.date_sorting,icon:r,action:{callback:function(){e._folders_SortElmt.toggleButtonDate(),e._updateSortingIcon()}}},{id:"treeSort",type:"PushItem",title:C.tree_sorting,icon:"clear",action:{callback:function(){e._folders_SortElmt._toggleButton("TreeOrder"),e._updateSortingIcon(d)}}}]}}},{id:"wrong",dataElements:{typeRepresentation:"functionIcon",label:C.button_close,icon:{iconName:"wrong",fontIconFamily:1},value:function(){I.publish({event:"triptych-hide-panel",data:"left"})},priority:3,position:"far",category:"1"}}]},m=te.prototype.createTreeDocument(g);e.leftToolbar=new te({overflowManagement:"dropdown",direction:"horizontal",items:m});let v=UWA.createElement("div",{id:"buttonSection"});v.inject(e._commonToolSection);let b=UWA.createElement("div",{id:"rightButtons"});e.leftToolbar.inject(b),b.inject(v),e._folders_FindInTree.getUI().inject(e._commonToolSection),new UWA.createElement("div",{class:"div_for_margin"}).inject(v),this._subscribe({event:"findInTree UI updated"},e=>{e.component===this._folders_FindInTree&&this.elements.container.setAttribute("findInTree",e.visible)}),this._subscribe({event:"findInTree button UI updated"},e=>{e.component===this._folders_FindInTree&&this.leftToolbar.updateNodeModel("findInTree",{visibleFlag:e.visible})});var F=this._folders_TreeView?this._folders_TreeView.getTreeDocument():void 0;let y,D;this._folders_TreeDocument=F,F&&(F.options.shouldBeEditable=_.shouldBeEditable,F.onNodeModelUpdate(_.onNodeModelUpdate),F.options.shouldAcceptDrag=this._shouldAcceptDrag.bind(this),F.options.shouldAcceptDrop=this._shouldAcceptDrop.bind(this),F.onPreExpand(this._onPreExpandTreeNode.bind(this)),F.getXSO().onChange(function(){let e=F.getXSO().get();if(e.length>0){let t=e.length>0?e[0]:null;t&&(t.userSelectFromTree=!0),f.dispatchBookmarkNodeSelection(t)}})),P.checkSecurityCTXandTenantInitialization(function(){O.app_initialization(function(){O.getEnforceFolderLinkSettingAsync(function(t,o){q.addComponentsToLoad("treeView",{tree:""}),y=u.getWidgetSettings(),D=u.getServicesPromise(),q.removeComponentToLoad("global","widget"),new s(async function(t,o){var n=null==window.activatePersonalBookmark||window.activatePersonalBookmark;let i={};try{i=await y}catch(e){console.log(e)}await D,!0===i.personal&&!e._rootNodePersonal&&n?(q.addComponentsToLoad("treeView",{personalTree:""}),u.folderTree({pid:"",isPersonalFolder:!0,isRoot:!0,onComplete:function(o){if((o=JSON.parse(o)).folders&&o.folders.length>0){var n=o.folders[0],i={useAsyncPreExpand:!0};i.label=n.label,i.icons=[n.icon],i.children=[],e._rootNodePersonal_id=i.id=n.id,i.type=n.type,i.isPersonal=!0,e._rootNodePersonal=e._createTreeNodeModel(i,e._folders_TreeDocument),e._folderStructurePreference.isExpanded(e._rootNodePersonal.pathId,e=>{e||q.removeComponentToLoad("treeView","personalTree")})}else q.removeComponentToLoad("treeView","personalTree");t()},onFailure:function(){q.removeComponentToLoad("treeView","personalTree"),console.log("Error getting Personal Bookmark"),t()}})):t()}).then(function(){if(e._rootNodeFavorite)q.removeComponentToLoad("treeView","tree");else{var t=c.getWebappsAssetUrl("FolderEditor","icons/starBlue_v2.png"),o={useAsyncPreExpand:!0};o.label=C.name_Section_FavoriteFolders,o.icons=[t],o.children=[],o.id="FolderSection_favorite",o.type="FolderSection_favorite",e._rootNodeFavorite=e._createTreeNodeModel(o,e._folders_TreeDocument);var n=c.getWebappsAssetUrl("FolderEditor","icons/foldersectionall.png"),i={useAsyncPreExpand:!0};i.label=C.name_Section_AllFolders,i.icons=[n],i.children=[],i.id="FolderSection_AllFolders",i.type="FolderSection_AllFolders",e._rootNodeFolders=e._createTreeNodeModel(i,e._folders_TreeDocument),e.dispatchEvent.call(e,"onReady"),e._probeLoadElmt.end(),e._folderStructurePreference.isExpanded(e._rootNodeFolders.pathId,e=>{e||q.removeComponentToLoad("treeView","tree")}),e._openBookmark()}})})})}),this._updateFilterIconOnToolbox()},_applyFilter:function(e){this._folders_TreeDocument.withTransactionUpdate(()=>{this._folders_TreeDocument.getRoots().forEach(t=>{"FolderSection_AllFolders"===t.getID()&&t.getChildren().forEach(t=>{!e||e.indexOf(t.getID())>=0?t.show():t.hide()})})})},_applyFilterOnBookmarks:function(e){var t=this;if(t._tagNavigator)if(e)t._tagNavigator.isObjectVisible(e.getID())?e.show():e.hide();else if(t._folders_TreeDocument&&t._rootNodeFavorite){if("read"==K.getCurrentModeType())return this._donNotApplyFilterForRead?(this._indexModeforReadData.resetInfoIndex(),this._populateRootBookmark(),void t.getFavoriteSection().getChildren().forEach(function(e){t._tagNavigator.isObjectVisible(e.getID())?e.show():e.hide()})):void(this._donNotApplyFilterForRead=!0);for(var o=t._folders_TreeDocument.getRoots(),n=this._getSelectedBookmark(),i=[],r=null,s=0;s<o.length;++s)o[s]&&(i=i.concat(o[s].getChildren()),n&&-1!==n.pathId.indexOf(o[s].getType())&&(r=o[s]));t._rootNodeFavorite.withTransactionUpdate(function(){for(var e=0;e<i.length;++e){var o=i[e];t._tagNavigator.isObjectVisible(o.getID())?o.show():o.hide()}}),n&&!t._tagNavigator.isObjectVisible(n.getID())&&r&&r.select({onlyUI:!0})}},_updateSortIcon:function(e){this.leftToolbar.updateNodeModel("alphaSortingContainer",{icon:e})},_launchReorderPanel:function(){this._folders_TreeOrderElmt.reorderTree(this)},_updateTreeOrderVisibility(e){let t=!0;t="FolderSection_favorite"!=e,this.leftToolbar.updateNodeModel("tree-reorder",{visibleFlag:t})},_updateSortingIcon:function(e){let t=this._getSortingIcon(),o=e||t.toolbarIcon;this.leftToolbar.updateNodeModel("dateSort",{icon:t.dateIcon}),this.leftToolbar.updateNodeModel("alphaSortingContainer",{icon:o}),this.leftToolbar.updateNodeModel("alphaSort",{icon:t.alphaIcon})},_getSortingIcon:function(){let e,t,o,n,i,r,s="desc"==this._folders_SortElmt.sortOrder;return{toolbarIcon:e={iconName:n="date"==this._folders_SortElmt.sortMode?s?"num-sorting-2-1":"num-sorting-1-2":s?"alpha-sorting-z-a":"alpha-sorting-a-z",fontIconFamily:1},alphaIcon:t={iconName:i=s?"alpha-sorting-a-z":"alpha-sorting-z-a",fontIconFamily:1},dateIcon:o={iconName:r=s?"num-sorting-1-2":"num-sorting-2-1",fontIconFamily:1}}},_getIcon:function(e,t){var o="subFolders"!==t&&P.isCustomizedEnv(),n=e.icon;return e.type&&F.isPersonalFolder(e.type)?o||!n?de:n:"favorites"===t?e.inherit?ae:se:o||!n?le:n},_refreshNodes:function(e){for(var t=0;t<e.length;t++)this.updateNodeLabel(e[t])},_getAllRoots:function(){var e=this._folders_TreeDocument.getRoots(),t=[];return e.forEach(function(e){"FolderSection_AllFolders"===e.getType()&&(t=e.getChildren())}),t},_getSelectedBookmark:function(){let e=this.treeDocument.getSelectedNodes();return e.length>0?e[0]:null},_onRefresh:function(e){if(e&&e.authored&&(e.authored.modified&&UWA.is(e.authored.modified,"array")&&this._refreshNodes(e.authored.modified),e.authored.deleted&&UWA.is(e.authored.deleted,"array")&&e.authored.deleted.length>0)){var t=this._getAllRoots(),o=!1;if(t.every(function(t){return!(o=!!t&&e.authored.deleted.indexOf(t.id)>=0)}),o){let t=this._getSelectedBookmark();t&&e.authored.deleted.indexOf(t.getID())>=0&&(t.unselect(),f.dispatchBookmarkNodeSelection(this._rootNodeFolders))}e.authored.deleted.forEach(e=>{this.removeFromTree({id:e})})}},render:function(){return this},destroy:function(){this._logger.log("destroy"),this._subscriptionTokens.forEach(e=>{I.unsubscribe(e)}),this._subscriptionTokens=[],this._folderStructurePreference._storedStructure=null,this._folderStructurePreference._currentSelection=null,this._parent()},_onContextualEvent:function(e){var t=this;let o=this._getSelectedBookmark();if(!e||!e.cellInfos||o&&e.cellInfos.nodeModel.getID()===o.getID()||e.cellInfos.nodeModel.select(!0),e&&e.cellInfos)return new s(function(o){t.__onContextualMenuReady(e).then(function(e){o(e)})})},_buildSkeleton:function(){var e=this;this.elements.container=UWA.createElement("div",{class:this.getClassNames()+"_container"});let t=UWA.createElement("div",{class:"FolderEditor_treeView_loader"}).inject(this.elements.container);q.setContainer("treeView",t),this.getOption("css_view_class")&&this.elements.container.addClassName(this.getOption("css_view_class")),this.elements.folderTreeView_container=UWA.createElement("div",{class:this.getClassNames()+"_treeview_container"}).inject(this.elements.container);var o=UWA.clone(V.getConfig("dgvOptions")),n=o&&o.dgv?o.dgv:{};n.selectionBehavior.toggle=j.isTouchDevice(),n.selectionBehavior.unselectAllOnEmptyArea=!1,n.infiniteScrolling=!0,n.onContextualEvent=e._onContextualEvent.bind(e),n.rowSelection="single",n.showRowBorderFlag=!1,n.columns=[{dataIndex:"tree",sortableFlag:!1,typeRepresentation:"string",getCellEditableState:function(e){return 1!=widget.launchWithReadMode&&(e&&e.nodeModel&&F.inFamilyFolder(e.nodeModel.getType())&&!F.isPersonalFolder(e.nodeModel.getType()))},editionPolicy:"DelayedEditionOnClick",setCellValue:function(e,t){if(e.nodeModel){var o=e.nodeModel;require("DS/FolderEditor/commands/FolderCommands")._cellToRename={cellInfos:e,context:"TREE"},o.getTreeDocument().withTransactionUpdate(function(){var e={};e.label=t,e.display=t,e.oldLabel=o.options.label,o.updateOptions(e)})}},compareFunction:function(t,o,n,i,r){return e._folders_SortElmt.mySortFunction(n,i)},onCellRequest:function(e){e.isHeader||(e.nodeModel&&e.nodeModel.options.isBeingCut?e.cellView.getContent().addClassName("folder-state-is-being-cut"):e.cellView.getContent().removeClassName("folder-state-is-being-cut")),this.defaultOnCellRequest(e)}}];var i=UWA.extend({identifier:"DataGridView-"+e.name+"-"+widget.id},n),r=UWA.clone(o.dgvLayout);i.layout=new W(r),i.layout.useLastColumnWidthAutoFlag=!0,i.layout.columnsHeader=!1;var s=this.treeDocument=new d({nodeModelClass:g,useAsyncPreExpand:!0});s.useAsyncPreExpand=s.options.useAsyncPreExpand,f.registerTreeDocument("TREE",s),i.treeDocument=s,i.rowReorderEnabledFlag=!0,i.rowDragEnabledFlag=!0;var a=new B(i).inject(this.elements.folderTreeView_container);this._folders_TreeView=a;["esc","del","ctrl+f","alt+return","f2","ctrl+x","ctrl+v"].forEach(function(e){a._keymapManager.registerKeymap(e,void 0)}),a.setUseClipboardFlag(!1),a.onCopy=re.launchKeyAction.bind(re,"ctrl+c"),a.onCut=re.launchKeyAction.bind(re,"ctrl+x"),a.onPaste=re.launchKeyAction.bind(re,"ctrl+v"),a.showAlternateBackgroundFlag=!1,a.treeNodeCellOptions.depthIncrement=14,a.treeNodeCellOptions.buildLinks=!0,a.treeNodeCellOptions.expanderStyle="triangle",a.selectNextCellOnEnterFlag=!1,a.onEndResizeOrOnReadyModelRequest(function(t){t.RowMaxNumber>=25&&t.RowMaxNumber>=a.getModelLength()&&(t.reachBottom=!0,e._processForInfiniteScroll(t,a)),a.EndResizeOrOnReadyModelRequestDone()}),a.onDragStartCell=this._onDragStartCell.bind(this),a.onDragEndCell=this._onDragEndCell.bind(this),a.onDragLeaveCell=this._onDragLeaveCell.bind(this),a.onDragOverCell=this._onDragOverCell.bind(this),a.onDropCell=this._onDropCell.bind(this),a.onDragEnterBlank=this._onDragEnterBlank.bind(this),a.onDragOverBlank=this._onDragOverBlank.bind(this),a.onDropBlank=this._onDropBlank.bind(this),a.onDragLeaveBlank=this._onDragLeaveBlank.bind(this),a.addEventListener(L.POINTERDOWN,function(t,o){2===t.multipleHitCount&&o&&-1!==o.rowID&&e._switchExpandStatus(o)}),a.onInfiniteScroll(function(t){e._processForInfiniteScroll(t,a)})},_processForInfiniteScroll:function(e,t){var o=this;if(e.reachBottom){var n=!1;if("read"==K.getCurrentModeType()){var i=this._indexModeforReadData.getInfoIndex(),r=this._indexModeforReadData.getNextStart(),s=i?i.nhits:null;isNaN(s)||(n=r<s)}n&&!this._indexModeforReadData.isInfiniteScrollingInProcess()&&(this._indexModeforReadData.setInfiniteScrollingStatus(!0),this._populateRootBookmark(function(){o._indexModeforReadData.setInfiniteScrollingStatus(!1)},!0))}t.infiniteScrollProcessDone()},_populateRootBookmark:function(e,t){t="boolean"==typeof t&&t,q.addComponentsToLoad("treeView",{tree:""});let o=null;this._folders_TreeDocument.getRoots().every(e=>("FolderSection_AllFolders"===e.getType()&&(o=e),!o)),this.folderTreeMechanism=new ee({treeNodeModel:o,folderTree:this,explicitMethodToBeExecuted:e})},escape:function(){this._folders_TreeView.commands.escape.bind(this._folders_TreeView)()},_switchExpandStatus:function(e){!0===e.nodeModel._isExpanded?e.nodeModel.collapse():e.nodeModel.expand()},_populateFavoriteSection:function(e){var t=this;t._rootNodeFavorite?t._rootNodeFavorite._isPopulated?e&&e.onComplete&&e.onComplete():t.getFavorites().then(o=>{var n={useAsyncPreExpand:!1};o.forEach(function(e){if(!0!==e.toRemove){n.label=e.name,n.bookmarkLabel=e.label,n.isPersonal=e.isPersonal;var o=t._getIcon(e,"favorites");if(F.isPersonalFolder(e.type)&&(n.isPersonal=!0),n.icons=[o],n.children=null,n.id=e.id,n.mxid=e.mxid,e.type){var i="Workspace"===e.type||"RootFolder"===e.type;n.type=i?"Workspace":"Workspace Vault"}else n.type="Workspace Vault";n.isFavorite=!0,t._createTreeNodeModel(n,t._rootNodeFavorite).setState({state:"noChildren"})}}),t._rootNodeFavorite._isPopulated=!0,e&&e.onComplete&&e.onComplete()}).catch(e=>{t._logger.warn("FolderTreeCont : unable to initialize list of Favorite Folders",e.err)}):e&&e.onFailure&&e.onFailure(new Error("FolderSection_favorite node does not yet exist"))},_refreshFavoriteSection:function(e){this._rootNodeFavorite?(this._rootNodeFavorite.removeChildren(),this._rootNodeFavorite._isPopulated=!1,x.resetToPreInitializedState(),this._populateFavoriteSection(e)):(this._logger.log("FolderTreeCont : FolderSection_favorite node does not yet exist"),e&&e.onFailure&&e.onFailure(new Error("FolderSection_favorite node does not yet exist")))},_cancelRootServiceHandler:function(){this._rootServiceHandler&&this._rootServiceHandler.cancel(),this._rootServiceHandler=null},_preExpandDone:function(e,t){e.preExpandDone(),0===e._options.children.length?e.setState({state:"noChildrenExpanded"}):"expanded"===e.getState()&&(0===e.getChildren().length?e.setState({state:"noChildrenExpanded"}):e.setState({state:"expanded"}));var o=this;let n=e;t&&!1===t._expandChildren||o._folderStructurePreference.isExpanded(n.pathId,function(e,i){var r=function(e,t){n instanceof d?e[t]({updateView:!0}):n.isExpanded()&&("expand"===t&&(e.isExpanded()&&!e._virtualNodes||"expanding"===e.getState())||e[t]({onlyUI:!0}))};i&&n.setState({state:"partiallyExpanded"}),n.getChildren().forEach(function(n,i){"All"==t.expandLevel?e&&("FolderSection_favorite"!==n.getType()||o._rootNodeFavorite||(o._rootNodeFavorite=n),r(n,"expand")):o._folderStructurePreference.isExpanded(n.pathId,function(e){e&&r(n,"expand")})})})},_onPreExpandTreeNode:function(e){setTimeout(this.__onPreExpandTreeNode.bind(this,e))},__onPreExpandTreeNode:function(e){var t=e.data.nodeModel;let o=this._folderStructurePreference,n=o._collapsedBookmarkTreeMap.get(t.getID());var i=this._folderStructurePreference._getStoredFolderTreeStructure();if(n){var r=t.pathId.split(","),s=i;r.forEach(function(e,t){t<r.length-1&&(s=s[e]||s[o._partialExpandPrefix+e])}),s[t.getID()]=n,o._collapsedBookmarkTreeMap.delete(t.getID())}if(e.data.onlyUI)return t._virtualNodes&&(Object.values(t._virtualNodes).forEach(e=>{this._addChild(t,e)}),delete t._virtualNodes),e.data.persistedData=g,void this._preExpandDone(t,e.data);var a=e.data.isAsynchronousExpansion,l=e.data.expandLevel;let d="FolderSection_AllFolders"==t.getType();if(d&&!0!==e.data.doNotRemoveNodes&&(t.removeChildren(),this._indexModeforReadData.resetInfoIndex()),d&&!0!==a&&null==l)return t.setState({state:"expanding"}),this.folderTreeMechanism=new ee({treeNodeModel:t,folderTree:this}),void t.preExpandDone();d&&!0!==e.data.doNotRemoveNodes&&(R.clearTags(),R.refresh(!1));var c=this;P.isCustomizedEnv();var p=e.data.expandedFolder,g=e.data.partiallyExpandedFolder;if(void 0===p&&(c._folderStructurePreference.getExpandedChildren(e.parent.pathId,function(e){p=e}),c._folderStructurePreference.getExpandedChildren(e.parent.pathId,function(e){g=e},!0,e.data&&!0===e.data.updateView)),"FolderSection_favorite"!==t.getType()){F.isAllBookmarksSection(t.getType())&&(this._cancelRootServiceHandler(),!0!==e.data.doNotRemoveNodes&&(this.getBookmarkSection().removeChildren(),this._indexModeforReadData.resetInfoIndex()));var f=t.getNodeDepth();let o=F.isPersonalFolder(t.getType()),n=!F.isPersonalFolder(t.getType())&&F.isSection(t.getType());var h={pid:n?"":t.id,level:e.data.expandLevel,expandList:p,partialExpandList:g,isPersonalFolder:o,isRoot:n,explicitRoots:e.data.isAsynchronousExpansion?e.data.currentRootNodes:[],recordScrollForIndex:!!e.data.hasOwnProperty("recordScrollForIndex")&&e.data.recordScrollForIndex,onComplete:function(n){if((n="string"==typeof n?JSON.parse(n):n).error)return m.displayNotification({...n.error,className:"error"}),t.loadHasFailed=!0,c._preExpandDone(t,e.data),t.collapse(),void q.removeComponentToLoad("treeView",o?"personalTree":"tree");!0!==e.data.doNotRemoveNodes&&t.removeChildren();var i=n.folders,r={0:t},s=[],a=[].concat.apply([],g);var l=F.isSection(t.getID())?"root":t.getID();a.indexOf(l)>=0&&s.push(t);let d=[],u=null;for(var p=0;p<i.length;p++){var h=i[p];if(!0!==h.toRemove){var v={useAsyncPreExpand:!0};v.label=h.label,v.icons=[c._getIcon(h,"subFolders")],v.children=[],v.id=h.id,v.mxid=h.mxid,v.type="Workspace Vault",v.created=h.created,v.owner=h.owner,v.relId=h.RelId,v.relationOrder=h.TreeOrder,UWA.is(h.publishOnConnect)&&(v.publishOnConnect=h.publishOnConnect),v.folderClassification=h.folderClassification;var _=h&&h.level?parseInt(h.level):1;if(null==u&&(u=_),1===_&&F.isSection(t.getType())&&!F.isPersonalFolder(t.getType())){d.push(v.id);var S=c._getIcon(h);v.icons=[S],v.type="Workspace",UWA.is(h.publishOnConnect)&&(v.publishOnConnect=h.publishOnConnect)}if(t.isPersonal&&(v.isPersonal=!0),c._getNodesById(v.id).length>0)r[_]=c._getNodesById(v.id)[0];else{let e=u!==_;r[_]=c._createTreeNodeModel(v,r[_-1],e)}e.data.expandLevel}}if(d.length>0&&"read"!==K.getCurrentModeType()&&(R.addObjectsTags(d,!0),R.applyFilterIfAny()),t.loadHasFailed=!1,c._preExpandDone(t,e.data),e.data.expandLevel&&i.length>0){var C={onlyUI:!0,initialLevel:f,expandLevel:e.data.expandLevel,clearLast:e.data.clearLast};"All"===e.data.expandLevel?(C.expandAll=!0,t.expandNLevels(C)):(C.numberOfLevelsToExpand=e.data.expandLevel,t.expandNLevels(C))}s.forEach(function(e){e.setState({state:"partiallyExpanded"})}),c._folders_SortElmt.sortingNodesUnsensitiveCase(),t.options.children=null===t.options.children?[]:t.options.children,e.data.explicitMethodToBeExecuted&&e.data.explicitMethodToBeExecuted(),e.data.expandEvent&&e.data.expandEvent(e.data.explicitRoots,d),q.removeComponentToLoad("treeView",o?"personalTree":"tree")},onFailure:function(o){e.data.explicitMethodToBeExecuted&&e.data.explicitMethodToBeExecuted(),t.loadHasFailed=!0,c._preExpandDone(t,e.data),c._logger.log("WebService folders Err : "+o),q.removeComponentToLoad("treeView","tree")}};"read"==K.getCurrentModeType()?J.listFolder(h):(u.folderTree(h),c._indexModeforReadData.resetInfoIndex())}else c._refreshFavoriteSection({onComplete:function(){c._preExpandDone(t,e.data),q.removeComponentToLoad("treeView","tree")}})},_onDragStartCell:function(e,t){w.SetAsExternalDrop(!1);var o=t.nodeModel,n=o.getID(),i="";i=F.isFolder(o.getType())?"Workspace Vault":F.isRootFolder(o.getType())?o.isPersonal?"Personal Workspace":"Workspace":o.getType();var r=null,s=o.getParent();s&&!s.isRoot()&&F.inFamilyFolder(s.getType())&&(r=s.getID());var a=void 0;if(!o.isFavorite){for(a=[];s&&!s.isRoot();){var l=s.getType();F.inFamilyFolder(l)?(a.push({resourceid:s.getID(),type:l}),s=s.getParent()):s=null}a.reverse()}var d={envId:T.getPlatformId(),serviceId:o.getAttributeValue("serviceId"),contextId:A.getSetting("pad_security_ctx")?A.getSetting("pad_security_ctx"):void 0,objectId:n,objectType:i,folderClassification:o.options?o.options.folderClassification:void 0,displayName:o.getLabel(),folderId:r,isPersonalFolder:o.isPersonal};a&&(d.folderPath=a);var c={protocol:"3DXContent",version:"1.1",source:"ENOFOL3_AP",widget_id:b.getWidgetId(),data:{items:[d]}};try{e.dataTransfer.setData("text/searchitems",JSON.stringify(c))}catch(e){}return e.dataTransfer.setData("Text",JSON.stringify(c)),e.dataTransfer.effectAllowed="all",b.setStartDrag(!0),b.setDragFrom("bookmark"),e.stopPropagation(),!!t.nodeModel.isFavorite},_onDragEndCell:function(e,t){var o=this;if(b.setStartDrag(!1),b.setDragFrom(""),"middle"!==this._dndDropPosition&&t&&t.nodeModel.isFavorite&&t.draggedNodes.length>0&&t.draggedNodes[0].getID()!==t.nodeModel.getID()){var n=[];this.getFavoriteSection().getAllDescendants().forEach(function(e){n.push(e.id)}),this.getFavorites().then(e=>{var t=e.slice(),i=[];function r(e){for(var o=0;o<t.length;o++)t[o].id===e&&t.splice(o,1)}for(var s=0;s<n.length;s++)e.forEach(function(e,t){e.id===n[s]&&(i.push(e),r(e.id))});i=i.concat(t),o._setFavorites({favoriteFolders:i}).then(()=>{console.log("Re-arrange of favorite node is successful")}),m.displayNotification({message:C.get("msg_success_favoriteReordered"),className:"success"})}).catch(e=>{console.log(e.err)})}},_onDragLeaveCell:function(e,t){return this._timerDragEnter&&(clearTimeout(this._timerDragEnter),this._timerDragEnter=null),this._currentDragEnterFolder=null,!0},_onDragOverCell:function(e,t){if(e.preventDefault(),1!=widget.launchWithReadMode){var o=t.nodeModel;return e&&e.dataTransfer&&("FolderSection_Trash"===o.getType()?e.dataTransfer.dropEffect="none":e.dataTransfer.dropEffect=b.isDragging()&&b.isMoveDnDSetting()&&!b.hasFilesInEvent(e)?"move":"copy"),t&&(!t.nodeModel.isFavorite||t.draggedNodes&&!t.draggedNodes[0].isFavorite)&&(t.dropPosition="middle"),this._dndDropPosition=t.dropPosition,this._currentDragEnterFolder&&this._timerDragEnter&&this._currentDragEnterFolder!==t.nodeModel.getID()&&(clearTimeout(this._timerDragEnter),this._timerDragEnter=null),this._currentDragEnterFolder===t.nodeModel.getID()||t.nodeModel.isExpanded()||"expanding"===t.nodeModel.getState()||(this._timerDragEnter=setTimeout(function(){t.nodeModel.expand()},this.time_to_expand_node)),this._currentDragEnterFolder=t.nodeModel.getID(),!0}},_onDropCell:function(e,t){e.preventDefault();let o=t.nodeModel;if(!0===o.isFavorite&&t.droppedNodes&&1===t.droppedNodes.length&&t.droppedNodes[0].isFavorite)return!0;if(1!=widget.launchWithReadMode){if(!t.cellModel||!t.dropPosition)return!0;w.SetAsExternalDrop(!0),this._timerDragEnter&&(clearTimeout(this._timerDragEnter),this._timerDragEnter=null),this._currentDragEnterFolder=null,b.performDropOnFolderEditorNode(o,e),b.setDragFrom("")}else m.displayNotification({message:C.msg_warning_DndNotSupported,className:"warning"})},_onDragEnterBlank:function(e,t){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="none")},_onDragLeaveBlank:function(e,t){var o=P.getTreeCont();o._timerDragEnter&&(clearTimeout(o._timerDragEnter),o._timerDragEnter=null),o._currentDragEnterFolder=null},_onDragOverBlank:function(e,t){},_onDropBlank:function(e,t){b.setDragFrom("")},_shouldAcceptDrag:function(e){var t=this._getSelectedBookmark();return t&&F.isFolder(t.getType())||t.isFavorite||F.isRootFolder(t.getType())},_shouldAcceptDrop:function(e){return e&&e.dropNode.isFavorite&&("middle"!==e.dropPosition||!e.draggedTreeNodeModel.isFavorite)},isFolderAmongFavoriteFolders:function(e){var t=!1;if(e&&e.id){var o=this._rootNodeFavorite.getChildren();if(o)for(var n=0;n<o.length;n++){var i=o[n];if(e.id==i.id){t=!0;break}}}return t},getFavoritesWithCheck:function({nodes:e,withServerCall:t,noAttributes:o,withNotification:n,silent:i}){let r={favorites:e,alreadyExist:[],allIds:[]},a=this._rootNodeFavorite.isExpanded();a&&(r.favorites=[],e.forEach(e=>{this.isFolderAmongFavoriteFolders(e)?r.alreadyExist.push(e):(r.favorites.push(e),r.allIds.push(e.id))}));let l=s.resolve(r);if(t||!a){let e=this;l=new ie(function(t,n){r.allIds=[],e.getFavorites({noAttributes:o,silent:i}).addLinkTo(this).then(e=>{var o,n,i=e;let s={};for(n=0;n<i.length;n++){s[i[n].id]=!0}for(o=0;o<r.favorites.length;o++){var a=r.favorites[o];a&&(s[a.id]?r.alreadyExist.push(a):(r.allIds.push(a.id),i.push(r.favorites[o])))}r.favorites=i,t(r)}).catch(n)})}return n&&l.then(e=>{e.alreadyExist.forEach(e=>{m.displayNotification({message:C.replace(C.get("msg_warning_FolderAlreadyAmongFavorites"),{foldername:e.name}),className:"warning"})})}),l},isFolderActiveDefined:function(e){var t=P.getActiveFolder();return t.id===e||t.disabledId===e},addFavorite:function(e){if(e){var t=this,o=Array.isArray(e)?[...e]:[e];return new s((e,n)=>{this.getFavoritesWithCheck({nodes:o,withServerCall:!0,noAttributes:!0,withNotification:!0}).then(o=>{let i=o.favorites,r=o.allIds;t._setFavorites({favoriteFolders:i}).then(o=>{o.forEach(function(e){if(r.indexOf(e.id)>=0){var o={useAsyncPreExpand:!1};o.label=e.name,o.bookmarkLabel=e.name,o.isPersonal=e.isPersonal,o.children=null,o.id=e.id,o.mxid=e.mxid,e.inherit&&(o.inherit=1),o.isPersonal=!(!e.type||!F.isPersonalFolder(e.type))||o.isPersonal;var n=t._getIcon(e,"favorites");o.icons=[n],e.type?o.type="Workspace":o.type="Workspace Vault",o.isFavorite=!0,t._createTreeNodeModel(o,t._rootNodeFavorite).setState({state:"noChildren"}),m.displayNotification({message:C.replace(C.get("msg_info_favoriteadded"),{name1:e.name}),className:"success"})}}),e()}).catch(e=>{t._logger.warn("WebService _setFavorites Err : "+e.err),n(e)})}).catch(e=>{t._logger.warn("WebService getFavorites Err : "+e.err),n(e)})})}this._logger.log("FolderTreeCont unable to addFavorite, newFavoriteFolder(s) is not define")},removeFavorite:function(e){var t=this;let o=null;var n=t._rootNodeFavorite.getChildren();let i=[];for(var r=Array.isArray(n)?n.length:0,a=0;a<r;a++){var l=n[a];if(e.id==l.id){e.hasOwnProperty("name")||(e.name=l.label),l.isSelected()&&(o=l),l.hide(),i.push(l);break}}let d=this._getSelectedBookmark();d&&d.getType();let c=new s((n,r)=>{function s(s){var a;o&&s&&f.dispatchBookmarkNodeSelection(t._rootNodeFavorite),i.forEach(e=>{s?t._rootNodeFavorite.removeChild(e):e.show()}),!1===(a=t._rootNodeFavorite).hasChildren()&&a.withTransactionUpdate(function(){a.removeChildren(),a.setState({state:"collapsed"})}),s?(I.publish({event:"remove_favorite",data:e}),n()):r()}t.getFavorites({noAttributes:!0,view:"FORREMOVE"}).then(o=>{for(var n=o,i=0,r=0;r<n.length;r++){var a=n[r];if(e.id==a.id){n.splice(r,1),i=1;break}}i?t._setFavorites({favoriteFolders:n}).then(t=>{var o=e.name?e.name:"";m.displayNotification({message:C.replace(C.get("msg_info_favoriteremoved"),{name1:o}),className:"success"}),s(!0)}).catch(e=>{t._logger.warn("WebService _setFavorites Err : "+e.err),s()}):(t._logger.log("FolderTreeCont favorite folder to remove, not found in list"),s())}).catch(e=>{t._logger.warn("WebService getFavorites Err : "+e.err),s()})});return c.catch(()=>{}),c},renameFavorite:function(e,t,o){var n=this;function i(e,t){e.prepareUpdate(),e.setLabel(t),e.pushUpdate()}function r(){o&&i(o,e.name);let t=C.get("msg_error_rename");m.displayNotification({title:C.replace(t.Title,{name:e.name}),subtitle:t.Advice,message:t.Details,className:"error"}),n.escape()}this.getFavorites().then(s=>{for(var a=s,l=0,d=0;d<a.length;d++){var c=a[d];if(e.id==c.id){c.name=t,l=1;break}}l?n._setFavorites({favoriteFolders:a}).then(r=>{o&&o._instanceType&&"FolderEditor/TreeNodeModel"==o._instanceType||n._rootNodeFavorite.getChildren().forEach(function(o){o&&e.id==o.id&&e.name==o.options.label&&i(o,t)});m.displayNotification({message:C.replace(C.get("msg_info_favoriterenamed"),{name1:e.name,name2:t}),className:"success"}),n.escape()}).catch(e=>{n._logger.warn("WebService _setFavorites Err : "+e.err),r()}):(n._logger.warn("FolderTreeCont favorite folder to rename, not found in list"),r())}).catch(e=>{n._logger.warn("WebService getFavorites Err : "+e.err),r()})},getFavorites:function(e){var o=this,n=e;return new ie(function(i,r){$.getUserPreferences({withTenant:!0,name:"FolderEditorFavoriteFolderList"}).addLinkTo(this).then(a=>{var l=[];if(a.length>0){var d=t.base64Decode(a);(d=JSON.parse(d)).data&&d.data.data&&d.data.data.favorite_folders&&(l=d.data.data.favorite_folders)}for(var c=-1,p=0;p<l.length;p++)"Personal Workspace"==l[p].type&&(c=p),l[p].favoriteTitle=l[p].name;let g=s.resolve();if(-1!=c){var f=UWA.clone(l);f.splice(c,1),(g=o._setFavorites({favoriteFolders:f}).addLinkTo(this)).then(()=>{l=f}).catch(e=>{m.displayNotification({message:C.msg_error_nopreferences,className:"error"}),o._logger.warn("WebService _setFavorites Err : "+e.err)})}g.finally(()=>{e&&e.noAttributes?i(l):function(e,t){return new s((o,n)=>{var i=e&&e.hasOwnProperty("view")?e.view:"None";if(t&&t.length>0){for(var r=[],s=new Map,a=0;a<t.length;a++){var l=t[a];l&&l.id&&(r.push(l.id),s.set(l.id,l))}if(r.length){var d={phids:r,onComplete:function(e){var t=[];if((e="string"==typeof e?JSON.parse(e):e).results)for(var n=0;n<e.results.length;n++){var r=e.results[n];if(r&&r.id){var a=s.get(r.id);r.favoriteTitle=a.favoriteTitle,a.hasOwnProperty("isPersonal")&&(r.isPersonal=a.isPersonal),r.toRemove=!1,"CONTENT"!==i&&(r.name=a.name),t.push(r)}}if(e.inaccessible&&e.inaccessible.length>0)for(n=0;n<e.inaccessible.length;n++){var l=e.inaccessible[n];l&&((a=s.get(l)).toRemove=!0,t.push(a))}o(t)},onFailure:function(){o(t)}};u.getFavoritesProperties(d)}}else o(t)})}(n,l).then(i).catch(r)})}).catch(t=>{e&&!0===e.silent||m.displayNotification({message:C.msg_error_nopreferences,className:"error"}),r(t),o._logger.warn("WebService setPreference Err : "+t.err)})})},_setFavorites:function(e){for(var o=this,n=e.favoriteFolders,i={data:{protocol:"3DXContent",version:"1.0",source:"ENOFOL3_AP",data:{favorite_folders:[]}}},r=0;r<n.length;r++){var s=n[r];if(s.id&&s.name){var a={id:s.id,name:s.name};s.type&&!F.isFolder(s.type)&&(a.type=s.type),a.mxid=s.mxid?s.mxid:void 0,s.isPersonal&&(a.isPersonal=!0),s.inherit&&(a.inherit=!0),i.data.data.favorite_folders.push(a)}}return new ie(function(e,n){i.data.data.favorite_folders.length>30?(m.displayNotification({...C.msg_error_exceedFavoriteLimit,message:C.replace(C.msg_error_exceedFavoriteLimit.message,{maxLimit:30}),className:"error"}),n({})):$.saveUserPreferences({withTenant:!0,name:"FolderEditorFavoriteFolderList",value:t.base64Encode(JSON.stringify(i))}).addLinkTo(this).then(()=>{e(i.data.data.favorite_folders)}).catch(e=>{m.displayNotification({message:C.msg_error_preferencessnotsaved,className:"error"}),o._logger.warn("WebService setPreference Err : "+e.err),n(e)})})},updateTreeWithNewFolder:function(e){var t,o=this,n=this._rootNodePersonal,i=this._rootNodeFolders;if(n&&n.isAscendantOf(e)?e.isVisible()&&(t=e):i&&i.isAscendantOf(e)?e.isVisible()&&(t=e):t=i===e?e:o._getVisibleNodeById(e.id,null),t){let e=!F.isPersonalFolder(t.getType())&&F.isSection(t.getType());u.folderTree({isRoot:e,pid:e?"root":t.id,isPersonalFolder:F.isPersonalFolder(t.options.type),onComplete:function(e){e=JSON.parse(e),"FolderSection_AllFolders"===t.getType()?(o.refreshTreeWithServerData(e.folders,"Workspace",t),R.removeFilters()):o.refreshTreeWithServerData(e.folders,"Workspace Vault",t)},onFailure:function(e){o._logger.log("WebService folders Err : "+e)}})}},refreshTreeWithServerData:function(e,t,o){var n,i,r=_.generateJSON(e),s=o.getChildren().slice(0),a=0;for(UWA.is(s)&&(a=s.length),n=0;n<a;++n)r[(i=s[n]).id]||this.removeFromTree(i),delete r[i.id];let l=F.isRootFolder(t);var d=l?void 0:"subFolders";for(var c in r){i=r[c];var u={useAsyncPreExpand:!0},p=this._getIcon(i,d);u.label=i.label,u.relationOrder=i.TreeOrder,u.relId=i.relId,u.icons=[p],u.children=[],u.id=c,u.mxid=i.mxid,u.type=null==t||l?"Workspace":"Workspace Vault",u.created=i.created,u.folderClassification=i.folderClassification,u.isPersonal=o.isPersonal,this._createTreeNodeModel(u,o)}this._folders_SortElmt.sortingNodesUnsensitiveCase()},removeFromTree:function(e){if(e){var t,o,n=this._rootNodeFolders;if(!(e instanceof g)){e=this._getVisibleNodeById(e.id)}e&&(n&&n.isAscendantOf(e)?e.isVisible()&&(t=e,o=e.getParent()):(t=this._getVisibleNodeById(e.id,null),o=t?t.getParent():null)),o&&t&&(!0===o.hasChildren()&&o.removeChild(t),!1===o.hasChildren()&&(o.withTransactionUpdate(function(){o.setState({state:"collapsed"})}),o.options.children=[])),e&&e.isFavorite&&this.removeFavorite({id:e.getID()})}},updateNodeLabel:function(e,t){var o=this,n=[],i=UWA.is(e,"string")?e:e.physicalid?e.physicalid:null;n=i?this._getNodesById(i):[e];var r=function(e){var t=f.getCurrentBookmarkId();n.forEach(function(o){if(o.getLabel()!==e){o._lastUpdateTime=Date.now();var i=UWA.extend(o.options,{label:e,oldLabel:e},!0);o.withTransactionUpdate(function(){o.updateOptions(i)})}1===n.length&&t===n[0].getID()&&(P.getIdCardCont().setCurrentLocation(),UWA.is(widget)&&widget.setTitle(o.getLabel()))})};if(n.length>0)if(t)r(t),this._folders_SortElmt.sortingChildrenNodes(n[0].getParent());else if(UWA.is(n[0].getID,"function")){var s=n[0].getID();u.getFolderProperties({pid:s,onComplete:function(e){UWA.is(e,"string")&&(e=JSON.parse(e));var t=e.label;r(t),function(e){if(1===n.length){var t=n[0],o="TRUE"===e?c.getWebappsAssetUrl("FolderEditor","icons/folderPublishBadge.png"):"";t.setBadges({bottomRight:o})}}(e.publishOnConnect),function(e){if(widget.getValue("CandABookmark")&&1===n.length){var t=n[0],o=e&&"SHARED"===e.toUpperCase()?c.getWebappsAssetUrl("FolderEditor","icons/approvals.png"):"";t.setBadges({topRight:o})}}(e.folderClassification);var i,a,l,d,u=!1;O.getEnforceFolderLinkSettingAsync(function(e,t){e||(u=t)}),(u||P.isCustomizedEnv()||P.isActiveBookmarkActivated())&&(i=s,a=P.getActiveFolder(),l=a.id,d=a.disabledId,l===i?n[0].setBadges({topRight:p.ICON_ACTIVE}):d===i&&n[0].setBadges({topRight:p.ICON_ACTIVE_DISABLED})),o._folders_SortElmt&&o._folders_SortElmt.sortingChildrenNodes(n[0].getParent())},onFailure:function(){console.error("Unable to update Tree Label, Error in getting folder Properties")}})}},updateNodeAttr:function(e){var t=this;let o=t._getNodesById(e.parentNode.id)[0];var n,i=[];1==e.data.length?(n=e.getId(),i=this._getNodesById(n)):i=e.data,new s((e,n)=>{i&&i.length>0&&o.options.children&&o.options.children.length>0?(o.withTransactionUpdate(function(){i.forEach(function(e){let n=e.TreeOrder;if(e=t._getNodesById(e.id,o)[0]){e._lastUpdateTime=Date.now();var i={relationOrder:n};e.updateOptions(i)}})}),e()):e()}).then(()=>{this._folders_SortElmt._toggleButton("TreeOrder")})},_getSectionByName:function(e){let t=this._rootNodeFolders;switch(e){case"FolderSection_favorite":t=this._rootNodeFavorite;break;case"FolderSection_personal":t=this._rootNodePersonal}return t},_updateFilterIconOnToolbox:function(){this.leftToolbar.updateNodeModel("Filter",{visibleFlag:R.isFilterActives()})},_getExistingPathOfBookmark:function(e,t){let o=this._getVisibleNodeById(e,t),n=null;if(o){let e=o.getParents();e.unshift(o),n=[],e.forEach(e=>{F.isSection(e.getType())||n.unshift({id:e.getID(),mxid:e.options.mxid,type:e.getType(),label:e.getLabel()})})}return n},getSelectedBookmarkPath:function(){let e=null,t=null;return t||(t=f.getCurrentBookmarkId(),e=f.getCurrentBookmarkSection()),t?this.getExistingBookmarkPath(t,e):[]},getExistingBookmarkPath:function(e,t){e=e||f.getCurrentBookmarkId(!0);let o=this.findExistingBookmarkLocation([e],{},t),n=o.expands,i=n.length>0?n[0]:null;if(!i&&o.visibleNodes.length>0){let n=this._getExistingPathOfBookmark(o.visibleNodes[0].getID(),t);n&&((i={})[e]=n)}return i},findExistingBookmarkLocation:function(e,t,o){var n=[];let i=[],r=[];for(var s=0;s<e.length;s++){let a=!1,l=e[s],d=this._getVisibleNodeById(l,o);if(d)a=!0,r.push(d);else if(t&&t.parents){let e=t.parents[l],i=this._getExistingPathOfBookmark(e,o);if(i){a=!0,i.push({id:l,type:t.folderToFindAndSelect.type});let e={};e[l]=i,n.push(e)}}a||i.push(l)}return{expands:n,visibleNodes:r,notFound:i}},expandTreeAndSelectFolder:function(e){if(!1!==e.withLoader){let o=e.onComplete,n=e.onGiveUp,i=e.onFailure;function t(e,...t){q.removeComponentToLoad("treeView","expandAndSelect"),e&&e(...t)}q.addComponentsToLoad("treeView",{expandAndSelect:""}),e.onComplete=t.bind(this,o),e.onGiveUp=t.bind(this,n),e.onFailure=t.bind(this,i)}var o=this;e.folderToFindAndSelect=e.folderToFindAndSelect?e.folderToFindAndSelect:{};var n=e.folderToFindAndSelect.ids,i=!0;if(e.findInTree&&i&&(this.findInTree=!0,e.findInTreeLoader.setMessage(G.loader.formulatingPaths),e.findInTreeLoader.loader.addEventListener(L.POINTERHIT,function(t){if(i=!1,e.onComplete){var o={folderToFindAndSelect:e.folderToFindAndSelect};e.onComplete(o)}})),n&&i){let t=n.indexOf("FolderSection_favorite"),r={notFound:[],visibleNodes:[],expands:[]};t>=0&&n.splice(t,1),n.length>0&&(r=this.findExistingBookmarkLocation(n,e)),t>=0&&r.visibleNodes.push(o._rootNodeFavorite);let a=[];r.expands.forEach(e=>a.push(s.resolve(e)));let l=r.notFound;r.visibleNodes.length>0&&(e.doNotSelectInTree||f.getCurrentBookmarkId()===r.visibleNodes[0].getID()&&(o._scrollToVisibleNode(r.visibleNodes[0]),r.visibleNodes[0].select(!0))),l.length>0&&i&&a.push(new s(t=>{y.getBookmarksPath(l).then(e=>{i&&t(e)}).catch(t=>{o._logger.warn("Unable to retrieve FolderPath using WebService"),e.onFailure&&(t||!1!==e.withLoader)&&e.onFailure(t)})})),e.selectedFolderIdAtInitialState=f.getCurrentBookmarkId(),s.allSettled(a).then(async t=>{if(t.length>0){let o={};if(t.forEach(e=>{if("fullfilled"===e.state)for(var t in e.value)o[t]=e.value[t]}),Object.keys(o).length>0){let e=Object.keys(o)[0],t=o[e],n=this._rootNodeFolders,i=t.length>0&&F.isPersonalFolder(t[0].type)?"root":n.pathId;o[e].forEach(e=>{i=i+","+e.id}),this._folderStructurePreference.add(i,void 0,{exceptLast:!0},!0),await this._waitBookmarkPathReady(i.split(","))}this._expandFolder(0,o,e,i)}else if(e.onComplete){var o={folderToFindAndSelect:e.folderToFindAndSelect};e.onComplete(o)}})}else o._logger.log("expandTreeAndSelectFolder error : folderToFindAndSelect is undefined"),e.onFailure&&e.onFailure("Tree exploration stopped, folderToFindAndSelect is undefined")},_expandParent:function(e,t,o,n,i){var r=t+","+o;i.doNotSelectInTree?(this._folderStructurePreference.scrollAfterSelect(""),this._TreeNodeToBeAddedtoFolderCSOWithoutSelection_pathId=r):this._folderStructurePreference.scrollAfterSelect(o);let a=s.resolve();return"expanding"!==e.getState()&&n&&(a=new s(function(t,o){try{!1!==i.withLoader&&q.addComponentsToLoad("treeView",{tree:""}),e.expand({updateView:!0,postExpandResolvePromise:function(){q.removeComponentToLoad("treeView","tree"),t()}})}catch(e){q.removeComponentToLoad("treeView","tree"),console.log(e),o()}})),a},_expandFolder:function(e,t,o,n){let i=Object.keys(t),r=[];var a=t[i[e]];if(o.findInTree){var l=e/i.length*100;o.findInTreeLoader.updateLoader(l.toString())}if(!a&&t.error&&(this._logger.warn("Unable to retrieve FolderPath using WebService"),o.onFailure))return o.onFailure(t.error);if(!function(e){var t=!1;if(f.getCurrentBookmarkId()!==e.selectedFolderIdAtInitialState&&(t=!0,e.onGiveUp)){var o={folderToFindAndSelect:e.folderToFindAndSelect};e.onGiveUp(o)}return t}(o))if(this._rootNodeFolders){var d=null,c=null,u=this._rootNodeFolders;a.length>0&&"Personal Workspace"==a[0].type&&(u=this._rootNodePersonal);for(var p=u.pathId,g=0;g<a.length;g++){var h=a[g],m=h.id;if((F.isRootFolder(h.type)||F.isPersonalFolder(h.type))&&(c=m),m){if(!d){var v=this._getVisibleNodeById(m,u);v&&v.isVisible()?(u=v,p=v.pathId):d=u}if(d){var _=p;this._folderStructurePreference.add(_,null,null,o.partiallyExpandPath),u=null,p=p+","+m}}else this._logger.log("unexpected undefined parentObjectId")}c?d?r.push(this._expandParent(d,_,i[e],n,o)):console.log("No parent found"):o.onFailure&&o.onFailure(C.msg_error_NoVisibleRootFolder)}else this._logger.log("  No FolderSection_AllFolders to start expandTreeAndSelectFolder"),o.onFailure&&o.onFailure(C.msg_error_TreeExpandCancelledNotReady);e!==Object.keys(t).length-1&&n?(e+=1,s.allSettled(r).then(()=>{this._expandFolder(e,t,o,n)})):s.allSettled(r).then(function(){if(o.onComplete&&n){var e={folderToFindAndSelect:o.folderToFindAndSelect};o.onComplete(e)}})},_getNodesById:function(e,t){var o=[],n=[],i=this;t?o=[t]:i._folders_TreeDocument.getRoots().forEach(function(e){e&&"FolderSection_favorite"!==e.getType()&&o.push(e)});return o.forEach(function(t){t.getID()==e&&n.push(t);var o=t.getChildren();UWA.is(o,"array")&&o.forEach(function(t){i._getNodesById(e,t).forEach(function(e){n.push(e)})})}),n},__getVisibleNodeById:function(e,t){var o=t||this._rootNodeFolders,n=null;if(o&&o.isVisible())if(o.getID()===e)n=o;else if(o.isExpanded()){var i=o.getChildren();if(Array.isArray(i)&&i.length>=1)for(var r=0;r<i.length;r++){var s=i[r];if(s){if(s.id==e){n=s;break}var a=this.__getVisibleNodeById(e,s);if(a&&a.isVisible()){n=a;break}}}}return n},_getVisibleNodeById:function(e,t){var o=null;if("string"==typeof t&&(t=this._getSectionByName(t)),t)o=this.__getVisibleNodeById(e,t);else{var n=[this._rootNodeFolders];this._rootNodePersonal&&n.push(this._rootNodePersonal);for(var i=0;i<n.length&&null===(o=this.__getVisibleNodeById(e,n[i]));i++);}return o},_folderStructurePreference:{_prefixes:["_X_","_P_"],_partialExpandPrefix:"_P_",_removeCollapsed:!0,_collapsedBookmarkTreeMap:new Map,_getID:function(e,t){if(e[t])return e[t];for(var o=0;o<this._prefixes.length;++o){var n=e[this._prefixes[o]+t];if(n)return n}return null},_getPreferenceID:function(e,t){if(e[t])return t;for(var o=0;o<this._prefixes.length;++o)if(e[this._prefixes[o]+t])return this._prefixes[o]+t;return t},_scrollToNode:function(){return"scrollToNode - "+T.getPlatformId()},_getPreferenceTree:function(e){return e||(e={}),e},_getStoredFolderTreeStructure:function(){let e=this._storedStructure;if(!e){e=widget.getValue("folderTreeStructure");try{e=e?JSON.parse(v.jsonUnzip(e)):{}}catch(t){e={}}e=this._getPreferenceTree(e),this._storedStructure=e}return e},add:function(e,t,o,n){var i=this;function r(e,t){for(var o=0;o<i._prefixes.length;++o)if(e[i._prefixes[o]+t])return e[t]=e[i._prefixes[o]+t],void delete e[i._prefixes[o]+t]}if(!o||!0!==o.isFailure){var s=this._getStoredFolderTreeStructure();let d=o&&!0===o.exceptLast;var a=e.split(","),l=s;a.forEach(function(e,o){l[e]||l[i._partialExpandPrefix+e]?!1===t&&(r(l,e),o==a.length-1&&(l[e]={})):!d||o<a.length-1?n&&(!d||o<a.length-1)?l["_X_"+e]?(l[i._partialExpandPrefix+e]=l["_X_"+e],delete l["_X_"+e]):l[i._partialExpandPrefix+e]={}:!function(e,t){for(var o=0;o<i._prefixes.length;++o)if(e[i._prefixes[o]+t])return!0;return!1}(l,e)?l[e]={}:r(l,e):l["_X_"+e]={},o!=a.length-1||n||r(l,e),l=l[e]?l[e]:l[i._partialExpandPrefix+e]}),i.saveFolderStruture(s)}},remove:function(e,t){var o=this,n=this._getStoredFolderTreeStructure(),i=e.split(","),r=n,s=!1;i.forEach(function(e,n){r&&(n<i.length-1?(n==i.length-2&&r[o._partialExpandPrefix+e]&&(s=!0),r=o._getID(r,e)):(!t&&(r[e]&&Object.keys(r[e]).length>0||r[o._partialExpandPrefix+e]&&Object.keys(r[o._partialExpandPrefix+e]).length>0||s)&&(s?r["_X_"+e]=r[e]?r[e]:r[o._partialExpandPrefix+e]:(o._collapsedBookmarkTreeMap.set(e,r[e]),delete r[e])),t&&r["_X_"+e]?delete r["_X_"+e]:r[e]?delete r[e]:delete r[o._partialExpandPrefix+e]))}),o.saveFolderStruture(n)},isExpanded:function(e,t){var o=this,n=this._getStoredFolderTreeStructure(),i=e.split(","),r=!1,s=!1,a=n;i.forEach(function(e,t){a&&t<i.length-1?a=o._getID(a,e):a&&(s=void 0!==a["_P_"+e],r=void 0!==a[e]||s)}),t.call(window,r,s)},recursive:function(e,t,o,n){var i=this;function r(e){return e.replace(i._partialExpandPrefix,"")}var s=null,a=e?Object.keys(e).length:0,l=0===o.length?[]:o[o.length-1];function d(e,t){var n=!!s?s:l;a>1&&!t&&(s=n.slice()),n=t?[]:n,o.indexOf(n)<0&&o.push(n),n.push(e)}for(var c in e){var u=-1!==c.indexOf(i._partialExpandPrefix),p=-1!==c.indexOf("_X_");if(e[c])if(n){var g=-1!==t.indexOf(i._partialExpandPrefix);p?g&&d(c.replace("_X_","")):(u?d(r(c),!g):g&&d(c),this.recursive(e[c],c,o,n))}else p||(u||o.push(r(c)),this.recursive(e[c],c,o,n))}},getExpandedChildren:function(e,t,o,n){var i=this,r=this._getStoredFolderTreeStructure(),s=e.split(","),a=[],l=r;s.forEach(function(e,t){if(l&&t<s.length-1)l=i._getID(l,e);else if(l){var r=i._getID(l,e),d=i._getPreferenceID(l,e),c=-1!==d.indexOf(i._partialExpandPrefix);if(o&&c&&n){var u=d.replace(i._partialExpandPrefix,"");u="FolderSection_AllFolders"===u?"root":u,a.push([u])}i.recursive(r,d,a,o)}}),t.call(window,a)},saveFolderStruture:function(e){ue.call(this,e)},isSelected:function(e){let t=f.getBookmarkSection(e);return f.getCurrentBookmarkId()===e.getID()&&t!==F.TYPE_FAVORITES_SECTION},isSelectValuated:function(){return!!f.getCurrentBookmarkId()},getSelection:function(){return f.getStoredSelection()},scrollAfterSelect:function(e){widget.setValue(this._scrollToNode(),e)},doScrollAfterSelect:function(e){return widget.getValue(this._scrollToNode())===e}},_indexModeforReadData:{_indexInfo:null,_nextStart:0,_infinteScrollinginProcess:!1,isInfiniteScrollingInProcess:function(){return this._infinteScrollinginProcess},setInfiniteScrollingStatus:function(e){this._infinteScrollinginProcess=e},getInfoIndex:function(){return this._indexInfo},getNextStart:function(){return this._nextStart},setNextStart:function(e){this._nextStart=e},resetInfoIndex:function(){this._indexInfo=null,this._nextStart=0,this._infinteScrollinginProcess=!1},setInfoIndex:function(e){this._indexInfo=e||null}},_scrollOnPostUpdateView:function(e){var t=this,o=this._folders_TreeView?this._folders_TreeView:null;o&&o.onPostUpdateViewOnce(function(){if(t._folderStructurePreference.doScrollAfterSelect(e)){let o=t._getVisibleNodeById(e);t._scrollToVisibleNode(o),t._folderStructurePreference.scrollAfterSelect("")}})},_doScrolltotheSavedPosition:function(){var e=this._folders_TreeView;if(e._getScroller()){var t=_.getTreeViewScrollerPosition();void 0!==t.x&&null!==t.x&&void 0!==t.y&&null!==t.y&&e.setScrollerPosition(t)}},_createTreeNodeModel:function(e,t,o){var n=this,i=t instanceof d,r=e.publishOnConnect,s=e.folderClassification;delete e.publishOnConnect,e.grid||(e.grid={});var a=new g(e);if(a.getAttributeValue=(e=>a.options[e]||a[e]),a.id=e.id,a.type=e.type,a.owner=e.owner,e.isFavorite&&(a.isFavorite=!0,a.bookmarkLabel=e.bookmarkLabel,a.getLabel=function(){var e=this.bookmarkLabel;return e&&""!==e||(e=this.Label),e}),e.isPersonal&&(a.isPersonal=!0),e.created&&(a.created=e.created),a._instanceType="FolderEditor/TreeNodeModel",a._loadingcounter=0,a.getID=function(){var e=this.id;return e&&""!==e||(e=this.type),e},a.getType=function(){return this.type},a.options.oldLabel=e.label,a.pathId=(i?"root":t.pathId)+","+a.getID(),"TRUE"===r){var l=c.getWebappsAssetUrl("FolderEditor","icons/folderPublishBadge.png");a.setBadges({bottomRight:l})}if(widget.getValue("CandABookmark")&&"SHARED"===s){l=c.getWebappsAssetUrl("FolderEditor","icons/approvals.png");a.setBadges({topRight:l})}var u=!1;if(O.getEnforceFolderLinkSettingAsync(function(e,t){e||(u=t)}),u||P.isCustomizedEnv()||P.isActiveBookmarkActivated()){var f=P.getActiveFolder(),h=f.id,m=f.disabledId;h===a.id&&!0!==e.isFavorite?a.setBadges({topRight:p.ICON_ACTIVE}):m===a.id&&!0!==e.isFavorite&&a.setBadges({topRight:p.ICON_ACTIVE_DISABLED})}return a.onPostExpand(function(e){if(S.notifyTreeUpdate(),!e||!e.data||!0!==e.data.updateView&&!e.data.onlyUI||e.data.expandLevel){var t=!1;!1!==e.data.clearLast&&e.data.nodeModel.getNodeDepth()-e.data.initialLevel==e.data.expandLevel-1||(t=!0),n._folderStructurePreference.add(this.pathId,t,{isFailure:!0===this.loadHasFailed})}else e.data.postExpandResolvePromise&&e.data.postExpandResolvePromise()}),a.addEventListener("preCollapseAll",function(){n.deactivatePostCollapse=!0}),a.addEventListener("postCollapseAll",function(){n.deactivatePostCollapse=!1,n._folderStructurePreference.remove(this.pathId,!0)}),a.onPostCollapse(function(e){!0===n.deactivatePostCollapse||e.data.updateView||n._folderStructurePreference.remove(this.pathId),S.notifyTreeUpdate()}),ce(a).subscribe({event:"removeChild"},function(e){if(a.isExpanded()&&a.isVisible()){var t=e.nodeModel;!t&&e.data&&(t=e.data.nodeModel),t&&n._folderStructurePreference.remove(t.pathId)}}),ce(a).subscribe({event:"addChild"},function(e){if(a.isExpanded()&&a.isVisible()){var t=e.nodeModel;!t&&e.data&&(t=e.data.nodeModel),t&&t._isExpanded&&n._folderStructurePreference.add(t.pathId)}}),o?(t._virtualNodes||(t._virtualNodes={}),t._virtualNodes[a.getID()]=a):this._addChild(t,a),a},_addChild:function(e,t){let o=this;if(e instanceof d?(e.addRoot(t),this._folderStructurePreference.isExpanded(t.pathId,function(e){e&&t.expand({updateView:!0})})):("partiallyExpanded"===e.getState()&&(o._folderStructurePreference.add(t.pathId),o._folderStructurePreference.remove(t.pathId),o._folderStructurePreference.add(e.pathId)),e.addChild(t)),o._folderStructurePreference.isSelected(t)){for(var n=t;null!=n&&!n.isVisible();)n=n.getParent();n===t?t.select():ce(t.getParent()).subscribeOnce({event:"postExpand"},function(){t.getTreeDocument()&&t.getTreeDocument().getXSO().empty(),t.select()})}else t.pathId===o._TreeNodeToBeAddedtoFolderCSOWithoutSelection_pathId&&(this.findInTree||(f.dispatchBookmarkNodeSelection(t),o._TreeNodeToBeAddedtoFolderCSOWithoutSelection_pathId=void 0));return t},__onContextualMenuReady:function(e){return new s(function(t){var o=e.cellInfos;if(o.cellModel){var n=!1;if(o.nodeModel)if(!1===o.nodeModel._isSelected&&(o.nodeModel._isSelected=!0,f.dispatchBookmarkNodeSelection(o.nodeModel)),!0===o.nodeModel._isSelected)(o.nodeModel?o.nodeModel:o.cellModel)&&(n=!0);n?D.GetContextualMenu(o,"TREE",e).then(function(e){e&&t(e)}):t([])}else t([])})},getSectionNode:function(e){for(var t=null,o=this._folders_TreeDocument.getRoots(),n=0;n<o.length;n++)if(o[n].getType()==e){t=o[n];break}return t},getPersonalFolderSection:function(){return this.getSectionNode("Personal Workspace")},getFavoriteSection:function(){return this.getSectionNode("FolderSection_favorite")},getBookmarkSection:function(){return this.getSectionNode("FolderSection_AllFolders")},refreshOnDelete:function(e){let t=this._getSelectedBookmark();for(var o=!1,n=0;n<e.length;n++){var i=e[n];if(this.isFolderAmongFavoriteFolders({id:i})&&this.removeFavorite({id:i}),t&&i===t.getID()){o=!0;break}if(t&&t.isExpanded()&&t.hasChildren())for(var r=t.getChildren(),s=0;s<r.length;s++){var a=r[s];a.id===i&&this.removeFromTree(a)}}if(!0===o){var l=t.getParent();l&&(this.removeFromTree(t),f.dispatchBookmarkNodeSelection(l))}E.publish("FolderEditor.ActiveFolderCheck",{})},refreshOnNew:function(e){let t=this._getSelectedBookmark();if(t){let n=t.isFavorite?this._getVisibleNodeById(t.getID()):t;var o="partiallyExpanded"===n.getState();null!==n&&n.isExpanded()&&!o?this.updateTreeWithNewFolder(n):!0===t.isFavorite||t.isExpanded()&&!o||!0!==e.expandCurrent||t.expand()}},refreshView:function(e){e&&!0===e.creation?this.refreshOnNew(e):this.refreshAll()},refreshAll:function(){if(!this._folderStructurePreference.isSelectValuated()){let e=this._getSelectedBookmark();e&&e.unselect(),f.dispatchBookmarkNodeSelection(this._rootNodeFolders)}this._rootNodeFavorite.isExpanded()&&(this._rootNodeFavorite.collapse({updateView:!0}),this._rootNodeFavorite.expand({updateView:!0})),this._rootNodePersonal&&this._rootNodePersonal.isExpanded()&&(q.addComponentsToLoad("treeView",{personalTree:""}),this._rootNodePersonal.collapse({updateView:!0}),this._rootNodePersonal.expand({updateView:!0})),this._rootNodeFolders.isExpanded()&&(q.addComponentsToLoad("treeView",{tree:""}),this._rootNodeFolders.collapse({updateView:!0}),this._rootNodeFolders.expand({updateView:!0}))},switchFolderTreeNodeLabelToWriteView:function(e){try{var t=!1;if(e instanceof g&&F.inFamilyFolder(e.getType())&&e.getTreeDocument()===this._folders_TreeDocument&&this._folders_TreeView){var o=this._folders_TreeView;if(o){var n=o.layout.getColumnIndex("tree"),i=o.layout.getCellsFromNodeModel(e)[n];o.setCellInEdition(i),t=!0}}return t}catch(e){}},getFindInTreeIcon:function(){return this._folders_FindInTree.elements.container},_scrollToVisibleNode:function(e){var t=this._folders_TreeView,o=t.layout.getColumnIndex("tree"),n=t.layout.getCellsFromNodeModel(e)[o];t.scrollToCellAt({cellID:n})},modeChange:function(e){if(!1!==widget.getValue("compactModeForLeftSidebar")){var t=this._folders_TreeView.layout.cellHeight,o=t;if("comfortable"===e.viewMode)o=38,this._folders_FindInTree.elements.container.setStyle("height",38),this.elements.container.setAttribute("Compact",!1),this.elements.container.getElement("#folder-common-tool-Section").setAttribute("Compact",!1);else{if("compact"!==e.viewMode)return;o=26,this._folders_FindInTree.elements.container.setStyle("height",23),this.elements.container.setAttribute("Compact",!0),this.elements.container.getElement("#folder-common-tool-Section").setAttribute("Compact",!0)}var n=o!==t;this._folders_TreeView.layout.cellHeight=o,n&&this._folders_TreeView.updateView(!0)}},activateTreeFilter:function(e){if(e!=A.getSetting("activateTreeFilter")){A.setSetting("activateTreeFilter",e);var t=P.getContent();e?(UWA.extendElement(t.elements.padshell._leftPanel).addClassName("FolderEditor_LeftView_Select"),UWA.extendElement(this._commonToolSection).addClassName("folder-common-tool-Section_Select")):(UWA.extendElement(t.elements.padshell._leftPanel).removeClassName("FolderEditor_LeftView_Select"),UWA.extendElement(this._commonToolSection).removeClassName("folder-common-tool-Section_Select")),S.notifyTaggerStatusChange()}},getCommonToolSection(){return this._commonToolSection},getGridViewRowHeight:function(){let e=_.densityHeight.compact,t=this._folders_TreeView.layout;return t&&(e=t.getRowHeight()),e}});return pe}),define("DS/FolderEditor/views/customize_views/FolderDGVParametrization",["UWA/Class","UWA/Promise","DS/Utilities/Utils","DS/Core/PointerEvents","DS/FolderEditor/utils/xBookCustoStorageOptim","DS/PADUtils/Configuration","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/DictionaryAccess","DS/FolderEditor/service/FolderServices","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/utils/FolderEditorUtil","DS/WidgetServices/WidgetServices","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/tagger/TaggerContentProxy","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/Folder_CSO"],function(e,t,o,n,i,r,s,a,l,d,c,u,p,g,f,h,m){"use strict";function v(e,t,o,n,i){var r=c.inFamilyFolder(o.getType()),s=c.inFamilyFolder(n.getType());let a=!1,l=!1;if(r&&!s)return-1*this.reverseFactor;if(!r&&s)return 1*this.reverseFactor;var d=0;if("defaultSort"===i){var p=o.options.relationOrder?o.options.relationOrder:0,g=n.options.relationOrder?n.options.relationOrder:0;if(d=p-g,r&&s&&0!=d){if(a="TRUE"==o.options.grid.isLinkedFolder,l="TRUE"==n.options.grid.isLinkedFolder,!a&&l)return-1;if(a&&!l)return 1;a||l||(e=p,t=g,d=0)}else e=o.getAttributeValue("label"),t=n.getAttributeValue("label")}return o&&o.options&&o.options.gridValue&&o.options.gridValue[i]&&(e=o.options.gridValue[i]),n&&n.options&&n.options.gridValue&&n.options.gridValue[i]&&(t=n.options.gridValue[i]),0==d?u.compareLabels(e,t):d}return e.extend({buildDGVOpts:function(e){var o=this;return e=e||{},new t(function(t){var n,l=function(e){var n=UWA.clone(r.getConfig("dgvOptions")),i=n&&n.dgv?n.dgv:{};if(e=UWA.extend(i,e),o.options.additionalColumnsModules){var l=[];let t=UWA.clone(e.columns);for(var d=0;d<o.options.additionalColumnsModules.length;d++)UWA.is(o.options.additionalColumnsModules[d].getAdditionalColumnsUXDGV,"function")&&(o.options.additionalColumnsModules[d].getAdditionalColumnsUXDGV(e.columns),l=l.concat(o.options.additionalColumnsModules[d].getManagedColumnNames()));for(let o=0;o<e.columns.length;o++)t[o]&&t[o].dataIndex===e.columns[o].dataIndex&&(e.columns[o].visibleFlag=t[o].visibleFlag);var u=function(e){for(var t={},o=0;o<e.length;o++){var n=e[o];t[n.dataIndex]=void 0!==n.visibleFlag&&!n.visibleFlag}return t}(e.columns);l.length&&(function(e,t,o){for(var n=0;n<e.length;n++){var i=e[n];-1!==t.indexOf(i.dataIndex)&&(i.isAdditionalColumn=!0),void 0!==o[i.dataIndex]&&(i.visibleFlag=!o[i.dataIndex])}}(e.columns,l,u),function(e){for(var t=0;t<e.length;t++){var o=e[t],n=o.customisation;n&&n.layout&&o.visibleFlag!==!n.layout.hidden&&(n.layout.hidden=!o.visibleFlag)}}(e.columns))}if(e.selectionBehavior.toggle=!1,e.infiniteScrolling=!0,e.onContextualEvent=o._onContextualEvent.bind(o),e.onDelayedModelDataRequest=o.options.context.updateAttributesDelayed.bind(o.options.context),o.options.callbacks){var p=Object.keys(o.options.callbacks);for(d=0;d<p.length;d++)e[p[d]]=o.options.callbacks[p[d]]}e.columns.push({dataIndex:"defaultSort",visibleFlag:!1,customisation:{exportable:{lock:!0,value:!1},layout:{removable:!1}}}),e.columns.forEach(function(e){if("tree"===e.dataIndex&&(e.getCellKPIColor=f.getCellKPIColor.bind(f)),"favoriteTitle"===e.dataIndex){var t=m.getSelectedBookmark();t&&c.isFavoriteSection(t.getType())?(e.customisation.layout.removableFromView=!0,e.visibleFlag=!0):(e.customisation.layout.removableFromView=!1,e.visibleFlag=!1)}"bookmarkLocation"===e.dataIndex&&(g.isSearchActive()?(e.customisation.layout.removableFromView=!0,e.visibleFlag=!0):(e.customisation.layout.removableFromView=!1,e.visibleFlag=!1)),e.compareFunction=v,e.onCellRequest=function(e){if(!e.isHeader){e.nodeModel&&e.nodeModel.options.isBeingCut?e.cellView.getContent().addClassName("pad-state-is-being-cut"):e.cellView.getContent().removeClassName("pad-state-is-being-cut");var t=this.getColumnOrGroup(e.columnID);let n=o.options.dgv.layout.getDisplayedColumnsIndexes();if(n&&n.indexOf(e.columnID)>=0)for(let n=0;n<o.options.additionalColumnsModules.length;++n)if(o.options.additionalColumnsModules[n]._columnDataIndex&&o.options.additionalColumnsModules[n]._columnDataIndex[0]===t.dataIndex&&o.options.additionalColumnsModules[n].onCellRequest&&o.options.additionalColumnsModules[n].onCellRequest(e))return;t&&"boolean"===t.typeRepresentation&&(e.cellModel="string"==typeof e.cellModel?"TRUE"===e.cellModel:e.cellModel)}if(e.nodeModel){var n=e.nodeModel.options.icons;n&&n.length>0&&"string"==typeof n[0]&&(e.nodeModel.options.icons=[{iconPath:"url("+n[0]+")"}])}this.defaultOnCellRequest(e)}}),a.updateColumnsWithNLS(e.columns,function(n){"success"===n.status&&(e.columns=n.columns),s.updateAttributesList(e.columns),o.completeDGVOptions(e).then(t)})};o.options.view_customization&&!0!==e.reset&&!0!==o.options.view_customization.custoFromTree?(!0===o.options.view_customization.custoOptimized&&(o.options.view_customization=i.convertPreference2Custo(o.options.view_customization,"datagridview")),(n=o.options.view_customization).columns=o.buildColumnsFromStorage(n.columns).then(function(e){n.columns=e,l(n)})):(n={},o.buildColumns("datagridview").then(function(e){n.columns=e.columns,l(n)}))})},completeDGVOptions:function(e){return t.resolve(e)},completeCB:function(){return t.resolve()},addColumnCB:function(e){var o=this;this.options.dgv.prepareUpdateView();var n=[];e.forEach(function(e){e&&e.convertInfos&&e.convertInfos.dimension&&(e.kind="string"),n.push(new t(function(t){s.addAvailableColumn(e.dataIndex,e).then(function(e){var n=o.buildColumnFromSetting(e);n&&(n.compareFunction=v,o.options.dgv.addColumnOrGroup(n),"thumbnail"===n.dataIndex&&(o.options.dgvLayout.cellHeight=80)),t()})}))}),t.all(n).then(function(){this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)}.bind(this))},removeColumnCB:function(e){var t=this;this.options.dgv.prepareUpdateView(),e.forEach(function(e){var o=UWA.is(e,"string")?JSON.parse(e):e,n=t.options.dgv.getColumnOrGroup(o.dataIndex);n&&void 0!==n.dataIndex&&(t.options.dgv.removeColumnOrGroup(o.dataIndex),"thumbnail"===o.dataIndex&&(t.options.dgvLayout.cellHeight=38,t.options.dgvLayout.columnHeaderHeight=38,"compact"===t.options.viewMode&&(t.options.dgvLayout.cellHeight=26,t.options.dgvLayout.columnHeaderHeight=26)),s.removeAvailableColumn(o.dataIndex))}),this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)},changeTitleCB:function(e,t){var o=this.options.dgv.getColumnOrGroup(e);o&&(this.options.dgv.prepareUpdateView(),o.text=t,o.customisation.titleModified=!0,this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0},!0))},changeDBAttributeCB:function(e){if(e&&0!=e.length){var t=this;this.options.dgv.prepareUpdateView(),e.forEach(function(e){var o=t.options.dgv.getColumnOrGroup(e.dataIndex);o&&void 0!==o.dataIndex&&(o.attrDBName=e.attrDBName)}),this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)}},changeVisibilityCB:function(e,t){this.options.dgvLayout.setColumnVisibleFlag(e,t,{isUserInteraction:!0})},changePinCB:function(e,t){this.options.dgvLayout.setColumnPinned(e,t,{isUserInteraction:!0})},moveColumnCB:function(e){if(e.move2perform){let t=e.move2perform.fromIndex?e.move2perform.fromIndex:e.move2perform.fromID,o=e.move2perform.toIndex?e.move2perform.toIndex:e.move2perform.toID;this.options.dgvLayout.moveColumn(t,o,{isUserInteraction:!0})}},changeDgvLayout:function(e){void 0!==typeof e.rowsHeader&&(this.options.dgvLayout.rowsHeader=e.rowsHeader)},changeExportCB:function(e,t){var o=this.options.dgv.getColumnOrGroup(e);o&&(o.customisation.exportable={lock:!1,value:t})},compactMode:function(e){"comfortable"===e.viewMode?(this.options.dgvLayout.cellHeight=38,this.options.dgvLayout.columnHeaderHeight=38,this.options.viewMode="comfortable"):"compact"===e.viewMode&&(this.options.dgvLayout.cellHeight=26,this.options.dgvLayout.columnHeaderHeight=26,this.options.viewMode="compact")},saveCustoView:function(e){var t=this;this._prepareOptsToStore({onComplete:function(o){var n=e?"onCustoViewChange":"onSaveAsTemplate";t.options.context.dispatchEvent(n,o)}})},reset:function(e){return new t(function(t){var o=this;delete o.options.view_customization,this.buildDGVOpts({reset:!0}).then(function(n){var i=r.getConfig("dgvOptions")?r.getConfig("dgvOptions"):{};o.options.dgv.prepareUpdateView(),i.dgvLayout&&(o.options.dgvLayout.cellHeight=i.dgvLayout.cellHeight,o.options.dgvLayout.columnHeaderHeight=i.dgvLayout.cellHeight,o.options.dgvLayout.rowsHeader=i.dgvLayout.rowsHeader),o.changePinCB(o.ctxColOpts.dataIndex,"right"),n.columns.push(o.ctxColOpts),o.ctxColOpts.visibleFlag=!0,o.options.dgvLayout.deleteDataGridViewPreferences(),o.options.dgv.columns=n.columns,o.options.viewMode=i.viewMode;var s=h.getTreeCont();s&&s.modeChange({viewMode:o.options.viewMode}),o.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!1},!0),o.options.dgvLayout.applyColumns(),o.saveCustoView(e),t()})}.bind(this))},_onContextualEvent:function(e){return new t(function(t){d.getCtxMenu(e).then(function(e){t(e)})})},eventHandlerOnGridView:function(e){var o=this;return new t(function(t){e.addEventListener("click",function(e,t){if(void 0!==t&&-1!==t.rowID){var n=e.dsModel.layout.getDataIndexFromColumnIndex(t.columnID);if(o.options.clickEvent[n])o.options.clickEvent[n](t);else if(o.options.additionalColumnsModules&&!0===e.dsModel.layout.getColumnOptionValue(t.columnID,"isAdditionalColumn"))for(var i=0;i<o.options.additionalColumnsModules.length;i++){if(o.options.additionalColumnsModules[i].getOnCellClickCB){var r=o.options.additionalColumnsModules[i].getOnCellClickCB(n,e);if(r){r(t);break}}}}}),e.addEventListener("userPreferencesChange",function(e){o.saveCustoView(!0)}),e.addEventListener("columnWidthChange",function(e){if(e&&e.dsModel&&e.dsModel.layout&&o.options&&o.options.dgv&&o.options.dgv.layout&&o.options.dgv.model){let t=e.dsModel.layout.getDataIndexFromColumnIndex(e.options.columnID),n=o.options.dgv.layout.getDisplayedColumnsIndexes();if(n&&n.indexOf(e.options.columnID)>=0)for(let n=0;n<o.options.additionalColumnsModules.length;++n)if(o.options.additionalColumnsModules[n]._columnDataIndex&&o.options.additionalColumnsModules[n]._columnDataIndex[0]===t&&o.options.additionalColumnsModules[n].updateAttributesOnResize){let t=o.options.dgv.layout.getMinMaxVisibleRowIDs(),i=t.minRowID,r=t.maxRowID,s=[];(s=r>=0?o.options.dgv.model.slice(i,r+1):o.options.dgv.model.slice(i,r)).length>0&&o.options.additionalColumnsModules[n].updateAttributesOnResize(s,e.options.columnID);break}}}),e.addEventListener(n.POINTERHIT,function(e,t){if(2===e.multipleHitCount&&t&&-1!==t.rowID){var o=t.nodeModel;if(o)if(o.isFavorite&&o.toRemove){var n=function(e){e&&require(["DS/PADServices/utils/GlobalModelEvents"],function(e){e.publish({event:"remove_favorite",data:{id:o.options.resourceid,name:o.options.favoriteTitle}})})};require(["DS/FolderEditor/popup/RemoveFromFavoritesPopup"],function(e){new e({callback:n,favorite:o})})}else d.activateFolderEditorItem(o);require(["DS/IPClassifyUtil/IPClassifyCommunication"],function(e){if(!0===widget.getValue("noCompass")){var t={id:o.getID(),label:o.getLabel(),type:o.options.type,cadMaster:o.options.grid["ds6w:cadMaster"],kind:o.options.grid["ds6w:kind"],contentStructure:o.options.grid["ds6w:contentStructure"]};e.publish("doubleClickonContentInBookmark",t)}})}}),o.completeCB(e).then(t)})},_prepareOptsToStore:function(e){var t=this;o.debounce(function(e){for(var o=t.options.dgvLayout.getOrderedColumnsIndexes(),n=[],r=[],s={},a=0;a<o.length;a++){var l=t.options.dgv.getColumnOrGroup(o[a]);"defaultSort"===l.dataIndex?r.push(l):"ContextualMenuColumn"!==l.dataIndex?(n.push(l),!0===l.customisation.titleModified&&(s[l.dataIndex]=!0)):t.ctxColOpts&&n.push(t.ctxColOpts)}var d={viewMode:t.options.viewMode,defaultCellHeight:t.options.dgvLayout.cellHeight,defaultcolumnHeaderHeight:t.options.dgvLayout.columnHeaderHeight,rowsHeader:t.options.dgvLayout.rowsHeader,columns:n,sortModel:t.options.dgv.sortModel},c=i.convertCusto4Preference(d,s,"datagridview");r.forEach(e=>n.push(e)),t.options.dgv.columns=n,e.onComplete(c)},500)(e)}})}),define("DS/FolderEditor/views/FolderDataGridView",["UWA/Core","UWA/Promise","UWA/Class","UWA/Class/Options","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/PADUtils/PADCommandProxy","DS/FolderEditor/views/customize_views/FolderDGVParametrization","DS/FolderEditor/views/customize_views/_FolderDGVUtils","DS/PADUtils/Configuration","DS/FolderEditor/utils/FolderSearch","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/commands/FolderCommands","DS/FolderEditor/utils/FolderEditorKeyboardListener","DS/FolderEditor/ActionBar/FolderCommandManager","DS/FolderEditor/utils/FolderEditorUtil","DS/CollectionView/commands/CollectionViewCommands","DS/PADServices/utils/GlobalUtils","DS/Controls/Button","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/AttributesMgtV2","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/views/additionalColumns/BookmarkLocationColumn","DS/FolderEditor/views/FolderMode","DS/FolderEditor/Folder_CSO","DS/IPClassifyUtil/DimensionUtils","DS/ApplicationFrame/CommandsManager"],function(e,t,o,n,i,r,s,a,l,d,c,u,p,g,f,h,m,v,_,S,C,b,F,y,D,E,w){"use strict";var A=new g,T=null;return o.extend(n,a,l,{name:"FolderTreeListView",defaultOptions:{renderTo:null,context:null,modelEvents:null,subscribeTokens:[],dgv:null,dgvLayout:null,viewMode:"",clickEvent:{"ds6w:reserved":function(e){this.returnCommand(e,"ds6w:reserved")},"ds6w:status":function(e){this.returnCommand(e,"ds6w:status")},"ds6w:responsible":function(e){this.returnCommand(e,"ds6w:responsible")},returnCommand:function(e,t){if(e.nodeModel){let o=0;!1===e.nodeModel.isSelected()&&(e.nodeModel.select(),o=250),setTimeout(()=>{var o;if("ds6w:reserved"==t){let t=e.nodeModel.getReferenceValue("ds6w:reserved");o="ActionBar_ReserveCmd",!0===("boolean"==typeof t?t:"TRUE"===t.toUpperCase())&&(o="ActionBar_UnreserveCmd")}else"ds6w:status"==t?o="MaturityHdr":"ds6w:responsible"==t&&(o="ActionBar_TransferOwnership");var n=w.getCommand(o);n&&n.isEnabled()&&n.begin()},o)}}},doubleClickEvent:{}},init:function(e){this._parent(e),this.setOptions(e),S.subscribe({event:"updateColumnVisibility"},e=>{let t=e.columnName,o=e.visibility;var n=this.options.dgv.getColumnOrGroup(t);n&&(n.visibleFlag=o,"bookmarkLocation"!==t&&"favoriteTitle"!==t||(n.customisation.layout.removableFromView=o,n.customisation.exportable={lock:!o,value:o}))})},initialize:function(){var o=this;return new t(function(n){var a=e.clone(d.getConfig("dgvOptions"));o.options.viewMode=a.viewMode;var l=u.getPlaceholder(),p=o.buildDGVOpts();t.all([l,p]).then(function(t){var l=t[1],d=t[0],p=!1!==o.options.context.options.settings.view_settings.sortPersistence;p||(l.sortModel=[{dataIndex:"defaultSort",sort:"asc"}]);var g=e.extend({identifier:"DataGridView-"+o.name+"-"+widget.id},l);if("undefined"!==a.dgvLayout){var f=e.clone(a.dgvLayout);void 0!==l.defaultCellHeight&&(f.cellHeight=l.defaultCellHeight,l.defaultCellHeight<80&&(f.columnHeaderHeight=l.defaultCellHeight),delete l.defaultCellHeight),!window.__karma__&&navigator.webdriver&&(l.rowsHeader=!0),void 0!==l.rowsHeader&&(f.rowsHeader=l.rowsHeader,delete l.rowsHeader),l.columns.forEach(function(e){e.minWidth=50}),g.layout=o.options.dgvLayout=new r(f),g.layout.useLastColumnWidthAutoFlag=!0}g.placeholder=d.getContent();var m=null,v=!0;g.columns.forEach(function(e,t){"ContextualMenuColumn"===e.dataIndex&&(m=t,v=e.visibleFlag)}),null!==m&&g.columns.splice(m,1),g.showContextualMenuColumnFlag=!0,g.useAsyncPreExpand=!0,g.rowSelection=o.options.multiselection?"multiple":"single",o.options.dataGridPlaceHolder=g.placeholder,o.options.viewMode=l.viewMode?l.viewMode:"comfortable";var _=u.getTreeCont();_&&_.modeChange({viewMode:o.options.viewMode});var C=o.options.dgv=new i(g);if(o.options.additionalColumnsModules)for(var b=0;b<o.options.additionalColumnsModules.length;b++)if(o.options.additionalColumnsModules[b].getTypeRepresentations){var D=o.options.additionalColumnsModules[b].getTypeRepresentations();C.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(D))}C.selectNextCellOnEnterFlag=!1,C.setUseClipboardFlag(!1),C.onEndResizeOrOnReadyModelRequest(function(e){u.getContent()&&e.RowMaxNumber>=c.getNumberResults()&&e.RowMaxNumber>=C.getModelLength()&&(e.reachBottom=!0,u.getContent().processForInfiniteScroll(e,C)),C.EndResizeOrOnReadyModelRequestDone()}),o.ctxColOpts=C.getColumnOrGroup("ContextualMenuColumn"),o.ctxColOpts&&(o.options.dgv.prepareUpdateView(),o.ctxColOpts.visibleFlag=v,o.ctxColOpts.customisation={exportable:{lock:!0,value:!1},layout:{pinEditable:!0,removable:!0}},o.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0},!0));var E=h.getContentSortmodel();l.sortModel=!p||l.sortModel?l.sortModel:E,l.sortModel&&(o.options.dgv.prepareUpdateView(),o.options.dgv.sortModel=l.sortModel,o.options.dgv.layout.saveColumnSortModelInPreferences(),o.options.dgv.pushUpdateView({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1},!0)),C.onCopy=A.launchKeyAction.bind(A,"ctrl+c"),C.onCut=A.launchKeyAction.bind(A,"ctrl+x"),C.onPaste=A.launchKeyAction.bind(A,"ctrl+v");["esc","del","ctrl+f","alt+return","f2"].forEach(function(e){C._keymapManager.registerKeymap(e,void 0)}),C.addEventListener("sortModelChange",function(){if(c.isSearchActive()||"read"==y.getCurrentModeType()){var e=u.getContent();let t=e.getCurrentMode();t.isInfiniteScrollingEnded()||(t.resetInfoIndex(),e.loadContentAndSelect())}}),C.onInfiniteScroll(function(e){u.getContent().processForInfiniteScroll(e,C)}),o._commandProxy=s.create(),o.eventHandlerOnGridView(C).then(function(){C.getContent().addClassName(o.name),o.options.renderTo&&!0===o.options.isActiveView&&C.inject(o.options.renderTo),n()}),S.getModelEvents().subscribe({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification"},function(t){switch(t.what){case"addRemoveColumns":t.removedColumns&&t.removedColumns.length>0&&o.removeColumn(t.removedColumns),t.addedColumns&&t.addedColumns.length>0&&o.addColumn(e.clone(h.filterDBOnlyAttrs(t.addedColumns)));break;case"reset":o.resetColumn()}}),S.getModelEvents().subscribe({event:"nodeColorUpdated"},function(){C.invalidateLayout({updateCellContent:!0,updateCellLayout:!0})}),C.registerReusableCellContent(F.getCellReusableContent())})})},escape:function(){this.options.dgv.commands.escape.bind(this.options.dgv)()},getManager:function(){return this.options.dgv},addColumn:function(e){e.length>0&&(T=null,c.addPredicates(e),b.notifyCurrentFolderColumnChange())},removeColumn:function(e){c.removePredicates(e)},resetColumn:function(){c.setPredicates(C.getAvailableColumnsOpts()),b.notifyCurrentFolderColumnChange()},setModel:function(e){this.options.dgv.getContent().inject(this.options.renderTo),this.options.isActiveView=!0,this.options.dgv.treeDocument=e},unsetModel:function(){this.options.isActiveView&&(this.options.renderTo.removeChild(this.options.dgv.getContent()),this.options.isActiveView=!1,this.options.dgv.treeDocument=null)},isColumnHidden:function(e){return!this.options.dgv.layout.getColumnVisibleState(e)},showColumn:function(e){this.changeVisibilityCB(e,!0)},hideColumn:function(e){this.changeVisibilityCB(e,!1)},changeColumnTitle:function(e,t){this.changeTitleCB(e,t)},getDatagridPlaceHolder:function(){return this.options.dataGridPlaceHolder},getFontDetails:function(){var e=this.options.dgv,t=12,o=10;e&&e.layout&&e.layout.collectionView&&e.layout.collectionView._getCurrentTouchMode()&&(t=14,o=20);var n="Ariel";if(e&&e.layout&&e.layout.collectionView){let o=e.layout.collectionView.elements.leftPoolContainer;if(o){let e=o.getElementsByClassName("wux-tweakers-string-label");if(e&&e.length>0){let o=e[0];t=(t=o.getStyle("font-size"))?parseInt(t.replace("px","")):12,n=o.getStyle("font-family")}}}return{fontSize:t,fontMargin:o,fontSytle:n}},getColumnWidth:function(e){var t=0,o=this.options.dgv;return o&&o.layout&&o.layout.getColumnWidth&&(t=o.layout.getColumnWidth(e)),t},getRowHeight:function(){var e=0,t=this.options.dgv;return t&&t.layout&&t.layout.getRowHeight&&(e=t.layout.getRowHeight()),e},scrollToVisibleNode:function(e){var t=this.options.dgv,o=t.layout.getColumnIndex("tree"),n=t.layout.getCellsFromNodeModel(e)[o];t.scrollToCellAt({cellID:n})},getColumnsUnitNls:function(){let e=T;if(!e){e={};var t=this.options.dgv;let n=null;if(t&&t.layout&&t.layout.getLeafColumns){let i=t.layout.getLeafColumns();for(var o=0;o<i.length;++o){let t=null;i[o].convertInfos&&(t=i[o].convertInfos.nls),i[o].convertInfos&&i[o].convertInfos.manipulationUnit&&i[o].convertInfos.manipulationUnit!==i[o].convertInfos.unit&&(n=i[o].convertInfos.manipulationNls,t=null),e[i[o].dataIndex]={unit:t,convertUnit:n||t}}}}return e},getManipulationUnitColumns:function(){let e=[];var t=this.options.dgv;if(t&&t.layout&&t.layout.getLeafColumns){let n=t.layout.getLeafColumns();for(var o=0;o<n.length;++o)n[o].convertInfos&&n[o].convertInfos.manipulationUnit&&n[o].convertInfos.manipulationUnit!==n[o].convertInfos.unit&&e.push(n[o])}return e},getManipulationUnitVisibleValues:function(t,o){let n=[];var i=this.options.dgv;if(i&&i.model&&i.layout){var r=i.layout.getMinMaxVisibleRowIDs();if(r&&r.hasOwnProperty("minRowID")&&r.hasOwnProperty("maxRowID"))for(var s=r.minRowID;s<=r.maxRowID;++s){let r=i.model[s];if(o&&r.getID()!==o)continue;let a=(r.grid||r.options.grid)[t];if(e.is(a,"array")?n=n.concat(a):a&&n.push(a),o&&r.getID()===o)break}}return n},enrichSearchValue:function(e){let o=this;return new t(function(t){var n=o.options.dgv;e&&n&&n.layout&&n.layout.getLeafColumns||t(e);let i=e;if(-1!==e.indexOf(":")){let o=e.substr(0,e.indexOf(":")),s=o,a=e.substr(e.indexOf(":")+1,e.length),l=n.layout.getLeafColumns(),d=null;for(var r=0;r<l.length;++r)if(l[r].text===o){if(s="["+l[r].dataIndex+"]",l[r].convertInfos&&l[r].convertInfos.manipulationUnit&&l[r].convertInfos.manipulationUnit!==l[r].convertInfos.unit){(d={}).Data=[];let e={};e.Dimension=l[r].convertInfos.dimension,e.UnitFrom=l[r].convertInfos.manipulationUnit,e.UnitTo=l[r].convertInfos.unit,e.Values=a,d.Data.push(e)}break}i=i.replace(o,s),d?E.convertToPreferdUnits(d).then(function(e){e&&0!==e.length||t(i),t(s+":"+e[0].ConvertedValues)}):t(i)}else t(i)})}})}),define("DS/FolderEditor/FolderXNavComponent",["DS/FolderEditor/infra/xBookComponent","DS/PADUtils/PADSession","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,o){"use strict";return t.softInit(!0),e.extend({name:"pad_component",init:function(e){var t,o,n=(t=e,(o={x3dAppId:"ENOPAD",widget:widget,amd_custo:{TreeDocument:"DS/FolderEditor/FolderTreeDocument",TreeListView:"DS/FolderEditor/views/FolderTreeListView",TileGridView:"DS/FolderEditor/views/FolderTileView",ThumbnailGridView:"DS/FolderEditor/views/FolderThumbnailView"},layout:{}}).layout=UWA.clone(t.layout_opts),delete(o=UWA.extend(o,t,!0)).layout_opts,o);this._parent(n),this.setFolderCommunicationChannel()},render:function(){return this},getPADTileGridView:function(){return this.options.views.tileview},getPADThumbnailGridView:function(){return this.options.views.thumbnailview},getEditMode:function(){return require("DS/PADUtils/PADSettingsMgt").getSetting("EditModeActivated")},addRootNodes:function(e){if(!UWA.is(e,"array"))throw new Error("nodes parameter must be an array");var t=[],o=this.options.model;o&&o.wrapInTransaction(function(){o.withTransactionUpdate(function(){o.addRoot(e);for(var n=0;n<e.length;n++){let o=e[n];t.push(o.getID()),!1===o.bkTempVisible&&o.filterOut()}o.getRoots().length;UWA.is(o.detachedRoots,"array")&&o.detachedRoots.length,o.getModelEvents().publish({event:"onRootAdded",data:{nb_root:o.getRoots().length,added_node:e[o.getRoots().length-1]}})})})},getSelectedNodes:function(){return this.options.model.getSelectedNodes()},getActiveView:function(){return this.options?this.options.active_view:"datagridview"},_dispatchReady:function(){!0===this.options.isReady.model&&!0!==this.options.isReady.PADmodel&&(this.options.isReady.PADmodel=!0),!0===this.options.isReady.model&&this._probes.probe_model.end(),!0===this.options.isReady[this.options.active_view]&&this._probes.probe_view.end(),!0===this._dispatchReady_NotDone&&!0===this.options.isReady.model&&!0===this.options.isReady[this.options.active_view]&&(this.dispatchEvent.call(this,"onReady"),this.dispatchEvent("onActionBarReadyToBuild"),this._probes.probe_init.end(),this._dispatchReady_NotDone=!1)}})}),define("DS/FolderEditor/FolderComponent",["UWA/Core","DS/Logger/Logger","DS/WebappsUtils/WebappsUtils","DS/FolderEditor/FolderXNavComponent","DS/FolderEditor/models/xBookNodeModel","DS/TreeModel/TreeNodeModel","DS/FolderEditor/views/FolderGlobalActiveBookmark","DS/FolderEditor/service/FolderEditorWebService","DS/FolderEditor/utils/FolderEditorUtil","DS/FolderEditor/service/FolderDnDServices","DS/FolderEditor/service/FolderTypeService","DS/FolderEditor/service/FolderServices","DS/FolderEditor/commands/FolderCommands","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/FolderEditor/Folder_CSO","DS/IPClassifyUtil/IPClassifyAlert","DS/FolderEditor/utils/BkAlert","i18n!DS/FolderEditor/assets/nls/FolderEditor","i18n!DS/SNResultUX/assets/nls/SNResultUX","DS/FolderEditor/utils/FolderEditorcontrol","DS/FolderEditor/Folder_Clipboard","DS/FolderEditor/utils/FolderEditorEvents","DS/FolderEditor/utils/FolderSearch","DS/LifecycleServices/LifecycleServicesSettings","DS/WidgetServices/UIInfra/UIInfra","DS/WidgetServices/WidgetServices","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADProbes","DS/PADServices/utils/AttributesMgtV2","DS/FolderEditor/controllers/AuthoringMode","DS/FolderEditor/controllers/SearchMode","DS/FolderEditor/controllers/FavoritesMode","DS/FolderEditor/controllers/ReadMode","DS/PADServices/utils/PlatformURL","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUtil/IPClassifyCommunication","DS/FolderEditor/utils/FolderLoaderGlobal","text!DS/FolderEditor/assets/FolderEditorConf.json","i18n!DS/FolderEditor/assets/nls/BookmarkLocationPopup","DS/FolderEditor/views/FolderMode","DS/FolderEditor/tagger/TaggerContentProxy","DS/FolderEditor/tagger/TaggerTreeProxy","DS/Utilities/Utils","DS/FolderEditor/utils/WidgetHandlerUtil","DS/PADUtils/PADPredicatesNls"],function(e,t,o,n,i,r,s,a,l,d,c,u,p,g,f,h,m,v,_,S,C,b,F,y,D,E,w,A,T,I,x,P,k,N,M,O,U,R,B,L,V,W,j,q,H,z){var G=function(){var e=h.getCurrentBookmarkId(),t=void 0,o=void 0;if(e){var n=h.getX3DContentId();if(n)e===h.getX3DBookmarkId()&&(t=[n],o={copylink:!0},h.clearX3DContentItem())}return{selection:t,options:o}};function X(e,t,o){l.setBadge(e,t,o)}var J={authoring:new x,search:new P,favorites:new k,read:new N},K=n.extend({name:"FolderComponent",defaultOptions:{x3dAppId:"FolderEditor",amd_custo:{TreeDocument:"DS/FolderEditor/FolderTreeDocument",DataGridView:"DS/FolderEditor/views/FolderDataGridView",TileGridView:"DS/FolderEditor/views/FolderTileView",ThumbnailGridView:"DS/FolderEditor/views/FolderThumbnailView"},active_view:l.getDefaultView(),layout:{keyboard_inputs:!1,root_panel:!1,action_bar:!1,statusInfo:!1,slidder:!1,title_update:!1,drop_invite:"none",triptychOpts:{borderLeft:!0,withtransition:!w.isReplayedODT(),left:{resizable:!0}}},insert_replace:!0},_contentDiv:null,_subscribe:function(e,t){let o=A.subscribe(e,t);this._subscriptionTokens.push(o)},init:function(e,o){this._probeLoadElmt=T.createProbe("loadComponent");var n=this;this._contentDiv=e.renderTo,R.addComponentsToLoad("contentView",{loadingView:""});var i=V.getCurrentModeType();this.setCurrentMode(i),this._handlerThumbnails=null,this._treeCont=o,this.setOptions(e),this._parent(this.options),this.elements||(this.elements={}),this._logger=t.getLogger(K),require(["DS/PADUtils/views/PADStatusInfos"],function(e){n.elements.padstatus=new e({renderTo:n._contentDiv,events:{onShow:function(){n.elements.padstatus.setStatus(e.buildStatus({tree_content:{nbObjectsInTree:n.getObjectsInTree(),nbObjectsSelected:n.options.model.getSelectedNodes().length}}))}}})}),C.getPlaceholder().then(function(e){n._placeHolder=e});let r=UWA.createElement("div",{class:"containerTools"});this.addEvent("onReady",()=>{F.onFolderRename(function(e){n._sortingNodesContent(e)}),F.onModAttr(function(e){var t=n.getPADTreeListView();if(t){var o=t.getManager().sortModel;if(null==o[0]||"defaultSort"==o[0].dataIndex){var i=n.getPADTreeDocument().getNodesById(e.data[0].id)[0];i&&n._sortingNodesContent(i,"TreeOrder")}}});let e=h.onBookmarkOpening(()=>{W.clearTags(),this.getSpecficMode("read").resetInfoIndex(),this.switchMode(null,!0)});this._subscriptionTokens.push(e),this._subscribe({event:"refresh_content"},this.refreshView.bind(this)),this._subscribe({event:"remove_favorite"},e=>{this.refreshOnDelete([e.id])}),this._subscribe({event:"remove_nodes"},this.refreshOnDelete.bind(this)),this._subscribe({event:"IPClassifyColumnCusto/Views/showInWidgetBody"},function(e){e.html?(r.empty(),e.html.inject(r),r.inject(widget.body)):!0===e.restore&&r.remove()}),this._subscribe({event:"filterUpdatedTree"},()=>{if(C.getContent()&&"FolderSection_AllFolders"==h.getCurrentBookmarkId()){this.getSpecficMode("read").resetInfoIndex(),this.switchMode(null,!0)}}),this._subscribe({event:"filterUpdatedContent"},e=>{var t=e.matchingIds,o=t;o&&this.getPADTreeDocument().filterFromIds(t);var n=this.getSpecficMode("search"),i="search";let r=!1;y.isSearchActive()?J.search?J.search.resetInfoIndex():y.resetInfoIndex():(i="read",n=null,V.isFolderProxyToBeUsed()&&(r=o&&!!e.hasFilter,n=this.getSpecficMode("read")));let s=this.getCurrentMode();r=r||s.smartFilteringAvailable(),this._keepPreviousNodes=r?h.getCurrentBookmarkId():null,n&&n.filteringByService()?(n.resetInfoIndex(),this.RefreshProductStructure=!0,this.switchMode(i,!1)):!0!==e.noSmartFiltering&&s.smartFilteringAvailable()&&s.filteringByService()?this.switchMode(void 0,!1):W.reloadObjects()})}),e.layout&&e.layout.view_customization&&Array.isArray(e.layout.view_customization.selectedExtensions)&&Array.isArray(e.layout.view_customization.selectedTypes)&&I.updateSelectedParams({selectedExtensions:e.layout.view_customization.selectedExtensions,selectedTypes:e.layout.view_customization.selectedTypes})},createRootListSlidder2:function(){return this._treeCont.elements.container},refreshOnDelete:function(e){if(e.length>0)for(var t=0;t<e.length;t++)this.removeNodeInContent(e[t])},refreshView:function(e){e&&void 0!==e.RefreshProductStructure&&(this.RefreshProductStructure=e.RefreshProductStructure),W.clearTags();let t=this.getPADTreeListView();var o=t?t.getManager():null;o&&(this._componentScrollerPosition=o.getScrollerPosition());let n=this.getPADTreeDocument();n&&n.keepExpandedState();let i=this.getCurrentMode();i&&i.resetInfoIndex&&i.resetInfoIndex(),this.loadContentAndSelect(void 0,e&&e.objectId,e)},switchMode:function(e,t){e=e&&J[e]?e:"FolderSection_favorite"==h.getCurrentBookmarkId()?"favorites":widget.getValue("useIndexAccleration")?V.getCurrentModeType():"authoring",A.publish({event:"updateColumnVisibility",data:{visibility:"favorites"==e,columnName:"favoriteTitle"}}),J[e]!==this._currentMode&&(this.setCurrentMode(e),t=!0),"read"!=e&&"authoring"!=e||V.getCurrentModeType()!==e&&(V.setCurrentModeType(e),V.updateIconAndSettings()),t&&W.clearTags();var o=G(),n=o.selection;null==n||0===n.length?this.loadContentAndSelect():(h.clearX3DContentItem(),this.loadContentAndSelect(void 0,n,o.options))},getObjectsInTree:function(){let e=0;return this._currentMode.getObjectsInTree&&(e=this._currentMode.getObjectsInTree(this)),e||(e=this.options.model.getAllDescendants({onlyVisibleNodes:!0}).length),e},_addStyleOnTreeCont:function(e){var t=this.elements.padshell._getLeftWidth();t=e&&e>t?e:t,w.addNewStyles("treeContResize",{".FolderTree_Cont-root_container":{overflow:"hidden"},".FolderTree_Cont-root_treeview_container":{width:t+"px !important"}},!0)},_OnPADComponentReady:function(){var e=this;this.addEvent("onToggleView",l.setDefaultView),require(["DS/FolderEditor/views/FolderLeftSidePanelView","DS/FolderEditor/views/FolderRightSidePanelView"],function(t,o){e.folderLeftPanel=new t,e.folderRightPanel=new o({platformUrls:M.getTenantInfo(w.getTenantID())})}),l.getLeftPanelStatus().leftPanelState&&this.elements.padshell.togglePanel("left"),this.addEvent("onToggleView",function(){0===C.getContent().getObjectsInTree()&&e._addPlaceHolder(),e._filterRelatedNodes()});var t=widget.getValue("customLeftWidth");this._addStyleOnTreeCont(t);let o=this.elements.padshell._modelEvents.subscribe({event:"triptych-panel-show-started"},function(t){"left"===t&&e._addStyleOnTreeCont()});if(this._subscriptionTokens.push(o),o=this.elements.padshell._modelEvents.subscribe({event:"triptych-panel-visible"},function(e){"left"===e&&w.clearJSStylesheet("treeContResize")}),this._subscriptionTokens.push(o),null!=t&&(o=this.elements.padshell._modelEvents.publish({event:"triptych-set-size",data:{side:"left",size:t}}),this._subscriptionTokens.push(o)),o=this.elements.padshell._modelEvents.subscribe({event:"triptych-resized"},function(e){"left"===e.side&&widget.setValue("customLeftWidth",e.width)}),this._subscriptionTokens.push(o),this.elements.padshell._leftPanelContent.addEventListener("click",function(e){if((O.isWidgetMaximized()||widget._isFocus)&&e&&e.target&&("buttonSection"===e.target.id||e.target.className.indexOf("div_for_margin")>=0)){var t=g.getSetting("activateTreeFilter");C.getTreeCont().activateTreeFilter(!t)}}),C.setContent(this),y.setPredicates(I.getAvailableColumnsOpts()),F.onCurrentFolderColumnChange(function(){y.isSearchInProgress()&&y.resetInfoIndex(),e.getSpecficMode("read").resetInfoIndex(),e.loadContentAndSelect(null,null)}),h.getCurrentBookmarkId()){var n=G(),i=n.selection;this.loadContentAndSelect(void 0,i,n.options)}require("DS/FolderEditor/views/FolderMode").updateIconAndSettings(),this._probeLoadElmt.end(),R.removeComponentToLoad("contentView","loadingView")},_filterRelatedNodes:function(){var e=this.getPADTreeDocument();let t="datagridview"===this.getActiveView()?"IN":"OUT";if(e){var o=e.getRoots(!0).slice(0);e.wrapInTransaction(function(){e.withTransactionUpdate(function(){var e,n=o.length;for(e=0;e<n;++e)o[e].filterIn(!0);var i=function(e){e.isRelationsObjectNode?e._filterStatus=t:e._filterStatus="IN";var o=e.getChildren();o&&o.length>0&&o.slice(0).forEach(function(e){i(e)})},r=function(e){if("IN"===e._filterStatus){var t=e.getChildren();t&&t.length>0&&t.slice(0).forEach(function(e){r(e)})}else e.filterOut(),e.__treeGraphRoot__&&delete e.__treeGraphRoot__;delete e._filterStatus};o.forEach(function(e){i(e)}),o.forEach(function(e){r(e)})})})}},setFolderCommunicationChannel:function(){},onDragStartCell:function(e,t){if(!d.shouldAcceptDrag())return e.preventDefault(),void e.stopPropagation();let o=t.draggedNodes?t.draggedNodes:this.options.model.getSelectedNodes();if(d.isLinkedBookmark(o))return e.preventDefault(),e.stopPropagation(),void m.displayNotification({message:_.msg_warning_Linked_Or_Shortcut,className:"warning"});b.SetAsExternalDrop(!1);var n=d.getDragDataForSelectedNodesInCurrentFolderContent(t),i=JSON.stringify(n);try{e.dataTransfer.setData("text/searchitems",i)}catch(e){}if(e.dataTransfer.setData("Text",i),"graphview"!==this.getActiveView()&&n.data.items.length>1&&E.createGhostDnD(e,{number:n.data.items.length}),e.dataTransfer.effectAllowed="all",d.setStartDrag(!0),d.setDragFrom("bookmark"),!0===widget.getValue("noCompass")){var r=n.data.items,s=[];r.forEach(function(e){s.push(e.objectId)}),U.publish("setDragData",{ids:s})}e.stopPropagation()},onDragEndCell:function(){d.setStartDrag(!1)},onDragEnterCell:function(e,t){e&&e.dataTransfer&&(e.dataTransfer.dropEffect=d.isDragging()&&d.isMoveDnDSetting()&&!d.hasFilesInEvent(e)?"move":"copy");var o=t.nodeModel,n=o&&o.options?o.options.type:void 0;return!!c.inFamilyFolder(n)||(this.onDragEnterBlank(e,t),!1)},onDragLeaveCell:function(e,t){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="none");var o=t.nodeModel,n=o&&o.options?o.options.type:void 0;return c.inFamilyFolder(n)?"tileview"!=this.getActiveView()&&"thumbnailview"!=this.getActiveView()||void t.manager._hideDndFeedbacks():(this.onDragLeaveBlank(e,t),!1)},onDragOverCell:function(e,t){e&&e.dataTransfer&&(e.dataTransfer.dropEffect=d.isDragging()&&d.isMoveDnDSetting()&&!d.hasFilesInEvent(e)?"move":"copy"),e.preventDefault();var o=t.nodeModel,n=o&&o.options?o.options.type:void 0;return c.inFamilyFolder(n)?(t&&(t.dropPosition="middle"),"tileview"!=this.getActiveView()&&"thumbnailview"!=this.getActiveView()||void t.manager.onDragOverCellDefault(e,t)):(this.onDragOverBlank(e,t),!1)},onDropCell:function(e,t){if(1!=widget.launchWithReadMode){b.SetAsExternalDrop(!1);var o=t.nodeModel,n=o&&o.options?o.options.type:void 0;c.inFamilyFolder(n)?(d.performDropOnFolderEditorNode(o,e),e.preventDefault()):this.onDropBlank(e,t),d.setDragFrom(""),"tileview"!=this.getActiveView()&&"thumbnailview"!=this.getActiveView()||t.manager.onDropCellDefault(e,t)}else m.displayNotification({message:_.msg_warning_DndNotSupported,className:"warning"})},onDragEnterBlank:function(e,t){e&&e.dataTransfer&&(e.dataTransfer.dropEffect=d.isDragging()&&d.isMoveDnDSetting()&&!d.hasFilesInEvent(e)?"move":"copy");var o=this.getActiveView(),n=this.getOption("views")[o];return n&&n.options&&n.options.onDragEnterBlankDefault&&n.options.onDragEnterBlankDefault(e,t),!0},onDragLeaveBlank:function(e,t){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="none");var o=this.getActiveView(),n=this.getOption("views")[o];return n&&n.options&&n.options.onDragLeaveBlankDefault&&n.options.onDragLeaveBlankDefault(e,t),!0},onDragOverBlank:function(e,t){e.preventDefault(),e&&e.dataTransfer&&(e.dataTransfer.dropEffect=d.isDragging()&&d.isMoveDnDSetting()&&!d.hasFilesInEvent(e)?"move":"copy");var o=this.getActiveView(),n=this.getOption("views")[o];return n&&n.options&&n.options.onDragOverBlankDefault&&n.options.onDragOverBlankDefault(e,t),!0},onDropBlank:async function(e){if(1!=widget.launchWithReadMode){b.SetAsExternalDrop(!1);var t=await u.getCurrentBookmarkInfo();d.performDropOnFolderEditorNode(t,e),e.preventDefault(),d.setDragFrom("")}else m.displayNotification({message:_.msg_warning_DndNotSupported,className:"warning"})},onDropColumnHeader:function(){return d.setDragFrom(""),!0},getOnContextualEvent:function(){return{this:this,callback:function(e){return new Promise(function(t){p.getCtxMenu(e).then(function(e){t(e)}).catch(e=>console.log(e))})}}},doDnDDragStart:function(e,t,o){return this.onDragStartCell(this._createSimulatedEvent(e)),!0},doDnDDrop:function(e,t,o,n){var i={nodeModel:t};this.onDropCell(this._createSimulatedEvent(e),i)},shouldAcceptDnDDrop:function(e,t,o,n){return!t.getType||null==t.getType()||c.inFamilyFolder(t.getType())},_createSimulatedEvent:function(e){function t(){}return{dataTransfer:e,preventDefault:t,stopPropagation:t}},getActiveView:function(){return this._parent()},removeNodesInContent:function(){var e=this.getPADTreeDocument();e&&e.wrapInTransaction(function(){e.withTransactionUpdate(function(){e.unselectAll(),e.empty()})})},_loadContent:function(e,t,n){var r=this,s="";!0===widget.getBool("show-sub-folders")&&(s="All");var a="";!0===widget.getBool("filtered-content")&&(a="Yes");var d=!1;!0===widget.getBool("allow-products-expand")&&(d="Yes");var u=T.createProbe("loadContent_serverCall");R.addComponentsToLoad("contentView",{content:""});var p=null;p=!0===widget.getValue("standalone")?Promise.resolve({isCSVroleAvailable:!0}):new Promise(function(e){C.checkRolesAvailability(function(t,o,n){e({isPAUroleAvailable:t,isPARroleAvailable:o,isCSVroleAvailable:n})})});var f=e.getID?e.getID():"",v=e.getType?e.getType():"";let S=this._keepPreviousNodes===h.getCurrentBookmarkId();var b=this._currentMode.loadContent({pid:f,type:v,content:s,filterChildren:a,noSizeLimit:!!t,smartFiltering:S?{fetchAllAttr:this.getPADTreeDocument().getRoots(!0).length>=H.MAX_NUMBER_EXPAND}:void 0});Promise.all([p,b]).then(function(s){var a=s[0].isPAUroleAvailable,p=s[0].isPARroleAvailable,f=s[0].isCSVroleAvailable,v=s[1],S=r.getPADTreeDocument();let C=null;!function(e,t){e.wrapInTransaction(function(){e.withTransactionUpdate(t)})}(S,function(){u.end(),r.probeListContent=T.createProbe("listContent");var s=v.contents;if(r._placeHolder&&r._placeHolder.getContent().remove(),0===v.contents.length&&r._addPlaceHolder(),void 0!==s){var S=[];if(r.RefreshProductStructure&&d){var b=r.getPADTreeDocument().getRoots(),F=0,D=b.length;for(F=0;F<D;F++){var E=b[F];if(b[F].isExpanded()){if(!0===E._isProcessedForRelationsColumns&&(delete E._isProcessedForRelationsColumns,!l.isRelationsColumnsActive()&&null!=E.getChildren()[0])){var w=E.getChildren()[0];if(w.hasOwnProperty("isRelationsObjectGroupingNode")&&(doesNodeContainsRelObjGrpNode=w.isRelationsObjectGroupingNode,doesNodeContainsRelObjGrpNode))continue}S.push(E)}}}var I=[],x="read"==V.getCurrentModeType()&&1==r.getCurrentMode()._isPageRefreshed,P={},k=[],N=new Map;if(!0!==v.inProgress||x){var M=T.createProbe("loadContent_cleanNodes");if(r._keepPreviousNodes===h.getCurrentBookmarkId()||r.RefreshProductStructure&&W.isFilterActives()&&J.search!==r.getCurrentMode()&&(J.read!==r.getCurrentMode()||widget.getBool("filtered-content"))){let e=v.smartFiltering&&v.filters&&0===Object.keys(v.filters).length;e&&(s=[]),r.getPADTreeDocument().getRoots(!0).forEach(t=>{delete t.bkTempVisible,e?t.filterIn():(t.bkTempVisible=t.isVisible(),v.smartFiltering&&(t.bkTempVisible=!!t.getVisibleChildren()&&t.getVisibleChildren().length>0)),k.push(t),N.set(t.getID(),t),P[t.getID()]=t})}r._keepPreviousNodes=null,r.removeNodesInContent(),x&&(r.getCurrentMode()._isPageRefreshed=!1),M.end()}var O=[],U=h.getCurrentBookmarkId(!0);s.forEach(function(n){if(n.from&&n.to){if(n.from&&n.to&&n["bks.TreeOrder"]){let e=N.get(n.to);e&&(e.options.relationOrder=n["bks.TreeOrder"])}return}if(v.smartFiltering){let e=n.resourceid;!e&&n.attributes&&n.attributes.every(t=>{let o="resourceid"===t.name;return o&&(e=t.value),!o});let t=P[e];if(t&&(t.filterIn(),t.bkTempVisible=!0),t||!v.smartFiltering.fetchAllAttr)return}var s=r._currentMode.convertData(n);let l=P[s.resourceid];if(l)return l.filterIn(),void(l.bkTempVisible=!0);(!d||!0!==p&&!0!==a&&!0!==f)&&(s.children=null),!y.isSearchActive()&&U&&s.grid&&("Workspace"===s.type?s.grid.isLinkedFolder="TRUE":y.isSearchActive()||null==s.grid.ParentBk||s.grid.ParentBk!==U&&(s.grid.isLinkedFolder="TRUE"));var u=null;if(S.forEach(function(e){(e.id||e.getID())===s.resourceid&&(u=e)}),null==u){s.grid&&(s.grid.bi_color="rgba(0, 0, 0, 0)");var g=s.icons&&s.icons.length>0?s.icons[0]:"";!s.grid.service||"www"!==s.grid.service&&"__Unknown__"!==s.grid.service?s.icons=[{iconPath:"url("+g+")"}]:s.grid.source=s.grid.service;var h=new i(s);if(h.links=n.links?n.links:null,s.nodeAttrs)for(var m in s.nodeAttrs)h[m]=s.nodeAttrs[m];if(h.options.grid.thumbnail=s.thumbnail?s.thumbnail:"",h.id=s.resourceid,h._ischeckout="read"==r.getCurrentModeType()?s.Documentlocked:n.Documentlocked,"TRUE"===h._ischeckout)X(h,"bottomRight",o.getWebappsAssetUrl("FolderEditor","icons/22/I_CheckOutDocument.png"));if("TRUE"===s.publishOnConnect)X(h,"bottomRight",_=o.getWebappsAssetUrl("FolderEditor","icons/folderPublishBadge.png"));if(h.options.oldLabel=s.label,e.isPersonal&&c.isFolder(h.getType())&&(h.isPersonal=!0),"TRUE"===h._options.grid.isLinkedFolder)X(h,"bottomRight",_=o.getWebappsAssetUrl("FolderEditor","icons/I_ShortcutBookmark.png"));if(h.isFavorite&&h.toRemove){var _={iconName:"attention",className:"dgv-badge-remove"};h.setBadges({bottomRight:_})}r.updateActiveBookmarkNode(h),h._manageNLS=!0,(UWA.is(t,"array")?t.indexOf(s.resourceid)>=0:s.resourceid===t)&&O.push(h),k.push(h),N.set(h.id,h)}else{k.push(u),N.set(u.getID(),u);var C=!1;if(Array.isArray(u.getChildren())&&u.getChildren().length>0){var b=u.getChildren()[0];b.hasOwnProperty("isRelationsObjectGroupingNode")&&(C=b.isRelationsObjectGroupingNode)}C||I.push(u);var F=u.id||u.getID();(UWA.is(t,"array")?t.indexOf(F)>=0:F===t)&&O.push(u)}}),k&&!0!==v.sorted&&k.sort(r._ascendingSortingRootNodeByTitle.bind(r,!y.isSearchActive()));var R=g.getSetting("settypes");!v.modelerName&&R||g.setSetting("settypes",!v.modelerName||"UPS"===v.modelerName),r.probeAddNode=T.createProbe("loadContent_addNodes");var B="datagridview"===r.getActiveView()&&null!==r.getPADTreeListView();B&&r._listenEndUIRefreshEvent(k),r.addRootNodes(k),B||r._endRefreshView();var L=r.getPADTreeListView();if(L&&!y.isSearchActive())if("read"!==r.getCurrentModeType()||"read"==r.getCurrentModeType())L.getManager().reapplySortModel();if(r._currentMode.withInfiniteScrolling&&r._currentMode.withInfiniteScrolling()&&r.options.model.updateLinksFromStatus(r._currentMode.isInfiniteScrollingEnded()),r.RefreshProductStructure&&S.length>0){var j=r.getPADTreeListView();r.getPADTreeDocument().refresh({treelist:j,roots:I,cb:function(e){"error"===e.eventID&&m.displayNotification({message:_.refreshError,className:"error"}),A.publish({event:"refreshStructureDone"}),r._logger.log("Refresh PS : "+e.msg)}})}O.length>0&&(O.forEach(function(e){e.select()}),1===O.length&&"datagridview"===r.getActiveView()&&(C=O[0])),null!=n&&n.copylink&&0==O.length&&m.displayNotification({message:_.msg_warning_contentnotavailable,className:"warning"}),r.RefreshProductStructure=!1;var q=[];k.forEach(e=>{q.push(e.id||e.getID())}),W.addObjectsTags(q,r._currentMode.areFacetsCalled()),Object.keys(P).length>0&&r.getPADTreeDocument().addTagsForChildren(),v.smartFiltering||r._currentMode.filteringByService()&&r.getCurrentMode()!==J.authoring||W.applyFilterIfAny(!1)}r._endLoadAndSelect(),r._endContentSelect()}),C&&r.getPADTreeListView().scrollToVisibleNode(C)}).catch(this._manageException.bind(this,e))},updateActiveBookmarkNode:function(e,t){if(C.isCustomizedEnv()||C.isActiveBookmarkActivated()){var o=C.getActiveFolder(),n=o.id,i=o.disabledId;if(!e){var r=this.getPADTreeDocument().getNodesById(i||n);r.length>0&&(e=r[0])}e&&(n===e.id?X(e,"topRight",t?null:s.ICON_ACTIVE):i===e.id&&X(e,"topRight",t?null:s.ICON_ACTIVE_DISABLED))}},_manageException:function(e,t){if(this._logger.log("WebService content, Err : "+(t&&t.stack?t.stack:"unknown")),this._endContentSelect(),this.removeNodesInContent(),t){let l=!1;if(t.err&&t.err.message&&((t=t.err).className=t.className?t.className:"error"),!t.message){var o,n,i,r=t.err,s=t.serverErr,a="error";r&&"timeout"===r.type?(n=_.msg_error_timeout.title,i=_.msg_error_timeout.subtitle,message=_.msg_error_timeout.message):(this._currentMode.manageError&&s&&(o=this._currentMode.manageError(s),a="warning"),o||e&&(e.getType()===c.TYPE_FAVORITES_SECTION?(n=_.msg_error_contentnotavailableInFavorite.Title,i=_.msg_error_contentnotavailableInFavorite.Advice):(v.displayNotFoundBk(e.getID(),e.getLabel()),l=!0))),t={title:n,subtitle:i,className:a},o&&(t.message=o),r&&console.log(r)}l||m.displayNotification(t)}this._endLoadAndSelect()},_switchNameToEdit:function(e){try{if("datagridview"===this.getActiveView()){var t=this.getPADTreeListView().getManager(),o=t.layout.getColumnIndex("tree");e.isFavorite&&(o=t.layout.getColumnIndex("favoriteTitle"));var n=t.layout.getCellsFromNodeModel(e)[o],i=T.createProbe("scrollTo_folder");t.scrollToCellAt({cellID:n}),i.end();var r=t.getCellInfosAt(n);p._cellToRename={cellInfos:r,context:"CONTENT"},t.setCellInEdition(n)}}catch(e){}},_defaultEnableNameEdit:function(e){setTimeout(function(){this._switchNameToEdit(e)}.bind(this),1e3)},_manageSortForMultiColumns:function(){let e=this.getPADTreeListView();if(e){let o=e.getManager().sortModel;if(y.isSearchActive()&&o&&o.length>1){let t=[];return t.push(o[0]),e.getManager().sortModel=t,!0}var t=l.getContentSortmodel();!y.isSearchActive()&&o.length!==t.length&&o.length>1&&(e.getManager().sortModel=t)}return!1},loadContentAndSelect:async function(e,t,o){if(this.probeUpdateUI=T.createProbe("component_updateUI"),O.setPCSEntry(widget.id+"_FolderContentLoad",!0),!this._manageSortForMultiColumns()){void 0===t&&(t=void 0!==this.nodeToSelectID?this.nodeToSelectID:t),delete this.nodeToSelectID,this._handlerThumbnails&&this._handlerThumbnails.cancel(),this._handlerThumbnails=null;var n,i;e||(e=await u.getCurrentBookmarkInfo()),e&&(e.getType&&(n=e.getType()),e.getID&&(i=e.getID()));var r=!1;if("FolderSection_favorite"===n?this._currentMode!==J.favorites&&(this.switchMode("favorites"),r=!0):this._currentMode===J.favorites&&(this.switchMode(),r=!0),!r){"FolderSection_AllFolders"===n?W.addTagsFromProxy(j):W.deleteTagsFromProxy(j);var s=y.isSearchActive();c.inFamilyFolder(n)&&i||"FolderSection_AllFolders"==n&&!s||"FolderSection_favorite"==n&&!s||"Personal Workspace"==n&&!s||"FolderSection_AllFolders"==n&&"FolderSection_AllFolders"==i?this._loadContent(e,t,o):(s&&y.clearSearch(),this.removeNodesInContent(),this.probeUpdateUI.end(),this._endLoadAndSelect())}}},_endLoadAndSelect:function(){R.removeComponentToLoad("contentView","content"),widget.dispatchEvent("onLoadReady");var e=this.getPADTreeListView(),t=e?e.getManager():null;t&&(y.isSearchActive()||"read"===this.getCurrentModeType()||(this._componentScrollerPosition?t.setScrollerPosition(this._componentScrollerPosition):t.setScrollerPosition({x:0,y:0},!0)),this._componentScrollerPosition=null)},_endContentSelect:function(){var e=this.getPADTreeListView(),t=e?e.getManager():null;t&&t.infiniteScrollProcessDone(),O.setPCSEntry(widget.id+"_FolderContentLoad",!1),O.sendPCSTracketPageEvent("FolderWidget_Performance","FolderContentLoad",widget.id+"_FolderContentLoad")},_listenEndUIRefreshEvent:function(e){var t=this,o=this.getPADTreeListView();new Promise(function(n,i){if("datagridview"!==t.getActiveView()||0===e.length)n();else{var r=function(){t.removeEvent("onToggleView",r),n()};t.addEvent("onToggleView",r),o&&o.getManager().onPostUpdateViewOnce(function(){if(t._currentMode.supportClientSort&&this.sortModel&&this.sortModel.length>0){var e=this.sortModel[0];e&&(this.sortModel=[{sort:e.sort,dataIndex:e.dataIndex}])}r()})}}).then(function(){t._endRefreshView()})},_endRefreshView:function(){this.dispatchEvent("onCompleteRefreshNodes",h.getCurrentBookmarkId()),this.probeAddNode&&this.probeAddNode.end(),this.probeUpdateUI&&this.probeUpdateUI.end(),this.probeListContent&&this.probeListContent.end()},removeNodeInContent:function(e){var t=this.getPADTreeDocument();t.getRoots().forEach(function(o){(o.id||o.getID())===e&&t.removeRoot(o)}),0===t.getRoots().length&&this._addPlaceHolder()},addDummyRootNodes:function(e){for(var t=[],n=0;n<e.length;n++){var r,s=e[n];if(s instanceof i){s.options.display=s.options.label,X(r=s,"topRight",o.getWebappsAssetUrl("FolderEditor","icons/spinnerBadge.gif"))}else{(r=new i({})).setState({state:"noChildren"}),r.childComputed=!0,r.options.children=null,r.options.label=s.label,r.options.oldLabel=s.label,r.options.display=s.label,r.options.resourceid=s.tempId,r.options.id=s.tempId,r.options.isNotManagedByPS=!0,r.id=s.tempId,r.options.tempId=s.tempId;var a=o.getWebappsAssetUrl("FolderEditor","icons/spinnerBadge.gif");r.options.icons=[{iconPath:"url("+a+")"}]}if(r._busy=!0,s instanceof i){r.updateAttributes([],I.getAvailableColumns())}else t.push(r)}this.addRootNodes(t)},expandBranches:function(e){if(e<=0)return null;var t=this.getPADTreeDocument(),o={onComplete:function(){if(e.length){var o=e[e.length-1],n=t.getNodesById(o);n&&1===n.length&&n[0].select(!0)}}};if(t.searchRootById(e[0]))t.insertBranches([e],o);else{var n=widget.getBool("filtered-content")?_.msg_warning_notProductRootInFilteredContext:{message:_.msg_warning_notProductRoot};m.displayNotification({...n,className:"warning"})}},switchFolderTreeNodeLabelToWriteView:function(e){var t=!1;return e instanceof i&&c.inFamilyFolder(e.getType())&&this.getPADTreeDocument()&&e.getTreeDocument()===this.getPADTreeDocument()&&(this._switchNameToEdit(e),t=!0),t},_sortingNodesContent:function(e,t){var o=this.getPADTreeListView();if(o&&e){var n=o.getManager(),i=n.sortModel;t&&"TreeOrder"==t?(n.sortModel=[{sort:"asc",dataIndex:"defaultSort"}],n.reapplySortModel()):i&&i.length>0?n.reapplySortModel():n.sortModel=[{sort:"asc",dataIndex:"tree"}];var r=n.layout.getCellsFromNodeModel(e)[0];n.scrollToCellAt({cellID:r})}},_ascendingSortingRootNodeByTitle:function(e,t,o){var n=!!e&&c.inFamilyFolder(t.getType()),i=!!e&&c.inFamilyFolder(o.getType());return n&&!i?-1:!n&&i?1:l.compareLabels(t.options.label,o.options.label)},_addPlaceHolder:function(){var e=this.getActiveView();if("datagridview"!==e){if("tileview"===e){var t=(o=this.getPADTileGridView().options.grid.elements.scroller)?o.getContent():null;t&&this._placeHolder.elements.container.inject(t)}if("thumbnailview"===e){var o,n=(o=this.getPADThumbnailGridView().options.grid.elements.scroller)?o.getContent():null;n&&this._placeHolder.elements.container.inject(n)}}},getGridViewRowHeight:function(){let e=l.densityHeight.compact,t=this.getPADTreeListView();return t&&(e=t.getRowHeight()),e},getContentHeight:function(){let e=0;if(document){let t=document.getElementsByClassName("xbook_viewmain");if(t&&t.length>0){let o=t[0].getElementsByClassName("wux-layouts-left-scroller-container");if(o&&o.length>0&&(e=o[0].clientHeight),!e){let o=t[0].getElementsByClassName("wux-layouts-body");o&&o.length>0&&(e=o[0].clientHeight)}}}return e},getComponentWidth:function(){let e=0;if(document){let t=document.getElementsByClassName("xbook_component");t&&t.length>0&&(e=t[0].clientWidth)}return e},getCurrentMode:function(){return this._currentMode},setCurrentMode:function(e){J[e]!==this._currentMode&&W.clearTags(),this._currentMode&&this._currentMode.disable&&this._currentMode.disable(),this._currentMode=J[e],this._currentMode&&this._currentMode.enable&&this._currentMode.enable()},getCurrentModeType:function(){return this._currentMode.getModeType()},getSpecficMode:function(e){return J[e]},processForInfiniteScroll:function(e,t){e.reachBottom&&(this.getCurrentMode().isInfiniteScrollingEnded()||this.loadContentAndSelect());t.infiniteScrollProcessDone()}});return K});