define("DS/MPFMarketplaceAdmin/orderCancellation/InfoMessageComponent",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartCollection","i18n!DS/MPFMarketplaceAdmin/assets/nls/InfoMessageComponent"],function(e,t,s,r){"use strict";const i=Object.freeze({}),a=Object.freeze({HIDDEN:"hidden",NO_RESULTS:"noResults",INITIAL:"noSearchStarted"}),n=e.extend({className:"mpf-info-message-component",setup({carts:e}){t.requiredOfPrototype(e,s,"options.carts must be a CartCollection"),this.carts=e,this.state=a.INITIAL,this.listenTo(this.carts,"onSync",this._refresh.bind(this))},render(){if(this.state===a.HIDDEN)this.container.setContent([]);else{let e,t;switch(this.state){case a.INITIAL:e=r.get("setFilterToStartSearch"),t="search-filter";break;case a.NO_RESULTS:e=r.get("noResultMessage"),t="docs-delete"}this.container.setContent([{tag:"div",class:`mpf-icon fonticon fonticon-${t}`},{tag:"div",class:"mpf-info-message",text:e}])}return this},destroy(){this.stopListening(),this.carts=null,this._parent(),this.container=null},_refresh(){0===this.carts.size()?this.state=a.NO_RESULTS:this.state=a.HIDDEN,this.render()}});return n.Events=i,n.States=a,n}),define("DS/MPFMarketplaceAdmin/platformCreation/AddRoleLine",["UWA/Class/View","DS/UIKIT/Input/Select","DS/UIKIT/Input/Number","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService"],function(e,t,s,r,i){"use strict";const a=Object.freeze({REMOVE:"remove",PRODUCT_CHANGE:"productChange"}),n=e.extend({className:"mpf-add-role-line",setup({product:e}={}){this.product=e,this.quantity=1},render({products:e}){return this.container.setContent([new t({className:"mpf-select-role",options:[this.product,...e],value:this.product,required:!0,events:{onChange:e=>{const t=e.target.value;this.product!==t&&(this.product=t,this.dispatchEvent(a.PRODUCT_CHANGE))}}}),new s({className:"mpf-number-role",min:1,max:99999,step:1,value:this.quantity,events:{onChange:e=>{this.quantity=e.target.value}}}),new r({className:"error",icon:"close",events:{onClick:()=>{this.dispatchEvent(a.REMOVE,this.product)}}})]),this},getSelectedProduct(){return this.product},getSelectedQuantity(){return this.quantity},destroy(){this._parent(),this.container=null}});return n.Events=a,n}),define("DS/MPFMarketplaceAdmin/orderCancellation/OrderCancellationFilterCommands",["UWA/Core","UWA/Class/View","DS/MPFView/FieldTextInputV2","DS/MPFView/FieldSelectInputV2","DS/MPFCartModel/CartCollectionFilterModel","DS/MPFServices/MarketplaceServices","i18n!DS/MPFMarketplaceAdmin/assets/nls/OrderCancellation"],(e,t,s,r,i,a,n)=>{"use strict";const o=Object.freeze({COMPANY:"Company",MAKER:"Maker",STUDENT:"Student"}),l=Object.freeze({DELIVERED:"Delivered",SUBMITTED:"Submitted",REJECTED:"Rejected"}),c=Object.freeze({UK:"3DS Store Ltd",AUSTRALIA:"DS Australia Pty Ltd",USA:"Dassault Systemes USA",JAPAN:"DS K.K.",INDIA:"DS India Private Ltd"}),h=Object.freeze({REFRESH:"refresh"}),d=t.extend({domEvents:{keyup:"_onKeyUp"},className:"mpf-order-cancellation-filter-commands",setup(e){this.cartFilters=e.cartFilters,this.transactionEntry=this._createTransactionEntry(),this.customerNameEntry=this._createCustomerNameEntry(),this.siteIdEntry=this._createSiteIdEntry(),this.customerSegmentEntry=this._createCustomerSegmentEntry(),this.statusEntry=this._createStatusEntry(),this.dsSellerEntry=this._createDsSellerEntry(),this.serviceEntry=this._createServiceEntry()},render(){return this.container.setContent([this.transactionEntry,this.customerNameEntry,this.siteIdEntry,this.customerSegmentEntry,this.statusEntry,this.dsSellerEntry,this.serviceEntry]),this},destroy(){this._parent()},_onKeyUp(e){e&&"Enter"===e.key&&e.target&&"INPUT"===e.target.tagName&&this.dispatchEvent(h.REFRESH)},_createEntry:t=>e.createElement("div",{class:"mpf-order-cancellation-filter",html:[t.render()]}),_createTextField(e,t,r){return new s({model:this.cartFilters,fieldName:e,fieldLabel:t,placeholder:r,dynamicValidation:!0,silent:!1})},_createSelectField(e,t,s,i){return new r({model:this.cartFilters,fieldName:e,fieldLabel:t,placeholder:s,selectableOptions:i,dynamicValidation:!0,silent:!1,multipleOptionsSelectable:!1})},_createTransactionEntry(){const e=this._createTextField(i.Fields.FILTER_BY_TRANSACTION,n.get("transaction"),n.get("selectTransaction"));return this._createEntry(e)},_createCustomerNameEntry(){const e=this._createTextField(i.Fields.FILTER_BY_CUSTOMER_NAME,n.get("customerName"),n.get("enterCustomerName"));return this._createEntry(e)},_createSiteIdEntry(){const e=this._createTextField(i.Fields.FILTER_BY_CUSTOMER_ID,n.get("siteId"),n.get("selectSiteId"));return this._createEntry(e)},_createCustomerSegmentEntry(){const e=this._createSelectField(i.Fields.FILTER_BY_CUSTOMER_SEGMENT,n.get("customerSegment"),n.get("selectCustomerSegment"),[{value:o.COMPANY,label:n.get("company")},{value:o.MAKER,label:n.get("maker")},{value:o.STUDENT,label:n.get("student")}]);return this._createEntry(e)},_createStatusEntry(){const e=this._createSelectField(i.Fields.FILTER_BY_STATE,n.get("status"),n.get("selectStatus"),[{value:l.SUBMITTED,label:n.get("submitted")},{value:l.DELIVERED,label:n.get("delivered")},{value:l.REJECTED,label:n.get("rejected")}]);return this._createEntry(e)},_createDsSellerEntry(){const e=this._createSelectField(i.Fields.FILTER_BY_SELLER,n.get("dsSeller"),n.get("selectDsSeller"),[{value:c.UK,label:c.UK},{value:c.USA,label:c.USA},{value:c.AUSTRALIA,label:c.AUSTRALIA},{value:c.INDIA,label:c.INDIA},{value:c.JAPAN,label:c.JAPAN}]);return this._createEntry(e)},_createServiceEntry(){const e=this._createSelectField(i.Fields.FILTER_BY_REQUESTED_SERVICE,n.get("service"),n.get("selectService"),[{value:a.CLICK_AND_BUY,label:"Click & Buy"},{value:a.IFWELOOP,label:"IfweLoop"}]);return this._createEntry(e)}});return d.Events=h,d}),define("DS/MPFMarketplaceAdmin/offerManagement/OfferCreationFooterForm",["UWA/Class/View","UWA/Core","UWA/String","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Text","DS/MPFView/ValidationResultBuilder","DS/MPFServices/ObjectService","i18n!DS/MPFMarketplaceAdmin/assets/nls/OfferManagement"],function(e,t,s,r,i,a,n,o,l){"use strict";const c=Object.freeze({SEARCH_BY_TRIGRAM:"SearchByTrigram"}),h=Object.freeze({PERCENTAGE:"percentage",NET_PRICE:"netPrice"}),d=e.extend({className:"mpf-offer-creation-footer-form",setup(e={}){this.offerCreationModel=e.offerCreationModel,this.trigramField=this._createTrigramField(),this.trigram=this._createTrigramEntry(),this.type=this._createTypeEntry()},render(){return this.container.setContent([this.trigram,this.type]),this},destroy(){this.stopListening(),this.trigramField=null,this.trigram=null,this.type=null,this.checkboxes=null,this._parent(),this.container=null},_createTypeEntry(){const e=this._createToggleField(h.PERCENTAGE,l.get("percentage")),t=this._createToggleField(h.NET_PRICE,l.get("netPrice"));return this.checkboxes=[e,t],e.addEvent("onChange",this._typeChanged.bind(this,h.PERCENTAGE)),t.addEvent("onChange",this._typeChanged.bind(this,h.NET_PRICE)),this._createToggleEntry(l.get("type"),this.checkboxes,"mpf-type")},_typeChanged(e){this.removeErrorMessage(this.type),this.offerCreationModel.setDiscountType(e)},_createTrigramEntry(){const e=this._createRequired(),s=new r({value:l.get("add"),className:"primary mpf-add-button",icon:"plus",events:{onClick:this._addButtonClicked.bind(this)}});return t.createElement("div",{class:"mpf-offer-trigram",html:[t.createElement("div",{class:"mpf-label",html:[l.get("trigram"),"&nbsp;",e]}),this.trigramField,s]})},_addButtonClicked(){this.removeErrorMessage(this.trigram),this.dispatchEvent(c.SEARCH_BY_TRIGRAM,this.trigramField)},_createToggleField(e,t){const s=new i({className:"mpf-toggle primary",fieldName:e,name:"discountType",label:t,type:"radio"});return this.offerCreationModel.getDiscountType()===e&&s.setCheck(!0),s},_createRequired:()=>t.createElement("em",{class:"mpf-required",text:"*"}),_createToggleEntry(e,s,r){const i=this._createRequired();return t.createElement("div",{class:"mpf-offer-toggle "+r,html:[t.createElement("div",{class:"mpf-label",html:[e,"&nbsp;",i]}),s]})},_createTrigramField:()=>new a({className:"mpf-trigram-input-text",placeholder:l.get("enterTrigram")}),validateType(){const e=new n;this.removeErrorMessage(this.type),this.checkboxes.find(e=>e.isChecked())||e.addError(l.get("type"),s.format(l.get("requiredField"),l.get("type")));const t=e.build();return t.isValid||this.displayErrorMessage(t,this.type),t},displayErrorMessage(e,s){const r=e.errors[0];s.addClassName("mpf-invalid"),t.createElement("p",{class:"mpf-error",text:t.is(r.message)?r.message:""}).inject(s)},removeErrorMessage(e){e.removeClassName("mpf-invalid");const s=e.getElement("p");t.is(s)&&e.removeChild(s)}});return d.Events=c,d.DiscountType=h,d}),define("DS/MPFMarketplaceAdmin/orderCancellation/CommentsTile",["UWA/Class/View","DS/UIKIT/Spinner","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFPersonModel/PersonModel","DS/MPFCartModel/CartNotesFactory","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartNotesModel","i18n!DS/MPFMarketplaceAdmin/assets/nls/OrderCancellation"],function(e,t,s,r,i,a,n,o,l,c,h){"use strict";const d=Object.freeze({}),u=Object.freeze({INITIAL:"initial",DISPLAY:"display",EDIT:"edit"}),f=e.extend({className:"mpf-comments-tile",setup({me:e,cart:t,cartNotesFactory:s,state:r}={}){a.requiredOfPrototype(e,n,"options.me must be a PersonModel"),a.requiredOfPrototype(t,l,"options.cart must be a CartModel"),a.requiredOfPrototype(s,o,"options.cartNotesFactory must be a CartNotesFactory"),this.me=e,this.cart=t,this.cartNotesFactory=s,this.state=r||u.INITIAL,this.cartNotes=this.cartNotesFactory.createModel(o.Types.CART_NOTES),this.spinner=this._createSpinner(),this.input=this._createInput()},render(){let e;if(this.state===u.INITIAL)e=this.spinner,this._fetchCartNotes();else if(this.state===u.DISPLAY){const t=this.cartNotes.getNotes();e=[{tag:"div",class:"mpf-comment",...t?{text:t}:{html:[{tag:"i",text:h.get("noCommentsAdded")}]}}],(this.me.hasRole(n.Roles.PRICER)||this.me.hasRole(n.Roles.SALES_ADMIN))&&e.push({tag:"span",class:"mpf-icon fonticon fonticon-pencil",events:{click:()=>{this.state=u.EDIT,this.render()}}})}else this.state===u.EDIT&&(this.input.setValue(this.cartNotes.getNotes()||""),e=[{tag:"div",class:"mpf-comment",html:this.input},{tag:"div",class:"mpf-buttons",html:[new s({className:"primary",value:h.get("save"),events:{onClick:()=>this._saveNotes()}}),new s({value:h.get("cancel"),events:{onClick:()=>{this.state=u.DISPLAY,this.render()}}})]}]);return this.container.setContent(e),this},reset(){this.state===u.EDIT&&(this.state=u.DISPLAY)},destroy(){this.me=null,this.cart=null,this.cartNotes=null,this.cartNotesFactory=null,this._parent(),this.container=null},async _fetchCartNotes(){const e=this.cart.get(l.Fields.CART_NOTES_ID);e?(this.cartNotes.set("id",e),await this.cartNotes.fetchPromise()):this.cartNotes.setCartId(this.cart.get("id")),this.state=u.DISPLAY,this.render()},async _saveNotes(){this.cartNotes.setNotes(this.input.getValue()),i.mask(this.container),this.cartNotes.isNew()?(this.cartNotes.setCartId(this.cart.get("id")),await this.cartNotes.savePromise()):await this.cartNotes.savePromise(this.cartNotes.pick(c.Fields.PRIVATE_NOTES),{patch:!0}),i.unmask(this.container),this.state=u.DISPLAY,this.render()},_createInput:()=>new r({multiline:!0,rows:4}),_createSpinner:()=>new t({visible:!0})});return f.States=u,f.Events=d,f}),define("DS/MPFMarketplaceAdmin/sellerRoles/SellerRolesContent",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Toggle","DS/UIKIT/Alert","DS/UIKIT/Spinner","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFServices/MarketplaceServices","DS/MPFPersonRolesModel/PersonRolesFactory","DS/MPFPersonRolesModel/PersonRolesModel","i18n!DS/MPFMarketplaceAdmin/assets/nls/SellerRoles","css!DS/MPFMarketplaceAdmin/MPFMarketplaceAdmin.css"],(e,t,s,r,i,a,n,o,l,c,h)=>{"use strict";const d=Object.freeze({INITIAL:"initial",LOADING:"loading",LOADED:"loaded",NO_USER_FOUND:"noUserFound"}),u=[o.MAKE,o.ENGINEERING,o.INNOVATE,o.PART_SUPPLY],f=new Map;return f.set(o.MAKE,h.get("makeSeller")),f.set(o.ENGINEERING,h.get("engineeringSeller")),f.set(o.INNOVATE,h.get("innovateSeller")),f.set(o.PART_SUPPLY,h.get("partSupplySeller")),e.extend({className:"mpf-user-roles",setup({personRolesFactory:e}){n.requiredOfPrototype(e,l,"options.personRolesFactory must be a PersonRolesFactory"),this.personRolesFactory=e,this.state=d.INITIAL,this.spinner=new i,this.alert=new r({visible:!1,autoHide:!0,hideDelay:5e3})},async load({user:e}){this.personRolesModel=this.personRolesFactory.createModel(l.Types.USER),this.state=d.LOADING,this.render();try{await this.personRolesModel.fetchPromise({user:e}),this.state=d.LOADED,this.render()}catch(e){console.error(e),e&&e.response&&"Error.ResourceDoesNotExist"===e.response.errorCode?(this.state=d.NO_USER_FOUND,this.render()):(this.state=d.INITIAL,this.render(),this.alert.add({className:"error",text:h.get("userSearchFailed")}).show())}},render(){let e;return this.state===d.INITIAL?e=[this.alert,{tag:"div",class:"mpf-info-message",text:h.get("noUserSelected")}]:this.state===d.LOADING?e=[this.alert,this.spinner.show()]:this.state===d.NO_USER_FOUND?e=[this.alert,{tag:"div",class:"mpf-error-message",text:h.get("noUserFound")}]:this.state===d.LOADED&&(e=[this.alert,...this._renderLoadedState()]),this.container.setContent(e),this},destroy(){this.personRolesFactory=null,this.personRolesModel=null,this._parent()},async _toggleRole({service:e}){if(this.personRolesModel){a.mask(this.container);try{let t;if(this.personRolesModel.hasSellerRoleForService(e))t=await this.personRolesModel.removeRoles([c.SellerRoles[e]]);else{const s=[c.SellerRoles[e]];if(this.personRolesModel.hasBuyerRoleForService(e)||s.push(c.BuyerRoles[e]),(t=await this.personRolesModel.addRoles(s))&&1===t.code)throw new Error("unable to save role")}await this.personRolesModel.fetchPromise({user:this.personRolesModel.get("id")}),a.unmask(this.container),this.render()}catch(e){this.render(),a.unmask(this.container),console.error(e),this.alert.add({className:"error",text:h.get("unableToSaveRoleModification")}).show()}}},_renderLoadedState(){return[{tag:"h4",text:h.get("userRoles")},this._createRolesResults(),{tag:"p",text:h.get("rolesGranted")},u.map(e=>this._createToogle({service:e})),{tag:"hr"}]},_createRolesResults(){return t.createElement("div",{class:"mpf-user-roles-results",html:[{tag:"div",html:[{tag:"span",class:"mpf-bold",text:"Email: "},{tag:"span",class:"mpf-email",text:this.personRolesModel.getEmail()}]},{tag:"div",html:[{tag:"span",class:"mpf-bold",text:"Login: "},{tag:"span",class:"mpf-login",text:this.personRolesModel.get("id")}]}]})},_createToogle({service:e}){return new s({type:"switch",checked:this.personRolesModel.hasSellerRoleForService(e),className:"primary",value:e,label:f.get(e),events:{onChange:()=>{this._toggleRole({service:e})}}})}})}),define("DS/MPFMarketplaceAdmin/orderCancellation/CartStateTile",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel"],function(e,t,s,r){"use strict";const i=Object.freeze({DOWNLOAD_FILE:"downloadFile"}),a=[[r.States.CANCELLED],[r.States.SUBMITTED],[r.States.PENDING_PAYMENT],[r.States.PAYMENT_INITIATED,r.States.PAYMENT_ACCEPTED],[r.States.PAYMENT_COMPLETE],[r.States.PROCESSING],[r.States.FINISHED,r.States.SHIPPED],[r.States.DELIVERED]],n=[["REJECTED","BLOCKED","REFUND_FAILED"],["SUBMITTED"],["CONFIRMED"],["PROCESSING"],["DELIVERED"]],o=t.extend({className:"mpf-cart-state-tile",setup(e={}){s.requiredOfPrototype(e.cart,r,"options.cart must be a CartModel"),this.cart=e.cart},render(){const e=[{tag:"span",class:"mpf-cart-state-icon mpf-icon"+this._getStateIconClass()},{tag:"span",class:"mpf-cart-state",text:this.cart.getState()},{tag:"span",class:"mpf-download-icon mpf-icon fonticon fonticon-download",events:{click:this.dispatchEvent.bind(this,i.DOWNLOAD_FILE)}}];return this.container.setContent([{tag:"div",class:"mpf-first-line",html:e},{tag:"div",class:"mpf-progress-bar",html:[{tag:"span",class:"mpf-grey-bar"},{tag:"span",class:"mpf-green-bar",styles:{width:this._getGreenBarWidth()}}]}]),this},_getStateIconClass(){return this.cart.getState()===r.States.DELIVERED?" fonticon fonticon-status-ok":""},_getGreenBarWidth(){const e=this.cart.getState(),t=this.cart.isCancellation()?n:a;return t.findIndex(t=>t.indexOf(e)>-1)/(t.length-1)*100+"%"},destroy(){this._parent(),this.container=null}});return o.Events=i,o}),define("DS/MPFMarketplaceAdmin/offerManagement/OfferCreationFormRightComponent",["UWA/Class/View","UWA/Core","DS/MPFOfferModel/OfferCreationModel","DS/MPFView/FieldTextInputV2","DS/MPFView/FieldSelectInputV2","DS/MPFServices/ObjectService","i18n!DS/MPFMarketplaceAdmin/assets/nls/OfferManagement"],function(e,t,s,r,i,a,n){"use strict";const o=Object.freeze({}),l=Object.freeze({VALUE:"value"}),c=e.extend({className:"mpf-offer-creation-form-right-component",setup(e){this.offerCreationModel=e.offerCreationModel,this.offerName=this._createOfferNameEntry(),this.tcReference=this._createTCReferenceEntry(),this.copyOffer=this._createCopyOfferEntry(),this.eligibilityBlueBox=this._createEligibilityBlueBox(),this.eligibilityTooltip=this._createEligibilityTooltip(),this.description=this._createDescription(),this.offerDetails=this._createOfferDetails(),this.eligibilitySection=this._createEligibilitySection(),this.moreInfo=this._createMoreInfo()},render(){return this.container.setContent([this.offerName,this.tcReference,this.copyOffer,this.eligibilityBlueBox,this.eligibilityTooltip,this.description,this.offerDetails,this.eligibilitySection,this.moreInfo]),this},destroy(){this.stopListening(),this.offerName&&this.offerName.destroy(),this.tcReference&&this.tcReference.destroy(),this.copyOffer&&this.copyOffer.destroy(),this.eligibilityBlueBox&&this.eligibilityBlueBox.destroy(),this.eligibilityTooltip&&this.eligibilityTooltip.destroy(),this.description&&this.description.destroy(),this.offerDetails&&this.offerDetails.destroy(),this.eligibilitySection&&this.eligibilitySection.destroy(),this.moreInfo&&this.moreInfo.destroy(),this.offerNameInput&&this.offerNameInput.destroy(),this.eligibilityBlueBoxInput&&this.eligibilityBlueBoxInput.destroy(),this.eligibilityTooltipInput&&this.eligibilityTooltipInput.destroy(),this.descriptionInput&&this.descriptionInput.destroy(),this.offerDetailsInput&&this.offerDetailsInput.destroy(),this.eligibilitySectionInput&&this.eligibilitySectionInput.destroy(),this.moreInfosInput&&this.moreInfosInput.destroy(),this._parent(),this.container=null},_createEntry:(e,s)=>t.createElement("div",{class:s,html:[e.render()]}),_createTextField(e,t,s,i,a,n){return new r({model:this.offerCreationModel,fieldName:e,fieldLabel:t,placeholder:s,dynamicValidation:!0,silent:!1,required:i,multiline:a,multilineRows:n})},_createSelectField(e,t,s,r){const a=new i({model:this.offerCreationModel,fieldName:e,fieldLabel:t,placeholder:s,selectableOptions:r,dynamicValidation:!0,silent:!1,multipleOptionsSelectable:!1});return this.offerCreationModel.get(e)&&a.setValue(this.offerCreationModel.get(e)),a},_createOfferNameEntry(){return this.offerNameInput=this._createTextField(s.Fields.TITLE,n.get("offerName"),n.get("enterText"),!0,!1),this._createEntry(this.offerNameInput,"mpf-offer-text mpf-offer-name")},_createTCReferenceEntry(){const e=this._createTextField(s.Fields.EXTERNAL_OFFER_ID,n.get("tcReference"),n.get("enterText"),!1,!1);return this._createEntry(e,"mpf-offer-text mpf-tc-reference")},_createCopyOfferEntry(){const e=this._createSelectField(s.Fields.COPY_FROM,n.get("copyOfferTexts"),n.get("selectOffer"),[{value:l.VALUE,label:n.get("value")}]);return e.setReadOnly(!0),this._createEntry(e,"mpf-offer-select-field mpf-copy-offer")},_createEligibilityBlueBox(){return this.eligibilityBlueBoxInput=this._createTextField(s.Fields.ELIGIBILITY_BLUE_BOX,n.get("eligibilityBlueBox"),n.get("enterText"),!0,!1),this._createEntry(this.eligibilityBlueBoxInput,"mpf-offer-text mpf-eligibility-blue-box")},_createEligibilityTooltip(){return this.eligibilityTooltipInput=this._createTextField(s.Fields.ELIGIBILITY_TOOLTIP,n.get("eligibilityTooltip"),n.get("enterText"),!0,!0,2),this._createEntry(this.eligibilityTooltipInput,"mpf-offer-text mpf-eligibility-tooltip")},_createDescription(){return this.descriptionInput=this._createTextField(s.Fields.DESCRIPTION,n.get("description"),n.get("enterText"),!0,!1),this._createEntry(this.descriptionInput,"mpf-offer-text mpf-description")},_createOfferDetails(){return this.offerDetailsInput=this._createTextField(s.Fields.DETAILS,n.get("offerDetails"),n.get("enterText"),!0,!0,3),this._createEntry(this.offerDetailsInput,"mpf-offer-text mpf-details")},_createEligibilitySection(){return this.eligibilitySectionInput=this._createTextField(s.Fields.ELIGIBILITY,n.get("eligibilitySection"),n.get("enterText"),!0,!0,2),this._createEntry(this.eligibilitySectionInput,"mpf-offer-text mpf-eligibility-section")},_createMoreInfo(){return this.moreInfosInput=this._createTextField(s.Fields.MORE_INFO,n.get("moreInfo"),n.get("enterText"),!0,!1),this._createEntry(this.moreInfosInput,"mpf-offer-text mpf-more-info")},checkAllRequiredFields(){const e=[this.offerNameInput,this.eligibilityBlueBoxInput,this.eligibilityTooltipInput,this.descriptionInput,this.offerDetailsInput,this.eligibilitySectionInput,this.moreInfosInput];let t=!0;return e.forEach(e=>{!e.validate().isValid&&t&&(t=!1)}),t}});return c.Events=o,c}),define("DS/MPFMarketplaceAdmin/offerManagement/StateProgressTile",["UWA/Class/View","UWA/Core","DS/MPFServices/ObjectService","DS/MPFOfferModel/OfferCreationModel","i18n!DS/MPFMarketplaceAdmin/assets/nls/OfferManagement"],function(e,t,s,r,i){"use strict";const a=[r.States.DRAFT,r.States.SUBMITTED,r.States.APPROVED,r.States.REJECTED,r.States.ACTIVE,r.States.INACTIVE],n=e.extend({className:"mpf-state-progress",setup(e={}){this.offerCreationModel=e.offerCreationModel},render(){return this.container.setContent([this._getProgressBarContainer(),this._getOfferStatusContainer()]),this},destroy(){this._parent(),this.container=null},_computeStepWidth(e){const t=Object.keys(a).length;return a[e]/t},_getProgressBarContainer(){return t.createElement("div",{class:"mpf-progress-bar",html:[{tag:"span",class:"mpf-grey-bar"},{tag:"span",class:"mpf-green-bar",styles:{width:this._createGreenBar()}}]})},_createGreenBar(){const e=this.offerCreationModel.getState();return(a.findIndex(t=>t===e)+1)/a.length*100+"%"},_getOfferStatusContainer(){return t.createElement("div",{class:"mpf-state",html:[t.createElement("span",{class:"mpf-state-label",text:i.get(this.offerCreationModel.getState().toLowerCase())})]})}});return n.States=a,n}),define("DS/MPFMarketplaceAdmin/platformCreation/PlatformCreationForm",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Alert","DS/MPFBusinessExperienceDevPlatform/BusinessExperienceDevPlatformModel","DS/MPFView/FieldTextInputV2","i18n!DS/MPFMarketplaceAdmin/assets/nls/PlatformCreation","css!DS/MPFMarketplaceAdmin/MPFMarketplaceAdmin.css"],(e,t,s,r,i,a,n)=>{"use strict";const o=Object.freeze({BACK:"back"}),l=t.extend({className:"mpf-platform-creation-form",setup(e){this.beDevPlatform=e.beDevPlatform,this.alert=this._createAlert(),this.backButton=this._createBackButton(),this.adminPlatformField=this._createAdminPlatformField(),this.createPlatformButton=this._createCreatePlatformButton()},render(){return this.container.setContent([this.backButton,this.alert,this.adminPlatformField.render(),this.createPlatformButton]),this},destroy(){this._parent()},_createAlert:()=>new r({fullWidth:!0}),_createBackButton(){return e.createElement("div",{class:"mpf-back-button fonticon fonticon-chevron-left",events:{click:this._onBack.bind(this)}})},_createAdminPlatformField(){return new a({model:this.beDevPlatform,fieldName:i.Fields.PLATFORM_ADMIN,fieldLabel:n.get("devPlatformAdmin"),required:!0,dynamicValidation:!0})},_createCreatePlatformButton(){return new s({value:n.get("createPlatform"),className:"primary",events:{onClick:this._onCreatePlatform.bind(this)}})},_onCreatePlatform(){this.createPlatformButton.load(!0,n.get("sendingRequest")),this.beDevPlatform.savePromise(void 0,{retry:0}).then(()=>{this.dispatchEvent(o.BACK)}).catch(()=>{this.alert.show(),this.alert.add({className:"error",message:n.get("unableToRequestPlatformCreation")})}).finally(()=>{this.createPlatformButton.load(!1)})},_onBack(){this.dispatchEvent(o.BACK)}});return l.Events=o,l}),define("DS/MPFMarketplaceAdmin/orderCancellation/CardProductList",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","i18n!DS/MPFMarketplaceAdmin/assets/nls/OrderCancellation"],function(e,t,s,r){"use strict";const i=Object.freeze({}),a=Object.freeze({COLLAPSED:"collapsed",EXPANDED:"expanded"}),n=e.extend({className:"mpf-cart-product-list",setup({cart:e,locale:r,state:i}={}){t.requiredOfPrototype(e,s,"options.cart must be a CartModel"),this.cart=e,this.locale=r,this.state=i||a.COLLAPSED},render(){const e=this.cart.getItems(),t=this.state===a.EXPANDED?e.map(e=>this._renderBodyCells(e)):[this._renderBodyCells(this.cart.getItems()[0])];return this.container.setContent([{tag:"div",class:"mpf-table",html:[{tag:"div",class:"mpf-table-header",html:this._renderHeaderCells()},{tag:"div",class:"mpf-table-body",html:t}]},e.length>1&&this._renderShowMoreContainer()]),this},_renderHeaderCells:()=>[r.get("products"),r.get("subscription"),r.get("quantity"),r.get("unitPrice"),r.get("totalPrice")].map(e=>({tag:"div",class:"mpf-th-cell",text:e})),destroy(){this.cart=null,this._parent(),this.container=null},_renderBodyCells(e){if(!e)return;const t=parseInt(e.getQuantity()),s=e.getUnitNetAmount();let i=e.getLicensingScheme();"QRC"===i&&(i="QSC");const a=[{tag:"div",class:"mpf-product-title-cell",html:[{tag:"div",class:"mpf-cart-item-name",text:e.getProductDisplayName()},{tag:"div",class:"mpf-product-number-container",html:[{tag:"span",class:"mpf-label",text:r.get("productNumber")},{tag:"span",class:"mpf-value",text:e.getProductNumber()}]}]}];return[i,t,this._renderPrice(s),this._renderPrice(s*t)].forEach(e=>{a.push({tag:"td",text:e})}),a},_renderShowMoreContainer(){return{tag:"div",class:"mpf-show-more-container",html:[{tag:"a",text:this.state===a.EXPANDED?r.get("showLess"):r.get("showMore"),events:{click:()=>{this.state=this.state===a.EXPANDED?a.COLLAPSED:a.EXPANDED,this.render()}}}]}},_renderPrice(e){return parseFloat(e).toLocaleString(this.locale,{style:"currency",currency:this.cart.getCurrency()})}});return n.Events=i,n}),define("DS/MPFMarketplaceAdmin/sellerRoles/SellerRolesUserSearch",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","i18n!DS/MPFMarketplaceAdmin/assets/nls/SellerRoles","css!DS/MPFMarketplaceAdmin/MPFMarketplaceAdmin.css"],(e,t,s,r,i)=>{"use strict";const a=Object.freeze({SEARCH_USER:"searchUser"}),n=e.extend({className:"mpf-user-search",setup(){this.input=this._createLoginEmailInput(),this.button=this._createSearchButton()},render(){return this.container.setContent([{tag:"h4",text:i.get("userSearch")},{tag:"label",text:i.get("loginEmail")},{tag:"div",class:"mpf-user-search",html:[{tag:"div",class:"mpf-user-search-container",html:[this.input,this.button]},{tag:"hr"}]}]),this},destroy(){this.SellerRolesUserSearch=null,this._parent()},_searchUser(){const e=this.input.getValue();this.dispatchEvent(a.SEARCH_USER,{user:e})},_createLoginEmailInput:()=>new r({placeholder:i.get("enterEmailOrLogin"),attributes:{type:"email",id:"email"}}),_createSearchButton(){return new s({className:"primary",value:"Search",events:{onClick:this._searchUser.bind(this)}})}});return n.Events=a,n}),define("DS/MPFMarketplaceAdmin/AccessForbiddenPage",["UWA/Class/View","i18n!DS/MPFMarketplaceAdmin/assets/nls/AccessForbiddenPage","css!DS/MPFMarketplaceAdmin/MPFMarketplaceAdmin.css"],function(e,t){"use strict";const s=Object.freeze({}),r=e.extend({className:"mpf-access-forbidden-page",setup(){},render(){return this.container.setContent([{tag:"div",class:"fonticon fonticon-block"},{tag:"div",class:"mpf-title",text:t.get("accessForbidden")}]),this},destroy(){this._parent(),this.container=null}});return r.Events=s,r}),define("DS/MPFMarketplaceAdmin/orderCancellation/CancellationModalFileInput",["UWA/Core","UWA/Class/View","DS/MPFView/DropZone","DS/MPFView/ControlsTag","DS/MPFServices/ObjectService","DS/MPFDocumentModel/DocumentFactory","DS/MPFDocumentModel/DocumentModel","DS/MPFCartModel/CartCancellationModel"],function(e,t,s,r,i,a,n,o){"use strict";const l=Object.freeze({}),c=t.extend({className:"mpf-cancellation-modal-file-input",setup({documentFactory:e}={}){i.requiredOfPrototype(e,a,"options.documentFactory must be a DocumentFactory"),this.documentFactory=e,this.hiddenInput=this._createHiddenInput(),this.dropZone=this._createDropZone(),this.files=[]},render(){return this.container.setContent([this.hiddenInput,this.dropZone.render(),this._createFileList()]),this},reset(){return this.files=[],this},save({cartCancellation:e}={}){return i.requiredOfPrototype(e,o,"options.cart must be a CartCancellationModel"),Promise.all(this.files.map(t=>{return this.documentFactory.createModel(a.Types.DOCUMENT,{[n.Fields.CART_ID]:e.get("id"),[n.Fields.TYPE]:n.Types.CART_CANCELLATION}).saveDocument({file:t})}))},destroy(){this.stopListening(),this.dropZone.destroy(),this._parent(),this.container=null},_addFiles({files:e}){this.files=this.files.concat(e),this.render()},_deleteFile(e){this.files.splice(e,1),this.render()},_createFileList(){return e.createElement("div",{class:"mpf-file-list",html:this.files.map(this._createFileItem.bind(this))})},_createFileItem(e,t){const s=new r({value:e.name,isReadOnly:!0});return this.listenTo(s,r.Events.DELETE,this._deleteFile.bind(this,t)),s.render()},_createHiddenInput(){const t=this;return e.createElement("input",{attributes:{multiple:!0,name:"documents",type:"file"},events:{change:function(){t._addFiles({files:[...this.files]}),this.value=""}}})},_createDropZone(){const e="draggable"in document.createElement("span")?"":"mpf-mobile",t=new s({acceptedFileTypes:["application/pdf","image/png","image/jpeg","image/bmp","image/gif"],additionalClassName:e});return this.listenTo(t,s.Events.ON_CLICK,()=>{this.hiddenInput.click()}),this.listenTo(t,s.Events.ON_DROP,this._addFiles.bind(this)),t}});return c.Events=l,c}),define("DS/MPFMarketplaceAdmin/offerManagement/SubscriptionPlanProductLine",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Button","DS/UIKIT/Input/Number","DS/MPFServices/ObjectService","i18n!DS/MPFMarketplaceAdmin/assets/nls/OfferManagement"],function(e,t,s,r,i,a,n){"use strict";const o=Object.freeze({REMOVE_PRODUCT:"RemoveProduct",COMPUTE_NET_PRICE:"ComputeNetPrice",ADJUST_CHANGED:"AdjustChanged"}),l=e.extend({className:"mpf-subscription-plan-product-line",tagName:"tr",setup(e={}){this.offerCreationModel=e.offerCreationModel,this.portfolioPackCollection=e.portfolioPackCollection,this.name=e.name,this.trigram=e.trigram,this.listPrice=e.listPrice,this.mainComponent=e.mainComponent,this.productName=this._createTextColumn("name",this.name),this.productTrigram=this._createTextColumn("trigram",this.trigram),this.productListPrice=this._createTextColumn("listPrice",this._formatNumber(this.listPrice)),this.productPercentage=this._createColumn("",""),this.productPercentageOfferPrice=this._createTextColumn("percentage-price",this._formatNumber(this.listPrice)),this.productAdjust=this._createAdjustInput(),this.productKey=this._createKeyInput(),this.netPriceOfferPrice=this._createTextColumn("net-offer-price",this._formatNumber(this.listPrice)),this.removeButton=this._createRemoveButton(),this.mainComponent||this.disableElements()},render(){return this.container.setContent([this.productName,this.productTrigram,this.productListPrice,this.productPercentage,this.productPercentageOfferPrice,this.productAdjust,this.productKey,this.netPriceOfferPrice,this.removeButton]),this},destroy(){this.stopListening(),this.offerCreationModel=null,this.portfolioPackCollection=null,this.name=null,this.trigram=null,this.listPrice=null,this.productName=null,this.productTrigram=null,this.productListPrice=null,this.productPercentage=null,this.productPercentageOfferPrice=null,this.productAdjust=null,this.adjust&&this.adjust.destroy(),this.productKey=null,this.key&&this.key.destroy(),this.netPriceOfferPrice=null,this.removeButton=null,this._parent(),this.container=null},disableElements(){this.adjust.disable(),this.key.disable(),this.removeButton.hide()},_createTextColumn:(e,s)=>t.createElement("td",{class:"mpf-subscription-plan-product-line-"+e,text:s}),_createColumn:(e,s)=>t.createElement("td",{class:"mpf-subscription-plan-product-line-"+e,html:[s]}),_createAdjustInput(){return this.adjust=new s({className:"mpf-toggle primary",type:"checkbox",fieldName:"adjust",label:" ",events:{onChange:this.dispatchEvent.bind(this,o.ADJUST_CHANGED,this.trigram)}}),this.listPrice||this.adjust.disable(),this._createColumn("adjust-input",this.adjust)},_createKeyInput(){return this.key=new i({fieldName:n.get("key"),min:0,max:100,step:.01,disabled:!0,events:{onChange:this.dispatchEvent.bind(this,o.COMPUTE_NET_PRICE,this.trigram)}}),this._createColumn("key-input",this.key)},_createRemoveButton(){const e=new r({value:n.get("remove"),className:"error mpf-remove-button",icon:"fonticon fonticon-trash ",events:{onClick:this.removeButtonClicked.bind(this)}});return t.createElement("td",{class:"mpf-subscription-plan-product-line-remove",html:[e]})},removeButtonClicked(){const e=this.offerCreationModel.getProducts();if(e.find(e=>e===this.trigram)){const t=e.indexOf(this.trigram);e.splice(t,1)}this.dispatchEvent(o.REMOVE_PRODUCT,this.trigram),this.destroy()},getListPrice(){return this._unformatNumber(this.productListPrice.getText())},setNetPrice(e){this.netPriceOfferPrice.setText(this._formatNumber(e))},getNetPrice(){return this._unformatNumber(this.netPriceOfferPrice.getText())},setPercentage(e){this.productPercentageOfferPrice.setText(this._formatNumber(e))},getPercentage(){return this._unformatNumber(this.productPercentageOfferPrice.getText())},_formatNumber:e=>new Intl.NumberFormat("fr-FR").format(e),_unformatNumber:e=>e.toString().replace(/\s+/g,"").replace(",",".")});return l.Events=o,l}),define("DS/MPFMarketplaceAdmin/orderCancellation/AttachmentsTile",["UWA/Class/View","DS/UIKIT/Spinner","DS/UIKIT/Mask","DS/UIKIT/Input/File","DS/MPFServices/ObjectService","DS/MPFPersonModel/PersonModel","DS/MPFCartModel/CartModel","DS/MPFDocumentModel/DocumentModel","DS/MPFDocumentModel/DocumentFactory","i18n!DS/MPFMarketplaceAdmin/assets/nls/OrderCancellation"],function(e,t,s,r,i,a,n,o,l,c){"use strict";const h=Object.freeze({}),d=Object.freeze({INITIAL:"initial",LOADED:"loaded"}),u=e.extend({className:"mpf-attachments-tile",setup({me:e,cart:t,documentFactory:s,state:r=d.INITIAL}={}){i.requiredOfPrototype(e,a,"options.me must be a PersonModel"),i.requiredOfPrototype(t,n,"options.cart must be a CartModel"),i.requiredOfPrototype(s,l,"options.documentFactory must be a DocumentFactory"),this.cart=t,this.documentFactory=s,this.state=r,this.documents=this._createDocCollection(),this.spinner=this._createSpinner(),(e.hasRole(a.Roles.PRICER)||e.hasRole(a.Roles.SALES_ADMIN))&&(this.fileInput=this._createFileInput())},render(){let e;return this.state===d.INITIAL?(e=[this.spinner],this._fetchFiles()):e=[{tag:"div",class:"mpf-doc-lines",html:[this._renderDocLines()]},this.fileInput],this.container.setContent(e),this},destroy(){this.cart=null,this.documentFactory=null,this._parent(),this.container=null},async _fetchFiles(){s.mask(this.container),await Promise.all(this.documents.map(e=>e.fetchPromise())),s.unmask(this.container),this.state=d.LOADED,this.render()},async _uploadFile(e){const t=e.target.files[0],r=this.documentFactory.createModel(l.Types.DOCUMENT,{[o.Fields.CART_ID]:this.cart.get("id"),[o.Fields.TYPE]:o.Types.CART_CANCELLATION});s.mask(this.container),await r.saveDocument({file:t}),s.unmask(this.container),this.documents.push(r),this.render()},_createDocCollection(){const e=this.cart.get(n.Fields.DOCUMENT_IDS),t=e?e.map(e=>({id:e})):[];return this.documentFactory.createCollection(l.Types.DOCUMENT,t)},_renderDocLines(){return this.documents.size()>0?this.documents.map(e=>this._renderDocLine(e)):{tag:"div",class:"mpf-no-doc-comment",text:c.get("noDocumentUploaded")}},_renderDocLine:e=>({tag:"div",class:"mpf-doc-line",html:[{tag:"span",class:"mpf-doc-name",text:e.get(o.Fields.NAME)},{tag:"span",class:"mpf-icon fonticon fonticon-download",events:{click:()=>{window.open(e.get(o.Fields.URL))}}}]}),_createFileInput(){return new r({input:!1,buttonText:c.get("attachFile"),events:{onChange:this._uploadFile.bind(this)}})},_createSpinner:()=>new t({visible:!0})});return u.Events=h,u}),define("DS/MPFMarketplaceAdmin/offerManagement/FieldDateInput",["UWA/Core","UWA/String","UWA/Class/View","DS/UIKIT/Input/Date","DS/UIKIT/IconDropdown","DS/MPFView/ValidationResultBuilder","i18n!DS/MPFView/assets/nls/FieldTextInput","css!DS/MPFView/MPFView"],function(e,t,s,r,i,a,n){"use strict";const o=Object.freeze({UPDATE:"update"}),l=s.extend({className:"mpf-entry mpf-date",domEvents:{change:"onChange"},setup(e={}){this.fieldName=e.fieldName,this.fieldLabel=e.fieldLabel,this.saveOnChange=!0===e.saveOnChange,this.placeholder=e.placeholder,this.useIsoFormat=e.useIsoFormat,this.renderDatePickerInside=!0===e.renderDatePickerInside,this.wrapper=this._createWrapper(),e.additionalClassName&&this.container.addClassName(e.additionalClassName)},render(){let e;return this.renderDatePickerInside?((e=this.container.getElement("label"))&&e.remove(),this.wrapper.inject(this.container,"top")):this.container.setContent(this.wrapper),this},onChange(){const e=this.input.getDate();if(e){const t=e.getDate(),s=e.getMonth()+1,r=e.getFullYear(),i=this.useIsoFormat?r+"-"+s+"-"+t:s+"/"+t+"/"+r;this.validate().isValid&&(this.model.set(this.fieldName,i),this.saveOnChange&&this.model.savePromise(this.model.pick(this.fieldName),{patch:!0}),this.dispatchEvent(o.UPDATE,this.model))}},setMinDate(e){this.min=e,this.input&&this.input.setMinDate(e)},setMaxDate(e){this.max=e,this.input&&this.input.setMaxDate(e)},getDate(){return this.input.getDate()},getValue(){return this.input.getValue().trim()},validate(){const e=new a;this._clearValidationErrors();const s=""===this.getValue();if(this.required&&s&&e.addError(this.fieldName,t.format(n.get("requiredField"),this.fieldLabel)),e.isValid){const t={};t[this.fieldName]=this.getValue();const s=this.model.validate(t);s&&s.filter(this._resultByFieldName.bind(this)).forEach(function(t){e.addError(this.fieldName,t.message)},this)}const r=e.build();return this.showValidationErrors(r),r},showValidationErrors(t){this.container.removeClassName("mpf-invalid"),this.container.getElements(".mpf-error").forEach(function(e){e.remove()}),t.isValid||(this.container.addClassName("mpf-invalid"),t.errors.forEach(function(t){return e.createElement("p",{class:"mpf-error",text:t.message}).inject(this.container)},this))},_clearValidationErrors(){this.container.removeClassName("mpf-invalid"),this.container.getElements(".mpf-error").forEach(function(e){e.remove()})},_resultByFieldName(e){return e.fieldName===this.fieldName||e.field===this.fieldName},_createWrapper(){const t=e.createElement("span",{class:"mpf-label",text:this.fieldLabel});if(this.required){const s=e.createElement("em",{class:"mpf-required",text:"*"});t.addContent(["&nbsp;",s])}return this.input=this._createInput(),this.target=this._createTarget(),this.iconDropdown=this._createIconDropdown(this.target),e.createElement("div",{html:[e.createElement("label",{html:[t,this.target,this.iconDropdown.hide()]}),this.input]})},_createInput(){const e={value:this.model.get(this.fieldName)||"",name:this.fieldName||"",placeholder:this.placeholder,className:"mpf-"+this.fieldName,pickerClassName:"mpf-"+this.fieldName+"-datepicker"};return this.renderDatePickerInside&&(e.renderTo=this.container),new r(e)},_createTarget:()=>e.createElement("div",{class:"fonticon fonticon-math-equal fonticon-clickable"}),_createIconDropdown:e=>new i({target:e,items:[{fonticon:"fonticon fonticon-math-less-than-equal "},{selected:!0,fonticon:"fonticon fonticon-math-equal "},{fonticon:"fonticon fonticon-math-greater-than-equal "}],events:{onClick:function(t,s){e.set("class",s.elements.icon.className)}}})});return l.Events=o,l}),define("DS/MPFMarketplaceAdmin/offerManagement/AutocompleteInput",["UWA/Core","UWA/String","UWA/Class/View","DS/UIKIT/Autocomplete","DS/MPFServices/ObjectService","DS/MPFView/ValidationResultBuilder","i18n!DS/MPFMarketplaceAdmin/assets/nls/OfferManagement"],function(e,t,s,r,i,a,n){"use strict";const o=Object.freeze({UPDATE:"update"}),l=s.extend({className:"mpf-entry-autocomplete-input",setup(e={}){this.fieldName=e.fieldName,this.fieldLabel=e.fieldLabel,this.required=!0===e.required,this.offersList=e.offersList,this.saveOnChange=!0===e.saveOnChange,this.model=e.model,this.autocomplete=this._createAutocomplete(),this.entry=this._createEntry(this.fieldLabel)},render(){return this.container.setContent(this.entry),this},destroy(){this.entry.destroy(),this.autocomplete=null,this.offersList=null,this._parent(),this.container=null},_onSelect(){const e={[this.fieldName]:this.getValue()};this.model.get(this.fieldName)!==this.getValue()&&this.validate()&&this.model.set(e,{silent:this.silent}),this.dispatchEvent(o.UPDATE,this.model)},getValue(){return this.autocomplete.getValue()},setValue(e){this.autocomplete.onSelect(e)},getItemByLabel(e){return this.autocomplete.getItemByLabel(e)},_createDataSetConfig(){return{dataParser:(e,t)=>this._createItems(t),searchEngine:(e,t)=>e.dataParser(e,this._createMatchingItems(t))}},_createMatchingItems(e){const t=e.toLowerCase(),s=[];return this.offersList.forEach(e=>{e.getName().toLowerCase().contains(t)&&s.push(e)}),s},validate(){const e=new a;this._removeErrorMessage();const s=""===this.getValue();this.required&&s&&e.addError(this.fieldName,t.format(n.get("requiredField"),this.fieldLabel));const r=e.build();return r.isValid||this._displayErrorMessage(r),r},_displayErrorMessage(t){const s=t.errors[0];this.container.addClassName("mpf-invalid"),e.createElement("p",{class:"mpf-error",text:e.is(s.message)?s.message:""}).inject(this.container)},_removeErrorMessage(){this.container.removeClassName("mpf-invalid");const t=this.container.getElement("p");e.is(t)&&this.container.removeChild(t)},_createItems:e=>e.map(e=>({value:e.getName(),label:e.getName(),subLabel:e.getTitle()})),_createAutocomplete(){return new r({showSuggestsOnFocus:!0,datasets:[{configuration:this._createDataSetConfig(),items:this._createItems(this.offersList)}],events:{onSelect:this._onSelect.bind(this)}})},_onShowSuggests(){this.autocomplete.onShowSuggests()},_createEntry(t){const s=[];s.push(t),this.required&&""!==t&&s.push('&nbsp;<em class="mpf-required">*</em>');const r=[];return r.push(e.createElement("span",{class:"mpf-label",html:s})),r.push(this.autocomplete),e.createElement("label",{html:r})}});return l.Events=o,l}),define("DS/MPFMarketplaceAdmin/platformCreation/AddRolesModal",["UWA/Class/View","UWA/Core","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/MPFBusinessExperienceDevPlatform/BusinessExperienceDevPlatformModel","DS/MPFBusinessExperienceDevPlatform/BusinessExperienceDevPlatformFactory","DS/MPFMarketplaceAdmin/platformCreation/AddRoleLine","i18n!DS/MPFMarketplaceAdmin/assets/nls/PlatformCreation","css!DS/MPFMarketplaceAdmin/MPFMarketplaceAdmin.css"],(e,t,s,r,i,a,n,o,l,c)=>{"use strict";const h=Object.freeze({ON_SAVED:"onSaved",LINES_UPDATED:"linesUpdated"}),d=e.extend({className:"mpf-add-roles-modal",setup({beDevPlatformFactory:e}={}){this.beDevPlatformFactory=e,this.addedRolesLines=[],this.alert=this._createAlert(),this.saveButton=this._createSaveButton(),this.modal=this._createModal(),this.addedRolesContainer=this._createAddedRolesContainer()},render(){return this.container.setContent(this.modal),this},show({tenantProductList:e,order:t}){this.tenantProductList=e,this.order=t,this.modal.setHeader(this._createModalHeader()),this.modal.setBody(this._createModalBody()),this.modal.show()},hide(){this.modal.hide()},destroy(){this.stopListening(),this.modal.destroy(),this.addedRolesLines.forEach(e=>e.destroy()),this.addedRolesLines=null,this.tenantProductList=null,this.order=null,this.beDevPlatformFactory=null,this._parent(),this.container=null},_createModalHeader(){return t.createElement("h4",{class:"mpf-header",text:c.get("onlineInstanceId")+" "+this.tenantProductList.getTenant()})},_createModal(){return new s({className:"mpf-add-roles-modal",visible:!1,closable:!0,footer:[this.saveButton]})},_createAlert:()=>new i({visible:!1,autoHide:!0,hideDelay:5e3}),_createModalBody(){const e=t.createElement("div",{class:"mpf-roles",text:c.get("roles")});this.addedRolesLines=[],this.addedRolesContainer.setContent(this.addedRolesLines),this._addRoleLine();const s=new a({className:"mpf-add-role default",value:c.get("addRole"),events:{onClick:this._addRoleLine.bind(this)}});return[this.alert,e,this.addedRolesContainer,s]},_addRoleLine(){let e=this._getSelectableProducts();if(e.length>0){const t=new l({product:e[0]});this.listenTo(t,l.Events.REMOVE,e=>{const[t]=this.addedRolesLines.splice(this.addedRolesLines.findIndex(t=>t.getSelectedProduct()===e),1);t.destroy(),this.onProductChangedOrRemoved()}),this.listenTo(t,l.Events.PRODUCT_CHANGE,()=>this.onProductChangedOrRemoved()),this.addedRolesLines.push(t),e=this._getSelectableProducts(),this.addedRolesContainer.setContent(this.addedRolesLines.map(t=>t.render({products:e})))}},_getSelectableProducts(){const e=[...this.tenantProductList.getProducts()];return this.addedRolesLines.forEach(t=>{const s=t.getSelectedProduct();e.splice(e.indexOf(s),1)}),e},onProductChangedOrRemoved(){const e=this._getSelectableProducts();this.addedRolesLines.forEach(t=>t.render({products:e})),this.dispatchEvent(h.LINES_UPDATED)},_createAddedRolesContainer(){return t.createElement("div",{class:"mpf-added-roles",html:this.addedRolesLines})},_createSaveButton(){return new a({className:"mpf-confirm primary",value:c.get("confirm"),events:{onClick:this._save.bind(this)}})},async _save(){const e={};this.addedRolesLines.forEach(t=>{e[t.getSelectedProduct()]=t.getSelectedQuantity()});const t=this.beDevPlatformFactory.createModel(o.Types.BUSINESS_EXP_DEV_PLATFORM,{[n.Fields.PLATFORM_ID]:this.tenantProductList.getTenant()});r.mask(this.modal.getBody()),this.saveButton.load(!0);try{await t.savePromise({[n.Fields.ADDED_PRODUCTS]:[e]},{patch:!0}),this.hide(),this.dispatchEvent(h.ON_SAVED)}catch(e){console.error(e),this.alert.add({className:"error",message:c.get("unableToAddRolesToPlatform")}).show()}r.unmask(this.modal.getBody()),this.saveButton.load(!1)}});return d.Events=h,d}),define("DS/MPFMarketplaceAdmin/orderCancellation/CompactCardHeader",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFMarketplaceAdmin/orderCancellation/CartStateTile","i18n!DS/MPFMarketplaceAdmin/assets/nls/OrderCancellation"],function(e,t,s,r,i,a){"use strict";const n=Object.freeze({ON_CLICK:"onClick",DOWNLOAD_FILE:"downloadFile"}),o=t.extend({className:"mpf-compact-card-header",domEvents:{click:"_onClick"},setup({cart:e,locale:t}={}){this.cart=e,this.locale=t,this.cartStateTile=this._createCartStateTile()},render(){return this.container.setContent([{tag:"div",class:"mpf-order-name",text:this.cart.getName()},{tag:"div",class:"mpf-header-line",html:[{tag:"span",class:"mpf-label",text:a.get("owner")},{tag:"span",class:"mpf-value",text:this.cart.get("Owner")}]},this.cartStateTile.render()]),this},destroy(){this.stopListening(),this.cartStateTile.destroy(),this.cart=null,this._parent(),this.container=null},_onClick(){this.dispatchEvent(n.ON_CLICK)},_createCartStateTile(){const e=new i({cart:this.cart});return this.listenTo(e,i.Events.DOWNLOAD_FILE,this.dispatchEvent.bind(this,n.DOWNLOAD_FILE)),e}});return o.Events=n,o}),define("DS/MPFMarketplaceAdmin/offerManagement/OfferCreationHeader",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/MPFMarketplaceAdmin/offerManagement/StateProgressTile","DS/MPFServices/ObjectService","DS/MPFPersonModel/PersonModel","DS/MPFOfferModel/OfferCreationModel","i18n!DS/MPFMarketplaceAdmin/assets/nls/OfferManagement"],function(e,t,s,r,i,a,n,o){"use strict";const l=Object.freeze({SUBMIT_FOR_APPROVAL:"submitForApproval",SAVE:"save",CANCEL:"cancel",APPROVE:"approve",REJECT:"reject",ACTIVATE:"activate",DEACTIVATE:"deactivate"}),c=e.extend({className:"mpf-offer-creation-header",setup(e){this.me=e.me,this.offerCreationModel=e.offerCreationModel,this.stateTileContainer=this._creatStateTileContainer(),this.buttonsContainer=this._createButtonsContainer()},render(){if(this.offerCreationModel.getState()){const e=new r({offerCreationModel:this.offerCreationModel});this.stateTileContainer.addContent({html:[e.render()]})}return this.container.setContent([this.stateTileContainer,this.buttonsContainer]),this},destroy(){this.stopListening(),this._parent(),this.stateTileContainer=null,this.container=null},_creatStateTileContainer:()=>t.createElement("div",{class:"mpf-sate-tile"}),_createButtonsContainer(){this.buttons=[];const e=this.offerCreationModel.getState();if(this.me.hasRole(a.Roles.OFFER_ADMIN))if(this.offerCreationModel.isNew()||e===n.States.DRAFT||e===n.States.REJECTED){const e=this._createButton(o.get("submitForApproval"),"primary mpf-offer-button mpf-submit-for-approval",this.dispatchEvent.bind(this,l.SUBMIT_FOR_APPROVAL,n.States.SUBMITTED)),t=this._createButton(o.get("save"),"primary mpf-offer-button mpf-save",this.dispatchEvent.bind(this,l.SAVE,n.States.DRAFT));this.buttons.push(e,t)}else if(e===n.States.APPROVED||e===n.States.INACTIVE){const e=this._createButton(o.get("activate"),"primary mpf-offer-button mpf-activate",this.dispatchEvent.bind(this,l.ACTIVATE,n.States.ACTIVE)),t=this._createButton(o.get("save"),"primary mpf-offer-button mpf-save",this.dispatchEvent.bind(this,l.SAVE,n.States.DRAFT));this.buttons.push(e,t)}else if(e===n.States.ACTIVE){const e=this._createButton(o.get("deactivate"),"primary mpf-offer-button mpf-deactivate",this.dispatchEvent.bind(this,l.DEACTIVATE,n.States.INACTIVE)),t=this._createButton(o.get("save"),"primary mpf-offer-button mpf-save",this.dispatchEvent.bind(this,l.SAVE,n.States.DRAFT));this.buttons.push(e,t)}if(this.me.hasRole(a.Roles.PRICER)&&e===n.States.SUBMITTED){const e=this._createButton(o.get("approve"),"primary mpf-offer-button mpf-approve",this.dispatchEvent.bind(this,l.APPROVE,n.States.APPROVED)),t=this._createButton(o.get("reject"),"primary mpf-offer-button mpf-reject",this.dispatchEvent.bind(this,l.REJECT,n.States.REJECTED)),s=this._createButton(o.get("save"),"primary mpf-offer-button mpf-save",this.dispatchEvent.bind(this,l.SAVE,this.offerCreationModel.getState()));this.buttons.push(e,t,s)}const s=this._createButton(o.get("cancel"),"primary mpf-offer-button mpf-cancel",this.dispatchEvent.bind(this,l.CANCEL));return this.buttons.push(s),t.createElement("div",{class:"mpf-buttons",html:this.buttons})},enableButtonsContainer(e){e.forEach(e=>{e.enable()})},disableButtonsContainer(e){e.forEach(e=>{e.disable()})},_createButton:(e,t,r)=>new s({value:e,className:t,events:{onClick:r}})});return c.Events=l,c}),define("DS/MPFMarketplaceAdmin/orderCancellation/CommentsAttachmentsSection",["UWA/Class/View","DS/Controls/TabBar","DS/MPFServices/ObjectService","DS/MPFMarketplaceAdmin/orderCancellation/CommentsTile","DS/MPFMarketplaceAdmin/orderCancellation/AttachmentsTile","i18n!DS/MPFMarketplaceAdmin/assets/nls/OrderCancellation"],function(e,t,s,r,i,a){"use strict";const n=Object.freeze({}),o=Object.freeze({COLLAPSED:"collapsed",COMMENTS:"comments",ATTACHMENTS:"attachments"}),l=e.extend({className:"mpf-comments-attachements-section",setup({me:e,cart:t,cartNotesFactory:s,documentFactory:r,state:i}={}){this.me=e,this.cart=t,this.cartNotesFactory=s,this.documentFactory=r,this.state=i||o.COLLAPSED,this.commentsTile=this._createCommentsTile(),this.attachmentsTile=this._createAttachmentsTile()},render(){const e=[{tag:"div",class:"mpf-tabs",html:[this._renderTab("comment",a.get("comments"),o.COMMENTS),this._renderTab("attach",a.get("attachments"),o.ATTACHMENTS)]}];return this.state===o.COMMENTS?e.push(this.commentsTile.render()):this.state===o.ATTACHMENTS&&e.push(this.attachmentsTile.render()),this.container.setContent(e),this},destroy(){this.me=null,this.cart=null,this.cartNotesFactory=null,this.documentFactory=null,this._parent(),this.container=null},_renderTab(e,t,s){return{tag:"span",class:"mpf-tab"+(this.state===s?" mpf-selected":""),html:[{tag:"span",class:"fonticon fonticon-"+e},{tag:"span",class:"mpf-tab-label",text:t}],events:{click:()=>{this.state===s?this.state=o.COLLAPSED:this.state=s,this.commentsTile.reset(),this.render()}}}},_createCommentsTile(){return new r({me:this.me,cart:this.cart,cartNotesFactory:this.cartNotesFactory})},_createAttachmentsTile(){return new i({me:this.me,cart:this.cart,documentFactory:this.documentFactory})}});return l.Events=n,l}),define("DS/MPFMarketplaceAdmin/offerManagement/OfferManagementFilterCommands",["UWA/Core","UWA/Class/View","DS/MPFView/FieldTextInputV2","DS/MPFView/FieldSelectInputV2","DS/UIKIT/Input/Button","DS/MPFView/FieldToggleInput","DS/MPFMarketplaceAdmin/offerManagement/FieldDateInput","DS/MPFMarketplaceAdmin/offerManagement/AutocompleteInput","DS/MPFServices/ObjectService","DS/MPFOfferModel/OfferCollectionFilterModel","DS/MPFOfferModel/OfferCreationModel","DS/MPFPersonModel/PersonModel","i18n!DS/MPFMarketplaceAdmin/assets/nls/OfferManagement"],function(e,t,s,r,i,a,n,o,l,c,h,d,u){"use strict";const f=Object.freeze({NEW_REQUEST_OFFER:"newRequestOffer",REFRESH:"refresh"}),m=Object.freeze({DRAFT:"Draft",SUBMITTED:"Submitted",APPROVED:"Approved",REJECTED:"Rejected",ACTIVE:"Active",INACTIVE:"Inactive"}),p=Object.freeze({YEARLY:"YSC",QUATERLY:"QSC",MONTHLY:"MSC"}),C=t.extend({className:"mpf-offer-management-filter-commands",setup(e){this.me=e.me,this.offerFilters=e.offerFilters,this.renewWithOffers=e.renewWithOffers,this.nameEntry=this._createNameEntry(),this.urlEntry=this._createUrlEntry(),this.statusEntry=this._createStatusEntry(),this.subscriptionPlanEntry=this._createSubscriptionPlanEntry(),this.customerProfileEntry=this._createCustomerProfileEntry(),this.startDateEntry=this._createStartDateEntry(),this.endDateEntry=this._createEndDateEntry(),this.renewalEntry=this._createRenewalEntry(),this.renewWithEntry=this._createRenewWithEntry(),this.offerRequestButton=this._createRequestOfferButton()},render(){const e=[];return this.me.hasRole(d.Roles.OFFER_ADMIN)&&e.push(this.offerRequestButton),e.push([this.nameEntry,this.urlEntry,this.statusEntry,this.subscriptionPlanEntry,this.customerProfileEntry,this.startDateEntry,this.endDateEntry,this.renewalEntry,this.renewWithEntry]),this.container.setContent([e]),this},destroy(){this.stopListening(),this._parent(),this.offerRequestButton=null,this.nameEntry=null,this.urlEntry=null,this.statusEntry=null,this.subscriptionPlanEntry=null,this.customerProfileEntry=null,this.startDateEntry=null,this.endDateEntry=null,this.renewalEntry=null,this.renewWithEntry=null},_createEntry:(t,s)=>e.createElement("div",{class:s,html:[t.render()]}),_createToggleEntry:(t,s,r)=>e.createElement("div",{class:t,html:[e.createElement("div",{class:"mpf-label",text:s}),r.render()]}),_createTextField(e,t,r){const i=new s({model:this.offerFilters,fieldName:e,fieldLabel:t,placeholder:r,dynamicValidation:!0,silent:!1});return this.listenTo(i,s.Events.UPDATE,this.dispatchEvent.bind(this,f.REFRESH)),i},_createAutocompleteInput(e,t){const s=new o({model:this.offerFilters,fieldName:e,fieldLabel:t,saveOnChange:!0,offersList:this.renewWithOffers,fetchOptions:{getRenewWith:!0,YSC:!0,QSC:!0,MSC:!0}});return this.listenTo(s,o.Events.UPDATE,this.dispatchEvent.bind(this,f.REFRESH)),s},_createSelectField(e,t,s,i){const a=new r({model:this.offerFilters,fieldName:e,fieldLabel:t,placeholder:s,selectableOptions:i,dynamicValidation:!0,silent:!1,multipleOptionsSelectable:!1});return this.listenTo(a,r.Events.UPDATE,this.dispatchEvent.bind(this,f.REFRESH)),a},_createToggleField(e,t){const s=new a({model:this.offerFilters,fieldName:e,fieldLabel:t,dynamicValidation:!1});return this.listenTo(s,a.Events.UPDATE,this.dispatchEvent.bind(this,f.REFRESH)),s},_createDatePicker(e,t,s,r){const i=new n({additionalClassName:"mpf-offer-date-picker "+r,model:this.offerFilters,fieldName:e,fieldLabel:t,placeholder:s,useIsoFormat:!0,renderDatePickerInside:!0});return this.listenTo(i,n.Events.UPDATE,this.dispatchEvent.bind(this,f.REFRESH)),i},_createNameEntry(){const e=this._createTextField(c.Fields.FILTER_BY_NAME,u.get("name"),u.get("enterValue"));return this._createEntry(e,"mpf-offer-filter-text mpf-name")},_createUrlEntry(){const e=this._createTextField(c.Fields.FILTER_BY_URL,u.get("url"),u.get("enterValue"));return this._createEntry(e,"mpf-offer-filter-text mpf-url")},_createStatusEntry(){const e=this._createSelectField(c.Fields.FILTER_BY_STATUS,u.get("status"),u.get("selectStatus"),[{value:m.DRAFT,label:u.get("draft")},{value:m.SUBMITTED,label:u.get("submitted")},{value:m.APPROVED,label:u.get("approved")},{value:m.REJECTED,label:u.get("rejected")},{value:m.ACTIVE,label:u.get("active")},{value:m.INACTIVE,label:u.get("inactive")}]);return this._createEntry(e,"mpf-offer-filter-select mpf-status")},_createSubscriptionPlanEntry(){const e=this._createSelectField(c.Fields.FILTER_BY_SUBSCRIPTION_PLAN,u.get("subscriptionPlan"),u.get("selectSubscriptionPlan"),[{value:p.YEARLY,label:u.get("yearly")},{value:p.QUATERLY,label:u.get("quaterly")},{value:p.MONTHLY,label:u.get("monthly")}]);return this._createEntry(e,"mpf-offer-filter-select mpf-subscription-plan")},_createCustomerProfileEntry(){const e=this._createSelectField(c.Fields.FILTER_BY_CUSTOMER_PROFILE,u.get("customerProfile"),u.get("selectProfile"),[{value:h.CustomerProfileEnum.PARTNER,label:u.get("partner")},{value:h.CustomerProfileEnum.COMPANY,label:u.get("company")},{value:h.CustomerProfileEnum.MAKER,label:u.get("maker")},{value:h.CustomerProfileEnum.STUDENT,label:u.get("student")}]);return this._createEntry(e,"mpf-offer-filter-select mpf-customer-profile")},_createStartDateEntry(){const e=this._createDatePicker(c.Fields.FILTER_BY_START_DATE,u.get("startDate"),u.get("enterDate"),"mpf-start-date");return this._createEntry(e,"mpf-offer-filter-date mpf-start-date")},_createEndDateEntry(){const e=this._createDatePicker(c.Fields.FILTER_BY_END_DATE,u.get("endDate"),u.get("enterDate"),"mpf-end-date");return this._createEntry(e,"mpf-offer-filter-date mpf-end-date")},_createRenewalEntry(){const e=this._createToggleField(c.Fields.FILTER_BY_RENEWAL,"");return this._createToggleEntry("mpf-offer-filter-toggle mpf-renewal",u.get("renewal"),e)},_createRenewWithEntry(){const e=this._createAutocompleteInput(c.Fields.FILTER_BY_RENEW_WITH,u.get("renewWith"));return this._createEntry(e,"mpf-offer-filter-autocomplete mpf-renew-with")},_createRequestOfferButton(){return new i({value:u.get("requestOffer"),className:"primary mpf-offer-button",icon:"plus",events:{onClick:this._newOfferRequest.bind(this)}})},_newOfferRequest(){this.dispatchEvent(f.NEW_REQUEST_OFFER)}});return C.Events=f,C}),define("DS/MPFMarketplaceAdmin/platformCreation/ProductListCard",["DS/MPFMarketplaceAdmin/orderCancellation/CardProductList"],e=>e),define("DS/MPFMarketplaceAdmin/sellerRoles/SellerRolesPage",["UWA/Class/View","UWA/Core","DS/MPFMarketplaceAdmin/sellerRoles/SellerRolesUserSearch","DS/MPFMarketplaceAdmin/sellerRoles/SellerRolesContent","i18n!DS/MPFMarketplaceAdmin/assets/nls/SellerRoles","css!DS/MPFMarketplaceAdmin/MPFMarketplaceAdmin.css"],(e,t,s,r,i)=>{"use strict";return e.extend({className:"mpf-seller-roles-page",setup({personRolesFactory:e}){this.SellerRolesUserSearch=new s,this.SellerRolesContent=new r({personRolesFactory:e}),this.listenTo(this.SellerRolesUserSearch,s.Events.SEARCH_USER,({user:e})=>{this.SellerRolesContent.load({user:e})})},render(){return this.container.setContent([this._createTitle(),this.SellerRolesUserSearch.render(),this.SellerRolesContent.render()]),this},destroy(){this.stopListening(),this.SellerRolesContent.destroy(),this.SellerRolesUserSearch.destroy(),this.SellerRolesUserSearch=null,this.SellerRolesContent=null,this._parent()},_createTitle:()=>t.createElement("div",{class:"mpf-title",html:[{tag:"h3",html:i.get("marketPlaceRoles",{rolesText:t.createElement("span",{text:"seller roles",styles:{textTransform:"capitalize"}}).outerHTML})},{tag:"hr"}]})})}),define("DS/MPFMarketplaceAdmin/orderCancellation/CancellationModal",["UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/MPFView/CollapsibleModal","DS/MPFView/FieldDateInput","DS/MPFView/FieldTextInputV2","DS/MPFView/FieldSelectInputV2","DS/MPFServices/ObjectService","DS/MPFCartModel/CartCancellationFactory","DS/MPFDocumentModel/DocumentFactory","DS/MPFCartModel/CartCancellationModel","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFCartModel/CartNotesModel","DS/MPFMarketplaceAdmin/orderCancellation/CancellationModalFileInput","i18n!DS/MPFMarketplaceAdmin/assets/nls/OrderCancellation"],function(e,t,s,r,i,a,n,o,l,c,h,d,u,f,m,p,C){"use strict";const E=Object.freeze({ON_CART_UPDATE:"onCartUpdate"}),g=Object.freeze({CREATE:"create",APPROVE:"approve",REFUSE:"refuse"}),P=e.extend({className:"mpf-cancellation-modal",setup({cartCancellationFactory:e,documentFactory:t}={}){l.requiredOfPrototype(e,c,"options.cartCancellationFactory must be a CartCancellationFactory"),l.requiredOfPrototype(t,h,"options.documentFactory must be a DocumentFactory"),this.cartCancellationFactory=e,this.documentFactory=t,this.confirmationButton=this._createConfirmationButton(),this.cancelButton=this._createCancelButton(),this.modal=this._createModal(this.confirmationButton,this.cancelButton),this.alert=this._createAlert(),this.fileInput=this._createFileInput()},render(){return this.container.setContent(this.modal),this},show({state:e,cart:t,cartNotes:s,dates:r}={}){let i;l.requiredOfType(e,"string","options.state must be a string"),l.requiredOfPrototype(t,u,"options.cart must be a CartModel"),e===g.CREATE&&l.requiredOfPrototype(s,m,"options.cartNotes must be a CartNotesModel"),this.confirmationButton.setDisabled(!1),e===g.CREATE?(this.confirmationButton.setDisabled(!0),i=this.cartCancellationFactory.createModel(c.Types.CART_CANCELLATION,{[d.Fields.ORIGIN_TRANSACTION]:t.pick("id")},{parentResourceId:t.get("id")})):e===g.APPROVE&&(i=this.cartCancellationFactory.createModel(c.Types.CART_CANCELLATION,{id:t.get("id")})),this.modal.setHeader(this._renderHeader({state:e,cart:t})),this.modal.setBody(this._renderBody({state:e,cart:t,cartNotes:s,cartCancellation:i,dates:r})),this.confirmationButton.setValue(this._getButtonLabel({state:e})),this.confirmationButton.removeEvent("onClick"),this.confirmationButton.addEvent("onClick",()=>this._save({state:e,cart:t,cartNotes:s,cartCancellation:i})),this.modal.show()},hide(){this.modal.hide()},destroy(){this.modal.destroy(),this.modal=null,this._parent(),this.container=null},setLoading(e=!0,s){e?(t.mask(this.modal.getBody(),s),this.confirmationButton.disable()):(t.unmask(this.modal.getBody()),this.confirmationButton.enable())},async _save({state:e,cart:t,cartNotes:s,cartCancellation:r}){try{e===g.CREATE?(this.setLoading(!0,C.get("creatingCancellation")),await r.savePromise(),s.setCartId(r.get("id")),await Promise.all([r.savePromise({[d.Fields.STATE]:d.States.SUBMITTED},{patch:!0}),s.savePromise(),this.fileInput.save({cartCancellation:r})])):e===g.APPROVE?(this.setLoading(!0,C.get("approvingCancellation")),await r.savePromise({[d.Fields.STATE]:d.States.APPROVED,[d.Fields.REQUEST_DATE]:r.getRequestDate()},{patch:!0})):e===g.REFUSE&&(this.setLoading(!0,C.get("refusingCancellation")),r=this.cartCancellationFactory.createModel(c.Types.CART_CANCELLATION,{id:t.get("id")}),await r.savePromise({[d.Fields.STATE]:d.States.REFUSED},{patch:!0}))}catch(e){console.error(e),this.setLoading(!1);const t=e.response,s=t&&t.errorCode;let r;return r="ALREADY_CANCELLED"===s||"400"===s?C.get("orderAlreadyCancelled"):"ALREADY_RENEWED"===s?C.get("orderAlreadyRenewed"):C.get("failedToSaveModification"),void this.alert.add({className:"error",message:r}).show()}this.setLoading(!1),this.hide(),this.dispatchEvent(E.ON_CART_UPDATE,{state:e,cartCancellation:r})},_renderHeader({state:e,cart:t}){const s=t.getName();let r;switch(e){case g.CREATE:r=C.get("createCancellationFor",{cartName:s});break;case g.APPROVE:r=C.get("approveCancellationWithName",{cartName:s});break;case g.REFUSE:r=C.get("rejectCancellationWithName",{cartName:s});break;case g.EDIT:r=C.get("editCancellationWithName",{cartName:s})}return{tag:"h4",text:r}},_renderBody({state:e,cart:t,cartNotes:s,cartCancellation:r,dates:i}){return{tag:"div",html:[this.alert,{tag:"div",class:"mpf-info-text",text:this._createInfoText(e,t)},this._createCommentInput(e,s),this._createFileInputContainer(e),this._createEffectiveDateContainer(e,t,r,i),this._createReasonContainer(e,r)]}},_getButtonLabel({state:e}){let t;switch(e){case g.APPROVE:case g.REFUSE:case g.CREATE:t=C.get("confirm");break;case g.EDIT:t=C.get("save")}return t},_createInfoText(e,t){const s=t.getName();switch(e){case g.REFUSE:return C.get("confirmRejectionText",{cartName:s});default:return""}},_createCommentInput(e,t){if(e===g.CREATE)return new n({model:t,fieldName:m.Fields.PRIVATE_NOTES,fieldLabel:C.get("comments"),multiline:!0,multilineRows:3,dynamicValidation:!0}).render()},_createFileInputContainer(e){if(e===g.CREATE)return{tag:"div",class:"mpf-document-input",html:[{tag:"div",class:"mpf-label",text:C.get("attachments")},this.fileInput.reset().render()]}},_createEffectiveDateContainer(e,t,s,r){if(e===g.CREATE||e===g.APPROVE)return{tag:"div",class:"mpf-effective-date",html:[{tag:"div",class:"mpf-effective-date-input",html:this._createEffectiveDateInput(e,t,s,r)},{tag:"div",class:"mpf-effective-date-description",text:e===g.CREATE?C.get("createEffectiveDate"):C.get("approveEffectiveDate")}]}},_createReasonContainer(e,t){if(e===g.CREATE){const e=[{value:d.Reasons.DEPLOYMENT,label:C.get("deployment")},{value:d.Reasons.ORDERING,label:C.get("ordering")},{value:d.Reasons.PAYMENT,label:C.get("payment")},{value:d.Reasons.STORE_TO_FRANCE,label:C.get("storeToFrance")},{value:d.Reasons.PRODUCT_USE,label:C.get("productUse")},{value:d.Reasons.UNSATISFIED,label:C.get("unsatisfied")},{value:d.Reasons.WRONG_PRODUCT,label:C.get("wrongProduct")}],s=new o({model:t,required:!0,dynamicValidation:!0,fieldName:d.Fields.REASON,fieldLabel:C.get("reason"),selectableOptions:e,placeholder:C.get("selectReason")});return this.listenTo(s,o.Events.UPDATE,()=>{s.isValid()&&t.getReason()?this.confirmationButton.setDisabled(!1):this.confirmationButton.setDisabled(!0)}),{tag:"div",class:"mpf-reason-input",html:s.render()}}},_createEffectiveDateInput(e,t,s,r){const i=new a({model:s,dynamicValidation:!0,fieldName:d.Fields.REQUEST_DATE,fieldLabel:C.get("effectiveDate"),placeholder:C.get("enterDate"),renderDatePickerInside:!1,min:r.start&&new Date(r.start),max:r.end&&new Date(r.end)});return e===g.APPROVE&&t.getRequestDate()&&(i.setValue(t.getRequestDate()),s.set(d.Fields.REQUEST_DATE,t.getRequestDate())),i.render()},_createFileInput(){return new p({documentFactory:this.documentFactory})},_createConfirmationButton:()=>new r({className:"primary"}),_createCancelButton(){return new r({value:C.get("cancel"),events:{onClick:this.hide.bind(this)}})},_createModal(e,t){return new i({footer:[e,t],events:{onHide:()=>{this.alert.getMessages().forEach(e=>this.alert.remove(e))}}})},_createAlert:()=>new s({autoHide:!1,visible:!1})});return P.Events=E,P.States=g,P}),define("DS/MPFMarketplaceAdmin/platformCreation/PlatformOrderCardHeader",["UWA/Class/View","DS/MPFCartModel/CartModel","DS/MPFMarketplaceAdmin/orderCancellation/CartStateTile","i18n!DS/MPFMarketplaceAdmin/assets/nls/PlatformCreation","css!DS/MPFMarketplaceAdmin/MPFMarketplaceAdmin.css"],(e,t,s,r)=>{"use strict";return e.extend({className:"mpf-platform-order-card-header",setup(e){this.order=e.order,this.infoTile=this._createInfoTile(),this.stateTile=this._createStateTile()},render(){return this.container.setContent([{tag:"div",class:"mpf-header-tile mpf-order-name",text:this.order.getName()},this.infoTile,this.stateTile.render()]),this},destroy(){this._parent()},_createTile(e){if(e.find(e=>!!e))return{tag:"div",class:"mpf-header-tile",html:e}},_createLine(e,t){if(t)return{tag:"div",class:"mpf-header-line",html:[{tag:"span",class:"mpf-label",text:e},{tag:"span",class:"mpf-value",text:t}]}},_createInfoTile(){const e=this.order.getItems().find(e=>e.getOnlineInstance()),t=e&&e.getOnlineInstance();return this._createTile([this._createLine(r.get("platformId"),t),this._createLine(r.get("platformAdmin"),this.order.getPlatformAdmin())])},_createStateTile(){return new s({cart:this.order})}})}),define("DS/MPFMarketplaceAdmin/sellerRoles/SellerRolesPageFactory",["DS/MPFConnector/MarketplaceAdminConnector","DS/MPFServices/MarketplaceServices","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFCartModel/CartFactory","DS/MPFMarketplaceAdmin/sellerRoles/SellerRolesPage"],(e,t,s,r,i)=>{"use strict";return Object.freeze({async create({connector:e}){const t=s.getInstance(e),r=await t.getFactory(s.Types.PERSON_ROLES);return new i({personRolesFactory:r})}})}),define("DS/MPFMarketplaceAdmin/platformCreation/PlatformOrderCard",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFMarketplaceAdmin/platformCreation/PlatformOrderCardHeader","DS/MPFMarketplaceAdmin/platformCreation/ProductListCard","i18n!DS/MPFMarketplaceAdmin/assets/nls/PlatformCreation"],(e,t,s,r,i,a,n,o)=>{"use strict";const l=Object.freeze({ADD_ROLES:"addRoles"}),c=t.extend({className:"mpf-platform-order-card",setup({order:e}={}){r.requiredOfPrototype(e,i,"options.order must a CartModel"),this.order=e,this.header=this._createHeader(),this.productList=this._createProductList(),this.footer=this._createFooter()},render(){return this.container.setContent([this.header.render(),e.createElement("div",{class:"mpf-card-body",html:this.productList.render()}),this.footer]),this},destroy(){this._parent()},_createHeader(){return new a({order:this.order})},_createProductList(){return new n({cart:this.order})},_createFooter(){const t=this.order.getNetAmountTotal(),r=this.order.getState()===i.States.DELIVERED;return e.createElement("div",{class:"mpf-card-footer",html:[{tag:"div",class:"mpf-total-price-container",html:[{tag:"span",class:"mpf-total-price-label",text:o.get("totalPriceExclTax")},{tag:"span",class:"mpf-total-price",text:t&&t.toLocaleString(this.locale,{style:"currency",currency:this.order.getCurrency()})}]},r&&new s({value:o.get("addRoles"),icon:"plus",events:{onClick:this.dispatchEvent.bind(this,l.ADD_ROLES)}})]})}});return c.Events=l,c}),define("DS/MPFMarketplaceAdmin/offerManagement/OfferCreationFormLeftComponent",["UWA/Core","UWA/String","UWA/Class/View","DS/MPFView/FieldTextInputV2","DS/MPFView/FieldSelectInputV2","DS/UIKIT/Input/Toggle","DS/MPFOfferModel/OfferCreationModel","DS/MPFView/FieldDateInput","DS/MPFMarketplaceAdmin/offerManagement/AutocompleteInput","DS/MPFView/ValidationResultBuilder","DS/MPFServices/ObjectService","i18n!DS/MPFMarketplaceAdmin/assets/nls/OfferManagement"],function(e,t,s,r,i,a,n,o,l,c,h,d){"use strict";const u=Object.freeze({SUBSCRIPTION_PLAN_CHANGED:"SubscriptionPlanChanged"}),f=Object.freeze({TOGGLE_CHANGED:"ToggleChanged"}),m=Object.freeze({SAME_OFFER_CONDITIONS:"sameOfferConditions"}),p=s.extend({className:"mpf-offer-creation-form-left-component",setup(e){if(this.offerCreationModel=e.offerCreationModel,this.renewWithOffers=e.renewWithOffers,this.customerProfile=this._createCustomerProfileEntry(),this.subscriptionPlan=this._createSubscriptionPlanEntry(),this.renewal=this._createRenewalEntry(),this.renewWith=this._createRenewWithEntry(!1),this.url=this._createUrlEntry(),this.startDate=this._createStartDateEntry(),this.endDate=this._createEndDateEntry(),this._setEntryRequired(this.subscriptionPlan),this.offerCreationModel.getRenewWith()){const e=this.renewWithInput.getItemByLabel(this.offerCreationModel.getRenewWith());this.renewWithInput.setValue(e)}},render(){return this.container.setContent([this.customerProfile,this.subscriptionPlan,this.renewal,this.renewWith,this.url,this.startDate,this.endDate]),this},destroy(){this.stopListening(),this.offerCreationModel=null,this.renewWithOffers=null,this.customerProfile&&this.customerProfile.destroy(),this.subscriptionPlan=null,this.renewal=null,this.renewWith&&this.renewWith.destroy(),this.url&&this.url.destroy(),this.startDate&&this.startDate.destroy(),this.startDateInput&&this.startDateInput.destroy(),this.endDate&&this.endDate.destroy(),this.endDateInput&&this.endDateInput.destroy(),this.urlInput&&this.urlInput.destroy(),this._parent(),this.container=null},_createEntry:(t,s)=>e.createElement("div",{class:s,html:[t.render()]}),_createToggleEntry:(t,s,r)=>e.createElement("div",{class:"mpf-offer-toggle "+r,html:[e.createElement("div",{class:"mpf-label",text:t}),s]}),_createSelectField(e,t,s,r,a){const n=new i({model:this.offerCreationModel,fieldName:e,fieldLabel:t,placeholder:s,selectableOptions:r,dynamicValidation:!0,silent:!1,required:a,multipleOptionsSelectable:!1});return this.offerCreationModel.get(e)&&n.setValue(this.offerCreationModel.get(e)),n},_createTextField(e,t,s,i){return new r({model:this.offerCreationModel,fieldName:e,fieldLabel:t,placeholder:s,dynamicValidation:!0,silent:!1,required:i})},_createToggleField(e,t){const s=new a({className:"mpf-toggle primary",fieldName:e,label:t,type:"checkbox"});return e===n.Fields.RENEWAL?s.setCheck(this.offerCreationModel.get(e)):this.offerCreationModel.get("prices")[e].check&&s.setCheck(this.offerCreationModel.get("prices")[e].check),s},_createAutocompleteInput(e,t,s,r){return new l({fieldName:e,fieldLabel:t,model:this.offerCreationModel,required:r,offersList:s})},async _subscriptionPlanToggleChanged(e,t){this._removeErrorMessage(this.subscriptionPlan),this.dispatchEvent(f.TOGGLE_CHANGED),this.offerCreationModel.setPricesByLicensingScheme(t,{check:e.isChecked()}),this.dispatchEvent(u.SUBSCRIPTION_PLAN_CHANGED)},_createDatePicker(e,t,s,r){return new o({model:this.offerCreationModel,fieldName:e,fieldLabel:t,placeholder:s,required:r})},_createCustomerProfileEntry(){return this.customerProfileInput=this._createSelectField(n.Fields.CUSTOMER_PROFILE,d.get("customerProfile"),d.get("selectProfile"),[{value:n.CustomerProfileEnum.PARTNER,label:d.get("partner")},{value:n.CustomerProfileEnum.COMPANY,label:d.get("company")},{value:n.CustomerProfileEnum.MAKER,label:d.get("maker")},{value:n.CustomerProfileEnum.STUDENT,label:d.get("student")}],!0),this._createEntry(this.customerProfileInput,"mpf-offer-select-field mpf-customer-profile")},_createSubscriptionPlanEntry(){const e=this._createToggleField(d.get("yearly"),d.get("yearly")),t=this._createToggleField(d.get("quaterly"),d.get("quaterly")),s=this._createToggleField(d.get("monthly"),d.get("monthly"));return this.checkboxes=[e,t,s],e.addEvent("onChange",this._subscriptionPlanToggleChanged.bind(this,e,d.get("yearly"))),t.addEvent("onChange",this._subscriptionPlanToggleChanged.bind(this,t,d.get("quaterly"))),s.addEvent("onChange",this._subscriptionPlanToggleChanged.bind(this,s,d.get("monthly"))),this._createToggleEntry(d.get("subscriptionPlan"),this.checkboxes,"mpf-subscription-plan",!0)},_renewToggleChanged(e){this.offerCreationModel.setRenewal(e.isChecked()),this._renewWithInputRender()},_createRenewalEntry(){return this.renewalCheckbox=this._createToggleField(n.Fields.RENEWAL," "),this.renewalCheckbox.addEvent("onChange",this._renewToggleChanged.bind(this,this.renewalCheckbox)),this._createToggleEntry(d.get("renewal"),[this.renewalCheckbox],"mpf-renewal-entry")},_createRenewWithEntry(e){return this.renewWithInput=this._createAutocompleteInput(n.Fields.RENEW_WITH,d.get("renewWith"),this.renewWithOffers,e),this._createEntry(this.renewWithInput,"mpf-offer-autocomplete-field mpf-renew-with")},_createUrlTextField(){return this.urlInput=new r({model:this.offerCreationModel,fieldName:n.Fields.NAME,fieldLabel:d.get("url"),placeholder:d.get("enterUrl"),dynamicValidation:!0,silent:!1,required:!0}),this.urlInput.addEvent(r.Events.UPDATE,this._setCorrectUrl.bind(this,this.urlInput)),this.urlInput},_setCorrectUrl(e){if(e.getValue().includes(" ")){const t=e.getValue().replace(" ","_");e.setValue(t)}},_createUrlEntry(){return this.urlInput=this._createUrlTextField(),this._createEntry(this.urlInput,"mpf-offer-text mpf-url")},_createStartDateEntry(){return this.startDateInput=this._createDatePicker(n.Fields.START_DATE,d.get("startDate"),d.get("enterDate"),!0),this.listenTo(this.startDateInput,o.Events.UPDATE,this._updateMinMaxDate.bind(this,"startDateUpdated")),this._createEntry(this.startDateInput,"mpf-offer-date mpf-start-date")},_createEndDateEntry(){return this.endDateInput=this._createDatePicker(n.Fields.END_DATE,d.get("endDate"),d.get("enterDate"),!0),this.listenTo(this.endDateInput,o.Events.UPDATE,this._updateMinMaxDate.bind(this,"endDateUpdated")),this._createEntry(this.endDateInput,"mpf-offer-date mpf-end-date")},_updateMinMaxDate(e){switch(e){case"startDateUpdated":this.endDateInput.setMinDate(new Date(this.offerCreationModel.getStartDate()));break;case"endDateUpdated":this.startDateInput.setMaxDate(new Date(this.offerCreationModel.getEndDate()))}},_validateSubscriptionPlan(){const e=new c;this._removeErrorMessage(this.subscriptionPlan),this.checkboxes.find(e=>e.isChecked())||e.addError(d.get("subscriptionPlan"),t.format(d.get("requiredField"),d.get("subscriptionPlan")));const s=e.build();return s.isValid||this._displayErrorMessage(s,this.subscriptionPlan),s},_displayErrorMessage(t,s){const r=t.errors[0];s.addClassName("mpf-invalid"),e.createElement("p",{class:"mpf-error",text:e.is(r.message)?r.message:""}).inject(s)},_removeErrorMessage(t){t.removeClassName("mpf-invalid");const s=t.getElement("p");e.is(s)&&t.removeChild(s)},_setEntryRequired(t){const s=e.createElement("em",{class:"mpf-required",text:"*"});t.getElement(".mpf-label").addContent("&nbsp;"),t.getElement(".mpf-label").addContent(s)},checkAllRequiredFields(){const e=[this.customerProfileInput,this.urlInput,this.startDateInput,this.endDateInput];this.renewalCheckbox.isChecked()&&e.push(this.renewWithInput);let t=!0;return e.forEach(e=>{!e.validate().isValid&&t&&(t=!1)}),!this._validateSubscriptionPlan()&&t&&(t=!1),t}});return p.SubscriptionPlanEvent=u,p.RenewWithEnum=m,p.Events=f,p}),define("DS/MPFMarketplaceAdmin/platformCreation/PlatformCreationPage",["UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFProductModel/TenantProductListModel","DS/MPFProductModel/TenantProductListFactory","DS/MPFFiniteStateMachine/FiniteStateMachine","DS/MPFBusinessExperienceDevPlatform/BusinessExperienceDevPlatformFactory","DS/MPFMarketplaceAdmin/platformCreation/PlatformOrderCard","DS/MPFMarketplaceAdmin/platformCreation/PlatformCreationForm","DS/MPFPaginationComponent/PaginationComponent","DS/MPFMarketplaceAdmin/platformCreation/AddRolesModal","i18n!DS/MPFMarketplaceAdmin/assets/nls/PlatformCreation","css!DS/MPFMarketplaceAdmin/MPFMarketplaceAdmin.css"],(e,t,s,r,i,a,n,o,l,c,h,d,u,f)=>{"use strict";const m=Object.freeze({LIST:"list",CREATE:"create"}),p=e.extend({className:"mpf-platform-creation-page",setup({orders:e,beDevPlatformFactory:t,tenantProductListFactory:s}){i.requiredOfPrototype(s,n,"options.tenantProductListFactory must be a TenantProductListFactory"),this.beDevPlatformFactory=t,this.orders=e,this.tenantProductListFactory=s,this.stateMachine=this._createStatMachine(),this.alert=this._createAlert(),this.platformCreationButton=this._createPlatformCreationButton(),this.addRolesModal=this._createAddRolesModal(),this.pagination=this._createPagination(),this.platformCreationForm=null,this.fetchOptions={start:1,size:5},this.listenTo(this.pagination,d.Events.CHANGE_PAGE,this._onChangePage.bind(this))},render(){let e;return this.stateMachine.getState()===m.CREATE?e=[this.alert,this.platformCreationForm.render()]:(this._destroyCards(),this.orderCards=this._createOrderCards(),e=[this.addRolesModal.render(),this.alert,this.platformCreationButton,...this.orderCards.map(e=>e.render()),this.pagination.render()]),this.container.setContent(e),this},destroy(){this.stopListening(),this._destroyCards(),this.pagination.destroy(),this.pagination=null,this.orderCards=null,this.stateMachine=null,this.orders=null,this._parent()},_destroyCards(){this.orderCards&&this.orderCards.forEach(e=>{this.stopListening(e),e.destroy()})},_createAlert:()=>new r({visible:!1,autoHide:!0,hideDelay:5e3}),_createPlatformCreationButton(){return new t({value:f.get("createPlatform"),className:"primary",icon:"plus",events:{onClick:this._onAddPlatformButtonClicked.bind(this)}})},_createOrderCards(){return this.orders.map(e=>{const t=new c({order:e});return this.listenTo(t,c.Events.ADD_ROLES,this._onAddRolesClicked.bind(this,{order:e})),t})},_createPagination(){return new d({collection:this.orders,pageSize:5})},async _onChangePage(e={}){const t=e.page||1;this.fetchOptions.start=1+5*(t-1),s.mask(this.container),await this.orders.fetchPromise(Object.assign({},this.fetchOptions)),s.unmask(this.container),this.render()},_onAddPlatformButtonClicked(){this.stateMachine.changeState(m.CREATE),this.platformCreationForm&&(this.stopListening(this.platformCreationForm),this.platformCreationForm.destroy(),this.platformCreationForm=null),this._onCreateView()},async _onAddRolesClicked({order:e}){const t=this.tenantProductListFactory.createModel(n.Types.INTERNAL_PLATFORM,{[a.Fields.TENANT]:e.getOnlineInstance()});s.mask(this.container);try{await t.fetchPromise(),s.unmask(this.container),this.addRolesModal.show({tenantProductList:t,order:e})}catch(e){s.unmask(this.container),console.error(e),this.alert.add({className:"error",message:f.get("unableToFetchAvailableRoles")})}},_onCreateView(){const e=this.beDevPlatformFactory.createModel(l.Types.BUSINESS_EXP_DEV_PLATFORM);this.platformCreationForm=new h({beDevPlatform:e}),this.listenTo(this.platformCreationForm,h.Events.BACK,this._backToListView.bind(this)),this.render()},async _backToListView(){this.stateMachine.changeState(m.LIST),s.mask(this.container),await this.orders.fetchPromise(Object.assign({},this.fetchOptions)),this.pagination.onCollectionUpdate(),s.unmask(this.container),this.render()},_createAddRolesModal(){const e=new u({beDevPlatformFactory:this.beDevPlatformFactory});return this.listenTo(e,u.Events.ON_SAVED,async()=>{s.mask(this.container),await this.orders.fetchPromise({start:1,size:this.fetchOptions.size}),await this.orders.fetchPromise(Object.assign({},this.fetchOptions)),this.pagination.onCollectionUpdate(),s.unmask(this.container),this.render()}),e},_createStatMachine:()=>new o({state:m.LIST,states:[m.LIST,m.CREATE],transitions:[{from:m.CREATE,to:m.LIST},{from:m.LIST,to:m.CREATE}]})});return p.ORDERS_PER_PAGE=5,p}),define("DS/MPFMarketplaceAdmin/offerManagement/OfferCreationForm",["UWA/Class/View","DS/MPFMarketplaceAdmin/offerManagement/OfferCreationFormLeftComponent","DS/MPFMarketplaceAdmin/offerManagement/OfferCreationFormRightComponent","DS/MPFServices/ObjectService"],function(e,t,s,r){"use strict";const i=Object.freeze({SUBSCRIPTION_PLAN_CHANGED:"SubscriptionPlanChanged"}),a=e.extend({className:"mpf-offer-creation-form",setup({offerCreationModel:e,renewWithOffers:t}={}){this.offerCreationModel=e,this.renewWithOffers=t,this.leftComponent=this._createLeftComponent(),this.rightComponent=this._createRighComponent()},render(){return this.container.setContent([this.leftComponent.render(),this.rightComponent.render()]),this},destroy(){this.stopListening(),this.leftComponent&&this.leftComponent.destroy(),this.rightComponent&&this.rightComponent.destroy(),this._parent(),this.container=null},_createLeftComponent(){const e=new t({offerCreationModel:this.offerCreationModel,renewWithOffers:this.renewWithOffers});return this.listenTo(e,t.SubscriptionPlanEvent.SUBSCRIPTION_PLAN_CHANGED,this.dispatchEvent.bind(this,i.SUBSCRIPTION_PLAN_CHANGED)),e},_createRighComponent(){return new s({offerCreationModel:this.offerCreationModel})}});return a.Events=i,a}),define("DS/MPFMarketplaceAdmin/platformCreation/PlatformCreationPageFactory",["DS/MPFConnector/MarketplaceAdminConnector","DS/MPFServices/MarketplaceServices","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFCartModel/CartFactory","DS/MPFMarketplaceAdmin/platformCreation/PlatformCreationPage"],(e,t,s,r,i)=>{"use strict";return Object.freeze({async create(){const a=e.fromMpDataMgtUrl(window.location.href,{service:t.INNOVATE}),n=s.getInstance(a),[o,l,c]=await n.getFactories([s.Types.BUSINESS_EXP_DEV_PLATFORM,s.Types.CART,s.Types.TENANT_PRODUCT_LIST]),h=l.createCollection(r.Types.CART_BUSINESS_EXP_DEV_PLATFORM);return await h.fetchPromise({start:1,size:i.ORDERS_PER_PAGE}),new i({beDevPlatformFactory:o,tenantProductListFactory:c,orders:h})}})}),define("DS/MPFMarketplaceAdmin/orderCancellation/CardHeader",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFCountryModel/CountryCollection","DS/MPFMarketplaceAdmin/orderCancellation/CartStateTile","i18n!DS/MPFMarketplaceAdmin/assets/nls/OrderCancellation"],function(e,t,s,r,i,a,n){"use strict";const o=Object.freeze({SHOW_COMMENTS:"showComments",SHOW_ATTACHEMENTS:"showAttachements",DOWNLOAD_FILE:"downloadFile"}),l=new Map;l.set(s.PaymentMethods.BANK_CARD,"creditCard"),l.set(s.PaymentMethods.DEFERRED_BANK_TRANSFER,"bankTransfer");const c=e.extend({className:"mpf-card-header",setup(e={}){t.requiredOfPrototype(e.cart,s,"options.cart must be a CartModel"),t.requiredOfPrototype(e.countries,i,"options.countries must be a CountryCollection"),this.cart=e.cart,this.countries=e.countries,this.cartStateTile=this._createCartStateTile()},render(){const e=this.cart.getOwnerData(),t=this.cart.getItems()[0],r=this.cart.get(s.Fields.COUNTRY),i=[this._createNameTile()];return i.push(this._createTile([e&&this._createLine(n.get("customerName"),this._createFullName(e.FirstName,e.LastName)),this._createLine(n.get("siteId"),this.cart.getSiteId()),r&&this._createLine(n.get("country"),this.countries.getCountryWithIso2(r).getName())])),i.push(this._createTile([e&&this._createLine(n.get("buyerName"),this._createFullName(e.FirstName,e.LastName)),e&&this._createLine(n.get("buyerEmail"),e.email),(this.cart.isOrder()||this.cart.isRenewal())&&this._createLine(n.get("paymentMethod"),n.get(l.get(this.cart.getPaymentMethod())))])),i.push(this._createDateTile(t)),i.push(this.cartStateTile.render()),this.container.setContent(i),this},_createFullName(e,t){let s="";return e&&(s+=e),e&&t&&(s+=" "),t&&(s+=t),s},_createLine(e,t){if(t)return{tag:"div",class:"mpf-header-line",html:[{tag:"span",class:"mpf-label",text:e},{tag:"span",class:"mpf-value",text:t}]}},_createTile(e){if(e.find(e=>!!e))return{tag:"div",class:"mpf-header-tile",html:e}},_createNameTile(){const e=[{tag:"div",class:"mpf-order-name",text:this.cart.getName()}];return this._createTile(e)},_createDateTile(e){const t=this.cart.get(s.Fields.CONFIRMATION_DATE);return this.cart.isOrder()||this.cart.isRenewal()?this._createTile([this._createLine(n.get("startDate"),e.get(r.Fields.START_DATE)),this._createLine(n.get("endDate"),e.get(r.Fields.END_DATE)),t&&this._createLine(n.get("confirmationDate"),t)]):this.cart.isCancellation()?this._createTile([this._createLine(n.get("effectiveDate"),this.cart.get(s.Fields.REQUEST_DATE)),this._createLine(n.get("approvedDate"),this.cart.get(s.Fields.APPROVAL_DATE)),t&&this._createLine(n.get("confirmationDate"),t),this._createLine(n.get("reason"),this.cart.get(s.Fields.REASON))]):void 0},_createCartStateTile(){const e=new a({cart:this.cart});return this.listenTo(e,a.Events.DOWNLOAD_FILE,this.dispatchEvent.bind(this,o.DOWNLOAD_FILE)),e},destroy(){this.cart=null,this._parent(),this.container=null}});return c.Events=o,c}),define("DS/MPFMarketplaceAdmin/orderCancellation/TransactionCard",["UWA/Class/View","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFPersonModel/PersonModel","DS/MPFCountryModel/CountryCollection","DS/MPFCartModel/CartNotesFactory","DS/MPFDocumentModel/DocumentFactory","DS/MPFMarketplaceAdmin/orderCancellation/CardHeader","DS/MPFMarketplaceAdmin/orderCancellation/CardProductList","DS/MPFMarketplaceAdmin/orderCancellation/CommentsAttachmentsSection","i18n!DS/MPFMarketplaceAdmin/assets/nls/OrderCancellation"],function(e,t,s,r,i,a,n,o,l,c,h,d){"use strict";const u=Object.freeze({DOWNLOAD_FILE:"downloadFile",CANCEL:"cancel",APPROVE:"approveCancellation",REFUSE:"refuseCancellation"}),f=e.extend({className:"mpf-transaction-card",setup(e={}){s.requiredOfPrototype(e.me,i,"options.me must be a PersonModel"),s.requiredOfPrototype(e.cart,r,"options.cart must be a CartModel"),s.requiredOfPrototype(e.cartNotesFactory,n,"options.cartNotesFactory must be a CartNotesFactory"),s.requiredOfPrototype(e.documentFactory,o,"options.documentFactory must be a DocumentFactory"),s.requiredOfPrototype(e.countries,a,"options.countries must be a CountryCollection"),this.me=e.me,this.cart=e.cart,this.countries=e.countries,this.cartNotesFactory=e.cartNotesFactory,this.documentFactory=e.documentFactory,this.locale=e.locale||"fr-FR",this.cardHeader=this._createCardHeader(),this.productList=this._createProductList(),this.cart.isCancellation()&&(this.commentsAttachementsSection=this._createCommentsAttachmentsSection())},render(){const e=this.cart.getNetAmountTotal();return this.container.setContent([this.cardHeader.render(),{tag:"div",class:"mpf-card-body",html:[this.productList.render()]},{tag:"div",class:"mpf-card-footer",html:[{tag:"div",class:"mpf-total-price-container",html:[{tag:"span",class:"mpf-total-price-label",text:d.get("totalPriceExclTax")},{tag:"span",class:"mpf-total-price",text:e&&e.toLocaleString(this.locale,{style:"currency",currency:this.cart.getCurrency()})}]},...this._createButtons()]},this.commentsAttachementsSection&&this.commentsAttachementsSection.render()]),this},destroy(){this.stopListening(),this.cardHeader.destroy(),this.productList.destroy(),this.me=null,this.cart=null,this.countries=null,this.cartNotesFactory=null,this.documentFactory=null,this._parent(),this.container=null},_createCardHeader(){const e=new l({cart:this.cart,countries:this.countries});return this.listenTo(e,l.Events.DOWNLOAD_FILE,this.dispatchEvent.bind(this,u.DOWNLOAD_FILE,{cart:this.cart})),e},_createProductList(){return new c({cart:this.cart,locale:this.locale})},_createCommentsAttachmentsSection(){return new h({me:this.me,cart:this.cart,documentFactory:this.documentFactory,cartNotesFactory:this.cartNotesFactory})},_createButtons(){const e=[];return(this.me.hasRole(i.Roles.PRICER)||this.me.hasRole(i.Roles.SALES_ADMIN))&&parseFloat(this.cart.getNetAmountTotal())>0&&(this.cart.isCancellation()?this.cart.getState()===r.States.SUBMITTED&&this.me.hasRole(i.Roles.PRICER)?(e.push(this._createButton(d.get("approve"),u.APPROVE)),e.push(this._createButton(d.get("reject"),u.REFUSE))):this.cart.getState()===r.States.REFUND_FAILED&&e.push(this._createButton(d.get("retry"),u.APPROVE)):e.push(this._createButton(d.get("cancel"),u.CANCEL))),e},_createButton(e,s){return new t({className:"primary",value:e,events:{onClick:()=>{this.dispatchEvent(s,{cart:this.cart})}}})}});return f.Events=u,f}),define("DS/MPFMarketplaceAdmin/offerManagement/CardHeader",["UWA/Class/View","DS/MPFMarketplaceAdmin/offerManagement/StateProgressTile","DS/MPFServices/ObjectService","i18n!DS/MPFMarketplaceAdmin/assets/nls/OfferManagement"],function(e,t,s,r){"use strict";const i=Object.freeze({EDIT_OFFER:"editOffer"}),a=e.extend({className:"mpf-offer-card-header",domEvents:{click:"cardClicked"},setup(e={}){this.offer=e.offer,this.offerStateTile=this._createOfferStateTile()},render(){const e=this.offer.getTitle(),t=this.offer.getName(),s=this.offer.getCustomerProfile(),i=this.offer.getSubscriptionPlan(),a=this.offer.isRenewal(),n=this.offer.getStartDate(),o=this.offer.getEndDate(),l=this.offer.getDiscountType(),c=[];return c.push(this._createTile("mpf-card-name",[this._createLine(r.get("name"),e),this._createLine(r.get("url"),t),this._createLine(r.get("profile"),s)])),c.push(this._createTile("mpf-card-subscription-plan",[this._createLine(r.get("plan"),i),this._createLine(r.get("renewal"),a.toString())])),c.push(this._createTile("mpf-card-date",[this._createLine(r.get("startDate"),n),this._createLine(r.get("endDate"),o),this._createLine(r.get("type"),l)])),c.push(this.offerStateTile.render()),this.container.setContent(c),this},destroy(){this._parent(),this.offerStateTile&&this.offerStateTile.destroy(),this.container=null},_createTile(e,t){if(t.find(e=>!!e))return{tag:"div",class:"mpf-header-tile "+e,html:t}},_createLine:(e,t)=>(t||(t=""),{tag:"div",class:"mpf-header-line",html:[{tag:"span",class:"mpf-label",text:e},{tag:"span",class:"mpf-value",text:t}]}),_createOfferStateTile(){return new t({offerCreationModel:this.offer})},cardClicked(){this.dispatchEvent(i.EDIT_OFFER,this.offer)}});return a.Events=i,a}),define("DS/MPFMarketplaceAdmin/offerManagement/SubscriptionPlanTable",["UWA/Class/View","UWA/Core","DS/MPFServices/ObjectService","DS/UIKIT/Input/Number","DS/MPFMarketplaceAdmin/offerManagement/SubscriptionPlanProductLine","i18n!DS/MPFMarketplaceAdmin/assets/nls/OfferManagement"],function(e,t,s,r,i,a){"use strict";const n=Object.freeze({REMOVE_PRODUCT:"RemoveProduct",COMPUTE_PERCENTAGE:"ComputePercentage",COMPUTE_NET_PRICE:"ComputeNetPrice",ADJUST_CHANGED:"AdjustChanged"}),o=Object.freeze({MAX_KEY_VALUE:100,MIN_KEY_VALUE:0}),l=e.extend({className:"mpf-subscription-plan-table",setup(e={}){this.offerCreationModel=e.offerCreationModel,this.portfolioPackCollection=e.portfolioPackCollection,this.licensingScheme=e.licensingScheme,this.priceList=e.priceList,this.country=e.country,this.mainComponent=e.mainComponent,this.table=this._createTable(),this.percentage=0,this.products={}},render(){return this.container.setContent([this.table]),this},destroy(){this.stopListening(),this.table=null,this.percentage=null,this._destroyProducts(),this.products=null,this.listPriceValue=null,this.offerPercentagePrice=null,this.keyValue=null,this.percentageInput=null,this.netPriceInput=null,this.priceList=null,this.country=null,this._parent(),this.container=null},_destroyProducts(){Object.values(this.products).forEach(e=>{e&&e.destroy()})},displayNonMainTable(){this.percentageInput.disable(),this.products&&Object.values(this.products).forEach(e=>{e.disableElements()})},_createTable(){return t.createElement("table",{class:"table table-condensed",html:[this._createTableHeader(),this._createTableFirstLine()]})},addProduct(e){const t=new i({offerCreationModel:this.offerCreationModel,portfolioPackCollection:this.portfolioPackCollection,name:e.name,trigram:e.trigram,listPrice:e.listPrice,mainComponent:this.mainComponent});this.listenTo(t,i.Events.REMOVE_PRODUCT,e=>{delete this.products[e],this.dispatchEvent(n.REMOVE_PRODUCT,e)}),this.listenTo(t,i.Events.COMPUTE_NET_PRICE,e=>{if(this.setAdjustKey(),this._sumAllKeys()>o.MAX_KEY_VALUE){const t=this._sumKeysExcept(e),s=o.MAX_KEY_VALUE-t;this.products[e].key.setValue(s)}this.dispatchEvent(n.COMPUTE_NET_PRICE,{licensingScheme:this.licensingScheme,keys:this._getAllKeys()})}),this.listenTo(t,i.Events.ADJUST_CHANGED,e=>{this._findAdjustProduct(e)?(this._findAdjustProduct(e).key.setValue(o.MIN_KEY_VALUE),this._findAdjustProduct(e).adjust.uncheck(),0!==Number(this.netPriceInput.getValue())?(this.updateAdjustKey(e),this.setAdjustKey()):this._updateAdjust(e),this.offerCreationModel.setPricesByLicensingScheme(this.licensingScheme,{[e]:Number(this.products[e].key.getValue())}),this.dispatchEvent(n.ADJUST_CHANGED,{licensingScheme:this.licensingScheme,trigram:e})):this.products[e].adjust.check()}),this.products[e.trigram]=t,this.table.addContent(t.render()),Object.keys(this.products).length&&t.listPrice?this.setAdjust(t):t.listPrice&&t.adjust.check(),this._setKey(t),this._updateKeys(),0!==Number(this.netPriceInput.getValue())&&this.setAdjustKey()},_getAllKeys(){const e={};for(const[t,s]of Object.entries(this.products))e[t]=s.key.getValue();return e},setAllKeysValue(e){for(const[t,s]of Object.entries(this.products)){const r=e[t];s.key.setValue(r),0!==this.netPriceInput.getValue()&&s.setNetPrice(this._computeProductNetPriceOffer(r))}},_setKey(e){this.mainComponent&&(!e.listPrice||e.adjust.isChecked()?e.key.disable():e.key.enable())},_updateKeys(){Object.values(this.products).forEach(e=>{0!==Number(this.netPriceInput.getValue())&&e.listPrice&&(e.adjust.isChecked()?this.updateAdjustKey(e.trigram):e.key.enable())})},setAdjust(e){const t=Object.values(this.products).find(e=>e.adjust.isChecked());e.listPrice&&t&&(t.adjust.uncheck(),t.key.setValue(o.MIN_KEY_VALUE)),e.adjust.check(),e.key.setValue(o.MAX_KEY_VALUE)},updateAdjustKey(e){Object.values(this.products).forEach(t=>{t.listPrice&&(t.trigram!==e?(t.adjust.uncheck(),t.key.setValue(o.MIN_KEY_VALUE),this.mainComponent&&t.key.enable()):(t.adjust.check(),t.key.setValue(o.MAX_KEY_VALUE),t.key.disable()))})},_updateAdjust(e){Object.values(this.products).forEach(t=>{t.trigram!==e?(t.adjust.uncheck(),t.key.setValue(o.MIN_KEY_VALUE)):(t.adjust.check(),t.key.setValue(o.MAX_KEY_VALUE))})},_setKeysValue(e,t){e.trigram!==t?e.key.setValue(o.MIN_KEY_VALUE):(e.adjust.check(),e.key.setValue(o.MAX_KEY_VALUE))},removeProduct(e){e.removeButtonClicked()},_createTableHeader:()=>t.createElement("thead",{class:"mpf-subscription-plan-table-header",html:t.createElement("tr",{html:[{tag:"th",text:a.get("name"),class:"mpf-subscription-plan-table-header-name"},{tag:"th",text:a.get("trigram"),class:"mpf-subscription-plan-table-header-trigram"},{tag:"th",text:a.get("listPrice"),class:"mpf-subscription-plan-table-header-list-price"},{tag:"th",text:a.get("percentage"),class:"mpf-subscription-plan-table-header-percentage"},{tag:"th",text:a.get("offerPrice"),class:"mpf-subscription-plan-table-header-offer-price"},{tag:"th",text:a.get("adjust"),class:"mpf-subscription-plan-table-header-adjust"},{tag:"th",text:a.get("key"),class:"mpf-subscription-plan-table-header-key"},{tag:"th",text:a.get("offerPrice"),class:"mpf-subscription-plan-table-header-offer-price"},{tag:"th",text:"",class:"mpf-subscription-plan-table-header-remove"}]})}),_createTableColumn:(e,s)=>t.createElement("td",{class:"mpf-subscription-plan-table-first-line-"+e,html:[s]}),_createPercentageInput(){const e=new r({className:"mpf-net-price-input-text",fieldName:a.get("percentage"),min:o.MIN_KEY_VALUE,max:o.MAX_KEY_VALUE,step:.01,value:0});return e.addEvent("onChange",this.updatePercentage.bind(this,e)),e},_createNetPriceInput(){const e=new r({className:"mpf-net-price-input-text",fieldName:a.get("netPrice"),min:0,max:this.listPriceValue,value:0});return e.intMaxLength=8,e.addEvent("onChange",this.computeValidNetPrice.bind(this,e)),e},computeValidNetPrice(e){const t=Number(this.listPriceValue.getHTML()),s=e.getValue();s>t?e.setValue(t):(this._enableKeys(),this.offerCreationModel.addNetDiscount(this.licensingScheme,{[this.country]:Number(s)}))},_enableKeys(){this.products&&Object.keys(this.products).length&&(Object.values(this.products).forEach(e=>{this._setKey(e)}),this.dispatchEvent(n.COMPUTE_NET_PRICE))},setAdjustKey(){Object.keys(this.products).length&&Object.values(this.products).forEach(e=>{e.listPrice&&(e.setNetPrice(this._computeAdjustKey(e)),this.offerCreationModel.setPricesByLicensingScheme(this.licensingScheme,{[e.trigram]:Number(e.key.getValue())}))})},_computeAdjustKey(e){let t=0,s=0;if(e.adjust.isChecked()){const e=this._sumKeysWithoutAdjustKey();s=o.MAX_KEY_VALUE-e}else s=Number(e.key.getValue());return(t=this._computeProductNetPriceOffer(s))>e.listPrice?this._displayErrorText(e.netPriceOfferPrice):this._removeErrorText(e.netPriceOfferPrice),s!==Number(e.key.getValue())&&e.key.setValue(s),t},_findAdjustProduct(e){const t=Object.values(this.products);for(let s=0;s<t.length;s++)if(t[s].adjust.isChecked()&&t[s].trigram!==e)return t[s]},_computeProductNetPriceOffer(e){return e*Number(this.netPriceInput.getValue())/100},_sumKeysWithoutAdjustKey(){return Object.values(this.products).map(e=>e.adjust.isChecked()?0:Number(e.key.getValue())).reduce((e,t)=>e+t,0)},_sumAllKeys(){return Object.values(this.products).map(e=>Number(e.key.getValue())).reduce((e,t)=>e+t,0)},_sumKeysExcept(e){return Object.values(this.products).map(t=>t.trigram!==e?Number(t.key.getValue()):0).reduce((e,t)=>e+t,0)},_createTableFirstLine(){const e=this._formatNumber(0);return this.listPriceValue=this._createTableColumn("list-price-value",e),this.offerPercentagePrice=this._createTableColumn("offer-price-value",e),this.keyValue=this._createTableColumn("key-value",""),this.percentageInput=this._createPercentageInput(),this.netPriceInput=this._createNetPriceInput(),0===this.offerCreationModel.getPrices()[this.licensingScheme].netDiscount[this.priceList]&&this.offerCreationModel.addNetDiscount(this.licensingScheme,{[this.country]:Number(this.netPriceInput.getValue())}),this.netPriceInput.addEvent("change",this._setMaxNetPriceInput.bind(this)),t.createElement("tr",{class:"mpf-subscription-plan-table-first-line",html:[this._createTableColumn("currency",a.get(this.priceList)),this._createTableColumn("total",a.get("total")),this.listPriceValue,this._createTableColumn("percentage-input",this.percentageInput),this.offerPercentagePrice,this._createTableColumn("adjust",""),this.keyValue,this._createTableColumn("net-price-input",this.netPriceInput),this._createTableColumn("","")]})},_setMaxNetPriceInput(){this.netPriceInput&&(this.netPriceInput.destroy(),this.netPriceInput=this._createNetPriceInput())},computeListPrice(){let e=0;Object.values(this.products).forEach(t=>{e+=Number(t.getListPrice())}),this.listPriceValue.setText(this._formatNumber(e))},_formatNumber:e=>new Intl.NumberFormat("fr-FR").format(e),_unformatNumber:e=>e.toString().replace(/\s+/g,"").replace(",","."),computePercentageOfferPrice(){const e=this._unformatNumber(this.listPriceValue.getHTML())*(1-this.percentage/100);this.offerPercentagePrice.setText(this._formatNumber(e)),Object.values(this.products).forEach(e=>{const t=e.getListPrice()*(1-this.percentage/100);e.setPercentage(t)})},updatePercentage(e){this.percentage=Number(e.getValue()),this.dispatchEvent(n.COMPUTE_PERCENTAGE,{percentage:this.percentage,licensingScheme:this.licensingScheme}),this.computePercentageOfferPrice()},addClassName(e){this.container.addClassName(e)},_displayErrorText(e){e.addClassName("mpf-invalid")},_removeErrorText(e){e.removeClassName("mpf-invalid");const s=e.getElement("p");t.is(s)&&e.removeChild(s)},checkValidPricesOfProduct(){const e=Object.values(this.products);for(let t=0;t<e.length;t++){const s=e[t];if(s.listPrice<Number(s.getNetPrice()))return!1}return!0}});return l.Events=n,l.KeyValues=o,l}),define("DS/MPFMarketplaceAdmin/orderCancellation/RelatedCartCard",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFPersonModel/PersonModel","DS/MPFCountryModel/CountryCollection","DS/MPFCartModel/CartNotesFactory","DS/MPFDocumentModel/DocumentFactory","DS/MPFMarketplaceAdmin/orderCancellation/CompactCardHeader","DS/MPFMarketplaceAdmin/orderCancellation/TransactionCard"],function(e,t,s,r,i,a,n,o,l){"use strict";const c=Object.freeze({CANCEL:"cancel",APPROVE:"approveCancellation",REFUSE:"refuseCancellation",EDIT:"editCancellation",DOWNLOAD_FILE:"downloadFile"}),h=Object.freeze({COLLAPSED:"collapsed",EXPANDED:"expanded"}),d=e.extend({className:"mpf-related-cart-card",setup({cart:e,me:o,countries:l,cartNotesFactory:c,documentFactory:d,locale:u,state:f}={}){t.requiredOfPrototype(e,s,"options.cart must be a CartModel"),t.requiredOfPrototype(o,r,"options.me must be a PersonModel"),t.requiredOfPrototype(c,a,"options.cartNotesFactory must be a CartNotesFactory"),t.requiredOfPrototype(d,n,"options.documentFactory must be a DocumentFactory"),t.requiredOfPrototype(l,i,"options.countries must be a CountryCollection"),this.cart=e,this.me=o,this.countries=l,this.cartNotesFactory=c,this.documentFactory=d,this.locale=u,this.state=f||h.COLLAPSED,this.compactHeader=this._createCompactCardHeader(),this.transactionCard=this._createTransactionCard()},render(){const e=[];return this.state===h.COLLAPSED?(e.push(this.compactHeader.render()),this.container.removeClassName("mpf-expanded")):(e.push(this._renderToggleIcon()),e.push(this.transactionCard.render()),this.container.addClassName("mpf-expanded")),this.container.setContent(e),this},destroy(){this.stopListening(),this.compactHeader.destroy(),this.transactionCard.destroy(),this.cart=null,this.countries=null,this._parent(),this.container=null},_renderToggleIcon(){return{tag:"div",class:"mpf-toggle-icon fonticon fonticon-expand-down",events:{click:this._expandCollapse.bind(this)}}},_createCompactCardHeader(){const e=new o({cart:this.cart,locale:this.locale});return this.listenTo(e,o.Events.ON_CLICK,this._expandCollapse.bind(this)),this.listenTo(e,o.Events.DOWNLOAD_FILE,this.dispatchEvent.bind(this,c.DOWNLOAD_FILE,{cart:this.cart})),e},_createTransactionCard(){const e=new l({cart:this.cart,me:this.me,countries:this.countries,cartNotesFactory:this.cartNotesFactory,documentFactory:this.documentFactory,locale:this.locale});return this.listenTo(e,l.Events.CANCEL,this.dispatchEvent.bind(this,c.CANCEL)),this.listenTo(e,l.Events.APPROVE,this.dispatchEvent.bind(this,c.APPROVE)),this.listenTo(e,l.Events.REFUSE,this.dispatchEvent.bind(this,c.REFUSE)),this.listenTo(e,l.Events.DOWNLOAD_FILE,this.dispatchEvent.bind(this,c.DOWNLOAD_FILE)),e},_expandCollapse(){this.state=this.state===h.EXPANDED?h.COLLAPSED:h.EXPANDED,this.render()}});return d.Events=c,d}),define("DS/MPFMarketplaceAdmin/offerManagement/SubscriptionPlanTablesComponent",["UWA/Class/View","DS/MPFMarketplaceAdmin/offerManagement/SubscriptionPlanTable","DS/UIKIT/Mask","DS/MPFServices/ObjectService"],function(e,t,s,r){"use strict";const i=Object.freeze({REMOVE_PRODUCT:"RemoveProduct",COMPUTE_NET_PRICE:"ComputeNetPrice",COMPUTE_PERCENTAGE:"ComputePercentage",ADJUST_CHANGED:"AdjustChanged"}),a=Object.freeze({LOADED:"Loaded",LOADING:"Loading"}),n=e.extend({className:"mpf-subscription-plan-tables-component",setup(e){this.offerCreationModel=e.offerCreationModel,this.portfolioPackCollection=e.portfolioPackCollection,this.mainComponent=e.mainComponent,this.country=e.country,this.priceList=e.priceList,this.tables=this._createTables(),this._checkMainComponent(),this.state=a.LOADED},render(){const e=[];return Object.values(this.tables).forEach(t=>{e.push(t.render())}),this.container.setContent(e),this},destroy(){this._parent(),this.tables=null,this.container=null},_destroyTables(){Object.values(this.tables).forEach(e=>{e&&e.destroy()})},_createTables(){const e={YSC:"",QSC:"",MSC:""};return Object.keys(e).forEach(s=>{const r=new t({offerCreationModel:this.offerCreationModel,portfolioPackCollection:this.portfolioPackCollection,licensingScheme:s,priceList:this.priceList,country:this.country,mainComponent:this.mainComponent});r.addClassName(s),this.listenTo(r,t.Events.COMPUTE_PERCENTAGE,e=>{r.offerCreationModel.getPrices().percentageDiscount!==e.percentage&&this.offerCreationModel.setPricesByLicensingScheme(e.licensingScheme,{percentageDiscount:e.percentage}),this.dispatchEvent(i.COMPUTE_PERCENTAGE,e)}),this.listenTo(r,t.Events.COMPUTE_NET_PRICE,e=>{r.setAdjustKey(),this.dispatchEvent(i.COMPUTE_NET_PRICE,e)}),this.listenTo(r,t.Events.REMOVE_PRODUCT,e=>{this.dispatchEvent(i.REMOVE_PRODUCT,e)}),this.listenTo(r,t.Events.ADJUST_CHANGED,e=>{this.dispatchEvent(i.ADJUST_CHANGED,e)}),e[s]=r}),e.QSC.hide(),e.MSC.hide(),e},deleteProductInTables(e){Object.values(this.tables).forEach(t=>{e in t.products&&(t.products[e].destroy(),delete t.products[e]);const s=Object.values(t.products),r=s.reverse().find(e=>e.listPrice);r&&(!r.adjust.isChecked()&&s.length>0&&t.setAdjust(r),t.updateAdjustKey(r.trigram),t.setAdjustKey())}),this._updateComputedPercentageValues(),this._updateComputedNetPriceValues()},async loadData(e){return this.portfolioPackCollection.productTrigram=e,await this.portfolioPackCollection.fetchPromise({country:this.country})},addProductInPeriodicityTable(e,t){this.tables[e].addProduct(t)},_checkMainComponent(){this.mainComponent||Object.values(this.tables).forEach(e=>{e.displayNonMainTable()})},addPoductToSubscriptionPlan(e){for(const[t,s]of Object.entries(this.tables))s.products[e]&&s.offerCreationModel.setPricesByLicensingScheme(t,{[e]:Number(s.products[e].key.getValue())});this._updateSubscriptionPlanProductsKeys(),this._updateComputedPercentageValues()},_updateSubscriptionPlanProductsKeys(){for(const[e,t]of Object.entries(this.tables))Object.keys(this.offerCreationModel.getPrices()[e]).forEach(s=>{const r=this.offerCreationModel.getProducts().find(e=>e===s);r&&(this.offerCreationModel.getPrices()[e][s]=Number(t.products[r].key.getValue()))})},_updateComputedPercentageValues(){Object.values(this.tables).forEach(e=>{e.computeListPrice(),e.computePercentageOfferPrice(e.percentage)})},_updateComputedNetPriceValues(){Object.values(this.tables).forEach(e=>{0!==Number(e.netPriceInput.getValue())&&e.netPriceInput.setValue(e.listPriceValue.getHTML())})},async fillTables(){const e=this.offerCreationModel.getProducts();for(const t of e){this.portfolioPackCollection.productTrigram=t,await this.portfolioPackCollection.fetchPromise({country:this.country});const e=this.offerCreationModel.getPrices(),s=this.portfolioPackCollection.getStandardOffer(),r={};Object.keys(e).forEach(e=>{r[e]=s.getOffers().getPortfolioWithLicensingScheme(e)});for(const e in r)if(r[e]){const i=r[e].getPriceList()[0].price;r[e]=i,this.addProductInPeriodicityTable(e,{name:s.getDisplayName(),trigram:t,listPrice:r[e]}),this.tables[e].products[t].key.setValue(this.offerCreationModel.getPrices()[e][t])}}this.setState(a.LOADED),this._computePrices()},_computePrices(){for(const[e,t]of Object.entries(this.tables)){t.computeListPrice();const s=this.offerCreationModel.getPrices()[e].percentageDiscount;t.percentage=s,t.percentageInput.setValue(s);for(const[s,r]of Object.entries(t.products))r.key.setValue(this.offerCreationModel.getPrices()[e][s]);const r=this.offerCreationModel.getPrices()[e].netDiscount[t.country];r&&t.netPriceInput.setValue(r)}},setState(e){this.state=e,this.dispatchEvent(e),this.render()},setTablesPercentage(e){const t=this.tables[e.licensingScheme];t.percentage!==e.percentage&&(t.percentageInput.setValue(e.percentage),t.updatePercentage(t.percentageInput),t.computePercentageOfferPrice())},checkValidSubscriptionPlanTables(){const e=Object.values(this.tables);for(let t=0;t<e.length;t++)if(!e[t].checkValidPricesOfProduct())return!1;return!0}});return n.Events=i,n.States=a,n}),define("DS/MPFMarketplaceAdmin/orderCancellation/OrderCancellationCard",["UWA/Class/View","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFPersonModel/PersonModel","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartCollection","DS/MPFCountryModel/CountryCollection","DS/MPFCartQuoteModel/CartQuoteFactory","DS/MPFInvoiceModel/InvoiceFactory","DS/MPFCartModel/CartNotesFactory","DS/MPFDocumentModel/DocumentFactory","DS/MPFMarketplaceAdmin/orderCancellation/TransactionCard","DS/MPFMarketplaceAdmin/orderCancellation/RelatedCartCard","i18n!DS/MPFMarketplaceAdmin/assets/nls/OrderCancellation"],function(e,t,s,r,i,a,n,o,l,c,h,d,u,f){"use strict";const m=Object.freeze({DOWNLOAD_FILE:"downloadFile",CANCEL:"cancel",APPROVE:"approveCancellation",REFUSE:"refuseCancellation",EDIT:"editCancellation"}),p=e.extend({className:"mpf-order-cancellation-card",setup(e={}){s.requiredOfPrototype(e.me,r,"options.me must be a PersonModel"),s.requiredOfPrototype(e.cart,i,"options.cart must be a CartModel"),s.requiredOfPrototype(e.relatedCarts,a,"options.relatedCarts must be a CartCollection"),s.requiredOfPrototype(e.cartNotesFactory,c,"options.cartNotesFactory must be a CartNotesFactory"),s.requiredOfPrototype(e.documentFactory,h,"options.documentFactory must be a DocumentFactory"),s.requiredOfPrototype(e.countries,n,"options.countries must be a CountryCollection"),this.me=e.me,this.cart=e.cart,this.relatedCarts=e.relatedCarts,this.countries=e.countries,this.cartQuoteFactory=e.cartQuoteFactory,this.invoiceFactory=e.invoiceFactory,this.cartNotesFactory=e.cartNotesFactory,this.documentFactory=e.documentFactory,this.locale=e.locale||"fr-FR",this.alertContainer=this._createAlertContainer(),this.transactionCard=this._createTransactionCard(),this.relatedCartCards=this._createRelatedCartCards()},render(){return this.container.setContent([this.alertContainer,this.transactionCard.render(),{tag:"div",class:"mpf-related-carts-container",html:this.relatedCartCards.map(e=>e.render())}]),this},destroy(){this.stopListening(),this.transactionCard.destroy(),this.relatedCartCards.map(e=>e.destroy()),this.transactionCard=null,this.relatedCartCards=null,this.cart=null,this.me=null,this.countries=null,this._parent(),this.container=null},_createAlertContainer:()=>new t({visible:!1}),_createTransactionCard(){const e=new d({cart:this.cart,me:this.me,locale:this.locale,countries:this.countries,cartNotesFactory:this.cartNotesFactory,documentFactory:this.documentFactory});return this.listenTo(e,d.Events.CANCEL,this.dispatchEvent.bind(this,m.CANCEL)),this.listenTo(e,d.Events.APPROVE,this.dispatchEvent.bind(this,m.APPROVE)),this.listenTo(e,d.Events.REFUSE,this.dispatchEvent.bind(this,m.REFUSE)),this.listenTo(e,d.Events.DOWNLOAD_FILE,this._downloadDocuments.bind(this)),e},_createRelatedCartCards(){return this.relatedCarts.map(e=>{const t=new u({cart:e,me:this.me,locale:this.locale,countries:this.countries,cartNotesFactory:this.cartNotesFactory,documentFactory:this.documentFactory});return this.listenTo(t,u.Events.CANCEL,this.dispatchEvent.bind(this,m.CANCEL)),this.listenTo(t,u.Events.APPROVE,this.dispatchEvent.bind(this,m.APPROVE)),this.listenTo(t,u.Events.REFUSE,this.dispatchEvent.bind(this,m.REFUSE)),this.listenTo(t,u.Events.DOWNLOAD_FILE,this._downloadDocuments.bind(this)),t})},async _downloadQuote({cart:e}={}){const t=this.cartQuoteFactory.createModel(o.Types.CART_QUOTE);t.setParentResourceId(e.get("id"));try{await t.fetchPromise();const e=t.getUrl();if(!e)throw new Error("No quoteUrl attribute on quote");window.open(e,"_blank")}catch(e){console.warn(e),this.alertContainer.add({className:"warning",message:f.get("noQuoteFound")}).show()}},async _downloadInvoices({cart:e}={}){const t=this.invoiceFactory.createCollection(l.Types.CART_INVOICE);t.setParentResourceId(e.get("id"));try{if(await t.fetchPromise(),t.isEmpty())throw new Error("No invoices found");t.forEach(e=>{window.open(e.getInvoice(),"_blank")})}catch(e){console.warn(e),this.alertContainer.add({className:"warning",message:f.get("noInvoicesFound")}).show()}},_downloadDocuments({cart:e}){e.isCancellation()||this._downloadQuote({cart:e}),this._downloadInvoices({cart:e})}});return p.Events=m,p}),define("DS/MPFMarketplaceAdmin/offerManagement/OfferCreationFooter",["UWA/Class/View","UWA/Core","DS/UIKIT/Toggler","DS/MPFMarketplaceAdmin/offerManagement/OfferCreationFooterForm","DS/MPFServices/ObjectService","DS/MPFMarketplaceAdmin/offerManagement/SubscriptionPlanTablesComponent","DS/UIKIT/Alert","DS/MPFView/ValidationResultBuilder","DS/UIKIT/Mask","i18n!DS/MPFMarketplaceAdmin/assets/nls/OfferManagement"],function(e,t,s,r,i,a,n,o,l,c){"use strict";const h=Object.freeze({SEARCH_BY_TRIGRAM:"SearchByTrigram"}),d=Object.freeze({HIDE_CURRENCIES:"HideCurrencies",SHOW_CURRENCIES:"ShowCurrencies"}),u=Object.freeze({LOADED:"Loaded",LOADING:"Loading"}),f=e.extend({className:"mpf-offer-creation-footer",setup(e={}){this.countryByPriceList={FRA:"EuroZone Price List/EUR",USA:"USA Price List/USD",JPN:"Japan Price List/JPY",AUS:"Australia Price List/AUD",CAN:"Canada Price List/CAD",GBR:"UK Price List/GBP",NOR:"Norway Price List/NOK",SWE:"Sweden Price List/SEK",IND:"India Price List/INR",POL:"CEMA Price List/EUR (PLN)"},this.offerCreationModel=e.offerCreationModel,this.portfolioPackCollection=e.portfolioPackCollection,this.footerForm=this._createFooterForm(),this.tabs=this._createTabs(),this.tables=this._createTables(),this.navTab=this._createNavTab(),this.alert=this._createAlert(),this.showCurrencies=this._createLabelCurrencies("mpf-label mpf-footer-show-currencies",c.get("showCurrencies"),d.SHOW_CURRENCIES),this.hideCurrencies=this._createLabelCurrencies("mpf-label mpf-footer-hide-currencies",c.get("hideCurrencies"),d.HIDE_CURRENCIES),this.state=d.HIDE_CURRENCIES,this.dataState=u.LOADED,this.loadedTables=Object.keys(this.countryByPriceList).length,this.subscriptionPlanChanged(),this.offerCreationModel.getProducts().length>0&&this._loadData()},render(){const e=[this.footerForm.render(),this.alert,this.navTab];if(this.state===d.HIDE_CURRENCIES)e.push(this.tables.FRA.render(),this.showCurrencies);else{const t=[];Object.values(this.tables).forEach(e=>{t.push(e.render())}),e.push(t),e.push(this.hideCurrencies)}return this.container.setContent(e),this.dataState===u.LOADED?(l.unmask(this.container),this.dispatchEvent(u.LOADED)):(l.mask(this.container),this.dispatchEvent(u.LOADING)),this},destroy(){this.stopListening(),this.footerForm&&this.footerForm.destroy(),this._destroyTables(),this.navTab=null,this.tabs=null,this._parent(),this.alert=null,this.showCurrencies=null,this.hideCurrencies=null,this.state=null,this.dataState=null,this.loadedTables=null,this.toggler&&this.toggler.destroy(),this.container=null},_destroyTables(){Object.values(this.tables).forEach(e=>{e&&e.destroy()})},subscriptionPlanChanged(){const e=this.offerCreationModel.getPrices();let t=!1;for(const[s,r]of Object.entries(e))this.tabs[s].hasClassName("active")&&!0!==r.check&&(this.tabs[s].removeClassName("active"),t=!1),this.tabs[s].hasClassName("active")&&(t=!0),!0===r.check?this.tabs[s].removeClassName("disabled"):this.tabs[s].addClassName("disabled");t||this._setActiveTab(Object.values(this.tabs))},_createSubscriptionPlanTab:e=>t.createElement("div",{class:"tab-item mpf-subscription-plan-component-tab-"+e+" disabled",html:[{tag:"span",text:e}]}),_setActiveTab(e){for(let t=0;t<e.length&&!e[t].hasClassName("active");t++)if(!e[t].hasClassName("active")&&!e[t].hasClassName("disabled")){e[t].addClassName("active"),this._displayTable(e[t],t,!0);break}},_createTabs(){return{YSC:this._createSubscriptionPlanTab(c.get("yearly")),QSC:this._createSubscriptionPlanTab(c.get("quaterly")),MSC:this._createSubscriptionPlanTab(c.get("monthly"))}},_createNavTab(){const e=t.createElement("nav",{class:"tab tab-pills mpf-subscription-plan-component-tab",html:Object.values(this.tabs)});return this.toggler=new s({container:e,events:{onToggle:this._displayTable.bind(this)}}),e},_createAlert:()=>new n({autoHide:!0,closable:!0,visible:!1}),_showError(e){this.alert.add({className:"error",message:e}).show(),this._setAllTablesState(a.States.LOADED)},_displayTable(e,t,s){Object.values(this.tables).forEach(e=>{switch(t){case 0:this._showTable(s,e.tables.YSC),this._showTable(!s,e.tables.QSC),this._showTable(!s,e.tables.MSC);break;case 1:this._showTable(s,e.tables.QSC),this._showTable(!s,e.tables.YSC),this._showTable(!s,e.tables.MSC);break;case 2:this._showTable(s,e.tables.MSC),this._showTable(!s,e.tables.YSC),this._showTable(!s,e.tables.QSC)}})},_showTable(e,t){e?t.show():t.hide()},_createTables(){const e={};for(const[t,s]of Object.entries(this.countryByPriceList)){let r=!1;"FRA"===t&&(r=!0);const i=new a({offerCreationModel:this.offerCreationModel,portfolioPackCollection:this.portfolioPackCollection,priceList:s,country:t,mainComponent:r});this.listenTo(i,a.Events.REMOVE_PRODUCT,e=>{Object.values(this.tables).forEach(t=>{t.deleteProductInTables(e)}),Object.keys(this.tables.FRA.tables).forEach(t=>delete this.offerCreationModel.getPrices()[t][e])}),this.listenTo(i,a.Events.COMPUTE_NET_PRICE,e=>{Object.values(this.tables).forEach(t=>{if(e){t.tables[e.licensingScheme].setAllKeysValue(e.keys)}})}),this.listenTo(i,a.Events.COMPUTE_PERCENTAGE,e=>{Object.values(this.tables).forEach(t=>{t.setTablesPercentage(e)})}),this.listenTo(i,a.Events.ADJUST_CHANGED,e=>{Object.values(this.tables).forEach(t=>{t.tables[e.licensingScheme].setAdjust(t.tables[e.licensingScheme].products[e.trigram])})}),this.listenTo(i,a.States.LOADING,this._setDataState.bind(this,-1)),this.listenTo(i,a.States.LOADED,this._setDataState.bind(this,1)),e[t]=i}return e},_setDataState(e){this.loadedTables=this.loadedTables+e,this.loadedTables<Object.keys(this.countryByPriceList).length?this.dataState=u.LOADING:this.dataState=u.LOADED,this.render()},_createFooterForm(){const e=new r({offerCreationModel:this.offerCreationModel});return this.listenTo(e,r.Events.SEARCH_BY_TRIGRAM,e=>{this._searchProductByTrigram(e.getValue())}),e},_createLabelCurrencies(e,s,r){const i=t.createElement("a",{class:e,text:s});return i.addEvent("click",this._setState.bind(this,r)),i},_setState(e){this.state=e,this.render()},_getUnavailablePeriodicity(e,t){if(0===Object.values(e).length)return["YSC","QSC","MSC"];const s=[];for(const[r,i]of Object.entries(t))!e[r]&&i.check&&s.push(r);return s},async _searchProductByTrigram(e){try{if(!this._getPeriodicities())return void this._showError(c.get("subscriptionPlanNotChecked",{trigram:e}));if(this.offerCreationModel.getProducts().find(t=>t===e))return void this._showError(c.get("productAlreadyAddedError"));const t={},s={};this._setAllTablesState(a.States.LOADING);for await(const[r,i]of Object.entries(this.tables))t[r]=await i.loadData(e),s[r]=t[r].getStandardOffer();const r=this.offerCreationModel.getPrices(),i={},n=Object.keys(r);Object.keys(this.tables).forEach(e=>{const t={};n.forEach(r=>{t[r]=s[e].getOffers().getPortfolioWithLicensingScheme(r)}),i[e]=t});const o=this._getUnavailablePeriodicity(i.FRA,r);if(o.length)return void this._showError(c.get("productNotAvailableError",{subscriptionPlan:o}));for(const[t,r]of Object.entries(i))for(const i in r)if(r[i]){const a=r[i].getPriceList()[0].price;r[i]=a,this.tables[t].addProductInPeriodicityTable(i,{name:s[t].getDisplayName(),trigram:e,listPrice:r[i]})}this.offerCreationModel.addProduct(e),Object.values(this.tables).forEach(t=>{t.addPoductToSubscriptionPlan(e),t.setState(a.States.LOADED)})}catch(e){console.error(e),this._showError(c.get("productNameError"))}},_getPeriodicities(){const e=this.offerCreationModel.getPrices();let t=0;return Object.values(e).forEach(e=>{e.check&&t++}),t},checkAllRequiredFields(){const e=[this.footerForm.validateType(),this._checkEmptyTables()];let t=!0;return e.forEach(e=>{!e.isValid&&t&&(t=!1)}),t},checkValidSubscriptionPlanTablesComponent(){const e=Object.values(this.tables);for(let t=0;t<e.length;t++)if(!e[t].checkValidSubscriptionPlanTables())return!1;return!0},_checkEmptyTables(){this.footerForm.removeErrorMessage(this.footerForm.trigram);const e=new o;for(const[t,s]of Object.entries(this.tables.FRA.tables))this.tabs[t].hasClassName("disabled")||0===Object.keys(s.products).length&&e.addError(c.get("tableEmptyError"),c.get("tableEmptyError"));const t=e.build();return t.isValid||this.footerForm.displayErrorMessage(t,this.footerForm.trigram),t},_setAllTablesState(e){Object.values(this.tables).forEach(t=>{t.setState(e)})},async _loadData(){this._setAllTablesState(a.States.LOADING);const e=Object.values(this.tables);for(let t=0;t<e.length;t++)await e[t].fillTables()}});return f.Events=h,f.States=d,f.dataStates=u,f}),define("DS/MPFMarketplaceAdmin/offerManagement/OfferList",["UWA/Class/View","DS/MPFMarketplaceAdmin/offerManagement/CardHeader","DS/MPFServices/ObjectService"],function(e,t,s){"use strict";const r=Object.freeze({EDIT_OFFER:"editOffer"}),i=e.extend({className:"mpf-offer-list",setup(e={}){this.offers=e.offers},render(){let e=[];return this.offers.size()>0&&(this.cards=this.offers.map(e=>this._createCard(e)),e=this.cards.map(e=>e.render())),this.container.setContent(e),this},destroy(){this._parent(),this.container=null,this.cards&&this.cards.map(e=>e.destroy())},_createCard(e){const s=new t({offer:e});return this.listenTo(s,t.Events.EDIT_OFFER,this.dispatchEvent.bind(this,r.EDIT_OFFER)),s}});return i.Events=r,i}),define("DS/MPFMarketplaceAdmin/offerManagement/OfferCreationPage",["UWA/Class/View","UWA/Core","DS/MPFMarketplaceAdmin/offerManagement/OfferCreationHeader","DS/MPFMarketplaceAdmin/offerManagement/OfferCreationForm","DS/MPFMarketplaceAdmin/offerManagement/OfferCreationFooter","DS/MPFOfferModel/OfferCreationModel","DS/UIKIT/Alert","DS/MPFServices/ObjectService","i18n!DS/MPFMarketplaceAdmin/assets/nls/OfferManagement"],function(e,t,s,r,i,a,n,o,l){"use strict";const c=Object.freeze({CANCEL:"cancel"}),h=e.extend({className:"mpf-offer-creation-page",setup(e){this.me=e.me,this.offerCreationModel=e.offerCreationModel,this.portfolioPackCollection=e.portfolioPackCollection,this.renewWithOffers=e.renewWithOffers,this.header=this._createHeader(),this.form=this._createForm(),this.footer=this._createFooter()},render(){return this.container.setContent([this.header.render(),this.form.render(),this.footer.render(),this.saveAlert]),this},destroy(){this.stopListening(),this.header&&this.header.destroy(),this.form&&this.form.destroy(),this.footer&&this.footer.destroy(),this._parent(),this.container=null},_createHeader(){const e=new s({me:this.me,offerCreationModel:this.offerCreationModel});return this.listenTo(e,s.Events.CANCEL,this._cancelButtonClicked.bind(this)),this.listenTo(e,s.Events.SAVE,e=>{this._buttonClicked(e)}),this.listenTo(e,s.Events.SUBMIT_FOR_APPROVAL,e=>{this._buttonClicked(e)}),this.listenTo(e,s.Events.APPROVE,e=>{this._buttonClicked(e)}),this.listenTo(e,s.Events.REJECT,e=>{this._buttonClicked(e)}),this.listenTo(e,s.Events.ACTIVATE,e=>{this._buttonClicked(e)}),this.listenTo(e,s.Events.DEACTIVATE,e=>{this._buttonClicked(e)}),e},_cancelButtonClicked(){this.dispatchEvent(c.CANCEL)},_isUrlEmpty(){return!this.form.leftComponent.urlInput.getValue()&&(this._displayAlert(l.get("urlEmptyBeforeSaveError")),!0)},async _buttonClicked(e){if(!this._isUrlEmpty())try{if(e===a.States.SUBMITTED){const e=this.form.leftComponent.checkAllRequiredFields(),t=this.form.rightComponent.checkAllRequiredFields(),s=this.footer.checkAllRequiredFields();if(!e||!t||!s)return}if((e===a.States.DRAFT||e===a.States.SUBMITTED)&&!this.footer.checkValidSubscriptionPlanTablesComponent())return void this._displayAlert(l.get("repartitionKeysError"));const t=this.offerCreationModel.getState();e!==t&&this.offerCreationModel.setState(e),this.offerCreationModel.isNew()?await this.offerCreationModel.savePromise():this.offerCreationModel.savePromise({...this.offerCreationModel.getPendingChanges(),[a.Fields.PRODUCTS]:this.offerCreationModel.getProducts(),[a.Fields.PRICES]:this.offerCreationModel.getPrices()},{patch:!0}),t!==this.offerCreationModel.getState()&&this.header&&(this.header.destroy(),this.header=null,this.header=this._createHeader(),this.render())}catch(e){console.error(e)}},_createForm(){const e=new r({offerCreationModel:this.offerCreationModel,renewWithOffers:this.renewWithOffers});return this.listenTo(e,r.Events.SUBSCRIPTION_PLAN_CHANGED,this.subscriptionPlanChanged.bind(this)),e},subscriptionPlanChanged(){this.footer.subscriptionPlanChanged()},_createFooter(){const e=new i({offerCreationModel:this.offerCreationModel,portfolioPackCollection:this.portfolioPackCollection});return this.listenTo(e,i.dataStates.LOADED,this.header.enableButtonsContainer.bind(this,this.header.buttons)),this.listenTo(e,i.dataStates.LOADING,this.header.disableButtonsContainer.bind(this,this.header.buttons)),e},_displayAlert(e){new n({closable:!0,visible:!0,autoHide:!0}).inject(this.container,"top").add({className:"error",message:e})}});return h.Events=c,h}),define("DS/MPFMarketplaceAdmin/offerManagement/OfferListViewPage",["UWA/Class/View","DS/MPFMarketplaceAdmin/offerManagement/OfferManagementFilterCommands","DS/MPFMarketplaceAdmin/offerManagement/OfferList","DS/MPFServices/ObjectService"],function(e,t,s,r){"use strict";const i=Object.freeze({NEW_REQUEST_OFFER:"newRequestOffer",EDIT_OFFER:"editOffer"}),a=e.extend({className:"mpf-offer-list-view",setup(e){this.me=e.me,this.offerFilters=e.offerFilters,this.offers=e.offers,this.offerModel=e.offerModel,this.renewWithOffers=e.renewWithOffers,this.offerFilterCommands=this._createOfferFilterCommands(),this.offerList=this._createOfferList(),this.listenTo(this.offerFilterCommands,t.Events.REFRESH,this._onFilterUpdate.bind(this))},render(){return this.container.setContent([this.offerFilterCommands.render(),this.offerList.render()]),this},destroy(){this.stopListening(),this._parent(),this.offerFilterCommands&&this.offerFilterCommands.destroy(),this.offerList&&this.offerList.destroy(),this.container=null},_createOfferFilterCommands(){const e=new t({me:this.me,offerFilters:this.offerFilters,renewWithOffers:this.renewWithOffers});return this.listenTo(e,t.Events.NEW_REQUEST_OFFER,this._newOfferRequest.bind(this)),e},_createOfferList(){const e=new s({offers:this.offers});return this.listenTo(e,s.Events.EDIT_OFFER,this.dispatchEvent.bind(this,i.EDIT_OFFER)),e},_newOfferRequest(){this.dispatchEvent(i.NEW_REQUEST_OFFER)},_onFilterUpdate(){this.isUpdating||(this.isUpdating=!0,this.offerList&&(this.stopListening(this.offerList),this.offerList.destroy(),this.offerList=null,this.offerList=this._createOfferList()),this.offerFilters.isEmpty()||(this._onOfferUpdate(),this._updateOffers().then(()=>{})),this.isUpdating=!1)},async _updateOffers(){return await this.offers.fetchPromise(this.offerFilters.toJSON())},async _onOfferUpdate(){try{await this._updateOffers()}catch(e){console.log(e)}this.render()}});return a.Events=i,a}),define("DS/MPFMarketplaceAdmin/orderCancellation/OrderCancellationList",["UWA/Class/View","DS/UIKIT/Spinner","DS/MPFServices/ObjectService","DS/MPFPersonModel/PersonModel","DS/MPFCartModel/CartCollection","DS/MPFCountryModel/CountryCollection","DS/MPFCartModel/CartFactory","DS/MPFCartModel/CartNotesFactory","DS/MPFDocumentModel/DocumentFactory","DS/MPFMarketplaceAdmin/orderCancellation/OrderCancellationCard","DS/MPFMarketplaceAdmin/orderCancellation/InfoMessageComponent"],(e,t,s,r,i,a,n,o,l,c,h)=>{"use strict";const d=Object.freeze({CANCEL:"cancelCart",APPROVE:"approveCancellation",REFUSE:"refuseCancellation",EDIT:"editCancellation"}),u=e.extend({className:"mpf-order-cancellation-list",setup:function(e={}){s.requiredOfPrototype(e.carts,i,"options.carts must be a CartCollection"),s.requiredOfPrototype(e.me,r,"options.me must be a PersonModel"),s.requiredOfPrototype(e.cartFactory,n,"options.cartFactory must be a CartFactory"),s.requiredOfPrototype(e.cartNotesFactory,o,"options.cartNotesFactory must be a CartNotesFactory"),s.requiredOfPrototype(e.documentFactory,l,"options.documentFactory must be a DocumentFactory"),s.requiredOfPrototype(e.countries,a,"options.countries must be a CountryCollection"),this.carts=e.carts,this.me=e.me,this.countries=e.countries,this.cartFactory=e.cartFactory,this.invoiceFactory=e.invoiceFactory,this.cartQuoteFactory=e.cartQuoteFactory,this.cartNotesFactory=e.cartNotesFactory,this.documentFactory=e.documentFactory,this.locale=e.locale,this.spinnerContainer=this._createSpinnerContainer(),this.infoMessageComponent=this._createInfoMessageComponent()},render:function(){let e;return this.isLoading?e=[this.spinnerContainer]:(this._clearCards(),this.carts.size()>0?(this.cards=this.carts.map(e=>this._createCard(e)),e=this.cards.map(e=>e.render())):e=this.infoMessageComponent.render()),this.container.setContent(e),this},destroy:function(){this.stopListening(),this._clearCards(),this.me=null,this.carts=null,this.countries=null,this.cartFactory=null,this._parent()},setLoading(e=!0){this.isLoading=e,this.render()},_clearCards(){Array.isArray(this.cards)&&this.cards.forEach(e=>{this.stopListening(e),e.destroy()}),this.cards=[]},_createCard(e){const t=this.cartFactory.createCollection(n.Types.CART_TRANSACTIONS,e.getRelatedCarts(),{parse:!0}),s=e.isCancellation()?e.getRelatedCarts()[0].items[0]:e.getItems()[0],r={start:s.getStartDate(),end:s.getEndDate()},i=new c({me:this.me,locale:this.locale,cart:e,relatedCarts:t,countries:this.countries,cartQuoteFactory:this.cartQuoteFactory,invoiceFactory:this.invoiceFactory,cartNotesFactory:this.cartNotesFactory,documentFactory:this.documentFactory});return this.listenTo(i,c.Events.CANCEL,({cart:e})=>{this.dispatchEvent(d.CANCEL,{cart:e,dates:r})}),this.listenTo(i,c.Events.APPROVE,({cart:e})=>{this.dispatchEvent(d.APPROVE,{cart:e,dates:r})}),this.listenTo(i,c.Events.REFUSE,this.dispatchEvent.bind(this,d.REFUSE)),i},_createInfoMessageComponent(){return new h({carts:this.carts})},_createSpinnerContainer:()=>({tag:"div",class:"mpf-spinner-container",html:(new t).show()})});return u.Events=d,u}),define("DS/MPFMarketplaceAdmin/offerManagement/OfferManagementPage",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFOfferModel/OfferCollectionFilterModel","DS/MPFMarketplaceAdmin/offerManagement/OfferCreationPage","DS/MPFOfferModel/OfferCreationFactory","DS/MPFMarketplaceAdmin/offerManagement/OfferListViewPage","DS/MPFPortfolioModel/PortfolioFactory","DS/MPFOfferModel/OfferFactory"],function(e,t,s,r,i,a,n,o){"use strict";const l=Object.freeze({OFFER_LIST_VIEW:"offerListView",NEW_REQUEST_OFFER:"newRequestOffer",OFFER_UPDATE:"offerUpdate"}),c=e.extend({className:"mpf-offer-management-page",setup(e={}){t.requiredOfPrototype(e.offerFilters,s,"options.offerFilters must be a OfferCollectionFilterModel"),t.requiredOfPrototype(e.offerCreationFactory,i,"options.offerCreationFactory must be a OfferCreationFactory"),this.me=e.me,this.offers=e.offers,this.offerFilters=e.offerFilters,this.renewWithOffers=e.renewWithOffers,this.offerCreationFactory=e.offerCreationFactory,this.portfolioFactory=e.portfolioFactory,this.offerFactory=e.offerFactory,this.state=l.OFFER_LIST_VIEW,this.offerListViewPage=null,this.offerCreationPage=null},render(){let e=[];return this.state===l.OFFER_LIST_VIEW?(this.offerListViewPage=this._createOfferListView(),e=[this.offerListViewPage.render()]):this.state!==l.NEW_REQUEST_OFFER&&this.state!==l.OFFER_UPDATE||(e=[this.offerCreationPage.render()]),this.container.setContent(e),this},destroy(){this.stopListening(),this.offerListViewPage&&this.offerListViewPage.destroy(),this.offerCreationPage&&this.offerCreationPage.destroy(),this.offerListViewPage=null,this.offerCreationPage=null,this.offers=null,this.offerFilters=null,this.offerCreationFactory=null,this._parent(),this.container=null},_createOfferListView(){const e=new a({me:this.me,offerFilters:this.offerFilters,offers:this.offers,renewWithOffers:this.renewWithOffers});return this.listenTo(e,a.Events.NEW_REQUEST_OFFER,this._requestOfferButtonClicked.bind(this)),this.listenTo(e,a.Events.EDIT_OFFER,this._cardClicked.bind(this)),e},async _requestOfferButtonClicked(){this.state=l.NEW_REQUEST_OFFER,this.offerListViewPage&&(this.stopListening(this.offerListView),this.offerListViewPage.destroy(),this.offerListViewPage=null),await this._createNewOfferRequest(),this.render()},async _cardClicked(e){await this._loadOffer(e.get("groupId")),await this._editOffer(),this.render()},async _loadOffer(e){try{return this.offer=this.offerCreationFactory.createModel(i.Types.OFFER,{id:e},{trackNestedAttibutes:!0}),await this.offer.fetchPromise()}catch(e){console.log(e)}},async _editOffer(){this.state=l.OFFER_UPDATE,this.offerCreationPage&&(this.stopListening(this.offerCreationPage),this.offerCreationPage.destroy(),this.offerCreationPage=null),this.offerCreationPage=await this._createOfferCreationPage(this.offer),this.listenTo(this.offerCreationPage,r.Events.CANCEL,this._cancelButtonClicked.bind(this))},async _createOfferCreationPage(e){const t=this.portfolioFactory.createPackCollection(n.Types.BY_TRIGRAM_V2,this.offerCreationModel);return new r({me:this.me,offerCreationModel:e,portfolioPackCollection:t,renewWithOffers:this.renewWithOffers})},async _createNewOfferRequest(){const e=this.offerCreationFactory.createModel(i.Types.OFFER,null,{trackNestedAttibutes:!0});this.offerCreationPage=await this._createOfferCreationPage(e),this.listenTo(this.offerCreationPage,r.Events.CANCEL,this._cancelButtonClicked.bind(this))},_cancelButtonClicked(){this.state=l.OFFER_LIST_VIEW,this.offerCreationPage&&(this.stopListening(this.offerCreationPage),this.offerCreationPage.destroy(),this.offerCreationPage=null),this.render()}});return c.States=l,c}),define("DS/MPFMarketplaceAdmin/orderCancellation/OrderCancellationPage",["UWA/Class/View","DS/UIKIT/Alert","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFPersonModel/PersonModel","DS/MPFCartModel/CartCollection","DS/MPFCartModel/CartCollectionFilterModel","DS/MPFCountryModel/CountryCollection","DS/MPFCartModel/CartFactory","DS/MPFCartModel/CartCancellationFactory","DS/MPFCartModel/CartNotesFactory","DS/MPFDocumentModel/DocumentFactory","DS/MPFModel/CollectionFetchOptions","DS/MPFMarketplaceAdmin/orderCancellation/OrderCancellationFilterCommands","DS/MPFMarketplaceAdmin/orderCancellation/OrderCancellationList","DS/MPFMarketplaceAdmin/orderCancellation/CancellationModal","DS/MPFPaginationComponent/PaginationComponent","i18n!DS/MPFMarketplaceAdmin/assets/nls/OrderCancellation","css!DS/MPFMarketplaceAdmin/MPFMarketplaceAdmin.css"],(e,t,s,r,i,a,n,o,l,c,h,d,u,f,m,p,C,E)=>{"use strict";return e.extend({className:"mpf-order-cancellation-page",setup(e={}){r.requiredOfPrototype(e.me,i,"options.me must be a PersonModel"),r.requiredOfPrototype(e.carts,a,"options.carts must be a CartCollection"),r.requiredOfPrototype(e.cartFilters,n,"options.cartFilters must be a CartCollectionFilterModel"),r.requiredOfPrototype(e.cartFactory,l,"options.cartFactory must be a CartFactory"),r.requiredOfPrototype(e.cartCancellationFactory,c,"options.orderCancellationFactory must be a CartCancellationFactory"),r.requiredOfPrototype(e.cartNotesFactory,h,"options.cartNotesFactory must be a CartNotesFactory"),r.requiredOfPrototype(e.documentFactory,d,"options.options.documentFactory must be a DocumentFactory"),r.requiredOfPrototype(e.countries,o,"options.countries must be a CountryCollection"),this.me=e.me,this.carts=e.carts,this.countries=e.countries,this.cartFilters=e.cartFilters,this.cartFactory=e.cartFactory,this.cartQuoteFactory=e.cartQuoteFactory,this.cartCancellationFactory=e.cartCancellationFactory,this.invoiceFactory=e.invoiceFactory,this.cartNotesFactory=e.cartNotesFactory,this.documentFactory=e.documentFactory,this.filterCommands=this._createFilterCommands(),this.orderList=this._createOrderList(),this.paginationComponent=this._createPaginationComponent(),this.cancellationModal=this._createCancellationModal(),this.alert=this._createAlert(),this.listenTo(this.cartFilters,"onChange",this._onFilterUpdate.bind(this)),this.listenTo(this.filterCommands,f.Events.REFRESH,this._onFilterUpdate.bind(this))},render(){return this.container.setContent([this.filterCommands.render(),this.alert,this.cancellationModal.render(),this.orderList.render(),this.paginationComponent.render()]),this},destroy(){this.stopListening(),this.filterCommands.destroy(),this.orderList.destroy(),this.me=null,this.carts=null,this.countries=null,this.cartFilters=null,this.cartFactory=null,this._parent(),this.container=null},_onFilterUpdate(){this.isUpdating||(this.isUpdating=!0,this.orderList.setLoading(!0),this._updateCarts().then(()=>{this.isUpdating=!1,this.orderList.setLoading(!1),this.paginationComponent.onCollectionUpdate()}))},_updateCarts(){return this.carts.fetchPromise(this.cartFilters.toJSON())},async _refreshList(){s.mask(this.container,E.get("refreshingList"));try{await this._updateCarts()}catch(e){return console.error(e),s.unmask(this.container),void this.alert.add({className:"error",message:E.get("failedToRefreshOrderList")}).show()}s.unmask(this.container)},_showCancellationModal({state:e,cart:t,cartNotes:s,dates:r}){e===p.States.CREATE&&(s=this.cartNotesFactory.createModel(h.Types.CART_NOTES)),this.cancellationModal.show({state:e,cart:t,cartNotes:s,dates:r})},async _onCartUpdate({state:e,cartCancellation:t}){let s;await this._refreshList(),this.render(),e===p.States.CREATE?s=E.get("createdOrderCancellationWithId",{id:t.get("id")}):e===p.States.APPROVE?s=E.get("approvedCancellationWithId",{id:t.get("id")}):e===p.States.REFUSE?s=E.get("refusedCancellationWithId",{id:t.get("id")}):e===p.States.EDIT&&(s=E.get("updatedCancellationWithId",{id:t.get("id")})),this.alert.add({className:"success",message:s}).show()},_createFilterCommands(){return new f({cartFilters:this.cartFilters})},_createOrderList(){const e=new m({carts:this.carts,me:this.me,countries:this.countries,cartFactory:this.cartFactory,cartQuoteFactory:this.cartQuoteFactory,invoiceFactory:this.invoiceFactory,cartNotesFactory:this.cartNotesFactory,documentFactory:this.documentFactory});return this.listenTo(e,m.Events.CANCEL,({cart:e,dates:t})=>this._showCancellationModal({state:p.States.CREATE,cart:e,dates:t})),this.listenTo(e,m.Events.APPROVE,({cart:e,dates:t})=>this._showCancellationModal({state:p.States.APPROVE,cart:e,dates:t})),this.listenTo(e,m.Events.REFUSE,({cart:e})=>this._showCancellationModal({state:p.States.REFUSE,cart:e})),e},_createPaginationComponent(){const e=new C({collection:this.carts,pageSize:this.cartFilters.get(u.SIZE),page:this.cartFilters.get(u.START)});return this.listenTo(e,C.Events.CHANGE_PAGE,({page:e})=>{this.cartFilters.set(u.START,e)}),e},_createCancellationModal(){const e=new p({cartCancellationFactory:this.cartCancellationFactory,documentFactory:this.documentFactory});return this.listenTo(e,p.Events.ON_CART_UPDATE,this._onCartUpdate.bind(this)),e},_createAlert:()=>new t({visible:!1,closable:!0,autoHide:!0,hideDelay:4e3})})}),define("DS/MPFMarketplaceAdmin/orderCancellation/OrderCancellationPageFactory",["DS/MPFModelFactory/MPFFactoriesV2","DS/MPFDataProxy/NoDataProxy","DS/MPFCartModel/CartFactory","DS/MPFCountryModel/CountryFactory","DS/MPFCartModel/CartCollectionFilterModel","DS/MPFModel/CollectionFetchOptions","DS/MPFMarketplaceAdmin/orderCancellation/OrderCancellationPage"],(e,t,s,r,i,a,n)=>{"use strict";return Object.freeze({async create({factories:o,me:l,page:c=1,pageSize:h=10}={}){const[d,u,f,m,p,C,E]=await o.getFactories([e.Types.CART,e.Types.CART_CANCELLATION,e.Types.CART_QUOTE,e.Types.INVOICE,e.Types.CART_NOTES,e.Types.DOCUMENT,e.Types.COUNTRY]),[g,P]=await Promise.all([d.createCollection(s.Types.CART_TRANSACTIONS),E.createCollection(r.Types.BUYER).fetchPromise()]),_=new i({[a.SIZE]:h,[a.START]:c},{dataProxy:t.getInstance()});return new n({cartFilters:_,carts:g,me:l,countries:P,cartFactory:d,cartCancellationFactory:u,cartQuoteFactory:f,invoiceFactory:m,cartNotesFactory:p,documentFactory:C})}})}),define("DS/MPFMarketplaceAdmin/offerManagement/OfferManagementPageFactory",["DS/MPFModelFactory/MPFFactoriesV2","DS/MPFDataProxy/NoDataProxy","DS/MPFOfferModel/OfferCreationFactory","DS/MPFOfferModel/OfferFactory","DS/MPFOfferModel/OfferCollectionFilterModel","DS/MPFModel/CollectionFetchOptions","DS/MPFConnector/MarketplaceAdminConnector","DS/MPFServices/MarketplaceServices","DS/MPFMarketplaceAdmin/offerManagement/OfferManagementPage"],(e,t,s,r,i,a,n,o,l)=>{"use strict";return Object.freeze({async create({factories:c,me:h,page:d=1,pageSize:u=10}={}){const f=n.fromMpDataMgtUrl(window.location.href,{service:o.ADMINISTRATION}),m=e.getInstance(f),[p,C,E]=await m.getFactories([e.Types.PORTFOLIO,e.Types.OFFER_CREATION,e.Types.OFFER]),[g,P]=await Promise.all([C.createCollection(s.Types.OFFER),E.createCollection(r.Types.OFFER_CREATION).fetchPromise({renewWithOffers:!0})]),_=new i({[a.SIZE]:u,[a.START]:d},{dataProxy:t.getInstance()});return new l({me:h,offers:g,offerFilters:_,renewWithOffers:P,offerCreationFactory:C,portfolioFactory:p,offerFactory:E})}})}),define("DS/MPFMarketplaceAdmin/PageMenu",["UWA/Core","UWA/Class/View","DS/MPFMarketplaceAdmin/orderCancellation/OrderCancellationPageFactory","DS/MPFMarketplaceAdmin/platformCreation/PlatformCreationPageFactory","DS/MPFMarketplaceAdmin/offerManagement/OfferManagementPageFactory","DS/MPFMarketplaceAdmin/sellerRoles/SellerRolesPageFactory","DS/MPFPersonModel/PersonModel","DS/MPFUrl/UrlUtils","i18n!DS/MPFMarketplaceAdmin/assets/nls/MarketplaceAdmin"],(e,t,s,r,i,a,n,o,l)=>{"use strict";const c=Object.freeze({OrderCancellation:"orderCancellation",PlatformCreation:"platformCreation",OfferManagement:"offerManagement",SellerRoles:"sellerRoles"}),h={[c.OrderCancellation]:Object.freeze({id:`mpf-nav-${c.OrderCancellation}`,name:l.get(c.OrderCancellation),factory:s,authorizedRoles:[n.Roles.SALES_ADMIN,n.Roles.PRICER,n.Roles.ADMIN_VIEWER]}),[c.PlatformCreation]:Object.freeze({id:`mpf-nav-${c.PlatformCreation}`,name:l.get(c.PlatformCreation),factory:r,authorizedRoles:[n.Roles.DEV_PARTNERS_ADMIN]}),[c.SellerRoles]:Object.freeze({id:`mpf-nav-${c.SellerRoles}`,name:l.get(c.SellerRoles),factory:a,authorizedRoles:[n.Roles.OPERATOR]}),[c.OfferManagement]:Object.freeze({id:`mpf-nav-${c.OfferManagement}`,name:l.get(c.OfferManagement),factory:i,authorizedRoles:[n.Roles.SALES_ADMIN,n.Roles.PRICER,n.Roles.ADMIN_VIEWER,n.Roles.OFFER_ADMIN]})};return t.extend({className:"mpf-page-menu",setup(e){this.connector=e.connector,this.factories=e.factories,this.me=e.me,this.authorizedPagesConfig=this._filterAuthorizedPage(),this.page=null,this.activePage=null,this.menu=this._createMenu(),this.changePage(Object.keys(this.authorizedPagesConfig).pop())},render(){const e=[this.menu];return this.page&&e.push(this.page.render()),this.container.setContent(e),this},destroy(){this._parent()},async changePage(e){if(!Object.values(c).includes(e))throw new Error(`Page does not exists : ${e}`);if(e!==this.currentPage){this.activePage=e,this._updateActiveItem();const t=this.authorizedPagesConfig[e].factory;this.page&&this.page.destroy(),this.page=await t.create({connector:this.connector,factories:this.factories,me:this.me}),this.render()}},_updateActiveItem(){Object.entries(this.authorizedPagesConfig).forEach(([e,t])=>{const s=this.menu.getElement(`#${t.id}`);e===this.activePage?s.addClassName("mpf-active"):s.removeClassName("mpf-active")})},_isPageAuthorized([e,t]){return!!t.authorizedRoles.find(e=>this.me.hasRole(e))},_filterAuthorizedPage(){return Object.fromEntries(Object.entries(h).filter(this._isPageAuthorized,this))},_createMenu(){const t=Object.values(this.authorizedPagesConfig).map(e=>this._createMenuItem(e)),s=e.createElement("ul",{class:"mpf-menu",html:t});return e.createElement("nav",{class:"mpf-nav",html:s})},_createMenuItem(t){return e.createElement("li",{id:t.id,class:"mpf-menu-item",text:t.name,events:{click:this._onMenuItemClicked.bind(this)}})},_onMenuItemClicked(e){const t=e.target.id,s=Object.keys(this.authorizedPagesConfig).find(e=>this.authorizedPagesConfig[e].id===t);s&&this.changePage(s)}})}),define("DS/MPFMarketplaceAdmin/MarketplaceAdmin",["DS/UIKIT/Mask","DS/MPFConnector/MarketplaceAdminConnector","DS/MPFServices/MarketplaceServices","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFPersonModel/PersonFactory","DS/MPFPersonModel/PersonModel","DS/MPFMarketplaceAdmin/AccessForbiddenPage","DS/MPFMarketplaceAdmin/orderCancellation/OrderCancellationPageFactory","DS/MPFMarketplaceAdmin/PageMenu","css!DS/MPFMarketplaceAdmin/MPFMarketplaceAdmin"],(e,t,s,r,i,a,n,o,l)=>{"use strict";const c=[a.Roles.OPERATOR,a.Roles.SALES_ADMIN,a.Roles.PRICER,a.Roles.DEV_PARTNERS_ADMIN,a.Roles.ADMIN_VIEWER,a.Roles.OFFER_ADMIN];return{async run({container:a}={}){e.mask(a);try{const o=t.fromMpDataMgtUrl(window.location.href,{service:s.IFWELOOP}),h=r.getInstance(o),d=await h.getFactory(r.Types.PERSON),u=await d.createModel(i.Types.ME).fetchPromise();let f;f=!!c.find(e=>u.hasRole(e))?new l({connector:o,factories:h,me:u}):new n,e.unmask(a),f.render().inject(a)}catch(t){e.unmask(a),console.error(t)}}}});