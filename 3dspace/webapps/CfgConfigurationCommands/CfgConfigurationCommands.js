define("DS/CfgConfigurationCommands/commands/CfgEditConfigurationContextCmd",["DS/UIKIT/Alert","UWA/Core","DS/ApplicationFrame/Command","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/CfgTracker/CfgTracker","DS/PADUtils/PADContext","DS/CfgBaseUX/scripts/CfgController","DS/CfgBaseUX/scripts/CfgUtility","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/CfgConfigurationCommands/assets/nls/CfgConfigurationCommands","i18n!DS/CfgFilterUX/assets/nls/CfgFilterUX","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUXNLS","DS/Utilities/Utils"],function(e,t,n,o,i,s,r,a,l,c,d,g,f,u){"use strict";return n.extend({contextDialog:null,init:function(e){var t=this;this._parent(e,{mode:"exclusive",isAsynchronous:!1}),this._isConfigAvailable=0,this.enable();t=this;a.rolesAvailable(function(e){e.isCFGRoleAvail&&(t._isConfigAvailable=1,t._setStateCmd())}),void 0!==s.get&&null!==s.get()?this._SelectorManager=s.get().getPADTreeDocument().getXSO():this._SelectorManager=null,null!==this._SelectorManager&&(void 0!==this._SelectorManager.onPostAdd&&this._SelectorManager.onPostAdd(this._checkSelection.bind(this)),void 0!==this._SelectorManager.onPostRemove&&this._SelectorManager.onPostRemove(this._checkSelection.bind(this)),void 0!==this._SelectorManager.onEmpty&&this._SelectorManager.onEmpty(this._checkSelection.bind(this)));t=this;void 0!==s.get&&null!==s.get()&&s.get().addEvent("editModeModified",function(e){!0===e?t._checkSelection():t.disable()})},_checkSelection:u.debounce(function(){this._SelectedID="";var e=this.getData().selectedNodes;e.length>=1&&(this._SelectedID=e[0].id||"",this._SelectedAlias=e[0].alias||"?"),this._setStateCmd()},20),_setStateCmd:function(){var e=0;void 0!==this._SelectedID&&""!==this._SelectedID&&(e=1,0==this._isConfigAvailable&&(e=0)),void 0!==s.get&&null!==s.get()&&!0!==s.get().getEditMode()&&(e=0),1===e?this.enable():this.disable()},destroy:function(){this.contextDialog&&this.contextDialog.closeDialog()},execute:function(){var e=this;this.disable();var t=e.getData().selectedNodes;if(0===t.length)return a.showwarning(d.Error_NoObjectSelection,"error"),void this.disable();1===t.length&&(this._SelectedID=t[0].id||"",this._SelectedAlias=t[0].alias||"?"),console.log(t);e=this;r.init(),widget.getValue("x3dPlatformId")?enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId"):enoviaServerFilterWidget.tenant="OnPremise",a.populate3DSpaceURL().then(function(){a.populateSecurityContext().then(function(){a.getPAndOAccess(["GetAttachedModels","AttachModels","DetachModels"]).then(function(t){console.log("pno res : "+t),e.pAndOAccess=t,"Granted"==t.GetAttachedModels?e.onSecurityContext(e):(a.showwarning(f.CfgMessageAccessRightsError,"error"),e.enable())},function(){console.log("getPNO API failed"),e.onSecurityContext(e)})},function(){e.enable()})})},onSecurityContext:function(e){for(var t=(e=this).getData().selectedNodes.length,n=[],o=0;o<t;o++)n.push(e.getData().selectedNodes[o].id);let s={referenceIds:n,version:"1.1",xRevisionContent:!0};a.getMultipleConfigurationContextInfo(s).then(function(t){let n=enoviaServerFilterWidget.baseURL;for(var o=0;o<t.contextInfo.length;o++){if(null!=t.contextInfo[o].content.results[0]&&null!=t.contextInfo[o].content.results[0].notification&&"unaccessible"==t.contextInfo[o].content.results[0].notification.code&&"ERROR"==t.contextInfo[o].content.results[0].notification.type)return void a.showwarning(g.Filter_unaccessiblecode_Error,"error");null!=t.contextInfo[o].content.results[0].type_icon_url&&-1==t.contextInfo[o].content.results[0].type_icon_url.indexOf(n)&&(t.contextInfo[o].content.results[0].type_icon_url=n+t.contextInfo[o].content.results[0].type_icon_url),null!=t.contextInfo[o].content.results[0].type_icon_large_url&&-1==t.contextInfo[o].content.results[0].type_icon_large_url.indexOf(n)&&(t.contextInfo[o].content.results[0].type_icon_large_url=n+t.contextInfo[o].content.results[0].type_icon_large_url)}if(null!=t.xRevisionContent)for(let e=0;e<t.xRevisionContent.length;e++)for(let o=0;o<t.xRevisionContent[e].attachedScopes.length;o++)null!=t.xRevisionContent[e].attachedScopes[o].attributes[0].type_icon_url&&-1==t.xRevisionContent[e].attachedScopes[o].attributes[0].type_icon_url.indexOf(n)&&(t.xRevisionContent[e].attachedScopes[o].attributes[0].type_icon_url=n+t.xRevisionContent[e].attachedScopes[o].attributes[0].type_icon_url),null!=t.xRevisionContent[e].attachedScopes[o].attributes[0].type_icon_large_url&&-1==t.xRevisionContent[e].attachedScopes[o].attributes[0].type_icon_large_url.indexOf(n)&&(t.xRevisionContent[e].attachedScopes[o].attributes[0].type_icon_large_url=n+t.xRevisionContent[e].attachedScopes[o].attributes[0].type_icon_large_url);var s={},r=0;if(s.xRevisionPresent=!1,null!=t.xRevisionContent&&t.xRevisionContent.length>0){if(s.xRevisionPresent=!0,t.referencesInfo.length>1&&0==t.contextInfo.length)return void a.showwarning(d.Error_Multiple_Reference_xRevision,"error");if(t.contextInfo.length>0)return void a.showwarning(d.Error_Multiple_Reference_xRevision,"error")}s.response=t,s.selection=e.getData().selectedNodes,s.pAndOAccess=e.pAndOAccess;for(o=0;o<s.response.referencesInfo.length;o++)"NO"==s.response.referencesInfo[o].isConfigurable&&r++;return r>=1&&r<s.response.referencesInfo.length?(e.enable(),void a.showwarning(d.Error_Incorrect_Type_Partial_Fail,"error")):r==s.response.referencesInfo.length?(e.enable(),void a.showwarning(d.Error_Incorrect_Type_Complete_Fail,"error")):(require(["DS/CfgConfigurationContextUX/CfgEditMultipleConfigurationContextDialog"],function(t){e.contextDialog=new t(s),e.contextDialog.render(),e.enable();let n="defaultAppID",o="ODT Environment";widget&&widget.data&&widget.data.appId&&(n=widget.data.appId),widget&&widget.options&&widget.options.title&&(o=widget.options.title);let r={AppId:n,AppName:o,CommandName:i.Labels.EDIT_CONFIGURATION_CONTEXT,CommandOperation:"Edit_Configuration_Context_Dialog_Open",ConfigMode:i.ConfigMode.CONTEXTUAL,ApplicationMode:i.ApplicationMode.DASHBOARD};a.sendConfgurationCommandsClickEventForMagicProbes(r)}),void console.log(t))},function(t){e.enable(),window.notifs=l,c.setNotificationManager(window.notifs);var n=t.search("Incorrect type");""!==n&&n>=0?a.showwarning(d.Error_Models_Incorrect_Type,"error"):a.showwarning(d.Error_Models,"error")})},getData:function(){var e={selectedNodes:[]};if(void 0!==s.get&&null!==s.get()){var t,n=s.get().getPADTreeDocument().getSelectedNodes(),o=n.length;for(t=0;t<o;t++)if(n[t].isRoot()){var i={id:n[t].getID(),alias:n[t].getLabel()};e.selectedNodes.push(i)}else{i={id:n[t].getID(),alias:n[t].getLabel(),parentID:n[t].getParent().getID(),parentalias:n[t].getParent().getLabel()};e.selectedNodes.push(i)}}return e}})});