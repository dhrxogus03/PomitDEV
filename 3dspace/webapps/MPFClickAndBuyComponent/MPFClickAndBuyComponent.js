define("DS/MPFClickAndBuyComponent/orderList/OrderListHeader",["UWA/Class/View","UWA/Core","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t)=>{"use strict";return e.extend({className:"mpf-order-list-header",render({I18n:e}){return this.container.setContent([this._getProductTitle({I18n:e}),this._getPricingStructureTitle({I18n:e}),this._getQuantityTitle({I18n:e}),this._getUnitPriceTitle({I18n:e}),this._getTotalPriceTitle({I18n:e}),this._getRemoveTitle()]),this},_getRemoveTitle:()=>t.createElement("div",{class:"mpf-remove"}),_getProductTitle:({I18n:e})=>t.createElement("div",{class:"mpf-product",text:e.get("products")}),_getPricingStructureTitle:({I18n:e})=>t.createElement("div",{class:"mpf-pricing-structure",text:e.get("pricingStructure")}),_getUnitPriceTitle:({I18n:e})=>t.createElement("div",{class:"mpf-unit-price",text:e.get("unitPriceTaxExcl")}),_getQuantityTitle:({I18n:e})=>t.createElement("div",{class:"mpf-quantity",text:e.get("quantity")}),_getTotalPriceTitle:({I18n:e})=>t.createElement("div",{class:"mpf-total-price",text:e.get("priceTaxExcl")}),destroy(){this.stopListening(),this._parent(),this.container=null}})}),define("DS/MPFClickAndBuyComponent/ClicknbuyHeader",["UWA/Class/View","UWA/Core","DS/WebappsUtils/WebappsUtils","DS/MPFServices/ObjectService","DS/MPFPortfolioModel/PortfolioPackModel","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,r,n)=>{"use strict";const s=Object.freeze({ENOVIA:"#E87722",SOLIDWORKS:"#DA291C",CATIA:"#001871",DELMIA:"#FFCD00",BIOVIA:"#C8D300","3DEXCITE":"#E87722",PLATFORM:"#005685"});return e.extend({className:"mpf-clicknbuy-header",setup({stateMachine:e}){this.stateMachine=e},render({portfolioPack:e,title:t,I18n:r}={}){const n=this.stateMachine&&this.stateMachine.isOfferView(),o=[{tag:"div",class:"mpf-header-title",html:[{tag:"span",text:t||(n?e.getDisplayName():r.get("myCart"))}]}];let a;if(n&&e&&!e.isBundle()){const t=e.getCompassRoleInfo().brand;o.push({tag:"div",class:"mpf-icon-role",html:[{tag:"img",src:i.getWebappsAssetUrl("i3DXCompass","v3.1/images/role")+"/"+t.toUpperCase()+"_Role.png"}]}),a=this._getBorderColor({brand:t})}else a=s.PLATFORM;return this.container.setStyle("border-bottom","2px solid "+a),this.container.setContent(o),this},_getBorderColor:({brand:e})=>s[e.toUpperCase()],destroy(){this.stateMachine=null,this._parent(),this.container=null}})}),define("DS/MPFClickAndBuyComponent/checkout/CompanyListPage",["UWA/Class/View","UWA/Core","UWA/Promise","DS/UIKIT/Scroller","DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","DS/MPFTracker/Category","DS/MPFServices/ObjectService","DS/MPFServices/MarketplaceServices","DS/MPFCompanyModel/CompanyFactory","DS/MPFAddressModel/AddressFactory","DS/MPFCompanyModel/CompanyModel","DS/MPFCompanyModel/CompanyCollection","DS/MPFCountryModel/CountryCollection","DS/MPFPaymentCardTokenModel/PaymentCardTokenCollection","DS/MPFAddressModel/AddressModel","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartModelHelper","DS/MPFPspModel/PspModel","DS/MPFModalConfiguratorComponent/BillingAddressHelper","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","i18n!DS/MPFAddressFormComponent/assets/nls/AddressFormComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,r,n,s,o,a,c,l,d,h,u,p,m,C,f,g,y,P,I,S)=>{"use strict";const M=Object.freeze({VALID:"valid",INVALID:"invalid"}),E=Object.freeze({CONTINUE_WITH_COMPANY:"ContinueWithCompany"}),T=e.extend({className:"mpf-company-list-page mpf-click-and-buy",setup(e={}){this._checkPrototypes(e),this.service=e.service||c.CLICK_AND_BUY,this.company=e.company,this.companySearch=e.companySearch,this.address=e.address,this.companyAddresses=e.companyAddresses,this.cart=e.cart,this.cartPsp=e.cartPsp,this.matchingCompanies=e.matchingCompanies,this.companyFactory=e.companyFactory,this.addressFactory=e.addressFactory,this.countries=e.countries,this.cardTokens=e.cardTokens,this.billingAddressHelper=e.billingAddressHelper,this.selectCompanyMessage=this._createSelectCompanyMessage(),this.companyCards=this._createMatchedCompanyCards(),this.newCompanyCard=this._createCompanyCard(this.companySearch,this.address),this.selectedCompany=""},render(){const e=t.createElement("div",{class:"mpf-company-list",html:[this.selectCompanyMessage,this.companyCards]}),i=t.createElement("div",{class:"mpf-company-scroll",html:e}),n=t.createElement("div",{class:"mpf-new-company",html:[t.createElement("p",{text:I.get("continueWithInfoProvided")}),this.newCompanyCard]});return this.container.setContent([i,n]),new r({element:e}).inject(i),this._sendTrackingPage(),this},save(){let e;"new"===this.selectedCompany?(this.companySearch.set(h.Fields.BILL_TO_ADDRESS,this.address),e=this.companySearch):e=this.matchingCompanies.find(e=>e.get("DBId")===this.selectedCompany);const r=t.is(this.companySearch.getTaxRegistrationId())&&""!==this.companySearch.getTaxRegistrationId();return e.set(h.Fields.NO_VAT_ID,r?"FALSE":"TRUE"),this._sendTrackingEvent(E.CONTINUE_WITH_COMPANY,this.selectedCompany),this.company.set(e.omit(h.Fields.MATCHING_COMPANIES,"address")),(this.company.isNew()?this.company.savePromise():this.company.savePromise(this.company.getPendingChanges(),{patch:!0})).then(()=>{const e=this.addressFactory.createModel(d.Types.COMPANY,this.company.getBillToAddress(),{parse:!0});return this.companyAddresses.add(e),this.cardTokens.setParentResourceId(this.company.get("id")),Promise.all([this.billingAddressHelper.patchBillingAddress(e,{[f.Fields.STATE]:f.States.SUBMITTED}),this.cardTokens.fetchPromise()])}).then(([{hasCountryChanged:e},t])=>({hasCountryChanged:e})).catch(e=>{let t;return e.options&&e.options.request&&(t=-1!==e.options.request.xhr.response.indexOf("Error.MismatchAttribute")?"MismatchAttribute":-1!==e.options.request.xhr.response.indexOf("Error.NonRomanForbidden")?"NonRomanForbidden":""),i.reject(t)})},_onCompanySelected(e){this.selectedCompany=e,this.companyCards.forEach(t=>{t.getData("company-id")===e?t.addClassName("selected"):t.removeClassName("selected")}),this.newCompanyCard.getData("company-id")===e?this.newCompanyCard.addClassName("selected"):this.newCompanyCard.removeClassName("selected");const t=""!==e;this.dispatchEvent(t?M.VALID:M.INVALID)},_createMatchedCompanyCards(){return this.matchingCompanies.map(e=>this._createCompanyCard(e,e.getBillToAddress()))},_createCompanyCard(e,i){const r=t.is(e.get("DBId"))?e.get("DBId"):"new",n=t.createElement("div",{class:"mpf-company-left",html:this._getAddress(i)}),s=t.is(e.getTaxRegistrationId())?e.getTaxRegistrationId():"",o=t.createElement("div",{class:"mpf-company-right",html:t.createElement("div",{text:I.get("taxRegistrationId")+": "+s})}),a=t.createElement("div",{class:"mpf-company-card",events:{click:this._onCompanySelected.bind(this,r)},html:[t.createElement("div",{class:"mpf-company-title",text:e.getName()}),t.createElement("div",{class:"mpf-company-content",html:[n,o]})]});return a.setData("company-id",r),a},_getAddress:e=>[C.Fields.LINE1,C.Fields.LINE2,C.Fields.LINE3,C.Fields.LINE4,C.Fields.CITY,C.Fields.COUNTY,C.Fields.STATE,C.Fields.POSTAL_CODE,C.Fields.COUNTRY].map(i=>{if(i===C.Fields.STATE){const r=S[e.getCountry()+e.getState()];return t.is(r)?r:e.get(i)}return e.get(i)}).filter(e=>e&&e.length>0).map(e=>t.createElement("div",{class:"mpf-address-line",text:e})),_createSelectCompanyMessage:()=>t.createElement("p",{text:I.get("selectMatchingCompany")}),_checkPrototypes(e){a.requiredOfPrototype(e.billingAddressHelper,P,"options.billingAddressHelper must be a BillingAddressHelper"),a.requiredOfPrototype(e.company,h,"options.company must be a CompanyModel"),a.requiredOfPrototype(e.address,C,"options.address must be an AddressModel"),a.requiredOfPrototype(e.cart,f,"options.cart must be a CartModel"),a.requiredOfPrototype(e.cartPsp,y,"options.cartPsp must be a PspModel"),a.requiredOfPrototype(e.matchingCompanies,u,"options.matchingCompanies must be a CompanyCollection"),a.requiredOfPrototype(e.companyFactory,l,"options.companyFactory must be a CompanyFactory"),a.requiredOfPrototype(e.addressFactory,d,"options.addressFactory must be an AddressFactory"),a.requiredOfPrototype(e.countries,p,"options.countries must be a CountryCollection"),a.requiredOfPrototype(e.cardTokens,m,"options.cardTokens must be a PaymentCardTokenCollection")},_sendTrackingPage(){const e=n.createPageBuilder({url:"/checkout/AddressCreation/CompanyMatching"}).setTitle("Company Matching");g.addTrackerInformation(e,this.cart),e.addDimension(s.MARKETPLACE_SERVICE,this.service).addDimension(s.BUYER_TYPE,"company").send()},_sendTrackingEvent(e,t){const i=n.createEventBuilder({category:o.CHECKOUT,action:e}).setLabel(t);g.addTrackerInformation(i,this.cart),i.addDimension(s.MARKETPLACE_SERVICE,this.service).addDimension(s.BUYER_TYPE,"company").send()},destroy(){this.cart=null,this.matchingCompanies=null,this.company=null,this.address=null,this.addressFactory=null,this.companyFactory=null,this.countries=null,this._parent(),this.container=null}});return T.Events=M,T}),define("DS/MPFClickAndBuyComponent/orderList/SubscriptionInfoModal",["UWA/Core","UWA/Class/View","DS/UIKIT/Modal","DS/MPFPortfolioModel/PortfolioModel","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFServices/ObjectService"],function(e,t,i,r,n,s){"use strict";const o=Object.freeze({}),a=Object.freeze({NEED_HELP:"NeedHelpPopup"}),c=t.extend({className:"mpf-subscription-info-modal",setup(e={}){this.tracker=e.tracker,this.modal=this._createModal()},render(){return this.container.setContent(this.modal),this},show({SubI18n:e,portfolio:t}){this.modal.setHeader(this._setHeader(e)),this.modal.setBody(this._setBody(e,t)),this.modal.setFooter(this._setFooter(e)),this.modal.show()},hide(){this.modal.hide()},destroy(){this.modal.destroy(),this.modal=null,this._parent(),this.container=null},_createModal:()=>new i({className:"mpf-subscription-info"}),_setHeader:t=>e.createElement("div",{tag:"div",text:t.get("subscriptionInformation")}),_setBody(t,i){const s=e.createElement("div",{class:"mpf-paragraph",html:[{tag:"div",class:"mpf-title",text:t.get("renewalPolicy2")},{tag:"div",class:"mpf-text",text:i.has(r.Fields.RENEWAL)?i.get(r.Fields.RENEWAL):n.isRenewableOffer(i)?t.get("subscriptionsAndRenewals_text_renewable"):t.get("subscriptionsAndRenewals_text_non_renewable")}]}),o=e.createElement("div",{class:"mpf-paragraph",html:[{tag:"div",class:"mpf-title",text:t.get("additionalInformation")},{tag:"div",class:"mpf-text",html:i.getOfferDetails()}]});return[s,i.isBundleOffer()?o:""]},_setFooter(t){const i=e.createElement("div",{class:"fonticon fonticon-user-help"});return e.createElement("a",{class:"btn btn-primary",html:[i,t.get("needHelp")],href:"https://www.3ds.com/support/3dexperience-platform-on-cloud-support/support-for-online-purchase",target:"_blank",events:{click:()=>{this.tracker.sendEvent({action:a.NEED_HELP})}}})}});return c.Events=o,c}),define("DS/MPFClickAndBuyComponent/MarketingPortfolioPage",["UWA/Class/View","UWA/Core","DS/UIKIT/Carousel","DS/UIKIT/Scroller","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,r)=>{"use strict";return e.extend({className:"mpf-marketing-portfolio",setup(e={}){this._parent(e),this.portfolioInfo=e.portfolioInfo},render(){const e=this._getVideoContainer(),i=t.is(e)?[this._getTagLineContainer(),e,this._getDescription(),this._getCarousel()]:[this._getTagLineContainer(),this._getCarousel(),this._getDescription()],n=t.createElement("div",{class:"mpf-scroll",html:t.createElement("div",{class:"mpf-marketing-content",html:i})});return this.container.setContent(n),new r({element:n}).inject(this.container),this},_getDescription(){return t.createElement("div",{class:"mpf-description",html:this.portfolioInfo.description})},_getCarousel(){const e=this.portfolioInfo.descriptionMedias,r=e=>"png"===e.split(".").pop();if(e){const n=e.filter(r).map(e=>t.createElement("img",{src:e,width:"350px",height:"200px"}));return t.createElement("div",{class:"mpf-carousel",html:new i({slides:n,slideSelector:"> img",infinite:!1,autoPlay:!1})})}},_getTagLineContainer(){return t.createElement("div",{class:"mpf-tagline",html:this.portfolioInfo.tagLine})},_getVideoContainer(){const e=this.portfolioInfo.descriptionMedias,i=e=>{const t=e.split(".").pop();return"mp4"===t||"webm"===t};if(e){if(e.some(i)){const r=e.filter(i),n=t.createElement("video",{controls:!0,width:"350",html:r.map(e=>({tag:"source",src:e,type:"video/"+e.split(".").pop()}))});return t.createElement("div",{class:"mpf-video",html:n})}}},destroy(){this.stopListening(),this.portfolioInfo=null,this._parent(),this.container=null}})}),define("DS/MPFClickAndBuyComponent/MaintenancePage",["UWA/Class/View","UWA/Core","DS/WebappsUtils/WebappsUtils","DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","DS/MPFServices/MarketplaceServices","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,r,n,s,o)=>{"use strict";return e.extend({className:"mpf-clicknbuy-maintenance",setup(e={}){this.imgContainer=this._createImgContainer(),this.header=this._createHeader(),this.disclaimer=this._createDisclaimer(),this.tryAgain=this._createTryAgain()},render(){return this.container.setContent([this.imgContainer,this.header,this.disclaimer,this.tryAgain]),this._sendTrackerPage(),this},_sendTrackerPage(){r.createPageBuilder({url:window.location.pathname}).setTitle("MaintenancePage").addDimension(n.MARKETPLACE_SERVICE,s.CLICK_AND_BUY).send()},_createTryAgain:()=>t.createElement("div",{class:"mpf-maintenance-tryagain",text:o.get("tryAgainLater")}),_createDisclaimer:()=>t.createElement("div",{class:"mpf-maintenance-disclaimer",text:o.get("engineersPerformingMaintenance")}),_createHeader:()=>t.createElement("div",{class:"mpf-maintenance-header",text:o.get("storeUpdate").toUpperCase()}),_createImgContainer(){const e=i.getWebappsAssetUrl("MPFClickAndBuyComponent","graphics/pictures")+"/store_down.jpg";return t.createElement("img",{src:e})}})}),define("DS/MPFClickAndBuyComponent/ClickAndBuyTracker",["DS/MPFTracker/Tracker","DS/MPFTracker/Category","DS/MPFTracker/Dimension","DS/MPFServices/MarketplaceServices","DS/MPFCartModel/CartModelHelper"],function(e,t,i,r,n){"use strict";const s=Object.freeze({QUOTE:"quote",CHECKOUT:"checkout",OFFER:"buy"});class o{constructor({service:e}={}){this.service=e||r.CLICK_AND_BUY}trackPage({cart:t,url:r,title:s,portfolioPacks:o,portfolios:a,offerName:c}){const l=e.createPageBuilder({url:r}).setTitle(s).addDimension(i.MARKETPLACE_SERVICE,this.service);return t&&n.addTrackerInformation(l,t),o&&this._addPortfolioPackInformation(l,o),a&&this._addPortfolioInformation(l,a),l.addDimension(i.MARKETPLACE_SERVICE,this.service).addDimension(i.BUYER_TYPE,"company").addDimension(i.OFFER_NAME,c).send()}sendEvent({cart:r,action:s,label:o,value:a,category:c=t.CART}){const l=e.createEventBuilder({category:c,action:s});o&&l.setLabel(o),a&&l.setValue(a),r&&n.addTrackerInformation(l,r),l.addDimension(i.MARKETPLACE_SERVICE,this.service).addDimension(i.BUYER_TYPE,"company").send()}_addPortfolioPackInformation(e,t){const r=t.map(e=>e.getDisplayName()).filter((e,t,i)=>i.indexOf(e)===t).join(","),n=t.map(e=>e.getOffers()).map(e=>e.map(e=>e.get("externalOfferId"))).flat().filter((e,t,i)=>i.indexOf(e)===t).join(","),s=0===n.length&&t.map(e=>e.getOffers()).map(e=>e.map(e=>e.get("productNumber"))).flat().filter((e,t,i)=>i.indexOf(e)===t).join(",");e.addDimension(i.EXTERNAL_OFFER_ID,s||n).addDimension(i.EXTERNAL_OFFER_NAME,r)}_addPortfolioInformation(e,t){const r=t.map(e=>e.getProductDisplayName()).filter((e,t,i)=>i.indexOf(e)===t).join(","),n=t.map(e=>e.getProductNumber()).filter((e,t,i)=>i.indexOf(e)===t).join(","),s=t.map(e=>e.getExternalOfferId()).filter((e,t,i)=>i.indexOf(e)===t).join(",");e.addDimension(i.EXTERNAL_OFFER_NAME,r).addDimension(i.EXTERNAL_OFFER_ID,n||s)}}return o.Titles=s,o}),define("DS/MPFClickAndBuyComponent/PreReqMoreInfoSection",["UWA/Class/View","UWA/Core","DS/MPFCompassPlatformServices/CompassPlatformServices","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i)=>{"use strict";return e.extend({className:"mpf-more-info-section",setup(e={}){this.body=this._createBodyContainer()},render({preReqs:e,I18n:t}){return this.body.hide(),this.body.empty(),this.container.setContent([{tag:"div",class:"mpf-more-info-section-title",html:[{tag:"span",class:"mpf-expand-icon fonticon fonticon-expand-right"},t.get("moreInformation")],events:{click:this._extendMoreInformationSection.bind(this)}},this.body]),this._getPreReqDescriptions({preReqs:e}),this},destroy(){this.body=null,this._parent(),this.container=null},_extendMoreInformationSection(){const e=this.container.getElement(".mpf-expand-icon");this.body.isHidden()?(e.removeClassName("fonticon fonticon-expand-right"),e.addClassName("fonticon fonticon-expand-down"),this.body.show()):(e.removeClassName("fonticon fonticon-expand-down"),e.addClassName("fonticon fonticon-expand-right"),this.body.hide())},_createBodyContainer(){const e=t.createElement("div",{class:"mpf-more-info-section-content"});return e.hide(),e},_getPreReqDescriptions({preReqs:e}){e.forEach(e=>{try{i.getPortolioRole(e.productTrigram.split("-")[0],this._addDescriptionInBody.bind(this,e))}catch(e){console.warn(e)}})},_addDescriptionInBody(e,i){const r=t.createElement("div",{class:"mpf-role-description",html:[t.createElement("h4",{text:e.productDisplayName}),i.description]});this.body.addContent(r)}})}),define("DS/MPFClickAndBuyComponent/checkout/LegalAgreementsSection",["UWA/Core","UWA/Class/View","UWA/Promise","DS/MPFServices/ObjectService","DS/UIKIT/Input/Toggle","DS/UIKIT/Alert","DS/MPFTCContractModel/TCContractFactory","DS/MPFTcDocumentModel/TCDocumentFactory","DS/MPFCartModel/CartModel","DS/MPFTCContractModel/TCContractModel","DS/MPFTCContractModel/SoftwareAgreementModel","DS/MPFCompanyModel/CompanyModel","DS/MPFPersonModel/PersonModel","DS/MPFBuyer/BuyerType","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent"],function(e,t,i,r,n,s,o,a,c,l,d,h,u,p,m){"use strict";var C,f={};return f.ON_RENDER="onRender",f.VALID_SECTION="validSection",f.INVALID_SECTION="invalidSection",(C=t.extend({className:"mpf-legal-section",setup:function(e){e||(e={}),this._parent(e),this._checkPrototypes(e),this.cart=e.cart,this.buyer=e.buyer,this.tcContractFactory=e.tcContractFactory,this.tcDocumentFactory=e.tcDocumentFactory,this.softwareAgreement=e.softwareAgreement,this.tcContracts=this.tcContractFactory.createCollection(o.Types.TERMS_AND_CONDITIONS),this.tcDocument=this.tcDocumentFactory.createModel(a.Types.CLICKNBUY_TC),this.checkbox=this._createToggle()},render:function(){var e=this;return this._getDocuments().then(function(){e.container.setContent([e.checkbox,e._getLabel()]),e.dispatchEvent(f.ON_RENDER)}).catch(this._displayAlert.bind(this)),this},save:function(){return i.all([this._saveClosaContract(),this._saveTermsOfUseContract()])},isChecked:function(){return this.checkbox.isChecked()},_saveTermsOfUseContract:function(){var e,t={};return e=this._findContract(),t[l.FIELDS.CURRENT_STATE]=l.STATUS.inEffect,e.getCurrentState()===l.STATUS.draft?e.savePromise(t,{patch:!0}):i.resolve()},_saveClosaContract:function(){return this.tcContractFactory.createModel(o.Types.EXISTING_DOCUMENT,{documentID:this.softwareAgreement.get("id"),currentState:l.STATUS.inEffect,consumerID:this.buyer.get("id"),cartItemID:this.cart.getItems()[0].get("id")}).savePromise()},_getDocuments:function(){return i.all([this._fetchTermsAndConditions(),this._fetchClosa()])},_fetchTermsAndConditions:function(){return i.all([this.tcDocument.fetchPromise(),this.tcContracts.fetchPromise({type:[l.TcTypes.CLICKNBUY_TC]})])},_fetchClosa:function(){return this.softwareAgreement.fetchPromise({cartId:this.cart.get("id")})},_getLabel:function(){const e=[{tag:"li",text:m.get("allBillingInformationIsCorrect")},{tag:"li",text:h.prototype.isPrototypeOf(this.buyer)?m.get("authorizedToRepresentCompany"):m.get("consentAccess")},{tag:"li",html:m.get("agreeTermsAndConditions",{termsAndConditions:this._getTermsAndConditionsLink().outerHTML})},{tag:"li",html:m.get("agreeClosa",{closa:this._getClosaLink().outerHTML})}];return this.cart.hasMakerItems()&&e.splice(1,0,{tag:"li",text:m.get("iAmAMakerOrHobbyist")}),{tag:"div",class:"mpf-switch-label",html:[m.get("acknowledgeThat"),{tag:"ul",html:e}]}},_getClosaLink:function(){return e.createElement("a",{target:"_blank",href:this.softwareAgreement.getUrl(),text:m.get("closaLabel")})},_getTermsAndConditionsLink:function(){return e.createElement("a",{target:"_blank",href:this.tcDocument.getDocUrl(),text:m.get("termsAndConditionsLabel")})},_findContract:function(){var e,t=this;return(e=this.tcContracts.filter(function(e){return e.getConsumerID()===t.buyer.get("id")&&e.getDocumentType()===l.DOCUMENT_TYPES.CLICKNBUY_TC&&e.getCurrentState()!==l.STATUS.archived&&e.getSigningRevision()===e.getActiveRevision()}).shift()).dataProxy=t.tcContractFactory.getDataProxy(o.Types.CONTRACTS),e},_displayAlert:function(){new s({className:"error",icon:!0,closable:!0,visible:!0,messages:{className:"error",message:m.get("errorLoadingDocuments")}}).inject(document.body.getElementsByClassName("mpf-order-confirmation-page")[0],"top")},_createToggle:function(){var e=this;return new n({type:"switch",className:"primary",value:"",events:{onChange:function(){this.isChecked()?e.dispatchEvent(f.VALID_SECTION):e.dispatchEvent(f.INVALID_SECTION)}}})},_checkPrototypes:function(e){r.requiredAsOneOf(e.buyer,[h,u],"options.buyer must either be a CompanyModel or a PersonModel"),r.requiredOfPrototype(e.cart,c,"options.cart must be a CartModel"),r.requiredOfPrototype(e.tcContractFactory,o,"options.tcContractFactory must be a TcContractFactory"),r.requiredOfPrototype(e.tcDocumentFactory,a,"options.tcDocumentFactory must be a TcDocumentFactory"),r.requiredOfPrototype(e.softwareAgreement,d,"options.softwareAgreement must be a SoftwareAgreementModel")}})).Events=Object.freeze(f),C}),define("DS/MPFClickAndBuyComponent/offerList/OfferTile",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Input/Number","DS/UIKIT/Popover","DS/MPFServices/ObjectService","DS/MPFPortfolioModel/PortfolioModel","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","DS/MPFTracker/Value","DS/MPFTracker/Category","DS/MPFServices/MarketplaceServices","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,r,n,s,o,a,c,l,d,h,u)=>{"use strict";const p=Object.freeze({SELECTED:"selected",ADD_TO_CART:"addToCart",QUANTITY_CHANGED:"QuantityChanged",REASSURE_PAYMENT:"ReassurePayment",PAYMENT_MORE_INFO:"PaymentMoreInfo"}),m=Object.freeze({YSC:"YearlySubTypeSelected",QRC:"QuarterlySubTypeSelected",QSC:"QuarterlySubTypeSelected",MSC:"MonthlySubtypeSelected"}),C=e.extend({className:"mpf-offer-tile",domEvents:{click:"_onSelectOffer"},setup(e={}){this._checkPrototypes(e),this.portfolio=e.portfolio,this.I18n=e.I18n,this.locale=e.locale||"en-US",this.selected=!0===e.selected,this.disabled=!0===e.disabled,this.isStudentPortfolio=this._isEduPortfolio(),this.isMakerPortfolio=this._isMakerPortfolio(),this.periodicityContainer=this._createPeriodicityContainer(),this.priceContainer=this._createPriceContainer(),this.addToCartButton=this._createAddToCartButton(),this.quantityInput=this._createQuantityInput(),this.quantityContainer=this._createQuantityContainer(),this.totalPriceContainer=this._createTotalPriceContainer(),this.secureTransactionContainer=this._createSecureTransactionContainer()},render(){const e=[this.periodicityContainer,this.priceContainer];return this.selected?(this.container.addClassName("selected"),this.periodicityContainer.getElement(".fonticon").removeClassName("fonticon fonticon-radiobutton-on").addClassName("fonticon fonticon-status-ok"),this.isStudentPortfolio||(e.push(this.quantityContainer),e.push(this.totalPriceContainer)),e.push(t.createElement("div",{class:"mpf-button",html:this.addToCartButton})),e.push(this.secureTransactionContainer)):(this.container.removeClassName("selected"),this.periodicityContainer.getElement(".fonticon").removeClassName("fonticon fonticon-status-ok").addClassName("fonticon fonticon-radiobutton-on")),this.portfolio.has("fullPrice")?this.container.addClassName("full-price"):this.container.removeClassName("full-price"),this.disabled?this.container.addClassName("disabled"):this.container.removeClassName("disabled"),this.container.setContent(e),this},isDisabled(){return!0===this.disabled},isSelected(){return!0===this.selected},select(){this.selected=!0,this.render()},deselect(){this.selected=!1,this.render()},_createSecureTransactionContainer(){const e=t.createElement("span",{class:"fonticon fonticon-lock"}),r=new i({className:"link",value:this.I18n.get("secureTransaction"),events:{onClick:()=>{c.createEventBuilder({category:h.OFFER,action:p.REASSURE_PAYMENT}).addDimension(l.MARKETPLACE_SERVICE,u.CLICK_AND_BUY).send()}}}),s=t.createElement("div",{class:"mpf-popoverContent",html:[t.createElement("div",{class:"mpf-secureTransactionPopover",text:this.I18n.get("secureTransactionPopover")}),new i({className:"link",value:this.I18n.get("moreInformation"),events:{onClick:()=>{c.createEventBuilder({category:h.OFFER,action:p.PAYMENT_MORE_INFO}).addDimension(l.MARKETPLACE_SERVICE,u.CLICK_AND_BUY).send(),window.open("https://www.3ds.com/privacy-policy","_blank")}}})]}),o=t.createElement("div",{class:"mpf-secure-transaction",html:[e,r]});return new n({className:"mpf-secure-transaction-popover",target:r.getContent(),position:"right",allowedPositions:["right"],trigger:"touch",title:this.I18n.get("secureTransaction"),body:s}),o},_isEduPortfolio(){return a.isEduOffer(this.portfolio)},_isMakerPortfolio(){return a.isMakerOffer(this.portfolio)},_createQuantityContainer(){const e=this.portfolio.isCreditOffer()?this.I18n.get("quantityOfCredits"):this.I18n.get("numberOfUsers");return t.createElement("div",{class:"mpf-offer-quantity",html:[t.createElement("div",{class:"mpf-offer-quantity-label",text:e}),this.quantityInput]})},_createQuantityInput(){return new r({min:this.portfolio.isCreditOffer()?2500:1,step:1,max:this.isMakerPortfolio?5:99999,decimalPrecision:1,events:{onChange:this._updateTotalPrice.bind(this)}})},_updateTotalPrice(){if(t.is(this.quantityInput)){const e=parseInt(this.quantityInput.getValue()),t=c.createEventBuilder({category:h.OFFER,action:p.QUANTITY_CHANGED}).addDimension(l.MARKETPLACE_SERVICE,u.CLICK_AND_BUY);Number.isNaN(e)?(this.quantityInput.setValue(1),t.addPersonalValue(d.QUANTITY,1)):(t.addPersonalValue(d.QUANTITY,e),this.totalPriceContainer=this._createTotalPriceContainer(),this.render()),t.send()}},_createAddToCartButton(){return new i({className:"primary",value:this.I18n.get("addToCart"),events:{onClick:this._onAddToCart.bind(this)}})},_onAddToCart(){const e=parseInt(this.quantityInput.getValue(),10);this.dispatchEvent(p.ADD_TO_CART,{portfolio:this.portfolio,quantity:e});const t=c.createEventBuilder({category:h.OFFER,action:p.ADD_TO_CART}).addDimension(l.MARKETPLACE_SERVICE,u.CLICK_AND_BUY).addPersonalValue(d.QUANTITY,e);a.addTrackerInformation(t,this.portfolio),t.send()},_onSelectOffer(){if(!this.disabled&&!this.selected){this.dispatchEvent(p.SELECTED,this);const e=c.createEventBuilder({category:h.OFFER,action:m[this.portfolio.getLicensingScheme()]||p.SELECTED}).addDimension(l.MARKETPLACE_SERVICE,u.CLICK_AND_BUY);a.addTrackerInformation(e,this.portfolio),e.send()}},_createTotalPriceContainer(){const e=(t.is(this.quantityInput)?this.portfolio.getPricelistPrice()*parseInt(this.quantityInput.getValue()):this.portfolio.getPricelistPrice()).toLocaleString(this.locale,{style:"currency",currency:this.portfolio.getPricelistCurrency()}),i=this.portfolio.get("licensingScheme");let r="";return i===o.RevTypes.YSC?r=this.I18n.get("paidYearly"):i===o.RevTypes.MSC?r=this.I18n.get("paidMonthly"):i!==o.RevTypes.QSC&&i!==o.RevTypes.QRC||(r=this.I18n.get("paidQuarterly")),t.createElement("div",{class:"mpf-total-price",html:[t.createElement("div",{class:"mpf-total-price-value",text:this.I18n.get("totalPrice")+": "+e}),t.createElement("div",{class:"mpf-total-price-tax",text:this.I18n.get("excludingTax")+", "+r})]})},_createPeriodicityContainer(){let e,i;if(this.portfolio.isCreditOffer())i=this.I18n.get("yearlyCredits");else{const r=this.portfolio.get("licensingScheme");r===o.RevTypes.YSC?e=this.isStudentPortfolio?this.I18n.get("oneYear"):this.I18n.get("yearly"):r===o.RevTypes.MSC?e=this.I18n.get("monthly"):r!==o.RevTypes.QSC&&r!==o.RevTypes.QRC||(e=this.I18n.get("quarterly")),i=this.isStudentPortfolio?e:this.I18n.get("typeOfSubscription",{period:t.createElement("span",{text:e}).outerHTML})}return t.createElement("div",{class:"mpf-type-name",html:[this._createFonticon(),i]})},_createFonticon(){let e;return e=this.selected?"fonticon fonticon-status-ok":"fonticon fonticon-radiobutton-on",t.createElement("span",{class:e})},_createPriceContainer(){const e=this.portfolio.getPricelistPrice().toLocaleString(this.locale,{style:"currency",currency:this.portfolio.getPricelistCurrency()}),i=this.portfolio.has("fullPrice"),r=[t.createElement("div",{class:"mpf-price-value",text:e})],n=this.portfolio.isDisplayingPrice();if(i&&n){const e=this.portfolio.get("fullPrice").toLocaleString(this.locale,{style:"currency",currency:this.portfolio.getPricelistCurrency()}),i=t.createElement("div",{class:"mpf-full-price",text:e});r.unshift(i)}return t.createElement("div",{class:"mpf-price",html:r})},_checkPrototypes(e){s.requiredOfPrototype(e.portfolio,o,"options.portfolio must be a PortfolioModel")},destroy(){this.stopListening(),this.portfolio=null,this.I18n=null,this._parent(),this.container=null},_createTrackerEventBuilder:e=>new c.createEventBuilder({category:h.OFFER,action:p.QUANTITY_CHANGED})});return C.Events=p,C}),define("DS/MPFClickAndBuyComponent/discoverBundle/DiscoverBundleSection",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFPortfolioModel/PortfolioPackModel","DS/MPFPortfolioModel/PortfolioHelper","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,r,n,s,o)=>{"use strict";const a=Object.freeze({DISCOVER_BUNDLE:"discoverBundle"}),c=e.extend({className:"mpf-discover-bundle-section",setup({bundle:e,locale:t,I18n:i}={}){n.requiredOfPrototype(e,s,"options.bundle must be a PortfolioPackModel"),this.bundle=e,this.locale=t,this.I18n=i,this.priceInfo=this._createPriceInfo(),this.discoverButton=this._createDiscoverButton()},render(){return this.container.setContent([{tag:"div",class:"mpf-left",html:[this._createTitle(),this._createSubtitle()]},{tag:"div",class:"mpf-right",html:[{tag:"div",class:"mpf-left-in-right",html:[{tag:"span",class:"mpf-price-start",text:this.I18n.get("startingFrom")},this._createPriceInfo(),{tag:"div",class:"mpf-price-month",text:this.I18n.get("perMonth")},this.discoverButton]},{tag:"div",class:"mpf-right-in-right",html:this.discoverButton}]}]),this},_createPriceInfo(){let e;return this.bundle.getOffers().forEach(i=>{const r=i.getPriceList()[0].monthlyDisplay;(!t.is(e)||r<e)&&(e=r)}),t.createElement("span",{class:"mpf-price",text:e.toLocaleString(this.locale,{style:"currency",currency:this.bundle.getOffers().first().getPricelistCurrency()})})},_createDiscoverButton(){return new i({className:"primary",value:this.I18n.get("discover"),events:{onClick:async()=>{this.dispatchEvent(a.DISCOVER_BUNDLE,{bundle:this.bundle})}}})},_createTitle(){return t.createElement("div",{class:"mpf-title",text:this.bundle.getDisplayName()})},_createSubtitle(){const e=this.bundle.getOffers().first().getSoftwareOfferDetails().reduce((e,t,i)=>0===i?t.productDisplayName:e+" | "+t.productDisplayName,"");return t.createElement("div",{class:"mpf-subtitle",text:e})},destroy(){this.stopListening(),this.bundle=null,this.I18n=null,this._parent(),this.container=null}});return c.Events=a,c}),define("DS/MPFClickAndBuyComponent/orderList/SecureTransaction",["UWA/Class/View","UWA/Core","DS/UIKIT/Popover","DS/MPFServices/ObjectService","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,r)=>{"use strict";const n=Object.freeze({CLICKED:"clicked"}),s=e.extend({className:"mpf-secure-transaction",setup(e={}){r.requiredOfType(e.moreInformationLink,"string","options.moreInformationLink must be a string"),this.moreInformationLink=e.moreInformationLink,this.lockIcon=this._getLockIcon()},render({I18n:e}){const t=[this.lockIcon,this._getPopover({I18n:e})];return this.container.setContent(t),this},_getLockIcon:()=>t.createElement("span",{class:"fonticon fonticon-lock"}),_getPopover({I18n:e}){const r=t.createElement("a",{class:"mpf-secure-transaction-title",text:e.get("secureTransaction"),events:{click:()=>{this.dispatchEvent(n.CLICKED)}}}),s=t.createElement("div",{class:"fonticon fonticon-info"}),o=t.createElement("a",{text:e.get("moreInformation"),href:this.moreInformationLink,target:"_blank"});return new i({target:r,position:"left",trigger:"touch",title:e.get("secureTransaction"),body:[{text:e.get("secureTransactionPopover")},{tag:"div",class:"more-information",html:[s,o]}]}),r},destroy(){this._parent(),this.container=null}});return s.Events=n,s}),define("DS/MPFClickAndBuyComponent/platformSelection/PlatformSelectionDataLoader",["DS/MPFUtils/StorageUtils","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartFactory","DS/MPFTenantModel/TenantFactory","DS/MPFAmdLazyLoader/AmdLazyLoader"],function(e,t,i,r,n){"use strict";return class{constructor({cartFactory:e,tenantFactory:t,service:i}){this.cartFactory=e,this.tenantFactory=t,this.service=i}async loadData(){const[t]=await n.getInstance().get(["i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent"]),r=this.cartFactory.createModel(i.Types.ME,{});return e.loadStoredCart(this.service,r),{I18n:t,cart:r,platforms:await this.loadPrivatePlatforms({cart:r})}}async loadPrivatePlatforms({cart:e}){const t=this.tenantFactory.createCollection(r.Types.TENANTS,[],{parentResourceId:e.get("id")});return await t.fetchPromise(),t.filter(e=>!e.isPublic())}saveSelectedPlatform({cart:e,platform:i}){return e.savePromise({[t.Fields.ONLINE_INSTANCE]:i,[t.Fields.STATE]:t.States.SUBMITTED},{patch:!0})}isIFWInCart(e){return e.getItems().some(e=>e.getProductTrigram().startsWith("IFW-"))}}}),define("DS/MPFClickAndBuyComponent/orderList/BundleProductList",["UWA/Class/View","DS/MPFServices/ObjectService"],function(e,t){"use strict";const i=Object.freeze({SHOW_MARKETING_MODAL:"showMarketingModal"}),r=e.extend({className:"mpf-bundle-product-list",setup({portfolio:e,I18n:t}={}){this.portfolio=e,this.I18n=t},render(){return this.container.setContent([{tag:"div",class:"mpf-product-list-label",text:this.I18n.get("offerInclude")},{tag:"div",class:"mpf-product-list",html:this.portfolio.getSoftwareOfferDetails().map(e=>this._renderItem(e))}]),this},destroy(){this.portfolio=null,this._parent(),this.container=null},_renderItem(e){return{tag:"div",class:"mpf-bundle-product",html:[{tag:"div",class:"mpf-first-line",html:[{tag:"span",class:"mpf-product-title",text:e.productDisplayName},{tag:"span",class:"fonticon fonticon-info",events:{click:this.dispatchEvent.bind(this,i.SHOW_MARKETING_MODAL,e)}}]},{tag:"div",class:"mpf-second-line",text:e.productNumber}]}}});return r.Events=i,r}),define("DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper",["UWA/Core","DS/PlatformAPI/PlatformAPI","DS/MPFDataProxy/NoDataProxy","DS/MPFCartModel/CartPatchArray","DS/MPFCartModel/CartPatchOperation","DS/MPFCartModel/CartFactory","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFPspModel/PspModel","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFPortfolioModel/PortfolioFactory","DS/MPFUtils/MPFUtils","DS/MPFUrl/UrlUtils","DS/MPFError/ValidationError"],(e,t,i,r,n,s,o,a,c,l,d,h,u,p)=>{"use strict";const m={},C=Object.freeze({EDU_NON_EDU:"eduNonEduProducts",MAKERS_NON_MAKERS:"makersNonMakersProducts",EDU_IN_CART:"eduProductAlreadyInCart",BE_NON_BE:"businessExperienceNonBusinessExperienceProducts"}),f=Object.freeze({MpfCartUpdated:"MpfCartUpdated"});function g(e){const i=[],r=e.getItems().filter(e=>{let t=!0;const r=e.getOfferId();return r&&(i.includes(r)?t=!1:i.push(r)),t}).reduce((e,t)=>e+=parseInt(t.getQuantity()),0);t.publish(f.MpfCartUpdated,{nbItems:r})}return m.saveSubscriptionAndPreReq=function(t,i,r,n){const s=t.getItems(),o=h.findInArray(s,e=>""===e.getOfferId()&&e.getSkuId()===i.get("skuid"));return e.is(o)?o.setQuantity(parseInt(o.getQuantity())+parseInt(r)):s.push(m.getSubscriptionOp(t,i,r)),n.forEach(r=>{const n=h.findInArray(s,e=>""===e.getOfferId()&&e.getSkuId()===r.skuid);e.is(n)?n.setQuantity(parseInt(r.quantity)):s.push(m.getPreReqOp(t,i,r))}),t.setItems(s),g(t),Promise.resolve(t)},m.getSubscriptionOp=function(e,t,r){const n={[a.Fields.OFFER_ID]:"",[a.Fields.SKU_ID]:t.get("skuid"),[a.Fields.LICENSING]:t.get("licensing"),[a.Fields.LICENSING_SCHEME]:t.get("licensingScheme"),[a.Fields.PRODUCT_DISPLAY_NAME]:t.getProductDisplayName(),[a.Fields.PRODUCT_TRIGRAM]:t.get("productTrigram"),[a.Fields.PRODUCT_NUMBER]:t.get("productNumber"),[a.Fields.ACTION]:e.getActionType()||o.ActionTypes.START,[a.Fields.UNIT_NET_AMOUNT]:t.getPricelistPrice().toString(),[a.Fields.TYPE]:e.get(o.Fields.TYPE)||o.Types.SOFTWARE_REQUEST,[a.Fields.QUANTITY]:parseInt(r),[a.Fields.TEMP_UUID]:h.generateUUID()};return new a(n,{dataProxy:i.getInstance(),parse:!0})},m.getPreReqOp=function(e,t,r){const n={[a.Fields.OFFER_ID]:"",[a.Fields.SKU_ID]:r.skuid,[a.Fields.LICENSING]:r.licensing,[a.Fields.LICENSING_SCHEME]:r.licensingScheme,[a.Fields.PRODUCT_DISPLAY_NAME]:r.productDisplayName,[a.Fields.PRODUCT_TRIGRAM]:r.productTrigram,[a.Fields.PRODUCT_NUMBER]:r.productNumber,[a.Fields.ACTION]:e.getActionType()||o.ActionTypes.START,[a.Fields.UNIT_NET_AMOUNT]:r.pricelist[0].price.toString(),[a.Fields.TYPE]:e.get(o.Fields.TYPE)||o.Types.SOFTWARE_REQUEST,[a.Fields.QUANTITY]:parseInt(r.quantity),[a.Fields.TEMP_UUID]:h.generateUUID()};return new a(n,{dataProxy:i.getInstance(),parse:!0})},m.patchCartAndItems=function(e,t,{country:i}){if(e.isRenewal())return Promise.resolve();const s=new r;s.addOperation(n.Operations.MODIFY,"/",{[o.Fields.COUNTRY]:i});const c=e.getItems(),l=[];return c.forEach(e=>{let t;e.isNew()?l.push(e):t=new n(n.Operations.MODIFY,"/cart-items/"+e.id,{[a.Fields.QUANTITY]:e.getOfferId()?parseInt(e.getOfferQuantity()):parseInt(e.getQuantity())}),s.add(t)}),l.length>0&&s.addAll(m.getNewItemsPatchOperations(l,t)),0===s.getOperations().length?Promise.resolve():e.megaPatch(s).then(g.bind(this,e))},m.removeItem=function(e,t){if(e.isNew()){const i=e.getItems().filter(e=>e.getProductTrigram()!==t.getProductTrigram());return e.setItems(i),g(e),Promise.resolve(e)}{const i=new r,s=new n(n.Operations.REMOVE,"/cart-items/"+t.get("id"));i.add(s);const o={onPassportError(e,t){console.error(e),window.location.href=t.replace("/logout","")+"/login?service="+encodeURIComponent(window.location.href)}};return e.megaPatch(i,o).then(g.bind(this,e))}},m.addOffer=function(t,r,n){const s=t.getItems().filter(e=>e.getOfferId()!==r.getId());return r.getSoftwareOfferDetails().forEach((c,l)=>{const d=h.findInArray(t.getItems(),e=>e.getOfferId()===r.getId()&&e.getProductTrigram()===c.productTrigram);if(e.is(d)){const e=d.getQuantity()+parseInt(n);d.setQuantity(e),s.push(d)}else{const e={[a.Fields.TITLE]:r.getProductDisplayName(),[a.Fields.EXTERNAL_OFFER_ID]:r.get("externalOfferId"),[a.Fields.OFFER_ID]:r.getId(),[a.Fields.LICENSING]:r.get("licensing"),[a.Fields.LICENSING_SCHEME]:r.getLicensingScheme(),[a.Fields.PRODUCT_DISPLAY_NAME]:c.productDisplayName,[a.Fields.PRODUCT_TRIGRAM]:c.productTrigram,[a.Fields.PRODUCT_NUMBER]:c.productNumber,[a.Fields.ACTION]:t.getActionType()||o.ActionTypes.START,[a.Fields.UNIT_NET_AMOUNT]:0===l?r.getPricelistPrice():0,[a.Fields.TOTAL_NET_AMOUNT]:0===l?r.getPricelistPrice()*parseInt(n):0,[a.Fields.DISPLAY_PRICE]:!1,[a.Fields.TYPE]:t.get(o.Fields.TYPE)||o.Types.SOFTWARE_REQUEST,[a.Fields.OFFER_QUANTITY]:parseInt(n),[a.Fields.QUANTITY]:parseInt(c.quantity)*parseInt(n),[a.Fields.TEMP_UUID]:h.generateUUID()};s.push(new a(e,{dataProxy:i.getInstance(),parse:!0}))}}),t.setItems(s),g(t),Promise.resolve(t)},m.removeItems=function(e,t){if(e.isNew()){const i=e.getItems();for(let e=i.length-1;e>=0;--e){const r=i[e];t.indexOf(r)>-1&&i.splice(e,1)}return e.setItems(i),g(e),Promise.resolve(e)}return m.removeItem(e,t[0])},m.getConflictingItems=function(e,t){const i=l.isEduOffer(t),r=l.isMakerOffer(t);let n,s=[];const o=e.getItems(),a=o.filter(e=>e.isEduItem()!==i),c=o.filter(e=>e.isMakerItem()!==r);if(a.length>0)n=r?C.MAKERS_NON_MAKERS:C.EDU_NON_EDU,s=a;else if(c.length>0)n=i?C.EDU_NON_EDU:C.MAKERS_NON_MAKERS,s=c;else if(i){const e=t.getId();(s=o.filter(t=>t.getOfferId()===e)).length>0&&(n=C.EDU_IN_CART)}return{conflictingItems:s,conflictType:n}},m.loadCartItemPortfolios=async function({cart:e,country:t,portfolioFactory:i}){const r=e.getItems(),n=[],s=[];for(let e=0;e<r.length;++e){const t=r[e],i=t.getOfferId();if(i)s.find(e=>e.getOfferId()===i)||s.push(t);else{!!n.find(e=>e.getProductTrigram()===t.getProductTrigram()&&e.getLicensingScheme()===t.getLicensingScheme())||n.push(t)}}let o,a;try{[o,a]=await Promise.all([await Promise.all(n.map(async e=>{const r=i.createPackCollection(d.Types.BY_TRIGRAM_V2);return r.productTrigram=l.addProductSuffix(e.getProductTrigram()),await r.fetchPromise({country:t}),r.first().getOffers().find(t=>t.getLicensingScheme()===e.getLicensingScheme())})),await Promise.all(s.map(e=>{return i.createModel(d.Types.SOFTWARE_OFFER,{id:e.getOfferId()}).fetchPromise({country:t})}))])}catch(e){console.error(e),o=[],a=[]}return i.createCollection(d.Types.PORTFOLIO,[...o,...a])},m.getNewItemsPatchOperations=function(e,t){const i=[];return e.filter(e=>{const t=e.getOfferId();return(!t||i.indexOf(t)<0)&&(i.push(t),!0)}).map(e=>{let i;const r=e.getOfferId(),s=e.getSkuId();i=r?t.find(e=>e.get("id")===r):t.find(e=>e.getSkuId()===s);const c={},l=n.Operations.ADD;return c[a.Fields.OFFER_ID]=r,c[a.Fields.SKU_ID]=s,c[a.Fields.LICENSING]=i.getLicensing(),c[a.Fields.LICENSING_SCHEME]=i.getLicensingScheme(),c[a.Fields.PRODUCT_DISPLAY_NAME]=i.getProductDisplayName(),c[a.Fields.PRODUCT_TRIGRAM]=i.getProductTrigram(),c[a.Fields.PRODUCT_NUMBER]=i.getProductNumber(),c[a.Fields.ACTION]=o.ActionTypes.START,c[a.Fields.UNIT_NET_AMOUNT]=i.getPricelistPrice().toString(),c[a.Fields.TYPE]=o.Types.SOFTWARE_REQUEST,c[a.Fields.QUANTITY]=parseInt(r?e.getOfferQuantity():e.getQuantity(),10),c[a.Fields.TEMP_UUID]=h.generateUUID(),new n(l,"/cart-items",c)})},m.hasMakerItemsExceededLimit=function(e,t={quantity:0}){if(e.hasMakerItems()){const i=[];return e.getItems().filter(e=>{if(e.isMakerItem()){const t=e.getOfferId();return!i.includes(t)&&(i.push(t),!0)}return!1}).reduce((e,t)=>e+parseInt(t.getQuantity()),0)+t.quantity>5}return!1},m.saveCartAndItems=function(e,t,i){const n=new r,o=m.getNewItemsPatchOperations(e.getItems(),t);n.addAll(o);const a=t.at(0).getCurrency()||t.at(0).getPricelistCurrency();return e.setCurrency(a),e.savePromise(void 0,i).then(()=>{const t=new s(e.dataProxy.connector);return e.dataProxy=t.getDataProxy(s.Types.CART),e.id=e.get("id"),e.megaPatch(n)}).then(g.bind(this,e))},m.calculateTotalPrice=function(e,t){const i=[];return e.reduce((e,r)=>{const n=r.getOfferId();if(n){if(!i.includes(n)){const s=t.find(e=>e.get("id")===n);e+=r.getOfferQuantity()*s.getPricelistPrice(),i.push(n)}}else{const i=t.find(e=>e.getSkuId()===r.getSkuId());e+=r.getQuantity()*i.getPricelistPrice()}return e},0)},m.checkCartMaxChargeCompliance=async function({cart:e,portfolios:t,psp:i,service:r,country:n,redirectUrlParam:s}){const o=t.at(0);await i.fetchPromise({service:r,country:n,licensorId:o.getLicensorId(),currency:o.getPricelistCurrency()||o.getCurrency(),onPassportError(e,t){console.error(e);const i=window.location.pathname.includes("welcome/cart")?window.location.origin+"/welcome/compass-world/3dexperience-collaborative-innovation/3dswymer/buy/cart"+window.location.search:window.location.href,r=new URL(i);s&&r.searchParams.append(s.key,s.value),window.location.href=t.replace("/logout","")+"/login?service="+encodeURIComponent(r.toString())+"&theme=clicknbuy"}});const a=i.get(c.Fields.MAX_CHARGE_AMOUNT),l=this.calculateTotalPrice(e.getItems(),t);if(a&&l>parseFloat(a))throw new p("Maximum charge exceeded",{errorCode:"MaxChargeExceeded"})},m.ConflictTypes=C,m.Events=f,m}),define("DS/MPFClickAndBuyComponent/checkout/BillingInfoSection",["UWA/Core","DS/UIKIT/Alert","DS/UIKIT/Input/Toggle","DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","DS/MPFTracker/Category","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartModelHelper","DS/MPFCompanyModel/CompanyFactory","DS/MPFCompanyModel/CompanyModel","DS/MPFCountryModel/CountryCollection","DS/MPFOrderComponent/OrderConfirmationSection","DS/MPFCompanyComponent/CompanyNameInput","DS/MPFCompanyComponent/CompanyTaxRegistrationIdInput","DS/MPFView/FieldTextInputV2","DS/MPFView/FieldSelectInputV2","DS/MPFView/FieldToggleInput","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],function(e,t,i,r,n,s,o,a,c,l,d,h,u,p,m,C,f,g,y){"use strict";const P=Object.freeze({VALID_SECTION:"validSection",INVALID_SECTION:"invalidSection"}),I=Object.freeze({FORM_ERROR:"FormError"}),S=u.extend({className:"mpf-section mpf-horizontal mpf-bill-info",setup:function(e){e||(e={}),this._checkPrototypes(e),this._parent(e),this.service=e.service,this.cart=e.cart,this.companyFactory=e.companyFactory,this.company=e.company,this.countries=e.countries,this.companyNameInput=this._createCompanyNameInput(),this.countrySelectInput=this._createCountrySelectInput(),this.taxRegistrationIdInput=this._createTaxRegistrationIdInput(),this.noTaxIdCheckbox=this._createNoTaxIdCheckbox(),this.taxIdCheckboxContainer=this._createTaxIdCheckboxContainer(),this.specialEconomicZoneCheckbox=this._createSpecialEconomidZoneCheckbox(),this.listenTo(this.countrySelectInput,f.Events.UPDATE,this._onCountryChange.bind(this)),this.listenTo(this.taxRegistrationIdInput,C.Events.UPDATE,this._checkVatId.bind(this))},render:function(){return this.body=[this.companyNameInput.render(),this.countrySelectInput.render(),this.taxRegistrationIdInput.render(),this.taxIdCheckboxContainer,this.specialEconomicZoneCheckbox.render()],this.taxIdCheckboxContainer.hide(),this._onCountryChange({resetTaxId:!1}),this._parent(),this},validate:function(){const e=this.companyNameInput.validate(),t=this.countrySelectInput.validate();return e.isValid&&t.isValid},isNoVatIdChecked:function(){return this.noTaxIdCheckbox.isChecked()},_checkVatId:function(){const e=this,t={},i=this.company.getCountry(),r=this.taxRegistrationIdInput.getTaxRegistrationId();if(this.taxRegistrationIdInput._removeErrorMessage(),""!==r.trim()){t[d.Fields.NAME]="VAT IT test",t[d.Fields.COUNTRY]=i,t[d.Fields.VAT_ID]=r;const n=this.companyFactory.createModel(l.Types.CHECK_VAT,t);return n.savePromise(t).then(function(){!0===n.get("valid")?(e.company.setTaxRegistrationId(r),e.dispatchEvent(P.VALID_SECTION)):(e.taxRegistrationIdInput._displayErrorMessage({isValid:!1,errors:[{field:d.Fields.TAX_REGISTRATION_ID,message:n.get("message")||y.get("taxRegIdInvalid")}]}),e._sendTrackingEvent(I.FORM_ERROR,"Error label"),e.dispatchEvent(P.INVALID_SECTION))}).catch(function(){e._displayAlert(y.get("taxRegIdBackendValidation")),e.dispatchEvent(P.INVALID_SECTION)})}"USA"===i||"CAN"===i||"JPN"===i||"CHE"===i?this.dispatchEvent(P.VALID_SECTION):this.dispatchEvent(P.INVALID_SECTION)},_onCountryChange:function(t){const i=this.countrySelectInput.getValue();this.noTaxIdCheckbox.uncheck(),e.is(t)&&!1!==t.resetTaxId&&(this.taxRegistrationIdInput.resetValue({silent:!0}),this.taxRegistrationIdInput._removeErrorMessage()),this.taxRegistrationIdInput.setDisabled(""===i),this.company.unset(d.Fields.SPECIAL_ECONOMIC_ZONE,{silent:!0}),this.specialEconomicZoneCheckbox.hide(),"DZA"===i?(this.taxRegistrationIdInput.setFieldLabel(y.get("nifNumber")),this.taxRegistrationIdInput.setRequired(!0),this.taxRegistrationIdInput.show(),this.taxIdCheckboxContainer.hide()):"MAR"===i?(this.taxRegistrationIdInput.setFieldLabel(y.get("iceNumber")),this.taxRegistrationIdInput.setRequired(!0),this.taxRegistrationIdInput.show(),this.taxIdCheckboxContainer.hide()):"CHE"===i||"JPN"===i?(this.taxRegistrationIdInput.setRequired(!1),this.taxRegistrationIdInput.hide(),this.taxIdCheckboxContainer.hide()):this.countries.isEuropeanCountry(i)?(this.taxRegistrationIdInput.setFieldLabel(y.get("vatRegistrationId")),this.taxRegistrationIdInput.setRequired(!1),this.taxRegistrationIdInput.show(),this.noTaxIdCheckbox.setValue(y.get("noVatIdNoUk")),this.taxIdCheckboxContainer.show()):"USA"===i?(this.taxRegistrationIdInput.setFieldLabel(y.get("employerIdentificationNumber")),this.taxRegistrationIdInput.setRequired(!1),this.taxRegistrationIdInput.show(),this.taxIdCheckboxContainer.hide()):"CAN"===i?(this.taxRegistrationIdInput.setFieldLabel(y.get("businessNumber")),this.taxRegistrationIdInput.setRequired(!1),this.taxRegistrationIdInput.show(),this.taxIdCheckboxContainer.hide()):"AUS"===i?(this.taxRegistrationIdInput.setFieldLabel(y.get("businessNumber")),this.taxRegistrationIdInput.setRequired(!1),this.taxRegistrationIdInput.show(),this.noTaxIdCheckbox.setValue(y.get("noBusinessNumber")),this.taxIdCheckboxContainer.show()):"IND"===i?(this.taxRegistrationIdInput.setFieldLabel(y.get("gstNumber")),this.taxRegistrationIdInput.setRequired(!1),this.taxRegistrationIdInput.show(),this.noTaxIdCheckbox.setValue(y.get("noGstNumber")),this.taxIdCheckboxContainer.show(),this.specialEconomicZoneCheckbox.show()):(this.taxRegistrationIdInput.setFieldLabel(),this.taxRegistrationIdInput.setRequired(!0),this.taxRegistrationIdInput.show(),this.taxIdCheckboxContainer.hide()),this.taxRegistrationIdInput.render(),""!==i&&this._checkVatId()},_displayAlert(e){new t({className:"error",messageClassName:"error",messages:e,closable:!0,visible:!0,closeOnClick:!0}).inject(this.container,"top")},_createTaxIdCheckboxContainer(){return e.createElement("div",{class:"mpf-tax-id",html:this.noTaxIdCheckbox})},_onChangeValueCheckbox(){const e=this.noTaxIdCheckbox.isChecked(),t=e?P.VALID_SECTION:P.INVALID_SECTION;this.taxRegistrationIdInput.resetValue({silent:!0}),this.taxRegistrationIdInput.setDisabled(e),this.company.set(d.Fields.TAX_REGISTRATION_ID,null),this.dispatchEvent(t)},_createNoTaxIdCheckbox(){return new i({className:"primary",type:"checkbox",value:y.get("noVatIdNoUk"),events:{onChange:this._onChangeValueCheckbox.bind(this)}})},_createTaxRegistrationIdInput(){return new m({model:this.company,readOnly:!0,required:!0,dynamicValidation:!1})},_createCountrySelectInput(){const t=this.company.getCountry();return new f({model:this.company,required:!0,dynamicValidation:!0,silent:!1,fieldName:d.Fields.COUNTRY,fieldLabel:y.get("country"),readOnly:e.is(t)&&""!==t,placeholder:y.get("selectCountry"),selectableOptions:this._getCountriesOptions()})},_getCountriesOptions(){const e=this;return this.countries.map(function(t){return{value:t.getIso3(),label:t.getName(),selected:t.getIso3()===e.company.getCountry()}})},_createCompanyNameInput(){return new p({model:this.company,dynamicValidation:!0,readOnly:!this.company.isNew(),required:!0})},_createSpecialEconomidZoneCheckbox(){const e=new g({model:this.company,fieldName:d.Fields.SPECIAL_ECONOMIC_ZONE,fieldLabel:y.get("specialEconomicZone"),dynamicValidation:!0,useStringValue:!0});return e.container.addClassName("mpf-special-economic-zone"),e},_checkPrototypes(e){o.requiredOfPrototype(e.cart,a,"options.cart must be a CartModel"),o.requiredOfPrototype(e.companyFactory,l,"options.companyFactory must be a CompanyFactory"),o.requiredOfPrototype(e.company,d,"options.company must be a CompanyModel"),o.requiredOfPrototype(e.countries,h,"options.countries must be a CountryCollection")},_sendTrackingEvent(e,t){const i=r.createEventBuilder({category:s.CHECKOUT,action:e}).setLabel(t);c.addTrackerInformation(i,this.cart),i.addDimension(n.MARKETPLACE_SERVICE,this.service).addDimension(n.BUYER_TYPE,"company").send()},destroy(){this.cart=null,this.countries=null,this.company=null,this.companyFactory=null,this._parent(),this.container=null}});return S.Events=P,S}),define("DS/MPFClickAndBuyComponent/orderList/EmptyCartComponent",["UWA/Class/View","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService"],function(e,t,i){"use strict";const r=Object.freeze({ADD_ITEMS:"addItems"}),n=e.extend({className:"mpf-empty-cart-component",setup(){this.addItemsButton=this._createAddItemsButton()},render({I18n:e}){return this.container.setContent([{tag:"div",class:"mpf-icon fonticon fonticon-shopping-cart"},{tag:"div",class:"mpf-message",text:e.get("yourCartIsEmpty")},this.addItemsButton.setValue(e.get("addItems"))]),this},destroy(){this._parent(),this.container=null},_createAddItemsButton(){return new t({className:"primary",events:{onClick:this.dispatchEvent.bind(this,r.ADD_ITEMS)}})}});return n.Events=r,n}),define("DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine",["UWA/Class","UWA/Class/Events","DS/MPFUrl/UrlUtils","DS/MPFUtils/StorageUtils","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFServices/MarketplaceServices"],function(e,t,i,r,n,s){"use strict";const o=Object.freeze({BUY:"buy",OFFER:"offer",OFFERS:"offers",CART:"cart",PLATFORM_SELECTION:"platform-selection",CHECKOUT:"checkout",PAYMENT_RESULT:"payment-result"}),a=Object.freeze({OFFER:"offer",CART:"cart",PLATFORM_SELECTION:"platformSelection",CHECKOUT:"checkout",PAYMENT_RESULT:"paymentResult"}),c=Object.freeze({GO_TO_PAYMENT:"goToPayment",BUNDLE:"bundle",ORDER_STATUS:"orderStatus",ORDER_ID:"orderId",COUNTRY:"country",LICENCING_SCHEME:"licencingScheme",TENANT:"tenant"}),l=new Map;l.set(a.OFFER,o.OFFER),l.set(a.CART,o.CART),l.set(a.PLATFORM_SELECTION,o.PLATFORM_SELECTION),l.set(a.CHECKOUT,o.CHECKOUT),l.set(a.PAYMENT_RESULT,o.PAYMENT_RESULT);const d=new Map;d.set(o.BUY,a.OFFER),d.set(o.OFFER,a.OFFER),d.set(o.CART,a.CART),d.set(o.PLATFORM_SELECTION,a.PLATFORM_SELECTION),d.set(o.CHECKOUT,a.CHECKOUT),d.set(o.PAYMENT_RESULT,a.PAYMENT_RESULT);const h=new Map;h.set("AT","de"),h.set("AU","en"),h.set("BE","fr"),h.set("CA","en"),h.set("CH","fr"),h.set("CZ","cs"),h.set("CS","cs"),h.set("DE","de"),h.set("DK","en"),h.set("DZ","fr"),h.set("ES","es"),h.set("FI","en"),h.set("FR","fr"),h.set("GB","en"),h.set("IN","en"),h.set("IE","en"),h.set("IT","it"),h.set("JP","ja"),h.set("LU","fr"),h.set("MA","fr"),h.set("NL","en"),h.set("NO","en"),h.set("PL","pl"),h.set("PT","en"),h.set("SE","en"),h.set("US","en");const u=new Map;u.set("cs","CZ"),u.set("cz","CZ"),u.set("de","DE"),u.set("en","US"),u.set("es","ES"),u.set("fr","FR"),u.set("it","IT"),u.set("ja","JP"),u.set("pl","PL"),u.set("pt","PT"),u.set("zh","CH");const p=Object.freeze({PAGE_CHANGE_REQUESTED:"onPageChangeRequested"}),m=e.extend(t,{init({page:e,service:t,cookieKey:i,me:r,countries:n,doChangeUrls:s}){this.page=e,this.service=t,this._cookieKey=i,this.doChangeUrls="boolean"==typeof s?s:this.isUrlDedicatedPage()||this.isCurrentUrlACompassUrl(),this._setInitialCountry({me:r,countries:n,service:t}),this.updateUrl(e)},getPage(){return this.page},isOfferView(){return this.page===a.OFFER},isCartView(){return this.page===a.CART},isPlatformSelectionView(){return this.page===a.PLATFORM_SELECTION},isCheckoutView(){return this.page===a.CHECKOUT},isPaymentRedirectResult(){return this.page===a.PAYMENT_RESULT},isCurrentUrlACompassUrl(){const e=window.location.pathname;return e.contains("/compass-world")&&e.contains("/buy")},isUrlDedicatedPage:()=>window.location.pathname.contains("/cnb"),changePage(e,t){this.page!==e&&(this.page=e,this.updateUrl(e),this.dispatchEvent(p.PAGE_CHANGE_REQUESTED,t))},clearUrl(){const e=new URL(window.location.href),t=e.pathname.split("/").pop();if(this.isUrlDedicatedPage())e.pathname="";else if(Object.values(o).includes(t)){const i=e.pathname.replace(new RegExp("/"+t+"$"),"");e.pathname=i}this._deleteSearchParams(e,[c.BUNDLE,c.ORDER_STATUS,c.ORDER_ID,c.TENANT]);const i=e.toString();try{window.history.pushState(null,null,i)}catch(e){console.warn(e)}},convertPageToUrlPath:e=>l.get(e),updateUrl(e){let t;if(this.doChangeUrls){const i=new URL(window.location.href).pathname.split("/").pop(),r=this.convertPageToUrlPath(e);i!==r&&(t=this.generateNewUrl(e,i,r))}else{const e=new URL(window.location.href);this._deleteSearchParams(e,[c.BUNDLE,c.ORDER_STATUS,c.ORDER_ID]),t=e.toString()}if(t)try{window.history.pushState(null,null,t)}catch(e){console.warn(e)}},generateNewUrl(e,t,i){const r=new URL(window.location.href);let n;return t=t||r.pathname.split("/").pop(),i=i||this.convertPageToUrlPath(e),n=Object.values(a).map(e=>l.get(e)).includes(t)?r.pathname.replace(new RegExp(t+"$"),i):r.pathname.endsWith("/")?r.pathname+i:r.pathname+"/"+i,r.pathname=n,this._deleteSearchParams(r,[c.BUNDLE,c.ORDER_STATUS,c.ORDER_ID]),r.toString()},_initSearchParamsObj(){const e=new URL(window.location.href);return new URLSearchParams(e.search)},_setSearchParam(e,t){const i=this._initSearchParamsObj();return i.set(e,t),i.toString()},_deleteSearchParams(e,t){t.forEach(t=>{e.searchParams.delete(t)})},getBundleParam(){return this._initSearchParamsObj().get(c.BUNDLE)},setBundleParam(e){const t=new URL(window.location.href);t.searchParams.append(c.BUNDLE,e);const i=t.toString();window.history.pushState(null,null,i)},clearSearchParams(e){const t=new URL(window.location.href);let i=!1;e.forEach(e=>{t.searchParams.has(e)&&(t.searchParams.delete(e),i=!0)}),i&&window.history.pushState(null,null,t.toString())},getLocale(){return this.getLanguage()},doesLanguageChangeForCountry(e){return h.get(e)!==h.get(this.getCountry())},getCountry(){return this.getCountryFromLocalStorage()},setCountry(e,{setLanguage:t=!0}={}){this.setCountryInLocalStorage(e);const i=h.get(e);i&&t&&(this.setLanguageCookie(i),window.dsLang=i);const r=new URL(window.location.href),n=/(\/welcome\/)[a-z]{2}(\/compass-world)/;if(r.pathname.search(n)>-1){const e=r.pathname.replace(n,`$1${i}$2`),t=`${r.origin}${e}${r.search}`;window.history.pushState(null,null,t)}},getLanguage(){const e=this.getLanguageFromCookie();if(e)return e;{const e=this.getCountryFromLocalStorage();if(e)return h.get(e)}},getCountryFromLocalStorage(){return r.getStoredCountry(this.service)},setCountryInLocalStorage(e){r.storeCountry(this.service,e)},getCountryFromUrl:()=>new URL(window.location.href).searchParams.get("country"),getLanguageFromCookie(){return r.getCookie(this._cookieKey)},setLanguageCookie(e){r.setCookie(this._cookieKey,e)},_setInitialCountry({me:e,countries:t,service:i}){const r=this.getCountryFromUrl(),n=this.getCountry(),o=this.getLanguageFromCookie(),a=e&&e.hasCountry()&&t.some(t=>t.getIso2()===e.getCountry())&&e.getCountry();let c,l;i===s.SUBSCRIPTIONS?(c=a||"US",l=!1):i===s.INNOVATE?(c=n||"USA",l=!1):r?(c=r,l=!0):n?o?(c=n,l=!1):(c=n,l=!0):o?a?(c=a,l=!1):(c=u.get(o),l=!1):a?(c=a,l=!0):c="US",this.setCountry(c,{setLanguage:l})}});return m._getOfferName=function(e){const t=e.getPath().split("/"),i=t.indexOf(o.OFFERS);if(i>-1&&i<t.length)return t[i+1]},m._getPageFromUrl=function(){const e=window.location.pathname.split("/").pop();return d.get(e)},m.getInitialState=function(e){let t;const r=new i(window.location.href),s=Array.isArray(e)?n.findTrigramInArray(e):e,o=this._getOfferName(r),c=r.getValueParameter("licencingScheme"),l=r.getValueParameter("cartId")||r.getValueParameter("orderId"),d=this._getPageFromUrl();return d===a.PAYMENT_RESULT&&l?t=a.PAYMENT_RESULT:d===a.CHECKOUT?t=a.CHECKOUT:d===a.PLATFORM_SELECTION?t=a.PLATFORM_SELECTION:l||d===a.CART||(o||s)&&c?t=a.CART:(d===a.OFFER||o||s)&&(t=a.OFFER),{page:t,offerTrigram:s,offerName:o,cartId:l,licencingScheme:c}},m.Events=p,m.Pages=a,m.PageToUrlMap=l,m.UrlToPageMap=d,m.Urls=o,m.UrlParams=c,m}),define("DS/MPFClickAndBuyComponent/SubscriptionInformationComponent",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFPortfolioModel/PortfolioModel","DS/MPFPortfolioModel/PortfolioPackModel","DS/MPFPortfolioModel/PortfolioHelper"],function(e,t,i,r,n,s){"use strict";return t.extend({className:"mpf-subscription-information",setup(){},render({portfolioPack:e,I18n:t}){i.requiredOfPrototype(e,n,"options.portfolioPack must be a PortfolioPackModel");const r=e.getOffers().first(),s=[{tag:"div",class:"mpf-title",text:t.get("subscriptionInformation")},{tag:"div",class:"mpf-subsection-container",html:[this._renderOfferDetailsSection({portfolio:r,I18n:t}),this._renderWhoIsEligibleSection({portfolio:r,I18n:t}),this._renderGettingStartedSection({portfolio:r,I18n:t}),this._renderSubscrpitionAndRenewalsSection({portfolio:r,I18n:t}),this._renderNeedMoreInfoSection({I18n:t})]}];return this.container.setContent(s),this},_renderOfferDetailsSection({portfolio:e,I18n:t}){return this._renderSubSectionIfPortfolioContains({portfolio:e,attribute:r.Fields.OFFER_DETAILS,title:t.get("offerDetails")})},_renderWhoIsEligibleSection({portfolio:e,I18n:t}){return this._renderSubSectionIfPortfolioContains({portfolio:e,attribute:r.Fields.WHO_IS_ELIGIBLE,title:t.get("whoIsEligible")})},_renderGettingStartedSection({portfolio:e,I18n:t}){let i;if(e.has(r.Fields.GETTING_STARTED))i=this._renderSubSection(t.get("gettingStarted"),e.get(r.Fields.GETTING_STARTED));else{const e=[];for(let i=1;i<=3;i++)e.push({tag:"li",text:t.get("gettingStarted_part"+i)});i=this._renderSubSection(t.get("gettingStarted"),[{tag:"div",class:"mpf-intro",text:t.get("gettingStarted_intro")},{tag:"ul",html:e}])}return i},_renderSubscrpitionAndRenewalsSection({portfolio:e,I18n:t}){let i;return i=e.has(r.Fields.RENEWAL)?this._renderSubSection(t.get("subscriptionsAndRenewals"),e.get(r.Fields.RENEWAL)):this._renderSubSection(t.get("subscriptionsAndRenewals"),s.isRenewableOffer(e)?t.get("subscriptionsAndRenewals_text_renewable"):t.get("subscriptionsAndRenewals_text_non_renewable"))},_renderNeedMoreInfoSection({I18n:e}){return this._renderSubSection(e.get("needMoreInfo"),e.get("needMoreInfo_text",{faq:this._createLink(e.get("faq"),"https://www.3ds.com/support/3dexperience-platform-on-cloud-support/support-for-online-purchase")}))},_createLink:(t,i)=>e.createElement("a",{text:t,href:i,target:"_blank"}).outerHTML,_renderSubSectionIfPortfolioContains({portfolio:e,attribute:t,title:i}){const r=e.get(t);if(r)return this._renderSubSection(i,r)},_renderSubSection:(e,t)=>({tag:"div",class:"mpf-sub-section",html:[{tag:"div",class:"mpf-sub-section-title",text:e},{tag:"div",class:"mpf-sub-section-content",html:t}]}),destroy(){this._parent(),this.container=null}})}),define("DS/MPFClickAndBuyComponent/ErrorPage",["UWA/Class/View","DS/MPFAmdLazyLoader/AmdLazyLoader"],function(e,t){"use strict";const i=Object.freeze({OFFER_NOT_FOUND:"offerNotFound",RENEWAL_EXPIRED:"error.renewallinkexpired",UNAVAILABLE_IN_COUNTRY:"unavailableInCountry",DEFAULT:"default"}),r=e.extend({className:"mpf-error-page",setup({error:e}={}){this.error=e||i.DEFAULT},async load(){[this.I18n]=await t.getInstance().get(["i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent"])},setError(e){this.error=e},render({I18n:e,error:t}={}){return e&&(this.I18n=e),t&&(this.error=t),this.container.setContent([{tag:"div",class:"mpf-icon fonticon fonticon-"+this._getIconClassName(this.error)},{tag:"div",class:"mpf-error-message",html:this._getMessage()}]),this},destroy(){this._parent(),this.container=null},_getIconClassName(e){let t;switch(e){case i.OFFER_NOT_FOUND:t="help";break;case i.UNAVAILABLE_IN_COUNTRY:t="globe-location";break;default:t="attention"}return t},_getMessage(){let e;switch(this.error){case i.OFFER_NOT_FOUND:e=this.I18n.get("offerNotFoundMessage");break;case i.RENEWAL_EXPIRED:e=this.I18n.get("errorRenewalExpired",{link:'<a href="https://www.3ds.com/store" target="_blank">https://www.3ds.com/store</a>'});break;case i.UNAVAILABLE_IN_COUNTRY:e=this.I18n.get("unavailableInCountryMessage");break;default:e=this.I18n.get("defaultErrorMessage")}return e}});return r.Errors=i,r}),define("DS/MPFClickAndBuyComponent/offerList/OfferDescriptionComponent",["UWA/Class/View","UWA/Core","DS/MPFServices/ObjectService","DS/MPFPortfolioModel/PortfolioPackModel","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,r)=>{"use strict";return e.extend({className:"mpf-description-offer",setup(){},render({portfolioPack:e}){const t=this._getDesription({portfolioPack:e});return t&&this.container.setContent({tag:"div",class:"mpf-product-info",html:t}),this},_getDesription({portfolioPack:e}){let t;if(e.isBundle()){const i=e.getOffers().find(e=>e.getDescription()&&""!==e.getDescription());t=i&&i.getDescription()}else t=e.getCompassRoleInfo().tagLine;return t},destroy(){this._parent(),this.container=null}})}),define("DS/MPFClickAndBuyComponent/PreReqTableLineComponent",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Number","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,r)=>{"use strict";return e.extend({tagName:"tr",className:"mpf-item-order",setup(e={}){this._parent(e),this.locale=e.locale||"en-US",this.preReq=e.preReq,this.initialQuantity=e.initialQuantity,this.isQuantityInputDisabled=!0===e.isQuantityInputDisabled,this.preReq.quantity=this.initialQuantity,this.productNameCell=this._createProductNameCell(),this.monthlyPriceCell=this._createMonthlyPriceCell(),this.quantityInput=this._createQuantityInput(),this.quantityCell=this._createQuantityCell(),this.totalPriceCell=this._createTotalPriceCell()},render(){return this.container.setContent([this.productNameCell,this.monthlyPriceCell,this.quantityCell,this.totalPriceCell]),this},_createProductNameCell(){return t.createElement("td",{class:"mpf-product-name",text:this.preReq.productDisplayName})},_createMonthlyPriceCell(){const e=parseFloat(this.preReq.pricelist[0].monthlyDisplay).toLocaleString(this.locale,{style:"currency",currency:this.preReq.pricelist[0].currency});return t.createElement("td",{class:"mpf-order-price",text:r.get("unitPricePerUserPerMonth",{price:e})})},_createQuantityInput(){return new i({value:this.initialQuantity,min:1,max:99999,step:1,decimalPrecision:1,disabled:this.isQuantityInputDisabled,events:{onChange:this._onQuantityChanged.bind(this)}})},_createQuantityCell(){return t.createElement("td",{class:"mpf-order-quantity",html:this.quantityInput})},_createTotalPriceCell(){let e=parseFloat(this.preReq.pricelist[0].monthlyDisplay);const i=(e=this.initialQuantity*e).toLocaleString(this.locale,{style:"currency",currency:this.preReq.pricelist[0].currency});return t.createElement("td",{class:"mpf-price",text:r.get("unitPricePerMonth",{price:i})})},_onQuantityChanged(){if(t.is(this.quantityInput)&&t.is(this.totalPriceCell)){const e=parseInt(this.quantityInput.getValue());if(Number.isNaN(e))this.quantityInput.setValue(this.initialQuantity);else{this.preReq.quantity=e;let t=parseFloat(this.preReq.pricelist[0].monthlyDisplay);const i=(t*=e).toLocaleString(this.locale,{style:"currency",currency:this.preReq.pricelist[0].currency});this.totalPriceCell.setText(r.get("unitPricePerMonth",{price:i})),this.render()}}}})}),define("DS/MPFClickAndBuyComponent/orderList/GettingStarted",["UWA/Class/View","UWA/Core","i18n!DS/MPFClickAndBuyComponent/assets/nls/SubscriptionInformation","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i)=>{"use strict";return e.extend({className:"mpf-getting-started",setup(e={}){},render({isRenewal:e}){let t;return t=e?[this._getRenewalTitle(),this._getRenewalMessage()]:[this._getTitle(),this._getIntro(),this._getTextContent()],this.container.setContent(t),this},_getRenewalTitle:()=>t.createElement("div",{text:i.get("renewalGettingStartedTitle")}),_getRenewalMessage:()=>t.createElement("div",{class:"mpf-getting-started-textcontent",text:i.get("renewalGettingStartedMessage")}),_getTitle:()=>t.createElement("div",{text:i.get("gettingStarted")}),_getIntro:()=>t.createElement("div",{class:"mpf-getting-started-intro",text:i.get("gettingStarted_intro")}),_getTextContent:()=>t.createElement("div",{class:"mpf-getting-started-textcontent",html:[{text:"- "+i.get("gettingStarted_part1")},{text:"- "+i.get("gettingStarted_part2")},{text:"- "+i.get("gettingStarted_part3")}]}),destroy(){this._parent(),this.container=null}})}),define("DS/MPFClickAndBuyComponent/platformSelection/TenantSelectionModal",["UWA/Class/View","UWA/Core","DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/MPFView/ManuallyClosedModal","DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","DS/MPFServices/MarketplaceServices","DS/MPFServices/ObjectService","DS/MPFFiniteStateMachine/FiniteStateMachine","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartModelHelper"],(e,t,i,r,n,s,o,a,c,l,d,h,u)=>{"use strict";const p=Object.freeze({ON_HIDE:"onHide",CONTINUE:"continue",ON_ERROR:"onError"}),m=Object.freeze({ADMIN:"admin",MEMBER:"member",ADMIN_AND_MEMBER:"adminAndMember"}),C=Object.freeze({SELECT_TENANT:"SelectTenant",TENANT_SELECTED:"TenantSelected",CANCEL_TENANT_SELECTION:"CancelTenantSelection"}),f=e.extend({className:"mpf-tenant-modal",setup(){this.alert=this._createAlert()},render({cart:e,platforms:t,I18n:i}){l.requiredOfPrototype(e,h,"options.cart must be a CartModel"),l.requiredOfType(t,"array","options.platforms must be an array of TenantModels"),this.cart=e,this.platforms=t;const r=t.some(e=>e.isMember()),n=t.some(e=>e.isAdmin());return this.container.setContent([this.alert,this._createHeader({isMember:r,isAdmin:n,I18n:i}),this._createBody({isMember:r,isAdmin:n,I18n:i}),this._createFooter({I18n:i})]),this._sendTrackingPage(),this},_createAlert:()=>new i({visible:!1,autoHide:!1,hideDelay:6e3}),_createHeader({isMember:e,isAdmin:t,I18n:i}){let r;return t?r=i.get("orderDeploymentOptions"):e&&(r=i.get("orderDeployment")),{tag:"div",class:"mpf-tenant-selection-header",html:[{tag:"h4",text:r},{tag:"span",class:"fonticon fonticon-close",events:{click:()=>{this._sendTrackingEvent(C.CANCEL_TENANT_SELECTION),this.dispatchEvent(p.ON_HIDE)}}}]}},_createBody({isAdmin:e,isMember:t,platforms:i,I18n:r}){let n;return e&&t?n=this._getAdminAndMemberContent({platforms:i,I18n:r}):e?n=this._getAdminContent({platforms:i,I18n:r}):t&&(n=this._getMemberContent({platforms:i,I18n:r})),{tag:"div",class:"mpf-tenant-selection-body",html:n}},_getAdminAndMemberContent({I18n:e}){const i=t.createElement("ul",{html:this.platforms.filter(e=>e.isMember()).map(e=>t.createElement("li",{text:e.id}))});return this.platformSelection=this._createPlatformSelection({I18n:e}),[t.createElement("p",{text:e.get("adminMsgPlatform")}),this.platformSelection,t.createElement("p",{text:e.get("youAreAlsoMemberOfThesePlatforms")+":"}),i,t.createElement("p",{text:e.get("memberMsgPlatform")})]},_getMemberContent({I18n:e}){const i=t.createElement("ul",{html:this.platforms.filter(e=>e.isMember()).map(e=>t.createElement("li",{text:e.id}))});return[t.createElement("p",{text:e.get("deployOnNewPlatform")}),t.createElement("p",{text:e.get("youAreMemberOfThesePlatforms")+":"}),i,t.createElement("p",{text:e.get("deployOnExistingPlatform")})]},_getAdminContent({I18n:e}){return this.platformSelection=this._createPlatformSelection({I18n:e}),[t.createElement("p",{text:e.get("selectPlatform")}),this.platformSelection]},_createPlatformSelection({I18n:e}){const t=this.platforms.filter(e=>e.isAdmin()).map(t=>({value:t.id,label:e.get("deployOnThisPlatformOption",{platform:t.id})}));return this.cart.isBeDev()||t.push({value:"new",label:e.get("deployOnNewPlatformOption")}),new n({placeholder:e.get("selectPlatformLabel"),options:t,events:{onChange:()=>{this._sendTrackingEvent(C.SELECT_TENANT)}}})},_createFooter({I18n:e}){return{tag:"div",class:"mpf-tenant-selection-footer",html:[new r({className:"primary",value:e.get("continue"),events:{onClick:this._onContinue.bind(this,{cart:this.cart,I18n:e})}})]}},_onContinue({I18n:e}){const i=t.is(this.platformSelection)?this.platformSelection.getValue()[0]:"new",r=this._validatePreReq({cart:this.cart,selectedPlatform:i,I18n:e});r.isValid?(this._sendTrackingEvent(C.TENANT_SELECTED,i),this.dispatchEvent(p.CONTINUE,{selectedPlatform:i})):(this.alert.add({className:"error",message:r.errorMsg}).show(),this.dispatchEvent(p.ON_ERROR))},_validatePreReq({selectedPlatform:e,I18n:i}){const r={};if("new"===e){const e=this.cart.getItems().find(e=>"IFW-OC"===e.getProductTrigram()),n=t.is(e);r.isValid=n,r.errorMsg=i.get("businessInnovatorMissing")}else r.isValid=""!==e,r.errorMsg=i.get("selectPlatformError");return r},_createStateMachine(){return new d({state:this._getInitialState(),states:[m.ADMIN,m.MEMBER,m.ADMIN_AND_MEMBER],transitions:[]})},destroy(){this.cart=null,this.platforms=null,this._parent(),this.container=null},_sendTrackingPage(){const e=o.createPageBuilder({url:"/cart/tenantconfiguration"}).setTitle("Tenant Configuration");u.addTrackerInformation(e,this.cart),this._addTrackerDimensions(e),e.send()},_sendTrackingEvent(e,t){const i=o.createEventBuilder({category:"Cart",action:e}).setLabel(t);u.addTrackerInformation(i,this.cart),this._addTrackerDimensions(i),i.send()},_addTrackerDimensions(e){const t=this.platforms.map(e=>e.getShortDescription()).join(",");e.addDimension(a.MARKETPLACE_SERVICE,c.CLICK_AND_BUY).addDimension(a.BUYER_TYPE,"company").addDimension(a.PLATFORMS,t)}});return f.Events=p,f}),define("DS/MPFClickAndBuyComponent/checkout/BillingInfoPage",["UWA/Class/View","UWA/Core","UWA/Promise","UWA/Utils","DS/MPFServices/MarketplaceServices","DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","DS/MPFTracker/Category","DS/MPFError/ValidationError","DS/MPFServices/ObjectService","DS/MPFCompanyModel/CompanyFactory","DS/MPFCompanyModel/CompanyModel","DS/MPFCountryModel/CountryCollection","DS/MPFAddressModel/AddressModel","DS/MPFModalConfiguratorComponent/BillingAddressHelper","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartModelHelper","DS/MPFClickAndBuyComponent/checkout/BillingInfoSection","DS/MPFModalConfiguratorComponent/BillingAddressFormSectionV2","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],function(e,t,i,r,n,s,o,a,c,l,d,h,u,p,m,C,f,g,y,P){"use strict";const I=Object.freeze({VALID:"valid",INVALID:"invalid"}),S=Object.freeze({FORM_ERROR:"FormError",NEXT:"Next"}),M=e.extend({className:"mpf-billing-info-page mpf-click-and-buy",setup:function(e={}){l.requiredOfPrototype(e.billingAddressHelper,m,"options.billingAddressHelper must be a BillingAddressHelper"),l.requiredOfPrototype(e.companyFactory,d,"options.companyFactory must be a CompanyFactory"),l.requiredOfPrototype(e.company,h,"options.company must be a CompanyModel"),l.requiredOfPrototype(e.countries,u,"options.countries must be a CountryCollection"),l.requiredOfPrototype(e.cart,C,"options.cart must be a CartModel"),this.billingAddressHelper=e.billingAddressHelper,this.service=e.service,this.me=e.me,this.company=e.company,this.cart=e.cart,this.countries=e.countries,this.personAddresses=e.personAddresses,this.companyAddresses=e.companyAddresses,this.companyFactory=e.companyFactory,this.addressFactory=e.addressFactory,this._parent(e),this.billingInfoSection=this._createBillingInfoSection(),this.billingAddressSection=this._createBillingAddressSection()},render:function(){return this.container.setContent([this._displayInfoMsgForJapaneseUsers(),this.billingInfoSection.render(),this.billingAddressSection.render()]),this._sendTrackingPage(),this},getBillingAddressModel:function(){return this.billingAddressSection.getBillingAddressModel()},validate:function(){const e=this.billingInfoSection.validate(),t=this.billingAddressSection.validate();return e&&t},save:function(){if(this.validate()){this._sendTrackingEvent(S.NEXT);const e=this._prepareBillingAddressBeforeSave(),t=this._prepareCompanyBeforeSave(e);return(this.service===n.CLICK_AND_BUY?t.savePromise(null,{}):t.savePromise({[h.Fields.NO_VAT_ID]:this.billingInfoSection.isNoVatIdChecked(),[h.Fields.TAX_REGISTRATION_ID]:t.getTaxRegistrationId()},{patch:!0})).then(()=>{if(this.service!==n.CLICK_AND_BUY)return this.billingAddressHelper.patchBillingAddress(e)}).catch(e=>{let t="";if(e&&e.options&&e.options.request&&e.options.request.xhr&&400===e.options.request.xhr.status)try{t=JSON.parse(e.options.request.xhr.responseText)}catch(e){console.warn(e)}else t=new Error(P.get("unableToSaveCompany"));return i.reject(t)})}return this._sendTrackingEvent(S.FORM_ERROR,"Error label"),i.reject(new c(P.get("errorFieldsInfo")))},_prepareCompanyBeforeSave(e){const t=this.company;return t.set("address",e.omit()),t.set(h.Fields.NO_VAT_ID,this.billingInfoSection.isNoVatIdChecked()?"TRUE":"FALSE"),u.isIndia(t.getCountry())&&(t.unset(h.Fields.TAX_REGISTRATION_ID,{silent:!0}),t.unset(h.Fields.SPECIAL_ECONOMIC_ZONE,{silent:!0})),t},_prepareBillingAddressBeforeSave(){const e=this.getBillingAddressModel();return u.isIndia(e.getCountry())&&(e.set(p.Fields.GST_ID,this.company.getTaxRegistrationId()),e.set(p.Fields.SPECIAL_ECONOMIC_ZONE,this.company.get(h.Fields.SPECIAL_ECONOMIC_ZONE))),e},_displayInfoMsgForJapaneseUsers:function(){const e=r.Client.Locale.lang,i=this._getCurrentLanguageFromCookie();if("ja"===e||t.is(i)&&"ja"===i.value)return t.createElement("div",{class:"alert-message alert-warning alert-has-icon",html:[t.createElement("span",{class:"icon fonticon"}),t.createElement("span",{text:"請求情報は全て英語でご記入ください。"})]})},_getCurrentLanguageFromCookie:function(){return document.cookie.split(/\s*;\s*/).map(function(e){const t=e.split("=");return{key:t.length>=1?t[0]:null,value:t.length>=2?t[1]:null}}).find(function(e){return e.key===encodeURIComponent("swymlang")})},_createBillingAddressSection:function(){return new y({title:P.get("billingAddress"),billingAddressHelper:this.billingAddressHelper,me:this.me,company:this.company,countries:this.countries,personAddresses:this.personAddresses,companyAddresses:this.companyAddresses,addressFactory:this.addressFactory})},_createBillingInfoSection:function(){const e=new g({service:this.service,title:P.get("billingInformation"),cart:this.cart,companyFactory:this.companyFactory,company:this.company,countries:this.countries});return this.listenTo(e,g.Events.VALID_SECTION,this.dispatchEvent.bind(this,I.VALID)),this.listenTo(e,g.Events.INVALID_SECTION,this.dispatchEvent.bind(this,I.INVALID)),e},_sendTrackingPage:function(){const e=s.createPageBuilder({url:"/checkout/AddressCreation/PreCreation"}).setTitle("Address Information");f.addTrackerInformation(e,this.cart),e.addDimension(o.MARKETPLACE_SERVICE,this.service).addDimension(o.BUYER_TYPE,"company").send()},_sendTrackingEvent:function(e,t){const i=s.createEventBuilder({category:a.CHECKOUT,action:e}).setLabel(t);f.addTrackerInformation(i,this.cart),i.addDimension(o.MARKETPLACE_SERVICE,this.service).addDimension(o.BUYER_TYPE,"company").send()}});return M.Events=Object.freeze(I),M}),define("DS/MPFClickAndBuyComponent/offerList/AvailableCountriesComponent",["UWA/Class/View","DS/UIKIT/Input/Select","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService","DS/MPFCountryModel/CountryCollection","DS/MPFClickAndBuyComponent/ClickAndBuyTracker","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,r,n,s)=>{"use strict";const o=Object.freeze({ON_CHANGE_COUNTRY:"onChangeCountry"}),a=Object.freeze({NEED_HELP:"NeedHelp",COUNTRY_CHANGED:"CountryChanged"}),c=e.extend({className:"mpf-offer-list-available-countries",setup(e={}){r.requiredOfPrototype(e.countries,n,"options.countries must be a CountryCollection"),this.countries=e.countries,this.stateMachine=e.stateMachine,this.isEduOffer=!0===e.isEduOffer,this.isMakerOffer=!0===e.isMakerOffer,this.useIso3=!0===e.useIso3,this.tracker=e.tracker},render({I18n:e}){return this.selectedCountry=this.stateMachine.getCountry(),this.container.setContent([this._createSelect({I18n:e}),{tag:"div",class:"mpf-help",html:new i({className:"link",value:e.get("needHelp"),events:{onClick:async()=>{const e=this.stateMachine.getPage(),t=e.charAt(0).toUpperCase()+e.slice(1);this.tracker.sendEvent({action:a.NEED_HELP,category:t}),window.open("https://www.3ds.com/support/3dexperience-platform-on-cloud-support/support-for-online-purchase/","_blank")}}})}]),this},getSelectedCountry(){return this.select.getValue()[0]},_createSelect({I18n:e}){return new t({placeholder:!1,options:this._getOptions({I18n:e}),events:{onChange:e=>{if(e&&e.target&&e.target.value!==this.selectedCountry){this.selectedCountry=e.target.value;const t=this.stateMachine.doesLanguageChangeForCountry(this.selectedCountry);this.stateMachine.setCountry(this.selectedCountry);const i=this.stateMachine.getPage(),r=i.charAt(0).toUpperCase()+i.slice(1);this.tracker.sendEvent({action:a.COUNTRY_CHANGED,category:r,label:this.selectedCountry}),this.dispatchEvent(o.ON_CHANGE_COUNTRY,{country:this.selectedCountry,requiresLanguageChange:t})}}}})},_getOptions({I18n:e}){return this.countries.map(t=>{const i=this.useIso3?t.getIso3():t.getIso2();return{value:i,label:e.get(t.getIso2()),selected:i===this.selectedCountry}}).sort((e,t)=>e.label<t.label?-1:e.label>t.label?1:0)},destroy(){this.stopListening(),this.countries=null,this._parent(),this.container=null}});return c.Events=o,c}),define("DS/MPFClickAndBuyComponent/orderList/TotalPriceTile",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFPortfolioModel/PortfolioCollection","DS/MPFPortfolioModel/LicensingHelper","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper"],function(e,t,i,r,n,s,o){"use strict";const a=Object.freeze({}),c=e.extend({className:"mpf-total-price-tile",setup(){},render({cart:e,portfolios:r,locale:s,I18n:o}){return t.requiredOfPrototype(e,i,"options.cart must be a CartModel"),t.requiredOfPrototype(r,n,"options.portfolios must be a PortfolioCollection"),this.container.setContent([{tag:"div",text:o.get("totalSubs")},{tag:"div",class:"mpf-total-subsection",html:[{tag:"div",class:"mpf-price",text:this._getPrice({cart:e,portfolios:r,locale:s,I18n:o})},{tag:"div",text:o.get("exclTax")}]}]),this},destroy(){this._parent(),this.container=null},_getPrice({cart:e,portfolios:t,locale:i,I18n:n}){const a=e.getItems(),c=t.at(0);let l;if(e.isRenewal()){const t=e.getItemsLicenseScheme()||r.RevTypes.YSC,s=e.getNetAmountTotal(),o=e.getCurrency(),a=s.toLocaleString(i,{style:"currency",currency:o,minimumFractionDigits:s%1==0?0:2,maximumFractionDigits:s%1==0?0:2});switch(t){case r.RevTypes.YSC:l=n.get("yearlyPrice",{price:a});break;case r.RevTypes.MSC:l=n.get("monthlyPrice",{price:a});break;case r.RevTypes.QSC:case r.RevTypes.QRC:l=n.get("quarterlyPrice",{price:a});break;default:l=a}}else if(c){const d=a.some(s.isCredit),h=c.getLicensingScheme()||r.RevTypes.YSC,u=o.calculateTotalPrice(e.getItems(),t),p=c.getCurrency()||c.getPricelistCurrency(),m=u.toLocaleString(i,{style:"currency",currency:p,minimumFractionDigits:u%1==0?0:2,maximumFractionDigits:u%1==0?0:2});l=d?m:h===r.RevTypes.YSC?n.get("yearlyPrice",{price:m}):h===r.RevTypes.MSC?n.get("monthlyPrice",{price:m}):n.get("quarterlyPrice",{price:m})}else l=0;return l}});return c.Events=a,c}),define("DS/MPFClickAndBuyComponent/orderList/ProductCard",["UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Input/Number","DS/UIKIT/Badge","DS/MPFServices/MarketplaceServices","DS/MPFServices/ObjectService","DS/MPFPortfolioModel/LicensingHelper","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFPortfolioModel/PortfolioModel","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFClickAndBuyComponent/orderList/BundleProductList"],function(e,t,i,r,n,s,o,a,c,l,d,h){"use strict";const u=Object.freeze({QUANTITY_CHANGED:"quantityChanged",REMOVE_ITEM:"removeItem",SHOW_MARKETING_MODAL:"showMarketingModal",SHOW_SUBSCRIPTION_INFO:"showSubscriptionInfo"}),p=Object.freeze({ITEM_REMOVED:"ItemRemoved",QUANTITY_CHANGED:"QuantityChanged"}),m=e.extend({className:"mpf-product-card",setup({cart:e,cartItems:t,portfolio:i,tracker:r,locale:n,service:o,I18n:c,SubI18n:d}={}){s.requiredOfPrototype(e,a,"options.cart must be a CartModel"),s.requiredOfPrototype(i,l,"options.portfolio must be a PortfolioModel"),this.cart=e,this.cartItems=t,this.portfolio=i,this.locale=n,this.tracker=r,this.service=o,this.I18n=c,this.SubI18n=d,this.numberInput=this._createQuantityInput(),this.bundleProductList=this.portfolio.isBundleOffer()&&this._createBundleProductList()},render(){return this.portfolio?this.container.setContent([{tag:"div",class:"mpf-header",html:[{tag:"div",class:"mpf-name-container",html:[{tag:"div",class:"mpf-name",html:this._getNameContent()},{tag:"div",class:"mpf-product-id",text:this.portfolio.isBundleOffer()?this.portfolio.getExternalOfferId():this.portfolio.getProductNumber()}]},this._createPricingStructureCell(),this.numberInput,this._getUnitPriceCell(),this._getTotalPriceCell()]},this.portfolio.isBundleOffer()&&this.bundleProductList.render(),{tag:"div",class:"mpf-footer",html:[this._getSubscriptionInfoLink(),this._getDeleteButton()]}]):this.container.setContent([{tag:"div",class:"mpf-header",text:this.I18n.get("Product not available in the selected country.")},{tag:"div",class:"mpf-footer",html:[this._getDeleteButton()]}]),this},destroy(){this.stopListening(),this.bundleProductList&&this.bundleProductList.destroy(),this.numberInput=null,this.bundleProductList=null,this.cart=null,this.cartItems=null,this.portfolio=null,this.tracker=null,this._parent(),this.container=null},_getNameContent(){const e=[{tag:"span",text:this.portfolio.getProductDisplayName()||this.portfolio.getProductName()}];return this.portfolio.isBundleOffer()||e.push({tag:"span",class:"fonticon fonticon-info",events:{click:this.dispatchEvent.bind(this,u.SHOW_MARKETING_MODAL,this.portfolio.omit())}}),e},_createPricingStructureCell(){let e,t=this.portfolio.getLicensingScheme();switch(t===c.RevTypes.QRC&&(t=c.RevTypes.QSC),t){case c.RevTypes.YSC:e=this.I18n.get("yearly");break;case c.RevTypes.QSC:e=this.I18n.get("quarterly");break;case c.RevTypes.MSC:e=this.I18n.get("monthly");break;case c.RevTypes.NAM:e=this.I18n.get("nam")}return{tag:"div",class:"mpf-pricing-structure",html:[{tag:"span",text:e},{tag:"span",text:` (${t})`}]}},_createQuantityInput(){const e=this.cartItems[0],t=o.isCredit(this.portfolio.getLicensing())?2500:1,r=d.isMakerOffer(this.portfolio)?5:99999,n=!!e.getOfferId();let s=parseInt(n?e.getOfferQuantity():e.getQuantity());return s>r?(s=r,this._changeItemQuantities(s)):s<t&&(s=t,this._changeItemQuantities(s)),new i({className:"mpf-quantity",value:""+s,min:t,max:r,step:1,decimalPrecision:1,disabled:d.isEduOffer(this.portfolio)||d.isOfferExpired(this.portfolio)||this.cart.isRenewal(),events:{onChange:this._onQuantityChange.bind(this)}})},_getUnitPriceCell(){let e;if(this.cart.isRenewal()){const t=this.cartItems.reduce((e,t)=>e+t.getUnitNetAmount(),0),i=this.cart.getItemsLicenseScheme();e=this._getPriceCell({price:t,scheme:i,className:"mpf-unit-price"})}else if(d.isOfferExpired(this.portfolio))e=this._renderExpiredMessage();else{const t=this.portfolio.getPricelistPrice(),i=this.portfolio.getLicensingScheme();e=this._getPriceCell({price:t,scheme:i,className:"mpf-unit-price"})}return e},_getTotalPriceCell(){let e;if(this.cart.isRenewal()){const t=this.cartItems.reduce((e,t)=>e+t.getTotalNetAmount(),0),i=this.cart.getItemsLicenseScheme();e=this._getPriceCell({price:t,scheme:i,className:"mpf-total-price"})}else if(d.isOfferExpired(this.portfolio))e={tag:"div",class:"mpf-expired-message-cell",text:"-"};else{const t=this.cartItems[0],i=t.getOfferId()?t.getOfferQuantity():t.getQuantity(),r=this.portfolio.getPricelistPrice()*i,n=this.portfolio.getLicensingScheme();e=this._getPriceCell({price:r,scheme:n,className:"mpf-total-price"})}return e},_getPriceCell({price:e,scheme:t,className:i}){let r;const n=this.cart.isRenewal()?this.cart.getCurrency():this.portfolio.getCurrency()||this.portfolio.getPricelistCurrency(),s=e.toLocaleString(this.locale,{style:"currency",currency:n,minimumFractionDigits:e%1==0?0:2,maximumFractionDigits:e%1==0?0:2});switch(t){case c.RevTypes.YSC:r=this.I18n.get("yearlyPrice",{price:s});break;case c.RevTypes.QSC:case c.RevTypes.QRC:r=this.I18n.get("quarterlyPrice",{price:s});break;case c.RevTypes.MSC:r=this.I18n.get("monthlyPrice",{price:s})}return{tag:"div",class:i,text:r}},_createBundleProductList(){const e=new h({portfolio:this.portfolio,I18n:this.I18n});return this.listenTo(e,h.Events.SHOW_MARKETING_MODAL,this.dispatchEvent.bind(this,u.SHOW_MARKETING_MODAL)),e},_getSubscriptionInfoLink(){return{tag:"div",class:"mpf-subscription-info-link",html:[{tag:"span",class:"fonticon fonticon-help"},{tag:"a",text:this.SubI18n.get("subscriptionInformation"),events:{click:this.dispatchEvent.bind(this,u.SHOW_SUBSCRIPTION_INFO,{portfolio:this.portfolio})}}]}},_getDeleteButton(){let e;return e=this.cart.isRenewal()?document.createElement("div",{class:"mpf-empty"}):new t({className:"error",icon:"trash",events:{onClick:()=>{this.tracker&&this.tracker.sendEvent({cart:this.cart,action:p.ITEM_REMOVED}),this.dispatchEvent(u.REMOVE_ITEM)}}})},_renderExpiredMessage(){return{tag:"div",class:"mpf-expired-message-cell",html:new r({content:this.I18n.get("offerExpired"),className:"warning",icon:"attention"})}},_changeItemQuantities(e){this.cartItems.forEach(t=>{t.getOfferId()?t.set(c.Fields.OFFER_QUANTITY,e):t.setQuantity(e)})},_onQuantityChange(e){const t=parseInt(e.target.value),i=!!this.cartItems[0].getOfferId(),r=parseInt(i?this.cartItems[0].getOfferQuantity():this.cartItems[0].getQuantity());if(t&&"number"==typeof t&&t!==r&&"Nan"!==r){this._changeItemQuantities(t);const e=t-r>0?"added":"removed";this.tracker&&this.tracker.sendEvent({cart:this.cart,action:p.QUANTITY_CHANGED,label:e,value:parseInt(t)}),this.dispatchEvent(u.QUANTITY_CHANGED)}else isNaN(t)&&this.numberInput.setValue(1)}});return m.Events=u,m}),define("DS/MPFClickAndBuyComponent/orderList/MarketingModal",["UWA/Core","UWA/Class/View","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/MPFCompassPlatformServices/CompassPlatformServices","DS/MPFServices/ObjectService","DS/MPFCartModel/CartItemModel","DS/MPFClickAndBuyComponent/MarketingPortfolioPage"],function(e,t,i,r,n,s,o,a){"use strict";const c=Object.freeze({}),l=t.extend({className:"mpf-marketing-modal",setup(){this.modal=this._createModal()},render({I18n:e}){return this.I18n=e,this.container.setContent(this.modal),this},show({item:e}){e instanceof o&&(e=e.omit()),this.modal.setHeader({tag:"h4",text:e.productDisplayName}),this.modal.setBody(""),this.modal.show(),r.mask(this.modal.getBody());try{n.getPortolioRole(e.productTrigram.split("-")[0],e=>{r.unmask(this.modal.getBody());const t=new a({portfolioInfo:e});this.modal.setBody(t.render())})}catch(e){r.unmask(this.modal.getBody()),console.error(e),this.modal.setBody(this.I18n.get("unableToLoadProductDetails"))}},hide(){this.modal.hide()},destroy(){this.modal.destroy(),this.modal=null,this.I18n=null,this._parent(),this.container=null},_createModal:()=>new i({className:"mpf-marketing-offer"})});return l.Events=c,l}),define("DS/MPFClickAndBuyComponent/offerList/IconRoleSection",["UWA/Class/View","UWA/Core","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/WebappsUtils/WebappsUtils","DS/MPFServices/ObjectService","DS/MPFPortfolioModel/PortfolioPackModel","DS/MPFClickAndBuyComponent/MarketingPortfolioPage","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,r,n,s,o,a)=>{"use strict";return e.extend({className:"mpf-icon-role-section",setup(){},render({portfolioPack:e,I18n:t}){let i;return s.requiredOfPrototype(e,o,"options.portfolioPack must be a PortfolioPackModel"),i=e.isBundle()?[{tag:"div",class:"mpf-section-title",text:t.get("includedRoles").toUpperCase()},{tag:"div",class:"mpf-icon-list",html:Object.values(this._createIcons({portfolioPack:e}))}]:[],this.container.setContent(i),this},_displayMarketingModal(e,i){const n=t.is(document.body.getElement(".mpf-click-and-buy"))?document.body.getElement(".mpf-click-and-buy"):document.body,s=this._createMarketingModal(i);s.inject(n,"top"),s.show(),r.mask(s.getBody());const o=new a({portfolioInfo:e});r.unmask(s.getBody()),s.setBody(o.render())},_createMarketingModal(e){const r=new i({className:"mpf-marketing-offer",header:t.createElement("h4",{text:e}),events:{onHide:()=>{r.destroy()}}});return r},_createIconRoleContainer:e=>t.createElement("img",{src:n.getWebappsAssetUrl("i3DXCompass","v3.1/images/role")+"/"+e+"_Role.png"}),_createIcons({portfolioPack:e}){return e.getOffers().first().getSoftwareOfferDetails().map(i=>{const r=i.productTrigram,n=r.lastIndexOf("-"),s=e.getCompassRoleInfo(r.slice(0,n)),o=i.productDisplayName;return t.is(s)?t.createElement("div",{class:"mpf-role-icon",events:{click:this._displayMarketingModal.bind(this,s,o)},html:[this._createIconRoleContainer(s.brand.toUpperCase()),t.createElement("div",{text:o,class:"mpf-role-title"}),t.createElement("div",{class:"mpf-overlay",html:t.createElement("div",{class:"fonticon fonticon-2x fonticon-play"})})]}):""})},destroy(){this._parent(),this.container=null}})}),define("DS/MPFClickAndBuyComponent/checkout/ThankYouForPurchasePanel",["UWA/Core","UWA/Class/View","DS/PlatformAPI/PlatformAPI","DS/MPFUrl/UrlUtils","DS/MPFUtils/StorageUtils","DS/MPFServices/MarketplaceServices","DS/MPFCartModel/CartModel","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper","DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine","DS/MPFTracker/Tracker","DS/MPFTracker/Category","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],function(e,t,i,r,n,s,o,a,c,l,d,h){"use strict";const u=Object.freeze({PAYMENT_COMPLETED:"paymentCompleted",GO_TO_CART:"goToCart"}),p=Object.freeze({SUCCESS:"success",FAILURE:"failure",CANCELLED:"cancelled"});function m(e){let t;const i=new r(window.location.href),n=[o.States.PAYMENT_COMPLETE,o.States.PAYMENT_ACCEPTED,o.States.DELIVERED].includes(e.getState()),s=e.getPaymentStatus()===o.States.PAYMENT_ACCEPTED,a=i.getValueParameter("orderStatus");return t=a===p.SUCCESS||n||s?p.SUCCESS:a===p.CANCELLED?p.CANCELLED:p.FAILURE}const C=t.extend({className:"mpf-cab-thank-you-for-purchase-panel",setup({cart:e,me:t,service:i,stateMachine:r}={}){this.cart=e,this.me=t,this.service=i,this.stateMachine=r,this.isClickAndBuy=this.service===s.CLICK_AND_BUY,this.isEduOrMaker=this.cart.hasEduItems()||this.cart.hasMakerItems(),this.iframe=this._createIframe()||""},render(){const e=this.getOrderStatus();return this.container.setContent([[this._renderMessage(e)]]),this},_createIframe(){if(this.isClickAndBuy&&r.isProduction())return e.createElement("iframe",{src:this.isEduOrMaker?"https://assets.3ds.com/store/tracking-store-individual.html":"https://assets.3ds.com/store/confirmation.html",class:"iframe-thanks-purchasing"})},_renderMessage(e){let t;return e===p.SUCCESS?(t=this._renderPaymentCompleteMessage(),n.clearCart(this.service),this.stateMachine&&this.stateMachine.clearUrl(),l.createEventBuilder({category:d.CHECKOUT,action:"ThankYouForYourPurchase"}).setLabel("Success").send(),i.publish(a.Events.MpfCartUpdated,{nbItems:0})):t=e===p.CANCELLED?this._renderPaymentCancelledMessage():this._renderPaymentFailureMessage(),t},_renderPaymentCompleteMessage(){return[{tag:"div",class:"mpf-timeline-container "+(this.isClickAndBuy&&this.isEduOrMaker?"mpf-grid-2":"mpf-grid-3"),html:this.isClickAndBuy&&this.isEduOrMaker?[this._renderTimelineStatus({numberChar:"1",text:h.get("orderConfirmed"),isActive:!0,isBold:!0}),this._renderTimelineStatus({numberChar:"2",text:h.get("getStarted"),isActive:!1,isBold:!1})]:[this._renderTimelineStatus({numberChar:"1",text:h.get("orderConfirmed"),isActive:!0,isBold:!0}),this._renderTimelineStatus({numberChar:"2",text:h.get("subscriptionReady"),isActive:!1,isBold:!1}),this._renderTimelineStatus({numberChar:"3",text:h.get("dedicatedLearningSupport"),isActive:!1,isBold:!1})]},{tag:"div",class:"mpf-title-container",html:[{tag:"span",class:"fonticon fonticon-check"},{tag:"span",class:"mpf-title",html:h.get("thankYouforPurchase",{thankYou:e.createElement("span",{class:"mpf-bold",text:h.get("thankYou")}).outerHTML})}]},{tag:"div",class:"mpf-welcome",html:[{tag:"p",html:h.get("welcome",{firstName:e.createElement("span",{text:this.me?this.me.getFirstName():""}).outerHTML,lastName:e.createElement("span",{text:this.me?this.me.getLastName():""}).outerHTML})}]},{tag:"ol",class:"mpf-ol-status",html:[{tag:"li",text:h.get("emailOrderConfirmation")},{tag:"li",html:h.get("emailGetStarted",{bold3D:e.createElement("b",{text:"3D"}).outerHTML})},this.isClickAndBuy&&this.isEduOrMaker?"":{tag:"li",html:h.get("accessDedicated",{bold3D:e.createElement("b",{text:"3D"}).outerHTML})},this.iframe]},{tag:"div",class:"mpf-learn-more",html:this.isClickAndBuy&&this.isEduOrMaker?"":[{tag:"h5",text:h.get("learnMoreTitle")},{tag:"p",html:h.get("learnMore",{linkLearnMore:e.createElement("a",{target:"_blank",href:"https://www.3ds.com/store/get-started?utm_content=3ds&utm_term=companygspage&utm_source=ordconfpage",text:"click here to learn the essentials"}).outerHTML,bold3D:e.createElement("b",{text:"3D"}).outerHTML})}]},{tag:"div",class:"mpf-spam-folder-hint",text:h.get("spamFolderHint")},{tag:"div",class:"mpf-any-question",html:this.isClickAndBuy&&this.isEduOrMaker?[{tag:"p",html:h.get("anyQuestion",{linkFAQ:e.createElement("a",{target:"_blank",href:"https://www.3ds.com/store/faq",text:"FAQ"}).outerHTML,linkHere:e.createElement("a",{target:"_blank",href:"https://www.3ds.com/online-store/support-form/",text:"here"}).outerHTML})}]:""}]},_renderPaymentCancelledMessage:()=>[{tag:"div",class:"mpf-error-title-container",html:[{tag:"span",class:"fonticon fonticon-info"},{tag:"span",class:"mpf-title",html:h.get("paymentCancelled")}]},{tag:"div",class:"mpf-error-message-container",html:[{tag:"div",text:h.get("paymentCancelledMessage")}]}],_renderTimelineStatus:({numberChar:e,text:t,isActive:i,isBold:r})=>({tag:"div",class:"mpf-status",html:[{tag:"div",class:i?"mpf-circle mpf-active":"mpf-circle",text:e},{tag:"p",class:r?"mpf-bold":"mpf-paragraph",text:t}]}),_goToCart(){this.stateMachine?this.stateMachine.changePage(c.Pages.CART):this.dispatchEvent(u.GO_TO_CART)},_renderPaymentFailureMessage(){return[{tag:"div",class:"mpf-error-title-container",html:[{tag:"span",class:"fonticon fonticon-error"},{tag:"span",class:"mpf-title",html:h.get("anIssueOccured")}]},{tag:"div",class:"mpf-error-message-container",html:[{tag:"div",text:h.get("couldNotConfirmOrder")},{tag:"div",class:"mpf-check-payment-details",html:[{tag:"span",text:h.get("checkPaymentDetailsPart1")},{tag:"a",text:h.get("tryAgain"),events:{click:this._goToCart.bind(this)}},{tag:"span",text:h.get("checkPaymentDetailsPart2")}]},{tag:"div",html:h.get("stillFacingIssues",{linkForm:e.createElement("a",{target:"_blank",href:"https://www.3ds.com/online-store/support-form/",text:"online sales support form"}).outerHTML})},{tag:"div",text:h.get("sorryForInconvenience")}]}]},getOrderStatus(){return m(this.cart)},destroy(){this.cart=null,this.me=null,this.stateMachine=null,this._parent(),this.container=null}});return C.getOrderStatus=m,C.OrderStatus=p,C.Events=u,C}),define("DS/MPFClickAndBuyComponent/ClearCartModal",["UWA/Class/View","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper"],(e,t,i,r,n,s,o)=>{"use strict";const a=Object.freeze({ON_CANCEL:"onCancel",ON_ITEMS_DELETED:"onItemsDeleted",ON_HIDE:"onHide"}),c=e.extend({className:"mpf-clear-cart-modal",setup(){this.submitButton=this._createSubmitButton(),this.cancelButton=this._createCancelButton(),this.alert=this._createAlert(),this.modal=this._createModal(this.submitButton,this.cancelButton)},render(){return this.container.setContent(this.modal),this},show({cart:e,conflictingItems:t,conflictType:i,portfolio:r,addedQuantity:a,I18n:c}){let l,d,h,u;if(n.requiredOfPrototype(e,s,"options.cart must be a CartModel"),n.requiredOfType(t,"array","Expected array of conflicting items as argument"),n.requiredOfType(i,"string","options.conflictType must be a string"),this.cart=e,this.conflictingItems=t,i===o.ConflictTypes.EDU_NON_EDU){const e=this._isItemAcOffer(this.conflictingItems[0]);h=c.get(e?"educational":"nonEducational"),u=c.get(e?"nonEducational":"educational"),l=c.get("eduCartConflictMessage",{existingType:h,newType:u}),d=c.get("eduConflictButtonLabel",{existingType:h})}else if(i===o.ConflictTypes.EDU_IN_CART)l=c.get("eduProdAlreadyInCartMsg"),d=c.get("deleteDuplicates");else if(i===o.ConflictTypes.MAKERS_NON_MAKERS){const e=this.conflictingItems[0].isMakerItem();h=c.get(e?"makers":"nonMakers"),u=c.get(e?"nonMakers":"makers"),l=c.get("makersCartConflictMessage",{existingType:h,newType:u}),d=c.get("eduConflictButtonLabel",{existingType:h})}return this.submitButton.removeEvent("onClick"),this.submitButton.addEvent("onClick",this._deleteItems.bind(this,{portfolio:r,addedQuantity:a,I18n:c})),this.submitButton.setValue(d),this.cancelButton.setValue(c.get("cancel")),this.modal.setHeader({tag:"h4",text:c.get("eduCartConflictHeader")}),this.modal.setBody([this.alert,l]),this.modal.show(),this},hide(){return this.modal.hide(),this},destroy(){this.modal.destroy(),this.cart=null,this._parent(),this.container=null},_setLoading(e=!0){this.submitButton.load(e),this.cancelButton.setDisabled(e)},_isItemAcOffer(e){const t=e.getProductTrigram();return t&&t.endsWith("AC")},_deleteItems({portfolio:e,addedQuantity:t,I18n:i}){return this._setLoading(!0),o.removeItems(this.cart,this._getAllItemsFromOffer(this.conflictingItems)).then(()=>{this._setLoading(!1),this.dispatchEvent(a.ON_ITEMS_DELETED,{portfolio:e,quantity:t}),this.hide()}).catch(e=>{this._setLoading(!1),this.alert.add({className:"error",message:i.get("itemDeletionError")}).show()})},_getAllItemsFromOffer(e){const t=[],i=e.map(e=>e.getOfferId());return this.cart.getItems().forEach(e=>{-1!==i.indexOf(e.getOfferId())&&t.push(e)}),t},_createModal(e,i){return new t({footer:[e,i],events:{onHide:this.dispatchEvent.bind(this,a.ON_HIDE)}})},_createAlert:()=>new r({autoHide:!0,visible:!1}),_createSubmitButton:()=>new i({className:"primary"}),_createCancelButton(){return new i({events:{onClick:()=>{this.dispatchEvent(a.ON_CANCEL),this.hide()}}})}});return c.Events=a,c}),define("DS/MPFClickAndBuyComponent/orderList/OrderListBody",["UWA/Class/View","UWA/Core","DS/UIKIT/Mask","DS/MPFUtils/MPFUtils","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFPortfolioModel/PortfolioCollection","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper","DS/MPFClickAndBuyComponent/orderList/ProductCard","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,r,n,s,o,a,c)=>{"use strict";const l=Object.freeze({ORDER_CHANGED:"orderChanged",SHOW_MARKETING_MODAL:"showMarketingModal",SHOW_SUBSCRIPTION_INFO:"showSubscriptionInfo",REMOVE_ITEM_ERROR:"removeItemError"}),d=e.extend({className:"mpf-order-list-body",setup(e={}){this.tracker=e.tracker,this.service=e.service},render({cart:e,portfolios:t,I18n:i,SubI18n:r,locale:n}){return this._clearCards(),this.cards=this._createCards({cart:e,portfolios:t,locale:n,I18n:i,SubI18n:r}),this.container.setContent(this.cards.map(e=>e.render())),this},async _removeItems({cart:e,items:t,offerId:r}){i.mask(this.container);try{r?await a.removeItems(e,t,!0):await a.removeItem(e,t[0]),i.unmask(this.container),this.dispatchEvent(l.ORDER_CHANGED)}catch(e){i.unmask(this.container),console.error(e),this.dispatchEvent(l.REMOVE_ITEM_ERROR)}},_onQuantityChange(){this.dispatchEvent(l.ORDER_CHANGED)},_clearCards(){this.cards&&this.cards.length>0&&(this.cards.forEach(e=>{this.stopListening(e),e.destroy(),e=null}),this.cards=null)},_createCards({cart:e,portfolios:t,locale:i,I18n:r,SubI18n:n}){return this._groupItemsByOfferId({cart:e}).map(s=>{let o;o=s.offerId?t.find(e=>e.get("id")===s.offerId):t.find(e=>e.getSkuId()===s.skuId);const a=new c({cart:e,portfolio:o,locale:i,I18n:r,SubI18n:n,cartItems:s.items,tracker:this.tracker,service:this.service});return this.listenTo(a,c.Events.REMOVE_ITEM,this._removeItems.bind(this,{cart:e,...s})),this.listenTo(a,c.Events.QUANTITY_CHANGED,this._onQuantityChange.bind(this)),this.listenTo(a,c.Events.SHOW_SUBSCRIPTION_INFO,this.dispatchEvent.bind(this,l.SHOW_SUBSCRIPTION_INFO)),this.listenTo(a,c.Events.SHOW_MARKETING_MODAL,this.dispatchEvent.bind(this,l.SHOW_MARKETING_MODAL)),a})},_groupItemsByOfferId({cart:e}){const i=[];return e.getItems().forEach(e=>{const n=e.getOfferId();if(n){const s=r.findInArray(i,e=>e.offerId===n);t.is(s)?s.items.push(e):i.push({offerId:n,items:[e]})}else i.push({skuId:e.getSkuId(),items:[e]})}),i},destroy(){this.stopListening(),this._clearCards(),this.cart=null,this.tracker=null,this._parent(),this.container=null}});return d.Events=l,d}),define("DS/MPFClickAndBuyComponent/checkout/PaymentRedirectResultPage",["UWA/Class/View","DS/UIKIT/Spinner","DS/MPFServices/ObjectService","DS/MPFCartModel/CartFactory","DS/MPFCartModel/CartModel","DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine","DS/MPFClickAndBuyComponent/checkout/ThankYouForPurchasePanel","DS/MPFClickAndBuyComponent/ClicknbuyHeader","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent"],function(e,t,i,r,n,s,o,a,c){"use strict";const l=Object.freeze({PAYMENT_COMPLETED:"paymentCompleted"}),d=Object.freeze({SUCCESS:"success",FAILURE:"failure",CANCELLED:"cancelled"}),h=e.extend({className:"mpf-payment-redirect-result-page",setup({cartFactory:e,service:n,stateMachine:o,me:a}={}){i.requiredOfPrototype(o,s,"options.stateMachine must be a ClickAndBuyStateMachine"),i.requiredOfPrototype(e,r,"options.cartFactory must be a CartFactory"),this.stateMachine=o,this.cartFactory=e,this.service=n,this.me=a,this.spinner=new t,this.pageHeader=this._createPageHeader()},async load({cartId:e}){this.cart=this.cartFactory.createModel(r.Types.CART,{id:e}),await this.cart.fetchPromise({expands:[n.Expands.CART_ITEMS]});const t=o.getOrderStatus(this.cart);if(t===o.OrderStatus.CANCELLED||t===o.OrderStatus.FAILURE)try{await this.cart.savePromise({[n.Fields.STATE]:this.cart.isRenewal()?n.States.SUBMITTED:n.States.DRAFT},{patch:!0})}catch(e){console.error("Cart state reset failure.")}},render(){return this.component=this._createComponent(),this.container.setContent([this.pageHeader.render({title:this._setPageHeadertitle()}),this.component.render()]),this},destroy(){this.stopListening(),this._destroyComponent(),this.cart=null,this.cartFactory=null,this._parent(),this.container=null,this.pageHeader.destroy(),this.pageHeader=null},async _goBackToCart(){this.container.setContent([this.spinner.show()]),await this.cart.savePromise({[n.Fields.STATE]:n.States.DRAFT},{patch:!0}),this.stateMachine.changePage(s.Pages.CART)},_destroyComponent(){this.component&&(this.stopListening(this.component),this.component.destroy())},_createPageHeader(){return new a({stateMachine:this.stateMachine})},_setPageHeadertitle(){switch(this.component.getOrderStatus()){case d.SUCCESS:return c.get("orderConfirmed");case d.FAILURE:return c.get("Order Not Confirmed");case d.CANCELLED:return c.get("orderCancelled")}},_createComponent(){return this._destroyComponent(),new o({cart:this.cart,service:this.service,stateMachine:this.stateMachine,me:this.me})}});return h.Events=l,h}),define("DS/MPFClickAndBuyComponent/offerList/OfferListDataLoader",["DS/MPFAmdLazyLoader/AmdLazyLoader","DS/MPFServices/MarketplaceServices","DS/MPFCartModel/CartFactory","DS/MPFPortfolioModel/PortfolioFactory","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFCartModel/CartModel","DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine","DS/MPFUtils/StorageUtils"],function(e,t,i,r,n,s,o,a){"use strict";return class{constructor({cartFactory:e,portfolioFactory:i,stateMachine:r,service:n=t.CLICK_AND_BUY}){this.cartFactory=e,this.portfolioFactory=i,this.stateMachine=r,this.service=n}async loadData({portfolioPacks:t,portfolioDependencies:c,offerTrigram:l,offerName:d}){const h=this.stateMachine.getCountry();if(t)try{await Promise.all([t.fetchPromise({country:h}),c?c.fetchPromise({country:h}):Promise.resolve()])}catch(e){console.error(e)}else if(d){(t=this.portfolioFactory.createPackCollection(r.Types.BY_NAME)).searchName=d;try{await t.fetchPromise({country:h})}catch(e){console.error(e)}}else if(l){(t=this.portfolioFactory.createPackCollection(r.Types.BY_TRIGRAM_V2)).productTrigram=n.addProductSuffix(l),(c=this.portfolioFactory.createCollection(r.Types.PRODUCT_DEPENDENCIES)).productTrigram=n.addProductSuffix(l);try{await Promise.all([t.fetchPromise({country:h}),c.fetchPromise({country:h})])}catch(e){console.error(e)}}let u;if(t.size()>0){const e=t.first();await Promise.all(t.map(async e=>{await e.fetchRoleInfo()}));const r=e.getOffers().first();u=this.cartFactory.createModel(i.Types.ME),a.hasStoredCart(this.service)?a.loadStoredCart(this.service,u):(u.set(s.Fields.ONLINE_INSTANCE,""),u.set(s.Fields.CURRENCY,r.getPricelistCurrency()),u.set("legalEntityId",r.getCompanyId()),u.set(s.Fields.STATE,s.States.DRAFT),u.set("type",s.Types.SOFTWARE_REQUEST),u.set("licensorId",r.getLicensorId()||e.getLicensorId()),u.set("isSelfOrder",!0)),u.unset("id")}const[p,m,C]=await e.getInstance().get(["i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","i18n!DS/MPFClickAndBuyComponent/assets/nls/SubscriptionInformation","i18n!DS/MPFClickAndBuyComponent/assets/nls/AvailableCountries"]);return this.stateMachine.clearSearchParams([o.UrlParams.COUNTRY]),{I18n:p,SubI18n:m,CountriesI18n:C,cart:u,portfolioPacks:t,portfolioDependencies:c}}}}),define("DS/MPFClickAndBuyComponent/offerList/OfferListSection",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFUtils/MPFUtils","DS/MPFPortfolioModel/PortfolioModel","DS/MPFClickAndBuyComponent/offerList/OfferTile","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper","DS/MPFPortfolioModel/LicensingHelper","DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,r,n,s,o,a,c)=>{"use strict";const l=Object.freeze({ADD_TO_CART:"addToCart"}),d=t.extend({className:"mpf-offer-list-section",setup({stateMachine:e,isOfferSelectedByDefault:t=!1}={}){i.requiredOfPrototype(e,c,"options.stateMachine must be a ClickAndBuyStateMachine"),this.stateMachine=e,this.isOfferSelectedByDefault=t},render({cart:e,portfolioPack:t,I18n:i}){const r=t.getOffers();return this._destroyTiles(),this.tiles=this._createTiles({cart:e,portfolios:r,I18n:i}),this.container.setContent([{tag:"div",class:"mpf-product-tiles",html:this.tiles.map(e=>e.render())}]),this},_renderTileContainer(){return e.createElement("div",{class:"mpf-product-tiles",html:this.tiles.map(e=>e.render())})},_onSelectedTile(e){return this.tiles.forEach(t=>{t===e?!t.isDisabled()&&t.isSelected()?t.deselect():t.select():t.deselect()})},_destroyTiles(){this.tiles&&this.tiles.forEach(e=>{this.stopListening(e),e.destroy()}),this.tiles=null},_createTiles({cart:e,portfolios:t,I18n:i}){const c=e.getItems(),d=r.findInArray(c,e=>!a.isCredit(e.getLicensing())),h=d&&d.getLicensingScheme(),u=h&&t.getPortfolioWithLicensingScheme(h);return t.sortBy(e=>-n.NumberMonths[e.getLicensingScheme()]).map(r=>{let n,a;o.getConflictingItems(e,r).conflictingItems.length>0||!h?(n=!1,a=t.isShortestLiscensingScheme(r.getLicensingScheme())):r.isCreditOffer()?(n=!1,a=u?h===r.getLicensingScheme():t.isShortestLiscensingScheme(r.getLicensingScheme())):(n=h!==r.getLicensingScheme(),a=h===r.getLicensingScheme());const c=new s({portfolio:r,disabled:n,selected:a&&this.isOfferSelectedByDefault,locale:this.stateMachine.getLocale(),I18n:i});return this.listenTo(c,s.Events.SELECTED,this._onSelectedTile.bind(this,c)),this.listenTo(c,s.Events.ADD_TO_CART,this.dispatchEvent.bind(this,l.ADD_TO_CART)),c})},destroy(){this.stopListening(),this._destroyTiles(),this.stateMachine=null,this._parent(),this.container=null}});return d.Events=l,d}),define("DS/MPFClickAndBuyComponent/discoverBundle/DiscoverBundleComponent",["UWA/Class/View","UWA/Core","DS/MPFClickAndBuyComponent/discoverBundle/DiscoverBundleSection","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i)=>{"use strict";const r=Object.freeze({DISPLAY_INFO_BUNDLE:"displayInfoBundle"}),n=e.extend({className:"mpf-discover-bundle",setup({stateMachine:e}={}){this.stateMachine=e},render({bundles:e,I18n:t}){return this._destroySections(),e.length>0?(this.sections=this._createSections({bundles:e,I18n:t}),this.container.setContent([{tag:"div",class:"mpf-intro",text:t.get("interestingOffers")},...this.sections.map(e=>e.render())])):this.container.setContent([]),this},_createSections({bundles:e,I18n:t}){return e.map(e=>{const n=new i({locale:this.stateMachine.getLocale(),bundle:e,I18n:t});return this.listenTo(n,i.Events.DISCOVER_BUNDLE,this.dispatchEvent.bind(this,r.DISPLAY_INFO_BUNDLE)),n})},_destroySections(){this.sections&&this.sections.forEach(e=>{this.stopListening(e),e.destroy()})},destroy(){this.stopListening(),this.stateMachine=null,this._parent(),this.container=null}});return n.Events=r,n}),define("DS/MPFClickAndBuyComponent/orderList/OrderListDataLoader",["DS/MPFUtils/StorageUtils","DS/MPFServices/MarketplaceServices","DS/MPFCartModel/CartFactory","DS/MPFCartModel/CartItemFactory","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFPortfolioModel/PortfolioFactory","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper","DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine","DS/MPFClickAndBuyComponent/platformSelection/PlatformSelectionDataLoader","DS/MPFError/ValidationError","DS/MPFAmdLazyLoader/AmdLazyLoader"],function(e,t,i,r,n,s,o,a,c,l,d,h,u){"use strict";return class{constructor({psp:e,stateMachine:t,service:i,cartFactory:r,cartItemFactory:n,portfolioFactory:s,tenantFactory:o}){this.psp=e,this.stateMachine=t,this.service=i,this.cartFactory=r,this.cartItemFactory=n,this.portfolioFactory=s,this.platformLoader=new d({cartFactory:r,tenantFactory:o})}async loadData({cart:d,cartId:h,offerTrigram:p,offerName:m,licencingScheme:C,quantity:f=1,service:g=t.CLICK_AND_BUY}){const[y,P,I]=await u.getInstance().get(["i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","i18n!DS/MPFClickAndBuyComponent/assets/nls/SubscriptionInformation","i18n!DS/MPFClickAndBuyComponent/assets/nls/AvailableCountries"]);d=d||this.cartFactory.createModel(i.Types.ME);const S=this.stateMachine.getCountry();let M;if(C&&(m||p)){let t,i;if(m)(t=this.portfolioFactory.createPackCollection(o.Types.BY_NAME)).searchName=m,await t.fetchPromise({country:S});else{(t=this.portfolioFactory.createPackCollection(o.Types.BY_TRIGRAM_V2)).productTrigram=a.addProductSuffix(p);const e=this.portfolioFactory.createPackCollection(o.Types.PRODUCT_DEPENDENCIES);e.productTrigram=a.addProductSuffix(p),await Promise.all([t.fetchPromise({country:S}),e.fetchPromise({country:S})]),i=e.map(e=>e.getOffers().getPortfolioWithLicensingScheme(C))}if(M=this.portfolioFactory.createCollection(o.Types.PORTFOLIO,[]),t.size()>0){const o=t.first().getOffers().getPortfolioWithLicensingScheme(C);if(o){let a;M.push(o),a=o.isBundleOffer()?o.getSoftwareOfferDetails().map(e=>this.cartItemFactory.createModel(r.Types.CART_CART_ITEM,{...e,[s.Fields.OFFER_QUANTITY]:f,[s.Fields.QUANTITY]:e.quantity*f,[s.Fields.OFFER_ID]:o.get("id"),[s.Fields.LICENSING_SCHEME]:o.getLicensingScheme()})):[this.cartItemFactory.createModel(r.Types.CART_CART_ITEM,{[s.Fields.QUANTITY]:f,[s.Fields.SKU_ID]:o.getSkuId(),[s.Fields.PRODUCT_TRIGRAM]:o.getProductTrigram(),[s.Fields.LICENSING_SCHEME]:o.getLicensingScheme()})],i&&i.length>0&&i.forEach(e=>{const t=e.getSkuId(),i=e.getProductTrigram();M.find(e=>e.isBundleOffer()?e.containsProductWithTrigram(i):e.getSkuId()===t)||M.push(e),a.find(e=>e.getSkuId()?e.getSkuId()===t:e.getProductTrigram()===i)||a.push(this.cartItemFactory.createModel(r.Types.CART_CART_ITEM,{[s.Fields.QUANTITY]:f,[s.Fields.SKU_ID]:e.getSkuId(),[s.Fields.PRODUCT_TRIGRAM]:e.getProductTrigram(),[s.Fields.LICENSING_SCHEME]:e.getLicensingScheme()}))}),d.set({[n.Fields.ONLINE_INSTANCE]:"",[n.Fields.CURRENCY]:o.getPricelistCurrency(),[n.Fields.STATE]:n.States.DRAFT,legalEntityId:o.getCompanyId(),licensorId:o.getLicensorId()||t.first().getLicensorId(),type:n.Types.SOFTWARE_REQUEST,isSelfOrder:!0}),d.setItems(a),e.storeCart(this.service,d),this.stateMachine.clearSearchParams([l.UrlParams.LICENCING_SCHEME,l.UrlParams.COUNTRY])}}}else if(h){d.set("id",h);try{await d.fetchPromise({expand:[n.Expands.CART_ITEMS]}),!d.isRenewal()&&e.storeCart(this.service,d),M=await c.loadCartItemPortfolios({cart:d,country:S,portfolioFactory:this.portfolioFactory})}catch(e){throw d=null,M=null,console.log(e),e}}else d.isNew()?(e.loadStoredCart(this.service,d),M=await c.loadCartItemPortfolios({cart:d,country:S,portfolioFactory:this.portfolioFactory})):(e.storeCart(this.service,d),M=await c.loadCartItemPortfolios({cart:d,country:S,portfolioFactory:this.portfolioFactory}));return this.I18n=y,this.cart=d,this.portfolios=M,{I18n:y,SubI18n:P,CountriesI18n:I,cart:d,portfolios:M}}async checkAndSaveCart(){let t,i;try{await c.checkCartMaxChargeCompliance({cart:this.cart,portfolios:this.portfolios,country:this.stateMachine.getCountry(),psp:this.psp,service:this.service,redirectUrlParam:{key:l.UrlParams.GO_TO_PAYMENT,value:!0}});const r=this.stateMachine.getCountry();if(this.cart.isNew()?await c.saveCartAndItems(this.cart,this.portfolios,{country:r}):await c.patchCartAndItems(this.cart,this.portfolios,{country:r}),e.storeCart(this.service,this.cart),this.cart.hasEduItems()||this.cart.hasMakerItems()||this.cart.isRenewal())i=l.Pages.CHECKOUT;else{const e=await this.platformLoader.loadPrivatePlatforms({cart:this.cart});e.length>0?1===e.length&&this.cart.isBeDev()?(await this.platformLoader.saveSelectedPlatform({cart:this.cart,selectedPlatform:e[0].get("id")}),i=l.Pages.CHECKOUT):i=l.Pages.PLATFORM_SELECTION:this.platformLoader.isIFWInCart(this.cart)?i=l.Pages.CHECKOUT:t=this.I18n.get("noIfwInCart")}}catch(e){t=e&&e instanceof h&&"MaxChargeExceeded"===e.errorCode?this.I18n.get("maxChargeExceeded"):this._parseCheckoutError(e)}return{errorMessage:t,newPage:i}}_parseCheckoutError(e){const t=e&&e.response;let i;if(t)switch(t.errorCode){case"Error.EduLicenceLimited":i=this.I18n.get("eduLicenceAlreadyPurchased");break;case"Error.EduCartProcessing":i=this.I18n.get("cartModificationsInProgress");break;case"Error.PrereqMandatory":i=this.I18n.get("ifwIsMandatory");break;case"Error.MakersLicenceLimited":i=this.I18n.get("makersLicenceLimited");break;case"Error.NsrOnly":i=this.I18n.get("errorPurchaseWithoutPlatform");break;case"Error.IncompatibleProductsTypes":i=this.I18n.get("errorIncompatibleProductTypes");break;default:i=this.I18n.get("errorSavingCart")}else i=this.I18n.get("errorSavingCart");return i}}}),define("DS/MPFClickAndBuyComponent/offerList/OfferListComponent",["UWA/Class/View","DS/MPFView/EmptyView","UWA/Core","DS/UIKIT/Badge","DS/UIKIT/Popover","DS/MPFServices/MarketplaceServices","DS/MPFServices/ObjectService","DS/MPFClickAndBuyComponent/offerList/OfferDescriptionComponent","DS/MPFClickAndBuyComponent/offerList/IconRoleSection","DS/MPFClickAndBuyComponent/offerList/OfferListSection","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,r,n,s,o,a,c,l,d,h)=>{"use strict";const u=Object.freeze({ADD_TO_CART:"addToCart",BACK:"back",ON_CHANGE_COUNTRY:"onChangeCountry"}),p=e.extend({className:"mpf-offer-list-component",setup({countries:e,stateMachine:t,service:i=s.CLICK_AND_BUY}={}){o.requiredOfPrototype(t,h,"options.stateMachine must be a ClickAndBuyStateMachine"),this.stateMachine=t,this.service=i,this.iconRoleSection=new c,this.descriptionSection=new a,this.offerSection=this._createOfferSection()},render({I18n:e,cart:t,portfolioPack:r}){const n=[this.descriptionSection.render({portfolioPack:r})];if(r.isBundle()){const t=this._createEduOrMakersProductMessage({portfolioPack:r,I18n:e});n.push(t),this._createPopover({portfolioPack:r,badge:t})}return n.push(this.iconRoleSection.render({portfolioPack:r,I18n:e})),r.getOffers().size()>1&&n.push(i.createElement("div",{class:"mpf-select-subs-label",text:e.get("selectSubscriptionPlan").toUpperCase()})),n.push(this.offerSection.render({cart:t,portfolioPack:r,I18n:e})),this.container.setContent(n),this},_createPopover({portfolioPack:e,badge:t}){const i=e.getOffers().first();if(i.get("eligibility")&&i.get("eligibilityToolTip"))return new n({target:t.elements.icon,trigger:"hover",body:i.get("eligibilityToolTip")})},_createIconRoleSection:({portfolioPack:e})=>e.isBundle()?new c({portfolioPack:e}):t.getInstance(),_createDescriptionComponent:({portfolioPack:e})=>new a({portfolioPack:e}),_createButtonContainer(){return i.createElement("div",{class:"mpf-buttons",html:this.backButton})},_createEduOrMakersProductMessage({portfolioPack:e,I18n:t}){let i;const n=e.getOffers().first();return i=n.get("eligibility")?n.get("eligibility"):d.isEduOffer(n)?t.get("eduIndividualUseMessage"):t.get("makersConsumersUseMessage"),new r({className:"primary mpf-edu-notice",content:i,closable:!1,selectable:!1,icon:n.get("eligibility")&&"info"})},_createOfferSection(){const e=new l({stateMachine:this.stateMachine,isOfferSelectedByDefault:!0});return this.listenTo(e,l.Events.ADD_TO_CART,this.dispatchEvent.bind(this,u.ADD_TO_CART)),e},destroy(){this.stopListening(),this.descriptionSection.destroy(),this.iconRoleSection.destroy(),this.offerSection.destroy(),this.descriptionSection=null,this.iconRoleSection=null,this.offerSection=null,this.stateMachine=null,this.service=null,this._parent(),this.container=null}});return p.Events=u,p}),define("DS/MPFClickAndBuyComponent/orderList/OrderList",["UWA/Class/View","UWA/Core","DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/MPFUtils/StorageUtils","DS/MPFServices/ObjectService","DS/MPFServices/MarketplaceServices","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartFactory","DS/MPFCartModel/CartItemFactory","DS/MPFPspModel/PspModel","DS/MPFPortfolioModel/PortfolioFactory","DS/MPFCountryModel/CountryCollection","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFClickAndBuyComponent/orderList/OrderListDataLoader","DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine","DS/MPFClickAndBuyComponent/ClickAndBuyTracker","DS/MPFClickAndBuyComponent/ClicknbuyHeader","DS/MPFClickAndBuyComponent/orderList/OrderListHeader","DS/MPFClickAndBuyComponent/orderList/OrderListBody","DS/MPFClickAndBuyComponent/orderList/GettingStarted","DS/MPFClickAndBuyComponent/orderList/MarketingModal","DS/MPFClickAndBuyComponent/orderList/SubscriptionInfoModal","DS/MPFClickAndBuyComponent/orderList/SecureTransaction","DS/MPFClickAndBuyComponent/offerList/AvailableCountriesComponent","DS/MPFClickAndBuyComponent/orderList/TotalPriceTile","DS/MPFClickAndBuyComponent/ErrorPage","DS/MPFClickAndBuyComponent/orderList/EmptyCartComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,r,n,s,o,a,c,l,d,h,u,p,m,C,f,g,y,P,I,S,M,E,T,_,A,D,F)=>{"use strict";const k=Object.freeze({ADD_ADDITIONAL_ITEMS:"addAdditionalItems",GO_TO_PAYMENT:"goToPayment",REDIRECT_TO_COMPASS:"compassRedirection",CHECKOUT_CLOSED:"checkoutClosed",ON_COUNTRY_CHANGE:"onCountryChange"}),O=Object.freeze({ADD_OTHER_ITEMS:"AddOtherItems",GO_TO_PAYMENT:"GoToPayment",SHOW_SUBSCRIPTION_INFORMATION:"showSubscriptionInfo",SHOW_BUNDLE_ITEM_DETAILS:"RoleInfoCart",REASSURE_PAYMENT:"ReassurePayment"}),v=e.extend({className:"mpf-order-list",setup({psp:e,countries:t,allCountries:i,portfolioFactory:r,cartFactory:n,cartItemFactory:s,tenantFactory:a,stateMachine:c,tracker:m,moreInformationLink:g,service:y,showPageHeader:I=!0,showCountrySelect:T=!0}={}){o.requiredOfPrototype(e,h,"options.psp must be a PspModel"),o.requiredOfPrototype(c,f,"options.stateMachine must be a ClickAndBuyStateMachine"),o.requiredOfPrototype(t,p,"options.countries must be a CountryCollection"),o.requiredOfPrototype(r,u,"options.portfolioFactory must be a PortfolioFactory"),o.requiredOfPrototype(n,l,"options.cartFactory must be a CartFactory"),o.requiredOfPrototype(s,d,"options.cartItemFactory must be a CartItemFactory"),o.requiredOfPrototype(r,u,"options.portfolioFactory must be a PortfolioFactory"),this.countries=t,this.allCountries=i,this.service=y,this.stateMachine=c,this.tracker=m,this.showPageHeader=I,this.showCountrySelect=T,this.moreInformationLink=g||"https://www.3ds.com/privacy-policy",this.dataLoader=new C({psp:e,stateMachine:c,service:y,cartFactory:n,cartItemFactory:s,portfolioFactory:r,tenantFactory:a}),this.pageHeader=this._createPageHeader(),this.alert=this._createAlert(),this.header=new P,this.marketingModal=new M,this.subscriptionInfoModal=new E({portfolios:this.portfolios,tracker:this.tracker}),this.availableCountriesComponent=this._createAvailableCountriesComponent(),this.body=this._createBody(),this.secureTransaction=this._createSecureTransaction(),this.paymentButton=this._createPaymentButton(),this.addAdditonalItemButton=this._createAddAddidtionalItemsButton(),this.total=new A,this.gettingStarted=new S,this.errorPage=new D,this.emptyCartComponent=this._createEmptyCartComponent()},load({offerName:e,offerTrigram:t,licencingScheme:i,quantity:r,cartId:n,loadedCart:s}={}){return this.dataLoader.loadData({offerName:e,offerTrigram:t,licencingScheme:i,quantity:r,cartId:n,cart:s}).then(({I18n:e,SubI18n:t,CountriesI18n:i,cart:r,portfolios:n})=>{this.cart=r,this.portfolios=n,this.I18n=e,this.SubI18n=t,this.CountriesI18n=i})},render(){const e=this.stateMachine.getLocale(),i=this.cart.isRenewal();if(this.portfolios.size()>0){const r=t.createElement("div",{class:"mpf-order-list-content",html:[this.header.render({I18n:this.I18n}),this.body.render({cart:this.cart,portfolios:this.portfolios,I18n:this.I18n,SubI18n:this.SubI18n,locale:e})]}),n=[this.alert,this.marketingModal.render({I18n:this.I18n}),this.subscriptionInfoModal.render({I18n:this.I18n}),this.showPageHeader&&this.pageHeader.render({I18n:this.I18n}),this.showCountrySelect&&!i&&this.availableCountriesComponent.render({I18n:this.CountriesI18n}),r];let s;if(this.service===a.SUBSCRIPTIONS&&n.unshift(this._createTitle()),this.service===a.CLICK_AND_BUY){const e=!1;if(s={tag:"div",class:"mpf-footer-buttons",html:[e&&this.addAdditonalItemButton.setValue(this.I18n.get("addAdditionalItems")),{tag:"div",class:"mpf-secure-transaction-and-payment"+(e?"":" mpf-horizontal"),html:[this.paymentButton.setValue(this.I18n.get("goToPayment")),this.secureTransaction.render({I18n:this.I18n})]}]},i){[c.States.SUBMITTED,c.States.PAYMENT_INITIATED,c.States.PENDING_PAYMENT].includes(this.cart.getState())?this.paymentButton.enable():this.paymentButton.disable()}else this._hasExpiredItems()?this.paymentButton.disable():this.paymentButton.enable()}const o={tag:"div",class:"mpf-order-list-footer",html:[this.gettingStarted.render({isRenewal:i}),{tag:"div",class:"mpf-total-and-buy",html:[this.total.render({cart:this.cart,portfolios:this.portfolios,locale:e,I18n:this.I18n}),s]}]};r.addContent(o),this.container.setContent(n)}else this.cart.getItems().length>0?this.container.setContent([this.showCountrySelect&&this.availableCountriesComponent.render({I18n:this.CountriesI18n}),this.errorPage.render({I18n:this.I18n,error:D.Errors.OFFER_NOT_FOUND})]):this.container.setContent([this.showCountrySelect&&this.availableCountriesComponent.render({I18n:this.CountriesI18n}),this.emptyCartComponent.render({I18n:this.I18n})]);return this.tracker&&this.tracker.trackPage({cart:this.cart,url:window.location.pathname,title:g.Titles.QUOTE,portfolios:this.portfolios}),this._goToPaymentIfUrlParamFound(),this},destroy(){this.stopListening(),this.header.destroy(),this.availableCountriesComponent&&this.availableCountriesComponent.destroy(),this.body.destroy(),this.secureTransaction.destroy(),this.total.destroy(),this.gettingStarted.destroy(),this.dataLoader=null,this.header=null,this.availableCountriesComponent=null,this.body=null,this.secureTransaction=null,this.total=null,this.gettingStarted=null,this.cart=null,this.portfolios=null,this.countries=null,this.tracker=null,this.I18n=null,this.SubI18n=null,this.CountriesI18n=null,this._parent(),this.container=null},_hasExpiredItems(){return this.portfolios.some(e=>m.isOfferExpired(e))},_onOrderChanged(){s.storeCart(this.service,this.cart),this.render(),this.cart.hasExpiredItems()?this.paymentButton.disable():this.paymentButton.enable(),0===this.cart.getItems().length&&(this.paymentButton.disable(),s.clearCart(this.service),this.dispatchEvent(k.ADD_ADDITIONAL_ITEMS))},_goToPaymentIfUrlParamFound(){new URL(window.location.href).searchParams.has(f.UrlParams.GO_TO_PAYMENT)&&this._goToPaymentHandler()},async _goToPaymentHandler(){if(this.stateMachine.clearSearchParams([f.UrlParams.GO_TO_PAYMENT]),this.cart.getItems().length>0){n.mask(this.container),this.tracker&&await this.tracker.sendEvent({cart:this.cart,action:O.GO_TO_PAYMENT});const{errorMessage:e,newPage:t}=await this.dataLoader.checkAndSaveCart();n.unmask(this.container),e?(this.render(),this.alert.add({className:"error",message:e}).show()):t&&this.stateMachine.changePage(t)}},_createPageHeader(){return new y({stateMachine:this.stateMachine})},_createSecureTransaction(){const e=new T({moreInformationLink:this.moreInformationLink});return this.listenTo(e,T.Events.CLICKED,()=>{this.tracker&&this.tracker.sendEvent({cart:this.cart,action:O.REASSURE_PAYMENT})}),e},_createPaymentButton(){return new r({className:"primary mpf-payment-button",icon:"shopping-cart",events:{onClick:this._goToPaymentHandler.bind(this)}})},_createAddAddidtionalItemsButton(){return new r({events:{onClick:()=>{s.storeCart(this.service,this.cart),this.tracker&&this.tracker.sendEvent({cart:this.cart,action:O.ADD_OTHER_ITEMS}),this.dispatchEvent(k.ADD_ADDITIONAL_ITEMS)}}})},_createAvailableCountriesComponent(){const e=new _({countries:this.countries,stateMachine:this.stateMachine,tracker:this.tracker});return this.listenTo(e,_.Events.ON_CHANGE_COUNTRY,async({country:e,requiresLanguageChange:t})=>{t&&(this.stateMachine.isCurrentUrlACompassUrl()||this.stateMachine.isUrlDedicatedPage())?window.location.reload():(n.mask(this.container),await this.load(),n.unmask(this.container),this.render(),this.dispatchEvent(k.ON_COUNTRY_CHANGE,{country:e}))}),e},_createAlert:()=>new i({visible:!1,autoHide:!0,closeOnClick:!1,hideDelay:1e4}),_createTitle(){return t.createElement("div",{class:"mpf-my-order-title",text:this.I18n.get("myOrder")})},_createBody(){const e=new I({cart:this.cart,tracker:this.tracker,service:this.service});return this.listenTo(e,I.Events.ORDER_CHANGED,this._onOrderChanged.bind(this)),this.listenTo(e,I.Events.SHOW_MARKETING_MODAL,e=>{this.tracker&&this.tracker.sendEvent({cart:this.cart,action:O.SHOW_BUNDLE_ITEM_DETAILS,label:e.productDisplayName}),this.marketingModal.show({item:e})}),this.listenTo(e,I.Events.SHOW_SUBSCRIPTION_INFO,({portfolio:e})=>{this.tracker&&this.tracker.sendEvent({cart:this.cart,action:O.SHOW_SUBSCRIPTION_INFORMATION}),this.subscriptionInfoModal.show({portfolio:e,SubI18n:this.SubI18n})}),this.listenTo(e,I.Events.REMOVE_ITEM_ERROR,()=>{this.alert.add({className:"error",message:this.I18n.get("itemDeletionError")}).show()}),e},_createEmptyCartComponent(){const e=new F;return this.listenTo(e,F.Events.ADD_ITEMS,this.dispatchEvent.bind(this,k.ADD_ADDITIONAL_ITEMS)),e}});return v.Events=k,v}),define("DS/MPFClickAndBuyComponent/platformSelection/PlatformSelectionPage",["UWA/Class/View","DS/UIKIT/Mask","DS/MPFUtils/StorageUtils","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartFactory","DS/MPFTenantModel/TenantFactory","DS/MPFAmdLazyLoader/AmdLazyLoader","DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine","DS/MPFClickAndBuyComponent/platformSelection/PlatformSelectionDataLoader","DS/MPFClickAndBuyComponent/platformSelection/TenantSelectionModal"],function(e,t,i,r,n,s,o,a,c,l,d){"use strict";const h=Object.freeze({}),u=e.extend({className:"mpf-platform-selection-page",setup({stateMachine:e,cartFactory:t,tenantFactory:i,service:n}={}){r.requiredOfPrototype(e,c,"options.stateMachine must be a ClickAndBuyStateMachine"),r.requiredOfPrototype(t,s,"options.cartFactory must be a CartFactory"),r.requiredOfPrototype(i,o,"options.tenantFactory must be a TenantFactory"),this.stateMachine=e,this.service=n,this.dataLoader=new l({cartFactory:t,tenantFactory:i,service:n})},async load(){const{I18n:e,cart:t,platforms:i}=await this.dataLoader.loadData();return this.I18n=e,this.cart=t,this.platforms=i,this.platforms.length>0?1===this.platforms.length&&this.cart.isBeDev()?(await this._onPlatformSelected({selectedPlatform:this.platforms[0].get("id")}),{skipRendering:!0}):void(this.tenantSelectionModal=this._createTenantSelectionModal()):this.dataLoader.isIFWInCart(this.cart)?(this.stateMachine.changePage(c.Pages.CHECKOUT),{skipRendering:!0}):(this.stateMachine.changePage(c.Pages.CART,{errorMessage:this.I18n.get("noIfwInCart")}),{skipRendering:!0})},render(){return this.container.setContent([this.tenantSelectionModal.render({cart:this.cart,platforms:this.platforms,I18n:this.I18n})]),this},destroy(){this.cart=null,this.platforms=null,this.cartFactory=null,this.tenantFactory=null,this._parent(),this.container=null},_isIFWInCart(){return this.cart.getItems().some(e=>e.getProductTrigram().startsWith("IFW-"))},async _onPlatformSelected({selectedPlatform:e}){if(e&&"new"!==e){t.mask(this.container);try{await this.dataLoader.saveSelectedPlatform({cart:this.cart,platform:e}),t.unmask(this.container),this.stateMachine.changePage(c.Pages.CHECKOUT)}catch(e){t.unmask(this.container),this.stateMachine.changePage(c.Pages.CART,{errorMessage:this.I18n.get("errorSavingCart")})}}else this.stateMachine.changePage(c.Pages.CHECKOUT)},_createTenantSelectionModal(){const e=new d;return this.listenTo(e,d.Events.CONTINUE,({selectedPlatform:e})=>{this._onPlatformSelected({selectedPlatform:e})}),this.listenTo(e,d.Events.ON_HIDE,()=>{this.stateMachine.changePage(c.Pages.CART)}),e}});return u.Events=h,u}),define("DS/MPFClickAndBuyComponent/checkout/CabCheckoutPage",["UWA/Class/View","DS/MPFUtils/StorageUtils","DS/MPFServices/ObjectService","DS/MPFServices/MarketplaceServices","DS/MPFAmdLazyLoader/AmdLazyLoader","DS/MPFClickAndBuyComponent/ClickAndBuyTracker","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper","DS/MPFPortfolioModel/PortfolioFactory","DS/MPFError/ValidationError","DS/MPFCartModel/CartFactory","DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine","DS/MPFCheckoutPage/CheckoutPageFactory"],function(e,t,i,r,n,s,o,a,c,l,d,h){"use strict";const u=Object.freeze({ON_ERROR:"onError",ON_CHECKOUT_LOADED:"onCheckoutLoaded",ON_CLOSED:"onClosed",ON_PAYMENT_COMPLETED:"onPaymentCompleted"}),p=e.extend({className:"mpf-click-and-buy-checkout-page",setup({stateMachine:e,cartFactory:t,portfolioFactory:r,tracker:n,service:o,my3dExpConnector:c}){i.requiredOfPrototype(e,d,"options.stateMachine must be a ClickAndBuyStateMachine"),i.requiredOfPrototype(t,l,"options.cartFactory must be a CartFactory"),i.requiredOfPrototype(r,a,"options.portfolioFactory must be a PortfolioFactory"),i.requiredOfPrototype(n,s,"options.tracker must be a ClickAndBuyTracker"),this.stateMachine=e,this.cartFactory=t,this.portfolioFactory=r,this.tracker=n,this.service=o,this.my3dExpConnector=c},async load({I18n:e,cart:i,portfolios:r}={}){i?this.cart=i:(this.cart=this.cartFactory.createModel(l.Types.ME),t.loadStoredCart(this.service,this.cart)),this.portfolios=r||await o.loadCartItemPortfolios({cart:this.cart,country:this.stateMachine.getCountry(),portfolioFactory:this.portfolioFactory}),e?this.I18n=e:[this.I18n]=await n.getInstance().get(["i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent"]),this.tracker.trackPage({cart:this.cart,url:window.location.pathname,title:s.Titles.CHECKOUT,portfolios:this.portfolios}),this.checkoutPage&&(this.stopListening(this.checkoutPage),this.checkoutPage.destroy()),await this._loadCheckoutPage()},render(){return this.container.setContent([this.checkoutPage.render()]),this},destroy(){this.stopListening(),this.checkoutPage&&this.checkoutPage.destroy(),this.checkoutPage=null,this.stateMachine=null,this.tracker=null,this.cart=null,this.portfolios=null,this.I18n=null,this.cartFactory=null,this.portfolioFactory=null,this._parent(),this.container=null},async _loadCheckoutPage(){const e=new URL(this.stateMachine.isCurrentUrlACompassUrl()||this.stateMachine.isUrlDedicatedPage()?this.stateMachine.generateNewUrl(d.Pages.PAYMENT_RESULT):this._generateMy3dExperienceUrl());e.searchParams.append(d.UrlParams.ORDER_ID,this.cart.get("id"));try{this.checkoutPage=await h.createComponent({cartId:this.cart.get("id"),service:r.CLICK_AND_BUY,paymentResultUrl:e.toString()}),this.listenTo(this.checkoutPage,h.Events.BACK_TO_CART,()=>this.stateMachine.changePage(d.Pages.CART)),this.listenTo(this.checkoutPage,h.Events.PAYMENT_DONE,()=>{this.stateMachine.changePage(d.Pages.PAYMENT_RESULT,{cartId:this.cart.get("id")})}),this.dispatchEvent(u.ON_CHECKOUT_LOADED)}catch(e){this._handleError(e)}},_handleError(e){console.error(e);const t=this._parseCheckoutError(e);this.stateMachine.changePage(d.Pages.CART,{errorMessage:t}),this.dispatchEvent(u.ON_ERROR,e)},_parseCheckoutError(e){const t=e&&e.response;let i;if(t)switch(t.errorCode){case"Error.EduLicenceLimited":i=this.I18n.get("eduLicenceAlreadyPurchased");break;case"Error.EduCartProcessing":i=this.I18n.get("cartModificationsInProgress");break;case"Error.PrereqMandatory":i=this.I18n.get("ifwIsMandatory");break;case"Error.MakersLicenceLimited":i=this.I18n.get("makersLicenceLimited");break;case"Error.NsrOnly":i=this.I18n.get("errorPurchaseWithoutPlatform");break;case"Error.IncompatibleProductsTypes":i=this.I18n.get("errorIncompatibleProductTypes");break;default:i=this.I18n.get("errorSavingCart")}else i=e&&e instanceof c&&"MaxChargeExceeded"===e.errorCode?this.I18n.get("maxChargeExceeded"):this.I18n.get("errorSavingCart");return i},_generateMy3dExperienceUrl(){const e=new URL(window.location.href),t=this.my3dExpConnector&&this.my3dExpConnector.rootUrl?this.my3dExpConnector.rootUrl:e.origin.replace(/(-)\w+(.3dexperience|.3dx-staging).3ds.com/,"$1my3dexperience$2"),i=this.my3dExpConnector?this.my3dExpConnector.tenant:this.cartFactory.connector.tenant;return e.searchParams.append(d.UrlParams.TENANT,i),`${t}/cnb/${d.PageToUrlMap.get(d.Pages.PAYMENT_RESULT)}${e.search}`}});return p.Events=u,p}),define("DS/MPFClickAndBuyComponent/PreReqTableComponent",["UWA/Class/View","UWA/Core","DS/MPFServices/ObjectService","DS/MPFUtils/MPFUtils","DS/MPFCartModel/CartModel","DS/MPFPortfolioModel/PortfolioModel","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFPortfolioModel/LicensingHelper","DS/MPFClickAndBuyComponent/PreReqTableLineComponent","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,r,n,s,o,a,c)=>{"use strict";return e.extend({tagName:"table",className:"table table-striped mpf-order-table",setup(){},render({cart:e,selectedPortfolio:t,preReqs:r,productQuantityAddedToCart:o,I18n:a,locale:c}){return i.requiredOfPrototype(e,n,"options.cart must be a CartModel"),i.requiredOfPrototype(t,s,"options.selectedPortfolio must be a PortfolioModel"),this.container.setContent([this._createHeader({I18n:a}),this._createBody({cart:e,selectedPortfolio:t,preReqs:r,productQuantityAddedToCart:o,I18n:a,locale:c})]),this},_createHeader({I18n:e}){const i=t.createElement("th"),r=t.createElement("th",{class:"mpf-order-right",text:e.get("unitPriceTaxExcl")}),n=t.createElement("th",{class:"mpf-order-center",text:e.get("quantityToAdd")}),s=t.createElement("th",{class:"mpf-order-right",text:e.get("priceTaxExcl")});return t.createElement("thead",{html:t.createElement("tr",{html:[i,r,n,s]})})},_createBody({cart:e,selectedPortfolio:i,preReqs:r,productQuantityAddedToCart:n,I18n:s,locale:a}){const l=this._computeInitialValuePreReq({cart:e,selectedPortfolio:i,productQuantityAddedToCart:n}),d=r.map(e=>new c({preReq:e,locale:a,initialQuantity:l,isQuantityInputDisabled:o.isEdu(i.getProductTrigram()),I18n:s}).render());return t.createElement("tbody",{html:d})},_getPreReqListLine(e){return t.createElement("tr",{class:"mpf-item-order",html:this._getPreReqListLineContent(e)})},_computeInitialValuePreReq({cart:e,selectedPortfolio:i,productQuantityAddedToCart:n}){const s=e.getItems(),o=s.filter(e=>!a.isCredit(e.getLicensing())).map(e=>e.getQuantity()),c=0===o.length?0:o.reduce((e,t)=>Math.max(e,t)),l=r.findInArray(s,e=>e.getProductTrigram()===i.getProductTrigram()&&e.getSkuId()===i.get("skuid")),d=t.is(l)?parseInt(l.getQuantity())+n:n;return Math.max(c,d)},destroy(){this._parent(),this.container=null}})}),define("DS/MPFClickAndBuyComponent/PreReqModal",["UWA/Class/View","UWA/Core","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/MPFUtils/StorageUtils","DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartModelHelper","DS/MPFPortfolioModel/PortfolioModel","DS/MPFPortfolioModel/PortfolioCollection","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper","DS/MPFClickAndBuyComponent/PreReqMoreInfoSection","DS/MPFClickAndBuyComponent/PreReqTableComponent","DS/MPFServices/MarketplaceServices","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e,t,i,r,n,s,o,a,c,l,d,h,u,p,m,C,f)=>{"use strict";const g=Object.freeze({ON_HIDE:"onHide",PRE_REQ_ADDED:"preReqAdded"}),y=Object.freeze({PREREQUISITE_ADDED:"PrerequisiteAdded",ALREADY_HAVE_PREREQUISITE:"AlreadyHavePrerequisite"}),P=e.extend({className:"mpf-pre-req-modal",setup({service:e}={}){this.service=e,this.moreInfoSection=new m,this.preReqTable=new C,this.modal=this._createModal()},render(){return this.modal.inject(this.container),this},show({cart:e,selectedPortfolio:t,portfolioDependencies:i,locale:r,I18n:n,productQuantityAddedToCart:s=1}){c.requiredOfPrototype(e,l,"options.cart must be a CartModel"),c.requiredOfPrototype(i,u,"options.portfolioDependencies must be a PortfolioCollection"),c.requiredOfPrototype(t,h,"options.selectedPortfolio must be a PortfolioModel");const o=this._getPreReqs({selectedPortfolio:t,portfolioDependencies:i});this.modal.setHeader(this._createModalHeader({preReqs:o,I18n:n})),this.modal.setBody(this._createModalBody({cart:e,selectedPortfolio:t,preReqs:o,productQuantityAddedToCart:s,I18n:n,locale:r})),this.modal.setFooter(this._createModalFooter({cart:e,preReqs:o,selectedPortfolio:t,productQuantityAddedToCart:s,I18n:n})),this.modal.show(),this._sendTrackingPage({cart:e})},_getPreReqs:({portfolioDependencies:e,selectedPortfolio:t})=>e.map(e=>e.get("productOffers")).flat().filter(e=>e.licensingScheme===t.get("licensingScheme")),_createModal(){return new i({events:{onHide:()=>{this.dispatchEvent(g.ON_HIDE)}}})},_createModalHeader:({preReqs:e,I18n:i})=>t.createElement("h4",{text:e.length>1?i.get("preReqTitle"):i.get("preReqTitleSingular")}),_createModalBody({cart:e,selectedPortfolio:i,preReqs:r,productQuantityAddedToCart:n,I18n:s,locale:o}){return t.createElement("div",{class:"mpf-pre-req-list",html:[t.createElement("div",{class:"table-responsive",html:this.preReqTable.render({cart:e,selectedPortfolio:i,preReqs:r,productQuantityAddedToCart:n,I18n:s,locale:o})}),this.moreInfoSection.render({preReqs:r,I18n:s}),t.createElement("div",{class:"mpf-pre-req-explanation",text:s.get("preReqExplanation")})]})},_createModalFooter({cart:e,preReqs:i,selectedPortfolio:n,productQuantityAddedToCart:s,I18n:o}){return[t.createElement("div",{class:"mpf-want-add-roles",text:o.get("wantToAddRoles")}),new r({className:"default mpf-already-have-prereq-btn",value:o.get("alreadyHaveRoles"),events:{onClick:this._patchCart.bind(this,{addPreReq:!1,cart:e,preReqs:i,selectedPortfolio:n,productQuantityAddedToCart:s})}}),new r({className:"primary",value:o.get("ok"),events:{onClick:this._patchCart.bind(this,{addPreReq:!0,cart:e,preReqs:i,selectedPortfolio:n,productQuantityAddedToCart:s})}})]},_patchCart({addPreReq:e,cart:t,preReqs:i,selectedPortfolio:r,productQuantityAddedToCart:o}){let a;if(e||(i=[]),t.hasEduItems()){const e=t.getItems().map(e=>e.getProductTrigram());a=i.filter(t=>-1===e.indexOf(t.productTrigram))}return n.mask(this.modal.getBody()),p.saveSubscriptionAndPreReq(t,r,o,t.hasEduItems()?a:i).then(()=>{n.unmask(this.modal.getBody()),s.storeCart(this.service,t),e?this._sendTrackingEvent.bind(this,y.PREREQUISITE_ADDED,{cart:t}):this._sendTrackingEvent.bind(this,y.ALREADY_HAVE_PREREQUISITE,{cart:t}),this.modal.hide(),this.dispatchEvent(g.PRE_REQ_ADDED)})},destroy(){this.modal.destroy(),this._parent(),this.container=null},_sendTrackingPage({cart:e}){const t=o.createPageBuilder({url:"/configurator/prerequisite"}).setTitle("Prerequisite").addDimension(a.MARKETPLACE_SERVICE,f.CLICK_AND_BUY);d.addTrackerInformation(t,e),t.addDimension(a.BUYER_TYPE,"company").send()},_sendTrackingEvent(e,{cart:t}){const i=o.createEventBuilder({category:"Cart",action:e}).addDimension(a.MARKETPLACE_SERVICE,f.CLICK_AND_BUY);d.addTrackerInformation(i,t),i.addDimension(a.BUYER_TYPE,"company").send()}});return P.Events=g,P}),define("DS/MPFClickAndBuyComponent/offerList/OfferListPage",["UWA/Class/View","DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/MPFUtils/StorageUtils","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper","DS/MPFClickAndBuyComponent/offerList/OfferListDataLoader","DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine","DS/MPFClickAndBuyComponent/ClickAndBuyTracker","DS/MPFClickAndBuyComponent/ClicknbuyHeader","DS/MPFClickAndBuyComponent/offerList/AvailableCountriesComponent","DS/MPFClickAndBuyComponent/offerList/OfferListComponent","DS/MPFClickAndBuyComponent/discoverBundle/DiscoverBundleComponent","DS/MPFClickAndBuyComponent/SubscriptionInformationComponent","DS/MPFClickAndBuyComponent/ClearCartModal","DS/MPFClickAndBuyComponent/PreReqModal","DS/MPFClickAndBuyComponent/ErrorPage","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],function(e,t,i,r,n,s,o,a,c,l,d,h,u,p,m,C,f){"use strict";const g=Object.freeze({ADD_TO_CART:"addToCart"}),y=Object.freeze({OFFER:"offer",BUNDLE_DETAILS:"bundleDetails"}),P=e.extend({className:"mpf-offer-list-page",setup({stateMachine:e,service:t,countries:i,cartFactory:r,portfolioFactory:n,tracker:s}={}){this.stateMachine=e,this.service=t,this.tracker=s,this.dataLoader=new o({cartFactory:r,portfolioFactory:n,stateMachine:e,service:t}),this.alert=this._createAlert(),this.clearCartModal=this._createClearCartModal(),this.preReqModal=this._createPreReqModal(),this.pageHeader=this._createPageHeader(),this.countrySelect=this._createCountrySelect({countries:i,stateMachine:e}),this.offerList=this._createOfferList(),this.bundleSection=this._createBundleSection(),this.subcriptionInfo=this._createSubscriptionInformationComponent(),this.backButton=this._createBackButton(),this.errorPage=new f,this.state=y.OFFER},load({portfolioPacks:e,portfolioDependencies:t,offerTrigram:i,offerName:r}){return this.dataLoader.loadData({portfolioPacks:e,portfolioDependencies:t,offerTrigram:i,offerName:r}).then(({cart:e,portfolioPacks:t,portfolioDependencies:i,I18n:n,SubI18n:s,CountriesI18n:o})=>{this.cart=e,this.portfolioPacks=t,this.portfolioDependencies=i,this.I18n=n,this.SubI18n=s,this.CountriesI18n=o,this.offerName=r})},render(){let e,t;const i=this.stateMachine.getBundleParam();return i?(e=this.portfolioPacks.find(e=>e.getDisplayName()===i),this.backButton.setValue(this.I18n.get("back"))):(e=this.portfolioPacks.getStandardOffer()||this.portfolioPacks.first(),t=this.portfolioPacks.getBundles().filter(t=>t!==e)),e?this.container.setContent([this.clearCartModal.render(),this.preReqModal.render(),this.alert,this.pageHeader.render({portfolioPack:e,I18n:this.I18n}),{tag:"div",class:"mpf-cab-main-panel",html:[this.countrySelect.render({I18n:this.CountriesI18n}),this.offerList.render({portfolioPack:e,cart:this.cart,I18n:this.I18n}),!i&&this.bundleSection.render({I18n:this.I18n,bundles:t})]},this.subcriptionInfo.render({I18n:this.SubI18n,portfolioPack:e}),!!i&&{tag:"div",class:"mpf-back-button-container",html:[this.backButton]}]):this.container.setContent([this.pageHeader.render({title:this.I18n.get("offerNotFound")}),this.countrySelect.render({I18n:this.CountriesI18n}),this.errorPage.render({I18n:this.I18n,error:f.Errors.OFFER_NOT_FOUND})]),this.tracker&&this.tracker.trackPage({cart:this.cart,url:window.location.pathname,title:c.Titles.OFFER,portfolioPacks:e&&[e],offerName:this.offerName}),this},destroy(){this.stopListening(),this.clearCartModal.destroy(),this.preReqModal.destroy(),this.pageHeader.destroy(),this.countrySelect.destroy(),this.offerList.destroy(),this.bundleSection.destroy(),this.subcriptionInfo.destroy(),this.errorPage.destroy(),this.clearCartModal=null,this.preReqModal=null,this.pageHeader=null,this.countrySelect=null,this.offerList=null,this.bundleSection=null,this.subcriptionInfo=null,this.errorPage=null,this.I18n=null,this.SubI18n=null,this.CountriesI18n=null,this.cart=null,this.portfolioPacks=null,this.stateMachine=null,this.dataLoader=null,this._parent(),this.container=null},_displayPreReqModal({portfolio:e,quantity:t}){if(e.isBundleOffer()||0===this.portfolioDependencies.length){const i=e.isBundleOffer()?s.addOffer(this.cart,e,t):s.saveSubscriptionAndPreReq(this.cart,e,t,[]);return r.mask(this.container),i.then(()=>{r.unmask(this.container),n.storeCart(this.service,this.cart)}).then(()=>{this.stateMachine.changePage(a.Pages.CART)})}this.preReqModal.show({cart:this.cart,selectedPortfolio:e,portfolioDependencies:this.portfolioDependencies,productQuantityAddedToCart:t,locale:this.stateMachine.getLanguage(),I18n:this.I18n})},_createPageHeader(){return new l({stateMachine:this.stateMachine})},_createCountrySelect({countries:e,stateMachine:t}){const i=new d({stateMachine:t,countries:e,tracker:this.tracker});return this.listenTo(i,d.Events.ON_CHANGE_COUNTRY,({country:e,requiresLanguageChange:t})=>{t&&(this.stateMachine.isCurrentUrlACompassUrl()||this.stateMachine.isUrlDedicatedPage())?window.location.reload():(r.mask(this.container),this.load({portfolioPacks:this.portfolioPacks,portfolioDependencies:this.portfolioDependencies}).then(()=>{r.unmask(this.container),this.render()}))}),i},_createOfferList(){const e=new h({stateMachine:this.stateMachine,cart:this.cart,service:this.service});return this.listenTo(e,h.Events.ADD_TO_CART,({portfolio:e,quantity:t})=>{const{conflictingItems:i,conflictType:r}=s.getConflictingItems(this.cart,e);i.length>0?this.clearCartModal.show({cart:this.cart,conflictingItems:i,conflictType:r,portfolio:e,addedQuantity:t,I18n:this.I18n}):s.hasMakerItemsExceededLimit(this.cart,{portfolio:e,quantity:t})?this.alert.add({className:"error",message:this.I18n.get("makerItemLimit",{nb:parseInt(this.cart.getItems()[0].getOfferQuantity())})}).show():this._displayPreReqModal({portfolio:e,quantity:t})}),e},_createBundleSection(){const e=new u({stateMachine:this.stateMachine});return this.listenTo(e,u.Events.DISPLAY_INFO_BUNDLE,({bundle:e})=>{this.stateMachine.setBundleParam(e.getDisplayName()),this.render()}),e},_createSubscriptionInformationComponent:()=>new p,_createBackButton(){return new i({events:{onClick:()=>{this.stateMachine.clearSearchParams([a.UrlParams.BUNDLE]),this.render()}}})},_createClearCartModal(){const e=new m;return this.listenTo(e,m.Events.ON_ITEMS_DELETED,({portfolio:e,quantity:t})=>{this._displayPreReqModal({portfolio:e,quantity:t})}),this.listenTo(e,m.Events.ON_CANCEL,()=>{this.dispatchEvent(g.ADD_ADDITIONAL_ITEMS)}),this.listenTo(e,m.Events.ON_HIDE,()=>{e.hide()}),e},_createPreReqModal(){const e=new C({service:this.service});return this.listenTo(e,C.Events.PRE_REQ_ADDED,()=>{this.stateMachine.changePage(a.Pages.CART)}),e},_createAlert:()=>new t({visible:!1,autoHide:!0,hideDelay:1e4,closable:!0})});return P.States=y,P.Events=g,P}),define("DS/MPFClickAndBuyComponent/ClickAndBuyComponent",["UWA/Class/View","DS/UIKIT/Alert","DS/UIKIT/Spinner","DS/MPFSupportChat/SupportChat","DS/MPFClickAndBuyComponent/ClickAndBuyTracker","DS/MPFClickAndBuyComponent/ErrorPage","DS/MPFClickAndBuyComponent/offerList/OfferListPage","DS/MPFClickAndBuyComponent/orderList/OrderList","DS/MPFClickAndBuyComponent/platformSelection/PlatformSelectionPage","DS/MPFClickAndBuyComponent/checkout/CabCheckoutPage","DS/MPFClickAndBuyComponent/checkout/PaymentRedirectResultPage","DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine"],function(e,t,i,r,n,s,o,a,c,l,d,h){"use strict";const u=Object.freeze({ADD_ADDITIONAL_ITEMS:"addAdditionalItems",ON_PAGE_RENDERED:"onPageRendered"}),p=e.extend({className:"mpf-click-and-buy",setup({stateMachine:e,me:t,psp:o,countries:a,allCountries:c,tenantFactory:l,cartFactory:d,cartItemFactory:u,portfolioFactory:p,my3dExpConnector:m,service:C,initialErrorMessage:f}={}){this.stateMachine=e,this.me=t,this.service=C,this.countries=a,this.allCountries=c,this.tracker=new n,this.alert=this._createAlert(f),this.spinner=new i,this.errorPage=new s,this.offerListPage=this._createOfferListPage({cartFactory:d,portfolioFactory:p}),this.orderListPage=this._createOrderListPage({psp:o,cartFactory:d,cartItemFactory:u,portfolioFactory:p,tenantFactory:l}),this.platformSelectionPage=this._createPlatformSelectionPage({cartFactory:d,tenantFactory:l}),this.checkoutPage=this._createCheckoutPage({cartFactory:d,portfolioFactory:p,tenantFactory:l,my3dExpConnector:m}),this.paymentRedirectResultPage=this._createPaymentRedirectResultPage({cartFactory:d,service:C,me:t}),r.run({authorizedPaths:[/\/compass-world\/3dexperience-collaborative-innovation\/3dswymer/,/\/compass-world\/3dexperience-collaborative-innovation\/project-planner/,/\/compass-world\/3dexperience-works\/design-engineering\/mechanical\/3d-creator/,/\/compass-world\/3dexperience-works\/design-engineering\/shape-and-style\/3d-sculptor/,/\/compass-world\/3dexperience-industries\/transportation-and-mobility\/bid-to-win\/mechanical-engineering\/3d-innovator/],deniedPaths:[/\/offers\//]}),this.listenTo(this.stateMachine,h.Events.PAGE_CHANGE_REQUESTED,(e={})=>{this.load(e).then(({skipRendering:t=!1})=>{t||this.render(e)})})},async load({offerTrigram:e,offerName:t,cartId:i,licencingScheme:r,cart:n,portfolios:o,I18n:a}={}){this.container.setContent([this.spinner.show()]),this.stateMachine.isPaymentRedirectResult()?this.page=this.paymentRedirectResultPage:this.stateMachine.isOfferView()?this.page=this.offerListPage:this.stateMachine.isCartView()?this.page=this.orderListPage:this.stateMachine.isPlatformSelectionView()?this.page=this.platformSelectionPage:this.stateMachine.isCheckoutView()&&(this.page=this.checkoutPage);try{return await this.page.load({offerTrigram:e,offerName:t,cartId:i,cart:n,licencingScheme:r,I18n:a})||{}}catch(e){console.error(e);const t=e&&e.response&&e.response.errorCode;this.page=t?new s({error:t}):this.errorPage,await this.page.load()}},render({errorMessage:e}={}){return this.spinner.hide(),this.container.setContent([this.alert,this.page.render()]),e&&this.alert.add({className:"error",message:e}).show(),this.dispatchEvent(u.ON_PAGE_RENDERED),this},destroy(){this.stopListening(),this.offerListPage.destroy(),this.orderListPage.destroy(),this.checkoutPage.destroy(),this.paymentRedirectResultPage.destroy(),this.stateMachine.clearUrl(),this.page=null,this.stateMachine=null,this.psp=null,this.countries=null,this.tracker=null,this._parent(),this.container=null},_toCompass(){this.stateMachine.clearUrl(),this.dispatchEvent(u.ADD_ADDITIONAL_ITEMS)},_createTracker(){return new n({cart:this.cart})},_createAlert(e){const i=new t({visible:!1,autoHide:!0,hideDelay:1e4,closable:!0});return e&&this.listenToOnce(this,"onInjected",()=>{this.alert.add({className:"error",message:e}).show()}),i},_createOfferListPage({cartFactory:e,portfolioFactory:t}){return new o({cartFactory:e,portfolioFactory:t,stateMachine:this.stateMachine,countries:this.countries,locale:this.locale,tracker:this.tracker,service:this.service})},_createOrderListPage({psp:e,cartFactory:t,cartItemFactory:i,portfolioFactory:r,tenantFactory:n}){const s=new a({psp:e,cartFactory:t,cartItemFactory:i,portfolioFactory:r,tenantFactory:n,stateMachine:this.stateMachine,countries:this.countries,allCountries:this.allCountries,service:this.service,tracker:this.tracker,moreInformationLink:this.moreInformationLink});return this.listenTo(s,a.Events.ADD_ADDITIONAL_ITEMS,this._toCompass.bind(this)),s},_createPlatformSelectionPage({cartFactory:e,tenantFactory:t}){return new c({cartFactory:e,tenantFactory:t,stateMachine:this.stateMachine,service:this.service,tracker:this.tracker})},_createCheckoutPage({psp:e,cartFactory:t,portfolioFactory:i,tenantFactory:r,my3dExpConnector:n}){const s=new l({psp:e,cartFactory:t,portfolioFactory:i,tenantFactory:r,my3dExpConnector:n,stateMachine:this.stateMachine,tracker:this.tracker,service:this.service});return this.listenTo(s,l.Events.ON_PAYMENT_COMPLETED,this._toCompass.bind(this)),s},_createPaymentRedirectResultPage({cartFactory:e,service:t,me:i}){const r=new d({stateMachine:this.stateMachine,cartFactory:e,service:t,me:i});return this.listenTo(r,d.Events.PAYMENT_COMPLETED,this._toCompass.bind(this)),r}});return p.Events=u,p}),define("DS/MPFClickAndBuyComponent/ClickAndBuyWrapper",["DS/MPFServices/MarketplaceServices","DS/MPFConnector/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFPersonModel/PersonFactory","DS/MPFPspModel/PspFactory","DS/MPFCountryModel/CountryFactory","DS/MPFClickAndBuyComponent/ErrorPage","DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine","DS/MPFClickAndBuyComponent/ClickAndBuyComponent"],function(e,t,i,r,n,s,o,a,c){"use strict";return class{static async getClickAndBuyComponent({product:l}={}){try{const d=this._getTenantFromUrlParam(),[h,u]=await Promise.all([t.fetchPromise({service:e.CLICK_AND_BUY,platformId:d}),t.fetchPromise({backend:"my3dexperience",service:e.CLICK_AND_BUY,platformId:d})]),p=i.getInstance(h),[m,C,f,g,y,P,I]=await p.getFactories([i.Types.PERSON,i.Types.COUNTRY,i.Types.PORTFOLIO,i.Types.TENANT,i.Types.PSP,i.Types.CART,i.Types.CART_ITEM]),S=m.createModel(r.Types.ME),M=C.createCollection(s.Types.SP_PUBLIC_OPENED_COUNTRIES),E=C.createCollection(s.Types.COUNTRY),T=y.createModel(n.Types.PARAM_PSP);await Promise.all([this._fetchMeWithoutError(S),M.fetchPromise(),E.fetchPromise()]);const{offerTrigram:_,offerName:A,cartId:D,licencingScheme:F,page:k}=a.getInitialState(l),O=new a({page:k,cookieKey:"swymlang",me:S,countries:M,service:e.CLICK_AND_BUY}),v=new c({stateMachine:O,me:S,psp:T,cartFactory:P,cartItemFactory:I,portfolioFactory:f,tenantFactory:g,countries:M,allCountries:E,my3dExpConnector:u,service:e.CLICK_AND_BUY});return await v.load({offerTrigram:_,offerName:A,cartId:D,licencingScheme:F}),v}catch(e){console.error(e);const t=new o({error:o.Errors.DEFAULT});return await t.load(),t}}static _getTenantFromUrlParam(){return new URL(window.location.href).searchParams.get(a.UrlParams.TENANT)}static _fetchMeWithoutError(e){return new Promise((t,i)=>e.fetch({onComplete:t,onFailure:i,onPassportError:e=>{console.error(e),t()}}))}}}),define("DS/MPFClickAndBuyComponent/ClickAndBuyWidget",["UWA/Element","DS/UIKIT/Spinner","DS/UIKIT/Scroller","DS/MPFClickAndBuyComponent/ClickAndBuyWrapper"],(e,t,i,r)=>{"use strict";return class{constructor(e){this.widget=e}async load(){this.widget.body.addClassName("mpf-page"),(new t).inject(this.widget.body).show();const n=await r.getClickAndBuyComponent(),s=new i({element:new e("div",{class:"page-container",html:{tag:"div",class:"page-content",html:[n.render()]}})}),o=document.querySelector(".topbar"),a=o&&o.offsetHeight||0,c=document.querySelector(".mp-nav-bar"),l=a+(c&&c.offsetHeight||0);s.getContent().setStyle("height",`calc(100vh - ${l}px)`),this.widget.setBody(s),this.widget.globalPageScroller=s}}});