define("DS/XTaskApp/Views/XPlanColumnView",["UWA/Core","UWA/Class","UWA/Element","UWA/Event","UWA/Class/Events","UWA/Class/Collection","DS/UIKIT/Scroller","DS/Handlebars/Handlebars4","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Collections/CollectionTaggerHelper","DS/CollaborativeTasks/Views/CardView","DS/CollaborativeTasks/Views/ColumnView","DS/CollaborativeTasks/Views/CardViewHandler","DS/E6WCommonUI/DragUtil","DS/E6WCommonUI/UIHelper","DS/UIKIT/Tooltip","DS/E6WCommonUI/CompassUtil","DS/E6WCommonUI/Views/FoundationBaseView","DS/E6WCommonUI/Views/E6WHandlebarsHelpers","DS/E6WCommonApps/SmartSchedulerUtils","DS/E6WCommonApps/Models/RDFTaskModel","DS/E6WCommonApps/Collections/PaginatedTasksCollection","DS/E6WCommonApps/Collections/FTSTaskPseudoCollection","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS","text!DS/CollaborativeTasks/assets/templates/column.html.handlebars"],function(e,t,n,o,i,s,a,r,l,c,d,h,p,u,g,m,C,v,f,D,S,y,T,w,k){"use strict";var b=w.get.bind(w),E=r.compile(k),M=s.extend().implement(c),F=t.extend(i,{_uwaClassName:"MockCardView",init:function(e){this.element=e.element,this.column=e.column,this.model=e.model,this._parent.apply(arguments)},onClickTaskCard:function(){event&&event.target&&event.target.hasClassName&&event.target.hasClassName("wux-controls-responsivetileview-checkbox")?this.column.onClickSelection():this.column.dispatchEvent("onTaskCardClicked",this)},getColumn:function(){return this.column},onSelect:function(){this.element.classList.add("active"),C.publishOnPlatformAPI(window.widget.getValue("appId")+".select",this.model)},isSelected:function(){return this.element.className.contains("active")},isMultiSelected:function(){return this.element.getElementsByClassName("wux-controls-responsivetileview-checkbox")[0].className.contains("wux-ui-state-highlighted")},onUnselect:function(){this.element.classList.remove("active"),C.publishOnPlatformAPI(window.widget.getValue("appId")+".unselect",this.model)},onSelectCheckbox:function(){this.element.classList.add("checkbox-selected"),this.element.getElementsByClassName("wux-controls-responsivetileview-checkbox")[0].classList.toggle("wux-ui-state-highlighted",!0),this.getColumn()._parentView&&this.getColumn()._parentView.getElements(".collaborative-tasks-content .wux-controls-responsivetileview-checkbox").forEach(function(e){e.classList.add("wux-ui-state-prehighlighted")})},onUnselectCheckbox:function(){this.element.classList.remove("checkbox-selected"),this.element.getElementsByClassName("wux-controls-responsivetileview-checkbox")[0].classList.toggle("wux-ui-state-highlighted",!1)},multiSelect:function(){this.onSelectCheckbox(),this.onSelect(),this.model._isChecked=!0},multiUnselect:function(){this.onUnselect(),this.onUnselectCheckbox(),this.model._isChecked=!1},destroy:function(){this.element=void 0,this.column=void 0,this.model=void 0}}),_=v.extend({_uwaClassName:"XPlanColumnView",tagName:"div",className:"column ds-dialog",name:"CollaborativeTasks.ColumnView",cardViewMenuButtons:new Map,domEvents:{"mouseover .card-content":"handleMouseOver","mouseout .card-content":"handleMouseLeave","dragstart .card-content":"onDragStart","dragenter .card":"onCardDragEnter","dragleave .card":"onCardDragLeave","dragover .card":"onCardDragOver","drop .card":"onCardDrop","dragenter .ui-droppable":"onColumnDragEnter","dragleave .ui-droppable":"onColumnDragLeave","dragover .ui-droppable":"onColumnDragOver","dragend .ui-droppable":"onDragEnd","drop .ui-droppable":"onColumnDrop"},setup:function(e){this._parent.apply(this,arguments),this.offset=0,this._handleScroll=function(){this.requestIsContinousScroll?this._renderChunk(this.offset):(this._renderChunk(this.offset,!1),this.scrollFetchIntervalId?this.scrollFetchUpdate=!1:(this.scrollFetchIntervalId=setInterval(function(){this.scrollFetchUpdate?(this.collection.getMissingDataInRange(this.offset,30,!1)&&this.collection.fetch({offset:this.offset,limit:y.INITIAL}),clearInterval(this.scrollFetchIntervalId),delete this.scrollFetchIntervalId):this.scrollFetchUpdate=!0}.bind(this),50),this.scrollFetchUpdate=!0)),this.requestIsContinousScroll=!1}.bind(this),this.lastScroll=0,this.range={top:this.offset,bottom:30},this.awaitingData=!0,this.cardMenuHandler=new p({column:this}),this.activeCard=null,this._addCollectionListeners(),this._cardDragEventTargets=new Map,this._colDragEventTargets=new Map,this._fakeTagCollection=new M,this._nlsValue=e.attrDisplayValue,this._attrValue=e.attrValue,this._cardViewHandler=new p({column:this}),this.scrollPane={}},id:function(){return this.collection.extid},_toggleMultiSelectUI:function(e){e=!(!e&&!this._parentView._multiSelectMode),this.cardContent&&this.cardContent.firstChild.classList.toggle("wux-ui-state-prehighlighted",e)},handleMouseOver:function(e){for(var t=e.target,n=null,o=null;null!==t&&null===n;)t.classList.value.includes("card ")?n=t:(t.classList.value.includes("card-content")&&(o=t),t=t.parentElement);this.cardContainer=n,this.cardContent=o,this.cardContainer&&this.cardContainer.classList.add("border-active"),this._toggleMultiSelectUI(!0)},handleMouseLeave:function(){this.cardContainer.classList.remove("border-active"),this._toggleMultiSelectUI(!1)},onClickSelection:function(){this.cardContent.firstChild.classList.remove("wux-ui-state-prehighlighted"),this.dispatchEvent("onMultiSelection",[this.activeCard,{multiselect:!0}])},onContextualMenuClick:function(e){var t=e.target.getParent(".card");if(t){var n=t.getElement(".card-content").getAttribute("data-id");let e=l.getObjectById(n);this.handleContextualMenu(t,e)}},handleContextualMenu:function(e,t){var n=this;let o=new F({element:e,column:this,model:t});this.dispatchEvent("onTaskCardContextMenu",[o,function(){var o=n.menuSelected(e,t);g.showAndUpdateContextualDropdownMenuPosition(o,event)}])},onClick:function(e){for(var t=e.target,n=null;null!==t&&null===n;)t.classList.value.includes("card ")?n=t:t=t.parentElement;if(null!==n){var o=parseInt(n.id.replace("cardc","")),i=this.collection._models[o];e.target&&e.target.classList.contains("fonticon-open-down")?(e.preventDefault(),this.handleContextualMenu(n,i)):null===n&&this.activeCard.div===n||this.cardClicked(n,i)}},resizeBuffer:function(){},menuSelected:function(e,t){this.cardMenuHandler.setModel(t,e);var n=this.cardViewMenuButtons.get(t);if(!n){n=this.cardMenuHandler.generateMenu(e),this.cardViewMenuButtons.set(t,n),n.dropdown.show();var o=this,i=function(){var i=o.cardMenuHandler.generateMenu(e);o.cardViewMenuButtons.set(t,i),n.dropdown.isVisible&&t.hasFetchedAccessData()&&(n.dropdown.hide(),i.dropdown.show())};t.canModify(!0),this.listenTo(t,{onModifyAccessChanged:i,onDeleteAccessChanged:i,selectionChanged:function(n){let i=this.cardViewMenuButtons.get(t)&&this.cardViewMenuButtons.get(t).dropdown;i&&i.isVisible&&i.hide();var s=o.cardMenuHandler.generateMenu(e);o.cardViewMenuButtons.set(t,s),n&&n.shouldShow&&s.dropdown.show()}})}return this._visibleMenu=n,n.dropdown},cardClicked:function(e,t){this.activeCard&&this.activeCard.model===t?(this.activeCard.onClickTaskCard(),this.activeCard=void 0):(this.activeCard=new F({element:e,column:this,model:t}),this.activeCard.onClickTaskCard())},onTaskCardEdit:function(e,t){let n=new F({element:e,column:this,model:t});this.dispatchEvent("editMockTaskCard",n)},onFocusOut:function(){this.activeCard&&(this.activeCard.classList.remove("active"),this.activeCard=null)},render:function(){this.renderChunkTimeout=null,this.container.innerHTML=this.template(),this.columnContent=this.getElement(".body"),this._scroller&&this._scroller.destroy(),this._scroller=new a({element:this.getElement(".cards.task-list")}).inject(this.columnContent),this.scrollPane=this._scroller.elements.content,this.scrollPane.innerHTML='<div id="cardsFullViewport"><div id="cardsFragment"/></div>',this.cardsFullViewport=this.scrollPane.childNodes[0],this.cardsFragment=this.cardsFullViewport.childNodes[0],this._addEventListeners();var e=this.container.getElement(".fonticon-filter");return e&&this.setCompletedTaskFilterToolTip(e),this._toggleMultiSelectUI(),this.collection.length&&this._renderChunk(0,!1),this},setCompletedTaskFilterToolTip:function(e){var t=widget.getValue("completedTasksDisplayPref"),n=b("emxCollaborativeTasks.Label.CompletedTaskTopCountFilterToolTip");n=n.replace("%DAY_COUNT%",t),this._taskFilterTooltip=new m({target:e,body:n+"<br><br>"+b("emxCollaborativeTasks.Label.ChangeCompletedTaskFiltering")})},_addEventListeners:function(){this.scrollPane.addEventListener("wheel",this.onWheel.bind(this)),this.scrollPane.addEventListener("scroll",this.onScroll.bind(this)),this.scrollPane.addEventListener("click",this.onClick.bind(this)),this.scrollPane.addEventListener("contextmenu",this.onContextualMenuClick.bind(this)),this.scrollPane.addEventListener("focus",this.onFocusOut.bind(this)),this.scrollPane.addEventListener("blur",this.onFocusOut.bind(this))},_addCollectionListeners:function(){this.listenTo(this.collection,y.Events.SizeEvent,this.onCollectionSizeChange),this.listenTo(this.collection,y.Events.ModelsAdded,this.modelsAdded),this.listenTo(this.collection,"onChange",this._onTaskChanged),this.listenTo(this.collection,"onRemove",this._onRemove)},onCollectionSizeChange:function(e){this.dispatchEvent(_.Events.InitialLoadComplete),this.collectionSize=e;var t=this.getElement(_.TitleObjectCountId);t&&(t.setText(_.TitleObjectCountString.replace("%COUNT%",e)),this.cardsFullViewport.style.height=85*e+"px")},modelsAdded:function(){this.collectionSize||this.onCollectionSizeChange(this.collection.size());var e=this.range.bottom-this.range.top,t=this.collection.getMissingDataInRange(this.range.top,e);this.awaitingData&&!t&&(this.awaitingData=!1,this._renderChunk(this.offset,!1))},_renderChunk:function(t,n){void 0===n&&(n=!0);var o,i=[],s=85*t,a=30+t;a=a>this.collection._models.length?this.collection._models.length:a;var r=!0;for(o=t;o<a;o++)if(!this.collection.at(o).isBlank){r=!1;break}if(!r||r&&!this.previousChunkWasBlank){this.previousChunkWasBlank=r;var c='<div id="cardsFragment" '+('style="transform: translateY('+s+'px)";')+">",d=!1;for(o=t;o<a;o++){var h=this.collection.at(o);h.isBlank?d=!0:h.hasDataForMask("dsplan:MVMask.Task.ScheduleView")||i.push(h.id),c+=this._cardViewHandler.getCardHtml(h,o)}this.awaitingData=d,c+="</div>",this.cardsFragment.outerHTML=c,this.cardsFragment=this.cardsFullViewport.childNodes[0]}else{for(o=0;o<this.cardsFragment.childNodes.length;o++)this.cardsFragment.childNodes[o].setAttribute("cardId",o+t);this.cardsFragment.style.transform="translateY("+s+"px)"}if(this.range.top=t,this.range.bottom=a,n){var p,u,g=this.scrollDown?this.range.top:this.range.bottom,m=this.collection.getMissingDataInRange(g,y.LIMIT,!this.scrollDown);if(m)m.start?(p=m.start,u=m.start+y.LIMIT):(p=m.end-y.LIMIT>=0?m.end-y.LIMIT:0,u=m.end),this.collection.fetch({offset:p,limit:u-p})}else l.complete(S,i,{mask:"dsplan:MVMask.Task.ScheduleView",onlyIfNeeded:!0});if(this.activeCard&&!this.activeCard.element.isInjected()){const t=this.getCardElementByModel(this.activeCard.model);t&&(this.activeCard.element.classList.contains("active")&&t.classList.add("active"),this.activeCard.element=e.extendElement(t))}this.clearCardViewButtons(),this.dispatchEvent("onRenderChunk")},clearCardViewButtons:function(){this.cardViewMenuButtons.clear();var e=this;this.cardViewMenuButtons.forEach(function(t,n){this.stopListening(n,"onDestroy",e.remove)})},template:function(){var e=f.i18n;f.i18n=b;var t=this.collection.dataForRendering(),n=t.filteredByValue&&t.filteredByValue.actualValue;"all"===widget.getValue(D.COMPLETED_TASK_PREF_NAME)||"Done"!==n&&"Complete"!==n||(t.completedTaskFilterOn=!0);var o=E(t);return f.i18n=e,o},onWheel:function(){this.wheelIntervalId?this.resetWheelInterval=!0:(this.isContinuousScroll=!0,this.resetWheelInterval=!0,this.wheelIntervalId=window.setInterval(function(){this.resetWheelInterval?this.resetWheelInterval=!1:(window.clearInterval(this.wheelIntervalId),delete this.wheelIntervalId,this.isContinuousScroll=!1)}.bind(this),100))},onScroll:function(){var e=this.getMaxVisibleCards(),t=parseInt(this.scrollPane.scrollTop/85),n=t,o=t+e,i=this.scrollPane.scrollTop>this.lastScroll;this.lastScroll=this.scrollPane.scrollTop;var s=-1,a=this.collection._models;i&&this.range.bottom>=this.collectionSize||(i&&this.range.bottom-5<o?s=(s=n-5)>a.length-15?a.length-30:s:!i&&this.range.top+5>n&&(s=(s=n-(30-(e+5)))<0?0:s),-1!==s&&s!==this.range.top&&(this.offset=s,this.scrollDown=i,this.requestIsContinousScroll=this.isContinuousScroll,window.requestAnimationFrame(this._handleScroll)))},getMaxVisibleCards:function(){return this.maxNoOfCards&&this.lastScrollHeight===this.scrollPane.offsetHeight||(this.maxNoOfCards=parseInt(this.scrollPane.offsetHeight/85)+2),this.maxNoOfCards},_onTaskChanged:function(e){var t=this.getElement('[data-id="'+e.id+'"]');t&&(t.innerHTML=this._cardViewHandler.getCardContentHtml(e))},getVisibleModels:function(){var e=this.getMaxVisibleCards(),t=parseInt(this.scrollPane.scrollTop/85);return this.collection.getSelection(t,e)},repaint:function(){var e=this;this._repaintAF=window.requestAnimationFrame(function(){e._renderChunk(e.range.top,!1)})},refresh:function(){this.collectionSize=void 0,this.awaitingData=!0,this.collection.reset({offset:this.range.top})},getDisplayName:function(){return this.collection._valueForFiltering},add:function(e,t){var n=this.collection.add(e,t);n>=this.range.top&&n<=this.range.bottom&&(this.repaint(),t&&t.select&&this.listenToOnce(this,"onRenderChunk",function(){requestAnimationFrame(function(){this.selectByModel(e)}.bind(this))}))},getCardElementByModel:function(e){return this.cardContainer?this.cardContainer:this.getElement('[data-id="'+e.id+'"]').getParent(".card")},unselectCardElementByModel:function(e){let t=this.getCardElementByModel(e);t.classList.remove("active"),t.classList.remove("checkbox-selected"),t.getElementsByClassName("wux-controls-responsivetileview-checkbox")[0].classList.toggle("wux-ui-state-highlighted",!1),e._isChecked=!1},selectByModel:function(e){var t=this.getCardElementByModel(e);this.cardClicked(t,e)},_onRemove:function(e,t,n){var o=n&&n.index;o>=this.range.top&&o<=this.range.bottom&&this.repaint()},onDragStart:function(e){var t=l.getObjectById(e.target.getAttribute("data-id")),n=[],o=this._parentView._selectedModels;o&&0!==o.length?n=o:n.push(t),u.setDragView({container:e.target}),d.prototype.handleDragStart.call({model:n},e)},onCardDragEnter:function(e){if(0===this._cardDragEventTargets.size){var t=l.getObjectById(o.getElement(e).getElement(".card-content").getAttribute("data-id"));d.prototype.handleDragEnter.call({model:t,canDragOverCard:d.prototype.canDragOverCard,container:o.getElement(e)},e)}this._cardDragEventTargets.set(e.target,!0)},onCardDragOver:function(e){var t=l.getObjectById(o.getElement(e).getElement(".card-content").getAttribute("data-id"));return d.prototype.handleDragOver.call({model:t,canDragOverCard:d.prototype.canDragOverCard,container:o.getElement(e)},e)},onCardDragLeave:function(e){var t=o.getElement(e).getElement(".card-content");t||(t=o.getElement(e).getParent(".card").getElement(".card-content")),setTimeout(function(){this._cardDragEventTargets.delete(e.target),0===this._cardDragEventTargets.size&&d.prototype.handleDragLeave({target:t})}.bind(this),1)},onCardDrop:function(){var e=l.getObjectById(o.getElement(event).getElement(".card-content").getAttribute("data-id"));d.prototype.handleDrop.call({model:e,canDragOverCard:d.prototype.canDragOverCard,container:n.extend(event.target.closest(".card")),processDropData:d.prototype.processDropData,_getFieldConfigForValidatingDrop:d.prototype._getFieldConfigForValidatingDrop,validateDroppedObject:d.prototype.validateDroppedObject,_getIdForDroppedItem:d.prototype._getIdForDroppedItem,addAttributeToRDFTask:d.prototype.addAttributeToRDFTask,addAttributeToTask:d.prototype.addAttributeToRDFTask,createNewUrlObject:d.prototype.createNewUrlObject,isValidObjectType:d.prototype.isValidObjectType},event)},onDragEnd:function(){h.prototype.handleDragEnd.call(this)},getColumnFilterAttrValue:function(){return this.collection._view},onColumnDragEnter:function(){0===this._colDragEventTargets.size&&h.prototype.handleDragEnter.call({canDragOverColumn:h.prototype.canDragOverColumn,_parentView:this._parentView,getColumnViewName:h.prototype.getColumnViewName,getColumnFilterAttrValue:this.getColumnFilterAttrValue.bind(this),container:this.container,collection:this.collection}),this._colDragEventTargets.set(event.target,!0)},onColumnDragLeave:function(e){setTimeout(function(){this._colDragEventTargets.delete(e.target),0===this._colDragEventTargets.size&&h.prototype.handleDragLeave.call({adjustScrolling:h.prototype.adjustScrolling,_parentView:this._parentView},e)}.bind(this),1)},onColumnDragOver:function(e){h.prototype.handleDragOver.call({canDragOverColumn:h.prototype.canDragOverColumn,_parentView:this._parentView,getColumnViewName:h.prototype.getColumnViewName,getColumnFilterAttrValue:this.getColumnFilterAttrValue.bind(this),container:this.container,collection:this.collection},e)},onColumnDrop:function(e){var t=this.collection._valueForFiltering;this.collection._valueForFiltering=this._nlsValue,h.prototype.handleDrop.call({canDragOverColumn:h.prototype.canDragOverColumn,_parentView:this._parentView,getColumnViewName:h.prototype.getColumnViewName,getColumnFilterAttrValue:this.getColumnFilterAttrValue.bind(this),container:this.container,collection:this.collection,processModelDrop:h.prototype.processModelDrop,displayDragAndDropSuccessMessage:h.prototype.displayDragAndDropSuccessMessage,displayDragAndDropFailureMessage:h.prototype.displayDragAndDropFailureMessage,getElement:function(){return e.target.closest(".drop-zone-mask")}},e),this.collection._valueForFiltering=t},destroy:function(){this._repaintAF&&cancelAnimationFrame(this._repaintAF),this._repaintAF=void 0,this.scrollPane.innerHTML="",this.collection.destroy&&this.collection.destroy(),this._parent()},afterRDFIndexFetch:function(e){if(!this.isDestroyed){var t=!1,n=e.items.member.length,o=[];if(T.isWorkingCorrectly()){for(var i=0;i<n;i++){var s=e.items.member[i],a=l.getExistingAndMerge(s);a||(a=new S(s,{parse:!0,mask:"dsplan:MVMask.Task.CollaborativeTask.Basic"}),this.collection.add(a,{replace:!0}),this.repaint()),this.collection.contains(a)||(t=!0,o.push(a))}t&&(this._fakeTagCollection.reset(o),this._fakeTagCollection.requestFetchNewTags({onComplete:function(){o.forEach(function(e){var t={};e.tagsData.forEach(function(e){t[e.sixw.split(":").pop()]=e.object}),e.set("_tagData",t)})}}))}else this.collection.set(e.items.member,{at:0,totalItems:e.items.member.length})}}});return _.CssSelectorMarkingInsertionPoint=".top-buffer",_.CssSelectorMarkingBottomInsertionPoint=".bottom-buffer",_.TitleObjectCountId=".object-count",_.TitleObjectCountString="(%COUNT%)",_.Events={InitialLoadComplete:"initialLoadComplete"},_}),define("DS/XTaskApp/Models/XTaskAppTypeDictionary",["UWA/Core","DS/CollaborativeTasks/Models/RDFTasksWorkscopeModel","DS/RDFFoundation/RDFUtils","DS/E6WCommonApps/Models/WorkscopeModel","DS/E6WCommonApps/E6WCommonAppsTypeDictionary"],function(e,t,n,o){"use strict";return n.typeDictionary.mapping.forEach(function(e){e.type===o&&(e.type=t)}),n.typeDictionary.masksStrength["dsplan:MVMask.WorkPackage.CollaborativeTasks"]=29,n.typeDictionary}),define("DS/XTaskApp/Models/ScopeModelContainer",["UWA/Core","UWA/Class","UWA/Class/Events","UWA/Class/Listener","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/Collections/ResultCollection","DS/RDFFoundation/ProjectTypeUtils","DS/Foundation2/Models/ReferenceModel","DS/Foundation2/FoundationV2Data","DS/RDFFoundation/RDFUtils","DS/E6WCommonApps/Models/WorkscopeModel","DS/E6WCommonApps/XTaskScope","DS/E6WCommonUI/PlatformManager","DS/E6WCommonUI/Views/ObjectCardView","DS/E6WCommonApps/Views/LinkLauncherUtils","DS/E6WCommonApps/SmartSchedulerUtils","DS/RDFFoundation/FederatedSearchUtil","DS/CollaborativeTasks/Models/RDFTasksWorkscopeModel","DS/E6WCommonApps/Views/E6WObjectCardView","DS/Foundation/WidgetUwaUtils","DS/Foundation/WidgetAPIs","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/RDFFoundation/Models/ComponentProxyModel","DS/E6WCommonApps/AgileProjectUtils"],function(e,t,n,o,i,s,a,r,l,c,d,h,p,u,g,m,C,v,f,D,S,y,T,w,k){"use strict";y.fixDisplayMessageMethod();var b=function(){return l.getWidgetConstant.apply(this,arguments)},E=t.extend(n,o,{_uwaClassName:"scopeModelContainer",init:function(e){this._collection=e.collection,this.collection=this._collection,this._scope=void 0},get:function(e){var t;return"scope"===e?t=this._scope:"canEdit"===e&&(t=!0),t},add:function(t,n,o){var i=e.clone(o||{},!1);if(this.getScope()&&this.getScope().id===n)return[];i.detailedObjects&&(i.detailedObject=i.detailedObjects[0]);var s=y.getObjectDataFromDropSearchOrTypeAhead(i)||{};return i.objectData&&(s=i.objectData),s.contextFilter=!1,i.isRDF||s.serviceId===T.SERVICE_3DPLAN||s.serviceId===T.SERVICE_3DSWYM||this.checkContextFilter(s)?this._addRDFScope(n,i,s):this._addNonRDFScope(n,i,s)},checkContextFilter:function(e){if(e)return e.serviceId!=T.SERVICE_3DPLAN&&(e.serviceId&&"3dspace"==e.serviceId.toLowerCase()&&k.contextSearchSourceTypes["3dspace"].includes(e.type)||k.contextSearchSourceTypes.swym.includes(e.type)&&"swym:Community"!=e.type&&"swym:DirectMessage"!=e.type)},_addNonRDFScope:function(t,n,o){var i=e.clone(n||{},!1),s=this.collection.getRelatedObject("scopes",t,void 0,void 0,{urlParam:"$fields=collabSpace"});if(n.scopeType&&s.set("type",n.scopeType),s.objData=o,s.get("title")||n.dontCheckTypes)return this._onModelLoaded(s,n);this.listenToOnce(s,"onChange",function(){this._onModelLoaded(s,n)}),this.collection.dictionaryLoaded||this.listenToOnce(this.collection,"onChange:dictionary",function(){i.ignoreEmptyTitle=!0,this._onModelLoaded(s,i)})},_addRDFScope:function(t,n,o){var i,s=this,a=e.clone(n||{},!1);if(s.checkIfSwym(o)||s.checkContextFilter(o))o.type||(o=a.objectData),i=w.getNewProxyModel(o),o.isSwym=s.checkIfSwym(o),o&&s.checkContextFilter(o)&&(o.contextFilter=!0),i.value=t,i.objData=o;else{const e=o.type?{"dsxplan:jsType":o.type}:void 0;(i=c.getObjectForAdding(v,t,{mask:"dsplan:MVMask.WorkPackage.CollaborativeTasks.Basic",attrs:e,onFailure:function(){s.removeScopeOnDelete(a.initialLoad)}})).fetchAccess(),i.objData=o}if(a.dontCheckTypes=!0,i&&i.fetching)this.listenToOnce(i,"onSync",function(){this._onModelLoaded(i,a)});else if(i)return this._onModelLoaded(i,a)},validateRDFScopeWithServer:function(e){var t=this;e instanceof v&&c.getObjectForAdding(v,e.get("@id")||e.get("id"),{mask:"dsplan:MVMask.WorkPackage.CollaborativeTasks.Basic",attrs:{"dsxplan:jsType":e.get("type")||e.get("@type")||e.get("dsxplan:jsType")},onFailure:function(){t.removeScopeOnDelete()}})},_getProjectTypesList:function(){var e=this.collection.projectTypes();return e&&e.split(/,|\n/)||[]},_onModelLoaded:function(t,n){var o=[],s=e.clone(n||{},!1),a=t instanceof i&&"dsplan:DeletedProject"===t.get("dsxplan:jsType"),r=!(t instanceof i||t.get("title"));if(!(a||!s.ignoreEmptyTitle&&r)){if(!s.dontCheckTypes){var l=this.collection.scopesTypes()+","+this.collection.projectTypes();if(-1===(l&&l.split(/,|\n/)||[]).indexOf(t.get("type")))return e.is(s.onFailure)&&s.onFailure(),o}this.checkCredentials(t);var c=this.getScope();return s.silent=!0,c&&c===t?o:(this.setScope(t,s),this.listenTo(this._scope,"onDestroy",this.removeScopeOnDelete),this._fireRelationshipChangeEvents("scope",n),[t])}this.removeScopeOnDelete(s.initialLoad)},checkCredentials:function(e){var t=!1;if(D.getContext()===S.TSK_PRIVATE_SPACE){var n=this._getProjectTypesList(),o=e&&e.get("type");o&&-1===n.indexOf(o)&&(t=!0)}t&&y.displayMessage(b("emxCollaborativeTasks.Info.CredentialsContextNotValid"))},toJSON:function(e){var t=this.getScope(),n={canEdit:!0};return t&&(n.scope=e&&e.dataForRendering?t.dataForRendering(e):t.toJSON(e)),n},dataForRendering:function(t){var n=e.clone(t||{},!1);return n.dataForRendering=!0,this.toJSON(n)},removeScopeOnDelete:function(e){this.removeScopeInternal(e),this.dispatchEvent("onScopeDestroyed",[e])},removeScopeInternal:function(e){this.remove("scope",0,{doNotShowConfirmBox:!0,initialLoad:e})},remove:function(e,t,n){var o=this,i=function(){var t=o.getScope();o.setScope(null,n),t&&o._fireRelationshipChangeEvents(e,n)};this.confirmRemoveScope&&n&&!n.doNotShowConfirmBox?this.confirmRemoveScope(i):i()},_fireRelationshipChangeEvents:function(){return r.prototype._fireRelationshipChangeEvents.apply(this,arguments)},_use3DPlanInSearch:function(){return p.hasAccess("3dplan")&&"onpremise"!==p.getTenant().toLowerCase()},_getDropTypes:function(){var e={"3dspace":(this.collection.scopesTypes()+","+this.collection.projectTypes()).split(",").concat(k.contextSearchSourceTypes["3dspace"]),swym:["swym:Community","swym:DirectMessage"].concat(k.contextSearchSourceTypes.swym),drive:k.contextSearchSourceTypes.drive};return p.hasAccess("3dplan")&&(e["3dplan"]=a.getProjectTypes()),e},_getSearchSource:function(){var e=["3dspace","swym"];return this._use3DPlanInSearch()&&e.push("3dplan"),C.filterSearchSources(e)},_getSearchSourceTypes:function(){var e={"3dspace":(this.collection.scopesTypesForSearch()+","+this.collection.projectTypesForSearch()).split(",").concat(k.contextSearchSourceTypes["3dspace"]),swym:["swym:Community","swym:DirectMessage"].concat(k.contextSearchSourceTypes.swym),drive:k.contextSearchSourceTypes.drive};return this._use3DPlanInSearch()&&(e["3dplan"]=a.getProjectTypes()),e},config:function(){return[{readWrite:!0,name:"scope",attributeToDisplay:"name",imageAttribute:"image",singleObjectOnly:!0,searchSourceTypes:this._getSearchSourceTypes(),dropTypes:this._getDropTypes(),searchTitle:b("emxCollaborativeTasks.Label.referencesAssociatedWithTitle"),placeHolder:this.getPlaceHolderText(),type:"object",customView:f,typeAheadCallback:c.typeAheadCallback,linkCallback:g.launchProperties,getDropDownMenuItems:m.getDocumentTypeDropDownMenuItems,searchSource:this._getSearchSource(),excludeSearchTypes:{"3dspace":["Task","Inbox Task","Project Baseline","Experiment","Project Snapshot","URL"]}}]},getPlaceHolderText:function(){return b("emxCollaborativeTasks.Label.ShowTasksForObject").replace("%NAME%",b("emxCollaborativeTasks.WidgetLabel.MyTasks"))},setScope:function(e,t){var n=t||{},o=!1;if(this._scope!==e){var i=h.getScopeId(),s=h.getScopeType();e?(i===e.id&&s===(e.get("type")||"")||h.setScopeData({id:e.id,type:e.get("type")||e.objData.type,objectData:e.objData,isRDF:Boolean(e.isRDF),isSwym:this.checkIfSwym(e.objData)}),o=!n.initialLoad,this._scope=e):(o=Boolean(i),n.initialLoad?h.removeUserScopeData():h.removeScopeData(),delete this._scope),this.dispatchEvent("onChange:scopeId",[o])}},checkIfSwym:function(e){return!(!e||!(e.type&&e.type.indexOf("swym")>-1||e.serviceId==T.SERVICE_3DSWYM))},getScope:function(){return this._scope}});return E.RDFWorkscopeModel=d,E});