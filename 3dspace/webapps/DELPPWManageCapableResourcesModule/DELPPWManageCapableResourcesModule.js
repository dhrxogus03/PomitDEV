define("DS/DELPPWManageCapableResourcesModule/ManageStepOperationsUsageBaseUI",["UWA/Core","text!DS/DELPPWManageCapableResourcesModule/assets/json/ManageCapableRscTLVOption.json"],function(e,n){"use strict";var t,a;return function(o,r,i,s,c,u,d,l,p,g){var f,I,m,P,h;return h=e.Json.decode(n),m=function(e){var n=[],t=p.getConnection(e.linkPID),a=o.getBehavior("CapableResourceLinkBehaviour").packConnInfo(t),r=p.getSecondaryResourceLinksInfo(t);return n.push({displayType:"MANAGESTEPOPERATIONSUILinkAttr",dataIndex:"V_EstimatedTime",dicoType:"DELLmiEstimatedTime",primaryLinkPID:t.get("PID"),entity:"link",isGroupable:!1,isFilterable:!1}),n.push({displayType:"MANAGESTEPOPERATIONSUI",text:a.resourceUsage?a.resourceUsage:a.toName,dataIndex:t.get("PID"),isGroupable:!1,isFilterable:!1}),r.forEach(function(e){n.push({displayType:"MANAGESTEPOPERATIONSUI",text:e.resourceUsage?e.resourceUsage:e.toName,dataIndex:e.connPID,isGroupable:!1,isFilterable:!1})}),n},I=function(n){var t,r=s.getWUXNodeModel();t=h.ManageStepOperationsUsagePanel,(t=e.extend(t,{treeDocument:r},!0)).columnConfig.Columns.Column=m(n),i.createTreeListView(t),i.getContent().setStyles({top:"0px"}),o.notify("populateMangeStepOpertionsUI",{breadcrumb:a,columnInfo:t.columnConfig.Columns.Column})},P=function(e){var n=g.getReferenceModel(e).get("PLMEntity.V_Name");t.title=d.getNLSValue("ManageStepOperation.Title",{resource:n}),t.icon=d.getIconURLFromKey("Manage Step Operation Usages")},f=function(n){var t,i=r.getComponent("Breadcrumb");t=e.clone(n.breadcrumbValue),(a=new i({value:t,mode:i.MODE.EXCLUSIVE_SELECTION})).inject(n.breadcrumbContainer),P(n.resourcePID),a.addEventListener("selectionChange",function(){o.notify("reBuildManageCapableRscUI")})},{buildSkeleton:function(e){var n=e||{};t=n.panel,f(n),I(n)},getBreadCrumb:function(){return a}}}}),define("DS/DELPPWManageCapableResourcesModule/ManageCapableResourcesBaseUI",["UWA/Core","DS/Core/PointerEvents","text!DS/DELPPWManageCapableResourcesModule/assets/json/ManageCapableRscTLVOption.json"],function(e,n,t){"use strict";var a,o,r,i,s,c,u,d=!1;return function(l,p,g,f,I,m,P,h,D,C,v){var U,R,b,E,M,L,y,S,N,k,A,O;return y=e.Json.decode(t),b=function(t){var o,c,p=f.getWUXNodeModel();c=function(n,t){var o={};!1===v.getStepOperationUIState()&&2===n.multipleHitCount&&("tree"===n.dsModel._activeCellStableID.columnDataIndex&&"DELAsmProcessCanUseCnx"===D.getConnection(t.nodeModel.getLinkPID()).get("type")&&(o.panel=a,o.breadcrumbValue=e.clone(u.value),o.resourcePID=t.nodeModel.getReferencePID(),o.linkPID=t.nodeModel.getLinkPID(),o.breadcrumbContainer=r,u.remove(),g.getToolBarContent().remove(),l.notify("openManagStepOperationPanel",o)),"Preferred"===n.dsModel._activeCellStableID.columnDataIndex&&"DELAsmProcessCanUseCnx"===D.getConnection(t.nodeModel.getLinkPID()).get("type")&&v.setPreferred(t.nodeModel.getLinkPID()))},L=y.ManageCapableResourcesPanel,L=e.extend(L,{treeDocument:p,treeListViewContainer:i,toolbarContainer:s,dataGridViewOptions:{toolbarOptions:{actionHandler:k}}},!0),L=e.extend(L,t,!0),g.createTreeListView(L),o=g.getDataGridView(),!1===d&&(o.addEventListener(n.POINTERHIT,c),d=!0)},A=function(){var e=u.value;a.title=P.getNLSValue("ManageCapableResource.Title",{operation:e[e.length-1].label}),a.icon=P.getIconURLFromKey("CapableResourceManageLinks")},R=function(n){var t=p.getComponent("Breadcrumb");u=new t({value:v.getBreadcrumbValue(n),mode:t.MODE.EXCLUSIVE_SELECTION}),A(),u.inject(r),u.addEventListener("change",function(){A(),l.notify("refreshManageCapableResourceView",u.value[u.value.length-1].refPID)}),u.addEventListener("selectionChange",function(){var e,n,t=1===u.selectedValues.length?u.selectedValues[0].refPID:null,a=[];if(null!==t){for(e=v.getBreadCrumbRefPIDs().indexOf(t),n=0;n<=e;n++)a.push(u.value[n]);u.value=a}}),u.onContextualEvent=function(n){var t,a,o=[];return a=n.indexFound,o.push({type:"TitleItem",title:P.getNLSValue("ManageCapableResource.Breadcrumb.Children")}),t=u.selectedValues[0].refPID,v.getChildrenInfo(t).forEach(function(n){o.push({type:"RadioItem",title:n.name,action:{callback:function(){var t,o,r,i=[];for(t=0;t<=a;t++)i.push(u.value[t]);(o=e.clone(u.value[a].path)).push(n.instPID),i.push({instPID:n.instPID,refPID:n.refPID,label:n.name,icon:{iconPath:n.icon,iconSize:{width:"20px",height:"20px"}},path:o}),r=v.isBreadCrumbLabelSameAsNewLabel(i),u.selectedValues=[],u.value=i,r&&l.notify("refreshManageCapableResourceView",u.value[u.value.length-1].refPID)},context:n}})}),o},v.setBreadCrumb(u)},S=function(){u.inject(r),A()},U=function(){var n,t=p.getComponent("WUXFrameWindowsManager").getFrameWindow(l.getAppContext()),u=p.getComponent("WUXDockAreaEnum");o=p.create("Element","div",{class:"mngrsc-panel-container"}),r=p.create("Element","div",{class:"mngrsc-breadcrumb-container"}),c=p.create("Element","div",{class:"mngrsc-navigator"}),s=e.createElement("div",{class:"ppr-toolbar"}),i=p.create("Element","div",{class:"mngrsc-tree-container"}),r.inject(c),s.inject(c),c.inject(o),i.inject(o),a=p.create("Panel",{identifier:"ManageCapableResourcesPanel",domId:"ManageCapableResourcesView",side:u.RightDockArea,currentDockArea:u.RightDockArea,immersiveFrame:t.getImmersiveFrame(),content:o,minWidth:300,height:300,minHeight:350,visibleFlag:!1,resizableFlag:!0,useBordersFlag:!0,collapsibleFlag:!1,verticallyStretchableFlag:!0}),n=t.getImmersiveFrame().getDockingElement(a.currentDockArea),e.is(n)&&(n.collapseDockingZoneFlag=!1),a.close=function(){e.is(M)?l.notify("toggleCmdCheckHeaderState",{cmdName:M,cmdState:!1}):E()}},N=function(){r.getChildren()[0].remove(),S(),g.createTreeListView(L),l.notify("refreshManageCapableResourceView",u.value[u.value.length-1].refPID),v.setStepOperationUIState(!1)},E=function(){a.hide()},O=function(){var e,n,t=[],a=[],o=h.getSelections();n=function(e){return new Promise(function(n,t){var a={onComplete:function(){n()},onFailure:function(){t()}};D.deleteConnection(e,a)})},o[1].forEach(function(e){var n=D.getConnection(e);"DELAsmProcessCanUseCnx"===n.get("type")?t.push(e):"SecondaryCandidateResourceLink"===n.get("type")&&a.push(e)}),e=a.map(function(e){return n(e)}),Promise.allSettled(e).then(function(e){var a=0;e.forEach(function(e){"rejected"===e.state&&a++}),0===a&&t.map(function(e){return n(e)})})},k=function(n){var t,o,i={};switch(n){case"MCROpenManageStepOperationsUI":1===(o=h.getSelections())[1].length&&"DELAsmProcessCanUseCnx"===(t=D.getConnection(o[1][0])).get("type")&&(i.panel=a,i.breadcrumbValue=e.clone(u.value),i.resourcePID=t.get("to"),i.linkPID=t.get("PID"),i.breadcrumbContainer=r,u.remove(),g.getToolBarContent().remove(),l.notify("openManagStepOperationPanel",i));break;case"MCRDeleteLinks":O()}},{buildUI:function(e){var n;e.manageCapableResourcesCmdId&&(M=e.manageCapableResourcesCmdId),U(),n=h.getSelectionsWithPaths(),R(n[0][0]),b(e),l.notify("refreshManageCapableResourceView",u.value[u.value.length-1].refPID)},reBuildUI:function(){N()},showUI:function(){a.show()},reloadUI:function(){var e,n,t=h.getSelectionsWithPaths();1===t[0].length&&(e=v.getBreadcrumbValue(t[0][0]),n=v.isBreadCrumbLabelSameAsNewLabel(e),u.selectedValues=[],u.value=e,n&&l.notify("refreshManageCapableResourceView",u.value[u.value.length-1].refPID))},enableToolBarButtons:function(){var e=h.getSelectionsWithPaths(),n=e[1],t=[];n.length>0&&t.push("MCRDeleteLinks"),v.isBreadCrumbLastElementHeaderOperation()&&1===n.length&&v.isPrimaryCapableResourceLink(e[1][0].id)&&t.push("MCROpenManageStepOperationsUI"),g.enableToolBarItems(t)},deleteLink:function(){O()},isActive:function(){return!!e.is(a)&&a.visibleFlag},getBreadCrumb:function(){return u},destroy:function(){this.isActive()&&E(),e.is(a)&&(a.destroy(),a=void 0)}}}}),define("DS/DELPPWManageCapableResourcesModule/ManageCapableResourcesUI",["UWA/Core","DS/DELPPWManageCapableResourcesModule/ManageCapableResourcesBaseUI"],function(e,n){"use strict";return function(t,a,o,r,i,s,c,u,d,l,p){var g,f,I;I=t.getBehavior("CapableResourceLinkBehaviour"),f={NO_CHILDREN:"noChildren",EXPANDING:"expanding",PARTIALLY_EXPANDED:"partiallyExpanded",EXPANDED:"expanded",COLLAPSED:"collapsed"};const m=function(e){return{label:e.toName,icons:[c.getIconURLFromKey(e.toType)],referencePID:e.toPID,instancePID:e.resourceUsagePID,linkPID:e.connPID,children:[],grid:{Type:e.toType,Preferred:"TRUE"===e.isPreferred?c.getIconURLFromKey("Favorites"):"",ResourceUsage:e.resourceUsage,"DELLmiEstimatedTime.V_EstimatedTime":e.estimatedTime,Document:"",Position:""}}},P=function(e){return r.addNodeModel(e)},h=function(e,n){return r.addNodeModel(n,e)};return g=new n(t,a,o,r,i,s,c,u,d,l,p),e.extend(g,{addNode:function(n){var t,a,o,i,s,c=n.get("type"),u=n.get("from"),d=p.getBreadCrumbLastElementRefPID(),l=I.packConnInfo(n);"DELAsmProcessCanUseCnx"===c&&u===d?(t=m(l),o=r.getNodeModel(l.connPID),e.is(o)||(a=P(t),r.updateNodeState(a,f.NO_CHILDREN))):"SecondaryCandidateResourceLink"===c&&(i=m(l),o=r.getNodeModel(l.connPID),e.is(o)||(a=r.getNodeModel(l.fromPID),e.is(a,"array")&&a.length>0&&(a=a[0],s=h(a,i),a.getState()!==f.EXPANDED&&r.updateNodeState(a,f.EXPANDED),r.updateNodeState(s,f.NO_CHILDREN))))},removeNode:function(n){var t,a,o=n.get("type"),i=I.packConnInfo(n);"DELAsmProcessCanUseCnx"===o?(a=r.getNodeModel(i.connPID),e.is(a,"array")&&a.length>0&&(a[0].removeChildren(),a[0].remove())):"SecondaryCandidateResourceLink"===o&&(t=r.getNodeModel(i.connPID),e.is(t,"array")&&t.length>0&&((t=t[0]).remove(),0===(a=r.getNodeModel(i.fromPID)[0]).getChildren().length&&r.updateNodeState(a,f.NO_CHILDREN)))},loadLinkInfo:function(e){var n,t,a,o,i,s=[],c=p.getBreadCrumbRIRPath();i=function(e){s.push({type:"ResourceUsage",idFrom:c,idTo:e.connPID})},I.getPrimaryResourceLinksInfo(e).forEach(function(e){""===e.resourceUsage&&i(e),d.getSecondaryResourceLinksInfo(e.connPID).forEach(function(e){""===e.resourceUsage&&i(e)})}),new Promise(function(e,n){p.fetchResourceUsages(s,{onComplete:function(){e()},onFailure:function(){n()}})}).then(function(){r.prepareUpdate(),r.emptyNodeModel(),I.getPrimaryResourceLinksInfo(e).forEach(function(e){var i=d.getSecondaryResourceLinksInfo(e.connPID);a=m(e),n=P(a),r.updateNodeState(n,f.NO_CHILDREN),i.forEach(function(e){n.getState()!==f.EXPANDED&&r.updateNodeState(n,f.EXPANDED),o=m(e),t=h(n,o),r.updateNodeState(t,f.NO_CHILDREN)})}),r.pushUpdate()}).catch(function(){r.prepareUpdate(),r.emptyNodeModel(),r.pushUpdate()})},updateNode:function(n){var t,a=n.linkPID?n.linkPID:n.pid,o=e.is(n.instPID)?n.instPID:null,i=r.getNodeModel(a);e.is(n.linkPID)&&delete n.linkPID,e.is(n.pid)&&delete n.pid,e.is(n.instPID)&&delete n.instPID,t={grid:n},e.is(i,"array")&&i.forEach(function(n){n.updateOptions(t),e.is(o)&&n.setInstancePID(o)})},updatePreferredLink:function(n){var t=this,a=function(e){var n=e.state,a=!0===n?c.getIconURLFromKey("Favorites"):"",o={linkPID:e.linkPID,Preferred:a};t.updateNode(o),d.getConnection(e.linkPID).set("DELAsmProcessCanUseCnx.V_IsPreferred",!0===n?"TRUE":"FALSE")};r.prepareUpdate(),e.is(n,"array")?n.forEach(function(e){a(e)}):a(n),r.pushUpdate()}})}}),define("DS/DELPPWManageCapableResourcesModule/ManageStepOperationsUsageUI",["UWA/Core","DS/DELPPWManageCapableResourcesModule/ManageStepOperationsUsageBaseUI"],function(e,n){"use strict";return function(t,a,o,r,i,s,c,u,d,l){var p,g,f;const I="noChildren",m=function(n){var t={label:n.name,icons:[c.getIconURLFromKey(n.type)],referencePID:n.refPID,instancePID:n.instPID,children:[],grid:{cellInfo:{columns:n.columns,rowInfo:n.rowInfo}}};return n.columns.forEach(function(a,o){if(0===o){let o=e.is(n.rowInfo[a.dicoType+"."+a.dataIndex].estimatedTime)?n.rowInfo[a.dicoType+"."+a.dataIndex].estimatedTime:null;t.grid[a.dicoType+"."+a.dataIndex]=o}else{let o=e.is(n.rowInfo[a.dataIndex].availabilityMode)?n.rowInfo[a.dataIndex].availabilityMode:"";t.grid[a.dataIndex]=o}}),t},P=function(e){return r.addNodeModel(e)};return f=function(n,t){var a={},o=l.getBreadCrumbRIRPath(),r=l.getImpacted(n,!1,{relationTypes:["PrimaryResourceLinkDetail","SecondaryResourceLinkDetail"]}),i=e.clone(o);return i.push(t),i.push(n),r.forEach(function(e){var n=e.get("PID"),t=e.get("to"),o=e.get("type"),r="Undefined"===e.get(o+".V_AvailabilityMode")?"":e.get(o+".V_AvailabilityMode"),i=e.get("DELLmiEstimatedTime.V_EstimatedTime");a[t]={resourceDetailPID:n,availabilityMode:r,estimatedTime:i}}),g.forEach(function(n,t){var o=[];0!==t&&(e.is(a[n.dataIndex])||(o.push({type:"ResourceDetail",idFrom:i,idTo:n.dataIndex}),a[n.dataIndex]={connectionParams:o}))}),a[g[0].dicoType+"."+g[0].dataIndex]=a[g[1].dataIndex],a},p=new n(t,a,o,r,i,s,c,u,d,l),e.extend(p,{populateUI:function(n){var t,a,o=n.breadcrumb.value.length,i=n.breadcrumb.value[o-1],s=[],c=[];g=n.columnInfo,r.emptyNodeModel(),a=l.getBreadCrumbRIRPath(),(t=l.getChildrenInfo(i.refPID)).forEach(function(t){var o,r,i=[];n.columnInfo.forEach(function(n){var o=e.clone(a);o.push(t.instPID),o.push(t.refPID),i.push({type:"ResourceDetail",idFrom:o,idTo:e.is(n.primaryLinkPID)?n.primaryLinkPID:n.dataIndex})}),o=l.getImpacted(t.refPID,!1,{relationTypes:["PrimaryResourceLinkDetail","SecondaryResourceLinkDetail"]}),r=i.filter(function(e){return!o.some(function(n){var t=n.get("from"),a=n.get("to");return JSON.stringify(t)===JSON.stringify(e.idFrom)&&a===e.idTo})}),s=s.concat(r)}),new Promise(function(e,n){l.fetchRscDetailLinkBulk(s,{onComplete:function(n){c=s.filter(function(e){return!n.some(function(n){var t=n.get("from"),a=n.get("to");return JSON.stringify(t)===JSON.stringify(e.idFrom)&&a===e.idTo})}),e(c)},onFailure:function(){n()}})}).then(function(){r.prepareUpdate(),t.forEach(function(e){var t,a;e.columns=n.columnInfo,e.rowInfo=f(e.refPID,e.instPID),t=m(e),a=P(t),r.updateNodeState(a,I)}),r.pushUpdate()})},addNode:function(e){var n,t,a=e.get("PID"),o=e.get("isInstanceOf"),s=i.getReference(o),u={name:s.get("PLMEntity.V_Name"),type:s.get("type"),instPID:a,icon:c.getIconURLFromKey(s.get("type")),refPID:o};u.columns=g,u.rowInfo=f(u.refPID,u.instPID),n=m(u),t=P(n),r.updateNodeState(t,I)}})}}),define("DS/DELPPWManageCapableResourcesModule/ManageCapableResourcesModule",["UWA/Core","DS/DELPPWManageCapableResourcesModule/ManageCapableResourcesUI","DS/DELPPWManageCapableResourcesModule/ManageStepOperationsUsageUI"],function(e,n,t){"use strict";return{behaviors:["WUXNodeModelBehavior","UXFactoryBehavior","TreeListViewBehavior","ModelBehavior","LinkBehavior","ResourceBehavior","SelectionBehavior","RootsBehavior","ViewBehavior","CapableResourceLinkBehaviour","ManageCapableResourcesBehaviour"],creator:function(a,o,r,i,s,c,u,d,l,p,g,f){var I,m,P,h,D;return D=function(){return!1===f.getStepOperationUIState()},m=function(e){var n,t,a=e.linkPID;n={onComplete:function(e){var n={linkPID:a,attrRscUsage:"ResourceUsage",rscUsageValue:e.get("PLMInstance.PLM_ExternalID"),instPID:e.get("PID")};f.setResourceUsage(n)}},t={isAggregatedBy:e.isAggregatedBy,isInstanceOf:e.isInstanceOf},f.createResourceUsage(t,n)},{listenTo:function(){return{select:this.onSelect,connectionAdded:this.onAddNode,instanceAdded:this.onAddInstance,instanceRemoved:this.onRemoveInst,referenceChanged:this.onChangeReference,instanceChanged:this.onChangeInstance,connectionRemoved:this.onRemoveConnection,connectionChanged:this.onConnectionChanged,createResourceUsage:this.onCreateResourceUsage,updateResourceUsage:this.onUpdateResourceUsage,updatePreferredLink:this.updatePreferredLink,refreshManageCapableResourceView:this.refreshManageCapableResourceView,reBuildManageCapableRscUI:this.reBuildUI,openManagStepOperationPanel:this.startStepOperationUI,populateMangeStepOpertionsUI:this.populateMangeStepOpertionsUI,refreshImpacted:this.rePopulateMangeStepOpertionsUI}},onStart:function(e){f.setStepOperationUIState(!1),(I=new n(a,r,i,o,s,l,u,d,c,p,f)).buildUI(e),I.showUI()},reBuildUI:function(){I.reBuildUI()},onStop:function(){I.destroy(),I=void 0},refreshManageCapableResourceView:function(e){I.loadLinkInfo(e)},onAddNode:function(n){var t,a=[],r=[];D()&&(o.prepareUpdate(),(n=e.is(n,"array")?n:[n]).forEach(function(e){"DELAsmProcessCanUseCnx"===(t=e.get("type"))?a.push(e):"SecondaryCandidateResourceLink"===t&&r.push(e)}),a.concat(r).forEach(function(e){I.addNode(e)}),o.pushUpdate())},onRemoveConnection:function(e){var n;D()&&(o.prepareUpdate(),(e=Array.isArray(e)?e:[e]).forEach(function(e){"DELAsmProcessCanUseCnx"!==(n=e.get("type"))&&"SecondaryCandidateResourceLink"!==n||I.removeNode(e)}),o.pushUpdate())},onChangeReference:function(n){var t=function(e){o.updateAttributes(e)};o.prepareUpdate(),e.is(n,"array")?n.forEach(function(e){t(e)}):t(n),o.pushUpdate()},onChangeInstance:function(n){var t=function(e){var n,t=e.changedAttributes();for(const a in t)t.hasOwnProperty(a)&&"PLMInstance.PLM_ExternalID"===a&&(n={pid:e.get("PID"),ResourceUsage:e.get("PLMInstance.PLM_ExternalID")},I.updateNode(n))};o.prepareUpdate(),e.is(n,"array")?n.forEach(function(e){t(e)}):t(n),o.pushUpdate()},onConnectionChanged:function(n){var t=function(t){var a=t.changedAttributes();e.is(a)&&(a.linkPID=n.get("PID"),I.updateNode(a))};o.prepareUpdate(),e.is(n,"array")?n.forEach(function(e){t(e)}):t(n),o.pushUpdate()},onCreateResourceUsage:function(n){f.isUsagePossible()&&(e.is(n,"array")?n.forEach(function(e){m(e)}):m(n))},onUpdateResourceUsage:function(n,t){var a,o;o=e.is(n.instMdl)?n.instMdl:f.getResourceUsage(n.linkPID),e.is(o)&&(a={linkPID:n.linkPID,instPID:o.get("PID"),ResourceUsage:o.get("PLMInstance.PLM_ExternalID")},e.is(t)&&!0===t?f.setResourceUsage(a):I.updateNode(a))},onAddNodeNupdateResourceUsage:function(e){var n={linkPID:e.conn.get("PID"),instMdl:e.instMdl};this.onAddNode(e.conn),this.onUpdateResourceUsage(n,!0)},updatePreferredLink:function(e){I.updatePreferredLink(e)},onSelect:function(e){D()&&(e.sourceId===a.getId()?I.enableToolBarButtons():I.reloadUI())},startStepOperationUI:function(e){f.setStepOperationUIState(!0),(P=new t(a,r,i,o,s,l,u,d,c,f)).buildSkeleton(e)},populateMangeStepOpertionsUI:function(e){h=e,P.populateUI(h)},rePopulateMangeStepOpertionsUI:function(e){var n=f.getBreadCrumbLastElementRefPID();!D()&&e.impactedChildren.indexOf(n)>-1&&P.populateUI(h)},onAddInstance:function(n){var t=function(e){f.getBreadCrumbLastElementRefPID()===e.get("isAggregatedBy")&&s.isOperation(n)&&P.addNode(e)};D()||(o.prepareUpdate(),e.is(n,"array")?n.forEach(function(e){t(e)}):t(n),o.pushUpdate())},onRemoveInst:function(n){var t=function(n){var t;e.is(n)&&(t=o.getNodeModel(n.id),e.is(t,"array")&&t.length>0&&t[0].remove())};D()||(o.prepareUpdate(),e.is(n,"array")?n.forEach(function(e){t(e)}):t(n),o.pushUpdate())}}}}});