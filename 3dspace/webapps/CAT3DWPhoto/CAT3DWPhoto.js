define("DS/CAT3DWPhoto/CAT3DWImageView",["UWA/Core","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/CAT3DWMedia/CAT3DWMediaView","DS/CAT3DWVisu/CAT3DWDataFactory","DS/CAT3DWVisu/CAT3DWTolerance","DS/Mesh/MeshUtils","DS/Visualization/MaterialApplication","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS"],function(t,e,i,r,a,n,o,s,h){"use strict";var u=i.extend({init:function(t,e){this._parent(t,e),this._defaultRectangleValue=100,this._width=this._defaultRectangleValue,this._height=this._defaultRectangleValue,this._createRectangle()},_createRectangle:function(){let t=void 0;this._rectangle&&(t=this.getDepth(),this.removeChild(this._rectangle)),this._rectangle=s.createRectangleNode({width:-this._width,height:-this._height,fill:!0,cornerPoint:this._getCornerPoint(),noEdge:"whiteboard"===e.getPreferenceValue("appMode"),color:new n.Color(255,255,255,0)}),this._rectangle.setPickingPriorityId(r.getLabelOf(r.SupportTypes.IMAGE)),void 0!==t&&this.setDepth(t),this.addChild(this._rectangle),this._rebuildSelectionNode()},_getCornerPoint:function(){return new h.Vector2},getTextureFromCanvas:function(t){return this._texture&&this._texture.dispose(),this._texture=new h.Texture(t,void 0,h.ClampToEdgeWrapping,h.ClampToEdgeWrapping,h.LinearFilter,h.LinearMipMapLinearFilter),this._texture.anisotropy=16,this._texture.needsUpdate=!0,this._texture},setTexture:function(t){if(t.image.originalWidth<=0||t.image.originalHeight<=0||t.image.width<=0||t.image.height<=0)return;let e=this.getMediaObj().getDataService().getData().cropData;if(e){if(void 0===this._originalWidth||void 0===this._originalHeight){let t=e.srcData.height/e.srcData.width;t>1?(this._width=this._defaultRectangleValue/t,this._height=this._defaultRectangleValue):(this._width=this._defaultRectangleValue,this._height=this._defaultRectangleValue*t),this._originalWidth=this._width,this._originalHeight=this._height}this._width=this._originalWidth*e.cropData.hRatio,this._height=this._originalHeight*e.cropData.vRatio,this._createRectangle()}else{var i=this.getDimensions(),r=i.width,n=i.height,s=t.image.width,h=t.image.height;t.image.originalWidth&&t.image.originalHeight&&(s=t.image.originalWidth,h=t.image.originalHeight);let e=h/s,o=0,u=0;e>1?(u=this._defaultRectangleValue/e,o=this._defaultRectangleValue):(u=this._defaultRectangleValue,o=this._defaultRectangleValue*e);let c=Math.abs(u/r),l=Math.abs(o/n);a.areAlmostEqual(c,1,a.tolerance)&&a.areAlmostEqual(l,1,a.tolerance)||this.resize(c,l)}var u=this._rectangle.getMaterial("Line")?this._rectangle.getMaterial("Line"):this.getImageBorderMaterial(null);this._rectangle.removeMaterialApplication();var c=new o({faceMaterial:this.getImageMaterial(t,!0),lineMaterial:u});this._rectangle.setMaterialApplication(c),this._depth&&(this.setDepth(this._depth),delete this._depth),this._viewer.render()},resize:function(t,e){if(t&&e){var i=this.getMatrix();i.scale(new h.Vector3(t,e,1)),this.setMatrix(i),this._viewer.render(),this._width=this._defaultRectangleValue*t,this._height=this._defaultRectangleValue*e}},setOpacity:function(t){var e=this._rectangle.getMaterial("Face");e&&(e.opacity=t)},getOpacity:function(){var t=this._rectangle.getMaterial("Face");return t?t.opacity:null},setTransparent:function(t){var e=this._rectangle.getMaterial("Face");e&&(e.transparent=t)},setBorderMaterial:function(t){var e=this._rectangle.getMaterial("Face");this._rectangle.removeMaterialApplication();var i=new o({faceMaterial:e,lineMaterial:this.getImageBorderMaterial(t)});this._rectangle.setMaterialApplication(i)},setImagePickable:function(t){this.setPickable(t?n.PICKABLE:n.NOPICKABLE),this._rectangle.setPickable(t?n.PICKABLE:n.NOPICKABLE)},setDepth:function(t,e){if(this._rectangle&&this._rectangle.material){var i=5*t;this._rectangle.setRenderDepth(i),this._rectangle.setPickingPriorityId("imagePriority"+t),this._rectangle.material.transparent=!0,this._rectangle.material.depthTest=!1;var r=this._rectangle.getMaterial("Line");if(r&&(r.transparent=!0,r.depthTest=!1),e)for(var a=0;a<e.length;a++)e[a].node.setRenderDepth(i+e[a].offset),e[a].node.material&&(e[a].node.material.transparent=!0,e[a].node.material.depthTest=!1)}else this._depth=t},_setPolygonOffset:function(t,e){t.transparent=!0,t.polygonOffset=!0,t.polygonOffsetFactor=-e,t.polygonOffsetUnit=-.1},getDepth:function(){var t=0;return this._rectangle.mesh3js&&this._rectangle.mesh3js.renderDepth&&(t=this._rectangle.mesh3js.renderDepth/5),t},getImageMaterial:function(t,e){var i=new h.MeshBasicMaterial({map:t,force:!0,side:h.DoubleSide});return i.transparent=e,i.color=new h.Color,i.polygonOffset=!0,i.polygonOffsetFactor=.7,i},getImageBorderMaterial:function(t){var e=null;switch(t){case"edition":case"wizard":(e=new h.LineBasicMaterial({color:"#F4F5F6",lineWidth:10,opacity:1,side:h.DoubleSide})).force=!0,e.depthTest=!0;break;case"modeling":(e=new h.LineBasicMaterial({color:"#77797c",lineWidth:1,opacity:1,side:h.DoubleSide})).force=!0,e.depthTest=!0;break;case"placeholder":var i=new Float32Array(2);i[0]=.6,i[1]=.3,(e=new h.LineBasicMaterial({color:"#77797c",lineWidth:1,opacity:1,side:h.DoubleSide,dashPattern:i})).force=!0,e.depthTest=!0;break;case null:default:e=new h.LineBasicMaterial({opacity:0})}return e},getBackgroundImageMaterial:function(){var t=new h.MeshBasicMaterial({color:new h.Color(15856113),force:!0,side:h.DoubleSide});return t.depthTest=!0,t},getNormal:function(){var t=this.getMatrixWorld();return this._getRectangleNormal(t)},getCorners:function(){var t=this.getMatrixWorld();return this._getRectangleCorners(t)},getDimensions:function(){return{width:this._width,height:this._height}},getDefaultRectangleValue:function(){return this._defaultRectangleValue},getScale:function(){return{scaleX:this._defaultRectangleValue/this._media.getWidth(),scaleY:this._defaultRectangleValue/this._media.getHeight()}},getPlan:function(){var t=this.getNormal(),e=new h.Plane(t,0),i=(new h.Vector3).getPositionFromMatrix(this.getMatrix());return e.translate(i),e},getExtremesCorners:function(){var t=this.getCorners(),e=[this._viewer.currentViewpoint.project(t.topLeft),this._viewer.currentViewpoint.project(t.topRight),this._viewer.currentViewpoint.project(t.bottomRight),this._viewer.currentViewpoint.project(t.bottomLeft)],i=this._getExtreme(e),r=this.getPlan();return{topLeft:this._createExtremePoint(i.topLeft,r),topRight:this._createExtremePoint(i.topRight,r),bottomRight:this._createExtremePoint(i.bottomRight,r),bottomLeft:this._createExtremePoint(i.bottomLeft,r)}},_getExtreme:function(t){return{topLeft:{x:Math.min(t[0].x,t[1].x,t[2].x,t[3].x),y:Math.min(t[0].y,t[1].y,t[2].y,t[3].y)},topRight:{x:Math.max(t[0].x,t[1].x,t[2].x,t[3].x),y:Math.min(t[0].y,t[1].y,t[2].y,t[3].y)},bottomRight:{x:Math.max(t[0].x,t[1].x,t[2].x,t[3].x),y:Math.max(t[0].y,t[1].y,t[2].y,t[3].y)},bottomLeft:{x:Math.min(t[0].x,t[1].x,t[2].x,t[3].x),y:Math.max(t[0].y,t[1].y,t[2].y,t[3].y)}}},_createExtremePoint:function(t,e){return this._viewpoint.create3DRayFrom2DPoint(t,this._viewpoint.camera).intersectPlane(e)},_getRectangleNormal:function(t){var e=new h.Vector3,i=new h.Vector3,r=new h.Vector3;return t.extractBasis(e,i,r),r.normalize()},_getRectangleCenter:function(t){var e=this._getRectangleCorners(t),i=(new h.Vector3).addVectors(e.topRight,e.bottomLeft);return i.divideScalar(2),i},_getRectangleCorners:function(t){if(this._rectangle){var e=this._rectangle.mesh3js.geometry[0].vertexPositionArray;return{bottomLeft:new h.Vector3(e[0],e[1],e[2]).applyMatrix4(t),bottomRight:new h.Vector3(e[3],e[4],e[5]).applyMatrix4(t),topLeft:new h.Vector3(e[9],e[10],e[11]).applyMatrix4(t),topRight:new h.Vector3(e[6],e[7],e[8]).applyMatrix4(t)}}var i=new h.Vector3(0,0,0),r=new h.Vector3(-this._defaultRectangleValue,0,0),a=new h.Vector3(0,-this._defaultRectangleValue,0),n=new h.Vector3(-this._defaultRectangleValue,-this._defaultRectangleValue,0);return i.applyMatrix4(t),r.applyMatrix4(t),a.applyMatrix4(t),n.applyMatrix4(t),{bottomLeft:i,bottomRight:r,topLeft:a,topRight:n}},_createSelectionNode:function(){const t=this._rectangle.mesh3js.geometry[0].vertexPositionArray,e=[new h.Vector3(t[0],t[1],t[2]),new h.Vector3(t[3],t[4],t[5]),new h.Vector3(t[6],t[7],t[8]),new h.Vector3(t[9],t[10],t[11])];e[4]=e[0];const i=s.createLineNode({points:e});return i.setMatrix(this._rectangle.getMatrix()),i.setPickable(n.PICKTHROUGH),i.setExcludeFromBounding(!0),i},getCreationData:function(){var t=this._parent();return t.ratioWidth=this._width/this._defaultRectangleValue,t.ratioHeight=this._height/this._defaultRectangleValue,t.matrix=this.getMatrix(),t},getMoveData:function(){return{matrix:this.getMatrix()}},setMoveData:function(t){this.setMatrix(t.matrix)},getEditData:function(){var t=this._parent();return t.depth=this.getDepth(),t},setEditData:function(t){this._parent(t),t.depth&&this.setDepth(t.depth)},_getSrcWidthHeight:function(){return{ratioWidth:this._width/this._defaultRectangleValue,ratioHeight:this._height/this._defaultRectangleValue}}});return t.namespace("DS/CAT3DWPhoto/CAT3DWImageView",u)}),define("DS/CAT3DWPhoto/CAT3DWVibrantAPI",["UWA/Core"],function(t){"use strict";return function t(e,i,r){function a(o,s){if(!i[o]){if(!e[o]){var h="function"==typeof require&&require;if(!s&&h)return h(o,!0);if(n)return n(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=i[o]={exports:{}};e[o][0].call(c.exports,function(t){var i=e[o][1][t];return a(i||t)},c,c.exports,t,e,i,r)}return i[o].exports}for(var n="function"==typeof require&&require,o=0;o<r.length;o++)a(r[o]);return a}({1:[function(t,e,i){if(!r)var r={map:function(t,e){var i={};return e?t.map(function(t,r){return i.index=r,e.call(i,t)}):t.slice()},naturalOrder:function(t,e){return t<e?-1:t>e?1:0},sum:function(t,e){var i={};return t.reduce(e?function(t,r,a){return i.index=a,t+e.call(i,r)}:function(t,e){return t+e},0)},max:function(t,e){return Math.max.apply(null,e?r.map(t,e):t)}};var a=function(){var t=5,e=8-t,i=1e3,a=.75;function n(e,i,r){return(e<<2*t)+(i<<t)+r}function o(t){var e=[],i=!1;function r(){e.sort(t),i=!0}return{push:function(t){e.push(t),i=!1},peek:function(t){return i||r(),void 0===t&&(t=e.length-1),e[t]},pop:function(){return i||r(),e.pop()},size:function(){return e.length},map:function(t){return e.map(t)},debug:function(){return i||r(),e}}}function s(t,e,i,r,a,n,o){this.r1=t,this.r2=e,this.g1=i,this.g2=r,this.b1=a,this.b2=n,this.histo=o}function h(){this.vboxes=new o(function(t,e){return r.naturalOrder(t.vbox.count()*t.vbox.volume(),e.vbox.count()*e.vbox.volume())})}function u(t,e){if(e.count()){var i=e.r2-e.r1+1,a=e.g2-e.g1+1,o=e.b2-e.b1+1,s=r.max([i,a,o]);if(1==e.count())return[e.copy()];var h,u,c,l,g=0,p=[],f=[];if(s==i)for(h=e.r1;h<=e.r2;h++){for(l=0,u=e.g1;u<=e.g2;u++)for(c=e.b1;c<=e.b2;c++)l+=t[n(h,u,c)]||0;g+=l,p[h]=g}else if(s==a)for(h=e.g1;h<=e.g2;h++){for(l=0,u=e.r1;u<=e.r2;u++)for(c=e.b1;c<=e.b2;c++)l+=t[n(u,h,c)]||0;g+=l,p[h]=g}else for(h=e.b1;h<=e.b2;h++){for(l=0,u=e.r1;u<=e.r2;u++)for(c=e.g1;c<=e.g2;c++)l+=t[n(u,c,h)]||0;g+=l,p[h]=g}return p.forEach(function(t,e){f[e]=g-t}),d(s==i?"r":s==a?"g":"b")}function d(t){var i,r,a,n,o,s=t+"1",u=t+"2",c=0;for(h=e[s];h<=e[u];h++)if(p[h]>g/2){for(a=e.copy(),n=e.copy(),o=(i=h-e[s])<=(r=e[u]-h)?Math.min(e[u]-1,~~(h+r/2)):Math.max(e[s],~~(h-1-i/2));!p[o];)o++;for(c=f[o];!c&&p[o-1];)c=f[--o];return a[u]=o,n[s]=a[u]+1,[a,n]}}}return s.prototype={volume:function(t){return this._volume&&!t||(this._volume=(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)),this._volume},count:function(t){var e=this.histo;if(!this._count_set||t){var i,r,a,o=0;for(i=this.r1;i<=this.r2;i++)for(r=this.g1;r<=this.g2;r++)for(a=this.b1;a<=this.b2;a++)o+=e[n(i,r,a)]||0;this._count=o,this._count_set=!0}return this._count},copy:function(){return new s(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histo)},avg:function(e){var i=this.histo;if(!this._avg||e){var r,a,o,s,h=0,u=1<<8-t,c=0,l=0,g=0;for(a=this.r1;a<=this.r2;a++)for(o=this.g1;o<=this.g2;o++)for(s=this.b1;s<=this.b2;s++)h+=r=i[n(a,o,s)]||0,c+=r*(a+.5)*u,l+=r*(o+.5)*u,g+=r*(s+.5)*u;this._avg=h?[~~(c/h),~~(l/h),~~(g/h)]:[~~(u*(this.r1+this.r2+1)/2),~~(u*(this.g1+this.g2+1)/2),~~(u*(this.b1+this.b2+1)/2)]}return this._avg},contains:function(t){var i=t[0]>>e;return gval=t[1]>>e,bval=t[2]>>e,i>=this.r1&&i<=this.r2&&gval>=this.g1&&gval<=this.g2&&bval>=this.b1&&bval<=this.b2}},h.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var e=this.vboxes,i=0;i<e.size();i++)if(e.peek(i).vbox.contains(t))return e.peek(i).color;return this.nearest(t)},nearest:function(t){for(var e,i,r,a=this.vboxes,n=0;n<a.size();n++)((i=Math.sqrt(Math.pow(t[0]-a.peek(n).color[0],2)+Math.pow(t[1]-a.peek(n).color[1],2)+Math.pow(t[2]-a.peek(n).color[2],2)))<e||void 0===e)&&(e=i,r=a.peek(n).color);return r},forcebw:function(){var t=this.vboxes;t.sort(function(t,e){return r.naturalOrder(r.sum(t.color),r.sum(e.color))});var e=t[0].color;e[0]<5&&e[1]<5&&e[2]<5&&(t[0].color=[0,0,0]);var i=t.length-1,a=t[i].color;a[0]>251&&a[1]>251&&a[2]>251&&(t[i].color=[255,255,255])}},{quantize:function(c,l){if(!c.length||l<2||l>256)return!1;var g=function(i){var r,a,o,s,h=new Array(1<<3*t);return i.forEach(function(t){a=t[0]>>e,o=t[1]>>e,s=t[2]>>e,r=n(a,o,s),h[r]=(h[r]||0)+1}),h}(c);g.forEach(function(){});var p=function(t,i){var r,a,n,o=1e6,h=0,u=1e6,c=0,l=1e6,g=0;return t.forEach(function(t){r=t[0]>>e,a=t[1]>>e,n=t[2]>>e,r<o?o=r:r>h&&(h=r),a<u?u=a:a>c&&(c=a),n<l?l=n:n>g&&(g=n)}),new s(o,h,u,c,l,g,i)}(c,g),f=new o(function(t,e){return r.naturalOrder(t.count(),e.count())});function d(t,e){for(var r,a=1,n=0;n<i;)if((r=t.pop()).count()){var o=u(g,r),s=o[0],h=o[1];if(!s)return;if(t.push(s),h&&(t.push(h),a++),a>=e)return;if(n++>i)return}else t.push(r),n++}f.push(p),d(f,a*l);for(var _=new o(function(t,e){return r.naturalOrder(t.count()*t.volume(),e.count()*e.volume())});f.size();)_.push(f.pop());d(_,l-_.size());for(var T=new h;_.size();)T.push(_.pop());return T}}}();e.exports=a.quantize},{}],2:[function(t,e,i){(function(){var e,i,r,a=function(t,e){return function(){return t.apply(e,arguments)}},n=[].slice;window.Swatch=i=function(){function t(t,e){this.rgb=t,this.population=e}return t.prototype.hsl=void 0,t.prototype.rgb=void 0,t.prototype.population=1,t.yiq=0,t.prototype.getHsl=function(){return this.hsl?this.hsl:this.hsl=r.rgbToHsl(this.rgb[0],this.rgb[1],this.rgb[2])},t.prototype.getPopulation=function(){return this.population},t.prototype.getRgb=function(){return this.rgb},t.prototype.getHex=function(){return"#"+((1<<24)+(this.rgb[0]<<16)+(this.rgb[1]<<8)+this.rgb[2]).toString(16).slice(1,7)},t.prototype.getTitleTextColor=function(){return this._ensureTextColors(),this.yiq<200?"#fff":"#000"},t.prototype.getBodyTextColor=function(){return this._ensureTextColors(),this.yiq<150?"#fff":"#000"},t.prototype._ensureTextColors=function(){if(!this.yiq)return this.yiq=(299*this.rgb[0]+587*this.rgb[1]+114*this.rgb[2])/1e3},t}(),window.Vibrant=r=function(){function r(t,r,n){var o,s,h,u,c,l,g,p,f,d;this.swatches=a(this.swatches,this),void 0===r&&(r=64),void 0===n&&(n=5),l=new e(t);try{for(f=l.getImageData().data,p=l.getPixelCount(),o=[],c=0;c<p;)d=f[(g=4*c)+0],u=f[g+1],s=f[g+2],f[g+3]>=125&&(d>250&&u>250&&s>250||o.push([d,u,s])),c+=n;h=this.quantize(o,r),this._swatches=h?h.vboxes.map(function(t){return new i(t.color,t.vbox.count())}):[new i([255,255,255],p)],this.maxPopulation=this.findMaxPopulation,this.generateVarationColors(),this.generateEmptySwatches()}finally{l.removeCanvas()}}return r.prototype.quantize=t("quantize"),r.prototype._swatches=[],r.prototype.TARGET_DARK_LUMA=.26,r.prototype.MAX_DARK_LUMA=.45,r.prototype.MIN_LIGHT_LUMA=.55,r.prototype.TARGET_LIGHT_LUMA=.74,r.prototype.MIN_NORMAL_LUMA=.3,r.prototype.TARGET_NORMAL_LUMA=.5,r.prototype.MAX_NORMAL_LUMA=.7,r.prototype.TARGET_MUTED_SATURATION=.3,r.prototype.MAX_MUTED_SATURATION=.4,r.prototype.TARGET_VIBRANT_SATURATION=1,r.prototype.MIN_VIBRANT_SATURATION=.35,r.prototype.WEIGHT_SATURATION=3,r.prototype.WEIGHT_LUMA=6,r.prototype.WEIGHT_POPULATION=1,r.prototype.VibrantSwatch=void 0,r.prototype.MutedSwatch=void 0,r.prototype.DarkVibrantSwatch=void 0,r.prototype.DarkMutedSwatch=void 0,r.prototype.LightVibrantSwatch=void 0,r.prototype.LightMutedSwatch=void 0,r.prototype.HighestPopulation=0,r.prototype.generateVarationColors=function(){return this.VibrantSwatch=this.findColorVariation(this.TARGET_NORMAL_LUMA,this.MIN_NORMAL_LUMA,this.MAX_NORMAL_LUMA,this.TARGET_VIBRANT_SATURATION,this.MIN_VIBRANT_SATURATION,1),this.LightVibrantSwatch=this.findColorVariation(this.TARGET_LIGHT_LUMA,this.MIN_LIGHT_LUMA,1,this.TARGET_VIBRANT_SATURATION,this.MIN_VIBRANT_SATURATION,1),this.DarkVibrantSwatch=this.findColorVariation(this.TARGET_DARK_LUMA,0,this.MAX_DARK_LUMA,this.TARGET_VIBRANT_SATURATION,this.MIN_VIBRANT_SATURATION,1),this.MutedSwatch=this.findColorVariation(this.TARGET_NORMAL_LUMA,this.MIN_NORMAL_LUMA,this.MAX_NORMAL_LUMA,this.TARGET_MUTED_SATURATION,0,this.MAX_MUTED_SATURATION),this.LightMutedSwatch=this.findColorVariation(this.TARGET_LIGHT_LUMA,this.MIN_LIGHT_LUMA,1,this.TARGET_MUTED_SATURATION,0,this.MAX_MUTED_SATURATION),this.DarkMutedSwatch=this.findColorVariation(this.TARGET_DARK_LUMA,0,this.MAX_DARK_LUMA,this.TARGET_MUTED_SATURATION,0,this.MAX_MUTED_SATURATION)},r.prototype.generateEmptySwatches=function(){var t;if(void 0===this.VibrantSwatch&&void 0!==this.DarkVibrantSwatch&&((t=this.DarkVibrantSwatch.getHsl())[2]=this.TARGET_NORMAL_LUMA,this.VibrantSwatch=new i(r.hslToRgb(t[0],t[1],t[2]),0)),void 0===this.DarkVibrantSwatch&&void 0!==this.VibrantSwatch)return(t=this.VibrantSwatch.getHsl())[2]=this.TARGET_DARK_LUMA,this.DarkVibrantSwatch=new i(r.hslToRgb(t[0],t[1],t[2]),0)},r.prototype.findMaxPopulation=function(){var t,e,i,r,a;for(i=0,t=0,e=(r=this._swatches).length;t<e;t++)a=r[t],i=Math.max(i,a.getPopulation());return i},r.prototype.findColorVariation=function(t,e,i,r,a,n){var o,s,h,u,c,l,g,p,f;for(u=void 0,c=0,o=0,s=(l=this._swatches).length;o<s;o++)g=(p=l[o]).getHsl()[1],h=p.getHsl()[2],g>=a&&g<=n&&h>=e&&h<=i&&!this.isAlreadySelected(p)&&(f=this.createComparisonValue(g,r,h,t,p.getPopulation(),this.HighestPopulation),(void 0===u||f>c)&&(u=p,c=f));return u},r.prototype.createComparisonValue=function(t,e,i,r,a,n){return this.weightedMean(this.invertDiff(t,e),this.WEIGHT_SATURATION,this.invertDiff(i,r),this.WEIGHT_LUMA,a/n,this.WEIGHT_POPULATION)},r.prototype.invertDiff=function(t,e){return 1-Math.abs(t-e)},r.prototype.weightedMean=function(){var t,e,i,r,a;for(r=1<=arguments.length?n.call(arguments,0):[],e=0,i=0,t=0;t<r.length;)e+=r[t]*(a=r[t+1]),i+=a,t+=2;return e/i},r.prototype.swatches=function(){return{Vibrant:this.VibrantSwatch,Muted:this.MutedSwatch,DarkVibrant:this.DarkVibrantSwatch,DarkMuted:this.DarkMutedSwatch,LightVibrant:this.LightVibrantSwatch,LightMuted:this.LightMutedSwatch}},r.prototype.isAlreadySelected=function(t){return this.VibrantSwatch===t||this.DarkVibrantSwatch===t||this.LightVibrantSwatch===t||this.MutedSwatch===t||this.DarkMutedSwatch===t||this.LightMutedSwatch===t},r.rgbToHsl=function(t,e,i){var r,a,n,o,s,h;if(t/=255,e/=255,i/=255,a=void 0,h=void 0,n=((o=Math.max(t,e,i))+(s=Math.min(t,e,i)))/2,o===s)a=h=0;else{switch(r=o-s,h=n>.5?r/(2-o-s):r/(o+s),o){case t:a=(e-i)/r+(e<i?6:0);break;case e:a=(i-t)/r+2;break;case i:a=(t-e)/r+4}a/=6}return[a,h,n]},r.hslToRgb=function(t,e,i){var r,a,n,o,s,h;return h=void 0,a=void 0,r=void 0,n=function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t},0===e?h=a=r=i:(h=n(o=2*i-(s=i<.5?i*(1+e):i+e-i*e),s,t+1/3),a=n(o,s,t),r=n(o,s,t-1/3)),[255*h,255*a,255*r]},r}(),window.CanvasImage=e=function(){function t(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=t.width,this.height=this.canvas.height=t.height,this.context.drawImage(t,0,0,this.width,this.height)}return t.prototype.clear=function(){return this.context.clearRect(0,0,this.width,this.height)},t.prototype.update=function(t){return this.context.putImageData(t,0,0)},t.prototype.getPixelCount=function(){return this.width*this.height},t.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},t.prototype.removeCanvas=function(){return this.canvas.parentNode.removeChild(this.canvas)},t}()}).call(this)},{quantize:1}]},{},[2]),t.namespace("DS/CAT3DWPhoto/CAT3DWVibrantAPI",window.Vibrant)}),define("DS/CAT3DWPhoto/CAT3DWImage",["UWA/Core","DS/CAT3DWMedia/CAT3DWMedia","DS/CAT3DWPhoto/CAT3DWImageView","DS/CoreEvents/Events","DS/Visualization/ThreeJS_DS","WebappsUtils/WebappsUtils","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/CAT3DWInfraUI/CAT3DWCanvasServices"],function(t,e,i,r,a,n,o,s){"use strict";var h=e.extend({init:function(t){this._parent(t),this.getDataService().setValues({width:0,height:0}),this._texture=null,this._saveTexture=[],this._templates=t.templates,this._bIsTextureLoading=!1,this._queuedTexture={urlOrTexture:null,callback:null}},initialize:function(t){if(t.canvas)this.setTextureFromCanvas(t.canvas,t.callback,t.isPlaceHolder);else if(t.cropData&&!t.isPlaceHolder){(new s).getCroppedImageUrl(this.getDataService().getValue("url"),t.cropData.cropData,function(e){this.setTexture(e,t.callback,t.isPlaceHolder)}.bind(this))}else this.setTexture(t.url,t.callback,t.isPlaceHolder);this._parent()},getType:function(){return"CAT3DWImage"},createMediaView:function(t){return new i(this,t)},getWidth:function(){return this.getDataService().getValue("width")},getHeight:function(){return this.getDataService().getValue("height")},_propertiesUpdate:function(t){this._parent(t)},setTextureObj:function(t,e){this.setTexture(t,e)},setTextureFromCanvas:function(t,e){this._bIsTextureLoading=!0,this._texture=this.getView().getTextureFromCanvas(t),this._onTextureLoaded(e)},setTexture:function(t,e,i){var r="";t?r=t:(r=n.getWebappsAssetUrl("CAT3DWPhoto","graphics/G_NXGAddImage.png"),i=!0),this._bIsTextureLoading?(this._queuedTexture.urlOrTexture=r,this._queuedTexture.callback=e,this._queuedTexture.isPlaceHolder=i):(this._bIsTextureLoading=!0,"string"==typeof r?this._texture=a.ImageUtils.loadTexture(r,void 0,this._onTextureLoaded.bind(this,e),this.onLoadImageError,!i&&o.getPreferenceValue("UseCredentials")):"object"==typeof r&&(this._texture=r,this._onTextureLoaded(e)))},onLoadImageError:function(){},removeTexture:function(t){this.setTexture(null,t)},_onTextureLoaded:function(t){const e=this.getDataService();if(e.setValue("width",this._texture.image.width),e.setValue("height",this._texture.image.height),e.setValue("originalWidth",this._texture.image.originalWidth),e.setValue("originalHeight",this._texture.image.originalHeight),this._mediaView.setTexture(this._texture),r.publish({event:this.getTextureReadyEvent(),data:this}),t&&t(this),this._queuedTexture.urlOrTexture){let t=this._queuedTexture.callback,e=this._queuedTexture.urlOrTexture,i=this._queuedTexture.isPlaceHolder;this._queuedTexture.urlOrTexture=null,this._queuedTexture.callback=null,this._queuedTexture.isPlaceHolder=null,"string"==typeof e?this._texture=a.ImageUtils.loadTexture(e,void 0,this._onTextureLoaded.bind(this,t),this.onLoadImageError,!i&&o.getPreferenceValue("UseCredentials")):"object"==typeof e&&(this._texture=e,this._onTextureLoaded(t))}else this._bIsTextureLoading=!1},getTexture:function(){return this._texture},getTextureClone:function(){var t=this.getTexture().clone();return t.sourceFile=this.getTexture().sourceFile,t},save:function(){this._saveTexture.push(this.getTextureClone()),this._parent()},forgetChg:function(t){this._parent(),this.setTextureObj(this._saveTexture.pop(),function(){this._mediaView.forgetChg(),t&&t()}.bind(this))},clearSavedData:function(){this._saveTexture=[],this._parent()},getTextureReadyEvent:function(){return"CATLSImageTextureReady_"+this._id}});return t.namespace("DS/CAT3DWPhoto/CAT3DWImage",h)}),define("DS/CAT3DWPhoto/CAT3DWImagesManager",["DS/CAT3DWMedia/CAT3DWMediaManager","DS/CAT3DWPhoto/CAT3DWImage","DS/Visualization/Node3D","DS/CAT3DWInfraUI/CAT3DWCanvasServices","DS/CAT3DWVisu/CAT3DWPickingControllerFactory","WebappsUtils/WebappsUtils","DS/CAT3DWInfra/CAT3DWPreferenceManager","UWA/Data"],function(t,e,i,r,a,n,o,s){"use strict";return t.extend({init:function(){this._parent(),this._templates={}},initialize:function(t){this._parent(t);var e=this._viewer.getRootNode(),h=null;h=t&&t.rootNodeName?t.rootNodeName:a.getRootImageNodeName(),this._rootNode=new i(h),e.addChild(this._rootNode);var u=new r;if(o.getPreferenceValue("M3DEMobile")){var c=s.proxifyUrl(n.getWebappsAssetUrl("CAT3DWPhoto","graphics/G_NXGAddImage_template.png"),{proxy:"passport"});u.loadImage(c,!0,function(t){this._templates.addImage=t}.bind(this))}else u.loadImage(n.getWebappsAssetUrl("CAT3DWPhoto","graphics/G_NXGAddImage_template.png"),!0,function(t){this._templates.addImage=t}.bind(this))},createImageInGroup:function(t,e){return t.templates=this._templates,this._parent(t,e)},createMediaObject:function(t){return new e(t)},reset:function(t){this._parent(t),this._templates.addImage=null,this._templates={}},getResetEvent:function(){return"CAT3DWImagesManagerReset"}})});