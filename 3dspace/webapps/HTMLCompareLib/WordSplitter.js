define(["require","exports","./Utils"],function(r,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.convertHtmlToListOfWords=void 0;const o=(r,e,t)=>{0!==r.currentWord.length&&r.words.push(r.currentWord.join("")),r.currentWord=[e],r.mode=t};e.convertHtmlToListOfWords=((r,e)=>{var s;const n={mode:"character",currentWord:[],words:[]},c=((r,e)=>{const t=new Map;if(null===e)return t;for(const o of e){let e;for(;null!==(e=o.exec(r));){if(t.has(e.index))throw new Error("One or more block expressions result in a text sequence that overlaps. Current expression: "+o.toString());t.set(e.index,e.index+e[0].length)}}return t})(r,e),i=!!c.size;let d=!1,a=-1;for(let e=0;e<r.length;e++){const h=r[e];if(i){a===e&&(a=-1,d=!1);let r=0;if(c.has(e)&&(d=!0,a=r=null!==(s=c.get(e))&&void 0!==s?s:0),d){n.currentWord.push(h),n.mode="character";continue}}switch(n.mode){case"character":t.isStartOfTag(h)?o(n,"<","tag"):t.isStartOfEntity(h)?o(n,h,"entity"):t.isWhiteSpace(h)?o(n,h,"whitespace"):t.isWord(h)&&(0===n.currentWord.length||t.isWord(n.currentWord[n.currentWord.length-1]))?n.currentWord.push(h):o(n,h,"character");break;case"tag":t.isEndOfTag(h)?(n.currentWord.push(h),n.words.push(n.currentWord.join("")),n.currentWord=[],n.mode=t.isWhiteSpace(h)?"whitespace":"character"):n.currentWord.push(h);break;case"whitespace":t.isStartOfTag(h)?o(n,h,"tag"):t.isStartOfEntity(h)?o(n,h,"entity"):t.isWhiteSpace(h)?n.currentWord.push(h):o(n,h,"character");break;case"entity":if(t.isStartOfTag(h))o(n,h,"tag");else if(t.isWhiteSpace(h))o(n,h,"whitespace");else if(t.isEndOfEntity(h)){let r=!0;if(0!==n.currentWord.length&&(n.currentWord.push(h),n.words.push(n.currentWord.join("")),n.words.length>2&&t.isWhiteSpace(n.words[n.words.length-2])&&t.isWhiteSpace(n.words[n.words.length-1]))){const e=n.words[n.words.length-2],t=n.words[n.words.length-1];n.words.splice(n.words.length-2,2),n.currentWord=[e,t],n.mode="whitespace",r=!1}r&&(n.currentWord=[],n.mode="character")}else t.isWord(h)?n.currentWord.push(h):o(n,h,"character")}}return 0!==n.currentWord.length&&n.words.push(n.currentWord.join("")),n.words})});