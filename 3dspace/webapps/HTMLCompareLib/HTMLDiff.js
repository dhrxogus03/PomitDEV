define("DS/HTMLCompareLib/HTMLDiff",["require","exports","./Match","./MatchFinder","./Utils","./WordSplitter"],function(n,e,t,l,r,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=new Map([["</strong>",0],["</em>",0],["</b>",0],["</i>",0],["</big>",0],["</small>",0],["</u>",0],["</sub>",0],["</strike>",0],["</s>",0],["</dfn>",0]]),d=/<((strong)|(b)|(i)|(dfn)|(em)|(big)|(small)|(u)|(sub)|(sup)|(strike)|(s))[>\s]+/gi,o=(n,e,t)=>{return{oldWords:s.convertHtmlToListOfWords(n,t),newWords:s.convertHtmlToListOfWords(e,t)}},a=(n,e,t,l)=>{switch(n.action){case"equal":return f(n,t);case"delete":return I(n,"diffdel",e,l);case"insert":return u(n,"diffins",t,l);case"replace":return c(n,e,t,l);case"none":default:return""}},c=(n,e,t,l)=>{return`${I(n,"diffmod",e,l)}${u(n,"diffmod",t,l)}`},u=(n,e,t,l)=>{const r=t.filter((e,t)=>t>=n.startInNew&&t<n.endInNew);return h("ins",e,r,l)},I=(n,e,t,l)=>{const r=t.filter((e,t)=>t>=n.startInOld&&t<n.endInOld);return h("del",e,r,l)},f=(n,e)=>{return e.filter((e,t)=>t>=n.startInNew&&t<n.endInNew).join("")},h=(n,e,t,l)=>{const s=[];for(;t.length;){const o=p(t,n=>!r.isTag(n));let a="",c=!1;if(0!==o.length){const t=r.wrapText(o.join(""),n,e);s.push(t)}else{if(d.test(t[0])){const e=t[0].match(d);if(null!==e){const n="<"+e[0].replace(/(<|>| )/g,"")+">";l.push(n)}if(a='<ins class="mod">',"del"===n)for(t.shift();t.length>0&&d.test(t[0]);)t.shift()}else if(i.has(t[0])){const e=0===l.length?null:l.pop();if(null!==e&&e===t[t.length-1].replace(/\//g,"")&&(a="</ins>",c=!0),"del"===n)for(t.shift();t.length>0&&i.has(t[0]);)t.shift()}if(0===t.length&&0===a.length)break;c?s.push(a+p(t,r.isTag).join("")):s.push(p(t,r.isTag).join("")+a)}}return s.join("")},p=(n,e)=>{let t=0,l=!1;for(let r=0;r<n.length;r++){const s=n[r];if(0===r&&" "===s&&(n[r]="&nbsp;"),!e(s)){t=r,l=!0;break}}if(l){const e=n.filter((n,e)=>e>=0&&e<t);return t>0&&n.splice(0,t),e}{const e=n.filter((e,t)=>t>=0&&t<n.length);return n.splice(0,n.length),e}},w=(n,e,t,l,r,s,i)=>{let d=0,o=0;const a=[],c=n.length,u=e.length,I=O(n,e,r,s,i);I.push({startInOld:c,startInNew:u,endInOld:c,endInNew:u,size:0});const f=g(I,n,e,l);for(const n of f){if(null===n)continue;const e=d===n.startInOld,t=o===n.startInNew;let l;"none"!==(l=e||t?e&&!t?"insert":e?"none":"delete":"replace")&&a.push({action:l,startInOld:d,endInOld:n.startInOld,startInNew:o,endInNew:n.startInNew}),0!==n.size&&a.push({action:"equal",startInOld:n.startInOld,endInOld:n.endInOld,startInNew:n.startInNew,endInNew:n.endInNew}),d=n.endInOld,o=n.endInNew}return t?N(a,n,e):a},N=(n,e,t)=>{const l=[],s=n=>r.isWhiteSpace(e.filter((e,t)=>t>=n.startInOld&&t<n.endInOld).join(""))&&r.isWhiteSpace(t.filter((e,t)=>t>=n.startInNew&&t<n.endInNew).join("")),i=n[n.length-1];for(let e=0;e<n.length;e++){const t=n[e];if("replace"===t.action){let r=!1;for(let i=e+1;i<n.length;i++){const d=n[i];if("replace"!==d.action&&"equal"===d.action&&!s(d)){l.push({action:"replace",startInOld:t.startInOld,endInOld:d.startInOld,startInNew:t.startInNew,endInNew:d.startInNew}),e=i-1,r=!0;break}}if(!r){l.push({action:"replace",startInOld:t.startInOld,endInOld:i.endInOld,startInNew:t.startInNew,endInNew:i.endInNew});break}}else l.push(t)}return l},g=(n,e,l,r)=>{const s=[];let i={...t.NoMatch},d=null;for(const o of n){if(null===d){i={...t.NoMatch},d=o;continue}if(i.endInOld===d.startInOld&&i.endInNew===d.startInNew||d.endInOld===o.startInOld&&d.endInNew===o.startInNew){s.push(d),i=d,d=o;continue}const n=(n,e)=>n+e.length,a=e.slice(i.endInOld,o.startInOld).reduce(n,0),c=l.slice(i.endInNew,o.startInNew).reduce(n,0);l.slice(d.startInNew,d.endInNew).reduce(n,0)>Math.max(a,c)*r&&s.push(d),i=d,d=o}return null!==d&&s.push(d),s},O=(n,e,t,l,r)=>m(0,n.length,0,e.length,n,e,t,l,r),m=(n,e,t,l,r,s,i,d,o)=>{if(n>=e||t>=l)return[];const a=b(n,e,t,l,r,s,i,d,o);return null===a?[]:[...m(n,a.startInOld,t,a.startInNew,r,s,i,d,o),a,...m(a.endInOld,e,a.endInNew,l,r,s,i,d,o)]},b=(n,e,t,r,s,i,d,o,a)=>{for(let c=d;c>0;c--){const d={blockSize:c,repeatingWordsAccuracy:o,ignoreWhiteSpaceDifferences:a},u=(0,l.findMatch)(s,i,n,e,t,r,d);if(null!==u)return u}return null};e.default=((n,e,t)=>((n,e,t)=>{var l,r,s,i,d;if(n===e)return e;const{oldWords:c,newWords:u}=o(n,e,[]),I=Math.min(null!==(l=null==t?void 0:t.matchGranularity)&&void 0!==l?l:4,c.length,u.length),f=w(c,u,null!==(r=null==t?void 0:t.combineWords)&&void 0!==r&&r,null!==(s=null==t?void 0:t.orphanMatchThreshold)&&void 0!==s?s:0,I,null!==(i=null==t?void 0:t.repeatingWordsAccuracy)&&void 0!==i?i:1,null!==(d=null==t?void 0:t.ignoreWhiteSpaceDifferences)&&void 0!==d&&d),h=[];return f.map(n=>a(n,c,u,h)).join("")})(n,e,t))});