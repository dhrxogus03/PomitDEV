define("DS/CAT3DExpMaterialWeb/XCTMaterialHelper",["DS/CAT3DExpModel/interfaces/CATI3DExperienceObject","DS/RenderingMaterialOverrides/ApplyJOP","DS/Visualization/ThreeJS_DS","DS/RenderingMaterialLib/VisuConversionHelpers"],function(e,a,t,r){"use strict";return{applyJop:function(e,t,r,i){t.material_appearance.reference_material_parameters=t.material_appearance.reference_material_parameters?t.material_appearance.reference_material_parameters:[],t.material_appearance.applied_material_parameters=t.material_appearance.applied_material_parameters?t.material_appearance.applied_material_parameters:[],"true"===localStorage.getItem("EWS_ApplyJop")?this._ewsApplyJop(e,t,r,i):a.OverloadVisuMaterialWithJOP(e,t,r)},getJOPDefinition:function(e,a){return{name:e,parameterID:e,type:this._getMaterialVariableType(e,a),value:this._getMaterialVariableValue(e,a)}},isVariableTextured:function(e,a){const t=r.GetVisParamDesc(a);if(!t)return!1;const i=t.id;return e.isPropertyTextured(i)},_getMaterialVariableType:function(a,t){const r=t.QueryInterface("CATI3DExperienceObject");switch(r.GetVariableType(a)){case e.VarType.Integer:return"CATRmaInteger";case e.VarType.Double:return"CATRmaScalar";case e.VarType.String:return"CATRmaString";case e.VarType.Boolean:return"CATRmaBoolean";case e.VarType.Color:return"CATRmaColor"}const i=r.GetValueByName(a);if(i)switch(i.GetType()){case"Color_Spec":return"CATRmaColor";case"Vector3D_Spec":return"CATRmaVector"}},_getMaterialVariableValue:function(a,t){const r=t.QueryInterface("CATI3DExperienceObject");if(1!==r.GetVariableMaxNumberOfValues(a))return;const i=r.GetVariableType(a),s=r.GetValueByName(a);if(void 0===s)return;switch(i){case e.VarType.Integer:case e.VarType.Double:case e.VarType.String:case e.VarType.Boolean:return s;case e.VarType.Color:return s.GetRGBA()}const n=s.QueryInterface("CATI3DExperienceObject");switch(s.GetType()){case"Color_Spec":return[n.GetValueByName("r")/255,n.GetValueByName("g")/255,n.GetValueByName("b")/255,n.GetValueByName("a")/255];case"Vector3D_Spec":return[n.GetValueByName("x"),n.GetValueByName("y"),n.GetValueByName("z")]}},_ewsApplyJop:function(e,a,r,i){const s=a.material_appearance.reference_material_parameters,n=this._getParameterByName(s,"repeat_u")?this._getParameterValueByName(s,"repeat_u"):this._getParameterValueByName(s,"repeatU"),l=this._getParameterByName(s,"repeat_v")?this._getParameterValueByName(s,"repeat_v"):this._getParameterValueByName(s,"repeatV");for(let r in this._textureMapList)e[r]&&(e[r].flipY=!0,e[this._textureMapList[r]]=this._getMappingMatrix(e[r],r,a,i),e[r].wrapS=n?t.RepeatWrapping:t.ClampToEdgeWrapping,e[r].wrapT=l?t.RepeatWrapping:t.ClampToEdgeWrapping,e[r].needsUpdate=!0);const o=this._getParameterValueByName(s,"type");void 0!==this._mappingOperatorMap[o]&&e.setMappingOperator(this._mappingOperatorMap[o])},_mappingOperatorMap:{0:1,1:2,2:4,3:3,6:-1,8:5},_textureMapList:{map:"diffuseUvTransform",specularMap:"specularUvTransform",metalnessMap:"metalnessUvTransform",specularContribMap:"specularContribUvTransform",emissionColorMap:"emissionColorUvTransform",transparencyMap:"transparencyUvTransform",opacityMap:"opacityUvTransform",roughnessMap:"roughnessUvTransform",displacementfMap:"displacementfUvTransform",anisotropyMap:"anisotropyUvTransform",anisotropyAngleMap:"anisotropyAngleUvTransform",sheenMap:"sheenUvTransform",clearCoatMap:"clearCoatUvTransform",clearCoatRoughnessMap:"clearCoatRoughnessUvTransform",clearCoatNormalMap:"clearCoatNormalUvTransform",normalMap:"normalUvTransform",flakesSizeMap:"flakesSizeUvTransform",flakesCoverageMap:"flakesCoverageUvTransform",flakesRoughnessMap:"flakesRoughnessUvTransform",flakesColorMap:"flakesColorUvTransform"},_getMappingMatrix:function(e,a,r,i){const s=r.material_appearance.reference_material_parameters,n=r.material_appearance.applied_material_parameters;let l=this._getParameterValueByName(s,"angle"),o=this._getParameterByName(s,"scale_u")?this._getParameterValueByName(s,"scale_u"):this._getParameterValueByName(s,"scaleU"),p=this._getParameterByName(s,"scale_v")?this._getParameterValueByName(s,"scale_v"):this._getParameterValueByName(s,"scaleV"),m=this._getParameterByName(s,"offset_u")?this._getParameterValueByName(s,"offset_u"):this._getParameterValueByName(s,"offsetU"),c=this._getParameterByName(s,"offset_v")?this._getParameterValueByName(s,"offset_v"):this._getParameterValueByName(s,"offsetV"),u=this._getParameterByName(s,"flip_u")?this._getParameterValueByName(s,"flip_u"):this._getParameterValueByName(s,"flipU"),_=this._getParameterByName(s,"flip_v")?this._getParameterValueByName(s,"flip_v"):this._getParameterValueByName(s,"flipV");if(this._getParameterByName(n,"Offset_U")){m+=this._getParameterValueByName(n,"Offset_U")}if(this._getParameterByName(n,"Offset_V")){c+=this._getParameterValueByName(n,"Offset_V")}if(this._getParameterByName(n,"Scale")){let e=this._getParameterValueByName(n,"Scale");o*=e,p*=e}if(this._getParameterByName(n,"Scale_Ratio")){p/=this._getParameterValueByName(n,"Scale_Ratio")}if(this._getParameterByName(n,"Angle")){l+=this._getParameterValueByName(n,"Angle")}if(!this._getParameterByName(s,"mappingFocus")||this._getParameterValueByName(s,!1)){let t,r;e.image.width&&e.image.height&&(t=.277999997*e.image.width,r=.277999997*e.image.height);let s="";var f=i.QueryInterface("CATI3DExperienceObject").GetValueByName("appearance");if(f&&f.QueryInterface("CATI3DExperienceObject")&&(s=f.QueryInterface("CATI3DExperienceObject").GetValueByName("apperance_preset")),s.includes("3DS PBR")){var g=i.QueryInterface("CATI3DXMaterialAsset").getTextureSize(a);g&&(t=g.width,r=g.height),c+=.5,m+=.5}t&&r&&(o*=t,p*=r)}var M=Math.cos(-l),h=Math.sin(-l),y=-h,C=M,T=new t.Matrix3;T.elements[0]=M,T.elements[1]=h,T.elements[3]=y,T.elements[4]=C,M=o,h=0,y=0,C=p;var A=new t.Matrix3;A.elements[0]=M,A.elements[1]=h,A.elements[3]=y,A.elements[4]=C,M=u?-1:1,h=0,y=0,C=_?-1:1;var V=new t.Matrix3;V.elements[0]=M,V.elements[1]=h,V.elements[3]=y,V.elements[4]=C;var P=new t.Matrix3;return(P=(P=P.multiplyMatrices(P,this._getInverseMatrix3(A))).multiplyMatrices(P,this._getInverseMatrix3(V))).elements[6]=P.elements[6]+m,P.elements[7]=P.elements[7]+c,P=P.multiplyMatrices(P,this._getInverseMatrix3(T))},_getInverseMatrix3:function(e){var a=e.elements,r=new t.Matrix4(a[0],a[3],a[6],0,a[1],a[4],a[7],0,a[2],a[5],a[8],0,0,0,0,1),i=new t.Matrix3;return i.getInverse(r),i},_getParameterByName:function(e,a){const t=e.findIndex(e=>e.name===a);if(t>=0)return e[t]},_getParameterValueByName:function(e,a){const t=this._getParameterByName(e,a);if(t)return t.value}}}),define("DS/CAT3DExpMaterialWeb/interfaces/CATI3DXMaterialApplicationVisu",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(e,a){"use strict";return a.singleton({interfaceName:"CATI3DXMaterialApplicationVisu",required:{initializeMaterialApplicationVisu:async function(){}},optional:{}})}),define("DS/CAT3DExpMaterialWeb/extensions/CATE3DXMaterialAsset",["UWA/Core","UWA/Class","UWA/Class/Listener","UWA/Class/Events"],function(e,a,t,r){"use strict";return a.extend(t,r,{init:function(){},Build:function(){this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"ASSET_CHANGED",()=>{this._clearMaterial(),this.dispatchEvent("MATERIAL_CHANGED")})},Dispose:function(){this._clearMaterial()},_clearMaterial:function(){delete this._material,delete this._materialPromise},getMaterial:function(){return this._material?e.Promise.resolve(this._material):this._materialPromise?this._materialPromise:(this._materialPromise=this.QueryInterface("CATI3DXAssetHolder")._resolveAsset().then(e=>this._getMaterialFromAsset(e)).then(e=>(this._material=e,delete this._materialPromise,this._material)).catch(a=>(delete this._materialPromise,e.Promise.reject(a))),this._materialPromise)},_getMaterialFromAsset:function(){return e.Promise.reject(new Error("CATE3DXMaterialAsset._getMaterialFromAsset : Must be implemented by derived class"))},getMaterialParameters:function(){const e=this.QueryInterface("CATI3DXAssetHolder")._getCache();if(e)return e.material_extra_parameters},getTextureSize:function(e){const a=this.QueryInterface("CATI3DXAssetHolder")._getCache();if(!a)return;const t=a.material_extra_parameters;let r;switch(t?t.version:1){case 1:if(r=this._webVisuToPBRCacheMapV1[e],a[e]&&a[e].texture_size)return{width:a[e].texture_size[0],height:a[e].texture_size[1]};break;case 2:if(r=this._webVisuToPBRCacheMapV2[e],t&&t.mapping_parameters&&t.mapping_parameters.parameters&&t.mapping_parameters.parameters[r]&&t.mapping_parameters.parameters[r].texture_size)return{width:t.mapping_parameters.parameters[r].texture_size[0],height:t.mapping_parameters.parameters[r].texture_size[1]}}},_webVisuToPBRCacheMapV1:{map:"albedo",specularMap:"specularTint",emissionColorMap:"emissionColor",roughnessMap:"roughness",anisotropyMap:"anisotropy",anisotropyAngleMap:"anisotropyRotation",metalnessMap:"metallic",specularContribMap:"specular",transparencyMap:"transparency",clearCoatRoughnessMap:"clearcoatRoughness",opacityMap:"cutoutOpacity",normalMap:"normal",clearCoatNormalMap:"clearcoatNormal"},_webVisuToPBRCacheMapV2:{map:"Albedo",specularMap:"Specular_Tint",emissionColorMap:"Emission_Color",roughnessMap:"Roughness",anisotropyMap:"Anisotropy",anisotropyAngleMap:"AnisotropyRotation",metalnessMap:"Metallic",specularContribMap:"Specular",transparencyMap:"Transparency",clearCoatRoughnessMap:"Clearcoat_Roughness",opacityMap:"Cutout_Opacity",clearCoatNormalMap:"Clearcoat"}})}),define("DS/CAT3DExpMaterialWeb/interfaces/CATI3DXMaterialAsset",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(e,a){"use strict";return a.singleton({interfaceName:"CATI3DXMaterialAsset",required:{getMaterial:function(){},getMaterialParameters:function(){},getTextureSize:function(){}},optional:{}})}),define("DS/CAT3DExpMaterialWeb/extensions/CATE3DXMaterialApplicationAsset",["UWA/Class"],function(e){"use strict";return e.extend({getMaterialApplicationParameters:function(){const e=this.QueryInterface("CATI3DXAssetHolder")._getCache();if(e)return e.material_extra_parameters}})}),define("DS/CAT3DExpMaterialWeb/interfaces/CATI3DXMaterialVisu",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(e,a){"use strict";return a.singleton({interfaceName:"CATI3DXMaterialVisu",required:{isMIACMaterial:function(){},initializeMIACVisu:async function(){},disposeMIACVisu:async function(){},isMiacVisuInitialized:function(){},getReferenceMaterialParameters:function(){},getCacheReferenceMaterialParameters:function(){},getMaterialVisu:function(){},isVariableTextured:function(){}},optional:{}})}),define("DS/CAT3DExpMaterialWeb/interfaces/CATI3DXMaterialApplicationAsset",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(e,a){"use strict";return a.singleton({interfaceName:"CATI3DXMaterialApplicationAsset",required:{getMaterialApplicationParameters:function(){}}})});