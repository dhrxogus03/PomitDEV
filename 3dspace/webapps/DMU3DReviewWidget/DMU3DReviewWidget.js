/*!  Copyright 2015 Dassault Systemes. All rights reserved. */
define("DS/DMU3DReviewWidget/DMU3DReviewWidgetOptions",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Utils"],function(e,t,i,n){"use strict";return t.singleton(i,{init:function(){var t={};""!==window.location.search&&(e.extend(t,n.parseQuery(window.location.search)),t.widgetDomain&&e.extend(t,n.parseQuery(t.widgetDomain))),("debug_me"in t||window.debug)&&(t.debug=!0),("testWkb"in t||window.testWkb||window.widget&&window.widget.data&&window.widget.data.moduleUrl&&window.widget.data.moduleUrl.includes("testWkb"))&&(t.testWkb=!0),("resultFTAUI"in t||window.resultFTAUI)&&(t.resultFTAUI=!0),("pdfReview"in t||window.pdfReview)&&(t.pdfReview=!0),("testMbom"in t||window.testMbom)&&(t.testMbom=!0),this.setOptions(t)}})}),define("DS/DMU3DReviewWidget/DMU3DReviewWidgetDefaultCmdV2",["DS/DMU3DReviewController/DMU3DReviewController","DS/PADUtils/PADContext"],function(e,t){"use strict";return class{constructor(){this.beginExecute=function(){var i=e.give3DReviewController({context:t.get()});i&&i.enableDMUContextualBar()},this.destroy=function(){var i=e.give3DReviewController({context:t.get()});i&&i.disableDMUContextualBar()}}}}),
/*!  Copyright 2015 Dassault Systemes. All rights reserved. */
define("DS/DMU3DReviewWidget/DMU3DReviewAppInit",["DS/WAfrContainer/App","DS/DMUBaseExperience/DMUContextManager","UWA/Core","DS/Controls/Loader","DS/DMUMeasurable/DMUToolsSceneGraph","i18n!DS/DMU3DReviewWidget/assets/nls/DMU3DReviewWidget"],function(e,t,i,n,o,a){"use strict";var r,s,l,d;return e.extend({setUp:function(e){var t=this;if(window.widget.getValue("X3DContentId")&&!e.sourceApp){var o="",c=JSON.parse(window.widget.getValue("X3DContentId"));c.data&&c.data.items&&c.data.items[0]&&c.data.items[0].displayName&&(o=c.data.items[0].displayName);var p=i.createElement("div",{class:"DMULoadingPanel"}).inject(document.body);(d=new n({text:a.loadingMessage+" "+o}).inject(p)).on(),d.getContent().addClassName("DMULoadingPanelInfoDiv");var u=d.elements.label.getSize().width,w=d.elements.progressBar.getContent().getSize().width,g=d.elements.progressBar.getContent().getSize().height,D=u+w;p.setStyles({position:"absolute",bottom:"0",left:"0","z-index":"40000","background-color":"rgba(255,255,255,1",height:"100%",width:"100%"}),d.getContent().setStyles({position:"absolute",left:"calc(50% - "+D/2+"px)",top:"calc(50% - "+g/2+"px)"})}e.sourceApp?e.sourceApp.pad3DViewer?(l=e.sourceApp.pad3DViewer,this.pad3DViewer=e.sourceApp.pad3DViewer,this.appMainDiv=e.sourceApp.appMainDiv,new Promise(function(t){r?t():require(["DS/DMU3DReviewWidget/DMU3DReviewWidgetMain"],function(i){r=new i({widget:window.widget,pad3DViewer:e.sourceApp.pad3DViewer,appMainDiv:e.sourceApp.appMainDiv}),t()})}).then(function(){e.sourceApp&&!e.sourceApp.isDisposeCalled()&&e.sourceApp.dispose();var i=e.done;e.done=function(n){var o;t.appMainDiv||(t.appMainDiv=n.appMainDiv),e.done=i,"ENX3DIR_AP"===e.sourceApp.options.id&&((o=t).switchApp&&require(["DS/CATWebUXComponents/CATWebUXInfoFlag","DS/CATWebUXSlideShow/CATWebUXSlideShowController","i18n!DS/DMU3DReviewWidget/assets/nls/DMU3DReviewWidget"],function(e,t,i){var n=new e({frameWindow:o.pad3DViewer.getFrameWindow(),viewer:o.pad3DViewer.getViewer(),dockingSide:"left"});n.display({label:i.backToIssue,style:"webUXStyle",fontIcon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-move-to-start",onClickCB:function(){s(),s=null,o.switchApp("ENX3DIR_AP")}});var a,r=t.getSlideShowController({context:o.pad3DViewer.getFrameWindow(),id:"DMU3DMarkupSlideShow"});r&&(a=r.subscribe("onActiveStateModified",function(e){n.setVisibleFlag(!e.state)})),s=function(){n.clean();var e=t.giveSlideShowController({context:o.pad3DViewer.getFrameWindow(),id:"DMU3DMarkupSlideShow"});e&&e.unsubscribe(a)}})),e.done()},r.setUp(e)})):e.done():require(["DS/DMU3DReviewWidget/DMU3DReviewWidgetMain"],function(i){r=new i({widget:window.widget,viewerAttachment:e.done,done:function(e){l=e.pad3DViewer,t.pad3DViewer=e.pad3DViewer,t.appMainDiv=e.appMainDiv}})})},dispose:function(e){var i=t.getReviewContext({context:this.pad3DViewer});if(e&&i&&i.getCurrentSessionMarkup())e.preferredType="Markup";else if(e&&this.pad3DViewer.getApplicativeData().getLoadedItfData&&this.pad3DViewer.getApplicativeData().getLoadedItfData().data.length)e.preferredType="SIMItfSimulation";else if(e){var n=o.getRoots(l);let t=1===n.length?o.getNodeType(n[0]):null;"Requirement"!==t&&"Requirement Specification"!==t&&"DesignSight"!==t||(e.preferredType=t)}s&&s(),s=null,r&&r.dispose&&r.dispose(e);var a=window.document.getElementsByClassName("DMULoadingPanel");d&&(d.destroy(),d=null),a.length&&a[0].destroy(),this._parent(e)},onWillEnter:function(e){return r&&r.onWillEnter&&r.onWillEnter(e),require(["DS/DMUBaseExperience/EXPUtils","DS/DMU3DReviewController/DMU3DReviewController","DS/PADUtils/PADSettingsMgt"],function(t,i,n){n.setSetting("enopad3dviewer_staticMappingSupportActivated",!0);var o=i.get3DReviewController({context:e.pad3DViewer});("string"==typeof e&&"X3DPLAW_AP"===e||e.options&&"X3DPLAW_AP"===e.options.id)&&o.setappTransition(!0),t._sendUsageProbe("appTransitionFrom",e.options.id,"resolved")}),this._parent(e)},onWillLeave:function(e){var i=o.getRoots(l),n=["Document","DIFLayout","DIFSheet"];["X3DPLAW_AP","ENOR3R_AP","ENOR3V_AP","ENOR3D_AP"].indexOf(e.options.id)<0&&n.push("DesignSight");for(var a=0;a<i.length;a++)if(-1!==n.indexOf(o.getNodeType(i[a]))){var s=o.getNodeID(i[a]);t.getReviewContext({context:this.pad3DViewer})&&t.getReviewContext({context:this.pad3DViewer}).getCurrentSessionMarkup()||l.removeRoots({pids:[s]})}return require(["DS/CATWebUXPreferences/CATWebUXPreferencesManager"],function(i){var n=i.getPreferenceManager({context:l.getFrameWindow()});if(n&&("CATC3D_AP"===e.options.id||"CATA3I_AP"===e.options.id||"ENOI3D_AP"===e.options.id)){n.removeAllPreferences();let i=t.getReviewContext({context:l});"CATA3I_AP"===e.options.id&&i&&i.getCurrentSessionMarkup()&&i.getCurrentSessionMarkup().setActiveFlag(!1)}}),r&&r.onWillLeave&&r.onWillLeave(e),require(["DS/DMUBaseExperience/EXPUtils"],function(t){t._sendUsageProbe("appTransitionTo",e.options.id,"resolved")}),this._parent(e)}})}),
/*!  Copyright 2015 Dassault Systemes. All rights reserved. */
define("DS/DMU3DReviewWidget/ENOR3DAppInit",["DS/WAfrContainer/App","DS/DMUBaseExperience/DMUContextManager","UWA/Core","DS/Controls/Loader","DS/DMUMeasurable/DMUToolsSceneGraph","i18n!DS/DMU3DReviewWidget/assets/nls/DMU3DReviewWidget"],function(e,t,i,n,o,a){"use strict";var r,s,l,d;return e.extend({setUp:function(e){if(e.sourceApp&&this.options.id===e.sourceApp.options.id)return Promise.resolve();var t=this;if(window.widget.getValue("X3DContentId")&&!e.sourceApp){var o="",c=JSON.parse(window.widget.getValue("X3DContentId"));c.data&&c.data.items&&c.data.items[0]&&c.data.items[0].displayName&&(o=c.data.items[0].displayName);var p=i.createElement("div",{class:"DMULoadingPanel"}).inject(document.body);(d=new n({text:a.loadingMessage+" "+o}).inject(p)).on(),d.getContent().addClassName("DMULoadingPanelInfoDiv");var u=d.elements.label.getSize().width,w=d.elements.progressBar.getContent().getSize().width,g=d.elements.progressBar.getContent().getSize().height,D=u+w;p.setStyles({position:"absolute",bottom:"0",left:"0","z-index":"40000","background-color":"rgba(255,255,255,1",height:"100%",width:"100%"}),d.getContent().setStyles({position:"absolute",left:"calc(50% - "+D/2+"px)",top:"calc(50% - "+g/2+"px)"})}return e.sourceApp?e.sourceApp.pad3DViewer?(l=e.sourceApp.pad3DViewer,this.pad3DViewer=e.sourceApp.pad3DViewer,this.appMainDiv=e.sourceApp.appMainDiv,new Promise(function(i){r?(e.done&&e.done(),i()):require(["DS/DMU3DReviewWidget/ENOR3DWidgetMain"],function(n){r=new n({widget:window.widget,pad3DViewer:t.getExecutionContext?t.getExecutionContext().getComponent("Viewer"):e.sourceApp.pad3DViewer,executionContext:t.getExecutionContext(),appMainDiv:e.sourceApp.appMainDiv}),e.done&&e.done(),i()})}).then(function(){e.sourceApp&&!e.sourceApp.isDisposeCalled()&&e.sourceApp.dispose();var i=e.done;e.done=function(n){var o;t.appMainDiv||(t.appMainDiv=n.appMainDiv),e.done=i,"ENX3DIR_AP"===e.sourceApp.options.id&&((o=t).switchApp&&require(["DS/CATWebUXComponents/CATWebUXInfoFlag","DS/CATWebUXSlideShow/CATWebUXSlideShowController","i18n!DS/DMU3DReviewWidget/assets/nls/DMU3DReviewWidget"],function(e,t,i){var n=new e({frameWindow:o.pad3DViewer.getFrameWindow(),viewer:o.pad3DViewer.getViewer(),dockingSide:"left"});n.display({label:i.backToIssue,style:"webUXStyle",fontIcon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-move-to-start",onClickCB:function(){s(),s=null,o.switchApp("ENX3DIR_AP")}});var a,r=t.getSlideShowController({context:o.pad3DViewer.getFrameWindow(),id:"DMU3DMarkupSlideShow"});r&&(a=r.subscribe("onActiveStateModified",function(e){n.setVisibleFlag(!e.state)})),s=function(){n.clean();var e=t.giveSlideShowController({context:o.pad3DViewer.getFrameWindow(),id:"DMU3DMarkupSlideShow"});e&&e.unsubscribe(a)}})),e.done()},r.setUp(e)})):void e.done():new Promise(i=>{require(["DS/DMU3DReviewWidget/ENOR3DWidgetMain"],function(i){r=new i({widget:window.widget,viewer:t.getExecutionContext().getComponent("Viewer"),executionContext:t.getExecutionContext(),viewerAttachment:e.done,done:function(e){l=e.pad3DViewer,t.pad3DViewer=e.pad3DViewer,t.appMainDiv=e.appMainDiv}})}),e.done&&e.done(),i()})},dispose:function(e){if(l&&l.getExecutionContext){let e=l.getExecutionContext(),t=e.getSourceApp(),i=e.getTargetApp();if(t.options.id===i.options.id)return}var i=t.getReviewContext({context:this.pad3DViewer});if(e&&i&&i.getCurrentSessionMarkup())e.preferredType="Markup";else if(e&&this.pad3DViewer.getApplicativeData().getLoadedItfData&&this.pad3DViewer.getApplicativeData().getLoadedItfData().data.length)e.preferredType="SIMItfSimulation";else if(e){var n=o.getRoots(l);let t=1===n.length?o.getNodeType(n[0]):null;"Requirement"!==t&&"Requirement Specification"!==t&&"DesignSight"!==t||(e.preferredType=t)}s&&s(),s=null,r&&r.dispose&&r.dispose(e);var a=window.document.getElementsByClassName("DMULoadingPanel");d&&(d.destroy(),d=null),a.length&&a[0].destroy(),this._parent(e)},onWillEnter:function(e){return this.options.id===e.options.id?Promise.resolve():(r&&r.onWillEnter&&r.onWillEnter(e),require(["DS/DMUBaseExperience/EXPUtils","DS/DMU3DReviewController/DMU3DReviewController","DS/PADUtils/PADSettingsMgt"],function(t,i,n){n.setSetting("enopad3dviewer_staticMappingSupportActivated",!0);var o=i.get3DReviewController({context:e.pad3DViewer});("string"==typeof e&&"X3DPLAW_AP"===e||e.options&&"X3DPLAW_AP"===e.options.id)&&o.setappTransition(!0),t._sendUsageProbe("appTransitionFrom",e.options.id,"resolved")}),this._parent(e))},onWillLeave:function(e){if(this.options.id===e.options.id)return Promise.resolve();var i=o.getRoots(l),n=["Document","DIFLayout","DIFSheet"];["X3DPLAW_AP","ENOR3R_AP","ENOR3V_AP","ENOR3D_AP"].indexOf(e.options.id)<0&&n.push("DesignSight");for(var a=0;a<i.length;a++)if(-1!==n.indexOf(o.getNodeType(i[a]))){var s=o.getNodeID(i[a]);t.getReviewContext({context:this.pad3DViewer})&&t.getReviewContext({context:this.pad3DViewer}).getCurrentSessionMarkup()||l.removeRoots({pids:[s]})}return require(["DS/CATWebUXPreferences/CATWebUXPreferencesManager"],function(i){var n=i.getPreferenceManager({context:l.getFrameWindow()});if(n&&("CATC3D_AP"===e.options.id||"CATA3I_AP"===e.options.id||"ENOI3D_AP"===e.options.id)){n.removeAllPreferences();let i=t.getReviewContext({context:l});"CATA3I_AP"===e.options.id&&i&&i.getCurrentSessionMarkup()&&i.getCurrentSessionMarkup().setActiveFlag(!1)}}),r&&r.onWillLeave&&r.onWillLeave(e),require(["DS/DMUBaseExperience/EXPUtils"],function(t){t._sendUsageProbe("appTransitionTo",e.options.id,"resolved")}),this._parent(e)}})}),define("DS/DMU3DReviewWidget/DMU3DReviewWidgetDefaultCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMU3DReviewController/DMU3DReviewController","DS/PADUtils/PADContext"],function(e,t,i){"use strict";return e.extend({init:function(e){var n=e||{};this._parent(n,{mode:"exclusive",isAsynchronous:!0}),this.beginExecute=function(){var e=t.give3DReviewController({context:i.get()});e&&e.enableDMUContextualBar()},this.endExecute=function(){var e=t.give3DReviewController({context:i.get()});e&&e.disableDMUContextualBar()}}})}),define("DS/DMU3DReviewWidget/DMU3DReviewWidgetMain",["UWA/Core","DS/DMUControls/EXPNotify","DS/DMUBaseUI/DMUReviewDnDComponent","DS/DMU3DReviewWidget/DMU3DReviewWidgetOptions","DS/PADUtils/PADSettingsMgt","DS/DMUMeasurable/DMUToolsSceneGraph","DS/CATWebUXComponents/DMUCommandsManager","DS/PADServices/views/LandingPage","DS/PADServices/utils/GlobalModelEvents","DS/EditPropWidget/constants/ConstantsMapping","DS/DMUReadPersistence/DMUWebServicesUtils","DS/CATWebUXComponents/DMUFrameWindow","DS/DMUReadPersistence/DMULoadingContextController","i18n!DS/DMU3DReviewWidget/assets/nls/DMU3DReviewWidget"],function(e,t,i,n,o,a,r,s,l,d,c,p,u,w){"use strict";let g;const D=[{key:"mkp",type:"Markup"},{key:"mku",type:"DMUMarkupRepReference"},{key:"isr",type:"SIMItfSimulation"},{key:"itf",type:"PLMPIMMetricReference"},{key:"difLayout",type:"DIFLayout"},{key:"difSheet",type:"DIFSheet"},{key:"difAnnotSet",type:"DIFAnnotationSet"},{key:"doc",type:"Document"},{key:"req",type:"Requirement"},{key:"reqSpec",type:"Requirement Specification"},{key:"msr",type:"DesignSight"},{key:"pointClouds",type:"R2V_FeatureState"}],m=["ds6w:label","ds6w:type","ds6wg:revision","ds6w:status","owner","ds6w:responsible","ds6w:modified","ds6w:project","ds6w:identifier"];function v(){var e=this.params.widget.getValue("xsceneStoredObjects");return e&&"string"==typeof e||(e='{"products":{},"filters":{}}'),JSON.parse(e)}function f(e){e&&e.length&&(this.showWelcomePanel(!1),this.pad3DViewer.addRootNodesFromContent({json3DXContent:{protocol:"3DXContent",version:"1.1",source:"X3DSEAR_AP",data:{items:e.map(function(e){return{envId:require("DS/PADUtils/PADUtilsServices").getPlatformId(),objectId:e.id,objectType:e.type,displayName:e.displayName}})}}}))}async function h(e){try{let t=await c.getParentTypes(e);return[e].concat(t)}catch{return[e]}}async function b(e){let i=!0;if(e.length>1)for(const t of e){let e=await h(t["ds6w:type"]);if(!e.includes("VPMReference")&&!e.includes("R2V_FeatureState")){i=!1;break}}var n,o,a;i?f.call(this,e.map(function(e){return{id:e.resourceid,type:e["ds6w:type_value"],displayName:e["ds6w:label"]}})):(n="warning",o=w.dropMultiNoAutorized,a=this.pad3DViewer,g&&(g.destroy(),g=null),g=new t({body:a.getFrameWindow().getUIFrame(),type:n,message:o}))}function S(e){if(e&&e.length){l.publish({event:"ENXViews/LandingPage/addOrRefresh",data:{objects:e.map(function(e){return{resourceid:e,openWithFilter:!1,loading:!0,fromCustom:!0}})}});var t=setInterval(function(){this.isAppReady&&this.welcomePanel&&(clearInterval(t),function(e,t){require("DS/WAFData/WAFData").authenticatedRequest(require("DS/PADUtils/PADUtilsServices").get3DSpaceUrl()+"/cvservlet/fetch/v2?tenant="+require("DS/PADUtils/PADUtilsServices").getPlatformId(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx")},data:JSON.stringify({physicalid:e,label:"M3DFetchForWelcomePanel"+Date.now(),select_predicate:m,select_file:["icon","thumbnail_2d"]}),onComplete:t,onFailure:function(){},onTimeout:function(){}})}(e,function(e){if(this.welcomePanel){var t=((e?JSON.parse(e):{}).results||[]).map(function(e){var t={},i=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),n=i.getRoots(this.pad3DViewer).map(function(e){return i.getNodeID(e)}),o=require("DS/DMUBaseExperience/DMUContextManager").getReviewContext({context:this.pad3DViewer}),a=o?o.getReviewCtxInformation():{};a&&a.reviewId&&n.push(a.reviewId),this.pad3DViewer.getApplicativeData().getLoadedItfData&&this.pad3DViewer.getApplicativeData().getLoadedItfData().data.forEach(function(e){n=n.concat(e.metricID.length?e.metricID:[e.isrID])}),e.attributes.forEach(function(e){t[e.name]=e.value});var r=t["ds6w:type"],s={resourceid:t.resourceid,label:t["ds6w:label"],serviceId:"R2V_FeatureState"===r?"r2vsurvey":void 0,icons:[t.type_icon_url],thumbnail:t.preview_url,grid:t,subLabel:t["ds6w:responsible"]+" | "+new Date(t["ds6w:modified"]).toLocaleString(),description:t["ds6w:identifier"],openWithFilter:!1,fromCustom:!0,loading:void 0,opened:n.indexOf(t.resourceid)>-1,item2Load:{}};return s.item2Load[s.resourceid]={},"SIMItfSimulation"!==r&&"Markup"!==r&&"DMUMarkupRepReference"!==r&&"PLMPIMMetricReference"!==r&&"DIFAnnotationSet"!==r||(s.addRemoveFromViewCtx=!0),s}.bind(this));l.publish({event:"ENXViews/LandingPage/addOrRefresh",data:{objects:t}})}}.bind(this)))}.bind(this),100)}}function y(e){this.isAppReady=!1,this.params=e,this.welcomePanel=this.pad3DViewer=null,this.tokensWelcomePanel=[],this.tokensPAD=[],this.tokensMkp=[],this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/LandingPage/refreshCustom"},S.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/LandingPage/openCustom"},function(e){var t=v.call(this),i=[];e.customitem2open.forEach(function(e){D.some(function(n){if(t[n.key]&&t[n.key][e])return i.push({id:e,type:n.type}),!0})}),f.call(this,i)}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/LandingPage/removeFromView"},function(e){if(e&&e.customitem2remove&&e.customitem2remove.length){var t=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),i=t.getRoots(this.pad3DViewer).map(function(e){return t.getNodeID(e)}),n=require("DS/DMUBaseExperience/DMUContextManager").getReviewContext({context:this.pad3DViewer}),o=n?n.getReviewCtxInformation():{},a=o?o.reviewId:null,r=[];this.pad3DViewer.getApplicativeData().getLoadedItfData&&(r=this.pad3DViewer.getApplicativeData().getLoadedItfData().data),this.pad3DViewer.getApplicativeData().removeDIFAnnotSetKeepPrd&&e.customitem2remove.forEach(e=>{this.pad3DViewer.getApplicativeData().removeDIFAnnotSetKeepPrd(e)}),e.customitem2remove.indexOf(a)>-1&&require("DS/DMUBaseExperience/DMUContextManager").removeReviewContext({context:this.pad3DViewer}),r.forEach(function(t){(t.metricID.length?t.metricID:[t.isrID]).some(function(i){if(e.customitem2remove.indexOf(i)>-1)return this.pad3DViewer.getApplicativeData().removeIsrKeepContext(t.isrID),!0},this)},this),i.forEach(function(t){e.customitem2remove.indexOf(t)>-1&&this.pad3DViewer.removeRoots({pids:[t]})},this)}}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/LandingPage/removeFromStore"},function(e){if(e&&e.customitem2remove&&e.customitem2remove.length){var t=v.call(this),i=[];e.customitem2remove.forEach(function(e){D.some(function(n){if(t[n.key]&&t[n.key][e]&&-1===i.indexOf(e))return i.push(e),delete t[n.key][e],!0})}),this.params.widget.setValue("xsceneStoredObjects",JSON.stringify(t)),l.publish({event:"ENXViews/LandingPage/removeFromView",data:{customitem2remove:i}})}}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelMkp"},function(){s.launchSearch({title:w.mkp,precondition:'flattenedtaxonomies:"types/Markup"OR flattenedtaxonomies:"types/DMUMarkupRepReference"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelIsr"},function(){s.launchSearch({title:w.isr,precondition:'flattenedtaxonomies:"types/SIMItfSimulation"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelItf"},function(){s.launchSearch({title:w.itf,precondition:'flattenedtaxonomies:"types/PLMPIMMetricReference"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDrw"},function(){s.launchSearch({title:w.drw,precondition:'flattenedtaxonomies:"types/Drawing"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDIFLayout"},function(){s.launchSearch({title:w.difLayout,precondition:'flattenedtaxonomies:"types/DIFLayout"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDIFSheet"},function(){s.launchSearch({title:w.difSheet,precondition:'flattenedtaxonomies:"types/DIFSheet"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDIFAnnotationSet"},function(){s.launchSearch({title:w.difAnnotSet,precondition:'flattenedtaxonomies:"types/DIFAnnotationSet"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDocument"},function(){s.launchSearch({title:w.doc,precondition:'flattenedtaxonomies:"types/Document"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelRequirement"},function(){s.launchSearch({title:w.req,precondition:'flattenedtaxonomies:"types/Requirement"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelRequirementSpec"},function(){s.launchSearch({title:w.reqSpec,precondition:'flattenedtaxonomies:"types/Requirement Specification"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelMsr"},function(){s.launchSearch({title:w.msr,precondition:'flattenedtaxonomies:"types/DesignSight"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomPanelPrefCmd"},function(){require(["DS/CATWebUXComponents/DMUCommandsManager","DS/CATWebUXPreferences/CATWebUXPreferencesManager"],function(e,t){let i=t.givePreferenceManager({context:this.pad3DViewer.getFrameWindow()});if(i)var n=i.subscribe("onPreferencesPanelDestroyed",function(){i.unsubscribe(n),this.showWelcomePanel(!0)}.bind(this));this.showWelcomePanel(!1),e&&e.getCommand("CATWebUXPreferencesHdr",this.pad3DViewer&&this.pad3DViewer.getCommandContext?this.pad3DViewer.getCommandContext():null).begin()}.bind(this))}.bind(this)));var t=s.getDefaultActivities();t.activities[0].section.actions.splice(2,0,{id:"welcomePanelMkp",title:w.mkp,icon:"app-3dmarkup"}),t.activities[0].section.actions.splice(5,0,{id:"welcomePanelDIFAnnotationSet",title:w.difAnnotSet,icon:"annotation"}),t.activities[0].section.actions.splice(6,0,{id:"welcomePanelIsr",title:w.isr,icon:"interference-simulation"}),t.activities[0].section.actions.splice(7,0,{id:"welcomePanelItf",title:w.itf,icon:"interference-metric"}),t.activities[0].section.actions.splice(8,0,{id:"welcomePanelMsr",title:w.msr,icon:"physics-simulation"}),t.activities[0].section.actions.splice(9,0,{id:"welcomePanelDrw",title:w.drw,icon:"drawing"}),t.activities[0].section.actions.splice(10,0,{id:"welcomePanelRequirementSpec",title:w.reqSpec,icon:"requirement-specification"}),t.activities[0].section.actions.splice(11,0,{id:"welcomePanelRequirement",title:w.req,icon:"requirement"}),t.activities[0].section.actions.splice(12,0,{id:"welcomePanelDIFLayout",title:w.difLayout,icon:"fl-diagrams"}),t.activities[0].section.actions.splice(13,0,{id:"welcomePanelDIFSheet",title:w.difSheet,icon:"fl-diagram"}),t.activities[0].section.actions.splice(14,0,{id:"welcomePanelDocument",title:w.doc,icon:"doc"}),t.activities.push({section:{id:"customizeAppSection",title:w.customApp,actions:[{id:"welcomPanelPrefCmd",title:w.prefs,icon:"cog"}]}}),this.welcomePanel=new s({widget:e.widget,readOnlyApp:!1,renderDiv:e.renderDiv,externalViewerMgt:!0,externalViewerMgtCB:function(e,t){!0!==t&&this.showWelcomePanel("viewer"!==e)}.bind(this),globalSearchPrecond:'flattenedtaxonomies:"types/Markup" OR flattenedtaxonomies:"types/SIMItfSimulation" OR flattenedtaxonomies:"types/PLMPIMMetricReference" OR flattenedtaxonomies:"types/DIFLayout" OR flattenedtaxonomies:"types/DIFSheet" OR flattenedtaxonomies:"types/DIFAnnotationSet" OR flattenedtaxonomies:"types/VPMReference" OR flattenedtaxonomies:"types/VPMRepReference" OR flattenedtaxonomies:"types/ENOStrRefinementSpecification" OR flattenedtaxonomies:"types/Document" OR flattenedtaxonomies:"types/Requirement" OR flattenedtaxonomies:"types/Requirement Specification" OR flattenedtaxonomies:"types/DesignSight"',defaultActionId:t.defaultActionId,activities:t.activities,onLandingPageReady:e.onLandingPageReady})}y.prototype={constructor:y,initialize:function(){var e=this.welcomePanel.initialize();return e.then(function(){var e=v.call(this),t=Array.prototype.concat.apply([],D.map(function(t){return Object.keys(e[t.key]||[])}));S.call(this,t)}.bind(this)),e},setViewer:function(e){this.pad3DViewer=e,!this.params.initApp&&this.showWelcomePanel(!1);var t=e.render().getContent(),i=t.parentNode;t.style.position="relative",!this.params.renderDiv.parentNode&&i&&i!==this.params.renderDiv&&i.insertBefore(this.params.renderDiv,i.firstChild),this.params.renderDiv.insertBefore(t,this.params.renderDiv.firstChild),this.welcomePanel&&(this.params.renderDiv.insertBefore(this.welcomePanel.elements.mainBody,this.params.renderDiv.firstChild),this.welcomePanel.setViewer(e,!this.params.initApp)),this.tokensPAD.push(e.subscribe({event:"onRootAdded"},function(t){var i=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),n=t.id,o=e.getController().getNode({id:n}),a=i.getNodeType(o);if("R2V_FeatureState"===a){var r=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),s=window.document.getElementsByClassName("DMULoadingPanel");r.length&&(r[0].dsModel.off(),r[0].dsModel.destroy(),r=null),s.length&&s[0].destroy()}if("DesignSight"===a||"DIFLayout"===a||"DIFSheet"===a||"Document"===a||"Specification Report"===a||"Requirement"===a||"Requirement Specification"===a){if("DesignSight"===a)this.params.widget.setValue("mkpSession",JSON.stringify({type:"msr",plmType:a,id:n}));else{this.params.widget.setValue("mkpSession",JSON.stringify({type:"Document"===a||"Specification Report"===a||"Requirement"===a||"Requirement Specification"===a?a:"2D",plmType:a,id:n}));let t=u.getLoadingContextController({context:e});if(t){let e=t.getSubContextInformations(n);e&&(n=e.id?e.id:n,a=e.type?e.type:a)}}var l=v.call(this);l[a="DIFLayout"===a?"difLayout":"DIFSheet"===a?"difSheet":"Requirement"===a?"req":"Requirement Specification"===a?"reqSpec":"DesignSight"===a?"msr":"VPMReference"===a?"products":"doc"]||(l[a]={}),l[a][n]={},this.params.widget.setValue("xsceneStoredObjects",JSON.stringify(l)),this.showWelcomePanel(!1),S.call(this,[n])}}.bind(this))),this.tokensPAD.push(e.subscribe({event:"onRootRemoved"},function(t){let i=u.getLoadingContextController({context:e});i&&i.removeSubContextInformations(t.id);var n=v.call(this);["difLayout","difSheet","doc","req","reqSpec","msr"].some(function(e){return n[e]&&n[e][t.id]})&&(S.call(this,[t.id]),this.params.widget.deleteValue("mkpSession"))}.bind(this))),this.tokensPAD.push(e.subscribe({event:"onBeginRootLoading"},function(){var e=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),t=window.document.getElementsByClassName("DMULoadingPanel");e.length&&(e[0].dsModel.off(),e[0].dsModel.destroy(),e=null),t.length&&t[0].destroy()})),require(["DS/DMUBaseExperience/DMUContextManager"],function(t){var i=t.getEventsController({viewer:e.getViewer()});this.tokensMkp.push(i.addEvent("onReviewCtxInformationChanged",function(e){var t=v.call(this);t.mkp||(t.mkp={}),t.mku||(t.mku={}),"Markup"===e.reviewType?t.mkp[e.reviewId]={}:"DMUMarkupRepReference"===e.reviewType&&(t.mku[e.reviewId]={}),this.params.widget.setValue("xsceneStoredObjects",JSON.stringify(t)),S.call(this,[e.reviewId])}.bind(this))),this.tokensMkp.push(i.addEvent("onReviewRemoved",function(e){var t=v.call(this);(e&&t.mkp&&t.mkp[e.reviewId]||e&&t.mku&&t.mku[e.reviewId])&&S.call(this,[e.reviewId]),this.params.widget.deleteValue("reviewIdInSession")}.bind(this)))}.bind(this))},appReady:function(e){if(this.isAppReady=!0,this.params.initApp){let s=this.params.widget.getValue("X3DContentId"),l=this.params.widget.id.indexOf("preview")>-1,d=this;if(this.params.widget.deleteValue("X3DContentId"),s)e&&e.appInitFromTransition({x3dContent:JSON.parse(s),onNoActionDone:function(){setTimeout(function(e){var t=JSON.parse(s);d.showWelcomePanel(!1),(t.data&&t.data.items||[]).forEach(function(e){("Drawing"===e.objectType||e.objectTaxonomies&&e.objectTaxonomies.indexOf("Drawing")>-1)&&delete e.path}),t.data&&t.data.items&&t.data&&t.data.items.length&&i.callSpecReportData(e,t,!0)},0,this.pad3DViewer)}.bind(this)});else if(!0===this.params.widget.getValue("autoreload")||!0===this.params.widget.getValue("autoreloadPreviewApp")&&!l){var t=this.params.widget.getValue("reviewIdInSession");if(t)f.call(this,[{id:JSON.parse(t).reviewID,type:JSON.parse(t).reviewType}]);else{var n=this.params.widget.getValue("mkpSession");if((n=n?JSON.parse(n):null)&&"ITF"===n.type){var o=this.params.widget.getValue("ItfSimuInSession");if((o=o?JSON.parse(o):null)&&!Array.isArray(o)&&"object"==typeof o){var a=Object.keys(o);if(1===a.length){var r=a[0];Array.isArray(o[r])&&o[r].length?f.call(this,o[r].map(function(e){return{id:e,type:"PLMPIMMetricReference"}})):f.call(this,[{id:r,type:"SIMItfSimulation"}])}}}else n&&n.id&&("2D"===n.type||"Document"===n.type||"msr"===n.type)&&f.call(this,[{id:n.id,type:n.plmType}])}}l?this.params.widget.setValue("autoreloadPreviewApp",!0):this.params.widget.deleteValue("autoreloadPreviewApp")}var s=this.welcomePanel.appReady();return this.welcomePanel.redraw(),s},dispose:function(){if(this.showWelcomePanel(!1),this.welcomePanel){var e=require("DS/DMUBaseExperience/DMUContextManager").getEventsController({viewer:this.pad3DViewer.getViewer()});this.tokensMkp.forEach(e.removeEvent,e),this.tokensMkp=[],this.tokensPAD.forEach(this.pad3DViewer.unsubscribe,this.pad3DViewer),this.tokensPAD=[],this.pad3DViewer=this.params=null,this.tokensWelcomePanel.forEach(l.unsubscribe,l),this.tokensWelcomePanel.length=0;var t=this.welcomePanel.dispose();return this.welcomePanel=null,t}},showWelcomePanel:function(e){this.welcomePanel&&(this.welcomePanel.elements.mainBody.style.position="relative",this.welcomePanel.elements.mainBody.style.display=e?"":"none",e&&this.welcomePanel.redraw())}};var A,M,R,C,P={widget:null,widgetLink:null,viewer:null,viewerAttachment:null},k=!1,x="DMU3DMarkupDefaultWkb",U=n.getOption("testWkb"),W={wkb2D:{type:"2D",wkb:[{file:U?"DMU3DReviewWidget2D_TST.xml":"DMU3DReviewWidget2D.xml",module:U?"CAT3DReviewTestWidget":"DMU3DReviewWidget"}]},wkb2DFormats:{type:"2DFormats",wkb:[{file:"DMU2DFormats.xml",module:"DMU3DReviewWidget"}]},wkb3D:{type:"3D",wkb:[{file:U?"DMU3DReviewWidget_TST.xml":"DMU3DReviewWidget.xml",module:U?"CAT3DReviewTestWidget":"DMU3DReviewWidget"}]},wkb3DFormats:{type:"3DFormats",wkb:[{file:"DMU3DFormats.xml",module:"DMU3DReviewWidget"}]},wkbITF:{type:"ITF",wkb:[{file:U?"DMUReviewAndITFWidget_TST.xml":"DMUReviewAndITFWidget.xml",module:U?"CAT3DReviewTestWidget":"DMU3DReviewWidget"}]},wkbITFFormats:{type:"ITFFormats",wkb:[{file:"DMU3DFormats.xml",module:"DMU3DReviewWidget"}]},wkbDocument:{type:"Document",wkb:[{file:U?"DMU3DReviewWidgetDocument_TST.xml":"DMU3DReviewWidgetDocument.xml",module:U?"CAT3DReviewTestWidget":"DMU3DReviewWidget"}]},wkbRequirement:{type:"Requirement",wkb:[{file:U?"DMU3DReviewWidgetRequirement_TST.xml":"DMU3DReviewWidgetRequirement.xml",module:U?"CAT3DReviewTestWidget":"DMU3DReviewWidget"}]},"wkbRequirement Specification":{type:"Requirement Specification",wkb:[{file:U?"DMU3DReviewWidgetRequirement_TST.xml":"DMU3DReviewWidgetRequirement.xml",module:U?"CAT3DReviewTestWidget":"DMU3DReviewWidget"}]},wkb2DFL:{type:"2DFL",wkb:[{file:"DMU3DReviewWidget2DFL.xml",module:"DMU3DReviewWidget"}]},wkb2DFLFormats:{type:"2DFLFormats",wkb:[{file:"DMU2DFormats.xml",module:"DMU3DReviewWidget"}]},wkbMSR:{type:"MSR",wkb:[{file:"DMU3DMarkupWidgetMSR.xml",module:"DMU3DReviewWidget"}]},wkbR2V:{type:"R2V",wkb:[{file:"DMU3DMarkupWidgetR2V.xml",module:"DMU3DReviewWidget"}]},wkbR2VFormats:{type:"R2VFormats",wkb:[{file:"DMUR2VFormats.xml",module:"DMU3DReviewWidget"}]},wkbMSRFormats:{type:"MSRFormats",wkb:[{file:"DMUMSRFormats.xml",module:"DMU3DReviewWidget"}]}};function E(){return P.widget.getValue(x)}function V(e){P.widget.setValue(x,e)}function F(){let e;var t=a.getRoots(P.viewer);let i=u.getLoadingContextController({context:P.viewer});i&&t.length&&(e=i.getSubContextInformations(t[0].getIdentificationObject())),e&&e.label?P.widget.setTitle(e.label):P.viewer.getContentName({callbacks:{onComplete:function(e){P.widget.setTitle(e.contentName)},onFailure:function(){}}})}var I=[],T=function(e){I.push(e),1===I.length&&function e(t){var i={lastCommand:[],currentCommand:null,defaultCommand:null},n=P.viewer.getCommandContext?P.viewer.getCommandContext():null;n?r._commandsState[n]=i:r._commandsState=i,r.resetDefaultCommand(n),r._isCommandEnding=!1,r._ignoreCommandBeginWhileEndingCommand=!1,r._commands&&r._cmdCheckHeader&&["_commands","_cmdCheckHeader"].forEach(function(e){var t=n?r[e][n]:r[e];Object.keys(t).forEach(function(e){var i=t[e];i&&i._destroy&&i._destroy(),delete t[e]})});var o=0,a=t.viewer.getFrameWindow().getActionBar(),s=a.onActionBarReady(function(){++o<t.afr.wkb.length&&t.merge?t.viewer.loadActionBar({merge:!0,file:t.afr.wkb[o].file,module:t.afr.wkb[o].module}):(a.removeCallback(s),t.viewer.getFrameWindow().getContextualUIManager().activateContextualBarOnLeftClicAfterCSOChange(),r.setDefaultCommand({ID:"DMU3ReviewWidgetDefaultHdr",className:"DS/DMU3DReviewWidget/DMU3DReviewWidgetDefaultCmd",context:n}),t.actionBarReadyCb&&t.actionBarReadyCb(),t.options&&t.options.done({appMainDiv:R,pad3DViewer:t.viewer})),t.merge&&o!==t.afr.wkb.length||(I.shift(),I.length&&e(I[0]))});t.viewer.loadActionBar({merge:!1,file:t.afr.wkb[0].file,module:t.afr.wkb[0].module})}(I[0])};async function L(e){e&&(e.subscribe("onReviewContextModified",function(e){var t=e.onABReady?e.onABReady:function(){},i=E();if("Data"===e.type){if("3D"===e.data.wkb){for(var n=!1,o=0;o<W.wkb3D.wkb.length;o++)W.wkb3D.wkb[o].file===e.data.file&&W.wkb3D.wkb[o].module===e.data.module&&(n=!0);n||(W.wkb3D.wkb.push({file:e.data.file,module:e.data.module}),"3D"===i&&T({merge:!0,afr:W.wkb3D,viewer:P.viewer,actionBarReadyCb:t}))}}else"RefreshAB"===e.type?T({merge:!0,afr:W["wkb"+i],viewer:P.viewer,actionBarReadyCb:t}):"Document"===e.type||"Specification Report"===e.type?(T({merge:!0,afr:W.wkbDocument,viewer:P.viewer,actionBarReadyCb:t}),e.type.contains("Formats")||V("Document")):("ITF"===e.type||"MSR"===e.type||"R2V"===e.type||"Requirement"===e.type||"Requirement Specification"===e.type||e.type!==i&&W["wkb"+e.type])&&(T({merge:!0,afr:W["wkb"+e.type],viewer:P.viewer,actionBarReadyCb:t}),e.type.contains("Formats")||V(e.type));"ITF"===e.type?P.widget.setValue("mkpSession",JSON.stringify({type:e.type})):"Data"===e.type&&P.widget.deleteValue("mkpSession")}),await e.setActiveState(!0))}var _,N,O,q=function(){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/PADUtils/PADCommandProxy"],function(e,t){(_=e).renderDiv||_.initialize2(P.viewer.getFrameWindow().getViewerFrame(),t.appId(),P.widget.getValue("changeControlActivation")?"show":"hide","top-right",function(){_.addEvent("onAuthoringCtxVisible",function(e){e.showAuthoringContext&&P.widget.setValue("changeControlActivation",!0)})})})},X=function(e){require(["DS/PADUtils/PADCommandProxy","DS/PADUtils/PADSharedSettings","DS/DMUBaseExperience/DMUContextManager","i18n!DS/PADUtils/assets/nls/PADUtils"],function(t,i,a,r){var s,l=[],d=[];O=function(){P.widget.setPreferences([]),s.destroy(),l.forEach(function(e){e.cb&&o.removeEvent(e.cb,e.padFct)}),O=function(){}},N=function(){if(l.forEach(function(e){var t=e.preference.name,i=P.widget.getValue(t),n=o.getSetting(t);(i="boolean"===e.preference.type&&"boolean"!=typeof i?"true"===i:i)!==n&&o.setSetting(t,i),e.fct&&e.fct(i)}),o.updateWidgetPreferences(),!s&&l.length){let e=a.giveEventsController({viewer:P.viewer.getViewer()});s=t.create({events:{onPreferenceModification:function(e){l.some(function(t){if(e.name===t.preference.name){if("boolean"!=typeof e.value&&"string"!=typeof e.value)throw new Error("Value must be a string or a boolean");if(o.getSetting(e.name)!==e.value){if("boolean"===t.preference.type&&"boolean"!=typeof e.value)throw new Error("Preference is a boolean type so value must be a boolean");t.debounce=!0,P.widget.setValue(e.name,e.value),o.setSetting(e.name,e.value)}return t.fct&&t.fct(e.value),!0}})},onSelect:function(t){e&&e.fireEvent("onCrossWidgetSelection",t)}}}),P.widgetLink&&P.widgetLink.subscribe("DS/ExternalWdgtCom/Find",t=>{e&&e.fireEvent("onCrossWidgetFind",t)}),e&&(e.addEvent("onFireCrossWidgetSelection",e=>{s&&s.select(e)}),e.addEvent("onFireCrossWidgetFind",e=>{e&&e.paths&&e.paths.length&&P.widgetLink&&P.widgetLink.publish("DS/ExternalWdgtCom/Find",{paths:e.paths})})),l.forEach(function(e){e.cb&&o.addEvent(e.cb,e.padFct=function(t){e.debounce?e.debounce=!1:s.preferenceModification({name:e.preference.name,value:t})})})}},P.widget.setPreferences([]),o.setSetting("syncAutoReload",!0),i.destroy(),i.addSharedSettings(P.widget),l.push({preference:{name:"changeControlActivation",type:"boolean",label:r.changeControlActivation_label,defaultValue:!1},fct:function(e){_&&_[e?"show":"hide"]()},cb:"onChangeControlActivation",debounce:!1}),l.push({preference:{name:"changeControlPosition",type:"list",label:r.changeControlPosition_label,defaultValue:"top-right",options:[{label:r["top-right_label"],value:"top-right"},{label:r["top-left_label"],value:"top-left"},{label:r["bottom-left_label"],value:"bottom-left"},{label:r["bottom-right_label"],value:"bottom-right"}]},fct:function(e){_&&_.setPosition(e)}}),o.setSetting("authorizeChangeControl",!0),e&&q(),n.getOption("debug")?l.push({preference:{name:"webapi_timeout",type:"text",label:"Query timeout",defaultValue:"60000"}}):d=["webapi_timeout"],d.forEach(function(e){P.widget.deleteValue(e)}),d.length=0,l.forEach(function(e){P.widget.mergePreferences([e.preference])}),N(),require(["i18n!DS/ENOPAD3DViewer/assets/nls/PAD3DViewer"],e=>{P.widget.addEvent("onChangeFlexibleAssembliesSupport",function(e,t){o.setSetting(e,t)});var t=o.getSetting("enopad3dviewer_roles");let i=!0,n=require("DS/PADUtils/PADUtilsServices").isCloud(),a=require("DS/PADUtils/PADSession").isAuthoring();for(var r=0;r<t.length;r++)if("E19"===t[r].id&&(!t[r].platforms||t[r].platforms&&t[r].platforms.indexOf(require("DS/PADUtils/PADUtilsServices").getPlatformId())>-1)){i=!1;break}!i||n||a?(P.widget.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"hidden",defaultValue:!1,label:e.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:!1}),o.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",!1)):P.widget.getPreference("enopad3dviewer_flexibleAssemblySupportActivated")||(P.widget.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"boolean",defaultValue:!1,label:e.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:void 0!==P.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated")&&P.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated")}),o.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",P.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated"))),o.setSetting("enopad3dviewer_staticMappingSupportActivated",!a)}),P.widget.addEvent("endEdit",N)})},B=function(e){e.unsubscribe(M),M=null,F(),q(),require("DS/PADUtils/PADUtilsServices").isCloud()&&!window.__preventPrefPanel&&e.getViewer().displayIntroductoryControlPreferencePanel(),P.widget.getValue(x)||P.widget.addPreference({name:x,type:"hidden"});var t=!1,i=async function(){if(t){var i=A.get3DReviewController({context:e});await L(i),C.appReady(i)}else t=!0};require(["DS/DMU3DReviewController/DMU3DReviewController"],function(e){A=e,i()}),setTimeout(function(){"1"===P.widget.getValue("widgetForODTReplay")&&(P.widgetViewer3DReview._viewer3DReview=e),P.widget.dispatchEvent("onWidgetAndAppReady","1"===P.widget.getValue("widgetForODTReplay")?[{pad3DViewer:P.viewer}]:void 0),i()}),P.viewerAttachment&&P.viewerAttachment(R),P.viewerAttachment=null,e.getFrameWindow().getContextualUIManager().activateContextualBarOnLeftClicAfterCSOChange()};function j(e){"string"==typeof e.reviewID&&P.widget.setValue("reviewIdInSession",JSON.stringify(e))}function z(){var e=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),t=window.document.getElementsByClassName("DMULoadingPanel");e.length&&(e[0].dsModel.off(),e[0].dsModel.destroy(),e=null),t.length&&t[0].destroy()}function J(t){return R||(R=e.createElement("div",{class:"appMain",styles:{width:"auto",height:"100%"}})),(C=new y({widget:P.widget,readOnlyApp:!1,renderDiv:R,initApp:t&&t.initApp,onLandingPageReady:t&&t.onLandingPageReady})).initialize()}function G(){if(o.setSetting("activateWidgetLink",!0),o.setSetting("useNewUXGuidelinesWP",!0),!P.viewer){var e=new Promise(function(e){require(["DS/PADUtils/PADSharedSettings"],t=>{t.addSharedSettings(P.widget,["showWelcomePanel"]),J({initApp:!0,onLandingPageReady:function(){P.viewerAttachment(R),P.viewerAttachment=null}}).then(e)})}),t=new Promise(function(e){require(["DS/ENOPAD3DViewer/PAD3DViewer","text!DS/DMU3DReviewWidget/assets/DMU3DReviewWidget.json"],function(t,i){e([t,i])})}),n=new Promise(e=>{require(["DS/ENOXInterWdgCom/LinkManager"],t=>{P.widgetLink=t,t.initializeWidgetLink(P.widget,{appIds:[],uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXEnrich","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXEnrich","ENXLandingPageSync"],open:!0}).then(e)})});Promise.all([e,t,n]).then(function(e){var t=JSON.parse(e[1][1]);t.context="Default",t.mouseProfile=require("DS/PADUtils/PADUtilsServices").isCloud()?window.__mouseProfile:"CATIA";var n=E();t.workbenchModule="2D"===n||"ITF"===n||"R2V"===n||"MSR"===n||"Document"===n||"2DFL"===n?W["wkb"+n].wkb[0].module:W.wkb3D.wkb[0].module,t.workbench="2D"===n||"ITF"===n||"MSR"===n||"R2V"===n||"Document"===n||"2DFL"===n?W["wkb"+n].wkb[0].file:W.wkb3D.wkb[0].file;var a={widget:P.widget,windowOptions:t,enableFiltering:!0,binaryPrimitives:!0,enableSidePanel:!0,readyCB:X,visuProgressiveTileModel:!0};a.windowOptions.allowDnD=!1;var r=P.viewer=new e[1][0](a);p.init(r),t.mouseProfile&&r.getViewpoint().setDefaultController(!0,t.mouseProfile),C.setViewer(r);var s=o.getSetting("propertiesFacet"),l=d.getMapping();l&&(l.physicssimulation.alwaysVisible=!1,s.push(l.physicssimulation)),r.setOption("propertiesFacet",s),r.setAuthorizedRootTypes(o.getSetting("ups_authorized_root_types")),M=r.subscribe({event:"onReady"},B),r.subscribe({event:"onRootAdded"},F),r.subscribe({event:"onRootRemoved"},F),r.subscribe({event:"onRootAttached"},F),r.subscribe({event:"onRootDetached"},F),r.subscribe({event:"onContentNameModified"},F),i.initViewerDnd(r,h),localStorage.getItem("defaultSelectedTypeData")||localStorage.setItem("defaultSelectedTypeData","product"),o.setSetting("settypes",!0),"1"===P.widget.getValue("widgetForODTReplay")&&P.widget.dispatchEvent("onPAD3DViewerCreated",[{pad3DViewer:r}]),P.widgetInitDone&&P.widgetInitDone({appMainDiv:R,pad3DViewer:r})})}}function H(){if(function(){var e=o.getSetting("enopad3dviewer_roles");let t=!0,i=require("DS/PADUtils/PADUtilsServices").isCloud(),n=require("DS/PADUtils/PADSession").isAuthoring();for(var a=0;a<e.length;a++)if("E19"===e[a].id&&(!e[a].platforms||e[a].platforms&&e[a].platforms.indexOf(require("DS/PADUtils/PADUtilsServices").getPlatformId())>-1)){t=!1;break}o.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",t&&!i&&!n),o.setSetting("enopad3dviewer_staticMappingSupportActivated",!n)}(),!1===k&&P.viewer){var e=P.widget.getValue("reviewIdInSession");e=e?JSON.parse(e):void 0,P.viewer.refresh();var t,i,n=a.getRoots(P.viewer),r=!1;for(let e=0;e<n.length;e++)if(""!==a.getNodeID(n[e])&&(t=a.getNodeID(n[e]),"Document"===(i=a.getNodeType(n[e]))||"Specification Report"===i||"Requirement"===i||"Requirement Specification"===i||"DIFSheet"===i||"DIFLayout"===i)){r=!0;break}if(r)var s=P.viewer.subscribe({event:"onRefreshCompleted"},function(){P.viewer.unsubscribe(s);var e=P.viewer.options.visuProgressiveTileModel?[{rootID:t,validForServerCall:!0,structure:{rootStats:{infos:{encoding:"UTF-8",kind:"InstRef",version:"1.1"},results:[{resourceid:t,"ds6w:type":i,"ds6w:globaltype":"ds6w:Part","ds6w:globalType":"ds6w:Part",boundingbox:{max:[-1,-1,-1],min:[1,1,1]}},{synthesis:{name:"ProgressiveExpand_FlatSynthesis",value:1}},{synthesis:{name:"ProgressiveExpand_OccSynthesis",value:1}},{synthesis:{name:"ProgressiveExpand_LeafSynthesis",value:1}}]},infos:{encoding:"UTF-8",kind:"InstRef",version:"1.1"},results:[{resourceid:t,"ds6w:type":i,"ds6w:globaltype":"ds6w:Part","ds6w:globalType":"ds6w:Part",nbchildren:"0"}]}}]:[{rootID:t,validForServerCall:!0,structure:{rootId:i,results:[{attributes:[{name:"did",value:t},{name:"physicalid",value:t},{name:"ds6w:type",value:i}]},{path:[t]}]}}];P.viewer.loadJSON({data:e})});else"DesignSight"===i&&P.viewer.publish({event:"widgetReresh",data:{objectId:t,objectType:i}});if(e)var l=P.viewer.subscribe({event:"onLoadingComplete"},function(){P.viewer.unsubscribe(l),j(e);let i=P.widget.getValue("reviewIdInSession");(t=JSON.parse(i).reviewID)&&A&&A.give3DReviewController({context:P.viewer}).loadReview(t)})}}function Q(){k=!0}function K(){if(A){var e=A.give3DReviewController({context:P.viewer});e&&e.refreshContext()}k=!1}function Y(){C&&C.dispose(),C=null,P.viewer&&(A&&A.unreference3DReviewController({context:P.viewer}),P.viewer.destroy()),P={widget:null,viewer:null,viewerAttachment:null},A=null}function Z(e){P.viewer&&P.viewer.search({searchQuery:e})}var $=function(e){if(P.widget=e.widget,R=e.appMainDiv,P.widgetInitDone=e.done,e.pad3DViewer){P.viewer=e.pad3DViewer,p.init(P.viewer);var t=require("DS/DMUBaseExperience/DMUContextManager").getReviewContext({context:e.pad3DViewer}),i=t?t.getReviewCtxInformation():null;i&&i.reviewId&&j(i.reviewId)}else e.viewerAttachment?(P.viewerAttachment=e.viewerAttachment,G()):(P.viewerAttachment=function(e){P.widget.setBody(e)},P.widget.addEvent("onLoad",G)),P.widget.addEvent("onEdit",Q),P.widget.addEvent("endEdit",K),P.widget.addEvent("onRefresh",H),P.widget.addEvent("onDestroy",Y),P.widget.addEvent("onSearch",Z),"1"===P.widget.getValue("widgetForODTReplay")&&(P.widgetViewer3DReview=this),P.widget.addEvent("onDMUMarkupLoaded",j),P.widget.addEvent("onDMUMarkupLoadFailed",z),P.widget.setMetas({helpPath:"DMU3DReviewWidget/assets/help"})};return $.prototype.setUp=function(e){function t(){require(["DS/DMU3DReviewController/DMU3DReviewController"],function(t){var i=(A=t).get3DReviewController({context:P.viewer});(async()=>{await L(i),e.sourceApp&&e.sourceApp.issues&&1===e.sourceApp.issues.length&&i.appInitFromTransition({issues:e.sourceApp.issues,onNoActionDone:function(){}})})()})}require("DS/ENOXInterWdgCom/LinkManager").updateLinkability({appIds:[],open:!0,uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXEnrich","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXEnrich","ENXLandingPageSync"]}),o.setSetting("activateWidgetLink",!0),o.setSetting("useNewUXGuidelinesWP",!0),J().then(function(){C.setViewer(P.viewer),C.appReady(),P.widget.addEvent("onRefresh",H),P.widget.addEvent("onSearch",Z),P.widget.addEvent("onDMUMarkupLoaded",j),P.widget.setMetas({helpPath:"DMU3DReviewWidget/assets/help"}),e.sourceApp&&e.sourceApp.pad3DViewer!==P.viewer&&(P.viewer=e.sourceApp.pad3DViewer),p.init(P.viewer);var i=o.getSetting("propertiesFacet"),n=d.getMapping();n&&n.physicssimulation&&n.physicssimulation.facet&&(i.find(function(e){return!(!e||!e.facet||e.facet.name!==n.physicssimulation.facet.name)})||(n.physicssimulation.alwaysVisible=!1,i.push(n.physicssimulation))),P.viewer.setOption("propertiesFacet",i),P.viewer.getBIController().toggleBetweenStandaloneAndSlaveMode("DUAL"),X(P.viewer),P.viewer.getViewer().updateViewPanelUIConfiguration&&P.viewer.getViewer().updateViewPanelUIConfiguration({useShadingIllustration:!1,useOutline:!1}),F(),"3D"===E()||a.getRoots(P.viewer).length>=0?(T({options:e,merge:!1,afr:W.wkb3D,actionBarReadyCb:t,viewer:P.viewer}),V("3D")):"2DFL"===E()?(T({options:e,merge:!1,afr:W.wkb2DFL,actionBarReadyCb:t,viewer:P.viewer}),V("2DFL")):(T({options:e,merge:!1,afr:W.wkb2D,actionBarReadyCb:t,viewer:P.viewer}),V("2D")),o.setSetting("dynamic_authorized_types",!0)})},$.prototype.dispose=function(e){if(o.setSetting("dynamic_authorized_types",!1),P.widget.removeEvent("onRefresh",H),P.widget.removeEvent("onSearch",Z),P.widget.removeEvent("endEdit",N),P.widget.removeEvent("onDMUMarkupLoaded",j),O&&O(),C&&C.dispose(),C=null,P.viewer){var t=o.getSetting("propertiesFacet"),i=d.getMapping();if(i){var n=t.findIndex(function(e){return!(!e||!e.facet||e.facet.name!==i.physicssimulation.facet.name)});n>=0&&t.splice(n,1)}P.viewer.setOption("propertiesFacet",t),A&&A.unreference3DReviewController({context:P.viewer,options:e})}W.wkb2D.wkb.length>1&&W.wkb2D.wkb.splice(1,W.wkb2D.wkb.length),W.wkb2DFL.wkb.length>1&&W.wkb2DFL.wkb.splice(1,W.wkb2DFL.wkb.length),W.wkb3D.wkb.length>1&&W.wkb3D.wkb.splice(1,W.wkb3D.wkb.length),W.wkb2DFormats.wkb.length>1&&W.wkb2DFormats.wkb.splice(1,W.wkb2DFormats.wkb.length),W.wkb2DFLFormats.wkb.length>1&&W.wkb2DFLFormats.wkb.splice(1,W.wkb2DFLFormats.wkb.length),W.wkb3DFormats.wkb.length>1&&W.wkb3DFormats.wkb.splice(1,W.wkb3DFormats.wkb.length),A=null},$.prototype.onWillLeave=function(e){if(P.viewer){var t=require("DS/DMUBaseExperience/DMUContextManager");if(t){var i=t.giveEventsController({viewer:P.viewer.getViewer()});i&&i.fireEvent("onLeavingR3DApp",{targetApp:e&&e.options?e.options.id:""})}}},$}),define("DS/DMU3DReviewWidget/ENOR3DWidgetMain",["DS/DMU3DReviewWidget/DMU3DReviewWidgetOptions","DS/PADUtils/PADSettingsMgt","DS/DMUMeasurable/DMUToolsSceneGraph","DS/CATWebUXComponents/DMUCommandsManager","DS/EditPropWidget/constants/ConstantsMapping","DS/CATWebUXComponents/DMUFrameWindow"],function(e,t,i,n,o,a){"use strict";var r,s,l,d={widget:null,widgetLink:null,viewer:null,viewerAttachment:null},c=!1;let p=null,u=null,w="3D";var g="DMU3DMarkupDefaultWkb",D=e.getOption("testWkb");let m=window.location.search.includes("appId")?window.location.search.slice(window.location.search.indexOf("appId")+6):"NoID";var v={wkb2D:{type:"2D",wkb:[{file:D?"DMU3DReviewWidget2D_TST.xml":"DMU3DReviewWidget2D.xml",module:D?"CAT3DReviewTestWidget":"DMU3DReviewWidget"}]},wkb2DFormats:{type:"2DFormats",wkb:[{file:"DMU2DFormats.xml",module:"DMU3DReviewWidget"}]},wkb3D:{type:"3D",wkb:[{file:D?"DMU3DReviewWidget_TST.xml":"DMU3DReviewWidget.xml",module:D?"CAT3DReviewTestWidget":"DMU3DReviewWidget"}]},wkb3DFormats:{type:"3DFormats",wkb:[{file:"DMU3DFormats.xml",module:"DMU3DReviewWidget"}]},wkbITF:{type:"ITF",wkb:[{file:D?"DMUReviewAndITFWidget_TST.xml":"DMUReviewAndITFWidget.xml",module:D?"CAT3DReviewTestWidget":"DMU3DReviewWidget"}]},wkbITFFormats:{type:"ITFFormats",wkb:[{file:"DMU3DFormats.xml",module:"DMU3DReviewWidget"}]},wkbDocument:{type:"Document",wkb:[{file:D?"DMU3DReviewWidgetDocument_TST.xml":"DMU3DReviewWidgetDocument.xml",module:D?"CAT3DReviewTestWidget":"DMU3DReviewWidget"}]},wkbRequirement:{type:"Requirement",wkb:[{file:D?"DMU3DReviewWidgetRequirement_TST.xml":"DMU3DReviewWidgetRequirement.xml",module:D?"CAT3DReviewTestWidget":"DMU3DReviewWidget"}]},"wkbRequirement Specification":{type:"Requirement Specification",wkb:[{file:D?"DMU3DReviewWidgetRequirement_TST.xml":"DMU3DReviewWidgetRequirement.xml",module:D?"CAT3DReviewTestWidget":"DMU3DReviewWidget"}]},wkb2DFL:{type:"2DFL",wkb:[{file:"DMU3DReviewWidget2DFL.xml",module:"DMU3DReviewWidget"}]},wkb2DFLFormats:{type:"2DFLFormats",wkb:[{file:"DMU2DFormats.xml",module:"DMU3DReviewWidget"}]},wkbMSR:{type:"MSR",wkb:[{file:"DMU3DMarkupWidgetMSR.xml",module:"DMU3DReviewWidget"}]},wkbR2V:{type:"R2V",wkb:[{file:"DMU3DMarkupWidgetR2V.xml",module:"DMU3DReviewWidget"}]},wkbR2VFormats:{type:"R2VFormats",wkb:[{file:"DMUR2VFormats.xml",module:"DMU3DReviewWidget"}]},wkbMSRFormats:{type:"MSRFormats",wkb:[{file:"DMUMSRFormats.xml",module:"DMU3DReviewWidget"}]}};function f(){return d.widget.getValue(g)}function h(e){d.widget.setValue(g,e)}function b(){d.viewer.getContentName({callbacks:{onComplete:function(e){d.widget.setTitle(e.contentName)},onFailure:function(){}}})}let S=function(e){let t=u.getSourceApp().getId();return"2D"===e||"Drawing"===e||"DIFSheet"===e||"DIFLayout"===e||"2DFL"===e?"ENOR3D_AP_2D":"Document"===e||"Specification Report"===e||"Requirement"===e||"Requirement Specification"===e?"ENOR3D_AP_Document":"ITF"===e?"ENOR3D_AP_PIM":"MSR"===e?"ENOR3D_AP_MSR":"R2V"===e?"ENOR3D_AP_R2V":"3DFormats"===e?"R3DFormat_AP_3D":"MSRFormats"===e?"R3DFormat_AP_MSR":"2DFormats"===e?"R3DFormat_AP_2D":t};var y,A,M;function R(){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/PADUtils/PADCommandProxy"],function(e,t){(y=e).renderDiv||y.initialize2(d.viewer.getFrameWindow().getViewerFrame(),t.appId(),d.widget.getValue("changeControlActivation")?"show":"hide","top-right",function(){y.addEvent("onAuthoringCtxVisible",function(e){e.showAuthoringContext&&d.widget.setValue("changeControlActivation",!0)})})})}function C(e){e.unsubscribe(s),s=null,b(),R(),require("DS/PADUtils/PADUtilsServices").isCloud()&&!window.__preventPrefPanel&&(d.widget.getValue(g)||d.widget.addPreference({name:g,type:"hidden"}));let t=async function(){var t=r.get3DReviewController({context:e});await async function(e){e&&(e.subscribe("onReviewContextModified",async function(e){if("Data"===e.type&&"3D"===e.data.wkb){for(var t=!1,i=0;i<v.wkb3D.wkb.length;i++)v.wkb3D.wkb[i].file===e.data.file&&v.wkb3D.wkb[i].module===e.data.module&&(t=!0);t||v.wkb3D.wkb.push({file:e.data.file,module:e.data.module})}"ITF"===e.type?d.widget.setValue("mkpSession",JSON.stringify({type:e.type})):"Data"===e.type&&d.widget.deleteValue("mkpSession"),"Data"===e.type&&(e.type="3D");let o=u.getSourceApp().getId(),a=S(e.type);if(w!==e.type){if("3D"===w){let e=u.getComponent(WAfrStandardComponentKey.HandlerComponent);if(e.hasCheckHandler("AnnotationSwitchOnOff")&&e.isCheckExecutable("AnnotationSwitchOnOff")){let t=localStorage.getItem("CAT3DAnnotationSwitchOnOffCmd");await e.setCheckState({id:"AnnotationSwitchOnOff",state:!1}),localStorage.setItem("CAT3DAnnotationSwitchOnOffCmd",t)}}u.switchApp(o,a).then(()=>{w=e.type,u.setContext("AppContext",w),n.refreshCommandsManager(u),e.onABReady()})}else e.onABReady()}),await e.setActiveState(!0))}(t),u.getComponent("LandingPage").appReady()};var i=function(){"1"===d.widget.getValue("widgetForODTReplay")&&(d.widgetViewer3DReview._viewer3DReview=e),d.widget.dispatchEvent("onWidgetAndAppReady","1"===d.widget.getValue("widgetForODTReplay")?[{pad3DViewer:d.viewer}]:void 0),t()};require(["DS/DMU3DReviewController/DMU3DReviewController"],function(e){r=e,setTimeout(i)}),d.viewerAttachment&&d.viewerAttachment(l),d.viewerAttachment=null,e.getFrameWindow().getContextualUIManager().activateContextualBarOnLeftClic()}function P(i){require(["DS/PADUtils/PADCommandProxy","DS/PADUtils/PADSharedSettings","DS/DMUBaseExperience/DMUContextManager","i18n!DS/PADUtils/assets/nls/PADUtils"],function(n,o,a,r){var s,l=[],c=[];M=function(){d.widget.setPreferences([]),s.destroy(),l.forEach(function(e){e.cb&&t.removeEvent(e.cb,e.padFct)}),M=function(){}},A=function(){if(l.forEach(function(e){var i=e.preference.name,n=d.widget.getValue(i),o=t.getSetting(i);(n="boolean"===e.preference.type&&"boolean"!=typeof n?"true"===n:n)!==o&&t.setSetting(i,n),e.fct&&e.fct(n)}),t.updateWidgetPreferences(),!s&&l.length){let e=a.giveEventsController({viewer:d.viewer});s=n.create({events:{onPreferenceModification:function(e){l.some(function(i){if(e.name===i.preference.name){if("boolean"!=typeof e.value&&"string"!=typeof e.value)throw new Error("Value must be a string or a boolean");if(t.getSetting(e.name)!==e.value){if("boolean"===i.preference.type&&"boolean"!=typeof e.value)throw new Error("Preference is a boolean type so value must be a boolean");i.debounce=!0,d.widget.setValue(e.name,e.value),t.setSetting(e.name,e.value)}return i.fct&&i.fct(e.value),!0}})},onSelect:function(t){e&&e.fireEvent("onCrossWidgetSelection",t)}}}),d.widgetLink&&d.widgetLink.subscribe("DS/ExternalWdgtCom/Find",t=>{e&&e.fireEvent("onCrossWidgetFind",t)}),e&&(e.addEvent("onFireCrossWidgetSelection",e=>{s&&s.select(e)}),e.addEvent("onFireCrossWidgetFind",e=>{e&&e.paths&&e.paths.length&&d.widgetLink&&d.widgetLink.publish("DS/ExternalWdgtCom/Find",{paths:e.paths})})),l.forEach(function(e){e.cb&&t.addEvent(e.cb,e.padFct=function(t){e.debounce?e.debounce=!1:s.preferenceModification({name:e.preference.name,value:t})})})}},d.widget.setPreferences([]),t.setSetting("syncAutoReload",!0),o.destroy(),o.addSharedSettings(d.widget),l.push({preference:{name:"changeControlActivation",type:"boolean",label:r.changeControlActivation_label,defaultValue:!1},fct:function(e){y&&y[e?"show":"hide"]()},cb:"onChangeControlActivation",debounce:!1}),l.push({preference:{name:"changeControlPosition",type:"list",label:r.changeControlPosition_label,defaultValue:"top-right",options:[{label:r["top-right_label"],value:"top-right"},{label:r["top-left_label"],value:"top-left"},{label:r["bottom-left_label"],value:"bottom-left"},{label:r["bottom-right_label"],value:"bottom-right"}]},fct:function(e){y&&y.setPosition(e)}}),t.setSetting("authorizeChangeControl",!0),i&&R(),e.getOption("debug")?l.push({preference:{name:"webapi_timeout",type:"text",label:"Query timeout",defaultValue:"60000"}}):c=["webapi_timeout"],c.forEach(function(e){d.widget.deleteValue(e)}),c.length=0,l.forEach(function(e){d.widget.mergePreferences([e.preference])}),A(),require(["i18n!DS/ENOPAD3DViewer/assets/nls/PAD3DViewer"],e=>{d.widget.addEvent("onChangeFlexibleAssembliesSupport",function(e,i){t.setSetting(e,i)}),d.viewer&&d.viewer.getController&&!d.viewer.getController()._elasticLoadingGranted?d.widget.getPreference("enopad3dviewer_flexibleAssemblySupportActivated")||(d.widget.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"boolean",defaultValue:!1,label:e.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:void 0!==d.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated")&&d.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated")}),t.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",d.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated"))):(d.widget.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"hidden",defaultValue:!1,label:e.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:!1}),t.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",!1)),t.setSetting("enopad3dviewer_staticMappingSupportActivated",!0)}),d.widget.addEvent("endEdit",A)})}function k(e){"string"==typeof e.reviewID&&d.widget.setValue("reviewIdInSession",JSON.stringify(e))}function x(){var e=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),t=window.document.getElementsByClassName("DMULoadingPanel");e.length&&(e[0].dsModel.off(),e[0].dsModel.destroy(),e=null),t.length&&t[0].destroy()}function U(){if(t.setSetting("activateWidgetLink",!0),!d.viewer){var e=new Promise(function(e){require(["DS/PADUtils/PADSharedSettings"],t=>{t.addSharedSettings(d.widget,["showWelcomePanel"]),e()})}),i=new Promise(function(e){require(["text!DS/DMU3DReviewWidget/assets/DMU3DReviewWidget.json"],function(t){e([t])})}),r=new Promise(e=>{e()});Promise.all([e,i,r]).then(function(e){var i=JSON.parse(e[1][0]);i.context="Default",require("DS/PADUtils/PADUtilsServices").isCloud()&&t.setSetting("mouseProfile",window.__mouseProfile);var r=f();i.workbenchModule="2D"===r||"ITF"===r||"R2V"===r||"MSR"===r||"Document"===r||"2DFL"===r?v["wkb"+r].wkb[0].module:v.wkb3D.wkb[0].module,i.workbench="2D"===r||"ITF"===r||"MSR"===r||"R2V"===r||"Document"===r||"2DFL"===r?v["wkb"+r].wkb[0].file:v.wkb3D.wkb[0].file;d.widget;let s=d.viewer=p;a.init(s,{executionContext:p.getExecutionContext()}),n.dmuSetExecutionContext(p.getExecutionContext()),n.dmuSetHandlerComponent(p.getExecutionContext()),i.mouseProfile&&s.getViewpoint().setDefaultController(!0,i.mouseProfile);var c=t.getSetting("propertiesFacet"),u=o.getMapping();u&&(u.physicssimulation.alwaysVisible=!1,c.push(u.physicssimulation)),s.setOption("propertiesFacet",c),s.setAuthorizedRootTypes(t.getSetting("ups_authorized_root_types")?t.getSetting("ups_authorized_root_types"):t.getSetting("authorized_root_types")),s.subscribe({event:"onRootAdded"},b),s.subscribe({event:"onRootRemoved"},b),s.subscribe({event:"onRootAttached"},b),s.subscribe({event:"onRootDetached"},b),s.subscribe({event:"onContentNameModified"},b),t.setSetting("settypes",!0),"1"===d.widget.getValue("widgetForODTReplay")&&d.widget.dispatchEvent("onPAD3DViewerCreated",[{pad3DViewer:s}]),d.widgetInitDone&&d.widgetInitDone({appMainDiv:l,pad3DViewer:s}),C(s)})}}function W(){if(!1===c&&d.viewer){var e=d.widget.getValue("reviewIdInSession");e=e?JSON.parse(e):void 0,d.viewer.refresh();var t,n,o=i.getRoots(d.viewer),a=!1;for(let e=0;e<o.length;e++)if(""!==i.getNodeID(o[e])&&(t=i.getNodeID(o[e]),"Document"===(n=i.getNodeType(o[e]))||"Specification Report"===n||"Requirement"===n||"Requirement Specification"===n||"DIFSheet"===n||"DIFLayout"===n)){a=!0;break}if(a)var s=d.viewer.subscribe({event:"onRefreshCompleted"},function(){d.viewer.unsubscribe(s);var e=d.viewer.options.visuProgressiveTileModel?[{rootID:t,validForServerCall:!0,structure:{rootStats:{infos:{encoding:"UTF-8",kind:"InstRef",version:"1.1"},results:[{resourceid:t,"ds6w:type":n,"ds6w:globaltype":"ds6w:Part","ds6w:globalType":"ds6w:Part",boundingbox:{max:[-1,-1,-1],min:[1,1,1]}},{synthesis:{name:"ProgressiveExpand_FlatSynthesis",value:1}},{synthesis:{name:"ProgressiveExpand_OccSynthesis",value:1}},{synthesis:{name:"ProgressiveExpand_LeafSynthesis",value:1}}]},infos:{encoding:"UTF-8",kind:"InstRef",version:"1.1"},results:[{resourceid:t,"ds6w:type":n,"ds6w:globaltype":"ds6w:Part","ds6w:globalType":"ds6w:Part",nbchildren:"0"}]}}]:[{rootID:t,validForServerCall:!0,structure:{rootId:n,results:[{attributes:[{name:"did",value:t},{name:"physicalid",value:t},{name:"ds6w:type",value:n}]},{path:[t]}]}}];d.viewer.loadJSON({data:e})});else"DesignSight"===n&&d.viewer.publish({event:"widgetReresh",data:{objectId:t,objectType:n}});if(e)var l=d.viewer.subscribe({event:"onLoadingComplete"},function(){d.viewer.unsubscribe(l),k(e);let i=d.widget.getValue("reviewIdInSession");(t=JSON.parse(i).reviewID)&&r&&r.give3DReviewController({context:d.viewer}).loadReview(t)})}}function E(){c=!0}function V(){if(r){var e=r.give3DReviewController({context:d.viewer});e&&e.refreshContext()}c=!1}function F(){d.viewer&&(r&&r.unreference3DReviewController({context:d.viewer}),d.viewer.destroy()),d={widget:null,viewer:null,viewerAttachment:null},r=null}function I(e){d.viewer&&d.viewer.search({searchQuery:e})}return class{constructor(e){if(d.widget=e.widget,d.widgetInitDone=e.done,p=e.viewer?e.viewer:e.pad3DViewer,u=e.executionContext,e.data&&(d.data=e.data.wkb?e.data.wkb:e.data,d.controller=e.data.controller?e.data.controller:e.controller,v=e.data.wkb?e.data.wkb:e.data,m=e.data.appId?e.data.appId:e.appId),e.pad3DViewer){d.viewer=e.pad3DViewer,a.init(d.viewer);var r=require("DS/DMUBaseExperience/DMUContextManager").getReviewContext({context:e.pad3DViewer}),s=r?r.getReviewCtxInformation():null;s&&s.reviewId&&k(s.reviewId)}else e.viewerAttachment?(d.viewerAttachment=e.viewerAttachment,U()):(d.viewerAttachment=function(e){d.widget.setBody(e)},d.widget.addEvent("onLoad",U)),d.widget.addEvent("onEdit",E),d.widget.addEvent("endEdit",V),d.widget.addEvent("onRefresh",W),d.widget.addEvent("onDestroy",F),d.widget.addEvent("onSearch",I),"1"===d.widget.getValue("widgetForODTReplay")&&(d.widgetViewer3DReview=this),d.widget.addEvent("onDMUMarkupLoaded",k),d.widget.addEvent("onDMUMarkupLoadFailed",x),d.widget.setMetas({helpPath:"3DMarkup"===m?"DMU3DReviewWidget/assets/help":"DMUReviewWebApp/assets/help"});this.setUp=function(){require("DS/ENOXInterWdgCom/LinkManager").updateLinkability({appIds:[],open:!0,uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXEnrich","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXEnrich","ENXLandingPageSync"]}),t.setSetting("activateWidgetLink",!0),d.widget.addEvent("onRefresh",W),d.widget.addEvent("onSearch",I),d.widget.addEvent("onDMUMarkupLoaded",k),d.widget.setMetas({helpPath:"DMU3DReviewWidget/assets/help"}),e.sourceApp&&e.sourceApp.pad3DViewer!==d.viewer&&(d.viewer=e.sourceApp.pad3DViewer),a.init(d.viewer,{executionContext:p.getExecutionContext()}),n.dmuSetExecutionContext(p.getExecutionContext()),n.refreshCommandsManager(p.getExecutionContext());var r=t.getSetting("propertiesFacet"),s=o.getMapping();s&&s.physicssimulation&&s.physicssimulation.facet&&(r.find(function(e){return!(!e||!e.facet||e.facet.name!==s.physicssimulation.facet.name)})||(s.physicssimulation.alwaysVisible=!1,r.push(s.physicssimulation))),d.viewer.setOption("propertiesFacet",r),d.viewer.getBIController().toggleBetweenStandaloneAndSlaveMode("DUAL"),P(d.viewer),d.viewer.getViewer().updateViewPanelUIConfiguration&&d.viewer.getViewer().updateViewPanelUIConfiguration({useShadingIllustration:!1,useOutline:!1}),b(),"3D"===f()||i.getRoots(d.viewer).length>=0?h("3D"):"2DFL"===f()?h("2DFL"):h("2D"),t.setSetting("dynamic_authorized_types",!0)},this.dispose=function(){if(t.setSetting("dynamic_authorized_types",!1),d.widget.removeEvent("onRefresh",W),d.widget.removeEvent("onSearch",I),d.widget.removeEvent("endEdit",A),d.widget.removeEvent("onDMUMarkupLoaded",k),M&&M(),d.viewer){var e=t.getSetting("propertiesFacet"),i=o.getMapping();if(i){var n=e.findIndex(function(e){return!(!e||!e.facet||e.facet.name!==i.physicssimulation.facet.name)});n>=0&&e.splice(n,1)}d.viewer.setOption("propertiesFacet",e)}v.wkb2D.wkb.length>1&&v.wkb2D.wkb.splice(1,v.wkb2D.wkb.length),v.wkb2DFL.wkb.length>1&&v.wkb2DFL.wkb.splice(1,v.wkb2DFL.wkb.length),v.wkb3D.wkb.length>1&&v.wkb3D.wkb.splice(1,v.wkb3D.wkb.length),v.wkb2DFormats.wkb.length>1&&v.wkb2DFormats.wkb.splice(1,v.wkb2DFormats.wkb.length),v.wkb2DFLFormats.wkb.length>1&&v.wkb2DFLFormats.wkb.splice(1,v.wkb2DFLFormats.wkb.length),v.wkb3DFormats.wkb.length>1&&v.wkb3DFormats.wkb.splice(1,v.wkb3DFormats.wkb.length),a.reset()},this.onWillLeave=function(e){if(d.viewer){var t=require("DS/DMUBaseExperience/DMUContextManager");if(t){var i=t.giveEventsController({viewer:d.viewer.getViewer()});i&&i.fireEvent("onLeavingR3DApp",{targetApp:e&&e.options?e.options.id:""})}}}}}});