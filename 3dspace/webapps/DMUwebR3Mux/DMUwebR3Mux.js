/*!  Copyright 2021 Dassault Systemes. All rights reserved. */
define("DS/DMUwebR3Mux/DMUwebR3Mlist",["UWA/Core","UWA/Class","DS/Utilities/Dom","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/Controls/TooltipModel","DS/Controls/ProgressBar","DS/CollectionView/CollectionViewStatusBar","DS/Windows/Dialog","DS/Controls/Button","i18n!DS/DMUwebR3Mux/assets/nls/DMUwebR3Mux.json","css!DS/DMUwebR3Mux/assets/css/DMUwebR3Mux"],function(e,t,n,i,l,a,o,s,r,d,c,u){"use strict";let m=window.WUXManagedFontIcons.Font3DS;var p,g,f,y,h=function(e,t,n,i){return p=n.options.grid.analysisStateNbKO,g=i.options.grid.analysisStateNbKO,f=n.options.grid.analysisStateDisp,y=i.options.grid.analysisStateDisp,f===y?p===g?0:p<g?-1:1:f<y?-1:1};return t.extend({init:function(t){let p,g,f,y={},w={},b=t.onSelect,C=t.onUnselect,I=t.onFiltersModified,x=t.onInfo,v=t.cbDnD,S=t.columns,F=t.parent,M=t.getFilterValues,E=t.getIsrTypes,D=t.onRelations,R=t.allowRelations,k=t.allowCopyLink,j=t.onCopyLink,A=t.allowUpdateSimulation,O=t.getCSIcomputeToken,V=t.onIssueCells,P=t.onMaturityState,T=t.onAnalysisState,N=t.onMetricIssue,_=t.getFeatureStateInfo,B=t.allowMaturityState,U=t.onValidationState,L=t.allowValidationState,Q=t.onUpdateSimulation,W={show:!1,total:[],completed:[],failed:[]},z=["private","inwork","frozen","released","obsolete","default","exists","inprogress","failed","passed","donenoko","startedwithko","startednoko","donewithko","notcomputed","create","assign","active","review","closed"],q=[{type:r.STATUS.NB_ITEMS},{position:"far",type:r.STATUS.NB_SELECTED_ROWS}];function H(e){return{id:e.options.grid.id,parents:e.getParents().map(function(e){return e.options.grid.id})}}function G(t,n){let i=e.createElement("div",{class:"r3mtweaker "+n});return i.value=t,i.getStringFromValue=function(e){return e||""},i.computeContentSize=function(){let e=15;for(let t=i.childNodes.length-1;t>=0;--t)e+=i.childNodes[t].getDimensions().width;return e},i}function X(e){if(g)return e&&e.nodeModel&&e.cellView?g.getCellDefaultTooltip(e,-1!==(e.nodeModel.options.grid.description||"").search("\n")):g.getCellDefaultTooltip(e)}function K(e){if(!g)return;if(!e||!e.nodeModel||!e.cellView)return g.getCellDefaultTooltip(e);let t=g.getCellDefaultTooltip(e);return{getAllInformationCB:function(){return e.nodeModel.options.grid.validStateWarning?{model:{shortHelp:e.nodeModel.options.grid.validStateWarning},updateModel:!1}:t.getAllInformationCB()}}}function J(e,t,n,i,l,a,r,d){let c;if(n){let l,a=z.indexOf(t)>-1,o=0;if("r3mCellAnalysisState_itfQueryRunning"===t?(l="r3mCellAnalysisState_itfQueryRunning",o=e&&e.nodeModel&&e.nodeModel.options.grid?e.nodeModel.options.grid.analysisStateProgress:0):l="r3mR2VCellState_itfQueryRunning"===t?"r3mR2VCellState_itfQueryRunning":"r3mCellState_"+t+i+(a?"":"_NoColor"),g._reusableCellContentManager.isRegistered(l)||g.registerReusableCellContent({id:l,buildContent:r.bind(null,n,i,a,t,d)}),o>0&&"r3mCellAnalysisState_itfQueryRunning"===t){let e=G("","r3mstatus");new s({value:o}).inject(e),c=e}else c=g.reuseCellContent(l)}e.cellView._setReusableContent(c),e.cellView.tooltipInfos=new o(a?K(e):g.getCellDefaultTooltip(e))}function Y(t,n,i,l,a){let o=G(t,"r3mstatus");return e.createElement("span",{html:t,class:i?"r3mstatuscolored r3m"+l:""}).inject(o),a&&(o.style.textAlign="start",o.style.paddingLeft="5px"),o}function Z(t){var n=e.createElement("div",{class:"spinner spinning",styles:{display:"flex","justify-content":"center",transform:"translate3d(0,0,0)"}}).inject(t);e.createElement("span",{class:"spinner-bar"}).inject(n),e.createElement("span",{class:"spinner-bar spinner-bar1"}).inject(n),e.createElement("span",{class:"spinner-bar spinner-bar2"}).inject(n),e.createElement("span",{class:"spinner-bar spinner-bar3"}).inject(n)}function $(t,n,i,l){let a=G(t,"r3mstatus");if("startedwithko"===l||"donewithko"===l){let o=e.createElement("span",{class:i?"r3mstatuscolored r3m"+l:""}).inject(a);e.createElement("span",{html:t+" "}).inject(o),e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-attention"}).inject(o),e.createElement("span",{html:" "+n}).inject(o)}else if("computed"===l){let i=e.createElement("span",{class:"r3mstatuscolored r3m"+l}).inject(a);e.createElement("span",{html:t+" "}).inject(i),e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-interference-metric"}).inject(i),e.createElement("span",{html:" "+n}).inject(i)}else if(l.contains("r3mCellAnalysisState_itfQueryRunning"))Z(a);else if("Running"===l){let n=e.createElement("span",{class:"r3mstatuscolored r3m"+l}).inject(a);e.createElement("span",{html:t+" "}).inject(n)}else e.createElement("span",{html:t,class:i?"r3mstatuscolored r3m"+l:""}).inject(a);return a}function ee(e){if(!(g&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid;t&&void 0===t.title&&"r2vsurvey"===t.serviceId?(g._reusableCellContentManager.isRegistered("r3mR2VCellState_itfQueryRunning")||g.registerReusableCellContent({id:"r3mR2VCellState_itfQueryRunning",buildContent:function(e){let t=G(e,"r3mR2V_Running");return Z(t),t}.bind(null,"r3mR2VCellState_itfQueryRunning")}),J(e,"r3mR2VCellState_itfQueryRunning","r3mR2VCellState_itfQueryRunning",0,t.id,!1,Y,!0),_({serviceId:t.serviceId,objectId:t.id,validatedObjId:e.nodeModel._parentNode._parentNode.options.grid.id,text:e.nodeModel._parentNode._options.grid.id})):J(e,t.title,t.title,0,t.id,!1,Y,!0)}function te(e){if(!(g&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid,n=(t.maturity||"").split(".");J(e,n=n[n.length-1].toLowerCase().replace("_",""),t.maturityDisp,0,t.id,!1,Y,!1)}function ne(e){if(!(g&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid;J(e,(t.validState||"").toLowerCase(),t.validStateDisp,0,t.id,!0,Y,!1)}function ie(e){if(!(g&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid,n=E();t.analysisState=t.analysisState?t.analysisState:"";let i="running"===t.analysisState||"unknown"===t.analysisState?"r3mCellAnalysisState_itfQueryRunning":t.analysisState;i=i||"",J(e,-1===n.indexOf(t.type)?"":i,t.analysisStateDisp,t.analysisStateNbKO,t.id,!0,$,!1),"unknown"===t.analysisState&&n.indexOf(t.type)>-1&&T([t.id])}function le(t){if(!(g&&t&&t.nodeModel&&t.cellView))return;let n,i=t.nodeModel.options.grid,l=i.id,a=i.validStateWarning,s=(l&&w[l]&&i.validState||"").toLowerCase(),r=E(),d="r3mCellState_validstatewarning";if(!(r.indexOf(i.type)>-1)||g.layout.getColumnVisibleFlag("analysisStateDisp")){if(r.indexOf(i.type)>-1?d=d+(s="inprogress"===s||"failed"===s&&("computed"===i.analysisState||"notcomputed"===i.analysisState||"startednoko"===i.analysisState)?"minorWarning":"majorWarning")+i.analysisState:d+=s="inprogress"===s?"minorWarning":s,a)g._reusableCellContentManager.isRegistered(d)||g.registerReusableCellContent({id:d,buildContent:function(t,n){let i=G(t,"r3mwarning");var l,a;return(l="attention",a="minorWarning"===n?"r3miconcolor":"r3mwarningcolor",e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-"+l+" "+a})).inject(i),e.createElement("span",{html:t,class:"r3mwarningtext"}).inject(i),i}.bind(null,a,s)}),n=g.reuseCellContent(d);else if(!a&&r.indexOf(i.type)>-1&&"running"===i.analysisState){if(i.analysisStateProgress>0&&("running"===i.analysisState||"unknown"===i.analysisState))return;g._reusableCellContentManager.isRegistered("r3mCellState_itfQueryRunning")||g.registerReusableCellContent({id:"r3mCellState_itfQueryRunning",buildContent:function(e){let t=G(e,"r3mwarning");return Z(t),t}.bind(null,"r3mCellState_itfQueryRunning")}),n=g.reuseCellContent("r3mCellState_itfQueryRunning")}t.cellView._setReusableContent(n),t.cellView.tooltipInfos=new o(K(t))}}function ae(e){if(!g||!e||!e.nodeModel)return;let t=g.layout.getDataIndexFromColumnIndex(e.columnID);return Boolean(e.nodeModel.options.grid[t])}function oe(e){let t=e.nodeModel.options.grid;if("Issue"===t.type)return t.r3mIssueAssignees=void 0!==t.r3mIssueAssignees?t.r3mIssueAssignees:"running",""===t.r3mIssueAssignees||"running"===t.r3mIssueAssignees||0===t.r3mIssueAssignees.length?t.r3mIssueAssignee:t.r3mIssueAssignees.map(function(e){return{label:e.label.trim(),url:""===e.url?void 0:e.url}})}function se(e){if(!g||!e||!e.nodeModel)return;let t=g.layout.getDataIndexFromColumnIndex(e.columnID),n=e.nodeModel.options.grid[t];return n?{url:e.nodeModel.options.grid[t+"Img"]?"":void 0,label:n}:void 0}function re(e){b(e.map(H))}function de(e){C(e.map(H))}function ce(){setTimeout(function(){g.reapplySortModel();var t=JSON.parse(localStorage.getItem("r3mGridFilters"));t&&t.filterModel&&!e.equals(t.filterModel,{})&&(p.setFilterModel({}),p.setFilterModel(t.filterModel))},10)}function ue(){var e=g.getNodesXSO().get();e&&0!==e.length&&g.ensureNodeModelVisible(e[0],!1)}function me(t,n,i){let l=G(n,"");if(i.contains("r3mIssueState_Blank"))return l;if(i.contains("r3mCellIssue_QueryRunning"))Z(l);else if("r3mIssuePriority"===g.layout.getDataIndexFromColumnIndex(t.columnID)){let t="";"High"===n?t="high wux-ui-3ds wux-ui-3ds-level-high":"Low"===n?t="low wux-ui-3ds wux-ui-3ds-level-low":"Medium"===n?t="medium wux-ui-3ds wux-ui-3ds-level-medium":"Urgent"===n&&(t="urgent wux-ui-3ds wux-ui-3ds-alert"),e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-"+t+" r3mIssuePriority"+n}).inject(l),e.createElement("span",{html:"  "+n}).inject(l)}return l}function pe(e,t,n,i){let l,a;"r3mCellIssue_QueryRunning"===t?(a="r3mCellIssue_QueryRunning",e.cellView&&e.cellView.elements&&e.cellView.elements.KPIColorDiv&&e.cellView.elements.KPIColorDiv.hide()):a="r3mCellState_"+t+n,g._reusableCellContentManager.isRegistered(a)||g.registerReusableCellContent({id:a,buildContent:i.bind(null,e,n,t)}),l=g.reuseCellContent(a),e.cellView._setReusableContent(l),e.cellView.getContent().removeAttribute("no-tweaker")}function ge(e){var t=g.columns[e.columnID].dataIndex,n=[];(n=g.getTreeDocument().getSelectedNodes().filter(function(e){return!e.options.grid.isNonEditable})).length||n.push(e.nodeModel),p.withTransactionUpdate(function(){n.forEach(function(e){if(e.options.grid.hasOwnProperty(t)){var n={};n[t]=e.options.grid.r3mIssueApprovals,e.updateOptions({grid:n})}})})}function fe(e){if(!e||-1===e.rowID||!e.nodeModel)return;let t=e.nodeModel.options.grid.r3mIssueApprovals;return void 0!==t&&"running"!==t&&""!==t?"independantBoolean":void 0}function ye(e){if(!e||-1===e.rowID||!e.nodeModel)return;let t=e.nodeModel.options.grid.r3mIssueAssignees;return void 0!==t&&"running"!==t&&""!==t?"user":void 0}function he(e,t){let n=void 0!==t?t:"running";if("running"!==n)return g.defaultOnCellRequest(e);pe(e,"running"===n?"r3mCellIssue_QueryRunning":n,n,me)}function we(e){if(!(g&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid;"Issue"!==t.type&&(t.r3mIssueApprovals=t.r3mIssueAssignees=t.r3mIssuePriority=t.r3mIssueResolvedBy="");var n=g.layout.getDataIndexFromColumnIndex(e.columnID);if("r3mIssueAssignees"===n)he(e,t.r3mIssueAssignees);else if("r3mIssueApprovals"===n)he(e,t.r3mIssueApprovals);else if("r3mIssueResolvedBy"===n)he(e,t.r3mIssueResolvedBy);else if("r3mIssuePriority"===n){t.r3mIssuePriority=void 0!==t.r3mIssuePriority?t.r3mIssuePriority:"running",pe(e,"running"===t.r3mIssuePriority?"r3mCellIssue_QueryRunning":t.r3mIssuePriority,t.r3mIssuePriority,me)}"running"===t.r3mIssueResolvedBy&&V([t.id])}function be(e){var t="";return"r3mIssueAssignees"===g.layout.getDataIndexFromColumnIndex(e.columnID)&&(t=e.cellModel.map(e=>e.label).toString()),t}this.deleteNodes=function(e,t){let n=y[e],i=y[t];n&&i&&(1===i.length?y[t]=void 0:y[t]=y[t].filter(function(e){return e.getParent()!==n[0]}),n[0].removeChildren())},this.updateValidations=function(e,t,n,i){p.withTransactionUpdate(function(){Object.keys(e).forEach(function(e){var t=n?function e(t,n){let i,l=this[n],a={label:l.title,grid:l},o=y[n];return l.icon&&(a.icons=[{iconPath:l.icon}]),t.search({match:function(e){e.nodeModel.options.grid.id===l.id&&(i=e.nodeModel)}}),o.forEach(t=>{t.updateOptions(a),Object.keys(l.children||{}).forEach(e.bind(l.children,t))}),i}.call(this,p,e):function e(t,n){let i,a=this[n],o={label:a.title,grid:a},s=y[n];a.icon&&(o.icons=[{iconPath:a.icon}]);let r=E();return-1===W.total.indexOf(a.id)&&r.indexOf(a.type)>-1&&W.total.push(a.id),(t.getChildren()||[]).some(e=>{if(e.options.grid.id===a.id)return i=e}),i||(i=new l(o),t.addChild(i),s?s.push(i):s=y[n]=[i]),a.noSort&&(i.sortChildren=function(e){e.isRecursive&&this.getChildren().forEach(function(t){t.sortChildren(e)})}),s.forEach(t=>{t.updateOptions(o),Object.keys(a.children||{}).forEach(e.bind(a.children,t))}),i}.call(this,p,e);w[e]||(w[e]=t),i&&t.expand()},e)}),t||ce()},this.updateStatusBar=function(e,t){"success"===t&&-1!==W.completed.indexOf(e)||"failure"===t&&-1!==W.failed.indexOf(e)||("success"===t&&-1===W.completed.indexOf(e)?W.completed.push(e):"failure"===t&&-1===W.failed.indexOf(e)&&W.failed.push(e),function(){let e=W.total.length;if(e>0){var t=e>0?(W.completed.length+W.failed.length)/e*100:100;if(e-(W.completed.length+W.failed.length)<=0&&(W.completed.length=W.failed.length=0,t=100),W.show){const e=q.findIndex(e=>"progressId"===e.id);-1===e&&100!==t?(q.push({type:r.STATUS.CUSTOM,id:"progressId",position:"center",dataElements:{typeRepresentation:"progress",value:t,tooltip:u.gridAnalysisFilterStatus}}),g.buildStatusBar(q)):-1!==e&&100===t?(q=q.filter(e=>"progressId"!==e.id),W.show=!1,g.buildStatusBar(q)):g.elements.statusBar.getNodeModelByID("progressId").updateOptions({grid:{data:t}})}}}())},this.checkFilterAndFetchValue=function(){if(!g||!p)return;let e=JSON.parse(localStorage.getItem("r3mGridFilters"));if(-1!==g.sortModel.findIndex(e=>"analysisStateDisp"===e.dataIndex||"validStateWarning"===e.dataIndex)||e&&e.filterModel&&(e.filterModel.hasOwnProperty("analysisStateDisp")||e.filterModel.hasOwnProperty("validStateWarning"))){let e=E();p.getAllDescendants().forEach(function(t){let n=t.options.grid;e.indexOf(n.type)>-1&&"unknown"===n.analysisState&&(W.show=!0,T([n.id],!1))})}},this.setInfoState=function(e){let t=g.getToolbar().array3[0].tweaker.elements.container,n=t.hasClassName("r3mInfoColor");n&&!e?t.removeClassName("r3mInfoColor"):!n&&e&&t.addClassName("r3mInfoColor")},this.expanReviewNode=function(e,t){setTimeout(function(){g.subscribeOnceToAllCellsRendered(function(){Object.keys(e).forEach(function(e){w[e]&&w[e].expandAll()},e);var n=[];t&&t.objects&&t.objects.forEach(function(e){g&&g.model&&g.model.forEach(function(t){t&&t.options&&t.options.grid&&t.options.grid.id&&t.options.grid.id===e.highlightId&&n.push(t)})}),p.withTransactionUpdate(function(){g.unselectAll(),g.setActiveCell(-1,!1,!1),n.forEach(function(e){g.selectNodeModel(e,!0,!1)}),g.ensureNodeModelVisible(n[0],!1,!0)})})},30)},this.getSelectedRows=function(){return g.getNodesXSO().get().map(H)},this.onTenantModified=function(e){let t={tree:"title",name:"name",typeDisp:"type",maturityDisp:"maturity",validStateDisp:"validState",description:"description",owner:"owner",originator:"originator",organization:"organization",dateModif:"dateModif",dateCreat:"dateCreat",collabSpace:"collabSpace"};f.forEach(n=>{n.text=e[t[n.dataIndex]?t[n.dataIndex]:n.dataIndex]})},this.removeValidation=function(e){p.withTransactionUpdate(function(){e.forEach(function(e){w[e]&&p.removeRoot(w[e]);let t=y[e]&&y[e].indexOf(w[e]);t>-1&&y[e].splice(t,1),!y[e].length&&delete y[e],delete w[e]}),ce()})},this.removeAll=function(){g.getNodesXSO().empty(),p.empty(),y={},w={}},function(){function t(e,t){var n=e.getSize(),i=t.getSize(),l=(i.width-n.width)/2,a=(i.height-n.height)/2;e.setStyles({left:l<0?0:l,top:a<0?0:a})}function l(){let e=this.showCustomViewsDialog();function i(){Object.keys(e.buttons).forEach(function(t){e.buttons[t].removeEventListener("click",l)}),e.removeEventListener("close",i),n.removeResizeListener(F)}t(e.elements.container,F),Object.keys(e.buttons).forEach(function(t){e.buttons[t].addEventListener("click",i)}),e.addEventListener("close",i),n.addResizeListener(F,function(){t(e.elements.container,F)})}f=[{dataIndex:"tree",text:S.title,onCellRequest:ee,groupableFlag:!1},{dataIndex:"name",text:S.name,width:150,visibleFlag:!1,groupableFlag:!1},{dataIndex:"typeDisp",text:S.type,width:150,visibleFlag:!1,groupableFlag:!1,alignment:"center"},{dataIndex:"maturityDisp",text:S.maturity,onCellRequest:te,width:90,groupableFlag:!1},{dataIndex:"validStateDisp",text:S.validState,onCellRequest:ne,width:100,groupableFlag:!1},{dataIndex:"validStateWarning",icon:{iconName:"attention",fontIconFamily:m},onCellRequest:le,width:60,minWidth:30,groupableFlag:!1},{dataIndex:"analysisStateDisp",text:S.analysisState,onCellRequest:ie,width:150,compareFunction:h,visibleFlag:!1,groupableFlag:!1},{dataIndex:"description",text:S.description,getCellTooltip:X,width:300,groupableFlag:!1},{dataIndex:"owner",text:S.owner,typeRepresentation:"user",hasCellValue:ae,getCellValue:se,width:150,groupableFlag:!1},{dataIndex:"originator",text:S.originator,typeRepresentation:"user",hasCellValue:ae,getCellValue:se,width:150,visibleFlag:!1,groupableFlag:!1},{dataIndex:"organization",text:S.organization,width:100,visibleFlag:!1,groupableFlag:!1},{dataIndex:"dateModif",text:S.dateModif,typeRepresentation:"datetime",width:150,groupableFlag:!1},{dataIndex:"dateCreat",text:S.dateCreat,typeRepresentation:"datetime",width:150,visibleFlag:!1,groupableFlag:!1},{dataIndex:"collabSpace",text:S.collabSpace,visibleFlag:!1,groupableFlag:!1},{dataIndex:"r3mIssueName",text:S.r3mIssueName,editableFlag:!1,visibleFlag:!1,width:"auto"},{dataIndex:"r3mIssuePriority",text:S.r3mIssuePriority,onCellRequest:we,typeRepresentation:"url",editableFlag:!1,visibleFlag:!0,width:"auto"},{dataIndex:"r3mIssueApprovals",text:S.r3mIssueApprovals,editionPolicy:"EditionInPlace",setCellValue:ge,getCellTypeRepresentation:fe,onCellRequest:we,editableFlag:!0,visibleFlag:!1},{dataIndex:"r3mIssueAssignees",text:S.r3mIssueAssignees,getCellTypeRepresentation:ye,onCellRequest:we,getCellValue:oe,getCellValueForExport:be,editableFlag:!1,visibleFlag:!1},{dataIndex:"r3mIssueResolvedBy",text:S.r3mIssueResolvedBy,onCellRequest:we,editableFlag:!1,visibleFlag:!1}],p=new i({shouldAcceptDrag:function(){return!0},shouldAcceptDrop:function(){return!1}});var o=e.createElement("div",{class:"r3mListPlaceHolder"});e.createElement("p",{html:u.placeHolderFst,styles:{"text-align":"center"}}).inject(o);var s=e.createElement("div",{styles:{"font-weight":"normal","text-align":"center"}}).inject(o);e.createElement("span",{html:u.placeHolderSnd+" "}).inject(s),e.createElement("span",{class:"fonticon fonticon-list-filter"}).inject(s);var r={identifier:"r3mDataGridView",treeDocument:p,defaultColumnDef:{width:"auto",height:"auto",editableFlag:!1},columns:f,rowSelection:"multiple",cellSelection:{defaultValue:"none"},rowGroupingEnabledFlag:!1,sortModel:[{dataIndex:"tree",sort:"asc"}],rowDragEnabledFlag:!0,allowUnsafeHTMLContent:!1,cellDragEnabledFlag:!0,activateAllCellsRenderedEventFlag:!0,placeholder:o,recId:"r3mValidationList",onContextualEvent:function(t){if(t){var n=[],i=t.cellInfos;if(t.collectionView&&i)if(-1===i.rowID&&-1!==i.columnID){let e=g.layout.getDataIndexFromColumnIndex(t.cellInfos.columnID);"tree"===e&&(e="label");var a=["typeDisp","maturityDisp","validStateDisp","analysisStateDisp","validStateWarning","owner"].indexOf(e)>-1?"set":"string";if(p.getFilterManager().getFilters().hasOwnProperty(e)){var o=p.getFilterManager().getFilters()[e];o&&o.defaultFilterModel&&(o.defaultFilterModel=[])}else p.getFilterManager().setPropertyFilterModel(e,{filterId:a});(n=t.collectionView.buildDefaultContextualMenu(t,{pin:!0,firstColumnsVisibility:!1,sizeColumnToFit:!0,columnsManagement:!1})).push({type:"PushItem",title:u.mnuExpandAllRows,icon:{iconName:"flow-tree-expand-down",fontIconFamily:m},action:{callback:function(){p.withTransactionUpdate(function(){Object.values(w).forEach(function(e){e.expandAll()})})}}}),n.push({type:"PushItem",title:u.mnuCollapseAllRows,icon:{iconName:"flow-tree-expand-up",fontIconFamily:m},action:{callback:function(){p.withTransactionUpdate(function(){Object.values(w).forEach(function(e){e.collapseAll()})})}}}),n.push({type:"SeparatorItem",title:""}),"label"!==e&&n.push({type:"PushItem",title:u.mnuHideCol,action:{callback:function(){g.layout.setColumnVisibleFlag(g.layout.getDataIndexFromColumnIndex(t.cellInfos.columnID),!1,{isUserInteraction:!0})}}}),n.push({type:"SeparatorItem",title:""}),n.push({type:"PushItem",title:u.mnuCustomView,action:{callback:l.bind(t.collectionView)}})}else if(-1!==i.columnID&&-1!==i.rowID){var s=g.getNodesXSO().get();s.some(function(e){return e.canBeExpanded()&&(!e.isExpanded()||e.getAllDescendants().some(function(e){return e.canBeExpanded()&&!e.isExpanded()}))})&&n.push({type:"PushItem",title:u.mnuExpandAll,icon:{iconName:"flow-tree-expand-down",fontIconFamily:m},action:{callback:function(){p.withTransactionUpdate(function(){g.getNodesXSO().get().forEach(function(e){e.expandAll()})})}}}),s.some(function(e){return e.canBeExpanded()&&(e.isExpanded()||e.getAllDescendants().some(function(e){return e.canBeExpanded()&&e.isExpanded()}))})&&n.push({type:"PushItem",title:u.mnuCollapseAll,icon:{iconName:"flow-tree-expand-up",fontIconFamily:m},action:{callback:function(){p.withTransactionUpdate(function(){g.getNodesXSO().get().forEach(function(e){e.collapseAll()})})}}}),n.length&&n.push({type:"SeparatorItem"});let t=R(),i=A(),l=B(),a=L(),o=k();(t&&t.length||l&&l.length||a&&a.length)&&n.push({type:"PushItem",title:u.mnuRelations,icon:{iconName:"object-related",family:m},action:{callback:D}}),o&&o.length&&n.push({type:"PushItem",title:u.mnuCopyLink,icon:{iconName:"link",family:m},action:{callback:j}}),l&&l.length&&n.push({type:"PushItem",title:u.mnuMaturity,icon:{iconName:"collaborative-lifecycle-management",family:m},action:{callback:P}}),a&&a.length&&a[0].display&&n.push({type:"PushItem",title:u.mnuValidation,icon:{iconName:"check",family:m},action:{callback:U}}),i>0&&n.push({type:"PushItem",title:u.mnuUpdateSimulation,state:2===i?"disabled":"enabled",icon:{iconName:"update",family:m},action:{callback:function(){!function(t){O().then(function(n){let i=e.createElement("div",{class:"r3mCsiCompute"}),l=3===t?e.createElement("span",{class:"wux-ui-3ds wux-ui-3ds-4x wux-ui-3ds-attention r3mwarningcolor"}):e.createElement("span",{class:"wux-ui-3ds wux-ui-3ds-4x wux-ui-3ds-info r3mInfocolor"});l.setStyles({"vertical-align":"middle"}),l.inject(i);let a=u.replace(n>1?u.csiIsrTokens:u.csiIsrToken,{label:n}).replace(/"/g,"");e.createElement("label",{text:a,styles:{"margin-bottom":"0px",padding:"25px 10px","font-size":"14px","font-weight":"normal"}}).inject(i);var o=new d({immersiveFrame:void 0,title:u.csiIsrUpdateIsr,content:i,modalFlag:!0,activeFlag:!1,buttons:3===t?{Ok:new c({label:u.pnlCancel,onClick:function(){o.destroy()}})}:{Ok:new c({onClick:function(){o.destroy(),Q()}}),Cancel:new c({onClick:function(){o.destroy()}})}})})}(i)}}})}return n}}};Object.keys(v).forEach(function(e){r[e]=v[e]}),v=null,(g=new a(r)).getContent().addClassName(r.identifier),window.__karma__&&(g.layout.addCellCoordinates=!0);var y=g.getNodesXSO();y.options.getElementID=void 0,y.onPostAdd(re),y.onPostRemove(de),g.addEventListener("DSpointerhit",function(e,t){e&&e.multipleHitCount>1&&t&&t.columnID>=0&&t&&t.rowID>=0&&x()}),p.onPostCollapse(function(){setTimeout(function(){g.invalidateLayout({updateCellLayout:!0,freePool:!0})},0)}),p.onPostExpand(function(){setTimeout(function(){g.invalidateLayout({updateCellLayout:!0,freePool:!0})},0),function(){let e=E();p.getAllDescendants().forEach(function(t){let n=t.options.grid;e.indexOf(n.type)>-1&&t.isExpanded()&&N([n.id],!1)})}()}),p.getFilterManager().subscribe("filterModelChange",function(){setTimeout(function(){let t=e.clone(p.getFilterManager().filterModel,!0);t=Object.keys(t).reduce((e,n)=>(t[n].filterModel&&Object.keys(t[n].filterModel).length>0&&(e[n]=t[n]),e),{}),localStorage.setItem("r3mGridFilters",JSON.stringify({filterModel:t})),ue()},10)}),p.getModelEvents().subscribe({event:"sortChildren"},function(){setTimeout(function(){ue()},10)});var b=e.createElement("div",{class:"r3mPanel wux-windows-window-maincontent"}).inject(F),C=e.createElement("div",{class:"wux-windows-window-header"}).inject(b);g.setToolbar({entries:[{id:"listFilter",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"list-filter",fontIconFamily:m},position:"near",value:function(){require(["DS/Controls/Button","DS/Windows/Dialog","DS/Controls/Toggle","DS/Controls/ButtonGroup"],function(i,l,a,o){let s,r,d=e.createElement("div"),c=M(),m=e.createElement("div").inject(d);var p;"1"===localStorage.getItem("R3MFromCopylink")&&(p=new a({label:u.pnlMySelection,value:"idMySelection",type:"checkbox",checkFlag:1===c.myselection}).inject(m),m=e.createElement("div",{styles:{"margin-top":"10px"}}).inject(d));var g=new e.createElement("span",{class:"fonticon fonticon-3ds-who",styles:{color:c.myselection?"#BCBCBC":"#000000"}}).inject(m),f=e.createElement("label",{text:u.pnlOwner,class:c.myselection?"r3mFilterPanelDisable":"r3mFilterOwner",styles:{"margin-left":"2px"}}).inject(m);m=e.createElement("div",{styles:{"margin-left":"20px"}}).inject(d);var y=new o({type:"radio",disabled:c.myselection}).inject(m);y.addChild(new a({label:u.pnlMe,value:0,type:"radio",checkFlag:0===c.owner,disabled:c.myselection})),y.addChild(new a({label:u.pnlOrga,value:1,type:"radio",checkFlag:1===c.owner,disabled:c.myselection})),m=e.createElement("div").inject(d);var h=e.createElement("span",{class:"fonticon fonticon-3ds-what",styles:{color:c.myselection?"#BCBCBC":"#000000"}}).inject(m),w=e.createElement("label",{text:u.pnlMaturity,class:c.myselection?"r3mFilterPanelDisable":"r3mFilterMaturity",styles:{"margin-left":"2px","margin-top":"10px"}}).inject(m);m=e.createElement("div",{styles:{"margin-left":"20px"}}).inject(d);var b=new a({label:u.pnlReleased,value:"idReleased",type:"checkbox",checkFlag:1===c.released,disabled:c.myselection}).inject(m),C=new a({label:u.pnlObsolete,value:"idObsolete",type:"checkbox",checkFlag:1===c.obsolete,disabled:c.myselection}).inject(m);m=e.createElement("div").inject(d);var x=e.createElement("span",{class:"fonticon fonticon-3ds-what",styles:{color:c.myselection?"#BCBCBC":"#000000"}}).inject(m),v=e.createElement("label",{text:u.pnlType,class:c.myselection?"r3mFilterPanelDisable":"r3mFilterType",styles:{"margin-left":"2px","margin-top":"10px"}}).inject(m);m=e.createElement("div",{styles:{"margin-left":"20px"}}).inject(d);var S=new a({label:u.pnlRvw,value:"idRvw",type:"checkbox",checkFlag:1===c.rvw,disabled:c.myselection}).inject(m),E=new a({label:u.pnlIsr,value:"idIsr",type:"checkbox",checkFlag:1===c.isr,disabled:c.myselection}).inject(m),D=new a({label:u.pnlMsr,value:"idMsr",type:"checkbox",checkFlag:1===c.msr,disabled:c.myselection}).inject(m),R=new a({label:u.pnlMkp,value:"idMkp",type:"checkbox",checkFlag:1===c.mkp,disabled:c.myselection}).inject(m);function k(e){return Array.isArray(e.value)?e.value[0]:e.checkFlag?1:0}function j(){n.removeResizeListener(F),s.destroy()}p&&p.addEventListener("buttonclick",function(){g&&(g.style.color=p.checkFlag?"#BCBCBC":"#000000"),f&&f.setAttributes({class:p.checkFlag?"r3mFilterPanelDisable":"r3mFilterOwner"}),y&&(y.getContent().children[0].dsModel.disabled=p.checkFlag?1:0,y.getContent().children[1].dsModel.disabled=p.checkFlag?1:0),h&&(h.style.color=p.checkFlag?"#BCBCBC":"#000000"),w&&w.setAttributes({class:p.checkFlag?"r3mFilterPanelDisable":"r3mFilterMaturity"}),x&&(x.style.color=p.checkFlag?"#BCBCBC":"#000000"),v&&v.setAttributes({class:p.checkFlag?"r3mFilterPanelDisable":"r3mFilterMaturity"}),b&&(b.disabled=p.checkFlag?1:0),C&&(C.disabled=p.checkFlag?1:0),S&&(S.disabled=p.checkFlag?1:0),E&&(E.disabled=p.checkFlag?1:0),D&&(D.disabled=p.checkFlag?1:0),R&&(R.disabled=p.checkFlag?1:0)});var A=new i({emphasize:"primary",label:u.pnlOK,onClick:function(){j(),W.total.length=W.completed.length=W.failed.length=0,I({rvw:k(S),isr:k(E),mkp:k(R),msr:k(D),owner:k(y),released:k(b),obsolete:k(C),myselection:p?k(p):0})}}),O=new i({label:u.pnlCancel,onClick:j});s=e.createElement("div",{class:"wux-windows-modalDialog",styles:{}}).inject(F),(r=new l({title:u.pnlTitle,ensureHeightDefinitionOnHierarchy:!0,content:d,resizableFlag:!0,height:345,position:{of:F,constraint:F},buttons:{Cancel:O,Ok:A}})).elements.container.inject(s),r.addEventListener("close",j),t(r.elements.container,F),n.addResizeListener(F,function(){t(r.elements.container,F)})})}}},{id:"sidePanel",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"info",fontIconFamily:m},position:"far",value:x}}]}).inject(C);var V=e.createElement("div",{class:"wux-windows-window-content"}).inject(b);g.inject(V),n.addEventOnElement(b,b,"dimensionsChanged",function(){var e=window.getComputedStyle(V),t=e?e.getPropertyValue("padding-top"):"";t=""===t?0:parseInt(t,10);var n=e?e.getPropertyValue("padding-bottom"):"";n=""===n?0:parseInt(n,10);var i=C.offsetHeight+t+n;V.setStyle("height",i?"calc(100% - "+i+"px)":"100%")}),g.buildStatusBar(q)}()}})});