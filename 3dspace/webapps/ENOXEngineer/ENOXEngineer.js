define("DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/LevelSelector",["UWA/Core","DS/Controls/Abstract","DS/Controls/SpinBox","DS/Core/PointerEvents","DS/Utilities/Dom","css!DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/css/LevelSelector.css"],function(e,t,n,i,r){"use strict";return t.inherit({name:"LevelSelector",markForRecordFlag:!0,publishedProperties:{expandLevel:{defaultValue:"1",type:"string",category:"Appearance"},onLevelSelectorSet:{defaultValue:void 0,type:"function"},onLevelSelectorClose:{defaultValue:void 0,type:"function"}},buildView:function(){var t=this;this.elements.container.addClassName("enox-levelselector"),this.elements.levelSelContainer=new e.Element("div",{class:"enox-levelselector-container"}).inject(this.elements.container),this.elements.spinBox=new n({value:1,minValue:1,stepValue:1,pageStepValue:1}).inject(this.elements.levelSelContainer),this.elements.spinBox.getContent().addClassName("enox-levelselector-spinbox"),r.addEventOnElement(this,this.elements.spinBox.getContent(),"keydown",function(n){var i=e.Event.whichKey(n);"return"===i?t._levelSelected():"esc"===i&&t.close()}),this.elements.separator=new e.Element("div",{class:"enox-levelselector-separator",html:"|"}).inject(this.elements.levelSelContainer),this.elements.checkSelBtn=new e.Element("div",{class:"enox-levelselector-checkSel-btn"}).inject(this.elements.levelSelContainer),r.generateIcon("check",{target:this.elements.checkSelBtn}),r.addEventOnElement(this,this.elements.checkSelBtn,i.POINTERHIT,function(e){t._levelSelected(),e.stopPropagation()})},close:function(){this.visibleFlag=!1,this.onLevelSelectorClose&&this.onLevelSelectorClose()},_levelSelected:function(){var e=this.elements.spinBox.value;this.onLevelSelectorSet&&this.onLevelSelectorSet(e)}})}),define("DS/ENOXEngineer/services/SessionPredicates/SessionPredicatesErrors",[],()=>{class e extends Error{}return{WrongInput:class extends e{constructor(e){super(),this.message=`wrong input for ${e}`}},DicoFetchError:class extends e{constructor(e){super(),this.message=`dico fetch fails for classes ${e}`}},ClassifFetchError:class extends e{constructor(){super(),this.message="classification fetch fails"}},JobsRunnerError:class extends e{constructor(){super(),this.message="classification fetch fails"}},MissingImplementation:class extends e{constructor(){super(),this.message="mising implementation"}},SessionPredicateEditionError:class extends e{},ReadAttributeInfoFacadeError:class extends e{},AbortMultiPredicateChooser:class extends e{}}}),define("DS/ENOXEngineer/componentsHelpers/XEngAutoComplete/XEngAutoComplete",["UWA/Core","DS/UIKIT/Autocomplete","WebappsUtils/WebappsUtils"],function(e,t,n){"use strict";return t.extend({defaultOptions:{placeholder:"Search ...",minLengthBeforeSearch:3,multiSelect:!0,closableItems:!0,floatingSuggestions:!0,nbResultsToShow:20,targetTypes:[],sources:[],precondition:null,datasetName:"xeng_data",typeDelayBeforeSearch:500,objectMapper:null},init:function(e){this._parent(e),this.appCore=e.appCore,this.initXEngAutocomplete()},autocompleteDataParser:function(t,n){var i=this;if(!e.is(i.options.objectMapper,"function"))throw new Error("options.objectMapper is a mandatory parameter");return n.map(function(e){return i.options.objectMapper(e)})},initXEngAutocomplete:function(){var t=this;this.addDataset({name:t.options.datasetName,items:[],remoteSearchEngine:function(n,i){var r,o=this;return new Promise(function(s,a){t.appCore.dataService.fireAutocompleteSearch({criteria:i,targetTypes:t.options.targetTypes,nresults:t.options.nbResultsToShow,sources:t.options.sources,precond:t.options.precondition}).then(function(t){(r={}).matchingItems=[],t&&(r.matchingItems=e.is(n.dataParser,"function")?n.dataParser.call(o,n,t):o.defaultDataParser(t)),r.dataset=n,s(r)}).catch(function(e){e.type="error",e.dataset=n,a(e)})})},dataParser:function(e,n){return t.autocompleteDataParser(e,n)}},{templateEngine:function(t,i,r){var o;t.addClassName("xeng-template"),(o=e.createElement("span",{class:"item-label"})).setText(r.label),t.setContent([e.createElement("img",{src:r.icon||n.getWebappsAssetUrl("ENOXEngineer","img/defaultIcon.png")}),o])},onError:function(){console.error(arguments)}})},_addSearchButton:function(){return UWA.createElement("span",{class:" fonticon fonticon-search"})},setSelection:function(e){Array.isArray(e)&&this.dispatchEvent("onSelect",e)},onSelect:function(e,t){this._parent(e,t),this.onSelectXeng&&this.onSelectXeng(e)},onUnselect:function(e,t,n,i){this._parent(e,t,n,i),this.onUnselectXeng&&this.onUnselectXeng(e)},buildSkeleton:function(){var e=this;this._parent();var t=this.elements,n=this.name;t.inputWrapper=UWA.createElement("div",{class:n+"-searchbox-wrapper xEng-autocomplete"}).inject(t.container,"top"),t.inputContainer.remove(),t.inputContainer.inject(t.inputWrapper),t.xengSearch=this._addSearchButton(),t.xengSearch.removeEvent("click"),t.xengSearch.addEvent("click",function(n){var i=t.inputContainer.getElement("input");i&&e.onSearchClick(i.value)}),t.xengSearch.inject(t.inputWrapper)},onSearchClick:function(e){console.warn("onSearchClick need to be implemented")}})}),define("DS/ENOXEngineer/componentsHelpers/ENOXFindCommand/js/XENPanel",["DS/Windows/ImmersiveFrame","DS/Windows/Dialog"],(e,t)=>{"use strict";return class{constructor(n){this.elements={},this.options=n||{},this.options={target:null,events:{onClose:this.close.bind(this)},closeCB:void 0,...this.options},this.elements.immframe=new e;const i=Object.assign({immersiveFrame:this.elements.immframe,...this.options,resizableFlag:!1});return this.elements.dialog=new t(i),this.elements.dialog.addEventListener("close",this.close.bind(this)),this.options.target.appendChild(this.elements.immframe.getContent()),this}close(){this.elements.immframe.getContent().remove(),this.elements.dialog.destroy(),"function"==typeof this.options.closeCB&&this.options.closeCB()}closePanel(){this.elements.dialog.close()}getContent(){return this.elements.dialog.getContent()}}}),define("DS/ENOXEngineer/components/NavigationTopBar/NavigationTopBar",["DS/ENOXPageToolBar/js/PageToolBar","css!DS/ENOXEngineer/components/NavigationTopBar/NavigationTopBar.css"],function(e){"use strict";var t=function(){};return t.prototype.init=function(t,n){this._sandbox=t,this._modelEvent=t.getApplicationBroker(),this._subscribeList=[];var i={withInformationButton:!0,withWelcomePanelButton:!0,modelEvents:this._modelEvent,parentContainer:n};this._pageToolBar=new e(i),this._pageToolBar.render().inject(n),this._subscribeToEvents()},t.prototype._subscribeToEvents=function(){var e=this;this._subscribeList.push(this._modelEvent.subscribe({event:"welcome-panel-collapse"},function(){e._modelEvent.publish({event:"triptych-set-size",data:{size:40,side:"left"}}),e._modelEvent.publish({event:"triptych-show-panel",data:"left"})})),this._subscribeList.push(this._modelEvent.subscribe({event:"welcome-panel-expand"},function(){e._modelEvent.publish({event:"triptych-set-size",data:{size:300,side:"left"}}),e._modelEvent.publish({event:"triptych-show-panel",data:"left"})})),this._subscribeList.push(this._modelEvent.subscribe({event:"information-panel-close"},function(){e._modelEvent.publish({event:"triptych-hide-panel",data:"right"})})),this._subscribeList.push(this._modelEvent.subscribe({event:"information-panel-open"},function(){e._modelEvent.publish({event:"triptych-show-panel",data:"right"}),e._modelEvent.publish({event:"information-panel-visible",data:null})})),this._subscribeList.push(this._modelEvent.subscribe({event:"triptych-panel-hidden"},function(t){"right"===t&&e._modelEvent.publish({event:"information-panel-hidden",data:null})}))},t.prototype.setTitle=function(e){this._pageToolBar.getBodyContent().innerHTML=e},t.prototype.destroy=function(e){var t=0,n=this._subscribeList.length;for(t=0;t<n;t++)this._modelEvents.unsubscribe(this._subscribeList[t])},t}),define("DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/ExpandLevelModal",["DS/Utilities/Dom","DS/Windows/Dialog"],function(e,t){"use strict";function n(n){this.elements={},this.options=n||{};var i=Object.assign({resizableFlag:!0,modalFlag:!0},this.options);return this.elements.dialog=new t(i),this.elements.dialog.addEventListener("close",this.close.bind(this)),this.options.modalOpened=!0,document.querySelector(".wux-windows-modalDialog").addEventListener("click",function(t){e.firstParentWithClass(t.target,"wux-windows-window-content")||"function"!=typeof this.options.events.onClickOutsideContent||this.options.events.onClickOutsideContent()}.bind(this)),this}return n.prototype.close=function(){!0===this.options.modalOpened&&(this.options.modalOpened=!1,this.elements.dialog.close(),this.elements.dialog=null)},n.prototype.destroy=function(){!0===this.options.modalOpened&&this.close(),delete this.options},n.prototype.getContent=function(){return this.elements.dialog.getContent()},n}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityComponent",[],()=>{return class{constructor(){this.isActivate=!1}get isActivated(){return this.isActivate}init(){}activate(){this.isActivate=!0}deactivate(){this.isActivate=!1}destroy(){}buildUIComponent(){}update(){}}}),define("DS/ENOXEngineer/componentsHelpers/UploadViewer/UploadViewer",["UWA/Core","UWA/Controls/Abstract","DS/Handlebars/Handlebars4","DS/Windows/Dialog","DS/Controls/ProgressBar","text!DS/ENOXEngineer/componentsHelpers/UploadViewer/UploadTemplate.html","css!DS/ENOXEngineer/componentsHelpers/UploadViewer/XENUploadViewer.css"],function(e,t,n,i,r,o){"use strict";return t.extend({defaultOptions:{},init:function(e){if(this._parent(e),this.nls=e.nlsManager,!e.immersiveFrame)throw new Error("missing immersiveFrame");this.immersiveFrame=e.immersiveFrame,this.nls||(this.nls={get:function(e){return e},replace:function(e){return e}}),this._viewCounter=0,this._trackers=[],this.buildSkeleton()},_onProgressGenerator:function(e){var t=this;return function(n){t._onProgressUpdater(e,n)}},_onCompleteGenerator:function(e){var t=this;return function(n){t._onCompleteUpdater(e,n)}},_onCompleteUpdater:function(e,t){console.warn(" --\x3e "+e),console.warn(t);var n=this._getTracker(e),i=this;if(n){n.progressbar.destroy(),n.progressbar=null,n.state="done";var o=t?i.nls.get("job.complete.sucessful"):i.nls.get("job.complete.failed");i.panelContent.getElement(".xen-file-tile"+n.trackerId+" .status-name").setContent(o),n.progressbar=new r({displayStyle:"lite",value:100,emphasize:t?"success":"high-attention"}).inject(i.panelContent.getElement(".xen-file-tile"+n.trackerId+" .progress-bar")),setTimeout(function(){i._removeTrackerView(n);var e=i._trackers.findIndex(function(e){return e.trackerId===n.trackerId});i._trackers.splice(e,1),delete n.onProgress,delete n.onComplete,delete n.trackerId,delete n.state,delete n.progressbar,0===i._trackers.length&&i._displayEmptyView()},2e3)}},_onProgressUpdater:function(e,t){var n=this._getTracker(e);n&&t&&(n.progressbar.value=Math.round(t.loaded/t.total*100)/100*100,this._updateAllTrackers())},_updateAllTrackers:function(){var e=this;e._trackers.forEach(function(t){"inifinite"!==t.state&&100===t.progressbar.value&&e.changeStateToInfinte(t)})},changeStateToInfinte:function(e){e&&(e.progressbar.destroy(),e.progressbar=null,e.state="inifinite",this.panelContent.getElement(".xen-file-tile"+e.trackerId+" .status-name").setContent(this.nls.get("processing")),e.progressbar=new r({displayStyle:"lite",infiniteFlag:!0}).inject(this.panelContent.getElement(".xen-file-tile"+e.trackerId+" .progress-bar")))},_displayEmptyView:function(){if(this.panelContent){var e=this;this.panelContent.empty(),this.panelContent.setContent("<center> "+this.nls.get("notFileToUpload")+"</center>"),this.hideToken=setTimeout(function(){e.panel.hide()},1e3)}},_getTracker:function(e){return Array.isArray(this._trackers)&&e?this._trackers.find(function(t){return t.trackerId===e}):null},getUploadTracker:function(t){if(t&&t.fileName){var n=(65536*(1+Math.random())|0).toString(16).substring(1),i=e.extend({},t,!0),r={trackerId:n,onProgress:this._onProgressGenerator(n),onComplete:this._onCompleteGenerator(n)};return this.hideToken&&clearTimeout(this.hideToken),this.panel.visibleFlag||this.panel.show(),this.panel.show(),this._addNewUploadingViewer(i,r),this._trackers.push(r),r}},_getDisplaySize:function(e){if(e<1048576){var t=e/1024;return Math.round(100*t)/100+" KB"}t=e/1048576;return Math.round(100*t)/100+" MB"},_removeTrackerView:function(e){if(e){e.progressbar.destroy(),delete e.progressbar;var t=this.panelContent.getElement(".xen-file-tile"+e.trackerId);t&&(t.destroy(),t=null)}},_addNewUploadingViewer:function(t,n){if(t&&t.fileName){0===this._trackers.length&&this.panelContent.empty(),t.displaySize=this._getDisplaySize(t.fileSize),t.statusName=this.nls.get("uploading");var i=new e.Element("div",{html:this.template(t),class:"xen-file-upload-wrapper xen-file-tile"+n.trackerId});this.panelContent.appendChild(i),n.progressbar=new r({displayStyle:"lite",value:0}).inject(i.getElement(".progress-bar"))}},buildSkeleton:function(){this.template=n.compile(o),this.elements.container=e.createElement("div",{class:"XEN-upload-Viewer"}),this.panelContent=new e.Element("div",{html:""}),this.panel=new i({title:this.nls.get("uploadFileTitle"),identifier:"Uploader",resizableFlag:!0,content:this.panelContent,immersiveFrame:this.immersiveFrame,width:400,height:100,position:{my:"bottom right",at:"bottom right",offsetY:-20}}),this.panel.hide(),this.panel.close=this.panel.hide.bind(this.panel),this._displayEmptyView()},isInjected:function(){return!!this.getContent()&&this.getContent().isInjected()}})}),define("DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialNlsManager",["UWA/Core","DS/FedDictionaryAccess/FedDictionaryAccessAPI"],(e,t)=>{class n{constructor(){this._fetchNLSDatas={}}fetchNlsValues(e,{apiVersion:t="R2019x",lang:n,tenantId:i}){return new Promise((r,o)=>{const s=(e,t,{value:n,dispValue:i})=>{Reflect.has(e,t)||(e[t]=new Map),e[t].set(n,i)},a=(e,t,n)=>{Reflect.has(e,t)||(e[t]=[]),e[t].push(...n)};try{let l={},c={};Reflect.ownKeys(e).forEach(t=>{if(Reflect.has(this._fetchNLSDatas,t)){const n=this._fetchNLSDatas[t];e[t].forEach(e=>{n.has(e)?s(l,t,{value:e,dispValue:n.get(e)}):a(c,t,[e])})}else a(c,t,e[t])}),Reflect.ownKeys(c).length?this.doASearch(c,{apiVersion:t,lang:n,tenantId:i}).then(e=>{e.forEach(e=>{s(l,e.sixw_key,{value:e.value,dispValue:e.dispValue})}),r(l)}):r(l)}catch(e){console.error("error: ENOXMaterialNlsManager/fetchNlsValues fails to retreive nls values"),o(e)}})}doASearch(e,{apiVersion:n="R2019x",lang:i,tenantId:r}){return new Promise((o,s)=>{try{t.getNlsOfPropertiesValues(JSON.stringify(e),{apiVersion:n,lang:i,tenantId:r,onComplete:e=>{const t=[];Reflect.ownKeys(e).forEach(n=>{Reflect.has(this._fetchNLSDatas,n)||(this._fetchNLSDatas[n]=new Map);const i=e[n];Reflect.ownKeys(i).forEach(e=>{const r=i[e];this._fetchNLSDatas[n].set(e,r),t.push({sixw_key:n,value:e,dispValue:r})})}),o(t)}})}catch(e){s(e)}})}}let i=null;return i||(i=new n),i}),define("DS/ENOXEngineer/utils/SizedMap",[],function(){"use strict";function e(e){this.maxSize=e.maxSize||10,this.content=e.initialContent||{}}return e.prototype.put=function(e,t){if(e&&t instanceof Object)for(t.LU=Date.now(),this.content[e]=t;this.getSize()>this.maxSize;)this.removeOldest()},e.prototype.removeOldest=function(){var e=this.getOldestKey();e&&this.delete(e)},e.prototype.getOldestKey=function(){if(!(this.content instanceof Object))return null;for(var e=this.keys(),t=e[0],n=this.get(t).LU||0,i=1;i<e.length;i++){const r=e[i];n>this.get(r).LU&&(n=this.get(r).LU,t=r)}return t},e.prototype.delete=function(e){this.content&&delete this.content[e]},e.prototype.has=function(e){return!(!this.content||!this.content[e])},e.prototype.keys=function(){return this.content instanceof Object?Object.keys(this.content):[]},e.prototype.get=function(e){return this.content instanceof Object?this.content[e]:null},e.prototype.values=function(){var e=this;return this.keys().map(function(t){return e.get(t)})},e.prototype.clear=function(){this.content={}},e.prototype.getContent=function(){return this.content},e.prototype.getSize=function(){if(!(this.content instanceof Object))return 0;var e="";try{e=JSON.stringify(this.content)}catch(t){e=""}return console.warn(e.length),e.length},e}),define("DS/ENOXEngineer/utils/QuantityHelper/QuantityHelperUtils",[],()=>{const e=function(e){let t=!1;switch(typeof e){case"number":t=e>0;break;case"boolean":t=!0;break;case"string":t=e.trim().length>0}return t};return{isAValidValue:e,hasQuantity:function(t){return!!e(t)&&t},asNumber:function(e){let t=NaN;switch(typeof e){case"number":t=e;break;case"string":t=parseFloat(e)}return t}}}),define("DS/ENOXEngineer/routerConfig/RouterConfig",[],function(){"use strict";return{routes:[{name:"myEngItems",path:"/myEngItems"},{name:"engItem_View",path:"/engItem/:pid"},{name:"recents_items",path:"/recents"}],options:{defaultRoute:"recents_items",defaultParams:{},trailingSlash:!1,useTrailingSlash:void 0,autoCleanUp:!0,strictQueryParams:!0,allowNotFound:!1}}}),define("DS/ENOXEngineer/componentsHelpers/ENOXListReportsView/js/ENOXListReportsViewModel",["UWA/Core","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel"],(e,t,n)=>{return class{constructor(){this.gridModel=new t}get model(){return this.gridModel}updateReports(e){if(!Array.isArray(e)||!e.length)return;const{gridModel:t}=this;if(!t)throw new Error("unexpected state");const n=t.getRoots();Array.isArray(n)&&n.length?e.forEach(e=>{const{physicalid:t,generation:i,targetDocument:r}=e,o=n.find(e=>e.getAttributeValue("physicalid")===t);o&&(o._options.data.generation=i,o._options.data.targetDocument=r,o.notifyModelUpdate("generationStatus"))}):this.addReports(e)}addReports(e){if(!Array.isArray(e)||!e.length)return;const{gridModel:t}=this;if(!t)throw new Error("unexpected state");t.prepareUpdate(),e.forEach(e=>{const{physicalid:i,name:r,label:o,revision:s,type:a,owner:l,type_icon_url:c,generation:d,targetDocument:u,originated:p}=e,{status:g}=d||{},h=new n({tree:r,label:o,grid:{physicalid:i,name:r,revision:s,dispType:a,current:"current",generationStatus:g||"None",owner:l,originated:p},icons:[c],data:{generation:d,targetDocument:u}});t.addRoot(h)}),t.pushUpdate()}emptyView(){const{gridModel:e}=this;e&&e.getRoots()&&(e.prepareUpdate(),e.removeRoots(),e.empty(),e.pushUpdate())}}}),define("DS/ENOXEngineer/componentsHelpers/commandModal/XEngineerModal",["DS/UIKIT/Modal","UWA/Core","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n){"use strict";function i(i){this.options={title:"Dialog",className:"",withFooter:!0},this.options=t.extend(this.options,i),this.modal=function(t){return new e({className:t.className||"",closable:!0,header:"<h4>"+t.title+"</h4>",body:"",footer:""})}(this.options),this.modal.inject(widget.body),this.options.withFooter&&(this.options.customFooter?this.modal.setFooter(this.options.customFooter()):this.modal.setFooter("<button type='button' name='okButton' class='btn btn-primary'>"+n.get("eng.ui.button.ok")+"</button> <button type='button' name='cancelButton' class='btn btn-default'>"+n.get("eng.ui.button.cancel")+"</button>"),this._bindFooterEvent())}return i.prototype.show=function(){this.modal.show()},i.prototype.dispose=function(){this.modal.hide()},i.prototype.injectBody=function(e){this.modal.setBody(e)},i.prototype.getBody=function(){return this.modal.getBody()},i.prototype.injectHeader=function(e){this.modal.setHeader(e)},i.prototype.injectFooter=function(e){this.modal.setFooter(e)},i.prototype.onClose=function(e,t){this.modal.addEvent("onHide",function(n){e.call(t,n)},this)},i.prototype.onValidate=function(e,t){var n=this;this.options.withFooter&&this.modal.addEvent("onValidate",function(i){e.call(t,function(){n.destroy()})},this)},i.prototype._bindFooterEvent=function(){var e=this;this.modal.getFooter().getElements(".btn").forEach(function(t){"cancelButton"===t.name&&t.addEvent("click",function(){e.modal.hide()}),"okButton"===t.name&&t.addEvent("click",function(){e.modal.dispatchEvent("onValidate")})})},i.prototype.getContent=function(){return this.modal.getContent()},i.prototype.destroy=function(){void 0!==this.modal&&this.modal.destroy();for(var e=Object.keys(this),t=0;t<e.length;t++)console.log(e[t]),this[e[t]]=void 0},i}),define("DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialApplyPanel",["UWA/Core","DS/Controls/Button","DS/DataDragAndDrop/DataDragAndDrop","DS/Handlebars/Handlebars","text!DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialApplyPanel.html","css!DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialApplyPanel.css"],(e,t,n,i,r)=>{return class{constructor(t){this.appCore=t.appCore;const n=i.compile(r),o=e.createElement("div",{html:n()});this._container=o.getElement(".material-apply-panel"),e.is(t.onApplyEvent)&&(this.onApplyEvent=t.onApplyEvent),e.is(t.onDnDEvent)&&(this.onDnDEvent=t.onDnDEvent),this._buildSkeleton()}hide(){this.content.hide()}show(){this.content.show()}get content(){return this._container}_buildSkeleton(){const i=this.content.getElement(".material-apply-panel-button-div"),r=this.appCore.i18nManager.get("materialFacet.applyMaterial");if(new t({domId:"material-apply-button",label:e.is(r)?r:"Apply"}).inject(i).getContent().addEventListener("buttonclick",this.onApplyEvent),i.inject(this._container),e.is(this.onDnDEvent)){const e={drop:(e,t,n)=>{this._container.removeClassName("material-apply-panel-drag-over"),this.onDnDEvent({dataText:e,droptarget:t,evt:n})},enter:(e,t)=>{this._container.addClassName("material-apply-panel-drag-over")},over:(e,t)=>{this._container.addClassName("material-apply-panel-drag-over")},leave:(e,t)=>{this._container.removeClassName("material-apply-panel-drag-over")}};n.droppable(this._container,e)}}}}),define("DS/ENOXEngineer/services/XEngLocalStorage",["UWA/Core","UWA/Class"],function(e,t){"use strict";return t.singleton({init:function(t){if(e.is(localStorage)){var n=localStorage.getItem("xEngineerData");if(e.is(n))try{this.xEngData=JSON.parse(n)}catch(e){console.error("error during parsing !")}e.is(this.xEngData)||(this.xEngData={},this._commit()),e.is(this.xEngData.xEng_mode)||(this.xEngData.xEng_mode="index",this._commit()),this.xEngData.xEng_mode="index",this._commit()}},setItem:function(t,n){e.is(localStorage)&&(this.xEngData[t]=e.clone(n),this._commit())},getItem:function(t){if(e.is(localStorage))return this.xEngData[t]},_commit:function(){localStorage.setItem("xEngineerData",JSON.stringify(this.xEngData))},removeItem:function(t){e.is(localStorage)&&(delete this.xEngData[t],this._commit())},consumeItem:function(t){if(e.is(localStorage)){var n=this.getItem(t);return this.removeItem(t),n}}})}),define("DS/ENOXEngineer/services/MaterialConstants",[],()=>{return{MaterialType:{core:"dsc_matref_ref_Core",covering:"dsc_matref_ref_Covering",raw:"Raw_Material"}}}),define("DS/ENOXEngineer/utils/MaturityUtils",[],function(){"use strict";var e={};return{createCSSClass:function(e,t,n){if(null===document.getElementById(e)){var i=document.createElement("style");i.type="text/css",i.id=e;let r=n||"."+e;i.innerHTML=r+t,document.getElementsByTagName("head")[0].appendChild(i)}},cleanStatusForCSS:function(e){return e.replace(/(\.| )/g,"-")},getAndCreateMaturityClass:function(e,t,n){return"lc-status-"+this.cleanStatusForCSS(e)+(t?"-withClass":"")},addCSSMaturityClasses:function(t,n,i){if(void 0===t)return;let r=i.policies;for(let t=0;r&&t<r.length;t++){let n=r[t].policyName;e[n]=r[t].states}for(let i=0;i<t.length;i++){let r=t[i];if(e[r]){let t=e[r];for(let e=0;e<t.length;e++){let i=t[e].activeColor,o="{color:"+("#FFFFFF"===i?"#000000":"#FFFFFF")+" ; background-color:"+i+";}",s=this.cleanStatusForCSS(t[e].stateSysName),a="lc-status-"+this.cleanStatusForCSS(r)+"-"+s+(n?"-withClass":""),l="."+a+(n?" ."+n:"");this.createCSSClass(a,o,l)}}}}}}),define("DS/ENOXEngineer/utils/XEngineerConstants",["UWA/Core","DS/ENOXEngineerCommonUtils/XENCommonConstants"],function(e,t){"use strict";var n={ID_CARD_MINIFICATION:"Id_Card-minification-status",ID_CARD_EXPAND:"Id_card_expanded",ID_CARD_MINIFY:"Id_card_minified",EVENT_REFRESH_APP_CONTENT:"refresh-app-content",EVENT_REFRESH_WIDGETS:"refresh-widgets",EVENT_CLEAR_WIDGETS_CLIPBOARD:"clear-widgets-clipboard",EVENT_TRIPTYCH_PANEL_VISIBLE:"triptych-panel-visible",EVENT_TRIPTYCH_PANEL_HIDDEN:"triptych-panel-hidden",EVENT_TRIPTYCH_HIDE_PANEL:"triptych-hide-panel",EVENT_TRIPTYCH_SHOW_PANEL:"triptych-show-panel",EVENT_TRIPTYCH_RESIZE:"resizing-triptych-container",EVENT_TRIPTYCH_RESIZE_PANEL:"triptych-resized",EVENT_TRIPTYCH_TOGGLE_PANEL:"triptych-toggle-panel",EVENT_TRIPTYCH_SET_SIZE:"triptych-set-size",EVENT_SHOW_PROPERTIES:"show-properties",EVENT_WELCOME_PANEL_ACTION_SELECTED:"welcome-panel-action-selected",EVENT_WELCOME_PANEL_COLLAPSE:"welcome-panel-collapse",EVENT_WELCOME_PANEL_EXPAND:"welcome-panel-expand",EVENT_INFO_PANEL_CLOSE:"information-panel-close",EVENT_INFO_PANEL_OPEN:"information-panel-open",EVENT_INFO_PANEL_VISIBLE:"information-panel-visible",EVENT_INFO_PANEL_HIDDEN:"information-panel-hidden",EVENT_GO_BACK:"go-back-event",EVENT_REFRESH_ITEMVIEW:"xEngineer-refresh-itemView",EVENT_REFRESH_LANDING_DATA:"xEngineer-refresh-landing-data",EVENT_IDCARD_READY:"idCard-ready",EVENT_LIST_READY:"list-view-ready",EVENT_LIST_SELECT_ITEM:"item-selected",EVENT_REFRESH_LISTVIEW:"refresh-listview",EVENT_RELOAD_ENGINEERING_DEFINITION:"reload-list-content",EVENT_MY_EN_ITEM_READY:"myEngItem-view-ready",EVENT_IDCARD_ATTRIBUTES_CLICKED:"idcard-attributes-clicked",EVENT_IDCARD_CUSTOM_SHOW_LANDING:"custom-show-landing-page-event",EVENT_IDCARD_CUSTOM_WP_TOGGLE_EVENT:"custom-welcome-panel-toggle-event",EVENT_IDCARD_CUSTOM_INFORMATION_ICON:"custom-information-icon-event",EVENT_IDCARD_CUSTOM_GENERIC_ICON:"custom-generic-icon-event",SWITCH_MODE:"switch-mode",EVENT_IDCARD_CUSTOM_SHOW_CONFIGURATION:"custom-show-configuration-event",EVENT_IDCARD_CUSTOM_SHOW_MODELVERSION:"custom-show-modelversion-event",EVENT_IDCARD_CUSTOM_SHOW_VERSION_EXPLORER:"custom-show-version-explorer-event",EVENT_IDCARD_CUSTOM_OPEN_ACTIONS_MENU:"custom-open-actions-menu-event",EVENT_IDCARD_CUSTOM_OPEN_BACK_BUTTON:"idcard-back",EVENT_UPDATE_IDCARD_RENDERING:"event-update-idcard-rendering",EVENT_IDCARD_CUSTOMIZE_ATTRIBUTES_MODIFICATION:"ENXViews/IDCardCustomization/idCardAttributesModification",EVENT_IDCARD_SAVED_ATTRIBUTES:"saved-displayedAttributes-idcard",EVENT_INDEX_MODE_DISABLE:"event_index_mode_disable",MANUFACTURING_RESPONSIBILITY:"Manufacturing Responsibility",MANUFACTURING:"Manufacturing",MANUFACTURING_RESPONSIBILITY_COLUMN:"ManufacturingResponsibilityColumn",SPECIFICATION_DOCUMENT:"SpecificationDocument",EVENT_UPLOAD_ATTACHMENT_COMPLETE:"upload-attachment-complete",EVENT_DETACH_ATTACHMENT_COMPLETE:"detach-attachment-complete",EVENT_ATTACH_ATTACHMENT_COMPLETE:"attach-attachment-complete",EVENT_COLLECTION_ACTION_UPDATE_COUNT:"enox-collection-toolbar-items-count-update",EVENT_COLLECTION_SELECTALL_CHECKBOX_STATUS_PARTIAL:"enox-collection-toolbar-select-all-checkbox-partial",EVENT_COLLECTION_TOOLBAR_CHECKBOX_HIDE:"enox-collection-toolbar-hide-checkbox",EVENT_COLLECTION_TOOLBAR_CHECKBOX_SHOW:"enox-collection-toolbar-show-checkbox",EVENT_COLLECTION_SELECTALL_CHECKBOX_STATUS_CHECKED:"enox-collection-toolbar-select-all-checkbox-checked",EVENT_COLLECTION_SELECTALL_CHECKBOX_STATUS_UNCHECKED:"enox-collection-toolbar-select-all-checkbox-uncheck",EVENT_COLLECTION_SELECTALL:"enox-collection-toolbar-all-selected",EVENT_COLLECTION_UNSELECTALL:"enox-collection-toolbar-all-unselected",EVENT_TOOLBAR_MULTISEL_COUNT:"enox-collection-toolbar-selections-count-update",EVENT_TOOLBAR_SORT:"enox-collection-toolbar-sort-activated",EVENT_TOOLBAR_DISABLE:"enox-collection-toolbar-disable-action",EVENT_TOOLBAR_ENABLE:"enox-collection-toolbar-enable-action",EVENT_TOOLBAR_SEARCH:"enox-collection-toolbar-filter-search-value",EVENT_NOTIFY_CONTENT_SIZE_CHANGE:"notify-content-size-change",EVENT_UPDATE_INSTANCES_EFFECTIVITIES:"event-update-instances-effectivities",EVENT_COLORIZATION_UPDATED:"color-updated",EVENT_REAPPLY_DATAGRID_SORT_MODEL:"reply-datagrid-sort-model",EVENT_TOOLBAR_CHANGE_ICON:"enox-collection-toolbar-change-icon-action",EVENT_TOOLBAR_CHANGE_SELECTION:"enox-collection-toolbar-change-select-subMenu-action",EVENT_NEW_ENG_ITEM_CREATED:"new-eng-item-created",EVENT_DELETED_ENG_ITEM:"eng-item-deleted",EVENT_NEW_INSERTED_ENG_ITEM:"inserted-eng-item",EVENT_CREATED_NODES:"created-nodes",EVENT_REMOVED_NODES:"removed-nodes",EVENT_REMOVED_INSTANCES:"removed-instances",EVENT_NEW_ATTACHED_DOCUMENT:"new-attachement",EVENT_SET_ACTIVE_ENG_ITEM:"set-active-eng-item",EVENT_RESET_SELECTION:"reset-selection",EVENT_REPLACED_ENG_ITEM:"replaced-eng-item",EVENT_REPLACED_DOCUMENT:"replaced_document",EVENT_DOWNLOAD_ITEM:"download-item",EVENT_REMOVE_DOCUMENT:"remove-item",EVENT_DELETE_DOCUMENT:"delete-document",EVENT_REMOVED_INSTANCE:"removed-instance",EVENT_CONF_MODEL_UPDATED:"conf_model_updated",EVENT_QUALIFIED_AS_FINAL_ITEM:"event-qualified-as-final",EVENT_FLAT_LIST:"event-flat-list",EVENT_STRUCTURE_VIEW_CHANGED:"event-change-structure-view-changed",EVENT_CHANGE_QUANTITY_VIEW:"event-change-quantity-view",EVENT_SYNC_VIEW_WITH_EI_MODEL:"sync-view-with-model",EVENT_SYNC_MATURITY_WITH_MODEL:"sync-maturity-with-model",EVENT_COLUMNS_CHANGED:"columns-changed",EVENT_REBUILD_SESSION:"rebuild-user-session",EVENT_REMOVE_CUT_INSTANCES:"remove_selected_cut_items_from_parent",EVENT_MODIFIED_REFERENCES:"eng-item-modified",EVENT_MODIFIED_NODES:"modified-nodes",EVENT_REFRESH_ITEMS_BY_IDS:"event-refresh-items-by-id",EVENT_REMOVED_FROM_RECENT:"event-removed-from-recent",EVENT_AUTHORING_MATERIAL_START:"event-authoring-material-start",EVENT_AUTHORING_MATERIAL_END:"event-authoring-material-end",EVENT_CLOSE_RUNNING_CMD:"close-running-cmd",EVENT_INSTANCES_CREATED:"event-instances-created",EVENT_CLEAR_TAGGER:"event-clear-tagger",EVENT_CHANGE_DIRECT_VIEW:"event-change-direct-vieww",EVENT_TAGGER_GROUP_CHANGED:"event-tagger-group-changed",EVENT_TAGGER_GROUP_COLLAPSED:"event-tagger-group-collapsed",CHANGE_QUANTITY_LIMIT:100,CHANGE_QUANTITY_LIMIT_UNDER_CHANGE_ACTION:30,RUN_BACKGROUND_JOB_COUNT:100,EVENT_ATTR_DICO_UPDATED:"event-attr-dico-updated",EVENT_UPDATE_BOOKMARK_ICON:"event-update-bookmark-icon",EVENT_PASTE_ENABLE:"event-paste-enable",EVENT_PASTE_DISABLE:"event-paste-disable",EVENT_UPDATE_NODES_WITH_CHANGESETS:"event-udpate-nodes-with-changesets",EVENT_COLUMN_PROVIDERS_LOADED:"event-column-providers-loaded",EVENT_BUILNODES_FROM_EXPAND_COMPLETED:"event-buildnodes-from-expand-completed",EVENT_UPDATE_SESSIONPREDICATE:"event-sessionpredicates-update",MULTISEL_ACTIVATED:"multisel-activated",MULTISEL_DEACTIVATED:"multisel-deactivated",MULTISEL_ADD_ITEM:"multisel-add-item",MULTISEL_REMOVE_ITEM:"multisel-remove-item",MY_ENG_ITEMS_VIEW:"my_engItem",ENG_ITEM_VIEW:"eng_item_view",RECENT_ENG_ITEM_VIEW:"recent_eng_item_view",EVENT_LAUNCH_COMMAND:"show-light-component",EVENT_SET_PARTNUMBER_COMPLETED:"set-part-number-completed",EVENT_SET_WORKUNDER_EVOLUTION_COMPLETED:"set-workunder-evolution-completed",EVENT_NEVER_SHOW_WORKUNDER_DLG:"never-show-dialog-checkbox-checked",EVENT_NEW_VERSION_COMPLETED:"new_version_created",EVENT_OPEN_ITEM_WITH_COMPASS:"open_item_with_compass",EVENT_DELETE_VERSION_COMPLETED:"version_deleted",WP_ADD_ENG_ITEM_ACTION:"add_engItem",WP_ADD_NEW_PART_ACTION:"add_newPart",WP_OPEN_ENG_ITEM_ACTION:"open_engItem",WP_MY_ENG_ITEMS_ACTION:"my_eng_items",WP_RECENTS_ITEMS_ACTION:"recent_items",EVENT_SELECT_ACTION_WP:"welcome-panel-select-action",WP_IMPORT_ENG_ITEM_ACTION:"import_items",EVENT_TOGGLE_DEACTIVE_SE:"toggleDeActiveSE",EVENT_TOGGLE_DEACTIVE_CA:"toggleDeActiveCA",EVENT_TOGGLE_ACTIVE_SE:"toggleActiveSE",EVENT_TOGGLE_ACTIVE_CA:"toggleActiveCA",EVENT_SESSION_EFF:"sessionEff",EVENT_REMOVE_AUTH_CTX_SESSION:"removeAuthCtxSessionEvent",EVENT_REMOVE_AUTH_CTX:"removeAuthCtxEvent",TRIPTYCH_CMP:"triptych",PROPERTY_CMP:"propertyView",ITEM_VIEW_CMP:"itemView",IDCARD_CMP:"IdCard",LIST_VIEW_CMP:"ListView",LIST_VIEW_NEW_CMP:"XEngListView",WELCOME_PANEL_CMP:"welcomePanel",MY_ENG_ITEM_CMP:"XEngGridView",CROSS_APP_SELECTION_EVENT:"DS/PADUtils/PADCommandProxy/select",DUPLICATE_CMD:"DuplicateHdr",COMPARE_CMD:"CompareHdr",MATURITY_GRAPH_CMD:"MaturityHdr",MATURITY_BULK_CMD:"maturity-bulk",CHANGE_OWNER_CMD:"ActionBar_ChangeOwner",DELETE_CMD:"DeleteHdr",REPLACE_BY_LATEST_REVISION:"UPSReplaceByLatestRevision",REPLACE_BY_EXISTING:"UPSAuthReplaceByExisting",REPLACE_BY_VERSION:"replaUPSAuthReplaceByRevisionceByVersion",REPLACE_BY_LATEST_VERSION:"UPSAuthReplaceByRevision",REPLACE_BY_DUPLICATE:"UPSAuthReplaceByDuplicate",UPDATE_VERSION:"UPSAuthRevisionUpdate",UPDATE_VERSION_RECURSIVE:"UPSAuthCmdUpdateRevOnEntireStructure",UPDATE_WIDGET_TITLE:"XENG_UPDATE_WIDGET_TITLE",CREATE_NEW_ENG_ITEM:"ActionBar_NewProductCmd",INSERT_NEW_ENG_ITEM:"ActionBar_InsertNewProductCmd",INSERT_NEW_DUPLICATE_FROM:"UPSAuthInsertDuplicate",CREATE_NEW_PART:"ActionBar_NewPartCmd",INSERT_NEW_PART:"ActionBar_InsertNewPartCmd",CREATE_NEW_CONTENT:"NewContent",INSERT_NEW_DRAWING:"ActionBar_InsertNewDrawingCmd",ADD_EXISTING_DRAWING:"XENG_ADD_EXISTING_DRAWING",DETACH_ENG_ITEMS_CMD:"UPSAuthUnparent",ADD_EXISTING:"addExisting",ITEM_CUT_CMD:"UPSAuthCut",ITEM_COPY_CMD:"UPSAuthCopy",ITEM_PASTE_CMD:"UPSAuthPaste",ADD_TO_CLIPBOARD:"DS/UPSCommands/commands/UPSAuthCmdCutCopyPaste/clipboard",SET_PART_NUMBER_CMD:"SetThePartNumber",ADD_MATERIAL_QUANTITY_CMD:"addNewMaterialQuantity",ADD_EXISTING_RAW_MATERIAL_QUANTITY_CMD:"addExistingRawMaterialQuantity",RAW_MATERIAL_QUANTITY:"rawMaterialQuantity",CHANGE_QUANTITY_CMD:"ChangeTheQuantity",CHANGE_MASS_QUANTITY_CMD:"ChangeMassQuantity",CHANGE_VOLUME_QUANTITY_CMD:"ChangeVolumeQuantity",CHANGE_RAW_QUANTITY_CMD:"ChangeRawQuantity",SHOW_HISTORY_CMD:"HistoryHdr",ADD_EXISTING_DOC_CMD:"XENG_ADD_EXISTING_DOC",ADD_NEW_DOC_CMD:"XENG_ADD_NEW_DOC",ADD_PRODUCT_CONFIGURATION:"addProductConfiguration",RELATEDOBJECTS_CMD:"RelatedObjectsHdr",OPENPRODUCT_CMD:"OpenProduct",REVISE_CMD:"RevisionHdr",REVISE_FROM_CMD:"ReviseFromHdr",NEW_BRANCH_CMD:"NewBranchHdr",EDIT_CONF_CONTEXT_CMD:"XENG_EDIT_CONF_CONTEXT",EDIT_VARIANT_EFFECTIVITY_CMD:"EditVariant",SET_EVOLUTION_EFFECTIVITY_CMD:"EditEvolution",SET_PROD_CONF_CMD:"XENG_SET_PROD_CONF",LAUNCH_ATTRIBUTES_MGT_CMD:"launchAttributesManager",FIND_ITEMS_CMD:"FindCmd",EXPORT_ITEMS_CMD:"Export",IMPORT_ITEMS_CMD:"Import",CONST_AUTHORING:"Authoring",CONST_INDEX:"Index",SET_WORKUNDER_EVOLUTION_CMD:"SetWorkunderEvolution",OPEN_ENG_ITEM:"XENG_OPEN_ENG_ITEM",LAUNCH_NG_FILTER_CMD:"DefineFilter",QUALIFIED_AS_FINAL_CMD:"QualifiedAsFinal",LEAF_MATERIALS_CMD:"LeafMaterials",FLAT_LIST_VIEW:"flatListView",DIRECT_CMD:"Direct",INSTANCE_CMD:"UsageView",REFERENCE_CMD:"ReferenceView",VALUE_INSTANCE_OR_REFERENCE_CMD:"value_instance_or_reference_cmd",PROPERTIES_CMD:"edit-properties",DOWNLOAD_DOCUMENT_CMD:"download-document",DETACH_DOCUMENT_CMD:"detach-document",DELETE_DOCUMENT_CMD:"delete-document",LAUNCH_REORDER_CMD:"UPSAuthReorderProduct",REPLACE_BY_LATEST_REVISION_DOCUEMNT_CMD:"ReplaceDocumentByLatestRevisionCmd",REPLACE_BY_REVISION_DOCUEMNT_CMD:"ReplaceDocumentByRevisionCmd",EDIT_DOCUMENT_CMD:"EditDocumentCmd",UPDATE_DOCUMENT_CMD:"UpdateDocumentCmd",UNDO_EDIT_DOCUEMNT_CMD:"UndoEditDocumentCmd",PROPERTIES_REF_CMD:"edit-properties-ref",PROPERTIES_INST_CMD:"edit-properties-inst",COMMENTS_CMD:"edit-comments",ATTACHMENTS_CMD:"edit-attachments",MATERIALS_CMD:"edit-materials",ALTERNATES_CMD:"edit-alternates",MADE_FROM_CMD:"edit-made-from",DERIVED_OUTPUT_CMD:"edit-derived-output",MANUF_RESP_CMD:"edit-manufacturing",SPEC_DOC_CMD:"edit-spec-doc",MEI_COLUMN:"edit-meiColumn",SET_WORKUNDER_BOOKMARK_CMD:"SetWorkUnderBookmark",MATURITY_MODEL_VERSION_RELEASE:"Release",MATURITY_MODEL_VERSION_OBSOLETE:"Obsolete",OPEN_WITH_MENU:"XENG_OPEN_WITH",EDIT_DOCUMENT:"Edit",UPDATE_DOCUMENT:"Update",UNDO_EDIT_DOCUEMNT:"UndoEdit",REPLACE_BY_LATEST_REVISION_DOCUEMNT:"ReplacebyLatestRevision",REPLACE_BY_REVISION_DOCUEMNT:"ReplacebyRevision",USER_RECENTS_ENG_ITEMS:"xEngUserRecents",USER_CONF_PREFERENCES:"xEngineerUserConfPref",NLS_STORAGE_NAME:"xAppsElementsNLSNames",PREDICATE_NLS_STORAGE_NAME:"xAppsPredsValue",RDF_CLASSES_TO_LOAD:"rdfClassToLoad",MOST_USED_PROP_VALUE:"mostUsedPropValue",DS6W_CLASSES_WITH_NLS_PROP:"rdfClassWithNslProp",USER_SELECTED_NODE_IDS:"selectedNodeIDs",IS_INFORMATION_PANEL_LAUNCHED:"isInformationPanelLaunched",IS_INFORMATION_PANEL_LAUNCHED_FOR_HOME_PAGE:"isInformationPanelLaunchedInHomePage",INFORMATION_PANEL_WIDTH:"InformationPanelWidth",GROUPBY_OPTIONS:"groupBy",GROUPBY_MENU:"groupby",PREFERENCE_MAX_SIZE:"preferenceMaxSize",USER_EVOLUTION_PREF:"evol_filter_pref",USER_CUSTO_VIEW_PREF:"custo_view_saved_data",USER_WORKUNDER_EVOL_PREF:"evol_workunder_pref",CONF_OFFICIAL_VIEW:"Current",CONF_PROJECTED_VIEW:"Projected",PC_FILTER_MODE_PREF:"pc_filter_mode",CONF_STRICT_MODE:"Strict",CONF_150_MODE:"150%",TITLE_COLUMN_NO:"0",TITLE_PATH_OF_REFERENCE:"PLMEntity.V_Name",INSTANCE_PATH:"PLMInstance.PLM_ExternalID",DESCRIPTION_PATH_OF_INSTANCE:"PLMInstance.V_description",DESCRIPTION_PATH_OF_REFERENCE:"PLMEntity.V_description",TITLE_PATH_OF_DOCUMENT:"Title",DESCRIPTION_PATH_OF_DOCUMENT:"description",TITLE_PATH_OF_3DSHAPE:"PLMEntity.V_Name",DESCRIPTION_PATH_OF_3DSHAPE:"PLMEntity.V_description",XENGINEER_APP_NAME:"ENXENG_AP",ENORIPE_APP_NAME:"ENORIPE_AP",NAME_3DXCONTEXT:"3DXContent",XENGINEER_APP_AUTHKEY:"ENXENG_AP/AuthKey",VALUE_ASK_WORKUNDER_EVERYTIME:"ask_workunder_everytime",VALUE_SET_WORKUNDER_ALWAYS:"always_workunder_never_ask",VALUE_SET_WORKUNDER_NEVER:"never_workunder_never_ask",VALUE_QUALIFIED_AS_FINAL_COMPONENT:"value_qualified_as_final_component",VALUE_QUALIFIED_AS_LEAF_COMPONENT:"value_qualified_as_leaf_component",VALUE_QUANTITY_VIEW:"value-quantity-view",FINAL_ITEMS_PREF:"Final Item",FINAL_ITEMS_DEFAULT:"Not Selected(Leaf Item)",FINAL_ITEM_VALUE_LABEL:"final_item_value",FINAL_ITEM_VALUE_NAME:"final_item_name",USER_EXPORT_HEADER_TEMPLATE:"xEngineer_Export_HeaderTemplate",NOT_GROUPED:"Not Grouped",REFERENCE:"Reference",PART_NUMBER:"Part Number",DATA_LIMIT_FOR_FINAL:1e4,TYPE_VPMREFERENCE:"VPMReference",TYPE_RAW_MATERIAL:"Raw_Material",TYPE_DRAWING:"Drawing",TYPE_DOCUMENT:"Document",TYPE_CONTROLLED_DOCUMENTS:"CONTROLLED DOCUMENTS",TYPE_QualitySystemDocument:"Quality System Document",TYPE_TechnicalDocument:"Technical Document",TYPE_ADVANCED_FILTER:"ENOStrRefinementSpecification",CHANGECONTROL_SHOW_STATE:"changeControlVisible",CHANGECONTROL_POSITION:"changeControlPosition",CHANGECONTROL_POSITION_TOPLEFT_VALUE:"top-left",CHANGECONTROL_POSITION_TOPRIGHT_VALUE:"top-right",CHANGECONTROL_POSITION_BOTTOMLEFT_VALUE:"bottom-left",CHANGECONTROL_POSITION_BOTTOMRIGHT_VALUE:"bottom-right",CHANGECONTROL_POSITION_FREE_VALUE:"free",PREFERRED_MASS_UNIT:"preferred-unit-mass",PREFERRED_VOLUME_UNIT:"preferred-unit-volume",NG_FILTER_PANEL_TAG:"dataFilterPanelCtn",IS_NGFILTER_PANEL_LAUNCHED:"isNGFilterPanelLaunched",PREFERRED_MASS_UNIT:"preferred-unit-mass",PREFERRED_VOLUME_UNIT:"preferred-unit-volume",PREFERRED_AREA_UNIT:"preferred-unit-area",PREFERRED_LENGTH_UNIT:"preferred-unit-length",APPEND_INSTANCE_COLUMN_KEYWORD:"-Instance",PREFERED_SHOW_NOT_IN_BOM:"ShowNotInBOM",DIMENSION_VOLUME:"VOLUME",DIMENSION_MASS:"MASS",DIMENSION_AREA:"AREA",DIMENSION_LENGTH:"LENGTH",CONT_QUANTITY_MASS:"ds6wg:DELFmiContQuantity_Mass.V_ContQuantity",CONT_QUANTITY_VOLUME:"ds6wg:DELFmiContQuantity_Volume.V_ContQuantity",CONT_RAWMAT_QUANTITY_LENGTH:"ro.madefromquantity_length.V_ContQuantity-Instance",CONT_RAWMAT_QUANTITY_MASS:"ro.madefromquantity_mass.V_ContQuantity-Instance",CONT_RAWMAT_QUANTITY_AREA:"ro.madefromquantity_area.V_ContQuantity-Instance",CONT_RAWMAT_QUANTITY_VOLUME:"ro.madefromquantity_volume.V_ContQuantity-Instance",CONT_RAWMAT_QUANTITY_ASREQ:"ro.madefromquantity_AsRequired.AsRequired-Instance",CONT_RAWMAT_QUANTITY_LENGTH_INST:"ro.VPMInstanceQuantity_Length.V_ContQuantity-Instance",CONT_RAWMAT_QUANTITY_MASS_INST:"ro.VPMInstanceQuantity_Mass.V_ContQuantity-Instance",CONT_RAWMAT_QUANTITY_AREA_INST:"ro.VPMInstanceQuantity_Area.V_ContQuantity-Instance",CONT_RAWMAT_QUANTITY_VOLUME_INST:"ro.VPMInstanceQuantity_Volume.V_ContQuantity-Instance",CONT_RAWMAT_QUANTITY_ASREQ_INST:"ro.VPMInstanceQuantity_AsRequired.AsRequired-Instance",DECLARED_VOLUME:"ds6wg:MaterialUsageExtension.DeclaredQuantity",PREFERRED_DIMENSION:"VOLUME",UNEXISTANT_ID:"#UNEXISTANT_ID",CHANGEQUANTITY_CHUNK_COUNT:100,ERR_FUN092398:"ERR_FUN092398",MANUFACTURING_INTENT_PREFERENCE:"isManufaturingIntentPrefActive",COMMAND_WS_EXPAND_CV:"cv_expand",COMMAND_WS_EXPAND_DB:"db_expand_new",COMMAND_WS_EXPAND_CV_V2:"cv_expand_v2",COMMAND_WS_MULTIEXPAND_V2:"multiexpand_v2",COMMAND_WS_MULTIEXPAND:"multiexpand",CONST_EMPTY_DGV_TILE_VIEW:"DGVorXENTile",EVENT_CHANGE_MFG_VIEW:"event-change-manufacturable-view",DS6W_MANUFACUTRABLE:"ds6w:manufacturable",VALUE_MFG_VIEW:"ManufacturableView",MANUFACTURING_CMD:"ManufacturingView",DATABASE_MODE_MULTIVALUES_SEPARATOR:"",INDEX_MODE_MULTIVALUES_SEPARATOR:",",CONST_YES:"Yes",CONST_AUTHORING_MODE:"authoringMode",UNSUPPORTED_TOOLBAR_ACTIONS_AUTHORING_MODE:"unSupportedToolbarActionsForAuthoringMode",CONST_DOC_AS_SPEC:"DocAsSpec",CONST_SPEC_FACET_NAME:"relateddocuments_spec",CONST_SPECIFICATIONS_TAB_UPDATE:"XEN/SPECIFICATIONS/TAB/UPDATE",EXPAND_MENU:"ExpandMenu",EVENT_EXPAND_BY_LEVEL:"ExpandByLevel",EXPAND_CMD:"ExpandCmd",EXPAND_ALL_CMD:"ExpandAllLevelCmd",EXPAND_N_LEVEL_CMD:"ExpandNLevelCmd",COLLAPSE_ALL_CMD:"CollapseAllCmd",CONST_EXPAND_ALL_LEVEL:"-1",CONST_ADV_FILTER:"nextGenFilter",XEN_CUSTO_KEY:"xen_app_custo",XEN_CUSTO_IDENTIFIER:"custom-view-identifier",XEN_CUSTO_VIEWS:"custom-views",CFG_EDIT_CONTEXT_CMD:"cfgEditConfigurationContext",EVENT_FIND_IN_CONTEXT_LAUNCH:"event-change-findincontext-launch",EVENT_FIND_IN_CONTEXT_VIEW_BUILT:"event-findincontext-view-built",CONST_FIND_IN_CONTEST_SELECTED_COLUMNS:"selected-columns-find-in-context",CONST_TARGET_LEVEL:"targetLevel",CONST_FIND_IN_CRITERIA:"findInContextCriteria",CONST_PARTIALLY_EXPANDED:"partiallyExpanded",CONST_FIND_IN_CONTEST_AUTOSELECT_OPTION:"find-in-context-autoselect-matched-node",EVENT_DISABLE_SORT_TO_DEFAULT:"DisableSortToDefault",EVENT_FIND_IN_CONTEXT_CLOSE_DIALOG:"event-change-findincontext-close",CONST_DEFORMABLE:"Deformable",CONST_DS6W_DEFORMABLE:"ds6w:deformable",CONST_DS6W_DEFORMABILITY:"ds6w:deformability",CONST_DEFORMABLE_OBJECT_INFO:"DeformedObjectInfo",CONST_DEFORMABLE_SEMANTIC_REL_INFO:"pathsr",CONST_CURRENT_OBJECT_MATURITY_STATE:"currentObjectState",CONST_SPEC_RELATION_COLUMN_DATAINDEX:"v6_specdoc_to",CONST_DOC_AS_SPECS:"DocAsSpecs",CONST_SHOW_3DSHAPE:"Show3DShape",CONST_DS6W_STATUS:"ds6w:status",CONST_DS6W_POLICY:"ds6w:policy",CONST_DS6W_TYPE:"ds6w:type",SELECT_MODE:"data-grid-view-select-mode",SELECT_MODE_ROW:"data-grid-view-select-mode-row",SELECT_MODE_CELL:"data-grid-view-select-mode-cell",DGV_SELECTION_MULTIPLE:"multiple",DGV_SELECTION_SINGLE:"single",DGV_SELECTION_NONE:"none",PREFERENCE_TYPE_CHOOSER:"DisplayTypeChooser",PREFERENCE_CREATE_SPREADSHEET:"ShowCreateFromSpreadsheetCmd",PREFERENCE_INTERVAL_SWITCH_INDEX:"intervalToSwitch",PREFERENCE_USE_INDEX:"UseIndex",ENABLE_SELECTION_MODES:"enable-selection-modes",ENABLE_HISTORY_OPEN_CMD:"enable-history-open-cmd",IDCARD_SAVED_ATTRIBUTES:"savedAttributes",DEFAULT_IDCARD_DISPLAY_ATTRIBUTES:"defaultIdCardDisplayAttributes",IDCARD_DISPLAY_ATTRIBUTES:"idCardDisplayAttributes",COLUMN_PROVIDER_REFERENCE_ATTRIBUTES:"columnProviderReferenceAttributes",CUSTOMIZE_HEADER_ATTRIBUTES:"customizeHeaderAttributes",FIND_MENU:"FindCmd",ADD_MENU:"Add",REORDER:"Reorder",REPARENT:"Reparent",INSERT:"Insert",CFG_INSTANTIATED_CONFIGURATION_COMMANDS:"CfgInstantiatedConfigurationCommands",TYPE_NEW_PRODUCT:"assembly",TYPE_NEW_DRAWING:"drawing",TYPE_NEW_PRODUCT_CBD_ASSEMBLY:"PhysicalProductCBDAssembly",TYPE_NEW_PRODUCT_CBD_BOARD:"PhysicalProductCBDBoard",TYPE_NEW_PRODUCT_PCB_COMPONENT:"PhysicalProductPLMPCBPhysicalComponent",KIND_OF:{ENGITEM:"EngItem",FILTER:"Filter",DOCUMENT:"Document",MATERIAL:"Material",DRAWING:"Drawing",SHAPE:"3DShape"},KEY_TOGGLE_WORK_UNDER_EVOLUTION:"toggleWorkUnderEvolution",KEY_TOGGLE_WORK_UNDER_CHANGE:"toggleWorkUnderChange",KEY_WORK_UNDER_DATA:"workUnderData"};return e.extend(n,t),Object.defineProperty(n,"supportTaggerGroupInViews",{get:()=>!(!e.is(localStorage)||!e.is(localStorage.getItem("XEN_TaggerGroupInIndentedViewOnly")))&&"false"===localStorage.getItem("XEN_TaggerGroupInIndentedViewOnly")}),Object.defineProperty(n,"seeQuantityMaterialAsGroupNode",{get:()=>!1}),Object.freeze(n)}),define("DS/ENOXEngineer/componentsHelpers/xEngExport/js/ExportProgressDialog",["DS/Windows/Dialog","DS/Controls/ProgressBar"],function(e,t){"use strict";function n(n){this.options=n||{},this.options=Object.assign({width:230,height:45,progressBar:{displayStyle:"lite",infiniteFlag:!0},renderTo:document.body},this.options),this.elements={},this.elements.progressBar=new t(this.options.progressBar),this.elements.dialog=new e({title:this.options.title,content:this.elements.progressBar.getContent(),closeButtonFlag:!1,width:this.options.width,height:this.options.height,showTitleFlag:!1,modalFlag:!0}),this.elements.dialog.getContent().setStyle("z-index",void 0),this.options.modalOpened=!0}return n.prototype.close=function(){delete this.elements.progressBar,this.options.modalOpened=!1,this.elements.dialog.close(),this.elements.dialog=null},n}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityNodeUtils",["UWA/Core"],e=>{return{status:{New:"New",Kept:"Kept",Removed:"Removed",Modified:"Modified"},statusColor:{New:"#368ec4",Kept:"",Removed:"#EA4F37",Modified:"#FFE902"},isNodeKeptStatus(e){return!!this.checkNodeValidity(e)&&e.options.grid.changeQuantityStatus},isNodeKept(e){return this.getNodeStatus(e,this.status.Kept)},isNodeModified(e){return this.getNodeStatus(e,this.status.Modified)},isNodeNew(e){return this.getNodeStatus(e,this.status.New)},isNodeRemove(e){return this.getNodeStatus(e,this.status.Removed)},getNodeStatus(e,t){if(!this.checkNodeValidity(e))return!1;const{status:n}=e.options.grid;return t?n===t:n},updateNodeOptions(e,t){if(!this.checkNodeValidity(e)||!t)return;const n=t,{grid:i}=n;i&&(Object.assign(e.options.grid,i),delete n.grid),Object.assign(e.options,n)},hasGridAttributeValued(t,n){if(!this.checkNodeValidity(t)||!n)return!1;const{grid:i}=t.options;return!!Reflect.has(i,n)&&(!!e.is(i[n])&&("string"!=typeof i[n]||0!==i[n].trim().length))},truncateOccurrencePathFromRefID(e,t){if(!Array.isArray(e)||!e.length)return null;if("string"!=typeof t||!t.trim().length)return e;const n=e.findIndex(e=>e===t);return-1===n?e:e.slice(n)},checkNodeValidity:t=>e.is(t)&&e.is(t.options)&&e.is(t.options.grid)}}),define("DS/ENOXEngineer/services/OccurrencesService",[],()=>{const e=",";class t{constructor(e){this._path=e}get path(){return this._path}_isPathEqual(e,t){if(!Array.isArray(e)||!Array.isArray(t))return!1;if(e.length!==t.length)return!1;for(const[n,i]of t.entries())if(e[n]!==i)return!1;return!0}isEqual({path:e}){return this._isPathEqual(e,this.path)}_computeId(t){return t.join(e)}containsId(e){return!!Array.isArray(this._path)&&-1!==this._path.indexOf(e)}get id(){return this._computeId(this.path)}}class n extends t{constructor(e){super(e.filter((e,t)=>t%2!=0)),this._xen_path=e}get xen_path(){return this._xen_path}getPath(e=!0){return e?this.xen_path:this.path}get id(){return this._computeId(this.xen_path)}isEqual({xen_path:e,path:t},n=!0){return this._isPathEqual(n?e:t,n?this.xen_path:t)}}return{Occurrence:t,XENOccurrence:n,XENOccurrencesBag:class extends Array{constructor(e){if(super(),UWA.is(e)&&Array.isArray(e)){const t=e.map(e=>new n(e));this.push(...t)}}getXENOccurrencefromOccurrencePath(e){const n=new t(e),i=this.findIndex(e=>n.isEqual(e));return-1===i?(console.error("dont find the occurrence {} from the XENOccurrencesBag",e),null):this[i]}},OccPathSep:e}}),define("DS/ENOXEngineer/componentsHelpers/ENOXCustomizeView/js/CustomizeView",["UWA/Class/View","DS/Handlebars/Handlebars4","DS/UIKIT/Alert","DS/UIKIT/Modal","DS/UIKIT/Input/Text","DS/UIKIT/Input/Button","DS/UIKIT/Scroller","DS/UIKIT/Input/Select","DS/Tree/TreeListView","DS/TreeModel/TreeNodeModel","DS/ENOXEngineerCommonUtils/xEngAlertManager","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json","text!DS/ENOXEngineer/componentsHelpers/ENOXCustomizeView/html/CustomizeView.html","css!DS/ENOXEngineer/componentsHelpers/ENOXCustomizeView/css/CustomizeView.css"],function(e,t,n,i,r,o,s,a,l,c,d,u,p){"use strict";UWA.debug=!0;p=t.compile(p);return e.extend({name:"xapp-cutomize-view",_dialog:null,className:function(){return this.getClassNames("-container")},setup:function(e){this._parent(e),this.contentSection=this._buildContent(),this.footerSection=this._buildFooter()},render:function(){return this.custoModal=new i({className:"customize-view-dialog",closable:!0,header:this.options.header,body:this.contentSection,footer:this.footerSection}).inject(widget.body).show(),this},_buildFooter:function(){var e=this,t=[];e.visibleViews=[],e.flag=0;for(var n=0;n<e.options.views.length;n++)e.visibleViews.push({text:e.options.views[n]});var i=new o({name:"okButton",value:e.options.buttons[1],className:"primary",events:{onClick:e._savingChanges.bind(e)}});return t.push(i),t.push(new o({name:"cancelButton",value:e.options.buttons[0],className:"default cancel",events:{onClick:function(){e.custoModal.destroy()}}})),t},_savingChanges:function(){var e={},t=this.options.customizedViews,n={};this.typeObj={};var i=this.currentView.getValue();1===this.flag&&this.visibleViews.push({text:i});for(var r=0;r<this.options.types.length;r++)this.typeObj[this.options.types[r].typeNls]=this.options.types[r].typeName;var o=[],s=[];if("VPMReference"===this.typeObj[this.selectType.getValue()[0]]){for(r=0;r<this.tree1.getRoots().length;r++)o.push(this.mappingObj[this.tree1.getNthRoot(r).options.label]),n[this.setType]={visibleAttr:o};s=this.options.customizedViews.Untitled&&"VPMReference"===this.setType&&this.options.customizedViews.Untitled.Document?this.options.customizedViews.Untitled.Document.visibleAttr:this.options.defaultAttributesDoc,n.Document={visibleAttr:s}}else{for(r=0;r<this.tree1.getRoots().length;r++)s.push(this.mappingObjDoc[this.tree1.getNthRoot(r).options.label]),n[this.setType]={visibleAttr:s};o=this.options.customizedViews.Untitled&&"Document"===this.setType&&this.options.customizedViews.Untitled.VPMReference?this.options.customizedViews.Untitled.VPMReference.visibleAttr:this.options.defaultAttributesEI,n.VPMReference={visibleAttr:o}}t[i]=n,t.type=this.setType,e.savedSettings=t,e.ctxView=i,this.options.onSubmitCallBack(e),this.custoModal.destroy()},_buildContent:function(){var e=this;e.check=0,e.mainAttrObj={},e.mainAttrObjDoc={},e.mappingObj={},e.mappingObjDoc={};for(var t=0;t<e.attributes.availableEI.length;t++)e.mainAttrObj[e.attributes.availableEI[t].sixWTag]=e.attributes.availableEI[t].attrNls,e.mappingObj[e.attributes.availableEI[t].attrNls]=e.attributes.availableEI[t].sixWTag;for(t=0;t<e.attributes.availableDoc.length;t++)e.mainAttrObjDoc[e.attributes.availableDoc[t].sixWTag]=e.attributes.availableDoc[t].attrNls,e.mappingObjDoc[e.attributes.availableDoc[t].attrNls]=e.attributes.availableDoc[t].sixWTag;var n=UWA.createElement("div",{class:"customise-view-body"});UWA.createElement("div",{class:"customized-views"}).inject(n);e._buildText();var i=[];for(t=0;t<e.options.views.length;t++)i.push({text:e.options.views[t],id:e.options.views[t]});e.availableTypes=[],e.displayTypes=[];for(t=0;t<e.options.types.length;t++)e.availableTypes.push(e.options.types[t].typeName);"Document"===e.options.customizedViews.type?(e.setType="Document",e.displayTypes.push({id:e.options.types[1].typeName,value:e.options.types[1].typeNls,selected:!0}),e.displayTypes.push({id:e.options.types[0].typeName,value:e.options.types[0].typeNls})):(e.setType="VPMReference",e.displayTypes.push({id:e.options.types[1].typeName,value:e.options.types[1].typeNls}),e.displayTypes.push({id:e.options.types[0].typeName,value:e.options.types[0].typeNls,selected:!0})),e.typeCountContainer=UWA.createElement("div",{class:"type-selection-display-container"}).inject(n);var r=UWA.createElement("div",{class:"type-selection-display"}).inject(e.typeCountContainer),o=(UWA.createElement("h5",{class:"type-text",text:e.options.titles.viewType}).inject(r),UWA.createElement("div",{class:"combo-box"}).inject(r));return e.selectType=new a({custom:!1,className:"combo-box",placeholder:!1,options:e.displayTypes}),e.selectType.inject(o),console.log(e.selectType),e.selectType.addEvent("onChange",function(t,n){e.selectType.getValue()[0]===e.options.types[0].typeNls?(e.select=!0,e.setType="VPMReference",e._buildVisibleList(),e._buildAvailableList(e.attributes.availableEI)):(e.select=!1,e.setType="Document",e._buildVisibleList(),e._buildAvailableList(e.attributes.availableDoc))}),this.attributeSection=UWA.createElement("div",{class:"attribute-display"}).inject(n),e._buildVisibleList().inject(this.attributeSection),e._updateLimitCount(e.tree1.getRoots().length).inject(e.typeCountContainer),e._buildButtons().inject(this.attributeSection),e.selectType.getValue()[0]===e.options.types[0].typeNls?e._buildAvailableList(e.attributes.availableEI).inject(this.attributeSection):e._buildAvailableList(e.attributes.availableDoc).inject(this.attributeSection),n},_buildButtons:function(){var e=this;e.buttonSection=UWA.createElement("div",{class:"button-section"}),e.buttonInput1=new o({name:"moveup",icon:"expand-up",className:"default button-move-up",events:{onClick:function(t){for(var n=e.tree2.getRoots().length,i=0;i<n;i++)if(e.tree2.getManager().getDocument()._trueRoot.options.children[i]&&!0===e.tree2.getManager().getDocument()._trueRoot.options.children[i]._isSelected){if(!(e.tree1.getRoots().length<e.options.maxAttributes))return void d.errorAlert(u.get("error.maxAttributesReached"));this.enable(),e.attributes.visible.push(e.tree2.getNthRoot(i).options.id),e.tree1.addRoot(e.tree2.getNthRoot(i)),n--,i--,e.tree1.getRoots().length===e.options.maxAttributes&&this.disable(),e._updateLimitCount(e.tree1.getRoots().length)}}}}).inject(e.buttonSection);new o({name:"movedown",icon:"expand-down",className:"default button-move-down",events:{onClick:function(){for(var t=0;t<e.attributes.visible.length;t++)e.tree1.getManager().getDocument()._trueRoot.options.children[t]&&!0===e.tree1.getManager().getDocument()._trueRoot.options.children[t]._isSelected&&(e.attributes.visible.splice(t,1),e.tree2.addRoot(e.tree1.getNthRoot(t)),t--,e.tree1.getRoots().length<e.options.maxAttributes&&(e.buttonInput1.enable(),e._updateLimitCount(e.tree1.getRoots().length)))}}}).inject(e.buttonSection);return e.buttonSection},_updateLimitCount:function(e){var t=u.get("no_of_visible_count_display").replace("{no}",e).replace("{limit}",this.options.maxAttributes);if(UWA.extendElement(this.typeCountContainer).getElement(".count-display"))UWA.extendElement(this.typeCountContainer).getElement(".count-display").setText(t);else var n=UWA.createElement("div",{class:"count-display",text:t});return n},_buildText:function(){this.textSection=UWA.createElement("div",{class:"text-section"});UWA.createElement("h5",{class:"view-text",text:this.options.titles.viewName}).inject(this.textSection);var e=UWA.createElement("div",{class:"view-input-text-container"}).inject(this.textSection),t=this.options.ctxView?this.options.ctxView:"Untitled";return this.currentView=new r({className:"view-input-text",value:t}).inject(e),this.currentView.disable(),this.textSection},_buildVisibleList:function(){var e;UWA.extendElement(this.attributeSection).getElement(".visible-attributes")?(e=UWA.extendElement(this.attributeSection).getElement(".visible-attributes")).empty():e=UWA.createElement("div",{class:"visible-attributes"});var t=this.currentView.getValue();this.options.customizedViews.type||this.setType||(this.setType="VPMReference");var n=[];if(this.options.customizedViews[t]&&this.options.customizedViews[t][this.setType]){if("VPMReference"===this.setType)var i=0!==this.options.customizedViews[t][this.setType].visibleAttr.length?this.options.customizedViews[t][this.setType].visibleAttr:this.options.defaultAttributesEI;else if("Document"===this.setType)i=0!==this.options.customizedViews[t][this.setType].visibleAttr.length?this.options.customizedViews[t][this.setType].visibleAttr:this.options.defaultAttributesDoc}else if("VPMReference"===this.setType)i=this.options.defaultAttributesEI;else i=this.options.defaultAttributesDoc;this.visibleAttrs=[];for(var r=0;r<i.length;r++)this.visibleAttrs.push(i[r]),this.attributes.visible.push(i[r]),"Document"===this.setType?n.push({id:i[r],label:this.mainAttrObjDoc[i[r]]}):n.push({id:i[r],label:this.mainAttrObj[i[r]]});return this._updateLimitCount(n.length),this.tree1=new l({columns:[{dataIndex:"selection",type:"selection",isHidden:!1},{dataIndex:"tree",text:this.options.titles.vTitle,height:"auto",width:"auto",isEditable:!0,isSortable:!0}],selection:{unselectAllOnEmptyArea:!0,canMultiSelect:!0},roots:n}).inject(e),e},_buildAvailableList:function(e){var t,n=this;UWA.extendElement(n.attributeSection).getElement(".available-attributes")?(t=UWA.extendElement(n.attributeSection).getElement(".available-attributes")).empty():t=UWA.createElement("div",{class:"available-attributes"});for(var i=[],r=[],o=0;o<e.length;o++)r[o]=e[o];n.visibleAttrs.length;r=r.filter(function(e,t){return!(-1!==n.visibleAttrs.indexOf(e.sixWTag))});for(o=0;o<r.length;o++)i.push({id:r[o].sixWTag,label:r[o].attrNls});return n.tree2=new l({columns:[{dataIndex:"selection",type:"selection",isHidden:!1},{dataIndex:"tree",text:n.options.titles.aTitle,width:"auto",isEditable:!0,isSortable:!0}],selection:{unselectAllOnEmptyArea:!0,canMultiSelect:!0},roots:i}).inject(t),t}})}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/units/ChangeQuantityUnitGroupModes",[],()=>{class e{static groupUnitIndexesNone(e){return Array.from(e.keys()).sort((e,t)=>e-t).map(t=>{return{key:e.get(t).length,value:[t]}})}static groupUnitIndexesByQuantity(e){const t=Array.from(e.keys()).sort((e,t)=>e-t),n=new Map;return t.forEach(t=>{const i=e.get(t).length;n.has(i)?n.get(i).push(t):n.set(i,[t])}),Array.from(n.keys()).sort((e,t)=>e-t).map(e=>{return{key:e,value:n.get(e)}})}static isUnitNextContinous(e,t){if(!Array.isArray(t)||!t.length||!Number.isInteger(e))return!1;return e===t[t.length-1]+1}static groupUnitIndexesByNextQuantity(t){const n=[];let i=null;return Array.from(t.keys()).sort((e,t)=>e-t).forEach(r=>{const o=t.get(r).length;i?i.key===o&&e.isUnitNextContinous(r,i.value)?i.value.push(r):(n.push(i),i={key:o,value:[r]}):i={key:o,value:[r]}}),n.push(i),n}}return e}),define("DS/ENOXEngineer/componentsHelpers/InviteDnD/DnDInvite",["i18n!DS/ENOXEngineer/assets/nls/xEngineer.json","DS/Core/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","UWA/Utils/Client","DS/UIKIT/Spinner","css!DS/ENOXEngineer/componentsHelpers/InviteDnD/DnDInvite.css","css!DS/UIKIT/UIKIT.css"],function(e,t,n,i,r,o,s){"use strict";return n.extend(i,r,{name:"dnd_invite",defaultOptions:{mode:"dynamic",invites:{drop:{nls:"drop",icon:"drag-drop"},insert:{icon:"plus",nls:"insert"}},active_invite:"drop",isTouchActivated:!1},init:function(e){this._parent(e),this.options.isTouchActivated=o.Features.touchEvents&&!o.Features.pointerEvents,this.options.isTouchActivated&&(this.options.invites.drop={nls:"drop",icon:"touch"}),this._createDynamicInvite()},_createDynamicInvite:function(){if(this.elements.container=UWA.createElement("div",{class:this.getClassNames("_container")}),this.options.isTouchActivated){this.elements.container.className+=" touch_look",this.elements.container.style.pointerEvents="auto",this.elements.container.addEventListener("touchend",function(e){})}for(var t=Object.getOwnPropertyNames(this.options.invites),n=0;n<t.length;n++){var i=t[n];this.elements.container[i]=UWA.createElement("div",{class:this.getClassNames("_display "+i),draggable:!1}),"add_in_context"===i?(new s({className:"large"}).inject(this.elements.container[i]).show(),UWA.createElement("h5",{class:this.getClassNames("_txt font-3dsregular "+i),text:e["DropInvit_"+this.options.invites[i].nls]}).inject(this.elements.container[i])):(UWA.createElement("i",{class:this.getClassNames("_img wux-ui-3ds wux-ui-3ds-5x wux-ui-3ds-"+this.options.invites[i].icon)}).inject(this.elements.container[i]),UWA.createElement("h5",{class:this.getClassNames("_txt font-3dsregular "+i),text:e["DropInvit_"+this.options.invites[i].nls]}).inject(this.elements.container[i])),this.elements.container[i].inject(this.elements.container),this.options.active_invite!==i&&this.elements.container[i].hide()}this.getOption("renderTo")&&this.elements.container.inject(this.getOption("renderTo"))},removeBorder:function(){this.elements.container.addClassName("no-border")},addBorder:function(){this.elements.container.removeClassName("no-border")},show:function(e){this.options.active_invite!==e&&(UWA.is(e,"string")?(this.options.active_invite!==e&&""!==this.options.active_invite&&this.elements.container[this.options.active_invite].hide(),this.options.active_invite=e):this.options.active_invite="drop",this.elements.container[this.options.active_invite].show(),this.elements.container.show(),this.dispatchEvent("toggleInvite",!0))},hide:function(e){UWA.is(e,"string")?""!==this.options.active_invite&&this.options.active_invite===e&&(this.elements.container[this.options.active_invite].hide(),this.elements.container.hide()):""!==this.options.active_invite&&(this.elements.container[this.options.active_invite].hide(),this.elements.container.hide()),this.options.active_invite="",this.dispatchEvent("toggleInvite",!1)}})}),define("DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialListPanel",["UWA/Core","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/CollectionView/ResponsiveLargeTilesCollectionView","DS/Controls/TooltipModel","DS/Controls/Expander","DS/Handlebars/Handlebars","text!DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialListPanel.html","css!DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialListPanel.css"],(e,t,n,i,r,o,s,a)=>{return class{constructor(t){this.appCore=t.appCore,e.is(t.onContextualEvent)&&(this.onContextualEvent=t.onContextualEvent);const n=s.compile(a),i=e.createElement("div",{html:n()});this._container=i.getElement(".material-list-panel"),this._buildSkeleton()}get content(){return this._container}get isEmpty(){return this.isReferenceEmpty&&this.isPartialEmpty}get isReferenceEmpty(){return!this._matTreeModel.getRoots().length}get isPartialEmpty(){return!this._matPartialTreeModel.getRoots().length}get length(){return this._matTreeModel.getRoots().length+this._matPartialTreeModel.getRoots().length}empty(){this._matTreeModel.empty(),this._matPartialTreeModel.empty(),this.updateViewElements()}hide(){this._container.hide()}show(){this._container.show()}fill(t){t.forEach(t=>{const n=this._buildTreeNode(t);e.is(t.matDBInfos)&&Object.defineProperty(n,"matDBInfos",{get:()=>t.matDBInfos}),e.is(t.partial)?this._matPartialTreeModel.addRoot(n):this._matTreeModel.addRoot(n)}),this.updateViewElements()}_buildTreeNode(t){const i={label:(()=>{const n=[];e.is(t.partial)&&n.push(`[${this.appCore.i18nManager.get("partial")}]`);const i=t["ds6w:label"];return n.push(i),n.join(" ")})(),icons:t.icons,thumbnail:t.thumbnail,subLabel:(()=>{const n=[];return["type","ds6wg:revision","ds6w:status","ds6w:responsible","ds6w:identifier"].forEach(i=>{const r=e.is(t[i])?t[i]:"";""!==r&&n.push(r)}),n.join(" | ")})(),description:(()=>{const n=[];if(e.is(t.context)){const e=`${t.context.V_Name} ${t.context.revision}`;n.push(`${this.appCore.i18nManager.get("context")}: ${e}`)}return n.join(" ")})(),emptyStatusbarVisibleFlag:!0,activeFlag:!1};let o=null;if(e.is(t.partial)||e.is(t.context)){const n=[];if(e.is(t.partial)){const e=(({label:e,is_penetrating:t})=>{const n=this.appCore.i18nManager.get("partial"),i=this.appCore.i18nManager.get("penetrating");return`[${n}]: ${e} ${t?i:""}`})({label:`${t.partial.support.V_Name} ${t.partial.support.revision}`,is_penetrating:t.partial.is_penetrating});n.push(e)}if(e.is(t.context)){const e=(({label:e})=>`[${this.appCore.i18nManager.get("context")}]: ${e}`)({label:`${t.context.V_Name} ${t.context.revision}`});n.push(e)}o={shortHelp:t["ds6w:label"],longHelp:n.join("\n")}}if(o){const e=new r(o);i.customTooltip=e}else i.customTooltip=null;return e.is(this.onContextualEvent)&&e.is(t.menuEntry)&&(i.contextualMenu=[t.menuEntry]),new n(i)}_buildSkeleton(){this._buildMaterialListSkeleton(),this._buildPartialMaterialListSkeleton()}_buildMaterialListSkeleton(){const n=new i({class:"material_tiles_view",displayedOptionalCellProperties:["description","contextualMenu"]});e.is(this.onContextualEvent)&&(n.onContextualEvent={callback:this.onContextualEvent}),this._matTreeModel=new t,n.model=this._matTreeModel;const r=e.createElement("div",{class:"material-tilesView-div"});n.getContent().inject(r);const o=this.content.getElement(".material-list");r.inject(o),this._addElementToUpdateList(o,()=>{const e=this._matTreeModel.getRoots().length;this._updateContentSize(r,e),e?o.show():o.hide()})}_buildPartialMaterialListSkeleton(){const n=new i({class:"material_tiles-view",displayedOptionalCellProperties:["description","contextualMenu"]});e.is(this.onContextualEvent)&&(n.onContextualEvent={callback:this.onContextualEvent}),this._matPartialTreeModel=new t,n.model=this._matPartialTreeModel;const r=e.createElement("div",{class:"material-partial-tilesView-div"});n.getContent().inject(r),this._appliedOnShapeHeader=this.appCore.i18nManager.get("materialFacet.appliedOnShape");const s=this.content.getElement(".material-partial-list"),a=new o({style:"simple",header:this._appliedOnShapeHeader,body:r,expandedFlag:!1,icon:{iconName:"3dpart",fontIconFamily:WUXManagedFontIcons.Font3DS}});a.inject(s),this._addElementToUpdateList(s,()=>{const e=this._matPartialTreeModel.getRoots().length;this._updateContentSize(r,e),s.getElement(".headerTitle").setText(`${this._appliedOnShapeHeader} (${e})`),e?s.show():s.hide()}),this._addElementToUpdateList(a,()=>{const e=this._matPartialTreeModel.getRoots().length;a.header=`${this._appliedOnShapeHeader} (${e})`})}_addElementToUpdateList(e,t){Array.isArray(this._updateEltList)||(this._updateEltList=[]),e[Symbol.for("updateView")]=t,this._updateEltList.push(e)}_updateContentSize(e,t){let n=10;t&&(n=(1===t?110:100)*t),e.setStyle("height",`${n}px`)}updateViewElements(){this._updateEltList.forEach(e=>{e[Symbol.for("updateView")]()})}}}),define("DS/ENOXEngineer/utils/PlatformDataProvider",["UWA/Core","UWA/Class/Promise","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(e,t,n){"use strict";return{getAllPlatforms:function(){return new t(function(t,i){n.getPlatformServices({onComplete:function(n){var r=function(t){if(e.is(t,"array")&&t.length>0){var n={};return t.forEach(function(e){n[e.platformId]=e}),n}return null}(n);if(null===r)return i("cannot retrieve platform data");t(r)},onFailure:i})})},getCurrentUser:function(){return new t(function(e,t){n.getUser({onComplete:function(t){e({id:t.id,email:t.email,firstName:t.firstname,lastName:t.lastname})},onFailure:t})})},loadCurrentUserRoles:function(){return new t(function(e,t){n.getGrantedRoles(function(t){e(t)})})}}}),define("DS/ENOXEngineer/commands/MaterialFacet/ENOXMaterialCommandManager",["UWA/Core","DS/CoreEvents/Events","DS/ENOXEngineerCommonUtils/XENTracker","text!DS/ENOXEngineer/assets/config/MaterialFacet/Commands.json","text!DS/ENOXEngineer/assets/config/MaterialFacet/MenuInfos.json","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],(e,t,n,i,r,o)=>{const s=new class{constructor(){this.commandList=[]}get menuInfosJson(){return JSON.parse(r)}get commandsJson(){return JSON.parse(i)}getMenu({menuEntry:e,menuOptions:t}){const n=this.getTemplateMenu(e);return this.buildMenu({menuTemplate:n,menuOptions:t})}getTemplateMenu(e){return Object.getOwnPropertyNames(this.menuInfosJson.templates).findIndex(t=>t==e)>=0?this.menuInfosJson.templates[e]:[]}getCommandDesc(e){return Object.getOwnPropertyNames(this.commandsJson).findIndex(t=>t==e)>=0?this.commandsJson[e]:null}getNls(e){const t=Object.getOwnPropertyNames(o).findIndex(t=>t==e);return t<0&&console.error(`ENOXMaterialCommandManager -> missing nls entry ${e}`),t>=0?o[e]:null}getCommandCtr({commandHdr:e,AmdLoader:t}){return new Promise((e,n)=>{require([t],t=>e(t))})}buildMenu({menuTemplate:t,menuOptions:n}){return t.map(t=>{if("command"===t.type){const i=this.getCommandDesc(t.ID);return{title:this.getNls(i.nls_key),type:"PushItem",fonticon:{family:"DSFontIcon",content:`wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-${i.fonticon}`},action:{this:this,callback:function(){e.is(n)&&e.is(n.onMenuItemClicked)&&n.onMenuItemClicked(i.commandHdr)}}}}if("separator"===t.type)return{type:"SeparatorItem"}})}get startedCommands(){return this.commandList}executeCommand({commandHeader:i,cmdOptions:r}){const o=this.getCommandDesc(i);if(!e.is(o))throw console.error(`error: ENOXMaterialCommandManager/launchCommand failed to instanciate command Ctr ${i}`),new Error(`error: ENOXMaterialCommandManager/launchCommand failed to instanciate command Ctr ${i}`);this.startedCommands.filter(e=>e._id===i).forEach(e=>e.cancel()),this.getCommandCtr(o).then(i=>{const s=r&&r.context&&r.context._app&&r.context._app.core&&r.context._app.core.sessionManager&&r.context._app.core.sessionManager.getCurrentViewOptions?r.context._app.core.sessionManager.getCurrentViewOptions():{};n.trackCommandLaunched(o.commandHdr,s);const a=new i({ID:o.commandHdr,...r}),l=[];e.is(r)&&Reflect.has(r,"onBegin")&&l.push(a.onBegin(r.onBegin)),e.is(r)&&Reflect.has(r,"onExecute")&&l.push(a.onExecute(r.onExecute)),l.push(a.onEnd(n=>{e.is(r)&&Reflect.has(r,"onEnd")&&r.onEnd(n),l.forEach(e=>t.unsubscribe(e));const i=this.startedCommands.findIndex(e=>e._id===n._id);-1!==i&&this.startedCommands.splice(i,1)})),this.startedCommands.push(a),a.begin()}).catch(e=>{throw console.error(`error: ENOXMaterialCommandManager/launchCommand failed to instanciate command Ctr ${i}`),new Error(`error: ENOXMaterialCommandManager/launchCommand failed to instanciate command Ctr ${i}`)})}};return Object.freeze(s),s}),define("DS/ENOXEngineer/services/MaterialExceptions",["i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],e=>{class t extends TypeError{}class n extends RangeError{}class i extends Error{constructor(t){let n=null;UWA.is(t.response)&&UWA.is(t.response.message)&&(n=t.response.message,UWA.is(t.response)&&UWA.is(t.response.internal)&&"no right access"===t.response.internal.toLowerCase()&&(n=`${e["error.ERR_RightAccess"]}`)),super(n)}}return{MaterialError:class{static isAMaterialError(e){return e instanceof t||e instanceof n||e instanceof i}},MaterialTypeError:t,MaterialSamePidError:n,MaterialServerError:i}}),define("DS/ENOXEngineer/services/PersistencyManager",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n,i){"use strict";return t.singleton({init:function(e){this._parent(e)},initialize:function(e){this.logger=e.core.logger.get("PersistencyManager manager initializing");e.core.PersistencyManager=e.sandboxBase.PersistencyManager=this,this.app=e,this._isWidgetRefreshing=null},saveUserSelectedNodes:function(e){var t=[];e.forEach(function(e){var n=e.buildNodeId?e.buildNodeId():null;n&&t.push(n)}),widget.setValue(i.USER_SELECTED_NODE_IDS,t)},saveUserSelectedNodeIDs:function(e){widget.setValue(i.USER_SELECTED_NODE_IDS,e)},getViewBasedIDForStorage:function(e){var t,n=this.app.core.localStorage.getItem(i.VALUE_QUANTITY_VIEW);return null==this.app.core.contextManager.getActiveEngItem()||n?t=e.getID():"function"==typeof e.getRelationID&&(t=e.getRelationID()),t},restorePersistedSelection:function(e){const t=this.getUserSelectedNodeIDs();this.restoreSelection(e,t)},restoreSelection:function(e,t){(e.unselectAll(),Array.isArray(t)&&t.length>0)&&e.findNodesByIds(t).forEach(function(e){e.select()})},restoreViewForHomePage:function(e,t){var n=this.getUserSelectedNodeIDs();Array.isArray(t)&&t.length>0&&(n=t),this.restoreSelection(e,n);var r=widget.getValue(i.IS_INFORMATION_PANEL_LAUNCHED_FOR_HOME_PAGE);this.restoreInformationPanel(r)},restoreInformationPanel:function(e){!0===e&&(this.restoreInformationPanelWidth(),this.app.core.mediator.publish(i.EVENT_TRIPTYCH_SHOW_PANEL,"right"),this.app.core.mediator.publish(i.EVENT_INFO_PANEL_VISIBLE))},getUserSelectedNodeIDs:function(){return widget.getValue(i.USER_SELECTED_NODE_IDS)},setInformationPanelStatus:function(e){widget.setValue(i.IS_INFORMATION_PANEL_LAUNCHED,e),!1===e&&this.resetInformationPanelWidth()},restoreInformationPanelForIdCard:function(e){if(widget.getValue(i.IS_INFORMATION_PANEL_LAUNCHED)){this.restoreInformationPanelWidth(),this.app.core.mediator.publish(i.EVENT_IDCARD_CUSTOM_INFORMATION_ICON);let t=e.getSelectedNodes().length>0?e.getSelectedNodes():[e.getEngineeringItem()];e.pushNodesToEditProperties(t)}},isIDCardMinified:function(){return widget.getValue(i.ID_CARD_MINIFICATION)!=i.ID_CARD_EXPAND},setIDCardMinificationsStatus:function(e){widget.setValue(i.ID_CARD_MINIFICATION,e)},setInformationPanelStatusForHomePage:function(e){widget.setValue(i.IS_INFORMATION_PANEL_LAUNCHED_FOR_HOME_PAGE,e),!1===e&&this.resetInformationPanelWidth()},setWidgetRefreshStatus:function(e){this._isWidgetRefreshing=e},getWidgetRefreshStatus:function(){return this._isWidgetRefreshing},restoreInformationPanelWidth:function(){const e=widget.getValue(i.INFORMATION_PANEL_WIDTH);"number"==typeof e&&e>0&&this.app.core.mediator.publish(i.EVENT_TRIPTYCH_SET_SIZE,{side:"right",size:e})},resetInformationPanelWidth:function(){widget.setValue(i.INFORMATION_PANEL_WIDTH,0)},setInformationPanelWidth:function(e){"number"==typeof e&&widget.setValue(i.INFORMATION_PANEL_WIDTH,e)},setNGFilterCmdLaunchState:function(e){widget.setValue(i.IS_NGFILTER_PANEL_LAUNCHED,e)},restoreNGFilterCmdLaunchSate:function(){!0===widget.getValue(i.IS_NGFILTER_PANEL_LAUNCHED)&&!1===this.app.core.contextManager.isRunningCmd(i.LAUNCH_NG_FILTER_CMD)&&this.app.core.mediator.publish(i.EVENT_LAUNCH_COMMAND,{commandId:i.LAUNCH_NG_FILTER_CMD,context:{}})},getNGFilter:function(){return widget.getValue("NGFilter")},setNGFilter:function(e){widget.setValue("NGFilter",e)},resetNGFilter:function(){widget.deleteValue("NGFilter")},setGroupByOption:function(e){widget.setValue(i.GROUPBY_OPTIONS,e)},getGroupByOption:function(){return widget.getValue(i.GROUPBY_OPTIONS)}})}),define("DS/ENOXEngineer/components/Triptych/TriptychWrapper",["DS/ENOXTriptych/js/ENOXTriptych","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/ENOXEngineer/utils/XEngineerConstants","UWA/Controls/Drag","css!DS/ENOXEngineer/components/Triptych/ENOXTriptych.css"],function(e,t,n,i){"use strict";function r(t){this.sandbox=t;var n={left:{resizable:!1,originalSize:300,originalState:"close",pushOnMobile:!0},right:{resizable:!0,originalSize:400,originalState:"close",pushOnMobile:!0},container:t.getContainer(),withtransition:!0,modelEvents:t.getApplicationBroker()};this.leftSideDiv=document.createElement("div"),this.leftSideDiv.classList.add("triptych-panel-wrapper"),this.centerDiv=document.createElement("div"),this.centerDiv.classList.add("triptych-panel-wrapper"),this.rightDiv=document.createElement("div"),this.rightDiv.classList.add("triptych-panel-wrapper"),this.rightDiv.classList.add("triptych-right-panel-wrapper"),this.triptych=new e,this.triptych.init(n,this.leftSideDiv,this.centerDiv,this.rightDiv),this.mainDiv=document.createElement("div"),this.mainDiv.classList.add("xen-main-panel-wrapper"),this.centerDiv.appendChild(this.mainDiv)}return r.prototype.start=function(){var e=this;const r=!0===e.sandbox.core.dataService.getUserWorkUnderShowPref()?"show":"hide";let o=e.sandbox.core.dataService.getUserWorkUnderPositionPref();o===n.CHANGECONTROL_POSITION_FREE_VALUE&&(o=widget.getValue("changeControlFreeDefaultPosition")),t.initialize2(e.centerDiv,e.sandbox.core.settingManager.getAppId(),r,o,function(e){console.warn(e)},{isEditable:!0,isEvolution:!0,isChange:!0,isMovable:!0,resetDefault:!0});let s=()=>{e.bubbleDragControl||(e.bubbleDragControl=new i.Move({container:e.centerDiv,delegate:"#BubbleContainer > *",centerHandles:!0,handles:function(e){return e.target.getClosest("#BubbleContainer")},stop:function(){let t=e.centerDiv.querySelector("#BubbleContainer");if(t){const e=t.style.top,n=t.style.left;widget.setValues({"bubble-top":e,"bubble-left":n})}}}))},a=()=>{let e=this.centerDiv.querySelector("#BubbleContainer");if(e){const t=e.style.top,n=e.style.left;(t||n)&&e.setStyles({top:null,left:null})}widget.setValue("bubble-top",null),widget.setValue("bubble-left",null)},l=()=>{let e=this.centerDiv.querySelector("#BubbleContainer"),t=null;if(e){let n=e.className;if("string"==typeof n){const e="position-",i=0===n.indexOf(e)?n.substring(e.length,n.length):null;"string"==typeof i&&i.length&&(t=i)}}return t};if(widget){widget.addEvents({onRefresh:()=>{e.sandbox.core.dataService.getUserWorkUnderPositionPref()!==n.CHANGECONTROL_POSITION_FREE_VALUE&&a()},endEdit:()=>{e.sandbox.core.dataService.getUserWorkUnderShowPref()?t.show():t.hide();const i=e.sandbox.core.dataService.getUserWorkUnderPositionPref();if(i===n.CHANGECONTROL_POSITION_FREE_VALUE){const e=l();"string"==typeof e&&e.length&&widget.setValue("changeControlFreeDefaultPosition",e),s()}else a(),e.bubbleDragControl&&(e.bubbleDragControl&&e.bubbleDragControl.destroy(),e.bubbleDragControl=null),t.setPosition(i)}}),(t=>{if(t!==n.CHANGECONTROL_POSITION_FREE_VALUE)return;if(!widget)return;const i=widget.getValue("bubble-top"),r=widget.getValue("bubble-left");let o=e.centerDiv.querySelector("#BubbleContainer");o&&(i&&r&&o.setStyles({top:i,left:r}),s())})(e.sandbox.core.dataService.getUserWorkUnderPositionPref())}},r}),define("DS/ENOXEngineer/sessionBuilders/GroupSessionBuilder",["DS/ENOXEngineer/utils/XEngineerConstants"],e=>{return class{constructor(e){if(!e||!e.appCore||!e.models)throw console.error("missing options for SessionBuildersManager"),new Error;this.appCore=e.appCore,this.models=e.models,this.engItem=this.models.getEngineeringItem()}async registerContentfetcher(t,n){if(!t)throw new Error("invalid engItem");let i;if(n&&n[e.CONST_FIND_IN_CRITERIA])i=this.models.registerContentFetcher(this.models.addFindEngItemChildren(t,n),"content.addFindChildren",this.engItem,n);else if(Array.isArray(t)){const r=[],o=[];t.forEach(e=>!0===e.isGroupingNode?r.push(e):o.push(e)),r.length&&(i=this.models.registerContentFetcher(this.models.expandGroupedEngItemChildren(r),"content.addGroupChildren")),o.length&&(i=this.models.registerContentFetcher(this.models.addChildren(o,n?n[e.CONST_TARGET_LEVEL]:void 0),"content.addChildren"))}else i=this.models.registerContentFetcher(this.models.addGroupedEngItemChildren(n),"content.addGroupChildren");i.fetchHolisticContentDefiniton(),delete this.appCore,delete this.models,delete this.engItem}async retrieveAdditionalColumnProviders(){return!0}async buildSession(e){return this.registerContentfetcher(this.engItem,e),!0}}}),define("DS/ENOXEngineer/commands/DocumentManagementCmd",["UWA/Class","DS/ApplicationFrame/Command","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager"],function(e,t,n,i){"use strict";return t.extend({init:function(e){this._parent(e)},execute:function(e){var t=this,r={};let o=t.options.appCore.settingManager.getPlatformId(),s=Array.isArray(t.options.context.getSelectedNodes())&&t.options.context.getSelectedNodes()[0];r.document={id:s.getID(),contextId:t.options.context.getSecurityContext().SecurityContext,serviceId:"3DSpace",envId:o,data:{id:s.getID(),title:s.getTitleForIdcard(),relName:"SpecificationDocument",parentDirection:"from",parentId:t.options.context.getContext().getParent(s).getID(),files:s.options.files}},r.platformUrls=t.options.context._app.core.settingManager._platforms[o],r.getWorkUnderHeaders=function(){return t.options.context._app.core.settingManager.getWorkUnderHeaders()},r.onComplete=function(e){t.options.context.getContext().refresh(e),e.result&&e.result.message&&i.sucessAlert(e.result.message)},r.onFailure=function(e){i.errorAlert(e.result.message)},require(["DS/DocumentCommands/ENOXDocumentCommands","DS/DocumentCommands/Constants"],function(e,i){let o=new e;o.init(r);let s=o.render();switch(t.options.ID){case n.REPLACE_BY_REVISION_DOCUEMNT_CMD:s[i.REPLACE_BY_REVISION].items[0].handler();break;case n.REPLACE_BY_LATEST_REVISION_DOCUEMNT_CMD:s[i.REPLACE_BY_REVISION].items[1].handler();break;case n.EDIT_DOCUMENT_CMD:s[i.EDIT].handler();break;case n.UPDATE_DOCUMENT_CMD:s[i.UPDATE].handler();break;case n.UNDO_EDIT_DOCUEMNT_CMD:s[i.UNDO_EDIT].handler()}})}})}),define("DS/ENOXEngineer/components/EngItemViewer/EngItemViewer",["UWA/Core","DS/ENOXEngineerCommonUtils/XENMask","DS/ENOXSplitViewVertical/js/ENOXSplitViewVertical","text!DS/ENOXEngineer/components/EngItemViewer/EngItemViewer.html","text!DS/ENOXEngineer/components/EngItemViewer/EngListWrapper.html","DS/ENOXEngineer/utils/XEngineerConstants","DS/Controls/ProgressBar","css!DS/ENOXEngineer/components/EngItemViewer/EngItemViewer.css"],function(e,t,n,i,r,o,s){"use strict";var a=110,l=38;return function(e){return{container:e.getContainer(),start:function(){var n=this;this.isStarted=!0,this._modelEvents=e.getApplicationBroker(),e.emptyContainer(),e.addContent(i),this._itemViewerWrapper=this.container.firstChild,this._initDivs(),this._initDataLoaderIndicator(),this._subscribeToEvents(),this._progressBarContainer=this.listViewContainer.getElement(".data-loader-progress-bar"),t.mask(UWA.extendElement(this.container));var r=!1;e.subscribe(o.EVENT_LIST_READY,function(){t.unmask(n.listViewContainer),t.unmask(n.container),r||(t.mask(UWA.extendElement(n.idCardContainer)),r=!0)}),e.subscribe(o.EVENT_IDCARD_READY,function(){t.unmask(UWA.extendElement(n.container)),t.unmask(UWA.extendElement(n.idCardContainer)),r||(t.mask(UWA.extendElement(n.listViewContainer)),r=!0)})},_initDataLoaderIndicator:function(){this.dataProgressBar=new s({displayStyle:"lite"}),this.dataProgressBar.__isInjected=!1},_subscribeToEvents:function(){var t=this;e.subscribe("content-loader-indicator-start",function(){t.dataProgressBar.value=10,t.dataProgressBar.__isInjected||(t.dataProgressBar.__isInjected=!0,t._progressBarContainer.setStyles({"margin-top":"-6px",height:"5px"}),t.dataProgressBar.inject(t._progressBarContainer))}),e.subscribe("content-loader-indicator-progress",function(e){t.dataProgressBar.value+=Math.ceil(e)}),e.subscribe("content-loader-indicator-completed",function(){t.dataProgressBar.value=99,setTimeout(function(){t.dataProgressBar.__isInjected&&(t.dataProgressBar.__isInjected=!1,t.dataProgressBar.remove(),t._progressBarContainer.setStyles({"margin-top":"0",height:"0"}))},100)}),e.subscribe("idcard-container-minimize-idcard",function(){e.publish("splitview-vertical-set-top-size",l),e.publish("idcard-minify")}),e.subscribe("idcard-container-maximize-idcard",function(){e.publish("splitview-vertical-set-top-size",a),e.publish("idcard-expand")}),e.subscribe("idcard-minified",function(){e.publish("splitview-vertical-set-top-size",l),e.core.PersistencyManager.setIDCardMinificationsStatus(o.ID_CARD_MINIFY),e.publish("idcard-minify"),e.publish(o.EVENT_SYNC_MATURITY_WITH_MODEL)}),e.subscribe("idcard-expanded",function(){e.publish("splitview-vertical-set-top-size",a),e.core.PersistencyManager.setIDCardMinificationsStatus(o.ID_CARD_EXPAND),e.publish("idcard-expand"),e.publish(o.EVENT_SYNC_MATURITY_WITH_MODEL)}),e.subscribe("splitview-vertical-resized",function(t){t===l?e.publish("idcard-container-minified"):t===a&&e.publish("idcard-container-maximized")})},_initDivs:function(){var t={withtransition:!0,withoverflowhidden:!0,sizeType:"px"};t.originalTop=e.core.PersistencyManager.isIDCardMinified()?l:a,t.modelEvents=this._modelEvents,this._ENOXSplitViewVertical=new n,this._ENOXSplitViewVertical.init(t),this._itemViewerWrapper.appendChild(this._ENOXSplitViewVertical.getContent()),this.idCardContainer=UWA.extendElement(this._ENOXSplitViewVertical.getContent().querySelector(".top-container")),this.listViewContainer=UWA.extendElement(this._ENOXSplitViewVertical.getContent().querySelector(".bot-container")),this.listViewContainer.innerHTML=r},stop:function(){this._ENOXSplitViewVertical.destroy(),e.emptyContainer(),e.stop(this)}}}}),define("DS/ENOXEngineer/components/XEngWelcomePanel/XEngWelcomePanel",["UWA/Core","DS/ENOXWelcomePanel/js/ENOXWelcomePanel","DS/ENOXEngineer/utils/XEngineerConstants","css!DS/ENOXEngineer/components/XEngWelcomePanel/XEngWelcomePanel.css"],function(e,t,n){"use strict";return function(e){var i=e.getContainer();const r=[],o=(e.core.PreferencesManager.isUserSelectedTypeChooserOption(),e.core.PreferencesManager.isShowCreateFromSpreadsheetEnabled()),s={id:"add_engItem",text:e.i18nManager.get("add_engItem"),fonticon:"fonticon fonticon-3dproduct-add",className:"action-new",isNotHighlightable:!0},a={id:"add_newPart",text:e.i18nManager.get("add_new_part"),fonticon:"fonticon fonticon-3dpart-add",className:"action-new",isNotHighlightable:!0},l={id:"import_items",text:e.i18nManager.get("eng.import.label"),fonticon:"fonticon fonticon-import",className:"action-new",isNotHighlightable:!0};return r.push(s),r.push(a),o&&r.push(l),{isFirstDrop:!0,mainContainer:null,myWelcomePanel:null,isStarted:!1,start:function(){var o={collapsed:!1,title:e.i18nManager.get("APP_NAME"),subtitle:e.i18nManager.get("APP_SUBTITLE"),notifications:[],activities:[{id:"activity_browsing",title:e.i18nManager.get("quick-access"),actions:[{id:"recent_items",text:e.i18nManager.get("recent_items"),fonticon:"clock",className:"action-new"},{id:"my_eng_items",text:e.i18nManager.get("my_eng_items"),fonticon:"product",className:"action-new",isDefault:!0},{id:"open_engItem",text:e.i18nManager.get("open_engItem"),fonticon:"open",className:"action-new",isNotHighlightable:!0}]},{id:"activity_creation",title:e.i18nManager.get("start-activity"),actions:r}],selectedItem:"my_eng_items",parentContainer:i,footer:[{id:"setting_pref",text:e.i18nManager.get("setting_pref"),fonticon:"tools",actions:[]}],modelEvents:e.getApplicationBroker()};this.myWelcomePanel=new t(o),this.myWelcomePanel.render(),e.subscribe(n.EVENT_REFRESH_APP_CONTENT,()=>{this.update()}),e.subscribe(n.EVENT_TRIPTYCH_PANEL_VISIBLE,function(e){"left"===e&&(i.style.visibility="visible")}),e.subscribe(n.EVENT_TRIPTYCH_PANEL_HIDDEN,function(e){"left"===e&&(i.style.visibility="hidden")})},update:function(){this.updateCreateFromSpreadsheetVisiblity()},updateCreateFromSpreadsheetVisiblity:function(){const t=e.core.PreferencesManager.isShowCreateFromSpreadsheetEnabled(),n=this.getActionByID("activity_creation","import_items");if(t&&!n){const t={id:"import_items",text:e.i18nManager.get("eng.import.label"),fonticon:"fonticon fonticon-import",className:"action-new",isNotHighlightable:!0};this.myWelcomePanel.createNewAction("activity_creation",t,2)}else!t&&n&&this.myWelcomePanel.removeAction("import_items")},getActionByID:function(e,t){return this.myWelcomePanel.activities.find(t=>t.id===e).actions.find(e=>e.id===t)},reRender:function(){},stop:function(){e.publish("triptych-hide-panel","left")}}}}),define("DS/ENOXEngineer/sessionBuilders/NextGenFilterSessionBuilder",["DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager"],function(e,t,n){"use strict";function i(e){if(!e||!e.appCore||!e.models)throw console.error("missing options for SessionBuildersManager"),new Error("");this.appCore=e.appCore,this.models=e.models,this.engItem=this.models.getEngineeringItem()}return i.prototype.registerContentfetcher=function(e,i){if(i&&i[t.CONST_FIND_IN_CRITERIA])r=this.models.registerContentFetcher(this.models.addFindEngItemChildren(e,i),"content.addFindChildren",this.engItem,i);else{var r=this.models.registerContentFetcher(this.models.addFilteredEngItemChildren(),"content.addFilterChildren");if(this.appCore.PreferencesManager.isSpecInProductStructureEnabled()){if(this.appCore.sessionManager.isUsingDB()){const e=this.appCore.i18nManager.get("enabling.index.acceleration");n.warningAlert(e),this.appCore.sessionManager.setAuthoringMode("index")}r.registerContentFetcher(this.models.addEngItemDocuments("PLMDocConnection"),"content.cnxDocument")}}r.fetchHolisticContentDefiniton(),delete this.appCore,delete this.models,delete this.engItem},i.prototype.resolveFilteringContext=function(){var t=this;return e.wrappedWithPromise(function(e,n){if(t.engItem.hasValidTransientNextGenFilter()||t.engItem.hasValidPersistedNextGenFilter())return e(!0);let i=!1,r=null;t.engItem.hasPesistencyManagerdNGFilter()&&(r=t.appCore.PersistencyManager.getNGFilter(),i=!0),t.models.retrievePreferreedNGFilter(r).then(function(o){var s=o[0]||null;return s?(!0===i?t.engItem.setPersistedNGFilterContext(s,!1):(s.filterId=r.filterId,t.engItem.setPersistedNGFilterContext(s)),e(!0)):n(new Error("no filter found"))}).catch(function(e){console.error(e),n(e)})})},i.prototype.retrieveCurrentFilterInfo=function(){return{rootId:this.engItem.getID(),label:this.engItem.getNGFilterName(),CVQuery:this.engItem.getNextGenFilterExpandOptions().CVQuery,CVQueryV2:this.engItem.getNextGenFilterExpandOptions().CVQueryV2,filterId:this.engItem.getNGFilterId()}},i.prototype.retrieveAdditionalColumnProviders=function(){return e.wrappedWithPromise(function(e,t){return e(!0)})},i.prototype.buildSession=function(t){var n=this;return e.wrappedWithPromise(function(e,i){n.resolveFilteringContext().then(function(){var i=n.retrieveCurrentFilterInfo();n.appCore.sessionManager.saveCurrentOpenContext({rootId:i.rootId,filteringContext:"nextGenFilter",filterData:{CVQuery:i.CVQuery,CVQueryV2:i.CVQueryV2,label:i.label,filterId:i.filterId}}),n.registerContentfetcher(void 0,t),e(!0)}).catch(function(i){n.registerContentfetcher(void 0,t),e(!0)})})},i}),define("DS/ENOXEngineer/services/I18nManager",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/ENOXEngineer/utils/XEngineerConstants","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n,i,r,o){"use strict";return t.singleton({init:function(e){this._parent(e)},initialize:function(e){this.logger=e.core.logger.get("I18nManager manager initializing");e.core.i18nManager=this,e.sandboxBase.i18nManager=this,this.app=e},resolveMissingNls:function(e){if(!Array.isArray(e.classes)||!e.properties)throw new Error("Ouups ! invalid input");var t=[];return t.push(this.getResourcesInfo(e.classes.join(","))),t.push(this.getNlsOfPropertiesValues(e.properties)),n.allSettled(t)},resolveRangeValueNls:function(e){if(!e)throw new Error("Ouups ! invalid input");return this.getNlsOfPropertiesValues(e)},_isPropertyKey:function(e){return e.split("/").length>1},_isVocabularyElement:function(e){return e&&e.indexOf(":")>-1},replace:o.replace,get:function(t){if(!e.is(t,"string"))return null;if("ds6wg:MaterialUsageExtension.DeclaredQuantity"===t)return o.get("MaterialUsageExtension.DeclaredQuantity");if(t.endsWith("-Instance")&&(t=t.substring(0,t.length-"-Instance".length)),this._isVocabularyElement(t)){if(this._isPropertyKey(t)){var n=t.split("/"),i=n[0],r=n[1];return this.ds6wClassPropNls&&this.ds6wClassPropNls[i]&&this.ds6wClassPropNls[i][r]?this.ds6wClassPropNls[i][r]:r}if(this.ds6wClassNls&&this.ds6wClassNls[t]&&this.ds6wClassNls[t].nlsName){let e=this.ds6wClassNls[t].nlsName;return e.contains(".")?e.substring(e.indexOf(".")+1):e}return t}return o.get(t)},warmupNLS:function(){var e=this.app.core.settingManager.getSetting(r.RDF_CLASSES_TO_LOAD),t=[],i=this.app.core.dicoService.getAvailableAttributes().map(function(e){return e.ds6w}).concat(this.app.core.dicoService.getSelectedTypes()).join(",");i&&i.length>0&&(e=e+","+i),t.push(this.getResourcesInfo(e));var o=this.app.core.settingManager.getSetting(r.MOST_USED_PROP_VALUE);return t.push(this.getNlsOfPropertiesValues(o)),n.allSettled(t)},loadClassesNlsValue:function(e){var t=this;return new n(function(n,i){if(!Array.isArray(e)||0===e.length)return i("invalid input");t.getResourcesInfo(e).then(n).catch(i)})},getResourcesInfo:function(e){var t=this;return new n(function(n,r){i.getResourcesInfo(e,{apiVersion:"R2019x",tenantId:t.app.core.settingManager.getPlatformId(),lang:t.app.core.settingManager.getLanguage(),onComplete:function(e){Array.isArray(e)&&(t.ds6wClassNls||(t.ds6wClassNls={}),e.forEach(function(e){t.ds6wClassNls[e.curi]={nlsName:e.label,uri:e.curi}}),n(t.ds6wClassNls))},onFailure:function(){console.warn("DictionaryAccess## FedDictionaryAccessAPI.getResourcesInfo failed for"+e),n()}})})},getNlsOfPropertiesValues:function(t){var r=this;return new n(function(n,o){i.getNlsOfPropertiesValues(JSON.stringify(t),{apiVersion:"R2019x",tenantId:r.app.core.settingManager.getPlatformId(),lang:r.app.core.settingManager.getLanguage(),onComplete:function(t){t&&(r.ds6wClassPropNls||(r.ds6wClassPropNls={}),e.extend(r.ds6wClassPropNls,t,!0),n(r.ds6wClassPropNls))},onFailure:function(){console.warn("DictionaryAccess## FedDictionaryAccessAPI.getNlsOfPropertiesValues failed for"+t),n()}})})}})}),define("DS/ENOXEngineer/columnsProviders/ManufacturingResponsibilityDataProvider",["UWA/Core","UWA/Class","DS/ENOXEngineer/services/I18nManager","DS/ENOXEngineer/utils/XEngineerConstants","DS/DELPPWFacets/DataProvider/ManufacturingDataProvider"],function(e,t,n,i,r){"use strict";return t.singleton({_typeHierarchy:{},init:function(e){this._parent(e),r.init()},isAdditionalColumnsAvailable:function(t){if(!1===e.is(t,"function"))throw new Error("A callback function should be defined");setTimeout(function(){t(!0)},500)},getName:function(){return i.MANUFACTURING_RESPONSIBILITY_COLUMN},getManagedColumnNames:function(){return[i.MANUFACTURING_RESPONSIBILITY]},toBeUpdated:function(t){var n=!0;return e.is(t)&&e.is(t[i.MANUFACTURING_RESPONSIBILITY])&&(n=!1),n},getAdditionalColumnsUX:function(e){var t=e.findIndex(function(e){return e.dataIndex===i.MANUFACTURING});e.splice(t,t>=0?1:0,{text:n.get(i.MANUFACTURING),dataIndex:i.MANUFACTURING,maxWidth:800,minWidth:20,width:200})},_fetchData:function(e){return r._fetchData(e)},updateAttributes:function(t,n){var i={};if(!1===e.is(t,"object"))throw new Error("The object ids to modify must be specify");if(!1===e.is(n,"function"))throw new Error("A callback function should be defined");this._fetchData(t.pids).then(function(e){t.pids.forEach(function(t){i[t]={Manufacturing:e[t]}}),n({pids:i})}).catch(function(){t.pids.forEach(function(e){i[e]={Manufacturing:"None"}}),n({pids:i})})}})}),define("DS/ENOXEngineer/services/SessionPredicates/Utils",["DS/ENOXEngineer/services/SessionPredicates/SessionPredicatesErrors","DS/ENOXEngineer/utils/XEngineerConstants"],(e,t)=>{const{WrongInput:n}=e,i=e=>{return"string"==typeof e&&e.trim().length>0},r=e=>"attribute"===e.nature,o=e=>"string"!=typeof e.valuetype||-1===e.valuetype.search(/([mM]ulti)/g),s=e=>i(e.selectable),a=(e,t)=>({editablePaths:e,objectAttributes:[t],get selectables(){return e.map(e=>e.selectable)},get selectablesAsString(){return JSON.stringify(this.selectables)},areSelectablesEquals(e){return this.selectablesAsString===e.selectablesAsString},pushObjectAttribute(e){this.objectAttributes.push(e)}});return{removeDuplicates:e=>{if(!Array.isArray(e))throw new n("removeDuplicates");return[...new Set(e)]},udpateMapWithNewValues:(e,t)=>{if(e instanceof Map==0||!Array.isArray(t))throw new n("udpateMapWithNewValues");t.forEach(t=>{const{curi:n}=t;e.has(n)?e.get(n).push(t):e.set(n,[t])})},getMissingFromRefInputs:(e,t)=>{const{types:i,extensions:r}=e||{},{types:o,extensions:s}=t||{};if(!(Array.isArray(i)&&Array.isArray(r)&&Array.isArray(o)&&Array.isArray(s)))throw new n("Utils.getMissingFromRefInputs");const a=i.filter(e=>-1===o.indexOf(e)),l=r.filter(e=>-1===s.indexOf(e));return{types:a,extensions:l,hasMissing:0!==a.length||0!==l.length}},areInputsEquals:(e,t)=>{const{types:n,extensions:i}=e,{types:r,extensions:o}=t;return JSON.stringify(n)===JSON.stringify(r)&&JSON.stringify(i)===JSON.stringify(o)},formatClassesPredicatesToPropertiesPredicates:e=>{if(!Array.isArray(e))throw new n("formatClassesPredicatesToPropertiesPredicates");const t=[];return e.forEach(e=>{const{classInfo:n,properties:i}=e;i.forEach(e=>{const i={...e,classInfo:n};t.push(i)})}),t},isAnAttributePredicate:e=>{const{nature:t}=e||{};return"attribute"===t},isAValidNotEmptyString:i,isStringADate:e=>-1!==e.indexOf("@")&&-1!==e.indexOf(":GMT"),isAValidNotEmptyArray:e=>{return Array.isArray(e)&&e.length>0},isAnInstanceAttribute:e=>"rel"===e.ds6wFrom,formatEditableForUXChooser:e=>{const t={};e.forEach(e=>{const{objectAttribute:n,editablePaths:i}=e,{predicateToEdit:r}=n,o=a(i,n);if(t[r]){const e=t[r].find(e=>o.areSelectablesEquals(e));e?e.pushObjectAttribute(n):t[r].push(o)}else t[r]=[o]});const n=[];return Reflect.ownKeys(t).forEach(e=>{t[e].forEach(t=>{const{editablePaths:i,objectAttributes:r}=t;n.push({predicateToEdit:e,editablePaths:i,objectAttributes:r})})}),n},getAttributeFromSelectable:e=>{if(!i(e))throw new n("getAttributeFromSelectable");const t=e.indexOf(".");return-1!==t&&t<e.length-1?e.substring(t+1):e},constants:{FULFILLED_PROMISE:"fulfilled",SESSION_PREDICATES_LOGGER_ID:"SessionPredicates"},PropertiesHelpersFunc:{isASingleEditableAttribute:e=>r(e)&&s(e)&&o(e)&&(e=>"string"==typeof e.userAccess&&-1!==e.userAccess.search(/([wW]rite)/g))(e),asSelectable:e=>e.selectable,isASingleAttribute:e=>r(e)&&s(e)&&o(e)}}}),define("DS/ENOXEngineer/utils/ResponseParser",["UWA/Core","WebappsUtils/WebappsUtils","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n){const i=(t,n)=>{if(!e.is(t))return!1;if(!Reflect.has(t,n))return!1;return""!==("string"==typeof t[n]?t[n].trim():"")},r=()=>({get hasQuantity(){return i(this,"ds6wg:MaterialUsageExtension.DeclaredQuantity")||i(this,"ds6wg:DELFmiContQuantity_Mass.V_ContQuantity")||i(this,"ds6wg:DELFmiContQuantity_Volume.V_ContQuantity")},get getDeformableObjectIDFromDeformed(){let e=i(this,n.CONST_DEFORMABLE_SEMANTIC_REL_INFO)?this[n.CONST_DEFORMABLE_SEMANTIC_REL_INFO]:null;if(e&&Array.isArray(e.split(" "))){let t=e.split(" ");if(8==t.length)return t[6]}return null},get isCoreMaterialConsumption(){return i(this,"CoreMaterialID")&&this.hasQuantity},get isRelation(){return Reflect.has(this,"to")||Reflect.has(this,"from")}});return{getListOfVersionsFromRoot:function(e,t){if(!e)return null;if(t.push(this._readVersionData(e)),Array.isArray(e.Derived)&&e.Derived.length>0)for(var n=0;n<e.Derived.length;n++)this.getListOfVersionsFromRoot(e.Derived[n],t);e["Main Derived"]&&e["Main Derived"].id&&this.getListOfVersionsFromRoot(e["Main Derived"],t)},_readVersionData:function(e){if(!e)return null;var t={type:e.type,type_NLS:e.type_NLS,revision:e.revision,state:e.current,state_NLS:e.current_NLS,physicalid:this._getPidWithoutPrefix(e.id),icons:["product"],name:e.name,thumbnail:e.image&&e.image.trim().length>0?e.image:null};return e.attributes&&(t.MarketingName=e.attributes.MarketingName||null),t.label=t.MarketingName?t.MarketingName:t.name,t.label+=" - "+t.revision,t.subLabel=t.type_NLS,t.description=t.state_NLS,t},retrieveProdConfsInfo:function(e){if(!e||!Array.isArray(e.productconfigurations))throw new Error("Ouups ! invalid response structure");var t=[],n=this;return e.productconfigurations.forEach(function(e){t.push({name:e.name,id:n._getPidWithoutPrefix(e.id),marketingName:e.marketingName,FilterCompiledForm:e.attributes?e.attributes.FilterCompiledForm:null})}),t},parseSetConfContext:function(e){var t=["ERROR","WARNING","notProcessed"],n=[];if(!e)return n.push({status:!1,message:"UNKNOWN Response"}),n;const{version:i}=e;switch(i){case"1.2":const{details:t}=e,[n]=Array.isArray(t)?t:[];contexts=n?n.contexts:null;break;default:contexts=e.contexts}const{content:r}=contexts||{};return Array.isArray(r)?(r.forEach(e=>{-1!==t.indexOf(e.status)?n.push({status:!1,message:e.errorMessage,modelId:e.modelId}):n.push({status:!0,message:e.errorMessage,modelId:e.modelId})}),n):(n.push({status:!1,message:"UNKNOWN Response"}),n)},configInfoParser:function(e){if(!(e&&e.contexts&&e.contexts.content&&Array.isArray(e.contexts.content.results)))throw new Error("Ouups ! invalid response structure");for(var t=[],n=e.contexts.content.results,i=0;i<n.length;i++)if(n[i].success){var r=this.maskBasedAttributesParser(n[i]);t.push(r)}return t},_getPidWithoutPrefix:function(e){return e.startsWith("pid:")?e.substr(4):e},modelVersionsParser:function(e){return e&&e.products?e.products:null},maskBasedAttributesParser:function(e){var t=this;if(!Array.isArray(e.basicData))return null;var n={};return e.basicData.forEach(function(e){switch(e.name){case"owner":n.subLabel=n["ds6w:responsible"]=t._getDBAttributeValue(e);break;case"description":n.description=n["ds6w:description"]=t._getDBAttributeValue(e);break;case"type":n.type=t._getDBAttributeValue(e);break;case"originated":n["ds6w:created"]=t._getDBAttributeValue(e);break;case"modified":n["ds6w:modified"]=t._getDBAttributeValue(e);break;case"revision":n["ds6wg:revision"]=t._getDBAttributeValue(e);break;case"current":n["ds6w:status"]=t._getDBAttributeValue(e);break;case"name":n.label=n["ds6w:label"]=t._getDBAttributeValue(e,"")}}),e.data.forEach(e=>{switch(e.name){case"Marketing Name":n["Marketing Name"]=t._getDBAttributeValue(e)}}),n.description="State : "+n["ds6w:status"],n.icons=["product"],n.physicalid=e.physicalID,n},_getDBAttributeValue:function(e,t){return Array.isArray(e.value)?e.value[0]:t},attributesParser:function(e,t,n,i){if(!Array.isArray(e))throw new Error("Ouups ! invalid input");for(var o=r(),s=e,a=0;a<s.length;a++){const e=s[a];this.convertAttributeAndAddToJsonNode(e,o,t,n,i)}return o},convertAttributeAndAddToJsonNode({name:e,value:t,format:i},r,o,s,a){let l=e;const c={value:t};if(i&&"ds6w_facet"===i&&(l=e.split("/").pop()),o&&Array.isArray(o.classes)&&o.properties&&(-1===o.classes.indexOf(l)&&o.classes.push(l),Array.isArray(o.withNlsProp)&&-1!==o.withNlsProp.indexOf(l)&&(o.properties[l]||(o.properties[l]=[]),-1===o.properties[l].indexOf(c.value))))if(s){let e=c.value;const t=n.INDEX_MODE_MULTIVALUES_SEPARATOR;e=-1!==e.indexOf(t)?e.split(t):e,Array.isArray(e)?e.forEach(e=>{-1===o.properties[l].indexOf(e)&&o.properties[l].push(e)}):o.properties[l].push(c.value)}else o.properties[l].push(c.value);switch(l){case"resourceid":r.resourceid=c.value,r.physicalid=c.value;break;case"type_icon_url":case"icon":r.icons||(r.icons=[]),r.icons.push(c.value);break;case"preview_url":case"thumbnail_2d":r.thumbnail=c.value;break;case"ds6w:type":r.type=c.value;break;case"ds6wg:PLMReference.V_isLastVersion":r.isLastVersion="boolean"==typeof c.value?c.value:"TRUE"===c.value.toUpperCase(),r["ds6wg:PLMReference.V_isLastVersion"]=c.value;break;case"bo.PLMReference.v_versionid":r.versionid=c.value;break;case"ds6w:policy":a||(a=[]),-1==a.indexOf(c.value)&&a.push(c.value);default:let e=c.value;if(s)if(s.authoringMode)if("string"==typeof e&&e.startsWith("[")&&e.endsWith("]"))e=JSON.parse(e);else{const t=n.DATABASE_MODE_MULTIVALUES_SEPARATOR;e=-1!==e.indexOf(t)?e.split(t):e}else if("ds6w:label"===l||"ds6w:label-Instance"===l||"ds6w:description"===l||"ds6wg:PLMReference.V_versionComment"===l)e=c.value;else{const t=n.INDEX_MODE_MULTIVALUES_SEPARATOR;e=-1!==e.indexOf(t)?e.split(t):e}if(r.hasOwnProperty(l)&&r[l]!==e){const t=r[l];Array.isArray(t)||(r[l]=[t]),Array.isArray(e)?r[l].push(...e):r[l].push(e)}else r[l]=e}},parseFetchResult:function(e,t){var n=e.results||[],i=[],r=this,o=null;return t&&(o={withNlsProp:t,classes:[],properties:{}}),n.forEach(function(e){0===e.attributes.length||e.sort&&"#DELETE#"===e.sort.sortType?i.push({deleted:!0}):i.push(r.attributesParser(e.attributes,o))}),{results:i,nlsTracker:o}},cleanExpandParsedData:function(e){if(e){if(e.root=void 0,e.nodes){for(var t in e.nodes)e.nodes.hasOwnProperty(t)&&(e.nodes[t]=void 0);e.nodes=void 0}if(e.iconsSet&&(e.iconsSet=void 0),Array.isArray(e.paths)){for(var n=0;n<e.paths.length;n++)e.paths[n]=void 0;e.paths=void 0}e=void 0}},parseAndBuildIRPCStructureForLoad:function(t,n,i){const r=this.getExpandResponseVersionFct(t);if(!e.is(r))throw new Error("Parse server response function not found.");var o,s={visibleMultivaluedAttrs:i.visibleMultivaluedAttrs,authoringMode:i.authoringMode},a=Reflect.apply(r,this,[t,n,s]),l=(a.paths,null);if(i&&i.pathLength){for(var c=Object.keys(a.nodes),d=0;d<c.length;d++)if(a.nodes.hasOwnProperty(c[d])&&a.nodes[c[d]].physicalid===i.physicalId){o=a.nodes[c[d]].did;break}for(var u=0;u<a.paths[0].length;u++)if(a.paths[0][u]==o){l=u;break}}if(!a||!a.nodes||!Array.isArray(a.paths))throw new Error("Ouups ! invalid input");a.iconsSet=a.iconsSet||[];var p=null==l?0:l;return Array.isArray(a.paths[0])&&a.paths[0].length>0&&(a.root=p>0&&o>=0?a.nodes[o]:a.nodes[a.paths[0][0]]),a.types&&(a.types=[...a.types]),a.relTypes&&(a.relTypes=[...a.relTypes]),a},parseAndBuildIRPCStructure:function(t,n,i){const r=this.getExpandResponseVersionFct(t);if(!e.is(r))throw new Error("Parse server response function not found.");var o,s={visibleMultivaluedAttrs:i.visibleMultivaluedAttrs,authoringMode:i.authoringMode},a=Reflect.apply(r,this,[t,n,s]),l=(a.paths,null);if(i&&i.pathLength){for(var c=Object.keys(a.nodes),d=0;d<c.length;d++)if(a.nodes.hasOwnProperty(c[d])&&a.nodes[c[d]].physicalid===i.physicalId){o=a.nodes[c[d]].did;break}for(var u=0;u<a.paths[0].length;u++)if(a.paths[0][u]==o){l=u;break}}if(!a||!a.nodes||!Array.isArray(a.paths))throw new Error("Ouups ! invalid input");a.iconsSet=a.iconsSet||[];for(u=0;u<a.iconsSet.length;u++){var p=a.iconsSet[u];for(d=0;d<p.did.length;d++){var g=p.did[d],h=a.nodes[g];h.icons&&Array.isArray(h.icons)||(h.icons=[]),h.icons.push(p.icon),h.thumbnail||(h.thumbnail=p.thumbnail_2d)}}var m=null==l?0:l;return a.paths.forEach(function(e){var t=e.length;if(1===Math.abs(t%2))for(var n=m;n<e.length;n++){var i=a.nodes[e[n]],r=n+1<t?a.nodes[e[n+1]]:null;if(0===Math.abs(n%2)){if(i.children||(i.children=[]),r){for(var o=!1,s=0;s<i.children.length;s++)if(i.children[s].did===r.did){o=!0;break}o||i.children.push(r)}}else r&&(i.instanceOf=r)}else console.error("incomplete path")}),Array.isArray(a.paths[0])&&a.paths[0].length>0&&(a.root=m>0&&o>=0?a.nodes[o]:a.nodes[a.paths[0][0]]),a.types&&(a.types=[...a.types]),a.relTypes&&(a.relTypes=[...a.relTypes]),a},parseExpandResult:function(t,n,i){if(!t||!Array.isArray(t.results))throw new Error("Ouups ! invalid input");var r={nodes:{},root:null,paths:[],nlsTracker:{withNlsProp:n,classes:[],properties:{}},iconsSet:[],policies:[],types:new Set,relTypes:new Set},o=this;return t.results.forEach(function(t){if(t.hasOwnProperty("attributes")){var n=o.attributesParser(t.attributes,r.nlsTracker,i,r.policies);if(e.is(n.did)&&(r.nodes[n.did]=n),n.type){(n.isRelation?r.relTypes:r.types).add(n.type)}}else t.hasOwnProperty("path")?r.paths.push(t.path):t.hasOwnProperty("icon__default_thumbnail_2d")&&(r.iconsSet=t.icon__default_thumbnail_2d)}),this.updateNodeWithIconsData(r),r},updateNodeWithIconsData:function(e){var t=e.iconsSet,n=e.nodes;Array.isArray(t)&&t.forEach(function(e){e.did.forEach(function(t){let i=n[t],r=e.icon;i.thumbnail=i.thumbnail?i.thumbnail:e.thumbnail_2d,i&&i.icons?i.icons.push(r):i.icons=[r]})})},getInstanceName:function(e){if(!Array.isArray(e.results))throw"wrong server response";var t=[];return e.results.forEach(function(e){for(var n=0;n<e.data.length;n++)if("PLM_ExternalID"===e.data[n].name){t.push({name:e.data[n].value[0],instanceId:e.physicalID});break}}),t},getExpandResponseVersionFct:function(t){if(!e.is(t))return console.error("Invalid server response"),null;let n=this.parseExpandResult;return Reflect.has(t,"infos")&&(n=this.parseProgressiveExpandResult),n},parseProgressiveExpandResult:function(e,t){if(!e||!Array.isArray(e.results))throw new Error("Ouups ! invalid input");const n={nodes:{},root:null,paths:[],nlsTracker:{withNlsProp:t,classes:[],properties:{}},iconsSet:[],policies:[],types:new Set,relTypes:new Set};return e.results.forEach(e=>{if(e.hasOwnProperty("resourceid")){const t=r();if(Reflect.ownKeys(e).forEach(i=>{const r=e[i];return this.convertAttributeAndAddToJsonNode({name:i,value:r},t,n.nlsTracker,{authoringMode:!1},n.policies)}),t.did=t.resourceid,n.nodes[t.did]=t,t.type){(t.isRelation?n.relTypes:n.types).add(t.type)}}else if(e.hasOwnProperty("Path")){const t=e.Path;n.paths.push(t)}else e.hasOwnProperty("icon__default_thumbnail_2d")?n.iconsSet=e.icon__default_thumbnail_2d:console.warn(`parseProgressiveExpandResult => unknown node : ${e}`)}),n}}}),define("DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/ExpandLevelUtils",["UWA/Class","DS/Utilities/Data","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n){"use strict";return e.singleton({init:function(e){this._parent(e)},initialize:function(e){this.options=e},_expandChildren:function(e,t,n){var i=function(e,t,n){if((-1===t||n<t)&&e.isChildComputed()&&(e.isExpanded()||e.setState({state:"expanded"}),e.hasChildren()))for(var r=e.getChildren(),o=0;o<r.length;o++){var s=r[o];s.isChildComputed()&&"noExpandState"!==s._expandState&&(s.getNodeDepth()<t||-1===t)&&s.setState({state:"expanded"}),i(s,t,n+1)}};i(e,t,n)},expandItemsByLevel:function(e){if(this.options.appCore.mediator.publish(n.EVENT_DISABLE_SORT_TO_DEFAULT,!0),this.isServiceHitRequired())this.options.context._app.mediator.publish(n.EVENT_EXPAND_BY_LEVEL,e);else{var t=this.options.context._app.core.contextManager.getXENTreeDocument();let n=this.options.context._app.core.contextManager.isActiveEngItemSelected()?t.core.xengTreeDoc.getRoots():t.getSelectedNodes(),i={operation:"expand",targetLevel:e,currentLevel:0};this.chunckAndExecuteOperation(n,i)}},collapseChildren:function(){let e=[];e=this.options.context._app.core.contextManager.isActiveEngItemSelected()?this.options.context._app.core.xengTreeDoc.getRoots():this.options.context._app.core.contextManager.getXENTreeDocument().getSelectedNodes(),this.chunckAndExecuteOperation(e,{operation:"collapse"})},chunckAndExecuteOperation:function(e,n){var i=this;let{targetLevel:r,currentLevel:o,operation:s}=n;i.options.context._app.core.contextManager.getXENTreeDocument().prepareUpdate(),t.forEach(e,function(e){"collapse"===s?e.collapseAll():"expand"===s&&i.options.context.withTransactionUpdate(()=>{i._expandChildren(e,parseInt(r),o)})},1,function(){i.options.context._app.core.contextManager.getXENTreeDocument().pushUpdate()})},isServiceHitRequired:function(){return!((this.options.context&&this.options.context.getActiveEngItemOpenContext()&&this.options.context.getActiveEngItemOpenContext().filteringContext?this.options.context.getActiveEngItemOpenContext().filteringContext:"")==n.CONST_ADV_FILTER||this.options.context._app.core.sessionManager.shouldShowMfgView())}})}),define("DS/ENOXEngineer/commands/MaterialFacet/BaseMatCmd",["UWA/Core","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json","DS/ApplicationFrame/Command","DS/ENOXEngineer/services/MaterialExceptions"],(e,t,n,i)=>{const{MaterialTypeError:r,MaterialSamePidError:o}=i;return class extends n{constructor(e){super(e),this._options=e}get context(){return this._options.context}get isAuthoringCmd(){return!1}get selectedItems(){const{_options:e}=this;return e?"function"!=typeof e.getSelectedItems?null:this._options.getSelectedItems():null}get securityContext(){const{context:e}=this;return e?"function"!=typeof e.getSecurityContext?null:e.getSecurityContext():null}get tenant(){const e=this.securityContext;return e?e.tenant:null}get selectedMaterials(){const{_options:e}=this;return e?"function"!=typeof e.getSelectedMaterials?null:this._options.getSelectedMaterials():null}buildDisplayedMessage(n,i=null){let s=null;e.is(i)&&(s=i instanceof r?`${t["error.Material.WrongType"]}`:i instanceof o?`${t["error.Material.SameId"]}`:this.computeErrorMsgFromException(i));const a={title:n};return e.is(s)&&(a.subtitle=s),a}computeErrorMsgFromException(e){const{message:n}=e||{};if(!n)return"";let i="";return i=-1!==n.search(/create(Core|Covering)Input failed/g)?`${t["error.Material.CreateInput"]}`:n}}}),define("DS/ENOXEngineer/commands/MaterialFacet/ShowPropertiesCmd",["UWA/Core","DS/ENOXEngineer/commands/MaterialFacet/BaseMatCmd","DS/ENOCollabSharingCmds/commands/EditPropCmd/EditPropCmdBase"],(e,t,n)=>{return class extends t{constructor(e){super(e)}execute(){const t=this.selectedMaterials;if(!e.is(t))throw console.error("error: MaterialFacet/ShowCommand missing matInfos parameter"),this.end(),new Error("error: MaterialFacet/ShowCommand missing matInfos parameter");const i=this.tenant;if(!e.is(i))throw console.error("error: MaterialFacet/ShowCommand missing tenant parameter"),this.end(),new Error("error: MaterialFacet/ShowCommand missing tenant parameter");const r={getSelectedNodes:()=>t.map(e=>{const{physicalid:t}=e;return{id:t,tenant:i,source:"3DSpace",getID:function(){return t}}})};(new n).launchProperties(r)}}}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/MaterialQuantityView",["UWA/Core","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/componentsHelpers/commandModal/XEngineerModal","DS/UIKIT/Input/Select","css!DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/css/MaterialQuantityView.css"],(e,t,n,i)=>{return class{constructor(e,i){this.appCore=e,this.mainDiv=null;const{title:r,className:o,withFooter:s,onOk:a,onCancel:l,dimToDisplayOptions:c}=i,d=Array.isArray(c)&&c.length?c:[t.DIMENSION_VOLUME,t.DIMENSION_MASS];this.dimensionValues=[],this.unitValues=new Map,d.forEach(e=>{this.dimensionValues.push({key:e,label:this.appCore.dicoService.getDimensionLabel(e),value:e}),this.unitValues.set(e,this.appCore.dicoService.getUnits(e))}),this._modal=new n({title:r,className:o,withFooter:s}),this._buildSkeleton(a,l,i),this._modal.show()}getDimensions(){return this.dimensionValues}getUnits(e){return this.unitValues.has(e)?this.unitValues.get(e).map(e=>({label:e.NLSName,value:e.Name,key:e.Name})):(console.warn(`unexpected dimension ${e}`),[])}_buildSkeleton(n,r,o){const{dimOptions:s,unitOptions:a,inputOptions:l}=o,c=(t,n,i)=>e.is(t)&&Reflect.has(t,n)?t[n]:i,d=c(s,"selected",e.is(widget.getValue(t.PREFERRED_DIMENSION))?widget.getValue(t.PREFERRED_DIMENSION):t.DIMENSION_VOLUME),u=c(a,"enable",!0),p=c(a,"selected","none"),g=(e,{selected:t="none",enable:n=!0})=>{const r="none"===t&&e.length?e[0].key:t,o=e.map(({key:e,label:t,value:n})=>({label:t,value:n,selected:e===r})),s=new i({custom:!1,className:"dim-combo-box",placeholder:!1,options:o});return n||s.disable(),s};this.mainDiv=document.createElement("div"),this.mainDiv.className="input-add-group";let h=null;const m=c(s,"enable",!0),f=g(this.dimensionValues,{selected:d,enable:m});f.addEvent("onChange",()=>{const t=f.getValue()[0],n=this.getUnits(t),i=e.extendElement(this.mainDiv).getElement(".input-group-units");e.is(i)&&i.empty(),(h=g(n,{enable:u})).inject(i)});const E=document.createElement("div");E.className="input-dimension",f.inject(E),this.mainDiv.appendChild(E);const C=document.createElement("div");C.className="inputs";const _=document.createElement("input");_.className="form-control",_.type="number",_.step=.1,_.placeholder=this.appCore.i18nManager.get("eng.ui.dialog.selectMaterialQuantity.placeholder");const y=c(l,"value",null);"number"==typeof+y&&(_.value=y),_.min=0,_.maxLength=20,_.oninput=function(e){const t=e.data,n=parseFloat(this.value);void 0!==n&&!isNaN(n)||"."===t||(this.value=""),n<0&&(this.value="0"),this.value.length>this.maxLength&&(this.value=this.value.slice(0,this.maxLength))},C.appendChild(_),this.mainDiv.appendChild(C);const N=e.createElement("div",{class:"input-group-units"}),M=this.getUnits(d);(h=g(M,{selected:p,enable:u})).inject(N),this.mainDiv.appendChild(N),this._modal.getBody().appendChild(this.mainDiv),this._modal.onValidate(e=>{this._modal.onClose(()=>{});const t={value:_.value,dimension:f.getValue()[0],unit:h.getValue()[0]},i=this.onValidate(t);"function"==typeof n?n(i,e):e()},this),this._modal.onClose(()=>{this._modal.destroy(),this._modal=null,"function"==typeof r&&r()},this)}onValidate(e){return e}}}),define("DS/ENOXEngineer/componentsHelpers/ModelChooser/XEngModelChooser",["DS/CollectionView/ResponsiveLargeTilesCollectionView","DS/ENOXEngineer/componentsHelpers/commandModal/XEngineerModal","DS/TreeModel/TreeDocument","DS/ENOXEngineerCommonUtils/XENMask","css!DS/ENOXEngineer/componentsHelpers/ModelChooser/XEngModelChooser.css"],function(e,t,n,i){"use strict";function r(t){var r=this;this.appCore=t.appCore,this.resolve=t.resolve,this.reject=t.reject,this.preferredId=t.preferred,this.modelsPromises=t.modelsPromises,this.grid=new e({useDragAndDrop:!1}),this.grid.selectionBehavior={unselectAllOnEmptyArea:!1,toggle:!0,canMultiSelect:!1,enableShiftSelection:!1,enableFeedbackForActiveCell:!0},this.modelsDocument=new n;var o=0;r.modelsPromises.forEach(function(e){e.then(function(e){o++,(e.length>0||o==r.modelsPromises.length)&&i.isMasked(r.modal.modal.elements.body)&&i.unmask(r.modal.modal.elements.body),r.modelsDocument.addRoot(e),1===r.modelsDocument._numberOfNodesInDocument&&e[0]&&e[0].select(),e.forEach(function(e){r.preferredId&&e.options.physicalid===r.preferredId&&e.select()})})}),this.grid.model=this.modelsDocument,this.buildView()}return r.prototype._buildModal=function(){return this.modal=new t({title:this.appCore.i18nManager.get("eng.ui.dialog.chooseModel"),className:"xeng-model-chooser",withFooter:!0}),this.modal},r.prototype.destroyView=function(){this.modelsDocument=void 0,this.grid&&this.grid.destroy(),this.modal&&this.modal.destroy(),this.modal=void 0},r.prototype._getModalContent=function(){return this.grid.getContent()},r.prototype.buildView=function(){var e=this;this._getModalContent().inject(this._buildModal().getBody()),this.modal.onValidate(function(t){e.resolve&&e.resolve(e.modelsDocument.getSelectedNodes()[0]),t()},this),this.modal.onClose(function(){e.destroyView(),e.reject&&e.reject()},this),this.infoBox=UWA.createElement("div",{html:"text",class:"cancel_info"}),this.infoBox.setText(this.appCore.i18nManager.get("OnCancel_ModelChooser")),this.infoBox.inject(e.modal.modal.elements.body),this.modal.show(),i.mask(e.modal.modal.elements.body)},r}),define("DS/ENOXEngineer/sessionBuilders/ConfigSessionBuilder",["DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/componentsHelpers/ModelChooser/XEngModelChooser","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n){"use strict";function i(e){if(!e||!e.appCore||!e.models)throw console.error("missing options for SessionBuildersManager"),new Error("");this.appCore=e.appCore,this.models=e.models,this.engItem=this.models.getEngineeringItem()}return i.prototype.retrieveOpenInfos=function(){if(!this.engItem.isConfigured())return{rootId:this.engItem.getID(),filteringContext:"none"};var e=this.engItem.getPreferedAttachedConfigModel();return e?e.getPreferredConfiguration()?{rootId:this.engItem.getID(),filteringContext:"prodConf",filterData:{filterId:e.getPreferredConfiguration().id,label:e.getPreferredConfiguration().marketingName,filterBinary:e.getPreferredConfiguration().FilterCompiledForm}}:{rootId:this.engItem.getID(),filteringContext:"evolution",filterData:{filterId:e.getCurrentVersionID(),label:e.getCurrentVersionDisplayName(),filterBinary:null}}:void 0},i.prototype.registerContentfetcher=function(e,t){var i=this;const r=(t,r)=>{if(r&&r[n.CONST_FIND_IN_CRITERIA])return i.models.registerContentFetcher(i.models.addFindEngItemChildren(t,r),"content.addFindChildren",i.engItem,r);{let o=r&&r[n.CONST_TARGET_LEVEL],s=1!=e.length||o?e:e[0],a=i.models.registerContentFetcher(i.models.addChildren(t,r?r[n.CONST_TARGET_LEVEL]:void 0),"content.addChildren",i.engItem,r);return i.appCore.PreferencesManager.isSpecInProductStructureEnabled()&&1===e.length&&((this.appCore.sessionManager.isUsingDB()||this.appCore.sessionManager.shouldShowFinalItems()||this.appCore.sessionManager.shouldShowLeafMaterials())&&a.registerContentFetcher(i.models.addChildDocuments(s),"content.specificationDocument",s),a.registerContentFetcher(i.models.addChildDocuments(s,"PLMDocConnection"),"content.cnxDocument",s)),a}},o=e=>{let t=i.models.registerContentFetcher(i.models.addEngItemChildren(e),"content.addChildren",i.engItem,e);return i.appCore.PreferencesManager.isSpecInProductStructureEnabled()&&!i.appCore.contextManager.isPreExpandEvent()&&((this.appCore.sessionManager.isUsingDB()||this.appCore.sessionManager.shouldShowFinalItems()||this.appCore.sessionManager.shouldShowLeafMaterials())&&t.registerContentFetcher(i.models.addEngItemDocuments(),"content.specificationDocument",i.engItem),t.registerContentFetcher(i.models.addEngItemDocuments("PLMDocConnection"),"content.cnxDocument",i.engItem)),t};if(i.appCore.sessionManager.shareConfigSpecWithBIFilter(),i.appCore.sessionManager){var s;if(i.appCore.sessionManager.saveCurrentOpenContext(i.retrieveOpenInfos()),e){s=r(Array.isArray(e)?e:[e],t)}else s=o(t);s.fetchHolisticContentDefiniton()}delete i.appCore,delete i.models,delete i.engItem},i.prototype.retrieveAdditionalColumnProviders=function(){return e.wrappedWithPromise(function(e,t){return e(!0)})},i.prototype.buildSession=function(t){var i=this;return e.wrappedWithPromise(function(e,r){i.engItem.hasModelVersion().then(function(r){i.engItem.getPreferedAttachedConfigModel()&&r&&i.appCore.settingManager.isConfigAuthorized()&&i.appCore.mediator.publish(n.EVENT_LAUNCH_COMMAND,{commandId:n.SET_WORKUNDER_EVOLUTION_CMD,context:{item:i.engItem}}),i.engItem.updateUserConfigPreferences(),i.registerContentfetcher(void 0,t),e(!0)})})},i.prototype.getPathsArray=function(e){let t=[];return e.forEach((e,n)=>{t.push(e.getExpandPath())}),t},i}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityViewBuilder",["DS/TreeModel/TreeNodeModel","DS/Controls/ModalContainer","DS/Controls/Loader","DS/ENOXEngineer/services/I18nManager"],(e,t,n,i)=>{return class{constructor(){this.isValid=!1,this.isLoading=!1,this.viewContext=null}init(e){this.viewContext=e,this.isValid=!0,this.isLoading=!1}release(){this.emptyView(),this.isLoading&&this.deactivateLoadingInfo(),this.isValid=!1}async buildView(e=null){this.activateLoadingInfo();let t=null;try{t=await this.buildNodes(e)}catch(e){throw new Error("failed building treeNode view")}finally{this.deactivateLoadingInfo()}Array.isArray(t)&&t.length&&this.addNodesToView(t)}updateView(){}emptyView(){if(!this.isValid)return;const{gridModel:e}=this.viewContext;e&&e.getRoots()&&(e.prepareUpdate(),e.removeRoots(),e.empty(),e.pushUpdate())}async buildNodes(e){throw new Error("not implemented")}addNodesToView(e){if(!this.isValid||!Array.isArray(e))return;const{gridModel:t}=this.viewContext;if(!t)throw new Error("unexpected state");t.prepareUpdate(),e.forEach(e=>t.addRoot(e)),t.pushUpdate()}activateLoadingInfo(){if(this.isLoading)return;const{gridModel:r,gridView:o}=this.viewContext;if(!r||!o)throw new Error("unexpected state");r.prepareUpdate();const s=new e;r.addRoot(s),r.pushUpdate();const a=i.get("loading"),l=new n({text:a});l.on(a),t.createModal(o.getContent(),l.elements.container),this.isLoading=!0}deactivateLoadingInfo(){if(!this.isLoading||!this.isValid)return;const{gridModel:e,gridView:n}=this.viewContext;if(!e||!n)throw new Error("unexpected state");this.emptyView(),t.removeModal(n.getContent()),this.isLoading=!1}}}),define("DS/ENOXEngineer/utils/PreferredUnitColumnProviderInputFactory",["DS/ENOXEngineer/utils/XEngineerConstants"],e=>{const t=function({pid:e,sixw:t,value:n,dimension:i,toUnit:r}){return{pid:e,sixw:t,value:n,dimension:i,toUnit:r}};return class{static createAMassInput({physicalid:n,ds6w:i,value:r}){return t({pid:n,sixw:i,value:r,dimension:e.DIMENSION_MASS,toUnit:widget.getValue(e.PREFERRED_MASS_UNIT)})}static createAVolumeInput({physicalid:n,ds6w:i,value:r}){return t({pid:n,sixw:i,value:r,dimension:e.DIMENSION_VOLUME,toUnit:widget.getValue(e.PREFERRED_VOLUME_UNIT)})}static createALengthInput({physicalid:n,ds6w:i,value:r}){return t({pid:n,sixw:i,value:r,dimension:e.DIMENSION_LENGTH,toUnit:widget.getValue(e.PREFERRED_LENGTH_UNIT)})}static createAnAreaInput({physicalid:n,ds6w:i,value:r}){return t({pid:n,sixw:i,value:r,dimension:e.DIMENSION_AREA,toUnit:widget.getValue(e.PREFERRED_AREA_UNIT)})}}}),define("DS/ENOXEngineer/utils/QuantityHelper/EngItemModelQuantityHelper",["DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/QuantityHelper/QuantityHelperUtils"],(e,t)=>{const{isAValidValue:n}=t,i=e=>`${e}_converted`;return class{constructor(e){this.model=e}get options(){return this.model.options}getID(){return this.model.getID()}getConvertedOrMKSValueForRel(e){const t=this.getConvertedValueForRel(e);if(n(t))return t;const i=this.getMKSValueForRel(e);return n(i)?i:""}getConvertedValueForRel(e){const t=i(e);return this.getValueForRel(t)}getFirstValueFromRels(e){if(!Array.isArray(e))throw new Error("wrong input");const t=e.find(e=>{const t=this.getConvertedOrMKSValueForRel(e);return n(t)});return t?{rel:t,value:this.getConvertedOrMKSValueForRel(t)}:{rel:"",value:""}}getFirstMKSValueFromRels(e){if(!Array.isArray(e))throw new Error("wrong input");const t=e.find(e=>{const t=this.getMKSValueForRel(e);return n(t)});return t?{rel:t,value:this.getMKSValueForRel(t)}:{rel:"",value:""}}getMKSValueForRel(e){return this.getValueForRel(e)}getValueForRel(e){return this.options.grid[e]}}}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/RawMaterialQuantityView",["UWA/Core","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/MaterialQuantityView","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/componentsHelpers/commandModal/XEngineerModal","DS/UIKIT/Input/Select","DS/UIKIT/Input/Toggle","css!DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/css/MaterialQuantityView.css"],(e,t,n,i,r,o)=>{return class extends t{_buildSkeleton(t,n,i){super._buildSkeleton(t,n,i);const{asRequired:r}=i,s=e.extendElement(this.mainDiv).getElement(".inputs"),a=e.extendElement(this.mainDiv).getElement(".input-group-units");this.input=e.extendElement(s).getElement(".form-control"),this.unitSelect=e.extendElement(a).getElement(".form-control"),this.asReqToggle=new o({type:"switch",className:"as-required-toggle",label:this.appCore.i18nManager.get("eng.ui.dialog.selectMaterialQuantity.asRequired"),checked:"boolean"==typeof r&&r,events:{onChange:this.onChange.bind(this)}}),this.asReqToggle.inject(s),this.onChange()}getUnits(e){return this.unitValues.has(e)?this.unitValues.get(e).filter(e=>"string"==typeof e.label&&0!==e.label.trim().length).map(e=>({label:e.NLSName,value:e.Name,key:e.Name})):(console.warn(`unexpected dimension ${e}`),[])}onChange(){this.input.disabled=this.asReqToggle.isChecked(),this.unitSelect.disabled=this.asReqToggle.isChecked()}onValidate(e){const{dimension:t,value:n,unit:i}=e||{};return{value:n,dimension:t,unit:n?i:"",asRequired:this.asReqToggle.isChecked()}}}}),define("DS/ENOXEngineer/utils/QuantityHelper/EngItemModelRawQuantityHelper",["DS/ENOXEngineer/utils/QuantityHelper/EngItemModelQuantityHelper","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/QuantityHelper/QuantityHelperUtils","DS/ENOXEngineer/utils/PreferredUnitColumnProviderInputFactory"],(e,t,n,i)=>{const{isAValidValue:r,hasQuantity:o}=n,s=[t.CONT_RAWMAT_QUANTITY_VOLUME,t.CONT_RAWMAT_QUANTITY_VOLUME_INST],a=[t.CONT_RAWMAT_QUANTITY_MASS,t.CONT_RAWMAT_QUANTITY_MASS_INST],l=[t.CONT_RAWMAT_QUANTITY_AREA,t.CONT_RAWMAT_QUANTITY_AREA_INST],c=[t.CONT_RAWMAT_QUANTITY_LENGTH,t.CONT_RAWMAT_QUANTITY_LENGTH_INST],d=[t.CONT_RAWMAT_QUANTITY_ASREQ,t.CONT_RAWMAT_QUANTITY_ASREQ_INST],u=[t.CONT_RAWMAT_QUANTITY_MASS_INST,t.CONT_RAWMAT_QUANTITY_VOLUME_INST,t.CONT_RAWMAT_QUANTITY_AREA_INST,t.CONT_RAWMAT_QUANTITY_LENGTH_INST,t.CONT_RAWMAT_QUANTITY_ASREQ_INST];return class extends e{isDirectRawMatConsumption(){return-1!==u.findIndex(e=>{const t=this.getConvertedOrMKSValueForRel(e);return!!r(t)||"boolean"==typeof t&&t})}hasConvertedValue(){return!![...a,...s,...l,...c].find(e=>{const t=this.getConvertedValueForRel(e);return r(t)})}getRawMatMassQuantity(){const{value:e}=this.getFirstValueFromRels(a);return e}getRawMatVolumeQuantity(){const{value:e}=this.getFirstValueFromRels(s);return e}getRawMatAreaQuantity(){const{value:e}=this.getFirstValueFromRels(l);return e}getRawMatLengthQuantity(){const{value:e}=this.getFirstValueFromRels(c);return e}hasRawMatVolumeQuantity(){const e=this.getRawMatVolumeQuantity();return o(e)}hasRawMatAreaQuantity(){const e=this.getRawMatAreaQuantity();return o(e)}hasRawMatMassQuantity(){const e=this.getRawMatMassQuantity();return o(e)}hasRawMatLengthQuantity(){const e=this.getRawMatLengthQuantity();return o(e)}hasRawMatAsRequired(){return-1!==d.findIndex(e=>{let t=!1;const n=this.getValueForRel(e);return"boolean"==typeof n?t=n:"string"==typeof n&&(t="TRUE"===n.toUpperCase()),t})}getMKSAttributesToConvert(){const e=[];if(this.hasRawMatVolumeQuantity()){const{rel:t,value:n}=this.getMKSRawMatVolumeAttribute();if(r(n)){const r=this.getID(),o=i.createAVolumeInput({physicalid:r,ds6w:t,value:n});e.push(o)}}if(this.hasRawMatMassQuantity()){const{rel:t,value:n}=this.getMKSRawMatMassAttribute();if(r(n)){const r=this.getID(),o=i.createAMassInput({physicalid:r,ds6w:t,value:n});e.push(o)}}if(this.hasRawMatAreaQuantity()){const{rel:t,value:n}=this.getMKSRawMatAreaAttribute();if(r(n)){const r=this.getID(),o=i.createAnAreaInput({physicalid:r,ds6w:t,value:n});e.push(o)}}if(this.hasRawMatLengthQuantity()){const{rel:t,value:n}=this.getMKSRawMatLengthAttribute();if(r(n)){const r=this.getID(),o=i.createALengthInput({physicalid:r,ds6w:t,value:n});e.push(o)}}return e}getMKSRawMatMassAttribute(){return this.getFirstMKSValueFromRels(a)}getMKSRawMatVolumeAttribute(){return this.getFirstMKSValueFromRels(s)}getMKSRawMatAreaAttribute(){return this.getFirstMKSValueFromRels(l)}getMKSRawMatLengthAttribute(){return this.getFirstMKSValueFromRels(c)}}}),define("DS/ENOXEngineer/componentsHelpers/GridViewConfigurator/GridViewConfigurator",["DS/ENOXEngineer/services/I18nManager"],function(e){"use strict";return{myEngItemsConfigurator:function(){return{getComponentData:function(e){return e.getCurrentUserRootEng()},getTitle:function(){return e.get("my_eng_items")},getViewName:function(){return"my_eng_items"},getPreferredView:function(e){return e.getItem("my_eng_items_view")}}},recentsEngItemsConfigurator:function(){return{getComponentData:function(e){return e.getCurrentUserRecentsItems()},getTitle:function(){return e.get("recent_items")},getViewName:function(){return"recent_items"},getPreferredView:function(e){return e.getItem("recent_items_view")}}}}}),define("DS/ENOXEngineer/utils/QuantityHelper/EngItemModelMassOrVolumeQuantityHelper",["DS/ENOXEngineer/utils/QuantityHelper/EngItemModelQuantityHelper","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/QuantityHelper/QuantityHelperUtils","DS/ENOXEngineer/utils/PreferredUnitColumnProviderInputFactory"],(e,t,n,i)=>{const{isAValidValue:r,hasQuantity:o}=n,s=[t.CONT_QUANTITY_VOLUME,t.DECLARED_VOLUME];return class extends e{getMassQuantity(){const e=this.getConvertedOrMKSValueForRel(t.CONT_QUANTITY_MASS);return r(e)?e:""}getMKSMassQuantity(){const e=this.getMKSValueForRel(t.CONT_QUANTITY_MASS);return r(e)?e:""}getVolumeQuantity(){const{value:e}=this.getFirstValueFromRels(s);return e}getMKSVolumeQuantity(){const{value:e}=this.getFirstMKSValueFromRels(s);return e}hasMassQuantity(){const e=this.getMassQuantity();return o(e)}hasVolumeQuantity(){const e=this.getVolumeQuantity();return o(e)}hasQuantity(){let e=!1;return this.hasMassQuantity()?e=this.hasMassQuantity():this.hasVolumeQuantity()&&(e=this.hasVolumeQuantity()),e}getMKSAttributesToConvert(){const e=[];if(this.hasMassQuantity()){const n=this.getMKSMassQuantity();if(r(n)){const r=this.getID(),o=i.createAMassInput({physicalid:r,ds6w:t.CONT_QUANTITY_MASS,value:n});e.push(o)}}if(this.hasVolumeQuantity()){const n=this.getMKSVolumeQuantity();if(r(n)){const r=this.getID(),o=i.createAVolumeInput({physicalid:r,ds6w:t.CONT_QUANTITY_VOLUME,value:n});e.push(o)}}return e}}}),define("DS/ENOXEngineer/services/SessionPredicates/ReadAttributeInfoFacade",["DS/ENOXEngineer/services/SessionPredicates/SessionPredicatesErrors"],e=>{const{WrongInput:t,ReadAttributeInfoFacadeError:n}=e,i=e=>{const{extensions:t}=e;return t?Reflect.ownKeys(t).map(e=>t[e]):[]},r=e=>!e.deploymentExtension,o=e=>"classif"!==e.icon,s=e=>{return[...Array.isArray(e.data)?e.data:[],...Array.isArray(e.basicData)?e.basicData:[]]};return class{constructor(e){this.objectsAttributesInfos=e}findPathsAsObjectProperties(e,i){if(!e||!Array.isArray(i))throw new t("ReadAttributeInfoFacade.getTypesAndExtensionsFor");const r=this.getObjectInfo(e);if(!r)throw new n(`no objectInfo for physicalid ${e}`);const o=s(r),a=[];return i.forEach(e=>{const t=o.filter(({path:t,selectable:n})=>t===e||n===e);a.push(...t)}),a}getTypesAndExtensionsFor(e){if(!e)throw new t("ReadAttributeInfoFacade.getTypesAndExtensionsFor");const s=this.getObjectInfo(e);if(!s)throw new n(`no objectInfo for physicalid ${e}`);const{type:a}=s;return{types:a?[a]:[],extensions:i(s).filter(r).filter(o).map(e=>e.name)}}getObjectInfo(e){return this.results.find(t=>t.physicalID===e)}get results(){return Array.isArray(this.objectsAttributesInfos.results)?this.objectsAttributesInfos.results:[]}}}),define("DS/ENOXEngineer/services/SessionPredicates/ObjectAttributeFactory",["DS/ENOXEngineer/services/SessionPredicates/Utils","DS/ENOXEngineer/utils/XEngineerConstants"],(e,t)=>{return{buildAnObjectAttributeFromInput:function(n){const{attributeToEdit:i}=n;let r=null;const o=function(e){return{input:e,get nodeToEdit(){return this.input.nodeToEdit},get attributeToEdit(){return this.input.attributeToEdit},get newValue(){return this.input.newValue}}}(n);return r=e.isAnInstanceAttribute(i)?function(e){const n=e.nodeToEdit.getRelationID(),i={...e.attributeToEdit,ds6wFrom:"rel"};return i.dbName&&!i.dbName.includes(".")&&(i.path=`PLMInstance.${i.dbName}`),{physicalid:n,attribute:i,isPredicateToPathManaged(){let e=null;switch(this.predicateToEdit){case"ds6w:label":e=t.INSTANCE_PATH;break;case"ds6w:description":e=t.DESCRIPTION_PATH_OF_INSTANCE}return e}}}(o):o.nodeToEdit.isDocument()?function(e){return{physicalid:e.nodeToEdit.getID(),attribute:{...e.attributeToEdit},isPredicateToPathManaged(){let e=null;switch(this.predicateToEdit){case"ds6w:label":e=t.TITLE_PATH_OF_DOCUMENT;break;case"ds6w:description":e=t.DESCRIPTION_PATH_OF_DOCUMENT}return e}}}(o):function(e){return{physicalid:e.nodeToEdit.getID(),attribute:{...e.attributeToEdit},isPredicateToPathManaged(){let e=null;switch(this.predicateToEdit){case"ds6w:label":e=t.TITLE_PATH_OF_REFERENCE;break;case"ds6w:description":e=t.DESCRIPTION_PATH_OF_REFERENCE}return e}}}(o),{input:n,...r,get predicateToEdit(){return this.attribute.ds6w||this.attribute.dataIndex},get newValue(){return this.input.newValue}}}}}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityNoneViewBuilder",["DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityViewBuilder"],e=>{return class extends e{buildNodes(){const{model:e}=this.viewContext;if(!e)throw new Error("unexpected state");const{nodes:t}=e;if(!Array.isArray(t))throw new Error("unexpected nodes");return t}updateView(e){const{gridModel:t}=this.viewContext;if(!t)throw new Error("unexpected state");if(!e)throw new Error("wrong input");const{create:n,modify:i,detach:r}=e;(Array.isArray(n)&&n.length||Array.isArray(i)&&i.length||Array.isArray(r)&&r.length)&&(t.prepareUpdate(),Array.isArray(n)&&n.length&&n.forEach(e=>t.addRoot(e)),Array.isArray(i)&&i.length&&i.forEach(e=>e.updateOptions(e.options)),Array.isArray(r)&&r.length&&r.forEach(e=>t.removeRoot(e)),t.pushUpdate())}}}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityViewBuilderComponent",["DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityComponent","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityNoneViewBuilder","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityViewBuilder","DS/ENOXEngineer/services/I18nManager"],(e,t,n,i)=>{const r={None:"None"},o=i.get("None");return new class extends e{init(e){if(!e)throw new Error("invalid input");this.viewContext=e;const{model:n}=e;this.viewModeBuilders=new Map([[r.None,{instance:new t(n),nls:o}]]),this.activeMode=null}activate(){this.activeMode||this.restoreDefaultBuilder(),super.activate()}update(e){const t=this.getActiveBuilder();t&&t.updateView(e)}get defaultModeEntry(){return{value:r.None,label:o}}registerBuilder(e,t,i){if(!(e&&i instanceof n))throw new Error("invalid input");this.viewModeBuilders.has(e)||this.viewModeBuilders.set(e,{instance:i,nls:t})}unregisterBuilder(e){e===this.activeMode&&this.restoreDefaultBuilder(),this.viewModeBuilders.has(e)&&this.viewModeBuilders.delete(e)}applyBuilder(e,t=null){let n=null;if(!(n=e!==this.activeMode?this.activateBuilder(e):this.getActiveBuilder()))throw new Error(`unregistered builder => ${e}`);n.buildView(t)}restoreDefaultBuilder(){this.applyBuilder(r.None)}activateBuilder(e){const t=this.getBuilder(e);if(t){t.init(this.viewContext);const n=this.getActiveBuilder();n&&n.release(),this.activeMode=e}return t}getActiveBuilder(){return this.activeMode?this.getBuilder(this.activeMode):null}getBuilder(e){if(!this.viewModeBuilders.has(e))return null;const{instance:t}=this.viewModeBuilders.get(e);return t}}}),define("DS/ENOXEngineer/commands/DocumentManagementCmdV2",["UWA/Class","DS/ApplicationFrame/Command","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/CoreEvents/ModelEvents","DS/ENOX3DSpaceAttributesMgt/services/loadModuleUtils","DS/Utilities/Utils","DS/ENOXEngineerCommonUtils/PromiseUtils"],function(e,t,n,i,r,o,s,a){"use strict";return t.extend({init:function(e){this._parent(e)},execute:function(){},buildRequiredInfoForCommands:function(e){var t=this;let n=e.core.settingManager.getPlatformId();var o=new r;return o.subscribe({event:"docv2-show-notification"},function(e){switch(e.level){case"success":i.sucessAlert(e.subtitle);break;case"error":i.errorAlert(e.subtitle);break;case"info":i.notifyAlert(e.subtitle);break;case"warning":i.warningAlert(e.subtitle)}}),o.subscribe({event:"docv2-edit-complete"},function(n){t.updateDocInfo(e,n)}),o.subscribe({event:"docv2-update-complete"},function(n){t.updateDocInfo(e,n)}),o.subscribe({event:"docv2-undoedit-complete"},function(n){t.updateDocInfo(e,n)}),{fetchSecurityContext:function(){return e.core.contextManager.getSecurityContext().SecurityContext},getSelectedNodes:function(){return e.core.contextManager.getXENTreeDocument().getSelectedNodes()},getDocumentFromNodeModel:function(e){return e._options.e6wdocument},platformUrls:e.core.contextManager._app.core.settingManager._platforms[n],events:o}},updateDocInfo:function(e,t){const n=e.core.contextManager.getXENTreeDocument().getSelectedNodes().filter(e=>e.isDocument());e.core.dataService.updateDocumentNodesData(n)},getDocumentV2Commands:function(e){return this.contextMenuItemsPromise=a.wrappedWithPromise((t,n)=>{let i=this.buildRequiredInfoForCommands(e);o.loadRuntimeLibraries(["DS/DocumentCommands/DocumentCommandsV2","DS/DocumentCommands/Constants"]).then(([e,n])=>{var r=new e(i),o=r.commands,s={entries:[o[n.PREVIEW],o[n.OFFICE_WEB_EDITION],o[n.EDIT],o[n.LOCK_AND_DOWNLOAD],o[n.UNDO_EDIT],o[n.UNLOCK],o[n.UPDATE],o[n.UPDATE_AND_UNLOCK],o[n.COPY_LINK],o[n.DOWNLOAD]]};r.getWebUXContextMenuItemsForCurrentSelection(s.entries,!0).then(function(e){t(e)}).catch(function(e){console.warn(e),t()})}).catch(t)}),this.contextMenuItemsPromise}})}),define("DS/ENOXEngineer/controllers/LandingPageController",["DS/ENOXEngineerCommonUtils/XENMask","DS/ENOXEngineer/componentsHelpers/GridViewConfigurator/GridViewConfigurator","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n){"use strict";return function(i){this.myEngCmp=null;var r=this;if(r.isFirstRendering=!0,!i)throw new Error("options are mandatory");if(!i.app||!i.parentController)throw new Error("app and parentController are mandatory");var o=i.parentController,s=i.app;return{activate:function(){s.mediator.publish(n.EVENT_TRIPTYCH_SHOW_PANEL,"left"),s.mediator.publish(n.EVENT_SELECT_ACTION_WP,{id:"my_eng_items"}),r.isFirstRendering?(r.isFirstRendering=!1,e.mask(UWA.extendElement(o.triptychCmp.mainDiv)),r.myEngCmp=s.componentsMgt.startNewInstance(n.MY_ENG_ITEM_CMP,o.triptychCmp.mainDiv,t.myEngItemsConfigurator())):(r.myEngCmp.reRender(),s.mediator.publish(n.EVENT_REFRESH_LANDING_DATA))},deactivate:function(){r.myEngCmp.stop()}}}}),define("DS/ENOXEngineer/controllers/ItemViewController",["DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/PlatformAPI/PlatformAPI","DS/ENOXEngineerCommonUtils/PromiseUtils"],function(e,t,n,i){"use strict";return function(r){this.idCardCmp=null,this.listViewCmp=null,this.itemViewCmp=null;var o=this;if(!r)throw new Error("options are mandatory");if(!r.app||!r.parentController)throw new Error("app and parentController are mandatory");var s=r.parentController,a=r.app;return{activate:function(r){a.core.sessionManager.cleanStaticMappingContext(),a.core.dataService.loadConfigurationSettings().finally(function(){r.params.pcInfo&&r.params.path&&a.core.sessionManager.setStaticMappingAsOpenContext(r.params.pid,{pcInfo:r.params.pcInfo,path:r.params.path}),o.engItemLoadingPromise=a.core.dataService.getEngItemData(r.params.pid,!0),a.mediator.publish(e.EVENT_TRIPTYCH_HIDE_PANEL,"right"),a.mediator.publish(e.EVENT_TRIPTYCH_HIDE_PANEL,"left"),o.landingPageListnerToken=a.mediator.subscribe(e.EVENT_IDCARD_CUSTOM_SHOW_LANDING,function(){a.mediator.publish(e.EVENT_FIND_IN_CONTEXT_CLOSE_DIALOG),a.router.navigate("recents_items",{replace:!1,reload:!0})}),o.setActiveEngItemListerToken=a.mediator.subscribe(e.EVENT_SET_ACTIVE_ENG_ITEM,function(e){a.core.contextManager.setActiveEngItem(e)}),o._NGFilterCmdStartToken=n.subscribe("Frame3DXInfra.Open",t=>{a.core.PersistencyManager.setNGFilterCmdLaunchState(!0),o._NGFilterCmdStopToken=n.subscribe("Frame3DXInfra.onPanelClose",t=>{(t?t.tag:null)==e.NG_FILTER_PANEL_TAG&&(a.core.PersistencyManager.setNGFilterCmdLaunchState(!1),o._NGFilterCmdStopToken&&n.unsubscribe(o._NGFilterCmdStopToken)),a.mediator.publish(e.SWITCH_MODE,{switchMode:a.core.sessionManager.determineAuthoringMode()})}),a.mediator.publish(e.SWITCH_MODE,{switchMode:"index"})}),a.componentsMgt.startInstances([{name:e.ITEM_VIEW_CMP,container:s.triptychCmp.mainDiv,contextData:{}}]).then(function(n){o.itemViewCmp=n[0],o.engItemLoadingPromise.then(function(n){if(!Array.isArray(n)||0===n.length)throw new Error(a.core.i18nManager.get("error.fetch.deleted.item"));var s=n[0];s.isValidEngItem().then(function(){a.mediator.publish(e.EVENT_SET_ACTIVE_ENG_ITEM,s),r.params.pcInfo&&r.params.path&&s.setStaticMapping({pcInfo:r.params.pcInfo,path:r.params.path}),r.params.filter&&a.core.PersistencyManager.setNGFilter(r.params.filter),a.core.contextManager.getXENTreeDocument().addRoot(s),s.select(),o.activeTreeDocument=a.core.Factories.CollectionsFactory.getEngItemContentModels(s),o.activeTreeDocument.buildUserWorkingSession().then(function(){i.allSettled(o.activeTreeDocument._contentFetchers).then(function(t){!function(t){var n=UWA.extendElement(o.itemViewCmp.container.querySelector(".top-container")),i=UWA.extendElement(o.itemViewCmp.container.querySelector(".listContainer"));a.componentsMgt.startInstances([{name:e.IDCARD_CMP,container:n,contextData:{physicalId:t.params.pid,models:o.activeTreeDocument}},{name:e.LIST_VIEW_NEW_CMP,container:i,contextData:{physicalId:t.params.pid,models:o.activeTreeDocument}}]).then(function(t){o.idCardCmp=t[0],o.listViewCmp=t[1],a.core.PersistencyManager.restoreInformationPanelForIdCard(o.activeTreeDocument),a.core.PersistencyManager.restoreNGFilterCmdLaunchSate(),o.infoPanelToken=a.mediator.subscribe(e.EVENT_INFO_PANEL_VISIBLE,function(){var t=o.activeTreeDocument.getSelectedNodes();Array.isArray(t)&&0===t.length&&a.mediator.publish(e.EVENT_SHOW_PROPERTIES,{nodes:[{id:o.activeTreeDocument.getEngineeringItem().getID(),metatype:"businessobject"}]})})})}(r)})}).catch(function(n){a.core.logger.error(n),t.unexpectedFailure(a.core.i18nManager.replace(a.core.i18nManager.get("failure.open.object"),{object:s.getTitle()})),a.mediator.publish(e.EVENT_GO_BACK)})}).catch(function(n){t.errorAlert(a.core.i18nManager.get("trying.toopen.not.engineering.item")),a.mediator.publish(e.EVENT_GO_BACK)})}).catch(function(n){var i=n&&n.message?n.message:a.core.i18nManager.get("error.fetch.deleted.item");t.errorAlert(i),a.mediator.publish(e.EVENT_GO_BACK)})})})},deactivate:function(){a.core.contextManager.resetSelection(),!a.core.settingManager.isWorkingUnderEvolution()||this&&this._isRefreshing||a.core.settingManager.resetWorkUnderBubble(),a.core.contextManager.getXENTreeDocument()&&a.core.contextManager.getXENTreeDocument().empty(),o.activeTreeDocument&&o.activeTreeDocument.freeXENContent(),a.mediator.publish(e.EVENT_SET_ACTIVE_ENG_ITEM,null),a.mediator.publish(e.EVENT_SHOW_PROPERTIES,{nodes:[]}),o.listViewCmp&&o.listViewCmp.stop(),o.idCardCmp&&o.idCardCmp.stop(),o.itemViewCmp&&o.itemViewCmp.stop(),o.itemViewCmp&&a.componentsMgt.deleteInstance(e.ITEM_VIEW_CMP,o.itemViewCmp.ref),o.listViewCmp&&a.componentsMgt.deleteInstance(e.LIST_VIEW_NEW_CMP,o.listViewCmp.ref),o.idCardCmp&&a.componentsMgt.deleteInstance(e.IDCARD_CMP,o.idCardCmp.ref),a.mediator.publish(e.EVENT_TRIPTYCH_HIDE_PANEL,"right"),o.landingPageListnerToken&&a.mediator.unsubscribe(o.landingPageListnerToken),o.setActiveEngItemListerToken&&a.mediator.unsubscribe(o.setActiveEngItemListerToken),o.infoPanelToken&&a.mediator.unsubscribe(o.infoPanelToken),o._NGFilterCmdStartToken&&n.unsubscribe(o._NGFilterCmdStartToken),o._NGFilterCmdStopToken&&n.unsubscribe(o._NGFilterCmdStopToken),o.activeTreeDocument&&delete o.activeTreeDocument.core,o.activeTreeDocument=null,o.listViewCmp=null,o.idCardCmp=null,o.itemViewCmp=null,o.resetListListnerToken=null,o.landingPageListnerToken=null,o.setActiveEngItemListerToken=null,a.mediator.publish(e.EVENT_RESET_SELECTION),a.mediator.publish(e.EVENT_LAUNCH_COMMAND,{commandId:e.UPDATE_WIDGET_TITLE,context:{label:null}})}}}}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/units/ChangeQuantityUnitTreeNodeService",["DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/units/ChangeQuantityUnitGroupModes","DS/TreeModel/TreeNodeModel"],(e,t)=>{const n="Unit";return class{constructor(e){this.viewContext=e}buildGroupNoneUnitsNode(t,n){return this.buildGroupNodeByQuantities(t,e.groupUnitIndexesNone,n)}buildGroupEqualQtyUnitsNode(t,n){return this.buildGroupNodeByQuantities(t,e.groupUnitIndexesByQuantity,n)}buildGroupNextEqualQtyUnitsNode(t,n){return this.buildGroupNodeByQuantities(t,e.groupUnitIndexesByNextQuantity,n)}computeQuantityLabelForGroupUnit(e,t,n){if(!Array.isArray(e)||!e.length)return"";const[i]=e;return this.computeQuantityLabelForUnit(i,t,n)}buildUnitTreeNode(e,n){return new t({label:e,grid:{"unit-quantity":n},children:[]})}buildGroupNodeByQuantities(e,t,n){if(!e||!e.size||"function"!=typeof t)return[];const i=t(e);return Array.isArray(i)?this.buildUnitNodesFromGroupUnits(i,e,n):[]}buildUnitNodesFromGroupUnits(e,t,n){return Array.isArray(e)&&e.length?e.map(({value:e})=>this.buildUnitNodeFromUnitIndexes(e,t,n)):[]}buildUnitNodeFromUnitIndexes(e,t,n){if(!Array.isArray(e)||!e.length)return[];let i=[];if(e.length>1){const r=this.computeQuantityLabelForGroupUnit(e,t,n);i=this.buildUnitsNode(e,t,r,n)}else if(1===e.length){const[r]=e;i=this.buildUnitNode(r,t,n)}return i}buildUnitsNode(e,t,i,r){const o=this.computeMinMaxLabelFromUnits(e),s=`${n}${o}`,a=this.buildUnitTreeNode(s,i);return e.forEach(e=>{const n=this.buildUnitNode(e,t,r);a.addChild(n)}),a}buildUnitNode(e,t,i){const r=`${n}[${e}]`,o=this.computeQuantityLabelForUnit(e,t,i),s=this.buildUnitTreeNode(r,o),{model:a}=this.viewContext;return this.getUnitNodeChildren(e,t,i).forEach(e=>{const t=a.duplicateNode(e);s.addChild(t)}),s}computeMinMaxLabelFromUnits(t){if(!Array.isArray(t)||!t.length)return"";const n=t.sort((e,t)=>e-t),i=[];let r=[];return n.forEach(t=>{r.length?e.isUnitNextContinous(t,r)?r.push(t):(i.push(r),r=[t]):r.push(t)}),i.push(r),i.reduce((e,t)=>e+(1===t.length?`[${t[0]}]`:`[${t[0]}-${t[t.length-1]}]`),"")}computeQuantityLabelForUnit(e,t,n){const i=this.getUnitNodeChildren(e,t,n),{model:r}=this.viewContext;return r.getRollup(i,{useReference:!0})}getUnitNodeChildren(e,t,n){return t.get(e).map(e=>n.get(e))}}}),define("DS/ENOXEngineer/services/SessionPredicates/JobsRunner",["DS/ENOXEngineer/services/SessionPredicates/SessionPredicatesErrors","DS/ENOXEngineerCommonUtils/LoggerUtils","DS/ENOXEngineer/services/SessionPredicates/Utils"],(e,t,n)=>{const{Logger:i}=t,{constants:r}=n,o=i.create(r.SESSION_PREDICATES_LOGGER_ID,"JobsRunner"),{WrongInput:s,JobsRunnerError:a}=e,l={publish(e,t){this.events&&this.events[e]&&this.events[e](t)},subscribe(e,t){this.events||(this.events={}),this.events[e]=t}},c=e=>{const{jobToRun:t}=e||{};return"function"==typeof t};class d{constructor(){this.runningJobs=[]}async waitForJobsEnded(){this.runningJobs.length&&await new Promise(e=>{l.subscribe("endJobs",()=>{e()})})}get isRunning(){return this.runningJobs.length>0}pushANewJob(e){if(!c(e))throw new s("JobsRunner.isAValidJobInput");const t=this.buildANewJob(e);this.pushJobInList(t),this.runJob(t)}buildANewJob(e){const{jobInput:t,jobToRun:n,resolveCB:i,rejectCB:r}=e;return{id:Date.now(),inputs:t,jobExe:n,resolveCB:i,rejectCB:r,run(){return this.jobExe(this.inputs)}}}pushJobInList(e){this.runningJobs.push(e)}async runJob(e){const{resolveCB:t,rejectCB:n}=e;try{const i=await e.run();"function"==typeof t&&t({...e,result:i})}catch(t){"function"==typeof n&&n({...e,error:t})}finally{this.removeJobFromList(e)}}removeJobFromList(e){if(!e||!e.id)throw new s("JobsRunner.removeWorkerFromList");const t=this.runningJobs.findIndex(t=>t.id===e.id);if(-1===t)throw new a(`worker ${e.id} not found in list`);this.runningJobs.splice(t,1),this.updateRunningState()}updateRunningState(){this.runningJobs.length||l.publish("endJobs")}}return o.enable?class extends d{async waitForJobsEnded(){await super.waitForJobsEnded(),o.log("no more job in the list, resolve the waitForJobsEnded")}pushJobInList(e){this.runningJobs.push(e),o.log(`pushing job ${e.id} in the list, ${this.printRunningJobsInfos()}`)}async runJob(e){o.log(`starting job ${e.id}`);const t=Date.now();await super.runJob(e);const n=Date.now()-t;o.log(`job ${e.id} ending in ${n} ms`)}removeJobFromList(e){o.log(`removing job ${e.id} from the list, ${this.printRunningJobsInfos()}`),super.removeJobFromList(e)}printRunningJobsInfos(){return`list jobs size ${this.runningJobs.length}, [${this.runningJobs.map(e=>e.id)}]`}}:d}),define("DS/ENOXEngineer/services/SessionPredicates/PredicatesProvider",["DS/ENOXEngineer/services/SessionPredicates/JobsRunner","DS/ENOXEngineer/services/SessionPredicates/SessionPredicatesErrors"],(e,t)=>{const{WrongInput:n,MissingImplementation:i}=t;return class{initialize(t){if(!t)throw new n("PredicatesProvider.initialize");this.appCore=t,this.worker=new e,this.init()}init(){}get label(){throw new i}getPredicateProperties(){throw new i}getPredicatePropertiesForSelectable(){throw new i}startARunningJob(e){this.worker.pushANewJob(e)}getRunningJobs(){return this.worker.runningJobs}async isBusy(){await this.worker.waitForJobsEnded()}}}),define("DS/ENOXEngineer/componentsHelpers/CollectionView/DragAndDropRejectionView",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Scroller","DS/Handlebars/Handlebars4","DS/ENOXEngineer/componentsHelpers/commandModal/XEngineerModal","text!DS/ENOXEngineer/componentsHelpers/CollectionView/ENOXENIssuesList.html"],function(e,t,n,i,r,o){"use strict";var s=i.compile(o);return i.registerHelper("inc",function(e,t){return parseInt(e)+1}),t.extend({defaultOptions:{},init:function(e){this._parent(e);this.onAcceptAndIgnore=e.onAcceptAndIgnore,this.onCancel=e.onCancel,this.issues=e.issues,this.allFailed=e.allFailed,this.isResolved=!1,this.nlsService=e.nlsService||{get:function(e){return e}},this.buildView()},_isGlobalRendering:function(){if(!Array.isArray(this.issues))return!0;for(var e=0;e<this.issues.length;e++){if(this.issues[e].isGlobal)return!0}return!1},buildView:function(){var e=this,t=this._isGlobalRendering();this._buildModal().getBody().setHTML(s({items:this.issues,isGlobal:t,notGlobal:!t,nls_object_info:this.nlsService.get("object.description"),nls_reason:this.nlsService.get("issuse.description")})),this.modal.onValidate(function(t){e.onAcceptAndIgnore(),e.isResolved=!0,t(),e.destroyView()},this),this.modal.onClose(function(){!e.isResolved&&e.onCancel(),e.destroyView(),console.warn("onClose")},this),this.modal.show()},_getModalTitle:function(){return this._isGlobalRendering()?this.nlsService.get("eng.ui.dialog.inValidDrop"):this.allFailed?this.nlsService.get("eng.ui.dialog.allDropContentInvalidData"):this.nlsService.get("eng.ui.dialog.dropContentInvalidData")},_buildModal:function(){var e=this;return this.modal=new r({title:this._getModalTitle(),className:"xeng-dnd-rejection",withFooter:!0,customFooter:function(){return e.allFailed||e._isGlobalRendering()?"<button type='button' name='cancelButton' class='btn btn-default'>"+e.nlsService.get("eng.ui.button.cancel")+"</button>":"<button type='button' name='okButton' class='btn btn-primary'>"+e.nlsService.get("eng.ui.button.continueAndIgnore")+"</button> <button type='button' name='cancelButton' class='btn btn-default'>"+e.nlsService.get("eng.ui.button.cancel")+"</button>"}}),this.modal},destroyView:function(){this.onAcceptAndIgnore=null,this.onCancel=null,this.issues=null,this.modal&&this.modal.destroy(),this.modal=void 0}})}),define("DS/ENOXEngineer/services/EngineeringSettings",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/ENOXWidgetPreferences/js/ENOXWidgetPreferences","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/XENPlatform3DXSettings","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/WebappsUtils/WebappsUtils","DS/ENOXEngineer/componentsHelpers/CollectionView/DragAndDropRejectionView","text!DS/ENOXEngineer/assets/config/xEngineer.conf.json","text!DS/ENOXEngineer/assets/config/idCardConfig.json"],function(e,t,n,i,r,o,s,a,l,c,d,u,p){"use strict";var g=JSON.parse(u),h=JSON.parse(p);return t.singleton(n,o,{getSetting:function(t){return e.is(t,"string")&&e.is(g[t])?g[t]:null},getIdCardSetting:function(t){return e.is(t,"string")&&e.is(h[t])?h[t]:null},getUserPrefKey:function(e){return this.getPlatformId()+"_"+e},getIconUrl:function(e){return this.getIconPath(e)},getIconPath:function(e){return c.getWebappsAssetUrl("ENOXEngineer","icons/32/"+e+".png")},getLoadingIcon:function(){return this.getImagePath("loading22x22.gif")},getImagePath:function(e){return c.getWebappsAssetUrl("ENOXEngineer","img/"+e)},getNlsStorageName:function(){return r.NLS_STORAGE_NAME+"_"+this.getLanguage()},getPredicatesNlsStorageName:function(){return r.PREDICATE_NLS_STORAGE_NAME+this.getPlatformId()+"_"+this.getLanguage()},get3DXContentFromDrop:function(e){if(!e||!e.data||!Array.isArray(e.data.items))throw"Dopped data are not valid";return e.data.items},getAppConfigLabel:function(e){var t="",n=e?" (":"";return this._platforms&&Object.keys(this._platforms).length>1&&(t=n+this.getPlatformId()+")"),this.app.core.isInExperimentalLabMode()&&(t+=" "+this.app.core.i18nManager.get("eng.app.in.experimentalLab")),t},isWorkingUnderEvolution:function(){if(!l)return!1;var e=this.app.core.localStorage.getItem(r.KEY_WORK_UNDER_DATA);return 1==this.app.core.localStorage.getItem(r.KEY_TOGGLE_WORK_UNDER_EVOLUTION)&&e&&(e.evolution&&e.evolution.id&&e.evolution.id.length>1||e.displayExpression)},resetWorkUnderBubble:function(){l&&l.cleanAuthDetails(),this.app.core.mediator.publishPlatformEvent(r.EVENT_REMOVE_AUTH_CTX_SESSION+r.XENGINEER_APP_AUTHKEY)},droppedDataFilter:function(e,t,n="OPEN"){var i=this;return a.wrappedWithPromise(function(r,o){if(!t||!Array.isArray(t)||t.filter(e=>"function"!=typeof e).length)return o(new Error("droppedDataFilter:InvalidInput | checkers must be an array of function"));let s=i.get3DXContentFromDrop(e);e.biProxyCtx&&(s=s.map(t=>({...t,biProxyCtx:e.biProxyCtx})));var l={invalids:[],valids:s};a.all(t.map(e=>e.call(i,s,n,l))).then(()=>{l.invalids.length>0?new d({issues:l.invalids,allFailed:0===l.valids.length,nlsService:i.app.core.i18nManager,onAcceptAndIgnore:()=>r(l.valids),onCancel:()=>r([])}):r(l.valids)}).catch(function(e){o(e)})})},isSetValidSelectionForOpen:function(){var e=this;return a.wrappedWithPromise(function(t,n){let i=widget.getValue("X3DContentId");if(!i)return t();try{var o=JSON.parse(i),s=e.get3DXContentFromDrop(o);if(!Array.isArray(s)||1!==s.length)return n(new Error(e.app.core.i18nManager.get("error.tooMany.items.selected.forOpen")));switch(s[0].objectType){case r.TYPE_ADVANCED_FILTER:e.app.core.Factories.ListItemFactory.getRootItemFromFilter(s[0]).then(function(i){let s=i[0];e.app.core.sessionManager.setNGFilterContextForNextOpen(s),o.data.items[0].objectId=s.rootId,o.data.items[0].objectType=r.TYPE_VPMREFERENCE,e.retrieveValidItemsForOpenFromDrop(o).then(function(e){t(e[0])}).catch(function(t){n(new Error(e.app.core.i18nManager.get("error.3DXContent.invalidType")))})}).catch(function(t){n(new Error(e.app.core.i18nManager.get("error.3DXContent.invalidType")))});break;default:e.retrieveValidItemsForOpenFromDrop(o).then(function(e){t(e[0])}).catch(function(t){n(new Error(e.app.core.i18nManager.get("error.3DXContent.invalidType")))})}}catch(t){return n(new Error(e.app.core.i18nManager.get("error.parse.3DXContent.failed")))}})},retrieveAllValidContentForXENFromDrop:function(e){return this.droppedDataFilter(e,[this._tenantChekerV2,this._typeComplianceChecker],"BOM")},retrieveValidItemsForOpenFromDrop:function(e){return this.droppedDataFilter(e,[this._tenantChekerV2,this._typeComplianceChecker,this._nbDroppedItemsChecker],"OPEN")},retrieveAllValidDocumentsFromDrop:function(e){return this.droppedDataFilter(e,[this._tenantChekerV2,this._typeComplianceChecker],"DOC")},_buildIssueEntry:function(e,t){var n="";return e.isGlobal||(n=this.app.core.i18nManager.replace(this.app.core.i18nManager.get("error.objectDescription"),{displayName:e.displayName,type:e.displayType})),{reason:t,isGlobal:e.isGlobal,source:e.serviceId,type:e.objectType,infos:n}},_nbDroppedItemsChecker:function(e,t,n){var i=this;return a.wrappedWithPromise(function(r,o){"OPEN"===t&&1!==e.length&&(n.invalids.push(i._buildIssueEntry({isGlobal:!0},i.app.core.i18nManager.get("error.drop.for.open.dont.support.multi"))),e.splice(0,e.length)),r(!0)})},_tenantChekerV2:function(e,t,n){var i=this,r=i.getPlatformId();return a.wrappedWithPromise(function(t,o){for(var s=0;s<e.length;s++){let t=e[s].envId;if(t&&t!==r){let t=i.app.core.i18nManager.replace(i.app.core.i18nManager.get("error.not.belong.toThePlatform"),{displayName:e[s].displayName,tenant:r});n.invalids.push(i._buildIssueEntry(e[s],t)),e.splice(s,1),s--}}t(!0)})},_getBOMContentTypes:function(e,t,n){var i=this;return this._genericDropTypeChecker(e,t,n,function(e){return i.app.core.dicoService.syncIsAnEngineeringItem(e.objectType)||i.app.core.dicoService.syncIsADocument(e.objectType)&&i.app.core.PreferencesManager.isSpecInProductStructureEnabled()||i.app.core.dicoService.syncIsAMaterial(e.objectType)||i.app.core.dicoService.syncIsADrawing(e.objectType)})},_getAllOpenableItem:function(e,t,n){var i=this;return this._genericDropTypeChecker(e,t,n,function(e){return i.app.core.dicoService.syncIsAnEngineeringItem(e.objectType)||i.app.core.dicoService.isSavedFilter(e.objectType)})},_getAllAttachments:function(e,t,n){var i=this;return this._genericDropTypeChecker(e,t,n,function(e){return i.app.core.dicoService.syncIsADocument(e.objectType)||i.app.core.dicoService.syncIsADrawing(e.objectType)})},_genericDropTypeChecker:function(e,t,n,i){var r=this,o=this.app.core.dicoService;return a.wrappedWithPromise(function(s,a){if(!Array.isArray(e)||"function"!=typeof i)throw new Error("invalid inputs");var l=e.map(function(e){return e.objectType});o.getRootTypes(l).finally(function(){for(var o=0;o<e.length;o++){const s=e[o];if(!i(s)){var a=r.app.core.i18nManager.replace(r.app.core.i18nManager.get("error.not.supported.type"),{type:s.displayType,operation:r.app.core.i18nManager.get("eng."+n)});t.invalids.push(r._buildIssueEntry(s,a)),e.splice(o,1),o--}}s(!0)})})},_typeComplianceChecker:function(e,t,n){switch(t){case"BOM":return this._getBOMContentTypes(e,n,t);case"OPEN":return this._getAllOpenableItem(e,n,t);case"DOC":return this._getAllAttachments(e,n,t);default:return this._getAllOpenableItem(e,n,t)}},isConfigAuthorized:function(){return!(!this.isConfigRoleGranted()||!this.isDecouplingActivated())},isDecouplingActivated:function(){for(var e=this.app.core.dataService.getConfigSettings(),t=null,n=0;n<e.length;n++)if("decoupleVariantEvolution"===e[n].settingName){t=e[n];break}return!(!t||"enabled"!=t.value)},isProductConfEnabled:function(){if(this.app&&this.app.core&&this.app.core.dataService){for(var e=this.app.core.dataService.getConfigSettings(),t=null,n=0;n<e.length;n++)if("StaticMappingActivation"===e[n].settingName){t=e[n];break}return t&&"enabled"==t.value}return!1},isXRevisionActive(){const e=this.app.core.dataService.getConfigSettings();let t=!1;for(let n=0;n<e.length;n++)if("xRevisionActivation"==e[n].settingName&&"enabled"===e[n].value){t=!0;break}return t},isAuthorizedTypeOnDrop:function(e,t,n){var i=this.app.core.dicoService;switch(t){case"BOM":return i.areBOMContentTypes(e,n);case"OPEN":return i.areEngeeringItems(e,n);case"DOC":return i.areDocuments(e,n);default:return i.areEngeeringItems(e,n)}},getAppId:function(){try{return widget.getValue("x3dAppId")?widget.getValue("x3dAppId"):"ENXENG_AP"}catch(e){return"ENXENG_AP"}},getCommand:function(t){return e.is(t,"string")&&e.is(g.commands[t])?g.commands[t]:null},getCVRequestLabel:function(){return this.app.core.i18nManager.get("APP_NAME")+"-"+this.getCurrentUser().id+"-"+(new Date).getTime()},getUserImage:function(e){return this.getServiceURL(r.SERVICE_3DSWYM_NAME)+"/api/user/getpicture/login/"+e+"/format/normal"},get3DswymUrl:function(){return this.getServiceURL(r.SERVICE_3DSWYM_NAME)},getSecurityContext:function(){return widget.getValue("SC")},setSecurityContext:function(e){widget.setValue("SC",e)},securityContextPromise:null,initialize:function(e){this.logger=e.core.logger.get("Setting manager");var t=this;this.app=e,e.core.isConfigAuthorized=e.sandboxBase.isConfigAuthorized=t.isConfigAuthorized.bind(t),e.core.settingManager=t,widget.getValue("x3dAppId")||widget.setValue("x3dAppId","ENXENG_AP");const n=i.getCredentialPreferenceKey();return widget&&widget.getValue("SC")&&widget.setValue(n,widget.getValue("SC")),this.app.core.mediator.subscribe(r.EVENT_REFRESH_APP_CONTENT,()=>{const e=widget.getValue(n);this.setSecurityContext(e)}),a.wrappedWithPromise(function(r,o){t.discoverRelated3DXPlatform().then(function(){let s=t.app.core.settingManager.getPlatformId();widget&&s&&(widget.setValue("x3dPlatformId",s),widget.setValue("tenantAware",!0)),t.securityContextPromise=i.addCredentialPreferenceToWidget(),e.mandatoryStartupPromises.push(t.securityContextPromise),t.securityContextPromise.then(()=>{const e=widget.getValue(n);return t.setSecurityContext(e),r()}).catch(function(e){t.logger.error("unable to retrieve SecurityContext"),o(e)})}).catch(function(e){throw o(e),new Error(e)})})},getDefaultSelectionMode:function(){return r.SELECT_MODE_CELL},isIndexModeEnabled:function(){return widget.getValue(r.PREFERENCE_USE_INDEX)},getRevisionsCommandCustomization(){let e=this;return{VersionExplorerCustomization:[function(){versionExplorer.setCheckVersionExternalFunction("ENOXVersionExplorerOpenVersion",function(e){return!0});["ENOXVersionExplorerCreateNewRevision","ENOXVersionExplorerDeleteVersion","ENOXVersionExplorerShowMaturity","ENOXVersionExplorerNewRevisionFrom","ENOXVersionExplorerCreateNewBranch","ENOXVersionExplorerDuplicate"].forEach(e=>{versionExplorer.setCheckVersionExternalFunction(e,function(e){return!!e&&"Model"!=e.options.data.type})}),versionExplorer.subscribeEvent("ENOXVersionExplorerOpenVersion",function(e){customizations[1](e)},!1)}.toString(),function(t){if(!t)return;let n=t.options.id,i=t.options.grid.type||"VPMReference";var o=e.app.core.contextManager.getActiveEngItem(),s=o?o.getID():null;if("Model"!==t.options.data.type)s===n?e.app.core.mediator.publish(r.EVENT_REFRESH_APP_CONTENT):n&&e.app.core.mediator.publish(r.EVENT_LAUNCH_COMMAND,{commandId:r.OPEN_ENG_ITEM,context:{item:{objectId:n,objectType:i}}});else{var a=o.getPreferedAttachedConfigModel()||null;a&&(o.options.staticMapping=void 0,e.app.core.sessionManager.cleanStaticMappingContext(),a.setPreferredVersion(n),e.app.core.mediator.publish(r.EVENT_CONF_MODEL_UPDATED,o.getID()))}}]}},reApplyWorkUnder:function(){var e=this;if(!l)return;let t=e.app.core.localStorage.getItem(r.KEY_WORK_UNDER_DATA),n=function(){0==e.app.core.localStorage.getItem(r.KEY_TOGGLE_WORK_UNDER_EVOLUTION)?e.app.core.mediator.publishPlatformEvent(r.EVENT_TOGGLE_DEACTIVE_SE+r.XENGINEER_APP_AUTHKEY):1==e.app.core.localStorage.getItem(r.KEY_TOGGLE_WORK_UNDER_EVOLUTION)?e.app.core.mediator.publishPlatformEvent(r.EVENT_TOGGLE_ACTIVE_SE+r.XENGINEER_APP_AUTHKEY):0==e.app.core.localStorage.getItem(r.KEY_TOGGLE_WORK_UNDER_CHANGE)?e.app.core.mediator.publishPlatformEvent(r.EVENT_TOGGLE_DEACTIVE_CA+r.XENGINEER_APP_AUTHKEY):1==e.app.core.localStorage.getItem(r.KEY_TOGGLE_WORK_UNDER_CHANGE)&&e.app.core.mediator.publishPlatformEvent(r.EVENT_TOGGLE_ACTIVE_CA+r.XENGINEER_APP_AUTHKEY),e.app.core.localStorage.removeItem(r.KEY_TOGGLE_WORK_UNDER_EVOLUTION),e.app.core.localStorage.removeItem(r.KEY_TOGGLE_WORK_UNDER_CHANGE)};t&&(t.evolution&&t.evolution.id&&t.evolution.id.length>1||t.displayExpression)?(l.setEffectivity(t,n),e.app.core.localStorage.removeItem(r.KEY_TOGGLE_WORK_UNDER_CHANGE)):t&&t.change&&t.change.name&&(l.update(t,n),e.app.core.localStorage.removeItem(r.KEY_TOGGLE_WORK_UNDER_EVOLUTION))}})}),define("DS/ENOXEngineer/componentsHelpers/FilterView/ENOXFilterView",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Toggle","DS/ENOXEngineer/services/EngineeringSettings","DS/ENOXEngineer/utils/XEngineerConstants","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json","css!DS/UIKIT/UIKIT.css"],function(e,t,n,i,r,o){"use strict";return t.extend({isLicenseValid:!1,toggle:[],init:function(e){this._parent(e);this.isLicenseValid=!0,this.render()},setup:function(e){},render:function(){if(1==this.isLicenseValid){var e=UWA.createElement("div",{});UWA.createElement("div",{html:"<H5>"+o.Evolution+":</H5>",styles:{position:"relative",width:"auto",display:"inline-block"}}).inject(e);var t=UWA.createElement("div",{styles:{position:"relative",width:"auto",display:"inline-block","margin-left":"20px"}});t.setStyles({width:"auto",display:"inline-block"});var i=UWA.createElement("div",{styles:{position:"relative",width:"auto",display:"inline-block","margin-left":"10px"}});i.setStyles({width:"auto"}),this.toggle[0]=new n({checked:!0,name:"ViewOptions_xeng",id:"ofcView_xeng",value:o.Filter_official_view,className:"primary"}).inject(t),this.toggle[1]=new n({name:"ViewOptions_xeng",id:"prjView_xeng",value:o.Filter_projected_view,className:"primary"}).inject(i),t.inject(e),i.inject(e),e.inject(this.options.parentElement),null!=this.options.viewJson&&this.setSelectedView(this.options.viewJson.view)}},getJSON:function(){return{view:this.getSelectedView()}},getSelectedView:function(){return this.isLicenseValid?this.toggle[0].isChecked()?r.CONF_OFFICIAL_VIEW:this.toggle[1].isChecked()?r.CONF_PROJECTED_VIEW:void 0:r.CONF_OFFICIAL_VIEW},setSelectedView:function(e){e==r.CONF_OFFICIAL_VIEW?this.toggle[0].check():e==r.CONF_PROJECTED_VIEW&&this.toggle[1].check()}})}),define("DS/ENOXEngineer/utils/XENHttpClient",["UWA/Core","DS/ENOXEngineerCommonUtils/XENGenericHttpClient","DS/ENOXEngineer/services/EngineeringSettings","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n,i){"use strict";return Object.assign(e.clone(t,!0),{decorateWithAddtionnaloptions:function(e,t){t.noSecurityContextNeeded||t.targetService!==i.SERVICE_3DSPACE_NAME||(e.headers.SecurityContext=encodeURIComponent("ctx::"+n.getSecurityContext()),e.headers.SecurityToken=encodeURIComponent(n.getSecurityToken()))},buildUrl:function(e){var t=n.getServiceURL(e.targetService);return n.isTenantBasedService(e.targetService)?t=this.decorateUrlWithTenant(t+e.url):t+=e.url,e.sc_tenant_in_url&&(t=this.decorateUrlWithSecuritycontext(t)),e.queryParameters&&(t=this.decorateUrlWithQueryParameters(t,e.queryParameters)),t},decorateUrlWithTenant:function(e){var t=e||"",i=t.indexOf("?");return t=i>-1?t+"&tenant="+n.getPlatformId():t+"?tenant="+n.getPlatformId()},decorateUrlWithSecuritycontext:function(e){var t=n.getSecurityContext(),i=e||"";if(e&&t&&t.length>0){var r=i.indexOf("?");i=r>-1?i+"&SecurityContext="+encodeURIComponent("ctx::"+n.getSecurityContext()):i+"?SecurityContext="+encodeURIComponent("ctx::"+n.getSecurityContext())}return i},decorateUrlWithQueryParameters:function(e,t){if("string"==typeof e&&Array.isArray(t)){e+=`&${t.join("&")}`}return e}})}),define("DS/ENOXEngineer/columnsProviders/AlternateDataProvider",["UWA/Core","UWA/Class","DS/ENOXEngineer/services/EngineeringSettings","DS/DocumentManagement/DocumentManagement","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/services/I18nManager","DS/ENOXEngineer/utils/XENHttpClient"],function(e,t,n,i,r,o,s){"use strict";return t.singleton({init:function(e){this._parent(e)},isAdditionalColumnsAvailable:function(t){if(!1===e.is(t,"function"))throw new Error("A callback function should be defined");t(!0)},getName:function(){return"AlternateColumns"},getManagedColumnNames:function(){return["Alternate"]},toBeUpdated:function(e){var t=!0;return e&&e.Alternate&&e["ds6w:alternate"]&&(t=!1),t},getAdditionalColumnsUX:function(e){var t=e.findIndex(function(e){return"Alternate"===e.dataIndex});e.splice(t,t>=0?1:0,{text:o.get("Alternate"),dataIndex:"Alternate",maxWidth:800,minWidth:20,width:200})},_fetchData:function(e){if(Array.isArray(e)){var t={referenceIds:e};return r.wrappedWithCancellablePromise(function(e,i){s.perform(n.getCommand("alternate_info"),t).then(function(t){e(t)}).catch(function(e){return i(e)})})}xEngAlertManager.errorAlert("fetchData need an array as input")},updateAttributes:function(t,n){if(!1===e.is(t,"object"))throw new Error("The object ids to modify must be specify");if(!1===e.is(n,"function"))throw new Error("A callback function should be defined");this._fetchData(t.pids).then(function(e){var i={};if(t.pids.forEach(function(e){i[e]={Alternate:"","ds6w:alternate":o.get("label_no")}}),e&&"success"===e.status){var r=e.AlternateItemInfo;for(var s in r){var a=t.pids.indexOf(s),l=t.pids[a];null==i[l]&&(i[l]={}),i[l].Alternate="Yes",i[l]["ds6w:alternate"]=o.get("label_yes")}}n({pids:i})})}})}),define("DS/ENOXEngineer/services/ExportService",["UWA/Class","UWA/Core","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/XENHttpClient","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n,i,r,o){"use strict";return e.singleton({initialize:function(e){this.app=e,e.core.exportService=this},_completePayload:function(e){var t=this;return n.wrappedWithCancellablePromise(function(n,i){if(!e)throw new Error("invalid input");var r=e.PersistentFilterCriteria&&e.PersistentFilterCriteria.filterData;if(!r)return n();var o=!(!e.PersistentFilterCriteria.filterData||!e.PersistentFilterCriteria.filterData.CVQuery)&&e.PersistentFilterCriteria.filterData.CVQuery;if(o&&o.union&&o.union.expand)for(var s=0;s<o.union.expand.length;s++)e.PersistentFilterCriteria.filterData.CVQuery.union.expand[s].expand_iter="Direct"==e.Components?"1":"-1";if(r?e.PersistentFilterCriteria.filterData.filterBinary:null)return n();t.app.core.dataService.createVolatileFilter(t.app.core.contextManager.getActiveEngItem()).then(function(t){e.PersistentFilterCriteria.filterData.filterBinary=t?t.filterBinaryForExpand:null,n()}).catch(function(e){console.error(e),n(null)})})},expandForQualifiedAsFinal:function(e,i){if(t.is(e)){var r=this,s=this.app.core.contextManager.getActiveEngItem();if(!s)return;var a=widget.getValue(o.FINAL_ITEMS_PREF),l=this.app.core.contextManager&&null!=this.app.core.contextManager.getActiveEngItemOpenContext()?this.app.core.contextManager.getActiveEngItemOpenContext().filteringContext:"";l=""!=l&&"none"!=l;var c=!!s.getPreferedAttachedConfigModel(),d=this.app.core.settingManager.getCommand("qualifiedAsFinal"),u=this.app.core.sessionManager.showNotInBOM(),p=null==u||null==u?"true":u;d.url.contains("?root3DSpaceUrl")||(d.url=d.url+"?root3DSpaceUrl="+this.app.core.settingManager.getDefault3DSpaceUrl());var g={physicalid:e,Authored:!1,PersistentFilter:l,PersistentFilterCriteria:this.app.core.contextManager.getActiveEngItemOpenContext(),PreferredFinalItem:a,ShowNotInBOM:p+"",ConfiguredMode:c};return n.wrappedWithCancellablePromise(function(t,n){r._completePayload(g).then(function(){var n=g.PersistentFilterCriteria.filterData&&g.PersistentFilterCriteria.filterData.filterBinary?g.PersistentFilterCriteria.filterData.filterBinary:"";g.PersistentFilter&&"nextGenFilter"==g.PersistentFilterCriteria.filteringContext?t(r.expandForQualifiedAsFinalItemsUsingMultiExpand(e,n,"-1",g,i)):t(r.expandForQualifiedAsFinalItems(e,n,"-1",!0,i))})})}},expandForQualifiedAsFinalItemsUsingMultiExpand:function(e,t,r,o,s){var a=this,l=o.PersistentFilterCriteria.filterData.CVQuery,c=a.app.core.dicoService.getAvailableAttributesByType("VPMReference").map(function(e){return e.sixWTag});a.app.core.settingManager.getSetting("select_predicate").forEach(e=>{-1===c.indexOf(e)&&c.push(e)}),c.push("ds6w:globalType");var d=a.app.core.settingManager.getSetting("select_rel");l.select_bo=c,l.select_rel=d,l.compute_select_bo=a.app.core.settingManager.getSetting("compute_select_bo"),l.label=a.app.core.settingManager.getCVRequestLabel();var u=this.app.core.settingManager.getCommand("multiexpand");return n.wrappedWithCancellablePromise(function(e,t){i.perform(u,JSON.stringify(l)).then(function(n){a._processQualifiedAsFinalExpandResponse(n,e,t,s)}).catch(function(e){var n=e&&e.error&&e.error.message?e.error.message:e;n=e&&e.response&&e.response.message?e.response.message:n,t(n)})})},expandForQualifiedAsFinalItems:function(e,r,o,s,a){if(t.is(e)){var l=this.app.core.settingManager.getCommand("db_expand"),c=this.app.core.dataService.getExpandPayload(e,r,o,s,!1),d=this;return n.wrappedWithCancellablePromise(function(e,t){i.perform(l,JSON.stringify(c)).then(function(n){d._processQualifiedAsFinalExpandResponse(n,e,t,a)}).catch(function(e){var n=e&&e.error&&e.error.message?e.error.message:e;n=e&&e.response&&e.response.message?e.response.message:n,t(n)})})}},_processQualifiedAsFinalExpandResponse:function(e,t,n,i){if(e&&e.results&&(!Array.isArray(e.results)||0===e.results.length))return t([]);this.app.core.Factories.ListItemFactory.getListNodesFromServerExpand(e,i).then(function(e){return t(e)}).catch(function(e){n(e)})},downloadExportFile:function(e,t,s){var a=this,l={data:e};l.data.select_bo=a.app.core.dicoService.getTagsForBOWithMandatories(),l.data.select_rel=a.app.core.dicoService.getTagsForRelWithMandatories(),l.data.select_rel.push("ds6w:globalType"),l.data.compute_select_bo=a.app.core.settingManager.getSetting("compute_select_bo"),a.app.core.sessionManager.isUsingDB()&&(l.data.types=a.app.core.dicoService.getSelectedTypes(),l.data.extensions=a.app.core.dicoService.getSelectedExtensions());var c=l.data.ExportFileName,d=this.app.core.settingManager.getCommand("csrf_tocken_validation");n.wrappedWithCancellablePromise(function(e,n){i.perform(d,"").then(function(n){var d=a.app.core.settingManager.getCommand(t);a._completePayload(l.data).then(function(){d.url.contains("?root3DSpaceUrl")||(d.url=d.url+"?root3DSpaceUrl="+a.app.core.settingManager.getDefault3DSpaceUrl()+"&timezoneOffset="+(new Date).getTimezoneOffset()),i.perform(d,JSON.stringify(l.data)).then(function(e){a.downloadFile(c,e,".csv",!0)}).catch(function(t){if(t&&t.type&&t.type===o.ERROR_TYPE_TIMEOUT){let e=a.app.core.i18nManager.get("eng.generic.timedout.message.operationFailed");r.errorAlert(e)}else console.error(t),r.errorAlert(t.response);e()}).finally(function(){s.close()})})}).catch(function(e){n(e)})})},downloadFile:function(e,t,n,i,r){e+=n;var o="";(r||i&&this.app&&this.app.core&&"en"!=this.app.core.settingManager.getLanguage())&&(o="\ufeff"),o+=t;var s=document.createElement("a");navigator.msSaveBlob?navigator.msSaveBlob(new Blob([o],{type:"text/csv;charset:utf-8"}),e):URL&&"download"in s?(s.href=URL.createObjectURL(new Blob([o],{type:"text/csv;charset:utf-8"})),s.style.visibility="hidden",s.setAttribute("download",e),document.body.appendChild(s),s.click(),document.body.removeChild(s)):location.href="data:application/octet-stream,"+encodeURIComponent(o)},normalizeStringInNFKDFormat:function(e){return e?e.normalize("NFKD").replace(/�/g," "):e},getdefaultColumnsToExportEntireStructure:function(e){var t={},n=this.app.core.dicoService.getAvailableAttributesByType(["VPMReference"]),i={type:"string",attrName:"InstanceName",sixWTag:"InstanceName",attrNls:this.app.core.i18nManager.get("label_Instance_Name")};n.unshift(i);for(var r=["InstanceName","ds6w:description","ds6w:identifier","ds6wg:EnterpriseExtension.V_PartNumber","ds6wg:revision","ds6w:label","ds6w:type"],o=0;o<n.length;o++)r.indexOf(n[o].sixWTag)>-1&&(t[n[o].sixWTag]=n[o].attrNls);return t},getParametricalAttributesForExport:function(e){for(var t=this.app.core.dicoService.getParametricalAttributesOf(e),n=[],i=0;i<t.length;i++)n[i]=t[i].sixWTag;return n}})}),define("DS/ENOXEngineer/columnsProviders/DeformableDataProvider",["UWA/Core","UWA/Class","DS/ENOXEngineer/services/EngineeringSettings","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/services/I18nManager","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/XENHttpClient"],function(e,t,n,i,r,o,s){"use strict";return t.singleton({init:function(e){this._parent(e)},isAdditionalColumnsAvailable:function(t){if(!1===e.is(t,"function"))throw new Error("A callback function should be defined");t(!0)},getName:function(){return"DeformableColumns"},getManagedColumnNames:function(){return[o.CONST_DEFORMABLE]},toBeUpdated:function(e){var t=!0;return e&&e[o.CONST_DEFORMABLE]&&(t=!1),t},getAdditionalColumnsUX:function(e){var t=e.findIndex(function(e){return e.dataIndex===o.CONST_DEFORMABLE});e.splice(t,t>=0?1:0,{text:r.get(o.CONST_DEFORMABLE),dataIndex:o.CONST_DEFORMABLE,maxWidth:800,minWidth:20,width:200})},_fetchData:function(e){if(Array.isArray(e)){var t={references:e};return i.wrappedWithCancellablePromise(function(e,i){s.perform(n.getCommand("deformable_info"),t).then(function(t){e(t)}).catch(function(e){return i(e)})})}xEngAlertManager.errorAlert("fetchData need an array as input")},updateAttributes:function(t,n){if(!1===e.is(t,"object"))throw new Error("The object ids to modify must be specify");if(!1===e.is(n,"function"))throw new Error("A callback function should be defined");this._fetchData(t.pids).then(function(e){var i={};if(t.pids.forEach(function(e){i[e]={Deformable:" "}}),Array.isArray(e.results)){var r=e.results;for(var s in r){let e=r[s],t=r[s].reference;if("success"==e.status&&e.deformedFrom["PLMEntity.V_Name"]){let n=e.deformedFrom&&e.deformedFrom.revision?e.deformedFrom.revision:"";i[t]={},i[t][o.CONST_DS6W_DEFORMABLE]=e.deformedFrom.reference,i[t][o.CONST_DEFORMABLE]=e.deformedFrom["PLMEntity.V_Name"]+" "+n}}}n({pids:i})})}})}),define("DS/ENOXEngineer/columnsProviders/MadeFromDataProvider",["UWA/Core","UWA/Class","DS/ENOXEngineer/services/EngineeringSettings","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/services/I18nManager","DS/ENOXEngineer/utils/XENHttpClient"],function(e,t,n,i,r,o){"use strict";return t.singleton({init:function(e){this._parent(e)},isAdditionalColumnsAvailable:function(t){if(!1===e.is(t,"function"))throw new Error("A callback function should be defined");t(!0)},getName:function(){return"MadeFromColumns"},getManagedColumnNames:function(){return["MadeFrom"]},toBeUpdated:function(e){var t=!0;return e&&e.MadeFrom&&(t=!1),t},getAdditionalColumnsUX:function(e){var t=e.findIndex(function(e){return"MadeFrom"===e.dataIndex});e.splice(t,t>=0?1:0,{text:r.get("MadeFrom"),dataIndex:"MadeFrom",maxWidth:800,minWidth:20,width:200})},_fetchData:function(e){return i.wrappedWithCancellablePromise((t,i)=>{const r=n.getCommand("madefrom_info_bulk"),s={Product_Ids:e};o.perform(r,JSON.stringify(s)).then(t).catch(i)})},updateAttributes:function(t,n){if(!1===e.is(t,"object"))throw new Error("The object ids to modify must be specify");if(!1===e.is(n,"function"))throw new Error("A callback function should be defined");this._fetchData(t.pids).then(e=>{const i={};(e&&e.success&&Array.isArray(e.result)&&e.result.forEach(({Product_Id:e,MadeFromConnections:t})=>{let n=[];null==i[e]&&(i[e]={}),t.forEach(e=>{if(e){let t=e.madeFromProductTitle+" "+e.madeFromProductRevision;if(e.asRequired){let n=e.quantity&&"0"!=parseInt(e.quantity)?`, ${e.quantity} ${e.quantityUOM.nlsLabel}`:"";t+=` (${r.get("makeFromAsRequired")}${n})`}else e.quantity&&e.quantityUOM&&e.quantityUOM.nlsLabel&&(t+=` (${e.quantity} ${e.quantityUOM.nlsLabel})`);n.push(t)}}),i[e].MadeFrom=n.length>0?n.join(", "):" "}),Object.keys(i).length===t.pids.length)&&n({pids:i})}).catch(()=>{}).finally(()=>{})}})}),define("DS/ENOXEngineer/utils/Utils",["UWA/Core","UWA/Utils","DS/Utilities/Dom","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/TreeModel/TreeNodeModel","DS/DataDragAndDrop/DataDragAndDrop","DS/ENOXEngineer/services/EngineeringSettings","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOFilterBIUX/FilterBIComponentProxy","DS/ENOXEngineer/utils/XENHttpClient","DS/ENOXEngineerCommonUtils/ExpandPayloadFactory"],(e,t,n,i,r,o,s,a,l,c,d)=>{const u={no_type_filter_rel:["XCADBaseDependency"],type_filter_rel:["PLMInstance"],"q.iterative_filter_query_bo":'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"'};var p={getVersionByIdFromVersionGraph:function(e,t){return e&&e.Derived&&e["Main Derived"]?(t=t&&t.startsWith("pid:")?t:"pid:"+t,this._searchMatch(e,t)):null},_searchMatch:function(e,t){if(e.id===t)return e;if(e["Main Derived"]&&e["Main Derived"].id===t)return e["Main Derived"];if(Array.isArray(e.Derived)&&e.Derived.length>0)for(var n=0;n<e.Derived.length;n++)if(e.Derived[n].id===t)return e.Derived[n];if(Array.isArray(e.Derived)&&e.Derived.length>0){var i=[];for(n=0;n<e.Derived.length;n++)i.push(this._searchMatch(e.Derived[n],t));for(n=0;n<i.length;n++)if(i[n])return i[n]}if(Array.isArray(e["Main Derived"].Derived)&&e["Main Derived"].Derived.length>0){for(i=[],n=0;n<e["Main Derived"].Derived.length;n++)i.push(this._searchMatch(e["Main Derived"].Derived[n],t));for(n=0;n<i.length;n++)if(i[n])return i[n]}return e["Main Derived"]&&e["Main Derived"]["Main Derived"]&&e["Main Derived"]["Main Derived"].id?this._searchMatch(e["Main Derived"]["Main Derived"],t):null},loadFiles:function(e,t){return new Promise(function(t,n){var i=function(e){n(e)};Array.isArray(e)?require(e,function(){t(arguments)},i):i(e)})},getFetchTaggerColorMap:function(e){if(!Array.isArray(e)||!e.length)return{};const t={};return e.map(e=>{Reflect.has(t,e.id)||(t[e.id]=e.color)}),t},getExpandTaggerColorMap:function(e){const{tagColors:t}=e||{};if(!Array.isArray(t))return{};const n={};return t.forEach(e=>{const{predicate:t,dispValue:i,color:r,object:o}=e;if("string"!=typeof t||!t.trim().length)return;const s=t.slice(t.lastIndexOf("/")+1);n[s]||(n[s]={}),"string"==typeof i&&i.trim().length&&(n[s][i]={color:r}),"string"==typeof o&&o.trim().length&&(n[s][o]={color:r})}),n},colorizeNodeFromMap:function(t,n,i){let r=n.contains("ds6w:browsingStructure")?`${n}${a.APPEND_INSTANCE_COLUMN_KEYWORD}`:n;if(!t||"string"!=typeof r||!r.trim().length||!i)throw new Error("invalid input");if(!i[n])throw console.debug(`colorizeNodeFromMap missing ${r} value in colorMap`),new Error(`colorizeNodeFromMap missing ${r} value in colorMap`);const o=t.getAttributeValue(r);if(!e.is(o))throw console.debug(`colorizeNodeFromMap missing ${r} in node ${t.getID()}`),new Error(`missing ${r} in node ${t.getID()}`,{cause:404});if(i[n][o]){const{color:e}=i[n][o]||{};e&&t.setColor(e)}},colorizeNodesStructure:function(e,t,n,i){Array.isArray(e)&&t&&n&&i instanceof Set!=!1&&Reflect.ownKeys(t).forEach(r=>{e.forEach(e=>{try{e.setColor(null),this.colorizeNodeFromMap(e,r,t)}catch(t){404===t.cause&&(n[e.getID()]=e,i.add(r))}if(!e.isExpanded()){const r=e.getChildNodes();Array.isArray(r)&&r.length&&this.colorizeNodesStructure(r,t,n,i)}})})},colorizeNodesWithCVFetch:async function(e,t,n,i){if(!(e&&Array.isArray(t)&&n&&i))return;const r=Reflect.ownKeys(e);let o=null;try{o=await this.fetchPredicatesOnIndex(r,t,i)}catch(e){return}const s=this.formatFetchPredicatesAnswer(o);s&&Reflect.ownKeys(s).length&&Reflect.ownKeys(s).forEach(t=>{const i=e[t];if(!i)return;const r=s[t];r&&Reflect.ownKeys(r).length&&Reflect.ownKeys(r).forEach(e=>{const t=r[e];if(t&&n[e][t]){i.setAttribute(e,t);try{this.colorizeNodeFromMap(i,e,n)}catch(t){console.debug(`failed to colorize node ${i.getID()} for predicate ${e}`)}}})})},colorizeNodesFromExpandTagger:async function(e,t,n){if(!Array.isArray(e)||!t||!n)return;const i={},r=new Set;if(this.colorizeNodesStructure(e,t,i,r),Reflect.ownKeys(i).length&&r.size)try{await this.colorizeNodesWithCVFetch(i,[...r.values()],t,n)}catch(e){}},formatFetchPredicatesAnswer:function(e){const{results:t}=e||{};if(!Array.isArray(t))return{};const n={};return t.forEach(e=>{let t="";const i={},{attributes:r}=e;r.forEach(e=>{const{name:n,value:r}=e;"resourceid"===n?t=r:i[n]=r}),n[t]=i}),n},fetchPredicatesOnIndex:async function(e,t,n){if(!n)return;if(!Array.isArray(e)||!e.length)return;if(!Array.isArray(t)||!t.length)return;var i={label:n.getCVRequestLabel(),physicalid:e,locale:n.getLanguage(),tenant:n.getPlatformId(),select_predicate:t,select_file:[]};let r={};try{const e=n.getCommand("cv_fetch");r=await c.perform(e,i)}catch(e){}return r},colorizeNodeFromExpandTagger:function(e,t){e&&t&&Reflect.ownKeys(t).forEach(n=>{if(!t[n])return void console.debug(`colorizeNodeFromExpandTagger missing ${n} in colorMap`);const i=e.getAttributeValue(n);if(t[n][i]){const{color:r}=t[n][i]||{};r&&e.setColor(r)}else console.debug(`colorizeNodeFromExpandTagger missing ${n} in colorMap`);if(!e.isExpanded()){const n=e.getChildNodes();Array.isArray(n)&&n.forEach(e=>this.colorizeNodeFromExpandTagger(e,t))}})},getAugmenttedQueryForSearch:function(t){if(e.is(t,"string")&&t.trim().length>0){var n=t;return"*"!==t.charAt(0)&&(n="*"+t),"*"!==t.charAt(t.length-1)&&(n+="*"),n}return null},buildFilterBIProxyOptions:function(e,t){const n={};return(e?Reflect.ownKeys(e).filter(e=>"appOptions"!==e):[]).forEach(t=>{n[t]=e[t]}),{tenant:s.getPlatformId(),processingMode:"appProcessing",colorize:!0,appId:t,widgetId:t,shareFilterSpec:!0,appQueryParam:u,...n}},postInitFilterBIProxyForExpandSynthesis:function(e=!1){this.taggerProxy&&(this.taggerProxy.isExpandSynthesisON=!0,this.taggerProxy.setHighDepthTagsAvailability(!0),!0===e?this.taggerProxy.setSynthesisMode("flat"):this.taggerProxy.setSynthesisMode("occurrence"))},initFilterBIProxy:function(t={},n){const i=this.buildFilterBIProxyOptions(t,n);var r=this;this.taggerProxy=new l(i),this.taggerProxy.filterOptions=e.clone(t),this.taggerProxy.isActivated=!0,this.taggerProxy.appQueryParam=u,this.taggerProxy.XENRoots=[];const{ExpandSynthesisON:o,appOptions:c}=t||{};if(!0===o){const{retreiveTagsonInstance:e}=c||{};this.postInitFilterBIProxyForExpandSynthesis("boolean"==typeof e&&e)}return this.taggerProxy.isExpandSyntesisActivated=function(){return"boolean"==typeof this.isExpandSynthesisON&&this.isExpandSynthesisON},this.taggerProxy.activateFilter=function(){this.activate(),this.isActivated=!0},this.taggerProxy.deactivateFilter=function(){this.deactivate(),this.isActivated=!1},this.taggerProxy.isFilterActivated=function(){return this.isActivated},this.taggerProxy.addRoots=function(e){if(!Array.isArray(e)||!e.length)throw new Error("invalid input => expected a valid array");if(this.isExpandSyntesisActivated()&&1!==e.length)throw new Error("invalid input => expected a valid array of only one element");if(JSON.stringify(e)!==JSON.stringify(this.XENRoots)){if(this.isExpandSyntesisActivated()){const[t]=e;this.setTagsWithExpandSynthesis(t)}else this.setTagsWithFetchSynthesis(e);this.XENRoots=e,console.debug(`XENFIlterBIPRoxy -> addRoots: ${this.XENRoots.length} ${this.XENRoots} to taggerProxy instance :  ${JSON.stringify(this.filterOptions)}`)}else console.debug(`XENFIlterBIPRoxy -> addRoots: roots already added, do nothing from taggerProxy instance :  ${JSON.stringify(this.filterOptions)}`)},this.taggerProxy.removeAllRoots=function(e=!1){console.debug(`XENFIlterBIPRoxy -> removeAllRoots: ${this.XENRoots} from taggerProxy instance :  ${JSON.stringify(this.filterOptions)}`),e&&this.XENRoots.length&&this.removeRoots(this.XENRoots),this.XENRoots=[]},this.taggerProxy.hasOptions=function(e){return!(!e||!this.filterOptions)&&JSON.stringify(e)===JSON.stringify(this.filterOptions)},this.taggerProxy.getDefaultApplicativeSpec=function(){return e.clone(u)},this.taggerProxy.setApplicativeSpec=function(t=!1,n=!1){const i=this.getDefaultApplicativeSpec();if(this.isExpandSyntesisActivated()){const o=e.clone(i);if(t){let e=s.getSetting("acceptedDocumentsRoots"),t=s.getSetting("unSupportedDocumentsRoots");const n=r.buildFlattenedTaxonomiesForSearch(e,t);o["q.iterative_filter_query_bo"]=`${o["q.iterative_filter_query_bo"]} OR ${n}`;const i=["SpecificationDocument"];o.type_filter_rel.push(...i)}if(n){const e='(flattenedtaxonomies:"types/Raw_Material")';o["q.iterative_filter_query_bo"]=`${o["q.iterative_filter_query_bo"]} OR ${e}`;const t=["MustBeMadeFrom"];o.type_filter_rel.push(...t)}const l=d.convertPayloadTo(o,a.COMMAND_WS_EXPAND_CV_V2),{batch:c}=l||{},{expands:u}=c||{},[p]=u||[],{graph:g}=p||{};g&&(i.graph=g)}JSON.stringify(this.appQueryParam)!==JSON.stringify(i)&&(this.setAppQueryParam(i),this.isExpandSyntesisActivated()&&Array.isArray(this.XENRoots)&&this.XENRoots.length&&this.setTagsWithExpandSynthesis(this.XENRoots),this.appQueryParam=i)},this.taggerProxy},getFilterConfigType:function(){return this.taggerProxy.CONFIG_FILTER},createNodePathJson:function(e){var t={nodes:[],paths:[]},n=e;new Object;for(var i in n){var r=n[i],o=[];t.nodes.push(r.options?r.options.referenceId:null),o.push(i),t.paths.push(o)}return t},createNodePathJsonFromArray:function(e){var t={nodes:[],paths:[]};return e.forEach(function(e,n){t.nodes.push(e.getID());var i=[];i.push(n),t.paths.push(i)}),t},getDateFormater:function(){return this.dataFormatter2||(this.dataFormatter2=new Intl.DateTimeFormat(s.getLanguage(),{year:"numeric",month:"numeric",day:"numeric"})),this.dataFormatter2},getformatedDate:function(e){this.dataFormatter||(this.dataFormatter=new Intl.DateTimeFormat(s.getLanguage(),{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}));try{return this.dataFormatter.format(new Date(e)).replace(",","")}catch(t){return e}},getDGVformatedDate:function(e){this.dataDGVFormatter||(this.dataDGVFormatter=new Intl.DateTimeFormat(s.getLanguage(),{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0}));const t=e=>{if(e instanceof Date)return this.dataDGVFormatter.format(e);if("string"==typeof e||e instanceof String)try{return this.dataDGVFormatter.format(new Date(e))}catch(t){return e}};return Array.isArray(e)?e.map(e=>t(e)):t(e)},dateFormatFromMilliSeconds:function(e){return isNaN(e)||(dateFormat=parseInt(e),dateFormat=1e3*date),new Date(e)},dateFormatFromDsToIso:function(e,t){if(!e||0===e.length)return null;var n=e;return n.indexOf("@")>-1&&n.indexOf(":GMT")>-1?n=n.replace("@","T").replace(/\//g,"-").replace(":GMT","Z"):!t||-1!==n.indexOf("T")&&-1!==n.indexOf("Z")||(n=null),n},formatCustomDateAttribute:function(t){if(!t||!e.is(t,"string")||0===t.length)return null;try{var n=this.dateFormatFromDsToIso(t);return n?this.getDateFormater().format(new Date(n)):null}catch(e){return t}},isServiceTimedOut:function(e){return e&&e.error&&e.error.message&&e.error.message.includes("timedout")},getArrayWithoutDuplicate:function(e){if(!Array.isArray(e)||0===e.length)return[];for(var t=[e[0]],n=1;n<e.length;n++)-1===t.indexOf(e[n])&&t.push(e[n]);return t},prepareDragData:function(e,t){var n={biProxyCtx:t&&t.getCtxForSharing?t.getCtxForSharing():{widgetId:s.getWidgetId(),appId:s.getWidgetId()},protocol:"3DXContent",version:"1.1",source:s.getWidgetId(),data:{items:[]}},i=[];return Array.isArray(e)&&e.length>0&&e[0]&&e.forEach(function(e){var t={envId:s.getPlatformId(),serviceId:a.SERVICE_3DSPACE_NAME,contextId:"",objectId:e.getID(),objectType:e.getType(),displayName:e.getLabel(),displayType:e.getType()};i.push(t)}),n.data.items=i,JSON.stringify(n)},get3DXContentFromDrop:function(e){if(!e||!e.data||!Array.isArray(e.data.items))throw"Dopped data are not valid";return e.data.items},_getItemsByTypeFromDroppedData:function(e,t){if(!Array.isArray(e)&&!t)return{};var n,i={};return e.forEach(function(e){n=e.objectType,t.kindOfEngItem&&t.kindOfEngItem.VPMReference&&t.kindOfEngItem.VPMReference.includes(e.objectType)?n=a.TYPE_VPMREFERENCE:t.kindOfEngItem&&t.kindOfEngItem.Raw_Material&&t.kindOfEngItem.Raw_Material.includes(e.objectType)?n=a.TYPE_RAW_MATERIAL:t.kindOfDrawing&&t.kindOfDrawing.Drawing&&t.kindOfDrawing.Drawing.includes(e.objectType)?n=a.TYPE_DRAWING:t.kindOfDocument&&t.kindOfDocument.Document&&t.kindOfDocument.Document.includes(e.objectType)?n=a.TYPE_DOCUMENT:t.kindOfDocument&&t.kindOfDocument["CONTROLLED DOCUMENTS"]&&t.kindOfDocument["CONTROLLED DOCUMENTS"].includes(e.objectType)&&(n=a.TYPE_CONTROLLED_DOCUMENTS),i[n]||(i[n]=[]),i[n].push(e)}),i},buildFlattenedTaxonomiesForSearch:function(e,t){let n="",i="";return Array.isArray(e)&&e.forEach(function(e,t){0!==t&&(n+=" OR "),n+='flattenedtaxonomies:"types/'+e+'"',"Drawing"===e&&(n+=" AND [ds6w:composed]:FALSE")}),n&&""!==n&&(n="("+n+")"),Array.isArray(t)&&t.forEach(function(e,t){0!==t&&(i+=" OR "),i+='flattenedtaxonomies:"types/'+e+'"'}),i&&""!==i&&(n="("+n+" AND (NOT ("+i+")))"),n},getCurrentTimeStamp:function(){return(new Date).getTime()},cleanDroppable:function(e){o.clean(e)},makeDroppable:function(t){var n={enter:function(n,i){"function"===e.typeOf(t.onDragEnter)&&t.onDragEnter.apply(t.context,[n,i])},leave:function(n,i){"function"===e.typeOf(t.onDragLeave)&&t.onDragLeave&&t.onDragLeave.apply(t.context,[n,i])},over:function(n,i){"function"===e.typeOf(t.onDragOver)&&t.onDragOver&&t.onDragOver.apply(t.context,[n,i])},drop:function(n,i,r){"function"===e.typeOf(t.onDrop)&&t.onDrop.apply(t.context,[n,i,r])}};o.droppable(t.element,n)},makeDraggable:function(e,t){o.draggable(e,t)},uid:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},createEvent:function(e,t){return{metadata:{uid:p.uid(),originUid:e,timestamp:Date.now(),appid:s.getAppId()+"_"+s.getWidgetId(),originWidgetId:s.getWidgetId()},data:t}},isTouchDevice:function(){return"ontouchstart"in document.documentElement},getFileInput:function(e){var t=UWA.extendElement(widget.body).getElement("#fileExplorer");return t||(t=new UWA.createElement("input",{id:"fileExplorer",multiple:e?void 0:"multiple",type:"file",styles:{display:"none"}}).inject(widget.body),this.isTouchDevice()&&(t.accept="image/*;capture=camera")),t.removeEvents(),t},_downloadFromFCS:function(e,t){var n=document.createElement("div");n.style.display="none",e+="&__fcs__attachment=true",n.innerHTML='<a href="'+e+'" download></a>';var i=n.querySelector("a");document.body.appendChild(n),setTimeout(function(){i.click(),document.body.removeChild(n)},66)},launchDownloadfromURLs:function(e){var t=this;e.reduce(function(e,n){return i.wrappedWithCancellablePromise(function(i,r){e.then(function(){t._downloadFromFCS(n.downloadUrl),setTimeout(function(){i()},106)})})},i.wrappedWithCancellablePromise(function(e,t){e()}))},convertVolumeInIUForDisplay:function(e){return this.convertVolumeInIUTo(e,"L").toString()+" L"},convertVolumeInIUTo:function(e,t){var n=e*this._getVolumeConversionFactor(t);return Math.round(1e7*n)/1e7},convertVolumeToInternationalUnit:function(e,t){return e/this._getVolumeConversionFactor(t)},_getVolumeConversionFactor:function(e){return s.getSetting("volumeUnitOfMeasure")[e].factor},isADBDateFormat:e=>"string"==typeof e&&-1!==e.search(/(T..:.*?Z)/g),isIndexDateEqualToDBDate:(e,t)=>"string"==typeof t&&"string"==typeof e&&(!(!t.trim().length||!e.trim().length)&&t.startsWith(e)),areObjectsGivenPropertyValuesEqual:function(e,t,n){if(e===t)return!1;if(!(e instanceof Object&&t instanceof Object))return!1;if(e.constructor!==t.constructor)return!1;let i=!0;for(let r=0;r<n.length;r++){let o=n[r];if(!e[o]&&t[o]||null!=e[o]&&null!=t[o]&&e[o].toString()!==t[o].toString()){i=!!this.isADBDateFormat(t[o])&&this.isIndexDateEqualToDBDate(e[o],t[o]);break}}return i},areEngItemsEqual:function(e,t){return e&&t&&e.getID()===t.getID()},removeOddIndexes:function(e){return function(t,n){return n%2==0&&(!e||n<=e)}},getAlphaNumericName:function(e){return e?e.replace(/[^a-zA-Z0-9 ]/g,""):""},hasMultiValues:function(e,t){let n=e.options.grid[t];return Array.isArray(n)&&n.length>1},convertDateNodeValueToCellValue(e,t=!1,n=!0){const i=t?e=>e instanceof Date&&!Number.isNaN(e.getMilliseconds()):null;let r=p.convertNodeValueToCellValue(e,p.dateFormatFromMilliSeconds,i,n);if(Array.isArray(r)&&n){const e=r.map(e=>e.getTime());r=[...new Set(e)].map(e=>new Date(e))}return r},convertBooleanNodeValueToCellValue(e,t=!1,n=!0){if("boolean"==typeof e)return e;const i=t?e=>!0===e||!1===e:null;return p.convertNodeValueToCellValue(e,e=>{const t=e.toLowerCase();if("true"!==t&&"false"!==t)throw new Error(`value ${t} is not a boolean`);return"true"==t},i,n)},convertIntegerNodeValueToCellValue(e,t=!0,n=!0){const i=t?e=>!Number.isNaN(e):null;return p.convertNodeValueToCellValue(e,Number.parseInt,i,n)},convertRealNodeValueToCellValue(e,t=!0,n=!0){const i=t?e=>!Number.isNaN(e):null;return p.convertNodeValueToCellValue(e,Number.parseFloat,i,n)},convertStringNodeValueToCellValue(e,t=!0,n=!0){const i=t?e=>"string"==typeof e:null;return p.convertNodeValueToCellValue(e,String,i,n)},convertNodeValueToCellValue:function(e,t,n,i=!0){if(t&&"function"!=typeof t)return null;if(n&&"function"!=typeof n)return null;if(!e)return;const r=e=>{let i=t?t(e):e;if(n&&!n(i))throw new Error("conversion check fails");return i};let o=null;if(Array.isArray(e))try{o=e.map(e=>r(e))}catch(e){o=null}else try{o=r(e)}catch(e){o=null}return Array.isArray(o)&&i&&(o=[...new Set(o)]),o},findNodesByIdsFromList:function(e,t){let n=[];return e&&Array.isArray(e)?0===e.length?n:t&&Array.isArray(t)?0===t.length?n:n=e.filter(e=>!(!e.matchIDs||!e.matchIDs(t))):(console.error("findNodesByIdsFromList: ids - bad input: expect Array"),n):(console.error("findNodesByIdsFromList: nodesList - bad input: expect Array "),n)},findQtyOrInstNodesByIdsFromList:function(e,t){let n=[];return e&&Array.isArray(e)?0===e.length?n:t&&Array.isArray(t)?0===t.length?n:n=e.filter(e=>!(!e.matchQtyOrInstIDs||!e.matchQtyOrInstIDs(t))):(console.error("findNodesByIdsFromList: ids - bad input: expect Array"),n):(console.error("findNodesByIdsFromList: nodesList - bad input: expect Array "),n)},createMap:function(e,t,n){return e.reduce((e,i)=>(e[t(i)]=n(i),e),{})},getGroupIntentWithHelpers:t=>({...e.clone(t),getPredicates:function(){const e=this.groupingIntent;if(!Array.isArray(e))return[];const t=new Set;return e.forEach(e=>{const{predicate:n}=e;"string"==typeof n&&""!==n.trim()&&t.add(n)}),[...t]},getObjectToDispTextMap:function(){const e=new Map,t=this.groupingIntent;return Array.isArray(t)?(t.forEach(t=>{const{object:n,predLevel:i}=t;n.forEach(t=>{const{object:n,dispText:r,merged:o}=t;let s=n;i&&Array.isArray(n)&&n.length&&(s=n[0]),s&&r&&e.set("string"!=typeof s?JSON.stringify(s):s,r),Array.isArray(o)&&o.forEach(t=>{const{object:n}=t;n&&r&&e.set("string"!=typeof n?JSON.stringify(n):n,r)})})}),e):e},getFirstGroupIntentObjectProperties:function(){const[e]=Array.isArray(this.groupingIntent)?this.groupingIntent:[],{object:t}=e||{},[n]=t||[],i=n&&Array.isArray(n.object);return{isALevelGroupObject:i,object:i?n.object:null,objectAsString:i?JSON.stringify(n.object):null,objectLength:i?n.object.length:0}}}),filterGroupsWithCollapseCriterias:function(e){if(!Array.isArray(e))return;const t=[];e.forEach(n=>{const{facet:i}=n,{count:r}=i||{},o=e.getChildren(n);if(Array.isArray(o)&&1===o.length){const{facet:e}=o[0]||{},{count:i}=e||{};r===i&&t.push(n)}}),t.forEach(t=>{const{key:n,level:i}=t,r=e.findIndex(e=>e.key===n);if(-1!==r){const t=e[r];e.getChildren(t,!1).forEach(e=>{e.level--,e.parent===t.key&&(e.parent=t.parent)}),e.splice(r,1)}})},mergeFacetsIfAny(e,t){if(!Array.isArray(e)||!t)return e;const{groupingIntent:n}=t;if(!Array.isArray(n))return e;const i=[];return n.forEach(e=>{const{object:t}=e;t.forEach(e=>{const{merged:t}=e;Array.isArray(t)&&t.forEach(e=>{const{object:t}=e;t&&i.push(t)})})}),i.length?e.filter(e=>{const{object:t}=e;return-1===i.indexOf(t)}):e},retreiveGroupsFromExpand:function(e,t,n=null){const{results:i}=e||{};if(!Array.isArray(i)||!i.length)return null;const r=this.getGroupIntentWithHelpers(t),o=r.getFirstGroupIntentObjectProperties(),{isALevelGroupObject:s,objectAsString:a,objectLength:l}=o||{},c=r.getObjectToDispTextMap(),d=r.getPredicates(),u=i.filter(e=>UWA.is(e.synthesis));if(!u.length)return null;const p=[];p.getFirstLevelChildren=function(){return this.filter(e=>0===e.level)},p.getChildren=function(e=null,t=!0){return e?this.filter(n=>t?n.parent===e.key:"string"==typeof n.parent&&-1!==n.parent.indexOf(e.key)):null};let g=!1;if(u.forEach(({synthesis:e})=>{const{facets:n,value:i}=e;if(i)if(Array.isArray(n)){const e=this.mergeFacetsIfAny(n,t).filter(e=>{const{sixw:t}=e,n=t.split("/").pop();return-1!==d.indexOf(n)}),i=s?e.findIndex(e=>JSON.stringify(e.object)===a):-1;(-1!==i?e.slice(i):e).forEach(e=>{const{object:n,count:i}=e;i&&p.push({key:Array.isArray(n)?n.join("/"):n,level:Array.isArray(n)?n.length-l:0,parent:Array.isArray(n)&&n.length>1?n.slice(0,n.length-1).join("/"):null,facet:e,objects:n,groupIntent:t,getLabel(){const{groupingIntent:e}=this.groupIntent||{};if(!Array.isArray(e)||!this.objects)return"";let t=c.get("string"!=typeof this.objects?JSON.stringify(this.objects):this.objects);return t||(t=Array.isArray(this.objects)&&this.objects.length?this.objects[this.objects.length-1]:""),t},getGroupIntentForExpand(){const{sixw:e,object:t,type:n}=this.facet,i=e.split("/").pop(),{groupingIntent:r}=this.groupIntent||{},o=Array.isArray(r)?r.find(e=>e.predicate===i):null,{object:s}=o||{},a=Array.isArray(s)?s.find(e=>e.object===t):null;return{groupingIntent:[{predicate:i,object:a?[a]:[{object:t,type:n}],other:!1}]}}})})}else g=!0}),g){let e=null;if(p.length){const t={};p.forEach(e=>{const{groupingIntent:n}=e.getGroupIntentForExpand();n.forEach(e=>{const{predicate:n,object:i}=e;Array.isArray(t[n])||(t[n]=[]),t[n].push(...i)})}),e=Reflect.ownKeys(t).map(e=>({predicate:e,object:t[e],other:!0}))}else t&&t.groupingIntent&&(e=UWA.clone(t.groupingIntent)).forEach(e=>e.other=!0);p.push({key:"Others",groupingIntent:e,level:0,getLabel:()=>n?n.get("eng.tagger.groups.others"):"Others",getGroupIntentForExpand(){return{groupingIntent:this.groupingIntent}}})}return p},runBulkMode:function(e,t,n,i){if("string"!=typeof e||!e.trim().length)throw new Error("invalid input");if(this.bulkOperations||(this.bulkOperations={}),!this.bulkOperations[e]){const r={method:t,resolve:n,reject:i,add:function(e){console.log("add"),this.args||(this.args=[]),this.args.push(e)},activate:function(){},run:async function(e){setProgress=(t=>{!e||"number"!=typeof t||t<10||t>90||e.publish("content-loader-indicator-progress",t)});try{const e=await this.method(this.args,setProgress);"function"==typeof this.resolve&&this.resolve(e)}catch(e){"function"==typeof this.reject&&this.reject(e)}},end(){}};this.bulkOperations[e]=r}return this.bulkOperations[e]},startBulkMode:function(e,t=null){if("string"!=typeof e||!e.trim().length)throw new Error("invalid input");if(!this.bulkOperations)return;if(!this.bulkOperations[e])return;const n=this.bulkOperations[e];n.isRunning||(t&&t.publish("content-loader-indicator-start"),n.isRunning=!0,n.activate(t),n.run(t).finally(()=>{n.end(t),delete this.bulkOperations[e],t&&t.publish("content-loader-indicator-completed")}))},sum:e=>e.reduce((e,t)=>(1e3*e+1e3*parseFloat(t))/1e3,0),generateDomUtilsIcon:function(e,t){n.generateIcon({iconName:e}).inject(t)},isNodeFromModel:function(e){return e&&e.getNodeSource()===r.NODE_SOURCE.MODEL}};return p}),define("DS/ENOXEngineer/services/XENUserSessionManager",["UWA/Core","UWA/Class","require","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/componentsHelpers/UploadViewer/UploadViewer","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineerCommonUtils/XENTracker"],function(e,t,n,i,r,o,s,a,l){"use strict";var c=null;return t.singleton({init:function(e){this._parent(e)},initialize:function(e){this.logger=e.core.logger.get("XENUserSessionManager manager initializing");var t=this;e.core.sessionManager=e.sandboxBase.sessionManager=t,this.sessionBuilderIds=e.core.settingManager.getSetting("engItemOpenSessionBuilder"),this.app=e,this._nextOpenFilter=null,this._openContext=null,this._insertMaterialContext=null,this._uploadViewer=new o({nlsManager:e.core.i18nManager,immersiveFrame:e.core.moduleHelper.viewsService.getApplicationImmersiveFrame()}),t._currentStatticMapping={},t.app.core.mediator.subscribe(s.EVENT_CONF_MODEL_UPDATED,function(e){try{var n=t.app.core.contextManager.getActiveEngItem();n&&n.getID()===e&&(n.updateUserConfigPreferences(),t.app.core.mediator.publish(s.EVENT_SYNC_VIEW_WITH_EI_MODEL),t.buildCurrentSession())}catch(e){console.error(e)}}),t.app.core.mediator.subscribe(s.EVENT_ATTR_DICO_UPDATED,function(){try{var e=t.app.core.contextManager.getActiveEngItem();e&&e.getID()&&(t.buildCurrentSession(),t.app.core.mediator.publish(s.EVENT_COLUMNS_CHANGED))}catch(e){console.error(e)}});var n=t.app.core.localStorage.getItem(s.VALUE_QUALIFIED_AS_FINAL_COMPONENT);this._showQualifiedAsFinal=s.QUALIFIED_AS_FINAL_CMD===n,t._showLeafMaterials=n===s.LEAF_MATERIALS_CMD,t._flatList=n===s.FLAT_LIST_VIEW,t._showIndentedView=!n||n===s.DIRECT_CMD,t.app.core.mediator.subscribe(s.EVENT_QUALIFIED_AS_FINAL_ITEM,function(e){e.commandId!==t.getFlatViewOption()&&t.switchToFlattenedView(e)}),this._showQuantityView=t.app.core.localStorage.getItem(s.VALUE_QUANTITY_VIEW),t.app.core.mediator.subscribe(s.EVENT_CHANGE_QUANTITY_VIEW,function(e){if(e.commandId===t.getQuantityViewOption())return;t.setQuantityViewOption(e.commandId),t.app.core.mediator.publish(s.EVENT_STRUCTURE_VIEW_CHANGED);const n=t.getCurrentViewOptions();t.app.core.contextManager.getPADDGVView().clearSort(),l.trackCommandLaunched("ChangeViewOptionsCmd",n),t.buildCurrentSession()}),this._showMFGView=t.app.core.localStorage.getItem(s.VALUE_MFG_VIEW),t.app.core.mediator.subscribe(s.EVENT_CHANGE_MFG_VIEW,function(e){if(e.isMFGView===t.shouldShowMfgView())return;t.setManufViewOption(e.isMFGView),t.app.core.mediator.publish(s.EVENT_STRUCTURE_VIEW_CHANGED);const n=t.getCurrentViewOptions();l.trackCommandLaunched("ChangeViewOptionsCmd",n),t.buildCurrentSession()}),t.app.core.mediator.subscribe(s.EVENT_EXPAND_BY_LEVEL,function(e){let n={};n[s.CONST_TARGET_LEVEL]=e,t.buildCurrentSession(n)}),t.app.core.mediator.subscribe(s.EVENT_FIND_IN_CONTEXT_LAUNCH,function(e){let n={};n[s.CONST_TARGET_LEVEL]="-1",n[s.CONST_FIND_IN_CRITERIA]=e,t.buildCurrentSession(n)}),t.app.core.mediator.subscribe(s.EVENT_TAGGER_GROUP_COLLAPSED,()=>{this.buildCurrentSession({useCollapse:!0})})},setFlatViewOption:function(e){this.app.core.localStorage.setItem(s.VALUE_QUALIFIED_AS_FINAL_COMPONENT,e),this._showQualifiedAsFinal=e===s.QUALIFIED_AS_FINAL_CMD,this._flatList=e===s.FLAT_LIST_VIEW,this._showLeafMaterials=e===s.LEAF_MATERIALS_CMD,this._showIndentedView=e===s.DIRECT_CMD},getFlatViewOption:function(){return this._showQualifiedAsFinal?s.QUALIFIED_AS_FINAL_CMD:this._flatList?s.FLAT_LIST_VIEW:this._showLeafMaterials?s.LEAF_MATERIALS_CMD:s.DIRECT_CMD},setQuantityViewOption:function(e){let t=e===s.REFERENCE_CMD;this.app.core.localStorage.setItem(s.VALUE_QUANTITY_VIEW,t),this.app.core.localStorage.setItem(s.VALUE_INSTANCE_OR_REFERENCE_CMD,e),this._showQuantityView=t},getQuantityViewOption:function(){let e=this.app.core.localStorage.getItem(s.VALUE_INSTANCE_OR_REFERENCE_CMD);return e||s.INSTANCE_CMD},setManufViewOption:function(e){this.app.core.localStorage.setItem(s.VALUE_MFG_VIEW,e),this._showMFGView=e},switchToFlattenedView:function(e){this.setFlatViewOption(e.commandId);let t=!0;switch(e.commandId){case s.FLAT_LIST_VIEW:case s.QUALIFIED_AS_FINAL_CMD:t=!1;break;case s.LEAF_MATERIALS_CMD:t=!1,this.shouldShowQuantityView()||r.notifyAlert(this.app.core.i18nManager.get("switching.to.referenceview")),this.setQuantityViewOption(s.REFERENCE_CMD)}const n=this.getCurrentViewOptions();l.trackCommandLaunched("ChangeViewOptionsCmd",n),this.buildCurrentSession(),this.app.core.mediator.publish(s.EVENT_STRUCTURE_VIEW_CHANGED),this.app.core.mediator.publish(s.EVENT_DISABLE_SORT_TO_DEFAULT,!t)},shareConfigSpecWithBIFilter:function(){let e=this;var t=e.app.core.contextManager.getActiveEngItem();let n=t.getPreferedAttachedConfigModel();if(n&&n.getPreferredConfiguration&&n.getPreferredVersion){e.app.core.contextManager.getXENTreeDocument().getXENBIFilterProxy().resetNGFilterUI({widgetId:e.app.core.settingManager.getWidgetId(),rootIds:t?[t.getID()]:[]});let r,o={model:{valueItem:n.getID(),labelItem:[n.getLabel()],name:[n.getLabel()]}},a=n.getPreferredConfiguration(),l=n.getPreferredVersion();a?r={PCID:a.id,context:o}:l&&(r={filterXML:`<?xml version="1.0"?><CfgFilterExpression xmlns="urn:com:dassault_systemes:config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="urn:com:dassault_systemes:config CfgFilterExpression.xsd"><FilterSelection SelectionMode="${s.CONF_150_MODE}"><TreeSeries Type="ProductState" Name="${l.name}"><Single Name="${l.name}" Revision="${l.revision}" DescId="1" /></TreeSeries></FilterSelection><Description><TreeSeries DescId="1" Revision="${l.revision}" DisplayName="${l.marketingName}" CurrentState="${l.state}"/></Description></CfgFilterExpression>`,context:o});var i={rootID:t.getID(),rootAlias:t.getDisplayName(),specification:{type:e.app.core.contextManager.getXENTreeDocument().getXENBIFilterProxy().CONFIG_FILTER,data:r},applyFilter:1,displayFilter:0};this.sessionAlreadyBuilt=!0,e.app.core.contextManager.getXENTreeDocument().getXENBIFilterProxy().setFilterSpecification(i)}},getUploadTracker:function(e){if(this._uploadViewer)return this._uploadViewer.isInjected()||this._uploadViewer.inject(widget.body),this._uploadViewer.getUploadTracker(e)},getRouterCurrentState:function(){if(!this.app||!this.app.router)return null;var t=this.app.router.getState();return t?e.extend({},t,!0):null},isItemView:function(){let e=this.getRouterCurrentState();return e&&"engItem_View"===e.name},isRecentItemViewView:function(){let e=this.getRouterCurrentState();return e&&"recents_items"===e.name},isMyENGViewView:function(){let e=this.getRouterCurrentState();return e&&"myEngItems"===e.name},buildCurrentSession:function(e){var t=e?e[s.CONST_TARGET_LEVEL]:void 0,n=e?e[s.CONST_FIND_IN_CRITERIA]:void 0,i=this.app.core.contextManager.getActiveEngItem(),r=e&&e.selectedNode?e.selectedNode:this.app.core.contextManager.getXENTreeDocument().getSelectedNodes();t&&!this.app.core.contextManager.isActiveEngItemSelected()?this.expandTheNodeOnEachLevel(this.app.core.xengTreeDoc,r,e):i&&(n?this.findinContextNode(this.app.core.xengTreeDoc,r,e):i.getContentModels().buildUserWorkingSession(e)),this.app.core.contextManager.isPreExpandEvent()&&this.app.core.contextManager.setPreExpandEvent(!1)},shouldShowFinalItems:function(){return this._showQualifiedAsFinal},shouldShowLeafMaterials:function(){return this._showLeafMaterials},shouldShowQuantityView:function(){return this._showQuantityView},shouldShowMfgView:function(){return this._showMFGView},shouldShowFlatView:function(){return this._flatList},shouldShowIndentedView:function(){return this._showIndentedView},showNotInBOM:function(){return this.app.core.PreferencesManager.showNotInBOMEnabled()},showDeformable:function(){return this.shouldShowLeafMaterials()},showMadeFrom:function(){return this.shouldShowLeafMaterials()},refreshWithDroppedFilter:function(e){var t=e[0]||null;if(t&&t.rootId){this.setNGFilterContextForNextOpen(t),this.hasValidNGFilterContext()?(this.buildCurrentSession(),this.app.core.mediator.publish(s.EVENT_UPDATE_IDCARD_RENDERING,!1)):this.consumeAvailableNGFilterContext()}},openSessionFromDroppedFilter:function(e){console.warn(e);var t=e[0]||null;if(t&&t.rootId){t&&(this.setNGFilterContextForNextOpen(t),this.hasValidNGFilterContext()?this.app.core.mediator.publish(s.EVENT_LAUNCH_COMMAND,{commandId:s.OPEN_ENG_ITEM,context:{item:{objectId:t.rootId,objectType:"VPMReference"}}}):this.consumeAvailableNGFilterContext())}},getCurrentOpenContext:function(){return this._lastOpenContext},saveCurrentOpenContext:function(e){this._lastOpenContext=e},setMaterialForInsertContext:function(e){this._insertMaterialContext=e},consummeAvailableMaterialForInsert:function(){var e=this._insertMaterialContext;return this._insertMaterialContext=null,e},setNextOpenContext:function(e){this._openContext=e},consummeAvailableOpencontext:function(){var e=this._openContext;return this._openContext=null,e},setStaticMappingAsOpenContext:function(e,t){e&&t&&(this._currentStatticMapping[e]=t)},getStaticForMappingAsOpenContext:function(e){return this._currentStatticMapping[e]},cleanStaticMappingContext:function(){this._currentStatticMapping={}},setNGFilterContextForNextOpen:function(e){this._nextOpenFilter=e},consumeAvailableNGFilterContext:function(){var e=this._nextOpenFilter;return this._nextOpenFilter=null,e},hasValidNGFilterContext:function(){return!!(this._nextOpenFilter&&this._nextOpenFilter.rootId&&this._nextOpenFilter.filter&&this._nextOpenFilter.filter.CVQuery)},isUsingIndex:function(){return"index"===this.determineAuthoringMode()},isUsingDB:function(){return"authoring"===this.determineAuthoringMode()},_getWaitingTimeBeforeSwitchToIndexMode:function(){return parseInt(widget.getValue("intervalToSwitch"))},determineCurrentModeState:function(){var e=this.determineAuthoringMode();const t=this.app.core.localStorage.getItem(s.VALUE_QUALIFIED_AS_FINAL_COMPONENT),n=this.shouldShowLeafMaterials(),i=widget.getValue(s.IS_NGFILTER_PANEL_LAUNCHED),r=this._getWaitingTimeBeforeSwitchToIndexMode();return!0===i||t===s.QUALIFIED_AS_FINAL_CMD||n?e="forceIndex":"authoring"!==e||this.app.core.settingManager.isIndexModeEnabled()?"authoring"!==e||r||(e="neverIndexMode"):e="useOnlyAuthoring",e},getFullViewLoadInfo:function(){return this.modeInformation},determineAuthoringMode:function(){if(!this.app.core.settingManager.isIndexModeEnabled())return"authoring";const t=this.app.core.PreferencesManager.readFetchingMode();if(e.is(t.state,"string")&&e.is(t.last_editing,"number")){const e=(new Date).getTime(),n=this._getWaitingTimeBeforeSwitchToIndexMode();return"index"===t.state||"authoring"===t.state&&t.last_editing+1e3*n<e&&n?"index":"authoring"}return"index"},setAuthoringMode:function(e,t){var n=this;this.isUsingIndex()&&"authoring"===e&&this._getWaitingTimeBeforeSwitchToIndexMode()&&(t||r.notifyAlert(this.app.core.i18nManager.get("disabling.index.acceleration")),n.app.core.mediator.publish(s.EVENT_INDEX_MODE_DISABLE));var i={state:e,last_editing:(new Date).getTime()};if(this.app.core.PreferencesManager.saveFetchingMode(i),n.app.core.mediator.publish(s.SWITCH_MODE,{switchMode:e}),"authoring"===e&&this._getWaitingTimeBeforeSwitchToIndexMode()){c&&clearTimeout(c);var o=this._getWaitingTimeBeforeSwitchToIndexMode()||.02;c=setTimeout(function(){r.notifyAlert(n.app.core.i18nManager.get("enabling.index.acceleration")),n.app.core.mediator.publish(s.SWITCH_MODE,{switchMode:"index"}),c=null},1e3*o)}},getCurrentViewOptions:function(){return{flat:this.shouldShowFlatView(),leaves:this.shouldShowFinalItems()||this.shouldShowLeafMaterials(),reference:this.shouldShowQuantityView()||this.shouldShowLeafMaterials(),specDoc:this.app.core.PreferencesManager.isSpecInProductStructureEnabled(),notInBom:this.app.core.PreferencesManager.showNotInBOMEnabled(),madeFrom:this.shouldShowLeafMaterials(),deformable:this.shouldShowLeafMaterials(),rep3D:this.app.core.PreferencesManager.isShow3DShapeEnabled(),manufOnly:this.shouldShowMfgView()}},buildAppropriateSession:function(e,t){l.trackCurrentView(this.getCurrentViewOptions());var n=this;return i.wrappedWithPromise(function(i,r){const o=n.consumeAvailableNGFilterContext();if(o&&(o.filterId?e.getEngineeringItem().setPersistedNGFilterContext(o):o.filter&&e.getEngineeringItem().setTransientNGFilteringContext(o.filter)),!n.app.core.Factories.CollectionsFactory.isInstanceContentModels(e))throw new Error("invalid parameter for buildAppropriateSession ");n.app.core.PreferencesManager.addToRecents(e.getEngineeringItem().getID()),e.getEngineeringItem().getNGFilterId()&&n.app.core.PreferencesManager.addToRecents(e.getEngineeringItem().getNGFilterId()),n.getAppropriateSessionBuilder(e).then(function(o){n._processSessionBuilder(o,e,t).then(i).catch(function(t){n._buildFallbackSession(e).then(i).catch(r)})}).catch(function(t){console.error(t),n._buildFallbackSession(e).then(i).catch(r)})})},_buildFallbackSession:function(e){var t=this;return i.wrappedWithPromise(function(n,i){t.getDefaultSessionBuilder(e).then(function(o){t._processSessionBuilder(o,e).then(function(e){r.warningNotif({title:t.app.core.i18nManager.get("warning.failed.toBuildAppropriate.session"),subtitle:t.app.core.i18nManager.get("warning.failed.session.buildDefault")}),n(e)}).catch(e=>{i(e)})}).catch(e=>{i(e)})})},_processSessionBuilder:function(e,t,n){var r=this;return r.setFullViewloadInfo(),i.wrappedWithPromise(function(i,o){if(!e||"function"!=typeof e.buildSession||"function"!=typeof e.retrieveAdditionalColumnProviders)throw new Error("appropriate sessionBuilder not found");r.loadAndRegisterColumnProvidersInModel(t).finally(function(){e.retrieveAdditionalColumnProviders().finally(function(){e.buildSession(n).then(i).catch(function(e){console.error(e),o("failed to build appropriate sessionBuilder")})})})})},setFullViewloadInfo:function(){var e=this.determineAuthoringMode();e="index"===e?s.CONST_INDEX:s.CONST_AUTHORING,this.modeInformation={state:e,last_refreshed:(new Date).getTime()}},_processContentFetch:function(e,t,n,r){var o=this;return i.wrappedWithPromise(function(i,s){if(!e||"function"!=typeof e.buildSession||"function"!=typeof e.retrieveAdditionalColumnProviders)throw new Error("appropriate sessionBuilder not found");o.loadAndRegisterColumnProvidersInModel(t).finally(function(){n=Array.isArray(n)?n:[n],e.retrieveAdditionalColumnProviders().finally(function(){e.registerContentfetcher(n,r)})})})},expandTheNodeOnEachLevel:function(e,t,n){var r=this;return i.wrappedWithPromise(function(i,o){r.getAppropriateSessionBuilder(e).then(function(o){r._processContentFetch(o,e,t,n).then(i).catch(function(e){})}).catch(function(e){console.error(e)})})},findinContextNode:function(e,t,n){var r=this;return i.wrappedWithPromise(function(t,i){r.getAppropriateSessionBuilder(e).then(function(i){r._processContentFetch(i,e,r.app.core.contextManager.getActiveEngItem(),n).then(t).catch(function(e){})}).catch(function(e){console.error(e)})})},getAppropriateSessionBuilder:function(e){var t=this;return i.wrappedWithPromise(function(i,r){if(!t.app.core.Factories.CollectionsFactory.isInstanceContentModels(e))throw new Error("invalid parameter for buildAppropriateSession ");var o=e.getAppropriateSessionBuilder();if(!o)throw new Error("failed to retrieve sessionBuilderId");if(!t.sessionBuilderIds[o])throw new Error(" sessionBuilderId not valid");n([t.sessionBuilderIds[o]],function(n){i(new n({appCore:t.app.core,models:e}))},r)})},getDefaultSessionBuilder:function(e){var t=this;return i.wrappedWithPromise(function(i,r){n([t.sessionBuilderIds.default],function(n){i(new n({appCore:t.app.core,models:e}))},r)})},loadAndRegisterColumnProvidersInModel:function(e){var t=this;return i.wrappedWithPromise(function(n,i){if(!e)return i("models not found :( !!");t.app.core.columnsManager.retrieveAvailableColumnProviders().then(function(t){Array.isArray(t)&&e.registerColumnsProviders(t),n(!0)}).catch(function(e){t.logger.error(e),i()})})},getSelectionMode:function(){const e=this.app.core.localStorage.getItem(s.SELECT_MODE);return e||this.app.core.settingManager.getDefaultSelectionMode()},setSelectionMode:function(e){this.app.core.localStorage.setItem(s.SELECT_MODE,e)}})}),define("DS/ENOXEngineer/components/IdCard/IdCard",["UWA/Core","UWA/Class/Model","DS/ENOXIDCard/js/IDCard","DS/ENOXEngineer/utils/Utils","DS/Utilities/Utils","DS/PlatformAPI/PlatformAPI","DS/LifecycleCmd/MaturityCmd","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/UIKIT/Tooltip","css!DS/ChangeMaturityWidget/ChangeMaturityWidget","css!DS/ENOXEngineer/components/IdCard/idCard.css"],(e,t,n,i,r,o,s,a,l,c)=>{return function(d){const u=d.getContainer();return{refreshSubscriptionEvent:null,start(){this.buildIDCardUI(d.options.models.getEngineeringItem())},buildMaturityBadge:function(){var e=this;let t=e.getMaturityContainer();if(t){e.maturityCmd=new s;let n=null;d&&d.core&&d.core.settingManager&&d.core.settingManager.getSecurityContext&&d.core.settingManager.getSecurityContext()?n=d.core.settingManager.getSecurityContext():!n&&widget&&widget.getValue&&widget.getValue("SC")&&(n=widget.getValue("SC"));let i={SecurityContext:n};e.maturityCmd.executeCompactViewAsync(widget,t,i,e.myModel.id).then(function(){console.log("Maturity  updated :"+e.maturityCmd.changeMaturityWidget)}),e._addResizeEventToContainer(t)}},buildAlternateField:function(e,t,n){e.innerHTML="",t[0].value==a.CONST_YES?e.addClassName(d.core.settingManager.getIdCardSetting(a.IDCARD_DISPLAY_ATTRIBUTES)[n].className):e.innerHTML=t[0].value},buildSpecDocField:function(e,t,n){e.innerHTML="",t[0].value>0?e.addClassName(d.core.settingManager.getIdCardSetting(a.IDCARD_DISPLAY_ATTRIBUTES)[n].className):e.innerHTML=t[0].value},buildMEIColumnField:function(t,n){t.innerHTML="";var r=e.createElement("div",{class:"icons"});let o=n[0].icons;if(o instanceof Object){for(let e in o.icon)i.generateDomUtilsIcon(o.icon[e],r);t.innerHTML=r.outerHTML}},buildLockField:function(e,t,n){e.innerHTML="","FALSE"===t[0].value?e.addClassName(d.core.settingManager.getIdCardSetting(a.IDCARD_DISPLAY_ATTRIBUTES)[n].unlock):t[0].lockedBy==d.core.settingManager.getUserName()?e.addClassName(d.core.settingManager.getIdCardSetting(a.IDCARD_DISPLAY_ATTRIBUTES)[n].key):e.addClassName(d.core.settingManager.getIdCardSetting(a.IDCARD_DISPLAY_ATTRIBUTES)[n].lock)},buildIDCardAttributeFields:function(){for(let e in this.getIdCardDisplayPref()){e="ds6w:reserved"==e?"lock":e;let t=this.getAttributeContainer(e);if(t){let n=this.myModel.get("attributes").filter(t=>t.id==e);switch(e){case"Alternate":this.buildAlternateField(t,n,e);break;case"v6_specdoc_to":this.buildSpecDocField(t,n,e);break;case"MEIColumn":this.buildMEIColumnField(t,n);break;case"lock":this.buildLockField(t,n,"ds6w:reserved")}this._addResizeEventToContainer(t)}}},getAttributeContainer:function(e){var t,n;let i=this.myModel.get("attributes").filter(t=>t.id==e);i.length>0&&(i[0].displayWhenMinified?(t=u.getElements("#"+e)[0],n=u.getElements("#"+e)[1]):n=u.getElements("#"+e)[0]);let r=u.querySelector(".xapp-id-card-container");return r&&r.hasClassName("minified")?t:n},getMaturityContainer:function(){var e,t;let n=this.myModel.get("attributes").filter(e=>"maturity"==e.id&&e.displayWhenMinified);n&&n.length>0?(e=u.getElements("#maturity")[0],t=u.getElements("#maturity")[1]):t=u.getElements("#maturity")[0];let i=u.querySelector(".xapp-id-card-container");return i&&i.hasClassName("minified")?e:t},getDiscriptionText(t){let n=d.i18nManager.get("no_description_text");return t.getDescription()&&t.getDescription().length>1&&(n=t.getDescription()),e.String.escapeHTML(n)},getDisplayAttributesOf(e){let t=[];for(var n in this.getIdCardDisplayPref())t.push(this.getDisplayAttributeValue(this.getIdCardDisplayPref()[n],e));return t},getDisplayAttributeValue(e,t){if(e){let n={},r=t.getAttributeValue(e.id),o=d.i18nManager.get(e.id),s=e.displayWhenMinified;switch(e.id){case"ds6w:status":return{name:o,id:"maturity",value:"",displayWhenMinified:s};case"ds6w:reserved":let l=t.getAttributeValue("ds6w:reservedBy"),c="";return{name:o,id:"lock",value:r,tooltipValue:c="FALSE"==r?d.core.i18nManager.get("notLocked")+"\n"+d.core.i18nManager.get("clickToLock"):d.core.i18nManager.get("lockedBy").replace("{user}",l)+"\n"+d.core.i18nManager.get("clickToUnlock"),lockedBy:l,displayWhenMinified:s};case"ds6wg:PLMReference.V_isLastVersion":return{name:o,id:"isLastVersion",icon:"true"==r.toLowerCase()?d.core.settingManager.getIdCardSetting(a.IDCARD_DISPLAY_ATTRIBUTES)[e.id].checkClassName:d.core.settingManager.getIdCardSetting(a.IDCARD_DISPLAY_ATTRIBUTES)[e.id].closeClassName,displayWhenMinified:s,tooltipIcon:r};case"ds6w:created":case"ds6w:modified":return{name:o,value:i.getDGVformatedDate(r),type:"type-text",displayWhenMinified:s};case"ds6wg:EnterpriseExtension.V_PartNumber":case"ds6w:responsible":return(n={...d.core.settingManager.getIdCardSetting(a.IDCARD_DISPLAY_ATTRIBUTES)[e.id]}).name=o,n.value=r||d.i18nManager.get("None"),n.displayWhenMinified=s,n;case"MEIColumn":return(n={...d.core.settingManager.getIdCardSetting(a.IDCARD_DISPLAY_ATTRIBUTES)[e.id]}).name=o,n.value="#loading#"==r||"#queued#"==r?d.i18nManager.get("loading"):r?r.tooltip:"",n.icons=r,n.displayWhenMinified=s,n;default:if(d.core.settingManager.getIdCardSetting(a.IDCARD_DISPLAY_ATTRIBUTES)[e.id])return(n={...d.core.settingManager.getIdCardSetting(a.IDCARD_DISPLAY_ATTRIBUTES)[e.id]}).name=o,n.displayWhenMinified=s,n.value="#loading#"==r||"#queued#"==r?d.i18nManager.get("loading"):r&&" "!=r||"Deformable"==e.id?r:d.i18nManager.get("None"),n;let u=d.core.dicoService.getAttributeMetas(e.id)?d.core.dicoService.getAttributeMetas(e.id).kind:"";if(u&&-1!==["datetime","timestamp"].indexOf(u.toLowerCase())){const n=t.getAttributeValue(e.id);r=i.convertDateNodeValueToCellValue(n),r=i.getDGVformatedDate(r)}return{name:o,value:r,type:"type-text",displayWhenMinified:s}}}},getSerializedContent(){const e=d&&d.options&&d.options.models?d.options.models.getEngineeringItem():null;return e?i.prepareDragData([e],e.getContentModels().getBIFilter()):""},buildIDCardUI(e){const i=this;d.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.UPDATE_WIDGET_TITLE,context:{label:e.getLabel()}}),d.options.models.loadAChunk([e]).then(function(){d.publish(a.EVENT_UPDATE_IDCARD_RENDERING)});const s=d.options.physicalId,p=i.getDiscriptionText(e),g=d.core.sessionManager.determineCurrentModeState(),h={name:e.getTitleForIdcard(),model:null,id:s,label:e.getTitleForIdcard(),version:e.getReferenceVersionForIDCard(),versionModel:e.getVersionOfModelVersion(),configuration:e.getConfigurationDisplayName(),modelVersion:e.getModelVersionForIDCard(),ngfilter:e.getFilterForIdcard(),thumbnail:e.getThumbnail(),modelEvents:d.getApplicationBroker(),titleText:e.getTitleForIdcard()+e.getReferenceVersionForIDCard(),withHomeButton:!0,withInformationButton:!0,withGenericButton:!0,withToggleMinifiedButton:!0,minified:d.core.PersistencyManager.isIDCardMinified(),showBackButton:d.core.viewState.isChildView(),freezones:[`<p>${p}</p>`],attributes:i.getDisplayAttributesOf(e),customEvents:{homeIconClick:{event:a.EVENT_IDCARD_CUSTOM_SHOW_LANDING},expandCollapseIconClick:{event:a.EVENT_IDCARD_CUSTOM_WP_TOGGLE_EVENT},informationIconClick:{event:a.EVENT_IDCARD_CUSTOM_INFORMATION_ICON},indexDbIconClick:{event:a.EVENT_IDCARD_CUSTOM_GENERIC_ICON},configurationLabelClick:{event:a.EVENT_IDCARD_CUSTOM_SHOW_CONFIGURATION},ngfilterLabelClick:{event:a.EVENT_IDCARD_CUSTOM_SHOW_NGFILTER},modelVersionLabelClick:{event:a.EVENT_IDCARD_CUSTOM_SHOW_MODELVERSION},versionLabelClick:{event:a.EVENT_IDCARD_CUSTOM_SHOW_VERSION_EXPLORER},versionModelLabelClick:{event:a.EVENT_IDCARD_CUSTOM_SHOW_VERSION_EXPLORER},actionsMenuClick:{event:a.EVENT_IDCARD_CUSTOM_OPEN_ACTIONS_MENU},backIconClick:{event:a.EVENT_GO_BACK}}};i.myModel=new t(h),d.emptyContainer(),i.idcard=new n({model:i.myModel}),i.idcard.render().inject(u),i.idcard.attachResizeSensor(),d.publish(a.EVENT_IDCARD_READY),d.registerDnDManager({sandbox:d,container:u,draggable:!0,getSerializedContent:i.getSerializedContent.bind(i),droppable:!0,dropStrategy:"OPEN",onDrop:i.onValidDrop.bind(i)});var m=u.getElement(".generic-icon");m&&("index"===g?m.addClassName("fonticon fonticon-database-refresh"):"authoring"===g?(m.addClassName("fonticon fonticon-database-hourglass"),m.addClassName("hoverGlass")):"neverIndexMode"===g?(m.addClassName("fonticon fonticon-database"),m.addClassName("hoverGlass")):"useOnlyAuthoring"===g?(m.addClassName("fonticon fonticon-database"),m.addClassName("hoverGlass"),m.addClassName("disable")):"forceIndex"===g&&(m.addClassName("fonticon fonticon-database-refresh"),m.addClassName("disable")),i.setIndexDbIconTooltip(m)),d.subscribe(a.EVENT_MODIFIED_REFERENCES,t=>{t&&Array.isArray(t.references)&&t.references.findIndex(e=>e.physicalid===s)>-1&&(i.refreshIdCardProvidedColumns(e,t.dataIndex),i.refreshIdCard(!0))}),d.subscribe(a.EVENT_UPDATE_IDCARD_RENDERING,t=>{i.refreshIdCardProvidedColumns(e),i.refreshIdCard(t)}),d.subscribe(a.EVENT_ATTR_DICO_UPDATED,e=>{i.refreshIdCard(e)}),d.subscribe(a.EVENT_SYNC_VIEW_WITH_EI_MODEL,()=>{i.refreshIdCard()}),d.subscribe(a.EVENT_SYNC_MATURITY_WITH_MODEL,()=>{i.buildMaturityBadge(),i.buildIDCardAttributeFields()}),i.refreshSubscriptionEvent=o.subscribe("DS/PADUtils/PADCommandProxy/refresh",t=>{let n=!1;t.data.authored&&t.data.authored.modified&&(t.data.authored.modified.forEach(e=>{s!==e&&s!==e.physicalid||(n=!0)}),n&&(i.refreshIdCardProvidedColumns(e),i.refreshIdCard(!0)))});const f=u.querySelector(".xapp-id-card-container .fonticon-open-down");d.subscribe(a.EVENT_IDCARD_CUSTOM_OPEN_ACTIONS_MENU,()=>{d.core.commandManager.renderIdCardMenu(f.getBoundingClientRect())}),d.subscribe(a.EVENT_IDCARD_CUSTOM_INFORMATION_ICON,()=>{d.core.isPropertyPanelVisibilty||d.publish(a.EVENT_INFO_PANEL_VISIBLE),d.publish(a.EVENT_TRIPTYCH_TOGGLE_PANEL,"right")}),d.subscribe(a.EVENT_IDCARD_CUSTOM_GENERIC_ICON,e=>{const t=u.querySelector(".generic-icon");t&&(t.hasClassName("fonticon-database-refresh")?(d.core.sessionManager.setAuthoringMode("authoring",!0),widget.appMediator.publish(a.EVENT_REFRESH_APP_CONTENT)):(t.hasClassName("fonticon-database-hourglass")||t.hasClassName("fonticon-database"))&&d.core.sessionManager.setAuthoringMode("index"))}),d.subscribe(a.SWITCH_MODE,e=>{switchMode=e.switchMode;const t=d.core.sessionManager.determineCurrentModeState();switchMode&&("forceIndex"===t&&"index"===switchMode?i.forceIndexModeIcon():"authoring"===switchMode&&"neverIndexMode"===t?this.setNeverIndexModeIcon():"authoring"===switchMode?this.setAuthoringModeIcon():this.setIndexModeIcon())}),d.subscribe(a.EVENT_IDCARD_CUSTOM_SHOW_CONFIGURATION,()=>{!e.isConfigured()||e.hasValidConfigContext()?d.core.mediator.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.SET_PROD_CONF_CMD,context:{item:e}}):l.errorAlert(d.i18nManager.get("error.detachOrAddVersion.toModel"))}),d.subscribe(a.EVENT_IDCARD_CUSTOM_SHOW_NGFILTER,()=>{(e.hasValidTransientNextGenFilter()||e.hasPesistencyManagerdNGFilter())&&d.core.mediator.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.LAUNCH_NG_FILTER_CMD,context:{}})}),d.subscribe(a.EVENT_IDCARD_CUSTOM_SHOW_MODELVERSION,()=>{d.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.EDIT_CONF_CONTEXT_CMD,context:{item:e}})}),d.subscribe(a.EVENT_IDCARD_CUSTOM_SHOW_VERSION_EXPLORER,()=>{var t=e;if(e.isConfigured()){if(!e.hasValidConfigContext())return void l.errorAlert(d.i18nManager.get("error.detachOrAddVersion.toModel"));t=e.getPreferedAttachedConfigModel()}d.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.SHOW_HISTORY_CMD,context:{item:t}})}),d.subscribe(a.EVENT_IDCARD_ATTRIBUTES_CLICKED,r.debounce(t=>{i.onClickIdCardAttribute(t.attributeName,e)},10)),i.freezoneTooltip=new c({target:u.getElement(".lower-main-section").getChildren()[1],trigger:"hover touch",body:i.getDiscriptionText(e)}),i.buildMaturityBadge(),i.buildIDCardAttributeFields()},onValidDrop(e){if(Array.isArray(e)&&e.length>0){const t=e[0],n=t.objectId;d.options.models.getBIFilter().removeRoot(n),d.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.OPEN_ENG_ITEM,context:{item:{objectId:t.objectId,objectType:t.objectType,biProxyCtx:t.biProxyCtx}}})}},setAuthoringModeIcon(){let e=u.querySelector(".generic-icon");null!==e&&(e.classList.remove("fonticon-database-refresh"),e.classList.remove("fonticon-database"),e.classList.remove("disable"),e.classList.add("fonticon-database-hourglass"),e.classList.add("hoverGlass"))},setIndexModeIcon(){let e=u.querySelector(".generic-icon");null!==e&&(e.classList.remove("fonticon-database-hourglass"),e.classList.remove("hoverGlass"),e.classList.remove("fonticon-database"),e.classList.remove("disable"),e.classList.add("fonticon-database-refresh"))},setNeverIndexModeIcon(){let e=u.querySelector(".generic-icon");null!==e&&(e.classList.remove("fonticon-database-hourglass"),e.classList.remove("fonticon-database-refresh"),e.classList.remove("disable"),e.classList.add("fonticon-database"),e.classList.add("hoverGlass"))},forceIndexModeIcon(){let e=u.querySelector(".generic-icon");null!==e&&(e.classList.remove("fonticon-database-hourglass"),e.classList.remove("hoverGlass"),e.classList.remove("fonticon-database"),e.classList.add("fonticon-database-refresh"),e.classList.add("disable"))},updateIndexDBTooltip(){let e="";const t=d.core.sessionManager.determineCurrentModeState(),n=d.core.sessionManager.determineAuthoringMode();let i,r=(new Date).getTime()-d.core.sessionManager.getFullViewLoadInfo().last_refreshed;if(r>=6e4)var o=Math.abs(Math.round(r/6e4));else var s=Math.abs(Math.round(r/1e3));const l=a.CONST_INDEX===d.core.sessionManager.getFullViewLoadInfo().state?d.i18nManager.get("mode_Index"):d.i18nManager.get("mode_Authoring");return r=void 0!==o?o:s,"index"!==t&&"forceIndex"!==t||"authoring"===n?"authoring"===n&&"neverIndexMode"===t?(i=void 0!==o?d.i18nManager.get("never_use_index_minute"):d.i18nManager.get("never_use_index_seconds"),o&&o>1&&(i=d.i18nManager.get("never_use_index_minutes")),e=d.i18nManager.replace(i,{time:r})):"authoring"===n&&"useOnlyAuthoring"===t?(i=void 0!==o?d.i18nManager.get("never_use_index_minute"):d.i18nManager.get("never_use_index_seconds"),o&&o>1&&(i=d.i18nManager.get("never_use_index_minutes")),e=d.i18nManager.replace(i,{time:r})):"authoring"===n&&(i=void 0!==o?d.i18nManager.get("authoring_mode_minute"):d.i18nManager.get("authoring_mode_seconds"),o&&o>1&&(i=d.i18nManager.get("authoring_mode_minutes")),e=d.i18nManager.replace(i,{time:r,mode:l,indexTime:widget.getValue("intervalToSwitch")/60})):(i=void 0!==o?d.i18nManager.get("index_mode_minute"):d.i18nManager.get("index_mode_seconds"),o&&o>1&&(i=d.i18nManager.get("index_mode_minutes")),e=d.i18nManager.replace(i,{time:r,mode:l})),e},setIndexDbIconTooltip(e){const t=this;e.onmouseover=function(e){this.title=t.updateIndexDBTooltip()}},refreshIdCard(e){const t=this;e?d.options.models.getEngineeringItem().syncModel().then(()=>{t.updateIDCard(d.options.models.getEngineeringItem())}).catch(e=>{console.error(e)}):t.updateIDCard(d.options.models.getEngineeringItem())},updateIDCard(e){d.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.UPDATE_WIDGET_TITLE,context:{label:e.getTitleForIdcard()}}),this.myModel.set("name",e.getTitleForIdcard()),this.myModel.set("label",e.getTitleForIdcard()),this.myModel.set("version",e.getReferenceVersionForIDCard()),this.myModel.set("versionModel",e.getVersionOfModelVersion()),this.myModel.set("configuration",e.getConfigurationDisplayName()),this.myModel.set("ngfilter",e.getFilterForIdcard()),this.myModel.set("modelVersion",e.getModelVersionForIDCard()),this.myModel.set("thumbnail",e.getThumbnail()),this.myModel.set("minified",d.core.PersistencyManager.isIDCardMinified());const t=this.getDiscriptionText(e);this.myModel.set("freezones",[`<p>${t}</p>`]),this.myModel.set("attributes",this.getDisplayAttributesOf(e)),this.buildMaturityBadge(),this.buildIDCardAttributeFields(),this.freezoneTooltip.setBody(t)},stop(){o.unsubscribe(this.refreshSubscriptionEvent),this.idcard&&this.idcard.destroy(),d.emptyContainer(),d.publish(a.EVENT_SET_ACTIVE_ENG_ITEM,null),d.stop(this)},_addResizeEventToContainer:function(e){var t=this;e.addEvent("resize",function(){t.idcard.resize()})},onClickIdCardAttribute:function(e,t){const n={"ds6w:responsible":d.i18nManager.get("ds6w:responsible"),"ds6wg:EnterpriseExtension.V_PartNumber":d.i18nManager.get("ds6wg:EnterpriseExtension.V_PartNumber"),"ds6w:reserved":d.i18nManager.get("ds6w:reserved"),ConfigurationContext:d.i18nManager.get("ConfigurationContext"),v6_specdoc_to:d.i18nManager.get("v6_specdoc_to"),Alternate:d.i18nManager.get("Alternate"),CoveringMaterial:d.i18nManager.get("CoveringMaterial"),CoreMaterial:d.i18nManager.get("CoreMaterial"),Manufacturing:d.i18nManager.get("Manufacturing"),MadeFrom:d.i18nManager.get("MadeFrom"),Deformable:d.i18nManager.get("Deformable"),MEIColumn:d.i18nManager.get("MEIColumn")};let i=Object.keys(n).find(t=>n[t]===e);i&&(d.core.settingManager.getIdCardSetting(a.IDCARD_DISPLAY_ATTRIBUTES)[i].openFacet&&t.unselectAll(),this.eventLaunchFromIDCard(i,t))},eventLaunchFromIDCard:function(e,t){let n=t,i=d.core.settingManager.getIdCardSetting(a.IDCARD_DISPLAY_ATTRIBUTES)[e].commandId;"Deformable"==e&&t&&t.options&&t.options.grid&&t.options.grid[a.CONST_DS6W_DEFORMABLE]&&(n={objectId:t.options.grid[a.CONST_DS6W_DEFORMABLE],objectType:t.getType(),itemListModel:t}),"ds6w:reserved"==e&&(i=t.options.grid["ds6w:reserved"]&&"FALSE"!==t.options.grid["ds6w:reserved"]?"UnreserveHdr":"ReserveHdr"),d.publish(a.EVENT_LAUNCH_COMMAND,{commandId:i,context:{item:n}})},refreshIdCardProvidedColumns:function(e,t){let n=t?[t]:Object.keys(this.getIdCardDisplayPref()).filter(e=>d.core.settingManager.getIdCardSetting(a.COLUMN_PROVIDER_REFERENCE_ATTRIBUTES).includes(e));d.options.models.fillAttributesAsync4VisibleNodes([e],!0,n,"visible")},getIdCardDisplayPref:function(){return d.core.dicoService.getIdCardPreferences()?d.core.dicoService.getIdCardPreferences():d.core.settingManager.getIdCardSetting(a.DEFAULT_IDCARD_DISPLAY_ATTRIBUTES)}}}}),define("DS/ENOXEngineer/services/XENDicoService",["UWA/Core","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/XENHttpClient","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOX3DSpaceAttributesMgt/services/predicatesServices","DS/ENOX3DSpaceAttributesMgt/services/fetchClassificationServices","text!DS/ENOXEngineer/assets/config/ColumnsMetas.json"],function(e,t,n,i,r,o,s,a,l){"use strict";var c=null;return{initialize:function(e){c=e;var n=this;this.logger=c.core.logger.get("XENDicoService"),this.logger.info(" initializing Xeng Dictionary services"),e.core.dicoService=this,this._typeHierarchies=[];let i=[];var r=this.loadListOfParametricalAttributes();i.push(r),c.optionalStartupPromises.push(r),this.mappingCusto6WAttributes={},this.mappingMultiValuatedAttributes=[],this.mappingRangeValueAttributes=[],this.mappingTerminalAttributes={},this.managedAppColumns=null,this.mappingPredicates=c.core.settingManager.getSetting("mappingPredicates");var s=this.loadListOfExtensionAttributes();c.optionalStartupPromises.push(s),this.mapppingClassificationAttributes=[],c.optionalStartupPromises.push(this.loadClassificationAttributesMapping()),n.localDico={kindOfEngItem:{},kindOfFilter:{},kindOfDocument:{},kindOfMaterial:{},kindOfDrawing:{},kindOf3DShape:{},unsupportedTypes:{}},c.core.settingManager.getSetting("acceptedTypeOnDropForOpen").forEach(function(e){n.localDico.kindOfEngItem[e]=[e]}),c.core.settingManager.getSetting("NextGenFilterTypes").forEach(function(e){n.localDico.kindOfFilter[e]=[e]}),c.core.settingManager.getSetting("acceptedDocumentsRoots").forEach(function(e){n.localDico.kindOfDocument[e]=[e]}),c.core.settingManager.getSetting("acceptedMaterialRoots").forEach(function(e){n.localDico.kindOfMaterial[e]=[e]}),c.core.settingManager.getSetting("acceptedDrawingRoots").forEach(function(e){n.localDico.kindOfDrawing[e]=[e]}),c.core.settingManager.getSetting("accepted3DShapeRoots").forEach(function(e){n.localDico.kindOf3DShape[e]=[e]}),this.userDicoPreferences=this.getDefaultAttributes(),n.paramAttributes={},c.core.mediator.subscribe("ENXViews/AttributesCustomization/columnModification",function(e){n._columnsModificationListener(e)}),c.core.mediator.subscribe(o.EVENT_IDCARD_CUSTOMIZE_ATTRIBUTES_MODIFICATION,function(e){n.updateAttributeDicoWithNoSessionRebuild({selectedTypes:n.userDicoPreferences.selectedTypes,selectedExtensions:n.userDicoPreferences.selectedExtensions,columns:n.userDicoPreferences.columns,customViewsInfo:n.userDicoPreferences.customViewsInfo,customizeHeaderAttributes:e[o.CUSTOMIZE_HEADER_ATTRIBUTES]})});let a=this.loadDimensionsWithUnits();return i.push(a),t.all(i)},_columnsModificationListener:function(e){if(e&&e.what)switch(this.cacheDataIndex&&(this.cacheDataIndex={}),e.what){case"close":this._updateUserPreferences(e);break;case"addRemoveColumns":break;case"reset":this._resetToDefaultValue();break;case"visibilityColumn":case"changeTitle":break;case"exportColumn":case"pinChange":default:console.warn("column modification intent is not handle "+e.what)}},isSavedFilter:function(e){return!!e&&-1!==c.core.settingManager.getSetting("NextGenFilterTypes").indexOf(e)},getAvailableAttributesByTypeV2Adapter:function(e){var t=[];if(Array.isArray(e)&&"Document"!==e[0])t=this.getVisibleAttrForBO().map(function(e){return{type:e.kind,attrName:e.ds6w,sixWTag:e.ds6w,attrNls:e.text}});else{var n=this.getBasicsAttributes(e);t=n=Array.isArray(n)?n:[]}return t.sort(function(e,t){return e.attrNls.localeCompare(t.attrNls)}),t},getAttributeMetas:function(e){return this.getAvailableAttributeWithNls().find(function(t){return t.dataIndex===e})},isKnownAttributeByDataIndex:function(e){if("ds6w:label"===e)return!0;if(this.cacheDataIndex||(this.cacheDataIndex={}),void 0!==this.cacheDataIndex[e]&&null!==this.cacheDataIndex[e])return this.cacheDataIndex[e];{let t=this.getBOAndRelTagsWithRequired().some(function(t){return t===e});this.cacheDataIndex[e]=t}return this.cacheDataIndex[e]},getBOAndRelTagsWithRequired:function(){return this._mergeArrayWithoutDup(this.getTagsForBOWithMandatories(),this.getTagsForRelWithMandatories().map(function(e){return"physicalid"!==e?e+"-Instance":e}))},getTagsForBOWithMandatories:function(){var e=c.core.settingManager.getSetting("mandatorySixwForBO");let t=c.core.PreferencesManager&&c.core.PreferencesManager.getTerminalItem&&c.core.PreferencesManager.getTerminalItem()?c.core.PreferencesManager.getTerminalItem():null;return t&&t!=o.FINAL_ITEMS_DEFAULT&&Array.isArray(e)&&e.push(t),this._mergeArrayWithoutDup(e,this.getVisibleTagsForBO())},getTagsForRelWithMandatories:function(){var e=c.core.settingManager.getSetting("mandatorySixwForRel");return this._mergeArrayWithoutDup(e,this.getVisibleTagsForRel())},_mergeArrayWithoutDup:function(e,t){Array.isArray(e)&&Array.isArray(t)||console.error("invalid inputs");var n=e.slice();return t.forEach(function(e){-1===n.indexOf(e)&&n.push(e)}),n},getAvailableAttributeWithNls:function(){return(this.getAvailableAttributes()||[]).map(function(e){const t=e.ds6w?c.core.i18nManager.get(e.ds6w):e.ds6w;return{...e,text:t}})},getVisibleTagsForBO:function(){return this.getVisibleAttrForBO().map(function(e){return e.ds6w})},getVisibleTagsForRel:function(){return this.getVisibleAttrForRel().map(function(e){return e.ds6w})},isAttributeManagedByApp(e){const{dataIndex:t}=e||{};return-1!==["level","occurence","Thumbnail","rollup","quantity"].findIndex(e=>e===t)},isRelAttribute(e){const{ds6wFrom:t}=e||{};return"string"==typeof t&&"rel"===t},getVisibleAttrForBO:function(){return this.getVisibleAttributes().filter(e=>!this.isRelAttribute(e)&&!this.isAttributeManagedByApp(e))},getVisibleAttrForKindOfType:function(e=o.KIND_OF.ENGITEM){const t=`kindOf${e}`;if(!Reflect.has(this.localDico,t)||!this.localDico[t])return[];const n=this.localDico[t],i=new Set;Reflect.ownKeys(n).forEach(e=>{Array.isArray(n[e])&&n[e].forEach(e=>i.add(e))});const r=[];return i.forEach(e=>{this.mappingPredicates[e]&&r.push(...Reflect.ownKeys(this.mappingPredicates[e]))}),this.getVisibleAttrForBO().filter(e=>{const{dataIndex:t}=e;return!t||"tree"===t||-1!==r.indexOf(t)})},getVisibleAttrForRel:function(){return this.getVisibleAttributes().filter(e=>this.isRelAttribute(e)&&!this.isAttributeManagedByApp(e))},getVisibleAttributes:function(){return this.getAvailableAttributeWithNls().filter(function(e){return e.visibleFlag})},getAvailableAttributes:function(){return(this.getUserDicoPreferences()?this.getUserDicoPreferences().columns:[]).filter(function(e){return e.ds6w&&!e.isAdditionalColumn})},getAdditionalColumnMetaAttributes:function(){return(this.getUserDicoPreferences()?this.getUserDicoPreferences().columns:[]).filter(function(e){return e.isAdditionalColumn})},getLoadedTypes(){return this.localDico},getSelectedTypes:function(){return this.getUserDicoPreferences()?this.getUserDicoPreferences().selectedTypes:[]},getSelectedExtensions:function(){return this.getUserDicoPreferences()?this.getUserDicoPreferences().selectedExtensions:[]},getUserDicoPreferences:function(){return this.userDicoPreferences},getBaseReferenceTypes:function(){return c.core.settingManager.getSetting("baseReferenceTypes")},getBaseDocumentTypes:function(){return c.core.settingManager.getSetting("baseDocumentTypes")},getBaseExtensions:function(){var e=c.core.settingManager.getSetting("baseExtentions");return e.forEach(function(e){e.nlsName=c.core.i18nManager.get(e.ds6w)}),e},getBaseInstanceTypes:function(){return c.core.settingManager.getSetting("baseInstanceTypes")},_resetToDefaultValue:function(){let e=this.getDefaultAttributes();e[o.CUSTOMIZE_HEADER_ATTRIBUTES]=this.getCustomizeHeaderAttributesOnReset(),this.updateAttributeDico(e)},isValidAttributeDBName:function(e){var t=e?e.split("."):null;return!(!t||2!==t.length)},isAPredicate:function(e){if(!e)return!1;const t=e.split(":");return!(!t||!Array.isArray(t)||2!==t.length)},isAGeneratedPredicate:function(e){return s.isAGeneratedPredicate(e)},isAClassificationPredicate:function(e){if("string"!=typeof e||!e.trim().length)return!1;const t=this.getControlledAppPredicates();if(-1!==Reflect.ownKeys(t).indexOf(e))return!1;let n=!1;try{n=-1!==this.mapppingClassificationAttributes.reduce((e,t)=>{const{properties:n}=t;return Array.isArray(n)?(n.forEach(t=>e.push(t.curi)),e):e},[]).indexOf(e)}catch(e){return!1}return n},_updateUserPreferences:function(e){const{selectedExtensions:t,selectedAttributes:n}=e,i=n.map(e=>{const{attrSelectable:n}=e;let i=n;if(this.isAPredicate(i)){const e=this.getAttributeNameFromPredicate("VPMReference",i);if(Array.isArray(e)&&1===e.length){const{Owner:r,Name:o}=e[0];n?i=n:r&&o&&(i=`${r}.${o}`,-1===t.indexOf(r)&&t.push(r))}}const r={dataIndex:e.dataIndex,ds6w:e.ds6w,kind:e.kind,dbName:i,visibleFlag:e.attrVisible},{attrNature:o,attrUserAccess:s,attrRangeValue:a,attrEditable:l}=e;return o&&(r.nature=o),s&&(r.userAccess=s),"boolean"==typeof l&&(r.editable=l),a&&(r.rangeValues=a),e.ds6wFrom&&(r.ds6wFrom=e.ds6wFrom,r.description=c.core.i18nManager.replace(c.core.i18nManager.get("tooltip_Instance_Column"),{label:e.text})),e.isAdditionalColumn&&e.provider&&(r.isAdditionalColumn=e.isAdditionalColumn,r.provider=e.provider),e.customisation&&e.customisation.layout&&Object.keys(e.customisation.layout).length>0&&(e.customisation.layout.canBeGroup||delete e.customisation.layout.canBeGroup,r.customisation=e.customisation),e.attrDim&&e.attrDim.length>0&&(r.attrDim=e.attrDim,e.attrUnit&&e.attrUnit.length>0&&(r.attrUnit=e.attrUnit)),r});if(e&&i&&t&&e.selectedTypes){const n=this.userDicoPreferences?this.userDicoPreferences:void 0,r=n&&n.customViewsInfo?n.customViewsInfo:void 0;this.userDicoPreferences={selectedTypes:e.selectedTypes,selectedExtensions:t,columns:i,customViewsInfo:r,customizeHeaderAttributes:this._updateIdCardPreferences(i)},this.updateAttributeDico(this.userDicoPreferences),this.updateClassificationAttributesMapping()}},getDefaultAttributes:function(){return{selectedTypes:c.core.settingManager.getSetting("defaultSelectedTypes"),selectedExtensions:c.core.settingManager.getSetting("defaultSelectedExtensions"),columns:c.core.settingManager.getSetting("defaultAttributes"),customViewsInfo:{},customizeHeaderAttributes:this.getIdCardPreferences()}},setCustoInfoToUser:function(e){return this.userDicoPreferences.customViewsInfo=e,e.newColumnPinnedInfo.forEach(e=>{for(let t in this.userDicoPreferences.columns)if(this.userDicoPreferences.columns[t].text==e.text){this.userDicoPreferences.columns[t].pinned=e.pinned?e.pinned:this.userDicoPreferences.columns[t].pinned;break}}),this.updateAttributeDicoWithNoSessionRebuild(this.userDicoPreferences)},getAttributeDefinition:function(e,t){return e&&t?this.getAttributeMetas(t):null},getAttributesForFinalItems:function(e){var t=this.getParametricalAttributesOf(e),n={};n[o.FINAL_ITEMS_DEFAULT]=c.core.i18nManager.get("eng.export.NotSelectedFinalItem");for(var i=0;i<t.length;i++){var r=t[i];c.core.settingManager.getSetting("endItemSupportedAttributeTypes").indexOf(r.type)>=0&&!r.isReadOnly&&(n[r.sixWTag]=r.attrNls)}return n},getParametricalAttributesOf:function(e){var t=this.paramAttributes[e];return t=Array.isArray(t)?t:[]},getBasicsAttributes:function(e){return c.core.settingManager.getSetting("basicsAttributes")[e].map(function(e){return{type:e.type,attrName:e.name,sixWTag:e.name,attrNls:c.core.i18nManager.get(e.name)}})},getAvailableAttributesByType:function(e){var t=this.getBasicsAttributes(e);t=Array.isArray(t)?t:[];var n=this.getParametricalAttributesOf(e),i=t.concat(Array.isArray(n)?n:[]);return i.sort(function(e,t){return e.attrNls.localeCompare(t.attrNls)}),i},loadListOfParametricalAttributes:function(){var e=this;return this._retrieveXENColumnsPromise?this._retrieveXENColumnsPromise:t.wrappedWithCancellablePromise(function(t,n){e._retrieveXENColumnsPromise=e.retrieveXENColumns().catch(()=>{}).finally(function(){t(!0)})})},loadListOfExtensionAttributes:function(){var e=this;return this._retrieveDicoCusto?this._retrieveDicoCusto:t.wrappedWithCancellablePromise(function(t,n){e._retrieveExtAttrPromise=e.retrieveDicoCusto().catch(e=>{}).finally(function(){t(!0)})})},updateClassificationAttributesMapping:function(){const e=a.syncFetchPropertiesForClassificationClass();Array.isArray(e)&&e.length&&(this.mapppingClassificationAttributes=e)},loadClassificationAttributesMapping:async function(){try{this.mapppingClassificationAttributes=await a.fetchPropertiesForClassificationClass(c.core)}catch(e){this.mapppingClassificationAttributes=[]}},retrieveDicoCusto:function(){var e=this;return t.wrappedWithCancellablePromise(function(t,i){var r=c.core.settingManager.getCommand("dictionary_custo"),o=Object.assign({},r);o.url=o.url.replace("{displayAttributes}","true"),n.perform(o).then(function(n){e._storeCustoAttributesDico(n),e._completeMappingPredicateWithDico(n),t(n)}).catch(function(e){console.error(e),i(e)})})},retrieveXENColumns:function(){var e=this;return t.wrappedWithCancellablePromise(function(t,i){var r=c.core.settingManager.getCommand("get_xen_columns"),o=Object.assign({},r);o.url=o.url.replace("{lang}",c.core.settingManager.getLanguage()),n.perform(o).then(function(n){n&&Array.isArray(n.VPMReference)&&(n.VPMReference=e._buildAuthorizedValuesArray(n.VPMReference)),e._storeTypeParamAttributes(n),t(n)}).catch(function(e){console.error(e),i(e)})})},_storeCustoAttributesDico:function(e){var t={};if(e&&e.Dictionary&&e.Dictionary.Interfaces){var n=e.Dictionary.Interfaces;for(var i in n){var r=n[i].Attributes;if(r)for(var o in r){const e=r[o].SixWPredicate;e&&(t[e]?t[e].push(r[o]):t[e]=[r[o]])}}}this.custoDictionary=e,this.mappingCusto6WAttributes=t},_storeAutomaticExtensionAttributes:function(e){var t=[];e&&e.results&&Array.isArray(e.results)&&e.results.forEach(function(e){e.name;var n=e.interfaces;n&&Array.isArray(n)&&n.forEach(function(e){var n=e.name;if(!(!e.automatic||"Yes"!==e.automatic)){var i=e.attributes;i&&Array.isArray(i)&&i.forEach(function(e){var i=e.name;t.push({attrName:n+"."+i,name:i})})}})}),this.autoExtAttributes=t},_storeTypeParamAttributes:function(e){this.paramAttributes=e},_buildAuthorizedValuesArray:function(e){return e.map(function(e){return e.authorizedValues=e.authorizedValues?e.authorizedValues.split(","):[],e.attrName&&(e.alphaNumAttrName=e.attrName.replace(/[^a-zA-Z0-9 ]/g,"")),e})},getCustomAttribute:function(e){return this.getParametricalAttributesOf("VPMReference").find(function(t){return e===t.sixWTag})},getAttributesInfoFromPredicate:function(e){return this.mappingCusto6WAttributes[e]},getAttributeInfosFromInternalName:function(e){var t=this.getParametricalAttributesOf("VPMReference").find(function(t){var n=t.attrName?t.attrName.split("."):[],i=n.length>1?n[1]:null;return i&&e===i});return t||this.autoExtAttributes.find(function(t){return e===t.name})},getMetaTypes:function(e,n){var i=this;return t.wrappedWithPromise(function(t,r){if(!Array.isArray(e))throw new Error("invalid input");var o=c.core.settingManager.getSetting("acceptedTypeForPropertiesAsInstance"),s=new Array(e.length);i.getRootTypes(e).then(function(e){for(var i=0;i<e.length;i++){var r=e[i];-1!==o.indexOf(r)?s[i]=n?"relationship":"businessobject":s[i]="businessobject"}return t(s)})})},getRootTypes:function(e){var n=this;return t.wrappedWithPromise(function(t,i){if(!Array.isArray(e))throw new Error("invalid input");var r=n._getUnknownTypes(e),o=new Array(e.length);if(0===r.length)return n._fillRootsFromDico(e,o),t(o);n.getUnknownTypesHierarchy(r).finally(function(){return n._fillRootsFromDico(e,o),t(o)})})},areBOMContentTypes:function(e,n){var i=this;return t.wrappedWithPromise(function(t,r){if(!Array.isArray(e))throw new Error("invalid input");var o=i._getUnknownTypes(e);if(0===o.length){for(var s=0;s<e.length;s++)if(i._isInUnsupportedTypes(e[s])){var a=n?n[e[s]]:e[s];return r([a])}return t(!0)}i.getUnknownTypesHierarchy(o).finally(function(){for(var o=0;o<e.length;o++)if(i._isInUnsupportedTypes(e[o])){var s=n?n[e[o]]:e[o];return r([s])}return t(!0)})})},_fillRootsFromDico:function(e,t){for(var n=Object.keys(this.localDico),i=0;i<e.length;i++){for(var r=!1,o=0;o<n.length;o++){var s=n[o];if(s.startsWith("kindOf")){var a=this._getBelongingRootFromKindOf(e[i],this.localDico[s]);if(a){t[i]=a;r=!0;break}}}r||(t[i]=null)}},syncIsAnEngineeringItem:function(e){return this._getBelongingRootFromKindOf(e,this.localDico.kindOfEngItem)},syncIsAFilter:function(e){return this._getBelongingRootFromKindOf(e,this.localDico.kindOfFilter)},syncIsADocument:function(e){return this._getBelongingRootFromKindOf(e,this.localDico.kindOfDocument)},syncIsAMaterial:function(e){return this._getBelongingRootFromKindOf(e,this.localDico.kindOfMaterial)},syncIsADrawing:function(e){return this._getBelongingRootFromKindOf(e,this.localDico.kindOfDrawing)},syncIsA3DShape:function(e){return this._getBelongingRootFromKindOf(e,this.localDico.kindOf3DShape)},syncIsARawMaterial:function(e){return null!==this._getBelongingRootFromKindOf(e,this.localDico.kindOfEngItem,o.TYPE_RAW_MATERIAL)},areEngeeringItems:function(e,t){return this.areA(e,this.localDico.kindOfEngItem,t)},areDocuments:function(e,t){return this.areA(e,this.localDico.kindOfDocument,t)},areDrawings:function(e,t){return this.areA(e,this.localDico.kindOfDrawing,t)},areA:function(e,n,i){var r=this;return t.wrappedWithPromise(function(t,o){if(!Array.isArray(e))throw new Error("invalid input");for(var s=!0,a=[],l=0;l<e.length;l++){var c=e[l];if(!r._getBelongingRootFromKindOf(c,n)||r._isInUnsupportedTypes(c)){s=!1;var d=i?i[c]:c;a.push(d);break}}if(s)return t(!0);var u=r._getUnknownTypes(e);if(0===u.length)return o(a);r.getUnknownTypesHierarchy(u).finally(function(){for(var e=0;e<u.length;e++){var s=u[e];if(!r._getBelongingRootFromKindOf(s,n)){var a=i?i[s]:s;return o([a])}}t(!0)})})},_getUnknownTypes:function(e){var t=[],n=this;return e.forEach(function(e){n._getBelongingRootFromKindOf(e,n.localDico.kindOfEngItem)||n._getBelongingRootFromKindOf(e,n.localDico.kindOfDocument)||n._getBelongingRootFromKindOf(e,n.localDico.kindOfMaterial)||n._getBelongingRootFromKindOf(e,n.localDico.kindOfDrawing)||n._getBelongingRootFromKindOf(e,n.localDico.kindOf3DShape)||n._isInUnsupportedTypes(e)||t.push(e)}),t},_isInUnsupportedTypes:function(e){return!!this.localDico.unsupportedTypes[e]},_applyTypeClassif:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var n=e[t],i=this._findMatchInHierarchy(this.localDico.kindOfEngItem,n);if(i)this.localDico.kindOfEngItem[i].push(n.type);else{var r=this._findMatchInHierarchy(this.localDico.kindOfDocument,n);if(r)if(-1==c.core.settingManager.getSetting("unSupportedDocumentsRoots").indexOf(n.type)){this.localDico.kindOfDocument[r].push(n.type);continue}var o=this._findMatchInHierarchy(this.localDico.kindOf3DShape,n);if(o)this.localDico.kindOf3DShape[o].push(n.type);else{var s=this._findMatchInHierarchy(this.localDico.kindOfDrawing,n);s?this.localDico.kindOfDrawing[s].push(n.type):this.localDico.unsupportedTypes[n.type]=!0}}}else this.logger.error(" _applyTypeClassif called with invalid input")},_findMatchInHierarchy:function(e,t){for(var n=Object.keys(e),i=0;i<n.length;i++)if(-1!==t.hierarchy.indexOf(n[i]))return n[i];return null},_getBelongingRootFromKindOf:function(e,t,n=null){for(var i=Object.keys(t),r=0;r<i.length;r++)if((!n||i[r]===n)&&-1!==t[i[r]].indexOf(e))return i[r];return null},getUnknownTypesHierarchy:function(e){var i=this;return t.wrappedWithCancellablePromise(function(t,r){if(!Array.isArray(e))throw new Error("invalid input");var o={types:e},s=c.core.settingManager.getCommand("gettypeshierarchy");n.perform(s,o).then(function(e){i._applyTypeClassif(e.types_hierarchies),t(e)}).catch(function(e){r(e)})})},getTypeHierarchy:function(e){var i=this;return t.wrappedWithCancellablePromise(function(t,r){let o={};if(o=i._typeHierarchies.find(function(t){return e===t.type}))return void t(o);let s={types:[e]};var a=c.core.settingManager.getCommand("gettypeshierarchy");n.perform(a,s).then(function(e){i._typeHierarchies.push(e.types_hierarchies[0]),t(e.types_hierarchies[0])}).catch(function(n){t({type:e,hierarchy:[]})})})},_completeMappingPredicateForTypes:function(e,t){if(Array.isArray(e)&&t){var n=this;for(let i in t){let r=t[i].SixWPredicate;const s=t[i].Owner,a=t[i].Name,l=s?`${s}.${a}`:a;r||(r=`ds6wg:${l}`),r&&e.forEach(e=>{n.mappingPredicates[e]||(n.mappingPredicates[e]={}),n.mappingPredicates[e][r]?(Array.isArray(n.mappingPredicates[e][r])||(n.mappingPredicates[e][r]=[n.mappingPredicates[e][r]]),n.mappingPredicates[e][r].push(l)):n.mappingPredicates[e][r]=l,t[i].ds6w=r,o.CONST_YES===t[i].MultiValuated&&n.mappingMultiValuatedAttributes.push(t[i]),o.CONST_YES===t[i].HasRangeDefined&&n.mappingRangeValueAttributes.push(t[i]),n._mappingTerminalItemOptionalAttributes(t[i])})}}},retreiveParentTypesAttributes:function(e,t){let n={};if(e&&t){let i=e;for(;t[i]&&t[i].Attributes&&(n=Object.assign(n,t[i].Attributes),t[i].Parent);)i=t[i].Parent}return n},_completeMappingPredicateWithDico:function(e){if(e&&e.Dictionary&&e.Dictionary.Interfaces){const t=e.Dictionary.Interfaces;for(let e in t){const n=t[e].ScopeTypes?t[e].ScopeTypes:t[e].ScopeRelationships;let i=this.retreiveParentTypesAttributes(e,t);this._completeMappingPredicateForTypes(n,i)}const n=e.Dictionary.Types;for(let e in n){let t=this.retreiveParentTypesAttributes(e,n);this._completeMappingPredicateForTypes([e],t)}const i=e.Dictionary.Relationships;for(let e in i){let t=this.retreiveParentTypesAttributes(e,i);this._completeMappingPredicateForTypes([e],t)}}},getAttributeNameFromPredicate:function(e,t){const n=this.mappingPredicates[e];return n?n[t]:""},isMultiValuedAttribute:function(e){return this.getMultiValuedAtributes().find(function(t){return e===t.ds6w})},getMultiValuedAtributes:function(){return this.mappingMultiValuatedAttributes},getRangeValueAttribute(e){if("string"!=typeof e||!e.trim().length)return null;const t=this.getRangeValueAttributes().filter(t=>e===t.ds6w),n=this.getClassificationAttributes(this.filterRangeClassicationAttribute.bind(this)).find(t=>t.curi===e);if(n){const e="http://www.w3.org/2001/XMLSchema#",i=n.dataType&&n.dataType.startsWith(e)?n.dataType.substring(e.length):"";t.push({ds6w:n.curi,HasRangeDefined:"Yes",AuthorizedValues:n.rangeValues.map(e=>e.value),type:i})}if(t.length){const n=t.reduce((e,t)=>(e.type=t.type||t.Type,e.AuthorizedValues.push(...t.AuthorizedValues),e),{AuthorizedValues:[]});return{ds6w:e,HasRangeDefined:"Yes",AuthorizedValues:[...new Set(n.AuthorizedValues)],type:n.type.toLowerCase()}}return null},getRangeValueAttributes:function(){return this.mappingRangeValueAttributes||[]},filterRangeClassicationAttribute:function(e){return e&&Array.isArray(e.rangeValues)},getClassificationAttributes:function(e){let t=[];return this.mapppingClassificationAttributes.forEach(n=>{const{properties:i}=n;Array.isArray(i)&&("function"==typeof e?t=i.filter(e):t.push(...i))}),t},getTerminalAttributesInfo:function(e){return this.mappingTerminalAttributes[e]?this.mappingTerminalAttributes[e]:this.getAttributeMetas(e)&&!["ds6w:reserved","ds6wg:PLMReference.V_isLastVersion"].includes(e)?this.getAttributeMetas(e):c.core.settingManager.getSetting("defaultAttributes").find(function(t){let n="tree"===t.dataIndex?"ds6w:label":t.dataIndex;return e===n?t:void 0})},_mappingTerminalItemOptionalAttributes:function(e){let t=e.Dimension;o.CONST_YES,e.MultiValuated;if(!t){let t=c.core.settingManager.getSetting("endItemSupportedAttributeTypes"),n=e.Type;t.includes(n)&&(this.mappingTerminalAttributes[e.ds6w]=e)}},getVisibleTerminalAttrForBO:function(){let e=this.getMappedTerminalItemAtributes(),t=c.core.settingManager.getSetting("excludeSixwForTerminalItem");return this.getVisibleAttrForBO().filter(function(n){let i=c.core.settingManager.getSetting("endItemSupportedAttributeTypes"),r=n.kind,o=n.attrDim;return(e.hasOwnProperty(n.ds6w)||!t.includes(n.ds6w))&&i.includes(r)&&!o})},getMappedTerminalItemAtributes:function(){return this.mappingTerminalAttributes},getTerminalItemAtributes:function(){let e=[{value:o.FINAL_ITEMS_DEFAULT,label:c.core.i18nManager.get("eng.export.NotSelectedFinalItem")}],t=this.getVisibleTerminalAttrForBO();return Array.isArray(t)&&t.length>0&&t.forEach(function(t){e.push({value:"tree"===t.dataIndex?"ds6w:label":t.dataIndex,label:t.text})}),e},getControlledAppPredicates:function(){if(this.managedAppColumns)return this.managedAppColumns;const{managedColumns:e}=JSON.parse(l),t=Reflect.ownKeys(e),n={};return t.map(t=>{const{options:i}=e[t],{editableFlag:r,typeRepresentation:o}=i||{};let s=t;"tree"===t&&(s="ds6w:label"),n[s]={},("string"==typeof r&&"true"===r||"boolean"==typeof r&&!0===r||"string"==typeof o&&"url"===o)&&(n[s].userAccess="ReadWrite")}),this.managedAppColumns={...n,"ds6w:modified":{},"ds6w:created":{},"ds6w:reservedBy":{},"ds6w:type":{},"ds6w:identifier":{},"ds6w:project":{},"ds6w:organizationResponsible":{},"ds6w:organizationResponsible-Instance":{},"ds6w:project-Instance":{},"ds6w:kind":{},"ds6w:kind-Instance":{},"ds6w:library":{},"ds6w:folder":{},"ds6w:bookmarks":{},"ds6w:libraries":{},"ds6w:description":{userAccess:"ReadWrite"},"ds6w:description-Instance":{userAccess:"ReadWrite"},"ds6wg:PLMReference.V_versionComment":{userAccess:"ReadWrite"},"ds6w:globalType":{ignored:!0},"ds6wg:MaterialUsageExtension.DeclaredQuantity":{ignored:!0}},this.managedAppColumns},getCustomizeHeaderAttributesOnReset:function(){let e=this.getIdCardPreferences(),t=this._getDefaultVisibleAttributes();for(let n in e)t.includes(n)||delete e[n];return e},_getDefaultVisibleAttributes:function(){let e=c.core.settingManager.getSetting("defaultAttributes"),t=[];for(let n=0;n<e.length;n++)e[n].visibleFlag&&t.push(e[n].ds6w);return t},getIdCardPreferences:function(){return this.getUserDicoPreferences()&&this.getUserDicoPreferences()[o.CUSTOMIZE_HEADER_ATTRIBUTES]?this.getUserDicoPreferences()[o.CUSTOMIZE_HEADER_ATTRIBUTES]:c.core.settingManager.getIdCardSetting(o.DEFAULT_IDCARD_DISPLAY_ATTRIBUTES)},_updateIdCardPreferences:function(e){let t=this.getIdCardPreferences(),n=this._getVisibleAttributeTags(e);if(t){let e=Object.keys(t);for(let i=0;i<e.length;i++)n.includes(e[i])||delete t[e[i]]}return t},_getVisibleAttributeTags:function(e){let t=[];for(let n=0;n<e.length;n++)e[n].visibleFlag&&t.push(e[n].ds6w);return t},getColumnsNLSFromSelectables:function(e){const t=this.getUserDicoPreferences()?this.getUserDicoPreferences().columns.reduce((e,t)=>(e[t.ds6w]=t.text,e),{}):{};return e.map(e=>t[e]||e)},updateAttributeDicoWithNoSessionRebuild:function(e){this.userDicoPreferences=e,c.core.PreferencesManager&&c.core.PreferencesManager.saveCurrentAttrDico()},updateAttributeDico:function(e){this.setAttributeDico(e),c.core.PreferencesManager&&c.core.PreferencesManager.saveCurrentAttrDico()},setAttributeDico:function(e){e&&e.columns&&e.selectedExtensions&&e.selectedTypes&&(this.userDicoPreferences=e,c.core.i18nManager.warmupNLS().then(()=>{c.core.mediator.publish(o.EVENT_ATTR_DICO_UPDATED)}))},loadDimensionsWithUnits:function(){return this.loadDimensionPromise?this.loadDimensionPromise:(this.dimensions=c.core.settingManager.getSetting("defaultDimensions"),this.loadDimensionPromise=t.wrappedWithCancellablePromise((e,t)=>{c.core.dataService.fetchDimensionsWithUnits().then(t=>{const n=t.results||[];o.DIMENSION_VOLUME,o.DIMENSION_MASS,o.DIMENSION_AREA,o.DIMENSION_LENGTH;return this.dimensions=n.reduce((e,t)=>(e[t.Name]=t,e),{}),e(this.dimensions)}).catch(t=>(this.dimensions=c.core.settingManager.getSetting("defaultDimensions"),e()))}),this.loadDimensionPromise)},getDimension:function(e){if(!this.dimensions||"object"!=typeof this.dimensions)return null;if(!this.dimensions[e])throw new Error("Unknown dimension");return this.dimensions[e]},getDimensionLabel:function(e){return this.getDimension(e).NLS},getMKSUnitName:function(e){const t=this.getDimension(e);if(t&&"object"==typeof t)return t.MKSUnit},getUnits:function(e){const t=this.getDimension(e);return t&&"object"==typeof t&&Array.isArray(t.Units)?t.Units:[]},getUnit:function(e,t){return this.getUnits(e).find(e=>e.Name===t)},getVisibleAdditionalColumnReferenceAttributes:function(){return this.getAdditionalColumnMetaAttributes().filter(e=>e.visibleFlag&&c.core.settingManager.getIdCardSetting(o.COLUMN_PROVIDER_REFERENCE_ATTRIBUTES).includes(e.dataIndex))}}}),define("DS/ENOXEngineer/utils/Search",["UWA/Core","UWA/Utils/InterCom","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/services/EngineeringSettings","DS/ENOXEngineerInfra/Mediator","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n,i,r,o){"use strict";var s=function(n){this.socketName="search_socket_"+(new Date).getTime(),this.socket=new t.Socket(this.socketName,{dispatchRetryInterval:5}),this.socket.subscribeServer("SearchComServer"),this.listener=this.objectsSelected.bind(this),this.socket.addListener("Selected_Objects_search",this.listener);var i=this;this.socket.addListener("onCloseTransient",function(e){i.socket.dispatchEvent("UnregisterContext",{widget_id:widget.id}),r.prototype.publish(o.EVENT_CLOSE_RUNNING_CMD)}),i.defaultOptions=n,i.defaultOptions={multiSel:!0,source:["3dspace"]},e.extend(i.defaultOptions,n||{})};return s.prototype.options=function(e,t,r,o,s,a,l,c){var d={};d.title=e,d.mode="furtive",d.app_socket_id=this.socketName,d.widget_id=widget.id;const u=!(!a||""===a.trim());return d.default_with_precond=u,d.multiSel=s,d.source=this.defaultOptions.source||[],d.tenant=i.getPlatformId(),d.role=r,Array.isArray(t)&&(d.precond=n.buildFlattenedTaxonomiesForSearch(t,c)),a&&d.precond&&(d.precond="("+d.precond+" AND "+a+")"),o&&""!==o.trim()&&(d.default_search_criteria=o),l&&(d.columns=l),d},s.prototype.destroy=function(){var e={};e.widget_id=widget.id,this.socket.dispatchEvent("UnregisterContext",e),this.socket.unsubscribeServer("SearchComServer"),this.socket.removeListener("Selected_Objects_search",this.listener),this.socket.removeListener("clearSearch",this.clearListener),this.socket.disconnect(),delete this.socket},s.prototype.activate=function(e,t,n,i,r,o,s,a,l){var c=this.options(e,t,n,i,r,o,s,a);UWA.is(l,"function")||(c.mode="default"),this.callback=l,this.socket.dispatchEvent("UnregisterContext",{widget_id:widget.id}),this.socket.dispatchEvent("RegisterContext",c),this.socket.dispatchEvent("InContextSearch",c)},s.prototype.isAvailable=function(){return UWA.is(this.socket)},s.prototype.launchASearch=function(e){this.isAvailable()&&(void 0!==e.multiSel&&null!==e.multiSel||(e.multiSel=this.defaultOptions.multiSel||!0),this.activate(e.title||"",e.allowedTypes||"VPMReference",e.role||"",n.getAugmenttedQueryForSearch(e.criteria),e.multiSel,e.precondition,e.columns,e.notAllowedTypes,function(t){e.in_apps_callback(t)}))},s.prototype.objectsSelected=function(e){this.callback&&this.callback(e)},s.prototype.clearOnCancel=function(e){this.socket.dispatchEvent("UnregisterContext",{widget_id:widget.id})},s}),define("DS/ENOXEngineer/services/EngineeringDataProvider",["UWA/Core","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/XENHttpClient","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/utils/Search","DS/ENOXEngineer/services/XEngLocalStorage","DS/ENOXEngineer/utils/ResponseParser","DS/DocumentManagement/DocumentManagement","DS/PlatformAPI/PlatformAPI","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/utils/MaturityUtils","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/ExpandPayloadFactory","DS/ENOXEngineerCommonUtils/expand/ExpandErrorManager"],function(e,t,n,i,r,o,s,a,l,c,d,u,p,g,h){"use strict";var m=null;const f=e=>e===p.COMMAND_WS_EXPAND_CV_V2||e===p.COMMAND_WS_EXPAND_CV,E=e=>e===p.COMMAND_WS_MULTIEXPAND_V2||e===p.COMMAND_WS_EXPAND_CV_V2,C=e=>!(!e||!e.physicalId&&!e.paths);return function(){return{initialize:function(e){m=e,this.DOC_REL_NAME=p.SPECIFICATION_DOCUMENT,this.logger=m.core.logger.get("EngineeringDataProvider"),this.logger.info(" initializing Xeng Data provider"),e.sandboxBase.dataService=this,e.core.dataService=this,e.core.dataService.searchManager=new r({multiSel:!1}),e.sandboxBase.localStorage=e.core.localStorage=o},getCommandSettings:function(){var e=m.core.settingManager.getCommand("get_command_settings");return n.perform(e)},dimensionsUnitsConverter:function(e){return t.wrappedWithCancellablePromise(function(t,i){if(!Array.isArray(e))throw new Error("invalid  input");var r=m.core.settingManager.getCommand("convertValues");n.perform(r,e).then(function(e){t(e)}).catch(function(e){console.error(e),i(e)})})},setQuantityOnMaterial:function(e){return t.wrappedWithCancellablePromise(function(t,i){var r=m.core.settingManager.getCommand("setQuantity");n.perform(r,e).then(function(e){m.core.sessionManager.setAuthoringMode("authoring"),t(e)}).catch(function(e){console.error(e),i(e)})})},modifyQuantityOnMaterial:function(e){return t.wrappedWithCancellablePromise(function(t,i){var r=m.core.settingManager.getCommand("modifyQuantity");n.perform(r,e).then(function(e){m.core.sessionManager.setAuthoringMode("authoring"),t(e)}).catch(function(e){console.error(e),i(e)})})},getStatesAttributes:function(e){this.logger.info(" call of getStatesAttributes ");var i=this;if(!Array.isArray(e))return;i.existingPolicies||(i.existingPolicies=[]);let r=e.filter(e=>-1==i.existingPolicies.indexOf(e));if(!(r.length<1)){var o={policies:r};return t.wrappedWithCancellablePromise(function(e,t){var s=m.core.settingManager.getCommand("getStatesAttributes");n.perform(s,o).then(function(t){i.existingPolicies.push(...r),u.addCSSMaturityClasses(o.policies,"wux-controls-label",t),e(t)}).catch(function(e){console.log(e),t(e)})})}},getConfigSettings:function(){return Array.isArray(this.configSettings)?this.configSettings:[]},loadConfigurationSettings:function(){var e=this;return t.wrappedWithCancellablePromise(function(t,i){if(!m.core.settingManager.isConfigRoleGranted())return i("user.not.granted.config");if(e.configSettingsIsLoaded)return t(e.getConfigSettings());var r=m.core.settingManager.getCommand("getConfigSettings");n.perform(r,{version:"1.0",settings:["DecoupleVariantEvolution","StaticMappingActivation","xRevisionActivation"]}).then(function(n){e.configSettingsIsLoaded=!0,Array.isArray(n.settings)&&(e.configSettings=n.settings),t(n)}).catch(function(e){i(e)})})},getCurrentUserRecentsItems:function(){this.logger.info(" call of getCurrentUserRecentsItems");var e=this;return t.wrappedWithCancellablePromise(function(t,n){m.core.PreferencesManager.readRecents().then(function(i){e.recentsCache=i,e.logger.info(" stringPids : "+i),i&&i.length>0?e.getEngItemsData(i.split(",").filter(function(e){return e&&e.trim().length>0}),!1,!0).then(function(e){t(e)}).catch(function(e){n(e)}):t(null)}).catch(function(e){n(e)})})},getEngItemConfigurationInfo:function(e){if(this.logger.info(" call of getEngItemConfigurationInfo "),!e.pid)throw new Error("pid is a mandatory parameter");var i=m.core.settingManager.getCommand("getConfiguredObjectInfo"),r=Object.assign({},i);return r.url=r.url.replace("{pid}",e.pid),t.wrappedWithCancellablePromise(function(e,t){n.perform(r).then(function(t){r=null,e(m.core.Factories.configItemsFactory.getModelsFromConfigInfo(t))}).catch(function(e){console.log(e),t(e)})})},getUserEvolutionViewPref:function(){try{return widget.getValue(p.USER_EVOLUTION_PREF)||p.CONF_OFFICIAL_VIEW}catch(e){return p.CONF_OFFICIAL_VIEW}},setUserEvolutionViewPref:function(e){try{widget.setValue(p.USER_EVOLUTION_PREF,e)}catch(e){this.logger.error(" fail to set evolution filter preference ")}},getUserWorkUnderEvolDlgPref:function(){try{return widget.getValue(p.USER_WORKUNDER_EVOL_PREF)}catch(e){return null}},getUserWorkUnderShowPref:function(){try{return widget.getValue(p.CHANGECONTROL_SHOW_STATE)}catch(e){return null}},getUserWorkUnderPositionPref:function(){try{return widget.getValue(p.CHANGECONTROL_POSITION)}catch(e){return null}},setUserWorkUnderEvolDlgPref:function(e){try{widget.setValue(p.USER_WORKUNDER_EVOL_PREF,e)}catch(e){this.logger.error(" fail to set work under evolution preference ")}},getModelVersionsFromModel:function(e){return t.wrappedWithCancellablePromise(function(t,i){if(!e)throw new Error("bad inputs");var r=m.core.settingManager.getCommand("modelInfo"),o=Object.assign({},r);o.url=o.url.replace("{pid}",e),n.perform(o).then(function(e){o=null,t(m.core.Factories.configItemsFactory.getModelVersionsFromModelInfo(e))}).catch(function(e){console.log(e),i(e)})})},federadedSearch:function(e){if(this.logger.info(" call of federadedSearch "),!e.query)throw new Error("query is a mandatory parameter");var t=m.core.settingManager.getCommand("fed_myEng"),i={label:m.core.settingManager.getCVRequestLabel(),nresults:e.nresults||100,order_by:"desc",order_field:"ds6w:modified",query:e.query,select_predicate:e.predicates||m.core.settingManager.getSetting("select_predicate"),select_file:["icon","thumbnail_2d"],start:"0",tenant:m.core.settingManager.getPlatformId(),with_indexing_date:!0,with_nls:!0,source:e.source||t.source};return n.perform(t,JSON.stringify(i))},fireAutocompleteSearch:function(e){var n=this,r={predicates:["ds6w:label","physicalid","ds6wg:revision"],nresults:e.nresults};Array.isArray(e.sources)&&e.sources.length>0&&(r.sources=e.sources);var o=i.getAugmenttedQueryForSearch(e.criteria);if(Array.isArray(e.targetTypes)&&e.targetTypes.length>0){for(var a='flattenedtaxonomies:"types/'+e.targetTypes[0]+'"',l=1;l<e.targetTypes.length;l++)a+=' OR flattenedtaxonomies:"types/'+e.targetTypes[l]+'"';r.query="("+a+") AND "+o}else r.query=o;return e.precond&&(r.query=e.precond+" AND "+r.query),t.wrappedWithPromise(function(e,t){n.federadedSearch(r).then(function(t){var n=s.parseFetchResult(t);e(n.results)}).catch(function(e){t(e)})})},loadModelVersionProdConf:function(e,i){return t.wrappedWithCancellablePromise(function(t,r){e&&i||r(new Error("invalid input"));var o=m.core.settingManager.getCommand("getModelPCInfos"),s=Object.assign({},o);s.url=s.url.replace("{pid}",e),s.param=s.param.replace("{prodIds}","pid:"+i),s.url=s.url+"?filteringCriteria="+UWA.Utils.encodeUrl(s.param),n.perform(s).then(function(e){return s=null,t(e)}).catch(function(e){console.error(e),r(e)})})},createVolatileFilter:function(e){return this.logger.info(" call of createVolatileFilter"),t.wrappedWithCancellablePromise(function(t,i){if(!e.isConfigured()||!e.getPreferedAttachedConfigModel())return t(null);var r=e.getPreferedAttachedConfigModel().getPreferredConfiguration();if(r&&r.id)r.FilterCompiledForm||d.warningAlert(m.core.i18nManager.get("eng.missing.filterinfo.onPC")),t({filterBinaryForExpand:r.FilterCompiledForm});else{var o=m.core.settingManager.getCommand("createVolatileFilter"),s=e.getPreferedAttachedConfigModel().buildFilterXML(),a={version:o.version,output:o.output,dictionary:{version:"0.1",id:{pid:e.getPreferedAttachedConfigModel().getID()}},expression:{version:"0.1",format:"xml",content:s}};n.perform(o,JSON.stringify(a)).then(function(e){return t(e)}).catch(function(e){console.error(e),i(e)})}})},getCurrentUserRootEng:function(){this.logger.info(" call of getCurrentUserRootEng on index");var e=this,n={query:"[flattenedtaxonomies]:types/VPMReference AND [owner]:"+m.core.settingManager.getCurrentUser().id,nresults:40};return t.wrappedWithCancellablePromise(function(t,i){e.federadedSearch(n).then(function(n){var r={serverResponse:n};if(n.infos&&0===n.infos.nhits)return t([]);e._indexFormatFetchManager(r,t,i)}).catch(function(e){i(e)})})},getUserRecentEditedEngineeringItems:function(){this.logger.info(" call of getUserRecentEditedEngineeringItems");var e=this;return t.wrappedWithCancellablePromise(function(t,n){e._getRecentAuthoredItems().then(function(e){if(Array.isArray(e)){var n=e.map(function(e){return e.getType()||"##unknown##"}),i={"##unknown##":!0},r=n.filter(function(e){return!i.hasOwnProperty(e)&&(i[e]=!0)});m.core.dicoService.areEngeeringItems(r,r).finally(function(){var n=e.filter(function(e){return m.core.dicoService.syncIsAnEngineeringItem(e.getType())||m.core.dicoService.syncIsAFilter(e.getType())});t(Array.isArray(n)?n:[])})}}).catch(n)})},_getRecentAuthoredItems:function(){this.logger.info(" call of _getRecentAuthoredItems");var e=this;return t.wrappedWithCancellablePromise(function(t,i){var r=m.core.settingManager.getCommand("fed_myEng_on_Recent"),o={delta_time_interval:r.deltaTime,version:2,with_nls:!1,label:m.core.settingManager.getCVRequestLabel(),locale:m.core.settingManager.getLanguage(),select_predicate:m.core.settingManager.getSetting("select_predicate"),select_file:["icon","thumbnail_2d"],source:r.source,specific_source_parameter:{},tenant:m.core.settingManager.getPlatformId(),nresults:r.nresults||40};n.perform(r,JSON.stringify(o)).then(function(n){if(n.infos&&0===n.infos.nhits)return t([]);e._indexFormatFetchManager({serverResponse:n},t,i)}).catch(function(e){i(e)})})},getListNodesFromPaths:function(e){var n=this;return t.wrappedWithCancellablePromise(function(t,i){if(!e||!Array.isArray(e.paths))return i("invalid input");n.partialExpands(e).then(function(n){if(e&&!0===e.isRefreshing){const g=[],h=[];n.forEach(e=>{e.isCoreMaterialType()?h.push(e):g.push(e)});var i=[];if(g.length)for(var r=e.paths.length,o=0;o<r;o++)for(var s=e.paths[o],a=s.length>0?s[s.length-1]:null,l=s.length>2?s[s.length-2]:null,c=0;c<n.length;c++){var d=n[c],u=d.getRelationID?d.getRelationID():null,p=d.getID?d.getID():null;if(u){if(u===l){i.push(d);break}}else{if(p&&p===a&&e.isFromReplace&&"reference"==e.nodesType&&d.isEngineeringItem()){if(i.push(d),JSON.stringify(d.getOccurrencePath())!==JSON.stringify(s))continue;break}if(p&&p===a){i.push(d);break}}}h.length&&h.forEach(e=>i.push(e)),t(i)}else t(n)}).catch(function(e){console.warn(e),i(e)})})},multiExpand:function(e,n){var i=this;return t.wrappedWithCancellablePromise(function(t,r){i.doExpand(e,{executor:p.COMMAND_WS_MULTIEXPAND_V2}).then(function(e){i._processExpandResponse(e,t,r,n)}).catch(function(e){r(e)})})},multiExpandForFindInContext:function(e,n){let i=this;return e.label="FindInCtxFTS-"+m.core.settingManager.getCVRequestLabel(),t.wrappedWithCancellablePromise(function(t,n){e&&i.doExpand(e,{executor:p.COMMAND_WS_MULTIEXPAND_V2}).then(t).catch(n)})},getEngItemInstances:function(e,t,n,i){return this.expand(e,t,"1",n,i)},partialExpands:function(e){var n=this;return t.wrappedWithCancellablePromise(function(t,i){if(!e||!Array.isArray(e.paths)||0===e.paths.length)return i("invalid input");n.expand(null,null,"0",null,e).then(function(e){return t(e)}).catch(i)})},multiexpandBI:function(n,i){if(e.is(n)){const e={label:m.core.settingManager.getCVRequestLabel(),synthesis_mode:"flat",union:{expand:[{expand_iter:i,root_physicalid:n,"q.iterative_filter_query_bo":this.getIterativeFilterQueryBO(),no_type_filter_rel:["XCADBaseDependency"]}]}};var r=this;return t.wrappedWithCancellablePromise(function(t,n){r.doExpand(e,{executor:p.COMMAND_WS_MULTIEXPAND_V2},new h(m),!1).then(function(e){t(e&&e.facets?e.facets:null)}).catch(function(e){n(e)})})}},getExpandPayload:function(t,n,i,r,o,s){var a=null;return e.is(t)&&(this.logger.info("call of getEngItemInstances on authoring mode = "+o),a={authored:o,include_param_Attributes:!(void 0!==r&&!r),no_type_filter_rel:["XCADBaseDependency"],"q.iterative_filter_query_bo":this.getIterativeFilterQueryBO(),level:i,intent:"XEN_attributes",source:"cstorage"},s&&s.staticMapping&&Array.isArray(s.staticMapping.path)?a.paths=[s.staticMapping.path]:a.roots=[{id:t}],m.core.sessionManager.showNotInBOM()||(a.sequence_filter=[{definition:[{type_filter_rel:["PLMInstance"],"q.query":'NOT ([ds6wg:SynchroEBOMExt.V_InEBOMUser]:"FALSE" )'}]}]),n&&!o?a.config_filter=n:n&&o&&console.log("cannot filter in authoring mode")),a},buildExpandGenericOption:function(t){if(!C(t))return null;let n={no_type_filter_rel:["XCADBaseDependency"],"q.iterative_filter_query_bo":this.getIterativeFilterQueryBO(),compute_select_bo:["thumbnail_2d","icon"],expand_iter:t.level,fcs_url_mode:"REDIRECT",select_bo:Array.isArray(t.referenceTags)?t.referenceTags:m.core.dicoService.getTagsForBOWithMandatories(),select_rel:Array.isArray(t.instanceTags)?t.instanceTags:m.core.dicoService.getTagsForRelWithMandatories(),locale:m.core.settingManager.getLanguage(),label:m.core.settingManager.getCVRequestLabel(),tenant:m.core.settingManager.getPlatformId()};if(t.configBinary&&(n.config_filter=t.configBinary),m.core.sessionManager.showNotInBOM()||(n.sequence_filter=m.core.settingManager.getSetting("sequence_filter_exclude_NotInBOM")),t.staticMapping&&Array.isArray(t.staticMapping.path)&&!f(t.executor)?n.paths=[t.staticMapping.path]:t.staticMapping&&Array.isArray(t.staticMapping.path)?n.root_path_physicalid=[t.staticMapping.path]:t.optionsToExpandOnEachLevel&&Array.isArray(t.optionsToExpandOnEachLevel.multiLevelpaths)?(n.paths=t.optionsToExpandOnEachLevel.multiLevelpaths,n.root_path_physicalid=t.optionsToExpandOnEachLevel.multiLevelpaths):Array.isArray(t.paths)&&t.paths.length>0?n.root_path_physicalid=t.paths:n.root_physicalid=t.physicalId,t.isOnAuthoring){var i=m.core.dicoService.getSelectedExtensions()||[],r=[];i.forEach(function(e){r.indexOf(e)<0&&r.push(e)});const o=function(e,t){if("string"!=typeof e||!e.trim().length||!Array.isArray(t))return;const n=m.core.dicoService.getAttributesInfoFromPredicate(e);var i;Array.isArray(n)&&n.length?n.map(e=>e.Owner).forEach(e=>{t.indexOf(e)<0&&t.push(e)}):(2===(i=e.split(":")).length&&(e=i[1]),2===(i=e.split(".")).length&&t.indexOf(i[0])<0&&t.push(i[0]))};n.select_bo.forEach(e=>o(e,r)),n.select_rel.forEach(e=>o(e,r)),n=e.extend(n,{types:m.core.dicoService.getSelectedTypes()||[],extensions:r,root_path_physicalid:[[t.physicalId]]}),Array.isArray(t.paths)&&t.paths.length>0?n.root_path_physicalid=n.paths=t.paths:t.optionsToExpandOnEachLevel&&Array.isArray(t.optionsToExpandOnEachLevel.multiLevelpaths)&&(n.root_path_physicalid=t.optionsToExpandOnEachLevel.multiLevelpaths)}return f(t.executor)&&(n.type_filter_rel=["PLMInstance"]),n},expand:function(n,i,r,o,s){var a=this;return t.wrappedWithCancellablePromise(function(t,o){if(e.is(n)||s&&Array.isArray(s.paths)&&s.paths.length>0){var l={physicalId:n,configBinary:i,level:r};l=e.extend(l,s||{}),C(l)||o("invalid input"),l.isOnAuthoring=l.isOnAuthoring?l.isOnAuthoring:m.core.sessionManager.isUsingDB(),l.executor=l.isOnAuthoring?p.COMMAND_WS_EXPAND_DB:p.COMMAND_WS_EXPAND_CV_V2,a.expandRequestExecutor(l).then(t).catch(o)}else o("invalid input")})},expandRequestExecutor:function(e,n){var i=this;return t.wrappedWithCancellablePromise(function(t,n){i.logger.info("call of expandRequestExecutor ");var r=i.buildExpandGenericOption(e);if(!r||!e.executor)return i.logger.error("invalid input: failed to build request payload"),n("invalid options");i.logger.info((e.isOnAuthoring,"Database"));var o={physicalId:e.physicalId};Array.isArray(r.paths)&&(o.pathLength=r.paths.length),e&&e.nodesType&&(o.nodesType=e.nodesType),e&&e.flattenedView&&(o.level=e.flattenedView),e&&e.isRefreshing&&(o.isRefreshing=e.isRefreshing,o.isFromReplace=e.isFromReplace,o.level=!0),i.doExpand(r,e).then(function(e){i._processExpandResponse(e,t,n,o)}).catch(function(e){n(e)})})},_processExpandResponse:function(e,t,n,i){if(!Array.isArray(e.results)||0===e.results.length)return t([]);!0===i.isRefreshing?m.core.Factories.ListItemFactory.getListNodesFromServerExpandForEdition(e,i).then(function(e){return t(e)}).catch(function(e){n(e)}):m.core.Factories.ListItemFactory.getListNodesFromServerExpand(e,i).then(function(e){return t(e)}).catch(function(e){n(e)})},getEngItemData:function(n,i){var r=this;return e.is(n)?t.wrappedWithCancellablePromise(function(e,t){if(m.core.sessionManager.isUsingDB()){const o={level:"0",paths:[[n]]};r.expandV2(o).then(n=>{if(null==n)throw new Error(m.core.i18nManager.get("error.fetch.deleted.item"));m.core.Factories.ListItemFactory.getEngItemFromServerExpandInDB(n,void 0,i).then(t=>e(t)).catch(e=>t(e))}).catch(e=>t(e))}else r.getEngItemsData([n],i).then(function(o){if(Array.isArray(o)&&0!==o.length||!m.core.sessionManager.isUsingIndex())return e(o);m.core.sessionManager.setAuthoringMode("authoring"),r.getEngItemsData([n],i).then(function(t){return e(t)}).catch(e=>t(e))}).catch(e=>t(e))}):null},getEngItemsData:function(e,i,r){var o=this;if(Array.isArray(e)){var s=m.core.sessionManager.isUsingDB();r&&(s=!1),this.logger.info("call of getEngItemData on authoring mode = "+s);var a={select_file:["icon","thumbnail_2d"],fcs_url_mode:"REDIRECT",label:m.core.settingManager.getCVRequestLabel(),physicalid:e,locale:m.core.settingManager.getLanguage(),tenant:m.core.settingManager.getPlatformId(),select_predicate:m.core.settingManager.getSetting("select_predicate")};return a.select_predicate=Array.from(new Set(a.select_predicate.concat(m.core.dicoService.getTagsForBOWithMandatories()))),t.wrappedWithCancellablePromise(function(e,t){var r=s?m.core.settingManager.getCommand("db_fetch"):m.core.settingManager.getCommand("cv_fetch");n.perform(r,a).then(function(n){var r={serverResponse:n,withconfig:i};if(n.infos&&0===n.infos.nhits)return e([]);o._indexFormatFetchManager(r,e,t)}).catch(function(e){return t(e)})})}throw new Error("pad inputs")},getStatticMappingPCInfo:function(e){if(Array.isArray(e)||!(!e.length>=1)){var i={version:"1.0",instanceIdList:e};return t.wrappedWithCancellablePromise(function(e,t){n.perform(m.core.settingManager.getCommand("get_configuration"),i).then(function(t){e(t)}).catch(function(e){return t(e)})})}d.errorAlert("fetchData need an array as input")},getModelVersionInformationFromPCID:function(e){if(Array.isArray(e)){var i=m.core.sessionManager.isUsingDB();this.logger.info("call of getEngItemData on authoring mode = "+i);var r={select_file:["icon","thumbnail_2d"],fcs_url_mode:"REDIRECT",label:m.core.settingManager.getCVRequestLabel(),physicalid:e,locale:m.core.settingManager.getLanguage(),tenant:m.core.settingManager.getPlatformId(),select_predicate:m.core.settingManager.getSetting("select_predicate_for_pc")};return t.wrappedWithCancellablePromise(function(e,t){var i=m.core.settingManager.getCommand("cv_fetch");n.perform(i,r).then(function(t){var n=s.parseFetchResult(t);e(n.results)}).catch(function(e){return t(e)})})}throw new Error("pad inputs")},fetch:function(e,i){if(Array.isArray(e)){var r={select_file:["icon","thumbnail_2d"],fcs_url_mode:"REDIRECT",label:m.core.settingManager.getCVRequestLabel(),physicalid:e,locale:m.core.settingManager.getLanguage(),tenant:m.core.settingManager.getPlatformId(),select_predicate:void 0!==i?i:[],with_synthesis_attribute:!0};return t.wrappedWithCancellablePromise(function(t,i){0===e.length&&t([]);var o=m.core.settingManager.getCommand("cv_fetch");n.perform(o,r).then(function(e){var n=s.parseFetchResult(e);t(n.results)}).catch(function(e){return i(e)})})}throw new Error("pad inputs")},_indexFormatFetchManager:function(e,t,n){if(!e||!e.serverResponse||!Array.isArray(e.serverResponse.results))return n?n("invalid input : missing serverResponse"):null;m.core.Factories.ListItemFactory.getEngItemsListFromServerFetch(e.serverResponse,e.uwaModel,e.withconfig).then(function(e){for(var n=0;n<e.length;n++)if(e[n].deleted){let t=e[n].getID();m.core.PreferencesManager.removeFromRecents([t]),e.splice(n,1),n--}return t(e)}).catch(function(e){n(e)})},getEngItemRelatedDocuments:function(e,n){var i=this,r=!1,o=t.wrappedWithCancellablePromise(function(t,o){var s={relInfo:{parentId:e,parentRelName:n||i.DOC_REL_NAME,parentDirection:"from"},tenant:m.core.settingManager.getPlatformId(),securityContext:m.core.settingManager.getSecurityContext(),tenantUrl:m.core.settingManager.getDefault3DSpaceUrl(),additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType",onComplete:function(e){if(Array.isArray(e.data))return r?t([]):void t(m.core.Factories.ListItemFactory.createListNodes(e.data,"fromDocAPI"))},onFailure:function(e){if(r)return t([]);o(e)}};a.getDocumentsFromParent(s)});return o.cancelEmbeddedRequest=function(){r=!0},o},fetchDocumentsData:function(e,t){return Array.isArray(e)?new Promise((n,i)=>{const r={getVersions:!0,relInfo:{parentRelName:t||this.DOC_REL_NAME,parentDirection:"from"},tenant:m.core.settingManager.getPlatformId(),securityContext:m.core.settingManager.getSecurityContext(),tenantUrl:m.core.settingManager.getDefault3DSpaceUrl(),onComplete:n,onFailure:i};a.getDocuments(e,r)}):Promise.reject()},async updateDocumentNodesData(e){if(!Array.isArray(e)||!e.length)return;const t=e.map(e=>e.getID());let n=null;try{n=await this.fetchDocumentsData(t)}catch(e){return void console.debug("error with fetchDocumentsData")}const{data:i}=n;if(!Array.isArray(i)||!i.length)return;const r=i.map(e=>{const{id:t,relateddata:n,dataelements:i}=e,{files:r}=n||{};let o=!1,s=!1;const a=new Set,l=new Set,c=[];return Array.isArray(r)&&(o=r.length>1,r.forEach(e=>{const{dataelements:t,relateddata:n}=e||{},{locker:r}=t||{},{image:o}=i||{},d="string"==typeof o&&o.endsWith(".gif")?WebappsUtils.getWebappsAssetUrl("ENOXEngineer","img/document.png"):o;c.push(d);let u=null;if("string"==typeof r&&r.trim().length>0){a.add(r),s||(s=!0);const{lockerInfo:e}=n||{},t=Array.isArray(e)?e.find(e=>e.dataelements.name===r):null,{dataelements:i}=t||{},{firstname:o,lastname:c}=i||{};(u=`${o} ${c}`).trim().length&&l.add(u)}})),{referenceId:t,options:{locker:a.size?[...a].join(","):null,files:r,isMultiFile:o,thumbnail:c.length?c[0]:null,checkedOut:s,e6wdocument:e,grid:{"ds6w:reserved":s?"TRUE":"FALSE","ds6w:reservedBy":l.size?[...l].join(","):null}}}});m.mediator.publish(p.EVENT_UPDATE_NODES_WITH_CHANGESETS,{changeSetObj:r,nodesToBeUpdated:e})},fetchDocumentsDataAsNodes:function(e,n){if(Array.isArray(e))return t.wrappedWithPromise((t,i)=>{this.fetchDocumentsData(e,n).then(e=>{const n=m.core.Factories.ListItemFactory.createListNodes(e.data,"fromDocAPI");t(n)}).catch(e=>{d.errorAlert(e),i(e)})});d.errorAlert("fetchDocumentsData need an array as input")},applyCoreMaterialToEngItem:function(e,i){return t.wrappedWithPromise(function(t,r){var o={references:[{engItem:e.getID(),material:i}]},s=m.core.settingManager.getCommand("apply_material");n.perform(s,JSON.stringify(o)).then(function(e){return t(e)}).catch(function(e){return r(e)})})},getCoreMaterialToEngItem:function(e){return t.wrappedWithPromise(function(t,i){var r={references:e},o=m.core.settingManager.getCommand("get_material");n.perform(o,JSON.stringify(r)).then(function(e){return t(e)}).catch(function(e){return i(e)})})},attachDocumentToEngItem:function(e,n,i,r){var o=this;return t.wrappedWithPromise(function(t,s){o.fetchDocumentsDataAsNodes([n],r).then(function(n){var l=n[0],c=[],u=[];c.push(e),u.push(e.getID());var g={relInfo:{parentId:e.getID(),parentRelName:r||o.DOC_REL_NAME,parentDirection:"from"},tenant:m.core.settingManager.getPlatformId(),additionalHeaders:m.core.settingManager.getWorkUnderHeaders(),securityContext:m.core.settingManager.getSecurityContext(),tenantUrl:m.core.settingManager.getDefault3DSpaceUrl(),onComplete:function(n){if(m.core.sessionManager.setAuthoringMode("authoring"),r?d.sucessAlert(m.core.i18nManager.get("eng.operation.insertAttachment.sucess")):d.sucessAlert(m.core.i18nManager.get("eng.operation.insertDocument.sucess")),i){l.options.instanceId=n.data[0].relateddata.parents[0].relId;var o={nodes:[l],parentId:e.getID(),selectedNodesToInsert:c,physicalIdList:u};m.mediator.publish(p.EVENT_CREATED_NODES,o)}t(l)},onFailure:function(e){d.errorAlert(e.error||JSON.stringify(e)),s(e)}};a.connectDocumentToParent(l.getID(),g)})})},_createDocument:function(e,n){return t.wrappedWithPromise(function(t,i){var r=m.core.sessionManager.getUploadTracker({fileName:e.fileInfo.fileName,fileSize:e.fileInfo.file.size}),o={tenant:m.core.settingManager.getPlatformId(),securityContext:m.core.settingManager.getSecurityContext(),additionalHeaders:m.core.settingManager.getWorkUnderHeaders(),tenantUrl:m.core.settingManager.getDefault3DSpaceUrl(),onFailure:function(e){r.onComplete(!1),d.errorAlert(e.error||JSON.stringify(e)),i(!1)},onProgress:r.onProgress,onComplete:function(e){e=e.data;for(var i=0;i<e.length;i++)var o=e[i],s={nodes:[m.core.Factories.ListItemFactory.createListNode(o,"fromDocAPI")],parentId:n};r.onComplete(!0),t(s),d.sucessAlert(m.core.i18nManager.get("eng.operation.addDocument.sucess"))}};a.createDocument(e,o)})},createDocumentOnSelectedType:function(e){let t=this.createDocumentListNode(e),n=[e.documents[0].dataelements.parentId];if(t&&t.isDocument()){let i={},r=m.core.contextManager.getActiveEngItem().getContentModels().findNodesByIds(n);i.selectedNodesToInsert=r,i.nodes=[t],i.physicalIdList=n,"SpecificationDocument"===this.DOC_REL_NAME?(m.core.sessionManager.setAuthoringMode("authoring"),m.core.mediator.publish(p.EVENT_CREATED_NODES,i)):m.core.mediator.publish(p.EVENT_NEW_ATTACHED_DOCUMENT,i),d.sucessAlert(e.notification.subtitle)}},createDocumentListNode:function(e){return m.core.Factories.ListItemFactory.createListNode(e.documents[0],"fromDocAPI")},addNewDocumentToEngItem:function(e){var t=this,n=e.relationName||t.DOC_REL_NAME;e.files?t._createDocumentsFromFiles(e.files,e.targetObjID,n):t._launchFileChooser(function(i){t._createDocumentsFromFiles(i,e.targetObjID,n)})},_createDocumentsFromFiles:function(e,t,n){if(e&&t&&n)for(var i=this,r=0;r<e.length;r++){const s=e[r];var o={fileInfo:{comments:"",file:s,fileName:s.name||"unNamed"},relInfo:{parentId:t,parentRelName:n,parentDirection:"from"}};i._createDocument(o,t).then(function(e){var t=m.core.contextManager.getActiveEngItem().getContentModels().findNodesByIds([e.parentId]);e.selectedNodesToInsert=t,e.physicalIdList=[e.parentId],m.core.contextManager.isActiveEngItemSelected()&&(n===i.DOC_REL_NAME?m.core.mediator.publish(p.EVENT_CREATED_NODES,e):m.core.mediator.publish(p.EVENT_NEW_ATTACHED_DOCUMENT,e))}).catch(e=>{console.warn("create document failed")})}},_launchFileChooser:function(e,t){var n=i.getFileInput(t);n.addEvent("change",function(t){t.preventDefault(),t.stopImmediatePropagation();var i=t.target.files.length>0?t.target.files:t.dataTransfer.files;n.removeEvent("change"),n.destroy(),e&&e(i)}),n.click()},checkinDocument:function(e){this._launchFileChooser(function(t){var n=t[0],i=n?n.name:"";i=i.replace(/\.[^/.]+$/,"");var r={tenant:m.core.settingManager.getPlatformId(),securityContext:m.core.settingManager.getSecurityContext(),additionalHeaders:m.core.settingManager.getWorkUnderHeaders(),tenantUrl:m.core.settingManager.getDefault3DSpaceUrl(),onComplete:e.onComplete,onFailure:e.onFailure},o={id:e.docId,title:i,fileInfo:{file:n}};a.modifyDocument(o,r)},!0)},downloadDocuments:function(e,t,n){this._downloadDocuments(e,function(e){d.sucessAlert(m.core.i18nManager.get("eng.operation.downloadDocument.sucess")),i.launchDownloadfromURLs(e),t&&t(e)},function(e){n&&n(e)},!1)},_downloadDocuments:function(e,t,n){if(Array.isArray(e)){var i=e.map(function(e){return e.getID()}),r={tenant:m.core.settingManager.getPlatformId(),securityContext:m.core.settingManager.getSecurityContext(),tenantUrl:m.core.settingManager.getDefault3DSpaceUrl(),additionalHeaders:m.core.settingManager.getWorkUnderHeaders(),asZip:!!(Array.isArray(i)&&i.length>1),onFailure:function(e){n(e),d.errorAlert(e.data&&e.data[0]?e.data[0].updateMessage:e)},onComplete:t};a.downloadDocuments(i,r)}},deleteDocuments:function(e,t){var n=this;e.length&&e.length>0&&e.forEach(function(e){n.deleteDocument(e,t)})},deleteDocument:function(e,t){var n=e.options.referenceId;if(n){var i={tenant:m.core.settingManager.getPlatformId(),securityContext:m.core.settingManager.getSecurityContext(),additionalHeaders:m.core.settingManager.getWorkUnderHeaders(),tenantUrl:m.core.settingManager.getDefault3DSpaceUrl(),onComplete:function(n){m.core.sessionManager.setAuthoringMode("authoring"),d.sucessAlert(m.core.i18nManager.get("eng.operation.deleteDocument.sucess")),t?t(!0):m.core.contextManager.getContext().refresh({action:"unparent",instances:[e.getRelationID()]})},onFailure:function(e){t&&t(!1),e.error,d.errorAlert(e.error)}};a.deleteDocument(n,i)}},detachDocuments:function(e,t,n,i){var r=this;e.length&&e.length>0&&e.forEach(function(e){let o;o=e.getParent()._isFromOriginalModel()&&""!==e.getParent().getID()?e.getParent():t,r.removeDocument(e,o,n,i)})},removeDocument:function(e,t,n,i){var r=e.getID(),o=this;if(r){var s={relInfo:{parentId:t.getID(),parentRelName:n||o.DOC_REL_NAME,parentDirection:"from"},tenant:m.core.settingManager.getPlatformId(),securityContext:m.core.settingManager.getSecurityContext(),additionalHeaders:m.core.settingManager.getWorkUnderHeaders(),tenantUrl:m.core.settingManager.getDefault3DSpaceUrl(),onComplete:function(t){m.core.sessionManager.setAuthoringMode("authoring"),d.sucessAlert(m.core.i18nManager.get("eng.operation.removeDocument.sucess")),i&&i(!0),n&&n!==o.DOC_REL_NAME||m.core.contextManager.getContext().refresh({action:"unparent",instances:[e.getRelationID()]})},onFailure:function(e){i&&i(!1),d.errorAlert(e.error)}};a.disconnectDocumentFromParent(r,s)}},loadElementsNLS:function(e){this.logger.info("call of loadElementsNLS");var i=m.core.settingManager.getCommand("dico_elements");return t.wrappedWithCancellablePromise(function(t,r){n.perform(i,e,{}).then(function(e){var n=sessionStorage.getItem(m.core.settingManager.getNlsStorageName());n=n?JSON.parse(n):{};for(var i=e.vocabularyElementNLSInfo,r=0;r<i.length;r++)n[i[r].curi]=i[r];return t(n)}).catch(function(e){r(e)})})},loadPredicateValues:function(e){this.logger.info(" call of loadPredicateValues");var i=m.core.settingManager.getCommand("dico_predicate_value");return t.wrappedWithCancellablePromise(function(t,r){n.perform(i,e).then(function(e){var n=m.core.settingManager.getPredicatesNlsStorageName(),i=sessionStorage.getItem(n);i=i?JSON.parse(i):{};var r=e;for(var o in r)if(i.hasOwnProperty(o))for(var s in r[o])i[o][s]=r[o][s];else i[o]=r[o];return t(i)}).catch(function(e){r(e)})})},applyWorkUnderEvolution:function(e,i,r,o,s,a,l){return t.wrappedWithPromise(function(t,d){e&&r||d(new Error("invalid input"));var u=m.core.settingManager.getCommand("workUnderEvolution"),p=u.evolutionExpression;p=(p=(p=(p=(p=p.replace(new RegExp("{modelName}","g"),i)).replace(new RegExp("{productName}","g"),o)).replace(new RegExp("{productRevision}","g"),s.replace("&","&amp;"))).replace(new RegExp("{productTitle}","g"),l.replace("&","&amp;"))).replace(new RegExp("{modelTitle}","g"),a.replace("&","&amp;"));var g={"Dictionary Contexts":e,"Evolution Expression":p};n.perform(u,JSON.stringify(g)).then(function(e){if(null!=e.ACId&&""!=e.ACId&&null!=e.XSLTExpr&&""!=e.XSLTExpr){var n=c.get();return n.evolution.id=e.ACId,n.evolution.displayExpression=e.XSLTExpr,c.setEffectivity(n),m.core.mediator.publishPlatformEvent("sessionEff",n),m.core.mediator.publishPlatformEvent("toggleActiveSE"),t(e)}return d(!0)}).catch(function(e){console.error(e),d(e)})})},retreiveSuccessAndErrorsFromEditService:function(e,t){const{results:n}=e||{};if(!Array.isArray(n)||!Array.isArray(t))return{};const i=[],r=[],o=[];return n.forEach(({body:e,status:n})=>{if(!e)return;const{physicalid:s,errors:a,oldInstancePhysicalid:l}=e,c=t.find(e=>l?e.physicalid===l:e.physicalid===s),{attributePath:d,node:u}=c;Array.isArray(a)&&a.length?r.push({physicalid:s,oldInstancePhysicalid:l,errors:a,node:u}):-1!==Reflect.ownKeys(e).findIndex(e=>-1!==e.indexOf(d))?i.push({physicalid:s,oldInstancePhysicalid:l,node:u}):o.push({physicalid:s,oldInstancePhysicalid:l,node:u})}),{success:i,issues:r,notUpdated:o}},manageResultsFromUpdateAttributes(e){const{issues:t,success:n,notUpdated:i,invalidReadOnlyAttrs:r,invalidMandatoryAttrs:o}=e||{},s=new Set,a=[];if(Array.isArray(t)&&t.length&&t.forEach(({errors:e,physicalid:t,node:n})=>{a.push(n),s.add(t),this.displayIssues(e)}),Array.isArray(i)&&i.length&&(d.errorAlert(m.core.i18nManager.get("attribute.update.none")),i.forEach(({physicalid:e,node:t})=>{a.push(t),s.add(e)})),Array.isArray(r)&&r.length&&r.forEach(({physicalid:e,node:t})=>{a.push(t),s.add(e)}),Array.isArray(o)&&o.length&&o.forEach(({physicalid:e,node:t})=>{a.push(t),s.add(e)}),Array.isArray(n)&&n.length&&(m.core.sessionManager.setAuthoringMode("authoring"),n.forEach(({physicalid:e})=>s.add(e))),a.size&&a.forEach(e=>{e.setRealAttributesConvertState(!1),e.setAttributeConvertionStarted(!1)}),s.size){const e=[...s.values()];m.core.mediator.publish(p.EVENT_REFRESH_ITEMS_BY_IDS,e)}},buildPayloadForEditService(e){if(!Array.isArray(e))return null;const t=new Map;e.forEach(({physicalid:e,attribute:n,value:i})=>{if(t.has(e)){const r=t.get(e);r.find(({attribute:e,value:t})=>e.path===n.path&&t===i)||r.push({attribute:n,value:i})}else t.set(e,[{attribute:n,value:i}])});let n=[];return t.forEach((e,t)=>{const[{attribute:i}]=e,{ds6wFrom:r,kind:o,attrDim:s,attrUnit:a}=i||{},l=e.map(({attribute:e,value:t})=>{const n={op:"replace",path:e.path,value:t};return o&&"real"===o.toLowerCase()&&s&&a&&(n.dimensionType="DSDim_"+s,n.unitName=a),n}),c="rel"===r?"rel":"bus",d=l.map(({path:e})=>`attribute[${e}]`),u={path:`model/${c}/${t}`,method:"PATCH",body:l,queryParams:{select:["physicalid","modified",...d]}};n.push(u)}),{requests:n}},getAttributesAccessRights:async function(e){try{const t=e.map(({physicalid:e})=>e),n=await this.readAttributes({lIds:t}),{results:i}=n||{};if(!Array.isArray(i))return;const r={};i.forEach(({physicalID:e,data:t})=>r[e]=t);const o={};return e.forEach(({physicalid:e,attributePath:t})=>{const n=r[e],i=n?n.find(e=>e.path===t):null;o[e]=i}),o}catch(e){return{}}},parseAttributesFromAccessRightsAnswer(e,t){if(!Array.isArray(e)||!t)return{};const n=[],i=[],r=e.filter(({physicalid:e,value:r,node:o})=>{if(!t||!t[e])return!0;const{readOnly:s,mandatory:a}=t[e];return s?(n.push({physicalid:e,node:o}),!1):!(a&&!r&&(i.push({physicalid:e,node:o}),1))});return{invalidReadOnlyAttrs:n,invalidMandatoryAttrs:i,validAttrs:r}},updateAttributes:async function(e,t){if(!Array.isArray(e))return;const i=e.filter(e=>{const{physicalid:t,attribute:n}=e||{};return t&&n&&n.path}).map(({physicalid:e,attribute:t,value:n,node:i})=>({physicalid:e,attribute:t,attributePath:t.path,value:"string"==typeof n?n.replace("\r",""):n,node:i}));"function"==typeof t&&t(30);const r=await this.getAttributesAccessRights(i),{invalidReadOnlyAttrs:o,invalidMandatoryAttrs:s,validAttrs:a}=this.parseAttributesFromAccessRightsAnswer(i,r);let l={invalidReadOnlyAttrs:o,invalidMandatoryAttrs:s};if(!a.length)throw this.manageResultsFromUpdateAttributes(l),new Error(l);const c=this.buildPayloadForEditService(a);if(!c)throw new Error("buil paylod for mcs_setTitle failed");let u=null;try{"function"==typeof t&&t(30);const e=m.core.settingManager.getCommand("mcs_setTitle");if(!(u=await n.perform(e,JSON.stringify(c))))throw new Error("invalid mcs_setTitle command answer")}catch(e){throw e.response&&"EDITPROP_ERROR_0001"===e.response.error?d.errorNotif({title:m.core.i18nManager.get("error.instanceEvolved.notEditable"),subtitle:m.core.i18nManager.get("error.instanceEvolved.UpdateFailedDueToFrozenModelConnected")}):e.response&&e.response.error&&d.errorAlert(e.response.error),e}return"function"==typeof t&&t(30),l={...l,...this.retreiveSuccessAndErrorsFromEditService(u,a)},this.manageResultsFromUpdateAttributes(l),l},updateAttribute:async function(e,i,r){let{path:o,ds6wFrom:s,kind:a,attrDim:l,attrUnit:c}=i||{};if(!e||!o)return;const u=await this.getAttributeAccessRights({physicalid:e,attributePath:o});if(u&&u.readOnly)throw d.warningAlert(m.core.i18nManager.replace(m.core.i18nManager.get("attribute.readOnly"),{attribute:u.nls})),new Error("attribute.readOnly");if(u&&u.mandatory&&!r.trim())throw d.warningAlert(m.core.i18nManager.replace(m.core.i18nManager.get("attribute.mandatory"),{attribute:u.nls})),new Error("attribute.mandatory");let g={op:"replace",path:o,value:r=r.replace("\r","")};a&&"real"===a.toLowerCase()&&l&&c&&(g.dimensionType="DSDim_"+l,g.unitName=c);var h={requests:[{path:`model/${"rel"===s?"rel":"bus"}/${e}`,method:"PATCH",body:[g],queryParams:{select:["physicalid","modified",`attribute[${o}]`]}}]};const f=i.ds6w||i.dataIndex;return m.core.dicoService.isAClassificationPredicate(f),t.wrappedWithCancellablePromise((t,i)=>{const r=m.core.settingManager.getCommand("mcs_setTitle");n.perform(r,JSON.stringify(h)).then(n=>{var r=function(e){if(!e||!Array.isArray(e.results))return null;var t=e.results.filter(function(e){return e&&e.body&&Array.isArray(e.body.errors)&&e.body.errors.length>0}).map(function(e){return e.body&&e.body&&e.body.errors?e.body.errors:[]});return t.length>0?t:null}(n);if(r)return this.displayIssues(r),m.core.mediator.publish(p.EVENT_REFRESH_ITEMS_BY_IDS,[e]),i(r);var o=!1;if(n&&n.results&&Array.isArray(n.results)&&n.results.forEach(function(e){if(e.body)for(const t in e.body)t&&"errors"!==t&&"url"!==t&&"modified"!==t&&"physicalid"!==t&&(o=!0)}),o)return m.core.sessionManager.setAuthoringMode("authoring"),t(n);0==n.results[0].body.errors.length&&(d.errorAlert(m.core.i18nManager.get("attribute.update.none")),i())}).catch(function(e){e.response&&"EDITPROP_ERROR_0001"===e.response.error?d.errorNotif({title:m.core.i18nManager.get("error.instanceEvolved.notEditable"),subtitle:m.core.i18nManager.get("error.instanceEvolved.UpdateFailedDueToFrozenModelConnected")}):e.response&&e.response.error&&d.errorAlert(e.response.error),i(e)})})},getAttributeAccessRights:async function({physicalid:e,attributePath:t}){try{const n=await this.readAttributes({lIds:[e]});let i=n&&n.results&&n.results.length?n.results[0].data:null;if(!i||!Array.isArray(i))return;let r=i.find(e=>e.path===t);if(!r)return;return r}catch(e){return e}},readAttributes:async function({lIds:e=[],busIDs:t=[],relIDs:i=[]}){const r={lIds:e,relIDs:i,busIDs:t,plmparameters:"false",attributes:"true",navigateToMain:"false",readonly:"true",debug_properties:""},o=m.core.settingManager.getAuthorizedChange()?m.core.settingManager.getAuthorizedChange().AuthoringContextHeader:void 0,s=o?{...r,...o}:r;let a=m.core.settingManager.getCommand("mcs_attributes");try{return await n.perform(a,JSON.stringify(s))}catch(e){return e}},transformToMaterialQuantity:function(e,i){var r={references:e,quantity:i};return t.wrappedWithCancellablePromise(function(e,t){n.perform(m.core.settingManager.getCommand("add_quantity_of_material"),JSON.stringify(r)).then(function(t){return e(t)}).catch(function(e){t(e)})})},expandV2:function(e){return t.wrappedWithCancellablePromise((t,n)=>{!0===e.isOnAuthoring?e.executor=p.COMMAND_WS_EXPAND_DB:!1===e.isOnAuthoring?e.executor=p.COMMAND_WS_EXPAND_CV_V2:e.executor=m.core.sessionManager.isUsingDB()?p.COMMAND_WS_EXPAND_DB:p.COMMAND_WS_EXPAND_CV_V2;const i=this.buildExpandGenericOption2(e);i&&this.doExpand(i,e).then(t).catch(n)})},buildExpandGenericOption2:function({physicalid:e,paths:t,level:n="0",type_filter_rel:i=["PLMInstance"],select_bo:r=m.core.dicoService.getTagsForBOWithMandatories(),select_rel:o=m.core.dicoService.getTagsForRelWithMandatories(),executor:s=p.COMMAND_WS_EXPAND_CV,config_filter:a}){let l={no_type_filter_rel:["XCADBaseDependency"]};if(l.type_filter_rel=i,l["q.iterative_filter_query_bo"]=this.getIterativeFilterQueryBO(),l.compute_select_bo=m.core.settingManager.getSetting("compute_select_bo"),l.expand_iter=n,l.fcs_url_mode="REDIRECT",l.select_bo=r,l.select_rel=o,l.locale=m.core.settingManager.getLanguage(),l.label=m.core.settingManager.getCVRequestLabel(),l.tenant=m.core.settingManager.getPlatformId(),t&&Array.isArray(t))l.paths=t,l.root_path_physicalid=t;else{if(!e)return null;l.root_physicalid=e,l.root_path_physicalid=[[e]]}if(a&&(l.config_filter=a),m.core.sessionManager.showNotInBOM()||(l.sequence_filter=m.core.settingManager.getSetting("sequence_filter_exclude_NotInBOM")),s===p.COMMAND_WS_EXPAND_DB){var c=m.core.dicoService.getSelectedExtensions()||[];const e=function(e,t){if("string"!=typeof e||!e.trim().length||!Array.isArray(t))return;const n=m.core.dicoService.getAttributesInfoFromPredicate(e);var i;Array.isArray(n)&&n.length?n.map(e=>e.Owner).forEach(e=>{t.indexOf(e)<0&&t.push(e)}):(2===(i=e.split(":")).length&&(e=i[1]),2===(i=e.split(".")).length?t.indexOf(i[0])<0&&t.push(i[0]):3===i.length&&t.indexOf(i[1])<0&&t.push(i[1]))};l.select_bo.forEach(t=>e(t,c)),l.select_rel.forEach(t=>e(t,c)),l.types=m.core.dicoService.getSelectedTypes()||[],l.extensions=c}return E(s)&&!m.core.sessionManager.shouldShowFinalItems()&&!m.core.sessionManager.shouldShowLeafMaterials()&&m.core.PreferencesManager.isSpecInProductStructureEnabled()&&(l=this.decoratePayloadWithSpecficationDocument(l)),l},decoratePayloadWithSpecficationDocument(t){if(!t)return;const n=e.clone(t),i='(flattenedtaxonomies:"types/Document") OR (flattenedtaxonomies:"types/CONTROLLED DOCUMENTS")';n["q.iterative_filter_query_bo"]&&""!==n["q.iterative_filter_query_bo"].trim()?n["q.iterative_filter_query_bo"]=`${n["q.iterative_filter_query_bo"]} OR ${i}`:n["q.iterative_filter_query_bo"]=i;const r=["SpecificationDocument"];Array.isArray(n.type_filter_rel)?n.type_filter_rel.push(...r):n.type_filter_rel=r;const o=["ds6w:docextension","islastrevision","type","policy","current"];Array.isArray(n.select_bo)?n.select_bo=[...new Set([...n.select_bo,...o])]:n.select_bo=o;const s=n.select_bo.indexOf("ds6w:docExtension");-1!==s&&n.select_bo.splice(s,1);const a=["type"];if(Array.isArray(n.select_rel)?n.select_rel=[...new Set([...n.select_rel,...a])]:n.select_rel=a,!m.core.sessionManager.showNotInBOM()&&Array.isArray(n.sequence_filter)){const[e]=n.sequence_filter,{definition:t}=e||{},[i]=t||{};Array.isArray(i.type_filter_rel)?i.type_filter_rel.push(...r):i.type_filter_rel=[...r]}return n},multiExpandV2:function(e){var n=this;return t.wrappedWithCancellablePromise(function(t,i){let r=n.buildMultiExpandGenericOption2(e);(m.core.sessionManager.shouldShowFinalItems()||m.core.sessionManager.shouldShowLeafMaterials())&&(r=n.decoratePayloadWithSpecficationDocument(r)),r&&n.doExpand(r,{executor:p.COMMAND_WS_MULTIEXPAND_V2}).then(t).catch(i)})},buildMultiExpandGenericOption2:function({select_bo:e=m.core.dicoService.getTagsForBOWithMandatories(),select_rel:t=m.core.dicoService.getTagsForRelWithMandatories(),nextGenFilterOption:n},i=!0){let r=!i&&UWA.is(n.CVQuery)?UWA.clone(n.CVQuery):{};if(r.union&&r.union.expand&&r.union.expand.length>=1){for(var o=[],s=0;s<r.union.expand.length;s++){var a=r.union.expand[s];a.volume_filter?o.push(s):(a.expand_iter="-1",a.no_type_filter_rel=["XCADBaseDependency"],a.type_filter_rel=["PLMInstance"],m.core.sessionManager.showMadeFrom()&&a.type_filter_rel.push("MustBeMadeFrom"),a["q.iterative_filter_query_bo"]=this.getIterativeFilterQueryBO())}for(var l=0;l<o.length;l++)r.union.expand.splice(o[l],1)}if(r.select_bo=e,r.select_rel=t,r.compute_select_bo=m.core.settingManager.getSetting("compute_select_bo"),r.label=m.core.settingManager.getCVRequestLabel(),i&&UWA.is(n.CVQueryV2)){const{CVQueryV2:e,filterRootIds:t}=n;r.v2PayloadEntriesToAdd=[{CVQueryV2:e}],r.expand_iter="-1",r.no_type_filter_rel=["XCADBaseDependency"],r.type_filter_rel=["PLMInstance"],m.core.sessionManager.showMadeFrom()&&r.type_filter_rel.push("MustBeMadeFrom"),r["q.iterative_filter_query_bo"]=this.getIterativeFilterQueryBO(),r.root_path_physicalid=[t]}return m.core.sessionManager.shouldShowFinalItems()||m.core.sessionManager.shouldShowLeafMaterials()||!m.core.PreferencesManager.isSpecInProductStructureEnabled()||(r.type_filter_rel=["PLMInstance"],r=this.decoratePayloadWithSpecficationDocument(r)),r},chunkInstances:function(e,t){var n=0,i=e.length,r=[];for(n=0;n<i;n+=t){let i=e.slice(n,n+t);r.push(i)}return r},createInstances:function({parentID:e,referencesIDs:i,existingInstancesIDs:r,quantitiesToAdd:o}){let s=this;if(!e||!i||!Array.isArray(i))throw"invalid input";if(i.some(t=>t===e))throw"Operation aborted as it creates cycle(s).";const a=0!==o?o:i.length,l=i[0],c=m.core.settingManager.isChangeAuthorized()||m.core.settingManager.isWorkingUnderEvolution()?p.CHANGE_QUANTITY_LIMIT_UNDER_CHANGE_ACTION:p.CHANGE_QUANTITY_LIMIT;if(a>c){const i=m.core.settingManager.getCommand("changeQuantities");return t.wrappedWithCancellablePromise(function(t,o){n.perform(i,JSON.stringify({parentID:e,firstRefID:l,existingInstancesIDs:r,totalQuantities:a})).then(function(e){"failure"===e.status?Array.isArray(e.message)&&e.message.length>=1&&d.errorAlert(JSON.stringify(e.message)):"true"==e.IncompleteJobObjectExists?d.errorAlert(m.core.i18nManager.get("eng.background.job.error")):d.sucessAlert(m.core.i18nManager.get("eng.background.job.success"))}).catch(function(e){s.logger.error(e),o(e)})})}return s.createInstancesService({parentID:e,referencesIDs:i,existingInstancesIDs:r})},createInstancesService:function({parentID:e,referencesIDs:i,existingInstancesIDs:r}){let o=this;if(this.logger.info("call of createInstance"),!e||!i||!Array.isArray(i))throw"invalid input";let s=m.core.settingManager.getCommand("powerBy_addExisting");if(i.some(t=>t===e))throw"Operation aborted as it creates cycle(s).";var a={version:"1.0",bAllOrNothing:!0,operations:[]},l=[],c=!1;return i.forEach(function(t){var n={},i=l.indexOf(t);-1===i?(n={isInstanceOf:t,cacheId:l.length},l.push(t)):n={cacheId:i};var o={};c?o={cacheId:0}:(o={isInstanceOf:e,children:r&&Array.isArray(r)?r:[],cacheId:0},c=!0),a.operations.push({parent:o,child:n})}),t.wrappedWithCancellablePromise(function(e,t){n.perform(s,JSON.stringify(a)).then(function(n){if("failure"!==n.status)return m.core.sessionManager.setAuthoringMode("authoring"),d.sucessAlert(m.core.i18nManager.get("eng.operation.addInstance.sucess")),n&&n.results&&Array.isArray(n.results)?e(n.results):t();if(Array.isArray(n.messages)&&n.messages.length>=2)d.errorAlert(n.messages.length>1?n.messages[1]:JSON.stringify(n.messages));else if(n.results&&n.results.length>1)n.results.forEach(function(e){e.results.forEach(function(e){d.errorAlert(Array.isArray(e.messages)&&e.messages.length>1?e.messages[2]:JSON.stringify(e))})});else if(Array.isArray(n.messages)&&1===n.messages.length){let e=n.messages[0];d.errorAlert(e===p.ERR_FUN092398?m.core.i18nManager.get("error.ERR_FUN092398"):e)}else d.errorAlert(JSON.stringify(n.status))}).catch(function(e){o.logger.error(e),t(e)})})},getRangeValueNlsTracker:function(){let e={};return m.core.columnsManager.getAvailableColumns().forEach(function(t){let n=m.core.dicoService.getRangeValueAttribute(t.dataIndex);n&&(e[n.ds6w]=n.AuthorizedValues)}),e},fetchMadeFromData:function(e){return t.wrappedWithCancellablePromise(function(t,i){var r=Object.assign({},m.core.settingManager.getCommand("madefrom_info"));r.url=r.url.replace("{pid}",e),n.perform(r).then(function(e){t(e)}).catch(function(e){return i(e)})})},retrieveMadeFromInfos:function(e,t){var n=this,i={};let r=e&&e.pids?new Set(e.pids):"";r&&r.forEach(function(e){n.fetchMadeFromData(e).then(function(n){if(n.success&&n.result&&n.result.MadeFromConnections){let t=[];null==i[e]&&(i[e]={}),n.result.MadeFromConnections.forEach(e=>{if(e){let n;if(e.asRequired){let t=e.quantity&&"0"!=parseInt(e.quantity)?`, ${e.quantity} ${e.quantityUOM.nlsLabel}`:"";n=`${m.core.i18nManager.get("makeFromAsRequired")}${t}`}else e.quantity&&e.quantityUOM&&e.quantityUOM.nlsLabel&&(n=`${e.quantity} ${e.quantityUOM.nlsLabel}`);t.push(n)}}),n.result.MadeFromConnections[0],i[e].MadeFrom=t.length>0?t.join(", "):" "}Object.keys(i).length===r.size&&t({pids:i})})})},completeWithCoreMaterialInformation:async function(e){const t={};for(let n in e){let i=e[n];i.hasQuantity&&(t[i.physicalid]=i)}const n=Object.keys(t);if(0===n.length)return{};let i=null;try{i=await this.getCoreMaterialToEngItem(n)}catch(e){console.debug(`getCoreMaterialToEngItem fails ${e}`)}if(!i||!i.references)return{};const r=[];i.references.forEach(e=>{const n=e.material.physicalid,i=e.engItem;t[i].CoreMaterialID=n,r.push(n)});let o=null;try{const e=m.core.dicoService.getTagsForBOWithMandatories();o=await this.fetch(r,e)}catch(e){console.debug(`fetch material informations for ids ${r} fails ${e}`)}return Array.isArray(o)?(o.forEach(e=>{e["ds6w:globalType"]="ds6w:Material";const t=e["ds6w:status"].split(".");e["ds6w:status"]=t[t.length-1]}),o):{}},doExpand:async function(e,t,i=new h(m),r=!0){const{executor:o,payloadAlreadyConverted:s}=t||{};if(!o||!e)throw new Error("invalid inputs");const a=m.core.settingManager.getCommand(o);if(!a)throw new Error(`unknow expand command executor ${o}`);const l=s?e:g.convertPayloadTo(e,o);if(!l)throw new Error("fails to convert payload");const c=Date.now();console.debug("lauch expands... ");const u=[];let p=null;try{p=await n.perform(a,JSON.stringify(l))}catch(e){u.push(e)}const f=Date.now();console.debug(`expand received in ${f-c} ms`);const{errors:C}=p||{};if(Array.isArray(C)&&C.length&&u.push(...C),E(o)){const{results:n}=p||{};if(!Array.isArray(n))if(i.addNewErrors(u,o),i.canErrorsBeFixed){const n=i.fixPayload(e),r=i.fixOptions(t);p=await this.doExpand(n||e,r||t,i,!1)}else p||(p={}),p.results=[]}if(r&&i.hasErrorsToBeDisplayed){const e=i.buildErrorMessage(),t=e.trim().length?e:m.core.i18nManager.get("error.fetch.deleted.item"),n=i.canErrorsBeFixed?d.warningAlert:d.errorAlert;Reflect.apply(n,d,[t])}return g.postTreatAnswer(p,o),p},completeWithDeformableInformation:function(e){return new Promise((t,n)=>{let i=[];for(let t in e){let n=e[t]&&e[t].getDeformableObjectIDFromDeformed?e[t].getDeformableObjectIDFromDeformed:void 0;n&&i.push(n)}if(0===i.length)return t({});{let e=m.core.dicoService.getTagsForBOWithMandatories();this.fetch(i,e).then(function(e){return t(e)}).catch(function(e){n()})}})},fetchDimensionsWithUnits:()=>{const e=m.core.settingManager.getCommand("getDimensions");return n.perform(e)},displayIssues:e=>{if(!Array.isArray(e))return;const t=e=>{e&&e.code&&e.message&&("1900068"===e.code?d.errorNotif({title:m.core.i18nManager.get("error.object.update.title"),subtitle:m.core.i18nManager.get("error.object.update.subtitle"),message:m.core.i18nManager.get("error.object.update.message")}):d.errorAlert(e.message))},n=e.find(e=>"1500188"===e.code);n?t(n):e.forEach(function(e){Array.isArray(e)?t(e[0]):t(e)})},getIterativeFilterQueryBO:()=>m.core.PreferencesManager&&!m.core.PreferencesManager.isShow3DShapeEnabled()?'(flattenedtaxonomies:"types/Drawing") OR [ds6w:globalType]:"ds6w:Part"':'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"',reParentDragAndDrop:e=>{let i=this;const r=m.core.settingManager.getCommand("reParent");return t.wrappedWithCancellablePromise(function(t,o){n.perform(r,JSON.stringify(e)).then(function(e){return t(e)}).catch(function(e){i.logger.error(e),o(e)})})}}}}),define("DS/ENOXEngineer/services/MaterialService",["UWA/Core","DS/ENOXEngineer/services/MaterialConstants","DS/ENOXEngineer/services/MaterialExceptions","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/services/EngineeringSettings","DS/ENOXEngineer/utils/XENHttpClient"],(e,t,n,i,r,o)=>{const{MaterialType:s}=t,{MaterialTypeError:a,MaterialServerError:l}=n,c={fetch_core_material:"get_core_material",fetch_covering_material:"get_covering_material",author_core_material:"post_core_material",author_covering_material:"post_covering_material",get_core_support_info:"get_core_support_info",get_covering_support_info:"get_covering_support_info"};return new class{constructor(){this.appCore=null}bindApp(e){this.appCore=e}fetchCoreMaterialData({pids:e}){const t=this._computePayloadForFetch({pids:e});return this._fetchMaterialData(t,c.fetch_core_material)}fetchCoveringMaterialData({pids:e,xen_occs:t}){const n=this._computePayloadForFetch({pids:e,xen_occs:t});return this._fetchMaterialData(n,c.fetch_covering_material)}authorCoreMaterialData({pids:e}){try{const t=this._computePayloadForAuthoring({pids:e},s.core);return this._authorMaterialData(t,c.author_core_material)}catch(e){return Promise.reject(e)}}authorCoveringMaterialData({pids:e}){try{const t=this._computePayloadForAuthoring({pids:e},s.covering);return this._authorMaterialData(t,c.author_covering_material)}catch(e){return Promise.reject(e)}}getCoreMaterialSupportInfo({pids:e}){const t=this._computePayloadForFetch({pids:e},!1);return this._fetchMaterialData(t,c.get_core_support_info)}getCoveringMaterialSupportInfo({pids:e}){const t=this._computePayloadForFetch({pids:e},!1);return this._fetchMaterialData(t,c.get_covering_support_info)}async getBaseMaterialType(e){if("string"!=typeof e||0===e.trim())throw new Error("wrong input");const t={types:[e]};let n="";try{const{types_hierarchies:i}=await this._fetchMaterialData(t,"gettypeshierarchy"),[r]=i,{hierarchy:o}=r;-1!==o.indexOf(s.core)?n=s.core:-1!==o.indexOf(s.covering)?n=s.covering:-1!==o.indexOf(s.raw)&&(n=s.raw)}catch(t){console.error(`getBaseMaterialType failed for type ${e}`)}return n}retreiveAuthorMaterialDataFct(e){let t=null;switch(e){case s.core:t="authorCoreMaterialData";break;case s.covering:t="authorCoveringMaterialData"}return t}_computePayloadForFetch({pids:t,xen_occs:n},i=!0){const r={};if(e.is(t)&&Array.isArray(t)&&t.length>=1&&(r.references=t),e.is(n)&&n.length>=1){const e=[];n.forEach(t=>{e.push(t.getPath(!1))}),r.occurrences=e}return i&&(r.with_partials=!0),r}_fetchMaterialData(e,t){return new Promise((n,i)=>{o.perform(r.getCommand(t),e).then(e=>n(e)).catch(e=>i(e))})}_computePayloadForAuthoring({pids:t,xen_occs:n},i){const r={as_bulk:!0,with_partials:!0};return e.is(t)&&Array.isArray(t)&&t.length>=1&&(r.references=t.map(e=>{const{physicalid:t,operations:n}=e;return{physicalid:t,changes:n.map(e=>{if(!e.isCompatibleWithType(i))throw new a(`incompatible operation type with ${i}`);return e.build()})}})),e.is(n)&&n.length>=1&&console.warn("not yet implemented"),r}_authorMaterialData(e,t){return this.appCore.mediator.publish(i.EVENT_AUTHORING_MATERIAL_START,{cmd:t,payload:e}),new Promise((n,s)=>o.perform(r.getCommand(t),e).then(r=>{!Reflect.has(r,"references")&&Reflect.has(e,"references")&&(r.references=e.references.map(e=>({physicalid:e.physicalid}))),this.appCore.mediator.publish(i.EVENT_AUTHORING_MATERIAL_END,{cmd:t,answer:r}),n(r)}).catch(e=>(this.appCore.mediator.publish(i.EVENT_AUTHORING_MATERIAL_END,{cmd:t,answer:{}}),console.log(`error authoring Material Data ${e}`),s(new l(e)))))}}}),define("DS/ENOXEngineer/columnsProviders/MaterialDataProvider",["UWA/Core","UWA/Class","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/services/I18nManager","DS/ENOXEngineer/services/OccurrencesService","DS/ENOXEngineer/services/MaterialService"],(e,t,n,i,r,o)=>{const{XENOccurrencesBag:s}=r,a="CoreMaterial",l="CoveringMaterial",c="CoveringMaterialInstance";return t.singleton({init(e){this._parent(e)},bindApp(e){this.appCore=e,o.bindApp(e)},isAdditionalColumnsAvailable(t){if(!1===e.is(t,"function"))throw new Error("A callback function should be defined");t(!0)},getName:()=>"MaterialColumns",getManagedColumnNames:()=>[a,l,c],toBeUpdated(t){if(!e.is(t))return console.error("abnormal situation -> MaterialDataProvider/toBeUpdated wrong inputs"),!1;return!e.is(t.CoreMaterial)||!e.is(t.CoveringMaterial)||!e.is(t.CoveringMaterialInstance)},getAdditionalColumnsUX(e){this.getManagedColumnNames().forEach(t=>{let n={text:i.get(t),dataIndex:t,maxWidth:800,minWidth:20,width:200};switch(t){case c:const e=i.get("eng.export.instance.key");n.text=`${i.get(l)} (${e})`,n.icon=null}const r=e.findIndex(e=>e.dataIndex===t);-1!==r?e.splice(r,r>=0?1:0,n):e.push(n)})},_extractMaterialInfoFromCoveringCtx(e){let t=0,n=null;for(const[i,r]of e.entries()){const{materialref:e}=r;t+=e.length,0===i&&([n]=e)}return{matref:n,matref_number:t}},_buildMaterialInfoMsg({matref:t,matref_number:n,references_infos:r}){const o=e.is(r)?r.find(e=>e.physicalid==t.physicalid):t,s=e.is(o.V_Name)?o.V_Name:"no name",a=e.is(o.revision)?o.revision:"",l=e.is(t.partial)?`[${i.get("partial")}]`:"";let c=" ";return c=1===n?`${l} ${s} ${a}`:`${n>1?`[${n}]`:""} ${l} ${s} ${a}`},_retreiveVisibleMaterialColumn(){const{columns:t}=this.appCore.dicoService.getUserDicoPreferences();if(!Array.isArray(t))return[];const n=this.getManagedColumnNames(),i=t.filter(({dataIndex:e,visibleFlag:t})=>-1!==n.findIndex(t=>t===e)),r={};return i.forEach(({dataIndex:e,visibleFlag:t})=>{r[e]=t}),e.is(r[c])&&this.appCore.sessionManager.shouldShowQuantityView()&&(r[c]=!1),r},updateAttributes(t,i){if(!1===e.is(t,"object"))throw new Error("The object ids to modify must be specify");if(!1===e.is(i,"function"))throw new Error("A callback function should be defined");const r={};e.is(t.pids)&&Array.isArray(t.pids)&&t.pids.length>=1&&t.pids.forEach(e=>{r[e]={CoreMaterial:" ",CoreMaterialID:" ",CoreMaterialInfo:{},CoveringMaterial:" ",CoveringMaterialInfo:{}}});const d={};e.is(t.occpaths)&&Array.isArray(t.occpaths)&&t.occpaths.length>=1&&(t.xen_occs=new s(t.occpaths),t.xen_occs.forEach(e=>{d[e.id]={CoveringMaterialInstance:" ",CoveringMaterialInstanceInfo:{}}}));const u=[],p=this._retreiveVisibleMaterialColumn();if(p[a]&&u.push(o.fetchCoreMaterialData(t)),p[l]||p[c]){const e=p[l]?t.pids:null,n=p[c]&&this.appCore.contextManager.getActiveEngItem().getID()!=e?t.xen_occs:null;u.push(o.fetchCoveringMaterialData({pids:e,xen_occs:n}))}n.allSettled(u).then(n=>{Array.isArray(n)&&n.length>0&&n.forEach(n=>{if("fullfilled"===n.state){const{references:i,references_infos:o}=n.value;e.is(i)&&Array.isArray(i)&&i.forEach(t=>{const{physicalid:n}=t;void 0===r[n]&&(console.error("abnormal node situation for node {}. Should have been declared",n),r[n]={});const{corematerial:i}=t;e.is(i)&&Array.isArray(i)&&i.length>0&&(r[n].CoreMaterial=this._buildMaterialInfoMsg({matref:i[0],matref_number:i.length,references_infos:o}),1===i.length&&(r[n].CoreMaterialID=i[0].physicalid,r[n].CoreMaterialInfo=i));const{coveringmaterial:s}=t;e.is(s)&&Array.isArray(s)&&s.length>0&&(r[n].CoveringMaterial=this._buildMaterialInfoMsg({matref:s[0],matref_number:s.length,references_infos:o}))});const{occurrences:s}=n.value,{xen_occs:a}=t;e.is(s)&&Array.isArray(s)&&e.is(a)&&s.forEach(t=>{const n=a.getXENOccurrencefromOccurrencePath(t.physicalid),{coveringmaterial:i}=t;if(e.is(n)&&e.is(i)&&Array.isArray(i)){const e=n.id;void 0===d[e]&&(console.error("abnormal node situation for node {}. Should have been declared",e),d[e]={});const{matref:t,matref_number:r}=this._extractMaterialInfoFromCoveringCtx(i);d[e].CoveringMaterialInstance=this._buildMaterialInfoMsg({matref:t,matref_number:r,references_infos:o})}})}}),i({pids:r,occpaths:d})})}})}),define("DS/ENOXEngineer/services/MaterialAuthoringOperations",["UWA/Core","DS/ENOXEngineer/services/MaterialConstants","DS/ENOXEngineer/services/MaterialService","DS/ENOXEngineer/services/MaterialExceptions"],(e,t,n,i)=>{const{MaterialType:r}=t,{MaterialTypeError:o,MaterialSamePidError:s}=i,a={apply:"apply",remove:"remove",replace:"replace"},l=async e=>{const t=e.physicalid||e.id||e.objectId;let i=e.V_discipline||e["ds6w:type_value"]||e.objectType;return i!==r.raw&&i!==r.core&&i!==r.covering&&(Reflect.has(e,"baseMatType")||(e.baseMatType=await n.getBaseMaterialType(i)),i=e.baseMatType),{physicalid:t,type:i}};class c{constructor(e,t){this.type=t,this.matref=e}get operation(){return this.type}build(){const{physicalid:e}=this.matref;return{materialref:{physicalid:e},operation:this.buildOperation()}}buildOperation(){return{type:this.operation}}isCompatibleWithType(e){return!1}}class d extends c{constructor(e){super(e,a.apply)}static async create(t){if(!e.is(t))return console.error("MaterialAuthoringOperation / ApplyMaterial.Create -> wrong inputs"),null;const{type:n}=await l(t);return n===r.core?u.create(t):n===r.covering?p.create(t):null}}class u extends d{isCompatibleWithType(e){return e===r.core}static async create(t){if(!e.is(t))return console.error("MaterialAuthoringOperation / CoreApplyMaterial.Create -> wrong inputs"),null;const{physicalid:n,type:i}=await l(t);if(i!==r.core){throw console.error(`MaterialAuthoringOperation / CoreApplyMaterial.Create -> matref (${n}) is not a ${r.core}`),new o(`Wrong material type ${i} => expecting ${r.core}`)}return new u({physicalid:n})}}class p extends d{isCompatibleWithType(e){return e===r.covering}static async create(t){if(!e.is(t))return console.error("MaterialAuthoringOperation / CoveringApplyMaterial.Create -> wrong inputs"),null;const{physicalid:n,type:i}=await l(t);if(i!==r.covering)throw console.error(`MaterialAuthoringOperation / CoveringApplyMaterial.Create -> matref (${n}) is not a ${r.covering}`),new o(`Wrong material type ${i} => expecting ${r.covering}`);return new p({physicalid:n})}}class g extends c{constructor(e){super(e,a.remove)}static async create(t){if(!e.is(t))return console.error("MaterialAuthoringOperation / RemoveMaterial.Create -> wrong inputs"),null;const{type:n}=await l(t);return n===r.core?h.create(t):n===r.covering?m.create(t):null}}class h extends g{isCompatibleWithType(e){return e===r.core}static async create(t){if(!e.is(t))return console.error("MaterialAuthoringOperation / CoreRemoveMaterial.Create -> wrong inputs"),null;const{physicalid:n,type:i}=await l(t);return i!==r.core?(console.error(`MaterialAuthoringOperation / CoreRemoveMaterial.Create -> matref (${n}) is not a ${r.core}`),null):new h({physicalid:n})}}class m extends g{isCompatibleWithType(e){return e===r.covering}static async create(t){if(!e.is(t))return console.error("MaterialAuthoringOperation / CoveringRemoveMaterial.Create -> wrong inputs"),null;const{physicalid:n,type:i}=await l(t);return i!==r.covering?(console.error(`MaterialAuthoringOperation / CoveringRemoveMaterial.Create -> matref (${n}) is not a ${r.covering}`),null):new m({physicalid:n})}}class f extends c{constructor(e){super(e,a.replace)}static async create(t,n){if(!e.is(t))return console.error("MaterialAuthoringOperation / ReplaceMaterial.Create -> wrong inputs"),null;const{type:i}=await l(t);return i===r.core?E.create(t,n):i===r.covering?C.create(t,n):null}}class E extends f{isCompatibleWithType(e){return e===r.core}constructor({physicalid:e},t){super({physicalid:e}),this.new_matref=t}static async create(t,n){if(!e.is(t)||!e.is(n))return console.error("MaterialAuthoringOperation / CoreReplaceMaterial.Create -> wrong inputs"),null;const{physicalid:i,type:a}=await l(t),{physicalid:c,type:d}=await l(n);if(a!==r.core||d!==r.core)throw console.error(`MaterialAuthoringOperation / CoreReplaceMaterial.Create -> matref (${i}) or new_matref (${c}) is not a ${r.core}`),new o("Wrong material type");if(i===c)throw console.error(`MaterialAuthoringOperation / CoreReplaceMaterial.Create -> matref (${i}) and new_matref (${c}) are equals`),new s("Same material physicalid");return new E({physicalid:i},{physicalid:c})}buildOperation(){return{type:this.operation,with:{materialref:{physicalid:this.new_matref.physicalid}}}}}class C extends f{constructor({physicalid:e},t){super({physicalid:e}),this.new_matref=t}isCompatibleWithType(e){return e===r.covering}static async create(t,n){if(!e.is(t)||!e.is(n))return console.error("MaterialAuthoringOperation / CoveringReplaceMaterial.Create -> wrong inputs"),null;const{physicalid:i,type:a}=await l(t),{physicalid:c,type:d}=await l(n);if(a!==r.covering||d!==r.covering)throw console.error(`MaterialAuthoringOperation / CoveringReplaceMaterial.Create -> matref (${i}) or new_matref (${c}) is not a ${r.covering}`),new o("Wrong material type");if(i===c)throw console.error(`MaterialAuthoringOperation / CoveringReplaceMaterial.Create -> matref (${i}) and new_matref (${c}) are equals`),new s("Same material physicalid");return new C({physicalid:i},{physicalid:c})}buildOperation(){return{type:this.operation,with:{materialref:{physicalid:this.new_matref.physicalid}}}}}return{ApplyMaterial:d,RemoveMaterial:g,ReplaceMaterial:f,extractMatInfos:l}}),define("DS/ENOXEngineer/commands/MaterialFacet/ReplaceMaterialCmd",["UWA/Core","DS/ENOXEngineer/commands/MaterialFacet/BaseMatCmd","DS/ENOXEngineer/services/MaterialService","DS/ENOXEngineer/services/MaterialAuthoringOperations","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/services/MaterialExceptions"],(e,t,n,i,r,o,s)=>{const{MaterialError:a}=s;return class extends t{constructor(e){super({...e,isAsynchronous:!0,mode:"exclusive"})}get isAuthoringCmd(){return!0}getMaxTime(e=5){return 60*e*1e3}get searchManager(){return this.options.searchManager}get materialType(){return this.options.materialType}getNls(e){const t=Object.getOwnPropertyNames(r).findIndex(t=>t===e);return t<0&&console.error(`error: ReplaceMaterialCmd missing nls entry ${e}`),t>=0?r[e]:null}launchMaterialSearch(t){if(!e.is(t))return console.error("error: ReplaceMaterialCmd/launchMaterialSearch missing materialType parameter"),Promise.reject();const{searchManager:n}=this;return e.is(this.options.searchManager)?new Promise((e,i)=>{try{n.launchASearch({title:this.getNls("materialFacet.searchResult.ReplaceMaterial"),allowedTypes:[t],role:"",criteria:"",multiSel:!1,in_apps_callback:t=>{e(t)}})}catch(e){i(e)}}):(console.error("error: ReplaceMaterialCmd/launchMaterialSearch missing searchManager parameter"),Promise.reject())}endExecute(){const{searchManager:t}=this;e.is(this.options.searchManager)}cancel(e=!1,t=null){if(e){const e=this.getNls("materialFacet.authoring.failed").replace("{operation}",this.getNls("materialFacet.replaceMaterial")),n=this.buildDisplayedMessage(e,t);o.errorNotif(n)}super.cancel()}async execute(){const{selectedItems:t}=this;if(!Array.isArray(t)||!t.length)return console.error("error: ReplaceMaterialCmd/execute missing selectedItems parameter"),this.cancel(!0);const r=this.selectedMaterials;if(!e.is(r))return console.error("error: ReplaceMaterialCmd/execute missing matRefs parameter"),this.cancel(!0);const o=new Promise(e=>{setTimeout(()=>e([]),this.getMaxTime(.5))});let s=[];s.push(o),s.push(this.launchMaterialSearch(this.materialType));let l=null;try{l=await Promise.race(s)}catch(e){console.warn("error: ReplaceMaterialCmd/execute authoring operation failed, no ref material selected");const t=a.isAMaterialError(e);return this.cancel(t,e)}if(!Array.isArray(l)||!l.length||l.length>1)return this.cancel();try{const{ReplaceMaterial:o}=i;s=r.map(e=>new Promise((t,n)=>{o.create(e,l[0]).then(t).catch(n)}));const a=await Promise.all(s),c=t.map(e=>({physicalid:e,operations:a})),d=n.retreiveAuthorMaterialDataFct(this.materialType);if(!e.is(d))return console.error(`error: ReplaceMaterialCmd/execute no authoring function found for type ${this.materialType}`),this.cancel(!0);await n[d]({pids:c})}catch(e){return console.error("error: ReplaceMaterialCmd/execute authoring operation failed"),this.cancel(!0,e)}return this.end()}}}),define("DS/ENOXEngineer/commands/MaterialFacet/RemoveMaterialCmd",["UWA/Core","DS/ENOXEngineer/commands/MaterialFacet/BaseMatCmd","DS/ENOXEngineer/services/MaterialService","DS/ENOXEngineer/services/MaterialAuthoringOperations","DS/ENOXEngineerCommonUtils/xEngAlertManager","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],(e,t,n,i,r,o)=>{return class extends t{constructor(e){super({...e,isAsynchronous:!0,mode:"shared"})}get isAuthoringCmd(){return!0}get materialType(){return this.options.materialType}getNls(e){const t=Object.getOwnPropertyNames(o).findIndex(t=>t===e);return t<0&&console.error(`RemoveMaterialCmd -> missing nls entry ${e}`),t>=0?o[e]:null}cancel(e=!1,t=null){if(e){const e=this.getNls("materialFacet.authoring.failed").replace("{operation}",this.getNls("materialFacet.removeMaterial")),n=this.buildDisplayedMessage(e,t);r.errorNotif(n)}super.cancel()}async execute(){const{selectedItems:t}=this;if(!Array.isArray(t)||!t.length)return console.error("error: RemoveMaterialCmd/execute missing selectedItems parameter"),this.cancel(!0);const r=this.selectedMaterials;if(!e.is(r))return console.error("error: RemoveMaterialCmd/execute missing matRefs parameter"),this.cancel(!0);try{const{RemoveMaterial:o}=i,s=r.map(e=>new Promise((t,n)=>{o.create(e).then(t).catch(n)})),a=await Promise.all(s),l=t.map(e=>({physicalid:e,operations:a})),c=n.retreiveAuthorMaterialDataFct(this.materialType);if(!e.is(c))return console.error(`error: RemoveMaterialCmd/execute no authoring function found for type ${this.materialType}`),this.cancel(!0);await n[c]({pids:l})}catch(e){return console.error("error: RemoveMaterialCmd/execute authoring opration failed"),this.cancel(!0,e)}return this.end()}}}),define("DS/ENOXEngineer/commands/MaterialFacet/ApplyMaterialCmd",["UWA/Core","DS/ENOXEngineer/commands/MaterialFacet/BaseMatCmd","DS/ENOXEngineer/services/MaterialService","DS/ENOXEngineer/services/MaterialAuthoringOperations","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json","DS/ENOXEngineerCommonUtils/xEngAlertManager"],(e,t,n,i,r,o)=>{return class extends t{constructor(e){super({...e,isAsynchronous:!0,mode:"exclusive"})}get isAuthoringCmd(){return!0}getMaxTime(e=5){return 60*e*1e3}get searchManager(){return e.is(this.options.searchManager)?this.options.searchManager:null}get dragdropFct(){return e.is(this.options.getDnDSelectedItems)?this.options.getDnDSelectedItems:null}get materialType(){return this.options.materialType}getNls(e){const t=Object.getOwnPropertyNames(r).findIndex(t=>t===e);return t<0&&console.error(`error: ApplyMaterialCmd -> missing nls entry ${e}`),t>=0?r[e]:null}cancel(e=!1,t=null){if(e){const e=this.getNls("materialFacet.authoring.failed").replace("{operation}",this.getNls("materialFacet.applyMaterial")),n=this.buildDisplayedMessage(e,t);o.errorNotif(n)}super.cancel()}launchMaterialSearch(t){if(!e.is(t))return console.error("error: ApplyMaterialCmd/launchMaterialSearch missing materialType parameter"),Promise.reject();const{searchManager:n}=this;return e.is(n)?new Promise((e,i)=>{try{n.launchASearch({title:this.getNls("materialFacet.searchResult.ApplyMaterial"),allowedTypes:[t],role:"",criteria:"",multiSel:!1,in_apps_callback:t=>{e(t)}})}catch(e){i(e)}}):(console.error("error: ApplyMaterialCmd/launchMaterialSearch missing searchManager parameter"),Promise.reject())}lauchMaterialDnD(t){if(!e.is(t))return console.error("error: ApplyMaterialCmd/lauchMaterialDnD missing materialType parameter"),Promise.reject();const{dragdropFct:n}=this;if(!e.is(n))return console.error("error: ApplyMaterialCmd/launchMaterialSearch missing lauchMaterialDnD parameter"),Promise.reject();const i=this.dragdropFct();if(!Array.isArray(i)||!i.length)return console.error("error: ApplyMaterialCmd/launchMaterialSearch no retreive D&D datas"),Promise.reject();let r=[];try{r=i.map(e=>{const{objectId:t,objectType:n}=e;return{physicalid:t,V_discipline:n}})}catch(e){return Promise.reject()}return Promise.resolve(r)}endExecute(){const{searchManager:t}=this;e.is(this.options.searchManager)}async execute(){const{selectedItems:t}=this;if(!Array.isArray(t)||!t.length)return console.error("error: ApplyMaterialCmd/execute missing selectedItems parameter"),this.cancel(!0);const r=new Promise(e=>{setTimeout(()=>e([]),this.getMaxTime(.5))});let o=[];e.is(this.searchManager)?(o.push(r),o.push(this.launchMaterialSearch(this.materialType))):e.is(this.dragdropFct)&&o.push(this.lauchMaterialDnD(this.materialType));let s=null;try{s=await Promise.race(o)}catch(e){return console.warn("error: ApplyMaterialCmd/execute authoring operation failed, no ref material selected"),this.cancel()}if(!Array.isArray(s)||!s.length)return this.cancel();try{const{ApplyMaterial:r}=i;o=s.map(e=>new Promise((t,n)=>{r.create(e).then(t).catch(n)}));const a=await Promise.all(o),l=t.map(e=>({physicalid:e,operations:a})),c=n.retreiveAuthorMaterialDataFct(this.materialType);if(!e.is(c))return console.error(`error: ApplyMaterialCmd/execute no authoring function found for type ${this.materialType}`),this.cancel(!0);await n[c]({pids:l})}catch(e){return console.error("error: ApplyMaterialCmd/execute authoring operation failed"),this.cancel(!0,e)}return this.end()}}}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityViewModel",["UWA/Core","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityNodeUtils","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/services/I18nManager","DS/TreeModel/TreeNodeModel","DS/ENOXEngineer/utils/XENHttpClient"],(e,t,n,i,r,o)=>{return class{constructor({appCore:e,referenceNode:t,context:n}){this.appCore=e,this.referenceNode=t,this.context=n,this.usages=[],this.usagesAddedAsBulk=0}computeNodeLabel(e){const{grid:t}=e.options,n=Reflect.has(t,"ds6w:label-Instance")?t["ds6w:label-Instance"]:"";return n&&n.trim().length?n:e.getLabel()}computeNodeOccurrencePath(e,n){if(!n)return e.getOccurrencePath();const i=e.getOccurrencePath(),{parentId:r}=this.context;return t.truncateOccurrencePathFromRefID(i,r)}set nodes(e){if(!Array.isArray(e)||!e.length)return;const n=this.appCore.sessionManager.shouldShowFinalItems();this.usages=e.map(e=>{const i=this.computeNodeLabel(e),r=this.computeNodeOccurrencePath(e,n);return t.updateNodeOptions(e,{grid:{status:t.status.Kept,changeQuantityStatus:!0},label:i,children:null,occurrencePath:r}),e})}get nodes(){return this.usages}getRollup(e){}getModelAttached(){return Array.isArray(this.models)?this.models:[]}getReferenceIDForModel(){return this.appCore.sessionManager.shouldShowFinalItems()||this.appCore.sessionManager.shouldShowFinalItems()?this.context.activeId:this.context.parentId}fetchModelAttached(){if(!this.referenceNode)return Promise.reject(new Error("invalid reference"));if(Array.isArray(this.models))return Promise.resolve(this.models);const e=this.getReferenceIDForModel();return this.fetchModel(e).then(e=>(this.models=e,Promise.resolve(this.models))).catch(()=>Promise.reject(new Error("failed to retreive attached Model")))}fetchModel(e){const t={...this.appCore.settingManager.getCommand("getConfiguredObjectInfo")};return t.url=t.url.replace("{pid}",e),o.perform(t).then(e=>{const t=this.appCore.Factories.configItemsFactory.getModelsFromConfigInfo(e);return Promise.resolve(t)}).catch(e=>Promise.reject(e))}executeChangeQuantity(e){}get editableProperties(){return[]}getInstanceIcon(){return{iconName:"flow-cascade dgv-header-icon",fontIconFamily:WUXManagedFontIcons.Font3DS}}getColumns(){const e=[],t=i.get("eng.export.instance.key");var r=i.get("ds6w:label-Instance")+` (${t})`;e.push({text:r,dataIndex:"tree",pinned:"left",width:220}),e.push({text:i.get("ds6w:label"),dataIndex:"ds6w:label"}),e.push({text:i.get("ds6wg:revision"),dataIndex:"ds6wg:revision"});const o=this.buildMaterialColumn(n.CONT_QUANTITY_MASS);e.push(o);const s=this.buildMaterialColumn(n.CONT_QUANTITY_VOLUME);return e.push(s),e}buildMaterialColumn(e){const t=e===n.CONT_QUANTITY_MASS?"eng.ui.dialog.changeQuantity.massQuantityHeader":"eng.ui.dialog.changeQuantity.volumeQuantityHeader";return{text:i.get(t).replace("{unit}",this.getUnitDisplay(e)),dataIndex:e,editableFlag:!1,typeRepresentation:"float",editionPolicy:"EditionOnClick",getCellValue:e===n.CONT_QUANTITY_MASS?this.getMassCellMaterialValue.bind(this):this.getVolumeCellMaterialValue.bind(this)}}getUnitDisplay(e){return e===n.CONT_QUANTITY_MASS?this.appCore.PreferencesManager.getNLSValueForMassQuantity():this.appCore.PreferencesManager.getNLSValueForVolumeQuantity()}getMassCellMaterialValue(e){return this.getCellMaterialValue(n.CONT_QUANTITY_MASS,e)}getVolumeCellMaterialValue(e){return this.getCellMaterialValue(n.CONT_QUANTITY_VOLUME,e)}getCellMaterialValue(e,t){const i=this.getUnitDisplay(e);let r=null;return e===n.CONT_QUANTITY_MASS?r=t.nodeModel.hasMassQuantity&&t.nodeModel.hasMassQuantity():e===n.CONT_QUANTITY_VOLUME&&(r=t.nodeModel.hasVolumeQuantity&&t.nodeModel.hasVolumeQuantity()),r?`${r}${i}`:""}get isAddRemoveNodeAuthorized(){return!1}findFirstModifiedNode(){return this.usages.find(e=>!t.isNodeKept(e))}findLastNonRemoveNode(){return[...this.usages].reverse().find(e=>!t.isNodeRemove(e))}hasModifiedNode(){const t=this.findFirstModifiedNode();return e.is(t)}createNodeInfo(){return null}udpateAsNewNode(e){t.updateNodeOptions(e,{grid:{changeQuantityStatus:!0,status:t.status.Kept},color:t.statusColor.Kept}),this.notifyUpdate({modify:[e]})}udpateAsRemoveNode(e){t.updateNodeOptions(e,{grid:{changeQuantityStatus:!1,status:t.status.Removed},color:t.statusColor.Removed}),this.notifyUpdate({modify:[e]})}udpateAsModifyNode(e,n){t.updateNodeOptions(e,{grid:{status:t.status.Modified,...n},color:t.statusColor.Modified}),this.notifyUpdate({modify:[e]})}udpateAsNonModifyNode(e,n){t.updateNodeOptions(e,{grid:{status:t.status.Kept,...n},color:t.statusColor.Kept}),this.notifyUpdate({modify:[e]})}createAndAddNode(){const e=this.createNodeInfo();if(!e)return;const n=new r({label:e.Text,grid:e});t.updateNodeOptions(n,{grid:{status:t.status.New,changeQuantityStatus:!0},color:t.statusColor.New}),this.usages.push(n),this.notifyUpdate({create:[n]})}duplicateNode(e){const{options:t}=e,n=t?{...t}:{};return n.icons=[],new r(n)}destroyNode(e){this.usages=this.usages.filter(t=>e._id!==t._id),this.notifyUpdate({detach:[e]})}addNode(e){let n=null;(n=e||this.findFirstModifiedNode())&&t.isNodeRemove(n)?this.udpateAsNewNode(n):this.createAndAddNode()}addNodeAsBulk(e){this.usagesAddedAsBulk=e,this.notifyBulkUpdate({createAsBulk:e})}removeNode(e){e&&(t.isNodeNew(e)?this.destroyNode(e):this.udpateAsRemoveNode(e))}removeLastNode(){const e=this.findLastNonRemoveNode();return this.removeNode(e)}getModificationsResult(){const e=[],n=[],i=[];return this.usages.forEach(r=>{switch(t.getNodeStatus(r)){case t.status.Removed:n.push(r);break;case t.status.New:e.push(r);break;case t.status.Modified:i.push(r)}}),{create:e,detach:n,modify:i}}get updateSessionEvent(){return"ChangeQuantitySessionUpdate"}notifyUpdate(e){const{mediator:t}=this.appCore;t&&t.publish(this.updateSessionEvent,e)}notifyBulkUpdate(e){const t=`${this.updateSessionEvent}AsBulk`,{mediator:n}=this.appCore;n&&n.publish(t,e)}}}),define("DS/ENOXEngineer/services/MaterialCVFetch",["UWA/Core","DS/ENOXEngineer/utils/XENHttpClient","DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialNlsManager"],(e,t,n)=>{class i{async perform(n,i,r){const{pids:o,requestData:s,nls_values:a}=i||{},{fcs_url_mode:l,label:c,locale:d,tenant:u}=r||{};if(!e.is(n)||!e.is(o)||!e.is(s))throw new Error("error: MaterialCVFetch/perfom, wrong inputs");const p={...s,fcs_url_mode:l,label:c,physicalid:o,locale:d,tenant:u};try{const e=await t.perform(n,p);return Array.isArray(a)&&a.length&&await this.updateAttributesWithNls(e,a,{locale:d,tenant:u}),e}catch(e){throw console.error("error: MaterialCVFetch/perfom, something get wrong with the query"),e}}async updateAttributesWithNls(t,i,r){if(!e.is(t)||!Array.isArray(i))throw console.error("error: MaterialCVFetch/updateAttributesWithNls wrong input"),new Error({});const{locale:o,tenant:s}=r||{},a=Reflect.has(t,"results")?t.results:[];if(!Array.isArray(a))throw new Error({});const l={};if(a.forEach(t=>{const{attributes:n}=t;Array.isArray(n)&&n.length&&n.forEach(t=>{Reflect.has(t,"dispValue")||-1===i.findIndex(e=>e===t.name)||(e.is(l[t.name])?l[t.name].push(t.value):l[t.name]=[t.value])})}),!Reflect.ownKeys(l).length)return;const c=await n.fetchNlsValues(l,{lang:o,tenantId:s});Reflect.ownKeys(c).forEach(e=>{a.forEach(t=>{const{attributes:n}=t;if(!Array.isArray(n)||!n.length)return;const i=n.find(t=>t.name===e);i.dispValue=c[e].get(i.value)})})}}let r=null;return r||(r=new i),r}),define("DS/ENOXEngineer/columnsFormatter/PreferredUnitColumnProvider",["UWA/Core","UWA/Class","DS/ENOXEngineer/services/EngineeringSettings","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/services/I18nManager","DS/ENOXEngineer/utils/XENHttpClient"],function(e,t,n,i,r,o,s){"use strict";return t.singleton({init:function(e){this._parent(e)},initialize:function(e){e&&(this.appCore=e.appCore||{})},getName:function(){return"convertingColumns"},buildServerInput:function(e){if(!Array.isArray(e))return null;var t={};return e.forEach(function(e){t[e.dimension]||(t[e.dimension]={}),t[e.dimension][e.toUnit]||(t[e.dimension][e.toUnit]={values:[]}),null!==e.value&&void 0!==e.value&&(Array.isArray(e.value)?t[e.dimension][e.toUnit].values.push(...e.value):t[e.dimension][e.toUnit].values.push(e.value))}),{mapping:t,inputs:this._fromMappingToInput(t)}},_fromMappingToInput:function(e){var t=Object.keys(e),n=[];return t.forEach(function(t){Object.keys(e[t]).forEach(function(i){var r=e[t][i];n.push({values:[...new Set(r.values)],dimension:t,toUnit:i})})}),n},parseAndMapResponse:function(e,t){var n={};t.forEach(function(e){var t=e.dimension+e.toUnit;n[t]||(n[t]={}),e.values.forEach(function(e){n[t][e.from]=e.to})});const i={},r={};return e.forEach(function(e){let t,o;e.nodeid||e.pid?(t=e.nodeid||e.pid,o=i):e.relid&&(t=e.relid,o=r),o[t]||(o[t]={});var s=e.dimension+e.toUnit;Array.isArray(e.value)?o[t][e.sixw+"_converted"]=n[s]&&e.value.map(e=>n[s][e])||null:o[t][e.sixw+"_converted"]=n[s]&&n[s][e.value]||null}),{pids:i,relids:r}},isRawMaterialUnits:function(e){return e==r.CONT_RAWMAT_QUANTITY_LENGTH||e==r.CONT_RAWMAT_QUANTITY_MASS||e==r.CONT_RAWMAT_QUANTITY_AREA||e==r.CONT_RAWMAT_QUANTITY_VOLUME},updateAttributes:function(e,t){if(!Array.isArray(e)||!e.length)return t([]);var n=this,i=this.buildServerInput(e).inputs.filter(function(e){if(e&&Array.isArray(e.values)&&e.values.length>0){var t=e.values.filter(function(e){return!!e});if(t.length>0)return e.values=t,!0}return!1});if(!Array.isArray(i)||!i.length)return t([]);this.appCore.dataService.dimensionsUnitsConverter(i).then(function(i){t(n.parseAndMapResponse(e,i))}).catch(function(e){console.error(e)})}})}),define("DS/ENOXEngineer/services/SessionPredicates/DicoPredicatesProvider",["DS/ENOXEngineer/services/SessionPredicates/PredicatesProvider","DS/ENOXEngineerCommonUtils/LoggerUtils","DS/ENOXEngineer/services/SessionPredicates/SessionPredicatesErrors","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/services/SessionPredicates/Utils","DS/ENOX3DSpaceAttributesMgt/services/fetchDictionaryServices"],(e,t,n,i,r,o)=>{const{WrongInput:s,DicoFetchError:a}=n,{Logger:l}=t,{constants:c}=r,d=l.create(c.SESSION_PREDICATES_LOGGER_ID,"DicoPredicatesProvider");class u extends e{init(){this.initPredicateMap(),this.initEventsCallback(),this.initWithBaseTypesAndSelectedFromDico()}async isBusy(){await super.isBusy()}initPredicateMap(){this.predicatesMap=new Map,this.predicatesMap.inputs={types:[],extensions:[]}}initEventsCallback(){this.mediator.subscribe(i.EVENT_BUILNODES_FROM_EXPAND_COMPLETED,this.onBuildNodesExpandCompleted.bind(this)),this.mediator.subscribe(i.EVENT_ATTR_DICO_UPDATED,this.updateWithSelectedDicoTypesAndExtensions.bind(this)),this.mediator.subscribe(i.EVENT_UPDATE_SESSIONPREDICATE,this.updateWithTypesAndExtensions.bind(this))}initWithBaseTypesAndSelectedFromDico(){const e=this.supportedBasicTypesList,t=this.getSelectedTypesFromDico(),n=this.getSelectedExtensionsFromDico(),i={types:r.removeDuplicates([...e,...t]),extensions:r.removeDuplicates([...n])};this.fillPredicatesMapWith(i)}updateWithSelectedDicoTypesAndExtensions(){const e={types:this.getSelectedTypesFromDico(),extensions:this.getSelectedExtensionsFromDico()};this.fillPredicatesMapWith(e)}updateWithTypesAndExtensions(e){const t={types:Array.isArray(e.types)?e.types:[],extensions:Array.isArray(e.extensions)?e.extensions:[]};this.fillPredicatesMapWith(t)}fillPredicatesMapWith(e){const t=this.getMissingFromMapInputs(e,this.predicatesMap);if(!t.hasMissing)return;const n=this.getMissingFromWorkersInputs(t);n.hasMissing&&this.pushANewFetchWorker(n)}getMissingFromMapInputs(e){const{inputs:t}=this.predicatesMap||{};return t?r.getMissingFromRefInputs(e,t):{...e,hasMissing:!0}}getMissingFromWorkersInputs(e){const t=this.getAlFetchlWorkersInputs();return r.getMissingFromRefInputs(e,t)}getAlFetchlWorkersInputs(){const e=[],t=[];return this.getRunningJobs().forEach(n=>{const{inputs:i}=n,r=Array.isArray(i.types)?i.types:[];e.push(...r);const o=Array.isArray(i.extensions)?i.extensions:[];t.push(...o)}),{types:r.removeDuplicates(e),extensions:r.removeDuplicates(t)}}pushANewFetchWorker(e){this.startARunningJob({jobInput:e,jobToRun:this.fetchPredicatesForTypesAndExtensions.bind(this),resolveCB:this.fetchWorkerHasEndedCB.bind(this)})}async fetchPredicatesForTypesAndExtensions(e){if(!e)throw new s("DicoPredicatesProvider.fetchPredicatesForTypesAndExtensions");const t=[...Array.isArray(e.types)?e.types:[],...Array.isArray(e.extensions)?e.extensions:[]];if(!Array.isArray(t)||!t.length)throw new s("DicoPredicatesProvider.fetchPredicatesForTypesAndExtensions");const n=r.removeDuplicates(t);let i=null;try{i=await o.fetchPredicatesForClasses(n,{settingManager:this.settingManager})}catch(e){throw d.error(`error with fetchPredicatesForClasses ${e}`),new a(t)}return i}fetchWorkerHasEndedCB(e){if(!e)throw new s("DicoPredicatesProvider.fetchWorkerHasEndedCB");const{result:t,inputs:n}=e;if(Array.isArray(t)&&t.length){const e=r.formatClassesPredicatesToPropertiesPredicates(t);this.updatePredicateMapWith({inputs:n,predicates:e})}}updatePredicateMapWith({inputs:e,predicates:t}){r.udpateMapWithNewValues(this.predicatesMap,t);const{types:n,extensions:i}=e,{types:o,extensions:s}=this.predicatesMap.inputs;n.forEach(e=>{-1===o.indexOf(e)&&o.push(e)}),i.forEach(e=>{-1===s.indexOf(e)&&s.push(e)})}onBuildNodesExpandCompleted(){const e={types:this.getLoadedTypesInSession(),extensions:[]};this.fillPredicatesMapWith(e)}getPredicateProperties(e){return this.predicatesMap.get(e)||[]}getPredicatePropertiesForSelectable(e){if(!r.isAValidNotEmptyString(e))throw new s("DicoPredicatesProvider.getPredicatePropertiesForSelectable");const t=[];return this.predicatesMap.forEach(n=>{const i=n.filter(n=>{const{selectable:i}=n;return r.getAttributeFromSelectable(i)===e&&t.push(n),!1});t.push(...i)}),t}get label(){return u.name}get isPredicatesMapHasValues(){return 0!==this.predicatesMap.size}get settingManager(){return this.appCore.settingManager||{}}get mediator(){return this.appCore.mediator||{}}get dicoService(){return this.appCore.dicoService||{}}getSelectedExtensionsFromDico(){return this.dicoService.getSelectedExtensions()}getSelectedTypesFromDico(){return this.dicoService.getSelectedTypes()}getLoadedTypesFromDico(){return this.dicoService.getLoadedTypes()}getLoadedTypesInSession(){const e=this.getLoadedTypesFromDico();return Reflect.ownKeys(this.supportedBasicTypesMap).reduce((t,n)=>{return this.supportedBasicTypesMap[n].forEach(i=>t.push(...e[n][i])),t},[])}get supportedBasicTypesMap(){return{kindOf3DShape:["3DShape"],kindOfDocument:["Document"],kindOfMaterial:["dsc_matref_ref_Core"],kindOfDrawing:["Drawing"],kindOfEngItem:["VPMReference","Raw_Material"]}}get supportedBasicTypesList(){return Reflect.ownKeys(this.supportedBasicTypesMap).reduce((e,t)=>(e.push(...this.supportedBasicTypesMap[t]),e),[])}}return d.enable?class extends u{init(){super.init(),d.log("init done")}async isBusy(){const e=Date.now();await super.isBusy();const t=Date.now()-e;d.log(`isBusy resolved in ${t} ms`)}onBuildNodesExpandCompleted(){d.log(`${i.EVENT_BUILNODES_FROM_EXPAND_COMPLETED} received`),super.onBuildNodesExpandCompleted()}getPredicateProperties(e){d.log(`getPredicateProperties for (${e})`);const t=super.getPredicateProperties(e);return d.log(`found ${t.length} properties`),t}}:u}),define("DS/ENOXEngineer/services/OpenWithService",["UWA/Core","UWA/Class","DS/i3DXCompassPlatformServices/OpenWith","UWA/Class/Promise","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/Utils"],function(e,t,n,i,r,o){"use strict";return t.singleton({init:function(e){this.option=e},initialize:function(e){this.app=e},getOpenWithMenu:function(t,i){var o=this;let s=[];var a=new n;if(e.is(a.retrieveCompatibleApps,"function"))return r.wrappedWithCancellablePromise(function(e,n){o.app.core.Factories.ListItemFactory.getContentForOpenWithMenu(t,i).then(function(t){a.set3DXContent(t),a.retrieveCompatibleApps(function(t){t.forEach(function(e){s.push(o.getSubmenuOptions(e,i))}),e(s)})})})},getSubmenuOptions:function(e,t){return{id:e.text,title:e.text,icon:e.fonticon?e.fonticon:e.icon,type:"PushItem",multisel:!1,action:{context:t,callback:e.handler}}}})}),define("DS/ENOXEngineer/services/CommandsService",["UWA/Class","UWA/Core","UWA/Class/Promise","DS/PlatformAPI/PlatformAPI","DS/Menu/Menu","DS/ApplicationFrame/CommandsManager","DS/ENOXEngineer/services/OpenWithService","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineerCommonUtils/XENTracker","DS/Controls/TooltipModel","DS/ENOXEngineer/commands/DocumentManagementCmdV2","text!DS/ENOXEngineer/assets/config/Commands.json","text!DS/ENOXEngineer/assets/config/MenuInfos.json"],function(e,t,n,i,r,o,s,a,l,c,d,u,p,g){"use strict";return e.singleton({init:function(e){this._commandConfig=JSON.parse(p),this._menuInfos=JSON.parse(g),this._commandsLaunchedWithDelay=new Map},initialize:function(e,t){var n=this;n.app=e,n.app.core.commandManager=n,n._refreshedSubscription=i.subscribe("DS/PADUtils/PADCommandProxy/authored",function(t){e.core.sessionManager.setAuthoringMode("authoring")}),this._eventToken=e.mediator.subscribe(a.EVENT_LAUNCH_COMMAND,function(e){n._commandsListener(e)}),t||e.mandatoryStartupPromises.push(n.loadAllCommands()),e.optionalStartupPromises.push(this.app.core.dataService.loadConfigurationSettings()),e.optionalStartupPromises.push(n._getCommandSettings())},_getCommandSettings:function(){return l.wrappedWithCancellablePromise((e,t)=>{this.app.core.dataService.getCommandSettings().then(t=>{const n=JSON.parse(t);return this._isMaterialQuantityAuthorized=n.materialUsageAuthorization,this._isExportNoLimit=n.exportNoLimit,this._isBSDCommandsActivated=n.ActivateBSDCommands,this._isReportGeneratorActivated=n.ActivateReportProducerCommands,e(t)}).catch(e=>(this._isMaterialQuantityAuthorized=!1,this._isExportNoLimit=!1,this._isBSDCommandsActivated=!1,this._isReportGeneratorActivated=!1,t(e)))})},_getObjectAdditionnalData:function(e){return Array.isArray(e)?{}:{revision:e.getReferenceVersion?e.getReferenceVersion():"",type:e.getType()}},showMenu:function(e,t){if("function"==typeof t.then&&"object"==typeof t)n.allSettled(t).then(function(t){for(let e in t){var n=[];n=n.concat(t[e].value)}r.show(n,{position:{x:e.left,y:e.bottom},submenu:"outside"})});else{if(!e||!Array.isArray(t))throw new Error("unable to build the menu");r.show(t,{position:{x:e.left,y:e.bottom},submenu:"outside"})}},renderMenu:function(e,t){e&&t&&this.showMenu(e,this.getMenu(t))},renderIdCardMenu:function(e){e&&this.getIDCardMenu().then(t=>{this.showMenu(e,t)})},getIDCardMenu:function(){return this.getMenu("root")},isMaterialQuantityAuthorized:function(){return!!this._isMaterialQuantityAuthorized&&this._isMaterialQuantityAuthorized},isExportWithNoLimit:function(){return!!this._isExportNoLimit&&this._isExportNoLimit},isBSDCommandsActivated:function(){return!!this._isBSDCommandsActivated&&this._isBSDCommandsActivated},isReportGeneratorActivated:function(){return!!this._isReportGeneratorActivated&&this._isReportGeneratorActivated},getMenu:function(e){var t={};const n=this.app.core.contextManager.getActiveEngItem(),i=n&&n.hasValidTransientGroupingContext()?e=>e._isFromOriginalModel()||e.isGroupFromExpand():null;var r=this.app.core.contextManager.getXENTreeDocument().getSelectedNodes(e,i),o=this.getSelectionInfos(r),s=this.getAllActionIds(o),a=this._getTemplateMenu(e);if(t=this._allowSubMenu(a,e)?this._buildSubMenu(s,a,e):this.buildMenu(s,a,e),this.areAllSelectedNodesDocuments(r)){var l=this.buildDocumentMenu(a,e);return this.getMenuWithDocCommands(t,l)}return t},getAllActionIds:function(e){var t=[];if(0===e.nbSelected)return t;var n=this.getCommandRepo();for(var i in n){var r=this.getCommandMetaData(i);let n=!0;var o=-1!==e.filteredCommands.indexOf(r.commandHdr),s=!0,l=e.types,c=r.authorizedTypes;void 0!==c?l.forEach(function(e){-1===c.indexOf(e)&&(s=!1)}):c=!0;var d=void 0!==r.edit&&!1===r.edit||e.editable,u=void 0===r.nbSelectedMax||r.nbSelectedMax>=e.nbSelected,p=void 0===r.nbSelectedRefMax||r.nbSelectedRefMax>=e.nbRefSelected,g=!(!u||!p),h=!0===r.multiType||1===e.types.length,m=!0;!0===r.availabilityOnCheckedOut?m=e.checkedOut:!1===r.availabilityOnCheckedOut&&(m=!e.checkedOut);var f=!0;this.app.core.PreferencesManager.isSpecInProductStructureEnabled()||r.commandHdr!=a.ADD_NEW_DOC_CMD&&r.commandHdr!=a.ADD_EXISTING_DOC_CMD||(f=!1),r.commandHdr==a.INSERT_NEW_ENG_ITEM&&this.app.core.PreferencesManager.isUserSelectedTypeChooserOption()?n=!1:r.commandHdr!=a.CREATE_NEW_CONTENT||this.app.core.PreferencesManager.isUserSelectedTypeChooserOption()||(n=!1),s&&d&&g&&h&&!o&&m&&f&&n&&t.push(r)}return t},_allowSubMenu:function(e,t){let n=!1,i=this.app.core.contextManager.getXENTreeDocument().getSelectedNodes(t);return n=!this.app.core.contextManager.isMultiselMenu()&&1===i.length&&Array.isArray(e)&&e.find(function(e){return"menu"===e.type}),this.app.core.contextManager.setMultiselMenu(!1),n},_buildSubMenu:function(e,t,n){var i=this;return s.getOpenWithMenu(n).then(function(r){return i.buildMenu(e,t,n,r)}).catch(function(e){console.warn(e)})},buildDocumentMenu:function(e,t){var n=this;return u.prototype.getDocumentV2Commands(n.app).then(function(i){return n.buildMenu([],e,t,void 0,i)}).catch(function(e){console.warn(e)})},getMenuWithDocCommands:function(e,t){let i=[];return i.push(e),i.push(t),new n((e,t)=>{n.allSettled(i).then(function(t){var n=[...t[1].value,...t[0].value];for(let e in n)if("Open with"==n[e].title){let t=n.splice(e,1);n.unshift(t[0]);break}return e(n)})})},areAllSelectedNodesDocuments:function(e){let t=!1;for(let n in e)if(!(t=!!e[n].isDocument()))break;return t},buildMenu:function(e,t,n,i,r){var o=this,s=[];return t.forEach(function(t){if("group"===t.type){var a=t.commands,l=o.buildMenu(e,a,n);l.length>0&&s.push(o._buildMenuGroup(o.getGroupMetaData(t.ID),"PushItem",l))}else"title"===t.type?s.push({type:"TitleItem",title:o.app.core.i18nManager.get(t.ID),state:"enabled"}):"separator"===t.type?s.push({type:"SeparatorItem"}):"command"===t.type?e.forEach(function(e){e.commandHdr!==t.ID||s.push(o._buildMenuEnty(e,"PushItem",[],n))}):"menu"===t.type?i&&Array.isArray(i)&&i.length>0&&s.push({type:"PushItem",icon:"fonticon fonticon-open-menu-dot",submenu:i,title:o.app.core.i18nManager.get("open_with")}):r&&"DOCUMENT_MENU"===t.ID&&Array.isArray(r)&&(s=s.concat(r))}),this._cleanMenu(s)},_cleanMenu:function(e){var t=[];if(e&&Array.isArray(e)&&e.length>0)for(var n=0;n<e.length;n++){var i=e[n];if("SeparatorItem"===i.type){if(0===n)continue;if(n===e.length-1)continue;if("SeparatorItem"===e[n+1].type)continue}if("TitleItem"===i.type){if(n===e.length-1)continue;if("TitleItem"===e[n+1].type)continue}t.push(i)}return t},_buildMenuEnty:function(e,t,n,i){var r=this;const o={title:r.app.core.i18nManager.get(e.nls_key),type:t,fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-"+e.fonticon},action:{this:this,callback:function(t){r.commandHandler(e,n,i)}}};return e.tooltip&&(o.tooltip=e.tooltip),o},_buildMenuGroup:function(e,t,n){return{title:this.app.core.i18nManager.get(e.nls_key),type:t,fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-"+e.fonticon},submenu:n}},getGenericMenuEnty:function(e){if(!(e.callback instanceof Function&&e.nls_key))throw new Error("invalid menu input");var t={title:this.app.core.i18nManager.get(e.nls_key),type:e.type?e.type:"PushItem",state:e.state?e.state:"unselected",action:{this:this,callback:function(){e.callback.apply(null,e.args)}}};return e.fonticon&&(t.fonticon={family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-"+e.fonticon}),e.icon&&(t.icon=this.app.core.settingManager.getIconUrl(e.icon),delete t.fonticon),t},getSelectionInfos:function(e){var t,n=e.length,i=[];this.app.core.contextManager.getActiveEngItem()&&!this.app.core.settingManager.isConfigAuthorized()&&i.push("EditConfigContext"),this.app.core.settingManager.isConfigAuthorized()||(i.push("CopyVariantEffectivity"),i.push("PasteVariantEffectivity"),i.push("EditVariant"),i.push("CopyEvolutionEffectivity"),i.push("PasteEvolutionEffectivity"),i.push("EditEvolution"),i.push("ExtendEvolutionEffectivity")),this.app.core.settingManager.isProductConfEnabled()||(i.push("addProductConfiguration"),i.push("UPSAuthReplaceByProductConfiguration"),i.push("CfgReplaceInstantiatedConfigurationByRevision")),(!this.isBSDCommandsActivated()||this.app.core.sessionManager.shouldShowFinalItems()||this.app.core.sessionManager.shouldShowLeafMaterials())&&(i.push("AssociateTerminologiesCommand"),i.push("AssociateTermsCommand"),i.push("TerminologyManagementCommand")),this.isMaterialQuantityAuthorized()||i.push("addNewMaterialQuantity"),this.isReportGeneratorActivated()||(i.push("ReportWizardCommand"),i.push("ListReportsCommand")),e[0]&&e[0].options&&e[0].options.grid&&e[0].options.grid[a.CONST_DS6W_DEFORMABLE]||i.push("XENG_OPEN_DEFORMABLE_ENG_ITEM"),"recents_items"===this.app.router.getState().name||i.push("RemoveRecentCmd"),this.app.core.PreferencesManager.isUserSelectedTypeChooserOption()?i.push(a.INSERT_NEW_ENG_ITEM):i.push(a.CREATE_NEW_CONTENT),this.app.core.PreferencesManager.isSpecificationsTabEnabled()&&(i.push(a.ADD_NEW_DOC_CMD),i.push(a.ADD_EXISTING_DOC_CMD));var r=e.filter(function(e){return!!e._isFromOriginalModel()});if(r.length>0&&(this.app.core.sessionManager.shouldShowFinalItems()||this.app.core.sessionManager.shouldShowMfgView()||this.app.core.sessionManager.shouldShowLeafMaterials()?(i.push("ChangeTheQuantity"),i.push("ChangeMassQuantity"),i.push("ChangeVolumeQuantity")):r[0].isMaterialQuantity()?(i.push("ChangeVolumeQuantity"),i.push("ChangeMassQuantity"),r[0].getMassQuantity()?i.push("ChangeVolumeQuantity"):r[0].getVolumeQuantity()&&i.push("ChangeMassQuantity")):(i.push("ChangeMassQuantity"),i.push("ChangeVolumeQuantity"))),e.filter(e=>Reflect.has(e,"isGroupFromExpand")&&e.isGroupFromExpand()).length&&(i.push("RelatedObjectsHdr"),r.length||i.push("edit-properties")),(this.app.core.sessionManager.shouldShowFinalItems()||this.app.core.sessionManager.shouldShowQuantityView()||this.app.core.sessionManager.shouldShowMfgView()||this.app.core.sessionManager.shouldShowLeafMaterials()||this.app.core.sessionManager.shouldShowFlatView())&&(i.push("UPSAuthRevisionUpdate"),i.push("UPSAuthCmdUpdateRevOnEntireStructure")),this.app.core.sessionManager.shouldShowQuantityView()&&i.push("SelectByConfigurationCriteria"),e.find(e=>e.isGrouped())&&i.push("Unified_Export"),e.find(e=>"3DShape"==this.app.core.dicoService.syncIsA3DShape(e.options.type))&&(i.push("UPSAuthCut"),i.push("UPSAuthCopy"),i.push("UPSAuthPaste"),i.push("UPSReplaceByLatestRevision"),i.push("UPSAuthReplaceByExisting"),i.push("UPSAuthReplaceByRevision")),e.find(e=>"Drawing"==this.app.core.dicoService.syncIsADrawing(e.options.type))&&i.push("UPSAuthPaste"),n>1){for(var o=e[0].getParentIdFromOccrencePath(),s=1;s<n;s++)o!=e[s].getParentIdFromOccrencePath()&&(o="");""==o&&(i.push("EditVariant"),i.push("PasteVariantEffectivity"))}var l=[],c=[],d=!1,u=[];if(Array.isArray(e)&&e.length>1)for(let t in e)if(e[0].getParent().getID&&e[t].getParent().getID&&e[0].getParent().getID()!=e[t].getParent().getID()){i.push("ChangeTheQuantity");break}return e.forEach(function(e){var t="function"==typeof e.getGlobalType?e.getGlobalType():e.getType();-1===l.indexOf(t)&&l.push(t),-1===c.indexOf(e.getID())&&c.push(e.getID()),d=e.options.checkedOut,u=e.options.files}),t=c.length,{types:l,editable:!0,nbSelected:n,nbRefSelected:t,filteredCommands:i,checkedOut:d,files:u}},getCommandMetaData:function(e){return this._commandConfig[e]},getCommandRepo:function(){return this._commandConfig},getGroupMetaData:function(e){return this._menuInfos.groupsInfos[e]||null},_getTemplateMenu:function(e){return this._menuInfos.templates[e]||[]},_commandsListener:function(e){var t=this;t.executeCommand(e.commandId,function(){t.prepareCmdInput(t._commandConfig[e.commandId],e.context)})},_getReferenceNodeLength:function(e){if(e&&e.length<=0)return 0;e[0].getID();var t=[];return e.forEach(function(e){var n=e.getID();-1===t.indexOf(n)&&t.push(n)}),t.length},commandHandler:function(e,n,i){if(t.is(e)){var r=this;this.executeCommand(e.commandHdr,function(){var t=this.app.core.contextManager.getXENTreeDocument().getSelectedNodes(i);switch(e.commandHdr){case"XENG_OPEN_ENG_ITEM":1===this._getReferenceNodeLength(t)&&this.app.core.sessionManager.setNextOpenContext({objectId:t[0].getID(),objectType:t[0].getType(),itemListModel:t[0]});break;case"XENG_OPEN_DEFORMABLE_ENG_ITEM":1===this._getReferenceNodeLength(t)&&this.app.core.sessionManager.setNextOpenContext({objectId:t[0]&&t[0].options&&t[0].options.grid&&t[0].options.grid[a.CONST_DS6W_DEFORMABLE]?t[0].options.grid[a.CONST_DS6W_DEFORMABLE]:void 0,objectType:t[0].getType()});break;case"UPSReplaceByLatestRevision":case"UPSAuthReplaceByExisting":case"UPSAuthReplaceByRevision":case"UPSAuthReplaceByDuplicate":case"UPSAuthUnparent":if(this.app.core.sessionManager.shouldShowQuantityView()){let e=[];for(let i=0;i<t.length;i++){var n=t[i];if(n&&n.getUsages&&Array.isArray(n.getUsages())){let t=n.getUsages();t.forEach(function(e){e._setParent(n.getParent())}),e=e.concat(t)}else e.push(t[i])}this.app.core.contextManager.addSelection(e,!0)}else{let e=[],n=this.app.core.Factories&&this.app.core.Factories.ListItemFactory&&this.app.core.Factories.ListItemFactory.getGroupInstanceClass&&this.app.core.Factories.ListItemFactory.getGroupInstanceClass();Array.isArray(t)&&t.forEach(function(t){n&&t&&t.getParent&&t.getParent()instanceof n&&t._setParent(t.getRealParent()),e.push(t)}),this.app.core.contextManager.addSelection(e,!0)}break;case"ActionBar_NewProductCmd":case"ActionBar_InsertNewProductCmd":case"addExisting":case"ActionBar_NewPartCmd":case"ActionBar_InsertNewPartCmd":case"addNewMaterialQuantity":case"addProductConfiguration":case"ActionBar_InsertNewDrawingCmd":case"XENG_ADD_EXISTING_DRAWING":case"addNewMaterialQuantity":case"XENG_ADD_NEW_DOC":case"XENG_ADD_EXISTING_DOC":case"addExistingRawMaterialQuantity":case"NewContent":case"UPSAuthInsertDuplicate":t.forEach(e=>{e.expand()}),this.app.core.contextManager.addSelection(t,!0);break;case"ExpandCmd":case"ExpandAllLevelCmd":case"ExpandNLevelCmd":r.app.core.contextManager.getActiveEngItem&&r.app.core.contextManager.getActiveEngItem()&&(r.app.core.contextManager.getActiveEngItem().hasValidTransientNextGenFilter()||r.app.core.contextManager.getActiveEngItem().hasValidPersistedNextGenFilter()||r.app.core.sessionManager.shouldShowMfgView())||r._emptyChildren(t),this.app.core.contextManager.addSelection(t,!0);break;case"UPSAuthCmdUpdateRevOnEntireStructure":t[0].options.resourceid=t[0].options.referenceId,this.app.core.contextManager.addSelection(t,!0);break;default:this.app.core.contextManager.addSelection(t,!0)}}.bind(this))}return null},executeCommand:function(e,t){var n=this;if(!e)throw new Error("commandId is a mandatory parameter");if(!n._commandConfig[e])throw new Error("inexistant command");var i=n._commandConfig[e];n.commandLoaderStatus.then(function(){const e=n.app.core.sessionManager.getCurrentViewOptions();c.trackCommandLaunched(i.commandHdr,e),t&&t();var r=null;switch(r=1==i.CATAfrHeaderCheck?o.getCommandCheckHeader(i.commandHdr,widget):o.getCommand(i.commandHdr,widget),n.app.core.contextManager.setCurrentRunningCmd(i.commandHdr),i.commandHdr){case"edit-properties":i.context&&i.context.facetName&&(r._arguments=[i.context.facetName])}if(Reflect.has(i,"launchDelay")){if(n._commandsLaunchedWithDelay.has(i.commandHdr))return void console.warn(`CommandsService -> command ${i.commandHdr} has already been launched`);const e=Number.isInteger(i.launchDelay)?i.launchDelay:1e3;console.log(`CommandsService -> adding command  ${i.commandHdr} to delay stack`),n._commandsLaunchedWithDelay.set(i.commandHdr,setTimeout(()=>{n._commandsLaunchedWithDelay.delete(i.commandHdr),console.log(`CommandsService -> removing command  ${i.commandHdr} from delay stack`)},e))}n.launchCommand(r),n.app.mediator.subscribe(a.EVENT_CLOSE_RUNNING_CMD,function(){let e=n.app.core.contextManager.getCurrentRunningCmd(),t=n._commandConfig[e];o.getCommand(t.commandHdr,widget).cancel()})})},launchCommand:function(e){"CATAfrHeaderCheck"==e.options.Behavior?e.toggleState():["EditVariant","EditEvolution"].indexOf(e.getId())>=0?e.begin(!1):e.begin()},loadAllCommands:function(){var e=this,t=[];for(var i in this._commandConfig)if(this._commandConfig.hasOwnProperty(i)){var r=e._commandConfig[i],o=new n(function(t,n){e.loadCommand(r,t,n)});t.push(o)}return e.commandLoaderStatus=n.allSettled(t),e.commandLoaderStatus},loadCommand:function(e,t,n){if(!e||!e.commandHdr||!e.AmdLoader)return console.error("Oups ! no valid command description"),void n("Oups ! no valid command description");e.loadHelpRsc&&(e.tooltip=new d({mouseRelativePosition:!0,allowUnsafeHTMLShortHelp:!0,allowUnsafeHTMLLongHelp:!0}),e.tooltip.loadFromHelpRscFile(e.loadHelpRsc.helpResourceFile,e.loadHelpRsc.resourceID));var i=this;return require([e.AmdLoader],function(r){var o={context:i.app.core.contextManager.getContext(),ID:e.commandHdr};e.isInternalCmd&&(o.appCore=i.app.core),"HistoryHdr"===e.commandHdr&&(o.context.infoForCustomization=i.app.core.settingManager.getRevisionsCommandCustomization()),void 0!==e.activeTopBar&&(o.activeTopBar=e.activeTopBar);try{new r(o)}catch(e){n(e)}t()},function(e){n(e)})},prepareCmdInput:function(e,t){switch(e.context=t,e.commandHdr){case"ActionBar_NewProductCmd":case"ActionBar_InsertNewProductCmd":if(t&&t.isInsert){if(!this.app.core.contextManager.getActiveEngItem())return void console.error("you should select a parent")}else this.app.core.contextManager.resetSelection();break;case"XENG_UPDATE_WIDGET_TITLE":break;case"XENG_OPEN_ENG_ITEM":this.app.core.sessionManager.setNextOpenContext(t.item);break;case"Import":break;case"ActionBar_NewPartCmd":case"ActionBar_InsertNewPartCmd":case"XENG_ADD_EXISTING_DRAWING":case"ActionBar_InsertNewDrawingCmd":case"NewContent":break;case"addNewMaterialQuantity":case"addExistingRawMaterialQuantity":this.app.core.sessionManager.setMaterialForInsertContext(t.item);break;case"UPSAuthReorderProduct":this.app.core.contextManager.addSelection(t.item,!0);break;case"ExpandCmd":case"ExpandAllLevelCmd":case"ExpandNLevelCmd":this.app.core.contextManager.getActiveEngItem&&this.app.core.contextManager.getActiveEngItem()&&(this.app.core.contextManager.getActiveEngItem().hasValidTransientNextGenFilter()||this.app.core.contextManager.getActiveEngItem().hasValidPersistedNextGenFilter()||this.app.core.sessionManager.shouldShowMfgView())||this._emptyChildren(t.item),this.app.core.contextManager.addSelection(t.item,!0);break;default:if(t.item){var n=t.item;Array.isArray(n)||(n=[t.item]);for(var i=0;i<n.length;i++)n[i].object=this._getObjectAdditionnalData(n[i]);this.app.core.contextManager.addSelection(n,!0)}}},_emptyChildren:function(e){e.forEach(e=>{e.options.childComputed=!e.options.childComputed&&e.options.childComputed,e.options.children=e.options.children?[]:e.options.children})}})}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/MaterialChangeQuantityViewModel",["UWA/Core","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityNodeUtils","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityViewModel","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/services/I18nManager"],(e,t,n,i,r,o)=>{const s=`${i.CONT_QUANTITY_MASS}_reference`,a=`${i.CONT_QUANTITY_VOLUME}_reference`;return class extends n{initViewOptions(e){e.addRemoveNodeAuthorized=!1,e.editableProperties.push(...[i.DECLARED_VOLUME,i.CONT_QUANTITY_MASS,i.CONT_QUANTITY_VOLUME])}set nodes(e){super.nodes=e,e.forEach(e=>{let t=null,n=null;e.hasMassQuantity()?(t=e.getMassQuantity(),n=s):e.hasVolumeQuantity()&&(t=e.getVolumeQuantity(),n=a),this.setQuantityReferenceValueAndGetter(e,n,t)})}setQuantityReferenceValueAndGetter(e,n,i){if(!e||!n||Number.isNaN(i))return;const r={};r[`${n}`]=parseFloat(i),t.updateNodeOptions(e,{grid:r}),e.getQuantityReferenceValue=(()=>e.options.grid[n])}get nodes(){return super.nodes}getNodeReferenceValue(e){return e&&e.getQuantityReferenceValue?e.getQuantityReferenceValue():null}computeNodeRollUpValue(e,t,n){return!e||Number.isNaN(t)?null:(n&&n.useReference?this.getNodeReferenceValue(e):null)||parseFloat(t)}getRollup(e,t){let n=0,i=0;e.forEach(e=>{const r=e.hasVolumeQuantity();if(r){const n=this.computeNodeRollUpValue(e,r,t);return void(n&&(i+=n))}const o=e.hasMassQuantity();if(o){const i=this.computeNodeRollUpValue(e,o,t);i&&(n+=i)}});const r=[];if(n){const e=this.appCore.PreferencesManager.getNLSValueForMassQuantity();r.push(`${n} ${e}`)}if(i){const e=this.appCore.PreferencesManager.getNLSValueForVolumeQuantity();r.push(`${i} ${e}`)}return r.join(" + ")}get editableProperties(){return[i.DECLARED_VOLUME,i.CONT_QUANTITY_MASS,i.CONT_QUANTITY_VOLUME]}getColumns(){let e=[];e.push(...super.getColumns());const t=-1!==this.usages.findIndex(e=>e.hasMassQuantity());if(t){const t=e.find(e=>e.dataIndex===i.CONT_QUANTITY_MASS);t&&(t.pinned="left",t.width=100,t.getCellSemantics=(()=>({minValue:0})))}else e=e.filter(e=>e.dataIndex!==i.CONT_QUANTITY_MASS);const n=-1!==this.usages.findIndex(e=>e.hasVolumeQuantity());if(n){const t=e.find(e=>e.dataIndex===i.CONT_QUANTITY_VOLUME);t&&(t.pinned="left",t.width=100,t.getCellSemantics=(()=>({minValue:0})))}else e=e.filter(e=>e.dataIndex!==i.CONT_QUANTITY_VOLUME);return(n||t)&&e.push({pinned:"left",width:100,editableFlag:!1,text:o.get("savedQuantityColumnTitle"),getCellValue:this.getCellQuantityReferenceValue.bind(this),visibleFlag:!1,dataIndex:"getQuantityReferenceValue"}),e}getCellQuantityReferenceValue(e){const{nodeModel:t}=e;let n=null;return t.getQuantityReferenceValue&&(n=t.getQuantityReferenceValue()),n}getCellMassEditableState(t){return!!(e.is(t)&&e.is(t.nodeModel)&&e.is(t.nodeModel.hasMassQuantity))&&t.nodeModel.hasMassQuantity()}getCellVolumeEditableState(t){return!!(e.is(t)&&e.is(t.nodeModel)&&e.is(t.nodeModel.hasVolumeQuantity))&&t.nodeModel.hasVolumeQuantity()}computeGridForMassUpdate(e,t){const n={};return n[i.CONT_QUANTITY_MASS]=t,n[`${i.CONT_QUANTITY_MASS}_converted`]=t,n}computeGridForVolumeUpdate(e,n){const r={};return t.hasGridAttributeValued(e,i.DECLARED_VOLUME)?r[i.DECLARED_VOLUME]=n:r[i.CONT_QUANTITY_VOLUME]=n,r[`${i.CONT_QUANTITY_VOLUME}_converted`]=n,r}setCellQuantityValue(e,t,n){const i=e.nodeModel.getID(),r=this.usages.filter(e=>e.getID()===i),o=t.toString();r.forEach(e=>{const i=n===s?this.computeGridForMassUpdate(e,o):this.computeGridForVolumeUpdate(e,o),r=this.getNodeReferenceValue(e);t!==r?this.udpateAsModifyNode(e,i):this.udpateAsNonModifyNode(e,i)})}setCellMassQuantityValue(e,t){return this.setCellQuantityValue(e,t,s)}setCellVolumeQuantityValue(e,t){return this.setCellQuantityValue(e,t,a)}findFirstModifiedNode(){return this.usages.find(e=>t.isNodeModified(e))}executeChangeQuantity({modify:e}){const t=[];e.forEach(e=>{e.hasMassQuantity()?t.push({physicalid:e.getID(),quantity:{name:i.DIMENSION_MASS,value:e.getMassQuantity(),unit:widget.getValue(i.PREFERRED_MASS_UNIT)}}):e.hasVolumeQuantity()&&t.push({physicalid:e.getID(),quantity:{name:i.DIMENSION_VOLUME,value:e.getVolumeQuantity(),unit:widget.getValue(i.PREFERRED_VOLUME_UNIT)}})}),t.length&&this.appCore.dataService.modifyQuantityOnMaterial({items:t}).then(e=>{let t=[];t=this.appCore.sessionManager.shouldShowQuantityView()&&this.referenceNode?[this.referenceNode.getID()]:e.references.map(e=>e.physicalid),this.appCore.mediator.publish(i.EVENT_REFRESH_ITEMS_BY_IDS,t)}).catch(e=>{let t="modifyQuantityFailed";if(Reflect.has(e,"response")){const{response:n}=e;if(Reflect.has(n,"internal"))switch(n.internal){case"no right access":t="error.ERR_RightAccess"}}r.errorAlert(this.appCore.i18nManager.get(t))})}duplicateNode(e){const t=super.duplicateNode(e);return["hasMassQuantity","hasVolumeQuantity","getMassQuantity","getVolumeQuantity","getQuantityReferenceValue"].forEach(n=>{Reflect.has(e,n)&&(t[n]=e[n].bind(t))}),t}}}),define("DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialSections",["UWA/Core","UWA/Class","DS/Controls/Expander","DS/Controls/Loader","DS/ENOXEngineer/services/MaterialCVFetch","DS/ENOXEngineer/services/MaterialService","WebappsUtils/WebappsUtils","DS/ENOXEngineer/commands/MaterialFacet/ENOXMaterialCommandManager","DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialApplyPanel","DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialListPanel","DS/ENOXEngineer/services/MaterialConstants","DS/Handlebars/Handlebars","text!DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialExpandSectionContent.html","css!DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialExpandSectionContent.css"],(e,t,n,i,r,o,s,a,l,c,d,u,p)=>{const{MaterialType:g}=d;class h extends t{constructor(t){super(t),this.facet=e.is(t.facet)?t.facet:null,this.appCore=e.is(t.appCore)?t.appCore:null,this._container=e.createElement("div",{class:"material-section"}),this._buildSkeleton(t),this._processingdMatIds=null,this.authoringIsRunning=!1,this.authoringEventTokens=[],this.authoringEventTokens.push(this.appCore.mediator.subscribe("event-authoring-material-start",this.onAuthoringMaterialStart.bind(this))),this.authoringEventTokens.push(this.appCore.mediator.subscribe("event-authoring-material-end",this.onAuthoringMaterialEnd.bind(this)))}destroy(){this.authoringEventTokens.forEach(e=>this.appCore.mediator.unsubscribe(e)),this.authoringEventTokens=[]}get commandManager(){return a}get content(){return this._container}get commandMenuEntryforCommandManager(){return null}get isApplyCommandAvailable(){return!1}update(e,t){return this._update(e,t)}get idsBeingProcessing(){return this._processingdMatIds}set idsBeingProcessing(e){this._processingdMatIds=e}get materialListPanel(){return this._materialList}_isIdsCurrentlyDisplayed(e){if(Array.isArray(this.idsBeingProcessing)&&Array.isArray(e)){if(this.idsBeingProcessing.length!=e.length)return!1;for(const t of e){if(-1===this.idsBeingProcessing.findIndex(({physicalid:e})=>t.physicalid===e))return!1}return!0}return!1}_update(t,n){return this.authoringIsRunning||this._isIdsCurrentlyDisplayed(t)?Promise.reject("update already running"):(this.materialListPanel.empty(),Array.isArray(t)&&t.length?new Promise((i,r)=>{this.idsBeingProcessing=t;const o=t.map(t=>{const i=e=>n.find(t=>e===t.physicalid),r=(t,n)=>e.is(n)?{...t,...n}:t,o=r(t,i(t.physicalid));if(e.is(o.partial)&&e.is(o.partial.support)){const e=t.partial.support,n=i(e.physicalid);o.partial.support=r(e,n)}return o});this._fetchMaterialInfos(o).then(e=>{this.materialListPanel.fill(e),this._updateViewFromModel(),this.idsBeingProcessing=null,i()}).catch(e=>{this.idsBeingProcessing=null,r(e)})}):(this._updateViewFromModel(),Promise.resolve([])))}_updateViewFromModel(){this._updateEltList.forEach(e=>{e[Symbol.for("updateView")]()})}onAuthoringMaterialStart({cmd:e,payload:t}){this.authoringIsRunning=!0,this.displayLoadingMode()}onAuthoringMaterialEnd(e,t){this.authoringIsRunning=!1}displayLoadingMode(){this.content.getElement(".section-material-list").hide(),this.content.getElement(".section-material-apply").hide(),this.content.getElement(".section-material-loading").show()}_buildSkeleton(t){const r=u.compile(p),o=e.createElement("div",{html:r()}),s=new l({...t,onApplyEvent:()=>{const e={context:this.appCore.contextManager.getContext(),searchManager:this.appCore.dataService.searchManager,getSelectedItems:this.getSelectedItems.bind(this),materialType:this.managedMaterialType};this.commandManager.executeCommand({commandHeader:"apply-material",cmdOptions:e})},onDnDEvent:({dataText:t})=>{e.is(t)&&"string"==typeof t||(t='{"data":{"items":[]}}');const n=JSON.parse(t),{data:i}=n;if(e.is(i)&&Array.isArray(i.items)){const e={context:this.appCore.contextManager.getContext(),getSelectedItems:this.getSelectedItems.bind(this),materialType:this.managedMaterialType,getDnDSelectedItems:()=>i.items},t="apply-material";this.commandManager.executeCommand({commandHeader:t,cmdOptions:e})}}}),a=o.getElement(".section-material-apply");s.content.inject(a),this._addElementToUpdateList(s,()=>{if(this.materialListPanel.isReferenceEmpty)if(this.isApplyCommandAvailable){const{dsModel:e}=a.querySelector("#material-apply-button")||{},[t]=this.getSelectedItems()||[];this.isAccessToSupportMaterialAvailable(t).then(n=>{const{references:i}=n,r=i.find(e=>e.physicalid===t);let o=!r||!r.supportAccessAvailable;e&&(e.disabled=o)}).catch(()=>{e&&(e.disabled=!0)}).finally(a.show())}else a.hide();else a.hide()});const d=o.getElement(".section-material-list-empty");this._addElementToUpdateList(a,()=>{this.materialListPanel.isEmpty?this.isApplyCommandAvailable?d.hide():d.show():d.hide()}),this._materialList=new c({...t,onContextualEvent:t=>{const n=t.cellInfos.cellModel;if(!e.is(n))return void console.error("error: ENOXMaterialSection/onContextualEvent -> no cellModel");if(!e.is(n.matDBInfos))return void console.error("error: ENOXMaterialSection/onContextualEvent -> no matInfos");const{matDBInfos:i}=n,r=Array.isArray(t.menu)?t.menu[0]:null;if(!e.is(r))return void console.warn("ENOXMaterialSection/onContextualEvent -> no menu entry found");const o={context:this.appCore.contextManager.getContext(),getSelectedMaterials:()=>[i],searchManager:this.appCore.dataService.searchManager,getSelectedItems:this.getSelectedItems.bind(this),materialType:this.managedMaterialType},s={onMenuItemClicked:e=>{this.commandManager.executeCommand({commandHeader:e,cmdOptions:o})}};return this.commandManager.getMenu({menuEntry:r,menuOptions:s})}});const g=o.getElement(".section-material-list");this.materialListPanel.content.inject(g),this._addElementToUpdateList(this.materialListPanel,()=>{this.materialListPanel.isEmpty?g.hide():g.show()});const h=o.getElement(".section-material-loading-Bar");new i({text:`${this.appCore.i18nManager.get("materialFacet.authoring.running")} ...`}).inject(h).on();const m=o.getElement(".section-material-loading");this._addElementToUpdateList(m,()=>{m.hide()});const f=o.getElement(".material-section-expand-content"),E="string"==typeof t.labelHeader?t.labelHeader:"",C=this.appCore.i18nManager.get(E),_=new n({header:this.expanderLabel,body:f,expandedFlag:!1,style:"simple"});_.inject(this._container),this._addElementToUpdateList(_,()=>{const e=this.materialListPanel.length;e||this.isApplyCommandAvailable?_.expand():_.close(),_.header=`${C} (${e})`})}_addElementToUpdateList(e,t){Array.isArray(this._updateEltList)||(this._updateEltList=[]),e[Symbol.for("updateView")]=t,this._updateEltList.push(e)}_fetchCVInfos({pids:t,requestData:n}){return new Promise((i,o)=>{const s=this.appCore.settingManager.getCommand("cv_fetch");r.perform(s,{pids:t,requestData:n,nls_values:["ds6w:type","ds6w:status","ds6w:materialDomain"]},{fcs_url_mode:"REDIRECT",label:this.appCore.settingManager.getCVRequestLabel(),locale:this.appCore.settingManager.getLanguage(),tenant:this.appCore.settingManager.getPlatformId()}).then(t=>{const n=(Reflect.has(t,"results")?t.results:[]).map(t=>(t=>{if(!Array.isArray(t))return console.error("error: attributesParser input should be an array"),{};const n={};return t.forEach(t=>{let i=t.name;t.format&&"ds6w_facet"===t.format&&(i=t.name.split("/").pop());const r=t=>e.is(t.dispValue)?t.dispValue:t.value;switch(i){case"resourceid":n.resourceid=t.value,n.physicalid=t.value;break;case"type_icon_url":n.icons||(n.icons=[]),n.icons.push(t.value);break;case"preview_url":case"thumbnail_2d":n.thumbnail=t.value;break;case"ds6w:type":n.type=r(t);break;case"ds6wg:PLMReference.V_isLastVersion":n.isLastVersion="boolean"==typeof t.value?t.value:"TRUE"===t.value.toUpperCase(),n["ds6wg:PLMReference.V_isLastVersion"]=t.value;break;case"bo.PLMReference.v_versionid":n.versionid=t.value;break;default:n.hasOwnProperty(i)&&n[i]!==t.value?n[i]="":n[i]=r(t)}}),n})(t.attributes));i(n)}).catch(e=>{o(e)})})}_buildDisplayInfos({refs:e,requestData:t,displayFct:n}){return Array.isArray(e)&&e.length?new Promise((i,r)=>{const o=e.map(e=>e.physicalid);this._fetchCVInfos({pids:o,requestData:t}).then(t=>{const r=e.map(e=>{const i=t.find(t=>t.physicalid===e.physicalid);return n(e,i)});i(r)}).catch(e=>{r(e)})}):Promise.reject("wrong inputs")}_fetchMaterialInfos(t){return this._buildDisplayInfos({refs:t,requestData:{select_file:["icon","thumbnail_2d"],select_predicate:["ds6w:label","ds6w:type","ds6w:identifier","ds6w:status","ds6w:responsible","ds6wg:revision","ds6w:globalType","ds6w:discipline","ds6w:classification","ds6w:how/ds6w:materialDomain"]},displayFct:(t,n)=>{const i=(i,r,o="")=>e.is(n)&&e.is(n[i])?n[i]:e.is(t)&&e.is(t[r])?t[r]:o,r={icons:i("icons","",(()=>{const e=i("type","V_discipline").includes("Core")?"I_Material_Nav_core.png":"I_Material_Nav_covering.png";return[s.getWebappsAssetUrl("ENOXEngineer",`icons/32/${e}`)]})()),thumbnail:i("thumbnail","",(()=>{const e=i("type","V_discipline").includes("Core")?"I_Material_Nav_core.png":"I_Material_Nav_covering.png";return s.getWebappsAssetUrl("ENOXEngineer",`img/${e}`)})()),type:i("type","V_discipline"),"ds6w:label":i("ds6w:label","V_Name"),"ds6wg:revision":i("ds6wg:revision","revision"),"ds6w:status":i("ds6w:status","current"),"ds6w:responsible":i("ds6w:responsible","owner"),"ds6w:identifier":i("ds6w:identifier","name")};e.is(t.partial)&&Object.defineProperty(r,"partial",{get:function(){return t.partial}}),e.is(t.context)&&Object.defineProperty(r,"context",{get:function(){return t.context}});const o=e.is(t.partial)?"partialMaterial":this.commandMenuEntryforCommandManager;return e.is(o)&&Object.defineProperty(r,"menuEntry",{get:function(){return o}}),Object.defineProperty(r,"matDBInfos",{get:function(){return t}}),r}})}}return{ENOXMaterialCoreSection:class extends h{constructor(e){super({...e,labelHeader:"materialSection.coreref.title"})}get commandMenuEntryforCommandManager(){return"coreMaterial"}get isApplyCommandAvailable(){return!0}get managedMaterialType(){return g.core}isAccessToSupportMaterialAvailable(e){return o.getCoreMaterialSupportInfo({pids:[e]})}getSelectedItems(){const t=[],n=e.is(this.facet)?this.facet.selectedNode:null;return e.is(n)&&t.push(n.getID()),t}isEditedReferences(e){const t=this.getSelectedItems();for(const n of e)if(-1===t.findIndex(e=>e===n.physicalid))return!1;return!0}onAuthoringMaterialStart({cmd:e,payload:t}){"post_core_material"===e&&super.onAuthoringMaterialStart({cmd:e,payload:t})}onAuthoringMaterialEnd({cmd:t,answer:n}){if("post_core_material"!==t)return;super.onAuthoringMaterialEnd({cmd:t,answer:n});const i=[],r=[],{references:o}=n;if(!e.is(o))return void this._updateViewFromModel();if(Array.isArray(o)&&o.length>0){if(!this.isEditedReferences(o))return console.error("error: onAuthoringMaterialEnd -> send references don't match with the edited ones"),void this._updateViewFromModel();const t=o[0],{corematerial:n}=(this.getSelectedItems(),t);e.is(n)&&Array.isArray(n)&&i.push(...n)}const{references_infos:s}=n;e.is(s)&&Array.isArray(s)&&s.forEach(e=>{-1===r.findIndex(({physicalid:t})=>t===e.physicalid)&&r.push(e)}),this.update(i,r)}},ENOXMaterialCoveringSection:class extends h{constructor(e){super({...e,labelHeader:"materialSection.coverref.title"})}get commandMenuEntryforCommandManager(){return"coveringMaterial"}get isApplyCommandAvailable(){return!0}get managedMaterialType(){return g.covering}isAccessToSupportMaterialAvailable(e){return o.getCoveringMaterialSupportInfo({pids:[e]})}getSelectedItems(){const t=[],n=e.is(this.facet)?this.facet.selectedNode:null;return e.is(n)&&t.push(n.getID()),t}isEditedReferences(e){const t=this.getSelectedItems();for(const n of e)if(-1===t.findIndex(e=>e===n.physicalid))return!1;return!0}onAuthoringMaterialStart({cmd:e,payload:t}){"post_covering_material"===e&&super.onAuthoringMaterialStart({cmd:e,payload:t})}onAuthoringMaterialEnd({cmd:t,answer:n}){if("post_covering_material"!==t)return;super.onAuthoringMaterialEnd({cmd:t,answer:n});const i=[],r=[],{references:o}=n;if(!e.is(o))return void this._updateViewFromModel();if(Array.isArray(o)&&o.length>0){if(!this.isEditedReferences(o))return console.error("error: onAuthoringMaterialEnd -> send references don't match with the edited ones"),void this._updateViewFromModel();const t=o[0],{coveringmaterial:n}=t;e.is(n)&&Array.isArray(n)&&i.push(...n)}const{references_infos:s}=n;e.is(s)&&Array.isArray(s)&&s.forEach(e=>{-1===r.findIndex(({physicalid:t})=>t===e.physicalid)&&r.push(e)}),this.update(i,r)}},ENOXMaterialCoveringInstSection:class extends h{constructor(e){super({...e,labelHeader:"materialSection.coverinst.title"})}get commandMenuEntryforCommandManager(){return"covering-instMaterial"}get managedMaterialType(){return g.covering}getSelectedItems(){return null}onAuthoringMaterialStart({cmd:e,payload:t}){}onAuthoringMaterialEnd({cmd:e,answer:t}){}_update(t,n){let i=[];return Array.isArray(t)&&t.forEach(t=>{let r=t.context;const o=(e=>n.find(t=>e===t.physicalid))(r.physicalid);r=((t,n)=>e.is(n)?{...t,...n}:t)(r,o),t.materialref.forEach(e=>{const t={physicalid:e.physicalid,context:r};i.push(t)})}),super._update(i,n)}}}}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/units/ChangeQuantityUnitFetchService",["DS/ENOXEngineer/services/EngineeringSettings","DS/ENOXEngineer/utils/XENHttpClient"],(e,t)=>{return class{constructor(e){this.viewContext=e}async fetchUnits(n,i){const r=this.buildPayload(n,i);try{const n=await t.perform(e.getCommand("getOccurrencesEffectivitiesAsUnits"),r);return this.parseUnitsAnswer(n)}catch(e){return[]}}parseUnitsAnswer(e){const{occurrences:t,GlobalStatus:n}=e||{};if("Success"!==n||!Array.isArray(t))return null;const i=new Map;return t.forEach(({pids:e,status:t,viewCurrentUnits:n})=>{if("Success"===t){const t=this.convertPidsToOcc(e);if("string"==typeof t&&t.trim().length){const e=JSON.parse(n);Array.isArray(e)&&e.forEach(e=>{i.has(e)?i.get(e).push(t):i.set(e,[t])})}}}),i}convertPidsToOcc(e){return"string"==typeof e&&e.trim().length?e.slice(1,-1).split(",").map(e=>e.trim()).join("/"):""}buildPayload(e,t){return Array.isArray(e)&&e.length&&t&&t.trim().length?{version:"1.0",modelIdentifier:t,withBinaries:"FALSE",view:"Current",unitsXML:"FALSE",occurrences:e.map(e=>({path:e.split("/").map(e=>({instanceIdentifier:e}))}))}:null}}}),define("DS/ENOXEngineer/utils/EngItemModelAttributesHelper",["DS/ENOXEngineer/utils/Utils"],e=>{const t=e=>e&&Array.isArray(e)&&e.length?e[0]instanceof Date?(e=>e&&Array.isArray(e)&&e.length?e.map(function(e){return e.getTime()}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(e){return new Date(e)}):[])(e):[...new Set(e)]:[];return class{constructor(e){this.nodeModel=e,this.appCore=e.options.appCore}getAttributeValue(e){if(this.nodeModel.options.grid.hasOwnProperty(e))return this.getConvertedAttributeValue(e);if(this.nodeModel.hasUsages()){const n=this.nodeModel.getUsages().map(t=>t.getAttributeCellValue(e)).filter(e=>null!=e&&""!==e).flat();return t(n)}}getConvertedAttributeValue(t){if(!this.nodeModel.options.grid.hasOwnProperty(t))return null;const n=this.nodeModel.options.grid[t],i=this.appCore.dicoService.getAttributeMetas(t),r=this.appCore.columnsManager.getColumnDefinition(t).typeRepresentation,o=this.appCore.dicoService.getRangeValueAttribute(i.ds6w);if(o&&o.AuthorizedValues){const e=e=>{const t=e.toString();return-1===o.AuthorizedValues.indexOf(t)?"":this.appCore.i18nManager.get(`${i.ds6w}/${t}`)};return Array.isArray(n)?n.map(e):e(n)}switch(r){case"integer":return e.convertIntegerNodeValueToCellValue(n);case"boolean":return e.convertBooleanNodeValueToCellValue(n);case"string":return e.convertStringNodeValueToCellValue(n);case"datetime":case"timestamp":return e.convertDateNodeValueToCellValue(n);case"real":case"float":const o=this.nodeModel.options.grid[`${t}_converted`];return i.attrUnit&&o?e.convertRealNodeValueToCellValue(o):e.convertRealNodeValueToCellValue(n);default:return n}}}}),define("DS/ENOXEngineer/facets/MaterialFacet/ENOXRelatedMaterials",["UWA/Core","UWA/Class","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialSections","DS/ENOXEngineer/services/OccurrencesService","DS/ENOXEngineer/services/MaterialService","DS/Controls/ModalContainer","DS/Controls/Loader","DS/ENOXEngineer/services/I18nManager","DS/Handlebars/Handlebars","text!DS/ENOXEngineer/facets/MaterialFacet/ENOXRelatedMaterials.html","css!DS/ENOXEngineer/facets/MaterialFacet/ENOXRelatedMaterials.css"],(e,t,n,i,r,o,s,a,l,c,d)=>{const u={noselection:"noselection",nomaterial:"nomaterial",multiselection:"multiselection",unknowntype:"unknowntype"},p={vpm_instance:"VPMInstance",vpm_reference:"VPMReference"};return class extends t{constructor(t){super(t),this.appCore=t.appCore;const n=c.compile(d),i=e.createElement("div",{html:n()});this._container=i.getElement(".relatedmaterials-container"),this._buildSkeleton(t),this._selectedNode=null}get content(){return this._container}get selectedNode(){return this._selectedNode}_buildSkeleton(e){this._referenceMaterialBox=this.content.getElement(".relatedmaterials-reference");const{ENOXMaterialCoreSection:t,ENOXMaterialCoveringSection:n,ENOXMaterialCoveringInstSection:r}=i,o={facet:this,...e};this._referenceMaterialBox.core=new t(o),this._referenceMaterialBox.core.content.inject(this._referenceMaterialBox),this._referenceMaterialBox.cover=new n(o),this._referenceMaterialBox.cover.content.inject(this._referenceMaterialBox),this._referenceMaterialBox.hide(),this._instanceMaterialBox=this.content.getElement(".relatedmaterials-instance"),this._instanceMaterialBox.core=new t(o),this._instanceMaterialBox.core.content.inject(this._instanceMaterialBox),this._instanceMaterialBox.cover=new n(o),this._instanceMaterialBox.cover.content.inject(this._instanceMaterialBox),this._instanceMaterialBox.cover_inst=new r(o),this._instanceMaterialBox.cover_inst.content.inject(this._instanceMaterialBox),this._instanceMaterialBox.hide(),this._informationBox=this.content.getElement(".relatedmaterials-information"),this._messageInformationBox=this.content.getElement(".relatedmaterials-information-msg"),this._informationBox.hide(),this._loadingBox=this.content.getElement(".relatedmaterials-loading");const c=l.get("loading"),d=new a({text:c});d.on(c),s.createModal(this._loadingBox,d.elements.container),this._loadingBox.hide()}_displayInformationBox(t){if(!e.is(this._messageInformationBox))return void console.error("error: messageInformationBox is null");let n="";t===u.noselection?n=this.appCore.i18nManager.get("materialFacet.noSelection"):t===u.multiselection?n=this.appCore.i18nManager.get("materialFacet.multiSelection"):t===u.nomaterial?n=this.appCore.i18nManager.get("materialFacet.noMaterial"):t===u.unknowntype?n=this.appCore.i18nManager.get("notSupportedSelection"):console.error("error: input should be 'noselection' or 'multiselection' or 'nomaterial'"),this._messageInformationBox.setText(n),this._referenceMaterialBox.hide(),this._instanceMaterialBox.hide(),this._informationBox.show()}isInstanceNode(e){return e instanceof this.appCore.Factories.ListItemFactory.getListInstanceClass()}async selectionModified(t){if(!e.is(t)||!Array.isArray(t))throw new Error("selectedNodes unexpected value");if(!e.is(this._messageInformationBox))throw new Error("messageInformationBox is null");if(!e.is(t)||0===t.length)return this._selectedNode=null,void this._displayInformationBox(u.noselection);if(t.length>1)return this._selectedNode=null,void this._displayInformationBox(u.multiselection);const n=t[0];if(!Reflect.has(n,"isEngineeringItem")||!n.isEngineeringItem())return void this._displayInformationBox(u.unknowntype);if(e.is(this._selectedNode)&&n.getID()===this._selectedNode.getID())return;this._loadingBox.show(),this._informationBox.hide(),this._instanceMaterialBox.hide(),this._referenceMaterialBox.hide();let i={};if(this.isInstanceNode(n)){const e=p.vpm_instance,t=[n.getID()],{XENOccurrencesBag:o,XENOccurrence:s}=r,a=new s(n.getOccurrencePath()),l=new o;l.push(a),i={type:e,pids:t,xen_occs:l}}else i={type:p.vpm_reference,pids:[n.getID()]};this._selectedNode=n;const o=await this._extractMaterialInfoFromNode(i);this._loadingBox.hide(),await this._displayMaterialInfo(o,n.getID())}_extractMaterialInfoFromNode({type:t,pids:i,xen_occs:r}){return new Promise(s=>{const a=[];a.push(o.fetchCoreMaterialData({pids:i})),a.push(o.fetchCoveringMaterialData({pids:i,xen_occs:r})),n.allSettled(a).then(n=>{const i=[],o=[],a=[],l=[];n.forEach(t=>{if("fullfilled"===t.state){const{references:n}=t.value;if(e.is(n)&&Array.isArray(n)&&n.length>0){const t=n[0],{corematerial:r,coveringmaterial:s}=t;e.is(r)&&Array.isArray(r)&&i.push(...r),e.is(s)&&Array.isArray(s)&&s.length>0&&o.push(...s)}const{occurrences:s}=t.value;if(e.is(s)&&Array.isArray(s)){const t=s[0],n=r.getXENOccurrencefromOccurrencePath(t.physicalid),{coveringmaterial:i}=t;e.is(n)&&e.is(i)&&Array.isArray(i)&&a.push(...i)}const{references_infos:c}=t.value;e.is(c)&&Array.isArray(c)&&c.forEach(e=>{-1===l.findIndex(({physicalid:t})=>t===e.physicalid)&&l.push(e)})}else console.error("error: fetching material data failed")}),s({type:t,coreMaterialInfo:i,coveringMaterialInfo:o,coveringMaterialInstanceInfo:a,referencesInfo:l})})})}async _displayMaterialInfo({type:e,coreMaterialInfo:t,coveringMaterialInfo:n,coveringMaterialInstanceInfo:i,referencesInfo:r},o){switch(e){case p.vpm_instance:await this._buildInstanceMaterialInfoDisplay({coreMaterialInfo:t,coveringMaterialInfo:n,coveringMaterialInstanceInfo:i,referencesInfo:r},o);break;case p.vpm_reference:await this._buildReferenceMaterialInfoDisplay({coreMaterialInfo:t,coveringMaterialInfo:n,referencesInfo:r},o)}}async _buildReferenceMaterialInfoDisplay({coreMaterialInfo:t,coveringMaterialInfo:n,referencesInfo:i},r){const o=[];o.push(this._referenceMaterialBox.core.update(t,i)),o.push(this._referenceMaterialBox.cover.update(n,i)),await Promise.all(o),e.is(this._selectedNode)&&r===this._selectedNode.getID()&&this._referenceMaterialBox.show()}async _buildInstanceMaterialInfoDisplay({coreMaterialInfo:t,coveringMaterialInfo:n,coveringMaterialInstanceInfo:i,referencesInfo:r},o){const s=[];s.push(this._instanceMaterialBox.core.update(t,r)),s.push(this._instanceMaterialBox.cover.update(n,r)),s.push(this._instanceMaterialBox.cover_inst.update(i,r)),await Promise.all(s),e.is(this._selectedNode)&&o===this._selectedNode.getID()&&this._instanceMaterialBox.show()}}}),define("DS/ENOXEngineer/facets/ENOXMaterialFacet",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","DS/ENOXEngineer/facets/MaterialFacet/ENOXRelatedMaterials","css!DS/ENOXEngineer/styles/ENOXMaterialFacet.css"],(e,t,n,i,r)=>{"use strict";return t.extend(n,i,{init(e){this._parent(e),this._buildView(e)},_buildView(t){this._relatedMats||(this.elements.container=e.createElement("div",{class:"relatedMaterials"}),this._relatedMats=new r({appCore:this.options.appContext}),this.appCore=this.options.appContext,this._relatedMats.content.inject(this.elements.container))},updateFacet(){const e=this.appCore.contextManager.getXENTreeDocument().getSelectedNodes();return this._relatedMats.selectionModified(e)},destroyComponent(){console.warn("destroyComponent called")},onResize(){console.warn("onResize")},onRefresh(){this.updateFacet()},onAction(e){}})}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityUnitViewBuilder",["DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/units/ChangeQuantityUnitFetchService","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/units/ChangeQuantityUnitTreeNodeService","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityViewBuilder","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityNodeUtils","DS/ENOXEngineer/services/OccurrencesService","DS/Tweakers/GeneratedToolbar","DS/ENOXEngineer/services/I18nManager"],(e,t,n,i,r,o,s)=>{const a=s.get("with"),l={None:{value:"None",label:s.get("None")},EqualQty:{value:"EqualQty",label:s.get("sameQuantities")},NextEqualQty:{value:"NextEqualQty",label:s.get("sameQuantitiesConsecutives")}},c="unit-quantity";return class extends n{constructor(){super(),this.groupModeTweaker=null,this.instPaths2Nodes=null,this.units=null}init(n){super.init(n),this.changeQuantityUnitTreeNodeService=new t(n),this.changeQuantityUnitFetchService=new e(n),this.addUnitTweakerInToolbar(),this.addUnitColumnInView(),this.persistentNodes=this.filterNonPersistentNodesFromModel()}release(){this.removeUnitTweakerFromToolbar(),this.removeUnitColumnFromView(),this.restoreNonPersistentNodesFromModel(),super.release()}async buildNodes(e){const{model:t}=e||{},n=t?t.getID():"";if(!n.trim().length)return Promise.reject(new Error("wrong input"));if(!Array.isArray(this.persistentNodes)||!this.persistentNodes.length)return Promise.reject(new Error("unexpected nodes"));this.instPaths2Nodes=this.getInstanceMapFromNode(this.persistentNodes);const i=Array.from(this.instPaths2Nodes.keys());return this.units=await this.changeQuantityUnitFetchService.fetchUnits(i,n),this.convertUnitsAsTreeNode(this.units,this.instPaths2Nodes,this.groupMode)}get groupMode(){if(!this.groupModeTweaker)return l.None;const e=this.groupModeTweaker.getAttributeValue("data");let t=l.None;switch(e){case l.None.value:t=l.None;break;case l.EqualQty.value:t=l.EqualQty;break;case l.NextEqualQty.value:t=l.NextEqualQty}return t}addUnitTweakerInToolbar(){this.groupModeTweaker||(this.groupModeTweaker=this.buildUnitGroupModeTweaker());const{toolbar:e}=this.viewContext||{};if(!e)throw new Error("invalid State");e.prepareUpdateView(),e.items.addRoot(this.groupModeTweaker),e.pushUpdateView()}removeUnitTweakerFromToolbar(){if(!this.groupModeTweaker)return;const{toolbar:e}=this.viewContext||{};if(!e)throw new Error("invalid State");e.prepareUpdateView(),e.items.removeRoot(this.groupModeTweaker),e.pushUpdateView()}addUnitColumnInView(){const{gridView:e}=this.viewContext||{},{columns:t}=e||{};if(!t)throw new Error("invalid State");const n=[...t],i={text:s.get("eng.ui.dialog.changeQuantity.headerQuantity"),dataIndex:c,editableFlag:!1,pinned:"left",width:75};e.prepareUpdateView();const r=t.findIndex(e=>"tree"===e.dataIndex);-1!==r?n.splice(r+1,0,i):n.push(i),e.columns=n,e.pushUpdateView()}removeUnitColumnFromView(){const{gridView:e}=this.viewContext||{},{columns:t}=e||{};if(!t)throw new Error("invalid State");const n=t.filter(e=>e.dataIndex!==c);e.prepareUpdateView(),e.columns=n,e.pushUpdateView()}buildUnitGroupModeTweaker(){const{toolbar:e}=this.viewContext;if(!e)throw new Error("invalid state");e.typeRepresentationFactory.registerTypeRepresentations({GroupModeEnum:{stdTemplate:"enumCombo",semantics:{possibleValues:[l.None,l.EqualQty,l.NextEqualQty],valueType:"enumString"}}});const t={entries:[{id:"groupModeInput",dataElements:{typeRepresentation:"GroupModeEnum",position:"near",category:2,label:`${a}:`,displayLabel:!0,value:l.None.value,domId:"groupModeInput"},onNodeUpdate:this.onElementGroupModeEnum.bind(this)}]},n=o.prototype.createTreeDocument(t),[i]=n.getChildren();return i}onElementGroupModeEnum(){const e=this.convertUnitsAsTreeNode(this.units,this.instPaths2Nodes,this.groupMode);this.emptyView(),this.addNodesToView(e)}getInstanceMapFromNode(e){if(!Array.isArray(e))return null;const t=new Map;return e.forEach(e=>{const n=this.getInstancePathsFromNodeOccurencePath(e).join("/");n&&t.set(n,e)}),t}getInstancePathsFromNodeOccurencePath(e){if(!e||!e.getOccurrencePath)return null;const{XENOccurrence:t}=r;return new t(e.getOccurrencePath()).getPath(!1)}filterNonPersistentNodesFromModel(){const{model:e}=this.viewContext,{nodes:t}=e;return t.filter(e=>{const t=i.isNodeNew(e);return t&&e.hide(),!t})}restoreNonPersistentNodesFromModel(){const{model:e}=this.viewContext,{nodes:t}=e;t.filter(e=>i.isNodeNew(e)).forEach(e=>e.show())}convertUnitsAsTreeNode(e,t,n){let i=[];switch(n){case l.None:i=this.changeQuantityUnitTreeNodeService.buildGroupNoneUnitsNode(e,t);break;case l.EqualQty:i=this.changeQuantityUnitTreeNodeService.buildGroupEqualQtyUnitsNode(e,t);break;case l.NextEqualQty:i=this.changeQuantityUnitTreeNodeService.buildGroupNextEqualQtyUnitsNode(e,t)}return i}}}),define("DS/ENOXEngineer/models/ConfigContextModel",["DS/TreeModel/TreeNodeModel","UWA/Core","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/utils/ResponseParser","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n,i,r,o,s){"use strict";function a(n){this._parentNode={_nodeDepth:1},this.pathElement={externalPath:[]},this.options={type:"",physicalid:"",thumbnail:"","ds6w:created":"","ds6w:modified":"","ds6w:description":"","ds6w:responsible":"","ds6wg:revision":"","ds6w:status":"","ds6w:label":"",modelVersion:null,preferedVersion:null,relatedEngItem:null,preferredConfiguration:null,versionPCs:null},this.options=t.extend(this.options,n),e.call(this,this.options)}return a.prototype=Object.create(e.prototype),a.prototype.destroy=function(){},a.prototype.setModelVersion=function(e){this.options.modelVersion=e},a.prototype.setAllModelVersions=function(e){this.options.allModelVersions=e},a.prototype.getAllModelVersions=function(){return this.options.allModelVersions},a.prototype.setRelatedEngItem=function(e){this.options.relatedEngItem=e},a.prototype.getRelatedEngItem=function(){return this.options.relatedEngItem},a.prototype.catchUserPreferences=function(){return{modelId:this.getID(),modelVersionId:this.getPreferredVersion()?this.getPreferredVersion().id:"N/A",prodConfId:this.getPreferredConfiguration()?this.getPreferredConfiguration().id:"N/A"}},a.prototype.getModelVersion=function(){return this.options.modelVersion},a.prototype.getCurrentVersionName=function(){return this.getPreferredVersion()?this.getPreferredVersion().name:null},a.prototype.getCurrentVersionMarketingName=function(){return this.getPreferredVersion()?this.getPreferredVersion().marketingName:null},a.prototype.getMarketingName=function(){return this.getModelVersion()?this.getModelVersion().attributes.MarketingName:null},a.prototype.getCurrentVersionID=function(){return this.getPreferredVersion()?this.getPreferredVersion().id:null},a.prototype.getCurrentVersionRevision=function(){return this.getPreferredVersion()?this.getPreferredVersion().revision:null},a.prototype.getCurrentVersionDisplayName=function(){return this.getCurrentVersionName()+" "+this.getCurrentVersionRevision()},a.prototype.getCurrentVersionDisplayMarketingName=function(){return this.getCurrentVersionMarketingName()+" "+this.getCurrentVersionRevision()},a.prototype.setVersionProdConfs=function(e){this.options.versionPCs=e},a.prototype.getVersionProdConfs=function(){return this.options.versionPCs},a.prototype.getProdConfById=function(e){var t=this.getVersionProdConfs()?this.getVersionProdConfs():[];console.warn(t);for(var n=0;n<t.length;n++)if(t[n].id===e)return t[n];return null},a.prototype.getPreferredConfiguration=function(){return this.options.preferredConfiguration},a.prototype.setPreferredConfiguration=function(e){var t=this;return n.wrappedWithPromise(function(n,i){t.loadProdConfInfos().then(function(){t.options.preferredConfiguration=e?t.getProdConfById(e):null,n()}).catch(function(e){console.error(e),i(e)})})},a.prototype.getPreferredVersion=function(){return this.options.preferedVersion},a.prototype.setPreferredVersion=function(e){var t=i.getVersionByIdFromVersionGraph(this.getModelVersion(),e)||this.getModelVersion();t&&Object.keys(t).length>0?(this.options.preferedVersion={id:r._getPidWithoutPrefix(t.id),revision:t.revision,name:t.name,marketingName:t.attributes.MarketingName,state:t.current},this.options.preferredConfiguration=null,this.loadProdConfInfos(!0)):o.errorAlert(this.options.appCore.i18nManager.get("error.selectedVersion.notFound"))},a.prototype.getListOfVersionsPromise=function(){var e=this;return n.wrappedWithPromise(function(t,n){e.loadVersions().then(function(n){t(n?e.options.appCore.Factories.configItemsFactory.createModelVersionsFromRootVersion(n,e.getID()):[])}).catch(function(e){t([]),console.error(e)})})},a.prototype.loadVersions=function(e){var t=e||this;return n.wrappedWithPromise(function(e,n){t.options.appCore.dataService.getModelVersionsFromModel(t.getID()).then(function(n){n.id&&n.revision?(t.setModelVersion(n),e(n)):(t.setModelVersion(null),e(null))}).catch(function(e){t.setModelVersion(null),n(e),console.error(e)})})},a.prototype.VersionsLoaderWrapper=function(){var e=this;return n.wrappedWithPromise(function(t,n){if(e.getModelVersion())return t(e.getModelVersion());e.loadVersions().then(t).catch(n)})},a.prototype._synchronizeModelVersions=function(e){var t=this.getID(),i=this;return t?n.wrappedWithPromise(function(t,n){i.VersionsLoaderWrapper().then(function(){var n=i.getModelVersion();if(n){var r=i.options.appCore.PreferencesManager.getEngItemOpenPreferences(i.getRelatedEngItem().getID()),s=r&&r.modelVersion?r.modelVersion:null,a=r&&r.prodConf?r.prodConf:null,l=e&&e.id?e.id:s;l||(l=n.id),i.setPreferredVersion(l),i.loadProdConfInfos().finally(function(){i.setPreferredConfiguration(a),t(n)})}else o.errorAlert(i.options.appCore.i18nManager.get("error.noVersion.relatedToModel"))}).catch(function(e){console.error(e),n()})}):null},a.prototype.loadProdConfInfos=function(e){var t=this;return t.options.prodConfPromise&&!e?t.options.prodConfPromise:(t.options.prodConfPromise=n.wrappedWithPromise(function(e,n){t.options.appCore.dataService.loadModelVersionProdConf(t.getID(),t.getCurrentVersionID()).then(function(n){t.setVersionProdConfs(r.retrieveProdConfsInfo(n)),e(!0)}).catch(function(e){console.warn(e),n(e)})}),t.options.prodConfPromise)},a.prototype.getType=function(){return this.options.type},a.prototype.getID=function(){return this.options.physicalid},a.prototype.getLabel=function(){return this.options["ds6w:label"]},a.prototype.getDisplayName=function(){return this.options["Marketing Name"]},a.prototype.getVersion=function(){return this.options["ds6wg:revision"]},a.prototype.getThumbnail=function(){return this.options.thumbnail},a.prototype.getOwner=function(){return this.options["ds6w:responsible"]},a.prototype.getCreatedDate=function(){return this.options["ds6w:created"]},a.prototype.getModifedDate=function(){return this.options["ds6w:modified"]},a.prototype.getMaturity=function(){return this.options["ds6w:status"]},a.prototype.getDescription=function(){return this.options["ds6w:description"]},a.prototype.getIcon=function(){return this.options.icons&&this.options.icons[0]},a.prototype.getTenant=function(){return this.options.tenant},a.prototype.buildFilterXML=function(){var e=this.options.appCore.settingManager.getCommand("createVolatileFilter"),t=e.contentFormat,n=s.CONF_150_MODE,i=e.ModelVersionFormat;return i=(i=(i=i.replace("{modelName}",UWA.String.escapeHTML(this.getLabel()))).replace("{modelVersionName}",UWA.String.escapeHTML(this.getCurrentVersionName()))).replace("{modelVersionRevision}",UWA.String.escapeHTML(this.getCurrentVersionRevision())),t=(t=(t=t.replace("{filter}",i)).replace("{mode}",n)).replace("{SelectionView}",UWA.String.escapeHTML(this.options.appCore.dataService.getUserEvolutionViewPref()))},a}),define("DS/ENOXEngineer/services/ConfigItemsFactory",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/utils/ResponseParser","DS/ENOXEngineer/models/ConfigContextModel","DS/TreeModel/TreeNodeModel","DS/ENOXEngineer/utils/XEngineerConstants","WebappsUtils/WebappsUtils"],function(e,t,n,i,r,o,s,a,l){"use strict";return t.singleton({init:function(e){this._parent(e)},initialize:function(e){this.app=e,this.app.core.Factories||(this.app.core.Factories={}),this.app.core.Factories.configItemsFactory=this,this.i18nManager=this.app.core.i18nManager},createModelVersionsFromRootVersion:function(e,t){if(!e)return[];var n=[],i=this;return r.getListOfVersionsFromRoot(e,n),n.map(function(e){return e.modelId=t,e.thumbnail||(e.thumbnail=i.app.core.settingManager.getDefault3DSpaceUrl()+"/snresources/images/icons/large/I_Product_Thumbnail.png"),new s(e)})},getModelsFromConfigInfo:function(e){var t=r.configInfoParser(e);return this.createConfigModelNodes(t)},getModelVersionsFromModelInfo:function(e){return r.modelVersionsParser(e)},createConfigModelNode:function(t,n){var i=t;return e.is(n,"function")&&(i=n(t)),i.appCore=this.app.core,i.thumbnail=this.app.core.settingManager.getDefault3DSpaceUrl()+"/snresources/images/icons/large/I_Product_Thumbnail.png",new o(i)},createConfigModelNodes:function(t,n){var i=[],r=this;return t.forEach(function(t){var o=r.createConfigModelNode(t,n);e.is(o)&&i.push(o)}),i}})}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityModelEffectivityComponent",["UWA/Core","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityComponent","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityViewBuilderComponent","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityUnitViewBuilder","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityNodeUtils","DS/ENOXEngineer/utils/XEngineerConstants","DS/Tweakers/GeneratedToolbar","DS/ENOXEngineer/services/I18nManager"],(e,t,n,i,r,o,s,a)=>{const l=`${a.get("tooltip_GroupBy")}:`,c=a.get("Units"),d=`${a.get("Model")}:`,u={Unit:"Unit"},p="None";return new class extends t{init(e){this.viewContext=e,this.modelTweaker=null,this.effTypeTweaker=null;const{model:t}=e;this.unitsViewBuilder=new i(t),n.registerBuilder(u.Unit,c,this.unitsViewBuilder)}activate({toolbar:e}){e.prepareUpdateView(),e.items.addRoot(this.modelTweaker,0),e.items.addRoot(this.effTypeTweaker,1),e.pushUpdateView(),this.applyViewBuilder()}buildUIComponent(t){const n=this.buildModelTweaker(t),i=e.is(n.dataElements.value),r={entries:[n,this.buildEffTweaker(t,i)]},o=s.prototype.createTreeDocument(r);[this.modelTweaker,this.effTypeTweaker]=o.getChildren()}deactivate({toolbar:e}){e.prepareUpdateView(),e.items.removeRoot(this.modelTweaker),e.items.removeRoot(this.effTypeTweaker),e.pushUpdateView(),n.restoreDefaultBuilder(),super.deactivate()}destroy(){n.unregisterBuilder(u.Unit),super.destroy()}get isModelValueSettled(){return e.is(this.modelTweaker.getAttributeValue("data"))}applyViewBuilder(){const e=this.modelTweaker.getAttributeValue("data"),t=this.effTypeTweaker.getAttributeValue("data");e&&t&&n.applyBuilder(t,e)}computeAvailableValuesForModel(e){const t={None:{value:p,label:a.get("None")}};return e.getModelAttached().forEach((e,n)=>{const i=e.getDisplayName(),r="string"==typeof i&&i.trim().length?e.getDisplayName():e.getLabel();t[`Model${n}`]={value:{modelID:e.getID(),model:e},label:r}}),Reflect.ownKeys(t).map(e=>t[e])}buildModelTweaker({toolbar:e,model:t}){const n=this.computeAvailableValuesForModel(t),i=e.typeRepresentationFactory.getRegisteredTypeRepresentation("ModelEnum");i?i.semantics.possibleValues=n:e.typeRepresentationFactory.registerTypeRepresentations({ModelEnum:{stdTemplate:"enumCombo",semantics:{possibleValues:n,valueType:"enumString"}}});const r={id:"modelItem",dataElements:{typeRepresentation:"ModelEnum",position:"near",category:1,label:d,displayLabel:!0,domId:"modelInput"},onNodeUpdate:this.onModelTweaker.bind(this)};return n.length>1&&(r.dataElements.value=n[n.length-1].value),r}computeAvailableValuesForEffectivities(){const e={None:n.defaultModeEntry,Units:{value:u.Unit,label:c}};return Reflect.ownKeys(e).map(t=>e[t])}buildEffTweaker({toolbar:e},t){const n=this.computeAvailableValuesForEffectivities();e.typeRepresentationFactory.getRegisteredTypeRepresentation("EffTypeEnum")||e.typeRepresentationFactory.registerTypeRepresentations({EffTypeEnum:{stdTemplate:"enumCombo",semantics:{possibleValues:n,valueType:"enumString"}}});const i={id:"effTypeItem",dataElements:{typeRepresentation:"EffTypeEnum",position:"near",category:2,label:l,disabled:!t,displayLabel:!0,domId:"effectivityInput"},onNodeUpdate:this.onEffTypeTweaker.bind(this)};return n.length&&(i.dataElements.value=n[0].value),i}enableModelView(){this.enableEffTwicker()}disableModelView(){this.disableEffTwicker()}enableEffTwicker(){const{toolbar:e}=this.viewContext;e.updateNodeModel("effTypeItem",{disabled:!1})}disableEffTwicker(){const{toolbar:e}=this.viewContext;e.updateNodeModel("effTypeItem",{disabled:!0,grid:{data:"None"}})}onModelTweaker(e){e.getAttributeValue("data")!==p?this.enableModelView():this.disableModelView()}onEffTypeTweaker(){this.applyViewBuilder()}}}),define("DS/ENOXEngineer/columnsProviders/ContinuousInstQtyDataProvider",["UWA/Core","UWA/Class","DS/ENOXEngineer/services/EngineeringSettings","DS/ENOXEngineer/services/I18nManager","DS/ENOXEngineer/utils/XENHttpClient","DS/ENOXEngineer/services/OccurrencesService","DS/ENOXEngineer/utils/XEngineerConstants"],(e,t,n,i,r,o,s)=>{const{XENOccurrencesBag:a}=o;return t.singleton({init(e){this._parent(e)},isAdditionalColumnsAvailable(t){if(!1===e.is(t,"function"))throw new Error("A callback function should be defined");t(!0)},getName:()=>s.RAW_MATERIAL_QUANTITY,getManagedColumnNames:()=>[s.RAW_MATERIAL_QUANTITY],toBeUpdated(e){let t=!0;return e&&e.rawMaterialQuantity&&(t=!1),t},getAdditionalColumnsUX(e){const t=e.findIndex(e=>e.dataIndex===s.RAW_MATERIAL_QUANTITY);e.splice(t,t>=0?1:0,{text:i.get(s.RAW_MATERIAL_QUANTITY),dataIndex:s.RAW_MATERIAL_QUANTITY,maxWidth:800,minWidth:20,width:200})},async fetchData(e){if(!Array.isArray(e))throw new Error("wrong input");if(!e.length)return{};let t=null;try{const i=n.getCommand("csrf_tocken_validation"),{csrf:o}=await r.perform(i,""),s={instanceIds:e},a=n.getCommand("getRawMaterialInstances");t=await r.perform(a,s,o)}catch(e){console.debug(e)}return t},updateAttributes(t,n){if(!1===e.is(t,"object"))throw new Error("The object ids to modify must be specify");if(!1===e.is(n,"function"))throw new Error("A callback function should be defined");const{relids:r}=t;if(!r.length)return n();const o={},s={};e.is(t.occpaths)&&Array.isArray(t.occpaths)&&t.occpaths.length>=1&&(t.xen_occs=new a(t.occpaths),t.xen_occs.forEach(e=>{s[e.id]={rawMaterialQuantity:" "}})),this.fetchData(r).then(e=>{const{result:r}=e||{};Array.isArray(r)&&r.length&&r.forEach(e=>{const{instanceId:n,quantity:r,quantityType:o,quantityUOM:a,asRequired:l}=e;let c=r&&a&&a.nlsLabel?`${r}${a.nlsLabel}`:"";l&&(c=c.trim().length>0?`${i.get("makeFromAsRequired")}, ${c}`:`${i.get("makeFromAsRequired")}`),c.length&&t.xen_occs.forEach(e=>{const t=e.getPath(!1);Array.isArray(t)&&t.length&&t[t.length-1]===n&&(s[e.id]={rawMaterialQuantity:c,rawMaterialQuantityAttributes:{quantity:r,quantityType:o,quantityUOM:a,asRequired:l}})})}),n({pids:o,occpaths:s})}).catch(()=>{}).finally(()=>{})}})}),define("DS/ENOXEngineer/services/PreferencesManager",["UWA/Core","UWA/Class","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXWidgetPreferences/js/ENOXWidgetPreferences","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/XENHttpClient","DS/ENOXEngineer/utils/SizedMap","DS/ENOX3DSpaceAttributesMgt/services/predicatesServices","DS/ENOX3DSpaceAttributesMgt/services/fetchPredicatesServices"],(e,t,n,i,r,o,s,a,l,c)=>{const d=[{label:"top-left_label",value:o.CHANGECONTROL_POSITION_TOPLEFT_VALUE},{label:"top-right_label",value:o.CHANGECONTROL_POSITION_TOPRIGHT_VALUE},{label:"bottom-right_label",value:o.CHANGECONTROL_POSITION_BOTTOMRIGHT_VALUE},{label:"bottom-left_label",value:o.CHANGECONTROL_POSITION_BOTTOMLEFT_VALUE},{label:"free-position_label",value:o.CHANGECONTROL_POSITION_FREE_VALUE}];return t.singleton({init(e){this._parent(e)},initialize(e){this.logger=e.core.logger.get("PreferencesManager manager initializing"),this.app=e,this.app.core.PreferencesManager=this,this.app.sandboxBase.PreferencesManager=this,this.dicoService=this.app.core.dicoService,this.initializeWidgetPreferences(),this.app.core.mediator.subscribe(o.EVENT_ATTR_DICO_UPDATED,()=>{this.setTerminalItemOptions()}),this.app.core.mediator.subscribe(o.EVENT_COLUMN_PROVIDERS_LOADED,e=>{const t=this.dicoService.getUserDicoPreferences();this.upgradeProviderUserPreferences(t,e)&&this.dicoService.setAttributeDico(t)}),this.app.optionalStartupPromises.push(this.loadOpenPreference()),this.app.optionalStartupPromises.push(this.loadAttrDicoPreference())},upgradeProviderUserPreferences(e,t){return this.upgradeConfigColumnsProvider(e,t)},upgradeConfigColumnsProvider(t,n){const{columns:i}=t,r=i.filter(e=>"configColumnsProvider"===e.provider).map(e=>e.dataIndex);if(!r.length)return!1;const o=Array.isArray(n)?n.find(e=>"configColumnsProvider"===e.ID):null,{instance:s}=o||{},a=s?s.getManagedColumnNames():[];if(!a.length)return!1;const l=r.filter(e=>-1===a.indexOf(e)),c=a.filter(e=>-1===r.indexOf(e)),d=l.length>0||c.length>0;if(d){const t=i.find(e=>e.dataIndex===r[0]);c.forEach(n=>{const r=e.clone(t);switch(r.dataIndex=n,r.ds6w=n,n){case"CurrentEvolutionEffectivity":case"ProjectedEvolutionEffectivity":{const e=i.find(e=>"EvolutionEffectivity"===e.dataIndex);r.visibleFlag=!!e&&e.visibleFlag;break}case"EvolutionEffectivity":{const e=i.find(e=>"CurrentEvolutionEffectivity"===e.dataIndex);r.visibleFlag=!!e&&e.visibleFlag;break}default:r.visibleFlag=!1}i.push(r)}),l.forEach(e=>{const t=i.findIndex(t=>t.dataIndex===e);i.splice(t,1)})}const u=i.map((e,t)=>({name:e.dataIndex,provider:e.provider,index:t})).filter(e=>"configColumnsProvider"===e.provider),p=u[0].index,g=a.filter((e,t)=>{return u.find(t=>t.name===e).index!==t+p}),h=g.length>0;return g.forEach(e=>{const t=i.findIndex(t=>t.dataIndex===e),n=a.findIndex(t=>t===e),r=p+n;if(r!==t&&r<i.length){const[e]=i.splice(t,1);i.splice(r,0,e)}}),d||h},saveEngItemOpenPreferences(e){if(!this.app.core.Factories.ListItemFactory.getReferenceClass(e))return;let t=null;if(e.isConfigured()){const n=e.getPreferedAttachedConfigModel();if(n){if(t={model:n.getID()},n.getPreferredVersion()){const e=n.getPreferredVersion();t.modelVersion=e.id||void 0;const i=n.getPreferredConfiguration();i&&(t.prodConf=i.id)}}else t={noModel:!0}}if(e.hasValidPersistedNextGenFilter()&&(t||(t={}),t.filterId=e.getNGFilterId(),t.filterName=e.getNGFilterName()),!e.getID())return;t?this.getOpenPrefMap().put(e.getID(),t):this.getOpenPrefMap().delete(e.getID());const n=this.getOpenPrefMap()?this.getOpenPrefMap().getContent():{};return this.saveEngItemOpenContext(JSON.stringify(n))},getStaticMappingPreference(e){const t=this.app.core.sessionManager.getStaticForMappingAsOpenContext(e);return t&&t.pcInfo?t.pcInfo:null},getEngItemOpenPreferences(e){if(this.getStaticMappingPreference(e))return this.getStaticMappingPreference(e);const t=this.getOpenPrefMap();return t?t.get(e):null},catchUserPreference(){this.initializeWidgetPreferences(),this.app.mediator.publish(o.CONST_SPECIFICATIONS_TAB_UPDATE,this.app.editPropertyCmp.getUIFacets())},initializeWidgetPreferences(){this.app.core.settingManager.isCloud()&&this.set3DEXPERIENCEPlatformPreference(),this.setDisplayTypeChooserPreference(),this.setShowCreateFromSpreadsheet(),this.setShowNotInBOMPreference(),this.setSpecDocDisplayPreference(),this.setShow3DShapePreference(),this.setDisableIndexPreference(),this.setIntervalSwitchPreference(),this.setTerminalItemOptions(),this.setWorkUnderPreferences(),this.setDimensionUnitPreferences()},setDisplayTypeChooserPreference(){widget.addPreference({name:o.PREFERENCE_TYPE_CHOOSER,defaultValue:!1,type:"boolean",label:"displayTypeChooser"})},setShowCreateFromSpreadsheet(){const e=o.PREFERENCE_CREATE_SPREADSHEET;void 0===this.readWidgetPreference(e)&&this.saveWidgetPreference(e,!1),widget.addPreference({name:e,defaultValue:!1,type:"boolean",label:"showCreateFromSpreadsheet"})},setShowNotInBOMPreference(){widget.addPreference({name:o.PREFERED_SHOW_NOT_IN_BOM,defaultValue:!1,type:"boolean",label:"show_excludefrombom"})},setSpecDocDisplayPreference(){const e=!this.readWidgetPreference(o.CONST_DOC_AS_SPEC);widget.addPreference({name:o.CONST_DOC_AS_SPECS,defaultValue:e,type:"boolean",label:"eng.docAsSpec.productStructure"}),this.removePreferences([o.CONST_DOC_AS_SPEC])},setShow3DShapePreference(){widget.addPreference({name:o.CONST_SHOW_3DSHAPE,defaultValue:!1,type:"boolean",label:"eng.show.3dshape"})},setDisableIndexPreference(){widget.addPreference({name:o.PREFERENCE_USE_INDEX,defaultValue:!0,type:"boolean",label:"use_index",onchange:"onUseOnlyDBChange"}),widget.addEvent("onUseOnlyDBChange",this.onUseOnlyDBChange.bind(this))},setWorkUnderPreferences(){widget.getValue(o.USER_WORKUNDER_EVOL_PREF)||widget.setValue(o.USER_WORKUNDER_EVOL_PREF,o.VALUE_ASK_WORKUNDER_EVERYTIME),widget.addPreference({name:o.USER_WORKUNDER_EVOL_PREF,defaultValue:o.VALUE_ASK_WORKUNDER_EVERYTIME,type:"list",label:"evol_workunder_pref",options:[{label:"evol_workunder_combochoice_alwaysask",value:o.VALUE_ASK_WORKUNDER_EVERYTIME},{label:"evol_workunder_combochoice_alwaysset",value:o.VALUE_SET_WORKUNDER_ALWAYS},{label:"evol_workunder_combochoice_never",value:o.VALUE_SET_WORKUNDER_NEVER}]});let e=widget.getValue(o.CHANGECONTROL_SHOW_STATE);"boolean"!=typeof e&&(e=!0,widget.setValue(o.CHANGECONTROL_SHOW_STATE,e)),widget.addPreference({name:o.CHANGECONTROL_SHOW_STATE,defaultValue:e,type:"boolean",label:"eng.chgCtrl.Show",onchange:"onChangeControl"});let t=widget.getValue(o.CHANGECONTROL_POSITION);"string"!=typeof t&&(t=o.CHANGECONTROL_POSITION_BOTTOMRIGHT_VALUE,widget.setValue(o.CHANGECONTROL_POSITION,t)),!0===e?widget.addPreference({name:o.CHANGECONTROL_POSITION,defaultValue:t,type:"list",label:"eng.chgCtrl.Position",options:d,onchange:"onChangeControl"}):widget.addPreference({name:o.CHANGECONTROL_POSITION,type:"hidden"}),widget.addEvent("onChangeControl",this.onChangeControl.bind(this))},set3DEXPERIENCEPlatformPreference(){const e={name:"3DEXPERIENCEPlatform",defaultValue:this.app.core.settingManager.getPlatformId(),type:"list",label:"3DEXPERIENCEPlatform",options:this.app.core.settingManager.configuredTenantList,onchange:"onSetTenant"};1===this.app.core.settingManager.configuredTenantList.length&&(e.disabled="true"),widget.addPreference(e),widget.addEvent("onSetTenant",this.onSetTenant.bind(this))},async setDimensionUnitPreferences(){await this.dicoService.loadDimensionsWithUnits();const e=e=>({value:e.Name,label:e.NLSName});widget.addEvent("onSetMassUnit",this.onSetMassUnit.bind(this)),widget.addPreference({name:o.PREFERRED_MASS_UNIT,defaultValue:this.dicoService.getMKSUnitName(o.DIMENSION_MASS),type:"list",label:"eng.preferred_dimension_mass",options:this.dicoService.getUnits(o.DIMENSION_MASS).map(e),onchange:"onSetMassUnit"}),widget.addEvent("onSetVolumeUnit",this.onSetVolumeUnit.bind(this)),widget.addPreference({name:o.PREFERRED_VOLUME_UNIT,defaultValue:this.dicoService.getMKSUnitName(o.DIMENSION_VOLUME),type:"list",label:"eng.preferred_dimension_volume",options:this.dicoService.getUnits(o.DIMENSION_VOLUME).map(e),onchange:"onSetVolumeUnit"}),widget.addEvent("onSetAreaUnit",this.onSetAreaUnit.bind(this)),widget.addPreference({name:o.PREFERRED_AREA_UNIT,defaultValue:this.dicoService.getMKSUnitName(o.DIMENSION_AREA),type:"list",label:"eng.preferred_dimension_area",options:this.dicoService.getUnits(o.DIMENSION_AREA).map(e),onchange:"onSetAreaUnit"}),widget.addPreference({name:o.PREFERRED_LENGTH_UNIT,defaultValue:this.dicoService.getMKSUnitName(o.DIMENSION_LENGTH),type:"list",label:"eng.preferred_dimension_length",options:this.dicoService.getUnits(o.DIMENSION_LENGTH).map(e),onchange:"onSetLengthUnit"}),widget.addEvent("onSetLengthUnit",this.onSetLengthUnit.bind(this))},setIntervalSwitchPreference(e){const t=e||widget.getValue(o.PREFERENCE_USE_INDEX),n={name:o.PREFERENCE_INTERVAL_SWITCH_INDEX,defaultValue:"180",type:"list",label:"interval_to_switch",options:[{label:"zero_min",value:"0"},{label:"one_min",value:"60"},{label:"three_mins",value:"180"},{label:"five_mins",value:"300"},{label:"ten_min",value:"600"}]};t||(n.disabled="true"),widget.addPreference(n)},onUseOnlyDBChange(e,t){this.setIntervalSwitchPreference(t),widget.dispatchEvent("onEdit")},setDisplayCreatePanelPreference(e){const t={name:"CADAuthoring",defaultValue:!1,type:"boolean",label:"Ask_Me_CADAuthoring"};(e||widget.getValue("displayTypeChooser"))&&(widget.setValue("CADAuthoring",!0),t.disabled="true"),widget.addPreference(t)},setTerminalItemOptions(){const e=this.dicoService.getTerminalItemAtributes(),t=widget.getValue(o.FINAL_ITEMS_PREF)?widget.getValue(o.FINAL_ITEMS_PREF):o.FINAL_ITEMS_DEFAULT,n={name:o.FINAL_ITEMS_PREF,type:"list",label:"final_items_pref",options:[],defaultValue:t,onchange:"onTerminalItemChange"};n.options=n.options.concat(e),widget.addPreference(n),widget.addEvent("onTerminalItemChange",this.onTerminalItemChange.bind(this)),this.setTerminalItemValue(null,widget.getValue(o.FINAL_ITEM_VALUE_NAME))},onTerminalItemChange(e,t){this.app.core.PreferencesManager.setTerminalItemValue(t),widget.dispatchEvent("onEdit")},setTerminalItemValue(e,t){e=e||widget.getValue(o.FINAL_ITEMS_PREF);const n={name:o.FINAL_ITEM_VALUE_NAME,label:o.FINAL_ITEM_VALUE_LABEL};if(e===o.FINAL_ITEMS_DEFAULT)return n.type="hidden",widget.setValue(o.FINAL_ITEM_VALUE_NAME,""),void widget.addPreference(n);let i="";const r=this.app.core.dicoService.getTerminalAttributesInfo(e);if(!r)return;const s=r.rangeValues?r.rangeValues:r.AuthorizedValues;r.defaultValue=r.Default;const a=r.Type?r.Type:r.kind,l=this.app.core.i18nManager.get("eng.const.true"),c=this.app.core.i18nManager.get("eng.const.false");s&&s.length>0?(n.type="list",n.options=[],i=t||r.defaultValue,s.forEach(e=>{let t=e;"boolean"===a.toLowerCase()&&("TRUE"!==e||e.nlsValue?"FALSE"!==e||e.nlsValue||(t=c):t=l),n.options.push({label:e.nlsValue?e.nlsValue:t,value:e.value?e.value:e})})):"boolean"!==a.toLowerCase()||s&&s.length>0?(n.type="text",n.options=[],i=t||(r.defaultValue?r.defaultValue:""),n.onchange="onValidate"):(n.type="list",n.options=[],i=t||r.defaultValue,n.options.push({label:l,value:"true"},{label:c,value:"false"})),widget.setValue(o.FINAL_ITEM_VALUE_NAME,i),widget.addPreference(n),widget.addEvent("onValidate",this.onValidate.bind(this))},onValidate(e,t){const{type:n}=this.app.core.dicoService.getTerminalAttributesInfo(widget.getValue(o.FINAL_ITEMS_PREF));let i=t;"Integer"===n?i=parseInt(t,10):"Real"===n&&(i=parseFloat(t)),i&&t===i.toString()||console.log("Invalid Value")},onChangeControl(e,t){const n=widget.getValue(o.CHANGECONTROL_SHOW_STATE),i=widget.getValue(o.CHANGECONTROL_POSITION);!0===n?widget.addPreference({name:o.CHANGECONTROL_POSITION,defaultValue:i,type:"list",label:"eng.chgCtrl.Position",options:d}):widget.addPreference({name:o.CHANGECONTROL_POSITION,type:"hidden"}),widget.dispatchEvent("onEdit",{name:e,value:t})},getNLSValueForMassQuantity(){return this.getDefaultUnitNLS(o.DIMENSION_MASS)},getNLSValueForVolumeQuantity(){return this.getDefaultUnitNLS(o.DIMENSION_VOLUME)},getNLSValueForAreaQuantity(){return this.getDefaultUnitNLS(o.DIMENSION_AREA)},getNLSValueForLengthQuantity(){return this.getDefaultUnitNLS(o.DIMENSION_LENGTH)},getDefaultUnit(e){let t;switch(e){case o.DIMENSION_MASS:t=o.PREFERRED_MASS_UNIT;break;case o.DIMENSION_VOLUME:t=o.PREFERRED_VOLUME_UNIT;break;case o.DIMENSION_AREA:t=o.PREFERRED_AREA_UNIT;break;case o.DIMENSION_LENGTH:t=o.PREFERRED_LENGTH_UNIT}return widget.getValue(t)?widget.getValue(t):this.dicoService.getMKSUnitName(e)},getTerminalItem:()=>widget.getValue(o.FINAL_ITEMS_PREF),onSetVolumeUnit(e,t){widget.setValue(o.PREFERRED_VOLUME_UNIT,t)},onSetMassUnit(e,t){widget.setValue(o.PREFERRED_MASS_UNIT,t)},onSetAreaUnit(e,t){widget.setValue(o.PREFERRED_AREA_UNIT,t)},onSetLengthUnit(e,t){widget.setValue(o.PREFERRED_LENGTH_UNIT,t)},onSetTenant(e,t){this.app.core.settingManager.switchPlatformId(t),widget.dispatchEvent("onEdit"),r.warningAlert(this.app.core.i18nManager.get("eng.platform.changed.msg"))},isSpecificationsTabEnabled:()=>widget.getValue(o.CONST_DOC_AS_SPEC),isSpecInProductStructureEnabled:()=>widget.getValue(o.CONST_DOC_AS_SPECS),showNotInBOMEnabled:()=>widget.getValue(o.PREFERED_SHOW_NOT_IN_BOM),isShow3DShapeEnabled:()=>widget.getValue(o.CONST_SHOW_3DSHAPE),removePreferences(e){const t=widget.getPreferences();e.forEach(e=>{const n=t.findIndex(t=>t.name===e);-1!==n&&t.splice(n,1)}),widget.setPreferences(t)},isUserSelectedTypeChooserOption:()=>widget.getValue(o.PREFERENCE_TYPE_CHOOSER),isShowCreateFromSpreadsheetEnabled:()=>widget.getValue(o.PREFERENCE_CREATE_SPREADSHEET),getDefaultUnitNLS(e){const t=this.getDefaultUnit(e);return this.dicoService.getUnit(e,t).NLSName},getOpenPrefMap(){return this.openPrefMap},saveCurrentAttrDico(){const e=this.dicoService.getUserDicoPreferences(),t=JSON.stringify(e);this.saveAttrDico(t)},saveWidgetPreference(e,t){widget.setValue(e,t)},readWidgetPreference:e=>widget.getValue(e),saveFetchingMode(e){this.saveWidgetPreference("xEng_mode",e)},readFetchingMode(){return this.readWidgetPreference("xEng_mode")||{}},saveCredentialPreference(e){const t=i.getCredentialPreferenceKey();this.saveWidgetPreference(t,e)},loadOpenPreference(){return this.openPrefMap=new a({maxSize:this.app.core.settingManager.getSetting(o.PREFERENCE_MAX_SIZE),initialContent:{}}),this.readEngItemOpenContext().then(e=>{this.openPrefMap=new a({maxSize:this.app.core.settingManager.getSetting(o.PREFERENCE_MAX_SIZE),initialContent:e?JSON.parse(e):{}}),console.log(this.openPrefMap)}).catch(e=>{console.error(e)})},loadAttrDicoPreference(){return n.wrappedWithCancellablePromise(async e=>{let t=this.readAttrDicoWidgetPreference();if(!t)try{t=await this.readAttrDicoUserPreference()}catch(e){console.warn(e)}t&&this.dicoService.setAttributeDico(t);try{await this.upgradeAttrDicoPreference(t)}catch(e){console.error("upgradeAttrDicoPreference failed !")}e(t)})},saveUserPreference(t,i){if(!e.is(t)||!e.is(i))return null;this.logger.info(`saveUserPreference: ${t}`);const r=this.app.core.settingManager.getCommand("my_app_setPreference"),o={name:this.app.core.settingManager.getUserPrefKey(t),value:i};return n.wrappedWithCancellablePromise(e=>{s.perform(r,o).then(t=>e(t)).catch(()=>{console.warn("fail to save the user preference")})})},readUserPreference(t){if(!e.is(t))return null;this.logger.info(`readUserPreference: ${t}`);const i={...this.app.core.settingManager.getCommand("my_app_getPreference")};return i.url=`${i.url}?name=${this.app.core.settingManager.getUserPrefKey(t)}`,n.wrappedWithCancellablePromise((e,t)=>{s.perform(i).then(t=>t&&"string"==typeof t&&""!==t.trim()?e(t):e("")).catch(e=>{t(e)})})},saveRecents(e){return this.saveUserPreference(o.USER_RECENTS_ENG_ITEMS,e)},readRecents(){return this.readUserPreference(o.USER_RECENTS_ENG_ITEMS)},addToRecents(e){return e&&"string"==typeof e?this.readRecents().then(t=>{const n=this.updateRecentsList(t,e);n&&n!==t&&this.saveRecents(n)}).catch(()=>{console.warn("fail to read recents")}):null},removeFromRecents(e){return this.readRecents().then(t=>{let n=null;n=t&&""!==t.trim()?t.split(","):[];const i=[];for(let t=0;t<n.length;t+=1)-1===e.indexOf(n[t])&&i.push(n[t]);return this.saveRecents(i.join())})},updateRecentsList(t,n){if(!e.is(n))return null;let i=[];t&&"string"==typeof t&&(i=(t=t.replace(/"/g,"")).trim().split(","));const r=i.filter(e=>e!==n);r.unshift(n);const o=this.app.core.settingManager.getSetting("recentsEngItemsSize");return r.slice(0,o).join(",")},saveEngItemOpenContext(e){return this.saveUserPreference(o.USER_CONF_PREFERENCES,e)},readEngItemOpenContext(){return this.readUserPreference(o.USER_CONF_PREFERENCES)},saveAttrDico(e){return widget.setValue(o.XEN_CUSTO_KEY,e),this.saveUserPreference(o.XEN_CUSTO_KEY,e)},readAttrDicoWidgetPreference(){let t={};try{t=JSON.parse(widget.getValue(o.XEN_CUSTO_KEY)||"{}")}catch(e){console.error(e)}return t&&t.selectedExtensions&&Array.isArray(t.columns)&&t.columns.length>0&&t.selectedTypes?e.extend({},{columns:t.columns,selectedExtensions:t.selectedExtensions,selectedTypes:t.selectedTypes,customViewsInfo:t.customViewsInfo,customizeHeaderAttributes:t[o.CUSTOMIZE_HEADER_ATTRIBUTES]?t[o.CUSTOMIZE_HEADER_ATTRIBUTES]:this.app.core.settingManager.getIdCardSetting(o.DEFAULT_IDCARD_DISPLAY_ATTRIBUTES)}):null},readAttrDicoUserPreference(){return n.wrappedWithCancellablePromise((e,t)=>{this.readUserPreference(o.XEN_CUSTO_KEY).then(n=>n?("string"==typeof n&&(widget.getValue(o.XEN_CUSTO_KEY)||widget.setValue(o.XEN_CUSTO_KEY,n),n=JSON.parse(n)),n.selectedTypes&&n.selectedExtensions&&n.columns?e(n):t(null)):t(null)).catch(e=>t(e))})},async upgradeAttrDicoPreference(e){await this.upgradeAttributeEditableColumns(e),this.upgradeNoneDBAttribute(e),this.upgradeDefaultColumns(e,["level","occurence","rollup"]),this.upgradeQuantityAttributes(e),this.upgradeProductConfigurationColumn(e),this.upgradeQuantityRollupColumn(e)},upgradeQuantityRollupColumn(e){const{columns:t}=e||{};if(!Array.isArray(t))return;const n=t.findIndex(e=>"quantity"===e.dataIndex),i=t.findIndex(e=>"rollup"===e.dataIndex),r=t.filter(e=>"quantity"===e.dataIndex||"rollup"===e.dataIndex).find(e=>e.visibleFlag);i>=0&&(t[i].visibleFlag=!!r),n>=0&&t.splice(n,1)},upgradeProductConfigurationColumn(e){const{columns:t}=e||{};if(!Array.isArray(t))return;const n=t.findIndex(e=>{const{dataIndex:t,provider:n}=e;return"Configuration"===t&&"configurationColumnsProvider"===n});if(-1===n)return;t[n].dataIndex="ProductConfiguration",t[n].ds6w="ProductConfiguration"},async upgradeAttributeEditableColumns(e){const{columns:t,selectedExtensions:n,selectedTypes:i}=e||{};if(!Array.isArray(t))return;const r=t.filter(this.filterEditablePredicateColumnWithoutEditableFlag.bind(this));if(r.length)try{const e=[...n,...i],t=await c.getPropertiesForClasses(e,this.app.core),o=l.getAttributePredicatesFromClassPredicates(t,this.dicoService.getControlledAppPredicates(),this.dicoService.getMultiValuedAtributes());Array.isArray(o)&&o.length&&r.forEach(e=>{const{dataIndex:t}=e,n=o.find(e=>e.uri===t);if(n){const{nature:t,userAccess:i}=n;t&&!e.nature&&(e.nature=t),i&&!e.userAccess&&(e.userAccess=i)}else console.warn(`column ds6w : ${t} not found in predicates`)})}catch(e){console.error(e)}},upgradeNoneDBAttribute(e){const{columns:t}=e||{};Array.isArray(t)&&t.filter(e=>"level"===e.dataIndex||"occurence"===e.dataIndex||"rollup"===e.dataIndex||"quantity"===e.dataIndex).forEach(e=>{e.dbName=""})},upgradeDefaultColumns(e,t){if(!Array.isArray(t))return;const{columns:n}=e||{},{columns:i}=this.dicoService.getDefaultAttributes()||{};t.forEach(e=>this.upgradeDefaultColumn(e,n,i))},upgradeQuantityAttributes(e){const{columns:t}=e||{};if(!Array.isArray(t))return;const n=t.findIndex(e=>"ds6wg:MaterialUsageExtension.DeclaredQuantity"===e.dataIndex);-1!==n&&t.splice(n,1),this.upgradeDefaultColumns(e,["ds6wg:DELFmiContQuantity_Mass.V_ContQuantity","ds6wg:DELFmiContQuantity_Volume.V_ContQuantity"])},upgradeDefaultColumn(e,t,n){if("string"!=typeof e||!e.trim().length)return;if(!Array.isArray(t)||!Array.isArray(n))return;if(-1!==t.findIndex(t=>t.dataIndex===e))return;console.debug(`column: ${e} not found in stored user preferences => try to add it`);const i=n.findIndex(t=>t.dataIndex===e);if(-1!==i){let r=i;if(i>0){const e=n[i-1].dataIndex;if("string"==typeof e&&e.trim().length){const n=t.findIndex(t=>t.dataIndex===e);-1!==n&&(r=n+1)}}if(-1!==r){console.debug(`column: ${e} inserted at ${r} position`);const o={...n[i],visibleFlag:!1};r<t.length?t.splice(r,0,o):t.push(o)}}else console.error(`column: ${e} not found in default preferences`)},filterEditablePredicateColumnWithoutEditableFlag(e){if("object"!=typeof e)return!1;if(Reflect.has(e,"isAdditionalColumn"))return!1;const{dbName:t,dataIndex:n}=e||{};return"string"==typeof n&&0!==n.trim()&&(-1===Reflect.ownKeys(this.dicoService.getControlledAppPredicates()).indexOf(n)&&(!Reflect.has(e,"editable")&&("string"==typeof t&&0!==t.trim()&&(!Reflect.has(e,"nature")&&this.dicoService.isAGeneratedPredicate(e.dataIndex)))))}})}),define("DS/ENOXEngineer/services/SessionPredicates/ClassifPredicatesProvider",["DS/ENOXEngineer/services/SessionPredicates/PredicatesProvider","DS/ENOXEngineerCommonUtils/LoggerUtils","DS/ENOXEngineer/services/SessionPredicates/SessionPredicatesErrors","DS/ENOX3DSpaceAttributesMgt/services/fetchClassificationServices","DS/ENOXEngineer/services/SessionPredicates/Utils"],(e,t,n,i,r)=>{const{Logger:o}=t,{constants:s}=r,a=o.create(s.SESSION_PREDICATES_LOGGER_ID,"ClassifPredicatesProvider"),{WrongInput:l,ClassifFetchError:c}=n;class d extends e{init(){this.initPredicateMap(),this.startARunningJob({jobToRun:this.initWithClassificationAttributes.bind(this)})}async isBusy(){await super.isBusy()}initPredicateMap(){this.predicatesMap=new Map}async initWithClassificationAttributes(){this.available=await this.isClassificationAuthorized(),this.available&&await this.fillPredicatesMap()}async isClassificationAuthorized(){let e=!1;try{e=await i.classificationExtensionProperties.isAvailable()}catch(t){e=!1}return e}async fillPredicatesMap(){try{const e=await this.fetchClassifAttributesPredicates();this.fillMapWithPredicatesAsClasses(e)}catch(e){a.error("something goes wrong with fetchClassifAttributesPredicates")}}async fetchClassifAttributesPredicates(){return await i.fetchPropertiesForClassificationClass({settingManager:this.settingManager})}fillMapWithPredicatesAsClasses(e){if(!Array.isArray(e)||!e.length)throw new l("ClassifPredicatesProvider.fillMapWithPredicatesAsClasses");const t=r.formatClassesPredicatesToPropertiesPredicates(e);if(!Array.isArray(t)||!t.length)throw new c("no predicates found");this.updatePredicateMapWithPredicates(t)}updatePredicateMapWithPredicates(e){if(!Array.isArray(e))throw new l("ClassifPredicatesProvider.updatePredicateMapWith");r.udpateMapWithNewValues(this.predicatesMap,e)}getPredicateProperties(e){return this.predicatesMap.get(e)||[]}getPredicatePropertiesForSelectable(e){if(!r.isAValidNotEmptyString(e))throw new l("ClassifPredicatesProvider.getPredicatePropertiesForSelectable");const t=[];return this.predicatesMap.forEach(n=>{const i=n.filter(n=>{const{selectable:i}=n;return r.getAttributeFromSelectable(i)===e&&t.push(n),!1});t.push(...i)}),t}get settingManager(){return this.appCore.settingManager||{}}get label(){return d.name}}return a.enable?class extends d{async isBusy(){await super.isBusy(),a.log("isBusy resolve")}async initWithClassificationAttributes(){const e=Date.now();a.log("initWithClassificationAttributes starting"),await super.initWithClassificationAttributes();const t=Date.now()-e;a.log(`initWithClassificationAttributes ending in ${t} ms`)}async isClassificationAuthorized(){const e=await super.isClassificationAuthorized();return a.log(`Classification authorized : ${e}`),e}getPredicateProperties(e){a.log(`getPredicateProperties for (${e})`);const t=super.getPredicateProperties(e);return a.log(`found ${t.length} properties`),t}}:d}),define("DS/ENOXEngineer/componentsHelpers/ENOXListReportsView/js/ENOXListReportsView",["UWA/Core","DS/DataGridView/DataGridView","DS/ENOXEngineer/utils/Utils","css!DS/ENOXEngineer/componentsHelpers/ENOXListReportsView/css/ENOXListReportsView.css"],(e,t,n)=>{return class{constructor(e){this.container=this.buildGridView(e)}get view(){return this.container}buildGridView(i){const{appCore:r,viewModel:o,callbacks:s}=i,{i18nManager:a}=r,l=e=>{if("string"!=typeof e)return null;const t=e.indexOf(":");return-1!==t?e.substring(0,t):e},c=new t({identifier:"xapp-list-reports-gridview",treeDocument:o,columns:[{text:a.get("Title"),dataIndex:"tree",pinned:"left",alwaysVisibleFlag:!0,minWidth:150,typeRepresentation:"string"},{text:a.get("Name"),dataIndex:"name"},{text:a.get("ds6wg:revision"),dataIndex:"revision",width:"100px"},{text:a.get("report.originated"),dataIndex:"originated",typeRepresentation:"datetime",semantics:{timePickerPrecision:"sec"},getCellValue(e){const t=e?e.nodeModel:null;return t?n.convertDateNodeValueToCellValue(t.getAttributeValue("originated")):""}},{text:a.get("Owner"),dataIndex:"owner"},{text:a.get("Generation Status"),minWidth:100,dataIndex:"generationStatus",typeRepresentation:"url",getCellValue(e){let t,n;const{status:i,message:r}=e.nodeModel._options.data.generation;switch(i){case"None":n="wrong",t=l(r)||a.get("report.NotGenerated");break;case"Failed":n="wrong",t=l(r)||a.get("report.Failed");break;case"NeedPostEdition":case"NeedPostEditionAndWithChanges":n="alert",t=l(r)||a.get("report.NeedPostEdition");break;case"Succeeded":case"Completed":n="download",t=l(r)||a.get("report.GenerationCompleted");break;default:n="hourglass",t=l(r)||a.get("report.GenerationRunning")}return{icon:n,label:t,func(e){const{cellModel:t,nodeModel:n}=e.context||{};t&&"download"===t.icon&&s&&"function"==typeof s.download&&s.download(n._options.data)}}}}],defaultColumnDef:{width:"auto",typeRepresentation:"string"},placeholder:a.get("failure.ReportCmd.noReportFound")});c.rowSelection="single",c.columnSelection="none",c.cellSelection="none";const d=e.createElement("div",{class:"xapp-list-reports-container"});return c.getContent().inject(d),d}}}),define("DS/ENOXEngineer/services/SessionPredicates/MultiPredicatesChooserDlg",["UWA/Core","DS/ENOXEngineerCommonUtils/LoggerUtils","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/services/SessionPredicates/Utils","DS/Windows/Dialog","DS/Controls/Button","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","css!DS/ENOXEngineer/services/SessionPredicates/MultiPredicatesChooserDlg.css"],(e,t,n,i,r,o,s,a,l)=>{const{Logger:c}=t,{constants:d}=i,u=c.create(d.SESSION_PREDICATES_LOGGER_ID,"MultiPredicatesChooserDlg"),p={getNodeInput(){return this.options.data.input},getCurrentSelectableValue(e){const t=this.getNodeInput(),{editablePaths:n,managedPath:i}=t;let r=null;if(n){const t=n.find(t=>t.selectable===e);t&&(r=Array.isArray(t.values)?t.values:[])}else i&&i.selectable===e&&(r=Array.isArray(i.values)?i.values:[]);return this.formatValuesForUI(r)},formatValuesForUI:e=>e.map(e=>i.isStringADate(e)?n.getDGVformatedDate(e):e),getNewValue(){return this.getNodeInput().objectAttribute.newValue},hasSelectable(e){const{grid:t}=this.options;return Reflect.has(t,e)},getSelectedEditablePaths(){const{grid:e}=this.options,t=this.getNodeInput(),{editablePaths:n,managedPath:i}=t,r=[];return Reflect.ownKeys(e).forEach(t=>{if(e[t])if(n){const e=n.find(e=>e.selectable===t);e&&r.push(e)}else i&&i.selectable===t&&r.push(i)}),r}};class g{constructor(e){this.appCore=e}setInputs(e){const{editablesToSolve:t,resolvedEditables:n}=e;this.inputs=[...t,...n]}async lauchResolve(){return this.buildUI(),this.showDialog(),await this.waitingForCloseDialogCB(),this.resolvedResults}async buildUI(){const e=this.immsersiveFrame,t=this.buildContent();this.modal=new r({title:this.title,content:t,immersiveFrame:e,closeButtonFlag:!1,usePaddingFlag:!1,resizableFlag:!0,modalFlag:!0,width:580,buttons:{Ok:new o({label:this.i18nManager.get("eng.ui.button.save"),onClick:this.onOkButton.bind(this)}),Cancel:new o({label:this.i18nManager.get("eng.ui.button.cancel"),onClick:this.onCancelButton.bind(this)})}})}buildContent(){const t=new e.Element("div",{class:"xapp-multipredicates-dlg-content"});return this.buildIntroDiv().inject(t),this.buildDataGridViewModel(),this.buildGridViewDiv().inject(t),t}buildIntroDiv(){const t=new e.Element("div",{class:"xapp-multipredicates-dlg-intro"}),n=this.i18nManager.get("SessionPredicateEditionCmd.dialog.resume").replace("{column}",this.predicatesAsNlsString);return new e.Element("p",{class:"xapp-multipredicates-dlg-intro-text",text:n}).inject(t),t}buildDataGridViewModel(){this.treeModel=new a;const e=this.inputs.map(e=>this.buildANodeFromInput(e));this.treeModel.prepareUpdate(),e.forEach(e=>{this.treeModel.addRoot(e)}),this.treeModel.pushUpdate()}buildANodeFromInput(e){const{objectAttribute:t,editablePaths:n,managedPath:i}=e,r=[];i&&r.push(i),Array.isArray(n)&&r.push(...n);const o=t.input.nodeToEdit.getLabel(),s={};r.forEach(e=>{const{selectable:t}=e;s[t]=!0});const a=new l({label:o,grid:{...s},data:{input:e}});return Object.assign(a,p)}buildGridViewDiv(){const t=new e.Element("div",{class:"xapp-multipredicates-dlg-grid"}),n=[{text:this.i18nManager.get("Title"),dataIndex:"tree",width:"auto",typeRepresentation:"string",editableFlag:!1,sortableFlag:!1,resizableFlag:!0},...this.editablePaths.map(e=>{return{text:e.nls,dataIndex:e.selectable,width:"auto",editableFlag:!1,sortableFlag:!1,resizableFlag:!0,typeRepresentation:"boolean",editionPolicy:"EditionInPlace",getCellSemantics(e){const{columns:t}=this,{nodeModel:n,columnID:i}=e;let r="";const{dataIndex:o}=t[i];return n.hasSelectable(o)&&(r=n.getAttributeValue(o)?n.getNewValue():n.getCurrentSelectableValue(o)),{label:r}},getCellEditableState(e){const{columns:t}=this,{nodeModel:n,columnID:i}=e,{dataIndex:r}=t[i];return n.hasSelectable(r)}}})];return new s({treeDocument:this.treeModel,columns:n,defaultColumnDef:{width:"auto",typeRepresentation:"string"}}).getContent().inject(t),t}formatEditablesToResolveForUX(){return i.formatEditableForUXChooser(this.editablesToSolve)}showDialog(){this.modal.show()}waitingForCloseDialogCB(){return new Promise(e=>{this.closeDialogCB=(()=>{this.closeDialog(),e()}),this.onReadyCB()})}onReadyCB(){}onOkButton(){this.buildResult(),this.closeDialogCB()}buildResult(){this.results=[],this.treeModel.getRoots().forEach(e=>{const{objectAttribute:t}=e.getNodeInput();e.getSelectedEditablePaths().forEach(e=>{this.results.push({objectAttribute:t,editablePath:e})})})}onCancelButton(){this.hasAborted=!0,this.closeDialogCB()}closeDialog(){this.modal.close()}get title(){const e=this.i18nManager.get("SessionPredicateEditionCmd.dialog.title");let t=e;return this.isMonoPredicate&&(t=`${e}: ${this.predicatesAsNlsString}`),t}get editablesToSolve(){return this.inputs}get immsersiveFrame(){return this.appCore.moduleHelper.viewsService.getApplicationImmersiveFrame()}get i18nManager(){return this.appCore.i18nManager}get resolvedResults(){return Array.isArray(this.results)?this.results:[]}get mediator(){return this.appCore.mediator}get abortState(){return this.hasAborted||!1}get predicatesToEdit(){return this.inputs.map(({objectAttribute:e})=>e.predicateToEdit)}get predicatesAsNlsString(){const e=this.inputs.map(({objectAttribute:e})=>e.attribute.text);return i.removeDuplicates(e).join(", ")}get isMonoPredicate(){return 1===i.removeDuplicates(this.predicatesToEdit).length}get editablePaths(){return this.inputs.reduce((e,t)=>{const{editablePaths:n,managedPath:i}=t;return Array.isArray(n)&&n.forEach(t=>{e.find(e=>e.selectable===t.selectable)||e.push(t)}),i&&(e.find(e=>e.selectable===i.selectable)||e.push(i)),e},[])}}return u.enable?class extends g{}:g}),define("DS/ENOXEngineer/controllers/RecentsEngItemsController",["DS/ENOXEngineerCommonUtils/XENMask","DS/ENOXEngineer/componentsHelpers/GridViewConfigurator/GridViewConfigurator","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n){"use strict";return function(i){var r=this;if(this.recentsCmp=null,r.isFirstRendering=!0,!i)throw new Error("options are mandatory");if(!i.app||!i.parentController)throw new Error("app and parentController are mandatory");var o=i.parentController,s=i.app;return{activate:function(){s.mediator.publish(n.EVENT_SELECT_ACTION_WP,{id:"recent_items"}),s.mediator.publish(n.EVENT_TRIPTYCH_SHOW_PANEL,"left"),r.isFirstRendering?(r.isFirstRendering=!1,e.mask(UWA.extendElement(o.triptychCmp.mainDiv)),r.recentsCmp=s.componentsMgt.startNewInstance(n.MY_ENG_ITEM_CMP,o.triptychCmp.mainDiv,t.recentsEngItemsConfigurator())):(r.recentsCmp.reRender(),s.mediator.publish(n.EVENT_REFRESH_LANDING_DATA))},deactivate:function(){r.recentsCmp.stop()}}}}),define("DS/ENOXEngineer/commands/SessionPredicateEditionCmd",["DS/ENOXEngineer/services/SessionPredicates/SessionPredicatesErrors","DS/ENOXEngineerCommonUtils/LoggerUtils","DS/ENOXEngineer/services/SessionPredicates/Utils","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/services/SessionPredicates/ReadAttributeInfoFacade","DS/ENOXEngineer/services/SessionPredicates/ObjectAttributeFactory","DS/ENOXEngineer/services/SessionPredicates/MultiPredicatesChooserDlg"],(e,t,n,i,r,o,s,a)=>{const{WrongInput:l,SessionPredicateEditionError:c}=e,{Logger:d}=t,{constants:u}=n,p=d.create(u.SESSION_PREDICATES_LOGGER_ID,"SessionPredicateEditionCmd");class g{constructor(e){this.appCore=e,this.inputs=[],this.setOnWidgetRefreshCallBack()}setOnWidgetRefreshCallBack(){widget&&widget.addEventOnce("onRefresh",this.onWidgetRefresh.bind(this))}onWidgetRefresh(){this.end()}addObjectPredicateToEdit(e){this.inputs.push({...e})}async begin(){return await this.run(),this.results}async run(){try{this.hasValidInputs(),await this.isReady(),await this.execute(),this.succeeded()}catch(e){p.error(`something happens ${e}`),this.abort(e)}finally{this.end()}}hasValidInputs(){if(!this.appCore)throw new l("invalid appCore");if(!this.userInputs.length)throw new l("nothing to edit");this.userInputs.forEach(e=>{const{nodeToEdit:t,attributeToEdit:i}=e;if(!i)throw new l("invalid attributeToEdit");if(!n.isAValidNotEmptyString(i.ds6w)&&!n.isAValidNotEmptyString(i.dataIndex))throw new l("invalid predicateToEdit");if(!t)throw new l("invalid nodeToEdit");if(!Reflect.has(e,"newValue"))throw new l("missing newValue input")})}async isReady(){await this.waitForServiceReadyState()}async waitForServiceReadyState(){await this.predicatesService.isReady(),await this.predicatesService.waitforProvidersReady()}async execute(){this.buildObjectAttributesListFromInputs(),await this.buildObjectAttsToEditablePathsList();const e=this.buildUpdateInputs();e.length&&await this.updateValues(e)}buildObjectAttributesListFromInputs(){this.objectAttributesList=this.userInputs.map(e=>s.buildAnObjectAttributeFromInput(e))}async buildObjectAttsToEditablePathsList(){await this.fetchObjectsAttributesInfos();const e=[...this.buildManagedObjectAttributesPathList(),...await this.buildUnknownObjectAttributesPathList()],t=(await this.managedEditablePaths(e)).map(({objectAttribute:e,managedPath:t})=>({objectAttribute:e,path:t}));this.objectsToEditablePaths=t}buildManagedObjectAttributesPathList(){if(!this.objectAttributesWithManagedPath.length)return[];return this.objectAttributesWithManagedPath.map(e=>{const t=e.isPredicateToPathManaged(e.predicateToEdit);return{objectAttribute:e,paths:[{selectable:t}]}}).map(({objectAttribute:e,paths:t})=>{return{objectAttribute:e,editablePaths:this.getObjectEditablePaths(e,t)}})}async buildUnknownObjectAttributesPathList(){if(!this.objectAttributesWithUnknownPath.length)return[];return await this.fetchEditablePathsForUnknownObjectAttributes()}async fetchEditablePathsForUnknownObjectAttributes(){return await this.updatePredicateServiceWithUnknownTypesAndExtensions(),(await this.getEditablePathForUnknownAttributes()).map(({objectAttribute:e,paths:t})=>{return{objectAttribute:e,editablePaths:this.getObjectEditablePaths(e,t)}})}buildUpdateInputs(){return this.objectsToEditablePaths.map(({objectAttribute:e,path:t})=>({attribute:{...e.attribute,path:t.selectable},node:e.input.nodeToEdit,physicalid:e.physicalid,value:e.newValue}))}async updateValues(e){this.updateAttributesAnswer=await this.dataService.updateAttributes(e),this.checkErrorsFromUpdateValuesResults()}checkErrorsFromUpdateValuesResults(){if(!this.updateAttributesAnswer)throw new c("updateValues fails");const{invalidMandatoryAttrs:e,invalidReadOnlyAttrs:t,issues:n,notUpdated:i}=this.updateAttributesAnswer;if([...e,...t,...n,...i].length)throw new c("updateValues fails")}async managedEditablePaths(e){if(!Array.isArray(e))throw new l("managedEditablePaths");const t=[],n=[];e.forEach(({objectAttribute:e,editablePaths:i})=>{if(i.length)if(1===i.length){const[t]=i;p.log(`one managed path found: ${t}`),n.push({objectAttribute:e,managedPath:t})}else t.push({objectAttribute:e,editablePaths:i});else p.log("no editable path found")});let i=[];return i=t.length?await this.getResultsFromResolutionDialog({resolvedEditables:n,editablesToSolve:t}):n}async getResultsFromResolutionDialog(e){return(await this.chooseAnEditablePatch(e)).map(({objectAttribute:e,editablePath:t})=>(p.log(`one resolve path found: ${t}`),{objectAttribute:e,managedPath:t}))}async chooseAnEditablePatch(t){this.pathChooserDlg=new a(this.appCore),this.pathChooserDlg.setInputs(t);const n=await this.pathChooserDlg.lauchResolve(),{abortState:i}=this.pathChooserDlg;if(delete this.pathChooserDlg,i){const{AbortMultiPredicateChooser:t}=e;throw new t}return n}closeResolutionPanelIfAny(){this.pathChooserDlg&&(this.pathChooserDlg.onCancelButton(),delete this.pathChooserDlg)}getObjectEditablePaths(e,t){const n=t.map(({selectable:e})=>e);return this.objectsAttributesInfos.findPathsAsObjectProperties(e.physicalid,n).filter(e=>!e.readOnly).map(({path:e,selectable:t,nls:n,value:i})=>({selectable:e||t,nls:n,values:i}))}async updatePredicateServiceWithUnknownTypesAndExtensions(){const e=[],t=[];this.objectAttributesWithUnknownPath.forEach(n=>{const{types:i,extensions:r}=this.objectsAttributesInfos.getTypesAndExtensionsFor(n.physicalid);Array.isArray(i)&&e.push(...i),Array.isArray(r)&&t.push(...r)}),await this.updateSessionPredicateServiceWith({types:n.removeDuplicates(e),extensions:n.removeDuplicates(t)})}async getEditablePathForUnknownAttributes(){const e=await this.fetchEditablePathsForUnknownPredicates();return this.objectAttributesWithUnknownPath.map(t=>({objectAttribute:t,paths:e[t.predicateToEdit]}))}async fetchEditablePathsForUnknownPredicates(){const e=this.unknownPredicates.map(e=>this.getEditablePathsFromPredicateService(e)),t=await Promise.allSettled(e),i={};return t.forEach(e=>{if(e.status===n.constants.FULFILLED_PROMISE){const{predicateToEdit:t,editableSelectables:n}=e.value;i[t]=n}else p.error("some getEditablePathsFromPredicateService failed")}),i}async fetchObjectsAttributesInfos(){const e={lIds:[],busIDs:[],relIDs:[]};this.objectAttributes.forEach(t=>{n.isAnInstanceAttribute(t.attribute)?e.relIDs.push(t.physicalid):e.busIDs.push(t.physicalid)});let t=null;try{t=await this.dataService.readAttributes(e)}catch(e){throw new c(`readAttributes service fails ${e}`)}this.objectsAttributesInfos=new o(t)}async updateSessionPredicateServiceWith(e){this.mediator.publish(i.EVENT_UPDATE_SESSIONPREDICATE,e),await this.waitForServiceReadyState()}async getEditablePathsFromPredicateService(e){const{PropertiesHelpersFunc:t}=n;return{predicateToEdit:e,editableSelectables:(await this.predicatesService.findPredicateProperties(e,t.isASingleEditableAttribute)).map(({desciption:e,label:t,selectable:n})=>({desciption:e,label:t,selectable:n})).reduce((e,t)=>{return e.find(({selectable:e})=>t.selectable===e)||e.push(t),e},[])}}abort(t){const{AbortMultiPredicateChooser:n}=e;t instanceof n||this.displayErrorAlert(t)}succeeded(){const{success:e}=this.results;e.length?this.displaySucceededAlert():this.displayNoEditableAttributesAlert()}end(){this.closeResolutionPanelIfAny()}displaySucceededAlert(){const e=this.i18nManager.get("SessionPredicateEditionCmd.success.generic");return this.alertManager.sucessAlert(e)}displayErrorAlert(){const e=this.i18nManager.get("SessionPredicateEditionCmd.error.generic");return this.alertManager.errorAlert(e)}displayNoEditableAttributesAlert(){const e=this.i18nManager.get("SessionPredicateEditionCmd.warning.noEditableAttribute");return this.alertManager.warningAlert(e)}get dicoService(){return this.appCore.dicoService}get i18nManager(){return this.appCore.i18nManager}get dataService(){return this.appCore.dataService}get contextManager(){return this.appCore.contextManager}get mediator(){return this.appCore.mediator}get predicatesService(){return this.appCore.sessionPredicatesService}get objectAttributes(){return this.objectAttributesList||[]}get objectAttributesWithManagedPath(){return this.objectAttributesList.filter(e=>e.isPredicateToPathManaged())}get objectAttributesWithUnknownPath(){return this.objectAttributesList.filter(e=>!e.isPredicateToPathManaged())}get unknownPredicates(){const e=this.objectAttributesWithUnknownPath.map(e=>e.predicateToEdit);return n.removeDuplicates(e)}get userInputs(){return this.inputs||[]}get results(){return this.updateAttributesAnswer||{invalidMandatoryAttrs:[],invalidReadOnlyAttrs:[],issues:[],notUpdated:[],success:[]}}get alertManager(){return r}}return p.enable?class extends g{async run(){p.log("[ENTRY] run");const e=Date.now();await super.run();const t=Date.now()-e;p.log(`[EXIT] run: ${t} ms`)}async waitForServiceReadyState(){p.log("[ENTRY] waitForServiceReadyState");const e=Date.now();await super.waitForServiceReadyState();const t=Date.now()-e;p.log(`[EXIT] waitForServiceReadyState: ${t} ms`)}async execute(){p.log(`[ENTRY] execute with ${this.userInputsAsString}`);const e=Date.now();await super.execute();const t=Date.now()-e;p.log(`[EXIT] execute: ${t} ms`)}buildObjectAttributesListFromInputs(){p.log("[ENTRY] buildObjectAttributesListFromInputs"),super.buildObjectAttributesListFromInputs(),p.log("[EXIT] buildObjectAttributesListFromInputs")}async buildObjectAttsToEditablePathsList(){p.log("[ENTRY] buildObjectAttsToEditablePathsList");const e=Date.now();await super.buildObjectAttsToEditablePathsList();const t=Date.now()-e;p.log(`[EXIT] buildObjectAttsToEditablePathsList: ${t} ms`)}buildManagedObjectAttributesPathList(){p.log("[ENTRY] buildManagedObjectAttributesPathList");const e=super.buildManagedObjectAttributesPathList();return p.log(`[EXIT] buildManagedObjectAttributesPathList found: ${e.length} attributes`),e}async buildUnknownObjectAttributesPathList(){p.log("[ENTRY] buildUnknownObjectAttributesPathList");const e=await super.buildUnknownObjectAttributesPathList();return p.log(`[EXIT] buildUnknownObjectAttributesPathList found: ${e.length} attributes`),e}async updateValues(e){p.log(`[ENTRY] updateValue for ${JSON.stringify(e)}`);const t=Date.now();await super.updateValues(e);const n=Date.now()-t;p.log(`[EXIT] updateValue: ${n} ms`)}async updateSessionPredicateServiceWith(e){p.log(`[ENTRY] updateSessionPredicateServiceWith with ${JSON.stringify(e)}`);const t=Date.now();await super.updateSessionPredicateServiceWith(e);const n=Date.now()-t;p.log(`[EXIT] updateSessionPredicateServiceWith: ${n} ms`)}async managedEditablePaths(e){p.log("[ENTRY] managedEditablePaths");const t=await super.managedEditablePaths(e);return p.log("[EXIT] managedEditablePaths"),t}get userInputsAsString(){const e=this.userInputs.map(e=>({predicateToEdit:e.predicateToEdit,node:{referenceId:e.nodeToEdit.getID?e.nodeToEdit.getID():"",relationId:e.nodeToEdit.getRelationID?e.nodeToEdit.getRelationID():""},attributeToEdit:e.attributeToEdit}));return JSON.stringify(e)}}:g}),define("DS/ENOXEngineer/controllers/XEngineerBootstrap",["DS/ENOXEngineer/controllers/LandingPageController","DS/ENOXEngineer/controllers/ItemViewController","DS/ENOXEngineer/controllers/RecentsEngItemsController","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/XENMask","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/PlatformAPI/PlatformAPI","DS/ENOXEngineer/columnsFormatter/PreferredUnitColumnProvider","DS/AuthGenericCommands/AuthGenericCmdWSAccess"],function(e,t,n,i,r,o,s,a,l){"use strict";function c(e){this.app=e;var t=widget.getValue("routerState")?widget.getValue("routerState"):{};this._states=t.previousStates?t.previousStates:[]}return c.prototype.initialize=function(){var o=this;this.triptychCmp=null,this.app.editPropertyCmp=null,this.welcomePanelCmp=null,this.eventsBroker=this.app.mediator.getApplicationBroker(),widget.body.empty(),r.unmask(widget.body);var s=document.createElement("div");s.classList.add("xeng-app-container");var a=this.app.core.moduleHelper.viewsService.getApplicationImmersiveFrame();this.app.core.contextManager.elements.container=document.body,a.setContentInBackgroundLayer(s),widget.body.appendChild(a.getContent()),this.triptychCmp=this.app.componentsMgt.startNewInstance(i.TRIPTYCH_CMP,s),this.welcomePanelCmp=this.app.componentsMgt.startNewInstance(i.WELCOME_PANEL_CMP,this.triptychCmp.leftSideDiv),o.app.componentsMgt.startInstances([{name:i.PROPERTY_CMP,container:o.triptychCmp.rightDiv,contextData:{items:[]}}]).then(function(e){o.app.editPropertyCmp=e[0]}),this.globalEventsManagement(),this.app.router.routerMethods={},this.addRouteManager("myEngItems",new e({app:this.app,parentController:this})),this.addRouteManager("engItem_View",new t({app:this.app,parentController:this})),this.addRouteManager("recents_items",new n({app:this.app,parentController:this})),this.app.routerUtils.listenToRouterStateChanges(this.app.router);this.app.router.useMiddleware(function(e){return function(e,t){return"recents_items"===e.name&&(o._states=[]),o.pushNewRouterState(e),!0}}),this.app.core.viewState={isChildView:function(){return o.isChildView()}}},c.prototype.pushNewRouterState=function(e){var t=!1,n=widget.getValue("routerState");if(n&&e.name===n.current_State.name){for(var i in e.params)if(e.params.hasOwnProperty(i)&&e.params[i]!==n.current_State.params[i]){t=!0;break}if(!t)return null}this._states.push(e),widget.setValue("routerState",{current_State:e,previousStates:this._states})},c.prototype.popPreviousState=function(){return this._states.pop(),this._states.pop()},c.prototype.replaceCurrentRouterState=function(e){var t=!0,n=widget.getValue("routerState");if(n&&e.name===n.current_State.name){for(var i in e.params)if(e.params.hasOwnProperty(i)&&e.params[i]!==n.current_State.params[i]){t=!0;break}if(!t)return null}this._states.push(e),widget.setValue("routerState",{current_State:e,previousStates:this._states})},c.prototype.isChildView=function(){var e=this._states.length<2?null:this._states[this._states.length-2];return!!e&&"engItem_View"===e.name},c.prototype.globalEventsManagement=function(){var e=this;a.initialize({appCore:e.app.core}),s.subscribe("DS/PADUtils/PADCommandProxy/refresh",function(t){t.data&&t.data.authored&&t.data.authored.deleted&&e.app.sandboxBase.PreferencesManager.removeFromRecents(t.data.authored.deleted).then(function(n){e.app.mediator.publish(i.EVENT_DELETED_ENG_ITEM,{ids:t.data.authored.deleted})})}),s.subscribe("XEN/PUBLIC_EVENT/ENGINEERING_ITEM/PART_NUMBER_UPDATED",function(t){if(e.app.mediator){var n=[];t.references.forEach(function(e){e={physicalid:e.physicalid,attributes:[{name:"ds6wg:EnterpriseExtension.V_PartNumber",value:e.partNumber}]};n.push(e)});var r={references:n,dataIndex:"ds6wg:EnterpriseExtension.V_PartNumber"};e.app.mediator.publish(i.EVENT_MODIFIED_REFERENCES,r)}}),s.subscribe("XEN/PUBLIC_EVENT/ENGINEERING_ITEM/ALTERNATE_UPDATED",function(t){if(e.app.mediator){var n=[];t.forEach(function(e){e={physicalid:e.physicalid,attributes:[{name:"Alternate",value:e.alternate}]};n.push(e)});var r={references:n,dataIndex:"Alternate"};e.app.mediator.publish(i.EVENT_MODIFIED_REFERENCES,r)}}),s.subscribe("XSR/PUBLIC_EVENT/MAKE_FROM_UPDATE",function(t){if(e.app.mediator){var n=[];let s=[];t&&t.forEach(function(t){if(t&&"remove"!=t.actionMode){let n=t.details["ds6w:label"];if(t.details.asNeededActualValue){let i=t.details.quantity&&"0"!=parseInt(t.details.quantity)?`, ${t.details.quantity} ${t.details.quantityUOMNLS}`:"";n+=` (${e.app.core.i18nManager.get("makeFromAsRequired")}${i})`}else t.details.quantity&&t.details.quantityUOMNLS&&(n+=` (${t.details.quantity} ${t.details.quantityUOMNLS})`);s.push(n)}});var r={physicalid:t[0]&&t[0].details.parentId,attributes:[{name:"MadeFrom",value:s.length>0?s.join(", "):" "}]};n.push(r);var o={references:n,dataIndex:"MadeFrom"};e.app.mediator.publish(i.EVENT_MODIFIED_REFERENCES,o)}}),s.subscribe(i.EVENT_REMOVE_CUT_INSTANCES,function(t){Array.isArray(t)&&e.app.core.contextManager.getContext().refresh({action:"unparent",instances:t})}),s.subscribe("FolderEditor.ActiveFolder",function(e){if(e&&e.origin===widget.id){let t=document.querySelector("#"+i.SET_WORKUNDER_BOOKMARK_CMD);e.id?t.addClassName("xeng-app-bookmark-icon"):t.removeClassName("xeng-app-bookmark-icon")}}),s.subscribe(i.EVENT_TOGGLE_DEACTIVE_SE+i.XENGINEER_APP_AUTHKEY,function(){e.app.core.localStorage.setItem(i.KEY_TOGGLE_WORK_UNDER_EVOLUTION,!1),e.app.core.localStorage.removeItem(i.KEY_TOGGLE_WORK_UNDER_CHANGE)}),s.subscribe(i.EVENT_TOGGLE_DEACTIVE_CA+i.XENGINEER_APP_AUTHKEY,function(){e.app.core.localStorage.setItem(i.KEY_TOGGLE_WORK_UNDER_CHANGE,!1),e.app.core.localStorage.removeItem(i.KEY_TOGGLE_WORK_UNDER_EVOLUTION)}),s.subscribe(i.EVENT_TOGGLE_ACTIVE_SE+i.XENGINEER_APP_AUTHKEY,function(){e.app.core.localStorage.setItem(i.KEY_TOGGLE_WORK_UNDER_EVOLUTION,!0),e.app.core.localStorage.removeItem(i.KEY_TOGGLE_WORK_UNDER_CHANGE)}),s.subscribe(i.EVENT_TOGGLE_ACTIVE_CA+i.XENGINEER_APP_AUTHKEY,function(){e.app.core.localStorage.setItem(i.KEY_TOGGLE_WORK_UNDER_CHANGE,!0),e.app.core.localStorage.removeItem(i.KEY_TOGGLE_WORK_UNDER_EVOLUTION)}),s.subscribe(i.EVENT_SESSION_EFF,function(t){e.app.core.localStorage.setItem(i.KEY_WORK_UNDER_DATA,t),e.app.core.localStorage.setItem(i.KEY_TOGGLE_WORK_UNDER_EVOLUTION,!0)}),s.subscribe(i.EVENT_REMOVE_AUTH_CTX_SESSION+i.XENGINEER_APP_AUTHKEY,function(){e.app.core.localStorage.removeItem(i.KEY_WORK_UNDER_DATA),e.app.core.localStorage.removeItem(i.KEY_TOGGLE_WORK_UNDER_EVOLUTION),e.app.core.localStorage.removeItem(i.KEY_TOGGLE_WORK_UNDER_CHANGE)}),s.subscribe(i.XENGINEER_APP_AUTHKEY,function(t){e.app.core.localStorage.setItem(i.KEY_WORK_UNDER_DATA,t),e.app.core.localStorage.setItem(i.KEY_TOGGLE_WORK_UNDER_CHANGE,!0)}),s.subscribe(i.EVENT_REMOVE_AUTH_CTX+i.XENGINEER_APP_AUTHKEY,function(){e.app.core.localStorage.removeItem(i.KEY_WORK_UNDER_DATA),e.app.core.localStorage.removeItem(i.KEY_TOGGLE_WORK_UNDER_CHANGE),e.app.core.localStorage.removeItem(i.KEY_TOGGLE_WORK_UNDER_EVOLUTION)});e.app.mediator.subscribe(i.EVENT_TRIPTYCH_PANEL_VISIBLE,function(t){"right"===t&&(e.app.core.isPropertyPanelVisibilty=!0,e.app.editPropertyCmp||e.app.mediator.publish(i.EVENT_SHOW_PROPERTIES,{nodes:[]}))}),e.app.mediator.subscribe(i.EVENT_TRIPTYCH_PANEL_HIDDEN,function(t){"right"===t&&(e.app.core.isPropertyPanelVisibilty=!1)}),e.app.mediator.subscribe(i.EVENT_SHOW_PROPERTIES,function(t){let n=t.nodes;var r=!1;n&&Array.isArray(n)&&n.forEach(function(e){!0===e.readOnly&&(r=!0)}),e.app.editPropertyCmp?e.app.editPropertyCmp.setState(n,t.facet):e.app.componentsMgt.startInstances([{name:i.PROPERTY_CMP,container:e.triptychCmp.rightDiv,contextData:{items:n}}]).then(function(t){e.app.editPropertyCmp=t[0]}),e.app.editPropertyCmp.setReadonlyStatus(r)}),e.app.mediator.subscribe(i.EVENT_WELCOME_PANEL_ACTION_SELECTED,function(t){if(t.id===i.WP_ADD_ENG_ITEM_ACTION){let t=e.app.core.PreferencesManager.isUserSelectedTypeChooserOption()?i.CREATE_NEW_CONTENT:i.CREATE_NEW_ENG_ITEM;e.app.mediator.publish(i.EVENT_RESET_SELECTION),e.app.mediator.publish(i.EVENT_LAUNCH_COMMAND,{commandId:t})}else t.id===i.WP_MY_ENG_ITEMS_ACTION?e.app.router.navigate("myEngItems",{},{replace:!1,reload:!1}):t.id===i.WP_RECENTS_ITEMS_ACTION?e.app.router.navigate("recents_items",{},{replace:!1,reload:!1}):t.id===i.WP_IMPORT_ENG_ITEM_ACTION?(e.app.mediator.publish(i.EVENT_RESET_SELECTION),e.app.mediator.publish(i.EVENT_LAUNCH_COMMAND,{commandId:i.IMPORT_ITEMS_CMD})):t.id===i.WP_OPEN_ENG_ITEM_ACTION?(e.app.mediator.publish(i.EVENT_RESET_SELECTION),e.app.mediator.publish(i.EVENT_LAUNCH_COMMAND,{commandId:i.OPEN_ENG_ITEM,context:{item:{searchForOpen:!0}}})):t.id===i.WP_ADD_NEW_PART_ACTION&&(e.app.mediator.publish(i.EVENT_RESET_SELECTION),e.app.mediator.publish(i.EVENT_LAUNCH_COMMAND,{commandId:i.CREATE_NEW_PART}))});e.createdItemsToken=e.app.mediator.subscribe(i.EVENT_NEW_ENG_ITEM_CREATED,function(t){e.app.mediator.publish(i.EVENT_LAUNCH_COMMAND,{commandId:i.OPEN_ENG_ITEM,context:{item:{objectId:t.physicalid,objectType:t.type}}})}),e.goBackToken=e.app.mediator.subscribe(i.EVENT_GO_BACK,function(){e.app.mediator.publish(i.EVENT_FIND_IN_CONTEXT_CLOSE_DIALOG),e.app.core.contextManager.setPreExpandEvent(!1);var t=e.popPreviousState();t?e.app.router.navigate(t.name,t.params,{replace:!1,reload:!0}):e.app.router.navigate("recents_items",{},{replace:!1,reload:!0})}),e.deletedItemsToken=e.app.mediator.subscribe(i.EVENT_DELETED_ENG_ITEM,function(t){var n=e.app.router.getState()||{};"engItem_View"===n.name&&t.ids.indexOf(n.params.pid)>-1&&e.app.mediator.publish(i.EVENT_GO_BACK)}),e.openItemWithCompassToken=e.app.mediator.subscribe(i.EVENT_OPEN_ITEM_WITH_COMPASS,function(t){e.app.core.contextManager.setPreExpandEvent(!1),e.app.core.Factories.ListItemFactory.openItemWithCompass(t)}),e.refreshToken=e.app.mediator.subscribe(i.EVENT_REFRESH_APP_CONTENT,function(t){e.app.core.contextManager.setPreExpandEvent(!1);var n=e.app.router.getState();n=n||{},"forceIndex"===e.app.core.sessionManager.determineCurrentModeState()&&(e.app.core.sessionManager.setAuthoringMode("index"),o.notifyAlert(e.app.core.i18nManager.get("force_index_mode"))),console.log("refreshing the view"),widget.data.appId="ENXENG_AP";var i=e.getRouteManager(n.name);e.app.core.PersistencyManager.setWidgetRefreshStatus(!0),(i=i||{})._isRefreshing=!0,i.deactivate(),i.activate(n),e.app.core.PersistencyManager.setWidgetRefreshStatus(!1),delete i._isRefreshing}),e.resizeTriptychToken=e.app.mediator.subscribe(i.EVENT_TRIPTYCH_RESIZE,function(t){"engItem_View"!==(e.app.router.getState()||{}).name&&(t<550?e.app.mediator.publish(i.EVENT_TRIPTYCH_HIDE_PANEL,"left"):e.app.mediator.publish(i.EVENT_TRIPTYCH_SHOW_PANEL,"left"))})},c.prototype.getRouteManager=function(e){return this.app.router.routerMethods[e]},c.prototype.addRouteManager=function(e,t){if(this.app.router.routerMethods[e])throw new Error("route manager is already defined");if(e.indexOf(" ")>=0)throw new Error("route name shouldn't contain spaces");if(!t)throw new Error("route manager is mandatory");if("function"!=typeof t.activate||"function"!=typeof t.deactivate)throw new Error("all mandatory methods are not define on this route "+e);this.app.router.routerMethods[e]=t},c}),define("DS/ENOXEngineer/ENOXEngineer",["WebappsUtils/WebappsUtils","DS/ENOXEngineerCommonUtils/XENMask","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineerInfra/ENOXEngineerCore","DS/ENOXEngineer/controllers/XEngineerBootstrap","DS/ENOXEngineer/routerConfig/RouterConfig","DS/LifecycleServices/LifecycleServicesSettings","DS/ENOXEngineer/utils/XEngineerConstants","DS/PlatformAPI/PlatformAPI","DS/ENOXEngineer/services/XEngLocalStorage","DS/ENOXEngineer/services/PreferencesManager","DS/ENOXEngineerExternalLibs/ENOXEngineerProfills","css!DS/ENOXEngineer/styles/ENOXEngineerApp.css"],(e,t,n,i,r,o,s,a,l,c,d)=>{"use strict";return{onLoad(){widget.body.empty(),t.mask(widget.body),i({debug:"1"===widget.getValue("debug_me"),eagerComponentsLoading:!0,extensionsFolder:"DS/ENOXEngineer/services/",componentsRepository:"DS/ENOXEngineer/assets/config/componentsDef.json"}).use("EngineeringSettings").use("EngineeringDataProvider").use("XENDicoService").use("I18nManager").use("PreferencesManager").use("ViewsService").use("XENUserSessionManager").use("SessionPredicatesService").use("XENCollectionsFactory").use("XEngineerItemsFactory").use("XEngContextManager").use("CommandsService").use("ConfigItemsFactory").use("ColumnsMgtService").use("PersistencyManager").use("ExportService").use("OpenWithService").useRouter5({config:o,applicationController:r}).start().then(e=>{widget.appMediator=e.mediator,e.logger.info(`#### xEngineer started in ${e.getStartupTime()}ms !`),e.core.i18nManager.warmupNLS().then(()=>{e.core.mediator.publish(a.EVENT_ATTR_DICO_UPDATED)});const t=()=>{const t=widget.getValue("routerState")?widget.getValue("routerState"):{};e.mediator.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.UPDATE_WIDGET_TITLE,context:{label:null}}),t.current_State?("engItem_View"===t.current_State.name&&(e.core.isReloadedState=!0),e.router.start(t.current_State)):e.router.start("recents_items",{replace:!1})};e.core.settingManager.isSetValidSelectionForOpen().then(n=>{n?(t=>{if(t&&t.objectId&&t.objectId.trim().length>0){const n=e.router.buildState("engItem_View",{pid:t.objectId});e.router.start(e.router.buildPath(n.name,n.params))}})(n):t()}).catch(i=>{e.logger.info(i),n.warningNotif({title:e.core.i18nManager.get("warning.selection.ignored"),subtitle:i&&i.message?i.message:e.core.i18nManager.get("app.failure")}),t()}),l.subscribe(a.EVENT_REFRESH_WIDGETS,()=>{widget.appMediator.publish(a.EVENT_REFRESH_APP_CONTENT)}),l.subscribe(a.EVENT_CLEAR_WIDGETS_CLIPBOARD,()=>{c.removeItem("clipboard")}),e.core.settingManager.reApplyWorkUnder()});try{require(["DS/MSFDocumentManagement/WidgetIntegration"],e=>{widget.MSFDocumentClient=e,widget.MSFDocumentClient.ConnectWidgetWithMSF()})}catch(e){console.error(e)}},onStop(){},onRefresh(){widget.appMediator.publish(a.EVENT_REFRESH_APP_CONTENT),widget.appMediator.publish(a.EVENT_FIND_IN_CONTEXT_CLOSE_DIALOG),l.publish(a.EVENT_CLEAR_WIDGETS_CLIPBOARD)},endEdit(){d.catchUserPreference()},onSearch(e){widget.appMediator.publish("enox-collection-toolbar-filter-search-value",{searchValue:[e]})},onResetSearch(){widget.appMediator.publish("enox-collection-toolbar-filter-search-value",{searchValue:[]})}}}),define("DS/ENOXEngineer/utils/QuantityHelper/EngItemRollupQuantity",["DS/ENOXEngineer/utils/QuantityHelper/EngItemModelMassOrVolumeQuantityHelper","DS/ENOXEngineer/utils/QuantityHelper/EngItemModelRawQuantityHelper","DS/ENOXEngineer/utils/QuantityHelper/QuantityHelperUtils","DS/ENOXEngineer/utils/Utils"],(e,t,n,i)=>{const{isAValidValue:r,asNumber:o}=n,s=(e,t)=>{let n=e;if(r(t)){const r=o(t);n=i.sum([e,r])}return n},a=({volume:e,mass:t,area:n,length:i})=>({newVolume:e,newMass:t,newArea:n,newLength:i,mapResultsInto(e){e.volume=this.newVolume,e.mass=this.newMass,e.area=this.newArea,e.length=this.newLength}});return class{constructor(e,t){this.model=e,this.preferenceManager=t.PreferencesManager,this.i18nManager=t.i18nManager}getRollup(){let e="";return this.isCoreMaterialType?e=this.computeRollupForMassOrVolumeMaterial():this.isRawMaterialType?e=this.computeRollupForRawMaterial():this.isEngineeringItem&&(e=this.computeRollupForEngItem()),e}get isCoreMaterialType(){return this.model.isCoreMaterialType()}get isRawMaterialType(){return this.model.isRawMaterialType()}get isEngineeringItem(){return this.model.isEngineeringItem()}get nlsVolumeUnit(){return this.preferenceManager.getNLSValueForVolumeQuantity()}get nlsMassUnit(){return this.preferenceManager.getNLSValueForMassQuantity()}get nlsAreaUnit(){return this.preferenceManager.getNLSValueForAreaQuantity()}get nlsLengthUnit(){return this.preferenceManager.getNLSValueForLengthQuantity()}get nlsMakeFromAsRequired(){return this.i18nManager.get("makeFromAsRequired")}get usages(){const e="function"==typeof this.model.getUsages?this.model.getUsages():[];return Array.isArray(e)?e:[]}computeRollupForMassOrVolumeMaterial(){const e=this.computeRollupQuantityForMassOrVolumeMaterial();return this.buildRollupStatusForMassOrVolumeMaterial(e)}computeRollupQuantityForMassOrVolumeMaterial(){const t={volume:0,mass:0};return this.usages.forEach(n=>{const i=new e(n);if(i.hasVolumeQuantity()){const e=i.getVolumeQuantity();t.volume=s(t.volume,e)}if(i.hasMassQuantity()){const e=i.getMassQuantity();t.mass=s(t.mass,e)}}),t}buildRollupStatusForMassOrVolumeMaterial(e){const t=this.nlsVolumeUnit,n=this.nlsMassUnit;let i="";return e.mass&&e.volume?i=`${e.mass} ${n} + ${e.volume} ${t}`:e.mass?i=`${e.mass} ${n}`:e.volume&&(i=`${e.volume} ${t}`),i}computeRollupForRawMaterial(){const e=this.computeRollupQuantityForRawMaterial();return this.buildStatusForRawMaterial(e)}computeRollupQuantityForRawMaterial(){const e={volume:0,mass:0,area:0,length:0};return this.hasConvertedValue()?this.sumRawQuantityValuesForItem(this.model,{volume:e.volume,mass:e.mass,area:e.area,length:e.length}).mapResultsInto(e):this.sumRawQuantityValuesForUsages(this.usages,{volume:e.volume,mass:e.mass,area:e.area,length:e.length}).mapResultsInto(e),e}buildStatusForRawMaterial(e){const t=this.nlsVolumeUnit,n=this.nlsMassUnit,i=this.nlsAreaUnit,r=this.nlsLengthUnit;let o="";return e.mass?o=`${e.mass} ${n}`:e.volume?o=`${e.volume} ${t}`:e.area?o=`${e.area} ${i}`:e.length&&(o=`${e.length} ${r}`),this.hasRequiredFlag()&&(o=this.addRequiredFlagToRollup(o)),o}sumRawQuantityValuesForItem(e,n){const{volume:i,mass:r,area:o,length:l}=n,c=new t(e);let{volume:d,mass:u,area:p,length:g}=n;if(c.hasRawMatVolumeQuantity()){const e=c.getRawMatVolumeQuantity();d=s(i,e)}if(c.hasRawMatMassQuantity()){const e=c.getRawMatMassQuantity();u=s(r,e)}if(c.hasRawMatAreaQuantity()){const e=c.getRawMatAreaQuantity();p=s(o,e)}if(c.hasRawMatLengthQuantity()){const e=c.getRawMatLengthQuantity();g=s(l,e)}return a({volume:d,mass:u,area:p,length:g})}sumRawQuantityValuesForUsages(e,t){const n={volume:t.volume,mass:t.mass,area:t.area,length:t.length};return e.forEach(e=>{this.sumRawQuantityValuesForItem(e,{volume:n.volume,mass:n.mass,area:n.area,length:n.length}).mapResultsInto(n)}),a({volume:n.volume,mass:n.mass,area:n.area,length:n.length})}hasRequiredFlag(){return!!this.usages.find(e=>new t(e).hasRawMatAsRequired())}hasConvertedValue(){return!!new t(this.model).hasConvertedValue()}addRequiredFlagToRollup(e){const t=this.nlsMakeFromAsRequired;return r(e)?`${e}, ${t}`:`${t}`}computeRollupForEngItem(){const e=this.usages.length;return r(e)?`${e}`:""}}}),define("DS/ENOXEngineer/models/EngItemModel",["DS/TreeModel/TreeNodeModel","UWA/Core","UWA/Class/Promise","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/PreferredUnitColumnProviderInputFactory","DS/ENOXEngineer/utils/QuantityHelper/EngItemModelMassOrVolumeQuantityHelper","DS/ENOXEngineer/utils/QuantityHelper/EngItemModelRawQuantityHelper","DS/ENOXEngineer/utils/QuantityHelper/EngItemRollupQuantity","DS/ENOXEngineer/utils/EngItemModelAttributesHelper"],function(e,t,n,i,r,o,s,a,l,c,d,u){"use strict";function p(n){this._parentNode={_nodeDepth:1},this.pathElement={externalPath:[]},this.showModelVersionChooser=!0,this.options={contextualMenu:[null],_relatedContent:null,_transientFilter:null,emptyStatusbarVisibleFlag:!0,_attributesAreConvertedToPreferred:!1,_isAttributeConvertionStarted:!1,type:"",color:"",isCut:!1,shading:null,referenceId:"",quantity:1,models:[],preferedModel:null,attributes:[],custtomAttributes:[],thumbnail:"",useAsyncPreExpand:!0,viewType:"reference",instances:[],filteringContext:{isFilterOutByTagger:!1,isFilterOutBySearch:!1},isLastVersion:null},this.options=t.extend(this.options,n),e.call(this,this.options),this.options.i18nManager=this.options.appCore?this.options.appCore.i18nManager:null,this.options.getAttributeValueForFiltering=(e=>{switch(e){case"rollup":return this.getRollUpMaterials();case"ds6w:reserved":case"ds6w:reserved-Instance":return this.getLockDataForFilter(e);case"label":return this.options.label;default:return this.getAttributeCellValue(e)}})}return p.prototype=Object.create(e.prototype),p.prototype.getType=function(){return this.options.type},p.prototype.isAttributeConvertionStarted=function(){return this.options._isAttributeConvertionStarted},p.prototype.setAttributeConvertionStarted=function(e){this.options._isAttributeConvertionStarted=e},p.prototype.isRealAttributesConverted=function(){return this.options._attributesAreConvertedToPreferred},p.prototype.setRealAttributesConvertState=function(e){this.options._attributesAreConvertedToPreferred=e},p.prototype.getIcons=function(){return[]},p.prototype.getRichIcons=function(){return this.options.icons},p.prototype.getTypeIcon=function(){var e=this.getRichIcons(),t="";return this._isFromOriginalModel()&&(t="picture"),e&&Array.isArray(e)&&e.length>0&&(t={iconPath:e[0],iconSize:{width:"16px",height:"16px"}}),t},p.prototype.completePath=function(e){return Array.isArray(e)?(e.push(this.getID()),e):[this.getID()]},p.prototype.getTypeName=function(){return this.options.grid["ds6w:type"]},p.prototype.getParentIdFromOccrencePath=function(){var e=this.getOccurrencePath();let t=null;return Array.isArray(e)&&e.length>2&&(t=e[e.length-3]),t},p.prototype.getParentOccurrencePath=function(){const e=this.getOccurrencePath();let t=null;return Array.isArray(e)&&e.length>2&&(t=e.slice(0,e.length-2)),t},p.prototype.getIdForEditProperty=function(){return this.options.appCore.Factories.ListItemFactory.isInstanceOfListNodeModel(this)?this.getRelationID():this.getID()},p.prototype.getRealParent=function(){var e=this,t=this.options.appCore.contextManager.getActiveEngItem();if(null!==t)var n=t.getContentModels().getChildrenWithoutGroupingNodes().some(function(t){return t.getID()==e.getID()});return n?t:this._parentNode},p.prototype._groupChild=function(e,t,n){if(n&&0!==n.length){var i;null!=(i=t.getNodeGroupingKey?t.getNodeGroupingKey(e,n[0]):e.getAttributeValue(n[0]))&&""!==i&&"NULL"!==i||(i="NA");var r=this._getFakeNodesTable(),o=r[i];o||(o=this.options.appCore.Factories.ListItemFactory.buildGroupNode({property:n[0],identifier:i,firstmember:e,fakeNodesTable:{},originalChildrenInformation:{childrenCount:0,notHiddenNotFilteredChildrenCount:0}}),r[i]=o,this.addChild(o)),o.isHidden()&&o.show(),n.shift(),o._groupChild(e,n)}else e.getParent()!==this&&this.moveChild(e)},p.prototype.attachContentModels=function(e){if(!this.options.appCore.Factories.CollectionsFactory.isInstanceContentModels(e))throw console.warn(" attachContentModel function expect a valid EngItemContentTreeDocument parameter"),new Error(" attachContentModel function expect a validEngItemContentTreeDocument parameter");this.options._relatedContent=e},p.prototype.getContentModels=function(){return this.options._relatedContent},p.prototype.isValidEngItem=function(){return this.options.appCore.dicoService.areEngeeringItems([this.getType()])},p.prototype.retrieveBIs=function(e){var t=this;return i.wrappedWithPromise(function(n,i){if(t.options._BIs&&t.options.level==e)return n(t.options._BIs);t.options.appCore.dataService.multiexpandBI(t.getID(),e).then(function(i){t.options._BIs=i,t.options.level=e,n(i)}).catch(function(e){t.options._BIs=null,t.options.level="1",n(null)})})},p.prototype.isValidForExpandLevel=function(e){var t=this;return i.wrappedWithPromise(function(n,i){t.retrieveBIs(e).then(function(){if(t.options._BIs){var e=t.options.appCore.settingManager.getSetting("BIsKey"),r=t.options.appCore.commandManager.isExportWithNoLimit();for(var o in t.options._BIs)if(t.options._BIs[o].sixw===e.type&&"VPMInstance"==t.options._BIs[o].object)return t.options._BIs[o].count>s.DATA_LIMIT_FOR_FINAL&&!r?i():n(!0);n(!0)}else n(!0)}).catch(function(e){i(e)})})},p.prototype.getPartNumber=function(){return this.options.grid["ds6wg:EnterpriseExtension.V_PartNumber"]},p.prototype.getEngineeringMenu=function(e){return"my_engItem"===e?this.options.appCore.commandManager.getMenu("standaloneReference"):"eng_item_view"===e?this.options.appCore.sessionManager.shouldShowFinalItems()||this.options.appCore.sessionManager.shouldShowMfgView()||this.options.appCore.sessionManager.shouldShowLeafMaterials()||this.options.appCore.sessionManager.shouldShowFlatView()?this.options.appCore.commandManager.getMenu("occurrence"):this.options.appCore.sessionManager.shouldShowQuantityView()?this.options.appCore.commandManager.getMenu("usedReference"):this.options.appCore.commandManager.getMenu("instance"):void 0},p.prototype.getCreatedDate=function(){return r.getformatedDate(this.options.grid["ds6w:created"])},p.prototype.getModifedDate=function(){return r.getformatedDate(this.options.grid["ds6w:modified"])},p.prototype.getDescription=function(){return this.options.grid["ds6w:description"]},p.prototype.setColor=function(e){this.updateOptions({color:e})},p.prototype.addInstance=function(e){this.options.instances.push(e)},p.prototype.setInstances=function(e){this.options.instances=e},p.prototype.getInstances=function(){return this.options.instances},p.prototype.refreshByModel=function(e,t,n){var i=this.options.appCore.Factories.ListItemFactory.extractOptionsFromNode(e,n);i&&(this.updateOptions(i),this.setRealAttributesConvertState(!1),this.setAttributeConvertionStarted(!1),t&&(e.destroy(),e=null))},p.prototype.syncModel=function(){var e=this;return new n(function(t,n){e.options.appCore.dataService.getEngItemData(e.getID()).then(function(n){e.refreshByModel(n[0],!0),t(!0)}).catch(function(e){n(e)})})},p.prototype.getRelatedDocument=function(e){var t=this.getID();return this.options.appCore.dataService.getEngItemRelatedDocuments(t,e)},p.prototype.getRootType=function(){return this.options.appCore.dicoService.getRootTypes([this.getType()])},p.prototype.getMetaType=function(){return i.wrappedWithPromise(function(e,t){return e("businessobject")})},p.prototype.launchFilteringCommand=function(){this.hasValidTransientNextGenFilter()||this.hasPesistencyManagerdNGFilter()?this.options.appCore.mediator.publish(s.EVENT_LAUNCH_COMMAND,{commandId:s.LAUNCH_NG_FILTER_CMD,context:{}}):this.isConfigured()&&this.options.appCore.mediator.publish(s.EVENT_LAUNCH_COMMAND,{commandId:s.SET_PROD_CONF_CMD,context:{item:this}})},p.prototype.setPersistedNGFilterContext=function(e,t){if(e){this.options._NGFilterId=e.filterId,this.options._NGFilterName=e.filter.filterTitle,delete e.filter.CVQuery3D,this.options._persistedFilter=e.filter,("boolean"!=typeof t||t)&&this.options.appCore.PreferencesManager.saveEngItemOpenPreferences(this)}},p.prototype.detachPersistedFilter=function(){(this.options._NGFilterId||this.options._NGFilterName)&&(this.options._NGFilterId=void 0,this.options._NGFilterName=void 0,this.options._persistedFilter=void 0,this.options.appCore.PreferencesManager.saveEngItemOpenPreferences(this))},p.prototype.hasPreferredNGFilterId=function(){return this.getPreferredNGFilter()},p.prototype.hasPesistencyManagerdNGFilter=function(){const e=this.options.appCore.PersistencyManager.getNGFilter();return e&&e.filterId&&e.filterName?e:null},p.prototype.getPreferredNGFilter=function(){var e=this.options.appCore.PreferencesManager.getEngItemOpenPreferences(this.getID());return e&&e.filterId&&e.filterName?e:null},p.prototype.getPersistedNGFilterContext=function(){return this.options._persistedFilter},p.prototype.hasValidPersistedNextGenFilter=function(){return!(!this.getNGFilterId()||!this.getNGFilterName())},p.prototype.getNGFilterId=function(){return this.options._NGFilterId},p.prototype.getNGFilterName=function(){return this.options._NGFilterName?this.options._NGFilterName:null},p.prototype.setTransientGroupingContext=function(e){this.options._transientGroup=e},p.prototype.getTransientGroupingContext=function(){return this.options._transientGroup},p.prototype.hasValidTransientGroupingContext=function(){return!!this.options._transientGroup},p.prototype.removeTransientGroupingContext=function(){delete this.options._transientGroup},p.prototype.setTransientNGFilteringContext=function(e){this.options._transientFilter=e,this.options._NGFilterName=e?e.filterTitle||this.options.i18nManager.get("transient.filter"):null},p.prototype.getTransientNGFilteringContext=function(){return this.hasValidTransientNextGenFilter()?this.options._transientFilter:null},p.prototype.hasValidTransientNextGenFilter=function(){var e=this.options._transientFilter;if(!e)return!1;const{CVQuery:t,CVQueryV2:n}=e;return!(!t||!t.union)||!!n},p.prototype.getNextGenFilterExpandOptions=function(){return this.hasValidTransientNextGenFilter()?this.getTransientNGFilteringContext():this.getPersistedNGFilterContext()},p.prototype.nextGenFilterMultiExpand=function(e){var t=this,n=!1,r=this.getNextGenFilterExpandOptions(),o=i.wrappedWithCancellablePromise(function(i,o){if(r){const s=t.options.appCore.dicoService.getTagsForBOWithMandatories(),a=t.options.appCore.dicoService.getTagsForRelWithMandatories(),l=t.options.appCore.dataService.buildMultiExpandGenericOption2({select_bo:s,select_rel:a,parameters:r});t.options.appCore.dataService.multiExpand(l,e).then(function(e){if(n)return i([]);i(e)}).catch(function(e){if(n)return i([]);console.error(e),o(e)})}else o(new Error("invalid filtering context"))});return o.cancelEmbeddedRequest=function(){n=!0},o},p.prototype.getQualifiedAsFinalChildren=function(e){var t=this,n=!1,r=i.wrappedWithCancellablePromise(function(i,r){t.options.appCore.exportService.expandForQualifiedAsFinal(t.getID(),e).then(function(e){if(n)return i([]);i(e)}).catch(function(e){if(n)return i([]);console.error(e),r(e)})});return r.cancelEmbeddedRequest=function(){n=!0},r},p.prototype.retrieveFilteringBinary=function(){var e=this;return new n(function(t,n){if(!e.isConfigured()||!e.hasValidConfigContext())return t(null);e.options.appCore.dataService.createVolatileFilter(e).then(function(e){t({FilterCompiledForm:e?e.filterBinaryForExpand:null})}).catch(function(e){n(e)})})},p.prototype.getID=function(){return this.options.referenceId},p.prototype.getUuid=function(){return this.getID()},p.prototype.getReferenceVersion=function(){return this.options.grid["ds6wg:revision"]},p.prototype.isLastVersion=function(){return!this.options.isLastVersion||"true"==this.options.isLastVersion.toLowerCase()},p.prototype.isConfigured=function(){return!!(Array.isArray(this.getAttachedConfigModels())&&this.getAttachedConfigModels().length>0)},p.prototype.hasValidConfigContext=function(){return!!(this.getPreferedAttachedConfigModel()&&this.getPreferedAttachedConfigModel().getModelVersion()&&this.getPreferedAttachedConfigModel().getModelVersion().id)},p.prototype.shouldAcceptConfiguration=function(){return this.options.appCore.settingManager.isConfigAuthorized()},p.prototype.getContextDisplayType=function(){return this.options.appCore.settingManager.isConfigAuthorized()?"type-hyperlink":"type-text"},p.prototype.getPreferedAttachedConfigModel=function(){return this.options.preferedModel},p.prototype.attachPreferedConfigModel=function(e){this.options.preferedModel=e,e&&e.setRelatedEngItem&&e.setRelatedEngItem(this)},p.prototype.updateUserConfigPreferences=function(){return this.options.appCore.PreferencesManager.saveEngItemOpenPreferences(this)},p.prototype.attachConfigModels=function(e){this.options.models=e},p.prototype.getAttachedConfigModels=function(){return this.options.models},p.prototype.hasModelVersion=function(){var e,t=this,n=[];return i.wrappedWithPromise(function(r,s){if(!t.isConfigured())return r();t.isConfigured()&&t.getAttachedConfigModels().forEach(function(t){n.push(t.VersionsLoaderWrapper().then(function(){var n=t.getModelVersion();e||(e=!!n)}))}),i.allSettled(n).then(function(){e?r(e):(o.errorAlert(t.options.appCore.i18nManager.get("error.noVersion.relatedToModel")),r())})})},p.prototype.getAllAvailableVersionsPromises=function(){if(!Array.isArray(this.getAttachedConfigModels()))return[];var e=[];return this.getAttachedConfigModels().forEach(function(t){e.push(t.getListOfVersionsPromise())}),e},p.prototype.unMatch=function(e){if(!e)return!1;var t=e.toLowerCase(),n=this.options.appCore.dicoService.getVisibleAttributes();if(Array.isArray(n))for(var i=0;i<n.length;i++){var r=n[i].dataIndex?n[i].dataIndex:n[i].ds6w;if((this.getGridValueForaKey(r)||"").toLowerCase().includes(t)||(this.getLabel()||"").toLowerCase().includes(t))return!1}var o=!0;return(this.getAttributes()||[]).forEach(function(e){e.value.toLowerCase().includes(t)&&(o=!1)}),o},p.prototype.applyFilters=function(){this.shouldBeVisible()?this.show():this.hide()},p.prototype.shouldBeVisible=function(e){return!this.isHiddenBySearch()&&!this.isHiddenByTagger()},p.prototype.isHiddenByTagger=function(){return this.options.filteringContext.isFilterOutByTagger},p.prototype.isHiddenBySearch=function(){return this.options.filteringContext.isFilterOutBySearch},p.prototype.setTaggerFilterState=function(e){this.options.filteringContext.isFilterOutByTagger=e},p.prototype.setSearchFilterState=function(e){this.options.filteringContext.isFilterOutBySearch=e},p.prototype.hasStaticMapping=function(){return!1},p.prototype.setPreferredModelById=function(e){if(e&&Array.isArray(this.getAttachedConfigModels())){var t=this.getAttachedConfigModels().find(function(t){return t.getID()===e});t&&this.attachPreferedConfigModel(t,!1)}},p.prototype._syncWithAttachedModel=function(){return this._syncWithAttachedModelAndVersion(null)},p.prototype._syncWithAttachedModelAndVersion=function(e){var t=this;return this.options.configInitPromise=new n(function(n,i){if(!t.getID())return i("not valid Object");var r=t.getID(),o={pid:r};t.options.appCore.dataService.getEngItemConfigurationInfo(o).then(function(i){if(i.length>0){if(t.attachConfigModels(i),t.options.appCore.PreferencesManager.getEngItemOpenPreferences(r)&&!t.getPreferedAttachedConfigModel()){var o=t.options.appCore.PreferencesManager.getEngItemOpenPreferences(r);o.noModel&&(t.showModelVersionChooser=!1);for(var s=0;s<i.length;s++)if(i[s].getID()===o.model){t.attachPreferedConfigModel(i[s]);break}}t.getPreferedAttachedConfigModel()&&t.getPreferedAttachedConfigModel()._synchronizeModelVersions?t.getPreferedAttachedConfigModel()._synchronizeModelVersions(e)&&t.getPreferedAttachedConfigModel()._synchronizeModelVersions(e).finally(function(){n(!0)}):n(!0)}else t.attachConfigModels([]),t.attachPreferedConfigModel(null),n(!0)}).catch(function(e){console.log(e),t.attachConfigModels([]),t.attachPreferedConfigModel(null),i(e)})}),this.options.configInitPromise},p.prototype.getConfigInitPromise=function(){return this.options.configInitPromise?this.options.configInitPromise:this._syncWithAttachedModel()},p.prototype.getTypeForVersionGraph=function(){return this.isConfigured()?"Model":this.getType()},p.prototype.getIdForVersionGraph=function(){return this.isConfigured()&&this.getPreferedAttachedConfigModel()?this.getPreferedAttachedConfigModel().getPreferredVersion()?this.getPreferedAttachedConfigModel().getCurrentVersionID():null:this.getID()},p.prototype.getVersionOfModelVersion=function(){return this.isConfigured()&&(this.hasValidTransientNextGenFilter()||this.hasValidPersistedNextGenFilter())?null:this.isConfigured()&&this.getPreferedAttachedConfigModel()&&this.getPreferedAttachedConfigModel().getPreferredVersion()?this.getPreferedAttachedConfigModel().getCurrentVersionRevision():null},p.prototype.getReferenceVersionForIDCard=function(){return this.isConfigured()&&this.getPreferedAttachedConfigModel()||this.isConfigured()&&(this.hasValidTransientNextGenFilter()||this.hasValidPersistedNextGenFilter())?null:this.getReferenceVersion()},p.prototype.getTitleForIdcard=function(){return this.getLabel()},p.prototype.getTitle=function(){return this.getLabel()},p.prototype.getFilterForIdcard=function(){return this.hasValidTransientNextGenFilter()||this.hasValidPersistedNextGenFilter()?"["+this.getNGFilterName()+"]":null},p.prototype.getConfigurationDisplayName=function(){if(this.isConfigured()&&this.getPreferedAttachedConfigModel()&&!this.getFilterForIdcard()){var e=this.getPreferedAttachedConfigModel().getPreferredConfiguration();return e?e.marketingName:this.options.appCore.i18nManager.get("eng.conf_placeholder")}return null},p.prototype.getModelVersionForIDCard=function(){var e=this.isConfigured()&&this.getPreferedAttachedConfigModel()?this.getPreferedAttachedConfigModel():null;return this.getFilterForIdcard()?null:e?e.getCurrentVersionMarketingName():this.isConfigured()?this.options.appCore.i18nManager.get("eng.model_placeholder"):null},p.prototype.getThumbnail=function(){return this.options.thumbnail},p.prototype.getViewType=function(){return this.options.viewType},p.prototype.toggleSelection=function(){return this.isSelected()?this.unselect():this.select()},p.prototype.getQuantity=function(){return this.getInstances().length},p.prototype.getAttributes=function(){return this.options.attributes},p.prototype.isAttributePending=function(e,n){if(!t.is(e,"string"))return!1;return Array.isArray(n)?-1!==(n.indexOf("#loading#")||n.indexOf("#queued#")):-1!==["#loading#","#queued#"].indexOf(this.getAttributeValue(e))},p.prototype.attributeRemoteLoadingNotStart=function(e){if(!t.is(e,"string"))return!1;var n=this.getAttributeValue(e);return"#queued#"===n||void 0===n},p.prototype.isAttributeLoadFailed=function(e){return"#failed#"===this.getAttributeValue(e)},p.prototype.getSortableAttributeValue=function(e){for(var t=this.getSortableAttributes(),n=0;n<t.length;n++)if(t[n].name===e)return t[n].value},p.prototype.getSortableAttributes=function(){var e=[];return this.options?(e.push({name:"Title",value:this.options.grid["ds6w:label"]}),e.push({name:"Maturity",value:this.options.grid["ds6w:status"]}),e.push({name:"Owner",value:this.options.grid["ds6w:responsible"]}),e.push({name:"CreationDate",value:this.options.grid["ds6w:created"]}),e.push({name:"ModifiedDate",value:this.options.grid["ds6w:modified"]}),e.push({name:"PartNumber",value:this.options.grid["ds6wg:EnterpriseExtension.V_PartNumber"]}),e.push({name:"TreeOrder",value:this.options.grid["ro.plminstance.V_treeorder-Instance"]}),e):(console.error(" you need to call basic method before !"),e)},p.prototype.getDateFormatAttributes=function(){return this.customDateAttrs||(this.customDateAttrs=this.options.appCore.dicoService.getVisibleAttributes()||[],this.customDateAttrs=this.customDateAttrs.filter(function(e){return"date"===e.kind.toLowerCase()}).map(function(e){return e.ds6w})),this.customDateAttrs},p.prototype.getOccurrencePath=function(){return null===this.getUsages()||this.getUsages().length<=0?[this.getID()]:this.getUsages()[0].getOccurrencePath()},p.prototype.buildNodeId=function(){var e=this.getDataPath();return e&&Array.isArray(e)?e.join("/"):null},p.prototype.getDataPath=function(){var e=this.getReferencePath();if(e&&Array.isArray(e))return e;var t=[],n=this.getID();return n&&t.push(n),t},p.prototype.getReferencePath=function(){if(this.isEngineeringItem()){var e=this.getOccurrencePath();if(!e||!Array.isArray(e))return null;for(var t=[],n=0;n<e.length;n+=2)t.push(e[n]);return t}return[this.getID()]},p.prototype.isChildComputed=function(){return this.options.childComputed},p.prototype.childrenToDisplay=function(){return this.options.children},p.prototype.addChildToTheTargetNode=function(e){var t=this;Array.isArray(e)&&e.length>0&&(t.prepareUpdate(),e.forEach(function(e){e.getID()!==t.getID()&&t.addChild(e)}),t.pushUpdate())},p.prototype.getOwner=function(){return this.options.grid["ds6w:responsible"]},p.prototype.getGridValueForaKey=function(e){let t=this.options.grid[e];return null==t||null==t?"":"string"==typeof t||"boolean"==typeof t||"number"==typeof t?t.toString():Array.isArray(t)&&"string"==typeof t[0]?t.join(","):""},p.prototype.getMaturity=function(){return this.options.grid["ds6w:status"]},p.prototype.setMaturity=function(e){e&&e.length>0&&(this.options.grid["ds6w:status"]=e)},p.prototype.getLabel=function(){return this.options.grid["ds6w:label"]},p.prototype.getName=function(){return this.options.grid["ds6w:identifier"]},p.prototype.getDisplayName=function(){const e=void 0!==this.getReferenceVersion()?this.getReferenceVersion():"";return this.getLabel()+" "+e},p.prototype.getShading=function(){return this.options.shading},p.prototype.isCut=function(){return this.options.isCut},p.prototype.getNodesByRelId=function(e){for(var t=[],n=this._getChildInstanceNodes(),i=0;i<n.length;i++)n[i].getRelationID()===e&&t.push(n[i]);return t},p.prototype._getChildInstanceNodes=function(){var e=this,t=[],n=this.getChildren();return n&&Array.isArray(n)&&n.length>0&&(n=e.options.appCore.contextManager.getActiveEngItem().getContentModels()._getNoFakeNodes(n)).forEach(function(n){e.options.appCore.Factories.ListItemFactory.isInstanceOfListNodeModel(n)?t.push(n):t.push(...n.getUsages())}),t},p.prototype.getGlobalType=function(){return this.options.padgrid["ds6w:globalType"]},p.prototype.isSpecificationDocument=function(){return this.getReferenceValue("isSpecificationDocument")},p.prototype.isRepresentation=function(){var e=!1;return"ds6w:Document"===this.getGlobalType()&&(e=!0),e},p.prototype.isDrawing=function(){var e=!1;return"ds6w:Document"===this.getGlobalType()&&"Drawing"===this.getType()&&(e=!0),e},p.prototype.isEngineeringItem=function(){var e=!1;return"ds6w:Part"===this.getGlobalType()&&(e=!0),e},p.prototype.isDocument=function(e){var t=!1;if("ds6w:FileDocument"===this.getGlobalType()&&(t=!0),t&&"string"==typeof e&&e.trim().length)switch(e){case s.SPECIFICATION_DOCUMENT:t=this.isSpecificationDocument()}return t},p.prototype.isCoreMaterialType=function(){return!(!this.options.padgrid||"ds6w:Material"!==this.options.padgrid["ds6w:globalType"])},p.prototype.isRawMaterialType=function(){return!(!this.options.grid||!(this.options.appCore.dicoService.syncIsARawMaterial(this.options.grid.type)||this.options.grid["ds6wg:raw_material.v_dimensiontype-Instance"]||this.options.grid["ds6wg:raw_material.v_dimensiontype"]))},p.prototype.isDirectRawMatConsumption=function(){return new c(this).isDirectRawMatConsumption()},p.prototype.isDeformedObject=function(){return!(!this.options.grid||null==this.options.grid[s.CONST_DEFORMABLE_SEMANTIC_REL_INFO]&&null==this.options.grid[s.CONST_DEFORMABLE_SEMANTIC_REL_INFO])},p.prototype.isDeformableObject=function(){return!(!this.options.grid||null==this.options.grid[s.CONST_DS6W_DEFORMABILITY]&&null==this.options.grid[s.CONST_DS6W_DEFORMABILITY])&&this.options.grid[s.CONST_DS6W_DEFORMABILITY]===this.options.appCore.i18nManager.get("ds6w:deformability/deformable")},p.prototype.getDeformableObjectIDFromDeformed=function(){let e=this.options.grid&&this.options.grid[s.CONST_DEFORMABLE_SEMANTIC_REL_INFO]?this.options.grid[s.CONST_DEFORMABLE_SEMANTIC_REL_INFO]:void 0;if(e&&Array.isArray(e.split(" "))){let t=e.split(" ");if(8==t.length)return t[6]}return null},p.prototype.hasQuantity=function(){return new l(this).hasQuantity()},p.prototype.isMaterialQuantity=function(){var e=(e=>this.options.grid.hasOwnProperty(e)&&this.options.grid[e]&&0!==this.options.grid[e].trim().length)("CoreMaterial"),t=this.hasQuantity(),n=void 0!==this.getCoreMaterials()&&Array.isArray(this.getCoreMaterials())&&this.getCoreMaterials().length>0;return!(!e&&!n||!t)},p.prototype.getTenant=function(){return this.options.tenant},p.prototype.getDisplayedGridViewAttribute=function(){var e=[];e.push("ds6w:status"),e.push("ds6w:responsible"),e.push("ds6wg:EnterpriseExtension.V_PartNumber"),e.push("ds6w:created"),e.push("ds6w:modified"),e.push("ds6w:cadMaster"),e.push("ds6w:description"),e.push(s.CONT_QUANTITY_MASS),e.push(s.CONT_QUANTITY_VOLUME),e.push("ds6w:reservedBy");var t=this,n=[];return e.forEach(function(e){let i=t.options.grid[e];null!=i&&""!==i&&"Warning:JPO"!=i&&n.push(e)}),n},p.prototype.getAllGridViewAttribute=function(){var e=[];e.push("ds6w:label"),e.push("ds6wg:revision"),e.push("ds6w:type"),e.push("ds6w:cadMaster"),e.push("ds6w:status"),e.push("ds6w:responsible"),e.push("ds6wg:EnterpriseExtension.V_PartNumber"),e.push("ds6w:modified"),e.push("ds6w:created"),e.push("ds6w:description"),e.push(s.CONT_QUANTITY_MASS),e.push(s.CONT_QUANTITY_VOLUME),e.push("ds6w:reservedBy");var t=this,n=[];return e.forEach(function(e){let i=t.options.grid[e];null!=i&&""!==i&&"Warning:JPO"!=i&&n.push(e)}),n},p.prototype.setCoreMaterials=function(e){this.options.CoreMaterialNodes=e},p.prototype.getCoreMaterials=function(){return this.options.CoreMaterialNodes},p.prototype.addUsages=function(e){void 0!==this.options.grid.quantity&&Array.isArray(this.options.grid.quantity)?this.options.grid.quantity=this.options.grid.quantity.concat(e):this.setUsages(e)},p.prototype.addParentOccurences=function(e){void 0!==this.options.grid.parentOccurence&&Array.isArray(this.options.grid.parentOccurence)?this.options.grid.parentOccurence=this.options.grid.parentOccurence.concat(e):this.options.grid.parentOccurence=e},p.prototype.getParentOccurences=function(){return null!=this.options.grid.parentOccurence&&Array.isArray(this.options.grid.parentOccurence)?this.options.grid.parentOccurence:null},p.prototype.getUsages=function(){return null!=this.options.grid.quantity&&Array.isArray(this.options.grid.quantity)?this.options.grid.quantity:null},p.prototype.setUsages=function(e){this.options.grid.quantity=e},p.prototype.getCoreMaterialsRollup=function(){const{appCore:e}=this.options;return new d(this,e).getRollup()},p.prototype.getUsedQuantity=function(){return this.getUsages()&&this.getUsages().length>0?this.getUsages().length:null},p.prototype.getRollUpMaterials=function(){const{appCore:e}=this.options;return new d(this,e).getRollup()},p.prototype.getLockDataForFilter=function(e){const t=this.options.grid[e],n=e.contains("Instance")?this.options.grid["ds6w:reservedBy-Instance"]:this.options.grid["ds6w:reservedBy"];return t&&"FALSE"!==t?this.options.appCore.i18nManager.get("lockedBy").replace("{user}",n):this.options.appCore.i18nManager.get("notLocked")},p.prototype.hasMassQuantity=function(){return new l(this).hasMassQuantity()},p.prototype.hasVolumeQuantity=function(){return new l(this).hasVolumeQuantity()},p.prototype.hasRawMatVolumeQuantity=function(){return new c(this).hasRawMatVolumeQuantity()},p.prototype.hasRawMatAreaQuantity=function(){return new c(this).hasRawMatAreaQuantity()},p.prototype.hasRawMatMassQuantity=function(){return new c(this).hasRawMatMassQuantity()},p.prototype.hasRawMatAsRequired=function(){return new c(this).hasRawMatAsRequired()},p.prototype.hasRawMatLengthQuantity=function(){return new c(this).hasRawMatLengthQuantity()},p.prototype.getMassQuantity=function(){return new l(this).getMassQuantity()},p.prototype.getVolumeQuantity=function(){return new l(this).getVolumeQuantity()},p.prototype.getRawMatMassQuantity=function(){return new c(this).getRawMatMassQuantity()},p.prototype.getRawMatVolumeQuantity=function(){return new c(this).getRawMatVolumeQuantity()},p.prototype.getRawMatAreaQuantity=function(){return new c(this).getRawMatAreaQuantity()},p.prototype.getRawMatLengthQuantity=function(){return new c(this).getRawMatLengthQuantity()},p.prototype.getUsedReferenceID=function(){return this.isMaterialQuantity()?this.options.CoreMaterialNodes[0].getID():this.getID()},p.prototype.hasUsages=function(){var e=this.getUsages();return!!(null!=e&&Array.isArray(e)&&e.length>0)},p.prototype.findChildrenByIds=function(e){let t=this.getContentModels()&&this.isRoot()?this.getContentModels().getRoots():this.getChildren();return r.findNodesByIdsFromList(t,e)},p.prototype.findChildrenById=function(e){return this.findChildrenByIds([e])},p.prototype.setStaticMapping=function(e){this.options.staticMapping=e},p.prototype.getStaticMapping=function(){return this.options.staticMapping},p.prototype.getExpandPath=function(){let e;return this.getStaticMapping()&&(e=this.getStaticMapping().path),this.getOccurrencePath&&this.getOccurrencePath()&&Array.isArray(this.getOccurrencePath())&&this.getOccurrencePath().length>1&&(e=this.getOccurrencePath()),e},p.prototype.matchIDs=function(e){const t=this.getID?this.getID():null,n=this.buildNodeId?this.buildNodeId():null,i=this.getRelationID?this.getRelationID():null;return-1!==e.indexOf(t)||-1!==e.indexOf(i)||-1!==e.indexOf(n)},p.prototype.matchQtyOrInstIDs=function(e){if(this.options.appCore.sessionManager.shouldShowQuantityView()){const t=this.getID?this.getID():null,n=this.buildNodeId?this.buildNodeId():null,i=(this.getRelationID&&this.getRelationID(),this.options.grid.quantity);let r=!1;return i&&Array.isArray(i)&&i.forEach(i=>{const o=i.getRelationID?i.getRelationID():null;-1===e.indexOf(t)&&-1===e.indexOf(o)&&-1===e.indexOf(n)||(r=!0)}),r}return this.matchIDs(e)},p.prototype.matchChangeSet=function(e){let t=function(e){let t=e.referenceId||e.instanceId||e.occurrenceId;return Array.isArray(t)?t.join("/"):t}(e);return this.matchIDs([t])},p.prototype.updateWithChangeSet=function(e){let t=!1;this.matchChangeSet(e)&&(Object.assign(this.options.grid,e.options.grid),t=!0);const n=this.getUsages();n&&n.length&&n.forEach(n=>{n.matchChangeSet(e)&&(Object.assign(n.options.grid,e.options.grid),t=!0)}),t&&this.updateOptions(this.options)},p.prototype.getLevelForPayload=function({onlyFinal:e,onlyMFG:t,targetLevel:n}){return n||(e||t?"-1":"1")},p.prototype.isEndItem=function(){var e=widget.getValue(s.FINAL_ITEMS_PREF),t=this.options.appCore.dicoService.getTerminalAttributesInfo(e),n=t&&t.kind?t.kind:null,i=(n=t&&t.Type?t.Type:n)&&"boolean"==n.toLowerCase(),r=this.options.appCore.dicoService.getTerminalAttributesInfo(e),o=widget.getValue(s.FINAL_ITEM_VALUE_NAME),a=null;if(r){const t="tree"==e?"ds6w:label":e;void 0===(a=this.options.grid[t])&&(a=r.defaultValue)}return null!=a&&null!=o&&void 0!==o&&(Array.isArray(a)?a.includes(o):(i&&(a=i?a.toLowerCase():a,o=i&&o?o.toLowerCase():o),a===o))},p.prototype.getLeafNodes=function(e){let t=[],n=this;if(this.isEndItem())this.options.appCore.sessionManager.shouldShowLeafMaterials()?t.push(this.getValidRawMaterialforEndItem()):t.push(this);else{let i=e?this.getVisibleChildren():this.getChildren();i&&Array.isArray(i)&&0!==i.length?i.forEach(i=>{let o=[];i.isRawMaterialType&&i.isRawMaterialType()&&n.isDeformedObject&&n.isDeformedObject()?o=[n]:r.isNodeFromModel(i)?o=i.getLeafNodes(e):i.getVisibleChildren().forEach(t=>{o.push(...t.getLeafNodes(e))}),t.push(...o)}):t.push(this)}return t},p.prototype.getValidRawMaterialforEndItem=function(){let e=this.getChildren();if(Array.isArray(e)&&e.length>0)for(let t=0;t<e.length;t++)if(e[t].isRawMaterialType&&e[t].isRawMaterialType()&&!e[t].isDirectRawMatConsumption())return e[t];return this},p.prototype.getChildNodes=function(){let e=[],t=this.getChildren();return t&&Array.isArray(t)&&t.length>0&&t.forEach(t=>{e.push(t);let n=t.getChildNodes();e.push(...n)}),e},p.prototype.getNodesById=function(){return this.getChildNodes?this.getChildNodes():void 0},p.prototype.isGrouped=function(){return!(!this||!this.getRoot())&&(!r.isNodeFromModel(this.getRoot())||this.getRoot().isGroupingNode)},p.prototype.isStructureRoot=function(){return this.options.appCore.contextManager.getActiveEngItem().getID()===this.getID()},p.prototype.getAttributesToConvert=function(e){if(this.hasQuantity()){const t=new l(this).getMKSAttributesToConvert();e.push(...t)}else if(this.isRawMaterialType()){const t=new c(this).getMKSAttributesToConvert();e.push(...t)}},p.prototype.getAttributeCellValue=function(e){return new u(this).getAttributeValue(e)},p}),define("DS/ENOXEngineer/models/EngItemGroupModel",["DS/ENOXEngineer/models/EngItemModel","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/services/I18nManager","UWA/Core","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n,i,r,o){"use strict";function s(t){this.options={useAsyncPreExpand:!1},this.options=r.extend(this.options,t),e.call(this,this.options),this.isGroupingNode=!0}return s.prototype=Object.create(e.prototype),s.prototype.getViewType=function(){return this.options.viewType},s.prototype.getIcons=function(){return this.options.icons},s.prototype.getTypeIcon=function(){return this.options.icons},s.prototype.isGroupFromExpand=function(){return!0===this.options.useAsyncPreExpand},s.prototype.getGlobalType=function(){return this.options.padgrid?this.options.padgrid["ds6w:globalType"]:null},s.prototype.getLabel=function(){return this.options.label},s.prototype.isCoreMaterialGroupNode=function(){return!0===this.getAttributeValue("isCoreMaterialGroupNode")},s.prototype.constructor=s,s.prototype.getIdentifier=function(){return this._options.identifier},s.prototype._getFakeNodesTable=function(){return this._options.fakeNodesTable},s.prototype.getInstanceType=function(){return""},s.prototype.getProperty=function(){return this._options.property},s.prototype.getGroupingNodeOptions=function(e){var t={},r=this.getProperty(),o=this.getIdentifier(),s=e.count,a=(this.getChildren(),o);if(this._options.patch_isCustoDate&&a&&"NULL"!==a&&"NA"!==a){isNaN(a)||(a=parseInt(a),a*=1e3);var l=n.getDateFormater();try{a=l.format(new Date(a)).replace(",","")}catch(e){a=new Date(a)}}let c=r.endsWith("-Instance")?` (${i.get("eng.export.instance.key")})`:"";return t.label=i.get(r)+c+": "+a+" ("+s+")",t},s.prototype.getOriginalChildrenInformation=function(){return Object.assign({},this._options.originalChildrenInformation)},s.prototype._setOriginalChildrenInformation=function(e){e.childrenCount===this._options.originalChildrenInformation.childrenCount&&e.notHiddenNotFilteredChildrenCount===this._options.originalChildrenInformation.notHiddenNotFilteredChildrenCount||(this._options.originalChildrenInformation=Object.assign({},e)),e.notHiddenNotFilteredChildrenCount>0?(this.isHidden()&&this.show(),this.isExpanded()||this.expand()):this.isHidden()||this.hide(),0===e.childrenCount&&this.remove()},s.prototype._updateOriginalChildrenInformation=function(){var e=0,t=0,n=this.getChildren();if(n)for(var i=n.length;i>0;i--){var r=n[i-1],o=r._updateOriginalChildrenInformation();e+=o.childrenCount,t+=o.notHiddenNotFilteredChildrenCount,0===o.childrenCount&&delete this._getFakeNodesTable()[r.getIdentifier()]}return this._setOriginalChildrenInformation({childrenCount:e,notHiddenNotFilteredChildrenCount:t}),{childrenCount:e,notHiddenNotFilteredChildrenCount:t}},s.prototype._updateGroupingNodeOptions=function(e){var t=this.getChildren(),n=[];t&&t.forEach(function(t){n=n.concat(t._updateGroupingNodeOptions(e))});var i=this.getOriginalChildrenInformation();return e.updateGroupingNodeOptions?e.updateGroupingNodeOptions.call(this,n):this.updateOptions(this.getGroupingNodeOptions({count:i.notHiddenNotFilteredChildrenCount})),n},s.prototype._canBeGrouped=function(){return!1},s.prototype._isFromOriginalModel=function(){return!1},s.prototype._groupChildren=function(e){},s.prototype.groupChildren=function(e){},s.prototype._removeGrouping=function(e,t,n,i){var r=this.getChildren();if(r&&r.length>0){for(var o=i||!t||t.length<=n||t[n]!==this.getProperty(),s=r.length;s>0;s--){var a=r[s-1];a._removeGrouping(e,t,n+1,o)&&delete this._getFakeNodesTable()[a.getIdentifier()]}return o?this.remove():this.hide(),o}},s.prototype.ungroupChildren=function(e){},s.prototype.canBeFiltered=function(){return!1},s}),define("DS/ENOXEngineer/facets/AttachmentsFacet",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","DS/ENOXEngineer/models/EngItemGroupModel","DS/ENOXAttachmentsUX/AttachmentsPane","DS/ENOXEngineer/utils/XEngineerConstants"],(e,t,n,i,r,o,s)=>{return t.extend(n,i,{init(e){this._parent(e),this.buildView(e)},buildView(t){const n=this;this.elements.container=e.createElement("div",{class:"relatedDocuments"}),this.multiselDisplay=e.createElement("div",{class:"notSupported"}).inject(this.elements.container),this.iconHolder=e.createElement("span",{class:"blockIcon"}).inject(this.multiselDisplay),this.infoMsgH2Tag=e.createElement("h2",{class:"information_msg"}).inject(this.multiselDisplay),this.multiselDisplay.hide(),t.appContext.settingManager.getAllPlatforms().then(e=>{const i={parentObject:{parentId:n.getUniqueSelectedNodeID()},connectorOptions:{fetchSecurityContext:()=>t.appContext.contextManager.getSecurityContext().SecurityContext,platformUrls:e[t.appContext.settingManager.getPlatformId()]},supportedTypes:{includedTypes:t.appContext.settingManager.getSetting("includedAttachmentTypes"),excludedTypes:t.appContext.settingManager.getSetting("excludedAttachmentTypes")},webinwin:!1};n.attachmentsPane=new o(i),n.attachmentsPane.modelEvents.subscribe({event:s.EVENT_UPLOAD_ATTACHMENT_COMPLETE},function(){n.options.appContext.sessionManager.setAuthoringMode("authoring")}),n.attachmentsPane.modelEvents.subscribe({event:s.EVENT_DETACH_ATTACHMENT_COMPLETE},function(){n.options.appContext.sessionManager.setAuthoringMode("authoring")}),n.attachmentsPane.modelEvents.subscribe({event:s.EVENT_ATTACH_ATTACHMENT_COMPLETE},function(){n.options.appContext.sessionManager.setAuthoringMode("authoring")}),n.attachmentsPane.inject(n.elements.container),n.multiselDisplay.isHidden()||n.attachmentsPane.hide()})},updateFacet(){const e=this.getUniqueSelectedNodeID();this.selectionModified(e)},getUniqueSelectedNodeID(){let e,t=!0;const n=[],i=this.options.appContext.contextManager.getXENTreeDocument().getSelectedNodes();if(i.length>0&&i.forEach(e=>{n.push(e.getID()),e.isEngineeringItem()||(t=!1)}),!t)return;const r=[...new Set(n)];return 1===r.length?[e]=r:0===i.length&&1===this.options.appContext.contextManager.getSelectedNodes().length&&(e=this.options.appContext.contextManager.getSelectedNodes()[0].getID()),e},destroyComponent(){},notApplicable(){this.infoMsgH2Tag.setText(this.options.appContext.i18nManager.get("notSupportedSelection")),this.iconHolder.addClassName("wux-ui-3ds wux-ui-3ds-5x wux-ui-3ds-block"),this.multiselDisplay.show(),this.attachmentsPane&&this.attachmentsPane.hide()},selectionModified(e){if(!e)return void this.notApplicable();this.multiselDisplay.hide();const t={parentId:e};this.attachmentsPane&&(this.attachmentsPane.show(),this.attachmentsPane.options.parentObject.parentId!==e&&this.attachmentsPane.setParentObject(t))},onResize(){},onRefresh(){}})}),define("DS/ENOXEngineer/facets/SpecificationsFacet",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","DS/ENOXEngineer/models/EngItemGroupModel","DS/ENOXSpecificationsUX/SpecificationsPane","DS/ENOXEngineer/utils/XEngineerConstants"],(e,t,n,i,r,o,s)=>{return t.extend(n,i,{init(e){this._parent(e),this.buildView(e)},buildView(t){const n=this;this.elements.container=e.createElement("div",{class:"relatedDocuments_spec"}),this.multiselDisplay=e.createElement("div",{class:"notSupported"}).inject(this.elements.container),this.iconHolder=e.createElement("span",{class:"blockIcon"}).inject(this.multiselDisplay),this.infoMsgH2Tag=e.createElement("h2",{class:"information_msg"}).inject(this.multiselDisplay),this.multiselDisplay.hide(),t.appContext.settingManager.getAllPlatforms().then(e=>{const{includedTypes:i,excludedTypes:r}=t.appContext.settingManager.getSetting("SpecificationTypes"),a={parentObject:{parentId:n.getUniqueSelectedNodeID()},connectorOptions:{fetchSecurityContext:()=>t.appContext.contextManager.getSecurityContext().SecurityContext,getWorkUnderHeaders:function(){return t.appContext&&t.appContext.settingManager&&t.appContext.settingManager.getWorkUnderHeaders&&t.appContext.settingManager.getWorkUnderHeaders()},platformUrls:e[t.appContext.settingManager.getPlatformId()]},supportedTypes:{includedTypes:i,excludedTypes:r},webinwin:!1};n.specificationsPane=new o(a),n.specificationsPane.modelEvents.subscribe({event:s.EVENT_UPLOAD_ATTACHMENT_COMPLETE},function(){n.options.appContext.sessionManager.setAuthoringMode("authoring")}),n.specificationsPane.modelEvents.subscribe({event:s.EVENT_DETACH_ATTACHMENT_COMPLETE},function(){n.options.appContext.sessionManager.setAuthoringMode("authoring")}),n.specificationsPane.modelEvents.subscribe({event:s.EVENT_ATTACH_ATTACHMENT_COMPLETE},function(){n.options.appContext.sessionManager.setAuthoringMode("authoring")}),n.specificationsPane.inject(n.elements.container),n.multiselDisplay.isHidden()||n.specificationsPane.hide()})},updateFacet(){const e=this.getUniqueSelectedNodeID();this.selectionModified(e)},getUniqueSelectedNodeID(){let e,t=!0;const n=[],i=this.options.appContext.contextManager.getXENTreeDocument().getSelectedNodes();if(i.length>0&&i.forEach(e=>{n.push(e.getID()),e.isEngineeringItem()||(t=!1)}),!t)return;const r=[...new Set(n)];return 1===r.length?[e]=r:0===i.length&&1===this.options.appContext.contextManager.getSelectedNodes().length&&(e=this.options.appContext.contextManager.getSelectedNodes()[0].getID()),e},destroyComponent(){},notApplicable(){this.infoMsgH2Tag.setText(this.options.appContext.i18nManager.get("notSupportedSelection")),this.iconHolder.addClassName("wux-ui-3ds wux-ui-3ds-5x wux-ui-3ds-block"),this.multiselDisplay.show(),this.specificationsPane&&this.specificationsPane.hide()},selectionModified(e){if(!e)return void this.notApplicable();this.multiselDisplay.hide();const t={parentId:e};this.specificationsPane&&(this.specificationsPane.show(),this.specificationsPane.options.parentObject.parentId!==e&&this.specificationsPane.setParentObject(t))},onResize(){},onRefresh(){}})}),define("DS/ENOXEngineer/services/XEngContextManager",["UWA/Core","UWA/Class","DS/ENOXEngineerCommonUtils/XENMask","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/models/EngItemGroupModel","DS/ENOXEngineer/utils/ResponseParser","DS/UIKIT/Input/Toggle","DS/UIKIT/SuperModal","DS/PlatformAPI/PlatformAPI","DS/LifecycleServices/LifecycleServicesSettings","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n,i,r,o,s,a,l,c,d,u,p){"use strict";return t.singleton({_selectedItems:[],_is_XENG_widget:!0,_isMultiSelectMode:!1,_currentCommandContext:null,_app:null,_activeEngItem:null,_activeDocument:null,dragStartedInXENG:!1,_expectSingleCreation:!1,_modelsRawData:null,_currentRunningCmd:null,name:"pad_component",_activeList:null,_viewContext:{},_postProcess:!1,_isDataGridView:!1,_activeGridView:null,getPADDGVView:null,isClearSortEnabled:null,_multiselMenu:!1,_isDoubleClickEvent:!1,elements:{},initialize:function(e){this._app=e,e.core.contextManager=this,this.settingManager=this._app.core.settingManager;var t=this;this._XENContentProxy=e.core.Factories.CollectionsFactory.getXENProxyContentTreeDocument(),this._app.mediator.subscribe(r.EVENT_RESET_SELECTION,function(){t.resetSelection()}),this.options={widget:"undefined"!=typeof widget?widget:null},this._app.mediator.subscribe(r.EVENT_REMOVED_INSTANCES,function(e){var n=[];if(t._app.core.sessionManager.shouldShowQuantityView()){var i=t.getActiveEngItem().getContentModels(),o=i.getSelectedNodes();let l=[];if(o=o.filter(function(e){return!0===e.isDocument()&&l.push(e),!0!==e.isDocument()}),l.length>0&&t._app.mediator.publish(r.EVENT_REMOVED_NODES,{nodes:l}),Array.isArray(o))for(let l=0;l<o.length;l++){var s=o[l].getParentIdFromOccrencePath(),a=i.findNodesByIds([s]);let c=i.getChildrenWithoutGroupingNodes();(c=s===t.getActiveEngItem().getID()?c:a[0].getChildren()).forEach(function(i){i.options;var o=i.getUsages();if(o&&Array.isArray(o)){var s=o.filter(function(t){return-1==e.instances.indexOf(t.options.instanceId)});0==s.length?n.push(i):o.length>s.length&&(i.setUsages(s),i.updateOptions(i.options),t._app.mediator.publish(r.EVENT_REFRESH_LISTVIEW))}})}}n.length>0?t._app.mediator.publish(r.EVENT_REMOVED_NODES,{nodes:n}):t._app.mediator.publish(r.EVENT_REMOVED_INSTANCE,e)}),this._app.mediator.subscribe(r.EVENT_MODIFIED_REFERENCES,function(e){t._app.core.sessionManager.setAuthoringMode("authoring");let n=t._XENContentProxy.getCurrentTreeDocument()&&t._XENContentProxy.getCurrentTreeDocument().getAllDescendants(),i=t.updateNodeReferenceOptions(e,n);0==i.length&&e.references&&e.references.findIndex(e=>e.physicalid===t.getActiveEngItem().getID())>-1&&(i=[t.getActiveEngItem()]),t._app.mediator.publish(r.EVENT_MODIFIED_NODES,i)}),this._app.mediator.subscribe(r.EVENT_NEW_VERSION_COMPLETED,function(e){t._app.core.sessionManager.setAuthoringMode("authoring");var n=[];Array.isArray(e)&&(e.forEach(function(e){let i=e.sourceObjectId,r=t._XENContentProxy.getCurrentTreeDocument().findNodesById(i),o="",s="";Array.isArray(r)&&r.length>0&&(o=r[0].getType(),s=r[0].getName()),t._XENContentProxy.getCurrentTreeDocument().getAllDescendants().forEach(function(e){(e.getID()===i||e.getType()===o&&e.getName()===s)&&n.push(e)})}),0==n.length&&t._app.mediator.publish(r.EVENT_UPDATE_IDCARD_RENDERING,!0)),t._app.mediator.publish(r.EVENT_MODIFIED_NODES,n)}),this._app.mediator.subscribe(r.EVENT_DELETE_VERSION_COMPLETED,function(e){t._app.core.sessionManager.setAuthoringMode("authoring"),t.isActiveEngItemSelected()?t._app.mediator.publish(r.EVENT_UPDATE_IDCARD_RENDERING,!0):t._app.mediator.publish(r.EVENT_MODIFIED_NODES,t.getSelectedNodes())}),t._refreshSubscription=d.subscribe("Lifecycle.Modification",function(e){t.getContext().displayNotification=(e=>{"error"===e.eventID?i.errorAlert(e.msg||e):"warning"===e.eventID?i.warningAlert(e.msg||e):i.sucessAlert(e.msg||e)});var n=t.getSelectedNodes().map(function(e){return e.getID()}),o=JSON.parse(e);if(o&&o.Refresh){if(o.Refresh.created&&Array.isArray(o.Refresh.created)){var s=o.Refresh.created.filter(function(e){return-1!==n.indexOf(e.sourceObjectId)});s&&Array.isArray(s)&&s.length>0&&t._app.mediator.publish(r.EVENT_NEW_VERSION_COMPLETED,s)}o.Refresh.deleted&&Array.isArray(o.Refresh.deleted)&&t._app.mediator.publish(r.EVENT_DELETE_VERSION_COMPLETED,o.Refresh.deleted)}}),t._refreshSubscription=d.subscribe("cfgEffectivityModifications_"+widget.id,function(e){t.updateEffectivityModifications(e)}),d.subscribe("cfgEditConfigurationContextModification_"+widget.id,e=>{if(!e)return;let{commandName:n,reponse:i}=e;if(n===r.CFG_EDIT_CONTEXT_CMD){let e=t.getActiveEngItem().getID();t._app.core.dataService.getEngItemConfigurationInfo({pid:e}).then(e=>{t.getActiveEngItem().attachConfigModels(e),t._app.mediator.publish(r.EVENT_SYNC_VIEW_WITH_EI_MODEL)});var o=t.getSelectedRealNodes();if(!this.isRoot(o[0])){for(var s=[],a=0;a<o.length;a++)s.push(o[a].getID());t._app.mediator.publish(r.EVENT_REFRESH_ITEMS_BY_IDS,s)}if(t.getSelectedNodes()[0].getID()==e){let n={references:[{physicalid:e}],dataIndex:"ConfigurationContext"};t._app.mediator.publish(r.EVENT_MODIFIED_REFERENCES,n)}}})},updateEffectivityModifications:function(e){let t=this;t._app.core.sessionManager.setAuthoringMode("authoring");let n=JSON.parse(e);if(!n)return;let i=n.response;if(!i)return;let o=[];switch(n.commandName){case"cfgEditVariant":case"cfgEditEvolution":case"cfgPasteVariant":case"cfgPasteEvolution":case"cfgMassEditVariant":let e=[];i.results.forEach(t=>{t.existing&&o.push(t.existing.pid),t.new&&e.push(t.new.pid)}),e&&e.length>0&&t.insertEffectivityNode(e);break;case"cfgReplaceInstantiatedConfigurationByRevision":case"cfgExtendEvolutionEffectivity":o=i.resources.map(e=>e.identifier)}t._app.mediator.publish(r.EVENT_REFRESH_ITEMS_BY_IDS,o)},insertEffectivityNode:function(e){const t=this.getActiveEngItem().getContentModels().getSelectedNodes();if(t&&Array.isArray(t)&&t.length>0){let n=t[0].getID(),i=t[0].getRealParent().getID(),o=e.map(e=>({child:n,instance:e,parent:i}));this._app.mediator.publish(r.EVENT_INSTANCES_CREATED,o)}},init:function(e){this._parent(e)},updateNodeReferenceOptions:function(e,t){var n=[];return e.references.forEach(function(e){var i=e.physicalid;t&&t.forEach(function(t){if(o.isNodeFromModel(t)){var r=!1;t.getID()===i&&(r=!0,n.push(t),e.attributes.forEach(function(e){t.options.grid[e.name]=e.value}));var s=t.getUsages();s&&Array.isArray(s)&&s.forEach(function(t){t.getID()===i&&(r=!0,e.attributes.forEach(function(e){t.options.grid[e.name]=e.value}))}),r&&t.updateOptions(t.options)}})}),n},getXENTreeDocument:function(){return this._XENContentProxy},setCurrentViewPreference:function(e){this._isDataGridView="XENTile"!=e},setGridView:function(e){this._activeGridView="dataGridView"==e.name?e:null},getPADDGVView:function(){return this.getXENTreeDocument().isClearSortEnabled=(()=>{if(!this._activeGridView)return!1;var e=this._activeGridView.sortModel;return null!==e&&(e.length>=1?"ro.plminstance.V_treeorder-Instance"!==e[0].dataIndex:void 0)}),this.getXENTreeDocument().clearSort=(()=>{let e=this._activeGridView;e.prepareUpdateView(),e.sortModel=null,e.sortModel=[{dataIndex:"ro.plminstance.V_treeorder-Instance",sort:"asc"}],e.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!1},!0)}),this.getXENTreeDocument()},isMultiLevelStructure:function(){var e=!1,t=this._app.core.localStorage.getItem(r.VALUE_QUALIFIED_AS_FINAL_COMPONENT);return t&&t===r.DIRECT_CMD&&this._isDataGridView&&(e=!0),e},setExpectSingleCreation:function(e){this._expectSingleCreation=e},expectSingleCreation:function(){return this._expectSingleCreation},setActiveDocument:function(e){this._activeDocument=e},withTransactionUpdate:function(e){if(this.getActiveEngItem()&&this.getActiveEngItem().getContentModels())return this.getActiveEngItem().getContentModels().withTransactionUpdate(e)},getActiveDocument:function(){return this._activeDocument},getActiveEngItem:function(){return this._activeEngItem},setActiveEngItem:function(e){this._activeEngItem=e},getNodesById:function(e){return this.getXENTreeDocument()?this.getXENTreeDocument().findNodesById(e):[]},getContext:function(){return this},get:function(){return this},getEditMode:function(){return!0},getENONewContext:function(){const e=()=>{const e={header:{SecurityContext:`ctx::${this._app.core.settingManager.getSecurityContext()}`},tenant:this._app.core.settingManager.getPlatformId(),service:"",serviceBaseUrl:""},n=t._app.core.settingManager.getAuthorizedChange()?t._app.core.settingManager.getAuthorizedChange().AuthoringContextHeader:void 0;return e.header=n?{...e.header,...n}:e.header,e};var t=this;return{getLoginContext:()=>e(),getNewTypeList:e=>{return{typeList:[r.TYPE_NEW_PRODUCT,r.TYPE_NEW_PRODUCT_CBD_ASSEMBLY,r.TYPE_NEW_PRODUCT_CBD_BOARD,r.TYPE_NEW_PRODUCT_PCB_COMPONENT],showSubtype:!1}},getCreateOptions:n=>{const r=e(),o=t.getSelectedNodes(),s=o.length?o.map(e=>e.getID()):[],a=u.getActiveFolder?u.getActiveFolder():void 0,l=a&&null!==a.id&&void 0!==a.id&&""!==a.id,c=[{name:"classificationFacet",facetoptions:{isBookmark:!0,isLibrary:!0,isExportControl:!0}}];return t.settingManager.isXRevisionActive()&&c.push({name:"revisionFacet"}),{id:t._app.core.settingManager.getWidgetId(),context:r,silentMode:!1,options:{preferedType:"",parentPIDs:s,parentOrigin:[],activeFolder:l,folderID:l?[a.id]:[]},events:{onSuccess:e=>{"success"===e.status?(t.onNewContentCreated(e.result),i.sucessAlert(this._app.core.i18nManager.get("eng.createSuccess"))):i.errorAlert("error")},onFailure:e=>{},onCancel:e=>{}},viewType:"tabView",facets:c}}}},onNewContentCreated:function(e){if(!e||!Array.isArray(e)||!e.length)return;this._app.core.sessionManager.setAuthoringMode("authoring");const t=e.filter(e=>e.relations);if(t.length){let e=[];t.forEach(t=>{const n=t.identifier;t.relations.forEach(t=>{const i=t.relationshipID,r=t.fromID;e.push({child:n,instance:i,parent:r})})}),this._postProcessEvent&&""!==this._postProcessEvent?this._app.mediator.publish(this._postProcessEvent,e):this._app.mediator.publish(r.EVENT_INSTANCES_CREATED,e)}else if(1===e.length){const t={physicalid:e[0].identifier,type:e[0].type};this._app.mediator.publish(r.EVENT_NEW_ENG_ITEM_CREATED,t)}},getAvailableAttributes:function(e){return this._app.core.dicoService.getAvailableAttributesByTypeV2Adapter(e)},getSecurityContext:function(){return{SecurityContext:"ctx::"+this._app.core.settingManager.getSecurityContext(),tenant:this._app.core.settingManager.getPlatformId()}},getActiveEngItemOpenContext:function(){return this.getActiveEngItem()?this._app.core.sessionManager.getCurrentOpenContext():null},getPreferredConfigModel:function(){var e=this.getActiveEngItem();return e.isConfigured()&&e.getPreferedAttachedConfigModel()&&e.getPreferedAttachedConfigModel().getID()?[{physicalID:e.getPreferedAttachedConfigModel().getID()}]:e.isConfigured()&&e.getAttachedConfigModels()&&e.getAttachedConfigModels().length>0?e.getAttachedConfigModels().map(function(e){return e.getID()}):null},refreshView:function(e){e.created||e.deleted||e.modified},_updateSrcArrayWithProductNodes:function(e,t){if(!t.isDocument())if(this._app.core.Factories.ListItemFactory.isInstanceOfListNodeModel(t))e.push(t);else{var n=t.getUsages?t.getUsages():null;n&&Array.isArray(n)&&(e=e.concat(n))}},getChildren:function(e){var t=this,n=[];if(this.getActiveEngItem()&&void 0!==e&&this.getActiveEngItem().getID()===e.getID()){var i=this.getActiveEngItem().getContentModels(),r=i?i.getChildrenWithoutGroupingNodes():null;Array.isArray(r)&&r.forEach(function(e){t._updateSrcArrayWithProductNodes(n,e)})}else if(void 0!==e){var o=e.getChildren();Array.isArray(o)&&o.forEach(function(e){t._updateSrcArrayWithProductNodes(n,e)})}return n},getOrdering:function(){return{}},insertNodes:function(e){if(e.created){var t=a.attributesParser(e.created[0].attributes);this._app.mediator.publish(r.EVENT_NEW_ENG_ITEM_CREATED,t)}else if(e.inserted){if(!Array.isArray(e.inserted))return void console.warn("invalid input ");let t=[];e.inserted.forEach(e=>{let n=e.parent_id;e.children&&Array.isArray(e.children)&&e.children.forEach(e=>{let i=e.attributes.find(e=>"physicalid"===e.name).value,r=e.relationid;t.push({instance:r,child:i,parent:n})})}),this._postProcessEvent&&""!==this._postProcessEvent?this._app.mediator.publish(this._postProcessEvent,t):this._app.mediator.publish(r.EVENT_INSTANCES_CREATED,t)}else if(e.paste&&Array.isArray(e.paste)){let t=e.paste.map(e=>({child:e.resourceid,instance:e.relationid,parent:e.hasParent}));this._app.mediator.publish(r.EVENT_INSTANCES_CREATED,t)}},setCurrentRunningCmd:function(e){this._currentRunningCmd=e},getCurrentRunningCmd:function(e){if(this._currentRunningCmd)return this._currentRunningCmd},isRunningCmd:function(e){return this._currentRunningCmd===e},author:function(e){if(this._app.core.sessionManager.setAuthoringMode("authoring"),"UPSAuthReorderProduct"===this._currentRunningCmd){let e={};e[r.CONST_TARGET_LEVEL]="1",this._app.core.contextManager.getSelectedNodes().forEach(e=>{e.options.childComputed=!1,e.options.children=e.options.children?[]:e.options.children}),this._app.core.sessionManager.buildCurrentSession(e);let t=this._app.core.contextManager._activeGridView;t.layout.collectionView.sortModel=[],t.layout.saveColumnSortModelInPreferences();let n=t.layout.collectionView.getCustomViewsManager();n&&n.getCurrentCustomView()&&n.getCurrentCustomView().columnsSortModel&&(n.getCurrentCustomView().columnsSortModel=void 0),n.setCustomViews(n.getCustomViews()),this._currentRunningCmd=""}return!0},getSelectedNodes:function(){return this._selectedItems&&0===this._selectedItems.length&&null!=this.getActiveEngItem()?[this.getActiveEngItem()]:this._selectedItems},getSelectedRealNodes:function(){let e=[];return e=this.getActiveEngItem()&&this.getActiveEngItem().getContentModels()?this.getActiveEngItem().getContentModels().getSelectedNodes().filter(function(e){return o.isNodeFromModel(e)&&!e.isGroupingNode}):this.getXENTreeDocument().getSelectedNodes()},resetSelection:function(){this._selectedItems=[]},addSelection:function(t,n){this._selectedItems=[];var i=this;e.is(t,"array")?t.forEach(function(e){i._selectedItems.push(e)}):this._selectedItems.push(t)},setViewContext:function(e,t){"string"==typeof e&&""!=e&&(this._viewContext.viewName=e),this._viewContext.options=t},getViewContext:function(){return this._viewContext},modalChooser:function(e){var t=!0===this.isRunningCmd(r.ADD_EXISTING_DRAWING)?"Drawing":"VPMReference";this._app.core.dataService.searchManager.launchASearch({title:"VPMReference"===t?this._app.core.i18nManager.get("eng.searchResult.InsertEngItem"):this._app.core.i18nManager.get("eng.searchResult.InsertDrawing"),allowedTypes:[t],role:"",criteria:"",in_apps_callback:e.in_apps_callback})},beginBlockingTransaction:function(e){n.mask(document.body,e)},isThereARootSelected:function(){for(var e=this.getSelectedNodes(),t=0;t<e.length;t++)if(e[t]===this.getActiveEngItem())return!0;return!1},isRoot:function(e){return e===this.getActiveEngItem()},getInstance:function(e){return e.getID()},getRelationID:function(e){return"function"==typeof e.getRelationID?e.getRelationID():""},getReference:function(e){return e.getID()},getParent:function(e){let t=e.getParent();return t&&"function"==typeof t.getType&&""!==t.getType()?t:this.getRoot(e)},getRoot:function(e){return this.getActiveEngItem()},getRoots:function(){return[this.getActiveEngItem()]},getType:function(e){return e.getType()},getName:function(e){return e?e.getLabel():null},getInstanceName:function(e){if(e){let t=e.getInstanceName();return t||e.getLabel()}return null},canInstantiate:function(e,t,n){let r=this._app.core.contextManager.getSelectedNodes();for(let e in r){let s=r[e].getOccurrencePath();for(var o=0;o<t.length;o++)if(s.some(e=>t.includes(e))){if(n&&""!=n)i.errorAlert(n);else if(t[o]===r[e].getID())return!0;return!1}}return!0},refresh:function(e){if(e)if("replace"===e.action){var t=Array.isArray(e.operations)?e.operations:[],n=[];t.forEach(function(e){var t={parentId:e.parent,replacedId:e.old,new:e.new};n.push(t)}),this._app.mediator.publish(r.EVENT_REPLACED_ENG_ITEM,n)}else if("unparent"===e.action){n={instances:e.instances};this._app.mediator.publish(r.EVENT_REMOVED_INSTANCES,n)}else if("insert"===e.action){let t=this,n=[];for(let t=0;t<e.instances.length;t++){let i=e.instances[t],r=e.references[t],o=e.parent,s=e.productConfigurationFromSearch;n.push({instance:i,child:r,parent:o,productConfigurationFromSearch:s})}t._app.mediator.publish(r.EVENT_INSTANCES_CREATED,n)}else if("updateRevision"===e.action){(t=Array.isArray(e.operations)?e.operations:[]).forEach(e=>{if(e.existing){let t=this.getNodesById(e.existing);this._app.mediator.publish(r.EVENT_MODIFIED_NODES,t)}})}else if(e.action===r.EDIT_DOCUMENT||e.action===r.UPDATE_DOCUMENT||e.action===r.UNDO_EDIT_DOCUEMNT){let t=(Array.isArray(e.data)?e.data:[]).map(e=>e.id);this._app.mediator.publish(r.EVENT_REFRESH_ITEMS_BY_IDS,t)}else e.action!==r.REPLACE_BY_LATEST_REVISION_DOCUEMNT&&e.action!==r.REPLACE_BY_REVISION_DOCUEMNT||this._app.mediator.publish(r.EVENT_REPLACED_DOCUMENT,{oldDocumentId:this.getSelectedNodes()&&this.getSelectedNodes()[0].getRelationID(),replacedDocumentId:e.targetDocumentId})},addRoot:function(e,t,n){if(!e.pids||!Array.isArray(e.pids)||!e.pids.length)return;const i=e.pids,o=e=>{this._app.mediator.publish(r.EVENT_LAUNCH_COMMAND,{commandId:r.OPEN_ENG_ITEM,context:{item:{objectId:e,objectType:"VPMReference"}}})};1===i.length&&o(i[0])},getSetting:function(e){var t=null;switch(e){case"tenant":t=this._app.core.settingManager.getPlatformId();break;case"lang":t=this._app.core.settingManager.getLanguage();break;case"securityContext":t=this._app.core.settingManager.getSecurityContext()}return t},endBlockingTransaction:function(){n.unmask(document.body)},displayNotification:function(e){"error"===e.eventID?i.errorAlert(e.msg||e):"warning"===e.eventID?i.warningAlert(e.msg||e):i.sucessAlert(e.msg||e)},getSelectedRoots:function(){return[this.getActiveEngItem()]},getCustomAttribute:function(e){var t=this._app.core.dicoService.getParametricalAttributesOf("VPMReference").find(function(t){return e===t.sixWTag});return t&&t.authorizedValues.length>0?t:null},setMultiselMenu:function(e){this._multiselMenu=e},isMultiselMenu:function(){return this._multiselMenu},setDoubleClickEvent:function(){this._isDoubleClickEvent=!0},isDoubleClickEvent:function(){return this._isDoubleClickEvent},clearDoubleClickEvent:function(){this._isDoubleClickEvent=!1},getParentWithChild:function(e){if(null!=e&&e.length){for(var t=[],n=e.length,i=0;i<n;i++)for(var r=e[i],o=0;o<n;o++)if(i!==o)for(var s=e[o],a=s.getParent();a;)a===r&&t.push({parent:r,child:s}),a=a.getParent();return t}},areEngItemGridValuesEqual:function(e,t){if(e.options&&t.options){let n=this._app.core.columnsManager.getDatagridViewColumns().map(function(e){return"tree"===e.dataIndex?"ds6w:label":e.dataIndex});const i=[...this._app.core.dicoService.getMultiValuedAtributes().map(e=>e.ds6w),...this._app.core.dicoService.getClassificationAttributes().map(e=>e.curi)];return i.length&&(n=n.filter(e=>-1===i.indexOf(e))),o.areObjectsGivenPropertyValuesEqual(e.options.grid,t.options.grid,n)}return!1},isPartiallyExpanded:function(e,t){t&&t(!1)},isActiveEngItemSelected:function(){let e=this.getXENTreeDocument().getSelectedNodes(),t=this.getActiveEngItem();return!(e.length>0&&e[0].getID()!==t.getID())},isPreExpandEvent:function(){return this.onPreExpantEvent},setPreExpandEvent:function(e){this.onPreExpantEvent=e},hasFilter:function(e){let t=this.getXENTreeDocument?this.getXENTreeDocument()._FilterBI:null;return t&&t.hasFilter?t.hasFilter(e):void 0},GetFilterSpec:function(e,t){let n=this.getXENTreeDocument?this.getXENTreeDocument()._FilterBI:null;return n&&n.GetFilterSpec?n.GetFilterSpec(e,t):void 0},RetrievePrdFromFilterId:function(e){let t=this.getXENTreeDocument?this.getXENTreeDocument()._FilterBI:null;return t&&t.RetrievePrdFromFilterId?t.RetrievePrdFromFilterId(e):void 0},isIndexMode:function(){return"index"===this._app.core.sessionManager.determineAuthoringMode()},getDataForCfgAnalysisCommands:function(e){var t,n={selectedNodes:[]},i=this.getSelectedNodes(),o=i.length;for(t=0;t<o;t++){if(this.isRoot(i[t]))var s={rootID:i[t].getID(),rootAlias:i[t].getLabel(),id:i[t].getID(),alias:i[t].getLabel(),isRoot:!0};else s={id:e==r.CFG_INSTANTIATED_CONFIGURATION_COMMANDS?i[0].getRelationID():i[0].getID(),alias:i[0].getLabel(),parentID:i[0].getRealParent().getID(),parentalias:i[0].getRealParent().getLabel(),rootID:i[0].getRealParent().getID(),rootAlias:i[0].getRealParent().getLabel(),isRoot:!1};n.selectedNodes.push(s)}return n},getDescendantsDataForCfgAnalysisCommands:function(){var e={descendantNodes:[],occurrences:[]},t=this.getSelectedNodes();if(1==t.length){var n=0;if(this.isRoot(t[0])||t[0].isExpanded()){n=t[0].getAllDescendants({onlyVisibleNodes:!0});for(var i=0;i<n.length;i++)if(!n[i].isGroupingNode&&o.isNodeFromModel(n[i])&&"ds6w:Part"==n[i].options.padgrid["ds6w:globalType"]){let t=n[i].getOccurrencePath().length;var r={physicalID:n[i].getOccurrencePath()[t-2]};e.descendantNodes.push(r)}var s=t[0].getLeafNodes(!0);for(i=0;i<s.length;i++)if(!s[i].isGroupingNode&&o.isNodeFromModel(s[i])&&"ds6w:Part"==s[i].options.padgrid["ds6w:globalType"]){for(var a=s[i].getOccurrencePath(),l=[],c=0;c<a.length;c++){var d={instancePID:a[c]};l.push(d)}var u={path:l};e.occurrences.push(u)}}}return e},isStructureIndented:function(){return this._app.core.sessionManager.shouldShowIndentedView()}})}),define("DS/ENOXEngineer/commands/AssociateBrowsingStructureCmd",["DS/ENOXEngineer/services/XEngContextManager","DS/ApplicationFrame/Command","DS/ENOX3DSpaceAttributesMgt/services/loadModuleUtils","DS/ENOXEngineerCommonUtils/xEngAlertManager"],(e,t,n,i)=>{let r=null;return n.loadRuntimeLibrary("DS/TerminologySelector/commands/AssociateTerminologiesCommand").then(e=>{r=e}).catch(e=>{}),t.extend({execute(){if(!r)return i.errorAlert("Please check if the required media is installed"),this.end();this.cmd=this.initCmdFromBaseClass(r,this.options),this.cmd.begin()},initCmdFromBaseClass(t,n){if(!r)return null;return new(t.extend({getSelectedNodesFromContext:()=>Promise.resolve(e.get().getSelectedNodes()),getXSOFromContext:()=>e.get()?Promise.resolve(e.getXENTreeDocument().getXSO()):Promise.resolve()}))(n)},resetBaseClass(){r=null}})}),define("DS/ENOXEngineer/columnsProviders/ConfigurationDataProvider",["UWA/Core","UWA/Class","DS/ENOXEngineer/services/EngineeringSettings","DS/DocumentManagement/DocumentManagement","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/services/I18nManager","DS/ENOXEngineer/services/XEngContextManager","DS/ENOXEngineer/utils/XENHttpClient"],function(e,t,n,i,r,o,s,a){"use strict";return t.singleton({init:function(e){this._parent(e)},isAdditionalColumnsAvailable:function(t){if(!1===e.is(t,"function"))throw new Error("A callback function should be defined");t(!0)},getName:function(){return"Configuration"},getManagedColumnNames:function(){return["Configuration"]},toBeUpdated:function(e){var t=!0;return e&&e.Configuration&&(t=!1),t},getAdditionalColumnsUX:function(e){var t=e.findIndex(function(e){return"Configuration"===e.dataIndex});e.splice(t,t>=0?1:0,{text:o.get("Configuration"),dataIndex:"Configuration",maxWidth:800,minWidth:20,width:200})},updateAttributes:function(t,n){if(!Array.isArray(t.relids)||0===t.relids.length)return n({relids:{}});var i=s.getContext();if(!1===e.is(t,"object"))throw new Error("The object ids to modify must be specify");if(!1===e.is(n,"function"))throw new Error("A callback function should be defined");i._XENContentProxy.core.dataService.getStatticMappingPCInfo(t.relids).then(function(e){var i={};t.relids[0],t.relids.forEach(function(e){i[e=e]={Configuration:" ",ConfigurationID:" ",hasStaticMapping:" "}}),e&&t.relids.forEach(function(t){t&&"true"===e[t].hasStaticMapping&&(e[t].content.results[0].data.some(function(e){"Marketing Name"===e.name&&(i[t].Configuration=e.value[0])}),i[t].ConfigurationID=e[t].content.results[0].physicalID,i[t].hasStaticMapping=!0)}),n({relids:i})})}})}),define("DS/ENOXEngineer/commands/AssociateBrowsingNodeCmd",["DS/ENOXEngineer/services/XEngContextManager","DS/ApplicationFrame/Command","DS/ENOX3DSpaceAttributesMgt/services/loadModuleUtils","DS/ENOXEngineerCommonUtils/xEngAlertManager"],(e,t,n,i)=>{let r=null;return n.loadRuntimeLibrary("DS/TerminologySelector/commands/AssociateTermsCommand").then(e=>{r=e}).catch(e=>{}),t.extend({execute(){if(!r)return i.errorAlert("Please check if the required media is installed"),this.end();this.cmd=this.initCmdFromBaseClass(r,this.options),this.cmd.begin()},initCmdFromBaseClass(t,n){if(!r)return null;return new(t.extend({getSelectedNodesFromContext:()=>Promise.resolve(e.get().getSelectedNodes()),getXSOFromContext:()=>e.get()?Promise.resolve(e.getXENTreeDocument().getXSO()):Promise.resolve()}))(n)},resetBaseClass(){r=null}})}),define("DS/ENOXEngineer/commands/XEngineerCutCopyPaste",["UWA/Class","DS/ApplicationFrame/Command","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/utils/XEngineerConstants","DS/PlatformAPI/PlatformAPI","DS/ENOXEngineer/services/XEngLocalStorage","DS/ENOXEngineer/services/XEngContextManager","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n,i,r,o,s,a){"use strict";return t.extend({init:function(e){this._parent(e),console.info("#XEngineerCutCopyPaste: initialized...")},execute:function(e){"UPSAuthCut"===this.options.ID?this.cutEngItem(this.options.context):"UPSAuthCopy"===this.options.ID?this.copyEngItem(this.options.context):"UPSAuthPaste"===this.options.ID&&this.pasteEngItems(this.options.context),console.info("#XEngineerCutCopyPaste: "+this.options.ID+" execute called")},cutEngItem:function(e){this._setItemsInClipboard(e,["CX"])},copyEngItem:function(e){this._setItemsInClipboard(e,["CP"])},pasteEngItems:function(e){var t=this,l=o.getItem("clipboard");if(l&&0!=l.length){for(var c=l.startsWith("CX")?"CutPaste":"CopyPaste",d=[],u=[],p=(l=l.substring(3)).split(","),g=0;g<p.length;g++)u.push(p[g].split("|"));for(var h=0;h<u.length;h++){var m=u[h];d.push(m)}var f=d.map(function(e){return Array.isArray(e)&&e.length>2?e[1]:null}).filter(function(e){return null!==e});if(""==u[0])return o.removeItem("clipboard"),void n.errorAlert(a.get("clipboard_empty"));var E=this.options.context.getActiveEngItem().getContentModels().getSelectedNodes(),C=[];Array.isArray(E)&&E.length>=1&&E[0].getID()!==e.getActiveEngItem().getID()?E.forEach(function(e){C.push(e.getOccurrencePath()),E.push(e)}):C.push([e.getActiveEngItem().getID()]);var _={children:d,parents:C,mode:c,commit:!0};t.options.appCore.mediator.publish(i.EVENT_PASTE_DISABLE);t=this;require(["DS/UPSCommands/commands/UPSAuthCmdCutCopyPaste"],function(l){new l({context:s.getContext(),ID:"InsertExisting"}).execute({mode:c,internal_call:!0,data:_,onSuccess:function(s){if("CutPaste"===c&&(r.publish(i.EVENT_REMOVE_CUT_INSTANCES,f),o.removeItem("clipboard")),Array.isArray(s)){let i=t.options.context.getSelectedNodes();Array.isArray(i)&&i.length>=1&&i.forEach(function(e){e.expand()}),e.insertNodes({paste:s}),n.sucessAlert(a.get("paste_success"))}t.options.appCore.mediator.publish(i.EVENT_PASTE_ENABLE)},onFailure:function(e){t.options.appCore.mediator.publish(i.EVENT_PASTE_ENABLE),console.warn("Error trace:"+e.messages.toString()),n.errorAlert(a.get("paste_error"))}})})}else n.errorAlert(a.get("clipboard_empty"))},_setItemsInClipboard:function(e,t){var o=e.getSelectedNodes(),s=e.getActiveEngItem().getID();if(Array.isArray(o)){for(var l=0,c=0;c<o.length;c++)o[c].getType(),t.push(s+"|"+o[c].getRelationID()+"|"+o[c].getID());l>0&&n.errorAlert(a.get("eng.operation.ccp.unSupportedOperation"))}else t.push(o.getParent().getID()+"|"+o.getRelationID()+"|"+o.getID());r.publish(i.ADD_TO_CLIPBOARD,t.toString())}})}),define("DS/ENOXEngineer/commands/ReplaceInstantiatedConfigurationByRevisionCmd",["DS/CfgInstantiatedConfigurationCommands/commands/CfgReplaceInstantiatedConfigurationByRevisionCmd","DS/ENOXEngineer/services/XEngContextManager","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n){"use strict";return e.extend({getData:function(){return this.end(),t.getDataForCfgAnalysisCommands(n.CFG_INSTANTIATED_CONFIGURATION_COMMANDS)}})}),define("DS/ENOXEngineer/commands/BrowsingStructureMgmtCmd",["DS/ENOXEngineer/services/XEngContextManager","DS/ApplicationFrame/Command","DS/ENOX3DSpaceAttributesMgt/services/loadModuleUtils","DS/ENOXEngineerCommonUtils/xEngAlertManager"],(e,t,n,i)=>{let r=null;return n.loadRuntimeLibrary("DS/TerminologySelector/commands/TerminologyManagementCommand").then(e=>{r=e}).catch(e=>{}),t.extend({execute(){if(!r)return i.errorAlert("Please check if the required media is installed"),this.end();this.cmd=this.initCmdFromBaseClass(r,this.options),this.cmd.begin()},initCmdFromBaseClass(t,n){if(!r)return null;return new(t.extend({getSelectedNodesFromContext:()=>Promise.resolve(e.get().getSelectedNodes()),getXSOFromContext:()=>e.get()?Promise.resolve(e.getXENTreeDocument().getXSO()):Promise.resolve()}))(n)},resetBaseClass(){r=null}})}),define("DS/ENOXEngineer/commands/SelectByConfigurationCriteriaCmd",["DS/CfgAnalysisCommands/commands/CfgSelectByConfigurationCriteriaCmd","DS/ENOXEngineer/services/XEngContextManager","DS/CfgBaseUX/scripts/CfgUtility","DS/ENOXEngineerCommonUtils/xEngAlertManager","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n,i,r){"use strict";return e.extend({getData:function(){return this.end(),t.getDataForCfgAnalysisCommands()},getDescendantsData:function(){return t.getDescendantsDataForCfgAnalysisCommands()},selectInstances:function(e){if(t.get().getActiveEngItem().unselectAll(),null!=e&&null!=e.instances){for(var n=e.instances,o=0,s=0;s<n.length;s++){if("used"==n[s].status)t.get().getNodesById(e.instances[s].physicalID).forEach(function(e){e.select(),o++})}o>1?i.notifyAlert(o+" "+r.get("CfgSelectByConfigurationCriteriaCmdNLS.instances_Selected")):i.notifyAlert(o+" "+r.get("CfgSelectByConfigurationCriteriaCmdNLS.instance_Selected"))}},selectLeaves:function(e){var i=this;if(t.get().getActiveEngItem().unselectAll(),null!=e&&null!=e.occurrences){var o=e.occurrences;let t=0;for(var s=0;s<o.length;s++)"ErrorTooComplexExpression"==o[s].status&&t++;if(t>0){var a={primaryButton:"Yes",secondaryButton:"No",messageToDisplayOnDialog:r.get("CfgSelectByConfigurationCriteriaCmdNLS.StatusNotComputed")+t+r.get("CfgSelectByConfigurationCriteriaCmdNLS.WantToHighlight"),dontShowAgain:!1,targetBody:widget.body,primaryCallback:function(){i.highlightLeavesWithStatus(o,"ErrorTooComplexExpression")},secondaryCallback:function(){i.highlightLeavesWithStatus(o,"Valid")}};n.showUserChoiceDialog(a)}else i.highlightLeavesWithStatus(o,"Valid")}},highlightLeavesWithStatus:function(e,n){for(var o=0,s=0;s<e.length;s++)if(e[s].status==n){var a=e[s].pids.replaceAll("[","");a=(a=a.replaceAll("]","")).replaceAll(", ","/"),t.get().getNodesById(a)[0]&&(t.get().getNodesById(a)[0].select(),o++)}o>1?i.notifyAlert(o+" "+r.get("CfgSelectByConfigurationCriteriaCmdNLS.instances_Selected")):i.notifyAlert(o+" "+r.get("CfgSelectByConfigurationCriteriaCmdNLS.instance_Selected"))}})}),define("DS/ENOXEngineer/commands/XenNextGenFilterCmd",["DS/ENONextGenFilterCmd/commands/ENONextGenFilterCmd","DS/ENOXEngineer/services/XEngContextManager","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n,i){"use strict";return e.extend({init:function(e){var n=this;this.name=name,this.appCore=e.appCore,null===e.context?this.context=t.getContext():this.context=e.context,this._parent(e),n.context.getXENTreeDocument().getModelEvents().subscribe({event:"empty"},function(e){var t=n.appCore.contextManager.getActiveEngItem();UWA.is(n.removeFilter,"function")&&t&&UWA.is(t.getID,"function")&&n.context.getXENTreeDocument().getXENBIFilterProxy()&&n.context.getXENTreeDocument().getXENBIFilterProxy().resetNGFilterUI({widgetId:n.appCore.settingManager.getWidgetId(),rootIds:[t.getID()]})})},getWidgetId:function(){return this.options.appCore.settingManager.getWidgetId()},getAppParams:function(){return{widgetId:this.getWidgetId(),shareFilterSpec:!0,appId:this.getWidgetId()}},getSelectorManager:function(){return this.context.getXENTreeDocument().getCurrentTreeDocument().getXSO()||null},getRoots:function(){var e=[];return this.appCore.contextManager.getActiveEngItem()&&(e=[this.appCore.contextManager.getActiveEngItem()]),e.map(function(e){return{id:e.getID(),filtered:0,Label:e.getLabel()}})},getSelection:function(){var e={path:[],label:[]},t=[];if(this.appCore.contextManager.getSelectedNodes()&&(t=this.appCore.contextManager.getSelectedNodes()),t.forEach(function(t){e.path.push([t.getID()]),e.label.push([t.getLabel()])}),this.appCore.contextManager.getXENTreeDocument().getSelectedNodes()){var n=this.appCore.contextManager.getXENTreeDocument().getSelectedNodes();n.length>=1&&n[0].getID()!==t[0].getID()&&this.appCore.contextManager.getXENTreeDocument().getSelectedNodes().forEach(function(t){e.path.push(t.getOccurrencePath()),e.label.push([t.getLabel()])})}return e}})}),define("DS/ENOXEngineer/commands/AttachMultipleModels",["DS/CfgConfigurationCommands/commands/CfgEditConfigurationContextCmd","DS/ENOXEngineer/services/XEngContextManager"],function(e,t){"use strict";return e.extend({init:function(e){var t=e||{};this._parent(t,{mode:"exclusive",isAsynchronous:!0})},getData:function(){var e={selectedNodes:[]},n=t.getSelectedNodes();if(t.isRoot(n[0])){var i=t.getSelectedRealNodes();i.length&&n[0].getID()!=i[0].getID()&&(n=n.concat(i))}for(var r=0;r<n.length;r++){var o={id:n[r].getID(),alias:n[r].getLabel()};e.selectedNodes.push(o)}return e}})}),define("DS/ENOXEngineer/commands/XEngineerCommandBase",["DS/ApplicationFrame/Command","DS/ENOXEngineer/services/XEngContextManager","DS/ENOXEngineerCommonUtils/xEngAlertManager"],function(e,t,n){"use strict";return e.extend({init:function(e,i){this.name=i,this.appCore=e.appCore,this.alertManager=n,this.logger=this.appCore.logger.get(e.ID),this.nls=this.appCore.i18nManager,null===(e=e||{ID:"NO_ID"}).context?this.context=t.getContext():this.context=e.context,this._parent(e,{mode:"exclusive",isAsynchronous:!UWA.is(e.isAsynchronous)||e.isAsynchronous})},endExecute:function(){},execute:function(e){}})}),define("DS/ENOXEngineer/commands/UpdateWidgetTitleCmd",["DS/ENOXEngineer/commands/XEngineerCommandBase"],e=>{return e.extend({init(e){e=UWA.extend(e,{isAsynchronous:!1}),this._parent(e)},execute(){const e=this.context.getActiveEngItem();let t="";e&&UWA.is(e.getLabel,"function")&&(t=e.getLabel()),widget.setTitle(`${t}`)}})}),define("DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/Expand",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/ExpandLevelUtils"],(e,t)=>{return class extends e{constructor(e){super(e),t.initialize(this)}execute(){let e=1;this.context._app.core.contextManager.isActiveEngItemSelected()&&t.isServiceHitRequired()&&(e+=1),t.expandItemsByLevel(e.toString()),this.end()}}}),define("DS/ENOXEngineer/commands/EditConfigurationContextCmd",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/Search","DS/ENOXEngineer/componentsHelpers/commandModal/XEngineerModal","DS/ENOXEngineer/componentsHelpers/XEngAutoComplete/XEngAutoComplete","DS/ENOXEngineer/componentsHelpers/ModelChooser/XEngModelChooser","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/XEngineerConstants","DS/UIKIT/Spinner","DS/ENOXEngineer/utils/ResponseParser","DS/ENOXEngineerCommonUtils/xEngAlertManager"],function(e,t,n,i,r,o,s,a,l,c){"use strict";return e.extend({init:function(e){this._parent(e),this.search=new t({multiSel:!1}),this.nls=this.options.appCore.i18nManager,this.logger=this.options.appCore.logger},_buildModal:function(){return this.modal=new n({title:this.options.appCore.i18nManager.get("eng.ui.dialog.attachModel"),className:"xeng-auto-complete",withFooter:!0}),this.modal},_configModelVersionMapper:function(e){return{label:e["ds6w:label"]+" "+e["ds6wg:revision"],id:e.physicalid||e.resourceid,value:e.physicalid||e.resourceid,revision:e["ds6wg:revision"],name:e["ds6w:identifier"],attributes:{MarketingName:e["ds6w:label"]+" "+e["ds6wg:revision"]},icon:Array.isArray(e.icons)?e.icons[0]:e.type_icon_url}},_configModelMapper:function(e){return{label:e["ds6w:label"]+" "+e["ds6wg:revision"],value:e.physicalid||e.resourceid,icon:Array.isArray(e.icons)?e.icons[0]:e.type_icon_url}},_updateConfigurationContext:function(){var e=document.body.querySelector('button[name="okButton"]');this.spinner=(new a).inject(e).show(),e.disabled=!0;var t=this,n=t.autocomplete.selectedItems,i=n[0]?n[0].value:null;let r=t.context.getActiveEngItem();var o={id:i};i||(o=null),i?r.getAttachedConfigModels().forEach(function(e){var t=[];t.push(e.getAllModelVersions()),t[0].forEach(function(t){t.options.physicalid===i&&r.attachPreferedConfigModel(e)})}):(r.attachPreferedConfigModel(null),t.appCore.PreferencesManager.saveEngItemOpenPreferences(r)),e.disabled=!1,r._syncWithAttachedModelAndVersion(o).finally(function(){t.options.appCore.mediator.publish(s.EVENT_CONF_MODEL_UPDATED,r.getID())}),t.spinner.destroy(),t.destroyView()},destroyView:function(){this.autocomplete&&this.autocomplete.destroy(),this.autocomplete=void 0,this.modal.destroy(),this.modal=void 0},buildView:function(){var e=this;this._editionView().inject(this._buildModal().getBody()),this.modal.onValidate(function(t){e._updateConfigurationContext(t),e.end()},this),this.modal.onClose(function(){e.end()},this)},_editionView:function(){var e=this._getPrecondition();return this.autocomplete=new i({placeholder:this.options.appCore.i18nManager.get("eng.ui.autocomplete.placeholder"),multiSelect:!1,datasetName:"xeng_model",targetTypes:["Products"],appCore:this.options.appCore,precondition:e,objectMapper:this._configModelMapper.bind(this)}),this.autocomplete.onSearchClick=this.launchASearch.bind(this),this.autocomplete},_getPrecondition:function(){var e="",t=this.context.getActiveEngItem();if(!t)return"";var n=t.getAttachedConfigModels(),i=[];n.forEach(function(e){l.getListOfVersionsFromRoot(e.getModelVersion(),i)});var r=0;return i.length>0&&(i.forEach(function(t){e=0===r?'(physicalid:"'+t.physicalid+'"':e+' OR physicalid:"'+t.physicalid+'"',r++}),e+=")"),e},_setCommandMode:function(){var e=this.context.getActiveEngItem();e.isConfigured()&&e.getAttachedConfigModels().length>1?this.editMode=!1:this.editMode=!0},buildEditionView:function(){this.modal||this.buildView();var e=this.context.getActiveEngItem()&&this.context.getActiveEngItem().getPreferedAttachedConfigModel()?this.context.getActiveEngItem().getPreferedAttachedConfigModel():null,t=e?e.getPreferredVersion():null;if(e&&t&&t.id){var n={label:e.getCurrentVersionDisplayMarketingName(),value:t.id,icon:e.getIcon()};this.autocomplete.setSelection([n])}else this.autocomplete.reset();this.modal.show()},buildSelectionView:function(){var e=this.context.getActiveEngItem()&&this.context.getActiveEngItem().getPreferedAttachedConfigModel()?this.context.getActiveEngItem().getPreferedAttachedConfigModel():null,t=void 0;e&&(t=e.getPreferredVersion()?e.getPreferredVersion().id:void 0);var n={appCore:this.options.appCore,preferred:t,modelsPromises:this.context.getActiveEngItem().getAllAvailableVersionsPromises(),resolve:this._onModelChoosen.bind(this),reject:this._onModelUnChoosen.bind(this)};this.modelChooser=new r(n)},_onModelChoosen:function(e){var t=this;t.end();var n=this.context.getActiveEngItem();n.setPreferredModelById(e.options.modelId),n.getPreferedAttachedConfigModel()&&n.getPreferedAttachedConfigModel()._synchronizeModelVersions({id:e.options.physicalid}).finally(function(){t.options.appCore.mediator.publish(s.EVENT_CONF_MODEL_UPDATED,t.context.getActiveEngItem().getID())})},_onModelUnChoosen:function(e){this.end()},execute:async function(e){this.end();try{let e=this.context.getActiveEngItem();e||reject(new Error("error.noActiveEngineeringItem")),await this.setModelsandModelVersions();let n=e.getAttachedConfigModels();if(!n||!Array.isArray(n)||0===n.length)return void c.errorNotif({title:this.nls.get("no_model_attached"),subtitle:this.nls.get("attach.model")});var t;if(n.forEach(function(e){t||(t=!(e&&e.getAllModelVersions&&e.getAllModelVersions()&&0===e.getAllModelVersions().length))}),!t)return void c.errorNotif({title:this.nls.get("error.noVersion.relatedToModel"),subtitle:this.nls.get("attach.model.withVersion")});this.buildEditionView()}catch(e){this.logger.error(e),c.unexpectedFailure(this.nls.get("failure.setModelVersion.cmd.launch"))}},setModelsandModelVersions:function(){var e=this.context.getActiveEngItem(),t={pid:e.getID()},n=this;return o.wrappedWithPromise(function(i,r){n.options.appCore.dataService.getEngItemConfigurationInfo(t).then(function(t){e.attachConfigModels(t);var r=[];0!==t.length?t.length>0&&(t.forEach(function(e){r.push(e.loadVersions(e).then(function(t){var i=n.options.appCore.Factories.configItemsFactory.createModelVersionsFromRootVersion(t,e.getID());e.setAllModelVersions(i),l.getListOfVersionsFromRoot(t,modelRevisions)}))}),o.allSettled(r).then(function(){i()})):i()}).catch(function(e){n.alertManager.errorAlert(e.response.errorMessage),r(e),n.end()})})},launchASearch:function(e){var t=e;""===e.trim()&&(t=null);var n=this._getPrecondition();this.options.appCore.dataService.searchManager.launchASearch({title:this.options.appCore.i18nManager.get("eng.searchResult.configurationContext"),allowedTypes:["Products"],role:"",criteria:t,precondition:n,multiSel:!1,in_apps_callback:this.onSelectedFromSearch.bind(this)})},onSelectedFromSearch:function(e){var t=this.context.getActiveEngItem();t.getAttachedConfigModels().forEach(function(n){var i=[];i.push(n.getAllModelVersions()),i[0].forEach(function(i){i.options.physicalid===e[0].id&&(n.setPreferredVersion(e[0].id),t.attachPreferedConfigModel(n))})});var n=this._configModelVersionMapper(e[0]);n.label=this.unescapeString(n.label),this.autocomplete.setSelection([n])},unescapeString:function(e){if("string"==typeof e||e instanceof String){const t=new Map([["&","&amp;"],["<","&lt;"],[">","&gt;"],['"',"&quot;"],["'","&#x27;"]]);for(const[n,i]of t)e=e.replace(new RegExp(i,"g"),n)}return e}})}),define("DS/ENOXEngineer/commands/SetWorkUnderEvolutionPrefCmd",["UWA/Core","DS/UIKIT/Input/Toggle","UWA/Class/View","DS/ENOXEngineer/componentsHelpers/commandModal/XEngineerModal","DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n,i,r,o,s){"use strict";return r.extend({init:function(t){t=e.extend(t,{isAsynchronous:!1}),this._parent(t)},execute:function(e){var t=this,n=t.options.context.getActiveEngItem();n&&(!n.getPreferedAttachedConfigModel()||!n.getPreferedAttachedConfigModel().getPreferredVersion()||n.getPreferedAttachedConfigModel().getPreferredVersion().state!==s.MATURITY_MODEL_VERSION_RELEASE&&n.getPreferedAttachedConfigModel().getPreferredVersion().state!==s.MATURITY_MODEL_VERSION_OBSOLETE)&&n.hasValidConfigContext()&&t.options.context._app.core.dataService.getUserWorkUnderEvolDlgPref()!==s.VALUE_SET_WORKUNDER_NEVER?(t.activeEngItem=n,t.activeModel=t.activeEngItem.getPreferedAttachedConfigModel(),t.modelId=t.activeModel.getID(),t.modelName=t.activeModel.getLabel(),t.productId=t.activeModel.getCurrentVersionID(),t.productName=t.activeModel.getCurrentVersionName(),t.productTitle=t.activeModel.getCurrentVersionMarketingName(),t.productRevision=t.activeModel.getCurrentVersionRevision(),t.modelTitle=t.activeModel.getMarketingName(),t.options.context._app.core.dataService.getUserWorkUnderEvolDlgPref()===s.VALUE_SET_WORKUNDER_ALWAYS?(t.end(),t.options.context._app.core.dataService.applyWorkUnderEvolution(t.modelId,t.modelName,t.productId,t.productName,t.productRevision,t.modelTitle,t.productTitle).then(function(e){null!=e&&t.options.context._app.mediator.publish(s.EVENT_SET_WORKUNDER_EVOLUTION_COMPLETED,e)})):t._buildEvolutionPrefDialog()):t.end()},_buildEvolutionPrefDialog:function(){var e=this;e.end(),e.workunderPrefmodal=new i({title:e.options.appCore.i18nManager.get("workunder_evolution_pref"),className:"xeng-workunder-preference",withFooter:!0}),(new(e._getEvolutionPrefView())).render().inject(e.workunderPrefmodal.modal.elements.body),e.dontAskCheckbox=new t({type:"checkbox",value:e.options.appCore.i18nManager.get("checkbox_dontaskagain"),className:"primary",label:e.options.appCore.i18nManager.get("checkbox_dontaskagain"),events:{}}),e.dontAskCheckbox.inject(e.workunderPrefmodal.modal.elements.body),e.workunderPrefmodal.modal.getContent().getElements(".btn").forEach(function(t){"okButton"===t.name?(t.setText(e.options.appCore.i18nManager.get("label_yes")),t.addEvent("click",function(){e.dontAskCheckbox.isChecked()&&(e.options.context._app.core.dataService.setUserWorkUnderEvolDlgPref(s.VALUE_SET_WORKUNDER_ALWAYS),o.sucessAlert(e.options.appCore.i18nManager.get("eng.operation.setNoShowWorkUnderDlg.sucess")),e.options.context._app.mediator.publish(s.EVENT_NEVER_SHOW_WORKUNDER_DLG,s.VALUE_SET_WORKUNDER_ALWAYS)),e.options.context._app.core.dataService.applyWorkUnderEvolution(e.modelId,e.modelName,e.productId,e.productName,e.productRevision,e.modelTitle,e.productTitle).then(function(t){null!=t&&e.options.context._app.mediator.publish(s.EVENT_SET_WORKUNDER_EVOLUTION_COMPLETED,t),e.destroy()})})):"cancelButton"===t.name&&(t.setText(e.options.appCore.i18nManager.get("label_no")),t.addEvent("click",function(){e.dontAskCheckbox.isChecked()&&(e.options.context._app.core.dataService.setUserWorkUnderEvolDlgPref(s.VALUE_SET_WORKUNDER_NEVER),o.sucessAlert(e.options.appCore.i18nManager.get("eng.operation.setNoShowWorkUnderDlg.sucess")),e.options.context._app.mediator.publish(s.EVENT_NEVER_SHOW_WORKUNDER_DLG,s.VALUE_SET_WORKUNDER_NEVER)),e.destroy()}))}),e.options.context._app.core.dataService.getUserWorkUnderEvolDlgPref()===s.VALUE_ASK_WORKUNDER_EVERYTIME&&e.workunderPrefmodal.show()},destroy:function(){this.workunderPrefmodal&&this.workunderPrefmodal.destroy()},_getEvolutionPrefView:function(){var t=this;e.createElement("div",{html:"test",styles:{height:"600px",position:"relative"}});return t.workunderEvolDlgView=n.extend({name:"set-workunder-pref",render:function(){return t.textboxElement=e.createElement("div",{html:t.options.appCore.i18nManager.get("evolutionprefdlg.prefquestion").replace("{model}",t.productTitle).replace("{version}",t.productRevision).replace("{model}",t.productTitle).replace("{version}",t.productRevision),styles:{height:"auto",position:"relative",padding:"5px"}}),this.container.setContent(t.textboxElement),this}}),t.workunderEvolDlgView}})}),define("DS/ENOXEngineer/commands/ChangeMaturityBulkCmd",["UWA/Core","DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n){"use strict";return t.extend({init:function(e){this._parent(e)},execute:function(e){var t=this,i=this.options.context.getSelectedNodes(),r=null;i.length>=1&&(r=i[0]),t.options.expandPromise=new Promise(function(e,i){t.options.appCore.dataService.getEngItemStructure(r.getID(),null).then(function(i){var o=[];o.push(r),i.forEach(function(e){o.push(e)}),t.options.context._app.mediator.publish(n.EVENT_LAUNCH_COMMAND,{commandId:n.MATURITY_GRAPH_CMD,context:{item:o}}),e(i)}).catch(function(e){console.error(e),i(e)})})},destroy:function(){}})}),define("DS/ENOXEngineer/commands/AddExistingDocumentCmd",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager"],(e,t,n)=>{return class extends e{execute(e){try{this.parentNode=this.getParentNode(),e&&"dropped"===e.mode||this.launchDocumentSearchResult()}catch(e){return this.logger.error(e),this.alertManager.errorNotif({title:this.nls.get("failure.cmd.launch.addDoc")}),void this.cancel()}this.end()}getParentNode(){if(!this.context)throw new Error("context property is missing on the command");if(!this.context.getSelectedNodes)throw new Error("getSelectedNodes method is missing on the command context");const e=this.context.getSelectedNodes();if(!e||!Array.isArray(e))throw new Error("getSelectedNodes must return an array");if(!e.length||e.length>1)throw new Error("getSelectedNodes must contain one object");return e[0]}launchDocumentSearchResult(){this.appCore.dataService.searchManager.launchASearch({title:this.nls.get("eng.searchResult.InsertDocument"),allowedTypes:this.appCore.settingManager.getSetting("acceptedDocumentsRoots"),notAllowedTypes:this.appCore.settingManager.getSetting("unSupportedDocumentsRoots"),role:"",criteria:"",multiSel:!0,in_apps_callback:this.onSelectedFromSearch.bind(this)})}onSelectedFromSearch(e){let i=this.appCore.settingManager.getSetting("unSupportedDocumentsRoots");e.forEach(e=>{if(-1==i.indexOf(e[t.CONST_DS6W_TYPE]))this.appCore.dataService.attachDocumentToEngItem(this.parentNode,e.id,!0);else{let i=e[t.CONST_DS6W_TYPE];n.errorAlert(this.appCore.i18nManager.get("eng.unsupported.document").replace("{type}",i))}})}}}),define("DS/ENOXEngineer/commands/AddNewMaterialQuantityCmd",["UWA/Core","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/MaterialQuantityView","DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/services/MaterialAuthoringOperations","DS/ENOXEngineer/services/MaterialConstants","css!DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/css/ChangeQuantityView.css"],(e,t,n,i,r,o,s)=>{const{MaterialType:a}=s,{extractMatInfos:l}=o;return class extends n{constructor(e){super(e),this.material=null}execute(){const t=this.appCore.sessionManager.consummeAvailableMaterialForInsert();e.is(t)?(this.material=t,this.showView()):this.appCore.dataService.searchManager.launchASearch({title:this.appCore.i18nManager.get("eng.searchResult.InsertMaterial"),allowedTypes:[a.core],role:"",criteria:"",multiSel:!1,in_apps_callback:this.onSelectedFromSearch.bind(this)})}async onSelectedFromSearch(e){if(!Array.isArray(e)||1!==e.length)return console.error("unexpected selection"),this.abort();const{type:t}=await l(e[0]);if(t!==a.core)return console.error("unexpected selection"),this.abort();[this.material]=e,this.showView()}showView(){const n=(()=>e.is(this.material)?`${this.material["ds6w:label"]} ${this.material["ds6wg:revision"]}`:"")();widget.setValue(i.PREFERRED_DIMENSION,i.DIMENSION_VOLUME),new t(this.appCore,{title:this.options.appCore.i18nManager.get("eng.ui.dialog.selectMaterialQuantity").replace("{mat}",n),className:"new-material-quantity-dlg",withFooter:!0,onOk:this.onOk.bind(this),onCancel:this.onCancel.bind(this)})}onOk(e,t){"function"==typeof t&&t();const{value:n}=e;if(!n.trim().length||isNaN(n)||n<0)return console.warn("unexpected input value"),this.abort();this._createEngineeringItem(e)}onCancel(){this.end()}_lauchCreateCommand(){this.appCore.mediator.publish(i.EVENT_LAUNCH_COMMAND,{commandId:i.INSERT_NEW_ENG_ITEM,context:{isInsert:!0}})}abort(){const e=this.appCore.i18nManager.get("createQuantityFailed");r.unexpectedFailure(e),this.end()}_createEngineeringItem({value:e,dimension:t,unit:n}){const o={physicalid:this.material.id},s={name:t,value:e,unit:n};this.appCore.contextManager._postProcessEvent="AddNewMaterialQuantityCmd_setAdditionalInfo";const a=this.appCore.mediator.subscribe("AddNewMaterialQuantityCmd_setAdditionalInfo",async e=>{if(a&&(this.appCore.mediator.unsubscribe(a),this.appCore.contextManager._postProcess=!1,this.appCore.contextManager._postProcessEvent=""),!Array.isArray(e))return void this.abort();const t={items:[...new Set(e.map(e=>e.child))].map(e=>({materialref:o,quantity:s,reference:{physicalid:e}}))};try{await this.appCore.dataService.setQuantityOnMaterial(t),this.appCore.mediator.publish(i.EVENT_INSTANCES_CREATED,e)}catch(e){const t=this.appCore.i18nManager.get("createQuantityFailed");r.unexpectedFailure(t)}this.end()});this._lauchCreateCommand()}}}),define("DS/ENOXEngineer/commands/AddNewDocumentsCmd",["UWA/Core","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/commands/XEngineerCommandBase"],function(e,t,n){"use strict";return n.extend({execute:function(){if(this.appCore.PreferencesManager.isSpecInProductStructureEnabled()){var e=this.context.getSelectedNodes();Array.isArray(e)&&1===e.length&&this.appCore.dataService.addNewDocumentToEngItem({targetObjID:e[0].getID()}),this.end()}else t.errorAlert(this.appCore.i18nManager.get("error.dragdrop.specifications.failed"))}})}),define("DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/CollapseAll",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/ExpandLevelUtils"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e),t.initialize(this)},execute:function(){t.collapseChildren(),this.end()}})}),define("DS/ENOXEngineer/commands/OpenEngineeringItemCmd",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n,i){"use strict";return e.extend({init:function(e){this._parent(e),this.logger=this.appCore.logger.get("Engineering Release : Open")},execute:function(e){this.end();try{var n=this.appCore.sessionManager.consummeAvailableOpencontext();if(n.searchForOpen)this.appCore.dataService.searchManager.launchASearch({title:this.appCore.i18nManager.get("eng.searchResult.OpenEngItem"),allowedTypes:["VPMReference","ENOStrRefinementSpecification"],role:"",criteria:"",multiSel:!1,in_apps_callback:this.onSelectedFromSearch.bind(this)});else{if(!n.objectId||!n.objectType)throw new Error("invalid context");this.launchOpenItem(n)}}catch(e){this.logger.error(e.message),t.unexpectedFailure(this.nls.get("failure.open.cmd.launch"))}},onSelectedFromSearch:function(e){this.launchOpenItem({objectId:e[0].id,objectType:e[0]["ds6w:type_value"]})},launchOpenItem:function(e){if(e){var t=this;switch(e.objectType){case"ENOStrRefinementSpecification":this.openAdvancedFilter(e);break;default:if(e.itemListModel&&e.itemListModel.hasStaticMapping())e.path=[this.appCore.contextManager.getActiveEngItem().getID(),e.itemListModel.getRelationID(),e.objectId],this.appCore.dataService.getModelVersionInformationFromPCID([e.itemListModel.getConfigurationID()]).then(function(n){console.warn(n),n=t._getStaticMappingInfo(n),e.pcInfo=n,t.genericOpen(e)});else if(e.biProxyCtx){var n=this._getBIFilterProxy();n||t.genericOpen(e),n&&n.areRootsSharable([e.objectId],e.biProxyCtx).then(n=>{n&&Array.isArray(n)&&0!==n.length||t.genericOpen(e);const{rootId:i,hasFilter:r}=n[0];i===e.objectId&&r?t.openWithSharedFilter(e):t.genericOpen(e)}).catch(t=>{this.genericOpen(e)})}else this.genericOpen(e)}}},_getStaticMappingInfo:function(e){return Array.isArray(e)&&!e.length>0?null:{model:e[0].BASED_ON_MODEL_PID,modelVersion:e[0].BASED_ON_MODEL_VERSION_PID,prodConf:e[0].physicalid,confLabel:e[0]["ds6w:label"],type:e[0].type,resourceid:e[0].resourceid,revision:e[0]["ds6wg:revision"]}},_getBIFilterProxy:function(){var e=this.appCore.contextManager.getXENTreeDocument();return e?e.getXENBIFilterProxy():null},_previousFilterCleanup:function(){var e=this,t=this._getBIFilterProxy();return n.wrappedWithCancellablePromise(function(n,i){if(e.appCore.PersistencyManager.resetNGFilter(),e.appCore.sessionManager.isItemView())try{var r=e.context.getActiveEngItem();if(!r||!r.hasValidPersistedNextGenFilter()&&!r.hasValidTransientNextGenFilter())return n(!1);t.resetNGFilterUI({widgetId:e.appCore.settingManager.getWidgetId(),rootIds:e.context.getActiveEngItem()?[e.context.getActiveEngItem().getID()]:[]}),setTimeout(function(){n(!0)},100)}catch(e){console.error(e),i(!1)}else n(!0)})},openAdvancedFilter:function(e){var n=this._getBIFilterProxy(),r=this;n?r._previousFilterCleanup().catch(()=>{}).finally(function(){r.context.beginBlockingTransaction(r.appCore.i18nManager.get("processing.ngFilter")),r.appCore.mediator.publish(i.EVENT_CLEAR_TAGGER),r.wasCallbackCalled=!1,n.retrieveFilters({filterObjects:[{envId:r.appCore.settingManager.getPlatformId(),serviceId:"3DSpace",contextId:r.appCore.settingManager.getSecurityContext(),objectId:e.objectId,objectType:"ENOStrRefinementSpecification"}],droppedEnvId:r.appCore.settingManager.getPlatformId(),doNotFillTheTagger:!1,callback:function(e){if(r.wasCallbackCalled=!0,r.context.endBlockingTransaction(),e&&Array.isArray(e.success)&&e.success.length>0){let t=e.success[0],n={objectId:t.rootId,objectType:"VPMReference"};if(t.filterId){let e={filterId:t.filterId,filterName:t.filterTitle};n.filter=e,r.appCore.PersistencyManager.setNGFilter(e)}n.data=e,r.genericOpen(n)}else if(e&&Array.isArray(e.failure)&&e.failure.length>0){const{msg:n}=e.failure[0];let i=n||this.appCore.i18nManager.get("app.failure");t.errorNotif({title:this.appCore.i18nManager.get("failure.open.filter"),subtitle:i})}}}),setTimeout(function(){if(!r.wasCallbackCalled){if(r.wasCallbackCalled=!0,r.context.endBlockingTransaction(),r.appCore.sessionManager.isItemView()){var t=r.context.getActiveEngItem();if(t&&t.getID()===e.objectId)return void r.appCore.mediator.publish(i.EVENT_REFRESH_APP_CONTENT)}r.genericOpen(e)}},1e4)}):console.error("nextNenFilter proxy not found")},openWithSharedFilter:function(e){var t=this._getBIFilterProxy(),n=this;t?n._previousFilterCleanup().finally(function(){n.context.beginBlockingTransaction(n.appCore.i18nManager.get("processing.ngFilter")),n.wasCallbackCalled=!1,t.shareFilterSpec({fromRootId:e.objectId,fromSourceCtx:e.biProxyCtx,callback:function(t){if(n.wasCallbackCalled=!0,n.context.endBlockingTransaction(),t&&Array.isArray(t.success)&&t.success.length>0){let i=t.success[0];if(i.filterId){let e={filterId:i.filterId,filterName:i.filterTitle};n.appCore.PersistencyManager.setNGFilter(e)}n.appCore.sessionManager.setNGFilterContextForNextOpen(i),n.genericOpen(e)}}}),setTimeout(function(){if(!n.wasCallbackCalled){if(n.context.endBlockingTransaction(),n.appCore.sessionManager.isItemView()){var t=n.context.getActiveEngItem();if(t&&t.getID()===e.objectId)return void n.appCore.mediator.publish(i.EVENT_REFRESH_APP_CONTENT)}n.genericOpen(e)}},1e4)}):console.error("nextNenFilter proxy not found")},genericOpen:function(e){var n=this;if(n.appCore.sessionManager.isItemView()){var r=n.context.getActiveEngItem();if(r&&r.getID()===e.objectId)return void(e.data&&n.appCore.sessionManager.refreshWithDroppedFilter(e.data.success))}n.appCore.mediator.publish(i.EVENT_OPEN_ITEM_WITH_COMPASS,!0),n.appCore.mediator.publish(i.EVENT_FIND_IN_CONTEXT_CLOSE_DIALOG),this.appCore.dicoService.areEngeeringItems([e.objectType]).then(function(){e.path&&e.pcInfo?n.navigateToConfiguredEngItemViewer(e):e.filter?n.navigateToFilteredEngItemViewer(e):n.navigateToEngItemViewer(e)}).catch(function(e){t.errorAlert(n.appCore.i18nManager.get("trying.toopen.not.engineering.item"))})},navigateToEngItemViewer:function(e){this.appCore.navigate("engItem_View",{pid:e.objectId},{replace:!1,reload:!0})},navigateToFilteredEngItemViewer:function(e){this.appCore.navigate("engItem_View",{pid:e.objectId,filter:e.filter},{replace:!1,reload:!0})},navigateToConfiguredEngItemViewer:function(e){this.appCore.navigate("engItem_View",{pid:e.objectId,path:e.path,pcInfo:e.pcInfo},{replace:!1,reload:!0})}})}),define("DS/ENOXEngineer/commands/RelatedObjectsCmd",["DS/ENOXEngineer/commands/XEngineerCommandBase","UWA/Utils/InterCom","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/Utils"],function(e,t,n,i){"use strict";return e.extend({init:function(e){this._parent(e),console.log("#RelatedObjectsCmd: init called")},execute:function(e){var r=this;console.log("#RelatedObjectsCmd: execute called");var o=r.context.getSelectedNodes(),s=null;if(o.length>=1){var a=(s=o[0]).getID(),l=s.getType(),c=s.getDisplayName(),d=[];d.push({envId:r.appCore.settingManager.getPlatformId(),serviceId:n.SERVICE_3DSPACE_NAME,contextId:r.appCore.settingManager.getSecurityContext(),objectId:a,objectType:l,displayName:c});var u={protocol:n.NAME_3DXCONTEXT,version:"1.0",source:n.XENGINEER_APP_NAME,data:{items:d}},p={protocol:n.NAME_3DXCONTEXT,version:"1.0",source:n.XENGINEER_APP_NAME,appId:n.ENORIPE_APP_NAME,data:{items:d}},g=new t.Socket("compassPageSocket");g.subscribeServer("com.ds.compass",window.parent),g.dispatchEvent("onSetX3DContent",u,"compassPageSocket");g.addListener("launchApp",function(e){var t=s.getUuid(),o=i.createEvent(t,e);r.appCore.mediator.publishPlatformEvent(n.CROSS_APP_SELECTION_EVENT,o),console.log("Response = "+JSON.stringify(e))}),g.dispatchEvent("onLaunchApp",p,"compassPageSocket")}r.end()}})}),define("DS/ENOXEngineer/commands/AddExistingRawMaterialQuantityCmd",["UWA/Core","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/RawMaterialQuantityView","DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/services/MaterialAuthoringOperations","DS/ENOXEngineer/services/MaterialConstants","DS/ENOXEngineer/services/MaterialCVFetch","DS/ENOXEngineer/utils/XENHttpClient","css!DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/css/ChangeQuantityView.css"],(e,t,n,i,r,o,s,a,l)=>{const{MaterialType:c}=s,{extractMatInfos:d}=o,u="{parentId}";return class extends n{constructor(e){super(e),this.material=null}async execute(){const t=this.appCore.sessionManager.consummeAvailableMaterialForInsert();e.is(t)?await this.onSelectedFromSearch([t]):await this.appCore.dataService.searchManager.launchASearch({title:this.appCore.i18nManager.get("eng.searchResult.InsertMaterial"),allowedTypes:[c.raw],role:"",criteria:"",multiSel:!1,precondition:'NOT [current]:"OBSOLETE"',in_apps_callback:this.onSelectedFromSearch.bind(this)})}async onSelectedFromSearch(t){if(!Array.isArray(t)||1!==t.length)return console.error("unexpected selection"),this.abort();try{const{type:n}=await d(t[0]);if(n!==c.raw)return console.error("unexpected selection"),this.abort();if(this.material=e.clone(t[0]),!this.material["ds6wg:raw_material.v_dimensiontype"]){const e=this.appCore.settingManager.getCommand("cv_fetch"),n=null,i=t.map(e=>e.id),r={select_predicate:["ds6wg:raw_material.v_dimensiontype"]},o=await a.perform(e,{pids:i,requestData:r,nlsValues:n},{fcs_url_mode:"REDIRECT",label:this.appCore.settingManager.getCVRequestLabel(),locale:this.appCore.settingManager.getLanguage(),tenant:this.appCore.settingManager.getPlatformId()}),{results:s}=o||{},{attributes:l}=Array.isArray(s)?s[0]:{};if(Array.isArray(l)&&l.length){const e=l.find(e=>"ds6wg:raw_material.v_dimensiontype"===e.name);e&&"string"==typeof e.value&&e.value.trim().length&&(this.material["ds6wg:raw_material.v_dimensiontype"]=e.value)}}}catch(e){return this.abort()}this.showView()}showView(){widget.setValue(i.PREFERRED_DIMENSION,i.DIMENSION_VOLUME);const n=(()=>e.is(this.material)?`${this.material["ds6w:label"]} ${this.material["ds6wg:revision"]}`:"")(),r=(()=>e.is(this.material)?this.material["ds6wg:raw_material.v_dimensiontype"]||this.material["ds6wg:raw_material.v_dimensiontype_value"]:null)(),o="string"==typeof r&&r.trim().length?{enable:!1,selected:r.toUpperCase()}:null,s="string"==typeof r&&r.trim().length?{selected:(e=>{let t=null;switch(e.toUpperCase()){case i.DIMENSION_MASS:t=i.PREFERRED_MASS_UNIT;break;case i.DIMENSION_LENGTH:t=i.PREFERRED_LENGTH_UNIT;break;case i.DIMENSION_AREA:t=i.PREFERRED_AREA_UNIT;break;case i.DIMENSION_VOLUME:t=i.PREFERRED_VOLUME_UNIT}return t?widget.getValue(t):null})(r)}:null;new t(this.appCore,{title:this.options.appCore.i18nManager.get("eng.ui.dialog.selectMaterialQuantity").replace("{mat}",n),className:"new-material-quantity-dlg",withFooter:!0,onOk:this.onOk.bind(this),onCancel:this.onCancel.bind(this),dimToDisplayOptions:["VOLUME","MASS","AREA","LENGTH"],dimOptions:o,unitOptions:s})}onOk(e,t){"function"==typeof t&&t();const{value:n,asRequired:i}=e;if(!i&&(!n.trim().length||isNaN(n)||n<0))return console.warn("unexpected input value"),this.abort();this.createRawMaterialQuantity(e)}onCancel(){this.end()}abort(e){const t=e&&e.response&&"string"==typeof e.response.message&&e.response.message.trim().length?e.response.message:this.appCore.i18nManager.get("createQuantityFailed");r.errorAlert(t),this.end()}async createRawMaterialQuantity(t){const{value:n,dimension:o,unit:s,asRequired:a}=t||{},c=this.appCore.contextManager.getXENTreeDocument().getSelectedNodes();if(!Array.isArray(c)||1!==c.length)return this.abort;const[d]=c,p=d?d.getID():null;if(!p)return this.abort();try{const t=this.appCore.settingManager.getCommand("csrf_tocken_validation"),{csrf:c}=await l.perform(t,""),d=e.clone(this.appCore.settingManager.getCommand("addExistingRawMaterial"));d.url=d.url.replace(u,p);const g=s?this.appCore.dicoService.getUnits(o).find(e=>e.Name===s):null,h={childId:this.material.id,quantity:n,quantityUOM:g?g.Name:"",asRequired:a},m=await l.perform(d,h,c),{parentId:f,instanceId:E,childId:C}=m.instanceDetails,_=[{child:C,parent:f,instance:E}];this.appCore.sessionManager.setAuthoringMode("authoring"),r.sucessAlert(this.appCore.i18nManager.get("eng.operation.addExistingRawMaterial.sucess").replace("{rawMat}",this.material["ds6w:label"])),this.appCore.mediator.publish(i.EVENT_INSTANCES_CREATED,_)}catch(e){return console.debug(e),this.abort(e)}return this.end()}}}),define("DS/ENOXEngineer/commands/ExportDataGridCmd",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/Utils"],function(e,t,n){return e.extend({init:function(e){this._parent(e)},execute:function(){this.end();var e={fileName:this.appCore.contextManager.getActiveEngItem().getTitle(),fileType:".csv"};this.exportCSV(e)},exportCSV:function(e){var i=[],r=["thumbnail"],o=this.getOrderedVisibleColumns(),s={};if(this.appCore.dicoService.getUserDicoPreferences()&&this.appCore.dicoService.getUserDicoPreferences().customViewsInfo){var a=this.appCore.dicoService.getUserDicoPreferences().customViewsInfo.newColumnPinnedInfo;if(a)for(var l=0;l<a.length;l++)s[a[l].dataIndex]=a[l]}var c="",d="",u="",p=this.appCore.contextManager.getActiveEngItem(),g=this.appCore.settingManager.getIdCardSetting(t.COLUMN_PROVIDER_REFERENCE_ATTRIBUTES);for(l=0;l<o.length;l++)if(!(r.includes(o[l].dataIndex)||1!=o[l].visibleFlag&&(0==o[l].visibleFlag||s[o[l].dataIndex]&&0==s[o[l].dataIndex].visibleFlag))){switch(c+=o[l].text+",",u=p.getAttributeValue(o[l].dataIndex),o[l].dataIndex){case"tree":u=p.getAttributeValue("ds6w:label");break;case"level":u="0";break;case"ds6w:modified":case"ds6w:created":u=n.getDGVformatedDate(u);break;case"MEIColumn":u=u?u.tooltip:"";break;case"Alternate":u=u==t.CONST_YES?this.appCore.i18nManager.get("eng.export.true"):this.appCore.i18nManager.get("eng.export.false");break;case"v6_specdoc_to":u=u>0?this.appCore.i18nManager.get("eng.export.true"):this.appCore.i18nManager.get("eng.export.false");break;default:let e=this.appCore.dicoService.getAttributeMetas(o[l].dataIndex)?this.appCore.dicoService.getAttributeMetas(o[l].dataIndex).kind:"";if(e&&-1!==["datetime","timestamp"].indexOf(e.toLowerCase())){const e=p.getAttributeValue(o[l].dataIndex),t=n.convertDateNodeValueToCellValue(e);u=n.getDGVformatedDate(t)}!g.includes(o[l].dataIndex)||"Deformable"==o[l].dataIndex||u&&" "!=u&&""!=u||(u=this.appCore.i18nManager.get("None")),["#loading#","#failed#","#queued#"].includes(u)&&(u="")}d+=(u=u?'"'+u+'"':"")+",",i.push(o[l].dataIndex)}var h=this.appCore.contextManager._activeGridView?this.appCore.contextManager._activeGridView.getAsCSV({columnKeys:i,addLevelInformation:!0}):"";"\ufeff"==h.charAt()&&(h=h.substring(1));var m=this.appCore.i18nManager.get("label_level")+","+c+"\n,"+d+"\n\n"+h;this.appCore.exportService.downloadFile(e.fileName,m,e.fileType,!0,!0)},getOrderedVisibleColumns:function(){var e=[],t=this.appCore.contextManager._activeGridView.layout.getOrderedColumnsIndexes(),n=this.appCore.columnsManager.getDatagridViewColumns();if(n.length!=t.length)return n;for(var i=0;i<t.length;i++)e.push(n[t[i]]);return e}})}),define("DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/ExpandNLevel",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/ExpandLevelModal","DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/ExpandLevelUtils","DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/LevelSelector","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n,i,r){"use strict";return e.extend({init:function(e){this._parent(e),n.initialize(this)},execute:function(){this.buildLevelSelector(),this.end()},expandByNLevel:function(e){n.expandItemsByLevel(e)},buildLevelSelector:function(e){var n=this;this.levelSelectorModal=new t({target:widget.body,modalFlag:!0,resizableFlag:!1,closeButtonFlag:!1,titleBarVisibleFlag:!1,width:"auto",height:"auto",position:{my:"top right",at:"top right",offsetX:-50,offsetY:150},content:n.injectLevelSelectorComponent(),events:{onClickOutsideContent:function(){n.closeLevelSelector()}}})},injectLevelSelectorComponent:function(){var e=this;return this.levelSelectorContainer=new i({onLevelSelectorSet:function(t){e.context._app.core.contextManager.isActiveEngItemSelected()&&n.isServiceHitRequired()&&(t+=1),e.expandByNLevel(t.toString()),e.closeLevelSelector()},onLevelSelectorClose:function(){e.closeLevelSelector()}}),this.levelSelectorContainer.getContent()},closeLevelSelector:function(){this.levelSelectorModal&&this.levelSelectorModal.close()}})}),define("DS/ENOXEngineer/commands/AddNewSubTypeDocumentCmd",["UWA/Core","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/UIKIT/Input/Button","DS/Windows/ImmersiveFrame","DS/ENOXEngineerInfra/Mediator","DS/ENOXEngineer/services/XEngContextManager","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOX3DSpaceAttributesMgt/services/loadModuleUtils"],function(e,t,n,i,r,o,s,a,l){"use strict";return a.extend({execute:async function(){if(!this.appCore.PreferencesManager.isSpecInProductStructureEnabled())return void t.errorAlert(this.appCore.i18nManager.get("error.dragdrop.specifications.failed"));let e=null;try{e=await l.loadRuntimeLibrary("DS/DocumentCreateNew/CreateNew")}catch(e){return t.unexpectedFailure(this.nls.get("failure.addNewDocSubtype.cmd.launch")),void this.appCore.logger.error(e)}var n=this,i=o.getSelectedNodes()[0];new e({tenantUrl:this.appCore.settingManager.getDefault3DSpaceUrl(),securityContext:this.appCore.settingManager.getSecurityContext(),tenant:this.appCore.settingManager.getPlatformId(),immersiveFrame:this.appCore.moduleHelper.viewsService.getApplicationImmersiveFrame(),parentId:i.getID(),parentRelName:s.SPECIFICATION_DOCUMENT,getWorkUnderHeaders:function(){return n.appCore&&n.appCore.settingManager&&n.appCore.settingManager.getWorkUnderHeaders&&n.appCore.settingManager.getWorkUnderHeaders()},onUploadStart:function(e){},onCancel:function(){console.log("onCancel fired before upload starts")},onError:function(e){console.error(e),t.errorAlert(e.message)},onDocumentUpload:function(e){this.appCore.dataService.createDocumentOnSelectedType(e)}.bind(this)}).selectFilesAndCreate(),r.prototype.publish(s.EVENT_CLOSE_RUNNING_CMD)}})}),define("DS/ENOXEngineer/commands/CustomizeHeaderCmd",["UWA/Core","UWA/Class/Model","DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOX3DSpaceAttributesMgt/services/loadModuleUtils"],(e,t,n,i,r)=>{return n.extend({init:function(e){this._parent(e)},async execute(){const e=[];try{const t=await this.buildAndDisplayDialog();e.push(this.context._app.core.mediator.subscribe(i.EVENT_IDCARD_SAVED_ATTRIBUTES,e=>{const n=this.buildCustomizeHeaderAttributesFromEventData(e);t.modelEvents.publish({event:i.EVENT_IDCARD_CUSTOMIZE_ATTRIBUTES_MODIFICATION,data:{what:"customizeIDCard",customizeHeaderAttributes:n}}),this.context._app.core.mediator.publish(i.EVENT_UPDATE_IDCARD_RENDERING,!0)})),e.push(this.context._app.core.mediator.subscribe(i.EVENT_REFRESH_APP_CONTENT,()=>{t&&t.dialog&&t.dialog.close()})),await this.closeEvents(t)}catch(e){t&&t.dialog&&t.dialog.close()}finally{e.forEach(e=>this.context._app.core.mediator.unsubscribe(e)),this.end()}},buildCustomizeHeaderAttributesFromEventData(t){const n=[],r={};for(var o in t[i.IDCARD_SAVED_ATTRIBUTES])n.push(t[i.IDCARD_SAVED_ATTRIBUTES][o]);n.sort((e,t)=>e.order-t.order);var s=[],a=null;for(var l of n)a=e.clone(l.attribute),l.visibility&&(s.push(a),r[a.id]={displayWhenMinified:a.displayWhenMinified,id:a.id,visibility:a.visibility,order:l.order});return r},getDisplayAttributes(){const e=this.context._app.core.settingManager.getIdCardSetting(i.DEFAULT_IDCARD_DISPLAY_ATTRIBUTES);var t=this.context._app.core.dicoService.getVisibleAttrForBO();t=[...t,...this.context._app.core.dicoService.getVisibleAdditionalColumnReferenceAttributes()];const n=["ds6w:label","ds6wg:revision","ds6w:description"],r=[];return t.forEach(t=>{const{ds6w:i,kind:o}=t;n.includes(i)||r.push({name:this.context._app.core.i18nManager.get(i),id:i,kind:o,defaultVisibility:!!e[i],displayWhenMinified:!!e[i],visibility:!0})}),r},async buildAndDisplayDialog(){const e=await r.loadRuntimeLibrary("DS/ENOXIDCard/IDCardDisplayedAttributes/js/IDCardDisplayedAttributes");let n=this.context.getActiveEngItem(),i=this.context._app.core.dicoService.getIdCardPreferences()?this.context._app.core.dicoService.getIdCardPreferences():void 0,o={};const s={id:n.getID(),modelEvents:this.context._app.core.mediator.getApplicationBroker(),fullListAvailableAttributes:this.getDisplayAttributes()};let a=s.fullListAvailableAttributes;if(i){for(let e=0;e<a.length;e++){let t=null;t=i[a[e].id]?{displayWhenMinified:i[a[e].id].displayWhenMinified,defaultVisibility:a[e].defaultVisibility,id:i[a[e].id].id,name:a[e].name,kind:a[e].kind,visibility:a[e].visibility}:a[e],o[a[e].id]={attribute:t,order:i[a[e].id]&&i[a[e].id].order?i[a[e].id].order:null,visibility:!(!i[a[e].id]||!i[a[e].id].visibility)&&i[a[e].id].visibility}}s.savedAttributesList=o}const l=new e({model:new t(s)});return l.render(),l},closeEvents:async e=>new Promise(t=>{e&&e.dialog&&e.dialog.addEventListener("close",()=>{e.dialog.removeEventListener("close"),t()})})})}),define("DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/ExpandTaggerGroup",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/ExpandLevelUtils"],(e,t)=>{return class extends e{constructor(e){super(e),t.initialize(this)}execute(){const e=this.appCore.contextManager.getXENTreeDocument().getSelectedNodes(null,e=>Reflect.has(e,"isGroupFromExpand")&&e.isGroupFromExpand());Array.isArray(e)&&e.length&&(e.forEach(e=>e.expand()),this.end())}}}),define("DS/ENOXEngineer/commands/DeleteDocumentCmd",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/Search","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/utils/XEngineerConstants","UWA/Class/Promise","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n,i,r,o){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(e){this.end();var t=this.appCore.contextManager.getSelectedNodes();this.appCore.mediator.publish(i.EVENT_DELETE_DOCUMENT,{nodes:t})}})}),define("DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/ExpandAllLevel",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/ExpandLevelUtils","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e),t.initialize(this)},execute:function(){t.expandItemsByLevel(n.CONST_EXPAND_ALL_LEVEL),this.end()}})}),define("DS/ENOXEngineer/commands/ExportEngineeringItems",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/Handlebars/Handlebars4","DS/ENOXEngineer/componentsHelpers/commandModal/XEngineerModal","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/UIKIT/Input/Text","DS/Controls/LineEditor","DS/Controls/ComboBox","DS/Controls/Toggle","DS/Controls/Button","DS/DataGridView/DataGridView","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/componentsHelpers/xEngExport/js/ExportProgressDialog","DS/ENOXEngineer/utils/XEngineerConstants","text!DS/ENOXEngineer/componentsHelpers/xEngExport/html/ExportEngineeringItems.html","text!DS/ENOXEngineer/componentsHelpers/xEngExport/html/ExportEngineeringSettings.html","text!DS/ENOXEngineer/componentsHelpers/xEngExport/html/ExportEngineeringPreviewFormat.html","css!DS/ENOXEngineer/componentsHelpers/xEngExport/css/ExportEngineeringItems.css","css!DS/ENOXEngineer/componentsHelpers/xEngExport/css/ExportEngineeringSettings.css"],function(e,t,n,i,r,o,s,a,l,c,d,u,p,g,h,m,f,E){"use strict";var C,_,y,N="div",M="ul",A="li",I="span",v=3,S=["Quantity","thumbnail","v6_specdoc_to","rawMaterialQuantity","MEIColumn"],b=["ds6wg:MaterialUsageExtension.DeclaredQuantity","thumbnail","v6_specdoc_to","MEIColumn"],D=["Variant","Evolution","VariantEffectivity","ProjectedEvolutionEffectivity","Effectivity","CurrentEvolutionEffectivity","thumbnail","v6_specdoc_to","rawMaterialQuantity","MEIColumn"],T=["CoreMaterialName"],w={},O={};function x(){var e={settingsTemplate:!0,components:!0,groupBy:!0,advancedFilter:!0,fileName:!0};this._columnsOrderNlsJson={},this._xenColumnsArray=[],this._userPreferredColumns={},this.modalOptions={title:_.options.appCore.i18nManager.get("eng.export.label"),className:"set-exportCommand-modal",withFooter:!1},this.modal=new n(this.modalOptions),this.modal.injectFooter("<button type='button'  name='exportButton' id='export-button' class='btn btn-primary'>"+_.options.appCore.i18nManager.get("eng.export.button.export")+"</button> <button type='button' name='previewButton' id='preview-format-button' class='btn btn-default'>"+_.options.appCore.i18nManager.get("eng.export.button.previewFormat")+"</button><button type='button' name='cancelButton' id='cancel-button' class='btn btn-default'>"+_.options.appCore.i18nManager.get("eng.ui.button.cancel")+"</button>");var i=t.compile(m);this._options=e?UWA.clone(e,!1):{},this._container=this.modal.getBody(),this._container.innerHTML=i(this._options),this._container=this._container.querySelector(".enox-export"),this._settingsContainer=this._container.querySelector(".enox-export-settings-template-icon"),this._componentsHeader=this._container.querySelector(".enox-export-components-header"),this._directComponent=this._container.querySelector(".enox-export-components-direct"),this._finalItem=this._container.querySelector(".enox-export-components-qualified-as-final"),this._inculdeIntermediate=this._container.querySelector(".enox-export-components-include-intermediate"),this._groupByHeader=this._container.querySelector(".enox-export-groupby-header"),this._groupByCombobox=this._container.querySelector(".enox-export-groupby-combobox"),this._advancedFilterContainer=this._container.querySelector(".enox-export-advanced-apply-filter"),this._fileHeader=this._container.querySelector(".enox-export-file-name-header"),this._fileComponent=this._container.querySelector(".enox-export-file-name-component"),this._fileFormat=this._container.querySelector(".enox-export-file-format"),this.createSettingsIcon(),this.createLevelComponents(),this.createGroupBy(),this.createApplyFilters(),this.createFileName(),this._xenColumnsArray=this.getAvailableXENColumns()}return x.prototype={constructor:x,createSettingsIcon:function(){this._settingsContainer.title=_.options.appCore.i18nManager.get("eng.export.settingsTemplateDialogboxTitle")},createLevelComponents:function(){this._componentsHeader.innerHTML="<b>"+_.options.appCore.i18nManager.get("eng.export.components.label")+"&nbsp;:</b>",this._COMPONENT_DIRECT=new l({type:"radio",label:_.options.appCore.i18nManager.get("eng.export.components.direct"),value:"Direct",checkFlag:!0,domId:"direct-component"}).inject(this._directComponent),this._COMPONENT_FINALITEM=new l({type:"radio",label:_.options.appCore.i18nManager.get("eng.export.components.qualifiedAsFinal"),value:"QualifiedAsFinal",domId:"final-component"}).inject(this._finalItem),this._INCLUDE_INTERMEDIATE=new l({type:"checkbox",label:_.options.appCore.i18nManager.get("eng.export.components.includeIntermmediate"),value:"IncludeIntermediate",disabled:!0,domId:"include-intermediate-component"}).inject(this._inculdeIntermediate),this._COMPONENT_FINALITEM.addEventListener("click",function(){C._COMPONENT_DIRECT.checkFlag=!1,C._INCLUDE_INTERMEDIATE.disabled=!1}),this._COMPONENT_DIRECT.addEventListener("click",function(){C._INCLUDE_INTERMEDIATE.checkFlag=!1,C._INCLUDE_INTERMEDIATE.disabled=!0,C._COMPONENT_FINALITEM.checkFlag=!1})},createGroupBy:function(){this._groupByHeader.innerHTML="<b>"+_.options.appCore.i18nManager.get("eng.export.consolidation.label")+"&nbsp;:</b>";this._GroupByOptionsList=new a({elementsList:y,enableSearchFlag:!1,domId:"groupBy",width:150}),this._GroupByOptionsList.inject(this._groupByCombobox),this._GroupByOptionsList.elements.container.style.width="150px"},createApplyFilters:function(){var e=_.context&&_.context.getActiveEngItemOpenContext()&&_.context.getActiveEngItemOpenContext().filteringContext?_.context.getActiveEngItemOpenContext().filteringContext:"",t=!0,n=!1;""!=e&&"none"!=e&&(t=!1,n=!0),this._persistentFilterCheckbox=new l({type:"checkbox",label:_.options.appCore.i18nManager.get("eng.export.applyFilter.label"),value:e,checkFlag:n,disabled:t,domId:"advanced-filter"}).inject(this._advancedFilterContainer)},createCustomHeaderColumnSelections:function(){var e=this.getLoadedXENAttributes(),t={};this.isUserPreferredColumnsExists()&&(e=this.reArrangeToUserPreferredOrder(this._columnsOrder,e),t=this.getCachedUserPreferredColumns()),this._columnsOrder=[];var n=UWA.createElement(N);n.id="columns_with_list";var i=UWA.createElement(N);i.className="divTagForAllColumns",n.className="columnsHeader";var r=UWA.createElement(N);r.className="listitem_checkbox",n.appendChild(r);var o=UWA.createElement(N);o.className="listitem_header_name",n.appendChild(o);var s=UWA.createElement(N);s.className="listitem_custom_name",n.appendChild(s);var a=UWA.createElement(N);a.className="column_header_drag_drop",n.appendChild(a),this._selectAllCheckbox=new l({type:"checkbox",checkFlag:!0}),this._selectAllCheckbox.inject(r),o.innerHTML="<b>"+_.appCore.i18nManager.get("eng.export.column.header")+"</b>",s.innerHTML="<b>"+_.appCore.i18nManager.get("eng.export.column.customheader")+"</b>",this._exportTableContainer.appendChild(n),this._exportTableContainer.appendChild(i);for(var c={},d=0;d<e.length;d++){var u=UWA.createElement(N);u.className="columns";var p=!0,g="";this.isUserPreferredColumnsExists()&&(p=this.isColumnSelectionExists(e[d].dataIndex),g=t[e[d].dataIndex]);var h=new l({type:"checkbox",checkFlag:p,domId:"domId_"+e[d].dataIndex});c[e[d].dataIndex]=h;var m=UWA.createElement(N);m.className="listitem_checkbox","ds6w:label"==e[d].dataIndex?m.innerHTML='<span class="fonticon fonticon-block" title="'+_.options.appCore.i18nManager.get("eng.import.CkeckboxImageTooltip")+'"></span>':h.inject(m);var f=UWA.createElement(N);f.className="listitem_header_name hover_info",f.setText(e[d].text);var E=UWA.createElement(N);E.className="listitem_custom_name display_text enable_textbox",E.id=e[d].dataIndex+"_displayValue";var C=g||e[d].text;E.setText(C);var y=UWA.createElement(N);y.className="listitem_drag_drop wux-ui-hamburgers",y.id=e[d].dataIndex,y.draggable=!0,u.appendChild(m),u.appendChild(f),u.appendChild(E),u.appendChild(y),i.appendChild(u),this._columnsOrder.push(e[d].dataIndex),this._columnsOrderNlsJson[e[d].dataIndex+"_displayValue"]=e[d].text}this._columnsCheckboxJson=c,this.isUserPreferredColumnsExists()||this.unselectColumnsByDefault(T),this.validateSelectAllCheckBox()},createFileName:function(){this._fileFormat.innerHTML=".csv",this._fileHeader.innerHTML="<b>"+_.options.appCore.i18nManager.get("eng.export.fileName.label")+"&nbsp;:</b>",this._fileName=(new o).inject(this._fileComponent),this._fileName.elements.container.value=_.context.getActiveEngItem()._options.label},getActualAndCustomHeaderForSelectedColumns:function(){var e={},t=this.getCachedUserPreferredColumns();if(this.isUserPreferredColumnsExists()){for(var n=0;n<this._columnsOrder.length;n++)this._columnsCheckboxJson[this._columnsOrder[n]]&&this._columnsCheckboxJson[this._columnsOrder[n]].checkFlag&&(e[this._columnsOrder[n]]=t[this._columnsOrder[n]]);this.excludeNotSupportedColumns(e,this._GroupByOptionsList.value,this.isFlattendView())}else e=this.getDefaultColumns();return e},selectAllColumns:function(){for(var e in this._columnsCheckboxJson)this._columnsCheckboxJson[e].checkFlag=!0},unselectAllColumns:function(){for(var e in this._columnsCheckboxJson)"ds6w:label"!=e&&(this._columnsCheckboxJson[e].checkFlag=!1)},disableExportAndPreviewFormatButtons:function(){document.getElementById("export-button").disabled=!0,document.getElementById("preview-format-button").disabled=!0},enableExportAndPreviewFormatButtons:function(){document.getElementById("export-button").disabled=!1,document.getElementById("preview-format-button").disabled=!1},isAllColumnsSelected:function(){var e=!0;for(var t in this._columnsCheckboxJson)if(!this._columnsCheckboxJson[t].checkFlag){e=!1;break}return e},anyColumnSelected:function(){var e=!1;for(var t in this._columnsCheckboxJson)if(this._columnsCheckboxJson[t].checkFlag&&"ds6w:label"!=t){e=!0;break}return e},validateSelectAllCheckBox:function(){this.isAllColumnsSelected()?this._selectAllCheckbox.checkFlag=!0:this._selectAllCheckbox.checkFlag=!1},validateExportOptions:function(){var e=!0;return this._GroupByOptionsList.value==h.PART_NUMBER&&1==this._INCLUDE_INTERMEDIATE.checkFlag&&(u.errorAlert(_.appCore.i18nManager.get("eng.export.components.groupby.invalidselectionmessage")),e=!1),e},getUserSelectedExportOptions:function(){var e=this._fileName.elements.container.value;w.physicalid=_.context.getSelectedNodes()[0].getID(),w.Components=this._COMPONENT_DIRECT.checkFlag?this._COMPONENT_DIRECT.value:this._COMPONENT_FINALITEM.value,w.IncludeIntermediateComponent=this._INCLUDE_INTERMEDIATE.checkFlag,w.GroupingConsolidatedQuantity=this._GroupByOptionsList.value,w.Authored=!!this._COMPONENT_DIRECT.checkFlag&&_.appCore.sessionManager.isUsingDB(),w.PersistentFilter=this._persistentFilterCheckbox.checkFlag,w.PersistentFilterCriteria=_.context.getActiveEngItemOpenContext()?_.context.getActiveEngItemOpenContext():"",w.appendInstanceColumnKeyword=h.APPEND_INSTANCE_COLUMN_KEYWORD,w.preferredMassUnit=widget&&widget.getValue&&widget.getValue(h.PREFERRED_MASS_UNIT)?widget.getValue(h.PREFERRED_MASS_UNIT):"KILOGRAM",w.preferredMassUnitNLS=_.appCore.exportService.normalizeStringInNFKDFormat(_.appCore.PreferencesManager.getNLSValueForMassQuantity()),w.preferredVolumeUnit=widget&&widget.getValue&&widget.getValue(h.PREFERRED_VOLUME_UNIT)?widget.getValue(h.PREFERRED_VOLUME_UNIT):"METER3",w.preferredVolumeUnitNLS=_.appCore.exportService.normalizeStringInNFKDFormat(_.appCore.PreferencesManager.getNLSValueForVolumeQuantity()),w.ShowNotInBOM=widget&&widget.getValue&&widget.getValue(h.PREFERED_SHOW_NOT_IN_BOM)?widget.getValue(h.PREFERED_SHOW_NOT_IN_BOM)+"":"false",w.ExportFileName=null==e||""==e?_.context.getActiveEngItem()._options.label:this._fileName.elements.container.value;for(var t=this.getActualAndCustomHeaderForSelectedColumns(),n=widget.getPreferences(),i=0;i<n.length;i++)n[i].name==h.FINAL_ITEMS_PREF&&(w.PreferredFinalItem="tree"==widget.getPreferences()[i].value?"ds6w:label":widget.getPreferences()[i].value,w.PreferredFinalItemNLS=widget.getPreferences()[i].value===h.FINAL_ITEMS_DEFAULT?_.options.appCore.i18nManager.get("eng.export.NotSelectedFinalItem"):this.getTerminalItemNLSValue(widget.getPreferences()[i].value)),n[i].name===h.FINAL_ITEM_VALUE_NAME&&(w.PreferredFinalItemValue=widget.getPreferences()[i].value);return w.dimentionAttributeInfo=this.getDimentionalAttributesInfo(_.appCore.xengTreeDoc.getConvertissibleAttributes()),w.SelectedColumns=JSON.stringify(t),w.ParametricAttributes=_.appCore.exportService.getParametricalAttributesForExport("VPMReference"),w.ds6wAttributeMapping=this.actualAttributeNames,w},getDimentionalAttributesInfo:function(e){let t={};return Array.isArray(e)&&e.forEach(function(e){t[e.dataIndex]={dimension:e.attrDim,toUnit:e.attrUnit}}),t},getTerminalItemNLSValue:function(e){return _.appCore.dicoService.getAttributeMetas(e)?_.appCore.dicoService.getAttributeMetas(e).text:e},getPreviewFormatSelectedOptions:function(){O[_.options.appCore.i18nManager.get("eng.export.settingsTemplate.optionsHeader.exportedOnDate")]=p.getformatedDate(new Date),O[_.options.appCore.i18nManager.get("eng.export.components.label")]=this._COMPONENT_DIRECT.checkFlag?this._COMPONENT_DIRECT.label:this._COMPONENT_FINALITEM.label,O[_.options.appCore.i18nManager.get("eng.export.components.includeIntermmediate")]=this._INCLUDE_INTERMEDIATE.checkFlag?_.options.appCore.i18nManager.get("eng.export.true"):_.options.appCore.i18nManager.get("eng.export.false"),O[_.options.appCore.i18nManager.get("final_items_pref")]=this.getTerminalItemNLSValue(widget.getValue(h.FINAL_ITEMS_PREF)),O[_.options.appCore.i18nManager.get("final_item_value")]=widget.getValue(h.FINAL_ITEM_VALUE_NAME),O[_.options.appCore.i18nManager.get("eng.export.consolidation.label")]=this._GroupByOptionsList.label,O[_.options.appCore.i18nManager.get("eng.export.applyFilter.label")]=this._persistentFilterCheckbox.checkFlag?_.options.appCore.i18nManager.get("eng.export.true"):_.options.appCore.i18nManager.get("eng.export.false")},cacheUserPreferredColumns:function(){for(var e=0;e<this._columnsOrder.length;e++)this._columnsCheckboxJson[this._columnsOrder[e]]&&this._columnsCheckboxJson[this._columnsOrder[e]].checkFlag?this._userPreferredColumns[this._columnsOrder[e]]=document.getElementById(this._columnsOrder[e]+"_displayValue").getText():this._userPreferredColumns[this._columnsOrder[e]]&&delete this._userPreferredColumns[this._columnsOrder[e]]},getCachedUserPreferredColumns:function(){return this._userPreferredColumns},getAvailableXENColumns:function(){var e,t,n=JSON.stringify(_.appCore.columnsManager.getDatagridViewColumns()),i=JSON.parse(n);if(!this.isQuantityColumnExists(i)){var r={dataIndex:"quantity",text:_.appCore.i18nManager.get("label_Quantity")};i.length>6?i.splice(6,0,r):i.push(r)}if(i.find(function(n,i){"ds6wg:MaterialUsageExtension.DeclaredQuantity"===n.dataIndex?e=i:"quantity"===n.dataIndex?(n.dataIndex="Quantity",n.text=_.appCore.i18nManager.get("label_Quantity"),t=i):"ds6w:label-Instance"==n.dataIndex?n.dataIndex="InstanceName":"InstanceName"==n.dataIndex?n.text=_.appCore.i18nManager.get("label_Instance_Name"):"tree"==n.dataIndex?n.dataIndex="ds6w:label":n.dataIndex.includes("CoreMaterial")?n.dataIndex="CoreMaterialName":n.dataIndex.indexOf("ds6wg:DELFmiContQuantity_Mass.V_ContQuantity")>=0?n.text=_.appCore.exportService.normalizeStringInNFKDFormat(n.text):n.dataIndex.indexOf("ds6wg:DELFmiContQuantity_Volume.V_ContQuantity")>=0&&(n.text=_.appCore.exportService.normalizeStringInNFKDFormat(n.text))}),e){var o=i[t];i[t]=i[e],i[t+1]=o,i.splice(e,1)}var s=-1,a=_.appCore.i18nManager.get("Title");i.find(function(e,t){if(e&&e.text&&e.text===a)return s=t,t}),i.unshift(i[s]),i.splice(s+1,1),this.actualAttributeNames={};for(var l=["Alternate","Manufacturing","MadeFrom","occurence","CoveringMaterial","CoveringMaterialInstance","Configuration","ConfigurationRevision","rollup","Deformable","level",,"thumbnail","v6_specdoc_to","rawMaterialQuantity","MEIColumn"],c=[],d=0;d<i.length;d++)l.includes(i[d].dataIndex)?c.push(d):this.actualAttributeNames[i[d].dataIndex]=i[d].dataIndex;if(c.length>0)for(d=c.length;d>0;d--)i.splice(c[d-1],1);return i},isUserPreferredColumnsExists:function(){return Object.keys(this._userPreferredColumns).length>0},getDefaultColumns:function(){for(var e=this.getLoadedXENAttributes(),t={},n=0;n<e.length;n++)t[e[n].dataIndex]=e[n].text;return this.excludeNotSupportedColumns(t,this._GroupByOptionsList.value,this.isFlattendView()),this.excludeDefaultUnselectedColumns(t,T),t},excludeNotSupportedColumns:function(e,t,n){var i=[];if(t==h.NOT_GROUPED?i=S:t!=h.REFERENCE&&t!=h.PART_NUMBER||(i=b),this.removeColumnsFromUserSelection(i,e),n){if(i=D,e.Quantity){let t=e.Quantity.split("/");e.Quantity=t.length>1?t[1]:t[0]}}else if(e.Quantity){let t=e.Quantity.split("/");e.Quantity=t[0]}this.removeColumnsFromUserSelection(i,e)},excludeDefaultUnselectedColumns:function(e,t){this.removeColumnsFromUserSelection(t,e)},removeColumnsFromUserSelection:function(e,t){for(var n=0;n<e.length;n++)t[e[n]]&&delete t[e[n]]},unselectColumnsByDefault:function(e){for(var t=0;t<e.length;t++)this._columnsCheckboxJson[e[t]]&&(this._columnsCheckboxJson[e[t]].checkFlag=!1)},isQuantityColumnExists:function(e){for(var t=0;t<e.length;t++)if("quantity"==e[t].dataIndex)return!0;return!1},getLoadedXENAttributes:function(){return this._xenColumnsArray},isFlattendView:function(){return this._COMPONENT_FINALITEM.checkFlag},reArrangeToUserPreferredOrder:function(e,t){for(var n=[],i=0;i<e.length;i++){var r=this.columnExistsInAvailableAttributes(e[i],t);r>=0&&n.push(t[r])}return n},columnExistsInAvailableAttributes:function(e,t){for(var n=-1,i=0;i<t.length;i++)if(e==t[i].dataIndex)return n=i;return n},isColumnSelectionExists:function(e){return!!this.getCachedUserPreferredColumns()[e]}},e.extend({init:function(e){e=UWA.extend(e,{isAsynchronous:!1}),this._parent(e)},execute:function(){u.warningAlert(this.appCore.i18nManager.get("eng.export.deprecated")),_=this,this._exportFileDialog()},_exportFileDialog:function(e){var n=this;function o(e,t){for(var n=0,i=0;i<t.length;i++)if(t[i]==e){n=i;break}return n}y=[{labelItem:n.options.appCore.i18nManager.get("eng.export.notGrouped"),valueItem:h.NOT_GROUPED},{labelItem:n.options.appCore.i18nManager.get("eng.export.reference"),valueItem:h.REFERENCE},{labelItem:n.options.appCore.i18nManager.get("eng.export.partNumber"),valueItem:h.PART_NUMBER}],C=new x,w={ExportedOn:!0,ExportSettings:!0},C.modal.getContent().getElements(".btn").forEach(function(e){"cancelButton"===e.name?e.addEvent("click",function(){w={},C.modal.destroy()}):"previewButton"===e.name?e.addEvent("click",function(){C.validateExportOptions()&&n.appCore.dicoService.loadListOfParametricalAttributes().finally(function(){C.getUserSelectedExportOptions(),C.getPreviewFormatSelectedOptions(),function(){var e=new r;e.inject(C.modal.modal.elements.container);var o={exportSettings:!0,exportTable:!0},s=t.compile(E),a=o?UWA.clone(o,!1):{},l=document.createElement(N);l.innerHTML=s(a);l.querySelector(".enox-export-preview-format");var u=l.querySelector(".enox-export-preview-format-export-settings"),p=l.querySelector(".enox-export-preview-format-export-table"),g=UWA.createElement(M);for(var h in O){var m=UWA.createElement(A),f=UWA.createElement(I);f.style.fontWeight="bold",f.setText(h+" : ");var _=UWA.createElement(I);_.setText(O[h]),m.appendChild(f),m.appendChild(_),g.appendChild(m)}u.appendChild(g);var y=JSON.parse(w.SelectedColumns),v=[];(S={}).text=n.options.appCore.i18nManager.get("eng.export.preview.level"),S.dataIndex=n.options.appCore.i18nManager.get("eng.export.preview.level"),v.push(S);for(let e in y){var S={};S.text=y[e],S.dataIndex=e,v.push(S)}new d({columns:v,placeholder:"",defaultColumnDef:{width:"auto",typeRepresentation:"string"},onContextualEvent:function(e){return[]}}).inject(p).layout.rowsHeader=!1;var b=new i({title:n.options.appCore.i18nManager.get("eng.export.previewFormat.dialogbox.title"),content:l,width:1100,height:350,position:{at:"center",my:"center"},immersiveFrame:e,resizableFlag:!0,buttons:{Cancel:new c({label:n.options.appCore.i18nManager.get("eng.ui.button.cancel"),onClick:function(e){b.immersiveFrame.getModel().elements.container.destroy()}})}});b.elements._contentDiv.style.background="white",b.elements._contentDiv.style.display="block",b.addEventListener("close",function(e){b.immersiveFrame.getModel().elements.container.destroy()})}(),O={}})}):"exportButton"===e.name&&e.addEvent("click",function(){C.validateExportOptions()&&(n._progressDiag=new g({target:widget.body,title:n.appCore.i18nManager.get("eng.export.progressDialog.Title"),progressBar:{displayStyle:"normal",infiniteFlag:!0}}),n.appCore.dicoService.loadListOfParametricalAttributes().finally(function(){var e="Direct"===(w=C.getUserSelectedExportOptions()).Components?"1":"-1";C.disableExportAndPreviewFormatButtons(),n.appCore.contextManager.getActiveEngItem().isValidForExpandLevel(e).then(function(){n.appCore.exportService.downloadExportFile(w,"export_fetch",n._progressDiag),w={},C.modal.destroy()}).catch(function(e){u.errorAlert(n.appCore.i18nManager.get("eng.export.alert.largeExportdata")),C.enableExportAndPreviewFormatButtons(),n._progressDiag.close()})}))})}),C.modal.getContent().getElement(".enox-export-settings-template").addEvent("click",function(e){!function(){var e=new r;e.inject(C.modal.modal.elements.container);var a={columnsTable:!0},l=t.compile(f),d=a?UWA.clone(a,!1):{},u=document.createElement(N);u.className="enox-exports-settings-wrapper",u.innerHTML=l(d),C._exportTableContainer=u.querySelector(".enox-export-columns-table");var p,g=new i({title:n.options.appCore.i18nManager.get("eng.export.settingsTemplateDialogboxTitle"),content:u,immersiveFrame:e,width:500,buttons:{Cancel:new c({label:n.options.appCore.i18nManager.get("eng.ui.button.cancel"),onClick:function(e){g.immersiveFrame.getModel().elements.container.destroy()}}),Ok:new c({label:n.options.appCore.i18nManager.get("eng.ui.button.save"),onClick:function(e){C.anyColumnSelected()?C.enableExportAndPreviewFormatButtons():C.disableExportAndPreviewFormatButtons(),C.cacheUserPreferredColumns(),g.immersiveFrame.getModel().elements.container.destroy()}})}});g.addEventListener("close",function(e){g.immersiveFrame.getModel().elements.container.destroy()}),C.createCustomHeaderColumnSelections(),C._selectAllCheckbox.addEventListener("click",function(){var e=C._selectAllCheckbox.checkFlag;e?C.selectAllColumns():C.unselectAllColumns()}),g.getContent().getElements(".hover_info").forEach(function(e){e.addEvent("mouseover",function(e){var t=this.title;this.title=e.target.getText(),this.setAttribute("tooltip",t)})}),g.getContent().getElements(".display_text").forEach(function(e){e.addEvent("mouseenter",function(e){var t=document.body.getElementsByClassName("enable_textbox")[e.target.id],n=t.getText();t.empty(),p=new s({value:n,sizeInCharNumber:34,selectAllOnFocus:!0}).inject(t)})}),g.getContent().getElements(".display_text").forEach(function(e){e.addEvent("mouseleave",function(e){var t=document.body.getElementsByClassName("enable_textbox")[e.target.id],n=t.children;n.length>0&&(t.empty(n),""==p.valueToCommit||null==p.valueToCommit?t.setText(C._columnsOrderNlsJson[e.target.id]):(p.value=p.valueToCommit,t.setText(p.value)))})}),g.getContent().getElements(".listitem_checkbox").forEach(function(e){e.addEvent("click",function(e){C.validateSelectAllCheckBox()})}),g.getContent().getElements(".columns").forEach(function(e){e.addEvent("dragstart",function(e){e.dataTransfer.setData("Text",e.target.id)})}),g.getContent().getElements(".columns").forEach(function(e){e.addEvent("dragover",function(t){t.preventDefault(),t.stopPropagation(),e.getChildren()[v].addClassName("listitem_drag_drop_highlight")})}),g.getContent().getElements(".columns").forEach(function(e){e.addEvent("dragleave",function(t){t.preventDefault(),t.stopPropagation(),e.getChildren()[v].removeClassName("listitem_drag_drop_highlight")})}),g.getContent().getElements(".columns").forEach(function(e){e.addEvent("drop",function(t){t.preventDefault();var n=t.dataTransfer.getData("Text"),i=document.getElementById(t.target.id)?document.getElementById(t.target.id).parentNode:"",r=document.getElementById(n).parentNode,s=t.target.id;if(s.indexOf("_displayValue")<0&&""!=s){var a=!1,l=o(n,C._columnsOrder),c=o(t.target.id,C._columnsOrder);c-l==1&&(a=!0),a?r.parentNode.insertBefore(i,r):r.parentNode.insertBefore(r,i);for(var d=[],u=0;u<C._columnsOrder.length;u++)C._columnsOrder[u]!=n&&(C._columnsOrder[u]!=t.target.id?d.push(C._columnsOrder[u]):a?(d.push(C._columnsOrder[u]),d.push(n)):(d.push(n),d.push(C._columnsOrder[u])));C._columnsOrder=d}t.stopPropagation(),e.getChildren()[v].removeClassName("listitem_drag_drop_highlight")})})}()}),C.modal.modal.elements.header.getChildren()[0].addEvent("click",function(){w={},C.modal.destroy()}),C.modal.show()}})}),define("DS/ENOXEngineer/commands/OpenProduct",["DS/ENOXEngineer/commands/XEngineerCommandBase","UWA/Utils/InterCom","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/Utils"],function(e,t,n,i){"use strict";return e.extend({init:function(e){this._parent(e),console.log("#OpenEngItemCmd: init called")},execute:function(e){var r=this;console.log("#OpenEngItemCmd: execute called");var o=r.context.getSelectedNodes(),s=null;if(o.length>=1){var a=(s=o[0]).getID(),l=s.getType(),c=s.getDisplayName(),d=[];d.push({envId:r.appCore.settingManager.getPlatformId(),serviceId:n.SERVICE_3DSPACE_NAME,contextId:r.appCore.settingManager.getSecurityContext(),objectId:a,objectType:l,displayName:c});var u={protocol:n.NAME_3DXCONTEXT,version:"1.0",source:n.XENGINEER_APP_NAME,data:{items:d}},p={protocol:n.NAME_3DXCONTEXT,version:"1.0",source:n.XENGINEER_APP_NAME,appId:"ENXENG_AP",data:{items:d}},g=new t.Socket("compassPageSocket");g.subscribeServer("com.ds.compass",window.parent),g.dispatchEvent("onSetX3DContent",u,"compassPageSocket");g.addListener("launchApp",function(e){var t=s.getUuid(),o=i.createEvent(t,e);r.appCore.mediator.publishPlatformEvent(n.CROSS_APP_SELECTION_EVENT,o),console.log("Response = "+JSON.stringify(e))}),g.dispatchEvent("onLaunchApp",p,"compassPageSocket")}r.end()}})}),define("DS/ENOXEngineer/commands/AttributesManagementCmd",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOX3DSpaceAttributesMgt/views/AttributesCustomization","DS/ENOX3DSpaceAttributesMgt/views/AttributesContants","DS/Windows/Dialog","DS/Controls/Button","DS/ENOXEngineer/utils/Utils"],(e,t,n,i,r,o)=>{function s(e){if(e){if(!e.elements||!e.elements.container)return void(e=null);e.getContent()&&(e.content="")}}return class extends e{constructor(e){super(e),this.dialog=null,this.options.appCore.mediator.subscribe("ENXViews/Views/showInWidgetBody",e=>{if(console.warn(e),e&&e.restore)try{s(this.dialog),this.dialog&&this.dialog.close(),this.dialog=null}catch(e){console.error(e),this.dialog=null}else{try{s(this.dialog),this.dialog&&this.dialog.close(),this.dialog=null}catch(e){console.error(e),this.dialog=null}this.dialog=new i({title:"customize"===e.idView?this.options.appCore.i18nManager.get("label_attributesManagement"):this.options.appCore.i18nManager.get("label_attributesBrowser"),content:e.html,immersiveFrame:this.options.appCore.moduleHelper.viewsService.getApplicationImmersiveFrame(),resizableFlag:!0}),this.dialog.maximizedFlag=!0,this.dialog.maximizeButtonFlag=!1}})}execute(e){new t({settingManager:this.options.appCore.settingManager,modelEvents:this.options.appCore.mediator.getApplicationBroker(),viewMode:"comfortable",configuration:{providedColumns:[],selectedColumns:[]},toolbarActions:n.TOOLBAR_DEFAULT_ACTIONS,appColumns:this.options.appCore.columnsManager.getAvailableColumnsWithNls(),baseTypes:this.options.appCore.dicoService.getBaseReferenceTypes(),baseDocumentTypes:this.options.appCore.dicoService.getBaseDocumentTypes(),baseExtensions:this.options.appCore.dicoService.getBaseExtensions(),baseInstanceTypes:this.options.appCore.dicoService.getBaseInstanceTypes(),selectedTypes:this.options.appCore.dicoService.getSelectedTypes(),selectedExtensions:this.options.appCore.dicoService.getSelectedExtensions(),withDgv:!1,rowHeaderActivated:!0,predicatesManagedByApplication:this.options.appCore.dicoService.getControlledAppPredicates(),multiValuatedAttributes:this.options.appCore.dicoService.getMultiValuedAtributes()}),this.end()}}}),define("DS/ENOXEngineer/commands/RemoveRecentCmd",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/XEngineerConstants","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(e){var n=this;this.end();var i=this.appCore.contextManager.getSelectedNodes();if(Array.isArray(i)&&i.length>0){var r=i.map(function(e){return e.getID()});this.appCore.PreferencesManager.removeFromRecents(r).then(function(e){n.appCore.mediator.publish(t.EVENT_REMOVED_FROM_RECENT,{nodes:i})})}}})}),define("DS/ENOXEngineer/commands/SetProdConfCmd",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/Search","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/utils/ResponseParser","DS/ENOXEngineer/componentsHelpers/commandModal/XEngineerModal","DS/ENOXEngineer/componentsHelpers/XEngAutoComplete/XEngAutoComplete","DS/ENOXEngineer/componentsHelpers/ModelChooser/XEngModelChooser","DS/UIKIT/Input/Text","DS/UIKIT/Input/Toggle","UWA/Class/Promise","DS/UIKIT/Spinner","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n,i,r,o,s,a,l,c,d,u,p,g){"use strict";return e.extend({init:function(e){this._parent(e),this.search=new t({multiSel:!1}),this.nls=this.options.appCore.i18nManager,this.logger=this.options.appCore.logger},_buildModal:function(){return this.modal=new r({title:this.options.appCore.i18nManager.get("eng.ui.dialog.selectProdConf"),className:"xeng-auto-complete",withFooter:!0}),this.modal},_configModelMapper:function(e){return{label:e["ds6w:label"],value:e.physicalid||e.resourceid,icon:Array.isArray(e.icons)?e.icons[0]:e.type_icon_url}},_updateConfigurationContext:function(){var e=this,t=e.autocomplete.selectedItems,n=t[0]?t[0].value:null,i=e.context.getActiveEngItem().getPreferedAttachedConfigModel()&&e.context.getActiveEngItem().getPreferedAttachedConfigModel()?e.context.getActiveEngItem().getPreferedAttachedConfigModel():null;if(n===(i.getPreferredConfiguration()?i.getPreferredConfiguration().id:null))return e.destroyView(),null;i&&i.setPreferredConfiguration(n||"N/A").then(function(){e.options.appCore.mediator.publish(u.EVENT_CONF_MODEL_UPDATED,e.context.getActiveEngItem().getID()),e.alertManager.sucessAlert(g.get("eng.operation.prodConfUpdated.sucess")),e.destroyView()}).catch(function(t){e.logger.error(t),p.unexpectedFailure(e.nls.get("failure.setProdConf.cmd.launch")),e.destroyView()})},destroyView:function(){this.autocomplete&&this.autocomplete.destroy(),this.autocomplete=void 0,this.modal.destroy(),this.modal=void 0},buildView:function(){var e=this;this._getConfView().inject(this._buildModal().getBody()),this.modal.onValidate(function(t){e._updateConfigurationContext(t),e.end()},this),this.modal.onClose(function(){e.destroyView(),e.end()},this)},_getConfView:function(){return this.autocomplete=new o({placeholder:this.options.appCore.i18nManager.get("eng.ui.autocomplete.conf.placeholder"),multiSelect:!1,datasetName:"xeng_prodConf",precondition:this.getPrecondition()?this.getPrecondition():null,targetTypes:["Product Configuration"],appCore:this.options.appCore,objectMapper:this._configModelMapper.bind(this)}),this.autocomplete.onSearchClick=this.launchASearch.bind(this),this.autocomplete},execute:function(e){this.checkContext()?(this.displayProductConfigurationChooser(),this.end()):this.cancel()},checkContext:function(){try{if(this.activeEngItem=this.context.getActiveEngItem(),!this.activeEngItem)throw Error("getActiveEngItem must return an object")}catch(e){return console.log(e),p.errorNotif({title:"This command requires a configured product"}),!1}try{if(this.currentModel=this.activeEngItem.getPreferedAttachedConfigModel?this.activeEngItem.getPreferedAttachedConfigModel():null,!this.currentModel)throw Error("getPreferedAttachedConfigModel must return an object")}catch(e){return console.log(e),p.errorNotif({title:"This command requires a model version"}),!1}return!0},displayProductConfigurationChooser:function(){this.modal||this.buildView();let e=this.currentModel.getPreferredConfiguration&&this.currentModel.getPreferredConfiguration()?this.currentModel.getPreferredConfiguration():null;if(e){var t={label:e.marketingName?e.marketingName:e.name,value:e.id,icon:[]};this.autocomplete.setSelection([t])}this.modal.show()},getPrecondition:function(){var e=this.context.getActiveEngItem()&&this.context.getActiveEngItem().getPreferedAttachedConfigModel()?this.context.getActiveEngItem().getPreferedAttachedConfigModel():null;if(!e)return null;e.getID();return' [BASED_ON_MODEL_VERSION_PID]:"'+e.getCurrentVersionID()+'" '},launchASearch:function(e){var t=e,n=this.getPrecondition();""===e.trim()&&(t=null),this.options.appCore.dataService.searchManager.launchASearch({title:this.options.appCore.i18nManager.get("eng.searchResult.ConfigurationFilter"),allowedTypes:["Product Configuration"],role:"",criteria:t,precondition:n,multiSel:!1,in_apps_callback:this.onSelectedFromSearch.bind(this)})},onSelectedFromSearch:function(e){var t=this._configModelMapper(e[0]);this.autocomplete.setSelection([t])}})}),define("DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/CollapsedViewTaggerGroup",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/ExpandLevelUtils","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e),t.initialize(this)},execute:function(){this.appCore.mediator.publish(n.EVENT_TAGGER_GROUP_COLLAPSED),this.end()}})}),define("DS/ENOXEngineer/commands/EditPropertiesCmd",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/Search","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/models/EngItemGroupModel","DS/ENOXEngineer/utils/XEngineerConstants","DS/EditPropWidget/constants/EditPropConstants","UWA/Class/Promise","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n,i,r,o,s,a){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(e){var t=this;let i;switch(this.getId()){case"edit-materials":i="MaterialFacet";break;case"edit-properties-ref":i=o.FACET_PROPERTIES;break;case"edit-properties-inst":i=o.FACET_INSTANCE;break;case"edit-comments":i=o.FACET_SWYMCOMMENTS;break;case"edit-alternates":i="alternateFacet";break;case"edit-made-from":i="specsMadeFromFacet";break;case"edit-derived-output":i="derivedoutputs";break;case"edit-manufacturing":i="ManufactureIntent";break;case"edit-spec-doc":i=r.CONST_SPEC_FACET_NAME;break;case"edit-meiColumn":i="MEIFacet";break;default:i=this.getArguments()[0]}if(this.appCore){var s=this.appCore.contextManager.getSelectedNodes(),a=[];s.filter(function(e){return n.isNodeFromModel(e)}).forEach(function(e){var n=!1;"ENOStrRefinementSpecification"===e.getType()&&(n=!0),e.getRelationID&&e.getRelationID()&&!t.appCore.sessionManager.shouldShowQuantityView()&&!e.isDocument()?a.push({id:e.getRelationID(),metatype:"relationship",instrefid:e.getID(),readOnly:n}):a.push({id:e.getID(),metatype:"businessobject",readOnly:n})}),t.appCore.mediator.publish(r.EVENT_SHOW_PROPERTIES,{nodes:a,facet:i}),t.appCore.mediator.publish(r.EVENT_TRIPTYCH_SHOW_PANEL,"right"),this.end()}}})}),define("DS/ENOXEngineer/commands/DownloadDocumentCmd",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/Search","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/utils/XEngineerConstants","UWA/Class/Promise","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n,i,r,o){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(e){this.end();var t=this.appCore.contextManager.getSelectedNodes();this.appCore.mediator.publish(i.EVENT_DOWNLOAD_ITEM,{nodes:t})}})}),define("DS/ENOXEngineer/commands/DetachDocumentCmd",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/Search","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/utils/XEngineerConstants","UWA/Class/Promise","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n,i,r,o){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(e){this.end();var t=this.appCore.contextManager.getSelectedNodes();this.appCore.mediator.publish(i.EVENT_REMOVE_DOCUMENT,{nodes:t})}})}),define("DS/ENOXEngineer/collections/XEngGridTreeDocument",["DS/TreeModel/TreeDocument","DS/ENOXEngineer/models/EngItemModel","DS/ENOXEngineer/models/EngItemGroupModel","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineerCommonUtils/XENTracker","DS/Utilities/Utils","DS/ENOXEngineerCommonUtils/xEngAlertManager"],function(e,t,n,i,r,o,s,a){"use strict";return e.extend({useAsyncPreExpand:!0,defaultOptions:{nodeModelClass:t},init:function(e){var t=e||{};this.core=t.core||{},delete t.core,this._parent(t),this._getTrueRoot().options.appCore=this.core,this.getXSO().onPostAdd(this.selectionUpdated.bind(this)),this.getXSO().onPostRemove(this.selectionUpdated.bind(this)),this.onPreExpand(this._onPreExpand.bind(this)),this._xEngGroupedBy=[];var n=this;this.core.xengTreeDoc=this,this.onUpdate(this.onModelUpdateCB.bind(this));const r=this.core.contextManager.getXENTreeDocument()?this.core.contextManager.getXENTreeDocument().getFilterOptionsFromSessionManager():null;this._FilterBI=this.core.contextManager.getXENTreeDocument()?this.core.contextManager.getXENTreeDocument().getXENBIFilterProxy(r):null,this._FilterBI&&(this.subscribeToFilterBIProxyEvents(this._FilterBI),this.filterBIRemoveToken=this.core.mediator.subscribe("XENFilterBIProxy_remove",()=>{this._FilterBI&&this.unsubscribeToFilterBIProxyEvents(this._FilterBI)}),this.filterBIInitToken=this.core.mediator.subscribe("XENFilterBIProxy_init",e=>{this._FilterBI=e,this.subscribeToFilterBIProxyEvents(this._FilterBI)})),this.xHighlightToken=this.core.mediator.subscribePlatformEvent(i.CROSS_APP_SELECTION_EVENT,this.applyCrossHighlight.bind(this)),this.cleanBIFilterProxyToken=this.core.mediator.subscribe(i.EVENT_CLEAR_TAGGER,function(){n.cleanBIFilterProxy()})},onModelUpdateCB(e){r.startBulkMode("updateAttributes",this.core.mediator)},destroy(){this.filterBIInitToken&&(this.core.mediator.unsubscribe(this.filterBIInitToken),this.filterBIInitToken=null),this.filterBIRemoveToken&&(this.core.mediator.unsubscribe(this.filterBIRemoveToken),this.filterBIRemoveToken=null),this.unsubscribeToFilterBIProxyEvents(this._FilterBI),this._parent()},subscribeToFilterBIProxyEvents(e){e&&(e.addEvent("fetchFilterBIFilteringEvent",this.onFilterBIFilteringEvent.bind(this)),e.addEvent("fetchFilterBIColorizeEvent",this.onFetchFilterBIColorize.bind(this)),e.addEvent("FilterBIColorize",this.onFilterBIColorize.bind(this)),e.addEvent("FilterBIUnColorize",this.onFilterBIUnColorize.bind(this)))},unsubscribeToFilterBIProxyEvents(e){e&&(e.removeEvent("fetchFilterBIFilteringEvent"),e.removeEvent("fetchFilterBIColorizeEvent"),e.removeEvent("FilterBIColorize"),e.removeEvent("FilterBIUnColorize"))},onApplyNGFilter:function(){console.warn(" ########### from grid onApplyNGFilter")},getSelectedItemsCommonMenu:function(e){if(e)return this.core.sessionManager.isMyENGViewView()||this.core.sessionManager.isRecentItemViewView()?this.core.commandManager.showMenu(e,this.core.commandManager.getMenu("standaloneReference")):this.core.sessionManager.shouldShowFinalItems()||this.core.sessionManager.shouldShowMfgView()||this.core.sessionManager.shouldShowLeafMaterials()||this.core.sessionManager.shouldShowFlatView()?this.core.commandManager.showMenu(e,this.core.commandManager.getMenu("occurrence")):this.core.sessionManager.shouldShowQuantityView()?this.core.commandManager.showMenu(e,this.core.commandManager.getMenu("usedReference")):this.core.sessionManager.isItemView()?this.core.commandManager.showMenu(e,this.core.commandManager.getMenu("instance")):this.core.commandManager.showMenu(e,this.core.commandManager.getMenu("standaloneReference"))},_buildFilteredContent:function(e){console.error("_buildFilteredSession need to be overriden")},onSelectionUpdated:function(){},_onPreExpand:function(e){if(e.data.nodeModel._isFromOriginalModel()||e.data.nodeModel.options.useAsyncPreExpand){var t=e.data.nodeModel;this.core.contextManager.setPreExpandEvent(!0);const n=this.core.sessionManager.getCurrentViewOptions();if(o.trackCommandLaunched(i.EXPAND_CMD,n),t.options.childComputed)e.target.preExpandDone({preventExpandAll:!0});else try{this.prepareUpdate(),this.core.sessionManager.expandTheNodeOnEachLevel(this,t),this.core.sessionManager.setTargetNodeModel(t)}catch(e){}finally{this.pushUpdate(),e.target.preExpandDone({preventExpandAll:!0}),!0&&(t.options.childComputed=!0)}}else e.target.preExpandDone({})},getBIFilter:function(){return this._FilterBI},mergeContent:function(e,t){var n=this,i=!(!t||!t.onlyUpdateExistingNodes)&&t.onlyUpdateExistingNodes,r=t&&t.additionalIds?t.additionalIds:null;if(Array.isArray(e)&&e.length>0){var o={};try{n.getChildren().forEach(function(t,i){var r=e[0]instanceof n.core.Factories.ListItemFactory.getListInstanceClass(),s=e.findIndex(function(e){return r?e.getRelationID()===t.getRelationID():e.getID()===t.getID()});if(-1!==s){console.warn("merging the element at "+i);let r=t.isSelected();t.remove();let o=e[s];n.addChild(o,i),r&&o.select(),e.splice(s,1)}if(0===e.length)throw o}),e.forEach(function(e){console.warn('###########" adding content '),(!i||i&&r&&-1!==r.indexOf(e.getID()))&&n.addChild(e,0)})}catch(e){if(console.warn("no need to go throught all the element"),e!==o)throw e}}},findNodesByIds:function(e){let t=this.getAllDescendants();return t.forEach(e=>{e.getUsages&&Array.isArray(e.getUsages())&&e.getUsages().length>=1&&e.getUsages().forEach(e=>{t.push(e)})}),r.findNodesByIdsFromList(t,e)},findQtyOrInstNodeByIds:function(e){let t=this.getAllDescendants();return r.findQtyOrInstNodesByIdsFromList(t,e)},findNodesById:function(e){return this.findNodesByIds([e])},updateNodesWithChangeSet:function(e,t){(t&&t.length?t:this.getAllDescendants()).forEach(t=>{t.updateWithChangeSet(e)})},_getChildrenUnderRootItem:function(e,t){if(e&&(t===i.EVENT_TOOLBAR_SEARCH||e.isExpanded())&&e.getChildren()&&Array.isArray(e.getChildren()))for(var n=0;n<e.getChildren().length;n++){var r=e.getChildren()[n];this.nodes.push(r),this._getChildrenUnderRootItem(r)}},getAllTheExpanedNodes:function(e){this.nodes=[];var t=this.getRoots();if(t.length>0)for(var n=0;n<t.length;n++)this.nodes.push(t[n]),this._getChildrenUnderRootItem(t[n],e);return this.nodes},buildReferenceList:function(e,t){var i=[],r=t&&Array.isArray(t.getChildren())?t:this;return 0==(i=r.getChildren().filter(t=>t.getID&&t.getID()&&e.getID&&e.getID()&&t.getID()===e.getID())).length?this.getChildren().forEach(function(t){if(n=t.getChildren()){var n=n.filter(function(t){return t.getID()===e.getID()});i=i.concat(n)}}):1==i.length&&i[0]instanceof n&&(i=i[0].getChildren()),i},syncContent:function(e){var t=this.getChildren().length,n=this.core.PersistencyManager.getUserSelectedNodeIDs();this.empty(),this.addChild(e),this.core.PersistencyManager.saveUserSelectedNodeIDs(n),t!==e.length&&this.refreshTagger()},selectionUpdated:function(e){var t=this,n=this.getSelectedNodes()||[],o=!1;if(t.core.PersistencyManager.getWidgetRefreshStatus()){let n=t.core.PersistencyManager.getUserSelectedNodeIDs();if(Array.isArray(n)&&n.length>0){const i=e.filter(e=>!(e.isRoot()||!r.isNodeFromModel(e.getParent())||e.getParent().isGroupingNode));i.length&&i.forEach(e=>{let i=e.buildNodeId?e.buildNodeId():null;if(i){let e=n.filter(e=>e!=i);t.core.PersistencyManager.saveUserSelectedNodeIDs(e)}})}}else t.core.PersistencyManager.saveUserSelectedNodes(n);if(1==t.isViewGrouped()&&e.forEach(function(e){!e._isFromOriginalModel()&&e.getChildren()&&e.getChildren().length>0&&(e.isSelected()&&!e.areAllChildrenSelected()?(o=!0,e.selectAll()):e.isSelected()||e.areAllChildrenUnselected()||(o=!0,e.unselectAll()))}),!1===o){if(1==t.isViewGrouped())var s=n.filter(function(e){return r.isNodeFromModel(e)&&!e.isGroupingNode});else s=n;if("function"==typeof this.onSelectionUpdated&&this.onSelectionUpdated(s.length),0===s.length&&this.core.contextManager.getActiveEngItem()){var a=this.core.contextManager.getActiveEngItem();s.push(a),this.updateXHighlight(null)}else this.updateXHighlight(s);this.pushNodesToEditProperties(s)}t.core.mediator.publish(i.EVENT_OPEN_ITEM_WITH_COMPASS,!1)},applyCrossHighlight:function(e){if(!(e&&e.data&&Array.isArray(e.data.paths)&&e.data.paths.length&&this.getChildren()))return;if(e.metadata&&e.metadata.appid===this.core.settingManager.getAppId()+"_"+this.core.settingManager.getWidgetId())return;if(e.metadata&&e.metadata.origin&&("ENORIPE_Relations"===e.metadata.origin||"ENOSPEC_AP"===e.metadata.origin||"SNNavigationMap"===e.metadata.origin))return;if(e.data&&e.data.metadata&&"ENOLCMI_AP"===e.data.metadata.origin)return;var t={};e.data.paths.forEach(function(e){e.length>1&&(t[e[e.length-2]]=!0)});let n=[];e.data.paths.forEach(e=>{const t=e.join("/");n.push(t);let i=[];for(var r=0;r<e.length;r+=2)i.push(e[r]);const o=i.join("/");n.push(o)});const i=[];this.getAllDescendants().forEach(e=>{if(e._isFromOriginalModel()){const t=e.buildNodeId?e.buildNodeId():null;n.forEach(n=>{n&&(t===n||t.endsWith(n)||n.endsWith(t))&&i.push(e)})}}),this.notApplyXhightlight=!0,this.unselectAll(),i.length&&this.getXSO().add(i),this.notApplyXhightlight=!1},updateXHighlight:function(e){if(!this.notApplyXhightlight){var t={paths:[],version:"1.1"};if(e&&Array.isArray(e)){var n=[];e.forEach(function(e){e.isEngineeringItem()&&e.getUsages&&e.getUsages()?n=n.concat(e.getUsages()):n.push(e)});var o={};if(this.core&&this.core.contextManager.getActiveEngItem()){var s=this.core.contextManager.getActiveEngItem();o[s.getID()]={type:s.getType(),label:s.getLabel()}}t.attributes=n.reduce(function(e,t){return t&&(e[t.getID()]={type:t.getType(),label:t.getLabel()}),e},o),t.paths=n.map(function(e){let t=[];return e&&(t=e.isEngineeringItem()?e.getOccurrencePath():[e.getID()]),t});const i=this.core.settingManager.getAuthorizedChange();i&&(t.changeControl=i)}var a=r.createEvent((65536*(1+Math.random())|0).toString(16).substring(1),t);this.core.mediator.publishPlatformEvent(i.CROSS_APP_SELECTION_EVENT,a)}},pushNodesToEditProperties:function(e){var t=this;if(this.core){var n=e||this.getSelectedNodes(),r=[];n.forEach(function(e){var n=!1;"ENOStrRefinementSpecification"===e.getType()&&(n=!0),e.getRelationID&&e.getRelationID()&&!t.core.sessionManager.shouldShowQuantityView()&&!e.isDocument()?r.push({id:e.getRelationID(),metatype:"relationship",instrefid:e.getID(),readOnly:n}):r.push({id:e.getID(),metatype:"businessobject",readOnly:n})}),this.core.mediator.publish(i.EVENT_SHOW_PROPERTIES,{nodes:r})}},getAvailableAttributesForGrouping:function(){return this.core.dicoService.getVisibleAttributes().filter(function(e){return e.customisation&&e.customisation.layout&&e.customisation.layout.canBeGrouped})},_shouldAcceptDrop:function(){return!0},_shouldAcceptDrag:function(e,t){return console.error("drag"),!0},getNoTFilteredNodes:function(){return this.getChildren().filter(function(e){return e.shouldBeVisible()})},refreshTagger:function(){this.removeFromTagger(),this.pushToTagger()},removeFromTagger:function(e){if(this.core.mediator.unsubscribePlatformEvent(this.xHighlightToken),this.core.mediator.unsubscribe(this.cleanBIFilterProxyToken),this._FilterBI&&(this._FilterBI.removeEvent(),this._FilterBI.resetNGFilterUI({widgetId:this.core.settingManager.getWidgetId(),rootIds:Array.isArray(e)?e:void 0}),this._FilterBI.removeAllRoots(),this.core&&this.core.contextManager&&this.core.contextManager.getXENTreeDocument())){this.core.PersistencyManager.getWidgetRefreshStatus()||this.core.contextManager.getXENTreeDocument().resetXENBIFilterProxy()}},cleanBIFilterProxy:function(){this._FilterBI&&this._FilterBI.cleanProxy()},pushToTagger:function(){if(!this._FilterBI)return;const e=[];if(this._FilterBI.isExpandSyntesisActivated()){const t=this.core.contextManager.getActiveEngItem()?this.core.contextManager.getActiveEngItem().getID():null;t&&e.push(t)}else this.getAllTheExpanedNodes().forEach(t=>{t.getID()&&e.push(t.getID())});e.length&&(this._FilterBI.addRoots(e),this._colorizeState&&this._colorizeOptions&&(this._FilterBI.isExpandSyntesisActivated()?this.onFilterBIColorize(this._colorizeOptions):this.onFetchFilterBIColorize(this._colorizeOptions)))},onFetchFilterBIColorize:function(e){const t=r.getFetchTaggerColorMap(e);t&&Reflect.ownKeys(t).length&&(this.withTransactionUpdate(()=>{this.getAllTheExpanedNodes().forEach(e=>{t[e.getID()]&&e.setColor(t[e.getID()])})}),this._colorizeState=!0,this._colorizeOptions=e,this.core.mediator.publish(i.EVENT_COLORIZATION_UPDATED,this._colorizeState))},onFilterBIColorize:function(e){const t=r.getExpandTaggerColorMap(e);t&&Reflect.ownKeys(t).length&&(this.withTransactionUpdate(()=>{r.colorizeNodesFromExpandTagger(this.getAllTheExpanedNodes(),t,this.core.settingManager)}),this._colorizeState=!0,this._colorizeOptions=e,this.core.mediator.publish(i.EVENT_COLORIZATION_UPDATED,this._colorizeState))},isColorizeEnabled:function(){return this._colorizeState},onFilterBIUnColorize:function(){this.withTransactionUpdate(()=>{this.getAllTheExpanedNodes().forEach(e=>e.setColor(null))}),this._colorizeState=!1,this._colorizeOptions=null,this.core.mediator.publish(i.EVENT_COLORIZATION_UPDATED,this._colorizeState)},onFilterBIFilteringEvent:function(e){const{allfilters:t}=e||{},n=t&&Object.keys(t).length>0;this.prepareUpdate(),this.getAllTheExpanedNodes().forEach(t=>{if(n){const n=-1===e.matchingIDs.indexOf(t.getID());t.setTaggerFilterState(n)}else t.setTaggerFilterState(!1);t.applyFilters()}),this.pushUpdate(),this.onPostENOXFiltering()},onPostENOXFiltering:function(){this.core.mediator.publish(i.EVENT_NOTIFY_CONTENT_SIZE_CHANGE)},getAvailableAttributesToSort:function(){return[{id:"Title",text:this.core.i18nManager.get("ds6w:label"),type:"string"},{id:"Maturity",text:this.core.i18nManager.get("ds6w:status"),type:"string"},{id:"Owner",text:this.core.i18nManager.get("ds6w:responsible"),type:"string"},{id:"CreationDate",text:this.core.i18nManager.get("ds6w:created"),type:"string"},{id:"PartNumber",text:this.core.i18nManager.get("ds6wg:EnterpriseExtension.V_PartNumber"),type:"string"}]},_isProvided:function(e){return!0},groupNodes:function(e,t){const n=this.core.contextManager.getActiveEngItem(),i=n&&n.hasValidTransientGroupingContext();if(1===t.propertiesToGroup.length||0===t.propertiesToGroup.length){null==(o=t.propertiesToGroup[0])&&this.core.contextManager._activeGridView&&this.core.contextManager._activeGridView._groupingOptions&&(t.propertiesToGroup=this.core.contextManager._activeGridView._groupingOptions.dataIndexesToGroup,o=t.propertiesToGroup[0]);var r=this.core.dicoService.getVisibleAttributes();if(r&&Array.isArray(r)&&r.length>0)-1===r.map(function(e){return e.dataIndex}).indexOf(o)&&(t={propertiesToGroup:[]},o=void 0);i||this._parent(e,t),this._xEngGroupedBy=t.propertiesToGroup,this.core.PersistencyManager.setGroupByOption(o)}else{i||this._parent(e,{propertiesToGroup:[t.propertiesToGroup[0]]}),this._xEngGroupedBy=[t.propertiesToGroup[0]];var o=t.propertiesToGroup[0];this.core.PersistencyManager.setGroupByOption(o),a.errorAlert(this.core.i18nManager.get("error.single.level.grouping"))}},isViewGrouped:function(){return!(!Array.isArray(this._xEngGroupedBy)||0==this._xEngGroupedBy.length)},getViewGroupedByAttributes:function(e){return this._xEngGroupedBy}})}),define("DS/ENOXEngineer/models/EngItemListModel",["DS/ENOXEngineer/models/EngItemModel","DS/ENOXEngineerCommonUtils/PromiseUtils","UWA/Core"],function(e,t,n){"use strict";function i(t){this.options={instanceId:"",instanceMainAttribute:{name:"Effectivity",value:""},viewType:"instance",group:null},this.options=n.extend(this.options,t),e.call(this,this.options)}return i.prototype=Object.create(e.prototype),i.prototype.getEffectivity=function(){return this.options.instanceMainAttribute.value},i.prototype.completePath=function(e){return Array.isArray(e)?(e.push(this.getRelationID()),e.push(this.getID()),e):[]},i.prototype.getViewType=function(){return this.options.viewType},i.prototype.getUuid=function(){return this.getRelationID()},i.prototype.getRelationID=function(){return this.options.instanceId},i.prototype.getFirstLevelInstanceID=function(){return Array.isArray(this.getOccurrencePath())?this.getOccurrencePath()[1]:null},i.prototype.getOccurrencePath=function(){return this.options.occurrencePath},i.prototype.getDataPath=function(){var e=this.getOccurrencePath();if(e&&Array.isArray(e))return e;var t=[],n=this.getRelationID(),i=this.getID();return n&&t.push(n),i&&t.push(i),t},i.prototype.setOccurencePath=function(e){var t=e;t.push(this.options.instanceId),t.push(this.getID()),this.options.occurrencePath=t},i.prototype.setGroup=function(e){this.options.group=e},i.prototype.getGroup=function(){return this.options.group},i.prototype.getInstanceName=function(){return this.options.grid["ds6w:label-Instance"]},i.prototype.getInstanceEvolution=function(){return this.options.grid.CurrentEvolutionEffectivity},i.prototype.getInstanceVariant=function(){return this.options.grid.VariantEffectivity},i.prototype.getInstanceConfiguration=function(){return this.options.grid.Configuration},i.prototype.hasStaticMapping=function(){return this.options.grid.hasStaticMapping},i.prototype.getConfigurationID=function(){return this.options.grid.ConfigurationID},i.prototype.getInstanceType=function(){return this.options["ds6w:type-Instance"]},i.prototype.getInstanceTypeNLS=function(){return this.options.grid.instanceTypeNLS?this.options.grid.instanceTypeNLS:this.options.instanceType},i.prototype.isInstance=function(){var e=!0;return!0===this.isRepresentation()&&(e=!1),e},i.prototype.getMetaType=function(){var e=this;return t.wrappedWithPromise(function(t,n){e.options.appCore.dicoService.getMetaTypes([e.getType()],e instanceof e.options.appCore.Factories.ListItemFactory.getListInstanceClass()).then(function(e){return t(e[0])}).catch(function(e){return t("businessobject")})})},i.prototype.getUsedReference=function(){return this.isMaterialQuantity()?this.getCoreMaterials()[0]:this.options.appCore.Factories.ListItemFactory.listNodeToEngItem(this)},i.prototype.updateWithChangeSet=function(e){this.matchChangeSet(e)&&this.updateOptions(e.options)},i.prototype.getRelationType=function(){return this.options.instanceType},i}),define("DS/ENOXEngineer/commands/ChangeMaterialQuantityCmd",["UWA/Core","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/MaterialQuantityView","DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager","css!DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/css/ChangeQuantityView.css"],(e,t,n,i,r)=>{return class extends n{constructor(e){super(e),this._selectedItem=null}getQuantity(){return null}hasQuantity(){return null}get settings(){return null}showView(){const e=this.selectedItem.getAttributeValue("CoreMaterial"),n=this.selectedItem.getDisplayName(),r=this.getQuantity(this.selectedItem),{dimension:o,unit:s,title:a,dimToDisplayOptions:l}=this.settings,c=-1!==[i.PREFERRED_MASS_UNIT,i.PREFERRED_LENGTH_UNIT,i.PREFERRED_VOLUME_UNIT,i.PREFERRED_AREA_UNIT].indexOf(s)?widget.getValue(s):s;new t(this.appCore,{title:a||this.options.appCore.i18nManager.replace(this.options.appCore.i18nManager.get("eng.ui.dialog.changeMaterialQuantity"),{EngItem:n,mat:`${e} : ${r}`}),className:"change-material-quantity-dlg",withFooter:!0,onOk:this.onOk.bind(this),onCancel:this.onCancel.bind(this),dimOptions:{enable:!1,selected:o},unitOptions:{selected:c},inputOptions:{value:r},dimToDisplayOptions:l})}onOk(e,t){"function"==typeof t&&t();const{value:n}=e;(isNaN(n)||n<0)&&(console.warn("unexpected input value"),this.abort()),this._modifyEngineeringItem(e)}onCancel(){this.end()}abort(){const e=this.appCore.i18nManager.get("modifyQuantityFailed");r.errorAlert(e),this.end()}get selectedItem(){return this._selectedItem}async _modifyEngineeringItem({value:e,dimension:t,unit:n}){if(isNaN(e)||e<0)return void this.abort();const o=this.selectedItem.getID(),s={items:[{physicalid:o,quantity:{name:t,value:e,unit:n}}]};try{await this.appCore.dataService.modifyQuantityOnMaterial(s),this.appCore.mediator.publish(i.EVENT_REFRESH_ITEMS_BY_IDS,[o])}catch(e){let t="modifyQuantityFailed";if(Reflect.has(e,"response")){const{response:n}=e;if(Reflect.has(n,"internal")){const{internal:e}=n;switch(e){case"no right access":t="error.ERR_RightAccess"}}}r.errorAlert(this.appCore.i18nManager.get(t))}this.end()}execute(){const e=this.options.context.getSelectedNodes();if(!Array.isArray(e)||1!==e.length)return r.notifyAlert(this.appCore.i18nManager.get("eng.materialQuantity.notif.multiselection")),void this.end();[this._selectedItem]=e,this.hasQuantity(this._selectedItem)?this.showView():this.end()}}}),define("DS/ENOXEngineer/commands/ChangeMassQuantityCmd",["DS/ENOXEngineer/commands/ChangeMaterialQuantityCmd","UWA/Core","DS/ENOXEngineer/utils/XEngineerConstants"],(e,t,n)=>{return class extends e{getQuantity(e){return t.is(e)?e.getMassQuantity():null}hasQuantity(e){return!!t.is(e)&&e.hasMassQuantity()}get settings(){return{dimension:n.DIMENSION_MASS,unit:n.PREFERRED_MASS_UNIT}}}}),define("DS/ENOXEngineer/commands/ChangeRawQuantityCmd",["UWA/Core","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/RawMaterialQuantityView","DS/ENOXEngineer/commands/ChangeMaterialQuantityCmd","DS/ENOXEngineer/utils/XENHttpClient","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/services/MaterialCVFetch"],(e,t,n,i,r,o,s)=>{return class extends n{getQuantity(t){if(!e.is(t))return null;const n=this.selectedItem.getAttributeValue("rawMaterialQuantityAttributes"),{quantity:i}=n||{};return i}async showView(){const e=this.selectedItem.getDisplayName(),{quantity:n,asRequired:i}=this.selectedItem.getAttributeValue("rawMaterialQuantityAttributes")||{asRequired:!1},{dimension:o,unit:s,title:a,dimToDisplayOptions:l}=await this.getSettings(),c=-1!==[r.PREFERRED_MASS_UNIT,r.PREFERRED_LENGTH_UNIT,r.PREFERRED_VOLUME_UNIT,r.PREFERRED_AREA_UNIT].indexOf(s)?widget.getValue(s):s;new t(this.appCore,{title:a||this.options.appCore.i18nManager.replace(this.options.appCore.i18nManager.get("eng.ui.dialog.changeMaterialQuantity"),{EngItem:e,mat:`${e} : ${n}`}),className:"change-material-quantity-dlg",withFooter:!0,onOk:this.onOk.bind(this),onCancel:this.onCancel.bind(this),dimOptions:{enable:!1,selected:o},unitOptions:{selected:c},inputOptions:{value:n},asRequired:i,dimToDisplayOptions:l})}async retreiveDimensionAndUnit(){const{quantityType:e,quantityUOM:t}=this.selectedItem.getAttributeValue("rawMaterialQuantityAttributes")||{};let n=null,i=null;const o=t?t.dbName:"",a=["LENGTH","MASS","AREA","VOLUME"];if("string"==typeof o&&o.trim().length&&(n=a.find(e=>{const t=this.appCore.dicoService.getUnits(e);if(!Array.isArray(t))return!1;const n=t.findIndex(e=>e.Name===o);return-1!==n&&(i=t[n].Name),null!==i})),"string"!=typeof i||!i.trim().length){switch(e?e.dbName:""){case"DSDim_LENGTH":n="LENGTH";break;case"DSDim_MASS":n="MASS";break;case"DSDim_AREA":n="AREA";break;case"DSDim_VOLUME":n="VOLUME"}if("string"!=typeof n||!n.trim().length){const e=this.appCore.settingManager.getCommand("cv_fetch"),t=null,i=[this.selectedItem.getID()],r={select_predicate:["ds6wg:raw_material.v_dimensiontype"]},o=await s.perform(e,{pids:i,requestData:r,nlsValues:t},{fcs_url_mode:"REDIRECT",label:this.appCore.settingManager.getCVRequestLabel(),locale:this.appCore.settingManager.getLanguage(),tenant:this.appCore.settingManager.getPlatformId()}),{results:a}=o||{},{attributes:l}=Array.isArray(a)?a[0]:{};if(Array.isArray(l)&&l.length){const e=l.find(e=>"ds6wg:raw_material.v_dimensiontype"===e.name);e&&"string"==typeof e.value&&e.value.trim().length&&(n=e.value)}}i=(e=>{let t=null;switch(e.toUpperCase()){case r.DIMENSION_MASS:t=r.PREFERRED_MASS_UNIT;break;case r.DIMENSION_LENGTH:t=r.PREFERRED_LENGTH_UNIT;break;case r.DIMENSION_AREA:t=r.PREFERRED_AREA_UNIT;break;case r.DIMENSION_VOLUME:t=r.PREFERRED_VOLUME_UNIT}return t?widget.getValue(t):null})(n)}return{dimension:n.toUpperCase(),unit:{Name:i}}}hasQuantity(t){return!!e.is(t)&&t.isRawMaterialType()}get settings(){return this.asyncSettings}async getSettings(){const{dimension:e,unit:t}=await this.retreiveDimensionAndUnit()||{},n=this.options.appCore.i18nManager.replace(this.options.appCore.i18nManager.get("eng.ui.dialog.changeMaterialQuantity"),{EngItem:this.selectedItem.getInstanceName(),mat:`${this.selectedItem.getLabel()} : ${this.selectedItem.getAttributeValue(r.RAW_MATERIAL_QUANTITY)}`});return this.asyncSettings={title:n,dimension:e,unit:t?t.Name:"",dimToDisplayOptions:["VOLUME","MASS","AREA","LENGTH"]},this.asyncSettings}async _modifyEngineeringItem(t){const{value:n,unit:s,asRequired:a}=t||{};if(isNaN(n)||n<0)return void this.abort();const l=this.appCore.dicoService.getUnits(this.settings.dimension),c=s?l.find(e=>e.Name===s):null,d=this.selectedItem.getID(),u=this.selectedItem.getRelationID(),p=this.selectedItem.getOccurrencePath(),g=p.indexOf(u),h=p[g-1],m=e.clone(this.appCore.settingManager.getCommand("editRawMaterialInstance"));m.url=m.url.replace("{parentId}",h).replace("{relId}",u);const f={quantity:n,quantityUOM:c?c.Name:"",asRequired:a};try{const e=this.appCore.settingManager.getCommand("csrf_tocken_validation"),{csrf:t}=await i.perform(e,"");await i.perform(m,f,t),this.appCore.sessionManager.setAuthoringMode("authoring"),this.appCore.mediator.publish(r.EVENT_REFRESH_ITEMS_BY_IDS,[d])}catch(e){const t="modifyQuantityFailed";o.errorAlert(this.appCore.i18nManager.get(t))}finally{this.end()}}}}),define("DS/ENOXEngineer/commands/ChangeVolumeQuantityCmd",["DS/ENOXEngineer/commands/ChangeMaterialQuantityCmd","UWA/Core","DS/ENOXEngineer/utils/XEngineerConstants"],(e,t,n)=>{return class extends e{getQuantity(e){return t.is(e)?e.getVolumeQuantity():null}hasQuantity(e){return!!t.is(e)&&e.hasVolumeQuantity()}get settings(){return{dimension:n.DIMENSION_VOLUME,unit:n.PREFERRED_VOLUME_UNIT}}}}),define("DS/ENOXEngineer/componentsHelpers/mixins/XEngDnDManager",["DS/ENOXEngineer/utils/Utils","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/services/XEngContextManager","DS/ENOXEngineer/utils/XEngineerConstants","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n,i,r,o){"use strict";function s(e){this.container=e.container;if(!e.sandbox||e.droppable&&(!e.onDrop||!e.dropStrategy)||e.draggable&&!e.getSerializedContent)throw new Error("invalid parameter for XEngDnDManager constructor");this.sandbox=e.sandbox,e.droppable&&(this.onDrop=e.onDrop,this.dropStrategy=e.dropStrategy,this.invite=this.sandbox.core.moduleHelper.viewsService.getDnDInvite(),this.invite&&this.invite.hide(),this._makeDroppable()),e.draggable&&(this.getSerializedContent=e.getSerializedContent,this._makeDraggable())}return s.prototype.dropValidator=function(e){var t=this;if("OPEN"!==this.dropStrategy&&this.sandbox.sessionManager.getFlatViewOption()!==r.DIRECT_CMD)return void n.errorNotif({title:this.sandbox.i18nManager.get("failure.insert.drop"),subtitle:this.sandbox.i18nManager.get("error.insert.drop.view"),message:this.sandbox.i18nManager.get("drop.insert.view.direct")});if("OPEN"!==this.dropStrategy&&this.sandbox.sessionManager.shouldShowMfgView())return void n.errorNotif({title:this.sandbox.i18nManager.get("failure.insert.drop"),subtitle:this.sandbox.i18nManager.get("error.insert.drop.view"),message:this.sandbox.i18nManager.get("drop.insert.view.noManuf")});let i;try{i=JSON.parse(e)}catch(e){return console.log(e),void n.errorNotif({title:this.sandbox.i18nManager.get("error.parse.droppeddata.failed"),subtitle:this.sandbox.i18nManager.get("drop.valid.data")})}t.validateByStrategy(i).then(function(e){t.onDrop(e)}).catch(function(e){console.log(e);let t="OPEN"!==this.dropStrategy?this.sandbox.i18nManager.get("failure.insert.drop"):this.sandbox.i18nManager.get("failure.open.drop");n.unexpectedFailure(t)})},s.prototype.validateByStrategy=function(e){switch(this.dropStrategy){case"OPEN":return this.sandbox.core.settingManager.retrieveValidItemsForOpenFromDrop(e);case"BOM":return this.sandbox.core.settingManager.retrieveAllValidContentForXENFromDrop(e);case"DOC":return this.sandbox.core.settingManager.retrieveAllValidDocumentsFromDrop(e);default:throw new Error("no drop strategy")}},s.prototype.getOnDropLabel=function(){switch(this.dropStrategy){case"OPEN":return"drop";default:return"insert"}},s.prototype.destroy=function(){e.cleanDroppable(this.container),this.container=null,this.sandbox=null,this.invite=null},s.prototype._makeDraggable=function(){e.makeDraggable(this.container,{data:this.getSerializedContent(),start:function(e,t){i.dragStartedInXENG=!0,console.log("##drag start")},stop:function(e){i.dragStartedInXENG=!1,console.log("###drag end")}})},s.prototype._makeDroppable=function(){var t=this;e.makeDroppable({element:t.container,context:this,onDragEnter:function(){!0!==i.dragStartedInXENG?(t.invite.addBorder(),t.setDnDInviteVisibility(!0)):t.container.removeClassName("dragging")},onDragLeave:function(){t.setDnDInviteVisibility(!1)},onDragOver:function(){!0!==i.dragStartedInXENG&&t.setDnDInviteVisibility(!0)},onDrop:function(e,n){!0!==i.dragStartedInXENG&&(t.setDnDInviteVisibility(!1),t.dropValidator(e))}})},s.prototype.setDnDInviteVisibility=function(e){e?(this.invite.show(this.getOnDropLabel()),this.container.hasClassName("dragging")||this.container.addClassName("dragging")):(this.invite.hide(),this.container.hasClassName("dragging")&&this.container.removeClassName("dragging"))},s.prototype.ignoreDroppedSpecifications=function(e){var t=!1;e.data.items=e.data.items.filter(e=>{if("Document"!=e.objectType)return e;t=!0}),t&&n.errorAlert(this.sandbox.i18nManager.get("error.dragdrop.specifications.failed"))},s}),define("DS/ENOXEngineer/services/ViewsService",["UWA/Core","UWA/Class","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/UIKIT/Input/Button","DS/Windows/ImmersiveFrame","DS/ENOXEngineer/componentsHelpers/InviteDnD/DnDInvite","DS/ENOXEngineer/componentsHelpers/mixins/XEngDnDManager","DS/ENOXEngineer/utils/XEngineerConstants","require"],function(e,t,n,i,r,o,s,a,l){"use strict";var c=null;function d(e){e.registerDnDManager=function(e){if(e){var t=(65536*(1+Math.random())|0).toString(16).substring(1);return Array.isArray(this._DnDManagers)||(this._DnDManagers=[]),this._DnDManagers.push({token:t,manager:new s(e)}),t}}}return t.singleton({init:function(e){this._parent(e)},initialize:function(e){this.logger=e.core.logger.get("emptyview manager"),this.app=e,e.core.moduleHelper.viewsService=this,this.immersiveFrame=null,e.optionalStartupPromises.push(this._temporaryLoadEmptyView()),d(e.sandboxBase)},_temporaryLoadEmptyView:function(){return n.wrappedWithPromise(function(e,t){l(["DS/ENOXEmptyContent/js/ENOXEmptyContent"],function(t){c=t,e(!0)},function(e){t(e)})})},getApplicationImmersiveFrame:function(){return this.immersiveFrame||(this.immersiveFrame=new r({identifier:"XENImmersiveFrame"})),this.immersiveFrame},getGridOptions:function(e){var t=null,n=this,r="eng.ui.start.byCreate.content",o="DropInvit_drop";switch(e){case a.CONST_EMPTY_DGV_TILE_VIEW:r="add_new_engineering_item",o="DropInvit_insert";default:var s=new i({value:this.app.core.i18nManager.get(r),className:"primary"});t={sentences:[{type:"drop",text:this.app.core.i18nManager.get(o)},{type:"dom",DOMelement:s.getContent(),events:{onclick:function(){let e=n.app.core.PreferencesManager.isUserSelectedTypeChooserOption()?a.CREATE_NEW_CONTENT:a.CREATE_NEW_ENG_ITEM;n.app.core.mediator.publish(a.EVENT_LAUNCH_COMMAND,{commandId:e})}}}],fontSize:"16px",orderedListType:"none",modelEvents:this.app.core.mediator.getApplicationBroker()}}return t},getGridEmptyView:function(e){return this._instanciateEmptyViewer(this.getGridOptions(e))},_instanciateEmptyViewer:function(e){return new c(e)},getDnDInvite:function(){return this.invite||(this.invite=new o({renderTo:widget.body})),this.invite}})}),define("DS/ENOXEngineer/services/XEngineerItemsFactory",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/ENOXEngineer/utils/Utils","UWA/Utils/InterCom","DS/ENOXEngineer/utils/ResponseParser","DS/ENOXEngineer/models/EngItemListModel","DS/ENOXEngineer/models/EngItemModel","DS/ENOXEngineer/models/EngItemGroupModel","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/collections/XEngGridTreeDocument","WebappsUtils/WebappsUtils"],function(e,t,n,i,r,o,s,a,l,c,d,u,p){"use strict";return t.singleton({init:function(e){this._parent(e)},initialize:function(e){this.app=e,this.app.core.Factories||(this.app.core.Factories={}),this.app.core.Factories.ListItemFactory=this,this.i18nManager=this.app.core.i18nManager},buildGroupNode:function(t){if(!t||!t.property||null==!t.identifier||!t.firstmember)throw new Error("missing attribute to build grouping node");var n=e.extend(t,this.getGroupAttributes(t));return new l(n)},getGroupAttributes:function(e){var t=e.property,n=(e.identifier,e.firstmember,{}),i=this.app.core.dicoService.getVisibleAttributes();if(Array.isArray(i))for(var r=0;r<i.length;r++){const e=i[r];if(e&&e.ds6w===t){"date"===e.kind.toLowerCase()&&(n.patch_isCustoDate=!0);break}}return n.property=e.property,n.viewType="attributeNode",n.appCore=this.app.core,n},computeFullPathPhysicalId:function(e,t,n,i){if(t[n].toString()===e.root.did)i=[e.root.physicalid];else if(n%2==1){var r=e.nodes[t[n]];i.push(r.physicalid),i.push(r.instanceOf.physicalid)}return i},updateNodeWithStructureInfo:function(e,t,n){var i=n+1<e.length?t.nodes[e[n+1]]:null;if(0===Math.abs(n%2)){if(t.nodes[e[n]].children||(t.nodes[e[n]].children=[]),i){for(var r=!1,o=0;o<t.nodes[e[n]].children.length;o++)if(t.nodes[e[n]].children[o].did===i.did){r=!0;break}r||t.nodes[e[n]].children.push(i)}}else i&&(t.nodes[e[n]].instanceOf=i)},computeOccurancePath:function(e,t,n,i){if(i)return this.computeOccurancePathForMFGView(e,t,n);var r=[t.root.physicalid];return n.forEach(function(e){var n=t.nodes[e];n&&(r.push(n.physicalid),r.push(n.instanceOf.physicalid))}),r},computeOccuranceTitle:function(e,t){var n=[];return t.forEach(function(t){var i=e.nodes[t];i&&null!=i["ds6w:label"]&&n.push(i["ds6w:label"])}),n.join("/")},computeLevel:function(e){return(e.length-1)/2},updateOccurancePathOfNlevelStructure:function(e){var t=e&&e.occurrencePath&&e.occurrencePath.indexOf(e.instanceOf.physicalid)>-1?e.occurrencePath.indexOf(e.instanceOf.physicalid)+1:e.occurrencePath.length;e.occurrencePath=e.occurrencePath.slice(0,t)},getListNodesFromServerExpand:function(t,i,r){var s=this;let a=r?r.targetLevel:void 0;console.log("building nodes... "+Date.now());var l=s.app.core.settingManager;return i[d.CONST_AUTHORING_MODE]=s.app.core.sessionManager.isUsingDB(),new n(function(r,c){var u=o.parseAndBuildIRPCStructureForLoad(t,l.getSetting(d.DS6W_CLASSES_WITH_NLS_PROP),i);s.getStatesAttributesForPolicies(u.policies),n.allSettled([s.app.core.i18nManager.resolveMissingNls(u.nlsTracker),s.app.core.dicoService.getRootTypes(u.types)]).then(function(n){if(!u.root)return r([]);const l=!(!i||!i.nodesType)&&"reference"===i.nodesType;var c=[],d=[],p=[],g=new Map,h={},m=s.app.core.sessionManager.shouldShowMfgView();const f=s.app.core.sessionManager.shouldShowLeafMaterials(),E=s.app.core.sessionManager.shouldShowFlatView(),C=!(!i||!i.flattenedView)&&i.flattenedView;var _=[];u.paths.forEach(function(t){for(var n=[],r=[],o=0;o<t.length;o++)t[o].toString()===u.root.did?n=[]:(s.updateNodeWithStructureInfo(t,u,o),o%2==1&&n.push(u.nodes[t[o]])),r=s.computeFullPathPhysicalId(u,t,o,r);var _=s.getFinalPath(n,m),y=s.computeOccurancePath(r,u,_,m),N=s.computeOccuranceTitle(u,_);if(_&&_.length>0){const n=e=>{const n=t.findIndex(t=>t==e.did);return(n<t.length?t.slice(0,n+1):t).join("/")},r=e=>{const t=u.nodes[e];return n(t)},o=e=>{const t=r(e);return g.get(t)},v=e=>{return u.nodes[e].instanceOf},S=(t,n)=>{e.is(t)&&e.is(n)&&(e.is(t.childrenForViewModel)||(t.childrenForViewModel=[]),t.childrenForViewModel.push(n))},b=(e,t)=>{const n=e.did,i=t.did;let r=!1;if(u.nodes.hasOwnProperty(n)){r=-1===u.nodes[n].quantity.findIndex(e=>e.did===i)}return r},D=!(!i||!i.expand_iter||"-1"!==i.expand_iter);let T=D&&!0!==C&&!0!==f?0:_.length-1;m?T=!0===C?_.length-1:0:a&&(T=s.app.core.contextManager.isActiveEngItemSelected()?0:s.getTargetLevelToBuildNodeFromResponse(y,T));for(let e=T;e<_.length;++e){const t=_[e],r=u.nodes[t];var M=n(r);if(!1===g.has(M)){var A=Object.assign({},r);A.occurrencePath=y,A.occurence=N,i&&"1"!=i.expand_iter&&s.updateOccurancePathOfNlevelStructure(A),g.set(M,A),!0===C||"VPMRepInstance"===A.type||!0===D||m||1==f||E||(A.children=[]),A.childComputed=!1;var I=A.instanceOf;if(l&&s.isReusableReference(I))if(p.indexOf(I.did)<0){if(p.push(I.did),I.hasQuantity)h[I.physicalid]=I;else if(D||I.children&&(!I.children||0!=I.children.length)||(I.children=[],I.childComputed=!1),e===T)d.push(I);else{S(v(_[e-1]),I)}u.nodes[I.did].quantity=[A]}else!0!==C&&!0!==b(I,A)&&1!=f||u.nodes[I.did].quantity.push(A);else if(e===T)c.push(A);else{S(o(_[e-1]),A)}}}}}),s.createCoreMaterialNodes(h).then(function(e){if(d.length>0){var n=s.createEngItemNodes(d,s.genericEngItemOptionsMapper.bind(s),a);_=_.concat(n)}if(e&&Array.isArray(e)&&e.length>0&&(_=_.concat(e)),c.length>0){var i=s.createListNodes(c,s.expandListNodeOptionsMapper.bind(s),a);_=_.concat(i)}return o.cleanExpandParsedData(u),t=void 0,console.log("Nodes built! "+Date.now()),r(_)}).catch(function(e){})})})},computeOccurancePathForMFGView:function(e,t,n){var i=n.length>0?t.nodes[n[n.length-1]].instanceOf.physicalid:"";return e.slice(0,e.indexOf(i)+1)},isManufactuableNode:function(e){return!("FALSE"===e[d.DS6W_MANUFACUTRABLE]||e.instanceOf&&"FALSE"===e.instanceOf[d.DS6W_MANUFACUTRABLE])},removeChildFromNode:function(e){(!e.children||e.children&&0==e.children.length)&&(e.children=[],e.childComputed=!1)},getListNodesFromServerExpandForEdition:function(e,t){var i=this,r=i.app.core.settingManager;return t[d.CONST_AUTHORING_MODE]=!0,new n(function(n,s){var a=o.parseAndBuildIRPCStructure(e,r.getSetting(d.DS6W_CLASSES_WITH_NLS_PROP),t);i.getStatesAttributesForPolicies(a.policies),i.app.core.i18nManager.resolveMissingNls(a.nlsTracker).then(function(r){if(!a.root)return n([]);var s=!1;if(t&&t.nodesType)s="reference"===t.nodesType;var l=[],c=[],d=[],u=[],p={},g=(t.flattenedView,t.isRefreshing,[]);a.paths.forEach(function(e){var n=[],r=[];a.root=e[0]!=a.root.did?a.nodes[e[0]]:a.root;for(var o=0;o<e.length;o++)e[o].toString()===a.root.did?r=[]:o%2==1&&r.push(a.nodes[e[o]]),n=i.computeFullPathPhysicalId(a,e,o,n);const g=i.app.core.sessionManager.shouldShowMfgView(),h=i.getFinalPath(r,g),m=i.computeOccurancePath(n,a,h,g),f=i.computeOccuranceTitle(a,h),E=i.computeLevel(m);r.forEach(function(e){e.occurrencePath=m,e.occurence=f,e.level=E,i.updateOccurancePathOfNlevelStructure(e);var n=e.instanceOf;if(s&&i.isReusableReference(n)&&!n.hasQuantity)if(d.indexOf(n.did)<0||u.indexOf(m[0])<0)if(d.push(n.did),u.push(m[0]),n.hasQuantity)p[n.physicalid]=n,Reflect.has(p[n.physicalid],"quantity")?p[n.physicalid].quantity.push(e):p[n.physicalid].quantity=[e];else if(i.removeChildFromNode(e),n.quantity&&!0===t.isFromReplace){let t=Object.assign({},n);t.quantity=[e],c.push(t)}else!0===t.isFromReplace&&(n.quantity=[e]),c.push(n);else!0===t.isFromReplace&&(i.removeChildFromNode(e),n.quantity.push(e));else!0===t.isFromReplace&&(e.children=[]),l.push(e)})}),i.createCoreMaterialNodes(p).then(function(r){if(c.length>0){var s=i.createEngItemNodes(c,i.genericEngItemOptionsMapper.bind(i));g=g.concat(s)}if(r&&Array.isArray(r)&&r.length>0&&(g=g.concat(r)),l.length>0){var d=i.createListNodes(l,i.expandListNodeOptionsMapper.bind(i));g=g.concat(d)}return o.cleanExpandParsedData(a),e=void 0,!0===t.isFromReplace?n(g):(g=i.removeDuplicates(g),n(g))}).catch(function(e){})})})},removeDuplicates:function(e){let t=[],n={};for(let t in e){n[e[t].getRelationID?e[t].getRelationID():e[t].getID()]=e[t]}for(let e in n)t.push(n[e]);return t},createCoreMaterialNodes:function(e){var t=this;return new n(function(n,i){if(!(Object.keys(e).length>0))return n([]);var r=[];for(var o in e)r.push(o);t.app.core.dataService.getCoreMaterialToEngItem(r).then(function(i){var r=i.references.map(function(e){return e.material.physicalid}),o=t.app.core.dicoService.getTagsForBOWithMandatories();t.app.core.dataService.fetch(r,o).then(function(r){if(i.references){var o={};i.references.forEach(function(t){var n=t.material.physicalid,i=t.engItem,s=r.filter(function(e){return e.physicalid===n})[0];e[i].quantity.forEach(function(e){e.instanceOf.CoreMaterial=s["ds6w:label"]+" "+s["ds6wg:revision"],e.instanceOf.CoreMaterialID=s.physicalid,e.instanceOf.CoreMaterialInfos=s}),null!=o[n]?o[n].quantity=o[n].quantity.concat(e[i].quantity):(s.quantity=e[i].quantity,o[n]=s)});var s=[];for(var a in o)s.push(o[a]);var l=[];return s.length>0&&(l=t.createEngItemNodes(s,t.materialFromIndexNodeOptionsMapper.bind(t))),n(l)}})}).catch(function(e){})})},isReusableReference:function(e){return"ds6w:Part"===e["ds6w:globalType"]},isFinalItem:function(e){var t=widget.getValue(d.FINAL_ITEMS_PREF),n=this.app.core.dicoService.getCustomAttribute(t),i=widget.getValue(d.FINAL_ITEM_VALUE_NAME),r=null;return n&&void 0===(r=e[t])&&(r=n.defaultValue),null!=r&&null!=i&&void 0!==i&&r===i},showInBOM:function(e){if(void 0===this.app.core.sessionManager.showNotInBOM()||!this.app.core.sessionManager.showNotInBOM()){var t=e["ds6wg:SynchroEBOMExt.V_InEBOMUser"];return!(t&&"FALSE"==t)}return!0},getFinalPath:function(e,t){for(var n=[],i=0;i<e.length;i++){var r=e[i];if(this.shouldBeExcluded(r))break;if(this.shouldBeSkipped(r,t)||n.push(r.did),this.isFinal(r))break}return n},shouldBeSkipped:function(e,t){return!(!t||this.isManufactuableNode(e))},shouldBeExcluded:function(e){return!!this.exclude3DShape(e)||!this.showInBOM(e)},isFinal:function(e){var t=this.app.core.contextManager.isMultiLevelStructure(),n=this.app.core.sessionManager.shouldShowFinalItems();const i=this.app.core.sessionManager.shouldShowLeafMaterials();var r=!1,o=e.instanceOf?e.instanceOf.children:null;if(o&&0!=o.length){var s=!1;o.forEach(function(e){if(!0===t)var n="ds6w:Part"===e.instanceOf["ds6w:globalType"]||"VPMRepInstance"===e.type;else n="ds6w:Part"===e.instanceOf["ds6w:globalType"];if(n)return s=!0,!1}),s||(r=!0)}else r=!0;var a=this.isFinalItem(e.instanceOf);return!!(r||a&&(n||i))},getNlsedListNodes:function(e){var t=this;return new n(function(n,i){if(!Array.isArray(e))return i(new Error(" inputs error"));var r=t.app.core.settingManager,s=[],a={withNlsProp:r.getSetting(d.DS6W_CLASSES_WITH_NLS_PROP),classes:[],properties:{}};e.forEach(function(e){s.push(o.attributesParser(e,a))}),t.app.core.i18nManager.resolveMissingNls(a).finally(function(e){return n(t.createListNodes(s,t.genericEngItemOptionsMapper.bind(t)))})})},getEngItemsListFromServerFetch:function(e,t,i){var r=this,s=r.app.core.settingManager;return new n(function(t,n){if(!Array.isArray(e.results))return n(e);var a=o.parseFetchResult(e,s.getSetting(d.DS6W_CLASSES_WITH_NLS_PROP));r._getCreatedEngItemNodes(a,a.results,i).then(function(e){return t(e)})})},getEngItemFromServerExpandInDB:function(e,t,i){var r=this,s=r.app.core.settingManager,a={};return new n(function(t,n){if(!Array.isArray(e.results))return n(e);a[d.CONST_AUTHORING_MODE]=r.app.core.sessionManager.isUsingDB();var l=o.parseAndBuildIRPCStructureForLoad(e,s.getSetting(d.DS6W_CLASSES_WITH_NLS_PROP),a);if(r.getStatesAttributesForPolicies(l.policies),!l.root)return t();r._getCreatedEngItemNodes(l,[l.root],i).then(function(e){return t(e)})})},_getCreatedEngItemNodes:function(e,t,n){var i=this;return c.wrappedWithCancellablePromise(function(r,o){i.app.core.i18nManager.resolveMissingNls(e.nlsTracker).finally(function(e){var o=i.createEngItemNodes(t,i.genericEngItemOptionsMapper.bind(i));if(!n||1!==o.length)return r(o);var s=o[0];s.getConfigInitPromise().finally(function(){r([s])})})})},expandListNodeOptionsMapper:function(e){var t=this.genericEngItemOptionsMapper(e.instanceOf);return t.instanceId=e.physicalid,t.childComputed=e.childComputed,t.children=e.children,t.occurrencePath=e.occurrencePath,t.occurence=e.occurence,t.level=e.level,t["ds6w:label-Instance"]="VPMRepInstance"!==e.type||"VPMRepInstance"===e.type&&"Drawing"===e.instanceOf.type?e["ds6w:label"]||e["ro.PLMInstance.PLM_ExternalID"]:"",t.instanceType=e.type,t.instanceTypeNLS=this.i18nManager.get("ds6w:type/"+e.type),this.app.core.dicoService.getTagsForRelWithMandatories().filter(function(e){return-1===["physicalid","ds6w:label","ds6w:type"].indexOf(e)}).forEach(function(n){t[n+d.APPEND_INSTANCE_COLUMN_KEYWORD]=void 0===e[n]?"":e[n]}),t},genericEngItemOptionsMapper:function(e){return e["ds6w:created"]=e["ds6w:created"],e["ds6w:modified"]=e["ds6w:modified"],e.occurrencePath&&(e.occurrencePath=e.occurrencePath),e},materialFromIndexNodeOptionsMapper:function(e){var t=this.genericEngItemOptionsMapper(e);if(void 0!==e["ds6w:status"]&&null!==e["ds6w:status"]){var n=e["ds6w:status"].split(".");t[d.CONST_CURRENT_OBJECT_MATURITY_STATE]||(t[d.CONST_CURRENT_OBJECT_MATURITY_STATE]=e["ds6w:status"]),t["ds6w:status"]=this.i18nManager.get("ds6w:status/"+n[n.length-1])}return t["ds6w:globalType"]="ds6w:Material",t},listNodeToEngItem:function(e){let t={...e.options};return t.grid={...e.options.grid},t.viewType="reference",delete t.instances,t.children&&(t.children=[]),t.grid.hasOwnProperty("instanceId")&&delete t.grid.instanceId,t.grid.hasOwnProperty("instanceType")&&delete t.grid.instanceType,t.grid.hasOwnProperty("occurrencePath")&&delete t.grid.occurrencePath,t.grid.hasOwnProperty("occurence")&&delete t.grid.occurence,t.grid.hasOwnProperty("level")&&delete t.grid.level,e.options.appCore.dicoService.getAvailableAttributes().filter(e=>"rel"===e.ds6wFrom).map(e=>e.dataIndex).forEach(e=>{delete t.grid[e]}),new a(t)},resolveAttributes:function(t,n){return n&&"function"===e.typeOf(n)?n(t):n&&"fromSearch"===n?this.retrieveNodeDataFromSearchResult(t):n&&"fromDocAPI"===n?this.retrieveNodeDataFromDocumentAPI(t):n&&"docFromGenericExpand"===n?this.retrieveNodeDataFromDocumentGenericExpand(t):n&&"coreMaterialFromSearch"===n?this.retrieveNodeDataFromSearchMaterial(t):n&&"instFromGenericExpand"===n?this.expandListNodeOptionsMapper(t):n&&"refFromGenericExpand"===n?this.genericEngItemOptionsMapper(t):t},getReferenceClass:function(){return a},getListInstanceClass:function(){return s},getGroupInstanceClass:function(){return l},isInstanceOfEngItem:function(e){return e instanceof this.getReferenceClass()},isInstanceOfListNodeModel:function(e){return e instanceof this.getListInstanceClass()},extractAttributesFromNode:function(t){var n={};if(this.isInstanceOfListNodeModel(t)||this.isInstanceOfEngItem(t)){const i={...t.options.grid},r={...t.options.padgrid};(n=e.merge(i,r)).type=t.options.type,n.physicalid=t.options.referenceId,n.thumbnail=t.options.thumbnail,n.icons=t.options.icons,n.occurrencePath=t.options.occurrencePath,n.locker=t.options.locker,n.files=t.options.files,n["ds6wg:PLMReference.V_isLastVersion"]=t.options.isLastVersion,n["ds6w:globalType"]=t.options.padgrid["ds6w:globalType"],t.getRelationID&&(n.instanceId=t.getRelationID())}return n},extractOptionsFromNode:function(e,t){var n=null,i=this.extractAttributesFromNode(e);return(n=this.isInstanceOfListNodeModel(e)?this.basicOptionsBuilder(i).addInstanceOptionsBuilder(i,"",t).Options:this.basicOptionsBuilder(i).Options)&&(delete n.isCut,delete n.quantity,delete n.showMoreInfo,delete n.appCore,n.grid["ds6w:label-Instance"]&&n.grid["ds6w:label-Instance"]!==this.i18nManager.get("loading")||delete n.grid["ds6w:label-Instance"]),n},createEngItem:function(t,n,i){var r=this,o=this.buildEngItemNodeOptions(t,n);if(t.quantity&&t.quantity.length>0){var s=[];t.quantity.forEach(function(e){var t=r.createListNode(e,r.expandListNodeOptionsMapper.bind(r),i);s.push(t)}),o.grid.quantity=s}o.children=t.children,t.occurrencePath&&(o.occurrencePath=t.occurrencePath),o.childComputed=t.childComputed;var l=new a(o);return e.is(t.childrenForViewModel)&&(this._createNodeChildrenForViewModel(l,t.childrenForViewModel,n,r.createEngItemNodes.bind(r),i),delete t.childrenForViewModel),r.isExpandOperation(i,l)&&l.expand(),l},createListNode:function(e,t,n){var i=this.buildListNodeOptions(e,t);return new s(i)},_createNodeChildrenForViewModel:function(t,n,i,r,o){if(e.is(t)&&"function"==typeof r&&n instanceof Array&&n.length){const e=r(n,i,o);t._options.children=[],t._options.childComputed=!0,t.addChildToTheTargetNode(e)}},basicOptionsBuilder:function(e,t){var n="ds6w:Part";return e["ds6w:globalType"]&&(n=e["ds6w:globalType"]),this.Options={type:e.type,isCut:!1,quantity:1,tenant:this.app.core.settingManager.getPlatformId(),label:e["ds6w:label"],grid:{},padgrid:{"ds6w:globalType":n},showMoreInfo:!0,subLabel:e["ds6w:responsible"]+" \n"+e["ds6w:modified"],attributes:[],referenceId:e.physicalid,thumbnail:this.buildThumbnail(e),appCore:this.app.core,icons:e.icons,isLastVersion:e["ds6wg:PLMReference.V_isLastVersion"]},e.children&&(this.Options.children=e.children),null!==e.childComputed&&void 0!==e.childComputed&&(this.Options.childComputed=e.childComputed),"ds6w:FileDocument"===e["ds6w:globalType"]&&(this.Options.locker=e.locker,this.Options.checkedOut=this.Options.locker&&this.Options.locker.length>0,this.Options.e6wdocument=e.e6wdocument,this.Options.files=e.files,this.Options.isMultiFile=e.isMultiFile,this.Options["ds6w:docExtension"]=e["ds6w:docExtension"],this.Options.thumbnail=e.thumbnail||p.getWebappsAssetUrl("ENOXEngineer","img/document.png")),"ENOStrRefinementSpecification"===e.type&&(this.Options.padgrid["ds6w:globalType"]="ds6w:Filter"),this._fillAttributes(e),t?this.Options:this},buildThumbnail:function(e){if(e.thumbnail)return e.thumbnail;const t=e.icons&&Array.isArray(e.icons)&&e.icons.length?e.icons[0]:null;return t?this.getIconThumbnail(t):""},getIconThumbnail:function(e){if(!e)return;const t=e.split("&").reduce((e,t)=>{const n=t.split("=");return e[n[0]]=n[1],e},{});switch(t.icon_95_2ddefaultthb_46_subtype||t.ipml_46_iconname){case"I_VPMNavDrawing":return p.getWebappsAssetUrl("ENOXEngineer","img/I_VPMNavDrawing108x144.png");case"3DPart":return p.getWebappsAssetUrl("ENOXEngineer","img/I_3DPart108x144.png");case"I_VPMNavProduct":return p.getWebappsAssetUrl("ENOXEngineer","img/product.png");case"I_Part":return p.getWebappsAssetUrl("ENOXEngineer","img/I_Part108x144.png");default:return e}},_fillAttributes:function(e){var t=this;if(this.Options.grid||(this.Options.grid={}),t._fillStringAttributesToDefault(this.Options),Object.keys(e).forEach(function(n){t.Options.grid[n]=e[n]}),e["ds6wg:SynchroEBOMExt.V_InEBOMUser-Instance"]&&"TRUE"===e["ds6wg:SynchroEBOMExt.V_InEBOMUser-Instance"].toUpperCase()&&(t.Options.grid["ds6wg:SynchroEBOMExt.V_InEBOMUser-Instance"]=!0),e.CoreMaterial&&e.CoreMaterialID&&(t.Options.grid.CoreMaterial=e.CoreMaterial,t.Options.grid.CoreMaterialID=e.CoreMaterialID),"ds6w:Part"===t.Options.padgrid["ds6w:globalType"]&&t._parseDateAttributesToISO(this.Options),(e.thumbnail||t.Options.thumbnail)&&(t.Options.grid.Thumbnail=e.thumbnail||t.Options.thumbnail),e["ds6w:deformability"]&&(t.Options.grid["ds6w:deformability"]=e["ds6w:deformability"]?t.i18nManager.get("ds6w:deformability/"+e["ds6w:deformability"]):""),e["ds6w:status"]&&!t.Options.grid[d.CONST_CURRENT_OBJECT_MATURITY_STATE]&&(t.Options.grid[d.CONST_CURRENT_OBJECT_MATURITY_STATE]=e["ds6w:status"]),Array.isArray(e[d.CONST_DS6W_STATUS]))t.Options.grid[d.CONST_DS6W_STATUS]=e[d.CONST_DS6W_STATUS].map(e=>t.i18nManager.get(d.CONST_DS6W_STATUS+"/"+e));else{let n=e[d.CONST_DS6W_STATUS];if("ds6w:FileDocument"==e["ds6w:globalType"]&&!e.stateNLS&&e[d.CONST_DS6W_STATUS]){let t=e[d.CONST_DS6W_STATUS].split(".");n=e[d.CONST_DS6W_POLICY]+"."+t[t.length-1]}t.Options.grid[d.CONST_DS6W_STATUS]=t.i18nManager.get(d.CONST_DS6W_STATUS+"/"+n)}return t.Options.grid["ds6w:type"]=t.i18nManager.get("ds6w:type/"+e.type),t.Options.grid["ds6w:organizationResponsible"]=e["ds6w:organizationResponsible"]?t.i18nManager.get("ds6w:organizationResponsible/"+e["ds6w:organizationResponsible"]):"",t.Options.grid["ds6w:organizationResponsible-Instance"]=e["ds6w:organizationResponsible-Instance"]?t.i18nManager.get("ds6w:organizationResponsible/"+e["ds6w:organizationResponsible-Instance"]):"",t.Options.grid["ds6w:project"]=e["ds6w:project"]?t.i18nManager.get("ds6w:project/"+e["ds6w:project"]):"",t.Options.grid["ds6w:project-Instance"]=e["ds6w:project-Instance"]?t.i18nManager.get("ds6w:project/"+e["ds6w:project-Instance"]):"",this.Options},_fillStringAttributesToDefault:function(e){this.customStringDefault||(this.customStringDefault=this.app.core.dicoService.getVisibleAttrForBO()||[],this.customStringDefault=this.customStringDefault.filter(function(e){return!e.isReadOnly&&e.kind&&"string"===e.kind.toLowerCase()}).map(function(e){return e.ds6w})),e&&e.grid&&this.customStringDefault.forEach(function(t){e.grid[t]=""})},_parseDateAttributesToISO:function(e){this.customDateAttrs||(this.customDateAttrs=this.app.core.dicoService.getVisibleAttributes()||[],this.customDateAttrs=this.customDateAttrs.filter(function(e){return e.kind&&-1!==["datetime","timestamp"].indexOf(e.kind.toLowerCase())&&-1===["ds6w:modified","ds6w:created"].indexOf(e.dataIndex)}).map(function(e){return e.ds6w})),e&&e.grid&&this.customDateAttrs.forEach(function(t){var n=i.dateFormatFromDsToIso(e.grid[t]);e.grid[t]=n||""})},getDefaultProductThumbnail:function(){return this.defaultThumbnail?this.defaultThumbnail:(this.defaultThumbnail=p.getWebappsAssetUrl("ENOXEngineer","img/product.png"),this.defaultThumbnail)},getAttachmentTileIcon:function(e){return[e.dataelements.type_icon_url?e.dataelements.type_icon_url:"Drawing"===e.type?this.getDefaultDrawingIcon():this.getDefaultDocumentIcon()]},getDefaultDrawingIcon:function(){return p.getWebappsAssetUrl("ENOXEngineer","icons/32/I_PLMInsertNewDrawing.png")},getDefaultDocumentIcon:function(){return p.getWebappsAssetUrl("ENOXEngineer","icons/32/I_CDM_Document.png")},getDefaultProductIcon:function(){return this.app.core.settingManager.getDefault3DSpaceUrl()+"/snresources/images/icons/small/I_VPMNavProduct.png"},getCADIcon:function(e){return e&&0!==e.trim().length?this.app.core.settingManager.getIconPath("I_"+e):""},addInstanceOptionsBuilder:function(e,t,n){return this.Options?(this.Options.instanceId=e.instanceId,this.Options.instanceType=e.instanceType,n||(this.Options.childComputed=e.childComputed,this.Options.children=e.children,this.Options.occurrencePath=e.occurrencePath),t?this.Options:this):(console.error(" you need to call basic method before !"),null)},retrieveNodeDataFromSearchResult:function(e){return{type:e["ds6w:type"],instanceId:e.id,"ds6w:description":"","ds6w:label":e["ds6w:identifier"],"ds6wg:revision":"-","ds6w:status":e["ds6w:status"],"ds6w:responsible":e["ds6w:responsible"],"ds6w:created":e["ds6w:created"],"ds6w:modified":e["ds6w:modified"],"ds6w:label-Instance":e["ds6w:label"],physicalid:e.id,thumbnail:e.preview_url}},retrieveNodeDataFromSearchMaterial:function(e){var t=this.genericEngItemOptionsMapper(e);return t.type=e["ds6w:type"],t.physicalid=e.id,t.thumbnail=e.preview_url,t.icons=[e.type_icon_url],t["ds6w:globalType"]="ds6w:Material",t["ds6w:reserved"]=e["ds6w:reserved_value"],t},retrieveNodeDataFromDocumentGenericExpand:function(e){const{physicalid:t,instanceOf:n,level:i,type:r,occurrencePath:o}=e||{};if(!n)return null;const s=["ds6w:description","ds6w:label","ds6wg:revision","islastrevision","current","ds6w:responsible","ds6w:created","ds6w:modified","ds6w:identifier","ds6w:identifier","docExtension","name","icons","physicalid","thumbnail","hasQuantity","getDeformableObjectIDFromDeformed","isCoreMaterialConsumption","isRelation","resourceid","ds6w:policy","ds6w:reserved","ds6w:docextension","islastrevision","policy","current","did","ds6w:status"],a=this.app.core.dicoService.getAvailableAttributeWithNls(),l=Reflect.ownKeys(n).filter(e=>-1===s.indexOf(e)).filter(e=>a.find(t=>t.ds6w===e)),c={};return l.forEach(e=>{c[e]=n[e]}),{...c,level:i,type:n.type,instanceId:t,instanceType:"DocInstance","ds6w:label-Instance":"","ds6w:globalType":"ds6w:FileDocument","ds6w:description":n["ds6w:description"],"ds6w:label":n["ds6w:label"],"ds6wg:revision":n["ds6wg:revision"],"ds6wg:PLMReference.V_isLastVersion":n.islastrevision,"ds6w:status":this.i18nManager.get(n.current),"ds6w:responsible":n["ds6w:responsible"],"ds6w:created":n["ds6w:created"],"ds6w:modified":n["ds6w:modified"],"ds6w:identifier":n["ds6w:identifier"],"ds6w:docExtension":n["ds6w:docextension"],"ds6w:project":n["ds6w:project"],owner:n.name?n.name:n.owner,icons:Array.isArray(n.icons)&&n.icons.length?n.icons:this.getAttachmentTileIcon(doc),physicalid:n.physicalid,isSpecificationDocument:r===d.SPECIFICATION_DOCUMENT,thumbnail:n.thumbnail||p.getWebappsAssetUrl("ENOXEngineer","img/document.png"),occurrencePath:o,"ds6w:policy":n["ds6w:policy"]}},retrieveNodeDataFromDocumentAPI:function(e){if(!e)return null;const t=e;if(!t)return null;const n=t.relateddata.ownerInfo[0].dataelements,i=["fileExtension","name","policy","state","stateNLS","typeNLS","isDocumentType","revision","isLatestRevision","title","description","collabspace","collabSpaceTitle","originated","modified","comments","hasDownloadAccess","hasReviseAccess","hasModifyAccess","hasDeleteAccess","reservedby","secondaryTitle","parentId","typeicon","indexedTypeicon","kind","image","indexedImage"],r=this.app.core.dicoService.getVisibleTagsForBO(),o=Reflect.ownKeys(t.dataelements).filter(e=>-1===i.indexOf(e)),s={};o.forEach(e=>{this.app.core.sessionPredicatesService.getPredicatePropertiesForSelectable(e).forEach(n=>{const{curi:i}=n;r.find(e=>e===i)&&(s[i]=t.dataelements[e])})});const a=t&&t.relateddata&&t.relateddata.files?t.relateddata.files:null,l="string"==typeof t.relId&&t.relId.trim().length?[t.relId]:[];let c=!1,d=!1;const u=new Set,g=new Set,h=[];Array.isArray(a)&&(c=a.length>1,a.forEach(e=>{const{dataelements:n,relateddata:i,relId:r}=e||{};l.push(r);const{locker:o}=n||{},{image:s}=t.dataelements||{},a="string"==typeof s&&s.endsWith(".gif")?p.getWebappsAssetUrl("ENOXEngineer","img/document.png"):s;h.push(a);let c=null;if("string"==typeof o&&o.trim().length>0){u.add(o),d||(d=!0);const{lockerInfo:e}=i||{},t=Array.isArray(e)?e.find(e=>e.dataelements.name===o):null,{dataelements:n}=t||{},{firstname:r,lastname:s}=n||{};(c=`${r} ${s}`).trim().length&&g.add(c)}}));let m="";return m=t.dataelements.title?t.dataelements.title:t.dataelements.secondaryTitle?t.dataelements.secondaryTitle:t.dataelements.name,{...s,type:t.type,instanceId:l[0],"ds6w:description":t.dataelements.description,"ds6w:globalType":"ds6w:FileDocument","ds6w:label":m,"ds6wg:revision":t.dataelements.revision,"ds6wg:PLMReference.V_isLastVersion":t.dataelements.isLatestRevision,"ds6w:status":t.dataelements.stateNLS?t.dataelements.stateNLS:this.i18nManager.get(t.dataelements.state),currentObjectState:t.dataelements.state,"ds6w:responsible":n.firstname+" "+n.lastname,"ds6w:created":t.dataelements.originated,"ds6w:modified":t.dataelements.modified,"ds6w:identifier":t.dataelements.name,owner:n.name,e6wdocument:t,locker:u.size?[...u].join(","):null,"ds6w:label-Instance":"",icons:t.dataelements.indexedTypeicon?[t.dataelements.indexedTypeicon]:this.getAttachmentTileIcon(t),instanceType:"DocInstance",files:a,isMultiFile:c,physicalid:t.id,thumbnail:h.length?h[0]:null,"ds6w:project":t.dataelements.collabSpaceTitle,"ds6w:reserved":d?"TRUE":"FALSE","ds6w:reservedBy":g.size?[...g].join(","):null,"ds6w:policy":t.dataelements.policy,stateNLS:t.dataelements.stateNLS}},createListNodes:function(t,n,i){var r=[];return t.forEach(t=>{var o=this.createListNode(t,n,i);e.is(o)&&(void 0===this.app.core.sessionManager.showNotInBOM()||this.app.core.sessionManager.showNotInBOM()||!this.app.core.sessionManager.showNotInBOM()&&"FALSE"!==o.getAttributeValue("ds6wg:SynchroEBOMExt.V_InEBOMUser"))&&r.push(o)}),r},createEngItemNodes:function(t,n,i){var r=[],o=this;return t.forEach(function(t){if(t.deleted)r.push(t);else{var s=o.createEngItem(t,n,i);e.is(s)&&r.push(s)}}),r},_getBIFilterProxy:function(){var e=this.app.core.contextManager.getXENTreeDocument();return e?e.getXENBIFilterProxy():null},getRootItemFromFilter:function(e){var t=this;return c.wrappedWithPromise(function(n,i){if(!e)return i(new Error("no filters found in preference"));var r=t._getBIFilterProxy();if(!r)return i(new Error("no BIFilter infra to manage Filters"));r.retrieveFilters({filterObjects:[{envId:t.app.core.settingManager.getPlatformId(),serviceId:e.serviceId,contextId:e.contextId,objectId:e.objectId,objectType:d.TYPE_ADVANCED_FILTER,displayName:e.displayName}],filterIds:[e.objectId],droppedEnvId:t.app.core.settingManager.getPlatformId(),doNotFillTheTagger:!1,callback:function(e){return e&&Array.isArray(e.success)&&e.success.length>0?n(e.success):e&&Array.isArray(e.errors)&&e.errors.length>0?i(new Error("unable to retrieve Filters")):void 0}})})},openItemWithCompass:function(t){var n=this.app.core.contextManager.getXENTreeDocument().getSelectedNodes(),i=e.is(widget)&&widget.id?"xEngCompassSocket_"+widget.id:"xEngCompassSocket";if(this._compass_socket||(this._compass_socket=new r.Socket(i),this._compass_socket.subscribeServer("com.ds.compass",window.parent)),!t&&n&&n.length>0&&!this.app.core.contextManager.isRoot(n[0])){var o=this.getContentForCompassInteraction(),s=e.clone(o.data.items[0]);this._compass_socket.dispatchEvent("onSetX3DContent",o,i),this._compass_socket.dispatchEvent("onSetObject",s,i)}else this._compass_socket.dispatchEvent("onResetX3DContent",{},i),this._compass_socket.dispatchEvent("onResetObject",{},i)},getContentForCompassInteraction:function(e,t){var n=[];if(t){var i={objectId:t.getID(),objectType:t.getType(),displayName:t.getDisplayName(),displayType:t.getType(),facetName:"realized"};n.push(i)}else{let t="root"==e?[this.app.core.contextManager.getActiveEngItem()]:this.app.core.contextManager.getXENTreeDocument().getSelectedNodes();for(var r=0;r<t.length;r++){var o={objectId:t[r].getID(),objectType:t[r].getType(),displayName:t[r].getDisplayName(),displayType:t[r].getType(),facetName:"realized"};n.push(o)}}var s=this.app.core.settingManager.getSecurityContext(),a=[];return n.forEach(function(e){var t={envId:widget.getValue("x3dPlatformId"),serviceId:"3DSpace",contextId:s,objectId:e.objectId,objectType:e.objectType,displayName:e.displayName,displayType:e.displayType,facetName:e.facetName?e.facetName:"",path:[{resourceid:e.objectId,type:e.objectType}]};a.push(t)}),{protocol:"3DXContent",version:"1.1",source:widget.data.appId,widgetId:widget.id,data:{items:a}}},getContentForOpenWithMenu(e,t){var n=this;return c.wrappedWithPromise(function(i,r){let o="";o=t?t.getType():"root"===e?n.app.core.contextManager.getActiveEngItem().getType():n.app.core.contextManager.getXENTreeDocument().getSelectedNodes()[0].getType(),n.app.core.dicoService.getTypeHierarchy(o).then(function(r){let s=n.getContentForCompassInteraction(e,t),a=JSON.parse(JSON.stringify(r));s.data.items[0].objectTaxonomies=a.hierarchy,s.data.items[0].objectTaxonomies.push(o),i(s)})})},createListNodeFromOptions:function(t){var n={};return e.extend(n,t),new s(n)},createEngItemNodeFromOptions:function(t){var n={};return e.extend(n,t),new a(n)},buildListNodeOptions:function(e,t){var n=this.resolveAttributes(e,t);return this.basicOptionsBuilder(n).addInstanceOptionsBuilder(n).Options},buildEngItemNodeOptions:function(e,t){var n=this.resolveAttributes(e,t);return this.basicOptionsBuilder(n).Options},getStatesAttributesForPolicies:function(e){let t=this.app.core.settingManager.getSetting("defaultPolicies");if(e){let n=e.filter(e=>-1==t.indexOf(e));n.length>0&&t.push(...n)}this.app.core.dataService.getStatesAttributes(t)},buildGroupNodesFromExpandResult:function(e,t,n){return c.wrappedWithCancellablePromise((r,o)=>{const s=i.retreiveGroupsFromExpand(e,t,this.app.core.i18nManager);if(!Array.isArray(s)||!s.length)return console.warn("no group found"),o(new Error("no group found"));const{useCollapse:a}=n||{useCollapse:!1};if(a)try{i.filterGroupsWithCollapseCriterias(s)}catch(e){return console.error("collapse group fails"),o(new Error("collapse group fails"))}return r(s.getFirstLevelChildren().map(e=>new l({label:e.getLabel(),groups:s,group:e,icons:[{iconName:"group"}],useAsyncPreExpand:!0,children:[],padgrid:{"ds6w:globalType":"groupNodeFromTagger"},appCore:this.app.core})))})},buildNodesFromExpandResult:function(e,t,r){let s=this,a={};return c.wrappedWithCancellablePromise(function(l,c){a[d.CONST_AUTHORING_MODE]=s.app.core.sessionManager.isUsingDB();let u=o.parseAndBuildIRPCStructureForLoad(e,s.app.core.settingManager.getSetting(d.DS6W_CLASSES_WITH_NLS_PROP),a);const p=s.app.core.dicoService.mappingRangeValueAttributes.filter(e=>u.nlsTracker.classes.indexOf(e.ds6w)>=0).reduce((e,t)=>(e[t.ds6w]=t.AuthorizedValues,e),{});u.nlsTracker.properties={...p,...u.nlsTracker.properties},s.getStatesAttributesForPolicies(u.policies),n.allSettled([s.app.core.i18nManager.resolveMissingNls(u.nlsTracker),s.app.core.dicoService.getRootTypes(u.types)]).then(e=>{let{nodes:n,paths:o}=u;s.app.core.dataService.completeWithCoreMaterialInformation(n).then(e=>{let a=e;s.app.core.dataService.completeWithDeformableInformation(n).then(e=>{let c=a&&Array.isArray(a)?i.createMap(a,e=>e.physicalid,e=>e):null,d=e&&Array.isArray(e)?i.createMap(e,e=>e.physicalid,e=>e):null,p={nodes:{...n,...c,...d},paths:o},g=s.buildTreeStructure(p.paths,p.nodes,t,r);(s.app.core.sessionManager.shouldShowFinalItems()||s.app.core.sessionManager.shouldShowLeafMaterials())&&(g=s.buildLeafNodes(g)),s.app.core.sessionManager.shouldShowFlatView()&&(g=s.buildFlatList(g)),s.app.core.sessionManager.shouldShowQuantityView()&&(g=s.buildReferenceNodes(g)),s.updateSessionPredicatesWithLoadedData(u),l(g)})})})})},updateSessionPredicatesWithLoadedData(e){if(!e)return;const t=Array.isArray(e.types)?e.types:[],n=Array.isArray(e.relTypes)?e.relTypes:[];this.app.core.mediator.publish(d.EVENT_UPDATE_SESSIONPREDICATE,{types:[...t,...n],interfaces:[]})},buildTreeStructure(e,t,n,r){let o=this;const s={nodeType:o.app.core.sessionManager.shouldShowQuantityView()?"reference":"instance",onlyLeaf:o.app.core.sessionManager.shouldShowFinalItems()||o.app.core.sessionManager.shouldShowLeafMaterials(),showManufOnly:o.app.core.sessionManager.shouldShowMfgView(),showFlatList:o.app.core.sessionManager.shouldShowFlatView()};function a(e,t){return(!e.showManufOnly||!t.instanceOf["ds6w:manufacturable"]||"FALSE"!==t.instanceOf["ds6w:manufacturable"])&&(!o.shouldBeExcluded(t)&&((!e.onlyLeaf||!t.instanceOf["ds6w:globalType"]||"ds6w:Part"===t.instanceOf["ds6w:globalType"])&&!(e.onlyLeaf&&t.instanceOf.type&&"Document"==t.instanceOf.type&&t.occurrencePath.length>3)))}function l(e,t){if(n[d.CONST_PARTIALLY_EXPANDED]&&t.length>4){let n=t.slice(0,t.length-2),i=e.find(e=>n.join("/")===e.join("/"));return i||l(e,n)}return e.find(e=>t.join("/").startsWith(e.join("/")))}let c=parseInt(n.level),u=r.parentPaths,p=n.paths,g=i.createMap(u,e=>e.join("/"),e=>[]),h={},m=1===u.length?u[0]:null,f=1===p.length?p[0]:null;return e.forEach(e=>{if(e.length<3&&n[d.CONST_PARTIALLY_EXPANDED])return;let i=function(e,t){return e.map(e=>t[e].physicalid)}(e,t),r=m||null;r||(r=l(u,i));let E=Array.isArray(r)?r.length-1:-1;if(-1===E)return;let C=f||null;C||(C=l(p,i));let _=C.length-1,y=r.join("/"),N={parentID:"",instanceDid:"",occurrencePath:[],occurence:[]};for(let i=0;i<e.length;++i){const l=e[i];if(N.occurrencePath.push(t[l].physicalid),i%2==1&&null!=t[l]["ds6w:label"]&&N.occurence.push(t[l]["ds6w:label"]),!(i<=E)&&(i%2==1&&(N.instanceDid=l),i%2==0)){let e=t[l],u=t[N.instanceDid],p=N.parentID,m=N.occurrencePath.join("/"),f=e.CoreMaterialID;f&&(e.CoreMaterialInfo=t[f],e.CoreMaterial=t[f]["ds6w:label"]);let E=e.getDeformableObjectIDFromDeformed?e.getDeformableObjectIDFromDeformed:void 0;E&&t[E]&&(e[d.CONST_DEFORMABLE_OBJECT_INFO]=t[E]);let C={...u};C.instanceOf={...e},C.occurrencePath=[...N.occurrencePath],C.occurence=N.occurence.join("/"),C.level=(C.occurrencePath.length-1)/2,C.childComputed=(-1===c||i-_<2*c)&&!n[d.CONST_PARTIALLY_EXPANDED],C.childComputed&&C.children||"ds6w:Part"!==e["ds6w:globalType"]||s.showFlatList||(C.children=[]);let M=h[m];if(!M){if(o.shouldBeExcluded(C))break;if(!a(s,C))continue;switch(C.type){case d.SPECIFICATION_DOCUMENT:M=o.createListNode(C,"docFromGenericExpand");break;default:M=o.createListNode(C,"instFromGenericExpand")}let e=h[p],t=M&&M.options&&M.options.grid&&M.options.grid.level?M.options.grid.level:null;e?("ds6w:Document"===M.getGlobalType()||"ds6w:FileDocument"===M.getGlobalType())&&s.showManufOnly&&M.getParentIdFromOccrencePath()!==e.getID()||e.addChild(M):1!=t&&"ds6w:Part"!=M.getGlobalType()?M.getOccurrencePath&&M.getOccurrencePath()&&r[r.length-1]===M.getParentIdFromOccrencePath()&&g[y].push(M):g[y].push(M),h[m]=M}M&&(N.parentID=m)}}}),g},buildLeafNodes(e){let t=this,n={};for(let i in e){let r=e[i],o=t.getLeafNodes(r);n[i]=o}return n},buildFlatList(e){let t=this,n={};for(let i in e){let r=e[i],o=t.getFlatNodes(r);n[i]=o}return n},buildReferenceNodes(e){let t=this,n={};for(let i in e){let r=e[i],o=t.getReferenceNodes(r);n[i]=o}return n},getReferenceNodes(e){let t=this,n={};return e.forEach(e=>{if(e.isEngineeringItem()){let i=e.isDeformedObject()&&t.app.core.sessionManager.shouldShowLeafMaterials()?e.getDeformableObjectIDFromDeformed():void 0;i||(i=e.isMaterialQuantity()&&t.app.core.sessionManager.shouldShowLeafMaterials()?e.options.grid.CoreMaterialID:e.getID());let r=n[i];if(!r){t.app.core.sessionManager.showDeformable()&&e.isDeformedObject()&&e.options.grid[d.CONST_DEFORMABLE_OBJECT_INFO]?r=t.createDeformableNode(e.options.grid[d.CONST_DEFORMABLE_OBJECT_INFO]):t.app.core.sessionManager.shouldShowLeafMaterials()&&e.isMaterialQuantity()&&(r=t.createMaterialNode(e.options.grid.CoreMaterialInfo)),r||(r=t.listNodeToEngItem(e));let o=e.getChildren();if(o){let e=t.getReferenceNodes(o);r.addChild(e)}n[i]=r}e.isRawMaterialType&&e.isRawMaterialType()&&e.getParent()&&r.addParentOccurences([e.getParent()]),r.addUsages([e])}else n[e.buildNodeId()]=e}),Object.keys(n).map(e=>n[e])},getLeafNodes(e){let t=[];return e.forEach(e=>{if(e.isRawMaterialType&&e.isRawMaterialType()&&!e.getParent()&&!e.isDirectRawMatConsumption())return;let n=e.getLeafNodes();n.forEach(e=>{e.options.children=void 0}),t=[...t,...n]}),t},getFlatNodes(e){let t=[];return e.forEach(e=>{t.push(e);let n=e.getChildNodes();t=[...t,...n]}),Array.isArray(t)&&t.length>0&&t.forEach(e=>{e.removeChildren(),e.options.children=void 0}),t},createMaterialNode:function(e){return this.createEngItem(e,this.materialFromIndexNodeOptionsMapper.bind(this))},createDeformableNode:function(e){return this.createEngItem(e,this.genericEngItemOptionsMapper.bind(this))},getTargetLevelToBuildNodeFromResponse:function(e,t){let n=this.app.core.contextManager.getXENTreeDocument().getSelectedNodes(),i=!1;return n.forEach(n=>{if(e.indexOf(n.getID())==n.getOccurrencePath().length-1)return t=e.indexOf(n.getID())/2-1,void(i=!0)}),t},isExpandOperation:function(e,t){let n=t.getChildren()?t.getChildren().length:0;return"-1"===e&&0==n||("-1"===e||e>=1)&&t.isChildComputed()},exclude3DShape:function(e){return!widget.getValue(d.CONST_SHOW_3DSHAPE)&&"ds6w:Document"==e.instanceOf["ds6w:globalType"]&&"3DShape"==this.app.core.dicoService.syncIsA3DShape(e.instanceOf.type)}})}),define("DS/ENOXEngineer/commands/ProductStructureEdition",["UWA/Class","DS/ApplicationFrame/Command","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/utils/XEngineerConstants","DS/PlatformAPI/PlatformAPI","DS/ENOXEngineer/services/XEngLocalStorage","DS/ENOXEngineer/services/XEngContextManager","DS/ENOXEngineer/utils/Utils","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n,i,r,o,s,a,l){"use strict";return t.extend({init:function(e){this._parent(e),console.info("#ProductStructureEdition: initialized...")},execute:function(e){this.options.ID===i.REPARENT?this.reparentItem(this.options.context):this.options.ID===i.REORDER&&this.reOrderItem(this.options.context)},reOrderItem:function(e){if(Array.isArray(s._activeGridView.sortModel)&&s._activeGridView.sortModel.length>0){n.warningAlert(l.get("disabling_sort_for_product_edition"));let e=s._activeGridView;e.prepareUpdateView(),e.layout.collectionView.sortModel=[],e.layout.saveColumnSortModelInPreferences();let t=e.layout.collectionView.getCustomViewsManager();t&&t.getCurrentCustomView()&&t.getCurrentCustomView().columnsSortModel&&(t.getCurrentCustomView().columnsSortModel=void 0),t.setCustomViews(t.getCustomViews()),e.sortModel=[],e.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!1},!0)}let t=e._activeGridView.dropNode,r=e._activeGridView.draggedNodes,o=null===t.getParent()._parentNode?t.getRealParent():t.getParent(),a=o.getChildren(),c=[];if(Array.isArray(a))for(let e in a)"DocInstance"!==a[e].options.instanceType&&c.push(a[e]);let d=e._activeGridView.dropPosition,u=[],p={};for(let e=0;e<r.length;e++)p[r[e].getRelationID()]=r[e].getRelationID();for(let e=0;e<c.length;e++)if(!p.hasOwnProperty(c[e].getRelationID()))if(c[e].getRelationID()==t.getRelationID()){if("top"===d){for(let e=0;e<r.length;e++)u.push(r[e].getRelationID());u.push(c[e].getRelationID())}else if("bottom"===d){u.push(c[e].getRelationID());for(let e=0;e<r.length;e++)u.push(r[e].getRelationID())}}else u.push(c[e].getRelationID());var g={version:"1.0",order:{type:"RTInstance",count:u.length,children:u}};require(["DS/AuthGenericCommands/AuthGenericCmdWSAccess"],function(t){t.reorder({data:g,modeler:"product",optionalURL:o.getID(),onComplete:function(t){if("success"===(UWA.is(t,"string")?JSON.parse(t):t).status){e._app.core.sessionManager.setAuthoringMode("authoring");let t={},r=e._activeGridView.dropNode,o=null===r.getParent()._parentNode?r.getRealParent():r.getParent();o.getID()!==e.getActiveEngItem().getID()&&(t[i.CONST_TARGET_LEVEL]="1",t.selectedNode=o,o.options.childComputed=!1,o.options.children=o.options.children?[]:o.options.children),e._app.core.sessionManager.buildCurrentSession(t),n.sucessAlert(l.get("reorder_success"))}},onFailure:function(e){console.warn(l.get("reorder_error")),n.errorAlert(l.get("reorder_error"))}})})},reparentItem:function(e){var t=e._activeGridView.dropNode,o=e._activeGridView.draggedNodes,a=[],c=[];if(Array.isArray(o))for(let e in o)c.push(o[e].getRealParent().getID()),s._app.core.sessionManager.shouldShowQuantityView()?c.push(o[e].getUsages()[0].getRelationID()):c.push(o[e].getRelationID()),c.push(o[e].getID()),a.push(c),c=[];if(s._app.core.sessionManager.shouldShowQuantityView()){let e=[];for(let t in o)if(o[t].getUsages().length>1)for(let n=1;n<o[t].getUsages().length;n++)e.push(o[t].getRealParent().getID()),e.push(o[t].getUsages()[n].getRelationID()),e.push(o[t].getID()),a.push(e),e=[]}var d=a.map(function(e){return Array.isArray(e)&&e.length>2?e[1]:null}).filter(function(e){return null!==e}),u=[];t.getID()===e.getActiveEngItem().getID()?u.push([e.getActiveEngItem().getID()]):u.push(t.getOccurrencePath());var p={children:a,parents:u,mode:"CutPaste",commit:!0};require(["DS/UPSCommands/commands/UPSAuthCmdCutCopyPaste"],function(t){var o=new t({context:s.getContext(),ID:"InsertExisting"});e.addSelection(e._activeGridView.dropNode,!0),o.execute({mode:"CutPaste",internal_call:!0,data:p,onSuccess:function(t){r.publish(i.EVENT_REMOVE_CUT_INSTANCES,d);let o=e._activeGridView.dropNode;o.isExpanded()?e.insertNodes({paste:t}):o.expand(),n.sucessAlert(l.get("reparent_success"))},onFailure:function(t){e.resetSelection(),t&&Array.isArray(t.messages)?n.errorAlert(t.messages.toString()):n.errorAlert(l.get("reparent_error"))}})})},buildTargetForReparentObjects:function(e,t){let n,i=e.nodeModel,r={children:t,isInstanceOf:(n="middle"===e.dropPosition?i:i?i.getRealParent():s._activeEngItem).getID(),pathArray:n.getOccurrencePath()};if(!e.nodeModel)return r;let o,a,l=!1;return"bottom"==e.dropPosition?(o=i.getRelationID(),a=e.nodeModel.getNextBrother&&e.nodeModel.getNextBrother()?e.nodeModel.getNextBrother().getRelationID():"",l=!0):"top"==e.dropPosition&&(o=e.nodeModel.getPreviousBrother&&e.nodeModel.getPreviousBrother()?e.nodeModel.getPreviousBrother().getRelationID():"",a=i.getRelationID(),l=!0),l&&(r.order={after:o,before:a}),r},buildPayloadForReParent:function(e,t,n){if(!Array.isArray(e))return"";let i=this.buildTargetForReparentObjects(t,n),r=[];for(let n of e){let e={source:{instance:"",isInstanceOf:n.objectId},target:i};if(this.dragNodeHasParent(t)){let n=t.droppedNodes[0];e.mode="CutPaste",e.source.instance=n.getRelationID(),e.source.pathArray=[t.nodeModel.getRelationID(),n.getRelationID()]}r.push(e)}return{bAllOrNothing:!0,operations:r,version:"1.0"}},buildNewInstancesNodes:function(e){return e.map(function(e){return{parent:e.hasParent,child:e.childIsInstanceOf,instance:e.childInstance,instanceName:e.instanceName,status:"success"}})},dragNodeHasParent:function(e){return e.droppedNodes&&Array.isArray(e.droppedNodes)&&e.droppedNodes.length>0&&e.droppedNodes[0]&&e.droppedNodes[0].getParent()},insertData:function(e,t,o,c){var d=this;"top"!==s._activeGridView.dropPosition&&"bottom"!==s._activeGridView.dropPosition||Array.isArray(s._activeGridView.sortModel)&&s._activeGridView.sortModel.length>0&&n.warningAlert(l.get("insertAtDesiredPlace_withSort"));const u=a._getItemsByTypeFromDroppedData(e,s._app.core.dicoService.localDico),p=t.getID();if(null!=u.VPMReference||null!=u.Document||null!=u.Drawing||null!=u[i.TYPE_CONTROLLED_DOCUMENTS]){if(Array.isArray(u.dsc_matref_ref_Core)){const e=u.dsc_matref_ref_Core.map(e=>e.displayName).join(", ");n.warningAlert(s._app.core.i18nManager.replace(s._app.core.i18nManager.get("eng.ui.dialog.multisel.drop.material.ignored"),{materials:e}))}if(Array.isArray(u.VPMReference)&&s._app.core.dataService.reParentDragAndDrop(d.buildPayloadForReParent(u.VPMReference,c,o)).then(e=>{if("failure"===e.status)return n.errorAlert(e.messages[0]===i.ERR_FUN092398?s._app.core.i18nManager.get("error.ERR_FUN092398"):e.messages);let o=this.buildNewInstancesNodes(e.results);"middle"===s._activeGridView.dropPosition&&t.expand(),d.dragNodeHasParent(c)&&r.publish(i.EVENT_REMOVE_CUT_INSTANCES,[c.droppedNodes[0].getRelationID()]),s._app.core.mediator.publish(i.EVENT_INSTANCES_CREATED,o)}).catch(e=>{console.log(e),n.unexpectedFailure(s._app.core.i18nManager.get("failure.insert.product"))}),Array.isArray(u.Drawing)&&s._app.core.dataService.reParentDragAndDrop(d.buildPayloadForReParent(u.Drawing,c,o)).then(e=>{if("failure"===e.status)return n.errorAlert(e.messages[0]===i.ERR_FUN092398?s._app.core.i18nManager.get("error.ERR_FUN092398"):e.messages);let r=this.buildNewInstancesNodes(e.results);"middle"===s._activeGridView.dropPosition&&t.expand(),s._app.core.mediator.publish(i.EVENT_INSTANCES_CREATED,r)}).catch(e=>{console.error(e),n.errorAlert(e)}),Array.isArray(u.Document)||Array.isArray(u[i.TYPE_CONTROLLED_DOCUMENTS]))for(let e in u)u[e].forEach(function(e){var n=[],r=[];n.push(t),r.push(t.getID()),s._app.core.dataService.attachDocumentToEngItem(t,e.objectId,!1).then(e=>{s._app.core.mediator.publish(i.EVENT_CREATED_NODES,{nodes:[e],parentId:p,selectedNodesToInsert:n,physicalIdList:r}),t.expand()}).catch(e=>{console.error(e)})})}else if(Array.isArray(u.dsc_matref_ref_Core)&&1===u.dsc_matref_ref_Core.length){var g=u.dsc_matref_ref_Core[0],h={id:g.objectId,"ds6w:label":g.displayName,"ds6wg:revision":"","ds6w:type":g.displayType,"ds6w:type_value":g.objectType};"middle"===s._activeGridView.dropPosition&&t.expand(),s._app.core.mediator.publish(i.EVENT_LAUNCH_COMMAND,{commandId:i.ADD_MATERIAL_QUANTITY_CMD,context:{item:h}})}else if(Array.isArray(u.Raw_Material)){const e=u.Raw_Material[0],n={id:e.objectId,"ds6w:label":e.displayName,"ds6wg:revision":"","ds6w:type":e.displayType,"ds6w:type_value":e.objectType};"middle"===s._activeGridView.dropPosition&&t.expand(),s._app.core.mediator.publish(i.EVENT_LAUNCH_COMMAND,{commandId:i.ADD_EXISTING_RAW_MATERIAL_QUANTITY_CMD,context:{item:n}})}}})}),define("DS/ENOXEngineer/componentsHelpers/CollectionView/ENOXResponsiveSetView",["UWA/Core","UWA/Class/Options","UWA/Controls/Abstract","UWA/Class/Promise","DS/CoreEvents/ModelEvents","DS/ENOXEngineer/utils/Utils","DS/Handlebars/Handlebars4","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXCollectionToolBar/js/ENOXCollectionToolBarV2","DS/ENOXEngineer/services/XEngContextManager","DS/ENOXEngineer/utils/MaturityUtils","DS/Utilities/Dom","DS/Controls/TooltipModel","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json","css!DS/ENOXEngineer/componentsHelpers/CollectionView/ENOXResponsiveSetView.css"],function(e,t,n,i,r,o,s,a,l,c,d,u,p,g){"use strict";return n.extend(t,{name:"ENOXResponsiveSetView",_views:[{id:"Tile",loader:"DS/CollectionView/ResponsiveTilesCollectionView",text:g.get("Tile"),fonticon:"view-small-tile"},{id:"Thumbnail",text:g.get("ThumbnailView"),loader:"DS/CollectionView/ResponsiveThumbnailsCollectionView",fonticon:"view-big-thb"},{id:"bigTile",text:g.get("big_tiles_view"),loader:"DS/CollectionView/ResponsiveLargeTilesCollectionView",fonticon:"view-big-tile"}],defaultOptions:{models:null},instanciedViews:{},buildAvailableViewsList:function(){var e=this;this.views=[],e.options.keepDefaultViews&&(this.views=this._views),Array.isArray(e.options.views)&&e.options.views.forEach(function(t){if(t.id&&t.loader&&t.fonticon){var n=(i=t.id,e.views.find(function(e){return e.id===i}));n?(n.loader=t.loader,n.fonticon=t.fonticon):e.views.push(t)}var i})},init:function(t){var n=this;this._parent(t),this.options.models=t.models,delete t.models,this.options.models.pushToTagger(),this.options.models.onPostENOXFiltering=this.afterFiltering.bind(this),this.options.models.onSelectionUpdated=this.updateSelectedItemsCount.bind(this),"function"==typeof this.options.onCellDoubleClick&&(this.onCellDoubleClick=this.options.onCellDoubleClick),this.options=e.extend(this.options,t,!0),this._modelEvents=this.options.modelEvents?this.options.modelEvents:new r,this.buildAvailableViewsList(),this.elements.container=e.createElement("div",{class:this.getClassNames()}),this.loadViewsClass().then(function(e){n.buildView()}).catch(function(e){console.error(e)})},updateSelectedItemsCount:function(e){var t=this.options.models.getSelectedNodes();void 0===e&&t.length;this.setMultiselMenuStatus(e)},selectAll:function(){this.isToolbarSearchApplied?this.options.models.getChildren().forEach(function(e){e.shouldBeVisible()&&e.select()}):this.options.models.selectAll()},unSelectAll:function(){this.options.models.unselectAll()},buildView:function(){this.elements.container=e.createElement("div",{class:this.getClassNames()}),this.elements.gridviewContainer=e.createElement("div",{class:this.getClassNames()+"-gridview"}),this.options.toolbar&&(this.elements.toolbarContainer=e.createElement("div",{class:this.getClassNames()+"-toolbar"}),this.elements.toolbarContainer.inject(this.elements.container,"top"),this.toolbar=this.buildToolbar(),this.toolbar.inject(this.elements.toolbarContainer)),this.elements.gridviewContainer.inject(this.elements.container),this._listenToToolbarEvents(),this.renderPreferredView(),this.elements.container.inject(this.options.container),this.updateCount()},afterFiltering:function(){this.updateCount()},buildToolbar:function(){var e=this.options.toolbar||{},t={modelEvents:this._modelEvents,withmultisel:!0,showItemCount:!0,multiselActionCallback:null,multiselActions:[],sort:e.sort,views:this.views.map(function(e){return{id:e.id,text:e.text,fonticon:e.fonticon}}),currentView:this.getPreferredView(),currentSort:{id:"Title",order:"ASC"},currentNbitems:0,currentNbSelections:0};return new l(t)},search:function(e){this.fileredDocuemnt=null},_listenToToolbarEvents:function(){this.eventsTokens=[];var e=this;this.eventsTokens.push(e._modelEvents.subscribe({event:"enox-collection-toolbar-switch-view-activated"},function(t){e.switchView(t)}));let t=a.EVENT_TOOLBAR_SEARCH;this.eventsTokens.push(e.options.models.core.mediator.subscribe(t,function(t){var n=Array.isArray(t.searchValue)?t.searchValue[0]:"",i=(new Date).getTime();e.options.models.prepareUpdate(),e.options.models.getChildren().forEach(function(e){e.unMatch(n)?e.setSearchFilterState(!0):e.setSearchFilterState(!1),e.applyFilters()}),e.options.models.pushUpdate(),e.updateCount(),e.isToolbarSearchApplied=!!n,console.warn("ending search in "+((new Date).getTime()-i)+"ms")})),this.eventsTokens.push(e._modelEvents.subscribe({event:"enox-collection-toolbar-all-selected"},function(){e.selectAll()})),this.eventsTokens.push(e._modelEvents.subscribe({event:"enox-collection-toolbar-all-unselected"},function(){e.unSelectAll()})),this.eventsTokens.push(e._modelEvents.subscribe({event:"enox-collection-toolbar-click-multiselect-icon"},function(t){e.onMultiselClick(t.object.elements.container)})),this.eventsTokens.push(e._modelEvents.subscribe({event:"enox-collection-toolbar-sort-activated"},function(t){var n=(new Date).getTime();e.options.models.prepareUpdate(),console.warn(t);var i="asc"===(t.sortOrder||"").toLowerCase()?1:-1;e.options.models._getTrueRoot().sortChildren({isRecursive:!0,sortFunction:function(e,n){return i*(e.getSortableAttributeValue(t.sortAttribute)<n.getSortableAttributeValue(t.sortAttribute)?-1:1)}}),e.options.models.pushUpdate(),console.warn("ending search in "+((new Date).getTime()-n)+"ms")}))},updateCount:function(){var e=this.options.models?this.options.models._getTrueRoot():null,t=this.options.models?this.options.models.getSelectedNodes():[],n=e?e.getNumberOfVisibleDescendants():0;this._modelEvents.publish({event:"enox-collection-toolbar-items-count-update",data:n}),n||this._modelEvents.publish({event:"enox-collection-toolbar-visibility-iconMultipleActionBar",data:!1}),this.setMultiselMenuStatus(t.length)},setMultiselMenuStatus:function(e){e>0?(this._modelEvents.publish({event:"enox-collection-toolbar-visibility-iconMultipleActionBar",data:!0}),this._modelEvents.publish({event:"enox-collection-toolbar-multiselect-icon-update-count",data:e})):(this._modelEvents.publish({event:"enox-collection-toolbar-visibility-iconMultipleActionBar",data:!1}),this._modelEvents.publish({event:"enox-collection-toolbar-select-all-checkbox-uncheck",data:""}))},applyFilter:function(){},switchView:function(e){this.hidePreviousView(),this.preferredView=e,this._modelEvents.publish({event:"event-persist-view",data:e}),this.renderPreferredView()},hidePreviousView:function(){var e=this;Object.keys(this.instanciedViews).forEach(function(t){e.instanciedViews[t].elements.container.classList.remove("visible")})},renderPreferredView:function(){this.getPreferredViewInstance().elements.container.classList.add("visible")},onMultiselClick:function(e){e&&(this.options.models.core.contextManager.setMultiselMenu(!0),this.options.models.getSelectedItemsCommonMenu(e.getBoundingClientRect()))},onCellDoubleClick:function(){console.log("doubleclick observed ! ")},getViewOptions:function(){return e.extend({},{height:"inherit",displayedOptionalCellProperties:["contextualMenu","activeFlag"],useDragAndDrop:!0,onDragStartCell:function(e,t){var n,i=t.nodeModel;i&&(n=i.getTreeDocument()),e.dataTransfer.effectAllowed="all";var r=o.prepareDragData(n.getSelectedNodes());return e.dataTransfer.setData("Text",r),!0}},!0)},getSubLabel:function(e){var t=e.options.appCore.settingManager.getSetting("defaultPolicies");e.options.appCore.dataService.getStatesAttributes(t);var n=e.getDisplayedGridViewAttribute();return this.buildSpanSublabel(e.options,n)},buildSpanSublabel:function(e,t){var n=this;let i=u.createElement("span",{class:"eno-xen-tile-subLabel"});return t.forEach(function(t){var r=null,s=null;"ds6w:status"===t?n.buildSpanStatus(i,e.grid[a.CONST_CURRENT_OBJECT_MATURITY_STATE],e.grid[t],!1):((r=u.createElement("span",{class:"eno-xen-tile-subLabel-divider"})).innerText="|",i.appendChild(r),"ds6w:responsible"===t?n.buildSpanOwner(i,e.grid[t]):((s=u.createElement("span",{class:"eno-xen-tile-subLabel-value"})).innerText="ds6w:created"===t||"ds6w:modified"===t?o.getformatedDate(e.grid[t]):e.grid[t],i.appendChild(s)))}),i},buildSpanStatus:function(e,t,n,i){if(t&&n){var r=Array.isArray(t)?"":d.getAndCreateMaturityClass(t,"wux-controls-label");let o=u.createElement("div",{class:r}),s=u.createElement("span",{class:"wux-controls-label"});i?s.classList.add("eno-xen-tile-tooltip-status"):s.classList.add("eno-xen-tile-status"),s.innerText=n,o.appendChild(s),e.appendChild(o)}},buildSpanOwner:function(e,t){if(t){let n=u.createElement("span",{class:"eno-xen-tile-owner"}),i={iconName:"topbar-user",fontIconFamily:1,className:"eno-xen-tile-owner-icon owner-font"},r=u.generateIcon(i);n.appendChild(r);let o=u.createElement("span",{class:"eno-xen-tile-subLabel-owner-label"});o.innerText=t,n.appendChild(o),e.appendChild(n)}},getTooltip:function(e){var t=e.getAllGridViewAttribute();let n=this.buildSpanTooltip(e.options,t);return new p({title:e.getLabel(),shortHelp:n,allowUnsafeHTMLShortHelp:!0,updateModel:!1,wrapThreshold:375})},buildSpanTooltip:function(e,t){var n=this;let i=u.createElement("div",{class:"eno-xen-tile-tooltip"});return t.forEach(function(t){var r=null,s=null,l=null;r=u.createElement("span",{class:"eno-xen-tile-tooltip-row"}),i.appendChild(r),(s=u.createElement("span",{class:"eno-xen-tile-tooltip-label"})).innerText=e.appCore.i18nManager.get(t),r.appendChild(s),l=u.createElement("span",{class:"eno-xen-tile-tooltip-value"}),"ds6w:responsible"===t?n.buildSpanOwner(r,e.grid[t]):"ds6w:status"===t?n.buildSpanStatus(r,e.grid[a.CONST_CURRENT_OBJECT_MATURITY_STATE],e.grid[t],!0):(l.innerText="ds6w:created"===t||"ds6w:modified"===t?o.getformatedDate(e.grid[t]):e.grid[t],r.appendChild(l))}),i},configureViewInstance:function(t){var n=this;t.selectionBehavior={canInteractiveMultiselectWithCheckboxClick:!0,canMultiSelect:!0,enableFeedbackForActiveCell:!0,enableShiftSelection:!0,toggle:!0,unselectAllOnEmptyArea:!0},t.onDragStartCellDefault=function(e){return!0},t.onCellDoubleClick(n.onCellDoubleClick.bind(n)),t.allowUnsafeHTMLContent=!0,t.getLabel=function(t){return e.String.escapeHTML(t.getLabel())+" - "+t.getReferenceVersion()},t.getSubLabel=function(e){return n.getSubLabel(e)},t.allowUnsafeHTMLContent=!0,t.getCustomTooltip=function(e){return n.getTooltip(e)},t.onContextualEvent={callback:function(e){var t=[];e&&e.cellInfos&&(e.cellInfos.cellModel&&(t=e.cellInfos.cellModel.getEngineeringMenu(a.MY_ENG_ITEMS_VIEW)));return t}},t.model=n.options.models},getPreferredViewInstance:function(){if(!this.instanciedViews[this.getPreferredView()]){var e=this._getViewClass(this.getPreferredView());this.instanciedViews[this.getPreferredView()]=new e(this.getViewOptions()),this.activeView=this.instanciedViews[this.getPreferredView()],this.activeView.getContent().inject(this.elements.gridviewContainer),this.configureViewInstance(this.activeView)}return this.instanciedViews[this.getPreferredView()]},getPreferredView:function(){if(this.preferredView)return this.preferredView;if(this.options.defaultView){this.views=this.views||[];for(var e=0;e<this.views.length;e++)if(this.views[e].id===this.options.defaultView)return this.preferredView=this.views[e].id,this.views[e].id}return this.preferredView=this.views[0].id,this.views[0].id},_getViewClass:function(e){for(var t=0;t<this.views.length;t++)if(this.views[t].id===e)return this.views[t].Clazz;return null},loadViewsClass:function(){var e=this;return this.classLoaderPromise?this.classLoaderPromise:(this.classLoaderPromise=new i(function(t,n){var r;(r=e.views.map(function(e){return e.loader}),new i(function(e,t){var n=function(e){t(e)};Array.isArray(r)?require(r,function(){e(arguments)},n):n(r)})).then(function(n){for(var i=0;i<e.views.length;i++)e.views[i].Clazz=n[i];e.views=Object.freeze(e.views),t(e.views)}).catch(function(e){n(e)})}),this.classLoaderPromise)},destroy:function(){for(var e=this,t=Object.keys(this.instanciedViews),n=0;n<t.length;n++){if("function"==typeof this.instanciedViews[t[n]].destroy)try{this.instanciedViews[t[n]].destroy()}catch(e){console.error(e)}delete this.instanciedViews[t[n]]}this.options.models.getChildren().forEach(function(e){e._unsetParent()}),this.options.models.removeFromTagger(),this.eventsTokens&&this.eventsTokens.forEach(function(t){e._modelEvents.unsubscribe(t)})}})}),define("DS/ENOXEngineer/components/XEngGridView/js/XEngGridViewV2",["DS/ENOXEngineerCommonUtils/XENMask","DS/ResizeSensor/js/ResizeSensor","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/componentsHelpers/InviteDnD/DnDInvite","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/components/NavigationTopBar/NavigationTopBar","DS/ENOXEngineer/collections/XEngGridTreeDocument","DS/ENOXEngineer/componentsHelpers/CollectionView/ENOXResponsiveSetView","DS/PlatformAPI/PlatformAPI","css!DS/ENOXEngineer/components/XEngGridView/css/XEngGridView.css","css!DS/UIKIT/UIKIT.css"],function(e,t,n,i,r,o,s,a,l,c){"use strict";return function(d){var u=d.getContainer(),p=document.createElement("div");p.classList.add("xen-landingpage-topbar");var g=document.createElement("div");return g.classList.add("xen-landingpage-list"),{_authoredDataPromise:null,_refreshSubscription:null,start:function(){var e=this;this.preloadLatestUpdates(),d.options.getComponentData(d.dataService).then(function(t){e.nodesCache=t||[],e._buildUI(t||[]),e.reflectUpdates(),d.publish(i.EVENT_MY_EN_ITEM_READY)}).catch(function(t){e._buildUI([]),d.core.PersistencyManager.restoreViewForHomePage(this.models),d.publish(i.EVENT_MY_EN_ITEM_READY),d.core.logger.error(t),o.unexpectedFailure(d.i18nManager.replace(d.i18nManager.get("failure.fetch.homePage.content"),{content:d.i18nManager.get(d.options.getViewName())}))}),e._navigationTopBar=new s,e._navigationTopBar.init(d,p),e._navigationTopBar.setTitle(d.options.getTitle())},shouldUseDBRefreseh:function(){return"my_eng_items"===d.options.getViewName()&&d.core.sessionManager.isUsingDB()},preloadLatestUpdates:function(){this._authoredDataPromise=d.dataService.getUserRecentEditedEngineeringItems()},reflectUpdates:function(){var t=this;this._authoredDataPromise?(e.mask(u,d.i18nManager.get("processing.synchronization.with.server")),this._authoredDataPromise.then(function(n){if(Array.isArray(n)){var i={onlyUpdateExistingNodes:"recent_items"===d.options.getViewName(),additionalIds:d.dataService.recentsCache};t.models.mergeContent(n,i),t.nodesCache=t.models.getChildren(),t.models.core.PersistencyManager.restoreViewForHomePage(t.models),t.models.pushToTagger(),t.myResponsiveSetView&&t.myResponsiveSetView.updateCount(),e.unmask(u),t.switchView()}}).catch(function(e){console.error(e)})):t.switchView()},reRender:function(){this._buildUI(this.nodesCache),d.core.PersistencyManager.restoreViewForHomePage(this.models)},stop:function(){this.resizor&&this.resizor.detach(u),this.resizor=void 0,c.unsubscribe(this._refreshSubscription),d.publish(i.EVENT_SHOW_PROPERTIES,{nodes:[]}),this.destroyCurrentView(),this._navigationTopBar&&(this._navigationTopBar=void 0),this.models=null,d.core&&d.core.contextManager.setActiveDocument(null),n.cleanDroppable(u),d.emptyContainer(),d.unsubscribeAll()},destroyCurrentView:function(){if(this.myResponsiveSetView){this.myResponsiveSetView._modelEvents&&this.myResponsiveSetView._modelEvents.unsubscribe(this.PersistToken);try{this.myResponsiveSetView.destroy()}catch(e){console.error(e)}this.myResponsiveSetView=null}if(this.emptyView){try{this.emptyView.destroy()}catch(e){console.error(e)}this.emptyView=null}g.innerHTML=""},switchView:function(){this.myResponsiveSetView||this.emptyView?this.myResponsiveSetView&&this.isEmpty()?(this.destroyCurrentView(),this.renderEmptyView()):this.emptyView&&!this.isEmpty()&&(this.destroyCurrentView(),this.RenderSetView()):this.isEmpty()?this.renderEmptyView():this.RenderSetView()},isEmpty:function(){return!this.models||0===this.models.getChildren().length},renderEmptyView:function(){this.emptyView=d.core.moduleHelper.viewsService.getGridEmptyView(d.options.getViewName()),this.emptyView&&this.emptyView.inject(g)},_buildUI:function(n){var r=this,s=new a({core:d.core,shouldAcceptDrag:function(){return!0},shouldAcceptDrop:function(e){return!0}});s._FilterBI.cleanProxy(),n&&s.addChild(n),e.unmask(u),this.models=s,d.core.contextManager.setActiveDocument(s),this.switchView(),d.subscribe(i.EVENT_DELETED_ENG_ITEM,function(e){for(var t=e.ids,n=[],i=s.getChildren(),o=0;o<i.length;o++)-1!=t.indexOf(i[o].getID())&&n.push(i[o]);s.prepareUpdate(),n.forEach(function(e){s.removeRoot(e)}),s.pushUpdate(),r.myResponsiveSetView.updateCount(),r.isEmpty()&&(r.destroyCurrentView(),r.renderEmptyView())}),d.subscribe(i.EVENT_REMOVED_FROM_RECENT,function(e){for(var t=e.nodes.map(function(e){return e.getID()}),n=[],i=s.getChildren(),o=0;o<i.length;o++)-1!=t.indexOf(i[o].getID())&&n.push(i[o]);s.prepareUpdate(),n.forEach(function(e){s.removeRoot(e)}),s.pushUpdate(),r.myResponsiveSetView.updateCount(),r.isEmpty()&&(r.destroyCurrentView(),r.renderEmptyView())}),r._refreshSubscription=c.subscribe("DS/PADUtils/PADCommandProxy/refresh",function(e){var t=[];e.data.authored&&e.data.authored.modified&&e.data.authored.modified.forEach(function(e){"object"==typeof e?t.push(e.physicalid):t.push(e)}),d.dataService.getEngItemsData(t,!0).then(function(e){s.prepareUpdate(),e.forEach(function(e){var t=s.findNodesById(e.getID());t.length>0&&t.forEach(function(t){"ENOStrRefinementSpecification"===t.getType()||t.updateOptions(e.options)})}),s.pushUpdate()}).catch(function(e){console.error(e)})}),r._makeDroppable(),u.appendChild(p),u.appendChild(g),d.subscribe(i.EVENT_REFRESH_LANDING_DATA,function(){r.preloadLatestUpdates(),d.options.getComponentData(d.dataService).then(function(e){r.nodesCache=e||[],r.models&&r.models.syncContent(e||[]),r.myResponsiveSetView&&r.myResponsiveSetView.updateCount(),r.reflectUpdates()}).catch(function(e){d.core.logger.error(e),o.unexpectedFailure(d.i18nManager.replace(d.i18nManager.get("failure.fetch.homePage.content"),{content:d.i18nManager.get(d.options.getViewName())}))})}),d.subscribe(i.EVENT_TRIPTYCH_PANEL_VISIBLE,function(e){"right"===e&&d.core.PersistencyManager.setInformationPanelStatusForHomePage(!0)}),d.subscribe(i.EVENT_TRIPTYCH_PANEL_HIDDEN,function(e){"right"===e&&d.core.PersistencyManager.setInformationPanelStatusForHomePage(!1)}),d.subscribe(i.EVENT_TRIPTYCH_RESIZE_PANEL,e=>{const t=e?e.side:null,n=e?e.width:null;if("right"===t&&n){const e=d.core.PersistencyManager;e&&e.setInformationPanelWidth(n)}}),r.resizor=new t(u,function(){})},_makeDroppable:function(){var e,t=function(e){var t=new r({renderTo:e});return t.hide(),t}(u),s=this;n.makeDroppable({element:u,context:this,onDragEnter:function(){clearTimeout(e),s.isEmpty()||(t.addBorder(),t.show("drop")),u.hasClassName("dragging")||u.addClassName("dragging")},onDragLeave:function(){e=setTimeout(function(){s.isEmpty()||t.hide(),u.hasClassName("dragging")&&u.removeClassName("dragging")},200)},onDragOver:function(){s.isEmpty()||t.show("drop"),u.hasClassName("dragging")||u.addClassName("dragging")},onDrop:function(e,n){var r=null;s.isEmpty()||t.hide(),u.removeClassName("dragging");try{r=JSON.parse(e)}catch(e){return void o.errorAlert(d.i18nManager.get("error.parse.droppeddata.failed"))}d.core.settingManager.retrieveValidItemsForOpenFromDrop(r).then(function(e){Array.isArray(e)&&e.length>0&&d.publish(i.EVENT_LAUNCH_COMMAND,{commandId:i.OPEN_ENG_ITEM,context:{item:{objectId:e[0].objectId,objectType:e[0].objectType,biProxyCtx:e[0].biProxyCtx}}})}).catch(function(e){e&&e.message&&o.errorAlert(d.i18nManager.get(e.message))})}})},onFilterBIFilteringEvent:function(){},onMultiselClick:function(e){e&&(this.models.core.contextManager.setMultiselMenu(!0),this.models.getSelectedItemsCommonMenu(e.getBoundingClientRect()))},RenderSetView:function(){var e={views:[],keepDefaultViews:!0,models:this.models,withmultisel:!0,container:g,modelEvents:null,onCellDoubleClick:function(e){var t=e.cellModel;t&&d.publish(i.EVENT_LAUNCH_COMMAND,{commandId:i.OPEN_ENG_ITEM,context:{item:{objectId:t.getID(),objectType:t.getType()}}})},defaultView:d.options.getPreferredView(d.core.localStorage)||"Thumbnail",toolbar:{showItemCount:!0,multiselActionCallback:null,multiselActions:[],actions:[],sort:[{id:"Title",text:d.i18nManager.get("ds6w:label"),type:"string"},{id:"Maturity",text:d.i18nManager.get("ds6w:status"),type:"string"},{id:"Owner",text:d.i18nManager.get("ds6w:responsible"),type:"string"},{id:"CreationDate",text:d.i18nManager.get("ds6w:created"),type:"string"},{id:"ModifiedDate",text:d.i18nManager.get("ds6w:modified"),type:"string"}]}};this.myResponsiveSetView=new l(e),this.PersistToken=this.myResponsiveSetView._modelEvents.subscribe({event:"event-persist-view"},function(e){d.core.localStorage.setItem(d.options.getViewName()+"_view",e)})}}}}),define("DS/ENOXEngineer/commands/BaseReportCmd",["DS/ENOXEngineer/services/XEngContextManager","DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOX3DSpaceAttributesMgt/services/loadModuleUtils","DS/ENOXEngineerCommonUtils/xEngAlertManager"],(e,t,n,i)=>{let r=null;n.loadRuntimeLibrary("DS/CATRgrReportWizard/ReportWizardCmd").then(e=>{r=e}).catch(e=>{});return class extends t{constructor(e){super({...e,isAsynchronous:!0,mode:"exclusive"},e.ID)}beginExecute(){if(!r)return i.errorAlert(this.nls.get("failure.ReportCmd.noMedia")),this.end();this.BaseClazz=r}}}),define("DS/ENOXEngineer/commands/ReportWizardCmd",["DS/ENOXEngineer/commands/BaseReportCmd","DS/ENOXEngineer/services/XEngContextManager","DS/ENOX3DSpaceAttributesMgt/services/predicatesServices","DS/ENOXEngineerCommonUtils/xEngAlertManager"],(e,t,n,i)=>{return class extends e{get isAuthorizedAsAuthor(){const e=["VPLMViewer","3DSRestrictedReader"];let t=!0;const n=this.options.appCore.settingManager.getSecurityContext();if("string"==typeof n){const[i]=n.split(".",1);i.trim().length&&(t=-1===e.indexOf(i))}return t}executeCommand(e){e&&"function"==typeof e.begin&&e.begin()}execute(){if(!this.isAuthorizedAsAuthor)return i.errorAlert(this.nls.get("failure.ReportCmd.noAuthorRights")),this.end();const[e]=t.getContext().getSelectedNodes(),n={userSelection:[e],...this.options},r=new this.BaseClazz(n);return this.executeCommand(r),this.end()}}}),define("DS/ENOXEngineer/commands/ListReportsCmd",["UWA/Core","DS/ENOXEngineer/componentsHelpers/ENOXListReportsView/js/ENOXListReportsViewModel","DS/ENOXEngineer/componentsHelpers/ENOXListReportsView/js/ENOXListReportsView","DS/ENOXEngineer/commands/BaseReportCmd","DS/ENOXEngineer/services/XEngContextManager","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/services/EngineeringSettings","DS/ENOXEngineer/utils/XENHttpClient","DS/ENOXEngineer/utils/XEngineerConstants","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Loader","DS/Controls/ModalContainer","DS/DocumentManagement/DocumentManagement"],(e,t,n,i,r,o,s,a,l,c,d,u,p,g)=>{return class extends i{async execute(){const[e]=r.getContext().getSelectedNodes(),i=e.getID();try{const{appCore:e}=this.options,r=new t({appCore:e}),s=new n({appCore:e,viewModel:r.model,callbacks:{download:this.downloadDocument.bind(this)}});this.viewContext={reportsView:s,reportsViewModel:r},this.buildModalView(),this.activateLoadingInfo();const a=await this.fetchCompatiblesReportsFromIds([i]);await this.displayReports(a)}catch(e){o.errorNotif({message:this.nls.get("failure.ReportCmd.retreive")})}finally{this.deactivateLoadingInfo()}}async displayReports(e){if(!Array.isArray(e))throw new Error("displayReports invalid inputs");if(!e.length)return;const t=await this.updateReportsWithGenerationStatus(e);this.viewContext.reportsViewModel.addReports(t),this.updateRunningReportsStateIfAny(t)}isReportBeingGenerated(e){const{generation:t}=e||{};if(!t)return!1;const{status:n,remainingTime:i}=t;return i>0||"string"==typeof n&&-1!==["created","running"].indexOf(n.toLowerCase())}async updateRunningReportsStateIfAny(e){const t=e.filter(e=>this.isReportBeingGenerated(e));if(!t.length)return;const{reportsViewModel:n}=this.viewContext;if(!n)return;const i=t.map(e=>{const{physicalid:t,generation:n}=e,{remainingTime:i}=n||{};return{physicalid:t,remainingTime:i}}),r=i.reduce((e,t)=>t.remainingTime<e?t.remainingTime:e,i[0].remainingTime);let o=null;await new Promise(e=>setTimeout(async()=>{try{o=await this.updateReportsWithGenerationStatus(t)}finally{e()}},r+1e3));const s=[],a=[];o.forEach(e=>{this.isReportBeingGenerated(e)?s.push(e):a.push(e)}),a.length&&n.updateReports(a),s.length&&this.updateRunningReportsStateIfAny(s)}activateLoadingInfo(){if(this.isLoading)return;const{reportsView:e}=this.viewContext,t=e?e.view:null;if(!t)throw new Error("unexpected state");const n=this.nls.get("loading"),i=new u({text:n});i.on(n),p.createModal(t,i.elements.container),this.isLoading=!0}deactivateLoadingInfo(){if(!this.isLoading)return;const{reportsView:e}=this.viewContext,t=e?e.view:null;if(!t)throw new Error("unexpected state");p.removeModal(t),this.isLoading=!1}buildModalView(){const{reportsView:e}=this.viewContext,t=e?e.view:null;if(!t)throw new Error("unexpected state");const n=this.options.appCore.moduleHelper.viewsService.getApplicationImmersiveFrame(),i=this.nls.get("ReportCmd.AvailableReports");this.modal=this.instanciateDialog({title:i,content:t,immersiveFrame:n,usePaddingFlag:!1,resizableFlag:!0,modalFlag:!0,width:850,height:200,buttons:{Close:new d({label:this.nls.get("eng.ui.button.save"),disabled:!1,onClick:()=>{this.modal.close(),this.onClose.bind(this)}})}}),this.modal.addEventListener("close",this.onClose.bind(this)),this.modal.show()}onClose(){this.end()}instanciateDialog(e){return new c(e)}async fetchCompatiblesReportsFromIds(e){if(!Array.isArray(e)||!e.length)throw new Error("fetchCompatiblesReportsFromIds invalid input");const t=(await this.getCompatibleReportsFromIds(e)).filter(t=>{const{input_object:n,outputs:i}=t,{physicalid:r}=n||{},{ReportsFromInputs:o}=i||{};return-1!==e.indexOf(r)&&Array.isArray(o)&&o.length}),n=[];return t.forEach(e=>n.push(...e.outputs.ReportsFromInputs)),n}sliceIntoChunks(e,t=10){const n=[];for(let i=0;i<e.length;i+=t){const r=e.slice(i,i+t);n.push(r)}return n}async updateReportsWithGenerationStatus(e){if(!Array.isArray(e)||!e.length)throw new Error("updateReportsWithGenerationStatus invalid inputs");const t=e.map(e=>e.physicalid),n=this.sliceIntoChunks(t,10),i=[];return await n.reduce(async(e,t)=>{await e;const n=await a.perform(s.getCommand("reportGenerationStatus"),t),{reports:r,status:o}=n||{},{success:l}=o||{};if(!l||!Array.isArray(r))throw new Error("updateReportsWithGenerationStatus fails");i.push(...r)},Promise.resolve()),e.map(e=>{const t=i.find(t=>t.id===e.physicalid),{generation:n,targetDocument:r}=t||{};return{...e,generation:n,targetDocument:r}})}async downloadDocument(e){const{targetDocument:t}=e||{},{id:n,reportFile:i}=t||{},{id:r}=i||{};try{await new Promise((e,t)=>{const i={tenant:this.appCore.settingManager.getPlatformId(),securityContext:this.appCore.settingManager.getSecurityContext(),tenantUrl:this.appCore.settingManager.getDefault3DSpaceUrl(),additionalHeaders:this.appCore.settingManager.getWorkUnderHeaders(),autoDownload:!0,onFailure(e){t(e)},onComplete:e};g.downloadDocument(n,r,!1,i)}),o.sucessAlert(this.nls.get("eng.operation.downloadDocument.sucess"))}catch(e){o.errorAlert(e.data&&e.data[0]?e.data[0].updateMessage:e)}}async getCompatibleReportsFromIds(e){if(!Array.isArray(e)||!e.length)throw new Error("getCompatibleReportsFromIds invalid input");const t={input_physical_ids:e,primitives:[{navigate_from_sr:{id:1,filter:{role:["328"]}},navigate_from_rel:{id:2}}],attributes:["name","label","revision","owner","type","originated"],patterns:{ReportsFromInputs:[{id:"1"},{id:"2"}]},version:3,label:`XEN ListReportsCmd - ${Date.now()}`},n=await a.perform(s.getCommand("cv_navigate"),t),{infos:i,result:r}=n||{},{status:o}=i||{};if("OK"!==o||!Array.isArray(r))throw new Error("getCompatibleReportsFromIds fails");return r}}}),define("DS/ENOXEngineer/componentsHelpers/mixins/ListToolbarBuilder",["DS/ENOXCollectionToolBar/js/ENOXCollectionToolBarV2","i18n!DS/ENOXCollectionToolBar/assets/nls/ENOXCollectionToolBar","DS/ENOXEngineer/componentsHelpers/CollectionView/ENOXResponsiveSetView"],function(e,t,n){"use strict";function i(e){if(this.buildDefaultOptionsSkeleton(),!e||!e.modelEvents)throw new Error("modelEvents is a mandatory parameter");if(this.options.modelEvents=e.modelEvents,this.parentSandbox=e.sandbox,this.releatedView=e.ListView,this.options.useWebUITooltip=!0,!e||!e.container)throw new Error("container is a mandatory parameter");this.toolbarContainer=this.createActionBarWrapper(),this.toolbarContainer.inject(e.container,"top")}return i.prototype.getActions=function(){return this.options.actions},i.prototype.getSorts=function(){return this.options.sort},i.prototype.addAction=function(e){if(!e||!e.id||!e.text)throw new Error("invalid action definition for addAction");return this.getActions().push(e),this},i.prototype.addActions=function(e){if(!Array.isArray(e))throw new Error("invalid input for addActions ");var t=this;return e.forEach(function(e){t.addAction(e)}),this},i.prototype.setDefaultView=function(e){if(!e)throw new Error("invalid viewId");return this.options.currentView=e,this},i.prototype.addSort=function(e){if(!(e&&e.id&&e.text&&e.type))throw new Error("invalid sort definition for addSort");return this.getSorts().push({id:e.id,text:e.text,type:e.type}),widget.getValue("sorting")?this.options.currentSort={id:widget.getValue("sorting").sortAttribute,order:widget.getValue("sorting").sortOrder}:1===this.getSorts().length&&(this.options.currentSort={id:e.id,order:"ASC"}),this},i.prototype.addSorts=function(e){if(!Array.isArray(e))throw new Error("invalid input for addSorts ");var t=this;return e.forEach(function(e){t.addSort(e)}),this},i.prototype.getViews=function(){return this.options.views},i.prototype.addView=function(e){if(!(e&&e.id&&e.text&&e.fonticon))throw new Error("invalid view definition for addView");return this.getViews().push({id:e.id,text:e.text,fonticon:e.fonticon}),this},i.prototype.addViews=function(e){if(!Array.isArray(e))throw new Error("invalid input for addViews ");var t=this;return e.forEach(function(e){t.addView(e)}),this},i.prototype.getMultselActions=function(){return this.options.multiselActions},i.prototype.addMultiselAction=function(e){if(!(e&&e.id&&e.text&&e.fonticon&&e.handler instanceof Function))throw new Error("invalid MultiselAction definition for addMultiselAction");return this.getMultselActions().push({id:e.id,text:e.text,handler:e.handler,fonticon:e.fonticon}),this},i.prototype.addMultiselActions=function(e){if(!Array.isArray(e))throw new Error("invalid input for addViews ");var t=this;return e.forEach(function(e){t.addMultiselAction(e)}),this},i.prototype.registeronMultiselClick=function(e){return this.options.multiselActionCallback=e,this},i.prototype.buildDefaultOptionsSkeleton=function(){return this.options={modelEvents:null,withmultisel:!1,showItemCount:!0,components:!0,multiselActions:[],multiselActionCallback:null,actions:[],sort:[],views:[],currentView:null,currentSort:null,currentNbitems:0,currentNbSelections:0},this},i.prototype.build=function(){let t=Object.assign({},this.options);delete t.views,delete t.sort,this.toolbarView=new e(t),this.toolbarContainer.empty instanceof Function?this.toolbarContainer.empty():this.toolbarContainer.innerHTML="",this.toolbarView._modelEvents.subscribe("enox-collection-toolbar-all-selected",function(){console.log("inside of subscribe"),this.selectAll()}),this.toolbarView.inject(this.toolbarContainer),this.toolbarView.attachResizeSensor()},i.prototype.createActionBarWrapper=function(){return UWA.createElement("div",{id:"listview-toolbar",styles:{height:"40px",width:"inherit"}})},i.prototype.updateCount=function(){console.warn("new count "+count)},i.prototype.destroy=function(){this.options=null,this.toolbarView=null,this.toolbarContainer.empty instanceof Function?this.toolbarContainer.empty():this.toolbarContainer.innerHTML="",this.toolbarView=null},i}),define("DS/ENOXEngineer/services/SessionPredicates/PredicatesProviderFactory",["DS/ENOXEngineer/services/SessionPredicates/SessionPredicatesErrors","DS/ENOXEngineer/services/SessionPredicates/PredicatesProvider","DS/ENOXEngineerCommonUtils/LoggerUtils","DS/ENOXEngineer/services/SessionPredicates/Utils"],(e,t,n,i)=>{const{WrongInput:r}=e,{Logger:o}=n,{constants:s}=i,a=o.create(s.SESSION_PREDICATES_LOGGER_ID,"PredicatesProviderFactory");class l{constructor(e){this.appCore=e}static async instanciateProviders(e){const{providerClasses:t,appCore:n}=e||{};if(!Array.isArray(t)||!t.length||!n)throw r("PredicatesProviderFactory.instanciateProviders");const i=new l(n);let o=null;try{const e=i.instanciateClasses(t),n=i.filterWithPredicatesProviderInstances(e);o=i.initializeProviderInstances(n)}catch(e){a.error("errors in PredicatesProviderFactory.instanciateProviders")}return o}instanciateClasses(e){return e.map(e=>new e)}filterWithPredicatesProviderInstances(e){return e.filter(e=>e instanceof t)}initializeProviderInstances(e){const t=[];return e.forEach(e=>{try{e.initialize(this.appCore),t.push(e)}catch(t){a.error(`provider initialization ${e.label} fails, ${t}`)}}),t}}return l}),define("DS/ENOXEngineer/services/SessionPredicatesService",["DS/ENOXEngineer/services/SessionPredicates/PredicatesProviderFactory","DS/ENOXEngineer/services/SessionPredicates/DicoPredicatesProvider","DS/ENOXEngineer/services/SessionPredicates/ClassifPredicatesProvider","DS/ENOXEngineer/services/SessionPredicates/SessionPredicatesErrors","DS/ENOXEngineerCommonUtils/LoggerUtils","DS/ENOXEngineer/services/SessionPredicates/Utils"],(e,t,n,i,r,o)=>{const{WrongInput:s}=i,{Logger:a}=r,{constants:l}=o,c=a.create(l.SESSION_PREDICATES_LOGGER_ID,"SessionPredicatesService");class d{initialize(e){const{core:t}=e||{};if(!t)throw new s("SessionPredicatesService.initialize");this.appCore=t,this.registerManagerOnAppCore(),this.initJob=this.initProviders()}registerManagerOnAppCore(){this.appCore.sessionPredicatesService=this}async initProviders(){let t=[];try{const n=this.getProviderClassesToUse();t=await e.instanciateProviders({providerClasses:n,appCore:this.appCore})}catch(e){c.error(`error in SessionPredicatesService.initProviders ${e}`)}finally{this.loadedProviders=t}}async isReady(){await this.initJob}async waitforProvidersReady(){const e=this.providers.map(e=>e.isBusy());await Promise.allSettled(e)}async findPredicateProperties(e,t){await this.isReady(),await this.waitforProvidersReady();const n=this.getPredicateProperties(e);return"function"==typeof t?n.filter(t):n}getPredicatePropertiesForSelectable(e){return this.providers.reduce((t,n)=>{const i=n.getPredicatePropertiesForSelectable(e);return t.push(...i),t},[])}getPredicateProperties(e){if("string"!=typeof e||!e.trim().length)throw new s("SessionPredicatesService.getPredicateProperties");return this.providers.reduce((t,n)=>{const i=n.getPredicateProperties(e);return t.push(...i),t},[])}getProviderClassesToUse(){return[t,n]}get providers(){return Array.isArray(this.loadedProviders)?this.loadedProviders:[]}}return c.enable?class extends d{async isReady(){await super.isReady(),c.log("isReady resolve")}async waitforProvidersReady(){await super.waitforProvidersReady(),c.log("waitforProvidersReady resolve")}async findPredicateProperties(e,t){c.log(`[ENTER] SessionPredicatesService.findPredicateProperties with ${e}`);const n=await super.findPredicateProperties(e,t);return c.log(` -> found ${n.length} filtered properties: ${JSON.stringify(n)}`),c.log("[EXIT] SessionPredicatesService.findPredicateProperties"),n}}:d}),define("DS/ENOXEngineer/collections/XENContentProxyTreeDocument",["DS/TreeModel/TreeDocument","DS/ENOXEngineer/models/EngItemModel","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/Utils"],(e,t,n,i)=>{return e.extend({defaultOptions:{nodeModelClass:t},init:function(e){var t=e||{};this.core=t.core||{},delete t.core,this._parent(t)},buildSynthesisOptions:function(e){return{enableGrouping:{},ExpandSynthesisON:!0,appOptions:{retreiveTagsonInstance:!0,ident:e}}},buildFetchOptions:function(e){return{appOptions:{ident:e}}},buildFilterOptionsFromViewKey:function(e){let t=null;switch(e){case"fetchSyntesis":t=this.buildFetchOptions;break;default:t=this.buildSynthesisOptions}return Reflect.apply(t,this,[e])},getAvailableFilterOptionKeys:function(){return["fetchSyntesis","expandSyntesis"]},getFilterOptionsFromSessionManager(){const{sessionManager:e}=this.core||{};if(!e)return null;let t="expandSyntesis";return(e.isMyENGViewView()||e.isRecentItemViewView())&&(t="fetchSyntesis"),-1===this.getAvailableFilterOptionKeys().indexOf(t)?(console.debug(`XENFIlterBIPRoxy -> getFilterOptionsFromSessionManager => filterKey ${t} not available from ${this.getAvailableFilterOptionKeys()}`),null):this.buildFilterOptionsFromViewKey(t)},initXENBIFilterProxy:function(e){const t=e?JSON.stringify(e):JSON.stringify({});if(this.filterBIs&&this.filterBIs.has(t))return this._FilterBI=this.filterBIs.get(t),this._FilterBI;const n=this.core.settingManager.getWidgetId(),r=this.core.settingManager.getAppId();return this._FilterBI=function(e,t,n){if(!t||!n)return null;const r=i.initFilterBIProxy(e,t);if("function"==typeof r.setNGFilterOptions){const e={expandServices:["progressive","expand"],expandIntent:"partialPaths",appID:n};r.setNGFilterOptions(e)}return r}(e,n,r),this.filterBIs||(this.filterBIs=new Map),this.filterBIs.set(t,this._FilterBI),console.debug(`XENFIlterBIPRoxy -> initXENBIFilterProxy => new instance ${t}`),console.debug(`XENFIlterBIPRoxy -> Map contains => ${this.filterBIs.size} filter instances`),this.filterBIs.forEach((e,t)=>{console.debug(`XENFIlterBIPRoxy ->  =>  ${t} instance`)}),this._FilterBI},updateXENBIFilterProxy:function(e){return(!this._FilterBI||!this._FilterBI.hasOptions(e))&&(this._FilterBI&&(console.debug(`XENFIlterBIPRoxy -> updateXENBIFilterProxy switching from options -> ${JSON.stringify(this._FilterBI.filterOptions)} to  ${JSON.stringify(e)}`),this._FilterBI.deactivateFilter(),this.core.mediator.publish("XENFilterBIProxy_remove",this._FilterBI),this._FilterBI.removeEvent()),this.initXENBIFilterProxy(e),this._FilterBI&&(this.core.mediator.publish("XENFilterBIProxy_init",this._FilterBI),this._FilterBI.removeAllRoots(!1),this._FilterBI.activateFilter(),console.debug(`XENFIlterBIPRoxy -> updateXENBIFilterProxy activate with ${this._FilterBI.XENRoots.length} roots ${this._FilterBI.XENRoots}`)),!0)},resetXENBIFilterProxy:function(){console.debug("XENFIlterBIPRoxy -> resetXENBIFilterProxy"),this.filterBIs.forEach((e,t)=>{e.removeAllRoots(),e.die()}),this.filterBIs.clear(),this._FilterBI=null},getXENBIFilterProxy:function(e){return this._FilterBI||this.initXENBIFilterProxy(e),this._FilterBI},getSelectedNodes:function(e,t=null){if(!this.core)return[];if(this.core.sessionManager.isItemView()){var n=this._parent();if(!Array.isArray(n)||0===n.length)return[];var i=n[0].getContentModels()&&n[0].getContentModels().getXSO()?n[0].getContentModels().getSelectedNodes():[],r=i.length>0;const o="function"!=typeof t?i.filter(e=>e._isFromOriginalModel()):i.filter(t);return"root"===e||"addToolBar"===e&&!r?[n[0]]:r?o:[n[0]]}var o=this.core.contextManager.getActiveDocument();return o?o.getSelectedNodes():[]},getCurrentTreeDocument:function(){var e=null;if(this.core.sessionManager.isItemView()){var t=this.getChildren()[0];t&&(e=t.getContentModels())}else e=this.core.contextManager.getActiveDocument();return e},findNodesById:function(e){if(!this.core)return[];var t=null;if(this.core.sessionManager.isItemView()){var n=this.getChildren()[0];if(n&&n.getID()===e)return[n];n&&(t=n.getContentModels())}else t=this.core.contextManager.getActiveDocument();return t?t.findNodesById(e):[]},getNodesForCommands:function(e){if(!this.core)return[];if(this.core.sessionManager.isItemView()){var t=this._parent();if(!Array.isArray(t)||0===t.length)return[];var n=t[0].getContentModels()?t[0].getContentModels().getSelectedNodes():[];return n.length>0&&-1!==["root","addToolBar"].indexOf(e)?n:[t[0]]}var i=this.core.contextManager.getActiveDocument();return i?i.getSelectedNodes():[]}})}),define("DS/ENOXEngineer/components/XEngListView/js/mixins/ToolBarManager",["UWA/Core","UWA/Class","DS/CoreEvents/ModelEvents","DS/ENOXEngineer/componentsHelpers/mixins/ListToolbarBuilder","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/UIKIT/Input/Toggle","DS/UIKIT/SuperModal","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/Utils","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/ENOXEngineer/models/EngItemGroupModel","DS/LifecycleServices/LifecycleServicesSettings"],function(e,t,n,i,r,o,s,a,l,c,d,u,p){"use strict";var g=null;const h="enox-collection-toolbar-change-select-subMenu-action";return t.extend({init:function(e){throw new Error("this is an abstract class it shouldn't be instanciated")},initializeToolbar:function(){this._modelEvents=new n,g=new i({modelEvents:this._modelEvents,container:this.getContent(),ListView:this}),this.buildToolBar(),this._listenToToolbarEvents()},updateCount:function(){var e=this.getModels()?this.getModels():null;let t=e?e.getSelectedNodes():[],n=this.sandbox.core.contextManager.getActiveEngItem();var i=(e?e.getChildrenWithoutGroupingNodes():[]).filter(e=>!e.isHiddenByTagger()&&!e.isHiddenBySearch()).length;this._modelEvents.publish({event:"enox-collection-toolbar-items-count-update",data:i}),i||(this.disableMultisel(),this._modelEvents.publish({event:"enox-collection-toolbar-visibility-iconMultipleActionBar",data:!1})),1!==t.length?this.setMultiselMenuStatus(t.length):l.areEngItemsEqual(t[0],n)||this.setMultiselMenuStatus(t.length),this.updateViewsFromCountChange()},updateSelectedItemsCount:function(e){var t=this.getModels()._numberOfNodesInDocument,n=this.getModels().getSelectedNodes(),i=n.length;"XENTile"===this.preferredView&&(i>0?t===i?this._modelEvents.publish({event:a.EVENT_COLLECTION_SELECTALL_CHECKBOX_STATUS_CHECKED}):this._modelEvents.publish({event:a.EVENT_COLLECTION_SELECTALL_CHECKBOX_STATUS_PARTIAL}):this._modelEvents.publish({event:a.EVENT_COLLECTION_SELECTALL_CHECKBOX_STATUS_UNCHECKED})),e||this.disableMultisel(),this.setMultiselMenuStatus(e),this.setExpandMenuStatus(n),this.setFindMenuStatus(n),this.setAddMenuStatus(n),this.setGroupByMenuStatus(n),this.setReorderCmdStatus(n)},setGroupByMenuStatus:function(e){let t=a.EVENT_TOOLBAR_ENABLE;t=this.sandbox.core.contextManager.getActiveEngItem().hasValidTransientGroupingContext()?a.EVENT_TOOLBAR_DISABLE:a.EVENT_TOOLBAR_ENABLE,this._modelEvents.publish({event:t,data:a.GROUPBY_MENU})},setAddMenuStatus:function(e){let t=a.EVENT_TOOLBAR_ENABLE;const{sessionManager:n}=this.sandbox.core;if((n.shouldShowFinalItems()||n.shouldShowMfgView()||n.shouldShowLeafMaterials()||n.shouldShowFlatView())&&(t=a.EVENT_TOOLBAR_DISABLE),t===a.EVENT_TOOLBAR_ENABLE&&Array.isArray(e)&&e.length)for(let n=0;n<e.length;n++)if(e[n]instanceof u&&e[n].isGroupFromExpand()){t=a.EVENT_TOOLBAR_DISABLE;break}const i=Array.isArray(e)?e.filter(e=>!(e instanceof u)):null;if(t===a.EVENT_TOOLBAR_ENABLE&&Array.isArray(i)&&i.length)for(let e=0;e<i.length;e++)if("ds6w:Part"!==i[e]._options.grid["ds6w:globalType"]){t=a.EVENT_TOOLBAR_DISABLE;break}if(t===a.EVENT_TOOLBAR_ENABLE){const e=this.sandbox.core.contextManager.getActiveEngItem(),n=Array.isArray(i)?i.filter(t=>e.getID()!=t.getID()):null;!e.hasValidTransientGroupingContext()||Array.isArray(n)&&n.length||(t=a.EVENT_TOOLBAR_DISABLE)}this._modelEvents.publish({event:t,data:a.ADD_MENU})},setFindMenuStatus:function(e){let t=a.EVENT_TOOLBAR_ENABLE;this.sandbox.core.settingManager.isIndexModeEnabled()||(t=a.EVENT_TOOLBAR_DISABLE);const{sessionManager:n}=this.sandbox.core;if((n.shouldShowFinalItems()||n.shouldShowMfgView()||n.shouldShowLeafMaterials())&&(t=a.EVENT_TOOLBAR_DISABLE),t===a.EVENT_TOOLBAR_ENABLE&&Array.isArray(e)&&e.length)for(let n=0;n<e.length;n++)if(e[n]instanceof u&&e[n].isGroupFromExpand()){t=a.EVENT_TOOLBAR_DISABLE;break}const i=Array.isArray(e)?e.filter(e=>!(e instanceof u)):null;if(t===a.EVENT_TOOLBAR_ENABLE&&Array.isArray(i)&&i.length)for(let e=0;e<i.length;e++)if("ds6w:Part"!==i[e]._options.grid["ds6w:globalType"]){t=a.EVENT_TOOLBAR_DISABLE;break}if(t===a.EVENT_TOOLBAR_ENABLE){const e=this.sandbox.core.contextManager.getActiveEngItem(),r=Array.isArray(i)?i.filter(t=>e.getID()!=t.getID()):null;!e||!e.hasValidTransientGroupingContext()||n.shouldShowFlatView()||Array.isArray(r)&&r.length||(t=a.EVENT_TOOLBAR_DISABLE)}this._modelEvents.publish({event:t,data:a.FIND_MENU})},setReorderCmdStatus:function(e){let t=a.EVENT_TOOLBAR_ENABLE;const{sessionManager:n}=this.sandbox.core;if((n.shouldShowFlatView()||n.shouldShowFinalItems()||n.shouldShowMfgView()||n.shouldShowLeafMaterials()||n.shouldShowQuantityView())&&(t=a.EVENT_TOOLBAR_DISABLE),t===a.EVENT_TOOLBAR_ENABLE&&Array.isArray(e)&&e.length)for(let n=0;n<e.length;n++)if(e[n]instanceof u&&e[n].isGroupFromExpand()){t=a.EVENT_TOOLBAR_DISABLE;break}const i=Array.isArray(e)?e.filter(e=>!(e instanceof u)):null;if(Array.isArray(i)&&i.length>1&&(t=a.EVENT_TOOLBAR_DISABLE),t===a.EVENT_TOOLBAR_ENABLE&&Array.isArray(i)&&i.length)for(let e=0;e<i.length;e++)if("ds6w:Part"!==i[e]._options.grid["ds6w:globalType"]){t=a.EVENT_TOOLBAR_DISABLE;break}if(t===a.EVENT_TOOLBAR_ENABLE){const e=this.sandbox.core.contextManager.getActiveEngItem(),r=Array.isArray(i)?i.filter(t=>e.getID()!=t.getID()):null;!e||!e.hasValidTransientGroupingContext()||n.shouldShowFlatView()||Array.isArray(r)&&r.length||(t=a.EVENT_TOOLBAR_DISABLE)}this._modelEvents.publish({event:t,data:a.LAUNCH_REORDER_CMD})},setExpandMenuStatus:function(e){let t=this.sandbox.sessionManager.shouldShowFinalItems()||this.sandbox.sessionManager.shouldShowLeafMaterials()||this.sandbox.sessionManager.shouldShowFlatView()?a.EVENT_TOOLBAR_DISABLE:a.EVENT_TOOLBAR_ENABLE;if(t===a.EVENT_TOOLBAR_ENABLE&&Array.isArray(e)&&e.length)for(let n=0;n<e.length;n++)if(e[n]instanceof u&&e[n].isGroupFromExpand()){t=a.EVENT_TOOLBAR_DISABLE;break}const n=Array.isArray(e)?e.filter(e=>!(e instanceof u)):null;if(t===a.EVENT_TOOLBAR_ENABLE&&Array.isArray(n)&&n.length)for(let e=0;e<n.length;e++)if("ds6w:Part"!==n[e]._options.grid["ds6w:globalType"]){t=a.EVENT_TOOLBAR_DISABLE;break}if(t===a.EVENT_TOOLBAR_ENABLE){const e=this.sandbox.core.contextManager.getActiveEngItem(),i=Array.isArray(n)?n.filter(t=>e.getID()!=t.getID()):null;!e.hasValidTransientGroupingContext()||Array.isArray(i)&&i.length||(t=a.EVENT_TOOLBAR_DISABLE)}this._modelEvents.publish({event:t,data:a.EXPAND_MENU})},setMultiselMenuStatus:function(e){e?(this._modelEvents.publish({event:"enox-collection-toolbar-visibility-iconMultipleActionBar",data:!0}),this._modelEvents.publish({event:"enox-collection-toolbar-multiselect-icon-update-count",data:e})):this._modelEvents.publish({event:"enox-collection-toolbar-visibility-iconMultipleActionBar",data:!1})},disableMultisel:function(){this.activeView&&"function"==typeof this.activeView.deactivateInteractiveCumulativeSelection&&this.activeView.deactivateInteractiveCumulativeSelection()},_listenToToolbarEvents:function(){this.eventsTokens=[];var e=this;this.eventsTokens.push(e._modelEvents.subscribe({event:"enox-collection-toolbar-switch-view-activated"},function(t){console.warn("switching view to  --\x3e "+t),e.switchView(t)})),this.eventsTokens.push(e._modelEvents.subscribe({event:"event-persist-view"},function(t){e.sandbox.core.localStorage.setItem("List_view",t)}));let t=a.EVENT_TOOLBAR_SEARCH;this.eventsTokens.push(e.sandbox.subscribe(t,function(n){var i=Array.isArray(n.searchValue)?n.searchValue[0]:"",r=(new Date).getTime();e.getModels().prepareUpdate(),e.getModels().getAllTheExpanedNodes(t).forEach(function(t){t.unMatch(i)?t.setSearchFilterState(!0):t.setSearchFilterState(!1),t.unMatch(i)||e.setIsHiddenState(t),t.applyFilters()}),e.getModels().pushUpdate(),e.updateCount(),console.warn("ending search in "+((new Date).getTime()-r)+"ms")})),this.eventsTokens.push(e._modelEvents.subscribe({event:"enox-collection-toolbar-sort-activated"},function(t){e.getModels().onSorting(t)})),this.eventsTokens.push(e._modelEvents.subscribe({event:"enox-collection-toolbar-all-selected"},function(){e.selectAll()})),this.eventsTokens.push(e._modelEvents.subscribe({event:"enox-collection-toolbar-click-multiselect-icon"},function(t){e.onMultiselClick(t.object.elements.container)})),this.eventsTokens.push(e._modelEvents.subscribe({event:"enox-collection-toolbar-all-unselected"},function(){e.unSelectAll(),e.activeView&&"function"==typeof e.activeView.deactivateInteractiveCumulativeSelection&&e.activeView.deactivateInteractiveCumulativeSelection()})),this.eventsTokens.push(e._modelEvents.subscribe({event:a.EVENT_STRUCTURE_VIEW_CHANGED},function(t){e.refreshToolBar()})),this.eventsTokens.push(e._modelEvents.subscribe({event:a.EVENT_UPDATE_BOOKMARK_ICON},function(){e.updateBookmarkIcon()}))},setIsHiddenState:function(e){if(e.getParent()&&""!==e.getParent().getID()){var t=e.getParent();t._isHidden=!1,this.setIsHiddenState(t)}},destroyToolbar:function(){var e=this;this.eventsTokens.forEach(function(t){e._modelEvents.unsubscribe(t)}),g.destroy(),g=null},getAvailableActions:function(){var e=[this.buildAddMenu(),this.buildToolbarCmd(a.ITEM_PASTE_CMD,!0),this.buildToolbarCmd(a.SET_WORKUNDER_BOOKMARK_CMD),this.buildFindCmd(),this.buildFilterCmd(),this.buildExpandMenu(),this.buildStructureViewsMenu(),this.buildReorderCmd(),this.buildGroupByMenu(),this.buildToolbarCmd(a.LAUNCH_ATTRIBUTES_MGT_CMD),this.buildToolbarCmd("Export_DataGrid")];return"true"===localStorage.getItem(a.ENABLE_SELECTION_MODES)&&e.push(this.buildSelectModeSwitch()),e},buildToolbarCmd:function(e,t){const n=this.sandbox.core.commandManager.getCommandMetaData(e),i={id:e,text:this.i18nManager.get(n.nls_key),fonticon:`fonticon fonticon-${n.fonticon}`,handler:n=>{this.sandbox.publish(a.EVENT_LAUNCH_COMMAND,{commandId:e,context:t?{item:this.getModels().getSelectedNodes()}:{}})}};return n.loadHelpRsc&&(i.loadHelpRsc=n.loadHelpRsc),i},buildAddMenu:function(){return{id:a.ADD_MENU,text:this.i18nManager.get("Add"),fonticon:"fonticon fonticon-plus",loadHelpRsc:{helpResourceFile:"ENOXEngineer/help",resourceID:a.ADD_MENU},handler:e=>{"XENTile"===this.getPreferredView()&&this.getModels().unselectAll(),this.sandbox.core.commandManager.renderMenu(e.target.getBoundingClientRect(),"addToolBar")}}},buildFindCmd:function(){const e=this.sandbox.core.commandManager.getCommandMetaData(a.FIND_MENU);return{id:a.FIND_MENU,text:this.sandbox.i18nManager.get("find-cmd"),fonticon:"fonticon fonticon-find",loadHelpRsc:e.loadHelpRsc,handler:(e,t)=>{this.sandbox.sessionManager.isUsingIndex()?(this.findInCMD(e),this.sandbox.publish(a.SWITCH_MODE,{switchMode:"index"})):this.launchModelDialog(a.FIND_ITEMS_CMD,e)}}},buildFilterCmd:function(){const e=this.sandbox.core.commandManager.getCommandMetaData(a.LAUNCH_NG_FILTER_CMD);return{id:"NG_Filtering",text:this.i18nManager.get("NG_Filtering"),fonticon:"fonticon fonticon-filter",loadHelpRsc:e.loadHelpRsc,handler:e=>{console.warn("NG_Filtering"),this.sandbox.sessionManager.isUsingIndex()?(this.sandbox.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.LAUNCH_NG_FILTER_CMD,context:{}}),this.sandbox.sessionManager.setAuthoringMode("index")):this.launchModelDialog()}}},buildExpandCmd(e){const t=this.sandbox.core.commandManager.getCommandMetaData(e);return{id:e,text:this.sandbox.i18nManager.get(t.nls_key),fonticon:t.fonticon,changeIconSelection:!1,selectable:!1,handler:(t,n)=>{this.sandbox.publish(a.EVENT_LAUNCH_COMMAND,{commandId:e,context:{appCore:this,event:t,item:this.getModels().getSelectedNodes()}})}}},buildExpandMenu:function(){return{id:a.EXPAND_MENU,text:this.sandbox.i18nManager.get("expand_menu"),fonticon:"fonticon fonticon-flow-tree-expand-down",loadHelpRsc:{helpResourceFile:"ENOXEngineer/help",resourceID:a.EXPAND_MENU},content:[this.buildExpandCmd(a.EXPAND_CMD),this.buildExpandCmd(a.EXPAND_ALL_CMD),this.buildExpandCmd(a.EXPAND_N_LEVEL_CMD),this.buildExpandCmd(a.COLLAPSE_ALL_CMD)]}},buildStructureViewsMenu:function(){return{id:"structureView",text:this.sandbox.i18nManager.get("structureViews"),fonticon:"fonticon fonticon-tree-view-flattened-cog",multiSelect:!0,loadHelpRsc:{helpResourceFile:"ENOXEngineer/help",resourceID:"structureView"},content:[this.buildTreeViewCmd({changeIconSelection:!1}),this.buildFlatViewCmd({changeIconSelection:!1}),this.buildLeafViewCmd({changeIconSelection:!1}),this.buildMadeFromViewCmd({changeIconSelection:!1}),this.buildSeparator(),this.buildUsageViewCmd({changeIconSelection:!1}),this.buildReferenceViewCmd({changeIconSelection:!1}),this.buildSeparator(),this.buildManufViewCmd({changeIconSelection:!1})]}},buildSeparator:function(){return{className:"divider"}},buildTitle:function(e){return{text:this.sandbox.i18nManager.get(e),className:"header"}},buildTreeViewCmd:function(){return this.buildStructureViewCmd({id:a.DIRECT_CMD,label:"eng.displayOption.structure.tree",icon:"tree-view-all"})},buildFlatViewCmd:function(){return this.buildStructureViewCmd({id:a.FLAT_LIST_VIEW,label:"eng.displayOption.structure.flat",icon:"view-list"})},buildLeafViewCmd:function(){return this.buildStructureViewCmd({id:a.QUALIFIED_AS_FINAL_CMD,label:"eng.export.components.qualifiedAsFinal",icon:"tree-view-leaf",indexOnly:!0})},buildMadeFromViewCmd:function(){return this.buildStructureViewCmd({id:a.LEAF_MATERIALS_CMD,label:"eng.export.components.leafMaterials",icon:"raw-material",indexOnly:!0})},buildUsageViewCmd:function(){return this.buildQuantityViewCmd({id:a.INSTANCE_CMD,label:"instanceView",icon:"object-instance"})},buildReferenceViewCmd:function(){return this.buildQuantityViewCmd({id:a.REFERENCE_CMD,label:"quantityView",icon:"object-reference"})},buildStructureViewCmd:function({id:e,label:t,icon:n,indexOnly:i}){return{id:e,text:this.sandbox.i18nManager.get(t),fonticon:`fonticon fonticon-${n}`,changeIconSelection:!1,selectable:!0,selected:e===this.sandbox.sessionManager.getFlatViewOption(),handler:()=>{this.updateDisplayOptionMenu(a.VALUE_QUALIFIED_AS_FINAL_COMPONENT,e),i&&!this.sandbox.sessionManager.isUsingIndex()?this.launchModelDialog(e):(this.sandbox.publish(a.EVENT_QUALIFIED_AS_FINAL_ITEM,{commandId:e}),this.sandbox.publish(a.SWITCH_MODE,{switchMode:i?"index":this.sandbox.sessionManager.determineAuthoringMode()}))}}},buildQuantityViewCmd:function({id:e,label:t,icon:n,indexOnly:i}){return{id:e,text:this.sandbox.i18nManager.get(t),fonticon:`fonticon fonticon-${n}`,changeIconSelection:!1,selectable:!0,selected:e===this.sandbox.sessionManager.getQuantityViewOption(),handler:(t,n)=>{this.updateDisplayOptionMenu("quantityView",e),this.sandbox.publish(a.EVENT_CHANGE_QUANTITY_VIEW,{commandId:e})}}},updateDisplayOptionMenu:function(e,t){switch(e){case a.VALUE_QUALIFIED_AS_FINAL_COMPONENT:this._modelEvents.publish({event:a.EVENT_TOOLBAR_CHANGE_SELECTION,data:{id:a.DIRECT_CMD,selected:t===a.DIRECT_CMD}}),this._modelEvents.publish({event:a.EVENT_TOOLBAR_CHANGE_SELECTION,data:{id:a.FLAT_LIST_VIEW,selected:"flatListView"===t}}),this._modelEvents.publish({event:a.EVENT_TOOLBAR_CHANGE_SELECTION,data:{id:a.QUALIFIED_AS_FINAL_CMD,selected:t===a.QUALIFIED_AS_FINAL_CMD}}),this._modelEvents.publish({event:a.EVENT_TOOLBAR_CHANGE_SELECTION,data:{id:a.LEAF_MATERIALS_CMD,selected:t===a.LEAF_MATERIALS_CMD}});break;case"quantityView":this._modelEvents.publish({event:a.EVENT_TOOLBAR_CHANGE_SELECTION,data:{id:a.REFERENCE_CMD,selected:t===a.REFERENCE_CMD}}),this._modelEvents.publish({event:a.EVENT_TOOLBAR_CHANGE_SELECTION,data:{id:a.INSTANCE_CMD,selected:t===a.INSTANCE_CMD}})}},buildManufViewCmd:function(){var e=this.sandbox.core.sessionManager.shouldShowMfgView();return{id:a.MANUFACTURING_CMD,text:this.sandbox.i18nManager.get("manufacturableView").replace("$1",this.sandbox.i18nManager.get(a.DS6W_MANUFACUTRABLE)),fonticon:"fonticon fonticon-factory",selectable:!0,selected:e,className:e?"xeng-app-mfgview-icon":"",handler:(e,t)=>{this.sandbox.sessionManager.isUsingIndex()?(this.switchToMFGView(e),this.sandbox.publish(a.SWITCH_MODE,{switchMode:"index"})):this.launchModelDialog(a.MANUFACTURING_CMD,e)}}},buildReorderCmd:function(){const e=this.sandbox.core.commandManager.getCommandMetaData("UPSAuthReorderProduct");return{id:"UPSAuthReorderProduct",text:this.i18nManager.get("reorder-cmd"),fonticon:"fonticon fonticon-list-ordered",loadHelpRsc:e.loadHelpRsc,handler:e=>(console.warn("Reorder"),this.getModels().isViewGrouped()?r.errorAlert(this.sandbox.i18nManager.get("reorder_groupedNode_error")):this.sandbox.core.contextManager.getActiveEngItem().hasValidTransientNextGenFilter()||this.sandbox.core.contextManager.getActiveEngItem().hasValidPersistedNextGenFilter()||!this.sandbox.core.contextManager._activeGridView.getFilterViewManager().isEmpty()?r.errorAlert(this.sandbox.i18nManager.get("reorder_reparent__filter_blocked_errorMsg")):void this.sandbox.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.LAUNCH_REORDER_CMD,context:{item:this.sandbox.core.contextManager.getSelectedRealNodes()}}))}},buildGroupByMenu:function(){return{id:a.GROUPBY_MENU,text:this.i18nManager.get("tooltip_GroupBy"),fonticon:"fonticon fonticon-group",handler:this.showGroupByMenu.bind(this),loadHelpRsc:{helpResourceFile:"ENOXEngineer/help",resourceID:a.GROUPBY_MENU}}},buildSelectModeSwitch:function(){let e=this.sandbox.core.sessionManager.getSelectionMode();return{id:"SelectMode",text:this.i18nManager.get("Select"),fonticon:"fonticon fonticon-select-on",className:e&&e===a.SELECT_MODE_ROW?"xeng-app-mfgview-icon":"",handler:e=>{this.switchSelectMode(),this.updateSelectModeIcon()}}},updateSelectModeIcon:function(){let e=this.getSelectMode();var t=document.querySelector("#SelectMode");e===a.SELECT_MODE_ROW?t.addClassName("xeng-app-mfgview-icon"):e===a.SELECT_MODE_CELL&&t.removeClassName("xeng-app-mfgview-icon")},switchSelectMode:function(){let e=this.getSelectMode();e===a.SELECT_MODE_ROW&&this.setSelectMode(a.SELECT_MODE_CELL),e===a.SELECT_MODE_CELL&&this.setSelectMode(a.SELECT_MODE_ROW)},setSelectMode:function(e){switch(e){case a.SELECT_MODE_CELL:this.sandbox.core.contextManager._activeGridView.cellSelection=a.DGV_SELECTION_MULTIPLE;break;case a.SELECT_MODE_ROW:this.sandbox.core.contextManager._activeGridView.cellSelection=a.DGV_SELECTION_NONE;break;default:console.log("invalid select mode")}this.sandbox.core.sessionManager.setSelectionMode(e)},getSelectMode:function(){const e=this.sandbox.core.settingManager.getDefaultSelectionMode();return this.sandbox.core.contextManager._activeGridView&&this.sandbox.core.contextManager._activeGridView.cellSelection?this.sandbox.core.contextManager._activeGridView.cellSelection===a.DGV_SELECTION_NONE?a.SELECT_MODE_ROW:this.sandbox.core.contextManager._activeGridView.cellSelection===a.DGV_SELECTION_MULTIPLE?a.SELECT_MODE_CELL:e:e},switchToMFGView:function(e){var t=this.sandbox.core.sessionManager.shouldShowMfgView();this.sandbox.publish(a.EVENT_CHANGE_MFG_VIEW,{isMFGView:!t,commandId:a.MANUFACTURING_CMD})},launchModelDialog:function(t,n){var i=this;switch(t){case a.QUALIFIED_AS_FINAL_CMD:var r=i.sandbox.i18nManager.get("flattened.view");break;case a.MANUFACTURING_CMD:r=i.sandbox.i18nManager.get("manufacturable.view");break;case a.LEAF_MATERIALS_CMD:r=i.sandbox.i18nManager.get("leafmaterials.view");break;case a.FIND_ITEMS_CMD:r=i.sandbox.i18nManager.get("find-cmd");break;default:r=i.sandbox.i18nManager.get("NG_Filtering")}var o=i.sandbox.i18nManager.replace(i.sandbox.i18nManager.get("index_Flattened_Advanced"),{view:r}),l=i.sandbox.i18nManager.get("eng.ui.button.ok"),c=new s({className:"alternateDlgConfirm",closable:!0,okButtonText:l,animate:!0,renderTo:widget.body}),d=new e.Element("div",{html:o});c.dialog({body:d,title:r,buttons:[{className:"primary",value:l,action:function(e){t===a.MANUFACTURING_CMD?i.switchToMFGView(n):t===a.FIND_ITEMS_CMD?i.findInCMD(n):t===a.QUALIFIED_AS_FINAL_CMD?i.sandbox.sessionManager.switchToFlattenedView({commandId:"QualifiedAsFinal"}):t===a.LEAF_MATERIALS_CMD?i.sandbox.sessionManager.switchToFlattenedView({commandId:a.LEAF_MATERIALS_CMD}):i.sandbox.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.LAUNCH_NG_FILTER_CMD,context:{}}),i.sandbox.sessionManager.setAuthoringMode("index"),e.hide()}},{value:i.sandbox.i18nManager.get("eng.ui.button.cancel"),action:function(e){t===a.MANUFACTURING_CMD&&i.eventsTokens.push(i._modelEvents.publish({event:h,data:{id:a.MANUFACTURING_CMD,selected:!1}})),t!==a.QUALIFIED_AS_FINAL_CMD&&t!==a.LEAF_MATERIALS_CMD||(i.sandbox.sessionManager.shouldShowFlatView()?(i.eventsTokens.push(i._modelEvents.publish({event:h,data:{id:a.DIRECT_CMD,selected:!1}})),i.eventsTokens.push(i._modelEvents.publish({event:h,data:{id:a.FLAT_LIST_VIEW,selected:!0}}))):(i.eventsTokens.push(i._modelEvents.publish({event:h,data:{id:a.DIRECT_CMD,selected:!0}})),i.eventsTokens.push(i._modelEvents.publish({event:h,data:{id:a.FLAT_LIST_VIEW,selected:!1}}))),i.eventsTokens.push(i._modelEvents.publish({event:h,data:{id:a.QUALIFIED_AS_FINAL_CMD,selected:!1}})),i.eventsTokens.push(i._modelEvents.publish({event:h,data:{id:a.LEAF_MATERIALS_CMD,selected:!1}}))),e.hide()}}]});document.querySelector(".alternateDlgConfirm .modal-footer");var u=document.getElementsByClassName("close fonticon fonticon-cancel");null!=u&&(u[0].onclick=function(){t===a.MANUFACTURING_CMD&&i.eventsTokens.push(i._modelEvents.publish({event:h,data:{id:a.MANUFACTURING_CMD,selected:!1}})),t!==a.QUALIFIED_AS_FINAL_CMD&&t!==a.LEAF_MATERIALS_CMD||(i.sandbox.sessionManager.shouldShowFlatView()?(i.eventsTokens.push(i._modelEvents.publish({event:h,data:{id:a.DIRECT_CMD,selected:!1}})),i.eventsTokens.push(i._modelEvents.publish({event:h,data:{id:a.FLAT_LIST_VIEW,selected:!0}}))):(i.eventsTokens.push(i._modelEvents.publish({event:h,data:{id:a.DIRECT_CMD,selected:!0}})),i.eventsTokens.push(i._modelEvents.publish({event:h,data:{id:a.FLAT_LIST_VIEW,selected:!1}}))),i.eventsTokens.push(i._modelEvents.publish({event:h,data:{id:a.QUALIFIED_AS_FINAL_CMD,selected:!1}})),i.eventsTokens.push(i._modelEvents.publish({event:h,data:{id:a.LEAF_MATERIALS_CMD,selected:!1}}))),modal.hide()})},findInCMD:function(e){this.sandbox.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.FIND_ITEMS_CMD,context:{appCore:this,event:e}})},onMultiselClick:function(e){e&&(this.sandbox.core.contextManager.setMultiselMenu(!0),this.getModels().getSelectedItemsCommonMenu(e.getBoundingClientRect()))},refreshToolBar:function(){if(!g)throw new Error(" toolbar not yet initialized")},buildToolBar:function(){if(!g)throw new Error(" toolbar not yet initialized");g.addActions(this.getAvailableActions()).setDefaultView(this.getDefauftView()).addViews(this.getAvailableViews()).build()},showGroupByMenu:function(e){var t=[],n=this,i=widget.getValue("groupBy");t.push(n.sandbox.core.commandManager.getGenericMenuEnty({nls_key:n.sandbox.i18nManager.get("None"),callback:function(e){n.launchGroupBy({propertiesToGroup:[]})},args:["None"],state:void 0===i?"selected":"unselected",type:"CheckItem"}));n.getModels().getAvailableAttributesForGrouping().forEach(function(e){if(!e.ds6wFrom||"rel"!==e.ds6wFrom||!n.sandbox.core.sessionManager.shouldShowQuantityView()){const r=n.i18nManager.get("eng.export.instance.key");let o=e.ds6wFrom&&"rel"===e.ds6wFrom?e.text+` (${r})`:e.text;t.push(n.sandbox.core.commandManager.getGenericMenuEnty({nls_key:o,callback:function(t){n.launchGroupBy({propertiesToGroup:[e.dataIndex]})},args:[e.ds6w],state:i===e.dataIndex?"selected":"unselected",type:"CheckItem"}))}});n.sandbox.core.commandManager.showMenu(e.target.getBoundingClientRect(),t)},updateBookmarkIcon:function(){var e=document.querySelector("#"+a.SET_WORKUNDER_BOOKMARK_CMD);e&&(p.getActiveFolder&&p.getActiveFolder()&&p.getActiveFolder().id?e.addClassName("xeng-app-bookmark-icon"):e.removeClassName("xeng-app-bookmark-icon"))}})}),define("DS/ENOXEngineer/components/PropertiesView/PropertiesServices",["UWA/Core","UWA/Class","DS/ENOXEngineer/services/EngineeringSettings","DS/ENOXEngineer/utils/XEngineerConstants","css!DS/ENOXEngineer/components/PropertiesView/ENOXProperties.css"],(e,t,n,i)=>{return t.singleton({init(e){},getSecurityContext:()=>({SecurityContext:n.getSecurityContext()}),getpropOptions(e){const t=this,i=[e.FACET_PROPERTIES,e.FACET_FILES,e.FACET_SHARING,e.FACET_INSTANCE,e.FACET_REVISIONS,e.FACET_RELATIONS,e.FACET_EFFECTIVITY,e.FACET_CHANGE,e.FACET_iCHANGE,e.FACET_IPPROTECTION,e.FACET_SWYMCOMMENTS,e.FACET_GENERALHISTORY,e.FACET_ADMIN];return{typeOfDisplay:e.ALL,selectionType:e.NO_SELECTION,facets:i,readOnly:!1,extraNotif:!0,editMode:!1,context:{getSecurityContext:()=>t.getSecurityContext()},infoForCustomization:n.getRevisionsCommandCustomization(),appId:n.getAppId()}},getPropModel(e,t,r){const o=[];let s=[];return e.items instanceof Array?s=e.items:s[0]=e.items,s.forEach(e=>{o.push({metatype:e.metatype,objectId:e.id,instrefid:e.instrefid,selReferenceID:e.instrefid,tenant:n.getPlatformId(),source:i.SERVICE_3DSPACE_NAME})}),o},isManufActive:()=>!0,getManufFacetConfiguration:e=>({require:"DS/DELPPWFacets/facets/ManufacturingIntentFacet",inheritance:!0,alwaysVisible:!0,services:["3DSpace"],actions:[{name:"Add",text:e.i18nManager.get("eng.manufacture.facet.add"),icon:"fonticon fonticon-plus"}],content:null,facet:{name:"ManufactureIntent",icon:"factory",text:e.i18nManager.get("eng.manufacture.facet.title")},options:{appContext:e.core,securityContext:n.getSecurityContext(),immersiveFrame:e.core.moduleHelper.viewsService.getApplicationImmersiveFrame()}})})}),define("DS/ENOXEngineer/components/PropertiesView/PropertiesPanel",["DS/Utilities/Utils","DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/models/EditPropAttributeModel","DS/ENOXEngineer/components/PropertiesView/PropertiesServices","DS/CoreEvents/ModelEvents","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager"],(e,t,n,i,r,o,s,a,l)=>{return class{constructor(e){this.sandbox=e;const i=o.getpropOptions(n);this.infoPanel=new t(i),this.infoPanel.addFacets([{require:"DS/ENOXEngineer/facets/SpecificationsFacet",alwaysVisible:!0,services:["3DSpace"],inheritance:!0,content:null,facet:{name:a.CONST_SPEC_FACET_NAME,icon:"doc-log",text:this.sandbox.i18nManager.get("document.asspec")},options:{appContext:e.core}}]),e.core.specViewerModelEvents=e.core.mediator,this.infoPanel.addFacets([{require:"DS/ENOXEngineer/facets/AttachmentsFacet",alwaysVisible:!0,services:["3DSpace"],inheritance:!0,content:null,facet:{name:"relateddocuments",icon:"attach",text:this.sandbox.i18nManager.get("title_related_Documents")},options:{appContext:e.core}},{require:"DS/ENOXAlternateSubstitute/facets/AlternateFacet",alwaysVisible:!0,services:["3DSpace"],inheritance:!0,content:null,facet:{name:"alternateFacet",icon:"exchange",text:this.sandbox.i18nManager.get("eng.alternate.facet.title")},options:{appContext:e.core}},{require:"DS/ENODODisplay/commands/facets/DerivedOutputFacet",inheritance:!0,alwaysVisible:!0,services:["3DSpace"],content:null,facet:{name:"derivedoutputs",icon:"derived-output",text:this.sandbox.i18nManager.get("derived_output")},options:{activateActions:!0},actions:[{name:"generateDeriveOutput",text:this.sandbox.i18nManager.get("derivedOutputFacet.generateDeriveOutput"),icon:"derived-output"},{name:"refreshDOView",text:this.sandbox.i18nManager.get("derivedOutputFacet.refreshDOView"),icon:"refresh"},{name:"bulkDownloadDO",text:this.sandbox.i18nManager.get("derivedOutputFacet.bulkDownloadDO"),icon:"folder-zipped-download"}]},{require:"DS/ENOMadeFromUX/view/MBMFFacet",alwaysVisible:!0,services:["3DSpace"],inheritance:!0,content:null,facet:{name:"specsMadeFromFacet",icon:"part-made-from",text:this.sandbox.i18nManager.get("eng.makefrom.facet.title")},options:{appContext:e.core,itemTreeDoc:e.core.xengTreeDoc?e.core.xengTreeDoc:e.xengTreeDoc}},{require:"DS/ENOXEngineer/facets/ENOXMaterialFacet",alwaysVisible:!0,services:["3DSpace"],inheritance:!0,content:null,facet:{name:"MaterialFacet",icon:"material",text:this.sandbox.i18nManager.get("materialFacet.title")},options:{appContext:e.core}},{require:"DS/ENOXMEIQualification/views/MEIFacet",alwaysVisible:!0,services:["3DSpace"],inheritance:!0,content:null,facet:{name:"MEIFacet",icon:"3dproduct-trolley",text:this.sandbox.i18nManager.get("eng.MEI.facet.title")},options:{appContext:e.core}}]),this.infoPanel.addFacets([o.getManufFacetConfiguration(this.sandbox)])}start(){const t=this;this.setState(this.sandbox.options.items),this.currentId=this.sandbox.options.physicalId,this.infoPanel.initDatas(this.getPropertyModels()),this.infoPanel.elements.container.inject(this.sandbox.getContainer()),this.reRender=e.debounce(function(){for(let e=0;e<t.currentSelection.items.length;e++)if(""==t.currentSelection.items[e].id)return void l.warningNotif({title:this.sandbox.i18nManager.get("warning.unsupportedSelection"),subtitle:this.sandbox.i18nManager.get("warning.unsupportedSelection.propertiesPanel")});this.infoPanel.initDatas(this.getPropertyModels(),this.getFacet()),this.infoPanel.elements.container.onResize()},10),this.sandbox.subscribe(a.EVENT_TRIPTYCH_PANEL_VISIBLE,e=>{t.reRender(),"right"===e&&setTimeout(()=>{t.infoPanel.elements.container.onResize()},500)})}getState(){return this.currentSelection}getFacet(){return this.currentFacet}setState(e,t){this.currentSelection={items:Array.isArray(e)?e:[]},this.currentFacet=t,this.sandbox.core.isPropertyPanelVisibilty&&this.reRender&&this.reRender()}setReadonlyStatus(e){if(this.infoPanel.options.readOnly!==e)return this.infoPanel.setReadonlyStatus(e)}getPropertyModels(){return o.getPropModel(this.getState(),i,r)}getUIFacets(){return this.infoPanel.elements.UI._lFacets}}}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityEditComponent",["DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityComponent","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityNodeUtils","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/services/EngineeringSettings","DS/Tweakers/GeneratedToolbar","DS/ENOXEngineer/services/I18nManager","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],(e,t,n,i,r,o,s)=>{const a=`${o.get("editQuantities")}:`,l=`${o.get("totalQuantities")}:`,c=n.CHANGEQUANTITY_CHUNK_COUNT,d=n.RUN_BACKGROUND_JOB_COUNT;return new class extends e{init(e){super.init(),this.viewContext=e,this.numberInputTweaker=null,this.rollUpInputTweaker=null,this.quantityChangeTweaker=null,this.buildTweakerTypes()}buildTweakerTypes(){const{toolbar:e}=this.viewContext||{};e&&(e.typeRepresentationFactory.getRegisteredTypeRepresentation("removeBoolean")||e.typeRepresentationFactory.registerTypeRepresentations({removeBoolean:{stdTemplate:"toggleIcon",semantics:{possibleValues:[{value:"true",icon:"remove"},{value:"false",icon:"undo"},{value:"undefined",icon:""}]}}}))}activate(e){super.activate();const{gridView:t,toolbar:n,model:i}=e;this.quantityChangeTweaker=n.getNodeModelByID("quantityChangeItem"),n.prepareUpdateView(),i.isAddRemoveNodeAuthorized?n.items.addRoot(this.numberInputTweaker,0):n.items.addRoot(this.rollUpInputTweaker,0),n.pushUpdateView();const{columns:r}=t,a=[...r];t.prepareUpdateView(),i.isAddRemoveNodeAuthorized&&(a.push({text:o.get("eng.ui.dialog.changeQuantity.headerAction"),editableFlag:!0,editionPolicy:"EditionOnOver",dataIndex:"changeQuantityStatus",typeRepresentation:"removeBoolean",className:"custom-boolean-action-change-quantity",pinned:"left",width:75,setCellValue:(e,t)=>{t?i.addNode(e.nodeModel):i.removeNode(e.nodeModel)}}),a.push({text:o.get("eng.ui.dialog.changeQuantity.headerStatus"),dataIndex:"status",pinned:"left",width:100,getCellValue:e=>{if(!e||!e.nodeModel)return"";const{status:t}=e.nodeModel.options.grid;return"Kept"!==t?s.get(`eng.ui.dialog.changeQuantity.status${t}`):""}})),t.columns=a,t.pushUpdateView()}deactivate(e){super.deactivate();const{gridView:t,toolbar:n,model:i}=e;n.prepareUpdateView(),i.isAddRemoveNodeAuthorized?n.items.removeRoot(this.numberInputTweaker):n.items.removeRoot(this.rollUpInputTweaker),n.pushUpdateView();const{columns:r}=t,o=r.filter(e=>"changeQuantityStatus"!==e.dataIndex&&"status"!==e.dataIndex);t.prepareUpdateView(),t.columns=o,t.pushUpdateView()}update(e){const{createAsBulk:n}=e||{};if("number"==typeof n&&n>0)return void this.updateModificationStatusLabel(n,!0);const{model:i}=this.viewContext,r=i.nodes.filter(e=>t.isNodeKeptStatus(e));if(this.newQuantity=i.getRollup(r),this.updateQuantityInputData(this.newQuantity),this.udpateQuantityRollupLabel(this.newQuantity),this.quantityChangeTweaker){const e="number"==typeof this.newQuantity&&"number"==typeof this.initialQuantity?this.newQuantity-this.initialQuantity:0;this.updateModificationStatusLabel(e)}}udpateQuantityRollupLabel(e){this.rollUpInputTweaker.setAttribute("data",e)}updateQuantityInputData(e){this.numberInputTweaker.setAttribute("data",e)}get min(){return this.initialQuantity-c<0?0:this.initialQuantity-c}get max(){return this.initialQuantity+c}buildUIComponent(e){const{model:t}=e;this.initialQuantity=t.getRollup(t.nodes),this.newQuantity=this.initialQuantity;const n={entries:[{id:"numberInputItem",dataElements:{typeRepresentation:"integer",value:this.initialQuantity,minValue:0,stepValue:1,position:"near",category:1,label:a,displayLabel:!0},onNodeUpdate:this.onElementSpinBoxEdit.bind(this)},{id:"rollUpItem",dataElements:{value:this.initialQuantity,typeRepresentation:"string",position:"near",label:l,category:1,displayLabel:!0,readOnly:!0}}]},i=r.prototype.createTreeDocument(n);[this.numberInputTweaker,this.rollUpInputTweaker]=i.getChildren(),this.udpateQuantityRollupLabel(this.initialQuantity)}onElementSpinBoxEdit(e){const t=e.getAttributeValue("data");this.addOrRemoveNodes(t)}addOrRemoveNodes(e){const{model:n}=this.viewContext,i=e-n.nodes.filter(e=>t.isNodeKeptStatus(e)).length;if(i){const e=i>0?n.addNode.bind(n):n.removeLastNode.bind(n),t=Math.abs(i);if(i>d)n.addNodeAsBulk(t);else for(let n=0;n<t;n+=1)e()}}updateModificationStatusLabel(e,n){let r="";if(e>0)r=this.computeModificationStatusLabelFromNLSKey(e,{max:"eng.ui.dialog.changeQuantity.newAddedItemsLimit",unit:"eng.ui.dialog.changeQuantity.newItemAddedCount",multi:"eng.ui.dialog.changeQuantity.newItemsAddedCount"});else if(e)r=this.computeModificationStatusLabelFromNLSKey(-e,{max:"eng.ui.dialog.changeQuantity.newRemovedItemsLimit",unit:"eng.ui.dialog.changeQuantity.newItemRemovedCount",multi:"eng.ui.dialog.changeQuantity.newItemsRemovedCount"});else{const{model:e}=this.viewContext,n=e.nodes.filter(e=>t.isNodeModified(e)).length;n&&(r=this.computeModificationStatusLabelFromNLSKey(n,{max:"eng.ui.dialog.changeQuantity.newModifiedItemsLimit",unit:"eng.ui.dialog.changeQuantity.newItemModifiedCount",multi:"eng.ui.dialog.changeQuantity.newItemsModifiedCount"}))}(n||e>100||(i.isChangeAuthorized()||i.isWorkingUnderEvolution())&&e>30)&&(r=s.get("eng.ui.dialog.changeQuantity.newAddedItemsLimit").replace("{chunkCount}",e)),this.quantityChangeTweaker.setAttribute("data",r)}computeModificationStatusLabelFromNLSKey(e,{max:t,unit:n,multi:i}){if(!e)return"";let r="";switch(e){case 1:r=n;break;case c:r=t;break;default:r=i}return s.get(r).replace("{chunkCount}",e)}}}),define("DS/ENOXEngineer/collections/EngItemContentTreeDocument",["UWA/Core","DS/ENOXEngineer/collections/XEngGridTreeDocument","DS/ENOXEngineer/columnsFormatter/PreferredUnitColumnProvider","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/services/OccurrencesService","DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/ExpandLevelUtils","require","DS/ENOXEngineer/models/EngItemGroupModel"],function(e,t,n,i,r,o,s,a,l,c,d){"use strict";return t.extend({init:function(e,t){var n=this;if(!e||!t)throw new Error("EngItemContentTreeDocument require two valid parameters");this._parent(t),this._contentFetchers=[],this._countOnGoingAttributesLoaders=0,this.additionalColumnsProvidersDef=[],this._contentIsLoading=!0,this._effAllLoadJobIds=[],this._wholeContentLoaderJobIds=[],this._wholeContentLoaderJobPromises=[],this._colorizeState=!1,this._effInstanceIDs=[],this.isFilledByASessionManager=!1,this._embeddedEngItem=e,e.attachContentModels(this),e.getChildren=function(){return n.getChildren()},this.enableEventListners()},subscribeToFilterBIProxyEvents(e){e&&"function"==typeof e.setNGFilterOptions&&(e.addEvent("ApplyNGFilter",this.onApplyNGFilter.bind(this),this),e.addEvent("FilterBIGroupingEvent",this.onFilterBIGroupingEvent.bind(this),this)),this._parent(e)},unsubscribeToFilterBIProxyEvents(e){e&&(e.removeEvent("ApplyNGFilter"),e.removeEvent("FilterBIGroupingEvent")),this._parent(e)},getEngineeringItem:function(){return this._embeddedEngItem},_getProvidersForOnlyVisibleAttributes:function(){return this._getProvidersByPolicy("visible")},_getProvidersForWholeContentAttributes:function(){return this._getProvidersByPolicy("whole")},getColumnsProvidersInstancesByPolicy:function(e){return this.getColumnsProvidersDefinitionByPolicy(e).map(function(e){return e.instance})},getColumnsProvidersDefinitionByPolicy:function(e){var t=null;switch(e){case"visible":t=this._getProvidersForOnlyVisibleAttributes();break;case"whole":t=this._getProvidersForWholeContentAttributes();break;default:t=this.getColumnsProviders()}return t||[]},_getProvidersByPolicy:function(e){return this.getColumnsProviders().filter(function(t){return t.loadingPolicy===e})},getColumnsProviders:function(){return Array.isArray(this.additionalColumnsProvidersDef)?this.additionalColumnsProvidersDef:[]},getColumnsProvidersInstances:function(){return this.getColumnsProviders().map(function(e){return e.instance})},registerColumnsProviders:function(e){if(Array.isArray(e)){var t=e.filter(function(e){return e&&e.ID&&e.instance&&e.loadingPolicy}),n=this;t.forEach(function(e){!n.getColumnsProviders().find(function(t){return t.ID===e.ID})&&e&&n.getColumnsProviders().push(e)})}},unregisterColumnsProviders:function(e){var t=this;Array.isArray(e)&&e.forEach(function(e){var n=t.getColumnsProviders().findIndex(function(t){return t.ID===e});n>-1&&t.getColumnsProviders().splice(n,1)})},freeXENContent:function(){this.removeRoots(),this.getBIFilter().resetNGFilterUI({widgetId:widget.id,rootIDs:[this.core.contextManager.getActiveEngItem().getID()]}),this.core.PersistencyManager.resetNGFilter(),this.getBIFilter().removeRoot(this.core.contextManager.getActiveEngItem().getID()),this._contentFetchers=[],this._embeddedEngItem=void 0;var e=this;Array.isArray(this._modeleventsTokens)&&this._modeleventsTokens.forEach(function(t){e.core.mediator.unsubscribe(t)}),e.getModelEvents()&&e.getModelEvents().unsubscribeAll(),this.stopAllLoadingJobs(),this.destroy()},enableEventListners:function(){this._modeleventsTokens=[];var e=this;this._modeleventsTokens.push(e.core.mediator.subscribe(i.EVENT_UPDATE_INSTANCES_EFFECTIVITIES,function(t){e.applyUpdatedEffectivities(t)})),this._modeleventsTokens.push(e.core.mediator.subscribe(i.EVENT_UPDATE_NODES_WITH_CHANGESETS,function(t){const{changeSetObj:n,nodesToBeUpdated:i}=t;e.withTransactionUpdate(function(){e.changeSetMerger(n,i)})})),this._modeleventsTokens.push(e.core.mediator.subscribe(i.EVENT_AUTHORING_MATERIAL_END,function({cmd:t,answer:n}){e.withTransactionUpdate(()=>{const{references:r}=n;if(Array.isArray(r)){const n=r.map(e=>e.physicalid);let o=e.findNodesByIds(n);if(o.length)e.refreshProvidedColumns(o,!0);else if(e.core.contextManager.getActiveEngItem().getID()==n[0]){let n={post_core_material:"CoreMaterial",post_covering_material:"CoveringMaterial"},o={references:r,dataIndex:n[t]?n[t]:void 0};e.core.mediator.publish(i.EVENT_MODIFIED_REFERENCES,o)}}})}))},deleteNodesByInstanceID:function(e){var t=this;this.withTransactionUpdate(function(){t._getNoFakeNodes(t.findNodesByIds(e)).forEach(function(e){e.remove()})}),t.reApplyUserCurrentViewOptions(),t.reApplyGroups()},getChildrenWithoutGroupingNodes:function(){return this._getNoFakeNodes(this.getRoots()||[])},_getNoFakeNodes:function(e){if(e.length>0){if(e[0]._isFromOriginalModel())return e;var t=[];return e.forEach(function(e){var n=e.getChildren();null!=n&&(t=t.concat(n))}),this._getNoFakeNodes(t)}return[]},onApplyNGFilter:function(t){this.core.logger.info(" onApplyNGFilter updating user filterd view");var n=t||null;if(delete(n=e.is(n,"string")?JSON.parse(n):n).CVQuery3D,n.appId!==this.core.settingManager.getWidgetId()||this.core.sessionManager.sessionAlreadyBuilt)this.core.sessionManager.sessionAlreadyBuilt=!1;else{if(t.empty)this.core.PersistencyManager.resetNGFilter();else{var i=this.getBIFilter();if(i){var r=this.getEngineeringItem().getID(),o=i.HasFilter(r);if(o.filterId){let e={filterName:t.filterTitle,filterId:o.filterId};this.core.PersistencyManager.setNGFilter(e)}}}this._buildFilteredContent(n)}},onFilterBIGroupingEvent:async function(e){await this._buildGroupedContent(e),this.getBIFilter().setGroupingStatus({status:!0})},hasConvertissibleColumns:function(){return this.core.dicoService.getVisibleAttributes().some(function(e){return"rollup"===e.dataIndex||e.attrUnit&&e.attrUnit.length>0})},getConvertissibleAttributes:function(){return this.core.dicoService.getVisibleAttributes().filter(function(e){return e.attrUnit&&e.attrUnit.length>0})},getAdditionalColumns:function(e){var t=[];return this.getColumnsProvidersInstancesByPolicy(e).forEach(function(e){var n=e.getManagedColumnNames();n=n.map(function(e){return{dataIndex:e}}),e.getAdditionalColumnsUX(n),t=t.concat(n)}),t},_bypassForConfigColumns:function(){var e=this;e.getColumnsProvidersInstances().forEach(function(t){var n={relids:[],pids:[e.getEngineeringItem().getID()]};t.updateAttributes(n,function(e){console.warn(e)})})},_getCandidateForChunkLoading:function(e,t,n){if(!Array.isArray(e))return[];var r=this,o=r.getAdditionalColumns(t).map(function(e){return e.dataIndex});return e.filter(function(e){if(!e)return!1;if(n)return!0;if(e.isDocument&&e.isDocument(i.SPECIFICATION_DOCUMENT))return!0;if(r.hasConvertissibleColumns()&&e.isAttributeConvertionStarted&&!e.isAttributeConvertionStarted())return!0;for(var t=0;t<o.length;t++){const n=o[t];
//!that._isNodeAttributeManagedByALoader(node, attrName) &&
if(e.attributeRemoteLoadingNotStart&&e.attributeRemoteLoadingNotStart(n))return!0}return!1})},_isNodeAttributeManagedByALoader:function(e,t){return!!(e&&e.isAttributeLoadFailed&&e.isAttributePending&&t)&&(e.isAttributeLoadFailed(t)||e.isAttributePending(t))},prepareNodesForLoadAdditionalColumns:function(e,t,n,i){if(Array.isArray(e)){var r=t&&Array.isArray(t)&&t.length>0?t:this.getAdditionalColumns(i).map(function(e){return e.dataIndex});this.withTransactionUpdate(function(){e.forEach(function(e){var t={};r.forEach(function(i){(n||void 0===e.getAttributeValue(i))&&(t[i]="#queued#")}),e.updateOptions({grid:t})})})}},fillAttributesAsync4VisibleNodes:function(e,t,n,i){return this._prepareAndLaunchLoaderJob(e,this.loadVisibleColumnsByChunk.bind(this),n,i,t)},loadVisibleColumnsByChunk:function(e,t,n){var i=this.core.settingManager.getSetting("effectivityChunkSize");return this._genericChunksLoader(e,t,i,n)},isNotWaitingForAttributes:function(){return 0===this._countOnGoingAttributesLoaders},asyncRetrieveMissingAttributes:function(e,t){var n=this,i=this._prepareAndLaunchLoaderJob(e,this.loadWholeContentColumnsByChunk.bind(this),t,"whole");if(i){var r=n.getJobInfos(i);if(r&&r.promise)return n._countOnGoingAttributesLoaders++,r.promise.finally(function(){n._countOnGoingAttributesLoaders--}),i}},loadWholeContentColumnsByChunk:function(e,t,n){var i=this.core.settingManager.getSetting("conversionChunkSize");return this._genericChunksLoader(e,t,i,n)},getJobInfos:function(e){if(e&&this.chunkLoaders&&this.chunkLoaders[e])return this.chunkLoaders[e]},stopAllLoadingJobs:function(){this.chunkLoaders&&this.cancelJobByIds(Object.getOwnPropertyNames(this.chunkLoaders))},cancelJobByIds:function(e){var t=this;t.chunkLoaders&&Array.isArray(e)&&e.forEach(function(e){var n=t.getJobInfos(e);n&&n.promise&&n.promise.cancelEmbeddedRequest()})},_prepareAndLaunchLoaderJob:function(e,t,n,i,o){if(Array.isArray(e)&&0!==e.length){if(0!==(e=this._getCandidateForChunkLoading(e,i,o)).length){var s=n;Array.isArray(n)||(s=[]),this.prepareNodesForLoadAdditionalColumns(e,s,o),this.chunkLoaders||(this.chunkLoaders={});var a=r.uid();return this.chunkLoaders[a]={},this.chunkLoaders[a].promise=t.call(this,e,a,i),a}}},_genericChunksLoader:function(e,t,n,i){var r=this,s=o.wrappedWithCancellablePromise(function(s,a){for(var l=n||r.core.settingManager.getSetting("defaultChunksize"),c=Math.ceil(e.length/l),d=[],u=0;u<c;u++)d[u]=u;r.chunkLoaders[t].remainingChunks=d;var p=o.wrappedWithCancellablePromise(function(e,t){e()});r.chunkLoaders[t].remainingChunks.reduce(function(n,s,a){return o.wrappedWithCancellablePromise(function(o,s){n.finally(function(n){if(!r||!r.chunkLoaders||!r.chunkLoaders[t]||r.chunkLoaders[t].shouldStop)return o();var c=l*a;r.loadAChunk(e.slice(c,c+l),i).then(function(){o()}).catch(function(e){s(e)})})})},p).finally(function(){r&&r.chunkLoaders&&delete r.chunkLoaders[t],s()})});return s.xEngEmbeddedRequest={cancel:function(e){r.chunkLoaders[t].shouldStop=!0}},s},filterAndUpdateColumnsState:function(e,t){if(Array.isArray(e)){var n=this.getAdditionalColumns(t).map(function(e){return e.dataIndex}),i=this.hasConvertissibleColumns();return e=e.filter(function(e){if(i&&!e.isAttributeConvertionStarted())return!0;for(var t=0;t<n.length;t++){const i=n[t];if(e.attributeRemoteLoadingNotStart(i))return!0}return!e.isRealAttributesConverted()}),this.withTransactionUpdate(function(){e.forEach(function(e){var t={};n.forEach(function(n){e.attributeRemoteLoadingNotStart(n)&&(t[n]="#loading#")}),i&&!e.isAttributeConvertionStarted()&&e.setAttributeConvertionStarted(!0),e.updateOptions({grid:t})})}),e}},loadAChunk:function(t,n){var r=this;return o.wrappedWithCancellablePromise(function(s,a){if(0===(t=r.filterAndUpdateColumnsState(t,n)).length)return s();var l=r.getColumnsProvidersDefinitionByPolicy(n).map(function(n){var i={},s=n.instance;return t.forEach(function(e){e.isGroupingNode||(!n.isTargetingOnlyInstance||e.getViewType&&"reference"!==e.getViewType())&&function(e,t,n){for(var i=n.getManagedColumnNames(),o={},s=0;s<i.length;s++){var a=i[s],l=e.isAttributePending(a)?void 0:e.options.grid[a];o[a]=l}if(!0===n.toBeUpdated(o)){void 0===t[n.getName()]&&(t[n.getName()]={pids:[],relids:[],occpaths:[]});var c=e.getID();if(-1===t[n.getName()].pids.indexOf(c)&&(e.getUsages&&Array.isArray(e.getUsages())&&e.getUsages().length>=1?e.getUsages().forEach(e=>{let i=e.getID(),r=n.getName();-1===t[r].pids.indexOf(i)&&t[r].pids.push(i)}):t[n.getName()].pids.push(c)),e.getRelationID&&"function"==typeof e.getRelationID?t=r.getAdditionalColumnsInfo(e,t,n):e.getUsages&&Array.isArray(e.getUsages())&&e.getUsages().length>=1&&e.getUsages().forEach(e=>{t=r.getAdditionalColumnsInfo(e,t,n)}),e.getOccurrencePath&&"function"==typeof e.getOccurrencePath){var d=e.getOccurrencePath();d&&t[n.getName()].occpaths.push(d)}}}(e,i,s)}),o.wrappedWithPromise(function(n,o){var a=setTimeout(function(){var e=s.getManagedColumnNames();r&&r.withTransactionUpdate(function(){t.forEach(function(t){var n={};e.forEach(function(e){(t.isAttributePending(e)||void 0===t.getAttributeValue(e))&&(n[e]="#failed#")}),t.updateOptions({grid:n})})}),console.warn("timeout reached"),o("timeout")},6e4);s.updateAttributes(i[s.getName()],function(i){var o=e.is(i,"string")?JSON.parse(i):i;r.core.sessionManager.shouldShowFinalItems()&&"CfgEffectivityColumns"===s.getName()&&(o=r.updateFlattenedViewEffectivityOptions(o,t)),r._applyAttributesInListContent(o,t),n(o),clearTimeout(a)})})});l.push(r.convertAttributeValuesWithUnit(t)),l.push(r.fetchDocumentAttributes(t)),l.push(r.fetchStaticMappingInfo(t)),o.allSettled(l).then(function(e){Array.isArray(e)&&e.length,Array.isArray(t)&&t.findIndex(e=>e.getID()===r.core.contextManager.getActiveEngItem().getID())>-1&&r.core.mediator.publish(i.EVENT_SYNC_VIEW_WITH_EI_MODEL),s()})})},convertAttributeValuesWithUnit:function(e){return o.wrappedWithPromise(t=>{const i=[],r=e.filter(function(e){return!e.isRealAttributesConverted()||e.hasQuantity()});r.forEach(e=>{if(this.getConvertissibleAttributes().forEach(t=>{if(t.ds6wFrom&&"rel"===t.ds6wFrom)if(e.hasUsages()){const n=e.getUsages().map(e=>({value:e.getAttributeValue(t.dataIndex),dimension:t.attrDim,toUnit:t.attrUnit,sixw:t.dataIndex,relid:e.getRelationID?e.getRelationID():null}));i.push(...n)}else e.getRelationID&&i.push({value:e.getAttributeValue(t.dataIndex),dimension:t.attrDim,toUnit:t.attrUnit,sixw:t.dataIndex,relid:e.getRelationID()});else i.push({value:e.getAttributeValue(t.dataIndex),dimension:t.attrDim,toUnit:t.attrUnit,sixw:t.dataIndex,pid:e.getID()})}),e.isRawMaterialType()||e.getAttributesToConvert(i),this.core.sessionManager.shouldShowQuantityView())if(e.isRawMaterialType()){let t=[];e&&e.options.grid.quantity&&e.options.grid.quantity.forEach(function(e){e.getAttributesToConvert(t)});let n=t.reduce((e,t)=>e+parseFloat(t.value),0),r={...t[0],nodeid:e.buildNodeId(),value:n.toString()};i.push(r)}else e&&e.options.grid.quantity&&e.options.grid.quantity.forEach(function(e){e.getAttributesToConvert(i)})}),n.updateAttributes(i,n=>{r.forEach(function(e){e.setRealAttributesConvertState(!0)}),this._applyAttributesInListContent(n,e),t()})})},fetchDocumentAttributes:function(e){return o.wrappedWithPromise((t,n)=>{const r=e.filter(e=>e.isDocument(i.SPECIFICATION_DOCUMENT));r.length?this.core.dataService.updateDocumentNodesData(r).then(()=>{t()}):t()})},fetchStaticMappingInfo:function(e){const t=this;return o.wrappedWithPromise(function(n,i){const r=e.filter(e=>e.isEngineeringItem&&e.isEngineeringItem());if(r.length&&t.core.settingManager.isProductConfEnabled()){const e=r.map(e=>e.getRelationID());t.core.dataService.getStatticMappingPCInfo(e).then(i=>{var o={};e[0],e.forEach(function(e){o[e=e]={Configuration:" ",ConfigurationID:" ",hasStaticMapping:" "}});const s=[];i&&e.forEach(function(e){if(e&&"true"===i[e].hasStaticMapping){i[e].content.results[0].data.some(function(t){"Marketing Name"===t.name&&(o[e].Configuration=t.value[0])}),o[e].ConfigurationID=i[e].content.results[0].physicalID,o[e].hasStaticMapping=!0;const t={referenceId:e,options:{grid:{Configuration:o[e].Configuration,ConfigurationID:o[e].ConfigurationID,hasStaticMapping:o[e].hasStaticMapping}}};s.push(t)}}),t.changeSetMerger(s,r),n()})}else n()})},getAdditionalColumnsInfo:function(e,t,n){if(e.isDocument())return t;var i=e.getRelationID();if(i&&(-1===t[n.getName()].relids.indexOf(i)&&t[n.getName()].relids.push(i),e.getFirstLevelInstanceID&&"function"==typeof e.getFirstLevelInstanceID&&"CfgEffectivityColumns"===n.getName())){var r=e.getFirstLevelInstanceID();r&&t[n.getName()].relids.push(r),this._effInstanceIDs.push(i)}return t},applyUpdatedEffectivities:function(e){var t=this,n={relids:{}};if("SUCCESS"===e.GlobalStatus&&e.results){var i=e.results;Object.getOwnPropertyNames(i).forEach(function(e){var r=i[e];if("SUCCESS"===r.status&&r.existing.content){var o=r.existing.content;o&&o.Evolution?n.relids[r.existing.pid]={Effectivity:t.core.i18nManager.get("Yes"),CurrentEvolutionEffectivity:o.Evolution.Current,ProjectedEvolutionEffectivity:o.Evolution.Projected}:o&&o.Variant&&(n.relids[r.existing.id]={Effectivity:t.core.i18nManager.get("Yes"),VariantEffectivity:o.Variant})}else if("SUCCESS"===r.status)if(r.existing.id)t.getSelectedNodes().length>0&&" "!==t.getSelectedNodes()[0].getInstanceEvolution()&&t.getSelectedNodes()[0].getInstanceEvolution()!==t.core.i18nManager.get("None")?n.relids[r.existing.id]={VariantEffectivity:t.core.i18nManager.get("None")}:n.relids[r.existing.id]={Effectivity:t.core.i18nManager.get("label_no"),VariantEffectivity:t.core.i18nManager.get("None")};else{if(!r.existing.pid)return;t.getSelectedNodes().length>0&&" "!==t.getSelectedNodes()[0].getInstanceVariant()&&t.getSelectedNodes()[0].getInstanceVariant()!==t.core.i18nManager.get("None")?n.relids[r.existing.pid]={CurrentEvolutionEffectivity:t.core.i18nManager.get("None"),ProjectedEvolutionEffectivity:t.core.i18nManager.get("None")}:n.relids[r.existing.pid]={Effectivity:t.core.i18nManager.get("label_no"),CurrentEvolutionEffectivity:t.core.i18nManager.get("None"),ProjectedEvolutionEffectivity:t.core.i18nManager.get("None")}}})}else"ERROR"===e.GlobalStatus&&e.results&&"FAILED"===e.results[0].status&&s.errorAlert(e.results[0].errorDetails);this._applyAttributesInListContent(n)},updateFlattenedViewEffectivityOptions:function(e,t){let n={},i=[];return t.forEach(e=>{if(e.getRelationID&&e.getFirstLevelInstanceID)i.push(e);else{let t=e.getUsages?e.getUsages():[];i.push(...t)}}),i.forEach(t=>{if(t.getRelationID&&t.getFirstLevelInstanceID){let i=t.getRelationID(),r=t.getFirstLevelInstanceID();i&&r&&e.relids[r]&&(n[i]=e.relids[r])}}),e.relids=n,e},_applyAttributesInListContent:function(e,t){if(!e)return;let n=[];if(e.hasOwnProperty("relids")){const t=e.relids,i=Object.getOwnPropertyNames(t).map(e=>({instanceId:e,options:{grid:t[e]}}));n=n.concat(i)}if(e.hasOwnProperty("pids")){const t=e.pids,i=Object.getOwnPropertyNames(t).filter(e=>!t[e].Effectivity&&!t[e].ProductConfiguration).map(e=>({referenceId:e,options:{grid:t[e]}}));n=n.concat(i)}if(e.hasOwnProperty("occpaths")){const t=e.occpaths,i=Object.getOwnPropertyNames(t).map(e=>({occurrenceId:e.split(a.OccPathSep),options:{grid:t[e]}}));n=n.concat(i)}this.changeSetMerger(n,t)},changeSetMerger:function(e,t){if(!Array.isArray(e))return;let n=this;this.prepareUpdate(),e.forEach(function(e){n.updateNodesWithChangeSet(e,t)}),this.pushUpdate()},onLoadGroupBy:function(){const e=this.core.PersistencyManager.getGroupByOption();this.withTransactionUpdate(()=>this.ungroupRoots()),e&&this.core.contextManager._activeGridView&&this.core.contextManager._activeGridView.groupRows({dataIndexesToGroup:[e]})},onSorting:function(e){this.prepareUpdate(),widget.setValue("sorting",e);var t="asc"===(e.sortOrder||"").toLowerCase()?1:-1;this._getTrueRoot().sortChildren({isRecursive:!0,sortFunction:function(n,i){return t*(n.getSortableAttributeValue(e.sortAttribute)<i.getSortableAttributeValue(e.sortAttribute)?-1:1)}}),this.pushUpdate()},applyDefaultSort:function(){let e=function(e){let t=e.options.grid["ro.plminstance.V_treeorder-Instance"];return!t&&e.getUsages&&e.getUsages()&&e.getUsages().length>0&&(t=e.getUsages()[0].options.grid["ro.plminstance.V_treeorder-Instance"]),t?parseFloat(t):-1};this._getTrueRoot().sortChildren({isRecursive:!0,sortFunction:function(t,n){return e(t)<e(n)?-1:1}})},addFilterModel:function(e){const t=e.filter(e=>!this.core.columnsManager.isProvidedColumn(e.dataIndex)).reduce((e,t)=>{switch(t.dataIndex){case"tree":e.label={filterId:"stringRegexp"};break;case"ds6w:status":case"ds6wg:PLMReference.V_isLastVersion":case"ds6w:responsible":case"ds6w:reserved":case"ds6w:type":case"ds6wg:revision":case"ds6w:cadMaster":case"ds6w:reservedBy-Instance":case"ds6w:reservedBy":case"ds6w:reserved-Instance":e[t.dataIndex]={filterId:"set"};break;default:"boolean"===t.typeRepresentation?e[t.dataIndex]={filterId:"set"}:"string"===t.typeRepresentation?e[t.dataIndex]={filterId:"stringRegexp"}:"integer"===t.typeRepresentation?e[t.dataIndex]={filterId:"number"}:"float"===t.typeRepresentation?e[t.dataIndex]={filterId:"number"}:"datetime"===t.typeRepresentation?e[t.dataIndex]={filterId:"date"}:e[t.dataIndex]={filterId:"stringRegexp"}}return e},{});this.setFilterModel(t)},removeFilterView:function(){const e=this.core&&this.core.contextManager&&this.core.contextManager._activeGridView&&this.core.contextManager._activeGridView.getFilterViewManager?this.core.contextManager._activeGridView.getFilterViewManager():null,t=e?e.getFilterViews():null;e&&!e.isEmpty()&&(console.debug("DGV: Reset View Filter"),Object.keys(t).forEach(e=>{t[e].filter.filterModel=void 0}))},reApplyUserCurrentViewOptions:function(){try{this.core.PersistencyManager.restorePersistedSelection(this)}catch(e){console.error("something went wrong when re-applying user view options")}},reApplyGroups:function(){try{this.onLoadGroupBy()}catch(e){console.error("something went wrong when re-applying user view options")}},refreshProvidedColumns:function(e,t){this._effAllLoadJobIds.push(this.fillAttributesAsync4VisibleNodes(e,t,void 0,"visible"))},mainAddContent:function(e,t,n,r,o,s){if(Array.isArray(e)&&0!==e.length){var a=this,l=this.core.contextManager.getActiveEngItem()?this.core.contextManager.getActiveEngItem().getID():null,c=!0;void 0!==n&&n.length>0&&l&&l!==n[0]&&(c=!1);try{if(s&&!a.core.contextManager.isActiveEngItemSelected())a.insertNodesAtRowId(e);else if(t&&t.getID()!==l)t.addChildToTheTargetNode(e);else if(c)a.addRoot(e);else if(o){if(void 0!==r)for(var d=0;d<r.length;d++)if(r[d].isChildComputed())for(var u=0;u<e.length;u++)r[d].addChild(e[u])}else if(void 0!==r)for(d=0;d<r.length;d++)r[d].isChildComputed()&&r[d].addChild(e[d]);a.fetchAdditionalColumns(e).then(()=>{a.reApplyGroups(),a.core.mediator.publish(i.EVENT_NOTIFY_CONTENT_SIZE_CHANGE)})}catch(e){console.error(e)}}},_contentUpdated:function(e,t,n){if(Array.isArray(e)){var r=this;r.applyDefaultSortOnNodes=r.core.sessionManager.shouldShowIndentedView()&&!r.core.sessionManager.shouldShowQuantityView(),r.core.mediator.subscribe(i.EVENT_DISABLE_SORT_TO_DEFAULT,function(e){r.applyDefaultSortOnNodes=!e}),r.fetchAdditionalColumns(e).then(()=>{r.reApplyGroups(),r.applyDefaultSortOnNodes&&r.applyDefaultSort(),r.core.mediator.publish(i.EVENT_REAPPLY_DATAGRID_SORT_MODEL),r.core.mediator.publish(i.EVENT_NOTIFY_CONTENT_SIZE_CHANGE)}),r.core.mediator.publish("content-loader-indicator-progress",90/r._contentFetchers.length),e.length>0&&r.core.mediator.publish(i.EVENT_NOTIFY_CONTENT_SIZE_CHANGE)}else console.error("_contentUpdated expect an array as input")},getAppropriateSessionBuilder:function(){if(this.getEngineeringItem().hasValidTransientGroupingContext()){if(i.supportTaggerGroupInViews)return"group";if(!(this.core.sessionManager.shouldShowFinalItems()||this.core.sessionManager.shouldShowMfgView()||this.core.sessionManager.showMadeFrom()||this.core.sessionManager.shouldShowFlatView()))return"group";s.warningNotif({title:this.core.i18nManager.get("eng.failed.apply.expand.group.title"),subtitle:this.core.i18nManager.get("eng.failed.apply.expand.group.subtitle")})}return this.getEngineeringItem().hasValidTransientNextGenFilter()||this.getEngineeringItem().hasValidPersistedNextGenFilter()||this.getEngineeringItem().hasPesistencyManagerdNGFilter()?"nextGenFilter":"default"},retrievePreferreedNGFilter:function(e){var t=this;return o.wrappedWithPromise(function(n,i){if(!e)return i(new Error("no filters found in preference"));var r=t.getBIFilter();if(!r)return i(new Error("no BIFilter infra to manage Filters"));r.retrieveFilters({filterObjects:[{envId:t.core.settingManager.getPlatformId(),serviceId:"3DSpace",contextId:"",objectId:e.filterId,objectType:"ENOStrRefinementSpecification",displayName:e.filterName}],droppedEnvId:t.core.settingManager.getPlatformId(),doNotFillTheTagger:!1,callback:function(e){return e&&Array.isArray(e.success)&&e.success.length>0?n(e.success):e&&Array.isArray(e.failure)&&e.failure.length>0?i(e.failure[0].msg):e&&Array.isArray(e.errors)&&e.errors.length>0?i(new Error("unable to retrieve Filters")):void 0}})})},_buildGroupedContent:async function(e){const{groups:t}=e||{};if(Array.isArray(t)){t.length?this.getEngineeringItem().setTransientGroupingContext(t):this.getEngineeringItem().removeTransientGroupingContext(),this._contentFetchers=[],this._contentIsLoading=!1;try{await this.buildUserWorkingSession()}catch(e){this.core.logger.error(e),s.unexpectedFailure(this.appCore.i18nManager.get("failure.tagger.grouping"))}this.core.mediator.publish(i.EVENT_STRUCTURE_VIEW_CHANGED)}},_buildFilteredContent:function(e){if(!e||!Array.isArray(e.filterRootIds)||e.filterRootIds.indexOf(this.getEngineeringItem().getID())<0)return null;e.empty&&(e=null,this.getEngineeringItem().detachPersistedFilter()),this.getEngineeringItem().setTransientNGFilteringContext(e),this.getEngineeringItem().attachPreferedConfigModel(null),this.core.mediator.publish(i.EVENT_UPDATE_IDCARD_RENDERING,!1),this._contentFetchers=[],this._contentIsLoading=!1,this.buildUserWorkingSession().then(function(e){console.log(e)}).catch(function(e){this.core.logger.error(e),s.unexpectedFailure(this.appCore.i18nManager.get("failure.applyNGFilter"))})},buildUserWorkingSession:function(e){return this.withTransactionUpdate(()=>this.ungroupRoots()),this.stopAllLoadingJobs(),this.empty(),Array.isArray(this._contentFetchers)&&this._contentFetchers.forEach(e=>{e.cancelEmbeddedRequest&&e.cancelEmbeddedRequest()}),this.attributesWithDimensionPartiallyConverted=!1,this.updateBIFilterFromViewOptions(),o.wrappedWithPromise((t,n)=>{this.core.sessionManager.buildAppropriateSession(this,e).then(()=>{Promise.allSettled(this._contentFetchers).then(()=>{this.core.sessionManager.shouldShowFlatView()||this.core.mediator.publish(i.EVENT_REAPPLY_DATAGRID_SORT_MODEL)}),t(!0)}).catch(e=>n(e))})},updateBIFilterFromViewOptions(){const{contextManager:e,sessionManager:t,mediator:n,PreferencesManager:i}=this.core||{};if(!(t&&n&&e&&i&&e.getXENTreeDocument()&&e.getActiveEngItem()))return;const r=e.getXENTreeDocument().getFilterOptionsFromSessionManager();e.getXENTreeDocument().updateXENBIFilterProxy(r);const o=i.isSpecInProductStructureEnabled(),s=t.showMadeFrom();this.getBIFilter().setApplicativeSpec(o,s)},hasBeenHandledByASessionManager:function(){return this.isFilledByASessionManager},fetchHolisticContentDefiniton:function(){if(this.core.logger.info("fetch HolisticContentDefiniton "+Date.now()),!Array.isArray(this._contentFetchers))throw new Error("invalid _contentFetchers ");o.allSettled(this._contentFetchers).then(e=>{this._contentFetchers=[],this._contentIsLoading=!1,this.reApplyUserCurrentViewOptions(),this.isFilledByASessionManager=!0,this.core.mediator.publish("content-loader-indicator-completed"),this.pushToTagger(),this.core.logger.info("all HolisticContentDefiniton is loaded "+Date.now())})},registerContentFetcher:function(e,t,n,o){if(!e||!t)throw new Error("invalid input of registerContentFetcher");var a=this;return a._contentFetchers.push(e),1===a._contentFetchers.length&&(a._contentIsLoading=!0,a.core.mediator.publish("content-loader-indicator-start")),e.then(function(e){a.core.logger.info(t+" content fetched successfully "),a._contentUpdated(e,n,o?o[i.CONST_TARGET_LEVEL]:void 0)}).catch(function(e){console.error(e),a.core.mediator.publish("content-loader-indicator-progress",90/a._contentFetchers.length),a.core.logger.error(e),a.core.logger.error(t),r.isServiceTimedOut(e)?s.warningAlert(a.core.i18nManager.get("switch_index_mode_on_large_data")):s.unexpectedFailure(a.core.i18nManager.replace(a.core.i18nManager.get("failure.fetch.object.content"),{object:n.getLabel(),content:a.core.i18nManager.get(t)}))}),a},insertNodesAtRowId:function(e){var t=this;let n=t.mapSelectedItemsByOccurencePath();e.forEach(e=>{let i=n[e.getOccurrencePath().join("/")];if(i.getOccurrencePath().join("/")===e.getOccurrencePath().join("/")){let n=i.getParent(),r=n._getRowID(),o=i._getRowID();if(t.core.sessionManager.shouldShowQuantityView()&&e.setUsages(i.getUsages()),i.remove(),r>=0&&null!=r){let t=o-r;n.addChild(e,t)}else t.addRoot(e,o)}})},mapSelectedItemsByOccurencePath:function(){let e={};return this.core.contextManager.getXENTreeDocument().getSelectedNodes().forEach(t=>{e[t.getOccurrencePath().join("/")]=t}),e},fetchAdditionalColumns:function(e){let t=this;return o.wrappedWithPromise((n,r)=>{if(e||n(),e.length<=t.core.settingManager.getSetting("limitSizeForFullNodesConversion")){const i=t.asyncRetrieveMissingAttributes(e),r=t.getJobInfos(i);t._wholeContentLoaderJobIds.push(i),r&&r.promise&&t._wholeContentLoaderJobPromises.push(r.promise),Promise.all(t._wholeContentLoaderJobPromises).then(()=>{t._wholeContentLoaderJobPromises=[],n()})}else{t.attributesWithDimensionPartiallyConverted=!0,t.core.columnsManager.getVisibleColumns().find(e=>"real"===e.kind)&&t.core.mediator.publish(i.EVENT_COLUMNS_CHANGED,{updateExitingColumns:!0}),n()}})},areAttributesWithDimensionPartiallyConverted(){return this.attributesWithDimensionPartiallyConverted},addEngItemDocuments:function(e){let t=this;const n=t.getEngineeringItem().getID();return o.wrappedWithCancellablePromise(function(i,r){t.core.dataService.getEngItemRelatedDocuments(n,e).then(e=>{t.withTransactionUpdate(function(){e.forEach(function(e){e.options.grid.level=1}),t.addRoot(e)}),i(e)}).catch(e=>r(e))})},addChildDocuments:function(e,t){let n=this;const i=Array.isArray(e)?e[0].getID():e.getID(),r=Array.isArray(e)?e[0]:e;return o.wrappedWithCancellablePromise(function(e,o){n.core.dataService.getEngItemRelatedDocuments(i,t).then(t=>{n.withTransactionUpdate(function(){t.forEach(e=>{r.addChild(e)})}),e(t)}).catch(e=>o(e))})},buildFindInContextQuery:function(e){let t,n=e&&e.searchFts?"*"+e.searchFts+"*":null,i=e&&e.selectedPredicates&&Array.isArray(e.selectedPredicates)?e.selectedPredicates:["ds6w:label"];if(Array.isArray(i)&&n){let e=null;i.forEach(function(t){if("physicalid"===t)return;let i="["+t+"]:"+n;e=e?e+" OR "+i:i}),t={"q.query":e}}return t?[t]:[{"q.query":"[ds6w:label]:* *"}]},buildpayloadForFindIncontext:function(e,t){let n={};n.select_bo=this.core.dicoService.getTagsForBOWithMandatories(),n.select_rel=this.core.dicoService.getTagsForRelWithMandatories(),n.compute_select_bo=this.core.settingManager.getSetting("compute_select_bo"),n.fcs_url_mode="REDIRECT",n.specVersion="420.6.1",n.max_count_path="301",n.union={};const i={};return i.root_path_physicalid=e,i.expand_iter="-1",i.no_type_filter_rel=["XCADBaseDependency"],i.type_filter_rel=["PLMInstance"],i["q.iterative_filter_query_bo"]='[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"',i.find_in_context=this.buildFindInContextQuery(t),n.union.expand=[i],n},expandGroupedEngItemChildren:function(e,t){if(!Array.isArray(e))throw new Error("invalid input parameters");const n=this.core.contextManager.getActiveEngItem().getID();if(!n)throw new Error("abnormal situation");let r=!1;const s=[[n]];let a=t?t[i.CONST_TARGET_LEVEL]:void 0,l=a||"1";const c=this.core.sessionManager.shouldShowFlatView(),u={level:l=this.isExpandAllRequired()?"-1":l,paths:s},p={parentPaths:s};return this.options.expandPromise=o.wrappedWithCancellablePromise((t,o)=>{e.forEach(e=>{if(!e.isGroupingNode)return;const{groups:s,group:a}=e.options;if(!a||!s)return void console.error("abnormal situation");s.getChildren(a).forEach(t=>e.addChild(new d({label:t.getLabel(),groups:s,group:t,icons:[{iconName:"group"}],useAsyncPreExpand:!0,children:[],padgrid:{"ds6w:globalType":"groupNodeFromTagger"},appCore:this.core})));const g=this._FilterBI.getExpandSpec(n,a.getGroupIntentForExpand(),"group");g.outputs={select_object:this.core.dicoService.getTagsForBOWithMandatories(),select_relation:this.core.dicoService.getTagsForRelWithMandatories(),hits:{predefined_computation:["icons","urlstream|thumbnail_2d|2dthb"]},format:"entity_relation_occurrence"},this.core.dataService.doExpand(g,{executor:i.COMMAND_WS_EXPAND_CV_V2,payloadAlreadyConverted:!0}).then(o=>{if(r)return t([]);this.core.Factories.ListItemFactory.buildNodesFromExpandResult(o,u,p).then(r=>{const o=r[n];i.supportTaggerGroupInViews?"1"!==l&&o.length?this.addChildren(o,l).then(t=>{Array.isArray(t)&&t.length?(c&&o.forEach(t=>e.addChild(t)),t.forEach(t=>e.addChild(t))):o.forEach(t=>e.addChild(t))}):o.forEach(t=>e.addChild(t)):o.forEach(t=>e.addChild(t)),t(o)})}).catch(function(e){console.error(e),o(e)})})}),this.options.expandPromise.cancelEmbeddedRequest=(()=>r=!0),this.options.expandPromise},addGroupedEngItemChildren:function(e){let t=!1;const n=this.getEngineeringItem().getID(),r=this.getEngineeringItem().getTransientGroupingContext(),s=this.getBIFilter().getGroupingSpec([[n]],r,"group");return this.options.expandPromise=o.wrappedWithCancellablePromise((o,a)=>{this.core.dataService.doExpand(s,{executor:i.COMMAND_WS_EXPAND_CV_V2,payloadAlreadyConverted:!0}).then(i=>{if(t)return o([]);const s={groupingIntent:r};this.core.Factories.ListItemFactory.buildGroupNodesFromExpandResult(i,s,e).then(e=>{Array.isArray(e)&&e.length||o([]);const t={};t[n]=e;const i=this.addNewNodes(null,t);o(i)}).catch(e=>{console.debug(e);const{message:t}=e||{};"no group found"===t&&o([]),a(e)})}).catch(function(e){console.error(e),a(e)})}),this.options.expandPromise.cancelEmbeddedRequest=(()=>t=!0),this.options.expandPromise},addFilteredEngItemChildren:function(e){let t=this,n=e?e[i.CONST_TARGET_LEVEL]:void 0,r=!1;const s=t.getEngineeringItem().getID(),a={nextGenFilterOption:t.getEngineeringItem().getNextGenFilterExpandOptions()};let l=[[s]];const c={level:"-1",paths:l},d={parentPaths:l};return t.options.expandPromise=o.wrappedWithCancellablePromise(function(e,i){t.core.dataService.multiExpandV2(a).then(i=>{if(r)return e([]);t.core.Factories.ListItemFactory.buildNodesFromExpandResult(i,c,d).then(i=>{let r=t.addNewNodes(null,i);n&&t.withTransactionUpdate(()=>{let e=parseInt(n)-1;t.expandVisuNodes(r,e)}),e(r)})}).catch(function(e){console.error(e),i(e)})}),t.options.expandPromise.cancelEmbeddedRequest=function(){r=!0},t.options.expandPromise},isExpandAllRequired:function(){const e=this.core.sessionManager.shouldShowFinalItems(),t=this.core.sessionManager.shouldShowMfgView(),n=this.core.sessionManager.shouldShowLeafMaterials(),i=this.core.sessionManager.shouldShowFlatView();return e||t||n||i},isExpandOnIndexRequired:function(){const e=this.core.sessionManager.shouldShowFinalItems(),t=this.core.sessionManager.shouldShowLeafMaterials();return e||t},addEngItemChildren:function(e){let t=this,n=e?e[i.CONST_TARGET_LEVEL]:void 0,r=!1;const s=t.getEngineeringItem().getID();let a=n||"1",l=[[s]];const c={level:a=this.isExpandAllRequired()?"-1":a,paths:l,type_filter_rel:t.core.sessionManager.showMadeFrom()?["PLMInstance","MustBeMadeFrom"]:["PLMInstance"]};this.isExpandOnIndexRequired()&&(c.isOnAuthoring=!1);const d={parentPaths:l};return t.options.expandPromise=o.wrappedWithCancellablePromise(function(e,i){t.getEngineeringItem().retrieveFilteringBinary().then(o=>{o&&o.FilterCompiledForm&&(c.config_filter=o.FilterCompiledForm),t.core.dataService.expandV2(c).then(i=>{if(r)return e([]);t.core.Factories.ListItemFactory.buildNodesFromExpandResult(i,c,d).then(i=>{let r=t.addNewNodes(null,i);if(n){let e=parseInt(n)-1;t.withTransactionUpdate(()=>{t.expandVisuNodes(r,e)})}e(r)})}).catch(function(e){console.error(e),i(e)})}).catch(function(t){if(r)return e([]);console.error(t),i(t)})}),t.options.expandPromise.cancelEmbeddedRequest=function(){r=!0},t.options.expandPromise},addOrUpdateRoots:function(e){let t=this,n=this.getRoots(),i=[];if(e&&n&&n.length>0){let t=r.createMap(n,e=>e.buildNodeId&&e.buildNodeId(),e=>e);e.forEach(e=>{let n=t[e.buildNodeId()];if(n){let t=e.getUsages();n.addUsages(t),n.updateOptions(n.options)}else i.push(e)})}else i=e;i&&t.withTransactionUpdate(()=>{t.addRoot(i)})},addOrUpdateChildrenToNodes:function(e,t,n){let i=r.createMap(e,e=>e.getOccurrencePath().join("/"),e=>e),o=[];return this.withTransactionUpdate(function(){for(let e in i){let s=i[e].getChildren(),a=t[e]?t[e]:void 0,l=[];if(s&&s.length>0){let e=r.createMap(s,e=>e.buildNodeId(),e=>e);a&&a.forEach(t=>{let i=e[t.buildNodeId()];if(i){let e=t.getUsages();n||(i.addUsages(e),i.updateOptions(i.options))}else l.push(t)})}else l=a;l&&(i[e].addChild(l),i[e].options.childComputed=!n,o=[...o,...l])}}),o},addChildren:function(e,t="1"){let n=this,i=!1;const r=n.core.sessionManager.shouldShowFinalItems(),s=n.core.sessionManager.shouldShowMfgView(),a=n.core.sessionManager.showMadeFrom();let l=r||s||a?"-1":t,c=e.map(e=>e.getOccurrencePath());const d={level:l,paths:c,type_filter_rel:a?["PLMInstance","MustBeMadeFrom"]:["PLMInstance"]},u={parentPaths:c};return n.options.expandPromise=o.wrappedWithCancellablePromise(function(r,o){n.core.contextManager.getActiveEngItem().retrieveFilteringBinary().then(s=>{s&&s.FilterCompiledForm&&(d.config_filter=s.FilterCompiledForm),n.core.dataService.expandV2(d).then(o=>{if(i)return r([]);n.core.Factories.ListItemFactory.buildNodesFromExpandResult(o,d,u).then(i=>{let o=n.addNewNodes(e,i);n.withTransactionUpdate(()=>{n.expandVisuNodes(e,parseInt(t))}),r(o)})}).catch(function(e){if(i)return r([]);console.error(e),o(e)})}).catch(function(e){if(i)return r([]);console.error(e),o(e)})}),n.options.expandPromise.cancelEmbeddedRequest=function(){i=!0},n.options.expandPromise},addFindEngItemChildren:function(e,t){let n=this,a=!1,l=[],c=[],d=t?t[i.CONST_TARGET_LEVEL]:void 0,u=t[i.CONST_FIND_IN_CRITERIA];if(e=u.selectedNodes,!Array.isArray(e))throw new Error("EngItemContentTreeDocument require two valid parameters");e.forEach(function(e){l.push(e.getOccurrencePath())});const p={level:"-1",paths:l,partiallyExpanded:!0};n.removeFilterView();let g=n.core.contextManager&&n.core.contextManager._activeGridView&&n.core.contextManager._activeGridView.model?n.core.contextManager._activeGridView.model:e,h=[];Array.isArray(g)&&g.forEach(function(e){r.isNodeFromModel(e)&&(e.isEngineeringItem()||e.isDrawing())&&(Array.isArray(e.getUsages())&&e.getUsages().length>0&&e.getUsages().forEach(function(e){c.push(e.getOccurrencePath())}),h.push(e),c.push(e.getOccurrencePath()))});const m={parentPaths:c};let f=n.buildpayloadForFindIncontext(l,u);return n.options.expandPromise=o.wrappedWithCancellablePromise(function(t,r){n.core.sessionManager.shouldShowFlatView()||n.core.contextManager.getActiveEngItem().hasValidTransientNextGenFilter()||n.core.contextManager.getActiveEngItem().hasValidPersistedNextGenFilter()?(n.core.mediator.publish(i.EVENT_FIND_IN_CONTEXT_VIEW_BUILT,!0),n.expandVisuNodes(e,parseInt(d),!0),t(n.getAllDescendants())):n.core.dataService.multiExpandForFindInContext(f,p).then(r=>r.results&&Array.isArray(r.results)&&0==r.results.length?(s.notifyAlert(n.core.i18nManager.get("eng.findCmd.find.noResultsFound")),n.core.mediator.publish(i.EVENT_FIND_IN_CONTEXT_VIEW_BUILT,!1),n.core.mediator.publish(i.EVENT_DISABLE_SORT_TO_DEFAULT,!0),t([])):a?t([]):void n.core.Factories.ListItemFactory.buildNodesFromExpandResult(r,p,m).then(r=>{let o=n.addNewNodes(h,r,!0);n.withTransactionUpdate(()=>{n.expandVisuNodes(e,parseInt(d),!0)}),n.core.mediator.publish(i.EVENT_FIND_IN_CONTEXT_VIEW_BUILT,!0),n.core.mediator.publish(i.EVENT_DISABLE_SORT_TO_DEFAULT,!0),301==o.length&&s.warningAlert(n.core.i18nManager.get("tooManyResultFound").replace("{maxResult}",o.length-1)),t(e)})).catch(function(e){console.error(e),r(e)})}),n.options.expandPromise.cancelEmbeddedRequest=function(){a=!0},n.options.expandPromise},expandVisuNodes(e,t,n){let o=this,s=n?i.CONST_PARTIALLY_EXPANDED:"expanded";e&&Array.isArray(e)&&0!==e.length&&e.forEach(e=>{r.isNodeFromModel(e)&&0!==t&&e.isEngineeringItem()&&(e.setState({state:s}),o.expandVisuNodes(e.getChildren(),t-1,n))})},addNewInstances(e){let t=this.getEngineeringItem().getID(),n=!1,i=e.map(e=>e.parent),r=[...new Set(i)],a=this.findNodesByIds(r).filter(e=>e.isChildComputed()),l=a.reduce((e,t)=>{let n=t.getID();return e[n]||(e[n]=[]),e[n].push(t.getOccurrencePath()),e},{}),c=[],d=[];e.forEach(e=>{let i=[[t]];if(e.parent!==t&&(i=l[e.parent]),i){let t=i.map(t=>[...t,e.instance,e.child]);c.push(...t),d.push(...i)}e.split&&(n=!0)});const u={level:"0",paths:c};let p=o.wrappedWithCancellablePromise((t,i)=>{this.core.dataService.expandV2(u).then(i=>{const r={parentPaths:d};e[0].productConfigurationFromSearch&&s.notifyAlert(this.core.i18nManager.get("product.configuration.data.visible.indexed")),this.core.Factories.ListItemFactory.buildNodesFromExpandResult(i,u,r).then(e=>{let i=this.addNewNodes(a,e);n&&i.forEach(function(e){e.select()}),t(i)})})});this.registerContentFetcher(p,"content.newInstances",null,null),this.fetchHolisticContentDefiniton()},addNewNodes(e,t,n){let i;if(e&&e.length>0)i=this.addOrUpdateChildrenToNodes(e,t,n);else{i=t[this.getEngineeringItem().getID()],this.addOrUpdateRoots(i)}return i}})}),define("DS/ENOXEngineer/services/XENCollectionsFactory",["UWA/Core","UWA/Class","DS/ENOXEngineer/collections/XEngGridTreeDocument","DS/ENOXEngineer/collections/EngItemContentTreeDocument","DS/ENOXEngineer/collections/XENContentProxyTreeDocument"],function(e,t,n,i,r){"use strict";return t.singleton({init:function(e){this._parent(e)},initialize:function(e){this.app=e,this.app.core.Factories||(this.app.core.Factories={}),this.app.core.logger.info("initializing XENCollectionsFactory ..."),this.app.core.Factories.CollectionsFactory=this,this.i18nManager=this.app.core.i18nManager},isInstanceContentModels:function(e){return e instanceof i},getEngItemContentModels:function(e,t){if(!this.app.core.Factories.ListItemFactory.isInstanceOfEngItem(e))throw console.warn(" getEngItemContentModels function expect a valid engineering item parameter"),new Error(" getEngItemContentModels function expect a valid engineering item parameter");var n=t||{};return n.core=this.app.core,n.enableNGFilter=!0,new i(e,n)},getXENProxyContentTreeDocument:function(){var e={core:this.app.core};return new r(e)}})}),define("DS/ENOXEngineer/services/ColumnsMgtService",["UWA/Core","UWA/Class","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/utils/MaturityUtils","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOX3DSpaceAttributesMgt/services/predicatesServices","DS/ENOXEngineer/commands/SessionPredicateEditionCmd","text!DS/ENOXEngineer/assets/config/ColumnsMetas.json"],function(e,t,n,i,r,o,s,a,l,c,d,u){"use strict";var p=JSON.parse(u),g=null;const h={notLocked:{icon:{iconName:"lock-open wux-ui-3ds",fontIconFamily:1},label:"",url:"#UNEXISTANT_ID"},locked:{icon:{iconName:"key wux-ui-3ds",fontIconFamily:1},label:"",url:"#UNEXISTANT_ID"},lockedByOther:{icon:{iconName:"lock wux-ui-3ds",fontIconFamily:1},label:"",url:"#UNEXISTANT_ID"}};return t.singleton({init:function(e){this._parent(e)},initialize:function(e){g=e;this.logger=g.core.logger.get("Columns Manager"),this.logger.info(" initializing Xeng Columns Manager services"),e.core.columnsManager=e.sandboxBase.columnsManager=this,this.i18nManager=g.core.i18nManager,this.loadedProviders=null,Object.defineProperty(this,"useArrayCellTypeRepresentation",{get:()=>!1,configurable:!0});g.core.mediator.subscribe(o.EVENT_ATTR_DICO_UPDATED,()=>{this.udpateColumns()});return this._loadColumnsProviders()},udpateColumns(){this.userPrefColumns=this.updateAvailableColumns()},isProvidedColumn:function(e){return!!e&&this.getVisibleAdditionalColumns().some(function(t){return t.dataIndex===e})},getVisibleAdditionalColumns:function(){return this.getAvailableColumnsWithNls().filter(function(e){return e.visibleFlag&&e.isAdditionalColumn})},getVisibleColumns:function(){return this.getAvailableColumnsWithNls().filter(function(e){return e.visibleFlag})},getAvailableColumnsWithNls:function(){return(this.getAvailableColumns()||[]).map(function(e){return e.ds6w?e.text=g.core.i18nManager.get(e.ds6w):e.text=g.core.i18nManager.get(e.dataIndex),e})},updateAvailableColumns(){const e=g.core.dicoService.getUserDicoPreferences()?g.core.dicoService.getUserDicoPreferences().columns:[],t={};e.forEach(e=>{t[e.dataIndex]=!0});const n=[];this.getAllProvidedColumns().forEach(e=>{t[e.dataIndex]||n.push(e)});const i=e.findLastIndex(e=>e.provider),r=i+1;return-1!==i&&r<e.length-1?e.splice(r,0,...n):e.push(...n),e},getAvailableColumns:function(){return this.userPrefColumns||(this.userPrefColumns=this.updateAvailableColumns()),this.userPrefColumns},getDatagridViewColumns:function(){this.getMappingOfAdditionalColumns(!0);let e=this.getVisibleColumns();return(e=this.removeColumnsBasedOnView(e)).map(e=>{let t=e.isAdditionalColumn?this.getGenericAdditionnalColumnDefinition(e.dataIndex):this.getColumnDefinition(e.dataIndex);return t&&(t.pinned=e&&e.pinned?e.pinned:t.pinned),t}).filter(e=>e)},getGenericAdditionnalColumnDefinition(e){return g.core.sessionManager.shouldShowQuantityView()?this.getAdditionalColumnDefinitionInReferenceView(e):this.getAdditionalColumnDefinition(e)},removeColumnsBasedOnView:function(e){let t=[];return g.core.sessionManager.shouldShowLeafMaterials()&&(t.push("MadeFrom"),e=e.filter(e=>!e.ds6wFrom||"rel"!=e.ds6wFrom||"occurence"==e.dataIndex)),g.core.sessionManager.shouldShowQuantityView()&&(t.push("CoveringMaterialInstance"),t.push("rawMaterialQuantity")),g.core.sessionManager.shouldShowQuantityView()||(t.push("quantity"),t.push("rollup")),e=e.filter(function(e){return-1===t.indexOf(e.dataIndex)})},getColumnMetas:function(e){return p.managedColumns[e]&&p.managedColumns[e].options?{...p.managedColumns[e].options}:{dataIndex:e}},publishNodesToRefresh:function(e){Array.isArray(e)&&g.core.mediator.publish(o.EVENT_REFRESH_ITEMS_BY_IDS,e)},isDatabaseModeSupported(e){if("computed"===e.nature&&!e.dbName)return!1;const t=e.ds6w||e.dataIndex;return!g.core.dicoService.isAClassificationPredicate(t)},getAttributeDefaultColumnMetas:function(e,t){let n=this.i18nManager.get(e);if(!t.ds6w)return{...t,text:n};const i=this.i18nManager.get(t.ds6w),r=this.i18nManager.get("eng.export.instance.key");n=t.ds6wFrom&&"rel"===t.ds6wFrom?i+` (${r})`:i;let o=null,s=null;g.core.sessionManager.isUsingDB()&&!this.isDatabaseModeSupported(t)?(o={fontIconFamily:1,iconName:"attention dgv-header-icon"},s=this.i18nManager.get("data-index-not-available-authoring-mode").replace("{dataIndex}",n)):"rel"===t.ds6wFrom&&(s=this.i18nManager.replace(this.i18nManager.get("tooltip_Instance_Column"),{label:i}));let a={text:n,icon:o,sortableFlag:this.getDefaultColumnSortability(t),editableFlag:this.getDefaultColumnEditability(t),...this.getColumnMetas(e)};return s&&(a.description=s),this.addDefaultColumnCallback(a,t),a},getDefaultColumnEditability:function(e){let t=this.isAnEditablePredicate(e.dataIndex);return g.core.dicoService.isMultiValuedAttribute(e.ds6w)&&(e.kind&&-1!==["datetime","timestamp"].indexOf(e.kind.toLowerCase())?t=!1:Reflect.has(e,"editable")||(t=!1)),g.core.sessionManager.shouldShowQuantityView()&&e.ds6wFrom&&"rel"===e.ds6wFrom&&(t=!1),t},getDefaultColumnSortability:function(e){return!g.core.sessionManager.shouldShowQuantityView()||!e.ds6wFrom||"rel"!==e.ds6wFrom},isRelAttributeInReferenceView:function(e){const t=g.core.sessionManager.shouldShowQuantityView(),n=e.ds6wFrom&&"rel"===e.ds6wFrom||"occurence"===e.dataIndex||"level"===e.dataIndex;return t&&n},addDefaultColumnCallback:function(e,t){const n=e.dataIndex;return e.getCellValue=(e=>{if(!s.isNodeFromModel(e&&e.nodeModel))return"";return e.nodeModel.getAttributeCellValue(n)}),e.getCellValueForSort=(e=>{if(!e||!s.isNodeFromModel(e))return"";const t=e.getAttributeCellValue(n);return t&&Array.isArray(t)&&t.length?t[0]:t}),e.getCellValueForExport=(e=>this.getCellValuesForExport(e,n)),"url"===e.typeRepresentation&&(e.getCellValueForCopy=(e=>e&&e.cellModel&&e.cellModel.label?e.cellModel.label:""),e.getCellGroupingKey=(e=>{if(e&&e.nodeModel)return e.nodeModel.options.grid[n]}),e.getCellValue=(e=>{if(!s.isNodeFromModel(e&&e.nodeModel))return"";const t=e.nodeModel.getAttributeCellValue(n);return t?{label:t,url:"#UNEXISTANT_ID"}:void 0})),!0===e.editableFlag&&(e.editionPolicy||(e.editionPolicy="EditionOnDoubleClick"),e.getCellEditableState=(e=>s.isNodeFromModel(e&&e.nodeModel)&&(e.nodeModel.isEngineeringItem()||e.nodeModel.isDocument()||g.core.dicoService.isAClassificationPredicate(n))&&!e.nodeModel.isCoreMaterialType()&&!("rel"===t.ds6wFrom&&"reference"===e.nodeModel.getViewType())&&this.isAnEditablePredicate(n)),e.setCellValue=((e,t)=>{this._setCellValue(e,n,t)})),e},getColumnDefinition:function(t){if(!t)return null;let n;const i=g.core.dicoService.getAttributeMetas(t);switch(i&&(n=this.getAttributeDefaultColumnMetas(t,i)),t){case"tree":return{...n,getCellValue:e=>{if(s.isNodeFromModel(e&&e.nodeModel))return{icon:e.nodeModel.getTypeIcon(),label:e.nodeModel.options.label,url:"#UNEXISTANT_ID"}},getCellValueForSort:e=>e.options.label,setCellValue:(e,t)=>{this._setCellValue(e,"tree",t.label)},processCellValueFromPaste:(e,t)=>({label:t}),getCellEditableState:e=>!!s.isNodeFromModel(e&&e.nodeModel)&&((!e.nodeModel.isCoreMaterialType||!e.nodeModel.isCoreMaterialType())&&(!e.nodeModel.isGroupingNode||!e.nodeModel.isGroupingNode)),getCellGroupingKey:e=>{if(e&&e.nodeModel)return e.nodeModel.options.grid["ds6w:label"]}};case"occurence":return{...n,text:this.i18nManager.get("occurence")};case"ds6w:reserved":return{...n,getCellValue:e=>{if(!s.isNodeFromModel(e&&e.nodeModel))return;if(!e.nodeModel.isEngineeringItem()&&!e.nodeModel._isFromOriginalModel())return"N/A";const n=g.core.settingManager.getUserName(),i=e.nodeModel.options.grid[t],r=e.nodeModel.options.grid["ds6w:reservedBy"];return e.nodeModel.isDocument()||e.nodeModel.isCoreMaterialType()?"TRUE"!==i?"N/A":"string"==typeof r&&r.trim().length&&"string"==typeof n&&n.trim().length?-1===r.toLowerCase().indexOf(n.toLowerCase())?h.lockedByOther:h.locked:"N/A":i&&"FALSE"!==i?r==n?h.locked:h.lockedByOther:h.notLocked},getCellGroupingKey:e=>{if(e&&e.nodeModel)return e.nodeModel.options.grid[t]},getCellValueForCopy:e=>{if(e&&e.nodeModel)return e.nodeModel.options.grid[t]},getCellValueForExport:e=>{if(e&&(e.nodeModel||e.cellModel))return e.rowID<0?e.cellModel:e.nodeModel.options.grid[t]},getCellTooltip:e=>{let n="";if(!(e.rowID<0)){if(void 0!==e.cellModel){const i=e.nodeModel.options.grid[t],r=e.nodeModel.options.grid["ds6w:reservedBy"];e.nodeModel.isDocument()?r&&(n=this.i18nManager.get("lockedBy").replace("{user}",r)):n=i&&"FALSE"!==i?this.i18nManager.get("lockedBy").replace("{user}",r)+"\n"+this.i18nManager.get("clickToUnlock"):this.i18nManager.get("notLocked")+"\n"+this.i18nManager.get("clickToLock")}return{shortHelp:n}}},getCellClassName:e=>e&&e.nodeModel?"xeng-key xeng-lock":null};case"ds6w:reserved-Instance":return{...n,getCellValue:n=>{if(!s.isNodeFromModel(n&&n.nodeModel))return;if(!n.nodeModel.isEngineeringItem()&&!n.nodeModel._isFromOriginalModel())return;var i=e.createElement("div",{class:"icons"});const r=new Set;if(!n.nodeModel.isDocument()&&!n.nodeModel.isDrawing()){return Array.isArray(n.nodeModel.getUsages())&&n.nodeModel.getUsages().length>=1?n.nodeModel.getUsages().forEach(e=>{r.add(this._getReservedInstanceNodeValue(e,t))}):r.add(this._getReservedInstanceNodeValue(n.nodeModel,t)),[...r].forEach(e=>{s.generateDomUtilsIcon(h[e].icon.iconName,i)}),i.outerHTML}},getCellValueForExport:e=>{if(!e||!e.nodeModel&&!e.cellModel)return;if(!s.isNodeFromModel(e&&e.nodeModel))return;let n="";if(e.rowID<0)n=e.cellModel;else{const i=new Set;Array.isArray(e.nodeModel.getUsages())&&e.nodeModel.getUsages().length>=1?(e.nodeModel.getUsages().forEach(e=>{i.add(e.options.grid[t])}),n=[...i].toString()):n=e.nodeModel.options.grid[t]}return n},getCellTooltip:e=>{let n="";if(!(e.rowID<0)){if(void 0!==e.cellModel){let i=e.nodeModel.options.grid[t],r=e.nodeModel.options.grid["ds6w:reservedBy-Instance"];if(g.core.sessionManager.shouldShowQuantityView()||e.nodeModel.isDocument()){const i=new Set;if(Array.isArray(e.nodeModel.getUsages())&&e.nodeModel.getUsages().length>=1){e.nodeModel.getUsages().forEach(e=>{i.add(this._getReservedInstanceNodeValue(e,t))});let r=[...i];n=r.includes("locked")||r.includes("lockedByOther")?this.i18nManager.get("multiLock"):this.i18nManager.get("multiUnlock")}}else n=i&&"FALSE"!==i?this.i18nManager.get("lockedBy").replace("{user}",r)+"\n"+this.i18nManager.get("clickToUnlock"):this.i18nManager.get("notLocked")+"\n"+this.i18nManager.get("clickToLock")}return{shortHelp:n}}},getCellClassName:e=>e&&e.nodeModel?"xeng-key xeng-lock":null,getCellGroupingKey:e=>{if(e&&e.nodeModel)return e.nodeModel.options.grid[t]}};case"ds6w:status":return{...n,getCellValue:e=>{if(e&&e.nodeModel)return void 0===e.nodeModel.options.grid[t]?"":e.nodeModel.options.grid[t]},getCellClassName:e=>{if(e.nodeModel){var t,n=e.nodeModel.options.grid[o.CONST_CURRENT_OBJECT_MATURITY_STATE],i=g.core.settingManager.getSetting("defaultPolicies");if(n){if("string"!=typeof n)return null;if(!1===n.contains(".")){var r=e.nodeModel.getReferenceValue("ds6w:policy");r&&g.core.dataService.getStatesAttributes([r]),n=r?r+"."+n:i[0]+"."+n}t=a.getAndCreateMaturityClass(n,"wux-controls-label")}return t}},getCellGroupingKey:e=>{if(e&&e.nodeModel)return e.nodeModel.options.grid[t]},getCellTypeRepresentation:function(e){if(e.nodeModel){var t=e.nodeModel.options.grid[o.CONST_CURRENT_OBJECT_MATURITY_STATE];return Array.isArray(t)?"string":"tag"}}};case"ds6w:responsible":return{...n,getCellValue:e=>{if(!s.isNodeFromModel(e&&e.nodeModel)||e.nodeModel.isGroupingNode)return;let n=g.core.settingManager.getCurrentUser&&g.core.settingManager.getCurrentUser()&&g.core.settingManager.getCurrentUser().id?g.core.settingManager.getCurrentUser().id:null,i=e.nodeModel.options.grid.owner?e.nodeModel.options.grid.owner:n;return{icon:g.core.settingManager.get3DswymUrl&&g.core.settingManager.get3DswymUrl()&&i?g.core.settingManager.getUserImage(i):"fonticon fonticon-user-alt",label:void 0===e.nodeModel.options.grid[t]?"":e.nodeModel.options.grid[t],url:"#UNEXISTANT_ID"}}};case"ds6w:label-Instance":return{...n,getCellEditableState:e=>s.isNodeFromModel(e&&e.nodeModel)&&(e.nodeModel.isEngineeringItem()||e.nodeModel.isDrawing())&&!("reference"===e.nodeModel.getViewType())};case"ds6wg:EnterpriseExtension.V_PartNumber":return{...n,getCellValue:e=>{if(s.isNodeFromModel(e&&e.nodeModel)&&e.nodeModel.isEngineeringItem&&e.nodeModel.isEngineeringItem())return{label:e.nodeModel.options.grid[t]?e.nodeModel.options.grid[t]:this.i18nManager.get("None"),url:"#UNEXISTANT_ID"}}};case"ds6wg:PLMReference.V_isLastVersion":return{...n,getCellValue:e=>{if(!e||!e.nodeModel)return null;var n=e.nodeModel.options.grid[t];return""!==n&&void 0!==n?"true"==n.toLowerCase():void 0},getCellClassName:e=>{if(!e||!e.nodeModel)return null;let n=e.nodeModel.options.grid[t];return n&&"true"==n.toLowerCase()?"xeng-lastRev-column-check":"xeng-lastRev-column-close"},getCellValueForExport:e=>{if(e&&(e.nodeModel||e.cellModel))return e.rowID<0?e.cellModel:e.nodeModel.options.grid[t]}};case"ds6w:description":return{...n,setCellValue:(e,n)=>{n=n.trim(),this._setCellValue(e,t,n)},getCellEditableState:e=>!!s.isNodeFromModel(e&&e.nodeModel)&&(e&&e.nodeModel&&!e.nodeModel.isCoreMaterialType())};case"ds6w:cadMaster":return{...n,getCellValue:e=>{if(e&&e.nodeModel&&e.nodeModel.options&&e.nodeModel.options.grid)return g.core.Factories.ListItemFactory.getCADIcon(e.nodeModel.options.grid[t])},getCellGroupingKey:e=>e.nodeModel.options.grid[t],getCellValueForExport:e=>{return e.rowID<0?e.cellModel:e.nodeModel.options.grid[t]}};case o.CONT_QUANTITY_MASS:return{...n,text:this.i18nManager.get("quantity_column_header").replace("{header}",this.i18nManager.get(t)).replace("{unit}",g.core.PreferencesManager.getNLSValueForMassQuantity()),description:this.i18nManager.get("quantity_column_header").replace("{header}",this.i18nManager.get(t)).replace("{unit}",g.core.PreferencesManager.getNLSValueForMassQuantity()),getCellValue:e=>{if(!s.isNodeFromModel(e&&e.nodeModel))return;if(!e.nodeModel.isEngineeringItem())return{label:"",url:o.UNEXISTANT_ID};let t=e.nodeModel.getMassQuantity();return t&&0!==t.trim().length||(t=""),{label:t,url:o.UNEXISTANT_ID}},getCellGroupingKey:e=>{let t=e.nodeModel.getMassQuantity();return t&&0!==t.trim().length||(t=""),t}};case o.CONT_QUANTITY_VOLUME:return{...n,text:this.i18nManager.get("quantity_column_header").replace("{header}",this.i18nManager.get(t)).replace("{unit}",g.core.PreferencesManager.getNLSValueForVolumeQuantity()),description:this.i18nManager.get("quantity_column_header").replace("{header}",this.i18nManager.get(t)).replace("{unit}",g.core.PreferencesManager.getNLSValueForVolumeQuantity()),getCellValue:e=>{if(!s.isNodeFromModel(e&&e.nodeModel))return;if(!e.nodeModel.isEngineeringItem())return{label:"",url:o.UNEXISTANT_ID};let t=e.nodeModel.getVolumeQuantity();return t&&0!==t.trim().length||(t=""),{label:t,url:o.UNEXISTANT_ID}},getCellGroupingKey:e=>{let t=e.nodeModel.getVolumeQuantity();return t&&0!==t.trim().length||(t=""),t}};case"rollup":return{...n,getCellValue:e=>{var t=e.nodeModel;if(!t._isFromOriginalModel())return null;const n=t.getRollUpMaterials();return t.isRawMaterialType&&t.isRawMaterialType()&&!n?{icon:{iconName:"block wux-ui-3ds",fontIconFamily:1},label:g.core.i18nManager.get("quantityColumn.rawMaterial.DBMode.NotAvailable"),url:"#UNEXISTANT_ID"}:{label:`${n}`,url:"#UNEXISTANT_ID"}},getCellGroupingKey:e=>{const t=e.nodeModel;let n=t._isFromOriginalModel()?t.getRollUpMaterials():null;return n&&0!==n.trim().length||(n=""),n},getCellValueForSort:e=>{if(!e||!e._isFromOriginalModel())return 0;const t=e.getRollUpMaterials();return Number.isNaN(Number.parseFloat(t))?0:Number.parseFloat(t)}};case"Thumbnail":return{...n,getCellValue:e=>e&&e.nodeModel&&e.nodeModel.options.grid[t]?e.nodeModel.options.grid[t]:void 0};case"ds6w:kind":return{...n,getCellValue:e=>{if(!e||!e.nodeModel)return;let n=g.core.settingManager.getSetting("mapSubTypeNLSKey")[e.nodeModel.options.grid[t]];return n?g.core.i18nManager.get(n):e.nodeModel.options.grid[t]}};case"ds6w:kind-Instance":return{...n,getCellValue:e=>{if(!e||!e.nodeModel)return;const n=new Set;if(Array.isArray(e.nodeModel.getUsages())&&e.nodeModel.getUsages().length>=1){return e.nodeModel.getUsages().forEach(e=>{let i=g.core.settingManager.getSetting("mapSubTypeNLSKey")[e.options.grid[t]];i=i?g.core.i18nManager.get(i):e.options.grid[t],n.add(i)}),[...n]}{let n=g.core.settingManager.getSetting("mapSubTypeNLSKey")[e.nodeModel.options.grid[t]];return n?g.core.i18nManager.get(n):e.nodeModel.options.grid[t]}}};case"ds6w:organizationResponsible":case"ds6w:organizationResponsible-Instance":case"ds6w:project-Instance":case"level":case"ds6wg:revision":case"ds6w:reservedBy":case"ds6w:type":case"ds6w:identifier":case"ds6w:project":return{...n};default:if(i){if(this.isColumnWithRangeValue(i.ds6w))return{...n,typeRepresentation:"string",getCellSemantics:this.getRangeCellSemantics.bind(this,i),setCellValue:(e,n)=>{const r=n?n.toString():"",o=this.getPossibleValues(i).getRoots().find(e=>e.options&&e.options.label===r),s=o?o.options.value:r,a=null!=s?s.toString():"";this._setCellValue(e,t,a)}};if(i.kind&&-1!==["datetime","timestamp"].indexOf(i.kind.toLowerCase()))return{...n,typeRepresentation:"datetime",semantics:{timePickerPrecision:"sec"},getCellValue:e=>{if(!s.isNodeFromModel(e&&e.nodeModel))return"";const n=e.nodeModel.getAttributeCellValue(t),i=s.getDGVformatedDate(n);return Array.isArray(i)?i:[i]},setCellValue:(e,n)=>{null!==n&&(n=(n=new Date(n)).toGMTString(),this._setCellValue(e,t,n))}};if(i.kind&&"boolean"===i.kind.toLowerCase()){const e=g.core.dicoService.isMultiValuedAttribute(i.ds6w)||!0===g.core.sessionManager.shouldShowQuantityView()&&"rel"===i.ds6wFrom?"string":"boolean";return{...n,typeRepresentation:"boolean",getCellTypeRepresentation:n=>this.getCellTypeRepresentation(n,i,t,e),setCellValue:(e,n)=>{n=n.toString(),this._setCellValue(e,t,n)}}}if(i.kind&&"integer"===i.kind.toLowerCase())return{...n,typeRepresentation:"integer",allowResetToUndefinedByUIFlag:!0,setCellValue:(e,n)=>{n=null!=n?n.toString():"",this._setCellValue(e,t,n)}};if(i.kind&&"real"===i.kind.toLowerCase()){var r;let e;if(i.attrDim&&i.attrUnit){r=!0;const t=g.core.dicoService.getUnit(i.attrDim,i.attrUnit);e=t&&t.NLSName?` (${t.NLSName})`:` (${i.attrUnit})`}const o=!r||!g.core.contextManager.getActiveEngItem().getContentModels().areAttributesWithDimensionPartiallyConverted();return{...n,text:n.text+(r?e:""),sortableFlag:o&&n.sortableFlag,groupableFlag:o,typeRepresentation:"float",allowResetToUndefinedByUIFlag:!0,description:o?n.description:this.i18nManager.get("warning.column.limitation.largeData"),setCellValue:(e,n)=>{n=null!=n?n.toString():"",e.nodeModel.options.grid[t+"_converted"]=n,this._setCellValue(e,t,n)}}}return{...n,typeRepresentation:"string"}}return n}},getCellTypeRepresentation:function(e,t,n,i){if(!(t&&n&&e&&e.nodeModel))return i;const r=this.useArrayCellTypeRepresentation?`array<${i}>`:"string";return"rel"===t.ds6wFrom&&"function"==typeof e.nodeModel.getUsages&&Array.isArray(e.nodeModel.getUsages())&&e.nodeModel.getUsages().length>=1||Array.isArray(e.nodeModel.getAttributeValue(n))?r:i},_getCellValue:function(e,t,n){const i=e?e.nodeModel:null;if(!i)return;const r=e=>{let i;return(()=>t.kind&&-1!==["datetime","timestamp"].indexOf(t.kind.toLowerCase()))()?(dateValue=e.options.grid[n],i=s.convertDateNodeValueToCellValue(dateValue)):(i=e.options.grid[n],g.core.dicoService.getRangeValueAttribute(t.ds6w)&&(Array.isArray(i)?i=i.map(e=>this.i18nManager.get(`${t.ds6w}/${e}`)):"string"==typeof i&&(i=this.i18nManager.get(`${t.ds6w}/${i}`)))),i};let o;return("level"==n||"occurence"==n||(()=>"rel"===t.ds6wFrom)())&&(()=>i.getUsages&&Array.isArray(i.getUsages())&&i.getUsages().length>=1)()?(o=[],i.getUsages().forEach(e=>{let t=r(e);null!=t&&""!==t&&o.push(t)}),o=[...new Set(o.flat())]):o=r(i),o||(o=""),o},getAdditionalColumnDefinition:function(t){var n=this,i=this.getMappingOfAdditionalColumns()[t];if(i){var a={text:i.text,dataIndex:i.dataIndex,maxWidth:i.maxWidth,minWidth:i.minWidth,width:i.width,icon:i.icon,sortableFlag:!1,groupableFlag:!1,description:n.i18nManager.replace(n.i18nManager.get("warning.column.limitation"),{columnName:i.text}),allowUnsafeHTMLContent:i.allowUnsafeHTMLContent};return i.getContentCallback?i.getContentCallback(a):-1!==["Effectivity","ProjectedEvolutionEffectivity","ConfigurationRevision","ConfigurationContext"].indexOf(i.dataIndex)||-1!==["VariantEffectivity","CurrentEvolutionEffectivity","EvolutionEffectivity"].indexOf(i.dataIndex)&&(g.core.sessionManager.shouldShowFinalItems()||g.core.sessionManager.shouldShowFlatView()||!g.core.settingManager.isConfigAuthorized())?e.extend(a,{getCellValue:function(e){if(s.isNodeFromModel(e&&e.nodeModel)){if(!e.nodeModel.isEngineeringItem()||e.nodeModel.isGroupingNode)return"";var t=e.nodeModel.options.grid[i.dataIndex];return!t||e.nodeModel.isAttributePending(i.dataIndex)?t="reference"===e.nodeModel.getViewType()?"":n.i18nManager.get("loading"):"function"==typeof t.trim&&0===t.trim().length&&(t=""),t}},getCellValueForExport:function(e){return n.getCellValuesForExport(e)}}):e.extend(a,{typeRepresentation:"url",hyperlinkTarget:"_self",getCellValue:function(e){if(!s.isNodeFromModel(e&&e.nodeModel))return{};if(!e.nodeModel.isEngineeringItem()||e.nodeModel.isGroupingNode)return{label:"",url:"#UNEXISTANT_ID"};var t=e.nodeModel.options.grid[i.dataIndex];if(i.dataIndex==o.CONST_SPEC_RELATION_COLUMN_DATAINDEX){var r="";return t>0&&(r={iconName:"doc-log wux-ui-3ds",fontIconFamily:1}),{icon:r,label:a="",url:"#UNEXISTANT_ID"}}if(t=t?t.replace("\n",""):t,"Alternate"==i.dataIndex){r="";var a="";return"Yes"==t?r="fonticon fonticon-exchange alternateColumn":""!=t&&e.nodeModel.isAttributePending(i.dataIndex)&&(a=""),{icon:r,label:a,url:"#UNEXISTANT_ID"}}return-1!==["CoreMaterial","CoveringMaterial","CoveringMaterialInstance","MadeFrom","ProductConfiguration",o.CONST_DEFORMABLE,o.RAW_MATERIAL_QUANTITY].indexOf(i.dataIndex)?(!t||e.nodeModel.isAttributePending(i.dataIndex)?t=n.i18nManager.get("loading"):"function"==typeof t.trim&&0===t.trim().length&&(t=i.dataIndex===o.CONST_DEFORMABLE||i.dataIndex===o.RAW_MATERIAL_QUANTITY||"ProductConfiguration"===i.dataIndex?"":n.i18nManager.get("None")),{label:t,dataIndex:i.dataIndex,url:"#UNEXISTANT_ID"}):(!t||e.nodeModel.isAttributePending(i.dataIndex)?t="reference"===e.nodeModel.getViewType()?"":n.i18nManager.get("loading"):0===t.trim().length&&(t=n.i18nManager.get("None")),{label:t,url:"#UNEXISTANT_ID"})},getCellValueForCopy:function(e){return e.cellModel.label},getCellValueForExport:function(e){return n.getAdditionalColumnDefinitionForExport(e,i.dataIndex)}})}r.warningNotif({title:`The column '${n.i18nManager.get(t)}' is not supported`,subtitle:"Please uncheck it from Attributes Management"})},getAdditionalColumnDefinitionInReferenceView:function(t){var n=this,i=this.getMappingOfAdditionalColumns()[t];if(i){var a={text:i.text,dataIndex:i.dataIndex,maxWidth:i.maxWidth,minWidth:i.minWidth,width:i.width,icon:i.icon,sortableFlag:!1,groupableFlag:!1,description:n.i18nManager.replace(n.i18nManager.get("warning.column.limitation"),{columnName:i.text}),allowUnsafeHTMLContent:i.allowUnsafeHTMLContent};return i.getContentCallback?i.getContentCallback(a):-1!==["Effectivity","ProjectedEvolutionEffectivity","ProductConfiguration","EvolutionEffectivity","ConfigurationContext"].indexOf(i.dataIndex)||-1!==["VariantEffectivity"].indexOf(i.dataIndex)&&!g.core.settingManager.isConfigAuthorized()||-1!==["VariantEffectivity","CurrentEvolutionEffectivity","EvolutionEffectivity"].indexOf(i.dataIndex)&&(g.core.sessionManager.shouldShowFinalItems()||g.core.sessionManager.shouldShowQuantityView()||g.core.sessionManager.shouldShowFlatView())?e.extend(a,{getCellValue:function(e){if(!s.isNodeFromModel(e&&e.nodeModel))return;if(!e.nodeModel.isEngineeringItem()||e.nodeModel.isGroupingNode)return"";const r=new Set;if(Array.isArray(e.nodeModel.getUsages())&&e.nodeModel.getUsages().length>=1){e.nodeModel.getUsages().forEach(function(e){e.options.grid[t]&&""!==e.options.grid[t].trim()&&r.add(e.options.grid[t])});var o=[...r]}return!o||e.nodeModel.isAttributePending(i.dataIndex,o)?o=n.i18nManager.get("loading"):0!==o.length||"ProductConfiguration"!=i.dataIndex&&"ConfigurationContext"!=i.dataIndex?Array.isArray(o)&&0===o.length&&(o=n.i18nManager.get("None")):o="",o},getCellValueForExport:function(e){return n.getCellValuesForExport(e)}}):e.extend(a,{typeRepresentation:"url",hyperlinkTarget:"_self",getCellValue:function(e){if(!s.isNodeFromModel(e&&e.nodeModel))return{};if(!e.nodeModel.isEngineeringItem()||e.nodeModel.isGroupingNode)return{label:"",url:"#UNEXISTANT_ID"};const r=new Set;if(Array.isArray(e.nodeModel.getUsages())&&e.nodeModel.getUsages().length>=1){i.dataIndex==o.CONST_DEFORMABLE?"#loading#"==e.nodeModel.options.grid[t]?r.add(e.nodeModel.getUsages().map(e=>e.getAttributeValue(i.dataIndex))):r.add(e.nodeModel.options.grid[t]):e.nodeModel.getUsages().forEach(function(e){t==o.CONST_SPEC_RELATION_COLUMN_DATAINDEX?e.options.grid[t]&&r.add(e.options.grid[t]):e.options.grid[t]&&""!==e.options.grid[t].trim()&&r.add(e.options.grid[t])});var a=[...r]}if(i.dataIndex==o.CONST_SPEC_RELATION_COLUMN_DATAINDEX){var l="";return a>0&&(l={iconName:"doc-log wux-ui-3ds",fontIconFamily:1}),{icon:l,label:c="",url:"#UNEXISTANT_ID"}}if("Alternate"==i.dataIndex){l="";var c="";return"Yes"==a?l="fonticon fonticon-exchange alternateColumn":""!=a&&e.nodeModel.isAttributePending(i.dataIndex)&&(c=""),{icon:l,label:c,url:"#UNEXISTANT_ID"}}return-1!==["CoreMaterial","CoveringMaterial","MadeFrom",o.CONST_DEFORMABLE].indexOf(i.dataIndex)?(!a||e.nodeModel.isAttributePending(i.dataIndex)?a=e.nodeModel.getUsages&&e.nodeModel.getUsages()&&Array.isArray(e.nodeModel.getUsages())&&e.nodeModel.getUsages()[0]&&e.nodeModel.getUsages()&&e.nodeModel.getUsages()[0].isAttributePending&&!e.nodeModel.getUsages()[0].isAttributePending(i.dataIndex)?Array.from(new Set(e.nodeModel.getUsages().map(function(e){if(!e.isAttributePending())return e.getAttributeValue(i.dataIndex)}))):n.i18nManager.get("loading"):Array.isArray(a)&&0===a.length&&(a=i.dataIndex===o.CONST_DEFORMABLE?"":n.i18nManager.get("None")),{label:a,dataIndex:i.dataIndex,url:"#UNEXISTANT_ID"}):(!a||e.nodeModel.isAttributePending(i.dataIndex,a)?a=n.i18nManager.get("loading"):Array.isArray(a)&&0===a.length&&(a=n.i18nManager.get("None")),{label:a,url:"#UNEXISTANT_ID"})},getCellValueForCopy:function(e){return e.cellModel.label},getCellValueForExport:function(e){return n.getAdditionalColumnDefinitionForExport(e,i.dataIndex)}})}r.warningNotif({title:`The column '${n.i18nManager.get(t)}' is not supported`,subtitle:"Please uncheck it from Attributes Management"})},isEditPredicateCommandActivated:()=>"true"!==sessionStorage.getItem("useOldSetCellValue"),getEditSessionPredicatesCmdInstance(){return this.editSessionPredicatesCmd||(this.editSessionPredicatesCmd=new d(g.core)),this.editSessionPredicatesCmd},releaseEditSessionPredicatesCmdInstance(){this.editSessionPredicatesCmd&&delete this.editSessionPredicatesCmd},editPredicatesCmdEndCB(e){e&&e.success&&this._refreshInstanceSplit(e.success,void 0,"copyPaste"),this.releaseEditSessionPredicatesCmdInstance()},_setCellVaValueNew(e,t,n){const{nodeModel:i}=e;let r=g.core.dicoService.getAttributeDefinition(i.getGlobalType(),t);r||(r=this.getColumnMetas(t));const o=this.getEditSessionPredicatesCmdInstance(),{contextManager:a}=g.core;o.addObjectPredicateToEdit({newValue:n,nodeToEdit:i,attributeToEdit:r}),a.getActiveEngItem()&&a.getActiveEngItem().getContentModels()&&a.getActiveEngItem().getContentModels().isInTransaction()?s.runBulkMode("updateAttributes",o.begin.bind(o),this.editPredicatesCmdEndCB.bind(this)):o.begin().then(this.editPredicatesCmdEndCB.bind(this))},_setCellValue:function(e,t,n){if(this.isEditPredicateCommandActivated())return this._setCellVaValueNew(e,t,n);let i=e.nodeModel,r=g.core.dicoService.getAttributeDefinition(i.getGlobalType(),t);if(r||(r=this.getColumnMetas(t)),void 0!==(r={...r}).dbName){if(g.core.dicoService.isAPredicate(r.dbName)&&(r.dbName=g.core.dicoService.getAttributeNameFromPredicate(e.nodeModel.getType(),r.dbName),Array.isArray(r.dbName)))return Promise.reject("multi selectable attribute");r.path=r.dbName}let a=i.getID();if(t.endsWith(o.APPEND_INSTANCE_COLUMN_KEYWORD)&&(a=i.getRelationID(),r.ds6wFrom="rel",r.dbName&&!r.dbName.includes(".")&&(r.path="PLMInstance."+r.dbName)),i.isDocument())"tree"===t?r.path=o.TITLE_PATH_OF_DOCUMENT:"ds6w:description"===t&&(r.path=o.DESCRIPTION_PATH_OF_DOCUMENT);else switch(t){case"tree":r.path=o.TITLE_PATH_OF_REFERENCE;break;case"ds6w:label-Instance":r.path=o.INSTANCE_PATH;break;case"ds6w:description":r.path=o.DESCRIPTION_PATH_OF_REFERENCE;break;case"ds6w:description-Instance":r.path=o.DESCRIPTION_PATH_OF_INSTANCE}const{dataService:l,contextManager:c}=g.core;c.getActiveEngItem()&&c.getActiveEngItem().getContentModels()&&c.getActiveEngItem().getContentModels().isInTransaction()?s.runBulkMode("updateAttributes",l.updateAttributes.bind(l),e=>{e&&e.success&&this._refreshInstanceSplit(e.success,void 0,"copyPaste")}).add({physicalid:a,attribute:r,value:n,node:i}):l.updateAttribute(a,r,n).then(e=>{null!=e&&(Object.keys(e).length&&e.results&&this._refreshInstanceSplit(e.results,i,"update"),this.publishNodesToRefresh([a]))}).catch(()=>{i.setRealAttributesConvertState(!1),i.setAttributeConvertionStarted(!1),this.publishNodesToRefresh([a])})},_getColumnsProvidersDefinitions:function(){return g.core.settingManager.getSetting("columnsProviders")},_providerValidateAndRegister:function(e,t,n){var i=this;return l.wrappedWithPromise(function(r,o){e.isAdditionalColumnsAvailable(function(o){!0===o&&(n[t||e.getName()]=e,"RelationsColumns"===e.getName()&&i.setAndDefineRelationMethods(e)),r()})})},setAndDefineRelationMethods:function(e){var t=[o.CONST_SPEC_RELATION_COLUMN_DATAINDEX];e.setPreferenceProxy({setPreference:function(e){self.widget.setValue("enx-relation-pref",e)},getPreference:function(){var e=self.widget.getValue("enx-relation-pref");return"null"===e&&(e=null),e},relationsColumnsList:t}),e.getAdditionalColumnsUX=function(n){t.forEach(function(t){var i=n.findIndex(function(e){return e.dataIndex===t});i>=0?e.getAdditionalColumnsUXDGV(Array(n[i])):n.splice(i,0,{text:g.core.i18nManager.get(t),dataIndex:t,maxWidth:800,minWidth:20,width:200})})}},getColumnsProviderWithMetas:function(e){var t=this._getColumnsProvidersDefinitions().find(function(t){return t.ID===e});if(t&&Array.isArray(this.loadedProviders)){const n=this.loadedProviders.find(t=>t.ID===e);return t.instance=n?n.instance:null,t}return null},_isVisibleAndProvidedColumn:function(e){},_shouldLoadColumnProvider:function(e){return"whole"===e.loadingPolicy||this.getVisibleAdditionalColumns().some(function(t){return t.provider===e.ID})},getAllProvidedColumns:function(){return this._retrieveProvidedColumns().map(function(e){return{dataIndex:e.dataIndex,kind:"string",provider:e.provider,visibleFlag:!1,isAdditionalColumn:!0,customisation:{layout:{removableFromView:!0,groupingLocked:!0,removable:!1}}}})},getMappingOfAdditionalColumns:function(e){if(!e&&this._cachedAdditionalColumnsMapping)return this._cachedAdditionalColumnsMapping;var t={};return this._retrieveProvidedColumns().forEach(function(e){t[e.dataIndex]=e}),this._cachedAdditionalColumnsMapping=t},_retrieveProvidedColumns:function(){if(Array.isArray(this._cachedAdditionalCols)&&this._cachedAdditionalCols.length>0)return this._cachedAdditionalCols;var e=[];return this.getLoadedColumnProvidersAsArray().forEach(function(t){if(t&&t.instance&&"function"==typeof t.instance.getAdditionalColumnsUX){var n=[];t.instance.getAdditionalColumnsUX(n),e=e.concat(n.map(function(e){return e.provider=t.ID,e}))}}),this._cachedAdditionalCols=e,e},getLoadedColumnProvidersAsArray:function(){var e=this;return this.getLoadedColumnProvidersIDAsArray().map(function(t){return e.getColumnsProviderWithMetas(t)})},getLoadedColumnProvidersIDAsArray:function(){return Array.isArray(this.loadedProviders)?this.loadedProviders.map(e=>e.ID):[]},retrieveAvailableColumnProviders:function(){var e=this;return l.wrappedWithPromise(function(t,n){e._loadColumnsProviders().finally(function(){try{var i=e.getLoadedColumnProvidersAsArray().filter(e._shouldLoadColumnProvider.bind(e));t(i)}catch(e){n(e)}})})},_loadColumnsProviders:function(){var e=this;return e._cachedColProvPromise?e._cachedColProvPromise:l.wrappedWithPromise(function(t,n){if(e.loadedProviders)return t();e._cachedColProvPromise=s.loadFiles(e._getColumnsProvidersDefinitions().map(function(e){return e.loader})).then(function(){for(var n=arguments[0],i=[],r={},s=0;s<n.length;s++){var a=e._getColumnsProvidersDefinitions()[s],c=n[s];a&&c&&(i.push(e._providerValidateAndRegister(c,a.ID,r)),a.isInternal&&"function"==typeof c.bindApp&&c.bindApp(g.core))}l.allSettled(i).then(function(){e.loadedProviders=[],e._getColumnsProvidersDefinitions().map(e=>e.ID).forEach(t=>{r[t]&&e.loadedProviders.push({ID:t,instance:r[t]})}),g.core.mediator.publish(o.EVENT_COLUMN_PROVIDERS_LOADED,e.loadedProviders),t(!0)})}).catch(function(e){n(e)})})},isAnEditablePredicate:function(e){if(!(g&&g.core&&g.core.dicoService&&e))return!1;const t=g.core.dicoService.getAttributeMetas(e),{nature:n,userAccess:i,dbName:r}=t||{},o=g.core.dicoService.getControlledAppPredicates();return c.isPredicateControlledByApplication(e,o)?c.isAnEditablePredicateControlledByApplication(e,o):!g.core.dicoService.isMultiValuedAttribute(e)},_refreshInstanceSplit:function(e,t,n){let i=[],s=[];e.forEach(function(e){(e.oldInstancePhysicalid||e.body&&e.body.oldInstancePhysicalid)&&(i.push({child:"update"===n?t.getID():e.node.getID(),instance:"update"===n?e.body.physicalid:e.physicalid,parent:"update"===n?t.getParentIdFromOccrencePath():e.node.getParentIdFromOccrencePath()}),s.push("update"===n?e.body.oldInstancePhysicalid:e.oldInstancePhysicalid))}),i.length&&(g.core.mediator.publish(o.EVENT_INSTANCES_CREATED,i),r.notifyAlert(g.core.i18nManager.get("notify.instanceEvolved")),this.publishNodesToRefresh(s))},getCellValuesForExport:function(e,t){if(!e||null==e.cellModel)return"";const n=e=>null==e?"":"object"==typeof e&&e.hasOwnProperty("label")?e.label.toString():e instanceof Date?e.toLocaleString():e.toString();return Array.isArray(e.cellModel)?e.cellModel.map(n).join(","):n(e.cellModel)},getAdditionalColumnDefinitionForExport:function(e,t){return e.rowID<0?e.cellModel:e.nodeModel.isGroupingNode||"Alternate"!=t&&t!=o.CONST_SPEC_RELATION_COLUMN_DATAINDEX||!e.nodeModel.options.padgrid||"ds6w:Part"!==e.nodeModel.options.padgrid["ds6w:globalType"]?e.cellModel.label instanceof Array?g.core.exportService.normalizeStringInNFKDFormat(e.cellModel.label[0]):g.core.exportService.normalizeStringInNFKDFormat(e.cellModel.label):e.cellModel.icon?this.i18nManager.get("eng.export.true"):this.i18nManager.get("eng.export.false")},isColumnWithRangeValue:function(e){let t=g.core.dicoService.getRangeValueAttribute(e);return!!t&&(!t.type||"boolean"!==t.type)},getRangeCellSemantics:function(e){return{possibleValues:()=>this.getPossibleValues(e)}},getPossibleValues:function(e){const t=g.core.dicoService.getRangeValueAttribute(e.ds6w).AuthorizedValues,r=new n({}),o=t.sort().map(t=>new i({label:this.i18nManager.get(`${e.ds6w}/${t}`),value:t}));return r.addRoot(o),r},_getReservedInstanceNodeValue:function(e,t){const n=g.core.settingManager.getUserName();let i=e.options.grid[t],r=e.options.grid["ds6w:reservedBy-Instance"];return i&&"FALSE"!==i?r==n?"locked":"lockedByOther":"notLocked"}})}),define("DS/ENOXEngineer/componentsHelpers/ENOXFindCommand/js/FindCommandView",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/componentsHelpers/ENOXFindCommand/js/XENPanel","DS/Utilities/Utils","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/WUXAutoComplete/AutoComplete","DS/Controls/Button","DS/Controls/ButtonGroup","DS/Controls/Toggle","DS/Controls/ComboBox","DS/Controls/Expander","DS/Core/PointerEvents","DS/Utilities/TouchUtils","DS/UIKIT/Spinner","DS/UIKIT/Tooltip","DS/Utilities/Dom","DS/ENOXEngineer/utils/XEngineerConstants","css!DS/ENOXEngineer/componentsHelpers/ENOXFindCommand/css/XENFindView.css"],function(e,t,n,i,r,o,s,a,l,c,d,u,p,g,h,m,f){"use strict";function E(e){return this.appCore=e.appCore,this.elements={},this.options=e||{},this.options=Object.assign({},this.options),this.options.strString="",this.currentValue=0,this.options.matchingStringCount=0,this.buildFindPanel(),this}return E.prototype.buildFindPanel=function(){let e=this.getselectedProductLable();this.findContainer=this._buildContent(),this.elements.panelFind=new t({target:widget.body,closeButtonFlag:!0,title:this.appCore.i18nManager.get("find-cmd")+" - "+e,titleBarVisibleFlag:!0,width:"auto",height:"auto",content:this.findContainer,position:{my:"top right",at:"top right",offsetX:-50,offsetY:150},resizableFlag:!0,closeCB:this.close.bind(this)}),this.elements.panelFind.getContent().addClassName("eno-xen-find-panel")},E.prototype._buildContent=function(){return this.elements.content=m.createElement("div",{class:"eno-xen-find-panel-content"}),this.elements.actions=m.createElement("div",{class:"eno-xen-find-panel-actions"}),!0===p.getTouchMode()&&this.elements.content.setAttributeNode(document.createAttribute("touch-mode")),this.elements.wuxautocomplete=this._buildAutoCompleteModel().inject(this.elements.content),this.__integrateFindResults(),this.elements.findBtn=this._buildWUXButton("eno-xen-controls-find-btn eno-xen-controls-button",this.appCore.i18nManager.get("eng.findCmd.searchButton.tooltip"),"check",!0).inject(this.elements.actions),this.elements.findBtn.getContent().addEventListener("buttonclick",this._launchSearch.bind(this)),this.elements.previousBtn=this._buildWUXButton("eno-xen-controls-arrow-up-btn eno-xen-controls-button",this.appCore.i18nManager.get("eng.findCmd.previousButton.tooltip"),"chevron-up",!0),this.elements.previousBtn.getContent().addEventListener("buttonclick",this._goToPreviousFindResult.bind(this)),this.elements.nextBtn=this._buildWUXButton("eno-xen-controls-arrow-down-btn eno-xen-controls-button",this.appCore.i18nManager.get("eng.findCmd.nextButton.tooltip"),"chevron-down",!0),this.elements.nextBtn.getContent().addEventListener("buttonclick",this._goToNextFindResult.bind(this)),this.elements.navGrp=new a({}).inject(this.elements.actions),this.elements.navGrp.addChild(this.elements.previousBtn),this.elements.navGrp.addChild(this.elements.nextBtn),this.elements.selectBtn=this._buildWUXButton("eno-xen-controls-select-btn eno-xen-controls-button",this.appCore.i18nManager.get("eng.findCmd.selectButton.tooltip"),"select-on",!0).inject(this.elements.actions),this.elements.selectBtn.getContent().addEventListener("buttonclick",this._launchSelect.bind(this)),this.elements.content.appendChild(this.elements.actions),this.elements.content.classList.add("eno-xen-find-with-cols-chooser"),this.buildOptionsDiv(this.elements.content),this.elements.content},E.prototype.buildOptionsDiv=function(e){var t=this;this.options.selectPredicates=[],e.classList.add("eno-xen-find-with-cols-chooser");let n=m.createElement("div",{class:"eno-xen-find-options"});this.elements.selectMatch=new l({type:"checkbox",label:this.appCore.i18nManager.get("eng.findCmd.options"),checkFlag:"boolean"==typeof this.options.availableCols.selectedMatch&&this.options.availableCols.selectedMatch}),this.elements.selectMatch.getContent().addClassName("eno-xen-find-options-select"),n.appendChild(this.elements.selectMatch.getContent());let o=m.createElement("span",{class:"eno-xen-find-options-findIn"});o.innerText=this.appCore.i18nManager.get("eng.findCmd.findIn"),n.appendChild(o);let s=this.colModel=new i({}),a=this.options.availableCols.allCols,u=["ds6wg:DELFmiContQuantity_Mass.V_ContQuantity","ds6wg:DELFmiContQuantity_Volume.V_ContQuantity","ds6w:reserved"];for(let e=0;e<a.length;e++){let t=a[e];if(!u.includes(t.ds6w)&&("string"===t.kind||"tag"===t.kind||"url"===t.kind)){let e=new r({label:t.text,grid:{ds6w:t.ds6w},value:t.ds6w});this.options.selectPredicates.push(t.ds6w),s.addRoot(e)}}this.elements.selectedColList=new c({elementsTree:s,placeholder:this.appCore.i18nManager.get("eng.findCmd.find.none"),enableSearchFlag:!1,autocompleteFlag:!1,multiSelFlag:!0}),this.elements.selectedColList.getContent().addClassName("eno-xen-controls-autocomplete-colList");let p=s.getRoots();for(let e=0;e<p.length;e++)-1!==this.options.availableCols.selectedCols.indexOf(p[e].getReferenceValue("ds6w"))&&p[e].select();n.appendChild(this.elements.selectedColList.getContent());let g=new d({header:this.appCore.i18nManager.get("eng.findCmd.header.options"),body:n,style:"simple"});g.getContent().addClassName("eno-xen-controls-colList-expander"),t.elements.selectedColList.addEventListener("click",function(){t.__checkLaunchBtn()}),e.appendChild(g.getContent())},E.prototype._buildAutoCompleteModel=function(){let e=this;this.options.autocompleteModel=new i;let t=e.appCore.localStorage.getItem("eno-xen-find-panel");if(t){let n=JSON.parse(t);Array.isArray(n)&&n.forEach(function(t){e.options.autocompleteModel.addRoot(t)})}let n=new o({elementsTree:this.options.autocompleteModel,multiSearchMode:!1,placeholder:""});return n.getContent().addClassName("eno-xen-controls-autocomplete"),n.addEventListener("change",function(){if(e.count=0,e.currentValue=0,n.selectedItems){let t=n.selectedItems.getLabel();e.options.strString=t,e._addAutocompleteModelNode(t)}else e.options.strString="";e.__checkLaunchBtn(),e._displayCurrentValue(),!1===e.elements.findBtn.disabled&&e.elements.findBtn.getContent().click()}),n},E.prototype._buildWUXButton=function(e,t,n,i){let r=new s({icon:{iconName:n,fontIconFamily:1},disabled:i});if(r.getContent().addClassName(e),t){new h({target:r.elements.button}).setBody(t)}return r},E.prototype.getselectedProductLable=function(){let e="";if(this.appCore&&this.appCore.contextManager&&this.appCore.contextManager.getXENTreeDocument&&this.appCore.contextManager.getXENTreeDocument().getSelectedNodes&&this.appCore.contextManager.getXENTreeDocument().getSelectedNodes()){let t=this.options.selectedNodes=this.appCore.contextManager.getXENTreeDocument().getSelectedNodes();e=t.length>1?t.length+" "+this.appCore.i18nManager.get("eng.findCmd.multiple.title"):this.appCore.contextManager.getXENTreeDocument().getSelectedNodes()[0].getLabel()}return e},E.prototype._addAutocompleteModelNode=function(e){if(0===this.options.autocompleteModel.search({match:function(t){return t.nodeModel.getLabel()===e}}).length){let t=this.options.autocompleteModel.getRoots();5===t.length&&(this.options.autocompleteModel.removeRoot(t[4]),t=this.options.autocompleteModel.getRoots());let n=new r({label:e,icons:[{iconName:"clock",fontIconFamily:1}]});0===t.length?this.options.autocompleteModel.addRoot(n):this.options.autocompleteModel.insertBefore(n,t[0]),this._storeAutocompleteModel()}},E.prototype._storeAutocompleteModel=function(){let e=[],t=this.options.autocompleteModel.getRoots();Array.isArray(t)&&t.forEach(function(t){e.push(t.dump())}),this.appCore.localStorage.setItem("eno-xen-find-panel",JSON.stringify(e))},E.prototype.getsetlectedPredicates=function(){let e=this,t=(e.options.selectPredicates,[]);if(e.elements.selectedColList){let n=e.colModel.getSelectedNodes();Array.isArray(n)&&(t.push("physicalid"),n.forEach(function(e){let n=e.getReferenceValue("ds6w");t.push(n)}))}return t},E.prototype._launchSearch=function(e){let t=this,i=function(){if(t.options.events&&t.options.events.onSearch){t.options.autocompleteModel.getSelectedNodes();let e=t.getsetlectedPredicates(),n={searchFts:""===t.options.strString?t.elements.wuxautocomplete._editor.value:t.options.strString,selectMatch:!!t.elements.selectMatch&&t.elements.selectMatch.checkFlag,selectedNodes:t.options.selectedNodes,selectedPredicates:e};t.options.events.onSearch(n)}},r=n.debounce(i,500);e?r():i()},E.prototype.close=function(){this.options.events.onClose&&this.options.events.onClose(),this.elements.panelFind&&this.elements.panelFind.closePanel();let e=Object.keys(this.elements);for(let t=0;t<e.length;t++)this.elements[e[t]]&&(this.elements[e[t]].destroy?this.elements[e[t]].destroy():delete this.elements[e[t]],this.elements[e[t]]=void 0)},E.prototype._goToPreviousFindResult=function(){let e=this,t=e.currentValue;e.count&&0!==e.count&&(e.currentValue>1?e.currentValue--:e.currentValue=e.count,e._displayCurrentValue()),e.currentValue&&t!==e.currentValue&&e.options.events&&e.options.events.onFindPreviousResult&&e.options.events.onFindPreviousResult()},E.prototype._goToNextFindResult=function(){let e=this,t=e.currentValue;e.count&&0!==e.count&&(e.currentValue<e.count?e.currentValue++:e.currentValue=1,e._displayCurrentValue()),e.currentValue&&t!==e.currentValue&&e.options.events&&e.options.events.onFindNextResult&&e.options.events.onFindNextResult()},E.prototype._launchSelect=function(){this.options.events&&this.options.events.onSelect&&this.options.events.onSelect({})},E.prototype.__checkLaunchBtn=function(){let e=this.colModel.getSelectedNodes();this.options.strString&&this.options.strString.length>0&&Array.isArray(e)&&e.length>0?this.elements.findBtn.disabled=!1:this.elements.findBtn.disabled=!0},E.prototype._displayCurrentValue=function(){if(this.elements.findCounter&&(this.elements.findCounter.innerText=!1===this.elements.findBtn.disabled&&this.options.strString&&""!==this.options.strString&&void 0!==this.currentValue&&void 0!==this.count?this.currentValue+"/"+this.count:""),void 0===this.count)this.elements.selectBtn.disabled=!0,this.elements.previousBtn.disabled=!0,this.elements.nextBtn.disabled=!0;else{let e=!(this.count>1);this.elements.previousBtn&&this.elements.nextBtn&&this.elements.selectBtn&&(this.elements.previousBtn.disabled=e,this.elements.nextBtn.disabled=e),0===this.count?this.elements.selectBtn.disabled=!0:this.elements.selectBtn.disabled=!1}},E.prototype.__integrateFindResults=function(){let e=this.elements.wuxautocomplete.getContent().querySelector(".wux-controls-autoComplete-editor");e.classList.add("eno-xen-autoComplete-editor-with-counter"),e.firstChild.classList.add("eno-xen-autoComplete-input"),this.elements.results=m.createElement("div",{class:"eno-xen-controls-find-results"}),this.elements.findCounter=m.createElement("span",{class:"eno-xen-controls-find-counter"}),this.elements.results.appendChild(this.elements.findCounter),this.elements.loader=new g({visible:!1,animate:!0,spin:!0}),this.elements.results.appendChild(this.elements.loader.getContent()),this.elements.loader.getContent().addClassName("eno-xen-controls-find-loader"),e.insertBefore(this.elements.results,e.childNodes[1])},E.prototype.setMatchingStringCount=function(e){this.count=e,this.currentValue=0,this.count>0&&(this.currentValue=1),this._displayCurrentValue()},E}),define("DS/ENOXEngineer/componentsHelpers/ENOXFindCommand/js/FindCommand",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/componentsHelpers/ENOXFindCommand/js/FindCommandView","DS/ENOXEngineer/utils/XEngineerConstants","DS/UIKIT/SuperModal"],function(e,t,n,i){"use strict";return e.extend({init:function(e){this._parent(e),this.options=e},execute:function(e){var t=this;if(t.end(),t.appCore.sessionManager.isUsingIndex())this.buildFindCmd();else{var r=t.appCore.i18nManager.get("find-cmd"),o=t.appCore.i18nManager.replace(t.appCore.i18nManager.get("index_Flattened_Advanced"),{view:r}),s=t.appCore.i18nManager.get("eng.ui.button.ok"),a=new i({className:"alternateDlgConfirm",closable:!0,okButtonText:s,animate:!0,renderTo:widget.body}),l=new UWA.Element("div",{html:o});a.dialog({body:l,title:r,buttons:[{className:"primary",value:s,action:function(e){t.appCore.sessionManager.setAuthoringMode("index"),e.hide(),t.buildFindCmd()}},{value:t.appCore.i18nManager.get("eng.ui.button.cancel"),action:function(e){e.hide()}}]})}this.appCore.mediator.subscribe(n.EVENT_FIND_IN_CONTEXT_CLOSE_DIALOG,function(){t.findCmdView.close()})},buildFindCmd:function(){var e=this;this.findCmdView=new t({availableCols:{selectedCols:e._getSelectedColumnsForFind(),allCols:e.appCore.dicoService.getVisibleAttrForBO(),selectedMatch:e._isAutoSelectOptionSelected()},events:{onSearch:function(t){e.appCore.mediator.subscribe(n.EVENT_FIND_IN_CONTEXT_VIEW_BUILT,function(t){e.getGridView()&&e.getGridView().setFindStr&&(e.getGridView().getNodeModelToProcessForFind=function(n,i){let r=[],o=1==e._selectNodes.length&&e.appCore.contextManager&&e.appCore.contextManager.getActiveEngItem&&e.appCore.contextManager.getActiveEngItem()&&e.appCore.contextManager.getActiveEngItem().getID()===e._selectNodes[0].getID()?e.appCore.contextManager.getActiveEngItem().getChildren():e._selectNodes;return t&&Array.isArray(o)&&o.forEach(function(e){Array.isArray(e.getAllDescendants())&&e.getAllDescendants().length>0&&e.getAllDescendants().forEach(function(e){r.push(e)}),r.push(e)}),r},e.getGridView().setFindStr(e._selectMatchStr,void 0,void 0,void 0,!0),e._selectFirstMatchingCellAndNode())}),e.appCore.mediator.publish(n.EVENT_FIND_IN_CONTEXT_LAUNCH,t),e._selectMatch=t.selectMatch,e._selectMatchStr=t.searchFts,e._selectNodes=t.selectedNodes,e.appCore.localStorage.setItem(n.CONST_FIND_IN_CONTEST_AUTOSELECT_OPTION,e._selectMatch),e.appCore.localStorage.setItem(n.CONST_FIND_IN_CONTEST_SELECTED_COLUMNS,JSON.stringify(t.selectedPredicates))},onFindPreviousResult:e._goToPreviousMatchingCell.bind(e),onFindNextResult:e._goToNextMatchingCell.bind(e),onSelect:e._selectAllNodesWithMatchCell.bind(e),onClose:e._onClose.bind(e)},appCore:e.appCore})},_isAutoSelectOptionSelected:function(){return this.appCore.localStorage.getItem(n.CONST_FIND_IN_CONTEST_AUTOSELECT_OPTION)},_getSelectedColumnsForFind:function(){let e=this.appCore.localStorage.getItem(n.CONST_FIND_IN_CONTEST_SELECTED_COLUMNS);if(e)return JSON.parse(e);{e=[];let t=this.appCore.dicoService.getVisibleAttrForBO();return Array.isArray(t)&&t.forEach(function(t){"string"!==t.kind&&"tag"!==t.kind&&"url"!==t.kind||e.push(t.ds6w)}),e}},_selectFirstMatchingCellAndNode:function(){this._selectNodeFromMatchCell(),this.findCmdView.setMatchingStringCount(this.getGridView().matchingStringCount)},getGridView:function(){return!!(this.appCore&&this.appCore.contextManager&&this.appCore.contextManager._activeGridView)&&this.appCore.contextManager._activeGridView},_goToPreviousMatchingCell:function(){let e=this;e.getGridView()&&e.getGridView().goToPreviousMatchingCell&&(e.getGridView().goToPreviousMatchingCell(),e._selectNodeFromMatchCell())},_goToNextMatchingCell:function(){let e=this;e.getGridView()&&e.getGridView().goToNextMatchingCell&&(e.getGridView().goToNextMatchingCell(),e._selectNodeFromMatchCell())},_selectNodeFromMatchCell:function(){if(this._selectMatch){this.getGridView().unselectAll();let e=this.appCore.contextManager._activeGridView.getNodeModelAt(this.appCore.contextManager._activeGridView._getMatchingCellID(this.appCore.contextManager._activeGridView._currentMatchingCellIDIndex));e&&!0!==e.isSelected()&&e.select()}},_selectAllNodesWithMatchCell:function(){this.getGridView().unselectAll();let e=this.getGridView().getMatchingFindNodeModelArray();Array.isArray(e)&&e.forEach(function(e){e.select()})},_onClose:function(){this.getGridView().onFindClose()},endExecute(){this.findCmdView&&this.findCmdView.close()}})}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityView",["UWA/Core","DS/Handlebars/Handlebars4","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/Tweakers/GeneratedToolbar","DS/Tweakers/TypeRepresentationFactory","DS/ENOXEngineer/services/ColumnsMgtService","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityEditComponent","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityModelEffectivityComponent","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityViewBuilderComponent","text!DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/html/ChangeQuantityView.html","css!DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/css/ChangeQuantityView.css"],(e,t,n,i,r,o,s,a,l,c,d,u,p)=>{return class{constructor(t){const{referenceNode:n,chgQtModel:r}=t||{};this.referenceNode=n||null,this.chgQtModel=r||null,this.treeModel=new i,this.viewToolbar=null,this.viewComponents=[u,c,d],this.container=e.createElement("div",{class:"xapp-change-quantity-tab-container"})}get content(){return this.container}get viewContext(){const e=this.chgQtModel,t=this.viewToolbar,n=this.dataGridView,i=this.treeModel;return{get model(){return e},get toolbar(){return t},get gridView(){return n},get gridModel(){return i}}}buildView(){this.buildUI(),this.buildToolbar(),this.viewComponents.forEach(e=>{e.init(this.viewContext),e.buildUIComponent(this.viewContext)}),u.activate()}buildUI(){var e=this;const n=t.compile(p);this.container.innerHTML=n();const i=this.chgQtModel.getColumns();this.editableColumns=i.filter(e=>Reflect.has(e,"editableFlag")&&e.editableFlag).map(e=>{const t={column:e,editableFlag:e.editableFlag};return Reflect.has(e,"getCellEditableState")&&(t.getCellEditableState=e.getCellEditableState),t});const r=s.getVisibleColumns().map(e=>{const t={...e};return"tree"===t.dataIndex&&"PLMEntity.V_Name"===t.dbName?t.dataIndex="ds6w:label":"Thumbnail"===t.dataIndex?t.typeRepresentation="image":"occurence"===t.dataIndex?t.getCellValue=function(e){if(e&&e.nodeModel)return e.nodeModel.options.grid.occurence}:["datetime","timestamp","dateTime"].includes(t.kind)?t.getCellValue=function(e){if(e&&e.nodeModel)return l.getDGVformatedDate(e.nodeModel.options.grid[t.dataIndex])}:"MEIColumn"===t.dataIndex&&(t.getCellValue=function(e){if(e&&e.nodeModel)return e.nodeModel.options.grid[t.dataIndex]?e.nodeModel.options.grid[t.dataIndex].tooltip:e.nodeModel.options.grid[t.dataIndex]}),t}).filter(t=>{const{dataIndex:n}=t;if("tree"===n||n===a.CONT_QUANTITY_MASS||n===a.CONT_QUANTITY_VOLUME||"rollup"===n||"MadeFrom"===n||n===a.RAW_MATERIAL_QUANTITY||"ds6w:label-Instance"===n||"quantity"===n)return!1;const r=e&&e.chgQtModel&&e.chgQtModel.appCore&&e.chgQtModel.appCore.i18nManager&&e.chgQtModel.appCore.i18nManager.get,o=r?e.chgQtModel.appCore.i18nManager.get("eng.export.instance.key"):" ";if(t.text=t.ds6wFrom&&"rel"===t.ds6wFrom?t.text+` (${o})`:t.text,t.description&&r){let i;if(t.ds6w){const n=e.chgQtModel.appCore.i18nManager.get(t.ds6w);i=n,t.ds6wFrom&&"rel"===t.ds6wFrom&&(i=e.chgQtModel.appCore.i18nManager.replace(e.chgQtModel.appCore.i18nManager.get("tooltip_Instance_Column"),{label:n}))}else i=r?e.chgQtModel.appCore.i18nManager.get(n):t.description;t.description=i}return-1===i.findIndex(e=>e.dataIndex===n)}).map(e=>({...e,visibleFlag:!0,editableFlag:!1}));this.dataGridView=this.instanciateDataGridView({treeDocument:this.treeModel,columns:[...i,...r],defaultColumnDef:{width:"auto",typeRepresentation:"string"},showNodeKPIColorFlag:!0});const o=this.container.getElement(".change-quantity-gridview");this.dataGridView.inject(o)}instanciateDataGridView(e){const t=new n(e);return t.onContextualEvent=(()=>[]),t}activateEditableColumns(){this.editableColumns.forEach(e=>{e.getCellEditableState&&(e.column.getCellEditableState=e.getCellEditableState.bind(e.column)),e.column.editableFlag=e.editableFlag})}deactivateEditableColumns(){this.editableColumns.forEach(e=>{Reflect.has(e.column,"getCellEditableState")&&(e.column.getCellEditableState=(()=>!1)),e.column.editableFlag=!1})}editModeEnable(){c.activate(this.viewContext),this.activateEditableColumns()}editModeDisable(){c.deactivate(this.viewContext),this.deactivateEditableColumns()}browseModelEffectivitiesEnable(){d.activate(this.viewContext)}browseModelEffectivitiesDisable(){d.deactivate(this.viewContext)}update(e){this.viewComponents.forEach(t=>{t.isActivated&&t.update(e)})}generateToolbarModels(e){if(!e)throw new Error("invalid json toolbar input");return r.prototype.createTreeDocument(e)}buildToolbar(){if(!this.dataGridView)return;const e={entries:[{id:"quantityChangeItem",readOnly:!0,dataElements:{value:"",typeRepresentation:"string",position:"far",category:0}}]},t=r.prototype.createTreeDocument(e);this.viewToolbar=new r({overflowManagement:"dropdown",direction:"horizontal",items:t,typeRepresentationFactory:new o}),this.container.getElement(".change-quantity-toolbar").appendChild(this.viewToolbar.getContent())}destroy(){this.viewComponents.forEach(e=>e.destroy()),this.referenceNode=null,this.chgQtModel=null,this.dataGridView=null,this.treeModel=null,this.viewToolbar=null}}}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/RawMaterialViewModel",["UWA/Core","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityNodeUtils","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityViewModel","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/services/I18nManager","DS/ENOXEngineer/columnsProviders/ContinuousInstQtyDataProvider","DS/ENOXEngineer/services/XEngineerItemsFactory","DS/ENOXEngineer/columnsFormatter/PreferredUnitColumnProvider","DS/ENOXEngineer/utils/Utils"],(e,t,n,i,r,o,s,a,l,c)=>{return class extends n{initViewOptions(e){e.addRemoveNodeAuthorized=!1}set nodes(e){super.nodes=e,this.referenceNode&&Reflect.has(this.referenceNode,"isInstance")?(this.rawMaterialRefNode=this.createRawMaterialReferenceNodeFromUsages(e),this.rawMaterialRefNode.setAttributeConvertionStarted(!1),this.rawMaterialRefNode.setRealAttributesConvertState(!1)):this.rawMaterialRefNode=this.referenceNode}createRawMaterialReferenceNodeFromUsages(e){const[t]=e,n=a.listNodeToEngItem(t);return n.addUsages(e),n}get nodes(){return super.nodes}updateMadeFromColumn(){const n=[],i=new Map;this.nodes.forEach(e=>{const t=e.getID();n.push(t),i.has(t)?i.set(t,[...i.get(t),e]):i.set(t,[e])});const r={relids:[],pids:n};"function"==typeof this.appCore.dataService.retrieveMadeFromInfos&&this.appCore.dataService.retrieveMadeFromInfos(r,n=>{const r=e.is(n,"string")?JSON.parse(n):n;Object.getOwnPropertyNames(r.pids).forEach(e=>{i.get(e).forEach(n=>{t.updateNodeOptions(n,{grid:r.pids[e]})})}),this.notifyUpdate({modify:this.nodes})})}updateRawMaterialFromColumn(){const e=[],n=new Map;this.nodes.forEach(t=>{const i=t.getRelationID();e.push(i),n.has(i)?n.set(i,[...n.get(i),t]):n.set(i,[t])});const i=new Promise((i,r)=>{s.fetchData(e).then(e=>{const{result:r}=e||{};return Array.isArray(r)&&r.length&&r.forEach(e=>{const{instanceId:i,quantity:r,quantityUOM:s,asRequired:a}=e;let l=r&&s&&s.nlsLabel?`${r}${s.nlsLabel}`:"";a&&(l=l.trim().length>0?`${o.get("makeFromAsRequired")}, ${l}`:`${o.get("makeFromAsRequired")}`),n.get(i).forEach(e=>{t.updateNodeOptions(e,{grid:{rawMaterialQuantity:l.length?l:o.get("None")}})})}),i()}).catch(r)}),r=this.computeRollup();Promise.allSettled([i,r]).finally(()=>{this.notifyUpdate({modify:this.nodes})})}async computeRollup(){if(!this.rawMaterialRefNode)return;const e=this.rawMaterialRefNode.getID(),t=this.rawMaterialRefNode.getAttributeValue("quantity");if(!Array.isArray(t))return;const n=[],i=[];t.forEach(e=>{e.getAttributesToConvert(i)});const r=c.sum(i.map(e=>e.value)),o={...i[0],nodeid:e,value:r.toString()};n.push(o);let s=null;try{s=await new Promise(e=>{l.updateAttributes(n,t=>{e(t)})})}catch(e){return}const a=s.pids[e];a&&(this.rawMaterialRefNode.setRealAttributesConvertState(!0),Reflect.ownKeys(a).forEach(e=>{this.rawMaterialRefNode.options.grid[e]=a[e]}))}getColumns(){const e=[],t=super.getColumns().filter(e=>e.dataIndex!==i.CONT_QUANTITY_VOLUME).filter(e=>e.dataIndex!==i.CONT_QUANTITY_MASS);e.push(...t),e.push({pinned:"left",width:100,editableFlag:!1,text:o.get("occurence"),getCellValue:e=>e.nodeModel.options.grid.occurence,dataIndex:"occurence"});const n=this.usages.some(e=>e.isRawMaterialType());return this.usages.some(e=>!e.isRawMaterialType())&&(e.push({pinned:"left",width:100,editableFlag:!1,typeRepresentation:"string",text:`${o.get("MadeFrom")} (${o.get("label_Quantity")})`,getCellValue(e){let t=e.nodeModel.options.grid.MadeFrom;return!(t=t?t.replace("\n",""):t)||e.nodeModel.isAttributePending("MadeFrom")?t=o.get("loading"):"function"==typeof t.trim&&0===t.trim().length&&(t=o.get("None")),t},dataIndex:"MadeFrom"}),this.updateMadeFromColumn()),n&&(e.push({pinned:"left",width:150,editableFlag:!1,typeRepresentation:"string",text:o.get(i.RAW_MATERIAL_QUANTITY),getCellValue(e){let t=e.nodeModel.options.grid[i.RAW_MATERIAL_QUANTITY];return!(t=t?t.replace("\n",""):t)||e.nodeModel.isAttributePending(i.RAW_MATERIAL_QUANTITY)?t=o.get("loading"):"function"==typeof t.trim&&0===t.trim().length&&(t=o.get("None")),t},dataIndex:i.RAW_MATERIAL_QUANTITY}),this.updateRawMaterialFromColumn()),e}getRollup(e){return(this.rawMaterialRefNode.isRealAttributesConverted()?this.rawMaterialRefNode.getRollUpMaterials():"")||o.get("label.notAvailable")}}}),define("DS/ENOXEngineer/componentsHelpers/mixins/XENDropConfirm",["css!DS/UIKIT/UIKIT","UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","DS/UIKIT/SuperModal","DS/UIKIT/Input/Button","DS/ENOXEngineer/componentsHelpers/mixins/XEngDnDManager","DS/Utilities/Utils","DS/ENOXEngineer/commands/ProductStructureEdition","DS/ENOXEngineer/utils/XEngineerConstants","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n,i,r,o,s,a,l,c,d){return n.extend(i,{name:"dropConfirm",defaultOptions:{},init:function(e){},reorderConfirmPopup:function(e,t,n){var i=this.getDisplayReorderMessageName(d.get("reorder_confirmation_question"),e,t,n),r=d.get("reorder"),o=d.get("reorder");this.confirmToProceedDialog(r,i,c.REORDER,o)},getDisplayReorderMessageName:function(e,t,n,i){var r,o=this.getDisplayMessageName(t),s=this.getDisplayMessageName([n]);return"top"===i?r=d.get("reorder_confirmation_question_before"):"bottom"===i&&(r=d.get("reorder_confirmation_question_after")),"<p>"+r.replace("$1",o).replace("$3",s)+"</p>"},reparentConfirmPopup:function(e,t){var n=this.getDisplayReparentMessageName(d.get("reparent_confirmation_question"),e,t),i=d.get("reparent"),r=d.get("reparent");this.confirmToProceedDialog(i,n,c.REPARENT,r)},getDisplayReparentMessageName:function(e,t,n){var i=this.getDisplayMessageName(t),r=this.getDisplayMessageName([n]);return"<p>"+("<p>"+e.replace("$1",i)+"</p>").replace("$2",r)+"</p>"},insertConfirmPopup:function(e,t,n,i,r,o){this.result=i,this.dropParent=r,this.childInstances=o,this.dragdata=e,this.dragInfos=n;var s=n.dropPosition;let a=l.prototype.dragNodeHasParent(n);var u=a?this.getDisplayReparentMessageName(d.get("reparent_confirmation_question"),n.droppedNodes,r):this.getDisplayInsertMessageName(d.get("insert_confirmation_question"),e,t,s),p=a?d.get("reparent"):d.get("insert"),g=a?d.get("reparent"):d.get("insert");this.confirmToProceedDialog(p,u,c.INSERT,g)},getDisplayInsertMessageName:function(e,t,n,i){var r;r=t.data.items.length>1?d.get("selectedAllObjects"):t.data.items[0].displayName;var o,s=this.getDisplayMessageName([n]);return"top"===i?o=d.get("insert_confirmation_question_before"):"bottom"===i?o=d.get("insert_confirmation_question_after"):"middle"!==i&&void 0!==i||(o=d.get("insert_confirmation_question_to")),"<p>"+o.replace("$1",r).replace("$3",s)+"</p>"},getDisplayMessageName:function(e){var n=d.get("selectedAllObjects");return 1==e.length&&(n=e[0].getDisplayName()),t.String.escapeHTML(n)},confirmToProceedDialog:function(e,t,n,i){this.getConfirmationDailog(e,t,n,i)},getConfirmationDailog:function(e,n,i,r){var o=this,s=new t.Element("div",{html:n}),a=this.getSuperModelDailog(r);return a.dialog({body:s,title:e,buttons:[{className:"primary",value:r,action:function(e){i===c.INSERT?l.prototype.insertData(o.result,o.dropParent,o.childInstances,o.dragInfos):o.performAction(i),e.hide()}},{value:d.get("eng.ui.button.cancel"),action:function(e){e.hide()}}]}),a},getSuperModelDailog:function(e){return new r({className:"ConfirmationDialogPanel",closable:!0,okButtonText:e,animate:!0,renderTo:widget.body})},performAction:function(e){require(["DS/ApplicationFrame/CommandsManager"],function(t){t.getCommand(e,widget).execute()})}})}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ItemChangeQuantityViewModel",["DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityViewModel","DS/ENOXEngineer/models/EngItemListModel","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/services/I18nManager"],(e,t,n,i,r)=>{return class extends e{initViewOptions(e){e.addRemoveNodeAuthorized=this.isAddRemoveNodeAuthorized}get isAddRemoveNodeAuthorized(){const e=this.appCore.sessionManager.shouldShowMfgView(),t=this.appCore.sessionManager.shouldShowFinalItems()||this.appCore.sessionManager.shouldShowLeafMaterials(),n=this.appCore.sessionManager.shouldShowFlatView();return!e&&!t&&!n}getRollup(e){return e.length}getColumns(){let e=super.getColumns(),t=!0,i=!0;return e=(e=e.filter(e=>"ds6w:label"!==e.dataIndex)).filter(e=>"ds6wg:revision"!==e.dataIndex),this.referenceNode&&this.referenceNode.getUsages&&Array.isArray(this.referenceNode.getUsages())&&this.referenceNode.getUsages().forEach(function(e){t=!e.hasMassQuantity()&&t,i=!e.hasVolumeQuantity()&&i}),e=t?e.filter(e=>e.dataIndex!==n.CONT_QUANTITY_MASS):e,e=i?e.filter(e=>e.dataIndex!==n.CONT_QUANTITY_VOLUME):e,this.appCore.sessionManager.shouldShowLeafMaterials()&&e.push({pinned:"left",width:100,editableFlag:!1,text:r.get("occurence"),getCellValue:function(e){return e.nodeModel.options.grid.occurence},dataIndex:"occurence"}),e}executeChangeQuantity({create:e,detach:o}){if(e.length>0||this.usagesAddedAsBulk>0){const o=this.referenceNode.getID(),s=Array.isArray(e)&&e.length>1?e.map(()=>o):[o],a=(this.runBackGroundInBackEnd,this.usagesAddedAsBulk),l=this.usages.filter(e=>e instanceof t).map(e=>e.getRelationID());this.appCore.dataService.createInstances({parentID:this.context.parentId,referencesIDs:s,existingInstancesIDs:l,quantitiesToAdd:a}).then(e=>{this.appCore.mediator.publish(n.EVENT_INSTANCES_CREATED,e)}).catch(e=>{e&&e.type&&e.type===n.ERROR_TYPE_TIMEOUT?i.errorAlert(r.get("timeout_alert_refresh")):i.errorAlert(e&&e.error&&e.error.message?e.error.message:JSON.stringify(e))})}o.length>0&&this.appCore.mediator.publish(n.EVENT_LAUNCH_COMMAND,{commandId:n.DETACH_ENG_ITEMS_CMD,context:{item:o}})}createNodeInfo(){return{Text:"New Instance","ds6w:label-Instance":r.get("eng.ui.dialog.changeQuantity.NewInst"),"ds6w:label":this.referenceNode.getLabel(),"ds6wg:revision":this.referenceNode.options.grid["ds6wg:revision"]}}}}),define("DS/ENOXEngineer/components/XEngListView/js/mixins/EngItemViewsManager",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/ENOXEngineer/utils/Utils","DS/Utilities/Utils","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/services/XEngContextManager","DS/UIKIT/Input/Toggle","DS/UIKIT/SuperModal","DS/Core/PointerEvents","DS/ENOXEngineer/componentsHelpers/mixins/XENDropConfirm","DS/ENOXEngineer/commands/ProductStructureEdition","DS/ENOXEngineer/models/EngItemListModel","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json","css!DS/ENOXEngineer/components/XEngListView/css/EngItemContentView.css"],function(e,t,n,i,r,o,s,a,l,c,d,u,p,g,h){"use strict";return t.extend({init:function(e){throw new Error("this is an abstract class it shouldn't be instanciated")},instanciedViews:{},switchView:function(e){"DataGridView"!==e?this.launchTheModelDialog(e):this.performAction(e)},launchTheModelDialog:function(t){var n=this,i=localStorage.getItem(".displayConfirmMsg"),r=!1;if(r=n.getModels().getRoots().some(function(e){return n.getModels().isViewGrouped()?r=e.getChildren().some(function(e){if(e.hasChildren()&&e.isExpanded())return!0}):!(!e.hasChildren()||!e.isExpanded())||void 0}),"true"==i)n.collapseNodes(),n.performAction(t);else if(!1===r)n.performAction(t);else{var o=n.sandbox.core.i18nManager.get("only.first.level.nodes"),s=n.sandbox.core.i18nManager.get("eng.ui.button.ok"),a=n.sandbox.core.i18nManager.get("big_tiles_view"),d=new c({className:"alternateDlgConfirm_modal",closable:!0,okButtonText:s,animate:!0,renderTo:widget.body}),u=new e.Element("div",{html:o});this.displayToggle=new l({type:"checkbox",label:n.sandbox.core.i18nManager.get("checkbox_dontshowagain"),checked:!1}),d.dialog({body:u,title:a,buttons:[{className:"primary",value:s,action:function(e){var i=n.displayToggle.isChecked();i&&localStorage.setItem(".displayConfirmMsg",i),n.collapseNodes(),n.performAction(t),e.hide()}},{value:n.sandbox.core.i18nManager.get("eng.ui.button.cancel"),action:function(e){e.hide(),t="DataGridView",n.performAction(t),n.eventsTokens.push(n._modelEvents.publish({event:"enox-collection-toolbar-change-icon-action",data:{id:"iconViewsActionBar",fonticon:"fonticon fonticon-tree-table site-icon",text:n.sandbox.core.i18nManager.get("DataGridView")}})),n.eventsTokens.push(n._modelEvents.publish({event:"enox-collection-toolbar-change-select-subMenu-action",data:{id:"DataGridView",selected:!0}})),n.eventsTokens.push(n._modelEvents.publish({event:"enox-collection-toolbar-change-select-subMenu-action",data:{id:"XENTile",selected:!1}}))}}]});var p=document.querySelector(".alternateDlgConfirm_modal .modal-footer");this.displayToggle.inject(p)}},collapseNodes:function(){var e=this;e.getModels().getRoots().forEach(function(t){e.getModels().isViewGrouped()?t.getChildren().forEach(function(e){e.hasChildren()&&e.isExpanded()&&e.collapseAll()}):t.hasChildren()&&t.isExpanded()&&t.collapseAll()})},performAction:function(e){this.hidePreviousView(),this.preferredView=e,this.toggleToolbarItems();try{this.getModels()&&this.renderPreferredView()}catch(e){console.error(e),this.renderPreferredView()}this._persistPreferredView(e)},_persistPreferredView:function(e){this.sandbox.core.localStorage.setItem(this.sandbox.getComponentName()+"_PrefView",e)},_getPersistedPrefView:function(){return this.sandbox.core.localStorage.getItem(this.sandbox.getComponentName()+"_PrefView")},hidePreviousView:function(){var e=this;Object.keys(this.instanciedViews).forEach(function(t){e.instanciedViews[t].elements.container.classList.remove("visible")}),e._emptyViewRendered&&e.removeEmptyView()},renderEmptyView:function(){this._emptyViewRendered&&this.emptyView||(this.emptyView=this.sandbox.core.moduleHelper.viewsService.getGridEmptyView(o.CONST_EMPTY_DGV_TILE_VIEW),this.emptyView&&(this._emptyViewRendered=!0,this.emptyView.inject(this.getContent())))},removeEmptyView:function(){if(this.emptyView){try{this.emptyView._containerEmptyContent&&(this.getContent().removeChild(this.emptyView._containerEmptyContent),this.emptyView._containerEmptyContent.innerHTML=""),this.emptyView.destroy()}catch(e){console.error(e)}this.emptyView=null}this._emptyViewRendered=!1},updateViewsFromCountChange:function(){(this._emptyViewRendered&&!this.isEmpty()||this.isEmpty()&&"XENTile"===this.getPreferredView())&&(this.hidePreviousView(),this.renderPreferredView())},renderPreferredView:function(){if(this.isEmpty()&&"XENTile"===this.getPreferredView())this.renderEmptyView();else{var e=this.getPreferredViewInstance();e&&e.elements.container.classList.add("visible")}},getPreferredViewInstance:function(){var e=this.getPreferredView();return this.instanciedViews[e]||this.createViewInstance(e),a.setGridView(this.activeView),a.setCurrentViewPreference(this.getPreferredView()),this.instanciedViews[e]},isDGVModifiedLocally:function(){if(!this.instanciedViews||this.instanciedViews.DataGridView)return!1;const e=this.instanciedViews.DataGridView.layout;if(!e)return!1;const t=e._getUnpinnedColumnsOrderInPreferences(),n=e._getPinnedColumnsOrderInPreferences(),i=e._getColumnsWidthInPreferences(),r=e._getColumnsSortModelInPreferences(),o=e._getColumnsVisibleFlagInPreferences(),s=e._getGroupingOptionsInPreferences();return t||n||i||r||o||s},customViewsPersistence:function(){var e=this;this.instanciedViews.DataGridView.subscribeOnceToAllCellsRendered(function(){var t=e.instanciedViews.DataGridView.getCustomViewsManager();t.getCustomViews(),t.getCurrentCustomViewIdentifier();let n=e.sandbox.core.dicoService.userDicoPreferences.customViewsInfo;if(n){let i=n[o.XEN_CUSTO_VIEWS];for(let e in i)i&&i[e]&&t.addCustomView(i[e]);e.isDGVModifiedLocally()||t.setCurrentCustomView(n[o.XEN_CUSTO_IDENTIFIER])}t.onCustomViewsSave=function(t,n){var i={};i[o.XEN_CUSTO_IDENTIFIER]=n,i[o.XEN_CUSTO_VIEWS]=t,i.newColumnPinnedInfo=e.instanciedViews.DataGridView.columns,e.sandbox.core.dicoService.setCustoInfoToUser(i)}})},createViewInstance:function(e){var t=this._getViewClass(e);if(!t)return null;this.instanciedViews[e]=new t(this.getViewOptions(e)),this.activeView=this.instanciedViews[e],this.activeView.getContent().inject(this.getContent()),this.configureViewInstance(this.activeView),this.loadAuthorizedValuesNLS()},onCellDoubleClick:function(e){this.openItem(e)},openItem:function(e){var t=e.cellModel;if(t&&typeof t===Object||(t=e.nodeModel),t)if(t.isEngineeringItem()){let n=t&&e.cellModel.dataIndex&&e.cellModel.dataIndex===o.CONST_DEFORMABLE?t.options.grid[o.CONST_DS6W_DEFORMABLE]:t.getID();this.sandbox.publish(o.EVENT_LAUNCH_COMMAND,{commandId:o.OPEN_ENG_ITEM,context:{item:{objectId:n,objectType:t.getType(),itemListModel:t}}})}else t.isSelected()||(this.getModels().unselectAll(),t.select()),this.sandbox.core.mediator.publish(o.EVENT_TRIPTYCH_SHOW_PANEL,"right")},getDefauftView:function(){return"DataGridView"},getPreferredView:function(){if(this.preferredView)return this.preferredView;var e=this.getDefauftView();if(e){this.views=this.views||[];for(var t=0;t<this.views.length;t++)if(this.views[t].id===e)return this.preferredView=this.views[t].id,this.views[t].id}return this.preferredView=this.views[0].id,this.views[0].id},configureViewInstance:function(e){var t=this;e.onDelayedModelDataRequest=r.debounce(function(e){if(e&&e.collectionView&&e.collectionView.model&&t.getModels()){var n=e.collectionView.model.slice(e.startNodeIndex,e.endNodeIndex+1);Array.isArray(n)&&n.length>0&&t.getModels().fillAttributesAsync4VisibleNodes(n)}},200),"DataGridView"===this.getPreferredView()?t.eventHandlerOnGridView(e):(e.selectionBehavior={canInteractiveMultiselectWithCheckboxClick:!0,canMultiSelect:!0,enableFeedbackForActiveCell:!0,enableShiftSelection:!0,toggle:!0,unselectAllOnEmptyArea:!0},e.onDragStartCellDefault=function(e){return!0},e.onCellDoubleClick(t.onCellDoubleClick.bind(t)),e.allowUnsafeHTMLContent=!0,e._onCellTitleClick=function(e){var n=e;t.openItem(n)},e._onPostRequestCellCB=function(e){e.cellView.contentView.elements.picture.setStyle("background-size","contain")},e.model=t.getModels())},eventHandlerOnGridView:function(e){var t=this,n=0,r=!1;this.customViewsPersistence(),e.onDragStartCell=((e,t)=>{t.nodeModel;e.dataTransfer.effectAllowed="all",a.dragStartedInXENG=!0;const n=i.prepareDragData(a.getSelectedRealNodes());return e.dataTransfer.setData("Text",n),!1}),e.addEventListener("dragend",function(e,t){a.dragStartedInXENG=!1}),e.addEventListener(d.POINTERHIT,function(e,i){(void 0!==i&&i.columnID==o.TITLE_COLUMN_NO||i&&i.cellModel&&i.cellModel.dataIndex&&i.cellModel.dataIndex==o.CONST_DEFORMABLE&&i.nodeModel.options.grid[o.CONST_DS6W_DEFORMABLE])&&(1===e.multipleHitCount?n=setTimeout(function(){if(!r&&e.target.hasClassName("wux-tweakers-string-label")){var n=i;t.openItem(n)}r=!1},500):e.multipleHitCount>=2&&(clearTimeout(n),r=!0))}),e.addEventListener("dblclick",function(e,n){n&&n.nodeModel&&n.nodeModel.getID&&(t.sandbox.core.contextManager.setDoubleClickEvent(),t.sandbox.publish(o.EVENT_REFRESH_ITEMS_BY_IDS,[n.nodeModel.getID()]))}),e.addEventListener("click",(e,t)=>{if(!e||!t)return;const{dsModel:i,target:o,multipleHitCount:s}=e,{rowID:a,columnID:l}=t;if(-1===a)return;if(!("a"===o.getTagName()||o.hasClassName("wux-controls-label-content")||o.hasClassName("wux-tweakers-string-icon")||o.hasClassName("wux-button-icon-fi wux-ui-genereatedicon-fi")))return;const c=i.layout.getDataIndexFromColumnIndex(l);1===s?n=setTimeout(function(){r||this.onClickDGVCell(c,t),r=!1},500):s>=2?(clearTimeout(n),r=!0):this.onClickDGVCell(c,t)})},onClickDGVCell(e,t){if(e&&t)switch(e){case o.TITLE_COLUMN_NO:this.openItem(t);break;case"ds6w:status":if(t.nodeModel.isCoreMaterialType())break;this.launchCommand(o.MATURITY_GRAPH_CMD,t);break;case"ds6w:responsible":if(t.nodeModel.isCoreMaterialType())break;this.launchCommand(o.CHANGE_OWNER_CMD,t);break;case"ds6wg:EnterpriseExtension.V_PartNumber":this.launchCommand(o.SET_PART_NUMBER_CMD,t);break;case"ds6wg:revision":this.launchCommand(o.SHOW_HISTORY_CMD,t);break;case"VariantEffectivity":this.sandbox.core.sessionManager.shouldShowFinalItems()||this.sandbox.core.sessionManager.shouldShowFlatView()||!this.sandbox.core.settingManager.isConfigAuthorized()||this.launchCommand(o.EDIT_VARIANT_EFFECTIVITY_CMD,t);break;case"CurrentEvolutionEffectivity":case"EvolutionEffectivity":this.sandbox.core.sessionManager.shouldShowFinalItems()||this.sandbox.core.sessionManager.shouldShowFlatView()||!this.sandbox.core.settingManager.isConfigAuthorized()||this.launchCommand(o.SET_EVOLUTION_EFFECTIVITY_CMD,t);break;case o.CONT_QUANTITY_MASS:this.launchCommand(o.CHANGE_MASS_QUANTITY_CMD,t);break;case o.CONT_QUANTITY_VOLUME:this.launchCommand(o.CHANGE_VOLUME_QUANTITY_CMD,t);break;case"rollup":this.launchCommand(o.CHANGE_QUANTITY_CMD,t);break;case"CoreMaterial":case"CoveringMaterial":case"CoveringMaterialInstance":this.launchCommand(o.MATERIALS_CMD,t);break;case"Alternate":this.launchCommand(o.ALTERNATES_CMD,t);break;case"Manufacturing":this.launchCommand(o.MANUF_RESP_CMD,t);break;case"MadeFrom":this.launchCommand(o.MADE_FROM_CMD,t);break;case o.CONST_SPEC_RELATION_COLUMN_DATAINDEX:this.launchCommand(o.SPEC_DOC_CMD,t);break;case"rawMaterialQuantity":this.launchCommand(o.CHANGE_RAW_QUANTITY_CMD,t);break;case"MEIColumn":this.launchCommand(o.MEI_COLUMN,t);break;case"ProductConfiguration":this.selectSingleInstance(t.nodeModel);let i=this.sandbox.core.columnsManager.getColumnsProviderWithMetas("configurationColumnsProvider"),r=i.instance.getOnCellClickCB;if(r){var n=r.call(i,e);if(n){n(t);break}}case"ds6w:reserved":if(t.nodeModel.isCoreMaterialType())break;t.nodeModel.isDocument()||this.launchResevationCommands(t,e);break;case"ds6w:reserved-Instance":if(t.nodeModel.isCoreMaterialType())break;this.sandbox.core.sessionManager.shouldShowQuantityView()||t.nodeModel.isDocument()||t.nodeModel.isDrawing()||this.launchResevationCommands(t,e)}},launchCommand:function(e,t,n){this.selectSingleInstance(t.nodeModel);this.sandbox.core.mediator.publish(o.EVENT_LAUNCH_COMMAND,{commandId:e,context:n||{item:this.getModels().getSelectedNodes()}})},selectSingleInstance:function(e){this.getModels().getSelectedNodes().length>=1&&this.unSelectAll(),e.select()},getDGVCellSelection:function(){const e=o.DGV_SELECTION_MULTIPLE;switch(this.sandbox.core.sessionManager.getSelectionMode()){case o.SELECT_MODE_CELL:return o.DGV_SELECTION_MULTIPLE;case o.SELECT_MODE_ROW:return o.DGV_SELECTION_NONE;default:return e}},getViewOptions:function(t){let n={};if("DataGridView"==t){const t=e.clone(this.sandbox.columnsManager.getDatagridViewColumns());this.getModels().addFilterModel(t),n={treeDocument:this.getModels(),columns:t,showNodeKPIColorFlag:this.getModels().isColorizeEnabled(),rowSelection:o.DGV_SELECTION_MULTIPLE,cellSelection:this.getDGVCellSelection(),identifier:"XEN-DatagridView_"+this.sandbox.core.settingManager.getWidgetId(),defaultColumnDef:{width:"auto",typeRepresentation:"string",editionPolicy:"EditionOnDoubleClick"},useAsyncPreExpand:!0,placeholder:"",onContextualEvent:this.buildContextualMenu.bind(this),rowDragEnabledFlag:!0,rowReorderEnabledFlag:!0,cellDragEnabledFlag:!0,onDragStartRowHeader:this.dragStartRowHeader.bind(this),onDragOverRowHeader:e=>{e.preventDefault()},onDropRowHeader:e=>{e.preventDefault()},onDragOverCell:e=>(e.preventDefault(),!0),onDragOverBlank:e=>{e.preventDefault()},onDropBlank:this.dropBlank,onDropCell:this.dropCell,onDragStartColumnHeader:()=>(a.dragStartedInXENG=!0,!0)}}else n={height:"inherit",displayedOptionalCellProperties:["contextualMenu","statusbarIcons","description","activeFlag"],useDragAndDrop:!0,sandbox:this.sandbox,onDragStartCell:function(e,t){var n=t.nodeModel;n&&n.getTreeDocument(),e.dataTransfer.effectAllowed="all",a.dragStartedInXENG=!0;var r=i.prepareDragData(a.getSelectedRealNodes());return e.dataTransfer.setData("Text",r),!0},onDragEndCell:function(e,t){return a.dragStartedInXENG=!1,!0}};return n},buildContextualMenu:function(e){let t=[];if(!e||!e.cellInfos||!e.collectionView)return t;if(-1===e.cellInfos.rowID)t=e.collectionView.buildDefaultContextualMenu(e,{});else{const n=e.cellInfos.nodeModel;n.isSelected()||(this.unSelectAll(),n&&n.select()),t=n?n.getEngineeringMenu(o.ENG_ITEM_VIEW):[]}return t},dragStartRowHeader:function(e,t){var n=t.nodeModel;n&&n.getTreeDocument(),e.dataTransfer.effectAllowed="all",a.dragStartedInXENG=!0;var r=i.prepareDragData(a.getSelectedRealNodes());return e.dataTransfer.setData("Text",r),!0},dropBlank:function(e,t){e.preventDefault();var n=this;if(a._app.core.sessionManager.getFlatViewOption()!==o.DIRECT_CMD||a._app.core.sessionManager.shouldShowFinalItems()||a._app.core.sessionManager.shouldShowFlatView()||a._app.core.sessionManager.shouldShowLeafMaterials())return void s.errorNotif({title:a._app.core.i18nManager.get("failure.insert.drop"),subtitle:a._app.core.i18nManager.get("error.insert.drop.view"),message:a._app.core.i18nManager.get("drop.insert.view.direct")});if(a._app.core.sessionManager.shouldShowMfgView())return void s.errorNotif({title:a._app.core.i18nManager.get("failure.insert.drop"),subtitle:a._app.core.i18nManager.get("error.insert.drop.view"),message:a._app.core.i18nManager.get("drop.insert.view.noManuf")});let i=JSON.parse(e.dataTransfer.getData("Text")),r=i.data.items,l=t.nodeModel?t.nodeModel.getRealParent()._options.referenceId:a.getActiveEngItem().getID();a.resetSelection();for(let e in r)if(!a.canInstantiate(l,r[e].objectId,h.get("cycles_error")))return;var c=a.getActiveEngItem(),d=c._getChildInstanceNodes().filter(e=>e instanceof g).map(e=>e.getRelationID());a._app.core.settingManager.retrieveAllValidContentForXENFromDrop(i).then(function(e){Array.isArray(e)&&e.length>0&&(t.droppedNodes?(n.dropNode=c,n.draggedNodes=t.droppedNodes,n.dropNode.setState({state:"expanded"}),u.prototype.reparentConfirmPopup(t.droppedNodes,c)):u.prototype.insertConfirmPopup(i,c,t,e,c,d))}).catch(function(e){let t=a._app.core.i18nManager.get("failure.insert.drop");s.unexpectedFailure(t)})},dropCell:function(e,t){if(e.preventDefault(),!t.droppedNodes){{let i=JSON.parse(e.dataTransfer.getData("Text"));if(a._app.core.sessionManager.shouldShowQuantityView())return s.errorNotif({title:a._app.core.i18nManager.get("failure.insert.drop"),subtitle:a._app.core.i18nManager.get("error.insert.drop.view"),message:a._app.core.i18nManager.get("drop.reParent.view.reference")});if(a._app.core.sessionManager.getFlatViewOption()!==o.DIRECT_CMD||a._app.core.sessionManager.shouldShowFinalItems()||a._app.core.sessionManager.shouldShowFlatView()||a._app.core.sessionManager.shouldShowLeafMaterials())return void s.errorNotif({title:a._app.core.i18nManager.get("failure.insert.drop"),subtitle:a._app.core.i18nManager.get("error.insert.drop.view"),message:a._app.core.i18nManager.get("drop.insert.view.direct")});if(a._app.core.sessionManager.shouldShowMfgView())return void s.errorNotif({title:a._app.core.i18nManager.get("failure.insert.drop"),subtitle:a._app.core.i18nManager.get("error.insert.drop.view"),message:a._app.core.i18nManager.get("drop.insert.view.noManuf")});if(this.dropPosition=t.dropPosition,"middle"===this.dropPosition){if(t.nodeModel&&"ds6w:Part"!=t.nodeModel.getGlobalType())return s.errorNotif({title:a._app.core.i18nManager.get("failure.insert.drop"),subtitle:a._app.core.i18nManager.get("failure.notPhysicalProduct")});this.dropParentID=t.nodeModel.getID()}else this.dropParentID=t.nodeModel.getRealParent()._options.referenceId;let l=i.data.items;var n="middle"===this.dropPosition?t.nodeModel:t.nodeModel.getRealParent();a.addSelection(n,!0);for(let e in l)if(!a.canInstantiate(this.dropParentID,l[e].objectId,h.get("cycles_error")))return;r=a.getNodesById(this.dropParentID)[0]._getChildInstanceNodes().filter(e=>e instanceof g).map(e=>e.getRelationID());a._app.core.settingManager.retrieveAllValidContentForXENFromDrop(i).then(function(e){u.prototype.insertConfirmPopup(i,t.nodeModel,t,e,n,r)}).catch(function(e){let t=a._app.core.i18nManager.get("failure.insert.drop");s.unexpectedFailure(t)})}return!0}if(this.draggedNodes=t.droppedNodes,this.dropNode=t.nodeModel,this.dropPosition=t.dropPosition,!i.isNodeFromModel(this.dropNode)||this.dropNode.isGrouped())return s.errorAlert(h.get("reorder_groupedNode_error"));if("middle"===this.dropPosition){for(let e in this.draggedNodes)if(a._app.core.sessionManager.shouldShowQuantityView()){if(this.draggedNodes[e].getUsages()&&this.dropNode.getUsages()&&this.draggedNodes[e].getUsages()[0].getRelationID()===this.dropNode.getUsages()[0].getRelationID())return s.errorAlert(h.get("cycles_error"))}else if(this.draggedNodes[e].getRelationID()===this.dropNode.getRelationID())return s.warningAlert(h.get("cycles_error"));for(let e in this.draggedNodes)if(this.draggedNodes[e].getID()===this.dropNode.getID())return s.errorAlert(h.get("cycles_error"));if(a._app.core.sessionManager.shouldShowIndentedView()&&!a._app.core.sessionManager.shouldShowMfgView()){for(let e in this.draggedNodes)if("ds6w:Part"!=this.draggedNodes[e].getGlobalType()||"ds6w:Part"!=this.dropNode.getGlobalType())return s.errorAlert(h.get("Unsupported_type"));return void u.prototype.reparentConfirmPopup(this.draggedNodes,this.dropNode)}return s.errorNotif({title:a._app.core.i18nManager.get("failure.reparent.drop"),subtitle:a._app.core.i18nManager.get("error.insert.drop.view"),message:a._app.core.i18nManager.get("drop.reparent.view")})}if(!a._app.core.sessionManager.shouldShowIndentedView()||a._app.core.sessionManager.shouldShowQuantityView()||a._app.core.sessionManager.shouldShowMfgView())return s.errorNotif({title:a._app.core.i18nManager.get("failure.reorder.drop"),subtitle:a._app.core.i18nManager.get("error.insert.drop.view"),message:a._app.core.i18nManager.get("drop.reorder.view")});if(a.getActiveEngItem().hasValidTransientNextGenFilter()||a.getActiveEngItem().hasValidPersistedNextGenFilter()||!a._activeGridView.getFilterViewManager().isEmpty())return s.errorAlert(h.get("reorder_reparent__filter_blocked_errorMsg"));for(let n in this.draggedNodes){let i=null===this.dropNode.getParent()._parentNode?this.dropNode.getRealParent():this.dropNode.getParent();if(i.getChildren()&&1===i.getChildren().length)return s.errorAlert(h.get("singleChild_reorder_error"));if("ds6w:Part"!=this.draggedNodes[n].getGlobalType())return s.errorAlert(h.get("Unsupported_type"));if(this.draggedNodes[n].getParentIdFromOccrencePath()!=this.dropNode.getParentIdFromOccrencePath()){if("DocInstance"===this.dropNode.options.instanceType)return s.errorAlert(h.get("reorder_document_error"));if("ds6w:Part"==this.draggedNodes[n].getGlobalType()){if(this.draggedNodes.length>1)return s.errorAlert(h.get("multiple_reorder_error"));if(!a.canInstantiate(i.getID(),this.draggedNodes[n].getID(),h.get("cycles_error")))return;let o=JSON.parse(e.dataTransfer.getData("Text"));var r=i._getChildInstanceNodes().filter(e=>e instanceof g).map(e=>e.getRelationID());return void a._app.core.settingManager.retrieveAllValidContentForXENFromDrop(o).then(function(e){u.prototype.insertConfirmPopup(o,t.nodeModel,t,e,i,r)}).catch(function(e){let t=a._app.core.i18nManager.get("failure.insert.drop");s.unexpectedFailure(t)})}return s.notifyAlert(h.get("reorder_differentLevel_error"))}}u.prototype.reorderConfirmPopup(this.draggedNodes,this.dropNode,this.dropPosition)},_getViewClass:function(e){for(var t=0;t<this.views.length;t++)if(this.views[t].id===e)return this.views[t].Clazz;return null},loadViewsClass:function(){var e=this;return this.classLoaderPromise?this.classLoaderPromise:(this.classLoaderPromise=new n(function(t,n){i.loadFiles(e.views.map(function(e){return e.loader})).then(function(n){for(var i=0;i<e.views.length;i++)e.views[i].Clazz=n[i];e.views=Object.freeze(e.views),t(e.views)}).catch(function(e){n(e)})}),this.classLoaderPromise)},initializeViews:function(){var e=this;this.views=this._views,this.containerInstance=document.createElement("div"),this.loadViewsClass().then(function(t){e.renderPreferredView(),e.sandbox.subscribe(o.EVENT_COLORIZATION_UPDATED,function(t){var n=e.instanciedViews.DataGridView;n&&(n.showNodeKPIColorFlag=t)}),e.sandbox.subscribe(o.EVENT_REAPPLY_DATAGRID_SORT_MODEL,function(){var t=e.instanciedViews.DataGridView;t&&t.reapplySortModel()}),e.getModels().reApplyGroups()}).catch(function(e){console.error(e)})},reDrawColumns:function(e){if(this.instanciedViews.DataGridView){var t=this.instanciedViews.DataGridView;if(!t)return;var n=this.sandbox.columnsManager.getDatagridViewColumns(this.getModels());if(Array.isArray(n)&&n.length>0){var i=(t.columns||[]).map(function(e){return e.dataIndex});t.prepareUpdateView(),i.forEach(function(i){var r=n.find(function(e){return e.dataIndex===i});"tree"===i||!e&&r||t.removeColumnOrGroup(i)});var r=0,o=!1;n.forEach(function(n){var s=i.find(function(e){return n.dataIndex===e});"tree"===n.dataIndex||!e&&s||(t.addColumnOrGroup(n,r),o=!0),r++}),t.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0),o&&this.getModels().addFilterModel(n)}}},launchGroupBy:function(e){this.instanciedViews.DataGridView.groupRows({dataIndexesToGroup:e.propertiesToGroup})},destroyLoadedViews:function(){this.getModels()&&this.getModels().getModelEvents()&&this.getModels().getModelEvents().unsubscribeAll({event:"modelUpdate"});for(var e=Object.keys(this.instanciedViews),t=0;t<e.length;t++){var n=this.instanciedViews[e[t]];if("function"==typeof n.destroy)try{n.destroy();for(var i=Object.keys(n||{}),r=0;r<i.length;r++)n[i[r]]=void 0}catch(e){console.error(e)}delete this.instanciedViews[e[t]]}this.activeView=null},destroyViews:function(){this.destroyLoadedViews(),this.classLoaderPromise=null,this.views=null,this._views=null},getAvailableViews:function(){return this._views.map(function(e){return{id:e.id,text:e.text,fonticon:e.fonticon}})},getDataUpdateConfirmationDailog:function(t,n,i,r){var o=this,s=localStorage.getItem(".isDbRefreshPromotChecked");if("true"!==s){if("false"!==s){var a=o.sandbox.core.i18nManager.get("eng.ui.confirm.refresh.db.info"),c=o.sandbox.core.i18nManager.get("eng.ui.button.ok"),d=o.sandbox.core.i18nManager.get("eng.db.data.refresh.prompt.title");new e.Element("div",{html:a});this.displayToggle=new l({type:"checkbox",label:o.sandbox.core.i18nManager.get("checkbox_dontshowagain"),checked:!1});var u=this.getSuperModelDailog(c);u.dialog({body:a,title:d,buttons:[{className:"primary",value:c,action:function(e){var s=o.displayToggle.isChecked();s&&localStorage.setItem(".isDbRefreshPromotChecked",s),o.refresh(t,n,i,r),e.hide()}},{value:o.sandbox.core.i18nManager.get("eng.ui.button.cancel"),action:function(e){o.displayToggle.isChecked()&&localStorage.setItem(".isDbRefreshPromotChecked","false"),e.hide()}}]});var p=document.querySelector(".alternateDlgConfirm_modal .modal-footer");return this.displayToggle.inject(p),u}}else o.refresh(t,n,i,r)},getSuperModelDailog:function(e){return new c({className:"alternateDlgConfirm_modal",closable:!0,okButtonText:e,animate:!0,renderTo:widget.body})},launchResevationCommands:function(e,t){e.nodeModel.options.grid[t]&&"FALSE"!==e.nodeModel.options.grid[t]?this.launchCommand("UnreserveHdr",e):this.launchCommand("ReserveHdr",e)}})}),define("DS/ENOXEngineer/components/XEngListView/js/EngItemContentViewer",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","DS/PlatformAPI/PlatformAPI","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/services/XEngContextManager","DS/ENOXEngineer/components/XEngListView/js/mixins/ToolBarManager","DS/ENOXEngineer/components/XEngListView/js/mixins/EngItemViewsManager","DS/ENOXEngineer/services/XEngLocalStorage","DS/ENOXEngineer/utils/ResponseParser","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/services/OccurrencesService","DS/ENOXEngineer/utils/Utils"],function(e,t,n,i,r,o,s,a,l,c,d,u,p){"use strict";return t.extend(n,s,a,{defaultOptions:{useToolBar:!0},contentType:"BOM",init:function(e){this.sandbox=e,this.sandbox.logger.info("initializing EngItemContentViewer ..."),this._parent({}),this.elements.container=e.container,this.i18nManager=e.i18nManager,this._views=[{id:"DataGridView",text:this.i18nManager.get("DataGridView"),loader:"DS/DataGridView/DataGridView",fonticon:"fonticon fonticon-tree-table site-icon"}]},start:function(){this.sandbox.logger.info("starting EngItemContentViewer ...");var e=this;e.sandbox.subscribe(r.EVENT_CHANGE_DIRECT_VIEW,function(){e.switchToDirectView()}),e.initializeToolbar(),e.initializeViews(),e.toggleToolbarItems(),this.getModels().onPostENOXFiltering=this.updateCount.bind(this),this.getModels().onSelectionUpdated=this.updateSelectedItemsCount.bind(this),e.sandbox.subscribe(r.EVENT_CREATED_NODES,function(t){e.addContentToModels(t)}),e.sandbox.subscribe(r.EVENT_INSTANCES_CREATED,function(t){e.getModels().addNewInstances(t)}),e.sandbox.subscribe(r.EVENT_INDEX_MODE_DISABLE,function(){}),e.sandbox.subscribe(r.EVENT_REPLACED_ENG_ITEM,function(t){e.replaceContent(t)}),e.sandbox.subscribe(r.EVENT_REPLACED_DOCUMENT,function(t){e.replaceDocument(t)}),e.sandbox.subscribe(r.EVENT_LIST_SELECT_ITEM,function(t){e.select(data[t.rowID])}),e.sandbox.subscribe(r.EVENT_NOTIFY_CONTENT_SIZE_CHANGE,function(){e.updateCount()}),e.sandbox.subscribe(r.EVENT_DELETED_ENG_ITEM,function(t){Array.isArray(t.ids)&&-1!==t.ids.indexOf(e.sandbox.options.physicalId)&&e.sandbox.publish(r.EVENT_GO_BACK)});e.sandbox.subscribe(r.EVENT_TRIPTYCH_PANEL_VISIBLE,function(t){"right"===t&&e.sandbox.core.PersistencyManager.setInformationPanelStatus(!0)}),e.sandbox.subscribe(r.EVENT_TRIPTYCH_PANEL_HIDDEN,function(t){"right"===t&&e.sandbox.core.PersistencyManager.setInformationPanelStatus(!1)}),e.sandbox.subscribe(r.EVENT_TRIPTYCH_RESIZE_PANEL,t=>{const n=t?t.side:null,i=t?t.width:null;if("right"===n&&i){const t=e.sandbox.core.PersistencyManager;t&&t.setInformationPanelWidth(i)}});e.sandbox.subscribe(r.EVENT_DOWNLOAD_ITEM,function(t){e.sandbox.dataService.downloadDocuments(t.nodes)}),e.sandbox.subscribe(r.EVENT_REMOVE_DOCUMENT,function(t){e.sandbox.dataService.detachDocuments(t.nodes,e.getModels().getEngineeringItem())}),e.sandbox.subscribe(r.EVENT_DELETE_DOCUMENT,function(t){e.sandbox.dataService.deleteDocuments(t.nodes)}),e.sandbox.subscribe(r.EVENT_REMOVED_INSTANCE,function(t){e.getModels().deleteNodesByInstanceID(t.instances),e.updateCount()}),e.sandbox.subscribe(r.EVENT_REMOVED_NODES,function(t){e.getModels().prepareUpdate(),t.nodes.forEach(function(t){e.getModels().removeRoot(t)}),e.getModels().pushUpdate(),e.updateCount()}),e._refreshSubscription=i.subscribe("DS/PADUtils/PADCommandProxy/refresh",function(t){var n=[];if(t.data.authored)if(t.data.authored.deleted&&t.data.authored.deleted.length>0)t.data.authored.deleted.forEach(function(e){n.push(e)}),e.removeNodes(n);else if(t.data.authored.modified)t.data.authored.modified.forEach(function(e){let t="object"==typeof e?e.physicalid:e;n.push(t)}),e.updateContent(n);else if(Array.isArray(t.data.authored)){let i=[],o=e.getModels().getEngineeringItem(),s=o.getID(),a=[];t.data.authored.forEach(function(e){e.modified&&e.previous&&(i.push({instance:e.modified,child:o.getNodesByRelId(e.previous)[0].getID(),parent:s,split:!0}),n.push(e.previous),e.modified===e.previous&&a.push(o.getNodesByRelId(e.previous)[0]))}),i.length&&e.sandbox.publish(r.EVENT_INSTANCES_CREATED,i),a.forEach(function(e){e.select()}),e.updateContent(n)}}),e.sandbox.subscribe(r.EVENT_REFRESH_ITEMS_BY_IDS,function(t){Array.isArray(t)&&e.updateContent(t)}),e.sandbox.subscribe(r.EVENT_REFRESH_LISTVIEW,function(){e.getModels().prepareUpdate(),e.getModels().pushUpdate()}),e.sandbox.subscribe(r.EVENT_STRUCTURE_VIEW_CHANGED,function(){e.toggleToolbarItems(),e.closeFindPanel(),e.sandbox.publish(r.EVENT_COLUMNS_CHANGED,{updateExitingColumns:!0})}),e.sandbox.subscribe(r.EVENT_TAGGER_GROUP_CHANGED,function(){e.launchGroupBy({propertiesToGroup:[]})}),e.sandbox.subscribe(r.EVENT_PASTE_ENABLE,function(){e._modelEvents.publish({event:r.EVENT_TOOLBAR_ENABLE,data:r.ITEM_PASTE_CMD})}),e.sandbox.subscribe(r.EVENT_PASTE_DISABLE,function(){e._modelEvents.publish({event:r.EVENT_TOOLBAR_DISABLE,data:r.ITEM_PASTE_CMD})}),e.sandbox.subscribe(r.EVENT_COLUMNS_CHANGED,function(t){var n=!1;t&&t.updateExitingColumns&&(n=!0),e.reDrawColumns(n)}),e.sandbox.subscribe(r.EVENT_MODIFIED_NODES,function(t){t&&Array.isArray(t)&&e.updateNodes(t)}),e.sandbox.subscribe(r.EVENT_SET_PARTNUMBER_COMPLETED,function(t){t&&Array.isArray(t.references)&&e.updateContent(t.references.map(function(e){return e.physicalid}),function(e){if(e.isEngineeringItem&&e.isEngineeringItem())for(var n=0;n<t.references.length;n++)if(t.references[n].physicalid===e.getID()){var i=t.references[n].partNumber?t.references[n].partNumber.trim():null;return i&&0===i.length&&(i=null),void e.updateOptions({grid:{"ds6wg:EnterpriseExtension.V_PartNumber":i}})}})}),e._clipBoard=i.subscribe(r.ADD_TO_CLIPBOARD,function(t){l.setItem("clipboard",t),e._modelEvents.publish({event:r.EVENT_TOOLBAR_ENABLE,data:r.ITEM_PASTE_CMD});var n=[];if((t||0!=t.length)&&t.startsWith("CX"))for(var i=t.substring(3).split(","),o=0;o<i.length;o++)n.push(i[o].split("|")[1])}),e.sandbox.publish(r.EVENT_LIST_READY),e.updateCount()},toggleToolbarItems:function(){var e=this;const t=e.sandbox.core.contextManager.getActiveEngItem(),n=!!t&&t.hasValidTransientGroupingContext();let i=e.sandbox.sessionManager.shouldShowMfgView();if(!e.sandbox.core.settingManager.isIndexModeEnabled()){e.sandbox.sessionManager.shouldShowFinalItems()&&e.sandbox.publish(r.EVENT_CHANGE_DIRECT_VIEW),i&&e.sandbox.publish(r.EVENT_CHANGE_MFG_VIEW,{commandId:r.MANUFACTURING_CMD,isMFGView:!1}),e.sandbox.core.settingManager.getSetting(r.UNSUPPORTED_TOOLBAR_ACTIONS_AUTHORING_MODE).forEach(t=>{e._modelEvents.publish({event:r.EVENT_TOOLBAR_DISABLE,data:t})})}const o=e.getModels().getSelectedNodes();e.updateSelectedItemsCount(Array.isArray(o)?o.length:0),e.sandbox.sessionManager.shouldShowLeafMaterials()?(e._modelEvents.publish({event:r.EVENT_TOOLBAR_CHANGE_SELECTION,data:{id:r.REFERENCE_CMD,selected:!0}}),e._modelEvents.publish({event:r.EVENT_TOOLBAR_CHANGE_SELECTION,data:{id:r.INSTANCE_CMD,selected:!1}}),e._modelEvents.publish({event:r.EVENT_TOOLBAR_DISABLE,data:r.INSTANCE_CMD})):e._modelEvents.publish({event:r.EVENT_TOOLBAR_ENABLE,data:r.INSTANCE_CMD}),e.sandbox.sessionManager.shouldShowFinalItems()||null==l.getItem("clipboard")||e.sandbox.sessionManager.shouldShowMfgView()||e.sandbox.sessionManager.shouldShowLeafMaterials()||e.sandbox.sessionManager.shouldShowFlatView()?e._modelEvents.publish({event:r.EVENT_TOOLBAR_DISABLE,data:r.ITEM_PASTE_CMD}):e._modelEvents.publish({event:r.EVENT_TOOLBAR_ENABLE,data:r.ITEM_PASTE_CMD}),!e.sandbox.sessionManager.shouldShowIndentedView()||e.sandbox.sessionManager.shouldShowQuantityView()||e.sandbox.sessionManager.shouldShowMfgView()?e._modelEvents.publish({event:r.EVENT_TOOLBAR_DISABLE,data:r.LAUNCH_REORDER_CMD}):e._modelEvents.publish({event:r.EVENT_TOOLBAR_ENABLE,data:r.LAUNCH_REORDER_CMD}),e._modelEvents.publish({event:r.EVENT_UPDATE_BOOKMARK_ICON}),n?e._modelEvents.publish({event:r.EVENT_TOOLBAR_DISABLE,data:r.GROUPBY_MENU}):e._modelEvents.publish({event:r.EVENT_TOOLBAR_ENABLE,data:r.GROUPBY_MENU})},removeNodes:function(e){var t=[];this.getModels().findNodesByIds(e).forEach(function(e){t.push(e.options.instanceId)}),this.sandbox.publish(r.EVENT_REMOVED_INSTANCE,{instances:t})},updateContent:function(e,t){var n=this.getModels().findNodesByIds(e);this.updateNodes(n,t)},updateNodes:function(e,t){var n=this,i=[];const r=[];var o=[];let s=e.filter(function(e){return e._isFromOriginalModel()});s.forEach(e=>{if("function"==typeof t&&t(e),e.isDocument())i.push(e);else if(n.sandbox.core.Factories.ListItemFactory.isInstanceOfListNodeModel(e)){const t=e.getOccurrencePath?e.getOccurrencePath():null;o.push(t)}else{var s=e.getUsages?e.getUsages():[];if(s&&Array.isArray(s)&&s.length>0)if(e.isCoreMaterialType())r.push(e);else{const e=s[0].getOccurrencePath?s[0].getOccurrencePath():null;o.push(e)}}}),i.length>0&&n.updateDocument(i),r.length>0&&n.updateMaterial(r),o.length>0&&n.update(s,o)},onValidDrop:function(e){let t=this;const n=p._getItemsByTypeFromDroppedData(e,t.sandbox.core.dicoService.localDico),i=t.getModels().getEngineeringItem()._getChildInstanceNodes().map(e=>e.getRelationID()),o=t.getModels().getEngineeringItem().getID();if(null!=n.VPMReference||null!=n.Document||null!=n.Drawing){if(Array.isArray(n.dsc_matref_ref_Core)){const e=n.dsc_matref_ref_Core.map(e=>e.displayName).join(", ");d.warningAlert(t.sandbox.i18nManager.replace(t.sandbox.i18nManager.get("eng.ui.dialog.multisel.drop.material.ignored"),{materials:e}))}if(Array.isArray(n.VPMReference)){let e=n.VPMReference.map(e=>e.objectId);t.sandbox.dataService.createInstances({parentID:o,referencesIDs:e,existingInstancesIDs:i}).then(e=>{let n=e.filter(e=>"success"===e.status);t.sandbox.publish(r.EVENT_INSTANCES_CREATED,n)}).catch(e=>{console.log(e),d.unexpectedFailure(t.sandbox.i18nManager.get("failure.insert.product"))})}if(Array.isArray(n.Drawing)){let e=n.Drawing.map(e=>e.objectId);t.sandbox.dataService.createInstances({parentID:o,referencesIDs:e}).then(e=>{let n=e.filter(e=>"success"===e.status);t.sandbox.publish(r.EVENT_INSTANCES_CREATED,n)}).catch(e=>{console.error(e),d.errorAlert(e)})}Array.isArray(n.Document)&&n.Document.forEach(function(e){t.sandbox.dataService.attachDocumentToEngItem(t.getModels().getEngineeringItem(),e.objectId,!1).then(e=>{t.addContentToModels({nodes:[e],parentId:o})}).catch(e=>{console.error(e)})})}else if(Array.isArray(n.dsc_matref_ref_Core)&&1===n.dsc_matref_ref_Core.length){var s=n.dsc_matref_ref_Core[0],a={id:s.objectId,"ds6w:label":s.displayName,"ds6wg:revision":"","ds6w:type":s.displayType,"ds6w:type_value":s.objectType};t.sandbox.publish(r.EVENT_LAUNCH_COMMAND,{commandId:r.ADD_MATERIAL_QUANTITY_CMD,context:{item:a}})}else if(Array.isArray(n.Raw_Material)){const e=n.Raw_Material[0],i={id:e.objectId,"ds6w:label":e.displayName,"ds6wg:revision":"","ds6w:type":e.displayType,"ds6w:type_value":e.objectType};t.sandbox.publish(r.EVENT_LAUNCH_COMMAND,{commandId:r.ADD_EXISTING_RAW_MATERIAL_QUANTITY_CMD,context:{item:i}})}},replaceContent:function(e){var t=[],n=[];e.forEach(function(e){t.push(e.replacedId),n.push([e.parentId,e.new.instance,e.new.reference])});var i=this.getModels().findQtyOrInstNodeByIds(t);this.update(i,n,!0)},updateMaterial(e){if(!Array.isArray(e))return;const t=this.sandbox.core.sessionManager.shouldShowQuantityView()?"reference":"instance";e.forEach(async e=>{const n=e.getUsages?e.getUsages():[],i=n.map(e=>e.getOccurrencePath());try{const r=await this.sandbox.core.dataService.getListNodesFromPaths({paths:i,nodesType:t,isRefreshing:!0,isFromReplace:!1,isOnAuthoring:!0}),o={};r.forEach(e=>{e.physicalid=e.getID(),o[e.physicalid]=e});const[s]=await this.sandbox.core.dataService.completeWithCoreMaterialInformation(o),a=this.sandbox.core.Factories.ListItemFactory.createMaterialNode(s);if(a.options.grid.quantity=r,this.sandbox.core.contextManager.isDoubleClickEvent()){const t=this.sandbox.core.contextManager.areEngItemGridValuesEqual(e,a),i=e.getRollUpMaterials()===a.getRollUpMaterials();t&&i||this.getDataUpdateConfirmationDailog([e,...n],[a,...r],!1,!0),this.sandbox.core.contextManager.clearDoubleClickEvent()}}catch(e){const{error:t}=e||{},{message:n}=t||"";n.includes("timedout")&&d.warningAlert(that.sandbox.i18nManager.get("timeout_alert_refresh")),console.error(e)}})},update:function(e,t,n){var i=this,r=this.sandbox.core.sessionManager.shouldShowQuantityView()?"reference":"instance";this.sandbox.core.dataService.getListNodesFromPaths({paths:t,nodesType:r,isRefreshing:!0,isFromReplace:n,isOnAuthoring:!0}).then(function(t){i.sandbox.core.contextManager.isDoubleClickEvent()?(i.sandbox.core.contextManager.areEngItemGridValuesEqual(e[0],t[0])||i.getDataUpdateConfirmationDailog(e,t,n,!0),i.sandbox.core.contextManager.clearDoubleClickEvent()):i.refresh(e,t,n,!0)}).catch(function(e){e.error&&e.error.message&&e.error.message.contains("timedout")&&d.warningAlert(i.sandbox.i18nManager.get("timeout_alert_refresh")),console.error(e)})},refresh:function(e,t,n,i){this.getModels().prepareUpdate();var r=this.sandbox.core.contextManager.getActiveEngItem();if(!0===n)this.getModels().isViewGrouped()&&this.getModels().ungroupRoots(),e.forEach(function(n){var i=n.getParent();n.isEngineeringItem&&n.isEngineeringItem()?(i.removeChild(n),t.forEach(function(e){let t=e.getOccurrencePath();(""==i.getID()||null==i.getID()||null==i.getID()?r.getID():i.getID())===t[t.length-3]&&i.addChild(e)})):(i.removeChild(e[0]),i.addChild(t[0]))});else for(var o=0;o<e.length;o++)t[o]&&t[o].options&&t[o].options.grid&&t[o].options.grid.children&&delete t[o].options.grid.children,e[o].refreshByModel(t[o],"",i);this.getModels().refreshProvidedColumns(e,!0),this.getModels().pushUpdate(),this.getModels().reApplyUserCurrentViewOptions(),this.getModels().reApplyGroups(),this.sandbox.core.PersistencyManager.getGroupByOption()&&this.sandbox.core.contextManager._activeGridView.reapplySortModel()},updateDocument:function(e){var t=this;let n=e.map(e=>e.getID?e.getID():"");this.sandbox.core.dataService.fetchDocumentsDataAsNodes(n).then(function(n){t.sandbox.core.contextManager.isDoubleClickEvent()?(t.sandbox.core.contextManager.areEngItemGridValuesEqual(e,n)||t.getDataUpdateConfirmationDailog(e,n),t.sandbox.core.contextManager.clearDoubleClickEvent()):t.refresh(e,n)}).catch(function(e){console.error(e)})},replaceDocument:function(e){var t=this,n=this.getModels().findNodesById(e.oldDocumentId);this.sandbox.core.dataService.fetchDocumentsDataAsNodes([e.replacedDocumentId],"SpecificationDocument").then(function(e){t.refresh(n,e,!0)}).catch(function(e){console.error(e)})},selectAll:function(){this.getModels().selectAll()},unSelectAll:function(){this.getModels().unselectAll()},addContentToModels:function(e){this.sandbox.logger.info("adding content --\x3e"),this.getModels().mainAddContent(e.nodes,void 0,e.physicalIdList,e.selectedNodesToInsert,e.isChangeQuntity),this.updateCount(),void 0!==e.physicalIdList&&e.physicalIdList.length>0&&this.sandbox.options.physicalId!==e.physicalIdList[0]&&this.getModels().getSelectedNodes().forEach(function(e){e.expandAll()}),this.getModels().pushToTagger()},getModels:function(){return this.sandbox&&this.sandbox.options?this.sandbox.options.models:null},isEmpty:function(){return!this.getModels()||0===this.getModels().getChildren().length},loadAuthorizedValuesNLS:function(){return new Promise((e,t)=>{let n=this.sandbox.core.dataService.getRangeValueNlsTracker();this.i18nManager.resolveRangeValueNls(n).finally(()=>{e()})})},stop:function(){this.getModels().removeFromTagger([this.sandbox.options.physicalId]),i.unsubscribe(this._refreshSubscription),i.unsubscribe(this._clipBoard),this.sandbox.logger.info("stopping EngItemContentViewer ..."),this.destroyToolbar(),this.destroyViews(),this.sandbox.stop(this)},closeFindPanel:function(){([r.QUALIFIED_AS_FINAL_CMD,r.LEAF_MATERIALS_CMD].includes(this.sandbox.core.sessionManager.getFlatViewOption())||this.sandbox.core.sessionManager.shouldShowMfgView())&&this.sandbox.publish(r.EVENT_FIND_IN_CONTEXT_CLOSE_DIALOG)}})}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityViewModelFactory",["DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ItemChangeQuantityViewModel","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/MaterialChangeQuantityViewModel","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/RawMaterialViewModel"],(e,t,n)=>{return class{static create(i){const{referenceNode:r}=i;if(!r)throw new Error("wrong input");const o=!!r.isRawMaterialType&&r.isRawMaterialType(),s=!!r.isCoreMaterialType&&r.isCoreMaterialType();let a=e;o?a=n:s&&(a=t);const l=new a(i),{usages:c}=i;return l.nodes=c,l}}}),define("DS/ENOXEngineer/commands/ENOXChangeQuantityCmd",["UWA/Core","DS/StateCommandEngine/StateCommand","DS/Controls/Tab","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityView","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityViewModelFactory","DS/Windows/Dialog","DS/Controls/Button","DS/ENOXEngineer/services/XEngineerItemsFactory","DS/ENOXEngineer/services/I18nManager"],(e,t,n,i,r,o,s,a,l)=>{const c=l.get("totalQuantities"),d=l.get("quantitiesByModel"),u=l.get("eng.ui.button.save"),p=l.get("eng.ui.button.cancel"),g=l.get("save"),h=l.get("dontSave"),m=l.get("confirmationTitle"),f=l.get("confirmationMessage"),E={onOKBtn:"onOK",onCancelBtn:"onCancel",onAbortBtn:"onAbort",onEditQtyTab:"onEditQtyTab",onQtyByModelTab:"onQtyByModelTab"};return class extends t{constructor(e){super({mode:"exclusive",...e})}beginExecute(){this.slctdNode=null,this.actEngItem=null,this.fPNode=null,this.modal=null,this.chgQtModel=null,this.chgQtView=null,this.currentChgQtyView=null,this.error=null,this.performChangesAtEnd=!1,this.onRefreshEventFctToBeCalled=null,widget&&widget.addEventOnce("onRefresh",this.onWidgetRefresh.bind(this)),super.beginExecute()}buildGraph(){const e=this.createInitialState("startState"),t=this.createState("initState"),n=this.createState("abortState"),i=this.createState("showDialogState"),r=this.createState("editQtyState"),o=this.createState("qtyByModelState"),s=this.createState("validateChangesState"),a=this.createState("confirmValidateChangesState"),l=this.getFinalState();this.setEnterStateAction(r,this.onEnterEditQuantityState),this.setExitStateAction(r,this.onExitEditQuantityState),this.setEnterStateAction(o,this.onEnterQtyByModelState),this.setExitStateAction(o,this.onExitQtyByModelState),this.addTransition({iInitialState:n,iFinalState:l,iAction:this.abort}),this.addTransition({iInitialState:s,iFinalState:l,iAction:this.close}),this.addTransition({iInitialState:e,iFinalState:t,iAction:this.init}),this.addTransition({iInitialState:t,iFinalState:n,iCondition:this.notCondition(this.isInitPassed)}),this.addTransition({iInitialState:t,iFinalState:i,iAction:this.buildModalView}),this.addTransition({iInitialState:i,iFinalState:r,iAction:this.activateEditQuantityState}),this.addTransition({iInitialState:r,iFinalState:s,iAction:this.onValidate,iEvent:E.onOKBtn,iSender:this}),this.addTransition({iInitialState:r,iFinalState:n,iEvent:E.onCancelBtn,iSender:this}),this.addTransition({iInitialState:r,iFinalState:o,iEvent:E.onQtyByModelTab,iSender:this}),this.addTransition({iInitialState:o,iFinalState:a,iCondition:this.hasAuthoringModification,iAction:this.onAskForValidate,iEvent:E.onOKBtn,iSender:this}),this.addTransition({iInitialState:o,iFinalState:a,iCondition:this.hasAuthoringModification,iAction:this.onAskForValidate,iEvent:E.onCancelBtn,iSender:this}),this.addTransition({iInitialState:o,iFinalState:n,iCondition:this.notCondition(this.hasAuthoringModification),iEvent:E.onCancelBtn,iSender:this}),this.addTransition({iInitialState:o,iFinalState:r,iEvent:E.onEditQtyTab,iSender:this}),this.addTransition({iInitialState:a,iFinalState:o,iEvent:E.onAbortBtn,iSender:this}),this.addTransition({iInitialState:a,iFinalState:n,iEvent:E.onCancelBtn,iSender:this}),this.addTransition({iInitialState:a,iFinalState:s,iAction:this.onValidate,iEvent:E.onOKBtn,iSender:this})}endExecute(){super.endExecute(),this.performChangesAtEnd&&this.executeChanges(),this.slctdNode=null,this.actEngItem=null,this.fPNode=null,this.modal=null,this.chgQtModel=null,this.chgQtView=null,this.currentChgQtyView=null,this.error=null}isInitPassed(){return!e.is(this.error)}hasAuthoringModification(){return!!this.chgQtModel&&this.chgQtModel.hasModifiedNode()}async init(e){try{if(this.actEngItem=this.options.context.getActiveEngItem(),!this.actEngItem)throw new Error("wrong state, expected actEngItem not to be null");const t=this.options.context.getSelectedNodes();if(this.slctdNode=Array.isArray(t)&&t.length?t[0]:null,!this.slctdNode)throw new Error("wrong state, expected slctdNode not to be null");const n=this.slctdNode.getParent();if(this.fPNode=n&&n.getID&&n.getID()?n:this.actEngItem,!this.fPNode)throw new Error("wrong state, expected fPNode not to be null");const i=this.buildAllUsagesOf(this.slctdNode,this.fPNode);if(!Array.isArray(i))throw new Error("wrong state, expected usages not to be null");await this.buildViewModel(i),this.buildView()}catch(e){this.error=e}finally{e&&e()}}abort(e){this.close(e)}close(e){if(this.modal&&this.modal.close(),this.sessionEventToken){const{mediator:e}=this.options.appCore;e&&e.unsubscribe(this.sessionEventToken)}if(this.sessionEventToken=null,this.sessionEventAsBulkToken){const{mediator:e}=this.options.appCore;e&&e.unsubscribe(this.sessionEventAsBulkToken)}this.sessionEventAsBulkToken=null,this.chgQtView&&this.chgQtView.destroy(),this.chgQtView=null,this.modal&&this.modal.destroy(),this.modal=null,e&&e()}async buildViewModel(e){const{appCore:t}=this.options;if(!t||!Array.isArray(e))throw new Error("Invalid input");try{this.chgQtModel=r.create({appCore:t,referenceNode:this.slctdNode,usages:e,context:{parentNode:this.fPNode,parentId:this.fPNode.getID(),activeNode:this.actEngItem,activeId:this.actEngItem.getID()}})}catch(e){throw new Error("failed to instanciate model")}if(!this.chgQtModel)throw new Error("failed to instanciate model");const{mediator:n}=this.options.appCore;if(n){this.sessionEventToken=n.subscribe(this.chgQtModel.updateSessionEvent,this.onSessionModelUpdate.bind(this));const e=`${this.chgQtModel.updateSessionEvent}AsBulk`;this.sessionEventAsBulkToken=n.subscribe(e,this.onSessionModelAsBulkUpdate.bind(this))}let i=null;try{i=await this.chgQtModel.fetchModelAttached()}catch(e){console.error("fails to retreive config information")}return i}buildView(){if(!this.chgQtModel)throw new Error("Invalid input");this.chgQtView=new i({chgQtModel:this.chgQtModel})}instanciateTab(){return new n({displayStyle:"strip"})}buildTabView(){const t=e.createElement("div",{class:"xapp-change-quantity-body-container"});try{this.chgQtView.buildView()}catch(e){throw new Error("should have a view built")}const n=this.chgQtView.content;if(!n)throw new Error("should have a view built");return this.chgQtTab=this.instanciateTab(),this.chgQtTab.inject(t),this.chgQtTab.addEventListener("change",this.onTabChange.bind(this)),this.chgQtTab.add({label:c,content:n}),this.chgQtTab.add({label:d,content:n}),t}onTabChange(e){if(!e.srcElement.hasClassName("wux-controls-tab"))return;const[t]=e.dsModel.value;let n=null;switch(t){case 0:n=E.onEditQtyTab;break;case 1:n=E.onQtyByModelTab}n&&this.publish({event:n})}instanciateDialog(e){return new o(e)}buildModalView(e){const t=this.options.appCore.moduleHelper.viewsService.getApplicationImmersiveFrame(),n=this.getModalTitle(),i=this.buildTabView();this.modal=this.instanciateDialog({title:n,content:i,immersiveFrame:t,closeButtonFlag:!1,usePaddingFlag:!1,resizableFlag:!1,modalFlag:!0,width:900,buttons:{Ok:new s({label:u,disabled:!0,onClick:this.onOkButton.bind(this)}),Cancel:new s({label:p,onClick:this.onCancelButton.bind(this)})}}),this.modal.show(),e&&e()}buildConfirmationModalView(){const t=this.options.appCore.moduleHelper.viewsService.getApplicationImmersiveFrame(),n=new e.Element("div",{styles:{height:"auto",position:"relative",padding:"5px"},html:`<p>${f}</p>`}),i=new o({title:m,content:n,immersiveFrame:t,closeButtonFlag:!1,modalFlag:!0,buttons:{Yes:new s({label:g,onClick:()=>{i.close(),this.onOkButton()}}),No:new s({label:h,onClick:()=>{i.close(),this.onCancelButton()}}),Cancel:new s({label:p,onClick:()=>{this.removeFromWidgetRefreh("modal"),i.close(),this.onAbortButton()}})}});this.addToWidgetRefresh("modal",i.close.bind(i)),i.show()}onOkButton(){this.publish({event:E.onOKBtn})}onCancelButton(){this.publish({event:E.onCancelBtn})}onAbortButton(){this.publish({event:E.onAbortBtn})}getModalTitle(){if(!this.slctdNode||!this.chgQtModel)throw new Error("Invalid input");const{sessionManager:e}=this.options.appCore,t=this.chgQtModel.getRollup(this.chgQtModel.nodes),n=this.slctdNode.getDisplayName(),i=e.shouldShowLeafMaterials()||e.shouldShowFinalItems()?this.options.appCore.i18nManager.get("occurences"):this.options.appCore.i18nManager.get("instances");return this.options.appCore.i18nManager.get("eng.ui.dialog.changeQuantity").replace("{title}",i).replace("{engItem}",n).replace("{mat}",t)}activateEditQuantityState(e){this.chgQtTab.value=[0],e&&e()}onEnterEditQuantityState(){this.chgQtView.editModeEnable()}onExitEditQuantityState(){this.chgQtView.editModeDisable()}onEnterQtyByModelState(){this.chgQtView.browseModelEffectivitiesEnable()}onExitQtyByModelState(){this.chgQtView.browseModelEffectivitiesDisable()}onAskForValidate(e){this.buildConfirmationModalView(),e&&e()}onValidate(e){this.performChangesAtEnd=!0,e&&e()}executeChanges(){const e=this.chgQtModel.getModificationsResult();e&&this.chgQtModel.executeChangeQuantity(e)}buildAllUsagesOf(e,t){const n=[];if(e instanceof a.getListInstanceClass())this.actEngItem.getContentModels().buildReferenceList(e,t).forEach(e=>{const t={...e.options};t.children&&delete t.children;const{grid:i}=t;t.grid=i?{...i}:{};const r=a.createListNode(t);r.options=t,n.push(r)});else if(e.isRawMaterialType&&e.isRawMaterialType()){const t=e.options.grid.quantity,i=[],r=[],{sessionManager:o}=this.options.appCore,s=!!o&&o.shouldShowLeafMaterials();t.forEach(t=>{if(s&&!t.isDirectRawMatConsumption()){t.getParentIdFromOccrencePath();const n=t.getParentOccurrencePath(),i=(e.getParentOccurences()||[]).filter(e=>{const t=e.getOccurrencePath();return Array.isArray(t)&&t.length&&t.join(",").startsWith(n.join(","))});r.push(...i)}else i.push(t)});const a=[];i.length&&a.push(...i),r.length&&a.push(...r),this.getNodesFromQuantity(a,n)}else this.getNodesFromQuantity(e.options.grid.quantity,n);return n}getNodesFromQuantity(e,t){return e&&e.forEach(e=>{if(!e)return;const n=a.createListNode(e.options),{options:i}=e;n.options=i?{...i}:{};const{grid:r}=n.options;n.options.grid=r?{...r}:{},t.push(n)}),t}enableModalOKButton(e){this.modal.buttons.Ok.disabled=!e}onSessionModelUpdate(e){this.enableModalOKButton(this.chgQtModel.hasModifiedNode()),this.chgQtView.update(e),this.updateDialogTitle()}updateDialogTitle(){const e=this.getModalTitle();this.modal.title=e}onSessionModelAsBulkUpdate(e){const{createAsBulk:t}=e||{};this.enableModalOKButton("number"==typeof t&&t>0),this.chgQtView.update(e)}onWidgetRefresh(){this.onRefreshEventFctToBeCalled&&Reflect.ownKeys(this.onRefreshEventFctToBeCalled).forEach(e=>this.onRefreshEventFctToBeCalled[e]()),this.onCancelButton()}addToWidgetRefresh(e,t){if("string"==typeof e&&""!==e.trim()&&"function"==typeof t){if(this.onRefreshEventFctToBeCalled){if(-1!==Reflect.ownKeys(this.onRefreshEventFctToBeCalled).findIndex(t=>t===e))return}else this.onRefreshEventFctToBeCalled={};this.onRefreshEventFctToBeCalled[e]=t}}removeFromWidgetRefreh(e){"string"==typeof e&&""!==e.trim()&&this.onRefreshEventFctToBeCalled&&-1!==Reflect.ownKeys(this.onRefreshEventFctToBeCalled).findIndex(t=>t===e)&&delete this.onRefreshEventFctToBeCalled[e]}}}),define("DS/ENOXEngineer/commands/ENOXImportItemUX",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/Handlebars/Handlebars4","DS/ENOXEngineer/componentsHelpers/commandModal/XEngineerModal","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/UIKIT/Input/Text","DS/Controls/LineEditor","DS/Controls/Button","DS/DataGridView/DataGridView","DS/WAFData/WAFData","DS/WebappsUtils/WebappsUtils","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/services/EngineeringSettings","DS/ENOXEngineer/services/ImportService","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/TreeModel/DataModelSet","DS/Controls/ComboBox","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Controls/Toggle","text!DS/ENOXEngineer/componentsHelpers/xEngImport/html/ImportEngineeringItems.html","css!DS/ENOXEngineer/componentsHelpers/xEngImport/css/ImportEngineeringItems.css"],function(e,t,n,i,r,o,s,a,l,c,d,u,p,g,h,m,f,E,C,_,y){"use strict";var N,M,A="div",I=7,v="</br>",S=[".csv",".xls",".xlsx"],b={},D=0;function T(){var e={importfiledownloadtemplate:!0,importfilechooser:!0};this.appCore=M.options.appCore?M.context._app.core:M._ctx._app.core,this.i18nManager=M.options.appCore&&M.options.appCore.i18nManager?M.context._app.core.i18nManager:M._ctx._app.core.i18nManager,this.modalOptions={title:this.i18nManager.get("eng.import.label"),className:"enox-import-dialog",withFooter:!1},this.modal=new n(this.modalOptions),this.modal.injectFooter(this.getFooter());var i=t.compile(y);this._options=e?UWA.clone(e,!1):{},this._container=this.modal.getBody(),this._container.innerHTML=i(this._options),this._container=this._container.querySelector(".enox-import"),this._importFileTemplateDownload=this._container.querySelector(".enox-import-template-download"),this._importFileChooserLabel=this._container.querySelector(".enox-import-file-chooser-label"),this._importFileChooser=this._container.querySelector(".enox-import-file-chooser-browser"),this._importFileManageHeader=this._container.querySelector(".enox-import-file-chooser-manageheader"),this._importFileValidationImageIndicator=this._container.querySelector(".enox-import-file-imageindicator"),this._importFileValidationResultDescriptions=this._container.querySelector(".enox-import-file-validationdescriptions"),this.createImportTemplateDownloadLink(),this.createImportFileChooser(),this.loaderVisualCue="",this.createOnClickEventForImport(),this.createOnClickEventForCancelButton(),this.createOnClickEventForCloseButton(),this.userMappedColumnHeadersColumns={}}function w(){b={}}return T.prototype.getImageSource=function(e){return'<img src="'+d.getWebappsAssetUrl("ENOXEngineer","icons/32/"+e+".png")+'">'},T.prototype.getSucessIcon=function(){return this.getImageSource("I_Right")},T.prototype.getWarningIcon=function(){return this.getImageSource("I_Warning")},T.prototype.getErrorIcon=function(){return this.getImageSource("I_Error")},T.prototype.getDownloadIcon=function(){return this.getImageSource("I_DownloadDocument")},T.prototype.getBlockedIcon=function(){return'<span class="fonticon fonticon-block" title="'+N.i18nManager.get("eng.import.CkeckboxImageTooltip")+'"></span>'},T.prototype.setValidationResults=function(e){this.jsonImportValidationResults=e},T.prototype.getContextPhysicalId=function(){return this.appCore.contextManager.getActiveEngItem()?this.appCore.contextManager.getActiveEngItem().getID():null},T.prototype.isOperationPerformedFromContextItem=function(){return null!=N.getContextPhysicalId()},T.prototype.getIgnoreColumnsArray=function(){return this.splitData(this.getValue("IgnoreColumnList"))},T.prototype.clearTransactionCachedInfo=function(e){this.jsonImportValidationResults=null,N.clearUserMappedColumnCache()},T.prototype.displayValidationResultsOnUX=function(e){e.ColumnHeadersDefined&&"No"===e.ColumnHeadersDefined||this.displayManageHeaderLink(),this.isValidation_Success()?(N.enableImportButton(),this.displayActionSummaryReport()):(N.disableImportButton(),N.isUnMappedColumnExists()||N.isMandatoryColumnMissing()?(this.displayImageIndicator_Error(),UWA.Event.dispatchEvent(this._importFileManageHeader,"click"),this.displayUnMappedUserMessage()):this.displayReportedError())},T.prototype.isMandatoryColumnMissing=function(){return this.containsKey("MandColumnsMissing")},T.prototype.getAllMandatoryColumns=function(){for(var e=this.getValue("MandColumns"),t={},n=0;n<e.length;n++)t[e[n]]=e[n];return e},T.prototype.getMissingMandatoryColumns=function(){if(this.isMandatoryColumnMissing()){for(var e=this.splitData(this.getValue("MandColumnsMissing")),t=this.getAllMandatoryColumns(),n={},i=0;i<e.length;i++)n[e[i]]=t[e[i]];return n}return{}},T.prototype.getMissingMandatoryColumnsDisplayValues=function(){return this.getAllValuesFromJson(this.getMissingMandatoryColumns())},T.prototype.getAllValuesFromJson=function(e){var t=[],n=0;for(var i in e)t[n++]=e[i];return t},T.prototype.getAllKeysFromJson=function(e){var t=[],n=0;for(var i in e)t[n++]=i;return t},T.prototype.splitData=function(e){return e.split(this.getValue("ImportDataSeparator"))},T.prototype.getMappedSpreadsheetColumns=function(){return this.jsonImportValidationResults.MappedSpreadSheetColumns},T.prototype.getUnMappedSpreadsheetColumns=function(){var e=[];return this.containsKey("UnmappedSpreadsheetColumns")&&(e=this.splitData(this.getValue("UnmappedSpreadsheetColumns"))),e},T.prototype.isUnMappedColumnExists=function(){return this.getUnMappedSpreadsheetColumns().length>0},T.prototype.getBasicsList=function(){return this.getValue("ObjectBasics")},T.prototype.getObjectAttributeList=function(){return this.getValue("TypeAttributes")},T.prototype.getRelationShipAttributeList=function(){return this.getValue("RelationshipAttributes")},T.prototype.isValidation_Success=function(){return"Success"==this.getValue("Action")},T.prototype.isValidation_Error=function(){return"Error"==this.getValue("Action")},T.prototype.getContentErrorReports=function(){return this.jsonImportValidationResults.ReportedErrors},T.prototype.isContains=function(e,t){for(var n=!1,i=0;i<e.length;i++)if(e[i]==t){n=!0;break}return n},T.prototype.isRootItemCreate=function(){return parseInt(this.getValue("COUNT_ROOTITEM"))>0},T.prototype.getCount_AddNewInstances=function(){return parseInt(this.getValue("COUNT_ADDNEWINSTANCE"))+parseInt(this.getValue("COUNT_ADDEXISTINGINSTANCE"))},T.prototype.getCount_AddNewReference=function(){return parseInt(this.getValue("COUNT_ADDNEWREFRENCE"))},T.prototype.getCount_AddExistingInstances=function(){return parseInt(this.getValue("COUNT_ADDEXISTINGINSTANCE"))},T.prototype.getCount_Modify=function(){return parseInt(this.getValue("COUNT_MODIFY"))},T.prototype.getCount_Remove=function(){return parseInt(this.getValue("COUNT_REMOVE"))},T.prototype.containsKey=function(e){return this.jsonImportValidationResults.hasOwnProperty(e)},T.prototype.getValue=function(e){return this.containsKey(e)?this.jsonImportValidationResults[e]:""},T.prototype.displayImageIndicator_Error=function(){this.displayImageIndicator(this.getErrorIcon()),this._importFileValidationImageIndicator.removeAttribute("id")},T.prototype.displayImageIndicator_Success=function(){this.displayImageIndicator(this.getSucessIcon()),this._importFileValidationImageIndicator.setAttribute("id","success_image_indicator")},T.prototype.displayImageIndicator=function(e){this._importFileValidationImageIndicator.innerHTML=e},T.prototype.setValidationMessage=function(e){this._importFileValidationResultDescriptions.innerHTML=e},T.prototype.displayReportedError=function(){this.displayImageIndicator_Error();var e=this.getValue("ErrorMessage");""==e?(e='<span class="enox-import-text-underline">'+this.getValue("ErrorCount")+" "+N.i18nManager.get("eng.import.summary.contenterrorexists")+"</span>",this.createOnClickEventForErrorReports()):e='<span class="enox-import-redtext">'+e+"</span>";this.setValidationMessage(e)},T.prototype.displayManageHeaderLink=function(){this._importFileManageHeader.innerHTML='<span class"enox-import-text-underline">'+N.i18nManager.get("eng.import.label.managecolumnnames")+"</span>",this.createOnClickEventForManageHeaderName()},T.prototype.getElementId=function(e){return e.replace(" ","_")+"_ID"},T.prototype.createLoaderVisualCue=function(){return""==N.loaderVisualCue&&(N.loaderVisualCue=UWA.createElement(A),N.loaderVisualCue.className="enox-import-file-loader"),N.loaderVisualCue},T.prototype.showLoaderVisualCue=function(e){var t=N.createLoaderVisualCue();N.clearMessagesDisplayedOnUX(),N._importFileValidationResultDescriptions.innerHTML='<span class="enox-import-blackBoldtext">'+function(e){var t="";"Author"==e?t=N.i18nManager.get("eng.import.VisualCueAuthoringMessage")+"...":"Validate"==e&&(t=N.i18nManager.get("eng.import.VisualCueValidateMessage")+"...");return t}(e)+"</span>",N._importFileValidationImageIndicator.appendChild(t)},T.prototype.clearMessagesDisplayedOnUX=function(){N._importFileValidationImageIndicator.innerHTML="",N._importFileValidationResultDescriptions.innerHTML="",N._importFileManageHeader.innerHTML=""},T.prototype.hideLoaderVisualCue=function(){N._importFileValidationImageIndicator.innerHTML="",N._importFileValidationResultDescriptions.innerHTML=""},T.prototype.getCountMessage=function(e,t){return'<span class="enox-import-greentext">'+(this.getCount_Modify()>0?"&nbsp;":"")+t+" "+e+"</span>"},T.prototype.displayActionSummaryReport=function(){this.displayImageIndicator_Success();var e="";if(this.isRootItemCreate()?e='<span class="enox-import-greentext">'+N.i18nManager.get("eng.import.summary.rootitemcreate")+"</span>":0==this.getCount_AddNewReference()&&0==this.getCount_AddNewInstances()&&0==this.getCount_Modify()?(this.displayImageIndicator(this.getWarningIcon()),e='<span class="enox-import-graytext">&nbsp;'+N.i18nManager.get("eng.import.summary.noItemModification")+"</span>",this.disableImportButton()):e='<span class="enox-import-greentext">&nbsp;'+N.i18nManager.get("eng.import.summary.rootitemupdate")+"</span>",this.getCount_AddNewReference()>0){var t=1==this.getCount_AddNewReference()?"eng.import.summary.addsinglenewitem":"eng.import.summary.addmultiplenewitems";""!=e&&(e+=v),e+=this.getCountMessage(N.i18nManager.get(t),this.getCount_AddNewReference())}if(this.getCount_AddNewInstances()>0){t=1==this.getCount_AddNewInstances()?"eng.import.summary.addsinglenewinstances":"eng.import.summary.addmultiplenewinstances";""!=e&&(e+=v),e+=this.getCountMessage(N.i18nManager.get(t),this.getCount_AddNewInstances())}if(this.getCount_Modify()>0){t=1==this.getCount_Modify()?"eng.import.summary.existingitemmodify":"eng.import.summary.existingitemsmodify";""!=e&&(e+=v),e+=this.getWarningIcon()+' <span class="enox-import-orangetext">'+this.getCount_Modify()+" "+N.i18nManager.get(t)+"</span>"}this.setValidationMessage(e)},T.prototype.getFooter=function(){return"<button type='button' disabled='true' id='import-button' class='btn btn-primary'>"+this.i18nManager.get("eng.ui.button.import")+"</button><button type='button' id='cancel-button' class='btn btn-default'>"+this.i18nManager.get("eng.ui.button.cancel")+"</button>"},T.prototype.downloadTemplateFile=function(){var e="Level,Title,Type,Name,Revision,Description,Enterprise Item Number";e+=",Title (Instance)",this.appCore.exportService.downloadFile("Create from Spreadsheet Template",e,".csv",!1)},T.prototype.mergeExportColumnAndAttributesInfo=function(e){for(var t=this.appCore.dicoService.getAvailableAttributesByType([u.TYPE_VPMREFERENCE]),n=["identifier","type","revision"],i=0;i<t.length;i++){var r=t[i].sixWTag.replace("ds6w:","").replace("ds6wg:","");N.isContains(n,r)||(e[t[i].attrNls]=r)}return e},T.prototype.createOnClickEventForTemplateDownload=function(){var e=this;this._importFileTemplateDownload.onclick=function(){e.downloadTemplateFile()}},T.prototype.createImportTemplateDownloadLink=function(){this._importFileTemplateDownload.innerHTML=this.getDownloadIcon()+"&nbsp;"+this.i18nManager.get("eng.ui.import.downloadtemplate"),this.createOnClickEventForTemplateDownload()},T.prototype.createImportFileChooser=function(){this._importFileChooserLabel.innerHTML=" "+this.i18nManager.get("eng.ui.import.filechooserlabel"),this._importFileChooserElement=new UWA.Controls.Input.File({attributes:{id:"import_CSV_File",title:this.i18nManager.get("eng.import.nofileChosen.tooltip")},events:{onChange:function(){N._importFileValidationImageIndicator.removeAttribute("id","success_image_indicator");var e=N.modal.getContent().getElement(".uwa-file").getChildren()[0].files[0];N.clearUserMappedColumnCache(),null==e?(N.clearMessagesDisplayedOnUX(),N._importFileChooserElement.elements.input.title=N.i18nManager.get("eng.import.nofileChosen.tooltip")):(N._importFileChooserElement.elements.input.title=e.name,N.isSupportedFileFormat(e)?N.doServerCall("Validate"):(N.displayImageIndicator_Error(),N.setValidationMessage('<span class="enox-import-redtext">'+N.i18nManager.get("eng.ui.alert.file.type")+"</span>"),N.clearTransactionCachedInfo(),N._importFileManageHeader.innerHTML="",N.disableImportButton()))}}}).inject(this._importFileChooser)},T.prototype.doServerCall=function(e){var t=N.modal.getContent().getElement(".uwa-file").getChildren()[0].files[0];N.showLoaderVisualCue(e);var n={};n.operation=e,n.ContextEntityPhysicalId=N.getContextPhysicalId();var i=N.getUserIgnoreColumnsFromManageHeaders();n.IgnoreColumnList=i,n.userMappedColumns=N.getUserMappedColumnValuesFromManageHeaders(),g.getResults(t,n).then(function(t){if(N.hideLoaderVisualCue(),t.error)N.clearTransactionCachedInfo(),N.displayUnExpectedErrors(t);else{var n=JSON.parse(t);n.IgnoreColumnList=i,"Validate"==e?("Error"==n.Action&&(N.clearTransactionCachedInfo(),N._importFileValidationResultDescriptions.innerHTML='<span class="enox-import-redtext">'+n.ErrorMessage+"</span>"),N.setValidationResults(n),N.displayValidationResultsOnUX(n)):(N.clearTransactionCachedInfo(),N.refreshOnSuccess(n))}})},T.prototype.displayUnExpectedErrors=function(e){this.displayImageIndicator_Error();let t=e.response;e&&e.type&&e.type===u.ERROR_TYPE_TIMEOUT&&(t=this.appCore.i18nManager.get("eng.generic.timedout.message.operationFailed"));var n='<span class="enox-import-redtext">'+t+"</span>";this.setValidationMessage(n),this.enableCancelButton()},T.prototype.enableManageHeaderOkButton=function(e){document.querySelector("#manageHeaderOkButton").dsModel.disabled=!e},T.prototype.createOnClickEventForManageHeaderName=function(){var e=this;this._importFileManageHeader.onclick=function(){var t=function(){var e=N.getAllMandatoryColumns(),t=UWA.createElement(A);t.className="enox-import-columncontainer";var n=UWA.createElement(A);n.className="enox-import-importColumnContainerForInfo";var i=UWA.createElement(A);i.className="importColumnContainerForErrorMessage";var r=UWA.createElement(A);r.className="importMandColumnMissingContainerForErrorMessage";var o=UWA.createElement(A);o.id="enox-import-columns_container_list",n.innerHTML=N.getManageHeaderNotes()+v,t.appendChild(i),t.appendChild(r),t.appendChild(o);var s=UWA.createElement(A);s.id="columns_with_import_list",s.className="enox-import-columnsHeaderForImport";var a=UWA.createElement(A);a.className="enox-import-column-checkbox",a.innerHTML="",s.appendChild(a);var l=UWA.createElement(A);l.className="enox-import-listitem_header_name",s.appendChild(l);var c=UWA.createElement(A);c.className="enox-import-listitem_custom_name",s.appendChild(c),l.innerHTML="<b>"+N.i18nManager.get("eng.import.manageheader.spreadsheetcolumn")+"</b>",c.innerHTML="<b>"+N.i18nManager.get("eng.import.manageheader.schemaname")+"</b>",o.appendChild(s);var d=UWA.createElement(A);d.className="enox-import-divTagForAllColumns",o.appendChild(d);var u=N.getMappedSpreadsheetColumns(),p=N.getUnMappedSpreadsheetColumns(),g=N.getUserMappedColumnsCBoxFromManageHeaders();for(var h in N.clearUserMappedColumnCache(),w(),u){var m=UWA.createElement(A);m.className="columns",Object.keys(u).length>I?d.style.overflowY="scroll":m.style.borderRight="1px solid #ccc";var E=UWA.createElement(A);E.className="enox-import-columnmapping-checkbox";var C=UWA.createElement(A);C.className="enox-import-listitem_header_name hover_info",C.innerHTML=u[h];var y=UWA.createElement(A);y.className="enox-import-listitem_custom_name display_text enable_textbox";var M={elementsTree:N.populateComboboxContents(),enableSearchFlag:!0,domId:N.getElementId(h)},S=!0;if(g.hasOwnProperty(u[h])){var D=g[u[h]];null!=D.value?M.value=D.value:S=!1}else N.isContains(p,u[h])||N.isContains(N.getIgnoreColumnsArray(),u[h])?S=!1:N.isContains(p,u[h])||(M.value=h);var T=new _({type:"checkbox",checkFlag:S,value:u[h]}),O=new f(M);O.addEventListener("change",function(e){N.validateUserMappedColumns(e)}),O.addEventListener("preDropdown",function(e){N.hideAlreadyMappedValues()}),N.userMappedColumnHeadersColumns[u[h]]=O,N.userMappedColumnHeadersColumns[u[h]+"_CheckBox"]=T,b[u[h]]=O.value,e.hasOwnProperty(h)?(O.disabled=!0,E.innerHTML=N.getBlockedIcon()):T.inject(E),O.inject(y),d.appendChild(m),m.appendChild(E),m.appendChild(C),m.appendChild(y),o.appendChild(d)}return t}(),n=new r;n.inject(N.modal.modal.elements.container),e.manageHeaderDialogbox=new i({title:N.i18nManager.get("eng.import.ManageHeaderDialogboxTitle"),content:t,width:536,height:350,position:{at:"top center",my:"center"},immersiveFrame:n,resizableFlag:!0,buttons:{Cancel:new a({label:e.i18nManager.get("eng.ui.button.cancel"),domId:"manageHeaderCancelButton",onClick:function(e){N.restorePreviousHeaderValuesOnCancel(),N.manageHeaderDialogbox.immersiveFrame.getModel().elements.container.destroy()}}),Ok:new a({label:e.i18nManager.get("eng.ui.button.ok"),domId:"manageHeaderOkButton",onClick:function(e){w(),N.doServerCall("Validate"),N.manageHeaderDialogbox.immersiveFrame.getModel().elements.container.destroy()}})}}),N.manageHeaderDialogbox.addEventListener("close",function(e){N.restorePreviousHeaderValuesOnCancel(),N.manageHeaderDialogbox.immersiveFrame.getModel().elements.container.destroy()}),N.manageHeaderDialogbox.getContent().getElements(".enox-import-columnmapping-checkbox").forEach(function(e){e.addEvent("click",function(t){var n=e.children[0].dsModel.value,i=N.userMappedColumnHeadersColumns[n];e.children[0].dsModel.checkFlag||(i.value=void 0),N.validateUserMappedColumns(null)})}),N.displayUnMappedUserMessage(),N.displayMandColumnsMissingErrorMessageonUX(N.getMissingMandatoryColumnsDisplayValues())}},T.prototype.createOnClickEventForErrorReports=function(){this._importFileValidationResultDescriptions.onclick=function(){N.createDataGridErrorContentReports()}},T.prototype.getContentErrorNotes=function(){return this.i18nManager.get("eng.import.error.ContentErrorNotes")},T.prototype.restorePreviousHeaderValuesOnCancel=function(){var e=b,t=N.getUserMappedColumnsCBoxFromManageHeaders();for(var n in t)n.indexOf("_CheckBox")>-1||(t[n].value=e[n]);w()},T.prototype.createOnClickEventForCancelButton=function(){var e=this;document.getElementById("cancel-button").onclick=function(){N.clearTransactionCachedInfo(),e.modal.destroy()}},T.prototype.createOnClickEventForCloseButton=function(){var e=this,t=document.getElementsByClassName("close fonticon fonticon-cancel");null!=t&&(t[0].onclick=function(){N.clearTransactionCachedInfo(),e.modal.destroy()})},T.prototype.createDataGridErrorContentReports=function(){var e=[{text:N.i18nManager.get("eng.import.contenterrorreport.rownumber"),dataIndex:"RowNumber"},{text:N.i18nManager.get("eng.import.contenterrorreport.errordescription"),dataIndex:"Error Description"},{text:N.i18nManager.get("eng.import.contenterrorreport.columnname"),dataIndex:"Column Name"},{text:N.i18nManager.get("eng.import.contenterrorreport.columnvalue"),dataIndex:"Column Value"}],t=new m,n=new E({dataModelSet:t});n.prepareUpdate();for(var o=N.getContentErrorReports(),s=0,c=o.length;s<c;s++){var d=o[s],u=C.createTreeNodeDataModel(t,{label:d.text,grid:d});n.addChild(u)}n.expandAll(),n.pushUpdate();var p=UWA.createElement(A);p.className="enox-import-dialogboxContent";var g=document.createElement(A);g.className="dialogboxHeaderContent";var h=document.createElement(A);h.className="enox-import-dialogboxBodyContent";new l({treeDocument:n,columns:e,defaultColumnDef:{width:"auto",typeRepresentation:"string"}}).inject(h);var f=new r;f.inject(N.modal.modal.elements.container),g.innerHTML=N.getContentErrorNotes(),p.appendChild(g),p.appendChild(h);var _=new i({title:N.i18nManager.get("eng.import.validateImportTitle"),content:p,immersiveFrame:f,resizableFlag:!0,position:{at:"top center",my:"center"},buttons:{Cancel:new a({label:N.i18nManager.get("eng.ui.button.cancel"),onClick:function(e){_.immersiveFrame.getModel().elements.container.destroy()}})}});_.addEventListener("close",function(e){_.immersiveFrame.getModel().elements.container.destroy()})},T.prototype.enableImportButton=function(){document.getElementById("import-button").disabled=!1},T.prototype.disableImportButton=function(){document.getElementById("import-button").disabled=!0},T.prototype.disableCancelButton=function(){document.getElementById("cancel-button").disabled=!0},T.prototype.enableCancelButton=function(){document.getElementById("cancel-button").disabled=!1},T.prototype.getRootPhysicalId=function(e){return e.ROOT_PHYSICALID},T.prototype.refreshOnSuccess=function(e){N.modal.destroy(),this.appCore.sessionManager.setAuthoringMode("authoring"),N.appCore.mediator.publish(u.EVENT_LAUNCH_COMMAND,{commandId:u.OPEN_ENG_ITEM,context:{item:{objectId:N.getRootPhysicalId(e),objectType:u.TYPE_VPMREFERENCE}}})},T.prototype.createOnClickEventForImport=function(){document.getElementById("import-button").onclick=function(){N.disableImportButton(),N.disableCancelButton(),N.doServerCall("Author")}},T.prototype.getUserMappedColumnValuesFromManageHeaders=function(){var e=N.getUserMappedColumnsCBoxFromManageHeaders(),t={};for(var n in e)if(!(n.indexOf("_CheckBox")>-1)){var i=e[n];null!=i.value&&(t[n]=i.value)}return t},T.prototype.getUserIgnoreColumnsFromManageHeaders=function(){var e=N.getUserMappedColumnsCBoxFromManageHeaders(),t="";for(var n in e){if(!(n.indexOf("_CheckBox")>-1))null==e[n].value&&(t=""==t?n:t+"|@|"+n)}return t},T.prototype.clearUserMappedColumnCache=function(){this.userMappedColumnHeadersColumns={}},T.prototype.getUserMappedColumnsCBoxFromManageHeaders=function(){return this.userMappedColumnHeadersColumns},T.prototype.getUnMappedIgnoredSpreadsheetColumns=function(){var e;return this.containsKey("IgnoreColumnList")&&(1==(e=this.splitData(this.getValue("IgnoreColumnList"))).length&&""==e[0]||null==e[0])&&(e=[]),e},T.prototype.displayUnMappedUserMessage=function(){var e=1==N.getUnMappedSpreadsheetColumns().length?"eng.import.summary.unmappedcolumnexists":"eng.import.summary.unmappedcolumnsexists";if(N.getUnMappedSpreadsheetColumns().length>0||N.getUnMappedIgnoredSpreadsheetColumns().length>0){var t=N.getUnMappedSpreadsheetColumns().length>0?N.getUnMappedSpreadsheetColumns().length:N.getUnMappedIgnoredSpreadsheetColumns().length;document.getElementsByClassName("importColumnContainerForErrorMessage")[0].innerHTML="<span>"+N.i18nManager.get(e).replace("{1}","<b>"+t+"</b>")+"</span>"}else document.getElementsByClassName("importColumnContainerForErrorMessage")[0].innerHTML="<span>"+N.i18nManager.get("eng.import.summary.allmappedcolumnexists")+"</span>"},T.prototype.displayUnMappedUserMessageOnUserSelection=function(e){document.getElementsByClassName("importColumnContainerForErrorMessage")[0].innerHTML=e>0?"<span>"+N.i18nManager.get("eng.import.summary.unmappedcolumnexists").replace("{1}","<b>"+e+"</b>")+"</span>":"<span>"+N.i18nManager.get("eng.import.summary.allmappedcolumnexists")+"</span>"},T.prototype.displayMandColumnsMissingErrorMessageonUX=function(e){if(e.length>0){N.enableManageHeaderOkButton(!1);var t=N.i18nManager.get("eng.import.manageheader.mandcolumnsmissing");t=t.replace("$1",e),document.getElementsByClassName("importMandColumnMissingContainerForErrorMessage")[0].innerHTML='<span class="enox-import-redtext">'+t+"</span>"}else N.enableManageHeaderOkButton(!0),document.getElementsByClassName("importMandColumnMissingContainerForErrorMessage")[0].innerHTML='<span class="enox-import-greentext">'+N.i18nManager.get("eng.import.manageheader.allmandattributesmapped")+"</span>"},T.prototype.clearManageHeaderSameAttributeErrorMessage=function(){document.getElementsByClassName("importColumnContainerForErrorMessage")[0].innerHTML=""},T.prototype.isSupportedFileFormat=function(e){for(var t=!1,n=e.name,i=0;i<S.length;i++)if(n.endsWith(S[i])){t=!0;break}return t},T.prototype.hideAlreadyMappedValues=function(){var e=N.getAllValuesFromJson(N.getUserMappedColumnValuesFromManageHeaders()),t=N.getUserMappedColumnsCBoxFromManageHeaders();for(var n in t)for(var i=t[n],r=i._allDescendants&&i._allDescendants.length?i._allDescendants.length:0,o=0;o<r-1;o++){i._allDescendants[o].getLabel();var s=i._allDescendants[o].options.grid.valueItem;N.isContains(e,s)?i._allDescendants[o].hide():i._allDescendants[o].show()}},T.prototype.validateUserMappedColumns=function(e){var t=N.getUserMappedColumnsCBoxFromManageHeaders();0==D&&N.clearManageHeaderSameAttributeErrorMessage(),D+=1;var n=null==e?"":e.dsModel.domId,i={},r=0,o=!1;for(var s in t)if(!(s.indexOf("_CheckBox")>-1)){var a=t[s],l=t[s+"_CheckBox"];if(null!=a.value){if(i.hasOwnProperty(a.value)){if(!1,o=!0,a.domId==n)a.value=void 0;else i[a.value].value=void 0;break}a.domId==n&&null!=a.value&&(l.checkFlag=!0),i[a.value]=a}else l.checkFlag&&!1,r+=1}N.displayMandColumnsMissingErrorMessageonUX(function(e){var t=N.getAllMandatoryColumns(),n=[],i=0;for(var r in t)e.hasOwnProperty(r)||(n[i++]=t[r]);return n}(i)),o||N.displayUnMappedUserMessageOnUserSelection(r),D=0},T.prototype.getManageHeaderNotes=function(){return N.i18nManager.get("eng.import.alert.manageheadernotes")},T.prototype.populateComboboxContents=function(){var e=new E({shouldBeSelected:function(e){return"section"!==e.options.comboBoxSemantics}});return e.addRoot(N.getObjectAttributes()),e.addRoot(N.getRelAttributes()),e.expandAll(),e},T.prototype.getObjectAttributes=function(){var e={labelItem:this.i18nManager.get("eng.import.objectAttributes"),valueItem:"TypeAttributes"},t=N.getBasicsList(),n=N.getObjectAttributeList();return N.updateListContents(t,n),N.addAttrToRootObject(e,t)},T.prototype.getRelAttributes=function(){var e={labelItem:this.i18nManager.get("eng.import.relationshipAttributes"),valueItem:"RelationshipAttributes"},t=N.getRelationShipAttributeList();return N.addAttrToRootObject(e,t)},T.prototype.updateListContents=function(e,t){for(var n in t)e[n]=t[n]},T.prototype.addAttrToRootObject=function(e,t){var n=new C({label:e.labelItem,value:e.valueItem,comboBoxSemantics:"section"});for(var i in t)n.addChild(new C({label:t[i],grid:{valueItem:i},useMatchingSearchFunction:!0,comboBoxSemantics:"subsection"}));return n},e.extend({init:function(e){e=UWA.extend(e,{isAsynchronous:!1}),this._parent(e)},execute:function(){return this.initializeENOXImportItemUX()},initializeENOXImportItemUX:function(e){return M=this,(N=new T).modal.show(),N}})}),define("DS/ENOXEngineer/services/ImportService",["UWA/Class","UWA/Core","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/XENHttpClient","DS/ENOXEngineer/utils/XEngineerConstants","DS/WAFData/WAFData","DS/ENOXEngineer/commands/ENOXImportItemUX","DS/ENOXEngineer/services/EngineeringSettings"],function(e,t,n,i,r,o,s,a){"use strict";return{getResults:function(e,t){var r=a.getCommand("importService");t.TimeoutConstraintsInMS=r.timeout;var o=new FormData;o.append("file",e),o.append("text",JSON.stringify(t));var s={data:o};return n.wrappedWithCancellablePromise(function(e,t){i.perform(r,s.data).then(function(t){return e(t)}).catch(function(t){return e(t)})})}}});