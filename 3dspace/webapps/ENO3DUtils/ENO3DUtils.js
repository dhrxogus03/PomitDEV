define("DS/ENO3DUtils/utils/ENO3DLandingPage",["DS/PADServices/views/LandingPage","DS/PADUtils/PADSettingsMgt"],function(e,t){"use strict";function n(t){e.call(this,t),this._ec=t.executionContext}return n.prototype=Object.create(e.prototype),n.prototype._buildDOM=function(){e.prototype._buildDOM.call(this)},n.prototype.setViewer=function(n,i){!0===t.getSetting("eno3dview_dom_viewer_outside_immersiveframe")&&e.prototype.setViewer.call(this,n,i),this.initDiv?this.initDiv.viewer=!0:this.initDiv={viewer:!0},t.getSetting("eno3dview_dom_viewer_outside_immersiveframe")||e.prototype.setViewer.call(this,n,i)},n}),define("DS/ENO3DUtils/ENO3DBaseComponent",["DS/WAfrUIStandardComponents/UIFrame"],function(e){"use strict";function t(e){this._DEBUG="true"===e.DEBUG,this._eventTokens=[],this._isComponentInitialized=!1}return t.prototype.destroyParent=function(){return new Promise(e=>{for(let e=0;e<this._eventTokens.length;++e)this._unsubscribe(this._eventTokens[e]);delete this._DEBUG,delete this._eventTokens,delete this._isComponentInitialized,e()})},t.prototype.getComponentFromIdentifier=function(e){try{return this.getExecutionContext().getComponent(e)}catch(e){return null}},t.prototype.getModelEvent=function(){return this.getComponentFromIdentifier(WAfrStandardComponentKey.ModelEvents)},t.prototype.getWafrUIFrame=function(){return this.getComponentFromIdentifier(e.DEFAULT_COMPONENT_NAME)},t.prototype.getWafrUIComponent=function(){return this.getComponentFromIdentifier(WAfrStandardComponentKey.UIComponent)},t.prototype.getCommandHandler=function(){return this.getComponentFromIdentifier(WAfrStandardComponentKey.HandlerComponent)},t.prototype.subscribe=function(e,t,n=!1){const i=this.getModelEvent().subscribe(e,t);return!0===n&&this._eventTokens.push(i),i},t.prototype.unsubscribe=function(e){const t=this.getModelEvent();t&&t.unsubscribe(e),this._eventTokens.filter((t,n,i)=>t===e&&(i.splice(n,1),!0))},t.prototype.publish=function(e){this.getModelEvent().publish(e)},t.prototype.loadText=function(e){return new Promise((t,n)=>{this.loadSource(`text!${e}`).then(t).catch(n)})},t.prototype.loadJSON=function(e){return new Promise((t,n)=>{this.loadSource(`text!${e}`).then(e=>t(JSON.parse(e))).catch(n)})},t.prototype.loadNls=function(e){return new Promise((t,n)=>{this.loadSource(`i18n!${e}`).then(t).catch(n)})},t.prototype.loadSource=function(e){return new Promise((t,n)=>{require([e],t,n)})},t.prototype.enableCmd=function(e){return this.getCommandHandler().enableHandler(e)},t.prototype.disableCmd=function(e){return this.getCommandHandler().disableHandler(e)},t.prototype.enableCheck=function(e){return this.getCommandHandler().enableCheck(e)},t.prototype.disableCheck=function(e){return this.getCommandHandler().disableCheck(e)},t.prototype._executeCommand=function(e){return this.getCommandHandler().executeHandler({id:e.handlerId,args:e.args}).then(t=>{t.getReturnValue&&"SUCCEEDED"!==t.getReturnValue().internalValue&&console.warn(a.getDescription(),a.getError(),a.getReturnValue(),e)}).catch(t=>{console.error(t,e)})},t}),define("DS/ENO3DUtils/mixins/ENO3DWidgetEventManager",["DS/PADUtils/PADSettingsMgt"],function(e){"use strict";function t(){}return t.prototype._initWidgetEvents=function(){return this._DEBUG&&console.log("ENO3DWidgetEventManager._initWidgetEvents called"),new Promise((t,n)=>{this.getModelEvent()?(widget.addEvent("onRefresh",this._onRefresh.bind(this)),widget.addEvent("onSearch",this._onSearch.bind(this)),widget.addEvent("endEdit",e.updateWidgetPreferences.bind(e)),widget.addEvent("endEdit",this._onEndEdit.bind(this)),widget.addEvent("onViewChange",function(e){}),t()):n("Empty or undefined model events")})},t.prototype._subscribeModelEvents=function(){return this._DEBUG&&console.log("ENO3DWidgetEventManager._subscribeModelEvents called"),new Promise((e,t)=>{this.getModelEvent()?(this.subscribe({event:"onRootAdded"},this._onRootAdded.bind(this)),this.subscribe({event:"onEndRootRemoved"},this._onEndRootRemoved.bind(this)),e()):t("Empty or undefined model events")})},t.prototype._onRefresh=function(e){this._DEBUG&&console.log("ENO3DWidgetEventManager._onRefresh called"),this.getViewer().refresh(e)},t.prototype._onSearch=function(e){this._DEBUG&&console.log("ENO3DWidgetEventManager._onSearch called"),this.getViewer().search({searchQuery:e})},t.prototype._onEndEdit=function(t){this._DEBUG&&console.log("ENO3DWidgetEventManager._onEndEdit called"),this.loadSource("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext").then(n=>{if(t&&!1===t.submitted){let t="top-right";t=sessionStorage.getItem("changeControlPosition3DNavigation")?sessionStorage.getItem("changeControlPosition3DNavigation"):e.getSetting("changeControlPosition"),!1===widget.getBool("changeControlActivation")?(n.hide(),widget.addPreference({name:"changeControlPosition",type:"hidden",defaultValue:t})):(n.show(),widget.addPreference({name:"changeControlPosition",defaultValue:t,type:"list",label:"changeControlPosition_label",options:[{label:"top-right_label",value:"top-right"},{label:"top-left_label",value:"top-left"},{label:"bottom-left_label",value:"bottom-left"},{label:"bottom-right_label",value:"bottom-right"}]}))}}).catch(e=>{console.error(e)})},t.prototype._onRootAdded=function(){this._DEBUG&&console.log("ENO3DWidgetEventManager._onRootAdded called"),this.updateTitle()},t.prototype._onEndRootRemoved=function(){this._DEBUG&&console.log("ENO3DWidgetEventManager._onEndRootRemoved called"),this.updateTitle()},t}),define("DS/ENO3DUtils/ENO3DContextMenuComponent",["DS/ENO3DUtils/ENO3DBaseComponent","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/PADUtils/PADSettingsMgt","DS/WebappsUtils/WebappsUtils","DS/Selection/CSOManager"],function(e,t,n,i,o){"use strict";function r(t){e.call(this,t),this._identifiers={view:t.viewIdentifier},this._contextConfigPath=t.ctxOptions,this._nlsAMDPath=t.nlsAMDPath,this._contextConfig=[],this._nls=null,this._nlsAMDPromises=[],this._wafrContextContainer=null,this._isContextBarVisible=!1,this._view=null,this._widget=null,this._ambience=window.localStorage.getItem("ENO3DViewViewerAmbience")||"VisuWhiteExperienceOCACmd"}return r.prototype=Object.create(e.prototype),r.prototype.initialize=function(){return this._DEBUG&&console.log("ENO3DContextMenuComponent.initialize called"),new Promise(function(e,t){this._identifiers.view&&this._contextConfigPath||t("Invalid parameters sent from .wafrapp file"),!0===this._isComponentInitialized?e():(this._view=this.getComponentFromIdentifier(this._identifiers.view),this._widget=widget,this._loadConfigurationFromFile().then(this._loadContextNLS.bind(this)).then(this._updateCommandState.bind(this)).then(this._setWafrContextBar.bind(this)).then(this._contextReady.bind(this)).then(e).catch(function(e){this._DEBUG&&console.error("ENO3DContextMenuComponent.initialize failed to init"+e),this.destroy(),t(new Error(e))}.bind(this)))}.bind(this))},r.prototype.clean=function(){return this._DEBUG&&console.log("ENO3DContextMenuComponent.clean called"),new Promise(function(e){e()})},r.prototype.destroy=function(){return this._DEBUG&&console.log("ENO3DContextMenuComponent.destroy called"),new Promise(function(e){e()})},r.prototype._loadConfigurationFromFile=function(){this._DEBUG&&console.log("ENO3DContextMenuComponent._loadConfigurationFromFile called");const e=[];return new Promise((t,n)=>{for(let t=0;t<this._contextConfigPath.length;++t)e.push(new Promise(e=>{this.loadText(this._contextConfigPath[t]).then(t=>{try{this._contextConfig.push(JSON.parse(t)),e()}catch(e){this._DEBUG&&console.error("ENO3DContextMenuComponent._loadConfigurationFromFile failed to load configuration"+e),n(e)}}).catch(n)}));Promise.all(e).then(t).catch(n)})},r.prototype._loadContextNLS=function(){return new Promise((e,t)=>{this.loadNls(this._nlsAMDPath).then(t=>{this._nls=t,e()}).catch(t)})},r.prototype._updateCommandState=function(){return new Promise(e=>{for(let e=0;e<this._contextConfig.length;++e)for(let t=0;t<this._contextConfig[e].ContextMenu.onEmptiness.length;++t){const n=this._contextConfig[e].ContextMenu.onEmptiness[t];if(n.submenu)for(let e=0;e<n.submenu.length;++e)n.submenu[e].handlerId===window.localStorage.getItem("ENO3DViewViewerAmbience")&&(n.submenu[e].state="selected",this._executeCommand({handlerId:n.submenu[e].handlerId}))}e()})},r.prototype._contextReady=function(){return this._DEBUG&&console.log("ENO3DContextMenuComponent._contextReady called"),new Promise(e=>{this.getExecutionContext().setContext("ContextReady",!0),this._isComponentInitialized=!0,e()})},r.prototype._prepareContextMenu=function(e,t,n){this._DEBUG&&console.log("ENO3DContextMenuComponent._prepareContextMenu called");var r=[],s=[];if(!0===(0===t.length))s=e.ContextMenu.onEmptiness;else{if(!(o.get().length>0&&this._view._areValidPaths(o.get())))return[];s=e.ContextMenu.onGeometry}for(var a=0;a<s.length;++a){var l=s[a];let e=[];if(l.submenu){let t="ambience"===l.identifier;for(let n=0;n<l.submenu.length;++n)"SeparatorItem"===l.submenu[n].type?e.push({type:l.submenu[n].type}):e.push({title:this._nls[l.submenu[n].handlerId],type:l.submenu[n].type,handlerId:l.submenu[n].handlerId,icon:l.submenu[n].iconPath?i.getWebappsAssetUrl(l.submenu[n].module,l.submenu[n].iconPath):void 0,state:l.submenu[n].state,action:{this:this,callback:function(e,t,n){if("CheckItem"===e[t].type&&(e[t].state="selected"===e[t].state?void 0:"selected"),!0===n){for(let t=0;t<e.length;++t)e[t].state=void 0;e[t].state="selected",window.localStorage.setItem("ENO3DViewViewerAmbience",e[t].handlerId)}this._executeCommand({handlerId:e[t].handlerId})}.bind(this,l.submenu,n,t)}})}const t={title:e.length>0?this._nls[l.identifier]:null,type:l.type,handlerId:e.length>0?null:l.handlerId,state:e.length>0?null:l.state,action:e.length>0?null:{this:this,callback:function(e){e&&this._executeCommand({handlerId:e})}.bind(this,l.handlerId)}};e.length>0&&(t.submenu=e),r.push(t)}return r},r.prototype._prepareContextBar=function(e,t,n){this._view.getTriptych().getMainPanelContainer();if(!0===(0===t.length))return[];if(1===o.get().length&&this._view._areValidPaths(o.get())){this._view.getController().getRoots();let t=!1;return 2===o.get()[0].pathElement.externalPath.length&&(t=!0),!0===t?{WAfrCtxBarRow1:{model:[e.ContextBar.WAfrCtxBarRow1.model[1]]}}:{WAfrCtxBarRow1:{model:[e.ContextBar.WAfrCtxBarRow1.model[0]]}}}return[]},r.prototype._setWafrContextBar=function(){return this._DEBUG&&console.log("ENO3DContextMenuComponent._setWafrContextBar called"),new Promise((e,t)=>{var n=this.getWafrUIComponent();this._wafrContextContainer=n.getContextualUIComponentManager();for(let e=0;e<this._contextConfig.length;++e){const t={subscriberId:`ENO3DContextualBar-${e}`,merge:!0,onContextualMenuReady:function(e,t){return this._prepareContextMenu(e,this.getPickedPath(t),t)}.bind(this,this._contextConfig[e]),onContextualBarReady:function(e,t,n){return this._prepareContextBar(e,this.getPickedPath(n),n)}.bind(this,this._contextConfig[e])};this._wafrContextContainer.register(t)}e()})},r.prototype.getPickedPath=function(e){this._view.getTriptych().getMainPanelContainer();return this._view.get3DViewer().pick({xPix:e.XmousePositionWithDevPxRatio,yPix:e.YmousePositionWithDevPxRatio},"mesh",!0).path},r.prototype.setContextBarVisibility=function(e){this._DEBUG&&console.log("ENO3DContextMenuComponent.setContextBarVisibility called");var t=this._wafrContextContainer.getContextualBar();!0===e?(this._isContextBarVisible=!0,t.show()):(this._isContextBarVisible=!1,t.hide())},r.prototype.canBeParallelized=function(){return!1},r}),define("DS/ENO3DUtils/ENO3DNavigateAppDefinitionComponent",["DS/WAfrUIStandardComponents/mod_WidgetProxyComponent","DS/ENO3DUtils/ENO3DBaseComponent","DS/ENO3DUtils/mixins/ENO3DWidgetEventManager","DS/ENOXInterWdgCom/LinkManager","DS/PADUtils/PADSettingsMgt"],function(e,t,n,i,o){"use strict";function r(e){t.call(this,e),this._appTitle=e.appTitle,this._appOptionsFiltePath=e.appConfigPath||"DS/ENOCockpitV2/assets/json/ENO3DViewerInfraOptions.json",this._identifiers={view:e.viewIdentifier},this._options=null,this._widgetProxy=null}return r.prototype=Object.create(t.prototype),r.prototype=Object.assign(r.prototype,n.prototype),r.prototype.initialize=function(){return this._DEBUG&&console.log("ENO3DNavigateAppDefinitionComponent.initialize called"),new Promise((e,t)=>{if(!0===this._isComponentInitialized){const n=this.getExecutionContext().getSourceApp();-1!==["ENXDISC_AP","ENXDISC_RealAssets"].indexOf(n.getId())?e():(console.error("ENO3DNavigateAppDefinitionComponent.initialize\n\tReusing the context of ENO3DNavigateAppDefinitionComponent is forbidden"),t("Reusing the context of ENO3DNavigateAppDefinitionComponent is forbidden"))}else this._initWidget().then(this._loadAppOptions.bind(this)).then(this._assignAppOptions.bind(this)).then(this._initWidgetEvents.bind(this)).then(this._subscribeModelEvents.bind(this)).then(this._initLinkManager.bind(this)).then(this._initSharedSettings.bind(this)).then(this._mergePreferences.bind(this)).then(this._widgetReady.bind(this)).then(e).catch(e=>{this._DEBUG&&console.error("ENO3DNavigateAppDefinitionComponent.initialize\n\tFatal error during initialization",e),t(e)})})},r.prototype.clean=function(){return this._DEBUG&&console.log("ENO3DNavigateAppDefinitionComponent.clean called"),new Promise(e=>e())},r.prototype.destroy=function(){return this._DEBUG&&console.log("ENO3DNavigateAppDefinitionComponent.destroy called"),new Promise(e=>{delete this._appTitle,delete this._appOptions,delete this._identifiers,delete this._options,delete this._widgetProxy,this.destroyParent().then(e)})},r.prototype.canBeParallelized=function(){return this._DEBUG&&console.log("ENO3DNavigateAppDefinitionComponent.canBeParallelized called"),!1},r.prototype._initWidget=function(){return this._DEBUG&&console.log("ENO3DNavigateAppDefinitionComponent._initWidget called"),new Promise((e,t)=>{try{this._widgetProxy=this.getExecutionContext().getComponent("AFR_WidgetProxyComponent"),this._widgetProxy=this._widgetProxy||widget,this._widgetProxy.setTitleHeader&&this._widgetProxy.setTitleHeader({brand:this._widgetProxy.getValue("brand"),appTitle:this._appTitle,title:""});let n="en";this._widgetProxy.getLanguage&&void 0!==this._widgetProxy.getLanguage()?n=this._widgetProxy.getLanguage():null===this._widgetProxy.lang&&void 0===this._widgetProxy.lang||(n=this._widgetProxy.lang),o.setSetting("lang",n),e()}catch(e){t(e)}})},r.prototype._loadAppOptions=function(){return this._DEBUG&&console.log("ENO3DNavigateAppDefinitionComponent._loadAppOptions called"),new Promise((e,t)=>{this.loadJSON(this._appOptionsFiltePath).then(e).catch(t)})},r.prototype._assignAppOptions=function(e){return this._DEBUG&&console.log("ENO3DNavigateAppDefinitionComponent._assignAppOptions called with",e),new Promise(async(t,n)=>{try{this._options=e,this._widgetProxy.setValue("tenantAware",!0),null!==o.app_context&&void 0!==o.app_context||(await o.setApp(e,"eno3dviewerinfra",!1),o.setSetting("enopad3dviewer_staticMappingSupportActivated",!0)),t()}catch(e){n(e)}})},r.prototype._initLinkManager=function(e){return this._DEBUG&&console.log("ENO3DNavigateAppDefinitionComponent._initLinkManager called with",e),new Promise((t,n)=>{o.getSetting("widgetLink_options")?i.initializeWidgetLink(widget,o.getSetting("widgetLink_options")).then(()=>t(e)).catch(n):t()})},r.prototype._initSharedSettings=function(){return this._DEBUG&&console.log("ENO3DNavigateAppDefinitionComponent._initSharedSettings called"),new Promise((e,t)=>{this.loadSource("DS/PADUtils/PADSharedSettings").then(t=>{t.addSharedSettings(widget,["x3dPlatformId","showWelcomePanel","autoreload","pad_security_ctx","synthesisModeOnInstance","pgpFromServer"]),e()}).catch(t)})},r.prototype._mergePreferences=function(){return this._DEBUG&&console.log("ENO3DNavigateAppDefinitionComponent._mergePreferences called"),new Promise(e=>{this._widgetProxy.mergePreferences&&(this._widgetProxy.mergePreferences(o.getWidgetPreferences()),o.updateWidgetPreferences()),e()})},r.prototype._widgetReady=function(){return this._DEBUG&&console.log("ENO3DNavigateAppDefinitionComponent._widgetReady called"),new Promise(e=>{this.getExecutionContext().setContext("WidgetReady",!0),this._isComponentInitialized=!0,e()})},r.prototype.updateTitle=function(){return this._DEBUG&&console.log("ENO3DNavigateAppDefinitionComponent.updateTitle called"),new Promise((e,t)=>{this.getViewer().getContentName().then(t=>{this._widgetProxy.setTitle&&this._widgetProxy.setTitle(t.contentName),e()}).catch(e=>{this._widgetProxy.setTitle&&this._widgetProxy.setTitle(e.contentName),t()})})},r.prototype.getSessionWidget=function(){return this._DEBUG&&console.log("ENO3DNavigateAppDefinitionComponent.getSessionWidget called"),"undefined"!=typeof widget?widget:null},r.prototype.getWidgetDOM=function(){return this._DEBUG&&console.log("ENO3DNavigateAppDefinitionComponent.getWidgetDOM called"),this._widgetProxy.view.elements.container||widget.body.firstChild},r.prototype.getOptions=function(){return this._DEBUG&&console.log("ENO3DNavigateAppDefinitionComponent.getOptions called"),this._options},r.prototype.getViewer=function(){return this._DEBUG&&console.log("ENO3DNavigateAppDefinitionComponent.getViewer called"),this.getComponentFromIdentifier(this._identifiers.view)},r.prototype.getAppTitle=function(){return this._DEBUG&&console.log("ENO3DNavigateAppDefinitionComponent.getOptions called"),this._appTitle},r}),define("DS/ENO3DUtils/ENO3DLandingPageComponent",["DS/ENO3DUtils/ENO3DBaseComponent","DS/PADServices/utils/GlobalModelEvents"],function(e,t){"use strict";function n(t){e.call(this,t),this._options=t,this._identifiers={widget:t.widgetIdentifier},this._landingPage=null}return n.prototype=Object.create(e.prototype),n.prototype.initialize=function(){return this._DEBUG&&console.log("ENO3DLandingPageComponent.initialize called"),new Promise((e,t)=>{this._landingPageReady().then(e).catch(e=>{this._DEBUG&&console.error("ENO3DLandingPageComponent.initialize\n\tFatal error during initialization",e),t(e)})})},n.prototype.clean=function(){return this._DEBUG&&console.log("ENO3DLandingPageComponent.clean called"),new Promise(e=>{e()})},n.prototype.destroy=function(){return this._DEBUG&&console.log("ENO3DLandingPageComponent.destroy called"),new Promise(e=>{this.destroyParent().then(e)})},n.prototype._landingPageReady=function(){return this._DEBUG&&console.log("ENO3DLandingPageComponent._landingPageReady called"),new Promise(e=>{this.getExecutionContext().setContext("LandingPageReady",!0),this._isComponentInitialized=!0,e()})},n.prototype.createLandingPage=function(){return this._DEBUG&&console.log("ENO3DLandingPageComponent.createLandingPage called"),new Promise((e,t)=>{this._initLandingPage().then(e).catch(e=>{this._DEBUG&&console.error("ENO3DLandingPageComponent.createLandingPage\n\tFatal error during initialization",e),t(e)})})},n.prototype._initLandingPage=function(){return this._DEBUG&&console.log("ENO3DLandingPageComponent._initLandingPage called"),new Promise(e=>{require(["DS/ENO3DUtils/utils/ENO3DLandingPage",`i18n!${this._options.nlsAMDPath}`],(n,i)=>{this._landingPage=new n({executionContext:this.getExecutionContext(),widget:this.getWidget(),readOnlyApp:!0,appTitle:"3D Navigate",description:i.appDescription,renderDiv:document.querySelector(".wafr-uiframe.wux-afr-framewindow"),structKey:"xsceneStoredObjects",onLandingPageReady:()=>{("undefined"==typeof widget||widget.getValue("showWelcomePanel"))&&t.publish({event:"ENO3DView/UnblockUX"}),e()},onReady:()=>{this.getWidget().dispatchEvent("onENOPADReady")}}),this._landingPage.initialize()})})},n.prototype.getLandingPage=function(){return this._landingPage},n.prototype.canBeParallelized=function(){return!1},n.prototype.getWidget=function(){return this.getComponentFromIdentifier(this._identifiers.widget).getSessionWidget()},n});