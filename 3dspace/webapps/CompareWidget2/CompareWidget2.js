define("DS/CompareWidget2/CompareWidgetInit",[],function(){"use strict";function e(e,t){var i="2",n=new URLSearchParams(window.location.search);if(n&&n.has("widgetDomain")){var o=n.get("widgetDomain"),r=new URLSearchParams(o.substring(o.indexOf("?")));r&&r.has(e)&&r.get(e).indexOf("true")>=0&&(i=t)}return i}return function(){setTimeout(function(){var t="2";try{var i=widget.data.X3DContentId,n=JSON.parse(i).runOptions,o=n.version;null!=o&&(t=o)}catch(e){console.log("Something went wrong getting widget environment... continuing")}require(["DS/CompareCommon/Utils","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings"],function(i,o,r){var s=widget.getValue("x3dPlatformId");r.app_initialization(function(){o.getSecurityContextPromise(s,null).then(function(o){var a={url3DSpace:r.get3DSpaceBaseUrl(s),tenant:s,securityContext:o};i.getExpressionPromise("CompareWidgetUseCompareV1",a).then(i=>{null!=i&&!0===i.available&&"true"===i.expressionValue?t="1":"1"!==t&&(t=e("CompareV1","1"));var o="DS/CompareWidget2/CompareWidget2";"1"===t&&(o="DS/CompareWidget/CompareWidget",widget.compareV1=!0),widget.recordForODT=!0===e("recordForCV2ODT",!0),widget.CV2Debug=!0===e("CV2Debug",!0),widget.CV2Timing=!0===e("CV2Timing",!0),widget.CV2EnableCustomProfile=!0,require([o],function(e){widget.addEvents({onLoad:function(t){e.onLoad.call(null,n)},onViewChange:function(t){e.onViewChange.call(null,t)},onRefresh:function(t){e.onRefresh.call(null,t)},onResize:function(t){e.onResize.call(null,arguments)},onEdit:function(t){e.onEdit.apply(null,arguments)},endEdit:function(t){t.submitted&&e.endEdit.apply(null,arguments)}})})})})})})},500)}}),define("DS/CompareWidget2/plugins/PORTFOLIO/PORTFOLIO_STRUCT_FETCH_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/PORTFOLIO/expanders/PortfolioExpand","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/nodeOccRel2RefInstTree","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInstTreeAug","DS/CompareWidget2/support/cw2CacheMgr"],function(e,t,i,n,o){return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n),this._dataSource="PORTFOLIO_SERVICE",this._dbFallback=!1},execute:function(e,o){var r=this;r._parent(e,o),function(e,o){var r=this;return new Promise(function(s,a){r._lastReqStart=r._plugSvcs.nowMS();var l=r._lastReqStart;r._plugSvcs.postEvent("STRUCT_UPDATE_IN_PROGRESS_EVENT",null);var u=e.length,c=[];for(let d of e)t.doExpand(d,"PORTFOLIO_SERVICE","-1",r._plugSvcs,o).then(function(t){var p=t,h=i.convert(d,p,r._plugSvcs,o);if(h.setDataSource(p._dataSource),h.sortChildren(),r.dbgout("%% STRUCTURAL DATA EXPANDED by: "+h._dataSource),l==r._lastReqStart){var _={securityContext:d._securityContext,tenant:d._tenant,serviceName:d._serviceName};n.augment(h,_,r._plugSvcs).then(function(t){if(l==r._lastReqStart){var i,n,o,a=t;if(c.push(a),c.length>=u){var d=(i=e,n=[],o={},c.forEach(function(e){var t=e.getObjIDSpec().getUniqueID();o[t]=e}),i.forEach(function(e){var t=e.getUniqueID(),i=o[t];n.push(i)}),n);if(l!=r._lastReqStart)return;s(d)}}},function(e){r._plugSvcs.errout("FAILURE AUGMENTING TREE:"+e),a(e)})}},function(e){r._plugSvcs.errout("Failed to expand using service: "+e),a(e)})})}.call(r,e,o).then(function(e){var t=e;r.reportOK(t)},function(e){r.reportKO()})}})}),define("DS/CompareWidget2/plugins/PORTFOLIO/expanders/PortfolioExpand",["DS/CompareWidget2/support/cw2Utils","DS/CompareCommon/Utils","DS/CompareCommon/CompareMetaData","DS/CompareWidget2/support/DataCenter","DS/CompareWidget2/support/objIDSpec","DS/CompareWidget2/plugins/STRUCTURE/expanders/compareServiceExpand","DS/CompareWidget2/ViewDefModules/ViewDefOptions","UWA/Json"],function(e,t,i,n,o,r,s,a){function l(e){var i=e.attributes.revision,n={};if(t.isRevBranchRevPattern(i,n)){for(var o=e.attributes.name,r=n.branches.length-1;r>=0;--r)o+="_"+n.branches[r].branchId,0!==r&&(o+="_"+n.branches[r].revisionId);e.attributes.name=o}e.logicalid="NoDupes"}return{jsName:"PORTFOLIO_EXPAND",doExpand:function(e,a,u,c,d){return new Promise(function(u,d){(function(e,t,i,o){return new Promise(function(t,i){var o="objectIds="+e.getPhysID(),r=e.getTenant(),s=e.getServiceName();n.makeAuthHttpsCall("/3dportfolio/fetchObjs","GET",o,"json",r,s,null,!1).then(function(e){t(e)},function(e){i(e)})})})(e).then(function(n){var p=n[0];for(var h of(p._dataSource=a,p.nodes))void 0!==h.serviceId&&null!==h.serviceId&&"3dportfolio"===h.serviceId.toLowerCase()&&l(h);(function(e,n,a,l){return new Promise(function(l,u){if(null!=n){var c={objectIds:[],objectTypes:[],serviceIds:[],tenant:e._tenant,securityContext:e._securityContext},d={objectIds:[],objectTypes:[],serviceIds:[],tenant:e._tenant,securityContext:e._securityContext};for(var p of n.nodes)p.nodeid!==n.rootoccurrence&&void 0!==p.proxySpec&&null!==p.proxySpec&&(-1!==p.proxySpec.serviceURL.search(/^3DSpace/i)?(c.objectIds.push(p.physicalid),c.objectTypes.push(p.type),c.serviceIds.push(p.proxySpec.serviceURL)):(d.objectIds.push(p.physicalid),d.objectTypes.push(p.type),d.serviceIds.push(p.proxySpec.serviceURL)));var h=0,_=0;function f(){_===h&&l(n)}if(0===d.objectIds.length&&0===c.objectIds.length&&f(),d.objectIds.length>0&&(++h,t.getFederatedAttributesPromise(d).then(function(e){++_;for(let t of n.nodes)for(let n of e.results)if(t.physicalid===n.physicalID){let e=n.data.findIndex(e=>"ds6w:label"===e.name);-1!==e&&(t.Title=n.data[e].value),t.icon=n.type_icon_url,""===t.attributes.name&&(t.attributes.name=t.physicalid),""===t.attributes.derivedFromId&&(t.attributes.derivedFromId=t.physicalid),t.logicalid=t.physicalid,i.typeInfo[t.type]&&i.typeInfo[t.type].icon||(i.typeInfo[t.type]=i.typeInfo[t.type]||{},i.typeInfo[t.type].icon=n.type_icon_url,null==i.typeInfo[t.type].serviceId&&void 0!==n.sourceID&&null!==n.sourceID&&(i.typeInfo[t.type].serviceId=n.sourceID.split(":")[0]))}f()})),c.objectIds.length>0){++h;let e=[];for(let t=0;t<c.objectIds.length;++t){let i=new o(c.objectIds[t],c.objectTypes[t],c.securityContext,c.tenant,c.serviceIds[t]);e.push(i)}let t="CV_SERVICE",i="0",l=s.STRUCT_FETCH_OPTIONS;l.USE_MCS=!1,r.doExpandN(e,t,i,a,l).then(function(e){++_;for(let r of e)if(null!=r){var t=r.rootoccurrence,i=parseInt(r.occurrences[t].nodeid),o=r.nodes[i].physicalid;for(let e of n.nodes)if(e.physicalid===o){let t=r.nodes[i];e.icon=t.icon,e.name=t.attributes.name,e.revision=t.revision,e.attributes=t.attributes,e.logicalid=t.attributes.name;let n=t.attributes["PLMReference.V_DerivedFrom"];e.attributes.derivedFromId=null!=n&&""!==n?n:t.physicalid,"Products"===t.type&&(e.name=t.versionid,e.attributes.derivedFromId=t.attributes.name),"VPMReference"===t.type&&(e.versionid=t.versionid,e.logicalid=t.logicalid)}}f()})}}})})(e,p,c).then(function(e){u(e)},function(e){c.errout(e),d(e)})},function(e){c.errout(e),d(e)})})}}}),define("DS/CompareWidget2/viewComponents/MainToolbar",["UWA/Class","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2","DS/Tweakers/GeneratedToolbar"],function(e,t,i,n){"use strict";return e.extend({init:function(){},createToolbar:function(e,n,o,r,s,a,l){var u=this;(this._eventMgr=n,this._isToolbarCreated&&this.mainToolbar&&this.destroyToolbar(),this._isToolbarCreated=!1,this.resultFrame=e,this.toolbarContainer=o,this.mainToolbarOptions=s,r)&&require(["text!"+r],function(e){var n=JSON.parse(e);n.entries.forEach(function(e){!0===e.hasTooltip&&(e.tooltipInfos=t.generateTooltip("CompareWidget2/Tooltips",e.id)),"object"==typeof e.dataElements.value?(e.dataElements.value.argument={},e.dataElements.value.argument.objects=u):"customEnumMember"===e.dataElements.typeRepresentation?e.dataElements.label=i[e.id]:"string"==typeof e.dataElements.value&&"color"!==e.dataElements.typeRepresentation&&(e.dataElements.value=i[e.id]),s.forEach(function(t){var i=t.replace(/\s+/g,"");e.id.toLowerCase().indexOf(i.toLowerCase())>=0&&(e.dataElements.visibleFlag=!1)})}),u.buildToolbar(n,a,l),u.resultFrame.setToolbarCreated(),u.updateToolbar()})},buildToolbar:function(e,t,o){this._isToolbarCreated=!0,this._toolbarObjTypes=[],this._customConfigActive=o;let r=e.entries.findIndex(e=>"mainToolbarProfile"===e.id),s=e.entries.findIndex(e=>"mainToolbarEditCustomization"===e.id),a=e.entries[r]||null,l=e.entries[s];if(a&&l)if(!0===o){let e=null,n="";if(void 0!==this.resultFrame&&null!==this.resultFrame&&void 0!==this.resultFrame._CCM&&null!==this.resultFrame._CCM&&null!=t&&void 0!==t.typeInfoArray&&void 0!==t.typeInfoArray&&t.typeInfoArray.length>0){let i=t.typeInfoArray.map(e=>e.type);e=this.resultFrame._CCM.getProfileNames({getTemplates:!1,objTypes:i}),n=this.resultFrame._CCM.getUserPreferredProfileName(t),this._toolbarObjTypes=i}null!=e&&e.length>0?(e.unshift(i.mainToolbarProfileDefault),null!=n&&a.dataElements.value!==n&&(a.dataElements.value=n)):e=[i.mainToolbarProfileDefault],a.dataElements.possibleValues=e,a.visibleFlag=!0,l.visibleFlag=!0}else a.visibleFlag=!1,l.visibleFlag=!1;this._replaceLeftAndRightColorWithOptionsColors(e),this.toolbarModel=n.prototype.createTreeDocument(e),this.mainToolbar=new n({items:this.toolbarModel}),this.mainToolbar._eventMgr=this._eventMgr,this.mainToolbar.inject(this.toolbarContainer)},updateToolbar:function(){this.mainToolbar&&(this.mainToolbar.prepareUpdateView(),this.mainToolbar.updateNodeModel("mainToolbarDisplayViews",{disabled:this.resultFrame._layout.getViews().length<2||null!=this.resultFrame._layout.maximizedPanel}),this.mainToolbar.pushUpdateView())},updateComparisonProfileDropdownUI:function(){if(!0===this._customConfigActive){let e=null,t=null;if(this.mainToolbar){let n=n=>{this.mainToolbar.prepareUpdateView(),(t=null!=n&&n.length>0)?(n.unshift(i.mainToolbarProfileDefault),e=!0):(n=[i.mainToolbarProfileDefault],e=!0),this.mainToolbar.updateNodeModel("mainToolbarEditCustomization",{visibleFlag:e});let o={visibleFlag:e};e&&null!=n&&(o.possibleValues=n),this.mainToolbar.updateNodeModel("mainToolbarProfile",o),this.mainToolbar.pushUpdateView()};this.resultFrame._CCM.getProfileNames({getTemplates:!1,objTypes:this._toolbarObjTypes,callBackAfterProfilesUpdated:n})}}},destroyToolbar:function(){this.mainToolbar.destroy(),this.mainToolbar=null,this._isToolbarCreated=!1},_replaceLeftAndRightColorWithOptionsColors:function(e){if(null!=this.resultFrame._panelSpecSet.STRUCT_VIEW&&null!=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin&&null!=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin._pluginOptions&&null!=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin._pluginOptions.SYSTEM_RULE_ID_FLAGS&&null!=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin._pluginOptions.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY&&null!=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin._pluginOptions.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR&&null!=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin._pluginOptions.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY&&null!=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin._pluginOptions.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR){let t=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin._pluginOptions.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,i=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin._pluginOptions.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR,n=e.entries.findIndex(e=>"mainToolbarLeftObjectColor"===e.id),o=e.entries.findIndex(e=>"mainToolbarRightObjectColor"===e.id);-1!==n&&""!==t&&(e.entries[n].dataElements.value=t),-1!==o&&""!==i&&(e.entries[o].dataElements.value=i)}}})}),define("DS/CompareWidget2/widget/controls/splitContainer",["UWA/Controls/Abstract"],function(e){return e.extend({init:function(e){this.splitContainerMinWidth=e.splitContainerMinWidth,this._parent({}),this.options=e,this.elements.panels=e.panels,e.panels.length>1?this.panelWidth=e.panels.map(t=>"calc("+100/e.panels.length+"% - 3px)"):this.panelWidth="100%",this.buildUI()},buildUI:function(){if(this.elements.container=UWA.createElement("div"),this.elements.container.setStyles({display:"flex",position:"relative",width:this.splitContainerMinWidth>0?(this.splitContainerMinWidth*this.elements.panels.length).toString()+"px":"100%",height:"100%"}),this.elements.panels.length>1){this.elements.splitters=[];for(var e=0,t=this.elements.panels.length;e<t;e++)if(this.elements.panels[e].setStyles({width:this.panelWidth[e],position:"relative"}),this.elements.panels[e].inject(this.elements.container),e<t-1){var i=UWA.createElement("div",{styles:{width:"6px",cursor:"col-resize",position:"relative"}});this.elements.splitters.push(i),i.inject(this.elements.container)}}else this.elements.panels[0].inject(this.elements.container)}})}),define("DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/attrChooseDialog",["UWA/Class","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Toggle","i18n!DS/CompareWidget2/assets/nls/CompareV2","i18n!DS/UIKIT/assets/nls/UIKIT","css!DS/CompareWidget2/CompareWidget2.css"],function(e,t,i,n,o,r,s){return e.extend({init:function(e,o){this._parent({}),this.attrComparePanel=e,this.onClickOkCallback=o,this.content=this._buildContent(),this.immersiveFrame=new t,this.immersiveFrame.inject(widget._isODTMode()?document.body:widget.body),this.dialog=new i({title:r.selectPropertiesToDisplay,content:this.content,immersiveFrame:this.immersiveFrame,resizableFlag:!0,visibleFlag:!0,modalFlag:!0,buttons:{Reset:new n({label:r.resetProperties,domId:"compare_attrchooser_Reset",onClick:this._onClickReset.bind(this),disabled:this.attrComparePanel.showDefaultPropsOnly(),emphasize:"secondary"}),Ok:new n({label:s.ok,domId:"compare_attrchooser_OK",onClick:this._onClickOk.bind(this),disabled:!0,emphasize:"primary"}),Cancel:new n({label:s.ko,domId:"compare_attrchooser_Cancel",onClick:this._onClickCancel.bind(this),disabled:!1,emphasize:"secondary"})}}),this.dialog.addEventListener("close",this._onDialogClose.bind(this))},_enableOK:function(e){this.dialog.buttons.Ok.disabled=!e},_enableReset:function(e){this.dialog.buttons.Reset.disabled=!e},_onDialogClose:function(){this.dialog.removeEventListener("close",this._onDialogClose.bind(this)),this.dialog.destroy(),this.immersiveFrame.destroy()},_onClickOk:function(){this._save(function(){this.onClickOkCallback(),this.dialog.close()}.bind(this))},_onClickCancel:function(){this.dialog.close()},_onClickReset:function(){this._resetToDefaultAttrs()},_resetToDefaultAttrs:function(){var e=this,t=this.attrComparePanel.defaultAttrs;this.allPropertyCheckboxes.forEach(function(i){var n=-1!=t.indexOf(i.value)||e.attrComparePanel.isTitleAttr(i);i.checkFlag=n}),e._updateAllCheck(),e._enableReset(!1),e._enableOK(!0)},onClickDisplayAll:function(e){let t=this.displayAllCheckbox.checkFlag;for(let e=0;e<this.allPropertyCheckboxes.length;e++)this.attrComparePanel.isTitleAttr(this.allPropertyCheckboxes[e])?this.allPropertyCheckboxes[e].checkFlag=!0:this.allPropertyCheckboxes[e].checkFlag=t;this._enableReset(!0),this._enableOK(!0)},_save:function(e){let t=[];if(this.dialog.buttons.Reset.disabled)t.push("__showDefault__");else if(!this.displayAllCheckbox.checkFlag)for(let e=0;e<this.allPropertyCheckboxes.length;e++){let i=this.allPropertyCheckboxes[e];if(0==i.checkFlag){let e=i.value;t.push(e)}}this.attrComparePanel.savePropsDisplayOptions(t),e()},_buildPropertyCheckboxes:function(e,t,i){var n=this;n.allPropertyCheckboxes=[];for(let r=0;r<t.length;r++){let s=t[r],a=new o({label:s.displayName,value:s.name}),l=-1==i.indexOf(s.name);a.checkFlag=l,n.attrComparePanel.isTitleAttr(s)?(a.disabled=!0,a.checkFlag=!0,a.addEventListener("buttonclick",function(){n._enableOK(!1),n._enableReset(!1),n._updateAllCheck()}.bind(n)),a.inject(e),n.allPropertyCheckboxes.unshift(a)):(a.addEventListener("buttonclick",function(){n._enableOK(!0),n._enableReset(!0),n._updateAllCheck()}.bind(n)),a.inject(e),n.allPropertyCheckboxes.push(a))}},_updateAllCheck:function(){for(var e=!0,t=this.allPropertyCheckboxes.length,i=0;i<t;i++){if(1!=this.allPropertyCheckboxes[i].checkFlag){e=!1;break}}this.displayAllCheckbox.checkFlag=e},_buildDisplayAllCheckbox:function(e){this.displayAllCheckbox=new o({label:r.displayAllProperties,value:"all",checkFlag:this.attrComparePanel.showAllProps()}),this.displayAllCheckbox.getContent().setStyle("border-bottom","1px solid lightgrey"),this.displayAllCheckbox.inject(e),this.displayAllCheckbox.addEventListener("buttonclick",this.onClickDisplayAll.bind(this))},_buildContent:function(){var e=this.attrComparePanel.compareResult;for(let i=0;i<e.length;i++)if(this.attrComparePanel.isTitleAttr(e[i])){e.unshift(e[i]);var t=i+1;e.splice(t,1)}var i=e.findIndex(e=>"thumbnailimage"===e.name);if(-1!=i&&0!=i){e.unshift(e[i]);var n=i+1;e.splice(n,1)}let o=UWA.createElement("div",{id:"attr-choose-dialog"});return this._buildDisplayAllCheckbox(o),this._buildPropertyCheckboxes(o,e,this.attrComparePanel.getPropsToHide(e)),o}})}),define("DS/CompareWidget2/widget/resultFrame",["UWA/Controls/Abstract","DS/CustomizableLayout/Layout","DS/CompareWidget2/viewComponents/MainToolbar","DS/CompareCommon/Utils","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/userSettings/UserSettingsManager","i18n!DS/CompareWidget2/assets/nls/DisplayMessages"],function(e,t,i,n,o,r,s){"use strict";return e.extend({init:function(e,t,i){this._parent({}),this._eventMgr=e,this._runOptions=t,this._eventTokens={},this._layout=null,this._panelSpecSet={},this._swapIsEnabled=!0,this._isToolbarCreated=!1,this._CCM=i,this.elements.container=UWA.createElement("div",{class:"compare-result-frame",id:"compare-result-frame"}),this._layout=null},_createLayoutPromise:function(e){var i={container:this.elements.container,tabOnlyDocking:"smartphone"===o.getDeviceType(),resultFrame:this};let n=new t(i);n.onViewOpened(this.onViewOpenedCB.bind(this)),n.onViewClosed(this.onViewClosedCB.bind(this));let s=e+"_"+o.getDeviceType();return r.loadSettingsPromise([s]).then(()=>(r.savePrefsTimestampAndEnableUpdate(),r.sync(n,s,"layout",null)))},onViewOpenedCB:function(e){console.log("VIEW "+e.getName()+" OPENED"),this._eventMgr.publish({event:"VIEW_OPENED",data:{eventName:"VIEW_OPENED",view:e}})},onViewClosedCB:function(e){console.log("VIEW "+e.getName()+" CLOSED"),this._eventMgr.publish({event:"VIEW_CLOSED",data:{eventName:"VIEW_CLOSED",view:e}})},_createLayout:function(e){var i={name:e,container:this.elements.container};return new t(i)},getLayout:function(){return this._layout},update:function(e,t,o,r){this.elements.container.innerHTML="",null==this._runOptions||"MERGE"!==this._runOptions.app&&"NRF"!==this._runOptions.app||(this._useDatabaseSelected=!widget.getBool("useIndexForMerge")),this.MainToolbarModule||(this.MainToolbarModule=new i),this._isToolbarCreated||(this.toolbarContainer=UWA.createElement("div",{class:"compare-main-toolbar-container"}),this.toolbarContainer.inject(this.elements.container),this.MainToolbarModule.createToolbar(this,this._eventMgr,this.toolbarContainer,e,t,o,r),this._isToolbarCreated=!0),this._layout.buildUI();let a=this._layout.buildUI();a.length&&n.showAlertBox("NEW_VIEWS_MESSAGE",s,"info",!1,{newViews:a.reduce((e,t,i,n)=>e+(i<n.length-1?",":"")+t,"")}),this._isToolbarCreated&&this.MainToolbarModule&&this.MainToolbarModule.updateToolbar()},setToolbarCreated:function(){this._isToolbarCreated=!0},addPanel:function(e,t){(this._createLayout&&void 0===this._layout||null===this._layout)&&(this._layout=this._createLayout("Layout-"+e.name)),this._panelSpecSet[e.name]=e,this._layout.addRow(e.panel),this.update()},setAllPanels:function(e,t,i,n,r,s,a,l){var u=this;u._panelSpecSet=n,this._createLayoutPromise(e+"_"+t).then(e=>{if(this._layout=e,"smartphone"===o.getDeviceType())u._layout.addRow(Object.keys(u._panelSpecSet).map(e=>u._panelSpecSet[e].panel));else if(null!=i)!function e(t,i){var o="ROW"===Object.keys(t)[0].toUpperCase()?"addRow":"addCol";(Object.values(t)[0].constructor!==Array?[Object.values(t)[0]]:Object.values(t)[0]).forEach(t=>{t.constructor===String?i[o](n[t].panel):t.constructor===Array?i[o](t.map(e=>n[e].panel)):t.constructor===Object&&e(t,i[o]())})}(i,u._layout);else{Object.keys(u._panelSpecSet).forEach(function(e){var t=u._panelSpecSet[e].panel;u._layout.addRow(t)})}u.update(r,s,a,l)})},updateToolbarCustomProfile:function(){this.MainToolbarModule.updateComparisonProfileDropdownUI()},refreshFrame:function(){this.updateToolbarCustomProfile()},applyDefaultLayout:function(){this._layout.applyDefaultLayout()},onPanelMaximized:function(){this.MainToolbarModule.updateToolbar()},onPanelRestoredFromMaximized:function(){this.MainToolbarModule.updateToolbar()},onProfileManagerDone:function(){void 0!==this.MainToolbarModule&&null!==this.MainToolbarModule&&this.MainToolbarModule.updateComparisonProfileDropdownUI()},destroy:function(){for(var e in this._eventTokens)this._eventMgr.unsubscribe(this._eventTokens[e]),this._eventTokens[e]=null;this._eventMgr=null,this._ccm=null,this._isToolbarCreated=!1,this._panelSpecSet={},this.MainToolbarModule.destroyToolbar(),this._parent()}})}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structOpenWithMenu",["UWA/Class","WebappsUtils/WebappsUtils","DS/i3DXCompassServices/i3DXCompassPubSub","DS/CompareCommon/launchTree","DS/i3DXCompassPlatformServices/OpenWith","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,i,n,o,r){"use strict";var s=[];function a(e){if(e.widgetId===widget.id){for(var t=[],n=0;n<e.data.items.length;n++)t.push(e.data.items[n].path);var o=null;for(n=0;null==o&&n<s.length;)o=s[n].buildLaunchJSON(t),n++;if(null==o)return void console.error("Cannot find selection in either tree (this should not happen)");var r={appId:e.appId,widgetId:e.widgetId,fileName:"-file",fileContent:o};i.publish("launchApp",r)}}return e.extend({init:function(e){this._structComparePanel=e.structComparePanel,i.subscribe("setTypesCallback",a)},getOpenWithMenuPromise:function(e,t,i){var o=this;return new Promise(function(r){var a=e.cellInfos.nodeModel.getRoot(),l=!1;for(const e of s)a.options.data.getPath()===e._pathWithStrArray[0]&&(l=!0);if(!l){for(var u=(a=e.cellInfos.nodeModel._getTrueRoot()).getAllDescendants().map(function(e){return e.options.data.getPath()}),c=new n([]),d=0;d<u.length;++d){var p=u[d].split("/");c._pathWithArray.push(p),c._pathWithStrArray.push(p.join(","))}s.push(c)}require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADProbes"],function(n,s,a){n.app_initialization(function(){var n=[];for(var a of t){let e=a.options.data.getObjIDSpec_REF();null!=e&&n.push(e.getObjType())}s.retrieveHierarchy(n,function(s){for(var a=[],l=0;l<n.length;++l)a[l]=n[l],null!=s&&void 0!==s[n[l]]&&null!==s[n[l]]&&(a[l]=s[n[l]]);for(var u=t.map(function(e){return e.options.data.getPath()}),c=[],d=0;d<t.length;++d){var p=u[d].split("/").map(function(e){return{resourceid:e}});let e=[p[p.length-1]];var h=t[d].options.data._objIDSpecREF;c.push({contextId:h.getSecurityContext(),envId:h.getTenant(),objectId:h.getPhysID(),objectTaxonomies:a[d],objectType:h.getObjType(),path:!0===i.useSelectionInContext?p:e,serviceId:h.getServiceName()})}var _={protocol:"3DXContent",version:"1.1",source:"ENOCOMP_AP",widgetId:widget.id,data:{items:c}};o._getOpenWithMenuPromise(e,_).then(function(e){r(e)})})})})})},_getOpenWithMenuPromise:function(e,i){return new Promise(function(n){var s=[];e.cellInfos.nodeModel.options.data._objIDSpecREF;if("3DShape"===function(e){for(var t=e.cellInfos.nodeModel;0!==t._nodeDepth;)t=t._parentNode;return t.options.data._objIDSpecREF}(e).getObjType()||widget.isWebInWin)n(s);else{var a=new o;a.set3DXContent(i,!0),UWA.is(a.retrieveCompatibleApps,"function")?a.retrieveCompatibleApps(function(e){var i=[];if(e.forEach(function(e){i.push({type:"PushItem",title:e.text,fonticon:void 0!==e.fonticon&&null!==e.fonticon&&e.fonticon.length>0?{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon,family:WUXManagedFontIcons.Font3DS}:void 0,icon:void 0!==e.icon&&null!==e.icon&&e.icon.length>0?e.icon:"",action:{callback:function(){e.handler()}}})}),i.length>0)var o={type:"PushItem",icon:"url("+t.getWebappsAssetUrl("ENXNav","icons/32/I_OpenWith.png")+")",title:r.OpenWith,submenu:i};n(o)}):n(s)}})},clearLaunchTreeArray:function(){s=[]}})}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structExpandCollapseMenu",["UWA/Class","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,i){"use strict";return e.extend({init:function(e){this._structComparePanel=e.structComparePanel},getExpandCollapseContextMenu:function(e,t){var i=this.getExpandCollapseMenu(t);return function(e){return null==e||void 0===e.cellInfos||null===e.cellInfos||void 0===e.cellInfos.nodeModel||null===e.cellInfos.nodeModel||void 0===e.cellInfos.nodeModel._options||null===e.cellInfos.nodeModel._options||void 0===e.cellInfos.nodeModel._options.children||null===e.cellInfos.nodeModel._options.children}(e)?null:UWA.extend({...i.find(e=>e.id===t)},{type:"PushItem",submenu:i})},getExpandCollapseMenu:function(){var e=this;return[{id:"expandAll",icon:"flow-tree-expand-down",title:i.ExpandAll,tooltip:t.generateTooltip("CompareWidget2/Tooltips","ExpandAll")},{id:"expandNLevels",icon:"flow-tree-expand-down-cog",title:i.ExpandNLevels,tooltip:t.generateTooltip("CompareWidget2/Tooltips","ExpandNLevels")},{id:"collapseAll",icon:"flow-tree-expand-up",title:i.CollapseAll,tooltip:t.generateTooltip("CompareWidget2/Tooltips","CollapseAll")}].map(t=>({type:"CheckItem",id:t.id,icon:t.icon,title:t.title,tooltip:t.tooltip,state:e._structComparePanel.getActiveExpandMenuId()===t.id?"selected":"",action:{callback:()=>e._structComparePanel.handleToolbarCommands({event:t.id,data:{icon:t.icon}})}}))}})}),define("DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_node",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj"],function(e,t){var i=function(i,n){var o;this._dbObj_REF=null,this._dbObj_INST=null,this._childArray=[],this._parent=null,this._dbContext={},o=i,ret=!0,null!=o&&o.constructor!=t&&(e.errout("[INVALID] refInst_node receives unexpected type"),ret=!1),ret&&(this._dbObj_REF=i),this._dbObj_INST=n,this._reqModforODT="DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_node"};return i.prototype.visit_subtreeAndFN=function(e){var t=e(this);if(null!=this._childArray)for(var i=this._childArray.length,n=0;n<i&&1==t;n++){var o=this._childArray[n];null!=o&&(t=o.visit_subtreeAndFN(e))}return t},i.prototype.set_dbObj_INST=function(e){this._dbObj_INST=e},i.prototype.setDBContext=function(e){this._dbContext=e},i.prototype.getDBContext=function(){return this._dbContext},i.prototype.setParent=function(t){null==t?e.errout("refInst_node's parent cannot be set to null... ignored"):t.constructor!=this.constructor?e.errout("refInst_node's parent can only be another refInst_node... ignored"):null!=this._parent&&this._parent!=t?e.errout("Changing parent node of a refInst_node (unexpectedly)... ignored"):this._parent=t},i.prototype.getParent=function(){return this._parent},i.prototype.addChild=function(t){null==t?e.errout("refInst_node cannot have a null child... ignored"):t.constructor!=this.constructor?e.errout("refInst_node's child must be another refInst_node... ignoring"):this._childArray.push(t)},i.prototype.rmChild=function(e){var t=[];this._childArray.forEach(function(i){i.getAttr("INST.physicalid")!=e&&t.push(i)}),this._childArray=t},i.prototype.getChildArray=function(){return this._childArray},i.prototype.sortChildArray=function(){var e=this._childArray.sort(function(e,t){return e.getAttr("INST.ro.plminstance.v_treeorder")-t.getAttr("INST.ro.plminstance.v_treeorder")});this._childArray=e},i.prototype.findChid=function(e,t){for(var i=null,n=this._childArray.length,o=0;o<n;o++){var r=this._childArray[o];if(e==r.getAttr("INST.physicalid")&&t==r.getAttr("REF.physicalid")){i=r;break}}return i},i.prototype.isRoot=function(){return null==this.getParent()},i.prototype.isLeaf=function(){return 0==this._childArray.length},i.prototype.get_dbObj_REF=function(){return this._dbObj_REF},i.prototype.get_dbObj_INST=function(){return this._dbObj_INST},i.prototype.getAttr=function(t){var i=null,n=t.indexOf("."),o=t.substring(0,n),r=t.substring(n+1);return"REF"==o?i=this._dbObj_REF.getAttr(r):"INST"==o?null!=this._dbObj_INST&&(i=this._dbObj_INST.getAttr(r)):e.errout("unexpected qualifier in name: "+o),i},i.prototype.setAttr=function(t,i){var n=null,o=t.indexOf("."),r=t.substring(0,o),s=t.substring(o+1);return"REF"==r?n=this._dbObj_REF.setAttr(s,i):"INST"==r?null!=this._dbObj_INST&&(n=this._dbObj_INST.getAttr(s,i)):e.errout("unexpected qualifier in name: "+r),n},i}),define("DS/CompareWidget2/userSettings/UserSettingsManager",["UWA/Core","DS/CompareCommon/Utils","DS/CompareCommon/WidgetPreferences","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,i,n){"use strict";function o(e,i,n,o){var r={callbackList:[]};return((s,a,l)=>{let u=i;Object.defineProperty(r,"value",{enumerable:!0,configurable:!1,get:function(){return u},set:function(i){if(u!==i)if(u=i,r.callbackList.forEach(e=>e(u)),!0===widget.getValue("saveToWidgetOnly"))widget.setValue(n+"["+e+"]",u);else{t.savePrefToSession(`${l}[${s}]`,u);let e=Date.now();o.__updateSessionCacheTimestamp__&&t.savePrefTimestampToSession(l,e),!widget._isODTMode()&&t.saveUserPreferencesPromise(`${l}[${s}]`,u).then(()=>{o.__updateSessionCacheTimestamp__&&t.savePrefTimestampToDashboardPromise(l,e).then(()=>{})})}}})})(e,0,n),r}function r(e,n){this.disablePrefsTimestampUpdate();let r=Object.keys(e);var s;!0===widget.getValue("saveToWidgetOnly")?(r.forEach(t=>{this.userSettings[t]=o(t,widget.getValue(this.namespace+"["+t+"]"),this.namespace,this),e[t].widgetSetting&&i.addWidgetPreference(t,e[t].widgetSetting,this.get(t))}),n()):(s=this.namespace,new Promise((e,i)=>{let n=t.getPrefTimestampFromSession(s);Number.isNaN(n)||n<=0?e(!1):t.getPrefLastSavedTimestampFromDashboardPromise(s).then(t=>{e(!(Number.isNaN(t)||t>n))})})).then(s=>{Promise.allSettled(r.map(e=>t[s?"getPrefFromSessionPromise":"getUserPreferencesPromise"](`${this.namespace}[${e}]`))).then(s=>{for(var a=0,l=s.length;a<l;a++){let n=s[a];"rejected"!==n.status&&null!==n.value&&void 0!==n.value&&""!==n.value?this.userSettings[r[a]]=o(r[a],n.value,this.namespace,this):(this.userSettings[r[a]]=o(r[a],null,this.namespace,this),this.set(r[a],e[r[a]].value)),t.savePrefToSession(`${this.namespace}[${r[a]}]`,this.get(r[a])),e[r[a]].widgetSetting&&i.addWidgetPreference(r[a],e[r[a]].widgetSetting,this.get(r[a])),widget.setValue(this.namespace+"["+r[a]+"]",this.get(r[a]))}n()})})}return e.Class.singleton({init:function(){this.namespace="",this.userSettings={},this.__updateSessionCacheTimestamp__=!0},get:function(e){return this.userSettings[e].value},set:function(e,t){this.userSettings[e].value=t},hasPref:function(e){return this.userSettings.hasOwnProperty(e)},sync:function(e,t,i,n){let o=this;return o.hasPref(t)&&(i=i||t,"function"==typeof n&&o.userSettings[t].callbackList.push(n),Object.defineProperty(e,i,{enumerable:!0,configurable:!0,get:function(){return o.get(t)},set:function(e){o.set(t,e)}})),e},unsync:function(e,t,i,n){let o=e[i=i||t];delete e[i],e[i]=o;var r="function"==typeof n?this.userSettings[t].callbackList.indexOf(n):-1;return r>=0&&this.userSettings[t].callbackList.splice(r,1),e},loadSettingsFromConfigPromise:function(e){return i.addWidgetPrefs("V2"),new Promise((s,a)=>{function l(){i.addWidgetPreference("saveToWidgetOnly",{type:"boolean",label:n.saveToWidgetOnly,defaultValue:!1}),s()}require([e.configPath],e=>{this.namespace=e.namespace;var n=function(e,t){var i={};return function e(n,o){for(let s of Object.keys(n))if("namespace"!==s)if(n[s].hasOwnProperty("value")){var r=null!=o&&o.constructor===String?o+t+s:s;i[r]={value:n[s].value},n[s].hasOwnProperty("V1Preference")&&(i[r].V1Preference=n[s].V1Preference),n[s].hasOwnProperty("widgetSetting")&&(i[r].widgetSetting=n[s].widgetSetting)}else e(n[s],null!=o&&o.constructor===String?o+t+s:s)}(e),i}(e,".");i.isV1ToV2PrefMigrationComplete(this.namespace,()=>{r.bind(this)(n,l)},()=>{i.addWidgetPrefs("V2Migrate"),i.loadDefaults("compare_widget_default_prefs",()=>t.setPreferencesToWidget(["compare_viewer_selectmode","compare_attributes_display_option","compare_attributes_not_shown","compare_attributes_not_shown_INST","compare_attributes_not_shown_EFF"],["viewer_display_mode","attributes_display_option","attributes_not_shown","attributes_not_shown_INST","attributes_not_shown_EFF"],()=>{this.disablePrefsTimestampUpdate(),Object.keys(n).forEach(e=>{if("string"==typeof n[e].V1Preference&&n[e].V1Preference.length){let t=widget.getValue(n[e].V1Preference);this.userSettings[e]=o(e,null,this.namespace,this),this.set(e,t||n[e].value)}else if(Array.isArray(n[e].V1Preference)&&n[e].V1Preference.length){var t=n[e].V1Preference.reduce((e,t)=>{let i=Object.keys(t)[0];return widget.getValue(i)===t[i].oldValue&&e.push(t[i].newValue),e},[]);this.userSettings[e]=o(e,null,this.namespace,this),this.set(e,t.length?t:n[e].value)}else if("object"==typeof n[e].V1Preference){let t=n[e].V1Preference,i=Object.keys(t)[0],r=void 0;for(let e=0;e<t[i].length;e++)if(widget.getValue(i)===t[i][e].oldValue){r=t[i][e].newValue;break}this.userSettings[e]=o(e,null,this.namespace,this),this.set(e,void 0!==r?r:n[e].value)}else this.userSettings[e]=o(e,null,this.namespace,this),this.set(e,n[e].value);n[e].widgetSetting&&i.addWidgetPreference(e,n[e].widgetSetting,this.get(e)),widget.setValue(this.namespace+"["+e+"]",this.get(e))}),i.setV1ToV2PrefMigrationCompletedFlag(this.namespace).then(l)}))})})})},loadSettingsPromise:function(e){let t=this;return new Promise(i=>{let n={};e.forEach(e=>n[e]={value:null}),r.bind(t)(n,i)})},disablePrefsTimestampUpdate:function(){this.__updateSessionCacheTimestamp__=!1},enablePrefsTimestampUpdate:function(){this.__updateSessionCacheTimestamp__=!0},savePrefsTimestampAndEnableUpdate:function(){let e=Date.now();t.savePrefTimestampToDashboardPromise(this.namespace,e).then(()=>{t.savePrefTimestampToSession(this.namespace,e),this.enablePrefsTimestampUpdate()},()=>{})},resetSettings:function(){this.init()}})}),define("DS/CompareWidget2/viewComponents/ContextMenuBase",["UWA/Class"],function(e){"use strict";return e.extend({createContextMenu:function(){return[]}})}),define("DS/CompareWidget2/plugins/EXPORT/exFormatter",["DS/CompareCommon/Utils","i18n!DS/CompareWidgetUtils/assets/nls/CompareExport","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,i){function n(e,t){var i=!1;if(null==e&&null!=t||null!=e&&null==t)i=!0;else if(e.length!=t.length)i=!0;else if(e.constructor!=t.constructor)i=!0;else if(e.constructor!=Array)e!=t&&(i=!0);else for(var n=0;n<e.length;n++)e[n]!=t[n]&&(i=!0);return i}function o(e){let t=Array.isArray(e)?e.length:0;e=e||[];for(var i={},n=0;n<t;n++)if(!e[n]||"thumbnail"!=e[n].type){var o=e[n]?e[n].getFormattedValue():null;i[`${e[n].name}`]=o}return i}function r(e,i){let o="",r=Array.isArray(e)?e.length:Array.isArray(i.length)?i.length:0;e=e||[],i=i||[];for(var s=0;s<r;s++){if(e[s]&&"thumbnail"==e[s].type||i[s]&&"thumbnail"==i[s].type)continue;var a=e[s]?e[s].nls:null,l=i[s]?i[s].nls:null,u=e[s]?e[s].getFormattedValue():null,c=i[s]?i[s].getFormattedValue():null;if(n(u,c))""!==o&&(o+="\r\n"),o+=t.replace(t.get("ReferenceAttribute"),{attributeName:a,attributeValue:u})+", "+t.replace(t.get("ComparedAttribute"),{attributeName:l,attributeValue:c})}return o}function s(t,i){var n="";let o=e.intersectionDifference(t,i,(e,t)=>e.name===t.name),s=o[0].intersection,a=o[1].intersection,l=o[0].difference,u=o[1].difference;return n+=r(s,a)+r(l,null)+r(null,u)}function a(e,t){if(relName="",null!=t){let n=t[e];if(null!=n&&""!==n){let e=i[n.NLS];null!=e&&""!==e&&(relName=e)}}return relName}function l(e,t){var i=a(e,t.CUSTOM_MATCH_ADJ_FLAGS);return""===i&&""===(i=a(e,t.CUSTOM_RULE_ID_FLAGS))&&(i=a(e,t.SYSTEM_RULE_ID_FLAGS)),i}var u={createOutputTables:function(e,t,i,n,o){var r=[],a="list"==e;return i.forEach(function(e){var i=null;a?i=e.getCRList().getMatchPairArray():i=e.getMatchPairArray();i.forEach(function(e){var i="",u="",c="",d="",p="",h="",_="",f="",g="onPremise",m="",S="",C=[],T=[],E="",v="",I="",y="",D="",R="",b="",O="",A="onPremise",N="",P="",w=[],L=[],U=e.getBaseNode();if(0==U.isDummy()){c=(i=U.getObjIDSpec_REF()).getPhysID(),d=(u=U.getObjIDSpec_INST())?u.getPhysID():null,p=U.getTitle(),null!=(h=U.getAttr("revision"))&&""!==h&&(p+=" "+h),_=U.getType(),f=U.qty,g=i.getTenant(),m=i.getServiceName(),S=i.getSecurityContext();let e=t.REFERENCE._getFromCache(g,m,S,c);if(null!==e){C=e.attrVals;let t=e.getAttrByName("type");null!=t&&(_=t.value)}if(u&&null!=t.INSTANCE){let e=t.INSTANCE._getFromCache(g,m,S,d);null!==e&&(T=e.attrVals)}}var F=e.getCompNode();if(0==F.isDummy()){I=(E=F.getObjIDSpec_REF()).getPhysID(),y=(v=F.getObjIDSpec_INST())?v.getPhysID():null,D=F.getTitle(),null!=(R=F.getAttr("revision"))&&""!==R&&(D+=" "+R),b=F.getType(),O=F.qty,A=E.getTenant(),N=E.getServiceName(),P=E.getSecurityContext();let e=t.REFERENCE._getFromCache(A,N,P,I);if(null!==e){w=e.attrVals;let t=e.getAttrByName("type");null!=t&&(b=t.value)}if(v&&null!=t.INSTANCE){let e=t.INSTANCE._getFromCache(A,N,P,y);null!==e&&(L=e.attrVals)}}var M=e.getRelName();Array.isArray(o)&&o.indexOf(M)>=0&&(M="IDENTICAL");var x=l(M,n);""!==x&&(M=x);var V=e.getDepth(),W=_||b,j=F.isDummy()||U.isDummy(),B=j?"":s(C,w),k=j?"":s(T,L),H=null;H=a?[f,p,O,D,W,M,B]:[V,p,D,W,M,B,k],r.push(H)})}),r},createOutputTablesNewFormat:function(e,t,i,n,r,s){var a=[];a.push(...s);var u=[],c="list"==e;return i.forEach(function(e){var i=null;c?i=e.getCRList().getMatchPairArray():i=e.getMatchPairArray();i.forEach(function(e){var i="",s="",d="",p="",h="",_="onPremise",f="",g="",m=[],S=[],C=[],T="",E="",v="",I="",y="",D="onPremise",R="",b="",O=[],A=[],N=[],P=e.getBaseNode();if(0==P.isDummy()){d=(i=P.getObjIDSpec_REF()).getPhysID(),p=(s=P.getObjIDSpec_INST())?s.getPhysID():null,baseTitle=P.getTitle(),h=P.qty,_=i.getTenant(),f=i.getServiceName(),g=i.getSecurityContext();let e=t.REFERENCE._getFromCache(_,f,g,d);if(null!==e&&(m=e.attrVals),s){if(null!=t.INSTANCE){let e=t.INSTANCE._getFromCache(_,f,g,p);null!==e&&(S=e.attrVals)}if(null!=t.EFFECTIVITY){let e=t.EFFECTIVITY._getFromCache(_,f,g,p);null!==e&&(C=e.attrVals)}}}var w=e.getCompNode();if(0==w.isDummy()){v=(T=w.getObjIDSpec_REF()).getPhysID(),I=(E=w.getObjIDSpec_INST())?E.getPhysID():null,compTitle=w.getTitle(),y=w.qty,D=T.getTenant(),R=T.getServiceName(),b=T.getSecurityContext();let e=t.REFERENCE._getFromCache(D,R,b,v);if(null!==e&&(O=e.attrVals),E){if(null!=t.INSTANCE){let e=t.INSTANCE._getFromCache(D,R,b,I);null!==e&&(A=e.attrVals)}if(null!=t.EFFECTIVITY){let e=t.EFFECTIVITY._getFromCache(D,R,b,I);null!==e&&(N=e.attrVals)}}}var L=e.getRelName();Array.isArray(r)&&r.indexOf(L)>=0&&(L="IDENTICAL");var U=l(L,n);""!==U&&(L=U);var F,M,x,V=e.getDepth(),W=e.getLevel(),j=[],B=[],k=[];P.isDummy()?(j="",B="",k=""):(j=o(m),B=o(S),k=o(C)),w.isDummy()?(F="",M="",x=""):(F=o(O),M=o(A),x=o(N));var H=[],G=!1;if((P.isHeaderRow()||w.isHeaderRow())&&(H.push(""),H.push(""),H.push(""),H.push(P._attrList.title),H.push(w._attrList.title),G=!0),!1===G)if(c){H.push(L),H.push(h),H.push(y);for(var Y=H.length;Y<a.length;Y++)a[Y].isLeftSide?a[Y].isInst?H.push(B[a[Y].name]):a[Y].isEffectivity?H.push(k[a[Y].name]):H.push(j[a[Y].name]):a[Y].isInst?H.push(M[a[Y].name]):a[Y].isEffectivity?H.push(x[a[Y].name]):H.push(F[a[Y].name])}else{H.push(L),H.push(W),H.push(V);for(Y=H.length;Y<a.length;Y++)a[Y].isLeftSide?a[Y].isInst?H.push(B[a[Y].name]):a[Y].isEffectivity?H.push(k[a[Y].name]):H.push(j[a[Y].name]):a[Y].isInst?H.push(M[a[Y].name]):a[Y].isEffectivity?H.push(x[a[Y].name]):H.push(F[a[Y].name])}H.forEach((e,t)=>{void 0===e&&(H[t]="")}),u.push(H)})}),u},getHeaderRow:function(e,t,i,n){var o=[],r="list"==e;return Object.keys(n).forEach(function(e){-1==n[e].indexOf("thumbnailimage")&&n[e].push("thumbnailimage")}),u.createHeaderRow(r,t,i,n,o),o},createHeaderRow:function(e,i,n,o,r){var s=[],a=[],l=[],c=o.REF,d=o.INST,p=o.EFF;n.forEach(function(t){var n=null;e?n=t.getCRList().getMatchPairArray():n=t.getMatchPairArray();n.forEach(function(e){var t="",n="",o="",r="",h="onPremise",_="",f="",g=[],m=[],S=[],C="",T="",E="",v="",I="onPremise",y="",D="",R=[],b=[],O=[],A=e.getBaseNode();if(0==A.isDummy()){o=(t=A.getObjIDSpec_REF()).getPhysID(),r=(n=A.getObjIDSpec_INST())?n.getPhysID():null,h=t.getTenant(),_=t.getServiceName(),f=t.getSecurityContext();let e=i.REFERENCE._getFromCache(h,_,f,o);if(null!==e&&(g=e.attrVals),n){if(null!=i.INSTANCE){let e=i.INSTANCE._getFromCache(h,_,f,r);null!==e&&(m=e.attrVals)}if(null!=i.EFFECTIVITY){let e=i.EFFECTIVITY._getFromCache(h,_,f,r);null!==e&&(S=e.attrVals)}}}var N=e.getCompNode();if(0==N.isDummy()){E=(C=N.getObjIDSpec_REF()).getPhysID(),v=(T=N.getObjIDSpec_INST())?T.getPhysID():null,I=C.getTenant(),y=C.getServiceName(),D=C.getSecurityContext();let e=i.REFERENCE._getFromCache(I,y,D,E);if(null!==e&&(R=e.attrVals),T){if(null!=i.INSTANCE){let e=i.INSTANCE._getFromCache(I,y,D,v);null!==e&&(b=e.attrVals)}if(null!=i.EFFECTIVITY){let e=i.EFFECTIVITY._getFromCache(I,y,D,v);null!==e&&(O=e.attrVals)}}}u.gatherHeaderAttrs(s,g,c,!1,!1),u.gatherHeaderAttrs(s,R,c,!1,!1),u.gatherHeaderAttrs(a,m,d,!0,!1),u.gatherHeaderAttrs(a,b,d,!0,!1),u.gatherHeaderAttrs(l,S,p,!1,!0),u.gatherHeaderAttrs(l,O,p,!1,!0)})}),e?(r.push(...s),r.unshift({name:"compQty",displayName:`${t.Quantity+" 2"}`,isLeftSide:!1}),r.unshift({name:"baseQty",displayName:`${t.Quantity+" 1"}`,isLeftSide:!0})):r.push(...s,...a,...l),e||(r.unshift({name:"depth",displayName:t.Depth}),r.unshift({name:"level",displayName:t.Level})),r.unshift({name:"relName",displayName:t.ComparisonStatus})},gatherHeaderAttrs:function(i,n,o,r,s){n.forEach(n=>{if(n.hasOwnProperty("name")&&!o.includes(n.name)&&!i.some(e=>e.name===n.name)){var a=r?t.InstanceAttrDiapNamePostfix:"";e.isTitleAttr(n,r)?(i.unshift({name:n.name,displayName:`${n.nls+" 2"+a}`,isLeftSide:!1,isInst:r,isEffectivity:s}),i.unshift({name:n.name,displayName:`${n.nls+" 1"+a}`,isLeftSide:!0,isInst:r,isEffectivity:s})):(i.push({name:n.name,displayName:`${n.nls+" 1"+a}`,isLeftSide:!0,isInst:r,isEffectivity:s}),i.push({name:n.name,displayName:`${n.nls+" 2"+a}`,isLeftSide:!1,isInst:r,isEffectivity:s}))}})},stripHeaderData:function(e){strippedHeaderRow=[];for(var t=0;t<e.length;t++)strippedHeaderRow.push(e[t].displayName);return strippedHeaderRow}};return u}),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/expandMgr",["DS/CompareWidget2/plugins/STRUCTURE/expanders/cvExpand","DS/CompareWidget2/plugins/STRUCTURE/expanders/cvProgressiveExpand","DS/CompareWidget2/plugins/STRUCTURE/expanders/fileExpand","DS/CompareWidget2/plugins/STRUCTURE/expanders/compareServiceExpand","DS/CompareWidget2/plugins/STRUCTURE/expanders/lifecycleServicesExpand","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/nodeOccRel2RefInstTree","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/cv2RefInstTree","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/pe2RefInstTree","i18n!DS/CompareWidget2/assets/nls/DisplayMessages"],function(e,t,i,n,o,r,s,a,l){var u={CV_DIRECT:{expander:e,adapter:s},CV_SERVICE:{expander:n,adapter:r},DB_SERVICE:{expander:n,adapter:r},CV_PROGRESSIVE:{expander:t,adapter:a},LC_IDX_SERVICE:{expander:o,adapter:s},LC_AUTH_SERVICE:{expander:o,adapter:s},FILE_EXPAND:{expander:i,adapter:r}};return{expandUsingType:function(e,t,i,n,o){return new Promise(function(r,s){var a=u[t];if(null==a){var c="UNKNOWN EXPAND TYPE: '"+t+"'";n.errout(c),s(c)}return a.expander.doExpand(e,t,i,n,o).then(function(i){var u=i;if(o._ODT_FailFirstFetch&&s("ODT: failing initial fetch"),null==u||0==u.length)n.showAlertBox("RETURN_IS_BLANK",l,"warning"),s("Object query returned blank - was the root filtered out?");else{n.dbgout("Expand via '"+t+"' successful for ID: "+e.getPhysID());var c=null;null==(c=null!=a.adapter?a.adapter.convert(e,u,n,o):u)?s("Adapter has failed..."):(c.sortChildren(),r(c))}},function(e){n.warnout("Failed to expand using "+t+" ::"+e),s(e)})})},doExpand:function(e,t,i,n,o,r){var s=this;return new Promise(function(a,l){s.expandUsingType(e,t,n,o,r).then(function(e){a(e)},function(t){o.warnout("Primary expansion failed: "+t),null==i?(o.errout("No secondary expand Type; can't continue!"),l(t)):(o.warnout("Attempting to expand using secondary expandType"),s.expandUsingType(e,i,n,o,r).then(function(e){o.warnout("Secondary expansion success"),a(e)},function(e){o.warnout("Secondary expansion failed: "+e),l(e)}))})})}}}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/statusVisibilityDialog",["UWA/Class","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Toggle","DS/Controls/ButtonGroup","i18n!DS/CompareWidget2/assets/nls/CompareV2","i18n!DS/UIKIT/assets/nls/UIKIT","css!DS/CompareWidget2/CompareWidget2.css"],function(e,t,i,n,o,r,s,a){return e.extend({init:function(e){this._parent({}),this.OKfn=e.OKfn,this.statusVisibility={},Object.keys(e.statuses).forEach(t=>"IDENTICAL"!==t&&(this.statusVisibility[t]=e.statuses[t].visibleFlag)),this.content=this._buildContent(e.statuses),this.immersiveFrame=new t,this.immersiveFrame.inject(widget._isODTMode()?document.body:widget.body),this.dialog=new i({title:s.chooseStatusToDisplay,content:this.content,immersiveFrame:this.immersiveFrame,resizableFlag:!0,visibleFlag:!0,modalFlag:!0,width:230,buttons:{Ok:new n({label:a.ok,onClick:this._OKfn.bind(this),disabled:!1,emphasize:"primary"}),Cancel:new n({label:a.ko,onClick:this._close.bind(this),disabled:!1,emphasize:"secondary"})}}),this.dialog.addEventListener("close",this._close.bind(this))},_buildContent:function(e){function t(e){let t=e.checkFlag;e.elements.checkSign.setStyles({"background-color":!0===t?e.color:"","border-color":!0===t?e.color:""})}let i=new r({type:"checkbox"});return Object.keys(this.statusVisibility).forEach(n=>{let r=e[n],s=new o({type:"switch",label:r.label,value:r.name,checkFlag:r.visibleFlag});s.color=r.color,s.id=n,t(s),s.addEventListener("buttonclick",()=>{t(s),this.statusVisibility[s.id]=s.checkFlag}),i.addChild(s)}),i},_close:function(){this.dialog.removeEventListener("close",this._close.bind(this)),this.dialog.destroy(),this.immersiveFrame.destroy()},_OKfn:function(){this._close(),setTimeout(()=>{this.OKfn(this.statusVisibility)},20)}})}),define("DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/nodeOccRel2RefInstTree",["DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/exAdapter","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_tree","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_node","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj"],function(e,t,i,n){var o=function(e){this._objIDSpec=e,this._dbObjREFByNodeID={},this._occurByID={},this._occurRelArray=[],this._rootOccurID=0,this._refInstNodeByOccurID={}};return o.prototype.addNodes=function(e,t,i,n){var o=this;e.forEach(function(e){var r=t;void 0!==e.serviceId&&null!==e.serviceId&&""!==e.serviceId&&(r=e.serviceId),void 0!==e.proxySpec&&null!==e.proxySpec&&""!==e.proxySpec&&void 0!==e.proxySpec.serviceURL&&null!==e.proxySpec.serviceURL&&""!==e.proxySpec.serviceURL&&(r=e.proxySpec.serviceURL);var s=o.node2dbObjREF(e,r,i,n);o._dbObjREFByNodeID[e.nodeid]=s})},o.prototype.setRootOccurID=function(e){this._rootOccurID=e},o.prototype.node2dbObjREF=function(e,t,i,o){var r=function(e,n,r){if("icon"==n){var s={smallURL:o.makeServiceURL(t,i,r,null),largeURL:""};e.setAttr("typeIcons",s)}else if("cgrurl"==n&&r){var a=r.indexOf("?"),l=r.substr(0,a),u=r.substr(a+1),c=o.makeServiceURL(t,i,l,u);e.setAttr("thumbnail_3d",c),e.addAttr("ds6w:globaltype","ds6w:Document")}else{var d={"PLMEntity.V_Name":"ds6w:label",revision:"ds6wg:revision",type:"ds6w:type","PLMReference.V_DerivedFrom":"dfr"}[n];null==d&&(d=n),e.setAttr(d,r)}},s=new n;return Object.keys(e).forEach(function(t){if("attributes"==t){Object.keys(e.attributes).forEach(function(t){var i=e.attributes[t];r(s,t,i)})}else{var i=e[t];r(s,t,i)}}),null==s.getAttr("ds6w:globaltype")&&s.addAttr("ds6w:globaltype","ds6w:Part"),s},o.prototype.addOccurs=function(e,t){var i=this;e.forEach(function(e){var t={};Object.keys(e).forEach(function(i){var n=e[i];!function(e,t,i){if("xform"==t){var n=JSON.parse(JSON.stringify(i));n.splice(15,1),n.splice(11,1),n.splice(7,1),n.splice(3,1);for(var o=n.length,r=0;r<o;r++){var s=n[r];Number.isInteger(s)&&(n[r]=s.toFixed(1))}e.matrixtxt=attrVal2use=n.join(),e.matrixtxt=e.matrixtxt.replace(/e/g,"E")}else{var a={"logicalid[connection]":"logicalid"}[t];null==a&&(a=t),e[a]=i}}(t,i,n)}),i._occurByID[e.occurrenceid]=t})},o.prototype.addOccurRels=function(e){this._occurRelArray=e},o.prototype.buildTree=function(){var e=this,o=e._occurByID[e._rootOccurID].nodeid,r=e._dbObjREFByNodeID[o],s=new i(r,null);e._refInstNodeByOccurID[e._rootOccurID]=s,this._occurRelArray.forEach(function(t){var o=t.child,r=e._occurByID[o],s=new n,a=t.relationship;s.addAttr("ds6w:type",a),Object.keys(r).forEach(function(e){var t=r[e];s.addAttr(e,t)}),s.addAttr("physicalid",t.physicalid),s.addAttr("ds6w:globaltype","Instance"),s.addAttr("ro.plminstance.v_treeorder",t.treeOrder);var l=r.nodeid,u=e._dbObjREFByNodeID[l],c=new i(u,s);e._refInstNodeByOccurID[o]=c});var a=new t(e._objIDSpec),l=e._refInstNodeByOccurID[e._rootOccurID];return a.setRoot(l),this._occurRelArray.forEach(function(t){var i=t.parent,n=e._refInstNodeByOccurID[i],o=t.child,r=e._refInstNodeByOccurID[o];n.addChild(r),r.setParent(n)}),a},e.singleton({jsClass:"NODE_OCCUR_REL2REFINST_TREE",convert:function(e,t,i,n){var r=new o(e);r.addNodes(t.nodes,e.getServiceName(),e.getTenant(),i),r.addOccurs(t.occurrences,i),r.addOccurRels(t.occurrencerelationships),r.setRootOccurID(t.rootoccurrence);var s=r.buildTree();return r=null,s}})}),define("DS/CompareWidget2/plugins/STRUCTURE/relations/Ecosystem",["UWA/Class","DS/LifecycleServices/LifecycleServicesSettings","DS/WAFData/WAFData","i18n!DS/CompareWidget/assets/nls/CompareWidget"],function(e,t,i,n){var o=e.extend({init:function(e){this._parent({}),this.rels=e,this.idObjMap=this.buildIdObjMap(e),this.formated=this.format(e)},addTo:function(e){for(var t=this.newAsm(e),i=Object.keys(this.formated),n=0;n<i.length;n++)this.addSourceToAsm(i[n],t)},addRootSourceToAttributes:function(e){for(var t=this.rels.New.Objects,i=0;i<t.length;i++){var n=t[i],o=e[n.id];null!=o&&(n.rootSource=o.rootSource)}},getLinkedObjectIds:function(){for(var e=[],t=(this.rels.New.Objects,this.rels.New.Links),i=0;i<t.length;i++){var n=t[i].target;-1==e.indexOf(n)&&e.push(n)}return e},format:function(e){for(var t={},i=0;i<e.New.Links.length;i++){var n=e.New.Links[i];null==t[n.source]&&(t[n.source]={});var o=t[n.source],r=n.type+"."+n.name;null==o[r]&&(o[r]=[]),o[r].push(n.target)}return t},buildIdObjMap:function(e){for(var t={},i=e.New.Objects,n=0;n<i.length;n++){var o=i[n];t[o.id]=o}return t},addSourceToAsm:function(e,t){for(var i=t.getOccs(e),n=0;n<i.length;n++)this.addSourceToOcc(e,i[n],t)},addSourceToOcc:function(e,t,i){for(var n=this.formated[e],o=Object.keys(n),r=0;r<o.length;r++){var s=o[r];this.addCategoryToSourceOcc(n,s,t,i)}},addCategoryToSourceOcc:function(e,t,i,n){var r=o.relationLabels[t];if(null!=r)for(var s=this.addToOcc(t,{Title:r.label,icon:r.icon,physicalid:t,attributes:{revision:" "}},i,n),a=e[t],l=0;l<a.length;l++){var u=a[l],c=this.idObjMap[u],d={Title:c["ds6w:label"],icon:c.icon_url,physicalid:c.id,type:c["ds6w:type"],attributes:{revision:c.revision,name:c["ds6w:identifier"],"revision-physicalid":c.id,"PLMReference.V_DerivedFrom":c.rootSource}};this.addToOcc(u,d,s,n)}},addToOcc:function(e,t,i,n){var o=n.addNode(e,t),r=n.addOcc(o.nodeid);return n.addRel(i.occurrenceid,r.occurrenceid),r},newAsm:function(e){return{asm:e,getOccs:function(e){if(this.pidOccsMap=this.pidOccsMap||{},void 0===this.pidOccsMap[e]){this.pidOccsMap[e]=[];for(var t=0;t<this.asm.occurrences.length;t++){var i=this.asm.occurrences[t];e==this.asm.nodes[i.nodeid].physicalid&&this.pidOccsMap[e].push(i)}}return this.pidOccsMap[e]},getChildOcc:function(e,t){for(var i=0;i<this.asm.occurrencerelationships.length;i++){var n=this.asm.occurrencerelationships[i];if(n.parent==e){var o=this.asm.occurrences[n.child];if(this.asm.nodes[o.nodeNdx].physicalid==t)return o}}return null},getNode:function(e){if(this.pidNodeMap=this.pidNodeMap||{},void 0===this.pidNodeMap[e]){for(var t=0;t<this.asm.nodes.length;t++){var i=this.asm.nodes[t];i.physicalid==e&&(this.pidNodeMap[e]=i)}void 0===this.pidNodeMap[e]&&(this.pidNodeMap[e]=null)}return this.pidNodeMap[e]},addNode:function(e,t){var i=this.getNode(e);return null!=i?i:((i=t).nodeid=this.asm.nodes.length,this.asm.nodes.push(i),this.pidNodeMap[e]=i,i)},addOcc:function(e){var t={occurrenceid:this.asm.occurrences.length,nodeid:e,xform:["n/a"]};return this.asm.occurrences.push(t),t},addRel:function(e,t){var i={parent:e,child:t};this.asm.occurrencerelationships.push(i)}}}});function r(e,n,o,r){var s=widget.getValue("x3dPlatformId"),a=t.get3DSpaceWSUrl(s,e);i.authenticatedRequest(a,{method:"POST",type:"json",timeout:12e4,data:JSON.stringify(n),headers:{Accept:"application/json","Content-Type":"application/json"},onComplete:o,onFailure:r})}return o.docRels=["v6_specdoc_to","v6_annexdoc_to"],o.otherRels=["SpaceAssignment_to","RFL_implementScope_from","RFL_implementScope_to","ProposedSolution_to"],o.relationLabels={"SpaceAssignment_to.472":{label:n.spaceAssignment,icon:" "},"RFL_implementScope_from.52":{label:n.implementedBy,icon:" "},"RFL_implementScope_to.51":{label:n.implementing,icon:""},"ProposedSolution_to.ProposedSolution":{label:n.proposedSolutions,icon:""},"v6_specdoc_to.87":{label:n.attachedDocuments,icon:""},"v6_annexdoc_to.Reference Document":{label:n.attachedDocuments,icon:""},"v6_specdoc_to.SpecificationDocument":{label:n.specificationDocuments,icon:""}},o.get=function(e,t,i,n){null!=e&&t.length>0?function(e,t,i,n){var s={relations:t,countmanagement:!1,debug:!1,trueREST:!0,widgetId:widget.id,timeout:"6000",ids:e};"compareWidgetOdtId"==widget.id&&(s=null),r("/resources/enorelnav/navigate/getecosystem",s,function(e){var t=new o(e);i(t)}.bind(this),n)}(e,t,function(e){var t=e.getLinkedObjectIds();t.length>0?function(e,t,i){for(var n=[],o=0;o<e.length;o++)n.push({id:e[o]});r("/resources/compare/index/fetchRootSource",{data:n},t,i)}(t,function(t){e.addRootSourceToAttributes(t),i(e)},n):i(e)},n):i(null)},o}),define("DS/CompareWidget2/plugins/VIEW3D/ViewPanel/XSelectManager",["DS/Selection/CSOManager","DS/Selection/HSOManager","DS/ApplicationFrame/CommandsManager"],function(e,t,i){var n=function(e){this._plugSvcs=e,this._onPostAddCSOManagerToken=null,this._onPostRemoveCSOManagerToken=null,this._updateState="NONE",this.hookupCrossSelectionCallbacks()};function o(){const e=i.getCommand("PAD3DViewerNavigateOnSelectionHdr",null);return e&&Array.isArray(e._selection)&&e._selection.length}return n.prototype.destroy=function(){null!=me._onPostAddCSOManagerToken&&(e.unsubscribe(me._onPostAddCSOManagerToken),me._onPostAddCSOManagerToken=null),null!=me._onPostRemoveCSOManagerToken&&(e.unsubscribe(me._onPostRemoveCSOManagerToken),me._onPostRemoveCSOManagerToken=null)},n.prototype.getUpdateState=function(){return this._updateState},n.prototype.setUpdateState=function(e){this._updateState=e},n.prototype.hookupCrossSelectionCallbacks=function(){var t=this;null!=t._onPostAddCSOManagerToken&&e.unsubscribe(t._onPostAddCSOManagerToken),t._onPostAddCSOManagerToken=e.onPostAdd(function(n){if("FOCUSON"!==t.getUpdateState()&&o()&&t.setUpdateState("FOCUSON"),"NONE"===t.getUpdateState()||"FOCUSON"===t.getUpdateState()){"NONE"==t.getUpdateState()&&t.setUpdateState("INTERNAL");let o=e.get();if(o.length>2){const e=i.getCommand("LevelSelectorHdr",null);null!=e&&e.endExecute()}t._onViewerSelection(n,o,t._plugSvcs)}}),null!=t._onPostRemoveCSOManagerToken&&e.unsubscribe(t._onPostRemoveCSOManagerToken),t._onPostRemoveCSOManagerToken=e.onPostRemove(function(i){if("EXTERNAL"!=t.getUpdateState()){let n=e.get().splice();t._onViewerSelection(i,n,t._plugSvcs)}})},n.prototype.notifyClearHighlights=function(){e.empty(),t.empty()},n.prototype.notifyNewHighlights=function(i,n){try{var r=this;if("FOCUSON"!==r.getUpdateState()||o()||r.setUpdateState("INTERNAL"),"NONE"==r.getUpdateState()){r.setUpdateState("EXTERNAL");e.get();e.empty(),t.empty(),i.length>0&&!1!==n&&(e.add(i),t.add(i)),r.setUpdateState("NONE")}else"FOCUSON"==r.getUpdateState()?(t.empty(),i.length>0&&t.add(i)):r.setUpdateState("NONE")}catch(e){r._plugSvcs.errout("EXCEPTION working with CSO/HSO managers: "+e)}},n.prototype._onViewerSelection=function(e,t){var i=t.length;if(i>0){this._plugSvcs.dbgout("XSELECT","structComparePanel._onViewerSelection "+i+" selections");var n=function(e){var t=[];return e.forEach(function(e){for(var i="",n=e.pathElement.externalPath,o=1;o<n.length;o++){var r=n[o].modelIdentification;if(null!=r){var s=r.lastIndexOf(".");i+="/"+r.substr(0,s)}}t.push(i)}),t}(t);this._plugSvcs.postEvent("3DVIEW_NODES_SELECTED_EVENT",{nodePathArray:n})}else this._plugSvcs.dbgout("XSELECT","structComparePanel._onViewerSelection 0 selections (clear)"),this._plugSvcs.postEvent("3DVIEW_ALL_NODES_UNSELECTED_EVENT",{})},n}),define("DS/CompareWidget2/plugins/STRUCTURE/refInstTree/hierResultList",[],function(){var e=function(e,t){this._nodePair_byIndexArray=[],this._riNodeArray_base=e,this._riNodeArray_comp=t,this.indexMax_base=e.length,this.indexMax_comp=t.length};return e.prototype.destroy=function(){this._nodePairIndexArray=null,this._riNodeArray_base=null,this._riNodeArray_comp=null},e.prototype.add=function(e,t,i,n,o,r,s){var a=this,l={index_base:e,index_comp:t,relIndex:i,relName:n,adjIndex:o,adjFlagArray:r,instFlagNdxs:s||[]};null==a._nodePair_byIndexArray[i]&&(a._nodePair_byIndexArray[i]=[]),null==a._nodePair_byIndexArray[i][o]&&(a._nodePair_byIndexArray[i][o]=[]),a._nodePair_byIndexArray[i][o].push(l)},e.prototype.getResult=function(){var e=this,t=new Array(e.indexMax_base),i=new Array(e.indexMax_comp),n=[];e._nodePair_byIndexArray.forEach(function(o,r){o.forEach(function(o,r){o.forEach(function(o){var s=o.index_base,a=o.index_comp;if(null==t[s]&&null==i[a]){t[s]="X",i[a]="X";var l={riNode_base:e._riNodeArray_base[s],riNode_comp:e._riNodeArray_comp[a],relName:o.relName,adjustment:r,adjFlagArray:o.adjFlagArray,instFlagNdxs:o.instFlagNdxs||[]};n.push(l)}})})});for(var o=[],r=t.length,s=0;s<r;s++)null==t[s]&&o.push(e._riNodeArray_base[s]);for(var a=[],l=i.length,u=0;u<l;u++)null==i[u]&&a.push(e._riNodeArray_comp[u]);return{riMatchedNodePairArray:n,riUnmatchedNodeArray_base:o,riUnmatchedNodeArray_comp:a}},e}),define("DS/CompareWidget2/userSettings/SettingsBase",["i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e){"use strict";return{namespace:"",compareSettings:{},viewSettings:{PROP_VIEW:{showOnlyDifferences:{value:!1},attributes_display_option:{value:"",V1Preference:"compare_attributes_display_option"},default_attributes:{value:["label","owner","current","modified","type","originated","revision"]},attributes_always_shown:{value:["label"]},attributes_not_shown:{value:"",V1Preference:"compare_attributes_not_shown"}},STRUCT_VIEW:{display_mode:{value:"tree"},statuses_to_hide:{value:[],V1Preference:[{openness_revisions:{oldValue:!0,newValue:"REVISION"}},{openness_duplicates:{oldValue:!0,newValue:"DUPE"}}]},statuses_unchecked:{value:[]},multi_statuses_to_hide_and:{value:!1,widgetSetting:{type:"boolean",label:e.uncheckBothPrimaryAndSecondary,defaultValue:!1}},show_3dshape_of_3dpart:{value:!1,widgetSetting:{type:"boolean",label:e.show3dShapeOf3dPart,defaultValue:!1}}}},exportSettings:{exportOldFormat:{value:!1,widgetSetting:{type:"boolean",label:e.exportOldFormat,defaultValue:!1}}}}}),define("DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInstTreeEditor",["DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj"],function(e){function t(t,i,n,o,r){var s=!1,a=!1,l=null;return null==o?a=!0:null!=(l=function(e,t,i){var n=function(e,t,i){var n=[];return e.visit_riTreeAndFN(function(e){if(e.getAttr("INST.physicalid")==i){var o=e.getParent();(null!=o?o.getAttr("REF.physicalid"):null)==t&&n.push(o)}return!0}),n}(e,t,i);return n.forEach(function(e){e.rmChild(i)}),n}(t,n,o))&&(a=!0),1==a&&(s=null==r||function(t,i,n,o,r){var s=!1;null==r&&(r=function(e,t){var i=[];return e.visit_riTreeAndFN(function(e){e.getAttr("REF.physicalid")==t&&i.push(e)}),i}(t,n));var a=null;return i.forEach(function(e){e.getObjIDSpec().getPhysID()!=o||(a=e)}),null!=a&&(r.forEach(function(t){var i=new e;i.setAttr("did",null),i.setAttr("ds6w:type","VPMInstance"),i.setAttr("logicalid","00000000000000000000000000000001"),i.setAttr("matrixtxt","1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0"),i.setAttr("physicalid","00000000000000000000000000000001");var n=a.getRoot();n.set_dbObj_INST(i),t.addChild(n),n.setParent(t)}),s=!0),s}(t,i,n,r,l)),s&&a}return{applyCommands:function(e,t,i,n,o){var r=this,s=!1;if(1==e.get_editsHaveBeenApplied())r._plugSvcs.errout("Edit commands already applied to assembly... ignoring...");else{var a=!1;t.forEach(function(t){if(0==r.applyCommand(e,t,i,n)){a=!0;var s="refInstTreeEditor: Command '"+JSON.stringify(t)+"' failed :: ";if(1==o)return void r._plugSvcs.errout(s+" edits to structure aborted at point of failure.");r._plugSvcs.errout(s+" edits to structure continue, skipping this command...")}}),s=!a}return s},applyCommand:function(e,i,n,o){var r=!1,s=null;if(null==i)s="refInstTreeEditor given null command; skipping";else{var a=i.parent,l=null,u=null;switch(i.op){case"INSERT":null==(l=i.inNode)&&(s="Op is INSERT, but inNode is missing");break;case"REMOVE":null==(u=i.rmNode)&&(s="Op is REMOVE, but rmNode is missing");break;case"REPLACE":null==(l=i.inNode)&&(s="Op is REPLACE, but inNode is missing"),null==(u=i.rmNode)&&(s="Op is REPLACE, but rmNode is missing");break;default:s="UNSUPPORTED command in edits list: '"+i.op+"', skipping..."}}return null!=s?me._plugSvcs.errout(s):r=t(e,n,a,u,l),r}}}),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/fileExpand",[],function(){return{jsName:"FILE_EXPAND",doExpand:function(e,t,i,n,o){return new Promise(function(t,i){var o=e._moduleName;n.dbgout("  ... loading file: "+o);try{require([o],function(e){t(e)},function(e){i(e)})}catch(e){n.errout("Exception trying to load data file:: "+modulePath+"::"+e)}})}}}),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_CUST_ATTRS_PREP_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/Utils/MaturityUtils"],function(e,t){return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n)},execute:function(e,i){var n=this;n._parent(e,i);let o=e.crTreeArray,r=[];o.forEach(function(e){r.push(t.prepTreeForMaturityAndPolicyPromise(e,n._plugSvcs))}),Promise.all(r).then(()=>{null!=e?n.reportOK(e):n.reportKO()})}})}),define("DS/CompareWidget2/widget/controls/TreesContainer",["UWA/Controls/Abstract"],function(e){"use strict";return e.extend({name:"treesContainer",init:function(e){this._panels=[],this._parent(e),this._buildLayout()},addPanel:function(e){e.inject(this.getContent()),this._panels.push(e),e.addEvent("collapseChange",this._updateLayout.bind(this))},setPanelCaption:function(e,t){this._panels.find(t=>t.options.contentId===e).setCaption(t)},_updateLayout:function(){var e=this._panels.length,t=this._panels.reduce(function(e,t){return e+(t.isCollapsed()?0:1)},0);2===e&&t>0&&this._panels.forEach(function(e){e.isCollapseable()&&2===t&&e.setSize50pct()}),3!==t&&4!==t||this._panels.forEach(function(e){e.isCollapseable()&&(3===t?e.setSize50pct():e.setSize33pct())})},_buildLayout:function(){var e={class:this.getClassNames("-root")};this.elements.container=new UWA.Element("div",UWA.merge(this.options,e)),this._render()},_render:function(){}})}),define("DS/CompareWidget2/plugins/STRUCTURE/Utils/MaturityUtils",[],function(){return{_maturityStatesInfo:null,_createCSSClass:function(e,t,i){if(null===document.getElementById(e)){var n=document.createElement("style");n.type="text/css",n.id=e;let o=i||"."+e;n.innerHTML=o+t,document.getElementsByTagName("head")[0].appendChild(n)}},_cleanStatusForCSS:function(e){return e.replace(/(\.| )/g,"-")},_getMaturityClass:function(e,t){return"lc-status-"+this._cleanStatusForCSS(e)+(t?"-withClass":"")},_addCSSMaturityClasses:function(e,t){var i=this;void 0!==e&&e.forEach(function(e){let n=e.policyName;e.states.forEach(function(e){let o=e.activeColor,r="{color:"+("#FFFFFF"===o?"#000000":"#FFFFFF")+" ; background-color:"+o+";}",s=i._cleanStatusForCSS(e.stateSysName),a="lc-status-"+i._cleanStatusForCSS(n)+"-"+s+(t?"-withClass":""),l="."+a+(t?" ."+t:"");i._createCSSClass(a,r,l)})})},_getMaturityStateUserNameFromCRNode(e){var t="",i=this._getMaturityStateInfoFromCRNode(e);return i&&(t=i.stateUserName),t},_getPolicyUserNameFromCRNode(e){this._getMaturityStateInfoFromCRNode(e)},_getMaturityStateActiveColorFromCRNode(e){var t="#FFFFFF",i=this._getMaturityStateInfoFromCRNode(e);return i&&(t=i.activeColor),t},_getMaturityStateCSSClassFromCRNode(e,t,i){var n="",o=e.getAttr(t||"policy"),r=this._getMaturityStateInfoFromCRNode(e,t,i);if(r){var s=o+"."+r.stateSysName;n=this._getMaturityClass(s,"wux-controls-label")}return n},_getMaturityStateInfoFromCRNode(e,t,i){var n=null;i=i||"last.current",t=t||"policy";var o="",r="";if(e)if(e.getAttr(i))r=e.getAttr(t),o=e.getAttr(i);else{var s=e.getMatchInfo();if(s){var a=s.getBaseNode();if(a.getAttr(i))r=a.getAttr(t),o=a.getAttr(i);else{var l=s.getCompNode();l.getAttr(i)&&(r=l.getAttr(t),o=l.getAttr(i))}}}var u=this._maturityStatesInfo.policies.find(e=>e.policyName===r);return u&&(n=u.states.find(e=>e.stateSysName===o)),n},_getMaturityStatesAttributes:function(e,t){var i=this;return new UWA.Class.Promise(function(n,o){var r=new Set;if(e.visitAll_treeAndFN(0,function(e){var i=e.getAttr(t||"policy");i&&r.add(i)}),e.visitAll_treeAndFN(1,function(e){var i=e.getAttr(t||"policy");i&&r.add(i)}),r.size){var s={policies:Array.from(r)},a=e.getRoot(0).getObjIDSpec_REF(),l=a.getTenant(),u=a.getServiceName(),c=a.getSecurityContext(),d=i._plugSvcs.nowMS();i._plugSvcs.makeAuthHttpsCall("/resources/lifecycle/maturity/getStatesAttributes","POST",s,"json",l,u,c).then(function(e){i._plugSvcs.reportTime(d,"getStatesAttributes request OK.");var t="string"==typeof e?JSON.parse(e):e;n(t)},function(e){i._plugSvcs.reportTime(d,"getStatesAttributes request failed."),i._plugSvcs.showAlertBox("getStatesAttributes request unsuccessful.",null,"error"),i._plugSvcs.errout("Failure of getStatesAttributes request: "+e)})}else n(null)})},_getPolicyAttributes:function(e,t){return new Promise((i,n)=>{require(["DS/LifecycleServices/TranslationService"],function(o){let r=new o({handleError:!0});e.visitAll_treeAndFN(0,function(e){var i=e.getAttr(t||"policy");i&&r.addPolicy(i)});var s=e.getRoot(0).getObjIDSpec_REF().getTenant();r.initAsync(s).then(()=>i(r),()=>n())})})},prepTreeForMaturityAndPolicyPromise:function(e,t){let i=this;return i._plugSvcs=t,new Promise((t,n)=>{for(let t=0;t<2;t++)e.visitAll_treeAndFN(t,e=>{let t=e.getAttr("REF.ds6w:status");t?(t=t.split("."),e.addAttr("policy",t[0]),e.addAttr("last.current",t[1])):null!=e.getAttr("REF.ds6w:policy")&&e.addAttr("policy",e.getAttr("REF.ds6w:policy"))});Promise.all([i._getMaturityStatesAttributes(e),i._getPolicyAttributes(e)]).then(n=>{null!=n[0]&&(i._maturityStatesInfo=n[0],i._addCSSMaturityClasses(i._maturityStatesInfo.policies,"wux-controls-label")),null!=n[1]&&(i._translationService=n[1]);for(let t=0;t<2;t++)e.visitAll_treeAndFN(t,e=>{if(i._maturityStatesInfo){let t=i._getMaturityStateUserNameFromCRNode(e,n);t&&(e.addOrSetCustAttr("REF.ds6w:status",t),e.addOrSetCustAttr("maturity.class",i._getMaturityStateCSSClassFromCRNode(e)))}i._translationService&&null!=e.getAttr("REF.ds6w:policy")&&e.addOrSetCustAttr("REF.ds6w:policy",i._translationService.translatePolicy(e.getAttr("REF.ds6w:policy")))});t(e)},()=>{n(e)})})}}}),define("DS/CompareWidget2/plugins/VIEW3D/view3DJSONEngine_LDV",[],function(){var e={encoding:"UTF-8",kind:"InstRef",version:"1.1"};function t(e,t,i,n){return{resourceid:e,"ds6w:type":t,"ds6w:globaltype":i,boundingbox:n}}function i(i,n,o){var r,s=null,a=[],l=0,u=0,c=!1;i.visit_riTreeAndFN(function(e){var i=null,r=e.isLeaf();let d=e.isRoot();var p=e.get_dbObj_REF(),h=p.getAttr("physicalid")+"."+n,_=p.getAttr("ds6w:type"),f=p.getAttr("ds6w:globaltype"),g=p.getAttr("boundingbox"),m=p.getAttr("ds6wg:XCADOrientationExt.V_WorldOrientation");if(null!=m&&""!==m||(m=p.getAttr("vWorldOrientation")),null!=m&&""!==m||(m="0"),r){var S=p.getAttr("thumbnail_3d");if(null==S&&(0==c&&(c=!0,o.dbgout("Thumbnail_3d visuals not yet available; using CGRs")),S=p.getAttr("cgr")),null!=S)u++,i=function(e,i,n,o,r){var s=t(e,i,n,o);return s.thumbnail_3d=r,s}(h,_,f,g,S);else{if(!d)return o.dbgout("NO VISUAL // excluded from viewerJSON ID:: "+h+"("+p.getAttr("ds6w:label")+")"),!0;(i=t(h,_,f,g))["ds6wg:XCADOrientationExt.V_WorldOrientation"]=m}}else i=t(h,_,f,g),d&&(i["ds6wg:XCADOrientationExt.V_WorldOrientation"]=m);if(l++,a.push(i),1==d)null!=s?o.errout("ERROR - TREE has more than ONE root"):s=i;else{var C=e.get_dbObj_INST(),T=C.getAttr("physicalid")+"."+n,E=C.getAttr("ds6w:type"),v=(C.getAttr("ds6w:globalType"),function(e,t,i,n,o,r){return{resourceid:e,"ds6w:type":t,"ds6w:globaltype":i,matrixtxt:n,from:o,to:r}}(T,E,"ds6w:Instance",C.getAttr("matrixtxt"),e.getParent().get_dbObj_REF().getAttr("physicalid")+"."+n,h));a.push(v)}return!0}),r=a.length;var d=function(t,i,n,o){var r=JSON.parse(JSON.stringify(t));return{infos:e,results:[r,{synthesis:{name:"ProgressiveExpand_FlatSynthesis",value:i}},{synthesis:{name:"ProgressiveExpand_OccSynthesis",value:n}},{synthesis:{name:"ProgressiveExpand_LeafSynthesis",value:o}}]}}(s,r,l,u);s.resourceid;return{rootStats:d,infos:e,results:a}}return{refInstTree2ViewerJSON:function(e,t){var n=[];return e.forEach(function(e,o){var r=i(e,o,t);if(null==r)throw new Error("Failure creating view3DJSON");var s=e.getRoot().getAttr("REF.physicalid")+"."+o;n.push({rootID:s,structure:r})}),n}}}),define("DS/CompareWidget2/support/cw2Utils",["DS/WidgetServices/WidgetServices"],function(e){var t={},i=["     ","    ","   ","  "," ",""];return{jsClass:"CW2UTILS",createRandomString:function(e,t,i){if(null==i&&(i=t),t>i){this.errout("MIN/MAX values reversed... switching");var n=t;t=i,i=n}var o=Math.random()*(i-t)+t;return e+Math.random().toString(36).substring(o)},dupeJson:function(e){var t=null;try{t=JSON.parse(JSON.stringify(e))}catch(t){this.errout("Exception duping JSON: "+this.stringify(e)),this.errout(t)}return t},stringify:function(e){var t=null;if(null!=e){e.constructor==String&&(t=e);try{t=JSON.stringify(e)}catch(i){t=e.toString()}}return t},nowMS:function(){return(new Date).getTime()},reportTime:function(e,t){if(!widget||widget.CV2Timing){var n=t.indexOf("[");(-1==n||n>3)&&(t="[FRMWRK]"+t);var o=((this.nowMS()-e)/1e3).toString(),r=o.length,s=o.indexOf(".");-1==s&&(s=1);(s<i.length?i[s]:"").length;var a=o;console.log("[C2.TIME]"+t+"   //  {"+a+" seconds}  \\\\ ")}},enableDebugLabel:function(e){t[e]=!0},disableDebugLabel:function(e){t[e]=!1},dbgout:function(e,t){this.dbgout2(!1,e,t)},dbgout2:function(e,i,n){try{if(null!=widget&&!widget.CV2Debug)return}catch(e){return void console.error("EXCEPTION trying to output message: "+e+", continuing")}var o=null!=n?n:i,r=null!=n?i:null;if(null!=r){if(1!=t[r])return;o="["+r+"] "+o}var s="";"["!=o.charAt(0)&&(s=" "),o="[C2.DBG ]"+(o=e?"[PLUGIN]"+s+o:"[FRMWRK]"+s+o),console.log(o)},warnout:function(e){console.error("[C2.WRN]"+e)},errout:function(e){console.error("[C2.ERR]"+e)},splitSvcType:function(e){var t=e.indexOf(".");return ret={svc:e.substring(0,t),name:e.substring(t+1),asStr:e},ret},splitSvcName:function(e){var t=e.indexOf(".");return ret={svc:e.substring(0,t),name:e.substring(t+1),asStr:e},ret},splitSvcConfig:function(e){var t=e.indexOf(".");return ret={svc:e.substring(0,t),configName:e.substring(t+1),asStr:e},ret},getCurrentTenant:function(){var e=null;try{e=widget.getValue("x3dPlatformId")}catch(e){this.dbgout("attempted to get tenant information from widget and failed... must be running an ODT... using 'OnPremise'")}return null==e&&(e="OnPremise"),e},getViewDefs:function(e){var t=[];return function e(i){Object.values(i).forEach(i=>{(i.constructor!==Array?[i]:i).forEach(i=>{i.constructor===String?t.push(i):i.constructor===Array?i.forEach(e=>{e.constructor===String&&t.push(e)}):null!=i&&e(i)})})}(e),t},checkViewConfig:function(e){return function e(t,i){var n=1===Object.keys(t).length&&(null==i&&("ROW"===Object.keys(t)[0].toUpperCase()||"COL"===Object.keys(t)[0].toUpperCase())||"ROW"===i&&"COL"===Object.keys(t)[0].toUpperCase()||"COL"===i&&"ROW"===Object.keys(t)[0].toUpperCase());for(var[o,r]of Object.entries(t))n=n&&(r.constructor!==Array?[r]:r).every(t=>t.constructor===String||t.constructor===Array&&t.every(e=>e.constructor===String)||null!=t&&t.constructor!==Array&&t.constructor!==String&&e(t,o));return n}(e)},getDeviceType:function(){let e="desktop",t="ontouchstart"in document.documentElement&&/mobi/i.test(navigator.userAgent),i=window.matchMedia("(max-width: 480px) and (orientation:portrait)"),n=window.matchMedia("(max-height: 480px) and (orientation:landscape)"),o=i.matches||n.matches;return t&&o?e="smartphone":t&&!o&&(e="tablet"),e},csValsEquivalent:function(e,t){var i=!1;if(e==t)i=!0;else if(null!=e&&null!=t){var n=e.split(",");n.forEach(function(e,t){n[t]=e.trim()});var o=t.split(",");o.forEach(function(e,t){o[t]=e.trim()});var r=n.length;if(r==o.length){for(var s=n.sort(),a=o.sort(),l=!1,u=0;u<r;u++)if(s[u]!=a[u]){l=!0;break}i=!l}}return i},formatDate:function(t){var i=e.formatDate(t,!0);if(0==i.localeCompare(t)){var n=new Date(t);i=e.formatDate(n,!0)}return i}}}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/flagInfo",["i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e){function t(e,t,i){let n={title:e.NLS};void 0!==e.tooltipCustomRule&&null!==e.tooltipCustomRule&&e.tooltipCustomRule.length>0&&(n.shortHelp=e.tooltipCustomRule);let o="",r=-1;void 0!==e.legendPosition&&null!==e.legendPosition&&(o=e.legendPosition.grouping,r=e.legendPosition.position);let s=1,a=0;return"left"===o?(s=0,a=r):"right"===o?(s=2,a=r):1===i&&(s=2),{id:e.flagName,label:e.NLS,tooltip:n,modulePath:e.modulePath,color:e.color,description:"",checked:!0,matchedPairs:[],visibleFlag:t,legendGrouping:s,legendSubGrouping:a}}var i=function(t,i){var n,o;this.statusIDFlagData_all=(n=t,o={},["SYSTEM_RULE_ID_FLAGS","CUSTOM_RULE_ID_FLAGS","CUSTOM_MATCH_ADJ_FLAGS","BUBBLE_FLAGS"].forEach(function(t){var i=n[t];null!=i&&Object.keys(i).forEach(function(i){var r=n[t][i].NLS,s=e[r];null!=s&&0!=s.length||(s=r),o[i]={color:n[t][i].COLOR,flagName:i,NLS:s,modulePath:n[t][i].TOOLTIP_MODULE_PATH},void 0!==n[t][i].TOOLTIP_CUSTOM_RULE&&null!==n[t][i].TOOLTIP_CUSTOM_RULE&&n[t][i].TOOLTIP_CUSTOM_RULE.length>0&&(o[i].tooltipCustomRule=n[t][i].TOOLTIP_CUSTOM_RULE),void 0!==n[t][i].LEGEND_POSITION&&null!==n[t][i].LEGEND_POSITION&&(o[i].legendPosition=n[t][i].LEGEND_POSITION)})}),o),this._plugSvcs=i,this.inUse={},this.inUse.active={}};return i.prototype.setActive=function(e){this.inUse[e]=this.inUse[e]||{},this.inUse.active=this.inUse[e]},i.prototype.getActiveFlagDisplayData=function(e){var t=this.inUse.active.flagDisplayData;return null!=e&&null!=t&&(t=t[e]),t},i.prototype.getActiveFlagDisplayData_excludeFilteredByTypeAttr=function(){var e=this.inUse.active.flagDisplayData,t={};return Object.keys(e).forEach(function(i){for(var n=e[i],o=n.matchedPairs,r=!1,s=0;s<o.length;s++){if(0==o[s].getIsHidden_byTypeAttr()){r=!0;break}}r&&(t[i]=n)}),t},i.prototype.getActiveMaxFlags=function(){return this.inUse.active.maxFlags},i.prototype.get_statusIDFlag=function(e){var t=this.statusIDFlagData_all[e];return null==t&&(this._plugSvcs.errout("view def options missing RULE_ID_FLAG definition for: "+e+"; using default color RED"),this.statusIDFlagData_all[e]={color:"#ff0000",NLS:e,flagName:e},t=this.statusIDFlagData_all[e]),t},i.prototype.createFlagDisplayData=function(e,i,n){for(var o={},r=0,s=i.length,a=0;a<s;a++){let e=i[a];var l=!0===e.qtyIsDiffFlag,u=e.getAllStatusArray(!0)||[],c=u.length,d=c+(l?1:0);d>r&&(r=d);for(var p=0;p<c;p++){var h=u[p];if(null!=h&&""!=h&&("UNRELATED"!=h||n)){if(null==o[h]){let e=this.get_statusIDFlag(h);o[h]=t(e,!0,p)}o[h].matchedPairs.push(e)}}if(l){if(null==o.QUANTITY){var _=this.get_statusIDFlag("QUANTITY");o.QUANTITY=t(_,!0)}o.QUANTITY.matchedPairs.push(e)}}if(null==o.IDENTICAL){var f=this.get_statusIDFlag("IDENTICAL");o.IDENTICAL=t(f,!1)}this.inUse[e]={flagDisplayData:o,maxFlags:r}},i}),define("DS/CompareWidget2/Customization/viewConfigMangler",[],function(e){"use strict";return{applyCustomProfileToViewConfig:function(e,t){for(var i=JSON.parse(JSON.stringify(t)),n={},o={},r=[],s={},a=[],l={},u={},c=e.UseCustomMatchingRules?e.MatchingRules.length:0,d=0;d<c;d++){let t=e.MatchingRules[d],i=t.name,a=t.color;"#"!=a.charAt(0)&&(a="#"+a);t.description;let u=t.attributes;r[d]=i,l[i]={COLOR:a,TOOLTIP_MODULE_PATH:"",NLS:i};let c=[];for(var p of u){let e=p.name,t=p.objType[0],i=p.icon,r="Instance"===t.substr(t.length-8)?"INST":"REF",a=r+"_"+e+"_"+"ATTR",l=r+"."+e;n[a]=l,o[a]={name:l,icon:i,origin:"matching_rule"},c.push({info:0===c.length?"same":"and",name:l});let u="COMP_"+r+"_"+e;null==s[u]&&(s[u]=[],s[u][0]=[a,a],s[u][1]=[]),s[u][1][d]="EQ"}l[i].TOOLTIP_CUSTOM_RULE=c,l[i].LEGEND_POSITION={grouping:"left",position:d}}Object.keys(s).forEach(function(e){for(var t=0;t<c;t++)null==s[e][1][t]&&(s[e][1][t]="N/A")});let h=e.AdditionalStatuses.length;for(var _=0;_<h;_++){let t=e.AdditionalStatuses[_];if(""!==t.name&&t.attributes.length>0){let e=t.name,i=t.color;"#"!=i.charAt(0)&&(i="#"+i);t.description;let r=t.attributes,s={NAME:e,PROPS:[],PROPSET:[],FLAG_ON:"NEQ",IS_VISIBLE:!0,MATCH_ADJ:0},l=[];for(var p of r){let e=p.name,t=p.objType[0],i=p.icon,r="Instance"===t.substr(t.length-8)?"INST":"REF",a=r+"_"+e+"_"+"ATTR",u=r+"."+e;n[a]=u,void 0!==o[a]&&null!==o[a]||(o[a]={name:u,icon:i,origin:"additional_status"}),l.push({info:0===l.length?"different":"or",name:u}),s.PROPSET.push(a)}a.push(s),u[e]={COLOR:i,TOOLTIP_MODULE_PATH:"",NLS:e},u[e].TOOLTIP_CUSTOM_RULE=l,u[e].LEGEND_POSITION={grouping:"right",position:_}}}if(i.customProfileName=e.Name,Object.assign(i.PLUGDEFS.StructFetch.Options.CV_PROPS,n),i.PLUGDEFS.StructFetch.Options.DB_PROPS={},i.PLUGDEFS.StructFetch.Options.DB_FALLBACK=!1,Object.assign(i.PLUGDEFS.StructCompare.Options.PROPS,n),c>0){i.PLUGDEFS.StructCompare.Options.CUSTOM_RELATIONSHIP_NAMES=r,i.PLUGDEFS.StructCompare.Options.CUSTOM_COMPARISONS=s,i.PLUGDEFS.StructCompare.Options.CUSTOM_MATCH_ADJUSTMENTS=a;let e=["LEFT_ONLY","RIGHT_ONLY","QUANTITY","UNRELATED"],t=i.PLUGDEFS.StructCompare.Options.SYSTEM_RELATIONSHIP_NAMES.filter(t=>e.includes(t));i.PLUGDEFS.StructCompare.Options.SYSTEM_RELATIONSHIP_NAMES=t,i.PLUGDEFS.StructCompare.Options.COMPUTE_DIFFERENT=!0}else for(var f of a)i.PLUGDEFS.StructCompare.Options.CUSTOM_MATCH_ADJUSTMENTS.push(f);if(i.PLUGDEFS.StructCompare.Options.CUSTOM_PROFILE_IN_USE=!0,c>0){i.PLUGDEFS.StructDisplay.Options.CUSTOM_RULE_ID_FLAGS=l;let e=["LEFT_ONLY","RIGHT_ONLY","QUANTITY","UNRELATED"];!0===i.PLUGDEFS.StructCompare.Options.CUSTOM_PROFILE_IN_USE&&e.push("DIFFERENT");let t=Object.keys(i.PLUGDEFS.StructDisplay.Options.SYSTEM_RULE_ID_FLAGS).filter(t=>e.includes(t)).reduce((e,t)=>(e[t]=i.PLUGDEFS.StructDisplay.Options.SYSTEM_RULE_ID_FLAGS[t],e),{});i.PLUGDEFS.StructDisplay.Options.SYSTEM_RULE_ID_FLAGS=t}return h>0&&Object.assign(i.PLUGDEFS.StructDisplay.Options.CUSTOM_MATCH_ADJ_FLAGS,u),i.PLUGDEFS.StructDisplay.Options.CUSTOM_PROFILE_IN_USE=!0,i.PLUGDEFS.StructDisplay.Options.PROPS=o,i}}}),define("DS/CompareWidget2/Customization/Profile",["UWA/Class"],function(e){"use strict";return e.extend({init:function(){var e=null,t=null,i=null,n=null,o=!1;let r="";if(1==arguments.length)e=arguments[0];else if(3==arguments.length)t=arguments[0],i=arguments[1],n=arguments[2];else{if(5!=arguments.length)throw new Error("Illegal initial state for new PROFILE");e=arguments[0],t=arguments[1],i=arguments[2],n=arguments[3],r=arguments[4],o=!0}this.Facets=[],this.AllowCustomMatchingRules=!1,this.Interfaces=[],this.SelectedTypes=[],this.UseCustomMatchingRules=!1,this.UserOverrideOK=!0,this.MatchingRules=[],this.AdditionalStatuses=[],this.Name="Default",this.Creator="unknown",this.isAdminUser=!1,this.companyId="",null!=e&&this._initFrom(e,o),null!=t&&(this.Name=t,this.NameNLS=null),null!=i&&(this.Creator=i),null!=n&&(this.isAdminUser=n),null!=r&&""!==r&&(this.companyId=r),this.Type="customization"},_initFrom:function(e,t){var i=this,n=Object.keys(e);let o="template"===e.Type;n.forEach(function(n){if(i[n]=JSON.parse(JSON.stringify(e[n])),o&&t&&"Facets"===n){let t=JSON.parse(JSON.stringify(e[n])),o=[],r=[];for(let e of t){for(let t of e.ObjectTypes)o.push(t);if(void 0!==e.Interfaces&&null!==e.Interfaces)for(let t of e.Interfaces)r.push(t)}i.SelectedTypes=o,i.Interfaces=r}})},setMatchingRules:function(e){var t=e||[];t=JSON.parse(JSON.stringify(t));this.MatchingRules=t},setAdditionalStatuses:function(e){var t=e||[];t=JSON.parse(JSON.stringify(t));this.AdditionalStatuses=t}})}),define("DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInstTreeAug",[],function(){function e(e,t,i){i.dbgout("------------[ A U G M E N T   T R E E   N O D E S    B E G I N ] -----------");let n=function(e,t){var i=[];return e.visit_riTreeAndFN(function(e){var t=e.get_dbObj_REF();if(null==t.getAttr("dfr")){var n=t.getAttr("physicalid"),o=t.getAttr("dfr_bootstrapID");null!=t.getAttr("dfr_in_progress")||(null==o?t.setAttr("dfr",n):(t.setAttr("dfr_in_progress",o),t.rmAttr("dfr_bootstrapID"),i.push(t)))}return!0}),i}(e);return function e(t,i,n,o){return new Promise(function(r,s){if(i.length>0){let a=function(e){var t=[];return e.forEach(function(e){t.push(e.getAttr("dfr_in_progress"))}),t}(i);(function(e,t,i){var n=widget._isODTMode()?"":i.createRandomString("Compare2-",8),o={physicalid:e,select_predicate:["bo.plmreference.v_derivedfrom"],with_synthesis:!1,label:n};return i.makeAuthHttpsCall("/cvservlet/fetch/v2","POST",o,"json",t.tenant,t.serviceName,t.securityContext)})(a,n,o).then(function(a){let l=a.results,u=function(e,t){var i=[];if(null!=e&&e.length>0){var n={};t.forEach(function(e){var t=e.getAttr("dfr_in_progress");n[t]=e}),e.forEach(function(e){var t=null,o=null;e.attributes.forEach(function(e){"bo.plmreference.v_derivedfrom"==e.name?o=e.value:"resourceid"==e.name&&(t=e.value)});var r=n[t];if(null==o){var s=r.getAttr("dfr_in_progress");r.setAttr("dfr",s),r.rmAttr("dfr_in_progress")}else r.setAttr("dfr_in_progress",o),i.push(r)})}return i}(l,i);0==u.length?(t.visit_riTreeAndFN(function(e){let t=e.get_dbObj_REF(),i=t.getAttr("dfr_in_progress");return null!=i&&(t.setAttr("dfr",i),t.rmAttr("dfr_in_progress")),!0}),r(t)):e(t,u,n,o).then(r,s)},function(e){o.errout("GOT A KO TRYING TO AUG TREE"),s()})}else r(t)})}(e,n,t,i).then(function(t){return i.dbgout("------------[ A U G M E N T   T R E E   N O D E S    E N D  ] -----------"),e},function(e){})}return{jsClass:"REFINST_TREE_AUGMENTER",augment:function(t,i,n){var o=n.nowMS();t.visit_riTreeAndFN(function(e){return e.setDBContext(i),!0});var r=e(t,i,n);return n.reportTime(o,"--\x3e Augment tree with 'derived from root' "),r}}}),define("DS/CompareWidget2/widget/controls/TreePanel",["UWA/Controls/Abstract","DS/Core/PointerEvents"],function(e,t){"use strict";return e.extend({name:"treePanel",defaultOptions:{caption:"-",addClass:"",collapseable:!1,UIcollapseable:!0},init:function(e){this._parent(e),this._isCollapsed=!1,this._isMaximized=!1,e.initSize50pct?this.setSize50pct():this.setSize33pct(),this._buildLayout()},_buildLayout:function(){var e=this,t=" ";this.options.collapseable&&(t+=this.expandClass);var i={class:this.getClassNames("-root")+t+" "+this.options.addClass};this.elements.container=new UWA.Element("div",i);var n=new UWA.Element("div",{class:this.getClassNames("-panelHeader")});n.inject(this.elements.container),this.options.colorIndicator&&(this.elements.colorIndicator=new UWA.Element("div",{class:"fonticon fonticon-stop",styles:{color:this.options.colorIndicator,"margin-left":"10px"}}),this.elements.colorIndicator.inject(n)),this.elements.headerText=new UWA.Element("div",{class:this.getClassNames("-headerText"),html:[{tag:"section",html:this.options.caption},{tag:"section",html:""},{tag:"section",html:""},{tag:"section",html:[{tag:"div",html:""}]}]}),this.elements.headerText.inject(n),this.elements.contentContainer=new UWA.Element("div",{id:this.options.contentId,class:this.getClassNames("-contentContainer"),styles:{"border-top":this.options.contentBorderTop}}),this.elements.contentContainer.inject(this.elements.container);var o="";this.options.collapseable&&(o="treePanel-content-hide-expander"),this.elements.contentHide=new UWA.Element("div",{class:this.getClassNames("-content-hide")+" "+o,events:{click:function(){e.options.UIcollapseable&&e.options.collapseable&&e.toggleCollapsed()}}}),this.elements.contentHide.inject(this.elements.contentContainer),this.elements.captionCollapsed=new UWA.Element("span",{class:this.getClassNames("-caption-collapsed"),html:this.options.caption}),this.elements.captionCollapsed.inject(this.elements.contentHide),this.elements.content=new UWA.Element("div",{class:this.getClassNames("-content")}),this.elements.content.inject(this.elements.contentContainer),this.options.collapseable&&(this.elements.headerBtn=new UWA.Element("div",{class:"wux-controls-button wux-controls-abstract wux-ui-state-secondary wux-ui-style-normal "+this.getClassNames("-headerButton"),events:{click:function(){e.toggleCollapsed()}}}),this.elements.headerBtnIcon=new UWA.Element("div",{class:"fonticon fonticon-expand-left treePanel-headerButtonIcon"}),this.elements.headerBtnIcon.inject(this.elements.headerBtn),this.elements.headerBtn.inject(n)),this._render()},_render:function(){},isCollapsed:function(){return this._isCollapsed},isCollapseable:function(){return this.options.collapseable},setUICollapseable:function(e){this.options.UIcollapseable!==e&&((this.options.UIcollapseable=e)?(this.elements.headerBtn.removeClassName("treePanel-hidden"),this.elements.contentHide.addClassName("treePanel-content-hide-expander")):(this.elements.headerBtn.addClassName("treePanel-hidden"),this.elements.contentHide.removeClassName("treePanel-content-hide-expander")))},empty:function(){},hide:function(){this.elements.container.addClassName("treePanel-hidden")},show:function(){this.elements.container.removeClassName("treePanel-hidden")},_setCollapsed:function(e){this._isCollapsed=e,this.dispatchEvent("collapseChange",{isCollapsed:e})},setSize33pct:function(){this._setSizepct("treePanel-expandedPanel33")},setSize50pct:function(){this._setSizepct("treePanel-expandedPanel50")},_setSizepct:function(e){this.expandClass!==e&&(!this.isCollapsed()&&this.elements.container&&this.elements.container.removeClassName(this.expandClass),this.expandClass=e,!this.isCollapsed()&&this.elements.container&&this.elements.container.addClassName(this.expandClass))},setCaption:function(e){if("string"==typeof e)this.elements.headerText.childNodes[0].setHTML(e),this.elements.captionCollapsed.setHTML(e);else{let n="";for(var i=0;i<this.elements.headerText.childNodes.length;++i)if(i===this.elements.headerText.childNodes.length-1)this.elements.headerText.childNodes[i].addClassName("treePanel-caption-dropdown-container"),this.elements.headerText.childNodes[i].childNodes[0].classList.add("fonticon","fonticon-down-open","treePanel-caption-dropdown"),this.elements.headerText.childNodes[i].childNodes[0].removeEvent(t.POINTERDOWN),this.elements.headerText.childNodes[i].childNodes[0].addEvent(t.POINTERDOWN,e.dropDown.onClick),this.elements.headerText.childNodes[i].childNodes[0].id=e.dropDown.id;else if(i<e.label.length){let o=2===i?"["+e.label[i].text+"]":e.label[i].text,r=UWA.String.escapeHTML(o);this.elements.headerText.childNodes[i].setHTML(r),this.elements.headerText.childNodes[i].addClassName("treePanel-caption-item"),void 0!==e.label[i].onClick&&null!==e.label[i].onClick&&"function"==typeof e.label[i].onClick&&(this.elements.headerText.childNodes[i].removeEvent(t.POINTERDOWN),this.elements.headerText.childNodes[i].addEvent(t.POINTERDOWN,e.label[i].onClick),this.elements.headerText.childNodes[i].id=e.label[i].id,this.elements.headerText.childNodes[i].addClassName("treePanel-caption-item-clickable")),0===i?n=o:n+=" "+o}else this.elements.headerText.childNodes[i].setHTML("");let o=UWA.String.escapeHTML(n);this.elements.captionCollapsed.setHTML(o)}},collapse:function(){this.isCollapseable()&&(this.isCollapsed()||(this.elements.container.removeClassName(this.expandClass),this.elements.container.addClassName("treePanel-collapsedPanel"),this.elements.contentHide.show(),this.elements.headerText.hide(),this.elements.headerBtnIcon.removeClassName("fonticon-expand-left"),this.elements.headerBtnIcon.addClassName("fonticon-expand-right"),this._setCollapsed(!0)))},expand:function(){this.isCollapseable()&&this.isCollapsed()&&(this.elements.headerText.show(),this.elements.container.addClassName(this.expandClass),this.elements.container.removeClassName("treePanel-collapsedPanel"),this.elements.contentHide.hide(),this.elements.headerBtnIcon.addClassName("fonticon-expand-left"),this.elements.headerBtnIcon.removeClassName("fonticon-expand-right"),this._setCollapsed(!1))},toggleCollapsed:function(){this.isCollapsed()?this.expand():this.collapse()},maximize:function(){this._isMaximized||(this._isMaximized=!0,this.elements.container.addClassName("treePanel-maximized"))},restore:function(){this._isMaximized&&(this._isMaximized=!1,this.elements.container.removeClassName("treePanel-maximized"))}})}),define("DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/pe2RefInstTree",["DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/exAdapter","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_tree","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_node","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj"],function(e,t,n,o){var r=function(e,t){this._objIDSpec=e,this._dbObjArray=[],this._dbObjByPhysicalID={},this._plugSvcs=t,this._pathArrayArray=[],this._typeIconsArrayArray=[]};return r.prototype.build_dbObj=function(e){var t=new o;Object.keys(e).forEach(function(i){var n=e[i];"bo.plmreference.v_derivedfrom"==i&&(i="dfr_bootstrapID"),"Matrixtxt"==i&&(i="matrixtxt"),"matrixtxt"==i&&"1,0,0,0,1,0,0,0,1,0,0,0"==n&&(n="1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0"),"resourceid"==i&&(i="physicalid"),t.addAttr(i,n)});var i={smallURL:e.icon,largeURL:e.thumbnail_2d};return t.addAttr("typeIcons",i),t},r.prototype.add_dbObj=function(e){var t=!0;return null==this._dbObjByPhysicalID[e.getAttr("physicalid")]?(this._dbObjByPhysicalID[e.getAttr("physicalid")]=e,this._dbObjArray.push(e)):(this._plugSvcs.errout("new node already in tree (byPhysID)"),t=!1),t},r.prototype.add_path=function(e){null==e||0==e.length?this._plugSvcs.errout("Attempt to add null or empty path to tree"):e.length%2!=1?this._plugSvcs.errout("Invalid path; contains even number of entries (count *must* be odd)"):this._pathArrayArray.push(e)},r.prototype.add_typeIcons=function(e){this._typeIconsArrayArray.push(e)},r.prototype._isTreeNodeRefInstID=function(e,t,i){var n=!1;e.getAttr("REF.physicalid")==t&&(e.getAttr("INST.physicalid")==i&&(n=!0));return n},r.prototype.buildTree=function(){var e=this,o=new t(this._objIDSpec);try{e._pathArrayArray.forEach(function(t){var r=t.length,s=o.getRoot(),a=null,l=0,u=t[0],c=null,d=null;if(null!=s&&e._isTreeNodeRefInstID(s,u,c)){for(d=s,l=1,i=1;i<r;i+=2){c=t[i],u=t[i+1];for(var p=s.getChildArray(),h=p.length,_=!1,f=0;f<h;f++){var g=p[f];if(e._isTreeNodeRefInstID(g,u,c)){_=!0,d=g,s=g;break}}if(0==_)break}a=d,l=i}for(i=l;i<r;){var m=0==i;c=m?null:t[i++],u=t[i++];var S=e._get_dbObjByPhysicalID(u),C=null;0==m&&(C=e._get_dbObjByPhysicalID(c));var T=new n(S,C);m?o.setRoot(T):(a.addChild(T),T.setParent(a)),a=T}})}catch(e){this._plugSvcs.errout("Failure building riTree (from paths): "+e),o=null}return o},r.prototype._get_dbObjByPhysicalID=function(e){return this._dbObjByPhysicalID[e]},e.singleton({jsClass:"PE2REFINST_TREE",convert:function(e,t,i,n){for(var o=new r(e),s=t.length,a=0;a<s;a++){var l=t[a];if(null!=l.resourceid){var u=o.build_dbObj(l);o.add_dbObj(u)}else null!=l.Path?o.add_path(l.Path):null!=l.icon__default_thumbnail_2d?o.add_typeIcons(l.icon__default_thumbnail_2d):i.errout("Unknown entry in input:"+JSON.stringify(l)+", skipping...")}var c=o.buildTree();return o=null,c}})}),define("DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/cv2RefInstTree",["DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/exAdapter","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_tree","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_node","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj"],function(e,t,n,o){var r=function(e,t){this._objIDSpec=e,this._dbObjArray=[],this._dbObjByDID={},this._dbObjByPhysID={},this._plugSvcs=t,this._pathArrayArray=[],this._typeIconsArrayArray=[]};return r.prototype.build_dbObj=function(e){for(var t=new o,i=e.length,n=0;n<i;n++){var r=e[n],s=r.name,a=r.value;"bo.plmreference.v_derivedfrom"==s&&(s="dfr_bootstrapID"),"matrixtxt"==s&&"1,0,0,0,1,0,0,0,1,0,0,0"==a&&(a="1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0"),"resourceid"==s&&t.addAttr("physicalid",a),t.addAttr(s,a)}return t},r.prototype.add_dbObj=function(e){var t=!0;return null==this._dbObjByDID[e.getAttr("did")]?this._dbObjByDID[e.getAttr("did")]=e:(this._plugSvcs.errout("new node already in tree (byDID)"),t=!1),1==t&&null==this._dbObjByPhysID[e.getAttr("physicalid")]?this._dbObjByPhysID[e.getAttr("physicalid")]=e:(this._plugSvcs.errout("new node already in tree (byPhysID)"),t=!1),t&&this._dbObjArray.push(e),t},r.prototype.add_path=function(e){null==e||0==e.length?this._plugSvcs.errout("Attempt to add null or empty path to tree"):e.length%2!=1?this._plugSvcs.errout("Invalid path; contains even number of entries (count *must* be odd)"):this._pathArrayArray.push(e)},r.prototype.add_typeIcons=function(e){this._typeIconsArrayArray.push(e)},r.prototype._isTreeNodeRefInstID=function(e,t,i){var n=!1;e.getAttr("REF.did")==t&&(e.getAttr("INST.did")==i&&(n=!0));return n},r.prototype.buildTree=function(){var e=this,o=new t(this._objIDSpec);try{e._pathArrayArray.forEach(function(t){var r=t.length,s=o.getRoot(),a=null,l=0,u=t[0],c=null,d=null;if(null!=s&&e._isTreeNodeRefInstID(s,u,c)){for(d=s,l=1,i=1;i<r;i+=2){c=t[i],u=t[i+1];for(var p=s.getChildArray(),h=p.length,_=!1,f=0;f<h;f++){var g=p[f];if(e._isTreeNodeRefInstID(g,u,c)){_=!0,d=g,s=g;break}}if(0==_)break}a=d,l=i}for(i=l;i<r;){var m=0==i;c=m?null:t[i++],u=t[i++];var S=e._get_dbObjByDID(u),C=null;0==m&&(C=e._get_dbObjByDID(c));var T=new n(S,C);m?o.setRoot(T):(a.addChild(T),T.setParent(a)),a=T}})}catch(e){this._plugSvcs.errout("Exception while building riTree: "+e),o=null}return o},r.prototype.attachIconsToNodes=function(){var e=this,t=!1;try{this._typeIconsArrayArray.forEach(function(t){t.forEach(function(t){for(var i=t.did,n={smallURL:t.icon,largeURL:t.thumbnail_2d},o=i.length,r=0;r<o;r++){var s=i[r];e._get_dbObjByDID(s).setAttr("typeIcons",n)}})}),t=!0}catch(e){this._plugSvcs.errout("Failure attaching icons to tree: "+e)}return t},r.prototype._getObjByPhysID=function(e){return this._dbObjByPhysID[e]},r.prototype._get_dbObjByDID=function(e){return this._dbObjByDID[e]},r.prototype._visit_dbObjsAndFN=function(e){for(var t=this._dbObjArray.length,i=!0,n=0;1==i&&n<t;n++){i=e(this._dbObjArray[n])}return i},e.singleton({jsClass:"CV2REFINST_TREE",convert:function(e,t,i,n){for(var o=new r(e,i),s=t.length,a=0;a<s;a++){var l=t[a];if(null!=l.attributes){var u=o.build_dbObj(l.attributes);null!=l.boundingbox&&u.addAttr("boundingbox",l.boundingbox),o.add_dbObj(u)}else null!=l.path?o.add_path(l.path):null!=l.icon__default_thumbnail_2d?o.add_typeIcons(l.icon__default_thumbnail_2d):i.errout("Unknown entry in input:"+JSON.stringify(l)+", skipping...")}0==o.attachIconsToNodes()&&this._plugSvcs.warnout("Failed to attach icons");var c=o.buildTree();return o=null,c}})}),define("DS/CompareWidget2/widget/compareCustomizationFrame",["UWA/Controls/Abstract","DS/CompareWidget2/Customization/CompareCustomization"],function(e,t){return e.extend({init:function(e,t,i){this._parent({}),this._eventMgr=e,this._options=null!=t?JSON.parse(JSON.stringify(t)):{},this._CCM=i,this.elements.container=UWA.createElement("div",{id:"initial-drop",styles:{height:"100%"}})},show:function(e){var i=this;this._parent(),this._CCM.loadCustomizations().then(function(n){void 0!==i._compareCustomizationPage&&null!==i._compareCustomizationPage||(i._compareCustomizationPage=new t(i._CCM)),i._compareCustomizationPage.show(i.elements.container,e,i.onDone.bind(i))},function(n){console.error("FAILED to load customizations..."),void 0!==i._compareCustomizationPage&&null!==i._compareCustomizationPage||(i._compareCustomizationPage=new t(i._CCM)),i._compareCustomizationPage.show(i.elements.container,e,i.onDone.bind(i))})},onDone:function(e){this._eventMgr.publish({event:"Event_controlCustomizationDone",data:e})},refreshFrame:function(){null!=this._compareCustomizationPage&&this._compareCustomizationPage.reset(),this.show()}})}),define("DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/exAdapter",["UWA/Class","DS/CompareWidget2/support/cw2Utils"],function(e,t){return e.extend({convert:function(e){return t.errout("Abstract base class called; requires implementation"),null}})}),define("DS/CompareWidget2/Customization/getProfileNameDialog",["UWA/Class","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Label","DS/Controls/LineEditor","i18n!DS/CompareCommon/assets/nls/CompareCustomization"],function(e,t,i,n,o,r,s){"use strict";return e.extend({init:function(e,o){this._parent({}),this.options=e,this.onClickOkCallback=o,this.immersiveFrame=new t,this.immersiveFrame.inject(widget._isODTMode()?document.body:widget.body),this.content=this._buildContent(),this.dialog=new i({title:e.dialogTitle,content:this.content,immersiveFrame:this.immersiveFrame,resizableFlag:!0,visibleFlag:!0,modalFlag:!0,buttons:{Ok:new n({label:e.okLabel,domId:"compare_getprofname_OK",onClick:this._onClickOk.bind(this),disabled:!1,emphasize:"primary"}),Cancel:new n({label:e.cancelLabel,domId:"compare_getprofname_Cancel",onClick:this._onClickCancel.bind(this),disabled:!1,emphasize:"secondary"})}}),this.dialog.addEventListener("close",this._onDialogClose.bind(this))},_buildContent:function(){var e=this;let t=UWA.createElement("div",{id:"compare_getprofname_dialog"}),i=UWA.createElement("div",{}).inject(t);i.setStyle("display","inline-flex"),i.setStyle("width","100%");let n=new o({value:s.get("ProfileTitleLabel")+"*"}).inject(i);return n.getContent().style.fontWeight="bold",n.getContent().style.background="white",this.nameEditor=new r({placeholder:s.get("ProfileTitlePlaceholder"),maxLength:100,requiredFlag:!0}).inject(i),this.nameEditor.addEventListener("uncommittedChange",function(t){e.messageLabel.setText(t.options.uncommittedValue.length>99?s.get("PROFILE_TITLE_LONG"):"")}),this.nameEditor.getContent().style.width="100%",this.messageLabel=UWA.createElement("div",{id:"compare_getprofname_message",html:[]}).inject(t),this.messageLabel.setStyles({color:"red","margin-top":"6px"}),t},_onDialogClose:function(){this.dialog.removeEventListener("close",this._onDialogClose.bind(this)),this.dialog.destroy(),this.immersiveFrame.destroy()},_onClickOk:function(){if(this.nameEditor.validFlag)if(void 0!==this.options.existingNames&&null!==this.options.existingNames&&this.options.existingNames.includes(this.nameEditor.value)){let e=s.get("PROFILE_TITLE_ALREADY_EXISTS").replace("{msgData}",this.nameEditor.value);this.messageLabel.setText(e)}else this.onClickOkCallback(this.nameEditor.value),this.dialog.close();else""===this.nameEditor.value?this.messageLabel.setText(s.get("PROFILE_TITLE_REQUIRED")):this.messageLabel.setText(s.get("PROFILE_TITLE_INVALID_CHARS"))},_onClickCancel:function(){this.dialog.close()}})}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/externalController",[],function(){var e=function(e,t,i){this._getActiveTreeCB=e,this._isListCB=t,this.dbgout=i};return e.prototype.destroy=function(){this._getActiveTreeCB=null,this._isListCB=null},e.prototype.setSelectedNodes=function(e){return this._selectNodes(e)},e.prototype.clearSelectedNodes=function(){this._clearSelections()},e.prototype._selectNodes=function(e){var t=this,i=t._getActiveTreeCB();i.withUpdateLocked(()=>{var n=[];i.dataGridViews.forEach((i,o)=>{t.dbgout("XSELECT","   structComparePanel._selectNodes dataGrid # "+o),e.forEach(function(e,o){t.dbgout("XSELECT","      structComparePanel._selectNodes selection # "+o);var r=t._find_nodes_from_path(i,e);r.length>0&&(t.dbgout("XSELECT","      structComparePanel._selectNodes _find_nodes_from_path found "+r.length+" nodes"),r.forEach((e,i)=>{n.push(e);var o=e.getAttr("title"),r=e.getAttr("type");t.dbgout("XSELECT","        "+o+" "+r)}))})}),t.dbgout("XSELECT","   structComparePanel._selectNodes calling selectByCrNodes with "+n.length),i.selectByCrNodes(n)})},e.prototype._clearSelections=function(){var e=this._getActiveTreeCB();e.withUpdateLocked(()=>{e.dataGridViews.forEach((t,i)=>{e.clearNTHGridSelection(i)})})},e.prototype._find_nodes_from_path=function(e,t){var i=this,n=[],o=[];"/"==t[0]&&(t=t.substr(1));var r=t.split("/");if(null!=r&&Array.isArray(r)&&r.length>0){var s=r.length,a=Math.floor(s/2)+1,l=r[0];for(const t of e.model){let e=t.options.data;if(null!=e){var u=e.getObjIDSpec_REF(),c=e.getObjIDSpec_INST();if(null!=u)if(i._isListCB())null==c?1===a&&u.getPhysID()===r[0]&&(i.dbgout("XSELECT","      structComparePanel._find_nodes_from_path - found node in LIST"),n.push(e)):a>1&&c.getPhysID()===r[s-2]&&u.getPhysID()===r[s-1]?(i.dbgout("XSELECT","      structComparePanel._find_nodes_from_path - found node in LIST"),n.push(e)):a>2&&c.getPhysID()===r[s-4]&&u.getPhysID()===r[s-3]&&(i.dbgout("XSELECT","      structComparePanel._find_nodes_from_path - found node in LIST"),o.push(e));else if(u.getPhysID()===l)if(1===a)i.dbgout("XSELECT","      structComparePanel._find_nodes_from_path - found node in TREE (root node)"),n.push(e);else{i.dbgout("XSELECT","      structComparePanel._find_nodes_from_path - searching thru root "+l);i._find_node_from_path(e,2,r,n)}}}return 0===n.length&&o.length>0?o:n}},e.prototype._find_node_from_path=function(e,t,i,n){var o=this;e.getChildArray().forEach((e,r)=>{var s=e.getObjIDSpec_REF(),a=null!=s?s.getPhysID():"null",l=e.getObjIDSpec_INST(),u=null!=l?l.getPhysID():"null",c=i[2*(t-1)-1],d=i[2*(t-1)];if(u===c&&a===d){var p=Math.floor(i.length/2+1);t===p?(n.push(e),o.dbgout("XSELECT","      structComparePanel._find_nodes_from_path - found node in TREE (under root)")):t<p&&(++t,o._find_node_from_path(e,t,i,n),--t)}})},e}),define("DS/CompareWidget2/ViewDefModules/DSColors",[],function(){var e={colorDef:{BLUE1:"#009DDB",ORANGE:"#FF8A2E",VIOLET:"#9B2C98",GREEN1:"#00AA86",PINK:"#F564A3",BLUE2:"#8DDEE4",RED:"#CC092F",GREY1:"#E2D5CC",GREEN2:"#6FBC4B",PURPLE:"#70036B",BLUE3:"#002596",BEIGE:"#C6C68B",GREY2:"#7F7F7F",BLUE4:"#4EA8B7",GREEN3:"#007A4C",GREY3:"#ADADAD",BLUE5:"#127277",RED2:"#6D2815",BLACK:"#000000",BLUE6:"#4D62BA",YELLOW:"#FEE000",WHITE:"#FFFFFF",NONE:"",LIGHT_TAN:"#EEEEEE",V1DIFF_STATUS:"#D2B48C",V1REV_STATUS:"#982C98",V1MOVE_STATUS:"#FFCC00",V1QTY_STATUS:"#1494DE"}};return e.colorSeq=[e.colorDef.BLUE1,e.colorDef.ORANGE,e.colorDef.VIOLET,e.colorDef.GREEN1,e.colorDef.PINK,e.colorDef.BLUE2,e.colorDef.RED,e.colorDef.GREY1,e.colorDef.GREEN2,e.colorDef.PURPLE,e.colorDef.BLUE3,e.colorDef.BEIGE,e.colorDef.GREY2,e.colorDef.BLUE4,e.colorDef.GREEN3,e.colorDef.GREY3,e.colorDef.BLUE5,e.colorDef.RED2,e.colorDef.BLACK,e.colorDef.BLUE6,e.colorDef.YELLOW,e.colorDef.WHITE,e.colorDef.NONE],e}),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN",["DS/CompareWidget2/plugins/plugin"],function(e){return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n)},execute:function(e,t){this._parent(e,t),e.crTreeArray.forEach(function(e){e.niceUp(!0)}),null!=e?this.reportOK(e):this.reportKO()}})}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/Legend",["UWA/Controls/Abstract","DS/Controls/Toggle"],function(e,t){return e.extend({init:function(e){this._parent({}),this.onClickCheckbox=e.onClickCheckbox,this.items=[]},update:function(e){this.items=[];var i=e.allFlagDefs;for(var n in i){var o=i[n],r=new t({type:"checkbox",label:o.label,checkFlag:!0});r.data=o,r.elements.checkSign.style.backgroundColor=o.color,r.addEventListener("change",this.onClickLegendCheckbox.bind(this));var s=UWA.createElement("div",{styles:{position:"relative",top:"-4px","padding-left":"4px","padding-right":"4px"}});s.toggle=r,r.inject(s),this.items.push(s)}},onClickLegendCheckbox:function(){var e=this.getCheckedIds();this.onClickCheckbox(e)},getCheckedIds:function(){for(var e=[],t=0;t<this.items.length;t++){var i=this.items[t].toggle,n=i.data;i.checkFlag&&e.push(n.id)}return e}})}),define("DS/CompareWidget2/plugins/VIEW3D/ViewPanel/exclusiveHideShowController",["UWA/Class","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/Visualization/SceneGraphUtils","DS/Visualization/IdPath","DS/PADUtils/PADSettingsMgt"],function(e,t,i,n,o,r){return e.extend({init:function(e){this._hideShowController=e,this._xShowSGOS=null,this._isLightNodeModel=r.getSetting("enopad3dviewer_lightNodeModel")},_getPAD3DViewer:function(){var e=null;return null!=this._hideShowController&&(e=this._hideShowController._context),e},_getSceneGraphOverrideSet:function(){var e=null;return null!=this._hideShowController&&(e=this._hideShowController._sceneGraphOverrideSet),e},_createOverrideSet:function(){null!=this._hideShowController&&(delete this._hideShowController._sceneGraphOverrideSet,this._hideShowController.createOverrideSet())},_publish:function(e){null!=this._hideShowController&&this._hideShowController.publish(e)},subscribe:function(e,t){if(null!=this._hideShowController)return this._hideShowController.subscribe(e,t)},unsubscribe:function(e){null!=this._hideShowController&&this._hideShowController.unsubscribe(e)},_getViewer:function(){var e=null,t=this._getPAD3DViewer();return null!=t&&(e=t.getViewer()),e},_getSceneGraphOverrideSetManager:function(){var e=null,t=this._getViewer();return null!=t&&(e=t.getSceneGraphOverrideSetManager()),e},_getPAD3DController:function(){var e=null,t=this._getPAD3DViewer();return null!=t&&(e=t.getController()),e},_asyncRender:function(){var e=this;setTimeout(function(){e._getViewer().render({updateInfinitePlane:!0})})},hide:function(e){this._hideShowController.hide(e)},show:function(e){this._hideShowController.show(e)},exclusiveShow:function(e){if("object"!=typeof e)throw new Error("No parameter defined");if(!Array.isArray(e.paths))throw new Error("No paths to be shown defined");var i=this;if(i._isLightNodeModel){i._resetExclusiveShow();var r=i._getPAD3DController().getRoots(),s=e.paths.length,a=2==s;if(1==a)for(var l=0;l<s;l++)if(1!=e.paths[0].length){a=!1;break}var u=[];for(l=0;l<r.length;l++){var c=t.getNodeID(r[l]);c&&u.push(new o([i._getPAD3DController().getRootBagId(),c]))}if(u.length){var d=i._xShowSGOS.createIdPathOverride({idPathes:u,propagateUntilRepRefs:!0});d&&d.setVisibility(1==a)}if(0==a){var p=[];for(l=0;l<e.paths.length;l++)p.push(new o([i._getPAD3DController().getRootBagId()].concat(e.paths[l])));if(p.length){var h=i._xShowSGOS.createIdPathOverride({idPathes:p,propagateUntilRepRefs:!0});h&&h.setVisibility(!0);var _=i._xShowSGOS.createIdPathOverride({idPathes:p,propagateToParents:!0});_&&_.setVisibility(!0)}}i._asyncRender(),i._publish({event:"onExclusiveShow",data:e})}else{i._resetExclusiveShow();var f=i._getPAD3DController()._model._nodeIndex,g=Object.getOwnPropertyNames(f),m=i._getPAD3DController()._model.getRootBag();g.forEach(function(e){f[e].is3DLeaf&&f[e].is3DLeaf()&&n.buildPathesLeadingToNode(f[e],m).forEach(function(e){i._getSceneGraphOverrideSet().createOverride(e).setVisibility(!1)})}),e.paths.forEach(function(e){if(t.isAModelPath(e)){var o=e.getLastElement(!0);if(o.is3DLeaf&&o.is3DLeaf()){i._getSceneGraphOverrideSet().createOverride(e).setVisibility(!0)}else{var r=[],s={};o.traverse(function(t){t.is3DLeaf&&t.is3DLeaf()&&!s[t.getID()]&&(s[t.getID()]=!0,n.buildPathesLeadingToNode(t,m).forEach(function(t){e.isAParentOf(t)&&r.push(t)}))}),r.forEach(function(e){i._getSceneGraphOverrideSet().createOverride(e).setVisibility(!0)})}}});var S=i._getSceneGraphOverrideSetManager();S&&(S.removeSceneGraphOverrideSet(i._getSceneGraphOverrideSet()),S.pushSceneGraphOverrideSet(i._getSceneGraphOverrideSet())),i._asyncRender(),i._publish({event:"onExclusiveShow",data:e})}},_resetExclusiveShow:function(){var e=this;if(e._isLightNodeModel){(t=e._getSceneGraphOverrideSetManager())&&(null!=e._xShowSGOS&&(t.removeSceneGraphOverrideSet(e._xShowSGOS),delete e._xShowSGOS),e._xShowSGOS=new i(e._getPAD3DController().getRootBag(),e._getPAD3DController().getRootBagId(),!0),t.pushSceneGraphOverrideSet(e._xShowSGOS)),e._asyncRender()}else{var t,n=e._getSceneGraphOverrideSet();if(null!=n)(t=e._getSceneGraphOverrideSetManager())&&t.removeSceneGraphOverrideSet(n),e._createOverrideSet(),e._asyncRender()}}})}),define("DS/CompareWidget2/viewComponents/MainToolbarEvents",["DS/CompareWidget2/userSettings/UserSettingsManager","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,i){"use strict";function n(e,n,o,r,s,a){var l={id:e,type:n,title:i[e],tooltip:t.generateTooltip("CompareWidget2/Tooltips",e)};return"function"==typeof r&&(l.state=!0===r.bind(l)()?"selected":""),null!=o&&(l.icon=o),"function"==typeof s&&(l.action={callback:s.bind(l)}),null!=a&&(l.submenu=a),l}var o=Object.create(null);return o.onClickSwap=function(e){e.objects._eventMgr.publish({event:"Event_CW2_SWAP"})},o.onClickRefresh=function(e){e.objects._eventMgr.publish({event:"Event_CW2_REFRESH"})},o.onClickX=function(e){e.objects._eventMgr.publish({event:"Event_CW2_RESET_TO_INPUT"})},o.onClickExport=function(e){e.objects._eventMgr.publish({event:"EXECUTE_EXPORT_EVENT"})},o.onProfileUpdate=function(e){void 0!==e.context&&null!==e.context&&null!=e.context.value&&(console.log("COMPARE RESULTS main toolbar - profile changed to ",e.context.value),e.context.toolbar._eventMgr.publish({event:"Event_CW2_SELECT_PROFILE",data:e.context.value}))},o.onEditCustomization=function(e){let t=e.objects.mainToolbar.elements.farContainer.getElement("#compare-main-customization-profile .wux-controls-combobox .wux-controls-combobox-mainelement"),i="";null!=t&&(i=t.getText()),e.objects._eventMgr.publish({event:"Event_showControlCenter",data:{profileName:i}})},o.createViewDropdown=function(e){var t=e.objects.resultFrame._layout;if(!t.maximizedPanel){for(var i=t.getViews(),n=[],o=0;o<i.length;o++){var r=i[o],s={type:"CheckItem",title:r.getLabel(),uid:r.getName(),state:t.isViewOpen(r)?"selected":"",action:{callback:function(){t.onClickShowHideViewCmd(this)},this:r}};n.push(s)}var a=e.objects.mainToolbar.elements.container.getElement(".wux-ui-3ds-eye-cog").getBoundingClientRect();require(["DS/Menu/Menu"],e=>e.show(n,{position:{x:a.right,y:a.bottom},layout:"topright"}))}},o.createAdditionalMenu=function(r){var s=[n("compareSettings.includeFacets.externalRelations","PushItem","object-related-cog",null,null,[n("compareSettings.includeFacets.externalRelations.showDocs","CheckItem","doc",function(){return"true"===e.get(this.id)||!0===e.get(this.id)},function(){e.set(this.id,!e.get(this.id)),r.objects._eventMgr.publish({event:"Event_CW2_REFRESH"})}),n("compareSettings.includeFacets.externalRelations.showOtherRels","CheckItem","object-related",function(){return"true"===e.get(this.id)||!0===e.get(this.id)},function(){e.set(this.id,!e.get(this.id)),r.objects._eventMgr.publish({event:"Event_CW2_REFRESH"})})]),{id:"closeAllObjects",type:"PushItem",title:i.closeAllObjects,tooltip:t.generateTooltip("CompareWidget2/Tooltips","closeAllObjects"),icon:"close",action:{callback:function(){o.onClickX(r)}}},{id:"mainToolbarRestoreLayout",tooltip:t.generateTooltip("CompareWidget2/Tooltips","mainToolbarRestoreLayout"),type:"PushItem",icon:"reset",title:i.restoreLayout,action:{callback:function(){r.objects.resultFrame.applyDefaultLayout()}}}];r.objects.mainToolbarOptions.forEach(function(e){for(var t=e,i=0;i<s.length;i++)s[i].id.indexOf(t)>=0&&(s.splice(i,1),i--)});var a=r.objects.mainToolbar.elements.container.getElement(".wux-ui-3ds-menu-dot").getBoundingClientRect();require(["DS/Menu/Menu"],e=>e.show(s,{position:{x:a.right,y:a.bottom},layout:"topright"}))},o}),define("DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj",["DS/CompareWidget2/support/cw2Utils"],function(e){function t(t){var i=!1;return null!=t&&0!=t.length?i=!0:e.errout("Invalid string (null or zero length)"),i}var i=function(){this._attrList={},this._reqModforODT="DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj"};return i.prototype.isREF=function(){var e=!1;return null==this._attrList.matrixtxt&&(e=!0),e},i.prototype.isINST=function(){return!isREF},i.prototype.addAttr=function(i,n,o){t(i)&&(null!=o&&1!=o||null==this._attrList[i]||e.warnout("New attr value is overwriting an existing attr value for '"+i+"'"),this._attrList[i]=n)},i.prototype.setAttr=function(e,t){this.addAttr(e,t,!1)},i.prototype.rmAttr=function(e){delete this._attrList[e]},i.prototype.getAttrList=function(){return this._attrList},i.prototype.getAttr=function(e){return ret=null,t(e)&&(ret=this._attrList[e]),ret},i}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu",["UWA/Core","DS/CompareWidget2/viewComponents/ContextMenuBase","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structExpandCollapseMenu","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structOpenWithMenu"],function(e,t,i,n){"use strict";return t.extend({init:function(e){this._structComparePanel=e.structComparePanel,this._expandCollapseMenu=new i(e),this._openWithMenu=new n(e)},createContextMenu:function(e){var t=this;return new Promise(function(i){var n=[];if(null!=e&&void 0!==e.collectionView&&null!==e.collectionView)if(function(e){return null==e||void 0===e.cellInfos||null===e.cellInfos||void 0===e.cellInfos.cellModel||null===e.cellInfos.cellModel}(e))i(n);else{var o=e.cellInfos.nodeModel.getTreeDocument().getSelectedNodes(),r={useSelectionInContext:!t._structComparePanel.isList()};t._openWithMenu.getOpenWithMenuPromise(e,o,r).then(function(o){null!=o&&n.push(o);var r=t._expandCollapseMenu.getExpandCollapseContextMenu(e,t._structComparePanel.getActiveExpandMenuId());r&&(n.length>0&&n.push({type:"SeparatorItem"}),n.push(r)),i(n)})}else i(n)})},onComparePanelUpdated:function(){void 0!==this._openWithMenu&&null!==this._openWithMenu&&this._openWithMenu.clearLaunchTreeArray()}})}),define("DS/CompareWidget2/plugins/plugin",["UWA/Class","DS/CompareWidget2/userSettings/UserSettingsManager"],function(e,t){return e.extend({setOutputFn:function(e){this._outputFn=e},updateOutput:function(e){null==this._outputFn?this._plugSvcs.warnout("PLUGIN trying to set new output, but no output fn set"):this._outputFn(e)},reportOK:function(e){this.dbgout("------------------------------------------------------------"),0!=this._startMS&&this._plugSvcs.reportTime(this._startMS," Plugin '"+this._plugPath+"' execution "),this.dbgout("->->-> Plugin '"+this._plugPath+"' reports success <<<"),this.dbgout("------------------------------------------------------------"),this.updateOutput(e)},reportKO:function(e){this._plugSvcs.errout("<<< Plugin '"+this._plugPath+"' reports failure:: "+e)},subscribeEvent:function(e,t){if(null==this._subscribeTokens[e]){var i=this._plugSvcs.subscribe(e,t);this._subscribeTokens[e]=i}},unsubscribeEvent:function(e){null!=this._subscribeTokens[e]&&(this._plugSvcs.unsubscribe(e),delete this._subscribeTokens[e])},unsubscribeAllEvents:function(){var e=this,t=!0;try{Object.keys(e._subscribeTokens).forEach(function(t){var i=e._subscribeTokens[t];e._plugSvcs.unsubscribe(i)})}catch(i){this._plugSvcs.warnout("problem unsubscribing events in plugin "+e.getName()),t=!1}return e._subscribeTokens={},t},postEvent:function(e,t){this._plugSvcs.postEvent(e,t)},isEnabled:function(){return this._enabled},enable:function(){return this._enabled=!0,this.onEnabled()},disable:function(){this._enabled=!1,this.onDisabled()},disconnect:function(){this.onDisconnect(),this.unsubscribeAllEvents(),this.unsyncAllSettings(),this._pluginOptions={},this._outputFn=null,this.disable()},destroy:function(){this.onDestroy(),this.disconnect(),this._plugPath=null,this._plugSvcs=null,this._type=null,this._parent()},onLoad:function(){return!0},onEnabled:function(){return!0},onDisabled:function(){},onDisconnect:function(){},onDestroy:function(){},execute:function(e,t){null!=t&&Object.assign(this._pluginOptions,t,this._pluginOptions),this.dbgout("~~~~ "+this.getPath()+".execute() running... "),this._startMS=this._plugSvcs.nowMS()},enableDebugLabel:function(e){this.dbgout=this._plugSvcs.dbgout,null!=e&&this._plugSvcs.enableDebugLabel(e)},dbgout:function(e){},init:function(e,t,i,n){this._parent(),this._pluginOptions=i||{},this._plugPath=e,this._name=t,this._plugSvcs=n,this._outputFn=null,this._type="PLUGIN",this._subscribeTokens={},this._syncTokens={},this._enabled=!1,this._startMS=0},getPath:function(){return this._plugPath},getName:function(){return this._name},getType:function(){return this._type},syncSetting:function(e,i,n,o){t.hasPref(e)&&(i=i||e,null==this._syncTokens[i]&&(this._syncTokens[i]={settingKey:e,callback:n,object:o},t.sync(o||this,e,i,n)))},unsyncAllSettings:function(){for([key,value]of Object.entries(this._syncTokens))t.unsync(value.object||this,value.settingKey,key,value.callback);this._syncTokens={}}})}),define("DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_TXT_DISPLAY_plugin",["DS/CompareWidget2/plugins/plugin"],function(e){function t(e,t,i){for(var n=e,o=t-e.length,r=0;r<o;r++)n+=" ";return n+=i}function i(e,i){e("************************************************************************************************************************"),e("***********************************  A T T R   D U M P  ****************************************************************"),e("*** PHYSICALID:   "+i.getPhysicalID());var n=i.getDBContext();e("***       TYPE:   "+i.getObjType()),e("***  DBCONTEXT:   "+n.tenant+" // "+n.serviceName+" // "+n.securityContext),e("*** iconURL LG:   "+i.getIconURLLarge()),e("***    iconURL:   "+i.getIconURL());var o=i.getAttrCount(),r="   NAME";r=t(r,25,"NLS"),r=t(r,50,"VALUE"),r=t(r,75,"TYPE"),e(r=t(r,100,"UIPosition")),r=t(r="   ----",25,"---"),r=t(r,50,"-----"),r=t(r,75,"----"),e(r=t(r,100,"----------"));for(var s=0;s<o;s++){var a=i.getAttr(s),l="   "+a.name;l=t(l,25,a.nls),l=t(l,50,a.value),l=t(l,75,a.type),e(l=t(l,100,a.UIPosition))}e("************************************************************************************************************************")}return e.extend({execute:function(e,t){this._parent(e,t);for(var n=e,o=n.length,r=0;r<o;r++){n[r];i(this.dbgout,dbgout)}this.reportOK(!0)}})}),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_TXT_DISPLAY_plugin",["DS/CompareWidget2/plugins/plugin"],function(e){function t(e,t,i){for(var n=e,o=t-e.length,r=0;r<o;r++)n+=" ";return n+=i}function i(e,i){var n=["","    ","        ","            ","                ","                    ","                        ","                            "],o=[];o.push(e.getRoot());var r=[];r.push(0);for(;o.length>0;){var s=o.pop(),a=r.pop(),l=n[a],u=s.get_dbObj_INST();if(null!=u)l=t(l+=null==u?"":u.getAttr("ro.plminstance.plm_externalid"),50,"("+u.getAttr("ds6w:type")+")");var c=s.get_dbObj_REF(),d=c.getAttr("ds6w:label"),p=c.getAttr("ds6wg:revision"),h=c.getAttr("ds6w:type");l=t(l,70,"REF: ["+p+"] "+d),i(l=t(l,115,"("+h+")"));for(var _=s.getChildArray(),f=0;f<_.length;f++){var g=_[f];o.push(g),r.push(a+1)}}}return e.extend({execute:function(e,t){var n=this;n._parent(e,t);for(var o=e,r=o.length,s=0;s<r;s++){var a=o[s];n.dbgout("--------------------------------------- TREE #"+s+" ------------------------------------------"),i(a,n.dbgout),n.dbgout("------------------------------------------------------------------------------------------")}n.reportOK(!0)}})}),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_TXT_DISPLAY_plugin",["DS/CompareWidget2/plugins/plugin"],function(e){function t(e,t){t("[---------- ROOT #0----------]"),i("",e.getRoot(0),t),t("[---------- ROOT #1----------]"),i("",e.getRoot(1),t)}function i(e,t,n){n(e+">>>>>>>>>>> NODE >>>>>>>>>>>>>>"),function(e,t,i){i(e+" name : "+t.getAttr("name")),i(e+" title: "+t.getAttr("title")),i(e+" type : "+t.getAttr("type")),i(e+" Rev  : "+t.getAttr("revision"))}(e,t,n),function(e,t,i){var n=t.getMatchInfo();null==n?i(e+" THIS NODE IS UNMATCHED"):(i(e+" ***** MATCH TYPE      : "+n.getRelName()),i(e+" ***** MATCH BASE NODE : '"+n.getBaseNode().getAttr("name")),i(e+" ***** MATCH COMP NODE : '"+n.getCompNode().getAttr("name")))}(e,t,n),n(e+"-------");for(var o=t.getChildArray(),r=0;r<o.length;r++){i(e+"    ",o[r],n)}n(e+"<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<")}return e.extend({execute:function(e,i){var n=this;n._parent(e,i);var o=e.crTreeArray,r=e.ruleNames;n.dbgout(" ruleNames: "+r.join());for(var s=o.length,a=0;a<s;a++){var l=o[a];n.dbgout("--------------------------------------- STRUCT COMPARE RESULT ------------------------------------------"),t(l,n.dbgout),n.dbgout("------------------------------------------------------------------------------------------")}n.reportOK(!0)}})}),define("DS/CompareWidget2/plugins/VIEW3D/VIEW3D_PREP_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/VIEW3D/view3DJSONEngine_LDV"],function(e,t){return e.extend({execute:function(e,i){this._parent(e,i);var n=e,o=t.refInstTree2ViewerJSON(n,this._plugSvcs);null!=o?this.reportOK(o):this.reportKO()}})}),define("DS/CompareWidget2/support/DataCenter",["UWA/Class","DS/WidgetServices/WidgetServices","DS/LifecycleServices/LifecycleServicesSettings","DS/WAFData/WAFData","DS/CompareWidget2/support/cw2Utils"],function(e,t,i,n,o){var r=e.singleton({init:function(){this._parent({})},makeAuthHttpsCall:function(e,r,s,a,l,u,c,d,p,h){return new Promise(function(_,f){null!=e&&e.constructor==String&&0!=e.length||f("BAD svcPath format:"+e),"GET"!=r&&"POST"!=r&&f("Method type: "+r+" is not supported"),null==c&&o.warnout("Call to "+e+" is missing securityContext");var g=u||"3DSpace",m=l||"OnPremise",S=e,C=null;"POST"==r&&null!=s&&(C=!0===p?s:UWA.Json.encode(s),s=null),"3dspace"==g.toLowerCase()&&"3DSpace"!=g&&(o.errout("Correcting malforded service '"+g+"' to '3DSpace'"),g="3DSpace");var T=i.getPlatformWSUrl(g,m,S,h||s),E={Accept:"application/json","Accept-Language":t.getLanguage(),"Content-Type":!0===p?"text/plain":"application/json",SecurityContext:null!=c?c:void 0},v=1!=d;n.authenticatedRequest(T,{method:r,type:a,timeout:48e4,data:C,headers:E,proxy:"passport",cache:v,onComplete:function(e){null!=e&&null!=e.STATUS?"OK"==e.STATUS?_(e.RESULT):(o.errout("**** SERVER ERROR calling: "+T),o.errout("**** MSG: "+e.MSG),f(e.MSG)):null==e?(o.errout("**** SERVER ERROR calling: "+T),o.errout("**** RESPONSE IS null"),f("null response")):_(e)},onFailure:function(e){o.errout("**** HTTPS ERROR calling: "+T),o.errout("**** MSG: "+e),null!=c&&""!=c||o.errout("**** Probably related to blank security context in request"),f(e)}})})},loadPageObject:function(e,t,i){var n="/resources/collabCommon/settings/getComparePageObj/"+e;return this.makeAuthHttpsCall(n,"GET",null,"json",t,"3DSpace",i,!0)},savePageObject:function(e,t,i,n){var o="/resources/collabCommon/settings/updateComparePageObj/"+e;return this.makeAuthHttpsCall(o,"POST",{settings:{content:t}},"json",i,"3DSpace",n,!0)},loadPrefPromise:function(e,t){return this.makeAuthHttpsCall("/resources/AppsMngt/user/getPreferences","GET","name="+e,"text","__NOTENANT__",null,null,t)},savePrefs:function(e,t){this.makeAuthHttpsCall("/resources/AppsMngt/user/setPreferences","GET","name="+e+"&value="+encodeURI(t),"text","__NOTENANT__",null,null).then(()=>{},()=>{})},fetchFilterDefinition:function(e){return new Promise(function(t,i){var n="filterId="+e.getPhysID();r.makeAuthHttpsCall("/resources/FilterBIAPI/Filter/getFilterFromId","GET",n,"json",e.getTenant(),e.getServiceName(),e.getSecurityContext()).then(function(e){var i=e.ENOStrSpecDesc;t(i)},function(e){i(e)})})}});return r}),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/lifecycleServicesExpand",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter","DS/LifecycleServices/LifecycleServicesSettings","UWA/Json"],function(e,t,i,n){var o="/resources/lifecycle/expand/federated";return{jsName:"LIFECYCLE_SVC_EXPAND",doExpand:function(e,n,r,s,a){return me=this,new Promise(function(r,l){(function(e,i,n,r){var s=this;return new Promise(function(n,a){var l=null,u=null,c=null,d=[],p=[],h="",_="";null!=r.CV_PROPS&&Object.keys(r.CV_PROPS).forEach(function(e){var t=r.CV_PROPS[e];"REF.dfr"==t&&(t="REF.bo.plmreference.v_derivedfrom"),-1==t.indexOf(".")&&d.push(t),t.startsWith("REF.")?d.push(t.substring(4)):t.startsWith("INST.")&&p.push(t.substring(5))});var f=e.getExternalFilterSpec();null!=f&&null!=f.CVQuery&&((h={}).CVQuery=f.CVQuery),null!=f&&null!=f.CVQueryV2&&(null!=f.CVQueryV2.filter?(_={}).filter=f.CVQueryV2.filter:(_={}).filter=f.CVQueryV2.batch.expands[0].filter),d.includes("bo.plmentity.v_usage")&&d.splice(d.indexOf("bo.plmentity.v_usage"),1,"bo.PLMEntity.V_usage"),p.includes("ro.plminstance.V_treeorder")||p.push("ro.plminstance.V_treeorder");var g=r.COMMAND_CONTEXT?r.COMMAND_CONTEXT:"compare";if("LC_IDX_SERVICE"==i||"LC_AUTH_SERVICE"==i){l=o;var m="LC_AUTH_SERVICE"==i;u="POST",c={ids:[e.getPhysID()],authoring:m,command:g,enableProto:!0,select_bo:d,select_rel:p,filter:h,filterV2:_}}else{var S="UNEXPECTED data source: "+i;s.plugSvcs.errout(S),a(S)}var C=e.getTenant(),T=e.getSecurityContext(),E=e.getServiceName();t.makeAuthHttpsCall(l,u,c,"json",C,E,T,!0).then(function(e){n(e)},function(e){a(e)})})})(e,n,0,a).then(function(e){var t=e.errorCode;if(t){var o=e.errorMessage;return s.errout("Lifecycle federated expand via "+n+" failed; errorCode:"+t+" errorMessage:"+o),void l(e)}if(!me._responseValidityCheck(e))return s.errout("Lifecycle federated expand via "+n+" failed; response deemed invalid."),void l(e);var a=e.results;a.forEach(function(e){e.attributes&&(e.attributes=e.attributes.filter(e=>""!==e.value),e.attributes.forEach(function(e){"bo.PLMEntity.V_usage"===e.name&&(e.name="bo.plmentity.v_usage")}))}),a.forEach(function(e){if(e.icon__default_thumbnail_2d){var t=i.getTenant(),n=i.get3DSpaceBaseUrl(t);e.icon__default_thumbnail_2d.forEach(function(e){e.icon&&e.icon.startsWith("/")&&(e.icon=n+e.icon)})}}),a._dataSource=n,r(a)},function(e){s.errout(e),l(e)})})},_responseValidityCheck:function(e){if(!e.results)return!1;var t=e.results;if(!Array.isArray(t))return!1;if(!t.find(e=>e.attributes&&e.attributes.length>0))return!1;var i=t.find(e=>e.path&&e.path.length>0);if(!i)return!1;var n=i.path[0];return!!t.find(e=>e.attributes&&Array.isArray(e.attributes)&&e.attributes.find(e=>"did"===e.name&&e.value==n))}}}),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/compareServiceExpand",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter","UWA/Json"],function(e,t,i){var n="/resources/compare/index/postFetchModelsFromIndex",o="/resources/compare/fetchModels";function r(e,i,r,s){return new Promise(function(a,l){var u=null,c=null,d=null,p="";null!=s.DB_PROPS&&Object.keys(s.DB_PROPS).forEach(function(e){var t=s.DB_PROPS[e];"REF.dfr"==t&&(t="REF.attribute[PLMReference.V_DerivedFrom]"),p+=t+","});var h=encodeURIComponent(p),_=void 0!==s.USE_MCS&&null!==s.USE_MCS&&!1===s.USE_MCS?"":"USE_MCS";if("CV_SERVICE"==i){u=n,c="POST";let t=[];if(Array.isArray(e))for(let i of e)t.push({type:"IDSPEC",spec:i.getPhysID()});else t.push({type:"IDSPEC",spec:e.getPhysID()});d={objSpecList:t,depth:r,compareOption:_,PROPS:h}}else if("DB_SERVICE"==i){if(u=o,c="GET",Array.isArray(e))for(let t=0;t<e.length;++t)0===t&&(d="objectIds="),d+=e[t].getPhysID(),t<e.length-1&&(d+=",");else d="objectIds="+e.getPhysID();d+="&compareOption="+_,d+="&PROPS="+h}else{var f=plugSvcs.errout("UNEXPECTED data source: "+i);l(f)}var g=Array.isArray(e)?e[0].getTenant():e.getTenant(),m=Array.isArray(e)?e[0].getSecurityContext():e.getSecurityContext(),S=Array.isArray(e)?e[0].getServiceName():e.getServiceName();t.makeAuthHttpsCall(u,c,d,"json",g,S,m,!0).then(function(e){a(e)},function(e){l(e)})})}return{jsName:"COMPARE_SVC_EXPAND",doExpand:function(e,t,i,n,o){return new Promise(function(s,a){r(e,t,i,o).then(function(e){var i=e[0];if(null!=i.Failed_idlist){var o=i.Failed_idlist[0].error;n.errout("Error retrieving data:: "+o),a(o)}else i._dataSource=t,s(i)},function(e){n.errout(e),a(e)})})},doExpandN:function(e,t,i,n,o){return new Promise(function(s,a){r(e,t,i,o).then(function(i){if(Array.isArray(e)){for(let e of i)e._dataSource=t;s(i)}else{var n=i[0];n._dataSource=t,s(n)}},function(e){n.errout(e),a(e)})})}}}),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/cvExpand",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter"],function(e,t){var i={select_bo:["physicalid","ds6w:type","ds6w:globaltype","ds6wg:revision","ds6w:label","ds6wg:XCADOrientationExt.V_WorldOrientation"],compute_select_bo:["cgr","thumbnail_3d","icon"],select_rel:["physicalid","ds6w:type","ro.plminstance.v_treeorder","ro.plminstance.plm_externalid"]},n={...i,...{select_bo:["relcount","bo.plmentity.plm_externalid","ds6w:reserved","ds6w:description","ds6w:modified","ds6w:created","ds6w:responsible","ds6w:policy","ds6w:organizationResponsible","ds6w:project","ds6w:reservedBy","ds6w:identifier","bo.plmreference.v_derivedfrom"],select_rel:["matrixtxt"]}};function o(t,o,r){var l=null!=r&&0!=r.length,u=l?i:n,c=e.dupeJson(u);return o&&(c=s(c)),l&&(c=a(c,r)),c.label="ComparefilterQuery-"+e.nowMS(),null!=t.CVQuery3D?c.union=t.CVQuery3D.union:null!=t.CVQuery?c.union=t.CVQuery.union:c=null,c}function r(t,o,r,l){var u=null!=l&&0!=l.length,c=u?i:n,d=e.dupeJson(c);return d.no_type_filter_bo=["PLMPort","PLMConnection"],r&&(d=s(d)),u&&(d=a(d,l)),d.root_physicalid=t,d.expand_iter=o||"-1",d.label=widget._isODTMode()?"":"Compare2-"+e.nowMS(),d}function s(e){return e.fcs_url_mode="REDIRECT",e.boundingbox=!0,e.with_synthesis=!0,e}function a(e,t){return Object.keys(t).forEach(function(i){var n=t[i],o=n.indexOf(".");if(-1==o)e.select_bo.push(n);else{var r=n.substr(0,o),s=n.substr(o+1);"REF"==r?("dfr"==s&&(s="bo.plmreference.v_derivedfrom"),-1==e.select_bo.indexOf(s)&&e.select_bo.push(s)):"INST"==r?-1==e.select_rel.indexOf(s)&&e.select_rel.push(s):KOfn("UNKNOWN specifier in PROPS definition")}}),e}function l(e,i,n,s,a){return new Promise(function(l,u){s.dbgout("------------[ T R E E   E X P A N S I O N    B E G I N ] -----------"),function(e,i){return new Promise(function(n,o){var r={};if("DELLmiGeneralSystemReference"==e.getObjType())r.name="EXPAND",r.url="/cvservlet/expand",n(r);else if(null!=e.getExternalFilterSpec())i.forEach(function(e){"Filter"!=e.name||(r=e)}),null==r?o("URL for filter missing from viewDef/options"):n(r);else{var s=e.getPhysID(),a=e.getTenant(),l=e.getServiceName(),u=e.getSecurityContext(),c={queryPhysID:s,catSpec:i};t.makeAuthHttpsCall("/resources/compare2/IDCat/","POST",c,"json",a,l,u).then(function(e){n(e)},function(e){o("Failure determining expand type")})}})}(e,a.CVURL_BY_TYPE).then(function(c){var d=c,p=d.url,h=d.name;s.dbgout("cvExpand on id: "+e.getPhysID()+" on service   : "+e.getServiceName()+" with expand type: "+h+" with URL     : "+p);var _=!1;"3D"!=h&&"Filter"!=h||(_=!0),function(e,i,n,s){let a=s.CV_PROPS;return new Promise(function(l,u){if("ENOStrRefinementSpecification"==e.getObjType())t.fetchFilterDefinition(e).then(function(e){var t=o(JSON.parse(e.filterCVQuery),n,a);l(t)},function(e){u(e)});else{var c=e.getExternalFilterSpec(),d=null;null!=c?"DELLmiGeneralSystemReference"==e.getObjType()?(d=r(e.getPhysID(),i,n,a)).config_filter=c.CVQuery.union.expand[0].config_filter:d=o(c,n,a):d=r(e.getPhysID(),i,n,a),s.EXPAND_V1_OPTIONS&&s.EXPAND_V1_OPTIONS.no_type_filter_bo&&(d.no_type_filter_bo=s.EXPAND_V1_OPTIONS.no_type_filter_bo),l(d)}})}(e,n,_,a).then(function(n){var o=n;t.makeAuthHttpsCall(p,"POST",o,"json",e.getTenant(),e.getServiceName(),e.getSecurityContext()).then(function(e){null!=e.error&&u(e.error);var t=e.results;t._dataSource=i,s.dbgout("------------[ T R E E   E X P A N S I O N    E N D    ] -----------"),l(t)},function(e){u(e)})},function(e){u(e)})},function(e){u(e)})})}return{jsClass:"CVEXPAND",doExpand:function(e,t,i,n,o){return l(e,t,i,n,o)}}}),define("DS/CompareWidget2/Customization/CompareCustomization",["UWA/Core","DS/Core/Core","DS/Utilities/Dom","DS/Controls/Button","DS/Controls/Label","DS/Controls/ComboBox","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/WUXAutoComplete/AutoComplete","DS/Controls/Expander","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/TreeModel/DataModelSet","DS/UIKIT/Mask","DS/CompareCommon/Utils","DS/CompareWidget2/support/DataCenter","DS/CompareWidget2/ViewDefModules/DSColors","DS/CompareWidget2/Customization/getProfileNameDialog","DS/CompareWidget2/Customization/Profile","i18n!DS/UIKIT/assets/nls/UIKIT","i18n!DS/CompareCommon/assets/nls/CompareCustomization","css!DS/CompareWidget2/CompareWidget2.css"],function(e,t,i,n,o,r,s,a,l,u,c,d,p,h,_,f,g,m,S,C,T,E){"use strict";function v(e){let t=e.getChildren();for(var i=0;i<t.length;++i)t[i].options.grid.MR_Order=i+1}function I(e,t,i){return t.prepareUpdate(),t.addRoot(e),!0===i&&v(t),t.pushUpdate(),t.getChildren().length}const y=27,D=26;function R(e,t){let i=(y+(e<1?1:e)*D).toString()+"px";t.setStyles({height:i})}var b=function(e){if(null==e)throw Error("CompareCustomization: Compare customizations are not loaded");this._CCM=e,this.initModel()};function O(e){return new p({label:E.get("template"===e?"TemplateProfiles":"admin"===e?"AdminProfiles":"MyProfiles"),ccId:"template"===e?"templates":"admin"===e?"adminprofiles":"userprofiles",comboBoxSemantics:"section",description:E.get("template"===e?"TemplateProfilesDescription":"admin"===e?"AdminProfilesDescription":"MyProfilesDescription")})}return b.prototype.initModel=function(){this._currentProfile=null,this._currentProfileOrg=null,this._TypesInfo=[],this._RolesInfo=[],this._manipulatingProfileFromUI=!0,this._profileNameDlg=null},b.prototype.show=function(e,t,i){this.doneCB=i,this.buildSkeleton(e),this._initialProfileIn="",this._initialProfileInChanged=!0,null!=t&&void 0!==t.profileName&&null!==t.profileName&&""!==t.profileName&&(this._initialProfileIn=t.profileName,this._initialProfileInChanged=!1),this.initUI(t)},b.prototype.buildSkeleton=function(t){void 0!==this.customizationRoot&&null!==this.customizationRoot||(this.customizationRoot=e.createElement("div",{id:"compare-customization-root",html:[]}),this.customizationRoot.inject(t),this.buildSkeleton_Header(),this.buildSkeleton_Body(),this.buildSkeleton_Footer())},b.prototype.buildSkeleton_Header=function(){},b.prototype.buildSkeleton_Body=function(){this.customizationBody=e.createElement("div",{id:"compare-customization-body",html:[]}).inject(this.customizationRoot),this.buildSkeleton_Section_Profile(),this.buildSkeleton_Section_Rules()},b.prototype.buildSkeleton_Section_Profile=function(){this.profileContent=e.createElement("div",{class:"compare-customization-exp-cont"});new u({header:E.get("ComparisonProfileLabel"),body:this.profileContent,expandedFlag:!0}).inject(this.customizationBody);this.profileRow=e.createElement("div",{class:"compare-customization-row"}).inject(this.profileContent),this.profileRow.setStyle("margin-top","0px"),new o({value:E.get("ProfileTitleLabel")}).inject(this.profileRow).getContent().addClassName("compare-customization-label"),i.generateIcon({className:"compare-customization-help",iconName:"info",fontIconFamily:WUXManagedFontIcons.Font3DS,tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","ProfilesTitleTooltips")}).inject(this.profileRow).classList.remove("wux-ui-3ds-lg"),this.profilesCombo=new r({placeholder:E.get("NoProfileSpecified"),reachablePlaceholderFlag:!0,elementsTree:null,enableSearchFlag:!1,domId:"compare-customization-profile"}).inject(this.profileRow),this.profilesCombo.getContent().style.width="300px",this.profilesCombo.addEventListener("change",this.onProfileSelected.bind(this)),this.profilesDuplicate=new n({displayStyle:"icon",icon:{iconName:"duplicate",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1,domId:"compare-customization-duplicate",tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","DuplicateProfileTooltips")}).inject(this.profileRow),this.profilesDuplicate.getContent().setStyles({"min-height":"16px","line-height":"16px","margin-left":"10px"}),this.profilesDuplicate.addEventListener("buttonclick",this.onDuplicateProfile.bind(this)),this.profilesDelete=new n({displayStyle:"icon",icon:{iconName:"trash",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1,domId:"compare-customization-delete",tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","DeleteProfileTooltips")}).inject(this.profileRow),this.profilesDelete.getContent().setStyles({"min-height":"16px","line-height":"16px"}),this.profilesDelete.addEventListener("buttonclick",this.onDeleteProfile.bind(this)),this.typesRow=e.createElement("div",{class:"compare-customization-row"}).inject(this.profileContent),new o({value:E.get("ObjectTypesLabel")}).inject(this.typesRow).getContent().addClassName("compare-customization-label"),i.generateIcon({className:"compare-customization-help",iconName:"info",fontIconFamily:WUXManagedFontIcons.Font3DS,tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","ObjectTypesTooltips")}).inject(this.typesRow).classList.remove("wux-ui-3ds-lg"),this.typesLabels=[],this.interfacesRow=e.createElement("div",{class:"compare-customization-row"}).inject(this.profileContent),new o({value:E.get("InterfacesLabel")}).inject(this.interfacesRow).getContent().addClassName("compare-customization-label"),i.generateIcon({className:"compare-customization-help",iconName:"info",fontIconFamily:WUXManagedFontIcons.Font3DS,tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","InterfacesTooltips")}).inject(this.interfacesRow).classList.remove("wux-ui-3ds-lg"),this.interfacesLabels=[],this.profileInformationLabel=new o({value:"",emphasize:"Highlight"}).inject(this.profileRow)},b.prototype.buildSkeleton_Section_Rules=function(){this.rulesContent=e.createElement("div",{class:"compare-customization-exp-cont"}),this.rulesExpander=new u({header:E.get("RulesLabel"),body:this.rulesContent,expandedFlag:!0}),this.rulesExpander.inject(this.customizationBody),this.buildSkeleton_Group_MatchingRules(),this.buildSkeleton_Group_AdditionalStatuses()},b.prototype.buildSkeleton_Group_MatchingRules=function(){this.rulesRow=e.createElement("div",{class:"compare-customization-row"}).inject(this.rulesContent),this.rulesRow.setStyles({"margin-top":"0px"}),new o({value:E.get("MatchingRulesLabel")}).inject(this.rulesRow).getContent().addClassName("compare-customization-label"),i.generateIcon({className:"compare-customization-help",iconName:"info",fontIconFamily:WUXManagedFontIcons.Font3DS,tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","MatchingRuleTooltips")}).inject(this.rulesRow).classList.remove("wux-ui-3ds-lg");let t=new a({type:"radio"});this.useDefaultRulesBtn=new s({type:"radio",label:E.get("UseDefaultRules"),checkFlag:!0,tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","UseDefaultMatchingRulesTooltips")}),this.useCustomRulesBtn=new s({type:"radio",label:E.get("UseCustomRules"),checkFlag:!1,tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","UseCustomMatchingRulesTooltips")}),t.addChild(this.useDefaultRulesBtn),t.addChild(this.useCustomRulesBtn),this.useDefaultRulesBtn.getContent().setStyles({"margin-right":"5px","margin-left":"5px"}),this.useCustomRulesBtn.getContent().setStyles({"margin-right":"5px","margin-left":"5px"}),this.useDefaultRulesBtn.elements.label.setStyles({"margin-right":"6px","margin-left":"6px"}),this.useCustomRulesBtn.elements.label.setStyles({"margin-right":"6px","margin-left":"6px"}),t.getContent().setStyles({display:"flex","margin-right":"10px","margin-left":"16px"}),t.inject(this.rulesRow),t.addEventListener("change",this.onChangeUseDefaultCustomMatchingRules.bind(this)),this.matchingRulesAdd=new n({label:E.get("AddMatchingRule"),icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS},displayStyle:"icon",domId:"compare-customization-add-MR",tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","AddMatchingRuleTooltips")}).inject(this.rulesRow),this.matchingRulesAdd.getContent().setStyles({"min-height":"16px","line-height":"16px","margin-left":"10px"}),this.matchingRulesAdd.addEventListener("buttonclick",this.onAddMatchingRule.bind(this)),this.buildSkeleton_RulesTable("MatchingRulesDataGridViewId")},b.prototype.buildSkeleton_RulesTable=function(t){var i=this,n=e.createElement("div",{class:"compare-customization-table",id:"MatchingRulesDataGridViewId"===t?"compare-customization-MR-table":"compare-customization-AS-table"}).inject(this.rulesContent);const o=y.toString()+"px";n.setStyles({position:"relative",height:o});var r=new h,s=new d({dataModelSet:r});s.prepareUpdate(),s.expandAll(),s.pushUpdate();var a=[];"MatchingRulesDataGridViewId"===t&&a.push({dataIndex:"MR_Order",text:E.get("MatchingRulesOrder"),typeRepresentation:"number",width:"24px",editableFlag:!1,sortableFlag:!1}),"AdditionalStatusesDataGridViewId"===t&&a.push({dataIndex:"AS_Facet",text:E.get("StatusNameColumnHeader"),typeRepresentation:"string",width:"200px",editableFlag:!1,sortableFlag:!1}),"MatchingRulesDataGridViewId"===t&&a.push({dataIndex:"MR_StatusName",text:E.get("StatusNameColumnHeader"),typeRepresentation:"string",width:"200px",sortableFlag:!1,editionPolicy:"EditionInPlace",getCellSemantics:function(e){return{placeholder:E.get("StatusNameColumnHeader")}},getCellClassName:function(e){return e.nodeModel?"MatchingRulesDataGridViewId"===t&&""===e.cellModel?"compare-customization-needvalue":"":"headerClass"}}),a.push({dataIndex:"MatchingRulesDataGridViewId"===t?"MR_Color":"AS_Color",text:E.get("StatusColor"),typeRepresentation:"color",width:28,minWidth:28,sortableFlag:!1,editionPolicy:"EditionOnOver"}),a.push({dataIndex:"MatchingRulesDataGridViewId"===t?"MR_Attribute":"AS_Attribute",text:E.get("AttributeColumnHeader"),typeRepresentation:"url",sortableFlag:!1,editionPolicy:"EditionOnOver",getCellSemantics:function(e){return{possibleValues:function(t){let n=e.nodeModel.options.grid.AS_Facet;return i._getPossibleAttributesDisplay(i._currentProfile,n,!0)},allowMultipleValuesFlag:!0,viewOptions:{multipleValuesSeparator:"MatchingRulesDataGridViewId"===t?E.get("RuleAnd"):E.get("RuleOr")}}},getCellClassName:function(e){return e.nodeModel?"MatchingRulesDataGridViewId"!==t||void 0!==e.cellModel&&null!==e.cellModel&&0!==e.cellModel.length?"":"compare-customization-needvalue":"headerClass"}});var l=new c({identifier:t,treeDocument:s,columns:a,placeholder:E.get("MatchingRulesDataGridViewId"===t?"MatchingRulesPlaceholder":"AdditionalStatusesPlaceholder"),defaultColumnDef:{editableFlag:!0},showRowIndexFlag:!1,showSelectionCheckBoxesFlag:!1,showRowHeaderBackgroundFlag:!1,layoutOptions:{rowsHeader:!1,cellHeight:D},showContextualMenuColumnFlag:"MatchingRulesDataGridViewId"===t,showOutlineFlag:!0,columnDragEnabledFlag:!1,showColumnBorderFlag:!0,onContextualEvent:function(e){if("AdditionalStatusesDataGridViewId"!==t){var n=[];if(e.cellInfos&&e.cellInfos.rowID>-1&&e&&e.collectionView){n=e.collectionView.buildDefaultContextualMenu(e,{insertRow:!1,expandCollapse:!1});var o=e.cellInfos.nodeModel,r=o.getNextBrother(),s=o.getPreviousBrother();n.push({type:"PushItem",title:E.get("InsertItemAbove"),fonticon:{content:"wux-ui-3ds wux-ui-3ds-level-up"},action:{callback:function(){console.log("CompareCustomization Insert Row Above this row menu item clicked"),"MatchingRulesDataGridViewId"===t&&i.addMatchingRuleBefore(o)}}}),n.push({type:"PushItem",title:E.get("InsertItemBelow"),fonticon:{content:"wux-ui-3ds wux-ui-3ds-level-down"},action:{callback:function(){console.log("CompareCustomization Insert Row Below this row menu item clicked"),"MatchingRulesDataGridViewId"===t&&i.addMatchingRuleBefore(r)}}}),null!=s&&n.push({type:"PushItem",title:E.get("IncreaseItemPriority"),fonticon:{content:"wux-ui-3ds wux-ui-3ds-up"},action:{callback:function(){console.log("CompareCustomization Increase Priority of this item clicked"),"MatchingRulesDataGridViewId"===t&&i.moveMatchingRuleUp(e.cellInfos.nodeModel)}}}),null!=r&&n.push({type:"PushItem",title:E.get("DecreaseItemPriority"),fonticon:{content:"wux-ui-3ds wux-ui-3ds-down"},action:{callback:function(){console.log("CompareCustomization Decrease Priority of this item clicked"),"MatchingRulesDataGridViewId"===t&&i.moveMatchingRuleDown(e.cellInfos.nodeModel)}}}),n.push({type:"PushItem",title:E.get("RemoveItem"),fonticon:{content:"wux-ui-3ds wux-ui-3ds-remove"},action:{callback:function(){console.log("CompareCustomization Remove this row menu item clicked"),"MatchingRulesDataGridViewId"===t&&i.removeMatchingRule(e.cellInfos.nodeModel)}}})}return n}},getCellTooltip:function(e){let n="MatchingRulesDataGridViewId"===t?i.matchingRulesDGV:i.additionalStatusesDGV;return"MatchingRulesDataGridViewId"===t&&0===e.columnID?{getAllInformationCB:()=>({model:i.matchingRulesOrderTooltipModel})}:n.getCellDefaultTooltip(e)}}).inject(n);"MatchingRulesDataGridViewId"===t?(this.matchingRulesOrderTooltipModel=f.generateTooltip("CompareWidget2/Tooltips","RuleOrderTooltips"),this.matchingRulesTable=n,this.matchingRulesModel=s,this.matchingRulesDGV=l):(this.additionalStatusesTable=n,this.additionalStatusesModel=s,this.additionalStatusesDGV=l)},b.prototype.buildSkeleton_Group_AdditionalStatuses=function(){this.additionalStatusesRow=e.createElement("div",{class:"compare-customization-row"}).inject(this.rulesContent),new o({value:E.get("AdditionalStatusesLabel")}).inject(this.additionalStatusesRow).getContent().addClassName("compare-customization-label"),i.generateIcon({className:"compare-customization-help",iconName:"info",fontIconFamily:WUXManagedFontIcons.Font3DS,tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","AdditionalStatusTooltips")}).inject(this.additionalStatusesRow).classList.remove("wux-ui-3ds-lg"),this.buildSkeleton_RulesTable("AdditionalStatusesDataGridViewId")},b.prototype.buildSkeleton_Footer=function(){this.customizationFooter=e.createElement("div",{id:"compare-customization-footer",html:[]}).inject(this.customizationRoot),this.saveBtn=new n({label:E.get("SaveCustomizationTitle"),domId:"compare-customization-button-save",tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","SaveCustomizationTooltips")}),this.cancelBtn=new n({label:T.ko,domId:"compare-customization-button-cancel",tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","CancelCustomizationTooltips")});let t=(new a).inject(this.customizationFooter);t.addChild(this.saveBtn),t.addChild(this.cancelBtn),t.getContent().setStyles({float:"right"}),this.saveBtn.getContent().addClassName("compare-customization-footerbutton"),this.cancelBtn.getContent().addClassName("compare-customization-footerbutton"),this.saveBtn.getContent().setStyles({"margin-right":"10px","border-radius":"4px"}),this.cancelBtn.getContent().setStyles({"border-radius":"4px"}),this.saveBtn.addEventListener("buttonclick",this.onSaveCustomization.bind(this)),this.cancelBtn.addEventListener("buttonclick",this.onCancelCustomization.bind(this))},b.prototype._getProfileTreeDocument=function(e){let t=this._CCM.getProfileNames({getTemplates:null!=e&&1==e.getTemplates,asTree:!0});var i=new d({shouldBeSelected:function(e){return"section"!==e.options.comboBoxSemantics}});if(void 0!==t.templates&&null!==t.templates&&t.templates.length>0){let e=O("template");for(var n of(i.addRoot(e),t.templates)){let t=new p({label:n,comboBoxSemantics:"leaf"});e.addChild(t)}}if(void 0!==t.adminProfiles&&null!==t.adminProfiles&&t.adminProfiles.length>0){let e=O("admin");for(var n of(i.addRoot(e),t.adminProfiles)){let t=new p({label:n,comboBoxSemantics:"leaf"});e.addChild(t)}}if(void 0!==t.userProfiles&&null!==t.userProfiles&&t.userProfiles.length>0){let e=O("user");for(var n of(i.addRoot(e),t.userProfiles)){let t=new p({label:n,comboBoxSemantics:"leaf"});e.addChild(t)}}return i.expandAll(),i},b.prototype._getDefaultSelection=function(e){e.index=-1,e.label="";let t=-1,i="",n=0,o=this.profilesCombo.elementsTree.getChildren();for(var r of o){let e=r.getChildren();null!=e&&e.length>0&&(n+=e.length,t=e[0]._rowID,i=e[0].options.label)}1===n&&(e.index=t,e.label=i)},b.prototype.initUI=function(e){this._manipulatingProfileFromUI=!1,this.profilesCombo.elementsTree=this._getProfileTreeDocument({getTemplates:!0});let t=null;null!=e&&void 0!==e.profileName&&null!==e.profileName&&""!==e.profileName&&(t=e.profileName),null===t&&void 0!==this._currentProfile&&null!==this._currentProfile&&(t=this._currentProfile.Name);let i=this._CCM.getProfileNames({getTemplates:!0});if((null==t||""===t||!i.includes(t))&&(t="",1===i.length)){let e={};this._getDefaultSelection(e),void 0!==e.label&&null!==e.label&&(t=e.label)}null!=t&&""!==t&&(this.profilesCombo.value=t),this._manipulatingProfileFromUI=!0,this.setProfileIntoSkeleton(null==t?"":t,!1,"ignore")},b.prototype.setProfileIntoSkeleton=function(e,t,i){let n=this,o=!0;return!1===t||n.validateProfileRules(!0,!0)?n._checkChanges(i,"",function(t){if(t.status&&"save"===t.action)n._setProfileRules(),n._saveToDatabase({silent:!1,name:n._currentProfile.Name});else if(t.status&&"discard"===t.action){if(!0===n._currentProfileOrg.NeverBeenSaved){let e=n._currentProfile.Name;n._CCM.removeProfile(e),n.profilesCombo.elementsTree.prepareUpdate();let t=n.profilesCombo.elementsTree.getChildren().find(e=>"userprofiles"===e.options.ccId);if(null!=t){let i=t.getChildren(),o=1===i.length,r=i.find(t=>t.options.label===e);t.removeChild(r),o&&n.profilesCombo.elementsTree.removeRoot(t)}n.profilesCombo.elementsTree.pushUpdate()}n._currentProfile.UseCustomMatchingRules=n._currentProfileOrg.UseCustomMatchingRules}else if(t.status&&"cancel"===t.action)return n._manipulatingProfileFromUI=!1,n.profilesCombo.value=n._currentProfile.Name,n._manipulatingProfileFromUI=!0,o;n._setProfileIntoSkeleton(e)}):o=!1,o},b.prototype.validateProfileRules=function(e,t){let i=!0;if(this._CCM.isCustomizationProfile(this._currentProfile)){let l=["MatchingRulesDataGridViewId","AdditionalStatusesDataGridViewId"];!0===e&&this.removeEmptyMatchingRules();var n=!1,o=!1,r=!1,s=[];for(var a of l){let e="MatchingRulesDataGridViewId"===a?this.matchingRulesModel.getRoots():this.additionalStatusesModel.getRoots();for(let t of e){let e=t.getReferenceValue("MatchingRulesDataGridViewId"===a?"MR_StatusName":"AS_Facet"),i=t.getReferenceValue("MatchingRulesDataGridViewId"===a?"MR_Attribute":"AS_Attribute");("MatchingRulesDataGridViewId"===a||i.length>0)&&(n=!0,""===e||0===i.length?"MatchingRulesDataGridViewId"===a&&(r=!0):s.includes(e)?o=!0:s.push(e))}}if(r&&(console.log("CompareCustomization Profile - Rules did not validate.  A Matching Rule Name or Attribute field is empty."),f.showAlertBox(E.get("EMPTY_PROFILE_RULES_MR"),null,"error"),i=!1),o&&(console.log("CompareCustomization Profile - Duplicate rule name found."),f.showAlertBox(E.get("DUPLICATE_RULE_NAME"),null,"error"),i=!1),t&&!n){console.log("CompareCustomization Profile - No rules have been specified.");let e=E.get(this._currentProfile.AllowCustomMatchingRules?"NO_PROFILE_RULES":"NO_ADDITIONAL_STATUS_RULES").replace("{msgData}",this._currentProfile.Name);f.showAlertBox(e,null,"error"),i=!1}}return i},b.prototype._checkChanges=function(e,t,i){let n={status:!0};if("ignore"===e)i(n);else if(void 0!==this._currentProfile&&null!==this._currentProfile)if(this._CCM.isCustomizationProfile(this._currentProfile))if("force"===e||this._hasProfileChanged())if("force"===e)n.action="save",i(n);else{let e=!0===this._currentProfileOrg.NeverBeenSaved,o="duplicate"===t?e?"SAVE_PROFILE_UNSAVED_DUPLICATE":"SAVE_PROFILE_CHANGES_DUPLICATE":e?"SAVE_PROFILE_UNSAVED":"SAVE_PROFILE_CHANGES";f.confirmDialog2({message:E.get(o).replace("{msgData}",this._currentProfile.Name),title:E.get("CompareProfilePageDialogHeader").replace("{msgData}",this._currentProfile.Name),iconpath:"https://vdevpril3265am.dsone.3ds.com/3DSpace/webapps/IterationsWidget/assets/images/warning.png",okButton:{label:E.get("SaveChanges"),callback:function(){n.action="save",i(n)}},koButton:{label:E.get("duplicate"===t?"CancelOperation":"DiscardChanges"),callback:function(){n.action="duplicate"===t?"cancel":"discard",i(n)}},closeX:{callback:function(){n.action="cancel",i(n)}}})}else i(n);else i(n);else i(n)},b.prototype._hasProfileChanged=function(){if(void 0===this._currentProfile||null===this._currentProfile)return!1;if("template"===this._currentProfile.Type||this._currentProfile.Creator!==this._CCM.getUserName())return!1;let e=!0===this._currentProfileOrg.NeverBeenSaved,t=this._currentProfileOrg.UseCustomMatchingRules!==this._currentProfile.UseCustomMatchingRules,i=!1,n=!1;if(!e||!t){i=!0;let e=this._retrieveProfileRulesFromModel("MatchingRulesDataGridViewId");if(void 0===e||null===e&&void 0===this._currentProfile.MatchingRules||null===this._currentProfile.MatchingRules)i=!1;else if(null!=e&&void 0!==this._currentProfile.MatchingRules&&null!==this._currentProfile.MatchingRules)if(i=!1,e.length===this._currentProfile.MatchingRules.length)for(let t=0;t<e.length;++t){let n=e[t],o=this._currentProfile.MatchingRules[t];if(n.color===o.color&&n.description===o.description&&n.name===o.name&&n.attributes.length===o.attributes.length)for(let e=0;e<n.attributes.length;++e){let t=n.attributes[e],r=o.attributes[e];t.name!==r.name&&(i=!0)}else i=!0}else i=!0;n=!0;let t=this._retrieveProfileRulesFromModel("AdditionalStatusesDataGridViewId");if(void 0===t||null===t&&void 0===this._currentProfile.AdditionalStatuses||null===this._currentProfile.AdditionalStatuses)n=!1;else if(null!=t&&void 0!==this._currentProfile.AdditionalStatuses&&null!==this._currentProfile.AdditionalStatuses)if(n=!1,t.length===this._currentProfile.AdditionalStatuses.length)for(let e=0;e<t.length;++e){let i=t[e],o=this._currentProfile.AdditionalStatuses[e];if(i.color===o.color&&i.description===o.description&&i.facet===o.facet&&i.name===o.name&&i.attributes.length===o.attributes.length)for(let e=0;e<i.attributes.length;++e){let t=i.attributes[e],r=o.attributes[e];t.name!==r.name&&(n=!0)}else n=!0}else n=!0}return e||t||i||n},b.prototype._saveToDatabase=function(e){let t=this._CCM.saveCustomizations();return e.name===this._initialProfileIn&&(this._initialProfileInChanged=!0),!1===t?(console.log("CompareCustomization saving custom profiles - failed"),e.silent||(e.delete?f.showAlertBox(E.get("DELETE_PROFILE_FAILED").replace("{msgData}",e.name),null,"warning"):f.showAlertBox(E.get("SAVE_PROFILES_FAILED").replace("{msgData}",e.name),null,"warning"))):(console.log("CompareCustomization saving custom profiles - success"),e.silent||(e.delete?f.showAlertBox(E.get("DELETE_PROFILE_SUCCESS").replace("{msgData}",e.name),null,"success"):f.showAlertBox(E.get("SAVE_PROFILES_SUCCESS").replace("{msgData}",e.name),null,"success"))),t},b.prototype._setProfileIntoSkeleton=function(e){_.mask(this.customizationRoot.parentElement),this._currentProfile=this._CCM.getProfile(e);let t=!(void 0===this._currentProfile||null===this._currentProfile),i=t&&this._CCM.isTemplateProfile(this._currentProfile);this._currentProfileOrg=null,t&&(this._currentProfileOrg={UseCustomMatchingRules:this._currentProfile.UseCustomMatchingRules});let n=!1;t&&!i&&(n=this._currentProfile.Creator===this._CCM.getUserName());let r=!0;t&&!i&&(r=this._currentProfile.UserOverrideOK),t?this.profilesDuplicate.show():this.profilesDuplicate.hide(),this.saveBtn.disabled=!(t&&!i&&!n),t&&n?this.profilesDelete.show():this.profilesDelete.hide(),t?i?(this.profileInformationLabel.value=E.get("THIS_IS_A_TEMPLATE_PROFILE"),this.profileInformationLabel.show(),this.saveBtn.disabled=!0,this.saveBtn.emphasize="secondary"):this._currentProfile.isAdminUser?this._CCM.getIsAdminUser()?(this.profileInformationLabel.value="",this.profileInformationLabel.hide(),this.saveBtn.disabled=!1,this.saveBtn.emphasize="primary"):(this.profileInformationLabel.value=E.get("THIS_IS_AN_ADMIN_PROFILE"),this.profileInformationLabel.show(),this.saveBtn.disabled=!0,this.saveBtn.emphasize="secondary"):(this.profileInformationLabel.value="",this.profileInformationLabel.hide(),this.saveBtn.disabled=!1,this.saveBtn.emphasize="primary"):(this.profileInformationLabel.value="",this.profileInformationLabel.hide(),this.saveBtn.disabled=!0,this.saveBtn.emphasize="secondary"),this._getObjTypesInfo().then(()=>{var e=[],s=[];if(t){var a=this._currentProfile.Facets;for(var l of a){for(let t of l.ObjectTypes)e.push(this._TypesInfo[t].displayName);if(void 0!==l.Interfaces&&null!==l.Interfaces)for(let e of l.Interfaces)s.push(this._TypesInfo[e].displayName)}}var u=t?this._currentProfile.SelectedTypes:[],c=[];for(var d of(c=null==u?e:u.map(e=>this._TypesInfo[e].displayName),this.typesLabels)){let e=d.getContent();null!=e&&e.remove()}for(var p of(this.typesLabels=[],c)){let e=this._getTypeNameFromDisplayName(p),t=new o({value:p,appearance:"chip",icon:""!==e?this._TypesInfo[e].icon:null}).inject(this.typesRow);t.getContent().getElement(".wux-controls-label-icon").setStyle("color","#77797C"),this.typesLabels.push(t)}for(var h of this.interfacesLabels){let e=h.getContent();null!=e&&e.remove()}for(var f of(this.interfacesLabels=[],s)){let e=this._getTypeNameFromDisplayName(f),t=new o({value:f,appearance:"chip",icon:""!==e?this._TypesInfo[e].icon:null}).inject(this.interfacesRow);t.getContent().getElement(".wux-controls-label-icon").setStyle("color","#77797C"),this.interfacesLabels.push(t)}this._getRolesInfo().then(()=>{let e=t&&void 0!==this._currentProfile.Roles&&null!==this._currentProfile.Roles;var o=e?this._currentProfile.Roles:[],s=[];if(e)for(var a of o)s.push(this._RolesInfo[a].displayName);var l=e?this._currentProfile.SelectedRoles:[];if(null==l?s:l.map(e=>this._RolesInfo[e].displayName),this.matchingRulesModel.removeRoots(),this.additionalStatusesModel.removeRoots(),t&&!0===this._currentProfile.AllowCustomMatchingRules){this.matchingRulesModel.prepareUpdate(),this.rulesRow.show();let e=this._currentProfile.MatchingRules;null!=e&&e.length>0?(this.addMatchingRule(e),this._currentProfile.UseCustomMatchingRules?this.matchingRulesTable.show():this.matchingRulesTable.hide()):this.matchingRulesTable.hide(),this._setMatchingRulesState(i,n,r),this.matchingRulesModel.pushUpdate()}else this.rulesRow.hide(),this.matchingRulesTable.hide();if(t){this.additionalStatusesModel.prepareUpdate(),this.additionalStatusesRow.show(),this.additionalStatusesRow.setStyle("margin-top",!0===this._currentProfile.AllowCustomMatchingRules?"20px":"0px"),this._setAdditionalStatusesState(i,n);let e=this._currentProfile.AdditionalStatuses;null!=e&&e.length>0?(this.addAdditionalStatus(e),this.additionalStatusesTable.show()):i?this.additionalStatusesTable.hide():(this.addAdditionalStatus(this._currentProfile),this.additionalStatusesTable.show()),this.additionalStatusesModel.pushUpdate()}else this.additionalStatusesRow.hide(),this.additionalStatusesTable.hide();_.unmask(this.customizationRoot.parentElement)})})},b.prototype._setMatchingRulesState=function(e,t,i){this.useCustomRulesBtn.disabled=e||!t||!i,this.useDefaultRulesBtn.disabled=e||!t||!i;let n=!0===this._currentProfile.UseCustomMatchingRules?this.useCustomRulesBtn:this.useDefaultRulesBtn;if(n.fireOnlyFromUIInteractionFlag=!0,n.checkFlag=!0,n.fireOnlyFromUIInteractionFlag=!1,e||this.useDefaultRulesBtn.checkFlag)this.matchingRulesAdd.hide();else{for(var o of(this.matchingRulesAdd.show(),this.matchingRulesAdd.disabled=!t||!i,this.matchingRulesDGV.columns))o.editableFlag="MR_Order"!==o.dataIndex&&t&&i;this.matchingRulesDGV.showContextualMenuColumnFlag=t&&i}},b.prototype._setAdditionalStatusesState=function(e,t){if(e);else for(var i of this.additionalStatusesDGV.columns)"AS_Facet"!==i.dataIndex&&(i.editableFlag=t)},b.prototype._setProfileRules=function(){if(this._CCM.isCustomizationProfile(this._currentProfile)){this._currentProfileOrg={UseCustomMatchingRules:this._currentProfile.UseCustomMatchingRules};let t=["MatchingRulesDataGridViewId","AdditionalStatusesDataGridViewId"];for(var e of t){let t=this._retrieveProfileRulesFromModel(e);"MatchingRulesDataGridViewId"===e?this._currentProfile.setMatchingRules(t):this._currentProfile.setAdditionalStatuses(t)}}},b.prototype._retrieveProfileRulesFromModel=function(e){let t=[],i="MatchingRulesDataGridViewId"===e?this.matchingRulesModel.getRoots():this.additionalStatusesModel.getRoots();for(let n of i)if("MatchingRulesDataGridViewId"===e)t.push({name:n.getReferenceValue("MR_StatusName"),attributes:this._getMatchingRuleFromMatchingRuleDisplay(n.getReferenceValue("MR_Attribute")),color:n.getReferenceValue("MR_Color"),description:""});else{let e=n.getReferenceValue("AS_Facet"),i=n.getReferenceValue("AS_Attribute");t.push({facet:n.getReferenceValue("AS_Facet"),name:e,attributes:this._getMatchingRuleFromMatchingRuleDisplay(i),color:n.getReferenceValue("AS_Color"),description:""})}return t},b.prototype.onProfileSelected=function(){if(this._manipulatingProfileFromUI){let e=this.profilesCombo.currentLabel;console.log("CompareCustomization Profile was selected: "+e),this.setProfileIntoSkeleton(e,!0,"user")||(this._manipulatingProfileFromUI=!1,this.profilesCombo.value=this._currentProfile.Name,this._manipulatingProfileFromUI=!0)}},b.prototype.onDuplicateProfile=function(){let e=this,t=this.profilesCombo.currentLabel;console.log("CompareCustomization Duplicate Profile button was clicked: "+t),e.validateProfileRules(!0,!0)&&e._checkChanges("user","duplicate",function(i){let n=t;if(i.status&&"save"===i.action)e._setProfileRules(),e._saveToDatabase({silent:!1,name:n});else if(i.status&&"cancel"===i.action)return;let o=e.profilesCombo.elementsTree.getAllDescendants(),r={dialogTitle:E.get("DuplicateProfileTitle"),okLabel:E.get("DuplicateProfileOkayButton"),cancelLabel:E.get("DuplicateProfileCancelButton"),existingNames:o.map(e=>e.options.label)};e._profileNameDlg=new S(r,t=>{e._CCM.duplicateProfile(n,t);e.profilesCombo.elementsTree.prepareUpdate();let i=new p({label:t,comboBoxSemantics:"leaf"}),o=e._CCM.getIsAdminUser()?"adminprofiles":"userprofiles",r=e.profilesCombo.elementsTree.getChildren().find(e=>e.options.ccId===o);null==r&&(r=O("adminprofiles"===o?"admin":"user"),e.profilesCombo.elementsTree.addRoot(r)),r.addChild(i),e.profilesCombo.elementsTree.expandAll(),e.profilesCombo.elementsTree.pushUpdate(),e._profileNameDlg=null,e.profilesCombo.value=t,e._currentProfileOrg.NeverBeenSaved=!0})})},b.prototype.onDeleteProfile=function(){var e=this;let t=this.profilesCombo.currentLabel;console.log("CompareCustomization Delete Profile button was clicked: "+t),f.confirmDialog2({message:E.get("CONFIRM_DELETE_PROFILE").replace("{msgData}",t),title:E.get("CompareProfilePageDialogHeader").replace("{msgData}",t),iconpath:"https://vdevpril3265am.dsone.3ds.com/3DSpace/webapps/IterationsWidget/assets/images/warning.png",okButton:{label:E.get("DELETE_PROFILE_OK"),callback:function(){let i=e._CCM.getProfileNames({getTemplates:!1});e._CCM.removeProfile(t),e.profilesCombo.elementsTree.prepareUpdate();let n=e._CCM.getIsAdminUser()?"adminprofiles":"userprofiles",o=e.profilesCombo.elementsTree.getChildren().find(e=>e.options.ccId===n);if(null!=o){let i=o.getChildren(),n=1===i.length,r=i.find(e=>e.options.label===t);o.removeChild(r),n&&e.profilesCombo.elementsTree.removeRoot(o)}e.profilesCombo.elementsTree.pushUpdate(),i.includes(t)?e._saveToDatabase({silent:!1,delete:!0,name:t}):f.showAlertBox(E.get("DELETE_PROFILE_SUCCESS").replace("{msgData}",t),null,"success"),e._resetCurrentUI()}},koButton:{label:T.ko,callback:function(){}}})},b.prototype._resetCurrentUI=function(){this._manipulatingProfileFromUI=!1;let e="",t={};this._getDefaultSelection(t),null!=t.index&&(this.profilesCombo.selectedIndex=t.index,e=t.label),this._manipulatingProfileFromUI=!0,this.setProfileIntoSkeleton(e,!1,"ignore")},b.prototype.onChangeUseDefaultCustomMatchingRules=function(e){var t="1"===e.dsModel.value.toString();let i=!0;t||(i=this.validateProfileRules(!0,!1)),i?(this._currentProfile&&(this._currentProfile.UseCustomMatchingRules=t),t?this.matchingRulesAdd.show():this.matchingRulesAdd.hide(),t?this.matchingRulesTable.show():this.matchingRulesTable.hide(),t&&this._currentProfile&&0===this.matchingRulesModel.getChildren().length&&this.addMatchingRule()):this.useCustomRulesBtn.checkFlag=!0},b.prototype.onAddMatchingRule=function(){let e=this.profilesCombo.currentLabel;console.log("CompareCustomization Add Matching Rule button was clicked: "+e),this.addMatchingRule(),this.useCustomRulesBtn.checkFlag=!0},b.prototype.addMatchingRule=function(e){var t;if(Array.isArray(e))for(var i of(t=[],e)){let e=new p({grid:{MR_Order:-1,MR_StatusName:i.name,MR_Attribute:this._getMatchingRuleDisplayFromMatchingRule(i.attributes,!1),MR_Color:i.color}});t.push(e)}else t=new p({grid:{MR_Order:-1,MR_StatusName:e&&e.name?e.name:"",MR_Attribute:e&&e.attributes?this._getMatchingRuleDisplayFromMatchingRule(e.attributes,!1):[],MR_Color:e&&e.color?e.color:this._getNextColor("matching_rule")}});let n=I(t,this.matchingRulesModel,!0);R(n,this.matchingRulesTable),1===n&&!0===this._currentProfile.UseCustomMatchingRules&&this.matchingRulesTable.show()},b.prototype.addMatchingRuleBefore=function(e){R(function(e,t,i,n){return i.prepareUpdate(),i.insertBefore(e,t),!0===n&&v(i),i.pushUpdate(),i.getChildren().length}(new p({grid:{MR_Order:-1,MR_StatusName:"",MR_Attribute:[],MR_Color:this._getNextColor("matching_rule")}}),e,this.matchingRulesModel,!0),this.matchingRulesTable)},b.prototype.moveMatchingRuleUp=function(e){!function(e,t,i){t.prepareUpdate();let n=e.getPreviousBrother();if(null!=n){let i=t.removeRoot(e);t.insertBefore(i,n)}!0===i&&v(t),t.pushUpdate()}(e,this.matchingRulesModel,!0)},b.prototype.moveMatchingRuleDown=function(e){!function(e,t,i){t.prepareUpdate();let n=e.getNextBrother();if(null!=n){let i=t.removeRoot(e),o=n.getNextBrother();null!=o?t.insertBefore(i,o):t.addRoot(i)}!0===i&&v(t),t.pushUpdate()}(e,this.matchingRulesModel,!0)},b.prototype.removeMatchingRule=function(e){let t=function(e,t,i){return t.prepareUpdate(),t.removeRoot(e),!0===i&&v(t),t.pushUpdate(),t.getChildren().length}(e,this.matchingRulesModel,!0);R(t,this.matchingRulesTable),0===t&&(this.useDefaultRulesBtn.checkFlag=!0)},b.prototype.removeEmptyMatchingRules=function(){if(this._CCM.isCustomizationProfile(this._currentProfile)){let t=this.matchingRulesModel.getRoots();for(var e=t.length-1;e>=0;--e){let i=t[e],n=i.getReferenceValue("MR_StatusName"),o=this._getMatchingRuleFromMatchingRuleDisplay(i.getReferenceValue("MR_Attribute"));""!==n||null!=o&&0!==o.length||this.removeMatchingRule(i)}}},b.prototype._getPossibleAttributesDisplay=function(e,t,i){let n=[],o=e.SelectedTypes.map(e=>({name:e,grouping:-1})),r=[];void 0!==e.Interfaces&&null!==e.Interfaces&&(r=e.Interfaces.map(e=>({name:e,grouping:-1})));let s=o.concat(r);for(var a of s)for(var l=0;l<e.Facets.length;++l){let t=e.Facets[l];for(let e=0;e<t.ObjectTypes.length;++e)a.name===t.ObjectTypes[e]&&(a.grouping=l);if(void 0!==t.Interfaces&&null!==t.Interfaces)for(let e=0;e<t.Interfaces.length;++e)a.name===t.Interfaces[e]&&(a.grouping=l)}for(var u=[],c=0,d=0;d<e.Facets.length;++d){let i=this._CCM.getFacetNameNLS(e.NLSPath,e.Facets[d].Name);if(null==t||t===i){u[c]=[];for(var p=0;p<s.length;++p)s[p].grouping===d&&u[c].push(s[p].name);++c}}for(var h of u){let e=[];for(var _ of h){var f=this._TypesInfo[_].displayName,g=this._TypesInfo[_].icon;for(var m of this._TypesInfo[_].attributes){let t=e.findIndex(e=>e.value.attrName===m.uri);if(-1!==t){if(-1===e[t].value.objType.findIndex(e=>e===_)){e[t].value.objType.push(_);{let i=e[t].value.label.replace(")",","+f+")");e[t].value.label=i}}else console.log("CompareCustomization - Multiple attributes with same name in object type")}else{let t={value:{icon:g,attrName:m.uri,objType:[_]}};t.value.label=m.nlsName,i&&(t.value.label+=" ("+f+")"),e.push(t)}}}for(var a of e)n.push(a)}return n},b.prototype._getMatchingRuleDisplayFromMatchingRule=function(e,t,i){let n=[];for(let t of e){let e=t.objType,o=this._TypesInfo[e[0]].attributes.findIndex(e=>e.uri===t.name),r=-1===o?t.name:this._TypesInfo[e[0]].attributes[o].nlsName,s=this._TypesInfo[e[0]].icon,a=t.objType.map(e=>this._TypesInfo[e].displayName).join(","),l={icon:s,attrName:t.name,objType:t.objType};l.label=r,i&&(l.label+=" ("+a+")"),n.push(l)}return n},b.prototype._getMatchingRuleFromMatchingRuleDisplay=function(e){return e.map(e=>({objType:e.objType,name:e.attrName,icon:e.icon}))},b.prototype._getTypeNameFromDisplayName=function(e){let t="";for(const[i,n]of Object.entries(this._TypesInfo))if(n.displayName===e){t=i;break}return t},b.prototype.addAdditionalStatus=function(e){var t;if(Array.isArray(e))for(var i of(t=[],e)){let e=i.facet,n=new p({grid:{AS_Facet:e,AS_Attribute:this._getMatchingRuleDisplayFromMatchingRule(i.attributes,!1),AS_Color:i.color}});t.push(n)}else if("object"==typeof e){t=[];let i=[];for(var n=0;n<e.Facets.length;++n){let o=this._getNextColor("additional_status",i);i.push(o);let r=this._CCM.getFacetNameNLS(this._currentProfile.NLSPath,e.Facets[n].Name),s=new p({grid:{AS_Facet:r,AS_Attribute:[],AS_Color:o}});t.push(s)}}else{let i="";e&&e.facet&&(i=e.facet),t=new p({grid:{AS_Facet:i,AS_Attribute:e&&e.attributes?this._getMatchingRuleDisplayFromMatchingRule(e.attributes,!1):[],AS_Color:e&&e.color?e.color:this._getNextColor("additional_status")}})}let o=I(t,this.additionalStatusesModel);R(o,this.additionalStatusesTable),1===o&&this.additionalStatusesTable.show()},b.prototype._getNextColor=function(e,t){t=t||[];let i=this.matchingRulesModel.getRoots().map(e=>e.getReferenceValue("MR_Color")),n=this.additionalStatusesModel.getRoots().map(e=>e.getReferenceValue("AS_Color")),o=[m.colorDef.BLUE1,m.colorDef.ORANGE,m.colorDef.BEIGE,m.colorDef.BLUE2],r="additional_status"===e?[m.colorDef.VIOLET,m.colorDef.GREEN2,m.colorDef.RED,m.colorDef.PINK,m.colorDef.YELLOW]:[],s=t.concat(i,n,o,r);return m.colorSeq.find(e=>!s.includes(e))||m.colorDef.BLACK},b.prototype._getObjTypesInfo=function(){var e=this;return new Promise(function(t,i){var n=!(void 0===e._currentProfile||null===e._currentProfile)?e._currentProfile.Facets:[];if(0===n.length)t();else{let o=[];for(let e of n){for(let t of e.ObjectTypes)o.push(t);if(null!==e.Interfaces&&void 0!==e.Interfaces)for(let t of e.Interfaces)o.push(t)}let r={"ds6w:type":o};g.makeAuthHttpsCall("/resources/6WVocab/access/PredicateValue","POST",r,"json",e._CCM.getTenant(),"3DSpace",e._CCM.getSecurityContext(),!0).then(function(i){for(const[t,n]of Object.entries(i["ds6w:type"]))void 0!==e._TypesInfo[t]&&null!=e._TypesInfo[t]||(e._TypesInfo[t]={displayName:n,icon:void 0,attributes:[]});var o=[e._getFacetIcon(n),e._getFacetAttrs(n)];Promise.allSettled(o).then(e=>{for(var i=0,n=e.length;i<n;i++)"rejected"===e[i].status&&(0===i?console.log("CompareCustomization: Failed to retrieve icons for specified object types"):1==i?console.log("CompareCustomization: Failed to retrieve attribute names for specified object types"):console.log("CompareCustomization: Failed to retrieve interfaces for specified object types"));t()})},function(e){console.log("CompareCustomization: Failed to retrieve object type display names: "+e),i()})}})},b.prototype._getFacetIcon=function(e){var t=this;return new Promise(function(i,n){let o=[];function r(e){return"VPM"===e.substr(0,3)&&"Instance"===e.substr(e.length-8)?"flow-cascade":"VPM"===e.substr(0,3)&&"Reference"===e.substr(e.length-9)?"product":""}for(var s of e){for(var a of s.ObjectTypes)void 0!==s.Icon&&null!==s.Icon&&""!==s.Icon?t._TypesInfo[a].icon=s.Icon:t._TypesInfo[a].icon=r(a),void 0!==t._TypesInfo[a].icon&&null!==t._TypesInfo[a].icon&&""!==t._TypesInfo[a].icon||o.push(a);if(void 0!==s.Interfaces&&null!==s.Interfaces)for(var l of s.Interfaces)void 0!==s.Icon&&null!==s.Icon&&""!==s.Icon?t._TypesInfo[l].icon=s.Icon:t._TypesInfo[l].icon=r(l),void 0!==t._TypesInfo[l].icon&&null!==t._TypesInfo[l].icon&&""!==t._TypesInfo[l].icon||o.push(l)}o.length>0?g.makeAuthHttpsCall("/resources/dictionary/getTypeInfo","POST",o,"json",t._CCM.getTenant(),"3DSpace",t._CCM.getSecurityContext(),!0,!1).then(function(e){console.log("CompareCustomization._getObjTypesIcon: OK retrieving object type icon information: "),i()},function(e){console.log("CompareCustomization._getObjTypesIcon: KO retrieving object type icon information: "),i()}):i()})},b.prototype._getFacetAttrs=function(e){var t=this;return new Promise(function(i,n){var o=[];for(let i of e){for(let e of i.ObjectTypes)0===t._TypesInfo[e].attributes.length&&o.push("ds6wg:"+e);if(void 0!==i.Interfaces&&null!==i.Interfaces)for(var r of i.Interfaces)0===t._TypesInfo[r].attributes.length&&o.push("ds6wg:"+r)}if(0===o.length)i();else{let e=o.join("\n");g.makeAuthHttpsCall("/resources/6WVocab/access/Predicates","POST",e,"json",t._CCM.getTenant(),"3DSpace",t._CCM.getSecurityContext(),!0,!0).then(function(e){for(var n of(console.log("CompareCustomization._getObjTypesAttrs: OK retrieving attributes for "+e.classPredicates.length+" object types"),e.classPredicates)){var o=n.className.slice(6);t._TypesInfo[o].displayName;if(void 0!==t._TypesInfo[o]&&null!==t._TypesInfo[o]||(t._TypesInfo[o]={attributes:[]}),0===t._TypesInfo[o].attributes.length)for(var r of n.vocabularyPredicateInfo)t._TypesInfo[o].attributes.push({name:r.name,uri:r.uri,nlsName:r.nlsName})}i()},function(e){console.log("CompareCustomization._getObjTypesAttrs: KO retrieving object type attributes: "+e),n()})}})},b.prototype._getRolesInfo=function(){var e=this;return new Promise(function(t,i){var n=[];if(void 0!==e._currentProfile&&null!==e._currentProfile&&void 0!==e._currentProfile.Roles&&null!==e._currentProfile.Roles&&(n=e._currentProfile.Roles),0===n.length)e._RolesInfo={},t();else{for(var o of n)e._RolesInfo[o]={displayName:o.toLowerCase()};t()}})},b.prototype.onSaveCustomization=function(){var e=this;console.log("CompareCustomization Save button was clicked"),this.validateProfileRules(!0,!0)&&e._checkChanges("force","",function(t){t.status&&"save"===t.action&&(e._setProfileRules(),e._saveToDatabase({silent:!1,name:e._currentProfile.Name})),e._doClose({status:!0})})},b.prototype.onCancelCustomization=function(){console.log("CompareCustomization Cancel button was clicked"),void 0!==this._currentProfileOrg&&null!==this._currentProfileOrg&&!0===this._currentProfileOrg.NeverBeenSaved&&this._CCM.removeProfile(this._currentProfile.Name),this._doClose({status:!0})},b.prototype._doClose=function(e){this._resetCurrentUI(),this._TypesInfo={},this._RolesInfo={},""!==!this._initialProfileIn&&(e.inProfileChanged=this._initialProfileInChanged),this.doneCB(e)},b.prototype.reset=function(){this._resetCurrentUI(),this.initModel()},b}),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/cvProgressiveExpand",["UWA/Core","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter"],function(e,t,i){var n={format:"entity_relation_occurrence",hits:{predefined_computation:["boundingbox","cgr","thumbnail_3d","icons"]},select_object:["physicalid","ds6w:type","ds6w:globaltype","ds6wg:revision","ds6w:label","ds6wg:XCADOrientationExt.V_WorldOrientation"],select_relation:["physicalid","ds6w:type","ro.plminstance.v_treeorder","ro.plminstance.plm_externalid"]},o={format:n.format,hits:n.hits,select_object:[...n.select_object,"relcount","bo.plmentity.plm_externalid","ds6w:reserved","ds6w:description","ds6w:modified","ds6w:created","ds6w:responsible","ds6w:policy","ds6w:organizationResponsible","ds6w:project","ds6w:reservedBy","ds6w:identifier","bo.plmreference.v_derivedfrom"],select_relation:[...n.select_relation,"Matrixtxt"]};function r(e,i,r,s){var a=null!=s&&0!=s.length,l=a?n:o,u={batch:{expands:[{label:"TBD_LABEL",root:{physical_id:e},filter:{all:1},aggregation_processors:[]}]},outputs:t.dupeJson(l)};return a&&(u=function(e,t){return Object.keys(t).forEach(function(i){var n=t[i],o=n.indexOf(".");if(-1==o)e.select_bo.push(n);else{var r=n.substr(0,o),s=n.substr(o+1);if("REF"==r)"dfr"==s&&(s="bo.plmreference.v_derivedfrom"),-1==e.outputs.select_object.indexOf(s)&&e.outputs.select_object.push(s);else{if("INST"!=r)throw new Error("UNKNOWN specifier in PROPS definition");"matrixtxt"==s&&(s="Matrixtxt"),-1==e.outputs.select_relation.indexOf(s)&&e.outputs.select_relation.push(s)}}}),e}(u,s)),u}function s(t,n,o,s,a){return new Promise(function(o,l){var u="/cvservlet/progressiveexpand/v2";s.dbgout("------------[ T R E E   E X P A N S I O N    B E G I N ] -----------"),s.dbgout("cvExpand on id: "+t.getPhysID()+"\n on service   : "+t.getServiceName()+"\n with expand type: cvProgressiveExpand\n with URL     : "+u);(function(t,i,n,o){return new Promise(function(i,n){var s=r(t.getPhysID(),0,0,o.CV_PROPS),a=t.getExternalFilterSpec();null!=a&&(s=function(e,t){return null!=t.CVQueryV2.filter?e.batch.expands[0].filter=t.CVQueryV2.filter:e.batch=t.CVQueryV2.batch,e}(s,a)),null!=o.PROGRESSIVE_EXPAND_OPTIONS&&e.extend(s.batch.expands[0],o.PROGRESSIVE_EXPAND_OPTIONS),i(s)})})(t,0,0,a).then(function(e){var r=e;i.makeAuthHttpsCall(u,"POST",r,"text/plain",t.getTenant(),t.getServiceName(),t.getSecurityContext(),!1,!1,"output_format=cvjson").then(function(e){var t=e;"string"==typeof t&&(t=t.replace("{}",""),t=JSON.parse(t)),null!=t.errors&&0!=t.errors.length?l(t.errors):((t=t.results)._dataSource=n,s.dbgout("------------[ T R E E   E X P A N S I O N    E N D    ] -----------"),o(t))},function(e){l(e)})},function(e){l(e)})})}return{jsClass:"CV_PROGRESSIVE_EXPAND",doExpand:function(e,t,i,n,o){return s(e,t,0,n,o)}}}),define("DS/CompareWidget2/support/objIDSpec",["DS/CompareWidget2/support/cw2Utils"],function(e){var t=function(t,i,n,o,r,s,a,l,u,c,d){this._physID=t?e.dupeJson(t):null,this._objType=i?e.dupeJson(i):null,this._securityContext=n?e.dupeJson(n):null,this._tenant=o?e.dupeJson(o):e.getCurrentTenant(),this._serviceName=r?e.dupeJson(r):"3DSpace",this._externalFilterSpec=s?e.dupeJson(s):null,this._idType=a?e.dupeJson(a):"modelID",this._commands=l?e.dupeJson(l):null,void 0!==u&&(this._supportsRevisions=!1!==u),void 0!==c&&(this._supportsFilters=!1!==c),this._interfaces=d||[],this._reqModforODT="DS/CompareWidget2/support/objIDSpec"};return t.prototype.destroy=function(){delete this._physID,delete this._objType,delete this._securityContext,delete this._tenant,delete this._serviceName,delete this._externalFilterSpec,delete this._idType,delete this._commands,delete this._supportsRevisions,delete this._supportsFilters,delete this._interfaces},t.prototype.makeDupe=function(){return new t(this._physID,this._objType,this._securityContext,this._tenant,this._serviceName,this._externalFilterSpec,this._idType,this._commands,this._supportsRevisions,this._supportsFilters,this._interfaces)},t.prototype.getUniqueID=function(){var e="NO_FILTER";null!=this._externalFilterSpec&&(e=this._externalFilterSpec.filterTitle);var t="NO_COMMANDS";return null!=this._commands&&(t=this._commands),this.getPhysID()+"-"+this.getObjType()+"-"+this.getSecurityContext()+"-"+this.getTenant()+"-"+this.getServiceName()+"-"+e+"-"+t+"-"+this.getInterfacesString()},t.prototype.isEqual=function(e){return this.getUniqueID()==e.getUniqueID()},t.prototype.getPhysID=function(){return this._physID},t.prototype.getObjType=function(){return this._objType},t.prototype.getSecurityContext=function(){return this._securityContext},t.prototype.getTenant=function(){return this._tenant},t.prototype.getServiceName=function(){return this._serviceName},t.prototype.getExternalFilterSpec=function(){return this._externalFilterSpec},t.prototype.getIDType=function(){return this._idType},t.prototype.getCommands=function(){return this._commands},t.prototype.hasCommands=function(){var e=!1;return null!=this._commands&&this._commands.constructor==Array&&this.commands.length>0&&(e=!0),e},t.prototype.isFiltered=function(){return null!=this._externalFilterSpec||"ENOStrRefinementSpecification"==this._objType},t.prototype.getSvcType=function(){return this._serviceName+"."+this._objType},t.prototype.getTenantSvcType=function(){return this._tenant+"."+this.getSvcType()},t.prototype.getInterfaces=function(){return this._interfaces},t.prototype.getInterfacesString=function(){return Array.isArray(this._interfaces)?this._interfaces.join("|"):""},t}),define("DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_tree",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/objIDSpec","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_node"],function(e,t,i){var n=function(e){this._objIDSpec=e,this._rootRefInstNode=null,this._pathArray=[],this._dataSource="UNKNOWN",this._editsApplied=!1,this._reqModforODT="DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_tree"};return n.prototype.getEditCommands=function(){var e=null;return null!=this._objIDSpec&&(e=this._objIDSpec.getCommands()),e},n.prototype.get_editsHaveBeenApplied=function(){return this._editsApplied},n.prototype.set_editsHaveBeenApplied=function(){this._editsApplied=!0},n.prototype.getObjIDSpec=function(){return this._objIDSpec},n.prototype.setDataSource=function(e){null!=e&&0!=e.length&&(this._dataSource=e)},n.prototype.setRoot=function(e){this._rootRefInstNode=e},n.prototype.getRoot=function(){return this._rootRefInstNode},n.prototype.setPathArray=function(e){this._pathArray=e},n.prototype.getPathArray=function(){return this._pathArray},n.prototype.sortChildren=function(){this.visit_riTreeAndFN(function(e){e.sortChildArray()})},n.prototype.findNodeByPhysIDPath=function(e){var t=e.split("/");if(this._rootRefInstNode.get_dbObj_REF().getAttr("REF.physicalid")!=t[0]);else for(var i=this._rootRefInstNode,n=t.length,o=1;o<n;o+=2){var r=t[o],s=t[o+1];if(null==(i=i.findChild(r,s)))break}return i},n.prototype.visit_riTreeAndFN=function(t){return null==this._rootRefInstNode?e.errout("'visit_riTreeAndFN()' called, but tree has no root"):this._rootRefInstNode.visit_subtreeAndFN(t),!0},n}),define("DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair",["DS/CompareWidget2/support/cw2Utils"],function(e){var t=function(e,t,i,n,o){this._relName=e,this._adjFlagArray=t||[],null!=o&&o.length>0&&(this._instFlagNdxs=o),this._bubbledStatusArray_static=[],this._bubbledStatusArray_dynamic=[],this._baseNode=i,this._compNode=n,this._depth="",this._level=-1,this._isHidden_byStatusFilter=!1,this._isHidden_byTypeAttr=!1,this._showHideNodeByTypeAndAttrParam=NaN,this._treeNodeArray=[],this._reqModforODT="DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair"};return t.prototype.getRelName=function(){return this._relName},t.prototype.resetRelName=function(e){this._relName=e},t.prototype.getAdjFlagArray=function(){return this._adjFlagArray},t.prototype.getInstFlagNdxs=function(){return this._instFlagNdxs},t.prototype.getBaseNode=function(){return this._baseNode},t.prototype.getCompNode=function(){return this._compNode},t.prototype.resetBaseNode=function(e){this._baseNode=e},t.prototype.resetCompNode=function(e){this._compNode=e},t.prototype.isBaseDummy=function(){return this._baseNode.isDummy()},t.prototype.isCompDummy=function(){return this._baseNode.isDummy()},t.prototype.getOtherNode=function(e){return this._baseNode===e?this._compNode:this._baseNode},t.prototype.qtyIsDiff=function(){return this.qtyIsDiffFlag},t.prototype.setDepth=function(e){this._depth=e},t.prototype.getDepth=function(){return this._depth},t.prototype.setLevel=function(e){this._level=e},t.prototype.getLevel=function(){return this._level},t.prototype.setIsHidden_byStatusFilter=function(e){this._isHidden_byStatusFilter=e},t.prototype.setIsHidden_byTypeAttr=function(e){this._isHidden_byTypeAttr=e},t.prototype.getIsHidden_byStatusFilter=function(){return this._isHidden_byStatusFilter},t.prototype.getIsHidden_byTypeAttr=function(){return this._isHidden_byTypeAttr},t.prototype.getIsHidden_byAnyFilter=function(){return this._isHidden_byTypeAttr||this._isHidden_byStatusFilter},t.prototype.setShowHideNodeByTypeAndAttrParamIndex=function(e){this._showHideNodeByTypeAndAttrParam=e},t.prototype.getShowHideNodeByTypeAndAttrParamIndex=function(){return this._showHideNodeByTypeAndAttrParam},t.prototype.addTreeNode=function(e){this._treeNodeArray.push(e)},t.prototype.getTreeNodes=function(){return this._treeNodeArray},t.prototype.addBubbledStatus=function(e,t){var i=this.hasStatus(e);if(null==i)t?this._bubbledStatusArray_dynamic.push(e):this._bubbledStatusArray_static.push(e);else if("DYNAMIC"==i&&0==t){this._bubbledStatusArray_static.push(e);var n=this._bubbledStatusArray_dynamic.indexOf(e);this._bubbledStatusArray_dynamic.splice(n,1)}},t.prototype.getAllStatusArray=function(e){var t=[];return t=null!=this._bubbledStatusArray_static?[this._relName,...this._adjFlagArray,...this._bubbledStatusArray_static]:[this._relName,...this._adjFlagArray],this.qtyIsDiffFlag&&t.push("QUANTITY"),1==e&&this._bubbledStatusArray_dynamic.length>0&&(t=[...t,...this._bubbledStatusArray_dynamic]),t},t.prototype.hasStatus=function(e){var t=null;return this._relName==e?t="PRIMARY":this._adjFlagArray.includes(e)?t="SECONDARY":this._bubbledStatusArray_static.includes(e)?t="STATIC":this._bubbledStatusArray_dynamic.includes(e)&&(t="DYNAMIC"),t},t.prototype.shallowDupe=function(){var e=this._relName.repeat(1),i=null==this._adjFlagArray?[]:JSON.parse(JSON.stringify(this._adjFlagArray)),n=null;null!=this._instFlagNdxs&&this._instFlagNdxs.length>0&&(n=JSON.parse(JSON.stringify(this._instFlagNdxs)));var o=this._baseNode.shallowDupe(),r=this._compNode.shallowDupe(),s=new t(e,i,o,r,n);return s._isHidden_byStatusFilter=this._isHidden_byStatusFilter,s._isHidden_byTypeAttr=this._isHidden_byTypeAttr,o.setMatchInfo(s),r.setMatchInfo(s),s},t.prototype.isAttributeValueEqual=function(e){return this.getBaseNode().getAttr(e)===this.getCompNode().getAttr(e)},t}),define("DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode",["UWA/Core","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/objIDSpec"],function(e,t,i){function n(e){var i=!1;return e instanceof o?e==this?t.errout("Cannot attach an CRNode to itself... ignoring"):i=!0:t.errout("CRNode.validateCRNodeToAdd:Cannot attach an object that is not a CRNode... ignored"),i}var o=function(e,t,i,n,o,r,s,a,l,u,c,d){if(this._attrList={},this._childArray=[],this._parent=null,this._matchInfo=null,this._dbContext={},this._path=null,this._objIDSpecREF=null,this._objIDSpecINST=null,this._expandCollapseState="expanded",this._isVisible=!0,this._externalFilterName=null,this._attrList={name:e,title:t,type:i,physicalID_REF:o,physicalID_INST:n,revision:r,displayOrder:s,typeIconSmallURL:a,typeIconLargeURL:l,thumbnail_3d:u},this._customRuleAttrs={},null!=d){const e=(e,t)=>void 0===t?null:t;this._customRuleAttrs=JSON.parse(JSON.stringify(d,e))}this._riNode=c,this._reqModforODT="DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode"};return o.prototype.sortChildren=function(){var e=this._childArray.sort(function(e,t){return e.getAttr("displayOrder")-t.getAttr("displayOrder")});this._childArray=e},o.prototype.getRefInstNode=function(){return this._riNode},o.prototype.isDummy=function(){return null==this._attrList.physicalID_REF},o.prototype.setDBContext=function(e){this._dbContext=e},o.prototype.hasExternalFilter=function(){return null!=this._externalFilterName},o.prototype.getExternalFilterName=function(){return this._externalFilterName},o.prototype.setExternalFilterName=function(e){this._externalFilterName=e},o.prototype.getObjIDSpec_REF=function(){return null==this._objIDSpecREF&&void 0!==this._attrList.physicalID_REF&&null!==this._attrList.physicalID_REF&&(this._objIDSpecREF=new i(this._attrList.physicalID_REF,this._attrList.type,this._dbContext.securityContext,this._dbContext.tenant,this._dbContext.serviceName)),this._objIDSpecREF},o.prototype.getObjIDSpec_INST=function(){return null==this._objIDSpecINST&&null!=this._attrList.physicalID_INST&&(this._objIDSpecINST=new i(this._attrList.physicalID_INST,this._attrList.type,this._dbContext.securityContext,this._dbContext.tenant,this._dbContext.serviceName)),this._objIDSpecINST},o.prototype.getDBContext=function(){return this._dbContext},o.prototype.getTitle=function(){return this._attrList.title},o.prototype.getType=function(){return this._attrList.type},o.prototype.getCustomRuleAttrs=function(){return this._customRuleAttrs},o.prototype.addAttr=function(e,t){this._attrList[e]=t},o.prototype.addOrSetCustAttr=function(e,t){this._customRuleAttrs[e]=t},o.prototype.getAttr=function(e){let t=void 0;return null==(t=this._attrList[e])&&(e.indexOf("REF.")>=0||e.indexOf("INST.")>=0)&&this._riNode&&(t=this._riNode.getAttr(e)),null==t&&null!=this._customRuleAttrs&&(t=this._customRuleAttrs[e]),t},o.prototype.addChild=function(e){n(e)&&this._childArray.push(e)},o.prototype.getChildArray=function(){return this._childArray},o.prototype.findChildByID=function(e,t){for(var i=this._childArray.length,n=null,o=0;o<i;o++){var r=this._childArray[o],s=r.getAttr("physicalID_INST"),a=r.getAttr("physicalID_REF");if(e==s&&t==a){n=r;break}}return n},o.prototype.getPath=function(){if(null==this._path){for(var e=[],t=this;null!=t&&"object"==typeof t;){var i=t.getAttr("physicalID_INST"),n=t.getAttr("physicalID_REF");if(null==n)break;e.unshift(n),null!=i&&""!==i&&e.unshift(i),t=t.getParent()}this._path=e.join("/")}return this._path},o.prototype.setParent=function(e){n(e)&&(null!=this._parent&&t.errout("CRNode's parent is being reassigned (this is unexpected)."),this._parent=e)},o.prototype.getParent=function(){return this._parent},o.prototype.setMatchInfo=function(e){this._matchInfo=e},o.prototype.isRoot=function(){return null==this._parent},o.prototype.isHeaderRow=function(){return"relations"==this._attrList.type},o.prototype.isBlank=function(){return null==this._attrList.type},o.prototype.isDraggable=function(){return!(this.isBlank()||this.isHeaderRow())},o.prototype.getMatchInfo=function(){return this._matchInfo},o.prototype.destroy=function(){this._parent=null,this._matchInfo="",this._attrList=null;for(var e=0;e<this._childArray.length;e++)null!=this._childArray[e]&&(this._childArray[e].destroy(),this._childArray[e]=null)},o.prototype.shallowDupe=function(){let t=new o(this._attrList.name,this._attrList.title,this._attrList.type,this._attrList.physicalID_INST,this._attrList.physicalID_REF,this._attrList.revision,this._attrList.displayOrder,this._attrList.typeIconSmallURL,this._attrList.typeIconLargeURL,this._attrList.thumbnail_3d,this._riNode,this._customRuleAttrs);t.setDBContext(e.clone(this.getDBContext()));var i=this.getExternalFilterName();return t.setExternalFilterName(i),t},o.prototype.getExpandCollapseState=function(){return Array.isArray(this._childArray)&&this._childArray.length?this._expandCollapseState||"expanded":"noExpandState"},o.prototype.setExpandCollapseState=function(e){this._expandCollapseState=e},o.prototype.visitVisible_nodesAndFN=function(e){return this.visit_nodesAndFN(!0,e)},o.prototype.visitAll_nodesAndFN=function(e){return this.visit_nodesAndFN(!1,e)},o.prototype.removeChild=function(e){for(var t=0;t<this._childArray.length;t++){if(this._childArray[t]===e){this._childArray.splice(t,1);break}}},o.prototype.visit_nodesAndFN=function(e,i){var n=!1;if(1==e&&1==this._isVisible||0==e)try{var o=[];for(o.push(this);o.length>0;){var r=o.pop();if(0!=(n=i(r))&&(1==e&&1==this._isVisible||0==e))for(var s=r.getChildArray(),a=s.length-1;a>=0;a--){var l=s[a],u=!(l.getMatchInfo()&&l.getMatchInfo().getIsHidden_byStatusFilter());(1==e&&1==u||0==e)&&o.push(l)}}}catch(e){n=!1,t.errout("EXCEPTION in 'visit_nodesAndFN':: "+e)}return n},o}),define("DS/CompareWidget2/plugins/STRUCTURE/GET_RELATIONS_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/relations/Ecosystem","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode"],function(e,t,i){"use strict";const n=50;function o(e){var t=[];return e.forEach(function(e){e.getChildArray().forEach(function(e){t.push(e)})}),t}function r(e){let t=e.getChildArray();var i=[],r=1;let s=e.getObjIDSpec_REF().getPhysID();for(s&&i.push(s);r<=n&&t.length>0;)t.forEach(function(e){let t=e.getObjIDSpec_REF().getPhysID();t&&i.push(t)}),r++,t=o(t);return i}function s(e,t,i){for(var r=1,s=t,u=t[0];r<=n&&s.length>0;)s.forEach(function(t){if(null!=t.getObjIDSpec_REF().getPhysID()){var n=t.getObjIDSpec_REF().getPhysID(),o=[];e.formated[n]&&(o=Object.keys(e.formated[n]));for(var r=0;r<o.length;r++){var s=e.formated[n][o[r]],u=i[o[r]].label,c=a(t,o[r],u);s.forEach(function(i){var n=e.idObjMap[i],o=l(c,n);c.addChild(o),o.setDBContext(t._dbContext)}),t.addChild(c)}}}),s=o(s),r++;return u}function a(e,t,n){var o=new i(n,n,"relations","",t,"","","","","");return o.setParent(e),o.addAttr("REF.ds6w:type","relations"),o.addAttr("REF.physicalid",t),o.addAttr("REF.logicalid",t),o.addAttr("REF.versionid",t),o.addAttr("REF.name",n),o.addAttr("REF.dfr",t),o.addAttr("REF.ds6wg:revision",""),o.addAttr("REF.thumbnail_3d",""),o._extRelNLS=!0,o}function l(e,t){var n=new i(t.name,t.name,t.type,"",t.id,t.revision,"",t.icon_url,t.icon_url,t.thumbnail);return n._path=t.id,n.setParent(e),n.addAttr("REF.ds6w:type",t.type),n.addAttr("REF.physicalid",t.id),n.addAttr("REF.logicalid",t.id),n.addAttr("REF.versionid",t.revision),n.addAttr("REF.name",t.name),n.addAttr("REF.dfr",t.id),n.addAttr("REF.ds6wg:revision",t.revision),n.addAttr("REF.thumbnail_3d",t.thumbnail),n}return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n),this.relationLabels=i.RELATION_LABELS},onEnabled:function(){return this.syncSetting("compareSettings.includeFacets.externalRelations.showDocs","showDocs"),this.syncSetting("compareSettings.includeFacets.externalRelations.showOtherRels","showOtherRels"),!0},execute:function(e,i){var n=this;n._parent(e,i);var o=[];!0!==this.showDocs&&"true"!==this.showDocs||(o=i.DOCS_RELS);var a=[];!0!==this.showOtherRels&&"true"!==this.showOtherRels||(a=i.OTHER_RELS),n.rels=o.concat(a);var l=e.crTreeArray[0];n._objIn=e,n.rels.length>0?function(e,i){var n=this;return new Promise(function(e,i){var o=n.rels,a=n.relationLabels=n.relationLabels||n._pluginOptions.RELATION_LABELS;n._lastReqStart=n._plugSvcs.nowMS(),n._plugSvcs.postEvent("GET_RELATIONS_IN_PROGRESS_EVENT",null);var l=n._objIn.crTreeArray[0].getRoot(0),u=n._objIn.crTreeArray[0].getRoot(1),c=r(l),d=r(u),p=c.concat(d);t.get(p,o,function(t){if(null!=t){var i=[];i.push(l),s(t,i,a);var o=[];o.push(u),s(t,o,a)}e(n._objIn)})})}.call(n,l,i).then(function(e){var t=e;n.reportOK(t)},function(e){n.reportKO()}):n.reportOK(e)}})}),define("DS/CompareWidget2/support/cw2CacheMgr",["UWA/Class","DS/CompareWidget2/support/cw2Utils"],function(e,t){var i=function(){this.data={},this.putEntry=function(e,t){this.data[e]=t},this.getEntry=function(e){return this.data[e]},this.flush=function(){this.data={}},this.getSize=function(){return Object.keys(this.data).length},this.putArray=function(e){for(var t=e.length,i=0;i<t;i++){var n=e[i],o=n.name;this.putEntry(o,n)}}};return e.singleton({init:function(){this._cacheSet={}},flushAll:function(){this._cacheSet={}},flushCache:function(e){null!=this._cacheSet[e]&&(this._cacheSet[e]={})},getCache:function(e,t){return null==this._cacheSet[e]&&0!=t&&(this._cacheSet[e]=new i),this._cacheSet[e]},putCacheObj:function(e,t,i){this.getCache(e,!0).putEntry(t,i)},putCacheObjArray:function(e,t){for(var i=t.length,n=0;n<i;n++){var o=t[n],r=o.name;this.putCacheObj(e,r,o)}},getCacheObj:function(e,t){var i=this.getCache(e,!1);return ret=null!=i?entry=i.getEntry(t):void 0,ret},getSize:function(e){if(null==e)return Object.keys(this._cacheSet).length;var i=this.getCache(e,!1);return null==i?(t.errout("Cache '"+e+"' not found);"),null):i.getSize()},getTotalCachesSize:function(){return t.sizeof(this._cacheSet)}})}),define("DS/CompareWidget2/support/typeHierMgr",["UWA/Class","DS/CompareWidget2/support/cw2CacheMgr"],function(e,t){return e.singleton({init:function(){this._cache=t.getCache("typeHier",!0)},flush:function(){this._cache.flush()},isKindOf_withLookup:function(e,t){var i=this;return new Promise(function(n,o){var r=i.isKindOf(e,t);null!=r?n(r):i.loadUp([e]).then(function(o){var r=i.isKindOf(e,t);n(r)},function(t){o("Failed to find type hierarchy for "+e+": "+t)})})},isKindOf:function(e,t){var i=null;if(e==t)i=!0;else{var n=this._cache.getEntry(e);n&&(i=1==n[t])}return i},loadUp:function(e){var t=this,i=[];return e.forEach(function(e){null==t._cache.getEntry(e)&&i.push(e)}),new Promise(function(e,n){0==i.length?e():function(e){var t=this;return new Promise(function(i,n){require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADWSAccess"],function(t,o){t.app_initialization(function(){o.getTypesHierarchy({types:e,onComplete:function(e){let t=JSON.parse(e).types_hierarchies;i(t)},onFailure:function(e){console.error("Cannot retrieve hierarchies"),n(e)}})})},function(e){t.errout("Failed on load of modules for getTypesHiers() call: "+e),n(e)})})}(i).then(function(i){i.forEach(function(e){for(var i=e.type,n=e.hierarchy,o=null==n?0:n.length,r={},s=0;s<o;s++){r[n[s]]=!0}t._cache.putEntry(i,r)}),e()},function(e){n("Failed to loadUp type hierarchies in typeHierMgr... :"+e)})})}})}),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/expanders/expandMgr","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInstTreeAug","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInstTreeEditor","DS/CompareWidget2/support/objIDSpec","DS/CompareWidget2/userSettings/UserSettingsManager","DS/CompareWidget2/support/typeHierMgr","i18n!DS/CompareCommon/assets/nls/CompareCommon","i18n!DS/CompareWidget2/assets/nls/CompareV2","i18n!DS/CompareWidget2/assets/nls/DisplayMessages"],function(e,t,i,n,o,r,s,a,l,u){function c(e){var t,i,n;!1===r.get("compareSettings.dataSource.useIndex")&&(e||(t="INDEX_REQ_ENABLING",i="compare-alert-warning",require(["DS/CompareCommon/CompareAlert"],function(e){var o=null==t?a["MISSING ALERT MESSAGE"]:null!=a[t]?a[t]:t,r=null!=n&&""!==n?o.replace("{msgData}",n):o;e.doAlert({msg:r,alertStyle:i})},function(e){console.log("%%%% CompareWidget:: Failed to show "+i+": '"+t+"', error:"+e)})),widget.setValue("compareSettings.dataSource.useIndex",!0),r.set("compareSettings.dataSource.useIndex",!0))}return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n),this._expanders={byIndex:"CV_DIRECT",byDB:null},this.setExpandMethods(i.DATA_SOURCE,i.DB_FALLBACK)},onEnabled:function(){return this.syncSetting("compareSettings.dataSource.useIndex","_useIndex",function(e){this.postEvent({event:"Event_CW2_REFRESH"})}.bind(this)),!0},setExpandMethods:function(e,t){var i=this;null!=e&&""!==e&&(i._expanders.byIndex=e),null==t||""==t||0==t?i._expanders.byDB=null:1==t?"CV_SERVICE"==e||"CV_DIRECT"==e?i._expanders.byDB="DB_SERVICE":"LC_IDX_SERVICE"==e?i._expanders.byDB="LC_AUTH_SERVICE":(i._plugSvcs.warnout("DB FALLBACK DISABLED, as there is no default DB fallback for an expand of type: "+i._expanders.byIndex),i._expanders.byDB=null):i._expanders.byDB=t},execute:function(e,r){var a=this;a._parent(e,r);var d=e,p=d.some(e=>e.isFiltered());a.setExpandMethods(r.DATA_SOURCE,r.DB_FALLBACK),(p||null==a._expanders.byDB&&0==a._useIndex)&&c.call(a,!1),function(e,n){var r=this;return new Promise(function(s,a){r._plugSvcs.postEvent("STRUCT_UPDATE_IN_PROGRESS_EVENT",null);var l=[];e.forEach(function(e){if(null!=e.getCommands){var t=e.getCommands();null!=t&&t.forEach(function(t){var i=t.inNode;if(null!=i){var n=new o(i,"UNKNOWN",e.getSecurityContext(),e.getTenant(),e.getServiceName());l.push(n)}})}});for(var u=[...e,...l],c=[],d=u.length,p={securityContext:e[0]._securityContext,tenant:e[0]._tenant,serviceName:e[0]._serviceName},h=0;h<d;h++){var _=null,f=null,g=u[h],m=g.isFiltered();if(0==r._useIndex&&0==m?_=r._expanders.byDB:(_=r._expanders.byIndex,f=m?null:r._expanders.byDB),"CV_DIRECT"==_){var S=g.getExternalFilterSpec();null!=S&&null!=S.CVQueryV2&&"DELLmiGeneralSystemReference"!=g.getObjType()&&(_="CV_PROGRESSIVE")}t.doExpand(g,_,f,"-1",r._plugSvcs,n).then(function(e){var t=e;i.augment(t,p,r._plugSvcs).then(function(e){var t=e;c.push(t),c.length>=d&&s(c)},function(e){r._plugSvcs.errout("FAILURE AUGMENTING TREE:"+e),a(e)})},function(e){r._plugSvcs.errout("FAILURE EXPANDING TREE: "+e),a(e)})}})}.call(a,d,r).then(function(e){var t,i,o,r=function(e,t){var i=[],n=[],o=[],r={};return t.forEach(function(e){var t=e.getObjIDSpec().getUniqueID();null==r[t]&&(r[t]=[]),r[t].push(e)}),e.forEach(function(e){var t=e.getUniqueID(),n=r[t].pop();i.push(n),o.push(t)}),Object.keys(r).forEach(function(e){r[e].forEach(function(e){n.push(e)})}),{orderedTrees:i,extraTrees:n}}(d,e);r.orderedTrees.forEach(function(e){var t=e.getEditCommands();null!=t&&n.applyCommands(e,t,r.extraTrees,a._plugSvcs,!0)}),t=r.orderedTrees,i=a._plugSvcs,o=i.nowMS(),t.forEach(function(e){var t=0,n=0;if(e.visit_riTreeAndFN(function(e){var i=e.getAttr("REF.cgr"),o=e.getAttr("REF.thumbnail_3d");return null!=i&&""!=i&&n++,null!=o&&""!=o&&t++,!0}),n!=t){var o=t<n,r=o?i.warnout:i.dbgout;r("===->"),r("===-> Input assembly has "+n+" CGRs and "+t+" thumbnail_3ds"),o&&r("===-> expect 3DRendering to be significantly slower"),r("===->")}}),i.reportTime(o,"Time to verify assemblies have bitmaps"),function(e){var t={};e.forEach(function(e){e.visit_riTreeAndFN(function(e){var i=e.getAttr("REF.ds6w:type"),n=e.getAttr("INST.ds6w:type");return t[i]=!0,null!=n&&(t[n]=!0),!0})});var i=Object.keys(t);return s.loadUp(i)}(r.orderedTrees).then(function(e){a.reportOK(r.orderedTrees)},function(e){a._plugSvcs.warnout("failed to load type hierarchies:: "+e),a._plugSvcs.warnout("continuing..."),a.reportOK(r.orderedTrees)})},function(e){a._plugSvcs.confirmDialog(u.FETCH_FAIL_DEFAULT,{label:l.Close,callback:function(){a._plugSvcs.postEvent("Event_CW2_RESET_TO_INPUT")}},null),a.reportKO(e)})}})}),define("DS/CompareWidget2/ViewDefModules/ViewDefOptions",["DS/CompareWidget2/ViewDefModules/DSColors","i18n!DS/CompareWidget/assets/nls/CompareWidget"],function(e,t){"use strict";var i={PHYSICALID:"REF.physicalid",VERSIONID:"REF.versionid",REF_LOGID:"REF.logicalid",DFR:"REF.dfr",INST_LOGID:"INST.logicalid",XFORM:"INST.matrixtxt",USAGE:"REF.bo.plmentity.v_usage"},n={PHYSICALID:"REF.physicalid",VERSIONID:"REF.versionid",NAME:"REF.name"},o={...i,INST_LOGID:"INST.logicalid[connection]",XFORM:"INST.xform",USAGE:"REF.attribute[PLMEntity.V_Usage]"},r={DB_PROPS:o,CV_PROPS:i,CVURL_BY_TYPE:[{name:"DEFAULT",url:"/cvservlet/expand"},{name:"3D",url:"/cvservlet/expand3d",typeList:["LPAbstract3DRepReference","LPAbstractReference","MCAD Component","CATIA V4 Model","CATIA CGR","CATShape"]},{name:"Filter",url:"/cvservlet/multiexpand",typeList:["ENOStrRefinementSpecification"]}],DATA_SOURCE:"CV_DIRECT",DB_FALLBACK:!0},s={PROPS:i,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION","BRANCH","DUPE","REPLACED"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ","NEQ","NEQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","EQ","NEQ","NEQ","NEQ"]],COMP_REF_LOGID:[["REF_LOGID","REF_LOGID"],["EQ","EQ","EQ","NEQ","NEQ"]],COMP_DFR:[["DFR","DFR"],["N/A","N/A","N/A","EQ","NEQ"]],COMP_INST_LOGID:[["INST_LOGID","INST_LOGID"],["N/A","N/A","N/A","N/A","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[{NAME:"MOVED",PROPS:["XFORM","XFORM"],FLAG_ON:"NEQ",IS_VISIBLE:!0,MATCH_ADJ:-1},{NAME:"NON_MATCHING_INSTANCE",PROPS:["INST_LOGID","INST_LOGID"],FLAG_ON:"NEQ",IS_VISIBLE:!1,MATCH_ADJ:-2}]},a={PROPS:n,RELATION_LABELS:{"SpaceAssignment_to.472":{label:t.spaceAssignment,icon:" "},"RFL_implementScope_from.52":{label:t.implementedBy,icon:" "},"RFL_implementScope_to.51":{label:t.implementing,icon:""},"ProposedSolution_to.ProposedSolution":{label:t.proposedSolutions,icon:""},"v6_specdoc_to.87":{label:t.attachedDocuments,icon:""},"v6_annexdoc_to.Reference Document":{label:t.attachedDocuments,icon:""},"v6_specdoc_to.SpecificationDocument":{label:t.specificationDocuments,icon:""}},DOCS_RELS:["v6_specdoc_to","v6_annexdoc_to"],OTHER_RELS:["SpaceAssignment_to","RFL_implementScope_from","RFL_implementScope_to","ProposedSolution_to"]},l={PROPS:n,COMPUTE_DIFFERENT:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","NEQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[]},u={SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:e.colorDef.ORANGE,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"LO"},RIGHT_ONLY:{COLOR:e.colorDef.BLUE1,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"RO"},UNRELATED:{COLOR:e.colorDef.BLACK,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"UNRELATED"},DIFFERENT:{COLOR:e.colorDef.BEIGE,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"DIFFERENT"},QUANTITY:{COLOR:e.colorDef.BLUE2,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:e.colorDef.NONE,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"SM"},REVISION:{COLOR:e.colorDef.VIOLET,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"REV"},BRANCH:{COLOR:e.colorDef.GREEN2,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"BRANCHED"},DUPE:{COLOR:e.colorDef.RED,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"DUPLICATED"},REPLACED:{COLOR:e.colorDef.PINK,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"REPLACED"}},CUSTOM_MATCH_ADJ_FLAGS:{MOVED:{COLOR:e.colorDef.YELLOW,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"MOVED"},NON_MATCHING_INSTANCE:{COLOR:e.colorDef.BLUE6,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"NON_MATCHING_INSTANCE"}},BUBBLE_FLAGS:{},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu",CELL_DRAG_ENABLED_FLAG:!0,SHOW_HIDE_NODE_PARAMS:[{CHILD:{TYPE:["PLMPort","PLMConnection"]},SHOW:!1},{CHILD:{TYPE:["3DShape"]},PARENT:{TYPE:["VPMReference"],ATTRIBUTES:{[`${i.USAGE}`]:"3DPart"}},SHOW:"viewSettings.STRUCT_VIEW.show_3dshape_of_3dpart"}]},c={colorLeft:u.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,colorRight:u.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR};return{RUN_OPTIONS:{},DB_PROPS:o,CV_PROPS:i,REL_PROPS:n,BUBBLE_OPTIONS:{BUBBLE_DOWN_ENABLED:!1,BUBBLE_UP_ENABLED:!1,BUBBLED_STATUS_CONFIG:[]},ATTRIBUTE_DISPLAY_OPTIONS:c,INST_ATTR_FETCH_OPTIONS:{isInstance:!0},INST_ATTR_DISPLAY_OPTIONS:{isInstance:!0,colorLeft:c.colorLeft,colorRight:c.colorRight},STRUCT_FETCH_OPTIONS:r,STRUCT_COMPARE_OPTIONS:s,STRUCT_DISPLAY_OPTIONS:u,EFFECTIVITY_FETCH_OPTIONS:{isEffectivity:!0},EFFECTIVITY_DISPLAY_OPTIONS:{isEffectivity:!0,colorLeft:c.colorLeft,colorRight:c.colorRight},GET_RELATIONS_OPTIONS:a,COMPARE_REL_OPTIONS:l}}),define("DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2",["DS/CompareWidget2/ViewDefModules/ViewDefOptions"],function(e){"use strict";var t={AttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.ATTRIBUTE_DISPLAY_OPTIONS},InstAttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin",Options:e.INST_ATTR_FETCH_OPTIONS},InstAttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},InstAttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.INST_ATTR_DISPLAY_OPTIONS},View3DDisplay:{Path:"DS/CompareWidget2/plugins/VIEW3D/VIEW3D_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},View3DPrep:{Path:"DS/CompareWidget2/plugins/VIEW3D/VIEW3D_PREP_plugin"},StructFetch:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS},StructCompare:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},GetRelations:{Path:"DS/CompareWidget2/plugins/STRUCTURE/GET_RELATIONS_plugin",Options:e.GET_RELATIONS_OPTIONS},CompareRels:{Path:"DS/CompareWidget2/plugins/STRUCTURE/REL_COMPARE_plugin",Options:e.COMPARE_REL_OPTIONS},StructDisplay:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},StructCustAttrsPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_CUST_ATTRS_PREP_plugin"},EffectivityFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin",Options:e.EFFECTIVITY_FETCH_OPTIONS},EffectivityCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},EffectivityDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.EFFECTIVITY_DISPLAY_OPTIONS},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{PROPS_ONLY:{ROW:"PROP_VIEW"},STRUCT_ONLY:{ROW:"STRUCT_VIEW"},PAD3D_ONLY:{ROW:"PAD3D_VIEW"},PROPS_AND_STRUCT:{COL:["STRUCT_VIEW","PROP_VIEW"]},PROPS_STRUCT_INSTANCE:{ROW:["STRUCT_VIEW",{COL:["PROP_VIEW","INSTANCE_VIEW"]}]},STRUCT_PROPS_INST_PAD3D:{ROW:["STRUCT_VIEW",{COL:[["PROP_VIEW","INSTANCE_VIEW"],"PAD3D_VIEW"]}]},STRUCT_PROPS_INST_EFF_PAD3D:{ROW:["STRUCT_VIEW_WITH_CUSTOM_ATTRS",{COL:[["PROP_VIEW","INSTANCE_VIEW","EFFECTIVITY_VIEW"],"PAD3D_VIEW"]}]},STRUCT_PROPS_INST_EFF:{ROW:["STRUCT_VIEW",{COL:[["PROP_VIEW","INSTANCE_VIEW","EFFECTIVITY_VIEW"]]}]},STRUCT_PROPS_EFF:{COL:["STRUCT_VIEW",["PROP_VIEW","EFFECTIVITY_VIEW"]]}},VIEWDEFS:{PROP_VIEW:["AttrFetch","AttrCompare","AttrDisplay"],INSTANCE_VIEW:["InstAttrFetch","InstAttrCompare","InstAttrDisplay"],EFFECTIVITY_VIEW:["EffectivityFetch","EffectivityCompare","EffectivityDisplay"],STRUCT_VIEW:["StructFetch","StructCompare","GetRelations","CompareRels","StructListViewPrep","StructDisplay","Exporter"],STRUCT_VIEW_WITH_CUSTOM_ATTRS:["StructFetch","StructCompare","GetRelations","CompareRels","StructCustAttrsPrep","StructListViewPrep","StructDisplay","Exporter"],PAD3D_VIEW:["StructFetch","View3DPrep","View3DDisplay"]},PLUGDEFS:t},e)}),define("DS/CompareWidget2/ViewDefModules/TNR_viewDefs",["DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){var i={PHYSICALID:"REF.physicalid",NAME:"REF.name",TYPE:"REF.ds6w:type",DFR:"REF.dfr",XFORM:"INST.matrixtxt",REVISION:"REF.ds6wg:revision"},n={...i,INST_LOGID:"INST.logicalid[connection]",XFORM:"INST.xform"};e.STRUCT_FETCH_OPTIONS.CV_PROPS=i,e.STRUCT_FETCH_OPTIONS.DB_PROPS=n;var o={PROPS:i,CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION","SIMILAR"],CUSTOM_COMPARISONS:{COMP_TYPE:[["TYPE","TYPE"],["EQ","EQ","EQ"]],COMP_DFR:[["DFR","DFR"],["EQ","EQ","EQ"]],COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ","NEQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ","NEQ"]],COMP_REV:[["REVISION","REVISION"],["EQ","NEQ","N/A"]]}};UWA.extend(e.STRUCT_COMPARE_OPTIONS,o);var r={CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"},SIMILAR:{COLOR:t.colorDef.GREEN2,NLS:"SIMILAR"}}};return UWA.extend(e.STRUCT_DISPLAY_OPTIONS,r),e}),define("DS/CompareWidget2/ViewDefModules/develViewDef",["DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){UWA.extend(e.VIEWDEFS,{DEVEL_VIEW:["StructFetch","StructCompare","StructDisplay"]});return UWA.extend(e.VIEWSETS,{DEVEL_VIEWSET:[["DEVEL_VIEW","PROP_VIEW"],["PAD3D_VIEW"]]}),e.STRUCT_DISPLAY_OPTIONS.SYSTEM_RULE_ID_FLAGS.DIFFERENT.COLOR=t.colorDef.GREEN3,e.STRUCT_DISPLAY_OPTIONS.FORCE_ROOTS_TOGETHER=!0,e.STRUCT_COMPARE_OPTIONS.COMPUTE_DIFFERENT=!0,e}),define("DS/CompareWidget2/support/tenantServiceContext_IDList",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/objIDSpec"],function(e,t){return function(){this._data={},this.addObjIDSpec=function(e){var t=e.getTenant(),i=e.getServiceName(),n=e.getSecurityContext(),o=e.getPhysID();null==this._data[t]&&(this._data[t]={}),null==this._data[t][i]&&(this._data[t][i]={}),null==this._data[t][i][n]&&(this._data[t][i][n]=[]),this._data[t][i][n][o]=e.getObjType()},this.visitEach_doFunc=function(e){var t=this;Object.keys(t._data).forEach(function(i){Object.keys(t._data[i]).forEach(function(n){Object.keys(t._data[i][n]).forEach(function(o){Object.keys(t._data[i][n][o]).forEach(function(r){var s=t._data[i][n][o][r];e(i,n,o,r,s)})})})})},this.getList=function(){var e=[];return this.visitEach_doFunc(function(i,n,o,r,s){var a=new t(r,s,i,n,o);return e.push(a),!0}),e}}}),define("DS/CompareWidget2/plugins/displayPlugin",["DS/CompareWidget2/plugins/plugin","DS/UIKIT/Mask"],function(e,t){return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n),this._type="DISPLAY_PLUGIN",this._frame=null,this._outputPanel=null,this._messagePanel=null},createViewPanelObject:function(e,t){throw new Error("Abstract class called")},getViewPanel:function(){return this._outputPanel},showMessage:function(e){null!=this._frame&&(t.isMasked(this._frame)&&this.showNotBusy(),t.mask(this._frame,e),this._frame.getElement(".spinner").destroy(),this._frame.getElement(".mask").setStyle("background-color","rgba(255, 255, 255, 1)"))},removeMessage:function(){this.showNotBusy()},showBusy:function(){null!=this._frame&&t.mask(this._frame)},showNotBusy:function(){null!=this._frame&&t.isMasked(this._frame)&&t.unmask(this._frame)},reportKO:function(e){null!=e?this.showMessage(e):this.showNotBusy(),this._parent(e)},buildViewPanel:function(e,t,i,n){var o=this;this.hideCloseButton=t&&!0===t.hideCloseButton,o._frame=widget._isODTMode()&&!widget.isCompareFrameworkTest?(document.body.innerHTML="",document.body):o._plugSvcs.requestFrame(e),o.showBusy(),o._outputPanel=o.createViewPanelObject(o._frame,t),(widget._isODTMode()&&widget.isCompareFrameworkTest||!widget._isODTMode())&&o._plugSvcs.addPanel(e,o._outputPanel,o,i,n)},destroyDisplayPanel:function(){var e=this;null!=e._outputPanel&&"function"==typeof e._outputPanel.destroy&&e._outputPanel.destroy(),e._outputPanel=null,e._frame=null},onClearView:function(){null!=this._outputPanel&&this._outputPanel.clearView()},onUpdateInProgress:function(){this.onClearView(),this.showBusy()},enable:function(){return this._parent()},disable:function(){this._parent()},disconnect:function(){this.destroyDisplayPanel(),this._parent()},destroy:function(){this.destroyDisplayPanel(),this._parent()}})}),define("DS/CompareWidget2/viewComponents/StandardCompareToolbar",["UWA/Core","UWA/Class","DS/Tweakers/GeneratedToolbar","DS/Core/PointerEvents","DS/Menu/Menu","DS/Tweakers/TypeRepresentationFactory","DS/CompareWidget2/support/cw2Utils","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2","css!DS/CompareWidget2/assets/css/Controls/Toolbar.css"],function(e,t,i,n,o,r,s,a,l){"use strict";return t.extend({init:function(e,t,i){this.container=e,this.options=i,this.view=t,this._buildView()},_buildView:function(){var t=this;this.toolbarContainer=e.createElement("div",{class:"compare-view-toolbar-container"}).inject(this.container),!0===this.options.navigateDifferences&&(this.toolbarNavigate=new i({overflowManagement:"dropdown",direction:"horizontal",items:i.prototype.createTreeDocument({entries:[{id:"navigatePrevious",dataElements:{domId:"compare-navigate-previous-button",typeRepresentation:"functionIcon",position:"near",tooltipInfos:a.generateTooltip("CompareWidget2/Tooltips","PreviousDifference"),icon:{iconName:"chevron-left",fontIconFamily:1},category:1,overflowPriority:"never",value:()=>t.view.handleToolbarCommands.bind(t.view)({event:"navigatePrevious"}),priority:100}},{id:"numDifferencesCommand",dataElements:{domId:"compare-navigate-differences-button",typeRepresentation:"functionMenuIconCount",label:"Differences",position:"near",tooltipInfos:a.generateTooltip("CompareWidget2/Tooltips","NumberOfDifferences"),value:{menu:[{icon:"double-chevron-up",title:l.FirstDifference,tooltip:a.generateTooltip("CompareWidget2/Tooltips","FirstDifference"),domId:"compare-navigate-first-button",event:"navigateFirst"},{icon:"double-chevron-down",title:l.LastDifference,tooltip:a.generateTooltip("CompareWidget2/Tooltips","LastDifference"),domId:"compare-navigate-last-button",event:"navigateLast"}].map(e=>({type:"PushItem",title:e.title,domId:e.domId,tooltip:e.tooltip,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.icon},action:{callback:i=>{t.view.handleToolbarCommands({event:e.event})}}}))},category:1,overflowPriority:"never",priority:100,count:1}},{id:"navigateNext",dataElements:{domId:"compare-navigate-next-button",typeRepresentation:"functionIcon",position:"near",tooltipInfos:a.generateTooltip("CompareWidget2/Tooltips","NextDifference"),icon:{iconName:"chevron-right",fontIconFamily:1},category:1,overflowPriority:"never",value:()=>t.view.handleToolbarCommands.bind(t.view)({event:"navigateNext"}),priority:100}}]})}),this.toolbarNavigate.inject(this.toolbarContainer),this.toolbarNavigate.elements.container.addClassName("compare-view-toolbar-navigate"),"desktop"!==s.getDeviceType()&&this.toolbarNavigate.elements.container.setAttribute("touch-mode",""),this.onReadyLeftToken||(this.onReadyLeftToken=t.toolbarNavigate.getContent().addEvent("onReady",function(){var e=t.toolbarNavigate.getNodeModelByID("numDifferencesCommand")._associatedView;e&&e.getContent().addClassName("compare-toolbar-differences")})));var n=Array.isArray(this.options.otherMenuItems)&&this.options.otherMenuItems.length?this.options.otherMenuItems:[];if(this.options.showCompareLegend){this.toolbar=new i({overflowManagement:"dropdown",direction:"horizontal",popupDisplayStyle:"Basic",items:i.prototype.createTreeDocument({entries:[]})}),this.toolbar.elements.container.addClassName("compare-view-toolbar-legend"),this.toolbar.inject(this.toolbarContainer),this.onReadyLegendToken||(this.onReadyLegendToken=t.toolbar.getContent().addEvent("onReady",function(){if(t.legendItems)for(var e in t.legendItems){var i=t.legendItems[e],n=t.toolbar.getNodeModelByID(e);if(n){let s=n._associatedView;if(s){s.getContent().getParent(".wux-generated-toolbar-items").addClassName("compare-toolbar-legend"),s.getContent().id="compare-legend-status-"+i.label;var o=s.getContent().getChildren();o[0].addClassName("compare-toolbar-legend-item"),o[0].setStyles({"text-align":"left",color:"#3d3d3d"});var r=o[0].getChildren();r[0].setStyles({"background-color":"IDENTICAL"===e&&""===i.color?"#FFFFFF":i.color,"border-color":"IDENTICAL"===e&&""===i.color?"grey":i.color}),"IDENTICAL"===e&&""===i.color&&r[0].addClassName("compare-gray-check-for-white-status"),t.toolbar.elements.popupContent.setStyles({"padding-right":"10px","padding-left":"10px","padding-top":"2px","padding-bottom":"2px"})}}}})),0==this.options.CUSTOM_PROFILE_IN_USE&&n.unshift({id:"chooseStatusToDisplay",dataElements:{domId:"compare-choose-statuses-display-button",typeRepresentation:"functionIcon",tooltipInfos:a.generateTooltip("CompareWidget2/Tooltips","chooseStatusToDisplay"),icon:{iconName:"menu-eye",fontIconFamily:1},overflowPriority:"never",value:()=>t.view.handleToolbarCommands.bind(t.view)({event:"legendApplyVisibility"}),position:"far",priority:1}})}Array.isArray(n)&&n.length&&(this.toolbarOtherItems=new i({overflowManagement:"dropdown",direction:"horizontal",popupDisplayStyle:"Basic",items:i.prototype.createTreeDocument({entries:n})}),this.toolbarOtherItems.inject(this.toolbarContainer),this.toolbarOtherItems.elements.container.addClassName(this.options.showCompareLegend?"compare-view-toolbar-right-fixed-width":"compare-view-toolbar-right"))},update:function(e){let t=this,n=["toolbarNavigate","toolbar","toolbarOtherItems"],o=(e,t)=>{n.forEach(i=>{this[i]&&this[i][e].apply(this[i],t)})};o("prepareUpdateView");for(let n in e)switch(n){case"legend":{null!=this.legendItems&&Object.keys(this.legendItems).forEach(e=>{this.toolbar.items&&Array.isArray(this.toolbar.items.getRoots())&&this.toolbar.items.getRoots().filter(t=>t._ID.indexOf(e)>=0).forEach(e=>e.remove(!0))}),this.legendItems=e[n];var r={entries:[]};let o=0;for(var s=0;s<=o;++s)for(let[e,i]of Object.entries(this.legendItems)){let n=null!=i.legendGrouping?i.legendGrouping:0;if(n>s)n>o&&(o=n);else if(n===s){let n=i.tooltip;""!==i.modulePath&&Object.entries(l).map(([e,t])=>{t===i.label&&(n=a.generateTooltip(i.modulePath,e))}),r.entries.push({id:e,tooltipInfos:n,dataElements:{typeRepresentation:"bool",label:i.label,value:i.checked,color:this.legendItems[e].color,visibleFlag:i.visibleFlag},onNodeUpdate:function(e){var n=e.getAttributeValue("data");i.checked=n,t.view.handleToolbarCommands.bind(t.view)({event:"legendApplyFilter",toolbar:t.toolbar})}})}}[...i.prototype.createTreeDocument(r).getRoots()].forEach(function(e){t.toolbar.items.addRoot(e)});break}case"numDifferences":null!=t.toolbarNavigate&&(t.toolbarNavigate.getNodeModelByID("numDifferencesCommand").options.count=e[n]);break;case"enableDisableCommands":e[n].forEach(e=>{o("updateNodeModel",[e.id,{disabled:e.disabled}])});break;case"showHideCommands":e[n].forEach(e=>{o("updateNodeModel",[e.id,{visibleFlag:e.visibleFlag}])});break;case"displayIcon":e[n].forEach(e=>{o("updateNodeModel",[e.id,{grid:{semantics:{icon:{iconName:e.icon}}}}])})}o("pushUpdateView")},destroy:function(){}})}),define("DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/propsComparePanel",["UWA/Core","UWA/Json","DS/CustomizableLayout/View","DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/attrChooseDialog","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/CompareWidget2/viewComponents/StandardCompareToolbar","DS/CompareWidget2/userSettings/UserSettingsManager","DS/CompareWidget2/support/cw2Utils","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2","i18n!DS/CompareWidget2/assets/nls/DisplayMessages","css!DS/CompareWidget2/assets/css/attrComparePanel/attrComparePanel.css"],function(e,t,i,n,o,r,s,a,l,u,c,d,p){return i.extend({init:function(e,t,i){this._parent(),this.device=u.getDeviceType(),this._colorLeft=null!=i&&i.colorLeft?i.colorLeft:"#ff8a2e",this._colorRight=null!=i&&i.colorRight?i.colorRight:"#009ddb",this._plugSvcs=t,this.buildSkeleton(e),this.showDiffOnly=!1,this.toClear=[],this.currentDisplayMode=""},getLabel:function(){return"undefined_TITLE"},getName:function(){return"undefined_VIEW"},getDomId:function(){return"undefined_ID"},isTitleAttr:function(e){return c.isTitleAttr(e,!1)},generateId:function(e){return"viewSettings."+this.getName()+"."+e},buildSkeleton:function(t){this.singleColView=!1,this.elements.container=t;var i=this.getToolbarItems(),n=i.find(e=>e.id.indexOf("showOnlyDifferences")>0);n&&l.sync(n.dataElements,n.id,"value",null),this.standardToolbar=new a(t,this,{navigateDifferences:!1,showCompareLegend:!1,otherMenuItems:i}),this.dataGridViewContainer=e.createElement("div",{styles:{flex:"1",position:"relative","border-top":"1px solid #f4f5f6"},id:"ATTR_DISPLAY_CONTAINER"}).inject(this.elements.container)},getToolbarItems:function(){return[this.getShowOnlyDifferencesItem(),this.getChooseAttributesToDisplayItem()]},getShowOnlyDifferencesItem:function(){var e=this;return{id:this.generateId("showOnlyDifferences"),dataElements:{typeRepresentation:"independantBoolean",priority:3,domId:"compare-"+this.getDomId()+"-diffs-only",label:d.attrShowDiffOnly,tooltipInfos:c.generateTooltip("CompareWidget2/Tooltips","attrShowDiffOnly"),position:"near"},onNodeUpdate:function(t){e.showDiffOnlyClicked(t)}}},getChooseAttributesToDisplayItem:function(){return{id:this.generateId("chooseAttributesToDisplay"),dataElements:{typeRepresentation:"functionIcon",priority:10,domId:"compare-"+this.getDomId()+"-to-display",tooltip:c.generateTooltip("CompareWidget2/Tooltips","selectPropertiesToDisplay"),icon:{iconName:"attributes-cog",fontIconFamily:1},position:"far",value:this.customizeRows.bind(this)}}},showDiffOnlyClicked:function(e){this.showDiffOnly=e.options.grid.data,this.update()},destroy:function(){this.elements.container=null,this.dataGridViewContainer=null},showResults:function(e){var t=this;return new Promise(function(i,n){var o=!1;t.compareResult=e,t.names=[];for(let i=0;i<e.length;i++)t.names.push(e[i].name),e[i].valuesRight.length>0&&(o=!0);var r=!0;this.comparedWithObjects=e[0].valuesRight.length,this.comparedWithObjects>1&&(r=!1),t.standardToolbar.update({showHideCommands:[{id:t.generateId("showOnlyDifferences"),visibleFlag:o},{id:"attrViewSelector",visibleFlag:r}]}),i(!0)})},isDiff:function(e){let t=e.valuesRight;if(!t.length)return!0;if(e.valueLeft||t.some(e=>e))for(let i=0;i<t.length;i++)if(e.valueLeft!=t[i])return!0;return!1},filterOutNoDiff:function(e){let t=[];for(let i=0;i<e.length;i++){let n=e[i];this.isDiff(n)&&t.push(n)}return t},filterOutPropertiesToHide:function(e){var t=[];for(let i=0;i<this.compareResult.length;i++){let n=this.compareResult[i];-1==e.indexOf(n.name)&&(this.isTitleAttr(n)?t.unshift(n):t.push(n))}var i=t.findIndex(e=>"thumbnailimage"===e.name);if(-1!=i&&0!=i){t.unshift(t[i]);var n=i+1;t.splice(n,1)}return t},getAttributeDisplayOptions:function(){let e=l.get(this.generateId("attributes_not_shown"));this.defaultAttrs=l.get(this.generateId("default_attributes"));try{this.propsToHide=t.decode(e)}catch(t){e.constructor===String&&(this.propsToHide="__showall__"===e?[]:""===e?["__showDefault__"]:e.split(","))}},getPropsToHide:function(e){return null!=this.propsToHide&&this.propsToHide.length?1===this.propsToHide.length&&"__showDefault__"===this.propsToHide[0]?e.reduce((e,t)=>(-1===this.defaultAttrs.indexOf(t.name)&&!this.isTitleAttr(t)&&e.push(t.name),e),[]):[...this.propsToHide]:[]},showDefaultPropsOnly:function(){return 1===this.propsToHide.length&&"__showDefault__"===this.propsToHide[0]},showAllProps:function(){return 0===this.propsToHide.length},savePropsDisplayOptions:function(e){this.propsToHide=e,this.saveAttributeSettings()},update:function(){var e=this;if(Array.isArray(e.compareResult))if(this.compareTwo=e.compareResult.length&&1===e.compareResult[0].valuesRight.length,null==this.currentDisplayMode||""===this.currentDisplayMode)e.onResize();else{e.getAttributeDisplayOptions();var t=e.filterOutPropertiesToHide(e.getPropsToHide(e.compareResult));e.showDiffOnly&&(t=e.filterOutNoDiff(t)),e.clearView(),e.buildDataGridView(t,this.currentDisplayMode),e.elements.dataGridView.inject(e.dataGridViewContainer)}return!0},clearView:function(){null!=this.elements.dataGridView&&(this.clear(this.elements.dataGridView),this.dataGridViewContainer.empty())},clear:function(e){var t=this;null!=e&&(t.toClear.push(e),setTimeout(function(){for(var e=t.toClear.length,i=0;i<e;i++)try{null!=t.toClear[i]&&(t.toClear[i].destroy(),t.toClear[i]=null)}catch(e){t._plugSvcs.errout("Exception while clearing panels: '"+e+", continuing...")}t.toClear=[]},0))},createColumnOptions:function(e){var t=this,i={width:"auto",onCellRequest:function(e){t.onCellRequest(e,this)}};for(var n in e)i[n]=e[n];return i},buildViewModel:function(e){let t=this,i=[],n=e.length>0?e[0].valuesRight.length:0;for(let o=0,r=e.length;o<r;o++){let r=e[o],s={title:r.displayName,left:{value:r.valueLeft,COLOR:1===n&&!0===r.highlightRight[0]?t._colorLeft:""},right:r.valuesRight.map((e,i)=>({value:e,COLOR:1===n&&!0===r.highlightRight[0]?t._colorRight:"",highlightRightText:n>1&&!0===r.highlightRight[i]})),data:{isThumbnail:"thumbnailimage"===r.name}};n>0&&0===r.valuesRight.length&&(s.left.COLOR=t._colorLeft,s.right.push({COLOR:t._colorRight})),i.push(s)}return i},buildDataGridView:function(t,i){let n=this,a=t.length>0?t[0].valuesRight.length:0,l=n.buildViewModel(t),u=new o,c=void 0;switch(i){case"threeColumn":for(let t=0,i=l.length;t<i;t++){let i=l[t],n={label:i.title,grid:{left:i.left.value,COLOR_LEFT:i.left.COLOR},data:e.extend(i.data,{family:t,titleColumnID:0})};for(let e=0;e<a;e++)n.grid["right_"+e.toString()]=i.right[e].value,1===a?n.grid.COLOR_RIGHT=i.right[0].COLOR:a>1&&(n.grid["highlightRightText_"+e.toString()]=i.right[e].highlightRightText);u.addChild(new r(n))}c=[this.createColumnOptions({dataIndex:"tree"}),...this.compareTwo?[this.createColumnOptions({dataIndex:"COLOR_LEFT",width:8.5,minWidth:8.5,typeRepresentation:"color"})]:[],this.createColumnOptions({dataIndex:"left",typeRepresentation:"textBlock",autoRowHeightFlag:!0}),...this.compareTwo?[this.createColumnOptions({dataIndex:"COLOR_RIGHT",width:8.5,minWidth:8.5,typeRepresentation:"color"})]:[]];for(var h=0;h<a;h++)c.push(this.createColumnOptions({dataIndex:"right_"+h,typeRepresentation:"textBlock",autoRowHeightFlag:!0}));c.forEach(e=>e.getCellClassName=this._getCellClassName);break;case"twoColumn":for(let t=0,i=l.length;t<i;t++){let i=l[t];u.addChild(new r({grid:{left:i.title,COLOR_LEFT:"",COLOR_RIGHT:""},data:{family:t,titleColumnID:1===a?2:0}}));let n={grid:{left:i.left.value,COLOR_LEFT:i.left.COLOR},data:e.extend(i.data,{family:t})};e.extend(n.grid,i.right.reduce((e,t,o)=>(e["right_"+o.toString()]=t.value,1===a?e.COLOR_RIGHT=i.right[0].COLOR:a>1&&(n.grid["highlightRightText_"+o.toString()]=i.right[o].highlightRightText),e),{})),u.addChild(new r(n))}c=[...this.compareTwo?[this.createColumnOptions({dataIndex:"tree",width:3,minWidth:3}),this.createColumnOptions({dataIndex:"COLOR_LEFT",width:8.5,minWidth:8.5,typeRepresentation:"color"})]:[],this.createColumnOptions({dataIndex:"left",typeRepresentation:"textBlock",autoRowHeightFlag:!0}),...this.compareTwo?[this.createColumnOptions({dataIndex:"COLOR_RIGHT",width:8.5,minWidth:8.5,typeRepresentation:"color"})]:[]];for(h=0;h<a;h++){var _={dataIndex:"right_"+h,typeRepresentation:"textBlock",autoRowHeightFlag:!0};c.push(this.createColumnOptions(_))}c.forEach(e=>e.getCellClassName=this._getCellClassName);break;case"oneColumn":for(let t=0,i=l.length;t<i;t++){let i=l[t];u.addChild(new r({grid:{left:i.title,COLOR:""},data:{family:t,titleColumnID:1===a?2:0}})),u.addChild(new r({grid:{left:i.left.value,COLOR:i.left.COLOR},data:e.extend(i.data,{family:t})})),a>0&&i.left.COLOR!==i.right[0].COLOR&&u.addChild(new r({grid:{left:i.right[0].value,COLOR:i.right[0].COLOR},data:e.extend(i.data,{family:t})}))}(c=[...this.compareTwo?[this.createColumnOptions({dataIndex:"tree",width:3,minWidth:3}),this.createColumnOptions({dataIndex:"COLOR",width:8.5,minWidth:8.5,typeRepresentation:"color"})]:[],this.createColumnOptions({dataIndex:"left",typeRepresentation:"textBlock",autoRowHeightFlag:!0})]).forEach(e=>e.getCellClassName=this._getCellClassName)}var f=e.createElement("span",{class:"attr-table-no-diffs-found",html:p.NO_DIFFERENCES_FOUND});this.elements.dataGridView=new s({identifier:"ComparePropertyView",treeDocument:u,columns:c,rowSelection:"single",cellSelection:"none",columnSelection:"none",defaultColumnDef:{minWidth:8.5},placeholder:f,getCellTooltip:function(e){var t=e.cellModel;return{title:("#ff8a2e"===t?d.mainToolbarLeftObjectString:"#009ddb"===t?d.mainToolbarRightObjectString:"")||"",updateModel:!1}}}),this.elements.dataGridView.registerReusableCellContent({id:"renderThumbnail",buildContent:function(){return new e.Element("img").inject(new e.Element("div",{class:"thumbnail-div"}))}}),this.elements.dataGridView.showCellActivationFlag=!1,this.elements.dataGridView.layout.columnsHeader=!1,this.elements.dataGridView.layout.rowsHeader=!1,this.elements.dataGridView.layout.useLastColumnWidthAutoFlag=!0,this.elements.dataGridView.layout.getRowHeightFunction=function(e){let t=n.elements.dataGridView.layout.getRowHeightFromCellContents(e);return!0===u.getNthRoot(e).options.data.isThumbnail?75:t}},_getCellClassName:function(e){var t;t=e.nodeModel.options.data.family%2==0?"compareGreyRow":e.nodeModel.options.grid.family%2==0?"compareGreyRow":"compareWhiteRow";var i=e.nodeModel.options.data.titleColumnID;return null!=i&&e.columnID===i&&(t+=" compare-attr-title-cell"),t},onCellRequest:function(e,t){t.defaultOnCellRequest(e),!0===e.nodeModel.options.data.isThumbnail&&null!=e.cellModel&&(e.cellModel.indexOf("http://")>=0||e.cellModel.indexOf("https://")>=0||e.cellModel.indexOf("data:image")>=0)?this.renderThumbnail(e,t):this.renderCellTextColor(e,this.currentDisplayMode,t)},renderThumbnail:function(e,t){let i=t.reuseCellContent("renderThumbnail");i.setAttribute("src",e.cellModel),e.cellView.setReusableContent(i.getParent())},renderCellTextColor:function(e,t,i){if(!this.compareTwo&&"oneColumn"!==t){let t=i.getColumnOrGroup(e.columnID);t.dataIndex.indexOf("right_")>=0&&!0===e.nodeModel.options.grid["highlightRightText_"+t.dataIndex.split("_")[1]]?e.cellView.elements.container.style.color="red":e.cellView.elements.container.style.color=""}},customizeRows:function(){new n(this,function(){this.update()}.bind(this))},saveAttributeSettings:function(){l.set(this.generateId("attributes_not_shown"),t.encode(this.propsToHide))},_displayMenu:function(e,t){var i=this;require(["DS/Menu/Menu"],n=>{var o=t.getBoundingClientRect(),r={position:{x:o.right,y:o.bottom},layout:"topright",input:i.isTouch?"touch":"mouse"};n.show(e,r)})},handleToolbarCommands:function(e){switch(e.event){case"displayView":this._displayMode!==e.data.mode&&("singleColDisplay"===e.data.mode?this.singleColView=!0:this.singleColView=!1,this.update(),this.standardToolbar.update({displayIcon:[{id:"attrViewSelector",icon:e.data.icon}]}),this._displayMode=e.data.mode)}},onResize:function(){setTimeout(()=>{let e=this.elements&&this.elements.container?this.elements.container.getBoundingClientRect().width:0;if(e<100)return;let t="";t=e>640?"threeColumn":e>=320&&e<=640?"twoColumn":"boolean"==typeof this.compareTwo?!0===this.compareTwo?"oneColumn":"twoColumn":"",this.currentDisplayMode!==t&&(this.currentDisplayMode=t,this.update())},0)},onActivate:function(){this.onResize()}})}),define("DS/CompareWidget2/ViewDefModules/PortfolioViewDefOptions",["UWA/Core","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){"use strict";var i={PHYSICALID:"REF.physicalid",NAME:"REF.name",REVISION:"REF.ds6wg:revision",DERIVEDFROMID:"REF.derivedFromId",VERSIONID:"REF.versionid",REF_LOGID:"REF.logicalid"},n={CV_PROPS:i},o={PROPS:i,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION","BRANCH","DUPE"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ","NEQ","NEQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ","NEQ","NEQ"]],COMP_REF_LOGID:[["REF_LOGID","REF_LOGID"],["EQ","EQ","EQ","NEQ"]],COMP_DERIVEDFROMID:[["DERIVEDFROMID","DERIVEDFROMID"],["EQ","EQ","EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[]},r={SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:t.colorDef.ORANGE,NLS:"LO"},RIGHT_ONLY:{COLOR:t.colorDef.BLUE1,NLS:"RO"},UNRELATED:{COLOR:t.colorDef.BLACK,NLS:"UNRELATED"},DIFFERENT:{COLOR:t.colorDef.BEIGE,NLS:"DIFFERENT"},QUANTITY:{COLOR:t.colorDef.BLUE2,NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"},BRANCH:{COLOR:t.colorDef.GREEN2,NLS:"BRANCHED"},DUPE:{COLOR:t.colorDef.RED,NLS:"DUPLICATED"}},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu",CELL_DRAG_ENABLED_FLAG:!0};return{CV_PROPS:i,STRUCT_FETCH_OPTIONS:n,STRUCT_COMPARE_OPTIONS:o,STRUCT_DISPLAY_OPTIONS:r,ATTRIBUTE_DISPLAY_OPTIONS:{colorLeft:r.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,colorRight:r.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR}}}),define("DS/CompareWidget2/ViewDefModules/PortfolioViewDefs_V2",["DS/CompareWidget2/ViewDefModules/PortfolioViewDefOptions"],function(e){"use strict";var t={AttrFetchPort:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrComparePort:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplayPort:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.ATTRIBUTE_DISPLAY_OPTIONS},StructFetchPort:{Path:"DS/CompareWidget2/plugins/PORTFOLIO/PORTFOLIO_STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS},StructComparePort:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},StructDisplayPort:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{PORTFOLIO_STANDARD:{COL:["PORTFOLIO_STRUCT_VIEW","PORTFOLIO_PROP_VIEW"]}},VIEWDEFS:{PORTFOLIO_PROP_VIEW:["AttrFetchPort","AttrComparePort","AttrDisplayPort"],PORTFOLIO_STRUCT_VIEW:["StructFetchPort","StructComparePort","StructListViewPrep","StructDisplayPort","Exporter"]},PLUGDEFS:t},e)}),define("DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/effectivityComparePanel",["DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/propsComparePanel","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,i){return e.extend({init:function(e,t,i){this._parent(e,t,i)},getLabel:function(){return i.CompareEffectivityPanelTitle},getName:function(){return"EFFECTIVITY_VIEW"},getDomId:function(){return"effectivity"}})}),define("DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/attrComparePanel",["DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/propsComparePanel","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,i){return e.extend({init:function(e,t,i){this._parent(e,t,i)},getLabel:function(){return i.ComparePropertiesPanelTitle},getName:function(){return"PROP_VIEW"},getDomId:function(){return"propattr"}})}),define("DS/CompareWidget2/plugins/ATTRIBUTE/attrCompareObj",["DS/CompareWidget2/support/cw2Utils"],function(e){var t=function(e,t,i){this.visible=e,this.displayName=null==t||""===t?i:t,this.name=i,this.valueLeft="",this.valuesRight=[],this.highlightRight=[],this._reqModforODT="DS/CompareWidget2/plugins/ATTRIBUTE/attrCompareObj"};return t.prototype.setLeftVal=function(e){this.valueLeft=e},t.prototype.setRightVal=function(e,t){this.valuesRight[e]=t},t.prototype.setRightValHighlight=function(e,t){this.highlightRight[e]=t},t}),define("DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/ATTRIBUTE/attrCompareObj","DS/CompareCommon/Utils"],function(e,t,i){return e.extend({execute:function(e,i){this._parent(e,i);var n=function(e){var i={},n=[],o=[],r=[],s=[],a=[],l=[];if(e.length>0)for(var u=0;u<e.length;u++)l.push(e[u].objType);if(l.every((e,t,i)=>e===i[0])){e.forEach((e,t)=>{e.attrVals.forEach((e,a)=>{var l=e.name,u=e.nls,c=e.getFormattedValue();null!=c&&c.constructor==Array&&1==c.length&&(c=c[0]),null==i[l]&&(i[l]=[]),i[l][t]=c,isNaN(e.UIPosition)?r.includes(l)||(r.push(l),s.push(u)):(n[e.UIPosition]=l,o[e.UIPosition]=u)})}),n.push(...r),o.push(...s);for(var c=[],d=n.length,p=0;p<d;p++){var h=n[p],_=o[p];if(null!=h){var f=new t(!0,_,h);c.push(f);var g=(T=i[h])[0];f.setLeftVal(g);for(var m=T.length,S=1;S<m;S++){var C=T[S];this._plugSvcs.csValsEquivalent(g,C)?(f.setRightVal(S-1,g),f.setRightValHighlight(S-1,!1)):(f.setRightVal(S-1,C),f.setRightValHighlight(S-1,!0))}}}return c}for(e.forEach((e,t)=>{if(null!=e.attrVals&&null!=e.attrVals)for(var n=0;n<e.attrVals.length;++n){var o=e.attrVals[n].nls||e.attrVals[n].name;if(null==i[o]&&(i[o]=[],t>0))for(var r=0;r<t;r++)i[o][r]=null;null!=e.attrVals[n].value?i[o][t]=e.attrVals[n].getFormattedValue():i[o][t]=null,-1===a.findIndex(e=>e.attrKey===o)&&a.push({attrNLS:e.attrVals[n].nls||e.attrVals[n].displayName,attrType:e.attrVals[n].type,attrKey:o,attrName:e.attrVals[n].name})}}),c=[],d=a.length,p=0;p<d;p++)if(h=a[p].attrName,_=a[p].attrNLS,null!=h){f=new t(!0,_,h),c.push(f);var T=i[_];for(u=0;u<e.length;u++)void 0!==T[u]&&""!==T[u]||(T[u]=null);for(g=T[0],f.setLeftVal(g),m=T.length,S=1;S<m;S++)C=T[S],this._plugSvcs.csValsEquivalent(g,C)?(f.setRightVal(S-1,g),f.setRightValHighlight(S-1,!1)):(f.setRightVal(S-1,C),f.setRightValHighlight(S-1,!0))}return c}.call(this,e);null!=n?this.reportOK(n):this.reportKO()}})}),define("DS/CompareWidget2/framework/viewSetMgr",["DS/LifecycleServices/LifecycleServicesSettings","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter","DS/CompareWidget2/support/cw2CacheMgr"],function(e,t,i,n){function o(e,t,n){return i.makeAuthHttpsCall("/resources/compare2/SelectViewSet/","POST",n,"json",t,e,n.securityContext)}function r(e){return new Promise(function(i,r){e.getSvcArray();var s=t.stringify(e),a=n.getCacheObj("viewSetCache",s);if(null!=a)i(a);else{(function(e,i,n){return new Promise(function(r,s){var a=t.getCurrentTenant();o(e,a,n).then(function(s){var l=s;t.dbgout("INIT","<><> ---\x3e Eval from service "+e+" is "+JSON.stringify(l)),e==i?r(l):o(i,a,n).then(function(e){var n=e;t.dbgout("INIT","<><> ---\x3e Eval from service "+i+" is "+JSON.stringify(n));var o=null;o=l.eval<n.eval?l:n,t.dbgout("INIT","<><> ---\x3e Best is: "+JSON.stringify(o)),r(o)},function(e){t.dbgout("INIT","<><> ---\x3e using: "+JSON.stringify(l)),r(l)})},function(t){e==i?s("failed to find appropriate viewDef: "+t):fetchViewDefFromService(serviceName2,a,n).then(function(e){r(best2)},function(e){s("failed to find appropriate viewDef on either service... giving up ("+e+")")})})})})(svcName1="3DSpace",svcName1,e).then(function(e){n.putCacheObj("viewSetCache",s,e),i(e)},function(e){t.errout("Failure:: "+e),r(e)})}})}function s(e,i,n,o,r){var s=n.VIEWSETS[i],a={};if(!t.checkViewConfig(s))throw Error("The view set is not properly defined. Please check...");!function(e,i,n){t.getViewDefs(i).forEach(t=>{if(null==e.VIEWDEFS[t])throw Error("extractViewDefs: View def for "+t+" not found");n[t]=e.VIEWDEFS[t]})}(n,s,a);var l=a,u=function(e,i){var n={};return Object.keys(i).forEach(function(o){i[o].forEach(function(i){var o=e.PLUGDEFS[i],r={Path:t.dupeJson(o.Path)};null!=o.Options&&(r.Options=t.dupeJson(o.Options)),n[i]=r})}),n}(n,l);return{RUN_OPTIONS:n.RUN_OPTIONS,viewDefModPath:e,viewSetName:i,VIEWSET:s,VIEWDEFS:l,PLUGDEFS:u,mainToolbarConfigPath:o,mainToolbarOptions:r||[]}}var a=function(){};return a.prototype.loadViewConfig=function(e,i,n,o){return new Promise(function(r,a){require([e],function(a){t.dbgout("INIT","Successfully loaded viewSet '"+i+"' from module '"+e+"'");var l=s(e,i,a,n,o);r(l)},function(i){t.errout("FAILED to load viewDefMod '"+e+"'"),a("LOAD FAILURE")})})},a.prototype.getViewConfig=function(e){var i=this;return new Promise(function(n,o){r(e).then(function(e){let r=e.results[0];var s=r.viewSetMod,a=r.viewSetName,l=r.mainToolbarConfig[0].Location,u=r.mainToolbarConfig[0].DoNotInclude;t.dbgout("INIT","<><> BEST viewSet for usecase is: '"+a+"' from viewDefModule '"+s+"'"),i.loadViewConfig(s,a,l,u).then(function(e){n(e)},function(e){t.errout("Cannot return viewConfigFailure loading fetching viewSet:: "+e),o(e)})},function(e){t.errout("Failure fetching viewSet:: "+e),o(e)})})},a}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/Overview",["UWA/Controls/Abstract","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){function i(e,i,o,r,s,a){for(var l=s,u=r-o,c=0,d=[],p=0;p<i.length;p++){null==a[i[p].flagName]?console.error("ASKING FOR FLAG NAME: "+i[p].flagName+" but is unfound in allflagDefs"):1==a[i[p].flagName].visibleFlag&&(c++,d.push(p))}for(var h=u/c,_=0;_<c;_++){var f=o+_*h,g=f+h,m=i[d[_]].color;null==a||null==a[i[d[_]].flagName]||a[i[d[_]].flagName].visibleFlag||(m=null!=a.IDENTICAL?a.IDENTICAL.color:""),""!==m&&m!=t.colorDef.WHITE&&n(e,m,f,g,l)}}function n(e,t,i,n,o){e.strokeStyle=t,e.beginPath(),e.moveTo(i,o),e.lineTo(n,o),e.stroke()}function o(e,t){let i=t?"list":"tree",n=""!==jQuery("div#compare-"+i+"-right div.compare_tree_list_view div.wux-layouts-header").first().attr("empty");e.setStyle("top",n?"118px":"92px");let o="true"===jQuery("div#compare-"+i+"-right div.compare_tree_list_view div.wux-layouts-gridengine-scroller-container").first().attr("has-overflow-x");e.setStyle("bottom",o?"36px":"17px")}return e.extend({init:function(e){var t=this;t._parent(e),t._gap=5,t._lineLength=23,t._selectedByID={},t._keyList=[],t._allFlagDefs={},t.buildSkeleton()},drawAllLines:function(){var e=this;if(null==e._keyList);else{var o=e._keyList.length,r=10+e._lineLength-12,s=Math.floor(1+.5*e._gap),a=10+e._lineLength-6,l=document.getElementById("compareV2-OverviewCanvas");if(null==l)return;var u=l.getContext("2d");u.clearRect(0,0,l.width,l.height),u.lineWidth=l.height/3>o?2:1;for(var c=0;c<o;c++){var d=e._keyList[c].flagDefArray;1==e._selectedByID[c]?(u.lineWidth++,1!=d.length||""!=d[0].color&&d[0].color!=t.colorDef.WHITE?i(u,d,1,a,s,e._allFlagDefs):n(u,t.colorDef.BLACK,1,a,s),u.lineWidth--):i(u,d,10,r,s,e._allFlagDefs),s+=e._gap}}},doResize:function(){if(null!=jQuery("div#compare-tree-left")[0]){var e=jQuery("div#compareV2-overview-container")[0];o(e,this._isListView);var t=e.clientHeight,i=e.clientWidth,n=jQuery("#compareV2-OverviewCanvas")[0];null!=n&&(n.width=i,n.height=t,0==this._keyList.length||(this._gap=(t-2)/this._keyList.length))}},buildSkeleton:function(){var e=this;e.targetElement=this.elements.container=UWA.createElement("div",{id:"compareV2-overview-container"}),o(e.targetElement,this._isListView),e.rootElement=UWA.createElement("div",{id:"compareV2-overview-toplevel",html:[{tag:"div",id:"compareV2-overview",html:[{tag:"div",id:"compareV2-canvas-buffer",html:[{tag:"canvas",id:"compareV2-OverviewCanvas"}]}]}]}),e.rootElement.inject(e.targetElement),jQuery(document).ready(function(){var t=null,i=!1,n=300;function o(){new Date-t<n?setTimeout(o,n):(i=!1,"none"!==jQuery("#compareV2-overview-container").css("display")&&e._syncIt(!0))}jQuery(window).resize(function(){t=new Date,!1===i&&(i=!0,setTimeout(o,n))})})},onResize:function(){var e=this;setTimeout(function(){e._syncIt(!0)},0)},destroy:function(e){this.rootElement&&(this.rootElement.destroy(),this.rootElement=null),me._selectedByID=null,me._keyList=null,me._allFlagDefs=null},_createSelectedByID:function(e){var t={};return e.forEach(function(e){t[e]=!0}),t},_syncIt:function(e){1==e&&this.doResize(),this.drawAllLines()},syncWithNewData:function(e,t,i,n,o){this._keyList=t,this._allFlagDefs=n,this._selectedByID=this._createSelectedByID(i),this._isListView=o,this._syncIt(e)}})}),define("DS/CompareWidget2/plugins/EXPORT/exManager",["DS/CompareWidgetUtils/CompareExporter","DS/CompareWidget2/plugins/EXPORT/exFormatter","DS/CompareWidget2/userSettings/UserSettingsManager","i18n!DS/CompareWidgetUtils/assets/nls/CompareExport"],function(e,t,i,n){var o=function(e){this._plugSvcs=e,this._exportInProgress=!1,this._exportInProgressDisplayed=!1};return o.prototype._safeGetSettingJSONArray=function(e){var t=[];try{t=JSON.parse(i.get(e))}catch{this._plugSvcs.warnout("Failed to retrieve user setting for "+e+"; returning empty string")}return t},o.prototype.displayExportInProgress=function(){this._exportInProgressDisplayed||(this._exportInProgressDisplayed=!0,this._plugSvcs.showAlertBox(n.CompareExportRunning,null,"warning"))},o.prototype.doExport=function(i,o,r,s,a,l,u){if(this._exportInProgress)this.displayExportInProgress();else{this._exportInProgress=!0;var c={columns:[],tables:[{rows:[]}]},d={structDisplayStyle:r,outputAttributeDifferences:!0};if(!1===s){let e={REF:this._safeGetSettingJSONArray("viewSettings.PROP_VIEW.attributes_not_shown"),INST:this._safeGetSettingJSONArray("viewSettings.INSTANCE_VIEW.attributes_not_shown"),EFF:this._safeGetSettingJSONArray("viewSettings.EFFECTIVITY_VIEW.attributes_not_shown")};var p=t.getHeaderRow(r,i,o,e);c.columns=t.stripHeaderData(p),c.tables[0].rows=t.createOutputTablesNewFormat(r,i,o,u,a,p)}else e.outHeader(d,c.columns),c.tables[0].rows=t.createOutputTables(r,i,o,u,a);if(null==c.tables[0].rows)this._plugSvcs.showAlertBox(n.CompareExportFailure,null,"error");else{var h={csv_base_file_name:n.BaseFilenameExport};switch(l){case"csv":e.generateCsv(c,h);break;case"html":e.printHtml(c,h);break;case"console":e.consoleOutput(c,h)}this._plugSvcs.showAlertBox(n.CompareExportComplete,null,"success",!0)}this._exportReq=null,this._exportInProgress=!1,this._exportInProgressDisplayed=!1}},o}),define("DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/EXPORT/exManager","DS/CompareWidget2/support/tenantServiceContext_IDList"],function(e,t,i){return e.extend({init:function(e,i,n,o){this._parent(e,i,n,o),this.exManager=new t(o),this._propLoadResponders={},this._attrCache={},this._displayMode="unknown",this._useOldExportFormat=!1,this._statusesHidden=!1},onEnabled:function(){var e=this;return e.enableDebugLabel("EXPORT"),e.subscribeEvent("EXECUTE_EXPORT_EVENT",e.handle_EXECUTE_EXPORT_EVENT.bind(e)),e.subscribeEvent("PROPERTIES_LOAD_IN_PROGRESS_EVENT",e.handle_PROPERTIES_LOAD_IN_PROGRESS_EVENT.bind(e)),e.subscribeEvent("PROPERTIES_CACHE_LOADED_EVENT",e.handle_PROPERTIES_CACHE_LOADED_EVENT.bind(e)),e.syncSetting("viewSettings.STRUCT_VIEW.display_mode","_displayMode",null),e.syncSetting("exportSettings.exportOldFormat","_useOldExportFormat",null),e.syncSetting("viewSettings.STRUCT_VIEW.statuses_to_hide","_statusesHidden",null),e._parent()},handle_EXECUTE_EXPORT_EVENT:function(e){this._plugSvcs.dbgout("EXPORT","exporting... "+this._displayMode),this.exManager.displayExportInProgress(),this._sendPropLoadRequest(this._crTreeArray)},handle_PROPERTIES_LOAD_IN_PROGRESS_EVENT:function(e){this._plugSvcs.dbgout("EXPORT","Received load in progress notification for "+e.data.type),this._propLoadResponders[e.data.type]=!0},handle_PROPERTIES_CACHE_LOADED_EVENT:function(e){var t=this;if(1!=t._propLoadResponders[e.data.type])t._plugSvcs.errout("Received unexpected property update from: "+e.data.type);else{t._plugSvcs.dbgout("EXPORT","Received properties cache loaded notification for "+e.data.type),delete t._propLoadResponders[e.data.type];var i=Object.keys(t._propLoadResponders).length;this._attrCache[e.data.type]=e.data.props,0==i?t.exManager.doExport(t._attrCache,t._crTreeArray,t._displayMode,t._useOldExportFormat,t._statusesHidden,"csv",this._pluginOptions):t._plugSvcs.dbgout("EXPORT","Still waiting on responses from: "+i)}},_sendPropLoadRequest:function(e){var t=new i,n=new i,o=new i,r=new i;e[0].visitAll_treeAndFN(0,function(e){var i=e.getMatchInfo(),s=null==i||"IDENTICAL"!=i.getRelName(),a=s?t:n,l=s?o:r;if(0==e.isDummy()){var u=e.getObjIDSpec_REF(),c=e.getObjIDSpec_INST();if("relations"==u.getObjType())return!0;null!=u&&a.addObjIDSpec(u),null!=c&&l.addObjIDSpec(c)}if(null!=i){var d=i.getCompNode();if(null!=d&&0==d.isDummy()){var p=d.getObjIDSpec_REF(),h=d.getObjIDSpec_INST();null!=p&&a.addObjIDSpec(p),null!=h&&l.addObjIDSpec(h)}}return!0}),e[0].visitAll_treeAndFN(1,function(e){if(null==e.getMatchInfo()){var i=e.getObjIDSpec_REF(),n=e.getObjIDSpec_INST();null!=i&&t.addObjIDSpec(i),null!=n&&o.addObjIDSpec(n)}return!0});var s={loadPropIDS_REF:{diff:t,nodiff:n},loadPropIDS_INST:{diff:o,nodiff:r}};this._plugSvcs.postEvent("LOAD_PROPS_FOR_EXPORT",s),t=null,n=null,o=null,r=null,s=null},onDestroy:function(){return this._parent()},execute:function(e,t){try{var i=this;i._parent(e,t),this._crTreeArray=e,i.reportOK(null)}catch(t){i._plugSvcs.dbgout("EXPORT","reports exception:: "+t),i.reportKO(e)}}})}),define("DS/CompareWidget2/ViewDefModules/ProductsViewDefOptions",["UWA/Core","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){"use strict";var i={PHYSICALID:"REF.physicalid",VERSIONID:"REF.versionid",NAME:"REF.name"},n={CV_PROPS:i,CVURL_BY_TYPE:[{name:"DEFAULT",url:"/cvservlet/expand"}],DATA_SOURCE:"CV_SERVICE",DB_FALLBACK:!1,USE_MCS:!1},o={PROPS:i,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION","BRANCH"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","EQ","NEQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[]},r={SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:t.colorDef.ORANGE,NLS:"LO"},RIGHT_ONLY:{COLOR:t.colorDef.BLUE1,NLS:"RO"},UNRELATED:{COLOR:t.colorDef.BLACK,NLS:"UNRELATED"},DIFFERENT:{COLOR:t.colorDef.BEIGE,NLS:"DIFFERENT"},QUANTITY:{COLOR:t.colorDef.BLUE2,NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"},BRANCH:{COLOR:t.colorDef.GREEN2,NLS:"BRANCHED"}},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu",CELL_DRAG_ENABLED_FLAG:!0};return{CV_PROPS:i,STRUCT_FETCH_OPTIONS:n,STRUCT_COMPARE_OPTIONS:o,STRUCT_DISPLAY_OPTIONS:r,ATTRIBUTE_DISPLAY_OPTIONS:{colorLeft:r.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,colorRight:r.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR}}}),define("DS/CompareWidget2/ViewDefModules/ProductsViewDefs_V2",["DS/CompareWidget2/ViewDefModules/ProductsViewDefOptions"],function(e){"use strict";var t={AttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.ATTRIBUTE_DISPLAY_OPTIONS},StructFetch:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS},StructCompare:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},StructDisplay:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{PRODUCTS_PROPS_AND_STRUCT:{COL:["PRODUCTS_STRUCT_VIEW","PRODUCTS_PROP_VIEW"]},PRODUCTS_PROPS_ONLY:{ROW:"PRODUCTS_PROP_VIEW"},PRODUCTS_STRUCT_ONLY:{ROW:"PRODUCTS_STRUCT_VIEW"}},VIEWDEFS:{PRODUCTS_PROP_VIEW:["AttrFetch","AttrCompare","AttrDisplay"],PRODUCTS_STRUCT_VIEW:["StructFetch","StructCompare","StructListViewPrep","StructDisplay","Exporter"]},PLUGDEFS:t},e)}),define("DS/CompareWidget2/framework/useCase",["DS/CompareWidget2/support/cw2Utils"],function(e){"use strict";var t=function(e,t,i){this.app=e,this.roles=t,this.typeInfoArray=i.map(e=>({type:e.getObjType(),service:e.getServiceName(),interfaces:e.getInterfaces()}));var n=i[0].getSecurityContext();Object.defineProperty(this,"securityContext",{enumerable:!1,get:()=>n})};return t.prototype.getApp=function(){return this.app},t.prototype.getRoles=function(){return this.roles},t.prototype.getSvcArray=function(){return this.typeInfoArray.map(e=>e.service)},t.prototype.getTypeArray=function(){return this.typeInfoArray.map(e=>e.type)},t.prototype.getSvcTypeArray=function(){return this.typeInfoArray.map(e=>e.service+e.type)},t.prototype.equals=function(t){return e.stringify(this)==e.stringify(t)},t.prototype.stringify=function(){return e.stringify(this)},t}),define("DS/CompareWidget2/framework/svcNode",["DS/CompareWidget2/support/cw2Utils","DS/CompareCommon/Cycle"],function(e,t){function i(t){var i=this,n=i.getName();e.dbgout("@@@@ SERVICE NODE "+n+" notified of input object update...");var o=t.obj,r=null==o?"[NO OBJ]":e.stringify(o).substr(0,100)+" ...";e.dbgout("@@@@ ++++++++++++++++++++  RUNNING  PLUGIN  +++++++++++++++++++++++++"),e.dbgout("@@@@ ++ PLUGIN: "+n),e.dbgout("@@@@ ++    OBJ: "+r),e.dbgout("@@@@ ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++");try{if(widget.recordForODT){let e=this.getName(),t=null==o?"null":JSON.stringify(JSON.decycle(o)),i=null==this._pluginOptions?"null":JSON.stringify(JSON.decycle(this._pluginOptions));console.log("COMPARE PLUGIN EXECUTE: "+e),console.log("[CV2ODT] "+e+" INSTRING: "+t),console.log("[CV2ODT] "+e+" INOPTIONS: "+i)}0==i.isEnabled()?(null!=i._deferredObjIn?e.dbgout("PROC_CONTROL"," svcNode '"+i.getName()+"' is DISABLED, and is UPDATING to a NEW DEFERRED OBJ"):e.dbgout("PROC_CONTROL"," svcNode '"+i.getName()+"' is DISABLED, and is deferring processing of an object"),i._deferredObjIn=o):(e.dbgout("PROC_CONTROL"," svcNode '"+i.getName()+"' is ENABLED and processing"),i._plugin.execute(o,i._pluginOptions))}catch(t){e.errout("EXCEPTION in Plugin '"+i.getName()+"'.execute(): "+t.stack)}}var n=function(t,i,n,o,r,s){e.dbgout("INIT","Creating svcNode for plugin: "+i),this._name=t,this._pluginOptions=n,this._plugin=o,this._plugSvcs=r,this._eventMgr=s,this._subscribedTokens={},this._plugin.setOutputFn(this.updateOutput.bind(this)),this._outputEventName=this._name+i+".updated",this._outputObj={},"DISPLAY_PLUGIN"==this._plugin._type&&this._subscribe("Event_clearView",this._handler_clearView),this._viewName=null,this._deferredObjIn=null,this._network={upstream:{},downstream:{}}};return n.prototype.destroy=function(){this._name=null,this._pluginOptions=null,null!=this._plugin&&(this._plugin.disconnect(),this._plugin=null),this._pluginService=null,this._unsubscribeAll(),this._eventMgr=null,this._outputEventName=null,null!=this._outputObj&&("function"==typeof this._outputObj.destroy&&this._outputObj.destroy(),this._outputObj=null),null!=this._viewName&&(this._viewName=null),this._network.upstream={},this._network.downstream={}},n.prototype.setViewName=function(e){this._viewName=e},n.prototype.getViewName=function(){return this._viewName},n.prototype.getPluginType=function(){return this._plugin.getType()},n.prototype.updateOutput=function(e){if(this._outputObj=e,widget.recordForODT){let e=this.getName(),t=null==this._outputObj?"null":JSON.stringify(JSON.decycle(this._outputObj));console.log("COMPARE PLUGIN OUTPUT: "+e),console.log("[CV2ODT] "+e+" OUTSTRING: "+t)}this._eventMgr.publish({event:this._outputEventName,data:{eventName:this._outputEventName,obj:this._outputObj}})},n.prototype.getOutputEventName=function(){return this._outputEventName},n.prototype.subscribeToInputEvent=function(e){this._subscribe(e,i)},n.prototype._subscribe=function(t,i){if(null==this._subscribedTokens[t]){e.dbgout("INIT","SvcNode '"+this._name+"' will now listen to update event '"+t+"'");var n=this._eventMgr.subscribe({event:t},i.bind(this));this._subscribedTokens[t]=n}else e.dbgout("INIT","SvcNode '"+this._name+"' already listens to event '"+t+"'; ignoring (this is OK)...")},n.prototype._unsubscribeAll=function(){var e=this;Object.keys(e._subscribedTokens).forEach(function(t){var i=e._subscribedTokens[t];e._eventMgr.unsubscribe(i)}),this._subscribedTokens={}},n.prototype._handler_clearView=function(){1==this.isEnabled()&&this._plugin.onClearView()},n.prototype.refresh=function(){1==this.isEnabled()&&this.updateOutput(this._outputObj)},n.prototype.isEnabled=function(){return this._plugin.isEnabled()},n.prototype.enable=function(){var t=null;if(1==this.isEnabled())t=!0;else if(e.dbgout("PROC_CONTROL"," svcNode '"+this.getName()+"' is being turned ON"),1==(t=this._plugin.enable())){if(null!=this._deferredObjIn){e.dbgout("PROC_CONTROL"," svcNode '"+this.getName()+"' has deferred input object, and is now processing it...");var i=this._deferredObjIn;this._deferredObjIn=null,this._plugin.execute(i,this._pluginOptions)}this._notifyEnabledStateChange()}return t},n.prototype.disable=function(){1==this.isEnabled()&&(e.dbgout("PROC_CONTROL"," svcNode '"+this.getName()+"' is being turned OFF"),this._plugin.disable(),this._notifyEnabledStateChange())},n.prototype._notifyEnabledStateChange=function(){var e=this;null!=e._network.upstream&&Object.keys(e._network.upstream).forEach(function(t){e._network.upstream[t]._updateEnabledState()})},n.prototype._updateEnabledState=function(){var t=this;e.dbgout("PROC_CONTROL"," svcNode '"+this.getName()+"' is evaluating its enabled state (because a downstream svcNode changed its enabled state)");var i="disabled";if(null==t._network.downstream)i="enabled";else{var n=!1;Object.keys(t._network.downstream).forEach(function(e){t._network.downstream[e].isEnabled()&&(n=!0)}),n&&(i="enabled")}"enabled"==i&&0==t.isEnabled()?t.enable():"disabled"==i&&1==t.isEnabled()&&t.disable()},n.prototype.getViewPanel=function(){var e=null;return"DISPLAY_PLUGIN"==this._plugin.getType()&&(e=this._plugin.getViewPanel()),e},n.prototype.addUpstreamNode=function(e){this._network.upstream[e.getName()]=e},n.prototype.addDownstreamNode=function(e){this._network.downstream[e.getName()]=e},n.prototype.buildViewPanel=function(t,i){null==this._viewName?e.warnout("buildViewPanel called on svcNode with no view"):this._plugin.buildViewPanel(this._viewName,this._pluginOptions,t,i)},n.prototype.getName=function(){return this._name},n.prototype._debug_dump=function(){},n}),define("DS/CompareWidget2/ViewDefModules/RequirementSpecViewDefOptions",["UWA/Core","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){"use strict";var i={PHYSICALID:"REF.physicalid",VERSIONID:"REF.versionid",NAME:"REF.name"},n={CV_PROPS:i,CVURL_BY_TYPE:[{name:"DEFAULT",url:"/cvservlet/expand"}],DATA_SOURCE:"CV_DIRECT",DB_FALLBACK:!1,COMMAND_CONTEXT:"compare",USE_MCS:!1},o={PROPS:i,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","EQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[]},r={SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:t.colorDef.ORANGE,NLS:"LO"},RIGHT_ONLY:{COLOR:t.colorDef.BLUE1,NLS:"RO"},UNRELATED:{COLOR:t.colorDef.BLACK,NLS:"UNRELATED"},DIFFERENT:{COLOR:t.colorDef.BEIGE,NLS:"DIFFERENT"},QUANTITY:{COLOR:t.colorDef.BLUE2,NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"},REPLACED:{COLOR:t.colorDef.PINK,NLS:"REPLACED"}},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu",CELL_DRAG_ENABLED_FLAG:!0};return{RUN_OPTIONS:{customCompareActive:!0},CV_PROPS:i,STRUCT_FETCH_OPTIONS_REQ:n,STRUCT_COMPARE_OPTIONS_REQ:o,STRUCT_DISPLAY_OPTIONS_REQ:r,ATTRIBUTE_DISPLAY_OPTIONS:{colorLeft:r.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,colorRight:r.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR}}}),define("DS/CompareWidget2/ViewDefModules/RequirementSpecViewDef",["DS/CompareWidget2/ViewDefModules/RequirementSpecViewDefOptions"],function(e){"use strict";var t={AttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.ATTRIBUTE_DISPLAY_OPTIONS},StructFetchReq:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS_REQ},StructCompareReq:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS_REQ},StructDisplayReq:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS_REQ},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{STANDARD_REQ:{COL:["STRUCT_VIEW_REQ","PROP_VIEW"]},PROPS_ONLY:{ROW:"PROP_VIEW"},STRUCT_ONLY_REQ:{ROW:"STRUCT_VIEW_REQ"}},VIEWDEFS:{PROP_VIEW:["AttrFetch","AttrCompare","AttrDisplay"],STRUCT_VIEW_REQ:["StructFetchReq","StructCompareReq","StructListViewPrep","StructDisplayReq","Exporter"]},PLUGDEFS:t},e)}),define("DS/CompareWidget2/ViewDefModules/PartViewDefOptions",["UWA/Core","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){"use strict";var i={PHYSICALID:"REF.physicalid",VERSIONID:"REF.ds6wg:revision",NAME:"REF.name",DFR:"REF.dfr",XFORM:"INST.matrixtxt"},n={CV_PROPS:i,CVURL_BY_TYPE:[{name:"DEFAULT",url:"/cvservlet/expand"}],DATA_SOURCE:"CV_SERVICE",DB_FALLBACK:!1},o={PROPS:i,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","NEQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[{NAME:"MOVED",PROPS:["XFORM","XFORM"],FLAG_ON:"NEQ",MATCH_ADJ:-1}]},r={SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:t.colorDef.ORANGE,NLS:"LO"},RIGHT_ONLY:{COLOR:t.colorDef.BLUE1,NLS:"RO"},UNRELATED:{COLOR:t.colorDef.BLACK,NLS:"UNRELATED"},DIFFERENT:{COLOR:t.colorDef.BEIGE,NLS:"DIFFERENT"},QUANTITY:{COLOR:t.colorDef.BLUE2,NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"},BRANCH:{COLOR:t.colorDef.GREEN2,NLS:"BRANCHED"},DUPE:{COLOR:t.colorDef.RED,NLS:"DUPLICATED"},REPLACED:{COLOR:t.colorDef.PINK,NLS:"REPLACED"}},CUSTOM_MATCH_ADJ_FLAGS:{MOVED:{COLOR:t.colorDef.YELLOW,NLS:"MOVED"}},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu",CELL_DRAG_ENABLED_FLAG:!0},s={colorLeft:r.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,colorRight:r.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR};return{CV_PROPS:i,ATTRIBUTE_DISPLAY_OPTIONS:s,INST_ATTR_FETCH_OPTIONS:{isInstance:!0},INST_ATTR_DISPLAY_OPTIONS:{isInstance:!0,colorLeft:s.colorLeft,colorRight:s.colorRight},STRUCT_FETCH_OPTIONS:n,STRUCT_COMPARE_OPTIONS:o,STRUCT_DISPLAY_OPTIONS:r}}),define("DS/CompareWidget2/ViewDefModules/PartViewDefs_V2",["DS/CompareWidget2/ViewDefModules/PartViewDefOptions"],function(e){"use strict";var t={AttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.ATTRIBUTE_DISPLAY_OPTIONS},InstAttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin",Options:e.INST_ATTR_FETCH_OPTIONS},InstAttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},InstAttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.INST_ATTR_DISPLAY_OPTIONS},View3DDisplay:{Path:"DS/CompareWidget2/plugins/VIEW3D/VIEW3D_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},View3DPrep:{Path:"DS/CompareWidget2/plugins/VIEW3D/VIEW3D_PREP_plugin"},StructFetch:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS},StructCompare:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},StructDisplay:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{STANDARD:{ROW:["STRUCT_VIEW",{COL:[["PROP_VIEW","INSTANCE_VIEW"],"PAD3D_VIEW"]}]},PROPS_ONLY:{ROW:"PROP_VIEW"},STRUCT_ONLY:{ROW:"STRUCT_VIEW"},PAD3D_ONLY:{ROW:"PAD3D_VIEW"},PROPS_AND_STRUCT:{COL:["STRUCT_VIEW","PROP_VIEW"]}},VIEWDEFS:{PROP_VIEW:["AttrFetch","AttrCompare","AttrDisplay"],INSTANCE_VIEW:["InstAttrFetch","InstAttrCompare","InstAttrDisplay"],STRUCT_VIEW:["StructFetch","StructCompare","StructListViewPrep","StructDisplay","Exporter"],PAD3D_VIEW:["StructFetch","View3DPrep","View3DDisplay"]},PLUGDEFS:t},e)}),define("DS/CompareWidget2/framework/svcNodeNet",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/framework/svcNode"],function(e,t){var i=function(e,t){this._eventMgr=t,this._plugSvcs=e,this._inputEventName="DEFAULT_INPUT",this._svcNodeSet={},this._viewSvcNodeArray=[],this._viewSvcNodeByView=null,this._lastObjSent=null,this._subscribeTokens={},this._beginTimeMS=0,this._waitingCount=0,this._subscribeTokens.VIEW_CLOSED=this._eventMgr.subscribe({event:"VIEW_CLOSED"},this._handleViewClosed.bind(this)),this._subscribeTokens.VIEW_OPENED=this._eventMgr.subscribe({event:"VIEW_OPENED"},this._handleViewOpened.bind(this))};return i.prototype.getSvcNodeForView=function(e){var t=null,i=this;return null==i._viewSvcNodeByView&&(i._viewSvcNodeByView={},i._viewSvcNodeArray.forEach(function(e){var t=e.getViewPanel();if(null!=t){var n=e.getName();i._viewSvcNodeByView[n]=t}})),Object.keys(this._viewSvcNodeByView).forEach(function(n){i._viewSvcNodeByView[n]!==e||(t=i._svcNodeSet[n])}),t},i.prototype._handleViewClosed=function(t){e.dbgout("svcNodeNetwork is handling frameMinimized..."),this.getSvcNodeForView(t.view).disable()},i.prototype._handleViewOpened=function(t){e.dbgout("svcNodeNetwork is handling frameRestored..."),this.getSvcNodeForView(t.view).enable()},i.prototype.destroy=function(){var e=this;e._unsubscribeAllEvents(),e._eventMgr=null,e._plugSvcs=null,Object.keys(e._svcNodeSet).forEach(function(t){e._svcNodeSet[t].destroy()}),e._svcNodeSet=null,e._viewSvcNodeArray=[]},i.prototype.updateInput=function(t){this._beginTimeMS=this._plugSvcs.nowMS(),this._waitingCount=Object.keys(this._subscribeTokens).length,e.dbgout("---------------------------------------------------------------------"),e.dbgout("------------[ P R O C E S S I N G    I D S   B E G I N  ] -----------"),e.dbgout("---------------------------------------------------------------------"),e.dbgout("svcNodeNet updating input... raising event '"+this._inputEventName+"'"),this._lastObjSent=t,this._eventMgr.publish({event:this._inputEventName,data:{eventName:this._inputEventName,obj:t}})},i.prototype.buildViewPanels=function(t,i){e.dbgout("INIT","------------[ B U I L D   V I E W S   B E G I N ] -----------");var n=this._plugSvcs.nowMS();this._viewSvcNodeArray.forEach(function(n){e.dbgout("INIT","Building view: "+n.getViewName()),n.buildViewPanel(t,i)}),this._plugSvcs.reportTime(n," views built"),e.dbgout("INIT","------------[ B U I L D   V I E W S   E N D     ] -----------")},i.prototype.build=function(i){var n=this;e.dbgout("INIT","------------[ C R E A T E   S v c   N o d e   N E T W O R K   B E G I N ] -----------");var o=n._plugSvcs.nowMS(),r=i.PLUGSLOADED,s=i.PLUGDEFS;Object.keys(s).forEach(function(e){var i=s[e],o=i.Path,a=i.Options,l=r[e],u=new t(e,o,a,l,n._plugSvcs,n._eventMgr);n._svcNodeSet[e]=u});i.VIEWSET;var a=i.VIEWDEFS;Object.keys(a).forEach(function(e){var t=a[e],i=t[0],o=n._svcNodeSet[i];o.subscribeToInputEvent(n._inputEventName);for(var r=o,s=t.length,l=1;l<s;l++){var u=t[l],c=n._svcNodeSet[u];r.addDownstreamNode(c),c.addUpstreamNode(r);var d=r.getOutputEventName();c.subscribeToInputEvent(d),r=c}var p=r.getOutputEventName();n._addToFinishedEventList(p)}),Object.keys(a).forEach(function(e){for(var t=a[e],i=0;i<t.length;i++){var o=t[i],r=n._svcNodeSet[o];"DISPLAY_PLUGIN"==r.getPluginType()&&(r.setViewName(e),n._viewSvcNodeArray.push(r))}}),n._plugSvcs.reportTime(o," svcNodeNet built"),e.dbgout("INIT","------------[ C R E A T E   S v c   N o d e   N E T W O R K   E N D ] -----------")},i.prototype.enableAll=function(){var t=this._setNetEnable(!0);return 0==t&&e.errout("There was a problem enabling the service nodes"),t},i.prototype.disableAll=function(){return this._setNetEnable(!1)},i.prototype._setNetEnable=function(e){var t=this,i=!1;return Object.keys(t._svcNodeSet).forEach(function(n){var o=t._svcNodeSet[n];i|=1==e?o.enable():o.disable()}),i},i.prototype._handleFinishedEvent=function(){this._waitingCount>0&&(this._waitingCount--,0==this._waitingCount&&(e.dbgout("---------------------------------------------------------------------"),e.dbgout("------------- [ P R O C E S S I N G    I D S   E N D  ] -------------"),e.dbgout("---------------------------------------------------------------------"),e.reportTime(this._beginTimeMS," svcNodeNetwork completes; async ops may still be processing")))},i.prototype._addToFinishedEventList=function(e){this._subscribeTokens[e]=this._eventMgr.subscribe({event:e},this._handleFinishedEvent.bind(this))},i.prototype._unsubscribeAllEvents=function(){var e=this;Object.keys(e._subscribeTokens).forEach(function(t){var i=e._subscribeTokens[t];e._eventMgr.unsubscribe(i)}),e._subscribeTokens={}},i}),define("DS/CompareWidget2/framework/pluginServices",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter","DS/CompareCommon/Utils","DS/CompareWidget2/userSettings/UserSettingsManager","DS/LifecycleServices/LifecycleServicesSettings"],function(e,t,i,n,o){return function(r,s){this._viewPanelMgr=r,this._eventMgr=s,this.makeAuthHttpsCall=function(e,i,n,o,r,s,a){return t.makeAuthHttpsCall(e,i,n,o,r,s,a)},this.loadPref=function(e,i){return t.loadPref(e,i)},this.savePref=function(e,i){return t.savePref(e,i)},this.subscribe=function(e,t){return this._eventMgr.subscribe({event:e},t)},this.unsubscribe=function(e){return this._eventMgr.unsubscribe(e)},this.postEvent=function(e,t){var i=t||{},n=i.isAsync,o=i.catchExceptions;if(widget.recordForODT){let t=null==i?"null":JSON.stringify(JSON.decycle(i));console.log("COMPARE EVENT INPUT: "+e),console.log(e+" DATA: "+t)}this._eventMgr.publish({event:e,data:null==t?null:t,propagate:!0,target:this,isAsync:n,catchExceptions:o})},this.requestFrame=function(e){return this._viewPanelMgr.requestFrame(e)},this.addPanel=function(e,t,i,n,o){return this._viewPanelMgr.addPanel(e,t,i,n,o)},this.makeServiceURL=function(e,t,i,n){return"https:"===i.substring(0,6)?i:o.getPlatformWSUrl(e,t,i,n)},this.createRandomString=function(t,i,n){return e.createRandomString(t,i,n)},this.dbgout=function(t,i){e.dbgout2(!0,t,i)},this.warnout=function(t){e.warnout("[PLUGIN] "+t)},this.errout=function(t){e.errout("[PLUGIN] "+t)},this.enableDebugLabel=function(t){e.enableDebugLabel(t)},this.disableDebugLabel=function(t){e.disableDebugLabel(t)},this.showAlertBox=function(e,t,n,o){return i.showAlertBox(e,t,n,o)},this.confirmDialog=function(e,t,n){return i.confirmDialog(e,"fonticon-attention",t,n)},this.nowMS=function(){return e.nowMS()},this.reportTime=function(t,i){e.reportTime(t,"[PLUGIN]"+i)},this.csValsEquivalent=function(t,i){return e.csValsEquivalent(t,i)},this.getUserSetting=function(e){var t=null;try{t=JSON.parse(n.get(e))}catch{this._plugSvcs.warnout("Failed to retrieve user setting for "+e+"; returning empty string")}return t}}}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/Trees",["UWA/Controls/Abstract","UWA/Core","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/CompareWidget2/widget/controls/TreesContainer","DS/CompareWidget2/widget/controls/TreePanel"],function(e,t,i,n,o,r,s){"use strict";return e.extend({init:function(e){this.dataGridConfigArray=e.dataGridConfigArray,this._parent({}),this.onSelectRow=e.onSelectRow,this.onUnselectRow=e.onUnselectRow,this.cols=e.cols,this._eachGridColorColumns=[];let t=this;this._currentlySelectedRowIDs=[],this.treeContainers=[],this.onContextMenu=e.onContextMenu,this.rowSelection=e.rowSelection,this.cellDragEnabledFlag=e.cellDragEnabledFlag,this.dataGridConfigArray.forEach((e,i)=>{var n=e.cols.find(e=>"tree"===e.dataIndex),o=n.onCellRequest;n.onCellRequest=(e=>{t.onCellRequest(e,t.dataGridViews[i]),"function"==typeof o&&o(e)})}),this.onScroll=e.onScroll,this.onExpand=e.onExpand,this.onCollapse=e.onCollapse,this.onPreExpand=e.onPreExpand,this.onPreCollapse=e.onPreCollapse,this.treeContainers=[],this.treePanels=[],this.treesContainer=new r,e.dataGridConfigArray.forEach(function(e,i){var n=e.gridViewContainerParams,o=new s({caption:n.panelCaption,addClass:n.panelAddClass,contentId:n.id,contentBorderTop:n.styles["border-top"],collapseable:n.panelCollapseable,initSize50pct:!!n.initSize50pct&&n.initSize50pct,colorIndicator:e.colorIndicator});t.treePanels.push(o),t.treeContainers.push(o.elements.content),t.treesContainer.addPanel(o)}),this.elements.container=this.treesContainer.elements.container},show:function(){this.getContent().style.display="flex"},restorePreviousSelection:function(){var e=this,t=this.getNTHGridSelectedNodes(0);this.clearNTHGridSelection(0);var i=!1;if(t.forEach(t=>{var n=t._rowID,o=e.dataGridViews[0].model.find(e=>e._rowID===n&&e.isVisible());o&&(o.select(),i=!0)}),!i){var n=e.dataGridViews[0].model.find(e=>e.isVisible());n&&n.select()}},onDataGridViewsReady:function(e){let t=this;this.dataGridViews.forEach(e=>{t.syncScrolling(e),t.syncExpandCollapse(e.getTreeDocument()),t.subscribeForTreeSync(e)}),e()},clear:function(){this.treeContainers.forEach(e=>e.empty())},update:function(e,n,r,s){this.clear();var a=this;Array.isArray(this.dataGridViews)&&this.dataGridViews.length&&this.dataGridViews.forEach(e=>e.destroy()),Array.isArray(this.dataGridViews)&&this.dataGridViews.length&&this.dataGridViews.forEach(e=>e.destroy()),this.dataGridViews=[],this.dataGridConfigArray.forEach((e,n)=>{var s=t.createElement("div",{class:"compare_tree_list_view"});s.inject(a.treeContainers[n]),e.cols.forEach(function(e){var t=e.text;if(null!=t){var i=r[t];null!=i&&(e.text=i)}});var l=new o({enableListSelection:!0,columnDragEnabledFlag:!1,treeDocument:new i({}),columns:a._eachGridColorColumns[n].concat(e.cols),cellDragEnabledFlag:a.cellDragEnabledFlag,defaultColumnDef:{minWidth:8.5},layoutOptions:{rowsHeader:0===n},rowSelection:a.rowSelection,selectionBehavior:{unselectAllOnEmptyArea:!1,selectOnContextualEvent:!0},onContextualEvent:function(e){return new Promise(function(t){a.onContextMenu(e).then(function(e){t(e)})})}});l.onDragStartCell=function(e,t){this.draggingFromCompare=!0;var i=[],n=t.nodeModel._options.data,o=n._attrList,r=n.getDBContext();if(!n.isDraggable())return e.preventDefault(),!1;var s=n.getPath().split("/").map(function(e){return{resourceid:e}});i.push({contextId:r.securityContext,envId:r.tenant,objectId:o.physicalID_REF,objectType:o.type,path:s,serviceId:r.serviceName});var a={protocol:"3DXContent",version:"1.1",source:"ENOCOMP_AP",widgetId:widget.id,data:{items:i}};return e.dataTransfer.setData("Text",JSON.stringify(a)),!0},l.onDragOverCell=function(e,t){return!0},l.onDragEndCell=function(e,t){return this.draggingFromCompare=!1,!0},a.dataGridViews.push(l),l.inject(s)}),Promise.all(this.dataGridViews.map(e=>new Promise(t=>e.onPostUpdateViewOnce(()=>t())))).then(()=>a.onDataGridViewsReady(s)),this.withUpdateLocked(function(){a.dataGridViews.forEach((t,i)=>{a.buildDataGridView(t,e[i],i,n),t.getTreeDocument().getRoots()[0].select()}),"function"==typeof a.onSelectRow&&a.onSelectRow()})},buildDataGridView:function(e,t,i,n){t.constructor!=Array&&(t=[t]),e.getNodesXSO().empty(),e.getTreeDocument().empty();var o=this;this.dbgcnt=0,this.asRoot=0,this.asChild=0;var r=e.getTreeDocument();r.withTransactionUpdate(function(){t.forEach(function(e){o.asRoot++,o.crNode2tNode(e,r,i)})}),e.elements.container.style.top="4px",e.layout.columnsHeader=n,e.layout.rowsHeader=!1,e.cellSelection="none",e.showCellActivationFlag=!1,e.selected=[]},crNode2tNode:function(e,t,i){this.dbgcnt++;var o=this,r=null;if("function"!=typeof o.dataGridConfigArray[i].createTreeNodeConfig)throw Error("Trees:crNode2tNode - createTreeNodeConfig not defined");if(r=new n(o.dataGridConfigArray[i].createTreeNodeConfig(e)),null==t)throw new Error("crNode2tNode: Parent node is null");t.addChild(r),e.__TREENODE__=r,e.getMatchInfo().addTreeNode(r);let s=e.getChildArray();r.setState({state:Array.isArray(s)&&s.length?"expanded":"noChildren"}),e.setExpandCollapseState(r.getState()),Array.isArray(s)&&s.length&&s.forEach(function(e){o.asChild++,o.crNode2tNode(e,r,i)})},hasNextNonEmptyBrother:function(e){for(var t=!1,i=e.getNextBrother();null!=i&&!(t=""!=i.getLabel());)i=i.getNextBrother();return t},hideParentLinks:function(e,t,i){},drawDiffFlags:function(e,i){var n=i.cellView.elements.tags;if(null==n){n=t.createElement("div",{styles:{display:"flex",width:5*this._maxFlagsPerDiff+"px"}});var o=i.cellView.elements.container;o.insertBefore(n,o.children[0]),i.cellView.elements.tags=n}n.innerHTML="";for(var r=0;r<e.length;r++){var s=e[r];t.createElement("span",{styles:{width:"5px",background:s.COLOR}}).inject(n)}},drawLinks:function(e,t){var i=this.hasNextNonEmptyBrother(e.nodeModel),n=e.cellView.elements.linksContainer.getChildren()[0];if(null!=n){var o=n.getChildren();if(!i){var r=o[o.length-1];null==e.nodeModel.getLabel()?r.setStyle("visibility","hidden"):r.setStyle("height","50%")}this.hideParentLinks(e.nodeModel,o,1)}null==e.nodeModel.getLabel()?e.cellView.elements.expanderContainer.hide():(e.cellView.elements.expanderContainer.show(),e.cellView.elements.expanderContainer.setStyle("visibility","visible"),e.cellView.elements.linksContainer.setStyle("visibility","visible"))},onCellRequest:function(e,t){t.defaultOnCellRequest(e),this.drawLinks(e,t)},isScrollbarShown:function(){if(null!=this.dataGridViews){var e=this.dataGridViews[0].elements,t=this.dataGridViews[1].elements;return e.poolContainer.clientHeight>e.container.clientHeight&&t.poolContainer.clientHeight>t.container.clientHeight}return!1},syncExpandCollapse:function(e){function t(t,i){var n=this;return o=>{if(null!=o.data.virtualRowID){for(var r=n.dataGridViews.reduce((t,i)=>i.getTreeDocument()!==e?(t.push(i),t):t,[]),s=0;s<r.length;++s){var a=r[s];if(null!=a){if(!0===a._isSyncing)return;a._isSyncing=!0;let e=a.model.find(({_rowID:e})=>e===o.data.virtualRowID);null==e||void 0===e[t]||null===e[t]?console.log("expandOrCollapse failure"):e[t](),a._isSyncing=!1}}"function"==typeof n[i]&&n[i](o.data)}}}var i=this;e.onPostExpand(t.bind(this)("expand","onExpand")),e.onPostCollapse(t.bind(this)("collapse","onCollapse")),e.onPreExpand(function(e){i.onPreExpand(e.data)}),e.onPreCollapse(function(e){i.onPreCollapse(e.data)})},syncScrolling:function(e){var t=this,i=t.dataGridViews.reduce((t,i)=>i!==e?(t.push(i),t):t,[]),n=e._getScroller();n.onScrollBegin(i=>{t._activeScrollingGrid||(t._activeScrollingGrid=e)}),n.onScroll(n=>{t._activeScrollingGrid===e&&setTimeout(()=>{var n=e.getScrollerPosition();i.forEach(e=>e.setScrollerPosition(n)),"function"==typeof t.onScroll&&t.onScroll(n,e)},0)}),n.onScrollEnd(i=>{t._activeScrollingGrid===e&&(t._activeScrollingGrid=null)})},selectByCrNodes:function(e){var t=this;t.withUpdateLocked(()=>{e.forEach((e,i)=>{for(var n=e.__TREENODE__;null!=n&&!n._isVisible();)n=n.getParent();var o=n._getRowID();t.dataGridViews.forEach((e,t)=>{var n=e.model.find(({_rowID:e})=>e===o);if(null!=n&&!n.isSelected()){0===i&&0===t&&e.ensureNodeModelVisible(n,!0,!1,.5),e.selectNodeModel(n,!0,!1)}})})})},subscribeForTreeSync:function(e){var t=this;e.getTreeDocument().subscribe({event:"select"},function(i){var n=i.data.nodeModel._getRowID();t.dataGridViews.reduce((t,i)=>i!==e?(t.push(i),t):t,[]).forEach(e=>{var t=e.model.find(({_rowID:e})=>e===n);null==t||t.isSelected()||e.selectNodeModel(t,!0,!1)}),-1===t._currentlySelectedRowIDs.indexOf(n)&&(t._currentlySelectedRowIDs.push(n),"function"==typeof t.onSelectRow&&t.onSelectRow())}),e.getTreeDocument().subscribe({event:"unselect"},function(i){var n=i.data.nodeModel._getRowID(),o=t.dataGridViews.reduce((t,i)=>i!==e?(t.push(i),t):t,[]),r=!1;o.forEach(e=>{var t=e.model.find(({_rowID:e})=>e===n);null!=t&&t.isSelected()&&(r=!0,e.unselectNodeModel(t))}),1==r&&-1!==t._currentlySelectedRowIDs.indexOf(n)&&(t._currentlySelectedRowIDs.splice(t._currentlySelectedRowIDs.indexOf(n),1),"function"==typeof t.onUnselectRow&&t.onUnselectRow())})},prepareUpdateView:function(){this.dataGridViews.forEach(e=>e.prepareUpdateView())},pushUpdateView:function(){this.dataGridViews.forEach(e=>e.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0))},withUpdateLocked:function(e){this.prepareUpdateView(),e(),this.pushUpdateView()},setEachGridColorColumns:function(e){this._eachGridColorColumns=e},getNTHGridSelectedNodes:function(e){return this.dataGridViews[e].getNodesXSO().get()},getNTHGrid:function(e){return this.dataGridViews[e]},clearNTHGridSelection:function(e){this.dataGridViews[e].getNodesXSO().empty()},setPanelCaption:function(e,t){this.treesContainer.setPanelCaption(e,t)},destroy:function(){Array.isArray(this.dataGridViews)&&this.dataGridViews.length&&(this.dataGridViews.forEach(e=>e.destroy()),this.dataGridViews=[]),this.clear()},applyFilterModelToTrees:function(e){let i=this,n=!t.equals(e,i.dataGridViews[0].getTreeDocument().getFilterManager().filterModel);this.withUpdateLocked(()=>{i.dataGridViews.forEach(i=>{n?i.getTreeDocument().setFilterModel(t.clone(e,!0)):i.getTreeDocument().reapplyFilterModel()})})}})}),define("DS/CompareWidget2/ViewDefModules/CATProductViewDefOptions",["UWA/Core","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){"use strict";var i={PHYSICALID:"REF.physicalid",VERSIONID:"REF.versionid",REF_LOGID:"REF.logicalid",DFR:"REF.dfr",INST_LOGID:"INST.logicalid",XFORM:"INST.matrixtxt"},n={DB_PROPS:{...i,INST_LOGID:"INST.logicalid[connection]",XFORM:"INST.xform"},CV_PROPS:i,CVURL_BY_TYPE:[{name:"DEFAULT",url:"/cvservlet/expand"}],DATA_SOURCE:"CV_DIRECT",DB_FALLBACK:!0,USE_MCS:!1},o={PROPS:i,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","EQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[]},r={SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:t.colorDef.ORANGE,NLS:"LO"},RIGHT_ONLY:{COLOR:t.colorDef.BLUE1,NLS:"RO"},UNRELATED:{COLOR:t.colorDef.BLACK,NLS:"UNRELATED"},DIFFERENT:{COLOR:t.colorDef.BEIGE,NLS:"DIFFERENT"},QUANTITY:{COLOR:t.colorDef.BLUE2,NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"}},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu",CELL_DRAG_ENABLED_FLAG:!1},s={colorLeft:r.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,colorRight:r.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR};return{CV_PROPS:i,STRUCT_FETCH_OPTIONS:n,STRUCT_COMPARE_OPTIONS:o,STRUCT_DISPLAY_OPTIONS:r,ATTRIBUTE_DISPLAY_OPTIONS:s}}),define("DS/CompareWidget2/ViewDefModules/CATProductViewDefs",["DS/CompareWidget2/ViewDefModules/CATProductViewDefOptions"],function(e){"use strict";var t={AttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.ATTRIBUTE_DISPLAY_OPTIONS},InstAttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin",Options:e.INST_ATTR_FETCH_OPTIONS},InstAttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},InstAttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.INST_ATTR_DISPLAY_OPTIONS},StructFetch:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS},StructCompare:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},StructDisplay:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{STANDARD:{ROW:["STRUCT_VIEW",{COL:[["PROP_VIEW","INSTANCE_VIEW"]]}]}},VIEWDEFS:{PROP_VIEW:["AttrFetch","AttrCompare","AttrDisplay"],INSTANCE_VIEW:["InstAttrFetch","InstAttrCompare","InstAttrDisplay"],STRUCT_VIEW:["StructFetch","StructCompare","StructListViewPrep","StructDisplay","Exporter"]},PLUGDEFS:t},e)}),define("DS/CompareWidget2/plugins/VIEW3D/ViewPanel/view3DComparePanel",["DS/CustomizableLayout/View","DS/ENOPAD3DViewer/PAD3DViewer","DS/DMU3DCompareAPI/DMU3DCompareAPI","DS/CompareWidget2/plugins/VIEW3D/ViewPanel/exclusiveHideShowController","DS/UIKIT/Mask","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,i,n,o,r){"use strict";return e.extend({init:function(e,t,i){this._parent(),this._plugSvcs=t,this._viewer3D=null,this._compareAPI3D=null,this._colors={BASELINE:i.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,COMPARE:i.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR,COMMON:"#EEEEEE"},this._viewerIsLoaded=!1,this._initialCompareDone=!1,this._deferred_showResultsArg=null,this._deferred_updateSelectedArg=null,this.buildSkeleton(e)},buildSkeleton:function(e){this.elements.container=e,this._viewer3D=this._buildPAD3DViewer()},destroy:function(){null!=this._viewer3D&&(this._viewer3D.empty(),null!=this._viewer3D.flushModel&&this._viewer3D.flushModel(),this._viewer3D.destroy(),this._viewer3D=null),this._compareAPI3D=null,this._plugSvcs=null,this._deferred_showResultsArg=null,this._deferred_updateSelectedArg=null,this.elements=null},_buildPAD3DViewer:function(){var e=this,i={widget:widget,css_view_class:"windowed",visuProgressiveTileModel:!0,allowAuthoring:!1,activateProbes:!1,actionbar_corrected:!0,interwidgetComAvailability:!1,supportWorldOrientation:!0,windowOptions:{workbench:"CompareViewerCmd.xml",workbenchModule:"CompareWidget",robotVisibility:!1,automaticReframePolicy:!0,allowDnD:!1,defaultStatusBarVisibility:!1,defaultContextualMenuVisibility:!0,defaultContextualBarVisibility:!0,viewerOptions:{highlight:{activated:!0,displayHL:!0,gpu:!0,computeNormalDepth:!0,primitive:!1,trapSelection:!0,trapGPU:!0,trapPrimitive:!1}},contextualMenuContent:{workbenchName:"CompareViewerContextualBar",module:"CompareWidget",fileName:"CompareViewerContextualBar.xml",geometry:{firstLevel:["CompareViewerFocusOnHdr","ReframeOnHdr"],toggleVisu:null}}}},n=new t(i),o=n.subscribe({event:"onReady"},function(){n.unsubscribe(o),e._padReadyCB()});return n},_padReadyCB:function(){var e=this,t=!1,o=widget.getPreferences();o.forEach(e=>{"xPref_3DEXPERIENCE_PLATFORM"!==e.name&&"pad_security_ctx"!==e.name||"hidden"===e.type||(e.type="hidden",t=!0)}),t&&widget.setPreferences(o),e._viewer3D.render().inject(e.elements.container);var r=e._viewer3D.getHideShowController();e._exclusiveHideShowController=new n(r);if(e._compareAPI3D=new i(e._viewer3D._frmWindow,{activateXHighlight:!0,ctxViewer:e._viewer3D}),e._compareAPI3D.setLegendVisibleFlag(!1),e._viewerIsLoaded=!0,null!=e._deferred_showResultsArg){var s=e._deferred_showResultsArg;e._deferred_showResultsArg=null,e._doShowResults(s)}},showResults:function(e){var t=this;return new Promise(function(i,n){t._compareOKFn=i,t._compareKOfn=n,0==t._viewerIsLoaded?t._deferred_showResultsArg=e:(t._initialCompareDone=!1,t._doShowResults(e))})},_doShowResults:function(e){var t=this;t._loadViewerJSONS(e).then(function(i){if(t._do3DCompare(e),t._initialCompareDone=!0,t._deferred_updateSelectedArg){var n=t._deferred_updateSelectedArg;t._deferred_updateSelectedArg=null,setTimeout(function(){t._doUpdateSelected(n)},0)}},function(e){t._signalCompareDone(!1)})},_signalCompareDone:function(e){var t=null;t=1==e?this._compareOKFn:this._compareKOFn,this._compareOKFn=null,this._compareKOFn=null,null==t?this._plugSvcs.errout("trying to signal 3DCompare done but no report function available"):t()},_loadViewerJSONS:function(e){var t=this;return new Promise(function(i,n){var o=t._viewer3D.subscribe({event:"onLoadingComplete"},function(){t._viewer3D.unsubscribe(o)}),r=t._viewer3D.subscribe({event:"onEndProgressiveLoad"},function(e){1==e.memoryFull&&t._plugSvcs.showAlertBox("Load Failed / Out of Memory",null,"error"),t._viewer3D.unsubscribe(r),t._viewer3D.reframe(),t._signalCompareDone(!0),i()});t._viewer3D.loadJSON({data:e})})},_do3DCompare:function(e){var t=this;try{var i=t._getViewerPath(e[0].rootID),n=t._getViewerPath(e[1].rootID),o=t._buildDMUOptions(i,n);null!=t._compareAPI3D&&t._compareAPI3D.compare(o)}catch(e){t._plugSvcs.showAlertBox("3DComparison failed",null,"error"),t._plugSvcs.errout("Exception performing 3D Compare: "+e.stack)}},updateSelected:function(e,t){var i=this;i._deferred_CrossHighlight=t,0==i._initialCompareDone?i._deferred_updateSelectedArg=e:setTimeout(function(){i._doUpdateSelected(e)},0)},_doUpdateSelected:function(e){for(var t=this,i=[],n=[],r=e.length,s=0;s<r;s++){var a=e[s];null!=a&&(i[s]=[],a.forEach(function(e){var o=t._getViewerPath(e);if(null!=o){i[s].push(o);var r=e.split("/");n.push(r)}}))}o.mask(t.elements.container),t.elements.container.getElement(".spinner").addClassName("in"),setTimeout(function(){t._updateViewer("update",n).then(function(e){if(null!=t._compareAPI3D){var n=t._buildDMUOptions(i[0],i[1]);t._compareAPI3D.updateCompareModel(n)}null!=t._deferred_CrossHighlight&&t._deferred_CrossHighlight.status&&t._deferred_CrossHighlight.doneCB(t._deferred_CrossHighlight),t._deferred_CrossHighlight=null,o.isMasked(t.elements.container)&&o.unmask(t.elements.container)},function(e){t._plugSvcs.errout("Cannot update View3D:: "+e)})},0)},_updateViewer:function(e,t){var i=this,n=null,o=null;return"hide"==e?(n=i._exclusiveHideShowController.hide,o="onHide"):"show"==e?(n=i._exclusiveHideShowController.show,o="onShow"):"update"==e&&(n=i._exclusiveHideShowController.exclusiveShow,o="onExclusiveShow"),new Promise(function(e,r){if(null==n)r("bad opName in 'doUpdate'");else{var s=i._exclusiveHideShowController.subscribe({event:o},function(){try{i._exclusiveHideShowController.unsubscribe(s),e()}catch(e){i._plugSvcs.errout("Failure performing explusive show"),r()}});n.call(i._exclusiveHideShowController,{paths:t})}})},_getViewerPath:function(e){var t="";try{var i=null!=e?e.split("/"):[];t=this._viewer3D.getController().buildPathFromArray(i)}catch(e){this._plugSvcs.warnout("EXCEPTION trying to get viewer path: "+e)}return t},_makeTreeEntry:function(e,t,i,n){var o={};return null==n||n.constructor==Array&&null==n[0]?o=null:(o={name:e,nls:t,color:i},n.constructor==Array?o.pathElements=n:o.pathElement=n),o},_buildDMUOptions:function(e,t){var i=null==e||e.constructor==Array&&0==e.length,n=null==t||t.constructor==Array&&0==t.length,o=this._colors.BASELINE,r=this._colors.COMPARE,s={panel:"reduce",TitleNls:"NLS_TITLE",Common:{nls:"NLS_Common",color:n?o:i?r:this._colors.COMMON}};return s.Old=this._makeTreeEntry("L","NLS_LEFT",o,i?t:e),s.New=this._makeTreeEntry("R","NLS_RIGHT",r,n?e:t),s},clearView:function(e){null!=this._viewer3D&&this._viewer3D.empty()},getLabel:function(){return r.Compare3DPanelTitle},getName:function(){return"view3d"}})}),define("DS/CompareWidget2/plugins/VIEW3D/VIEW3D_DISPLAY_plugin",["DS/CompareWidget2/plugins/displayPlugin","DS/CompareWidget2/plugins/VIEW3D/ViewPanel/view3DComparePanel","DS/CompareWidget2/plugins/VIEW3D/ViewPanel/XSelectManager"],function(e,t,i){"use strict";function n(e,t){for(var i=[],n=t.length,o=0;o<n;o++)for(var r=t[o],s=r.length,a="."+o,l=0;l<s;l++){for(var u=(d=r[l].IDPath.split("/")).length,c=0;c<u;c++){let e=d[c].length;d[c].substring(e-2)!=a&&(d[c]+=a)}r[l].IDPath=d.join("/")}for(const n of t)if(null!=n){var d=[];for(const t of n){var p=t.IDPath;if("IDPATH"==e)d.includes(p)||d.push(p);else{if("VIEWERPATH"!=e)return this._plugSvcs.errout("INVALID RETURN TYPE request: "+e),[];var h=this._outputPanel._getViewerPath(p);null!=h&&i.push({pathElement:h})}}"IDPATH"==e&&i.push(d)}return i}function o(e){for(var t={},i=e.length,n=0;n<i;n++){var o=e[n];if(0==o.getIsHidden_byStatusFilter()){var r=o.getBaseNode(),s=r.isDummy()?"":r.getAttr("physicalID_REF")+".0",a=o.getCompNode(),l=a.isDummy()?"":a.getAttr("physicalID_REF")+".1";t[s+"_"+l]=!0,1==o.qtyIsDiff()&&(t[s+"_"]=!0,t["_"+l]=!0)}}return t}function r(e,t,i,n){var o={viewableRootSet:[],allVisible:!1},s=!0,a=t.getMatchInfo();if(i){var l=a.getBaseNode(),u=l.isDummy()?"":l.getAttr("physicalID_REF")+".0",c=a.getCompNode(),d=c.isDummy()?"":c.getAttr("physicalID_REF")+".1";s=1!=n["DIFFERENT"==a.getRelName()?0==e?u+"_":"_"+d:u+"_"+d]}else s=a.getIsHidden_byStatusFilter();if(s){if(i)for(var p=(_=t.getChildArray()).length,h=0;h<p;h++){(f=r(e,_[h],i,n)).viewableRootSet.forEach(function(e){o.viewableRootSet.push(e)})}}else{var _;p=(_=t.getChildArray()).length;if(o.allVisible=!0,0==p){g=(g=t.getPath()+"."+e).replaceAll("/","."+e+"/"),0==t.isDummy()&&(o.viewableRootSet=[g])}else{for(h=0;h<p;h++){var f;0==(f=r(e,_[h],i,n)).allVisible&&(o.allVisible=!1),f.viewableRootSet.forEach(function(e){o.viewableRootSet.push(e)})}var g;if(1==o.allVisible)g=(g=t.getPath()+"."+e).replaceAll("/","."+e+"/"),0==t.isDummy()&&(o.viewableRootSet=[g])}}return o}function s(e){var t=this;let i=this.viewerDisplayMode;if(void 0!==t._outputPanel&&null!==t._outputPanel){t._attrUpdateStartMS=t._plugSvcs.nowMS();var s=e.data.selectedData,a=e.data.crTree,l=[],u=[];if(null!=s){var c="LIST"==e.data.structDisplayMode;if("isolate"===i)l=function(e,t,i){var n=[[],[]],s=null;i&&(s=o(e.getCRList().getMatchPairArray()));for(var a=e.getRootArray().length,l=0;l<a;l++)for(var u=t[l].length,c=t[l].sort(function(e,t){return e.IDPath>t.IDPath}),d="XXX",p=0;p<u;p++){var h=c[p].IDPath;if(h.startsWith(d));else{d=h;var _=e.findNodeByIDPath(l,h);if(_){var f=r(l,_,i,s).viewableRootSet;n[l]=n[l].concat(f)}}}return n}(a,s,c);else{if("select"!==i)return void t._plugSvcs.errout("INVALID - expected 'isolate' or 'select', was given: '"+i+"'");l=function(e,t){var i=[],n=null;t&&(n=o(e.getCRList().getMatchPairArray()));for(var s=e.getRootArray(),a=s.length,l=0;l<a;l++){var u=r(l,s[l].CRNode_root,t,n).viewableRootSet;i.push(u)}return i}(a,c),u=n.call(t,"VIEWERPATH",s)}var d={status:!1};try{"isolate"==i&&"select"==this._lastViewDisplayMode&&t._XSelectManager.notifyClearHighlights();var p="isolate"==i,h="select"==i,_="none"==this._lastViewDisplayMode,f="isolate"==this._lastViewDisplayMode,g=1==l[0].length&&-1==l[0][0].indexOf("/"),m=1==l[1].length&&-1==l[1][0].indexOf("/"),S=g&&m;(p||h&&(_||f||!S||!this._lastWasRootsOnly))&&(d={status:!0,viewerPaths:u,doneCB:function(e){"select"===i&&require(["DS/Selection/CSOManager","DS/Selection/HSOManager"],function(e,i){t._XSelectManager.setUpdateState("INTERNAL");let o=n.call(t,"VIEWERPATH",s);e.add(o),i.add(o),t._XSelectManager.setUpdateState("NONE")},function(e){})}},t._outputPanel.updateSelected(l,d),this._lastIDPAAS=l),this._lastViewDisplayMode=i,this._lastWasRootsOnly=S}catch(e){this._plugSvcs.errout("EXCEPTION updating selected in output panel")}"select"===i&&t._XSelectManager.notifyNewHighlights(u,!d.status)}}}return e.extend({onEnabled:function(){var e=this;return e._lastViewDisplayMode="none",e._lastWasRootsOnly=!1,e._lastIDPAAS=[],e.subscribeEvent("STRUCT_UPDATE_IN_PROGRESS_EVENT",e.onUpdateInProgress.bind(e)),e.subscribeEvent("NEW_CURRENT_SELECTION_EVENT",s.bind(this)),e.syncSetting("viewSettings.PAD3D_VIEW.view3D.isolate","_viewerDisplayModeIsolate",()=>this.viewerDisplayMode=!0===this._viewerDisplayModeIsolate?"isolate":"select"),this.viewerDisplayMode=!0===this._viewerDisplayModeIsolate?"isolate":"select",null==e._XSelectManager&&(e._XSelectManager=new i(e._plugSvcs)),e._parent()},destroy:function(){this._XSelectManager.destroy(),this._XSelectManager=null,this._parent()},createViewPanelObject:function(e,i){return new t(e,this._plugSvcs,i)},execute:function(e,t){var i=this;i._parent(e,t);var n=e;null==n[0].structure.results[0]["ds6w:globaltype"]||null==n[1].structure.results[0]["ds6w:globaltype"]?i.reportKO("no viewable present for at least one object"):i._outputPanel.showResults(n).then(function(e){i.showNotBusy(),i.reportOK(e)},function(e){i.reportKO(e)})}})}),define("DS/CompareWidget2/userSettings/PLMReference",["UWA/Core","DS/CompareWidget2/userSettings/SettingsBase","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,i){"use strict";return e.extend(t,{namespace:"",compareSettings:{dataSource:{useIndex:{value:!0,V1Preference:"useIndex",widgetSetting:{type:"boolean",label:i.useIndex,defaultValue:!0}}},includeFacets:{externalRelations:{showDocs:{value:!1,V1Preference:"showDocs"},showOtherRels:{value:!1,V1Preference:"showOtherRels"}}}},viewSettings:{INSTANCE_VIEW:e.extend(e.clone(t.viewSettings.PROP_VIEW,!0),{attributes_display_option:{value:"",V1Preference:"compare_attributes_display_option_INST"},attributes_not_shown:{value:"",V1Preference:"compare_attributes_not_shown_INST"}}),EFFECTIVITY_VIEW:{attributes_display_option:{value:""},default_attributes:{value:["Effectivity","VariantOption","CurrentEvolution","ProjectedEvolution"]},attributes_always_shown:{value:""},attributes_not_shown:{value:""}}}},!0)}),define("DS/CompareWidget2/userSettings/VPMReference",["UWA/Core","DS/CompareWidget2/userSettings/PLMReference","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,i){"use strict";return e.extend(t,{namespace:"",viewSettings:{PAD3D_VIEW:{view3D:{isolate:{value:!0,V1Preference:{viewer_display_mode:[{oldValue:"isolate",newValue:!0},{oldValue:"select",newValue:!1}]},widgetSetting:{type:"boolean",label:i.viewerIsolate,defaultValue:!1}}}}}},!0)}),define("DS/CompareWidget2/support/attrNLS_mgr",["DS/CompareWidget2/support/cw2CacheMgr","DS/CompareWidget2/support/DataCenter","DS/CompareWidget2/support/cw2Utils"],function(e,t,i){function n(e,t){e.forEach(function(e){t.putEntry(e.uri,e.nlsName)})}return{getObjAttrCache:function(o,r,s){return new Promise(function(a,l){let u=o+"."+r+"."+s,c=e.getCache(u,!0);if(0==c.getSize()){let e=("VPMReference"===o?["ds6wg:VPMReference","ds6wg:VPMRepReference","ds6wg:EnterpriseExtension","ds6wg:VPMInstance","ds6wg:VPMRepInstance"]:[o]).join("\n");t.makeAuthHttpsCall("/resources/6WVocab/access/Predicates","POST",e,"json",r,"3DSpace",s,!0,!0).then(function(e){for(var t of e.classPredicates){n(t.vocabularyPredicateInfo,c)}a(c)},function(e){i.errout("failed getting predicates... can't lookup NLS for attrs... continuing"),a(c)})}else a(c)})},getAttrNLS:function(e,t,i,n){let o={},r=JSON.parse(JSON.stringify(e));return this.getObjAttrCache(t,i,n).then(function(e){let t=e;return Object.keys(r).forEach(function(e){let i=r[e],n=function(e){let t=e,i=["REF.","INST."].find(function(t){return e.startsWith(t)});if(null!=i){let n=i.length;t=e.substring(n)}return t}(i),s=t.getEntry(n);null==s&&(s=n),o[i]=s}),o})}}}),define("DS/CompareWidget2/ViewDefModules/DocumentViewDefOptions",["UWA/Core","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){"use strict";var i={PHYSICALID:"REF.physicalid",VERSIONID:"REF.versionid",NAME:"REF.name"},n={CV_PROPS:i,CVURL_BY_TYPE:[{name:"DEFAULT",url:"/cvservlet/expand"}],DATA_SOURCE:"CV_SERVICE",DB_FALLBACK:!1,USE_MCS:!1},o={PROPS:i,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","NEQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[]},r={SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:t.colorDef.ORANGE,NLS:"LO"},RIGHT_ONLY:{COLOR:t.colorDef.BLUE1,NLS:"RO"},UNRELATED:{COLOR:t.colorDef.BLACK,NLS:"UNRELATED"},DIFFERENT:{COLOR:t.colorDef.BEIGE,NLS:"DIFFERENT"},QUANTITY:{COLOR:t.colorDef.BLUE2,NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"},REPLACED:{COLOR:t.colorDef.PINK,NLS:"REPLACED"}},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu",CELL_DRAG_ENABLED_FLAG:!0};return{CV_PROPS:i,STRUCT_FETCH_OPTIONS:n,STRUCT_COMPARE_OPTIONS:o,STRUCT_DISPLAY_OPTIONS:r,ATTRIBUTE_DISPLAY_OPTIONS:{colorLeft:r.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,colorRight:r.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR}}}),define("DS/CompareWidget2/ViewDefModules/DocumentViewDefs_V2",["DS/CompareWidget2/ViewDefModules/DocumentViewDefOptions"],function(e){"use strict";var t={AttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.ATTRIBUTE_DISPLAY_OPTIONS},StructFetch:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS},StructCompare:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},StructDisplay:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{STANDARD:{COL:["STRUCT_VIEW","PROP_VIEW"]},PROPS_ONLY:{ROW:"PROP_VIEW"},STRUCT_ONLY:{ROW:"STRUCT_VIEW"}},VIEWDEFS:{PROP_VIEW:["AttrFetch","AttrCompare","AttrDisplay"],STRUCT_VIEW:["StructFetch","StructCompare","StructListViewPrep","StructDisplay","Exporter"]},PLUGDEFS:t},e)}),define("DS/CompareWidget2/Customization/CompareCustomizationManager",["DS/CompareWidget2/Customization/Profile","DS/CompareWidget2/support/DataCenter","DS/LifecycleServices/LifecycleServices","DS/CompareCommon/Utils","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/Customization/viewConfigMangler","i18n!DS/CompareWidget2/assets/nls/DisplayMessages"],function(e,t,i,n,o,r,s){"use strict";const a="/resources/compare2/compareModelerProfiles",l=(e,t,i)=>`${e}_${i}_${t}`,u=(e,t)=>l("profiles",e,t),c=(e,t)=>l("preferred",e,t);function d(e,t){var i=e.findIndex(e=>e.Name===t);return-1===i&&(i=e.findIndex(e=>e.NameNLS===t)),i}function p(i,n,o,r){var s=[];return t.loadPageObject(u(i,r),n,o).then(t=>{if(1==t.success){let r=t.settings.content;if(null!==r)for(var i=0;i<r.length;i++){var n=r[i],o=new e(n);s.push(o)}}return s},e=>s)}function h(e,i){var n=c(e.userName,e.companyId);return t.savePageObject(n,i,e.tenant,e.securityContext)}function _(e,i,n){var o=u(i,e.companyId);return t.savePageObject(o,n,e.tenant,e.securityContext)}var f=function(){this._modelerTemplates=[],this._adminProfiles=[],this._userProfiles=[],this._userPreferred={},this._runContext={},this._profileFacetNLSMap={}};return f.prototype.init=function(e){var t=this;return this.loadCustomizations().then(()=>{!e&&t.loadFacetNamesNLS()})},f.prototype.loadCustomizations=function(){var e,o=this;return o.profilesLoadCompleted=!1,(e={userName:"",isAdminUser:!1,securityContext:"",tenant:widget.getValue("x3dPlatformId"),companyId:""},new Promise(function(t,o){i.getSecurityContextPromise(e.tenant,e.securityContext).then(function(i){e.securityContext=i,e.companyId=n.getWidgetCredentialsCompanyId(),n.checkIsAdminUserPromise().then(function(i){e.userName=i.id,e.isAdminUser=i.isAdminUser,t(e)},function(i){console.error("Failed to get Admin/User info: "+i+"... continuing..."),t(e)})},function(i){console.error("Failed to get security context: "+i+"... continuing..."),t(e)})})).then(e=>(o._runContext=e,function(e){var i=[];return t.makeAuthHttpsCall(a,"GET",null,"json",e.tenant,"3DSpace",e.securityContext,!0).then(e=>(e.results.forEach(function(e){var t=e.data.templates;for(var n of e.data.templates)n.Type="template",n.NameNLS=n.Name,void 0!==n.NLSPath&&null!==n.NLSPath&&""!==n.NLSPath?require([n.NLSPath],function(e){n.NameNLS=e.get(n.Name)},function(e){console.log("COMPARE CUSTOMIZATION - Localization name missing for profile "+n.Name)}):console.log("COMPARE CUSTOMIZATION - Localization path missing for profile "+n.Name);i=i.concat(t)}),i),e=>i)}(o._runContext))).then(e=>(o._modelerTemplates=e,function(e){return p("admin",e.tenant,e.securityContext,e.companyId)}(o._runContext))).then(e=>(o._adminProfiles=e,function(e){return p(e.userName,e.tenant,e.securityContext,e.companyId)}(o._runContext))).then(e=>(o._userProfiles=e,function(e){var i={};return t.loadPageObject(c(e.userName,e.companyId),e.tenant,e.securityContext).then(e=>(1==e.success&&(i=e.settings.content),i),e=>i)}(o._runContext))).then(e=>{o._userPreferred=e,o.profilesLoadCompleted=!0})},f.prototype.saveCustomizations=function(){let e={status:!0};var t,i,n=[];this._runContext.isAdminUser&&n.push((t=this._runContext,i=this._adminProfiles,_(t,"admin",i))),n.push(function(e,t){return _(e,e.userName,t)}(this._runContext,this._userProfiles)),n.push(h(this._runContext,this._userPreferred));var o=n.length;return Promise.allSettled(n).then(t=>{for(var i=0,n=t.length;i<n;i++){let n=3===o?i:i+1;"rejected"===t[i].status?(e.status=!1,0===n?console.log("COMPARE CUSTOMIZATION - Save Admin Profiles FAILED"):1===n?console.log("COMPARE CUSTOMIZATION - Save User Profiles FAILED"):2===n&&console.log("COMPARE CUSTOMIZATION - Save preferred profile FAILED")):0===n?console.log("COMPARE CUSTOMIZATION - Save Admin Profiles successful"):1===n?console.log("COMPARE CUSTOMIZATION - Save User Profiles successful"):2===n&&console.log("COMPARE CUSTOMIZATION - Save preferred profile successful")}}),e},f.prototype.cancelCustomizations=function(){return console.log("Canceling profile edits"),this.loadCustomizations().then(function(e){console.log("COMPARE CUSTOMIZATION - Cancel and reload - customizations loaded")},function(e){console.log("COMPARE CUSTOMIZATION - Cancel and reload - failed to load customizations")}),{status:!1}},f.prototype.isTemplateProfile=function(e){return null!=e&&"template"===e.Type},f.prototype.isCustomizationProfile=function(e){return null!=e&&"customization"===e.Type},f.prototype.getTenant=function(){return void 0!==this._runContext&&null!==this._runContext?this._runContext.tenant:"onPremise"},f.prototype.getSecurityContext=function(){return void 0!==this._runContext&&null!==this._runContext?this._runContext.securityContext:null},f.prototype.getUserName=function(){return void 0!==this._runContext&&null!==this._runContext?this._runContext.userName:null},f.prototype.getIsAdminUser=function(){return void 0!==this._runContext&&null!==this._runContext?this._runContext.isAdminUser:null},f.prototype.getProfileNames=function(e){var t=null;if(null!=e.objTypes){for(var i=0;i<e.objTypes.length-1;++i)if(e.objTypes[i]!==e.objTypes[i+1])return console.log("LOOKING for profile names that address type '"+e.objTypes[i]+"' and '"+e.objTypes[i+1]+"'. Not supported."),ret;t=e.objTypes[0],console.log("LOOKING for profile names that address type '"+t+"'")}else null!=e.objType?(t=e.objType,console.log("LOOKING for profile names that address type '"+t+"'")):console.log("LOOKING for ALL profile names");function n(e){let i=[];return e.forEach(function(e){var n=!1;null==t?n=!0:e.SelectedTypes.some(function(e){if(t==e)return n=!0,!0}),n&&i.push(null!=e.NameNLS?e.NameNLS:e.Name)}),i}let o=()=>{let t=null!=e&&!0===e.asTree?null:[],i=[],o=null!=e&&1==e.getTemplates?n(this._modelerTemplates):[],r=n(this._adminProfiles),s=n(this._userProfiles);if(null!=e&&!0===e.asTree)t={},o.length>0&&(t.templates=o),r.length>0&&(t.adminProfiles=r),s.length>0&&(t.userProfiles=s);else{let e=r.concat(s);t=i.concat(o,e)}return t};if("function"!=typeof e.callBackAfterProfilesUpdated)return o();if(this.profilesLoadCompleted)e.callBackAfterProfilesUpdated(o());else{let t=setInterval(()=>{this.profilesLoadCompleted&&(clearInterval(t),e.callBackAfterProfilesUpdated(o()))},200)}},f.prototype.getUserPreferredProfileName=function(e){e.getRoles();var t=(e.getTypeArray()||[])[0];return"COMPARE"===e.app?this._userPreferred[t]:null},f.prototype.setUserPreferredProfileName=function(e,t){let i="function"==typeof e.stringify?e.stringify():e;this.isDefaultProfile(t)&&(delete this._userPreferred[i],t="__|DEFAULT|__"),this._userPreferred[i]=t,h(this._runContext,this._userPreferred)},f.prototype.profileExists=function(e){return-1!=d(this._modelerTemplates,e)||-1!=d(this._adminProfiles,e)||-1!=d(this._userProfiles,e)},f.prototype.isDefaultProfile=function(e){return!this.profileExists(e)},f.prototype.getProfile=function(e){let t=null;if(null!=e&&""!==e){var i=d(this._modelerTemplates,e);if(-1!=i)t=this._modelerTemplates[i];else{var n=d(this._adminProfiles,e);if(-1!=n)t=this._adminProfiles[n];else{var o=d(this._userProfiles,e);-1!=o&&(t=this._userProfiles[o])}}}return t},f.prototype.duplicateProfile=function(t,i){let n=this.getProfile(t),o=new e(n,i,this._runContext.userName,this._runContext.isAdminUser,this._runContext.companyId);return this._runContext.isAdminUser?this._adminProfiles.push(o):this._userProfiles.push(o),o},f.prototype.removeProfile=function(e){let t=d(this._userProfiles,e),i=!1;if(-1!==t)this._userProfiles.splice(t,1),i=!0;else if(this._runContext.isAdminUser){let t=d(this._adminProfiles,e);-1!==t&&(this._adminProfiles.splice(t,1),i=!0)}if(i){let t="";for(const[i,n]of Object.entries(this._userPreferred))if(n===e){t=i;break}""!==t&&this.setUserPreferredProfileName(t,"__|DEFAULT|__")}},f.prototype.applyCustomProfileToViewConfig=function(e,t){try{var i=this.getProfile(e);null!=i?(t=r.applyCustomProfileToViewConfig(i,t),console.log("VIEWSETMRG-----\x3e>>>>   viewSetMgr is using CUSTOM PROFILE '"+e+"'")):(o.errout("Cannot retrieve custom profile '"+e+"', using default configuration"),n.showAlertBox("CUSTOMIZATION_FAILED",s,"error"))}catch(e){o.errout("Failed to apply profile customizations; using default configuration"),n.showAlertBox("CUSTOMIZATION_FAILED",s,"error")}return t},f.prototype.loadFacetNamesNLS=function(){var e=this;for(var t of e._modelerTemplates)void 0!==t.NLSPath&&null!==t.NLSPath&&""!==t.NLSPath?require([t.NLSPath],function(i){for(var n of(e._profileFacetNLSMap[t.NLSPath]={},e._profileFacetNLSMap[t.NLSPath].facet={},t.Facets))e._profileFacetNLSMap[t.NLSPath].facet[n.Name]=i.get(n.Name)},function(e){console.log("COMPARE CUSTOMIZATION - Localization path failed to load for profile "+t.Name)}):console.log("COMPARE CUSTOMIZATION - Localization path missing for profile "+t.Name)},f.prototype.getFacetNameNLS=function(e,t){let i=t;if(null!=e&&""!==e&&void 0!==this._profileFacetNLSMap[e]&&null!==this._profileFacetNLSMap[e]){let n=this._profileFacetNLSMap[e].facet;null!=n&&void 0!==n[t]&&null!==n[t]&&""!==n[t]&&(i=n[t])}return i},f}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/crList",["DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair"],function(e,t){var i=function(e){this._listMatchPairArray=[],this._lut=[],e&&this.build_listMatchedPairArray(e),this._lut=[],this._reqModforODT="DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/crList"};return i.prototype.build_listMatchedPairArray=function(e){var t=this;e.forEach(function(e){t._addMatchedPair(e)}),t._listMatchPairArray.forEach(function(e){var t=e.getRelName();if("LEFT_ONLY"!=t&&"RIGHT_ONLY"!=t){var i=e.getBaseNode(),n=e.getCompNode();e.qtyIsDiffFlag=i.qty!=n.qty}})},i.prototype.getMatchPairArray=function(){return this._listMatchPairArray},i.prototype.generateDisplayLists=function(){var t=[[],[]];return this._listMatchPairArray.forEach(function(i){var n=i.getBaseNode();null==n&&(n=new e);var o=i.getCompNode();null==o&&(o=new e),t[0].push(n),t[1].push(o)}),t},i.prototype._addMatchedPair=function(i){var n=i.getRelName();if("UNRELATED"==n||"DIFFERENT"==n){var o=i.getBaseNode(),r=i.getCompNode(),s=new e,a=new e,l=new t("LEFT_ONLY",null,o,a),u=new t("RIGHT_ONLY",null,s,r);this._addListMatchedPair(l),this._addListMatchedPair(u)}else{var c=i.shallowDupe(),d=c.getAdjFlagArray()||[];(c.getInstFlagNdxs()||[]).forEach(function(e,t){d.splice(e-t,1)}),this._addListMatchedPair(c)}},i.prototype._addListMatchedPair=function(e){var t=e.getBaseNode(),i=null==t||t.isDummy(),n=i?"":t.getAttr("physicalID_REF"),o=e.getCompNode(),r=null==o||o.isDummy(),s=r?"":o.getAttr("physicalID_REF"),a=n+"."+s,l=this._lut[a],u=!1;if(null!=l){var c=l.getBaseNode(),d=l.getCompNode();0==i&&(null==c.qty||(c.qty.length=0)?c.qty=1:c.qty++),0==r&&(null==d.qty||(d.qty.length=0)?d.qty=1:d.qty++),u=!0}else if(0==i&&0==r){var p=n+".",h=this._lut[p];if(null!=h&&h.getCompNode().isDummy()){h.getBaseNode().qty++,(C=o.shallowDupe()).qty=1,C._matchInfo=h,h._compNode=C,h._relName=e._relName,this._lut[a]=h,this._lut["."+s]=h,u=!0}else{var _="."+s,f=this._lut[_];if(null!=f&&f.getBaseNode().isDummy())f.getCompNode().qty++,(g=t.shallowDupe()).qty=1,g._matchInfo=f,f._baseNode=g,f._relName=e._relName,this._lut[a]=f,this._lut[n+"."]=f,u=!0;else(v=e.shallowDupe()).getBaseNode().qty=1,v.getCompNode().qty=1,this._listMatchPairArray.push(v),this._lut[a]=v,this._lut[n+"."]=v,this._lut["."+s]=v,u=!0}}else if(r){var g,m="."+n,S=this._lut[m];if(null!=S)(g=t.shallowDupe()).setMatchInfo(S),g.qty=1,S._baseNode=g,S._relName="IDENTICAL",this._lut[n+"."]=S,this._lut[n+"."+n]=S,u=!0}else if(i){var C,T=s+".",E=this._lut[T];if(null!=E)(C=o.shallowDupe()).setMatchInfo(E),C.qty=1,E._compNode=C,E._relName="IDENTICAL",this._lut["."+s]=E,this._lut[s+"."+s]=E,u=!0}if(0==u){var v=e.shallowDupe();this._lut[a]=v,v.getBaseNode().qty=i?"":1,v.getCompNode().qty=r?"":1,this._listMatchPairArray.push(v)}},i}),define("DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crTree",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/crList"],function(e,t,i,n){function o(e){var i=new t;return i.setParent(e),i}function r(e,t,n){var s=t.getChildArray(),a=n.getChildArray(),l=s.length,u=a.length,c=[],d=[],p=0;for(p=0;p<u;p++)a[p].touched=!1;for(p=0;p<l;p++){let t=s[p],a=null;if(null==t._matchInfo){a=o(n),n.addChild(a);let e=new i("LEFT_ONLY",null,t,a);t._matchInfo=e,a._matchInfo=e}else a=t._matchInfo.getCompNode();c.push(t),d.push(a),a.touched=!0,r(e,t,a)}for(p=0;p<u;p++){let n=a[p];if(0==n.touched&&null==n._matchInfo){let s=o(t);t.addChild(s);let a=new i("RIGHT_ONLY",null,s,n);n._matchInfo=a,s._matchInfo=a,c.push(s),d.push(n),n.touched=!0,r(e,s,n)}else n.touched=!0}t._childArray=c,n._childArray=d}function s(e){var t=[],i=[];for(i.push(e.getRoot(0));i.length>0;){var n=i.pop(),o=n.getMatchInfo();t.push(o);for(var r=n.getChildArray(),s=r.length-1;s>=0;s--){var a=r[s];i.push(a)}}return t}function a(e){!function e(t,i,n,o){i[n]=o;var r=i.join(".");var s=t.getMatchInfo();s.setDepth(r);s.setLevel(i.length-1);var a=t.getChildArray();var l=a.length;for(var u=0;u<l;u++){var c=a[u];e(c,i,n+1,u+1)}i.pop()}(e.getRoot(0),[],0,1)}var l=function(){this._rootSet=[],this._matchPairArray=[],this._crList=null,this._reqModforODT="DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crTree"};return l.prototype.niceUp=function(e){!function(e,t){var n=e.getRoot(0),s=e.getRoot(1),a=!1,l=n.getMatchInfo();if("UNRELATED"!=l.getRelName()&&l.getCompNode()==s&&(a=!0),a||t)r(e,n,s);else{var u=o(null),c=new i("LEFT_ONLY",null,n,u);n.setMatchInfo(c),u.setMatchInfo(c),r(e,n,u),u.addChild(s);var d=o(null);c=new i("RIGHT_ONLY",null,d,s),d.setMatchInfo(c),s.setMatchInfo(c),r(e,d,s),n.addChild(d),e.resetDisplayRoot(1,u)}}(this,e),a(this),this._matchPairArray=s(this),this._crList=new n(this._matchPairArray)},l.prototype.reNice=function(){delete this._matchPairArray,delete this._crList,this._matchPairArray=s(this),this._crList=new n(this._matchPairArray)},l.prototype.getMatchPairArray=function(){return this._matchPairArray},l.prototype.getCRList=function(){return this._crList},l.prototype.getRoot=function(e){var t=null;return null!=this._rootSet[e]&&(t=this._rootSet[e].CRNode_root),t},l.prototype.getRootArray=function(){return this._rootSet},l.prototype.getDisplayRoot=function(e){var t=null;return null!=this._rootSet[e]&&(t=this._rootSet[e].CRNode_displayRoot),t},l.prototype.getRootObjIDSpec=function(e){var t=null;return null!=this._rootSet[e]&&(t=this._rootSet[e].root_objIDSpec),t},l.prototype.resetDisplayRoot=function(e,t){null!=this._rootSet[e]&&(this._rootSet[e].CRNode_displayRoot=t)},l.prototype.setRoot=function(e,t,i){this._rootSet[e]={root_objIDSpec:t,CRNode_displayRoot:i,CRNode_root:i}},l.prototype.destroy=function(){for(var e=0;e<this._rootSet.length;e++){var t=this._rootSet[e];null!=t&&(t.root_objIDSpec.destroy(),delete t.root_objIDSpec,t.CRNode_displayRoot.destroy(),delete t.CRNode_displayRoot,delete t.CRNode_root,delete this._rootSet[e])}},l.prototype.sortTreeNodes=function(){for(var e=this._rootSet.length,t=0;t<e;t++)this.visitAll_treeAndFN(t,function(e){e.sortChildren()})},l.prototype.findNodeByIDPath=function(e,t){var i=t.split("/"),n=this.getRoot(e),o=null,r="",s=n.getAttr("physicalID_REF");if(i[0]==n.getAttr("physicalID_REF")){for(var a=1;null!=n&&a<i.length;a+=2){r=i[a],s=i[a+1];n=n.findChildByID(r,s)}o=n}return o},l.prototype.visitVisible_treeAndFN=function(e,t){this.visit_treeAndFN(!0,e,t)},l.prototype.visitAll_treeAndFN=function(e,t){this.visit_treeAndFN(!1,e,t)},l.prototype.visit_treeAndFN=function(t,i,n){var o=!1,r=this.getRoot(i);return null==r?e.errout("'visit_treeAndFN()' called, but tree has no root set"):o=r.visit_nodesAndFN(t,n),o},l}),define("DS/CompareWidget2/ViewDefModules/CreateAssembly_Options",["UWA/Core","DS/CompareWidget2/ViewDefModules/ViewDefOptions"],function(e,t){"use strict";let i={STRUCT_FETCH_OPTIONS:{PROGRESSIVE_EXPAND_OPTIONS:{graph:{descending_condition_relation:{uql:"(flattenedtaxonomies:reltypes/DELFmiFunctionIdentifiedInstance)"}}},EXPAND_V1_OPTIONS:{no_type_filter_bo:["PLMPort","PLMConnection","VPMReference"]}}};return e.extend(i.STRUCT_FETCH_OPTIONS,t.STRUCT_FETCH_OPTIONS),e.merge(i,t),i}),define("DS/CompareWidget2/ViewDefModules/CreateAssembly_ViewDefs",["UWA/Core","DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2","DS/CompareWidget2/ViewDefModules/CreateAssembly_Options"],function(e,t,i){"use strict";let n={PLUGDEFS:{StructFetch:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:i.STRUCT_FETCH_OPTIONS}}};return e.merge(n.PLUGDEFS,t.PLUGDEFS),e.merge(n,t),e.extend(n,i),n}),define("DS/CompareWidget2/plugins/STRUCTURE/structCompareEngine",["DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crTree","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/hierResultList","DS/CompareWidget2/support/typeHierMgr"],function(e,t,i,n,o){var r=function(e){var t=this;t._plugSvcs=e,t._COMPUTE_DIFFERENT=null,t._FORCE_ROOTS_TOGETHER=!0,t._RELATIONSHIP_NAMES=null,t._RelName2Index={},t._attrNameArray_base=[],t._attrNameArray_comp=[],t._adjArray=[],t._maxAdjScore=0,t._missingAttrVals=!1,t._score2CompareIndex={},t._score2CompareIndex_root={}};function s(e,t){for(var i=t.toString(),n=e-i.length,o="",r=0;r<n;r++)o+=" ";return o+i}return r.prototype._iiGatherTypes=function(e){var t={};return(e||[]).forEach(function(e){var i=e.CONDITIONS;null!=i&&i.TYPE.forEach(function(e){t[e]=!0})}),Object.keys(t)},r.prototype._createCRNode=function(e){var i=e.getAttr("REF.ds6w:identifier");null!=i&&""!==i||(i=e.getAttr("REF.name"));var n=e.getAttr("REF.ds6w:label");null!=n&&""!==n||(n=e.getAttr("REF.Title"));var o=e.getAttr("REF.typeIcons"),r=null!=o?o.smallURL:null,s=null!=o?o.largeURL:null,a=e.getAttr("INST.ro.plminstance.v_treeorder");null!=a&&""!==a||(a=e.getAttr("INST.ro.plminstance.V_treeorder")),null!=a&&""!==a||(a=e.getAttr("INST.TreeOrder"));var l=null;if(this._options.CUSTOM_PROFILE_IN_USE){null!=this._attrNameArray_base&&(l={},this._attrNameArray_base.forEach(function(t){var i=e.getAttr(t);l[t]=i}));let t=this;this._options.CUSTOM_MATCH_ADJUSTMENTS&&this._options.CUSTOM_MATCH_ADJUSTMENTS.forEach(function(i){null!=i.PROPSET&&i.PROPSET.forEach(function(i){var n=t._options.PROPS[i],o=e.getAttr(n);l[n]=o})})}var u=new t(i,n,e.getAttr("REF.ds6w:type"),e.getAttr("INST.physicalid"),e.getAttr("REF.physicalid"),e.getAttr("REF.ds6wg:revision"),a,r,s,e.getAttr("REF.thumbnail_3d"),e,l);u.setDBContext(UWA.clone(e.getDBContext()));var c=e.getAttr("REF.proxySpec");return null!=c&&""!==c.serviceURL&&(u._dbContext.serviceName=c.serviceURL),u},r.prototype._addMatchInfoToCRNodes=function(e,t,n,o,r){var s=new i(e,t,n,o,r);return n.setMatchInfo(s),o.setMatchInfo(s),s},r.prototype._iiLoadHierCache=function(e){var t=this._iiGatherTypes(e);return o.loadUp(t)},r.prototype._initInternals=function(e){var t=this;t._COMPUTE_DIFFERENT=e.COMPUTE_DIFFERENT,t._FORCE_ROOTS_TOGETHER=!0,t._RELATIONSHIP_NAMES=[...e.CUSTOM_RELATIONSHIP_NAMES,...e.SYSTEM_RELATIONSHIP_NAMES],t._RelName2Index={},t._RELATIONSHIP_NAMES.forEach(function(e,i){t._RelName2Index[e]=i});var i=e.CUSTOM_MATCH_ADJUSTMENTS,n=e.PROPS,o=e.CUSTOM_COMPARISONS;t._score2CompareIndex={},t._score2CompareIndex_root={};var r=Object.keys(o);e.CUSTOM_RELATIONSHIP_NAMES.forEach(function(i,s){var a=0,l=0,u=[],c=[];r.forEach(function(t,i){var r=o[t][1][s],d=1<<i;"EQ"==r?a+=d:"N/A"==r&&u.push(d),n[e.CUSTOM_COMPARISONS[t][0][1]].startsWith("INST")?c.push(d):"EQ"==r?l+=d:"N/A"==r&&c.push(d)}),t._iiCalcScoreSet(a,u).forEach(function(e){null==t._score2CompareIndex[e]&&(t._score2CompareIndex[e]=s)}),t._iiCalcScoreSet(l,c).forEach(function(e){null==t._score2CompareIndex_root[e]&&(t._score2CompareIndex_root[e]=s)})});var s={},a={};t._attrNameArray_base=[],t._attrNameArray_comp=[],Object.keys(o).forEach(function(e){var t=o[e][0],i=t[0],r=t[1],l=n[i],u=n[r];s[l]=!0,a[u]=!0}),t._attrNameArray_base=Object.keys(s),t._attrNameArray_comp=Object.keys(a),t._adjArray=[];for(var l=null==i?0:i.length,u=0;u<l;u++){var c=i[u],d=null,p=null,h=[],_=[];let e=!1;if(null!=c.PROPS&&c.PROPS.length>0){var f=c.PROPS;let t=f[0],i=f[1];d=n[t],p=n[i],null==d?_.push(t):d.startsWith("INST")&&(e=!0),null==p?_.push(i):p.startsWith("INST")&&(e=!0)}else{if(!(null!=c.PROPSET&&c.PROPSET.length>0)){t._plugSvcs.errout("Adjustment rule '"+c.NAME+"' malformed; rule is skipped.");continue}c.PROPSET.forEach(function(t){let i=n[t];null==i?_.push(t):(h.push(i),i.startsWith("INST")&&(e=!0))})}if(_.length>0)t._plugSvcs.errout("Cannot evaluate adjustment rule '"+c.NAME+"'; references undeclared variable(s):"+_.join(", "));else{var g=c.MATCH_ADJ;let i={NAME:c.NAME,propName0:d,propName1:p,propNameList:h,FLAG_ON:c.FLAG_ON,adjScore:g,CONDITIONS:c.CONDITIONS,usesInstProp:e,IS_VISIBLE:null==c.IS_VISIBLE||c.IS_VISIBLE};t._adjArray.push(i),g>0&&(t._maxAdjScore+=g)}}return t._iiLoadHierCache(e.CUSTOM_MATCH_ADJUSTMENTS)},r.prototype._iiCalcScoreSet=function(e,t){for(var i=[],n=Math.pow(2,t.length),o=0;o<n;o++){for(var r=e,s=0;s<o;s++)0!=(o&1<<s)&&(r+=t[s]);i.push(r)}return i},r.prototype._buildAttrValLUT=function(e,t){var i=this,n={};return t.forEach(function(t){n[t]={},e.forEach(function(e,o){var r=e.getAttr(t);null!=r?(null==n[t][r]&&(n[t][r]=[]),n[t][r].push(o)):0==e.isRoot()&&1!=i._missingAttrVals&&(i._missingAttrVals=!0,i._plugSvcs.errout("Assembly being tested is MISSING REQUIRED values for the current ruleset ("+t+")"))})}),n},r.prototype._findMatches=function(e,t){var i=this,o=!1,r=1==e.length&&e[0].isRoot()&&1==t.length&&t[0].isRoot(),s=i._buildAttrValLUT(e,i._attrNameArray_base),a=new n(e,t);return t.forEach(function(t,n){var l={};i._attrNameArray_comp.forEach(function(e,i){var n=t.getAttr(e),o=s[e][n];if(null!=o){var r=1<<i;o.forEach(function(e){null==l[e]&&(l[e]=0),l[e]+=r})}});var u=Object.keys(l);i._FORCE_ROOTS_TOGETHER&&r&&0==u.length&&(o=!0),u.forEach(function(s){var u=l[s],c=r?i._score2CompareIndex_root[u]:i._score2CompareIndex[u];if(null!=c){i._stats.totalMatchedFoundCount++;var d=e[s],p=i._evalAdjustment(d,t);a.add(s,n,c,i._RELATIONSHIP_NAMES[c],p.adjIndex,p.adjFlagArray,p.instFlagNdxs)}else r&&i._FORCE_ROOTS_TOGETHER&&(o=!0)}),o&&(i._stats.rootWasForced=!0,a.add(0,0,i._RelName2Index.UNRELATED,"UNRELATED",0,[],[]))}),a.getResult()},r.prototype.isKindOfAny=function(e,t){for(var i=!1,n=e.getAttr("REF.ds6w:type"),r=t.length,s=0;s<r;s++){var a=t[s];if(o.isKindOf(n,a)){i=!0;break}}return i},r.prototype.attrVals_asSpecified=function(e,t){for(var i=!0,n=Object.keys(t),o=n.length,r=0;r<o;r++){var s=n[r],a=t[s];if(e.getAttr(s)!=a){i=!1;break}}return i},r.prototype.conditionsMatchType=function(e,t){return null==t||0==t.length||this.isKindOfAny(e,t)},r.prototype.conditionsMatchAttrs=function(e,t){return null==t||this.attrVals_asSpecified(e,t)},r.prototype.conditionsMatch=function(e,t,i){return null==i||(this.conditionsMatchType(e,i.TYPE)||this.conditionsMatchType(t,i.TYPE))&&(this.conditionsMatchAttrs(e,i.ATTRIBUTES)||(this.conditionsMatchAttrs(t),i.ATTRIBUTES))},r.prototype._evalAdjustment=function(e,t){let i=this,n=0,o=[],r=[],s=e.isRoot()||t.isRoot();for(let l=0;l<i._adjArray.length;l++){let u=i._adjArray[l],c=!1,d="EQ"==u.FLAG_ON,p=u.propNameList;if(null!=p&&p.length>0)for(var a=0;a<p.length;a++){let i=p[a];if((!s||!u.usesInstProp)&&1==(c=e.getAttr(i)==t.getAttr(i)==d))break}else{let i=u.propName0,n=u.propName1;if(s&&u.usesInstProp)continue;c=e.getAttr(i)==t.getAttr(n)==d}c&&1==i.conditionsMatch(e,t,u.CONDITIONS)&&(u.IS_VISIBLE&&(o.push(u.NAME),u.usesInstProp&&r.push(l)),n+=u.adjScore)}return o.length>0&&i._plugSvcs.dbgout("EVAL","----\x3e>> [ADJUSTMENT] : Adj: "+n+", FLAGS: "+o.join(",")),{adjIndex:i._maxAdjScore-n,adjFlagArray:o,instFlagNdxs:r}},r.prototype._addCRNodes=function(e){var t=this;e.forEach(function(e){var i=t._createCRNode(e);e._crNode=i;var n=e.getParent()._crNode;n.addChild(i),i.setParent(n)})},r.prototype._processNodeSets=function(e,t){var i=this;i._stats.processedNodeSetCount++,i._plugSvcs.dbgout("EVAL","PROCESSING "+e.length+" x "+t.length+" nodes...");var n=1==e.length&&e[0].isRoot();n||(this._addCRNodes(e),this._addCRNodes(t));var o=i._findMatches(e,t);i._stats.unmatchedCount+=o.riUnmatchedNodeArray_base.length+o.riUnmatchedNodeArray_comp.length,i._stats.totalMatchedUsedCount+=o.riMatchedNodePairArray.length;var r=o.riMatchedNodePairArray,s=o.riUnmatchedNodeArray_base,a=o.riUnmatchedNodeArray_comp;r.forEach(function(e){var t=e.riNode_base,o=e.riNode_comp,r=t._crNode,s=o._crNode;if(i._addMatchInfoToCRNodes(e.relName,e.adjFlagArray,r,s,e.instFlagNdxs),n&&"UNRELATED"==e.relName&&0==i._COMPUTE_DIFFERENT)return i._addCRNodesForUnmatchedChildren([t]),void i._addCRNodesForUnmatchedChildren([o]);i._markParentsDiff(r,s);var a=t.getChildArray(),l=o.getChildArray();(a.length>0||l.length>0)&&i._processNodeSets(a,l)}),(s.length>0||a.length>0)&&(1==i._COMPUTE_DIFFERENT?i._processUnmatchedChildren_forDiff(s,a):(i._addCRNodesForUnmatchedChildren(s),i._addCRNodesForUnmatchedChildren(a)))},r.prototype._addCRNodesForUnmatchedChildren=function(e){if(null!=e){var t=[];e.forEach(function(e){e.getChildArray().forEach(function(e){t.push(e)})}),this._addCRNodes(t),t.length>0&&this._addCRNodesForUnmatchedChildren(t)}},r.prototype._processUnmatchedChildren_forDiff=function(e,t){var i=[],n=[];e.forEach(function(e){e.getChildArray().forEach(function(e){i.push(e)})}),t.forEach(function(e){e.getChildArray().forEach(function(e){n.push(e)})}),this._processNodeSets(i,n)},r.prototype._markParentsDiff=function(e,t){if(null!=e&&null!=t){var i=e.getParent(),n=t.getParent(),o=0;if(o+=null!=i?1:0,0!=(o+=null!=n?1:0))if(1!=o){var r=i.getMatchInfo(),s=i.getMatchInfo(),a=0;if(a+=null!=r?1:0,0==(a+=null!=s?1:0)){this._addMatchInfoToCRNodes("DIFFERENT",[],i,n,[]),this._stats.diffCount++,this._markParentsDiff(i,n)}else{if(1==a)return void console.error("MarkParentsDiff() failed sanity check - one parent already assigned");if(r==s&&"UNRELATED"==r.getRelName())return r.resetRelName("DIFFERENT"),void this._stats.diffCount++}}else console.error("MarkParentsDiff() failed sanity check - one node is root")}else console.error("markParentsDiff() fails sanity check: one of these nodes is null")},r.prototype._compareTrees=function(t,i){this._missingAttrVals=!1;var n=new e,o=t.getRoot(),r=i.getRoot(),s=this._createCRNode(o);o._crNode=s,n.setRoot(0,t.getObjIDSpec(),s);var a=t.getObjIDSpec().isFiltered();let l=t.getObjIDSpec().getExternalFilterSpec();if(a)if(null!=l){let e=l.filterTitle;s.setExternalFilterName(e)}else s.setExternalFilterName("");var u=this._createCRNode(r);r._crNode=u,n.setRoot(1,i.getObjIDSpec(),u);let c=i.getObjIDSpec().isFiltered(),d=i.getObjIDSpec().getExternalFilterSpec();if(c)if(null!=d){let e=d.filterTitle;u.setExternalFilterName(e)}else u.setExternalFilterName("");return this._processNodeSets([o],[r]),n},r.prototype._cleanup=function(e){var t=this;e.forEach(function(e,i){var n=0;e.visit_riTreeAndFN(function(e){return n++,delete e._crTree,!0}),t._plugSvcs.dbgout(" --\x3e Tree #"+i+" node count      : "+s(7,n))})},r.prototype._initTreeCompareStats=function(){this._stats={processedNodeSetCount:0,totalMatchedFoundCount:0,totalMatchedUsedCount:0,unmatchedCount:0,diffCount:0,rootWasForced:!1,dump:function(e){var t=this;e(" Total node sets processed   : "+s(7,t.processedNodeSetCount)),e(" Total matches found         : "+s(7,t.totalMatchedFoundCount));var i="";t.rootWasForced&&(i=" (+ 1 b/c root was forced)"),e(" Total matches Used          : "+s(7,t.totalMatchedUsedCount)+i),e(" Unmatched Nodes             : "+s(7,t.unmatchedCount)),e(" Unmatched Changed to 'diff' : "+s(7,t.diffCount))}}},r.prototype.doCompare=function(e,t,i){var n=this;return n._plugSvcs=i,n._options=t,new Promise(function(i,o){var r=n._plugSvcs.nowMS();n._initInternals(t).then(function(t){var o=[],s=e[0],a=s.getRoot().get_dbObj_REF().getAttr("ds6w:label");null==a&&(a=s.getRoot().get_dbObj_REF().getAttr("Title"));for(var l=e.length,u=1;u<l;u++){var c=e[u],d=c.getRoot().get_dbObj_REF().getAttr("ds6w:label");null==d&&(d=c.getRoot().get_dbObj_REF().getAttr("Title")),n._initTreeCompareStats(),n._plugSvcs.dbgout("vvvvvvvvvvvvvvvvvvvvv  COMPARING TREES  vvvvvvvvvvvvvvvvvvvvv <<<<"),n._plugSvcs.dbgout(" Roots are                   : '"+a+"' & '"+d+"'");var p=n._compareTrees(s,c);p.sortTreeNodes(),n._stats.dump(n._plugSvcs.dbgout),o[u-1]=p,l>2&&n._plugSvcs.dbgout("------------------------------------------------------------------")}n._cleanup(e),n._plugSvcs.dbgout("^^^^ ^^^^^^^^^^^^^^^^  COMPARING TREES  ^^^^^^^^^^^^^^^^^^^^^ <<<<"),n._plugSvcs.reportTime(r,"----ALL tree structure comparisons are done----: "),i(o)},function(e){n._plugSvcs.errout("Failed comparing structures: "+e),o(e)})})},r}),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/structCompareEngine"],function(e,t){return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n),this._engine=null},onLoad:function(){return this._engine=new t(this._plugSvcs),!0},onDestroy:function(){this._engine=null},execute:function(e,t){var i=this;i._parent(e,t);var n=e;i._engine.doCompare(n,t,this._plugSvcs).then(function(e){if(null!=e){var n={crTreeArray:e,ruleNames:t.CUSTOM_RELATIONSHIP_NAMES,destroy:function(){Array.isArray(this.crTreeArray)&&(this.crTreeArray.forEach(function(e){e.destroy()}),this.crTreeArray=null)}};i.reportOK(n)}else i.reportKO("FAILURE performing struct compare: 'null crTree returned'")},function(e){i.reportKO("FAILURE performing struct compare: "+e)})}})}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structComparePanel",["DS/CompareCommon/DragAndDrop","DS/CompareCommon/Utils","DS/CompareCommon/CompareIdDataListItem","DS/CompareCommon/Input/RevisionsManager","DS/CompareCommon/Input/FilterManager","DS/CompareCommon/Input/SearchManager","DS/CustomizableLayout/View","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/Overview","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/Trees","DS/CompareWidget2/support/objIDSpec","DS/CompareWidget2/viewComponents/StandardCompareToolbar","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structExpandCollapseMenu","DS/CompareWidget2/ViewDefModules/DSColors","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/externalController","DS/UIKIT/Mask","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/flagInfo","DS/CompareWidget2/support/typeHierMgr","DS/CompareWidget2/support/attrNLS_mgr","DS/CompareWidget2/support/cw2Utils","i18n!DS/CompareCommon/assets/nls/CompareInput","i18n!DS/CompareCommon/assets/nls/CompareCustomization","i18n!DS/CompareWidget2/assets/nls/CompareV2","i18n!DS/CompareWidget2/assets/nls/DisplayMessages","css!UIKIT/UIKIT.css","css!DS/CompareWidget2/CompareWidget2.css"],function(e,t,i,n,o,r,s,a,l,u,c,d,p,h,_,f,g,m,S,C,T,E,v){"use strict";const I=["REF_ds6w:label_ATTR"];function y(e,t,i){let n=[];if(null==t||""===t){if(null!=e)for(const[t,o]of Object.entries(e))i&&-1!==o.name.indexOf("INST")||n.push(t),n=n.filter(e=>!I.includes(e))}else{let r="string"==typeof t?[t]:t;for(var o of r)if(null!=e&&null!==o&&""!==o)for(const[t,r]of Object.entries(e))r.origin===o&&(i&&-1!==r.name.indexOf("INST")||n.push(t),n=n.filter(e=>!I.includes(e)))}return 0!=n.length?n:null}return s.extend({init:function(e,i,n,r){this._parent(n),this._plugSvcs=i;let s=[];null!=r&&(s=Object.keys(r)),this._isCustomCompare=s.length>0,this._customAttrNames=r||{},this._statusFilterHideChildIfParentIsHidden=!0,this._skeletonBuilt=!1,this._OKfn_forShowResults=null,this.cellDragEnabledFlag=!!n.CELL_DRAG_ENABLED_FLAG,this._forceRootsTogether=!0,this.elements.container=e,this._showHideNodeParamsOnTypeAndAttribute=n.SHOW_HIDE_NODE_PARAMS,this._aggVisibilityFilterModels={showByStatusFilter:{filterId:"set",filterModel:[1]}},this._allowedDisplayModes=[{id:"tree",icon:"tree-view-all",title:E.StructureView,tooltip:t.generateTooltip("CompareWidget2/Tooltips","StructureView"),expandCollapseEnabled:!0},{id:"list",icon:"view-list",title:E.ListView,tooltip:t.generateTooltip("CompareWidget2/Tooltips","ListView"),expandCollapseEnabled:!1}],this._displayMode="tree",this._multiStatusesToHideAnd=!1,this._statusesHidden=[],this._statusesUnchecked=[],this._structMatchPairArray=[],this._listMatchPairArray=[],this._listIsComputed=!1,this._structIsComputed=!1,this._currentExpandMenuId="expandAll",this._activeColData=null,this._flagInfo=new f(n,i),this._activeTrees=null,this._activeMatchPairArray=[],this._suspendExpandUpdates=!1;var a=n.CONTEXT_MENU_PLUGIN||"DS/CompareWidget2/viewComponents/ContextMenuBase",l=this;require([a],function(e){l._contextMenuPlugin=new e({structComparePanel:l}),l.buildSkeleton(n,l._customAttrNames)},function(e){console.error("FAILED TO LOAD "+a+": msg:"+e)}),this._externalController=new h(this._getActiveTree.bind(this),this.isList.bind(this),i.dbgout),o.setApplyCallback(this,[{whichOne:"left"},{whichOne:"right"}],this.onApplyNGFilter)},getExternalController:function(){return this._externalController},_getActiveTree:function(){return this._activeTrees},buildSkeleton:function(e,t){var i=this.elements.container;this._expandCollapseMenu=new d({structComparePanel:this}),this.standardToolbar=new c(i,this,{navigateDifferences:!0,showCompareLegend:!0,otherMenuItems:this.applyOtherMenuCommands(),CUSTOM_PROFILE_IN_USE:!0===this.options.CUSTOM_PROFILE_IN_USE});var n=e.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,o=e.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR;if(this._structTrees=new l({dataGridConfigArray:this.generateDataGridConfig({baselineColor:n,compareColor:o,displayView:"tree",customAttrNames:t}),onSelectRow:this.onTreesSelectRow.bind(this),onUnselectRow:this.onTreesUnselectRow.bind(this),onCollapse:this.onTreesCollapse.bind(this),onExpand:this.onTreesExpand.bind(this),onPreCollapse:this.onTreesPreCollapse.bind(this),onPreExpand:this.onTreesPreExpand.bind(this),baselineColor:n,compareColor:o,onContextMenu:this._contextMenuPlugin.createContextMenu.bind(this._contextMenuPlugin),rowSelection:"multiple",cellDragEnabledFlag:this.cellDragEnabledFlag,showNodeKPIColorFlag:null!=t&&Object.keys(t).length>0}),this._structTrees.inject(i),this._listTrees=new l({dataGridConfigArray:this.generateDataGridConfig({baselineColor:n,compareColor:o,displayView:"list",customAttrNames:t}),onSelectRow:this.onTreesSelectRow.bind(this),onUnselectRow:this.onTreesUnselectRow.bind(this),baselineColor:n,compareColor:o,onContextMenu:this._contextMenuPlugin.createContextMenu.bind(this._contextMenuPlugin),rowSelection:"single",cellDragEnabledFlag:this.cellDragEnabledFlag,showNodeKPIColorFlag:Object.keys(t).length>0}),this._listTrees.inject(i),this._listTrees.hide(),this._skeletonBuilt=!0,null!=this._OKfn_forShowResults){var r=this._OKfn_forShowResults;this._OKfn_forShowResults=null,this._doShowResults(r)}},dragEnterPanel:function(e){var t=this._activeTrees.dataGridViews.every(function(e){return!e.draggingFromCompare});void 0!==e.currentTarget&&null!==e.currentTarget&&t&&e.currentTarget.parentElement.addClassName("ft-drop-cue-on")},dragLeavePanel:function(e){void 0!==e.currentTarget&&null!==e.currentTarget&&e.currentTarget.parentElement.removeClassName("ft-drop-cue-on")},dropHandler:function(n,o,r){if(this._activeTrees.dataGridViews.every(function(e){return!e.draggingFromCompare})){if(o.objArray.length>1)return void this._plugSvcs.showAlertBox("DROP_1_OBJ_REPLACE",v,"error");for(var s=t.fetchPersistedIDs(),a=o.objArray,l=a.map(function(e){return e.objectId}),c=a.map(function(e){var t={};for(var i in e)t[i]=e[i];return t}),d=l.length,p=0;p<d;++p){var h=new i(l[p],c[p]);"drop-left"===r?s.items[0]=h:"drop-right"===r&&(s.items[1]=h)}t.persistIDs(s);var _="drop-left"===r?0:1,f=[];o.objArray.forEach(function(e){var t=new u(e.objectId,e.objectType,e.contextId,e.envId,e.serviceId);f.push(t)}),this._plugSvcs.postEvent("Event_replaceCompare",{targetIndex:_,objIDSpecArray:f})}this._activeTrees.dataGridViews.forEach(e=>e.draggingFromCompare=!1),e.reset()},generateDataGridConfig:function(e){return[{cols:this["tree"===e.displayView?"getTreeCols":"getListCols"](e,"baseline"),createTreeNodeConfig:this.createTreeNodeConfig.bind(this),colorIndicator:e.baselineColor,gridViewContainerParams:{id:"tree"===e.displayView?"compare-tree-left":"compare-list-left",panelCaption:"Left",panelAddClass:"treePanel-cmpBase",panelCollapseable:!0,initSize50pct:!0,color:e.baselineColor,styles:{display:"flex","flex-direction":"column","border-top":"4px solid "+e.baselineColor,width:"50%"}}},{cols:this["tree"===e.displayView?"getTreeCols":"getListCols"](e,"compare"),createTreeNodeConfig:this.createTreeNodeConfig.bind(this),colorIndicator:e.compareColor,gridViewContainerParams:{id:"tree"===e.displayView?"compare-tree-right":"compare-list-right",panelCaption:"Right",panelAddClass:"treePanel-cmpCmp",panelCollapseable:!1,initSize50pct:!0,styles:{display:"flex","flex-direction":"column","border-top":"4px solid "+e.compareColor,padding:"0px 3px",width:"50%"}}}]},getTreeCols:function(e,t,i){let n=this,o=[],r={dataIndex:"tree",typeRepresentation:"string",width:"auto",resizableFlag:!1};if(1==this._isCustomCompare){let s=y(e.customAttrNames,"matching_rule",i),a=y(e.customAttrNames,"additional_status",i);r.text=E.get("TitleColumnHeader"),r.icon={iconName:"product",fontIconFamily:WUXManagedFontIcons.Font3DS},null!==a&&(r.minWidth=200,r.pinned="left",r.sortableFlag=!1,r.resizableFlag=!0),r.getCellKPIColor=function(i){let n=i.nodeModel.options.data;return n.getMatchInfo().getBaseNode().isDummy()||n.getMatchInfo().getCompNode().isDummy()?null:n.getMatchInfo().isAttributeValueEqual("title")||null==n.getAttr("title")||""===n.getAttr("title")?null:e[`${t}Color`]},r.onCellRequest=function(e){let t=e.cellView.getContent(),i=t.getElement(".wux-layouts-datagridview-kpi-color");if(null!=i){t.removeChild(i);let e=t.getElement(".wux-layouts-datagridview-tweaker-container");i.setStyle("outline-width","2px"),i.setStyle("margin-left","2px"),t.insertBefore(i,e)}},o.push(r),null!==s&&s.forEach(function(i,r){var s={text:e.customAttrNames[i].name,icon:{iconName:e.customAttrNames[i].icon,fontIconFamily:WUXManagedFontIcons.Font3DS},dataIndex:"custAttr_"+e.customAttrNames[i].name,width:150,minWidth:25,typeRepresentation:"string",sortableFlag:!1,resizableFlag:!0};null!==a&&(s.pinned="left"),s.getCellKPIColor=function(i){let n=this.columns[i.columnID].dataIndex.split("custAttr_").pop(),o=i.nodeModel.options.data;return o.getMatchInfo().getBaseNode().isDummy()||o.getMatchInfo().getCompNode().isDummy()||"tree"===n?null:o.getMatchInfo().isAttributeValueEqual(n)||null==o.getAttr(n)||""===o.getAttr(n)?null:e[`${t}Color`]},s=n._specializeCol(i,s),o.push(s)}),null!==a&&a.forEach(function(i,r){var s={text:e.customAttrNames[i].name,icon:{iconName:e.customAttrNames[i].icon,fontIconFamily:WUXManagedFontIcons.Font3DS},dataIndex:"custAttr_"+e.customAttrNames[i].name,width:150,minWidth:25,typeRepresentation:"string",sortableFlag:!1,resizableFlag:!0,getCellKPIColor:function(i){let n=this.columns[i.columnID].dataIndex.split("custAttr_").pop(),o=i.nodeModel.options.data;return o.getMatchInfo().getBaseNode().isDummy()||o.getMatchInfo().getCompNode().isDummy()||"tree"===n?null:o.getMatchInfo().isAttributeValueEqual(n)||null==o.getAttr(n)||""===o.getAttr(n)?null:e[`${t}Color`]}};s=n._specializeCol(i,s),o.push(s)})}else{o.push(r);let e={dataIndex:"rev",typeRepresentation:"string",width:35,minWidth:25,sortableFlag:!1,resizableFlag:!0};o.push(e)}return o},_specializeCol:function(e,t){switch(e){case"REF_ds6w:status_ATTR":delete(t=UWA.extend(t,{typeRepresentation:"tag",width:90,hasCellValue:function(e){return!!(e.nodeModel&&e.nodeModel.getLabel()&&e.nodeModel.getLabel().length>0)},getCellClassName:function(e){if(e.nodeModel&&e.nodeModel.options.data)return e.nodeModel.options.data.getAttr("maturity.class")}})).getCellKPIColor;break;case"REF_ds6w:reserved_ATTR":case"INST_ds6w:reserved_ATTR":t=UWA.extend(t,{typeRepresentation:"icon",width:80,getCellValue:function(t){let i=t.nodeModel.options.grid["REF_ds6w:reserved_ATTR"===e?"custAttr_REF.ds6w:reserved":"custAttr_INST.ds6w:reserved"];return"TRUE"===i?"lock":"FALSE"===i?"lock-open":null}});break;case"REF_ds6wg:revision_ATTR":t=UWA.extend(t,{width:80})}return t},getListCols:function(e,t){let i=this.getTreeCols(e,t,!0),n={dataIndex:"qty",width:1==this._isCustomCompare?50:30};return 1==this._isCustomCompare&&null!=y(e.customAttrNames,"additional_status",!0)&&(n.pinned="left",n.sortableFlag=!1,n.resizableFlag=!0,n.minWidth="30"),1==this._isCustomCompare&&(n.text=E.get("QuantityColumnHeader")),i.unshift(n),i},getEachGridColorColumns:function(){for(var e=this,i=[[]],n=[],o=e._flagInfo.getActiveMaxFlags(),r=0;r<o;r++){var s={typeRepresentation:"color",dataIndex:"FLAG_"+r.toString(),width:8.5,minWidth:8.5,hasCellValue:function(t){var i=!1,n=t.columnID,o=this.columns[n].dataIndex;if(o.startsWith("FLAG_")){var r=Number(o.split("_")[1]),s=t.nodeModel.options.data,a=e._areAnyMatchPairChildrenVisible(s),l=s.getMatchInfo().getAllStatusArray(!a);if(Array.isArray(l)&&r<l.length){var u=l[r],c=e._flagInfo.getActiveFlagDisplayData(u);if(null!=c){var d=c.color,h=c.visibleFlag;null!=d&&d!==p.colorDef.WHITE&&1==h&&(i=!0)}}}return i},getCellTooltip:function(i){var n,o,r=null==i.nodeModel?null:i.nodeModel.options.data.getMatchInfo();r&&(o=r.getAllStatusArray(!0));var s,a=Number(i.columnID),l=e._flagInfo.getActiveFlagDisplayData();if(Array.isArray(o)&&a<o.length&&o.length>0){var u=l[o[a]];if(null!=u.color&&u.visibleFlag){n=u.label;var c=u.modulePath;Object.entries(E).map(([e,i])=>{i===n&&(s=t.generateTooltip(c,e))})}}return s}};this._isCustomCompare&&null!=y(this._customAttrNames,"additional_status",this.isList())&&(s.pinned="left",s.resizableFlag=!1,s.sortableFlag=!1),s.onCellRequest=function(e){this.defaultOnCellRequest(e),e.cellView.getContent().addClassName("compare-color-column")},n.push(s)}return i.push(n),i},createTreeNodeConfig:function(e){var t={data:e,label:e.getAttr("title"),icons:[e.getAttr("typeIconSmallURL")],grid:{rev:e.getAttr("revision"),type:e.getAttr("type"),showByStatusFilter:1}},i=e.getCustomRuleAttrs();(null!=i?Object.keys(i):[]).forEach(function(e,n){["ds6w:created","ds6w:modified"].some(t=>-1!==e.indexOf(t))?t.grid["custAttr_"+e]=S.formatDate(i[e]):t.grid["custAttr_"+e]=i[e]});var n=e.getMatchInfo(),o=this;return t.grid.showHideNodeOnTypeAndAttribute=n.getShowHideNodeByTypeAndAttrParamIndex(),"relations"!==e.getAttr("type")&&(t.grid.qty=e.qty),e.hasExternalFilter()&&(t.badges={bottomRight:"filter wux-layouts-treeview-badge compare-badge"}),n.getAllStatusArray(!0).forEach(function(e,i){var n=o._flagInfo.get_statusIDFlag(e);t.grid["FLAG_"+i]=n.color}),t},applyOtherMenuCommands:function(){var e=this,i=[];return this._allowedDisplayModes.some(e=>e.expandCollapseEnabled)&&i.push({id:"expandCollapse",dataElements:{domId:"compare-struct-expansion-button",typeRepresentation:"functionIcon",label:E.chooseTreeExpansion,tooltipInfos:t.generateTooltip("CompareWidget2/Tooltips","chooseTreeExpansion"),position:"far",priority:1,overflowPriority:"never",icon:{iconName:"expandAll"===e._currentExpandMenuId?"flow-tree-expand-down":"flow-tree-expand-up",fontIconFamily:1},value:t=>e._displayMenu(e._expandCollapseMenu.getExpandCollapseMenu(),t.dsModel.elements.container)}}),e._allowedDisplayModes.length>1&&i.push({id:"structPanelViewSelector",dataElements:{domId:"compare-struct-display-style-button",typeRepresentation:"functionIcon",label:E.chooseTreeOrListView,tooltipInfos:t.generateTooltip("CompareWidget2/Tooltips","chooseTreeOrListView"),position:"far",icon:{iconName:e._allowedDisplayModes.find(t=>t.id===e._displayMode).icon,fontIconFamily:1},priority:1,overflowPriority:"never",value:t=>{e._displayMenu(e._allowedDisplayModes.map(t=>({type:"RadioItem",title:t.title,id:t.id,tooltip:t.tooltip,icon:t.icon,state:e._displayMode===t.id?"selected":"unselected",action:{callback:()=>e.handleToolbarCommands({event:"displayView",data:{mode:t.id,tooltip:t.tooltip,icon:t.icon}})}})),t.dsModel.elements.container)}}}),i},_displayMenu:function(e,t){var i=this;require(["DS/Menu/Menu"],n=>{var o=t.getBoundingClientRect(),r={position:{x:o.right,y:o.bottom},layout:"topright",input:i.isTouch?"touch":"mouse"};n.show(e,r)})},destroy:function(){this._externalController.destroy(),this._externalController=null,this.elements.container=null,this._activeTrees=null,null!=this._structTrees&&(this._structTrees.destroy(),this._structTrees=null),null!=this._listTrees&&(this._listTrees.destroy(),this._listTrees=null),this.overview=null,this._plugSvcs=null,this._structMatchPairArray=null,this._listMatchPairArray=null,this._activeMatchPairArray=null},handleToolbarCommands:function(e){switch(e.event){case"legendApplyFilter":this.applyStatusFilters(),this._updateToolbarDiffCount(),this._updateUserFilterSettings("legendFilter");break;case"legendApplyVisibility":this._showStatusChooserDialog(e);break;case"navigatePrevious":case"navigateFirst":case"navigateLast":case"navigateNext":this.onNavigate(e.event);break;case"displayView":this._displayMode!==e.data.mode&&(this.showResults(e.data.mode),this.standardToolbar.update({displayIcon:[{id:"structPanelViewSelector",icon:e.data.icon}],enableDisableCommands:[{id:"expandCollapse",disabled:this.isList()}]}));break;case"expandAll":case"collapseAll":case"expandNLevels":this.standardToolbar.update({displayIcon:[{id:"expandCollapse",icon:e.data.icon}]}),this._currentExpandMenuId=e.event,"expandNLevels"===e.event?this._expandNLevels_showPopup():this._expandCollapse("collapseAll"!==e.event,-1);break;case"revisionsDlg":this._displayHistoryGraph(e.data.whichSide,e.data.objIDSpecREF);break;case"filterPanel":this._displayFilterPanel(e.data.whichSide,e.data.objIDSpecREF)}},_updateUserFilterSettings:function(e){let t=this;function i(e,i,n){let o=t._flagInfo.getActiveFlagDisplayData();for(let[r,s]of Object.entries(o))r!==n&&(!0===s[e]&&t[i].indexOf(r)>=0?t[i]=t[i].filter(e=>e!==r):!1===s[e]&&-1===t[i].indexOf(r)&&(t[i]=[...t[i],r]))}switch(e){case"legendFilter":i("checked","_statusesUnchecked");break;case"legendVisibility":i("visibleFlag","_statusesHidden","IDENTICAL")}},_expandNLevels_showPopup:function(e){var t=this;require(["DS/PADUtils/views/PADLevelSel"],function(i){new i({current_level:1,events:{onApply:function(e){t._expandCollapse(!0,parseInt(e)||-1)}}});if(null!=e&&void 0!==e.position&&null!==e.position&&e.position.x>0&&e.position.y>0){var n=jQuery(".pad_level_sel_modal > .modal-wrap");null!=n&&n.length>0&&(n[0].setStyle("padding-top","0px"),n[0].setStyle("margin-top",e.position.y+"px"),n[0].setStyle("margin-left",e.position.x+"px"))}})},_expandCollapse:function(e,t){var i=this;"tree"===this._displayMode&&(this._activeTrees.withUpdateLocked(()=>{i.beginSuspendExpandUpdates(),i._activeTrees.dataGridViews.forEach((n,o)=>{i._activeTrees.getNTHGridSelectedNodes(o).forEach(i=>{if(i.hasChildren()){var n={};-1==t?n.expandAll=!0:n.numberOfLevelsToExpand=t;try{e?-1==t?i.expandAll():(i.collapseAll(),i.expandNLevels(n)):i.collapseAll()}finally{}}else i.options.data.setExpandCollapseState("noExpandState")})}),i.endSuspendExpandUpdates()}),this.applyCurrentFilterToTrees())},getStatusFilterInfo:function(){var e=[],t=[],i=this._flagInfo.getActiveFlagDisplayData(),n=i.IDENTICAL.checked;return Object.keys(i).forEach(function(o){var r=i[o];0==r.checked||0==n&&0==r.visibleFlag?e.push(o):t.push(o)}),{offFlags:e,onFlags:t}},applyStatusFilters:function(){var e=this;0==_.isMasked(e.elements.container)&&_.mask(e.elements.container),setTimeout(()=>{let t=e.isList(),i=e.getStatusFilterInfo();e._updateMatchPairHiddenFlags_AND_ApplyToTreeNode(t,i.offFlags,e._multiStatusesToHideAnd),e._activeTrees.applyFilterModelToTrees(e._aggVisibilityFilterModels),e.doExpandCollapseUpdates(),e.onTreesSelectRow(),_.unmask(e.elements.container)},0)},_updateMatchPairHiddenFlags_AND_ApplyToTreeNode:function(e,t,i){let n=i?"both":"either",o={};t.forEach(function(e){o[e]=!0});let r=e?this._crTree.getCRList().getMatchPairArray():this._crTree.getMatchPairArray(),s=r.length;for(let t=e?0:1;t<s;t++){let i=r[t],s=i.getRelName(),a=1==o[s];"both"==n?a&&e&&i.qtyIsDiffFlag&&(a&=1==o.QUANTITY):a||e&&i.qtyIsDiffFlag&&o.QUANTITY&&(a=!0),"both"==n?a&&i.getAdjFlagArray().forEach(function(e){a&=1==o[e]}):a||i.getAdjFlagArray().forEach(function(e){o[e]&&(a=!0)});let l=i.getBaseNode().getParent(),u=i.getCompNode().getParent(),c="object"!=typeof l||"object"!=typeof u,d=!0;if(this.isList()||c||!this._statusFilterHideChildIfParentIsHidden)d=!a;else{let e=l.getMatchInfo();d=this._statusFilterHideChildIfParentIsHidden&&!a&&e&&!e.getIsHidden_byStatusFilter()}i.setIsHidden_byStatusFilter(!d);let p=Number(d);i.getTreeNodes().forEach(e=>e.options.grid.showByStatusFilter=p)}},legendApplyVisibility:function(e){let t=this._flagInfo.getActiveFlagDisplayData(),i=[];var n=!0;for(let[o,r]of Object.entries(e))n=n&&r,t[o].visibleFlag!==r&&(t[o].visibleFlag=r,i.push({id:o,visibleFlag:r}));return i.length&&(t.IDENTICAL.matchedPairs.length||i.push({id:"IDENTICAL",visibleFlag:!n}),this.standardToolbar.update({showHideCommands:i}),this.doExpandCollapseUpdates()),{bAtLeastOneHidden:!n,bApplyChanges:i.length>0}},_showStatusChooserDialog:function(){var e=this._flagInfo.getActiveFlagDisplayData(),t=this;require(["DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/statusVisibilityDialog"],i=>{new i({statuses:e,OKfn:e=>{let i=this.legendApplyVisibility.bind(this)(e);i.bApplyChanges&&(this._updateUserFilterSettings("legendVisibility"),this._updateToolbarDiffCount()),i.bAtLeastOneHidden&&t._plugSvcs.showAlertBox(v.HIDDEN_STATUSES_IDENTICAL,null,"info")}})})},getDifferenceCount:function(){let e=this._flagInfo.getActiveFlagDisplayData();return this._activeMatchPairArray.filter(t=>t.getAllStatusArray().some(t=>"IDENTICAL"!==t&&e[t].checked&&e[t].visibleFlag)&&t.getBaseNode().__TREENODE__.isVisible()).length},clearView:function(){this._activeTrees&&this._activeTrees.clear()},getAttrNLS:function(e,t){var i=t.getRootObjIDSpec(0),n=i.getObjType(),o=i.getSecurityContext(),r=i.getTenant();let s={},a=Object.keys(e);for(var l of a)s[l]=e[l].name;return m.getAttrNLS(s,n,r,o)},updateResults:function(e,t){var i=this;return i._crTree=t,i._listIsComputed=!1,i._structIsComputed=!1,i._plugSvcs.postEvent("COMPARE_PANEL_UPDATED_EVENT",{}),i.showResults()},_resetTypeFiltersOn:function(e){Object.keys(e).forEach(function(t){e[t].checked=!0})},_applyStatusDisplaySettings:function(e){for(let[t,i]of Object.entries(e))i.visibleFlag="IDENTICAL"===t?i.matchedPairs.length>0||Array.isArray(this._statusesHidden)&&this._statusesHidden.length>0&&this._statusesHidden.some(t=>null!=e[t]&&e[t].matchedPairs.length):Array.isArray(this._statusesHidden)&&-1===this._statusesHidden.indexOf(t)},showResults:function(e){var t=this;return t._allowedDisplayModes.findIndex(t=>t.id===e)>=0&&(t._displayMode=e),new Promise(function(e,i){0==t._skeletonBuilt?t._OKfn_forShowResults=e:t._doShowResults(e)})},_setupDnD:function(){var t=this;e.attachObject("compare-tree-left",t,t.dragEnterPanel,t.dragLeavePanel,t.dropHandler),e.attachObject("compare-tree-right",t,t.dragEnterPanel,t.dragLeavePanel,t.dropHandler),e.attachObject("compare-list-left",t,t.dragEnterPanel,t.dragLeavePanel,t.dropHandler),e.attachObject("compare-list-right",t,t.dragEnterPanel,t.dragLeavePanel,t.dropHandler)},_placeAttrNLSinTooltips:function(e,t){for(const[n,o]of Object.entries(e))if(void 0!==o.tooltip.shortHelp&&null!==o.tooltip.shortHelp&&o.tooltip.shortHelp.length>0){let r="";for(var i of o.tooltip.shortHelp){let e=i.name;"and"===i.info?r+=" "+T.get("RuleAnd")+" ":"or"===i.info&&(r+=" "+T.get("RuleOr")+" "),void 0!==t[e]&&null!==t[e]&&""!==t[e]?r+=t[e]:r+=e}let s=E.get("same"===o.tooltip.shortHelp[0].info?"CustomMatchingRuleShortHelp":"CustomAdditionalStatusShortHelp").replace("{msgData}",r);e[n].tooltip.shortHelp=s,e[n].tooltip.longHelp=E.get("CustomLegendLongHelp")}},_updateTrees:function(e,t,i,n){var o=this;o._activeTrees.update(e,t,i,function(){o._setupDnD();var e=o._flagInfo.getActiveFlagDisplayData_excludeFilteredByTypeAttr();void 0===o.options.PROPS||null===o.options.PROPS?o._updateTrees_finish(e,n):o.getAttrNLS(o.options.PROPS,o._crTree).then(function(i){t&&o._placeAttrNLSinTooltips(e,i),o._updateTrees_finish(e,n)},function(t){console.error("Failed to retrieve NLS values for attributes in legend tooltips. Continuing..."),o._updateTrees_finish(e,n)})}.bind(o))},_updateTrees_finish:function(e,t){this.onTreesReady(e),this.onResize(),this._syncOverview(),this._updateToolbarDiffCount(),_.unmask(this.elements.container),t()},_doShowResults:function(e){var t=this;0==_.isMasked(t.elements.container)&&_.mask(t.elements.container),"tree"===t._displayMode?t.setup_tree():t.setup_list(),t._applyStatusDisplaySettings(t._flagInfo.getActiveFlagDisplayData()),t._resetTypeFiltersOn(t._flagInfo.getActiveFlagDisplayData()),t._activeTrees.setEachGridColorColumns(t.getEachGridColorColumns()),1==t.options.CUSTOM_PROFILE_IN_USE?t.getAttrNLS(t.options.PROPS,t._crTree).then(function(i){var n=i;t._updateTrees(t._activeColData,!0,n,e)},function(e){console.error("Failed to retrieve NLS header values for attrs. Continuing..."),t._updateTrees(t._activeColData,!0,{},OKfb)}):t._updateTrees(t._activeColData,!1,{},e)},setup_tree:function(){var e=this;e._structIsComputed||(e._structMatchPairArray=e._crTree.getMatchPairArray(),e._setup_allMatchPair_hiddenByTypeAttr(e._structMatchPairArray,e._aggVisibilityFilterModels.showHideNodeOnTypeAndAttribute),e._flagInfo.createFlagDisplayData("tree",e._structMatchPairArray,e._forceRootsTogether),e._structIsComputed=!0),e._listTrees&&e._listTrees.hide(),e._structTrees&&e._structTrees.show(),e._activeColData=[e._crTree.getRoot(0),e._crTree.getRoot(1)],e._activeMatchPairArray=e._structMatchPairArray,e._flagInfo.setActive("tree"),e._activeTrees=e._structTrees},setup_list:function(){var e=this;e._listIsComputed||(e._crList=e._crTree.getCRList(),e._listMatchPairArray=e._crList.getMatchPairArray(),e._setup_allMatchPair_hiddenByTypeAttr(e._listMatchPairArray,e._aggVisibilityFilterModels.showHideNodeOnTypeAndAttribute),e._flagInfo.createFlagDisplayData("list",e._listMatchPairArray,e._forceRootsTogether),e._listColData=e._crList.generateDisplayLists(),e._listIsComputed=!0),e._listTrees&&e._listTrees.show(),e._structTrees&&e._structTrees.hide(),e._activeColData=e._listColData,e._activeMatchPairArray=e._listMatchPairArray,e._flagInfo.setActive("list"),e._activeTrees=e._listTrees},onResize:function(){null!=this.overview&&(this.overview.onResize(),this.updateOverviewVisibility())},updateOverviewVisibility:function(){this._activeTrees.isScrollbarShown()?this.overview.show():this.overview.hide()},determineNodesToShow:function(e,t,i,n){var o="select"===i||null===e?t:e,r=this._flagInfo.getActiveFlagDisplayData(),s=!0,a=!0;for(var l in r)r[l].checked||(s=!1),r[l].checked&&(a=!1);if(a);else if(s){var u=o.getPath();""!==u&&n.push({IDPath:u})}else this._filterForStatusFlags(o,o===t,n)},_buildHideList:function(){for(var e={},t=this._listMatchPairArray,i=t.length,n=0;n<i;n++){var o=t[n],r="",s=o.getBaseNode();0==s.isDummy()&&(r=s.getAttr("physicalID_REF"));var a="",l=o.getCompNode();0==l.isDummy()&&(a=l.getAttr("physicalID_REF")),t[n].getIsHidden_byStatusFilter()&&(""!=r&&(e[r]=!0),""!=a&&(e[a]=!0))}return e},_filterForStatusFlags:function(e,t,i){var n=this._buildHideList(),o=this.isList();e.visitVisible_nodesAndFN(function(r){var s=!1;if(r!==e||!t){var a=r.getMatchInfo(),l="",u=a.getBaseNode();0==u.isDummy()&&(l=u.getAttr("physicalID_REF"));var c="",d=a.getCompNode();0==d.isDummy()&&(c=d.getAttr("physicalID_REF")),(""!=l&&1==n[l]||""!=c&&1==n[c])&&(s=!0)}var p=0!=r.getChildArray().length;if(0==s){if(!p){var h=r.getPath();return""!==h&&i.push({IDPath:h}),!1}return!0}return o})},onTreesSelectRow:function(e){var t=this;let i=!0===this._viewerDisplayModeIsolate?"isolate":"select";var n=this._activeTrees.getNTHGridSelectedNodes(0),o=this._activeTrees.getNTHGridSelectedNodes(1);if(!e||0!=n.length&&0!=o.length){var r=[],s=[],a=this.isList();if(a){[n,o].forEach(function(e,n){var o=[],a=[];e.forEach(function(e){var r=e.options.data;if(!r.isDummy()){var s=r.getAttr("physicalID_REF"),l=r.getAttr("physicalID_INST");t._crTree.visitVisible_treeAndFN(n,function(e){if(e.getAttr("physicalID_REF")==s){"isolate"===i&&t.determineNodesToShow(e,t._crTree.getDisplayRoot(n),i,a);var r=e.getDBContext(),c=new u(s,e.getAttr("type"),r.securityContext,r.tenant,r.serviceName),d=null;null!=l&&(d=new u(l,e.getAttr("type"),r.securityContext,r.tenant,r.serviceName));var p={ObjIDSpec:c,IDPath:e.getPath(),instObjIDSpec:d};o.push(p)}return!0})}}),"select"!==i&&0!==e.length||t.determineNodesToShow(null,t._crTree.getDisplayRoot(n),i,a),r.push(o),s.push(a)})}else{var l=[],c=[],d=[],p=[];n.forEach((e,n)=>{var r=e.options.data,s=null,a=null,u=r.getPath();"isolate"===i&&this.determineNodesToShow(r,t._crTree.getDisplayRoot(0),i,d),null==r||r.isDummy()||(s=r.getObjIDSpec_REF(),a=r.getObjIDSpec_INST()),null!=s&&l.push({ObjIDSpec:s,IDPath:u,instObjIDSpec:a});var h=n<o.length?o[n].options.data:null,_=null!==h?h.getPath():null;if("isolate"===i&&this.determineNodesToShow(h,t._crTree.getDisplayRoot(1),i,p),null!=h&&!h.isDummy()){var f=h.getObjIDSpec_REF(),g=null;g=h.getObjIDSpec_INST()}null!=f&&c.push({ObjIDSpec:f,IDPath:_,instObjIDSpec:g})}),"select"!==i&&0!==n.length||(this.determineNodesToShow(null,t._crTree.getDisplayRoot(0),i,d),this.determineNodesToShow(null,t._crTree.getDisplayRoot(1),i,p)),r.push(l),r.push(c),s.push(d),s.push(p)}t._plugSvcs.postEvent("NEW_CURRENT_SELECTION_EVENT",{isAsync:!0,selectedData:r,crTree:t._crTree,structDisplayMode:a?"LIST":"STRUCT"}),this._syncOverview()}},onTreesUnselectRow:function(){this._syncOverview(),this.onTreesSelectRow(!0)},onTreesPreCollapse:function(e){e.nodeModel.options.data.setExpandCollapseState(e.nodeModel.getState())},onTreesPreExpand:function(e){e.nodeModel.options.data.setExpandCollapseState(e.nodeModel.getState())},onTreesCollapse:function(e){e.nodeModel.options.data.setExpandCollapseState(e.nodeModel.getState()),this.doExpandCollapseUpdates()},onTreesExpand:function(e){e.nodeModel.options.data.setExpandCollapseState(e.nodeModel.getState()),this.doExpandCollapseUpdates()},beginSuspendExpandUpdates:function(){this._suspendExpandUpdates=!0},endSuspendExpandUpdates:function(){this._suspendExpandUpdates=!1,this.doExpandCollapseUpdates()},doExpandCollapseUpdates:function(){0==this._suspendExpandUpdates&&(this.onResize(),this._syncOverview(),setTimeout(()=>{this._updateToolbarDiffCount()},0))},onTreesExpandAll:function(e){this._expandCollapse(!0,-1)},buildOverviewKeyDiffArray:function(e){for(var t=this,i=[],n=e.getTreeDocument().getAllDescendants(),o=0;o<n.length;o++){var r=n[o];if(r.isVisible()){var s=[],a=r.options.data._matchInfo;if(a){var l=a.getBaseNode(),u=t._areAnyMatchPairChildrenVisible(l);a.getAllStatusArray(!u).forEach(function(e){let i=t._flagInfo.get_statusIDFlag(e);s.push(i)})}else{let e=t._flagInfo.get_statusIDFlag("IDENTICAL");s.push(e)}var c={objKey:o,flagDefArray:s,qtyDiff:!1};i.push(c)}}return i},onTreesReady:function(e){var t=this;this._applyShowHideNodesByTypeAndAttributes(),this._updateTreePanelCaptions(),null==this.overview&&(this.overview=new a,this.overview.inject(this.elements.container)),this.dispatchEvent("onTreesLoaded"),this._syncOverview(),this.standardToolbar.update({legend:e,enableDisableCommands:[{id:"expandCollapse",disabled:!this._allowedDisplayModes.find(e=>t._displayMode===e.id).expandCollapseEnabled},{id:"chooseStatusToDisplay",disabled:1===Object.keys(e).length&&null!=e.IDENTICAL&&e.IDENTICAL.visibleFlag}],modulePath:"CompareWidget2/Tooltips"})},_updateToolbarDiffCount:function(){let e=this.getDifferenceCount();this.standardToolbar.update({numDifferences:e})},_syncOverview:function(){if(void 0!==this.overview&&null!==this.overview){var e=this.buildOverviewKeyDiffArray(this._activeTrees.dataGridViews[1]);this.updateOverviewVisibility();var t=this._activeTrees.getNTHGridSelectedNodes(0),i=[];t.forEach(function(e){var t=e._getRowID();i.push(t)});var n=this._flagInfo.getActiveFlagDisplayData();this.overview.syncWithNewData(!0,e,i,n,this.isList())}},_displayHistoryGraph:function(e,i){var o=this;let r={objId:i.getPhysID(),objType:i.getObjType(),tenant:i.getTenant(),securityContext:i.getSecurityContext()};n.displayHistoryGraph(r,null,{allowDuplicates:!0},function(i){let n="left"===e?0:1,r=t.fetchPersistedIDs();r.items[n].objectId=i.physicalid,r.items[n].objectServices.objectId=i.physicalid,r.items[n].objectServices.objectType=i.type,r.items[n].objectServices.contextId=i.contextId,r.items[n].objectServices.displayName=i.displayName,r.items[n].objectServices.serviceId=i.serviceId,t.persistIDs(r);let s=new u(i.physicalid,i.type,i.contextId,i.envId);o._plugSvcs.postEvent("Event_replaceCompare",{targetIndex:n,objIDSpecArray:[s]})})},_displayFilterPanel:function(e,t){var i={objId:t.getPhysID(),objType:t.getObjType(),tenant:t.getTenant(),securityContext:t.getSecurityContext(),serviceName:t.getServiceName()};o.activateProxy(e),o.executeFilterCmd(e,i)},onApplyNGFilter:function(e){const i="CompareWidget_right"===e.appId?"right":"left",n="left"===i?0:1;let r=e.empty?null:e;var s=t.fetchPersistedIDs();s.items[n].filterData=r,e.empty?(s.items[n].filterSpec=null,t.persistIDs(s)):o.getFilterSpecificationPromise(i,r.filterRootIds[0]).then(function(e){1===e.status&&(s.items[n].filterSpec=e.publicSpec),t.persistIDs(s)},function(){t.persistIDs(s)});let a=s.items[n].objectServices;var l=new u(a.objectId,a.objectType,a.contextId,a.envId,a.serviceId,r);this._plugSvcs.postEvent("Event_replaceCompare",{targetIndex:n,objIDSpecArray:[l]})},_displaySearchPanel:function(e,i){var n=this,o=i.getTenant(),s=i.getSecurityContext(),a="left"===e?0:1;r.displaySearchPanel(o,!1,function(e){let i=e[0];if(null!=i){var r=i.id;[].push(r);var l=i.sourceid_value.split(":"),c={contextId:s,displayName:i["ds6w:label_value"],displayType:i["ds6w:type"],envId:l.length>1?l[1]:o,objectId:i.id,objectType:i["ds6w:type_value"],serviceId:l[0],preview_url:i.preview_url_value,type_icon_url:i.type_icon_url_value};[].push(c);var d=t.fetchPersistedIDs();d.items[a].objectId=c.objectId,d.items[a].objectServices.objectId=c.objectId,d.items[a].objectServices.objectType=c.objectType,d.items[a].objectServices.contextId=c.contextId,d.items[a].objectServices.displayName=c.displayName,d.items[a].objectServices.serviceId=c.serviceId,t.persistIDs(d);var p=new u(c.objectId,c.objectType,c.contextId,c.envId,c.serviceId);n._plugSvcs.postEvent("Event_replaceCompare",{targetIndex:a,objIDSpecArray:[p]})}})},getTreePanelCaptions:function(){function e(e,t,i,n){var o=null;return t&&((o={}).label=[],o.label.push({text:t.getAttr("title")}),o.label.push({text:t.getAttr("revision"),id:"treePanel-caption-revision-"+n,onClick:function(){e._displayHistoryGraph(n,i)}}),t.hasExternalFilter()&&o.label.push({text:t.getExternalFilterName(),id:"treePanel-caption-filter-"+n,onClick:function(){e._displayFilterPanel(n,i)}}),o.dropDown={id:"treePanel-caption-dropdown-"+n,onClick:function(){e._displayMenu(o.dropDown.item.map(e=>({type:"PushItem",title:e.text,icon:e.icon,action:{callback:e.onClick}})),this)}},o.dropDown.item=[],!1!==i._supportsRevisions&&o.dropDown.item.push({text:C.get("revisionCM"),icon:"flow-branch-list",onClick:function(){e._displayHistoryGraph(n,i)}}),!1!==i._supportsFilters&&o.dropDown.item.push({text:C.get("filterCM"),icon:"filter",onClick:function(){e._displayFilterPanel(n,i)}}),o.dropDown.item.push({text:C.get("openCM"),icon:"open",onClick:function(){e._displaySearchPanel(n,i)}})),o}var t=[],i=this._crTree.getRoot(1).getMatchInfo();if(i){let n=this._crTree.getRootObjIDSpec(0),o=this._crTree.getRootObjIDSpec(1),r=e(this,i.getBaseNode(),n,"left"),s=e(this,i.getCompNode(),o,"right");r&&s&&(t.push({panelContentId:this.isList()?"compare-list-left":"compare-tree-left",panelCaption:r}),t.push({panelContentId:this.isList()?"compare-list-right":"compare-tree-right",panelCaption:s}))}return t},_updateTreePanelCaptions:function(){var e=this;this.getTreePanelCaptions(this._addedEvents).forEach(function(t){e._activeTrees.setPanelCaption(t.panelContentId,t.panelCaption)})},onNavigate:function(e){var t=this._activeTrees.dataGridViews[0].getNodesXSO().get(),i=this._activeMatchPairArray;var n=-2;if("navigateFirst"===e)n=-1,e="navigateNext";else if("navigateLast"===e)n=i.length,e="navigatePrevious";else if(Array.isArray(t)&&t.length){var o=(t=t[t.length-1]).options.data.getMatchInfo();n=i.findIndex(e=>o===e)}if(-2!==n){var r=function(e,t,n){for(var o="navigateNext"===t?1:-1,r=e+o,s=i.length;"navigateNext"===t?r<s:r>=0;r+=o)if(i[r].getBaseNode().__TREENODE__.isVisible())for(let e of i[r].getAllStatusArray(!0))if("IDENTICAL"!==e&&n[e].visibleFlag)return i[r];return null}(n,e,this._flagInfo.getActiveFlagDisplayData());null!=r&&this._activeTrees.withUpdateLocked(function(){this._activeTrees.clearNTHGridSelection(0),r.getBaseNode().__TREENODE__.select(),this._activeTrees.dataGridViews[0].ensureNodeModelVisible(r.getBaseNode().__TREENODE__,!0,1)}.bind(this))}},getActiveExpandMenuId:function(){return this._currentExpandMenuId},isList:function(){return"list"===this._displayMode},getLabel:function(){return E.CompareStructurePanelTitle},getName:function(){return"structures"},onComparePanelUpdated:function(){void 0!==this._contextMenuPlugin&&null!==this._contextMenuPlugin&&this._contextMenuPlugin.onComparePanelUpdated()},onActivate:function(){setTimeout(()=>{this.onResize(),this._syncOverview()},0)},_setupShowHideNodesByTypeAndAttributeFilterModel:function(){Array.isArray(this._showHideNodeParamsOnTypeAndAttribute)&&this._showHideNodeParamsOnTypeAndAttribute.length?this._aggVisibilityFilterModels.showHideNodeOnTypeAndAttribute={filterId:"set",filterModel:this._showHideNodeParamsOnTypeAndAttribute.reduce((e,t,i)=>(!0===t.show&&e.push(i),e),[-1])}:delete this._aggVisibilityFilterModels.showHideNodeOnTypeAndAttribute},_applyShowHideNodesByTypeAndAttributes:function(){this._setupShowHideNodesByTypeAndAttributeFilterModel(),this._activeTrees.applyFilterModelToTrees(this._aggVisibilityFilterModels)},applyCurrentFilterToTrees:function(){this._activeTrees.applyFilterModelToTrees(this._aggVisibilityFilterModels),this._syncOverview()},_setup_allMatchPair_hiddenByTypeAttr:function(e){function t(e,t){return Array.isArray(t.TYPE)&&null!=e&&-1!==t.TYPE.findIndex(t=>e.getAttr("REF.ds6w:type")===t||g.isKindOf(e.getAttr("REF.ds6w:type"),t))&&(null==t.ATTRIBUTES||null!=t.ATTRIBUTES&&Object.keys(t.ATTRIBUTES).every(i=>t.ATTRIBUTES[i]===e.getAttr(i)))}this._setupShowHideNodesByTypeAndAttributeFilterModel();var i=this._aggVisibilityFilterModels.showHideNodeOnTypeAndAttribute,n=this;e.forEach(function(e){isNaN(e.getShowHideNodeByTypeAndAttrParamIndex())&&(Array.isArray(n._showHideNodeParamsOnTypeAndAttribute)&&n._showHideNodeParamsOnTypeAndAttribute.length?e.setShowHideNodeByTypeAndAttrParamIndex(n._showHideNodeParamsOnTypeAndAttribute.findIndex(i=>{var n=i.CHILD,o=i.PARENT,r=e.getBaseNode();(null==r||r.isDummy())&&(r=e.getCompNode());let s=r.getRefInstNode(),a=null!=s?s.getParent():null,l=t(s,n),u=null!=a&&(!o||null!=o&&t(a,o));return l&&u})):e.setShowHideNodeByTypeAndAttrParamIndex(-1))}),e.forEach(function(e){var t=e.getShowHideNodeByTypeAndAttrParamIndex(),n=null==i||i.filterModel.indexOf(t)>=0;e.setIsHidden_byTypeAttr(!n)})},_areAnyMatchPairChildrenVisible:function(e){var t=!1;if("expanded"==e.getExpandCollapseState()){var i=e.getChildArray();if(null!=i)for(var n=0;n<i.length;n++){if(0==i[n].getMatchInfo().getIsHidden_byAnyFilter()){t=!0;break}}}return t}})}),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",["DS/CompareWidget2/plugins/displayPlugin","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structComparePanel"],function(e,t){"use strict";return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n)},onEnabled:function(){var e=this;return e.subscribeEvent("STRUCT_UPDATE_IN_PROGRESS_EVENT",e.onUpdateInProgress.bind(e)),e.subscribeEvent("3DVIEW_NODES_SELECTED_EVENT",function(e){var t=e.data.nodePathArray;this._outputPanel._viewerDisplayModeIsolate||this._outputPanel.getExternalController().setSelectedNodes(t)}.bind(this)),e.subscribeEvent("3DVIEW_ALL_NODES_UNSELECTED_EVENT",function(e){if(!this._outputPanel._viewerDisplayModeIsolate){var t=this._outputPanel.getExternalController();t&&t.clearSelectedNodes(),this._plugSvcs.postEvent("NO_CURRENT_SELECTION_EVENT",{})}}.bind(this)),e.subscribeEvent("COMPARE_PANEL_UPDATED_EVENT",function(e){this._plugSvcs.dbgout("Struct Plugin handling compare panel updated"),this._outputPanel.onComparePanelUpdated()}.bind(this)),e.syncSetting("viewSettings.PAD3D_VIEW.view3D.isolate","_viewerDisplayModeIsolate",e._outputPanel.onTreesSelectRow.bind(e._outputPanel),e._outputPanel),e.syncSetting("viewSettings.STRUCT_VIEW.statuses_to_hide","_statusesHidden",null,e._outputPanel),e.syncSetting("viewSettings.STRUCT_VIEW.display_mode","_displayMode",null,e._outputPanel),e.syncSetting("viewSettings.STRUCT_VIEW.multi_statuses_to_hide_and","_multiStatusesToHideAnd",null,e._outputPanel),this._pluginOptions&&this._pluginOptions.SHOW_HIDE_NODE_PARAMS&&this._pluginOptions.SHOW_HIDE_NODE_PARAMS.forEach(t=>{t.hasOwnProperty("SHOW")&&"string"==typeof t.SHOW?e.syncSetting(t.SHOW,"show",e._outputPanel._applyShowHideNodesByTypeAndAttributes.bind(e._outputPanel),t):t.hasOwnProperty("SHOW")&&"boolean"==typeof t.SHOW?t.show=t.SHOW:t.show=!0}),e._parent()},createViewPanelObject:function(e,i){var n={};return i.CUSTOM_PROFILE_IN_USE&&(n=i.PROPS),new t(e,this._plugSvcs,i,n)},execute:function(e,t){var i=this;i._parent(e,t);var n=e.crTreeArray;i._outputPanel.updateResults(t,n[0]).then(function(e){i.showNotBusy(),i.reportOK(n)},function(e){i.reportKO(e)})}})}),define("DS/CompareWidget2/plugins/STRUCTURE/relCompareEngine",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crTree","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/hierResultList"],function(e,t,i,n,o){var r=function(){this._opCount=0,this._descendantEvals=0,this._matchCount=0,this._propCompArray=[],this._adjArray=[],this._masked_lut={},this._RELATIONSHIP_NAMES=null,this._CUSTOM_MATCH_ADJUSTMENTS=null,this._COMPUTE_DIFFERENT=null,this._maxAdjScore=0};function s(e){var t=[];return e.forEach(function(e){e.getChildArray().forEach(function(e){t.push(e)})}),t}return r.prototype._evalAdjustment=function(e,t){for(var i=0,n=[],o=0;o<this._adjArray.length;o++){var r=this._adjArray[o],s=r.propName0,a=r.propName1,l=e.getAttr(s),u=t.getAttr(a),c="EQ"==r.flagOn;if(null!=l&&null!=u)if(l==u==c){r.MATCH_ADJ;n.push(r.adjName),i+=r.adjScore}}return 0!=i&&this._plugSvcs.dbgout("EVAL","----\x3e>> [ADJUSTMENT] : Adj: "+i+", FLAGS: "+n),{adjIndex:this._maxAdjScore-i,adjFlagArray:n}},r.prototype._evalOnDescendants=function(e,t){for(var i=this,n=e.getChildArray(),o=t.getChildArray(),r=null,a=1;null==r&&a<=1e3&&n.length>0&&o.length>0;)this._plugSvcs.dbgout("EVAL"," Looking in child generation "+a),n.forEach(function(e){o.forEach(function(t){var n=i._eval(e,t);if(i._descendantEvals++,null!=n){var o=i._evalAdjustment(e,t);(null==r||n<r.relIndex||n==r.relIndex&&o.adjIndex<r.adj.adjIndex)&&(r={generation:a,relIndex:n,adj:o})}})}),null==r&&(a++,n=s(n),o=s(o));return r},r.prototype._buildRelListArray=function(e,t,i){var n=this;n._plugSvcs.dbgout("EVAL"," >>> buildRelLists() is looking for all matches among ("+e.length+" x "+t.length+") nodes");for(var r=new o(e,t),s=0;s<e.length;s++)for(var a=e[s],l=0;l<t.length;l++){var u=t[l],c=null;if(i){n._plugSvcs.dbgout("EVAL"," evaluating descendants of nodes ("+s+","+l+")");var d=n._evalOnDescendants(a,u);if(null==d)n._plugSvcs.dbgout("EVAL"," Descendants of nodes ("+s+","+l+") have nothing in common");else{c=d.relIndex;var p=d.adj;r.add(s,l,c,n._RELATIONSHIP_NAMES[c],p.adjIndex,p.adjFlagArray)}}else if(null!==(c=n._eval(a,u))){p=n._evalAdjustment(a,u);r.add(s,l,c,n._RELATIONSHIP_NAMES[c],p.adjIndex,p.adjFlagArray)}}return r},r.prototype._eval=function(e,t){for(var i=this,n=null,o=0,r=i._propCompArray.length,s=0;s<r;s++){var a=i._propCompArray[s],l=a.propName0,u=a.propName1,c=e.getAttr(l),d=t.getAttr(u);i._opCount++,null!=c&&c==d&&(o+=a.truthBit)}var p=i._masked_lut.length;for(s=0;s<p;s++){var h=i._masked_lut[s];(o&h.mask)==h.maskedScore&&(n=h.relIndex)}if(null!==n){i._matchCount++;var _=i._RELATIONSHIP_NAMES[n];i._plugSvcs.dbgout("EVAL"," ----\x3e>> rel: "+_+",    SCORE: "+o+":      "+e.getAttr("REF.ds6w:label")+"  <vs>  "+t.getAttr("REF.ds6w:label"))}return n},r.prototype._evalNodeSet=function(e,t,i){var n={};if(0==e.length)this._plugSvcs.dbgout("EVAL"," evalNodeSets() has "+t.length+" nodes that are 'RIGHT-ONLY'"),n={riMatchedNodePairArray:[],riUnmatchedArray_base:[],riUnmatchedArray_comp:t};else if(0==t.length)this._plugSvcs.dbgout("EVAL"," evalNodeSets() has "+e.length+" nodes that are 'LEFT-ONLY'"),n={riMatchedNodePairArray:[],riUnmatchedArray_base:e,riUnmatchedArray_comp:[]};else{var o=" evalNodeSets() is LOOKING for BEST matches among ("+e.length+" x "+t.length+") nodes";i&&(o+=" // evaluating based on child rels..."),this._plugSvcs.dbgout("EVAL",o);var r=this._buildRelListArray(e,t,i),s=r.getResult();n={riMatchedNodePairArray:s.riMatchedNodePairArray,riUnmatchedArray_base:s.riUnmatchedNodeArray_base,riUnmatchedArray_comp:s.riUnmatchedNodeArray_comp},r.destroy(),r=null,s=null}return n},r.prototype._evalChildNodes=function(e,t){var i={},n=this._evalNodeSet(e,t,!1);0==n.riMatchedNodePairArray.length&&this._plugSvcs.dbgout("EVAL"," <<< there were NO MATCHES among the nodes >>>");var o=null;if(1==this._COMPUTE_DIFFERENT){var r=n.riUnmatchedArray_base,s=n.riUnmatchedArray_comp;r.length>0&&s.length>0&&(this._plugSvcs.dbgout("EVAL"," >>> looking for diff..."),o=this._evalNodeSet(r,s,!0))}if(null!=o){for(var a=0;a<o.riMatchedNodePairArray.length;a++){var l=o.riMatchedNodePairArray[a];l.relIndex=this._RelName2Index.DIFFERENT,l.relName="DIFFERENT"}i={riMatchedNodePairArray:[...n.riMatchedNodePairArray,...o.riMatchedNodePairArray],riUnmatchedArray_base:o.riUnmatchedArray_base,riUnmatchedArray_comp:o.riUnmatchedArray_comp}}else i=n;return i},r.prototype._initInternals=function(e){var t=this;t._CUSTOM_MATCH_ADJUSTMENTS=e.CUSTOM_MATCH_ADJUSTMENTS,t._COMPUTE_DIFFERENT=e.COMPUTE_DIFFERENT,t._maxAdjScore=0;var i=e.PROPS,n=e.CUSTOM_COMPARISONS,o=e.CUSTOM_RELATIONSHIP_NAMES,r=e.SYSTEM_RELATIONSHIP_NAMES;t._RELATIONSHIP_NAMES=[...o,...r],t._RelName2Index={},t._RELATIONSHIP_NAMES.forEach(function(e,i){t._RelName2Index[e]=i}),t._adjArray=[];for(var s=null==t._CUSTOM_MATCH_ADJUSTMENTS?0:t._CUSTOM_MATCH_ADJUSTMENTS.length,a=0;a<s;a++){var l=t._CUSTOM_MATCH_ADJUSTMENTS[a],u=l.PROPS,c=u[0],d=u[1],p=i[c],h=i[d],_=l.MATCH_ADJ;t._adjArray[a]={adjName:l.NAME,propName0:p,propName1:h,flagOn:l.FLAG_ON,adjScore:_,truthBit:1<<a},_>0&&(t._maxAdjScore+=_)}var f=[];a=0;Object.keys(n).forEach(function(e){var o=n[e],r=o[1].length;if(0==f.length)for(var s=0;s<r;s++)f[s]={val:0,mask:0};var l=o[0],u=l[0],c=l[1],d=i[u],p=i[c];t._propCompArray[a]={compName:e,propName0:d,propName1:p,truthBit:1<<a};var h=o[1],_=h.length;for(s=0;s<_;s++)"EQ"==h[s]&&(f[s].val+=1<<a),"N/A"==h[s]&&(f[s].mask+=1<<a);a++});var g=[],m=f.length;for(a=0;a<m;a++){f[a].val;var S=-1;0!=f[a].mask&&(S=~f[a].mask),g.push({relIndex:a,maskedScore:f[a].val,mask:S})}t._masked_lut=g},r}),define("DS/CompareWidget2/plugins/STRUCTURE/REL_COMPARE_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/relCompareEngine","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair","DS/CompareWidget2/support/tenantServiceContext_IDList"],function(e,t,i,n){return e.extend({onLoad:function(){return this._engine=new t,!0},onEnabled:function(){return this.syncSetting("compareSettings.includeFacets.externalRelations.showDocs","showDocs"),this.syncSetting("compareSettings.includeFacets.externalRelations.showOtherRels","showOtherRels"),!0},onDestroy:function(){this._engine=null},getAllChildren:function(e){var t=[];return e.forEach(function(e){e.getChildArray().forEach(function(e){t.push(e)})}),t},compareChildrenNodes:function(e,t){var n=[],o=[];e.forEach(function(e){null==e._matchInfo&&n.push(e)}),t.forEach(function(e){null==e._matchInfo&&o.push(e)});for(var r=this._engine._evalChildNodes(n,o,!0),s=r.riMatchedNodePairArray.length,a=0;a<s;a++){var l=r.riMatchedNodePairArray[a],u=l.adjFlagArray,c=l.relName,d=l.riNode_base,p=l.riNode_comp,h=new i(c,u,d,p);d.setMatchInfo(h),p.setMatchInfo(h)}},compareAllGenerationChildren:function(e,t){for(var i=1,n=e,o=t;i<=50&&n.length>0;)this.compareChildrenNodes(n,o),n=this.getAllChildren(n),o=this.getAllChildren(o),i++},execute:function(e,t){var i=this;if(i._objIn=e,!0===this.showDocs||"true"===this.showDocs||!0===this.showOtherRels||"true"===this.showOtherRels){i._parent(e,t),i._engine._plugSvcs=i._plugSvcs,i._engine._initInternals(t),i._engine._COMPUTE_DIFFERENT=!0,i._objIn=e;var n=i._objIn.crTreeArray[0].getRoot(0),o=i._objIn.crTreeArray[0].getRoot(1),r=n.getChildArray(),s=o.getChildArray();i.compareAllGenerationChildren(r,s)}var a=i._objIn;null!=a?i.reportOK(a):i.reportKO()}})}),define("DS/CompareWidget2/plugins/STRUCTURE/statusBubbler",["UWA/Class","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair","DS/CompareWidget2/support/typeHierMgr"],function(e,t,i){var n=e.extend({init:function(e){this._parent({}),this._plugSvcs=e},doBubble:function(e,t){var i=this;return!0===t.BUBBLE_UP_ENABLED&&i.setup_bubbleUpStatus_lut(t.BUBBLE_STATUS_CONFIG),e.forEach(function(e){i.bubbleTree(e,t)}),e}});return n.prototype.bubbleTree=function(e,t){for(var i=e.getMatchPairArray(),n=i.length,o=!1,r=1;r<n;r++){var s=i[r];if(1!=s.DELETED){if(!0===t.BUBBLE_UP_ENABLED){var a=this.computeBubbleUpsForMatchPair(s);0!=a&&(o|=this.bubbleUp(s,a))}!0===t.BUBBLE_DOWN_ENABLED&&this.isBubbleDownTarget(s)&&(o|=this.bubbleDown(s))}}o&&e.reNice()},n.prototype.setup_bubbleUpStatus_lut=function(e){var t=this;t._bubbleAction_LUT={},t._conditionTable={PARENT:{ON_STATUS:{vals:{},baUsed:0,baUnused:0},TYPE:{vals:{},baUsed:0,baUnused:0},ATTRIBUTES:{nameVals:{},baUsed:0,baUnused:0}},CHILD:{ON_STATUS:{vals:{},baUsed:0,baUnused:0},TYPE:{vals:{},baUsed:0,baUnused:0},ATTRIBUTES:{nameVals:{},baUsed:0,baUnused:0}}};var i=0;e.forEach(function(e,n){i=Math.pow(2,n),t._bubbleAction_LUT[i]={BUBBLED_STATUS:e.BUBBLE_STATUS,BUBBLE_TO:e.BUBBLE_TO},e.CONDITIONS.CHILD&&t.addConditionEntries(i,e.CONDITIONS.CHILD,t._conditionTable.CHILD),e.CONDITIONS.PARENT&&t.addConditionEntries(i,e.CONDITIONS.PARENT,t._conditionTable.PARENT)});var n=2*i-1;t._conditionTable.CHILD.ON_STATUS.baUnused=n&~t._conditionTable.CHILD.ON_STATUS.baUsed,t._conditionTable.CHILD.TYPE.baUnused=n&~t._conditionTable.CHILD.TYPE.baUsed,t._conditionTable.CHILD.ATTRIBUTES.baUnused=n&~t._conditionTable.CHILD.ATTRIBUTES.baUsed,t._conditionTable.PARENT.ON_STATUS.baUnused=n&~t._conditionTable.PARENT.ON_STATUS.baUsed,t._conditionTable.PARENT.TYPE.baUnused=n&~t._conditionTable.PARENT.TYPE.baUsed,t._conditionTable.PARENT.ATTRIBUTES.baUnused=n&~t._conditionTable.PARENT.ATTRIBUTES.baUsed,t._allBubblesAvail_bitmask=Math.pow(2,Object.keys(t._bubbleAction_LUT).length)-1},n.prototype.addConditionEntries=function(e,t,i){(t.ON_STATUS&&(t.ON_STATUS.forEach(function(t){null==i.ON_STATUS.vals[t]&&(i.ON_STATUS.vals[t]=0),i.ON_STATUS.vals[t]|=e}),i.ON_STATUS.baUsed|=e),t.TYPE&&(t.TYPE.forEach(function(t){null==i.TYPE.vals[t]&&(i.TYPE.vals[t]=0),i.TYPE.vals[t]|=e}),i.TYPE.baUsed|=e),t.ATTRIBUTES)&&(Object.keys(t.ATTRIBUTES).forEach(function(n){var o=t.ATTRIBUTES[n];null==i.ATTRIBUTES.nameVals[n]&&(i.ATTRIBUTES.nameVals[n]={}),null==i.ATTRIBUTES.nameVals[n][o]&&(i.ATTRIBUTES.nameVals[n][o]=0),i.ATTRIBUTES.nameVals[n][o]|=e}),i.ATTRIBUTES.baUsed|=e)},n.prototype.computeBitmaskForTypeOf=function(e,t){var n=0;return Object.keys(t.vals).forEach(function(o){i.isKindOf(e,o)&&(n|=t.vals[o])}),n|=t.baUnused},n.prototype.computeBitmaskForMPStatus=function(e,t){var i=0;return e.getAllStatusArray(!0).forEach(function(e){var n=t.vals[e];i|=n}),i|=t.baUnused},n.prototype.computeBitmaskForAttributes=function(e,t){var i=0;return Object.keys(t.nameVals).forEach(function(n){var o=e.getAttr(n);if(null!=o){var r=t.nameVals[n];Object.keys(r).forEach(function(e){o!=e||(i|=t.nameVals[n][e])})}}),i|=t.baUnused},n.prototype.computeBubbleUpsFor_crNode=function(e,t){var i=this._allBubblesAvail_bitmask,n=e.getMatchInfo();if(0==(i&=this.computeBitmaskForMPStatus(n,t.ON_STATUS)))return 0;var o=e.getType();return 0==(i&=this.computeBitmaskForTypeOf(o,t.TYPE))?0:i&=this.computeBitmaskForAttributes(e,t.ATTRIBUTES)},n.prototype.computeBubbleUpsForMatchPair=function(e){var t=this._allBubblesAvail_bitmask,i="LEFT_ONLY"==e.getRelName()?e.getBaseNode():e.getCompNode(),n=i.getParent();0!=(t&=this.computeBubbleUpsFor_crNode(i,this._conditionTable.CHILD))&&(t&=this.computeBubbleUpsFor_crNode(n,this._conditionTable.PARENT));return t},n.prototype.bubbleUp=function(e,t){var i=!1,n=1;do{if(t&n){var o=this._bubbleAction_LUT[n];i|=this.bubbleUp_byBubbleRule(e,o)}n<<=1}while(n<=t);return i},n.prototype.bubbleUp_byBubbleRule=function(e,t){for(var n=e.getBaseNode(),o=n.getParent(),r=t.BUBBLE_TO,s="FVP"==t.BUBBLE_TO?"FVP0":"STATIC",a=null!=o,l=!isNaN(parseInt(r)),u=l?parseInt(r):null,c=null!=u,d=!1,p="root"!=r&&"FVP"!=r&&0==l?r:null;a;){o=(n=o).getParent();var h=n.getMatchInfo();if(null!=h){d|=!0;var _=!1;"FVP0"==s?s="FVP1":"FVP1"==s&&(_=!0),h.addBubbledStatus(t.BUBBLED_STATUS,_)}if(null==o)a=!1;else if(c)a=--u>0;else if(null!=p){var f=h.getBaseNode().getType(),g=h.getCompNode().getType();a=!(i.isKindOf(f,p)||i.isKindOf(g,p))}}return d},n.prototype.isBubbleDownTarget=function(e){var t=!1;if(e.hasStatus("REPLACED")){var i=e.getBaseNode();if("VPMReference"==i.getAttr("type"))"3DPart"==i.getRefInstNode().getAttr("REF.bo.plmentity.v_usage")&&(t=!0)}return t},n.prototype.findChild3DShape=function(e){for(var t=null,n=e.getChildArray(),o=n.length,r=0;r<o;r++){var s=n[r],a=s.getAttr("type");if(i.isKindOf(a,"3DShape")){t=s;break}}return t},n.prototype.bubbleDown=function(e){var t=!1,i=e.getBaseNode(),n=e.getCompNode(),o=this.findChild3DShape(i);if(null!=o){var r=this.findChild3DShape(n);if(null!=r){var s=o.getMatchInfo(),a=r.getMatchInfo();if(null==s||null==a)this._plugSvcs.errout("bubbleDown:: Unexpected! matchPair missing! bubbleDown being skipped for node... continuing");else{t=!0;var l=s.getCompNode();s.resetRelName("REPLACED"),s.resetCompNode(r),r.setMatchInfo(s);var u=a.getBaseNode();i.removeChild(u),n.removeChild(l),a.DELETED=!0}}}return t},n}),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_BUBBLER_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/statusBubbler"],function(e,t){return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n),this._bubbler=null},onDestroy:function(){this._bubbler=null},execute:function(e,i){var n=this;if(n._parent(e,i),!0===i.BUBBLE_UP_ENABLED||!0===i.BUBBLE_DOWN_ENABLED){var o=this._plugSvcs.nowMS();let r=e.crTreeArray;null==n._bubbler&&(n._bubbler=new t(this._plugSvcs)),n._bubbler.doBubble(r,i),this._plugSvcs.reportTime(o,"TIME TO BUBBLE")}null!=e?n.reportOK(e):n.reportKO()}})}),define("DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/instanceAttrComparePanel",["DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/propsComparePanel","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,i){return e.extend({init:function(e,t,i){this._parent(e,t,i)},getLabel:function(){return i.CompareInstancePanelTitle},getName:function(){return"INSTANCE_VIEW"},getDomId:function(){return"instattr"},isTitleAttr:function(e){return t.isTitleAttr(e,!0)}})}),define("DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",["DS/CompareWidget2/plugins/displayPlugin","DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/attrComparePanel","DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/instanceAttrComparePanel","DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/effectivityComparePanel","i18n!DS/CompareWidget2/assets/nls/DisplayMessages"],function(e,t,i,n,o){return e.extend({onEnabled:function(){var e=this;return{instProps:[{eventName:"INST_PROPS_UPDATE_IN_PROGRESS_EVENT",fn:e.onUpdateInProgress},{eventName:"INST_PROPS_FETCH_FAILED",fn:e.onAttrFetchFailure},{eventName:"NO_CURRENT_SELECTION_EVENT",fn:function(){e.showMessage(o.PROPS_UNAVAILABLE_NO_SELECTION)}},{eventName:"INST_PROPS_OFF_NONE_AVAILABLE",fn:function(){e.showMessageAndSignalOK("INST_PROPS_OFF_NONE_AVAILABLE_MSG")}},{eventName:"INST_PROPS_OFF_DURING_LIST_COMPARE",fn:function(){e.showMessageAndSignalOK("INST_PROPS_OFF_DURING_LIST_COMPARE_MSG")}},{eventName:"INST_PROPS_OFF_TOO_MANY_SELECTED",fn:function(){e.showMessageAndSignalOK("INST_PROPS_OFF_TOO_MANY_SELECTED_MSG")}},{eventName:"GROUP_PLACEHOLDER_SELECTED",fn:function(){e.showMessageAndSignalOK("GROUP_PLACEHOLDER_SELECTED_MSG")}}],effectivity:[{eventName:"EFFECTIVITY_UPDATE_IN_PROGRESS_EVENT",fn:e.onUpdateInProgress},{eventName:"EFFECTIVITY_FETCH_FAILED",fn:e.onAttrFetchFailure},{eventName:"NO_CURRENT_SELECTION_EVENT",fn:function(){e.showMessage(o.PROPS_UNAVAILABLE_NO_SELECTION)}},{eventName:"EFFECTIVITY_OFF_NONE_AVAILABLE",fn:function(){e.showMessageAndSignalOK("EFFECTIVITY_OFF_NONE_AVAILABLE_MSG")}},{eventName:"EFFECTIVITY_OFF_DURING_LIST_COMPARE",fn:function(){e.showMessageAndSignalOK("EFFECTIVITY_OFF_DURING_LIST_COMPARE_MSG")}},{eventName:"EFFECTIVITY_OFF_TOO_MANY_SELECTED",fn:function(){e.showMessageAndSignalOK("EFFECTIVITY_OFF_TOO_MANY_SELECTED_MSG")}},{eventName:"GROUP_PLACEHOLDER_SELECTED",fn:function(){e.showMessageAndSignalOK("GROUP_PLACEHOLDER_SELECTED_MSG")}}],refProps:[{eventName:"REF_PROPS_UPDATE_IN_PROGRESS_EVENT",fn:e.onUpdateInProgress},{eventName:"REF_PROPS_FETCH_FAILED",fn:e.onAttrFetchFailure},{eventName:"NO_CURRENT_SELECTION_EVENT",fn:function(){e.showMessage(o.PROPS_UNAVAILABLE_NO_SELECTION)}},{eventName:"REF_PROPS_OFF_NONE_AVAILABLE",fn:function(){e.showMessageAndSignalOK("REF_PROPS_OFF_NONE_AVAILABLE_MSG")}},{eventName:"REF_PROPS_OFF_TOO_MANY_SELECTED",fn:function(){e.showMessageAndSignalOK("REF_PROPS_OFF_TOO_MANY_SELECTED_MSG")}},{eventName:"GROUP_PLACEHOLDER_SELECTED",fn:function(){e.showMessageAndSignalOK("GROUP_PLACEHOLDER_SELECTED_MSG")}}]}["InstAttrDisplay"===this._name?"instProps":"EffectivityDisplay"===this._name?"effectivity":"refProps"].forEach(function(t){e.subscribeEvent(t.eventName,t.fn.bind(e))}),e._parent()},showMessageAndSignalOK:function(e){this.showMessage(o[e]),this.reportOK()},onAttrFetchFailure:function(){this.showNotBusy()},createViewPanelObject:function(e,o){let r=null;return r=null!=o&&!0===o.isEffectivity?new n(e,this._plugSvcs,o):null!=o&&!0===o.isInstance?new i(e,this._plugSvcs,o):new t(e,this._plugSvcs,o)},execute:function(e,t){var i=this;i._parent(e,t),i._outputPanel.showResults(e).then(function(e){i.showNotBusy(),i.reportOK(e)},function(e){i.reportKO(e)})}})}),define("DS/CompareWidget2/support/EventManager",["DS/CoreEvents/ModelEvents","DS/CompareWidget2/support/cw2Utils"],function(e,t){return e.extend({init:function(e){var t=e||{};this._parent(t)},publish:function(e){var i=e.isAsync,n=e.catchExceptions,o=this,r=o._parent;try{1==i?setTimeout(function(){r.call(o,e)},0):r.call(o,e)}catch(i){if(t.warnout("EXCEPTION publishing event '"+e.event+"' : "+i.stack),1!=n)throw i}}})}),define("DS/CompareWidget2/framework/pluginMgr",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter","DS/CompareWidget2/support/cw2CacheMgr"],function(e,t,i){function n(t,i,n,o){return new Promise(function(r,s){e.dbgout("INIT","  ... loading plugin: "+t);try{require([t],function(s){var a=new s(t,i,n,o);a.onLoad(),e.dbgout("INIT","  ... loading plugin OK: "+t),r(a)},function(i){e.warnout("Failed to load plugin "+t+":: "+i.message),s(i.message)})}catch(i){e.warnout("Exception trying to load plugin "+t)}})}return{getPlugins:function(t,o){return new Promise(function(r,s){e.dbgout("INIT","------------[ L O A D   P L U G I N S     B E G I N ] -----------");var a={},l=[];Object.keys(t).forEach(function(n){var o=t[n].Path,r=t[n].Options,s=i.getCacheObj("pluginCache",n);null==s?l.push({plugName:n,plugPath:o,pluginOptions:r}):(e.dbgout("Plugin "+o+" found in cache; load not required"),a[n]=s)});var u=l.length;if(e.dbgout("INIT","Must load "+u+" plugins..."),0==u)r(a);else{var c=[];for(let e=0;e<u;e++){var d=l[e].plugPath,p=l[e].plugName,h=l[e].pluginOptions;c.push(n(d,p,h,o))}Promise.allSettled(c).then(function(t){let n=0;for(let e=0;e<t.length;e++)if("rejected"!==t[e].status&&null!=t[e].value){var o=t[e].value,u=(o.getPath(),o._name);a[u]=o,i.putCacheObj("pluginCache",u,o),n++}else s("Failed to find plugin '"+l[e]);n===l.length&&(e.dbgout("INIT","------------[ L O A D   P L U G I N S     E N D    ] -----------"),r(a))})}})}}}),define("DS/CompareWidget2/ViewDefModules/VPMRef_Options",["UWA/Core","DS/CompareWidget2/ViewDefModules/ViewDefOptions"],function(e,t){return e.merge({RUN_OPTIONS:{customCompareActive:!0}},e.clone(t,!0))}),define("DS/CompareWidget2/ViewDefModules/VPMRef_ViewDefs",["UWA/Core","DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2","DS/CompareWidget2/ViewDefModules/VPMRef_Options"],function(e,t,i){let n=e.clone(t.PLUGDEFS,!0);return n.StructFetch.Options=i.STRUCT_FETCH_OPTIONS,e.merge({VIEWDEFS:t.VIEWDEFS,VIEWSETS:t.VIEWSETS,PLUGDEFS:n},i)}),define("DS/CompareWidget2/framework/CPF",["DS/CompareCommon/Utils","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/framework/useCase","DS/CompareWidget2/framework/viewSetMgr","DS/CompareWidget2/framework/svcNodeNet","DS/CompareWidget2/framework/pluginMgr","DS/CompareWidget2/support/DataCenter","DS/CompareWidget2/support/objIDSpec","DS/LifecycleServices/LifecycleServicesSettings"],function(e,t,i,n,o,r,s,a,l){var u=function(e,t,i,o,r){this._viewPanelMgr=e,this._viewSetMgr=new n,this._plugSvcs=i,this._eventMgr=t,this._svcNodeNet=null,this._ccm=r,this._currentUseCase=null,this._okToUseVars=null,null!=o&&1==o.isODT&&(this,this.forODT=c)};u.prototype._filter_ID_2_ID_w_filter=function(e){var i=this;return new Promise(function(n,o){s.fetchFilterDefinition(e).then(function(r){var l=r,u=JSON.parse(l.filterCVQuery),c=l.rootPhysicalId;if(null==c&&(c=u.CVQuery.union.expand[0].root_path_physicalid[0][0]),null==c){let e="DataCenter.fetchFilterDefinition: Failed to get the root of the filter definition";t.errout(e),o(e)}var d={physicalid:[c],label:widget._isODTMode()?"":"CompareFindFilteredObject-"+t.nowMS(),select_predicate:["ds6w:label","physicalid","ds6w:type","interface"]};s.makeAuthHttpsCall("/cvservlet/fetch/v2","POST",d,"json",e.getTenant(),e.getServiceName(),e.getSecurityContext()).then(function(t){let i={};t.results[0].attributes.forEach(function(e){i[e.name]=e.value});var o={...u,empty:!1,appId:"CompareWidget",widget:widget.id,filterRootIds:[c],filterRootAlias:[i["ds6w:label"]],filterTitle:l.filterTitle,hideChildren:!1},r=new a(c,i["ds6w:type"],e.getSecurityContext(),e.getTenant(),e.getServiceName(),o,"modelID",null,!0,!0,[i.interface]);n(r)},function(e){i._plugSvcs("EXCEPTION doing simple expand: "+e),o(e)})},function(e){i._plugSvcs("EXCEPTION getting filter defn: "+e),o(e)})})},u.prototype._massageObjIDs=function(e){var i=this;return new Promise(function(n,o){!function(e){for(var i=e.length,n=!1,o=!1,r=0;r<i;r++)null!=(u=(d=e[r]).getSecurityContext())&&""!=u||(n=!0),null!=(c=d.getTenant())&&""!=c||(o=!0);if(n||o){var s=null,a=null;for(r=0;r<i;r++){var l=e[r];if(n&&null!=(u=l.getSecurityContext())&&""!=u&&(n=!1,s=u),o&&null!=(c=l.getTenant())&&""!=c&&(o=!1,a=c),0==n&&0==o)break}for(r=0;r<i;r++){var u,c;null!=(u=(d=e[r]).getSecurityContext())&&""!=u||(null==s?t.errout("Missing security context in request (can not repair)..."):(t.warnout("Missing security context in request (repairing)..."),d._securityContext=s)),null!=(c=d.getTenant())&&""!=c||(null==s?t.errout("Missing tenant in request (can not repair)..."):(t.warnout("Missing tenant in request (repairing)..."),d._tenant=a))}}for(r=0;r<i;r++){var d,p=(d=e[r]).getServiceName();"3dspace"==p.toLowerCase()&&"3DSpace"!=p&&(t.warnout("Correcting malformed service name '"+p+"' to '3DSpace'"),d._serviceName="3DSpace")}}(e);var r=[],s=[];e.forEach(function(e,t){"ENOStrRefinementSpecification"!=e.getObjType()?r[t]=e:s.push(t)});var a=s.length;0==a?n(e):s.forEach(function(r){let s=r,l=e[r];i._filter_ID_2_ID_w_filter(l).then(function(t){console.debug("TEST NEW: "+JSON.stringify(t)),e[s]=t,--a<=0&&n(e)},function(e){t.errout("Failure comparing with use case: "+e),o(e)})})})},u.prototype.compareObjs=function(e,n){var o=this;return o._printStartMsg(n),o._viewPanelMgr.hideAllShowBusy(),new Promise(function(r,s){return new Promise((e,t)=>{l.getGrantedRoles(e)}).then(a=>{let l=a.map(e=>e.id).filter(e=>null!=e);l.push("*"),o._massageObjIDs(n).then(function(a){n=a;let u=o._currentUseCase=new i(e,l,n);o._compareObjsWithUseCase(n,u).then(function(e){r(e)},function(e){t.errout("Failure comparing with use case: "+e),s(e)})},function(e){t.errout("Failure massaging ObjIDSpecs: "+e+"; cannot create use case for comparison"),s(e)})})})},u.prototype.compareObjsWithViewSetName=function(e,i,n){var o=this;return new Promise(function(r,s){o._printStartMsg(e),o._viewPanelMgr.hideAllShowBusy(),o._viewSetMgr.loadViewConfig(i,n).then(function(i){var n=i;o._compareObjsWithViewConfig(e,n).then(function(e){t.dbgout("INIT","compare with viewSetName is OK!"),r(e)},function(e){t.errout("compare with viewSetName FAILURE!!!"),s(e)})},function(e){t.errout("Failure to load view config: "+e),s(e)})})},u.prototype._sendUpdatedInputToSvcNodeNet=function(e){var i=!1;this._viewPanelMgr.showResultFrame();var n=t.nowMS();return null==this._svcNodeNet?t.errout("No svcNodeNet to update"):(this._svcNodeNet.updateInput(e),i=!0),t.reportTime(n," ##### update input"),i},u.prototype._compareObjsWithUseCase=function(i,n){var o=this;return t.dbgout("INIT","<><><><><><><><><><><><><><><><><><>"),t.dbgout("INIT","<><> USE CASE     APP: "+n.getApp()),t.dbgout("INIT","<><> USE CASE    ROLE: "+n.getRoles().join("~")),n.getSvcTypeArray().forEach(function(e){t.dbgout("INIT","<><> USE CASE svcType: "+e)}),t.dbgout("INIT","<><><><><><><><><><><><><><><><><><>"),new Promise(function(r,s){var a=t.nowMS();o._viewSetMgr.getViewConfig(n).then(function(l){t.reportTime(a,"get viewConfig for use case");let u=l,c=!1,d=null;if(null!=u.RUN_OPTIONS&&!0===u.RUN_OPTIONS.customCompareActive&&!0===widget.CV2EnableCustomProfile){c=!0;var p=o._ccm.getUserPreferredProfileName(n);null==p||o._ccm.isDefaultProfile(p)?d=[Promise.resolve(null)]:(t.dbgout("INIT","<><> using CUSTOM PROFILE: '"+p+"'"),(d=e.forceIndex_DisableOtherRelations_ForCustomProfilePromiseArray()).push(Promise.resolve(u=o._ccm.applyCustomProfileToViewConfig(p,u))))}else d=[Promise.resolve(null)];Promise.allSettled(d).then(()=>{o._compareObjsWithViewConfig(i,u,n,c).then(function(e){t.dbgout("INIT","compare with useCase is OK!"),r(e)},function(e){t.errout("compare with useCase FAILURE!!!"),s(e)})})},function(e){t.errout("FAILED getting viewConfig for use case"),s(e)})})},u.prototype._buildSvcNodeNet=function(e){var t=new o(this._plugSvcs,this._eventMgr);return t.build(e),t},u.prototype._okToReuse=function(e){var t=!1,i=JSON.stringify(e);return null!=this._okToUseVars&&(t=this._okToUseVars.lastViewDef_str==i),0==t&&(this._okToUseVars={lastViewDef_str:i}),t},u.prototype._compareObjsWithViewConfig=function(e,i,n,o){var s=this;return new Promise(function(a,l){var u=i.viewDefModPath,c=i.viewSetName,d=i.mainToolbarConfigPath,p=i.mainToolbarOptions;if(t.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><>"),t.dbgout("INIT","<><> USING viewDefMod: "+u),t.dbgout("INIT","<><> USING    viewSet: "+c),t.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><>"),s._okToReuse(i))t.dbgout("INIT","<><> --\x3e viewSet still the same... reusing existing viewConfig"),t.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>"),s._sendUpdatedInputToSvcNodeNet(e),a();else{var h=t.nowMS();r.getPlugins(i.PLUGDEFS,s._plugSvcs).then(function(r){t.reportTime(h,"--\x3e load all plugins"),i.PLUGSLOADED=r,t.dbgout("INIT","<><> --\x3e viewSet is new... building new svcNodeNet..."),t.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>"),null!=s._svcNodeNet&&(s._svcNodeNet.destroy(),s._viewPanelMgr.releaseViewPanels(),s._svcNodeNet=null),s._svcNodeNet=s._buildSvcNodeNet(i),s._viewPanelMgr.setDefaultViewConfig(u,c,i,d,p),s._svcNodeNet.buildViewPanels(n,o),s._svcNodeNet.enableAll(),s._sendUpdatedInputToSvcNodeNet(e),a()},function(e){t.errout("INIT","Error loading plugins:: "+t.stringify(e)),l(e)})}})},u.prototype._printStartMsg=function(e){if(t.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>"),t.dbgout("INIT","<><><><><><><><><><>   BEGIN NEW COMPARE  <><><><><><><><><><><><><><><><><>"),t.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>"),null!=e[0].objAMDName)for(var i=0;i<e.length;i++)t.dbgout("INIT","<><> ID ["+i+"]: AMD Module Name : "+e[i].objAMDName);else for(i=0;i<e.length;i++)t.dbgout("INIT","<><> ID ["+i+"]: SERVICE : "+e[i].getServiceName()),t.dbgout("INIT","<><> ID ["+i+"]:      ID : "+e[i].getPhysID()),t.dbgout("INIT","<><> ID ["+i+"]: OBJTYPE : "+e[i].getObjType()),t.dbgout("INIT","<><> ID ["+i+"]:   TENANT: "+e[i].getTenant()),t.dbgout("INIT","<><> ID ["+i+"]: SEC CTXT: "+e[i].getSecurityContext()),t.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>");t.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>")};var c={};return u}),define("DS/CompareWidget2/widget/inputFrame",["UWA/Controls/Abstract","DS/CompareCommon/Input/CompareInput","DS/CompareWidget2/support/objIDSpec"],function(e,t,i){return e.extend({init:function(e,i,n){this._parent({}),this._eventMgr=e,this.elements.container=UWA.createElement("div",{id:"initial-drop",styles:{height:"100%"}}),this.compareInput=new t(i,n);var o=this;this._eventTokens=[],this._eventTokens.push(this._eventMgr.subscribe({event:"Event_controlCustomizationDone"},this._handler_controlCenterDone.bind(this))),setTimeout(function(){o.compareInput.doInput(o.elements.container,i,o.onInputsReady.bind(o),o.onShowControlCenter.bind(o))})},onShowControlCenter:function(){this._eventMgr.publish({event:"Event_showControlCenter"})},_handler_controlCenterDone:function(e){!0===e.status&&this.compareInput.updateComparisonProfileDropdownUI()},onInputsReady:function(e){let t=[];for(let s of e.idDataList.items){var n=s.objectServices,o=null;void 0!==s.filterData&&null!==s.filterData?o=s.filterData:void 0!==s.queryDef&&null!==s.queryDef&&(o=s.queryDef);var r=new i(n.objectId,n.objectType,n.contextId,n.envId,n.serviceId,o,n.idType,n.commands,s.supportsRevisions,s.supportsFilters,e&&e.validateObj_stateData&&e.validateObj_stateData[n.objectId]&&e.validateObj_stateData[n.objectId].interfaces);t.push(r)}this._eventMgr.publish({event:"Event_inputUpdate",data:t})},clearPersistedInputs:function(){this.compareInput.clearItem("all")},applyNGFilter:function(e,t){this.compareInput.onApplyNGFilter(e,t)}})}),define("DS/CompareWidget2/plugins/DATA/attrValObj",["DS/CompareWidget2/support/cw2Utils"],function(e){function t(e){var t=void 0!==e.selectable?e.selectable:e.name;return"timestamp"===e.type||"modified"===t||"originated"===t||-1!==t.indexOf("ds6w:created")||-1!==t.indexOf("ds6w:modified")}var i=function(e,t,i,n,o){this.name=e,this.nls=t,this.value=i,this.type=n,this.UIPosition=o,this._reqModforODT="DS/CompareWidget2/plugins/DATA/attrValObj"};return i.prototype.getFormattedValue=function(){var i=this,n="";if(null!=i.value){if(i.value.constructor==Array)if(i.value.length>1)for(var o=0;o<i.value.length;++o){n+=t(i)&&!widget._isODTMode()?cw2utils.formatDate(i.value[o]):i.value[o],o!==i.value.length-1&&(n+=", ")}else n=t(i)&&!widget._isODTMode()?e.formatDate(i.value[0]):i.value[0];else n=t(i)&&!widget._isODTMode()?e.formatDate(i.value):i.value;var r=i.dimension;null!=r&&(n+=" "+r)}return n},i}),define("DS/CompareWidget2/widget/mainFrame",["UWA/Controls/Abstract","DS/CompareWidget2/widget/inputFrame","DS/CompareWidget2/widget/resultFrame","DS/CompareWidget2/widget/compareCustomizationFrame","DS/UIKIT/Mask","css!DS/CompareWidget2/CompareWidget2.css"],function(e,t,i,n,o){return e.extend({init:function(e,t,i){this._parent({}),this._eventMgr=e,this.elements.container=UWA.createElement("div",{id:"main-frame",styles:{height:"100%"}}),this._ccm=i,this._frameSet=[],this._eventTokens=[],this._lastFrameIndex=-1,this._currFrameIndex=-1,this._buildSkeleton(this._eventMgr,t,i)},_buildSkeleton:function(e,o,r){this._frameSet[0]=this._buildViewFrame(t,e,o,r),this._frameSet[1]=this._buildViewFrame(i,e,o,r),this._frameSet[2]=this._buildViewFrame(n,e,o,r),this._showFrame(0),this._eventTokens.push(this._eventMgr.subscribe({event:"Event_resetToDropFrame"},this._handler_resetToInputframe.bind(this))),this._eventTokens.push(this._eventMgr.subscribe({event:"Event_showControlCenter"},this._handler_showControlCenter.bind(this))),this._eventTokens.push(this._eventMgr.subscribe({event:"Event_controlCustomizationDone"},this._handler_controlCenterDone.bind(this)))},destroy(){this._destroyAllFrames(),this._stopAllListening()},_destroyAllFrames:function(){for(var e=0;e<this._frameSet.length;e++){var t=this._frameSet[e].destroy;null!=t&&"function"==typeof t&&t()}this._frameSet=null},_stopAllListening:function(){for(var e=0;e<this._eventTokens.length;e++)this._eventMgr.unsubscribe(this._eventTokens[e]),this._eventTokens[e]=null;this._eventTokens=null},_buildViewFrame:function(e,t,i,n){var o=new e(t,i,n);return o.inject(this.elements.container),o},_showFrame:function(e,t){this._lastFrameIndex=this._currFrameIndex,this._currFrameIndex=e;for(var i=0;i<this._frameSet.length;i++)i==e?this._frameSet[i].show(t):this._frameSet[i].hide();o.unmask(this.elements.container)},_handler_resetToInputframe:function(){this.showInputFrame(!0)},_handler_showControlCenter:function(e){this.showControlCenterFrame(e)},_handler_controlCenterDone:function(e){if(this._showFrame(this._lastFrameIndex),!0===e.status){let e=this.getResultFrame();null!=e&&e.onProfileManagerDone()}},resetResultFrame:function(){let e=this._frameSet[1]._runOptions,t=this._frameSet[1]._CCM;this._frameSet[1].destroy(),this._frameSet[1]=this._buildViewFrame(i,this._eventMgr,e,t)},getResultFrame:function(){return this._frameSet[1]},getInputFrame:function(){return this._frameSet[0]},getCustomizationFrame:function(){return this._frameSet[2]},hideAllShowBusy:function(){this._frameSet[0].hide(),o.mask(this.elements.container)},showInputFrame:function(e){e&&this._frameSet[0].clearPersistedInputs(),this._showFrame(0)},showResultFrame:function(){this._showFrame(1)},showControlCenterFrame:function(e){this._showFrame(2,e)},refreshFrame:function(){this._frameSet[this._currFrameIndex]&&"function"==typeof this._frameSet[this._currFrameIndex].refreshFrame&&this._frameSet[this._currFrameIndex].refreshFrame()},isResultViewActive:function(){return 1===this._currFrameIndex}})}),define("DS/CompareWidget2/plugins/DATA/attrValObjSet",["DS/CompareWidget2/plugins/DATA/attrValObj"],function(e){var t=function(e,t,i,n){this.physicalID=e,this.objType=t,this.iconURLLarge=i,this.iconURL=n,this.dbContext={},this.attrVals=[],this.byName={},this._reqModforODT="DS/CompareWidget2/plugins/DATA/attrValObjSet"};return t.prototype.add=function(t,i,n,o,r){var s=new e(t,i,n,o,r);this.attrVals.push(s),this.byName[t]=s},t.prototype.setDBContext=function(e,t,i){this.dbContext={securityContext:e,serviceName:t,tenant:i}},t.prototype.getDBContext=function(){return this.dbContext},t.prototype.getPhysicalID=function(){return this.physicalID},t.prototype.getObjType=function(){return this.objType},t.prototype.getIconURLLarge=function(){return this.iconURLLarge},t.prototype.getIconURL=function(){return this.iconURL},t.prototype.getAttrCount=function(){return this.attrVals.length},t.prototype.getAttr=function(e){return this.attrVals[e]},t.prototype.getAttrByName=function(e){return this.byName[e]},t}),define("DS/CompareWidget2/widget/viewPanelMgr",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/widget/mainFrame"],function(e,t){return function(i,n,o,r){this._panelSpecSet={},this._expectedViewCount=-1,this._mainFrame=new t(n,o,r),widget._isODTMode()?i.setContent(this._mainFrame):this._mainFrame.inject(i),this.addPanel=function(e,t,i,n,o){var r=[];"function"==typeof t.getWidgetButtons&&(r=t.getWidgetButtons());var s={name:e,panel:t,plugin:i,buttonSpecArray:r},a=this._mainFrame.getResultFrame();this._panelSpecSet[e]=s,-1==this._expectedViewCount?a.addPanel(s,!0):Object.keys(this._panelSpecSet).length==this._expectedViewCount&&a.setAllPanels(this._viewDefModPath,this._viewSetName,this._defaultViewConfig,this._panelSpecSet,this._mainToolbarConfigPath,this._mainToolbarOptions,n,o)},this.setDefaultViewConfig=function(e,t,i,n,o){this._viewSetName=t,this._viewDefModPath=e,this._defaultViewConfig=i.VIEWSET,this._mainToolbarConfigPath=n,this._mainToolbarOptions=o,null!=i&&(this._expectedViewCount=this.countViews(this._defaultViewConfig,i.VIEWDEFS))},this.countViews=function(t,i){return e.getViewDefs(t).reduce((e,t)=>(null!=i[t]&&e++,e),0)},this.showResultFrame=function(){this._mainFrame.showResultFrame()},this.releaseViewPanels=function(){this._mainFrame.resetResultFrame(),this._panelSpecSet={},this._expectedViewCount=-1},this.showInputFrame=function(){this._mainframe.showInputFrame()},this.hideAllShowBusy=function(){this._mainFrame.hideAllShowBusy()},this.requestFrame=function(e){return UWA.createElement("div",{id:e,styles:{position:"relative",display:"flex","flex-direction":"column",height:"100%"}})},this.refreshFrame=function(){this._mainFrame.refreshFrame()},this.isResultViewActive=function(){return this._mainFrame.isResultViewActive()}}}),define("DS/CompareWidget2/plugins/DATA/attrCache",["DS/CompareWidget2/plugins/DATA/attrValObjSet","DS/CompareWidget2/support/tenantServiceContext_IDList","DS/CompareCommon/Utils","i18n!DS/CompareWidget/assets/nls/CompareWidget"],function(e,t,i,n){function o(e){for(var t={data:[],tn:e.dbContext.tenant,sc:e.dbContext.securityContext,sn:e.dbContext.serviceName,i1:e.iconURL,i2:e.iconURLLarge,id:e.physicalID,ty:e.objType},i=e.attrVals.length,n=0;n<i;n++){var o=e.attrVals[n],r=[o.name,o.nls,JSON.stringify(o.value),o.type,o.UIPosition];t.data.push(r)}return t}var r=function(e,t,i){this._cacheType=e?"(INST)":t?"(EFFECTIVITY)":"(REF)",this._isInstance=e,this._isEffectivity=t,this._plugSvcs=i,this._dbgout=i.dbgout,this._theCache={},this._preloadInProgress=!1,this._cacheIsLoaded=!1};return r.prototype.isFullyLoaded=function(){return this._cacheIsLoaded},r.prototype.flushCache=function(){var e=JSON.stringify(this._theCache).length;e>2&&(this._plugSvcs.dbgout("ATTR_CACHE",this._cacheType+" Property value cache (current size: "+e+" characters) is being flushed ..."),this._theCache={},this._preloadInProgress=!1,this._cacheIsLoaded=!1)},r.prototype.getAttrData=function(e){var i=this,n=[];return new Promise(function(o,r){var s=new t;e.forEach(function(e){s.addObjIDSpec(e)}),i._updateCache(s,!0).then(function(t){0==t?o(null):(e.forEach(function(e){var t=e.getTenant(),o=e.getServiceName(),r=e.getSecurityContext(),s=e.getPhysID(),a=i._getFromCache(t,o,r,s);a&&(void 0===a.objType||null===a.objType&&""===a.objType)&&(a.objType=e.getObjType()),n.push(a)}),o(n))},function(e){var t=i._cacheType+" fetch data failed:: "+e;r(t)})})},r.prototype._getFromCache=function(t,i,n,o){var r=null;if(null!=t&&null!=i&&null!=n&&null!=o&&""!==o){var s=this._theCache[t][i][n][o];null!=s?r=function(t){var i=t.tn,n=t.sc,o=t.sn,r=t.i1,s=t.i2,a=t.id,l=t.ty,u=new e(a,l,s,r);return u.setDBContext(n,o,i),t.data.forEach(function(e){var t=e[0],i=e[1],n=null==e[2]?null:JSON.parse(e[2]),o=e[3],r=e[4];u.add(t,i,n,o,r)}),u}(s):this._dbgout("ATTR_CACHE","_getFromCache() "+o+" not in cache!")}return r},r.prototype.doPreload=function(e){var t=this;return new Promise(function(i,n){try{t._cacheIsLoaded?i(t):t._preloadInProgress?n(t._cacheType+" doPreload() is already in progress... ignoring request"):(t._preloadInProgress=!0,t._dbgout("ATTR_CACHE",t._cacheType+" PRELOADING 'diff'"),t._updateCache(e.diff,!1).then(function(o){0==o||0==t._preloadInProgress?(t._dbgout("ATTR_CACHE",t._cacheType+" load aborted / data is no longer relevant."),t._preloadInProgress=!1,n("Preload() aborted")):(t._dbgout("ATTR_CACHE",t._cacheType+" PRELOADING 'nodiff'"),t._updateCache(e.nodiff,!1).then(function(e){0==e||0==t._preloadInProgress?(t._dbgout("ATTR_CACHE",t._cacheType+" load aborted / data is no longer relevant."),n("Preload() aborted")):(t._dbgout("ATTR_CACHE",t._cacheType+" *CACHE FULLY LOADED* for current model"),t._cacheIsLoaded=!0,t._preloadInProgress=!1,i(t))},function(e){t._preloadInProgress=!1,t._dbgout("ATTR_CACHE",t._cacheType+" LOAD 'nodiffs' FAILED: "+e),n(e)}))},function(e){t._preloadInProgress=!1,t._dbgout("ATTR_CACHE",t._cacheType+" LOAD 'diffs' FAILED: "+e),n(e)}))}catch(e){t._preloadInProgress=!1,t.me._plugSvcs.errout("EXCEPTION while loading cache... aborted:: "+e),n(e)}})},r.prototype._updateCache=function(e,t){var i=this,n=0,o=0,r=0;return new Promise(function(s,a){i._dbgout("ATTR_CACHE",i._cacheType+" Looking for objects in ATTR_FETCH cache...");var l=[];Object.keys(e._data).forEach(function(s){null==i._theCache[s]&&(i._theCache[s]={}),Object.keys(e._data[s]).forEach(function(a){null==i._theCache[s][a]&&(i._theCache[s][a]={}),Object.keys(e._data[s][a]).forEach(function(u){null==i._theCache[s][a][u]&&(i._theCache[s][a][u]={});var c=Object.keys(e._data[s][a][u]),d=[];if(c.forEach(function(e){if(void 0===i._theCache[s][a][u][e]||null===i._theCache[s][a][u][e]&&1==t){if(o++,d.push(e),i._theCache[s][a][u][e]=null,d.length>=10){var c={reqTenant:s,reqServiceName:a,reqSecurityContext:u,reqIDArray:d};l.push(c),d=[]}}else 0==t&&null==i._theCache[s][a][u][e]?r++:n++}),d.length>0){var p={reqTenant:s,reqServiceName:a,reqSecurityContext:u,reqIDArray:d};l.push(p)}})})});var u=o>0?", must fetch...":"";i._dbgout("ATTR_CACHE",i._cacheType+" HIT: "+n+", MISS: "+o+u),0==l.length?s(0==r):(i._dbgout("ATTR_CACHE",i._cacheType+" *FETCHING PROPS* for "+o+" objects using "+l.length+" request set(s)"),i._doBigFetch(l).then(function(e){s(e)},function(e){a(e)}))})},r.prototype._doBigFetch=function(t){var i=this;return new Promise(function(r,s){var a=0,l=t.length,u=l;function c(d){var p=d;--u>0?i._dbgout("ATTR_CACHE",i._cacheType+" ...processing returned data; still have "+u+" requests to go..."):i._dbgout("ATTR_CACHE",i._cacheType+" processing returned data...");for(var h=function(t,i){for(var o=[],r=t.length,s=0;s<r;s++)for(var a=t[s],l=a.result.results.length,u=0;u<l;u++){var c=a.result.results[u],d=new e(c.physicalID,c.type,c.type_icon_large_url,c.type_icon_url);if(d.setDBContext(a.securityContext,a.serviceName,a.tenant),i||d.add("thumbnailimage",n.thumbnailimage,c.thumbnail,"thumbnail",0),void 0!==c.basicData&&null!==c.basicData&&c.basicData.length>0)for(let e of c.basicData){const t=null!==e.nls&&void 0!==e.nls&&""!==e.nls?e.nls:e.displayName;d.add(e.name,t,e.value,e.type,e.UIPosition)}if(void 0!==c.data&&null!==c.data&&c.data.length>0)for(let e of c.data){const t=null!==e.nls&&void 0!==e.nls&&""!==e.nls?e.nls:e.displayName;d.add(e.name,t,e.value,e.type,e.UIPosition)}o.push(d)}return o}([p],i._isEffectivity),_=h.length,f=0;f<_;f++){var g=h[f],m=g.getPhysicalID(),S=g.dbContext.tenant,C=g.dbContext.serviceName,T=g.dbContext.securityContext,E=o(g);i._theCache[S][C][T][m]=E}if(a<l){var v=t[a++];i._dbgout("ATTR_CACHE",i._cacheType+" sending request #"+a+" of "+l+"("+v.reqIDArray.length+" objects)"),i._fetchReqSet(v).then(function(e){null==e?i._dbgout("ATTR_CACHE","Data discarded"):c(e)},function(e){s(e)})}else u<=0&&r(!0)}for(a=0;a<2&&a<l;a++){var d=t[a];i._dbgout("ATTR_CACHE",i._cacheType+" sending request #"+(a+1)+" of "+l+" ("+d.reqIDArray.length+" objects)"),i._fetchReqSet(d).then(function(e){c(e)},function(e){s(e)})}})},r.prototype._fetchReqSet=function(e){var t=this;return new Promise(function(i,n){setTimeout(()=>{var o=t._plugSvcs.nowMS(),r=t._theCache;t._getAttrs(e.reqIDArray,e.reqServiceName,e.reqTenant,e.reqSecurityContext).then(function(s){if(r!==t._theCache)t._dbgout("ATTR_CACHE",t._cacheType+" Cache was flushed; incoming data ignored"),i(null);else{var a=s;if(Array.isArray(a.result.results)&&a.result.results.every(e=>!1!==e.success)){var l=e.reqIDArray.length,u="[ATTR_CACHE]"+t._cacheType+" FETCHED PROPS for "+l+" OBJECTS";if(t._plugSvcs.reportTime(o,u),"3dspace"===a.serviceName.toLowerCase())if(t._isInstance)a.result.results.forEach(e=>e.thumbnail=e.preview_url.length?e.preview_url:e.type_icon_large_url),i(a);else if(t._isEffectivity)i(a);else{var c=t._plugSvcs.nowMS();t._getThumbnails(e.reqIDArray,e.reqServiceName,e.reqTenant,e.reqSecurityContext,a.result.results).then(function(n){t._plugSvcs.reportTime(c,"[CACHE]"+t._cacheType+" "+e.reqIDArray.length+" thumbnails loaded");var o=n;t._mergeInThumbInfo(a,o),i(a)},function(e){var n="attr fetch was OK (but missing thumbnails) :: "+e;t._plugSvcs.errout(n),i(a)})}else{for(let e of a.result.results)if(e.hasOwnProperty("preview_url")&&""!==e.preview_url)e.thumbnail=e.preview_url;else{var d=e.data.findIndex(function(e){return"preview_url"===e.name});if(d>=0){let t=e.data.splice(d,1);e.thumbnail=t[0].value}}i(a)}}else n("Failure getting Attributes: ")}},function(e){var i="Failure getting Attributes: "+e;t._plugSvcs.errout(i),n(i)})},1)})},r.prototype._getAttrs=function(e,t,n,o){var r=this;if(r._isEffectivity)return new Promise(function(r,s){i.getEffectivityPromise2({objectIds:e,serviceIds:[t],tenant:n,securityContext:o}).then(function(e){r({serviceName:t,tenant:n,securityContext:o,result:e})})});if("3dportfolio"===t.toLowerCase()||"3dspace"===t.toLowerCase()){let i="",s="",a="";return"3dportfolio"===t.toLowerCase()?(i="/"+t+"/getAttrs",s="GET",a="objectIds="+e.join(",")):"3dspace"===t.toLowerCase()&&(i="/resources/v1/collabServices/attributes/op/read/",s="POST",a=!0===r._isInstance?{debug_properties:"",plmparameters:"true",relIDs:e,lIds:[]}:{debug_properties:"",readonly:"false",navigateToMain:"true",attributes:"true",plmparameters:"true",busIDs:e,relIDs:[],lIds:[]}),new Promise(function(e,l){r._plugSvcs.makeAuthHttpsCall(i,s,a,"json",n,t,o).then(function(i){e({serviceName:t,tenant:n,securityContext:o,result:i})},function(e){r._plugSvcs.errout("Failure retrieving attributes for object"),l(null)})})}return new Promise(function(r,s){i.getFederatedAttributesPromise({objectIds:e,serviceIds:[t],tenant:n,securityContext:o}).then(function(e){r({serviceName:t,tenant:n,securityContext:o,result:e})})})},r.prototype._getThumbnails=function(e,t,i,n,o){var r=this,s=[],a=e.length,l=0;return new Promise(function(u,c){e.forEach(function(e){let d=o.find(t=>t.physicalID===e),p=void 0!==d?d.preview_url:"";if(null!=p&&""!==p)s[e]=p,++l>=a&&u(s);else{var h="/resources/compare/thumbnailUrl/"+e;r._plugSvcs.makeAuthHttpsCall(h,"GET",null,"text",i,t,n).then(function(n){var o=n;0==o.startsWith("http")&&(o=r._plugSvcs.makeServiceURL(t,i,o,null)),s[e]=o,++l>=a&&u(s)},function(e){c(e)})}})})},r.prototype._mergeInThumbInfo=function(e,t){e.result.results.forEach(function(e){var i=e.physicalID,n=t[i];e.thumbnail=n})},r}),define("DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/DATA/attrCache"],function(e,t){return e.extend({init:function(e,i,n,o){this._parent(e,i,n,o),this.enableDebugLabel("ATTR_CACHE"),this._isInstance=this._pluginOptions.isInstance,this._isEffectivity=this._pluginOptions.isEffectivity,this._DEBUG_isInstTxt=this._isInstance?"(INST)":this._isEffectivity?"(EFFECTIVITY)":"REF)",this._attrCache=new t(this._isInstance,this._isEffectivity,o),this._comparisonInProgress=!1},onEnabled:function(){var e=this;return e.subscribeEvent("NEW_CURRENT_SELECTION_EVENT",function(e){var t=this,i=e.data.selectedData;t._plugSvcs.dbgout("A new row has been selected..."),t._attrUpdateStartMS=t._plugSvcs.nowMS();var n=[];if(e.data.selectedData){var o=i[0].length>i[1].length?i[0]:i[1];if(0===o.length)return;if(t._isInstance){if("LIST"==e.data.structDisplayMode)return void t.postEvent("INST_PROPS_OFF_DURING_LIST_COMPARE",{id:"attrFetch"});if(1!=o.length)return void t.postEvent("INST_PROPS_OFF_TOO_MANY_SELECTED",{id:"attrFetch"})}else if(t._isEffectivity){if("LIST"==e.data.structDisplayMode)return void t.postEvent("EFFECTIVITY_OFF_DURING_LIST_COMPARE",{id:"attrFetch"});if(1!=o.length)return void t.postEvent("EFFECTIVITY_OFF_TOO_MANY_SELECTED",{id:"attrFetch"})}else{var r=!0;if("LIST"!=e.data.structDisplayMode)1!=o.length&&(r=!1);else{var s=o[0].ObjIDSpec.getPhysID();o.forEach(function(e){e.ObjIDSpec.getPhysID()!=s&&(r=!1)})}if(!r)return void t.postEvent("REF_PROPS_OFF_TOO_MANY_SELECTED",{id:"attrFetch"})}i.forEach(function(e){if(null!=e&&e.length>0){var i=e[0],o=t._isInstance||t._isEffectivity?i.instObjIDSpec:i.ObjIDSpec;null!=o&&n.push(o)}});let a=0;for(let e of n){let t=e.getPhysID();null!=t&&""!==t&&++a}if(0==a)t._plugSvcs.postEvent(t._isInstance?"INST_PROPS_OFF_NONE_AVAILABLE":t._isEffectivity?"EFFECTIVITY_OFF_NONE_AVAILABLE":"REF_PROPS_OFF_NONE_AVAILABLE",{id:"attrFetch"});else{if("relations"===n[0].getObjType())return void t.postEvent("GROUP_PLACEHOLDER_SELECTED",{id:"attrFetch"});t._plugSvcs.postEvent(t._isInstance?"INST_PROPS_UPDATE_IN_PROGRESS_EVENT":t._isEffectivity?"EFFECTIVITY_UPDATE_IN_PROGRESS_EVENT":"REF_PROPS_UPDATE_IN_PROGRESS_EVENT",null),t._attrCache.getAttrData(n).then(function(e){if(null!=e){for(var i=!0,n=0;n<e.length;n++)if(null!=e[n]){i=!1;break}i?t._plugSvcs.postEvent(t._isInstance?"INST_PROPS_OFF_NONE_AVAILABLE":t._isEffectivity?"EFFECTIVITY_OFF_NONE_AVAILABLE":"REF_PROPS_OFF_NONE_AVAILABLE",{id:"attrFetch"}):t.updateOutput(e)}},function(e){var i="getAttrData() failed:: "+e;t._plugSvcs.dbgout("ATTR_CACHE",t._DEBUG_isInstTxt+i)})}}}.bind(this)),e.subscribeEvent("LOAD_PROPS_FOR_EXPORT",function(e){var t=this,i=t._isInstance?"INSTANCE":t._isEffectivity?"EFFECTIVITY":"REFERENCE";let n={type:i};t._plugSvcs.postEvent("PROPERTIES_LOAD_IN_PROGRESS_EVENT",n);let o=this._isInstance?e.data.loadPropIDS_INST:this._isEffectivity?e.data.loadPropIDS_INST:e.data.loadPropIDS_REF;t._attrCache.doPreload(o).then(function(e){let n={type:i,props:e};t._plugSvcs.postEvent("PROPERTIES_CACHE_LOADED_EVENT",n)},function(e){this._plugSvcs.errout("FAILED to load props: "+e)})}.bind(this)),e.subscribeEvent("EVENT_FLUSH_DATA_CACHES",function(e){this._attrCache.flushCache()}.bind(e)),e._parent()},onDestroy:function(){return this._parent()},execute:function(e,t){var i=this;i._parent(e,t),this._comparisonInProgress=!0;let n=e;i._isInstance?i.postEvent("INST_PROPS_OFF_NONE_AVAILABLE",{id:"attrFetch"}):i._isEffectivity?i.postEvent("EFFECTIVITY_OFF_NONE_AVAILABLE",{id:"attrFetch"}):(i._plugSvcs.postEvent("REF_PROPS_UPDATE_IN_PROGRESS_EVENT",null),i._plugSvcs.dbgout("Performing initial ATTR_FETCH"),i._attrCache.getAttrData(n).then(function(e){null!=e&&i.reportOK(e)},function(e){i._plugSvcs.showAlertBox("Failed to retrieve properties",null,"error"),i._plugSvcs.postEvent(i._isInstance?"INST_PROPS_FETCH_FAILED":i._isEffectivity?"EFFECTIVITY_FETCH_FAILED":"REF_PROPS_FETCH_FAILED"),i.reportKO(e)}))}})}),define("DS/CompareWidget2/cw2",["DS/CompareCommon/Utils","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/framework/CPF","DS/CompareWidget2/framework/pluginServices","DS/CompareWidget2/widget/viewPanelMgr","DS/CompareWidget2/support/EventManager","DS/CompareWidget2/support/objIDSpec","DS/CompareWidget2/Customization/CompareCustomizationManager","i18n!DS/CompareWidget2/assets/nls/DisplayMessages"],function(e,t,i,n,o,r,s,a,l){var u={getAck:function(){return"Ack"}},c=function(e,t){t=t||{};this._runOptions={app:"COMPARE",viewDefType:"LOOKUP",viewSetName:"STRUCT_ONLY",viewSetMod:"DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2",isODT:!1},Object.assign(this._runOptions,t,this._runOptions);var l=this;this._eventMgr=new r,this._ccm=new a,this._ccm.init().then(t=>{l._viewPanelMgr=new o(e,this._eventMgr,this._runOptions,this._ccm);var r=new n(this._viewPanelMgr,this._eventMgr);if(l._CPF=new i(l._viewPanelMgr,l._eventMgr,r,l._runOptions,l._ccm),l._eventTokens=[],l._eventTokens.push(l._eventMgr.subscribe({event:"Event_inputUpdate"},l._handler_inputUpdate.bind(l))),l._eventTokens.push(l._eventMgr.subscribe({event:"Event_replaceCompare"},l._handler_replaceCompare.bind(l))),l._eventTokens.push(l._eventMgr.subscribe({event:"Event_CW2_SWAP"},l._handler_CW2_SWAP.bind(l))),l._eventTokens.push(l._eventMgr.subscribe({event:"Event_CW2_REFRESH"},l._handler_CW2_REFRESH.bind(l))),l._eventTokens.push(l._eventMgr.subscribe({event:"Event_CW2_RESET_TO_INPUT"},l._handler_CW2_RESET_TO_INPUT.bind(l))),l._eventTokens.push(l._eventMgr.subscribe({event:"Event_CW2_SELECT_PROFILE"},l._handler_CW2_SELECT_PROFILE.bind(l))),l._eventTokens.push(l._eventMgr.subscribe({event:"Event_controlCustomizationDone"},l._handler_POST_EDIT_CUSTOMIZATION.bind(l))),null!=l._runOptions.objAMDNameArray){var a=new s("FILE_0","UNKNOWN",null);a.objAMDName=l._runOptions.objAMDNameArray[0];var c=new s("FILE_1","UNKNOWN",null);c.objAMDName=l._runOptions.objAMDNameArray[1];var d=[a,c];l.compareObjsWithViewSetName(d,l._runOptions.viewSetMod,l._runOptions.viewSetName)}1==l._runOptions.isODT&&(forODT_this=l,l.forODT=u,widget.dispatchEvent("ENOLCM/CompareWidget/endLoadingWidget"))})};return c.prototype._handler_inputUpdate=function(e){if(!this.compareIsRunning&&null!=e&&e.length>0){if(this.compareIsRunning=!0,"AS_GIVEN"==this._runOptions.viewDefType){var t=this._runOptions.viewSetMod,i=this._runOptions.viewSetName;this.compareObjsWithViewSetName(e,t,i)}else this.compareObjs(e);this._currObjIDSpecArray=e,setTimeout(()=>{this.compareIsRunning=!1},2e3)}},c.prototype._handler_replaceCompare=function(e){if(null==this._currObjIDSpecArray||this._currObjIDSpecArray.constructor!=Array||this._currObjIDSpecArray.length<2)t.errout("dropCompare called  without prior comparison");else{var i=null==e?null:null==e.data?null:e.data.objIDSpecArray;if(null==i||i.constructor!=Array||i.length<1)t.errout("bad call to dropCompare");else{for(var n=this._currObjIDSpecArray.length,o=e.data.targetIndex,r=[],s=0;s<n;s++)s==o?i.forEach(function(e){r.push(e)}):r.push(this._currObjIDSpecArray[s]);this._handler_inputUpdate(r)}}},c.prototype._handler_CW2_SWAP=function(){this._eventMgr.publish({event:"EVENT_FLUSH_DATA_CACHES"}),this._eventMgr.publish({event:"Event_clearView"});var e=this._currObjIDSpecArray.shift();this._currObjIDSpecArray.push(e),this._handler_inputUpdate(this._currObjIDSpecArray)},c.prototype._handler_CW2_REFRESH=function(){this._eventMgr.publish({event:"EVENT_FLUSH_DATA_CACHES"}),this._eventMgr.publish({event:"Event_clearView"}),this._handler_inputUpdate(this._currObjIDSpecArray)},c.prototype._handler_CW2_RESET_TO_INPUT=function(){this._eventMgr.publish({event:"Event_clearView"}),this._eventMgr.publish({event:"Event_resetToDropFrame"}),this._currObjIDSpecArray=null},c.prototype._handler_CW2_SELECT_PROFILE=function(e){if(null!=e&&null!=this._currObjIDSpecArray[0]){var t=this._currObjIDSpecArray[0].getObjType();this._ccm.setUserPreferredProfileName(t,e)}this._eventMgr.publish({event:"EVENT_FLUSH_DATA_CACHES"}),this._eventMgr.publish({event:"Event_clearView"}),this._handler_inputUpdate(this._currObjIDSpecArray)},c.prototype._handler_POST_EDIT_CUSTOMIZATION=function(e){!0===e.status&&(this._eventMgr.publish({event:"EVENT_FLUSH_DATA_CACHES"}),this._eventMgr.publish({event:"Event_clearView"}),this._handler_inputUpdate(this._currObjIDSpecArray))},c.prototype.refresh=function(){this._viewPanelMgr.isResultViewActive()&&this._handler_CW2_REFRESH(),this._viewPanelMgr.refreshFrame()},c.prototype.getAppName=function(){return this._runOptions.app},c.prototype.getWidgetTitle=function(){return this._runOptions.widgetTitle},c.prototype.compareObjs=function(i){var n=this,o=[];i.forEach(function(e){var t=e.makeDupe();o.push(t)}),this._CPF.compareObjs(this._runOptions.app,o).then(function(e){t.dbgout("CW2 reports build/drop IDs successful."),n._eventMgr.publish({event:"Event_disableSwap",data:o.length>2})},function(i){t.errout("CW2 reports failure :"+i),null!=i.stack&&t.errout("Stack trace:"+i.stack),n._eventMgr.publish({event:"Event_CW2_RESET_TO_INPUT"}),e.showAlertBox("COMPARE_FAILED",l,"error",!0)})},c.prototype.compareObjsWithViewSetName=function(i,n,o){t.dbgout("Comparing with named viewSet '"+o+"' from viewDefModule '"+n+"'");var r=this;this._CPF.compareObjsWithViewSetName(i,n,o).then(function(e){t.dbgout("CW2 reports build/drop IDs successful.")},function(i){t.errout("CW2 reports  build/drop IDs FAILED :"+i.stack),r._eventMgr.publish({event:"Event_CW2_RESET_TO_INPUT"}),e.showAlertBox("Compare failed",l,"error",!0)})},c.prototype.onWidgetPrefsUpdate=function(){this._ccm.init(!0)},c}),define("DS/CompareWidget2/CompareWidget2",["DS/LifecycleServices/LifecycleServicesSettings","DS/CompareWidget2/cw2","DS/CompareWidget2/userSettings/UserSettingsManager","DS/LifecycleServices/LifecycleServices","DS/CompareCommon/Utils"],function(e,t,i,n,o){"use strict";var r=null,s={onLoad:function(i){i=i||{},widget._isODTMode=(()=>"cw2_unittest_client"===widget.id),e.app_initialization(function(){let a=widget._isODTMode()?document.body:(widget.body.innerHTML="",widget.body);i.isODT=widget._isODTMode();var l={configPath:"DS/CompareWidget2/userSettings/VPMReference"};"MERGE"!==i.app&&"NRF"!==i.app||(l.configPath="DS/CompareMergePlugin/userSettings/Merge"),require(["DS/CompareWidget2/userSettings/UserSettingsManager"],e=>{e.loadSettingsFromConfigPromise(l).then(()=>{var e="",n=(r=new t(a,i)).getAppName();if("COMPARE"!=n){var o=r.getWidgetTitle();o&&o.length>0?e=o:e+=" ("+n+")"}widget._isODTMode()&&Object.assign(s,{_getCW2ODTAck:function(){return r.forODT.getAck()},_getCPF:function(){return r._CPF},_getcw2:function(){return r}}),widget.setTitle(e)},()=>{console.error("COMPARE widget failed to load user settings... cannot continue.")})}),widget.isWebInWin;var u=e.getOption("platform_services",null);null!=u&&u.length>0&&Array.isArray(u)&&u.forEach(function(e){null!=e&&e.hasOwnProperty("platformId")&&n.getSecurityContextList(e.platformId,function(){var e=widget.getValue("X3DContentId");if(null!=e&&""!==e){var t=JSON.parse(e);void 0!==t.appContextId&&null!==t.appContextId&&""!==t.appContextId&&o.setCredentialsToWidget(t.appContextId)}})})})},onResize:function(){},onViewChange:function(e){},onRefresh:function(e){null!=r&&r.refresh()},onEdit:function(){},endEdit:function(){var e=widget.getPreferences();r.onWidgetPrefsUpdate(),e.forEach(e=>{i.hasPref(e.name)&&i.get(e.name)!==widget.getValue(e.name)&&i.set(e.name,widget.getValue(e.name))})}};return s});