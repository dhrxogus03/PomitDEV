define("DS/PIMwebUXinWin/PIMWiWItfListCtrl",["UWA/Class","UWA/Core","DS/PIMwebUX/PIMwebDetailedItfListUI","DS/UIKIT/Native/Dropdown","i18n!DS/PIMwebUX/assets/nls/PIMwebItfListUI","css!DS/PIMwebUX/assets/css/PIMwebItfListUI"],function(e,t,n,i,o){"use strict";return e.extend({init:function(e){var s=[],d="object"==typeof e.defOrder?Array.from(e.defOrder):e.defOrder.split(","),l=[],r=[],a={},c=null,f=!0,u=!0,g={},p=null,h=0,w=!0,I=e.currentUnits,m=e.typeOfItf,S=["itfQuantifier","itfPenVec","itfMinDist","itfPenVol","itfTolerance","Time"];function C(){var e,t=0,n=0,i=0;s.forEach(function(e){if(!e.isElectrical){var o=e.itfUserType,s=e.itfSystemType;"Clash"===o?t+=e.childIds?e.childIds.length:1:"Contact"===o?n+=e.childIds?e.childIds.length:1:"Clearance"===o?i+=e.childIds?e.childIds.length:1:o&&"Undefined"!==o||("Clash"===s?t+=e.childIds?e.childIds.length:1:"Contact"===s?n+=e.childIds?e.childIds.length:1:"Clearance"===s&&(i+=e.childIds?e.childIds.length:1))}}),(t||n||i)&&(e=t?t+" "+o["Clash"+(t>1?"es":"")]:"",e+=e&&n?" ":"",e+=n?n+" "+o["Contact"+(n>1?"s":"")]:"",e+=e&&i?" ":"",e+=i?i+" "+o["Clearance"+(i>1?"s":"")]:""),window.dscef.sendString(JSON.stringify({action:"chgTitle",title:e||o.noItf}))}function y(e){if(s[e.id][e.param]!==e.newValue){s[e.id].isMetric&&"itfMetricName"===e.param&&(s[e.id].tree=s[e.id].itfName=e.newValue),s[e.id].isContextual&&"itfCtxName"===e.param&&s[e.id].itfName===s[e.id].itfCtxName&&(s[e.id].tree=s[e.id].itfName=e.newValue),s[e.id][e.param]=e.newValue,"itfUserType"===e.param&&C(),"itfAnalysis"===e.param&&"NotAnalyzed"===e.newValue&&(e.newValue="OK"===s[e.id].itfPrevAnalysis||"KO"===s[e.id].itfPrevAnalysis?"To_be_ReAnalyzed":"To_be_Analyzed");for(var t=[],n=s[e.id];n&&n.childOf;)t.push(n.childOf),n=s[n.childOf];window.dscef.sendString(JSON.stringify({action:"onAttributeChange",colValue:e.newValue,col:e.param,itfId:e.id,parents:t})),setTimeout(function(){c.reApplyFilterAndSort()},100)}}function v(){clearTimeout(h),w=!1}function R(e){w=!0,g._lastX=e.clientX,g._lastY=e.clientY,g.launched&&(window.dscef.sendString(JSON.stringify({action:"closeToolTip"})),g.launched=!1),h=setTimeout(function(){if(e.clientX===g._lastX&&g._lastY===e.clientY&&w){var t=c.getRowInfosFromMousePosition({top:g._lastY,left:g._lastX}),n="",i=0;Object.keys(t).forEach(function(e){var o="&nbsp"+e+" : "+t[e]+"&nbsp";o.length>=i&&(i=o.length),n=n+o+"<br>"}),""!==n&&w&&(g.launched=!0,window.dscef.sendString(JSON.stringify({action:"buildtoolTip",tooltipInfoFrmJs:n,width:9*parseInt(i),height:20*(Object.keys(t).length+1)})))}},1500)}function O(e){if("number"==typeof e){var t=c.getNumberOfRows(),n=e<0?t-1:e>=t?0:e;c.selectRows([n])}}function x(e){window.dscef.sendString(JSON.stringify({action:"hideOpacitySlider",hideOpacitySlider:e}))}function b(e){var t=e.idsSelected,n=[];t.length&&(t.forEach(function(e){-1===r.indexOf(e)&&r.push(e)}),t.forEach(function(e){n.push(s[e].metricId?s[e].metricId:"0")}),f&&u&&window.dscef.sendString(JSON.stringify({action:"onItfSelection",itfId:r,actualIdsSelected:e.actualIdsSelected,mIdsToSelect:n})),a.isDetailUICmdActivated&&(window.dscef.sendString(JSON.stringify({action:"stopDetailUICmd"})),a.isDetailUICmdActivated=!1))}function N(e,t){if(e.length){if(e.length===r.length)f&&window.dscef.sendString(JSON.stringify({action:"onAllItfUnselection"})),r.length=0;else{var n=[];e.forEach(function(e){r.splice(r.indexOf(e),1),n.push(e)}),f&&window.dscef.sendString(JSON.stringify({action:"onItfUnSelection",itfId:n,actualIdsSelected:t}))}a.isDetailUICmdActivated&&(window.dscef.sendString(JSON.stringify({action:"stopDetailUICmd"})),a.isDetailUICmdActivated=!1)}}function V(){p&&(p.destroy(),p=null)}function A(e,t){if(0!==e.length){var n={items:e,id:"PimWiWMenu"+(t?"Row":"Columns"),target:document.body,contextual:!1,bound:!1,removeOnHide:!0,closeOnClick:!0,events:{onClickOutside:function(){this.hide(),V()}}};(p=new i(n))&&p.show()}}function D(){setTimeout(function(){window.dscef.sendString(JSON.stringify({action:"refreshCmd"}))},0)}function E(){window.dscef.sendString(JSON.stringify({action:"exploreToItfFinder",itfIds:c.getSelectedInterferences()}))}function U(){window.dscef.sendString(JSON.stringify({action:"multiRootOpen",itfIds:c.getSelectedInterferences()}))}function J(){var e=c.getLeafNodeIds(!1),t=c.exportAsCSV({onlySelectedRows:!1});window.dscef.sendString(JSON.stringify({action:"exportFiltered",itfIds:e,csvData:t,penVolInQuantCol:c.IsPenVolInQuantCol()}))}function P(){var e=c.getLeafNodeIds(!0),t=c.exportAsCSV({onlySelectedRows:!0});window.dscef.sendString(JSON.stringify({action:"exportSelected",itfIds:e,csvData:t,penVolInQuantCol:c.IsPenVolInQuantCol()}))}function q(){window.dscef.sendString(JSON.stringify({action:"centreGraph"}))}function T(){window.dscef.sendString(JSON.stringify({action:"onDetailUI"}))}function F(){window.dscef.sendString(JSON.stringify({action:"onGenerateIssue"}))}function _(){window.dscef.sendString(JSON.stringify({action:"onChangeAction"}))}function M(e,t){w=!1,V();let n=[];function i(e){if("SeparatorItem"===e.type)return null;var t={text:e.title};return e.state&&(t.disabled="selected"===e.state),e.action&&e.action.callback&&"customView"!==e.id&&(t.nativeHandler=function(){e.action.callback.call(e.action.this,{context:e.action.context}),window.dscef.sendString(JSON.stringify({action:"penVolInQuantCol",penVolInQuantCol:c.IsPenVolInQuantCol()}))}),e.action&&e.action.context&&"customView"===e.id&&(t.nativeHandler=function(){!function(e){parent.getcollectionView=function(){return e};var t=window.open("dsrtv://webapps/PIMwebUXinWin/PIMWiWItfListColumnCustomView.html","","width=505,height=505,top=150,left=300");t.focus(),window.dscef.sendString(JSON.stringify({action:"removeMinimizedBtn"})),parent.closePopUp=function(){t.close(),parent.document.removeEventListener("mousedown",parent.closePopUp)},parent.document.addEventListener("mousedown",parent.closePopUp)}(e.action.context)}),t}t.forEach(function(e){var t=i(e);e.submenu&&(t.items=[],Object.keys(e.submenu).forEach(function(n){var o=i(e.submenu[n]);o&&t.items.push(o)})),t&&n.push(t)}),e.isHeaderMenu?A(n,!1):window.dscef.sendString(JSON.stringify({action:"ctxMenu"}))}this.addInterferences=function(e){Object.keys(e).forEach(function(t){!function e(t){t.itfuid&&(t.originated&&(t.originated=new Date(t.originated)),t.modified&&(t.modified=new Date(t.modified)),s[t.itfuid]=t),t.hasOwnProperty("row")&&e(t.row),t.hasOwnProperty("children")&&Object.keys(t.children).forEach(function(n){t.children[n].hasOwnProperty("row")&&e(t.children[n])})}(e[t])}),c.updateInterferences(e),C(),window.dscef.sendString(JSON.stringify({action:"itfListRowBuildDone",penVolInQuantCol:c.IsPenVolInQuantCol()}))},this.refreshView=function(){c.updateDataGridView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0})},this.isApplySlideShow=function(e){var t;if("onBeginCB"===e.action){var n=c.getVisibleRows(),i=(t=c.getSelectedRows())&&t.length?t.length>1?t[0]:t[0]+1:0;t.length?(window.dscef.sendString(JSON.stringify({action:"setSlideShowValues",inumVisibleRows:n,iselectedRowID:i})),O(i>0?i-1:0)):(O(0),window.dscef.sendString(JSON.stringify({action:"setSlideShowValues",inumVisibleRows:n,iselectedRowID:i+1}))),window.dscef.sendString(JSON.stringify({action:"onSlideShowBegin"}))}else if("onPreviousSlideCB"===e.action){O((t=c.getSelectedRows())&&t.length?t.length>1?t[0]:t[0]-1:0)}else if("onNextSlideCB"===e.action){var o=c.getSelectedRows();O(o&&o.length?o.length>1?o[0]:o[0]+1:0)}else"onFirstSlideCB"===e.action?O(0):"onLastSlideCB"===e.action?O(c.getNumberOfRows()-1):"onCloseCB"===e.action&&window.dscef.sendString(JSON.stringify({action:"onSlideShowEnd"}))},this.removeAllInterference=function(){s.length&&c.removeInterferences(),s.length=0,C()},this.performSelAfterCbChange=function(){window.dscef.sendString(JSON.stringify({action:"onItfSelection",itfId:r}))},this.checkAndselectItfFromMid=function(e){var t=setInterval(function(){var n=c.getVisibleRows();if(c&&c.isDataGridReady()&&(n||!s.length)){let n=[];e.mIds.reverse().forEach(function(e){s.some(function(t){if(t.metricId===e)return n.push(t.itfuid),!0})}),clearInterval(t),f=!0,f=!0,c.selectRowsByUID(n,!0)}},10)},this.getItfVisibleRows=function(){var e=[],n=[],i=[],o=c.getLeafNodeIds(),s=c.getColumns();if(s.length>0&&s.forEach(function(e){!1!==e.visibleFlag?(e.visibleFlag=void 0===e.visibleFlag||e.visibleFlag,n.push(e)):"itfQuantifier"!==e.dataIndex&&"itfPenVol"!==e.dataIndex&&"itfPenVec"!==e.dataIndex&&"itfMinDist"!==e.dataIndex&&i.push(e)}),o.length){let s;for(let n=0;n<o.length;n++){s=t.clone(c.getInternalChildInfo(o[n]),!0);for(const e of Object.keys(s))i.some(t=>t.dataIndex===e)&&delete s[e],"itfuid"===e&&(s[e]=s[e].toString(),s.isNonPersistentPIM=!0);e.push(s)}window.dscef.sendString(JSON.stringify({action:"visibleRows",itfIds:c.getSelectedInterferences(),visibleRows:e,columns:n}))}else window.dscef.sendString(JSON.stringify({action:"visibleRows",itfIds:[],visibleRows:[],columns:[]}))},this.selectItf=function(e){var t=[];Object.keys(e).forEach(function(n){"propogateCb"===n?f="true"===e[n]:t.push(e[n])}),c.selectRowsByUID(t),setTimeout(function(){f=!0},100)},this.wiwSyncJsFunc=function(e,t,n){var i={error:""};"getSelectedItfs"===e.func&&(i.success={func:"getSelectedItfs",nbSelItf:r.length,selItfList:r}),i.success?t(JSON.stringify(i.success)):n(JSON.stringify(i))},this.addInfoForItfList=function(e){if(e.isDetailedUICmdReq&&(a.detailedCmdReq=e.isDetailedUICmdReq),e.isRefreshCmdReq&&(a.isRefreshCmdReq=e.isRefreshCmdReq),e.isMultiRootCmdReq&&(a.isMultiRootCmdReq=e.isMultiRootCmdReq),e.isChgActionRequired&&(a.chgActionReq=e.isChgActionRequired),e.isGenIssueRequired&&(a.genIssueReq=e.isGenIssueRequired),e.isExportFilteredReq&&(a.isExportFilteredReq=e.isExportFilteredReq),e.isExportSelectedReq&&(a.isExportSelectedReq=e.isExportSelectedReq),e.centreGraphCmdReq&&(a.centreGraphCmdReq=e.centreGraphCmdReq),e.isExploreToItfFinderCmdReq&&(a.isExploreToItfFinderCmdReq=e.isExploreToItfFinderCmdReq),void 0!==e.toolTip&&(e.toolTip?(document.body.addEventListener("mouseover",R),document.body.addEventListener("mouseleave",v)):(document.body.removeEventListener("mouseover",R),document.body.removeEventListener("mouseleave",v))),e.newCodeVersion&&(u=!0),e.currentUnits&&(c.setUnits(e.currentUnits),c.updateInterferences(s)),e.relaunchPublishCmd)var t=[],n=!1,i=setInterval(function(){c&&(clearInterval(i),e.exppandCollpsedReq&&(t=c.expandOrCollapse(!0,!1,!1,!0)),setTimeout(function(){n||(n=!0,window.dscef.sendString(JSON.stringify({action:"exportFiltered",itfIds:c.getLeafNodeIds(!1),csvData:c.exportAsCSV({onlySelectedRows:!1}),penVolInQuantCol:c.IsPenVolInQuantCol()}))),e.exppandCollpsedReq&&c.expandOrCollapse(!1,!1,t,!1)},0))},0);e.buildAgainRowCtxMenu&&function(){let e=[];a.isRefreshCmdReq&&e.push({text:o.itfRefresh,nativeHandler:D}),a.isExploreToItfFinderCmdReq&&e.push({text:o.itfExploreToItfFinder,nativeHandler:E}),a.isMultiRootCmdReq&&e.push({text:o.itfMultiRootOpen,nativeHandler:U}),a.isExportFilteredReq&&e.push({text:o.itfExportFiltered,nativeHandler:J}),a.isExportSelectedReq&&e.push({text:o.itfExportSelected,nativeHandler:P}),a.centreGraphCmdReq&&e.push({text:o.itfCentreGraph,nativeHandler:q}),a.detailedCmdReq&&1===r.length&&(e.push({text:o.itfDetailComp,nativeHandler:T}),a.isDetailUICmdActivated=!0);var t=[];a.genIssueReq&&t.push({text:o.itfGenIssue,icon:"I_DMUIssue.png",nativeHandler:F}),a.chgActionReq&&t.push({text:o.itfChgAction,icon:"I_VALCA.png",nativeHandler:_}),0!==t.length&&e.push({text:2===t.length?o.itfTIC:o.itfTIC+" "+t[0].text,items:2===t.length?t:null,nativeHandler:2===t.length?null:function(){a.chgActionReq?window.dscef.sendString(JSON.stringify({action:"onChangeAction"})):window.dscef.sendString(JSON.stringify({action:"onGenerateIssue"}))}}),A(e,!0)}()},this.wiwOdtHelper=function(e){var t=setInterval(function(){window.dscef.sendString(JSON.stringify({action:"odtCallReceived"}));var n=c.getVisibleRows(),i=c.getSelectedRows();if(n||!s.length){var o=[],d=0;if(e.selectAll)e.NewDlg?c.selectOrUnselectAll(c.getSelectedRows().length!==c.getNumberOfRows()):o=Object.keys(s).map(function(){return d++});else if(e.rowSelect)try{o=(o=JSON.parse(e.rowSelect)).filter(function(e){return e<=n.length&&e>0}).map(function(e){return e-1})}catch(e){o=[]}if(o.length)if(e.NewDlg){if(e.selOrUnSel){var l=e.keepSelection&&-1!==i.indexOf(o[0]);c.selectOrUnselectRows(o,l?!l:e.selOrUnSel,e.keepSelection,e.shift)}}else c.selectRows(o);if(e.expandOrCollapse&&c.expandOrCollapse(!o.length||e.selectAll,0!==o.length&&o,!1,1===e.expandOrCollapse),e.dumpList){var a=c.exportAsCSV({onlySelectedRows:!1,allColumns:!0});window.dscef.sendString(JSON.stringify({action:"odtDumpList",dumpListData:a}))}setTimeout(function(){e.cellEditCombo&&e.cellEditVal&&r.length>0&&(r.forEach(function(t){c.updateModel(t,e.cellEditCombo,e.cellEditVal)}),c.updateDataGridView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0})),"Refresh"===e.cxtCmd?D():"Export Filtered"===e.cxtCmd?J():"Export Selected"===e.cxtCmd?P():"Centre Graph"===e.cxtCmd?q():"Detailed Computation"===e.cxtCmd?T():"Explore with Interference Finder"===e.cxtCmd?E():"Multi Root Open"===e.cxtCmd?U():"Generate Issue"===e.cxtCmd?F():"Generate Change Action"===e.cxtCmd&&_()},10),clearInterval(t)}else window.dscef.sendString(JSON.stringify({action:"odtWait"}))},0)},function(e){if(!c){i=e.defCols,Object.keys(i).forEach(function(e){if("V_Itf_Analysis"!==e&&"V_Itf_User_Type"!==e&&"V_description"!==e&&"itfCtxName"!==e&&"itfUserType"!==e&&"V_Itf_Type"!==e&&"V_Itf_Previous_Analysis"!==e&&"originated"!==e&&"modified"!==e&&"tree"!==e&&"itfAnalysis"!==e)l[e]={dataIndex:e,text:i[e],width:"auto"},"itfLblOldInst1"!==e&&"itfLblOldInst2"!==e||(l[e].visibleFlag=!1);else{var t=d.indexOf(e);"V_Itf_Analysis"===e?d[t]="itfAnalysis":"V_Itf_User_Type"===e?d[t]="itfUserType":"V_Itf_Type"===e?d[t]="itfSystemType":"V_Itf_Previous_Analysis"===e?d[t]="itfPrevAnalysis":"pimNonPersistent"!==m||"itfAnalysis"!==e&&"itfUserType"!==e?"tree"===e&&"object"==typeof i[e]?(l[e]={dataIndex:i[e].dataIndex,text:i[e].text,visibleFlag:!i[e].visibleFlag||i[e].visibleFlag,typeRepresentation:i[e].typeRepresentation?i[e].typeRepresentation:"string",editableFlag:void 0===i[e].editableFlag||i[e].editableFlag},"double"===i[e].typeRepresentation&&S.push("label")):"originated"===e||"modified"===e?l[e]={dataIndex:e,text:i[e],typeRepresentation:"datetime",width:"auto"}:"V_description"===e&&(d[t]="itfDescription"):l[e]={dataIndex:e,visibleFlag:!1}}});var t={parent:document.body,suffix:m,cbDnD:{onDragStartColumnHeader:function(){return!0},onDragColumnHeader:function(){return!0},onDragOverColumnHeader:function(){return!0},onDragEnterColumnHeader:function(){return!0},onDragLeaveColumnHeader:function(){return!0},onDragEndColumnHeader:function(){return!0},onDropColumnHeader:function(){return!0}},defCols:l,deforder:d,readOnly:"pimPersistent"!==m&&"pimNonPersistent"!==m,isWebInWin:!0,units:I,filterCols:{addColswithNumber:"pimIdyClash"===m?["label"]:void 0,addColsWithSet:"pimNonPersistent"===m?["label"]:void 0}};(c=new n(t)).onSelect=b,c.onHideShowOpaSlider=x,c.onUnselect=N,c.onCellEdit=y,c.contextualEvent=M,window.dscef.sendString(JSON.stringify({action:"itfListColumnBuildDone"}))}var i}(e)}})});