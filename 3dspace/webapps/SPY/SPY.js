/*!  Copyright 2014 Dassault Systemes. All rights reserved. */
define("DS/SPY/CATSimNavDataDisplayAbstract",["UWA/Core","UWA/Class","DS/CoreEvents/Events"],function(t,e,i){"use strict";var a=function(t){return t.filter(function(t){return t})},s=function(t,e){var i=t[e],n=i.getChildren?i.getChildren():void 0;if(Array.isArray(n))if(n.length>0){var r=n[0].isExtractable,o=void 0===n[0].getChildren;if(1===n.length&&o&&r){var l=n[0],u=i.getName(),h=l.getTitle?l.getTitle():l.getName();t[e]=l,t[e].children=[],h&&0!==h.length||(t[e].name=u)}else n.forEach(function(t,e){s(n,e)}),n=a(n),i.children=n;if(n.length>1){var c=1;n.forEach(function(t){t.isExtractable&&t.getName()&&t.getName()===i.getName()&&(t.name+=" - "+t.getSuffix()+" #"+String(c),c++)})}}else t[e]=void 0},n=e.extend({_getSortedDuplicates:function(t){for(var e=[],i=t.sort(),a=0;a<i.length-1;a++)i[a+1]===i[a]&&i[a]&&e.push(i[a]);return e},_computeScopeMinMax:function(t){var e=this.getLegend();e&&e.localMin&&e.localMax&&(t.min=Math.min.apply(null,e.localMin.slice(t.globalStart,t.globalEnd+1)),t.max=Math.max.apply(null,e.localMax.slice(t.globalStart,t.globalEnd+1)))},init:function(t,e,i){this.spm=e,this.seq=i,this.id="",this.name="Data Display",this.category="Model",this.thumbnail="",this.defaultMode="ENG",this.activated=!1,this.list2DViews=[],this.list3DViews=[],this.listFrameViews=[],this._listInfoImages=[],this.analytics={},this._analyticsTimeStarts={},this.impl={CATISimNavDataDisplayUI:{module:"SPYUI",ext:"CATSimNavDataDisplayUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavDataDisplayAnimation",type:"data",obj:null},CATISimNavDataColorShadingManager:{module:"SPYUI",ext:"CATSimNavDataDisplayColorShadingManager",type:"data",obj:null}}},clean:function(){delete this.spm,delete this.seq,delete this.list2DViews,delete this.list3DViews,delete this.listFrameViews,delete this.impl},QI:function(t,e){this.impl&&(this.impl[t]?this.impl[t].obj?e(this.impl[t].obj):require(["DS/"+(this.impl[t].module?this.impl[t].module:"SPY")+"/"+this.impl[t].ext],function(i){if(this.impl){for(var a in this.impl[t].obj=new i,this.impl[t].obj.implementation=this,this.impl)this.impl[a].ext===this.impl[t].ext&&(this.impl[a].obj=this.impl[t].obj);e(this.impl[t].obj)}else e()}.bind(this)):e())},getSPM:function(){return this.spm},getSequence:function(){return this.seq},getNavData2DViewList:function(t){var e=[];if(this.spm&&this.list2DViews){var i=[];if(!this.isShared&&void 0===t){var a=this.spm.getSharedDataDisplayList(this.seq);if(a)for(var s=0;s<a.length;s++)i=i.concat(a[s].getNavData2DViewList())}e=this.list2DViews.concat(i)}return e},getNavData3DViewList:function(t){var e=[];if(this.spm&&this.list3DViews){var i=[];if(!this.isShared&&void 0===t){var a=this.spm.getSharedDataDisplayList(this.seq);if(a)for(var s=0;s<a.length;s++)i=i.concat(a[s].getNavData3DViewList())}e=this.list3DViews.concat(i)}return e},getNavDataFrameViewList:function(t){var e=void 0===t||!0===t?this.category:void 0,i=[];if(this.spm&&this.listFrameViews){var a=[];if(!this.isShared){var s=this.spm.getSharedDataDisplayList(this.seq,e);if(s)for(var n=0;n<s.length;n++)a=a.concat(s[n].getNavDataFrameViewList())}i=this.listFrameViews.concat(a)}return i},simplifyFrameViewList:function(){this.spm&&this.listFrameViews&&(this.listFrameViews.forEach(function(t,e){s(this.listFrameViews,e)}.bind(this)),this.listFrameViews=a(this.listFrameViews))},isEmpty:function(){var t=this.getNavData3DViewList(),e=this.getNavData2DViewList(),i=this.getLegend();return 0===t.length&&e.length===(i?1:0)&&0===this.listFrameViews.length},getStreamlines:function(){return this.getNavData3DViewList().filter(function(t){return"streamLines"===t.subType&&(t.isAStreamLine=!0,!0)})},hasExtremaAvailable:function(t){for(var e,i=!1,a=this.getNavData3DViewList(),s=0;s<a.length&&!e;s++)"CATSimNavData3DExtremasRoot"===a[s].getType()&&(e=a[s]);if(e)for(var n=e.getListExtremasSet(),r=0;r<n.length&&!i;r++){var o=n[r];if(o){var l=o.getExtremas(t);i=l&&l.getListExtrema().length>0}}return i},getLegend:function(){for(var t,e=this.getNavData2DViewList(),i=0;i<e.length;i++)if("CATSimNavData2DLegend"===e[i].type){t=e[i];break}return t},hasMinMax:function(){var t=this.getLegend();return t&&t.hasMinMax()&&!t.NoResults},getGroupInfo:function(t){var e={},i=this.getLegend();if(i){var a=this.getGroupForFrame(t);if(a){if(a.group){var s=function(t){var e={},a=t.globalStart,s=t.globalEnd;e.min=i.localMin[a],e.max=i.localMax[s];for(var n=a+1;n<=s;n++)i.localMin[n]<e.min&&(e.min=i.localMin[n]),i.localMax[n]>e.max&&(e.max=i.localMax[n]);return e}(a.group);e.groupMin=s.min,e.groupMax=s.max}}e.localMin=i.localMin[t],e.localMax=i.localMax[t],e.frameIndex=t,e.userMin=i.userMin,e.userMax=i.userMax}return e},updateLegend:function(t){var e=this.getLegend();if(e&&t&&t.globalStart>=0&&t.globalStart<e.localMin.length&&t.globalEnd<e.localMin.length){e.min=e.localMin[t.globalStart],e.max=e.localMax[t.globalStart];for(var i=t.globalStart+1;i<=t.globalEnd;i++)e.localMin[i]<e.min&&(e.min=e.localMin[i]),e.localMax[i]>e.max&&(e.max=e.localMax[i])}},hasNoGlobalData:function(){if(void 0===this._noGlobalData){var t=this.getLegend();t&&(this._noGlobalData=t.hasNoGlobalFlag())}return this._noGlobalData},isAnimated:function(){var t=!1,e=this.getAnimationStructure();return e&&(t=e.totalFrameNumber>1),t},isAnimationInitialized:function(){return this.animationInitialized},setAnimationAsInitialized:function(){this.animationInitialized=!0},getTotalNumberOfFrames:function(){var t,e=this.getAnimationStructure();return e&&(t=e.totalFrameNumber),t},getAnimationStructure:function(){if(!this.animationStructure){var t=this.getLegend();t&&(this.animationStructure=t.animationStructure)}return this.animationStructure},getIsolatedFrames:function(){var t=[],e=this.getAnimationStructure();if(e&&e.groupList)for(var i=0;i<e.groupList.length;i++){var a=e.groupList[i];a&&a.frameList&&1===a.frameList.length&&void 0!==a.frameList[0].globalIndex&&t.push(a.frameList[0].globalIndex)}return t},getGroupForFrame:function(t){var e={},i=this.getAnimationStructure();if(!isNaN(t)&&i&&i.groupList)for(var a=0;a<i.groupList.length;a++){var s=i.groupList[a];if(s&&s.frameList)for(var n=0;n<s.frameList.length;n++){var r=s.frameList[n];if(r&&r.globalIndex===t+1)return e.group=s,e.frame=r,e}}return e},setPartialAnimationMode:function(t){"boolean"==typeof t&&(this._partialAnimMode=t,i.publish({event:this.spm.ctx+"/SPY/ANIMSCOPECHANGE"}))},isPartialAnimationMode:function(){return this._partialAnimMode},getDefaultAnimationScope:function(t){var e={groupIDs:[],groupIDsNoMode:[],frames:[],hasModes:!1},i=this.getAnimationStructure(),a=this.getGroupForFrame(t);if(i){var s;for(e.globalStart=0,e.globalEnd=i.totalFrameNumber-1,e.localPosition=a.frame?a.frame.globalIndex:void 0,s=0;s<i.groupList.length;s++)e.groupIDs.push(i.groupList[s].id),e.groupIDsNoMode.push(i.groupList[s].idNoMode),e.frames=e.frames.concat(i.groupList[s].frameList),e.hasModes=e.hasModes?e.hasModes:i.groupList[s].isMode;if(e.length=e.frames.length,i.computedFramesOnlyForDefault){for(e.frames=[],s=0;s<i.groupList.length;s++)e.frames=e.frames.concat(i.groupList[s].computedFrameList);e.globalStart=e.frames[0].globalIndex-1,e.globalEnd=e.frames[e.frames.length-1].globalIndex-1,e.length=e.frames.length,e.localPosition=e.frames.length;for(var n=0;n<e.frames.length;n++){var r=e.frames[n];r&&r.globalIndex===t&&(e.localPosition=n)}}this._computeScopeMinMax(e)}return e},getAnimationScope:function(t){var e={groupIDs:[],groupIDsNoMode:[],frames:[],hasModes:!1},i=this.getAnimationStructure(),a=this.getGroupForFrame(t);if(i&&a&&a.group){if(i.groupList.length>1)e.canBePartial=!0,e.globalStart=a.group.globalStart,e.globalEnd=a.group.globalEnd,e.localPosition=a.frame.localIndex,e.groupIDs.push(a.group.id),e.groupIDsNoMode.push(a.group.idNoMode),e.frames=e.frames.concat(a.group.frameList),e.hasModes=a.group.isMode;else{e.globalStart=0,e.globalEnd=i.totalFrameNumber-1,e.localPosition=a.frame.globalIndex;for(var s=0;s<i.groupList.length;s++)e.groupIDs.push(i.groupList[s].id),e.groupIDsNoMode.push(i.groupList[s].idNoMode),e.frames=e.frames.concat(i.groupList[s].frameList),e.hasModes=e.hasModes?e.hasModes:i.groupList[s].isMode}e.length=e.frames.length,this._computeScopeMinMax(e)}return e.length<=1&&(e.canBePartial=!1),e},getClosestComputedFrameInGroup:function(t){var e,i=this.getGroupForFrame(t);if(i&&i.group&&i.frame){for(var a=i.group,s=i.frame,n=!1;!n&&s.localIndex>=1&&s.localIndex<=a.frameList.length;)if(!(n=!s.isScaledPosition)){var r=s.localIndex;s=r>=0?a.frameList[r]:a.frameList[a.frameList.length-1]}n&&(e=s.globalIndex)}return e},getComputedFramesByGroup:function(){var t,e=this.getAnimationStructure();if(e&&e.groupList.length>0){t=new Map;var i=e.groupList[0],a=i.idNoMode,s=i.computedFrameList;t.set(i.idNoMode,s);for(var n=1;n<e.groupList.length;n++)s=(i=e.groupList[n]).idNoMode===a?s.concat(i.computedFrameList):i.computedFrameList,t.set(i.idNoMode,s),a=i.idNoMode}return t},getFrameGlobalIdxFromPosition:function(t,e){var i,a=this.getLegend();return a&&(i=a.getFrameGlobalIdxFromPosition(t,e)),i},getRetexturingMode:function(t,e){var i="NEUTRAL",a=this.getIsolatedFrames();if((a=void 0===a?[]:a).indexOf(t+1)>-1||this.hasNoGlobalData()&&!this.animationStructure.computedFramesOnlyForDefault)i=e?"REDUCE":"NEUTRAL";else if(this.noFramePosition)i=e?"NEUTRAL":"EXTEND";else{var s=this.getGroupForFrame(t);s&&s.group&&(i=s.group.scaledAnimation&&s.frame.isScaledPosition?e?"NEUTRAL":2===s.group.scalingType?"NEUTRAL":"EXTEND":e?"REDUCE":"NEUTRAL")}return i},isLarge:function(){return this.list3DViews.length>100},resetLoadingStatus:function(){let t=t=>{t&&t.resetLoadingStatus&&t.resetLoadingStatus()};this.list2DViews.forEach(t),this.list3DViews.forEach(t)},getCameraRoot:function(){},getMultiInstanciatedFiles:function(){},getRenderingMaterials:function(){var t=[];this.getNavData3DViewList(!0).forEach(function(e){e&&e.getRenderingMaterial&&t.push(e.getRenderingMaterial())});var e=this._getSortedDuplicates(t);return new Set(e)},removeCharts:function(){Array.isArray(this.listFrameViews)&&this.listFrameViews.forEach(function(t){t.removeCharts()}),this._nbCharts=0},registerImage:function(t){t&&this._listInfoImages.push(t)},getNumberOfCharts:function(){if(isNaN(this._nbCharts)){this._nbCharts=0;var t=this.getNavDataFrameViewList();Array.isArray(t)&&t.forEach(function(t){this._nbCharts+=t.getNbCharts()}.bind(this))}return this._nbCharts},getNumberOfImages:function(){return this._listInfoImages.length},containsImages:function(){return this._listInfoImages.length>0},getInfoImages:function(){return this._listInfoImages},startAnalyticsTimeUpdate:function(t){var e=Date.now();isNaN(this.analytics[t])&&(this.analytics[t]=0),this._analyticsTimeStarts[t]=e},stopAnalyticsTimeUpdate:function(t,e){if(this._analyticsTimeStarts[t]){var i=Date.now()-this._analyticsTimeStarts[t];e?this.analytics[t]+=i:this.analytics[t]=i}},integrateRSCExtractionTime:function(t){this.analytics&&!isNaN(t)&&(isNaN(this.analytics.visuCreationTime)||(this.analytics.visuCreationTime-=t),isNaN(this.analytics.extractionTime)||(this.analytics.extractionTime+=t))}});return t.namespace("DS/SPY/CATSimNavDataDisplayAbstract",n)}),define("DS/SPY/LWResourceLoader",["UWA/Core","UWA/Class"],function(t,e){"use strict";return e.extend({_getFramePostFix:function(t){return isNaN(t)?"":"_frame"+String(t)},_getFrameIdx:function(t){var e=t.split("_frame");return e.length>1?parseInt(e[1]):void 0},init:function(t){this.spm=t.spm,this.useProbe=t.useProbe,this.probesManager=t.probesManager,this.filesToLoad=[],this.framesIndices=[],this.managers=[],this.loadingMap=new Map,this.transactionMap=new Map,this.managerTransactionMap=new Map,this.emptyRscTransactionCounter=0},clearLoadingMap:function(){this.loadingMap.clear()},clean:function(){this.clearLoadingQueue(),this.spm=void 0,this.probesManager=void 0},clearLoadingQueue:function(t){this.filesToLoad=[],this.framesIndices=[],this.managers=[],this.emptyRscTransactionCounter=0,this.managerTransactionMap.clear(),this.transactionMap.clear()},_updateTransactionForManager:function(t,e){if(t){var i=this.managerTransactionMap.get(String(t.id)+this._getFramePostFix(e)),a=this.transactionMap.get(i);a?"loading"===a.loadStatus&&(a.count--,0===a.count&&this._closeTransaction(i)):this._cleaningInterruptedTransaction(t,e)}},_cleaningInterruptedTransaction:function(t,e){},_closeTransaction:function(t){let e=this.transactionMap.get(t);if(e){e.loadStatus="done",e.probe&&e.probe.started&&(e.probe.end(),e.probe.started=!1);let i=Object.assign({},e.analytics),a=e.callbacks;this.transactionMap.delete(t),this.managerTransactionMap.forEach((e,i,a)=>{e===t&&a.delete(i)}),a.forEach(t=>{t&&t(i)})}},onLoaderDoneCallback:function(){var t=0;this.transactionMap.forEach(function(e){t+=e.count});var e=this;t-this.emptyRscTransactionCounter<=0&&(this.transactionMap.forEach(function(t,i){e._closeTransaction(i)}),this.transactionMap.clear(),this.managerTransactionMap.clear(),this.emptyRscTransactionCounter=0,this.window.experience&&(setTimeout(function(){e.filesToLoad.length<=0&&e.eventsManager.publish({event:e.eventContext+"/SPY/PROGRESS/END"})},500),this.window.experience.modelLoadComplete=!0,this.window.experience.modelLoadCount=0,this.window.experience.modelPrevLoadCount=0),this.eventsManager.publish({event:this.eventContext+"/SPY/VISULOADING/FINISHED"}))}})}),define("DS/SPY/CATSimNavDataHelper",["i18n!DS/SPY/assets/nls/CATSimNavDataHelper","UWA/Core","UWA/Class"],function(t,e,i){"use strict";var a=t.get("mode");a=a||"Mode[NONLS]";var s=i.singleton({init:function(){},parseGroupIds:function(t){var e=[];return t&&(e=t.split("?|?")),e},isModeSeparator:function(t){return"_Mode"===t},buildGroupIdNoMode:function(t,e){return e&&!this.isModeSeparator(e)?t+"?|?"+e:t},buildGroupName:function(t){var e="";if(t&&t.length>0){e=t[0];for(var i=1;i<t.length;i++)if(t[i]){var s=t[i];this.isModeSeparator(s)&&(s=a),e+=" - "+s}}return e},buildGroupNameFromIds:function(t){return this.buildGroupName(this.parseGroupIds(t))}});return e.namespace("DS/SPY/CATSimNavDataHelper",s)}),define("DS/SPY/CATSimNavDataChartAxis",["UWA/Core","UWA/Class"],function(t,e){"use strict";var i=e.extend({init:function(t,e){this._dimension=1,this._position="bottom",this._scale="linear",this._fixedBounds=!1,this.readFromXML(t,e)},setId:function(t){isNaN(t)||(this._identifier="_axis_"+t.toString())},getId:function(){return this._identifier},getIdNoPrefix:function(){return parseInt(this._identifier.slice("_axis_".length))},setName:function(t){this._name=t},getName:function(){return this._name},setDimension:function(t){this._dimension=t,2===this._dimension&&"bottom"===this._position&&(this._position="left")},getDimension:function(){return this._dimension},getPosition:function(){return this._position},getScale:function(){return this._scale},setUnit:function(t){this._unit=t},getUnit:function(){return this._unit},hasFixedBounds:function(){return this._fixedBounds},getFixedBounds:function(){return{min:this._fixedMin,max:this._fixedMax}},getColor:function(){return this._color},getTickNb:function(){return this._tickNb},getValueOfInterest:function(){return this._voi},getPrecision:function(){return this._precision},getExponent:function(){return this._exp},readFromXML:function(t,e){if(t){this._name=t.getAttribute("name");var i=parseInt(t.getAttribute("id"));isNaN(i)||(this._identifier="_axis_"+i.toString()),"2"===t.getAttribute("dimension")&&(this._dimension=2,this._position="left");var a=t.getAttribute("position");a&&(1===this._dimension?this._position="top"===a?a:this._position:this._position="right"===a?a:this._position);var s=t.getAttribute("scale");"log"!==s&&"percentage"!==s||(this._scale=s);var n=t.getAttribute("unit");this._unit=n||"";var r=parseFloat(t.getAttribute("fixedMin")),o=parseFloat(t.getAttribute("fixedMax"));isNaN(r)||(this._fixedBounds=!0,this._fixedMin=r),isNaN(o)||(this._fixedBounds=!0,this._fixedMax=o);var l=t.getAttribute("color");l&&(this._color=l);var u=parseInt(t.getAttribute("tickNb"));isNaN(u)||(this._tickNb=u);var h=parseInt(t.getAttribute("precision"));isNaN(h)||(this._precision=h);var c=parseInt(t.getAttribute("exp"));isNaN(c)||(this._exp=c);var d=parseFloat(t.getAttribute("interest"));isNaN(d)||(this._voi=d)}e&&e()}});return t.namespace("DS/SPY/CATSimNavDataChartAxis",i)}),define("DS/SPY/CATSimNavDataSpec",["UWA/Core","UWA/Class","i18n!DS/SPY/assets/nls/CATSimNavTypes"],function(t,e,i){"use strict";var a={},s=e.extend({init:function(t,e){this.dd=e,this.name=t?t.getAttribute("name"):void 0,this.id=t?t.getAttribute("id"):void 0,this.type=this.type?this.type:t?t.getAttribute("type"):void 0,this.subType=t?t.getAttribute("subType"):void 0,this.supportedModes=t?t.getAttribute("supportedModes"):void 0,this.unit=t?t.getAttribute("unit"):void 0,this.defaultMode="ENG",this.visibility=!t||"0"!==t.getAttribute("DefVis"),this.isExtractable=!1,this.suffix=i.get(this.type),this.active=!this.supportedModes||-1!==this.supportedModes.indexOf(this.defaultMode),this.sibling=void 0,this.siblingSearched=!1,this.listLinks=[]},_createExtension:function(t,e,i){if(this.impl){if(!this.impl[t].obj)for(var a in this.impl[t].obj=new e(this),this.impl[t].obj.implementation=this,this.impl)this.impl[a]&&this.impl[a].ext===this.impl[t].ext&&(this.impl[a].obj=this.impl[t].obj);i&&i(this.impl[t].obj)}else i()},QI:function(t,e){if(this.impl[t])if(this.impl[t].obj)this.impl[t].obj.implementation=this,e(this.impl[t].obj);else{var i="DS/"+(this.impl[t].module?this.impl[t].module:"SPY")+"/"+this.impl[t].ext,s=a[i];s?"loaded"===s.status?this._createExtension(t,s.typeClass,e):"requested"===s.status&&s.queue.push(function(i){this._createExtension(t,i,e)}.bind(this)):(a[i]={status:"requested",queue:[]},require([i],function(s){a[i].status="loaded",a[i].typeClass=s,this._createExtension(t,s,e);for(var n=a[i];n.queue&&n.queue.length>0;)n.queue[0]&&(n.queue[0](s),n.queue.shift())}.bind(this)))}else e()},getDataDisplay:function(){return this.dd},getName:function(){return this.name},getId:function(){return this.id?this.id:this.name},getSuffix:function(){return this.suffix},getType:function(){return this.type},getSupportedMode:function(){return this.mode},getSibling:function(){var t=this.supportedModes;if(("ENG"===t||"REA"===t)&&void 0===this.sibling&&!this.siblingSearched&&this.dd&&this.name.length>0){this.siblingSearched=!0;var e,i,a=!1;if("CATSimNavData2DView"===this.type||"CATSimNav2DAnimationView"===this.type)for(i=0;this.dd.list2DViews&&i<this.dd.list2DViews.length&&!a;i++)(e=this.dd.list2DViews[i])&&e.name===this.name&&e!==this&&e.supportedModes!==t&&(this.sibling=e,a=!0);else if("CATSimNavData3DView"===this.type||"CATSimNavData3DAnimationView"===this.type)for(i=0;this.dd.list3DViews&&i<this.dd.list3DViews.length&&!a;i++)(e=this.dd.list3DViews[i])&&e.name===this.name&&e!==this&&e.supportedModes!==t&&(this.sibling=e,a=!0)}return this.sibling},isActive:function(){return this.active},setActive:function(t){this.active=t},getVisibility:function(){return this.visibility},getUnit:function(){return this.unit},getLinks:function(t){return this.listLinks[t]},addLink:function(t,e){var i=this.listLinks[t];void 0===i?this.listLinks[t]=e:i.appendSpec(e)},readFromXML:function(){}});return t.namespace("DS/SPY/CATSimNavDataSpec",s)}),define("DS/SPY/CATSimNavDataLink",[],function(){"use strict";return function(t,e,i){this.dd=e,this._resourcePath="",this.nextSpec=null,this.getNext=function(){return this.nextSpec},this.appendSpec=function(t){null===this.nextSpec?this.nextSpec=t:this.nextSpec.appendSpec(t)},this.getPointedResource=function(){return this._resourcePath},this.setPointedResource=function(t){this._resourcePath=t},this.getPointedData=function(){if(this._pointedDataId&&!this._pointedData)for(var t=0;this.dd.list3DViews&&t<this.dd.list3DViews.length;t++)this.dd.list3DViews[t].getId()===this._pointedDataId&&(this._pointedData=this.dd.list3DViews[t]);return this._pointedData},this.setPointedData=function(t){this._pointedDataId=t,this._pointedData=null},this.getMatrix=function(){return this._matrix},this.readFromXML=function(t,e){if(t){var i,a=t.getAttribute("id"),s=t.getAttribute("name");this.setPointedData(a||s);var n=parseInt(t.getAttribute("srcId"));if(isNaN(n))i=t.getAttribute("src");else i=this.dd.spm.getDataList("src",this.dd.seq).getEntry(n-1).val;this.setPointedResource(i),e&&e(this)}},this.readFromXML(t,i)}}),define("DS/SPY/CATSimNavDataAbstractFactory",["UWA/Core","UWA/Class"],function(t,e){"use strict";var i=e.extend({init:function(){},createSequence:function(){console.error("CATSimNavDataAbstractFactory - abstract createSequence should not be called")},isExtendedMode:function(){return void 0!==this._extensionFilter}});return t.namespace("DS/SPY/CATSimNavDataAbstractFactory",i)}),define("DS/SPY/CATSimNavDataXYValue",function(){"use strict";var t=function(t,e,i){this.index=-1,t&&this.readFromXML(t,e,i)};return t.prototype.getX=function(){return this.X},t.prototype.setX=function(t){this.X=t},t.prototype.getY=function(){return this.Y},t.prototype.setY=function(t){this.Y=t},t.prototype.setIndex=function(t){this.index=t},t.prototype.getIndex=function(){return this.index},t.prototype.getGroupId=function(){return this.groupId},t.prototype.setGroupId=function(t){this.groupId=t},t.prototype.getGroupIdNLS=function(){return this.groupIdNLS},t.prototype.setGroupIdNLS=function(t){this.groupIdNLS=t},t.prototype.getPosition=function(){return this.position},t.prototype.setPosition=function(t){this.position=t},t.prototype.readFromXML=function(t,e,i){var a,s=t.getAttribute("X");s&&s.length>0&&(a=Number(s)),this.setX(a),this.setY(Number(t.getAttribute("Y")));var n=i&&i.group?i.group:t.getAttribute("group");this.setGroupId(n);var r,o=i&&i.groupNLS?i.groupNLS:n;if(this.setGroupIdNLS(o),i&&!isNaN(i.position))r=i.position;else{var l=t.getAttribute("position");l&&l.length>0&&(r=Number(l))}this.setPosition(r),e(this)},t}),define("DS/SPY/CATSimNavData3DAnimationExtremaProvider",["UWA/Core"],function(t){"use strict";var e=t.Class.extend({init:function(){this._parent()},getImpl:function(){return this.implementation},getExtrema:function(t){var e={listMin:[],listMax:[]};if(this.implementation){for(var i,a=this.implementation.dd.getNavData3DViewList("plotContentOnly"),s=0;s<a.length&&!i;s++)"CATSimNavData3DExtremasRoot"===a[s].getType()&&(i=a[s]);if(i){for(var n,r=i.getListExtremasSet(),o=0;o<r.length&&!n;o++){var l=r[o];if(l){var u=l.getLinks("ExtremasToPart");if(u){var h=u.getPointedData();h&&h.getId()===this.implementation.getId()&&(n=l)}}}if(n){var c=n.getExtremas(t);if(c){var d=c.getListExtrema();if(d)for(var m=0;m<d.length;m++){var f=d[m];f&&(f.setComponent(this.implementation),"Min"===f.getExtremaType()?e.listMin.push(f):e.listMax.push(f))}}}}}return e}});return t.namespace("DS/SPY/CATSimNavData3DAnimationExtremaProvider",e)}),define("DS/SPY/SpaceURL",["UWA/Core","UWA/Class"],function(t,e){"use strict";var i=e.extend({init:function(t){this._platformServices=t},getUrl:function(t){t&&t.asset&&t.onComplete&&this._platformServices&&this._platformServices.getPlatformServices({onComplete:function(e){var i,a=e.find(function(e){return e.platformId===t.asset.tenant});a&&(i=a["3DDashboard"]+"/#app:X3DPLAW_AP/content:X3DContentId=",i+=encodeURIComponent(JSON.stringify(t.asset.Play3DXContent)),t.onComplete(i))}})}});return t.namespace("DS/SPY/SpaceURL",i)}),define("DS/SPY/CATSimNavDataList",["UWA/Core","UWA/Class"],function(t,e){"use strict";var i=e.extend({init:function(t){if(t&&"List"===t.nodeName){this._name=t.getAttribute("name"),this._entries=[];for(var e=t.children,i=0;i<e.length;i++){for(var a={},s=e[i].getAttributeNames(),n=0;n<s.length;n++)a[s[n]]=e[i].getAttribute(s[n]);this._entries.push(a)}}},getName:function(){return this._name},getEntry:function(t){return this._entries[t]}});return t.namespace("DS/SPY/CATSimNavDataList",i)}),define("DS/SPY/CATSimNavData2DLegend",["UWA/Core","DS/SPY/CATSimNavDataSpec","DS/CoreEvents/Events","DS/SPY/CATSimNavDataHelper"],function(t,e,i,a){"use strict";let s=e.extend({_parseDataFrame:function(t){this.title=t.getAttribute("title"),this.scaleFactor=parseFloat(t.getAttribute("scaleFactor")),this.inverseState=t.getAttribute("inverseState"),this.min=parseFloat(t.getAttribute("max")),this.max=parseFloat(t.getAttribute("min")),0===this.min&&0===this.max&&(this.noGlobalFlag=!0);var e=parseFloat(t.getAttribute("userMin"));isNaN(e)||(this.userMin=e);var i=parseFloat(t.getAttribute("userMax"));isNaN(i)||(this.userMax=i),this.rangeReadOnly=t.getAttribute("rangeReadOnly"),this.unit=t.getAttribute("unit")},_parseFrameSet:function(t){for(var e=0,i=t.firstChild;null!=i;){if(1===i.nodeType){var a=parseFloat(i.getAttribute("localMin"));isNaN(a)||(this.localMin.push(a),a<=this.min&&(this.min=a));var s=parseFloat(i.getAttribute("localMax"));isNaN(s)||(this.localMax.push(s),s>=this.max&&(this.max=s));var n=-1,r=parseFloat(i.getAttribute("scaleFactor"));isNaN(r)?isNaN(this.scaleFactor)||(n=this.scaleFactor):n=r,this.deformationScales.push(n);var o,l,u,h,c=void 0;if("Frame"===i.nodeName){var d=i.getAttribute("frmId");if(null!==d){var m=this.dd.spm.getFrameDetails(this.dd.seq,d,e);c=m.position,l=m.scaled,u=m.group,h=m.unit}}else u=i.getAttribute("group"),(o=i.getAttribute("position"))&&o.length>0&&(c=Number(o)),l=i.getAttribute("scaled"),h=i.getAttribute("unit"),this.dd.spm.setFrameDetails(this.dd.seq,e,null!==l||void 0!==l,u,c,h);!isNaN(c)&&this.animationStructure.noFramePosition&&(this.animationStructure.noFramePosition=!1);var f,p=null!=l&&""!==l&&"0"!==l;p&&2===(f=parseInt(l))&&(this.hasScanAnimation=!0),this.animRawData.push({id:u,position:c,positionUnit:h,isScaledPosition:p,scalingType:f}),e++}i=i.nextSibling}},init:function(t,e,i,a){this._parent(t,e),this.localMin=[],this.localMax=[],this.deformationScales=[],this.animRawData=[],this.NoResults=e&&"NoResults"===e.plotType,this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavData2DLegendUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavData2DLegendUI",type:"data",obj:null}},this._posDetailsMaps=[],this.readFromXML(t,a),this._eventCtxId=e.getSPM().getContext()},hasMinMax:function(){var t=Array.isArray(this.localMax)&&this.localMax.length>0;return Array.isArray(this.localMin)&&this.localMin.length>0&&t&&!this.NoResults},getPNGList:function(){return this.palette?[this.palette]:[]},readFromXML:function(t,e){this.animationStructure={noFramePosition:!0};for(var i=0;i<t.children.length;i++){var s=t.children[i];switch(s.nodeName){case"DataFrame":this._parseDataFrame(s);break;case"PaletteFrame":this.palette=s.getAttribute("src");break;case"DiscreteValues":this.labels=a.parseGroupIds(s.getAttribute("labels")),this.colors=a.parseGroupIds(s.getAttribute("colors"));break;case"FrameSet":this._parseFrameSet(s)}}!function(t){if(t)for(var e=0;e<t.length;e++){var i=t[e],s=e+1<t.length?t[e+1]:void 0;i.displayName="";var n=a.parseGroupIds(i.id);n.length>0&&(i.rootName=n[0],i.displayName+=i.rootName,n.length>1&&(i.isComplex=!0));for(var r=1;r<n.length;r++){if(a.isModeSeparator(n[r])){var o=r+1<n.length?parseInt(n[r+1]):void 0;i.modeIndex=o,i.isMode=!isNaN(o)&&o>=0;for(var l="Mode "+(void 0!==o?o.toString():"index missing"),u=i.isScaledPosition?s:i,h=1;u&&u.isScaledPosition;)u=e+h<t.length?t[e+h]:void 0,h++;u&&(l=u.position+(u.positionUnit?" "+u.positionUnit:"")),i.displayName+=" - "+l;break}isNaN(parseInt(n[r]))&&(i.loadName=n[r],i.displayName+=" - "+n[r])}}}(this.animRawData),this.animationStructure.groupList=[];for(var n,r,o,l,u,h,c,d=0,m=0,f=0,p=!1,g=!1,S=0,v=0,D=0,N=0,C=0,x=0;x<this.animRawData.length;x++){var A=this.animRawData[x];if(A.id!==n&&(d=0,n=A.id,r=A.displayName,o=A.rootName,l=A.positionUnit,p=A.isComplex,u=A.loadName,h=(g=A.isMode)?A.modeIndex:void 0,S=0,v=0,D=0,c={index:f,id:n,idNoMode:a.buildGroupIdNoMode(o,u),name:r,rootName:o,frameList:[],computedFrameList:[],scaledAnimation:!1,scalingFactor:S,globalStart:m,globalEnd:m,unit:l,isComplex:p,loadCaseName:u,isMode:g,modeIndex:h},this.animationStructure.groupList.push(c),f++),c){d++,m++;var b="",L=A.position,y=A.positionUnit;isNaN(L)?A.isScaledPosition&&(b="scaled",c.scaledAnimation=!0,c.scalingType=A.scalingType,D++):(b=L.toString()+(y?" "+y:""),v++,C++),this.animationStructure.noFramePosition&&(b="frame "+d);var _={name:b,globalIndex:m,localIndex:d,isScaledPosition:A.isScaledPosition,position:L};if(c.frameList.push(_),A.isScaledPosition||c.computedFrameList.push(_),c.globalEnd=m-1,c.scalingFactor=v>0?(v+D)/v:0,c.numberComputedFrames=v,c.scaledAnimation&&c.isMode&&N++,!isNaN(L)){var T=this._posDetailsMaps[c.idNoMode];T||(this._posDetailsMaps[c.idNoMode]=new Map,T=this._posDetailsMaps[c.idNoMode]),T.set(L,x)}}}this.animationStructure.totalFrameNumber=m,N>1&&(this.animationStructure.computedFramesOnlyForDefault=!0,this.animationStructure.totalComputedFramesNumber=C),e()},hasNoGlobalFlag:function(){return this.noGlobalFlag},rangeIsReadOnly:function(){return null!==this.rangeReadOnly&&void 0!==this.rangeReadOnly},setAsReadOnly:function(){this.rangeReadOnly=!0,i.publish({event:this._eventCtxId+"/SPY/LEGEND/EDITABILITY"})},setUserMin:function(t,e,a){if(a=void 0===a||a,void 0!==t&&isNaN(t))return"E_INVALIDARG";if(t!==this.userMin&&!this._inEdition){var s=!isNaN(e)&&e>=0&&e<this.localMax.length;this._inEdition=!0,void 0===t?this.userMin=void 0:isNaN(this.userMax)?this.userMin=s?t<=this.localMax[e]?t:this.localMax[e]:t<=this.max?t:this.max:t>this.userMax?this.userMin=this.userMax:this.userMin=t,i.publish({event:this._eventCtxId+"/SPY/LEGEND/EDIT/USERMIN",data:{value:this.userMin,computed:s?this.localMin[e]:void 0,unit:this.unit,syncFlag:a}}),this._inEdition=!1}return this.userMin},getUserMin:function(){return this.userMin},setUserMax:function(t,e,a){if(a=void 0===a||a,void 0!==t&&isNaN(t))return"E_INVALIDARG";if(t!==this.userMax&&!this._inEdition){var s=!isNaN(e)&&e>=0&&e<this.localMin.length;this._inEdition=!0,void 0===t?this.userMax=void 0:isNaN(this.userMin)?this.userMax=s?t>=this.localMin[e]?t:this.localMin[e]:t>=this.min?t:this.min:t<this.userMin?this.userMax=this.userMin:this.userMax=t,i.publish({event:this._eventCtxId+"/SPY/LEGEND/EDIT/USERMAX",data:{value:this.userMax,computed:s?this.localMax[e]:void 0,unit:this.unit,syncFlag:a}}),this._inEdition=!1}return this.userMax},getUserMax:function(){return this.userMax},getComputedMin:function(t){var e=this.min;return isNaN(t)||(e=t>=0&&t<this.localMin.length?this.localMin[t]:void 0),e},getComputedMax:function(t){var e=this.max;return isNaN(t)||(e=t>=0&&t<this.localMax.length?this.localMax[t]:void 0),e},getMinMaxData:function(t){return{unit:this.unit,userMin:this.getUserMin(),userMax:this.getUserMax(),computedMin:this.getComputedMin(t),computedMax:this.getComputedMax(t)}},integrateMinMaxData:function(t,e){var a,s,n=!isNaN(e)&&e>=0&&e<this.localMin.length?this.localMin[e]:this.min,r=!isNaN(e)&&e>=0&&e<this.localMax.length?this.localMax[e]:this.max,o=isNaN(this.userMin)?n:this.userMin,l=isNaN(this.userMax)?r:this.userMax;t&&t.length>0&&t.forEach(function(t){if(t.unit===this.unit){var e=null===t.userMin||isNaN(t.userMin)?t.computedMin:t.userMin,i=null===t.usermax||isNaN(t.userMax)?t.computedMax:t.userMax;e<o&&(o=a=e),i>l&&(l=s=i)}}.bind(this)),(a=isNaN(a)?o:a)===this.userMin?i.publish({event:this._eventCtxId+"/SPY/LEGEND/EDIT/USERMIN",data:{value:a,unit:this.unit,syncFlag:!0}}):this.setUserMin(a,e,!0),(s=isNaN(s)?l:s)===this.userMax?i.publish({event:this._eventCtxId+"/SPY/LEGEND/EDIT/USERMAX",data:{value:s,unit:this.unit,syncFlag:!0}}):this.setUserMax(s,e,!0)},getFrameGlobalIdxFromPosition:function(t,e){if(null!=t){var i,a=t,s=t.indexOf("?|?_Mode?|?");-1!==s&&(a=t.slice(0,s));var n=this._posDetailsMaps[a];return n&&(i=n.get(e)),i}},isInverted:function(){return"1"===this.inverseState}});return t.namespace("DS/SPY/CATSimNavData2DLegend",s)}),define("DS/SPY/CATSimNavData2DAnimationView",["DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavDataLink"],function(t,e){"use strict";var i=t.extend({init:function(t,e,i,a){this._parent(t,e),this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavData2DAnimationViewUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavData2DAnimationViewUI",type:"data",obj:null}},this.readFromXML(t,a)},getPNGList:function(){return this.getLinks("SP_StaticList")},readFromXML:function(t,i){for(var a=0,s=!1,n=function(t){t&&(this.addLink("SP_StaticList",t),0===--a&&s&&i&&i())}.bind(this),r=0;r<t.children.length;r++){var o=t.children[r];if("1"===o.getAttribute("level"))for(var l=0;l<o.children.length;l++){var u=o.children[l];if(u)for(var h=0;h<u.children.length;h++){var c=u.children[h];a++;new e(c,this.dd,n)}}}s=!0,0===a&&i()}});return UWA.namespace("DS/SPY/CATSimNavData2DAnimationView",i)}),define("DS/SPY/CATSimNavData2DRepStaticView",["DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavDataLink"],function(t,e){"use strict";var i=t.extend({init:function(t,e,i,a){this._parent(t,e),this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavData2DRepStaticViewUI",type:"data",obj:null}},this.readFromXML(t,a)},getPNGList:function(){return this.getLinks("SP_StaticList")},readFromXML:function(t,i){for(var a=0,s=!1,n=function(t){t&&(this.addLink("SP_StaticList",t),0===--a&&s&&i&&i())}.bind(this),r=0;r<t.children.length;r++){var o=t.children[r];if("1"===o.getAttribute("level"))for(var l=0;l<o.children.length;l++){var u=o.children[l];if(u)for(var h=0;h<u.children.length;h++){var c=u.children[h];a++;new e(c,this.dd,n)}}}s=!0,0===a&&i()}});return UWA.namespace("DS/SPY/CATSimNavData2DRepStaticView",i)}),define("DS/SPY/CATSimNavDataFrameViewComp",["DS/SPY/CATSimNavDataSpec"],function(t){"use strict";var e=t.extend({init:function(t,e){this._parent(t,e),this._layoutPrefs={}},getValues:function(){alert("error: call to getValues on CATSimNavDataFrameViewComp")},readFromXML:function(t,e){alert("error: call to readFromXML on CATSimNavDataFrameViewComp")},isComplex:function(){return!1},getLayoutPreferences:function(){return this._layoutPrefs},setExpandPreference:function(t){this._layoutPrefs.expanded=t},setExtractPreference:function(t){this._layoutPrefs.extracted=t},getNbCharts:function(){return isNaN(this._nbCharts)&&this.computeNbCharts(),this._nbCharts},computeNbCharts:function(){this._nbCharts=0}});return UWA.namespace("DS/SPY/CATSimNavDataFrameViewComp",e)}),define("DS/SPY/CATSimNavDataFrameView",["DS/SPY/CATSimNavDataFrameViewComp","DS/SPY/CATSimNavDataLink"],function(t,e){"use strict";var i=Node.ELEMENT_NODE,a=t.extend({init:function(t,e,i,a){this._parent(t,e),this.tempChildren=[],this.children=[],this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavDataFrameViewUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavDataFrameViewUI",type:"data",obj:null},CATISimNavDataColorShading:{module:"SPYUI",ext:"CATSimNavDataFrameViewColorShading",type:"data",obj:null}},this.readFromXML(t,i,function(){this.computeNbCharts(),a&&a(this)}.bind(this))},getChildren:function(){return this.children},computeNbCharts:function(){for(var t in this._nbCharts=0,this.children)this._nbCharts+=this.children[t].getNbCharts()},readFromXML:function(t,a,s){if(t){for(var n=null,r=function(){for(var e=0,i=!1,n=function(t){return function(n){new n(t,this.dd,a,function(a){this.tempChildren[t._spyRank]=a,0===--e&&i&&s&&(this.tempChildren.forEach(function(t){t&&this.children.push(t)}.bind(this)),this.tempChildren=[],s(this))}.bind(this))}.bind(this)}.bind(this),r=!0,o=0,l=0;o<t.children.length;o++){var u=t.children[o],h=null,c=null;switch(u.nodeName){case"DDXYPlot":case"DDXYChart":c="CATSimNavDataFrameViewXYChart",r=!1;break;case"DDScalar":c="CATSimNavDataFrameViewCompValue";break;case"DDText":c="CATSimNavDataFrameViewText";break;case"DDImage":c="CATSimNavDataFrameViewImage";break;case"DDElementFrame":c="CATSimNavDataFrameView",r=!1}c&&(void 0===a||void 0===a.excludedTypes||a.excludedTypes.indexOf(c)<0)&&(h="DS/SPY/"+c,u._spyRank=l++,this._isComplex=!r,e++,require([h],n(u)))}i=!0,0===e&&s(this)}.bind(this),o=0;o<t.childNodes.length;o++){var l=t.childNodes[o];if(l.nodeType===i&&"LinkSet"===l.nodeName&&"Frameto3D"===l.getAttribute("role"))for(var u=0;u<l.childNodes.length&&null===n;u++){var h=l.childNodes[u];h&&h.nodeType===i&&"InternalRef"===h.nodeName&&(n=h)}}if(n)new e(n,this.dd,function(t){this.addLink("Frameto3D",t),r()}.bind(this));else r()}},isComplex:function(){return this._isComplex},removeCharts:function(){Array.isArray(this.children)&&(this.children=this.children.filter(function(t){return"CATSimNavDataFrameViewXYChart"!==t.type}),this.children.forEach(function(t){t.removeCharts&&t.removeCharts()})),this._nbCharts=0}});return UWA.namespace("DS/SPY/CATSimNavDataFrameView",a)}),define("DS/SPY/CATSimNavDataFrameViewImage",["DS/SPY/CATSimNavDataFrameViewComp"],function(t){"use strict";var e=t.extend({init:function(t,e,i,a){e&&e.registerImage(t.getAttribute("src")),this.type="CATSimNavDataFrameViewImage",this._parent(t,e),this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavDataFrameViewImageUI",type:"data",obj:null}},this.isExtractable=!0,this.readFromXML(t,a)},getTitle:function(){return this.name},getTooltip:function(){return this._tooltip},getPNGList:function(){return[this._src]},readFromXML:function(t,e){t&&(this._tooltip=t.getAttribute("tooltip"),this._src=t.getAttribute("src"),e&&e(this))}});return UWA.namespace("DS/SPY/CATSimNavDataFrameViewImage",e)}),define("DS/SPY/CATSimNavData3DView",["UWA/Core","DS/SPY/CATSimNavDataSpec","DS/CoreEvents/Events"],function(t,e,i){"use strict";let a=e.extend({init:function(t,e){this._parent(t,e),this.transparency=t?t.getAttribute("transparency"):void 0,this.transparent=0<this.transparency,this.matRendering=t?t.getAttribute("matRendering"):void 0},getRenderingMaterial:function(){return this.matRendering},switchVisibility:function(t,e){this.visibility=!this.visibility;let a=this.impl.CATISimNavDataSpecUI.obj.node;a&&a.setVisibility(!a.isVisible()),t&&e&&i.publish({event:e+"/SPY/VISIBILITY/CHANGE",data:this});var s=this.getSibling();s&&(s.visibility=this.visibility)}});return t.namespace("DS/SPY/CATSimNavData3DView",a)}),define("DS/SPY/CATSimNavData3DRepStaticView",["UWA/Core","DS/SPY/CATSimNavData3DView","DS/SPY/CATSimNavDataLink"],function(t,e,i){"use strict";var a=e.extend({init:function(t,e,i,a){this._parent(t,e),this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavData3DRepStaticViewUI",type:"data",obj:null},CATISimNavDataColorShading:{module:"SPYUI",ext:"CATSimNavData3DStaticColorShading",type:"data",obj:null},CATISimNavDataExtremaProvider:{module:"SPY",ext:"CATSimNavData3DAnimationExtremaProvider",type:"data",obj:null}},this.readFromXML(t,a)},getGeometryFrameSet:function(){return this.getLinks("SP_StaticList")},getGeometryFiles:function(){let t=this.getGeometryFrameSet(),e=[];for(;t;)e.push(t.getPointedResource()),t=t.getNext();return e},readFromXML:function(t,e){for(var a=0,s=!1,n=function(t){t&&(this.addLink("SP_StaticList",t),0===--a&&s&&e&&e())}.bind(this),r=0;r<t.children.length;r++){var o=t.children[r];if("1"===o.getAttribute("level"))for(var l=0;l<o.children.length;l++){var u=o.children[l];if(u)for(var h=0;h<u.children.length;h++){var c=u.children[h];a++;new i(c,this.dd,n)}}}s=!0,0===a&&e()}});return t.namespace("DS/SPY/CATSimNavData3DRepStaticView",a)}),define("DS/SPY/CATSimNavData3DAnimationView",["UWA/Core","DS/SPY/CATSimNavData3DView","DS/Visualization/ThreeJS_DS"],function(t,e,i){"use strict";const a=/[^;\[\]]+;[^;\[\]]+;[^;\[\]]+/g;let s=function(t){let e,a=t.split(";");if(3===a.length){let t=parseFloat(a[0]),s=parseFloat(a[1]),n=parseFloat(a[2]);isNaN(t)||isNaN(s)||isNaN(n)||(e=new i.Vector3(t,s,n))}return e},n=function(t){let e,n=void 0,r=[];for(;null!==(e=a.exec(t));)r.push(e[0]);if(4===r.length){let t=s(r[0]),e=s(r[1]),a=s(r[2]),o=s(r[3]);(n=new i.Matrix4).set(t.x,e.x,a.x,o.x,t.y,e.y,a.y,o.y,t.z,e.z,a.z,o.z,0,0,0,1)}return n};class r{constructor(...t){this.files=[],this.status=[]}getPointedResource(t){let e;return t>=0&&t<this.files.length&&(e=this.files[t]),e}getSize(){return this.files.length}}class o extends r{constructor(...t){super(...t),this.matrices=[]}getMatrix(t){let e=null;return t>=0&&t<this.matrices.length&&(e=this.matrices[t]),e}}let l=e.extend({init:function(t,e,i,a){this._parent(t,e),this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavData3DAnimationViewUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavData3DAnimationViewUI",type:"data",obj:null},CATISimNavDataExtremaProvider:{module:"SPY",ext:"CATSimNavData3DAnimationExtremaProvider",type:"data",obj:null}},this._frameSetConstructionMap={Geometry:{fsConstructor:o,fsProperty:"_geometryFrameSet",fsFlag:"hasAGeometryFrameSet"},Texture:{fsConstructor:r,fsProperty:"_texturesFrameSet",fsFlag:"hasATextureFrameSet"},Instancing:{fsConstructor:r,fsProperty:"_instancingFrameSet",fsFlag:"hasAnInstancingFrameSet"}},this._frameSetConstructionMap.animation=this._frameSetConstructionMap.Geometry,this.readFromXML(t,function(){a&&a(this)}.bind(this))},_frameSetFactory:function(t,e,i){let a=this._frameSetConstructionMap[t];if(a&&e&&!this[a.fsProperty]){this[a.fsProperty]=new a.fsConstructor;let t=this[a.fsProperty];this[a.fsFlag]=!0;for(let a=0;a<e.children.length;a++){let s,r=e.children[a],o=parseInt(r.getAttribute("srcId"));if(!isNaN(o)&&i){s=i.getEntry(o-1).val}else s=r.getAttribute("src");t.files.push(s),t.status.push("notLoaded");let l=r.getAttribute("matrix");if(l){if(l===this._lastMxStr&&this._lastMx)t.matrices.push(this._lastMx);else{let e=n(l);t.matrices.push(e),this._lastMx=e}this._lastMxStr=l}}}},readFromXML:function(t,e){let i=this.dd.spm.getDataList("src",this.dd.seq);for(let e=0;e<t.children.length;e++){let a=t.children[e];if("1"===a.getAttribute("level"))for(let t=0;t<a.children.length;t++){let e=a.children[t],s=e?e.getAttribute("type"):void 0;this._frameSetFactory(s,e,i)}}e(this)},getLoadingDescription:function(t,e){let i={};for(let a in this._frameSetConstructionMap)if(!e||e===a){let e=this[this._frameSetConstructionMap[a].fsProperty];e&&(i[a]={status:e.status[t],file:e.files[t],matrix:e.matrices?e.matrices[t]:void 0})}return e?i[e]:i},getAllLoadingDescription:function(t){let e={};for(let i in this._frameSetConstructionMap)t&&t!==i||(e[i]=this[this._frameSetConstructionMap[i].fsProperty]);return t?e[t]:e},setLoadingStatus:function(t,e,i){let a=i=>{let a=i&&i.fsProperty&&this[i.fsProperty]?this[i.fsProperty].status:void 0;Array.isArray(a)&&(a.length>1?t>=0&&t<a.length&&(a[t]=e):a[0]=e)};if(i){a(this._frameSetConstructionMap[i])}else for(let t in this._frameSetConstructionMap){a(this._frameSetConstructionMap[t])}},resetLoadingStatus:function(t){for(let e in this._frameSetConstructionMap)if(!t||t===e){let t=this._frameSetConstructionMap[e],i=t&&t.fsProperty&&this[t.fsProperty]?this[t.fsProperty].status:void 0;Array.isArray(i)&&i.forEach((t,e)=>{i[e]="notLoaded"})}},getGeometryFrameSet:function(){return this[this._frameSetConstructionMap.Geometry.fsProperty]},getGeometryFiles:function(){let t=this.getGeometryFrameSet();return t?t.files:[]},getTextureFrameSet:function(){return this[this._frameSetConstructionMap.Texture.fsProperty]},getTextureFiles:function(){let t=this.getTextureFrameSet();return t?t.files:[]}});return t.namespace("DS/SPY/CATSimNavData3DAnimationView",l)}),define("DS/SPY/CATSimNavData3DVirtualComponent",["DS/SPY/CATSimNavData3DAnimationView"],function(t){"use strict";var e=t.extend({init:function(t,e,i,a){this._isVirtual=!0,this._parent(t,e,i,function(t){t.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavData3DVirtualComponentUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavData3DVirtualComponentUI",type:"data",obj:null}},a&&a(t)})}});return UWA.namespace("DS/SPY/CATSimNavData3DVirtualComponent",e)}),define("DS/SPY/CATSimNavData3DElementView",["DS/SPY/CATSimNavData3DAnimationView"],function(t){"use strict";return t.extend({init:function(t,e,i,a){this._parent(t,e,i,a),this.type="CATSimNavData3DAnimationView",this.suffix="CATSimNavData3DAnimationView"}})}),define("DS/SPY/LWInstancingLoader",["DS/SPY/LWResourceLoader","DS/Visualization/ThreeJS_DS"],function(t,e){"use strict";return t.extend({init:function(t){this._parent(t),this.window=t.window,this.eventsManager=t.eventsManager,this.eventContext=t.eventContext,this.progress={loaded:0,total:0},this.previousProgressPosition=0},clearLoadingQueue:function(t){this.progress.loaded=0,this.progress.total=0,this.window&&this.window.experience&&(t||this.window.experience.progress.updateProgression(0)),this._parent(t)},loadFiles:function(t){if(t&&t.filesList&&(t.manager||t.managers&&!isNaN(t.frameIndex))&&!isNaN(t.sequence)&&t.callback){if(0===t.filesList.length)return void t.callback();var e,i=this.filesToLoad.length>0;if(this.filesToLoad=this.filesToLoad.concat(t.filesList),!t.framesIndices)for(t.framesIndices=[],e=0;e<t.filesList.length;e++)t.framesIndices.push(t.frameIndex);if(t.framesIndices&&t.framesIndices.length!==t.filesList.length&&console.error("SimulationPlayerModel - inconsistencies between files and frames indices to load"),this.framesIndices=this.framesIndices.concat(t.framesIndices),!t.managers)for(t.managers=[],e=0;e<t.filesList.length;e++)t.managers.push(t.manager);this.managers=this.managers.concat(t.managers),t.managers&&t.managers.length!==t.filesList.length&&console.error("SimulationPlayerModel - inconsistencies between files and managers list");var a=t.managers[0].id,s=this._getFramePostFix(t.framesIndices[0]),n=String(a)+s;if(!this.transactionMap.get(n)){var r={count:0,loadStatus:"loading",callbacks:[]};if(this.useProbe){var o=t.filesList.length>1?t.filesList.length.toString()+"_cgrs":t.filesList[0];r.probe=this.probesManager.createProbe("SPY.SPM.LOADFILES."+n+"_"+o)}r.sequence=t.sequence,r.count+=t.filesList.length,r.callbacks.push(t.callback),this.transactionMap.set(n,r),t.managers&&(e=0,t.managers.forEach(function(t){this.managerTransactionMap.set(String(t.id)+s,n)}.bind(this))),i?this.progress.total+=t.filesList.length:(this.progress.loaded=0,this.progress.total=t.filesList.length,this.window.experience&&(this.eventsManager.publish({event:this.eventContext+"/SPY/PROGRESS/INIT",data:{fromPreviousValue:!t.resetProgress}}),this.window.experience.modelLoadComplete=!1,this.window.experience.modelLoadCount=0,this.window.experience.modelPrevLoadCount=0))}}},_loadRequest:function(t,e,i){var a=this.managerTransactionMap.get(String(t.id)+this._getFramePostFix(e));if(a){var s=this.transactionMap.get(a),n=s.sequence;if(i){if(!isNaN(n)){s.probe&&(s.probe.begin(),s.probe.started=!0);var r=this.spm.sequences[n].zip.find(i);if(r){r.getBlob("text/plain",function(i){var a={positions:[],directions:[],scales:[],values:[],rotations:[],bidirectional:[],is3d:[],nInstances:0},s=new FileReader;s.addEventListener("loadend",function(){const i=new DataView(s.result);var n=0,r=i.getUint8(n);n+=2;var o=0!==r;i.getUint16(n,o);n+=2;i.getUint32(n,o);n+=4;var l=i.getUint32(n,o);for(a.nInstances=l,n+=4;n<i.byteLength;){var u=i.getUint32(n,o);n+=4;var h=i.getUint32(n,o);n+=4;var c=new Float32Array(i.buffer.slice(n,n+h));switch(n+=h,u){case 1:a.positions=c;break;case 2:a.directions=c;break;case 4:a.scales=c;break;case 8:a.values=c;break;case 16:a.rotations=c;break;case 32:a.bidirectional=c;break;case 64:a.is3d=c;break;default:continue}}this.onBufferLoadedCallback(a,t,e)}.bind(this)),s.readAsArrayBuffer(i)}.bind(this))}}}else"loading"===s.loadStatus&&(s.count--,0===s.count&&this._closeTransaction(a)),this.processLoadFiles(),0===this.filesToLoad.length&&this.onLoaderDoneCallback()}},processLoadFiles:function(){for(;this.filesToLoad.length>0;)this._loadRequest(this.managers.shift(),this.framesIndices.shift(),this.filesToLoad.shift())},initLoadingMap:function(){this.clearLoadingMap()},addToLoadingMap:function(){},onBufferLoadedCallback:function(t,i,a){if(t&&i&&null!=a){for(var s=[],n=[],r=[],o=[],l=[],u=[],h=[],c=0;c<t.positions.length;c+=3)s.push(new e.Vector3(t.positions[c],t.positions[c+1],t.positions[c+2])),n.push(new e.Vector3(t.directions[c],t.directions[c+1],t.directions[c+2]));for(c=0;c<t.scales.length;c++)r.push(t.scales[c]),o.push(t.values[c]),u.push(t.bidirectional[c]),h.push(t.is3d[c]);for(c=0;c<t.rotations.length;c+=2)l.push(new e.Vector2(t.rotations[c],t.rotations[c+1]));i.setBuffers(a,t.nInstances,s,n,r,o,l,u,h)}else this.emptyRscTransactionCounter++;this._updateTransactionForManager(i,a),this.window.experience,this.processLoadFiles()}})}),define("DS/SPY/LWTextureLoader",["DS/SPY/LWResourceLoader","DS/Visualization/ThreeJS_DS"],function(t,e){"use strict";let i=new e.Color;return t.extend({init:function(t){this._parent(t),this.window=t.window,this.eventsManager=t.eventsManager,this.eventContext=t.eventContext,this.progress={loaded:0,total:0},this.previousProgressPosition=0,this._canvas=document.createElement("canvas"),this._context2d=this._canvas.getContext("2d",{willReadFrequently:!0}),this._textureDataMap=new Map},clearLoadingQueue:function(t){this.progress.loaded=0,this.progress.total=0,this.window&&this.window.experience&&(t||this.window.experience.progress.updateProgression(0)),this._parent(t)},loadFiles:function(t){if(t&&t.filesList&&(t.manager||t.managers&&!isNaN(t.frameIndex))&&!isNaN(t.sequence)&&t.callback){if(0===t.filesList.length)return void t.callback();let i=this.filesToLoad.length>0;var e;if(this.filesToLoad=this.filesToLoad.concat(t.filesList),!t.framesIndices)for(t.framesIndices=[],e=0;e<t.filesList.length;e++)t.framesIndices.push(t.frameIndex);if(t.framesIndices&&t.framesIndices.length!==t.filesList.length&&console.error("SimulationPlayerModel - inconsistencies between files and frames indices to load"),this.framesIndices=this.framesIndices.concat(t.framesIndices),!t.managers)for(t.managers=[],e=0;e<t.filesList.length;e++)t.managers.push(t.manager);this.managers=this.managers.concat(t.managers),t.managers&&t.managers.length!==t.filesList.length&&console.error("SimulationPlayerModel - inconsistencies between files and managers list");let a=t.managers[0].id,s=this._getFramePostFix(t.framesIndices[0]),n=String(a)+s;if(!this.transactionMap.get(n)){let a={count:0,loadStatus:"loading",callbacks:[],analytics:{maxRscExtractionTime:0}};if(this.useProbe){let e=t.filesList.length>1?t.filesList.length.toString()+"_textures":t.filesList[0];a.probe=this.probesManager.createProbe("SPY.SPM.LOADFILES."+n+"_"+e)}a.sequence=t.sequence,a.count+=t.filesList.length,a.callbacks.push(t.callback),this.transactionMap.set(n,a),t.managers&&(e=0,t.managers.forEach(function(t){this.managerTransactionMap.set(String(t.id)+s,n)}.bind(this))),i?this.progress.total+=t.filesList.length:(this.progress.loaded=0,this.progress.total=t.filesList.length,this.window.experience&&(this.eventsManager.publish({event:this.eventContext+"/SPY/PROGRESS/INIT",data:{fromPreviousValue:!t.resetProgress}}),this.window.experience.modelLoadComplete=!1,this.window.experience.modelLoadCount=0,this.window.experience.modelPrevLoadCount=0))}}},onTextureLoadedCallback:function(t,e,i){t&&e&&i?e.setTexture(i,t):this.emptyRscTransactionCounter++,this._updateTransactionForManager(e,i),this.window.experience,this.processLoadFiles()},_loadRequest:function(t,i,a){var s=this.managerTransactionMap.get(String(t.id)+this._getFramePostFix(i));if(s){var n=this.transactionMap.get(s),r=n.sequence;if(a){if(!isNaN(r)){n.probe&&(n.probe.begin(),n.probe.started=!0);var o=this.spm.sequences[r].zip.find(a);if(o){let a=Date.now();o.getData64URI("image/png").then(s=>{let r=Date.now()-a;r>n.analytics.maxRscExtractionTime&&(n.analytics.maxRscExtractionTime=r);let o=s,l=new e.Texture,u=new Image;u.onload=(()=>{l.image=u,l.needsUpdate=!0,this._canvas.width=l.image.width,this._canvas.height=l.image.height,this._context2d.drawImage(l.image,0,0);const e=this._context2d.getImageData(0,0,this._canvas.width,this._canvas.height),a=`${t.getId()}_${i}`;this._textureDataMap.set(a,e),this.onTextureLoadedCallback(l,t,i)}),u.src=o})}}}else"loading"===n.loadStatus&&(n.count--,0===n.count&&this._closeTransaction(s)),this.processLoadFiles(),0===this.filesToLoad.length&&this.onLoaderDoneCallback()}},processLoadFiles:function(){for(;this.filesToLoad.length>0;)this._loadRequest(this.managers.shift(),this.framesIndices.shift(),this.filesToLoad.shift())},initLoadingMap:function(){this.clearLoadingMap()},addToLoadingMap:function(){},clearLoadingMap:function(){this._parent(),this._textureDataMap.clear()},_getTextureData:function(t,e){if(t===this._lastElemId&&e===this._lastFrameIdx&&this._lastTexData)return this._lastTexData;let i=this._textureDataMap.get(`${t}_${e}`);return i&&(this._lastTexData=i,this._lastFrameIdx=e,this._lastElemId=t),i},_getColorFromTextureAt:function(t){let e=null,i=this._getTextureData(t.elemId,t.frameIdx);return i&&(e=((t,e,i,a,s)=>{const n=Math.round(a*(e-1)),r=4*((i-Math.round(s*(i-1)))*e+n),o=t.data;return{r:o[r],g:o[r+1],b:o[r+2],a:o[r+3]}})(i,this._canvas.width,this._canvas.height,t.u,t.v)),e},_getHueFromColor:function(t){return i.setRGB(t.r/255,t.g/255,t.b/255),i.getHSL().h},getValueFromPickingInfo:function(t){let e,i=this._getColorFromTextureAt({elemId:t.element.SPObj.getId(),frameIdx:t.frameIdx,u:t.u,v:t.v});if(i)if(0===i.r&&0===i.g&&0===i.b)console.warn(` rgb at 0 - incorrect uv? u:${t.u} v:${t.v}`);else{let t=this._getHueFromColor(i);e=this._hueScale*(t-this._minHue)+this._valShift}return e},setRangeColors:function(t){this._minHue=t.minHue,this._minValue=t.minValue,this._maxHue=t.maxHue,this._maxValue=t.maxValue;let e=this._maxValue-this._minValue,i=this._maxHue-this._minHue;this._hueScale=e/i,this._valShift=this._minValue}})}),define("DS/SPY/CATSimNavDataDisplay",["UWA/Core","DS/SPY/CATSimNavDataDisplayAbstract","DS/SPY/CATSimNavDataHelper"],function(t,e,i){"use strict";var a={},s=e.extend({init:function(t,e,i,a,s){this._parent(t,e,i),this._constructionMap={DDElement2D:{itemList:this.list2DViews},DDElement3D:{itemList:this.list3DViews},DDElementFrame:{itemList:this.listFrameViews}},this.readFromXML(t,a,s)},_internalRead:function(t,e,i){var s=function(t){i&&i.noFrameViewSimplification||t.simplifyFrameViewList(),e&&e(t)},n=function(t){var e=!1;return i&&i.excludedTypes&&(e=i.excludedTypes.indexOf(t)>=0),e},r=function(t,e){var a=!1;if(i&&i.types){var s=i.types[t];a=s&&!isNaN(s.maxNb)&&e.nbInst>s.maxNb}return a},o={counter:0,loopCompleted:!1},l=this,u=function(){o.counter--,0===o.counter&&o.loopCompleted&&s(l)},h=function(t,e,a){return function(s){var n=new s(t,e,i,u);a.push(n)}};let c=this._constructionMap,d=function(){for(let s=0;s<t.children.length;s++){let p=t.children[s],g=c[p.nodeName];if(g){let t="DDElementFrame"===p.nodeName?"CATSimNavDataFrameView":p.getAttribute("type"),s=a[t];s&&(s.excluded||r(t,s)||(o.counter++,s.nbInst++,"loaded"===s.status?(e=p,n=s.typeClass,d=l,m=g.itemList,f=void 0,f=new n(e,d,i,u),m.push(f)):"requested"===s.status&&s.queue&&s.queue.push(h(p,l,g.itemList))))}}var e,n,d,m,f;o.loopCompleted=!0,0===o.counter&&s(l)};for(var m={counter:0,loopCompleted:!1},f=function(t){return function(e){var i=a[t];if(i)for(i.status="loaded",i.typeClass=e;i.queue.length>0;)i.queue[0]&&(i.queue[0](e),i.queue.shift());m.counter--,0===m.counter&&m.loopCompleted&&d()}},p=0;p<t.children.length;p++){let e=t.children[p];if(c[e.nodeName]){let t="DDElementFrame"===e.nodeName?"CATSimNavDataFrameView":e.getAttribute("type"),i=a[t],s=n(t);i?s&&(a[t].excluded=!0):s||(m.counter++,a[t]={status:"requested",queue:[],nbInst:0},require(["DS/SPY/"+t],f(t)))}}m.loopCompleted=!0,0===m.counter&&d()},readFromXML:function(t,e,a){if("DataDisplay"===t.nodeName){this.id=t.getAttribute("id"),this.name=t.getAttribute("name");var s=i.parseGroupIds(this.name);s.length>1&&(this.name=s[0],this.subName=s[1]),this.type=t.getAttribute("type"),this.plotType=t.getAttribute("plotType"),this.category=t.getAttribute("category"),this.thumbnail=t.getAttribute("thumbnail"),this.isShared="Shared"===this.type,this._internalRead(t,e,a)}},extendFromXML:function(t,e,i){"DataDisplay"===t.nodeName&&this.id===t.getAttribute("id")&&this.name===t.getAttribute("name")&&(this.listFrameViews=[],this._constructionMap={DDElementFrame:{itemList:this.listFrameViews}},this._internalRead(t,e,i))},getMultiInstanciatedFiles:function(){var t=[];this.getNavData3DViewList(!0).forEach(function(e){e&&e.getGeometryFiles&&(t=t.concat(e.getGeometryFiles()))});var e=this._getSortedDuplicates(t);return new Set(e)},getCameraRoot:function(){var t,e=this.getNavData3DViewList();if(e&&e.length)for(var i=0;i<e.length&&!t;i++){var a=e[i];"CATSimNavData3DCamerasRoot"===a.type&&(t=a)}return t}});return t.namespace("DS/SPY/CATSimNavDataDisplay",s)}),define("DS/SPY/CATSimNavDataLWFactory",["UWA/Core","DS/SPY/CATSimNavDataAbstractFactory","DS/WebUtils/ProbesManager","DS/CoreEvents/Events","DS/ZipJS2/ZipJS2","DS/SPY/CATSimNavDataList","DS/SPY/CATSimNavDataDisplay"],function(t,e,i,a,s,n,r){"use strict";s.configure({maxWorkers:4,terminateWorkerTimeout:NaN});var o=function(t,e){var i;if(t&&e){var a=e.getAttribute("id"),s=function(t){return a&&a===t.id};Array.isArray(t.listDD)&&(i=t.listDD.find(s)),!i&&Array.isArray(t.listDDShared)&&(i=t.listDDShared.find(s))}return i},l=e.extend({init:function(){this._parent()},createSequence:function(t,e){var n,r=Date.now(),o=i.createProbe("SPY.LWFactory.OPENZIP");o.begin(),t.shareZipEntries=void 0!==t.shareZipEntries&&t.shareZipEntries;var l=function(){if(o.end(),n){var l=i.createProbe("SPY.LWFactory.EXTRACTXML");l.begin();var u=n.find("SimNavData.xml");u&&u.getText().then(function(i){if(l.end(),"string"==typeof i&&i.length>0&&i.search("<")>=0){var o,u=(new DOMParser).parseFromString(i,"text/xml").firstChild;if(this.isExtendedMode()&&(d=t.spm,m=function(t){var e;if("SimDDTree"===t.nodeName)for(var i=0;i<t.childNodes.length;i++){var a=t.childNodes[i];"Scenario"===a.nodeName&&(e=a.getAttribute("name"))}return e}(u),d&&Array.isArray(d.sequences)&&m&&(f=d.sequences.find(function(t){return t&&t.name&&t.name.length>0&&t.name===m})),o=f),!o){var h=t.spm.sequences.length;o={persistentId:t.src&&t.src.persistentId?t.src.persistentId:"",idx:t.src?isNaN(t.src.index)?h:t.src.index:h,name:"sequence",listDD:[],listDDShared:[],zip:t.zipEntries?t.shareZipEntries?n:new s.fs.FS:n},t.src&&t.src.analytics&&(o.analytics={dataSize:t.src.analytics.dataSize,streamingTime:t.src.analytics.streamingTime,extractionTime:Date.now()-r}),t.spm.sequences[o.idx]=o}var c=Date.now();this.parseXML(u,o,t.spm,function(i,s){var n={spm:t.spm,seqIdx:o.idx,seqName:o.name,seqId:o.persistentId,filteredDDNb:s,annotations:t.annotations,state:t.state};o.analytics&&(o.analytics.dataModelCreationTime=Date.now()-c),e&&e.onComplete?e.onComplete(n):a.publish({event:t.spm.getContext()+"/SPY/SEQUENCE/CREATED",data:n})},function(i){t.spm._dataLists[o.idx]=void 0,t.spm.sequences[o.idx]=void 0;var s={spm:t.spm,seqIdx:o.idx,errorCode:i,analytics:t.src?t.src.analytics:void 0};e&&e.onError?e.onError(s):a.publish({event:t.spm.getContext()+"/SPY/SEQUENCE/ERROR",data:s})})}else{i={spm:t.spm};e&&e.onError?e.onError(i):a.publish({event:t.spm.getContext()+"/SPY/SEQUENCE/ERROR",data:i})}var d,m,f}.bind(this))}}.bind(this),u=function(){o.end(),alert("failed to open zip")};if(t)if(t.zipEntries&&t.spm)n=t.zipEntries,l();else if(t.src&&t.spm)switch(n=new s.fs.FS,t.src.provider){case"BLOB":n.importBlob(t.src.blob,{directAccess:!0}).then(l,u);break;case"BUFFER":var h=new Blob([new DataView(t.src.buffer)],{type:"application/zip"});n.importBlob(h).then(l,u);break;default:n.importHttpContent(t.src,{useXHR:!1,preventHeadRequest:!0}).then(l,u)}},parseXML:function(t,e,a,s,l,u,h){if("SimDDTree"===t.nodeName){var c=i.createProbe("SPY.LWFactory.PARSEXML");c.begin(),this._extensionFilter&&(u=this._extensionFilter);let F=(t,e,i)=>{let a;return h&&h.targetDocument&&(a=h.targetDocument.importNode(t,e))&&(e&&Array.isArray(h.excludedTags)&&h.excludedTags.forEach(t=>{let e=a.getElementsByTagName(t);for(;e.length>0;)e[0].remove()}),i?i.appendChild(a):h.targetDocument.getRootNode().appendChild(a)),a};var d=F(t,!1),m=0,f=!1,p=!1,g=t.getAttribute("name");a.simulationName=g&&g.length>0?g:a.simulationName,a.disclaimer=t.getAttribute("disclaimer"),a.logo=t.getAttribute("logo"),a._isYaxisUp="true"===t.getAttribute("yAxisUp");for(var S,v=[],D=0,N=function(){for(var t=e.listDD.length-1;t>=0;)e.listDD[t].isEmpty()&&(e.listDD.splice(t,1),D++),t--},C=function(t){if(t&&t.analytics){var i=t.analytics;i.dataModelCreationTime=Date.now()-S,i.numberOfFrames=t.getTotalNumberOfFrames(),i.extractionTime=0}0===--m&&f&&(e.listDD=v.concat(e.listDD),N(),c.end(),e.listDD.length>0?s(a,D):l("FILTEREDCONTENT"))},x=0;x<t.childNodes.length;x++){var A=t.childNodes[x];if("Scenario"===A.nodeName&&(a.dataLevel=parseInt(A.getAttribute("level")),!(a.level<a.dataLevel))){var b=F(A,!1,d);e.name=A.getAttribute("name");for(var L=0;L<A.children.length;L++){var y=A.children[L];if("List"===y.nodeName){if(!a.getDataList(y.getAttribute("name"),e.idx)){var _=new n(y);a.addDataList(_,e.idx)}F(y,!0,b)}else if("DataDisplay"===y.nodeName){var T=!1,M="Shared"===y.getAttribute("type");if(u&&(u.specificContent?T=u.specificContent!==y.getAttribute("id"):Array.isArray(u.categories)&&(T=u.categories.indexOf(y.getAttribute("category"))<0)),M||!T){m++,p=!0;var P=o(e,y);P?P.extendFromXML(y,C,u):(S=Date.now(),P=new r(y,a,e.idx,C,u),M?e.listDDShared.push(P):v.push(P));var I=F(y,!0,b);I&&u.specificContent&&!T&&(a.importedSpecificContent=I)}}}}}f=!0,p?0===m&&(e.listDD=v.concat(e.listDD),N(),c.end(),e.listDD.length>0?s(a,D):l("FILTEREDCONTENT")):(c.end(),l("INVALIDDATA"))}else l()},setExtendedMode:function(t){this._extensionFilter=t?{types:{CATSimNavData3DCamerasRoot:{maxChildrenNb:1,disableTracking:!0}}}:void 0}});return t.namespace("DS/SPY/CATSimNavDataLWFactory",l)}),define("DS/SPY/CATSimNavDataLWPreviewFactory",["UWA/Core","DS/SPY/CATSimNavDataLWFactory"],function(t,e){"use strict";var i=e.extend({init:function(){this._parent()},parseXML:function(t,e,i,a,s){this._parent(t,e,i,a,s,{categories:["Result"],excludedTypes:["CATSimNavDataFrameView"],types:{CATSimNavData3DCamerasRoot:{maxChildrenNb:1,disableTracking:!0}}})}});return t.namespace("DS/SPY/CATSimNavDataLWPreviewFactory",i)}),define("DS/SPY/CATSimNavData3DSimFactory",["UWA/Core","DS/SPY/CATSimNavDataLWFactory","DS/ZipJS2/ZipJS2"],function(t,e,i){"use strict";var a=e.extend({init:function(){this._parent()},createSequence:function(t){var e,a=this._parent.bind(this),s=function(){if(e){var i=e.find("SimulationExperienceContent.simxml");if(i){i.getBlob("application/zip").then(function(i){t.src.provider="BLOB",t.src.blob=i,t.src.filename=void 0;var s=function(){var i=e.find("SimulationExperienceState.json");i?i.getText().then(function(e){"string"==typeof e&&e.length>0&&(t.state=e),a(t)}):a(t)},n=e.find("annotations.json");n?n.getText().then(function(e){"string"==typeof e&&e.length>0&&(t.annotations=e),s()}):s()})}}},n=function(){alert("failed to open 3dsim zip")};t&&t.src&&t.spm&&(e=new i.fs.FS,"BLOB"===t.src.provider?e.importBlob(t.src.blob,{directAccess:!0}).then(s,n):e.importHttpContent(t.src,{useXHR:!1,preventHeadRequest:!0}).then(s,n))},parseXML:function(t,e,i,a,s,n){"SimDDTree"===t.nodeName&&(i.originURL=t.getAttribute("originURL")),this._parent(t,e,i,a,s,n)}});return t.namespace("DS/SPY/CATSimNavData3DSimFactory",a)}),define("DS/SPY/CATSimNavDataMediaFactory",["UWA/Core","DS/SPY/CATSimNavDataLWFactory"],function(t,e){"use strict";let i=e.extend({init:function(t){this._selectedDDId=t?t.ddId:void 0,this._parent()},parseXML:function(t,e,i,a,s){let n={specificContent:this._selectedDDId,excludedTypes:["CATSimNavDataFrameViewXYChart","CATSimNavData3DVirtualComponent"],types:{CATSimNavData3DCamerasRoot:{maxChildrenNb:1,disableTracking:!0}}};i.importedDom=document.implementation.createDocument("","",null);let r={targetDocument:i.importedDom,excludedTags:["DDXYPlot","DDXYChart"]};this._parent(t,e,i,a,s,n,r)}});return t.namespace("DS/SPY/CATSimNavDataMediaFactory",i)}),define("DS/SPY/CATSimNavDataLWBasicFactory",["UWA/Core","DS/SPY/CATSimNavDataLWFactory"],function(t,e){"use strict";var i=e.extend({init:function(){this._parent()},parseXML:function(t,e,i,a,s){this._parent(t,e,i,a,s,{categories:["Result"],excludedTypes:["CATSimNavDataFrameViewXYChart"],types:{CATSimNavData3DCamerasRoot:{maxChildrenNb:1,disableTracking:!0}}})}});return t.namespace("DS/SPY/CATSimNavDataLWBasicFactory",i)}),define("DS/SPY/CATSimNavDataLWSensorsFactory",["UWA/Core","DS/SPY/CATSimNavDataLWFactory"],function(t,e){"use strict";var i=e.extend({init:function(){this._parent()},parseXML:function(t,e,i,a,s){this._parent(t,e,i,a,s,{categories:["Result"],info:!0,noFrameViewSimplification:!0,types:["CATSimNavData3DAnimationView","CATSimNavData3DCamerasRoot","CATSimNavData2DLegend"]})}});return t.namespace("DS/SPY/CATSimNavDataLWSensorsFactory",i)}),define("DS/SPY/CATSimNavDataXYCurve",["DS/SPY/CATSimNavDataXYValue","DS/SPY/CATSimNavDataHelper"],function(t,e){"use strict";var i=function(t,e,i,a){this.listValues=[],this.listGroups=[],this.isCrossGroup=!1,this.isCrossGroupNoMode=!1,this.hasPositions=!0,this.curveStyle={},this.readFromXML(t,e,i,a)};return i.prototype.getMetadata=function(){return{name:this.name,rootName:this.rootName,loadCaseName:this.loadCaseName,nameX:this.nameX,nameY:this.nameY,isBarChart:this.isBarChart,isCrossGroup:this.isCrossGroup,isCrossGroupNoMode:this.isCrossGroupNoMode,hasPositions:this.hasPositions,isBijective:this.isBijective,isFilled:this.isFilled,isStacked:this.isStacked}},i.prototype.getCurveStyle=function(){return this.curveStyle},i.prototype.getAssignedAxisX=function(){return this.assignedAxisX},i.prototype.setAssignedAxisX=function(t){this.assignedAxisX=t},i.prototype.getAssignedAxisY=function(){return this.assignedAxisY},i.prototype.setAssignedAxisY=function(t){this.assignedAxisY=t},i.prototype.getGroups=function(){return this.listGroups},i.prototype.getValues=function(){return this.listValues},i.prototype.addValue=function(t){t&&this.listValues&&(this.listValues.push(t),this.hasPositions=this.hasPositions&&!isNaN(t.getPosition()))},i.prototype.stack=function(t){if(this.isStacked&&t.isStacked)for(var e=0;e<this.listValues.length;e++)this.listValues[e].setY(this.listValues[e].getY()+t.listValues[e].getY())},i.prototype.ratio=function(t){if(this.isStacked&&t.isStacked)for(var e=0;e<this.listValues.length;e++){var i=t.listValues[e].getY();0!==i?this.listValues[e].setY(100*this.listValues[e].getY()/i):this.listValues[e].setY(0)}},i.prototype.setTo100=function(){if(this.isStacked)for(var t=0;t<this.listValues.length;t++){0!==this.listValues[t].getY()&&this.listValues[t].setY(100)}},i.prototype.readFromXML=function(i,a,s,n){if(n&&(this.rootName=n.rootName,this.loadCaseName=n.loadName),i&&("Curve"===i.nodeName||"DDXYPlot"===i.nodeName)){this.name=i.getAttribute("name"),this.nameX=i.getAttribute("nameX"),this.nameY=i.getAttribute("nameY"),this.assignedAxisX=parseInt(i.getAttribute("axisX")),this.assignedAxisY=parseInt(i.getAttribute("axisY")),this.curveStyle.color=i.getAttribute("color"),this.curveStyle.lineStyle=i.getAttribute("lineStyle"),this.curveStyle.lineWidth=i.getAttribute("lineWidth"),this.curveStyle.markerSize=parseInt(i.getAttribute("markerSize")),this.curveStyle.markerSize=!isNaN(this.curveStyle.markerSize)&&this.curveStyle.markerSize>3?3:this.curveStyle.markerSize,this.curveStyle.markerColor=i.getAttribute("markerColor"),this.curveStyle.markerPeriod=parseInt(i.getAttribute("markerPeriod")),this.curveStyle.markerPeriod=!isNaN(this.curveStyle.markerPeriod)&&this.curveStyle.markerPeriod>=1?this.curveStyle.markerPeriod:1,this.curveStyle.lineWidth,this.isFilled="true"===i.getAttribute("filled"),this.isStacked="true"===i.getAttribute("stacked"),this.isBarChart=!1;var r=i.getAttribute("valuesX"),o=i.getAttribute("valuesY");if(r&&o){var l=r.split(" "),u=o.split(" ");if(l&&""===l[l.length-1]&&l.pop(),u&&""===u[u.length-1]&&u.pop(),l.length===u.length)for(var h={x:0,y:0},c=function(t){t.setX(h.x),t.setY(h.y),this.addValue(t)}.bind(this),d=0;d<l.length;d++){h.x=Number(l[d]),h.y=Number(u[d]),new t(i,c).setIndex(d)}}if(!r&&!o&&i.hasChildNodes()){this.isBarChart=!0;var m,f,p,g,S,v=function(t){this.addValue(t)}.bind(this),D=0;this.isBijective=!0;for(var N=a&&a.modelMgr.getDataList?a.modelMgr.getDataList("grp",a.sequence):void 0,C=i.firstChild,x=0;null!=C;){if(1===C.nodeType){var A=C,b=!0;D++;var L,y,_=void 0,T=A.getAttribute("frmId");if(T&&a&&a.modelMgr.getFrameDetails)L=(_=a.modelMgr.getFrameDetails(a.sequence,T)).group;else{var M=A.getAttribute("grpId");M&&N?_={group:L=N.getEntry(parseInt(M)-1).val}:L=A.getAttribute("group")}var P=L?e.parseGroupIds(L):[];if(y=e.buildGroupIdNoMode(P[0],P[1]),p=P[0],n&&(b=p===n.rootName&&P[1]===n.loadName),b){L?(m&&m===L?this.isBarChart&&(this.isBarChart=!1):(this.listGroups.push(L),this.isCrossGroupNoMode||(this.isCrossGroupNoMode=f&&f!==y),this.isCrossGroup=this.listGroups.length>1),m=L,f=y):this.isBarChart=!1,T&&(this.isBarChart=!1);var I=new t(A,v,_);if(isNaN(I.getX())&&I.setX(D),I.setIndex(x),this.isBijective){var F=I.getX();if(!isNaN(g)){var w=F-g;isNaN(S)||(this.isBijective=w*S>0),S=w}g=F}}x++}C=C.nextSibling}}}1===this.listGroups.length&&void 0===this.rootName&&(this.rootName=e.parseGroupIds(this.listGroups[0])[0]),s&&s(this)},i}),define("DS/SPY/CATSimNavDataFrameViewXYChart",["UWA/Core","DS/WebUtils/ProbesManager","DS/SPY/CATSimNavDataFrameViewComp","DS/SPY/CATSimNavDataXYCurve","DS/SPY/CATSimNavDataChartAxis","DS/SPY/CATSimNavDataHelper"],function(t,e,i,a,s,n){"use strict";let r=i.extend({init:function(t,e,i,a){this.type="CATSimNavDataFrameViewXYChart",this._parent(t,e),this.impl={CATISimNavDataSpecUI:{module:"SPYExtUI",ext:"CATSimNavDataFrameViewXYChartUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYExtUI",ext:"CATSimNavDataFrameViewXYChartUI",type:"data",obj:null}},this.isExtractable=!0,this.listCurves=[],this.axis={x:[],y:[]},this._idForAxis=1,this.listCurvesGroupNames=[],this.analytics={},this.readFromXML(t,a,e)},computeNbCharts:function(){this._nbCharts=1},getMetadata:function(){return{name:this.name,distribution:this.distribution,animation:this.animation,isBarChart:this.isBarChart,isCrossGroup:this.isCrossGroup,isCrossGroupNoMode:this.isCrossGroupNoMode,oneCurvePerGroup:this.oneCurvePerGroup,hasPositions:this.hasPositions,linkAllCurvesAsOneSerie:this.linkAllCurvesAsOneSerie,alignTicks:this.alignTicks,secondaryGridLines:this.secondaryGridLines}},getCurves:function(){return this.computePositions(),this.listCurves},addCurve:function(t){if(t&&this.listCurves&&t.getValues().length>0){this.listCurves.push(t);let e=t.getMetadata();this.isCrossGroup=e.isCrossGroup,this.isCrossGroupNoMode=e.isCrossGroupNoMode;let i=(t,e)=>(t.indexOf(e)<0&&t.push(e),t);if(e.rootName){this.listCurvesGroupNames.push(e.rootName+" "+e.loadCaseName);let t=this.listCurvesGroupNames.reduce(i,[]);this.oneCurvePerGroup=t.length===this.listCurves.length}if(this.listCurves.length>1){let i=e.name===this.previousCurveName,a=t.curveStyle.color===this.previousCurveColor,s=t.curveStyle.lineStyle===this.previousCurveLineStyle,n=2===this.listCurves.length||this.linkAllCurvesAsOneSerie;this.linkAllCurvesAsOneSerie=n&&i&&a&&s&&!this.oneCurvePerGroup}this.previousCurveName=e.name,this.previousCurveColor=t.curveStyle.color,this.previousCurveLineStyle=t.curveStyle.lineStyle;let a=t.getAssignedAxisX(),s=t.getAssignedAxisY();isNaN(a)&&(this._defaultXaxisNeeded=!0,t.setAssignedAxisX(-1)),isNaN(s)&&(this._defaultYaxisNeeded=!0,t.setAssignedAxisY(-2))}},getAxisList:function(t){return this.axis[t]},getAxis:function(t){let e=e=>e.getIdNoPrefix()===t,i=this.axis.x.find(e);return i||(i=this.axis.y.find(e)),i},addAxis:function(t){t&&(2===t.getDimension()?this.axis.y.push(t):this.axis.x.push(t),void 0===t.getId()&&(t.setId(this._idForAxis),this._idForAxis++))},readFromXML:function(t,i,r){if(t){let o=Date.now();this.name=t.getAttribute("name");let l=e.createProbe("SPY.XYChart.PARSEXML."+this.name);l.begin(),this.distribution=t.getAttribute("Distribution");let u=t.getAttribute("Animation");this.animation="true"===u||"TRUE"===u,this.nameX=t.getAttribute("nameX"),this.nameY=t.getAttribute("nameY"),this.unitX=t.getAttribute("unitX"),this.unitY=t.getAttribute("unitY");let h=t.getAttribute("alignTicks");this.alignTicks="true"===h||"TRUE"===h;let c=t.getAttribute("secondaryAxisGridLines");this.secondaryGridLines="true"===c||"TRUE"===c,this.isBarChart=!0;let d=()=>{this.hasPositions=!0;for(let t=0;t<this.listCurves.length&&this.hasPositions;t++){let e=this.listCurves[t];if(e){let t=e.getMetadata();this.hasPositions=t&&t.hasPositions}}if(r&&(r.hasLockableCurves=this.isCrossGroup),this._defaultXaxisNeeded){let t=new s;t.setId(-1),this.addAxis(t);let e=this.listCurves.filter(t=>-1===t.getAssignedAxisX()&&t.nameX),i=e.length>0?e[0].nameX:void 0,a=e.filter(t=>t.nameX===i).length===e.length&&i?i:this.nameX;t.setName(a),t.setUnit(this.unitX?this.unitX:"")}if(this._defaultYaxisNeeded){let t=new s;t.setId(-2),t.setDimension(2),this.addAxis(t);let e=this.listCurves.filter(t=>-2===t.getAssignedAxisY()&&t.nameY),i=e.length>0?e[0].nameY:void 0,a=e.filter(t=>t.nameY===i).length===e.length&&i?i:this.nameY;t.setName(a),t.setUnit(this.unitY?this.unitY:"")}let t=this.listCurves.filter(t=>t.isStacked),e=t[t.length-1];for(let i=t.length-2;i>=0;i--)t[i].stack(e),e=t[i];let a=this.getAxisList("y").filter(t=>"percentage"===t.getScale());if(a&&a.length>0){let e=a[0].getIdNoPrefix(),i=t.filter(t=>t.getAssignedAxisY()===e);if(i.length>0){let t=i[0];for(let e=1;e<i.length;e++)i[e].ratio(t);t.setTo100()}}if(l.end(),this.analytics.dataModelCreationTime=Date.now()-o,this.listCurves.length>0){this.analytics.numberOfCurves=this.listCurves.length;let t=this.listCurves.reduce((t,e)=>t+e.getValues().length,0);this.analytics.numberOfPointsPerCurve=t/this.analytics.numberOfCurves}if(i){let t=this.listCurves&&this.listCurves.length>0?this:void 0;i(t)}},m=!0,f={counter:0,loopCompleted:!1},p=()=>{f.counter--,0===f.counter&&f.loopCompleted&&d()},g=t.children.length;if(1===g&&"ChartAxis"===t.children[0].nodeName)d();else{for(let e=0;e<t.children.length;e++){let i=t.children[e];if("Curve"===i.nodeName){m=!1,f.counter++;new a(i,{modelMgr:r.spm,sequence:r.seq},t=>{t.isBarChart||(this.isBarChart=!1),this.addCurve(t),p()})}else if("ChartAxis"===i.nodeName){f.counter++;let t=new s(i,p);this.addAxis(t)}}if(f.loopCompleted=!0,m){this._defaultXaxisNeeded=!0,this._defaultYaxisNeeded=!0,this.isBarChart=!1;let e=[],i="",s="",o=r.spm.getDataList("grp",r.seq);for(let a=0;a<g;a++){let l=t.children[a];if("Value"===l.nodeName){let t,a=l.getAttribute("frmId");if(a){t=r.spm.getFrameDetails(r.seq,a).group}else{let e=l.getAttribute("grpId");t=e&&o?o.getEntry(parseInt(e)-1).val:l.getAttribute("group")}if(!t){e=[];break}{let a=n.parseGroupIds(t),r=a[0],o=a[1];r===i&&o===s||(e.push({rootName:r,loadName:o}),i=r,s=o)}}}if(0===e.length){new a(t,{modelMgr:r.spm,sequence:r.seq},t=>{this.addCurve(t),d()})}else f.counter=0,f.loopCompleted=!1,e.forEach(e=>{f.counter++;new a(t,{modelMgr:r.spm,sequence:r.seq},t=>{this.addCurve(t),p()},e)}),f.loopCompleted=!0,0===f.counter&&d()}else this._positionsComputed=!0,0===f.counter&&d()}}},computePositions:function(){!this._positionsComputed&&this.dd&&this.dd.animationStructure&&this.dd.animationStructure.groupList.length>0&&(this.listCurves.forEach(t=>{if(t){let e=[];if(this.dd.animationStructure.groupList.forEach(i=>{if(i&&i.rootName===t.rootName&&i.loadCaseName===t.loadCaseName){let t=i.frameList;t&&t.forEach(t=>{!t||t.isScaledPosition||isNaN(t.position)||e.push(t.position)})}}),e.length>0){let i=t.getValues();e.length===i.length&&i.forEach((t,i)=>{t&&(t.position=e[i])})}}}),this._positionsComputed=!0)}});return t.namespace("DS/SPY/CATSimNavDataFrameViewXYChart",r)}),define("DS/SPY/CATSimNavData3DCamera",["UWA/Core","DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavDataLink","DS/Visualization/ThreeJS_DS"],function(t,e,i,a){"use strict";var s=e.extend({init:function(t,e,i,a){this._parent(t,e),this.impl={CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavData3DAnimationCameraUI",type:"data",obj:null}},this._isTracking=!1,this._lockedDOF={},this.readFromXML(t,i,a)},setFromViewpoint:function(t){t&&(this._sightDirection=t.getSightDirection(),this._upDirection=t.getUpDirection(),this._eyePosition=t.getEyePosition(),this._focus=t.getTargetDistance(),this._angle=t.getAngle())},getThumbnail:function(){return this._thumbnail},getEyePosition:function(){return this._eyePosition},getSightDirection:function(){return this._sightDirection},getUpDirection:function(){return this._upDirection},getTargetDistance:function(){return this._focus},getAngle:function(){return this._angle},getLockedDOF:function(){return this._lockedDOF},getDescription:function(){return this._description?this._description:""},isTracking:function(){return this._isTracking},readFromXML:function(t,e,s){if(t){this._thumbnail=t.getAttribute("thumbnail");for(var n=t.getAttribute("camera").split("]"),r=0;r<n.length;++r)n[r]=n[r].replace("[","");var o=n[0].split(";");this._eyePosition=new a.Vector3(Number(o[0]),Number(o[1]),Number(o[2]));var l=n[1].split(";");this._sightDirection=new a.Vector3(Number(l[0]),Number(l[1]),Number(l[2]));var u=n[2].split(";");this._upDirection=new a.Vector3(Number(u[0]),Number(u[1]),Number(u[2])),this._focus=Number(t.getAttribute("focus"));var h=t.getAttribute("angle");this._angle=h?Number(h):45;var c=!1,d=t.getAttribute("lock");if(d){var m=d.split(";");if(m.length>0){c=!0;for(var f=0;f<m.length;++f)Object.defineProperty(this._lockedDOF,m[f],{value:!0,writable:!1})}}c||(this._lockedDOF=void 0),this._description=t.getAttribute("description");for(var p=null,g=0;g<t.childNodes.length;g++){var S=t.childNodes[g];if("LinkSet"===S.nodeName&&"CamerasToPart"===S.getAttribute("role")){for(var v=0;v<S.childNodes.length;v++){var D=S.childNodes[v];if("InternalRef"===D.nodeName){p=D;break}}break}}if(p)new i(p,this.dd,function(t){this.addLink("CamerasToPart",t),this._isTracking=!0!==e}.bind(this));s(this)}},writeToXML:function(t){if(t){var e=t.ownerDocument.createElement("Camera");e.setAttribute("type","CATSimNavData3DCamera"),this.name&&e.setAttribute("name",this.name),this.id&&e.setAttribute("id",this.id);var i=[];i.push("[",this._eyePosition.x.toString(),";",this._eyePosition.y.toString(),";",this._eyePosition.z.toString(),"]"),i.push("[",this._sightDirection.x.toString(),";",this._sightDirection.y.toString(),";",this._sightDirection.z.toString(),"]"),i.push("[",this._upDirection.x.toString(),";",this._upDirection.y.toString(),";",this._upDirection.z.toString(),"]"),e.setAttribute("camera",i.join("")),e.setAttribute("focus",this._focus),e.setAttribute("angle",this._angle),t.appendChild(e)}}});return t.namespace("DS/SPY/CATSimNavData3DCamera",s)}),define("DS/SPY/CATSimNavData3DCamerasRoot",["UWA/Core","DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavData3DCamera"],function(t,e,i){"use strict";var a=e.extend({init:function(t,e,i,a){this._parent(t,e),this.impl={CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavData3DCamerasRootAnimationUI",type:"data",obj:null}},this._cameraList=[],this._currentCameraIdx=0,this.readFromXML(t,i,a)},addCamera:function(t){t&&this._cameraList.push(t)},getCamera:function(t){return this._cameraList[t]},getListCamera:function(){return this._cameraList},getCurrentCamera:function(){return this._cameraList[this._currentCameraIdx]},getCurrentCameraIdx:function(){return this._currentCameraIdx},setCurrentCamera:function(t){return t!==this._currentCameraIdx&&t>=0&&t<this._cameraList.length&&(this._currentCameraIdx=t),this._currentCameraIdx},setCurrentCameraFromId:function(t){var e=this._cameraList.findIndex(function(e){return e.getId()===t});return this.setCurrentCamera(e)},readFromXML:function(t,e,a){if(t){var s={counter:0,loopCompleted:!1},n=parseInt(t.getAttribute("currentCamera"));n=isNaN(n)?1:n,this._currentCameraIdx=n-1;for(var r=function(t){t&&(this.addCamera(t),s.counter--,0===s.counter&&s.loopCompleted&&a&&a())}.bind(this),o=e&&e.types?e.types[this.type]:void 0,l=o&&o.disableTracking,u=o&&!isNaN(o.maxChildrenNb)?o.maxChildrenNb:t.children.length,h=0;h<u;h++){var c=t.children[h];if(!(c.nodeName.indexOf("Camera")<0)){s.counter++;new i(c,this.dd,l,r)}}s.loopCompleted=!0,0===s.counter&&a()}},getLoadingDescription:function(){return{status:"loaded"}},writeToXML:function(t){if(t){var e=t.ownerDocument.createElement("DDElement3D");e.setAttribute("type","CATSimNavData3DCamerasRoot"),this.name&&e.setAttribute("name",this.name),this.id&&e.setAttribute("id",this._id),isNaN(this._currentCameraIdx)||e.setAttribute("currentCamera",this._currentCameraIdx+1),t.appendChild(e);var i=this.getListCamera();i&&i.forEach(function(t){t.writeToXML(e)})}}});return t.namespace("DS/SPY/CATSimNavData3DCamerasRoot",a)}),define("DS/SPY/CATSimNavDataFrameViewCompValue",["DS/SPY/CATSimNavDataFrameViewComp","DS/SPY/CATSimNavDataLink"],function(t,e){"use strict";var i=t.extend({init:function(t,e,i,a){this._parent(t,e),this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavDataFrameViewCompValueUI",type:"data",obj:null}},this.readFromXML(t,a)},getValues:function(){return{name:this.name,type:this.type,value:this.value,unit:this.unit}},readFromXML:function(t,i){if(t)if(this.value=t.getAttribute("value"),this.unit=t.getAttribute("unit"),t.children.length>0){for(var a=this,s=null,n=0;n<t.children.length&&null===s;n++){var r=t.children[n];if("LinkSet"===r.nodeName&&"Frameto3D"===r.getAttribute("role"))for(var o=0;o<r.children.length&&null===s;o++){var l=r.children[o];"InternalRef"===l.nodeName&&(s=l)}}if(s)new e(s,this.dd,function(t){a.addLink("Frameto3D",t),i(a)})}else i(this)}});return UWA.namespace("DS/SPY/CATSimNavDataFrameViewCompValue",i)}),define("DS/SPY/CATSimNavDataFrameViewText",["DS/SPY/CATSimNavDataFrameViewCompValue"],function(t){"use strict";var e=t.extend({init:function(t,e,i,a){this._parent(t,e,i,a),this.impl.CATISimNavDataSpecUI={module:"SPYUI",ext:"CATSimNavDataFrameViewTextUI",type:"data",obj:null}},getValues:function(){return{name:this.name,value:this.value}}});return UWA.namespace("DS/SPY/CATSimNavDataFrameViewText",e)}),define("DS/SPY/LW3DModelLoader",["DS/SPY/LWResourceLoader","DS/Visualization/Node3D","DS/Visualization/ModelLoader"],function(t,e,i){"use strict";return t.extend({init:function(t){this._parent(t),this.eventsManager=t.eventsManager,this.eventContext=t.eventContext,this.emptyRscTransactionCounter=0,this.progress={loaded:0,total:0},this.previousProgressPosition=0,this.window=t.window;let e=t.viewer;this.viewerRoot=t.viewerRoot,e&&(this._modelLoader=new i({node:this.viewerRoot,viewer:e}),this._modelLoader.setOnLoadedCallback(this.onLoaderDoneCallback.bind(this)),this._modelLoader.setOnLoadedProductStructureCallback(this.onModelLoadedCallback.bind(this)))},clearLoadingQueue:function(t){this._notYetLoadingProbe=null;let e=[];this.transactionMap.forEach(function(t,i){"loading"===t.loadStatus&&e.push(i)});let i=[];if(e.forEach(t=>{var e=this._getFrameIdx(t);isNaN(e)||i.push(e)}),this.viewerRoot){let t=this.viewerRoot;i.forEach(e=>{t.traverse(t=>{t.children.forEach(i=>{i._SPYFrameIndex===e&&t.remove(i)})})})}if(this.progress.loaded=0,this.progress.total=0,this.window&&this.window.experience){this.window.experience.modelLoadComplete=!0,this.window.experience.modelLoadCount=0,this.window.experience.modelPrevLoadCount=0;let e=this._modelLoader;if(e){e.abort();let t=e.cgrLoader;t&&t.cleanLoader(),e.setOnLoadedCallback(this.onLoaderDoneCallback.bind(this)),e.setOnLoadedProductStructureCallback(this.onModelLoadedCallback.bind(this))}t||this.window.experience.progress.updateProgression(0)}this._parent(t)},loadFiles:function(t){if(t&&t.filesList&&(t.fatherNode||t.fatherNodes&&!isNaN(t.frameIndex))&&!isNaN(t.sequence)&&t.callback){if(0===t.filesList.length)return void t.callback();let e,i=this.filesToLoad.length>0;if(this.filesToLoad=this.filesToLoad.concat(t.filesList),!this._notYetLoadingProbe&&this.filesToLoad.length>=4&&(this._notYetLoadingProbe=this.probesManager.createProbe("SPY.notYetLoading"),this._notYetLoadingProbe.begin(),this._notYetLoadingProbe.started=!0),!t.framesIndices)for(t.framesIndices=[],e=0;e<t.filesList.length;e++)t.framesIndices.push(t.frameIndex);if(t.framesIndices&&t.framesIndices.length!==t.filesList.length&&console.error("SimulationPlayerModel - inconsistencies between files and frames indices to load"),this.framesIndices=this.framesIndices.concat(t.framesIndices),!t.fatherNodes)for(t.fatherNodes=[],e=0;e<t.filesList.length;e++)t.fatherNodes.push(t.fatherNode);this.managers=this.managers.concat(t.fatherNodes),t.fatherNodes&&t.fatherNodes.length!==t.filesList.length&&console.error("SimulationPlayerModel - inconsistencies between files and father node list");let a=t.fatherNodes[0].id,s=this._getFramePostFix(t.framesIndices[0]),n=String(a)+s;if(!this.transactionMap.get(n)){let a={count:0,loadStatus:"loading",callbacks:[],analytics:{maxRscExtractionTime:0}};if(this.useProbe){let e=t.filesList.length>1?t.filesList.length.toString()+"_cgrs":t.filesList[0];a.probe=this.probesManager.createProbe("SPY.SPM.LOADFILES."+n+"_"+e)}a.sequence=t.sequence,a.count+=t.filesList.length,a.callbacks.push(t.callback),this.transactionMap.set(n,a),t.fatherNodes&&(e=0,t.fatherNodes.forEach(t=>{this.managerTransactionMap.set(String(t.id)+s,n)})),i?this.progress.total+=t.filesList.length:(this.progress.loaded=0,this.progress.total=t.filesList.length,this.window.experience&&(this.eventsManager.publish({event:this.eventContext+"/SPY/PROGRESS/INIT",data:{fromPreviousValue:!t.resetProgress}}),this.window.experience.modelLoadComplete=!1,this.window.experience.modelLoadCount=0,this.window.experience.modelPrevLoadCount=0))}}},_cleaningInterruptedTransaction:function(t,e){t.parents[0]&&t.parents[0].traverse(function(t){t.children.forEach(function(i){i._SPYFrameIndex===e&&t.remove(i)})})},_getNodeToReuse:function(t){var e;return t&&"loaded"===t.status&&t.usages&&t.usages.length>0&&(e=t.usages[0].children[0]),e},_reuseNode:function(t,i,a){var s=new e;isNaN(i)||(s._SPYFrameIndex=i),s.addChild(a),s.setVisibility(!1),t.addChild(s),this._updateTransactionForManager(t,i),this.processLoadFiles(),0===this.filesToLoad.length&&this.onLoaderDoneCallback()},_loadRequest:function(t,i,a){let s,n;if(a&&(n=this.loadingMap.get(a)),s=this._getNodeToReuse(n))this._reuseNode(t,i,s);else{let s=this.managerTransactionMap.get(String(t.id)+this._getFramePostFix(i));if(s){let l=this.transactionMap.get(s),u=l.sequence;if(a){if(!isNaN(u)){var r=new e;if(isNaN(i)||(r._SPYFrameIndex=i),t.addChild(r),r.setVisibility(!1),n&&"loading"===n.status)n.usages.push(r);else{n&&(t._SPYMultipleUsages=!0,n.status="loading",n.usages.push(r)),l.probe&&(l.probe.begin(),l.probe.started=!0);let e=this.spm.sequences[u].zip.find(a);if(e){let t=Date.now(),i=this._modelLoader;i.setKeepLoaderMode(!0),i.fileType="cgr",this._notYetLoadingProbe&&this._notYetLoadingProbe.started&&(this._notYetLoadingProbe.end(),this._notYetLoadingProbe.started=!1),e.getUint8Array().then(e=>{let a=Date.now()-t;a>l.analytics.maxRscExtractionTime&&(l.analytics.maxRscExtractionTime=a),i.loadModelFromBuffer(e,r)})}}}}else{var o=new e;isNaN(i)||(o._SPYFrameIndex=i),t.addChild(o),o.setVisibility(!1),"loading"===l.loadStatus&&(l.count--,0===l.count&&this._closeTransaction(s)),this.processLoadFiles(),0===this.filesToLoad.length&&this.onLoaderDoneCallback()}}}},processLoadFiles:function(){if(this.filesToLoad.length>0){let t=[],e=function(){t.push({fatherNode:this.managers.shift(),frameIndex:this.framesIndices.shift(),cgrFileToLoad:this.filesToLoad.shift()})}.bind(this),i=this._modelLoader.cgrLoader;if(i)for(;i.currentDownload+t.length<i.maxParrallelDownload&&this.managers.length>0;)e();else e();for(;t.length>0;){let e=t.shift();this._loadRequest(e.fatherNode,e.frameIndex,e.cgrFileToLoad)}}},_addToLoadingMap:function(t){let e=this.loadingMap;e&&t&&t.forEach(t=>{e.set(t,{status:"notLoaded",usages:[]})})},initLoadingMap:function(t){this.clearLoadingMap(),this._addToLoadingMap(t)},addToLoadingMap:function(t){this._addToLoadingMap(t)},onModelLoadedCallback:function(t){let e,i;if(t.nodes&&t.nodes.length>0){let a=t.nodes[0].parents[0];if(e=a.parents[0],i=a._SPYFrameIndex,e&&e._SPYMultipleUsages){let t=[];this.loadingMap.forEach(e=>{if(0===t.length){let i=e;if("loading"===i.status){i.usages.indexOf(a)>=0&&(t=i.usages,i.status="loaded")}}}),t.forEach(t=>{if(t!==a&&t.id!==a.id){t.addChild(a.children[0]);let e=t.parents[0];this._updateTransactionForManager(e,i)}})}}else this.emptyRscTransactionCounter++;this._updateTransactionForManager(e,i),this.window.experience&&(this.progress.loaded++,this.eventsManager.publish({event:this.eventContext+"/SPY/PROGRESS/UPDATE",data:{value:this.progress.loaded,total:this.progress.total}}),this.window.experience.modelLoadCount=this.progress.loaded),this.processLoadFiles()}})}),define("DS/SPY/CATSimNavData3DExtrema",["DS/SPY/CATSimNavDataSpec","DS/Visualization/ThreeJS_DS"],function(t,e){"use strict";var i=t.extend({init:function(t,e,i){this._parent(t,e),this.impl={},this.readFromXML(t,i)},getExtremaType:function(){return this._extremaType},getExtremaValue:function(){return this._extremaValue},getPosition:function(){return this._position},getNormalVector:function(){return this._normalVector},getComponent:function(){return this._component},setComponent:function(t){this._component=t},readFromXML:function(t,i){this._extremaType=t.getAttribute("label"),this._position=new e.Vector3(parseFloat(t.getAttribute("PosX")),parseFloat(t.getAttribute("PosY")),parseFloat(t.getAttribute("PosZ"))),this._normalVector=new e.Vector3(0,0,0),this._extremaValue=t.getAttribute("value"),i(this)}});return UWA.namespace("DS/SPY/CATSimNavData3DExtrema",i)}),define("SPY/SimulationPlayerModel",["DS/SPY/SimulationPlayerModel"],function(t){"use strict";return console.warn("This module is deprecated. use DS/SPY/SimulationPlayer instead of SPY/SimulationPlayer"),t}),define("DS/SPY/SimulationPlayerModel",["UWA/Core","DS/CoreEvents/Events","DS/WebSystem/Environment","DS/WebUtils/ProbesManager","DS/Visualization/Node3D","DS/Visualization/ModelLoader","DS/SPY/CATSimNavDataHelper","DS/SPY/LW3DModelLoader","DS/SPY/LWTextureLoader","DS/SPY/LWInstancingLoader"],function(t,e,i,a,s,n,r,o,l,u){"use strict";const h=i.isSet("MSREC.EnableRscLoadingProbe");return t.Class.extend({init:function(t){this.msrID=t&&t.msrID?t.msrID:void 0,this.simulationName=t&&t.simulationName?t.simulationName:"Simulation",this.scenarioName="Simulation case",this.window=t?t.window?t.window:t:void 0,this.ctx=t&&t.context?t.context:"ctxUndefined",this.sequences=[],this.level=2,this._dataLists=[],this._frmDetailsMaps=[],this._URLsToRevoke=[];let i,s=this.window;s&&s.getViewer&&(i=s.getViewer()),this._loaders={Geometry:{construct:o,initParameters:{spm:this,window:this.window,viewer:i,viewerRoot:i?i.getRootNode():void 0,useProbe:h,probesManager:a,eventsManager:e}},Texture:{construct:l,initParameters:{spm:this,window:this.window,useProbe:h,probesManager:a,eventsManager:e}},Instancing:{construct:u,initParameters:{spm:this,window:this.window,useProbe:h,probesManager:a,eventsManager:e}}},this._analytics={}},clean:function(){this.clearLoadingQueue(),this._applyToLoaders("clean"),this.sequences.forEach(function(t){if(t){t.zip&&delete t.zip;let e=t.listDD;e&&e.forEach(function(t){t.clean()}),delete t.listDD}}),delete this.sequences,this._URLsToRevoke.forEach(function(t){URL.revokeObjectURL(t)}),this.logoUrl=void 0},getContext:function(){return this.ctx},addDataList:function(t,e){void 0===this._dataLists[e]&&(this._dataLists[e]={}),this._dataLists[e][t.getName()]=t},getDataList:function(t,e){let i;return e<this._dataLists.length&&e>=0&&this._dataLists[e]&&(i=this._dataLists[e][t]),i},getFrameDetails:function(t,e,i){let a,s=this._frmDetailsMaps[t];if(s?a=s.get(e):(this._frmDetailsMaps[t]=new Map,s=this._frmDetailsMaps[t]),!a){a={};let i=this.getDataList("frm",t),n=parseInt(e)-1,o=i.getEntry(n);o.pos&&o.pos.length>0&&(a.position=Number(o.pos)),a.scaled=o.scaled;let l=this.getDataList("grp",t).getEntry(parseInt(o.grpId)-1);a.group=l.val,a.groupNLS=r.buildGroupNameFromIds(l.val),a.unit=l.unit,s.set(e,a)}return a},setFrameDetails:function(t,e,i,a,s,n){let o=this._frmDetailsMaps[t];o||(this._frmDetailsMaps[t]=new Map,o=this._frmDetailsMaps[t]),o.set(e,{position:s,scaled:i,group:a,groupNLS:r.buildGroupNameFromIds(a),unit:n})},addSequence:function(t,e,i,a){require(["DS/SPY/CATSimNavDataLWFactory"],function(s){let n=new s,r={idx:0,name:"sequence",listDD:[],listDDShared:[],zip:e};r.idx=this.sequences.push(r)-1,n.parseXML(t,r,this,i,()=>{this.sequences[r.idx]=void 0,a()})}.bind(this))},getNbSequences:function(){return this.sequences.reduce((t,e)=>t+(e?1:0),0)},getFirstValidSequenceIdx:function(){return this.sequences.findIndex(t=>t)},getMSRID:function(){return this.msrID},getSimulationAlias:function(){return this.simulationName},getSimulationTitle:function(){return this.window.experience._myAsset.displayname?this.window.experience._myAsset.displayname:this.getSimulationAlias()},getCurrentContentDescription:function(t){if(t&&t.onComplete){let e="",i=this.window.experience.mySPMUI;if(i){let a=i.getActiveSequence(),s=i.getActiveDD();if(s){let i=this.getSimulationAlias(),n=this.getSimulationTitle(),r=this.getSequenceName(a),o=s.name,l=this.getDisclaimer();require(["DS/WebSystem/Nls"],function(a){a.nls("SPY/Description",["CurrentTitle","AliasAtGeneration","CaseName","ContentName"],function(a){e+=a[0]+i+"\n",e+=a[1]+n+"\n",e+=a[2]+r+"\n",e+=a[3]+o+"\n",l&&(e+=l),t.onComplete(e)})})}}}},getDisclaimer:function(){return this.disclaimer},_getLogoZipEntry:function(){let t;if(this.logo&&this.logo.length>0&&!this.logoUrl){let e=this.getFirstValidSequenceIdx();if(e>=0){t=this.getZipEntries(e).find(this.logo)}}return t},getLogoUrl:function(t){let e=this._getLogoZipEntry();return e&&e.getBlob("image/png").then(e=>{this.logoUrl=URL.createObjectURL(e),this._URLsToRevoke.push(this.logoUrl),t&&t(this.logoUrl)}),this.logoUrl},loadImage:function(t,e,i){if(!isNaN(t)&&e&&i){let a,s,n=this.getZipEntries(t);n&&e&&(s="image/png",a=n.find(e)),a&&a.getBlob(s).then(t=>{let e=URL.createObjectURL(t);this._URLsToRevoke.push(e),i(e)})}},isYaxisUp:function(){return this._isYaxisUp},_findDataDisplay:function(t,e){let i=-1;if(t>=0&&this.sequences[t]&&(e.id&&(i=this.sequences[t].listDD.findIndex(t=>t.id===e.id)),i<0&&e.name&&e.allowNameComparison)){this.sequences[t]&&(i=this.sequences[t].listDD.findIndex(t=>t.name===e.name))}return i},findSequenceByPersistentId:function(t){return this.sequences.findIndex(e=>e&&t&&e.persistentId===t)},findSequenceByName:function(t){return this.sequences.findIndex(e=>e&&t&&e.name===t)},findSimilarContent:function(t){let e={found:!1},i=t.sequenceName,a=t.persistentId,s=t.dataDisplayId,n=t.dataDisplayName,r=t.allowNameComparison,o=-1,l=-1;a&&(l=this.findSequenceByPersistentId(a)),l<0&&r&&(l=this.findSequenceByName(i));let u=this.getNbSequences();return l<0&&1===u&&r&&(l=this.getFirstValidSequenceIdx()),l>=0?o=this._findDataDisplay(l,{id:s,name:n,allowNameComparison:r}):this.sequences.forEach((t,e)=>{o<0&&(l=e,o=this._findDataDisplay(e,{id:s,name:n,allowNameComparison:r}))}),e.sequenceIndex=l,e.dataDisplayIndex=o,e.found=l>=0&&o>=0,e},getSequencePersistentId:function(t){return this.sequences[t]?this.sequences[t].persistentId:"undefined"},getSequenceName:function(t){return Array.isArray(this.sequences)&&this.sequences[t]?this.sequences[t].name:"undefined"},setPreferredStreamId:function(t){return this._preferredStreamId=t},getPreferredStreamId:function(){return this._preferredStreamId},updateSequenceAnalyticsFromContent:function(t){if(this.sequences[t]){let e=this.sequences[t].analytics;if(e){isNaN(e.extractionTime)&&(e.extractionTime=0);let i=function(t){t.forEach(t=>{t&&t.analytics&&t.analytics.extractionTime>e.extractionTime&&(e.extractionTime=t.analytics.extractionTime)})};i(this.getDataDisplayList(t)),i(this.getSharedDataDisplayList(t))}}},getStreamAnalytics:function(t){let e={};if(Array.isArray(this.sequences)&&this.sequences[t]){let i=this.sequences[t].analytics;i&&(e.dataSize=i.dataSize,e.streamingTime=i.streamingTime)}return e},addAnalytics:function(t){this._analytics&&t&&(this._analytics=Object.assign(this._analytics,t))},getAnalytics:function(){return this._analytics},setTypingInfo:function(t){this._typingInfo=Object.assign({},t)},getTypingInfo:function(){return this._typingInfo},extractTypingInfoForSequence:function(t,e){let i=this._typingInfo,a={assetType:this._analytics.assetType,providerType:this._analytics.providerType};if(i){let s=function(t){a.origin=t.origin,a.sequenceType=t.sequenceType,a.sequenceSubTypes=t.sequenceSubTypes},n=!1;if(t){let e=t.replace("SimNavData_","").replace("_","").replace("0","");for(let t in i){let a=i[t];if("object"==typeof a&&a.resultSequenceId&&a.resultSequenceId.replace("0","")===e){s(a),n=!0;break}}}if(!n&&e)for(let t in i){let a=i[t];if("object"==typeof a&&a.name&&a.name===e){s(a),n=!0;break}}n||(a.origin=i.simulationOrigin)}return a},extractTypingInfoForDataDisplay:function(t){let e={},i=this.sequences[t.seq];return i&&((e=this.extractTypingInfoForSequence(i.persistentId,i.name)).contentType=this.getDataDisplayType(t)),e},getDataDisplayType:function(t){let e;return t&&(e=t.plotType&&t.plotType.length>0?t.plotType:t.type),e},getDataDisplayList:function(t){return this.sequences[t]?this.sequences[t].listDD:void 0},getSharedDataDisplayList:function(t,e){if(this.sequences[t]){let i=this.sequences[t].listDDShared;return e&&(i=this.sequences[t].listDDShared.filter(t=>t.category===e)),i}},getZipEntries:function(t){return this.sequences[t].zip},copyZipEntriesForTarget:function(t,e,i){if(e&&!isNaN(t)&&this.sequences&&this.sequences.length>t){let a=this.getZipEntries(t),s=0,n=e.getZipEntries(s);if(a&&n){let t=e.getDataDisplayList(s);t=t.concat(e.getSharedDataDisplayList(s));let r=[],o=this.logo?[this.logo]:[];t.forEach(t=>{r=r.concat(t.getNavData3DViewList(!0));let e=t.getLegend();e&&(o=o.concat(e.getPNGList())),t.containsImages()&&(o=o.concat(t.getInfoImages()))});let l=[];r.forEach(t=>{t&&(t.getGeometryFiles&&(l=l.concat(t.getGeometryFiles())),t.matRendering&&l.push(t.matRendering),t.getTextureFiles&&(l=l.concat(t.getTextureFiles())))}),l=Array.from(new Set(l));let u={count:0,noMoreRequest:!1},h=function(t){return function(e){n.root.addUint8Array(t,e),u.count--,0===u.count&&u.noMoreRequest&&i()}},c=function(t){let e=a.find(t);e&&(u.count++,e.getUint8Array().then(h(t)))};l.forEach(c),o.forEach(c),u.noMoreRequest=!0,0===u.count&&i()}}},_getLoader:function(t){let e;if(this._loaders[t]){e=this._loaders[t].instance;let i=this._loaders[t].construct;!e&&i&&(e=new i(this._loaders[t].initParameters),this._loaders[t].instance=e)}return e},_applyToLoaders:function(t){if(t&&t.method)if(t.type){let e=this._loaders[t.type].instance;e&&e[t.method]&&e[t.method].apply(e,t.args)}else for(const e in this._loaders){let i=this._loaders[e].instance;i&&i[t.method]&&i[t.method].apply(i,t.args)}},loadFiles:function(t){let e=this._getLoader(t.type);if(e)return e.loadFiles(t)},processLoadFiles:function(t){this._applyToLoaders({method:"processLoadFiles",type:t})},clearLoadingQueue:function(t,e){this._applyToLoaders({method:"clearLoadingQueue",type:e,args:arguments})},clearLoadingMap:function(t){this._applyToLoaders({method:"clearLoadingMap",type:t})},initLoadingMap:function(t){let e=this._getLoader(t.type);if(e)return e.initLoadingMap(t.entries)},addToLoadingMap:function(t){let e=this._getLoader(t.type);if(e)return e.addToLoadingMap(t.entries)},getTextureLoader:function(){return this._loaders.Texture?this._loaders.Texture.instance:null}})}),define("DS/SPY/CATSimNavData3DExtremas",["DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavData3DExtrema"],function(t,e){"use strict";var i=t.extend({init:function(t,e,i){this._parent(t,e),this.impl={},this._extremaList=[],this._extremaFrameIndex=t._extremaFrameIndex,this.readFromXML(t,i)},getFrameIndex:function(){return this._extremaFrameIndex},addExtrema:function(t){t&&this._extremaList.push(t)},getListExtrema:function(){return this._extremaList},readFromXML:function(t,i){for(var a=0,s=!1,n=function(t){t&&(this.addExtrema(t),0===--a&&s&&i&&i(this))}.bind(this),r=0;r<t.children.length;r++){var o=t.children[r];if("Extrema"===o.nodeName){a++;new e(o,this.dd,n)}}s=!0,0===a&&i(this)}});return UWA.namespace("DS/SPY/CATSimNavData3DExtremas",i)}),define("DS/SPY/CATSimNavData3DExtremasSet",["DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavData3DExtremas","DS/SPY/CATSimNavDataLink"],function(t,e,i){"use strict";var a=t.extend({init:function(t,e,i){this._parent(t,e),this.impl={},this._extremasList=[],this.readFromXML(t,i)},addExtremas:function(t){t&&this._extremasList.push(t)},getExtremas:function(t){for(var e,i=0;i<this._extremasList.length&&!e;i++)this._extremasList[i].getFrameIndex()===t&&(e=this._extremasList[i]);return e},readFromXML:function(t,a){for(var s=function(){for(var i=0,s=0,n=!1,r=function(t){this.addExtremas(t),0===--i&&n&&a(this)}.bind(this),o=0;o<t.children.length;o++){var l=t.children[o];if("Extremas"===l.nodeName){l._extremaFrameIndex=s,s++,i++;new e(l,this.dd,r)}}n=!0,0===i&&a(this)}.bind(this),n=null,r=0;r<t.children.length;r++){var o=t.children[r];if("LinkSet"===o.nodeName&&"ExtremasToPart"===o.getAttribute("role"))for(var l=0;l<o.children.length&&null===n;l++){var u=o.children[l];"InternalRef"===u.nodeName&&(n=u)}}if(n)new i(n,this.dd,function(t){this.addLink("ExtremasToPart",t),s()}.bind(this));else s()}});return UWA.namespace("DS/SPY/CATSimNavData3DExtremasSet",a)}),define("DS/SPY/CATSimNavData3DExtremasRoot",["DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavData3DExtremasSet"],function(t,e){"use strict";var i=t.extend({init:function(t,e,i,a){this._parent(t,e),this.impl={},this._extremasSetList=[],this.readFromXML(t,a)},addExtremasSet:function(t){t&&this._extremasSetList.push(t)},getListExtremasSet:function(){return this._extremasSetList},readFromXML:function(t,i){for(var a=0,s=!1,n=function(t){t&&(this.addExtremasSet(t),0===--a&&s&&i&&i())}.bind(this),r=0;r<t.children.length;r++){var o=t.children[r];if("ExtremasSet"===o.nodeName){a++;new e(o,this.dd,n)}}s=!0,0===a&&i()}});return UWA.namespace("DS/SPY/CATSimNavData3DExtremasRoot",i)});