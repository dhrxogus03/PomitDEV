"undefined"==typeof define&&(define=function(e){RulesV2V3=e(),define=void 0}),define("DS/CSIJSONToolsWeb/CSIGrammarUpgraderRulesV2V3",["DS/CSIJSONToolsWeb/CSIGrammarUpgraderJsonField","DS/CSIJSONToolsWeb/CSIGrammarUpgraderPropertiesParser"],function(e,r){"use strict";const t={parser_:void 0,grammarVersion:function(){const r=Math.min(3,this.parser_.getCurrentFileMaxGrammarVersion());return new e("grammarVersion",{grammarVersion:r})},implementation:function(r){const t=r.getValue();if(this.parser_.isFunctionFile()||this.parser_.isCommandFile()){const n={};if(t.hasOwnProperty("library"))return n.implementation={name:"library",version:2,settings:{library:t.library}},new e("implementation",n);if(t.hasOwnProperty("javaClassPath"))return n.implementation={name:"java",version:1,settings:{javaClassPath:t.javaClassPath}},new e("implementation",n);if(t.hasOwnProperty("name")&&t.hasOwnProperty("version")&&t.hasOwnProperty("settings"))return r}else if(this.parser_.isTypeFile()||this.parser_.isPoolFile()){const r={implementation:{}};return t.hasOwnProperty("library")&&(r.implementation.library=t.library,r.implementation.version=2),t.hasOwnProperty("jsModule")&&(r.implementation.jsModule=t.jsModule),t.hasOwnProperty("javaClassPath")&&(r.implementation.javaClassPath=t.javaClassPath,r.implementation.version=2),new e("implementation",r)}console.warn('GrammarUpdater : bad "implementation" in V2 '+JSON.stringify(t))},onCall:function(r){const t=r.getValue(),n={onCall:{}};return this.parser_.parseObject(t,n.onCall,this.parser_.ParsingOrder.signature,2),new e("onCall",n)},signature:function(t,n){const s=t.getValue(),a={};if(a[n]={},s.hasOwnProperty("parameters")){const e=r.parseV2(s.parameters).upgradeV2();e.length>0&&(a[n].parameters=e)}else s.hasOwnProperty("type")&&(a[n].type=s.type,s.hasOwnProperty("desc")&&(a[n].desc=s.desc));return new e(n,a)},in:function(e){return this.signature(e,"in")},out:function(e){return this.signature(e,"out")},answers:function(e){return this.signature(e,"answers")},definition:function(t){const n=t.getValue(),s={};return n instanceof Array?(s.definition=r.parseV2(n).upgradeV2(),new e("definition",s)):t},progress:function(e){return this.signature(e,"progress")},throwError:function(e){return this.signature(e,"throwError")},importCommandsFromPool:function(r){const t=r.getValue(),n={imports:[]};if(t instanceof Array)for(let e=0;e<t.length;++e)n.imports.push({pool:t[e]});return new e("imports",n)},pools:function(r){const t=r.getValue(),n=[];if(t instanceof Array)for(const e of t){const r=this.parser_.grammarUpgrader_.upgradeObject(e),t=[];for(const r of e.functions){const e=this.parser_.grammarUpgrader_.upgradeObject(r);t.push(e)}r.functions=t;const s=[];for(const r of e.commands){const e=this.parser_.grammarUpgrader_.upgradeObject(r);s.push(e)}r.commands=s,n.push(r)}return this.parser_.fileType_=this.parser_.FileType.csiBundle,new e("pools",{pools:n})},types:function(r){const t=r.getValue(),n=[];if(t instanceof Array)for(const e of t){const r=this.parser_.grammarUpgrader_.upgradeObject(e);n.push(r)}return this.parser_.fileType_=this.parser_.FileType.csiBundle,new e("types",{types:n})},events:function(r){const t=r.getValue(),n=[];if(t instanceof Array)for(const e of t){const r=this.parser_.grammarUpgrader_.upgradeObject(e);n.push(r)}return this.parser_.fileType_=this.parser_.FileType.csiBundle,new e("events",{events:n})},customImplementations:function(r){this.parser_.fileType_=this.parser_.FileType.csiCustomImpl;const t=r.getValue(),n=[];if(t instanceof Array)for(const e of t){const r=this.parser_.grammarUpgrader_.upgradeObject(e);n.push(r)}return this.parser_.fileType_=this.parser_.FileType.csiBundle,new e("customImplementations",{customImplementations:n})}};return t});