define("DS/DELPPWNavigationServices/NavigationBase",["UWA/Core","UWA/Class"],function(e,t){"use strict";return t.extend({init:function(e){if(!e.collectionUtils)throw new Error("collectionUtils option not defined");this.collectionUtils=e.collectionUtils,this.mandatoryPredicates=e.mandatoryPredicates},splitIntoChunks:function(e,t){var n,i,o=Math.ceil(e.length/t),r=[];for(i=0,n=0;i<o;i++,n+=t)r[i]=e.slice(n,n+t);return r},_addToCollections:function(e,t){t=t||{},e.onComplete=function(e){Object.prototype.hasOwnProperty.call(t,"callback")&&t.callback instanceof Function&&t.callback(e)},this.collectionUtils.addToCollections(e)},_onDocumentComplete:function(e){Object.keys(e).length;return function(){0}},_addDocuments:function(e,t,n){n instanceof Function&&n()}})}),define("DS/DELPPWNavigationServices/PathSRParser",["UWA/Core","DS/DELPPWLoggerModel/LoggerUtils"],function(e,t){"use strict";return function(){var n,i,o,r,s,a={DELFmiProcessPrereqMaterializationCnx:{BUS:{name:"scope",type:"ResultingProductLink",from:{role:"R_150",category:"S_7"},to:{role:"R_149",category:"S_5"}}},PLMReqSpecifyHowToCnx:{BUS:{name:"requirement",type:"PLMReqSpecifyHowToCnx",from:{role:"R_323",category:"S_7"},to:{role:"R_324",category:"S_5"}}},DELFmiProcessOutputPrereqMaterializationCnx:{BUS:{name:"resultingProduct",type:"ResultingProductLink",from:{role:"R_150",category:"S_7"},to:{role:"R_149",category:"S_5"}}},DELFmiProcessImplementCnx:{BUS:{name:"scope",type:"ProductImplementLink",from:{role:"R_52",category:"S_7"},to:{role:"R_51",category:"S_5"}}},PartialProductImplementLink:{BUS:{name:"partialScope",type:"PartialProductImplementLink",to:{role:"R_51",category:"S_5"}}},MfgProductionPlanning:{BUS:{name:"scope",type:"ProcessImplementLink",from:{role:"R_52",category:"S_7"},to:{role:"R_51",category:"S_5"}},REL:{name:"operationProcessImplement",type:"ProcessImplementLinkOcc",from:{role:"R_52",category:"S_7"},to:{role:"R_51",category:"S_5"}}},PartialProcessImplementLink:{BUS:{name:"PartialProcessImplementLink",type:"PartialProcessImplementLink",to:{role:"R_51",category:"S_1"}}},HistorizationLinkRefRef:{BUS:{name:"historization",type:"HistorizationLinkRefRef",from:{role:"R_308",category:"S_7"},to:{role:"R_307",category:"S_5"}}},DELMfgResponsibilityCnx:{BUS:{name:"MfgResponsibility",type:"DELMfgResponsibilityCnx",from:{role:"R_416",category:"S_9"},to:{role:"R_417",category:"S_6"}}},DELFmiMfgSubstituteCnx:{BUS:{name:"MfgSubstitute",type:"DELFmiMfgSubstituteCnx",to:{role:"R_419",category:"S_6"}},REL:{name:"MfgSubstitute",type:"DELFmiMfgSubstituteCnx",from:{role:"R_418",category:"S_9"}}},DELAsmProcessCanUseCnx:{BUS:{name:"candidateResource",type:"DELAsmProcessCanUseCnx",from:{role:"R_203",category:"S_5"},to:{role:"R_204",category:"S_6"}}},SecondaryCandidateResourceLink:{BUS:{name:"secondaryResource",type:"SecondaryCandidateResourceLink",from:{role:"R_461",category:"S_1"},to:{role:"R_247",category:"S_1"}}},CapableResourcesStructureLink:{BUS:{name:"CapableResourcesStructureLink",type:"CapableResourcesStructureLink",to:{role:"R_490",category:"S_1"}}},DELAssetsStructureLink:{BUS:{name:"DELAssetsStructureLink",type:"DELAssetsStructureLink",to:{role:"R_486",category:"S_1"}}},DELLmiProductionSystemOutputCnxToMBOM:{BUS:{name:"mbomOperationOutput",type:"DELLmiProductionSystemOutputCnxToMBOM",from:{role:"R_296",category:"S_1"},to:{role:"R_363",category:"S_1"},tryToFindFromSide:!0}},PLMDocConnection:{BUS:{name:"document",type:"PLMDocConnection",to:{role:"R_87",category:"S_1"}}},PPRContextSystemCnxDisc:{BUS:{name:"system",type:"PPRContextSystemCnxDisc",to:{role:"R_246",category:"S_6"}}},PPRContextProcessCnxDisc:{BUS:{name:"process",type:"PPRContextProcessCnxDisc",to:{role:"R_115",category:"S_6"}}},ProductImplementLinkOcc:{REL:{name:"productMbomImplement",type:"ProductImplementLinkOcc",to:{role:"R_51",category:"S_5"}}},DELLmiTimeConstraintCnx:{REL:{name:"productFlow",type:"DELLmiTimeConstraintCnx",from:{role:"R_248",category:"S_1"},to:{role:"R_249",category:"S_1"}}},DELLmiMaterialPathCnxCust:{REL:{name:"Material",type:"DELLmiMaterialPathCnxCust",from:{role:"R_295",category:"S_1"},to:{role:"R_294",category:"S_1"}}}};return n=function(e){return e.indexOf("LT_BO")>-1},i=function(e){return e.indexOf("R_590")>-1},o=function(e){var t,n;return t=e.indexOf("PS"),t+="PS".length+" ".length,n=e.indexOf("PE")-" ".length,e.substring(t,n).split(" ")},r=function(t){var n=t;return e.is(t,"object")&&e.is(t.value)&&(n=t.value),n},s=function(i,o,s,c,l,d,u,f){var p,m,g,h,y,P,v,I,_,S,R=function(e){P.from.role===p&&P.from.category===m?f.from=e:P.to.role===p&&P.to.category===m&&(f.to=e)};return h=i.indexOf("R"),y=i.indexOf(" ",h),p=i.substring(h,y),h=i.indexOf("S"),y=i.indexOf(" ",h),m=i.substring(h,y),h=i.indexOf("I"),y=i.indexOf(" ",h),v=i.substring(h,y),I=parseInt(v.split("_")[1]),P=a[s],e.is(P)?(P=n(i)?P.BUS:P.REL,e.is(P)&&function(n){var i,s;switch(n){case"ResultingProductLink":1===o.length&&(_=o[0],I>0&&(e.is(f.isRefRef)||(f.isRefRef=!0),P.from.role===p&&P.from.category===m?f.from=e.is(d)?r(d.physicalid):o[0]:P.to.role===p&&P.to.category===m&&(f.to=o[0]),e.is(f.type)||(f.type=n),e.is(f.from)&&e.is(f.to)&&(f.PID=f.type+"|"+f.from+"|"+f.to)));break;case"PLMReqSpecifyHowToCnx":1===o.length&&(_=o[0],1===o.length&&(_=o[0],I>0&&(e.is(f.isRefRef)||(f.isRefRef=!0),P.from.role===p&&P.from.category===m?f.from=e.is(d)?r(d.physicalid):o[0]:P.to.role===p&&P.to.category===m&&(f.to=o[0]),e.is(f.type)||(f.type=n),e.is(f.from)&&e.is(f.to)&&(f.PID=l.physicalid))));break;case"ProductImplementLink":o.length>0&&(_=o[o.length-1],I>0&&(e.is(f.isRefRef)||(f.isRefRef=!0),R(_),e.is(f.type)||(f.type=n),e.is(f.from)&&e.is(f.to)&&(f.PID=f.type+"|"+f.from+"|"+f.to)));break;case"ProductImplementLinkOcc":I>0&&(S=o,e.is(f.isRefRef)||(f.isRefRef=!1),P.to.role===p&&P.to.category===m&&(f.to=S,f.from=r(l.physicalid)),e.is(f.type)||(f.type=n),f.PID=f.type+"|"+f.from+"|"+e.Json.encode(f.to));break;case"ProcessImplementLink":1===o.length?(_=o[0],I>0&&(e.is(f.isRefRef)||(f.isRefRef=!0),R(_),e.is(f.type)||(f.type=n),e.is(f.from)&&e.is(f.to)&&(f.PID=f.type+"|"+f.from+"|"+f.to))):2===o.length&&(f.to=o[0],I>0&&(f.isRefRef=!1,e.is(f.type)||(f.type=n),e.is(f.from)&&e.is(f.to)&&(f.PID=f.type+"|"+f.from+"|"+f.to)));break;case"PartialProcessImplementLink":1===o.length?(_=o[0],I>0&&(e.is(f.isRefRef)||(f.isRefRef=!0),P.to.role===p&&P.to.category===m&&(f.to=_,e.is(l)&&(f.from=r(l.physicalid))),e.is(f.type)||(f.type=n),e.is(f.from)&&e.is(f.to)&&(f.PID=f.type+"|"+f.from+"|"+f.to))):2===o.length&&(f.to=o[0],I>0&&(f.isRefRef=!1,P.to.role===p&&P.to.category===m&&e.is(l)&&(f.from=r(l.physicalid)),e.is(f.type)||(f.type=n),e.is(f.from)&&e.is(f.to)&&(f.PID=f.type+"|"+f.from+"|"+f.to)));break;case"DELFmiMfgSubstituteCnx":I>0&&(S=o,f.isInstRef=!0,e.is(f.isRefRef)||(f.isRefRef=!1),s=S,P.from&&P.from.role===p&&P.from.category===m?f.from=s[0]:P.to&&P.to.role===p&&P.to.category===m&&(f.to=s[0]),e.is(f.type)||(f.type=n));break;case"ProcessImplementLinkOcc":I>0&&(S=o,e.is(f.isRefRef)||(f.isRefRef=!1),R(S),e.is(f.type)||(f.type=n),e.equals(f.type,"ProcessImplementLink")&&(f.type=n,f.isRefRef=!1));break;case"DELLmiTimeConstraintCnx":I>0&&(S=o,e.is(f.isRefRef)||(f.isRefRef=!1),R(S),e.is(f.type)||(f.type=n));break;case"DELLmiMaterialPathCnxCust":S=o.slice(0,o.length-1),I>0&&(e.is(f.isRefRef)||(f.isRefRef=!1),R(S),e.is(f.type)||(f.type=n));break;case"HistorizationLinkRefRef":case"DELAsmProcessCanUseCnx":case"SecondaryCandidateResourceLink":case"DELMfgResponsibilityCnx":1===o.length&&(_=o[0],I>0&&(e.is(f.isRefRef)||(f.isRefRef=!0),R(_),e.is(f.type)||(f.type=n)));break;case"CapableResourcesStructureLink":case"DELAssetsStructureLink":case"PartialProductImplementLink":1===o.length&&(_=o[0],I>0&&(e.is(f.isRefRef)||(f.isRefRef=!0),P.to.role===p&&P.to.category===m&&(f.to=_,e.is(l)&&(f.from=r(l.physicalid))),e.is(f.type)||(f.type=n),e.is(f.from)&&e.is(f.to)&&(f.PID=f.type+"|"+f.from+"|"+f.to)));break;case"DELLmiProductionSystemOutputCnxToMBOM":1===o.length&&(_=o[0],I>0&&(e.is(f.isRefRef)||(f.isRefRef=!0),P.from.role===p&&P.from.category===m?e.is(P.tryToFindFromSide,"boolean")&&!0===P.tryToFindFromSide&&(e.is(d)&&_!==r(d.physicalid)?(i=u.get(_),e.is(i)?r(i["from.physicalid"])===r(d.physicalid)?f.from=r(i["from.physicalid"]):(g=e.is(d)&&e.is(d["ds6w:label"])&&e.is(r(d["ds6w:label"]),"string")?r(d["ds6w:label"]):"ds6w:label Not Defined",t.log('PathSRParser: Unable to find "from" side of "mbomSystemOutput" link of '+g)):(f.idToResolve=_,f.deferResolution=!0)):f.from=_):P.to.role===p&&P.to.category===m&&(f.to=_),e.is(f.type)||(f.type=n)));break;case"PLMDocConnection":1===o.length&&(_=o[0],I>0&&(e.is(f.isRefRef)||(f.isRefRef=!0),P.to.role===p&&P.to.category===m&&(f.to=_,e.is(d)&&(f.from=r(d.physicalid))),e.is(f.type)||(f.type=n)));break;case"PPRContextSystemCnxDisc":case"PPRContextProcessCnxDisc":1===o.length&&(_=o[0],I>0&&(e.is(f.isRefRef)||(f.isRefRef=!0),P.to.role===p&&P.to.category===m&&(f.to=_,e.is(d)&&(f.from=r(d.physicalid))),e.is(f.type)||(f.type=n),e.is(f.from)&&e.is(f.to)&&(f.PID=f.type+"|"+f.from+"|"+f.to)))}}(P.type)):t.error("PathSRParser: Link currently not supported"),f},{parse:function(t,n){var a,c=n||{},l=e.is(c.type)?c.type:null,d=!e.is(c.isRefRef,"boolean")||c.isRefRef,u=e.is(c.referenceEntity)?c.referenceEntity:null,f=e.is(c.ioPortToPlmPortMap)?c.ioPortToPlmPortMap:null,p=null;return e.is(t.pathsr)&&(a=r(t.pathsr),p={from:null,to:null,type:null,PID:null,isRefRef:null,deferResolution:!1},a.split("Sep").forEach(function(n){var r;i(n)||(r=o(n),d?p=s(n,r,l,0,t,u,f,p):e.is(l)||(p=s(n,r,l="ProductImplementLinkOcc",0,t,null,null,p)))}),e.is(p.isRefRef)||(p.isRefRef=!1),!1!==p.deferResolution||e.is(p.from)&&e.is(p.to)||(p=null)),p}}}}),define("DS/DELPPWNavigationServices/SwitchDBModeManager",["UWA/Class","UWA/Core","DS/CoreEvents/Events"],function(e,t,n){"use strict";var i=null,o=18e4,r="SwitchDBManager/ChangeMode",s="indexMode";return e.singleton({init:function(){var e=null,a=null;t.is(widget.getPreference("switchDBTimeout"))&&(o=widget.getPreference("switchDBTimeout").defaultValue),t.is(widget.getValue("switchDBManagerEndTimestamp"))&&(e=widget.getValue("switchDBManagerEndTimestamp")),t.is(e)&&e>Date.now()&&(console.log("switchDBManager :  need to set to dbMode because timeout no reached !"),a=e-Date.now(),s="dbMode",n.publish({event:r,data:{mode:s}}),i=setTimeout(function(){s="indexMode",n.publish({event:r,param:{data:s}}),console.log("switchDBManager :  switch back to index mode")},a))},isDbMode:function(){return"dbMode"===s},setDbMode:function(e){var a=Date.now()+o,c=null;t.is(e,"boolean")&&(c=!0===e?"dbMode":"indexMode"),s!==c&&(s=c,n.publish({event:r,data:{mode:s}})),"dbMode"===s?(widget.setValue("switchDBManagerEndTimestamp",a),t.is(i)&&(clearTimeout(i),console.log("switchDBManager : Timeout cleared")),i=setTimeout(function(){s="indexMode",n.publish({event:r,data:{mode:"indexMode"}})},o)):(widget.setValue("switchDBManagerEndTimestamp",0),t.is(i)&&(clearTimeout(i),console.log("switchDBManager : Timeout cleared")))}})}),define("DS/DELPPWNavigationServices/ProgressiveExpandExt",["UWA/Core","DS/DELPPWWebServices/WebserviceUtils","DS/DELPPWModelServices/ModelUtils","DS/DELPPWIndexServices/IndexParser","DS/DELPPWLoggerModel/LoggerUtils"],function(e,t,n,i,o){"use strict";return{_computeStackedObjectsFromProgressiveExpandResult:function(t,n,o){var r,s,a,c,l=this,d={},u={},f={},p={},m=new Set,g=new Set,h=new Set,y={};const P="REFERENCE",v="INSTANCE",I="CONNECTION";return r={references:d,instances:u,connections:f,documents:p,referencesToFetch:m,instancesToFetch:g,connectionsToFetch:h,connectionsMap:y},t=t||{},s=function(n,i){var o,r=!1;return o=Array.isArray(n)?n[n.length-1]:n,e.is(t.structureInfos)&&(e.is(i)?i===P&&e.is(t.structureInfos.references)?r=t.structureInfos.references.indexOf(o)>-1:i===v&&e.is(t.structureInfos.instances)&&(r=t.structureInfos.instances.indexOf(o)>-1):e.is(t.structureInfos.references)&&e.is(t.structureInfos.instances)&&(r=t.structureInfos.references.indexOf(o)>-1||t.structureInfos.instances.indexOf(o)>-1)),r},a=function(t,n){var i,o,r,s;r=function(e,t){Array.isArray(e)?e.forEach(e=>t.add(e)):t.add(e)},s=function(e){var t;t=Array.isArray(e)?e.toString():e,y[t]=y[t]||[],y[t].indexOf(i)<0&&y[t].push(i)},e.is(t)&&e.is(t.PID)&&(i=t.PID,f[i]=t,c(i)||h.add(i),e.is(n.toType)&&(o=n.toType===P?m:n.toType===v?g:h,e.is(o)&&r(t.to,o)),e.is(n.fromType)&&(o=n.fromType===P?m:n.toType===v?g:h,e.is(o)&&r(t.from,o)),s(t.to))},c=function(e){return e.contains("|")},Array.isArray(t.references)&&t.references.forEach(r=>{var c,u;if(s(r.resourceid,P)){e.is(r.resourceid)&&(r.physicalid=r.resourceid,delete r.resourceid),u=(c=i.translatePredicateToAttribute(r,{type:"entity",fromExpandService:!0})).PID,["CapableResourcesStructureLink","PartialProductImplementLink","PartialProcessImplementLink","DELAssetsStructureLink"].forEach(function(t){const n=l.pathSRParser.parse(r,{isRefRef:!0,type:t});e.is(n)&&(n.isRefRef||"PartialProcessImplementLink"!==n.type?a(n,{toType:P}):a(n,{toType:v}))}),e.is(n)||(-1===t.structureInfos.leafRefs.indexOf(u)?c.queriedForChildren=!0:l._dicoUtils.isAKindOf(c.type,"VPMRepReference")&&(c.queriedForChildren=!0)),o&&(c.directConnectionsFetched=!0,c.queriedForDocuments=!0),d[u]=c,m.add(u)}}),Array.isArray(t.instances)&&t.instances.forEach(t=>{var r,c,d;s(t.resourceid,v)&&(e.is(t.resourceid)&&(t.physicalid=t.resourceid,delete t.resourceid),d=(r=i.translatePredicateToAttribute(t,{type:"relation",fromExpandService:!0})).PID,e.is(t.pathsr)&&(c=l.pathSRParser.parse(t,{isRefRef:!1}),e.is(c)&&a(c,{toType:v})),e.is(n)&&(r.filterQuery=n),o&&(r.directConnectionsFetched=!0),u[d]=r,g.add(d))}),Array.isArray(t.connections)&&t.connections.forEach(n=>{var o,r,c,d,u,f;if("SpecificationDocument"===(n=n||{}).type||"Reference Document"===n.type){const e=n["to.physicalid"],t=n["from.physicalid"];s(t)&&(p[t]instanceof Array||(p[t]=[]),p[t].push({PID:e,type:n.type}))}else e.is(n.resourceid)&&(n.physicalid=n.resourceid,delete n.resourceid),r=l.pathSRParser.parse(n,{type:n.type}),o=i.translatePredicateToAttribute(n,{type:"entity",fromExpandService:!0}),"MfgProcessAlternate"!==(o=e.merge(o,i.translatePredicateToAttribute(n,{type:"relation"}))).type&&"MustBeMadeFrom"!==o.type||(r={isRefRef:!0},o.from=n["from.physicalid"],o.to=n["to.physicalid"]),e.is(r)&&(e.is(r.type)&&(o.type=r.type),e.is(r.PID)&&(o.PID=r.PID),e.is(r.from)&&(o.from=r.from),e.is(r.to)&&(o.to=r.to),u=o.from,r.isRefRef&&"SecondaryCandidateResourceLink"===r.type&&(f=t.connections.find(e=>"DELAsmProcessCanUseCnx"===e.type&&e.resourceid===u),e.is(f)&&(f=l.pathSRParser.parse(f,{type:f.type}),u=f.from)),s(u)&&("PLMDocConnection"===r.type?(c=o.to,d=o.from,s(d)&&(p[d]instanceof Array||(p[d]=[]),p[d].push({PID:c,type:"PLMDocConnection"}))):("ProcessImplementLinkOcc"===r.type?o["PLMEntity.V_usage"]=l._validateUsageValue(o["PLMEntity.V_usage"]):r.type,r.isRefRef?"SecondaryCandidateResourceLink"===r.type?a(o,{toType:P,fromType:I}):a(o,{toType:P,fromType:P}):a(o,{toType:v,fromType:v}))))}),r},_parseProgressiveExpandResult:function(t,n){var i=this,r=null,s=[],a=new Set,c=[],l=[],d=new Set,u=[],f=[],p=[],m=[],g=[],h=new Set,y=new Set;return"string"==typeof t?r=JSON.parse(t):"object"==typeof t&&null!==t&&(r=t),e.is(r)&&e.is(r.results,"array")&&r.results.forEach(function(e){var t,n;Object.prototype.hasOwnProperty.call(e,"type")?(t=e.type,n=e.resourceid,i._dicoUtils.isEntityReference(t)&&!i._dicoUtils.isEntityDocument(t)?(s.push(e),c.push(n)):i._dicoUtils.isEntityInstance(t)?(l.push(e),u.push(n)):i._dicoUtils.isEntityConnection(t)||"SpecificationDocument"===t||"Reference Document"===t?f.push(e):i._dicoUtils.isEntityDocument(t)&&p.push(e)):Object.prototype.hasOwnProperty.call(e,"Path")?m.push(e.Path):o.warn("ProgressiveExpand._parseProgressiveExpandResult Unsupported element: "+JSON.stringify(e))}),m.length>0&&(g=[],m.forEach(e=>{var t=[];e.every((e,n)=>(n%2==0&&c.indexOf(e)>-1?t.push(e):u.indexOf(e)>-1&&t.push(e),t.length===n+1)),t.length>0&&g.push(t)}),g.forEach(e=>{var t;t=-1===n?e.length:2*n+1,e.forEach((e,i)=>{i<t&&(i%2==0?(a.add(e),-1!==n&&i===t-1?y.add(e):h.add(e)):d.add(e))})})),y=Array.from(y),h=Array.from(h),y=y.filter(e=>-1===h.indexOf(e)),{references:s,instances:l,connections:f,documents:p,structureInfos:{references:Array.from(a),instances:Array.from(d),leafRefs:y}}},progressiveExpandOnIndex:function(i,o,r){var s,a,c,l,d,u,f,p,m,g,h,y,P,v,I=t.get3DSpaceUrl()+"cvservlet/progressiveexpand/v2?output_format=cvjson",_=this.getSelectPredicate("entity"),S=this.getSelectPredicate("relation"),R=!0;r=r||{},e.is(r.selectBo,"array")&&(_=r.selectBo),e.is(r.selectRel,"array")&&(S=r.selectRel),e.is(r.filterQuery,"object")&&(a=r.filterQuery),e.is(r.withLinks,"boolean")&&(R=r.withLinks),c={batch:{expands:[]},outputs:{format:"entity_relation_occurrence",select_object:_,select_relation:S}},f=[],p=["types/VPMCfgEffectivity"],m=["reltypes/PLMCoreInstance","reltypes/PLMCoreRepInstance"],g=[],R&&(m=m.concat(["types/PLMConnection","reltypes/VPLMrel_47_PLMConnection_47_V_Owner","reltypes/VPLMrel_47_PLMPort_47_V_Owner","reltypes/MfgProcessAlternate","reltypes/Reference Document","reltypes/SpecificationDocument"]),_.push("pathsr"),S.push("pathsr")),h=Array.isArray(r.includeBOTypes)?r.includeBOTypes:f,y=Array.isArray(r.excludeBOTypes)?r.excludeBOTypes:p,P=Array.isArray(r.includeRelationTypes)?r.includeRelationTypes:m,v=Array.isArray(r.excludeRelationTypes)?r.excludeRelationTypes:g,u=h.map(e=>"(flattenedtaxonomies:"+e+")"),l=u.join(" OR "),y.length>0&&(l=""!==l?"( "+l+" ) AND ":l,u=y.map(e=>"(flattenedtaxonomies:"+e+")"),l=l+" NOT ( "+u.join(" OR ")+" )"),u=P.map(e=>"(flattenedtaxonomies:"+e+")"),d=u.join(" OR "),v.length>0&&(d=""!==d?"( "+d+" ) AND ":d,u=v.map(e=>"(flattenedtaxonomies:"+e+")"),d=d+" NOT ( "+u.join(" OR ")+" )"),s=n.getCVServletLabel(),(i=i instanceof Array?i:[i]).forEach(t=>{var n;n={label:s+"_"+t,root:{physical_id:t}},e.is(a)?n.filter=a:-1===r.expandIter?n.filter={all:1}:(n.filter={prefix_filter:{prefix_path:[{physical_id_path:[t]}]}},n.aggregation_processors=[{truncate:{max_distance_from_prefix:R?r.expandIter+1:r.expandIter,prefix_filter:{prefix_path:[{physical_id_path:[t]}]}}}]),n.graph={descending_condition_object:{uql:l},descending_condition_relation:{uql:d}},c.batch.expands.push(n)}),c=e.Json.encode(c),t.webServiceRequest({url:I,method:"POST",headers:t.getHeaders({isJsonOnly:!0}),data:c,onComplete:function(e){o instanceof Function&&o.call(r.context,e)},onFailure:function(e){r.onFailure instanceof Function&&r.onFailure.call(r.context,e)}})},progressiveExpandPromise:function(t,i){var o=this,r=i||{};return new Promise(function(i){var s,a,c,l;a=isNaN(r.expandLevel)?n.getPrefExpandLevel():r.expandLevel,c=e.is(r.filterQuery)?r.filterQuery:null,s=!e.is(r.withLinks,"boolean")||r.withLinks,l=function(e){var t,n;t=o._parseProgressiveExpandResult(e,r.expandIter),n=o._computeStackedObjectsFromProgressiveExpandResult(t,c,s),i(n)},t.length>0?o.progressiveExpandOnIndex(t,l,e.extend(r,{context:o,expandIter:a})):i()})}}}),define("DS/DELPPWNavigationServices/OrganizationTitleServices",["UWA/Class","DS/DELPPWWebServices/WebserviceUtils"],function(e,t){"use strict";return e.singleton({_organizationMap:new Map,getOrganizationMap:function(){return this._organizationMap},updateOrganizationValue:function(e,n){var i=this;t.webServiceRequest({url:"dsmfg/private/V0/invoke/getOrganizationTitle",method:"POST",headers:t.getHeaders({isJsonOnly:!0}),data:UWA.Json.encode(e),onComplete:function(e){var t;if(UWA.is(n,"array"))for(var o=0;o<n.length;o++)t=n[o].attributes.organization,UWA.is(t)&&UWA.is(e[t])&&(n[o].attributes.organization=e[t],i._organizationMap.set(t,e[t]));else n.attributes.organization=e[t]}})},getOrganizationNames:function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n].attributes.organization;UWA.is(i)&&(UWA.is(this._organizationMap.get(i))?e[n].attributes.organization=this._organizationMap.get(i):-1===t.indexOf(i)&&t.push(i))}return t}})}),define("DS/DELPPWNavigationServices/NavigateOnIndex",["UWA/Core","DS/DELPPWNavigationServices/NavigationBase","DS/DELPPWNavigationServices/ProgressiveExpandExt","DS/DELPPWNavigationServices/PathSRParser","DS/DELPPWWebServices/WebserviceUtils","DS/DELPPWIndexServices/IndexParser","DS/DELPPWResourceServices/ResourceUtils","DS/DELPPWModelServices/ModelUtils","DS/DELPPWLoggerModel/LoggerUtils","DS/DELPPWNavigationServices/OrganizationTitleServices"],function(e,t,n,i,o,r,s,a,c,l){"use strict";const d=["DELLmiTimeConstraintQuantityDistribution","DELLmiTimeConstraintAlternative","DELLmiTimeConstraintFailed","DELLmiTimeConstraintScrapped"];var u=function(e){var t=Array.isArray(e)?e:[e],n="";for(let e=0;e<t.length;e++){if(-1!==d.indexOf(t[e])){n=t[e];break}}return n};return t.extend(n,{_selectFacet:[],_computeBo:[],_selectPredicates:{},FETCH_CHUNK_SIZE:1e3,_dicoUtils:null,init:function(e){if(e=e||{},this._parent(e),this.selectPredicates={},!e.dicoUtils)throw new Error("dicoUtils option not defined");this._dicoUtils=e.dicoUtils,this.pathSRParser=new i},_validateUsageValue:function(e){var t=this._dicoUtils.getTypeExtnInfo("ProcessImplementLinkOcc");return e=1===(e=(e=Array.isArray(e)?e:[e]).filter(function(e){return-1===t.indexOf(e)})).length?e[0]:null},getSelectUnit:function(t,n){var i,o,a=this,c=r.translatePredicateToAttribute(t,n),l={};return c.forEach(function(t){var n,c,d=null;if(o=a._dicoUtils.getAttributeInfo(t),e.is(o)&&(!e.is(o.HasRangeDefined)||"Yes"!==o.HasRangeDefined)&&(n=o.Magnitude,e.is(n)&&""!==n))if(""!==(c=o.ManipulationUnit))d=c;else{let t=widget.getPreference(n);d=e.is(t)&&"hidden"!==t.type?t.value:null}null!==d&&(i=r.getPredicate(t),e.is(i)&&(l[i]=s.getLabelForUnit(o.Magnitude,d)))}),l},fetchRoot:function(t,n){var i=this,o=n||{},r=e.is(o.context)?o.context:null,s=e.is(o.onComplete,"function")?o.onComplete:null,a=e.is(o.onFailure,"function")?o.onFailure:null,c=e.merge({onComplete:function(t){var o,c,l=function(t){var o=i.collectionUtils.addRef(t.attributes,n);return e.is(t.ds6w)&&o.setAdditionalInfo({ds6w:t.ds6w}),o};e.is(t)?e.is(t,"array")?0===t.length?a():(c=t.map(l),e.is(s,"function")&&s.call(r,c)):e.is(t.attributes)&&e.is(t.attributes.PID)?(o=l(t),e.is(s,"function")&&s.call(r,o)):a():a()},onFailure:a},o);i.fetchOnIndex(t,c)},fetchOnIndex:function(t,n){var i=o.get3DSpaceUrl()+"cvservlet/fetch/v2",s=n||{},c=e.is(s.type,"string")?s.type:"entity",d=e.is(s.context)?s.context:null,u=e.is(t)?e.is(t,"array")?t:[t]:null,f=!e.is(s.translateResult)||s.translateResult,p=e.is(s.select_predicate)?s.select_predicate:this.getSelectPredicate(c),m=this.getSelectUnit(p,n),g=!e.is(s.withSynthesisAttribute,"boolean")||s.withSynthesisAttribute,h={label:a.getCVServletLabel(),physicalid:u,select_predicate:p,locale:widget.locale,lang:widget.lang,select_unit:m,with_synthesis_attribute:g};o.webServiceRequest({url:i,method:"POST",headers:o.getHeaders({isJsonOnly:!0}),data:e.Json.encode(h),options:n,onComplete:function(t){var n,i,o=[];e.is(t)&&e.is(t.results)&&(n=e.is(t.results,"array")?t.results:null),e.is(n,"array")&&n.forEach(function(t){var n,i=r.parseFetchResult(t);f&&(n=r.translatePredicateToAttribute(i.attributes,{type:c}),e.merge(n,r.translatePredicateToAttribute(i.ds6w,{type:c,fromExpandService:!0})),i.attributes=n),o.push(i)}),(i=l.getOrganizationNames(o)).length>0&&l.updateOrganizationValue(i,o),e.is(s.onComplete,"function")&&(o=o.length>0?o.length>1?o:o[0]:[],s.onComplete.call(d,o))},onFailure:function(t){e.is(s.onFailure,"function")&&s.onFailure.call(d,t)}})},setSelectPredicate:function(t,n){var i,o,s=e.is(this.mandatoryPredicates)&&e.is(this.mandatoryPredicates.refMandatoryAttributes,"array")?this.mandatoryPredicates.refMandatoryAttributes:["PID","type","reserved","V_Name","PLM_ExternalID","V_discipline","V_usage","description","V_MaterialNeed","interface","V_IsPreferred","V_SequencingMode"],a=e.is(this.mandatoryPredicates)&&e.is(this.mandatoryPredicates.instMandatoryAttributes,"array")?this.mandatoryPredicates.instMandatoryAttributes:["PID","type","reserved","V_Name","PLM_ExternalID","V_discipline","V_usage","isAggregatedBy","isInstanceOf","V_TreeOrder"];s.forEach(function(e){-1===n.boAttrName.indexOf(e)&&n.boAttrName.push(e)}),a.forEach(function(e){-1===n.roAttrName.indexOf(e)&&n.roAttrName.push(e)}),i=e.is(this._selectPredicates[t])?this._selectPredicates[t]:{},o={entity:r.translateAttributeToPredicate(n.boAttrName,{type:"entity"}),relation:r.translateAttributeToPredicate(n.roAttrName,{type:"relation"})},e.is(i.entity)||e.is(i.relation)?(o.entity.forEach(function(e){-1===i.entity.indexOf(e)&&i.entity.push(e)}),o.relation.forEach(function(e){-1===i.relation.indexOf(e)&&i.relation.push(e)}),this._selectPredicates[t]=i):this._selectPredicates[t]=o},getSelectPredicate:function(e,t){var n=[],i=this._selectPredicates;if(e=e||"entity",t)switch(e){case"entity":n=i[t].entity;break;case"relation":n=i[t].relation}else switch(e){case"entity":Object.keys(i).forEach(function(e){var t=i[e].entity;Object.keys(t).map(function(e){return t[e]}).forEach(function(e){-1===n.indexOf(e)&&n.push(e)})});break;case"relation":Object.keys(i).forEach(function(e){var t=i[e].relation;Object.keys(t).map(function(e){return t[e]}).forEach(function(e){-1===n.indexOf(e)&&n.push(e)})})}return n},navigateScopes:function(t,n,i){var o={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}},r=i||{},s=this,a=!1;r=e.merge(r,{callback:n}),t.length>0?this.getProductScopedLinks(t,function(t){var n;e.is(t)&&e.is(t.result,"array")&&e.is(t.result[0])&&(n=t.result[0].outputs.scopes,e.is(n)&&n.forEach(function(e){o.stackedReferences.push(e),a=!0})),!0===a?s._addToCollections(o,r):r.callback(null)},e.extend(i,{context:this})):n(null)},getReferenceFromInstance:function(t,n,i){var r,s,c,l=o.get3DSpaceUrl()+"cvservlet/navigate?SecurityContext="+o.getSecurityContext(),d=[],u={},f=this.getSelectPredicate("entity").concat(this.getSelectPredicate("relation"));for(r=f.length;r--;)u[c=f[r]]||(d.unshift(c),u[c]=!0);i=i||{},t instanceof Array||(t=[t]),i.selectBo instanceof Array&&(d=i.selectBo),d.push("pathsr"),s={label:a.getCVServletLabel(),input_physical_ids:t,primitives:[{navigate_from_rel:{id:1},navigate_to_rel:{id:2}}],patterns:{refsFrom:[{id:1}],refsTo:[{id:2}]},patternTypeFilters:{scopes:{typesToNotReturn:["PLMCoreInstance"],filterLinksOn:"elements"}},attributes:d,fileAttributes:[],version:3},e.is(i.expandIter,"string")&&(s.expand_iter=i.expandIter),s=e.Json.encode(s),o.webServiceRequest({url:l,method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:s,onComplete:function(e){n instanceof Function&&n.call(i.context,e)},onFailure:function(e,t){i.onFailure instanceof Function&&i.onFailure(t)}})},getProductScopedLinks:function(t,n,i){var r,s,c,l=o.get3DSpaceUrl()+"cvservlet/navigate?SecurityContext="+o.getSecurityContext(),d=[],u={},f=this.getSelectPredicate("entity").concat(this.getSelectPredicate("relation"));for(r=f.length;r--;)u[c=f[r]]||(d.unshift(c),u[c]=!0);i=i||{},t instanceof Array||(t=[t]),i.selectBo instanceof Array&&(d=i.selectBo),d.push("pathsr"),s={label:a.getCVServletLabel(),input_physical_ids:t,primitives:[{navigate_from_sr:{id:1,mode:"contains",filter:{role:["51"],category:["5"]}},navigate_from_rel:{id:2}}],patterns:{scopes:[{id:1},{id:2}]},patternTypeFilters:{scopes:{typesToNotReturn:["PLMCoreInstance"],filterLinksOn:"elements"}},attributes:d,fileAttributes:[],version:3},e.is(i.expandIter,"string")&&(s.expand_iter=i.expandIter),s=e.Json.encode(s),o.webServiceRequest({url:l,method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:s,onComplete:function(e){n instanceof Function&&n.call(i.context,e)},onFailure:function(e,t){i.onFailure instanceof Function&&i.onFailure(t)}})},navigateOnIndex:function(t,n,i){var r,s,c,l=o.get3DSpaceUrl()+"cvservlet/navigate?SecurityContext="+o.getSecurityContext(),d=[],u={},f=this.getSelectPredicate("entity").concat(this.getSelectPredicate("relation"));for(r=f.length;r--;)u[c=f[r]]||(d.unshift(c),u[c]=!0);i=i||{},t instanceof Array||(t=[t]),i.selectBo instanceof Array&&(d=i.selectBo),d.push("pathsr"),s={label:a.getCVServletLabel(),input_physical_ids:t,primitives:[{navigate_to_sr:{id:1,filter:{role:["52"],category:["7"]},mode:"path"},navigate_from_sr:{id:2,mode:"ends",filter:{role:["52"],category:["7"]}}},{navigate_to_sr:{id:3,filter:{role:["51"],category:["5"]},mode:"path"},navigate_from_sr:{id:4,mode:"ends",filter:{role:["51"],category:["5"]}}},{navigate_to_sr:{id:5,filter:{role:["203"],category:["5"]},mode:"path"},navigate_from_sr:{id:6,filter:{role:["203"],category:["5"]}}},{navigate_to_sr:{id:7,filter:{role:["204"],category:["6"]},mode:"path"},navigate_from_sr:{id:8,filter:{role:["204"],category:["6"]}}},{navigate_to_sr:{id:9,filter:{role:["296"],category:["1"]},mode:"path"},navigate_from_sr:{id:10,filter:{role:["296"],category:["1"]}}},{navigate_to_sr:{id:11,filter:{role:["363"],category:["1"]},mode:"path"},navigate_from_sr:{id:12,filter:{role:["363"],category:["1"]}}},{navigate_to_rel:{id:13,filter:{rel_type:["MfgProcessAlternate"]},mode:"return_rel"},navigate_from_rel:{id:14,filter:{rel_type:["MfgProcessAlternate"]},mode:"return_rel"}},{navigate_to_rel:{id:15,filter:{rel_type:["VPLMrel_47_PLMPort_47_V_Owner"]}},navigate_from_rel:{id:16,filter:{rel_type:["VPLMrel_47_PLMPort_47_V_Owner"]},mode:"return_rel"}},{navigate_to_sr:{id:17,filter:{role:["296"],category:["1"]}}},{navigate_to_sr:{id:18,filter:{role:["308"],category:["7"]},mode:"path"},navigate_from_sr:{id:19,filter:{role:["308"],category:["7"]}}},{navigate_to_sr:{id:20,filter:{role:["307"],category:["5"]},mode:"path"},navigate_from_sr:{id:21,filter:{role:["307"],category:["5"]}}},{navigate_to_rel:{id:22,filter:{rel_type:["VPLMrel_47_PLMConnection_47_V_Owner"]}},navigate_to_sr:{id:23,filter:{role:["87"],category:["1"]},mode:"path"}},{navigate_to_sr:{id:24,filter:{role:["248"],category:["1"]},mode:"path"},navigate_from_sr:{id:25,mode:"ends",filter:{role:["248"],category:["1"]}}},{navigate_to_sr:{id:26,filter:{role:["249"],category:["1"]},mode:"path"},navigate_from_sr:{id:27,mode:"ends",filter:{role:["249"],category:["1"]}}},{navigate_to_sr:{id:28,filter:{role:["295"],category:["1"]},mode:"path"},navigate_from_sr:{id:29,filter:{role:["295"],category:["1"]}}},{navigate_to_sr:{id:30,filter:{role:["294"],category:["1"]},mode:"path"},navigate_from_sr:{id:31,filter:{role:["294"],category:["1"]}}},{navigate_to_sr:{id:32,filter:{role:["461"],category:["1"]},mode:"path"},navigate_from_sr:{id:33,filter:{role:["461"],category:["1"]}}},{navigate_to_sr:{id:34,filter:{role:["247"],category:["1"]},mode:"path"},navigate_from_sr:{id:35,filter:{role:["247"],category:["1"]}}},{navigate_to_sr:{id:36,filter:{role:["490"],category:["1"]},mode:"path"},navigate_from_sr:{id:37,mode:"ends",filter:{role:["490"],category:["1"]}}},{navigate_to_sr:{id:38,filter:{role:["51"],category:["5"]},mode:"last"}},{navigate_to_sr:{id:39,filter:{role:["51"],category:["1"]},mode:"path"},navigate_from_sr:{id:40,mode:"ends",filter:{role:["51"],category:["1"]}}},{navigate_to_sr:{id:41,filter:{role:["416"],category:["9"]},mode:"path"},navigate_from_sr:{id:42,filter:{role:["416"],category:["9"]}}},{navigate_to_sr:{id:43,filter:{role:["417"],category:["6"]},mode:"path"},navigate_from_sr:{id:44,filter:{role:["417"],category:["6"]}}},{navigate_to_sr:{id:45,filter:{role:["418"],category:["9"]},mode:"path"},navigate_from_sr:{id:46,filter:{role:["418"],category:["9"]}}},{navigate_to_sr:{id:47,filter:{role:["419"],category:["6"]},mode:"path"},navigate_from_sr:{id:48,filter:{role:["419"],category:["6"]}}}],patterns:{scope_pathSR:[{id:2},{id:3}],scopeInverse_pathSR:[{id:4},{id:1}],partialScope_pathSR:[{id:38}],partialScopeInverse_pathSR:[{id:4}],HeaderOperationPartialScope_pathSR:[{id:39}],HeaderOperationPartialScopeInverse_pathSR:[{id:40}],candidateResource_pathSR:[{id:6},{id:7}],candidateResourceInverse_pathSR:[{id:8},{id:5}],SecondaryResource_pathSR:[{id:33},{id:34}],SecondaryResourceInverse_pathSR:[{id:35},{id:32}],capableResourcesStructure_pathSR:[{id:36}],capableResourcesStructureInverse_pathSR:[{id:37}],mbomSystemOutput_pathSR:[{id:15},{id:10},{id:11}],mbomSystemOutputInverse_pathSR:[{id:12},{id:9}],mbomSystemOutputInverse_relation:[{id:12},{id:17},{id:16}],mbomOperationOutput_pathSR:[{id:10},{id:11}],mbomOperationOutputInverse_pathSR:[{id:12},{id:9}],alternate_relation:[{id:13}],alternateInverse_relation:[{id:14}],historization_pathSR:[{id:19},{id:20}],historizationInverse_pathSR:[{id:21},{id:18}],MfgResponsibility_pathSR:[{id:42},{id:43}],MfgResponsibilityInverse_pathSR:[{id:44},{id:41}],MfgSubstitute_pathSR:[{id:46},{id:47}],MfgSubstituteInverse_pathSR:[{id:48},{id:45}],document_pathSR:[{id:22},{id:23}],productFlow_pathSR:[{id:25},{id:26}],productFlowInverse_pathSR:[{id:27},{id:24}],productMbomImplement_pathSR:[{id:3}],productMbomImplementInverse_pathSR:[{id:4}],Material_pathSR:[{id:29},{id:30}],MaterialInverse_pathSR:[{id:31},{id:28}],operationProcessImplement_pathSR:[{id:2},{id:3}],operationProcessImplementInverse_pathSR:[{id:4},{id:1}]},patternTypeFilters:{mbomSystemOutputInverse_pathSR:{typesReturn:["DELLmiProdSystemIOPort"]},mbomOperationOutputInverse_pathSR:{typesToNotReturn:["DELLmiProdSystemIOPort"]},productMbomImplement_pathSR:{typesToNotReturn:["PLMCoreReference"]},productMbomImplementInverse_pathSR:{typesToNotReturn:["DELFmiProcessImplementCnx","DELFmiFunctionIdentifiedInstance","MfgProductionPlanning","PLMCoreReference"]},scope_pathSR:{typesToNotReturn:["PLMCoreInstance"],filterLinksOn:"elements"},scopeInverse_pathSR:{typesToNotReturn:["PLMCoreInstance"],filterLinksOn:"elements"},partialScope_pathSR:{typesToReturn:["VPMReference"]},partialScopeInverse_pathSR:{typesToNotReturn:["DELFmiProcessImplementCnx","PLMCoreInstance","MfgProductionPlanning","DELLmiHeaderOperationReference"],filterLinksOn:"elements"},HeaderOperationPartialScope_pathSR:{typesToNotReturn:["VPMReference"],filterLinksOn:"elements"},HeaderOperationPartialScopeInverse_pathSR:{typesToReturn:["DELLmiHeaderOperationReference"]},operationProcessImplement_pathSR:{typesToNotReturn:["PLMCoreReference"],filterLinksOn:"elements"},operationProcessImplementInverse_pathSR:{typesToNotReturn:["PLMCoreReference"],filterLinksOn:"elements"}},attributes:d,fileAttributes:[],version:3},e.is(i.expandIter,"string")&&(s.expand_iter=i.expandIter),s=e.Json.encode(s),o.webServiceRequest({url:l,method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:s,onComplete:function(e){n instanceof Function&&n.call(i.context,e)},onFailure:function(e,t){i.onFailure instanceof Function&&i.onFailure(t)}})},navigateInverseOnIndex:function(t,n,i){var r,s,c,l=o.get3DSpaceUrl()+"cvservlet/navigate?SecurityContext="+o.getSecurityContext(),d=[],u={},f=this.getSelectPredicate("entity").concat(this.getSelectPredicate("relation"));for(r=f.length;r--;)u[c=f[r]]||(d.unshift(c),u[c]=!0);i=i||{},t instanceof Array||(t=[t]),i.selectBo instanceof Array&&(d=i.selectBo),d.push("pathsr"),s={label:a.getCVServletLabel(),input_physical_ids:t,primitives:[{navigate_to_sr:{id:1,filter:{role:["52"],category:["7"]},mode:"path"}},{navigate_from_sr:{id:4,mode:"ends",filter:{role:["51"],category:["5"]}}},{navigate_to_sr:{id:5,filter:{role:["203"],category:["5"]},mode:"path"}},{navigate_from_sr:{id:8,filter:{role:["204"],category:["6"]}}},{navigate_to_sr:{id:9,filter:{role:["296"],category:["1"]},mode:"path"}},{navigate_from_sr:{id:12,filter:{role:["363"],category:["1"]}}},{navigate_from_rel:{id:14,filter:{rel_type:["MfgProcessAlternate"]},mode:"return_rel"}},{navigate_from_rel:{id:16,filter:{rel_type:["VPLMrel_47_PLMPort_47_V_Owner"]},mode:"return_rel"}},{navigate_to_sr:{id:17,filter:{role:["296"],category:["1"]}}},{navigate_to_sr:{id:18,filter:{role:["308"],category:["7"]},mode:"path"}},{navigate_from_sr:{id:21,filter:{role:["307"],category:["5"]}}},{navigate_to_sr:{id:24,filter:{role:["248"],category:["1"]},mode:"path"}},{navigate_from_sr:{id:27,mode:"ends",filter:{role:["249"],category:["1"]}}},{navigate_to_sr:{id:28,filter:{role:["295"],category:["1"]},mode:"path"}},{navigate_from_sr:{id:31,filter:{role:["294"],category:["1"]}}},{navigate_to_sr:{id:32,filter:{role:["461"],category:["1"]},mode:"path"}},{navigate_from_sr:{id:35,filter:{role:["247"],category:["1"]}}},{navigate_from_sr:{id:37,mode:"ends",filter:{role:["490"],category:["1"]}}},{navigate_from_sr:{id:40,mode:"ends",filter:{role:["51"],category:["1"]}}},{navigate_to_sr:{id:41,filter:{role:["416"],category:["9"]},mode:"path"}},{navigate_from_sr:{id:44,filter:{role:["417"],category:["6"]}}},{navigate_to_sr:{id:45,filter:{role:["418"],category:["9"]},mode:"path"}},{navigate_from_sr:{id:48,filter:{role:["419"],category:["6"]}}},{navigate_from_sr:{id:50,mode:"ends",filter:{role:["486"],category:["1"]}}}],patterns:{scopeInverse_pathSR:[{id:4},{id:1}],partialScopeInverse_pathSR:[{id:4}],HeaderOperationPartialScopeInverse_pathSR:[{id:40}],candidateResourceInverse_pathSR:[{id:8},{id:5}],SecondaryResourceInverse_pathSR:[{id:35},{id:32}],capableResourcesStructureInverse_pathSR:[{id:37}],assetsStructureLinkInverse_pathSR:[{id:50}],mbomSystemOutputInverse_pathSR:[{id:12},{id:9}],mbomSystemOutputInverse_relation:[{id:12},{id:17},{id:16}],mbomOperationOutputInverse_pathSR:[{id:12},{id:9}],alternateInverse_relation:[{id:14}],historizationInverse_pathSR:[{id:21},{id:18}],MfgResponsibilityInverse_pathSR:[{id:44},{id:41}],MfgSubstituteInverse_pathSR:[{id:48},{id:45}],productFlowInverse_pathSR:[{id:27},{id:24}],productMbomImplementInverse_pathSR:[{id:4}],MaterialInverse_pathSR:[{id:31},{id:28}],operationProcessImplementInverse_pathSR:[{id:4},{id:1}]},patternTypeFilters:{mbomSystemOutputInverse_pathSR:{typesReturn:["DELLmiProdSystemIOPort"]},mbomOperationOutputInverse_pathSR:{typesToNotReturn:["DELLmiProdSystemIOPort"]},productMbomImplementInverse_pathSR:{typesToNotReturn:["DELFmiProcessImplementCnx","DELFmiFunctionIdentifiedInstance","MfgProductionPlanning","PLMCoreReference"]},scopeInverse_pathSR:{typesToNotReturn:["PLMCoreInstance","DELLmiHeaderOperationReference"],filterLinksOn:"elements"},partialScopeInverse_pathSR:{typesToNotReturn:["DELFmiProcessImplementCnx","PLMCoreInstance","MfgProductionPlanning","DELLmiHeaderOperationReference"],filterLinksOn:"elements"},HeaderOperationPartialScopeInverse_pathSR:{typesToReturn:["DELLmiHeaderOperationReference"]},operationProcessImplementInverse_pathSR:{typesToNotReturn:["PLMCoreReference"],typesToReturn:["DELLmiHeaderOperationReference"],filterLinksOn:"elements"}},attributes:d,fileAttributes:[],version:3},e.is(i.expandIter,"string")&&(s.expand_iter=i.expandIter),s=e.Json.encode(s),o.webServiceRequest({url:l,method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:s,onComplete:function(e){n instanceof Function&&n.call(i.context,e)},onFailure:function(e,t){i.onFailure instanceof Function&&i.onFailure(t)}})},navigateToXCADDrawingsOnIndex:function(t,n,i){var r,s,c,l=o.get3DSpaceUrl()+"cvservlet/navigate?SecurityContext="+o.getSecurityContext(),d=[],u={},f=this.getSelectPredicate("entity").concat(this.getSelectPredicate("relation"));for(r=f.length;r--;)u[c=f[r]]||(d.unshift(c),u[c]=!0);i=i||{},t instanceof Array||(t=[t]),s={label:a.getCVServletLabel(),input_physical_ids:t,primitives:[{navigate_from_rel:{id:99,filter:{rel_type:["XCADBaseDependency"],rel_attrs:[{"ro.xcadbasedependency.v_cadlinktype":"CADDrawing"}]}}}],patterns:{XCAD_Drawing_relation:[{id:99}]},attributes:d,fileAttributes:[],version:3},e.is(i.expandIter,"string")&&(s.expand_iter=i.expandIter),s=e.Json.encode(s),o.webServiceRequest({url:l,method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:s,onComplete:function(e){n instanceof Function&&n.call(i.context,e)},onFailure:function(e,t){i.onFailure instanceof Function&&i.onFailure(t)}})},_navigateXCADDrawingNodes:function(t,n,i,o){o=o||{},t.length>0?this.navigateToXCADDrawingsOnIndex(t,function(t){e.is(t)&&e.is(t.result,"array")&&t.result.forEach(function(t){var i=t.outputs.XCAD_Drawing_relation,o=t.input_object.physicalid;e.is(i,"array")&&i.forEach(function(e){var t,i;(t=r.translatePredicateToAttribute(e)).PID=e.physicalid,t.queriedForConnections=!0,t.queriedForDocuments=!0,t.queriedForChildren=!0,i={type:"FakeInstanceOfDrawing",PID:"Drawing|"+o+"|"+e.physicalid,isAggregatedBy:o,isInstanceOf:e.physicalid,V_TreeOrder:"0"},n.stackedReferences.push(t),n.stackedInstances.push(i)})}),i()},e.extend(o,{context:this})):i()},_getNavigateToXCADDrawingsPromise:function(t,n,i,o){var r=parseInt(widget.getValue("navigateSplitSize")),s=this,a=o||{};return new Promise(function(o,c){var l;l=s.splitIntoChunks(t,r).map(function(e){return new Promise(function(t,n){var i,o={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}};i=function(){t({stackedObjects:o})},a.onFailure=function(){n("Navigate Failure")},s._navigateXCADDrawingNodes(e,o,i,a)})}),Promise.all(l).then(function(t){t.forEach(function(t){e.is(n)&&(n.stackedReferences=n.stackedReferences.concat(t.stackedObjects.stackedReferences),n.stackedInstances=n.stackedInstances.concat(t.stackedObjects.stackedInstances),n.stackedConnections=n.stackedConnections.concat(t.stackedObjects.stackedConnections),n.documentIdMap=e.extend(n.documentIdMap,t.stackedObjects.documentIdMap,!0))}),o(i)}).catch(function(e){"string"==typeof e&&c(e),c("Navigate Error")})})},_getMultipleNavigateOnIndexPromise:function(t,n,i){var o=parseInt(widget.getValue("navigateSplitSize")),r=this,s=i||{};return new Promise(function(i,a){var c,l={},d={},u={};n.stackedReferences.forEach(function(t){l[t.PID]=e.clone(t)}),n.stackedInstances.forEach(function(t){d[t.PID]=e.clone(t)}),n.stackedConnections.forEach(function(t){u[t.PID]=e.clone(t)}),c=r.splitIntoChunks(t,o).map(function(e){return new Promise(function(t,n){var i={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}};e.forEach(function(e){Object.prototype.hasOwnProperty.call(l,e)?i.stackedReferences.push(l[e]):Object.prototype.hasOwnProperty.call(d,e)&&i.stackedInstances.push(d[e])}),s.onFailure=function(){n("Navigate Failure")},r._navigateNodes(e,i,function(e){t({linkedRefIds:e,stackedObjects:i})},s)})}),Promise.all(c).then(function(t){var o,r=[],s={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}};t.forEach(function(t){r=r.concat(t.linkedRefIds),s.stackedReferences=s.stackedReferences.concat(t.stackedObjects.stackedReferences),s.stackedInstances=s.stackedInstances.concat(t.stackedObjects.stackedInstances),s.stackedConnections=s.stackedConnections.concat(t.stackedObjects.stackedConnections),e.merge(s.documentIdMap,t.stackedObjects.documentIdMap)}),o=function(t,n){var i={},o=[];return t.forEach(function(e){i[e.PID]=e}),e.extend(n,i),Object.keys(n).forEach(function(e){o.push(n[e])}),o},n.stackedReferences=o(s.stackedReferences,l),n.stackedInstances=o(s.stackedInstances,d),n.stackedConnections=o(s.stackedConnections,u),e.merge(n.documentIdMap,s.documentIdMap),i(r)}).catch(function(e){"string"==typeof e&&a(e),a("Navigate Error")})})},navigateNodes:function(e,t,n,i){this._getMultipleNavigateOnIndexPromise(e,t,i).then(function(e){n(e)}).catch(function(e){c.error("ERROR: "+e)})},_navigateNodes:function(t,n,i,o){var r=[],s=this;o=o||{},t.length>0?s.navigateOnIndex(t,function(t){e.is(t)&&e.is(t.result,"array")&&s.onNavigatedNodes(t,r,n,!0),i(r)},e.extend(o,{context:this})):i(r)},navigateInverseNodes:function(t,n,i,o){var r=[],s=this,a={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}};o=o||{},t.length>0?this.navigateInverseOnIndex(t,function(t){var o={referenceIds:new Set,instanceIds:new Set},c={referenceConnectionsMap:{},instanceConnectionsMap:{}},l=new Set;e.is(t)&&e.is(t.result,"array")&&this.onNavigatedNodesV2(t,r,o,c,n,!1),this._getStackedConnectionsFromMap(c.referenceConnectionsMap).forEach(function(e){"DELAsmProcessCanUseCnx"===e.type&&l.add(e.PID)}),this.navigateNodes(Array.from(l),a,function(e){a.stackedConnections.forEach(function(e){s._addConnectionToMap(e.to,e,c.referenceConnectionsMap)}),e.forEach(function(e){o.referenceIds.add(e)}),i(o,c)})},e.extend(o,{context:this})):i(r)},onNavigatedNodes:function(t,n,i,o){var s=t.result,a=this,c=function(t,o,s,c,l){var d,u,f,p,m=s.physicalid;l=l||{},a._dicoUtils.isEntityConnection(o.type)&&(a._dicoUtils.isEntityReference(s.type)||a._dicoUtils.isEntityInstance(s.type)||"SecondaryCandidateResourceLink"===o.type&&a._dicoUtils.isEntityConnection(s.type))&&("Document"===s.type&&i.documentIdMap?(i.documentIdMap[t]instanceof Array||(i.documentIdMap[t]=[]),i.documentIdMap[t].push(m)):(o=e.merge(r.translatePredicateToAttribute(o,{type:"entity"}),r.translatePredicateToAttribute(o,{type:"relation"})),c?(o.from=t,o.to=m):(o.from=m,o.to=t),"ProductImplementLinkOcc"===o.type?l.occurencePath&&(c?o.to=l.occurencePath:o.from=l.occurencePath,o.PID="ProductImplementLinkOcc|"+t+"|"+e.Json.encode(l.occurencePath)):"ProcessImplementLinkOcc"===o.type?(e.is(l.owner)&&e.is(l.owner.pathsr)&&(u=a.getPathsFromSR(l.owner.pathsr),e.is(u)&&e.is(u.from)&&(t=d=u.from),e.is(u)&&e.is(u.to)&&(f=u.to)),l.occurencePath&&(c?(o.to=l.occurencePath,e.is(d)&&(o.from=d)):(o.from=l.occurencePath,e.is(f)&&(o.to=f))),o.V_usage=a._validateUsageValue(o.V_usage)):"DELLmiTimeConstraintCnx"===o.type?e.is(l.owner)&&e.is(l.owner.pathsr)&&(u=a.getPathsFromSR(l.owner.pathsr),e.is(u)&&e.is(u.from)&&(d=u.from),e.is(u)&&e.is(u.to)&&(f=u.to),o.from=d,o.to=f):"CapableResourcesStructureLink"!==o.type&&"SystemImplementLink"!==o.type&&"PartialProductImplementLink"!==o.type&&"ProductImplementLink"!==o.type&&"ProcessImplementLink"!==o.type&&"PartialProcessImplementLink"!==o.type||(o.PID=o.type+"|"+o.from+"|"+o.to),i.stackedConnections.push(o),a._dicoUtils.isEntityReference(s.type)&&-1===n.indexOf(m)?n.push(m):a._dicoUtils.isEntityInstance(s.type)&&!a.collectionUtils.isInstance(m)&&Object.prototype.hasOwnProperty.call(s,"from.physicalid")&&(p=s["from.physicalid"],e.is(p)&&-1===n.indexOf(p)&&n.push(p))))};s.forEach(function(t){var r,s,l,d,u,f,p,m,g,h=t.outputs,y=t.input_object.physicalid;for(m=0,g=i.stackedReferences.length;m<g;m++)if((f=i.stackedReferences[m]).PID===y){o?(f.queriedForConnections=!0,f.queriedForDocuments=!0):f.inverseConnectionsFetched=!0;break}for(m=0,g=i.stackedInstances.length;m<g;m++)if((p=i.stackedInstances[m]).PID===y){o?p.queriedForConnections=!0:p.inverseConnectionsFetched=!0;break}for(r in h)Object.prototype.hasOwnProperty.call(h,r)&&(s=h[r],u=-1===r.indexOf("Inverse"),-1!==r.indexOf("_pathSR")?s.forEach(function(t){var o,s;t&&-1!==r.indexOf("capableResourcesStructure")?(d={type:"CapableResourcesStructureLink"},l=t.elements?t.elements[0]:t,c(y,d,l,u)):e.is(t)&&r.includes("partialScope")?c(y,d={type:"PartialProductImplementLink"},l=t,u):t&&-1!==r.indexOf("HeaderOperationPartialScope")?(d={type:"PartialProcessImplementLink"},l=t.elements?t.elements[0]:t,c(y,d,l,u)):t&&t.elements&&(-1!==r.indexOf("productMbomImplement")?(o=t.elements.map(function(e){return e.physicalid}),s=t.elements[t.elements.length-1],c(y,d={type:"ProductImplementLinkOcc"},s,u,{occurencePath:o})):-1!==r.indexOf("operationProcessImplement")?(o=t.elements.map(function(e){return e.physicalid}),s=t.elements[t.elements.length-1],(d=t.owner).type="ProcessImplementLinkOcc",c(y,d,s,u,{occurencePath:o,owner:t.owner})):-1!==r.indexOf("productFlow")?(o=t.elements.map(function(e){return e.physicalid}),s=t.elements[t.elements.length-1],d=t.owner,c(y,d,s,u,{occurencePath:o,owner:t.owner})):-1!==r.indexOf("Material")?(l=null,t.elements.reverse().some(function(e){var t=!1;return a._dicoUtils.isEntityInstance(e.type)&&(l=e,t=!0),t}),e.is(l)&&(d=t.owner,c(y,d,l,u))):(l=t.elements[0],d=t.owner,c(y,d,l,u),"DELAsmProcessCanUseCnx"===l.type&&(d=a.parsePrimaryLinkFromLinkedObj(l,i),n.push(d.from),n.push(d.to))))}):-1!==r.indexOf("_relation")&&s.forEach(function(e){var t,n;-1!==r.indexOf("alternate")?(d=e,l=u?e.to:e.from,delete e["from.physicalid"],delete e["to.physicalid"],c(y,d,l,u)):-1!==r.indexOf("mbomSystemOutput")&&(t=r.split("_relation")[0],n=h[t+"_pathSR"],l=e.from,n&&(n.forEach(function(t){t&&t.elements&&t.elements[0].physicalid===e.to.physicalid&&(d=t.owner)}),d&&c(y,d,l,u)))}))})},onNavigatedNodesV2:function(t,n,i,o,s,a){var c=t.result,l=this,d=function(t,a,c,d,u){var f,p,m,g,h,y,P,v,I=c.physicalid;u=u||{},l._dicoUtils.isEntityConnection(a.type)&&(l._dicoUtils.isEntityReference(c.type)||l._dicoUtils.isEntityInstance(c.type)||"SecondaryCandidateResourceLink"===a.type&&l._dicoUtils.isEntityConnection(c.type))&&("Document"===c.type&&s.documentIdMap?(s.documentIdMap[t]instanceof Array||(s.documentIdMap[t]=[]),s.documentIdMap[t].push(I)):(y="PartialProcessImplementLink"===a.type?c.pathsr:a.pathsr,a=e.merge(r.translatePredicateToAttribute(a,{type:"entity"}),r.translatePredicateToAttribute(a,{type:"relation"})),d?(a.from=t,a.to=I):(a.from=I,a.to=t),"ProductImplementLinkOcc"===a.type?u.occurencePath&&(d?a.to=u.occurencePath:a.from=u.occurencePath,a.PID="ProductImplementLinkOcc|"+t+"|"+e.Json.encode(u.occurencePath)):"ProcessImplementLinkOcc"===a.type?(e.is(u.owner)&&e.is(u.owner.pathsr)&&(p=l.getPathsFromSR(u.owner.pathsr),e.is(p)&&e.is(p.from)&&(t=f=p.from),e.is(p)&&e.is(p.to)&&(m=p.to)),u.occurencePath&&(d?(a.to=u.occurencePath,e.is(f)&&(a.from=f)):(a.from=u.occurencePath,e.is(m)&&(a.to=m))),a.V_usage=l._validateUsageValue(a.V_usage)):"DELLmiTimeConstraintCnx"===a.type?e.is(u.owner)&&e.is(u.owner.pathsr)&&(p=l.getPathsFromSR(u.owner.pathsr),e.is(p)&&e.is(p.from)&&(f=p.from),e.is(p)&&e.is(p.to)&&(m=p.to),a.from=f,a.to=m):"CapableResourcesStructureLink"===a.type||"SystemImplementLink"===a.type||"PartialProductImplementLink"===a.type||"ProductImplementLink"===a.type||"DELAssetsStructureLink"===a.type?a.PID=a.type+"|"+a.from+"|"+a.to:"ProcessImplementLink"===a.type?(h=l.getPathsFromSR(y).to,Array.isArray(h)&&2===h.length&&!y.contains("R_590")?(a.to=h,a.PID=a.type+"|"+a.from+"|"+a.to[0]):a.PID=a.type+"|"+a.from+"|"+a.to,y.contains("R_590")&&(v=l.getUsagePointsTargetsFromPathSR(y),e.is(v)&&(a.usagePoint=v))):"PartialProcessImplementLink"===a.type&&(P=(h=l.getPartialScopeTargetsFromPathSR(y)).find(e=>e.some(e=>e===a.to)),e.is(P)&&2===P.length?(a.to=P,a.PID=a.type+"|"+a.from+"|"+a.to[0]):a.PID=a.type+"|"+a.from+"|"+a.to),s.stackedConnections.push(a),"SecondaryCandidateResourceLink"===a.type?l._addConnectionToMap(a.to,a,o.referenceConnectionsMap):l._dicoUtils.isEntityReference(c.type)?(Array.isArray(a.to)&&2===a.to.length?(a.to=a.to[0],l._addConnectionToMap(a.to,a,o.instanceConnectionsMap),i.instanceIds.add(a.to)):l._addConnectionToMap(a.to,a,o.referenceConnectionsMap),-1===n.indexOf(I)&&(n.push(I),i.referenceIds.add(I))):l._dicoUtils.isEntityInstance(c.type)&&(l._addConnectionToMap(a.to,a,o.instanceConnectionsMap),i.instanceIds.add(I),!l.collectionUtils.isInstance(I)&&Object.prototype.hasOwnProperty.call(c,"from.physicalid")&&(g=c["from.physicalid"],e.is(g)&&-1===n.indexOf(g)&&n.push(g)))))};c.forEach(function(t){var n,r,c,u,f,p,m,g,h,y=t.outputs,P=t.input_object.physicalid;for(g=0,h=s.stackedReferences.length;g<h;g++)if((p=s.stackedReferences[g]).PID===P){a?(p.queriedForConnections=!0,p.queriedForDocuments=!0):p.inverseConnectionsFetched=!0;break}for(g=0,h=s.stackedInstances.length;g<h;g++)if((m=s.stackedInstances[g]).PID===P){a?m.queriedForConnections=!0:m.inverseConnectionsFetched=!0;break}for(n in y)Object.prototype.hasOwnProperty.call(y,n)&&(r=y[n],f=-1===n.indexOf("Inverse"),-1!==n.indexOf("_pathSR")?r.forEach(function(t){var r,a;t&&-1!==n.indexOf("capableResourcesStructure")?d(P,u={type:"CapableResourcesStructureLink"},c=t,f):t&&-1!==n.indexOf("assetsStructureLink")?d(P,u={type:"DELAssetsStructureLink"},c=t,f):e.is(t)&&n.includes("partialScope")?d(P,u={type:"PartialProductImplementLink"},c=t,f):t&&-1!==n.indexOf("HeaderOperationPartialScope")?d(P,u={type:"PartialProcessImplementLink"},c=t,f):t&&t.elements&&(-1!==n.indexOf("productMbomImplement")?(r=t.elements.map(function(e){return e.physicalid}),a=t.elements[t.elements.length-1],d(P,u={type:"ProductImplementLinkOcc"},a,f,{occurencePath:r})):-1!==n.indexOf("operationProcessImplement")?(r=t.elements.map(function(e){return e.physicalid}),a=t.elements[t.elements.length-1],(u=t.owner).type="ProcessImplementLinkOcc",d(P,u,a,f,{occurencePath:r,owner:t.owner})):-1!==n.indexOf("productFlow")?(r=t.elements.map(function(e){return e.physicalid}),a=t.elements[t.elements.length-1],u=t.owner,d(P,u,a,f,{occurencePath:r,owner:t.owner})):-1!==n.indexOf("Material")?(c=null,t.elements.reverse().some(function(e){var t=!1;return l._dicoUtils.isEntityInstance(e.type)&&(c=e,t=!0),t}),e.is(c)&&(u=t.owner,d(P,u,c,f))):(c=t.elements[0],u=t.owner,d(P,u,c,f),"DELAsmProcessCanUseCnx"===c.type&&(u=l.parsePrimaryLinkFromLinkedObj(c,s),l._addConnectionToMap(u.to,u,o.referenceConnectionsMap),i.referenceIds.add(u.from),i.referenceIds.add(u.to))))}):-1!==n.indexOf("_relation")&&r.forEach(function(e){var t,i;-1!==n.indexOf("alternate")?(u=e,c=f?e.to:e.from,delete e["from.physicalid"],delete e["to.physicalid"],d(P,u,c,f)):-1!==n.indexOf("mbomSystemOutput")&&(t=n.split("_relation")[0],i=y[t+"_pathSR"],c=e.from,i&&(i.forEach(function(t){t&&t.elements&&t.elements[0].physicalid===e.to.physicalid&&(u=t.owner)}),u&&d(P,u,c,f)))}))})},parsePrimaryLinkFromLinkedObj:function(t,n){var i,o,s;return i={type:{name:"type",value:t.type},pathsr:{name:"pathsr",value:t.pathsr}},o=this.pathSRParser.parse(i,{type:i.type.value,isRefRef:!0}),(s=e.merge(r.translatePredicateToAttribute(t,{type:"entity"}),r.translatePredicateToAttribute(t,{type:"relation"}))).from=o.from,s.to=o.to,e.is(n)&&e.is(n.stackedConnections,"array")&&n.stackedConnections.push(s),s},_addConnectedObjIdsToLinkedObj:function(e,t){Array.isArray(e)?e.forEach(function(e){t.add(e)}):t.add(e)},_addConnectionToMap:function(e,t,n){var i,o;o=n[i=Array.isArray(e)?e.toString():e],Array.isArray(o)?o.some(function(e){return e.PID===t.PID})||(n[i]=o.concat(t)):n[i]=[t]},findMissingLinkedObjects:function(t,n){var i,o=this,r={referencesPID:[t],instancesPID:[]},s={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}};o.collectionUtils.expandOnBackbone(t,r),r.referencesPID.forEach(function(t){var n,i=o.collectionUtils.getReferenceFromCollection(t);e.is(i)&&(n=i.pick("PID"),s.stackedReferences.push(n))}),r.instancesPID.forEach(function(t){var n,i=o.collectionUtils.getInstanceFromCollection(t);e.is(i)&&(n=i.pick("PID"),s.stackedInstances.push(n))}),i=o.collectionUtils._removeDuplicate(r.referencesPID.slice().concat(r.instancesPID.slice())),o.navigateNodes(i,s,function(t){o.getDescendantsV2(t,function(){o._addToCollections(s,n)},e.extend(n,{stackedObjects:s,withLinks:!1}))})},getDescendantsV2:function(t,n,i){var o,r,s,l=this,d={},u=e.is(n,"function")?n:null;t instanceof Array||(t=[t]),e.is(i)&&(d=e.extend({},i)),d.selectBo=["ds6w:label","physicalid","type","interface"],d.selectRel=["physicalid","type","interface","from.physicalid","to.physicalid"],l.progressiveExpandPromise(t,d).then(function(t){var n,i,o=[],s=Promise.resolve(t);if(e.is(d.includeXcadDrawings,"boolean")&&d.includeXcadDrawings){if((n=isNaN(d.expandLevel)?a.getPrefExpandLevel():d.expandLevel)>0||-1===n)for(i of Object.values(t.references))i.interface.includes("XCADItemExtension")&&i.queriedForChildren&&l._dicoUtils.isAKindOf(i.type,"VPMReference")&&o.push(i.PID);o.length>0&&(r={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}},s=l._getNavigateToXCADDrawingsPromise(o,r,t))}return s}).then(function(t){var n,i,r;return e.is(t)?(i={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}},r={referenceIds:(o=t).referencesToFetch,instanceIds:o.instancesToFetch},n=l._fetchConnectedInstancesPromise(r,o.connectionsMap,i)):n=Promise.resolve(),n}).then(function(t){var n,i;return e.is(t)?(t.stackedObjects.stackedInstances.forEach(t=>{var n,i=t.PID;n=o.instances[i]||{},o.instances[i]=e.extend(n,t,!0)}),i={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}},n=l._fetchConnectedReferencesPromise(t.referenceIds,o.connectionsMap,i)):n=Promise.resolve(),n}).then(function(t){var n,i,r,s=[];return e.is(t)?(t.stackedReferences.forEach(t=>{var n,i=t.PID;n=o.references[i]||{},o.references[i]=e.extend(n,t,!0)}),Object.values(o.connectionsMap).forEach(e=>s=s.concat(e)),Object.keys(o.connections).forEach(e=>{s.indexOf(e)<0&&delete o.connections[e]}),r={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}},i=s.filter(e=>!e.contains("|")),n=l._fetchConnectionsPromise(i,r)):n=Promise.resolve(),n}).then(function(t){s={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}},e.is(t)&&(t.stackedConnections.forEach(t=>{var n,i=t.PID;n=o.connections[i]||{},o.connections[i]=e.extend(n,t,!0)}),s.stackedReferences=s.stackedReferences.concat(Object.values(o.references)),s.stackedInstances=s.stackedInstances.concat(Object.values(o.instances)),s.stackedConnections=s.stackedConnections.concat(Object.values(o.connections)),s.documentIdMap=e.extend(s.documentIdMap,o.documents,!0)),e.is(r)&&(s.stackedReferences=s.stackedReferences.concat(r.stackedReferences),s.stackedInstances=s.stackedInstances.concat(r.stackedInstances),s.stackedConnections=s.stackedConnections.concat(r.stackedConnections),s.documentIdMap=e.extend(s.documentIdMap,r.documentIdMap,!0)),l._addToCollectionPromise(s,null,d).then(function(e){u.call(d.context,e)})}).catch(function(e){c.debug("getDescendants:- failed : "+e)})},_fetchConnectedInstancesPromise:function(t,n,i){var o=this,r=t.referenceIds;return new Promise(function(s,a){var c=[];t.instanceIds.forEach(function(e){c.push(e)}),c.length>0?o.fetchMultipleOnIndexPromise(c,{type:"relation",silent:!0,withSynthesisAttribute:!1,chunkSize:o.FETCH_CHUNK_SIZE}).then(function(o){var a,l,d,u=null;for(c.length!==o.length&&(u=new Set(t.instanceIds)),a=0,l=o.length;a<l;a++)d=o[a].attributes,i.stackedInstances.push(d),d.isInstanceOf&&r.add(d.isInstanceOf),null!==u&&u.delete(d.PID);e.is(u)&&u.size>0&&u.forEach(function(e){Object.keys(n).forEach(function(t){t.indexOf(e)>-1&&delete n[t]})}),s({referenceIds:r,stackedObjects:i})}).catch(function(){a()}):s({referenceIds:r,stackedObjects:i})})},_fetchConnectedReferencesPromise:function(t,n,i){var o=this;return new Promise(function(r,s){var a=[];t.forEach(function(e){a.push(e)}),a.length>0?o.fetchMultipleOnIndexPromise(a,{type:"entity",silent:!0,withSynthesisAttribute:!1,chunkSize:o.FETCH_CHUNK_SIZE}).then(function(o){var s,c,l,d=null;for(a.length!==o.length&&(d=new Set(t)),s=0,c=o.length;s<c;s++)l=o[s].attributes,i.stackedReferences.push(l),null!==d&&d.delete(l.PID);e.is(d)&&d.size>0&&d.forEach(function(e){delete n[e]}),r(i)}).catch(function(){s()}):r(i)})},_fetchConnectionsPromise:function(t,n){var i,o=this;return new Promise(function(s,a){var c=[];t.forEach(function(e){c.push(e)}),c.length>0?((i=o.getSelectPredicate("entity")).push("pathsr"),o.fetchMultipleOnIndexPromise(c,{type:"entity",select_predicate:i,silent:!0,translateResult:!1,withSynthesisAttribute:!1,chunkSize:o.FETCH_CHUNK_SIZE}).then(function(t){var i,a,c,l,d;for(i=0,a=t.length;i<a;i++)c=t[i].attributes,l=o.pathSRParser.parse(c,{type:c.type}),d=r.translatePredicateToAttribute(c,{type:"entity",fromExpandService:!0}),"MfgProcessAlternate"!==(d=e.merge(d,r.translatePredicateToAttribute(c,{type:"relation"}))).type&&"MustBeMadeFrom"!==d.type||(l={isRefRef:!0},d.from=c["from.physicalid"],d.to=c["to.physicalid"]),e.is(l)&&(e.is(l.type)&&(d.type=l.type),e.is(l.PID)&&(d.PID=l.PID),e.is(l.from)&&(d.from=l.from),e.is(l.to)&&(d.to=l.to),"ProcessImplementLinkOcc"===l.type?d["PLMEntity.V_usage"]=o._validateUsageValue(d["PLMEntity.V_usage"]):"DELLmiTimeConstraintCnx"===l.type&&(d["DELLmiTimeConstraintCategoryAbstractCusto.flowType"]=u(d.interface))),n.stackedConnections.push(d);s(n)}).catch(function(){a()})):s(n)})},_getStackedConnectionsFromMap:function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n=n.concat(e[t]));return n},_mergeCallbackResult:function(t,n){var i,o={};for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&(Array.isArray(t[i])?o[i]=t[i].concat(n[i]):e.is(t[i],"object")&&(o[i]={},e.merge(o[i],t[i]),e.merge(o[i],n[i])));return o},_addToCollectionPromise:function(t,n,i){var o=this;return new Promise(function(r){var s;(s=e.extend({},i)).callback=function(t){var i;i=e.is(n)?o._mergeCallbackResult(n,t):t,r(i)},o._addToCollections(t,s)})},fetchMultipleOnIndexPromise:function(t,n){var i=this,o=n||{},r=e.is(o.type)?o.type:"entity",s=!e.is(o.translateResult)||o.translateResult,a=!e.is(o.silent,"boolean")||o.silent,c=e.is(o.chunkSize)?o.chunkSize:i.FETCH_CHUNK_SIZE,l=!e.is(o.withSynthesisAttribute,"boolean")||o.withSynthesisAttribute,d=e.is(o.select_predicate)?o.select_predicate:null;return new Promise(function(e,n){var o;o=i.splitIntoChunks(t,c).map(function(e){return new Promise(function(t,n){i.fetchOnIndex(e,{type:r,withSynthesisAttribute:l,select_predicate:d,silent:a,translateResult:s,onComplete:function(e){var n=Array.isArray(e)?e:[e];t(n)},onFailure:function(){n()},context:i})})}),Promise.all(o).then(function(t){var n;n=t.reduce(function(e,t){return e.concat(t)},[]),e(n)}).catch(function(){n()})})},findMissingObj:function(t,n){var i=t.get("from"),o=t.get("to"),r=t.get("type"),s=!0,a=!0,c=this,l=function(t,i){e.is(t,"array")?t.forEach(function(t){e.is(t,"string")&&!c.collectionUtils.isInstance(t)&&n.missingInstanceObjects.push(t)}):e.is(t,"string")&&(i?c.collectionUtils.isReference(t)||n.missingReferenceObjects.push(t):c.collectionUtils.isInstance(t)||n.missingInstanceObjects.push(t))};switch(r){case"ProductImplementLinkOcc":case"DELLmiTimeConstraintCnx":case"DELLmiMaterialPathCnxCust":s=!1,a=!1;break;case"DELFmiMfgSubstituteCnx":s=!1}"SecondaryCandidateResourceLink"!==r&&l(i,s),"ProcessImplementLink"!==r&&"PartialProcessImplementLink"!==r||!c.collectionUtils.isInstance(o)||(a=!1),l(o,a)},fetchMissingObjects:function(t,n){var i,o,r,s=n||{},a={stackedReferences:[],stackedInstances:[]},l=this,d=parseInt(widget.getValue("navigateFetchSplitSize"));r=function(t,n){var i=function(t){var n=e.is(t.attributes)?t.attributes:t;e.is(t.ds6w)&&(n.ds6w=t.ds6w),a.stackedReferences.push(n)};e.is(n)&&(e.is(n,"array")?n.forEach(i):i(n)),t(a)},o=function(){return new Promise(function(e){t.missingReferenceObjects.length>0?(t.missingReferenceObjects=l.collectionUtils._removeDuplicate(t.missingReferenceObjects),l.fetchMultipleOnIndexPromise(t.missingReferenceObjects,{chunkSize:d}).then(function(t){r(e,t)})):r(e)})},i=function(n,i){var o=function(n){var i=e.is(n.attributes)?n.attributes:n;e.is(n.ds6w)&&(i.ds6w=n.ds6w),a.stackedInstances.push(i),e.is(i.isInstanceOf,"string")&&""!==i.isInstanceOf&&(l.collectionUtils.isReference(i.isInstanceOf)||t.missingReferenceObjects.push(i.isInstanceOf))};e.is(i)&&(e.is(i,"array")?i.forEach(o):o(i)),n()},function(){return new Promise(function(e){t.missingInstanceObjects.length>0?(t.missingInstanceObjects=l.collectionUtils._removeDuplicate(t.missingInstanceObjects),l.fetchMultipleOnIndexPromise(t.missingInstanceObjects,{type:"relation",chunkSize:d}).then(function(t){i(e,t)})):i(e)})}().then(o).then(function(e){l._addToCollections(e,s)}).catch(function(e){c.error("NavigateOnIndex.fetchMissingObjects : FAILURE in bring back missing objects "+e)})},getConnectionsByModel:function(t,n,i,o,r){var s=this,a=[],c=[],l=e.is(t)?t.get("PID"):null,d=e.is(n)?n.get("PID"):null,u={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}},f={documentIdMap:u.documentIdMap},p=function(){var t=[],n={missingInstanceObjects:[],missingReferenceObjects:[]},a={callback:function(){e.is(r,"function")&&r(t)}};t=s.collectionUtils.getImpactedConnections(l,d,{relationTypes:i,isRefRefOnly:o}),e.is(t,"array")&&t.forEach(function(e){s.findMissingObj(e,n)}),s.fetchMissingObjects(n,a)},m=function(){var i={queriedForConnections:!0},o={callback:function(){e.is(t)&&t.setAdditionalInfo(i),e.is(n)&&n.setAdditionalInfo(i),p()}};s._addToCollections(u,o)};e.is(l)&&s.collectionUtils.needToQueryForConnections(s.collectionUtils.references,t)&&(s.collectionUtils.needToQueryForDirectConnections(s.collectionUtils.references,t)?a.push(l):s.collectionUtils.needToQueryForInverseConnections(s.collectionUtils.references,t)&&c.push(l)),e.is(d)&&s.collectionUtils.needToQueryForConnections(s.collectionUtils.instances,n)&&(s.collectionUtils.needToQueryForDirectConnections(s.collectionUtils.instances,n)?a.push(d):s.collectionUtils.needToQueryForInverseConnections(s.collectionUtils.instances,n)&&c.push(d)),a.length>0&&c.length>0?s.navigateNodes(a.concat(c),u,m,f):a.length>0?s.navigateNodes(a,u,m,f):c.length>0?s.navigateInverseNodes(c,u,m,f):p()},getInverseConnections:function(t,n){var i,o,r=this,s=n||{};i=r.splitIntoChunks(t,1e3).map(function(e){return new Promise(function(t,n){var i={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}},o={onFailure:function(e){n(e)}};r.navigateInverseNodes(e,i,function(n,o){i.stackedConnections=[],e.forEach(function(e){(r.collectionUtils.getInstanceFromCollection(e)||r.collectionUtils.getReferenceFromCollection(e)).setAdditionalInfo({queriedForConnections:!0})}),t({linkedObjIds:n,connectionsMap:o})},o)})}),Promise.all(i).then(function(t){return new Promise(function(n){var i={referenceIds:new Set,instanceIds:new Set},o={referenceConnectionsMap:{},instanceConnectionsMap:{}};t.forEach(function(t){t.linkedObjIds.referenceIds.forEach(function(e){i.referenceIds.add(e)}),t.linkedObjIds.instanceIds.forEach(function(e){i.instanceIds.add(e)}),e.merge(o.referenceConnectionsMap,t.connectionsMap.referenceConnectionsMap),e.merge(o.instanceConnectionsMap,t.connectionsMap.instanceConnectionsMap)}),n({linkedObjIds:i,connectionsMap:o})})}).catch(function(t){e.is(s.onFailure,"function")&&s.onFailure(t)}).then(function(e){var t,n,i=e.connectionsMap.instanceConnectionsMap,a=e.connectionsMap.referenceConnectionsMap;e.linkedObjIds.referenceIds.size>0||e.linkedObjIds.instanceIds.size>0?(t={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}},n={referenceIds:new Set,instanceIds:new Set},e.linkedObjIds.referenceIds.forEach(function(e){r.collectionUtils.isReference(e)||n.referenceIds.add(e)}),e.linkedObjIds.instanceIds.forEach(function(e){r.collectionUtils.isInstance(e)||n.instanceIds.add(e)}),r._fetchConnectedInstancesPromise(n,i,t).then(function(e){var t;return e.stackedObjects.stackedConnections=r._getStackedConnectionsFromMap(i),o=r._addToCollectionPromise(e.stackedObjects,null,s),t={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}},r._fetchConnectedReferencesPromise(e.referenceIds,a,t)}).then(function(e){o.then(function(t){return e.stackedConnections=r._getStackedConnectionsFromMap(a),r._addToCollectionPromise(e,t,s)}).then(function(){s.onComplete()})})):((t={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}}).stackedConnections=r._getStackedConnectionsFromMap(a),r._addToCollectionPromise(t,null,s).then(function(){s.onComplete(e.stackedConnections)}))}).catch(function(t){e.is(s.onFailure,"function")&&s.onFailure(t)})},getPathsFromSR:function(t){var n,i,o,r,s=null;return n=t.indexOf(" PS "),n+=4,i=t.indexOf(" PE "),-1===n||-1===i?(c.log("Error parsing fromOcc from attribute pathSR: "+t),null):(o=t.substring(n,i).split(" "),n=t.indexOf(" PS ",n),n+=4,i=t.indexOf(" PE",i+4),-1===n||-1===i?(c.log("Error parsing toOcc from attribute pathSR: "+t),null):(r=t.substring(n,i).split(" "),e.is(o)&&e.is(r)&&(s={from:o,to:r}),s))},getPartialScopeTargetsFromPathSR:function(t){var n,i,o,r,s,a=[];for(n=t.split(" PS ").length-1,o=0,r=0,i=0;i<n;i++){if(o=t.indexOf(" PS ",o),o+=4,r=t.indexOf(" PE",r+4),-1===o||-1===r)return c.log("Error parsing to value from attribute pathSR: "+t+" | index: "+i),null;s=t.substring(o,r).split(" "),e.is(s)&&s.length>0&&a.push(s)}return a},getUsagePointsTargetsFromPathSR:function(t){var n,i=[];return t.split(" PE").filter(e=>e.includes("R_590")).forEach(function(t){var o;-1!==(n=t.indexOf("PS"))&&(o=t.substring(n+3).split(" "),e.is(o)&&o.length>0&&i.push(o))}),-1===n?(c.log("Error parsing usage points value from attribute pathSR: "+t),null):i},_getAltSubContextMfgRelations:function(t){var n=this;return new Promise(function(i,r){var s,c,l,d=o.get3DSpaceUrl()+"cvservlet/navigate?SecurityContext="+o.getSecurityContext(),u=[],f={},p=n.getSelectPredicate("entity").concat(n.getSelectPredicate("relation"));for(s=p.length;s--;)f[l=p[s]]||(u.unshift(l),f[l]=!0);t instanceof Array||(t=[t]),u.push("pathsr"),c={label:a.getCVServletLabel(),input_physical_ids:t,primitives:[{navigate_to_rel:{id:1,filter:{bo_type:["DELFmiProcessOutputPrereqMaterializationCnx"]}},navigate_to_sr:{id:2,filter:{role:["51"],category:["5"]},mode:"path"}}],patterns:{resProd_relation:[{id:1}],productMbomImplement_pathSR:[{id:2}]},attributes:u,fileAttributes:[],version:3},c=e.Json.encode(c),o.webServiceRequest({url:d,method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:c,onComplete:function(e){i(e)},onFailure:function(e,t){r(t)}})})},_getAltSubContextProducts:function(t){var n,i=this,o=function(e,t){var n,o,r=null;return(n=e.filter(function(e){var t=e["ds6w:kind"];return t.includes("EIN")||t.includes("3D-EIN")}).map(function(e){return e.pathsr})).length>0&&(o={pathsr:{value:n=n[0]}},r={referenceId:i.pathSRParser.parse(o,{type:"DELFmiProcessOutputPrereqMaterializationCnx",isRefRef:!0,referenceEntity:{physicalid:{value:t}}}).to,instanceId:null}),r},r=function(e){var t,n=null;return(t=e.map(function(e){var t=e.elements;return t[t.length-1]})).length>0&&(n={referenceId:(t=t[0])["to.physicalid"],instanceId:t.physicalid}),n};return n=t.reduce(function(t,n){var i=n.referenceId,o=n.instanceId;return e.is(i)&&t.push(i),e.is(o)&&t.push(o),t},[]),new Promise(function(s,a){i._getAltSubContextMfgRelations(n).then(function(n){var i,a,c,l={};i=function(t){var n=t.result,i=new Map,s=new Map;return n.forEach(function(t){var n,a,c,l,d=t.outputs,u=t.input_object.physicalid;for(n in d)Object.prototype.hasOwnProperty.call(d,n)&&(a=d[n],"resProd_relation"===n?(c=o(a,u),e.is(c)&&i.set(u,c)):"productMbomImplement_pathSR"===n&&(l=r(a),e.is(l)&&s.set(u,l)))}),{resultingProductsMap:i,implementedProductsMap:s}}(n),a=i.resultingProductsMap,c=i.implementedProductsMap,t.forEach(function(t){var n=t.referenceId,i=t.instanceId;e.is(n)&&a.has(n)?l[n]=a.get(n):e.is(i)&&c.has(i)&&(l[i]=c.get(i))}),s(l)}).catch(function(e){c.log(e),a(e)})})},getMultipleAltSubContextProductsPromise:function(t){var n=this;return new Promise(function(i,o){var r;r=n.splitIntoChunks(t,25).map(function(e){return n._getAltSubContextProducts(e)}),Promise.all(r).then(function(t){var n;n=t.reduce(function(t,n){return e.merge(t,n)},{}),i(n)}).catch(function(e){o(e)})})}})}),define("DS/DELPPWNavigationServices/NavigateOnDB",["UWA/Core","UWA/Promise","DS/DELPPWNavigationServices/NavigationBase","DS/DELPPWWebServices/WebserviceUtils","DS/DELPPWModelParsers/ConnectionParser","DS/DELPPWModelServices/ModelUtils","DS/DELPPWLoggerModel/LoggerUtils","DS/DELPPWIndexServices/IndexParser"],function(e,t,n,i,o,r,s,a){"use strict";return n.extend({_dicoUtils:null,init:function(e){e=e||{},this._parent(e),this._dicoUtils=e.dicoUtils},_getDescendants:function(t,n,o,s){var a,c,l,d,u=this;s=s||{},c=isNaN(s.expandLevel)?r.getPrefExpandLevel():s.expandLevel,d={pid:Array.isArray(t)?null:t,expandLevel:c,ordered:!e.is(s)||(!e.is(s.ordered,"boolean")||s.ordered),includeXcadDrawings:!!e.is(s)&&(!!e.is(s.includeXcadDrawings,"boolean")&&s.includeXcadDrawings)},l=e.is(s.context)?s.context:this,(a={url:"dsmfg/private/V0/invoke/getDescendants",method:"POST",onComplete:function(e){u.onGetDescendants(e,n,c,s,t),o.call(l)}}).data=e.Json.encode(d),e.is(s.onFailure,"function")&&(a.onFailure=s.onFailure),e.is(s.onTimeout,"function")&&(a.onTimeout=s.onTimeout),e.is(s.onCancel,"function")&&(a.onCancel=s.onCancel),i.webServiceRequest(a)},onGetDescendants:function(t,n,i,o,r){var s=this,a=-1===i,c=Array.isArray(r)?r:[r],l=e.clone(c);t.forEach(function(e){var t=e.attributesValue;Object.prototype.hasOwnProperty.call(t,"isInstanceOf")?(n.stackedInstances.push(e),2===i&&c.indexOf(t.isAggregatedBy)>-1&&l.push(t.isInstanceOf)):(e.queriedForChildren=a,n.stackedReferences.push(e))}),2===i&&n.stackedReferences.forEach(function(t){(l.indexOf(t.attributesValue.PID)>-1||e.is(s._dicoUtils)&&s._dicoUtils.isAKindOf(t.attributesValue.type,"VPMRepReference"))&&(t.queriedForChildren=!0)})},_getDescendantsAndLinks:function(t,n,o,s){var a,c,l,d=this,u=[],f={};s=s||{},f={expandLevel:l=isNaN(s.expandLevel)?r.getPrefExpandLevel():s.expandLevel,ordered:!e.is(s)||(!e.is(s.ordered,"boolean")||s.ordered),fetchInverseRelations:!!e.is(s)&&(!!e.is(s.fetchInverseRelations,"boolean")&&s.fetchInverseRelations),includeXcadDrawings:!!e.is(s)&&(!!e.is(s.includeXcadDrawings,"boolean")&&s.includeXcadDrawings)},e.is(s.gridIDs)&&Array.isArray(s.gridIDs)&&(f.gridIDs=s.gridIDs),e.is(s.filterQuery)&&(f.cfgFilter=s.filterQuery),c=e.is(s.context)?s.context:this,a={method:"POST",onComplete:function(e){Array.isArray(e)?e.forEach(function(e){d.onGetDescendantsAndLinks(e,u,n,l,s,t)}):d.onGetDescendantsAndLinks(e,u,n,l,s,t),o.call(c,u)}},Array.isArray(t)&&t.length>1?(f.pidArray=t,a.url="dsmfg/private/V0/invoke/getMultipleDescendantsAndLinks"):(a.url="dsmfg/private/V0/invoke/getDescendantsAndLinks",f.pid=Array.isArray(t)?t[0]:t),a.data=e.Json.encode(f),e.is(s.onFailure,"function")&&(a.onFailure=s.onFailure),e.is(s.onTimeout,"function")&&(a.onTimeout=s.onTimeout),e.is(s.onCancel,"function")&&(a.onCancel=s.onCancel),i.webServiceRequest(a)},onGetDescendantsAndLinks:function(t,n,i,r,s,a){var c=this,l=e.is(s.withLinksResolved,"boolean")?s.withLinksResolved?n:null:n,d=-1===r,u=!0,f=Array.isArray(a)?a:[a],p=e.clone(f);i.documentIdMap=e.merge(i.documentIdMap,t.documents),Array.isArray(s.gridIDs)&&s.gridIDs.length>0&&(u=!1),e.is(t.instancesAndReferences)&&(t.instancesAndReferences.forEach(function(t){var n=t.attributesValue;Object.prototype.hasOwnProperty.call(n,"isInstanceOf")?(t.queriedForConnections=u,e.is(s.filterQuery)&&(t.filterQuery=s.filterQuery),i.stackedInstances.push(t),2===r&&f.indexOf(n.isAggregatedBy)>-1&&p.push(n.isInstanceOf)):(t.queriedForChildren=d,t.queriedForConnections=u,i.stackedReferences.push(t))}),2===r&&i.stackedReferences.forEach(function(t){(p.indexOf(t.attributesValue.PID)>-1||e.is(c._dicoUtils)&&c._dicoUtils.isAKindOf(t.attributesValue.type,"VPMRepReference"))&&(t.queriedForChildren=!0)})),t.connections.forEach(function(e){o.parse(e,i,l)})},getDescendants:function(t,n){var i=this,o={},r=n.stackedObjects||{stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}};n=n||{},e.is(n.silentMode)&&(o={silent:!0}),e.is(n.withLinks,"boolean")&&n.withLinks?i._getDescendantsAndLinks(t,r,function(t){(t=Array.from(new Set(t))).length>0?(e.is(n)&&(n.withLinksResolved=!1),n.stackedObjects=r,i.getDescendants(t,n)):(n=e.merge(n,o),i._addToCollections(r,n))},n):i._getDescendants(t,r,function(){n=e.merge(n,o),i._addToCollections(r,n)},n)},getConnectionsByModel:function(t,n,i,o,r){var s,a,c=this,l=e.is(r,"function"),d=e.is(t)?t.id:null,u=e.is(n)?n.id:null;s={relationTypes:i,isRefRefOnly:o,onComplete:function(){a=c.collectionUtils.getImpactedConnections(d,u,s),l&&r(a)},onFailure:function(){l&&r(a)}},c.fetchConnections(d,u,s)},fetchConnections:function(t,n,o,r){var c,l,d,u,f,p,m=this,g=[];o=o||{},d=m.collectionUtils.needToQueryForConnections(m.collectionUtils.references,t)?t:null,u=m.collectionUtils.needToQueryForConnections(m.collectionUtils.instances,n)?n:null,r=!!e.is(r)&&r,e.is(d)||e.is(u)||r?(f=!!e.is(o.isRefRefOnly)&&o.isRefRefOnly,p=e.is(o.relationTypes,"array")?o.relationTypes:[],m.collectionUtils.connections.fetch({data:{parentPID:t,instancePID:n,gridIDs:e.Json.encode(p)},headers:i.getHeaders({serviceName:"3DSpace"}),wait:!0,remove:!1,onComplete:function(i,d){var u;e.is(t)&&!f&&(c=m.collectionUtils.getReferenceFromCollection(t),e.is(c)?("PART"===c.get("PPRTYPE")&&(u=a.translatePredicateToAttribute(c._attributes,{type:"entity"}),c.set(u)),c.setAdditionalInfo({queriedForConnections:!0})):s.debug(m.name,"could not get reference pid %s",t)),e.is(n)&&!f&&(l=m.collectionUtils.getInstanceFromCollection(n),e.is(l)&&l.setAdditionalInfo({queriedForConnections:!0})),e.is(o.onComplete,"function")&&(r?(e.is(d,"array")&&d.forEach(function(n){var i=n["from.attributesValue"],o=n["to.attributesValue"];e.is(i)&&e.is(o)&&e.is(o.physicalid,"string")&&t===o.physicalid&&g.push(i)}),o.onComplete.call(o.context,g)):o.onComplete.call(null))},onFailure:function(){s.debug(m.name,"Fetching of connections failed: %s , %s",t,n),e.is(o.onFailure,"function")&&o.onFailure.call(null)}})):e.is(o.onComplete,"function")&&o.onComplete.call(null)},fetchRoot:function(t,n){var i=n||{},o=e.is(i.context)?i.context:null,r=!e.is(i.silent)||i.silent,s=!!e.is(i.forceDBMode)&&i.forceDBMode,a=e.is(i.onComplete,"function")?i.onComplete:null,c=e.is(i.onFailure,"function")?i.onFailure:null,l={onComplete:function(t){var n,i={forceDBMode:s};e.is(a,"function")&&(e.is(t.instancesAndReferences)?(n=t.instancesAndReferences,i=e.merge(i,{isArray:!0})):n=t,a.call(o,n,i))},onFailure:function(t){e.is(c,"function")&&c.call(o,t)},silent:r};e.is(t,"array")?this.collectionUtils.fetchRefList(t,l):this.collectionUtils.fetchRef({PID:t},l)},fetchInstancesAndTheirReferences:function(e,t){this.collectionUtils.fetchInstancesAndTheirReferences(e,t)},getWhereUsedReferences:function(t,n){var o,r,s=this,a=e.is(n,"function"),c={callback:function(t){var i=[],o=[];e.is(t)&&e.is(t.instancesAndReferences,"array")&&t.instancesAndReferences.forEach(function(e){e.isReference()?i.push(e):o.push(e)}),a&&n(i,o)}},l={stackedReferences:[],stackedInstances:[]};e.is(t)&&(o=t.id),i.webServiceRequest({url:"dsmfg/private/V0/invoke/whereUsed",method:"GET",data:{pid:o},onComplete:function(t){t.forEach(function(t){r=t.attributesValue,e.is(r)&&(Object.prototype.hasOwnProperty.call(r,"isInstanceOf")?l.stackedInstances.push(t):l.stackedReferences.push(t))}),s._addToCollections(l,c)},onFailure:function(){a&&n([])}})},getAltSubContextProductPromise:function(n,o){var r={mfgReferenceId:n,mfgInstanceId:e.is(o,"string")?o:null};return new t(function(t,n){i.webServiceRequest({url:"dsmfg/private/V0/invoke/getAltSubContextProduct",method:"POST",data:e.Json.encode(r),onComplete:function(e){t(e.contextProductInfo)},onFailure:function(e){n(e)}})})},_getAltSubInfo:function(t){return{id:e.result(t,"AlternateItemPhysicalId",null),qualificationStatus:e.result(t,"AlternateQualificationStatus",null),operation:e.result(t,"Operation",null),instanceContextId:e.result(t,"InstanceContextPhysicalid",null),parentContextId:e.result(t,"ParentContextPhysicalid",null)}},getAlternateEnggItemPromise:function(n){const o=this;return new t(function(t,r){const s={PrimaryItemPhysicalId:n};i.webServiceRequest({url:"v1/alternateManagement/getAlternateForEngineeringItem",method:"POST",data:e.Json.encode(s),headers:{Accept:"application/json","Content-Type":"application/json"},onComplete:function(n){const i=n.status;let s;e.is(i,"string")&&"success"===i?(s=Array.isArray(n.AlternateItemInfo)?n.AlternateItemInfo.map(o._getAltSubInfo):[],t(s)):r('XEN webservice "/getAlternateForEngineeringItem" status is '+i)},onFailure:function(e){r(e)}})})},_getAlternateEnggItemInfoPromise:function(n,o,r){return new t(function(t,s){var a=i.getServiceUrl("3DSpace"),c=i.getSecurityContext(),l={AlternateQualificationFilterStatus:o,referenceObjectsInfo:n};a.endsWith("/")&&(a=a.slice(0,-1)),i.webServiceRequest({url:"v1/alternateManagement/getAlternateInfoEngineeringItems?root3DSpaceUrl="+a,method:"POST",data:e.Json.encode(l),headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:c,SecurityToken:r+"|"+c+"|preferred"},onComplete:function(n){var i;e.is(n.status,"string")&&"success"===n.status?(i=e.is(n.isAlternateDefinedForEngineeringItem)?n.isAlternateDefinedForEngineeringItem:{},t(i)):s('XEN webservice "/getAlternateForEngineeringItem" status is '+status)},onFailure:function(e){s(e)}})})},getAlternateEnggItemInfoPromise:function(n,i,o){var r=this;return new t(function(s,a){var c;c=r.splitIntoChunks(n,50).map(function(e){return r._getAlternateEnggItemInfoPromise(e,i,o)}),t.all(c).then(function(t){var n;n=t.reduce(function(t,n){return e.merge(t,n)},{}),s(n)}).catch(function(e){a(e)})})},getEngAlternatesFromBLPromise:function(n){const o=function(t){const n=function(e,t){let n=new Map;n.set(!0,[]),n.set(!1,[]);for(const i of e){const e=t(i),o=i;n.set(e,n.get(e).concat(o))}return n}(t,t=>!e.owns(t,"ErrorMessage")),i=n.get(!0),o=n.get(!1);return{altSubInfos:i.map(this._getAltSubInfo),altSubErrors:o.map(function(e){return e.ErrorMessage})}},r=this,a="BLUndefined",c="Success",l="SuccessPartially",d="Failed";return new t(function(t,u){const f={MfgItemOccPath:n};i.webServiceRequest({url:"dsmfg/private/V0/invoke/MfgItem/getEngAlternatesFromBL",method:"POST",data:e.Json.encode(f),onComplete:function(e){const n=e.Status;let i=[],u=!1;if(n===c||n===l){const{altSubInfos:t,altSubErrors:n}=o.call(r,e.ParsedBLOutput);n.length>0&&(u=!0,f=n,Array.isArray(f)&&f.length>0&&f.forEach(e=>{s.log(e)})),i=t}else n===d?(u=!0,s.log(e.ErrorMessage),i=[]):n===a&&(i=[]);var f;s.debug(r.name,'BL webservice "/getEngAlternatesFromBL" status is '+n),t({altSubInfosResult:i,someErrorOccured:u})},onFailure:function(e){u(e)}})})},getMfgItemsFromDesignAlternatesPromise:function(n,o,r){return new t(function(t,s){var a={contextProductId:n,linkTypeNavigated:r,designAlternateIds:o};i.webServiceRequest({url:"dsmfg/private/V0/invoke/mfgItemsFromDesignAlternates",method:"POST",data:e.Json.encode(a),onComplete:function(e){t(e)},onFailure:function(e){s(e)}})})}})}),define("DS/DELPPWNavigationServices/NavigateOnDemand",["UWA/Core","DS/DELPPWNavigationServices/NavigateOnIndex"],function(e,t){"use strict";return t.extend({init:function(e){e=e||{},this._parent(e)},getDescendants:function(t,n,i){var o,r,s={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}},a=this,c=e.is(n,"function")?n:null;o=o||{},e.is(i)&&(o=e.extend({},i)),t instanceof Array||(t=[t]),r=function(n){a.navigateNodes(t,s,function(t){var i=[];s.stackedConnections.forEach(function(e){"DELAsmProcessCanUseCnx"===e.type&&-1===i.indexOf(e.PID)&&i.push(e.PID)}),a.navigateNodes(i,s,function(i){var r;t=t.concat(i),r=function(e){a._addToCollectionPromise(s,null,o).then(function(t){var i;i=a._mergeCallbackResult(n,e),i=a._mergeCallbackResult(i,t),c.call(o.context,i)})},a.getDescendantsV2(t,r,e.extend(o,{withLinks:!1}))})})},a.getDescendantsV2(t,r,e.extend(o,{withLinks:!1}))},getConnections:function(t,n,i){var o=this,r={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{}},s=i||{},a=e.is(s.context)?s.context:null;t instanceof Array||(t=[t]),s=e.merge({callback:function(i){var r={queriedForConnections:!0,queriedForDocuments:!0},s={queriedForConnections:!0},c={missingInstanceObjects:[],missingReferenceObjects:[]},l={callback:function(){e.is(n,"function")&&n.call(a,i)}};t.forEach(function(t){var n,i;n=o.collectionUtils.getInstanceFromCollection(t),e.is(n)||(i=o.collectionUtils.getReferenceFromCollection(t)),e.is(i)?i.setAdditionalInfo(r):e.is(n)&&n.setAdditionalInfo(s)}),i.connections.forEach(function(t){var n=o.collectionUtils.getConnectionFromCollection(t.get("PID"));e.is(n)&&o.findMissingObj(n,c)}),o.fetchMissingObjects(c,l)}},s),this.navigateNodes(t,r,function(){var e=[];r.stackedConnections.forEach(function(t){"DELAsmProcessCanUseCnx"===t.type&&-1===e.indexOf(t.PID)&&e.push(t.PID)}),o.navigateNodes(e,r,function(){o._addToCollections(r,s)})})}})}),define("DS/DELPPWNavigationServices/NavigateUtil",["UWA/Core","UWA/Class","DS/DELPPWWebServices/WebserviceUtils","DS/DELPPWNavigationServices/SwitchDBModeManager","DS/DELPPWModelParsers/ConnectionParser","DS/DELPPWIndexServices/IndexParser","DS/DELPPWModelServices/ModelUtils","DS/DELPPWModelServices/BehaviorUtil","DS/DELPPWModelServices/Navigation/IndexedDBUtils","DS/DELPPWNavigationServices/NavigateOnDB","DS/DELPPWNavigationServices/NavigateOnIndex","DS/DELPPWNavigationServices/NavigateOnDemand","DS/DELPPWModelServices/CollectionUtils","DS/DELPPWLoggerModel/LoggerUtils"],function(e,t,n,i,o,r,s,a,c,l,d,u,f,p){"use strict";var m=t.singleton({name:"NavigateUtil",uninitializedCalls:"throw",init:function(e){if(!(e=e||{}).indexMappingXML)throw new Error("indexMappingXML option not defined");this.options=e,c.init(),m._connectionParser=o.init({collectionUtils:this.options.collectionUtils})},setup:function(t,i){var o=this,s=new Promise(function(e,t){n.getXMLValues(o.options.indexMappingXML,function(t){e(t)},function(e){t(e)})}),a=new Promise(function(t,n){e.is(o.options.mandatoryPredicates,"string")&&o.options.mandatoryPredicates.length>0?require(["text!"+o.options.mandatoryPredicates],function(e){var n=JSON.parse(e);t(n)},function(){n("mandatory Predicates defined but not loaded !!!")}):t(null)});Promise.all([s,a]).then(function(n){var i={dicoUtils:o.options.dicoUtils,collectionUtils:o.options.collectionUtils,mandatoryPredicates:e.is(n[1])?n[1]:null};r.setup({dicoUtils:o.options.dicoUtils,indexToDBMapping:n[0]}),m.navigateOnDB=new l(i),m.navigateOnIndex=new d(i),m.NavigateOnDemand=new u(i),p.debug("Succesfully initialized navigations."),t()},function(e){p.debug("Failed to initialize Navigations. Failure desc:"+e),i(e)})},getConnectionParser:function(){return m._connectionParser},getConnectionsFromServer:function(t,n,i){var o=i||{},r=e.is(o.context)?o.context:null;s.isNavigateOnDemand()?this.NavigateOnDemand.getConnections(t,n,i):n.call(r)},getDescendantsFromServer:function(t,n,o){var r=o||{},c=s.getNavigateOnDatabasePreference(),l=s.isNavigateOnDemand(),d=i.isDbMode(),u=e.is(r.context)?r.context:null,p=!!e.is(r.forceDBMode,"boolean")&&r.forceDBMode,m=!!e.is(r.forceIndexMode,"boolean")&&(r.forceIndexMode&&a.isExpandFetchFetchEnabled()),g=function(t){t.instancesAndReferences.forEach(function(e){e.isInstance()&&f.manageLinearProductFlowsOnCreateInstance(e)}),e.is(n,"function")&&n.call(u,t)};r=e.merge({fillLinksAndDocuments:!1,withLinks:!0},r),(p||c||d)&&!m?(r=e.merge({callback:g},r),this.navigateOnDB.getDescendants(t,r)):l&&!m?this.NavigateOnDemand.getDescendants(t,g,r):this.navigateOnIndex.getDescendantsV2(t,g,r)},getInverseConnectionsFromServer:function(e,t){this.navigateOnIndex.getInverseConnections(e,t)},setSelectPredicate:function(e,t){this.navigateOnIndex.setSelectPredicate(e,t)},fetchRoot:function(t,n){var i,o,r,a,c,l=this,d=n||{},u=e.is(d.context)?d.context:null,f=!!e.is(n.WithSynthesisAttribute)&&n.WithSynthesisAttribute,p=!!e.is(d.forceDBMode)&&d.forceDBMode;o=e.is(d.onComplete,"function")?d.onComplete:null,i=e.is(d.onFailure,"function")?d.onFailure:null,c=function(t,n){var i=e.is(t,"array")?t.slice():[t];return n=n||[],e.is(n,"array")||(n=[n]),n.forEach(function(e){var t=i.indexOf(e.id);t>-1&&i.splice(t,1)}),i},r=function(n,i){var r;i=i||{},(r=c(t,n)).length>0&&(i.modelsNotRetrieved=r),e.is(o,"function")&&o.call(u,n,i)},!0===f?l.navigateOnIndex.fetchRoot(t,d):!0!==s.getNavigateOnIndex()||p?l.navigateOnDB.fetchRoot(t,e.merge({onComplete:r},d)):(a=function(n){var o,s,a=c(t,n);a.length>0?(o=function(i,o){var s,a=[];(i=e.is(i,"array")?i:[i]).forEach(function(e){a.push(e.id)}),e.is(t,"array")?(s=[],e.is(n)&&(n=e.is(n,"array")?n:[n],s=s.concat(n)),i=e.is(i,"array")?i:[i],s=s.concat(i)):s=i,o.modelsFromForceDB=a,r(s,o)},s=function(){e.is(n)?r(n):i&&i.call(u,"Object not found in index mode for PID:"+t)},l.navigateOnDB.fetchRoot(a,e.merge({onComplete:o,onFailure:s,forceDBMode:!0},d))):r(n)},l.navigateOnIndex.fetchRoot(t,e.merge({onComplete:a,onFailure:a},d)))},fetchMultiplePromise:function(e,t){return this.navigateOnIndex.fetchMultipleOnIndexPromise(e,t)},findMissingLinkedObjects:function(t,n,i){var o=e.merge({callback:n},i);this.navigateOnIndex.findMissingLinkedObjects(t,o)},getConnectionsByModel:function(t,n,i){var o=i||{},r=!!e.is(o.forceDBMode)&&o.forceDBMode;!s.getNavigateOnIndex()&&!s.isNavigateOnDemand()||r?this.navigateOnDB.getConnectionsByModel(t,n,o.relationTypes,o.isRefRefOnly,o.onComplete):this.navigateOnIndex.getConnectionsByModel(t,n,o.relationTypes,o.isRefRefOnly,o.onComplete)},getAltSubContextProductPromise:function(e,t){return this.navigateOnDB.getAltSubContextProductPromise(e,t)},getMultipleAltSubContextProductsPromise:function(e){return this.navigateOnIndex.getMultipleAltSubContextProductsPromise(e)},getAlternateEnggItemPromise:function(e){return this.navigateOnDB.getAlternateEnggItemPromise(e)},getEngAlternatesFromBLPromise:function(e){return this.navigateOnDB.getEngAlternatesFromBLPromise(e)},getAlternateEnggItemInfoPromise:function(e,t,n){return this.navigateOnDB.getAlternateEnggItemInfoPromise(e,t,n)},getMfgItemsFromDesignAlternatesPromise:function(e,t,n){return this.navigateOnDB.getMfgItemsFromDesignAlternatesPromise(e,t,n)},fetchInstancesAndTheirReferences:function(e,t){return this.navigateOnDB.fetchInstancesAndTheirReferences(e,t)},getWhereUsedReferences:function(e,t){this.navigateOnDB.getWhereUsedReferences(e,t)},getProductScopedLinksFromIndex:function(e,t,n){this.navigateOnIndex.getProductScopedLinks(e,t,n)},getProductScopedLinksFromDB:function(t,n){e.is(this.navigateOnDB)||(this.navigateOnDB=new l(this.options)),this.navigateOnDB.fetchConnections(t,null,n,!0)},navigateScopesFromIndex:function(e,t,n){this.navigateOnIndex.navigateScopes(e,t,n)},navigateOnIndex:function(e,t,n){this.navigateOnIndex.navigateOnIndex(e,t,n)},getReferenceFromInstance:function(e,t,n){this.navigateOnIndex.getReferenceFromInstance(e,t,n)}});return m});