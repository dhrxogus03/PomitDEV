define("DS/DMU3DReviewController/DMU3DReviewController",["UWA/Class","DS/DMUControls/EXPNotify","DS/DMUReadPersistence/DMULoadMarkupServices","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPManagerSet","DS/CATWebUXComponents/DMUCommandsManager","DS/PADUtils/views/PADProgressBar","DS/DMUMeasurable/DMUToolsSceneGraph","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/Selection/PSOManager","DS/CoreEvents/ModelEvents","DS/DMUBaseUIControllers/DMU2DSheetManager","DS/DMUBaseUIControllers/DMUCommentsController","DS/DMUPlaySlide/controllers/DMUSlideShowController","DS/DMUBaseUIControllers/DMUApplicativeContextManager","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/DMUReadPersistence/DMUWebServicesUtils","DS/DMUBaseUIServices/DMUSlidePreferences","DS/DMUPersistence/DMUSaveServices","DS/DMUPersistence/DMUDOSThumbnailServices","DS/DMUControls/DMUInfoModalDiv","DS/CATWebUXPreferences/CATWebUXPreferencesManager","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/CATWebUXComponents/CATWebUXUtils","DS/DMUBaseExperience/EXPUtils","DS/DMUReadPersistence/DMULoadingContextController","DS/DMUPlayMarker/DMUMarkerFactory","DS/DMUPlayMarker/DMUMarkerServices","DS/DMUPlaySection/DMUToolsSection","DS/DMUBaseExperience/EXPToolsVisualization","DS/CATWebUXSelectionManager/CATWebUXSelectionManager","DS/DMUBaseUIControllers/DMUSceneDisplayController","DS/PADServices/utils/GlobalModelEvents","DS/CATWebUXSlideDrop/CATWebUXSlideDropServices","DS/DMUControls/DMUToolsSave","DS/DMUBaseUIControllers/DMUReqCompareController","i18n!DS/DMU3DReviewController/assets/nls/DMU3DReviewController","i18n!DS/CATWebUXTIC/assets/nls/CATWebUXTICCmdAdapt"],function(e,t,n,o,i,r,a,l,s,c,u,d,g,p,m,f,C,D,v,S,h,M,R,b,P,y,x,U,I,w,A,T,V,E,O,F,_,k,L,W){"use strict";var H=e.extend({init:function(H){let B;this._parent(H);var j,X,N,q=!1,G=(H||{}).ctxViewer,z=this,Q=new d,J={},Y=null,K={},Z={};let $=null;var ee,te,ne,oe,ie,re,ae,le,se,ce,ue,de,ge,pe,me,fe,Ce,De,ve,Se,he=!1,Me=!0,Re=!1,be=!1;let Pe,ye,xe,Ue,Ie,we=!1,Ae=0,Te=!1,Ve=!0;const Ee=["SIMItfSimulation","PLMPIMMetricReference","Document","Specification Report","DIFLayout","DIFSheet","DIFAnnotationSet","Requirement","Requirement Specification","DesignSight"];function Oe(e,n){B&&(B.destroy(),B=null),B=new t({body:G.getFrameWindow().getUIFrame(),type:e,message:n})}function Fe(){for(var e,t=[],n=s.get(),i=!1,r=null,a=!1,c=0;c<n.length;c++){for(e=n[c].pathElement.clone();e&&e.internalPath.length;)e=e.getParentPath();if(e.getLastElement(!0).getAnnotationClassType||e.getLastElement(!0).getDMUType)return G.getExecutionContext?{WAfrCtxBarRow1:void 0}:{cmdList:[]};(r=l.getLastReference(e))&&l.isReference(r.getLastElement(!0))?i=!0:r=null}var u=n[n.length-1],d=function(e,t){return e.x>=t.x-3&&e.x<=t.x+3&&e.y>=t.y-3&&e.y<=t.y+3};if(Me&&n.length&&ee&&!ee.isADocumentDisplayed()){u&&u.event&&u.event.lastPosition&&u.event.startPosition&&d(u.event.startPosition,u.event.lastPosition)&&u.pathElement.externalPath.length>2&&u.pathElement.externalPath[0]===G.getRootBagPath().getLastElement(!0)&&(a=!0);var g=o.getReviewContext({context:G}),p=g?g.getCurrentSessionMarkup():null;let e="3D"===te||"ITF"===te;if(p&&p.getActiveFlag()&&!p.isReadOnly()&&p.isVisible()&&p.getCurrentSlide()){if(i&&e&&t.push({name:"DMUHideShowOverloadStr",line:1,hdr_list:["DMUHideShowOverloadHdr"],type:"handler",identifier:"DMUHideShowOverloadHdr"}),r&&r.externalPath&&r.externalPath.length&&e){var m=E.getDMUSceneDisplayController({context:G});m&&!m.getCurrentComparedObjectIDPaths()&&t.push({name:"DMUColorOpacityOverloadStr",line:1,hdr_list:["DMUColorOpacityOverloadHdr"],type:"handler",identifier:"DMUColorOpacityOverloadHdr"}),t.push({name:"DMUPositionOverloadStr",line:1,hdr_list:["DMUPositionOverloadHdr"],type:"handler",identifier:"DMUPositionOverloadHdr"})}}else i&&e&&t.push({name:"HideShowStr",line:1,hdr_list:["HideShowHdr"],type:"handler",identifier:"ENO3DHideShowCmd"});a&&e?t.push({name:"DMULevelSelectorStr",line:1,hdr_list:["DMULevelSelectorHdr"],type:"handler",identifier:"ENO3DLevelSelectorCmd"}):1===n.length&&u&&u.pathElement&&u.pathElement.getParentPath().isEqual(G.getRootBagPath())&&e&&t.push({name:"RemoveRootStr",line:1,hdr_list:["RemoveRootHdr"],type:"handler",identifier:"ENO3DRemoveRootCmd"})}return"DIFLayout"!==me&&"DIFSheet"!==me||u&&u.event&&u.event.lastPosition&&u.event.startPosition&&d(u.event.startPosition,u.event.lastPosition)&&u.pathElement.externalPath.length>2&&u.pathElement.externalPath[0]===G.getRootBagPath().getLastElement(!0)&&t.push({name:"DMULevelSelectorStr",line:1,hdr_list:["DMULevelSelectorHdr"],type:"handler",identifier:"ENO3DLevelSelectorCmd"}),G.getExecutionContext?{WAfrCtxBarRow1:{model:t}}:{cmdList:t}}function _e(e,t){var n=[],r=[],a=[],c=Boolean(G.getExecutionContext);if(oe&&oe.getActiveState())return c?n:{cmdList:n};var d=o.getReviewContext({context:G}),g=s.get(),p=!ee||ee&&!ee.isADocumentDisplayed(),m=i.getManager({name:"DMUUserExperienceManager",context:G.getFrameWindow()}),f=t?{x:t.XmousePositionWithDevPxRatio,y:t.YmousePositionWithDevPxRatio}:{x:e.XmousePositionWithDevPxRatio,y:e.YmousePositionWithDevPxRatio};if(0===(m?m.pick(f,"mesh"):G.getViewer().pick({xPix:f.x,yPix:f.y},"mesh",!0).path).length){var C=u.get(),D=C&&C[0]&&C[0].pathElement?C[0].pathElement.getLastElement(!0):null,v=D&&D.getDMUType?D.getDMUType():"";if("DMUSlide"===v||"DMUFormat"===v||"DMUComment"===v)return c?n:{cmdList:n};c?a.push({category:"Display",hdrs:!y.isMobile()&&p?["VisuQMCommand","ENO3DToggleStatusBarCmd"]:["ENO3DToggleStatusBarCmd"]},{category:"Ambience",hdrs:["VisuPureWhiteOCACmd","VisuWhiteMirrorOCACmd","VisuWhiteReviewOCACmd","VisuWhiteExperienceOCACmd","VisuStudioOCACmd","VisuDarkMirrorOCACmd","VisuDarkReviewOCACmd","VisuWhiteDesignOCACmd","VisuBlueDesignOCACmd","VisuDarkDesignOCACmd","VisuIndoorOCACmd","VisuCityOCACmd","VisuRoadOCACmd","VisuOutdoorOCACmd","VisuBasicOCACmd"]}):n=[{line:1,name:"DMU3DReviewDisplaySubMenu",resourceFile:"DMUBaseCommands/3DPlayPro",hdr_list:!y.isMobile()&&p?["VisuQMCommand","PAD3DToggleStatusBarHdr"]:["PAD3DToggleStatusBarHdr"]},{line:1,name:"DMU3DReviewAmbiencesSubMenu",resourceFile:"DMUBaseCommands/3DPlayPro",hdr_list:["VisuPureWhiteOCACmd","VisuWhiteMirrorOCACmd","VisuWhiteReviewOCACmd","VisuWhiteExperienceOCACmd","VisuStudioOCACmd","VisuDarkMirrorOCACmd","VisuDarkReviewOCACmd","VisuWhiteDesignOCACmd","VisuBlueDesignOCACmd","VisuDarkDesignOCACmd","VisuIndoorOCACmd","VisuCityOCACmd","VisuRoadOCACmd","VisuOutdoorOCACmd","VisuBasicOCACmd"]}];let e=A.getEditCmd(G.getViewer());e&&e.isEnabled()&&(c&&Se&&"2D"!==Se&&"Document"!==Se&&"Specification Report"!==Se&&"DIFLayout"!==Se&&"DIFSheet"!==Se&&"Drawing"!==Se&&"Requirement"!==Se&&"Requirement Specification"!==Se?e.isRunning()?r.push("DMUExitClippingEditionHdr"):r.push("DMUClippingEditionHdr"):c||(n=n.concat([{line:1,name:"DMUClippingEditStr",hdr_list:e.isRunning()?["DMUExitClippingEditionHdr"]:["DMUClippingEditionHdr"]}])))}else if(g.length){var S=d?d.getCurrentSessionMarkup():null,h=!1,M=!1,R=!1,b=S&&!S.isReadOnly()&&S.isVisible();for(let e=0;e<g.length;e++){if(S&&!S.isReadOnly()&&S.isVisible()){var P=S.getOrCreateOccurrenceOverloader(g[e]);if(!h)if(P&&P.isOverloadedInCurrentSlide())h=!0;else{let t=g[e].pathElement.clone();t.getParentPath()&&l.isInstance(t.getParentPath().getLastElement(!0))&&(P=S.getOrCreateOccurrenceOverloader({pathElement:t.getParentPath()}))&&P.isOverloadedInCurrentSlide()&&(h=!0)}}for(var x=!0,U=0;U<g[e].pathElement.externalPath.length;U++)g[e].pathElement.externalPath[U].getDMUType&&(M=!0,x=!1);x&&(R=!0)}var I=!1;if(m&&(I=m.areOccurenceOverloadsCopied()),h&&(c?r.push("DMURemoveOverloadHdr","DMUCopyHdr","DMUCutHdr"):n=n.concat([{line:1,name:"DMURemoveOverloadStr",hdr_list:["DMURemoveOverloadHdr"]},{line:1,name:"DMUCopyStr",hdr_list:["DMUCopyHdr"]},{line:1,name:"DMUCutStr",hdr_list:["DMUCutHdr"]}])),R&&I&&(c?r.push("DMUPasteHdr","DMUPasteSpecialHdr"):n=n.concat([{line:1,name:"DMUPasteStr",hdr_list:["DMUPasteHdr"]},{line:1,name:"DMUPasteSpecialStr",hdr_list:["DMUPasteSpecialHdr"]}])),!M){p?c?r.push("ENO3DFocusOnCmd"):n.push({line:1,name:"FocusOn",hdr_list:["FocusOnHdr"]}):-1!==ne.indexOf("Document")&&-1!==ne.indexOf("Specification Report")||(c?r.push("DMUFocusOnRepresentationHdr"):n.push({line:1,name:"FocusOn",hdr_list:["DMUFocusOnRepresentationHdr"]})),"Requirement"===ne||"Requirement Specification"===ne?c?r.push("WebDocumentReframeOnHdr"):n.push({line:1,name:"ReframeOn",hdr_list:["WebDocumentReframeOnHdr"]}):"Drawing"===ne||"DIFLayout"===ne||"DIFSheet"===ne?c?r.push("DMUReframeOnRepresentationHdr"):n.push({line:1,name:"ReframeOn",hdr_list:["DMUReframeOnRepresentationHdr"]}):c?r.push("ENO3DReframeOnCmd"):n.push({line:1,name:"ReframeOn",hdr_list:["ReframeOnHdr"]});let e=!G.getController().isRootSupported||g.length>=1&&g[0].pathElement.externalPath.length>=2&&G.getController().isRootSupported(l.getNodeID(g[0].pathElement.externalPath[1]));if(b&&p&&e){let e,t,o=!1;for(let n=0;n<g.length;n++){for(e=g[n].pathElement.clone();e&&e.internalPath.length;)e=e.getParentPath();if((t=l.getLastReference(e))&&l.isReference(t.getLastElement(!0))){o=!0;break}}t&&t.externalPath.length<=2&&(o=!1),o&&(c?r.push("DMUHideShowOverloadHdr"):n.push({line:1,name:"DMUHideShowOverloadStr",hdr_list:["DMUHideShowOverloadHdr"]}))}1===g.length&&"Drawing"!==Se&&G.getRootBagPath().isAParentOf(g[0].pathElement)&&(c?r.push("DMUNavOnImplementationLinksHdr"):n.push({name:"DMUNavOnImplementationLinksStr",line:1,hdr_list:["DMUNavOnImplementationLinksHdr"]})),c?r.push("ActionBar_Attributes"):n.push({line:1,name:"EditPropertiesCmd",hdr_list:["ActionBar_Attributes"]}),p&&e&&(c?a.push({category:"Geometry Quality",hdrs:["OptimizedQualityCmd","HighQualityCmd"]}):n.push({line:1,name:"PAD3DViewerToggleGeometrySection",resourceFile:"ENOPAD3DViewer/ENOPAD3DViewer",hdr_list:["PAD3DToggleSimplifiedHdr","PAD3DToggleAccurateHdr"]}));let t=A.getEditCmd(G.getViewer());t&&t.isEnabled()&&(c&&Se&&"2D"!==Se&&"Document"!==Se&&"Specification Report"!==Se&&"DIFLayout"!==Se&&"DIFSheet"!==Se&&"Drawing"!==Se&&"Requirement"!==Se&&"Requirement Specification"!==Se?t.isRunning()?r.push("DMUExitClippingEditionHdr"):r.push("DMUClippingEditionHdr"):c||(n=n.concat([{line:1,name:"DMUClippingEditStr",hdr_list:t.isRunning()?["DMUExitClippingEditionHdr"]:["DMUClippingEditionHdr"]}])))}}if(c){for(let e=0;e<r.length;e++)"ENO3DToggleStatusBarCmd"===r[e]?n.push({type:"WAfrCheckHandlerItem",handlerId:r[e]}):n.push({type:"WAfrDefaultHandlerItem",handlerId:r[e]});return a.forEach(e=>{let t={type:"PushItem",title:e.category,submenu:[]};for(let n=0;n<e.hdrs.length;n++)"ENO3DToggleStatusBarCmd"===e.hdrs[n]?t.submenu.push({type:"WAfrCheckHandlerItem",handlerId:e.hdrs[n]}):t.submenu.push({type:"WAfrDefaultHandlerItem",handlerId:e.hdrs[n]});n.push(t)}),n}return{cmdList:n}}function ke(e){setTimeout(function(){if(!G)return;var t,n,a,s=o.getReviewContext({context:G}),c=function(){for(var e=0;e<n.length;e++)(t=r.getCommand(n[e],G.getCommandContext()))||(t=r.getCommandCheckHeader(n[e],G.getCommandContext())),t&&(a?t.enable():t.disable())};if(G.getExecutionContext){["Marker","Measure","Markup","Slide","Check","Highlight","Section"].forEach(e=>{o.setAuthoringFeatureTypes(e)})}n=["DMU2DCompareCmdHdr"],a=q&&0!==G.getViewer().getVisibleSpace()&&l.getRoots(G).length&&(!s||s&&!s.isReadOnly())&&("Drawing"===Se||"DIFSheet"===Se||"DIFLayout"===Se),c(),n=["DMUMarkupHdr","3DcompareCmdHdr","measure2DCmdHdr","measureCmdHdr","thicknessCmdHdr","sectionCmdHdr","LockUnlockSectionHdr"],a=q&&0!==G.getViewer().getVisibleSpace()&&l.getRoots(G).length&&(!s||s&&!s.isReadOnly()),c(),a=a&&s&&!s.isReadOnly()&&s.getCurrentSessionMarkup()&&!s.getCurrentSessionMarkup().isReadOnly(),n=["DMUEditFormatsHdr","slideCmdHdr","DMUExportReviewAsPdfHdr"],c(),a=a&&s&&!s.isReadOnly()&&s.getCurrentSessionMarkup()&&s.getCurrentSessionMarkup().getActiveFlag()&&s.getCurrentSessionMarkup().isVisible()&&s.getCurrentSessionMarkup().getCurrentSlide()&&!s.getCurrentSessionMarkup().isReadOnly(),n=["CATWebUXSlideShowHdr","markerTextCmdHdr","markerPictureCmdHdr","marker2DTextCmdHdr","marker2DPictureCmdHdr","markerCircleCmdHdr","DMUMarkerCloudCreateHdr","DMU3DRectangleCmdHdr","DMUFreehandCmdHdr","DMUCommentCmdHdr","markerArrowCmdHdr"],c(),n=["CATWebUXGenerateIssueHdr"],a=q&&0!==G.getViewer().getVisibleSpace()&&l.getRoots(G).length&&s&&s.getCurrentSessionMarkup()&&!we,c(),n=["CATWebUXGenerateIssueTemplateHdr","CATWebUXGenerateCAHdr"],a=q&&0!==G.getViewer().getVisibleSpace()&&l.getRoots(G).length&&s&&s.getCurrentSessionMarkup(),c(),a=q&&0!==G.getViewer().getVisibleSpace()&&l.getRoots(G).length&&s&&s.getCurrentSessionMarkup()&&s.getCurrentSessionMarkup().getSlides().length>0||q&&("Document"===te||"Specification Report"===ne||"Requirement"===ne||"Requirement Specification"===ne),n=["CATWebUXSlideShowHdr"],c(),a=q&&(!s||!s.isReadOnly())&&("Document"===te||"Specification Report"===ne||"Requirement"===ne||"Requirement Specification"===ne)&&ee&&ee.documentHasBookmarks(),n=["WebDocumentBookmarksPanelCmdHdr"],c(),a=q&&("Document"===te||"Specification Report"===ne||"Requirement"===ne||"Requirement Specification"===ne)&&ee&&ee.documentHasMultipleElements(),n=["WebDocumentPreviousPageCmdHdr","WebDocumentNextPageCmdHdr"],c(),a=q&&("Document"===te||"Specification Report"===ne||"Requirement"===ne||"Requirement Specification"===ne)&&ee&&"Document"===ee.getDocumentType(),n=["WebDocumentRotatePagesLeftCmdHdr","WebDocumentRotatePagesRightCmdHdr"],c(),a=q&&("Document"===te||"Specification Report"===ne||"Requirement"===ne||"Requirement Specification"===ne)&&ge&&ge.hasComments(),n=["DMUPreviousCommentCmdHdr","DMUNextCommentCmdHdr"],c();var u=i.getManager({name:"DMUUserExperienceManager",context:G.getFrameWindow()});let d;if(u&&u.refreshCommandsAvailability(),e&&e.removeRoot&&(d=!0),a=!0,"Specification Report"===te&&!d){a=!1;let e=r.getCommandCheckHeader("RootPanel",G.getCommandContext());e&&e.getState()&&e.setState(!1)}n=["RootPanel"],c()})}function Le(e){q&&(te!==e&&(ae&&te&&ae.removeApplicativeContainer(te),te=e,o.setCurrentReviewContext(te),z.publish("onReviewContextModified",{type:te,onABReady:function(){ke(),ae&&G.getExecutionContext&&ae.initApplicativeContainer(te,{authoring:!0})}}),ae&&ae.initApplicativeContainer(te,{authoring:!0})),ke())}function We(e,t){for(var n=[],o=l.getRoots(G),i=0;i<o.length;i++)if(!e||l.getNodeType(o[i])===e){var r=l.getNodeID(o[i]);r!==t&&n.push(r)}G.removeRoots({pids:n})}async function He(e){try{let t=await v.getParentTypes(e);return[e].concat(t)}catch{return[e]}}async function Be(e){if(!q||!e)return;var t,n;let i=k.giveReqCompareController({context:G}),r=!!i&&i.isRequirementCompareActive();if(Se=void 0,e.path?(t=l.getNodeID(e.path.getLastElement(!0)),n=G.getController().getRootStats(t)&&"r2vsurvey"===G.getController().getRootStats(t).serviceId?"R2V_FeatureState":l.getNodeType(e.path.getLastElement(!0))):e.docData&&(t=e.docData.objectId,n=e.docData.objectType),!t||!n)return;Se=n,ie&&ie.getLoadedID()===t||(Re&&ee&&(ee.updateDocumentControllers(),ee.isADocumentDisplayed()&&ee.getDocumentLoadedID()===t?(ie&&ie.setLoadedID(t),ee.initializeDMUEvents()):e.isCompareActive||r||ee.clean2DDocument()),!ge||Re||r||ge.cleanCommentsPanel()),re=null;var s=function(){Le("ITF")};var c=function(){if("DIFLayout"===n||"DIFSheet"===n)Le("2DFL"),me=n;else if("Drawing"===n){++Ae>1&&!be&&Ae===G.getRootBagPath().getChildrenPathes().length&&Oe("warning",L.multidropdrawing),Le("2D"),me=n,be||We(null,t);var e=setInterval(function(){var o,i,r,l;(1===G.getRootBagPath().getChildrenPathes().length||be&&2===G.getRootBagPath().getChildrenPathes().length)&&(clearInterval(e),o=t,i=n,r=G.getRootBagPath().getChildrenPathes()[G.getRootBagPath().getChildrenPathes().length-1].getLastElement(!0),ee.load2DDocument({phyID:o,dataType:i,serverUrl:C.get3DSpaceUrl(),securityContext:D.getSetting("pad_security_ctx"),parentNode:r,is2DCompareActive:be,onLoadingStarted:function(){a.on(),l=1},onComplete:function(){l&&(a.off(),l=0)},onFailure:function(){G.removeRoots({pids:[o]}),G.displayNotification({msg:L.fileWithNoSVG,eventID:"error"}),l&&(a.off(),l=0)}}))},100)}},u=function(){!ie||"DXF"!==ie.getLoadMarkupCtxType()&&"DWG"!==ie.getLoadMarkupCtxType()?r||(Le(n),me=n):(Le("2D"),me=n,We(null,t)),re=t};if("Drawing"===n||"DIFLayout"===n||"DIFSheet"===n&&e.path.getParentPath().isEqual(G.getRootBagPath()))c(),ne=n;else if("Document"===n||"Specification Report"===n||"Requirement"===n||"Requirement Specification"===n)u(),ge||(ge=p.getDMUCommentsController({context:G.getFrameWindow(),commandContext:G?G.getCommandContext():null})),i&&!i.isLoading()&&ge.setVisibleFlag(!0),ne=n;else if(G.getApplicativeData().getLoadedItfData&&G.getApplicativeData().getLoadedItfData().data.length>0)s(),ne="SIMItfSimulation";else if("DesignSight"===n)Le("MSR"),me=n,ne="MSR";else if("R2V_FeatureState"===n)!async function(){me&&(We(me,t),me=void 0),await async function(){const e=l.getRoots(G);let t=!1;for(let n=0;n<e.length;n++){let o=l.getNodeType(e[n]),i=0,r=await He(o);if(r.includes("VPMReference")||i===e.length-1)return r.includes("VPMReference")&&(t=!0),t;i++}}()||Le("R2V"),ie.load({data:{serviceId:"r2vsurvey",objectParentType:"R2V_FeatureState",objectType:"R2V_FeatureState",objectId:t}})}();else{let i=await He(n);i&&i.length&&-1!==i.indexOf("Drawing")&&e.path.getParentPath().isEqual(G.getRootBagPath())?(n=ne="Drawing",c()):i&&i.length&&-1!==i.indexOf("SIMItfSimulation")&&e.path.getParentPath().isEqual(G.getRootBagPath())?(n=ne="SIMItfSimulation",s()):i&&i.length&&(-1!==i.indexOf("Requirement")||-1!==i.indexOf("Requirement Specification"))?(n=-1!==i.indexOf("Requirement Specification")?"Requirement Specification":"Requirement",ne="Requirement",u()):i&&i.length&&(-1!==i.indexOf("Document")||-1!==i.indexOf("Specification Report"))?(n=ne=-1!==i.indexOf("Document")?"Document":"Specification Report",u()):ve?G.removeRoots({pids:[t]}):function(){me&&(We(me,t),me=void 0);let e=!0;const n=o.getReviewContext({context:G}),i=n?n.getCurrentSessionMarkup():null;if(i){const t=i.getApplicativeContext();t&&t.PIM&&(e=!1)}e&&Le("3D")}()}ke()}let je=null;function Xe(){var e=o.getReviewContext({context:G}),t=e?e.getCurrentSessionMarkup():null;if(q&&!pe&&t&&e.getReviewCtxInformation()&&t&&!t.isReadOnly()&&t.isDirty()&&!t.isImporting()){if(h.isProcessing())return je&&(clearTimeout(je),je=null),void(je=setTimeout(Xe,1e3));if(!G||!q||pe||!o.getReviewContext({context:G}))return;var n=null,i=null,r=null,a=null,l=null;if(!ie||"Document"!==ne&&"Specification Report"!==ne||(a=ie.getDocumentVersionInfos(),r=ne,l=ie.getLoadMarkupCtxType()),G.getApplicativeData&&(G.getApplicativeData(),G.getApplicativeData().getLoadedItfData)){let e=G.getApplicativeData().getLoadedItfData();e.data.length&&(e.data[0].metricID&&(n=e.data[0].metricID),void 0!==e.loadMode&&(i=e.loadMode),r="SIMItfSimulation")}_.tryToSaveData({frameWindow:G.getFrameWindow(),saveFunction:()=>h.saveCurrent3DMarkup({newFile:he,frmWindow:G.getFrameWindow(),superType:r,documentType:l,listData:n,loadingInfos:i,documentVersionInfos:a})}).then(()=>{if(G){var e=o.giveEventsController({viewer:G.getViewer()});e&&e.fireEvent("on3DMarkupSaved")}}).catch(()=>{if(G){var e=o.giveEventsController({viewer:G.getViewer()});e&&e.fireEvent("on3DMarkupSaveFailed")}}),he=!1}}function Ne(){Xe(),ke()}function qe(){const e=o.getReviewContext({context:G});(e?e.getCurrentSessionMarkup():null)&&setTimeout(()=>{G.toggleSOITimelinesUsability(!1)},1e3)}function Ge(e){if(q){pe=!1;var t=E.giveDMUSceneDisplayController({context:G});if((!t||!t.getCurrentComparedObjectIDPaths()&&oe&&oe.getActiveState())&&oe.setActiveState(!1),e.id===sessionStorage.getItem("DMU2DCompareTempRoot"))G.removeRoots({pids:[sessionStorage.getItem("DMU2DCompareTempRoot")]}),sessionStorage.removeItem("DMU2DCompareTempRoot");else if(e.path)Be({path:e.path});else{var n=G.getRootBagPath().externalPath[0].path.getChildrenPathes().length;if(n)Be({path:G.getRootBagPath().externalPath[0].path.getChildrenPathes()[n-1]})}}}function ze(e){if(!q)return;!G.getRootBagPath().getChildrenPathes().length&&oe&&oe.getActiveState()&&oe.setActiveState(!1);let t=k.giveReqCompareController({context:G});if(!!t&&t.isLoading()||(ee&&(e&&e.id?ee.clean2DDocument(e):ee.clean2DDocument()),ge&&(ge.cleanCommentsPanel(),p.unreferenceDMUCommentsController({context:G.getFrameWindow()}),ge=null)),ie&&(ie.clean(),ie.updateLoadedR2VInformations(e.id,"remove")),Se&&"R2V_FeatureState"===Se&&G.toggleSOITimelinesUsability(!0),G.getRootBagPath().getChildrenPathes().length){var n=G.getRootBagPath().externalPath[0].path.getChildrenPathes().length;let e;n&&(e=G.getRootBagPath().externalPath[0].path.getChildrenPathes()[n-1]),Se=l.getNodeType(e.getLastElement(!0))}else pe=!0,o.setReviewContext({context:G});ke({removeRoot:!0}),re=null,Ae=0}function Qe(){G.unsubscribe(J.onRootRemoved),J.onRootRemoved=-1}function Je(){J.onRootRemoved=G.subscribe({event:"onRootRemoved"},ze)}var Ye;function Ke(e){Ye=T.getNearPositionFrom2DCoordinates({x:e.clientX,y:e.clientY},G.getViewer())}function Ze(e){q&&z&&e&&C.multiTenantMgt([e],l.getRoots(G),function(t){if(!t.isMultiTenant){var n=o.getReviewContext({context:G}),i=n?n.getCurrentSessionMarkup():null;if(!i||i.isReadOnly()||!i.getCurrentSlide())return;w.getDataFromRelatedId({type:"DMUMarker3DPicture",objectId:e.objectId,onComplete:function(t){var n=I.create3DMarker({viewer:G.getViewer(),frameWindow:G.getFrameWindow(),parent:i,date:Date.now(),objectId:e.objectId,shape:{type:"picture",pointingPoint:Ye,data:t}});n&&(i.getCurrentSlide().addDMUObject(n),n.fireEvent("onDMUObjectInitialized",{dmuObject:n}))}})}})}function $e(e){q&&z&&e&&Ve&&C.multiTenantMgt([e],l.getRoots(G),function(t){t.isMultiTenant||z.loadMarkupContext(e)})}this.setActiveState=async function(e){const t=()=>C.get3DSpaceUrl(),r=()=>C.getPlatformId(),a=()=>D.getSetting("pad_security_ctx");let u,d,v,h;if(v={_Markup:function(e){q&&z&&e&&C.multiTenantMgt([e],l.getRoots(G),function(t){t.isMultiTenant||z.loadReview(e)})},_DMUMarkupRepReference:function(e){q&&z&&e&&C.multiTenantMgt([e],l.getRoots(G),function(t){t.isMultiTenant||z.loadReview(e)})},...F.getDelegation(G,function(){j.fireEvent("onApplyingSlideView")})},e!==q){if(q=e){var R=["DS/PIMwebViewController/PIMwebItfCtrl"];await new Promise(e=>{require(R,function(t){var n=t.getLoaderForMarkup({context:G});n.subscribe("onDMUCtxtLoadingSuccess",function(){Le("ITF")}),n.subscribe("onDMUCtxtRemoved",function(){o.getReviewContext({context:G})&&o.removeReviewContext({context:G}),Le("3D")}),e()})}),ie||(ie=U.getLoadingContextController({context:G}));let e=function(e){return new Promise((n,o)=>{let i=t()+"/resources/dictionary/getTypeInfo?tenant="+r(),l=a();require("DS/WAFData/WAFData").authenticatedRequest(i+"&SecurityContext="+l,{method:"POST",type:"json",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:l},data:JSON.stringify(e),onComplete:function(e){n(e)},onFailure:function(e){o(e)},onTimeout:function(e){o(e)}})})};try{let t=await e(Ee);Object.keys(t).forEach(e=>{v["_"+e]=$e}),G.setLoadingDelegations(v)}catch{Ee.forEach(e=>{v["_"+e]=$e}),G.setLoadingDelegations(v)}if((De=V.getSelectionManager({context:G})).setActiveState(!0),fe={activated:G.getViewer().picking.activated,trapSelection:G.getViewer().picking.trapSelection,trapGPU:G.getViewer().picking.trapGPU},Ce={activated:G.getViewer().pPicking.activated},G.getViewer().setPicking({activated:!0,trapSelection:!0,trapGPU:!0}),G.getViewer().setPrePicking({activated:!0}),j=o.getEventsController({viewer:G.getViewer()}),O.subscribe({event:"ENXViews/WelcomePanel/openContent"},async e=>{let t=e.unserializedData?e.unserializedData.data.items:null;if(t&&t.length>1)for(const e of t){const t=await He(e.objectType);if(!t.includes("VPMReference")&&!t.includes("R2V_FeatureState")){Ve=!1,Oe("warning",L.dropMultiNoAutorized);break}}else Ve=!0}),K.onDMUMarkupApplicativeContextLoaded=j.addEvent("onDMUMarkupApplicativeContextLoaded",function(e){e.markupHasApplicativeContext&&z.publish("onReviewContextModified",{type:"ITF",onABReady:ke})}),K.onMarkupMaturityModificationRequested=j.addEvent("onMarkupMaturityModificationRequested",function(e){!function(e){var t;const n=()=>C.get3DSpaceUrl(),i=()=>C.getPlatformId();var r=o.getReviewContext({context:G});const a=r&&r.getReviewCtxInformation();var l=r.getCurrentSessionMarkup(),s={data:[{physicalid:a.reviewId,name:l.getAttribute("sName"),fromstate:e.fromState,tostate:e.toState,type:"DMUMarkupRepReference"}]};t=n()+"/resources/lifecycle/maturity/promote?tenant="+i(),require("DS/WAFData/WAFData").authenticatedRequest(t,{method:"POST",type:"json",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:D.getSetting("pad_security_ctx")},timeout:36e5,data:JSON.stringify(s),onComplete:function(t){t&&t.results&&t.results.length&&t.results[0].current?(l.setMaturityState(t.results[0].current),j&&j.fireEvent("onMarkupObjectAttributesModified",{object:l,attr:[{currentState:t.results[0].current}]})):j&&j.fireEvent("onMarkupObjectAttributesModified",{object:l,attr:[{currentState:e.fromState}]})},onFailure:function(){j&&j.fireEvent("onMarkupObjectAttributesModified",{object:l,attr:[{currentState:e.fromState}]})},onTimeout:function(){j&&j.fireEvent("onMarkupObjectAttributesModified",{object:l,attr:[{currentState:e.fromState}]})}})}(e)}),K.onDMUMarkupApplicativeContextCleaned=j.addEvent("onDMUMarkupApplicativeContextCleaned",function(){z.publish("onReviewContextModified",{type:"3D",onABReady:ke})}),K.onDMUApplicativeContextClean=j.addEvent("onDMUApplicativeContextClean",function(e){R=["DS/PIMwebViewController/PIMwebItfCtrl"],require(R,function(t){t.cleanApplicativeContext(e.applicativeContext,G)})}),K.onDMUObjectDeleted=j.addEvent("onDMUObjectDeleted",function(e){e&&e.dmuObject&&e.dmuObject.getParent()&&e.dmuObject.getParent().getType&&"DMUTemporaryBag"!==e.dmuObject.getParent().getType()&&Ne(),e&&e.dmuObject&&("DMUCompare3D"===e.dmuObject.getType()||"DMUCompare2D"===e.dmuObject.getType())&&ke()}),K.onReviewRemoved=j.addEvent("onReviewRemoved",function(){G.elements.container.removeEventListener("drop",Ke),G.setLoadingDelegations(v)}),K.onDMUObjectInitialized=j.addEvent("onDMUObjectInitialized",function(e){if(e&&e.dmuObject&&(e.dmuObject.getParent()&&e.dmuObject.getParent().getType&&"DMUTemporaryBag"!==e.dmuObject.getParent().getType()&&Ne(),"DMUMarkup"===e.dmuObject.getType()))if(G.elements.container.removeEventListener("drop",Ke),"2DFL"===te){G.elements.container.addEventListener("drop",Ke);var t={_EleLogicalRelay:Ze,_EleLogicalContact:Ze,_EleLogicalOperatingDevice:Ze,_EleLogicalSingleConnector:Ze,_EleLogicalInlineConnector:Ze,_EleLogicalShellConnector:Ze,_EleLogicalSplice:Ze,_EleLogicalTerminalBoard:Ze,_EleLogicalBusbar:Ze,_EleLogicalHarness:Ze,_EleLogicalNet:Ze,_EleLogicalNetGroup:Ze,_EleLogicalWire:Ze,_EleLogicalWireShield:Ze,_EleLogicalCable:Ze,_EleLogicalCableShielded:Ze,_EleLogicalCableTwisted:Ze,_EleLogicalCableTwistedShielded:Ze,_EleLogicalOverShield:Ze,_EleLogicalPowerCable:Ze,_EleLogicalCoaxCable:Ze,_EleLogicalCableGroup:Ze,_EnsLogicalEquipment:Ze,_EnsInCLoop:Ze,_EnsInCLogicalRoute:Ze,_EnsInCLogicalBranch:Ze,_EnsInCLogicalComponent:Ze,_Piping_Logical_Miscellaneous:Ze,_Piping_Logical_Branch:Ze,_Piping_Logical_Instrument:Ze,_Piping_Logical_Reducer:Ze,_Piping_Logical_Valve:Ze,_Piping_Logical_Pipe:Ze,_Piping_Line:Ze,_ICLoop_Line:Ze,_HVAC_Logical_Miscellaneous:Ze,_HVAC_Logical_Branch:Ze,_HVAC_Logical_Instrument:Ze,_HVAC_Logical_Reducer:Ze,_HVAC_Logical_Damper:Ze,_HVAC_Logical_Duct:Ze,_HVAC_Line:Ze};G.setLoadingDelegations(Object.assign({},t,v))}else G.setLoadingDelegations(v)}),K.onDMUMarkupCreationSucceeded=j.addEvent("onDMUMarkupCreationSucceeded",function(){he=!0,Ne()}),K.onSlideApplicativeContextModified=j.addEvent("onSlideApplicativeContextModified",function(e){e&&e.dmuObject&&("DMUSlide"===e.dmuObject.getType()||"DMUFormat"===e.dmuObject.getType())&&Ne()}),K.onDMUOccOverloadRemoved=j.addEvent("onDMUOccOverloadRemoved",Ne),K.onDMUSlideSessionInfoChanged=j.addEvent("onDMUSlideSessionInfoChanged",function(e){e&&e.dmuObject&&("DMUSlide"===e.dmuObject.getType()||"DMUFormat"===e.dmuObject.getType())&&Xe()}),K.onDMUSlideNameChanged=j.addEvent("onDMUSlideNameChanged",Xe),K.onSaveRequested=j.addEvent("onSaveRequested",Xe),K.onDMUCurrentSlideChanged=j.addEvent("onDMUCurrentSlideChanged",ke),K.onComparisonStarted=j.addEvent("onComparisonStarted",function(e){e&&e.is2DCompare&&(be=!0),ke()}),K.onComparisonEnded=j.addEvent("onComparisonEnded",function(){be=!1,ke()}),K.onFormatsEditionModeStarted=j.addEvent("onFormatsEditionModeStarted",function(){z.publish("onReviewContextModified",{type:te+"Formats",onABReady:ke})}),K.onFormatsEditionModeEnded=j.addEvent("onFormatsEditionModeEnded",function(){z.publish("onReviewContextModified",{type:"RefreshAB",onABReady:ke})}),K.onReviewCtxInformationChanged=j.addEvent("onReviewCtxInformationChanged",function(e){e&&e.reviewId&&G&&G.getWidget()&&G.getWidget().dispatchEvent("onDMUMarkupLoaded",{reviewID:e.reviewId,reviewType:e.reviewType})}),K.onDMUObjectReadOnlyFlagChanged=j.addEvent("onDMUObjectReadOnlyFlagChanged",function(e){"Markup"===e.dmuObject.getAttribute("sType")&&ke()}),K.onDMUObjectActiveFlagChanged=j.addEvent("onDMUObjectActiveFlagChanged",ke),K.onDMUObjectVisibleFlagChanged=j.addEvent("onDMUObjectVisibleFlagChanged",ke),K.onApplicativeContextCommandsRequired=j.addEvent("onApplicativeContextCommandsRequired",function(e){z.publish("onReviewContextModified",{type:"Data",data:e,onABReady:e.cb})}),K.on2DDocumentLoadSuccess=j.addEvent("on2DDocumentLoadSuccess",function(){ke(),ve=!1}),K.onDXFLoadSuccess=j.addEvent("onDXFLoadSuccess",function(){Le("2D")}),K.onR2VMarkupCreationSuccess=j.addEvent("onR2VMarkupCreationSuccess",function(){Le("R2V")}),K.onLoadingReviewContext=j.addEvent("onLoadingReviewContext",function(e){"Document"!==e.rootType&&"Specification Report"!==e.rootType&&"Requirement Specification"!==e.rootType&&"Requirement"!==e.rootType||ge||(ge=p.getDMUCommentsController({context:G.getFrameWindow(),commandContext:G.getCommandContext()}))}),K.onPreviewThumbnailUpdateRequested=j.addEvent("onPreviewThumbnailUpdateRequested",function(e){const t=(d=o.getReviewContext({context:G}))&&d.getReviewCtxInformation();t&&(e.thumbnailData?M.saveObjectThumbnail("markup2dthumbnail",e.thumbnailData,t.reviewId):M.deleteMarkupThumbnail("markup2dthumbnail",t.reviewId))}),X=n.getLoadMarkupServices({context:G}),N=G.getExecutionContext?ke():G.getFrameWindow().getActionBar().onActionBarReady(ke),(ee=i.getManager({name:"DMU2DSheetManager",context:G.getFrameWindow()}))||(ee=new g({ctxViewer:G}),i.addManager({name:"DMU2DSheetManager",context:G.getFrameWindow(),manager:ee})),ge||(ge=p.getDMUCommentsController({context:G.getFrameWindow(),commandContext:G?G.getCommandContext():null})),oe||(oe=new m({context:G})),J.onApplyFilterBegin=G.subscribe({event:"onBeginFilterApplied"},Qe),J.onFilterApplied=G.subscribe({event:"onFilterApplied"},Je),J.onLoadingFailure=G.subscribe({event:"onLoadingFailure"},Je),J.onApplyFilterBegin=G.subscribe({event:"onBeginFilterRemoved"},Qe),J.onFilterApplied=G.subscribe({event:"onFilterRemoved"},Je),J.onRootAdded=G.subscribe({event:"onRootAdded"},Ge),J.onRootAdded=G.subscribe({event:"onR2VLoaded"},qe),J.onRootRemoved=G.subscribe({event:"onRootRemoved"},ze),J.onRootAttached=G.subscribe({event:"onRootAttached"},Ge),J.onRootDetached=G.subscribe({event:"onRootDetached"},ze),J.onRefresh=G.subscribe({event:"onRefresh"},()=>{Te=!0}),J.onRefreshBegin=G.subscribe({event:"onRefreshBegin"},()=>{pe=!0,Te||(ge&&ge.cleanCommentsPanel(),G.unsubscribe(J.onRootRemoved),J.onRootRemoved=-1)}),J.onRefreshCompleted=G.subscribe({event:"onRefreshCompleted"},function(){pe=!1,Te?Te=!1:setTimeout(()=>{J.onRootRemoved=G.subscribe({event:"onRootRemoved"},ze)})}),Y=G.getViewer().onSwapVisibleSpace(ke),ae=f.getDMUApplicativeContextManager({context:G}),(d=o.getReviewContext({context:G}))&&d.getCurrentSessionMarkup()){var y=!1,x=d.getReviewCtxInformation();if(x&&x.contextId){var I=G.getRootBagPath().getChildrenPathes(),w=null;for(G.getApplicativeData().getLoadedItfData&&G.getApplicativeData().getLoadedItfData().data.length>0&&(w=G.getApplicativeData().getLoadedItfData().data[0].isrID),u=0;u<I.length;u++){var A=l.getNodeID(I[u].getLastElement(!0));if(G.getController().isFiltered(A).filterId&&(A=G.getController().isFiltered(A).filterId),A===x.contextId||w===x.contextId){d.getCurrentSessionMarkup().setActiveFlag(!0),!1!==x.modifiable&&d.setReadOnly(!1),y=!0;break}}y||d.setCurrentSessionMarkup(null)}}de=G.getViewer().sectionCappingEnabled,G.getViewer().setSectionCapping(!0),(ue=G.isRobotVisible())&&G.setRobotVisibility(!1),G.getFrameWindow().getContextualUIManager().registerUnshift({subscriberId:"3DReviewWebAppCtxElements",workbenchName:"DMU3DReviewController",context:G.getCommandContext(),module:"DMU3DReviewController",cmdPrefix:"",directory:"assets/afr/",merge:!0,onContextualBarReady:Fe,onContextualMenuReady:_e}),(le=G.isDefaultContextualBarVisible())&&G.setDefaultContextualBarVisibility(!1),(se=G.isDefaultContextualMenuVisible())&&G.setDefaultContextualMenuVisibility(!1),(ce=G.isOpenWithMenuAvailable())||G.setOpenWithMenuAvailability(!0),S.setSlidePreferences({context:G.getFrameWindow(),preferences:{displayNominal:!0}}),await async function(){var e=b.getPreferenceManager({context:G.getFrameWindow()});if(e){if(e.setUnitsPreferencesDisplayFlag(!0),e.setDisplayPreferencesDisplayFlag(!0),e.set3DSelectionPreferencesDisplayFlag(!0),e.set2DSelectionPreferencesDisplayFlag(!0),e.setExportPreferencesDisplayFlag(!0),e.setMeasurePreferencesDisplayFlag(!0),e.setClippingPreferencesDisplayFlag(!0),e.addPreferences([{nls:L.preferences.markupSectionTitle,id:"MarkupPreferences",type:"section",preferences:[{nls:L.preferences.QuickCreationLbl,id:"DisplayMarkupCreationDialog",type:"checkbox",getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_DisplayMarkupCreationDialog")},getDefaultValue:function(){return!0},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_DisplayMarkupCreationDialog"))&&localStorage.setItem("CATWebUXMePreferences_DisplayMarkupCreationDialog",e?"true":"false")}},{nls:L.preferences.automaticallyCreateFirstSlide,id:"CreateFirstSlide",type:"checkbox",getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_CreateFirstSlide")},getDefaultValue:function(){return!0},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_CreateFirstSlide"))&&localStorage.setItem("CATWebUXMePreferences_CreateFirstSlide",e?"true":"false")}}]},{nls:L.preferences.slideSectionTitle,id:"SlidePreferences",type:"section",preferences:[{nls:L.preferences.slideNameFromFeature,id:"SlideNameFromFeature",type:"checkbox",getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_SlideNameFromFeature")},getDefaultValue:function(){return!0},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_SlideNameFromFeature"))&&localStorage.setItem("CATWebUXMePreferences_SlideNameFromFeature",e?"true":"false")}},{nls:L.preferences.slideTitleDisplayLbl,id:"DisplaySlideTitle",type:"checkbox",getValue:function(){return"true"===localStorage.getItem("CATWebUXMePreferences_DisplaySlideTitle")},getDefaultValue:function(){return!1},setValue:function(e){e!==("true"===localStorage.getItem("CATWebUXMePreferences_DisplaySlideTitle"))&&localStorage.setItem("CATWebUXMePreferences_DisplaySlideTitle",e?"true":"false")}},{nls:L.preferences.slideCaptureSpecLayers,id:"CaptureSpecLayers",type:"checkbox",getValue:function(){return"true"===localStorage.getItem("CATWebUXMePreferences_CaptureSpecLayers")},getDefaultValue:function(){return!1},setValue:function(e){e!==("true"===localStorage.getItem("CATWebUXMePreferences_CaptureSpecLayers"))&&localStorage.setItem("CATWebUXMePreferences_CaptureSpecLayers",e?"true":"false")}},{nls:L.preferences.slideEnableDrag,id:"SlideDragAndDropOperation",type:"radio",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_SlideDragAndDropOperation")||"SlideReorder"},getDefaultValue:function(){return"SlideReorder"},setValue:function(e){e!==localStorage.getItem("CATWebUXMePreferences_SlideDragAndDropOperation")&&localStorage.setItem("CATWebUXMePreferences_SlideDragAndDropOperation",e)},options:[{id:"SlideReorder",nls:L.preferences.enableReorder},{id:"TransferView",nls:L.preferences.enableDragContent}]}]},{nls:L.preferences.handlesSectionTitle,id:"HandlesPreferences",type:"section",preferences:[{prefixnls:L.preferences.gridSpacingPrefix,suffixnls:L.preferences.gridSpacingSuffix,id:"SnapHandlesToGrid",type:"checkbox+spinbox",disableSpinboxAtUncheck:!0,getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_SnapHandlesToGrid")},getSpinBoxValues:function(){var e=parseFloat(localStorage.getItem("CATWebUXMePreferences_SnapHandlesGridValue"));e=isNaN(e)?.001:e;var t=localStorage.getItem("CATWebUXMePreferences_Length")||"Millimeter";return{value:e="Inch"===(t="Foot"===t?"Inch":"Centimeter"===t||"Meter"===t||"Kilometer"===t?"Millimeter":t)||"Millimeter"===t?P.convert(e,"Length","Meter",t):e,units:t,minValue:"Millimeter"===t?1:.01,stepValue:"Millimeter"===t?1:.01}},getDefaultValue:function(){return!0},getSpinBoxDefaultValues:function(){return{value:1,units:"Millimeter",minValue:1,stepValue:1}},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_SnapHandlesToGrid"))&&localStorage.setItem("CATWebUXMePreferences_SnapHandlesToGrid",e?"true":"false")},setSpinBoxValue:function(e){var t=parseFloat(localStorage.getItem("CATWebUXMePreferences_SnapHandlesGridValue"));e!==(t=isNaN(t)?1:t)&&localStorage.setItem("CATWebUXMePreferences_SnapHandlesGridValue",e)}},{prefixnls:L.preferences.rotSnappingPrefix,suffixnls:"("+L.preferences.rotSnappingSuffix+")",id:"SnapRotationToggle",type:"checkbox+spinbox",disableSpinboxAtUncheck:!1,getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_SnapRotationToggle")},getSpinBoxValues:function(){var e=parseFloat(localStorage.getItem("CATWebUXMePreferences_SnapRotationAngle"));e=isNaN(e)?1.5708:e;var t=localStorage.getItem("CATWebUXMePreferences_Angle")||"Degree";return{value:e="Degree"===t?Math.round(P.convert(e,"Angle","Radian",t)):e,units:t,minValue:"Degree"===t?1:.01,stepValue:"Degree"===t?1:.01}},getDefaultValue:function(){return!0},getSpinBoxDefaultValues:function(){return{value:90,units:"Degree",minValue:1,maxValue:360,stepValue:1}},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_SnapRotationToggle"))&&localStorage.setItem("CATWebUXMePreferences_SnapRotationToggle",e?"true":"false")},setSpinBoxValue:function(e){var t=parseFloat(localStorage.getItem("CATWebUXMePreferences_SnapRotationAngle"));e!==(t=isNaN(t)?90:t)&&localStorage.setItem("CATWebUXMePreferences_SnapRotationAngle",e)}}]},{nls:L.preferences.compareSectionTitle,id:"ComparePreferences",type:"section",preferences:[{nls:L.preferences.firstProductColor,id:"CompareFirstColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_CompareFirstColor")?localStorage.getItem("CATWebUXMePreferences_CompareFirstColor"):"#FF0000"},getDefaultValue:function(){return"#FF0000"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_CompareFirstColor",e)}},{nls:L.preferences.secondProductColor,id:"CompareSecondColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_CompareSecondColor")?localStorage.getItem("CATWebUXMePreferences_CompareSecondColor"):"#00FF00"},getDefaultValue:function(){return"#00FF00"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_CompareSecondColor",e)}},{nls:L.preferences.compare3DCommonColor,id:"Compare3DCommonColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_Compare3DCommonColor")?localStorage.getItem("CATWebUXMePreferences_Compare3DCommonColor"):"#D3D3D3"},getDefaultValue:function(){return"#D3D3D3"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_Compare3DCommonColor",e)}},{nls:L.preferences.compare2DCommonColor,id:"Compare2DCommonColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_Compare2DCommonColor")?localStorage.getItem("CATWebUXMePreferences_Compare2DCommonColor"):"#000000"},getDefaultValue:function(){return"#000000"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_Compare2DCommonColor",e)}}]},{nls:W.ticSection,id:"TICSection",type:"section",preferences:[{nls:W.ticTemplateIssue,type:"checkbox",id:"TICTemplateIssue",setValue:function(e){localStorage.setItem("TICTemplateIssue",e)},getValue:function(){return"true"===localStorage.getItem("TICTemplateIssue")},getDefaultValue:function(){return!1}}]}]),e.setPreferredPreferenceContainersOrder(["MarkupPreferences","SlidePreferences","HandlesPreferences","TICSection","MeasurePreferences","PIMwebPrefLoad","PIMwebPrefDisplay","SectionPreferences","ComparePreferences"]),G.getViewer().get2DMode()){try{Ue="true"===(await P.readPreferences([{Repository:"SelectionRepository",PreferenceNames:["Select2DGeometry"]}])).repositories[0].preferences[0].value}catch(e){Ue=!1,window.console.warn("Could not get server value, default value set instead.",e)}De&&De.setPicking(Ue?0:1)}else{try{let e=(await P.readPreferences([{Repository:"VisualizationRepository",PreferenceNames:["Gravity"]},{Repository:"FrameGeneral",PreferenceNames:["ProjectionType"]},{Repository:"SelectionRepository",PreferenceNames:["Select3DGeometry","SelectParentReferenceOr3DShape"]},{Repository:"TICSection",PreferenceNames:["TICTemplateIssue"]}])).repositories;for(let t=0;t<e.length;t++)if("VisualizationRepository"===e[t].name)Pe="true"===e[t].preferences[0].value;else if("FrameGeneral"===e[t].name)ye=e[t].preferences[0].value;else if("SelectionRepository"===e[t].name){let n=e[t].preferences;for(let e=0;e<n.length;e++)"Select3DGeometry"===n[e].name?xe="true"===n[e].value:"SelectParentReferenceOr3DShape"===n[e].name&&(Ie=n[e].value)}else"TICSection"===e[t].name&&(we="true"===e[t].preferences[0].value)}catch(e){Pe=!1,we=!1,ye="Perspective",xe=!1,Ie="selectParentReference",window.console.warn("Could not get server value, default value set instead.",e)}"boolean"==typeof Pe&&(G.getViewer().currentViewpoint.getControl().setRotationRolling(!Pe),G.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!Pe)),"Perspective"!==ye&&"Parallel"!==ye||G.getViewer().currentViewpoint.setProjectionType("Perspective"===ye?0:1),De&&De.setPicking(xe?0:1),De&&De.selectParentReference("select3DShape"!==Ie)}$=e.subscribe("com.ds.mep:onPrefUpdate",function(e){let t=JSON.parse(e[1].preferences);for(let e=0;e<t.repositories.length;e++)for(let n=0;n<t.repositories[e].preferences.length;n++)"SelectParentReferenceOr3DShape"===t.repositories[e].preferences[n].name?(Ie=t.repositories[e].preferences[n].value,De&&De.selectParentReference("select3DShape"!==Ie)):"Select3DGeometry"===t.repositories[e].preferences[n].name?(xe="true"===t.repositories[e].preferences[n].value,De&&De.setPicking(xe?0:1)):"Select2DGeometry"===t.repositories[e].preferences[n].name?(Ue="true"===t.repositories[e].preferences[n].value,De&&G.getViewer().get2DMode()&&De.setPicking(Ue?0:1)):"ProjectionType"===t.repositories[e].preferences[n].name?(ye=t.repositories[e].preferences[n].value,G&&G.getViewer()&&G.getViewer().currentViewpoint&&G.getViewer().currentViewpoint.setProjectionType(ye)):"Gravity"===t.repositories[e].preferences[n].name?(Pe="true"===t.repositories[e].preferences[n].value,G&&G.getViewer()&&G.getViewer().currentViewpoint&&G.getViewer().currentViewpoint.control&&(G.getViewer().currentViewpoint.getControl().setRotationRolling(!Pe),G.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!Pe))):"TICTemplateIssue"===t.repositories[e].preferences[n].name&&(we="true"===t.repositories[e].preferences[n].value,ke())})}}(),G.getRootBagPath()&&G.getRootBagPath().getChildrenPathes().length&&Be({path:G.getRootBagPath().getChildrenPathes()[0]})}else{var T;if(V.unreferenceSelectionManager({context:G}),De=null,_.clean(),je&&(clearTimeout(je),je=null),fe&&G.getViewer().setPicking(fe),Ce&&G.getViewer().setPrePicking(Ce),Ce=null,Ce=null,G.elements.container.removeEventListener("drop",Ke),h=b.givePreferenceManager({context:G.getFrameWindow()})){for(T=Object.keys(Z),u=0;u<T.length;u++)h.unsubscribe(Z[T[u]]);Z={},h.removePreferences(["MarkupPreferences","HandlesPreferences"])}if(b.unreferencePreferenceManager({context:G.getFrameWindow()}),G.setLoadingDelegations({}),G.getFrameWindow().getActionBar().removeCallback(N),G.getFrameWindow().getContextualUIManager().unregister("3DReviewWebAppCtxElements"),void 0!==le&&G.setDefaultContextualBarVisibility(le),le=void 0,void 0!==se&&G.setDefaultContextualMenuVisibility(se),se=void 0,void 0!==ce&&G.setOpenWithMenuAvailability(ce),ce=void 0,void 0!==ue&&G.setRobotVisibility(ue),ue=void 0,void 0!==de&&G.getViewer().setSectionCapping(de),de=void 0,f.unreferenceDMUApplicativeContextManager({context:G}),ae=null,d=o.getReviewContext({context:G}),ee.isADocumentDisplayed())if(Re)d&&d.getCurrentSessionMarkup()?d.setReadOnly(!0):ee.removeDMUEvents();else{ee.clean2DDocument(),ge&&ge.cleanCommentsPanel();for(var E=[],k=l.getRoots(G),H=0;H<k.length;H++)E.push(l.getNodeID(k[H]));G.removeRoots({pids:E})}else d&&d.getCurrentSessionMarkup()&&(Re?d.setReadOnly(!0):d.getCurrentSessionMarkup().setActiveFlag(!1));for(s.empty(),c.empty(),T=Object.keys(J),u=0;u<T.length;u++)G.unsubscribe(J[T[u]]);if(J={},j){for(T=Object.keys(K),u=0;u<T.length;u++)j.removeEvent(K[T[u]]);o.unreferenceEventsController({viewer:G.getViewer()}),j=null}K={},oe&&(oe.clean(),oe=null),Re||(i.removeManager({name:"DMU2DSheetManager",context:G.getFrameWindow()}),ee=null,ge&&(ge=p.unreferenceDMUCommentsController({context:G.getFrameWindow()}),ge=null)),ie&&(U.unreferenceLoadingContextController({context:G}),ie=null),Y&&(G.getViewer().unsubscribe(Y),Y=null),$&&(h.unsubscribe($),$=null),n.unreferenceLoadMarkupServices({context:G}),X=null}ke()}},this.disableDMUContextualBar=function(){Me=!1,G.getFrameWindow().getContextualUIManager().getContextualBar().hide()},this.enableDMUContextualBar=function(){Me=!0},this.subscribe=function(e,t){if(e&&t&&Q)return Q.subscribe({event:e},t)},this.unsubscribe=function(e){Q&&e&&Q.unsubscribe(e)},this.getActiveState=function(){return q},this.clearController=function(){z.setActiveState(!1),G=z=Q=J=ee=ve=null},this.loadReview=function(e){var t=!1,n=o.getReviewContext({context:G});let i;n&&(t=(i=n.getReviewCtxInformation())&&i.reviewId===e.objectId),(n&&null===i||e.objectId&&!1===t&&X)&&X.load(e)},this.loadMarkupContext=async function(e){var t=!1,n=o.getReviewContext({context:G});if(n){var i=n.getReviewCtxInformation();t=i&&i.contextId===e.objectId}const r=await He(e.objectType);if(e.objectId&&!t&&ee||r&&r.length&&-1!==r.indexOf("SIMItfSimulation")){if(re===e.objectId)return void G.displayNotification({msg:L.documentAlreadyLoaded,eventID:"info"});var a;r&&r.length&&["SIMItfSimulation","PLMPIMMetricReference","Document","Specification Report","DIFLayout","DIFSheet","DIFAnnotationSet","Requirement","Requirement Specification","DesignSight","DELLmiWorkPlanSystemReference"].some(function(e){if(-1!==r.indexOf(e))return a=e,!0})?(e.objectParentType=a||e.objectType,ie.load({data:e}),-1===r.indexOf("Document")&&-1===r.indexOf("Specification Report")||(ve=!0)):Be({docData:e})}},this.loadValidation=function(e){var t=!1,n=o.getReviewContext({context:G});n&&(t=n.checkCurrentReviewInSession(e)),e&&!1===t&&X&&X.loadValidation(e)};var et,tt,nt=(et=["VPMReference","Drawing","ENOStrRefinementSpecification"].concat(Ee),tt={},async function(e,t){if(et.indexOf(e)>-1)return t(e);if(void 0!==tt[e])return t(tt[e]?tt[e]:void 0);const n=await He(e);tt[e]=null,et.some(function(t){if((n||[]).indexOf(t)>-1)return tt[e]=t,!0}),t(tt[e]?tt[e]:void 0)});function ot(e,t){return e.reduce(function(e,n){return e.then(function(e){return new Promise(function(o){nt(n.type,function(i){t.indexOf(i)>=0&&e.push(n),o(e)})})})},Promise.resolve([]))}this.appInitFromTransition=function(t){var n;return new e.Promise(function(e,i){var a,s,c,u,d,g,p=t.x3dContent,m=l.getRoots(G);if(t.issues&&1===t.issues.length)p=null,a=t.issues[0].physicalid,c=require("DS/PADUtils/PADUtilsServices").getPlatformId(),u=t.issues[0].title,d=t.issues[0].description,g=t.issues[0].attachments;else if(p&&p.data&&p.data.items&&!m.length)for(s=0;s<p.data.items.length;++s)if("Issue"===p.data.items[s].objectType){if(a){a=null;break}a=p.data.items[s].objectId,c=p.data.items[s].envId,u=p.data.items[0].displayName}a?((n=new R).display({modal:!0,frmWindow:G.getFrameWindow(),type:"load",message:u}),require(["DS/IssueServices/services/PlatformServices","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices"].concat([]),function(t,n,s,m){s.add("widget",window.widget),t.getSecurityContext=function(){return require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx").replace("ctx::","")},t.getTenant=function(){return c},t.initPlatformServices().then(function(){x._sendUsageProbe("loadFromIssue",p?"x3dContent":"transition"),(g?new Promise(function(e){e({attachments:g})}):n.getDocumentsFrom(a)).then(function(t){var s=0,g=0,f=0;if(t&&t.attachments&&t.attachments.length&&t.attachments.forEach(function(e){!e||"Markup"!==e.type&&"DMUMarkupRepReference"!==e.type||(g++,s=e.id,f=e.type)}),g>1)return x._sendUsageProbe("loadFromIssue",(p?"x3dContent":"transition")+"_Markup"+g),void e();if(1===g&&s){var C=o.getReviewContext({context:G}),D=C?C.getReviewCtxInformation():{};if(D&&D.reviewId===s)D.fromIssue=a,e(!0);else if(j){var v=j.addEvent("onDMUMarkupLoaded",function(){j.removeEvent(v);var t=o.getReviewContext({context:G}).getReviewCtxInformation();t&&(t.fromIssue=a),x._sendUsageProbe("loadFromIssue",(p?"x3dContent":"transition")+"_Markup"),e(!0)});p?(p.data.items=[{objectId:s,objectType:f,envId:c,serviceId:p.data.items[0].serviceId,contextId:p.data.items[0].contextId}],G.addRootNodesFromContent({json3DXContent:p})):X&&X.loadIfContextLoaded({objectId:s,objectType:f}).then(function(t){t||(j.removeEvent(v),x._sendUsageProbe("loadFromIssue","transition_Markup_ContextNotLoaded"),e(!0))})}}else new Promise(function(e){p?m.issues.retrieve({data:{objects:[{physicalId:a}]}}).then(function(t){(t=t.results)&&1===t.length&&t[0]&&t[0].body&&(t[0].body.reportedAgainst.length||t[0].body.contexts.length)?(u=t[0].body.title,d=t[0].body.description,ot(t[0].body.reportedAgainst,["Drawing"].concat(Ee)).then(function(e){return e.length?(e.length=1,e):ot(t[0].body.contexts,["VPMReference","ENOStrRefinementSpecification"]).then(function(e){return e.length?e:ot(t[0].body.reportedAgainst,["VPMReference"])})}).then(function(t){if(0!==t.length){var n=[];"Drawing"===t[0].type?j&&(n.push(j.addEvent("on2DDocumentLoadSuccess",function(){n.forEach(j.removeEvent,j),e(!0)})),n.push(j.addEvent("on2DDocumentLoadFailure",function(){n.forEach(j.removeEvent,j),e(!1)}))):(n.push(G.subscribe({event:"onLoadingComplete"},function(){n.forEach(G.unsubscribe,G),e(!0)})),n.push(G.subscribe({event:"onLoadingFailure"},function(){n.forEach(G.unsubscribe,G),e(!1)})));var o=p.data.items[0];p.data.items=t.map(function(e){return{objectId:e.physicalid||e.physicalId,objectType:e.type,envId:c,serviceId:o.serviceId,contextId:o.contextId}}),G.addRootNodesFromContent({json3DXContent:p})}else e(!1)})):e(!1)}):e(!0)}).then(function(t){if(t)if(l.getRoots(G).length)if(j){var i=[],s=function(){i.forEach(j.removeEvent,j)};i.push(j.addEvent("onDMUMarkupCreationCancelled",function(){s(),e(!0)})),i.push(j.addEvent("onDMUMarkupCreationFailed",function(){s(),e(!0)})),i.push(j.addEvent("onDMUMarkupCreationSucceeded",function(){s(),x._sendUsageProbe("command","CreateMarkupFromIssue");var t=o.getReviewContext({context:G}).getReviewCtxInformation();n.connectDocumentToParent(t.reviewId,a).then(function(){t.fromIssue=a,G.displayNotification({msg:L.markupAttachedToIssue,eventID:"success"}),e(!0)}).catch(function(){G.displayNotification({msg:L.markupNotAttachedToIssue,eventID:"warning"}),e(!0)})})),new Promise(function(e){var t=r.getCommand("DMUMarkupCreationForTransitionHdr");t?e(t):require(["DS/DMUPersistence/DMUCreateMarkupCmd"],function(t){e(new t({ID:"DMUMarkupCreationForTransitionHdr",frameWindow:G.getFrameWindow()}))})}).then(function(e){e.setDefaultInfo({title:u,description:d}),e.begin()})}else e(!0);else e(!0);else e(!1)}).catch(i)}).catch(i)}).catch(i)},i)):e()}).then(function(e){e||t.onNoActionDone()}).catch(t.onNoActionDone).finally(function(){n&&n.destroy()})},this.refreshContext=function(){var e=o.getReviewContext({context:G});e&&(e.refreshNode(),G.getViewer().render())},this.publish=function(e,t){q&&setTimeout(function(){Q&&Q.publish({event:e,data:t,context:z})})},this.setappTransition=function(e){Re=e}}}),B=[];return e.singleton({init:function(){},give3DReviewController:function(e){if(e&&e.context)for(var t=0;t<B.length;t++)if(B[t].context===e.context)return B[t].controller},get3DReviewController:function(e){var t;if(e&&e.context&&!(t=this.give3DReviewController(e))){var n=new H({ctxViewer:e.context});t=Object.freeze({setActiveState:async function(e){n&&await n.setActiveState(e)},getActiveState:function(){if(n)return n.getActiveState()},subscribe:function(e,t){if(n)return n.subscribe(e,t)},unsubscribe:function(e){n&&n.unsubscribe(e)},clearController:function(){n&&(n.clearController(),n=null)},loadReview:function(e){n&&n.loadReview(e)},appInitFromTransition:function(e){return n?n.appInitFromTransition(e):Promise.resolve()},loadValidation:function(e){n&&n.loadValidation(e)},refreshContext:function(){n&&n.refreshContext()},disableDMUContextualBar:function(){n&&n.disableDMUContextualBar()},enableDMUContextualBar:function(){n&&n.enableDMUContextualBar()},publish:function(e,t){n&&n.publish(e,t)},setappTransition:function(e){n&&n.setappTransition(e)}}),B.push({context:e.context,controller:t})}return t},unreference3DReviewController:function(e){if(e&&e.context)for(var t=0;t<B.length;t++)if(B[t].context===e.context){e.options&&e.options.appInfo&&"X3DPLAW_AP"===e.options.appInfo&&B[t].controller.setappTransition(!0),B[t].controller.clearController(),B.splice(t,1);break}}})});