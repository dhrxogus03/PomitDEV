define("DS/VCXWebSystem/VCXEnums",["UWA/Class","DS/Visualization/ThreeJS_DS"],function(e,t){"use strict";var n=e.singleton({init:function(){}});return n.Color={White:(new t.Color).setRGB(1,1,1),Black:(new t.Color).setRGB(0,0,0),GreyDark:(new t.Color).setRGB(.1,.1,.1),Grey:(new t.Color).setRGB(.5,.5,.5),Gold:(new t.Color).setRGB(1,.766744,.334458),Aluminium:(new t.Color).setRGB(111/255,114/255,115/255),Satin:(new t.Color).setRGB(235/255,129/255,177/255)},n.TextureMapping={None:0,Planar:1,Spherical:2,Cubic:3,CylindricalFinite:4,CylindricalInfinite:5},n.EnvironmentalId={None:0,Chromic:1,Metal:2,MetalBrushed:3,Plastic:4,Glass:5,GlassPlastic:6,ChromicWithColor:7,Gold:8,Unknown:9,Aluminium:10,Satin:11,PLM:99},n.PrimitiveType={None:0,Line:1,Disc:4,Square:5,Cube:6,Sphere:7,Cylinder:8,Cone:9},n}),define("DS/VCXWebSystem/VCXTimeOutPromise",["require","exports"],function(e,t){"use strict";return class extends Promise{constructor(e,t){const n="number"==typeof e,r=n?t:e;super((t,i)=>{if(n){const n=setTimeout(()=>{i(new Error(`Promise timed out after ${e}ms`))},e);r(e=>{clearTimeout(n),t(e)},e=>{clearTimeout(n),i(e)})}else r(t,i)})}static resolveWithTimeout(e,t){return t&&"function"==typeof t.then?new this(e,t.then.bind(t)):this.resolve(t)}}}),define("DS/VCXWebSystem/VCXAdvancedEventService",["require","exports","DS/CoreEvents/Events"],function(e,t,n){"use strict";class r{static subscribe(e,t,i=r.Priority.NORMAL){return n.subscribe({event:e.event+this._getEventSuffix(i)},t)}static publish(e){let t=[r.Priority.HIGHEST,r.Priority.HIGH,r.Priority.NORMAL,r.Priority.LOW,r.Priority.LOWEST];for(let i of t)n.publish({event:e.event+r._getEventSuffix(i),data:e.data})}static _getEventSuffix(e){return e===r.Priority.NORMAL?"":"/"+r.Priority[e]}}return function(e){let t;!function(e){e[e.LOWEST=0]="LOWEST",e[e.LOW=1]="LOW",e[e.NORMAL=2]="NORMAL",e[e.HIGH=3]="HIGH",e[e.HIGHEST=4]="HIGHEST"}(t=e.Priority||(e.Priority={}))}(r||(r={})),r}),define("DS/VCXWebSystem/VCXHardwareServices",["require","exports"],function(e,t){"use strict";class n{static IsFirefox(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1}static IsChrome(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1}static isMobileDevice(){var e=navigator&&"Win32"===navigator.platform;return n.isTouchCompliantDevice()&&!e}static isIE11(){return void 0!==document.body.style.msTextCombineHorizontal}static isTouchCompliantDevice(){var e=navigator.userAgent.toLowerCase();return!!("ontouchstart"in document.documentElement||navigator.maxTouchPoints>1&&"MacIntel"===navigator.platform||navigator.msMaxTouchPoints>0||e.match(/(iphone|ipod|ipad)/)||e.match(/(android)/)||e.match(/(iemobile)/)||e.match(/iphone/i)||e.match(/ipad/i)||e.match(/ipod/i)||e.match(/blackberry/i)||e.match(/bada/i))}static isIOSDevice(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}static GetGraphicCard(){let e=document.createElement("canvas").getContext("experimental-webgl",{stencil:!0}),t=null==e?void 0:e.getExtension("WEBGL_debug_renderer_info");return t?e.getParameter(t.UNMASKED_RENDERER_WEBGL):null}static isLowGraphicPresent(e){return null!==e&&(e.indexOf("Intel(R) HD Graphics")>=0||e.indexOf("Intel(R) Iris(R)")>=0)}}return n}),define("DS/VCXWebSystem/VCXScreenFullTools",["UWA/Class"],function(e){"use strict";let t="undefined"!=typeof window&&void 0!==window.document?window.document:{},n="undefined"!=typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,r=function(){for(var e,n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],r=0,i=n.length,a={};r<i;r++)if((e=n[r])&&e[1]in t){for(r=0;r<e.length;r++)a[n[0][r]]=e[r];return a}return!1}();var i=e.singleton({init:function(){this.eventsRef={change:r.fullscreenchange,error:r.fullscreenerror}},request:function(e){return new Promise(function(i){var a=r.requestFullscreen,o=function(){this.off("change",o),i()}.bind(this);e=e||t.documentElement,/ Version\/5\.1(?:\.\d+)? Safari\//.test(navigator.userAgent)?e[a]():e[a](n?Element.ALLOW_KEYBOARD_INPUT:{}),this.on("change",o)}.bind(this))},exit:function(){return new Promise(function(e){if(this.isFullscreen){var n=function(){this.off("change",n),e()}.bind(this);t[r.exitFullscreen](),this.on("change",n)}else e()}.bind(this))},toggle:function(e){return this.isFullscreen?this.exit():this.request(e)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(e,n){var r=this.eventsRef[e];r&&t.addEventListener(r,n,!1)},off:function(e,n){var r=this.eventsRef[e];r&&t.removeEventListener(r,n,!1)}});return Object.defineProperties(i,{isFullscreen:{get:function(){return Boolean(t[r.fullscreenElement])}},element:{enumerable:!0,get:function(){return t[r.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return Boolean(t[r.fullscreenEnabled])}}}),i}),define("DS/VCXWebSystem/VCXGridHelper",["require","exports"],function(e,t){"use strict";return class{constructor(e){this._step=e,this._head=null,this._tail=null}set step(e){this._step=e}get head(){return this._head}get tail(){return this._tail}set head(e){this._head=e}set tail(e){this._tail=e}addNewLine(e,t){t?this._head=e:this._tail=e}popLine(){this._tail&&(this._tail=this._tail-this._step)}shiftLine(){this._head&&(this._head=this._head+this._step)}displayGrid(e){let t="[";t+=e,t+="] : ",t+=this._head+" -> ",t+=this._tail,t+=" : "+this._step,console.log(t)}}}),define("DS/VCXWebSystem/VCXTextTools",["UWA/Class","DS/Visualization/ThreeJS_DS"],function(e,t){"use strict";var n=e.singleton({init:function(){}});return n.computeFontDimension=function(e,t){var n={};return n.spaceSize=e.measureText(" "),n.size=e.measureText("MHgfd"),n.height=t,void 0===n.size.actualBoundingBoxAscent&&(n.size.actualBoundingBoxAscent=.7*n.height),void 0===n.size.actualBoundingBoxDescent&&(n.size.actualBoundingBoxDescent=.3*n.height),"number"==typeof n.size.actualBoundingBoxAscent&&"number"==typeof n.size.actualBoundingBoxDescent?n.maxHeight=n.size.actualBoundingBoxAscent+n.size.actualBoundingBoxDescent:n.maxHeight=n.height,n},n.analyseText=function(e,t,r,i,a,o,s){t||((t={}).fontInfo=n.computeFontDimension(r,a),t.paragraphs=[],e.split("\n").forEach(function(e){var n={};t.paragraphs.push(n),n.words=[],e.split(" ").forEach(function(e){var t={};n.words.push(t),t.word=e,t.size=r.measureText(e)})}));var l=0;l+=t.fontInfo.size.actualBoundingBoxAscent;for(var c=0,u=0;u<t.paragraphs.length;u++){var d=t.fontInfo.spaceSize.width,f=t.paragraphs[u],h=0,m=0;0!==u&&(l+=t.fontInfo.maxHeight*s),f.lines=[{width:0,words:[],textY:l}];for(var v=0;v<f.words.length;v++){var g=f.words[v],x=0===h;h+g.size.width>i&&0!==v&&i>=0&&(x=!0,h=0,l+=t.fontInfo.maxHeight*o,m++,f.lines.push({width:0,words:[],textY:l})),x?g.size.actualBoundingBoxLeft&&(h+=g.size.actualBoundingBoxLeft):h+=d,g.size.actualBoundingBoxRight&&v===f.words.length-1?h+=g.size.actualBoundingBoxRight:h+=g.size.width,f.lines[m].words.push(g),f.lines[m].width=h,c<h&&(c=h)}}return e.length<10&&!isNaN(Number(e))||(l+=t.fontInfo.size.actualBoundingBoxDescent),t.maxWidth=c,t.maxHeight=l,t},n.drawText=function(e,t,n,r,i,a){e.paragraphs.forEach(function(o){var s=o.lines.length-1;o.lines.forEach(function(o,l){var c=o.textY+r,u=n,d=e.fontInfo.spaceSize.width;if(2===a)u+=i-o.width;else if(1===a)u+=.5*(i-o.width);else if(3===a){var f=i-o.width;(f/=o.words.length-1)>0&&(s===l?f<3*d&&(d+=f):d+=f)}var h=!0;o.words.forEach(function(e){if(h?(h=!1,e.size.actualBoundingBoxLeft&&(u+=e.size.actualBoundingBoxLeft)):u+=d,t){t.fillText(e.word,u,c)}u+=e.size.width})})})},n.htmlEncode=function(e){return e?e.replace(/\n|\r/gm,"</br>"):""},n.htmlDecode=function(e){if(!e)return"";let t=e.replace(/<br>/g,"");return t=(t=t.replace(/<[^>/]*>/g,"\n")).replace(/<\/.*>/g,"")},n.getUrlVars=function(){var e,t={},n={};return window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,n,r){t[n]=decodeURIComponent(r)}),t.widgetDomain?e=t.widgetDomain:t.uwaUrl&&(e=t.uwaUrl),e?e.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,t,r){n[t]=r}):n=t,n},n}),define("DS/VCXWebSystem/VCXMathTools",["require","exports","DS/Intersection/IntersectionUtils","DS/Visualization/ThreeJS_DS"],function(e,t,n,r){"use strict";class i{static getOFromMatrix(e){return e?new r.Vector3(e.elements[12],e.elements[13],e.elements[14]):new r.Vector3(0,0,0)}static getVxFromMatrix(e){return e?new r.Vector3(e.elements[0],e.elements[1],e.elements[2]):new r.Vector3(1,0,0)}static getVyFromMatrix(e){return e?new r.Vector3(e.elements[4],e.elements[5],e.elements[6]):new r.Vector3(0,1,0)}static getVzFromMatrix(e){return e?new r.Vector3(e.elements[8],e.elements[9],e.elements[10]):new r.Vector3(0,0,1)}static normalizeMatrix(e){var t=i.getVxFromMatrix(e).normalize(),n=i.getVyFromMatrix(e).normalize(),r=i.getVzFromMatrix(e).normalize();return e.clone().makeBasis(t,n,r)}static rotateMatrixAroundX(e,t){var n=(new r.Matrix4).extractRotation(e);return n.multiply((new r.Matrix4).makeRotationX(t)),n.setPosition(i.getOFromMatrix(e))}static rotateMatrixAroundY(e,t){var n=(new r.Matrix4).extractRotation(e);return n.multiply((new r.Matrix4).makeRotationY(t)),n.setPosition(i.getOFromMatrix(e))}static rotateMatrixAroundZ(e,t){var n=(new r.Matrix4).extractRotation(e);return n.multiply((new r.Matrix4).makeRotationZ(t)),n.setPosition(i.getOFromMatrix(e))}static getEulerFromQuaternion(e){var t=new r.Vector3,n=2*(e.w*e.x+e.y*e.z),i=1-2*(e.x*e.x+e.y*e.y);t.x=Math.atan2(n,i);var a=2*(e.w*e.y-e.z*e.x);Math.abs(a)>=1?t.y=Math.PI/2*Math.sign(a):t.y=Math.asin(a);var o=2*(e.w*e.z+e.x*e.y),s=1-2*(e.y*e.y+e.z*e.z);return t.z=Math.atan2(o,s),t}static getQuaternionFromEuler(e){var t=Math.cos(.5*e.z),n=Math.sin(.5*e.z),i=Math.cos(.5*e.y),a=Math.sin(.5*e.y),o=Math.cos(.5*e.x),s=Math.sin(.5*e.x),l=new r.Quaternion;return l.w=o*i*t+s*a*n,l.x=s*i*t-o*a*n,l.y=o*a*t+s*i*n,l.z=o*i*n-s*a*t,l}static getEulerFromMatrix(e,t="XYZ"){let n,r,a,o=e.elements,s=o[0],l=o[4],c=o[8],u=o[1],d=o[5],f=o[9],h=o[2],m=o[6],v=o[10];switch(t){case"XYZ":r=Math.asin(i.clamp(c,-1,1)),Math.abs(c)<.9999999?(n=Math.atan2(-f,v),a=Math.atan2(-l,s)):(n=Math.atan2(m,d),a=0);break;case"YXZ":n=Math.asin(-i.clamp(f,-1,1)),Math.abs(f)<.9999999?(r=Math.atan2(c,v),a=Math.atan2(u,d)):(r=Math.atan2(-h,s),a=0);break;case"ZXY":n=Math.asin(i.clamp(m,-1,1)),Math.abs(m)<.9999999?(r=Math.atan2(-h,v),a=Math.atan2(-l,d)):(r=0,a=Math.atan2(u,s));break;case"ZYX":r=Math.asin(-i.clamp(h,-1,1)),Math.abs(h)<.9999999?(n=Math.atan2(m,v),a=Math.atan2(u,s)):(n=0,a=Math.atan2(-l,d));break;case"YZX":a=Math.asin(i.clamp(u,-1,1)),Math.abs(u)<.9999999?(n=Math.atan2(-f,d),r=Math.atan2(-h,s)):(n=0,r=Math.atan2(c,v));break;case"XZY":a=Math.asin(-i.clamp(l,-1,1)),Math.abs(l)<.9999999?(n=Math.atan2(m,d),r=Math.atan2(c,s)):(n=Math.atan2(-f,v),r=0)}return{x:n,y:r,z:a,order:t}}static makeRotationFromEuler(e,t){var n=e.elements,r=t.x,i=t.y,a=t.z,o=Math.cos(r),s=Math.sin(r),l=Math.cos(i),c=Math.sin(i),u=Math.cos(a),d=Math.sin(a);switch(t.order){case"XYZ":{let e=o*u,t=o*d,r=s*u,i=s*d;n[0]=l*u,n[4]=-l*d,n[8]=c,n[1]=t+r*c,n[5]=e-i*c,n[9]=-s*l,n[2]=i-e*c,n[6]=r+t*c,n[10]=o*l}break;case"YXZ":{let e=l*u,t=l*d,r=c*u,i=c*d;n[0]=e+i*s,n[4]=r*s-t,n[8]=o*c,n[1]=o*d,n[5]=o*u,n[9]=-s,n[2]=t*s-r,n[6]=i+e*s,n[10]=o*l}break;case"ZXY":{let e=l*u,t=l*d,r=c*u,i=c*d;n[0]=e-i*s,n[4]=-o*d,n[8]=r+t*s,n[1]=t+r*s,n[5]=o*u,n[9]=i-e*s,n[2]=-o*c,n[6]=s,n[10]=o*l}break;case"ZYX":{let e=o*u,t=o*d,r=s*u,i=s*d;n[0]=l*u,n[4]=r*c-t,n[8]=e*c+i,n[1]=l*d,n[5]=i*c+e,n[9]=t*c-r,n[2]=-c,n[6]=s*l,n[10]=o*l}break;case"YZX":{let e=o*l,t=o*c,r=s*l,i=s*c;n[0]=l*u,n[4]=i-e*d,n[8]=r*d+t,n[1]=d,n[5]=o*u,n[9]=-s*u,n[2]=-c*u,n[6]=t*d+r,n[10]=e-i*d}break;case"XZY":{let e=o*l,t=o*c,r=s*l,i=s*c;n[0]=l*u,n[4]=-d,n[8]=c*u,n[1]=e*d+i,n[5]=o*u,n[9]=t*d-r,n[2]=r*d-t,n[6]=s*u,n[10]=i*d+e}}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,e}static getMatrixFromOVxVy(e,t,n){var i=t.clone(),a=(new r.Vector3).crossVectors(t,n).normalize();i.normalize();var o=(new r.Vector3).crossVectors(a,i).normalize();return(new r.Matrix4).makeBasis(i,o,a).setPosition(e)}static getMatrixFromOVxVz(e,t,n){var i=(new r.Vector3).crossVectors(n,t);return i.lengthSq()<1e-4?this.getMatrixFromOVx(e,t):this.getMatrixFromOVxVy(e,t,i)}static getMatrixFromOVyVz(e,t,n){var i=(new r.Vector3).crossVectors(t,n);return i.lengthSq()<1e-4?this.getMatrixFromOVy(e,t):this.getMatrixFromOVxVy(e,i,t)}static getMatrixFromOVzVx(e,t,n){var i=(new r.Vector3).crossVectors(t,n).normalize();return i.lengthSq()<1e-4?this.getMatrixFromOVz(e,t):this.getMatrixFromOVyVz(e,i,t)}static getMatrixFromOVzVy(e,t,n){var i=(new r.Vector3).crossVectors(n,t);return i.lengthSq()<1e-4?this.getMatrixFromOVz(e,t):this.getMatrixFromOVzVx(e,t,i)}static getMatrixFromOVx(e,t){var n=t.clone().normalize(),i=(new r.Vector3).crossVectors(new r.Vector3(0,0,1),n);return i.lengthSq()<1e-4&&(i=new r.Vector3(0,1,0)),this.getMatrixFromOVxVy(e,n,i)}static getMatrixFromOVy(e,t){var n=t.clone().normalize(),i=(new r.Vector3).crossVectors(n,new r.Vector3(0,0,1));return i.lengthSq()<1e-4&&(i=new r.Vector3(1,0,0)),this.getMatrixFromOVxVy(e,i,n)}static getMatrixFromOVz(e,t){var n=t.clone().normalize(),i=(new r.Vector3).crossVectors(new r.Vector3(0,0,1),n);return i.lengthSq()<1e-4&&(i=new r.Vector3(1,0,0)),this.getMatrixFromOVxVz(e,i,n)}static isOrthonormal(e){var t=new r.Vector3,n=new r.Vector3,i=new r.Vector3;if(e.extractBasis(t,n,i),Math.abs(t.dot(n))<.001&&Math.abs(t.dot(i))<.001&&Math.abs(n.dot(i))<.001){if(Math.abs(1-t.length())<.001&&Math.abs(1-n.length())<.001&&Math.abs(1-i.length())<.001)return!0;console.warn("Not normal")}else console.warn("Not orthogonal");return!1}static getNearestPointsBetween2Lines(e,t,n,i){let a={};var o=t.clone().normalize(),s=i.clone().normalize();if(Math.abs(o.dot(s))>.99999){var l=(n.x-e.x)*o.x+(n.y-e.y)*o.y+(n.z-e.z)*o.z;a.p1=e.clone().add(o.clone().multiplyScalar(l)),a.p2=n.clone()}else{var c=o.dot(s),u=1-c*c;if(u<1e-5)return null;var d=(new r.Vector3).subVectors(n,e),f=d.dot(o),h=-d.dot(s),m=(f+c*h)/u,v=h+c*m;a.p1=e.clone().add(o.clone().multiplyScalar(m)),a.p2=n.clone().add(s.clone().multiplyScalar(v))}return a}static getNearestDistanceBetween2Lines(e,t,n,r){var a=i.getNearestPointsBetween2Lines(e,t,n,r);return a.d=a.p1.distanceTo(a.p2),a}static getNearestDistanceSquaredBetween2Lines(e,t,n,r){var a=i.getNearestPointsBetween2Lines(e,t,n,r);return a.d=a.p1.distanceToSquared(a.p2),a}static IsMat1EqualsToMat2(e,t,n=1e-5){if(!e&&!t)return!0;if(e&&t){var r=0;for(r=0;r<16;r++)if(Math.abs(e.elements[r]-t.elements[r])>n)return!1;return!0}return!1}static isLineIntersectCircle(e,t,n,i,a,o){var s=new r.Plane;s.setFromNormalAndCoplanarPoint(a,n);var l=s.intersectLine(new r.Line3(e,t));if(!l)return!1;var c=i-o,u=i+o,d=l.distanceToSquared(n);return d>c*c&&d<u*u}static getPointProjectionOnLine(e,t,n){var i=(new r.Vector3).subVectors(n,e),a=t;return(new r.Vector3).addVectors(e,a.clone().multiplyScalar(i.dot(a)/a.dot(a)))}static isLineIntersectPoint(e,t,n,i){var a=(new r.Vector3).subVectors(n,e),o=(new r.Vector3).subVectors(t,e);return(new r.Vector3).addVectors(e,o.clone().multiplyScalar(a.dot(o)/o.dot(o))).distanceToSquared(n)<i*i}static pointOnTriangle(e,t,r,a,o){if(i.planeTemp.setFromCoplanarPoints(t.origin,r.origin,a.origin),i.planeTemp.projectPoint(e,i.h),e.distanceToSquared(i.h)<1e-5&&n.pointInFace3(i.h,t.origin,r.origin,a.origin)){const e=i.h.barycentricCoordinates(t.origin,r.origin,a.origin),n=t.direction.clone().multiplyScalar(e.alpha),s=r.direction.clone().multiplyScalar(e.beta),l=a.direction.clone().multiplyScalar(e.gamma);return o.direction.addVectors(n,s).add(l).multiplyScalar(e.normalisationFactor),o.direction.normalize(),o.origin.copy(i.h),!0}}static rayIntersectTriangle(e,t,n,r,a){i.edge1.subVectors(n.origin,t.origin),i.edge2.subVectors(r.origin,t.origin),i.h.crossVectors(e.direction,i.edge2);const o=i.edge1.dot(i.h);if(o>-.01&&o<.01)return!1;const s=1/o;i.s.subVectors(e.origin,t.origin);const l=s*i.s.dot(i.h);if(l<0||l>1)return!1;i.q.crossVectors(i.s,i.edge1);const c=s*e.direction.dot(i.q);if(c<0||l+c>1)return!1;const u=s*i.edge2.dot(i.q);return u>.01&&(a&&(a.origin.copy(e.direction).multiplyScalar(u).add(e.origin),i.lerpVectors(t.direction,n.direction,l,i.temp1),i.lerpVectors(t.direction,r.direction,c,i.temp2),a.direction.addVectors(i.temp1,i.temp2).sub(t.direction)),!0)}static isOnPlane(e,t,n,i){var a=(new r.Vector3).subVectors(e,t);return Math.abs(a.dot(n))<i}static isCylinder(e,t,n,a){var o=e[t].point,s=e[t].normal,l=e[t+1].point,c=e[t+1].normal,u=s.clone().cross(c),d=i.getNearestPointsBetween2Lines(o,s,l,c),f=(new r.Vector3).addVectors(d.p1,d.p2).multiplyScalar(.5),h=o.distanceTo(d.p1),m=new r.Vector3;let v;for(v=t;v<e.length-1&&v<=n-1;++v){var g=e[v].point,x=e[v].normal,y=e[v+1].point,p=e[v+1].normal;u.add(x.clone().cross(p));var w=i.getNearestPointsBetween2Lines(g,x,y,p);h+=g.distanceTo(w.p1),f.add(m.addVectors(w.p1,w.p2).multiplyScalar(.5))}f.divideScalar(v),h/=v,u.normalize();var V=i.getPointProjectionOnLine(f,u,o),b=V.clone(),I=h-a,A=h+a,S=I*I,C=A*A,M=new r.Vector3,_=new r.Vector3,z=new r.Vector3;m=new r.Vector3;for(v=t;v<e.length&&v<=n;++v){let t=i.getPointProjectionOnLine(f,u,e[v].point);if(m.x=M.x-t.x,m.y=M.y-t.y,m.z=M.z-t.z,m.normalize(),Math.abs(m.dot(u))>.001)return null;var P=M.distanceToSquared(t);if(P<S||P>C)return null;if(_.subVectors(V,t),z.subVectors(b,t),!(_.dot(z)<0)){var T=t.distanceToSquared(V),B=t.distanceToSquared(b);T>=B?b=t:B>=T&&(V=t)}}return V.distanceToSquared(b)<1e-4?null:{center:f=(new r.Vector3).addVectors(V,b).multiplyScalar(.5),radius:h,normal:u,point1:V,point2:b}}static isOnCylinder(e,t,n,a,o,s){var l=new r.Vector3(.5*n*o.x,.5*n*o.y,.5*n*o.z),c=new r.Vector3(t.x-l.x,t.y-l.y,t.z-l.z),u=new r.Vector3(t.x+l.x,t.y+l.y,t.z+l.z),d=i.getPointProjectionOnLine(c,l,e),f=(new r.Vector3).subVectors(c,d),h=(new r.Vector3).subVectors(u,d);if(f.dot(h)>0)return!1;var m=d.distanceToSquared(e),v=a-s,g=a+s;return m>v*v&&m<g*g}static isOnCone(e,t,n,a,o,s){var l=t,c=new r.Vector3(t.x+a*o.x,t.y+a*o.y,t.z+a*o.z),u=i.getPointProjectionOnLine(l,o,e),d=(new r.Vector3).subVectors(l,u),f=(new r.Vector3).subVectors(c,u);if(d.dot(f)>0)return!1;var h=e.distanceTo(u)/Math.tan(n),m=u.distanceToSquared(t),v=h-s,g=h+s;return m>v*v&&m<g*g}static isOnSphere(e,t,n,r){var i=e.distanceToSquared(t),a=n-r,o=n+r;return i>a*a&&i<o*o}static clamp(e,t,n){return Math.max(Math.min(e,n),t)}static lerpVectors(e,t,n,r){return r.x=e.x*(1-n)+t.x*n,r.y=e.y*(1-n)+t.y*n,r.z=e.z*(1-n)+t.z*n,r}static getPluckerCoordinates(e,t){let n=[];return n[0]=e.x*t.y-t.x*e.y,n[1]=e.x*t.z-t.x*e.z,n[2]=e.x-t.x,n[3]=e.y*t.z-t.y*e.z,n[4]=e.z-t.z,n[5]=t.y-e.y,n}static sideOperatorFromPluckerCoordinates(e,t){return"object"==typeof e&&"object"==typeof t&&6===e.length&&6===t.length?e[0]*t[4]+e[1]*t[5]+e[2]*t[3]+e[3]*t[2]+e[4]*t[0]+e[5]*t[1]:-1}static sideOperatorFromPoints(e,t,n,r){let a=i.getPluckerCoordinates(e,t),o=i.getPluckerCoordinates(n,r);return i.sideOperatorFromPluckerCoordinates(a,o)}static sideOperatorFromPointsNormal(e,t,n,r){return i.sideOperatorFromPoints(e,e.clone().add(t),n,n.clone().add(r))}static calculatePrimes(e,t){for(var n=[],r=0;r<e;r++){for(var i=r*(t*Math.random()),a=!0,o=2;o<=Math.sqrt(i);++o)if(i%o==0){a=!1;break}a&&n.push(i)}return n}}return i.edge1=new r.Vector3,i.edge2=new r.Vector3,i.h=new r.Vector3,i.s=new r.Vector3,i.q=new r.Vector3,i.temp1=new r.Vector3,i.temp2=new r.Vector3,i.planeTemp=new r.Plane,i}),define("DS/VCXWebSystem/VCXObjectTools",["UWA/Class"],function(e){"use strict";var t=e.singleton({init:function(){}});return t.pRequire=function(e){var t=UWA.Promise.deferred();return requirejs([e],function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},t.deepCompare=function(e,t,n,r,i){function a(e,t){var n=[];return(a=function(e,t){var r=n.length;for(;r--;)if(n[r--]===t)return n[r]===e;return n.push(e,t),null})(e,t)}return e===t&&0!==e||function e(t,o){var s,l,c,u,d;if((s=toString.call(t))!==toString.call(o))return i&&console.warn("____ deepCompare ____ Case 1 : toString diff "+toString.call(t)+"!=="+toString.call(o)),!1;switch(s){default:return t.valueOf()===o.valueOf();case"[object Number]":return(t=+t)==(o=+o)||Math.abs(t-o)<1e-5||(i&&console.warn("____ deepCompare ____ Case 1.1 : number diff "+t+"!=="+o),!1);case"[object RegExp]":return t.source==o.source&&t.global==o.global&&t.ignoreCase==o.ignoreCase&&t.multiline==o.multiline&&t.lastIndex==o.lastIndex;case"[object Function]":return i&&console.warn("____ deepCompare ____ Case 2 : functions should be strictly equal because of closure context"),!1;case"[object Array]":if(r&&null!==(u=a(t,o)))return u;if((l=t.length)!=o.length)return i&&console.warn("____ deepCompare ____ Case 3 : length diff "+t.length+"!=="+o.length),!1;for(;l--;)if(!((u=t[l])===(d=o[l])&&0!==u||e(u,d)))return i&&(console.warn("____ deepCompare ____ Case 4 : array element diff "+u+"!=="+d),console.warn(u),console.warn(d)),!1;return!0;case"[object Object]":if(r&&null!==(u=a(t,o)))return u;if(l=0,n){var f=[];for(c in t)if(t.hasOwnProperty(c)){if(f.push(c),(u=t[c])===(d=o[c])&&0!==u||e(u,d))continue;return i&&(console.warn("____ deepCompare ____ Case 5 : object element diff "+u+"!=="+d),console.warn(u),console.warn(d)),!1}for(c in o)if(o.hasOwnProperty(c)&&f[l++]!=c)return i&&console.warn("____ deepCompare ____ Case 6.0 : property diff "+c),!1}else{for(c in t)if(t.hasOwnProperty(c)){if(++l,(u=t[c])===(d=o[c])&&0!==u||e(u,d))continue;return i&&(console.warn("____ deepCompare ____ Case 6.1 : property diff "+c+" "+u+"!=="+d),console.warn(u),console.warn(d)),!1}for(c in o)if(o.hasOwnProperty(c)&&--l<0)return i&&console.warn("____ deepCompare ____ Case 7 : missing property "+c),!1}return!0}}(e,t)},t}),define("DS/VCXWebSystem/VCXMeshServices",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/Mesh/MeshUtils","DS/VCXWebSystem/VCXEnums"],function(e,t,n,r,i){"use strict";var a=e.singleton({init:function(){this.sharing=!1,this.optimized=!1,this._primitives=[null,null,null,null,null,null,null,null,null,null]},allocIndexationArray:function(e,t){return t&&t<65536?new Uint16Array(e):new Uint32Array(e)},getPrimitiveMeshNode:function(e){var r=null;switch(e){case i.PrimitiveType.Line:null===this._primitives[e]&&(this._primitives[e]=n.createLineNode({points:[new t.Vector3(0,0,0),new t.Vector3(0,0,1)]})),r=this._primitives[e];break;case i.PrimitiveType.Disc:null===this._primitives[e]&&(this._primitives[e]=n.createCircleNode({radius:1,segments:32,fill:!0,startAngle:0,endAngle:2*Math.PI})),r=this._primitives[e];break;case i.PrimitiveType.Square:if(null===this._primitives[e]){this._primitives[e]=n.createRectangleNode({width:1,height:1,fill:!0});var a=this._primitives[e].getMatrix();a.setPosition({x:-.5,y:-.5,z:0}),this._primitives[e].setMatrix(a)}r=this._primitives[e];break;case i.PrimitiveType.Cube:null===this._primitives[e]&&(this._primitives[e]=n.createCuboidNode({cornerPoint:new t.Vector3(-.5,-.5,-.5),firstAxis:new t.Vector3(1,0,0),secondAxis:new t.Vector3(0,1,0),thirdAxis:new t.Vector3(0,0,1)})),r=this._primitives[e];break;case i.PrimitiveType.Sphere:null===this._primitives[e]&&(this._primitives[e]=n.createSphereNode({radius:1})),r=this._primitives[e];break;case i.PrimitiveType.Cylinder:null===this._primitives[e]&&(this._primitives[e]=n.createCylinderNode({bottomCenterPoint:new t.Vector3(0,0,-1),topCenterPoint:new t.Vector3(0,0,1),radius:1})),r=this._primitives[e];break;case i.PrimitiveType.Cone:null===this._primitives[e]&&(this._primitives[e]=n.createConeNode({bottomCenterPoint:new t.Vector3(0,0,-1),topCenterPoint:new t.Vector3(0,0,1),bottomRadius:1,topRadius:0})),r=this._primitives[e];break;default:r=null}return r},computeSmoothNormalsTrianglesSet:function(e,t){if(!e||!t)return null;t.length%3!=0&&console.error("VCXMeshServices : Invalid data for mesh set node");var n=new Float32Array(e.length);n.fill&&n.fill(0,0,e.length);for(var r=t.length/3,i=0;i<r;++i){var a=3*t[3*i],o=3*t[3*i+1],s=3*t[3*i+2],l={x:e[a],y:e[a+1],z:e[a+2]},c={x:e[o],y:e[o+1],z:e[o+2]},u={x:e[s],y:e[s+1],z:e[s+2]},d={x:c.x-l.x,y:c.y-l.y,z:c.z-l.z},f={x:u.x-l.x,y:u.y-l.y,z:u.z-l.z},h={x:d.y*f.z-d.z*f.y,y:d.z*f.x-d.x*f.z,z:d.x*f.y-d.y*f.x};n[a]+=h.x,n[a+1]+=h.y,n[a+2]+=h.z,n[o]+=h.x,n[o+1]+=h.y,n[o+2]+=h.z,n[s]+=h.x,n[s+1]+=h.y,n[s+2]+=h.z}for(i=0;i<e.length;i+=3){h={x:n[i],y:n[i+1],z:n[i+2]};var m=Math.sqrt(h.x*h.x+h.y*h.y+h.z*h.z);n[i]=h.x/m,n[i+1]=h.y/m,n[i+2]=h.z/m}return n},computeSmoothNormalsStripSet:function(e,t,n){if(!e||!t)return null;var r=new Float32Array(e.length);r.fill&&r.fill(0,0,e.length);for(var i=0,a=n.length,o=0;o<a;++o){for(var s=n[o],l=0;l<s-2;++l){var c=3*t[i+l],u=3*t[i+l+1],d=3*t[i+l+2],f={x:e[c],y:e[c+1],z:e[c+2]};if(1&l)var h={x:e[u],y:e[u+1],z:e[u+2]},m={x:e[d],y:e[d+1],z:e[d+2]};else m={x:e[u],y:e[u+1],z:e[u+2]},h={x:e[d],y:e[d+1],z:e[d+2]};var v={x:m.x-f.x,y:m.y-f.y,z:m.z-f.z},g={x:h.x-f.x,y:h.y-f.y,z:h.z-f.z},x={x:v.y*g.z-v.z*g.y,y:v.z*g.x-v.x*g.z,z:v.x*g.y-v.y*g.x};r[c]+=x.x,r[c+1]+=x.y,r[c+2]+=x.z,r[u]+=x.x,r[u+1]+=x.y,r[u+2]+=x.z,r[d]+=x.x,r[d+1]+=x.y,r[d+2]+=x.z}i+=s}e.length%3!=0&&console.error("VCXMeshServices : Invalid data for mesh set node");for(l=0;l<e.length;l+=3){x={x:r[l],y:r[l+1],z:r[l+2]};var y=Math.sqrt(x.x*x.x+x.y*x.y+x.z*x.z);r[l]=x.x/y,r[l+1]=x.y/y,r[l+2]=x.z/y}return r},buildIndexationFromStripSet:function(e,t,n,i,a){var o=null;switch(e){case r.ConnectivityTypeEnum.TRIANGLE_STRIP:for(var s=0,l=0;l<t;++l)s+=i[l]-2;o=this.allocIndexationArray(3*s,a.length/3);var c=0,u=0;for(l=0;l<t;++l){for(var d=i[l],f=0;f<d-2;++f)o[c++]=n[u+f],1&f?(o[c++]=n[u+f+2],o[c++]=n[u+f+1]):(o[c++]=n[u+f+1],o[c++]=n[u+f+2]);u+=d}break;case r.ConnectivityTypeEnum.LINE_STRIP:var h=0;for(l=0;l<t;++l)h+=i[l]-1;o=new Uint32Array(2*h);for(c=0,u=0,l=0;l<t;++l){for(d=i[l],f=0;f<d-1;++f)o[c++]=n[u+f],o[c++]=n[u+f+1];u+=d}break;default:console.warn("Unknown strip set, can't build indexation")}return o},buildIndexedTriangleSet:function(e,t,i,a,o,s,l,c,u,d,f){if(null===t||null===i||null===o||null===s)return console.error("VCXMeshServices : Invalid data for mesh node"),null;if(t.length%3!=0)return console.error("VCXMeshServices : Invalid data for mesh set node"),null;var h=a?a.length/2:null;if(o.length!==s.length)return console.error("VCXMeshServices : Invalid data for mesh node"),null;var m=null===c?new r.PrimitiveGroup:new r.PrimitiveGroup({fillGAS:new r.FillAttributes(c,d?1:0)});this.sharing&&(m.sharing=!0),this.optimized&&(m.optimized=!0);var v,g,x=0,y=new r.Buffer({component:r.VertexComponentEnum.POSITION,dimension:3,data:t});m.addBuffer(v=x++,y);var p,w,V=new r.Buffer({component:r.VertexComponentEnum.NORMAL,dimension:3,data:i});if(m.addBuffer(g=x++,V),a&&3*a.length==2*t.length){var b=new r.Buffer({component:r.VertexComponentEnum.TEX_COORD_0,dimension:2,data:new Float32Array(3*h)});b.data[0]=a[0];for(var I=1,A=1;A<a.length;A++)b.data[I++]=a[A],A%2&&(b.data[I++]=0);m.addBuffer(p=x++,b)}var S=null;if(o instanceof Uint8Array||o instanceof Uint16Array||o instanceof Uint32Array)S=o;else{console.warn("Buffer indexation should be Uint8Array, Uint16Array or Uint32Array"),S=this.allocIndexationArray(o.length,t.length/3);for(var C=0;C<o.length;C++)S[C]=o[C]}var M,_,z=new r.Buffer({indexBuffer:!0,dimension:1,data:S});if(m.addBuffer(w=x++,z),f)M=w;else{var P=null;if(s instanceof Uint8Array||s instanceof Uint16Array||s instanceof Uint32Array)P=s;else{console.warn("Buffer indexation should be Uint8Array, Uint16Array or Uint32Array"),P=this.allocIndexationArray(s.length,i.length/3);for(C=0;C<s.length;C++)P[C]=s[C]}var T=new r.Buffer({indexBuffer:!0,dimension:1,data:P});m.addBuffer(M=x++,T)}if(f)_=w;else if(l){var B=null;if(l instanceof Uint8Array||l instanceof Uint16Array||l instanceof Uint32Array)B=l;else{console.warn("Buffer indexation should be Uint8Array, Uint16Array or Uint32Array"),B=this.allocIndexationArray(l.length,a.length/2);for(C=0;C<l.length;C++)B[C]=l[C]}var E=new r.Buffer({indexBuffer:!0,dimension:1,data:l});m.addBuffer(_=x++,E)}var F=null===c?new r.Primitive:new r.Primitive({fillGAS:new r.FillAttributes(c,d?1:0)});F.geomType="FACE",F.nbIndices=o.length,F.connectivity=r.ConnectivityTypeEnum.TRIANGLES;var O=new r.VertexComponent;O.nbVertices=t.length,O.bufferId=v,O.indices=new r.IndexArray,O.indices.bufferId=w,O.indices.offset=0,F.addVertexComponent(O);var L=new r.VertexComponent;if(L.nbVertices=i.length,L.bufferId=g,L.indices=new r.IndexArray,L.indices.bufferId=M,L.indices.offset=0,F.addVertexComponent(L),a){var N=new r.VertexComponent;N.nbVertices=a.length,N.bufferId=p,N.indices=new r.IndexArray,N.indices.bufferId=_,N.indices.offset=0}return m.addPrimitive(F),n.createMeshNode(m,u,0,"mono")},buildMonoIndexedTriangleStripSet:function(e,t,i,a,o,s,l,c,u){if(null===t||null===i||null===o)return console.error("VCXMeshServices : Invalid data for mesh node"),null;if(t.length%3!=0)return console.error("VCXMeshServices : Invalid data for mesh set node"),null;var d=t.length/3,f=null===l?new r.PrimitiveGroup:new r.PrimitiveGroup({fillGAS:new r.FillAttributes(l,u?1:0)});this.sharing&&(f.sharing=!0),this.optimized&&(f.optimized=!0);var h=new r.Buffer({component:r.VertexComponentEnum.POSITION,data:t});f.addBuffer(0,h);var m=new r.Buffer({component:r.VertexComponentEnum.NORMAL,data:i});f.addBuffer(1,m);if(a&&3*a.length==2*t.length){var v=new r.Buffer({component:r.VertexComponentEnum.TEX_COORD_0,data:new Float32Array(3*d)}),g=0;v.data[0]=a[0];for(var x=0;x<a.length;x++)v.data[g++]=a[x],x%2&&(v.data[g++]=0);f.addBuffer(2,v)}var y=new r.Buffer({indexBuffer:!0,data:o});f.addBuffer(3,y);for(var p=0,w=0;w<e;w++){var V=new r.Primitive;V.nbIndices=s[w],V.connectivity=r.ConnectivityTypeEnum.TRIANGLE_STRIP;var b=new r.VertexComponent;b.nbVertices=s[w],b.bufferId=0,b.indices=new r.IndexArray,b.indices.bufferId=3,b.indices.offset=p,V.addVertexComponent(b);var I=new r.VertexComponent;if(I.nbVertices=s[w],I.bufferId=1,I.indices=new r.IndexArray,I.indices.bufferId=3,I.indices.offset=p,V.addVertexComponent(I),a){var A=new r.VertexComponent;A.nbVertices=s[w],A.bufferId=2,A.indices=new r.IndexArray,A.indices.bufferId=3,A.indices.offset=p,V.addVertexComponent(A)}f.addPrimitive(V),p+=s[w]}return null===c?n.createMeshNode(f):n.createMeshNode(f,c)},buildIndexedLineSet:function(e,t,i,a,o,s){var l=new r.PrimitiveGroup({lineGAS:new r.LineAttributes(i||new r.Color(1,1,1,1),a||1)});this.sharing&&(l.sharing=!0),this.optimized&&(l.optimized=!0);var c=new r.Primitive;c.nbIndices=t.length,c.connectivity=r.ConnectivityTypeEnum.LINES,c.geomType=o;var u=new r.Buffer({component:r.VertexComponentEnum.POSITION,data:e});l.addBuffer(0,u);var d=new r.Buffer({indexBuffer:!0,data:t});l.addBuffer(1,d);var f=new r.VertexComponent;return f.nbVertices=e.length,f.bufferId=0,f.indices=new r.IndexArray,f.indices.bufferId=1,f.indices.offset=0,c.addVertexComponent(f),l.addPrimitive(c),null===s?n.createMeshNode(l):n.createMeshNode(l,s)},buildLineStripSet:function(e,t,i,a,o,s,l){if(null===e||null===t.length||null===i)return console.error("VCXMeshServices : Invalid data for line set node"),null;var c=new r.PrimitiveGroup({lineGAS:new r.LineAttributes(a||new r.Color(1,1,1,1),o||1)});this.sharing&&(c.sharing=!0);var u=new r.Buffer({component:r.VertexComponentEnum.POSITION,data:e});c.addBuffer(0,u);var d=new r.Buffer({indexBuffer:!0,data:i});c.addBuffer(1,d);for(var f=0,h=0;h<t.length;h++){var m=new r.Primitive;m.nbIndices=t[h],m.connectivity=r.ConnectivityTypeEnum.LINE_STRIP,s&&(m.geomType=s);var v=new r.VertexComponent;v.nbVertices=t[h],v.bufferId=0,v.indices=new r.IndexArray,v.indices.bufferId=1,v.indices.offset=f,m.addVertexComponent(v),c.addPrimitive(m),f+=t[h]}return null===l?n.createMeshNode(c):n.createMeshNode(c,l)},buildLine:function(e,t,n,r,i){if(null===e)return console.error("VCXMeshServices : Invalid data for line set node"),null;if(e.length%3!=0)return console.error("VCXMeshServices : Invalid data for line set node"),null;for(var a=e.length/3,o=[],s=0;s<a;s++)o[s]=s;return this.buildLineStripSet(e,[a],o,i,r)},buildPointSet:function(e,t,i,a,o){if(null===e||null===t)return console.error("VCXMeshServices : Invalid data for point set node"),null;if(e.length%3!=0)return console.error("VCXMeshServices : Invalid data for point set node"),null;var s=e.length/3,l=new r.PrimitiveGroup({pointGAS:new r.PointAttributes(i||new r.Color(1,1,1,1),a||1)});this.sharing&&(l.sharing=!0);var c=new r.Buffer({component:r.VertexComponentEnum.POSITION,data:e});l.addBuffer(0,c);var u=new r.Buffer({indexBuffer:!0,data:t});l.addBuffer(1,u);for(var d=0;d<s;d++){var f=new r.Primitive;f.nbIndices=1,f.connectivity=r.ConnectivityTypeEnum.POINTS;var h=new r.VertexComponent;h.nbVertices=1,h.bufferId=0,h.indices=new r.IndexArray,h.indices.bufferId=1,h.indices.offset=d,f.addVertexComponent(h),l.addPrimitive(f)}return null===o?n.createMeshNode(l):n.createMeshNode(l,o)},buildPoint:function(e,t,n,r){var i=new Float32Array(3);i[0]=e[0],i[1]=e[1],i[2]=e[2];var a=new Uint8Array(1);return a[0]=0,this.buildPointSet(i,a,t,n,r)},buildIndexation:function(e,t,n,r){if(!(e&&t&&n&&r))return null;for(var i=[],o=0,s=0,l=0;l<t.length;l++){if(n[l]===a.IndexationType.TrianglesSet)for(var c=s+t[l],u=s;u<c;u++)i[o++]=r[u];else if(n[l]===a.IndexationType.TrianglesStripSet){c=s+t[l]-2;var d=!0;for(u=s;u<c;u++)i[o++]=r[u],d?(i[o++]=r[u+1],i[o++]=r[u+2],d=!1):(i[o++]=r[u+2],i[o++]=r[u+1],d=!0)}else if(n[l]===a.IndexationType.FanSet){c=s+t[l]-1;var f=r[s];for(u=s+1;u<c;u++)i[o++]=f,i[o++]=r[u],i[o++]=r[u+1]}s+=t[l]}for(var h=this.allocIndexationArray(i.length,e.length/3),m=0;m<i.length;++m)h[m]=i[m];return h},packIndexation:function(e,t){if(null===t||null===e||0===t.length)return null;for(var n=new Map,r=this.allocIndexationArray(t.length,e.length/3),i=0,a=0;a<t.length;a++){i<t[a]&&(i=t[a]);var o=e[m=3*t[a]]+"_"+e[m+1]+"_"+e[m+2],s=n.get(o);void 0!==s?r[a]=s:(n.set(o,t[a]),r[a]=t[a])}n=null,i+=1;for(var l=this.allocIndexationArray(i,e.length/3),c=0;c<i;++c)l[c]=!1;for(c=0;c<r.length;c++)l[r[c]]=!0;for(var u=0,d=new Map,f=0;f<i;f++)l[f]&&d.set(f,u++);var h=new Float32Array(3*d.size);u=0;for(var m=0;m<i;m++)if(l[m]){var v=3*m;h[u++]=e[v],h[u++]=e[v+1],h[u++]=e[v+2]}l=null;for(var g=this.allocIndexationArray(r.length,e.length/3),x=0;x<r.length;x++){v=d.get(r[x]);g[x]=v}return d=null,r=null,{pIndexation:g,pCoord:h}},packIndexationUv:function(e,t){if(null===t||null===e||0===t.length)return null;for(var n=new Map,r=[],i=0,a=0;a<t.length;a++){i<t[a]&&(i=t[a]);var o=e[m=2*t[a]]+"_"+e[m+1],s=n.get(o);void 0!==s?r[a]=s:(n.set(o,t[a]),r[a]=t[a])}i+=1;for(var l=[],c=0;c<i;++c)l[c]=!1;for(c=0;c<r.length;c++)l[r[c]]=!0;for(var u=0,d=new Map,f=0;f<i;f++)l[f]&&d.set(f,u++);var h=[];u=0;for(var m=0;m<i;m++)if(l[m]){var v=2*m;h[u++]=e[v],h[u++]=e[v+1]}for(var g=[],x=0;x<r.length;x++){v=d.get(r[x]);g[x]=v}return{pIndexation:g,pCoord:h}},packIndexationMono:function(e,t,n,r){if(null===r||null===e||0===r.length)return null;for(var i=new Map,a=Math.max(Math.max(e.length/3,t.length/3),n?n.length/2:0),o=this.allocIndexationArray(r.length,a),s=0,l=0;l<r.length;l++){s<r[l]&&(s=r[l]);var c=e[w=3*r[l]]+"_"+e[w+1]+"_"+e[w+2];if(t&&t.length&&(c+=t[w]+"_"+t[w+1]+"_"+t[w+2]),n&&n.length){var u=2*r[l];c+=n[u]+"_"+n[u+1]}var d=i.get(c);void 0!==d?o[l]=d:(i.set(c,r[l]),o[l]=r[l])}i=null,s+=1;for(var f=this.allocIndexationArray(s,a),h=0;h<s;++h)f[h]=!1;for(h=0;h<o.length;h++)f[o[h]]=!0;for(var m=0,v=new Map,g=0;g<s;g++)f[g]&&v.set(g,m++);for(var x=new Float32Array(3*v.size),y=new Float32Array(t&&t.length?3*v.size:0),p=new Float32Array(n&&n.length?3*v.size:0),w=(m=0,0);w<s;w++)if(f[w]){var V=3*w;x[m++]=e[V],x[m++]=e[V+1],x[m++]=e[V+2]}if(t&&t.length){m=0;for(w=0;w<s;w++)if(f[w]){V=3*w;y[m++]=t[V],y[m++]=t[V+1],y[m++]=t[V+2]}}if(n&&n.length){m=0;for(w=0;w<s;w++)if(f[w]){V=2*w;p[m++]=n[V],p[m++]=n[V+1]}}f=null;for(var b=this.allocIndexationArray(o.length,a),I=0;I<o.length;I++){V=v.get(o[I]);b[I]=V}return i=null,o=null,{pIndexation:b,pCoord:x,pNormals:y,pUv:p}},mergeGeosets:function(e){if(!e||0===e.length)return null;var t,i,a,o,s,l,c=null;if(1===e.length&&null!==e[0]){var u=e[0];switch(u.meshType){case r.ConnectivityTypeEnum.TRIANGLES:c=this.buildIndexedTriangleSet(u.nTriangles,u.vertexArray,u.normalsArray,u.uvArray,u.vertexIndexArray,u.normalsIndexArray,u.uvIndexArray,u.colorRGBA,u.material,u.isSolid,u.uniqueIndexation);break;case r.ConnectivityTypeEnum.TRIANGLE_STRIP:!0===u.uniqueIndexation&&(c=this.buildMonoIndexedTriangleStripSet(u.nStrips,u.vertexArray,u.normalsArray,u.uvArray,u.vertexIndexArray,u.lengthsArray,u.colorRGBA,u.material,u.isSolid));break;case r.ConnectivityTypeEnum.LINES:c=this.buildIndexedLineSet(u.vertexArray,u.vertexIndexArray,u.colorRGBA,u.thickness,u.edgeType,u.material);break;case r.ConnectivityTypeEnum.LINE_STRIP:c=this.buildLineStripSet(u.vertexArray,u.lengthsArray,u.vertexIndexArray,u.colorRGBA,u.thickness,u.edgeType,u.material)}if(c)return c}t=i=a=o=s=l=0;for(var d=0;d<e.length;++d){(te=e[d]).vertexArray&&(t+=te.vertexArray.length),te.normalsArray&&(i+=te.normalsArray.length),te.uvArray&&(a+=te.uvArray.length),te.vertexIndexArray&&(o+=te.vertexIndexArray.length),te.normalsIndexArray?s+=te.normalsIndexArray.length:s+=te.vertexIndexArray.length,te.uvIndexArray?l+=te.uvIndexArray.length:l+=te.vertexIndexArray.length}var f,h,m,v,g,x,y=new Float32Array(t),p=new Float32Array(i),w=a?new Float32Array(a):null,V=this.allocIndexationArray(o,t/3),b=this.allocIndexationArray(s,i/3),I=a?this.allocIndexationArray(l,a/2):null,A=!0,S=!0;f=h=m=v=g=x=0;for(d=0;d<e.length;++d){var C=f/3,M=h/3,_=m/3;if((te=e[d]).vertexArray)for(var z=0;z<te.vertexArray.length;++z)y[f++]=te.vertexArray[z];if(te.normalsArray)for(z=0;z<te.normalsArray.length;++z)p[h++]=te.normalsArray[z];if(te.uvArray&&w)for(z=0;z<te.uvArray.length;++z)w[m++]=te.uvArray[z];if(null!==te.vertexIndexArray)for(z=0;z<te.vertexIndexArray.length;++z)V[v++]=te.vertexIndexArray[z]+C;if(null!==te.normalsIndexArray)for(var P=0;P<te.normalsIndexArray.length;++P)b[g++]=te.normalsIndexArray[P]+M;else for(P=0;P<te.vertexIndexArray.length;++P)b[g++]=te.vertexIndexArray[P]+M;if(null!==te.uvIndexArray)for(var T=0;T<te.uvIndexArray.length;++T)I[x++]=te.uvIndexArray[T]+_;else if(I)for(T=0;T<te.vertexIndexArray.length;++T)I[x++]=te.vertexIndexArray[T]+_;!1===te.isSolid&&(A=!1),!1===te.uniqueIndexation&&(S=!1)}if(!0===S){var B=this.packIndexationMono(y,p,w,V);B&&(V=B.pIndexation,y=B.pCoord,p=B.pNormals,w&&(w=B.pUv),B=null,p.length&&(b=V),w&&w.length&&(I=V))}else{var E=this.packIndexation(y,V);if(E&&(y=E.pCoord,V=E.pIndexation,E=null),b.length){var F=this.packIndexation(p,b);F&&(p=F.pCoord,b=F.pIndexation,F=null)}if(I&&I.length&&w){var O=this.packIndexationUv(w,I);O&&(w=O.pCoord,I=O.pIndexation,O=null)}}var L=0,N=new r.PrimitiveGroup;this.sharing&&(N.sharing=!0),this.optimized&&(N.optimized=!0);var R,k=0;N.fillAttr=new r.FillAttributes,N.fillAttr.solid=A?1:0;var G,X,D,q,U,W=new r.Buffer({component:r.VertexComponentEnum.POSITION,dimension:3,data:y});if(N.addBuffer(R=k++,W),p.length&&b.length){var H=new r.Buffer({component:r.VertexComponentEnum.NORMAL,dimension:3,data:p});N.addBuffer(G=k++,H)}if(w&&w.length&&I.length){var Y=new r.Buffer({component:r.VertexComponentEnum.TEX_COORD_0,dimension:2,data:new Float32Array(3*w.length/2)}),j=0;Y.data[0]=w[0];for(T=0;T<w.length;T++)Y.data[j++]=w[T],T%2&&(Y.data[j++]=0);N.addBuffer(X=k++,Y)}if(V.length>0){var Z=new r.Buffer({indexBuffer:!0,dimension:1,data:V});N.addBuffer(D=k++,Z)}if(S)q=D;else if(b.length>0){var J=new r.Buffer({indexBuffer:!0,dimension:1,data:b});N.addBuffer(q=k++,J)}if(S)U=D;else if(I&&I.length>0){var K=new r.Buffer({indexBuffer:!0,dimension:1,data:I});N.addBuffer(U=k++,K)}var Q=0,$=0,ee=0;for(d=0;d<e.length;++d){var te;switch((te=e[d]).meshType){case r.ConnectivityTypeEnum.TRIANGLES:var ne=null===te.colorRGBA?new r.Primitive:new r.Primitive({fillGAS:new r.FillAttributes(te.colorRGBA,A?1:0)});if(ne.geomType="FACE",ne.nbIndices=te.vertexIndexArray.length,ne.connectivity=r.ConnectivityTypeEnum.TRIANGLES,(le=new r.VertexComponent).nbVertices=y.length,le.bufferId=R,le.indices=new r.IndexArray,le.indices.bufferId=D,le.indices.offset=Q,ne.addVertexComponent(le),p.length)(ie=new r.VertexComponent).nbVertices=p.length,ie.bufferId=G,ie.indices=new r.IndexArray,ie.indices.bufferId=q,ie.indices.offset=$,ne.addVertexComponent(ie);if(w&&w.length)(ae=new r.VertexComponent).nbVertices=w.length,ae.bufferId=X,ae.indices=new r.IndexArray,ae.indices.bufferId=U,ae.indices.offset=ee,ne.addVertexComponent(ae);N.addPrimitive(ne);break;case r.ConnectivityTypeEnum.TRIANGLE_STRIP:L=0;for(var re=0;re<te.lengthsArray.length;re++){var ie,ae,oe=null===te.colorRGBA?new r.Primitive:new r.Primitive({fillGAS:new r.FillAttributes(te.colorRGBA,A?1:0)});if(oe.geomType="FACE",oe.nbIndices=te.lengthsArray[re],oe.connectivity=r.ConnectivityTypeEnum.TRIANGLE_STRIP,(le=new r.VertexComponent).nbVertices=te.lengthsArray[re],le.bufferId=R,le.indices=new r.IndexArray,le.indices.bufferId=D,le.indices.offset=Q+L,oe.addVertexComponent(le),null!==te.normalsIndexArray&&te.normalsIndexArray.length)(ie=new r.VertexComponent).nbVertices=te.lengthsArray[re],ie.bufferId=G,ie.indices=new r.IndexArray,ie.indices.bufferId=q,ie.indices.offset=$+L,oe.addVertexComponent(ie);if(te.uvIndexArray&&te.uvIndexArray.length)(ae=new r.VertexComponent).nbVertices=te.lengthsArray[re],ae.bufferId=X,ae.indices=new r.IndexArray,ae.indices.bufferId=U,ae.indices.offset=ee+L,oe.addVertexComponent(ae);N.addPrimitive(oe),L+=te.lengthsArray[re]}break;case r.ConnectivityTypeEnum.LINES:(se=new r.Primitive({lineGAS:new r.LineAttributes(te.colorRGBA?te.colorRGBA:new r.Color(1,1,1,1),te.thickness?te.thickness:1)})).nbIndices=te.vertexIndexArray.length,se.connectivity=r.ConnectivityTypeEnum.LINES,se.geomType=te.edgeType,(le=new r.VertexComponent).nbVertices=y.length,le.bufferId=R,le.indices=new r.IndexArray,le.indices.bufferId=D,le.indices.offset=Q,se.addVertexComponent(le),N.addPrimitive(se);break;case r.ConnectivityTypeEnum.LINE_STRIP:for(L=0,re=0;re<te.lengthsArray.length;re++){var se,le;(se=new r.Primitive({lineGAS:new r.LineAttributes(te.colorRGBA?te.colorRGBA:new r.Color(1,1,1,1),te.thickness?te.thickness:1)})).nbIndices=te.lengthsArray[re],se.connectivity=r.ConnectivityTypeEnum.LINE_STRIP,se.geomType=te.edgeType,(le=new r.VertexComponent).nbVertices=te.lengthsArray[re],le.bufferId=R,le.indices=new r.IndexArray,le.indices.bufferId=D,le.indices.offset=Q+L,se.addVertexComponent(le),N.addPrimitive(se),L+=te.lengthsArray[re]}break;case r.ConnectivityTypeEnum.POINTS:console.log("Merge geosets error : Point geometry type - to be implemented");break;default:console.log("Merge geosets error : unknown geometry type")}null!==te.vertexIndexArray&&(Q+=te.vertexIndexArray.length),null!==te.normalsIndexArray&&($+=te.normalsIndexArray.length),te.uvIndexArray&&(ee+=te.uvIndexArray.length)}return S?n.createMeshNode(N,void 0,0,"mono"):n.createMeshNode(N)}});return a.IndexationType={TrianglesSet:0,TrianglesStripSet:1,FanSet:2},a});