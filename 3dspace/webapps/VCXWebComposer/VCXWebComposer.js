define("DS/VCXWebComposer/VCXNodeHolderRoot",["DS/WebApplicationBase/W3AASGNodeHolder","DS/Visualization/Node3D"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){return this._sgNode||(this.getPathElement(),this._sgNode=this.GetObject()._experienceBase.getManager("VCXContextManager").getRootNode()),this._sgNode},getPathElement:function(){return this._pathElement||(this._pathElement=this.GetObject()._experienceBase.getManager("VCXContextManager").getRootPathElement()),this._pathElement},isSelfManagedPathElement:function(){return!1}})}),define("DS/VCXWebComposer/VCXExperience",["DS/CoreEvents/Events","UWA/Class","DS/VCXWebKernelCommands/VCXCmdGoToScenario","DS/VCXWebKernelCommands/VCXCmdGoToScenarioWithInterpolation","DS/VCXWebDressup/VCXCmdChangeDressup","DS/VCXWebKernelCommands/VCXCmdChangeComponent","DS/VCXWebKernelCommands/VCXCmdChangeScenarioSequence","DS/VCXWebKernelCommands/VCXCmdReplaceScenario","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties","DS/VCXWebIO/VCXFileServices","DS/WebappsUtils/WebappsUtils","DS/VCXWebIO/VCXLogServices","DS/VCXKeyFramer/VCXScenario","DS/RuntimeView/NLSManager","DS/VCXWebVisualization/VCXPublishRasterImage","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebKernelCommands/VCXCmdChangePropertiesVolatile"],function(e,t,n,r,a,i,o,s,c,p,l,C,g,d,u,h,m,M,f,V,_,S){"use strict";var X=t.extend({init:function(){this._endLoadingDone=!1,this._parent(),this._viewMode=0,this.volatileNotSaved=!1},initialize:function(){this._endLoadingDone=!1;this._cpt=0,this._time=0,this._moy=0;var t=this;this.event_VCX_PROPERTIES_CHANGED=e.subscribe({event:"VCX_PROPERTIES_CHANGED"},function(e){var n=t._experienceBase.getManager("VCXScenarioManager");n&&!1===n.GetAutoKey()&&t.SetVolatileNotSaved(!0)}),this.event_VCX_SCENARIO_CHANGED=e.subscribe({event:"VCX_CURRENT_SCENARIO_CHANGED"},function(e){t._endLoadingDone&&e&&t._experienceBase.getManager("VCXContextManager").getExperienceIn3DPlay()&&"AnimationSmgID"===e._ID&&t._experienceBase.getManager("VCXAPIManager").PlayAnimation("AnimationSmgID")}),this.event_VCX_END_LOADING_DONE=e.subscribe({event:"VCX_END_LOADING_DONE"},function(e){t._endLoadingDone=!0}),this.event_VCX_UPDATE_THUMBNAIL=e.subscribe({event:"VCX_UPDATE_THUMBNAIL"},function(e){var n=t._experienceBase.getManager("VCXScenarioManager");if(n&&n.GetAutoKey()){var r=e&&e.scenarioID;if(r){var a=t._experienceBase.ComponentsMap.GetComponentFromID(r);a&&t.UpdateScenarioThumbnail(a)}}}),this.event_onViewpointEndMove=e.subscribe({event:"/VISU/"},function(e){if(e&&"@onViewpointEndMove"===e.eventType&&"controller"===e.from){var n=t._experienceBase.getManager("VCXScenarioManager");if(n&&n.GetCameraAutoKey()){var r=t._experienceBase.getManager("VCXContextManager").getActiveCamera(),a=r.QueryInterface("VCXIModifiable"),i=r.QueryInterface("VCXIViewpointController");if(i){var o=new _;i.fromViewpoint(o);var s=new c;s.AddOrModifyPropertySet(a.GetHashing(),o);var p=new g(n,t._experienceBase.getManager("VCXCommandManager"),!0);p.ChangePropertiesFromMap(s),t._experienceBase.getManager("VCXCommandManager").Push(p)}}}})},SetVolatileNotSaved:function(e){this.volatileNotSaved=e,this.volatileNotSaved},postInitialize:function(){if(this._viewer=this._experienceBase.getManager("VCXContextManager").getMainViewer(),!this._experienceBase.getManager("VCXContextManager")._UseOverrideSet&&null===this._viewer.getCurrentSceneGraphState()){var e=this._viewer.createSceneGraphState();this._viewer.setCurrentSceneGraphState(e)}this._viewer.setLightOnViewpoint(!0),this._viewer.setAutoUpdateLights(!0),this._loadingOption&&(this._loadingOption.quickLoad(this._experienceBase),this._loadingOption.HideVCXGUI()),this.InitDocumentProperties()},unInitialize:function(){this._endLoadingDone=!1,delete this._viewer,e.unsubscribe(this.event_VCX_PROPERTIES_CHANGED),delete this.event_VCX_PROPERTIES_CHANGED,e.unsubscribe(this.event_VCX_SCENARIO_CHANGED),delete this.event_VCX_SCENARIO_CHANGED,e.unsubscribe(this.event_VCX_END_LOADING_DONE),delete this.event_VCX_END_LOADING_DONE,e.unsubscribe(this.event_VCX_UPDATE_THUMBNAIL),delete this.event_VCX_UPDATE_THUMBNAIL,e.unsubscribe(this.event_onViewpointEndMove),delete this.event_onViewpointEndMove,this.debugTools&&(this.debugTools.unInitialize(),this.debugTools=null)},update:function(e){const t=[];this._loopWaits&&this._loopWaits.forEach((e,n)=>{e.remainingLoop--,e.remainingLoop<0&&(e.deferredPromise.resolve(),t.push(n))}),t.forEach(e=>{this._loopWaits.splice(e,1)})},EndLoadingDressups:function(){let e=m.generateUUID();m.memoryLog("VCXCmdChangeDressup",!0,e);var t=new a(this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.getManager("VCXDressupManager"),this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.ComponentsMap);m.memoryLog("VCXCmdChangeDressup",!1,e);for(var n=this._experienceBase.ComponentsMap.GetComponentFromType("VCXDressup_Spec"),r=0;r<n.length;r++)t.AddDressups(n[r]);this._experienceBase.getManager("VCXCommandManager").Do(t),e=m.generateUUID(),m.memoryLog("VCXDressupManager UpdateDressupList",!0,e,{N:n.length,parameterName:"dressup"}),this._experienceBase.getManager("VCXDressupManager").UpdateDressupList(),m.memoryLog("VCXDressupManager UpdateDressupList",!1,e,{N:n.length,parameterName:"dressup"})},EndLoadingViewpoints:function(){this._viewer.displayPoints(!0);for(var e=this._viewer.getViewpoints(),t=0;t<e.length;t++)this._experienceBase.getManager("VCXContextManager").isSupported("DefaultViewpointControler")||(e[t].setDefaultController(!0,"SIMPLE"),e[t].getControl().setRotationRolling(!1)),widget&&widget.enopadViewer||(e[t].reframe("iso",0),e[t].reframe(null,0))},GetViewer:function(){return this._viewer},RefreshGUI:function(){this._experienceBase.getManager("VCXGUIManager").RefreshGUI(),this._experienceBase.getManager("VCXPaperManager").updatePaper({propagateEvent:!0})},GoToScenario:function(e){this._experienceBase.getManager("VCXScenarioManager").SetCurrentScenario(e),this._experienceBase.getManager("VCXScenarioManager").RestoreNeutralProperties(),this._experienceBase.getManager("VCXScenarioManager").ApplyScenarioVisibility(e),this.SetFrameAndRefresh(0)},GoToNeutrals:function(){this._experienceBase.getManager("VCXScenarioManager").RestoreNeutralProperties(),this.SetFrameAndRefresh(0)},GoToScenarioWithInterpolation:async function(t,a){return new Promise(i=>{const o=()=>{var o=this._experienceBase.getManager("VCXScenarioManager"),s=o.GetScenarios()[t];if(!s)return console.log("SCENARIO NOT FOUND : "+t),a&&a(),void i();var c,p=!0;(0==o.GetTransitionTime()&&(p=!1),p)?((c=new r(o,this._experienceBase.ComponentsMap,this._experienceBase.getManager("VCXCommandManager"))).BuildTransitionTo(s),c.SetCallback(()=>{a&&a(),i()}),this._experienceBase.getManager("VCXCommandManager").Push(c)):(e.publish({event:"VCX_BEGIN_TRANSITION",data:{maxframe:10,scenario:s}}),(c=new n(o,this._experienceBase.getManager("VCXCommandManager"))).GoToScenario(t),this._experienceBase.getManager("VCXCommandManager").Push(c),e.publish({event:"VCX_END_TRANSITION"}))};this._experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario()&&(this._experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),this._experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1)),this._experienceBase.getManager("VCXPulseManager").isActive()?this._experienceBase.getManager("VCXPulseManager").StopPulse(o):o()})},SetFrameAndRefresh:function(e,t){this._FrameLastScenarioID===this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario()&&this._FrameLastRender===e||(this._FrameLastScenarioID=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario(),this._FrameLastRender=e,this._experienceBase.getManager("VCXScenarioManager").SetCurrentFrame(e),this._experienceBase.getManager("VCXScenarioManager").UpdateProperties(),t||this._experienceBase.getManager("VCXContextManager").getMainViewer().render())},capturePixels:async function(e){var t=this._experienceBase,n=new V,r=[165,118],a=1.5*r[0],i=1.5*r[1];return n.doThumbnailToDataUrl(t,a,i,e)},capturePIP:async function(){const e=this._experienceBase,t=e.getManager("VCXContextManager");if(t&&t.isSupported("BetterSceneThumbnail")){const t=e.getManager("VCXPaperManager").Ratio;var n=new V;let r;return await n.doHiRes(e,1024,1024*t,{mode:V.Mode.Current,quality:.8,usePaper:!0},e=>{r=e.image}),r&&r.toDataUrl("image/png",.8)}return null},CaptureScenarioWithThumbnail:async function(e,t){var n,r;if(t){(n=this._experienceBase.Factory.BuildComponent("VCXScenario")).SetScenarioType(M.EScenarioType.Scenario),n.GetVisibility().SetMode(1);var a=n.GetVisibility();a&&(a.Empty(),n.SetVisibility(a)),n.SetPersistency(0),n.SetApplyNeutralAtGoToScenario(!0),n.SetZoomFitAll(!0)}else{var i=this._experienceBase.getManager("VCXContextManager").getActiveCamera();i||console.log("No Camera, scenario does not capture viewpoint..");var o=null;if(i){o=i.QueryInterface("VCXIModifiable");var s=i.QueryInterface("VCXIViewpointController");s&&s.fromViewpoint();var c=this._experienceBase.getManager("VCXScenarioManager")._keyframer._Neutrals.GetPropertySet(o.GetHashing()),p=o.GetProperties();c&&Object.keys(c._map).equals(Object.keys(p._map))||this._experienceBase.getManager("VCXScenarioManager").AddNeutrals(o,p)}var l={bIsPartialView:!1,visibilityMode:1,scenarioType:M.EScenarioType.Scenario,persistency:0};n=this._experienceBase.getManager("VCXScenarioManager").CaptureCurrentView(l)}if(e)r=e;else{let e=this._experienceBase.getManager("VCXGUIManager").GetActiveSequenceId();var g=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromId(e),h=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();r="Scene "+(g.GetIndexOfScenario(h)+1+1).toString()}n.SetName(r);var m=n.QueryInterface("VCXIModifiable"),f=new d(this._experienceBase.getManager("VCXScenarioManager"));f.CaptureNeutralProperties(m),f.Do();const V=await this.capturePixels();var _=u.dataURLToBlob(V);let S=null;if(_){var X=window.URL.createObjectURL(_),D=this._experienceBase.getManager("VCXDocManager").BuildPathFromString(X);(x=new C).SetValue("thumbnail.jpg"),D.SetFileName(x),S=this._experienceBase.getManager("VCXDocManager").AddOrModifyDoc(D,V)}const v=await this.capturePIP();var I=v&&u.dataURLToBlob(v);let b=null;if(I){var x;X=window.URL.createObjectURL(I),D=this._experienceBase.getManager("VCXDocManager").BuildPathFromString(X);(x=new C).SetValue("pip.jpg"),D.SetFileName(x),b=this._experienceBase.getManager("VCXDocManager").AddOrModifyDoc(D,v)}return(S||b)&&(S&&n.SetDocId(S.GetValue()),b&&n.SetPIPDocId(b.GetValue()),(f=new d(this._experienceBase.getManager("VCXScenarioManager"))).CaptureNeutralProperties(m),f.Do()),n},UpdateScenario:function(e){return this.CaptureScenarioWithThumbnail(e.GetName()).then(t=>{var n=new s(this._experienceBase.getManager("VCXScenarioManager"));n.ReplaceScenario(e,t),this._experienceBase.getManager("VCXCommandManager").Push(n),this._experienceBase.getManager("VCXGUIManager").deleteTimeline()})},ClearTimerScenarioUpdate:function(){this._UpdateScenarioThumbnailTimer&&window.clearTimeout(this._UpdateScenarioThumbnailTimer),this._UpdateScenarioThumbnailTimer=null},UpdateScenarioThumbnail:async function(t,n){if(!t)return;if(this._experienceBase.getManager("VCXContextManager").getPlayerMode())return;if(!this._endLoadingDone)return;const r=async()=>{this._experienceBase.getManager("VCXContextualContentManager")&&this._experienceBase.getManager("VCXContextualContentManager").contextualShortcutToolbarCtrl&&this._experienceBase.getManager("VCXContextualContentManager").contextualShortcutToolbarCtrl.isContextualBarDisplayed()?this._experienceBase.getManager("VCXContextualContentManager").contextualShortcutToolbarCtrl.contextualBarContextualMenuObserver(!1,"wux-afr-contextual-bar",async()=>{await a()}):await a()},a=async()=>{if(!this.funcRefreshRunning&&this._experienceBase.isValid&&this._endLoadingDone){this.funcRefreshRunning=!0;var n,r=this._experienceBase.getManager("VCXExperience"),a=this._experienceBase.getManager("VCXScenarioManager");await r.getAllActorsReadiness();try{if(this.ClearTimerScenarioUpdate(),!this._experienceBase.isValid)throw new Error("Experience not valid anymore");if(console.log("updating thumbnail"),this._experienceBase.getManager("VCXContextManager").update({viewer:this._viewer,viewpoint:this._viewer.currentViewpoint}),!a.GetCameraAutoKey()){(g=this._experienceBase.getManager("VCXVisuManager"))&&(g.CameraControlsViewpoint=!0,g.CameraEasingTime=0),n=new S;for(var i=this._experienceBase.ComponentsMap.GetComponentFromType("CXPCameraActor_Spec"),o=0;o<i.length;o++){var s=new _;i[o].QueryInterface("VCXIViewpointController").fromViewpoint(s);var c=i[o].QueryInterface("VCXIModifiable");for(var p in s._map)if(s._map.hasOwnProperty(p)){var l=s.GetProperty(p);n.ChangeProperty(c,l)}a.UpdateProperties(c.GetHashing())}}var g;if(!a.GetCameraAutoKey())this._experienceBase.getManager("VCXCommandManager").Do(n),(g=this._experienceBase.getManager("VCXVisuManager"))&&(g.CameraControlsViewpoint=!1,g.CameraEasingTime=null);let r=await this.capturePixels();var h=u.dataURLToBlob(r);if(h){const e=this._experienceBase.getManager("VCXDocManager");e.RemoveDocument(t.GetDocId());var m=window.URL.createObjectURL(h),M=e.BuildPathFromString(m);(D=new C).SetValue("thumbnail.jpg"),M.SetFileName(D);var f=e.AddOrModifyDoc(M,r,t.GetDocId());t.SetDocId(t.GetDocId())}let v=await this.capturePIP();var V=v&&u.dataURLToBlob(v);if(V&&t.GetPIPDocId){var X=this._experienceBase.getManager("VCXDocManager");X.RemoveDocument(t.GetPIPDocId().docID);var D;m=window.URL.createObjectURL(V),M=X.BuildPathFromString(m);if((D=new C).SetValue("pip.jpg"),M.SetFileName(D),t.GetPIPDocId().docID<0){t.SetPIPDocId(f.GetValue());const e=t.QueryInterface("VCXIModifiable"),n=new d(this._experienceBase.getManager("VCXScenarioManager"));n.CaptureNeutralProperties(e),n.Do()}else X.AddOrModifyDoc(M,v,t.GetPIPDocId().docID)}(h||V)&&e.publish({event:"VCX_SCENARIO_REPLACED",data:t})}catch(e){console.error(e)}finally{this.funcRefreshRunning=!1}}};n?await r():this._UpdateScenarioThumbnailTimer?(window.clearTimeout(this._UpdateScenarioThumbnailTimer),this._UpdateScenarioThumbnailTimer=null,this._UpdateScenarioThumbnailTimer=window.setTimeout(r,1e3)):this._UpdateScenarioThumbnailTimer=window.setTimeout(r,1e3)},CreateNewScenario:function(e,t){return this.CaptureScenarioWithThumbnail("",t).then(t=>{for(var n="",r="",a=this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection(),i=0;i<a.length;i++){var s=a[i];s.IsKindOf("VCXScenarioSequence")||s.IsKindOf("VCXScenario")&&(r=s.GetID())}var c=new o(this._experienceBase.getManager("VCXSequenceManager"),this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap),p=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(r);if(p){var l=this._experienceBase.getManager("VCXSequenceManager").GetPreviousScenarioId(r);c.InsertScenarioInSequence(t,p.GetID(),l),{scenario:t,sequenceId:p.GetID(),prevIndex:p.GetIndexOfScenario(l)}}else{if(n=this._experienceBase.getManager("VCXGUIManager").GetActiveSequenceId());else{var C=this._experienceBase.getManager("VCXSequenceManager").GetListSequences();if(!C[0])return;n=C[0].GetID()}var g=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromId(n),d=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario(),u=g.GetIndexOfScenario(d);c.InsertScenarioInSequence(t,n,u+1),{scenario:t,sequenceId:n,prevIndex:this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromId(n).GetListScenariosId().length-1}}return e?this._experienceBase.getManager("VCXCommandManager").Do(c):this._experienceBase.getManager("VCXCommandManager").Push(c),this._experienceBase.getManager("VCXContextManager").renderAll(),t})},InitImagePanels:async function(){if(console.log("InitImagePanels"),-1==this._experienceBase.getManager("VCXDocManager").GetDefaultImageIndex()){var t=this,n=h.getWebappsAssetUrl("VCXWebVisualization","texture/I_VCX_DefaultTexture.png"),r=new Image;return r.crossOrigin="Anonymous",new Promise((a,i)=>{r.onload=function(){if(t._experienceBase.Factory){var n=document.createElement("CANVAS"),r=n.getContext("2d");n.height=this.height,n.width=this.width,r.drawImage(this,0,0);var i=n.toDataURL("image/png"),o=u.dataURLToBlob(i),s=window.URL.createObjectURL(o),c=t._experienceBase.getManager("VCXDocManager").BuildPathFromString(s,"I_VCX_DefaultTexture.png"),l=t._experienceBase.getManager("VCXDocManager").AddOrModifyDocInt(c);if(t._experienceBase.getManager("VCXDocManager").actorDocManager){var C=t._experienceBase.getManager("VCXDocManager").actorDocManager.QueryInterface("VCXIModifiable"),d=new p(l),h=C.GetProperty("DocManager.defaultIndex");h.SetPropertyValue(d);var m=new g(t._experienceBase.getManager("VCXScenarioManager"),t._experienceBase.getManager("VCXCommandManager"),!0);m.ChangeProperty(C,h),t._experienceBase.getManager("VCXCommandManager").Do(m)}else t._experienceBase.getManager("VCXDocManager").SetDefaultImageIndex(l);n=null,e.publish({event:"VCX_IMAGE_INIT_DONE"}),a()}},r.onerror=(e=>{i(e)}),r.src=n})}},InitDocumentProperties:function(){var e=new d(this._experienceBase.getManager("VCXScenarioManager")),t=this._experienceBase.getManager("VCXScenarioManager").QueryInterface("VCXIModifiable");e.ChangeProperty(t,"ScenarioManager.FPS",new l(30)),e.ChangeProperty(t,"ScenarioManager.InterFramesMax",new p(10)),e.ChangeProperty(t,"ScenarioManager.startScenarioId",new C(""));this._experienceBase.getManager("VCXDocManager").QueryInterface("VCXIModifiable");var n=this._experienceBase.getManager("VCXCommandManager").QueryInterface("VCXIModifiable");e.ChangeProperty(n,"CommandManager.maxSize",new p(500)),this._experienceBase.getManager("VCXCommandManager").Do(e)},SetViewMode:function(e){this._viewMode=e},GetViewMode:function(){return this._viewMode},loadNLS:function(e){if(window.widget){var t=window.widget.lang;f.DEFAULT_LANGUAGE=t}this._experienceBase.odt&&(f.DEFAULT_LANGUAGE="en");for(var n=this._experienceBase.getManager("VCXNLSManager"),r=[],a=0;a<e.length;a++){var i=new UWA.Promise(function(t,n){f.onResourceLoaded({resourceFile:e[a]},function(){t({resourceKey:this._resourceKey,nlsManager:this})}),f.loadResource({resourceFile:e[a]})});i.then(function(e){n.AddNLS(e.resourceKey,e.nlsManager)}),r.push(i)}return UWA.Promise.allSettled(r)},_addManager:function(e,t,n,r,a){var i=this._experienceBase.Factory.BuildComponent(e);return i?(i.SetID(e+"ID"),i.SetPersistency(t),n.addManager(e,i,a),r.push(i),i):(console.error("Can't create manager "+e),null)},waitLoops:async function(e){this._loopWaits||(this._loopWaits=[]);const t={remainingLoop:e,deferredPromise:UWA.Promise.deferred()};return this._loopWaits.push(t),t.deferredPromise.promise},getAllActorsReadiness:async function(){let e=[];return Object.values(this._experienceBase.ComponentsMap.GetComponentTable()).forEach(t=>{let n=t&&t.QueryInterface("VCXIReadiness");if(n){let t=n.isReady();t&&e.push(t)}}),e.length?(this.readinessPromise||(this.readinessPromise=UWA.Promise.deferred()),Promise.allSettled(e).then(()=>{this.getAllActorsReadiness()}),this.readinessPromise.promise):(this.readinessPromise&&(this.readinessPromise.resolve(),this.readinessPromise=null),!0)},addApplicationManagers:function(){var e=this._experienceBase.getManager("VCXContextManager").getPlayerMode(),t=this._experienceBase.getManager("VCXContextManager").getProdHighMode(),n=this._experienceBase.getManager("VCXContextManager").getExperienceIn3DPlay(),r=this._experienceBase.getManager("VCXContextManager").getExperienceInConnectedPlayer(),a=[];(this._addManager("VCXNotificationManager",2,this._experienceBase._ManagerSet,a),this._addManager("VCXGUIManager",1,this._experienceBase._ManagerSet,a,6),this._addManager("VCXSelectionManager",1,this._experienceBase._ManagerSet,a),this._addManager("VCXSelectManager",2,this._experienceBase._ManagerSet,a),this._addManager("VCXMultiUserInputManager",2,this._experienceBase._ManagerSet,a),this._addManager("VCXMaterialManager",2,this._experienceBase._ManagerSet,a),this._addManager("VCXPaperManager",2,this._experienceBase._ManagerSet,a),this._addManager("VCXDressupManager",2,this._experienceBase._ManagerSet,a),this._addManager("VCXImageManager",2,this._experienceBase._ManagerSet,a),this._addManager("VCXHyperlinkManager",2,this._experienceBase._ManagerSet,a),this._addManager("VCXStylesManager",1,this._experienceBase._ManagerSet,a),this._experienceBase.getManager("VCXContextManager").isSupported("VCXIV")&&this._addManager("VCXIVManager",2,this._experienceBase._ManagerSet,a),this._addManager("VCXVisuManager",2,this._experienceBase._ManagerSet,a),this._addManager("VCXNLSManager",2,this._experienceBase._ManagerSet,a),this._addManager("VCXAPIManager",2,this._experienceBase._ManagerSet,a),this._addManager("VCXMarkerManager",2,this._experienceBase._ManagerSet,a),this._addManager("VCXDRMManager",1,this._experienceBase._ManagerSet,a),this._addManager("VCXPulseManager",1,this._experienceBase._ManagerSet,a),this._addManager("VCXManipulatorManager",1,this._experienceBase._ManagerSet,a),this._addManager("VCXPlayManager",1,this._experienceBase._ManagerSet,a),(this._experienceBase.getManager("VCXContextManager").getCat3DXIntegration()||n&&t)&&(this._addManager("VCXCAT3DXModelManager",1,this._experienceBase._ManagerSet,a,3),this._addManager("VCXEWSManager",1,this._experienceBase._ManagerSet,a,5),this._addManager("CAT3DXLinkManager",1,this._experienceBase._ManagerSet,a,2),this._addManager("CAT3DXLoaderManager",1,this._experienceBase._ManagerSet,a)),e||t)&&(this._addManager("VCXSectionManager",1,this._experienceBase._ManagerSet,a),this._addManager("VCX3DGridManager",1,this._experienceBase._ManagerSet,a),this._addManager("VCXRobotAdapter",1,this._experienceBase._ManagerSet,a),this._addManager("VCXVolatileGhostingManager",1,this._experienceBase._ManagerSet,a).setKeepGhostCommand(!0),this._experienceBase.getManager("VCXContextManager").isSupported("VCXQueryEngine")&&this._addManager("VCXQueryEngine",1,this._experienceBase._ManagerSet,a),this._addManager("VCXHotspotManager",1,this._experienceBase._ManagerSet,a),this._addManager("VCXSelectionSetManager",1,this._experienceBase._ManagerSet,a),this._experienceBase.getManager("VCXContextManager").setSupported("PartZoom"),this._addManager("VCXComponentPartListManager",1,this._experienceBase._ManagerSet,a));this._addManager("VCXUserInputControllerManager",1,this._experienceBase._ManagerSet,a),this._addManager("VCXMagnetLineManager",1,this._experienceBase._ManagerSet,a),n&&t&&this._addManager("CAT3DXVisuManager",1,this._experienceBase._ManagerSet,a),!r&&n&&this._addManager("VCXComposerAPIManager",1,this._experienceBase._ManagerSet,a),!t||n||e||(this._addManager("VCXContextualContentManager",2,this._experienceBase._ManagerSet,a),this._addManager("VCXCanonicsManager",1,this._experienceBase._ManagerSet,a),this._addManager("VCXAnalyticsTrackerAppManager",1,this._experienceBase._ManagerSet,a),(void 0!==this._experienceBase.getManager("VCXContextManager").getUrlVars().debug||this._experienceBase.odt)&&(this._experienceBase.getManager("VCXContextManager").setSupported("Section"),this._experienceBase.getManager("VCXContextManager").setSupported("Paths")),t&&(this._experienceBase.getManager("VCXContextManager").setSupported("PublishJobRAAS"),this._addManager("VCXLivePreviewRenderingManager",1,this._experienceBase._ManagerSet,a)));var o=new i(this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap);return o.AddComponents(a),this._experienceBase.getManager("VCXCommandManager").Do(o),a}});return Object.defineProperty(X.prototype,"componentType",{enumerable:!0,get:function(){return"VCXExperience"}}),X}),define("DS/VCXWebComposer/VCXISelectBehavior",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("DS/VCXWebComposer/VCXLoadServices",["UWA/Class","DS/CoreEvents/Events","DS/WebComponentModeler/WebComponentBase","DS/VCXWebKernelCommands/VCXCmdChangeModifiable","DS/VCXWebDressup/VCXCmdChangeDressup","DS/CATCXPModel/interfaces/CATI3DXAssetProperties","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyValueMap","DS/VCXWebProperties/VCXPropertyValueList","DS/VCXWebPlatform/VCX3DSpaceServices","DS/VCXWebPlatform/VCXPlatformServices","DS/WebRBTree/WebRBIterator","DS/VCXWebSystem/VCXEnums","DS/VCXWebIO/VCXLogServices","DS/Visualization/IdPath","i18n!DS/VCXWebEWS/assets/nls/VCXWebEWS"],function(e,t,n,r,a,i,o,s,c,p,l,C,g,d,u,h){"use strict";let m=e.singleton({Initialize:function(e){this._experienceBase=e,this._isLoadingVisu=!1},UnInitialize:function(){this._experienceBase=null,this._isLoadingVisu=!1},SetIsLoadingVisu:function(e){this._isLoadingVisu=e},GetIsLoadingVisu:function(){return this._isLoadingVisu},pathOfIDsToHash:function(e,t){let n=[],r=[];n.push(t),e[0]!==t&&(r=(n=n.concat(e)).slice(0,Math.max(n.length-1,0)));let a="";n.every(e=>(a+="|"+e,!0));let i="";return r.every(e=>(i+="|"+e,!0)),{object:a,parent:i}},_OnCreatedOverride:function(e,t){return e.QueryInterface("CATI3DXOverrideAssetProperties").getPathOfPhysicalId().then(n=>{e.isNewFromUpdate=!0;let r={instanceName:"unknown",referenceName:"unknown"},a="";a=n[n.length-1];let i=t.ProductStructure[a];if(console.log(a+" "+i),i&&(r.instanceName=i.name,i.reference)){let e=t.ProductStructure[i.reference];e&&(r.referenceName=e.name)}return r.override=e,UWA.Promise.resolve(r)})},_CreateMissingOverrides:function(e,t,n,r){console.log("==================== _CreateMissingOverrides");let a=[],i=[];if(n.PlmIds)for(let r in n.PlmIds){let o=n.PlmIds[r],s=o.expObject;if(s||o.ids[0]===e&&(s=t),!s){const e=this._experienceBase.getManager("VCXContextManager");e&&!e.isSupported("VCXCreateOverridesOnDemand")&&(i.push(r),a.push(o.ids))}}if(r.newOverides||(r.newOverides=[]),0===i.length)return UWA.Promise.resolve();console.log("## Number of NEW overrides to create = "+i.length);let o=this._experienceBase.getManager("VCXCAT3DXModelManager").GetCAT3DXModel().CreateOverridesProduct(a,t).then(e=>{if(console.log("## Number of NEW overrides created = "+e.length),e.length!==i.length)return new UWA.Promise.reject(new Error("there was issue when creating new overrides"));let t=[];for(let a=0;a<e.length;a++){let i=e[a];t.push(this._OnCreatedOverride(i,n).then(e=>{r.newOverides.push(e)}))}return UWA.Promise.all(t).then(()=>UWA.Promise.resolve(e))}).then(e=>{let t=this._experienceBase.ComponentsMap.GetComponentFromType("VCXScenario");for(let n=0;n<t.length;n++){let r=t[n].GetVisibility();for(let t=0;t<e.length;t++){let n=e[t];r.AddVisible(n)}t[n].SetBoostDirty()}return r.hasImpactOnScenario=!0,UWA.Promise.resolve()}),s={strObjectType:h["ProgressNotification.Updating1"],maskDisplayAdd:18,iPromise:o};return this._experienceBase.getManager("VCXNotificationManager").addProgressNotification(s),o},_RemoveDeprecatedLinks:async function(e,t){console.log("==================== _RemoveDeprecatedLinks");let n=this._experienceBase.getManager("VCXScenarioManager");if(n){e.impactedComponents||(e.impactedComponents={}),e.impactedComponentsInverted||(e.impactedComponentsInverted={}),n.ResetLinksTo(t,e.impactedComponents,e.impactedComponentsInverted,!1,null);for(let t in e.impactedComponents)if(e.impactedComponents.hasOwnProperty(t)){let e=this._experienceBase.ComponentsMap.GetComponentFromID(t);e&&(e.isImpactedByUpdate=!0)}let r=this._experienceBase.ComponentsMap.GetComponentFromType("VCXScenario");for(let e=0;e<r.length;e++){let n=r[e].GetVisibility();if(n)for(let a in t)t.hasOwnProperty(a)&&(n._visibilityMap[a]&&(delete n._visibilityMap[a],r[e].SetBoostDirty()),n._visibilityMapCollab[a]&&(delete n._visibilityMapCollab[a],r[e].SetBoostDirty()))}}},_RemoveDeprecatedMaterialSingle:async function(e){let t=e.QueryInterface("CATI3DXMaterialAsset");if(t)try{await t.getMaterial()}catch(t){e.isHasLinkBrokenFromUpdate=!0;let n=e.QueryInterface("CATI3DExperienceObject").GetValueByName("_varName"),r={};return r.instanceName=n,r.referenceName="unknown",r.id=e.GetID(),r}},_RemoveDeprecatedMaterial:async function(e,t){console.log("==================== _RemoveDeprecatedMaterial"),e.deletedMaterials||(e.deletedMaterials=[]);let n=[],r=this._experienceBase.ComponentsMap.GetComponentFromType("CXPCoveringMaterial_Spec");for(let a=0;a<r.length;a++)n.push(this._RemoveDeprecatedMaterialSingle(r[a]).then(n=>(n&&(t[n.id]=!0,e.deletedMaterials.push(n)),UWA.Promise.resolve())));return await UWA.Promise.all(n),t},_RemoveDeprecatedAmbianceSingle:async function(e){let t=e.QueryInterface("CATI3DXAmbienceAsset").getAmbience();if(t)try{await t}catch(t){let n=e.QueryInterface("CATI3DExperienceObject");if(!n)return console.log("_RemoveDeprecatedAmbianceSingle : CATI3DExperienceObject FAILED !!!!!!!!!!!!!!!!!!!"),console.log(t),UWA.Promise.resolve();e.isHasLinkBrokenFromUpdate=!0;let r=n.GetValueByName("_varName");console.log("deleting AMBIENCE ["+r+"]");let i=new a(this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.getManager("VCXDressupManager"),this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.ComponentsMap);i.RemoveDressups(e),this._experienceBase.getManager("VCXCommandManager").Do(i);let o={instanceName:"unknown",referenceName:"unknown"};return o.instanceName=r,o.id=n.GetObject().GetID(),o}},_RemoveDeprecatedAmbiance:async function(e,t){console.log("==================== _RemoveDeprecatedAmbiance"),e.deletedAmbiences||(e.deletedAmbiences=[]);let n=[],r=this._experienceBase.ComponentsMap.GetComponentFromType("AmbienceModel_Spec");for(let a=0;a<r.length;a++)n.push(this._RemoveDeprecatedAmbianceSingle(r[a]).then(n=>(n&&(t[n.id]=!0,e.deletedAmbiences.push(n)),UWA.Promise.resolve())));return await UWA.Promise.all(n),t},_DeleteOverrideWithSameParent:async function(e){let t=this._experienceBase.getManager("VCXCAT3DXModelManager").GetCAT3DXModel();await t.DeleteOverrides(e),console.log("## Number of overrides deleted = "+e.length)},_RemoveDeprecatedOverride:async function(e,t){if("Model_VPMReference_Spec"===e.GetObject().GetType())return;if(e.IsKindOf("VCXVolatileComponentOccurrenceComposer")&&e.GetPersistency()===n.EPersistencyType.notPersistent)return;let a=e.QueryInterface("CATI3DExperienceObject"),o=e.QueryInterface("CATI3DXOverrideAssetProperties");if(a&&o){let t=a.GetValueByName("_varName"),n=!1;o.getAssetStatus()===i.AssetStatus.StatusBroken&&(n=!0);let s=n;try{if(s){e.isHasLinkBrokenFromUpdate=!0;let n=e.QueryInterface("VCXIModifiable");if(n){let e=[];e.push(n);let t=new r(this._experienceBase.getManager("VCXScenarioManager"));t.RemoveModifiables(e),this._experienceBase.getManager("VCXCommandManager").Do(t)}let i={instanceName:"unknown",referenceName:"unknown"};return i.instanceName=t,i.id=a.GetObject().GetID(),{delOverideDesc:i,iOverrideToDelete:a}}}catch(n){e.isHasLinkBrokenFromUpdate=!0;let i=e.QueryInterface("VCXIModifiable");if(i){let e=[];e.push(i);let t=new r(this._experienceBase.getManager("VCXScenarioManager"));t.RemoveModifiables(e),this._experienceBase.getManager("VCXCommandManager").Do(t)}let o={instanceName:"unknown",referenceName:"unknown"};return o.instanceName=t,o.id=a.GetObject().GetID(),{delOverideDesc:o,iOverrideToDelete:a}}}},_RemoveDeprecatedOverrides:async function(e){console.log("==================== _RemoveDeprecatedOverrides"),e.deletedOverides||(e.deletedOverides=[]);let t=[],n={},r=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceComposer");console.log("_RemoveDeprecatedOverrides : current VCXComponentOccurrenceComposer number = "+r.length);let a=[];for(let i=0;i<r.length;i++)t.push(this._RemoveDeprecatedOverride(r[i],e.ProductStructures).then(t=>(t&&(e.deletedOverides.push(t.delOverideDesc),a.push(t.iOverrideToDelete),n[t.iOverrideToDelete.GetObject().GetID()]=!0),UWA.Promise.resolve())));if(await UWA.Promise.all(t),console.log("## Number of overrides to delete = "+a.length),0===a.length)return n;let i={};for(let e=0;e<a.length;e++){let t=a[e],n=t.GetParent();if(n){let e=n.GetID();void 0===i[e]&&(i[e]=[]),i[e].push(t)}}let o=[];for(let e in i)o.push(this._DeleteOverrideWithSameParent(i[e]));let s=UWA.Promise.all(o),c={strObjectType:h["ProgressNotification.Updating2"],maskDisplayAdd:18,iPromise:s};return this._experienceBase.getManager("VCXNotificationManager").addProgressNotification(c),await s,console.log("## all overrides removed"),n},_UpdateNavigableTree:async function(e,t,n){let r={};r[t]=n;let a=e=>{let r=e.expObject;return r||e.ids[0]===t&&(r=n),r};if(e.PlmIds){for(let n in e.PlmIds)if(e.PlmIds.hasOwnProperty(n)){let i=e.PlmIds[n],o=a(i);o.SetIsMesh&&o.SetIsMesh(!0),i.hashCodes=this.pathOfIDsToHash(i.ids,t),i.hashCodes.object&&(r[i.hashCodes.object]=o);let s=i.ids[i.ids.length-1],c=e.ProductStructure[s];if(c){o._refid=c.reference,"VPMInstance"!==c.type?(o._reference=c.name,o._instance=""):(o._reference=e.ProductStructure[c.reference].name,o._instance=c.name),""===o._instance.trim()?o._name=o._reference:o._name=o._reference+" ("+o._instance+")";let t=o.QueryInterface("W3AISGNodeHolder");t&&t.getPathElement()&&t.getPathElement().getLastElement()&&(t.getPathElement().getLastElement().productType=c.type)}}let n=this._experienceBase.getManager("VCXCAT3DXModelManager").GetCAT3DXModel();const i=[];for(let t in e.PlmIds)if(e.PlmIds.hasOwnProperty(t)){let n=a(e.PlmIds[t]);i.push({object:n,variableName:"_varName",variableValues:n._name})}const o=d.generateUUID();d.memoryLog("SetVariablesValues",!0,o),await n.SetVariablesValues(i),d.memoryLog("SetVariablesValues",!1,o);for(let t in e.PlmIds)if(e.PlmIds.hasOwnProperty(t)){let n=e.PlmIds[t],i=a(n);if(i&&(i._hashPathID=n.hashCodes.object),n.hashCodes&&n.hashCodes.parent&&n.expObject){let e=r[n.hashCodes.parent];if(e){e.SetIsMesh&&e.SetIsMesh(!1);let t=n.expObject.QueryInterface("VCXIModelNavigable");t&&t.setParent(e.QueryInterface("VCXIModelNavigable"))}}}}},_RemoveDeprecatedComponents:async function(e){let t=await this._RemoveDeprecatedOverrides(e);return t=await this._RemoveDeprecatedAmbiance(e,t),t=await this._RemoveDeprecatedMaterial(e,t),this._RemoveDeprecatedLinks(e,t)},buildNavigableFromActorAsset:function(e){const t=e.QueryInterface("VCXIModelNavigable");let n=e.QueryInterface("CATI3DX3DActorAsset"),r=n&&n.getVisuOverrideChildren();if(r)for(const e of r){e.QueryInterface("VCXIModelNavigable").setParent(t),m.buildNavigableFromActorAsset(e)}},setComponentAttributes:async function(e,t){const n=widget.enopadViewer,r=n&&n.getController();if(!e._pid)if("Model_VPMReference_Spec"===e.componentType||"Model_VPMReference_Spec"===e.GetType()){if(e._pid=e._refid,r&&e._refid){const t=[e._refid];e.QueryInterface("W3AISGNodeHolder").setPathOfIDs(new u(t))}}else{if(!e._pid&&t.productIndex){const n=e.QueryInterface("CATI3DXOverrideAssetProperties");if(!n)return;const r=n&&await n.getPathOfPhysicalId();e._pid=r&&r[r.length-1];const a=t.productIndex.getPathOfIDsFromPathOfInstances(r),i=t.productIndex.getRefInstNode(a);i&&(i.component=e),await t.productIndex.setComponentAttributes(e)}if(r){let n=[];e.SetIsMesh(!0);let r=e.QueryInterface("VCXIModelNavigable");for(;r;){const a=r.GetObject();e._refid||await m.setComponentAttributes(a,t),a._refid&&n.push(a._refid),a._pid&&n.push(a._pid),r=r.getParent()}n.pop(),(n=n.reverse()).pop(),e.QueryInterface("W3AISGNodeHolder").setPathOfIDs(new u(n))}}},createComponentsFromPoInstances:async function(e){},createComponentsFromPathElements:async function(e,t){const n=widget.enopadViewer,r=n&&n.getController();if(r){const n=[];if(e)for(const t of e){const e=r.buildArrayFromPath(t);e&&n.push(new u(e))}return this.createComponentsFromPOIds(n,t)}},createComponentsFromPOIds:async function(e,r){if(!e||e.length<1)return;const a={},i=[];for(const t of e){let e=[],s=[];if(t&&t.ids&&t.ids){let c=1;for(const p of t.ids){s.push(p);const t=s.slice();if(c++,"VPMInstance"===(r&&r.productIndex&&r.productIndex._partInfo&&r.productIndex._partInfo[p]&&r.productIndex._partInfo[p]["ds6w:type"])){e.push(p);const r=e.slice();var o=r.toString();let s=this._experienceBase.ComponentsMap.getComponentFromIDPath(t,!0);(!s||s.IsKindOf("VCXVolatileComponentOccurrenceComposer")&&s.GetPersistency()===n.EPersistencyType.notPersistent)&&(a&&a[o]||this._creationList&&this._creationList[o]||(i.push(r),a[o]={poid:r,index:i.length-1}))}}}}if(i.length>0){let e=this._experienceBase.getManager("VCXCAT3DXModelManager").GetCAT3DXModel();const t=d.generateUUID();d.memoryLog("CreateOverridesProduct cmd",!0,t,{N:i.length,parameterName:"pathsOfIds"});const n=await e.CreateOverridesProduct(i,r);if(d.memoryLog("CreateOverridesProduct cmd",!1,t,{N:i.length,parameterName:"pathsOfIds"}),n.length===i.length)for(const e in a)this._creationList||(this._creationList={}),this._creationList[e]=n[a[e].index]}const s=[];for(const t of e)s.push(...await this._createComponentFromPOId(t,r));return t.publish({event:"VCX_COMPONENTS_CREATED",data:{components:s,product:r}}),s},createComponentFromPathElement:async function(e,t){const n=widget.enopadViewer,r=n&&n.getController(),a=r&&r.buildArrayFromPath(e),i=a&&await this.createComponentsFromPOIds([new u(a)],t);return i&&i[0]&&i[0][i.length-1]},createComponents:async function(e){const t={};for(const r of e)if(r.IsKindOf("VCXVolatileComponentOccurrenceComposer")&&r.GetPersistency()===n.EPersistencyType.notPersistent){let e=r.QueryInterface("VCXIModelNavigable");for(;e&&!e.GetObject().IsKindOf("Model_VPMReference_Spec");)e=e.getParent();const n=e&&e.GetObject().IsKindOf("Model_VPMReference_Spec")&&e.GetObject();if(n){const e=r.QueryInterface("W3AISGNodeHolder").getPathOfIDs(),a=e&&n.productIndex.getRefInstNode(e.ids);a&&(t[n.GetID()]||(t[n.GetID()]={product:n,pathOfInstances:[]}),t[n.GetID()].pathOfInstances.push(new u(a.getPathOfIDs())))}}for(const e in t)await this.createComponentsFromPOIds(t[e].pathOfInstances,t[e].product)},_createComponentFromPOId:async function(e,r){let a=[],i=[],o=[],s=r;if(s||console.error(new Error("Root doesn't exist")),e&&e.ids&&e.ids){let p=1;for(let l=0;l<e.ids.length;l++){const C=e.ids[l];o.push(C);const g=o.slice();if(p++,"VPMInstance"===(r&&r.productIndex&&r.productIndex._partInfo&&r.productIndex._partInfo[C]&&r.productIndex._partInfo[C]["ds6w:type"])){let o=e.ids[l+1];"VPMInstance"===(r&&r.productIndex&&r.productIndex._partInfo&&r.productIndex._partInfo[o]&&r.productIndex._partInfo[o]["ds6w:type"])&&(o=null),i.push(C);const p=i.slice();var c=p.toString();let d=this._experienceBase.ComponentsMap.getComponentFromIDPath(g,!0);if(s&&(!d||d.IsKindOf("VCXVolatileComponentOccurrenceComposer")&&d.GetPersistency()===n.EPersistencyType.notPersistent)){const e=s.QueryInterface("VCXIModelNavigable");if(!this._creationList||!this._creationList[c]){this._creationList||(this._creationList={});let e=this._experienceBase.getManager("VCXCAT3DXModelManager").GetCAT3DXModel();this._creationList[c]=e.CreateOverrideProduct(p,p.toString(),r)}try{d.IsKindOf("VCXVolatileComponentOccurrenceComposer")?d.setPersistentComponent(await this._creationList[c]):(d=await this._creationList[c],this._experienceBase.ComponentsMap.AddComponent(d)),d.QueryInterface("VCXIModelNavigable").setParent(e),await m.setComponentAttributes(d,r),t.publish({event:"VCX_COMPONENT_CREATED",data:{component:d,product:r}}),this._experienceBase.getManager("VCXScenarioManager").ConsiderNewComponent(d)}catch(e){console.error(e)}}a.push(d),s=d}}}return a},GetNeutralsFromVariables:function(e){let t={};if(e)for(let n=0;n<e.length;n++){let r=e[n];if(r){t[r.GetID()]=r}}else t=this._experienceBase.ComponentsMap.GetComponentTable();let r=this._experienceBase.getManager("VCXScenarioManager");for(let e in t)if(t.hasOwnProperty(e)){let a=t[e];if(a.GetPersistency()!==n.EPersistencyType.notPersistent){let e=a.QueryInterface("CATI3DExpVCXObjectConvertor");if(e){let t=a.QueryInterface("VCXIModifiable"),n=t.GetHashing(),i=r.GetNeutrals(n);i||(i=new o);let s=i.Clone();e.GetNeutralsFromVariables(s),s.GetPropertyNumber()>0&&r.AddNeutrals(t,s)}}}},_getMapAssetFromFileList:function(e){let t={};if(e.files)for(let n=0;n<e.files.length;n++){let r=e.files[n];t[r.name]=window.URL.createObjectURL(r)}return t},_filterPIdByTypes:async function(e,t){const n=[],r=[],a=[],i={products:a,materials:n,ambiances:r};for(const i of e){let e=i.readStringArray("physicalIds").concat(i.readStringArray("ambienceIds"),i.readStringArray("experienceIds"));for(let o=0;o<e.length;o++){const s=e[o],c=await p.Get3DSpaceURL(),C=await l.getObjectInfo(s,c);let g=i.name;switch(C&&C.dataelements&&C.dataelements.title&&(g=C.dataelements.title),C.type){case"VPMReference":a.push({productName:g,ID:s}),t.products++;break;case"dsc_decal_ref":case"dsc_matref_ref_Covering":case"dsc_matref_ref_Core":t.materials++,n.push({productName:g,ID:s});break;case"Ambience":case"AmbienceEnvironment":t.ambiences++,r.push({productName:g,ID:s});break;case"HighlightPresentation3DCom":t.presentations++}}}return i},FindPathElementsFromPID:function(e,t,n){t.getLastElement().id===e&&n.push(t);let r=t.getChildrenOccurrencePathes();for(let t=0;t<r.length;t++){let a=r[t];this.FindPathElementsFromPID(e,a,n)}},_convertBlobToArrayBuffer:async function(e){return new UWA.Promise((t,n)=>{let r=new FileReader;r.onload=(()=>{t(r.result)}),r.onerror=n,r.readAsArrayBuffer(e)})},getDocIdInPropertyValuetree:function(e,t){var n=e.GetType();if("VCXPropertyValueHyperLinkId"===n)(r=e.GetValue())>=0&&(t[r]=!0);else if("VCXPropertyValueDocId"===n){var r;(r=e.GetValue())>=0&&(t[r]=!0)}else if(e instanceof s)for(var a=0;a<e._value.length;a++){(i=e._value[a])&&this.getDocIdInPropertyValuetree(i,t)}else if(e instanceof c)for(a=0;a<e._value.length;a++){var i;(i=e._value[a])&&this.getDocIdInPropertyValuetree(i,t)}},removeUselessDocuments:function(){console.log("Cleaning DocManager (removeUselessDocuments)");var e={},t=this._experienceBase,n=t.ComponentsMap.GetComponentTable();for(var r in n)if(n.hasOwnProperty(r)){var a=n[r].QueryInterface("VCXIModifiable");if(a)if(l=a.GetProperties())for(var i in l._map){var o=l._map[i].GetPropertyValue();this.getDocIdInPropertyValuetree(o,e)}}var s=t.getManager("VCXScenarioManager"),c=s._keyframer._Neutrals;for(var p in c._map)if(c._map.hasOwnProperty(p)){var l=c.GetPropertySet(p);for(var g in l._map)if(l._map.hasOwnProperty(g)){o=l.GetProperty(g).GetPropertyValue();this.getDocIdInPropertyValuetree(o,e)}}console.log("docids in tracks");var d=s.GetScenarios();for(var u in d)if(d.hasOwnProperty(u)){var h=d[u],m=[];h.GetListModifiables(m);for(var M=0;M<m.length;M++){p=m[M];var f=h.GetObjectAnimation(p);if(f){var V=[];f.GetListTrackNames(V);for(var _=0;_<V.length;_++){g=V[_];for(var S=f.GetTrack(g)._treekeys,X=new C(S),D=X.next();null!==D;){o=D.GetValue();this.getDocIdInPropertyValuetree(o,e),D=X.next()}}}}}var v=0,I=t.getManager("VCXDocManager"),b=I.GetDefaultImageIndex();-1!=b&&(e[b]=!0),console.log("nbdocs used = "+Object.keys(e).length),console.log(e);var x=I.GetDocMapClone();for(var y in x)x.hasOwnProperty(y)&&(e[y]||(I.RemoveDocument(y),v++));console.log("Nb Docs Removed = "+v)},FindComponentFromPathOfPID:function(e,t){let n=t.QueryInterface("VCXIModelNavigable");if(n){let t,r=e.toString(),a=r.replaceAll(",","|");if(n.traverse((e,n,r)=>{let i=e.GetObject();i._hashPathID&&i._hashPathID.endsWith(a)&&(t=i,r.stop=!0)},null,{}),t)return{fromPID:t};let i=[];return n.traverse(e=>{e.GetObject()._refid===r&&i.push(e.GetObject())}),{fromRefID:i}}}});return m}),define("DS/VCXWebComposer/VCXISensible",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("DS/VCXWebComposer/VCXComponentSGNodeHolder",["DS/WebApplicationBase/W3AASGNodeHolder","DS/Visualization/ThreeJS_DS","DS/Visualization/PathElement"],function(e,t,n){"use strict";return e.extend({getPathElement:function(){if(!this._pathElement){var e=this.GetObject()._experienceBase.getManager("VCXContextManager");if(!(e&&e.isSupported("3DSync")||widget&&widget.enopadViewer))return this._parent();var t=this.GetObject()._experienceBase.getManager("VCXCAT3DXModelManager");this._pathElement=t.QueryInterface("VCXILoadHelper").getPathElement(this),!this._pathElement&&e.isSupported("3DSync")&&console.log("WARNING : NO PATH ELEMENT")}return this._pathElement},setPathOfIDs:function(e){this._parent(e),this.GetObject()._experienceBase.ComponentsMap.addToHashTree(this.GetObject())},isSelfManagedPathElement:function(){var e=this.GetObject()._experienceBase.getManager("VCXContextManager");return!!(e&&e.isSupported("3DSync")||widget&&widget.enopadViewer)}})}),define("DS/VCXWebComposer/VCXUserInputControllerManager",["UWA/Core","DS/Core/Core","DS/Core/PointerEvents","DS/CoreEvents/Events","UWA/Class","DS/VisuEvents/EventsManager","DS/VCXWebVisu/VCXModifiablesAccess","DS/VCXWebModifiablesServices/VCXModifiablesServices","DS/VCXWebKernel/VCXCmdChangeSelection","DS/ApplicationFrame/CommandsManager"],function(e,t,n,r,a,i,o,s,c,p){"use strict";var l=a.extend({init:function(){},initialize:function(){this._lastFocusedElementType=null,this._visuEvents={},this._wuxEvents={},this.dblClickToken=null,this.rightClickToken=null,this.simpleClickToken=null,this.dressupEdition=null,this.deleteFunction=null,this.touchHoldActive=!1},postInitialize:function(){this._ApiCBDoubClick=null;const n=this._experienceBase.getManager("VCXContextManager");this._experienceBase.getManager("VCXContextualContentManager");this._visuEvents.dblClickToken=i.addEvent(n.getMainViewer().div,"onPrimaryPointerDoubleClick",e=>{this._onDblClkCanvasZoomFitEvent(e)}),n&&n.isSupported("VCXCreateOverridesOnDemand")&&(this._visuEvents.rightClickToken=i.addEvent(n.getFrameWindow().elements.container,"onRightClick",async e=>{const n=o.GetPathElementFromEvent(e,this._experienceBase);n&&await o.getModifiableFromPathElement(n,this._experienceBase,!0,!0);await this._experienceBase.getManager("VCXExperience").waitLoops(1),t.Selection.CSOManager.empty(!0),t.Selection.CSOManager.add({pathElement:n})})),this._visuEvents.rightClickContextualToken=i.addEvent(this._experienceBase.getManager("VCXContextManager").getFrameWindow().elements.container,"onRightClick",e=>{this._onClickUpdateFocusEvent(e,"onRightClick")}),this._visuEvents.longTouchContextualToken=i.addEvent(n.getFrameWindow().elements.container,"onHold",e=>{}),this._visuEvents.longTouchContextualToken=i.addEvent(n.getFrameWindow().elements.container,"onLongHold",e=>{this.touchHoldActive=!0,this._onClickUpdateFocusEvent(e,"onRightLongTouch")}),this._visuEvents.simpleClickToken=i.addEvent(this._experienceBase.getManager("VCXContextManager").getFrameWindow().elements.container,"onPrimaryPointerUpUnique",e=>{this.touchHoldActive?this.touchHoldActive=!1:this._onClickUpdateFocusEvent(e,"onLeftClick")}),this._wuxEvents.FinalizeDressupToken=r.subscribe({event:"FinalizeDressup"},()=>{this._lastFocusedElementType="VCXDressup"}),this.onKeyDown=(t=>{switch(e.Event.whichKey(t)){case"ctrl+c":this._runCommand("VCXCopyCmd");break;case"ctrl+v":this._runCommand("VCXPasteCmd");break;case"del":this.dressupEdition||this.deleteFunction(!0);break;case"shift+del":this.dressupEdition||this.deleteFunction(!1)}}),document.addEventListener("keydown",this.onKeyDown)},RegisterDoubleClickCB:function(e){this._ApiCBDoubClick=e},_onDblClkCanvasZoomFitEvent:function(e){if(this._experienceBase.getManager("VCXContextManager").isSupported("PartZoom")&&!this._experienceBase.getManager("VCXContextManager").cmdIsRunning){var t=o.GetPathElementFromEvent(e,this._experienceBase),n=t&&o.GetModifiableFromPathElement(t,this._experienceBase);if(n)if(n.GetObject().IsDressup)return;var r=this._experienceBase.getManager("VCXContextManager").getMainViewer();if(r)if(t&&n){var a=t.getBoundingSphere(r);r.currentViewpoint.reframe(null,750,a),this._ApiCBDoubClick&&this._ApiCBDoubClick(n._object._ID)}else t||(r.currentViewpoint.reframe(null,750),this._ApiCBDoubClick&&this._ApiCBDoubClick(null))}},_onClickUpdateFocusEvent:function(e,t){var n=e.from[0].view.closest(".Content")&&e.from[0].view.closest(".Content").getAttribute("data-type");const a=this._experienceBase.getManager("VCXContextManager").getMainViewer();if("viewer"===n){var i=o.GetPathElementFromEvent(e,this._experienceBase),s=i&&o.GetModifiableFromPathElement(i,this._experienceBase);if(s){var p=s.GetObject().IsDressup,l=s.GetObject().IsMesh;p?this._lastFocusedElementType="VCXDressup":l?this._lastFocusedElementType="VCXProduct":console.warn("undeclared selection type or empty")}else r.publish({event:"VCXActiveCardMATERIAL",data:null});if(t.toLowerCase().includes("long")&&s)return;if(t.toLowerCase().includes("hold")&&!t.toLowerCase().includes("long")&&!s)return;if(t.toLowerCase().includes("right")){const n=e.from[0].getCurrentPosition();let i={};if(n.x&&n.y)i.x=n.x,i.y=n.y;else{const t=a.getMousePosition(e.from[0].getCurrentPosition(a.div));i.x=t.xPix,i.y=t.yPix}const o=this._experienceBase.getManager("VCXSelectionManager"),p=new c(o);let l;this._experienceBase.getManager("VCXSelectionManager").ChangeSelectionForContextual(),(l=o.GetComponentsFromCurrentSelection())&&l.length?p.AddComponentsToSelection(l):s&&(l=[s.GetObject()],p.AddComponentsToSelection(l)),this._experienceBase.getManager("VCXCommandManager").Do(p),r.publish({event:"/VCX/ContextualBar",data:{coordinates:{x:i.x,y:i.y},noRatio:!0,rightClick:t.toLowerCase().includes("hold")?2:t.toLowerCase().includes("long")?3:0}})}}},ZoomFitSelection:function(e){var t=this._experienceBase.getManager("VCXContextManager").getMainViewer();if(t){var n=[];if(e.length>0)for(var r=0;r<e.length;++r){var a=this._experienceBase.ComponentsMap.GetComponentFromID(e[r]);a&&n.push(a)}else n=this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection();if(n&&0<n.length){var i=s.getBBoxInWorldFromComponents(n).getBoundingSphere();t.currentViewpoint.reframe(null,750,i)}else t.currentViewpoint.reframe(null,750)}},unInitialize:function(){for(let e in this._wuxEvents)this._wuxEvents.hasOwnProperty(e)&&r.unsubscribe(this._wuxEvents[e]);for(let e in this._visuEvents)this._visuEvents.hasOwnProperty(e)&&i.removeEventFromToken(this._visuEvents[e]);this._visuEvents=null,this._wuxEvents=null,document.removeEventListener("keydown",this.onKeyDown),this.onKeyDown=null,this._ApiCBDoubClick=null},_runCommand:function(e){var t=this._experienceBase.getManager("VCXContextManager").getFrameWindow()._experienceBase;t.getManager("VCXCommandManager").StartTransaction();var n=t.getManager("VCXContextManager").getContext(),r=p.getCommand(e,n);r&&r.begin(),t.getManager("VCXCommandManager").EndTransaction()}});return Object.defineProperty(l.prototype,"componentType",{enumerable:!0,get:function(){return"VCXUserInputControllerManager"}}),l}),define("DS/VCXWebComposer/VCXBlobDumper",["UWA/Class","DS/VCXWebIO/VCXFileServices"],function(e,t){"use strict";return e.extend({init:function(){this._mapDataB64={}},ConvertBlobsFromDocManager:function(e,t){this._mapDataB64={};var n={},r=e.getManager("VCXDocManager").GetDocMapClone();for(var a in r)if(r.hasOwnProperty(a)){var i=r[a];if(0===i.GetPathType().GetValue())i.GetValueURL().GetValue().indexOf("blob:")>=0&&(n[a]=i)}this.BlobsToB64(n,t)},BlobsToB64:function(e,n){var r=Object.keys(e).length;if(0!==r){var a=this,i=function(e,t){r--,e=e||"",a._mapDataB64[t]=e,0===r&&n()};for(var o in e)if(e.hasOwnProperty(o)){var s=e[o],c=s.GetValueURL().GetValue(),p=s.GetFileName().GetValue();t.BlobURLToBase64(c,p,i,o)}}else n()},GetMapOfData:function(){return this._mapDataB64}})}),define("DS/VCXWebComposer/CATE3DExpVCXObjectConvertorOccurrence",["UWA/Core","DS/CAT3DExpModel/extensions/CATE3DExpVCXObjectConvertor","DS/Visualization/ThreeJS_DS"],function(e,t,n){"use strict";return t.extend({GetNeutralsFromVariables:function(e){var t=[];this.QueryInterface("CATI3DExperienceObject").ListVariables(t);for(var n=0;n<t.length;n++){var r=t[n];this.VariableToNeutralConvertor(r,e)}},UpdateVariablesFromNeutrals:function(e,t){if(e)for(var n in e._map)e._map.hasOwnProperty(n)&&this.NeutralToVariableConvertor(n,e,t)},VariableToNeutralConvertor:function(e,t){var r=this.QueryInterface("CATI3DExperienceObject");if(!r.IsLocalVariable(e)||r.IsComputedVariable(e))return t;var a=null,i="";switch(e){case"opacity":i="Actor.Opacity";var o=r.GetValueByName(e);o&&(a=o/255);break;case"color":i="Actor.Color";var s=r.GetValueByName(e);s&&s._value&&(a=s._value?s._value:s);break;case"_varposition":if(i="Actor.Position",(a=r.GetValueByName(e))&&a.length){let e=(new n.Matrix4).set(a[0],a[3],a[6],a[9],a[1],a[4],a[7],a[10],a[2],a[5],a[8],a[11],0,0,0,1),r=t.GetProperty(i);if(r){r.GetPropertyValue().GetFrame().SetValue(e)}else{let n=this.QueryInterface("VCXIModifiable").GetProperty(i);if(n){(r=n.Clone()).GetPropertyValue().GetFrame().SetValue(e),t.AddOrModifyProperty(r)}}}return;case"_pivot":if(i="Actor.Position",(a=r.GetValueByName(e))&&a.length){let e=(new n.Matrix4).set(a[0],a[3],a[6],a[9],a[1],a[4],a[7],a[10],a[2],a[5],a[8],a[11],0,0,0,1),r=t.GetProperty(i);if(r){r.GetPropertyValue().GetPivot().SetValue(e)}else{let n=this.QueryInterface("VCXIModifiable").GetProperty(i);if(n)(r=n.Clone()).GetPropertyValue().GetPivot().SetValue(e),t.AddOrModifyProperty(r)}}return}if(null!=a){let e=this.QueryInterface("VCXIModifiable").GetProperty(i);if(e){let n=e.Clone();n.GetPropertyValue().SetValue(a),t.AddOrModifyProperty(n)}}},NeutralToVariableConvertor:function(e,t,n){var r=t.GetProperty(e).GetPropertyValue(),a=this.GetObject();switch(e){case"Actor.Position":var i=r.GetFrame().GetValue().elements,o=r.GetPivot().GetValue().elements,s=[i[0],i[1],i[2],i[4],i[5],i[6],i[8],i[9],i[10],i[12],i[13],i[14]],c=[o[0],o[1],o[2],o[4],o[5],o[6],o[8],o[9],o[10],o[12],o[13],o[14]];n.push({object:a,variableName:"_varposition",variableValues:s}),n.push({object:a,variableName:"_pivot",variableValues:c}),t.RemoveProperty(e)}}})}),define("DS/VCXWebComposer/VCXExperienceLoader",["UWA/Utils","DS/CoreEvents/Events","DS/VCXWebExperienceLoader/VCXExperienceLoaderBase","DS/VCXWebKernelCommands/VCXCmdChangeSequence","DS/VCXWebIO/VCXFileServices","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties","DS/VCXWebKernelCommands/VCXCmdGoToScenario"],function(e,t,n,r,a,i,o){"use strict";return n.extend({InitLoader:function(e){this._parent(e.experienceBase),this._options=e},Load:function(e){if(e){this.InitLoader(e);var n=this._experienceBase.getManager("VCXContextManager");n.setSupported("3DSync",!1),n.setSupported("UseTraverseGraph",!1),n.useTraverseGraph=!1,n.setSupported("Cat3DXIntegration",!1),n._rootInfos={componentType:"VCXComponentOccurrenceComposer",productType:"Reference3D",name:"Experience",id:"VCX_Root"};n.getRootComponent();if(this._experienceBase.getManager("VCXGUIManager").InitGUI(),t.subscribe({event:"VCX_ASSET_LOADED"},t=>{e=null,this.on3dxmlLoaded(this,t)}),this._experienceBase._mapAssetsBlob=e.mapAssets,e.jsonFile)this.LoadJSON(()=>{var t=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentAssetOccurrenceComposer");this._numOfAsset=t.length,this._experienceBase.getManager("VCXScenarioManager").RestoreNeutralProperties();var n=this._experienceBase.getManager("VCXContextManager");n.getProdHighMode()&&n.getCat3DXIntegration()?this.EndLoadJSON(e.endCB):e.endCB("json")});else if(this._arrayAssets=[],e.urb?this._bIsCityLoading=!0:this._bIsCADLoading=!0,e.mapAssets){var r=e.mapAssets;for(var a in this._numOfAsset=Object.keys(r).length,r)if(r.hasOwnProperty(a)){var i=this.CreateAsset(a);this._arrayAssets.push(i);var o=i.QueryInterface("VCXIModifiable");o&&this._experienceBase.getManager("VCXScenarioManager").RestoreNeutralPropertiesOneModifiable(o.GetHashing())}this._experienceBase.getManager("VCXScenarioManager").UpdateProperties()}}else console.error("Have to use iOptions")},CreateAsset:function(t){var n="VCXComponentAssetOccurrenceComposer",r=0,a=t.split(".")[1];"3dxml"===a||("smggeom"===a.toLowerCase()?r=1:"urb"!==a.toLowerCase()&&"ctxp"!==a.toLowerCase()||(r=2,n="CIDComponentAsset"));var o=this._experienceBase.Factory.BuildComponent(n);if(o){this._experienceBase.ComponentsMap.AddComponent(o),o.SetAssetID(t);var s=t.split(".")[0]+"-"+e.getUUID().substr(0,18);o.SetNodeID(s),o.SetAssetType(r);var c=this._experienceBase.getManager("VCXContextManager").getRootComponent().QueryInterface("VCXIModelNavigable");o.QueryInterface("VCXIModelNavigable").setParent(c);var p=o.QueryInterface("VCXIModifiable"),l=new i(this._experienceBase.getManager("VCXScenarioManager"));return l.CaptureNeutralProperties(p),l.Do(),o}console.error("Can't create component")},BuildComponentsFromAssets:function(e){for(let t=0;t<e.length;t++){var n=e[t],r=n.QueryInterface("W3AISGNodeHolder"),a=r.getSGNode(),o=r.getPathElement(),s=n.QueryInterface("VCXIModelNavigable"),c={attributeToUse:"productType",componentTypeForRootNode:"VCXComponentOccurrenceComposer",Instance3D:"VCXComponentOccurrenceComposer",Reference3D:null,InstanceRep:"VCXComponentMesh",defaultType:null,componentTypeFromFunction:function(e){if(!e)return null;var t=null;switch(e.productType){case"Instance3D":var n=e.getChildren();if(!n||!n.length)return null;for(let e=0;e<n.length;e++)if("InstanceRep"===n[e].productType)return"VCXComponentMesh";if(n[0]&&n[0].children&&n[0].children[0]&&"InstanceRep"===n[0].children[0].productType)return"VCXComponentMesh";t="VCXComponentOccurrenceComposer";break;default:console.log("Unknown DS type")}return t}};this._experienceBase.BuildComponentsFromNodeEXT(a,o,s,c)}for(var p=new i(this._experienceBase.getManager("VCXScenarioManager")),l=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceComposer"),C=0;C<l.length;C++){var g=l[C];if(g){var d=g.QueryInterface("VCXIModifiable");d&&p.ChangeProperty(d,"Actor.Name",d.GetProperty("Actor.Name").GetPropertyValue())}}this._experienceBase.getManager("VCXCommandManager").Do(p),t.publish({event:"VCX_ASSETS_ADDED",data:e})},on3dxmlLoaded:function(e,n){if(e._experienceBase.getManager("VCXPaperManager").updatePaper({x:1896,y:798}),e._numOfAsset--,0===e._numOfAsset){if(delete this._experienceBase._mapAssetsBlob,e._bIsCADLoading){if(e.BuildComponentsFromAssets(e._arrayAssets),0===e._experienceBase.ComponentsMap.GetComponentFromType("CXPCameraActor_Spec").length){var a=e._experienceBase.Factory.BuildComponent("CXPCameraActor_Spec");a.SetID("CameraActorId"),e._experienceBase.ComponentsMap.AddComponent(a)}if(0===e._experienceBase.ComponentsMap.GetComponentFromType("VCXViewport_Spec").length){var o=e._experienceBase.Factory.BuildComponent("VCXViewport_Spec");o.SetID("ViewportActorId"),e._experienceBase.ComponentsMap.AddComponent(o)}if(0===e._experienceBase.ComponentsMap.GetComponentFromType("VCXPartList_Spec").length&&e._experienceBase.getManager("VCXContextManager").isSupported("PartList")){var s=e._experienceBase.Factory.BuildComponent("VCXPartList_Spec");s.SetID("PartListID"),s.SetPersistency(1),e._experienceBase.ComponentsMap.AddComponent(s)}if(0===e._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentGround").length){var c=e._experienceBase.Factory.BuildComponent("VCXComponentGround");c&&(c.SetID("GroundActorId"),e._experienceBase.ComponentsMap.AddComponent(c))}if(0===e._experienceBase.getManager("VCXSequenceManager").GetListSequencesFromType(0).length){var p=e._experienceBase.Factory.BuildComponent("VCXScenarioSequence");p.SetName("Sequence 1");var l=p.QueryInterface("VCXIModifiable"),C=new i(e._experienceBase.getManager("VCXScenarioManager"));C.CaptureNeutralProperties(l),e._experienceBase.getManager("VCXCommandManager").Do(C);var g=new r(e._experienceBase.getManager("VCXSequenceManager"),e._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap);g.PushSequence(p),e._experienceBase.getManager("VCXCommandManager").Do(g)}e._experienceBase.getManager("VCXExperience").EndLoadingDressups(),e._experienceBase.getManager("VCXGUIManager").RefreshGUI(),e._experienceBase.getManager("VCXGUIManager").setUpTrees(),t.publish({event:"VCX_END_LOADING_DONE"})}else{for(var d=e._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceComposer"),u=0;u<d.length;u++){var h=d[u];h&&h.SetIsMesh(!0)}e.EndLoadJSON()}var m=e._options.endCB;void 0!==m&&m("3dxml")}e._options=null,e._experienceBase=null,e._factory=null,e._scenarioManager=null,e._ComponentsMap=null,e._arrayAssets=null},LoadJSON:function(e){var t=new FileReader;t.onload=(()=>{this.filevarJson=JSON.parse(t.result);var n=this._experienceBase.getManager("VCXScenarioManager");n.SetCurrentFrame(0),n.SetDefaultInterpolator("Actor.Hyperlink",0),n.SetDefaultInterpolator("Collab.Image.Doc.ID",0),this.LoadComponents(this.filevarJson.VCXObjects).then(()=>{this.LoadVCXIModelNavigable(this.filevarJson.VCXIModelNavigable),this.LoadMetaPropertiesDef(this.filevarJson.MetaPropertiesDef),this.LoadPropertiesLinks(this.filevarJson.PropertiesLinks),this.LoadNeutrals(this.filevarJson.neutrals),this.ResolveProductAssetsHolder(this.filevarJson.VCXAssetsHolder,e)})}),t.readAsText(this._options.jsonFile)},LoadComponents:function(e,t){var n=[];if(this._experienceBase.getManager("VCXContextManager").getCat3DXIntegration()){if(e)for(var r=0;r<e.length;r++){var a=e[r].objectID,i=e[r].objectType,o=this._factory.BuildComponent(i);if(o){o.SetID(a),this._ComponentsMap.AddComponent(o);var s=e[r].objectData;s&&o.SetLoadData(s)}else n.push({objectType:i,objectID:a})}return this.BuilComponentsAsync(n)}return this._parent(e),UWA.Promise.resolve()},BuilComponentsAsync:function(e){for(var t=this._experienceBase.getManager("VCXCAT3DXModelManager").GetCAT3DXModel(),n=[],r=0;r<e.length;r++){var a=e[r],i=a.objectType,o=a.objectID;n.push(t.getFactory().BuildComponent(i,o))}return UWA.Promise.all(n)},ResolveProductAssetsHolder:function(e,t){var n=[];if(e){this._experienceBase.getManager("VCXContextManager").getRootNode();for(var r=0;r<e.length;r++){var a=e[r].objectID,i=this._reformatObjectIDForPathOfId(a),o=this._ComponentsMap.GetComponentFromID(i);if(o&&(o.IsKindOf("Model_VPMReference_Spec")||o.IsKindOf("VCXComponentVPMReference"))){o.QueryInterface("W3AISGNodeHolder").getSGNode();var s=e[r].linkDescription;o.QueryInterface("CATI3DXAssetHolder").setLinkDescription(s),s&&n.push(this._experienceBase.getManager("VCXCAT3DXModelManager").LoadProduct(o))}}}UWA.Promise.all(n).then(()=>{t&&t()})},ResolveCityExternalAssetsHolder:function(e,t){if(e)for(var n=0;n<e.length;n++){var r=e[n].objectID,a=this._reformatObjectIDForPathOfId(r),i=this._ComponentsMap.GetComponentFromID(a);if(i)if(i.IsKindOf("CIDAsset_Spec"))if(this._experienceBase.getManager("CityUrbanManager")){var o=i.QueryInterface("CATI3DXAssetHolder"),s=e[n].linkDescription;o.setLinkDescription(s),i.SetAssetID(s);var c=e[n].linkContextDescription;if(c){var p=this._experienceBase.getManager("CAT3DXLinkManager").getLinkContextFromJSONDescription(c);o.setLinkContext(p),o.resolveAsset().then(e=>{e&&this._experienceBase.getManager("CityUrbanManager").LoadModel(e,()=>{this.LoadVCXAssetsHolder(this.filevarJson.VCXAssetsHolder).then(()=>{t&&t()}),this._experienceBase.getManager("VCXGUIManager").getGettingStartedUI().endLoadingExperience()})})}}}},LoadVCXAssetsHolder:function(e){if(!this._experienceBase.getManager("VCXContextManager").getCat3DXIntegration())return UWA.Promise.resolve();if(e){var t=[];for(var n in e)if(e.hasOwnProperty(n)){var r=e[n].objectID,a=this._reformatObjectIDForPathOfId(r),i=this._ComponentsMap.GetComponentFromID(a);if(i){var o=i.QueryInterface("CATI3DXAssetHolder");if(o){var s=e[n].linkDescription;s&&(o.setLinkDescription(s),t.push(o.resolveAsset()))}}}return UWA.Promise.all(t)}},EndLoadJSON:function(e){this._experienceBase.getManager("VCXContextManager").getMainViewer().getRootNode();if(this.LoadW3AISGNodeHolder(this.filevarJson.W3AISGNodeHolder),this.LoadScenarios(this.filevarJson.listScenarios),this.filevarJson.DocManager){var n=this.filevarJson.DocManager.array;if(n&&0!==n.length)for(var r=0;r<n.length;r++){var i=n[r],s=i.type,c=i.value,p=i.docID,l=this.BuildVCXPropertyValue(s,c);null!==l&&this._experienceBase.getManager("VCXDocManager").AddOrModifyDoc(l,void 0,p,!1)}}var C=this.filevarJson.EmbeddedData;if(C&&0!==C.length)for(var g in C)if(C.hasOwnProperty(g)){var d=this._experienceBase.getManager("VCXDocManager").GetPropPath(g);if(d){var u=C[g];if(""!==u){var h=a.dataURLToBlob(u),m=window.URL.createObjectURL(h);console.log(g+":"+m),d.GetValueURL().SetValue(m)}}else console.log("unable to get propPath of "+g)}var M=this.filevarJson.ScenarioSequences;this.LoadScenarioSequences(M);var f=this._experienceBase.getManager("VCXContextManager");if(f.getProdHighMode()&&f.getCat3DXIntegration())this._experienceBase.getManager("VCXCAT3DXModelManager").OnEndLoading(!1).then(()=>{e()});else{if(0===this._experienceBase.ComponentsMap.GetComponentFromType("CXPCameraActor_Spec").length){var V=this._experienceBase.Factory.BuildComponent("CXPCameraActor_Spec");V.SetID("CameraActorId"),this._experienceBase.ComponentsMap.AddComponent(V)}if(0===this._experienceBase.ComponentsMap.GetComponentFromType("VCXViewport_Spec").length){var _=this._experienceBase.Factory.BuildComponent("VCXViewport_Spec");_.SetID("ViewportActorId"),this._experienceBase.ComponentsMap.AddComponent(_)}if(0===this._experienceBase.ComponentsMap.GetComponentFromType("VCXPartList_Spec").length&&this._experienceBase.getManager("VCXContextManager").isSupported("PartList")){var S=this._experienceBase.Factory.BuildComponent("VCXPartList_Spec");S.SetID("PartListID"),S.SetPersistency(1),this._experienceBase.ComponentsMap.AddComponent(S)}if(0===this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentGround").length){var X=this._experienceBase.Factory.BuildComponent("VCXComponentGround");X&&(X.SetID("GroundActorId"),this._experienceBase.ComponentsMap.AddComponent(X))}this._experienceBase.getManager("VCXExperience").EndLoadingDressups(),this._experienceBase.getManager("VCXGUIManager").RefreshGUI(),this._experienceBase.getManager("VCXGUIManager").setUpTrees();var D;D=(M=this._experienceBase.getManager("VCXSequenceManager").GetListSequences())[0].GetListScenariosId()[0];var v=new o(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.getManager("VCXCommandManager"));v.GoToScenario(D),this._experienceBase.getManager("VCXCommandManager").Do(v),this._experienceBase.getManager("VCXScenarioManager").SetAutoKey(!0),t.publish({event:"VCX_END_LOADING_DONE"})}}})}),define("DS/VCXWebComposer/Model_VPMReference_Spec",["require","exports","DS/VCXWeb3DMaster/VCXComponentOccurrenceComposer"],function(e,t,n){"use strict";class r extends n{}return Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"Model_VPMReference_Spec"}}),r}),define("DS/VCXWebComposer/VCXILoadHelper",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("DS/VCXWebComposer/CATE3DExperienceObjectNavigable",["UWA/Core","DS/CAT3DExpModel/extensions/CATE3DExperienceObject","DS/CAT3DExpModel/interfaces/CATI3DExperienceObject"],function(e,t,n){"use strict";return t.extend({_dispatchVariableEvent:function(e,t){this._parent(e,t)},_SetChildrenNavigable:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this._SetNavigable(e[t]);else e&&e.QueryInterface&&this._SetNavigable(e)},_SetNavigable:function(e){var t=this.QueryInterface("VCXIModelNavigable"),n=e.QueryInterface("VCXIModelNavigable");n&&!n.isSelfOrganized()&&n.getParent()!==t&&n.setParent(this.QueryInterface("VCXIModelNavigable"))}})}),define("DS/VCXWebComposer/VCXASensible",["UWA/Class"],function(e){"use strict";return e.extend({init:function(){},_getMeshesFromPathElement:function(e){var t=e.getLastElement(!0),n=[];if(t.excludeFromCSO)n.push(t);else{t.traverse(e=>(e.excludeFromCSO&&n.push(e),!1),!1)}return n},_setOrGetXSOAble:function(e,t,n){if("boolean"==typeof e)if("CSO"===t||"HSO"===t||"PSO"===t)if(e&&"boolean"!=typeof n)console.warn("A boolean is required as third argument for this method when first is defined as 'set'.");else{var r=this.GetObject().QueryInterface("W3AISGNodeHolder");if(r){for(var a=r.getPathElement(),i=this._getMeshesFromPathElement(a),o=null,s=0;s<i.length;++s){var c=i[s];if(e)"CSO"===t?c.excludeFromCSO(!n):"HSO"===t?c.excludeFromHSO(!n):c.excludeFromPSO(!n);else{var p=!("CSO"===t?c._excludeFromCSO:"HSO"===t?c._excludeFromHSO:c._excludeFromPSO);if(null===(o="boolean"!=typeof o?p:o===p?o:null))break}}return e?void 0:o}console.warn("Object do not possess a nodeHolder interface")}else console.log("Second argument should be one of the following : CSO | HSO | PSO");else console.log("First argument should be a boolean")},_setXSOAble:function(e,t){this._setOrGetXSOAble(!0,e,t)},_getXSOAble:function(e){return this._setOrGetXSOAble(!1,e)},setSelectable:function(e){this._setXSOAble("CSO",e)},setHighlightable:function(e){this._setXSOAble("HSO",e)},setPreHighlightable:function(e){this._setXSOAble("PSO",e)},getSelectable:function(){return this._getXSOAble("CSO")},getHighlightable:function(){return this._getXSOAble("HSO")},getPreHighlightable:function(){return this._getXSOAble("PSO")}})}),define("DS/VCXWebComposer/VCXALoadHelper",["require","exports"],function(e,t){"use strict";return class{GetType(){return"VCXALoadHelper"}getPathElement(e){return null}async _AddProductAndUpdate(e,t){var n=e.QueryInterface("W3AISGNodeHolder");await n.buildSGNode()}async _LoadMaterial(e){}}}),define("DS/VCXWebComposer/VCXWebDictionary",[],function(){"use strict";var e={VCXCAT3DXModelManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager",VCXILoadHelper:"DS/VCXWebComposer/VCXALoadHelper"},VCXExperience:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXActorDocManager:{VCXIModifiable:"DS/VCXWebKernel/VCXModifiableActorDocManager"},VCXComponentAssetOccurrenceComposer:{VCXIModifiable:"DS/VCXWeb3DMaster/VCXModifiableAssetOccurrenceComposer",VCXIModifiableView:"DS/VCXWeb3DMaster/VCXModifiableViewOccurrenceComposer",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeOccurrence",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXPulseBehaviorOccurrence",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXIVisibility:"DS/VCXWebVisibilityImpl/VCXVisibilityOccurrence",VCXIModelNavigable:"DS/VCXWeb3DMaster/VCXNavigableAssetOccurrenceComposer",W3AISGNodeHolder:"DS/VCXWeb3DMaster/VCXSGNodeHolderAssetOccurrenceComposer"},VCXComponentOccurrenceComposer:{VCXIModifiable:"DS/VCXWeb3DMaster/VCXModifiableOccurrenceComposer",VCXIPrepareRenderToTexture:"DS/VCXWebVisualization/VCXOccurrenceComposerPrepareRenderToTexture",VCXIModifiableView:"DS/VCXWeb3DMaster/VCXModifiableViewOccurrenceComposer",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeOccurrence",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXPulseBehaviorOccurrence",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXIVisibility:"DS/VCXWebVisibilityImpl/VCXVisibilityOccurrence",W3AISGNodeHolder:"DS/WebApplicationBase/W3AASGNodeHolder",VCXIModelNavigable:"DS/WebApplicationBase/VCXAModelNavigable",VCXIReadiness:"DS/WebApplicationBase/VCXAReadiness"},VCXComponentMarker:{VCXIModifiable:"DS/VCXWebKernel/VCXModifiableMarker",VCXIModifiableView:"DS/VCXWebModifiables/VCXModifiableView"},VCXComponentHotspot:{VCXIModifiable:"DS/VCXWebKernel/VCXModifiableHotspot",VCXIModifiableView:"DS/VCXWebKernel/VCXModifiableViewActorList",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeOccurrence",VCXIModelNavigable:"DS/VCXWebKernel/VCXModelNavigableActorList"},VCXSelectionSet_Spec:{VCXIModifiable:"DS/VCXWebKernel/VCXModifiableSelectionSet",VCXIModifiableView:"DS/VCXWebKernel/VCXModifiableViewActorList",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeSelectionSet",VCXIModelNavigable:"DS/VCXWebKernel/VCXModelNavigableActorList",VCXISelectBehavior:"DS/VCXWebComposer/VCXASelectBehavior"},VCXGroupSelectionSet_Spec:{VCXIModifiable:"DS/VCXWebKernel/VCXModifiableSelectionSet",VCXIModifiableView:"DS/VCXWebKernel/VCXModifiableViewActorList",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeGroupSelectionSet",VCXIModelNavigable:"DS/VCXWebKernel/VCXModelNavigableActorList",VCXISelectBehavior:"DS/VCXWebComposer/VCXASelectBehavior"},VCXComponentGroupHotspot:{VCXIModifiable:"DS/VCXWebKernel/VCXModifiableGroupActorList",VCXIModifiableView:"DS/VCXWebKernel/VCXModifiableViewActorList",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeOccurrence",VCXIModelNavigable:"DS/VCXWebKernel/VCXModelNavigableActorList",VCXISelectBehavior:"DS/VCXWebComposer/VCXASelectBehavior"},VCXImageManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXGUIManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager",VCXIModifiable:"DS/VCXWebGUI/VCXModifiableGUIManager",VCXIReadiness:"DS/WebApplicationBase/VCXAReadiness"},VCXNotificationManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXSelectionManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager",VCXIModifiable:"DS/VCXWebKernel/VCXModifiableSelectionManager"},VCXSelectManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXWebSelectionManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXMultiUserInputManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXMaterialManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXPaperManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXManipulatorManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXHyperlinkManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXStylesManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager",VCXIModifiableView:"DS/VCXWebModifiables/VCXModifiableView",VCXIModifiable:"DS/VCXWebStyles/VCXModifiableStylesManager"},VCXComponentStyle:{VCXIModifiable:"DS/VCXWebStyles/VCXModifiableStyle",VCXIModifiableView:"DS/VCXWebModifiables/VCXModifiableView",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeStyle"},VCXVisuManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager",VCXIReadiness:"DS/WebApplicationBase/VCXAReadiness"},VCXDragDropManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXRobotAdapter:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXVolatileGhostingManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXNLSManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXPulseManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXAPIManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXMarkerManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXHotspotManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXSelectionSetManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXDRMManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager",VCXIModifiable:"DS/VCXWebKernel/VCXModifiableDRMManager",VCXIModifiableView:"DS/VCXWebModifiables/VCXModifiableView"},VCXAnalyticsTrackerAppManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXComposerAPIManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXUserInputControllerManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"}},t={W3AIManager:"DS/WebApplicationBase/W3AIManager",VCXITreeNode:"DS/VCXWebTreeGUI/VCXITreeNode",VCXISensible:"DS/VCXWebComposer/VCXISensible",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXIPulseBehavior",VCXIVisibility:"DS/VCXWebVisibility/VCXIVisibility",VCXIViewpointController:"DS/VCXWebVisualization/VCXIViewpointController",VCXISelectBehavior:"DS/VCXWebComposer/VCXISelectBehavior",VCXIContextualContent:"DS/VCXWebKernel/VCXIContextualContent",VCXIModifiableFormatPainter:"DS/VCXWebModifiables/VCXIModifiableFormatPainter",VCXIReadiness:"DS/WebApplicationBase/VCXIReadiness",VCXILoadHelper:"DS/VCXWebComposer/VCXILoadHelper",VCXICuttableObject:"DS/VCXWebKernel/VCXICuttableObject"},n={VCXActorDocManager:"DS/VCXWebKernel/VCXActorDocManager",VCXVolatileComponentOccurrenceComposer:"DS/VCXWeb3DMaster/VCXVolatileComponentOccurrenceComposer",VCXComponentOccurrenceComposer:"DS/VCXWeb3DMaster/VCXComponentOccurrenceComposer",VCXComponentAssetOccurrenceComposer:"DS/VCXWeb3DMaster/VCXComponentAssetOccurrenceComposer",VCXComponentMarker:"DS/VCXWebKernel/VCXComponentMarker",VCXComponentHotspot:"DS/VCXWebKernel/VCXComponentHotspot",VCXSelectionSet_Spec:"DS/VCXWebKernel/VCXSelectionSet_Spec",VCXComponentSelectionSet:"DS/VCXWebKernel/VCXSelectionSet_Spec",VCXComponentGroupHotspot:"DS/VCXWebKernel/VCXComponentGroupHotspot",VCXGroupSelectionSet_Spec:"DS/VCXWebKernel/VCXGroupSelectionSet_Spec",VCXComponentGroupSelectionSet:"DS/VCXWebKernel/VCXGroupSelectionSet_Spec",VCXExperience:"DS/VCXWebComposer/VCXExperience",VCXImageManager:"DS/VCXWebVisualization/VCXImageManager",VCXPaperManager:"DS/VCXWebVisualization/VCXPaperManager",VCXManipulatorManager:"DS/VCXWebVisualization/VCXManipulatorManager",VCXHyperlinkManager:"DS/VCXWebComposer/VCXHyperlinkManager",VCXHyperlinkManagerBase:"DS/VCXWebExperienceBase/VCXHyperlinkManagerBase",VCXStylesManager:"DS/VCXWebStyles/VCXStylesManager",VCXComponentStyle:"DS/VCXWebStyles/VCXComponentStyle",VCXSelectionManager:"DS/VCXWebKernel/VCXSelectionManager",VCXSelectManager:"DS/VCXWebKernel/VCXSelectManager",VCXWebSelectionManager:"DS/VCXWebKernel/VCXWebSelectionManager",VCXMultiUserInputManager:"DS/VCXWebKernel/VCXMultiUserInputManager",VCXMaterialManager:"DS/VCXWebVisualization/VCXMaterialManager",VCXAnalyticsTrackerAppManager:"DS/VCXWebKernelTools/VCXAnalyticsTrackerAppManager",VCXVisuManager:"DS/VCXWebVisualization/VCXVisuManager",VCXDragDropManager:"DS/VCXWebComposer/VCXDragDropManager",VCXRobotAdapter:"DS/VCXWebVisualization/VCXRobotAdapter",VCXVolatileGhostingManager:"DS/VCXWebVolatileGhosting/VCXVolatileGhostingManager",VCXNLSManager:"DS/VCXWebExperienceBase/VCXNLSManager",VCXPulseManager:"DS/VCXWebPulseManager/VCXPulseManager",VCXHotspotManager:"DS/VCXWebComposer/VCXHotspotManager",VCXSelectionSetManager:"DS/VCXWebComposer/VCXSelectionSetManager",VCXAPIManager:"DS/VCXWebKernel/VCXAPIManager",VCXDRMManager:"DS/VCXWebKernel/VCXDRMManager",VCXNotificationManager:"DS/VCXWebKernel/VCXNotificationManager",VCXMarkerManager:"DS/VCXWebKernel/VCXMarkerManager",VCXComposerAPIManager:"DS/VCXWebKernel/VCXComposerAPIManager",VCXUserInputControllerManager:"DS/VCXWebComposer/VCXUserInputControllerManager",VCXGUIManager:"DS/VCXWebGUI/VCXGUIManager",VCXCAT3DXModelManager:"DS/VCXWebComposer/VCXCAT3DXModelManager"},r=["VCXWebVolatileGhosting/VCXWebVolatileGhosting","VCXWebScenarioManager/VCXWebScenarioManager","VCXWebProducts/VCXWebProducts"];return{GetDictionary:function(){return{interfaces:t,components:n,extensions:e}},getNLSModules:function(){return r}}}),define("DS/VCXWebComposer/VCXASelectBehavior",["UWA/Class"],function(e){"use strict";return e.extend({init:function(){this._selectMode=0},GetSelectMode:function(){return this._selectMode},SetSelectMode:function(e){this._selectMode=e},GetListForSelection:function(){var e=[],t=this.GetObject();if(0===this._selectMode)e.push(t);else if(null!==this._selectMode&&void 0!==this._selectMode){var n=t.QueryInterface("VCXIModelNavigable");if(n)for(var r=n.getChildren(),a=0;a<r.length;a++){var i=r[a];if(i){var o=i.GetObject();e.push(o)}}1===this._selectMode||2===this._selectMode&&e.push(t)}return e}})}),define("DS/VCXWebComposer/VCXWebActorListManager",["DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebProperties/VCXPropertyValueLink","UWA/Class"],function(e,t,n){"use strict";var r=n.extend({initialize:function(){},postInitialize:function(){},unInitialize:function(){},disposeComponentsActorListFromType:function(e){for(var t=this._experienceBase.ComponentsMap.GetComponentFromType(e),n=0;n<t.length;++n){var r=t[n];r&&r.CallDispose()}},associateComponentAndActorListToMapCache:function(e,t){var n=e.GetID(),r=this.getComponentsActorListMapCache();if(r){r[n]||(r[n]={});var a=t.GetID();r[n][a]||(r[n][a]=t)}},dissociateComponentAndActorListFromMapCache:function(e,t){var n=e.GetID(),r=this.getComponentsActorListMapCache();if(r&&r[n])if(t){var a=t.GetID();r[n][a]&&(delete r[n][a],0===Object.keys(r[n]).length&&delete r[n])}else delete r[n]},addActorsListToComponentActorList:function(n,r){for(var a="",i=(r.GetID(),r.QueryInterface("VCXIModifiable")),o=i.GetProperty("Actor.ListActors"),s=o.GetPropertyValue().GetValue(),c=[],p=0;p<s.length;++p){var l=s[p];c.push(l.Value)}for(var C=[],g=0;g<n.length;++g){a=n[g].GetID();c.indexOf(a)<0&&C.push(a)}if(C.length>0){for(var d=0;d<C.length;++d){a=C[d];var u=new t;u.SetValue(a),s.push(u),this.associateComponentAndActorListToMapCache(a,hotspotID)}var h=o.Clone();h.GetPropertyValue().SetValue(s);var m=this._experienceBase.getManager("VCXScenarioManager"),M=this._experienceBase.getManager("VCXCommandManager"),f=new e(m,M);return f.ChangeProperty(i,h),M.Push(f),!0}return!1},removeActorsListFromComponentActorList:function(t,n){n.GetID();for(var r=n.QueryInterface("VCXIModifiable"),a=r.GetProperty("Actor.ListActors"),i=a.GetPropertyValue().GetValue(),o=[],s=0;s<i.length;++s){var c=i[s];o.push(c.Value)}for(var p=0,l=0;l<t.length;++l){var C=t[l],g=C.GetID(),d=o.indexOf(g);-1!==d&&(i[d]=null,this.dissociateComponentAndActorListFromMapCache(C,n),++p)}if(p>0){var u=i.filter(function(e){return null!==e}),h=a.Clone();h.GetPropertyValue().SetValue(u);var m=this._experienceBase.getManager("VCXScenarioManager"),M=this._experienceBase.getManager("VCXCommandManager"),f=new e(m,M);return f.ChangeProperty(r,h),M.Push(f),!0}return!1},removeActorsListFromAllComponentsActorListOfAKind:function(e,t){for(var n=[],r=(this.getComponentsActorListMapCache(),this._experienceBase.ComponentsMap.GetComponentFromType(t)),a=0;a<r.length;++a){var i=r[a];this.removeActorsListFromComponentActorList(e,i)&&n.push(i)}return n},isComponentBelongingToMapCache:function(e){var t=this.getComponentsActorListMapCache();if(t)return!!t[e.GetID()]},getListOfComponentActorListOwningComponent:function(e){var t=[],n=this.getComponentsActorListMapCache();if(n){var r=e.GetID();if(n[r])for(var a=Object.keys(n[r]);0<a;++a){var i=a[0];n[r][i]&&t.push(n[r][i])}return t}}});return Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXWebActorListManager"}}),r}),define("DS/VCXWebComposer/VCXUIHyperlink",["UWA/Class","DS/VisuEvents/EventsManager","UWA/Controls/Lightbox","DS/UIBehaviors/ContextualMenuManager","DS/VCXWebIO/VCXFileWriter","DS/VCXWebVisu/VCXModifiablesAccess","DS/VCXWebModifiablesServices/VCXModifiablesServices","DS/VCXWebIO/VCXFileServices"],function(e,t,n,r,a,i,o,s){"use strict";return e.extend({init:function(e){this._experienceBase=e,this._vcxGuiManager=e.getManager("VCXGUIManager"),this._cursorStyle=document.body.style.cursor,this.onVisuEventMouse=this.onVisuEvent.bind(this)},setActive:function(e){this.UnsubscribeEvent(),e&&this.SubscribeEvent()},onVisuEvent:function(e){var t=this._experienceBase.getManager("VCXHyperlinkManager");if(t&&t.GetActiveInteraction()){for(var n=!1,r=t.GetSortedInteractableObjects(),a=0;a<r.length;a++){var s=this._experienceBase.ComponentsMap.GetComponentFromID(r[a]).QueryInterface("VCXIModifiable"),c=o.getDisplayPriority(s);if(c<-7)break;if(c<=6||c>=10){n=!0;break}if(o.isModifiableUnderMouse(s,e))return void this.onChangeMouseStyle(s)}if(n)if(s=i.GetModifiableFromEvent(e,this._experienceBase))return void this.onChangeMouseStyle(s)}this.onChangeMouseStyle(null)},SubscribeEvent:function(){var e=this._experienceBase.getManager("VCXContextManager").getMainViewer().div;t.addEvent(e,"onPrimaryPointerMoveUnique",this.onVisuEventMouse)},UnsubscribeEvent:function(){t.removeEvent(this._experienceBase.getManager("VCXContextManager").getMainViewer().div,"onPrimaryPointerMoveUnique",this.onVisuEventMouse)},onChangeMouseStyle:function(e){var t=!1;if(e){var n=null,r=e.GetObject().GetID(),a=null;if(this._experienceBase.getManager("VCXHotspotManager")&&(a=this._experienceBase.getManager("VCXHotspotManager").GetEnabledHotspotFromComponentID(r,!0)),a){n=a.QueryInterface("VCXIModifiable").GetProperty("Actor.Hyperlink").GetPropertyValue().GetValue()}else{var i=e.GetProperty("Actor.Hyperlink").GetPropertyValue().GetValue();n=parseInt(i,10)}n>=0&&(t=!0)}let o=this._vcxGuiManager.GetCursor();t?""===o&&this._vcxGuiManager.SetCursor("pointer"):""!==o&&this._vcxGuiManager.SetCursor("")},CreateMediaDiv:function(e,t){var n=this;s.BlobURLToBase64(e,t,function(r){r.indexOf("data:image")>-1?n.OpenImage(e,t):r.indexOf("data:application/octet-stream")>-1?(new a).saveAs(r,t):window.open(e,"Download")})},OpenImage:function(e,t){var n=this;s.getImageSizeFromBlobUrl(e,function(a){var i=n.CreateDiv(e,t,a);i.styles.width=a.width,i.styles.height=a.height,n._myMedia=UWA.createElement("img",{id:i.id,title:i.title,src:i.src,styles:i.styles}),r.onReady({target:n._myMedia,nodes:i.nodes}),n._myMedia.addEventListener("click",function(e){e.stopPropagation&&e.stopPropagation()}),n._lightbox.addContent(n._myMedia)})},CreateDiv:function(e,t,r){var a=this._vcxGuiManager._uiLayer;this._lightbox=new n,this._lightbox.inject(a),this._lightbox.getInnerElement().style.zIndex="15",this._lightbox.open();var i=this;return{id:"myMedia",title:"Click right to save",src:e,styles:{position:"absolute",left:"50%",bottom:"50%",color:"#888888",width:r.width+"px",height:r.height+"px",marginLeft:-.5*r.width+"px",marginBottom:-.5*r.height+"px",zIndex:"15"},nodes:[{label:"Save  as...",callback:function(){i.LaunchContextMenu(0,e,t)}},{label:"Open  in new tab...",callback:function(){i.LaunchContextMenu(1,e,t)}}]}},LaunchContextMenu:function(e,t,n){0===e?(new a).saveAs(t,n):1===e&&window.open(t)}})}),define("DS/VCXWebComposer/VCXModelNavigableRoot",["DS/WebApplicationBase/VCXAModelNavigable"],function(e){"use strict";return e.extend({getWorkingRoot:function(){return this}})}),define("DS/VCXWebComposer/VCXRefInstNodeIndex",["require","exports"],function(e,t){"use strict";return class{constructor(e,t){this.parent=null,this.instances=null,this.reference=null,this._3DViewerCtrl=void 0,this.product=e,this.id=t.resourceid,this.type=t["ds6w:type"]}setParent(e){this.parent=e}getPathOfIDs(){return this.parent?[...this.parent.getPathOfIDs(),this.id]:[this.id]}getPathOfInstances(){return this.parent?"VPMInstance"===this.type?[...this.parent.getPathOfInstances(),this.id]:this.parent.getPathOfInstances():"VPMInstance"===this.type?[this.id]:[]}getData(e){var t;return"VPMInstance"===this.type?null===(t=this.product.productIndex._partInfo[this.id])||void 0===t?void 0:t.toObj[e]:this.product.productIndex._partInfo[this.id][e]}getComponent(){return"VPMInstance"===this.type&&this.reference?this.reference.getComponent():(this.component||(this.component=this.product._experienceBase.ComponentsMap.getComponentFromIDPath(this.getPathOfIDs(),!0)),this.component)}getWorldMatrix(e){if(void 0===this._3DViewerCtrl){const e=widget.enopadViewer;this._3DViewerCtrl=e?e&&e.getController():null}if(this._3DViewerCtrl)return this._3DViewerCtrl.getWorldMatrix(this.getPathOfIDs());const t=this.getComponent();return t?t.QueryInterface("W3AISGNodeHolder").getPathElement().getWorldMatrix(e):void 0}}}),define("DS/VCXWebComposer/VCXNodeHolderAssetOccurrenceComposer",["DS/WebApplicationBase/W3AASGNodeHolder","DS/Visualization/Node3D"],function(e,t){"use strict";return e.extend({init:function(){},getPathElement:function(){if(!this._pathElement){var e=this.GetObject()._experienceBase.getManager("VCXContextManager");if(!e||!e.isSupported("3DSync"))return this._parent();var t=this.GetObject()._experienceBase.getManager("VCXCAT3DXModelManager");this._pathElement=t.QueryInterface("VCXILoadHelper").getPathElement(this),this._pathElement.getLastElement().worktype||this._pathElement.getLastElement().productType||(this._pathElement.getLastElement().worktype="VPMInstance")}return this._pathElement},setPathOfIDs:function(e){this._parent(e),this.GetObject()._experienceBase.ComponentsMap.addToHashTree(this.GetObject())},buildSGNode:function(){var e=this.GetObject()._experienceBase.getManager("VCXContextManager");if(e&&e.isSupported("3DSync"))return null;if(!this._sgNode){this._sgNode=new t({name:"LoadedAsset"}),this._sgNode.productType="Instance3D"}var n=this.QueryInterface("VCXIModelNavigable");if(n){var r=n.getParent();if(r){var a=r.QueryInterface("W3AISGNodeHolder");a&&(a.getSGNode().addChild(this._sgNode),this._pathElement=a.getPathElement().clone(),this._pathElement.addElement(this._sgNode))}}return this._sgNode},isSelfManagedPathElement:function(){return!0}})}),define("DS/VCXWebComposer/VCXDragDropManager",["UWA/Class","DS/VCXWebExperienceBase/VCXContextManager","DS/DataDragAndDrop/DataDragAndDrop","DS/Controls/Loader","DS/VCXWebComposer/VCXExperienceLoader","DS/VCXWebIO/VCXMimeTypeServices","DS/ApplicationFrame/CommandsManager","DS/VCXWebEWS/VCXExperienceServices","DS/VCXWebPlatform/VCXPlatformServices","DS/VCXWebSystem/VCXHardwareServices","i18n!DS/VCXWebComposer/assets/nls/VCXWebComposer"],function(e,t,n,r,a,i,o,s,c,p,l){"use strict";var C=e.extend({getProgressBar:function(){var e=new r({text:"Preparing..."});return e.inject(widget.body),e.getContent().setStyles({margin:"auto",position:"absolute",top:"110px",left:"0",bottom:"0",right:"0",width:"60px",height:"60px"}),e},overCB:function(e,t){var n=t.dataTransfer;this.isSupported(n);return!0},enterCB:function(e,t){if(t&&t.dataTransfer&&t.dataTransfer.types){this.isSupported(t.dataTransfer)&&this._experienceBase.getManager("VCXGUIManager").AddDropZone()}},isSupported:function(e){for(var t=e.types,n=t.length,r=!1,a=0;a<n;a++)if("Files"===t[a]||"text/plain"===t[a])r=!0,e.dropEffect="copy";else{if("cke/id"===t[a]||"text/uri-list"===t[a]){e.dropEffect="none",r=!1;break}"draggedsceneid"===t[a]&&(e.dropEffect="move",r=!0)}return r},leaveCB:function(){this._experienceBase.getManager("VCXGUIManager").RemoveDropZone()},dropCB:function(e,n,r){var c=this._experienceBase,p=c.getManager("VCXContextManager");if(this.isSupported(r.dataTransfer)){if(e&&e.length&&e.length>0&&"{"===e.charAt(0)){var C=JSON.parse(e);if(C&&"XCTXPR_AP"===C.source){var g={level:"warning",title:l["Notification.DragAndDrop.Impossible.Title"],subtitle:l["Notification.DragAndDrop.Impossible.SubTitle"]};return c.getManager("VCXNotificationManager").addNotification(g),void c.getManager("VCXGUIManager").RemoveDropZone()}}if(e&&void 0!==widget.onRefresh)return console.log(e),this.loadDroppedFromCollabSpace(r).then(function(){console.log("Load drop done.")}).catch(function(e){console.log("Load drop failed.")});var d=r.dataTransfer.files,u=[],h=!1;if(d.length){h=!0;for(var m=0;m<d.length;m++){if(void 0!==(D=d[m])){var M=D.name;D.type;D.type||(h=!1),I=(I=M.slice(M.lastIndexOf(".")+1)).toLowerCase(),u.push(I)}}}if(d.length>0){var f=p.CheckInputFile(!1,u);if(!h&&!f.supported){g={level:"warning",title:l["Notification.DragAndDrop.Loading.Title"],subtitle:f.message,sticky:!0};return c.getManager("VCXNotificationManager").addNotification(g),void c.getManager("VCXGUIManager").RemoveDropZone()}}var V="",_="",S=null,X={};if(1===d.length&&"record"===c.odt){var D=d[0],v=c.getManager("VCXGUIManager").getGettingStartedUI();return c.getManager("VCXAPIManager").OpenModel(D,function(){v.endLoadingExperience()})}c.getManager("VCXGUIManager").RemoveDropZone();for(m=0;m<d.length;m++){if(void 0!==(D=d[m]))if(void 0!==(M=D.name)){var I;if(I=(I=M.slice(M.lastIndexOf(".")+1)).toLowerCase(),!(f=p.CheckInputExtension(I)).supported){c.getManager("VCXNotificationManager").addNotification({level:"warning",title:l["Notification.DragAndDrop.ActionNotSupported.Title"],message:f.message});continue}"json"===I||"exprd"===I?V=D:"3dxml"===I?(_=D,S=window.URL.createObjectURL(D),X[D.name]=S):"application/octet-stream"!==i.GetMimeType("."+I)||c.getManager("VCXNotificationManager").addNotification({level:"warning",title:l["Notification.DragAndDrop.ExtensionNotSupported.Title"]})}}v=c.getManager("VCXGUIManager").getGettingStartedUI();if(V){window.loading3DXML=!0;var b=this;return c.webApplication.requestNewExperienceBaseAsync().then(function(e){b._experienceBase=e,(new a).Load({experienceBase:b._experienceBase,mapAssets:X,jsonFile:V,urb:!0,endCB:function(){window.loading3DXML=!1}})})}if(_){if("record"===c.odt&&c.getManager("VCXODTManager").SetModelForZip(_),p.isSupported("Import3DXML")&&!t.getUrlVars().file)return(async()=>{const e=await s.handle3DXML(X,this._experienceBase);if(e)for(let t of d)this._experienceBase.getManager("VCXAnalyticsTrackerAppManager").trackImport3dxmlEvent("xH_HomePageDragAndDrop",e.insertProducts,t.size);return e})();window.loading3DXML=!0;b=this;return c.webApplication.requestNewExperienceBaseAsync().then(function(e){b._experienceBase=e,(new a).Load({experienceBase:e,mapAssets:X,jsonFile:"",endCB:function(){window.loading3DXML=!1}})})}{for(var x={x:r.clientX,y:r.clientY},y=0;y<d.length;y++){if((D=d[y]).type.length){var A=D.name,P=new window.FileReader;P.onloadend=(()=>{var e=P.result,t=new Blob([e],{type:D.type}),n=window.URL.createObjectURL(t),r=c.getManager("VCXDocManager").BuildPathFromString(n,A),a=o.getCommand("VCXCreateDressup2DImageCmd",c.getManager("VCXContextManager").getContext());a&&(a._mousePosition=x,a._sceneIDToUse="",a._docIDToUse=c.getManager("VCXDocManager").AddOrModifyDoc(r),a.begin()),c.getManager("VCXGUIManager").RemoveDropZone()}),P.readAsArrayBuffer(D)}}const e=r.dataTransfer.types[0]&&r.dataTransfer.getData("draggedSceneId");if(e){var B=o.getCommand("VCXCreateDressup2DImageCmd",c.getManager("VCXContextManager").getContext());B&&(B._mousePosition=x,B._sceneIDToUse=e,B.begin())}}}},postInitialize:function(){var e=this._experienceBase.getManager("VCXContextManager");if(e.getMainViewer().div){var t={over:(e,t)=>{this.overCB(e,t)},enter:(e,t)=>{this.enterCB(e,t)},leave:()=>{this.leaveCB()},drop:(e,t,n)=>{this.dropCB(e,t,n)}},r=document.getElementById(e.getMainViewer().div.id);r||console.warn("Cannot find canvas id "+e.getMainViewer().div.id),r&&n.droppable(r,t);var a=document.getElementsByClassName("vcx-Curtain-Home")[0];a||console.warn("Cannot find vcx-Curtain-Home"),a&&n.droppable(a,t)}else console.error("No canvas !!")},unInitialize:function(){var e=this._experienceBase.getManager("VCXContextManager");if(e.getMainViewer().div){var t=document.getElementById(e.getMainViewer().div.id);n.clean(t)}},getVersion:function(){return"2.24.0"},loadDroppedFromCollabSpace:function(e){this._experienceBase.getManager("VCXGUIManager").RemoveDropZone();var t=this,n="text/plain";p.isIE11()&&(n="text");var r,a=e.dataTransfer.getData(n);if(!a)return this.dropCB(null,null,e);var i=new Promise(async(e,n)=>{try{if(!a)return(o=new Error("Content not supported.")).criticity="Warning",n(o);try{var i=JSON.parse(a).data;r=i.items[0]}catch(o){var o=new Error("Content not supported.");return o.criticity="Warning",n(o)}var o,p=t._experienceBase.getManager("VCXContextManager").CheckInputFile(!0);if(!p.supported)return(o=new Error(p.message)).criticity="Warning",n(o);await c.CheckTenant(r);var l=r.objectType;console.log("Dropped object type : "+l);var C={};C.data=a,C.getData=function(){return e(C.data)},C.files=[];var g,d=r.contextId,u=r.displayName,h=r.objectId;return"Document"===l?e(s.onDropDocument(u,C,t._experienceBase)):"HighlightPresentation3DCom"===l?(t._experienceBase.getManager("VCXAnalyticsTrackerAppManager").trackOpenPresentationEvent("xH_HomePageDragAndDrop"),t._experienceBase.getManager("VCXGUIManager").saveToMRU(h),e(s.onLoadExperienceFromPhysicalID(t._experienceBase,u,h,d))):"CityPresentation3DCom"===l?e(s.onLoadExperienceFromPhysicalID(t._experienceBase,u,h,d)):"dsc_matref_ref_Covering"===l?e(s.onDropMaterial(u,h,C,t._experienceBase)):"AmbienceEnvironment"===l?e(s.onDropAmbience(u,h,C,t._experienceBase)):(t._experienceBase.getManager("VCXAnalyticsTrackerAppManager").trackNewPresentationEvent("xH_HomePageDragAndDrop"),e(s.onDropProduct(u,h,t._experienceBase,l)))}catch(g){return console.error(g),"Warning"===g.criticity?n(g):(await s.CloseExperienceAndReset(t._experienceBase,{level:"error",title:"Loading Error",message:"The content could not be loaded."},g),n(g))}});return this._experienceBase.getManager("VCXNotificationManager").addProgressNotification({maskDisplayAdd:1,iPromise:i}),i}});return Object.defineProperty(C.prototype,"componentType",{enumerable:!0,get:function(){return"VCXDragDropManager"}}),C}),define("DS/VCXWebComposer/VCXSelectionSetManager",["DS/CoreEvents/Events","DS/VCXWebComposer/VCXWebActorListManager"],function(e,t){"use strict";var n=t.extend({initialize:function(){this._mapCacheComponentSelectionSet=null,this.isAuthoring=!1,this.selectionsSet=null,this.selectionSetCache=null},postInitialize:function(){this._mapCacheComponentSelectionSet={},this._eventTokens||(this._eventTokens={}),this.selectionSetCache&&this.selectionSetCache.clear()},getSelectionSetCache(){return this.selectionSetCache?Array.from(this.selectionSetCache.values()):(this.selectionSetCache=new Set(this._experienceBase.ComponentsMap.GetComponentFromType("VCXSelectionSet_Spec")),this.selectionSetCache)},unInitialize:function(){for(var t in this._eventTokens)this._eventTokens.hasOwnProperty(t)&&this._eventTokens[t]&&e.unsubscribe(this._eventTokens[t]);for(let e of this.getConcernedComponentActorListType())this.disposeComponentsActorListFromType(e);this._mapCacheComponentSelectionSet=null,this.selectionsSet=null},getConcernedComponentActorListType:function(){return["VCXComponentSelectionSet","VCXSelectionSet_Spec"]},getComponentsActorListMapCache:function(){return this._mapCacheComponentSelectionSet},addComponentToMapSelectionSet:function(e,t){this.associateComponentAndActorListToMapCache(e,t)},removeComponentFromMapSelectionSet:function(e,t){this.dissociateComponentAndActorListFromMapCache(e,t)},addActorsListToSelectionSet:function(e,t){e.forEach(e=>this.addComponentToMapSelectionSet(e,t))},removeActorsListFromSelectionSet:function(e,t){this.removeActorsListFromComponentActorList(e,t)},removeActorsListFromAllSelectionSets:function(e){for(let t of this.getConcernedComponentActorListType())this.removeActorsListFromAllComponentsActorListOfAKind(e,t)},isComponentBelongingToASelectionSet:function(e){return this.isComponentBelongingToMapCache(e)},getSelectionSetListFromComponent:function(e){return this.getListOfComponentActorListOwningComponent(e)},getSelectionSets:function(){return null===this.selectionsSet&&(this.selectionsSet=this._experienceBase.ComponentsMap.GetComponentFromType("VCXSelectionSet_Spec")),this.selectionsSet}});return Object.defineProperty(n.prototype,"componentType",{enumerable:!0,get:function(){return"VCXSelectionSetManager"}}),n}),define("DS/VCXWebComposer/VCXHotspotManager",["DS/Core/Core","DS/CoreEvents/Events","DS/VCXWebComposer/VCXWebActorListManager","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebVisu/VCXModifiablesAccess","DS/VCXWebProperties/VCXPropertyValueVector","DS/VisuEvents/EventsManager","DS/WebRBTree/WebRBIterator"],function(e,t,n,r,a,i,o,s){"use strict";var c=n.extend({initialize:function(){this._mapHotspotsHLFromTree={},this._mapHotspotsHLFromViewport={},this._mapHotSpotCompIdFromSmgXmlAndRealCompID={},this._mapCacheForPreghlight={}},postInitialize:function(){var e=this;this._eventTokens||(this._eventTokens={}),this._eventTokens._tokenScenarioChanged=t.subscribe({event:"VCX_CURRENT_SCENARIO_CHANGED"},function(){for(var t in e._mapHotspotsHLFromTree)if(e._mapHotspotsHLFromTree.hasOwnProperty(t)){var n=e._experienceBase.ComponentsMap.GetComponentFromID(t);e.DeactivateAllHotspots(),e.ActivateHotspotFromTree(n)}}),this._eventTokens._tokenPSO=t.subscribe({event:"/VISU/"},function(t){"@onMoveEvent"===t.eventType&&(t.from?e.onMouseOver(t,e):"@pickNothing"===t.eventID&&e.DeactivateAllHotspots(!0))})},unInitialize:function(){if(this.DeactivateAllHotspots(),this.DeactivateAllHotspots(!0),this._mapHotspotsHLFromTree={},this._mapHotspotsHLFromViewport={},this._mapHotSpotCompIdFromSmgXmlAndRealCompID={},this._mapCacheForPreghlight={},this._eventTokens){for(var e in this._eventTokens)this._eventTokens.hasOwnProperty(e)&&this._eventTokens[e]&&t.unsubscribe(this._eventTokens[e]);delete this._eventTokens}for(let e of this.getConcernedComponentActorListType())this.disposeComponentsActorListFromType(e)},getConcernedComponentActorListType:function(){return["VCXComponentHotspot"]},getComponentsActorListMapCache:function(){return this._mapCacheForPreghlight},addComponentToMapPrehighlight:function(e,t){var n=this._experienceBase.ComponentsMap.GetComponentFromID(e);if(!n){var r=this._experienceBase.getManager("VCXContextManager");if(r.getOpenSMGXML()){var a=r.getSmgXmlRoot();if(a){var i=a.GetComponentsMap();i.has(e)&&(n=i.get(e)),n&&(this._mapHotSpotCompIdFromSmgXmlAndRealCompID[e]=n.GetID())}}}n&&this.associateComponentAndActorListToMapCache(n,t)},removeComponentFromMapPrehighlight:function(e,t){var n=this._experienceBase.ComponentsMap.GetComponentFromID(e);this.dissociateComponentAndActorListfromMapCache(n,t)},addActorsListToHotspot:function(e,t){},removeActorsListFromHotspot:function(e,t){this.removeActorsListFromComponentActorList(e,t)},removeActorsListFromAllHotspots:function(e){for(let t of this.getConcernedComponentActorListType())this.removeActorsListFromAllComponentsActorListOfAKind(e,t)},getHotspotsListFromComponent:function(e){return this.getListOfComponentActorListOwningComponent(e)},GetEnabledHotspotFromComponentID:function(e,t){var n=null,r=this.getComponentsActorListMapCache()[e];for(var a in r){if(r.hasOwnProperty(a))if((n=this._experienceBase.ComponentsMap.GetComponentFromID(a)).QueryInterface("VCXIModifiable").GetProperty("Actor.Enable").GetPropertyValue().GetValue())return n}if(t){var i=this._experienceBase.ComponentsMap.GetComponentFromID(e).QueryInterface("VCXIModelNavigable").getParent();if(i)return this.GetEnabledHotspotFromComponentID(i.GetObject().GetID(),t)}},onMouseOver:function(t,n){var r=t.from;if(r){var i=a.BuildCleanedPathElement(r),o=this._experienceBase.ComponentsMap.GetComponentFromPathElement(i);if(o){var s=this._experienceBase.getManager("VCXHotspotManager").GetEnabledHotspotFromComponentID(o.GetID());s?(e.Selection.PSOManager.empty(!0),this._mapHotspotsHLFromViewport[s.GetID()]||(this.DeactivateAllHotspots(!0),this.ActivateHotspotFromViewport(s))):this.DeactivateAllHotspots(!0)}}},onClickEmptySpace:function(e,t){a.GetPathElementFromEvent(e,t._experienceBase)||(t.DeactivateAllHotspots(),t.DeactivateAllHotspots(!0))},ActivateHotspotFromTree:function(e){if(e&&e.IsKindOf("VCXActorList_Spec")){var t=this,n=e.QueryInterface("VCXIModifiable");o.addEvent(this._experienceBase.getManager("VCXContextManager").getMainViewer().div,"onPrimaryPointerClick",function(e){t.onClickEmptySpace(e,t)});var a=new r(this._experienceBase.getManager("VCXSelectionManager"));if(a.AddToSelection(e),this._experienceBase.getManager("VCXCommandManager").Do(a),n.GetProperty("Actor.Enable").GetPropertyValue().GetValue())if(this._experienceBase.getManager("VCXSelectionManager").keepHotspotsSelectable){if(!this._mapHotspotsHLFromTree[e.GetID()]){var s=n.GetProperty("Actor.Color").GetPropertyValue(),c=n.GetProperty("Actor.ListActors").GetPropertyValue();if(s&&c){var p=s.GetThreeColor(),l=this.createColorHL(p);this._mapHotspotsHLFromTree[e.GetID()]=l,this.addActorsToColorHL(l,c);var C=new i([l]);n.OnChangeProperty("highlight.color",C)}}}else this._mapHotspotsHLFromTree[e.GetID()]=null;else this._mapHotspotsHLFromTree[e.GetID()]=null}},ActivateHotspotFromViewport:function(e){if(e&&e.IsKindOf("VCXComponentHotspot")){var t=e.QueryInterface("VCXIModifiable");if(t.GetProperty("Actor.Enable").GetPropertyValue().GetValue())if(this._experienceBase.getManager("VCXSelectionManager").keepHotspotsSelectable){var n=t.GetProperty("Actor.Color").GetPropertyValue(),r=t.GetProperty("Actor.ListActors").GetPropertyValue();if(n&&r){var a=n.GetThreeColor(),i=this.createColorHL(a);this.AddToMapViewport(e.GetID(),i),this.addActorsToColorHL(i,r)}}}},createColorHL:function(e){var t=this._experienceBase.getManager("VCXContextManager").getMainViewer();if(t&&e){var n={color:e,outlineColor:e,intensity:.5};return t.createHighlightSet(n,!1,!1,!0)}},addActorsToColorHL:function(e,t){if(e)for(var n=e.getColorHighlight(),r=t.GetValue(),a=0;a<r.length;a++){var i=r[a],o=this._experienceBase.ComponentsMap.GetComponentFromLink(i);if(!o){var s=i.GetValue();if(this._mapHotSpotCompIdFromSmgXmlAndRealCompID.hasOwnProperty(s)){var c=this._mapHotSpotCompIdFromSmgXmlAndRealCompID[s];o=this._experienceBase.ComponentsMap.GetComponentFromID(c)}}var p=o.QueryInterface("W3AISGNodeHolder").getPathElement();e.add(p,{highlightColor:n})}},DeactivateAllHotspots:function(e){if(e){for(var t in this._mapHotspotsHLFromViewport)if(this._mapHotspotsHLFromViewport.hasOwnProperty(t))if(this._mapHotspotsHLFromTree[t]);else{var n=this._experienceBase.ComponentsMap.GetComponentFromID(t);this.DeactivateHotspotFromViewport(n)}}else for(var t in this._mapHotspotsHLFromTree)if(this._mapHotspotsHLFromTree.hasOwnProperty(t)){n=this._experienceBase.ComponentsMap.GetComponentFromID(t);this.DeactivateHotspotFromTree(n)}},DeactivateHotspotFromTree:function(e){if(e){var t=new r(this._experienceBase.getManager("VCXSelectionManager"));t.RemoveFromSelection(e),this._experienceBase.getManager("VCXCommandManager").Do(t);var n=this._mapHotspotsHLFromTree[e.GetID()];n&&(this.removeActorsFromColorHL(n),this._experienceBase.getManager("VCXContextManager").renderAll()),delete this._mapHotspotsHLFromTree[e.GetID()],0===Object.keys(this._mapHotspotsHLFromTree).length&&o.removeEvent(this._experienceBase.getManager("VCXContextManager").getMainViewer().div,"onPrimaryPointerClick",this.onVisuEvent)}},DeactivateHotspotFromViewport:function(e){var t=this._mapHotspotsHLFromViewport[e.GetID()];t&&(this.removeActorsFromColorHL(t),this._experienceBase.getManager("VCXContextManager").renderAll()),this.RemoveFromMapViewport(e.GetID())},removeActorsFromColorHL:function(e){e&&e.clearAll()},UpdateHotspotsHyperlinks:function(){for(var e=this._experienceBase.getManager("VCXScenarioManager").GetScenarios(),t=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentHotspot"),n=0;n<t.length;n++){var r=t[n].QueryInterface("VCXIModifiable"),a=this._experienceBase.getManager("VCXScenarioManager").GetNeutrals(r.GetHashing()).GetProperty("Actor.Hyperlink");if(a){var i=this._experienceBase.getManager("VCXDocManager").GetPropPath(a.GetPropertyValue().GetValue());if(i)if(1===i.GetPathType().GetValue()){var o=i.GetValueLink().GetValue(),c=this._getScenarioIDFromName(o);i.GetValueLink().SetValue(c)}}for(var c in e)if(e.hasOwnProperty(c)){var p=e[c].GetObjectAnimation(r.GetHashing());if(p){var l=p.GetTrack("Actor.Hyperlink");if(l)for(var C=l._treekeys,g=new s(C),d=g.next();null!==d;){var u=d.GetValue().GetValue(),h=this._experienceBase.getManager("VCXDocManager").GetPropPath(u);if(h)if(1===h.GetPathType().GetValue()){o=h.GetValueLink().GetValue(),c=this._getScenarioIDFromName(o);h.GetValueLink().SetValue(c)}d=g.next()}}}}},_getScenarioIDFromName:function(e){var t=this._experienceBase.getManager("VCXScenarioManager").GetScenariosFromType(0);if(t[e])return e;for(var n in t){if(t.hasOwnProperty(n))if(e===t[n].GetName())return n}},AddToMapViewport:function(e,t){this._mapHotspotsHLFromViewport[e]=t},RemoveFromMapViewport:function(e){delete this._mapHotspotsHLFromViewport[e]}});return Object.defineProperty(c.prototype,"componentType",{enumerable:!0,get:function(){return"VCXHotspotManager"}}),c}),define("DS/VCXWebComposer/VCXExperienceSaver",["DS/VCXWebExperienceLoader/VCXExperienceSaverBase","DS/VCXWebIO/VCXFileWriter","DS/VCXWebComposer/VCXBlobDumper","DS/VCXWebPlatform/VCX3DSpaceServices","DS/VCXWebIO/VCXFileServices"],function(e,t,n,r,a){"use strict";return e.extend({init:function(){this._parent(),this._blobDumper=new n},Save:function(e,t){var n=this;this._blobDumper.ConvertBlobsFromDocManager(e,function(){n.SaveToJson(e,t)})},SaveToJson:function(e,n){var i={FileVersion:1};i.VCXObjects=this._ComponentsMapToJson(e),i.W3AISGNodeHolder=this._W3AISGNodeHolderToJson(e),i.VCXIModelNavigable=this._VCXIModelNavigableToJson(e),i.MetaPropertiesDef=this._MetaPropertiesDefToJson(e),i.ScenarioSequences=this._SequencesToJson(e),i.neutrals=this._NeutralsToJson(e),i.listScenarios=this._ScenariosToJson(e),i.DocManager=this._DocManagerToJson(e),i.EmbeddedData=this._EmbeddedDataToJson();var o=JSON.stringify(i,null,4),s="data:text/json;charset=utf8,"+encodeURIComponent(o),c="SaveExperience";if(e&&e.getManager("VCXContextManager")){var p=e.getManager("VCXContextManager").getRootComponentName();if(p)c=p;else{var l=new Date;c+="-",c+=l.getUTCFullYear(),c+=l.getUTCMonth(),c+=l.getUTCDate(),c+=l.getUTCHours(),c+=l.getUTCMinutes(),c+=l.getUTCSeconds()}}e.getManager("VCXContextManager").getProdHighMode()?c+=".exprd":c+=".json";var C=e.getManager("VCXCAT3DXModelManager");if(C){var g=e.getManager("VCXContextManager").GetApplicationMode();if(C&&2===g)return void r.publish3DSpace(a.dataURLToBlob(s,c),c).then(function(){console.log("Experience "+c+" Saved"),n&&n()})}(new t).saveAs(s,c),n&&n()},_GetStartingScenario:function(e){var t=e.getManager("VCXSequenceManager").GetListSequences();if(0!==t.length)for(var n=t[0].GetListScenariosId(),r=0;r<n.length;r++){var a=n[r];if(0===e.ComponentsMap.GetComponentFromID(a).GetPersistency())return a}else console.log("VCXExperienceSaver: The sequence list is empty !");return""},_SequencesToJson:function(e){for(var t=[],n=e.getManager("VCXSequenceManager").GetListSequences(),r=0;r<n.length;r++){var a=n[r],i={objectID:a.GetID(),listScenarioID:a.GetListScenariosId()};t.push(i)}return t},_ScenariosToJson:function(e){var t=[],n=e.getManager("VCXScenarioManager").GetScenarios();for(var r in n)if(n.hasOwnProperty(r)){var a=n[r];if(0!==a.GetPersistency())continue;var i=this._ScenarioToJson(e,a),o=a.GetVisibility(),s=this._VisibilityToJson(o,e);i.visibility=s,t.push(i)}return t},_DocManagerToJson:function(e){for(var t={},n=[],r=e.getManager("VCXDocManager").NumberOfDoc(),a=0;a<r;a++){var i=e.getManager("VCXDocManager").GetPropPath(a);if(i)if(i.GetValueBool())if(i.GetValueBool().GetValue()){var o=this._PropertyToJson(i,e);n.push({docID:a,type:"VCXPropertyValuePath",value:o})}}e.getManager("VCXDocManager").QueryInterface("VCXIModifiable");return t.array=n,t},_EmbeddedDataToJson:function(){return this._blobDumper.GetMapOfData()},DumpScenario:function(e,n){var r=this._ScenarioToJson(e,n),a=n.GetVisibility(),i={Scenario:r,Visibility:this._VisibilityToJson(a,e)},o=JSON.stringify(i,null,4),s="data:text/json;charset=utf8,"+encodeURIComponent(o);(new t).saveAs(s,"Scenario.json")},DumpComponentsMapContent:function(e,n){var r=[],a=[],i=[],o=e.ComponentsMap.GetComponentTable();for(var s in o)if(o.hasOwnProperty(s)){var c=o[s],p=c.GetType(),l=c.GetLoadData(),C={};C.objectID=s,C.objectType=p;l=null;var g=c.QueryInterface("W3AISGNodeHolder");if(g){var d=g.getPathElement();l=this._BuildArrayIDsFromPathElement(d)}l&&l.length>0&&(C.objectData=l);var u=c.GetPersistency();0===u?r.push(C):1===u?a.push(C):2===u&&i.push(C)}var h={Persistency0:r,Persistency1:a,Persistency2:i},m=JSON.stringify(h,null,4),M="data:text/json;charset=utf-8,"+encodeURIComponent(m),f="";(f=n?n+".json":"ComponentsMap.json","record"===e.odt)||(new t).saveAs(M,f);return{obj:h,url:M,filename:f}},DumpArray:function(e,t,n){var r={MyArray:t};return this.DumpObject(e,r,n)},DumpPropertyMap:function(e,t,n){var r=this._PropMapToJson(e,t);return this.DumpObject(e,r,n)},DumpObject:function(e,n,r){var a={};n.toJSON=function(){var e=Object.keys(this);e.sort();for(var t=0;t<e.length;t++){var n=e[t];"toJSON"!==n&&(a[n]=this[n])}return a};var i=JSON.stringify(n,null,4),o="data:text/json;charset=utf-8,"+encodeURIComponent(i),s="";(s=r?r+".json":"MapObject.json","record"===e.odt||"replay"===e.odt)||(new t).saveAs(o,s);return{obj:a,url:o,filename:s}},_DumpPropMapDiff:function(e,t,n){for(var r in e)if(e.hasOwnProperty(r)){var a=e[r];for(var i in a)if(a.hasOwnProperty(i)){var o=a[i].vcxPropertyRef,s=a[i].vcxProperty;e[r][i].vcxPropertyRef=this._PropertyToJson(o.GetPropertyValue(),n),e[r][i].vcxProperty=this._PropertyToJson(s.GetPropertyValue(),n)}}this.DumpObject(e,t)}})}),define("DS/VCXWebComposer/VCXHyperlinkManager",["DS/Core/Core","DS/CoreEvents/Events","DS/VCXWebExperienceBase/VCXHyperlinkManagerBase","DS/VCXWebComposer/VCXUIHyperlink","DS/VCXWebKernel/VCXCmdGoToMarker","DS/WebRBTree/WebRBIterator"],function(e,t,n,r,a,i){"use strict";var o=n.extend({initialize:function(){this._parent(),this._strEventToListen="onPrimaryPointerClick",this._tokens={}},postInitialize:function(){this._parent(),this._active=!1,this._vcxUIHyperlink=new r(this._experienceBase),this._tokens={}},unInitialize:function(){this._parent();for(let e of Object.keys(this._tokens))t.unsubscribe(this._tokens[e]);this._vcxUIHyperlink&&(this._vcxUIHyperlink.UnsubscribeEvent(),this._vcxUIHyperlink=null),this._active=!1},setActive:function(e){this._active=e,this._vcxUIHyperlink&&this._vcxUIHyperlink.setActive(e),this._active&&this._experienceBase.getManager("VCXSelectManager").switchOnSensibilityForAllHyperlinks()},isActive:function(){return this._active},ObjectHasHyperlink:function(e){var t=e.QueryInterface("VCXIModifiable"),n=null;return t&&(n=t.GetProperty("Actor.Hyperlink")),!!n&&parseInt(n.GetPropertyValue().GetValue(),10)>=0},OpenHyperlink:function(e,t){if(this._active){var n=null,r=e.GetObject().GetID(),a=null;if(this._experienceBase.getManager("VCXHotspotManager")&&(a=this._experienceBase.getManager("VCXHotspotManager").GetEnabledHotspotFromComponentID(r,!0)),a){var i=a.QueryInterface("VCXIModifiable");n=this._getPropertyPathFromModifiable(i)}else n=this._getPropertyPathFromModifiable(e);var o=-1;if(n)o=n.GetPathType().GetValue();if(0===o){var s="",c=n.GetValueURL().GetValue();c.indexOf("blob:")<0&&(s=c.toLowerCase()),s.indexOf("scenario://")>=0?this.OpenScenarioFromOrder(s,t):this.OpenDocument(o,n,t)}else if(1===o){var p=this._experienceBase.ComponentsMap.GetComponentFromLink(n.GetValueLink());p&&this.OpenScenario(p.GetID(),t)}else if(2===o){(C=this._experienceBase.ComponentsMap.GetComponentFromLink(n.GetValueLink())).IsKindOf("VCXComponentMarker")?this.GoToMarker(C,!1,!0,t):C.IsKindOf("VCXScenario")&&this.PlayScenario(C,t)}else if(3===o){var l=this._experienceBase.ComponentsMap.GetComponentFromLink(n.GetValueLink());l&&this.GoToMarker(l,!1,!1,t)}else if(4===o){var C;(C=this._experienceBase.ComponentsMap.GetComponentFromLink(n.GetValueLink()))&&C.IsKindOf("VCXComponentMarker")?this.GoToMarker(C,!0,!1,t):C&&C.IsKindOf("VCXScenario")&&this.PlayMarkerSequence(C,t)}else console.log("[VCXHyperlinkeManager]: mode not found. Failed launch hyperlink.")}else t&&t()},OpenDocument:function(e,t,n){var r=this._getHyperlinkInfosFromProperty(t),a=r.url,i=r.filename;a.indexOf("blob:")>-1?this._vcxUIHyperlink.CreateMediaDiv(a,i):window.open(a);n&&n(a)},OpenScenarioFromOrder:function(e,t){var n=e.substring(11),r=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario(),a=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(r);if(a){this._experienceBase.getManager("VCXSequenceManager").GetListSequencesFromType(0);var i="",o=n.toLowerCase();if("previous"===o)i=this._experienceBase.getManager("VCXSequenceManager").GetPreviousScenarioId(r);else if("next"===o)i=this._experienceBase.getManager("VCXSequenceManager").GetNextScenarioId(r);else if("first"===o)i=a.GetListScenariosId()[0];else if("last"===o){var s=a.GetListScenariosId();i=s[s.length-1]}""!==i&&this.OpenScenario(i,t)}else console.log("Sequence not found !")},OpenScenario:function(e,t){this._experienceBase.getManager("VCXGUIManager").GoToScenarioContext()&&this._experienceBase.getManager("VCXExperience").GoToScenarioWithInterpolation(e,t)},PlayScenario:function(n,r){if(n);else{let e=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();n=this._experienceBase.ComponentsMap.GetComponentFromID(e)}var a=()=>{n.HasAnimation()&&(e.Selection.PSOManager.empty(),t.publish({event:"VCX_START_PLAY"}),this._experienceBase.getManager("VCXContextManager")&&("0"==this._experienceBase.getManager("VCXContextManager").getUrlVars().boost||n.BuildAnimatedModifiablesSets(this._experienceBase.getManager("VCXScenarioManager")._keyframer)),this._experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!0),this._tokens.tokenStopPulse&&(t.unsubscribe(this._tokens.tokenStopPulse),delete this._tokens.tokenStopPulse),this._tokens.tokenStopPulse=t.subscribe({event:"VCX_Timeline_STOP_PLAY"},()=>{t.unsubscribe(this._tokens.tokenStopPulse),delete this._tokens.tokenStopPulse,n.SetSequenceMaxFrame(null)}),this._tokens.tokenEndPlayScenario&&(t.unsubscribe(this._tokens.tokenEndPlayScenario),delete this._tokens.tokenEndPlayScenario),this._tokens.tokenEndPlayScenario=t.subscribe({event:"VCX_SCENARIO_END_REACHED"},()=>{t.unsubscribe(this._tokens.tokenEndPlayScenario),delete this._tokens.tokenEndPlayScenario,r&&r()}))},i=()=>{this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario()!==n.GetID()?this.OpenScenario(n.GetID(),a):a()};this._active&&this._experienceBase.getManager("VCXPulseManager")?this._experienceBase.getManager("VCXPulseManager").StopPulse(i):i()},PlayMarkerSequence:function(e,t){var n=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario(),r=this._experienceBase.ComponentsMap.GetComponentFromID(n),a=0;e.IsKindOf("VCXComponentMarker")?a=e.QueryInterface("VCXIModifiable").GetProperty("Actor.TimePos").GetPropertyValue().GetValue():e.IsKindOf("VCXScenario")?r=e:a=this._experienceBase.getManager("VCXScenarioManager").GetCurrentFrame();var o=null,s=r.GetTrackMarkers();if(s)for(var c=s._treekeys,p=new i(c),l=p.next();null!==l;){var C=l.GetFrame();parseInt(C)>a?(o=C,l=null):(0,l=p.next())}o&&r.SetSequenceMaxFrame(o),this.PlayScenario(r,t)},GoToMarker:function(e,t,n,r){var i=new a(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap);i.GoToMarker(e.GetID()),i.SetCallback(r),this._experienceBase.getManager("VCXCommandManager").Push(i),t?this.PlayMarkerSequence(e,r):n&&this.PlayScenario(null,r)}});return Object.defineProperty(o.prototype,"componentType",{enumerable:!0,get:function(){return"VCXHyperlinkManager"}}),o}),define("DS/VCXWebComposer/VCXWebAppHelper",["UWA/Class","DS/Core/Core","DS/CoreEvents/Events","DS/VCXWebExperienceBase/VCXContextManager","DS/VCXWebComposer/VCXWebDictionary","DS/VCXWebDressup/VCXWebDressupDictionary","DS/VCXWebVisualization/VCXVisuManager"],function(e,t,n,r,a,i,o){"use strict";var s=e.extend({init:function(e){this._parent(),this._nlsToLoad=[],this.options=UWA.extend({},e,!0)},disposeExperienceBase:function(){return this._VCXActionBarLoadRequest&&n.unsubscribe(this._VCXActionBarLoadRequest),this._VCXActionBarLoadRequest=null,this._RunLoopStarted&&n.unsubscribe(this._RunLoopStarted),this._RunLoopStarted=null,UWA.Promise.resolve()},onActionBarReady:async function(){if(this._actionBarNew){await this._actionBarNew.promise,this._actionBarNew=null;var e=this._experienceBase.getManager("VCXGUIManager"),t=this._experienceBase.getManager("VCXContextManager").getActionBar();if(t._additionalActionBarSections||(t._additionalActionBarSections=[],this.getAdditionalActionBarSections(t._additionalActionBarSections),this._experienceBase._ManagerSet.dealWithInitArray("getAdditionalActionBarSections",!1,!1,t._additionalActionBarSections)),t._additionalActionBarSections&&t._additionalActionBarSections.length){var n=t._additionalActionBarSections.pop();t.loadModel(n)}else e.onVCXActionBarReady(t)}},getAdditionalActionBarSections:function(e){},getContextualContent:function(e){const t=[];return this._experienceBase&&this._experienceBase.getManager("VCXContextManager")&&this._experienceBase.getManager("VCXContextManager").isSupported("VCXMousePositionDebug")&&t.push({name:"VCXMousePositionCmd",hdr_list:["VCXMousePositionCmd"]}),{cmdList:t}},AddDictionaryDescription:function(e){if(e&&e.getNLSModules&&e.getNLSModules()&&(this._nlsToLoad=this._nlsToLoad.concat(e.getNLSModules())),e&&e.GetDictionary&&e.GetDictionary())return this._experienceBase.AddDictionaryDescription(e.GetDictionary())},addDictionaries:async function(){await this.AddDictionaryDescription(a),await this.AddDictionaryDescription(i),void 0===r.getUrlVars().debug&&"true"!=localStorage.getItem("xHighlight_debugMode")||await new Promise(e=>{require(["DS/VCXWebDebug/VCXWebDictionaryDebug"],function(t){this.AddDictionaryDescription(t).then(()=>e())}.bind(this))})},onFinished:function(e){var r=this;if(this._RunLoopStarted=n.subscribe({event:"/W3A/ManagerSet/RunLoopStarted"},function(){r.options.onAppInitialize&&(r.options.onAppInitialize(r,r._experienceBase),r.options.onAppInitialize=null),n.unsubscribe(r._RunLoopStarted),delete r._RunLoopStarted}),t.setFullscreen(),r._experienceBase&&r._experienceBase._ManagerSet&&r._experienceBase._ManagerSet.getVersions&&console.log(this._experienceBase._ManagerSet.getVersions()),this._experienceBase.getManager("VCXGUIManager")){var a=this._experienceBase.getManager("VCXGUIManager").getGettingStartedUI();a&&a.clearInitWidget()}return this._VCXActionBarLoadRequest=n.subscribe({event:"VCXActionBarLoadRequest"},()=>{this._actionBarNew||(this._actionBarNew=UWA.Promise.deferred())}),this._experienceBase&&this._experienceBase._ManagerSet&&this._experienceBase._ManagerSet.postInitializePromise&&this._experienceBase._ManagerSet.postInitializePromise.then(()=>{this._actionBarNew||(this._actionBarNew=UWA.Promise.deferred()),this._actionBarNew.resolve()}),UWA.Promise.resolve()}});return s.getOptions=function(){return window.useAsyncExperienceBase=!0,window.enableNewTrapSelection=!0,window.IR551190=!0,window.IR551201=!0,window.WUXEnableGSSOCache=!0,{viewerOptions:o.getViewerOptions(),uiOptions:{displayTree:!1,preserveActionBarHeight:!0}}},s}),define("DS/VCXWebComposer/VCXProductIndex",["require","exports","DS/VCXWebSystem/VCXEnums","DS/VCXWebPlatform/VCXPlatformServices","DS/TreeModel/TreeNodeModel","DS/VCXWebComposer/VCXRefInstNodeIndex"],function(e,t,n,r,a,i){"use strict";class o{constructor(e){this.productID=e}async fetch(e,t,n){const a=await r.expandV2(e,t,this.productID);this._partInfo=a&&a.results&&o.buildGraphFromExpandResult(a&&a.results),a&&a.results&&a.results.forEach(e=>{e&&e.resourceid&&(this._partInfo[e.resourceid]=e),e.materials_info&&(this._materials_info=e.materials_info)}),this._partInfoRoot=this._partInfo[this.productID],this._partTree=o.getInstRefTreeFromReference(this._partInfoRoot,n);const i=[];let s=0;for(this._materials_info&&this._materials_info.materials&&this._materials_info.materials.forEach(e=>{i[s]||(i[s]=[]),i[s].length>900&&(i.push([]),s++),i[s].push(e.resourceid)}),s=0;s<i.length;s++){const n=await r.fetchV2(e,t,i[s]);this._materials_info||(this._materials_info={}),this._materials_info.materialMap={},n&&n.results&&n.results.forEach(e=>{const t={};e.attributes&&e.attributes.forEach(e=>{t[e.name]=e.value});const n=t.resourceid;n&&(this._materials_info.materialMap[n]=t)})}}getPathOfIDsFromPathOfInstances(e){return o.getPathOfIDsFromPathOfInstancesAndRefTree(this._partTree,e,0)}static getPathOfIDsFromPathOfInstancesAndRefTree(e,t,n){var r;if(!(t.length>n))return;const a=t[n],i=null===(r=null==e?void 0:e.instances[a])||void 0===r?void 0:r.reference,s=o.getPathOfIDsFromPathOfInstancesAndRefTree(i,t,n+1);return s?[e.id,a,...s]:[e.id,a]}getRefInstNode(e){return o.getRefInstNodeRefTree(this._partTree,e,0)}static getRefInstNodeRefTree(e,t,n){var r;if(!e)return null;if(n+2>t.length)return null;if(e.id!==t[n])return null;const a=t[n+1],i=null===(r=null==e?void 0:e.instances[a])||void 0===r?void 0:r.reference;return i?n+2===t.length?i:o.getRefInstNodeRefTree(i,t,n+2):null}getInstRefRoot(){return this._treeInstRefRoot||(this._treeInstRefRoot=o.getInstRefTreeNodeModelFromReference(this._partInfoRoot,this._materials_info),this._treeInstRefRoot.setAttribute("id",this.productID),this._treeInstRefRoot.setAttribute("productID",this.productID)),this._treeInstRefRoot}static buildGraphFromExpandResult(e){const t={};return e&&e.forEach(e=>{if(e&&e.resourceid){let n;n=t[e.resourceid]?{...t[e.resourceid],...e}:e,t[n.resourceid]=n,n.from&&(t[n.from]?n.fromObj=t[n.from]:n.fromObj={resourceid:n.from},n.fromObj.tos||(n.fromObj.tos=[]),n.fromObj.tos.push(n)),n.to&&(t[n.to]?n.toObj=t[n.to]:n.toObj={resourceid:n.to},n.toObj.froms||(n.toObj.froms=[]),n.toObj.froms.push(n))}}),t}static isInstRefTreeComplete(e,t){if(void 0!==t._isComplete)return t._isComplete;if(e&&e.instances&&Object.keys(e.instances).length){if(t&&t.instances&&Object.keys(t.instances).length){if(Object.keys(e.instances).length===Object.keys(t.instances).length){for(let n in t.instances)if(!o.isInstRefTreeComplete(e.instances[n].reference,t.instances[n].reference))return t._isComplete=!1,!1;return t._isComplete=!0,!0}return t._isComplete=!1,!1}return t._isComplete=!1,!1}return t._isComplete=!0,!0}traverseTree(e){return o.iterateThroughInstRefTree(this._partTree,e)}static iterateThroughInstRefTree(e,t){let n=!e||t&&t(e);if(!n)for(let r in e.instances){if(n)continue;const a=e.instances[r];(n=t&&t(a))||o.iterateThroughInstRefTree(a.reference,t)}}getSmartSelection(e,t){const n=[];if(!e)return console.warn("No partial tree"),n;if(this._partTree.id!==e.id)return console.error("Unexepected ref comparaison"),n;if(this._partTree.instances&&Object.keys(this._partTree.instances).length&&e&&e.instances&&Object.keys(e.instances).length)if(o.isInstRefTreeComplete(this._partTree,e))n.push([...t,this._partTree.id]);else for(let r in e.instances)n.push(...this.getSmartSelection(e.instances[r].reference,[...t,this._partTree.id,r]));return n}async setComponentAttributes(e){const t=widget.enopadViewer,r=t&&t.getController();if(e._instance=this._partInfo&&e._pid&&this._partInfo[e._pid]["ds6w:label"],e._refid=this._partInfo&&e._pid&&this._partInfo[e._pid].to,e._reference=this._partInfo&&e._refid&&this._partInfo[e._refid]["ds6w:label"],e._instance&&!e._instance.trim().length?e._name=e._reference:e._name=e._reference+" ("+e._instance+")",e.SetIsMesh(!0),this._partInfo)for(const t in this._partInfo){const n=this._partInfo[t];if(n&&"VPMRepInstance"===n["ds6w:type"]&&n.from===e._refid){const t=this._partInfo[n.to];e._thumbURL=t&&(t.mythumbnail2d||t.urlstream||t["2dthb"])}}if(!r&&e._pid){let t=e.QueryInterface("W3AISGNodeHolder");t&&t.getPathElement()&&t.getPathElement().getLastElement()&&!t.getPathElement().getLastElement().productType&&this._partInfo&&this._partInfo[e._pid]&&this._partInfo[e._pid]["ds6w:type"]&&(t.getPathElement().getLastElement().productType=this._partInfo[e._pid]["ds6w:type"])}if(this._materials_info&&this._materials_info.materials_overload){for(const t of this._materials_info.materials_overload){const r=this._partInfo[t.path[0]];if(!r)continue;const a=1===t.path.length?r.resourceid:r.from;a===e._refid?(e._MaterialDescription={physicalID:t.material,connectedTo:"ref"},e._envID=n.EnvironmentalId.PLM):a===e._pid&&(e._MaterialDescription&&"ref"===e._MaterialDescription.connectedTo||(e._MaterialDescription={physicalID:t.material,connectedTo:"inst"},e._envID=n.EnvironmentalId.PLM))}e._MaterialDescription&&await e._experienceBase.getManager("VCXMaterialManager").createInternalMaterial(e._MaterialDescription,[e],this._materials_info&&this._materials_info.materialMap)}}static getInstRefTreeFromReference(e,t){const n=new i(t,e);return n.instances={},e.tos&&e.tos.forEach(e=>{const r=o.getInstRefTreeFromReference(e.toObj,t),a=new i(t,e);r.setParent(a),a.setParent(n),a.reference=r,n.instances&&(n.instances[e.resourceid]=a)}),n}static getInstRefTreeNodeModelFromReference(e,t){const n=new a({label:e["ds6w:label"],grid:{tree:e["ds6w:label"],pid:e.resourceid,type:e["ds6w:type"]}});return e.tos&&e.tos.forEach(e=>{const r=new a({label:e["ds6w:label"],grid:{tree:e["ds6w:label"],pid:e.resourceid,type:e["ds6w:type"]}});return r.addChild(o.getInstRefTreeNodeModelFromReference(e.toObj,t)),t&&t.materials_overload.forEach(n=>{if(n.path[0]===e.resourceid){const e=t.materialMap[n.material];if(e){const t=new a({label:e["ds6w:label"],grid:{tree:e["ds6w:label"],pid:n.material,type:e["ds6w:type"]}});r.addChild(t)}}}),n.addChild(r),n}),t&&t.materials_overload.forEach(r=>{if(r.path[0]===e.resourceid){const e=t.materialMap[r.material];if(e){const t=new a({label:e["ds6w:label"],grid:{tree:e["ds6w:label"],pid:r.material,type:e["ds6w:type"]}});n.addChild(t)}}}),n}}return o}),define("DS/VCXWebComposer/VCXCAT3DXModelManager",["DS/CoreEvents/Events","UWA/Class","DS/VCXWebIO/VCXLogServices","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties","DS/VCXWebKernelCommands/VCXCmdGoToScenario","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdChangeSequence","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebComposer/VCXLoadServices","DS/VCXWebPlatform/VCX3DSpaceServices","DS/CAT3DExpModel/CAT3DXModel","DS/WebComponentModeler/WebComponentBase","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebComposer/VCXProductIndex","DS/Visualization/IdPath","i18n!DS/VCXWebEWS/assets/nls/VCXWebEWS"],function(e,t,n,r,a,i,o,s,c,p,l,C,g,d,u,h,m,M){"use strict";let f=t.extend({initialize:function(){l.Initialize(this._experienceBase)},postInitialize:function(){this.products=[],this.event_VCX_PRODUCT_ADDED=e.subscribe({event:"VCX_PRODUCT_ADDED"},e=>{e&&e.product&&(this.products[e.product.GetID()]=e.product)}),this.event_VCX_PRODUCT_PREREMOVE=e.subscribe({event:"VCX_PRODUCT_PREREMOVE"},e=>{e&&e.product&&delete this.products[e.product.GetID()]})},getVersion:function(){return"1.0.1"},getInitPhase:function(){return 3},unInitialize:function(){l.UnInitialize(),this.products=[],e.unsubscribe(this.event_VCX_PRODUCT_ADDED),delete this.event_VCX_PRODUCT_ADDED,e.unsubscribe(this.event_VCX_PRODUCT_PREREMOVE),delete this.event_VCX_PRODUCT_PREREMOVE},getProducts:function(){return this.products},GetCAT3DXModel:function(){return g},LoadProduct:async function(t){let n,r={},a=this._experienceBase.getManager("VCXExperience");if(a&&a.updateLogData&&(r=a.updateLogData),!t)throw new Error("Missing product Actor");const i=this._experienceBase.getManager("VCXContextManager");if(i&&i.isSupported("VCXProductIndexSupport")&&(n=await t.QueryInterface("CATI3DXAssetProperties").getPhysicalId(),t.name=n,!t.productIndex)){const e=await C.Get3DSpaceURL(),r=await C.GetPreferredSecurityContext(),a="ctx::"+r.role+"."+r.organization+"."+r.collabspace;t.productIndex=new h(n),await t.productIndex.fetch(e,a,t)}var o=t.QueryInterface("VCXIModelNavigable"),s=i.getRootComponent().QueryInterface("VCXIModelNavigable");o.setParent(s),o.getChildren()&&o.getChildren().length||l.buildNavigableFromActorAsset(t);let c=this.QueryInterface("VCXILoadHelper")._AddProductAndUpdate(t,r);e.publish({event:"VCX_PRODUCT_ADDED",data:{product:t}});let p=this._experienceBase.getManager("VCXNotificationManager"),g=18;widget&&widget.enopadViewer&&(g=2);let d={strObjectType:M["ProgressNotification.ProductStructure"],maskDisplayAdd:g,iPromise:c};p.addProgressNotification(d),await c;const u=t.QueryInterface("VCXIModelNavigable"),m=[];u.traverse(e=>{const n=e.GetObject();m.push(l.setComponentAttributes(n,t))});let f=Promise.all(m),V={strObjectType:M["ProgressNotification.SetComponentAttributes"],maskDisplayAdd:2,iPromise:f};if(p.addProgressNotification(V),await f,console.log("==================== LoadAndApplyMaterial"),!t.productIndex){let e=this.QueryInterface("VCXILoadHelper")._LoadMaterial(t),n={strObjectType:M["ProgressNotification.Materials"],maskDisplayAdd:g,iPromise:e};p.addProgressNotification(n),await e}},RetrieveExperienceFromServer:async function(){let e=await this._experienceBase.getManager("VCXEWSManager").IsExperienceStarted();if(e.isExperienceStarted){if(this._experienceBase.getManager("VCXContextManager").isSupported("SessionRecover")){let t=null;"simulatePlayMode"===localStorage.getItem("DS_PRODUCTHIGHLIGHT_OPEN_PLAY")&&(widget.simulatePlay=!0),t=this._experienceBase.getManager("VCXNotificationManager").addProgressNotification({strAction:M["ProgressNotification.Recovering"],strObjectName:e.experienceName,maskDisplayAdd:18});try{let e=await g.RetrieveExperienceFromServer();if(!e)throw new Error("No Experience Object");{if(localStorage.getItem("xHighlight_LPR_Material")){let e=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceComposer").filter(e=>e.QueryInterface("CATI3DExperienceObject").GetValueByName("materials").length>0);for(let t of e)t&&await g.ApplyMaterial(t,null)}await this._LoadExperienceModel(e),this._experienceBase.getManager("VCXNotificationManager").endProgressNotification(t,!0);let n=this._experienceBase.getManager("VCXGUIManager").getGettingStartedUI();n&&n.endLoadingExperience()}}catch(e){throw console.error(e),this._experienceBase.getManager("VCXNotificationManager").addNotification({level:"error",title:M["Notification.Error"],message:M["Notification.Recovering.Message"]}),new Error(e)}}}},_LoadExperienceModel:async function(e){if("true"===localStorage.getItem("EWS_AuthoringV2")&&e){e.QueryInterface("CATI3DExperienceObject").GetValueByName("scenariosKF")[0].QueryInterface("CATI3DXJSONProcessor").Process()}let t={},n=this._experienceBase.getManager("VCXExperience");n&&(t=n.updateLogData={}),t.newOverides=[],t.deletedOverides=[],t.deletedMaterials=[],t.deletedAmbiences=[],t.impactedComponents={},t.impactedComponentsInverted={},t.hasImpactOnScenario=!1;let r=this._experienceBase.ComponentsMap.GetComponentFromType("Model_VPMReference_Spec");0===r.length&&(r=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentVPMReference"));let a=[];if(0!==r.length)for(let e=0;e<r.length;e++){let t=r[e];a.push(this.LoadProduct(t))}await UWA.Promise.all(a);let i=this._experienceBase.getManager("VCXNotificationManager").addProgressNotification({maskDisplayAdd:18});await this.OnEndLoading(!1,{products:r}),this._experienceBase.getManager("VCXNotificationManager").endProgressNotification(i,!0)},OnEndLoading:async function(t,r){const a={onAssetAdded:n.generateUUID(),createDressupsBases:n.generateUUID(),CreateEnvironnementObjects:n.generateUUID(),initActorDocManager:n.generateUUID(),initFromResourcesManager:n.generateUUID(),EndLoadingDressups:n.generateUUID(),EndLoadingViewpoints:n.generateUUID(),GetNeutralsFromVariables:n.generateUUID(),OnEndLoadingShared:n.generateUUID()};let i=this._experienceBase.getManager("VCXContextManager");i.partHasMoved=!0;let o=this._experienceBase.getManager("VCXExperience");if(o._endLoadingDone){n.memoryLog("onAssetAdded",!0,a.onAssetAdded);let i=[];if(t&&r){for(let t in r)if(r.hasOwnProperty(t)){let n=r[t];"products"===t&&e.publish({event:"VCX_ASSETS_ADDED",data:n});for(let e=0;e<n.length;e++){n[e].QueryInterface("VCXIModelNavigable").traverse(e=>{i.push(e.GetObject())})}}l.GetNeutralsFromVariables(i);const t=this._experienceBase.getManager("VCXScenarioManager");i.forEach(e=>{"Model_VPMReference_Spec"!==e.componentType&&t.ConsiderNewComponent(e)})}return void n.memoryLog("onAssetAdded",!1,a.onAssetAdded)}if(r)for(let e in r)if(r.hasOwnProperty(e)){let t=r[e];if("products"===e){const e=this._experienceBase.getManager("VCXScenarioManager");for(let n=0;n<t.length;n++){let r=t[n];if(r.productIndex&&i&&i.isSupported("VCXCreateOverridesOnDemand")&&i.isSupported("VCXCreateOverridesOnDemand")&&i.isSupported("VCXCreateLocalActors")){const t=[];r.productIndex.traverseTree(n=>{if("VPMInstance"===n.type){const a=n.getPathOfIDs();if(a){const i=this._experienceBase.ComponentsMap.GetComponentFromExternalPath(a,!0);if(i)n.component=i;else{if(n.component=this._experienceBase.Factory.BuildComponent("VCXVolatileComponentOccurrenceComposer"),n.component.SetPersistency(d.EPersistencyType.notPersistent),n.component._pid=n.id,n.component.QueryInterface("W3AISGNodeHolder").setPathOfIDs(new m(a)),n.parent&&n.parent.parent&&n.parent.parent.component){n.component.QueryInterface("VCXIModelNavigable").setParent(n.parent.parent.component.QueryInterface("VCXIModelNavigable"))}else{n.component.QueryInterface("VCXIModelNavigable").setParent(r.QueryInterface("VCXIModelNavigable"))}this._experienceBase.ComponentsMap.AddComponent(n.component),t.push(r.productIndex.setComponentAttributes(n.component)),e.ConsiderNewComponent(n.component)}}}});let n=Promise.all(t);await n}}}}let s=18;widget&&widget.enopadViewer&&(s=2);let c=this._experienceBase.getManager("VCXNotificationManager"),p=c.addProgressNotification({strObjectType:M["ProgressNotification.Dressups"],maskDisplayAdd:s});n.memoryLog("createDressupsBases",!0,a.createDressupsBases),this._experienceBase.getManager("VCXDressupManager").createDressupsBases(),n.memoryLog("createDressupsBases",!1,a.createDressupsBases),n.memoryLog("CreateEnvironnementObjects",!0,a.CreateEnvironnementObjects),await this.CreateEnvironnementObjects("VCX"),n.memoryLog("CreateEnvironnementObjects",!1,a.CreateEnvironnementObjects);let C=c.addProgressNotification({strObjectType:M["ProgressNotification.DocManager"],maskDisplayAdd:s});n.memoryLog("initActorDocManager",!0,a.initActorDocManager),t&&await this._experienceBase.getManager("VCXDocManager").initActorDocManager(),n.memoryLog("initActorDocManager",!1,a.initActorDocManager),n.memoryLog("initFromResourcesManager",!0,a.initFromResourcesManager),t||this._experienceBase.getManager("VCXContextManager").IsLocalMode()&&!this._experienceBase.getManager("VCXContextManager").getUseResourcesManager()||await this._experienceBase.getManager("VCXDocManager").initFromResourcesManager(),n.memoryLog("initFromResourcesManager",!1,a.initFromResourcesManager),this._experienceBase.getManager("VCXNotificationManager").endProgressNotification(C),n.memoryLog("EndLoadingDressups",!0,a.EndLoadingDressups),o.EndLoadingDressups(),n.memoryLog("EndLoadingDressups",!1,a.EndLoadingDressups),n.memoryLog("EndLoadingViewpoints",!0,a.EndLoadingViewpoints),o.EndLoadingViewpoints(),n.memoryLog("EndLoadingViewpoints",!1,a.EndLoadingViewpoints),n.memoryLog("GetNeutralsFromVariables",!0,a.GetNeutralsFromVariables),l.GetNeutralsFromVariables(),n.memoryLog("GetNeutralsFromVariables",!1,a.GetNeutralsFromVariables),n.memoryLog("OnEndLoadingShared",!0,a.OnEndLoadingShared);let g=await this.OnEndLoadingShared(t);if(n.memoryLog("OnEndLoadingShared",!1,a.OnEndLoadingShared),this._experienceBase.getManager("VCXNotificationManager").endProgressNotification(p),t){let t=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();e.publish({event:"VCX_UPDATE_THUMBNAIL",data:{scenarioID:t}})}new Promise(async()=>{await this._experienceBase.getManager("VCXExperience").getAllActorsReadiness(),e.publish({event:"VCX_END_LOADING"})});return g},OnEndLoadingShared:async function(t){let a=this._experienceBase.getManager("VCXExperience"),l="",C=this._experienceBase.getManager("VCXScenarioManager").QueryInterface("VCXIModifiable");if(t){if(this._experienceBase.getManager("VCXGUIManager").InitGUI(),0===this._experienceBase.getManager("VCXSequenceManager").GetListSequencesFromType(0).length){let e=this._experienceBase.Factory.BuildComponent("VCXScenarioSequence");e.SetName("Sequence 1");let t=e.QueryInterface("VCXIModifiable"),n=new r(this._experienceBase.getManager("VCXScenarioManager"));n.CaptureNeutralProperties(t),this._experienceBase.getManager("VCXCommandManager").Do(n);let a=new o(this._experienceBase.getManager("VCXSequenceManager"),this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap);a.PushSequence(e),this._experienceBase.getManager("VCXCommandManager").Do(a)}l=(await a.CreateNewScenario(!0)).GetID();let e=new p(l),t=new s(new c("ScenarioManager.startScenarioId",2),e),n=new i(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.getManager("VCXCommandManager"),!0);n.ChangeProperty(C,t),this._experienceBase.getManager("VCXCommandManager").Do(n)}else{let e=n.generateUUID();n.memoryLog("RestoreNeutralProperties",!0,e),this._experienceBase.getManager("VCXScenarioManager").RestoreNeutralProperties(),n.memoryLog("RestoreNeutralProperties",!1,e),this._experienceBase.getManager("VCXGUIManager").InitGUI()}await a.InitImagePanels(),this._experienceBase.getManager("VCXGUIManager").RefreshGUI(),this._experienceBase.getManager("VCXPaperManager").updatePaper({propagateEvent:!0});let g=n.generateUUID();if(n.memoryLog("VCXGUIManager setUpTrees",!0,g),this._experienceBase.getManager("VCXGUIManager").setUpTrees(),n.memoryLog("VCXGUIManager setUpTrees",!1,g),this._experienceBase.getManager("VCXContextManager").getPlayerMode()||this._experienceBase.getManager("VCXScenarioManager").SetAutoKey(!0),console.log("VCXExperience::OnEndLoading end"),setTimeout(()=>{document.querySelector("div.wux-windows-immersive-frame").dispatchEvent(new Event("resize"))},500),this._experienceBase.getManager("VCXGUIManager").getGettingStartedUI().endLoadingExperience(),l=C.GetProperty("ScenarioManager.startScenarioId").GetPropertyValue().GetValue(),!this._experienceBase.ComponentsMap.GetComponentFromID(l)){let e=this._experienceBase.getManager("VCXSequenceManager").GetListSequences();if(e.length){let t=e[0].GetListScenariosId();if(t.length){l=t[0];let e=new s(new c("ScenarioManager.startScenarioId",2),new p(l)),n=new i(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.getManager("VCXCommandManager"),!0);n.ChangeProperty(C,e),this._experienceBase.getManager("VCXCommandManager").Do(n)}}}this._GoToPreferredSceneAtStart(l),e.publish({event:"VCX_END_LOADING_DONE"})},_GoToPreferredSceneAtStart:function(e){if(e){let t=n.generateUUID();n.memoryLog("GoToScenario",!0,t);let r=new a(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.getManager("VCXCommandManager"));r.GoToScenario(e),this._experienceBase.getManager("VCXCommandManager").Do(r),n.memoryLog("GoToScenario",!1,t)}},ApplyMaterial:function(e,t,n){let r=e.GetCurrentMaterial();r&&r.QueryInterface("VCXIMaterialCache")&&r.QueryInterface("VCXIMaterialCache").removeComponentFromWhereApplied(e.GetID()),e.PLMMaterialID=t?t.GetID():"";let a=e.GetCurrentMaterial();a&&a.QueryInterface("VCXIMaterialCache")&&a.QueryInterface("VCXIMaterialCache").addComponentFromWhereApplied(e.GetID());let i=[],o=e._experienceBase.getManager("VCXContextManager");t&&t.QueryInterface("CATI3DXAssetProperties")?i.push((async()=>{e.PLMMaterial=await t.QueryInterface("VCXIMaterialCache").getMaterialVisu(),e.PLMMaterialID===(t?t.GetID():"")&&(e.PLMMaterial.force=!0,o.useTraverseGraph?o.traverseGraphMustBePerformed=!0:(e.OverrideMaterial(e.PLMMaterial,e.localColorIsDefined?e.localColor:null,null,!1),e.setDirtyFlag(u.FDirty.Material,!1)),o.renderAll(),o=null)})()):(e.PLMMaterial=null,o.useTraverseGraph?o.traverseGraphMustBePerformed=!0:(e.OverrideMaterial(null,e.localColorIsDefined?e.localColor:null,null,!1),e.setDirtyFlag(u.FDirty.Material,!1)),o.renderAll(),o=null,i.push(UWA.Promise.resolve())),(n||window.iApplyOnServer)&&i.push(g.ApplyMaterial(e,t));let s=UWA.Promise.all(i),c=e.QueryInterface("VCXIReadiness");return c&&c.registerPromise(s),s},InsertAmbience:function(e,t,n){throw new Error("Not implemented here")},InsertMaterial:function(e,t,n,r){throw new Error("Not implemented here")},InsertProduct:async function(e,t,n){throw new Error("Not implemented here")},LoadAndApplyMaterialRec:async function(e){},Get3DSpaceOptionsForFactory:async function(e){if(this._experienceBase.getManager("VCXContextManager").IsLocalMode()||this._experienceBase.odt||"true"===this._experienceBase.getManager("VCXContextManager").getUrlVars().tstProvider)return{role:"FakeRole",organization:"FakeOrganization",collabSpace:"FakeCollabSpace",force:1};if(e){let t={};if("string"==typeof e){let n=e.split(".");t.role=n[0],t.organization=n[1],t.collabspace=n[2]}else t=e;return{role:t.role,organization:t.organization,collabSpace:t.collabspace,force:1}}throw new Error("Security context missing.")},LoadExperienceFromPhysicalID:async function(e,t,n){let r=await this.Get3DSpaceOptionsForFactory(n),a=new Promise(async(t,n)=>{try{let a=await this.GetCAT3DXModel().LoadExperience(e,r);await this._LoadExperienceModel(a),t(a)}catch(e){n(e)}});return this._experienceBase.getManager("VCXNotificationManager").addProgressNotification({strAction:M["ProgressNotification.Loading"],strObjectName:t,maskDisplayAdd:18,iPromise:a,isLastStep:!0}),a},CreateExperience:async function(e,t){if(g.GetExperience())return g.GetExperience();e||(e="NewExperience");let n=this.GetScenarioType();if(!n)throw new Error("The experience scenario type is not defined");let a=await this.Get3DSpaceOptionsForFactory(t),i=await g.CreateExperience(e,n,a);if(i){i.SetPersistency(1);let t=i.QueryInterface("VCXIModifiable"),n=new p(e);t.OnChangeProperty("Actor.Name",n);let a=new r(this._experienceBase.getManager("VCXScenarioManager"));return a.CaptureNeutralProperties(t),this._experienceBase.getManager("VCXCommandManager").Do(a),localStorage.setItem("DS_PRODUCTHIGHLIGHT_OPEN_PLAY","authoringMode"),i}throw new Error("create 3DX experience failed")},CreateEnvironnementObjects:async function(e){const t={"Create VCXViewport_Spec":n.generateUUID(),"Create CXPCameraActor_Spec":n.generateUUID(),"Create VCXPartList_Spec":n.generateUUID(),"Create CameraBe_Spec":n.generateUUID(),"AddDressups(createdDressups)":n.generateUUID()};let r=this._experienceBase.getManager("VCXContextManager").getRootComponent();if(!r)throw new Error("Missing experience root.");let a=[];if(0===this._experienceBase.ComponentsMap.GetComponentFromType("VCXViewport_Spec").length){n.memoryLog("Create VCXViewport_Spec",!0,t["Create VCXViewport_Spec"]);let e=await this.CreateActor("VCXViewport_Spec","Viewport",r);if(n.memoryLog("Create VCXViewport_Spec",!1,t["Create VCXViewport_Spec"]),!e)throw new Error("Actor viewport not built !");a.push(e)}if(0===this._experienceBase.ComponentsMap.GetComponentFromType("CXPCameraActor_Spec").length){n.memoryLog("Create CXPCameraActor_Spec",!0,t["Create CXPCameraActor_Spec"]);let i=await this.CreateActor("CXPCameraActor_Spec","Camera",r);if(n.memoryLog("Create CXPCameraActor_Spec",!1,t["Create CXPCameraActor_Spec"]),!i)throw new Error("Actor camera not built !");a.push(i),n.memoryLog("Create CameraBe_Spec",!0,t["Create CameraBe_Spec"]),await this.CreateBehavior(e+"CameraBe_Spec","ComposerCamBe",i),n.memoryLog("Create CameraBe_Spec",!1,t["Create CameraBe_Spec"]),this._experienceBase.getManager("VCXContextManager").setActiveCamera(i)}if(0===this._experienceBase.ComponentsMap.GetComponentFromType("VCXPartList_Spec").length&&this._experienceBase.getManager("VCXContextManager").isSupported("PartList")){n.memoryLog("Create VCXPartList_Spec",!0,t["Create VCXPartList_Spec"]);let e=await this.CreateActor("VCXPartList_Spec","PartList",r);if(n.memoryLog("Create VCXPartList_Spec",!1,t["Create VCXPartList_Spec"]),!e)throw new Error("Actor Part List not built !");a.push(e)}n.memoryLog("AddDressups(createdDressups)",!0,t["AddDressups(createdDressups)"],{N:a.length,parameterName:"dressup"});let i=await this._experienceBase.getManager("VCXDressupManager").AddDressups(a);return n.memoryLog("AddDressups(createdDressups)",!1,t["AddDressups(createdDressups)"],{N:a.length,parameterName:"dressup"}),i},GetSecurityContext:function(){return g.GetSecurityContext()},RestoreAuthoringVariableValues:function(){return g.RestoreAuthoringVariableValues()},CreateBehavior:function(e,t,n){return g.CreateBehavior(e,t,n)},CreateActor:function(e,t,n){return g.CreateActor(e,t,n)},DeleteActor:function(e){if(!e.IsKindOf("AmbienceModel_Spec"))return g.DeleteActor(e);if("replay"===this._experienceBase.odt)return g.DeleteAmbience(e);if(this._experienceBase.ComponentsMap.GetComponentFromID(e.GetID()))return g.DeleteAmbience(e)},CreateCityActorInternal:function(e,t,n,r){return g.CreateCityActorInternal(e,t,n,r).then().catch(e=>{console.log("the command failed ! ")})},RegisterExternalLoader:function(e,t){let n=this._experienceBase.getManager("CAT3DXLoaderManager");n&&n.registerLoader(e,t)},IsDocumentSupported:function(e){return new UWA.Promise((t,n)=>{let r=this._experienceBase.getManager("CAT3DXLinkManager").getLinkContextFromDataTransfer(e);if(!r)return n(new Error("Link context not found"));this._experienceBase.getManager("CAT3DXLoaderManager").getLoadableTypes(r).then(e=>{if(!e.length){let e=new Error("Document not supported");return e.criticity="Warning",n(e)}t()})})},LoadLinkFromCollabSpace:function(e){let t=this._experienceBase.getManager("CAT3DXLinkManager").getLinkContextFromDataTransfer(e);if(t){let e=this.getExternalTypes();return this._experienceBase.getManager("CAT3DXLoaderManager").loadLink(t,e)}throw new Error("Loader not found")}});return Object.defineProperty(f.prototype,"componentType",{enumerable:!0,get:()=>"VCXCAT3DXModelManager"}),f});