/*!  COPYRIGHT DASSAULT SYSTEMES 2016   */
define("DS/ENOPAD_v2/models/mixins/PADDocProxy",["UWA/Core","DS/PADServices/utils/Generics","DS/PADServices/utils/Iterator","DS/ENXNav/models/NodeUtils","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/GlobalUtils","DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/modules/common/Constants","DS/ENOXParser/modules/TwoDParser","DS/PADUtils/views/PADAlert","DS/PADUtils/PADSession","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,i,o,s,r,a,d,l,c,u,p){"use strict";const g="insertExisting",h="detach",f="reParent",v="replaceInstances",D="updateRevision",m="TitleInfo";function P(){}return P.prototype={_appendToCommandProxy:function(){if(this._cmdProxy){let e={events:{onRefresh:this._onRefresh.bind(this),onPadRefresh:this._onPadRefresh.bind(this)}};this._cmdProxy.addProxyEvents(e)}},_handleSplitAndRefresh:function(e){if(e&&e.modified&&e.created){for(var t,n=[],i={},o=0;o<e.modified.length;o++)t={oldId:e.modified[o].physicalid,newId:e.created[o].physicalid},n.push(t);i.couples=n,i.cb=e.cb,this.splitInstance(i)}else console.warn("refreshInstance: no input")},_onRefresh:function(e){let i=this,o=this.options.context;if(t.checks.array(e.authored.modified)&&o.options.isDeEnabled&&o.hasActiveDesignExp()&&o.options.is3dExcite&&o.getActiveDesignExp().getID()==e.authored.modified[0])return o.getPseService().updateDesignExpTitle(e.authored.modified[0]),!1;if((t.checks.array(e.authored.created)||t.checks.array(e.authored.modified))&&(e.authored.originWidgetId&&e.authored.originWidgetId===r.getWidgetId()||this.refreshNodeById({created:e.authored.created,modified:e.authored.modified})),t.checks.array(e.authored)&&e.authored.length&&e.authored[0].previous)for(var a=0;a<e.authored.length;a++){var d=e.authored[a].previous,l=e.authored[a].modified;if(d!==l){var c={modified:[{physicalid:d}],created:[{physicalid:l}]};i._handleSplitAndRefresh(c)}}if(t.checks.array(e.authored.deleted)){var u=[],p=[];n.iterate(e.authored.deleted,function(e){var t=i.getNodesById(e);n.iterate(t,function(t){-1===p.indexOf(e)&&p.push(e)}),u=u.concat(i.getNodesById(e))}),i.deleteNodes(u,!0),s.publish({event:"ENXViews/WelcomePanel/cleanup",data:{item2remove:e.authored.deleted}})}},_onPadRefresh:function(e){if(!0===o.getSetting("activateFUN076708")){var t=this,i=function(n){var i=Object.getOwnPropertyNames(n);for(var o in i){let s=i[o];switch(s){case g:e.origin&&"CCP"===e.origin||(n.insertExisting&&n.insertExisting.modified&&n.insertExisting.created&&n.insertExisting.inserted?t._viewInsertExisting(n.insertExisting):console.warn("onPadRefresh missing insertExisting "+s));break;case h:n.detach&&n.detach.deleted?t._viewDetach(n.detach):console.warn("onPadRefresh missing detach "+s);break;case f:t._viewReParent(n.reParent);break;case v:t.splitInstance(n.replaceInstances);break;case m:break;case D:t.updateRevision(n);break;default:console.warn("onPadRefresh unknown "+s)}}};e.transactions?n.iterate(e.transactions,function(e){i(e)}):i(e),o.getSetting("activateAutoSwitchAuthoringToIndex")&&u.determineAuthoredFlag()&&u.setAuthoringState(!0)}},_viewDetach:function(e){var t=this;let i=e.deleted.map(function(e){return t.getNodesByRelId(e)}).reduce(function(e,t){return e=e.concat(t)},[]);this.withTransactionUpdate(function(){n.iterate(i,function(e){let t=e.getParent();t&&t.removeChild(e)})})},_viewReParent:function(e){this._viewInsertExisting(e),this._viewDetach(e)},_viewInsertExisting:function(e){},_viewSplitInstance:function(t){var n=this;function i(e){if(!e.hasChildren())return e.getDepth();var t=1;return e.getChildren().forEach(function(e){var n=i(e);n>t&&(t=n)}),t}var s,a,d,l,c,u,p,g,h=[],f=[],v=[];this._insertFlag=!0,this.withTransactionUpdate(function(){try{for(var o=0;o<t.couples.length;o++){var r=n.getNodesByRelId(t.couples[o].oldId);if(r&&r.length>0)for(var D=0;D<r.length;D++)if(s=r[D]){if((g=s.getOccurencePath())&&g.length&&h.push(g),s.isExpanded()){var m=i(s)-s.getDepth();m=parseInt(m),v.push(m)}if(f.push(s.getRelationID()),d=s.getParent()){l=d.getChildren(),a=s.options.relationtype,c=l.indexOf(s)+1,u=e.clone(s.options,!1);var P=e.clone(s.options.grid,!1);u.grid=P,u.children&&(u.children=[]),u.relationid=t.couples[o].newId,(p=n.createNodeModel(u)).setRelationID(t.couples[o].newId,a),f.push(t.couples[o].newId),c===l.length?d.addChild(p):t.editVariant?d.insertBefore(p,s):d.insertBefore(p,l[c]),d.isExpanded()||d.options.padstate&&"partiallyExpanded"===d.options.padstate||(d.setState({state:"partiallyExpanded"}),d.options.padstate="partiallyExpanded"),p.isSelected()||p.select(),s.isSelected()&&s.unselect(),(g=p.getOccurencePath())&&g.length&&h.push(g)}}}}catch(e){console.error("error >>:",e)}finally{console.info("splitInstance done")}}),n.invalidateViewPort();var D=o.getSetting("modelOcc")||"true"===r.getURLParameter("modelOcc");t.editVariant&&n.updateInstance({occurencePaths:h,expandStates:v,newRelIds:f,editCfg:!0,isOccModel:D}),t.cb&&t.cb({occurencePaths:h,expandStates:v,newRelIds:f,isOccModel:D})},splitInstance:function(t){var n=this;t.editVariant||t.cb||(t.cb=function(t){e.is(n.updateInstance,"function")&&n.updateInstance(t)}),this._viewSplitInstance(t)}},P}),define("DS/ENOPAD_v2/mixins/_PADRefresh",["UWA/Class","DS/PADUtils/PADSettingsMgt"],function(e,t){"use strict";var n=n=e.extend({});return!0!==t.getSetting("refresh_v2")&&(n.prototype.refresh=function(e){e=void 0===e||e,require(["DS/ApplicationFrame/CommandsManager"],function(e){e.getCommand("Uncut").begin()}),e&&this._commandProxy.refreshModel();var n=this.getPADTreeListView(),i=this.getPADDGVView();i.options.shouldClearSort=!1,i&&i.removeFilterView();let o=Promise.resolve();t.getSetting("staticMappingEnabled")&&"2.0"===this.getPADTreeDocument().version&&(o=this.options.model.triggerExcludePathsUpdate());let s,r={treelist:n,datagrid:i,dispatch:!1},a=this.getPADTreeDocument();s=a.refresh.bind(a),o.then(()=>{s(r)})}),n}),define("DS/ENOPAD_v2/commands/edit/_Uncut",["UWA/Class"],function(e){"use strict";return{execute:function(e){e.context.uncut()}}}),define("DS/ENOPAD_v2/utils/PADCtxMenuUtilsV2",["i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","DS/WebappsUtils/WebappsUtils","DS/PADUtils/PADClipboard","DS/ENXNav/utils/CtxMenuUtilsV2"],function(e,t,n,i){"use strict";var o={RESETPOS:"url("+t.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_ResetPosition.png")+")",COPYRELPOS:"url("+t.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_CopyPosition.png")+")",PASTEPOS:"url("+t.getWebappsAssetUrl("ENOPAD_v2","icons/32/I_PastePosition.png")+")"};return i.psePositionCtxCmd=function(t,i){var s,r,a={available:!1,menu:[]};if(!i.collectionView)return a;if(s=i.cellInfos.nodeModel,r=i.cellInfos,!1===s.isRoot()){s.isSelected()||s.select(!0),a.available=!0;for(var d=t.getSelectedNodes(),l=!1,c=0;c<d.length&&!1===l;c++)d[c].options.grid["positionMatrix-Instance"]&&(l=!0);l&&(a.menu.push({type:"PushItem",title:e.PAD_CMDResetPosition,icon:o.RESETPOS,state:t.getEditMode()?"enabled":"disabled",action:{this:this,context:{node:s,cellInfos:r},callback:function(e){t.resetPosition()}}}),1===d.length&&a.menu.push({type:"PushItem",title:e.PAD_CMDCopyRelativePosition,icon:o.COPYRELPOS,state:t.getEditMode()?"enabled":"disabled",action:{this:this,context:{node:s,cellInfos:r},callback:function(e){var t={matrix:e.context.node.options.grid["positionMatrix-Instance"]};n.setData(n.POSITION,t)}}})),!1===n.isEmpty(n.POSITION)&&("VPMInstance"===s.options.relationtype||""===s.options.relationtype&&"3DShape"!==s.options.type&&"Drawing"!==s.options.type)&&a.menu.push({type:"PushItem",title:e.PAD_CMDPastePosition,icon:o.PASTEPOS,state:t.getEditMode()?"enabled":"disabled",action:{this:this,context:{node:s,cellInfos:r},callback:function(e){t.pastePosition()}}}),0===a.menu.length&&a.menu.push({type:"PushItem",title:e.PAD_CMDNoPositionAction,state:"disabled"})}else a.isRoot=!0;return a},i}),define("DS/ENOPAD_v2/features/AutoSwitchAuthoringToIndex",["DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADSession","DS/PADUtils/PADSettingsMgt","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/ENXNav/utils/TwoDAppEvents","DS/PADUtils/views/PADAlert","DS/PADServices/utils/PConfigUtils"],function(e,t,n,i,o,s,r,a){"use strict";function d(e){this.options=e,this.__timeoutToken,this.__setup()}return d.prototype={__setup:function(){var e=this;t.subscribe({event:"ENXApp/SettingsModification/onSwitchAuthoringToIndex"},this.__setWaitPeriodForSwitch.bind(this)),widget.addEvent("onUseIndexPrefClick",this.__onUseIndexPrefClick.bind(this)),widget.addEvent("endEdit",function(t){!1===t.submitted&&e.__onUseIndexPrefClick("",widget.getPreference("useIndexAccleration").value,!1)});var o=widget.getPreference("useIndexAccleration").value;this.__onUseIndexPrefClick("",o,!1),i.addEvent("onUseIndexAccleration",function(e){this.__onUseIndexPrefClick("",e,!1)}.bind(this)),n.subscribe({event:"applySwitchTimeout"},this.__setWaitPeriodForSwitch.bind(this)),!a.isMultiRootSupported()&&s.onAddRoot(this.__removePConfigSupportInAuthForMultiRoot.bind(this))},__setWaitPeriodForSwitch:function(t,i=!0){let s=widget.getPreference("switchAuthoringToIndex")?widget.getPreference("switchAuthoringToIndex"):null,r=t.prefValue?t.prefValue:s.value,a=s.options.filter(e=>e.value==r)[0].label;a=o[a]?o[a]:a;let d={title:o.PADSession_enabling_index_after_auto_switch_title,msg:o.replace(o.get("PADSession_enabling_index_after_auto_switch_msg"),{timeInterval:a})};if(n.determineAuthoredFlag()&&r&&0!=r){let o=!!t.doPolling&&t.doPolling;i&&this.timeoutToken&&(console.log("previous timeout killed!!"),clearTimeout(this.timeoutToken),this.timeoutToken=null),this.timeoutToken=setTimeout(()=>{console.log("NEw timeout started"),o?e.isDataIndexed().then(e=>{e&&n.setAuthoringState(!1,d)}).catch(e=>{console.log(e)}):n._useIndexPreference&&n.determineAuthoredFlag()&&n.setAuthoringState(!1,d)},1e3*r)}0==r&&this.timeoutToken&&clearTimeout(this.timeoutToken)},__removePConfigSupportInAuthForMultiRoot:function(){var e=this.options.context.options.model.getRoots(),i=[];if(n.determineAuthoredFlag()&&e.length>1&&this.options.context.options.model.prodConfigSupportInAuth&&!a.isMultiRootSupported()){this.options.context.options.model.prodConfigSupportInAuth=!1;let n=e.filter(function(e){return e.validFilter&&e.keepFilterBadge});n.length&&(n.forEach(function(e){e.keepFilterBadge=!1,i.push(e.getID())}),i.length&&(r.displayNotification({msg:o.configFilterForMultiRoots,eventID:"info"}),this.options.context._biFilter.removeRoots(i),t.publish({event:"__removePConfigSupportInAuthForMultiRoot",data:i})))}},__onUseIndexPrefClick:function(e,t,n=!0){this.__addSwitchAuthoringToIndexPref(t),n&&widget.dispatchEvent("onEdit")},__addSwitchAuthoringToIndexPref:function(e){const t={name:"switchAuthoringToIndex",defaultValue:"0",type:"list",label:"switchAuthoringToIndexLabel",options:[{label:"one_minute",value:"60"},{label:"three_minutes",value:"180"},{label:"five_minutes",value:"300"},{label:"ten_minutes",value:"600"},{label:"manually",value:"0"}]};!1===e&&(t.disabled="true",widget.setValue("switchAuthoringToIndex","0")),widget.addPreference(t)}},d}),define("DS/ENOPAD_v2/utils/ReadWriteAccessController",["DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADCommandProxy","DS/PADServices/utils/GlobalModelEvents"],function(e,t,n){const i={icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-pencil"},label:"write"},o={icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-pencil-block"},label:"read"},s={icon:{iconClasses:""},label:"not root"};function r(){}var a;return r.prototype={determineReadOnlyIcon:function(e){return e.isRoot()?e.options.isReadOnly&&!0===e.options.isReadOnly?o:i:s}},a||(a=new r),a}),define("DS/ENOPAD_v2/models/mixins/PADDocReplace",["DS/PADServices/utils/Batches","DS/PADServices/utils/Generics","DS/ENXNav/utils/TwoDAppEvents","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json"],function(e,t,n,i){"use strict";function o(){}return o.prototype={replaceNodesOcc:function(o){let s=this;return new Promise((r,a)=>{let d=!1,l=!1;o.toInsert&&(o.toInsert.isProdConfig&&(d=!0,delete o.toInsert.isProdConfig),o.toInsert.noNotification&&(l=!0,delete o.toInsert.noNotification));let c=Object.keys(o.toInsert).map(e=>{let n=o.toInsert[e];return t.checks.array(n)?{start:e,array:n}:null}).filter(e=>null!==e),u={transactions:[]},p=[],g=c.reduce((e,t)=>{let n=t.array.map(e=>{let n=[...s.getNodesById(t.start)[0].getOccurencePath(),e.relationid,e.resourceid],i={insertExisting:{modified:[],inserted:[],created:[],withContext:!1}};return i.insertExisting.modified.push(t.start),i.insertExisting.inserted.push(n),i.insertExisting.created.push(e.relationid),u.transactions.push(i),e.ordering&&p.push({path:n,ordering:e.ordering}),n});return e=e.concat(n)},[]);s._beginBlockingTransaction(i.inserting_nodes);let h=e.breakup(g,1e3,1e3),f=e.stepper(h,{},function(e){s.wrappedAddPaths({paths:e}).then(()=>{f()}).catch(()=>{f()})},function(){let e=o.toDelete.map(e=>e.physicalid),t=e.reduce((e,t)=>{let n=s.getNodesByRelId(t);return e=e.concat(n)},[]);for(let e=0;e<t.length;e++){let n=t[e],i=n.getParent();"partiallyExpanded"!==i.getState()&&i.setState({state:"partiallyExpanded"}),n.remove()}let i={detach:{deleted:e}};s._cmdProxy.padRefresh(i),s._cmdProxy.padRefresh(u);for(let e=0;e<p.length;e++){let t=p[e],n=s.getNodeFromPath(t.path);if(n){let e=n.getParent(),i=t.ordering;if(i.before){let t=e.getChildren().filter(e=>e.options.relationid===i.before);t.length&&e.insertBefore(n,t[0])}if(i.after){let t=e.getChildren().filter(e=>e.options.relationid===i.after);t.length&&e.insertAfter(n,t[0])}"partiallyExpanded"!=e.getState()&&e.setState({state:"partiallyExpanded"})}}n.addChild(),s._endBlockingTransaction(),d&&s.bubbleStaticMapMessageOnce(),r()});f()})}},o}),define("DS/ENOPAD_v2/models/mixins/PADDocInsertsOcc",["DS/ENOXParser/modules/PADParserOcc","DS/ENOXParser/modules/ClientDataParser","DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/modules/common/Constants","DS/PADServices/utils/Generics","DS/PADServices/utils/Iterator","DS/PADServices/settings/AppSettings","DS/ENXNav/utils/TwoDAppEvents","DS/PADUtils/views/PADAlert","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,i,o,s,r,a,d,l,c){"use strict";function u(){}return u.prototype={insertNodes:function(e,n){this.unselectAll();let r=e.isProdConfig;delete e.isProdConfig;let u={docPtr:this,padRefreshData:{transactions:[]},insertedNodes:[],pathToFetch:[],rootNodesIds:[],rootNodes:[],objects:e,parentOccurencePaths:[],orderInfos:[]};!function(e){s.iterateObj(e.objects,function(n,i){if(o.checks.array(n)){let o={insertExisting:{modified:[],inserted:[],created:[]}};if(s.iterate(n,function(n){let s=e.docPtr.getNodesById(i)[0].getOccurencePath().slice();s.push(n.relationid),s.push(n.resourceid),-1===e.pathToFetch.indexOf(s)&&(e.pathToFetch.push(s),o.insertExisting.modified.push(i),o.insertExisting.inserted.push(n.resourceid),e.insertedNodes.push(n.relationid),o.insertExisting.created.push(n.relationid),o.insertExisting.withContext=!1);let r=n.clientTaskData;if(r){new t(r).appendPaths(e.pathToFetch);let n=e.pathToFetch.filter(t=>e.docPtr.getNodesById(t[0])[0].isRoot());e.pathToFetch=n}if(n.ordering){let t=n.ordering,i={nodePath:s};if(t.before){i.before=e.docPtr.getNodesByRelId(t.before)[0];let o=i.before.getParent().getOccurencePath();o.push(n.relationid),o.push(n.resourceid),i.nodePath=o}t.after&&(i.after=e.docPtr.getNodesByRelId(t.after)[0]),e.orderInfos.push(i)}}),-1===e.rootNodesIds.indexOf(i)){e.rootNodesIds.push(i);let t=e.docPtr.getNodesById(i);t&&(e.rootNodes=e.rootNodes.concat(t),s.iterate(t,function(t){var n=t.getOccurencePath();-1===e.parentOccurencePaths.indexOf(n)&&e.parentOccurencePaths.push(n)}))}e.padRefreshData.transactions.push(o)}})}(u);e.noNotification;delete e.noNotification,this._beginBlockingTransaction(l.inserting_nodes);let p=this;this.wrappedAddPaths({paths:u.pathToFetch}).then(e=>{p._endBlockingTransaction(),u.orderInfos.length&&function(e,t){for(let n=0;n<e.length;n++){let o=e[n],s=t.getNodeFromPath(o.nodePath);if(o.before){let e=o.before.getParent();e.insertBefore(s,o.before),e.setState(i.NODE_STATES.PARTIALLY_EXPANDED),e.options.padstate=i.NODE_STATES.PARTIALLY_EXPANDED.state,e.options.childComputed=!1}}}(u.orderInfos,p),function(e){if(e.insertedNodes.length){var t=[];s.iterate(e.insertedNodes,function(n){let i=e.docPtr.getNodesByRelId(n);i&&i.length&&t.push(i[0].getOccurencePath())}),e.padRefreshData.transactions[0].insertExisting.inserted=t}}(u),p._cmdProxy.padRefresh(u.padRefreshData),a.addChild(),r&&p.bubbleStaticMapMessageOnce()}).catch(e=>{p._endBlockingTransaction(),d.displayNotification({msg:c.generic_service_failure,eventID:"error"})})}},u}),define("DS/ENOPAD_v2/models/mixins/PADDocProductToPartOcc",["DS/PADServices/ws/WSAccess","DS/PADServices/utils/PlatformURL","DS/PADUtils/views/PADAlert","DS/ENOXParser/ParserCV","DS/ENXNav/utils/TwoDAppEvents","i18n!DS/PADUtils/assets/nls/PADUtils.json","i18n!DS/ENXNav/assets/nls/ENXNav"],function(e,t,n,i,o,s,r){"use strict";function a(){}return a.prototype={productToPart:function(a){try{var d=this;d.parameters=a,e.productToPart({enopad_webapis:!0,data:{intent:"explore_2D",select_predicate:["ds6w:type"],select_file:["icon","thumbnail_2d"]},pids:d.parameters.pid,template:d.parameters.template,onComplete:function(e){var l=UWA.is(e,"string")?JSON.parse(e):e;if(l.results&&1===l.results.length){if(1==l.results.length){const e=l.results.map(e=>e.attributes.filter(e=>"resourceid"===e.name))[0];d.wrapInTransaction(function(){d._switchToAuthoring(),i.parseAddOcc({treeDoc:d,FBIProxy:d._getFBI(),wsResponse:l}).then(function(i){d._parseLoadModel=!1,o.addRoot(),n.displayNotification({eventID:"info",msg:r.productToPartCmd.successNotif});const s=d.getNodesById(e[0].value);var a=d.options.context;if(s.length){var l=s[0].getOccurencePath();a.dispatchEvent("onAddPaths",{addedPaths:[l]})}var c={tenant:t.getPlatformId(),pids:l};a._commandProxy.drop(c),d.unselectAll(),d.getNodeByOccurencePath(l).select()}).catch(function(e){d._parseLoadModel=!1,console.error(e)})})}}else n.displayNotification({msg:s.object_not_found_in_db,eventID:"error",key:"enxNav-productToPart-object-not-found-in-db"}),a.callback&&a.callback("error")},onFailure:function(e,t){var i=r.productToPartCmd.err_generic_server;if((t=UWA.is(t,"string")?JSON.parse(t):t)&&t.attributeMap&&t.attributeMap.error_code)switch(t.attributeMap.error_code.value){case 3:i=r.productToPartCmd.err_product_under_change;break;case 4:i=r.productToPartCmd.err_product_with_conf}n.displayNotification({msg:i,eventID:"error",key:"enxNav-productToPart-err-product"}),e.callback&&e.callback("error")}})}catch(e){console.warn(e)}}},a}),define("DS/ENOPAD_v2/mixins/_PADKBInput",["UWA/Core","UWA/Class","UWA/Event","DS/ApplicationFrame/CommandsManager","DS/PADUtils/views/PADAlert","DS/Utilities/Dom","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,i,o,s,r){"use strict";return t.extend({_component:null,init:function(e){this._parent(e),this._component=e.component,this._onKeyDown_binded=this._onKeyDown.bind(this)},startObservingKeyboard:function(t){e.Element.addEvent.call(t,"keydown",this._onKeyDown_binded)},_onKeyDown:function(e){var t=this,a=n.whichKey(e),d=function(a,d){if((u=document.activeElement)&&"INPUT"===u.tagName){if("esc"===a)if(s.firstParentWithClass(document.activeElement,"xnav_treelst")&&t._component){var l=document.activeElement.getParent();t._component.getPADTreeListView().cancelModification(l.getAttribute("row-id"),l.getAttribute("column-id"))}}else{var c=i.getCommand(d);c&&(c.isEnabled()||"Uncut"===d)?(c.begin(),n.stop(e)):"Paste"===d&&(!1===t._component.getEditMode()?o.displayNotification({msg:r.edit_mode_disabled,eventID:"warning"}):o.displayNotification({msg:r.must_select,eventID:"warning"}))}var u};switch(a){case"ctrl+a":d(a,"SelectAll");break;case"ctrl+c":d(a,"Copy");break;case"ctrl+x":d(a,"Cut");break;case"ctrl+v":d(a,"Paste");break;case"ctrl+z":case"esc":d(a,"Uncut");break;case"alt+return":case"alt+enter":d(a,"ActionBar_Attributes")}}})}),define("DS/ENOPAD_v2/features/CreateOptionsForDesignExp",["DS/PADServices/utils/PlatformURL","DS/PADServices/utils/GlobalUtils","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json"],(e,t,n)=>{var i={EVENTS_ENXMODEL_ROOT_ADDTITLE:"ENXModel/Root/addTile",EVENTS_ENXMODEL_DESIGNEXP_ADD:"ENXModel/DesignEnv/add"};return class{constructor(e){this.model=e.model,this.component=e.component,this.typeDetails=e.typeDetails,this.options=e}_onSuccess(e){return"success"===e.status&&e.result&&e.result.length&&(t.displayNotif({level:"success",message:n.plmnew.creationSuccess}),self.widget.newDesignExpCreated=!0,this.openCreatedDesignExp(e.result[0])),!1}_onFailure(e){console.log(e)}_onCancel(e){console.log(`${e.newType} creation dialog has been closed.`)}fetchDB(e){let t=this.model._getFetchFunc(!0);return new Promise(n=>{t({data:{physicalid:[e]},autoAttSelection:!0}).then(e=>{let t="string"==typeof e?JSON.parse(e):e;n(t.results&&t.results.length?t.results[0].attributes.find(e=>"ds6w:label"==e.name).value:"")})})}execute(){return this.creationResultsProcessor(this.options),this}openCreatedDesignExp(e){var t=this,n=JSON.parse(e.identifier);this.fetchDB(n).then(o=>{e.displayName=o;let s=function(i){return{protocol:"3DXContent",version:"1.1",source:"X3DSEAR_AP",widgetId:"preview-c185fc",data:{items:[{envId:t.context.tenant,serviceId:"3DSpace",contextId:t.context.header.SecurityContext,objectId:n,objectType:i.type,displayName:e.displayName,displayType:i.type}]}}}(e);self.widget.newDesignExpCreated=!0,t.model.getModelEvents().publish({event:i.EVENTS_ENXMODEL_ROOT_ADDTITLE,data:{unserializedData:s,behavior:"WITHOUT_CONTEXT",broadcast:!0}}),require(["DS/PADServices/utils/GlobalModelEvents"],t=>{t.publish({event:i.EVENTS_ENXMODEL_DESIGNEXP_ADD,data:{designEnv:s.data.items}}),t.publish({event:"ENXModel/DesignEnv/addToRecents",data:{designEnvIds:[n],designExpDetails:{label:e.displayName,id:n}}}),t.publish({event:"ENXModel/DesignEnv/removeColumn"})})})}creationResultsProcessor(n){this._internalOptions=n,this.options={},this.facets=[],this.viewType="tabView",this.context={tenant:e.getPlatformId(),header:{SecurityContext:t.getSecurityContext()}},this.events={onSuccess:this._onSuccess.bind(this),onFailure:this._onFailure.bind(this),onCancel:this._onCancel.bind(this)}}}}),define("DS/ENOPAD_v2/commands/_PADActionBarCmds",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json"],function(e,t,n){"use strict";var i=["Copy","Cut","PADOpen","DownloadStructure"];return e.extend({init:function(e){this._parent(e);var o=this;if(-1!==i.indexOf(this.options.ID)){this._check_select(),this._boundSelect=this._check_select.bind(this);let e=t.get().options.model.getXSO();e.onPostAdd(this._boundSelect),e.onPostRemove(this._boundSelect)}"RemoveAndResetExpand"===this.options.ID&&(this.options.label=n.grouping.commandTitle),"Paste"===this.options.ID&&require(["DS/PADUtils/PADClipboard"],function(e){o._boundActivate=o._activate_paste.bind(o);let n=t.get().getPADTreeDocument().getXSO();n.onPostAdd(o._boundActivate),n.onPostRemove(o._boundActivate),e.addEvent("post_setData",o._activate_paste.bind(o)),e.addEvent("post_clear",o._activate_paste.bind(o)),o._activate_paste()}),"DownloadStructure"!==this.options.ID&&(!0!==t.get().getEditMode()&&o.disable(),t.get().addEvent("editModeModified",function(e){"Paste"===o.options.ID?o._activate_paste():o._check_select()}))},execute:function(){var e=this;switch(this.options.ID){case"Copy":require(["DS/ENOPAD_v2/commands/edit/_Copy"],function(n){n.execute({command_id:e.options.ID,context:t.get()})});break;case"Cut":require(["DS/ENOPAD_v2/commands/edit/_Cut"],function(n){n.execute({command_id:e.options.ID,context:t.get()})});break;case"Paste":require(["DS/ENOPAD_v2/commands/edit/_Paste"],function(n){n.execute({command_id:e.options.ID,context:t.get()})});break;case"Uncut":require(["DS/ENOPAD_v2/commands/edit/_Uncut"],function(n){n.execute({command_id:e.options.ID,context:t.get()})});break;case"DownloadStructure":require(["DS/ENOPAD_v2/commands/tools/DownloadStructure"],function(n){n.execute({command_id:e.options.ID,context:t.get()})});break;case"RemoveAndResetExpand":let n=t.get();n.features.grouping.executeCommand({id:this.options.ID,context:n,model:n.getPADTreeDocument()});break;default:throw new Error("Unknown command")}},isCommandAvailable:function(e){switch(e.cmdId){case"RemoveAndResetExpand":let n=t.get().getPADTreeDocument();return!(!n.isGroupingApplied()||!function(e){let t=e.getXSO().get(),n=!0;for(let e=0;e<t.length;e++){let i=t[e];if(i.isRoot()||i.isGroupingNode){n=!1;break}}return n}(n));default:return!0}},_check_select:function(){var e=!t.get().options.model.getXSO().isEmpty();!0===t.get().getEditMode()&&!0===e&&"DownloadStructure"!==this.options.ID?this.enable():this.disable()},_activate_paste:function(){var e=require("DS/PADUtils/PADClipboard"),n=!t.get().options.model.getXSO().isEmpty(),i=t.get().getEditMode();!0!==e.isEmpty(e.OBJECT)&&!0===n&&!0===i?this.enable():this.disable()}})}),define("DS/ENOPAD_v2/features/Grouping",["DS/PADServices/utils/GlobalUtils","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json"],function(e,t){"use strict";function n(e){this.options=e}return n.prototype={executeCommand:function(e){switch(e.id){case"RemoveAndResetExpand":this._executeRemoveAndResetExpand(e)}},displayRefreshMessage:function(n){e.displayNotif({title:t.grouping.refreshTitle,message:t.grouping.refreshMessage,level:"info"})},_executeRemoveAndResetExpand:function(e){let t=this.options.context.getPADTreeDocument().getXSO().get();for(let e=0;e<t.length;e++){let n=t[e];n.removeChildren(),delete n.options.childComputed,n.updateOptions({children:[]}),n.collapse()}}},n}),define("DS/ENOPAD_v2/models/mixins/PADDocAddAndAddPaths",["i18n!DS/PADServices/assets/nls/PADServices","DS/PADServices/utils/Meas","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PADTrackerManager","DS/PADServices/settings/AppSettings","DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/ParserCV","DS/ENXNav/utils/TwoDAppEvents"],function(e,t,n,i,o,s,r,a){"use strict";const d=t.addOrGetSection("PADModel.PADDocAdd");function l(){n.displayNotif({message:e.errors.genericWSFailure,level:"error",key:"xNavDoc-addOcc"})}function c(){}return c.prototype={add:async function(t){let i=d.create("addFull",{stats:!0}),o=function(e){i.end(),t.callback&&t.callback(e)},s=this;return new Promise((i,r)=>{s._directSelection=!0;let a={alreadyLoadedRoots:[]},d=function(e){return e.pids.filter(function(t,n){return e.pids.indexOf(t)===n})}(t),c=function(e,t,n){let i=e.getRoots().map(function(e){return e.getID()});return t.filter(function(e){let t=i.includes(e);return t&&n.alreadyLoadedRoots.push(e),!t})}(s,d,a);if(c.length!==d.length&&(n.displayNotif({message:e.infos.rootAlreadyLoaded}),a.noNotif=!0),0===c.length)return a.noNotif=!0,o(a),void i();{let t={pids:c},d=s._isAuthoring();s._performAddWork(t).then(function(e){!s._isAuthoring()&&s.isGroupingApplied()&&s.__applyGroupingTagger({groups:s.getActiveGrouping(),fromGroupingEvent:!0}),o(a),i()}).catch(function(c){d?(l(),o("error")):(s._switchToAuthoring(),s._performAddWork(t).then(()=>{o(a),i()}).catch(t=>{t.resultsGreater?(n.displayNotif({message:e.errors.tooManyResults,level:"error",key:"xNavDoc-add-too-many-results"}),o("error"),r(t)):t.resultsLess?(n.displayNotif({message:e.errors.objectNotFoundInDB,level:"error",key:"xNavDoc-add-obj-not-found"}),o("error"),r(t)):(l(),o("error"),r(t))}))})}})},_performAddWork:function(e){let t=this,n=t._isAuthoring(),i=e.pids,o={pids:i,autoAttSelection:!0};n&&(o={data:{physicalid:i},autoAttSelection:!0});let l=this._getFetchFunc(n);return new Promise((e,n)=>{let c=d.create("addAPI",{stats:!0});l(o).then(function(o){let l=s.data.jsonParse(o);if(c.end(),l.results&&l.results.length===i.length){t._parseLoadModel=!0;let o=d.create("addParse",{stats:!0}),s=function(e,t){let n;return{results:n=e.length>1?e.map(e=>t.results.filter(t=>(function(e){let t;for(let n=0;n<e.length&&!t;n++){let i=e[n];"resourceid"===i.name&&(t=i.value)}return t})(t.attributes)===e)[0]):t.results}}(i,l);r.parseAddOcc({treeDoc:t,FBIProxy:t.options.FBIProxy,wsResponse:s}).then(function(){t._parseLoadModel=!1,o.end(),a.addRoot(),e()}).catch(function(e){t._parseLoadModel=!1,n({isParseError:!0,err:e})})}else l.results?l.results.length>i.length?n({resultsGreater:!0}):l.results.length<i.length&&n({resultsLess:!0}):n({isEmpty:!0})}).catch(function(e){n({isApiFailure:!0})})})},addPaths:async function(t){i.addCommandHit("addPaths",""+t.paths.length);let o=d.create("addPathsFull",{stats:!0}),s=function(e,n){o.end();let i={success:e};t.callback&&t.callback(i,n)},l=this;return new Promise((i,o)=>{let d={alreadyLoadedRoots:[]},c=l._isAuthoring(),u=t.paths;if(0===u.length)return s(!1,d),void i();r.insertTempPaths({treeDoc:l,FBIProxy:l.options.FBIProxy,paths:t.paths,nodeModelClass:l.options.nodeModelClass,nls:e.parser,state:t.state?t.state:"partiallyExpanded"}).then(()=>{let r={paths:t.paths};l._performAddPathsWork(t).then(e=>{a.addRoot(),s(!0,{...d,json:e}),i()}).catch(t=>{c?(s(!1,d),o()):(l._switchToAuthoring(),l._performAddPathsWork(r).then(()=>{s(!0,{...d,json:json}),i()}).catch(()=>{!function(t,i){let o=function(e){return e.reduce((e,t)=>{let n=!0;e.push(t);let i=t.slice();for(;n;){let t=i.slice(0,i.length-2);e.push(t),1===t.length&&(n=!1),i=t}return e},[])}(i).map(e=>t.getNodeFromPath(e)).filter(e=>e&&!0===e.options.waiting4validation),s=!1;for(let e=0;e<o.length;e++)o[e].remove(),s=!0;s&&n.displayNotif({message:e.errors.cannotInsertBranch,level:"error",key:"xNavDoc-addPaths-cannot-add-branch"})}(l,u),s(!1,d),o()}))})})})},_performAddPathsWork:function(e){let t=this,n=this._getExpandFunc(this._isAuthoring());return new Promise((i,a)=>{e.paths;let d={pathIds:e.paths,data:{expandLevel:"0"},FBIProxy:t.options.FBIProxy,timeout:o.getSetting("webapi_timeout"),select_relation:["ro.plminstance.v_treeorder"],withOccResponse:!0};n(d).then(n=>{let o=s.data.jsonParse(n);o.errors&&o.errors.length||!o.results||o.results&&0===o.results.length?a({errorsResult:!0,errors:o.errors}):r.parsePathsOcc({treeDoc:t,FBIProxy:t._getFBI(),wsResponse:o,nodeModelClass:t._getClass(),state:e.state?e.state:"partiallyExpanded"}).then(e=>{let n=e.rootIds.map(e=>t.getNodeById(e)),s=t.getModelEvents(),r=t.getRoots().length;for(let e=0;e<n.length;e++){let t=n[e];s.publish({event:"onRootAdded",data:{nb_root:r,added_node:t}})}i(o)})}).catch(()=>{a({isApiError:!0})})})},wrappedAddPaths:function(e){let t=this;return new Promise((n,i)=>{e.callback=function(e,t){e.success?n({msg:e,addParamsCB:t}):i()},t.addPaths(e)})}},c}),define("DS/ENOPAD_v2/models/mixins/PADDocSupport",["DS/PADUtils/PADSession","DS/PADServices/settings/AppSettings","DS/ENOXParser/modules/TwoDParser","DS/ENOXParser/modules/common/Helpers"],function(e,t,n,i){"use strict";function o(){}return o.prototype={doRefreshCV:function(e,o){let s=this;return new Promise(function(o,r){let a={pathIds:e.map(function(e){return e.getOccurencePath()}),data:{expandLevel:-1},FBIProxy:s.options.FBIProxy,timeout:t.getSetting("webapi_timeout")};s._getExpandFunc(!1)(a).then(function(t){let r=i.data.jsonParse(t);n.refresh({roots:e,treeDoc:s,FBIProxy:s.options.FBIProxy,wsResponse:r,expandLevel:-1}).then(function(){s.isGroupingApplied()&&s.__applyGrouping({roots:e,groups:s.options.groups}),o()})}).catch(function(e){r(e)})})},_getAuthoringFlag:function(){return e.determineAuthoredFlag()}},o}),define("DS/ENOPAD_v2/models/mixins/PADDocExpand",["i18n!DS/PADServices/assets/nls/PADServices","DS/PADServices/utils/Meas","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/PADTrackerManager","DS/PADServices/settings/AppSettings","DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/modules/PADParserOcc","DS/PADServices/utils/PConfigUtils","DS/ENXNav/utils/TwoDAppEvents","DS/ENOXParser/modules/common/Constants"],function(e,t,n,i,o,s,r,a,d,l,c){"use strict";const u=t.addOrGetSection("PADModel.PADDocExpand");let p;function g(){if(p)return p;{const e=require("DS/PADUtils/PADContext");return p=e.get()}}const h="expanded",f="collapsed";function v(e,t){u.start("validateExistingTree",{stats:!0});const n=e.getDepth();let i=!0;const o=-1===t||n<t,s=e.options.childComputed;if(o&&s){e.setState({state:"expanded"}),function(n){if(n){const n=e.getChildren();for(let o=0;n&&o<n.length;o++)v(n[o],t)?(e.setState({state:"expanded"}),i=!0):i=!1}else i=!1,e.setState({state:"collapsed"})}(-1===t||n+1<=t)}else if(function(e){const t="ds6w:globalType";return"ds6w:Document"===e.options.grid[t]||e.options.padgrid&&"ds6w:Document"===e.options.padgrid[t]}(e)){if(i=!1,e&&e.getParent()){const n=e.getParent(),o=n.getState();1===n.getChildren().length&&-1===t?n.setState({state:f}):o!==h?"Rendering Representation"===e.options.type?(i=!0,n.setState({state:h})):n.setState({state:f}):o===h&&"Drawing"===e.options.type&&(i=!0)}}else n===t?i=!1:e&&void 0===s&&(i=!0);return u.end("validateExistingTree"),i}function D(){i.publish({event:"ENXNav/parser/expandAll/begin"})}function m(){i.publish({event:"ENXNav/parser/expandAll/complete"})}function P(e){for(let t=0;t<e.length;t++){delete e[t]._expandAllPending}}function _(){}return _.prototype={__expandCB:async function(e){let t=e.data,n=t.nodeModel,r=!!t.expandAll&&t.expandAll,a=t.numberOfLevelsToExpand?t.numberOfLevelsToExpand.toString():s.getSetting("expand_iter");r&&(a="-1"),o.addCommandHit("ExpandOcc","ExpandCB-"+a=="-1"?"all":a),r&&(n._expandAllPending=!0,D());let d=a,c=parseInt(a,10),u=!0;const p=r?-1:n.getDepth()+c;u=v(n,p);let h=n.getRoot(),f=!1;h.options.isReadOnly&&(f=!0);let P=h.options.filtered;P||(P=!1);let _=!1;if("partiallyExpanded"!==h.options.padstate||P||(_=!0),!1===u)e.target.preExpandDone({preventExpandAll:!0}),this._selectOccurence(),function(){let e=g();return!(!e||!e.colorMap)}()&&this._colorize3D(this),delete n._expandAllPending,r&&m();else{let t=this._isAuthoring();f&&(t=!1);let o=this.prodConfigSupportInAuth,s=this,u={nodeModels:[n],expandLevel:a,expandLevelInt:c,originalRequest:d,expandAll:r,isFiltered:P,isAuthoring:t,modelEvents:e,prodConfigSupportInAuth:o};this._performApiAndParse(u).then(t=>{l.expand(),_&&this._cmdProxy.padExpand({paths:t.paths,expand_level:c}),e.target.preExpandDone({preventExpandAll:!0,state:"expanded"}),m(),i.publish({event:"ENXModel/parseEnded"}),s._selectOccurence()}).catch(()=>{e.target.preExpandDone({preventExpandAll:!0,state:"collapsed"}),m()})}},expandMultiSelect:function(e){let t=this,n=e.expandAll,i=e.numberOfLevelsToExpand?e.numberOfLevelsToExpand.toString():s.getSetting("expand_iter");n&&(i="-1");let o=this.prodConfigSupportInAuth;o||(o=!1);let r=[],a=function(){e.callback&&e.callback()};var d=parseInt(i);let l=e.nodes2Expand.filter(e=>v(e,d)),u=this._isAuthoring();if(0!==l.length){if(n&&D(),u){let e=l.map(e=>{let t=e.getRoot(),i=!!t.options.isReadOnly,o=!!t.options.filtered,s=!!t.validFilter;return n&&(e._expandAllPending=!0),{node:e,root:t,isReadOnly:i,isFiltered:o,hasConfig:s}}),s=[];this._hasMultiRootSupport()&&(s=e.filter(e=>e.hasConfig));let a=e.filter(e=>e.isReadOnly&&!s.includes(e)),c=e.filter(e=>!a.includes(e)&&!s.includes(e)),u={nodeModels:[],expandLevel:i,expandLevelInt:d,originalRequest:i,expandAll:n,isFiltered:!1,isAuthoring:!1,prodConfigSupportInAuth:o};a.length&&(a.reduce((e,t)=>(e.nodeModels.push(t.node),t.isFiltered&&(e.isFiltered=!0),e),u),r.push(this._performApiAndParse(u)));let p={nodeModels:[],expandLevel:i,expandLevelInt:d,originalRequest:i,expandAll:n,isFiltered:!1,isAuthoring:!0,prodConfigSupportInAuth:o};if(c.length&&(c.reduce((e,t)=>(e.nodeModels.push(t.node),t.isFiltered&&(e.isFiltered=!0),e),p),r.push(this._performApiAndParse(p))),s.length){let e=s.map(e=>{let s={nodeModels:[e.node],expandLevel:i,expandLevelInt:d,originalRequest:i,expandAll:n,isFiltered:!1,isAuthoring:!0,prodConfigSupportInAuth:o};return t._performApiAndParse(s)});r=r.concat(e)}}else{let e={nodeModels:l,expandLevel:i,expandLevelInt:d,originalRequest:i,expandAll:n,isFiltered:!1,isAuthoring:!1,prodConfigSupportInAuth:o};r.push(this._performApiAndParse(e))}Promise.allSettled(r).then(()=>{if(n){for(var e=0;e<l.length;e++)l[e].setState(c.NODE_STATES.EXPANDED);m(),P(l)}a()}).catch(()=>{n&&(m(),P(l)),a()})}else a()},_performApiAndParse:function(t){let o=this;return new Promise((s,d)=>{let l=t.nodeModels,c=t.expandLevel,u=t.originalRequest,p=t.expandLevelInt,g=t.isAuthoring,h=t.isFiltered,f=t.modelEvents,v=l.map(e=>e.getOccurencePath()),D=o._getWebApiTimeout();const m={pathIds:v,data:{expandLevel:c},FBIProxy:o._getFBI(),timeout:D,select_relation:["ro.plminstance.v_treeorder"],withOccResponse:!0};t.prodConfigSupportInAuth&&(m.data.prodConfigSupportInAuth=!0),o._getExpandFunc(g)(m).then(t=>{let D=r.data.jsonParse(t);if(D.timeoutOccurs)throw D;if(D.results&&D.results.length)o._parseLoadModel=!0,a.expandWithSort({treeDoc:o,expandedNodes:l,FBIProxy:o._getFBI(),wsResponse:D,nodeModelClass:o._getClass(),expandLevel:p,expandLevelRequest:parseInt(u,10),filter:h,isAuthoring:g}).then(()=>{o._parseLoadModel=!1,s({paths:v})}).catch(e=>{o._parseLoadModel=!1,d({isParseError:!0,isApiError:!1,e:e})});else{if(D.errors){let t=function(e){let t={unknownMetaNameDisplay:"",isUnknownMetas:!1,unknownMetas:[]},n=e.filter(e=>"UNKNOWN_META"===e.code),i=new Set;t.isUnknownMetas=n.length>0;for(let e=0;e<n.length;e++){let o=n[e];if(void 0!==o.unknownmetas)i.add(...o.unknownmetas);else if(o.reason){let e=o.reason;const n="com.exalead.expand.progressive.ProgressiveExpandException: [",s=e.indexOf(n)+n.length;let r=e.substring(s,e.length-1);t.unknownMetaNameDisplay=r;let a=r.replace(/,\s+/g,",");i.add(a)}}return t.unknownMetas=Array.from(i),t}(D.errors);t.isUnknownMetas?function(t,o,s){i.subscribeOnce({event:"ENXViews/DatagridView/CheckColumns/Done"},()=>{o&&o.target.preExpandDone({preventExpandAll:!1,state:"collapsed"}),delete s._expandAllPending,s.setState({state:"collapsed"}),i.publish({event:"ENXNav/parser/expandAll/complete"});let r=require("DS/PADServices/utils/PlatformURL");n.displayNotif({title:e.replace(e.warnings.unknownMeta2.title,{metaName:t.unknownMetaNameDisplay,envId:r.getPlatformId()}),subtitle:e.warnings.unknownMeta2.subtitle})}),i.publish({event:"ENXViews/DatagridView/CheckColumns",data:{colsToRemove:t.unknownMetas}})}(t,f,l[0]):function(t,o,s){o&&o.target.preExpandDone({preventExpandAll:!1,state:"collapsed"}),delete t._expandAllPending,t.setState({state:"collapsed"}),n.displayNotif({message:e.replace(e.errors.cannotExpandObject,{rootLabel:t.getLabel(),expandLevel:"-1"===s?"all":s}),level:"error",key:"xNavDoc-expand-api-error"}),i.publish({event:enxNavParserExpandAllComplete})}(l[0],f,c)}(!D.results||D.results&&0===D.results.length)&&(h?n.displayNotif({message:e.infos.findInCtxNoResult,level:"info"}):n.displayNotif({message:e.errors.genericWSFailure,level:"error",key:"xNavDoc-expand-generic-error"})),d({isBadResponse:!0,isParseError:!1,isApiError:!0})}}).catch(t=>{if(t&&t.timeoutOccurs)n.displayNotif({title:e.errors.requesttimeoutTitle,message:e.errors.requesttimeout,level:"error",key:"xNavDoc-expand-request-timeout"});else{!function(t,i){n.displayNotif({message:e.replace(e.errors.cannotExpandObject,{rootLabel:t,expandLevel:"-1"===i?"all":i}),level:"error",key:"xNavDoc-expand-parse-error"})}(l[0].getLabel(),c)}d({isParseError:!1,isApiError:!0,e:t})})})}},_});const TermAMDTwo="DS/TerminologySelector/service/TerminologyWebService";define("DS/ENOPAD_v2/features/private/BsdInfoCache",[TermAMDTwo,"DS/PADServices/utils/Iterator","DS/ENOXParser/modules/common/Helpers","DS/PADServices/utils/GlobalUtils"],function(e,t,n,i){const o=new Map([["resourceid","id"],["ds6w:label","label"],["predicatename","predicatename"],["type_icon_url","icon"],["sourceid","sourceid"]]);function s(e){let n={};return e.attributes&&t.iterate(e.attributes,function(e){let t=o.get(e.name);n[t]=e.value}),n}const r=new Map([["resourceid","resourceid"],["ds6w:label","label"],["ds6w:type","type"],["icon","icon"],["to","to"],["from","from"]]);function a(e){let t=Object.keys(e),n={};for(let i=0;i<t.length;i++){let o=t[i];n[r.get(o)]=e[o]}return n}function d(e){this.options=e,this._labelMap=new Map,this._resMap=new Map}return d.prototype={execute:function(e){let t=this;return new Promise(function(n,i){t._labelMap.clear(),t._resMap.clear(),t.__apiSearchTerms({predicates:e.predicates}).then(t.__apiExpandTerms.bind(t)).then(function(e){let i=t._referenceInfos=e.referenceInfos,o=t._resMap;for(let e=0;e<i.length;e++){let n=i[e];t._labelMap.set(n.label,n),o.set(n.resourceid,n)}n({referenceInfos:i,labelMap:t._labelMap,resourceidMap:t._resMap})})})},__apiSearchTerms:function(e){return this.__apiExecute({functionName:"searchTerminologies",parameters:{searchTerms:!1},postProcess:function(t){let n=t.json.results.map(s),o=n.filter(function(t){let n="ds6w:"+t.predicatename;return e.predicates.filter(function(e){return 0===e.localeCompare(n,i.getLang(),{sensitivity:"base"})}).length>0}),r=o.map(function(e){return e.id});t.resolve({termPids:r,finals:o,all:n})}})},__apiExpandTerms:function(e){return this.__apiExecute({functionName:"expandV2Terms",parameters:{physicalIds:e.termPids},postProcess:function(e){let t=e.json.results.filter(function(e){return void 0===e.to}).map(a);e.resolve({referenceInfos:t})}})},__apiExecute:function(t){return new Promise(function(i,o){e[t.functionName].bind(e)(Object.assign({onComplete:function(e){let s=n.data.jsonParse(e);t.postProcess({json:s,resolve:i,reject:o})},onError:function(e){o({isTimeout:!1,error:e})},onTimeout:function(e){o({isTimeout:!0,error:e})}},t.parameters))})}},d}),define("DS/ENOPAD_v2/mixins/_PADDnD",["DS/ENXNav/mixins/_xNavDnD","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADWSAccess","DS/PADUtils/views/PADAlert","DS/PADUtils/views/PADDropConfirm","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADSettingsMgt","DS/PADUtils/Utility","DS/PADServices/utils/GlobalUtils","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,i,o,s,r,a,d,l,c){"use strict";return e.extend({shouldAcceptDnDDrop:function(e,t,n,i){if(!0===i.isRoot){var o={shiftKey:2===i.modifiers};this._add_drop_invite(o)}else this.dropInvitContainer.show("insert");return!0},doDnDDrop:function(e,n,s,r){var a={dataTransfer:e},d=this,u=d._parent;t.retrieveDroppedDataAsync(a,function(a){var p=!0,g=!1;s&&s._parentNode&&n&&s._parentNode.options.resourceid===n.options.resourceid&&(g=!0);var h=!1;t.getWidgetId()===a.unserializedData.widgetId&&(h=!0,p=!1);var f=function(t){if(t){var o,l=!1;if(a.unserializedData.data.items.forEach(function(e){if(n){var t=n.options.resourceid;if(e.path)for(var i=0;i<e.path.length;i++)if(t===e.path[i].resourceid){l=!0;break}}}),r.isRoot||l&&!h)e.params=a,d._parent=u,d._parent(e,n,s,r);else a.authorized_objects&&a.authorized_objects.length>0?s&&s._parentNode&&n&&s._parentNode.options.resourceid===n.options.resourceid?(o={dropInfos:{nodeModel:s,dropPosition:"top"},dropped_data:a.authorized_objects,source_data:a.source_data},1===a.authorized_objects.length?d._dropOnCellCompositeOrder(o):(i.displayNotification({msg:c.multi_reordering,eventID:"warning"}),d.dropInvitContainer&&d.dropInvitContainer.hide())):(o={dropInfos:{nodeModel:n},dropped_data:a.authorized_objects,source_data:a.source_data},d._dropOnTreeColumn(o)):d.dropInvitContainer&&d.dropInvitContainer.hide()}else d.dropInvitContainer&&d.dropInvitContainer.hide()};if(!0===d.getEditMode()||r.isRoot){var v=d.getPADTreeDocument(),D=v._confirmDialog||!1;if(r.isRoot&&(D=!1),D){var m=v._copyMode,P=c.all_selected_objects,_=a.authorized_objects;if(_&&1===_.length&&(P=_[0].displayName),0!==_.length){var A=n.options.label||n.options.display;new o({copyMode:m,isReordering:g,isOutsideWidget:p,dropName:P,targetName:A,callback:f})}else d.dropInvitContainer&&d.dropInvitContainer.hide()}else f(!0)}else i.displayNotification({msg:l.editmodedeactivated,eventID:"info"})})},onDragOverCell:function(e,t){let n=this.getPADTreeDocument();if(n.isGroupingApplied()){let i=t.nodeModel;if((i.isGroupingNode||i.isRoot())&&!n.grpIsBsdGroupingApplied()&&e.dataTransfer)return e.dataTransfer.dropEffect="none",e.preventDefault(),!1}return e.dataTransfer&&("copyMove"!==e.dataTransfer.effectAllowed&&"copy"!==e.dataTransfer.effectAllowed||(e.dataTransfer.dropEffect="copy",e.preventDefault())),!!this._isDroppableInBody()&&("find_in_ctx"===t.dataIndex?this.dropInvitContainer.show("find"):this.dropInvitContainer.show("insert"),e.preventDefault(),!0)},onDropCell:function(e,n){var d=this,u=[],p=!1,g=!1;if((t.isTouchDevice()||t.isSurface())&&(this._dnd_leaveCell||this._dnd_startCell)&&(this._dnd_leaveCell=!1,this._dnd_startCell=!1,a.elementIsOrIsWithin(e.target,this._dnd_start_target)))return this._dnd_start_target=null,void(this.dropInvitContainer&&this.dropInvitContainer.hide(this.dropInvitContainer.active_invite));if(n.nodeModel&&n.nodeModel.options){var h=n.nodeModel.options.type;if(h&&"Drawing"===h)return i.displayNotification({msg:c.msg_warning_invalid_parent,eventID:"warning"}),this.dropInvitContainer&&this.dropInvitContainer.hide(this.dropInvitContainer.active_invite),!1}function f(){return u}n.nodeModel._parentNode&&(g=n.nodeModel._parentNode.options._isTrueRoot||!n.nodeModel._parentNode.options.resourceid);var v="find_in_ctx"===n.dataIndex,D="top"===n.dropPosition||"bottom"===n.dropPosition;return D&&g&&(p=!0),s.retrieveAuthorizedObjects({dnd_event:e,isFindInCtx:v,callback:function(e){var s=function(t){if(t){var o=r.getSetting("x3dPlatformId");if(!D||v){var s=0;if(v){for(s=0;s<e.authorized_objects.length;s++)u.push([e.authorized_objects[s].objectId]);u.length&&(n.nodeModel.options.partialPreExpand=f,n.nodeModel.expand())}else o===(e.authorized_objects[0]?e.authorized_objects[0].envId:"")?d._dropOnTreeColumn({dropped_data:e.authorized_objects,source_data:e.source_data,dropInfos:n}):i.displayNotification({msg:c.Tenant_InsertError,eventID:"error"})}else 1===e.authorized_objects.length?o===e.authorized_objects[0].envId?d._dropOnCellCompositeOrder({dropped_data:e.authorized_objects,source_data:e.source_data,dropInfos:n}):i.displayNotification({msg:c.Tenant_InsertError,eventID:"error"}):(d.getPADTreeDocument()._active_cutting_nodes.length>0&&d.uncut.call(d),0===e.authorized_objects.length?i.displayNotification({msg:c.no_authorized_object,eventID:"warning"}):i.displayNotification({msg:c.multi_reordering,eventID:"warning"}))}};if(!0===d.getEditMode()||v){var a=!0;t.getWidgetId()===e.source_data.widgetId&&(a=!1);var g=d.getPADTreeDocument(),h=g._confirmDialog||!1;if(!v&&h&&!p||!0===e.unsupportedDropNotified){var m=g._copyMode,P=c.all_selected_objects,_=e.authorized_objects,A="";if(_&&1===_.length&&(P=_[0].displayName,A=_[0].objectId),0!==_.length){var S=n.nodeModel.options.label||n.nodeModel.options.display;if(A===n.nodeModel.options.resourceid)i.displayNotification({msg:c.msg_warning_dndnotsupported,eventID:"warning"});else new o({copyMode:m,isReordering:D,isOutsideWidget:a,dropName:P,targetName:S,dropPosition:n.dropPosition,callback:s})}}else s(!0)}else i.displayNotification({msg:l.editmodedeactivated,eventID:"info"})}}),this.onDragLeaveCell(e),e.preventDefault(),e.stopPropagation(),!1},onDragStartRowHeader:function(e,n){var i=n.nodeModel,o=this.options.model.getXSO().get().slice(0);if(o[0]!==i){var s=o.indexOf(i),r=o[0];o[0]=i,o[s]=r}var a=t.dropdata_from_selected_nodes(o);a.fromRowID=n.rowID,a.data.DataGridView_Row_Options={"dswebux/x-datagridview.row.options.label+json":n.nodeModel.options.label,"dswebux/x-datagridview.row.options.icons+json":n.nodeModel.options.icons,"dswebux/x-datagridview.row.options.grid+json":n.nodeModel.options.grid,"dswebux/x-datagridview.row.id+json":n.rowID},e.dataTransfer.setData("text/plain",JSON.stringify(a))},onDropRowHeader:function(e,n){var a,d,u,p=this,g=!1,h=!1,f="",v=n.nodeModel.options.resourceid;n.nodeModel._parentNode&&(a=n.nodeModel._parentNode.options.resourceid,h=n.nodeModel._parentNode.options._isTrueRoot||!n.nodeModel._parentNode.options.resourceid),h&&(g=!0);var D=r.getSetting("x3dPlatformId");s.retrieveAuthorizedObjects({dnd_event:e,isFindInCtx:!1,callback:function(e){n.dropPosition="top";var s=e.authorized_objects;if(s&&1===s.length){var r=s[0].path.length;if(r>2&&(d=s[0].path[r-3].resourceid),f=s[0].objectId,u=e.authorized_objects[0].envId,a===d)if(f!==v)if(D===u){var h=function(t){t&&p._dropOnCellCompositeOrder({dropped_data:e.authorized_objects,source_data:e.source_data,dropInfos:n})};if(!0===p.getEditMode()){var m=!0;t.getWidgetId()===e.source_data.widgetId&&(m=!1);var P=p.getPADTreeDocument();if(!(P._confirmDialog||!1)||g)h(!0);else{var _=P._copyMode,A=c.all_selected_objects;if(s&&1===s.length&&(A=s[0].displayName,f=s[0].objectId),0!==s.length){var S=n.nodeModel.options.label||n.nodeModel.options.display;new o({copyMode:_,isReordering:!0,isOutsideWidget:m,dropName:A,targetName:S,dropPosition:n.dropPosition,callback:h})}}}else i.displayNotification({msg:l.editmodedeactivated,eventID:"info"})}else i.displayNotification({msg:c.Tenant_InsertError,eventID:"error"});else i.displayNotification({msg:c.msg_warning_dndnotsupported,eventID:"warning"});else i.displayNotification({msg:c.msg_warning_dndnotsupported,eventID:"warning"})}else 0===e.authorized_objects.length?i.displayNotification({msg:c.no_authorized_object,eventID:"warning"}):(p.getPADTreeDocument()._active_cutting_nodes.length>0&&p.uncut.call(p),i.displayNotification({msg:c.multi_reordering,eventID:"warning"}))}}),e.preventDefault()},_distinguishInsideOutsideCases:function(e){var n={insideView:[],outsideView:[]},i=this.getPADTreeDocument(),o=i.getSelectedNodes();if(e.dropped_data.forEach(function(o){var s=o.path;if(s&&s.length>0&&UWA.is(s[0],"object")){var r=[];s.forEach(function(e){r.push(e.resourceid)}),s=r}var a=s?i.getNodeByOccurencePath(s):null;a&&e.source_data&&t.getWidgetId()===e.source_data.widgetId?n.insideView.push(a):n.outsideView.push(o)}),o.length>1&&n.insideView.length===o.length&&(n.insideView=o),e.dropInfos.droppedNodes){let t=e.dropInfos.droppedNodes;n.insideView.sort(function(e,n){let i=t.indexOf(e),o=t.indexOf(n);return i>o?1:i<o?-1:0})}return n},_handleNodeNotInView:function(e,t,n){var i;i=UWA.is(e.path)?e.path.map(function(e){return e.resourceid?e.resourceid:e}):[e.objectId],n&&n.options._isTrueRoot?treeDocument.add({pids:[i],callback:function(){}}):t.push(i)},_handleNodesNotInView:function(e,t){var n=this,o=[];function s(e){var i,o={},s=t.getID();for(o[s]=[],i=0;i<e.length;i++){var r=e[i].relationid,a=e[i].resourceid;let t=e[i].clientTaskData;o[s].push({resourceid:a,relationid:r,clientTaskData:t})}n.insertNodes(o)}function r(e){if(n.getPADTreeDocument()._endBlockingTransaction(),e&&UWA.is(e.messages,"array")){var t=[];e.messages.forEach(function(e){-1===t.indexOf(e)&&t.push(e)}),i.displayNotification({msg:t.join(""),eventID:"error"})}n.dropInvitContainer&&n.dropInvitContainer.hide()}if(e.forEach(function(e){n._handleNodeNotInView(e,o,t)}),o.length>0){var a={parents:[t.getOccurencePath()],children:o,commit:!0};n.getPADTreeDocument()._beginBlockingTransaction(l.inserting_nodes),require(["DS/ApplicationFrame/CommandsManager"],function(e){e.getCommand("InsertExisting").execute({mode:"CopyPaste",internal_call:!0,scenario:"externalDnD",data:a,onSuccess:s,onFailure:r})})}},_dropOnTreeColumn:function(e){var t=this.getPADTreeDocument();let n=e.dropInfos;if(n.nodeModel&&n.nodeModel.isGroupingNode)n.droppedNodes?this.features.browsingStructureDefinition.moveToGroupingNode(n.droppedNodes,n.nodeModel):d.displayNotif({title:l.noDropsOutsideBsdgrouping.title,message:l.noDropsOutsideBsdgrouping.message,level:"info"});else{t._active_cutting_nodes.length>0&&this.uncut.call(this);var i=this._distinguishInsideOutsideCases(e);if(i.insideView.length>0&&t._onInsert(i.insideView,e.dropInfos.nodeModel,null),i.outsideView.length>0){var o=e.dropInfos.nodeModel;this._handleNodesNotInView(i.outsideView,o)}this.dropInvitContainer&&this.dropInvitContainer.hide()}},_handleNodesNotInViewOrder:function(e,t,n){var o=this,s=[];function r(e){var i,s={},r=t.getID();for(s[r]=[],i=0;i<e.length;i++){var a=e[i].relationid,d=e[i].resourceid;let t=e[i].clientTaskData;s[r].push({resourceid:d,relationid:a,ordering:n,clientTaskData:t})}o.insertNodes(s)}function a(e){if(o.getPADTreeDocument()._endBlockingTransaction(),e&&UWA.is(e.messages,"array")){var t=[];e.messages.forEach(function(e){-1===t.indexOf(e)&&t.push(e)}),i.displayNotification({msg:t.join(""),eventID:"error"})}o.dropInvitContainer&&o.dropInvitContainer.hide()}if(e.forEach(function(e){o._handleNodeNotInView(e,s,null)}),s.length>0){var d={parents:[t.getOccurencePath()],children:s,ordering:n,commit:!0};o.getPADTreeDocument()._beginBlockingTransaction(l.inserting_nodes),require(["DS/ApplicationFrame/CommandsManager"],function(e){e.getCommand("InsertExisting").execute({mode:"CopyPaste",internal_call:!0,scenario:"externalDnD",data:d,onSuccess:r,onFailure:a})})}},_dropOnCellCompositeOrder:function(e){if(this.getPADTreeDocument()._active_cutting_nodes.length>0&&this.uncut.call(this),e.dropInfos&&e.dropInfos.nodeModel){var t=this.getPADTreeDocument(),n=e.dropped_data[0].path;if(n&&n.length>0&&UWA.is(n[0],"object")){var o=[];n.forEach(function(e){e.resourceid&&o.push(e.resourceid)}),n=o}var s=n?t.getNodeByOccurencePath(n):null,r=e.dropInfos.nodeModel._parentNode,a={};if(r&&!r.options._isTrueRoot){var d,l,u=r.getChildren(),p=e.dropInfos.nodeModel.getRelationID(),g=r.getChildren().indexOf(e.dropInfos.nodeModel),h=-1,f=-1;if(g>-1&&(h=g-1,f=g+1),"top"===e.dropInfos.dropPosition?(l=u?u[h]:null,!p&&s&&r.insertBefore(s,e.dropInfos.nodeModel),a.before=p,a.after=l?l.getRelationID():""):"bottom"===e.dropInfos.dropPosition?(d=u?u[f]:null,!p&&s&&r.addChild(s,r.getChildren().indexOf(e.dropInfos.nodeModel)+1),a.after=p,a.before=d?d.getRelationID():""):i.displayNotification({msg:c.drop_between_lines,eventID:"warning"}),p)if(s)t._compositeOrder(s,r,a);else{var v=this._distinguishInsideOutsideCases(e);v.outsideView.length>0&&this._handleNodesNotInViewOrder(v.outsideView,r,a)}}else i.displayNotification({msg:c.drop_between_lines,eventID:"warning"});this.dropInvitContainer&&this.dropInvitContainer.hide()}}})}),define("DS/ENOPAD_v2/models/mixins/PADDocOccExcludesDisabled",["DS/PADUtils/PADSettingsMgt","DS/PADUtils/views/PADAlert","i18n!DS/ENXNav/assets/nls/ENXNav.json"],function(e,t,n){"use strict";function i(){}return i.prototype={triggerExcludePathsUpdate:function(){return Promise.resolve()},bubbleStaticMapMessageOnce:function(){if(e.getSetting("activateExcludeOccWarning")&&e.getSetting("staticMappingEnabled")){let e=n.staticMappingFoundinSession2D;e.eventID="warning",t.displayNotification(e)}}},i}),define("DS/ENOPAD_v2/commands/edit/_Cut",["UWA/Class"],function(e){"use strict";return{execute:function(e){e.context.cut()}}}),define("DS/ENOPAD_v2/models/mixins/PADDocInserts",["DS/PADServices/ws/WSAccess","DS/PADServices/utils/Iterator","DS/PADServices/utils/PromiseHook","DS/ENOXParser/modules/TwoDParser","DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/modules/common/Constants","DS/ENOXParser/modules/PADParser","DS/ENOXParser/modules/ClientDataParser","DS/PADServices/utils/Generics","DS/PADServices/settings/AppSettings","DS/ENXNav/models/xNavNodeModel","DS/ENXNav/utils/TwoDAppEvents","DS/PADUtils/PADSession","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADPredicatesNls","DS/PADUtils/views/PADAlert","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,i,o,s,r,a,d,l,c,u,p,g,h,f,v,D){"use strict";const m=["owner","ds6w:globalType"];function P(e){let t=i.parseAttributes(e.attributes);if(d.checks.number(t.relcount)&&t.relcount>0&&(t.children=[]),t.padgrid&&d.checks.string(t.padgrid.relcount)){parseInt(t.padgrid.relcount)>0&&(t.children=[])}return e.relationid&&(t.relationid=e.relationid),t}function _(e,n,i,o){t.iterate(n,function(n){let o=e.getRoots().map(function(e){return e.getNodesById(n.parent_id)}).reduce(function(e,t){return e=e.concat(t)},[]);t.iterate(o,function(o){let r=n.children.map(P);t.iterate(r,function(t){let n=[];var r={insertExisting:{modified:[],inserted:[],created:[]}};t.grid["ds6w:reserved-Instance"]||(t.grid["ds6w:reserved-Instance"]="FALSE");var a=e.createNodeModel(t);o.addChild(a),o.setState(s.NODE_STATES.PARTIALLY_EXPANDED),o.options.padstate=s.NODE_STATES.PARTIALLY_EXPANDED.state,r.insertExisting.modified.push(o.getID());let d=a.getOccurencePath();n.push(d),r.insertExisting.inserted.push(d),r.insertExisting.created.push(a.getRelationID()),r.insertExisting.withContext=!1,e.updatePaths({paths:n}),e.isGroupingApplied()&&o.isRoot()&&function(e,t){let n=e.grpGetOtherNode(t.getRoot());n.addChild(t),n.isExpanded()||n.setState(s.NODE_STATES.PARTIALLY_EXPANDED)}(e,a),h.updateNLS(a),i.transactions.push(r)})})}),e._cmdProxy.padRefresh(i)}function A(){}return A.prototype={insertNodes:function(e,n){var i=this,o=[];var s={transactions:[]};return this.wrapInTransaction(function(){d.checks.array(e.created)||d.checks.array(e.inserted)?(console.info("INFO: insertNodes() attributes provided"),i.withTransactionUpdate(function(){e.created&&function(e,n,i){let o=n.map(P);p.setAuthoringState(!0);var s=[];t.iterate(o,function(t){let n=e.createNodeModel(t),o=e.addRoot(n);o.select(),s.push(o.getID()),i.push(o),h.updateNLS(o),e.getModelEvents().publish({event:"onRootAdded",data:{nb_root:e.getRoots().length,added_node:o}})}),e.updateNodesAttrValue(s,m,function(){});let r={pids:s,already_added_in_PS:!0};e._cmdProxy.drop(r)}(i,e.created,o),e.inserted&&_(i,e.inserted,s)})):(console.info("INFO: insertNodes() attributes to be gotten"),i._insertWithLessInfo({parameters:e,noNotification:e.noNotification,callback:n}))}),o},_insertWithLessInfo:function(e){let i=this,c=e.callback,p=e.parameters.isProdConfig;if(delete e.parameters.isProdConfig,!0===l.getSetting("useLWCWebServices")){console.info("INFO: insertNodes() attributes with expand"),this.unselectAll();let c={docPtr:this,padRefreshData:{transactions:[]},insertedNodes:[],pathToFetch:[],rootNodesIds:[],rootNodes:[],objects:e.parameters,parentOccurencePaths:[],orderInfos:[]};!function(e){t.iterateObj(e.objects,function(n,i){if(d.checks.array(n)){let o={insertExisting:{modified:[],inserted:[],created:[]}};if(t.iterate(n,function(t){let n=[i,t.relationid,t.resourceid];-1===e.pathToFetch.indexOf(n)&&(e.pathToFetch.push(n),o.insertExisting.modified.push(i),o.insertExisting.inserted.push(t.resourceid),e.insertedNodes.push(t.relationid),o.insertExisting.created.push(t.relationid),o.insertExisting.withContext=!1);let s=t.clientTaskData;if(s&&new a(s).appendPaths(e.pathToFetch),t.ordering){let i=t.ordering,o={nodePath:n};if(i.before){o.before=e.docPtr.getNodesByRelId(i.before)[0];let n=o.before.getParent().getOccurencePath();n.push(t.relationid),n.push(t.resourceid),o.nodePath=n}i.after&&(o.after=e.docPtr.getNodesByRelId(i.after)[0]),e.orderInfos.push(o)}}),-1===e.rootNodesIds.indexOf(i)){e.rootNodesIds.push(i);let n=e.docPtr.getNodesById(i);n&&(e.rootNodes=e.rootNodes.concat(n),t.iterate(n,function(t){var n=t.getOccurencePath();-1===e.parentOccurencePaths.indexOf(n)&&e.parentOccurencePaths.push(n)}))}e.padRefreshData.transactions.push(o)}})}(c);e.noNotification;delete e.noNotification,this._beginBlockingTransaction(v.inserting_nodes);let g=i._getAuthoringFlag();this._getExpandFunc(g)({pathIds:c.pathToFetch,data:{expandLevel:"0"},FBIProxy:this.options.FBIProxy,timeout:l.getSetting("webapi_timeout")}).then(function(e){var a=o.data.jsonParse(e);i._parseLoadModel=!0;let d=r.insertNodesExpand({treeDoc:i,expandedNodes:c.rootNodes,FBIProxy:i.options.FBIProxy,wsResponse:a,expandLevel:0});new n(d,i.boundClearFlag);d.then(function(){i._endBlockingTransaction(),c.orderInfos.length&&function(e,t){for(let n=0;n<e.length;n++){let i=e[n],o=t.getNodeByOccurencePath(i.nodePath);if(i.before){let e=i.before.getParent();e.insertBefore(o,i.before),e.setState(s.NODE_STATES.PARTIALLY_EXPANDED),e.options.padstate=s.NODE_STATES.PARTIALLY_EXPANDED.state,e.options.childComputed=!1}}}(c.orderInfos,i),function(e){if(e.insertedNodes.length){var n=[];t.iterate(e.insertedNodes,function(t){let i=e.docPtr.getNodesByRelId(t);i&&i.length&&n.push(i[0].getOccurencePath())}),e.padRefreshData.transactions[0].insertExisting.inserted=n}}(c),i._cmdProxy.padRefresh(c.padRefreshData),u.addChild(),p&&i.bubbleStaticMapMessageOnce()})})}else{console.info("INFO: insertNodes() attributes with fetch");var g=[];t.iterateObj(e.parameters,function(e){d.checks.array(e)&&function(e,n){t.iterate(n,function(t){o.array.unique(e,t.resourceid),o.array.unique(e,t.relationid)})}(g,e)});let n=e.noNotification;delete e.noNotification,delete e.parameters.noNotification,this._beginBlockingTransaction(v.inserting_nodes);l.getSetting("enopad_webapis_debug");let s=i._getAuthoringFlag();this._getFetchFunc(s)({data:{physicalid:g},autoAttSelection:!0}).then(function(t){let s=o.data.jsonParse(t);if(i.invalidateViewPort(),0===s.results.length)throw new Error("Cannot find object with the physicalid "+g);i.wrapInTransaction(function(){var t=r.insertNodes({treedocument:i,response:s,insert_parameters:e.parameters});i._cmdProxy.padRefresh(t),u.addChild()},"insert_nodes"),i._endBlockingTransaction(),c&&c(),!0!==n&&f.displayNotification({msg:v.insert_existing_succeeded,eventID:"info"})}).catch(function(e){f.displayNotification({msg:D.generic_service_failure,eventID:"error"}),i._endBlockingTransaction()})}}},A}),define("DS/ENOPAD_v2/models/mixins/PADDocRefreshOcc",["i18n!DS/PADServices/assets/nls/PADServices","i18n!DS/PADUtils/assets/nls/PADUtils.json","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/PADServices/utils/Meas","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/Generics","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/TrackerInsert","DS/PADServices/settings/AppSettings","DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/ParserCV","DS/ENOXParser/modules/PADParserOcc","DS/ENXNav/utils/TwoDAppEvents","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/PConfigUtils","DS/ENOXParser/modules/common/Constants","DS/PADServices/utils/DictionaryAccess","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json"],function(e,t,n,o,s,r,a,d,l,c,u,p,g,h,f,v,D,m,P){"use strict";const _=o.addOrGetSection("ENOPAD.PADDocRefreshOcc"),A=/ResponseCode with value \"(\d+)\"/g;function S(){r.publish({event:"ENXModel/refresh/complete"})}function b(e){let t=[],n=e.filter(e=>e.hasChildren());if(n.length===e.length)t.push(n);else{let i=e.filter(e=>!n.includes(e));n.length&&t.push(n),t.push(i)}return t}function I(e,n,i,o){let r=e&&e.message||"";if(r.includes("NetworkError:")){let e=A.exec(r);if(e){let r=parseInt(e[1]);if(r>=300&&r<=400){let e=n.map(function(e){return i.searchRootById(e)});!function(e,n,i){for(let e=0;e<n.length;e++)n[e].remove();let o={detach:{deleted:n.map(e=>e.getID())}};e._cmdProxy.padRefresh(o);let r=t.cannot_insert_branch;i&&(r=t.cannot_access_after_changeowner),s.displayNotif({message:r,level:"error",key:"xNavDoc-refresh-removeRoots"}),e._triggerTitleUpdate()}(i,e,o)}}}}function E(e){e.filter(e=>{if("rejected"===e.status){let t=e.reason;return t&&t.isApiError}}).length&&s.displayNotif({message:n.refresh_failure,level:"error",key:"xNavDoc-refresh-error"})}function y(){}return y.prototype={refresh:async function(e){if(this._isAuthoring()&&this.isGroupingApplied())return void s.displayNotif({title:P.grouping.refreshTitle,message:P.grouping.refreshMessage,level:"info"});let t=[];r.publish({event:"ENXModel/refresh/begin"});let n=new l(_,"Refresh.refresh","2d_app_refresh",{eventCategory:"performance",eventAction:"refresh"});if(!this._isAuthoring()){let e=b(this.getRoots());for(let n=0;n<e.length;n++){let i=e[n];this.refreshDispatch({roots:i,promisesExpandWS:t})}return void Promise.allSettled(t).then(e=>{E(e),S(),n.end()})}let i=this.getRoots(),o=i.filter(function(e){return!1===e.options.isReadOnly&&!e.validFilter}),a=i.filter(function(e){return!0===e.options.isReadOnly&&!e.validFilter}),d=v.isMultiRootSupported()?i.filter(e=>e.validFilter):[],c=[];o.length&&c.push({roots:o,isAuthoring:!0}),a.length&&c.push({roots:a,isAuthoring:!1}),d.length&&d.forEach(e=>c.push({roots:[e],isAuthoring:!0})),c.forEach(e=>{let n=b(e.roots);for(let i=0;i<n.length;i++){let o=n[i];this.refreshDispatch({roots:o,isAuthoring:e.isAuthoring,promisesExpandWS:t})}}),Promise.allSettled(t).then(e=>{E(e),S(),n.end()})},refreshDispatch:async function(t){let n=this,i=0,o=t.promisesExpandWS,r=t&&t.roots?t.roots:this.getRoots(),a=function(e,t){let n=[];for(let i=0;i<e.length;i++){n.push(e[i]);let o=e[i].getLeaves(),s=[],r=[],a=[],d=[];for(let e=0;e<o.length;e++)if(!0===o[e].isRelationsObjectNode){let t=!0===o[e].isRelationsObjectGroupingNode?o[e]:o[e].getParent();for(;!0===t.getParent().isGroupingNode;)t=o[e].getParent();-1===a.indexOf(t.getID())&&(r.push(t),a.push(t.getID()));let n=t.getParent();n&&!n.isRoot()&&-1===d.indexOf(n.getID())&&(s.push(n),d.push(n.getID()))}else-1===d.indexOf(o[e].getID())&&(s.push(o[e]),d.push(o[e].getID()));r.length&&t.withTransactionUpdate(()=>{for(let e=0;e<r.length;e++)!0!==r[e].isRoot()&&r[e].remove()}),n=n.concat(s)}return n}(r,n).map(e=>{let t=e.getOccurencePath(),n=(t.length-1)/2;return i<n&&(i=n),t});if(this._isAuthoring()&&r.forEach(function(e){n.prodConfigSupportInAuth&&!0===f.getSetting("keepFilterAuthoring")?n.prodConfigSupportInAuth&&e.validFilter&&!e.keepFilterBadge&&(e.keepFilterBadge=!0):e.validFilter&&e.keepFilterBadge&&(e.keepFilterBadge=!1)}),0===r.length)return void S();let d=t&&void 0!==t.isAuthoring?t.isAuthoring:this._isAuthoring();if(0===i){let e=r.map(e=>e.getID()),t={pids:e,autoAttSelection:!0};d&&(t={data:{physicalid:e},autoAttSelection:!0});let i={apiParams:t,isAuthoring:d};o.push(new Promise(function(e,t){n._performWorkRefreshFetch(i).then(t=>{for(let e=0;e<t.refreshPaths.length;e++){let i=n.getNodeByOccurencePath(t.refreshPaths[e]);i&&i.setState(D.NODE_STATES.COLLAPSED)}e()}).catch(e=>{console.warn(e),t(e)})}))}else{let t={pathIds:r.map(e=>e.getOccurencePath()),data:{expandLevel:d?""+i:i},FBIProxy:this._getFBI(),timeout:c.getSetting("webapi_timeout"),select_relation:["ro.plminstance.v_treeorder"],withOccResponse:!0};n.prodConfigSupportInAuth&&(t.data.prodConfigSupportInAuth=n.prodConfigSupportInAuth);let l={apiParams:t,isAuthoring:d};o.push(new Promise(function(t,i){n._performWorkRefreshExpand(l).then(i=>{let o=a.filter(e=>!i.refreshPaths.includes(e.join("/"))),r=!1;for(let e=0;e<a.length;e++){if(!0===n.options.FBIProxy.HasFilter(a[e][0]).hasFilter){r=!0;break}}(function(e,t){let n=t.map(t=>e.getNodeFromPath(t)),i=n.length>0;for(let e=0;e<n.length;e++){let t=n[e],i=t.getParent();t.remove(),i&&"ds6w:Document"===i.options.globaltype&&!i.hasChildren()&&(i.options.children=null,i.setState({state:"noChildren"})),!i||i.isRoot()||i.hasChildren()||(i.removeChildren(),i.remove())}return i})(n,o)&&!r&&s.displayNotif({message:e.warnings.removeNodeDuringRefresh,level:"warning"}),t()}).catch(e=>{i(e)})}))}},_performWorkRefreshFetch:function(e){let t=this;return new Promise((n,i)=>{t._getFetchFunc(e.isAuthoring)(e.apiParams).then(e=>{let o=u.data.jsonParse(e);o.errors&&o.errors.length||!o.results||o.results&&0===o.results.length?i({isApiError:!0,errors:o.errors}):(t._parseLoadModel=!0,p.parseRefreshOcc({treeDoc:t,FBIProxy:t._getFBI(),wsResponse:o}).then(e=>{t._parseLoadModel=!1,n(e)}).catch(e=>{t._parseLoadModel=!1,i({isApiError:!1,isParseError:!0,error:e})}))}).catch(e=>{i({isApiError:!0,error:e})})})},_performWorkRefreshExpand:function(e){let t=this;return new Promise((n,i)=>{t._getExpandFunc(e.isAuthoring)(e.apiParams).then(e=>{let o=u.data.jsonParse(e);o.errors&&o.errors.length||!o.results||o.results&&0===o.results.length?i({isApiError:!0,errors:o.errors}):(t._parseLoadModel=!0,g.refreshWithInserts({treeDoc:t,FBIProxy:t._getFBI(),wsResponse:o}).then(e=>{t._parseLoadModel=!1,n(e)}).catch(e=>{t._parseLoadModel=!1,i({isApiError:!1,isParseError:!0,error:e})}))}).catch(e=>{i({isApiError:!0,error:e})})})},refreshNodeById:function(e){console.log(e);let t=this;if(e.created&&e.created.length){let n=e.created.slice();this._getFetchFunc(this._isAuthoring())({data:{physicalid:n},autoAttSelection:!0}).then(e=>{let n=u.data.jsonParse(e),o=n.results.filter(e=>e.attributes.find(e=>"#DENIED!"===e.value));if(o.length){let e=o.map(e=>{let n=e.attributes.find(e=>"resourceid"===e.name),i=t.getNodesById(n);if(i.length)return i[0]});for(let n=0;n<e.length;n++){let n=e[i];t.removeRoot(n)}if(e.length){let t=e.map(e=>e.getID());r.publish({event:"ENXViews/WelcomePanel/cleanup",data:{item2remove:t}})}t._parseLoadModel=!0,p.parseRefreshOcc({treeDoc:t,FBIProxy:t._getFBI(),wsResponse:n}).then(e=>{t._parseLoadModel=!1}).catch(e=>{t._parseLoadModel=!1})}})}if(e.modified&&e.modified.length){let n=e.modified.filter(e=>a.checks.object(e)&&a.checks.array(e.attributes)),i=e.modified.filter(e=>a.checks.string(e));if(n.length===e.modified.length){let n=e.modified.map(e=>{let n=!1,i=t.getNodesById(e.physicalid);if(0===i.length){i=t.getNodesByRelId(e.physicalid);for(let t=0;t<e.attributes.length;t++){let n=e.attributes[t];switch(n.name){case"ds6w:reserved":n.name="ds6w:reserved-Instance";break;case"ds6w:reservedBy":n.name="ds6w:reservedBy-Instance"}}n=!0}return{isByRel:n,nodes:i,mod:e}}),i=d.getAvailableColumns();for(let e=0;e<n.length;e++){let t=n[e];for(let e=0;e<t.nodes.length;e++){t.nodes[e].updateAttributes(t.mod.attributes,i)}}}if(i.length===e.modified.length){t._switchToAuthoring();let n=e.modified.map(e=>t.searchRootById(e)).filter(e=>e);if(n.length&&n.length===i.length){let e=n.map(e=>e.getID());t.updatePids({pids:e}).then(e=>{for(let e=0;e<n.length;e++)m.updateNLS(n[e])}).catch(n=>{if(n.isApiError){I(n.error,e,t,!1)}})}else{let n=e.modified.map(e=>{let n=t.getNodesById(e);return 0===n.length&&(n=t.getNodesByRelId(e)),n.map(e=>e.getOccurencePath())}).reduce((e,t)=>e.concat(t),[]);t.updatePaths({paths:n}).then(()=>{}).catch(e=>{console.error(e)})}}}},updatePaths:function(e){let t=this,n=this._getExpandFunc();return new Promise((i,o)=>{e.paths.map(e=>{let n=t.getNodeFromPath(e);return n.options.waiting4validation=!0,n});let s=t._getWebApiTimeout(),r={pathIds:e.paths,data:{expandLevel:"0"},FBIProxy:t._getFBI(),timeout:s,select_relation:["ro.plminstance.v_treeorder"],withOccResponse:!0};n(r).then(n=>{let s=u.data.jsonParse(n);s.errors&&s.errors.length||!s.results||s.results&&0===s.results.length?o({errorsResult:!0,errors:s.errors}):p.parsePathsOcc({treeDoc:t,FBIProxy:t._getFBI(),wsResponse:s,nodeModelClass:t._getClass(),state:e.state?e.state:"partiallyExpanded"}).then(e=>{i()})}).catch(e=>{o({err:e,isApiError:!0})})})},updatePids:function(e){let t=this._isAuthoring(),n=this._getFetchFunc(t),i=this,o={pids:e.pids,autoAttSelection:!0};return t&&(o={data:{physicalid:e.pids},autoAttSelection:!0}),new Promise((e,t)=>{n(o).then(n=>{let o=u.data.jsonParse(n);i._parseLoadModel=!0,p.parseRefreshOcc({treeDoc:i,FBIProxy:i._getFBI(),wsResponse:o}).then(t=>{i._parseLoadModel=!1,e()}).catch(e=>{i._parseLoadModel=!1,t({isApiError:!1,isParseError:!0,error:e})})}).catch(e=>{t({isApiError:!0,error:e})})})}},y}),define("DS/ENOPAD_v2/models/_PADModelParser",["DS/ENXNav/models/_xNavCVParser","DS/ENXNav/models/xNavNodeModel","DS/PADServices/utils/AttributesMgt","DS/PADUtils/PADPredicatesNls"],function(e,t,n,i){"use strict";return e.process.insert_nodes=function(o){var s={transactions:[]},r=n.getAvailableColumns(),a=o.treedocument,d=a.getRoots(),l=o.response.results;console.log("replace insert response_results",l);var c,u,p,g=UWA.clone(o.insert_parameters,!1),h=Object.keys(g),f={},v={},D={};Date.now();function m(){for(var e,t,n,i,o,s,r,a=function(e,t){for(var n={beforeNodes:[],afterNodes:[],afterPosition:-1},i=e.length;i--;){var o=(u=e[i])._options.relationid;if(o===t.after){n.afterNodes=[u],n.afterPosition=i;break}if(o===t.before){n.beforeNodes=[u];break}}return n},d=h.length;d--;){e=h[d];for(var l=(n=f[e]).length;l--&&((t=n[l].getChildren())&&0!==t.length);){s=g[e],o=t[0];for(var c=s.length;c--&&(i=(r=s[c]).resourceid,r.ordering);){var p,v=r.ordering.before,m=r.ordering.after,P=!(!v||""===v),_=!(!m||""===m),A=a(t,r.ordering),S=A.beforeNodes.length>0,b=-1!==A.afterPosition;P&&_?(S&&(D[i]={before:A.beforeNodes}),b&&(p=A.afterPosition+2,D[i]={after:[p]})):P?S?D[i]={before:A.beforeNodes}:o&&(D[i]={before:[o]}):_&&b&&(p=A.afterPosition+2,D[i]={after:[p]})}}}}function P(t){var i,o,s=t.relationid;if((i=v[t.resourceid])&&((o=e.parse_attributes(i.attributes,r,n.getTreeColumn())).relationid=s,-1!==r.indexOf("instanceName")&&s&&v[s])){var a=e.parse_attributes(v[s].attributes,r,n.getTreeColumn());o.grid.instanceName=a.label}return UWA.clone(o,!1)}!function(){for(var e,t,n=h.length;n--;){t=h[n];for(var i=d.length;i--;)if((e=d[i].getNodesById(t)).length>0){f[t]=e;break}}}(),function(){for(var e,t,n,i,o=l.length;o--;){e=l[o],console.log("insert result",e);for(var s=(t=e.attributes).length;s--;)if("resourceid"===(n=t[s]).name){i=n.value,v[i]=e;break}}}(),m();Date.now();for(var _,A=h.length;A--;){_=h[A];var S=[],b={insertExisting:{modified:[],inserted:[],created:[]}},I=f[_],E=g[_];if(a.withTransactionUpdate(function(){for(var e,n,o=E.length;o--;){n=(p=E[o]).resourceid,e=P(p);for(var s=I.length;s--;){c=I[s];var r=new t(e);if(p.ordering){var a=D[n];a?a.before?c.insertBefore(r,a.before[0]):a.after?c.addChild(r,a.after[0]):c.addChild(r):c.addChild(r)}else c.addChild(r);"expanded"!==c.options.padstate&&(c.setState({state:"partiallyExpanded"}),c.options.padstate="partiallyExpanded"),"noChildren"===c.options.padstate&&(c.setState({state:"expanded"}),c.options.padstate="expanded"),(c._isExpanded||"expandState"===c._expandState)&&(c.options.padstate="expanded",c.setState({state:"expanded"})),b.insertExisting.modified.push(c.getID()),b.insertExisting.inserted.push(r.getID()),S.push(r.getRelationID()),b.insertExisting.created.push(r.getRelationID()),b.insertExisting.withContext=!1,i.updateNLS(r),m()}}}),s.transactions.push(b),S.length){var y=[];S.forEach(function(e){var t=a.getNodesByRelId(e);t&&y.push(t[0].getOccurencePath())}),s.transactions[0].insertExisting.inserted=y}}return s},e}),define("DS/ENOPAD_v2/features/CreateOptionsBuilder",["DS/PADUtils/PADSession","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/Storage","DS/ENOXParser/modules/common/Constants","DS/PADServices/utils/ConfigurationCache","DS/PADServices/utils/GrantedRolesCache","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json"],function(e,t,n,i,o,s,r,a,d){"use strict";const l="DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext";function c(){e.setAuthoringState(!0,"PADSession_enabling_authoring_mode")}function u(e,t,n){let o=e.map(function(e){return e.identifier});c(),i.publish({event:"ENXViews/WelcomePanel/closeLandingPage"}),t.add({pids:o,callback:function(e){if("error"!==e){let e=t.getRoots(),i=e.filter(function(e){return o.includes(e.getID())});for(let s=0;s<i.length;s++){let r=i[s];r.select(),t.getModelEvents().publish({event:"onRootAdded",data:{nb_root:e.length,added_node:r}}),n.dispatchEvent("onAddPaths",{addedPaths:[[r.getID()]]});let a={pids:o,already_added_in_PS:!0};t._cmdProxy.drop(a)}}}})}function p(e,t){let n=e.grpGetOtherNode(t.getRoot());n.addChild(t),n.isExpanded()||n.setState(s.NODE_STATES.PARTIALLY_EXPANDED)}function g(e,t,n){let i=n.AuthoringContextHeader[t];i&&(e.header[t]=i)}function h(e){this._internalOptions=e,this._internalOptions.isInsert=!1,this._setup(),this._internalOptions.storageKey=n.getAppId()+".typeSelection."+this._internalOptions.typeDetails.newType,this._internalOptions.repeatKey=o.buildKey(n.getAppId(),"activateCreateAnother",!0),this.options=function(e){let t={},n=o.local.get(e);return n&&(t.preferedType=n),t}(this._internalOptions.storageKey),this.facets=function(e){let t=[];return t.push({name:"classificationFacet",facetoptions:{isBookmark:!0,isLibrary:!0,isExportControl:!0}}),r.isEnabled("xRevisionActivation")&&a.isEnabled("CFG")&&!e&&t.push({name:"revisionFacet"}),t}("drawing"===this._internalOptions.typeDetails.newType),this.viewType="tabView",this.context=function(){let e={};e.tenant=t.getPlatformId(),e.header={SecurityContext:n.getSecurityContext()};try{let t=require(l).get();t&&t.AuthoringContextHeader&&(g(e,"DS-Change-Authoring-Context",t),g(e,"DS-Configuration-Authoring-Context",t))}catch(e){console.log("Cfg Auth fails",e)}return e}();let i=o.local.get(this._internalOptions.repeatKey);void 0!==i&&(this.activateCreateAnother=i);let s=this._model.getSelectedNodes();if(s.length){this.options={parentPIDs:[]};let e=s.map(function(e){return e.getID()}).filter((e,t,n)=>n.indexOf(e)===t);this.options.parentPIDs=e,this._internalOptions.isInsert=!0}this.events={onSuccess:this._onSuccess.bind(this),onFailure:this._onFailure.bind(this),onCancel:this._onCancel.bind(this)}}function f(e){this.options=e,this._setup()}return h.prototype={_setup:function(){this._model=this._internalOptions.model,this._component=this._internalOptions.component,this._typeDetails=this._internalOptions.typeDetails},_onSuccess:function(e){if("success"===e.status){if(e.result.length){let t=e.result[0].type;o.local.set(this._internalOptions.storageKey,t)}this._internalOptions.isInsert?function(e,t){let n=[],i={transactions:[]};for(let o=0;o<e.length;o++){let s=e[o],r={insertExisting:{modified:[],inserted:[],created:[],withContext:!1}};for(let e=0;e<s.relations.length;e++){let o=s.relations[e],a=t.getNodesById(o.fromID);for(let e=0;e<a.length;e++){let t=a[e];r.insertExisting.modified.push(o.fromID);let s=t.getOccurencePath();s.push(o.relationshipID),s.push(o.toID),r.insertExisting.created.push(o.relationshipID),n.push(s),r.insertExisting.inserted.push(s),i.transactions.push(r)}}}c(),t.addPaths({paths:n,callback:function(e){if(e&&e.success){t._cmdProxy.padRefresh(i);let e=t.isGroupingApplied(),o=n.map(function(e){return t.getNodeByOccurencePath(e)});for(let n=0;n<o.length;n++){let i=o[n],r=i.getParent();if(e)for(;r.isGroupingNode;)r=r.getParent();r.setState(s.NODE_STATES.PARTIALLY_EXPANDED),e&&p(t,i)}}}})}(e.result,this._model):u(e.result,this._model,this._component),n.displayNotif({level:"success",message:d.plmnew.creationSuccess})}},_onFailure:function(e){},_onCancel:function(e){let t=e.activateCreateAnother;void 0!==t&&o.local.set(this._internalOptions.repeatKey,t)}},f.prototype={_setup:function(){this._model=this.options.model,this._typeDetails=this.options.typeDetails},execute:function(){return new h(this.options)}},f}),define("DS/ENOPAD_v2/utils/PADInlineEdit",[],function(){return{}}),define("DS/ENOPAD_v2/models/mixins/PADDocOccExcludes",["DS/PADUtils/PADWSAccess","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/views/PADAlert","i18n!DS/ENXNav/assets/nls/ENXNav.json"],function(e,t,n,i,o){"use strict";function s(){n.publish({event:"ENXModel/refresh/complete",data:{skipSyncModel:!0}})}var r=!1;function a(){}return a.prototype={triggerExcludePathsUpdate:function(){let e=this;return new Promise((i,o)=>{if(t.getSetting("activateExcludeOccurrences")&&t.getSetting("activateExcludeOccRefresh")&&!0!==this.isOccModel){n.publish({event:"ENXModel/refresh/begin",data:{}});let t=e.getRoots(),o=[];for(let n=0;n<t.length;n++){let i=t[n];o.push(e._performGetExcluded(i))}Promise.allSettled(o).then(()=>{s(),i()}).catch(()=>{s(),i()})}else i()})},_performGetExcluded:function(t){let n=this;return new Promise((i,o)=>{let s=t.getID();const r={serviceId:"3DSpace",data:{select_bo:["physicalid"],select_rel:["physicalid"],root_path_physicalid:[[s]],rootPhID:s},FBIProxy:n.options.FBIProxy,intent:"explore_2D",onComplete:function(e){try{if(e&&!e.contains("error")){let n=JSON.parse(e),o=[];for(let e=0;e<n.results.length;++e){let t=n.results[e];if(o.push(t.Path),t.matching_lengths)for(let e=0;e<t.matching_lengths.length;++e)o.push(t.Path.slice(0,t.matching_lengths[e]))}t.setExcludedOccurrences(o),i()}else console.error("Error while getting excluded occurrences"),o()}catch(e){console.error(e),o()}},onFailure:function(e){console.log("getExcludedOcc##Failure"),o()},onTimeout:function(){console.log("getExcludedOcc##Timeout"),o()}};e.getStaticMappingExcludedOccurrences(r)})},bubbleStaticMapMessageOnce:function(){if(t.getSetting("activateExcludeOccWarning")&&t.getSetting("staticMappingEnabled")&&!r){r=!0;let e=o.staticMappingFoundinSession2D;e.eventID="warning",i.displayNotification(e)}}},a}),define("DS/ENOPAD_v2/commands/edit/_Paste",["UWA/Class"],function(e){"use strict";return{execute:function(e){e.context.paste()}}}),define("DS/ENOPAD_v2/models/mixins/PADDocEndPoints",["i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADServices/settings/AppSettings","DS/PADServices/utils/PConfigUtils","DS/PADUtils/PADSession","DS/PADServices/ws/WSAccess"],function(e,t,n,i,o){"use strict";function s(){}return s.prototype={_isAuthoring:function(){return i.determineAuthoredFlag()},_getExpandFunc:function(e){let t=void 0!==e?e:this._isAuthoring(),n=void 0!==window.jasmine;return(!this._boundExpandIndex&&!this._boundExpandDB||n)&&(this._boundExpandDB=o.expandv2DBprogressive.bind(o),this._boundExpandIndex=o.expandv2.bind(o)),t?this._boundExpandDB:this._boundExpandIndex},_getFetchFunc:function(e){let t=void 0!==e?e:this._isAuthoring(),n=void 0!==window.jasmine;return(!this._boundFetchIndex&&!this._boundFetchDB||n)&&(this._boundFetchDB=o.fetchDB.bind(o),this._boundFetchIndex=o.fetch.bind(o)),t?this._boundFetchDB:this._boundFetchIndex},_hasMultiRootSupport:function(){return n.isMultiRootSupported()},_getFBI:function(){return this.options.FBIProxy},_getClass:function(){return this.options.nodeModelClass},_getWebApiTimeout:function(){return this._webApiTimeout||(this._webApiTimeout=t.getSetting("webapi_timeout")),this._webApiTimeout},_switchToAuthoring:function(){i.setAuthoringState(!0,e.PADSession_enabling_authoring_mode)},_getAuthoringFlag:function(){return i.determineAuthoredFlag()},_getCmdProxyPtr:function(){return this._cmdProxy}},s}),define("DS/ENOPAD_v2/mixins/_PADCCP",["UWA/Class","DS/PADUtils/PADClipboard","DS/PADUtils/views/PADAlert","DS/PADUtils/views/PADDropConfirm","DS/ENXNav/utils/TwoDAppEvents","DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/modules/ClientDataParser","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,i,o,s,r,a,d){"use strict";var l=e.extend({init:function(){this._parent(arguments),this._acceptedNodes={},this._rejectedNodes={}},acceptNode:function(e){var t=!1;if(!0===e.isRelationsObjectNode)t=!0,this._rejectedNodes.nonPSNodes||(this._rejectedNodes.nonPSNodes={nodes:[]}),this._rejectedNodes.nonPSNodes.nodes.push(e);else{var n=e.getPath(),i=n.length,o=n[0].getID();if(this._acceptedNodes.hasOwnProperty(o)){var s=this._acceptedNodes[o];if(s.depth<=i)s.nodes.push(e);else{var r=e.getFirstCommonAncestor(s.nodes[0]);s.nodes.length=0,s.nodes.push(r),s.depth=r.getPath().length,t=!0}}else this._acceptedNodes[o]={depth:i,nodes:[e]}}return t},applyOnAcceptedNodes:function(e){var t=!0,i=!1,o=!1;for(var s in this._acceptedNodes)if(i=!0,UWA.is(s,"string"))for(var r=this._acceptedNodes[s].nodes,d=0;d<r.length;d++)e(r[d]);return this._rejectedNodes.nonPSNodes&&(o=!0,1===this._rejectedNodes.nonPSNodes.nodes.length?n.displayNotification({msg:a.replace(a.copyNonPSNode,{label:this._rejectedNodes.nonPSNodes.nodes[0].getLabel()}),eventID:"warning"}):this._rejectedNodes.nonPSNodes.nodes.length>=1&&n.displayNotification({msg:a.replace(a.copyNonPSNodes,{length:this._rejectedNodes.nonPSNodes.nodes.length}),eventID:"warning"})),!0===o&&!1===i&&(t=!1),t}});function c(e,t){Date.now();e.withBroadcastSelect(function(){var t=e.getXSO();if(!t.isEmpty()){var i=t.get(),o=!1;i.sort((e,t)=>e._rowID-t._rowID),i.sort(function(e,t){var n=e.getDepth(),i=t.getDepth();return n===i?0:n<i?-1:n>i?1:void 0});var s=new l;if(i.forEach(function(e){o=s.acceptNode(e)||o}),o){Date.now();e.unselectAll();Date.now();!0===s.applyOnAcceptedNodes(function(e){Date.now();e.select()})&&n.displayNotification({msg:a.reselectionFeedback,eventID:"warning"})}}})}function u(e,n){var i=e.getXSO();if(!i.isEmpty()){var o,s=i.get(),r={action:n,objects:[]},a=[];s.forEach(function(t){t.isVisible()&&!0!==t.isRelationsObjectNode&&(o=t.getOccurencePath(),r.objects.push({path:o,labelPath:t.buildPath()}),a.push(e.getNodeByOccurencePath(o)))}),t.setData(t.OBJECT,r),"cut"===n&&g(a)}}var p=[];function g(e){p=e}function h(){return p}return e.extend({activeCutting:!1,activeNodes:[],getActiveNodes:function(){return h()},setStateCuttingNodes:function(e){e&&(this.activeCutting&&this.activeNodes.length>0&&this.setStaUncuttingNodes(this.activeNodes),e.forEach(function(e){e.updateOptions({isBeingCut:!0})}),this.activeCutting=!0,this.activeNodes=e)},setStaUncuttingNodes:function(e){e.length>0&&e.forEach(function(e){e.options.isBeingCut&&e.updateOptions({isBeingCut:!1})}),this.activeCutting=!1,this.activeNodes=[]},copy:function(){var e=this.getPADTreeDocument(),t=e.getSelectedNodes();this.uncut(),g([]),e.withBroadcastSelect(function(){e.withTransactionUpdate(function(){t.forEach(function(e){e.select()})})}),c(e),u(e,"copy")},cut:function(){var e=this.getPADTreeDocument();c(e),u(e,"cut"),this.options.model.setCuttingNodes(h()),this.setStateCuttingNodes(h())},uncut:function(){this.activeCutting&&(this.options.model.setCuttingNodes([]),this.setStaUncuttingNodes(this.activeNodes)),this.getPADTreeDocument().unselectAll(),t.isEmpty(t.OBJECT)||t.clear(t.OBJECT)},resetClipboard:function(){this.uncut()},_processTargets:function(e){var t,n=[],i=[];return e.forEach(function(e){e.isRoot()?n.push(e):(t=e.getID(),i.indexOf(t)<0&&(n.push(e),i.push(t)))}),n},_inputData:function(e,t){var n=[],i=[],o=[];return e.forEach(function(e){var t=e.getRelationID();""===t?n.push(e.getOccurencePath()):-1===i.indexOf(t)&&(i.push(t),n.push(e.getOccurencePath()))}),t.forEach(function(e){o.push(e.getOccurencePath())}),{children:n,parents:o,commit:!0}},_inputDataCopy:function(e,t){var n=[],i=[];return e.forEach(function(e){n.push(e.getOccurencePath())}),t.forEach(function(e){i.push(e.getOccurencePath())}),{children:n,parents:i,commit:!0}},_distinguishInsertReparentCases:function(e,t){var n={insertExisting:[],reparent:[]};return e.forEach(function(e){!e.getRelationID()||"copy"===t?n.insertExisting.push(e):n.reparent.push(e)}),n},paste:function(){var e,l,c=this;function u(e){var t,n=[];return e.forEach(function(e){e.getRelationID()&&(t=e.getParent().getID(),-1===n.indexOf(t)&&n.push(t))}),n}function p(e,t){var n;for(n=0;n<e.length;n++){var i=e[n];if(i.options.resourceid===t)return e.splice(n,1),i}return null}function g(e,t){var n,i,o,s=e.length;if(t){for(n=0;n<s;n++)if((i=e[n]).options.resourceid===t){o=i;break}}else 1===s&&(o=e[0]);return o}function f(e,t){var n,i,o,s=e.length;if(t){var r=[];for(n=0;n<s;n++)(i=e[n]).options.resourceid===t&&r.push(i);if(1==r.length)o=r[0];else if(r.length>1){o=r[0];e.indexOf(o)}}else 1===s&&(o=e[0]);return o}function v(e){for(var t=[],n=c.getPADTreeDocument(),i=0;i<e.length;i++){var o=e[i],s=n.getNodeByOccurencePath(o);s&&t.push(s.getLabel())}return t}this.setStaUncuttingNodes(h());var D=this.getPADTreeDocument(),m=D._confirmDialog||!1,P=0,_=0,A=0,S=D.getXSO();if(!S.isEmpty()){var b=S.get();if(b.some(function(e){return"Drawing"===e.options.type}))return n.displayNotification({msg:d.msg_warning_invalid_parent,eventID:"warning"}),!1;_=(b=this._processTargets(b)).length;var I=d.selected_target;if(_>1&&(I=d.selected_targets),!t.isEmpty(t.OBJECT)){var E=!1;h().length>0&&(E=!0);var y=t.consumeData(t.OBJECT,E),N=y.action;if(N&&(l="copy"===N?"COPY":"MOVE",e=function(e,t){var i=[];return e.objects.forEach(function(e){var o=s.node.exactNodeByPath(t,e.path);if(o&&o.getOccurencePath().length===e.path.length)i.push(o);else{var r=e.labelPath.replace(/\/$/,"");n.displayNotification({msg:r+a.pasteObjectNotInView,eventID:"error"})}}),i}(y,D)),e.length<y.objects.length)return;if(e.length>0){var x=c._distinguishInsertReparentCases(e,N);P=x.reparent.length,A=x.insertExisting.length}if(_*P>1e3)return void n.displayNotification({msg:d.limit_cut_paste,eventID:"error"});var O=function(t){t&&(A>0&&(c.beginBlockingTransaction(a.composite),require(["DS/ApplicationFrame/CommandsManager"],function(t){var i=t.getCommand("InsertExisting"),s=u(e);i.execute({mode:"CopyPaste",internal_call:!0,data:c._inputDataCopy(e,b),onSuccess:function(t){!function(t,i,s){var d,u,h,v,D,m,P,_,A=t.length,S=(i.length,[]),b=c.getPADTreeDocument(),I=[];let E=[];for(d=0;d<A;d++){h=t[d].hasParent,v=t[d].relationid,D=t[d].resourceid,m=t[d].instanceName?t[d].instanceName:"",P=h+"_"+v+"_"+D,u=p(e,D);let n=t[d].clientTaskData;if(n)new r(n).appendPids(E);else{let e=t[0].relationid?t[0].relationid:t[0].resourceid;E.push(e)}u?S.push(u):u=g(S,D);var y,N,x,O=u.getID(),C=u.getRelationID(),w=!Boolean(C);b.wrapInTransaction(function(){b.withTransactionUpdate(function(){if(y=f(i,h))if(N=y.getID(),x={node:u,parent:y,behavior:l,newRelationID:v,instanceName:m},_=h+"_"+y.options.relationid?y.options.relationid:"",P=_+P,I.indexOf(P)<0){b.instantiate(x,s),I.push(P);var e=[],t={transactions:[],origin:"CCP"},n={detach:{}};if(t.transactions.push({insertExisting:{modified:[N],inserted:[O],created:[v],withContext:!w}}),e.push(v),e.length){var r=[];e.forEach(function(e){var t=b.getNodesByRelId(e);t&&r.push(t[0].getOccurencePath())}),t.transactions[0].insertExisting.inserted=r}w||"COPY"===l?(c._commandProxy.padRefresh(t),o.addChild()):(n.detach.deleted=[C],c._commandProxy.padRefresh(t),c._commandProxy.padRefresh(n),o.addChild())}else console.log("already added to targets",x)},c),c.endBlockingTransaction()})}b.refreshNodeById({modified:E}),n.displayNotification({msg:a.pasteSucceeded,eventID:"info"})}(t,b,s)},onFailure:function(e){var t,i,o;i=[],o=[],(t=e)&&t.targets&&(i=v(t.targets)),t&&UWA.is(t.messages,"array")?(t.messages.forEach(function(e){-1===o.indexOf(e)&&o.push(e)}),n.displayNotification({msg:o.join(""),eventID:"error"})):i&&i.length>0&&n.displayNotification({msg:"Failed insert operation in "+i.join(""),eventID:"error"}),c.resetClipboard&&c.resetClipboard(),c.endBlockingTransaction()}})})),P>0&&(c.beginBlockingTransaction(a.composite),require(["DS/ApplicationFrame/CommandsManager"],function(t){var i=t.getCommand("InsertExisting"),s=u(e);i.execute({mode:"CutPaste",internal_call:!0,data:c._inputData(e,b),onSuccess:function(t){!function(t,i,s){var d,u,h,v,D,m,P,_,A,S,b,I,E,y=t.length,N=(i.length,[]),x=c.getPADTreeDocument(),O=[],C=!0,w=[],R=[],T=[],M=[];let B=[];t.forEach(function(e){var t=e.relationid,n=e.hasParent,i=e.resourceid;t&&-1===w.indexOf(t)&&w.push(t),n&&-1===R.indexOf(n)&&R.push(n),i&&-1===M.indexOf(i)&&M.push(i);let o=e.clientTaskData;o&&new r(o).appendPids(B)});var k={newRelationIDs:w,tgtParentIds:R,removedNodeIds:M};for(d=0;d<y;d++){D=t[d].hasParent,u=t[d].relationid,h=t[d].resourceid,I=D+"_"+u+"_"+h,(v=p(e,h))?N.push(v):v=g(N,h);try{A=v.getID(),S=v.getRelationID(),b=!Boolean(S),x.wrapInTransaction(function(){x.withTransactionUpdate(function(){if(m=f(i,D))if(P=m.getID(),_={node:v,parent:m,behavior:l,newRelationID:u},E=D+"_"+m.options.relationid?m.options.relationid:"",I=E+I,O.indexOf(I)<0){x.instantiate(_,s,k),x.refreshNodeById({modified:B}),O.push(I);var e=[],t={transactions:[],origin:"CCP"},n={detach:{deleted:[]}};if(t.transactions.push({insertExisting:{modified:[P],inserted:[A],created:[u],withContext:!b}}),e.push(u),e.length){var r=[];e.forEach(function(e){var t=x.getNodesByRelId(e);t&&t.length&&t.forEach(function(e){r.push(e.getOccurencePath())})}),t.transactions[0].insertExisting.inserted=r}b||"COPY"===l?(c._commandProxy.padRefresh(t),o.addChild()):(c._commandProxy.padRefresh(t),-1===w.indexOf(S)&&-1===T.indexOf(S)&&(T.push(S),n.detach.deleted.push(S),c._commandProxy.padRefresh(n)),o.addChild())}else console.log("already done ")},c)}),c.endBlockingTransaction()}catch(e){c.endBlockingTransaction(),c.resetClipboard&&c.resetClipboard(),n.displayNotification({msg:a.pasteFailed,eventID:"error"}),C=!1}}C&&n.displayNotification({msg:a.pasteSucceeded,eventID:"info"})}(t,b,s)},onFailure:function(e){!function(e){c.endBlockingTransaction();var t=[],i=[];e&&e.targets&&(t=v(e.targets)),e&&UWA.is(e.messages,"array")?(e.messages.forEach(function(e){-1===i.indexOf(e)&&i.push(e)}),n.displayNotification({msg:i.join(""),eventID:"error"})):t&&t.length>0&&n.displayNotification({msg:"Failed reparent operation in "+t.join(""),eventID:"error"}),c.resetClipboard&&c.resetClipboard()}(e)}})})))};if(m){var C=d.all_selected_objects;1===e.length&&(C=e[0]._options.display||e[0]._options.label),1===b.length&&(I=b[0]._options.display||b[0]._options.label);new i({copyMode:l,dropName:C,targetName:I,callback:O})}else O(!0)}}},resetPosition:function(){this._doMove([1,0,0,0,1,0,0,0,1,0,0,0],"RESETPOSITION")},pastePosition:function(){for(var e=t.getData(t.POSITION).matrix.split(","),n=[],i=0;i<e.length;i++)n.push(parseFloat(e[i]));this._doMove(n,"PASTEPOSITION"),t.clear(t.POSITION)},_doMove:function(e,t){var i=this,o=i.getPADTreeDocument();require(["DS/UPSCommands/UPSCmdUtils","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSession"],function(s,r,l){var c={instances:[],onComplete:function(s){if("success"===s.status){for(var c,u=e.toString(),p=0;p<s.results.length;p++)for(var g=o.getNodesByRelId(s.results[p].instance),h=0;h<g.length;h++){var f={relationId:s.results[p].instanceOut,grid:{"positionMatrix-Instance":r.checkNotIdentity(u)?u:void 0}};g[h].updateOptions(f)}switch(t){case"RESETPOSITION":c=a.resetPositionSucceeded;break;case"PASTEPOSITION":c=a.pastePositionSucceeded}n.displayNotification({msg:c,eventID:"info"}),l.setAuthoringState(!0,d.PADSession_disabling_index_authoring),o.pushUpdate(),i._commandProxy.updatePosMatrix(i.newParams),delete i.newParams}else"failure"===s.status&&(n.displayNotification({msg:s.message,eventID:"error"}),o.pushUpdate())},onFailure:function(e){var i,s="";switch(e.messages&&(s=Array.isArray(e.messages)?e.messages[0]:e.messages),t){case"RESETPOSITION":i=s.length>0?a.resetPositionFailedWithError:nlskeys.resetPositionFailed;break;case"PASTEPOSITION":i=s.length>0?a.pastePositionFailedWithError:a.pastePositionFailed}s.length>0&&(i=i.replace("{error}",s)),n.displayNotification({msg:i,eventID:"error"}),o.pushUpdate()}},u=i.getPADTreeDocument(),p=(u._confirmDialog,u.getXSO());if(!p.isEmpty()){for(var g=p.get(),h=0;h<g.length;h++){var f=g[h];("VPMInstance"===f.options.relationtype||""===f.options.relationtype&&"3DShape"!==f.options.type&&"Drawing"!==f.options.type)&&f.getRelationID()&&c.instances.push({instance:f.getRelationID(),nodePath:f.getOccurencePath(),hasPositioningMatrix:e})}if(c.instances.length){!0&&(o.prepareUpdate(),i.newParams={instances:c.instances},s.move3D(c))}}})}})}),define("DS/ENOPAD_v2/commands/EditMode",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/PADUtils/PADContext","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalModelEvents"],function(e,t,n,i,o){"use strict";return t.extend({_triggerFromCmd:null,_context:null,_toolbarActivated:!1,init:function(e){this._parent(e,{});var t=this;this._context=n.get(),this._toolbarActivated=this._context.isToolbarActivated(),!0===this._toolbarActivated?!0===this._context.getEditMode()?this.setState(!1,!1):this.setState(!0,!1):!0===this._context.getEditMode()?this.setState(!0,!1):this.setState(!1,!1),this.onStateChange(function(){t._triggerFromCmd=!1;var e=t.getState();!0===t._toolbarActivated&&(e=!e),t._context.setEditMode(e)}),o.getModelEvents().subscribe({event:"ENXModel/ReadWriteTriggered"},function(e){var n=t.getState();e&&t.isEnabled()&&(t.disable(),t.previousState=n,t.setState(!1)),e||null==t.previousState||(t.enable(),t.setState(t.previousState),delete t.previousState)})}})}),define("DS/ENOPAD_v2/mixins/_PADFolder",["UWA/Core","UWA/Class","DS/PlatformAPI/PlatformAPI","DS/PADUtils/PADSettingsMgt"],function(e,t,n,i){"use strict";return t.extend({requestCurrentFolder:function(){n.publish("FolderEditor.RequestCurrentFolder")},setFolderCommunicationChannel:function(){n.subscribe("FolderEditor.CurrentFolder",this.setCurrentFolder.bind(this)),this.requestCurrentFolder()},getCurrentFolder:function(){return this.getOption("current_folder")&&this.getOption("current_folder")!=={}?this.getOption("current_folder"):null},setCurrentFolder:function(e){this.setOption("current_folder",e);var t="string"==typeof e?JSON.parse(e):e;widget&&i.getSetting("syncSecCtxOnFolderChange")&&(widget.setValue("pad_security_ctx",t.SecurityContext),i.setSetting("pad_security_ctx",t.SecurityContext))},getSecurityContext:function(){return{SecurityContext:i.getSetting("pad_security_ctx"),tenant:i.getSetting("x3dPlatformId")}}})}),define("DS/ENOPAD_v2/commands/edit/_Copy",["UWA/Class"],function(e){"use strict";return{execute:function(e){e.context.copy()}}}),define("DS/ENOPAD_v2/utils/PADBulkEdit",["css!DS/ENOPAD_v2/ENOPAD_v2","UWA/Core","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/UIKIT/Mask","DS/PADUtils/PADWSAccess","DS/PADUtils/views/PADAlert","DS/PADUtils/PADSession","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices"],function(e,t,n,i,o,s,r,a,d,l){"use strict";var c="DS/ENOFloatingPanel/ENOFloatingPanel",u=/^\d+$/;const p=["\v","\t","\n","\r","\f","\v"];function g(e){let t=e,n=p.length;for(let e=0;e<n;e++)t=t.replace(p[e],"");return t}function h(e,t){return parseInt(e.valueItem)-parseInt(t.valueItem)}function f(){var e=document.getElementsByClassName("xnav_component");return e&&1===e.length?e[0]:document.body}var v={cleanStr:g,execute:function(e){var i=e.padcomponent,a=i.getPADDGVView().options,l=a.dgv,c=i.getPADTreeDocument(),u=i.getSelectedNodes(),p=e.cellInfos,h=l.getColumnOrGroup(p.columnID),f=h.dataIndex,D=d.getSetting("bulkEditPCSLimit");if(u.length>D)r.displayNotification({msg:n.replace(n.get("bulkEditPCSLimitExceeded"),{limit:D}),eventID:"warning"});else{var m=require("DS/ENOPAD_v2/utils/PADDGVDirectEdition");switch(f){case"ds6w:responsible":m.changeOwnerCmd(p);break;case"ds6w:reserved":m.reservedCmd(p);break;case"ds6w:status":m.changeMaturityCmd(p);break;case"ds6wg:EnterpriseExtension.V_PartNumber":m.setThePartNumberCmd(p);break;default:o.mask(l.getContent(),n.checkingRights);for(var P={lIds:[],busIDs:[],relIDs:[],attributes:"true"},_=!1,A=0;A<u.length;A++){var S;f.endsWith("-Instance")?(S=u[A].getRelationID())&&S.length>0&&(_=!0,-1===P.relIDs.indexOf(S)&&P.relIDs.push(S)):(S=u[A].getID(),-1===P.busIDs.indexOf(S)&&P.busIDs.push(S))}if(0===P.busIDs.length&&0===P.relIDs.length)return void o.unmask(l.getContent());s.read({data:P,onComplete:function(e){"string"==typeof e&&(e=g(e));var i=t.is(e,"string")?JSON.parse(e):e;o.unmask(l.getContent());for(var s,d,u=[],D=!1,P=0;P<i.results.length;P++){var A,S=i.results[P];if((A=_?c.getNodesByRelId(S.physicalID):c.getNodesById(S.physicalID)).length){var b=A[0],I=d=m._updateNodeModel(A[0],S,_,a),E=!0;I.isEditable&&b.options.edit.editableColumns[f]&&!1===b.options.edit.editableColumns[f].readOnly&&(E=!1,u.push(S.physicalID)),E?(r.displayNotification({msg:n.replace(n.get("accessrightAttrenoteditable_2"),{attr:h.text,label:A[0].getLabel()}),eventID:"warning"}),delete A[0].options.edit):(D=!0,s=I.editableColumns[f].kind,I.editableColumns[f].maxLength)}}if(D)switch(s){case"integer":case"float":case"string":v.editStringAttribute({cellInfos:p,editableIds:u,model:c,dgv:l,editOptions:d,isInstance:_,colOpt:h});break;case"timestamp":v.editDateAttribute({cellInfos:p,editableIds:u,model:c,dgv:l,editOptions:d,isInstance:_,colOpt:h});break;case"boolean":v.editBoolAttribute({cellInfos:p,editableIds:u,model:c,dgv:l,editOptions:d,isInstance:_,colOpt:h});break;case"enum":v.editEnumAttribute({cellInfos:p,editableIds:u,model:c,dgv:l,editOptions:d,isInstance:_,colOpt:h});break;default:console.error("Unknown kind of attribute")}i.notification&&"ERROR"===i.notification.type&&r.displayNotification({msg:i.notification.message,eventID:"info"})},onTimeout:function(){r.displayNotification({msg:n.accessrightCheckTimeout,eventID:"error"}),o.unmask(l.getContent())},onFailure:function(){r.displayNotification({msg:n.accessrightCheckFailed,eventID:"error"}),o.unmask(l.getContent())}})}}},editStringAttribute:function(e){require([c,"DS/Controls/LineEditor","DS/Controls/Button"],function(i,o,s){var r,a="",d=t.createElement("div",{class:"PADEditModalBody stringEdit"}),l=e.editOptions.editableColumns[e.colOpt.dataIndex].mandatory;l=void 0!==l&&l;var c=e.editOptions.editableColumns[e.colOpt.dataIndex].kind;new o({placeholder:n.enterModification,requiredFlag:l,sizeInCharNumber:e.editOptions.editableColumns[e.colOpt.dataIndex].maxLength}).inject(d).addEventListener("uncommittedChange",function(e){var t=!0;a=e.dsModel.valueToCommit,"integer"===c||"real"===c?t=!isNaN(Number(a)):""===a&&e.dsModel.requiredFlag&&(t=!1),r.disabled=!t});var u=t.createElement("div",{class:"PADEditModalFooter"});(r=new s({label:n.apply,emphasize:"primary",touchMode:!0,disabled:l,onClick:function(){v.updateModelOnServer({model:e.model,cellInfos:e.cellInfos,newValue:a,editableIds:e.editableIds,editOptions:e.editOptions,isInstance:e.isInstance,colOpt:e.colOpt}),p.destroy()}})).inject(u),new s({label:n.cancel,touchMode:!0,onClick:function(){p.destroy()}}).inject(u);var p=new i({className:"PADEditModal stringEdit",title:n.replace(n.get("editAttribute"),{attr:e.colOpt.text}),body:d,footer:u,overlay:!0,closable:!0,animate:!0,resizable:!1,visible:!0,autocenter:!0,events:{onClose:function(){p.destroy()}}});document.addEventListener("keyup",function(e){27===e.keyCode&&p&&(p.destroy(),p=null)}),p.inject(f())})},editDateAttribute:function(e){var i=this;require([c,"DS/Controls/DatePicker","DS/Controls/Button"],function(o,s,r){var a,d,l=t.createElement("div",{class:"PADEditModalBody dateEdit"}),c=new Date(Date.now()),u=e.cellInfos.nodeModel.options.grid[e.colOpt.dataIndex];u&&(c=new Date(u));var p=new s({value:c,timePickerFlag:!0}).inject(l),g=i.buildCancelClosure(e.cellInfos.nodeModel);p.addEventListener("change",function(e){a=e.dsModel.value,d.disabled=!1});var h=t.createElement("div",{class:"PADEditModalFooter"});d=new r({label:n.apply,emphasize:"primary",touchMode:!0,disabled:!0,onClick:function(){require([D],function(t){var n=t.convertDateToStandard(a,!0);v.updateModelOnServer({model:e.model,cellInfos:e.cellInfos,newValue:n.valueDB,editableIds:e.editableIds,editOptions:e.editOptions,isInstance:e.isInstance,colOpt:e.colOpt})}),m.destroy()}});var D="DS/WidgetServices/WidgetServices";d.inject(h),new r({label:n.cancel,touchMode:!0,onClick:function(){g(),m.destroy()}}).inject(h);var m=new o({className:"PADEditModal stringEdit",title:n.replace(n.get("editAttribute"),{attr:e.colOpt.text}),body:l,footer:h,overlay:!0,closable:!0,animate:!0,resizable:!1,visible:!0,autocenter:!0,events:{onClose:function(){g(),m.destroy()}}});document.addEventListener("keyup",function(e){27===e.keyCode&&m&&(g(),m.destroy(),m=null)}),m.inject(f())})},editBoolAttribute:function(e){var i=this;require([c,"DS/Controls/ButtonGroup","DS/Controls/Button"],function(o,s,r){var a,d,l=t.createElement("div",{class:"PADEditModalBody boolEdit"}),c=(new s).inject(l);c.addChild(new r({type:"radio",touchMode:!0,label:n.True,value:!0,displayStyle:"lite-borders",icon:{iconName:"check",fontIconSize:"2x",fontIconFamily:WUXManagedFontIcons.Font3DS}})),c.addChild(new r({type:"radio",touchMode:!0,label:n.False,value:!1,displayStyle:"lite-borders",icon:{iconName:"wrong",fontIconSize:"2x",fontIconFamily:WUXManagedFontIcons.Font3DS}})),c.addEventListener("change",function(e){a=e.dsModel.value,d.disabled=!1});var u=i.buildCancelClosure(e.cellInfos.nodeModel),p=t.createElement("div",{class:"PADEditModalFooter"});(d=new r({label:n.apply,emphasize:"primary",touchMode:!0,disabled:!0,onClick:function(){v.updateModelOnServer({model:e.model,cellInfos:e.cellInfos,newValue:a,isBoolean:!0,editableIds:e.editableIds,editOptions:e.editOptions,isInstance:e.isInstance,colOpt:e.colOpt}),g.destroy()}})).inject(p),new r({label:n.cancel,touchMode:!0,onClick:function(){u(),g.destroy()}}).inject(p);var g=new o({className:"PADEditModal boolEdit",title:n.replace(n.get("editAttribute"),{attr:e.colOpt.text}),body:l,footer:p,overlay:!0,closable:!0,animate:!0,resizable:!1,visible:!0,autocenter:!0,events:{onClose:function(){u(),g.destroy()}}});document.addEventListener("keyup",function(e){27===e.keyCode&&g&&(u(),g.destroy(),g=null)}),g.inject(f())})},editEnumAttribute:function(e){var i=this;require([c,"DS/Controls/ComboBox","DS/Controls/Button","DS/Controls/ButtonGroup","DS/Controls/Toggle"],function(o,s,r,a,d){for(var l=e.editOptions.editableColumns[e.colOpt.dataIndex],c=t.createElement("div",{class:"PADEditModalBody PADEditModalBody comboEdit"}),p=function(e){for(var t=0,n=0;n<e.length;n++)u.test(e[n])&&t++;return t===e.length}(l.range),g=[],D=0;D<l.range.length;D++)g.push({labelItem:l.displayRange[D],valueItem:l.range[D]});p&&g.sort(h);var m=i.buildCancelClosure(e.cellInfos.nodeModel),P=new s({elementsList:g,currentValue:l.current,enableSearchFlag:!1}).inject(c),_=t.createElement("div",{class:"PADEditModalFooter"});new r({label:n.apply,emphasize:"primary",touchMode:!0,disabled:!1,onClick:function(){var t=P.value;v.updateModelOnServer({model:e.model,cellInfos:e.cellInfos,newValue:t,editableIds:e.editableIds,editOptions:e.editOptions,isInstance:e.isInstance,colOpt:e.colOpt}),A.destroy()}}).inject(_),new r({label:n.cancel,touchMode:!0,onClick:function(){m(),A.destroy()}}).inject(_);var A=new o({className:"PADEditModal  PADEditModalBody comboEdit",title:n.replace(n.get("editAttribute"),{attr:e.colOpt.text}),body:c,footer:_,overlay:!0,closable:!0,animate:!0,resizable:!1,visible:!0,autocenter:!0,events:{onClose:function(){m(),A.destroy()}}});document.addEventListener("keyup",function(e){27===e.keyCode&&A&&(m(),A.destroy(),A=null)}),A.inject(f())})},buildCancelClosure:function(e){return function(){delete e._updateFromEdit,delete e._editDataIndex,delete e.options.edit}},updateModelOnServer:function(e){var o=[],d=e.colOpt.dataIndex,c="model/bus/";e.isInstance&&(c="model/rel/");for(var u=e.editOptions.editableColumns[d].path,p=e.editOptions.editableColumns[d].selectable,g=0;g<e.editableIds.length;g++){var h={path:c+e.editableIds[g],method:"PATCH",body:[{op:"replace",path:u,value:e.newValue}],queryParams:{select:["physicalid","modified",p]}};o.push(h)}var f={UXName:"Data Grid",client_app_domain:"3DExperience 3DDashboard",client_app_name:l.getAppId()};e.model._beginBlockingTransaction(n.updateAttribute),s.update({data:{metrics:f,requests:o},onComplete:function(o){e.model._endBlockingTransaction(),a.setAuthoringState(!0,i.PADSession_disabling_index_authoring);var s=t.is(o,"string")?JSON.parse(o):o;if(!s.results)throw new Error("Invalid update answer");for(var l=e.model,c=0;c<s.results.length;c++){var u,p=s.results[c],g=p.body.physicalid;u=e.isInstance?l.getNodesByRelId(g):l.getNodesById(g);for(var f,v=h.body[0].path,D=Object.keys(p.body),m=[],P=0;P<D.length;P++){var _=D[P];-1!==_.indexOf(v)&&(f=p.body[_]).notification&&m.push(f.notification)}if(p.body.errors&&p.body.errors.length>0)for(P=0;P<p.body.errors.length;P++)m.push(p.body.errors[P]);if(m&&m.length>0)for(P=0;P<m.length;P++)r.displayNotification({msg:m[P].message,eventID:"warning"});else if(p.body.oldInstancePhysicalid){let e={authored:[{modified:p.body.physicalid,previous:p.body.oldInstancePhysicalid}]};l._onRefresh(e)}else if(u&&u.length>0){if(p.body.oldInstancePhysicalid){let e={authored:[{modified:p.body.physicalid,previous:p.body.oldInstancePhysicalid}]};l._onRefresh(e)}l.withTransactionUpdate(function(){for(var t,n=require("DS/WidgetServices/WidgetServices"),i=e.editOptions,o=0;o<u.length;o++){var s=u[o];if(!t){t={grid:{}};for(var r=Object.getOwnPropertyNames(i.editableColumns),a=0;a<r.length;a++)i.editableColumns[r[a]].selectable&&p.body[i.editableColumns[r[a]].selectable]&&("tree"===r[a]?(t.label=p.body[i.editableColumns[r[a]].selectable].value[0],t.display=t.label,t.oldLabel=t.label):s.options.grid.hasOwnProperty(r[a])&&(p.body[i.editableColumns[r[a]].selectable].value?(t.grid[r[a]]=p.body[i.editableColumns[r[a]].selectable].value[0],"timestamp"===i.editableColumns[r[a]].kind&&(t.grid[r[a]]=n.formatDate(t.grid[r[a]]))):t.grid[r[a]]=""));s.options.grid["ds6w:modified"]&&p.body.modified&&p.body.modified.value&&(t.grid["ds6w:modified"]=n.formatDateObj(p.body.modified.value[0]))}s._updateFromEdit&&delete s._updateFromEdit,s._editDataIndex&&delete s._editDataIndex,s.options.edit&&delete s.options.edit,!0===e.isBoolean&&(t.grid[d]=e.newValue[0]),s.updateOptions(t)}}),r.displayNotification({msg:n.attributeModified,eventID:"success"})}}},onFailure:function(){r.displayNotification({msg:n.attributeModificationFailed,eventID:"warning"}),e.model&&e.editableIds.length&&(e.model._endBlockingTransaction(),e.editableIds.forEach(function(t){var n,i=e.model;(n=i.getNodesById(t)?i.getNodesById(t)[0]:i.getNodesByRelId(t)[0])._updateFromEdit&&delete n._updateFromEdit,n._editDataIndex&&delete n._editDataIndex,n.options.edit&&delete n.options.edit}))}})}};return v}),define("DS/ENOPAD_v2/models/mixins/PADDocCfgHook",["DS/PADUtils/PADUtilsServices","DS/PADServices/utils/Iterator"],function(e,t){"use strict";const n="SUCCESS";function i(){}return i.prototype={subscribeToCfgHook:function(){let i=this;e.subscribeCfgModifyEvent({handler:function(e){let o=e.commandName,s=e.response.results,r=[];switch(o){case"cfgExtendEvolutionEffectivity":(function(e,i){t.iterate(e,function(e){e.status===n&&e.identifier&&i.push(e.identifier)})})(s=e.response.resources,r),r.length&&i.additionalColumnUpdateByModule("CfgEffectivityColumns",{relids:r});break;case"cfgEditEvolution":case"cfgPasteEvolution":!function(e,i){t.iterate(e,function(e){e.status===n&&e.existing&&i.push(e.existing.pid)})}(s,r),r.length&&i.additionalColumnUpdateByModule("CfgEffectivityColumns",{relids:r});break;case"cfgEditConfigurationContext":i.additionalColumnUpdateByModule("CfgConfigurationContextColumn",{pids:e.data.pids});break;case"cfgRevManualComposition":i.additionalColumnUpdateByModule("CfgConfigurationRevisionColumn",{pids:e.data.pids});break;case"cfgReplaceInstantiatedConfigurationByRevision":i.additionalColumnUpdateByModule("CfgProductConfigurationColumn",{relids:e.data.relids});break;default:let a=[];!function(e,i,o){t.iterate(e,function(e){e.status===n&&(e.new?i.push({oldId:e.existing.pid,newId:e.new.pid}):o.push(e.existing.pid))})}(s,a,r),a.length&&i.splitInstance({couples:a,editVariant:!0}),r.length&&i.additionalColumnUpdateByModule("CfgEffectivityColumns",{relids:r})}}})},refreshCfgValues:function(e){this.additionalColumnUpdateByModule("CfgEffectivityColumns",e)}},i}),define("DS/ENOPAD_v2/models/mixins/PADDocGrouping",["DS/PADServices/utils/GlobalModelEvents"],function(e){"use strict";function t(){}return t.prototype={grpGroupingSetup:function(){e.subscribe({event:"ENXModel/Model/ApplyGrouping/Done"},this._applyGroupingDone.bind(this))},_applyGroupingDone:function(e){let t=this.getRoots();for(let e=0;e<t.length;e++){let n=t[e];this.grpIsOtherVisible(n)||this.grpCreateOtherNodeAndHide(n)}},grpCreateOtherNodeAndHide:function(e){let t=this.options.mappedNodes.get(e.getID()),n=t.mapGrpNodes,i=t.grpParams.grouping.groups[0],o=i.predicate,s=i.object.map(e=>e.object),r=this.__createOtherNode(n,e,o,s,t.grpParams.grouping.groups,t);return r.hide(),r},grpGetOtherNode:function(e){let t=this.options.mappedNodes.get(e.getID()).mapGrpNodes.other;if(t)return t.isHidden()&&t.show(),t},grpCheckOtherNodeHide:function(e){let t=this.options.mappedNodes.get(e.getID()).mapGrpNodes.other;t&&!t.hasChildren()&&t.hide()},grpIsOtherVisible:function(e){let t=this.options.mappedNodes.get(e.getID()).mapGrpNodes.other;if(t)return!t.isHidden()},grpIsBsdGroupingApplied:function(){if(!this._isBsdGroupingCalculated){let e=this.options.groupPredicates,t=this._bsdPredicates=function(e){return e.filter(e=>e.startsWith("ds6w:browsingStructure"))}(e);this._isBsdGroupingApplied=t.length>0,this._isBsdGroupingCalculated=!0}return this._isBsdGroupingApplied},grpCreateGroupNode:function(e){let t=e.groupValue,n=e.bsdPredicate,i=e.parentNode,o=this.createNodeModel({isGroupingNode:!0,resourceid:"xnav-groupingNode-"+t+"-"+UUID.v4(),label:t,grid:{groupValue:t},ds6w:n,grp:this.options.grps,groupingIntent:this.options.groups});return i.addChild(o),o.onPreExpand(this._expandGrpNode.bind(this)),o}},t}),define("DS/ENOPAD_v2/models/mixins/PADDocRefresh",["DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/modules/common/Constants","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/Iterator","DS/ENXNav/models/RefreshMask","DS/PADServices/utils/private/TreeDocUpdate","DS/ENXNav/models/NodeUtils","DS/ENXNav/models/SmartNodeOptions","DS/PADUtils/PADSession","DS/PADServices/utils/PConfigUtils","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json"],function(e,t,n,i,o,s,r,a,d,l,c,u){"use strict";function p(){}return p.prototype={refresh:function(){let e=this.getRoots(),t=this._getAuthoringFlag();if(t&&this.isGroupingApplied()){let e=this.options.context.features.grouping;e&&e.displayRefreshMessage()}else if(t){let t=e.filter(function(e){return 0==e.options.isReadOnly&&!e.validFilter}),s=e.filter(function(e){return 1==e.options.isReadOnly&&!e.validFilter}),r=c.isMultiRootSupported()?e.filter(e=>e.validFilter):[];t.map(function(e){return e.getOccurencePath()});var n=s.map(function(e){return e.getOccurencePath()}),i=new Map;t.length>0&&i.set("Author",t),n.length>0&&i.set("Index",s),r.length&&i.set("AuthPConf",r);var o=this;i.forEach(function(e,t){if("AuthPConf"===t)for(var n=0;n<e.length;n++)o._parent({roots:[e[n]],isEditor:!0,isReadOnlyRoot:!1});else o._parent({roots:e,isEditor:!0,isReadOnlyRoot:"Index"===t})})}else this._parent({roots:e,isEditor:!0})}},p}),define("DS/ENOPAD_v2/views/ReadWriteCmd",["css!DS/ENXNav/ENXNav.css","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/ENOPAD_v2/utils/ReadWriteAccessController","DS/Controls/Button","DS/Utilities/Dom","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents"],function(e,t,n,i,o,s,r){"use strict";return{getTypeRepresentation:function(){return{findInCtx:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"find dgv-find",fontIconFamily:1}}}}},read_write:{getCellTooltip:function(e){let t={shortHelp:"Read Write",updateModel:!1};return-1!==e.rowID&&(t=e.nodeModel.options.isReadOnly?{shortHelp:"Index root",updateModel:!1}:{shortHelp:"Authoring root",updateModel:!1}),t},buildColumn:function(e){return Object.assign({dataIndex:"read_write",kind:"findInCtx",width:50,minWidth:50,editableFlag:!1,typeRepresentation:"findInCtx",alignment:"center",customisation:{exportable:{lock:!0,value:!1}},getCellSemantics:function(e){return n.determineReadOnlyIcon(e.nodeModel)}},e)},actionOnClick:function(e,t){var n=e.nodeModel;n.isRoot()&&(void 0!==n.options.isReadOnly&&!0===n.options.isReadOnly?(t.onWrite({paths:[n.getOccurencePath()],fromUI:!0}),r.getModelEvents().publish({event:"ENXModel/ReadWriteTriggered",data:!1})):(t.onRead({paths:[n.getOccurencePath()],fromUI:!0}),r.getModelEvents().publish({event:"ENXModel/ReadWriteTriggered",data:!0})))}}}}),define("DS/ENOPAD_v2/models/PADTreeDocumentRefresh",["UWA/Class","UWA/Class/Promise","DS/ENXNav/models/RefreshHandler","DS/ENXNav/utils/TwoDAppEvents","DS/ENOPAD_v2/models/_PADModelParser","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSession","DS/PADUtils/PADWSAccess","DS/PADUtils/views/PADAlert","DS/PADUtils/views/PADProgressBar","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,i,o,s,r,a,d,l,c,u,p){"use strict";function g(e){e.options.isNotManagedByPS||e.hasChildren()||(e.childComputed=!1)}var h=e.extend({});if(!0!==r.getSetting("refresh_v2")){h.prototype.refresh=function(e){var h=this,f=[],v=function(t){c.off(),i.refresh(),Array.isArray(t)&&0!==t.length||(t=[{msg:u.refresh_ok}]);for(var n=0;n<t.length;n++){var o=t[n];void 0===e.cb?l.displayNotification(o):e.cb(o)}setTimeout(function(){s.publish({event:"ENXModel/SyncModel",data:{refresh:!0}})},100),h.getModelEvents().publish({event:"titleRecalc"})},D=u.refresh_ongoing;e=e||{},this._clearSortOrders(e);var m=e.roots||this.getRoots();if(m.length>0){e.dispatch&&this._commandProxy.refreshModel(),c.on(D);var P=[],_=[],A=[];if(null!=m&&m.forEach(function(e){if(!0===e.options.filtered)A.push(e);else{for(var t=[],n=[e];n.length;){var i=n.pop();if(null!=i&&!0!==i.isRelationsObjectNode)t.push(i.getOccurencePath()),i.getOccurencePath().forEach(function(e){_.indexOf(e)<0&&_.push(e)}),n=n.concat(i.getChildren())}P.push(t)}}),0===P.length&&0===A.length)v();else{var S=[];if(P.length>0){var b=new t(function(t,i){var s,l={session:P,intent:"explore_2D",expand_iter:"1",debug:r.getSetting("enopad_webapis_debug"),type_filter_bo:r.getSetting("type_filter_bo")};d.refresh({data:l,onComplete:function(i){try{var d=UWA.is(i,"string")?JSON.parse(i):i;if(void 0!==d){if(s=h.startTransaction("refresh"),!0===r.getSetting("supportPgpBasedOnDescription"))new n({app_context:r.app_context,treeDocument:h}).complete(!0);var l=a.determineAuthoredFlag(),c=!1;l&&(c=!0),o.process.expand({treedocument:h,root_nodes:m,starting_from_root:d.full_path,response:d,mode:"refresh",needNewStructure:c,expand_level:l?1:-1,security_counts_HTML:null}),l&&function(e){for(var t=e.getRoots(),n=0;n<t.length;n++){var i=t[n];g(i),i.processDescendants({processNode:function(e){g(this)}})}}(h),e&&e.datagrid&&!e.datagrid.isClearSortEnabled()&&h.sortInTreeOrder(m),h.invalidateViewPort(),s&&s.end()}t()}catch(e){var u="Exception thrown during the process of the refresh answer "+e.toString();f.push({msg:u,eventID:"error"}),t()}},onFailure:function(e){f.push({msg:p.generic_service_failure,eventID:"error"}),t()}})});S.push(b)}A.length>0&&S.push(h.doRefreshCV(A,!1)),t.all(S).then(function(){v(f)})}this.withTransactionUpdate(function(){for(var e=UWA.clone(m,!1);e.length;){var t=e.pop();null!=t&&(!0===t.options.isPADHiddenFromServer&&delete t.options.isPADHiddenFromServer,t.isSelected()&&t.unselect(),e=e.concat(t.getChildren()))}})}}}return h}),define("DS/ENOPAD_v2/utils/PADDGVDirectEdition",["UWA/Core","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","text!DS/ENOPAD_v2/assets/PADEditInList.json","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADUtils/PADSettingsMgt","DS/UIKIT/Mask","DS/PADUtils/PADWSAccess","DS/PADUtils/PADSession","DS/ApplicationFrame/CommandsManager","DS/PADUtils/views/PADAlert","DS/ENOPAD_v2/utils/PADBulkEdit","DS/PADServices/utils/AttributesMgt","DS/PADUtils/PADUtilsServices"],function(e,t,n,i,o,s,r,a,d,l,c,u,p){"use strict";var g=["ds6w:type","ds6wg:revision","ds6w:responsible","ds6w:status","ds6w:cadMaster"],h=["ds6w:reserved","ds6w:manufacturable"],f=JSON.parse(n),v=[],D=0,m=[],P=[];const _=["tree","ds6w:description"];var A={editCtxMenuAvailable:function(e,t){var n=A.canColumnBeEditable(e,t);if(!n){var i=e.options.views.datagridview.options.dgv.getColumnOrGroup(t.columnID).dataIndex;-1!==h.indexOf(i)&&(n=!0)}return n},canColumnBeEditable:function(e,t,n){var i=!1,o=e.options.views.datagridview.options.dgv,s=!0===n?t:o.getColumnOrGroup(t.columnID),r=s.dataIndex;if(!0===s.isAdditionalColumn)i=!1;else if(u.isAttributeColumn(r)||"ds6w:label_Instance"===r){if(-1!==g.indexOf(r))i=!1;else if(-1!==h.indexOf(r))i=!0;else if(-1!==f.editableColumnsDataIndex.indexOf(r)&&"inline"===f.editBehavior[r].mode)i=!0;else if(!0===u.isAttributeColumn(r)&&(-1!==r.indexOf("ds6wg:")||-1===r.indexOf("ds6w"))&&-1===f.editableColumnsDataIndex.indexOf(r)){i=!0;var a=r.split(":"),d=(a=a[a.length-1].split("."))[a.length-1];f.editableColumnsDataIndex.push(r),f.editableColumnsAttribute.push(d),f.editBehavior[r]={mode:"inline",attribute:d}}}else i=!1;return i},editCell:function(n){var i=this,o=n.context.options.views.datagridview.options.dgv,a=n.context.options.views.datagridview.options.dgvLayout,d=o.getColumnOrGroup(n.cellInfos.columnID).dataIndex,u=n.cellInfos,p=(n.context,u.nodeModel);switch(u.dataIndex=d,d){case"ds6w:responsible":A.changeOwnerCmd(u);break;case"ds6w:reserved":A.reservedCmd(u);break;case"ds6w:status":A.changeMaturityCmd(u);break;case"ds6wg:EnterpriseExtension.V_PartNumber":A.setThePartNumberCmd(u);break;default:var g={lIds:[p.getID()],attributes:"true"},h=a.getColumnTypeRepresentation(u.columnID),f=!1;if(u.dataIndex.endsWith("-Instance")){if(!u.nodeModel.options.relationid)return;g.lIds=[u.nodeModel.options.relationid],f=!0}r.read({data:g,onComplete:function(s){"string"==typeof s&&(s=c.cleanStr(s));var r=e.is(s,"string")?JSON.parse(s):s;if(console.log("Edit attribute ["+d+"] of type:["+h+"]"),!r.results)throw new Error("Invalid read WS response: no Results");if(r.results.length!==g.lIds.length)throw new Error("Invalid read WS response: Incoherent answer");i._updateNodeModel(u.nodeModel,r.results[0],f,n),o.getColumnOrGroup(n.cellInfos.columnID).getCellEditableState=function(e){if(!n.context.getEditMode())return!1;var t=!1;if(e.nodeModel){var i=e.nodeModel.getID();m[i]&&m[i].editableColumns[d]&&!1===m[i].editableColumns[d].readOnly&&(t=!0)}return t};var a=u.nodeModel.getID();P[a]||(P[a]={displayNotif:!1}),u.nodeModel.options.edit.editableColumns[d]&&!1===u.nodeModel.options.edit.editableColumns[d].readOnly?(o.setCellInEdition(n.cellInfos.cellID),P[a].displayNotif=!1):P[a].displayNotif||(P[a].displayNotif=!0,l.displayNotification({msg:t.editionNotSupported,eventID:"warning"}))},onFailure:function(){s.unmask(o.getContent()),l.displayNotification({msg:t.accessrightfailed,eventID:"warning"})}})}},reservedCmd:function(e){if(!e.nodeModel.isGroupingNode){var t=e.nodeModel.getReferenceValue("ds6w:reserved"),n="ActionBar_ReserveCmd";!0===("boolean"!=typeof t?function(e){if("string"==typeof e)return"TRUE"===e}(t):t)&&(n="ActionBar_UnreserveCmd");var i=d.getCommand(n);i&&i.begin()}},changeMaturityCmd:function(e){if(!e.nodeModel.isGroupingNode){var t=d.getCommand("MaturityHdr");t&&t.begin()}},setThePartNumberCmd:function(e){var t=d.getCommand("SetThePartNumber");t&&t.begin()},changeOwnerCmd:function(e){if(!e.nodeModel.isGroupingNode){var t=d.getCommand("ActionBar_ChangeOwner");t&&t.begin()}},_updateNodeModel:function(e,t,n,i){var o=e,s=0,r={isEditable:t.modifyAccess,editableColumns:{}},a=i.context.options.views.datagridview.options;for(s=0;s<t.basicData.length;s++){var d=t.basicData[s],l=!0===n?d.name+"-Instance":d.name;-1!==f.editableColumnsAttribute.indexOf(l)&&(r.editableColumns[f.editableColumnsDataIndex[f.editableColumnsAttribute.indexOf(l)]]={mandatory:d.mandatory,readOnly:d.readOnly,maxLength:d.maxlength,path:d.path,selectable:d.selectable,kind:d.type,mode:f.editBehavior[f.editableColumnsDataIndex[f.editableColumnsAttribute.indexOf(d.name)]].mode,command:f.editBehavior[f.editableColumnsDataIndex[f.editableColumnsAttribute.indexOf(d.name)]].command})}for(s=0;s<t.data.length;s++){var c=!1;(d=t.data[s]).range&&(c=!0);l=!0===n?d.name+"-Instance":d.name;if(-1!==f.editableColumnsAttribute.indexOf(l)){var u={mandatory:d.mandatory,readOnly:d.readOnly,maxLength:d.maxlength,path:d.path,selectable:d.selectable,kind:d.type,mode:f.editBehavior[f.editableColumnsDataIndex[f.editableColumnsAttribute.indexOf(l)]].mode,command:f.editBehavior[f.editableColumnsDataIndex[f.editableColumnsAttribute.indexOf(l)]].command};c&&"boolean"!==u.kind&&(u.kind="enum",u.range=d.range.slice(),u.displayRange=d.rangeNLS.slice(),d.value?u.current=d.value[0]:u.current=""),"real"==u.kind&&(u.kind="float"),r.editableColumns[f.editableColumnsDataIndex[f.editableColumnsAttribute.indexOf(l)]]=u}}r.editableColumns["ds6w:reserved"]={mode:f.editBehavior["ds6w:reserved"].mode,commands:f.editBehavior["ds6w:reserved"].commands,readOnly:!1},f.editOptions=r,o.options.edit=r;var p=o.getID();if(m[p]=r,i.cellInfos&&r.editableColumns[i.cellInfos.dataIndex])switch(r.editableColumns[i.cellInfos.dataIndex].kind){case"enum":var g={},h="enum"+D++;if(g[h]={stdTemplate:"enumCombo",semantics:{possibleValues:[],valueType:"enumString"}},r.editableColumns[i.cellInfos.dataIndex].range.forEach(function(e,t){g[h].semantics.possibleValues.push({name:e,value:r.editableColumns[i.cellInfos.dataIndex].displayRange[t]})}),-1===v.indexOf(i.cellInfos.dataIndex))if(v.push(i.cellInfos.dataIndex),i.cellInfos)a.dgv.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(g)),a.dgvLayout.setColumnTypeRepresentation(i.cellInfos.columnID,h),a.dgv.getColumnOrGroup(i.cellInfos.columnID).editionPolicy="EditionOnDoubleClick";break;case"boolean":case"timestamp":a.dgv.getColumnOrGroup(i.cellInfos.columnID).editionPolicy="EditionOnDoubleClick"}return r},saveModification:function(n,o){return new Promise(function(s,d){var u=n.options.views.datagridview.options.dgv,g=(n.options.views.datagridview.options.dgvLayout,u.getColumnOrGroup(o.columnID).dataIndex),h=o.nodeModel,v=h.options.edit;v||(v=f.editOptions);var D=v.editableColumns[g].kind,m=v.editableColumns[g].path,P=v.editableColumns[g].selectable,A=h.getID(),S="tree"===g?h.getLabel():h.options.grid[g];if("integer"!=D&&"real"!=D&&"float"!=D||(S=S.toString()),"timestamp"===D){var b=require("DS/WidgetServices/WidgetServices").convertDateToStandard(S,!0);S=b.valueDB}if("enum"===D){var I=v.editableColumns[g].displayRange.findIndex(e=>e===S);S=v.editableColumns[g].range[I]}S=c.cleanStr(S);var E="model/bus/"+A;let y=!1;g.endsWith("-Instance")&&(y=!0,E="model/rel/"+h.getRelationID());var N={UXName:"Data Grid",client_app_domain:"3DExperience 3DDashboard",client_app_name:p.getAppId()},x={path:E,method:"PATCH",body:[{op:"replace",path:m,value:S}],queryParams:{select:["physicalid","modified",P]}};r.update({data:{metrics:N,requests:[x]},onComplete:function(r){var d=e.is(r,"string")?JSON.parse(r):r;if(!d.results||1!==d.results.length){s({message:"Invalid update answer",type:"ERROR"})}for(var c,u=x.body[0].path,p=d.results[0],f=Object.keys(p.body),D=[],m=0;m<f.length;m++){var P=f[m];-1!==P.indexOf(u)&&(c=p.body[P]).notification&&D.push(c.notification)}if("tree"==g&&n.hasActiveDesignExp()&&n.getPseService().updateModifiedAssetTitle(S,A),p.body.errors&&d.UXMessage&&Array.isArray(d.UXMessage))d.UXMessage.forEach(e=>{e&&l.displayNotification({title:i.cannotModifyObject,subtitle:i.ERR_getPredicates,msg:e,eventID:"error"})}),s();else if(p.body.errors&&p.body.errors.length>0)for(m=0;m<p.body.errors.length;m++)D.push(p.body.errors[m]);if(D&&D.length>0)for(m=0;m<D.length;m++)l.displayNotification({msg:D[m].message,eventID:"warning"}),"ERROR"===D[m].type&&s(D[m]);else if(200!==p.status){s({message:"Invalid update answer",type:"ERROR"})}else{a.setAuthoringState(!0,i.PADSession_disabling_index_authoring);var b,I=h.getTreeDocument();if(p.body.oldInstancePhysicalid){let e={authored:[{modified:p.body.physicalid,previous:p.body.oldInstancePhysicalid}]};I._onRefresh(e)}if(h.isRoot()&&function(e){return-1!==_.indexOf(e)}(g)){let e=I._getCmdProxyPtr(),t={modifiedIds:[A],fetchAnswer:{results:[{attributes:[]}]}};t.fetchAnswer.results[0].attributes.push({name:function(e){let t;switch(e){case"tree":t="ds6w:label";break;default:t=e}return t}(g),value:S}),t.fetchAnswer.results[0].attributes.push({name:"resourceid",value:A});let n=Object.keys(h.options.grid);for(m=0;m<n.length;m++)t.fetchAnswer.results[0].attributes.push({name:n[m],value:h.options.grid[n[m]]});e.updatePreviousContent(t)}y?(A=p.body.physicalid,b=I.getNodesByRelId(A)):b=I.getNodesById(A),b&&b.length>0&&(I.withTransactionUpdate(function(){var t,n=require("DS/WidgetServices/WidgetServices"),i=b.map(function(e){if(e.options.edit)return e.options.edit}).filter(function(e){return void 0!==e})[0];i||(i=v);for(var s=0;s<b.length;s++){var r=b[s];if(!t){t={grid:{}};for(var a=Object.getOwnPropertyNames(i.editableColumns),d=0;d<a.length;d++)i.editableColumns[a[d]].selectable&&p.body[i.editableColumns[a[d]].selectable]&&("tree"===a[d]?(t.label=p.body[i.editableColumns[a[d]].selectable].value[0],t.display=t.label,t.oldLabel=t.label,I._triggerTitleUpdate()):e.is(r.options.grid[a[d]])&&(p.body[i.editableColumns[a[d]].selectable].value?(t.grid[a[d]]=p.body[i.editableColumns[a[d]].selectable].value[0],"timestamp"===i.editableColumns[a[d]].kind&&(t.grid[a[d]]=n.formatDate(t.grid[a[d]]))):t.grid[a[d]]=""));r.options.grid["ds6w:modified"]&&p.body.modified&&p.body.modified.value&&(t.grid["ds6w:modified"]=n.formatDateObj(p.body.modified.value[0]))}if(r._updateFromEdit&&delete r._updateFromEdit,r._editDataIndex&&delete r._editDataIndex,r.options.edit&&delete r.options.edit,!0===o.change&&void 0!==o.nodeModel.options.grid[g]){var l=o.nodeModel.options.grid[g];l="boolean"==typeof l?l:"TRUE"===l.toUpperCase(),t.grid[g]=l}r.updateOptions(t)}}),l.displayNotification({msg:t.attributeModified,eventID:"success"})),s()}},onFailure:function(){h._updateFromEdit&&delete h._updateFromEdit,h._editDataIndex&&delete h._editDataIndex,h.options.edit&&delete h.options.edit,l.displayNotification({msg:t.attributeModificationFailed,eventID:"warning"}),s()}})})}};return A}),define("DS/ENOPAD_v2/commands/EditInTableCmd",["DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/ENOPAD_v2/utils/PADDGVDirectEdition"],function(e,t,n,i){"use strict";return t.extend({init:function(e){this._parent(e),this.context=n.get()},currentState:function(){return this.context.getEditMode()?"enabled":"disabled"},isCommandAvailable:function(e){var t=!1;"datagridview"===this.context.getCurrentView()&&(this.context.getSelectedNodes().length>0&&e&&e.params&&e.params.cellInfos&&(t=i.editCtxMenuAvailable(this.context,e.params.cellInfos)));return t},setViewParams:function(e){this.viewParams=e},execute:function(){var e=this;e.viewParams?require(["DS/ENOPAD_v2/utils/PADBulkEdit"],function(t){var n=e.viewParams.cellInfos;e.viewParams=null,t.execute({padcomponent:e.context,cellInfos:n})}):console.warn("View parameters not defined")}})}),define("DS/ENOPAD_v2/views/PADDataGridView",["css!DS/ENOPAD_v2/ENOPAD_v2","DS/ENXNav/views/xNavDataGridView","DS/ApplicationFrame/CommandsManager","DS/ENOPAD_v2/utils/PADDGVDirectEdition","DS/Core/PointerEvents"],function(e,t,n,i,o){"use strict";function s(e){e=Object.assign(e,{doubleClickEvent:{"ds6w:reserved":i.reservedCmd,"ds6w:responsible":i.changeOwnerCmd,"ds6w:status":i.changeMaturityCmd}}),t.call(this,e)}return s.prototype=Object.assign(s.prototype,t.prototype),s.prototype=Object.create(t.prototype),s.prototype.completeCB=function(){var e=this;return new Promise(function(t){var s=e.options.dgv;e.previousValues={},s.addEventListener("preEdit",function(t,n){e.previousValues[n.cellID]=n.cellModel;e.options.context}),s.addEventListener("postEdit",function(t,n){i.saveModification(e.options.context,n).then(function(t){if(t&&"ERROR"===t.type&&t.message)throw new Error(t.message);delete e.previousValues[n.cellID]}).catch(function(t){var i=s.getColumnOrGroup(n.columnID).dataIndex;if("tree"===i)n.nodeModel.setLabel(e.previousValues[n.cellID]);else{var o={grid:{}};o.grid[i]=e.previousValues[n.cellID],n.nodeModel.updateOptions(o),n.nodeModel.setReferenceValue(i,e.previousValues[n.cellID])}delete e.previousValues[n.cellID]})}),s.addEventListener("change",function(t,n){if(-1!==n.columnID&&"boolean"===s.getColumnOrGroup(n.columnID).kind){var o=s.getColumnOrGroup(n.columnID).dataIndex;!0===n.nodeModel.options.grid[o]||"TRUE"===n.nodeModel.options.grid[o]?n.nodeModel.options.grid[o]="TRUE":n.nodeModel.options.grid[o]="FALSE",n.change=!0,i.saveModification(e.options.context,n).then(function(t){if(t&&"ERROR"===t.type&&t.message)throw new Error(t.message);delete e.previousValues[n.cellID]}).catch(function(t){var i=s.getColumnOrGroup(n.columnID).dataIndex;if("tree"===i)n.nodeModel.setLabel(e.previousValues[n.cellID]);else{var o={grid:{}};o.grid[i]=e.previousValues[n.cellID],n.nodeModel.updateOptions(o),n.nodeModel.setReferenceValue(i,e.previousValues[n.cellID])}delete e.previousValues[n.cellID]})}}),s.addEventListener(o.POINTERHIT,function(t,n){if(2===t.multipleHitCount&&!n.isHeader&&n.nodeModel&&-1!==n.columnID&&e.options.context.getEditMode()&&!0!==n.nodeModel.isGroupingNode){if(i.editCtxMenuAvailable(e.options.context,n)){let t={context:e.options.context,cellInfos:n};i.editCell(t)}}}),s.onCopy=function(e){n.getCommand("Copy").begin()},s.onPaste=function(t){s.setUseClipboardFlag(!1);var i=n.getCommand("Paste");i.isEnabled()?i.begin():require(["DS/PADUtils/views/PADAlert","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(t,n){!1===e.options.context.getEditMode()?t.displayNotification({msg:n.edit_mode_disabled,eventID:"warning"}):t.displayNotification({msg:n.must_select,eventID:"warning"})})},s.onCut=function(e){n.getCommand("Cut").begin()},t()})},s.prototype.rowReorder=function(e,t){var n=this;return new Promise(function(i){n.options.dgv.onDropRowHeaderDefault(e,t),i()})},s}),define("DS/ENOPAD_v2/models/PADDocTree",["UWA/Core","DS/ENXNav/models/xNavTreeDoc","DS/ENXNav/models/xNavNodeModel","DS/ENXNav/utils/OFW","DS/ENXNav/utils/TwoDAppEvents","DS/ENOPAD_v2/models/PADTreeDocumentRefresh","DS/PADServices/utils/AttributesMgt","DS/PADServices/utils/CompassUtils","DS/PADServices/utils/HideShowController","DS/ENOXParser/modules/common/Constants","DS/ENOPAD_v2/models/_PADModelParser","DS/ENOXParser/modules/ClientDataParser","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSession","DS/PADUtils/PADWSAccess","DS/PADUtils/PADPredicatesNls","DS/PADUtils/PADUtilsServices","DS/PADUtils/views/PADAlert","DS/PADUtils/utilsWS/WSUtils","DS/ENOPAD_v2/models/mixins/PADDocInserts","DS/ENOPAD_v2/models/mixins/PADDocRefresh","DS/ENOPAD_v2/models/mixins/PADDocProxy","DS/ENOPAD_v2/models/mixins/PADDocCfgHook","DS/ENOPAD_v2/models/mixins/PADDocSupport","DS/ENOPAD_v2/models/mixins/PADDocOccExcludes","DS/PADServices/utils/Generics","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,i,o,s,r,a,d,l,c,u,p,g,h,f,v,D,m,P,_,A,S,b,I,E,y,N){"use strict";function x(){}return x.prototype=Object.assign(x.prototype,P.prototype),x.prototype=Object.assign(x.prototype,_.prototype),x.prototype=Object.assign(x.prototype,b.prototype),x.prototype=Object.assign(x.prototype,A.prototype),x.prototype=Object.assign(x.prototype,S.prototype),x.prototype=Object.assign(x.prototype,I.prototype),t.extend(x,{_active_cutting_nodes:[],init:function(t){var n=p.getSetting("activateEditInTable");!0!==n||e.is(t.shouldBeEditable)||(t.shouldBeEditable=function(e){return!0},t.shouldBeSelected=function(e){return!e.ghostMode}),this._parent(t);var i=this;this._commandProxy=this._cmdProxy,!0===n&&!0!==p.getSetting("activateDGV")&&require(["DS/ENOPAD_v2/mixins/_PADEditInLst"],function(e){i.onNodeModelUpdate(e.onNodeModelUpdate.bind(i))}),this._commandProxy&&this._appendToCommandProxy(),this.subscribeToCfgHook()},broadcastSelect:function(e){this._broadcastSelect=e,!0===this._broadcastSelect&&!0===this.options.authorize_setStructure&&(a.setObject({nodes:this.getSelectedNodes()}),i.setTypesForOFW(this))},setDnDBehavior:function(e){this._copyMode=e},setConfirmdDialog:function(e){this._confirmDialog=e},setCuttingNodes:function(e){this._active_cutting_nodes=e},instantiate:function(t,i,o){let s=t.updatePids||[];var r=t.instanceName?t.instanceName:"",a=o?o.newRelationIDs:[],c=o?o.tgtParentIds:[],u=o?o.removedNodeIds:[],p={},h=i||[],f=t.node,v=t.parent,D=t.behavior,m=t.newRelationID,P=t.ordering,_=v.getID(),A=e.clone(f.options,!1);let S="MOVE"===t.behavior;"COPY"===t.behavior&&(A.childComputed=!1);var b=e.clone(f.options.grid,!1);A.grid=b,S&&!A.children&&(A.children=[],A.childComputed=!1);var I=f.getRelationID(),E=f.options.relationtype,y=!Boolean(I),x=f.getParent()?f.getParent().getID():"",O=this.getRoots(),C=!1,w=this;!!!P&&y||"COPY"===D||(O.forEach(function(e){var t=[];h&&0!==h.length?-1!==h.indexOf(e.getID())?t=e.getNodesByRelId(I):x&&-1!==h.indexOf(x)?t=e.getNodesByRelId(I):c.length>0?-1===c.indexOf(e.getID())&&(a.length>0?-1===a.indexOf(I)&&(t=e.getNodesByRelId(I)):t=e.getNodesByRelId(I)):t=e.getNodesByRelId(I):t=e.getNodesByRelId(I),t.length>0&&t.forEach(function(e){var t=e.getParent();e.isRoot()||(h&&0!==h.length?-1!==h.indexOf(t.getID())&&t.removeChild(e):t.removeChild(e))})}),f.setRelationID(m,E));var R=function(t,n,i){if(n&&n.before&&""!==n.before){var o,s=t.getChildren();for(o=0;o<s.length;o++){var r=s[o];if(r.options.relationid===n.before){try{t.insertBefore(i,r),C=!0}catch(e){throw console.log(e),e}break}}}e.is(t.options.relcount,"number")||(t.options.relcount=0),t.options.relcount=t.options.relcount+1,C||t.addChild(i),S&&t.setState(l.NODE_STATES.PARTIALLY_EXPANDED)};O.forEach(function(i){y&&u.length>0&&-1!==u.indexOf(i.getID())&&(p[i.getID()]=!0);var o=i.getNodesById(_);o&&0!==o.length&&o.forEach(function(i){if(i===v||i.isExpanded()||null===i.options.children||0===i.options.children.length){if(y||"COPY"===D||i!==v){var o=e.clone(f.options,!1);("COPY"===t.behavior||S)&&(o.childComputed=!1),"COPY"===t.behavior&&o.isHiddenStateFrom!==d.FROMS.PGP&&(o.isHiddenState=d.STATES.SHOWN,o.isPADHidden=!1);var s=e.clone(f.options.grid,!1);(e.is(o.relcount,"number")&&o.relcount>0||e.is(o.children,"array")&&o.children.length>0)&&(o.children=[]),h&&-1===h.indexOf(i.getID())?(s.CurrentEvolutionEffectivity="",s.Effectivity="",s.ProjectedEvolutionEffectivity="",s.VariantEffectivity=""):"COPY"===D&&(s.CurrentEvolutionEffectivity="",s.Effectivity="",s.ProjectedEvolutionEffectivity="",s.VariantEffectivity=""),r&&(s.instanceName=r),o.grid=e.clone(s,!1);var a=new n(o),l=o.relationtype;(y||"COPY"===D||c&&c.length>1)&&a.setRelationID(m,l),R(i,P,a)}else if(c&&c.length>1){var u=e.clone(A,!1),p=w.createNodeModel(u),g=f.options.relationtype;p.setRelationID(m,g),R(i,P,p)}else R(i,P,f);i.isExpanded()||i.options.padstate&&"partiallyExpanded"===i.options.padstate||(i.setState({state:"partiallyExpanded"}),i.options.padstate="partiallyExpanded")}else console.log("**3 =========",i)})}),v.isExpanded()||v.options.padstate&&"partiallyExpanded"===v.options.padstate||(v.setState({state:"partiallyExpanded"}),v.options.padstate="partiallyExpanded"),g.setAuthoringState(!0,N.PADSession_disabling_index_authoring),y&&"COPY"!==D&&(0===u.length?this.removeRoot(f):p[f.getID()]&&this.removeRoot(f)),this.invalidateViewPort(),s.length&&w.refreshNodeById({modified:s})},_distinguishInsertReparentCases:function(e){var t={insertExisting:[],reparent:[]},n=this._copyMode;return e.forEach(function(e){!e.getRelationID()||"COPY"===n?t.insertExisting.push(e):t.reparent.push(e)}),t},_inputData:function(e,t){var n=[];return e.forEach(function(e){n.push(e.getOccurencePath())}),{children:n,parents:[t.getOccurencePath()],commit:!0}},_onInsert:function(t,n,i){var s=this._copyMode;"function"==typeof n.getID&&n.getID();var r=this;function a(e,t,n){var i;for(i=0;i<e.length;i++){var o=e[i];let s=o.options;if(s.resourceid===t&&s.relationid===n)return o}return null}function d(e){var d;let c=[];for(d=0;d<e.length;d++){var p=e[d].relationid,g=e[d].resourceid;let D=e[d].originalRelationid;var h=a(t,g,D),f=e[d].instanceName||"";let A=e[d].clientTaskData;if(!h)return void l();if(A){new u(A).appendPids(c)}var v={node:h,parent:n,next:i,behavior:s,newRelationID:p,instanceName:f},m=(h.getID(),n.getID()),P=h.getRelationID(),_=!Boolean(P);r._endBlockingTransaction(),r.wrapInTransaction(function(){r.withTransactionUpdate(function(){r.instantiate(v);var e={transactions:[]},t=r.getNodesByRelId(p)[0].getOccurencePath();_||"COPY"===s?e.transactions.push({insertExisting:{modified:[m],inserted:[t],created:[p],withContext:!_}}):e.transactions.push({reParent:{modified:[m],inserted:[t],created:[p],deleted:[P]}}),r._commandProxy.padRefresh(e),o.addChild()},r)})}c.length&&r.refreshNodeById({modified:c}),D.displayNotification({msg:y.insert_existing_succeeded,eventID:"info"})}function l(t){if(r._endBlockingTransaction(),t&&e.is(t.messages,"array")){var n=[];t.messages.forEach(function(e){-1===n.indexOf(e)&&n.push(e)}),D.displayNotification({msg:n.join(""),eventID:"error"})}r.dropInvitContainer&&r.dropInvitContainer.hide()}function c(e){var d;let l=[];for(d=0;d<e.length;d++){var c=e[d].relationid,g=e[d].resourceid;let A=e[d].originalRelationid;var h=a(t,g,A),f=e[d].instanceName||"";let S=e[d].clientTaskData;if(S){new u(S).appendPids(l)}if(!h)return void p();try{var v={node:h,parent:n,next:i,behavior:s,newRelationID:c,instanceName:f},m=(h.getID(),n.getID()),P=h.getRelationID(),_=!Boolean(P);r._endBlockingTransaction(),r.wrapInTransaction(function(){r.withTransactionUpdate(function(){r.instantiate(v);var e={transactions:[]},t=r.getNodesByRelId(c)[0].getOccurencePath();_?e.transactions.push({insertExisting:{modified:[m],inserted:[t],created:[c],withContext:!_}}):e.transactions.push({reParent:{modified:[m],inserted:[t],created:[c],deleted:[P]}}),r._commandProxy.padRefresh(e),o.addChild()},r),D.displayNotification({msg:y.reparent_succeeded,eventID:"info"})})}catch(e){r._endBlockingTransaction(),D.displayNotification({msg:N.generic_service_failure,eventID:"error"})}}l.length&&r.refreshNodeById({modified:l})}function p(t){if(r._endBlockingTransaction(),t&&e.is(t.messages,"array")){var n=[];t.messages.forEach(function(e){-1===n.indexOf(e)&&n.push(e)}),D.displayNotification({msg:n.join(""),eventID:"error"})}}var g=r._distinguishInsertReparentCases(t);return g.insertExisting.length>0&&(this._beginBlockingTransaction(y.inserting_nodes),require(["DS/ApplicationFrame/CommandsManager"],function(e){e.getCommand("InsertExisting").execute({mode:"CopyPaste",internal_call:!0,data:r._inputData(t,n),onSuccess:d,onFailure:l})})),g.reparent.length>0&&(this._beginBlockingTransaction(y.reparenting),require(["DS/ApplicationFrame/CommandsManager"],function(e){e.getCommand("InsertExisting").execute({mode:"CutPaste",internal_call:!0,data:r._inputData(t,n),onSuccess:c,onFailure:p})})),!1},getOrdering:function(e){var t={};if(!e)return ordering;var n,i,o,s=-1,r=-1,a=-1;return e.forEach(function(e){var d={};(n=e.getParent().getChildren())&&n.length>1&&((s=n.indexOf(e))>-1&&(r=s-1,a=s+1),o=n[r],i=n[a],d.after=o?o.getRelationID():"",d.before=i?i.getRelationID():"",t[e.getRelationID()]=d)}),t},getFetches:function(t){var n=e.clone(t,!1);return n.cbOnProcess=function(e,t){var n={intent:"explore_2D",debug:p.getSetting("enopad_webapis_debug")},i={enopad_webapis:p.getSetting("enopad_webapis"),data:n,pids:t,onComplete:function(n){var i="string"==typeof n?JSON.parse(n):n;if(i.results)for(var o=0,s=i.results.length;o<s;o++){var r=i.results[o];e.setAnswer(t[o],r)}else console.log("handle error in the future")},onFailure:function(t,n){console.log("getFetches.onFailure"),e.reprocess()}};return h.fetch(i)},new m.MassChunkedRequests(n)},getNavigates:function(t){var n=e.clone(t,!1);return n.cbOnProcess=function(t,n){if(n&&n.length>0){var i=e.extend({root_path_physicalid:n,expand_iter:"1",intent:"explore_2D"},p.getWebAPI_Options("navigate"),!0),o={enopad_webapis:p.getSetting("enopad_webapis"),data:i,onComplete:function(e){var i="string"==typeof e?JSON.parse(e):e;i.results?t.setAnswers(n,i.results):console.log("handle error in the future")},onFailure:function(e,t){console.error("getNavigates.onFailure networkError",e),console.error("getNavigates.onFailure serverError ",t)}};return h.navigate(o)}},new m.MassChunkedRequestsLWC(n)},insertNodesSplitFetch:function(t,n){t.toDelete;var i=t.callack,s=t.callback2,r=t.occurencePaths,a=t.parentNodes,d=t.toInsert,l=this,u=[];function g(e){-1===u.indexOf(e.resourceid)&&u.push(e.resourceid),-1===u.indexOf(e.relationid)&&u.push(e.relationid)}var h=[],f={transactions:[]},v=[],m=[],P=[],_={};function A(){D.displayNotification({msg:N.generic_service_failure,eventID:"error"}),l._endBlockingTransaction()}this.wrapInTransaction(function(){var t,n;if(!0===p.getSetting("useLWCWebServices"))!function(){for(var t=Object.keys(d),n=0;n<t.length;n++){var i=t[n];if(e.is(d[i],"array")){for(var o={insertExisting:{modified:[],inserted:[],created:[]}},s=d[i],r=0,a=s.length;r<a;r++){var c=s[r],u=[i,c.relationid,c.resourceid];-1===v.indexOf(u)&&(h.push(c.relationid),v.push(u),o.insertExisting.modified.push(i),o.insertExisting.inserted.push(u),o.insertExisting.created.push(c.relationid),o.insertExisting.withContext=!1),_[c.relationid]||(_[c.relationid]=c.ordering)}if(-1===m.indexOf(i)){m.push(i);var p=l.getNodesById(i);p&&(P=P.concat(p))}f.transactions.push(o)}}}(),t=d.noNotification,delete d.noNotification,l._beginBlockingTransaction(y.inserting_nodes),n={chunkSize:1e3,requests:v,cbOnComplete:function(n){var d;try{var u=n.getAnswers(),p=e.is(u,"string")?JSON.parse(u):u;p.results&&p.results.length>0&&!p.error?(d=l.startTransaction("expand"),c.process.expand({treedocument:l,response:p,root_nodes:a,occurencePaths:r,pathOrdering:_,expand_level:1,mode:"insert"}),!0!==t&&D.displayNotification({msg:y.insert_existing_succeeded,eventID:"info"}),l._endBlockingTransaction(),l._commandProxy.padRefresh(f),o.addChild(),i&&i(),s&&s({expandNodeIds:h})):A()}catch(e){A()}finally{d&&d.end()}},cbOnProgress:function(e,t,n){}},l.getNavigates(n);else{for(var S in d)d.hasOwnProperty(S)&&e.is(d[S],"array")&&d[S].forEach(g);t=d.noNotification,delete d.noNotification,l._beginBlockingTransaction(y.inserting_nodes),n={chunkSize:30,requests:u,cbOnComplete:function(n){u.length;var s=n.getAnswers(),r=e.is(s,"string")?JSON.parse(s):s,a=r.results.length;if(0===a)throw new Error("Cannot find object with the physicalid "+u);if(a!=a)throw new Error("More results than input objects");l.invalidateViewPort(),l.wrapInTransaction(function(){var e=c.process.insert_nodes({treedocument:l,response:r,insert_parameters:d});l._commandProxy.padRefresh(e),o.addChild()},"insert_nodes"),l._endBlockingTransaction(),i&&i(),!0!==t&&D.displayNotification({msg:y.insert_existing_succeeded,eventID:"info"})},cbOnProgress:function(e,t,n){}},l.getFetches(n)}})},updateInstance:function(t){var n=this,i=[],o=t.occurencePaths;o&&(i=o),i&&i.length&&(this.wrapInTransaction(function(){var s=e.extend({root_path_physicalid:i,expand_iter:"0",intent:"explore_2D"},p.getWebAPI_Options("navigate"),!0);console.time("ws-navigate"),h.navigate({enopad_webapis:p.getSetting("enopad_webapis"),data:s,onComplete:function(i){var s;console.timeEnd("ws-navigate");try{var r=e.is(i,"string")?JSON.parse(i):i;r.results&&r.results.length&&(r.error?(console.error("ws-navigate",r.error),t.editCfg&&(console.time("partial_update_instances"),c.update_instances({treedocument:n,response:r,occurencePaths:o,newRelIds:t.newRelIds,editCfg:t.editCfg}),console.timeEnd("partial_update_instances"))):(s=n.startTransaction("update"),console.time("update_instances"),c.update_instances({treedocument:n,response:r,occurencePaths:o,newRelIds:t.newRelIds,editCfg:t.editCfg||!1}),console.timeEnd("update_instances")))}catch(e){console.error("updateInstance:",e)}finally{s&&s.end()}},onFailure:function(e){console.error("ws navigate ",e)}})}),t.expandStates&&t.expandStates.length&&t.expandStates.forEach(function(e){o&&o.forEach(function(t){var i=n.getNodeByOccurencePath(t);if(i&&!i.isExpanded()){var o={numberOfLevelsToExpand:e};i.expandNLevels(o)}})}))},updateRevision:function(e){console.count("updateRevision");if(E.checks.array(e.updateRevision))for(let t=0;t<e.updateRevision.length;t++){let n=e.updateRevision[t];if(n.existing&&n.new&&n.newRevison){let e=this.getNodesById(n.existing)[0],t={grid:{"ds6wg:PLMReference.V_isLastVersion":"FALSE"}};this.withTransactionUpdate(function(){e.updateOptions(t)})}}},_clearSortOrders:function(e){if(e&&e.treelist){var t=e.treelist.getManager();t.getColumns().forEach(function(e){var n=t.getColumnIDFromDataIndex(e.dataIndex);"none"!==t.getColumnOrderState(n)&&t.setColumnOrderState(n,"none")})}},sortInTreeOrder:function(e){e&&e.forEach(function(e){e.sortChildren({isRecursive:!0,sortFunction:function(e,t){if(e.options&&t.options){if(e.options.relationOrder<t.options.relationOrder)return-1;if(e.options.relationOrder>t.options.relationOrder)return 1}return 0}})})},_compositeOrder:function(t,n,i){"function"==typeof n.getID()?n.getID():n.options.resourceid;var s,r=!t.getRelationID(),a=this._copyMode,d=this;function l(s){try{e.is(s)&&e.is(s,"array")&&s.length>0&&(s=s[0].relationid);var r={node:t,parent:n,behavior:a,newRelationID:s,ordering:i},l=(t.getID(),n.getID()),c=t.getRelationID(),u=!Boolean(c);d._endBlockingTransaction(),d.wrapInTransaction(function(){d.withTransactionUpdate(function(){d.instantiate(r);var e={transactions:[]},t=d.getNodesByRelId(s)[0].getOccurencePath();u||"COPY"===a?e.transactions.push({insertExisting:{modified:[l],inserted:[t],created:[s],withContext:!u}}):e.transactions.push({reParent:{modified:[l],inserted:[t],created:[s],deleted:[c]}}),d._commandProxy.padRefresh(e),o.addChild()},d)})}catch(e){d._endBlockingTransaction(),D.displayNotification({msg:N.generic_service_failure,eventID:"error"})}}function c(t){d._endBlockingTransaction(),t&&e.is(t.messages,"array")&&t.messages.forEach(function(e){D.displayNotification({msg:e,eventID:"error"})})}r||"COPY"===a?(s={children:[t.getOccurencePath()],parents:[n.getOccurencePath()],ordering:i,commit:!0},this._beginBlockingTransaction(y.inserting_nodes),require(["DS/ApplicationFrame/CommandsManager"],function(e){e.getCommand("InsertExisting").execute({mode:"CopyPaste",internal_call:!0,data:s,onSuccess:l,onFailure:c})})):(s={children:[t.getOccurencePath()],parents:[n.getOccurencePath()],ordering:i,commit:!0},this._beginBlockingTransaction(y.reparenting),require(["DS/ApplicationFrame/CommandsManager"],function(e){e.getCommand("InsertExisting").execute({mode:"CutPaste",internal_call:!0,data:s,onSuccess:l,onFailure:c})}))},_beginBlockingTransaction:function(e){this.getModelEvents().publish({event:"beginBlockingTransaction",data:e,context:this})},_endBlockingTransaction:function(){this.getModelEvents().publish({event:"endBlockingTransaction",context:this})},_triggerTitleUpdate:function(){var e=this.getRoots();this.getModelEvents().publish({event:"onRootAdded",data:{nb_root:e.length,added_node:e[e.length-1]}})},isEditor:function(){return!0}})}),define("DS/ENOPAD_v2/mixins/PlmNew",["DS/ENOPAD_v2/features/CreateOptionsBuilder","DS/ENOPAD_v2/features/CreateOptionsForDesignExp","DS/ApplicationFrame/CommandsManager"],function(e,t,n){"use strict";const i=["DS/TopBarProxy/TopBarProxy","DS/TopBarProxy/MenuItem"],o=["DS/ENONewWidget/ENONew/Events"],s=["ENONewProductHdr","ENONewPartHdr","ENONewDrawingHdr"];function r(){}return r.prototype={getCreateOptions:function(n){let i={};return(i="ENOExpDesignExperience"==n.newType?new t({model:this.options.model,component:this,typeDetails:n}):new e({model:this.options.model,component:this,typeDetails:n})).execute()},postActionBar:function(){if(this.options.isPlmNew){let e=this,t=this.options.model.getXSO();require(o,function(n){let i=function(t){!function(e,t){let n={editMode:t.getEditMode(),selectedNodes:[]},i=t.getSelectedNodes().map(function(e){return{pid:e.getID(),type:e.options.type,cadMaster:e.options.grid["ds6w:cadMaster"]}});n.selectedNodes=i,e.dispatchEvent("onSelection",n)}(n,e)};t.onEmpty(i),t.onPostAdd(i),t.onPostRemove(i),e.addEvent("editModeModified",i),!1===e.getEditMode()&&i()}),require(i,function(e,t){let i=new e({id:widget.id}),o=s.map(function(e){let i=n.getCommand(e);var o;return{add:new t({label:(o=i,o.getCommandLabel?o.getCommandLabel():o.labelTopBar),onExecute:function(){i.execute()}})}});for(let e=0;e<o.length;e++){let t=o[e];i.addContent(t)}})}}},r}),define("DS/ENOPAD_v2/models/mixins/PADDocBasics",["DS/ENOXParser/modules/common/Constants","DS/ENOPAD_v2/models/_PADModelParser","DS/ENOXParser/modules/ClientDataParser","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSession","DS/PADUtils/PADWSAccess","DS/PADUtils/PADPredicatesNls","DS/PADUtils/PADUtilsServices","DS/PADUtils/views/PADAlert","DS/PADUtils/utilsWS/WSUtils","DS/ENXNav/utils/OFW","DS/ENXNav/utils/TwoDAppEvents","DS/PADServices/utils/CompassUtils","DS/ENOXParser/ParserCV","DS/ENOXParser/modules/PADParserOcc","DS/ENXNav/models/xNavNodeModel","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,i,o,s,r,a,d,l,c,u,p,g,h,f,v,D){function m(){}return m.prototype={broadcastSelect:function(e){this._broadcastSelect=e,!0===this._broadcastSelect&&!0===this.options.authorize_setStructure&&(p.setObject({nodes:this.getSelectedNodes()}),c.setTypesForOFW(this))},setDnDBehavior:function(e){this._copyMode=e},setConfirmdDialog:function(e){this._confirmDialog=e},setCuttingNodes:function(e){this._active_cutting_nodes=e},instantiate:function(t,n,i){let s=t.updatePids||[];var r=t.instanceName?t.instanceName:"",a=i?i.newRelationIDs:[],d=i?i.tgtParentIds:[],l=i?i.removedNodeIds:[],c={},u=n||[],p=t.node,g=t.parent,h=t.behavior,v=t.newRelationID,m=t.ordering,P=g.getID(),_=UWA.clone(p.options,!1);let A="MOVE"===t.behavior;"COPY"===t.behavior&&(_.childComputed=!1);var S=UWA.clone(p.options.grid,!1);_.grid=S,A&&!_.children&&(_.children=[],_.childComputed=!1);var b=p.getRelationID(),I=p.options.relationtype,E=!Boolean(b),y=p.getParent()?p.getParent().getID():"",N=this.getRoots(),x=!1,O=this;!!!m&&E||"COPY"===h||(N.forEach(function(e){var t=[];u&&0!==u.length?-1!==u.indexOf(e.getID())?t=e.getNodesByRelId(b):y&&-1!==u.indexOf(y)?t=e.getNodesByRelId(b):d.length>0?-1===d.indexOf(e.getID())&&(a.length>0?-1===a.indexOf(b)&&(t=e.getNodesByRelId(b)):t=e.getNodesByRelId(b)):t=e.getNodesByRelId(b):t=e.getNodesByRelId(b),t.length>0&&t.forEach(function(e){var t=e.getParent();e.isRoot()||(u&&0!==u.length?-1!==u.indexOf(t.getID())&&t.removeChild(e):t.removeChild(e))})}),p.setRelationID(v,I));var C=function(t,n,i){if(n&&n.before&&""!==n.before){var o,s=t.getChildren();for(o=0;o<s.length;o++){var r=s[o];if(r.options.relationid===n.before){try{t.insertBefore(i,r),x=!0}catch(e){throw console.log(e),e}break}}}UWA.is(t.options.relcount,"number")||(t.options.relcount=0),t.options.relcount=t.options.relcount+1,x||t.addChild(i),A&&t.setState(e.NODE_STATES.PARTIALLY_EXPANDED)};N.forEach(function(e){E&&l.length>0&&-1!==l.indexOf(e.getID())&&(c[e.getID()]=!0);var n=e.getNodesById(P);n&&0!==n.length&&n.forEach(function(e){if(e===g||e.isExpanded()||null===e.options.children||0===e.options.children.length){if(E||"COPY"===h||e!==g){var n=UWA.clone(p.options,!1);("COPY"===t.behavior||A)&&(n.childComputed=!1);var i=UWA.clone(p.options.grid,!1);(UWA.is(n.relcount,"number")&&n.relcount>0||UWA.is(n.children,"array")&&n.children.length>0)&&(n.children=[]),u&&-1===u.indexOf(e.getID())?(i.CurrentEvolutionEffectivity="",i.Effectivity="",i.ProjectedEvolutionEffectivity="",i.VariantEffectivity=""):"COPY"===h&&(i.CurrentEvolutionEffectivity="",i.Effectivity="",i.ProjectedEvolutionEffectivity="",i.VariantEffectivity=""),r&&(i.instanceName=r),n.grid=UWA.clone(i,!1);var o=new f(n),s=n.relationtype;(E||"COPY"===h||d&&d.length>1)&&o.setRelationID(v,s),C(e,m,o)}else if(d&&d.length>1){var a=UWA.clone(_,!1),l=O.createNodeModel(a),c=p.options.relationtype;l.setRelationID(v,c),C(e,m,l)}else C(e,m,p);e.isExpanded()||e.options.padstate&&"partiallyExpanded"===e.options.padstate||(e.setState({state:"partiallyExpanded"}),e.options.padstate="partiallyExpanded")}else console.log("**3 =========",e)})}),g.isExpanded()||g.options.padstate&&"partiallyExpanded"===g.options.padstate||(g.setState({state:"partiallyExpanded"}),g.options.padstate="partiallyExpanded"),o.setAuthoringState(!0,D.PADSession_disabling_index_authoring),E&&"COPY"!==h&&(0===l.length?this.removeRoot(p):c[p.getID()]&&this.removeRoot(p)),this.invalidateViewPort(),s.length&&O.refreshNodeById({modified:s})},_distinguishInsertReparentCases:function(e){var t={insertExisting:[],reparent:[]};let n="COPY"===this._copyMode;e.reduce((e,t)=>(t.isRoot()||n?e.insertExisting.push(t):e.reparent.push(t),e),t);return t},_inputData:function(e,t){var n=[];return e.forEach(function(e){n.push(e.getOccurencePath())}),{children:n,parents:[t.getOccurencePath()],commit:!0}},_onInsert:function(e,t,i){var o=this._copyMode;"function"==typeof t.getID&&t.getID();var s=this;function r(e,t,n){var i;for(i=0;i<e.length;i++){var o=e[i];let s=o.options;if(s.resourceid===t&&s.relationid===n)return o}return null}function a(e){if(s._endBlockingTransaction(),e&&UWA.is(e.messages,"array")){var t=[];e.messages.forEach(function(e){-1===t.indexOf(e)&&t.push(e)}),d.displayNotification({msg:t.join(""),eventID:"error"})}s.dropInvitContainer&&s.dropInvitContainer.hide()}function l(e){if(s._endBlockingTransaction(),e&&UWA.is(e.messages,"array")){var t=[];e.messages.forEach(function(e){-1===t.indexOf(e)&&t.push(e)}),d.displayNotification({msg:t.join(""),eventID:"error"})}}var c=s._distinguishInsertReparentCases(e);return c.insertExisting.length>0&&(this._beginBlockingTransaction(v.inserting_nodes),this._triggerInsertExisting({mode:"CopyPaste",data:s._inputData(e,t),successCallback:function(l){var c;let p=[];for(c=0;c<l.length;c++){var g=l[c].relationid,h=l[c].resourceid;let d=l[c].originalRelationid;var f=r(e,h,d),D=l[c].instanceName||"";let v=l[c].clientTaskData;if(!f)return void a();v&&new n(v).appendPids(p);var m={node:f,parent:t,next:i,behavior:o,newRelationID:g,instanceName:D},P=(f.getID(),t.getID()),_=f.getRelationID(),A=!Boolean(_);s._endBlockingTransaction(),s.wrapInTransaction(function(){s.withTransactionUpdate(function(){s.instantiate(m);var e={transactions:[]},t=s.getNodesByRelId(g)[0].getOccurencePath();A||"COPY"===o?e.transactions.push({insertExisting:{modified:[P],inserted:[t],created:[g],withContext:!A}}):e.transactions.push({reParent:{modified:[P],inserted:[t],created:[g],deleted:[_]}}),s._commandProxy.padRefresh(e),u.addChild()},s)})}p.length&&s.refreshNodeById({modified:p}),d.displayNotification({msg:v.insert_existing_succeeded,eventID:"info"})},failureCallback:a})),c.reparent.length>0&&(this._beginBlockingTransaction(v.reparenting),this._triggerInsertExisting({mode:"CutPaste",data:s._inputData(e,t),successCallback:function(a){var c;let p=[];for(c=0;c<a.length;c++){var g=a[c].relationid,h=a[c].resourceid;let b=a[c].originalRelationid;var f=r(e,h,b),m=a[c].instanceName||"";let I=a[c].clientTaskData;if(I&&new n(I).appendPids(p),!f)return void l();try{var P={node:f,parent:t,next:i,behavior:o,newRelationID:g,instanceName:m},_=(f.getID(),t.getID()),A=f.getRelationID(),S=!Boolean(A);s._endBlockingTransaction(),s.wrapInTransaction(function(){s.withTransactionUpdate(function(){s.instantiate(P);var e={transactions:[]},t=s.getNodesByRelId(g)[0].getOccurencePath();S?e.transactions.push({insertExisting:{modified:[_],inserted:[t],created:[g],withContext:!S}}):e.transactions.push({reParent:{modified:[_],inserted:[t],created:[g],deleted:[A]}}),s._commandProxy.padRefresh(e),u.addChild()},s),d.displayNotification({msg:v.reparent_succeeded,eventID:"info"})})}catch(e){s._endBlockingTransaction(),d.displayNotification({msg:D.generic_service_failure,eventID:"error"})}}p.length&&s.refreshNodeById({modified:p})},failureCallback:l})),!1},_triggerInsertExisting:function(e){require(["DS/ApplicationFrame/CommandsManager"],function(t){t.getCommand("InsertExisting").execute({mode:e.mode,internal_call:!0,data:e.data,onSuccess:e.successCallback,onFailure:e.failureCallback})})},getOrdering:function(e){var t={};if(!e)return ordering;var n,i,o,s=-1,r=-1,a=-1;return e.forEach(function(e){var d={};(n=e.getParent().getChildren())&&n.length>1&&((s=n.indexOf(e))>-1&&(r=s-1,a=s+1),o=n[r],i=n[a],d.after=o?o.getRelationID():"",d.before=i?i.getRelationID():"",t[e.getRelationID()]=d)}),t},getFetches:function(e){var t=UWA.clone(e,!1);return t.cbOnProcess=function(e,t){var n={intent:"explore_2D",debug:i.getSetting("enopad_webapis_debug")},o={enopad_webapis:i.getSetting("enopad_webapis"),data:n,pids:t,onComplete:function(n){var i="string"==typeof n?JSON.parse(n):n;if(i.results)for(var o=0,s=i.results.length;o<s;o++){var r=i.results[o];e.setAnswer(t[o],r)}else console.log("handle error in the future")},onFailure:function(t,n){console.log("getFetches.onFailure"),e.reprocess()}};return s.fetch(o)},new l.MassChunkedRequests(t)},getNavigates:function(e){var t=UWA.clone(e,!1);return t.cbOnProcess=function(e,t){if(t&&t.length>0){var n=UWA.extend({root_path_physicalid:t,expand_iter:"1",intent:"explore_2D"},i.getWebAPI_Options("navigate"),!0),o={enopad_webapis:i.getSetting("enopad_webapis"),data:n,onComplete:function(n){var i="string"==typeof n?JSON.parse(n):n;i.results?e.setAnswers(t,i.results):console.log("handle error in the future")},onFailure:function(e,t){console.error("getNavigates.onFailure networkError",e),console.error("getNavigates.onFailure serverError ",t)}};return s.navigate(o)}},new l.MassChunkedRequestsLWC(t)},insertNodesSplitFetch:function(e,n){e.toDelete;var o=e.callack,s=e.callback2,r=e.occurencePaths,a=e.parentNodes,l=e.toInsert,c=this,p=[];function g(e){-1===p.indexOf(e.resourceid)&&p.push(e.resourceid),-1===p.indexOf(e.relationid)&&p.push(e.relationid)}var h=[],f={transactions:[]},m=[],P=[],_=[],A={};function S(){d.displayNotification({msg:D.generic_service_failure,eventID:"error"}),c._endBlockingTransaction()}this.wrapInTransaction(function(){var e,n;if(!0===i.getSetting("useLWCWebServices"))!function(){for(var e=Object.keys(l),t=0;t<e.length;t++){var n=e[t];if(UWA.is(l[n],"array")){for(var i={insertExisting:{modified:[],inserted:[],created:[]}},o=l[n],s=0,r=o.length;s<r;s++){var a=o[s],d=[n,a.relationid,a.resourceid];-1===m.indexOf(d)&&(h.push(a.relationid),m.push(d),i.insertExisting.modified.push(n),i.insertExisting.inserted.push(d),i.insertExisting.created.push(a.relationid),i.insertExisting.withContext=!1),A[a.relationid]||(A[a.relationid]=a.ordering)}if(-1===P.indexOf(n)){P.push(n);var u=c.getNodesById(n);u&&(_=_.concat(u))}f.transactions.push(i)}}}(),e=l.noNotification,delete l.noNotification,c._beginBlockingTransaction(v.inserting_nodes),n={chunkSize:1e3,requests:m,cbOnComplete:function(n){var i;try{var l=n.getAnswers(),p=UWA.is(l,"string")?JSON.parse(l):l;p.results&&p.results.length>0&&!p.error?(i=c.startTransaction("expand"),t.process.expand({treedocument:c,response:p,root_nodes:a,occurencePaths:r,pathOrdering:A,expand_level:1,mode:"insert"}),!0!==e&&d.displayNotification({msg:v.insert_existing_succeeded,eventID:"info"}),c._endBlockingTransaction(),c._cmdProxy.padRefresh(f),u.addChild(),o&&o(),s&&s({expandNodeIds:h})):S()}catch(e){S()}finally{i&&i.end()}},cbOnProgress:function(e,t,n){}},c.getNavigates(n);else{for(var D in l)l.hasOwnProperty(D)&&UWA.is(l[D],"array")&&l[D].forEach(g);e=l.noNotification,delete l.noNotification,c._beginBlockingTransaction(v.inserting_nodes),n={chunkSize:30,requests:p,cbOnComplete:function(n){p.length;var i=n.getAnswers(),s=UWA.is(i,"string")?JSON.parse(i):i,r=s.results.length;if(0===r)throw new Error("Cannot find object with the physicalid "+p);if(r!=r)throw new Error("More results than input objects");c.invalidateViewPort(),c.wrapInTransaction(function(){var e=t.process.insert_nodes({treedocument:c,response:s,insert_parameters:l});c._commandProxy.padRefresh(e),u.addChild()},"insert_nodes"),c._endBlockingTransaction(),o&&o(),!0!==e&&d.displayNotification({msg:v.insert_existing_succeeded,eventID:"info"})},cbOnProgress:function(e,t,n){}},c.getFetches(n)}})},updateInstance:function(e){e.isOccModel?this.updateInstanceOcc(e):this.updateInstanceV1(e)},updateInstanceOcc:function(e){var t=this;let n={paths:e.occurencePaths,callback:function(n,i){if(n.success&&i.json){let n=i.json.results;e.results=[],n.forEach(t=>{let n=!(!t.from||!t.to)||void 0,i=g.parseNodeOptions_V2({node:t},n);e.results.push(i)}),e.treeDoc=t,h.parseUpdateInstance(e)}}};this.addPaths(n)},updateInstanceV1:function(e){var n=this,o=[],r=e.occurencePaths;r&&(o=r),o&&o.length&&(this.wrapInTransaction(function(){var a=UWA.extend({root_path_physicalid:o,expand_iter:"0",intent:"explore_2D"},i.getWebAPI_Options("navigate"),!0);console.time("ws-navigate"),s.navigate({enopad_webapis:i.getSetting("enopad_webapis"),data:a,onComplete:function(i){var o;console.timeEnd("ws-navigate");try{var s=UWA.is(i,"string")?JSON.parse(i):i;s.results&&s.results.length&&(s.error?(console.error("ws-navigate",s.error),e.editCfg&&(console.time("partial_update_instances"),t.update_instances({treedocument:n,response:s,occurencePaths:r,newRelIds:e.newRelIds,editCfg:e.editCfg}),console.timeEnd("partial_update_instances"))):(o=n.startTransaction("update"),console.time("update_instances"),t.update_instances({treedocument:n,response:s,occurencePaths:r,newRelIds:e.newRelIds,editCfg:e.editCfg||!1}),console.timeEnd("update_instances")))}catch(e){console.error("updateInstance:",e)}finally{o&&o.end()}},onFailure:function(e){console.error("ws navigate ",e)}})}),e.expandStates&&e.expandStates.length&&e.expandStates.forEach(function(e){r&&r.forEach(function(t){var i=n.getNodeByOccurencePath(t);if(i&&!i.isExpanded()){var o={numberOfLevelsToExpand:e};i.expandNLevels(o)}})}))},updateRevision:function(e){console.count("updateRevision");if(Generics.checks.array(e.updateRevision))for(let t=0;t<e.updateRevision.length;t++){let n=e.updateRevision[t];if(n.existing&&n.new&&n.newRevison){let e=this.getNodesById(n.existing)[0],t={grid:{"ds6wg:PLMReference.V_isLastVersion":"FALSE"}};this.withTransactionUpdate(function(){e.updateOptions(t)})}}},_compositeOrder:function(e,t,n){"function"==typeof t.getID()?t.getID():t.options.resourceid;var i,o=!e.getRelationID(),s=this._copyMode,r=this;function a(i){try{UWA.is(i)&&UWA.is(i,"array")&&i.length>0&&(i=i[0].relationid);var o={node:e,parent:t,behavior:s,newRelationID:i,ordering:n},a=(e.getID(),t.getID()),l=e.getRelationID(),c=!Boolean(l);r._endBlockingTransaction(),r.wrapInTransaction(function(){r.withTransactionUpdate(function(){r.instantiate(o);var e={transactions:[]},t=r.getNodesByRelId(i)[0].getOccurencePath();c||"COPY"===s?e.transactions.push({insertExisting:{modified:[a],inserted:[t],created:[i],withContext:!c}}):e.transactions.push({reParent:{modified:[a],inserted:[t],created:[i],deleted:[l]}}),r._commandProxy.padRefresh(e),u.addChild()},r)})}catch(e){r._endBlockingTransaction(),d.displayNotification({msg:D.generic_service_failure,eventID:"error"})}}function l(e){r._endBlockingTransaction(),e&&UWA.is(e.messages,"array")&&e.messages.forEach(function(e){d.displayNotification({msg:e,eventID:"error"})})}o||"COPY"===s?(i={children:[e.getOccurencePath()],parents:[t.getOccurencePath()],ordering:n,commit:!0},this._beginBlockingTransaction(v.inserting_nodes),require(["DS/ApplicationFrame/CommandsManager"],function(e){e.getCommand("InsertExisting").execute({mode:"CopyPaste",internal_call:!0,data:i,onSuccess:a,onFailure:l})})):(i={children:[e.getOccurencePath()],parents:[t.getOccurencePath()],ordering:n,commit:!0},this._beginBlockingTransaction(v.reparenting),require(["DS/ApplicationFrame/CommandsManager"],function(e){e.getCommand("InsertExisting").execute({mode:"CutPaste",internal_call:!0,data:i,onSuccess:a,onFailure:l})}))},_beginBlockingTransaction:function(e){this.getModelEvents().publish({event:"beginBlockingTransaction",data:e,context:this})},_endBlockingTransaction:function(){this.getModelEvents().publish({event:"endBlockingTransaction",context:this})},_triggerTitleUpdate:function(){var e=this.getRoots();this.getModelEvents().publish({event:"onRootAdded",data:{nb_root:e.length,added_node:e[e.length-1]}})},isEditor:function(){return!0}},m}),define("DS/ENOPAD_v2/models/PADDocOcc",["DS/ENXNav/models/xNavTreeDocOcc","DS/PADUtils/PADSettingsMgt","DS/ENOPAD_v2/models/mixins/PADDocAddAndAddPaths","DS/ENOPAD_v2/models/mixins/PADDocExpand","DS/ENOPAD_v2/models/mixins/PADDocRefreshOcc","DS/ENOPAD_v2/models/mixins/PADDocEndPoints","DS/ENOPAD_v2/models/mixins/PADDocBasics","DS/ENOPAD_v2/models/mixins/PADDocInsertsOcc","DS/ENOPAD_v2/models/mixins/PADDocReplace","DS/ENOPAD_v2/models/mixins/PADDocProxy","DS/ENOPAD_v2/models/mixins/PADDocCfgHook","DS/ENOPAD_v2/models/mixins/PADDocGrouping","DS/ENOPAD_v2/models/mixins/PADDocOccExcludesDisabled","DS/ENOPAD_v2/models/mixins/PADDocProductToPartOcc"],function(e,t,n,i,o,s,r,a,d,l,c,u,p,g){function h(){}return h.prototype=Object.assign(h.prototype,n.prototype,i.prototype,o.prototype,s.prototype,r.prototype,a.prototype,d.prototype,l.prototype,c.prototype,u.prototype,p.prototype,g.prototype),e.extend(h,{_active_cutting_nodes:[],init:function(e){!0!==t.getSetting("activateEditInTable")||e.shouldBeEditable||(e.shouldBeSelected=function(e){return!e.ghostMode}),this._parent(e),this._appendToCommandProxy(),this.grpGroupingSetup(),this.subscribeToCfgHook()}})}),define("DS/ENOPAD_v2/models/PADTreeDocument",["UWA/Core","DS/ENXNav/models/xNavDocument","DS/ENXNav/models/xNavNodeModel","DS/ENOPAD_v2/models/PADTreeDocumentRefresh","DS/PADServices/utils/AttributesMgt","DS/ENOPAD_v2/models/_PADModelParser","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSession","DS/PADUtils/PADWSAccess","DS/PADUtils/PADPredicatesNls","DS/PADUtils/views/PADAlert","DS/PADUtils/utilsWS/WSUtils","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,i,o,s,r,a,d,l,c,u,p,g){"use strict";const h=["owner"];return t.extend(i,{_active_cutting_nodes:[],init:function(t){!0!==r.getSetting("activateEditInTable")||e.is(t.shouldBeEditable)||(t.shouldBeEditable=function(e){return!0},t.shouldBeSelected=function(e){return!e.ghostMode}),this._parent(t);var n=this;this._commandProxy&&this._commandProxy.addProxyEvents({events:{onRefresh:function(t){if((e.is(t.authored.created,"array")||e.is(t.authored.modified,"array"))&&(t.authored.origin&&"reserve"===t.authored.origin||n.refreshNodeById({created:t.authored.created,modified:t.authored.modified})),e.is(t.authored.deleted,"array")){var i=[],o=[];t.authored.deleted.forEach(function(e){n.getNodesById(e).forEach(function(t){-1===o.indexOf(e)&&o.push(e)}),i=i.concat(n.getNodesById(e))}),n.deleteNodes(i,!0),require("DS/PADServices/utils/GlobalModelEvents").publish({event:"ENXViews/WelcomePanel/cleanup",data:{item2remove:t.authored.deleted}})}}}})},setDnDBehavior:function(e){this._copyMode=e},setConfirmdDialog:function(e){this._confirmDialog=e},setCuttingNodes:function(e){this._active_cutting_nodes=e},instantiate:function(t,i,o){var s=t.instanceName?t.instanceName:"",r=o?o.newRelationIDs:[],d=o?o.tgtParentIds:[],l=o?o.removedNodeIds:[],c={},u=i||[],p=t.node,h=t.parent,f=t.behavior,v=t.newRelationID,D=t.ordering,m=h.getID(),P=e.clone(p.options,!1),_=e.clone(p.options.grid,!1);P.grid=_;var A=p.getRelationID(),S=p.options.relationtype,b=!Boolean(A),I=p.getParent()?p.getParent().getID():"",E=this.getRoots(),y=!1;!!!D&&b||"COPY"===f||(E.forEach(function(e){var t=[];u&&0!==u.length?-1!==u.indexOf(e.getID())?t=e.getNodesByRelId(A):I&&-1!==u.indexOf(I)?t=e.getNodesByRelId(A):d.length>0?-1===d.indexOf(e.getID())&&(r.length>0?-1===r.indexOf(A)&&(t=e.getNodesByRelId(A)):t=e.getNodesByRelId(A)):t=e.getNodesByRelId(A):t=e.getNodesByRelId(A),t.length>0&&t.forEach(function(e){var t=e.getParent();e.isRoot()||(u&&0!==u.length?-1!==u.indexOf(t.getID())&&t.removeChild(e):t.removeChild(e))})}),p.setRelationID(v,S));var N=function(t,n,i){if(n&&n.before&&""!==n.before){var o,s=t.getChildren();for(o=0;o<s.length;o++){var r=s[o];if(r.options.relationid===n.before){try{t.insertBefore(i,r),y=!0}catch(e){throw console.log(e),e}break}}}e.is(t.options.relcount,"number")||(t.options.relcount=0),t.options.relcount=t.options.relcount+1,y||t.addChild(i)};E.forEach(function(t){b&&l.length>0&&-1!==l.indexOf(t.getID())&&(c[t.getID()]=!0);var i=t.getNodesById(m);i&&0!==i.length&&i.forEach(function(t){if(t===h||t.isExpanded()||null===t.options.children||0===t.options.children.length){if(b||"COPY"===f||t!==h){var i=e.clone(p.options,!1),o=e.clone(p.options.grid,!1);(e.is(i.relcount,"number")&&i.relcount>0||e.is(i.children,"array")&&i.children.length>0)&&(i.children=[]),u&&-1===u.indexOf(t.getID())?(o.CurrentEvolutionEffectivity="",o.Effectivity="",o.ProjectedEvolutionEffectivity="",o.VariantEffectivity=""):"COPY"===f&&(o.CurrentEvolutionEffectivity="",o.Effectivity="",o.ProjectedEvolutionEffectivity="",o.VariantEffectivity=""),s&&(o.instanceName=s),i.grid=e.clone(o,!1);var r=new n(i),a=i.relationtype;(b||"COPY"===f||d&&d.length>1)&&r.setRelationID(v,a),N(t,D,r)}else if(d&&d.length>1){var l=e.clone(P,!1),c=new n(l),g=p.options.relationtype;c.setRelationID(v,g),N(t,D,c)}else N(t,D,p);t.isExpanded()||t.options.padstate&&"partiallyExpanded"===t.options.padstate||(t.setState({state:"partiallyExpanded"}),t.options.padstate="partiallyExpanded")}else console.log("**3 =========",t)})}),h.isExpanded()||h.options.padstate&&"partiallyExpanded"===h.options.padstate||(h.setState({state:"partiallyExpanded"}),h.options.padstate="partiallyExpanded"),a.setAuthoringState(!0,g.PADSession_disabling_index_authoring),b&&"COPY"!==f&&(0===l.length?this.removeRoot(p):c[p.getID()]&&this.removeRoot(p)),this.invalidateViewPort()},_distinguishInsertReparentCases:function(e){var t={insertExisting:[],reparent:[]},n=this._copyMode;return e.forEach(function(e){!e.getRelationID()||"COPY"===n?t.insertExisting.push(e):t.reparent.push(e)}),t},_inputData:function(e,t){var n=[];return e.forEach(function(e){n.push(e.getOccurencePath())}),{children:n,parents:[t.getOccurencePath()],commit:!0}},_onInsert:function(t,n,i){var o=this._copyMode;"function"==typeof n.getID&&n.getID();var s=this;function r(e,t){var n;for(n=0;n<e.length;n++){var i=e[n];if(i.options.resourceid===t)return i}return null}function a(e){var a;for(a=0;a<e.length;a++){var l=e[a].relationid,u=e[a].resourceid,g=r(t,u),h=e[a].instanceName||"";if(!g)return void d();var f={node:g,parent:n,next:i,behavior:o,newRelationID:l,instanceName:h},v=(g.getID(),n.getID()),D=g.getRelationID(),m=!Boolean(D);s._endBlockingTransaction(),s.wrapInTransaction(function(){s.withTransactionUpdate(function(){s.instantiate(f);var e={transactions:[]},t=s.getNodesByRelId(l)[0].getOccurencePath();m||"COPY"===o?e.transactions.push({insertExisting:{modified:[v],inserted:[t],created:[l],withContext:!m}}):e.transactions.push({reParent:{modified:[v],inserted:[t],created:[l],deleted:[D]}}),s._commandProxy.padRefresh(e)},s)})}c.displayNotification({msg:p.insert_existing_succeeded,eventID:"info"})}function d(t){if(s._endBlockingTransaction(),t&&e.is(t.messages,"array")){var n=[];t.messages.forEach(function(e){-1===n.indexOf(e)&&n.push(e)}),c.displayNotification({msg:n.join(""),eventID:"error"})}s.dropInvitContainer&&s.dropInvitContainer.hide()}function l(e){var a;for(a=0;a<e.length;a++){var d=e[a].relationid,l=e[a].resourceid,h=r(t,l),f=e[a].instanceName||"";if(!h)return void u();try{var v={node:h,parent:n,next:i,behavior:o,newRelationID:d,instanceName:f},D=(h.getID(),n.getID()),m=h.getRelationID(),P=!Boolean(m);s._endBlockingTransaction(),s.wrapInTransaction(function(){s.withTransactionUpdate(function(){s.instantiate(v);var e={transactions:[]},t=s.getNodesByRelId(d)[0].getOccurencePath();P?e.transactions.push({insertExisting:{modified:[D],inserted:[t],created:[d],withContext:!P}}):e.transactions.push({reParent:{modified:[D],inserted:[t],created:[d],deleted:[m]}}),s._commandProxy.padRefresh(e)},s),c.displayNotification({msg:p.reparent_succeeded,eventID:"info"})})}catch(e){s._endBlockingTransaction(),c.displayNotification({msg:g.generic_service_failure,eventID:"error"})}}}function u(t){if(s._endBlockingTransaction(),t&&e.is(t.messages,"array")){var n=[];t.messages.forEach(function(e){-1===n.indexOf(e)&&n.push(e)}),c.displayNotification({msg:n.join(""),eventID:"error"})}}var h=s._distinguishInsertReparentCases(t);return h.insertExisting.length>0&&(this._beginBlockingTransaction(p.inserting_nodes),require(["DS/ApplicationFrame/CommandsManager"],function(e){e.getCommand("InsertExisting").execute({mode:"CopyPaste",internal_call:!0,data:s._inputData(t,n),onSuccess:a,onFailure:d})})),h.reparent.length>0&&(this._beginBlockingTransaction(p.reparenting),require(["DS/ApplicationFrame/CommandsManager"],function(e){e.getCommand("InsertExisting").execute({mode:"CutPaste",internal_call:!0,data:s._inputData(t,n),onSuccess:l,onFailure:u})})),!1},getOrdering:function(e){var t={};if(!e)return ordering;var n,i,o,s=-1,r=-1,a=-1;return e.forEach(function(e){var d={};(n=e.getParent().getChildren())&&n.length>1&&((s=n.indexOf(e))>-1&&(r=s-1,a=s+1),o=n[r],i=n[a],d.after=o?o.getRelationID():"",d.before=i?i.getRelationID():"",t[e.getRelationID()]=d)}),t},insertNodes:function(t,i){var a=this,u=[],f=[];function v(e){-1===f.indexOf(e.resourceid)&&f.push(e.resourceid),-1===f.indexOf(e.relationid)&&f.push(e.relationid)}function D(){c.displayNotification({msg:g.generic_service_failure,eventID:"error"}),a._endBlockingTransaction()}var m={transactions:[]},P=[],_=[],A=[],S=[];var b=[];return this.wrapInTransaction(function(){var I;if(e.is(t.created,"array")||e.is(t.inserted,"array"))a.withTransactionUpdate(function(){if(t.created){for(var i=[],r=0;r<t.created.length;r++){var d=s.parse_attributes(t.created[r].attributes,o.getAvailableColumns(),o.getTreeColumn());void 0===d.children&&(d.children=null),e.is(d.relcount,"number")&&d.relcount>0&&(d.children=[]);var c=new n(d);a.addRoot(c),c.select(),i.push(c.getID());var p=a.getRoots().length;e.is(a.detachedRoots,"array")&&(p+=a.detachedRoots.length),u.push(c),a.getModelEvents().publish({event:"onRootAdded",data:{nb_root:p,added_node:c}}),l.updateNLS(c)}var g={pids:i,already_added_in_PS:!0};a._commandProxy.drop(g),a.updateNodesAttrValue(i,h,function(){})}if(t.inserted){for(var f=0;f<t.inserted.length;f++){var v=[];let i=[];var D={insertExisting:{modified:[],inserted:[],created:[]}};a.getRoots().forEach(function(e){v=v.concat(e.getNodesById(t.inserted[f].parent_id))}),t.inserted[f].children.forEach(function(t){v.forEach(function(r){var d=s.parse_attributes(t.attributes,o.getAvailableColumns(),o.getTreeColumn());d.relationid=t.relationid,void 0===d.children&&(d.children=null),e.is(d.relcount,"number")&&d.relcount>0&&(d.children=[]);var c=new n(d);r.addChild(c),r.setState({state:"partiallyExpanded"}),r.options.padstate="partiallyExpanded",D.insertExisting.modified.push(r.getID()),D.insertExisting.inserted.push(c.getOccurencePath()),i.push(c.getID()),P.push(c.getRelationID()),D.insertExisting.created.push(c.getRelationID()),D.insertExisting.withContext=!1,a.updateNodesAttrValue(i,h,function(){}),l.updateNLS(c)})}),m.transactions.push(D)}a._commandProxy.padRefresh(m)}});else if(!0===r.getSetting("useLWCWebServices")){a.unselectAll(),function(n){for(var i=Object.keys(t),o=0;o<i.length;o++){var s=i[o];if(e.is(t[s],"array")){for(var r={insertExisting:{modified:[],inserted:[],created:[]}},d=t[s],l=0,c=d.length;l<c;l++){var u=d[l],p=[s,u.relationid,u.resourceid];-1===_.indexOf(p)&&(_.push(p),r.insertExisting.modified.push(s),r.insertExisting.inserted.push(u.resourceid),P.push(u.relationid),r.insertExisting.created.push(u.relationid),r.insertExisting.withContext=!1)}if(-1===A.indexOf(s)){A.push(s);var g=a.getNodesById(s);g&&(S=S.concat(g),g.forEach(function(e){var t=e.getOccurencePath();-1===b.indexOf(t)&&b.push(t)}))}m.transactions.push(r)}}}(),I=t.noNotification,delete t.noNotification,a._beginBlockingTransaction(p.inserting_nodes);var E=e.extend({root_path_physicalid:_,expand_iter:"0",intent:"explore_2D"},r.getWebAPI_Options("navigate"),!0);d.navigate({enopad_webapis:r.getSetting("enopad_webapis"),data:E,onComplete:function(t){var n;try{var o=e.is(t,"string")?JSON.parse(t):t;o.results&&o.results.length>0&&!o.error?(n=a.startTransaction("expand"),s.process.expand({treedocument:a,response:o,root_nodes:S,occurencePaths:b,expand_level:1,mode:"insert"}),!0!==I&&c.displayNotification({msg:p.insert_existing_succeeded,eventID:"info"}),a._endBlockingTransaction(),i&&i(),function(){if(P.length){var e=[];P.forEach(function(t){var n=a.getNodesByRelId(t);n&&e.push(n[0].getOccurencePath())}),m.transactions[0].insertExisting.inserted=e}}(),a._commandProxy.padRefresh(m)):D()}catch(e){D()}finally{n&&n.end()}},onFailure:function(e){D()}})}else{for(var y in t)t.hasOwnProperty(y)&&e.is(t[y],"array")&&t[y].forEach(v);I=t.noNotification,delete t.noNotification,a._beginBlockingTransaction(p.inserting_nodes);var N={intent:"explore_2D",debug:r.getSetting("enopad_webapis_debug")};d.fetch({enopad_webapis:r.getSetting("enopad_webapis"),data:N,pids:f,onComplete:function(n){a.invalidateViewPort();var o=e.is(n,"string")?JSON.parse(n):n;if(0===o.results.length)throw new Error("Cannot find object with the physicalid "+f);if(o.results.length!==f.length)throw new Error("More results than input objects");a.wrapInTransaction(function(){var e=s.process.insert_nodes({treedocument:a,response:o,insert_parameters:t});a._commandProxy.padRefresh(e)},"insert_nodes"),a._endBlockingTransaction(),i&&i(),!0!==I&&c.displayNotification({msg:p.insert_existing_succeeded,eventID:"info"})},onFailure:function(e){c.displayNotification({msg:g.generic_service_failure,eventID:"error"}),a._endBlockingTransaction()}})}}),u},getFetches:function(t){var n=e.clone(t,!1);return n.cbOnProcess=function(e,t){var n={intent:"explore_2D",debug:r.getSetting("enopad_webapis_debug")},i={enopad_webapis:r.getSetting("enopad_webapis"),data:n,pids:t,onComplete:function(n){var i="string"==typeof n?JSON.parse(n):n;if(i.results)for(var o=0,s=i.results.length;o<s;o++){var r=i.results[o];e.setAnswer(t[o],r)}else console.log("handle error in the future")},onFailure:function(t,n){console.log("getFetches.onFailure"),e.reprocess()}};return d.fetch(i)},new u.MassChunkedRequests(n)},getNavigates:function(t){var n=e.clone(t,!1);return n.cbOnProcess=function(t,n){if(n&&n.length>0){var i=e.extend({root_path_physicalid:n,expand_iter:"1",intent:"explore_2D"},r.getWebAPI_Options("navigate"),!0),o={enopad_webapis:r.getSetting("enopad_webapis"),data:i,onComplete:function(e){var i="string"==typeof e?JSON.parse(e):e;i.results?t.setAnswers(n,i.results):console.log("handle error in the future")},onFailure:function(e,t){console.error("getNavigates.onFailure networkError",e),console.error("getNavigates.onFailure serverError ",t)}};return d.navigate(o)}},new u.MassChunkedRequestsLWC(n)},insertNodesSplitFetch:function(t,n){t.toDelete;var i=t.callack,o=t.callback2,a=t.occurencePaths,d=t.parentNodes,l=t.toInsert,u=this,h=[];function f(e){-1===h.indexOf(e.resourceid)&&h.push(e.resourceid),-1===h.indexOf(e.relationid)&&h.push(e.relationid)}var v=[],D={transactions:[]},m=[],P=[],_=[],A={};function S(){c.displayNotification({msg:g.generic_service_failure,eventID:"error"}),u._endBlockingTransaction()}this.wrapInTransaction(function(){var t,n;if(!0===r.getSetting("useLWCWebServices"))!function(){for(var t=Object.keys(l),n=0;n<t.length;n++){var i=t[n];if(e.is(l[i],"array")){for(var o={insertExisting:{modified:[],inserted:[],created:[]}},s=l[i],r=0,a=s.length;r<a;r++){var d=s[r],c=[i,d.relationid,d.resourceid];-1===m.indexOf(c)&&(v.push(d.relationid),m.push(c),o.insertExisting.modified.push(i),o.insertExisting.inserted.push(c),o.insertExisting.created.push(d.relationid),o.insertExisting.withContext=!1),A[d.relationid]||(A[d.relationid]=d.ordering)}if(-1===P.indexOf(i)){P.push(i);var p=u.getNodesById(i);p&&(_=_.concat(p))}D.transactions.push(o)}}}(),t=l.noNotification,delete l.noNotification,u._beginBlockingTransaction(p.inserting_nodes),n={chunkSize:1e3,requests:m,cbOnComplete:function(n){var r;try{var l=n.getAnswers(),g=e.is(l,"string")?JSON.parse(l):l;g.results&&g.results.length>0&&!g.error?(r=u.startTransaction("expand"),s.process.expand({treedocument:u,response:g,root_nodes:d,occurencePaths:a,pathOrdering:A,expand_level:1,mode:"insert"}),!0!==t&&c.displayNotification({msg:p.insert_existing_succeeded,eventID:"info"}),u._endBlockingTransaction(),u._commandProxy.padRefresh(D),i&&i(),o&&o({expandNodeIds:v})):S()}catch(e){S()}finally{r&&r.end()}},cbOnProgress:function(e,t,n){}},u.getNavigates(n);else{for(var g in l)l.hasOwnProperty(g)&&e.is(l[g],"array")&&l[g].forEach(f);t=l.noNotification,delete l.noNotification,u._beginBlockingTransaction(p.inserting_nodes),n={chunkSize:30,requests:h,cbOnComplete:function(n){h.length;var o=n.getAnswers(),r=e.is(o,"string")?JSON.parse(o):o,a=r.results.length;if(0===a)throw new Error("Cannot find object with the physicalid "+h);if(a!=a)throw new Error("More results than input objects");u.invalidateViewPort(),u.wrapInTransaction(function(){var e=s.process.insert_nodes({treedocument:u,response:r,insert_parameters:l});u._commandProxy.padRefresh(e)},"insert_nodes"),u._endBlockingTransaction(),i&&i(),!0!==t&&c.displayNotification({msg:p.insert_existing_succeeded,eventID:"info"})},cbOnProgress:function(e,t,n){}},u.getFetches(n)}})},updateInstance:function(t){var n=this,i=[],o=t.occurencePaths;o&&(i=o),i&&i.length&&(this.wrapInTransaction(function(){var a=e.extend({root_path_physicalid:i,expand_iter:"0",intent:"explore_2D"},r.getWebAPI_Options("navigate"),!0);console.time("ws-navigate"),d.navigate({enopad_webapis:r.getSetting("enopad_webapis"),data:a,onComplete:function(i){var r;console.timeEnd("ws-navigate");try{var a=e.is(i,"string")?JSON.parse(i):i;a.results&&a.results.length&&(a.error?(console.error("ws-navigate",a.error),t.editCfg&&(console.time("partial_update_instances"),s.update_instances({treedocument:n,response:a,occurencePaths:o,newRelIds:t.newRelIds,editCfg:t.editCfg}),console.timeEnd("partial_update_instances"))):(r=n.startTransaction("update"),console.time("update_instances"),s.update_instances({treedocument:n,response:a,occurencePaths:o,newRelIds:t.newRelIds,editCfg:t.editCfg||!1}),console.timeEnd("update_instances")))}catch(e){console.error("updateInstance:",e)}finally{r&&r.end()}},onFailure:function(e){console.error("ws navigate ",e)}})}),t.expandStates&&t.expandStates.length&&t.expandStates.forEach(function(e){o&&o.forEach(function(t){var i=n.getNodeByOccurencePath(t);if(i&&!i.isExpanded()){var o={numberOfLevelsToExpand:e};i.expandNLevels(o)}})}))},updateRevision:function(t){console.count("updateRevision");var n,i=[],o=[];if(e.is(t.updateRevision,"array")){t.updateRevision.forEach(function(e){-1===i.indexOf(e.existing)&&i.push(e.existing)});for(var s,r=this.getRoots(),a=e.clone(r,!1);a.length;){var d=a.pop();d&&(-1!==i.indexOf(d.getID())&&(n=d.options.grid["ds6wg:PLMReference.V_isLastVersion"],d.options.grid["ds6wg:revision"],d.options.lable||d.options.display,n&&o.push(d)),(s=d.getChildren())&&s.length&&(a=a.concat(s)))}o.length>0&&this.withTransactionUpdate(function(){o.forEach(function(e){var t={resourceid:e.getID(),grid:{"ds6wg:PLMReference.V_isLastVersion":"FALSE"}};e.updateOptions(t)})})}},_clearSortOrders:function(e){if(e&&e.treelist){var t=e.treelist.getManager();t.getColumns().forEach(function(e){var n=t.getColumnIDFromDataIndex(e.dataIndex);"none"!==t.getColumnOrderState(n)&&t.setColumnOrderState(n,"none")})}},sortInTreeOrder:function(e){e&&e.forEach(function(e){e.sortChildren({isRecursive:!0,sortFunction:function(e,t){if(e.options&&t.options){if(e.options.relationOrder<t.options.relationOrder)return-1;if(e.options.relationOrder>t.options.relationOrder)return 1}return 0}})})},_compositeOrder:function(t,n,i){"function"==typeof n.getID()?n.getID():n.options.resourceid;var o,s=!t.getRelationID(),r=this._copyMode,a=this;function d(o){try{e.is(o)&&e.is(o,"array")&&o.length>0&&(o=o[0].relationid);var s={node:t,parent:n,behavior:r,newRelationID:o,ordering:i},d=(t.getID(),n.getID()),l=t.getRelationID(),u=!Boolean(l);a._endBlockingTransaction(),a.wrapInTransaction(function(){a.withTransactionUpdate(function(){a.instantiate(s);var e={transactions:[]},t=a.getNodesByRelId(o)[0].getOccurencePath();u||"COPY"===r?e.transactions.push({insertExisting:{modified:[d],inserted:[t],created:[o],withContext:!u}}):e.transactions.push({reParent:{modified:[d],inserted:[t],created:[o],deleted:[l]}}),a._commandProxy.padRefresh(e)},a)})}catch(e){a._endBlockingTransaction(),c.displayNotification({msg:g.generic_service_failure,eventID:"error"})}}function l(t){a._endBlockingTransaction(),t&&e.is(t.messages,"array")&&t.messages.forEach(function(e){c.displayNotification({msg:e,eventID:"error"})})}s||"COPY"===r?(o={children:[t.getOccurencePath()],parents:[n.getOccurencePath()],ordering:i,commit:!0},this._beginBlockingTransaction(p.inserting_nodes),require(["DS/ApplicationFrame/CommandsManager"],function(e){e.getCommand("InsertExisting").execute({mode:"CopyPaste",internal_call:!0,data:o,onSuccess:d,onFailure:l})})):(o={children:[t.getOccurencePath()],parents:[n.getOccurencePath()],ordering:i,commit:!0},this._beginBlockingTransaction(p.reparenting),require(["DS/ApplicationFrame/CommandsManager"],function(e){e.getCommand("InsertExisting").execute({mode:"CutPaste",internal_call:!0,data:o,onSuccess:d,onFailure:l})}))},_beginBlockingTransaction:function(e){this.getModelEvents().publish({event:"beginBlockingTransaction",data:e,context:this})},_endBlockingTransaction:function(){this.getModelEvents().publish({event:"endBlockingTransaction",context:this})},_triggerTitleUpdate:function(){var e=this.getRoots();this.getModelEvents().publish({event:"onRootAdded",data:{nb_root:e.length,added_node:e[e.length-1]}})}})}),define("DS/ENOPAD_v2/models/PADTreeDocumentRedirector",["DS/ENOPAD_v2/models/PADTreeDocument","DS/ENOPAD_v2/models/PADDocTree","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalUtils"],function(e,t,n,i){let o=e;return(n.getSetting("expandV2PS")||"true"===i.getURLParameter("expandV2PS"))&&(o=t),o});const TermAMDOne="DS/TerminologySelector/service/TerminologyWebService";define("DS/ENOPAD_v2/features/BrowsingStructureDefinition",["DS/PlatformAPI/PlatformAPI",TermAMDOne,"DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/Iterator","DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/modules/BsdParser","DS/ENOPAD_v2/features/private/BsdInfoCache","DS/PADUtils/PADSession","DS/Utilities/UUID","i18n!DS/ENOPAD_v2/assets/nls/ENOPAD_v2.json","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,i,o,s,r,a,d,l,c,u){function p(e){let t=e;for(;!t.isExpanded();)t._uiOnlyExpand=!0,t.expand(),t=t.getParent()}function g(e,t){let n=t.ds6w;return e.filter(function(e){return e===n}).length>0}function h(e,t){let n;return o.iterateObj(e,function(e){o.iterateObj(e,function(e){let i=e.options.grid.groupValue;"Other"!==i&&i===t&&(n=e)})}),n}function f(){d.setAuthoringState(!0,u.PADSession_disabling_index_authoring)}function v(e){return!0===e.getParent().isGroupingNode}function D(e){this.options=e,this._setup()}return D.prototype={_setup:function(){this._map=new Map,this._resMap=new Map,e.subscribe("BrowsingStructureAssociationUpdate",this._browsingStructureUpdate.bind(this)),i.subscribe({event:"ENXModel/Model/ApplyGrouping"},this.__applyGroupingEvent.bind(this))},_browsingStructureUpdate:function(e){if(e.widgetID===n.getWidgetId()&&(console.log(e),this.isGroupingAndBsd())){let t=new r({data:e}),n=this.options.context.options.model,i=n.options.mapGrpNodes;if(t.relidsAffected.length){let e=t.relidsAffected.map(function(e){return n.getNodesByRelId(e)}).reduce(function(e,t){return e.concat(t)},[]);t.hasNodeRemoves&&(!function(e,t,n,i){for(var s=0;s<e.length;s++)g(t,e[s])&&o.iterate(i,function(e){if(v(e)){let t=n.grpGetOtherNode(e.getRoot());t&&t!==e.getParent()&&(t.addChild(e),p(t))}})}(t.removeNodes,n._bsdPredicates,n,e),f()),t.hasNodeAdds&&(!function(e,t,n,i,s,r){for(let r=0;r<e.length;r++){let a=e[r];if(g(t,a)){let e=h(n,a.nodeTitle);if(e)o.iterate(s,function(t){v(t)&&(e.addChild(t),i.grpCheckOtherNodeHide(e.getRoot()),p(e))});else if(a.pathTitle){let e,r=a.pathTitle.slice(),d=e=s[0].getRoot(),l=0;for(;r.length;){let o=current=r.pop(),s=h(n,o);if(s)d=s;else{let n={groupValue:o,parentNode:d,bsdPredicates:t[0]},s=i.grpCreateGroupNode(n);if(0===l&&i.grpIsOtherVisible(e)){let t=i.grpGetOtherNode(e);d.insertBefore(s,t)}d=s}l++}o.iterate(s,function(e){d.addChild(e)}),p(d),i.grpCheckOtherNodeHide(d.getRoot())}}}}(t.addNodes,n._bsdPredicates,i,n,e),f())}}},isGroupingAndBsd:function(){let e=this.options.context.options.model,t=e.isGroupingApplied(),n=!1;return t&&(n=e.grpIsBsdGroupingApplied()),t&&n},moveToGroupingNode:function(e,i){let o=i.options.grid.groupValue,s="Other"!==o,r={itemsID:[],nodesToAttach:[],nodesToDetach:[]},a=e.filter(function(e){return!0===e.getParent().isGroupingNode});a.length!==e.length&&n.displayNotif({title:c.nothingOverFirstLevel.title,message:c.nothingOverFirstLevel.message,level:"warning"});for(let e=0;e<a.length;e++){let t=a[e],n=t.getParent();if(r.itemsID.push(t.getRelationID()),n.isGroupingNode){let e=n.options.grid.groupValue;if("Other"!==e){let t=this._map.get(e).resourceid;r.nodesToDetach.push(t)}if(s){let e=this._map.get(o).resourceid;r.nodesToAttach.push(e)}}}t.updateNodes(r).then(function(e){if(console.log(e),e.success){for(let e=0;e<a.length;e++)i.addChild(a[e]);p(i),f()}}).catch(function(e){console.log(e)})},__applyGroupingEvent:function(e){let t=e.groups.map(function(e){return e.predicate}),n=t.filter(e=>e.startsWith("ds6w:browsingStructure"));if(n.length){let e=this;new a({}).execute({predicates:n}).then(function(t){e._map=t.labelMap,e._resMap=t.resourceidMap})}}},D}),define("DS/ENOPAD_v2/PADComponent",["DS/ENXNav/XNavComponent","DS/PADUtils/PADSession","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/ENOPAD_v2/mixins/_PADCCP","DS/ENOPAD_v2/mixins/_PADFolder","DS/ENOPAD_v2/mixins/_PADDnD","DS/ENOPAD_v2/mixins/_PADRefresh","DS/ENOPAD_v2/mixins/PlmNew","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalUtils","DS/ENOPAD_v2/features/Grouping","DS/ENOPAD_v2/features/BrowsingStructureDefinition","DS/ENOPAD_v2/features/AutoSwitchAuthoringToIndex","DS/ENXNav/mixins/DesignExpLeftSidePanel"],function(e,t,n,i,o,s,r,a,d,l,c,u,p,g,h){"use strict";return t.softInit(),e.extend(i,o,s,r,a,h,{name:"pad_component",init:function(e){var t,n,i=(t=e,(n={x3dAppId:"ENOPAD",widget:widget,amd_custo:{TreeDocument:"DS/ENOPAD_v2/models/PADTreeDocument",TileGridView:"DS/ENXNav/views/xNavResponsiveTilesView",ThumbnailGridView:"DS/ENXNav/views/xNavResponsiveThumbnailsView",DataGridView:"DS/ENXNav/views/xNavDataGridView"},layout:{}}).layout=UWA.clone(t.layout_opts),delete(n=UWA.extend(n,t,!0)).layout_opts,n),o=Promise.resolve();i.configuration&&!0===i.configuration.dynamicCtxActivated&&(o=new Promise(function(e){require(["DS/ENOPAD_v2/utils/PADCtxMenuUtilsV2"],e)})),this.staticMappingEnabled=l.getSetting("staticMappingServer"),(l.getSetting("activateGrouping")||"true"===c.getURLParameter("activateGrouping"))&&(this.features={},this.features.grouping=new u({context:this})),(l.getSetting("activateBSD")||"true"===c.getURLParameter("activateBSD"))&&(this.features||(this.features={}),this.features.browsingStructureDefinition=new p({context:this})),(l.getSetting("activateAutoSwitchAuthoringToIndex")||"true"===c.getURLParameter("activateAutoSwitchAuthoringToIndex"))&&(this.features||(this.features={}),this.features.autoSwitchAuthoringToIndex=new g({context:this}));var s=this._parent.bind(this);let r=e.isPlmNew?(a=this,new Promise(function(e,t){require(["DS/ENONewWidget/command/NewContentAppOptions"],function(t){t.setAppContext(a),e()},e)})):Promise.resolve();var a;o.then(function(){this.setFolderCommunicationChannel(),r.then(function(){require(["UWA/Utils/Client"],function(t){!1!==i.layout.action_bar&&(e.settings.action_bar.touch&&e.settings.action_bar.standard?i.action_bar_opts=t.Features.touchEvents&&!t.Features.pointerEvents?e.settings.action_bar.touch:e.settings.action_bar.standard:i.action_bar_opts=e.settings.action_bar,i.action_bar_opts.language=e.lang),s(i)})})}.bind(this))},displayConfirmationOnRemove:function(){var e=require("DS/PADUtils/PADSettingsMgt");return e.getSetting("addRemoveMessagePreference")?e.getSetting("displayConfirmationOnRemove"):void 0},getPADTreeListView:function(){return this.options.views.treelistview},getPADDGVView:function(){return this.options.views.datagridview},getPADTileGridView:function(){return this.options.views.tileview},getPADThumbnailGridView:function(){return this.options.views.thumbnailview},getPADTreeGraph:function(){return this.options?this.options.views.graphview:null},getEditMode:function(){return require("DS/PADUtils/PADSettingsMgt").getSetting("EditModeActivated")},setEditMode:function(e){require("DS/PADUtils/PADSettingsMgt").setSetting("EditModeActivated",e,!0),this.dispatchEvent("editModeModified",e)},add:function(e,t,n){e.content||(e.content="idslist"),void 0===t&&e.callback&&(t=e.callback),void 0===n&&(n=e.broadcast),e.callback=function(e,n){t&&t(e,n)},e.broadcast=n,this._parent(e)},addRootNodes:function(e){if(!UWA.is(e,"array"))throw new Error("nodes parameter must be an array");var t=[];this.dropInvitContainer.hide();var n=this.options.model;n&&n.wrapInTransaction(function(){n.withTransactionUpdate(function(){n.addRoot(e);for(var i=0;i<e.length;i++)t.push(e[i].getID());n.getRoots().length;UWA.is(n.detachedRoots,"array")&&n.detachedRoots.length,n.getModelEvents().publish({event:"onRootAdded",data:{nb_root:n.getRoots().length,added_node:e[n.getRoots().length-1]}})})});var i={pids:t};this._commandProxy.drop(i)},addNodesFromContent:function(e,t,n,i){var o=this;require(["DS/PADUtils/PADTypesMgt"],function(s){s.retrieveAuthorizedObjects({version:"2.0",X3DContentId:e,callback:function(e){e.authorizedWithKind?(e.authorizedWithKind.Product&&e.authorizedWithKind.Product.length>0&&o.add({content:"3DXContent",authorized_objects:e.authorizedWithKind.Product,callback:t,behavior:n}),e.authorizedWithKind.Filter&&e.authorizedWithKind.Filter.length>0&&o.addFilter({content:"3DXContent",filter_objects:e.authorizedWithKind.Filter,callback:t,behavior:void 0}),e.authorizedWithKind.Change&&e.authorizedWithKind.Change.length>0&&o.loadChange&&o.loadChange({content:"3DXContent",objects:e.authorizedWithKind.Change,callback:t,behavior:n})):o.add({content:"3DXContent",authorized_objects:e.authorized_objects,behavior:n},t,i)}})})},getOrdering:function(e){return this.options.model.getOrdering(e)},replaceNodes:function(e){let t=this.options.model;t.isOccModel?t.replaceNodesOcc(e):this.replaceNodesV1(e)},replaceNodesV1:function(e){console.time("replaceNodes");var t=this,n=[],i={},o=[],s=[];let r=!(!e.toInsert||!e.toInsert.isProdConfig);var a,d,l,c,u;r&&delete e.toInsert.isProdConfig,e.toDelete&&(e.toDelete.forEach(function(e){n.push(e.physicalid)}),a=e.toDelete,u=0,a.forEach(function(e){(d=t.getPADTreeDocument().getNodesByRelId(e.physicalid))&&d.forEach(function(t){if(t){var n=t.getParent();if(n){s.push(n);var r=n.getOccurencePath();if(r){o.push(r),l=t.isExpanded(),c=t.options.padstate;var a={};l&&(u=function e(t){if(!t.hasChildren())return t.getDepth();var n=1;return t.getChildren().forEach(function(t){var i=e(t);i>n&&(n=i)}),n}(t)-t.getDepth(),u=parseInt(u),e.newrelid&&(a[e.newrelid]={isExpanded:l,padState:c,expandLevel:u},r=r.join("_"),i[r]?i[r].push(a):i[r]=[a]))}}}})}));var p={};e.callack=function(){p.detach={deleted:n},t._commandProxy.padRefresh(p)},e.callback2=function(o){try{console.timeLog("replaceNodes"),t.processPathExpand(o,i),console.timeEnd("replaceNodes")}catch(e){console.error("error",e)}finally{var s,r;if(n.length>0)for(var a=0;a<n.length;a++)if((s=t.getPADTreeDocument().getNodesByRelId(n[a]))&&s.length>0){r=!0;break}if(r){console.count("needCleanUp");var d={deleted:e.toDelete};t.refreshView(d)}}},e.occurencePaths=o,e.parentNodes=s,r&&this.options.model.bubbleStaticMapMessageOnce(),this.options.model.insertNodesSplitFetch(e)},processPathExpand:function(e,t){var n=this,i=Object.keys(t);if(0!==i.length){var o,s,r,a,d=e.expandNodeIds;if(d&&0!==d.length)d.forEach(function(e){i.forEach(function(i){s=t[i],i=i.split("_"),r=n.getPADTreeDocument().getNodeByOccurencePath(i),s&&r&&s.forEach(function(t){(o=t[e])&&o.isExpanded&&0!==o.expandLevel&&r.getNodesByRelId(e).forEach(function(e){e.isExpanded()||(a={numberOfLevelsToExpand:o.expandLevel},e.expandNLevels(a))})})})})}},insertNodes:function(e){this.options.model.insertNodes(e);"graphview"===this.options.active_view&&(this.options.views.graphview.reframeAll(),this.dropInvitContainer&&this.dropInvitContainer.hide()),require(["DS/ENXNav/utils/TwoDAppEvents"],function(e){e.addRoot()})},author:function(e){t.setAuthoringState(e,n.PADSession_disabling_index_authoring)},setDnDBehavior:function(e){this.options.model.setDnDBehavior(e)},setConfirmdDialog:function(e){this.options.model.setConfirmdDialog(e)},displayNotification:function(e){require(["DS/PADUtils/views/PADAlert"],function(t){t.displayNotification(e)})},broadcastSelect:function(e){this.options.model.broadcastSelect(e)},getSelectedNodes:function(){return this.options.model.getSelectedNodes()},getActiveView:function(){return this.options?this.options.active_view:"treelistview"},refreshView:function(e){var t,n={updateRevision:[]},i=this,o=Promise.resolve(),s=e.modified;s&&((t={}).modified=s);var r,a,l,c=e.created;c&&(t||(t={}),t.created=[],c.forEach(function(e){if(e.sourceObjectId){e.operation&&"Revise"===e.operation&&(r={existing:e.sourceObjectId,new:e.physicalid,newRevison:"Z.8"},n.updateRevision.push(r));var s=i.getPADTreeDocument().getNodesById(e.sourceObjectId);if(s&&s.length>0)for(var a=0;a<s.length;a++){var l=s[a],c=[];c.push({type:l.options.type}),o=new Promise(n=>{d.isTypesAuthorized(c,function(i){i.length>0&&-1===t.created.indexOf(e.physicalid)&&t.created.push(e.physicalid),n()})})}}else t.created.push(e.physicalid)}));var u=e.deleted;(u&&u.forEach(function(e){var t=e.physicalid,n=i.getPADTreeDocument().getNodesById(t);n&&0!==n.length||(n=i.getPADTreeDocument().getNodesByRelId(t)),n.forEach(function(e){e.isRoot()?(a||(a=[]),a.push(t)):(l||(l=[]),l.push(e))})}),o.then(function(){t&&(t.created&&t.created.length&&(t.onAddPaths=function(e){i.dispatchEvent("onAddPaths",{addedPaths:e}),require(["DS/ENXNav/utils/TwoDAppEvents"],function(e){e.addRoot()})}),i.getPADTreeDocument().refreshNodeById(t))}),l&&this.getPADTreeDocument().deleteNodes(l),a)&&(this._onRemoveRoot({pids:a}),a.length&&require("DS/PADServices/utils/GlobalModelEvents").publish({event:"ENXViews/WelcomePanel/cleanup",data:{item2remove:a}}));n.updateRevision.length&&this.getPADTreeDocument().updateRevision(n)},refreshInstance:function(e){if(e&&e.modified&&e.created){for(var t,n={},i=0;i<e.modifed.length;i++)t={oldId:e.modified[i].physicalid,newId:e.created[i].physicalid},coulples.push(t);n.coulpes=[],n.cb=e.cb,this.getPADTreeDocument().splitInstance(n)}else console.warn("refreshInstance: no input")},_dispatchReady:function(e){!0===this.options.isReady.model&&!0!==this.options.isReady.PADmodel&&(this._buildENOPADModel(),this.options.isReady.PADmodel=!0),!0===this.options.isReady.model&&this._probes.probe_model.end(),!0===this.options.isReady[this.options.active_view]&&this._probes.probe_view.end(),!0===this.options.isReady.actionbar&&this._probes.probe_actionbar&&this._probes.probe_actionbar.end(),!0===this._dispatchReady_NotDone&&!0===this.options.isReady.model&&!0===this.options.isReady.actionbar&&!0===this.options.isReady[this.options.active_view]&&(this.dispatchEvent.call(this,"onReady",{addInView:e}),this.dispatchEvent("onActionBarReadyToBuild"),this._probes.probe_init.end(),this._dispatchReady_NotDone=!1)},setKeyboardListenerOnGraph:function(){var e=this;e._keyboardListener||require(["DS/ENOPAD_v2/mixins/_PADKBInput"],function(t){e._keyboardListener=new t({component:e}),e._keyboardListener.startObservingKeyboard(e.options.views.graphview.elements.container)})},_buildENOPADModel:function(){var e=this;e.getContent().addEventListener("dragleave",function(t){var n=t.relatedTarget,i=n?n.className:" ";if(!(!i||-1===i.indexOf("paddnd_invite")))return t.preventDefault(),t.stopPropagation(),!1;e.dropInvitContainer&&e.dropInvitContainer.hide(),0===e.options.model.getRoots().length&&e.dropInvitContainer.show("drop")},!1)},onRead:function(e){var t=this.options.model;t.withTransactionUpdate(function(){for(var n=0;n<e.paths.length;n++){var i=t.getNodeByOccurencePath(e.paths[n]);if(i){i.updateOptions({isReadOnly:!0})}}}.bind(t))},onWrite:function(e){var t=this.options.model;t.withTransactionUpdate(function(){for(var n=0;n<e.paths.length;n++){var i=t.getNodeByOccurencePath(e.paths[n]);if(i){i.updateOptions({isReadOnly:!1})}}}.bind(t))},destroy:function(){this._parent()}})});