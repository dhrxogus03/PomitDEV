define("DS/XCADSTEPDocument/STEPTessellatedAnnotationRepresentation",["DS/XCADInputDocuments/XCADTessellatedRepresentation","DS/XCADInputDocuments/XCADRepresentation","DS/XCADInputDocuments/XCADFaceData","DS/XCADInputDocuments/XCADEdgeData","DS/Mesh/ThreeJS_Base"],function(t,e,s,i,n){"use strict";var r=/([^,]+)/g,o=/\(([^)]+)\)/g,a={COMPLEX_TRIANGULATED_SURFACE_SET:t.KindOfNode.NOD_GP,COMPLEX_TRIANGULATED_FACE:t.KindOfNode.NOD_SurfacicSetNode,TESSELLATED_WIRE:t.KindOfNode.NOD_SurfacicNode,TESSELLATED_EDGE:t.KindOfNode.NOD_GP,TRIANGULATED_FACE:t.KindOfNode.NOD_GP,TESSELLATED_GEOMETRIC_SET:t.KindOfNode.NOD_ContainerNode,TESSELLATED_CURVE_SET:t.KindOfNode.NOD_SurfacicSetNode,TESSELLATED_SURFACE_SET:t.KindOfNode.NOD_SurfacicSetNode,GEOMETRIC_CURVE_SET:t.KindOfNode.NOD_SurfacicSetNode,ANNOTATION_FILL_AREA:t.KindOfNode.NOD_SurfacicSetNode},c={COMPLEX_TRIANGULATED_SURFACE_SET:t.KindOfGP.GP_Face,COMPLEX_TRIANGULATED_FACE:t.KindOfGP.GP_Face,TRIANGULATED_FACE:t.KindOfGP.GP_Face,TESSELLATED_EDGE:t.KindOfGP.GP_Edge,TESSELLATED_CONNECTING_EDGE:t.KindOfGP.GP_Edge,TESSELLATED_CURVE_SET:t.KindOfGP.GP_Edge,GEOMETRIC_CURVE_SET:t.KindOfGP.GP_Line,ANNOTATION_FILL_AREA:t.KindOfGP.GP_Line,POLYLINE:t.KindOfNode.GP_Line,TRIMMED_CURVE:t.KindOfNode.GP_Circle};return t.extend(function(t,s){this._associatedDocument=t,this._stepTokenizeArgs=t.stepTokenizeArgs,this._representationType=e.XCAD_TESSELLATED_ANNOTATION_REPRESENTATION,this._stepRepresentationIndex=s,this._associatedDocument.CoordSystem.Coord=!1,this._associatedDocument.CoordSystem.Origin=void 0,this._associatedDocument.CoordSystem.Axis=void 0,this._associatedDocument.CoordSystem.RefDir=void 0;var i=/([^,]+)/g,n=[];this._rootNodes=[],this._verticelist={};for(var r=0;r<s.length;r++){var o=t.stepEntities[s[r]];if(0===o.indexOf("DRAUGHTING_CALLOUT")){t.stepTokenizeArgs(t.stepEntities[s[r]],n);let e=n[1].substr(1,n[1].length-2).match(i);for(var a=0;a<e.length;a++){var c=e[a];if(null!=(p=t.stepEntities[c.substr(1)])&&p.startsWith("TESSELLATED_ANNOTATION_OCCURRENCE")){var E=[];t.stepTokenizeArgs(p,E);var _;_=t.stepEntities[E[2].substring(1)].substring(t.stepEntities[E[2].substring(1)].indexOf("REPOSITIONED_TESSELLATED_ITEM(")+31,t.stepEntities[E[2].substring(1)].indexOf(")REPRESENTATION_ITEM")).match(i);var h=[];if("AXIS2_PLACEMENT_3D"===(p=this._associatedDocument._stepGetEntityType(_[0])).first){this._stepTokenizeArgs(p.second,h),this._associatedDocument.CoordSystem.Coord=!0;var d=[],u=[],l=[];if(this._stepTokenizeArgs(this._associatedDocument.stepEntities[_[0]],h),null!=h[1]&&null!=h[2]&&null!=h[3]){var T=this._associatedDocument._stepGetEntityType(h[1].substring(1));if("CARTESIAN_POINT"===T.first){var g=[];this._stepTokenizeArgs(T.second,g),this._stepTokenizeArgs(g[1],d),void 0===this._associatedDocument.CoordSystem.Origin&&(this._associatedDocument.CoordSystem.Origin=d)}if("DIRECTION"===(T=this._associatedDocument._stepGetEntityType(h[2].substring(1))).first){g=[];this._stepTokenizeArgs(T.second,g),this._stepTokenizeArgs(g[1],u),void 0===this._associatedDocument.CoordSystem.Axis&&(this._associatedDocument.CoordSystem.Axis=u)}if("DIRECTION"===(T=this._associatedDocument._stepGetEntityType(h[3].substring(1))).first){g=[];this._stepTokenizeArgs(T.second,g),this._stepTokenizeArgs(g[1],l),void 0===this._associatedDocument.CoordSystem.RefDir&&(this._associatedDocument.CoordSystem.RefDir=l)}}}this._rootNodes=this._rootNodes.concat(E[2])}}}else if(-1!=o.indexOf("(ANNOTATION_CURVE_OCCURRENCE()ANNOTATION_OCCURRENCE()CHARACTERIZED_OBJECT")){E=[];t.stepTokenizeArgs(o,E);let e=E[5].substr(1,E[5].length-2).match(i);null!=(p=t.stepEntities[e[1].substr(1)])&&p.startsWith("GEOMETRIC_CURVE_SET")&&(this._rootNodes=this._rootNodes.concat(e[1]))}else if(-1!=o.indexOf("ANNOTATION_CURVE_OCCURRENCE('")){E=[];t.stepTokenizeArgs(o,E),null!=(p=t.stepEntities[E[2].substr(1)])&&p.startsWith("GEOMETRIC_CURVE_SET")&&(this._rootNodes=this._rootNodes.concat(E[2]))}else if(-1!=o.indexOf("ANNOTATION_FILL_AREA_OCCURRENCE('")){var p;E=[];t.stepTokenizeArgs(o,E),null!=(p=t.stepEntities[E[2].substr(1)])&&p.startsWith("ANNOTATION_FILL_AREA")&&(this._rootNodes=this._rootNodes.concat(E[2]))}}},{_fillVerticesList:function(t){let e=this._associatedDocument.stepEntities[t],s=e.substr(e.indexOf("((")+1,e.indexOf("))")-2).match(o);this._verticelist[t]=[];let i=[],n=s.length;for(var a=0;a<n;a++)3===(i=s[a].substr(1,s[a].length-2).match(r)).length&&this._verticelist[t].push(i[0],i[1],i[2]),i=null},_processTriangleStrips:function(t,e,s){var i=e.substr(1,e.length-2).match(o),n=1===s.length;let a=i.length;for(let e=0;e<a;e++){let o=i[e].substr(1,i[e].length-2).match(r),a=o.length;for(let e=0;e<a;e++){let i=o[e];if(i-=1,t.stripTrianglesIndices.push(i),!n){let e=s[i].substr(1,s[i].length-2).match(r);t.setNormalAt(i,e[0],e[1],e[2]),e=null}}t.nbVertexPerStripTriangle.push(o.length),o=null}i=null},_processTriangleFans:function(t,e,s){var i=e.substr(1,e.length-2).match(o);if(null!==i)for(var n=1===s.length,a=0;a<i.length;a++){for(var c=i[a].substr(1,i[a].length-2).match(r),E=0;E<c.length;E++){var _=c[E]-1;if(t.fanTrianglesIndices.push(t.getFanTrianglesVertexPosition(_)),!n){var h=s[_].substr(1,s[_].length-2).match(r);t.setNormalAt(_,h[0],h[1],h[2])}}t.nbVertexPerFanTriangle.push(c.length)}},getChildren:function(t,e){var s=[];if(e){var i=/([^,]+)/g;if(-1!=this._associatedDocument.stepEntities[t.substring(1)].indexOf("GEOMETRIC_CURVE_SET")){var n=[];this._stepTokenizeArgs(this._associatedDocument.stepEntities[t.substring(1)],n),s[0]=t}else if(this._associatedDocument.stepEntities[t.substring(1)].startsWith("TESSELLATED_GEOMETRIC_SET")){n=[];this._stepTokenizeArgs(this._associatedDocument.stepEntities[t.substring(1)],n),s=n[1].substr(1,n[1].length-2).match(i)}else s=this._associatedDocument.stepEntities[t.substring(1)].substring(this._associatedDocument.stepEntities[t.substring(1)].indexOf("TESSELLATED_GEOMETRIC_SET(")+27,this._associatedDocument.stepEntities[t.substring(1)].indexOf("))")).match(i)}else{var r=[];this._stepTokenizeArgs(this._associatedDocument.stepEntities[t.substring(1)],r),this._stepTokenizeArgs(r[1],s)}return s},getChild:function(t,e){var s=[];this._stepTokenizeArgs(this._associatedDocument.stepEntities[t.substring(1)],s);var i=[];return this._stepTokenizeArgs(s[1],i),i[e]},getChildCount:function(t,e){var s=[];if(e){s=this._associatedDocument.stepEntities[t.substring(1)].substring(this._associatedDocument.stepEntities[t.substring(1)].indexOf("TESSELLATED_GEOMETRIC_SET(")+27,this._associatedDocument.stepEntities[t.substring(1)].indexOf("))")).match(/([^,]+)/g)}else{var i=[];this._stepTokenizeArgs(this._associatedDocument.stepEntities[t.substring(1)],i),this._stepTokenizeArgs(i[1],s)}return s.length},getAssociatedTransfo:function(t){var e=void 0,s=[];this._stepTokenizeArgs(this._associatedDocument.stepEntities[t.substring(1)],s);var i=[];if(this._stepTokenizeArgs(s[1],i),null==i[0]&&(i[0]=s[1]),null!=i[0]){let t=this._associatedDocument._stepGetEntityType(i[0].substring(1));if("CIRCLE"===t.first&&(this._stepTokenizeArgs(t.second,s),t=this._associatedDocument._stepGetEntityType(s[1].substring(1)),i[0]=s[1]),"AXIS2_PLACEMENT_3D"===t.first){var r=[];this._stepTokenizeArgs(t.second,r),this._associatedDocument.CoordSystem.Coord=!0;var o=[],a=[],c=[];if(this._stepTokenizeArgs(this._associatedDocument.stepEntities[i[0].substring(1)],r),null!=r[1]&&null!=r[2]&&null!=r[3]){var E=this._associatedDocument._stepGetEntityType(r[1].substring(1));if("CARTESIAN_POINT"===E.first){var _=[];this._stepTokenizeArgs(E.second,_),this._stepTokenizeArgs(_[1],o)}if("DIRECTION"===(E=this._associatedDocument._stepGetEntityType(r[2].substring(1))).first){_=[];this._stepTokenizeArgs(E.second,_),this._stepTokenizeArgs(_[1],a)}if("DIRECTION"===(E=this._associatedDocument._stepGetEntityType(r[3].substring(1))).first){_=[];this._stepTokenizeArgs(E.second,_),this._stepTokenizeArgs(_[1],c)}var h=parseFloat(o[0]),d=parseFloat(o[1]),u=parseFloat(o[2]),l=new n.Matrix3,T=new n.Vector3(c[0],c[1],c[2]),g=new n.Vector3(a[0],a[1],a[2]),p=new n.Vector3;p.crossVectors(g,T),l.set(T.x,p.x,g.x,T.y,p.y,g.y,T.z,p.z,g.z),(e=new n.Matrix4).set(l.elements[0],l.elements[3],l.elements[6],h,l.elements[1],l.elements[4],l.elements[7],d,l.elements[2],l.elements[5],l.elements[8],u,0,0,0,1)}}}return e},getGeomSet:function(t){var e=[];this._stepTokenizeArgs(this._associatedDocument.stepEntities[t.substring(1)],e);var s=[];return null!=e[3]&&this._stepTokenizeArgs(e[3].substring(1,e[3].length-1),s),s},getCircleData:function(t){throw"Error: not implemented method"},getConeData:function(t){throw"Error: not implemented method"},getCoordinateSystem:function(){return this._associatedDocument.CoordSystem},getCylinderData:function(t){throw"Error: not implemented method"},getVertexData:function(t){throw"Error: not implemented method"},getEdgeData:function(t){var e=new i;t=t.substring(1);var s=this._associatedDocument._stepGetEntityType(t);if("TESSELLATED_CURVE_SET"===s.first||"TESSELLATED_EDGE"===s.first||"TESSELLATED_CONNECTING_EDGE"===s.first){var o,a=[];if(this._stepTokenizeArgs(this._associatedDocument.stepEntities[t],a),null!=a[1]&&(o=a[1].substring(1)),"COORDINATES_LIST"===this._associatedDocument._stepGetEntityType(o).first){void 0===this._verticelist[o]&&this._fillVerticesList(o);var c=void 0,E=!1;if("TESSELLATED_CURVE_SET"===s.first){if(-1!=(c=a[2].replace("((","").replace("))","")).indexOf("),(")){E=!0;for(var _=c.split("),("),h=(e=[],0);h<_.length;h++){for(var d=_[h].split(","),u=new i,l=0;l<d.length;l++)for(var T=0;T<3;T++)u.vertices[3*l+T]=this._verticelist[o][3*(d[l]-1)+T];e[h]=u}}}else c=a[3].replace("(","").replace(")","");if(!1===E)for(d=c.split(","),h=0;h<d.length;h++)for(parseInt(d[h]),l=0;l<3;l++)e.vertices[3*h+l]=this._verticelist[o][3*(d[h]-1)+l]}}else if("POLYLINE"===s.first){a=[],T=0;this._stepTokenizeArgs(this._associatedDocument.stepEntities[t],a);var g=a[1].substr(1,a[1].length-2).match(r);for(l=0;l<g.length;l++){this._stepTokenizeArgs(this._associatedDocument.stepEntities[g[l].substring(1)],a);let t=[];3===(t=a[1].substr(1,a[1].length-2).match(r)).length&&(e.vertices[T]=t[0],T++,e.vertices[T]=t[1],T++,e.vertices[T]=t[2],T++),t=null}}else if("TRIMMED_CURVE"===s.first){var p=[];this._stepTokenizeArgs(this._associatedDocument.stepEntities[t],p);var f=this.getAssociatedTransfo("#"+t),m=this._associatedDocument._stepGetEntityType(p[1].substring(1));if("CIRCLE"!=m.first)console.log(m.first+" not yet supported");else{var D=p[2].substr(1,p[2].length-2),A=p[3].substr(1,p[3].length-2),N=[];this._stepTokenizeArgs(this._associatedDocument.stepEntities[p[1].substring(1)],N);for(var C=N[2],S=(T=0,parseFloat(D));S<A;){var O;(O=new n.Vector3(parseFloat(C)*Math.cos(S),parseFloat(C)*Math.sin(S),0)).applyMatrix4(f),e.vertices[T]=O.x,T++,e.vertices[T]=O.y,T++,e.vertices[T]=O.z,T++,S+=.05}(O=new n.Vector3(parseFloat(C)*Math.cos(A),parseFloat(C)*Math.sin(A),0)).applyMatrix4(f),e.vertices[T]=O.x,T++,e.vertices[T]=O.y,T++,e.vertices[T]=O.z,T++}}else console.log(s.first+" not supported");return e},getFaceData:function(t){var e=new s,i=this._associatedDocument._stepGetEntityType(t.substring(1));switch(""+i.first){case"COMPLEX_TRIANGULATED_SURFACE_SET":var n=[];this._stepTokenizeArgs(i.second,n);var a=n[1].substring(1);void 0===this._verticelist[a]&&this._fillVerticesList(a);var c=n[3].substr(1,n[3].length-2).match(o);if(null==c&&(console.log("ERROR"),(c=[])[0]="(.0,.0,1.0)"),1===c.length)for(var E=c[0].substr(1,c[0].length-2).match(r),_=0;_<n[2];_++)e.normals.push(E[0],E[1],E[2]);var h=n[4].substr(1,n[4].length-2).match(o);if(null!=h)for(_=0;_<h.length;_++)for(var d=3*(h[_]-1),u=0;u<3;u++)e.vertices[3*_+u]=this._verticelist[a][d+u];else e.vertices=this._verticelist[a];if(n[5].length>2&&this._processTriangleStrips(e,n[5],c),n[6].length>2&&this._processTriangleFans(e,n[6],c),e.vertices.length!=e.normals.length){var l=[],T=[],g=[];if(0!=e.stripTrianglesIndices.length&&(g=new Set(e.stripTrianglesIndices)),0!=e.fanTrianglesIndices.length&&(g=new Set([...g,...e.fanTrianglesIndices])),0!=e.singleTrianglesIndices.length&&(g=new Set([...g,...e.singleTrianglesIndices])),null!=g)for(d=Array.from(g),_=0;_<d.length;_++)l[3*d[_]]=e.vertices[3*d[_]],l[3*d[_]+1]=e.vertices[3*d[_]+1],l[3*d[_]+2]=e.vertices[3*d[_]+2],T[3*d[_]]=e.normals[3*d[_]],T[3*d[_]+1]=e.normals[3*d[_]+1],T[3*d[_]+2]=e.normals[3*d[_]+2];e.vertices=l,e.normals=T}}return e},getGPType:function(t){var e=this._associatedDocument._stepGetEntityType(t.substring(1));return c[e.first]},getNodeBoundingSphere:function(t){throw"Error: not implemented method"},getNodeColor:function(t){t=t.substring(1);var e=this._associatedDocument.overridingFaceColors[t];return void 0!==e?e:this._associatedDocument.bodyColors[t]},getNodeOrientationMatrix:function(t){throw"Error: not implemented method"},getNodeType:function(t){var e=this._associatedDocument._stepGetEntityType(t.substring(1));return a[e.first]},getNodeUID:function(t){throw"Error: not implemented method"},getPlaneData:function(t){throw"Error: not implemented method"},getPointData:function(t){throw"Error: not implemented method"},getPolyLineData:function(t){return t=t.substring(1),[this._associatedDocument.curveFont[t],this._associatedDocument.curveWidth[t]]},getRootNode:function(t){var e=this._rootNodes[t];if("[COMPLEX_STEP_ENTITY]"===this._associatedDocument._stepGetEntityType(e.substring(1)).first){var s=e;e=this._associatedDocument.stepGetNodeIdFromCpxEntity(s.substring(1))}return e},getRootNodesCount:function(){return this._rootNodes.length},getSAG:function(t){throw"Error: not implemented method"},getSphereData:function(t){throw"Error: not implemented method"},isIndexed:function(){return!0}})});