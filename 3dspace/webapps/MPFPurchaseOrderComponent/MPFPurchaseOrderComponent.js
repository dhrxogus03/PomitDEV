define("DS/MPFPurchaseOrderComponent/CartPhasePurchaseOrderForm",["UWA/Core","UWA/Promise","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartPaymentModel/CartPaymentModel","DS/MPFPurchaseOrderModel/PurchaseOrderModel","DS/MPFPurchaseOrderModel/PurchaseOrderDocumentModel","DS/MPFView/FieldTextInputV2","DS/UIKIT/Input/File","DS/UIKIT/Alert","DS/UIKIT/Mask","DS/MPFError/ValidationError","i18n!DS/MPFPurchaseOrderComponent/assets/nls/PurchaseOrderComponent","css!DS/MPFUI/MPFUI","css!DS/MPFPurchaseOrderComponent/MPFPurchaseOrderComponent"],function(e,r,t,s,a,i,n,d,c,h,o,l,u){"use strict";var p,m={PURCHASE_ORDER_UPLOADED:"purchaseOrderUploaded"};return(p=t.extend({className:"mpf-purchase-order-upload-form",setup:function(e){s.requiredOfPrototype(e.cartPayment,a,"options.cartPayment must be a CartPaymentModel"),s.requiredOfPrototype(e.purchaseOrder,i,"options.model must be a PurchaseOrderModel"),s.requiredOfPrototype(e.purchaseOrderDocument,n,"options.purchaseOrderDocument must be a purchaseOrderDocument"),this.cartPayment=e.cartPayment,this.purchaseOrder=e.purchaseOrder,this.purchaseOrderDocument=e.purchaseOrderDocument,this.warningMessage=this._createWarningMessage(),this.purchaseOrderNumberField=this._createPurchaseOrderNumberField(),this.purchaseOrderLabelField=this._createPurchaseOrderLabelField(),this.financialExpenseLineField=this._createBankCardExpenseFinancialLineField(),this.purchaseOrderFileField=this._createPurchaseOrderFileField(),this.alert=this._createAlert()},render:function(){return this.container.setContent([this.alert,this.warningMessage,this.purchaseOrderNumberField.render(),this.purchaseOrderLabelField.render(),this.financialExpenseLineField.render(),this.purchaseOrderFileField]),this},validate:function(){var e,r,t;return e=this.purchaseOrderNumberField.validate().isValid,r=this.purchaseOrderLabelField.validate().isValid,t=this._validatePurchaseOrderFileField(),{isValid:e&&r&&t}},save:function(){var e;return(e=this.validate()).isValid?this._onUploadPurchaseOrderDocument().then(this._updatePurchaseOrderWithDocumentId.bind(this)).then(this._savePurchaseOrder.bind(this)).then(this._updatePayment.bind(this)).then(this._onSaveSuccess.bind(this)).catch(this._onSaveFailure.bind(this)):r.reject(new l(e.messages))},reset:function(){this.purchaseOrderNumberField.resetValue(),this.purchaseOrderLabelField.resetValue(),this.financialExpenseLineField.resetValue(),this.fileInput.clear(),this._removeRedBorders()},_removeRedBorders:function(){this.fileInput.elements.textfield.removeClassName("mpf-invalidField")},_onUploadPurchaseOrderDocument:function(){var e;return e=this.fileInput.getContent().getElement("input").files[0],this.purchaseOrderDocument.saveFile(e)},_updatePurchaseOrderWithDocumentId:function(){this.purchaseOrder.setDocumentId(this.purchaseOrderDocument.id)},_savePurchaseOrder:function(){return this.purchaseOrder.savePromise()},_updatePayment:function(){var e,r={};return(e=this.financialExpenseLineField.getValue())&&(r[a.Fields.FINANCIAL_LINE]=e),r[a.Fields.STATE]=a.States.PENDING_PAYMENT,this.cartPayment.savePromise(r,{patch:!0})},_onSaveSuccess:function(){this.dispatchEvent(m.PURCHASE_ORDER_UPLOADED)},_onSaveFailure:function(e){return this.alert.add({className:"error",message:u.get("anErrorOccured")}).show(),r.reject(e)},destroy:function(){this.purchaseOrderNumberField.destroy(),this.purchaseOrderLabelField.destroy(),this.financialExpenseLineField.destroy(),this.cartPayment=null,this.purchaseOrder=null,this.purchaseOrderDocument=null,this._parent(),this.container=null},_createWarningMessage:function(){return e.createElement("div",{class:"alert-message alert-warning alert-has-icon",html:[{tag:"span",class:"icon fonticon"},{tag:"span",text:u.get("uploadWarning")}]})},_createPurchaseOrderNumberField:function(){return new d({model:this.purchaseOrder,fieldName:i.Fields.NUMBER,fieldLabel:u.get("purchaseOrderNumber"),required:!0,readOnly:!1,dynamicValidation:!0})},_createPurchaseOrderLabelField:function(){return new d({model:this.purchaseOrder,fieldName:i.Fields.LABEL,fieldLabel:u.get("purchaseOrderLabel"),required:!1,readOnly:!1,dynamicValidation:!1})},_createBankCardExpenseFinancialLineField:function(){return new d({model:this.cartPayment,fieldName:a.Fields.FINANCIAL_LINE,fieldLabel:u.get("expenseFinancialLine")})},_createPurchaseOrderFileField:function(){return this.fileInput=new c({name:"document",buttonText:u.get("purchaseOrderFile"),events:{onChange:this._validatePurchaseOrderFileField.bind(this)}}),e.createElement("div",{class:"mpf-entry",html:[{tag:"label",html:[{tag:"span",class:"mpf-label",html:[u.get("purchaseOrderDocument"),'&nbsp;<span class="mpf-required">*</span>']},this.fileInput]}]})},_createAlert:function(){return new h({closable:!0,visible:!1,autoHide:!0})},_validatePurchaseOrderFileField:function(){var e,r;return e=!!this.fileInput.getValue(),r=this.fileInput.getContent().getElement(".form-control"),e?r.removeClassName("mpf-invalidField"):r.addClassName("mpf-invalidField"),e}})).Events=Object.freeze(m),p}),define("DS/MPFPurchaseOrderComponent/PurchaseOrderUploadForm",["UWA/Core","UWA/Promise","UWA/Class/View","DS/UIKIT/Alert","DS/UIKIT/Input/File","DS/MPFView/FieldTextInputV2","DS/MPFPurchaseOrderModel/PurchaseOrderModel","DS/MPFPurchaseOrderModel/PurchaseOrderDocumentModel","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartModelHelper","DS/MPFError/ValidationError","DS/MPFServices/ObjectService","DS/MPFServices/MarketplaceServices","DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","DS/MPFTracker/Category","i18n!DS/MPFPurchaseOrderComponent/assets/nls/PurchaseOrderComponent","css!DS/MPFUI/MPFUI","css!DS/MPFPurchaseOrderComponent/MPFPurchaseOrderComponent"],function(e,r,t,s,a,i,n,d,c,h,o,l,u,p,m,O,P){"use strict";const F=Object.freeze({PURCHASE_ORDER_UPLOADED:"purchaseOrderUploaded",ON_CHANGE:"onChange"}),f=t.extend({className:"mpf-purchase-order-upload-form",setup:function(e){l.requiredOfPrototype(this.model,n,"options.model must be a PurchaseOrderModel"),l.requiredOfPrototype(e.purchaseOrderDocument,d,"options.purchaseOrderDocument must be a purchaseOrderDocument"),l.requiredOfPrototype(e.cart,c,"options.cart must be a CartModel"),this.service=e.service||u.MAKE,this.purchaseOrder=this.model,this.purchaseOrderDocument=e.purchaseOrderDocument,this.cart=e.cart,this.warningMessage=this._createWarningMessage(),this.purchaseOrderNumberField=this._createPurchaseOrderNumberField(),this.purchaseOrderLabelField=this._createPurchaseOrderLabelField(),this.financialExpenseLineField=this._createBankCardExpenseFinancialLineField(),this.purchaseOrderFileField=this._createPurchaseOrderFileField()},render:function(){const e=this.service===u.IFWELOOP||this.service===u.CLICK_AND_BUY||this.service===u.INNOVATE?this.purchaseOrderNumberField.render():[this.warningMessage,this.purchaseOrderNumberField.render(),this.purchaseOrderLabelField.render(),this.financialExpenseLineField.render(),this.purchaseOrderFileField];return this.container.setContent(e),this},isValid(){let e;if(this.service===u.IFWELOOP||this.service===u.CLICK_AND_BUY)e=this.purchaseOrderNumberField.isValid();else{const r=this.purchaseOrderNumberField.isValid(),t=this.purchaseOrderLabelField.isValid(),s=!!this.fileInput.getValue();e=r&&t&&s}return e},validate:function(){let e;if(this.service===u.IFWELOOP||this.service===u.CLICK_AND_BUY)e=this.purchaseOrderNumberField.validate().isValid;else{const r=this.purchaseOrderNumberField.validate().isValid,t=this.purchaseOrderLabelField.validate().isValid,s=this._validatePurchaseOrderFileField();e=r&&t&&s}return e},save:function(){let e;return e=this.validate()?this._savePurchaseOrderFile().then(this._updatePurchaseOrderWithDocumentId.bind(this)).then(this._savePurchaseOrder.bind(this)).then(this._updateCart.bind(this)).then(this._onSaveSuccess.bind(this)).catch(this._onSaveFailure.bind(this)):r.reject(new o),r.cast(e)},getSelectedFile(){return this.fileInput.getContent().getElement("input").files[0]},setPurchaseOrderNumber:function(e){this.purchaseOrderNumberField.setValue(e)},setPurchaseOrderLabel:function(e){this.purchaseOrderLabelField.setValue(e)},setFinancialExpenseLine:function(e){this.financialExpenseLineField.setValue(e)},reset:function(){this.purchaseOrderNumberField.resetValue(),this.purchaseOrderLabelField.resetValue(),this.financialExpenseLineField.resetValue(),e.is(this.fileInput)&&this.fileInput.clear(),this._removeRedBorders()},_savePurchaseOrderFile:function(){if(e.is(this.fileInput)){const e=this.getSelectedFile();return this.purchaseOrderDocument.saveFile(e)}return r.resolve()},_updatePurchaseOrderWithDocumentId:function(){this.purchaseOrder.setDocumentId(this.purchaseOrderDocument.id)},_savePurchaseOrder:function(){return""!==this.purchaseOrder.getNumber()?this.purchaseOrder.savePromise():r.resolve()},_onSaveSuccess:function(){this.dispatchEvent(F.PURCHASE_ORDER_UPLOADED);const e=p.createEventBuilder({category:O.CHECKOUT,action:"PurchaseOrderUploaded"});return h.addTrackerInformation(e,this.cart),e.addDimension(m.MARKETPLACE_SERVICE,this.service).send(),{paymentOK:!0,isBankTransferPayment:!0}},_onSaveFailure:function(){return new s({messageClassName:"error",closable:!0,visible:!0,messages:P.get("anErrorOccured")}).inject(this.container,"top"),{paymentOK:!1}},_createWarningMessage:function(){return e.createElement("div",{class:"alert-message alert-warning alert-has-icon",html:[{tag:"span",class:"icon fonticon"},{tag:"span",text:P.get("uploadWarning")}]})},_createPurchaseOrderNumberField:function(){const e=new i({model:this.model,fieldName:"number",fieldLabel:P.get("purchaseOrderNumber"),readOnly:!1,dynamicValidation:!0,maxlength:30,required:this.service!==u.IFWELOOP&&this.service!==u.CLICK_AND_BUY&&this.service!==u.INNOVATE});return this.listenTo(e,i.Events.UPDATE,this.dispatchEvent.bind(this,F.ON_CHANGE)),e},_createBankCardExpenseFinancialLineField:function(){const e=new i({model:this.cart,fieldName:c.Fields.EXPENSE_FINANCIAL_LINE,fieldLabel:P.get("expenseFinancialLine"),dynamicValidation:!0});return this.listenTo(e,i.Events.UPDATE,this.dispatchEvent.bind(this,F.ON_CHANGE)),e},_createPurchaseOrderLabelField:function(){const e=new i({model:this.model,fieldName:"label",fieldLabel:P.get("purchaseOrderLabel"),required:!1,readOnly:!1,dynamicValidation:!0});return this.listenTo(e,i.Events.UPDATE,this.dispatchEvent.bind(this,F.ON_CHANGE)),e},_createPurchaseOrderFileField:function(){if(this.service!==u.IFWELOOP&&this.service!==u.CLICK_AND_BUY&&this.service!==u.INNOVATE)return this.fileInput=new a({name:"document",buttonText:P.get("purchaseOrderFile"),events:{onChange:()=>{this._validatePurchaseOrderFileField(),this.dispatchEvent(F.ON_CHANGE)}}}),e.createElement("div",{class:"mpf-entry mpf-entry-v2",html:[{tag:"label",html:[{tag:"span",class:"mpf-label",html:[P.get("purchaseOrderDocument"),'&nbsp;<span class="mpf-required">*</span>']},this.fileInput]}]})},_validatePurchaseOrderFileField:function(){let r;if(e.is(this.fileInput)){r=!!this.fileInput.getValue();const e=this.fileInput.getContent().getElement(".form-control");r?e.removeClassName("mpf-invalidField"):e.addClassName("mpf-invalidField")}else r=!0;return r},_updateCart:function(){const e={[c.Fields.STATE]:c.States.PAYMENT_ACCEPTED},r=this.financialExpenseLineField.getValue();return r&&(e[c.Fields.EXPENSE_FINANCIAL_LINE]=r),this.cart.savePromise(e,{patch:!0})},_removeRedBorders:function(){e.is(this.fileInput)&&this.fileInput.elements.textfield.removeClassName("mpf-invalidField")}});return f.Events=Object.freeze(F),f}),define("DS/MPFPurchaseOrderComponent/PurchaseOrderUploadModal",["UWA/Core","UWA/Class/View","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/PlatformAPI/PlatformAPI","DS/MPFPurchaseOrderComponent/PurchaseOrderUploadForm","DS/MPFPurchaseOrderComponent/CartPhasePurchaseOrderForm","DS/MPFPurchaseOrderModel/PurchaseOrderModel","DS/MPFPurchaseOrderModel/PurchaseOrderDocumentModel","DS/MPFCartModel/CartModel","DS/MPFCartPaymentModel/CartPaymentModel","DS/MPFServices/ObjectService","i18n!DS/MPFPurchaseOrderComponent/assets/nls/PurchaseOrderComponent"],function(e,r,t,s,a,i,n,d,c,h,o,l,u,p){"use strict";var m,O={PURCHASE_ORDER_UPLOADED:"purchaseOrderUploaded"};return(m=r.extend({className:"mpf-purchase-order-upload-modal",setup:function(e){u.requiredOfPrototype(this.model,c,"options.model must be a PurchaseOrderModel"),u.requiredOfPrototype(e.purchaseOrderDocument,h,"options.purchaseOrderDocument must be a purchaseOrderDocument"),u.requiredOfPrototype(e.cart,o,"options.cart must be a CartModel"),this.purchaseOrder=this.model,this.purchaseOrderDocument=e.purchaseOrderDocument,this.cart=e.cart,this.cartPayment=e.cartPayment,this.isPaymentPerPhase=e.isPaymentPerPhase,this.purchaseOrderUploadForm=this._createPurchaseOrderUploadForm(),this.saveButton=this._createSaveButton(),this.modal=this._createUploadModal(this.saveButton)},render:function(){return this.modal.setBody([this.purchaseOrderUploadForm.render()]),this},save:function(){var e=this;return a.mask(this.modal.getBody()),this.purchaseOrderUploadForm.save().then(function(){e.modal.hide(),a.unmask(e.modal.getBody()),e._publishPOUploadEvent()}).catch(function(){a.unmask(e.modal.getBody())})},show:function(){this.modal.show()},onHide:function(){this.purchaseOrderUploadForm.reset()},destroy:function(){this.purchaseOrderUploadForm.destroy(),this.saveButton.destroy(),this.modal.destroy(),this.purchaseOrderUploadForm=null,this.saveButton=null,this.modal=null,this.purchaseOrder=null,this.purchaseOrderDocument=null,this.cart=null,this._parent(),this.container=null},_createPurchaseOrderUploadForm:function(){return this.isPaymentPerPhase?new d({purchaseOrder:this.purchaseOrder,purchaseOrderDocument:this.purchaseOrderDocument,cartPayment:this.cartPayment}):new n({model:this.purchaseOrder,purchaseOrderDocument:this.purchaseOrderDocument,cart:this.cart})},_publishPOUploadEvent:function(){this.dispatchEvent(O.PURCHASE_ORDER_UPLOADED),i.publish("MPCartTimeline",{event:"refresh",cartId:this.cart.id})},_createSaveButton:function(){return new s({value:p.get("save"),className:"primary",events:{onClick:this.save.bind(this)}})},_createUploadModal:function(e){return new t({className:"mpf-purchase-upload-modal",header:p.get("purchaseOrder"),footer:e,renderTo:document.body,events:{onHide:this.onHide.bind(this)}})}})).Events=Object.freeze(O),m}),define("DS/MPFPurchaseOrderComponent/PurchaseOrderUploadNoticeComponent",["UWA/Class/View","DS/MPFNoticeComponent/ImportantNoticeComponent","DS/MPFPurchaseOrderComponent/PurchaseOrderUploadModal","DS/MPFPurchaseOrderModel/PurchaseOrderModel","DS/MPFPurchaseOrderModel/PurchaseOrderDocumentModel","DS/MPFCartModel/CartModel","DS/MPFServices/ObjectService","i18n!DS/MPFPurchaseOrderComponent/assets/nls/PurchaseOrderComponent"],function(e,r,t,s,a,i,n,d){"use strict";const c=Object.freeze({PURCHASE_ORDER_UPLOADED:"purchaseOrderUploaded"}),h=e.extend({className:"mpf-purchase-upload-notice",setup:function(e){n.requiredOfPrototype(this.model,s,"options.model must be a PurchaseOrderModel"),n.requiredOfPrototype(e.purchaseOrderDocument,a,"options.purchaseOrderDocument must be a purchaseOrderDocument"),n.requiredOfPrototype(e.cart,i,"options.cart must be a CartModel"),this.purchaseOrder=this.model,this.purchaseOrderDocument=e.purchaseOrderDocument,this.cart=e.cart,this.cartPayment=e.cartPayment,this.isPaymentPerPhase=e.isPaymentPerPhase,this.showExplanationLink=!1!==e.showExplanationLink,this.notice=this._createNotice(),this.modal=this._createModal(),this.listenTo(this.notice,r.Events.BUTTON_CLICKED,this._showModal.bind(this)),this.listenTo(this.modal,t.Events.PURCHASE_ORDER_UPLOADED,this._onPurchaseOrderUploaded.bind(this))},render:function(){return this.container.setContent([this.notice.render(),this.modal.render()]),this},destroy:function(){this.stopListening(),this.notice.destroy(),this.modal.destroy(),this.notice=null,this.modal=null,this.purchaseOrder=null,this.purchaseOrderDocument=null,this.cart=null,this.cartPayment=null,this._parent(),this.container=null},_showModal:function(){this.modal.show()},_onPurchaseOrderUploaded:function(){this.dispatchEvent(c.PURCHASE_ORDER_UPLOADED)},_createNotice:function(){return new r({message:d.get("purchaseOrderNoticeMessage"),linkUrl:this.showExplanationLink?"/faq/proceed-to-deferred-payment":null,linkText:this.showExplanationLink?d.get("learnMoreAboutDifferedPayment"):null,buttonLabel:d.get("uploadPurchaseOrder")})},_createModal:function(){return new t({model:this.purchaseOrder,purchaseOrderDocument:this.purchaseOrderDocument,cart:this.cart,cartPayment:this.cartPayment,isPaymentPerPhase:this.isPaymentPerPhase})}});return h.Events=c,h});