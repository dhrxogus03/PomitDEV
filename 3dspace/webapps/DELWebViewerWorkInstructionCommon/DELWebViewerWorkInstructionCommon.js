define("DS/DELWebViewerWorkInstructionCommon/View/DELSubViewCell",[],function(){"use strict";return function(e,t){var i=UWA.is(e)&&UWA.is(t)?[e,t]:[0,0],a={x:0,y:0},o=0,r=0,n=null,s=null;return{getCellText:function(){return null},getCellImage:function(){return n},setCellImage:function(e){(!n||e&&e.src!==n.src)&&(n=e,s=null)},getCellImageToDisplay:function(){return s},setCellImageToDisplay:function(e){s&&(!e||e.width===s.width&&e.height===s.height&&e.src===s.src)||(s=e)},removeCellImageToDisplay:function(){s=null},getCellIndex:function(){var e={};return e.row=i[0],e.col=i[1],e},getCellPos:function(){return a},setCellPos:function(e){a=e},getCellWd:function(){return o},setCellWd:function(e){o=e},getCellHt:function(){return r},setCellHt:function(e){r=e}}}}),define("DS/DELWebViewerWorkInstructionCommon/View/DELViewMathsVector3D",[],function(){"use strict";var e;return e||(e=new function(){return{clone:function(e){var t=[];return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},squaredLength:function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},normalize:function(e,t){var i,a=[0,0,0],o=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];return Math.abs(o-1)<1e-6?((a=t||[0,0,0])[0]=e[0],a[1]=e[1],a[2]=e[2]):o>1e-6&&(i=Math.sqrt(o),(a=t||[0,0,0])[0]=e[0]/i,a[1]=e[1]/i,a[2]=e[2]/i),a},sub:function(e,t,i){var a=i||[0,0,0];return a[0]=t[0]-e[0],a[1]=t[1]-e[1],a[2]=t[2]-e[2],a},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},subAndLength:function(e,t,i){var a=i||[0,0,0];return a[0]=t[0]-e[0],a[1]=t[1]-e[1],a[2]=t[2]-e[2],Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])},multiplyAndAdd:function(e,t,i,a){var o=a||[0,0,0];return o[0]=e[0]*t+i[0],o[1]=e[1]*t+i[1],o[2]=e[2]*t+i[2],o}}}),e}),define("DS/DELWebViewerWorkInstructionCommon/DELWKIContent/DELWkiContentDataParser",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS"],function(e,t,i){"use strict";var a=[{name:"isVisible",type:"bool",JSONname:"DELAVPProperties.GraphicProperties.visible",defaultValue:!0},{name:"hasALeader",type:"bool",JSONname:"DELAVPProperties.HasALeader",defaultValue:!1},{name:"leaderEndType",type:"string",JSONname:"DELAVPProperties.LeaderEndType"},{name:"position",type:"Vector3",JSONname:"DELAVPProperties.LeaderBreakPoint3D",defaultValue:new i.Vector3},{name:"isFilled",type:"bool",JSONname:"DELAVPProperties.filled",defaultValue:!0},{name:"hasBorder",type:"bool",JSONname:"DELAVPProperties.border",defaultValue:!1},{name:"subViewImage",type:"ImageURL",JSONname:"DELAVPProperties.imgData.imgSrc"},{name:"imageHeight",type:"float",JSONname:"DELAVPProperties.imgData.imageBoxHeight"},{name:"imageWidth",type:"float",JSONname:"DELAVPProperties.imgData.imageBoxWidth"},{name:"fImageHeight",type:"float",JSONname:"DELAVPProperties.imgData.imageBoxHeight"},{name:"fImageWidth",type:"float",JSONname:"DELAVPProperties.imgData.imageBoxWidth"},{name:"anchorMode",type:"string",JSONname:"DELAVPProperties.AnchorMode"},{name:"zoomMode",type:"bool",JSONname:"DELAVPProperties.ZoomMode",defaultValue:!1},{name:"leaderAttachHeightRatio",type:"float",JSONname:"DELAVPProperties.LeaderAttachHeightRatio"},{name:"leaderAttachLengthRatio",type:"float",JSONname:"DELAVPProperties.LeaderAttachHeightRatio"},{name:"leaderAttachWidthRatio",type:"float",JSONname:"DELAVPProperties.LeaderAttachWidthRatio"},{name:"boxRotationAngle",type:"float",JSONname:"DELAVPProperties.BoxRotationAngle"},{name:"graphicProperties.borderRadius",type:"float",JSONname:"DELAVPProperties.BorderRadius"},{name:"graphicProperties.fillStyle.color",type:"Color",JSONname:"DELAVPProperties.GraphicProperties.FillStyle.color",defaultValue:new i.Color("#ffffff")},{name:"graphicProperties.fillStyle.opacity",type:"float",JSONname:"DELAVPProperties.GraphicProperties.FillStyle.opacity",defaultValue:1},{name:"graphicProperties.lineStyle.thickness",type:"float",JSONname:"DELAVPProperties.GraphicProperties.LineStyle.thickness",defaultValue:1},{name:"graphicProperties.lineStyle.pattern",type:"string",JSONname:"DELAVPProperties.GraphicProperties.LineStyle.pattern",defaultValue:"1"},{name:"graphicProperties.lineStyle.color",type:"Color",JSONname:"DELAVPProperties.GraphicProperties.LineStyle.color",defaultValue:new i.Color("#000000")},{name:"graphicProperties.leaderStyle.thickness",type:"float",JSONname:"DELAVPProperties.GraphicProperties.LeaderStyle.thickness",defaultValue:1},{name:"graphicProperties.leaderStyle.pattern",type:"string",JSONname:"DELAVPProperties.GraphicProperties.LeaderStyle.pattern",defaultValue:"1"},{name:"graphicProperties.leaderStyle.color",type:"Color",JSONname:"DELAVPProperties.GraphicProperties.LeaderStyle.color",defaultValue:new i.Color("#000000")},{name:"leaderPointingPoints",type:"array",JSONname:"DELAVPProperties.Leaders",defaultValue:[]},{name:"lLeaderPointingPoints",type:"ListVector3",JSONname:"DELAVPProperties.Leaders.0.AbsPointPoint3D",defaultValue:[]},{name:"vLeaderAbsPointPoint3D",type:"Vector3",JSONname:"DELAVPProperties.Leaders.0.AbsPointPoint3D",defaultValue:new i.Vector3},{name:"pointedReferences",type:"array",JSONname:"DELAVPProperties.Leaders",defaultValue:[]},{name:"isVisible",type:"bool",JSONname:"DELPictogramProperties.GraphicProperties.visible",defaultValue:!0},{name:"hasALeader",type:"bool",JSONname:"DELPictogramProperties.HasALeader",defaultValue:!1},{name:"leaderEndType",type:"string",JSONname:"DELPictogramProperties.LeaderEndType"},{name:"position",type:"Vector3",JSONname:"DELPictogramProperties.LeaderBreakPoint3D",defaultValue:new i.Vector3},{name:"isFilled",type:"bool",JSONname:"DELPictogramProperties.filled",defaultValue:!0},{name:"hasBorder",type:"bool",JSONname:"DELPictogramProperties.border",defaultValue:!1},{name:"subViewImage",type:"ImageURL",JSONname:"DELPictogramProperties.imgData.imgSrc"},{name:"imageHeight",type:"float",JSONname:"DELPictogramProperties.imgData.imageBoxHeight"},{name:"imageWidth",type:"float",JSONname:"DELPictogramProperties.imgData.imageBoxWidth"},{name:"fImageHeight",type:"float",JSONname:"DELPictogramProperties.imgData.imageBoxHeight"},{name:"fImageWidth",type:"float",JSONname:"DELPictogramProperties.imgData.imageBoxWidth"},{name:"anchorMode",type:"string",JSONname:"DELPictogramProperties.AnchorMode"},{name:"zoomMode",type:"bool",JSONname:"DELPictogramProperties.ZoomMode",defaultValue:!1},{name:"leaderAttachHeightRatio",type:"float",JSONname:"DELPictogramProperties.LeaderAttachHeightRatio"},{name:"leaderAttachLengthRatio",type:"float",JSONname:"DELPictogramProperties.LeaderAttachHeightRatio"},{name:"leaderAttachWidthRatio",type:"float",JSONname:"DELPictogramProperties.LeaderAttachWidthRatio"},{name:"boxRotationAngle",type:"float",JSONname:"DELPictogramProperties.BoxRotationAngle"},{name:"graphicProperties.borderRadius",type:"float",JSONname:"DELPictogramProperties.BorderRadius"},{name:"graphicProperties.fillStyle.color",type:"Color",JSONname:"DELPictogramProperties.GraphicProperties.FillStyle.color",defaultValue:new i.Color("#ffffff")},{name:"graphicProperties.fillStyle.opacity",type:"float",JSONname:"DELPictogramProperties.GraphicProperties.FillStyle.opacity",defaultValue:1},{name:"graphicProperties.lineStyle.thickness",type:"float",JSONname:"DELPictogramProperties.GraphicProperties.LineStyle.thickness",defaultValue:1},{name:"graphicProperties.lineStyle.pattern",type:"string",JSONname:"DELPictogramProperties.GraphicProperties.LineStyle.pattern",defaultValue:"1"},{name:"graphicProperties.lineStyle.color",type:"Color",JSONname:"DELPictogramProperties.GraphicProperties.LineStyle.color",defaultValue:new i.Color("#000000")},{name:"graphicProperties.leaderStyle.thickness",type:"float",JSONname:"DELPictogramProperties.GraphicProperties.LeaderStyle.thickness",defaultValue:1},{name:"graphicProperties.leaderStyle.pattern",type:"string",JSONname:"DELPictogramProperties.GraphicProperties.LeaderStyle.pattern",defaultValue:"1"},{name:"graphicProperties.leaderStyle.color",type:"Color",JSONname:"DELPictogramProperties.GraphicProperties.LeaderStyle.color",defaultValue:new i.Color("#000000")},{name:"leaderPointingPoints",type:"array",JSONname:"DELPictogramProperties.Leaders",defaultValue:[]},{name:"lLeaderPointingPoints",type:"ListVector3",JSONname:"DELPictogramProperties.Leaders.0.AbsPointPoint3D",defaultValue:[]},{name:"vLeaderAbsPointPoint3D",type:"Vector3",JSONname:"DELPictogramProperties.Leaders.0.AbsPointPoint3D",defaultValue:new i.Vector3},{name:"pointedReferences",type:"array",JSONname:"DELPictogramProperties.Leaders",defaultValue:[]}],o=function(){var t,o,r,n,s,h,l,p,d;r=function(e){return"string"==typeof e?"true"===e||"false"!==e&&null:e},n=function(e){return parseFloat(e)},s=function(e){var t=e.replace(/[RGB( )]/gi,"").split(",");return(new i.Color).setRGB(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))},h=function(e){var t=e.split?e.split(" "):null;return t?new i.Vector3(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2])):3===e.length?new i.Vector3(e[0],e[1],e[2]):void 0},l=function(e){var t,i=[];for(t=0;t<e.length;t++)i.push(h(e[t]));return i},p=function(e){var t,i=new Image;return(t=e&&0===e.indexOf('"')?JSON.parse(e):e)&&""!==t&&(i.src=t),i},d=function(e,t){if(null!=e&&""!==e&&null!=t&&""!==t)switch(t){case"bool":return r(e);case"float":return n(e);case"Color":return s(e);case"Vector3":return h(e);case"ListVector3":return l(e);case"ImageURL":return p(e);case"string":default:return e}},t=function(t){var i=[];return e.is(t)&&t.forEach(function(e){i.push(d(e.AbsPointPoint3D,"Vector3"))}),i};let c=function(t){var i=[];return e.is(t,"array")&&t.forEach(function(e){i.push(d(e.PointedReference,"string"))}),i};return o=function(t,i){var a,o=t.occurrences||{},r=[];return e.is(i)&&e.Array.detect(o,function(e){e.id!==i||(a=e.path)}),a instanceof Array&&t.entities instanceof Array&&a.forEach(function(e){t.entities.forEach(function(t){e===t.id&&r.push(t.identifier)})}),r},{getParseWKIData:function(i){let r=[],n=[],s=function(i){var r,s,h,l={},p=function(e,t){var i=l;e.forEach(function(a,o){i.hasOwnProperty(a)||(o===e.length-1?i[a]=t:i[a]={}),i=i[a]})};l.id=i.id,l.name=i.Name,l.type=i.type,a.forEach(function(a){if(e.is(a.JSONname))for(r=i,s=a.JSONname.split(".");0===s.length&&("leaderPointingPoints"===a.name?l[a.name]=t(d(r,a.type)):"pointedReferences"===a.name?l[a.name]=c(d(r,a.type)):(h=a.name.split(".")).length>1?p(h,d(r,a.type)):l[a.name]=d(r,a.type)),r=r[s.shift()],e.is(r););});let u=n.find(function(t){if(e.is(t.entities))return t.entities});return l.pointedReferenceOccurencesIdToPathMap={},e.is(l.pointedReferences,"array")&&l.pointedReferences.forEach(e=>{l.pointedReferenceOccurencesIdToPathMap[e]=o(u,e)}),l};return i&&i.data&&i.uuid&&(n=i&&i.data&&i.data.Model[0]&&i.data.Model[0].WKIObjects?i.data.Model[0].WKIObjects:[]).forEach(function(t){var a,o,h,l,p;"View"===t.type&&e.is(t.proxiedSlideUuid)&&t.proxiedSlideUuid===i.uuid&&(a=t,i.uuid,h=[],l=[],p=[],e.is(a)&&(e.is(a.subObjects)||e.is(a.ObjectOverloads))&&(l=a.subObjects||[],p=a.ObjectOverloads||[],l.forEach(e=>{n.forEach(t=>{"AssociativeViewPicture"===t.type&&e===t.id&&h.push(s(t))})}),p.forEach(t=>{n.forEach(i=>{if("Pictogram"===i.type&&t.targetId===i.id){o=s(i);let a=t.state;a&&(o.isVisible=!e.is(a.visible,"boolean")||a.visible,e.is(a.LeaderBreakPoint3D,"array")&&(o.position.x=a.LeaderBreakPoint3D[0],o.position.y=a.LeaderBreakPoint3D[1],o.position.z=a.LeaderBreakPoint3D[2])),h.push(o)}})})),r=h)}),r}}};let r;return e.is(r)||(r=new o),r}),define("DS/DELWebViewerWorkInstructionCommon/View/DELSubViewTools",["DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Mesh/Mesh","DS/SceneGraphNodes/ArrowNode","DS/Visualization/MaterialManager","DS/DELWebViewerWorkInstructionCommon/View/DELViewMathsVector3D"],function(e,t,i,a,o,r){"use strict";var n,s=function i(){var n,s,h,l,p;return n=function(t){var i=(new e.Matrix4).setRotationFromQuaternion(t.clone()).elements;return{X:new e.Vector3(i[0],i[1],i[2]),Y:new e.Vector3(i[4],i[5],i[6]),Z:new e.Vector3(i[8],i[9],i[10]),Origin:new e.Vector3(i[12],i[13],i[14])}},s=function(t,i,a){var o=(new e.Projector).projectVector(i.clone(),t.viewpoints[0].getCamera()),r=Math.round((0-o.y)*(a.getContent().offsetHeight/2))+a.getContent().offsetHeight/2,n=Math.round(o.x*(a.getContent().offsetWidth/2))+a.getContent().offsetWidth/2,s=r>0&&r<a.getContent().offsetWidth&&n>0&&n<a.getContent().offsetWidth;return{top:r,left:n,bottom:a.getContent().offsetHeight-r,right:a.getContent().offsetWidth-n,inWindow:s}},h=function(t,i){var a,o,r,n,s,h=t.currentViewpoint;return 1===h.getProjectionType()?a=h.camera.top-h.camera.bottom:(o=h.getAngle()*Math.PI/180,r=h.getEyePosition(),n=(new e.Vector3).copy(i),s=(new e.Vector3).subVectors(n,r),a=2*Math.tan(.5*o)*s.length()),a/t.SCREEN_HEIGHT},l=function(e,t,i){var a,o,n={};return UWA.is(e)&&UWA.is(t)&&UWA.is(i)&&(a=r.squaredLength(i))>1e-6&&(o=r.dot(r.sub(e,t),i)/a,n.aPosition=r.multiplyAndAdd(i,o,e),n.distance=r.subAndLength(e,n.aPosition)),n},p=function(e,t,i,a){var o,r=void 0!==a?a:.001,n=!0;switch(void 0!==i?i:"float"){case"float":n=Math.abs(e-t)<r;break;case"Vector3":n=Math.abs(e.x-t.x)<r&&Math.abs(e.y-t.y)<r&&Math.abs(e.z-t.z)<r;break;case"Matrix4":for(o=0;o<16&&n;o++)n=Math.abs(e.elements[o]-t.elements[o])<r}return n},{colorToHex:function(e){var t,i,a,o,r,n,s;if(UWA.is(e)){if(e.substr&&"#"===e.substr(0,1))return e;if(void 0!==e.r&&void 0!==e.g&&void 0!==e.b)return e.r<0||e.g<0||e.b<0?null:"#"+(t=(t=Math.round(255*e.r).toString(16)).length<2?"0"+t:t)+(i=(i=Math.round(255*e.g).toString(16)).length<2?"0"+i:i)+(a=(a=Math.round(255*e.b).toString(16)).length<2?"0"+a:a);if(o=/(.*?)rgb\((\d+), *(\d+), *(\d+)\)/.exec(e),UWA.is(o))return 0===parseInt(o[2],10)&&0===parseInt(o[3],10)&&0===parseInt(o[4],10)?"#000000":(r=parseInt(o[2],10),n=parseInt(o[3],10),s=parseInt(o[4],10)|n<<8|r<<16,"#"+(0===r?"00"+s.toString(16):s.toString(16)))}return e},getViewpointInfo:function(t){var i,a,o;if(UWA.is(t))return i=(new e.Matrix4).lookAt(new e.Vector3,t.getSightDirection(),t.getUpDirection()),a=(new e.Quaternion).setFromRotationMatrix(i),o=n(a),{position:t.getEyePosition(),sight:t.getSightDirection(),right:o.X,up:t.getUpDirection(),distance:t.getTargetDistance()}},getLineFromWindowPosition:function(t,i,a){var o=new e.Vector3((i-window.pageXOffset)/t.canvas.offsetWidth*2-1,-(a-window.pageYOffset)/t.canvas.offsetHeight*2+1,.5),r=(new e.Projector).pickingRay(o.clone(),t.currentViewpoint.camera);return{position:r.ray.origin.clone(),direction:r.ray.direction.clone()}},getViewerPositionFromPoint:function(t,i){var a=(new e.Projector).projectVector(i.clone(),t.viewpoints[0].getCamera()),o=Math.round((0-a.y)*(t.canvas.offsetHeight/2))+t.canvas.offsetHeight/2,r=Math.round(a.x*(t.canvas.offsetWidth/2))+t.canvas.offsetWidth/2,n=o>0&&o<t.canvas.offsetHeight&&r>0&&r<t.canvas.offsetWidth;return{top:o,left:r,bottom:t.canvas.offsetHeight-o,right:t.canvas.offsetWidth-r,inWindow:n}},convertPixelToModel:function(e){return UWA.is(e.coords)?e.sizeInPixels*h(e.viewer,e.coords):e.sizeInPixels/(96/25.4)},convertModelToPixels:function(e){return UWA.is(e.coords)?e.sizeInMM/h(e.viewer,e.coords):e.sizeInMM*(96/25.4)},getDashPattern:function(e,t,i){var a,r,n=e;return n=parseFloat(n),i?n:(r=(a=new o).getDashPattern?a.getDashPattern(n):a._getDashPattern(n),isNaN(t)||r.forEach(function(e){t}),r)},computeLinePlaneDistance:function(e,t,i,a){var o,n,s,h,p,d={};return d.returnCode=1,UWA.is(e)&&UWA.is(t)&&UWA.is(i)&&UWA.is(a)&&(d.returnCode=0,o=r.normalize(t),n=r.normalize(a),s=r.dot(o,n),Math.abs(s)<.001?(d.angle=0,0===(h=l(e,i,n)).returnCode&&h.distance<.001?d.aPosition=r.clone(e):d.aPosition=h.aPosition):(d.angle=Math.asin(s),p=r.dot(r.sub(e,i),n)/s,d.aPosition=r.multiplyAndAdd(o,p,e))),d},modifyLeaderNode:function(e,i,o,r,n,s,h,l,d,c,u,g){var f,m,D,P,w,y,S,v={};return v.vBreak=r.clone(),v.vAttach=r.clone(),UWA.is(o)&&(v=this.computeNewPoints(e,r,n,s,u,g)),null===v.vBreak&&null===v.vAttach?f:(m=this.getDashPattern(d,null,!0),2,D={arrowWidth:h,headLength:Math.max(2*h+4,10),viewpoint:e.currentViewpoint,arrowDashType:m,arrowScale:2,color:l},P=!p(v.vBreak,n,"Vector3"),w=i.getChildByName("attach"),UWA.is(w)?UWA.is(P)?(w.updateInitialPosition(v.vBreak),w.updateFinalPosition(n),w.updateColor(l),w.setArrowWidth(h),w.setHeadSize(Math.max(2*h+4,10)),w.setHeadType(c),w.setArrowPattern(m),w.setArrowPatternScale(2),f+="(modify attach)"):(i.remove(w),f+="(delete attach)"):UWA.is(P)&&(D.initialPoint=v.vBreak.clone(),D.finalPoint=n.clone(),D.head=c,(w=new a(D)).name="attach",w.setPickable(t.NOPICKABLE),i.add(w),f+="(redraw attach)"),y=P&&!p(v.vBreak,v.vAttach,"Vector3"),S=i.getChildByName("step"),UWA.is(S)?UWA.is(y)?(S.updateInitialPosition(v.vBreak),S.updateFinalPosition(v.vAttach),S.updateColor(l),S.setArrowWidth(h),S.setHeadSize(Math.max(2*h+4,10)),S.setHeadType(0),w.setArrowPattern(m),w.setArrowPatternScale(2),f+="(modify step)"):(i.remove(S),f+="(delete step)"):UWA.is(y)&&(D.initialPoint=v.vBreak.clone(),D.finalPoint=v.vAttach.clone(),D.head=0,(S=new a(D)).name="step",S.setPickable(t.NOPICKABLE),i.add(S),f+="(redraw step)"),f)},computeNewPoints:function(t,a,o,r,n,h){var l,p,d,c,u,g,f,m,D,P,w,y,S={},v=Math.PI/180*105,_=15;return S.vBreak=a.clone(),S.vAttach=a.clone(),UWA.is(n.offsetHeight)?p=n.offsetHeight/2:UWA.is(n.style.pixelHeight)&&(p=n.style.pixelHeight/2),UWA.is(n.offsetWidth)?l=n.offsetWidth/2:UWA.is(n.style.pixelWidth)&&(l=n.style.pixelWidth/2),d=s(t,a,h),u=(c=s(t,o,h)).left-d.left,f=l+_,m=(g=c.top-d.top)>0?i.AttachmentSide.BOTTOM:i.AttachmentSide.TOP,u>0?(UWA.is(r)&&void 0!==r.width&&(f=l+(_=n.offsetWidth*r.width)),u>f&&(D=new e.Vector3(-f,0,0),P=new e.Vector3(u-f,g,0),D.angleTo(P)>v&&(m=i.AttachmentSide.RIGHT))):-u>f&&(r&&void 0!==r.width&&(f=l+(_=n.offsetWidth*r.width)),D=new e.Vector3(f,0,0),P=new e.Vector3(u+f,g,0),D.angleTo(P)>v&&(m=i.AttachmentSide.LEFT)),u<0&&(u=-u),(g=c.top-d.top)<0&&(g=-g),g<p&&u<l?(S.vBreak=null,S.vAttach=null,S):(m===i.AttachmentSide.RIGHT||m===i.AttachmentSide.LEFT?(w=l,m===i.AttachmentSide.LEFT&&(w=-w),S.vAttach=this.computeProjection(t,a,d.left+w,d.top),w=l+_,m===i.AttachmentSide.LEFT&&(w=-w),S.vBreak=this.computeProjection(t,a,d.left+w,d.top)):m!==i.AttachmentSide.TOP&&m!==i.AttachmentSide.BOTTOM||(y=p,m===i.AttachmentSide.TOP&&(y=-y),S.vAttach=this.computeProjection(t,a,d.left,d.top+y),UWA.is(r)&&void 0!==r.height?(y=p+(_=n.offsetHeight*r.height),m===i.AttachmentSide.TOP&&(y=-y),S.vBreak=this.computeProjection(t,a,d.left,d.top+y)):S.vBreak=S.vAttach.clone()),S)},computeProjection:function(t,i,a,o){var r=this.getViewpointInfo(t.currentViewpoint).sight.negate(),n=this.getLineFromWindowPosition(t,a,o),s=this.computeLinePlaneDistance(n.position.toArray(),n.direction.toArray(),i.toArray(),r.toArray());return new e.Vector3(s.aPosition[0],s.aPosition[1],s.aPosition[2])}}};return s.AttachmentSide={CENTER:0,LEFT:1,RIGHT:2,TOP:3,BOTTOM:4},UWA.is(n)||(n=new s),n}),define("DS/DELWebViewerWorkInstructionCommon/View/DELSubViewShapeGrid",["UWA/Core","UWA/Class","DS/DELWebViewerWorkInstructionCommon/View/DELSubViewCell"],function(e,t,i){"use strict";return function(){var t,a,o,r,n,s,h=1,l=1,p=[],d=[0],c=[0];return(t=e.createElement("canvas")).width=1e3,t.height=300,a=new i,p.push(a),o=function(e,t){d[e]=t},r=function(e,t){c[e]=t},n=function(e){return{width:e.getCellWd(),height:e.getCellHt(),fontHeight:0}},s=function(){var e;p=[],d=[0],c=[0],h=1,l=1,e=new i,p.push(e)},{updateGrid:function(){var t,i,a,s,p,u,g,f=0,m=0;for(t=0;t<l;t++){for(a=0,i=0;i<h;i++)s=this.getMarkUpCell(i,t),e.is(s)&&a<(p=n(s)).width&&(a=p.width);r(t,a)}for(i=0;i<h;i++){for(u=0,t=0;t<l;t++)s=this.getMarkUpCell(i,t),e.is(s)&&(p=n(s),u=Math.max(p.height,u));o(i,u)}for(t=0;t<h;t++){for(u=d[t],f=0,i=0;i<l;i++)a=c[i],s=this.getMarkUpCell(t,i),e.is(s)&&((g={}).x=f,g.y=m,s.setCellPos(g)),f+=a;m+=u}},getMarkUpCell:function(e,t){var i,a,o;if(p.length>0)for(a=0;a<p.length;a++)if((o=p[a].getCellIndex()).row===e&&o.col===t){i=p[a];break}return i},getNbofRows:function(){return h},setNbofRows:function(e){var t,a,o,r;if(e!==h&&s(),e>h)for(t=h,a=0;a<l;a++)for(o=t;o<e;o++)r=new i(o,a),p.push(r),d[o]=0;h=e},getNbofColumns:function(){return l},setNbofColumns:function(e){var t,a,o;if(e!==l&&s(),e>l)for(t=l;t<e;t++){for(a=0;a<h;a++)o=new i(a,t),p.push(o);c[t]=0}l=e},getRowHt:function(e){return d[e]},getColWd:function(e){return c[e]}}}}),define("DS/DELWebViewerWorkInstructionCommon/View/DELSubViewShape",["UWA/Core","UWA/Class","DS/DELWebViewerWorkInstructionCommon/View/DELSubViewShapeGrid","DS/DELWebViewerWorkInstructionCommon/View/DELSubViewTools"],function(e,t,i,a){"use strict";return function(t,o){var r;return{getMarkUpGrid:function(){return r||(r=new i),r},buildGrid:function(){var i,r,n,s,h,l,p=0;n=(i=this.getMarkUpGrid()).getMarkUpCell(0,0),r=t.subViewImage,e.is(i)&&e.is(t)&&e.is(n)&&e.is(r)&&(i.setNbofRows(1),i.setNbofColumns(1),n.setCellImage(r),p=t.imageWidth,s=t.imageHeight,e.is(p)&&e.is(s)?(h=t.position,e.is(h)?(p=a.convertModelToPixels({sizeInMM:p,viewer:o})*window.devicePixelRatio,s=a.convertModelToPixels({sizeInMM:s,viewer:o})*window.devicePixelRatio):(p*=l=o.SCREEN_HEIGHT/2,s*=l)):(p=r.naturalWidth,s=r.naturalHeight),n.setCellWd(p),n.setCellHt(s),i.updateGrid())}}}}),define("DS/DELWebViewerWorkInstructionCommon/View/DELSubViewShapeNode",["UWA/Core","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/SceneGraphNodes/BillBoardNode3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/SceneGraphNodes/CanvasNodeTexture","DS/SceneGraphNodes/CanvasNode","DS/DELWebViewerWorkInstructionCommon/View/DELSubViewTools","DS/DELWebViewerWorkInstructionCommon/View/DELSubViewShape"],function(e,t,i,a,o,r,n,s,h,l){"use strict";var p,d;return(p=t.extend({init:function(t){this._parent(),this._canvas=e.createElement("canvas"),this._canvas.width=1e3,this._canvas.height=300,this._canvasCopy=e.createElement("canvas"),this._canvasPictureToDisplay=e.createElement("canvas"),this._canvasNode=null,this._containerNode=null,this._sizeData={},this._additionalSpace=null,this._zoomMode=null,this._rotationAngle=0,this._imgToDisplay=new Image,this.avpData=t.avpData,this.delShape=new l(this.avpData,d),this._appData={anchorMode:"center",isFilled:!0,hasBorder:!1,graphicProperties:{padding:0,borderRadius:8,horizontalAlignement:"center",fontStyle:{height:12,familyName:"sans-serif",familyStyle:"normal",color:new i.Color(0)},fillStyle:{color:new i.Color(16777215),opacity:1},lineStyle:{thickness:1,pattern:"1",color:new i.Color(4013373)}},isHighlighted:!1},this.canvasNodeTexture=null},modify:function(){var e,a,n,s,h,l;if(this.avpData.position&&(this._appData.position=this.avpData.position.clone(),this.setMatrix((new i.Matrix4).setPosition(this._appData.position))),!this._compareOpts(this.avpData)||!this._canvasNode){if(e=!1,(this._appData.subViewImage&&!this.avpData.subViewImage||!this._appData.subViewImage&&this.avpData.subViewImage||this._appData.subViewImage&&this.avpData.subViewImage&&(this._appData.subViewImage.src!==this.avpData.subViewImage.src||this._appData.subViewImage.width!==this.avpData.subViewImage.width||this._appData.subViewImage.height!==this.avpData.subViewImage.height))&&(e=!0),("number"==typeof this.avpData.imageWidth&&"number"==typeof this._appData.imageWidth&&this.avpData.imageWidth!==this._appData.imageWidth||"number"==typeof this.avpData.imageHeight&&"number"==typeof this._appData.imageHeight&&this.avpData.imageHeight!==this._appData.imageHeight||e||this.avpData.imageInvertH!==this._appData.imageInvertH||this.avpData.imageInvertV!==this._appData.imageInvertV||this._rotationAngle!==this._appData.boxRotationAngle)&&(a=this.delShape?this.delShape.getMarkUpGrid():null))for(n=0;n<a.getNbofRows();n++)for(s=0;s<a.getNbofColumns();s++)a.getMarkUpCell(n,s)&&(a.getMarkUpCell(n,s).removeCellImageToDisplay(),this._imgToDisplay.src="",this._imgToDisplay.width=1,this._imgToDisplay.height=1,this._imgToDisplay.hasBeenLoaded=!1);this._mergeOpts(this.avpData),this.delShape&&this.delShape.buildGrid(),this._computeBoxSize(),this._zoomMode===this._appData.zoomMode&&this._rotationAngle===this._appData.boxRotationAngle||!this._containerNode||(this.removeChildren(),this._containerNode=null),this._containerNode?this._containerNode.removeChildren():(this._zoomMode=this._appData.zoomMode,this._rotationAngle=this._appData.boxRotationAngle?this._appData.boxRotationAngle:0,this._zoomMode?(this._containerNode=new o({type:"Spherical"}),this.addChild(this._containerNode)):this._rotationAngle?(h=new o({type:"Spherical"}),this.addChild(h),l=new r({ratio:1}),h.addChild(l),this._containerNode=new t,l.addChild(this._containerNode)):this._containerNode=this),this._additionalSpace=this._zoomMode?3:8,this._canvasNode=this._buildCanvasNode((this._zoomMode?this._sizeData.widthInMM:this._sizeData.width)+this._additionalSpace,(this._zoomMode?this._sizeData.heightInMM:this._sizeData.height)+this._additionalSpace,this._drawCallback.bind(this),this._additionalSpace),this._containerNode.addChild(this._canvasNode),this._rotationAngle&&this._containerNode.setMatrix((new i.Matrix4).makeRotationAxis(new i.Vector3(0,0,1),this._rotationAngle))}},getDimensions:function(){return{offsetWidth:this._sizeData.widthInMM>0?this._sizeData.widthInMM:1,offsetHeight:this._sizeData.heightInMM>0?this._sizeData.heightInMM:1}}})).prototype._buildCanvasNode=function(e,t,o,r){var h,l;if(this.canvasNodeTexture=new n({width:e,height:t,webGLV6Viewer:d,drawCB:o,rectangleTexture:!0,materialParams:{depthTest:!1}}),this._zoomMode||this._rotationAngle){switch(this._appData.anchorMode){case"topleft":l=new i.Vector3(-r/2,r/2-t,0);break;case"center":l=new i.Vector3(-e/2,-t/2,0)}h=new s({bottomLeftcorner:l,widthVector:new i.Vector3(e,0,0),heightVector:new i.Vector3(0,t,0),canvasNodeTexture:this.canvasNodeTexture},a)}else{switch(this._appData.anchorMode){case"topleft":l=new i.Vector2(r/2,t-r/2);break;case"center":l=new i.Vector2(e/2,t/2)}h=a.createCanvas2DNode({hotspot:l,canvasNodeTexture:this.canvasNodeTexture})}return h.rectangle.setRenderDepth(10),h.rectangle.excludeFromHighlight(!0,!0),h},p.prototype._computeBoxSize=function(){var t,i,a=null;if(this._sizeData={},e.is(this.delShape)&&(a=this.delShape.getMarkUpGrid()),e.is(a)){for(this._sizeData.height=0,this._sizeData.width=0,t=0;t<a.getNbofRows();t++)this._sizeData.height+=a.getRowHt(t);for(isNaN(this._sizeData.height)&&(this._sizeData.height=1),i=0;i<a.getNbofColumns();i++)this._sizeData.width+=a.getColWd(i);isNaN(this._sizeData.width)&&(this._sizeData.width=1)}this._sizeData.width+=2*this._appData.graphicProperties.padding,this._sizeData.height+=2*this._appData.graphicProperties.padding,this._sizeData.widthInMM=h.convertPixelToModel({sizeInPixels:this._sizeData.width,viewer:d}),this._sizeData.heightInMM=h.convertPixelToModel({sizeInPixels:this._sizeData.height,viewer:d}),this._sizeData.width=Math.round(this._sizeData.width),this._sizeData.height=Math.round(this._sizeData.height),this._sizeData.widthInMM=Math.round(this._sizeData.widthInMM),this._sizeData.heightInMM=Math.round(this._sizeData.heightInMM)},p.prototype._createRoundedRectangle=function(e,t,i,a,o){var r=this._appData.graphicProperties.borderRadius;e.beginPath(),e.moveTo(t+r,i),e.lineTo(t+a-r,i),e.arc(t+a-r,i+r,r,1.5*Math.PI,2*Math.PI),e.lineTo(t+a,i+o-r),e.arc(t+a-r,i+o-r,r,0,.5*Math.PI),e.lineTo(t+r,i+o),e.arc(t+r,i+o-r,r,.5*Math.PI,Math.PI),e.lineTo(t,i+r),e.arc(t+r,i+r,r,Math.PI,1.5*Math.PI),e.closePath()},p.prototype._drawImage=function(e,t,i,a,o,r,n,s){e.save(),e.translate(i+o/2,a+r/2),e.scale(n?-1:1,s?-1:1),e.drawImage(t,-o/2,-r/2,o,r),e.restore()},p.prototype._drawCallback=function(t,a,o,r){var n,s,l,p,c,u,g,f,m,D,P,w,y,S,v,_,V,L,b,N,C,A,E,M,W,I;if(a.scale(1/r,1/r),g=(u=a.canvas.width/(this._zoomMode?h.convertModelToPixels({sizeInMM:this._sizeData.widthInMM+this._additionalSpace,viewer:d}):this._sizeData.width+this._additionalSpace))*this._sizeData.width,P=u*this._sizeData.height,f=(a.canvas.width-g)/2,D=(a.canvas.height-P)/2,this._appData.isFilled)if(this._appData.graphicProperties.fillStyle.gradient){for("leftToRight"===this._appData.graphicProperties.fillStyle.gradient.type?m=a.createLinearGradient(f,D,a.canvas.width-f,D):"topToBottom"===this._appData.graphicProperties.fillStyle.gradient.type?m=a.createLinearGradient(f,D,f,a.canvas.height):"topLeftToBottomRight"===this._appData.graphicProperties.fillStyle.gradient.type?m=a.createLinearGradient(f,D,a.canvas.width-f,a.canvas.height):"bottomLeftToTopRight"===this._appData.graphicProperties.fillStyle.gradient.type&&(m=a.createLinearGradient(f,a.canvas.height,a.canvas.width-f,D)),w=Object.keys(this._appData.graphicProperties.fillStyle.gradient.specs),y=0;y<w.length;y++)m.addColorStop(parseFloat(w[y]),this._appData.graphicProperties.fillStyle.gradient.specs[w[y]]);a.fillStyle=m}else a.fillStyle=h.colorToHex(this._appData.graphicProperties.fillStyle.color),a.globalAlpha=this._appData.graphicProperties.fillStyle.opacity;else a.globalAlpha=0;if(this._createRoundedRectangle(a,(a.canvas.width-g)/2,(a.canvas.height-P)/2,g,P),a.fill(),a.globalAlpha=1,a.fillStyle=h.colorToHex(this._appData.graphicProperties.fontStyle.color),S=this.delShape?this.delShape.getMarkUpGrid():null,v=function(e){e.target.hasBeenLoaded=!0,e.target.removeEventListener("load",v),e.target.listenToLoadEvt=!1,this._appData&&this.canvasNodeTexture&&(this.canvasNodeTexture.requestRedraw(),d.render())},e.is(S))for(n=0;n<S.getNbofRows();n++)for(s=0;s<S.getNbofColumns();s++)if(c=S.getMarkUpCell(n,s),e.is(c))if(_=c.getCellPos(),(V=c.getCellImageToDisplay())||(V=c.getCellImage()),V)L=u*c.getCellWd(),b=u*c.getCellHt(),u*S.getRowHt(n)<b&&(b=u*S.getRowHt(n)),u*S.getColWd(s)<L&&(L=u*S.getColWd(s)),!this._zoomMode&&V.width&&V.height&&(V.width!==L||V.height!==b)&&(V.width>300||V.height>300)&&(C=!1,L===V.width&&b===V.height||(this._canvasCopy.width=V.width,this._canvasCopy.height=V.height,this._canvasCopy.getContext("2d").drawImage(V,0,0),C=!0),A=V,V=this._imgToDisplay,this._canvasPictureToDisplay.width=L,this._canvasPictureToDisplay.height=b,this._canvasPictureToDisplay.getContext("2d").drawImage(C?this._canvasCopy:A,0,0,this._canvasPictureToDisplay.width,this._canvasPictureToDisplay.height),N=this._canvasPictureToDisplay.toDataURL("image/png"),V.width=this._canvasPictureToDisplay.width,V.height=this._canvasPictureToDisplay.height,c.setCellImageToDisplay(V)),V.hasBeenLoaded||(V.listenToLoadEvt&&(V.removeEventListener("load",v.bind(this)),V.listenToLoadEvt=!1),V.addEventListener("load",v.bind(this)),V.listenToLoadEvt=!0,N&&(V.src=N)),this._drawImage(a,V,f+u*_.x+("center"===this._appData.graphicProperties.horizontalAlignement?(a.canvas.width-2*f-L)/2:0),D+u*_.y,L,b,this._appData.imageInvertH,this._appData.imageInvertV);else if((E=(p=c.getCellText())?p.getTextToDisplay():null)&&E.length)for(M=p.getFontStyle()?p.getFontStyle()+" ":"",W=p.getFontName()?p.getFontName():"sans-serif",a.font=M+u*p.getFontSize()*window.devicePixelRatio+"px "+W,I=u*this._appData.graphicProperties.padding,l=0;l<E.length;++l)a.fillText(E[l],f+u*(this._appData.graphicProperties.padding+c.size.paddingX+_.x),D+I+u*(c.size.paddingY+c.size.fontHeight+_.y)),I+=u*(2*c.size.paddingY+c.size.fontHeight);!this._appData.hasBorder&&this._appData.inEdition?(a.strokeStyle="#00C8FF",a.lineWidth=Math.max(this._appData.graphicProperties.lineStyle.thickness,4),a.stroke()):this._appData.hasBorder&&(this._appData.inEdition?(a.strokeStyle="#00C8FF",a.lineWidth=Math.max(this._appData.graphicProperties.lineStyle.thickness,4)):(a.strokeStyle=h.colorToHex(this._appData.graphicProperties.lineStyle.color?this._appData.graphicProperties.lineStyle.color:h.colorToHex(new i.Color(12775156))),a.lineWidth=this._appData.graphicProperties.lineStyle.thickness),this._appData.graphicProperties.lineStyle.pattern&&a.setLineDash(h.getDashPattern(this._appData.graphicProperties.lineStyle.pattern,2)),a.stroke()),d.render()},p.prototype._compareOpts=function(e){var t,i,a,o,r,n=function(e,t){return void 0===t||void 0===e||JSON.stringify(t)===JSON.stringify(e)},s=Object.keys(e);for(t=0;t<s.length;t++)if("graphicProperties"!==s[t]&&"breakPoint2D"!==s[t]&&"position"!==s[t]&&"pointingPoints"!==s[t]){if("subViewImage"===s[t]){if(this._appData[s[t]]&&!e[s[t]]||!this._appData[s[t]]&&e[s[t]])return!1;if(this._appData[s[t]].src!==e[s[t]].src||this._appData[s[t]].width!==e[s[t]].width||this._appData[s[t]].height!==e[s[t]].height)return!1}else if(!n(this._appData[s[t]],e[s[t]]))return!1}else if("graphicProperties"===s[t])for(i=Object.keys(e[s[t]]),a=0;a<i.length;a++)if("fontStyle"===i[a]||"fillStyle"===i[a]||"lineStyle"===i[a]){for(o=Object.keys(e[s[t]][i[a]]),r=0;r<o.length;r++)if(!n(this._appData[s[t]][i[a]][o[r]],e[s[t]][i[a]][o[r]]))return!1}else if(!n(this._appData[s[t]][i[a]],e[s[t]][i[a]]))return!1;return!0},p.prototype._mergeOpts=function(e){var t,i,a,o,r,n=function(e){return null!=e&&e.clone?e.clone():e},s=Object.keys(e);for(t=0;t<s.length;t++)if("graphicProperties"!==s[t])this._appData[s[t]]=n(e[s[t]]);else for(i=Object.keys(e[s[t]]),o=0;o<i.length;o++)if("fontStyle"===i[o]||"fillStyle"===i[o]||"lineStyle"===i[o])for(a=Object.keys(e[s[t]][i[o]]),r=0;r<a.length;r++)this._appData[s[t]][i[o]][a[r]]=n(e[s[t]][i[o]][a[r]]);else this._appData[s[t]][i[o]]=n(e[s[t]][i[o]])},function(e){return d=e.viewer,new p(e)}}),define("DS/DELWebViewerWorkInstructionCommon/View/DELSubViewNode3D",["UWA/Core","DS/CoreEvents/Events","DS/Visualization/Node3D","DS/Manipulators/ScreenPlaneManipulator","DS/Visualization/ThreeJS_DS","DS/DELWebViewerWorkInstructionCommon/View/DELSubViewShapeNode","DS/DELWebViewerWorkInstructionCommon/View/DELSubViewTools"],function(e,t,i,a,o,r,n){"use strict";var s,h,l,p=i.extend({init:function(e){var a;this._avpData=e||{},this._parent(),this._nPictureBoxNode=new r({viewer:s,avpData:e}),this.addChild(this._nPictureBoxNode),this._nPictureBoxNode.setPickParent(!0),this.setName(this._avpData.name),this.setUserData({type:this._avpData.type}),this.setNoZ(!0),this._nLeaderNode=new i,this.addChild(this._nLeaderNode),this._nLeaderNode.setPickParent(!0),this._hideShowTokens=[],this._wuxTokens=[];let o=this;a=l.getHideShowController(),this._hideShowTokens.push(a.getModelEvents().subscribe({event:"onHide"},function(){o._updateLeaderAndPictureBoxVisibility.bind(o)})),this._hideShowTokens.push(a.getModelEvents().subscribe({event:"onShow"},function(){o._updateLeaderAndPictureBoxVisibility.bind(o)})),this._wuxTokens.push(t.subscribe({event:"/VISU/"},this.onViewerEventCB.bind(this))),this._wuxTokens.push(t.subscribe({event:"/VISU/onSceneGraphUpdate"},function(e){"REMOVE"===e.eventType&&(o._hideShowTokens.forEach(e=>{a.getModelEvents().unsubscribe(e)}),o._hideShowTokens=[])}))},onViewerEventCB:function(e){"@onWindowResized"!==e.eventType&&"@onViewpointChange"!==e.eventType&&"onSwapVisibleSpace"!==e.eventType||(this._updateLeaderPosition(),this._updateLeaderAndPictureBoxVisibility(),s.render())},update:function(){this._nPictureBoxNode.modify(),this._updateLeaderPosition(),this._updateLeaderAndPictureBoxVisibility(),this.setVisibility(this._avpData.isVisible),s.render()},destroy:function(){this._wuxTokens.forEach(e=>{t.unsubscribe(e)}),this._wuxTokens=[],this._hideShowTokens.forEach(e=>{l.getHideShowController().getModelEvents().unsubscribe(e)}),this._hideShowTokens=[]}});return p.prototype._updateLeaderPosition=function(){var t,a,r,l,p,d,c,u,g,f,m,D,P,w,y;if(!this._avpData.hasALeader)return this._nLeaderNode.setVisibility(!1),void this._nLeaderNode.setVisibilityFree(!0);if(this._nLeaderNode.setVisibility(!0),this._nLeaderNode.setVisibilityFree(!1),0===s.getVisibleSpace()&&!1===this._avpData.isVisible||1===s.getVisibleSpace()&&!0===this._avpData.isVisible){switch(t=0,this._avpData.leaderEndType){case"Arrow":t=1;break;case"Bubble":t=2}if((a=this._nPictureBoxNode.getDimensions()).offsetWidth>0&&a.offsetHeight>0&&(r=this._avpData.position.clone(),(l={offsetWidth:n.convertModelToPixels({sizeInMM:a.offsetWidth,viewer:s,coords:this._avpData.zoomMode?r:null}),offsetHeight:n.convertModelToPixels({sizeInMM:a.offsetHeight,viewer:s,coords:this._avpData.zoomMode?r:null})}).offsetWidth/=window.devicePixelRatio,l.offsetHeight/=window.devicePixelRatio,"topleft"===this._avpData.anchorMode&&(this._avpData.zoomMode?(p=s.currentViewpoint.getUpDirection().clone(),d=(new o.Vector3).crossVectors(s.currentViewpoint.getSightDirection(),p).setLength(a.offsetWidth/2),p.setLength(-a.offsetHeight/2),r.add(p),r.add(d)):(c=n.getViewerPositionFromPoint(s,r),isNaN(c.left)||isNaN(c.top)||(u=new o.Vector2(c.left+l.offsetWidth/2,c.top+l.offsetHeight/2),g=n.getLineFromWindowPosition(s,u.x,u.y),f=n.getViewpointInfo(s.currentViewpoint),m=n.computeLinePlaneDistance(g.position.toArray(),g.direction.toArray(),this._avpData.position.toArray(),f.sight.toArray()),r=new o.Vector3(m.aPosition[0],m.aPosition[1],m.aPosition[2])))),D=this._avpData.leaderPointingPoints,e.is(D)&&D.length&&(P=this._nLeaderNode.getChildren(),D.forEach(function(a,o){e.is(P[o])||(P[o]=new i("DELSubViewLeaderNode"),P[o].setPickParent(!0),e.is(this._avpData.pointedReferences,"array")&&this._avpData.pointedReferences[o]&&P[o].setUserData({pointedReference:this._avpData.pointedReferences[o]}),this._nLeaderNode.addChild(P[o])),y={width:this._avpData.leaderAttachWidthRatio,height:this._avpData.leaderAttachLengthRatio},n.modifyLeaderNode(s,P[o],!0,r,a,y,this._avpData.graphicProperties.leaderStyle.thickness*window.devicePixelRatio,this._avpData.graphicProperties.leaderStyle.color,this._avpData.graphicProperties.leaderStyle.pattern,t,l,h)}.bind(this)),P=this._nLeaderNode.getChildren(),D.length<P.length)))for(w=P.length-1;w>=D.length;w--)this._nLeaderNode.removeChild(P[w])}},p.prototype._checkSubViewPointedElmtsVisibility=function(t){var i,a,o=!1;return this._avpData.pointedReferenceOccurencesIdToPathMap&&e.is(this._avpData.pointedReferenceOccurencesIdToPathMap[t],"array")&&(i=l.unstreamPath(this._avpData.pointedReferenceOccurencesIdToPathMap[t]),a=s.getSceneGraphOverrideSetManager(),e.is(i)&&(o=a.getCurrentVisibility(i))),o},p.prototype._updateLeaderAndPictureBoxVisibility=function(){var e=this;let t=e._nLeaderNode.getChildren();if(t.forEach(t=>{let i=t.getUserData();if(i&&i.pointedReference){let a=e._checkSubViewPointedElmtsVisibility(i.pointedReference);t.setVisibility(a),t.setVisibilityFree(!a)}}),this.getUserData()&&"Pictogram"===this.getUserData().type){t.every(e=>!1===e.isVisible())?(this._nPictureBoxNode.setVisibility(!1),this._nPictureBoxNode.setVisibilityFree(!0)):(this._nPictureBoxNode.setVisibility(!0),this._nPictureBoxNode.setVisibilityFree(!1))}},function(e,t){return l=t,s=t.getViewer(),h=t.getFrameWindow(),new p(e)}}),define("DS/DELWebViewerWorkInstructionCommon/DELWKIContent/DELWKIContentController",["UWA/Core","UWA/Class","DS/Logger/Logger","DS/Visualization/Node3D","DS/DELWebViewerWorkInstructionCommon/View/DELSubViewNode3D","DS/DELWebViewerWorkInstructionCommon/DELWKIContent/DELWkiContentDataParser"],function(e,t,i,a,o,r){"use strict";return t.extend({logger:i.getLogger("DS/DELWebViewerWorkInstructionCommon/DELWKIContent/DELWKIContentController"),init:function(e){if(!e||!e.context)throw new Error("Invalid Input, context is mandatory");this.context=e.context,this._parent(e)},_getRootNode:function(){return this.context.getViewer().getRootNode()},_getWKINodeBag:function(){return this._getRootNode().getChildByName("WKINodeBag")},_clearWKINodeBag:function(){let t=this._getWKINodeBag();e.is(t)&&t.getChildren().length>0&&(t.getChildren().forEach(e=>{e.destroy&&e.destroy()}),t.removeChildren())},importModel:function(e){this._wkiContent=e&&e.wkiContent?e.wkiContent:null},applySlide:function(t){var i=this;if(i._clearWKINodeBag(),this._wkiContent){let n=r.getParseWKIData({uuid:t.uuid,data:this._wkiContent});if(e.is(n,"array")&&n.length>0){let t,r=0,s=null;t=this._getWKINodeBag(),e.is(t)||(t=new a("WKINodeBag"),this._getRootNode().addChild(t)),setTimeout(function(){if(e.is(n)&&n.length>0)for(r=0;r<n.length;r+=1)s=new o(n[r],i.context),t.addChild(s),s.update()},10)}}else this.logger.error("Model not available , set the model using importModel api")},removeModel:function(){this._clearWKINodeBag(),this._wkiContent=null},destroy:function(){this.removeModel(),this.context=null}})});