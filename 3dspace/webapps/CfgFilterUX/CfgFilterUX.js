define("DS/CfgFilterUX/CfgFilterSlideInComponent",["UWA/Class/View","DS/Controls/Button","DS/Handlebars/Handlebars4","DS/UIKIT/Tooltip","i18n!DS/CfgFilterUX/assets/nls/CfgFilterUX","DS/UIKIT/Mask","css!DS/CfgFilterUX/CfgFilterUX.css"],function(e,t,i,n,o,s,a){return{init:function(e,a,r,l,c,d){var h=UWA.createElement("div",{class:"operations-main-container",id:"operations-container"});r.filterTitle=o.CFG_Filter_Title;var p=i.compile(l);h.innerHTML=p(r),e.appendChild(h);var u=document.querySelector("#cfgslideInBody");c&&u.appendChild(c),a&&u.appendChild(a),d&&u.appendChild(d);var C=[],g=this;g.options=r,r.dialogue.buttonArray.forEach(function(e){var i=new t({label:e.label,value:"cfg"+e.label+"id",emphasize:e.className});i.addEventListener("buttonclick",function(t){e.handler(t)}),1==g.options.displayCompactMode?i.touchMode=!1:i.touchMode=!0,C.push(i)});var f=document.querySelector("#cfgslideInFooter");if(0!=C.length)for(k=C.length-1;k>=0;k--)f.appendChild(C[k].getContent()),C[k].getContent().setStyle("margin-right","5px");var m=document.querySelector("#checkCfgfilterBtn");if(m&&new n({className:"filterValidate",id:"filterValidateId",position:"top",target:m,body:o.CFG_Configuration_Validate_Filter,trigger:"touch"}),r.dialogue.showButton){document.querySelector("#cfgfilterBackBtn").addEventListener("click",function(e){document.querySelector(".operations-main-container").destroy(),require(["DS/CfgFilterUX/CfgFilterFactory"],function(e){e.showFilter()})},!1),require(["DS/CfgFilterUX/CfgFilterFactory"],function(e){e.hideFilter()})}else s.unmask(e)}}}),define("DS/CfgFilterUX/CfgChangeActionCriteria",["UWA/Drivers/Alone","DS/Core/Core","DS/Controls/TooltipModel","UWA/Class/View","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgUtility","UWA/Class/Promise","DS/CfgBaseUX/scripts/CfgXMLServices","DS/UIKIT/Mask","DS/CfgBaseUX/scripts/CfgSearchConfiguration","i18n!DS/CfgFilterUX/assets/nls/CfgFilterUX","css!DS/CfgEvolutionUX/CfgEvolutionUX.css","css!DS/CfgFilterUX/CfgFilterUX.css"],function(e,t,i,n,o,s,a,r,l,c,d){"use strict";return n.extend({editButton:null,textdiv:null,xml:"",xmlDesc:[],caLabelIdentifierMap:null,excludeCAList:[],json:null,displayExpression:"",currentSelectedFilterView:"",setup:function(e){this._parent(e),this.caLabelIdentifierMap=new Map,this.excludeCAList=[],this.xmlDesc=[]},render:function(){var e=this;e.currentSelectedFilterView=e.options.currentSelectedFilterView,this.textBox=UWA.createElement("div").inject(this.options.parentElement),this.textBox.addClassName("CfgEditor"),this.textBox.set({events:{click:function(t){""==this.innerHTML&&e.onCriteriaClickHandler(t)}}}),this.editButton=UWA.createElement("span").inject(this.options.parentElement),this.editButton.set({events:{click:function(t){e.onCriteriaClickHandler(t)}}}),this.editButton.addClassName("fonticon"),this.editButton.addClassName("fonticon-1.5x"),this.editButton.addClassName("fonticon-search"),this.editButton.addClassName("searchbutton"),o.ModelEvents.subscribe({event:"FilterViewChanged"},function(t){e.currentSelectedFilterView=t.currentSelectedView}),this.applyCompactComfortableMode()},applyCompactComfortableMode:function(){null==this.options.displayCompactMode||!1===this.options.displayCompactMode?(this.textBox.setAttributeNode(document.createAttribute("touch-mode")),this.editButton&&this.editButton.setAttributeNode(document.createAttribute("touch-mode"))):(this.textBox.removeAttribute("touch-mode"),this.editButton&&this.editButton.removeAttribute("touch-mode"))},getAttrValue:function(e,t){var i="";return null!=e&&(i=e.get(t)),i},onCriteriaClickHandler:function(e){var t=this,i=d.selectChangeActionForFilter,n=enoviaServerFilterWidget.myRole,o='(current:"In Work" OR current:"In Approval" OR current:"Approved"';"Source"==this.currentSelectedFilterView.view&&(o+=' OR current:"Complete"'),o+=")";var a=t.excludeCAList;if("Native"==window.enoviaServerFilterWidget.mode){for(var r="",l=0;l<a.length;l++)r=r+"NOT (physicalid:"+a[l]+")";""!=a&&(o+=r);var h={precondition:o},p={eventName:"cfgConfigurationFilter",operation:"ActivateSearchCA",operationVersion:"1.0",content:JSON.stringify(h)};s.sendNotificationWebInWin(p)}else{new c(!0,i).activate(i,"Change Action",n,function(e){t.xml="",e.forEach(function(e,i){var n=t.getAttrValue(e,"ds6w:label"),o=t.getAttrValue(e,"ds6w:identifier"),s=t.getAttrValue(e,"id");t.createCADiv(n),t.caLabelIdentifierMap.set(n,{identifier:o,physicalID:s}),t.excludeCAList.push(s)}),t.buildFilterXML()},"",a,o)}},createCADiv:function(e){var t=this;this.caDiv=new UWA.createElement("span",{class:"caDiv"}).inject(this.textBox),UWA.createElement("span",{class:"caLabelSpan"}).inject(this.caDiv).innerHTML=e,UWA.createElement("span",{class:"fonticon fonticon-cancel"}).inject(this.caDiv).set({events:{click:function(e){e.cancelBubble=!0;var i=this.getParent(),n=this.getParent().getElementsByClassName("caLabelSpan")[0].innerHTML,o=t.caLabelIdentifierMap.get(n);t.caLabelIdentifierMap.delete(n);var s=t.excludeCAList.indexOf(o.physicalID);t.excludeCAList.splice(s,1),i.destroy(),t.buildFilterXML()}}})},clearCAComponent:function(){this.textBox.innerHTML="",this.displayExpression="",this.xml="",this.caLabelIdentifierMap.clear(),this.excludeCAList=[]},updateDisplayExpression:function(e){this.displayExpression=e},buildDisplayExpression:function(){return this.displayExpression},buildFilterJson:function(){return this.options.psJson},getFilterXML:function(){return this.xml},buildFilterXML:function(){var e=this;e.xml="";var t=0,i="";return window.DescriptionCount++,this.caLabelIdentifierMap.forEach(function(n,o){e.xml+=`<OperationHandler Name="${n.identifier}" Type="Change" OperationHandlerId="${t}" DescId="${window.DescriptionCount}"/>`,0==t?i+=o:i=i+", "+o,e.xmlDesc.push(`<OperationHandler DescId = "${window.DescriptionCount}" DisplayName="${o}"/>`),t++,window.DescriptionCount++}),e.updateDisplayExpression(i),this.xml},setFilterXML:function(e){this.xml=e},buildDescription:function(){return this.xmlDesc},show:function(){this.textBox.show(),this.editButton&&this.editButton.show()},hide:function(){this.textBox.hide(),this.editButton&&this.editButton.hide()},initialiseComponent:function(e){var t,i=this,n="",o="",a="";null==e.caNameArray&&null==e.caNameArray||e.caNameArray.forEach(function(e,t){0==t?a+="([ds6w:identifier]:("+e+"))":a=a+" OR ([ds6w:identifier]:("+e+"))"}),null==e.caIDArray&&null==e.caIDArray||e.caIDArray.forEach(function(e,t){a=0==t?"physicalid:"+e:a+" OR physicalid:"+e});n={with_indexing_date:!0,with_nls:!1,label:"yus-1515078503005",locale:"en",select_predicate:["ds6w:label","ds6w:description","ds6w:identifier"],select_file:["icon","thumbnail_2d"],query:"flattenedtaxonomies:(types/Change Action) AND ("+a+")",order_by:"desc",order_field:"relevance",nresults:1e3,start:"0",source:[],tenant:enoviaServerFilterWidget.tenant};t={isfederated:"true"};n=JSON.stringify(n);s.makeWSCall("/search?xrequestedwith=xmlhttprequest","POST","enovia","application/json",n,function(e){e.results.forEach(function(e,t){if(null!=e&&e.attributes.length>0){for(var n="",s="",a="",r=0;r<e.attributes.length;r++)"ds6w:label"==e.attributes[r].name?(n=e.attributes[r].value,0==t?o+=e.attributes[r].value:o=o+", "+e.attributes[r].value):"ds6w:identifier"==e.attributes[r].name?s=e.attributes[r].value:"resourceid"==e.attributes[r].name&&(a=e.attributes[r].value);i.createCADiv(n),i.caLabelIdentifierMap.set(n,{identifier:s,physicalID:a}),i.excludeCAList.push(a)}}),i.buildFilterXML()},function(e){reject(e)},!0,t)}})}),define("DS/CfgFilterUX/CfgPCChooser",["UWA/Class/View","UWA/Class/Model","DS/WUXAutoComplete/AutoComplete","DS/CfgBaseUX/scripts/CfgSearchConfiguration","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgUtility","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","css!DS/CfgFilterUX/CfgFilterUX.css"],function(e,t,i,n,o,s,a,r,l,c){"use strict";return e.extend({model:t.extend({ID:"",label:"",revision:""}),className:"CFGPCAutoComplete",init:function(e){this._parent(e),this.model=new t,this.listenTo(this.model,"onChange:label",this.updateView),this.modelID=e.modelID},updateView:function(){let e=this.model.get("label")||"",t=this.model.get("revision")||"";this.pcAutoComplete.value=t?`${e}-${t}`:e},launchAsyncPCSearch:function(){let e=this;return new Promise((t,i)=>{let n={"3dspace":{SecurityContext:enoviaServerFilterWidget.mySecurityContext}},a="",r=o.singleProductId;(o.productstateCheckbox&&0==o.productstateCheckbox.checkFlag||o.xRevCheckBox&&!1===o.xRevCheckBox.checkFlag)&&(r="");let l={with_indexing_date:!0,with_nls:!1,label:"yus-1515078503005",locale:"en",select_predicate:["ds6w:label","ds6w:identifier","ds6wg:revision"],select_file:["icon","thumbnail_2d"],query:`flattenedtaxonomies:(types/Product Configuration) AND ${a=r?"(based_95_on_95_model_95_version_95_pid:"+r+")":"(based_95_on_95_model_95_pid:"+this.modelID+")"} `,order_by:"desc",order_field:"relevance",nresults:1e3,start:"0",source:[],tenant:e.options.tenant};""!=enoviaServerFilterWidget.mySecurityContext&&(l.login=n);l=JSON.stringify(l),s.makeWSCall("/search?xrequestedwith=xmlhttprequest","POST","enovia","application/json",l,function(i){if(!i.results||!Array.isArray(i.results))return void t([]);let n=e.prepareTreeForAutoComplete(i.results);t(n)},function(){i()},!0,{isfederated:"true"})})},prepareTreeForAutoComplete:function(e){let t=new a;return t.prepareUpdate(),e.forEach(e=>{let i=this.getAttrValue(e,"ds6wg:revision"),n=this.getAttrValue(e,"ds6w:label"),o=this.getAttrValue(e,"ds6w:identifier"),s=new r({label:`${n}-${i}`,value:o,icon:enoviaServerFilterWidget.baseURL+"/snresources/images/icons/small/ProductConfiguration22.png",grid:{ID:this.getAttrValue(e,"resourceid"),pclabel:n,revision:i,tags:n+i+o}});t.addRoot(s)}),t.pushUpdate(),t},getAttrValue:function(e,t){let i="";return e.attributes.length<=0?i:(e.attributes.forEach(e=>{e.name==t&&(i=e.value)}),i)},updateAutoCompleteModel:function(){this.pcAutoComplete.elementsTree&&(this.pcAutoComplete.value="",this.pcAutoComplete.elementsTree=void 0,this.pcAutoComplete.elementsTree=(()=>this.launchAsyncPCSearch()))},render:function(){let e=this;this.pcAutoComplete=new i({elementsTree:()=>e.launchAsyncPCSearch(),multiSearchMode:!1,minLengthBeforeSearch:0,allowFreeInputFlag:!1,filterCB:function(e){this.filterItems(e,{property:"tags"})}}),this.pcAutoComplete.inject(e.options.parentDiv),this.pcAutoComplete.addEventListener("uncommittedChange",e=>{e&&e.options&&e.options.uncommittedValue?this.pcSearchBtn&&this.pcSearchBtn.hide():this.pcSearchBtn&&(this.pcSearchBtn.show(),this.options.clearProductConfLabelInfo())}),this.pcAutoComplete.addEventListener("change",t=>{if(t&&t.dsModel&&t.dsModel.selectedItems){this.pcSearchBtn&&this.pcSearchBtn.hide();let i=t.dsModel.selectedItems.getAttributeValue("ID");i&&(e.model.set("ID",i),e.model.set("revision",t.dsModel.selectedItems.getAttributeValue("revision")),e.model.set("label",t.dsModel.selectedItems.getAttributeValue("pclabel"))),e.options.processPCCallback()}else this.pcSearchBtn&&(this.pcSearchBtn.show(),this.options.clearProductConfLabelInfo())}),this.pcSearchBtn=UWA.createElement("span").inject(e.options.parentDiv),this.pcSearchBtn.set({events:{click:function(t){e.launchInContextPCSearch(t)}}}),this.pcSearchBtn.addClassName("fonticon"),this.pcSearchBtn.addClassName("fonticon-1.5x"),this.pcSearchBtn.addClassName("fonticon-search"),this.pcSearchBtn.addClassName("searchbutton"),e.options.PCID&&e.model.set("ID",e.options.PCID),e.options.PCRev&&e.model.set("revision",e.options.PCRev),e.options.PCLabel&&e.model.set("label",e.options.PCLabel)},setModelID:function(e){this.modelID=e},launchInContextPCSearch:function(){let e=this,t=c.selectProductConfigurationForFilter,i=enoviaServerFilterWidget.myRole,a="",r=o.singleProductId;(o.productstateCheckbox&&0==o.productstateCheckbox.checkFlag||o.xRevCheckBox&&!1===o.xRevCheckBox.checkFlag)&&(r=""),a=r?`(based_95_on_95_model_95_version_95_pid: ${r})`:`(based_95_on_95_model_95_pid: ${this.modelID})`;if("Native"==window.enoviaServerFilterWidget.mode){var l={precondition:a},d={eventName:"cfgConfigurationFilter",operation:"ActivateSearchPC",operationVersion:"1.0",content:JSON.stringify(l)};s.sendNotificationWebInWin(d)}else{new n(!1,t).activate(t,"Product Configuration",i,function(t){t=t[0];var i=["id","ds6w:label","ds6wg:revision"];let n="";Object.keys(t._attributes).forEach(function(o){-1!==i.indexOf(o)&&("ds6wg:revision"==o?e.model.set("revision",t.get(o)):"ds6w:label"==o?n=t.get(o):e.model.set("ID",t.get(o)))}),e.model.set("label",n)},"","",a)}},show:function(){this.pcAutoComplete.show(),this.pcSearchBtn&&!this.pcAutoComplete.value&&this.pcSearchBtn.show()},hide:function(){this.pcAutoComplete.hide(),this.pcSearchBtn&&this.pcSearchBtn.hide()}})}),define("DS/CfgFilterUX/CfgVariantEditor",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Input/Button","DS/ConfiguratorPanel/scripts/Presenters/PCPanel","DS/ConfiguratorPanel/scripts/ConfiguratorSolverFunctions","DS/CoreEvents/ModelEvents","DS/UIKIT/Modal","DS/UIKIT/Spinner","DS/UIKIT/Mask","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgContainerView","DS/CfgFilterUX/CfgFilterSlideInComponent","text!DS/CfgFilterUX/CfgFilterslideInDialogTemplate.html","DS/CfgBaseUX/scripts/CfgData","i18n!DS/CfgFilterUX/assets/nls/CfgFilterUX","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json","css!DS/CfgFilterUX/CfgFilterUX.css"],function(e,t,i,n,o,s,a,r,l,c,d,h,p,u,C,g){"use strict";return t.extend({init:function(t){u.selectedOptionsforConfigurator="",this.options=t?e.clone(t,!1):{};var i={useSolver:!0,configData:{xml:"",displayXml:"",xmlDesc:""},parentContainer:document.body};e.merge(this.options,i),"Filter"==this.options.invokeFrom||this.getModal(),this.modelEvent=new s,e.is(this.options.onOK,"function")&&this.modelEvent.subscribe({event:"onCfgDataChange"},this.options.onOK)},render:function(){this.options.dataFromPC&&(this.options.productId=this.options.dataFromPC.productId,this.options.startDate=this.options.dataFromPC.startDate,this.options.configuration=this.options.dataFromPC.configurationData.configurationCriteria,this.options.appRulesParams=this.options.dataFromPC.configurationData.appRuleParam,this.options.cfgCriteria="{}",this.options.dataFromPC.startDate&&(this.options.cfgCriteria='{"date":{"startDate":"'+this.options.startDate+'","endDate":""}, "milestone":{"id":""}, "productState":{"productRev":""}}')),this.buildSkeleton()},buildSkeleton:function(){this.configModelEvents=new s,this.ws_pcModel=this.options.configuration,this.VariantsConfigPanelContainer=e.createElement("div",{class:"VariantsConfigPanelContainer"}),this.initializePanel()},initializePanel:function(){var e=this;this.ws_dictionary,this.modal?(this.modal.setBody(this.VariantsConfigPanelContainer),l.unmask(this.modal.elements.body)):window.enoviaServerFilterWidget&&"Native"==window.enoviaServerFilterWidget.mode?this.getLayoutForConfigurator():this.getPanelForConfigurator(),c.isParamDefined(e.options.configuratorOptions)||(e.options.configuratorOptions={initialRuleLevel:"RulesMode_EnforceRequiredOptions",rulesActivation:"true"});let t="selectionMode_Build";JSON.parse(g).ConfiguratorInDefaultBuildMode||u.filter150Checkbox&&u.filter150Checkbox.checkFlag&&(t="selectionMode_Refine");var i={version:"V5",realistic:!1,tenant:enoviaServerFilterWidget.tenant,isWebInWin:!0,"3DSpaceUrl":enoviaServerFilterWidget.baseURL,mvId:e.options.productId,ruleLevels:{RulesMode_ProposeOptimizedConfiguration:!1,RulesMode_SelectCompleteConfiguration:!1,RulesMode_EnforceRequiredOptions:!0,RulesMode_DisableIncompatibleOptions:!0},initalOptions:{initialRuleLevel:e.options.configuratorOptions.initialRuleLevel,initialMode:t},rulesActivation:e.options.configuratorOptions.rulesActivation,configCriteria:e.options.cfgCriteria,securityContext:enoviaServerFilterWidget.mySecurityContext};console.log("Config UX: options to launch PCPanel: ",i),this.PCPanel1=new n(e.ws_pcModel,null,e.configModelEvents,i),e.configModelEvents.subscribe({event:"pc-loaded"},function(){e.PCPanel1.inject(e.VariantsConfigPanelContainer),e.VariantsConfigPanelContainer.getElement("#PC-panel-container").addClassName("variants-configuratorPanel");var t=document.getElementsByClassName("topbar-MidMenu-Container").item(0);null!=t&&t.addClassName("variants-topbarMidMenuContainer"),l.unmask(e.VariantsConfigPanelContainer),"Filter"==e.options.invokeFrom&&(l.unmask(e.options.filterParentContainer),l.unmask(e.options.filterParent))})},publishPanelData:function(){this.formattedInnerXML=void 0===this.formattedInnerXML?"":this.formattedInnerXML,this.modelEvent.publish({event:"onCfgDataChange",data:{displayXml:this.formattedInnerDisplayXML,xml:this.formattedInnerXML,PCId:this.options.PCId,configuration:this.options.configuration,selectionmode:this.PCPanel1.getConfigmodel().getAppRulesParam().selectionMode,xmlDesc:this.options.configData.xmlDesc,configuratorOptions:this.options.configuratorOptions}})},createActionsPresenter:function(){var t=e.createElement("div",{class:"actionsContainer"});if(e.is(this.options.onBack,"function")&&new i({value:C.Filter_VariantEditor_Back}).inject(t).elements.container.addClassName("variant-editor-backBtn"),!n){var n=e.createElement("div",{class:"OKCancelContainer"}).inject(t);new i({value:C.Filter_VariantEditor_Ok,className:"primary btn btn-primary variant-editor-okBtn"}).inject(n);new i({value:C.Filter_VariantEditor_Cancel}).inject(n).elements.container.addClassName("variant-editor-cancelBtn")}return t},destroy:function(){o.releaseSolver(),delete this.configModel,delete this.options.modelEvents,delete this.VariantsConfigPanelContainer},getModal:function(){var t=this;this.modal=new a({className:"site-reset",closable:!0,overlay:!0,escapeToClose:!1,header:"<h4>"+C.Filter_VariantEditor_Header+"</h4>",body:this.VariantsConfigPanelContainer,footer:this.createActionsPresenter(),events:{onShow:function(){l.mask(t.modal.elements.body)}}}).inject(this.options.parentContainer),this.modal.getContent().getElements(".btn").forEach(function(i){i.addEvent("click",function(){if(this.hasClassName("variant-editor-backBtn")||this.hasClassName("variant-editor-cancelBtn")){t.formattedInnerXML="",t.options.configData.xml="";var i={xml:"",PCId:""};e.is(t.options.onCancel,"function")&&(this.hasClassName("variant-editor-backBtn")?t.options.onBack(i):t.options.onCancel(i))}this.hasClassName("variant-editor-okBtn")&&(t.PCPanel1._configModel.getXMLExpression?t.options.configData.xml=t.PCPanel1._configModel.getXMLExpression():t.PCPanel1.getXMLProductConfigurationDefinition&&(t.options.configData.xml=t.PCPanel1.getXMLProductConfigurationDefinition()),t.options.configData.displayXml=t.getDisplayXML(t.options.configData.xml),u.selectedOptionsforConfigurator=t.PCPanel1._configModel.getConfigurationCriteria(),console.log(t.options.configData.xml),t.options.configuration=t.PCPanel1._configurations,t.formattedInnerXML=t.getInnerXML(),t.publishPanelData()),t.destroy(),t.modal.destroy(),console.log("Modal destroyed with all references")})}),this.modal.elements.close.onclick=function(){t.destroy(),t.modal.destroy()},this.modal.elements.body.addClassName("variant-modal-body"),this.modal.elements.content.addClassName("variant-modal-content"),this.modal.show()},getDisplayXML:function(e){for(var t=(new DOMParser).parseFromString(e,"text/xml"),i=t.getElementsByTagName("Feature").length,n=0;n<i;n++)t.getElementsByTagName("Feature")[n].setAttribute("Name",encodeURIComponent(t.getElementsByTagName("Feature")[n].getAttribute("DisplayName"))),t.getElementsByTagName("Feature")[n].removeAttribute("DisplayName");return(new XMLSerializer).serializeToString(t)},convertVariantXMLToXMLWithDescIDs:function(e){let t=[],i=(new DOMParser).parseFromString(e,"text/xml"),n=i.getElementsByTagName("FilterSelection");if(n&&n.length>0){let e=[],i=n[0].children,o=(e=i&&1==i.length&&"Context"==i[0].tagName?i[0].children:n[0].children).length;for(let i=0;i<o;i++)if("NOT"==e[i].tagName){let n=e[i].children.length,o=e[i].children;for(let e=0;e<n;e++)this.addAttributes(o[e],t)}else this.addAttributes(e[i],t)}let o=(new XMLSerializer).serializeToString(i);this.options.configData.xml=o,this.options.configData.xmlDesc=t},addAttributes:function(e,t){window.DescriptionCount++,e.setAttribute("DescId",window.DescriptionCount);var i='<Feature DescId = "'+window.DescriptionCount+'" DisplayName="'+encodeURIComponent(e.getAttribute("DisplayName"))+'"></Feature>';t.push(i),e.removeAttribute("DisplayName");for(var n=e.children.length,o=e.children,s=0;s<n;s++){window.DescriptionCount++,o[s].setAttribute("DescId",window.DescriptionCount);i='<Option DescId = "'+window.DescriptionCount+'" DisplayName="'+encodeURIComponent(o[s].getAttribute("DisplayName"))+'" SequenceOrder="'+window.DescriptionCount+'"></Option>';t.push(i),o[s].removeAttribute("DisplayName"),o[s].removeAttribute("SelectedBy")}},getLayoutForConfigurator:function(){var e=this;u.ModelEvents.publish({event:"ConfiguratorLaunched"});var t={isHeader:!0,isFooter:!0,firstButtonText:C.Filter_VariantEditor_Ok,secondButtonText:C.Filter_VariantEditor_Cancel,headerText:C.Filter_VariantEditor_Header,onButtonClickCB:function(t){l.unmask(e.VariantsConfigPanelContainer),"Filter"==e.options.invokeFrom&&(l.unmask(e.options.filterParentContainer),l.unmask(e.options.filterParent)),"firstButton"==t.buttonId?(e.PCPanel1._configModel.getXMLExpression?e.options.configData.xml=e.PCPanel1._configModel.getXMLExpression():e.PCPanel1.getXMLProductConfigurationDefinition&&(e.options.configData.xml=e.PCPanel1.getXMLProductConfigurationDefinition()),e.options.configData.displayXml=e.getDisplayXML(e.options.configData.xml),e.convertVariantXMLToXMLWithDescIDs(e.options.configData.xml),u.selectedOptionsforConfigurator=e.PCPanel1._configModel.getConfigurationCriteria(),e.options.configuratorOptions={initialRuleLevel:e.PCPanel1.getConfigmodel().getRulesMode(),rulesActivation:e.PCPanel1.getConfigmodel().getRulesActivation()},console.log(e.options.configData.xml),e.options.configuration=e.PCPanel1._configurations,e.formattedInnerXML=e.getInnerXML(),e.formattedInnerDisplayXML=e.getInnerDisplayXML(),e.publishPanelData(),e.destroy()):"secondButton"==t.buttonId&&(e.formattedInnerXML="",e.formattedInnerDisplayXML="",e.options.configData.xml="",e.options.configData.displayXml="",u.selectedOptionsforConfigurator=e.options.configuration);e.containerView.destroy(),u.ModelEvents.publish({event:"ConfiguratorClosed"})}};this.containerView=new d(t).render(),this.containerView.inject(u.renderTo),this.VariantsConfigPanelContainer.inject(this.containerView._body)},getPanelForConfigurator:function(){var e=this,t={dialogue:{buttonArray:[{label:C.Filter_VariantEditor_Cancel,handler:function(){e.formattedInnerXML="",e.formattedInnerDisplayXML="",e.options.configData.xml="",e.options.configData.displayXml="";u.selectedOptionsforConfigurator=e.options.configuration,require(["DS/CfgFilterUX/CfgFilterFactory"],function(e){document.querySelector(".operations-main-container").destroy(),e.showFilter()})},className:"default"},{label:C.Filter_VariantEditor_Ok,handler:function(t){e.PCPanel1._configModel.getXMLExpression?e.options.configData.xml=e.PCPanel1._configModel.getXMLExpression():e.PCPanel1.getXMLProductConfigurationDefinition&&(e.options.configData.xml=e.PCPanel1.getXMLProductConfigurationDefinition()),e.options.configData.displayXml=e.getDisplayXML(e.options.configData.xml),e.convertVariantXMLToXMLWithDescIDs(e.options.configData.xml),u.selectedOptionsforConfigurator=e.PCPanel1._configModel.getConfigurationCriteria(),e.options.configuratorOptions={initialRuleLevel:e.PCPanel1.getConfigmodel().getRulesMode(),rulesActivation:e.PCPanel1.getConfigmodel().getRulesActivation()},console.log(e.options.configData.xml),e.options.configuration=e.PCPanel1._configurations,e.formattedInnerXML=e.getInnerXML(),e.formattedInnerDisplayXML=e.getInnerDisplayXML(),""==e.formattedInnerXML&&""==e.formattedInnerDisplayXML&&(e.options.configData.displayXml="",e.options.configData.xml=""),e.publishPanelData(),e.destroy(),require(["DS/CfgFilterUX/CfgFilterFactory"],function(e){document.querySelector(".operations-main-container").destroy(),e.showFilter()})},className:"primary"}],showHeader:!0,showButton:!0},HeaderLabel:C.Filter_VariantEditor_Header,displayCompactMode:this.options.displayCompactMode};h.init(u.renderToApp,this.VariantsConfigPanelContainer,t,p)},getInnerXML:function(){var e,t,i,n,o,s,a="";return(e=this.options.configData.xml)&&(t=e.indexOf("<Feature"),i=e.indexOf("</FilterSelection>"),-1!==(s=e.indexOf("<NOT"))&&s<t&&(t=s),n=e.slice(t,i),o=function(e){var t,i,n;t=e.indexOf("SelectedBy"),i=e.indexOf("/",t),-1===(n=e.substr(0,t)+e.substr(i,e.length+1)).indexOf("SelectedBy")?a=n:o(n)},-1!=n.indexOf("SelectedBy")?(o(n),console.log(a)):a=n),a},getInnerDisplayXML:function(){var e,t,i,n,o,s,a="";return(e=this.options.configData.displayXml)&&(t=e.indexOf("<Feature"),i=e.indexOf("</FilterSelection>"),-1!==(s=e.indexOf("<NOT"))&&s<t&&(t=s),n=e.slice(t,i),o=function(e){var t,i,n;t=e.indexOf("SelectedBy"),i=e.indexOf("/",t),-1===(n=e.substr(0,t)+e.substr(i,e.length+1)).indexOf("SelectedBy")?a=n:o(n)},-1!=n.indexOf("SelectedBy")&&(o(n),console.log(a))),a}})}),define("DS/CfgFilterUX/CfgFilterEditor",["UWA/Drivers/Alone","DS/Core/Core","UWA/Class/View","DS/Handlebars/Handlebars4","text!DS/CfgBaseUX/scripts/CfgDialogTemplate.html","DS/UIKIT/Alert","DS/UIKIT/Modal","DS/Controls/Toggle","DS/Controls/TooltipModel","DS/CfgEvolutionUX/CfgModelSelection","DS/CfgEvolutionUX/CfgProductState","DS/CfgFilterUX/CfgChangeActionCriteria","DS/CfgBaseUX/scripts/CfgData","UWA/Class/Promise","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgEvolutionUX/CfgDatePicker","DS/CfgEvolutionUX/CfgWUXDatePicker","DS/CfgEvolutionUX/CfgUnit","DS/CfgEvolutionUX/CfgVariants","DS/CfgEvolutionUX/CfgConfigurationRevisionPicker","DS/CfgFilterUX/CfgFilterSlideInComponent","DS/UIKIT/Mask","DS/CfgEvolutionUX/CfgFilterView","DS/CfgEvolutionUX/CfgEvolutionViewSelector","DS/CfgBaseUX/scripts/CfgSearchConfiguration","DS/CfgBaseUX/scripts/CfgDialog","DS/CfgBaseUX/scripts/CfgCacheManager","DS/CfgTracker/CfgTracker","DS/CfgTracker/CfgDimension","DS/CfgTracker/CfgValue","DS/CfgBaseUX/scripts/CfgUXEnvVariables","text!DS/CfgFilterUX/CfgFilterslideInTemplate.html","i18n!DS/CfgFilterUX/assets/nls/CfgFilterUX","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","i18n!DS/CfgEffectivityViewUX/assets/nls/CfgEffectivityView","css!DS/UIKIT/UIKIT.css","css!DS/CfgFilterUX/CfgFilterUX.css"],function(e,t,i,n,o,s,a,r,l,c,d,h,p,u,C,g,f,m,v,x,b,F,D,k,I,S,y,P,E,A,R,M,N,_,w,O){"use strict";var L=n.compile(o);return i.extend({name:"filter-dialog-view",globalDisplayExpression:"",globalDisplayExpressionNative:"",tagName:"div",ModelSelectionComponent:null,alertDiv:null,productstateCheckbox:null,ProductStateComponent:null,currentSelectedView:{view:""},DateCheckbox:null,DatePicker:null,UnitCheckbox:null,UnitComponent:null,VariantsCheckbox:null,VariantsComponent:null,filter150Checkbox:null,manufacturingplanComponent:null,manufacturingplanCheckbox:null,configurationRevisionCheckbox:null,cfgConfigurationRevisionPicker:null,init:function(e){this.cfgUXEnvVariables=M.getCfgUXEnvVariables(),"xRevision"===e.filterBasedOn&&(this.isXRev=!0),this.singleProductEvolutionStatus=!0,e.EvolutionLabel=_.Filter_Evolution,e.ModelLabel=_.Filter_Model,this.isXRev&&!e.xRevScopeDefined&&(e.ModelLabel=""),e.VariantsLabel=_.Filter_Variants,this.isXRev||(e.ChangeLabel=_.Filter_Change);var t="";e.expression.filterXML?(t=C.FilterXMLtoJSONConvertor(e.expression.filterXML),C.RetrieveVariantXMLFromFilterXML(e.expression),g.isDefined(e.expression.variants)&&(t[0].expression.iVariantsJson=e.expression.variants),t[0].expression.viewJson={view:e.expression.view},t[0].expression.modelId=e.expression.modelId,this.isXRev&&(t[0].expression.singleProductId=e.expression.singleProductId||""),e.expression=t[0].expression):g.isDefined(e.expression.variants)&&(e.expression.iVariantsJson=e.expression.variants),0!=Object.keys(e.expression).length&&this.checkSingleProductID(e.expression),this._parent(e),p.clear();var i="Native"==enoviaServerFilterWidget.mode?document.body.querySelector(".wiwFilterAlertDiv"):document.body.querySelector(".f-globalFilter-container");this.NotifsParentContainer=i,this.alertDiv=new s({visible:!1,autoHide:!0,hideDelay:3e3,closeOnClick:!0,maximumVisibleMessages:3,className:"error"}),this.alertDiv.inject(i,"top")},getDataFromID:function(e){var t=this;return new u(function(i,n){if(!g.isParamDefined(e.physical_id))return void i();let o={id:e.physical_id},s=JSON.stringify(o);g.makeWSCall("/resources/v1/modeler/dspfl/invoke/dspfl:getCriteriaConfigurationInstances?xrequestedwith=xmlhttprequest","POST","enovia","application/json",s,function(n){if(g.isParamDefined(n.modelVersion)||(g.showNotifs("error",_.Filter_MVNotFound,_.Filter_RefreshWidget,"",that.NotifsParentContainer),t.options.expression={},n.modelVersion=!1),!g.isDefined(n.member)||!Array.isArray(n.member))return t.alertDiv.add({message:_.Filter_Error_FetchDataUsing_ConfigID,style:{position:"absolute"},className:"error"}),t.alertDiv.show(),t.options.expression={},n.modelVersion=!1,void i();var o=new x({});let{variantsXML:s,variantXMLDesc:a}=o.getXMLExpressionFromPCCriteria(n);s=s.replace(/&(?!amp;)/g,"&amp;");var r=o.getDisplayXMLExpressionFromPCCriteria(n);r=r.replace(/&(?!amp;)/g,"&amp;");var l=C.startFilterXML()+r+C.endFilterXML(),c={displayExpression:decodeURIComponent(g.getDisplayExpressionUsingXSLT(l)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"),xmlExpression:s,basedOnMVID:n.modelVersion,selectedPCPID:e.physical_id,selectedPCDisplayName:n.title,selectedPCRevision:n.revision,selectedPCMode:n.selectionMode};0!=Object.keys(t.options.expression).length&&g.isParamDefined(c)&&(t.options.expression.iVariantsJson=c,t.options.expression.pcCheckFlag=!0,"Refine"===n.selectionMode&&(t.options.expression.refineModecheckbox=!0)),i()},function(e){t.alertDiv.add({message:_.Filter_Error_FetchDataUsing_ConfigID,style:{position:"absolute"},className:"error"}),t.alertDiv.show()},!0,null)})},checkSingleProductID:function(e){return this.promiseSingleMVID=new u(function(t,i){let n=e.xmlExpression||e.xRevXml,o=e.psJson||e.xRevJson;if(n){if(-1!=n.indexOf("<Tree>")||o.length>1)return p.singleProductId="",void t();var s=(new DOMParser).parseFromString(n,"text/xml").getElementsByTagName("Single");if(0!=s.length){if(e.xRevXml)return p.singleProductId=e.singleProductId||"",void t();var a=s[0].attributes.Name.value,r=s[0].attributes.Revision.value,l=(s[0].attributes.DescId.value,{with_indexing_date:!0,with_nls:!1,label:"yus-1515078503005",locale:"en",select_predicate:["ds6w:label","ds6wg:revision","revision","ds6w:type","ds6w:description","ds6w:identifier","ds6w:modified","ds6w:created","ds6w:responsible","ds6w:lastModifiedBy","ds6wg:marketing_Name"],select_file:["icon","thumbnail_2d"],query:"flattenedtaxonomies:(types/Products) AND ("+("(([name]:("+a+")) AND ([ds6wg:revision]:("+r+")))")+")",order_by:"desc",order_field:"relevance",nresults:1e3,start:"0",source:[],tenant:enoviaServerFilterWidget.tenant});l=JSON.stringify(l);g.makeWSCall("/search?xrequestedwith=xmlhttprequest","POST","enovia","application/json",l,function(e){var n="";if(g.isDefined(e.results)&&g.isDefined(e.results[0])&&g.isDefined(e.results[0].attributes)){if(e.results[0].attributes.length>0)for(var o=0;o<e.results[0].attributes.length;o++)"resourceid"==e.results[0].attributes[o].name&&(n=e.results[0].attributes[o].value);p.singleProductId=n,t()}else i("Filter_MVNotFound")},function(){i("Filter_MVSearchFailed")},!0,{isfederated:"true"})}else t()}else t()}),this.promiseSingleMVID},getModelMarketingName:function(e){for(var t=0;t<e.length;t++)if("Marketing Name"==e[t].name)return e[t].value},getModelName:function(e){for(var t=0;t<e.length;t++)if("name"==e[t].name){if(Array.isArray(e[t].value))return e[t].value;var i=[];return i.push(e[t].value),i}},getCRNodeInfo:function(e){var t="",i="",n="";if(null!=e.data[0]&&0!=Object.keys(e.data[0].dataelements).length&&(t=e.data[0].dataelements.revision,n=e.data[0].dataelements.title,i=e.data[0].dataelements.title),""!=t&&""!=i&&""!=n)return{id:this.options.expression.configurationRevision,physicalid:this.options.expression.configurationRevision,type:"ConfiguredBaseline",displayName:n,revision:t,name:i}},publishFilterViewChangeEvent:function(){p.ModelEvents.publish({event:"FilterViewChanged",data:{currentSelectedView:this.currentSelectedView}})},clearCAComponent:function(){g.isDefined(this.changeActionComponent)&&this.changeActionComponent.clearCAComponent(),g.isDefined(this.changeActionCheckbox)&&(this.changeActionCheckbox.checkFlag=!1,this.changeActionComponent.hide())},render:function(){var e=this;g.rolesAvailable(t=>{e.userGrantedRoles=t,p.renderTo=e.options.renderTo,p.renderToApp=e.options.renderToApp,this.container.setHTML(L(this.options));var i={dialogue:{buttonArray:[],showHeader:!1}};i.displayCompactMode=this.options.displayCompactMode,document.querySelector(".operations-main-container")&&document.querySelector(".operations-main-container").destroy(),F.init(p.renderTo,this.container,i,N);var n=document.querySelector("#checkCfgfilterBtn");n.addEventListener("click",function(t){if(null!=e.UnitComponent&&0==e.UnitComponent.validate())return;""==e.VariantsComponent.textBox.getText()&&(e.VariantsComponent.xmlExpression="",e.VariantsComponent.displayExpression="");null!=e.manufacturingplanComponent&&""==e.manufacturingplanComponent.textBox.getText()&&(e.manufacturingplanComponent.xml="",e.manufacturingplanComponent.displayExpression="");e.onApplyFilter(t,e)},!1),"Native"==enoviaServerFilterWidget.mode&&n.hide();let o=this.container.getElement(".filter-dialog-Settings");if(1==this.userGrantedRoles.isCFGRoleAvail&&1==p.configurationCriteria.contextualDate&&!this.isXRev){if(this.configFilterSettings=this.container.getElement(".filter-dialog-SettingsIcon"),this.configFilterSettings.addClassName("fonticon"),this.configFilterSettings.addClassName("fonticon-1.5x"),this.configFilterSettings.addClassName("fonticon-cog"),this.configFilterSettings.tooltipInfos=new l({shortHelp:_.CFG_FilterSettings_Tooltip}),!this.contextDateToggle){let t=!0;0==P.get("configFilterContextualDate")&&(t=!1),0!=Object.keys(e.options.expression).length&&(t=e.options.expression.contextualDate),this.contextDateToggle=new r({type:"switch",touchMode:!this.options.displayCompactMode,id:"cfgContextDateToggle",checkFlag:t,value:"0",label:_.CFG_ContextualDate_Label,tooltipInfos:new l({shortHelp:_.CFG_ContextualDate_Tooltip})}),this.contextDateToggle.inject(o),o.hide(),this.contextDateToggle.addEventListener("click",function(e){P.set({configFilterContextualDate:this.dsModel.checkFlag},!0)})}this.configFilterSettings.set({events:{click:e=>{o.isHidden()?(this.configFilterSettings.addClassName("cfgFilterActiveCog"),o.show()):(this.configFilterSettings.removeClassName("cfgFilterActiveCog"),o.hide())}}})}var s=this.options.iModelsList.length,a=[],u="",C=null,f=null,b=!0,D=!1,k=!1,S=!1,y=-1;if(0!=Object.keys(e.options.expression).length&&(u=e.options.expression.modelId,C=e.options.expression.psJson,f=e.options.expression.mpJson,b=e.options.expression.productstatecheckbox,D=e.options.expression.unitcheckbox,k=e.options.expression.datestatecheckbox,S=e.options.expression.manufacturingplanCheckbox),s>0){for(var E=0;E<s;E++){var A=this.getModelMarketingName(this.options.iModelsList[E].data),R=this.getModelName(this.options.iModelsList[E].basicData);A||(A=R);var M={valueItem:this.options.iModelsList[E].physicalID,labelItem:A,name:R};this.options.iModelsList[E].physicalID==u&&(y=E,M.selected=!0),a.push(M)}if(-1==y&&""!=u)return e.alertDiv.add({message:_.Filter_Error_Models_in_filter,style:{position:"absolute"},className:"error"}),e.alertDiv.elements.container.addClassName("CfgAlertstyle"),e.alertDiv.show(),void e.options.callback([]);-1==y&&""==u&&(y=0);var U={};U.Data=a,U.currentindex=y,U.parentElement=this.container.getElement(".filter-dialog-models"),this.ModelSelectionComponent=new c(U),this.ModelSelectionComponent.render()}if(this.isXRev)return this.buildxRevComponent(),this.buildVariantsComponent({model:a[y]}),this.pubSubEvents(),this.applyCompactComfortableMode(this.options.displayCompactMode),void this.container.getElement(".filter-dialog-Change").hide();var T={elementsList:[{labelItem:O.OFFICIAL_LABEL,valueItem:"Official"},{labelItem:O.PROJECTED_LABEL,valueItem:"Projected"},{labelItem:O.CHANGE_LABEL,valueItem:"Change"}],officialViewHandler:function(){e.officialProjViewHandling()},projectedViewHandler:function(){e.officialProjViewHandling()},changeViewHandler:function(){if(g.isDefined(e.cfgConfigurationRevisionPicker)&&g.isDefined(e.cfgConfigurationRevisionPicker.selectedNode)&&1==e.configurationRevisionCheckbox.checkFlag)return e.viewPanelCombo.set(e.currentSelectedView),void g.showwarning(_.Change_view_not_selectable,"info");e.currentSelectedView=e.viewPanelCombo.get(),e.publishFilterViewChangeEvent(),g.isDefined(e.changeActionCheckbox)&&(e.changeActionCheckbox.checkFlag=!0,e.changeActionCheckbox.visibleFlag=!0),g.isDefined(e.changeActionComponent)&&e.changeActionComponent.show(),g.isDefined(document.getElementsByClassName("filter-dialog-Changelabel")[0])&&document.getElementsByClassName("filter-dialog-Changelabel")[0].setAttribute("style","display:block"),e.container.getElement(".filter-dialog-model-criteria").hide(),e.container.getElement(".filter-dialog-viewpanel2").setContent(e.viewPanelCombo),e.container.getElement(".filter-dialog-viewpanel2").setStyle("display","flex")},displayCompactMode:e.options.displayCompactMode};if(e.isLicenseValid=!0,e.viewPanelCombo=new I(T),e.container.getElement(".filter-dialog-viewpanel").setContent(e.viewPanelCombo.render()),0!=Object.keys(e.options.expression).length&&null!=e.options.expression.viewJson&&null!=e.options.expression.viewJson&&e.viewPanelCombo.set(e.options.expression.viewJson),e.currentSelectedView=e.viewPanelCombo.get(),e.userGrantedRoles.isCSVRoleAvail&&(e.isLicenseValid=!1),null!=C&&(1!=C.length||1==C.length&&g.isDefined(C[0].start)&&1==C[0].start.isRoot)&&(e.singleProductEvolutionStatus=!1),this.ModelSelectionComponent.getcriteriasAvailable(this.ModelSelectionComponent).then(function(t){p.criteriasAvailable=t.criteria[0],console.log(p.criteriasAvailable);var i={};i.parentElement=e.container.getElement(".filter-dialog-productstates"),i.psJson=C,null!=C&&C.length>1&&(e.singleProductEvolutionStatus=!1),i.expression=e.options.expression,i.mode="PRODUCTS",i.use="FILTER",i.displayCompactMode=e.options.displayCompactMode,e.productstateCheckbox=new r({type:"checkbox",value:"PSComponent",className:"primary",label:_.Filter_Product_State}).inject(e.container.getElement(".filter-dialog-productstates-checkbox")),e.productstateCheckbox.addEventListener("buttonclick",function(){!0===e.productstateCheckbox.checkFlag?e.ProductStateComponent.show():(e.ProductStateComponent.hide(),null!=e.VariantsComponent.configuratorButton&&e.VariantsComponent.configuratorButton.addClassName("disableButton")),null!=e.ProductStateComponent.options.psJson&&null!=e.ProductStateComponent.options.psJson&&Array.isArray(e.ProductStateComponent.options.psJson)&&e.ProductStateComponent.options.psJson.length>0&&(e.isRoot=e.ProductStateComponent.options.psJson[0].start.isRoot,e.length=e.ProductStateComponent.options.psJson.length),p.ModelEvents.publish({event:"ProductStatecheckbox",data:{model:e.productstateCheckbox.checkFlag,isRoot:e.isRoot,psJsonLength:e.ProductStateComponent.options.psJson.length}})}),e.ProductStateComponent=new d(i),e.ProductStateComponent.render(),p.productstateCheckbox=e.productstateCheckbox,p.ProductStateComponent=e.ProductStateComponent;var n=p.CurrentFilterModel={model:a[y]};0!=Object.keys(i.expression).length&&i.expression.iVariantsJson.basedOnMVID?(e.ProductStateComponent.setExpression(n),e.ProductStateComponent.setMVAssociatedWithPC(n,i.expression.iVariantsJson.basedOnMVID)):0!=Object.keys(i.expression).length?e.ProductStateComponent.setExpression(n):e.ProductStateComponent.setLastMainEvolution(n),null!=p.criteriasAvailable&&"FALSE"==p.criteriasAvailable.products&&(p.productstateCheckbox.hide(),p.ProductStateComponent.hide(),b=!1),1==b?(e.productstateCheckbox.checkFlag=!0,e.ProductStateComponent.show()):(e.ProductStateComponent.hide(),e.productstateCheckbox.checkFlag=!1,e.singleProductEvolutionStatus=!0,null!=e.VariantsComponent.configuratorButton&&e.VariantsComponent.configuratorButton.addClassName("disableButton")),0!=Object.keys(i.expression).length&&i.expression.iVariantsJson.basedOnMVID&&(e.productstateCheckbox.checkFlag=!0,e.ProductStateComponent.show());var o={};o.parentElement=e.container.getElement(".filter-dialog-manufacturingplans"),o.psJson=f,o.expression=e.options.expression,o.mode="MANUFACTURINGPLAN",o.use="FILTER",o.displayCompactMode=e.options.displayCompactMode,e.manufacturingplanCheckbox=new r({type:"checkbox",value:"PSComponent",className:"primary",label:w.Manufacturing_Plan}).inject(e.container.getElement(".filter-dialog-manufacturingplans-checkbox")),e.manufacturingplanCheckbox.addEventListener("buttonclick",function(){!0===e.manufacturingplanCheckbox.checkFlag?e.manufacturingplanComponent.show():e.manufacturingplanComponent.hide()}),e.manufacturingplanComponent=new d(o),e.manufacturingplanComponent.render(),p.manufacturingplanComponent=e.manufacturingplanComponent,p.manufacturingplanCheckbox=e.manufacturingplanCheckbox;n=p.CurrentFilterModel={model:a[y]};if(e.manufacturingplanComponent.setExpression(n),null!=p.criteriasAvailable&&"False"==p.criteriasAvailable.manufacturingPlans&&(p.manufacturingplanCheckbox.hide(),p.manufacturingplanComponent.hide(),S=!1),1==S?(e.manufacturingplanCheckbox.checkFlag=!0,e.manufacturingplanComponent.show()):(e.manufacturingplanComponent.hide(),e.manufacturingplanCheckbox.checkFlag=!1),1==e.userGrantedRoles.isCFGRoleAvail&&1==p.configurationCriteria.unit){e.UnitCheckbox=new r({type:"checkbox",value:"UnitComponent",className:"primary",label:_.Filter_Unit,events:{onChange:function(){}}}).inject(e.container.getElement(".filter-dialog-unit-checkbox")),e.UnitCheckbox.addEventListener("buttonclick",function(){!0===e.UnitCheckbox.checkFlag?(e.UnitComponent.show(),e.UnitComponent.updateDictionary(p.CurrentFilterModel).then(function(){e.UnitComponent.checkUnitsAllocation()})):(e.UnitComponent.hide(),g.isDefined(e.UnitComponent.atLeastOneUnitAllocated)&&1==e.UnitComponent.atLeastOneUnitAllocated&&e.showOrHideComponentsExceptUnit({unitAllocation:!1}))}),p.ModelEvents.subscribe({event:"showOrHideComponentsExceptUnit"},function(t){!0===e.UnitCheckbox.checkFlag&&(null==P.get("bShowFilterUnitAllocWarning")||1==P.get("bShowFilterUnitAllocWarning")?e.showWarning(t):e.showOrHideComponentsExceptUnit(t))}),p.ModelEvents.subscribe({event:"modelUpdated"},function(t){e.showOrHideComponentsExceptUnit({unitAllocation:!1})});var s=null;0!=Object.keys(e.options.expression).length&&(s=e.options.expression.iUnitJson);var l=e.container.getElement(".filter-dialog-unit");if(e.UnitComponent=new v({displayCompactMode:e.options.displayCompactMode,parentElement:l,mode:"UNIT",invokeFrom:"Filter",filterParent:e.options.renderToApp}),e.UnitComponent.render(),p.UnitComponent=e.UnitComponent,p.UnitCheckbox=e.UnitCheckbox,e.UnitComponent.SetJson(s),null!=p.criteriasAvailable&&"FALSE"==p.criteriasAvailable.builds&&(p.UnitCheckbox.hide(),p.UnitComponent.hide(),D=!1),1==D)e.UnitComponent.show(),e.UnitCheckbox.checkFlag=!0,e.UnitComponent.updateDictionary({model:a[y]}).then(function(){e.UnitComponent.checkUnitsAllocation()});else e.UnitComponent.hide()}null!=e.options.FilterType&&"Volatile"!=e.options.FilterType||g.getAllowedSemantics(e.options.rootId).then(function(t){if(g.isBaselineMode(e.options.rootId,t)&&0==g.isFirstSemantic(e.options.rootId,t)){var i=null;if(Object.keys(e.options.expression).length&&""!=e.options.expression.configurationRevision&&null!=e.options.expression.configurationRevision&&null!=e.options.expression.configurationRevision)g.getObjectInfo(e.options.expression.configurationRevision).then(function(t){i=e.getCRNodeInfo(t),e.updateConfigurationRevision(i)});else e.updateConfigurationRevision(i)}}),e.applyCompactComfortableMode(e.options.displayCompactMode)}),1==this.userGrantedRoles.isCFGRoleAvail&&1==p.configurationCriteria.contextualDate){this.DateCheckbox=new r({type:"checkbox",value:"DateComponent",className:"primary",label:_.Filter_Date,checkFlag:!1}).inject(this.container.getElement(".filter-dialog-date-checkbox"));var V=null;e.DateCheckbox.addEventListener("buttonclick",function(){!0===e.DateCheckbox.checkFlag?e.DatePicker.show():e.DatePicker.hide()}),0!=Object.keys(e.options.expression).length&&(V=e.options.expression.iDateJson);var X=this.container.getElement(".filter-dialog-date");this.DatePicker=new m(X,V,{view:"show",defaultDateBehavior:"SingleDate",displayCompactMode:e.options.displayCompactMode}),this.DatePicker.render(),p.DateCheckbox=this.DateCheckbox,p.DatePicker=this.DatePicker,1==k?(e.DatePicker.show(),this.DateCheckbox.checkFlag=!0):(this.DatePicker.hide(),this.DateCheckbox.checkFlag=!1)}e.PCCheckbox=new r({type:"checkbox",value:"PCComponent",className:"primary",label:_.Filter_ProductConfiguration}).inject(e.container.getElement(".filter-dialog-PC-checkbox"));var B="";0!=Object.keys(e.options.expression).length&&(B=e.options.expression.iVariantsJson);var G=this.singleProductEvolutionStatus;B&&B.selectedOptionsforConfigurator?p.selectedOptionsforConfigurator=B.selectedOptionsforConfigurator:p.selectedOptionsforConfigurator="";let W={};W.status=G,W.variantJSON=B,W.pcParent=this.container.getElement(".filter-dialog-PC"),W.parentElement=this.container.getElement(".filter-dialog-variants"),W.invokeFrom="Filter",W.modelID=this.ModelSelectionComponent.get(),W.filterParent=this.options.renderToApp,W.filterParentContainer=this.options.renderTo,W.userGrantedRoles=this.userGrantedRoles,W.tenant=this.options.tenant,W.displayCompactMode=e.options.displayCompactMode,this.VariantsComponent=new x(W),this.VariantsComponent.render(),this.VariantsComponent.PCChooser.hide(),e.PCCheckbox.addEventListener("change",function(){!0===e.PCCheckbox.checkFlag?e.VariantsComponent.PCChooser.show():e.VariantsComponent.PCChooser.hide()}),e.PCCheckbox.checkFlag=!!e.options.expression.pcCheckFlag&&e.options.expression.pcCheckFlag,this.updateVariantsComponent(),this.filter150Checkbox=new r({type:"checkbox",value:"filter150Component",className:"primary",label:_.filter150,checkFlag:!1,tooltipInfos:new l({shortHelp:_.filter150})}).inject(this.container.getElement(".filter-dialog-150-checkbox")),this.filter150Checkbox.addEventListener("change",t=>{g.isParamDefined(e.VariantsComponent.selectedPCPID)||e.VariantsComponent.clearProductConfLabelInfo(),P.set({bFilterMode150:t.dsModel.checkFlag},!0),1==t.dsModel.checkFlag?g.isParamDefined(e.VariantsComponent.selectedPCPID)&&"Refine"!==e.VariantsComponent.selectedPCMode&&e.VariantsComponent.clearProductConfLabelInfo():g.isParamDefined(e.VariantsComponent.selectedPCPID)&&"Refine"===e.VariantsComponent.selectedPCMode&&e.VariantsComponent.clearProductConfLabelInfo()}),p.filter150Checkbox=this.filter150Checkbox,0==Object.keys(this.options.expression).length?("CfgFilter150"==this.options.filterMode||P.get("bFilterMode150"))&&(p.filter150Checkbox.checkFlag=!0):(P.set({bFilterMode150:this.options.expression.refineModecheckbox},!1),this.options.expression.refineModecheckbox&&(p.filter150Checkbox.checkFlag=!0)),p.ModelEvents.publish({event:"modelUpdated",data:{noEvolutionUpdate:!0,model:a[y]}}),this.changeActionCheckbox=new r({type:"checkbox",value:"ChangeActionComponent",className:"primary",label:_.Filter_ChangeAction,checkFlag:!1}).inject(this.container.getElement(".filter-dialog-changeaction-checkbox"));var j={displayCompactMode:e.options.displayCompactMode,currentSelectedFilterView:e.currentSelectedView};j.parentElement=e.container.getElement(".filter-dialog-changeaction"),e.changeActionComponent=new h(j),e.changeActionComponent.render(),Object.keys(e.options.expression).length>0&&g.isDefined(e.options.expression.caxml)&&e.changeActionComponent.setFilterXML(e.options.expression.caxml),e.changeActionComponent.hide(),g.isDefined(e.options.expression.configurationRevision)&&""!=e.options.expression.configurationRevision&&e.container.getElement(".filter-dialog-Change").hide();Object.keys(e.options.expression).length>0&&g.isDefined(e.options.expression.caNameArray)&&e.options.expression.caNameArray.length>0&&(e.changeActionComponent.initialiseComponent(e.options.expression),e.changeActionCheckbox.checkFlag=!0,e.changeActionComponent.show()),e.changeActionCheckbox.addEventListener("buttonclick",function(){!0===e.changeActionCheckbox.checkFlag?e.changeActionComponent.show():e.changeActionComponent.hide()}),p.ModelEvents.subscribe({event:"CRSelected"},function(t){e.container.getElement(".filter-dialog-Change").hide()}),p.ModelEvents.subscribe({event:"CRDelected"},function(t){e.container.getElement(".filter-dialog-Change").show()}),"Native"==enoviaServerFilterWidget.mode&&e.options.PCID&&(e.PCCheckbox.checkFlag=!!e.options.PCID,e.onPCSearchOKFilter({id:e.options.PCID})),null!=this.options.expression.psJson&&Array.isArray(this.options.expression.psJson)&&this.options.expression.psJson.length>0&&1==this.options.expression.psJson[0].start.isRoot&&document.getElementById("edit").addClassName("disableButton"),g.isParamDefined(e.VariantsComponent)&&g.isParamDefined(e.VariantsComponent.configuratorButton)&&0!=Object.keys(e.options.expression).length&&(e.VariantsComponent.configuratorButton.addClassName("cfgWaitCursor"),e.promiseSingleMVID.then(()=>{e.VariantsComponent.configuratorButton.removeClassName("cfgWaitCursor")},t=>{e.VariantsComponent.configuratorButton.removeClassName("cfgWaitCursor"),e.VariantsComponent.configuratorButton.addClassName("disableButton");let i="";"Filter_MVSearchFailed"==t?i=_.Filter_MVSearchFailed:"Filter_MVNotFound"==t&&(i=_.Filter_MVNotFound),g.showNotifs("error",i,_.Filter_RefreshWidget,"",e.NotifsParentContainer)})),p.ModelEvents.subscribe({event:"NoSingleProductId"},function(t){e.VariantsComponent.configuratorButton.hasClassName("cfgWaitCursor")&&(e.alertDiv.add({message:_.Filter_WaitingToComputeSingleMVID,style:{position:"absolute"},className:"error"}),e.alertDiv.show())})})},updateConfigurationRevision:function(e){var t=this;t.configurationRevisionCheckbox=new r({type:"checkbox",value:"ConfigurationRevision",className:"primary",label:w.ConfigurationRevision}).inject(t.container.getElement(".filter-dialog-ConfiguredRevision-checkbox"));var i={parentElement:t.container.getElement(".filter-dialog-ConfiguredRevision"),iSelectedId:e,iRootId:t.options.rootId,displayCompactMode:t.options.displayCompactMode};t.cfgConfigurationRevisionPicker=new b(i),t.cfgConfigurationRevisionPicker.render(),Object.keys(t.options.expression).length&&null!=t.options.expression.configurationRevision?t.configurationRevisionCheckbox.checkFlag=!0:(t.configurationRevisionCheckbox.checkFlag=!1,t.cfgConfigurationRevisionPicker.hide()),0==Object.keys(t.options.expression).length&&(t.configurationRevisionCheckbox.checkFlag=!0,t.cfgConfigurationRevisionPicker.show()),t.configurationRevisionCheckbox.addEventListener("buttonclick",function(){!0===t.configurationRevisionCheckbox.checkFlag?(t.cfgConfigurationRevisionPicker.show(),g.isDefined(t.cfgConfigurationRevisionPicker.selectedNode)&&t.container.getElement(".filter-dialog-Change").hide()):(t.cfgConfigurationRevisionPicker.hide(),t.container.getElement(".filter-dialog-Change").show())})},validateCFFilter:function(){return null==this.UnitComponent||0!=this.UnitComponent.validate()},updateVariantsComponent:function(){this.VariantsComponent.enableDisableEditVariantfromProductEvolution()},buildFilterXML:function(){let e=!1;this.contextDateToggle&&this.contextDateToggle.checkFlag&&(e=!0);let t=this.ModelSelectionComponent?this.ModelSelectionComponent.getSelectedModelName():"",i=this.ModelSelectionComponent?this.ModelSelectionComponent.getSelectedModelLabel():"";var n=null==this.ProductStateComponent?null:this.ProductStateComponent.buildFilterXML();null==this.productstateCheckbox||0!=this.productstateCheckbox.checkFlag&&0!=this.productstateCheckbox.visibleFlag||(n="");var o=null==this.manufacturingplanComponent?null:this.manufacturingplanComponent.buildFilterXML();null==this.manufacturingplanCheckbox||0!=this.manufacturingplanCheckbox.checkFlag&&0!=this.manufacturingplanCheckbox.visibleFlag||(o="");var s=null==this.UnitComponent?null:this.UnitComponent.buildUnitXML(t[0]);null==this.UnitCheckbox||0!=this.UnitCheckbox.checkFlag&&0!=this.UnitCheckbox.visibleFlag||(s="");var a=this.VariantsComponent.getXml();a=C.getValidXmlWithoutDisplayName(a),0==this.VariantsComponent.visibleFlag&&(a="");var r="",l="";l=1==this.filter150Checkbox.checkFlag?"150%":"Strict",g.isDefined(this.viewPanelCombo)&&"Official"===(r=this.viewPanelCombo.get().view)&&(r="Current");var c=null==this.DatePicker?null:this.DatePicker.getXML();if(null!=c&&(null==this.DateCheckbox||0!=this.DateCheckbox.checkFlag&&0!=this.DateCheckbox.visibleFlag)||(c=""),n&&-1==n.search("TreeSeries"))var d=C.buildTreeSeries("ProductState",t[0],n);else d=n;if(o&&-1==o.search("TreeSeries"))var h=C.buildTreeSeries("ManufPlan",t[0],o);else h=o;var p="";g.isDefined(this.changeActionComponent)&&g.isDefined(this.changeActionCheckbox)&&!0===this.changeActionCheckbox.checkFlag&&0!=this.changeActionCheckbox.visibleFlag&&(p=this.changeActionComponent.getFilterXML()),""!=n&&null!=n||(d=""),""!=o&&null!=o||(h=""),""!=c&&null!=c||(c=""),""!=s&&null!=s||(s=""),""!=a&&null!=a||(a=""),""!=p&&null!=p||(p="");let u="";this.isXRev&&((u=this.xRevComp?this.xRevComp.buildFilterXML():"")&&(u=C.buildXRevision(u)),a||(t="",i=""),!this.xRevCheckBox||0!=this.xRevCheckBox.checkFlag&&0!=this.xRevCheckBox.visibleFlag||(u=""));var f=""==d&&""==h&&""==c&&""==s&&""==a&&""==p&&""==u,m=!1,v="";null!=this.cfgConfigurationRevisionPicker&&null!=this.cfgConfigurationRevisionPicker.selectedNode&&1==this.configurationRevisionCheckbox.checkFlag&&(v=this.cfgConfigurationRevisionPicker.selectedNode.id,p="",m=!0),"Source"!==r||m||(d="",h="",c="",s="",a=""),this.crFilter=!1,"Native"==enoviaServerFilterWidget.mode&&""==d&&""==h&&""==c&&""==s&&""==a&&""==p&&1==m&&(this.crFilter=!0);let x=Array.isArray(i)&&i[0]?i[0]:t[0],b={desc:"",name:t[0],label:x};if(this.finalXML=C.startFilterXML(r,l,v,f,b,e,u)+d+h+c+s+a+p,f||(b.name&&(this.finalXML+="</Context>"),this.finalXML+="</FilterSelection>"),""!=d||""!=h||""!=a||""!=b.desc||""!=p){var F=this;this.finalXML+="<Description>",""!=d&&(Array.isArray(this.ProductStateComponent.xmlDesc)?this.ProductStateComponent.xmlDesc.forEach(function(e){F.finalXML+=e}):this.finalXML+=this.ProductStateComponent.xmlDesc),""!=h&&(Array.isArray(this.manufacturingplanComponent.xmlDesc)?this.manufacturingplanComponent.xmlDesc.forEach(function(e){F.finalXML+=e}):this.finalXML+=this.manufacturingplanComponent.xmlDesc),""!=a&&this.VariantsComponent.xmlDesc&&(Array.isArray(this.VariantsComponent.xmlDesc)?this.VariantsComponent.xmlDesc.forEach(function(e){F.finalXML+=e}):this.finalXML+=this.VariantsComponent.xmlDesc),""!=p&&this.changeActionComponent.xmlDesc&&(Array.isArray(this.changeActionComponent.xmlDesc)?this.changeActionComponent.xmlDesc.forEach(function(e){F.finalXML+=e}):this.finalXML+=this.changeActionComponent.xmlDesc),b.desc&&(this.finalXML+=b.desc),this.finalXML=this.finalXML+"</Description>"}return this.finalXML=this.finalXML+"</CfgFilterExpression>",this.finalXML=this.finalXML.replace(/&(?!amp;)/g,"&amp;"),console.log(this.finalXML),this.finalXML},officialProjViewHandling:function(){"Source"==this.currentSelectedView.view&&this.clearCAComponent(),g.isDefined(this.UnitCheckbox)&&1==this.UnitCheckbox.checkFlag&&g.isDefined(this.UnitComponent.atLeastOneUnitAllocated)&&1==this.UnitComponent.atLeastOneUnitAllocated&&this.showOrHideComponentsExceptUnit({unitAllocation:!0}),this.currentSelectedView=this.viewPanelCombo.get(),this.publishFilterViewChangeEvent(),this.container.getElement(".filter-dialog-model-criteria").show(),this.container.getElement(".filter-dialog-model-criteria").setStyle("display","flex"),this.container.getElement(".filter-dialog-viewpanel2").setStyle("display","none"),this.container.getElement(".filter-dialog-viewpanel").setContent(this.viewPanelCombo)},applyCompactComfortableMode:function(e){!0===e?this.container.getElements("*").forEach(function(e){e.removeAttribute("touch-mode")}):this.container.getElements("*").forEach(function(e){e.setAttributeNode(document.createAttribute("touch-mode"))}),null!=this.UnitComponent&&(this.UnitComponent.options.displayCompactMode=e),null!=this.manufacturingplanComponent&&(this.manufacturingplanComponent.options.displayCompactMode=e),null!=this.ProductStateComponent&&(this.ProductStateComponent.options.displayCompactMode=e),null!=this.DatePicker&&(this.DatePicker.options.displayCompactMode=e),null!=this.cfgConfigurationRevisionPicker&&(this.cfgConfigurationRevisionPicker.options.displayCompactMode=e)},onApplyFilter:function(e){var t=this,i="";if(g.isDefined(this.viewPanelCombo)&&"Official"===(i=this.viewPanelCombo.get().view)&&(i="Current"),(0==t.filter150Checkbox.checkFlag||1==t.filter150Checkbox.checkFlag&&"Refine"===t.VariantsComponent.selectedPCMode)&&p.singleProductId&&(t.productstateCheckbox&&1==t.productstateCheckbox.checkFlag||t.xRevCheckBox&&1==t.xRevCheckBox.checkFlag)&&(null==t.manufacturingplanCheckbox||0==t.manufacturingplanCheckbox.checkFlag)&&(null==t.UnitComponent||0==t.UnitCheckbox.checkFlag)&&(null==t.DateCheckbox||0==t.DateCheckbox.checkFlag)&&t.PCCheckbox&&t.PCCheckbox.checkFlag&&""!=t.VariantsComponent.selectedPCPID&&"Projected"!=i&&(null==t.configurationRevisionCheckbox||0==t.configurationRevisionCheckbox.checkFlag)){var n=decodeURIComponent(g.getDisplayExpressionUsingXSLT(t.buildFilterXML())),o=t.options.rootId;let e=t.VariantsComponent.selectedPCDisplayName||"",a=t.VariantsComponent.selectedPCRevision||"",r="";r=a?`${e}-${a}`:e;var s={};return s[o]={displayExpression:r||n,config_filter_id:{physical_id:t.VariantsComponent.selectedPCPID},expression:{modelId:t.ModelSelectionComponent?t.ModelSelectionComponent.get():"",view:i}},t.isXRev&&(s[o].expression.xRevXml=t.xRevComp?t.xRevComp.buildFilterXML():"",s[o].expression.xRevJson=t.xRevComp?t.xRevComp.buildFilterJson():[]),t.options.callback([s]),document.querySelector(".operations-main-container").destroy(),t.sendConfigurationFilterTrackerEvent(),p.singleProductId="",null}return new u(function(e,n){var o=t.buildFilterXML();let s="";var a={version:"1.2",output:{targetFormat:"TXT"},expression:{version:"0.1",format:"xml",content:C.removeDescFromXML(o)},dictionary:{version:"0.1",id:{pid:s=t.isXRev?t.options.xRevisionContent[0].xRevisionGraph.physicalid:t.ModelSelectionComponent.get()}}};a=JSON.stringify(a);g.makeWSCall("/resources/modeler/configuration/filteringServices/createVolatileFilter","POST","enovia","application/json",a,function(n){var s=t.options.rootId,a=decodeURIComponent(g.getDisplayExpressionUsingXSLT(o)),r=null==t.configurationRevisionCheckbox?null:t.configurationRevisionCheckbox.checkFlag,l=null==t.cfgConfigurationRevisionPicker||null==t.cfgConfigurationRevisionPicker.selectedNode?null:{id:t.cfgConfigurationRevisionPicker.selectedNode.id};t.configurationRevisionCheckbox&&0==r&&(l=null),t.configurationRevisionCheckbox&&1==r&&null!=l&&(a=t.cfgConfigurationRevisionPicker.selectedNode.displayName+"-"+t.cfgConfigurationRevisionPicker.selectedNode.revision+" "+a);var c={};c[s]={displayExpression:a,compiledBinary:n.filterBinaryForExpand,expression:{configurationRevision:l,modelId:t.ModelSelectionComponent?t.ModelSelectionComponent.get():"",filterXML:o,view:i,variants:{variant:t.VariantsComponent.getSelectedVariant(),displayExpression:t.VariantsComponent.getJson(),selectedOptionsforConfigurator:p.selectedOptionsforConfigurator,configuratorOptions:t.VariantsComponent.getConfiguratorOptions()}}},t.isXRev&&(c[s].expression.singleProductId=p.singleProductId),t.options.callback([c]),null!=document.querySelector(".operations-main-container")&&document.querySelector(".operations-main-container").destroy(),e(!0),t.sendConfigurationFilterTrackerEvent(o),p.singleProductId=""},function(){t.alertDiv.add({message:_.Filter_Error_CompiledBinary,style:{position:"absolute"},className:"error"}),t.alertDiv.show(),e(!0)},!0)})},getDisplayXMLExpressionForVariants:function(e,t){var i={},n="";if(e.seletedoptionsexist=!1,null!=e.results[0]&&e.results[0].attributes.length>0){for(var o=0;o<e.results[0].attributes.length;o++)if("CONFIGURATION_FEATURE"==e.results[0].attributes[o].name){var s=e.results[0].attributes[o].value.split(":");if(null==i[s[0]]){if(s[0]===t.model.name[0])continue;i[s[0]]=[s[1]],(a=[]).push(s[1]),i[s[0]]=a,e.seletedoptionsexist=!0}else{var a;(a=i[s[0]]).push(s[1]),i[s[0]]=a}}Object.keys(i).forEach(function(e,t){for(var o="",s=0;s<i[e].length;s++){var a=encodeURIComponent(i[e][s]);o+=C.buildOption(a)}if(0!=i[e].length.length){var r=encodeURIComponent(e);n+=C.buildFeature(r,o)}})}return n},applyFilterFromFiringProcess:function(e){var t=this,i=!1;if(t.options.configData.PCID&&(i=!0),!i){var n=t.options.configData.filterXML;if(!g.isParamDefined(n))return;var o=C.removeDescFromXML(t.options.configData.filterXML);if(null==o||""==o)return}return new u(async function(e,s){var a="";a=i?"/search?xrequestedwith=xmlhttprequest":"/resources/modeler/configuration/filteringServices/createVolatileFilter";var r=t.options.configData.context.model.valueItem,l="",c={};i?(l={with_indexing_date:!0,with_nls:!1,label:"yus-1515078503005",locale:"en",select_predicate:["ds6w:label","ds6w:type","ds6wg:marketing_Name"],select_file:["icon","thumbnail_2d"],query:"flattenedtaxonomies:(types/Product Configuration) AND ( physicalid:("+t.options.configData.PCID+") ) ",order_by:"desc",order_field:"relevance",nresults:1e3,start:"0",source:[],tenant:t.options.tenant},c={isfederated:"true"}):l={version:"1.2",output:{targetFormat:"TXT"},expression:{version:"0.1",format:"xml",content:o},dictionary:{version:"0.1",id:{pid:r}}};l=JSON.stringify(l);try{await g.populate3DSpaceURL(),g.isParamDefined(enoviaServerFilterWidget.mySecurityContext)||await g.populateSecurityContext(),await g.populateDisplayExpressionXSLT(),await g.makeWSCall(a,"POST","enovia","application/json",l,function(o){let s="",a=t.options.rootId,r={};if(i)s=new x({}).getAttrValue(o,"ds6w:label"),r[a]={displayExpression:s,config_filter_id:{physical_id:t.options.configData.PCID},expression:{modelId:t.options.configData.context.model.valueItem}},t.options.callback([r]),e(!0),t.sendConfigurationFilterTrackerEvent(n),p.singleProductId="";else{let i="";i=o.filterBinaryForExpand,s=g.getDisplayExpressionUsingXSLT(n),r[a]={filterName:"Configuration Filter ",displayExpression:s,compiledBinary:i,expression:{modelId:t.options.configData.context.model.valueItem,filterXML:n,variants:{}}},t.options.callback([r]),e(!0),t.sendConfigurationFilterTrackerEvent(n),p.singleProductId=""}},function(){t.alertDiv.add({message:_.Filter_Error_CompiledBinary,style:{position:"absolute"},className:"error"}),t.alertDiv.show(),e(!0)},!0,c)}catch(e){console.log(e),s(e)}})},getDataForWIWFilter:function(){var e="",t="";g.isDefined(this.viewPanelCombo)&&"Official"===(t=this.viewPanelCombo.get().view)&&(t="Current"),(0==this.filter150Checkbox.checkFlag||1==this.filter150Checkbox.checkFlag&&"Refine"===this.VariantsComponent.selectedPCMode)&&(!p.singleProductId||null==this.productstateCheckbox||1!=this.productstateCheckbox.checkFlag||null!=this.manufacturingplanCheckbox&&0!=this.manufacturingplanCheckbox.checkFlag||null!=this.UnitComponent&&0!=this.UnitCheckbox.checkFlag||null!=this.DateCheckbox&&0!=this.DateCheckbox.checkFlag||!this.PCCheckbox||!this.PCCheckbox.checkFlag||""==this.VariantsComponent.selectedPCPID||"Projected"==t||null!=this.configurationRevisionCheckbox&&0!=this.configurationRevisionCheckbox.checkFlag||(e=this.VariantsComponent.selectedPCPID));var i="";null==this.configurationRevisionCheckbox||1!=this.configurationRevisionCheckbox.checkFlag||null==this.cfgConfigurationRevisionPicker.selectedNode&&null==this.cfgConfigurationRevisionPicker.selectedNode||(this.cfgConfigurationRevisionPicker.selectedNode.id,i=w.ConfigurationRevision+" "+this.cfgConfigurationRevisionPicker.selectedNode.displayName+"-"+this.cfgConfigurationRevisionPicker.selectedNode.revision+"\n");var n=this.buildFilterXML(),o=decodeURIComponent(g.getDisplayExpressionUsingXSLT(n)),s={variants:{variant:this.VariantsComponent.getSelectedVariant(),displayExpression:this.VariantsComponent.getJson(),selectedOptionsforConfigurator:p.selectedOptionsforConfigurator,configuratorOptions:this.VariantsComponent.getConfiguratorOptions()},PC:{PCID:e},Tooltip:i+o};1==this.cfgUXEnvVariables.filterXMLWithoutDescriptionInSetInfo&&(s.filterXMLWithoutDesc=C.removeDescFromXML(n));var a=this.ModelSelectionComponent?this.ModelSelectionComponent.get():"";if(1==this.crFilter){var r={crFilter:"true",crID:this.cfgConfigurationRevisionPicker.selectedNode.id};a=""}var l={filterName:"",filterDescription:"",filterXML:n,filterXMLWithoutDesc:C.removeDescFromXML(n),modelId:a,view:t,filterUXData:s,crData:r};return this.isXRev&&(l.xRevData={xRevFilter:"true",xRevisionGraphId:this.options.xRevisionContent[0].xRevisionGraph.physicalid},l.filterUXData.singleProductId=p.singleProductId),l},onPCSearchOKFilter:function(e){return this.VariantsComponent.selectedPCPID=e.id,this.VariantsComponent.PCChooser.model.set("ID",e.id),this.VariantsComponent.processProductConfiguration({})},onCASearchOKFilter:function(e){this.changeActionComponent.initialiseComponent(e)},showOrHideComponentsExceptUnit:function(e){1==e.unitAllocation?(this.productstateCheckbox&&this.productstateCheckbox.hide(),this.manufacturingplanCheckbox&&this.manufacturingplanCheckbox.hide(),this.DateCheckbox&&this.DateCheckbox.hide(),this.changeActionCheckbox&&this.changeActionCheckbox.hide(),this.PCCheckbox&&this.PCCheckbox.hide(),this.ProductStateComponent&&this.ProductStateComponent.hide(),this.manufacturingplanComponent&&this.manufacturingplanComponent.hide(),this.DatePicker&&this.DatePicker.hide(),this.changeActionComponent&&this.changeActionComponent.hide(),this.VariantsComponent&&(this.VariantsComponent.hide(),this.VariantsComponent.PCChooser&&this.VariantsComponent.PCChooser.hide()),g.isDefined(document.getElementsByClassName("filter-dialog-Changelabel")[0])&&document.getElementsByClassName("filter-dialog-Changelabel")[0].setAttribute("style","display:none")):(this.productstateCheckbox&&(this.productstateCheckbox.show(),this.ProductStateComponent&&1==this.productstateCheckbox.checkFlag&&this.ProductStateComponent.show()),this.manufacturingplanCheckbox&&(this.manufacturingplanCheckbox.show(),this.manufacturingplanComponent&&1==this.manufacturingplanCheckbox.checkFlag&&this.manufacturingplanComponent.show()),this.DateCheckbox&&(this.DateCheckbox.show(),this.DatePicker&&1==this.DateCheckbox.checkFlag&&this.DatePicker.show()),this.changeActionCheckbox&&(this.changeActionCheckbox.show(),this.changeActionComponent&&1==this.changeActionCheckbox.checkFlag&&this.changeActionComponent.show()),this.PCCheckbox&&this.PCCheckbox.show(),this.VariantsComponent&&(this.VariantsComponent.show(),this.VariantsComponent.PCChooser&&1==this.PCCheckbox.checkFlag&&this.VariantsComponent.PCChooser.show()),g.isDefined(document.getElementsByClassName("filter-dialog-Changelabel")[0])&&document.getElementsByClassName("filter-dialog-Changelabel")[0].setAttribute("style","display:block"))},showWarning:function(e){var t=this,i=function(){t.UnitCheckbox.checkFlag=!1,t.UnitComponent.hide(),t.showOrHideComponentsExceptUnit({unitAllocation:!1}),o.closeDialog()},n={width:539,height:210,isResizable:!1,dialogue:{header:_.warning,buttonArray:[{label:_.Filter_Apply,labelValue:"OK",handler:function(){t.showOrHideComponentsExceptUnit(e),o.closeDialog()},className:"primary"},{label:_.Filter_Cancel,labelValue:"Cancel",handler:i,className:"default"}],target:document.getElementById("cfgslideInBody"),object:null,postCrossHandler:i}},o=new y(n);o.render(),o.container.setStyle("overflow","auto"),o.container.setHTML(_.Cfg_Unit_allocation_warning+"<br><br>"+_.Want_To_Continue+"<br>");var s=new r({label:_.Do_not_show_again});s.addEventListener("change",function(e){1==e.dsModel.checkFlag?P.set({bShowFilterUnitAllocWarning:!1},!0):P.set({bShowFilterUnitAllocWarning:!0},!0)}),s.inject(o.container)},sendConfigurationFilterTrackerEvent:function(e){var t="";t=g.isDefined(enoviaServerFilterWidget)&&"Native"==enoviaServerFilterWidget.mode?"Web In Win":"Dashboard";var i=E.getDeviceUsedForOperation(),n="";n=0!=Object.keys(this.options.expression).length?E.ConfigOperationMode.EDIT:E.ConfigOperationMode.CREATE;var o="Official";let s="";g.isDefined(this.viewPanelCombo)&&(o=this.viewPanelCombo.get().view,s=this.viewPanelCombo.get().view);var a=E.Availability.FALSE;(0==this.filter150Checkbox.checkFlag||1==this.filter150Checkbox.checkFlag&&"Refine"===this.VariantsComponent.selectedPCMode)&&(""==p.singleProductId||null==this.productstateCheckbox||1!=this.productstateCheckbox.checkFlag||null!=this.manufacturingplanCheckbox&&0!=this.manufacturingplanCheckbox.checkFlag||null!=this.UnitComponent&&0!=this.UnitCheckbox.checkFlag||null!=this.DateCheckbox&&0!=this.DateCheckbox.checkFlag||!this.PCCheckbox||!this.PCCheckbox.checkFlag||""==this.VariantsComponent.selectedPCPID||"Projected"==s||null!=this.configurationRevisionCheckbox&&0!=this.configurationRevisionCheckbox.checkFlag||(a=E.Availability.TRUE));var r=E.Availability.FALSE,l=E.ConfigCriteriaSelected.NONE,c=E.ConfigCriteriaSelected.NONE,d=E.ConfigCriteriaSelected.NONE,h=E.ConfigCriteriaSelected.NONE,u=E.Availability.FALSE,f=E.ConfigCriteriaSelected.NONE,m=E.Availability.FALSE,v=E.Availability.FALSE,x=E.Availability.FALSE,b=1,F=0,D=0,k=0,I=0,S=0,y=0,P=0,M=0,N=0;if(g.isDefined(e)){let t=C.FilterXMLtoJSONConvertor(e)[0].expression;t.filterXML=e,C.RetrieveVariantXMLFromFilterXML(t),g.isDefined(t.refineModecheckbox)&&(r=t.refineModecheckbox?E.Availability.TRUE:E.Availability.FALSE);var _=!1,w=!1;if(t.psJson.length>0&&(t.psJson.forEach(e=>{1==e.start.isRoot?(w=!0,F++):0==e.start.isRoot&&(_=!0,D++)}),_&&w?l=E.ConfigCriteriaSelected.BOTH:_&&!w?l=E.ConfigCriteriaSelected.SINGLE:!_&&w&&(l=E.ConfigCriteriaSelected.RANGE)),_=!1,w=!1,t.mpJson.length>0&&(t.mpJson.forEach(e=>{1==e.start.isRoot?(w=!0,k++):0==e.start.isRoot&&(_=!0,I++)}),_&&w?c=E.ConfigCriteriaSelected.BOTH:_&&!w?c=E.ConfigCriteriaSelected.SINGLE:!_&&w&&(c=E.ConfigCriteriaSelected.RANGE)),_=!1,w=!1,g.isDefined(t.iUnitJson)){let e=JSON.parse(t.iUnitJson);e.builds.length>0&&(e.builds.forEach(e=>{g.isDefined(e.end)?(w=!0,S++):(_=!0,y++)}),_&&w?d=E.ConfigCriteriaSelected.BOTH:_&&!w?d=E.ConfigCriteriaSelected.SINGLE:!_&&w&&(d=E.ConfigCriteriaSelected.RANGE))}_=!1,w=!1,t.iDateJson.DateRanges.length>0&&(t.iDateJson.DateRanges.forEach(e=>{e.Start==e.End?(_=!0,M++):(w=!0,P++)}),_&&w?h=E.ConfigCriteriaSelected.BOTH:_&&!w?h=E.ConfigCriteriaSelected.SINGLE:!_&&w&&(h=E.ConfigCriteriaSelected.RANGE)),"FALSE"===a&&g.isDefined(t.variants)&&g.isParamDefined(t.variants.xmlExpression)&&(u=E.Availability.TRUE),g.isDefined(t.caNameArray)&&(1==t.caNameArray.length?(f=E.ConfigCriteriaSelected.SINGLE,N=1):t.caNameArray.length>1&&(f=E.ConfigCriteriaSelected.MULTIPLE,N=t.caNameArray.length)),g.isParamDefined(t.configurationRevision)&&(m=E.Availability.TRUE)}if(g.isDefined(this.UnitCheckbox)&&1==this.UnitCheckbox.checkFlag&&g.isDefined(this.UnitComponent)&&1==this.UnitComponent.atLeastOneUnitAllocated&&(v=E.Availability.TRUE),g.isDefined(this.options.configData))x=E.Availability.TRUE;g.isDefined(this.ModelSelectionComponent)&&(b=null==this.ModelSelectionComponent.combobox?1:this.ModelSelectionComponent.combobox.getModel()._allDescendants.length),E.createEventBuilder({category:E.Category.USAGE,action:E.Events.CLICK,tenant:enoviaServerFilterWidget.tenant}).setLabel(E.Labels.CONFIGURATION_FILTER).addDimension(A.CONFIGURATION_FILTER.CONFIGURATION_FILTER_WIDGET,t).addDimension(A.CONFIGURATION_FILTER.CONFIGURATION_FILTER_MEDIA,i).addDimension(A.CONFIGURATION_FILTER.CONFIGURATION_FILTER_MODE,n).addDimension(A.CONFIGURATION_FILTER.CONFIGURATION_FILTER_VIEW,o).addDimension(A.CONFIGURATION_FILTER.CONFIGURATION_FILTER_PRODUCTCONFIGURATION,a).addDimension(A.CONFIGURATION_FILTER.CONFIGURATION_FILTER_150MODE,r).addDimension(A.CONFIGURATION_FILTER.CONFIGURATION_FILTER_MODELVERSION,l).addDimension(A.CONFIGURATION_FILTER.CONFIGURATION_FILTER_MANUFACTURINGPLAN,c).addDimension(A.CONFIGURATION_FILTER.CONFIGURATION_FILTER_UNIT,d).addDimension(A.CONFIGURATION_FILTER.CONFIGURATION_FILTER_DATE,h).addDimension(A.CONFIGURATION_FILTER.CONFIGURATION_FILTER_VARIANTS,u).addDimension(A.CONFIGURATION_FILTER.CONFIGURATION_FILTER_CHANGE,f).addDimension(A.CONFIGURATION_FILTER.CONFIGURATION_FILTER_CONFIGURATIONREVISION,m).addDimension(A.CONFIGURATION_FILTER.CONFIGURATION_FILTER_UNITFIRING,v).addDimension(A.CONFIGURATION_FILTER.CONFIGURATION_FILTER_FIRINGPROCESS,x).addPersonalValue(R.CONFIGURATION_FILTER.CONFIGURATION_FILTER_NO_OF_MODEL,b).addPersonalValue(R.CONFIGURATION_FILTER.CONFIGURATION_FILTER_TOTAL_NO_OF_PRODUCT_RANGE,F).addPersonalValue(R.CONFIGURATION_FILTER.CONFIGURATION_FILTER_TOTAL_NO_OF_PRODUCT_SINGLE,D).addPersonalValue(R.CONFIGURATION_FILTER.CONFIGURATION_FILTER_TOTAL_NO_OF_MANUFACTURING_PLAN_RANGE,k).addPersonalValue(R.CONFIGURATION_FILTER.CONFIGURATION_FILTER_TOTAL_NO_OF_MANUFACTURING_PLAN_SINGLE,I).addPersonalValue(R.CONFIGURATION_FILTER.CONFIGURATION_FILTER_TOTAL_NO_OF_UNIT_RANGE,S).addPersonalValue(R.CONFIGURATION_FILTER.CONFIGURATION_FILTER_TOTAL_NO_OF_UNIT_SINGLE,y).addPersonalValue(R.CONFIGURATION_FILTER.CONFIGURATION_FILTER_TOTAL_NO_OF_DATE_RANGE,P).addPersonalValue(R.CONFIGURATION_FILTER.CONFIGURATION_FILTER_TOTAL_NO_OF_DATE_SINGLE,M).addPersonalValue(R.CONFIGURATION_FILTER.CONFIGURATION_FILTER_TOTAL_NO_OF_CHANGEACTIONS,N).send()},buildxRevComponent:function(){const e={};let t,i;e.parentElement=this.container.getElement(".filter-dialog-productstates"),0!=Object.keys(this.options.expression).length&&(i=!!((t=this.options.expression.xRevJson)&&t.length>0)),e.psJson=t,e.xRevisionContent={referencePID:this.options.xRevisionContent[0]?this.options.xRevisionContent[0].referencePID:""},e.expression=this.options.expression,e.mode="XREVISION",e.use="FILTER",e.onButtonClickCB=(e=>this.callBackFromXRevLayout(e)),e.xRevScopeDefined=this.options.xRevScopeDefined,e.displayCompactMode=this.options.displayCompactMode,this.xRevCheckBox=new r({type:"checkbox",value:"xRevComponent",className:"primary",label:_.Filter_xRevision}).inject(this.container.getElement(".filter-dialog-productstates-checkbox")),this.xRevCheckBox.addEventListener("buttonclick",()=>{let e,t;!0===this.xRevCheckBox.checkFlag?this.xRevComp.show():(this.xRevComp.hide(),this.VariantsComponent.configuratorButton&&this.VariantsComponent.configuratorButton.addClassName("disableButton")),this.xRevComp.options.psJson&&Array.isArray(this.xRevComp.options.psJson)&&this.xRevComp.options.psJson.length>0&&(e=this.xRevComp.options.psJson[0].start.isRoot,t=this.xRevComp.options.psJson.length),p.ModelEvents.publish({event:"ProductStatecheckbox",data:{model:this.xRevCheckBox.checkFlag,isRoot:e,psJsonLength:t}})}),this.xRevComp=new d(e),this.xRevComp.render(),p.xRevCheckBox=this.xRevCheckBox,p.xRevComp=this.xRevComp,0!=Object.keys(e.expression).length?(this.xRevComp.setExpression(),e.expression.iVariantsJson.basedOnMVID&&(p.singleProductId=e.expression.iVariantsJson.basedOnMVID,this.xRevCheckBox.checkFlag=!0,this.xRevComp.show())):i=!0,(!p.singleProductId||!t||t&&1!=t.length||this.options.expression.xRevXml&&-1!=this.options.expression.xRevXml.indexOf("<Tree>"))&&(this.singleProductEvolutionStatus=!1),1==i?(this.xRevCheckBox.checkFlag=!0,this.xRevComp.show()):(this.xRevCheckBox.checkFlag=!1,this.xRevComp.hide())},callBackFromXRevLayout:function(e){e.mode&&p.ModelEvents.publish({event:"ProductStateDialogClosed",data:{xml:e.ExpAndJson.xml,json:e.ExpAndJson.json,xmlDesc:e.ExpAndJson.description,mode:e.mode}}),"Native"==enoviaServerFilterWidget.mode?p.ModelEvents.publish({event:"showWIWFilterContainer"}):require(["DS/CfgFilterUX/CfgFilterFactory"],function(e){e.showFilter()}),p.singleProductId?this.showVariants():this.hideVariants()},buildVariantsComponent:function(e){this.PCCheckbox=new r({type:"checkbox",value:"PCComponent",className:"primary",label:_.Filter_ProductConfiguration}).inject(this.container.getElement(".filter-dialog-PC-checkbox"));let t="";0!=Object.keys(this.options.expression).length&&(t=this.options.expression.iVariantsJson),t&&t.selectedOptionsforConfigurator?p.selectedOptionsforConfigurator=t.selectedOptionsforConfigurator:p.selectedOptionsforConfigurator="";const i={};i.status=this.singleProductEvolutionStatus,i.variantJSON=t,i.pcParent=this.container.getElement(".filter-dialog-PC"),i.parentElement=this.container.getElement(".filter-dialog-variants"),i.invokeFrom="Filter",i.mode="XREVISION",i.filterParent=this.options.renderToApp,i.filterParentContainer=this.options.renderTo,i.userGrantedRoles=this.userGrantedRoles,i.tenant=this.options.tenant,i.displayCompactMode=this.options.displayCompactMode,this.VariantsComponent=new x(i),this.VariantsComponent.render(),this.VariantsComponent.PCChooser.hide(),this.PCCheckbox.addEventListener("change",()=>{!0===this.PCCheckbox.checkFlag?this.VariantsComponent.PCChooser.show():this.VariantsComponent.PCChooser.hide()}),this.PCCheckbox.checkFlag=!!this.options.expression.pcCheckFlag&&this.options.expression.pcCheckFlag,this.updateVariantsComponent(),this.filter150Checkbox=new r({type:"checkbox",value:"filter150Component",className:"primary",label:_.filter150,checkFlag:!1,tooltipInfos:new l({shortHelp:_.filter150})}).inject(this.container.getElement(".filter-dialog-150-checkbox")),this.filter150Checkbox.addEventListener("change",e=>{this.VariantsComponent.selectedPCPID||this.VariantsComponent.clearProductConfLabelInfo(),P.set({bFilterMode150:e.dsModel.checkFlag},!1),1==e.dsModel.checkFlag?this.VariantsComponent.selectedPCPID&&"Refine"!==this.VariantsComponent.selectedPCMode&&this.VariantsComponent.clearProductConfLabelInfo():this.VariantsComponent.selectedPCPID&&"Refine"===this.VariantsComponent.selectedPCMode&&this.VariantsComponent.clearProductConfLabelInfo()}),p.filter150Checkbox=this.filter150Checkbox,0==Object.keys(this.options.expression).length?("CfgFilter150"==this.options.filterMode||P.get("bFilterMode150"))&&(p.filter150Checkbox.checkFlag=!0):(P.set({bFilterMode150:this.options.expression.refineModecheckbox},!1),this.options.expression.refineModecheckbox&&(p.filter150Checkbox.checkFlag=!0)),e.noEvolutionUpdate=!0,this.VariantsComponent.initialize(e),0==Object.keys(this.options.expression).length?p.singleProductId||this.hideVariants():(t.displayExpression||this.hideVariants(),p.singleProductId&&this.showVariants())},hideVariants:function(){this.PCCheckbox&&this.PCCheckbox.hide(),this.VariantsComponent&&(this.VariantsComponent.hide(),this.VariantsComponent.PCChooser&&this.VariantsComponent.PCChooser.hide())},showVariants:function(){this.PCCheckbox&&this.PCCheckbox.show(),this.VariantsComponent&&(this.VariantsComponent.show(),this.VariantsComponent.PCChooser&&this.PCCheckbox.checkFlag&&this.VariantsComponent.PCChooser.show())},pubSubEvents:function(){this.VariantsComponent&&this.VariantsComponent.configuratorButton&&0!=Object.keys(this.options.expression).length&&(this.VariantsComponent.configuratorButton.addClassName("cfgWaitCursor"),this.promiseSingleMVID.then(()=>{this.VariantsComponent.configuratorButton.removeClassName("cfgWaitCursor")},e=>{this.VariantsComponent.configuratorButton.removeClassName("cfgWaitCursor"),this.VariantsComponent.configuratorButton.addClassName("disableButton");let t="";"Filter_MVSearchFailed"==e?t=_.Filter_MVSearchFailed:"Filter_MVNotFound"==e&&(t=_.Filter_MVNotFound),g.showNotifs("error",t,_.Filter_RefreshWidget,"",this.NotifsParentContainer)})),p.ModelEvents.subscribe({event:"NoSingleProductId"},e=>{this.VariantsComponent&&this.VariantsComponent.configuratorButton&&this.VariantsComponent.configuratorButton.hasClassName("cfgWaitCursor")&&(this.alertDiv.add({message:_.Filter_WaitingToComputeSingleMVID,style:{position:"absolute"},className:"error"}),this.alertDiv.show())})}})}),define("DS/CfgFilterUX/CfgFilterFactory",["DS/UIKIT/Alert","DS/CfgFilterUX/CfgFilterEditor","DS/CfgBaseUX/scripts/CfgController","DS/CfgBaseUX/scripts/CfgUtility","UWA/Class/Promise","i18n!DS/CfgFilterUX/assets/nls/CfgFilterUX","DS/CoreEvents/ModelEvents","DS/CfgBaseUX/scripts/CfgData","DS/UIKIT/Mask","i18n!DS/CfgFilterUX/assets/nls/CfgFilterUX"],function(e,t,i,n,o,s,a,r,l,c){"use strict";return{_parameters:null,_callbackAdd:null,alertDiv:null,CfgFilterDialog:null,begin:function(o){if(this._parameters=o,"1"==this._parameters.displayCompactMode?this._parameters.displayCompactMode=!0:this._parameters.displayCompactMode=!1,this._callbackAdd=o.callback,this.alertDiv=new e({visible:!1,autoHide:!0,hideDelay:3e3,closeOnClick:!0,maximumVisibleMessages:3,className:"error"}),this.alertDiv.inject(document.body.querySelector(".f-globalFilter-container"),"top"),l.mask(o.renderTo),null==o.configData)this.filterMode="",this.execute();else{if(this.filterMode="FiringProcess",i.init(),r.ModelEvents=new a,enoviaServerFilterWidget.tenant=this._parameters.tenant,this._parameters&&this._parameters.securityContext){let e={};e.SecurityContext=this._parameters.securityContext,n.setCfgSecurityContext(e)}this.CfgFilterEditor=new t(this._parameters)}},onSecurityContext:function(e,t){var i=null;if(t._parameters&&t._parameters.rootId&&t._parameters.renderTo&&t._callbackAdd&&(console.log(t._parameters.rootId),i=t._parameters.rootId,t._callbackAdd,document.body),null!=i){const e={referenceIds:[i],version:"1.1",xRevisionContent:!0};n.getMultipleConfigurationContextInfo(e).then(e=>this.createDialog(e),e=>{console.error("getMultipleConfigurationContextInfo call failed"),console.log(e),this.showAlert(s.Filter_Error_Models)})}},showAlert:function(e){this.alertDiv.add({message:e,style:{position:"absolute"},className:"error"}),this.alertDiv.show(),this._callbackAdd&&this._callbackAdd([])},execute:async function(){var e,t=this;if(i.init(),r.ModelEvents=new a,enoviaServerFilterWidget.tenant=t._parameters.tenant,this._parameters&&this._parameters.securityContext){let e={};e.SecurityContext=this._parameters.securityContext,n.setCfgSecurityContext(e)}try{await n.populate3DSpaceURL(),n.isParamDefined(enoviaServerFilterWidget.mySecurityContext)||(console.log("If we dont receive SecurityContext in parameter of begin we will call populateSecurityContext service"),await n.populateSecurityContext());r.configurationCriteria=await n.checkDecouplingActivation(),console.log(r.configurationCriteria),n.populateDisplayExpressionXSLT(),t.onSecurityContext(e,t),l.unmask(t._parameters.renderTo)}catch(e){console.log(e);let t="Native"==enoviaServerFilterWidget.mode?document.body.querySelector(".wiwFilterAlertDiv"):document.body.querySelector(".f-globalFilter-container");n.showNotifs("error",c.CFG_Filter_Failed,c.Filter_RefreshWidget,"",t)}},applyCompactComfortableMode:function(e){e="1"===e,null!=this.CfgFilterEditor&&this.CfgFilterEditor.applyCompactComfortableMode(e)},hideFilter:function(){this._parameters&&this._parameters.hideFilter()},showFilter:function(){this._parameters.showFilter()},validateConfigurationFilter:function(){if(!1===this.CfgFilterEditor.validateCFFilter())return new o(function(e,t){e(!1)});var e={},t="";return null===(t=null!=this.filterMode&&"FiringProcess"==this.filterMode?this.CfgFilterEditor.applyFilterFromFiringProcess(e):this.CfgFilterEditor.onApplyFilter(e))?new o(function(e,t){e(!0)}):null!=t?t:void 0},createDialog:function({contextInfo:e,xRevisionContent:i}){var n=this._parameters||{};n.filterBasedOn="",e&&Array.isArray(e)&&e.length>0?n.filterBasedOn="Model":i&&Array.isArray(i)&&i.length>0&&(n.filterBasedOn="xRevision"),n.iModelsList=[];const o=[];if("Model"===n.filterBasedOn){if(e.forEach(e=>{if(e&&e.content&&e.content.results&&Array.isArray(e.content.results)&&e.content.results.length>0){const t=e.content.results[0];t.notification&&"unaccessible"===t.notification.code&&"ERROR"===t.notification.type?o.push(t):n.iModelsList.push(t)}}),o.length>0)return void this.showAlert(s.Filter_unaccessiblecode_Error);if(0==n.iModelsList.length)return void this.showAlert(s.Filter_Error_No_Model)}else if("xRevision"===n.filterBasedOn)n.xRevisionContent=i,i[0].attachedScopes&&Array.isArray(i[0].attachedScopes)&&i[0].attachedScopes.length>0&&(n.xRevScopeDefined=!0,i[0].attachedScopes.forEach(e=>{n.iModelsList.push(e.attributes[0])}));else if(!n.filterBasedOn)return void this.showAlert(s.Filter_Root_Unconfigured);this.CfgFilterEditor=new t(this._parameters),this._parameters.config_filter_id?this.CfgFilterEditor.getDataFromID(this._parameters.config_filter_id).then(()=>{this.CfgFilterEditor.render()}):this.CfgFilterEditor.render()},areConfigurationFiltersCompatible:function(e,t,o){var s=this;i.init(),enoviaServerFilterWidget.tenant=e.tenant,enoviaServerFilterWidget.baseURL=e.url3DSpace;var a="";0!=e.securitycontext.indexOf("ctx::")&&(a="ctx::"),enoviaServerFilterWidget.mySecurityContext=a+e.securitycontext;const r={referenceIds:[e.rootid],version:"1.1",xRevisionContent:!0};n.getMultipleConfigurationContextInfo(r).then(e=>{const{contextInfo:i,xRevisionContent:n}=e;let a="";if(i&&Array.isArray(i)&&i.length>0?a="Model":n&&Array.isArray(n)&&n.length>0&&(a="xRevision"),a){if("1.1"==e.version){const e=[];if("Model"===a){if(i.forEach(t=>{if(t&&t.content&&t.content.results&&Array.isArray(t.content.results)&&t.content.results.length>0){const i=t.content.results[0];if(i.notification&&"unaccessible"===i.notification.code&&"ERROR"===i.notification.type)return void o(i.notification.notification);e.push(i)}}),0==e.length)return void o({code:"noAttachedModels",type:"ERROR"});s.processInputFiltersCompatibility(e,t,o)}}}else o({code:"noAttachedModels",type:"ERROR"})},()=>o({code:"failedToGetAttachedModels",type:"ERROR"}))},processInputFiltersCompatibility:function(e,t,i){var n=[],o=[];if(Array.isArray(e)){for(var s=0;s<e.length;s++)n.push(e[s].physicalID);for(Array.isArray(t),s=0;s<t.length;s++){var a=t[s];a.expression&&a.expression.modelId?-1==n.indexOf(a.expression.modelId)&&o.push(s):o.push(s)}}i(o)}}});