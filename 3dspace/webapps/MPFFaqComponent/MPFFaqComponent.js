define("DS/MPFFaqComponent/MPFFaqFeatureSuggestion",["UWA/Core","UWA/Class/View","DS/UIKIT/Form","i18n!DS/MPFFaqComponent/assets/nls/MPFFaqFeatureSuggestion"],function(e,t,n,i){"use strict";return t.extend({setup:function(e){this.form=null},render:function(){this.form=new n({url:"https://toto.fr",className:"horizontal",fields:[{type:"text",name:"name",label:i.nameLabel,placeholder:i.namePlaceholder,required:!0},{type:"text",name:"company",label:i.companyLabel,placeholder:i.companyPlaceholder,required:!0},{type:"email",name:"email",label:i.emailLabel,placeholder:i.emailPlaceholder,required:!0},{type:"tel",name:"phone",label:i.phoneLabel,placeholder:i.phonePlaceholder,required:!0},{type:"textarea",name:"message",label:i.messageLabel,placeholder:i.messagePlaceholder,rows:10,required:!0}],buttons:[{type:"submit",value:i.sendMessageButton}],events:{onSubmit:this._onFormSubmit.bind(this)}});const t=e.createElement("div",{html:[{tag:"h4",text:i.suggestFeatureTitle,styles:{padding:"10px 28px 15px 28px"}},this.form]});this.container.setContent(t)},_onFormSubmit:function(e){const t=this.form,n=i.mailSubject,o=t.getValue("message")+" \n\n"+i.nameLabel+" : "+t.getValue("name")+" \n"+i.companyLabel+" : "+t.getValue("company")+" \n"+i.emailLabel+" : "+t.getValue("email")+" \n"+i.phoneLabel+" : "+t.getValue("phone")+" \n";window.location.href=this._generateMailTo("marketplace.make@3ds.com",n,o),this.container.setContent('<p class="text-center text-success"><br /><br /><br />'+i.mailSentMessage+"</p>")},_generateMailTo:function(e,t,n){return"mailto:"+e+"?subject="+this._prepareForMail(t)+"&body="+this._prepareForMail(n)},_prepareForMail:function(e){return encodeURIComponent(e).replace(" ","%20").replace("\n","%0D%0A")}})}),define("DS/MPFFaqComponent/MPFFaqHandlebarsHelpers",["UWA/Core","WebappsUtils/WebappsUtils","DS/Handlebars/Handlebars"],function(e,t,n){"use strict";return{addHandlebarsHelpers:function(i){const o=this;"i18n"in n.helpers||n.registerHelper("i18n",function(e,t){return new n.SafeString(void 0!==n.i18n?n.i18n.get(e,t.hash):e)}),"ifCond"in n.helpers||n.registerHelper("ifCond",function(e,t,n){return e===t?n.fn(this):n.inverse(this)}),"userHasRole"in n.helpers||n.registerHelper("userHasRole",function(e,t){return o.userHasRole(e,t)}),"faq-image"in n.helpers||n.registerHelper("faq-image",function(e){const o=t.getWebappsAssetUrl(i,"images/"+e);return new n.SafeString('<img src="'+o+'" />')}),"faq-images"in n.helpers||n.registerHelper("faq-images",function(){const o=(new Date).valueOf(),s=arguments;return require(["DS/UIKIT/Carousel"],function(n){let r="";for(let e=0;e<s.length-1;e++){r+='<img src="'+t.getWebappsAssetUrl(i,"images/"+s[e])+'" />'}const l=new n({slides:e.createElement("div",{html:r}),slideSelector:"> img",autoPlay:!0,animation:"slide",dots:!0,infinite:!0}),a=document.querySelector("#_"+o);a&&(l.inject(e.extendElement(a),"after"),a.parentNode.removeChild(a))}),new n.SafeString('<div id="_'+o+'"></div>')}),"faq-columns"in n.helpers||n.registerHelper("faq-columns",function(e){const t=e.fn(this);return new n.SafeString('<div class="row">'+t+"</div>")}),"faq-column"in n.helpers||n.registerHelper("faq-column",function(e){const t=e.fn(this);return new n.SafeString('<div class="col-md-6">'+t+"</div>")})},userHasRole:function(e,t){let n=!1;if(t){if(e&&e.length){const i=t.split(">"),o=i[0],s=i.length>1?i[1]:void 0;for(let t=0;t<e.length;t++)if(e[t].Role===o&&(!s||e[t].Project===s)){n=!0;break}}}else n=!0;return n}}}),define("DS/MPFFaqComponent/MPFFaqWidget",["UWA/Core","UWA/Promise","UWA/Class/View","DS/Handlebars/Handlebars","DS/MPFFaqComponent/MPFFaqHandlebarsHelpers","text!DS/MPFFaqComponent/assets/templates/MPFFaqComponent.hbs","i18n!DS/MPFFaqComponent/assets/nls/MPFFaqComponent","css!DS/MPFUI/MPFUI"],function(e,t,n,i,o,s,r){"use strict";return n.extend({domEvents:{"click img":"_onImageClick","click .mpf-faq-go-top":"scrollToTop",resize:"setPageParent"},setup:function(e){this._onUrlChanges=this._onUrlChanges.bind(this),this._onResize=this._onResize.bind(this,this._isMobileDevice()),this._onScroll=this._onScroll.bind(this),this.model={pageUrlBase:this._getPageUrlBase(),categories:[],categoryToDisplay:null,roles:null},this.datasModule=null,this.i18nDatas=null,this.template=i.compile(s),this.isOnSummaryPage=!0,this.pageParent=this._getPageParent(e.widget),this.isSticky=!1,e.widget.data&&e.widget.data.datasModule&&(this.datasModule=e.widget.data.datasModule),o.addHandlebarsHelpers(this.datasModule),this._fetchMeRoles().then(function(){this._loadDatasModule(),this._listenResize(),this._listenScroll()}.bind(this))},setPageParent(){window.innerWidth<=1023&&!this.pageParent.hasClassName("content-container")?this.pageParent=document.querySelector(".content-container"):window.innerWidth>1023&&!this.pageParent.hasClassName("moduleLayout")&&(this.pageParent=document.querySelector(".content-container > .module.moduleLayout"))},_getPageParent:function(e){let t;return document.querySelector(".content-container").setStyles({scrollBehavior:"smooth"}),document.querySelector(".content-container > .module.moduleLayout").setStyles({scrollBehavior:"smooth"}),t=window.innerWidth<=1023?document.querySelector(".content-container")||e.body:document.querySelector(".content-container > .module.moduleLayout")||e.body,"auto"!==window.getComputedStyle(t).getPropertyValue("overflow-y")&&((t=e.body).style.overflowY="auto"),t},render:function(){let t,n,o;this.model&&(i.i18n=e.merge(this.i18nDatas,r),t=this.template.call(null,this.model),this.container.setContent(t),this.model&&this.model.categoryToDisplay&&((n=this.model.categoryToDisplay.component)&&(o=this.container.getElement(".mpf-faq-component"))&&(n.render(),n.inject(o)),this._toggleActiveMenuCategory(),this._toggleActiveMenuLink()),this._updateMetas())},destroy:function(){this._stopListeningResize(),this._stopListeningUrlChanges(),this._stopListeningScroll(),this.stopListening(),this._parent()},_getPageUrlBase:function(){const e=window.dsBaseUrl.replace(document.location.protocol+"//"+document.location.host+"/","");let t=document.location.href.replace(window.dsBaseUrl,"").split("/");return t.length>1&&t.pop(),"/"+e+(t=t.join("/").split("?")[0])},_fetchMeRoles:function(){const e=this,n=t.deferred();return window.dsUserLogin?require(["DS/MPFDataProxy/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2"],function(t,i){let o;t.fetchPromise().then(function(e){return i.getInstance(e).getFactory(i.Types.PERSON)}).then(function(e){return(o=e.createModel("me")).fetchPromise()}).then(function(){e.model.roles=o.get("PersonRoles"),n.resolve()})}):n.resolve(),n.promise},_loadDatasModule:function(){this.datasModule?(require(["text!DS/"+this.datasModule+"/assets/model/"+this.datasModule+"Model.json","i18n!DS/"+this.datasModule+"/assets/nls/"+this.datasModule],this._onDatasModuleLoaded.bind(this),console.error.bind("FAQ config file not found")),window.addEventListener("popstate",this._onUrlChanges)):console.error("FAQ no config file path set in widget parameters")},_stopListeningUrlChanges:function(){window.removeEventListener("popstate",this._onUrlChanges)},_onDatasModuleLoaded:function(e,t){let n=null;try{n=JSON.parse(e)}catch(e){console.error("FAQ JSON Datas error")}n&&(this.model.categories=n,this.model.categoryToDisplay=null,this.i18nDatas=t,this._getUrlSecondPart()?this._onUrlChanges():this.render())},_listenResize:function(){window.addEventListener("resize",this._onResize)},_stopListeningResize:function(){window.removeEventListener("resize",this._onResize)},_onResize:function(e){const t=this._isMobileDevice();t!==e&&(e=t,this._updateElementsStick())},_listenScroll:function(){this.pageParent.addEventListener("scroll",this._onScroll,{passive:!0})},_stopListeningScroll:function(){this.pageParent.removeEventListener("scroll",this._onScroll,{passive:!0})},_onScroll:function(e){const t=e.currentTarget.scrollTop;this._isMobileDevice()||(t>105&&!this.isSticky?this._stickElements(!0):t<105&&this.isSticky&&this._stickElements(!1))},_updateElementsStick:function(){const e=this.pageParent.scrollTop,t=!this._isMobileDevice()&&e>105;this._stickElements(t)},_stickElements:function(e){const t=e?"add":"remove";this.isSticky=e,this.isOnSummaryPage?(document.querySelector(".mpf-faq-subtitle").classList[t]("sticky"),document.querySelector(".mpf-faq-menu-content").classList[t]("for-sticky")):(document.querySelector(".mpf-faq-bloc .mpf-faq-category-title").classList[t]("sticky"),document.querySelector(".mpf-faq-articles").classList[t]("for-sticky"),document.querySelector(".mpf-faq-menu-content").classList[t]("sticky")),document.querySelector(".mpf-faq-go-top").classList[t]("on")},_isMobileDevice:function(){return(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<768},_toggleActiveMenuCategory:function(){const e=this._findCategoryFromUrl();let t,n;e&&((t=this.container.getElement(".mpf-faq-category.active"))&&t.classList.remove("active"),(n=this.container.getElement('.mpf-faq-category[data-url="'+e.url+'"]'))&&n.classList.add("active"))},_toggleActiveMenuLink:function(){const e=this.container.getElement(".mpf-faq-article-link.active");e&&e.classList.remove("active");const t=this._findArticleFromUrl();if(t){const e=this.container.getElement('.mpf-faq-article-link[data-url="'+t.url+'"]');e&&e.classList.add("active")}},_scrollToArticle:function(){const e=this._findArticleFromUrl();if(e){const t='.mpf-faq-anchor[data-url="'+e.url+'"]',n=this.pageParent.querySelector(t);n&&this.scroll(n)}},_onUrlChanges:function(){const e=this.model.categoryToDisplay||{};let t,n;this.model.categoryToDisplay=this._findCategoryFromUrl(),this.model.categoryToDisplay&&e.title!==this.model.categoryToDisplay.title?(this.isOnSummaryPage=!1,t=!0,this.model.categoryToDisplay.role&&(t=o.userHasRole(this.model.roles,this.model.categoryToDisplay.role)),t?this._getArticlesTemplates(this.model.categoryToDisplay.articles).then(this.render.bind(this)).then(this._updateElementsStick.bind(this)).then(setTimeout.bind(null,this._scrollToArticle.bind(this),500)):(console.error("User don't have '"+this.model.categoryToDisplay.role+"' role"),require(["DS/UWPClientCode/Navigation"],function(e){e.routeTo(document.location.pathname)}))):this.model.categoryToDisplay?(this.isOnSummaryPage=!1,"component"===(n=this._findArticleFromUrl()).type&&require([n.class],e=>{this._setCurrentComponent(new e),this.render()}),this._toggleActiveMenuLink(),this._scrollToArticle(),this._updateMetas()):(this.isOnSummaryPage=!0,this.model.categoryToDisplay=null,this.render(),this._updateElementsStick())},_getUrlSecondPart:function(){const e=document.location.href.replace(window.dsBaseUrl,"").split("/");return e.length>1?e[1].split("?")[0]:null},_findCategoryFromUrl:function(){let e=null;const t=this._getUrlSecondPart();for(let n=0;n<this.model.categories.length;n++){const i=this.model.categories[n];if(i.url===t){e=i;break}if(i.articles)for(let n=0;n<i.articles.length;n++){if(i.articles[n].url===t){e=i;break}}}return e},_findArticleFromUrl:function(){let e=null;const t=this._getUrlSecondPart();let n;if(t){for(let n=0;n<this.model.categories.length;n++){const i=this.model.categories[n];if(i.articles)for(let n=0;n<i.articles.length;n++){const o=i.articles[n];if(o.url===t){e=o;break}}}e||(n=this._findCategoryFromUrl())&&n.articles&&(e=n.articles[0])}return e},_getArticlesTemplates:function(n){const o=t.deferred(),s=this,l=n.length;let a=0;const c=function(){++a===l&&o.resolve()},d=this._findArticleFromUrl();for(let t=0;t<n.length;t++)!function(t){t.type?"component"===t.type&&t.url===d.url?require([t.class],function(e){s._setCurrentComponent(new e),c()},c):c():require(["text!DS/"+s.datasModule+"/assets/templates/"+t.url+".hbs"],function(n){const o=i.compile(n);i.i18n=e.merge(s.i18nDatas,r);const l=o(s.model);s._setArticleContent(t,l),c()},c)}(n[t]);return o.promise},_setArticleContent:function(e,t){for(let n=0;n<this.model.categories.length;n++){const i=this.model.categories[n];for(let n=0;n<i.articles.length;n++){const o=i.articles[n];if(o.url===e.url){o.content=t;break}}}},_setCurrentComponent:function(e){this.model.categoryToDisplay.component=e},_onImageClick:function(t){const n=e.createElement("div",{class:"mpf-faq-modal-mask off",html:{tag:"img",src:t.target.src},events:{click:function(){n.addClassName("off"),setTimeout(function(){n.remove()},250)}}});n.inject(e.extendElement(document.body)),setTimeout(function(){n.removeClassName("off")},10)},_updateMetas:function(){const e=this._findArticleFromUrl();if(e){const t=this._findCategoryFromUrl(),n=this._getUrlSecondPart();let i=null;i=n===t.url?this.i18nDatas.get(t.title):this.i18nDatas.get(e.title);const o=document.createElement("div");o.innerHTML=e.content;const s=(o.textContent||o.innerText).substring(0,160);require(["DS/PlatformAPI/PlatformAPI"],function(e){e.publish("update-metas",{title:{articleTitle:i},description:{articleDescription:s}})})}},scrollToTop:function(){window.parent.scrollTo({top:0,behavior:"smooth"})},scroll:function(t){const n=parseInt(e.extendElement(t).getPosition().y);t&&(this._interval&&clearInterval(this._interval),this.pageParent.scrollTo({top:n-64,left:0}),this._interval=setInterval(function(){n-64!==this.pageParent.getScrolls().top&&this.pageParent.getScrolls().top+this.pageParent.clientHeight!==this.pageParent.getScrolls().height||clearInterval(this._interval),parseInt(e.extendElement(t).getPosition().y)!==n&&this.scroll(t)}.bind(this),50))}})});