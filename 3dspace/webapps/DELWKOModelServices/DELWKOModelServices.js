define("DS/DELWKOModelServices/DELWKOCollectionUtils",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/DELPPWModelServices_FD02/CollectionUtils","DS/DELPPWModelServices_FD02/ModelUtils","DS/DELPPWIRPCModel_FD02/Collections/ReferenceCollection","DS/DELPPWIRPCModel_FD02/Collections/InstanceCollection","DS/DELPPWIRPCModel_FD02/Collections/ConnectionCollection","DS/DELPPWDocumentModel_FD02/DocumentCollection","DS/DELPPWIRPCModel_FD02/Model/ReferenceModel","DS/DELPPWIRPCModel_FD02/Model/InstanceModel","DS/DELPPWWebServices_FD02/WebserviceUtils","DS/DELPPWLoggerModel_FD02/LoggerUtils","DS/PlatformAPI/PlatformAPI","DS/DELPPWModelServices_FD02/BehaviorUtil","DS/DELWKONavigationServices/DELWKONavigateUtil","text!DS/DELWKOModelServices/assets/json/DELWKOPayloads.json"],function(e,n,t,o,i,r,s,a,c,l,u,d,f,m,g,p,C){"use strict";return n.singleton({name:"DELWKOCollectionUtils",_init:function(e){},init:function(n){n=n||{},e.is(o.references)||o.init(n)},reset:function(n){var t,i=n||{},r=!e.is(i.silent,"boolean")||i.silent;e.is(o.references)&&(t=o.references.reset({},{silent:r}),e.is(t)&&o.references.remove(t,{silent:r})),e.is(o.instances)&&(t=o.instances.reset({},{silent:r}),e.is(t)&&o.instances.remove(t,{silent:r})),e.is(o.connections)&&(t=o.connections.reset({},{silent:r}),e.is(t)&&o.connections.remove(t,{silent:r})),e.is(o.documents)&&(t=o.documents.reset({},{silent:r}),e.is(t)&&o.documents.remove(t,{silent:r}))},setReferenceCollectionEvents:function(e){o.references.addEvents(e)},setConnectionsCollectionEvents:function(e){o.connections.addEvents(e)},setInstanceCollectionEvents:function(e){o.instances.addEvents(e)},setDocumentCollectionEvents:function(e){o.documents.addEvents(e)},removeCollectionEvents:function(){o.references.removeEvents(),o.connections.removeEvents(),o.instances.removeEvents()},removeDocumentCollectionEvents:function(){o.documents.removeEvents()},updateModel:function(n,t){var o=this;(t=t||{}).onCompleteMsg=e.is(t.onCompleteMsg)?t.onCompleteMsg:"Updated Model succesfully",t.onFailureMsg=e.is(t.onFailureMsg)?t.onFailureMsg:"Updating Model failed",n.save(null,{proxy:"passport",headers:d.getHeaders(),data:e.Json.encode(t.data),onComplete:function(n,i){f.debug(o.name,t.onCompleteMsg+" : %s",JSON.stringify(n)),e.is(t.isFacet)&&t.isFacet&&m.publish("DS/PADUtils/PADCommandProxy/refresh",{data:{authored:{modified:[n.id]}}}),e.is(t.onComplete,"function")&&t.onComplete.call(null,n,i)},onFailure:function(){f.debug(o.name,t.onFailureMsg+" : %s",JSON.stringify(n)),e.is(t.onFailure,"function")&&t.onFailure.call(null,n)},wait:!0,parse:!0})},massUpdateModels:function(n,t,i){var r=this;(i=i||{}).onCompleteMsg=e.is(i.onCompleteMsg)?i.onCompleteMsg:"MassUpdate: Model has been updated successfully",i.onFailureMsg=e.is(i.onFailureMsg)?i.onFailureMsg:"MassUpdate has failed",e.is(i.data)||e.is(i.data.keyValues)&&e.is(i.data.pids,"array")||(f.debug(r.name,i.onFailureMsg+" as keyValues or pids have not been provided"),!e.is(i.onFailure,"function"))?d.webServiceRequest({url:"dsmfg/private/V0/MfgElement/"+n,method:"PUT",data:e.Json.encode(i.data),onComplete:function(s){var a;s.forEach(function(s){s=s.attributesValue,a="instance"===n?o.instances.get(s.PID):o.references.get(s.PID),e.owns(a._attributes,t)&&(a.set(t,s[t]),f.debug(r.name,i.onCompleteMsg+": %o",a))}),e.is(i.onComplete,"function")&&i.onComplete.call(null,s)},onFailure:function(){f.debug(r.name,i.onFailureMsg),e.is(i.onFailure,"function")&&i.onFailure.call(null)}}):i.onFailure.call(null)},fetch:function(n,t){var o,i,r,s=this;e.is(n)?(t=t||{},i=!!e.is(t.silent,"boolean")&&t.silent,r=!e.is(t.parse,"boolean")||t.parse,o={proxy:"passport",type:"json",headers:d.getHeaders(),onComplete:function(n,o,i){f.debug(s.name,"fetch completed: %o",o),e.is(t.onComplete,"function")&&t.onComplete.apply(null,[n,i])},onFailure:function(n,o,i){var r=e.is(o)?e.Json.isJson(o)?e.Json.decode(o):o:{};f.debug(s.name,"fetch failed with error: %o",r),e.is(t.onFailure,"function")&&t.onFailure.apply(null,[r,i])},onTimeout:function(n,o,i){var r=e.is(o)?e.Json.isJson(o)?e.Json.decode(o):o:{};f.debug(s.name,"fetch timed out with error: %o",r),e.is(t.onTimeout,"function")&&t.onTimeout.apply(null,[r,i])},parse:r,silent:i},n.fetch(o)):f.debug(s.name,"Invalid model object to fetch.")},getAttributes:function(n,t){Array.isArray(n)||t.onFailure(null);var o={url:d.get3DSpaceUrl()+"resources/dsmfg/V0/getAttributes",method:"POST",data:e.Json.encode(n),headers:d.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),onComplete:function(e){t.onComplete(e)},onFailure:function(e){t.onFailure(e)}};d.webServiceRequest(o)},getInstances:function(n,t){Array.isArray(n)||t.onFailure(null);var o={url:d.get3DSpaceUrl()+"resources/dsmfg/V0/whereUsed",method:"POST",data:e.Json.encode(n),headers:d.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),onComplete:function(e){t.onComplete(e)},onFailure:function(e){t.onFailure(e)}};d.webServiceRequest(o)},getUnitDetails:function(n,t){var o=this,i=t||{},r=(!!e.is(i.silent,"boolean")&&i.silent,d.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}));e.is(i.securityContextOverride,"string")&&(r.SecurityContext=i.securityContextOverride);var s={url:d.get3DSpaceUrl()+"resources/v1/modeler/dspfl/dspfl:Unit/"+n,method:"GET",headers:r,onComplete:function(n){e.is(t.onComplete,"function")&&t.onComplete.call(null,n)},onFailure:function(n,t){var r=e.is(t)?e.Json.isJson(t)?e.Json.decode(t):t:{};f.debug(o.name,"Get Unit details failed: %o",n),e.is(i.onFailure,"function")&&i.onFailure.call(null,n,r.error)}};d.webServiceRequest(s)},getInstancesWithPromise:function(e){var n=this;return new t(function(t,o){n.getInstances(e,{onComplete:function(e){t(e)},onFailure:function(e){o(e)}})})},createWorkOrderFromProcess:function(n,t){var o=this,i=t||{},r=(!!e.is(i.silent,"boolean")&&i.silent,d.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}));e.is(i.securityContextOverride,"string")&&(r.SecurityContext=i.securityContextOverride);var s=e.Json.decode(C).createWorkOrderFromProcess;void 0===n["PLMEntity.V_Name"]||""===n["PLMEntity.V_Name"]?delete s.items[0].title:s.items[0].title=n["PLMEntity.V_Name"],s.items[0].productionPlanId=n["DELLmiProductionPlanReference.ProductionPlan"],s.items[0]["dsprcs:MfgProcess"].source=d.get3DSpaceUrl().replace("3DSpace",""),s.items[0]["dsprcs:MfgProcess"].identifier=n["DELLmiWorkPlanSystemReference.MfgProcess"],s.items[0]["dsprcs:MfgProcess"].relativePath="/resources/v1/modeler/dsprcs/dsprcs:Process/"+n["DELLmiWorkPlanSystemReference.MfgProcess"],s.items[0]["dsmfg:MfgItem"].source=d.get3DSpaceUrl().replace("3DSpace",""),s.items[0]["dsmfg:MfgItem"].identifier=n["DELFmiFunctionReference.MfgItem"],s.items[0]["dsmfg:MfgItem"].relativePath="/resources/v1/modeler/dsmfg/dsmfg:MfgItem/"+n["DELFmiFunctionReference.MfgItem"],void 0===n["Builds.Builds"]||""===n["Builds.Builds"]?delete s.items[0].build:(s.items[0].build.source=d.get3DSpaceUrl().replace("3DSpace",""),s.items[0].build.identifier=n["Builds.Builds"],s.items[0].build.relativePath=n["Builds.Builds"]),"EACH"===n.Magnitude?s.items[0].orderQuantity.value=parseInt(n.OrderQuantity):s.items[0].orderQuantity.value=parseFloat(n.OrderQuantity),s.items[0].orderQuantity.magnitude=n.Magnitude;var a=JSON.stringify(s),c={url:d.get3DSpaceUrl()+"resources/v1/modeler/dswo/invoke/dswo:CreateWorkOrderFromProcess?$mask=dsmvwo:WorkOrderMask.DetailedStructure",method:"POST",headers:r,data:a,onComplete:function(n){for(var t=[],o=n.member,r=o.length,s=0;s<r;s++){var a=o[s];null!=a&&t.push(a["dswo:WorkOrder"].identifier)}var c={forceDBMode:!0,expandLevel:0},l=t;p.getDescendantsFromServer_v2(l,function(n){var t={};t.data=n,e.is(i.onComplete,"function")&&i.onComplete.call(null,t.data)},c)},onFailure:function(n,t){var r=e.is(t)?e.Json.isJson(t)?e.Json.decode(t):t:{};f.debug(o.name,"Creation failed: %o",n),e.is(i.onFailure,"function")&&i.onFailure.call(null,n,r.error)}};d.webServiceRequest(c)},fetchRef_v2:function(e,n){return new t(function(t,i){o.fetchRef(e,{silent:n,onComplete:function(e){t(e)},onFailure:function(e){i(e)}})})},fetchInst_v2:function(e){return new t(function(n,t){o.fetchInst(e,{silent:!0,onComplete:function(e){n(e)},onFailure:function(e){t(e)}})})},createRef:function(n,t){var i,r=this,s=n||{},a=t||{},c=!!e.is(a.silent,"boolean")&&a.silent,l=d.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0});return e.is(a.securityContextOverride,"string")&&(l.SecurityContext=a.securityContextOverride),i={proxy:"passport",headers:l,data:e.Json.encode(s),onComplete:function(n){e.is(a.onComplete,"function")&&a.onComplete.call(null,n)},onFailure:function(n,t){var o=e.is(t)?e.Json.isJson(t)?e.Json.decode(t):t:{};f.debug(r.name,"Creation failed: %o",n),e.is(a.onFailure,"function")&&a.onFailure.call(null,n,o.error)},silent:c,wait:!0,parse:!0},o.references.create(null,i)},fetchReferences:function(n,t){var i,r,s,a,c=this;t=t||{},r=!e.is(t.silent,"boolean")||t.silent,s=!e.is(t.parse,"boolean")||t.parse,a=!!e.is(t.remove,"boolean")&&t.remove,i={data:n,proxy:"passport",headers:d.getHeaders(),onComplete:function(n,o,i){var r=[];f.debug(c.name,"fetch references completed: %o",o),e.is(o,"array")&&o.forEach(function(e){r.push(n.get(e.PID))}),e.is(t.onComplete,"function")&&t.onComplete.apply(null,[r,i])},onFailure:function(n,o,i){var r=e.is(o)?e.Json.isJson(o)?e.Json.decode(o):o:{};f.debug(c.name,"fetch references failed with error: %o",r),e.is(t.onFailure,"function")&&t.onFailure.apply(null,[r,i])},wait:!0,parse:s,silent:r,remove:a},o.references.fetch(i)},addRef:function(n,t){var i,r=t||{};return n&&(r=e.merge(r,{merge:!0,parse:!0}),i=o.references.add(n,r)),i},fetchRef:function(n,t){var i=this,r=new l(n);return r.fetch({proxy:"passport",headers:d.getHeaders(),onComplete:function(n){f.debug(i.name,"Fetch completed: %o",n),(!e.is(t.add)||e.is(t.add)&&!0===t.add)&&o.references.add(n,{silent:!!e.is(t.silent)&&t.silent,merge:!0}),e.is(t.onComplete,"function")&&t.onComplete.call(null,n)},onFailure:function(n){f.debug(i.name,"Fetch failed: %o",n),e.is(t.onFailure,"function")&&t.onFailure.call(null,n)},wait:!0,parse:!0}),r},fetchRefList:function(n,t){var i,r=[];i={url:"dsmfg/private/V0/MfgElement/reference/getReferences",method:"POST",data:e.Json.encode(n),options:t,onComplete:function(e){r=e.references.map(function(e){return e.attributesValue}),i={stackedReferences:r,onComplete:t.onComplete,onFailure:t.onFailure},o.addToCollections(i)},onFailure:function(n){e.is(t.onFailure,"function")&&t.onFailure.call(n)}},d.webServiceRequest(i)},fetchInstancesAndTheirReferences:function(n,t){d.webServiceRequest({url:"dsmfg/private/V0/MfgElement/instance/getInstancesAndTheirReferences",method:"POST",data:e.Json.encode(n),onComplete:function(e){var n,i,r=function(e){return e.attributesValue};n=e.instances.map(r),i=e.references.map(r),o.addToCollections({stackedReferences:i,stackedInstances:n,onComplete:t.onComplete,onFailure:t.onFailure})},onFailure:function(n){e.is(t.onFailure,"function")&&t.onFailure.call(n)}})},updateRef:function(e,n){var t=o.references.get(e);(n=n||{}).onCompleteMsg="Updated Reference succesfully",n.onFailureMsg="Updating Reference failed",this.updateModel(t,n)},updateRefs:function(e,n){(n=n||{}).onCompleteMsg="MassUpdate: Reference has been updated successfully",n.onFailureMsg="MassUpdate of References has failed",this.massUpdateModels("reference",e,n)},deleteRef:function(n,t){var i,r=this,s=o.references.get(n);if(t=t||{},i=!!e.is(t.deep)&&t.deep,!e.is(s))return f.debug(this.name,"Refrence does not exists"),void(e.is(t.onFailure)&&t.onFailure());s.destroy({proxy:"passport",data:e.Json.encode({deep:i}),headers:d.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),wait:!0,onFailure:function(o,i){var s=e.is(i)?i:{};f.debug(r.name,"Deleting of Refrence failed: %s with error:",n,JSON.stringify(s)),e.is(t.onFailure)&&t.onFailure(o,s)},onComplete:function(s,a){var c,l,u,d=e.is(a)?a:{},m=e.is(d.deletedObjects)?d.deletedObjects:[];if(i&&e.is(m))for(l=0;l<m.length;l++)c=m[l],u=o.instances.get(c),e.is(u)&&o.instances.remove(c),u=o.references.get(c),e.is(u)&&o.references.remove(c);f.debug(r.name,"Deleting of Refrence completed: %s ",n),e.is(t.onComplete)&&t.onComplete(s,d)}})},removeRef:function(e,n){o.references.remove(e,n)},addInst:function(n,t){if(e.is(n))return e.is(t)||(t={}),t=e.merge(t,{merge:!0,parse:!0}),o.instances.add(n,t);f.debug(this.name,"refData is not defined")},createInst:function(n,t){var r,s=this,a=n||{},c=t||{},l=!!e.is(c.silent,"boolean")&&c.silent,u=d.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0});return e.is(c.securityContextOverride,"string")&&(u.SecurityContext=c.securityContextOverride),a.oneDelmiaAggregationMode=i.getOneDelmiaAggregationMode(),r={proxy:"passport",headers:u,data:e.Json.encode(a),onComplete:function(n){o.manageLinearProductFlowsOnCreateInstance(n),e.is(c.onComplete,"function")&&c.onComplete.call(null,n)},onFailure:function(n,t){var o=e.is(t)?e.Json.isJson(t)?e.Json.decode(t):t:{};o=e.is(o.error)?o.error:o,f.debug(s.name,"Instance Creation failed: %o",n),e.is(c.onFailure,"function")&&c.onFailure.call(null,n,o)},wait:!0,parse:!0,silent:l},o.instances.create(null,r)},fetchInst:function(n,t){var o=this,i=new u(n);return e.is(t)||(t={}),i.fetch({proxy:"passport",headers:d.getHeaders(),onComplete:function(n){f.debug(o.name,"Fetch completed: %o",n),o.instances.add(n,{silent:!!e.is(t.silent)&&t.silent,merge:!0,parse:!0}),e.is(t.onComplete,"function")&&t.onComplete.call(null,n)},onFailure:function(n){f.debug(o.name,"Fetch failed: %o",n),e.is(t.onFailure,"function")&&t.onFailure.call(null,n)},wait:!0,parse:!0}),i},updateInst:function(e,n){var t=o.instances.get(e);(n=n||{}).onCompleteMsg="Updated Instance succesfully",n.onFailureMsg="Updating Instance failed",this.updateModel(t,n)},updateInsts:function(e,n){(n=n||{}).onCompleteMsg="MassUpdate: Instance has been updated successfully",n.onFailureMsg="MassUpdate of Instances has failed",this.massUpdateModels("instance",e,n)},deleteInst:function(n,t){var i=this,r=o.instances.get(n);if(t=t||{},!e.is(r))return f.debug(this.name,"Instance does not exists"),void(e.is(t.onFailure)&&t.onFailure());o.manageLinearProductFlowsOnDeleteInstance(r),r.destroy({proxy:"passport",headers:d.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),wait:!0,onFailure:function(o,r){var s=e.is(r)?e.Json.isJson(r)?e.Json.decode(r):r:{};f.debug(i.name,"Deleting of Instance failed: %s with error:",n,s),e.is(t.onFailure)&&t.onFailure(o,s.error)},onComplete:function(){f.debug(i.name,"Deleting of instance completed: %s ",n),e.is(t.onComplete)&&t.onComplete()}})},removeInstance:function(e,n){return o.instances.remove(e,n)},removeConnection:function(e,n){return o.connections.remove(e,n)},createConn:function(n,t){var i,r=this,s=d.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0,minorVersion:"2.0"});return e.is(t)||(t={}),e.is(t.securityContextOverride,"string")&&(s.SecurityContext=t.securityContextOverride,delete t.securityContextOverride),i=e.extend({proxy:"passport",headers:s,data:e.Json.encode(n),onComplete:function(n){f.debug(r.name,"Creation completed: %o",n),e.is(t.onComplete,"function")&&t.onComplete.call(null,n)},onFailure:function(n,o){var i;f.debug(r.name,"Creation failed: %o",n),e.is(o)&&e.is(o.message,"string")&&(i=o.message,f.debug(r.name,i)),e.is(t.onFailure,"function")&&t.onFailure.call(null,n,i)},wait:!0,parse:!0},t,!0),o.connections.create(null,i)},addConn:function(n,t){if(e.is(n))return e.is(t)||(t={}),t=e.merge(t,{merge:!0,parse:!0}),o.connections.add(n,t);f.debug(self.name,"connData is not defined")},updateConn:function(e,n){var t=o.connections.get(e);(n=n||{}).onCompleteMsg="Updated Connection succesfully",n.onFailureMsg="Updating Connection failed",this.updateModel(t,n)},deleteConn:function(n,t){var i=this,r=o.connections.get(n);if(t=t||{},!e.is(r))return f.debug(this.name,"Connection does not exists"),void(e.is(t.onFailure)&&t.onFailure());r.destroy({proxy:"passport",headers:d.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),wait:!0,onFailure:function(o,r){var s;f.debug(i.name,"Deleting of connection failed: %s ",n),e.is(r)&&e.is(r.message,"string")&&(s=r.message,f.debug(i.name,s)),e.is(t.onFailure)&&t.onFailure(o,r)},onComplete:function(r,s){var a;s&&(a=s.deletedConnections?s.deletedConnections:[],Array.isArray(a)&&a.length>0&&a.forEach(function(e){o.removeConnection(e)})),f.debug(i.name,"Deleting of connection completed: %s ",n),e.is(t.onComplete)&&t.onComplete(s)}})},addDocument:function(e){return o.documents.add(e)},getDocument:function(e){return o.documents.get(e)},removeDocument:function(e){return o.documents.remove(e)},getTypes:function(){return o.pprTypes},getInstancesFromCollection:function(e){return o.instances.getChildren(e)},getInstanceFromCollection:function(e){return o.instances.get(e)},isReference:function(n){return e.is(o.references.get(n))},isInstance:function(n){return e.is(o.instances.get(n))},getParentInstancesFromCollection:function(e){return o.instances.getInstancesForGivenReference(e)},getReferenceFromCollection:function(e){return o.references.get(e)},getReferencesArrayFromCollection:function(n){var t=[];return e.is(n,"array")&&n.forEach(function(n){var i=o.getReferenceFromCollection(n);e.is(i)&&t.push(i)}),t},getReferenceModel:function(n){var t,o=this.getReferenceFromCollection(n);return e.is(o)||(t=this.getInstanceFromCollection(n),e.is(t)&&(o=this.getReferenceModelFromInstance(t))),o},getConnectionFromCollection:function(e){return o.connections.get(e)},findSomeConnection:function(e,n){return o.connections.filter(e,n)},hasConnection:function(n){var t=!1,i=o.connections.findWhere(n);return e.is(i)&&(t=!0),t},findConnections:function(e){return o.connections.where(e)},getReferenceModelFromInstance:function(e){var n=e.get("isInstanceOf");return o.references.get(n)},getAggregatingReferenceModelFromInstance:function(e){var n=e.get("isAggregatedBy");return o.references.get(n)},getImpactedConnections:function(n,t,i){var r=[];return i=i||{},i=e.merge(i,{from:!0,to:!0}),r=(r=(r=r.concat(o.connections.getImpactedConnections(n,i.fromXEN,i.relationTypes))).concat(o.connections.getImpactedConnections(t,i.fromXEN,i.relationTypes))).filter(function(t){var o,r=t.get("type"),s=(t.getAttribute("to"),t.getAttribute("from"),!1);return o=function(e){s=!0,i.relationTypes?s=i.relationTypes.indexOf(e)>=0:(i.excludeRelationTypes&&(s=-1===i.excludeRelationTypes.indexOf(e)),i.excludeTimeConstraintType&&!0===i.excludeTimeConstraintType&&["DELLmiTimeConstraintCnx","DELLmiMaterialPathCnxCust","LinearProductFlowCnx","ProcessImplementLinkOcc"].indexOf(e)>-1&&(s=!1))},i.fromXEN?e.is(t.id)&&(3===t.id.split("|").length&&(r=t.id.split("|")[0]),t.get("from.attributesValue").PID===n&&o(r)):o(r),s})},needToQueryForConnections:function(n,t){var o,i=!1;return o=e.is(t,"string")?(o=n?n.get(t):this.getInstanceFromCollection(t))||this.getReferenceFromCollection(t):t,e.is(o)&&(o.getAdditionalInfo("queriedForConnections")||(i=!0)),i},_needToQueryForConnectionsByDir:function(n,t,i){var r,s,a=!1;switch(i){case o.ConnectionDir.DIRECT:s="directConnectionsFetched";break;case o.ConnectionDir.INVERSE:s="inverseConnectionsFetched";break;default:s="queriedForConnections"}return r=e.is(t,"string")?(r=n?n.get(t):this.getInstanceFromCollection(t))||this.getReferenceFromCollection(t):t,e.is(r)&&(r.getAdditionalInfo(s)||(a=!0)),a},needToQueryForDirectConnections:function(e,n){return this._needToQueryForConnectionsByDir(e,n,o.ConnectionDir.DIRECT)},needToQueryForInverseConnections:function(e,n){return this._needToQueryForConnectionsByDir(e,n,o.ConnectionDir.INVERSE)},needToQueryForChildren:function(n){var t=!1,i=e.is(n,"string")?o.references.get(n):n;return e.is(i)&&(i.getAdditionalInfo("queriedForChildren")||(t=!0)),t},refreshAll:function(n,i,r,s){var a,c,u=s||{},m=e.is(u.context)?u.context:null,g=i.concat(r,n),p=[],C=0,h=0;f.log(this.name,"refreshAll, Body roots PID: "+n),f.log(this.name,"refreshAll, Table roots PID: "+i),f.log(this.name,"refreshAll, Auxiliary view roots PID: "+r),new t(function(e){0!==g.length?g.forEach(function(n){var t,i=function(){C+h===g.length&&e()};(t=new l({PID:n})).fetch({proxy:"passport",type:"json",headers:d.getHeaders(),onComplete:function(e){C++,o.references.add(e),i()},onFailure:function(){h++,i()}}),p.push(t)}):e()}).then(function(){o.references.reset(p,{silent:!0}),a=o.instances.reset({},{silent:!0}),e.is(a)&&o.instances.remove(a,{silent:!0}),c=o.connections.reset({},{silent:!0}),e.is(c)&&o.connections.remove(c,{silent:!0}),e.is(u.onComplete,"function")&&u.onComplete.call(m,C,h)})},_removeDuplicate:function(n){return e.is(n,"array")&&(n.sort(),n=n.filter(function(e,n,t){return!n||e!==t[n-1]})),n},expandOnBackbone:function n(t,i){var r=o.getInstancesFromCollection(t),s=[];e.is(r,"array")&&e.is(i)&&r.forEach(function(n){var t=n.get("isInstanceOf");e.is(i.referencesPID,"array")&&-1===i.referencesPID.indexOf(t)&&i.referencesPID.push(t),e.is(i.instancesPID,"array")&&-1===i.instancesPID.indexOf(n.id)&&i.instancesPID.push(n.id),-1===s.indexOf(t)&&s.push(t)}),s.forEach(function(e){n(e,i)})},addToCollections:function(n){var t,r=n||{},s={instancesAndReferences:[],connections:[],documents:e.is(r.documentIdMap)?r.documentIdMap:{}},a=r.stackedReferences?r.stackedReferences:[],c=r.stackedInstances?r.stackedInstances:[],l=r.stackedConnections?r.stackedConnections:[],u=r.deletedObjects?r.deletedObjects:[],d=r.deletedConnections?r.deletedConnections:[],f=r.references?r.references:o.references,m=r.instances?r.instances:o.instances,g=r.connections?r.connections:o.connections,p=e.is(r.onComplete,"function")?r.onComplete:null,C=e.is(r.onFailure,"function")?r.onFailure:null,h=e.is(r.onTimeout,"function")?r.onTimeout:null,v=!e.is(r.silentMode,"boolean")||r.silentMode,P=e.is(r.context)?r.context:this,F=function(e,n){var t=f.add(e,{silent:v,merge:!0,parse:!0});s.instancesAndReferences.push.apply(s.instancesAndReferences,t),n()},I=function(n,t){n.forEach(function(n){var t,i=n.attributesValue||n;(function n(t,i){var r,s,a;if(i===t)return!0;if(a=o.getReferenceFromCollection(i),e.is(a))for(r=o.getParentInstancesFromCollection(a.get("PID")),s=0;s<r.length;s++)if(n(t,r[s].get("isAggregatedBy")))return!0;return!1})(i.isInstanceOf,i.isAggregatedBy)||(t=m.add(n,{silent:v,merge:!0,parse:!0}),s.instancesAndReferences.push(t))}),t()},D=function(n,t){var i;n.forEach(function(n){i=o.getInstanceFromCollection(n),e.is(i)&&o.removeInstance(n,{silent:v})}),t()},y=function(n,t){var i;n.forEach(function(n){i=o.getConnectionFromCollection(n),e.is(i)&&o.removeConnection(n)}),t()},R=function(){e.is(p,"function")?p.call(P,s):e.is(C,"function")?C.call(P):e.is(h,"function")&&h.call(P)};(t={callback:function(e,n){var t=g.add(e,{silent:v,merge:!0,parse:!0});s.connections.push.apply(s.connections,t),n()},globalArray:l,context:g},i.getExecuteByBlockPromise(t)).then(function(){var e;(e={callback:F,globalArray:a,context:f},i.getExecuteByBlockPromise(e)).then(function(){var e;(e={callback:I,globalArray:c,context:m},i.getExecuteByBlockPromise(e)).then(function(){var e;(e={callback:D,globalArray:u,context:m},i.getExecuteByBlockPromise(e)).then(function(){var e;(e={callback:y,globalArray:d,context:g},i.getExecuteByBlockPromise(e)).then(R)})})})})},getFilteredInstancesFromCollection:function(n,t){var o;return o=this.getInstancesFromCollection(n),e.is(t)&&(o=o.filter(function(n){var o=!1,i=n.getAdditionalInfo("filterQuery");return e.is(i)&&(o=e.equals(i,t)),o})),o},traverseInstanceModels:function(n,t){var i,r,s=function(e,n){o.getInstancesFromCollection(e).forEach(function(e){n.push(e)})};if(e.is(t,"function"))for(s(n,i=[]);i.length>0;)t(r=i.pop()),s(r.get("isInstanceOf"),i);else f.log(this.name,"callback cbProcessModel not provided")},removeFilterFromCollection:function(n){o.traverseInstanceModels(n,function(n){var t=n.getAdditionalInfo("filterQuery");e.is(t)&&n.setAdditionalInfo({filterQuery:null})})},transformToRIROccurrencePath:function(n){var t,i,r=[],s=[];return Array.isArray(n)?(r=n).length>0&&(i=o.getInstanceFromCollection(r[0]),e.is(i)&&(t=i.get("isAggregatedBy"))):t=n,s=e.is(t)?[t]:[],r.forEach(function(n){s.push(n),i=o.getInstanceFromCollection(n),e.is(i)&&s.push(i.get("isInstanceOf"))}),s},transformRIRToAbsolutePath:function(e){var n,t=[];for(n=0;n<e.length;n++)n%2==1&&t.push(e[n].resourceid);return t},syncChangeRequired:function(n,t,o,i){var r=[];n.forEach(function(e){r.push("pid:"+e.id)}),d.webServiceRequest({url:"modeler/change/changecontrol",method:"PUT",headers:t,context:this,data:e.Json.encode({ObjectsListForSetChangeControl:r}),onComplete:function(e){o(e)},onFailure:function(){i()}})},syncMaturity:function(n,i,r,s,a){var c=[];n.forEach(function(e){c.push({id:e.id,identifier:e.id,type:e.get("type"),source:"3DSpace",relativePath:"/resources/v1/modeler/dsmfg/dsmfg:MfgItem/"+e.id,nextState:"RELEASED"})}),d.webServiceRequest({url:"v1/modeler/dslc/maturity/changeState",method:"POST",headers:i,context:this,data:e.Json.encode({data:c}),onComplete:function(e){r&&g.isChangeRequiredSyncronizationEnabled()?new t(function(e,t){o.syncChangeRequired(n,i,e,t)}).then(function(){s(e)}):s(e)},onFailure:function(){a()}})},getCurrentStates:function(n,t,o){var i=[];n.forEach(function(e){i.push({id:e})}),d.webServiceRequest({url:"v1/modeler/dslc/maturity/getNextStates",method:"POST",headers:t,context:this,data:e.Json.encode({data:i}),onComplete:function(n){var t=new Map;e.is(n)&&e.is(n.data,"array")?(n.data.forEach(function(e){t.set(e.id,e.maturityState)}),o(t)):o(null)}})},getSequencingMode:function(n,t){d.webServiceRequest({url:"dsmfg/private/V0/invoke/getSequencingMode?pid="+n,method:"GET",context:this,onComplete:function(i){var r;e.is(i)&&e.is(i,"object")&&e.is(i.mode,"string")?(r=o.references.get(n),e.is(r)&&r.set("V_SequencingMode",i.mode),e.is(t.onComplete,"function")&&t.onComplete(i.mode)):e.is(t.onFailure,"function")&&t.onFailure()},onFailure:function(){e.is(t.onFailure,"function")&&t.onFailure()},onTimeout:function(){e.is(t.onTimeout,"function")&&t.onTimeout()}})},setSequencingMode:function(n,t,i){d.webServiceRequest({url:"dsmfg/private/V0/invoke/setSequencingMode",method:"PUT",data:e.Json.encode({pid:n,mode:t}),context:this,onComplete:function(){var r,s,a,c,l,u;if(r=o.references.get(n),e.is(r)&&r.set("V_SequencingMode",t),s=o.getInstancesFromCollection(n),(a=s.map(function(e){return e.get("PID")})).length>0)if("Linear"===t)for(c of(o.findSomeConnection(function(e){return"DELLmiTimeConstraintCnx"===e.get("type")&&a.includes(e.getAttribute("from"))}).forEach(function(e){o.removeConnection(e.get("PID"))}),o.sortInstancesByTreeOrder(s),s.map(function(e){return e.get("PID")})))e.is(u)?(l=u,u=c,o.addLinearProductFlow(l,u)):u=c;else o.findSomeConnection(function(e){return"LinearProductFlowCnx"===e.get("type")&&a.includes(e.getAttribute("from"))}).forEach(function(e){o.removeConnection(e.get("PID"))});e.is(i.onComplete,"function")&&i.onComplete()},onFailure:function(){e.is(i.onFailure,"function")&&i.onFailure()},onTimeout:function(){e.is(i.onTimeout,"function")&&i.onTimeout()}})},getProductionPlanRefRelationPID:function(e,n){return"ProductionPlanLink|"+e+"|"+n},addProductionPlanRefRelationFromPID:function(e,n){o.addConn({PID:this.getProductionPlanRefRelationPID(e,n),from:[e],to:[n],type:"ProductionPlanLink"},{silent:!0})},getAssignedWorkCenterRelationPID:function(e,n){return"AssignedWorkCenterLink|"+e+"|"+n},addAssignedWorkCenterRelationFromPID:function(e,n){o.addConn({PID:this.getAssignedWorkCenterRelationPID(e,n),from:[e],to:[n],type:"AssignedWorkCenterLink"},{silent:!0})},getItemRefRelationPID:function(e,n){return"PartialProductImplementLink|"+e+"|"+n},addItemRefRelationFromPID:function(e,n){o.addConn({PID:this.getItemRefRelationPID(e,n),from:[e],to:[n],type:"PartialProductImplementLink"},{silent:!0})},getAssetContextRelationPID:function(e,n){return"AssetContextLink|"+e+"|"+n},addAssetContextRelationFromPID:function(e,n){o.addConn({PID:this.getAssetContextRelationPID(e,n),from:[e],to:[n],type:"AssetContextLink"},{silent:!0})},getSerializedRelationOpPID:function(e,n){return"DELIsSerializedFromOp|"+e+"|"+n},addSerializedRelationOpFromPID:function(e,n){o.addConn({PID:this.getSerializedRelationOpPID(e,n),from:[e],to:[n],type:"DELIsSerializedFromOp"},{silent:!0})},getSerializedRelationPID:function(e,n){return"DELIsSerializedFrom|"+e+"|"+n},addSerializedRelationFromPID:function(e,n){o.addConn({PID:this.getSerializedRelationPID(e,n),from:[e],to:[n],type:"DELIsSerializedFrom"},{silent:!0})},getExecTimeConstraintRelationPID:function(e,n){return"DELLmiExecTimeConstraintRelation|"+e+"|"+n},addExecTimeConstraintRelation:function(e){var n=e["from.physicalid"].value,t=e["to.physicalid"].value;null!=e.interfaceforkind?o.addConn({PID:e.physicalid.value,from:[n],to:[t],type:"DELLmiExecTimeConstraintRelation",kind:e.interfaceforkind.value},{silent:!0}):o.addConn({PID:e.physicalid.value,from:[n],to:[t],type:"DELLmiExecTimeConstraintRelation"},{silent:!0})},addExecTimeConstraintRelationFromPID:function(e,n,t){null!=t?o.addConn({PID:this.getExecTimeConstraintRelationPID(e,n),from:[e],to:[n],type:"DELLmiExecTimeConstraintRelation",kind:t}):o.addConn({PID:this.getExecTimeConstraintRelationPID(e,n),from:[e],to:[n],type:"DELLmiExecTimeConstraintRelation"})},getLinearProductFlowPID:function(e,n){return"LinearProductFlowCnx|"+e+"|"+n},getLinearProductFlowFromCollection:function(e,n){return o.getConnectionFromCollection(o.getLinearProductFlowPID(e,n))},addLinearProductFlow:function(e,n){o.addConn({PID:o.getLinearProductFlowPID(e,n),from:[e],to:[n],type:"LinearProductFlowCnx"})},removeLinearProductFlow:function(e,n){o.removeConnection(o.getLinearProductFlowPID(e,n))},sortInstancesByTreeOrder:function(n){n.sort(function(n,t){var o=n.get("V_TreeOrder"),i=t.get("V_TreeOrder");return(e.is(o)?o:0)-(e.is(i)?i:0)})},manageLinearProductFlowsOnCreateInstance:function(n){var t,i,r,s,a,c,l,u,d=n.get("isAggregatedBy"),f=o.references.get(d);e.is(f)&&(u=f.get("V_SequencingMode")),"Linear"===u&&(t=o.getInstancesFromCollection(d),o.sortInstancesByTreeOrder(t),i=n.get("PID"),c=(r=t.findIndex(function(e){return e.get("PID")===i}))>0,l=r<t.length-1,c&&(s=t[r-1].get("PID"),a=i,o.addLinearProductFlow(s,a)),l&&(s=i,a=t[r+1].get("PID"),o.addLinearProductFlow(s,a)),c&&l&&(s=t[r-1].get("PID"),a=t[r+1].get("PID"),o.removeLinearProductFlow(s,a)),o.findSomeConnection(function(e){return"DELLmiTimeConstraintCnx"===e.get("type")&&(e.getAttribute("from")===i||e.getAttribute("to")===i)}).forEach(function(e){o.removeConnection(e.get("PID"))}))},manageLinearProductFlowsOnDeleteInstance:function(e){var n,t,i,r,s,a,c,l=e.get("isAggregatedBy");"Linear"===o.references.get(l).get("V_SequencingMode")&&(n=o.getInstancesFromCollection(l),o.sortInstancesByTreeOrder(n),t=e.get("PID"),a=(i=n.findIndex(function(e){return e.get("PID")===t}))>0,c=i<n.length-1,a&&(r=n[i-1].get("PID"),s=t,o.removeLinearProductFlow(r,s)),c&&(r=t,s=n[i+1].get("PID"),o.removeLinearProductFlow(r,s)),a&&c&&(r=n[i-1].get("PID"),s=n[i+1].get("PID"),o.addLinearProductFlow(r,s)))},federatedSearch:function(n,t,o){var i=e.merge(e.clone({}),{label:"federatedSearch"+Date.now(),with_indexing_date:!0,with_synthesis:!0,with_nls:!1,locale:"en",select_predicate:n,refine:{},order_by:"desc",start:0,nresults:200,order_field:"relevance",source:["3dspace"],tenant:window.widget.getValue("x3dPlatformId")?window.widget.getValue("x3dPlatformId"):"OnPremise",login:{"3dspace":{SecurityContext:d.getSecurityContext()}}});e.extend(i,{query:t});var r={url:d.get3DSearchUrl()+"/search",method:"POST",data:JSON.stringify(i),headers:d.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),onComplete:function(n){e.is(o)&&o.onComplete.call(null,n)},onFailure:function(n){e.is(o)&&o.onFailure.call(null,n)}};r.headers.Accept="application/json",r.headers["Content-Type"]="application/json",d.webServiceRequest(r)}})}),define("DS/DELWKOModelServices/DELWKOSocketServices",["UWA/Core","UWA/Class","DS/Logger/Logger","DS/DELPPWWebServices_FD02/WebserviceUtils"],function(e,n,t,o){"use strict";var i=n.singleton({_name:"DELWKOSocketServices",_logger:t.getLogger(i),_socket:null,init:function(e,n){var t=widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise",i=o.getServiceUrl("3dmfgworkplan"),r=(i=i.replace("https","wss"))+"wom/live/"+t;this.socket=new WebSocket(r)},getSocket:function(e){return this.socket.onmessage=e.onMessage,this.socket.onerror=e.onerror,this.socket}});return i}),define("DS/DELWKOModelServices/DELWKOCollectionUtilsCloud",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/DELPPWModelServices_FD02/CollectionUtils","DS/DELPPWModelServices_FD02/ModelUtils","DS/DELWKOIRPCCollections/DELWKOReferenceCollection","DS/DELWKOIRPCCollections/DELWKOInstanceCollection","DS/DELWKOIRPCCollections/DELWKOConnectionCollection","DS/DELPPWDocumentModel_FD02/DocumentCollection","DS/DELPPWIRPCModel_FD02/Model/ReferenceModel","DS/DELPPWIRPCModel_FD02/Model/InstanceModel","DS/DELPPWWebServices_FD02/WebserviceUtils","DS/DELPPWLoggerModel_FD02/LoggerUtils","DS/PlatformAPI/PlatformAPI","DS/DELPPWModelServices_FD02/BehaviorUtil","DS/DELWKONavigationServices/DELWKONavigateUtil","DS/DELWKOIRPCModels/DELWKOWorkOrderReferenceModel","DS/DELWKOIRPCModels/DELWKOExecHeaderOperationReferenceModel","DS/DELWKOIRPCModels/DELWKOProductionPlanReferenceModel","text!DS/DELWKOModelServices/assets/json/DELWKOPayloads.json"],function(e,n,t,o,i,r,s,a,c,l,u,d,f,m,g,p,C,h,v,P){"use strict";return n.singleton({name:"DELWKOCollectionUtilsCloud",_init:function(e){},init:function(n){(n=n||{}).references=new r,n.instances=new s,n.connections=new a,e.is(o.references)||o.init(n)},reset:function(n){var t,i=n||{},r=!e.is(i.silent,"boolean")||i.silent;e.is(o.references)&&(t=o.references.reset({},{silent:r}),e.is(t)&&o.references.remove(t,{silent:r})),e.is(o.instances)&&(t=o.instances.reset({},{silent:r}),e.is(t)&&o.instances.remove(t,{silent:r})),e.is(o.connections)&&(t=o.connections.reset({},{silent:r}),e.is(t)&&o.connections.remove(t,{silent:r})),e.is(o.documents)&&(t=o.documents.reset({},{silent:r}),e.is(t)&&o.documents.remove(t,{silent:r}))},setReferenceCollectionEvents:function(e){o.references.addEvents(e)},setConnectionsCollectionEvents:function(e){o.connections.addEvents(e)},setInstanceCollectionEvents:function(e){o.instances.addEvents(e)},setDocumentCollectionEvents:function(e){o.documents.addEvents(e)},removeCollectionEvents:function(){o.references.removeEvents(),o.connections.removeEvents(),o.instances.removeEvents()},removeDocumentCollectionEvents:function(){o.documents.removeEvents()},updateModel:function(n,t){var o=this;(t=t||{}).onCompleteMsg=e.is(t.onCompleteMsg)?t.onCompleteMsg:"Updated Model succesfully",t.onFailureMsg=e.is(t.onFailureMsg)?t.onFailureMsg:"Updating Model failed",e.is(t.forceUpdate)||(t.data.revision=n.get("revision")),n.save(null,{proxy:"passport",headers:d.getHeaders(),data:e.Json.encode(t.data),forceUpdate:t.forceUpdate,onComplete:function(n,i){f.debug(o.name,t.onCompleteMsg+" : %s",JSON.stringify(n)),e.is(t.isFacet)&&t.isFacet&&m.publish("DS/PADUtils/PADCommandProxy/refresh",{data:{authored:{modified:[n.id]}}}),e.is(t.onComplete,"function")&&t.onComplete.call(null,n,i)},onFailure:function(i,r){e.is(r)&&e.is(r.message)&&r.message.includes("revision")?(f.debug(o.name,r.message),e.is(t.onRevisionFailure,"function")&&t.onRevisionFailure.call(null,r)):(f.debug(o.name,t.onFailureMsg+" : %s",JSON.stringify(n)),e.is(t.onFailure,"function")&&t.onFailure.call(null,n))},wait:!0,parse:!0})},updateModel_v2:function(n,t){(t=t||{}).onCompleteMsg=e.is(t.onCompleteMsg)?t.onCompleteMsg:"Updated Model succesfully",t.onFailureMsg=e.is(t.onFailureMsg)?t.onFailureMsg:"Updating Model failed",e.is(t.forceUpdate)||(t.data.revision=n.get("revision"));var o=Object.keys(t.data)[0],i=t.data[o];n.set(o,i,{silent:!1})},massUpdateModels:function(n,t,i){var r=this;(i=i||{}).onCompleteMsg=e.is(i.onCompleteMsg)?i.onCompleteMsg:"MassUpdate: Model has been updated successfully",i.onFailureMsg=e.is(i.onFailureMsg)?i.onFailureMsg:"MassUpdate has failed",e.is(i.data)||e.is(i.data.keyValues)&&e.is(i.data.pids,"array")||(f.debug(r.name,i.onFailureMsg+" as keyValues or pids have not been provided"),!e.is(i.onFailure,"function"))?d.webServiceRequest({url:"dsmfg/private/V0/MfgElement/"+n,method:"PUT",data:e.Json.encode(i.data),onComplete:function(s){var a;s.forEach(function(s){s=s.attributesValue,a="instance"===n?o.instances.get(s.PID):o.references.get(s.PID),e.owns(a._attributes,t)&&(a.set(t,s[t]),f.debug(r.name,i.onCompleteMsg+": %o",a))}),e.is(i.onComplete,"function")&&i.onComplete.call(null,s)},onFailure:function(){f.debug(r.name,i.onFailureMsg),e.is(i.onFailure,"function")&&i.onFailure.call(null)}}):i.onFailure.call(null)},fetch:function(n,t){var o,i,r,s=this;e.is(n)?(t=t||{},i=!!e.is(t.silent,"boolean")&&t.silent,r=!e.is(t.parse,"boolean")||t.parse,o={proxy:"passport",type:"json",headers:d.getHeaders(),onComplete:function(n,o,i){f.debug(s.name,"fetch completed: %o",o),e.is(t.onComplete,"function")&&t.onComplete.apply(null,[n,i])},onFailure:function(n,o,i){var r=e.is(o)?e.Json.isJson(o)?e.Json.decode(o):o:{};f.debug(s.name,"fetch failed with error: %o",r),e.is(t.onFailure,"function")&&t.onFailure.apply(null,[r,i])},onTimeout:function(n,o,i){var r=e.is(o)?e.Json.isJson(o)?e.Json.decode(o):o:{};f.debug(s.name,"fetch timed out with error: %o",r),e.is(t.onTimeout,"function")&&t.onTimeout.apply(null,[r,i])},parse:r,silent:i},n.fetch(o)):f.debug(s.name,"Invalid model object to fetch.")},getProductionPlanAttributesOnCloud:function(e,n){return Array.isArray(e)||n.onFailure(null),new t(function(t,o){var i={url:d.getServiceUrl("orderdatamgmt")+"resources/v1/modeler/dswo/productionplan/"+e[0],method:"GET",headers:{},onComplete:function(e){n.onComplete(e),t()},onFailure:function(e){n.onFailure(e),o()}};d.webServiceRequest(i)})},getAttributesFromReference:function(n,t){var o={url:n.url(),method:"GET",headers:n.getHeaders(),onComplete:function(n){e.is(t)&&e.is(t.onComplete,"function")&&t.onComplete(n)},onFailure:function(n){e.is(t)&&e.is(t.onFailure,"function")&&t.onFailure(n)}};d.webServiceRequest(o)},getAttributesOnCloud:function(n,o){return Array.isArray(n)||o.onFailure(null),new t(function(t,i){var r={url:d.get3DSpaceUrl()+"resources/dsmfg/V0/WKO/getAttributes",method:"POST",data:e.Json.encode(n),headers:d.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),onComplete:function(n){e.is(o)&&e.is(o.onComplete,"function")&&o.onComplete(n),t()},onFailure:function(n){e.is(o)&&e.is(o.onFailure,"function")&&o.onFailure(n),i()}};d.webServiceRequest(r)})},getAttributes:function(n,t){Array.isArray(n)||t.onFailure(null);var o={url:d.get3DSpaceUrl()+"resources/dsmfg/V0/getAttributes",method:"POST",data:e.Json.encode(n),headers:d.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),onComplete:function(n){e.is(t)&&e.is(t.onComplete,"function")&&t.onComplete(n)},onFailure:function(n){e.is(t)&&e.is(t.onFailure,"function")&&t.onFailure(n)}};d.webServiceRequest(o)},getUnitDetails:function(n,t){var o=this,i=t||{},r=(!!e.is(i.silent,"boolean")&&i.silent,d.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}));e.is(i.securityContextOverride,"string")&&(r.SecurityContext=i.securityContextOverride);var s={url:d.get3DSpaceUrl()+"resources/v1/modeler/dspfl/dspfl:Unit/"+n,method:"GET",headers:r,onComplete:function(n){e.is(t.onComplete,"function")&&t.onComplete.call(null,n)},onFailure:function(n,t){var r=e.is(t)?e.Json.isJson(t)?e.Json.decode(t):t:{};f.debug(o.name,"Get Unit details failed: %o",n),e.is(i.onFailure,"function")&&i.onFailure.call(null,n,r.error)}};d.webServiceRequest(s)},getInstances:function(n,t){Array.isArray(n)||t.onFailure(null);var o={url:d.get3DSpaceUrl()+"resources/dsmfg/V0/whereUsed",method:"POST",data:e.Json.encode(n),headers:d.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),onComplete:function(n){e.is(t)&&e.is(t.onComplete,"function")&&t.onComplete(n)},onFailure:function(n){e.is(t)&&e.is(t.onFailure,"function")&&t.onFailure(n)}};d.webServiceRequest(o)},getInstancesWithPromise:function(e){var n=this;return new t(function(t,o){n.getInstances(e,{onComplete:function(e){t(e)},onFailure:function(e){o(e)}})})},getWorkOrderFromProductionPlan:function(n,o){var i=this;return new t(function(r,s){var a=[];n.forEach(e=>{var n=[],r=new t(function(t,r){i.getWorkOrderFromProductionPlanOnCloud(e,o,0,t,r,n)});a.push(r)}),e.Promise.all(a).then(function(e){r(e)})})},getWorkOrderFromProductionPlanOnCloud:function(n,t,o,i,r,s){var a=this,c={url:e.is(t)?d.getServiceUrl("orderdatamgmt")+"resources/v1/modeler/dswo/workorder?productionPlanId="+n+"&state="+t+"&$skip="+o+"&mask=detailed_structure":d.getServiceUrl("orderdatamgmt")+"resources/v1/modeler/dswo/workorder?productionPlanId="+n+"&$skip="+o+"&mask=detailed_structure",method:"GET",headers:{},onComplete:function(e){s.push(e),!0===e.last?i(s):(o=parseInt(o),o+=50,a.getWorkOrderFromProductionPlanOnCloud(n,t,o,i,r,s))},onFailure:function(e){r()}};d.webServiceRequest(c)},getProductionPlan:function(e){var n=this;return new t(function(e,t){n.getProductionPlanOnCloud(0,e,t,[])})},getProductionPlanOnCloud:function(e,n,t,o){var i=this,r={url:d.getServiceUrl("orderdatamgmt")+"resources/v1/modeler/dswo/productionplan?page="+e,method:"GET",headers:{},onComplete:function(r){o.push(r),!0===r.last?n(o):(e=parseInt(e),e++,i.getProductionPlanOnCloud(e,n,t,o))},onFailure:function(e){t()}};d.webServiceRequest(r)},createWorkOrderFromProcessOnCloud:function(n,t){var i=this,r=t||{},s=(!!e.is(r.silent,"boolean")&&r.silent,{SecurityContext:d.getSecurityContext(),"Content-Type":"application/json","x-requested-with":"XMLHttpRequest"}),a=e.Json.decode(P).createWorkOrderFromProcessOnCloud;void 0===n["PLMEntity.V_Name"]||""===n["PLMEntity.V_Name"]?delete a[0].name:a[0].name=n["PLMEntity.V_Name"],a[0].productionPlanId=n["DELLmiProductionPlanReference.ProductionPlan"],a[0]["dsprcs:MfgProcess"].source="3DSpace",a[0]["dsprcs:MfgProcess"].identifier=n["DELLmiWorkPlanSystemReference.MfgProcess"],a[0]["dsprcs:MfgProcess"].relativePath="/resources/v1/modeler/dsprcs/dsprcs:MfgProcess/"+n["DELLmiWorkPlanSystemReference.MfgProcess"],a[0]["dsmfg:MfgItem"].source="3DSpace",a[0]["dsmfg:MfgItem"].identifier=n["DELFmiFunctionReference.MfgItem"],a[0]["dsmfg:MfgItem"].relativePath="/resources/v1/modeler/dsmfg/dsmfg:MfgItem/"+n["DELFmiFunctionReference.MfgItem"],void 0===n["Builds.Builds"]||""===n["Builds.Builds"]?delete a[0].build:(a[0].build.identifier=n["Builds.Builds"],a[0].build.relativePath=n["Builds.Builds"],a[0].build.source="3DSpace"),"EACH"===n.Magnitude?a[0].orderQuantity=parseInt(n.OrderQuantity):a[0].orderQuantity=parseFloat(n.OrderQuantity),a[0].magnitude=n.Magnitude,"EACH"!=n.Magnitude&&(a[0].unit=n.UoM);var c=JSON.stringify(a),l={url:d.getServiceUrl("orderdatamgmt")+"resources/v1/modeler/dswo/workorder/fromprocess?$mask=detailed_structure",method:"POST",headers:s,data:c,onComplete:function(n){i.data=n;for(var t=[],s=i.data,a=s.length,c=0;c<a;c++){var l=s[c];if(null!=l){l.type="DELLmiWorkOrderReference",t.push(l);var u=[];e.is(l.productionPlanId)&&u.push(l.productionPlanId);var d=[],f=[],m=[],g=[];e.is(l.serializedFrom)&&m.push(l.serializedFrom.identifier),e.is(l.itemRef)&&f.push(l.itemRef.identifier),e.is(l.assetContext)&&g.push(l.assetContext.identifier),e.is(l.build)&&d.push(l.build.identifier);var p=[],h=new C({id:l.id});if(e.is(u)&&u.length>0){var P=i.getProductionPlanAttributesOnCloud(u,{onComplete:function(n){var i=new v({id:l.productionPlanId});e.is(l.productionPlanId)&&o.addConn({PID:h.get("PID")+i.get("PID"),from:i.get("PID"),to:h.get("PID"),type:"ProductionPlanLink"},{silent:!0});var r=n;r.type="DELLmiProductionPlanReference",t.push(r)}});p.push(P)}if(e.is(d)&&d.length>0){P=i.getAttributesOnCloud(d,{onComplete:function(n){e.is(l.build)&&o.addConn({PID:h.get("PID")+l.build.identifier,from:h.get("PID"),to:l.build.identifier,type:"DELIsGeneratedFromProcessFilteredBy"},{silent:!0});for(var i=n.items,r=i.length,s=0;s<r;s++){var a=i[s].attributes;a.type=i[s].type,a.id=i[s].physicalid,t.push(a)}}});p.push(P)}if(e.is(g)&&g.length>0){P=i.getAttributesOnCloud(g,{onComplete:function(n){e.is(l.assetContext)&&o.addConn({PID:h.get("PID")+l.assetContext.identifier,from:h.get("PID"),to:l.assetContext.identifier,type:"AssetContextLink"},{silent:!0});for(var i=n.items,r=i.length,s=0;s<r;s++){var a=i[s].attributes;a.type=i[s].type,a.id=i[s].physicalid,t.push(a)}}});p.push(P)}if(e.is(f)&&f.length>0){P=i.getAttributesOnCloud(f,{onComplete:function(n){e.is(l.itemRef)&&o.addConn({PID:h.get("PID")+l.itemRef.identifier,from:h.get("PID"),to:l.itemRef.identifier,type:"PartialProductImplementLink"},{silent:!0});for(var i=n.items,r=i.length,s=0;s<r;s++){var a=i[s].attributes;a.type=i[s].type,a.id=i[s].physicalid,t.push(a)}}});p.push(P)}if(e.is(m)&&m.length>0){P=i.getAttributesOnCloud(m,{onComplete:function(n){e.is(l.serializedFrom)&&o.addConn({PID:h.get("PID")+l.serializedFrom.identifier,from:h.get("PID"),to:l.serializedFrom.identifier,type:"DELIsSerializedFrom"},{silent:!0});for(var i=n.items,r=i.length,s=0;s<r;s++){var a=i[s].attributes;a.type=i[s].type,a.id=i[s].physicalid,t.push(a)}}});p.push(P)}e.Promise.all(p).then(function(){var e={stackedReferences:t,onComplete:r.onComplete,onFailure:r.onFailure,silentMode:!1};i.addToCollections(e)})}}},onFailure:function(n,t){var o=e.is(t)?e.Json.isJson(t)?e.Json.decode(t):t:{};f.debug(i.name,"Creation failed: %o",n),e.is(r.onFailure,"function")&&r.onFailure.call(null,n,o.error)}};d.webServiceRequest(l)},addChildInfo:function(e,n){o.instances.addChildInfo(e,n)},addRefInfo:function(e,n){o.instances.addRefInfo(e,n)},fetchRef_v2:function(e,n){return new t(function(t,i){o.fetchRef(e,{silent:n,onComplete:function(e){t(e)},onFailure:function(e){i(e)}})})},fetchInst_v2:function(e){return new t(function(n,t){o.fetchInst(e,{silent:!0,onComplete:function(e){n(e)},onFailure:function(e){t(e)}})})},createRef:function(n,t){var i,r=this,s=n||{},a=t||{},c=!!e.is(a.silent,"boolean")&&a.silent,l=d.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0});return e.is(a.securityContextOverride,"string")&&(l.SecurityContext=a.securityContextOverride),i={proxy:"passport",headers:l,data:e.Json.encode(s),onComplete:function(n){e.is(a.onComplete,"function")&&a.onComplete.call(null,n)},onFailure:function(n,t){var o=e.is(t)?e.Json.isJson(t)?e.Json.decode(t):t:{};f.debug(r.name,"Creation failed: %o",n),e.is(a.onFailure,"function")&&a.onFailure.call(null,n,o.error)},silent:c,wait:!0,parse:!0},o.references.create(null,i)},fetchReferences:function(n,t){var i,r,s,a,c=this;t=t||{},r=!e.is(t.silent,"boolean")||t.silent,s=!e.is(t.parse,"boolean")||t.parse,a=!!e.is(t.remove,"boolean")&&t.remove,i={data:n,proxy:"passport",headers:d.getHeaders(),onComplete:function(n,o,i){var r=[];f.debug(c.name,"fetch references completed: %o",o),e.is(o,"array")&&o.forEach(function(e){r.push(n.get(e.PID))}),e.is(t.onComplete,"function")&&t.onComplete.apply(null,[r,i])},onFailure:function(n,o,i){var r=e.is(o)?e.Json.isJson(o)?e.Json.decode(o):o:{};f.debug(c.name,"fetch references failed with error: %o",r),e.is(t.onFailure,"function")&&t.onFailure.apply(null,[r,i])},wait:!0,parse:s,silent:r,remove:a},o.references.fetch(i)},addRef:function(n,t){var i,r=t||{};return n&&(r=e.merge(r,{merge:!0,parse:!0}),i=o.references.add(n,r)),i},getDescendantsOnCloud:function(n,o){var i=this;return new t(function(t,r){var s=[],a=i.fetchRefFromInstOnCloud(n,o);s.push(a),e.Promise.all(s).then(function(n){if(Array.isArray(n)&&n.length>0){var r=[];n.forEach(e=>{var n={forceDBMode:!0,expandLevel:0,withLinks:!0},t=i.getDescendantsFromServer([e.instance.physicalid,e.reference.physicalid],n);r.push(t)}),e.Promise.all(r).then(function(n){e.is(o)&&e.is(o.onComplete,"function")&&o.onComplete(n),t()})}})})},getDescendantsFromServer:function(e,n){return new t(function(t,o){p.getDescendantsFromServer(e,function(e){t(e)},n)})},fetchRefFromInstOnCloud:function(n,o){var i=this;return new t(function(t,o){i.getAttributesOnCloud(n,{onComplete:function(n){var r=n.items[0].attributes;r.isAggregatedBy=n.items[0].isAggregatedBy,r.isInstanceOf=n.items[0].isInstanceOf,r.type=n.items[0].type,r.physicalid=n.items[0].physicalid,e.is(r.isInstanceOf)&&i.getAttributesOnCloud([r.isInstanceOf],{onComplete:function(e){var n=e.items[0].attributes;n.type=e.items[0].type,n.physicalid=e.items[0].physicalid,t({instance:r,reference:n})},onFailure:function(){o()}})},onFailure:function(){o()}})})},fetchRefOnCloud:function(n,i){var r=this,s=void 0,a=n.type;return e.is(a)&&"DELLmiWorkOrderReference"===a?s=new C(n):e.is(a)&&"DELLmiExecHeaderOperationReference"===a?s=new h(n):e.is(a)&&"DELLmiProductionPlanReference"===a?s=new v(n):null!=e.is(a)&&(s=new l(n)),new t(function(e,t){s.fetch({proxy:"passport",headers:d.getHeaders(),onComplete:function(t){t._attributes.type=n.type,f.debug(r.name,"Fetch completed: %o",t),o.references.add(t,{silent:!0,merge:!0}),e(t)},onFailure:function(e){f.debug(r.name,"Fetch failed: %o",e),t()},wait:!0,parse:!0})})},fetchRef:function(n,t){var i=this,r=new l(n);return r.fetch({proxy:"passport",headers:d.getHeaders(),onComplete:function(n){f.debug(i.name,"Fetch completed: %o",n),(!e.is(t.add)||e.is(t.add)&&!0===t.add)&&o.references.add(n,{silent:!!e.is(t.silent)&&t.silent,merge:!0}),e.is(t.onComplete,"function")&&t.onComplete.call(null,n)},onFailure:function(n){f.debug(i.name,"Fetch failed: %o",n),e.is(t.onFailure,"function")&&t.onFailure.call(null,n)},wait:!0,parse:!0}),r},fetchRefList:function(n,t){var i=this,r=[],s=[];if(n.forEach(e=>{new RegExp("[0-9A-F]{32}").test(e)?r.push(e):s.push(e)}),r.length>0){var a,c=[];a={url:"dsmfg/private/V0/MfgElement/reference/getReferences",method:"POST",data:e.Json.encode(r),options:t,onComplete:function(e){c=e.references.map(function(e){return e.attributesValue}),a={stackedReferences:c,onComplete:t.onComplete,onFailure:t.onFailure},o.addToCollections(a)},onFailure:function(n){e.is(t.onFailure,"function")&&t.onFailure.call(n)}},d.webServiceRequest(a)}if(s.length>0){var l=[],u=i.getProductionPlan();l.push(u),e.Promise.all(l).then(function(n){n.length;n.forEach(n=>{var o=[];n.forEach(e=>{e.content.forEach(e=>{o.push(e.id)})});var r=[];r.push(i.getWorkOrderFromProductionPlan(o)),e.Promise.all(r).then(function(n){var o=[],r=[],a=[];n.forEach(n=>{n.forEach(n=>{n.forEach(n=>{n.content.forEach(n=>{var a=new C({id:n.id});if(s.includes(a.get("PID"))){if(e.is(n.serializedFrom)){var c=i.getAttributesOnCloud([n.serializedFrom.identifier],{onComplete:function(t){e.is(n.serializedFrom)&&i.addConn({PID:a.get("PID")+n.serializedFrom.identifier,from:a.get("PID"),to:n.serializedFrom.identifier,type:"DELIsSerializedFrom"},{silent:!0});for(var o=t.items,r=o.length,s=0;s<r;s++){var c=o[s].attributes;c.type=o[s].type,i.addRef(c,{silent:!1})}}});o.push(c)}if(e.is(n.productionPlanId)){c=i.getProductionPlanAttributesOnCloud([n.productionPlanId],{onComplete:function(t){t.id=n.productionPlanId,t.type="DELLmiProductionPlanReference";var o=new v(t);e.is(n.productionPlanId)&&i.addConn({PID:a.get("PID")+o.get("PID"),from:o.get("PID"),to:a.get("PID"),type:"ProductionPlanLink"},{silent:!0}),i.addRef(t,{silent:!0})}});o.push(c)}if(e.is(t)&&!0===t.withLinksResolved&&e.is(n.itemRef)){c=i.getAttributesOnCloud([n.itemRef.identifier],{onComplete:function(t){e.is(n.itemRef)&&i.addConn({PID:a.get("PID")+n.itemRef.identifier,from:a.get("PID"),to:n.itemRef.identifier,type:"PartialProductImplementLink"},{silent:!0});for(var o=t.items,r=o.length,s=0;s<r;s++){var c=o[s].attributes;c.physicalid=o[s].physicalid,c.type=o[s].type,i.addRef(c,{silent:!1})}}});o.push(c)}if(e.is(n.build)){c=i.getAttributesOnCloud([n.build.identifier],{onComplete:function(t){e.is(n.build)&&i.addConn({PID:a.get("PID")+n.build.identifier,from:a.get("PID"),to:n.build.identifier,type:"DELIsGeneratedFromProcessFilteredBy"},{silent:!0});for(var o=t.items,r=o.length,s=0;s<r;s++){var c=o[s].attributes;c.physicalid=o[s].physicalid,c.type=o[s].type,i.addRef(c,{silent:!1})}}});o.push(c)}if(e.is(n.assetContext)){c=i.getAttributesOnCloud([n.assetContext.identifier],{onComplete:function(t){e.is(n.assetContext)&&i.addConn({PID:a.get("PID")+n.assetContext.identifier,from:a.get("PID"),to:n.assetContext.identifier,type:"AssetContextLink"},{silent:!0});for(var o=t.items,r=o.length,s=0;s<r;s++){var c=o[s].attributes;c.physicalid=o[s].physicalid,c.type=o[s].type,i.addRef(c,{silent:!1})}}});o.push(c)}n.type="DELLmiWorkOrderReference",r.push(n)}})})})}),e.Promise.all(o).then(function(e){var n={stackedReferences:r,stackedInstances:a,onComplete:t.onComplete,onFailure:t.onFailure};i.addToCollections(n)})})})})}},fetchInstancesAndTheirReferences:function(n,t){d.webServiceRequest({url:"dsmfg/private/V0/MfgElement/instance/getInstancesAndTheirReferences",method:"POST",data:e.Json.encode(n),onComplete:function(e){var n,i,r=function(e){return e.attributesValue};n=e.instances.map(r),i=e.references.map(r),o.addToCollections({stackedReferences:i,stackedInstances:n,onComplete:t.onComplete,onFailure:t.onFailure})},onFailure:function(n){e.is(t.onFailure,"function")&&t.onFailure.call(n)}})},updateRef_v2:function(n,t){var i=o.references.get(n);e.is(i)&&((t=t||{}).onCompleteMsg="Updated Reference succesfully",t.onFailureMsg="Updating Reference failed",this.updateModel_v2(i,t))},updateRef:function(n,t){var i=o.references.get(n);e.is(i)&&((t=t||{}).onCompleteMsg="Updated Reference succesfully",t.onFailureMsg="Updating Reference failed",this.updateModel(i,t))},updateRefs:function(e,n){(n=n||{}).onCompleteMsg="MassUpdate: Reference has been updated successfully",n.onFailureMsg="MassUpdate of References has failed",this.massUpdateModels("reference",e,n)},deleteRef:function(n,t){var i,r=this,s=o.references.get(n);if(t=t||{},i=!!e.is(t.deep)&&t.deep,!e.is(s))return f.debug(this.name,"Refrence does not exists"),void(e.is(t.onFailure)&&t.onFailure());s.destroy({proxy:"passport",data:e.Json.encode({deep:i}),headers:d.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),wait:!0,onFailure:function(o,i){var s=e.is(i)?i:{};f.debug(r.name,"Deleting of Refrence failed: %s with error:",n,JSON.stringify(s)),e.is(t.onFailure)&&t.onFailure(o,s)},onComplete:function(s,a){var c,l,u,d=e.is(a)?a:{},m=e.is(d.deletedObjects)?d.deletedObjects:[];if(i&&e.is(m))for(l=0;l<m.length;l++)c=m[l],u=o.instances.get(c),e.is(u)&&o.instances.remove(c),u=o.references.get(c),e.is(u)&&o.references.remove(c);f.debug(r.name,"Deleting of Refrence completed: %s ",n),e.is(t.onComplete)&&t.onComplete(s,d)}})},removeRef:function(e,n){o.references.remove(e,n)},addInst:function(n,t){if(e.is(n))return e.is(t)||(t={}),t=e.merge(t,{merge:!0,parse:!0}),o.instances.add(n,t);f.debug(this.name,"refData is not defined")},createInst:function(n,t){var r,s=this,a=n||{},c=t||{},l=!!e.is(c.silent,"boolean")&&c.silent,u=d.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0});return e.is(c.securityContextOverride,"string")&&(u.SecurityContext=c.securityContextOverride),a.oneDelmiaAggregationMode=i.getOneDelmiaAggregationMode(),r={proxy:"passport",headers:u,data:e.Json.encode(a),onComplete:function(n){o.manageLinearProductFlowsOnCreateInstance(n),e.is(c.onComplete,"function")&&c.onComplete.call(null,n)},onFailure:function(n,t){var o=e.is(t)?e.Json.isJson(t)?e.Json.decode(t):t:{};o=e.is(o.error)?o.error:o,f.debug(s.name,"Instance Creation failed: %o",n),e.is(c.onFailure,"function")&&c.onFailure.call(null,n,o)},wait:!0,parse:!0,silent:l},o.instances.create(null,r)},fetchInst:function(n,t){var o=this,i=new u(n);return e.is(t)||(t={}),i.fetch({proxy:"passport",headers:d.getHeaders(),onComplete:function(n){f.debug(o.name,"Fetch completed: %o",n),o.instances.add(n,{silent:!!e.is(t.silent)&&t.silent,merge:!0,parse:!0}),e.is(t.onComplete,"function")&&t.onComplete.call(null,n)},onFailure:function(n){f.debug(o.name,"Fetch failed: %o",n),e.is(t.onFailure,"function")&&t.onFailure.call(null,n)},wait:!0,parse:!0}),i},updateInst:function(e,n){var t=o.instances.get(e);(n=n||{}).onCompleteMsg="Updated Instance succesfully",n.onFailureMsg="Updating Instance failed",this.updateModel(t,n)},updateInsts:function(e,n){(n=n||{}).onCompleteMsg="MassUpdate: Instance has been updated successfully",n.onFailureMsg="MassUpdate of Instances has failed",this.massUpdateModels("instance",e,n)},deleteInst:function(n,t){var i=this,r=o.instances.get(n);if(t=t||{},!e.is(r))return f.debug(this.name,"Instance does not exists"),void(e.is(t.onFailure)&&t.onFailure());o.manageLinearProductFlowsOnDeleteInstance(r),r.destroy({proxy:"passport",headers:d.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),wait:!0,onFailure:function(o,r){var s=e.is(r)?e.Json.isJson(r)?e.Json.decode(r):r:{};f.debug(i.name,"Deleting of Instance failed: %s with error:",n,s),e.is(t.onFailure)&&t.onFailure(o,s.error)},onComplete:function(){f.debug(i.name,"Deleting of instance completed: %s ",n),e.is(t.onComplete)&&t.onComplete()}})},removeInstance:function(e,n){return o.instances.remove(e,n)},removeConnection:function(e,n){return o.connections.remove(e,n)},createConn:function(n,t){var i,r=this,s=d.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0,minorVersion:"2.0"});return e.is(t)||(t={}),e.is(t.securityContextOverride,"string")&&(s.SecurityContext=t.securityContextOverride,delete t.securityContextOverride),i=e.extend({proxy:"passport",headers:s,data:e.Json.encode(n),onComplete:function(n){f.debug(r.name,"Creation completed: %o",n),e.is(t.onComplete,"function")&&t.onComplete.call(null,n)},onFailure:function(n,o){var i;f.debug(r.name,"Creation failed: %o",n),e.is(o)&&e.is(o.message,"string")&&(i=o.message,f.debug(r.name,i)),e.is(t.onFailure,"function")&&t.onFailure.call(null,n,i)},wait:!0,parse:!0},t,!0),o.connections.create(null,i)},addConn:function(n,t){if(e.is(n))return e.is(t)||(t={}),t=e.merge(t,{merge:!0,parse:!0}),o.connections.add(n,t);f.debug(self.name,"connData is not defined")},updateConn:function(e,n){var t=o.connections.get(e);(n=n||{}).onCompleteMsg="Updated Connection succesfully",n.onFailureMsg="Updating Connection failed",this.updateModel(t,n)},deleteConn:function(n,t){var i=this,r=o.connections.get(n);if(t=t||{},!e.is(r))return f.debug(this.name,"Connection does not exists"),void(e.is(t.onFailure)&&t.onFailure());r.destroy({proxy:"passport",headers:d.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),wait:!0,onFailure:function(o,r){var s;f.debug(i.name,"Deleting of connection failed: %s ",n),e.is(r)&&e.is(r.message,"string")&&(s=r.message,f.debug(i.name,s)),e.is(t.onFailure)&&t.onFailure(o,r)},onComplete:function(r,s){var a;s&&(a=s.deletedConnections?s.deletedConnections:[],Array.isArray(a)&&a.length>0&&a.forEach(function(e){o.removeConnection(e)})),f.debug(i.name,"Deleting of connection completed: %s ",n),e.is(t.onComplete)&&t.onComplete(s)}})},addDocument:function(e){return o.documents.add(e)},getDocument:function(e){return o.documents.get(e)},removeDocument:function(e){return o.documents.remove(e)},getTypes:function(){return o.pprTypes},getInstancesFromCollection:function(e){return o.instances.getChildren(e)},getInstanceFromCollection:function(e){return o.instances.get(e)},isReference:function(n){return e.is(o.references.get(n))},isInstance:function(n){return e.is(o.instances.get(n))},getParentInstancesFromCollection:function(e){return o.instances.getInstancesForGivenReference(e)},getReferenceFromCollection:function(e){return o.references.get(e)},getReferencesArrayFromCollection:function(n){var t=[];return e.is(n,"array")&&n.forEach(function(n){var i=o.getReferenceFromCollection(n);e.is(i)&&t.push(i)}),t},getReferenceModel:function(n){var t,o=this.getReferenceFromCollection(n);return e.is(o)||(t=this.getInstanceFromCollection(n),e.is(t)&&(o=this.getReferenceModelFromInstance(t))),o},getConnectionFromCollection:function(e){return o.connections.get(e)},findSomeConnection:function(e,n){return o.connections.filter(e,n)},hasConnection:function(n){var t=!1,i=o.connections.findWhere(n);return e.is(i)&&(t=!0),t},findConnections:function(e){return o.connections.where(e)},getReferenceModelFromInstance:function(e){var n=e.get("isInstanceOf");return o.references.get(n)},getAggregatingReferenceModelFromInstance:function(e){var n=e.get("isAggregatedBy");return o.references.get(n)},getImpactedConnections:function(n,t,i){var r=[];return i=i||{},i=e.merge(i,{from:!0,to:!0}),r=(r=(r=r.concat(o.connections.getImpactedConnections(n,i.fromXEN,i.relationTypes))).concat(o.connections.getImpactedConnections(t,i.fromXEN,i.relationTypes))).filter(function(t){var o,r=t.get("type"),s=(t.getAttribute("to"),t.getAttribute("from"),!1);return o=function(e){s=!0,i.relationTypes?s=i.relationTypes.indexOf(e)>=0:(i.excludeRelationTypes&&(s=-1===i.excludeRelationTypes.indexOf(e)),i.excludeTimeConstraintType&&!0===i.excludeTimeConstraintType&&["DELLmiTimeConstraintCnx","DELLmiMaterialPathCnxCust","LinearProductFlowCnx","ProcessImplementLinkOcc"].indexOf(e)>-1&&(s=!1))},i.fromXEN?e.is(t.id)&&(3===t.id.split("|").length&&(r=t.id.split("|")[0]),t.get("from.attributesValue").PID===n&&o(r)):o(r),s})},needToQueryForConnections:function(n,t){var o,i=!1;return o=e.is(t,"string")?(o=n?n.get(t):this.getInstanceFromCollection(t))||this.getReferenceFromCollection(t):t,e.is(o)&&(o.getAdditionalInfo("queriedForConnections")||(i=!0)),i},_needToQueryForConnectionsByDir:function(n,t,i){var r,s,a=!1;switch(i){case o.ConnectionDir.DIRECT:s="directConnectionsFetched";break;case o.ConnectionDir.INVERSE:s="inverseConnectionsFetched";break;default:s="queriedForConnections"}return r=e.is(t,"string")?(r=n?n.get(t):this.getInstanceFromCollection(t))||this.getReferenceFromCollection(t):t,e.is(r)&&(r.getAdditionalInfo(s)||(a=!0)),a},needToQueryForDirectConnections:function(e,n){return this._needToQueryForConnectionsByDir(e,n,o.ConnectionDir.DIRECT)},needToQueryForInverseConnections:function(e,n){return this._needToQueryForConnectionsByDir(e,n,o.ConnectionDir.INVERSE)},needToQueryForChildren:function(n){var t=!1,i=e.is(n,"string")?o.references.get(n):n;return e.is(i)&&(i.getAdditionalInfo("queriedForChildren")||(t=!0)),t},refreshAll:function(n,i,r,s){var a,c,u=s||{},m=e.is(u.context)?u.context:null,g=i.concat(r,n),p=[],C=0,h=0;f.log(this.name,"refreshAll, Body roots PID: "+n),f.log(this.name,"refreshAll, Table roots PID: "+i),f.log(this.name,"refreshAll, Auxiliary view roots PID: "+r),new t(function(e){0!==g.length?g.forEach(function(n){var t,i=function(){C+h===g.length&&e()};(t=new l({PID:n})).fetch({proxy:"passport",type:"json",headers:d.getHeaders(),onComplete:function(e){C++,o.references.add(e),i()},onFailure:function(){h++,i()}}),p.push(t)}):e()}).then(function(){o.references.reset(p,{silent:!0}),a=o.instances.reset({},{silent:!0}),e.is(a)&&o.instances.remove(a,{silent:!0}),c=o.connections.reset({},{silent:!0}),e.is(c)&&o.connections.remove(c,{silent:!0}),e.is(u.onComplete,"function")&&u.onComplete.call(m,C,h)})},_removeDuplicate:function(n){return e.is(n,"array")&&(n.sort(),n=n.filter(function(e,n,t){return!n||e!==t[n-1]})),n},expandOnBackbone:function n(t,i){var r=o.getInstancesFromCollection(t),s=[];e.is(r,"array")&&e.is(i)&&r.forEach(function(n){var t=n.get("isInstanceOf");e.is(i.referencesPID,"array")&&-1===i.referencesPID.indexOf(t)&&i.referencesPID.push(t),e.is(i.instancesPID,"array")&&-1===i.instancesPID.indexOf(n.id)&&i.instancesPID.push(n.id),-1===s.indexOf(t)&&s.push(t)}),s.forEach(function(e){n(e,i)})},addToCollections:function(n){var t,r=n||{},s={instancesAndReferences:[],connections:[],documents:e.is(r.documentIdMap)?r.documentIdMap:{}},a=r.stackedReferences?r.stackedReferences:[],c=r.stackedInstances?r.stackedInstances:[],l=r.stackedConnections?r.stackedConnections:[],u=r.deletedObjects?r.deletedObjects:[],d=r.deletedConnections?r.deletedConnections:[],f=r.references?r.references:o.references,m=r.instances?r.instances:o.instances,g=r.connections?r.connections:o.connections,p=e.is(r.onComplete,"function")?r.onComplete:null,C=e.is(r.onFailure,"function")?r.onFailure:null,h=e.is(r.onTimeout,"function")?r.onTimeout:null,v=!e.is(r.silentMode,"boolean")||r.silentMode,P=e.is(r.context)?r.context:this,F=function(e,n){var t=f.add(e,{silent:v,merge:!0,parse:!0});s.instancesAndReferences.push.apply(s.instancesAndReferences,t),n()},I=function(n,t){n.forEach(function(n){var t,i=n.attributesValue||n;(function n(t,i){var r,s,a;if(i===t)return!0;if(a=o.getReferenceFromCollection(i),e.is(a))for(r=o.getParentInstancesFromCollection(a.get("PID")),s=0;s<r.length;s++)if(n(t,r[s].get("isAggregatedBy")))return!0;return!1})(i.isInstanceOf,i.isAggregatedBy)||(t=m.add(n,{silent:v,merge:!0,parse:!0}),s.instancesAndReferences.push(t))}),t()},D=function(n,t){var i;n.forEach(function(n){i=o.getInstanceFromCollection(n),e.is(i)&&o.removeInstance(n,{silent:v})}),t()},y=function(n,t){var i;n.forEach(function(n){i=o.getConnectionFromCollection(n),e.is(i)&&o.removeConnection(n)}),t()},R=function(){e.is(p,"function")?p.call(P,s):e.is(C,"function")?C.call(P):e.is(h,"function")&&h.call(P)};(t={callback:function(e,n){var t=g.add(e,{silent:v,merge:!0,parse:!0});s.connections.push.apply(s.connections,t),n()},globalArray:l,context:g},i.getExecuteByBlockPromise(t)).then(function(){var e;(e={callback:F,globalArray:a,context:f},i.getExecuteByBlockPromise(e)).then(function(){var e;(e={callback:I,globalArray:c,context:m},i.getExecuteByBlockPromise(e)).then(function(){var e;(e={callback:D,globalArray:u,context:m},i.getExecuteByBlockPromise(e)).then(function(){var e;(e={callback:y,globalArray:d,context:g},i.getExecuteByBlockPromise(e)).then(R)})})})})},getFilteredInstancesFromCollection:function(n,t){var o;return o=this.getInstancesFromCollection(n),e.is(t)&&(o=o.filter(function(n){var o=!1,i=n.getAdditionalInfo("filterQuery");return e.is(i)&&(o=e.equals(i,t)),o})),o},traverseInstanceModels:function(n,t){var i,r,s=function(e,n){o.getInstancesFromCollection(e).forEach(function(e){n.push(e)})};if(e.is(t,"function"))for(s(n,i=[]);i.length>0;)t(r=i.pop()),s(r.get("isInstanceOf"),i);else f.log(this.name,"callback cbProcessModel not provided")},removeFilterFromCollection:function(n){o.traverseInstanceModels(n,function(n){var t=n.getAdditionalInfo("filterQuery");e.is(t)&&n.setAdditionalInfo({filterQuery:null})})},transformToRIROccurrencePath:function(n){var t,i,r=[],s=[];return Array.isArray(n)?(r=n).length>0&&(i=o.getInstanceFromCollection(r[0]),e.is(i)&&(t=i.get("isAggregatedBy"))):t=n,s=e.is(t)?[t]:[],r.forEach(function(n){s.push(n),i=o.getInstanceFromCollection(n),e.is(i)&&s.push(i.get("isInstanceOf"))}),s},transformRIRToAbsolutePath:function(e){var n,t=[];for(n=0;n<e.length;n++)n%2==1&&t.push(e[n].resourceid);return t},syncChangeRequired:function(n,t,o,i){var r=[];n.forEach(function(e){r.push("pid:"+e.id)}),d.webServiceRequest({url:"modeler/change/changecontrol",method:"PUT",headers:t,context:this,data:e.Json.encode({ObjectsListForSetChangeControl:r}),onComplete:function(e){o(e)},onFailure:function(){i()}})},syncMaturity:function(n,i,r,s,a){var c=[];n.forEach(function(e){c.push({id:e.id,identifier:e.id,type:e.get("type"),source:"3DSpace",relativePath:"/resources/v1/modeler/dsmfg/dsmfg:MfgItem/"+e.id,nextState:"RELEASED"})}),d.webServiceRequest({url:"v1/modeler/dslc/maturity/changeState",method:"POST",headers:i,context:this,data:e.Json.encode({data:c}),onComplete:function(e){r&&g.isChangeRequiredSyncronizationEnabled()?new t(function(e,t){o.syncChangeRequired(n,i,e,t)}).then(function(){s(e)}):s(e)},onFailure:function(){a()}})},getCurrentStates:function(n,t,o){var i=[];n.forEach(function(e){i.push({id:e})}),d.webServiceRequest({url:"v1/modeler/dslc/maturity/getNextStates",method:"POST",headers:t,context:this,data:e.Json.encode({data:i}),onComplete:function(n){var t=new Map;e.is(n)&&e.is(n.data,"array")?(n.data.forEach(function(e){t.set(e.id,e.maturityState)}),o(t)):o(null)}})},getSequencingMode:function(n,t){d.webServiceRequest({url:"dsmfg/private/V0/invoke/getSequencingMode?pid="+n,method:"GET",context:this,onComplete:function(i){var r;e.is(i)&&e.is(i,"object")&&e.is(i.mode,"string")?(r=o.references.get(n),e.is(r)&&r.set("V_SequencingMode",i.mode),e.is(t.onComplete,"function")&&t.onComplete(i.mode)):e.is(t.onFailure,"function")&&t.onFailure()},onFailure:function(){e.is(t.onFailure,"function")&&t.onFailure()},onTimeout:function(){e.is(t.onTimeout,"function")&&t.onTimeout()}})},setSequencingMode:function(n,t,i){d.webServiceRequest({url:"dsmfg/private/V0/invoke/setSequencingMode",method:"PUT",data:e.Json.encode({pid:n,mode:t}),context:this,onComplete:function(){var r,s,a,c,l,u;if(r=o.references.get(n),e.is(r)&&r.set("V_SequencingMode",t),s=o.getInstancesFromCollection(n),(a=s.map(function(e){return e.get("PID")})).length>0)if("Linear"===t)for(c of(o.findSomeConnection(function(e){return"DELLmiTimeConstraintCnx"===e.get("type")&&a.includes(e.getAttribute("from"))}).forEach(function(e){o.removeConnection(e.get("PID"))}),o.sortInstancesByTreeOrder(s),s.map(function(e){return e.get("PID")})))e.is(u)?(l=u,u=c,o.addLinearProductFlow(l,u)):u=c;else o.findSomeConnection(function(e){return"LinearProductFlowCnx"===e.get("type")&&a.includes(e.getAttribute("from"))}).forEach(function(e){o.removeConnection(e.get("PID"))});e.is(i.onComplete,"function")&&i.onComplete()},onFailure:function(){e.is(i.onFailure,"function")&&i.onFailure()},onTimeout:function(){e.is(i.onTimeout,"function")&&i.onTimeout()}})},getProductionPlanRefRelationPID:function(e,n){return"ProductionPlanLink|"+e+"|"+n},addProductionPlanRefRelationFromPID:function(e,n){o.addConn({PID:this.getProductionPlanRefRelationPID(e,n),from:[e],to:[n],type:"ProductionPlanLink"},{silent:!0})},getAssignedWorkCenterRelationPID:function(e,n){return"AssignedWorkCenterLink|"+e+"|"+n},addAssignedWorkCenterRelationFromPID:function(e,n){o.addConn({PID:this.getAssignedWorkCenterRelationPID(e,n),from:[e],to:[n],type:"AssignedWorkCenterLink"},{silent:!0})},getItemRefRelationPID:function(e,n){return"PartialProductImplementLink|"+e+"|"+n},addItemRefRelationFromPID:function(e,n){o.addConn({PID:this.getItemRefRelationPID(e,n),from:[e],to:[n],type:"PartialProductImplementLink"},{silent:!0})},getAssetContextRelationPID:function(e,n){return"AssetContextLink|"+e+"|"+n},addAssetContextRelationFromPID:function(e,n){o.addConn({PID:this.getAssetContextRelationPID(e,n),from:[e],to:[n],type:"AssetContextLink"},{silent:!0})},getSerializedRelationOpPID:function(e,n){return"DELIsSerializedFromOp|"+e+"|"+n},addSerializedRelationOpFromPID:function(e,n){o.addConn({PID:this.getSerializedRelationOpPID(e,n),from:[e],to:[n],type:"DELIsSerializedFromOp"},{silent:!0})},getSerializedRelationPID:function(e,n){return"DELIsSerializedFrom|"+e+"|"+n},addSerializedRelationFromPID:function(e,n){o.addConn({PID:this.getSerializedRelationPID(e,n),from:[e],to:[n],type:"DELIsSerializedFrom"},{silent:!0})},getExecTimeConstraintRelationPID:function(e,n){return"DELLmiExecTimeConstraintRelation|"+e+"|"+n},addExecTimeConstraintRelation:function(e){var n=e["from.physicalid"].value,t=e["to.physicalid"].value;null!=e.interfaceforkind?o.addConn({PID:e.physicalid.value,from:[n],to:[t],type:"DELLmiExecTimeConstraintRelation",kind:e.interfaceforkind.value},{silent:!0}):o.addConn({PID:e.physicalid.value,from:[n],to:[t],type:"DELLmiExecTimeConstraintRelation"},{silent:!0})},addExecTimeConstraintRelationFromPID:function(e,n,t){null!=t?o.addConn({PID:this.getExecTimeConstraintRelationPID(e,n),from:[e],to:[n],type:"DELLmiExecTimeConstraintRelation",kind:t}):o.addConn({PID:this.getExecTimeConstraintRelationPID(e,n),from:[e],to:[n],type:"DELLmiExecTimeConstraintRelation"})},getLinearProductFlowPID:function(e,n){return"LinearProductFlowCnx|"+e+"|"+n},getLinearProductFlowFromCollection:function(e,n){return o.getConnectionFromCollection(o.getLinearProductFlowPID(e,n))},addLinearProductFlow:function(e,n){o.addConn({PID:o.getLinearProductFlowPID(e,n),from:[e],to:[n],type:"LinearProductFlowCnx"})},removeLinearProductFlow:function(e,n){o.removeConnection(o.getLinearProductFlowPID(e,n))},sortInstancesByTreeOrder:function(n){n.sort(function(n,t){var o=n.get("V_TreeOrder"),i=t.get("V_TreeOrder");return(e.is(o)?o:0)-(e.is(i)?i:0)})},manageLinearProductFlowsOnCreateInstance:function(n){var t,i,r,s,a,c,l,u,d=n.get("isAggregatedBy"),f=o.references.get(d);e.is(f)&&(u=f.get("V_SequencingMode")),"Linear"===u&&(t=o.getInstancesFromCollection(d),o.sortInstancesByTreeOrder(t),i=n.get("PID"),c=(r=t.findIndex(function(e){return e.get("PID")===i}))>0,l=r<t.length-1,c&&(s=t[r-1].get("PID"),a=i,o.addLinearProductFlow(s,a)),l&&(s=i,a=t[r+1].get("PID"),o.addLinearProductFlow(s,a)),c&&l&&(s=t[r-1].get("PID"),a=t[r+1].get("PID"),o.removeLinearProductFlow(s,a)),o.findSomeConnection(function(e){return"DELLmiTimeConstraintCnx"===e.get("type")&&(e.getAttribute("from")===i||e.getAttribute("to")===i)}).forEach(function(e){o.removeConnection(e.get("PID"))}))},manageLinearProductFlowsOnDeleteInstance:function(e){var n,t,i,r,s,a,c,l=e.get("isAggregatedBy");"Linear"===o.references.get(l).get("V_SequencingMode")&&(n=o.getInstancesFromCollection(l),o.sortInstancesByTreeOrder(n),t=e.get("PID"),a=(i=n.findIndex(function(e){return e.get("PID")===t}))>0,c=i<n.length-1,a&&(r=n[i-1].get("PID"),s=t,o.removeLinearProductFlow(r,s)),c&&(r=t,s=n[i+1].get("PID"),o.removeLinearProductFlow(r,s)),a&&c&&(r=n[i-1].get("PID"),s=n[i+1].get("PID"),o.addLinearProductFlow(r,s)))},federatedSearch:function(n,t,o){var i=e.merge(e.clone({}),{label:"federatedSearch"+Date.now(),with_indexing_date:!0,with_synthesis:!0,with_nls:!1,locale:"en",select_predicate:n,refine:{},order_by:"desc",start:0,nresults:200,order_field:"relevance",source:["3dspace"],tenant:window.widget.getValue("x3dPlatformId")?window.widget.getValue("x3dPlatformId"):"OnPremise",login:{"3dspace":{SecurityContext:d.getSecurityContext()}}});e.extend(i,{query:t});var r={url:d.get3DSearchUrl()+"/search",method:"POST",data:JSON.stringify(i),headers:d.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0,serviceName:""}),onComplete:function(n){e.is(o)&&o.onComplete.call(null,n)},onFailure:function(n){e.is(o)&&o.onFailure.call(null,n)}};r.headers.Accept="application/json",r.headers["Content-Type"]="application/json",d.webServiceRequest(r)}})});