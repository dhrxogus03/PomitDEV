window.top.performance.mark("PIM_jsAppLoad"),
/*!  Copyright 2018 Dassault Systemes. All rights reserved. */
define("DS/PIMwebI3Dapp/PIMwebAppMain",["UWA/Core","DS/CATWebUXComponents/DMUFrameWindow","DS/PADUtils/PADSettingsMgt"],function(e,t,n){"use strict";var i,o,a;function r(e){var t=e.getValue("xsceneStoredObjects");return t&&"string"==typeof t||(t='{"products":{},"filters":{}}'),JSON.parse(t)}function s(e){e&&e.length&&(this.showWelcomePanel(!1),this.pad3DViewer.addRootNodesFromContent({json3DXContent:{protocol:"3DXContent",version:"1.1",source:"X3DSEAR_AP",data:{items:e.map(function(e){return{envId:require("DS/PADUtils/PADUtilsServices").getPlatformId(),objectId:e.id,objectType:e.type,displayName:e.displayName}})}}}))}function l(e){s.call(this,e.map(function(e){return{id:e.resourceid,type:e["ds6w:type_value"],displayName:e["ds6w:label"]}}))}function d(e){if(e&&e.length){i.publish({event:"ENXViews/LandingPage/addOrRefresh",data:{objects:e.map(function(e){return{resourceid:e,openWithFilter:!1,loading:!0,fromCustom:!0}})}});var t=setInterval(function(){this.isAppReady&&(clearInterval(t),require(["DS/PIMwebViewModel/PIMwebUtils"],function(t){t._fetchForWelcomePanel({ids:e,onComplete:function(e){var t=((e?JSON.parse(e):{}).results||[]).map(function(e){var t={};e.attributes.forEach(function(e){t[e.name]=e.value});var n=t["ds6w:type"],i={resourceid:t.resourceid,label:t["ds6w:label"],icons:[t.type_icon_url],thumbnail:t.preview_url,grid:t,subLabel:t["ds6w:responsible"]+" | "+new Date(t["ds6w:modified"]).toLocaleString(),description:t["ds6w:identifier"],openWithFilter:!1,fromCustom:!0,loading:void 0,item2Load:{}};i.item2Load[i.resourceid]={};var o=!!this.pimCtrl&&this.pimCtrl.getLoadedData();return i.opened=!!o[i.resourceid]||Object.keys(o).some(function(e){return o[e].indexOf(i.resourceid)>=0}),"SIMItfSimulation"!==n&&"PLMPIMMetricReference"!==n||(i.addRemoveFromViewCtx=!0),i}.bind(this));i.publish({event:"ENXViews/LandingPage/addOrRefresh",data:{objects:t}})}.bind(this),onFailure:function(){}})}.bind(this)))}.bind(this),100)}}function p(e){this.isAppReady=!1,this.params=e,this.welcomePanel=this.pad3DViewer=this.pimCtrl=null,this.tokensWelcomePanel=[]}return p.prototype={constructor:p,initialize:function(){return new Promise(function(e){require(["DS/PADServices/views/LandingPage","DS/PADServices/utils/GlobalModelEvents","i18n!DS/PIMwebI3Dapp/assets/nls/PIMwebI3Dapp"],function(t,n,o){i=n,this.tokensWelcomePanel.push(i.subscribe({event:"ENXViews/LandingPage/refreshCustom"},function(e){var t=r(this.params.widget),n=[].concat(Object.keys(t.isr||{}),Object.keys(t.itf||{}));d.call(this,e.filter(function(e){return n.indexOf(e)>-1}))}.bind(this))),this.tokensWelcomePanel.push(i.subscribe({event:"ENXViews/LandingPage/openCustom"},function(e){var t=this.params.widget.getValue("xsceneStoredObjects"),n=[];t=t?JSON.parse(t):{},e.customitem2open.forEach(function(e){t.isr&&t.isr[e]?n.push({id:e,type:"SIMItfSimulation"}):t.itf&&t.itf[e]&&n.push({id:e,type:"PLMPIMMetricReference"})}),s.call(this,n)}.bind(this))),this.tokensWelcomePanel.push(i.subscribe({event:"ENXViews/LandingPage/removeFromView"},function(e){if(e&&e.customitem2remove&&e.customitem2remove.length){var t=this.pimCtrl.getLoadedData(),n=[];e.customitem2remove.forEach(function(e){t[e]&&-1===n.indexOf(e)?n.push(e):Object.keys(t).forEach(function(i){t[i].indexOf(e)>-1&&-1===n.indexOf(i)&&n.push(i)})}),n.forEach(this.pimCtrl.removeIsr,this.pimCtrl)}}.bind(this))),this.tokensWelcomePanel.push(i.subscribe({event:"ENXViews/LandingPage/removeFromStore"},function(e){var t=this.params.widget.getValue("xsceneStoredObjects"),n=[];t=t?JSON.parse(t):{},e.customitem2remove.forEach(function(e){t.isr&&t.isr[e]&&-1===n.indexOf(e)?(n.push(e),delete t.isr[e]):t.itf&&t.itf[e]&&-1===n.indexOf(t.itf[e])&&(n.push(t.itf[e]),delete t.itf[e])}),this.params.widget.setValue("xsceneStoredObjects",JSON.stringify(t)),i.publish({event:"ENXViews/LandingPage/removeFromView",data:{customitem2remove:n}})}.bind(this))),this.tokensWelcomePanel.push(i.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelIsr"},function(){t.launchSearch({title:o.isr,precondition:'flattenedtaxonomies:"types/SIMItfSimulation"',showApplyButton:!1,ok:l.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(i.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelItf"},function(){t.launchSearch({title:o.itf,precondition:'flattenedtaxonomies:"types/PLMPIMMetricReference"',showApplyButton:!1,ok:l.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(i.subscribe({event:"ENXViews/WelcomePanel/action/welcomPanelPrefCmd"},function(){require(["DS/CATWebUXComponents/DMUCommandsManager","DS/CATWebUXPreferences/CATWebUXPreferencesManager"],function(e,t){let n=t.givePreferenceManager({context:this.pad3DViewer.getFrameWindow()});if(n)var i=n.subscribe("onPreferencesPanelDestroyed",function(){n.unsubscribe(i),this.showWelcomePanel(!0)}.bind(this));this.showWelcomePanel(!1),e&&e.getCommand("CATWebUXPreferencesHdr",this.pad3DViewer&&this.pad3DViewer.getCommandContext?this.pad3DViewer.getCommandContext():null).begin()}.bind(this))}.bind(this)));var a=t.getDefaultActivities();a.activities[0].section.actions.splice(2,0,{id:"welcomePanelIsr",title:o.isr,icon:"interference-simulation"}),a.activities[0].section.actions.splice(3,0,{id:"welcomePanelItf",title:o.itf,icon:"interference-metric"}),a.activities.push({section:{id:"customizeAppSection",title:o.customApp,actions:[{id:"welcomPanelPrefCmd",title:o.prefs,icon:"cog"}]}}),this.welcomePanel=new t({widget:this.params.widget,readOnlyApp:!1,renderDiv:this.params.renderDiv,externalViewerMgt:!0,externalViewerMgtCB:function(e,t){!0!==t&&this.showWelcomePanel("viewer"!==e)}.bind(this),globalSearchPrecond:'flattenedtaxonomies:"types/SIMItfSimulation" OR flattenedtaxonomies:"types/PLMPIMMetricReference" OR flattenedtaxonomies:"types/VPMReference" OR flattenedtaxonomies:"types/VPMRepReference" OR flattenedtaxonomies:"types/ENOStrRefinementSpecification"',defaultActionId:a.defaultActionId,activities:a.activities,onLandingPageReady:this.params.onLandingPageReady}),this.welcomePanel.initialize().then(function(){var t=r(this.params.widget);d.call(this,[].concat(Object.keys(t.isr||{}),Object.keys(t.itf||{}))),e()}.bind(this))}.bind(this))}.bind(this))},setViewer:function(e){this.pad3DViewer=e,!this.params.initApp&&this.showWelcomePanel(!1);var t=e.render().getContent(),n=t.parentNode;t.style.position="relative",!this.params.renderDiv.parentNode&&n&&n!==this.params.renderDiv&&n.insertBefore(this.params.renderDiv,n.firstChild),this.params.renderDiv.insertBefore(t,this.params.renderDiv.firstChild),this.params.renderDiv.insertBefore(this.welcomePanel.elements.mainBody,this.params.renderDiv.firstChild),this.welcomePanel.setViewer(e,!this.params.initApp)},appReady:function(e){if(this.pimCtrl=e,this.isAppReady=!0,this.params.initApp){let a=this.params.widget.getValue("X3DContentId"),r=this.params.widget.id.indexOf("preview")>-1,s=this;if(this.params.widget.deleteValue("X3DContentId"),a)e.appInitFromTransition({x3dContent:JSON.parse(a),onNoActionDone:function(){s.showWelcomePanel(!1),this.addRootNodesFromContent({json3DXContent:JSON.parse(a),dispatch:!1})}.bind(this.pad3DViewer)});else if(!0===this.params.widget.getValue("autoreload")||!0===this.params.widget.getValue("autoreloadPreviewApp")&&!r){var t=this.params.widget.getValue("ItfSimuInSession");if((t=t?JSON.parse(t):null)&&!Array.isArray(t)&&"object"==typeof t){var n=Object.keys(t);if(1===n.length){var i={},o=n[0];Array.isArray(t[o])&&t[o].length?i.metricID=t[o]:i.isrID=o,this.showWelcomePanel(!1),e.load(i)}}}r?this.params.widget.setValue("autoreloadPreviewApp",!0):this.params.widget.deleteValue("autoreloadPreviewApp")}var a=this.welcomePanel.appReady();return this.welcomePanel.redraw(),a},dispose:function(){if(this.showWelcomePanel(!1),this.welcomePanel)return this.pad3DViewer=this.params=this.pimCtrl=null,this.tokensWelcomePanel.forEach(i.unsubscribe,i),this.tokensWelcomePanel.length=0,this.welcomePanel.dispose()},showWelcomePanel:function(e){this.welcomePanel&&(this.welcomePanel.elements.mainBody.style.position="relative",this.welcomePanel.elements.mainBody.style.display=e?"":"none",e&&this.welcomePanel.redraw())}},Object.freeze({getApp:function(i){if(!i||!i.data)throw new Error("App identification is missing! Unable to init app");if("I3D"!==i.data&&"I3S"!==i.data)throw new Error("Invalid app id: "+i.data);if("I3D"===i.data&&o)return o;if("I3S"===i.data&&a)return a;var r,s,l,d,u,c,f,m,g=[],w=i.widget,b=i.pad3DViewer,D=i.appMainDiv,P=b?b.getCommandContext():null,h={},v={module:"PIMweb"+i.data+"app",file:"PIMweb"+i.data+"appWkb.xml"};function S(e,t,n){window.top.performance.measure(w.id+e,n?w.id+t:t)}function A(e){window.top.performance.mark(w.id+e)}function I(){b&&b.getContentName({callbacks:{onComplete:function(e){w.setTitle(e.contentName)},onFailure:function(){}}})}function C(e){s&&r&&!d&&(l&&l(D),l=null,f.appReady(s),S("_PIM_Global widget creation time","PIM_jsAppLoad",!1),w.dispatchEvent("onWidgetAndAppReady","1"===w.getValue("widgetForODTReplay")?[{pad3DViewer:e}]:void 0))}""!==window.location.search&&(e.extend(h,e.Utils.parseQuery(window.location.search)),h.widgetDomain&&e.extend(h,e.Utils.parseQuery(h.widgetDomain))),"testWkb"in h&&(v={module:"PIMwebI3Dtst",file:"PIMwebI3DappTestWkb.xml"}),"I3S"===i.data&&require(["DS/PIMwebViewModel/PIMwebIsrMgr"].concat([]),function(e){e.isUpdateSimulationAllowed()&&(v={module:"PIMweb"+i.data+"app",file:"PIMweb"+i.data+"OnCloudappWkb.xml"})});var M,y,V,_=function(){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/PADUtils/PADCommandProxy"],function(e,t){(M=e).renderDiv||M.initialize2(b.getFrameWindow().getViewerFrame(),t.appId(),w.getValue("changeControlActivation")?"show":"hide","top-right",function(){M.addEvent("onAuthoringCtxVisible",function(e){e.showAuthoringContext&&w.setValue("changeControlActivation",!0)})})})},x=function(e){require(["DS/PADUtils/PADCommandProxy","DS/PADUtils/PADSharedSettings","i18n!DS/PADUtils/assets/nls/PADUtils"],function(t,i,o){var a,r=[];V=function(){w.setPreferences([]),a.destroy(),r.forEach(function(e){e.cb&&n.removeEvent(e.cb,e.padFct)}),V=function(){}},y=function(){r.forEach(function(e){var t=e.preference.name,i=w.getValue(t),o=n.getSetting(t);(i="boolean"===e.preference.type&&"boolean"!=typeof i?"true"===i:i)!==o&&n.setSetting(t,i),e.fct&&e.fct(i)}),n.updateWidgetPreferences(),!a&&r.length&&(a=t.create({events:{onPreferenceModification:function(e){r.some(function(t){if(e.name===t.preference.name){if("boolean"!=typeof e.value&&"string"!=typeof e.value)throw new Error("Value must be a string or a boolean");if(n.getSetting(e.name)!==e.value){if("boolean"===t.preference.type&&"boolean"!=typeof e.value)throw new Error("Preference is a boolean type so value must be a boolean");t.debounce=!0,w.setValue(e.name,e.value),n.setSetting(e.name,e.value)}return t.fct&&t.fct(e.value),!0}})}}}),r.forEach(function(e){e.cb&&n.addEvent(e.cb,e.padFct=function(t){e.debounce?e.debounce=!1:a.preferenceModification({name:e.preference.name,value:t})})}))},w.setPreferences([]),n.setSetting("syncAutoReload",!0),i.destroy(),i.addSharedSettings(w),r.push({preference:{name:"changeControlActivation",type:"boolean",label:o.changeControlActivation_label,defaultValue:!1},fct:function(e){M&&M[e?"show":"hide"]()},cb:"onChangeControlActivation",debounce:!1}),r.push({preference:{name:"changeControlPosition",type:"list",label:o.changeControlPosition_label,defaultValue:"top-right",options:[{label:o["top-right_label"],value:"top-right"},{label:o["top-left_label"],value:"top-left"},{label:o["bottom-left_label"],value:"bottom-left"},{label:o["bottom-right_label"],value:"bottom-right"}]},fct:function(e){M&&M.setPosition(e)}}),n.setSetting("authorizeChangeControl",!0),e&&_(),r.forEach(function(e){w.mergePreferences([e.preference])}),y(),require(["i18n!DS/ENOPAD3DViewer/assets/nls/PAD3DViewer"],e=>{w.addEvent("onChangeFlexibleAssembliesSupport",function(e,t){n.setSetting(e,t)});var t=n.getSetting("enopad3dviewer_roles");let i=!0,o=require("DS/PADUtils/PADUtilsServices").isCloud(),a=require("DS/PADUtils/PADSession").isAuthoring();for(var r=0;r<t.length;r++)if("E19"===t[r].id&&(!t[r].platforms||t[r].platforms&&t[r].platforms.indexOf(require("DS/PADUtils/PADUtilsServices").getPlatformId())>-1)){i=!1;break}!i||o||a?(w.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"hidden",defaultValue:!1,label:e.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:!1}),n.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",!1)):w.getPreference("enopad3dviewer_flexibleAssemblySupportActivated")||(w.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"boolean",defaultValue:!1,label:e.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:void 0!==w.getValue("enopad3dviewer_flexibleAssemblySupportActivated")&&w.getValue("enopad3dviewer_flexibleAssemblySupportActivated")}),n.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",w.getValue("enopad3dviewer_flexibleAssemblySupportActivated"))),n.setSetting("enopad3dviewer_staticMappingSupportActivated",!a)}),w.addEvent("endEdit",y)})};function E(e){e.unsubscribe(u),u=null,I(),_(),require("DS/PADUtils/PADUtilsServices").isCloud()&&!window.__preventPrefPanel&&e.getViewer().displayIntroductoryControlPreferencePanel(),A("_PIM_beforeAppComponentLoad"),require(["DS/PIMwebViewController/PIMwebItfCtrl"],function(t){S("_PIM_AppComponentLoading","_PIM_beforeAppComponentLoad",!0),(s=t.getItfCtrl({pad3DViewer:e})).activate({readOnly:!1}),C(e)})}function U(e){e.unsubscribe(c),c=null,A("_PIM_ownCommands"),S("_PIM_Action Bar merge app commands","_PIM_ownCommands",!0),A("_PIM_beforeDefaultCmdLoad"),P=b.getCommandContext(),(r=require("DS/CATWebUXComponents/DMUCommandsManager")).setDefaultCommand({ID:"PIMwebDefaultHdr",className:"DS/PIMwebViewController/PIMwebDefaultCmd",context:P});let t=r.getCommand("PIMwebEditItfHdr",P),n="Create";t.options&&t.options.arguments&&t.options.arguments[0]&&t.options.arguments[0].type&&(n=t.options.arguments[0].type),"Edit"===n&&(t.disable(),g.push(s.subscribe("onIsrAdded",function(){t.enable()})),g.push(s.subscribe("onItfAdded",function(){t.enable()})),g.push(s.subscribe("onIsrRemoved",function(){t.disable()})),(s.getLoadedIsr().length||s.isPIMDataLoaded())&&t.enable());let i=r.getCommand("PIMwebUpdateItfHdr",P);i&&(i.options&&i.options.arguments&&i.options.arguments[0]&&i.options.arguments[0].type&&(n=i.options.arguments[0].type),"Update"===n&&(i.disable(),g.push(s.subscribe("onIsrAdded",function(){i.enable()})),g.push(s.subscribe("onItfAdded",function(){i.enable()})),g.push(s.subscribe("onIsrRemoved",function(){i.disable()})),(s.getLoadedIsr().length||s.isPIMDataLoaded())&&i.enable())),S("_PIM_Default Cmd Init","_PIM_beforeDefaultCmdLoad",!0),C(e)}function W(e){S("_PIM_PAD3DViewer creation","_PIM_PAD3DViewerReady",!0),e.unsubscribe(d),d=null,C(e)}function N(t){return D||(D=e.createElement("div",{class:"appMain",styles:{width:"auto",height:"100%"}})),(f=new p({widget:w,readOnlyApp:!1,renderDiv:D,initApp:t&&t.initApp,onLandingPageReady:t&&t.onLandingPageReady})).initialize()}function L(){if(n&&(n.setSetting("activateWidgetLink",!0),n.setSetting("useNewUXGuidelinesWP",!0)),!b){S("_PIM_UWA widget loading","_PIM_widgetLoad",!0),A("_PIM_LoadJSPAD3DViewer");var o=new Promise(function(e){require(["DS/PADUtils/PADSharedSettings"],t=>{t.addSharedSettings(w,["showWelcomePanel"]),N({initApp:!0,onLandingPageReady:function(){l(D),l=null}}).then(e)})}),a=new Promise(function(e){require(["DS/ENOPAD3DViewer/PAD3DViewer","DS/CATWebUXPreferences/CATWebUXPreferencesManager","text!DS/PIMwebI3Dapp/assets/json/PIMwebI3DWindowOptions.json"],function(t,n,i){S("_PIM_PAD3DViewer load JS","_PIM_LoadJSPAD3DViewer",!0),A("_PIM_PAD3DViewerReady"),m=n,e([t,i])})}),r=new Promise(e=>{require(["DS/ENOXInterWdgCom/LinkManager"],t=>{t.initializeWidgetLink(w,{appIds:[],uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXLandingPageSync"],open:!0}).then(e)})});Promise.all([o,a,r]).then(function(o){n=require("DS/PADUtils/PADSettingsMgt");var a=e.extend({context:"Default",workbench:v.file,workbenchModule:v.module},JSON.parse(o[1][1])),r={widget:w,windowOptions:a,enableFiltering:!0,binaryPrimitives:!0,enableSidePanel:!0,visuProgressiveTileModel:!0,readyCB:x};a.mouseProfile=require("DS/PADUtils/PADUtilsServices").isCloud()?window.__mouseProfile:"CATIA",b=new o[1][0](r),t.init(b),a.mouseProfile&&b.getViewpoint().setDefaultController(!0,a.mouseProfile),m.getPreferenceManager({context:b.getFrameWindow()}).removeAllPreferences(),f.setViewer(b),b.setOption("propertiesFacet",n.getSetting("propertiesFacet")),b.setAuthorizedRootTypes(n.getSetting("ups_authorized_root_types")),b.setDefaultContextualBarVisibility(!0),b.setDefaultContextualMenuVisibility(!0),b.setOpenWithMenuAvailability(!0),u=b.subscribe({event:"onViewerReady"},E),c=b.subscribe({event:"onActionBarReady"},U),d=b.subscribe({event:"onReady"},W),b.subscribe({event:"onRootAdded"},I),b.subscribe({event:"onRootRemoved"},I),b.subscribe({event:"onRootAttached"},I),b.subscribe({event:"onRootDetached"},I),b.subscribe({event:"onContentNameModified"},I),b.subscribe({event:"onBeginRootLoading"},function(){var e=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),t=window.document.getElementsByClassName("DMULoadingPanel");e.length&&(e[0].dsModel.off(),e[0].dsModel.destroy(),e=null),t.length&&t[0].destroy()}),n.setSetting("settypes",!0),"1"===w.getValue("widgetForODTReplay")&&w.dispatchEvent("onPAD3DViewerCreated",[{pad3DViewer:b}]),i.done&&i.done({appMainDiv:D,pad3DViewer:b})})}}function X(){!function(){var e=n.getSetting("enopad3dviewer_roles");let t=!0,i=require("DS/PADUtils/PADUtilsServices").isCloud(),o=require("DS/PADUtils/PADSession").isAuthoring();for(var a=0;a<e.length;a++)if("E19"===e[a].id&&(!e[a].platforms||e[a].platforms&&e[a].platforms.indexOf(require("DS/PADUtils/PADUtilsServices").getPlatformId())>-1)){t=!1;break}n.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",t&&!i&&!o),n.setSetting("enopad3dviewer_staticMappingSupportActivated",!o)}(),b&&b.refresh()}function O(){f&&f.dispose(),f=null,s&&(g&&g.forEach(s.unsubscribe,s),s.dereference()),o=a=w=b=l=D=r=s=g=m=null,t.reset()}function R(e){b&&b.search({searchQuery:e})}b?w.addEvent("onDestroy",O):(S("_PIM_JS dependencies loading","PIM_jsAppLoad",!1),A("_PIM_widgetLoad"),i.viewerAttachment?(l=i.viewerAttachment,L()):(l=function(e){w.setBody(e)},w.addEvent("onLoad",L)),w.addEvent("onRefresh",X),w.addEvent("onDestroy",function(){var e=b;O(),e&&e.destroy()}),w.addEvent("onSearch",R),w.setMetas({helpPath:"PIMwebI3Dapp/assets/help"}));var q=Object.freeze({setUp:function(e){Promise.all([r?Promise.resolve():new Promise(function(e){require(["DS/CATWebUXComponents/DMUCommandsManager"],function(t){r=t,e()})}),m?Promise.resolve():new Promise(function(e){require(["DS/CATWebUXPreferences/CATWebUXPreferencesManager"],function(t){m=t,e()})})]).then(function(){w.addEvent("onRefresh",X),w.addEvent("onSearch",R),w.setMetas({helpPath:"PIMwebI3Dapp/assets/help"});var n={lastCommand:[],currentCommand:null,defaultCommand:null};P?r._commandsState[P]=n:r._commandsState=n,r.resetDefaultCommand(P),r._isCommandEnding=!1,r._ignoreCommandBeginWhileEndingCommand=!1,["_commands","_cmdCheckHeader"].forEach(function(e){var t=P?r[e][P]:r[e];Object.keys(t).forEach(function(e){var n=t[e];n&&n._destroy&&n._destroy(),delete t[e]})}),e.sourceApp&&e.sourceApp.pad3DViewer!==b&&(s&&s.dereference(),s=null,b=e.sourceApp.pad3DViewer,t.init(b)),b.setOption("propertiesFacet",require("DS/PADUtils/PADSettingsMgt").getSetting("propertiesFacet")),b.getBIController().toggleBetweenStandaloneAndSlaveMode("DUAL"),x(b),I(),b.setDefaultContextualBarVisibility(!0),b.setDefaultContextualMenuVisibility(!0),b.setOpenWithMenuAvailability(!0),m.getPreferenceManager({context:b.getFrameWindow()}).removeAllPreferences();var i=new Promise(function(e){var t=b.subscribe({event:"onActionBarReady"},function(){b.unsubscribe(t),r.setDefaultCommand({ID:"PIMwebDefaultHdr",className:"DS/PIMwebViewController/PIMwebDefaultCmd",context:P}),e()});b.loadActionBar({merge:!1,file:v.file,module:v.module})});require("DS/ENOXInterWdgCom/LinkManager").updateLinkability({appIds:[],open:!0,uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXLandingPageSync"]}),require("DS/PADUtils/PADSettingsMgt").setSetting("activateWidgetLink",!0),require("DS/PADUtils/PADSettingsMgt").setSetting("useNewUXGuidelinesWP",!0);var o=new Promise(function(e){s?e():require(["DS/PIMwebViewController/PIMwebItfCtrl"],function(t){(s=t.giveItfCtrl({pad3DViewer:b}))||(w.deleteValue("ItfSimuInSession"),s=t.getItfCtrl({pad3DViewer:b})),e()})}).then(function(){s.activate({readOnly:!1}),N().then(function(){f.setViewer(b),f.appReady(s)}),e.sourceApp&&e.sourceApp.issues&&e.sourceApp.issues.length>0&&s.appInitFromTransition({issues:e.sourceApp.issues,onNoActionDone:function(){}})});Promise.all([i,o]).then(function(){e.done({appMainDiv:D,pad3DViewer:b})})})},dispose:function(e){if(w.removeEvent("onRefresh",X),w.removeEvent("onSearch",R),w.removeEvent("endEdit",y),V(),f&&f.dispose(),f=null,b&&b.setOpenWithMenuAvailability(!1),s&&s.deactivate(),e){var t=w.getValue("ItfSimuInSession");(t=t?JSON.parse(t):null)&&!Array.isArray(t)&&"object"==typeof t&&1===Object.keys(t).length&&(e.preferredType="SIMItfSimulation")}var n=m.givePreferenceManager({context:b.getFrameWindow()});n&&n.removeAllPreferences(),m.unreferencePreferenceManager({context:b.getFrameWindow()})},onWillLeave:function(){}});return"I3D"===i.data?o=q:a=q,q}})}),define("DS/PIMwebI3Dapp/PIMI3AppMain",["UWA/Core","DS/CATWebUXComponents/DMUFrameWindow","DS/PADUtils/PADSettingsMgt"],function(e,t,n){"use strict";var i,o;let a,r=null,s=null,l=null;var d,p,u,c,f,m,g,w,b,D,P=[],h=c?c.getCommandContext():null,v={};function S(e,t,n){window.top.performance.measure(u.id+e,n?u.id+t:t)}function A(e){window.top.performance.mark(u.id+e)}function I(){c&&c.getContentName({callbacks:{onComplete:function(e){u.setTitle(e.contentName)},onFailure:function(){}}})}function C(e){p&&d&&(m&&m(f),m=null,l.getComponent("LandingPage").appReady(),S("_PIM_Global widget creation time","PIM_jsAppLoad",!1),u.dispatchEvent("onWidgetAndAppReady","1"===u.getValue("widgetForODTReplay")?[{pad3DViewer:e}]:void 0))}var M,y,V,_=function(){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/PADUtils/PADCommandProxy"],function(e,t){(M=e).renderDiv||M.initialize2(c.getFrameWindow().getViewerFrame(),t.appId(),u.getValue("changeControlActivation")?"show":"hide","top-right",function(){M.addEvent("onAuthoringCtxVisible",function(e){e.showAuthoringContext&&u.setValue("changeControlActivation",!0)})})})},x=function(e){require(["DS/PADUtils/PADCommandProxy","DS/PADUtils/PADSharedSettings","i18n!DS/PADUtils/assets/nls/PADUtils"],function(t,i,o){var a,r=[];V=function(){u.setPreferences([]),a.destroy(),r.forEach(function(e){e.cb&&n.removeEvent(e.cb,e.padFct)}),V=function(){}},y=function(){r.forEach(function(e){var t=e.preference.name,i=u.getValue(t),o=n.getSetting(t);(i="boolean"===e.preference.type&&"boolean"!=typeof i?"true"===i:i)!==o&&n.setSetting(t,i),e.fct&&e.fct(i)}),n.updateWidgetPreferences(),!a&&r.length&&(a=t.create({events:{onPreferenceModification:function(e){r.some(function(t){if(e.name===t.preference.name){if("boolean"!=typeof e.value&&"string"!=typeof e.value)throw new Error("Value must be a string or a boolean");if(n.getSetting(e.name)!==e.value){if("boolean"===t.preference.type&&"boolean"!=typeof e.value)throw new Error("Preference is a boolean type so value must be a boolean");t.debounce=!0,u.setValue(e.name,e.value),n.setSetting(e.name,e.value)}return t.fct&&t.fct(e.value),!0}})}}}),r.forEach(function(e){e.cb&&n.addEvent(e.cb,e.padFct=function(t){e.debounce?e.debounce=!1:a.preferenceModification({name:e.preference.name,value:t})})}))},u.setPreferences([]),n.setSetting("syncAutoReload",!0),i.destroy(),i.addSharedSettings(u),r.push({preference:{name:"changeControlActivation",type:"boolean",label:o.changeControlActivation_label,defaultValue:!1},fct:function(e){M&&M[e?"show":"hide"]()},cb:"onChangeControlActivation",debounce:!1}),r.push({preference:{name:"changeControlPosition",type:"list",label:o.changeControlPosition_label,defaultValue:"top-right",options:[{label:o["top-right_label"],value:"top-right"},{label:o["top-left_label"],value:"top-left"},{label:o["bottom-left_label"],value:"bottom-left"},{label:o["bottom-right_label"],value:"bottom-right"}]},fct:function(e){M&&M.setPosition(e)}}),n.setSetting("authorizeChangeControl",!0),e&&_(),r.forEach(function(e){u.mergePreferences([e.preference])}),y(),require(["i18n!DS/ENOPAD3DViewer/assets/nls/PAD3DViewer"],e=>{u.addEvent("onChangeFlexibleAssembliesSupport",function(e,t){n.setSetting(e,t)});var t=n.getSetting("enopad3dviewer_roles");let i=!0,o=require("DS/PADUtils/PADUtilsServices").isCloud(),a=require("DS/PADUtils/PADSession").isAuthoring();for(var r=0;r<t.length;r++)if("E19"===t[r].id&&(!t[r].platforms||t[r].platforms&&t[r].platforms.indexOf(require("DS/PADUtils/PADUtilsServices").getPlatformId())>-1)){i=!1;break}!i||o||a?(u.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"hidden",defaultValue:!1,label:e.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:!1}),n.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",!1)):u.getPreference("enopad3dviewer_flexibleAssemblySupportActivated")||(u.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"boolean",defaultValue:!1,label:e.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:void 0!==u.getValue("enopad3dviewer_flexibleAssemblySupportActivated")&&u.getValue("enopad3dviewer_flexibleAssemblySupportActivated")}),n.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",u.getValue("enopad3dviewer_flexibleAssemblySupportActivated"))),n.setSetting("enopad3dviewer_staticMappingSupportActivated",!a)}),u.addEvent("endEdit",y)})};function E(e){e.unsubscribe(w),w=null,A("_PIM_ownCommands"),S("_PIM_Action Bar merge app commands","_PIM_ownCommands",!0),A("_PIM_beforeDefaultCmdLoad"),h=c.getCommandContext(),d=require("DS/CATWebUXComponents/DMUCommandsManager"),l||d.setDefaultCommand({ID:"PIMwebDefaultHdr",className:"DS/PIMwebViewController/PIMwebDefaultCmd",context:h});let t=d.getCommand("PIMwebEditItfHdr",h),n="Create";t.options&&t.options.arguments&&t.options.arguments[0]&&t.options.arguments[0].type&&(n=t.options.arguments[0].type),require(["DS/PIMwebViewController/PIMwebItfCtrl"],function(e){(p=e.giveItfCtrl({pad3DViewer:c}))||(p=e.getItfCtrl({pad3DViewer:c})),"Edit"===n&&(t.disable(),P.push(p.subscribe("onIsrAdded",function(){t.enable()})),P.push(p.subscribe("onItfAdded",function(){t.enable()})),P.push(p.subscribe("onIsrRemoved",async function(){await t.disable()})),(p.getLoadedIsr().length||p.isPIMDataLoaded())&&t.enable());let i=d.getCommand("PIMwebUpdateItfHdr",h);i&&(i.options&&i.options.arguments&&i.options.arguments[0]&&i.options.arguments[0].type&&(n=i.options.arguments[0].type),"Update"===n&&(i.disable(),P.push(p.subscribe("onIsrAdded",function(){i.enable()})),P.push(p.subscribe("onItfAdded",function(){i.enable()})),P.push(p.subscribe("onIsrRemoved",function(){i.disable()})),(p.getLoadedIsr().length||p.isPIMDataLoaded())&&i.enable()))}),S("_PIM_Default Cmd Init","_PIM_beforeDefaultCmdLoad",!0),C(e)}function U(){if(n&&(n.setSetting("activateWidgetLink",!0),n.setSetting("useNewUXGuidelinesWP",!0)),!c){S("_PIM_UWA widget loading","_PIM_widgetLoad",!0),A("_PIM_LoadJSPAD3DViewer");var i=new Promise(function(e){require(["DS/PADUtils/PADSharedSettings"],t=>{t.addSharedSettings(u,["showWelcomePanel"]),e()})}),o=new Promise(function(e){require(["DS/CATWebUXPreferences/CATWebUXPreferencesManager","text!DS/PIMwebI3Dapp/assets/json/PIMwebI3DWindowOptions.json"],function(t,n){S("_PIM_PAD3DViewer load JS","_PIM_LoadJSPAD3DViewer",!0),A("_PIM_PAD3DViewerReady"),b=t,e([n])})}),s=new Promise(e=>{require(["DS/ENOXInterWdgCom/LinkManager"],t=>{t.initializeWidgetLink(u,{appIds:[],uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXLandingPageSync"],open:!0}).then(e)})});Promise.all([i,o,s]).then(function(i){n=require("DS/PADUtils/PADSettingsMgt");var o=e.extend({context:"Default",workbench:D.file,workbenchModule:D.module},JSON.parse(i[1][0]));require("DS/PADUtils/PADUtilsServices").isCloud()&&n.setSetting("mouseProfile",window.__mouseProfile),c=r,t.init(c,{executionContext:l}),require(["DS/CATWebUXComponents/DMUCommandsManager"],function(e){var t;(d=e).dmuSetExecutionContext(r.getExecutionContext()),d.dmuSetHandlerComponent(r.getExecutionContext()),o.mouseProfile&&c.getViewpoint().setDefaultController(!0,o.mouseProfile),b.getPreferenceManager({context:c.getFrameWindow()}).removeAllPreferences(),c.setOption("propertiesFacet",n.getSetting("propertiesFacet")),c.setAuthorizedRootTypes(n.getSetting("ups_authorized_root_types")),c.setDefaultContextualBarVisibility(!0),c.setDefaultContextualMenuVisibility(!0),c.setOpenWithMenuAvailability(!0),l&&E(c),w=c.subscribe({event:"onActionBarReady"},E),c.subscribe({event:"onRootAdded"},I),c.subscribe({event:"onRootRemoved"},I),c.subscribe({event:"onRootAttached"},I),c.subscribe({event:"onRootDetached"},I),c.subscribe({event:"onContentNameModified"},I),c.subscribe({event:"onBeginRootLoading"},function(){var e=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),t=window.document.getElementsByClassName("DMULoadingPanel");e.length&&(e[0].dsModel.off(),e[0].dsModel.destroy(),e=null),t.length&&t[0].destroy()}),n.setSetting("settypes",!0),"1"===u.getValue("widgetForODTReplay")&&u.dispatchEvent("onPAD3DViewerCreated",[{pad3DViewer:c}]),a.done&&a.done({appMainDiv:f,pad3DViewer:c}),(t=c).unsubscribe(g),g=null,I(),_(),require("DS/PADUtils/PADUtilsServices").isCloud()&&!window.__preventPrefPanel&&t.getViewer().displayIntroductoryControlPreferencePanel(),A("_PIM_beforeAppComponentLoad"),require(["DS/PIMwebViewController/PIMwebItfCtrl"],function(e){S("_PIM_AppComponentLoading","_PIM_beforeAppComponentLoad",!0),(p=e.getItfCtrl({pad3DViewer:t})).activate({readOnly:!1}),C(t)})})})}}function W(){!function(){var e=n.getSetting("enopad3dviewer_roles");let t=!0,i=require("DS/PADUtils/PADUtilsServices").isCloud(),o=require("DS/PADUtils/PADSession").isAuthoring();for(var a=0;a<e.length;a++)if("E19"===e[a].id&&(!e[a].platforms||e[a].platforms&&e[a].platforms.indexOf(require("DS/PADUtils/PADUtilsServices").getPlatformId())>-1)){t=!1;break}n.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",t&&!i&&!o),n.setSetting("enopad3dviewer_staticMappingSupportActivated",!o)}(),c&&c.refresh()}function N(){p&&(P&&P.forEach(p.unsubscribe,p),p.dereference()),i=o=u=c=m=f=d=p=b=null,P=[]}function L(){var e=c;N(),e&&e.destroy()}function X(e){c&&c.search({searchQuery:e})}return class{constructor(n){if(!n||!n.data)throw new Error("App identification is missing! Unable to init app");if("I3D"!==n.data&&"I3S"!==n.data)throw new Error("Invalid app id: "+n.data);return"I3D"===n.data&&i?i:"I3S"===n.data&&o?o:(a=n,u=n.widget,r=n.viewer,l=n.executionContext,f=n.appMainDiv,D={module:"PIMweb"+n.data+"app",file:"PIMweb"+n.data+"appWkb.xml"},""!==window.location.search&&(e.extend(v,e.Utils.parseQuery(window.location.search)),v.widgetDomain&&e.extend(v,e.Utils.parseQuery(v.widgetDomain))),"testWkb"in v&&(D={module:"PIMwebI3Dtst",file:"PIMwebI3DappTestWkb.xml"}),"I3S"===n.data&&require(["DS/PIMwebViewModel/PIMwebIsrMgr"].concat([]),function(e){e.isUpdateSimulationAllowed()&&(D={module:"PIMweb"+n.data+"app",file:"PIMweb"+n.data+"OnCloudappWkb.xml"})}),c?u.addEvent("onDestroy",N):(S("_PIM_JS dependencies loading","PIM_jsAppLoad",!1),A("_PIM_widgetLoad"),n.viewerAttachment?(m=n.viewerAttachment,U()):(m=function(e){u.setBody(e)},u.addEvent("onLoad",U)),u.addEvent("onRefresh",W),u.addEvent("onDestroy",L),u.addEvent("onSearch",X),u.setMetas({helpPath:"PIMwebI3Dapp/assets/help"})),this.setUp=function(){Promise.all([d?Promise.resolve():new Promise(function(e){require(["DS/CATWebUXComponents/DMUCommandsManager"],function(t){d=t,e()})}),b?Promise.resolve():new Promise(function(e){require(["DS/CATWebUXPreferences/CATWebUXPreferencesManager"],function(t){b=t,e()})})]).then(function(){d.refreshCommandsManager(r.getExecutionContext()),u.addEvent("onRefresh",W),u.addEvent("onSearch",X),u.setMetas({helpPath:"PIMwebI3Dapp/assets/help"}),n.sourceApp&&n.sourceApp.pad3DViewer!==c&&(p&&p.dereference(),p=null,c=n.sourceApp.pad3DViewer,t.init(c)),c.setOption("propertiesFacet",require("DS/PADUtils/PADSettingsMgt").getSetting("propertiesFacet")),c.getBIController().toggleBetweenStandaloneAndSlaveMode("DUAL"),x(c),I(),c.setDefaultContextualBarVisibility(!0),c.setDefaultContextualMenuVisibility(!0),c.setOpenWithMenuAvailability(!0),b.getPreferenceManager({context:c.getFrameWindow()}).removeAllPreferences();var e=new Promise(function(e){var t=c.subscribe({event:"onActionBarReady"},function(){c.unsubscribe(t),l||d.setDefaultCommand({ID:"PIMwebDefaultHdr",className:"DS/PIMwebViewController/PIMwebDefaultCmd",context:h}),e()});c.loadActionBar({merge:!1,file:D.file,module:D.module})});require("DS/ENOXInterWdgCom/LinkManager").updateLinkability({appIds:[],open:!0,uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXLandingPageSync"]}),require("DS/PADUtils/PADSettingsMgt").setSetting("activateWidgetLink",!0),require("DS/PADUtils/PADSettingsMgt").setSetting("useNewUXGuidelinesWP",!0);var i=new Promise(function(e){p?e():require(["DS/PIMwebViewController/PIMwebItfCtrl"],function(t){(p=t.giveItfCtrl({pad3DViewer:c}))||(u.deleteValue("ItfSimuInSession"),p=t.getItfCtrl({pad3DViewer:c})),e()})}).then(function(){p.activate({readOnly:!1}),n.sourceApp&&n.sourceApp.issues&&n.sourceApp.issues.length>0&&p.appInitFromTransition({issues:n.sourceApp.issues,onNoActionDone:function(){}})});Promise.all([e,i]).then(function(){n.done({appMainDiv:f,pad3DViewer:c})})})},this.dispose=function(e){if(u.removeEvent("onRefresh",W),u.removeEvent("onSearch",X),u.removeEvent("endEdit",y),V&&V(),c&&c.setOpenWithMenuAvailability(!1),p&&p.deactivate(),e){var n=u.getValue("ItfSimuInSession");(n=n?JSON.parse(n):null)&&!Array.isArray(n)&&"object"==typeof n&&1===Object.keys(n).length&&(e.preferredType="SIMItfSimulation")}var i=b.givePreferenceManager({context:c.getFrameWindow()});i&&i.removeAllPreferences(),b.unreferencePreferenceManager({context:c.getFrameWindow()}),t.reset(),s=null},void(this.onWillLeave=function(){}))}}}),define("DS/PIMwebI3Dapp/PIMI3AppInit",["DS/WAfrContainer/App","UWA/Core","DS/Controls/Loader","i18n!DS/PIMwebI3Dapp/assets/nls/PIMwebI3Dapp"],function(e,t,n,i){"use strict";var o,a,r={I3D:null,I3S:null};return e.extend({setUp:function(e){var s=this;let l="ENOI3D_AP"===this.options.id?"I3D":"I3S";if(window.widget.getValue("X3DContentId")){var d="",p=JSON.parse(window.widget.getValue("X3DContentId"));p.data&&p.data.items&&p.data.items[0]&&p.data.items[0].displayName&&(d=p.data.items[0].displayName);var u=t.createElement("div",{class:"DMULoadingPanel"}).inject(document.body);(a=new n({text:i.loadingMessage+" "+d}).inject(u)).on(),a.getContent().addClassName("DMULoadingPanelInfoDiv");var c=a.elements.label.getSize().width,f=a.elements.progressBar.getContent().getSize().width,m=a.elements.progressBar.getContent().getSize().height,g=c+f;u.setStyles({position:"absolute",bottom:"0",left:"0","z-index":"40000","background-color":"rgba(255,255,255,1",height:"100%",width:"100%"}),a.getContent().setStyles({position:"absolute",left:"calc(50% - "+g/2+"px)",top:"calc(50% - "+m/2+"px)"})}return e.sourceApp?e.sourceApp.pad3DViewer?(this.pad3DViewer=e.sourceApp.pad3DViewer,this.appMainDiv=e.sourceApp.appMainDiv,void new Promise(function(t){r[l]?(e.done&&e.done(),t(r[l])):require(["DS/PIMwebI3Dapp/PIMI3AppMain"],function(n){r[l]=new n({widget:window.widget,pad3DViewer:e.sourceApp.pad3DViewer,appMainDiv:e.sourceApp.appMainDiv,viewer:s.getExecutionContext().getComponent("Viewer"),executionContext:s.getExecutionContext(),data:l}),e.done&&e.done(),t(r[l])})}).then(function(t){e.sourceApp&&!e.sourceApp.isDisposeCalled()&&e.sourceApp.dispose(e);var n=e.done;e.done=function(t){var i;s.appMainDiv||(s.appMainDiv=t.appMainDiv),e.done=n,"ENX3DIR_AP"===e.sourceApp.options.id&&((i=s).switchApp&&require(["DS/CATWebUXComponents/CATWebUXInfoFlag","DS/CATWebUXSlideShow/CATWebUXSlideShowController","i18n!DS/PIMwebI3Dapp/assets/nls/PIMwebI3Dapp","DS/Utilities/TouchUtils"],function(e,t,n,a){var r=new e({frameWindow:i.pad3DViewer.getFrameWindow(),viewer:i.pad3DViewer.getViewer(),dockingSide:"left"});r.display({label:n.backToIssue,style:"webUXStyle",fontIcon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-move-to-start",onClickCB:function(){o(),o=null,i.switchApp("ENX3DIR_AP")},compactDisplay:function(e){var t=document.querySelector(".pimWebOpacitySlider");if(t&&!t.isHidden())return e.flagOffset+e.flagWidth>.5*(e.freeZoneWidth-(a.getTouchMode()?470:398))}});var s,l=t.getSlideShowController({context:i.pad3DViewer.getFrameWindow(),id:"PIMwebSlideShow",params:{activateRotation:!0}});l&&(s=l.subscribe("onActiveStateModified",function(e){r.setVisibleFlag(!e.state)})),o=function(){r.clean();var e=t.giveSlideShowController({context:i.pad3DViewer.getFrameWindow(),id:"PIMwebSlideShow"});e&&e.unsubscribe(s)}})),e.done()},t.setUp(e)})):(window.console.log("pad3DViewer property must be valuated"),void e.done()):new Promise(t=>{require(["DS/PIMwebI3Dapp/PIMI3AppMain"],function(t){r[l]=new t({widget:window.widget,viewer:s.getExecutionContext().getComponent("Viewer"),executionContext:s.getExecutionContext(),viewerAttachment:e.done,data:l,done:function(e){s.pad3DViewer=e.pad3DViewer,s.appMainDiv=e.appMainDiv}})}),e.done&&e.done(),t()})},dispose:function(e,t){o&&o(),o=null;let n=t||(this.options.id&&this.options.id.includes("I3D")?"I3D":"I3S");r[n].dispose(e),a&&(a.destroy(),a=null);var i=window.document.getElementsByClassName("DMULoadingPanel");i.length&&i[0].destroy(),this._parent(e)},onWillEnter:function(e){return require(["DS/PIMwebViewModel/PIMwebUtils","DS/PADUtils/PADSettingsMgt"],function(t,n){n.setSetting("enopad3dviewer_staticMappingSupportActivated",!0),t._sendUsageProbe("appTransitionFrom",e.options.id,"resolved")}),this._parent(e)},onWillLeave:function(e,t){return r[t]&&r[t].onWillLeave&&r[t].onWillLeave(e),require(["DS/PIMwebViewModel/PIMwebUtils"],function(t){t._sendUsageProbe("appTransitionTo",e.options.id,"resolved")}),this._parent(e)}})}),define("DS/PIMwebI3Dapp/PIMwebI3DappInitAdapt",["DS/WAfrContainer/App","UWA/Core","DS/Controls/Loader","i18n!DS/PIMwebI3Dapp/assets/nls/PIMwebI3Dapp"],function(e,t,n,i){"use strict";var o,a,r={I3D:null,I3S:null};return e.extend({setUp:function(e,s){var l=this;if(window.widget.getValue("X3DContentId")){var d="",p=JSON.parse(window.widget.getValue("X3DContentId"));p.data&&p.data.items&&p.data.items[0]&&p.data.items[0].displayName&&(d=p.data.items[0].displayName);var u=t.createElement("div",{class:"DMULoadingPanel"}).inject(document.body);(a=new n({text:i.loadingMessage+" "+d}).inject(u)).on(),a.getContent().addClassName("DMULoadingPanelInfoDiv");var c=a.elements.label.getSize().width,f=a.elements.progressBar.getContent().getSize().width,m=a.elements.progressBar.getContent().getSize().height,g=c+f;u.setStyles({position:"absolute",bottom:"0",left:"0","z-index":"40000","background-color":"rgba(255,255,255,1",height:"100%",width:"100%"}),a.getContent().setStyles({position:"absolute",left:"calc(50% - "+g/2+"px)",top:"calc(50% - "+m/2+"px)"})}if(e.sourceApp){if(!e.sourceApp.pad3DViewer)return window.console.log("pad3DViewer property must be valuated"),void e.done();this.pad3DViewer=e.sourceApp.pad3DViewer,this.appMainDiv=e.sourceApp.appMainDiv,new Promise(function(t){r[s]?t(r[s]):require(["DS/PIMwebI3Dapp/PIMwebAppMain"],function(n){r[s]=n.getApp({widget:window.widget,pad3DViewer:e.sourceApp.pad3DViewer,appMainDiv:e.sourceApp.appMainDiv,data:s}),t(r[s])})}).then(function(t){e.sourceApp&&!e.sourceApp.isDisposeCalled()&&e.sourceApp.dispose(e);var n=e.done;e.done=function(t){var i;l.appMainDiv||(l.appMainDiv=t.appMainDiv),e.done=n,"ENX3DIR_AP"===e.sourceApp.options.id&&((i=l).switchApp&&require(["DS/CATWebUXComponents/CATWebUXInfoFlag","DS/CATWebUXSlideShow/CATWebUXSlideShowController","i18n!DS/PIMwebI3Dapp/assets/nls/PIMwebI3Dapp","DS/Utilities/TouchUtils"],function(e,t,n,a){var r=new e({frameWindow:i.pad3DViewer.getFrameWindow(),viewer:i.pad3DViewer.getViewer(),dockingSide:"left"});r.display({label:n.backToIssue,style:"webUXStyle",fontIcon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-move-to-start",onClickCB:function(){o(),o=null,i.switchApp("ENX3DIR_AP")},compactDisplay:function(e){var t=document.querySelector(".pimWebOpacitySlider");if(t&&!t.isHidden())return e.flagOffset+e.flagWidth>.5*(e.freeZoneWidth-(a.getTouchMode()?470:398))}});var s,l=t.getSlideShowController({context:i.pad3DViewer.getFrameWindow(),id:"PIMwebSlideShow",params:{activateRotation:!0}});l&&(s=l.subscribe("onActiveStateModified",function(e){r.setVisibleFlag(!e.state)})),o=function(){r.clean();var e=t.giveSlideShowController({context:i.pad3DViewer.getFrameWindow(),id:"PIMwebSlideShow"});e&&e.unsubscribe(s)}})),e.done()},t.setUp(e)})}else require(["DS/PIMwebI3Dapp/PIMwebAppMain"],function(t){r[s]=t.getApp({widget:window.widget,viewerAttachment:e.done,data:s,done:function(e){l.pad3DViewer=e.pad3DViewer,l.appMainDiv=e.appMainDiv}})})},dispose:function(e,t){o&&o(),o=null,r[t].dispose(e),a&&(a.destroy(),a=null);var n=window.document.getElementsByClassName("DMULoadingPanel");n.length&&n[0].destroy(),this._parent(e)},onWillEnter:function(e){return require(["DS/PIMwebViewModel/PIMwebUtils","DS/PADUtils/PADSettingsMgt"],function(t,n){n.setSetting("enopad3dviewer_staticMappingSupportActivated",!0),t._sendUsageProbe("appTransitionFrom",e.options.id,"resolved")}),this._parent(e)},onWillLeave:function(e,t){return r[t]&&r[t].onWillLeave&&r[t].onWillLeave(e),require(["DS/PIMwebViewModel/PIMwebUtils"],function(t){t._sendUsageProbe("appTransitionTo",e.options.id,"resolved")}),this._parent(e)}})}),define("DS/PIMwebI3Dapp/PIMwebI3DappInit",["DS/PIMwebI3Dapp/PIMwebI3DappInitAdapt"],function(e){"use strict";return e.extend({setUp:function(e){this._parent(e,"I3D")},dispose:function(e){this._parent(e,"I3D")},onWillEnter:function(e){return this._parent(e,"I3D")},onWillLeave:function(e){return this._parent(e,"I3D")}})});