/*!  COPYRIGHT DASSAULT SYSTEMES 2015   */
define("DS/SNNavigationMap/utils/PromisesManager",["UWA/Class","UWA/Promise","DS/WAFData/WAFData","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a){"use strict";return e.extend({init:function(e){this._debug=e.debugMode||!1,this._notifManager=s,o.setNotificationManager(this._notifManager)},createPromise:function(t,s){var o={},r={},l=this;return this._debug&&t.params&&(t.params.debug=!0),s||(s="POST"),t.params&&(t.params.label="RelationalExplorer",o=JSON.stringify(t.params)),new e.Promise(function(e,d){i.authenticatedRequest(t.url,{headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:t.xPrefCredential},method:s,data:o,onComplete:function(i){t.onComplete?t.onComplete(i).then(function(t){e(t)}):e(i)},timeout:t.timeout,onFailure:function(e){r=t.failureParams?t.failureParams:{level:"error",message:n.get("generic"),sticky:!0},console.log(e),t.noErrorMsg||l._notifManager.addNotif(r),d(e)},onTimeout:function(e){console.log(e),l._notifManager.addNotif({level:"error",msg:a.get("timeout"),subtitle:a.get("verifyConnection"),sticky:!0}),d(e)}})})}})}),define("DS/SNNavigationMap/utils/MapSecurityCtxConverter",["UWA/Class","UWA/Promise"],function(e,t){"use strict";return e.singleton({init:function(){},buildSecurityContext:function(e,t,i){return"ctx::"+i+"."+t+"."+e},buildDisplayString:function(e,t,i,n){return n?e+" ● "+i:e+" ● "+t+" ● "+i},extractCouple:function(e){var t="",i="",n="",s="";for(var o in e){var a=e[o];switch(o){case"organization":i=a.title?a.title:a.name,t=a.name;break;case"role":n=a.name,s=a.nls?a.nls:n}}return{org:t,orgLabel:i,role:n,roleNls:s}},prepareForStorage:function(e){var t,i,n,s,o=e.pid,a=[],r=null,l=!0;for(var d in e.preferredcredentials){var c=e.preferredcredentials[d];switch(d){case"collabspace":i=c.name;break;case"organization":n=c.name;break;case"role":s=c.name}}for(var h in t=this.buildSecurityContext(i,n,s),e.collabspaces){if((p=e.collabspaces[h]).couples&&p.couples.length)for(var u=0;u<p.couples.length;u++){var g=this.extractCouple(p.couples[u]);if(null===r)r=g.org;else if(r!=g.org){l=!1;break}}}for(var h in e.collabspaces){var p;if((p=e.collabspaces[h]).couples&&p.couples.length)for(u=0;u<p.couples.length;u++){g=this.extractCouple(p.couples[u]);var f=this.buildSecurityContext(p.name,g.org,g.role),m=p.title?p.title:p.name,v={csName:m,label:this.buildDisplayString(m,g.orgLabel,g.roleNls,l),value:f};t===f&&(v.isDefault=!0),a.push(v)}}return{userId:o,securityContext:t,cspaces:a}},getSecurityContext:function(e){var t="string"==typeof e?JSON.parse(e):e,i=this.prepareForStorage(t),n=i.securityContext;return void 0!==i.cspaces.find(e=>e.value===n)||(i.cspaces&&i.cspaces.length>0?i.securityContext=i.cspaces[0].value:i.securityContext=void 0),i}})}),define("DS/SNNavigationMap/models/Count",["UWA/Class/Model","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t){"use strict";return e.extend({defaults:{id:"",count:0,name:"",direction:"",source:"",relationName:""},setup:function(e,i){this._parent(e,i),e.name&&this.set("relationName",t[e.name+"_short"]||t[e.name])},parse:function(e){return count=UWA.extend(count,{id:e.id,count:e.count,name:e.name,direction:e.direction,source:e.source,relationName:t[e.name+"_short"]||t[e.name]}),count}})}),define("DS/SNNavigationMap/views/NavigationPager",["UWA/Core","UWA/Class/View","DS/Handlebars/Handlebars4","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","text!DS/SNNavigationMap/assets/templates/pager.html"],function(e,t,i,n,s){"use strict";return t.extend({name:"navigationapp-homepage-view",_matchedNodes:[],_selectedIndex:0,className:function(){return this.getClassNames("-container")},setup:function(t){this._debug=t.debugMode,this._widgetId=t.widgetId||null,this._isWebInWin=t.isWebInWin;var o=i.compile(s),a={previousTitle:n.get("Pager-Previous"),nextTitle:n.get("Pager-Next"),closeTitle:n.get("Pager-Close")},r=o.call(null,a);e.createElement("div",{class:"ENORIPE-pager-container",html:r}).inject(this.container);this._isWebInWin&&this.container.addClassName("enoripe-pager-native"),this._setUpEvents()},render:function(e){if(e&&e.result&&e.result.length&&e.result.length>0){if(this.container.show(),this._matchedNodes=[...new Set(e.result)],this._matchedNodes.push("All"),this._selectedIndex=0,this._setCount(this._matchedNodes.length),!e.noChangeFocus){var t=this._matchedNodes[this._selectedIndex];t&&this.dispatchEvent("ENORIPE_HighlightNode",t)}}else this.container.hide()},_setCount:function(e){var t=this._selectedIndex+1,i=this._selectedIndex+1+"/"+(e-1),n=this.getElement(".ENORIPEPagerLabel");t===e&&(i="All"),n&&n.setContent(i)},_clearCount:function(){var e=this.getElement(".ENORIPEPagerLabel");e&&e.empty()},_setUpEvents:function(){this.getElement(".ENORIPEPagerPreviousButton").addEventListener("click",this._prevClick.bind(this)),this.getElement(".ENORIPEPagerNextButton").addEventListener("click",this._nextClick.bind(this)),this.getElement(".ENORIPEPagerCloseButton").addEventListener("click",this._closeClick.bind(this))},_nextClick:function(){if(this._matchedNodes&&this._matchedNodes.length>0){this._selectedIndex===this._matchedNodes.length-1?this._selectedIndex=0:this._selectedIndex++,this._setCount(this._matchedNodes.length);var e=this._matchedNodes[this._selectedIndex];e&&this.dispatchEvent("ENORIPE_HighlightNode",e)}},_prevClick:function(){if(this._matchedNodes&&this._matchedNodes.length>0){0===this._selectedIndex?this._selectedIndex=this._matchedNodes.length-1:this._selectedIndex--,this._setCount(this._matchedNodes.length);var e=this._matchedNodes[this._selectedIndex];e&&this.dispatchEvent("ENORIPE_HighlightNode",e)}},_closeClick:function(){this.closePager(),this.dispatchEvent("ENORIPE_NavPagerClose")},closePager:function(){this._selectedIndex=0,this._matchedNodes=[],this._clearCount(),this.container.hide()},destroy:function(){this._parent(),this.container.destroy(),this.container=null}})}),define("DS/SNNavigationMap/views/SearchViewForNative",["UWA/Core","UWA/Class/View","DS/UIKIT/Autocomplete","DS/Handlebars/Handlebars4","text!DS/SNNavigationMap/assets/templates/searchview.html","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o){"use strict";return t.extend({name:"search-native-view",className:function(){return this.getClassNames("-container")},setup:function(e){this._template=n.compile(s),this.container.inject(e.renderTo)},render:function(){var t=this._template.call(null,{clearSearch:o.get("SNNFind_clearSearch"),runSearch:o.get("MapSearchView_search")});return e.createElement("div",{class:"enoripe_search_container",html:t}).inject(this.container),this._setupSearchInput(this.getElement(".enoripe_search_autocomplete_container")),this._setUpEvents(),this},_setUpEvents:function(){var e=this.getElement("#enoripe_clear_search"),t=this.getElement("#enoripe_run_search");e.addEventListener("click",this.clearSearch.bind(this)),t.addEventListener("click",this._performSearch.bind(this)),e.hide()},_onKeyUp:function(e){this._delayTimer&&clearTimeout(this._delayTimer);var t=this;this._delayTimer=setTimeout(function(){var i;i=(e.srcElement||e.target).value,t._handleInput(i),"Enter"!==e.key&&13!==e.keyCode||""!==i&&t._performSearch()},500)},_performSearch:function(){var e=this._autocompleteInput.getSelection();this.dispatchEvent("ENORIPE_performSearch_native",e)},_setupSearchInput:function(e){if(e){this._autocompleteInput=new i({noResultsMessage:!1,showSuggestsOnFocus:!0,closableItems:!1,allowFreeInput:!0,events:{onKeyUp:this._onKeyUp.bind(this)},placeholder:o.get("MapSearchView_search")}).inject(e)}},_handleInput:function(e){var t=this.getElement("#enoripe_clear_search");e.length>0?t.show():t.hide()},clearSearch:function(){this.getElement("#enoripe_clear_search").hide(),this._autocompleteInput.reset(),this.dispatchEvent("ENORIPE_resetSearch_native")},_close:function(){},destroy:function(){this.container=null,this._parent()}})}),define("DS/SNNavigationMap/utils/AdditionalColumnsUtils",["UWA/Class","UWA/Class/Options"],function(e,t){"use strict";return e.singleton(t,{init:function(){},getConfigurationColumns:function(){let e=[],t=[];var i=new Promise(function(t){require(["DS/CfgWebAppEffectivityUX/scripts/CfgEffectivityColumns"],function(n){n.isAdditionalColumnsAvailable(function(i){if(!0===i){let t=[];n.getAdditionalColumnsUXDGV(t),t.forEach(t=>{t.columnModule="cfgEffectivty",e.push(t)})}t()}),i.name="Add "+n.getName()})});return t.push(i),Promise.all(t).then(function(){return e})}})}),define("DS/SNNavigationMap/utils/NlsManager",["UWA/Class","UWA/Core","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_DEC","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_V6Design","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_V6Manufacturing","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Customer","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Simulation","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_DBM","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_V6Knowledgeware","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Material","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_GEBOM","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_ReviewInterference","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_SimulationProcess","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_ECM","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_DPM","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_AER","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Issue","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_ModelDefinition","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_RFL","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_PowerBySolidworks","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_PowerByCATIAV5","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Electronic","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_SystemsArchitecture","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_RequirementManager","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_RTEXP","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_EngineeringDefinition","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_XSourcingApps","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_AnalyticsCase","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_RAMS","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Fastener","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_VRP","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_RouteManagement","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_EngineeringConnection","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Deformability","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_IPClassification","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Meeting.json","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_RelativePosition","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_DataSetup","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_PerformanceSpec","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_V6PLMTranslation","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_DIF","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_Report","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_XTDPApp","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_XLC"],function(e,t,i,n,s,o,a,r,l,d,c,h,u,g,p,f,m,v,_,S,b,N,w,C,I,E,y,D,M,P,O,x,T,A,R,V,k,L,F,U,j,W,B,z,H){"use strict";return e.singleton({name:"navigation_relset_nls",getNls:function(){return t.merge(n,n),t.merge(n,s),t.merge(n,o),t.merge(n,a),t.merge(n,r),t.merge(n,l),t.merge(n,d),t.merge(n,c),t.merge(n,h),t.merge(n,u),t.merge(n,g),t.merge(n,p),t.merge(n,f),t.merge(n,m),t.merge(n,v),t.merge(n,_),t.merge(n,S),t.merge(n,b),t.merge(n,N),t.merge(n,w),t.merge(n,C),t.merge(n,I),t.merge(n,E),t.merge(n,y),t.merge(n,D),t.merge(n,M),t.merge(n,P),t.merge(n,O),t.merge(n,x),t.merge(n,T),t.merge(n,A),t.merge(n,R),t.merge(n,V),t.merge(n,k),t.merge(n,L),t.merge(n,F),t.merge(n,U),t.merge(n,j),t.merge(n,W),t.merge(n,B),t.merge(n,z),t.merge(n,H),n}})}),define("DS/SNNavigationMap/MapSettings",["text!DS/SNNavigationMap/assets/SNNavigationMap.settings.json","UWA/Class","UWA/Core","UWA/Class/Options","UWA/Promise","DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SNNavigationMap/utils/MapSecurityCtxConverter","DS/ENOXWidgetPreferences/js/ENOXWidgetPreferences","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a,r,l,d,c){"use strict";return t.singleton(n,{name:"navigation_map_settings",options:{},init:function(){var t=JSON.parse(e);this.setOptions(t);var i=window.location.search.substring(1);this._updateSettingsFromURLParameters(i);var n=this.getOption("widgetDomain");if(void 0!==n){var s=new URL(decodeURIComponent(n)).search.substring(1);this._updateSettingsFromURLParameters(s)}},getLang:function(){return this.getOption("lang")},getAddinMode:function(){return this.getOption("addinmode")},getYOffset:function(){return"x"===this.getLayoutAxis()?"thumbnailsMode"===this.getThumbnailsMode()?150:75:250},getNodesWidth:function(){return 170},getNodesHeight:function(){return"thumbnailsMode"===this.getThumbnailsMode()?130:65},getExpendHeight:function(){return 23},getLayoutMode:function(){return this.getOption("layoutMode")},getRootIds:function(){return this.getOption("rootIds")},setRootIds:function(e){this.setOption("rootIds",e)},setTypeLayoutView:function(e){e&&null!=e&&this.setOption("typeLayoutView",e)},setLayoutMode:function(e){"true"===e||"recompute"===e||!0===e?this.setOption("layoutMode","recompute"):this.setOption("layoutMode",!1)},getLayoutType:function(){return this.getOption("layoutType")},setLayoutType:function(e){e&&this.setOption("layoutType",e)},getThumbnailsMode:function(){return this.getOption("thumbnails2d")},setThumbnailsMode:function(e){"true"===e||"thumbnailsMode"===e||!0===e||void 0===e?this.setOption("thumbnails2d","thumbnailsMode"):this.setOption("thumbnails2d",!1)},getInstancesMode:function(){return this.getOption("showInstances")},setInstancesMode:function(e){"true"===e||"showInstance"===e||!0===e?this.setOption("showInstances",!0):this.setOption("showInstances",!1)},getPublicationsMode:function(){return this.getOption("showPublications")},setPublicationsMode:function(e){"true"===e||"showPublications"===e||!0===e?this.setOption("showPublications",!0):this.setOption("showPublications",!1)},getGhostMode:function(){return this.getOption("showGhost")},setGhostMode:function(e){"true"===e||"showGhost"===e||!0===e?this.setOption("showGhost",!0):this.setOption("showGhost",!1)},getListViewPanelWidth:function(){return this.getOption("listViewPanelWidth")},setListViewPanelWidth:function(e){e&&e>0&&this.setOption("listViewPanelWidth",e)},setInformationPanelStatus:function(e){"true"===e.isInformationPanelVisible||!0===e.isInformationPanelVisible?this.setOption("isInformationPanelVisible",!0):this.setOption("isInformationPanelVisible",!1)},setLastUsedProfile:function(e){""!==e&&this.setOption("LastUsedProfile",e)},getLastUsedProfile:function(){return this.getOption("LastUsedProfile")},setDefaultAttributesInit:function(e){for(var t=this.getOption("attributes"),i=[],n=0;n<t.length;n++)i.push({uri:t[n],label:c.get(t[n])});var s={AllTypes:{name:"AllTypes",nlsLabel:c.get("AllTypes"),attributes:i},EnoripeColumns:{name:"EnoripeColumns",nlsLabel:c.get("DatagridColumns"),attributes:i}};this.setJSONAttributes(s),e&&0!==Object.keys(e).length||(e=s),this.setDefaultAttributes(e)},setDefaultAttributes:function(e){this.setOption("defaultAttributes"),this.setOption("defaultAttributes",e)},getDefaultAttributes:function(){return this.getOption("defaultAttributes")},setJSONAttributes:function(e){this.setOption("attributesFromJSON"),this.setOption("attributesFromJSON",e)},getJSONAttributes:function(){return this.getOption("attributesFromJSON")},getInformationPanelVisibility:function(){return this.getOption("isInformationPanelVisible")},getLayoutAxis:function(){return this.getOption("layoutAxis")},getLayoutDirection:function(){return this.getOption("layoutDirection")},getLabelPredicates:function(){return this.getOption("labelPredicates")},getDetailPredicates:function(){return this.getOption("detailPredicates")},getExportLimit:function(){return this.getOption("exportLimit")},getAppId:function(){return"undefined"!=typeof widget&&widget.getValue("appId")||"ENORIPE_AP"},getWidgetId:function(){return this.getOption("widgetId")?this.getOption("widgetId"):"undefined"==typeof widget||this.isWebInWin()?"WebInWinId":widget.id},getExcludedAttributes:function(){return this.getOption("excludedAttributes")},getFetchAttributes:function(){return this.getOption("fetchAttributes")},setWidgetId:function(e){this.setOption("widgetId",e)},_getListOfSecurityContextAndPreferredOne:function(){var e,t,i=this;return new s(function(n,s){i.getAllSecurityContexts().then(function(o){var a=[];if(o&&o.cspaces){var r=o.cspaces;(!Array.isArray(r)||r.length<=0)&&s("collabspaces not found");for(var l=0;l<r.length;l++)a[l]={label:r[l].label,value:r[l].value};e=JSON.stringify(a),o.securityContext?(i.setSelectedSC(o.securityContext),t=o.securityContext):(i.setSelectedSC(a[0].value),t=a[0].value),n({securityContexts:e,preferredSecurityContext:t})}else s("collabspaces not found")})})},_getListOfSecurityContext:function(){var e=this;return new s(function(t,i){e.getAllSecurityContexts().then(function(n){var s=[];if(n&&n.cspaces){var o=n.cspaces;if(Array.isArray(o))for(var a=0;a<o.length;a++)s[a]={label:o[a].label,value:o[a].value};JSON.stringify(s),s.length>0&&e.setSelectedSC(s[0].value),t(s)}else i("collabspaces not found")})})},setSelectedSC:function(e){sessionStorage.setItem("Map_selectedSecurityContext",JSON.stringify(e))},getRoles:function(){var e=this.getOption("user_granted_roles"),t=[];if(e&&("string"!=typeof e||"{"!==e[0]&&"["!==e[0]||(e=JSON.parse(e)),i.is(e,"array")))for(var n=0;n<e.length;n++)t.push(e[n].id);return t},getPlatformId:function(){return this.getCurrentTenantName()},get3DSpaceUrl:function(){if(!i.is(this.getOption("platform_services"),"array")&&"ODT_MODE"!==this.getOption("platform_services"))throw new Error("Platform services not initialize yet");var e=this.getCurrentTenantId();return this.getOption("platform_services")[e]["3DSpace"]},get3DSwymUrl:function(){if(!i.is(this.getOption("platform_services"),"array")&&"ODT_MODE"!==this.getOption("platform_services"))throw new Error("Platform services not initialize yet");var e=this.getCurrentTenantId();return this.getOption("platform_services")[e]["3DSwym"]},get3DAppsUrl:function(){if(!i.is(this.getOption("platform_services"),"array")&&"ODT_MODE"!==this.getOption("platform_services"))throw new Error("Platform services not initialize yet");const e=this.getCurrentTenantId();return this.getOption("platform_services")[e]["3DCompass"]},get3DSearchUrl:function(){if(!i.is(this.getOption("platform_services"),"array")&&"ODT_MODE"!==this.getOption("platform_services"))throw new Error("Platform services not initialize yet");var e=this.getCurrentTenantId();return this.isWebInWin()?this.getOption("platform_services")[e].Federated:this.getOption("platform_services")[e]["3DSearch"]},getMyAppsUrl:function(){return this.getOption("myappsurl")?this.getOption("myappsurl"):(console.warn("myappsurl value empty"),"")},setMyAppsUrl:function(){var e=this;this.getOption("myappsurl")||window&&window.dscef&&window.dscef.getMyAppsURL&&window.dscef.getMyAppsURL().then(function(t){e.setOption("myappsurl",t)})},setLang:function(e){this.setOption("lang",e)},getCurrentTenantName:function(){return this._currentTenant},getCurrentTenantLabel:function(){for(var e=this.getCurrentTenantName(),t=this.getTenantsPreference(),i=0;i<t.length;i++)if(e===t[i].value&&void 0!==t[i].label){e=t[i].label;break}return e},get_current_tenant_idx:function(){if(null!=current_tenant&&"undefined"!=typeof current_tenant&&!Number.isNaN(current_tenant)){var e=current_tenant;if(null===current_tenant_idx||"undefined"==typeof current_tenant_idx||Number.isNaN(current_tenant_idx)||platform_services[current_tenant_idx].displayName!==e)for(var t=0;t<platform_services.length&&(null===current_tenant_idx||"undefined"==typeof current_tenant_idx||Number.isNaN(current_tenant_idx));t++)platform_services[t].displayName===e&&(current_tenant_idx=t)}return(null===current_tenant_idx||"undefined"==typeof current_tenant_idx||Number.isNaN(current_tenant_idx))&&(console.log("Share current tenant and security context thru PADCommandProxy"),current_tenant_idx=0),current_tenant_idx},getCurrentTenantId_:function(){var e=this.getOption("platform_services");if(i.is(this._currentTenant)){var t=this._currentTenant;if(!i.is(this._currentTenantIdx)||e[this._currentTenantIdx].platformId!==t)for(var n=0;n<e.length&&!i.is(this._currentTenantIdx);n++)e[n].platformId===t&&(this._currentTenantIdx=n)}return i.is(this._currentTenantIdx)||(this._currentTenantIdx=0),this._currentTenantIdx},getCurrentTenantId:function(){var e=this.getOption("platform_services");if(i.is(this._currentTenant)){var t=this._currentTenant;if(!i.is(this._currentTenantIdx)||e[this._currentTenantIdx].platformId!==t)for(var n=0;n<e.length;n++)e[n].platformId===t&&(this._currentTenantIdx=n)}return i.is(this._currentTenantIdx)||(this._currentTenantIdx=0),this._currentTenantIdx},getTenantsPreference:function(e){var t=this,n=[],s=this.getOption("user_granted_roles"),o=!1,a=[],r=this.getOption("platform_services");if("ODT_MODE"===r)return["OnPremise"];if(!i.is(r,"array"))throw new Error("Platform services not initialize yet");if("string"==typeof s)try{s=JSON.parse(s)}catch(e){console.log(e)}for(var l=0;l<s.length;l++)"CSV"===s[l].id&&s[l].platforms&&(a=s[l].platforms),"InternalDS"===s[l].id&&(o=!0);return this.getOption("csvTenants")||this.setOption("csvTenants",a),r.forEach(function(e){t.isWebInWin()?n.push({label:e.displayName,value:e.platformId}):(-1!==a.indexOf(e.platformId)||o)&&n.push({label:e.displayName,value:e.platformId})}),n},getSecurityContext:function(){var e=this;return new s(function(t,i){if(e.getOption("Map_SecurityContext"))t(e.getOption("Map_SecurityContext"));else{var n=e.get3DSpaceUrl()+"/resources/pno/person/getsecuritycontext?tenant="+e.getCurrentTenantName();o.authenticatedRequest(n,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"GET",onComplete:function(i){var n=JSON.parse(i);if(n&&n.SecurityContext){var s=n.SecurityContext,o="";0!==s.indexOf("ctx::")&&(o="ctx::"),s=o+s,e.setOption("Map_SecurityContext",s),t(s)}},onFailure:function(e){console.log(e),e.type="generic",i(e)},onTimeout:function(e){console.log(e),e.type="timeout",i(e)}})}})},getAllSecurityContextsUrl:function(){if(!i.is(this.getOption("platform_services"),"array")&&"ODT_MODE"!==this.getOption("platform_services"))throw new Error("Platform services not initialize yet");return this.get3DSpaceUrl()+"/resources/modeler/pno/person?current=true&select=preferredcredentials&select=collabspaces&tenant="+this.getCurrentTenantName()},getAllSecurityContexts:function(){var e=this;return new s(function(t,i){e.getOption("Map_AllSecurityContexts")?t(e.getOption("Map_AllSecurityContexts")):o.authenticatedRequest(e.getAllSecurityContextsUrl(),{headers:{Accept:"application/json","Content-Type":"application/json"},method:"GET",type:"json",proxy:"passport",onComplete:function(i){if(null!==i){var n=l.getSecurityContext(i);e.setOption("Map_AllSecurityContexts",n),t(n)}},onFailure:function(e){i(e)}})})},getUserID:function(){return"ODT_MODE"===this.getOption("platform_services")?"TEST_USER":(t=this.getOption("userId"))&&""!==t?t:t=null!=(e=a.getUser())&&void 0!==e.login?a.getUser().login:"";var e,t},getLabelAPI:function(){return this.getAppId()+"-"+this.getUserID()+"-"+Date.now()},getXPrefCredential:function(){return 0!==this._xPrefCredential.indexOf("ctx::")&&(this._xPrefCredential="ctx::"+this._xPrefCredential),this._xPrefCredential},setXPrefCredential:function(e){this._xPrefCredential=e},isWebInWin:function(){var e=!1;return this.getOption("iswebinwin")&&(e=!0),e},addCredentialPreferenceToWidget:function(){var e=this;return new s(function(t,i){e.isWebInWin()?e._getListOfSecurityContext().then(function(i){e.setXPrefCredential(i[0].value),t()}):d.addCredentialPreferenceToWidget({usePreferredCredentials:!0}).then(function(){let i=widget.getValue("xPref_CREDENTIAL");i||(i=widget.getPreference("xPref_CREDENTIAL").options[0].value,widget.setValue("xPref_CREDENTIAL",i)),e.setXPrefCredential(i),t()})})},appInitializationPromised:function(e,t,i){var n=this,o=new s(function(t,i){e?(n.setOption("platform_services",e.platform_services),n.setMyAppsUrl(),e.noautomode&&n.setOption("noautomode",!0),e.userId?n.setOption("userId",e.userId):n.setOption("userId",""),t()):r.getPlatformServices({onComplete:function(e){n.setOption("platform_services",e),t()},onFailure:function(e){i(e),console.error(e)}})}),a=new s(function(t,i){e?(n.setOption("user_granted_roles",e.user_granted_roles),t()):r.getGrantedRoles(function(e){if(n._checkRoles(e)){for(var s=[],o=0;o<e.length;o++)void 0!==e[o].id&&null!==e[o].id&&s.push(e[o]);n.setOption("user_granted_roles",s),t()}else i({errType:"NoValidRoles"})})});return new s(function(r,l){s.all([o,a]).then(function(){t&&(n._currentTenant=t);var s=n.getTenantsPreference(e);e?!n._currentTenant&&s[0]&&(n._currentTenant=s[0].value):(n._currentTenant||(n._currentTenant=n._isValidTenant(widget.getValue("x3dPlatformId"))||n._isValidTenant(n._defaultTenant)||n._getDefaultTenant()),n._checkRolesOnTenant(n.getOption("user_granted_roles"),n._currentTenant)?"ENORIPE_AP"===widget.getValue("appId")&&n._updateWidgetPref():l({showMsg:!0,msg:c.get("NoValidRolesOnTenant")}));n.setDefaultAttributesInit(i),r()},function(e){"NoValidRoles"===e.errType&&l({showMsg:!0,msg:c.get("NoValidRoles")})})})},_checkRoles:function(e){for(var t=!1,i=0;i<e.length;i++)"CSV"!==e[i].id&&"InternalDS"!==e[i].id||(t=!0);return t},_checkRolesOnTenant:function(e,t){if(null==t)return!1;for(var i=0;i<e.length;i++){if("InternalDS"===e[i].id)return!0;if("CSV"===e[i].id)for(var n=e[i].platforms,s=0;s<n.length;s++)if(n[s]===t)return!0}return!1},_isValidTenant:function(e){var t=!1,i=this.getOption("platform_services");if(e&&i&&i.length)for(var n=0;n<i.length;n++)if(i[n].platformId&&i[n].platformId===e){i[n].hasOwnProperty("3DSpace")&&(t=!0);break}return!0===t&&e},_getDefaultTenant:function(){var e=this.getOption("platform_services"),t="";if(e&&e.length)for(var i=0;i<e.length;i++)if(e[i].hasOwnProperty("platformId")&&e[i].hasOwnProperty("3DSpace")){t=e[i].platformId;break}return t},_updateWidgetPref:function(){if(!this.isWebInWin()){var e=this.getTenantsPreference(),t={name:"selected_tenant",type:"list",label:c.get("tentantPreferenceLabel"),defaultValue:this._currentTenant,options:e};e.length<2&&(t.disabled=!0),widget.addPreference(t)}},setCurrentTenant:function(e){this._currentTenant=e},setDefaultTenant:function(e){this._defaultTenant=e},_updateSettingsFromURLParameters:function(e){for(var t=e.split("&"),i={},n=0;n<t.length;n++){var s=t[n].split("=");1===s.length&&""!==s[0]?i[s[0]]=!0:2===s.length&&s[0].length>0&&(i[s[0]]=s[1])}this.setOptions(i)},getTimeout:function(){var e=this.getOption("timeout");return Math.min(e,18e4)},getnav_history:function(){return this.getOption("nav_history")},getUniqueId:function(){return(Date.now()+Math.random()).toString().replace(".","").substring(0,35)},getValuesInPref:function(e){var t;if(e&&(e+="-ENORIPE_AP"),e&&(t=widget?widget.getValue(e):localStorage.getItem(e)))try{return JSON.parse(t)}catch{return t}},saveValuesInPref:function(e,t){e&&(e+="-ENORIPE_AP"),t=JSON.stringify(t),e&&t&&(widget?widget.setValue(e,t):localStorage.setItem(e,t))}})}),define("DS/SNNavigationMap/utils/MapFileUtils",["UWA/Class","DS/SNNavigationMap/MapSettings","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s){return e.extend({init:function(e){this.spinner=e.spinner,this.notifManager=i,n.setNotificationManager(this.notifManager)},handleDownload:function(e,i){this._showSpinner();var n=this,o={tenant:t.getPlatformId(),tenantUrl:t.get3DSpaceUrl(),autoDownload:!0,onComplete:function(e){n._hideSpinner()},onFailure:function(){n._showNotif({level:"error",msg:s.get("DownloadFailure")}),n._hideSpinner()}};require(["DS/DocumentManagement/DocumentManagement","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],function(i,a){if(a){var r=a.get();r&&r.change&&""!==r.change.id&&(o.additionalHeaders={"DS-Change-Authoring-Context":"pid:"+r.change.id})}t.getSecurityContext().then(function(t){o.securityContext=t,i.downloadDocument(e,void 0,!1,o)},function(e){var t={level:"error",msg:s.get(e.type)};n._showNotif(t),n._hideSpinner()})},function(){n._hideSpinner(),console.log("DocumentManagementAMD not found")})},_showNotif:function(e){this.notifManager.addNotif({level:e.level,message:e.msg,sticky:!1})},_hideSpinner:function(){this.spinner&&this.spinner.hide()},_showSpinner:function(){this.spinner&&this.spinner.show()},getFileType:function(){}})}),define("DS/SNNavigationMap/utils/SNNavigationServices",["UWA/Core","UWA/Class/View","DS/SNNavigationMap/MapSettings","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n){"use strict";return{isWebInWin:function(){var e="undefined"!=typeof dscef||"undefined"!=typeof CATCefSendString,t=void 0!==i.getAddinMode();return e&&!t},sendToMapWebInWin:function(e,t,i){var n=!1;if(this.isWebInWin()){n=!0;var s={action:"string"==typeof i?i:"",id:Array.isArray(t)?t:[t]};this.sendStringRelationsToWebInWin(e,JSON.stringify(s))}return n},sendStringRelationsToWebInWin:function(t,i){if("undefined"!=typeof dscef)dscef.sendString(t+"="+i);else if("undefined"!=typeof CATCefSendString)CATCefSendString(t+"="+i);else{var n=e.createElement("textarea",{name:t,text:i}),s=e.createElement("form",{method:"POST",action:"jsnotif://"}).inject(n);document.documentElement.appendChild(s),n.inject(document.documentElement),s.submit(),s.parentNode.removeChild(s),s=null}},ComputeContextualMenu:function(e,t){var i=[];if(null!=t&&void 0!==t&&!Number.isNaN(t)){var n=JSON.parse(t.actions),s=this._parseContextualMenu(e,n.actions);i=1==s.length?s[0]:this._menusIntersection(n.actions,s)}return i},_parseContextualMenu:function(e,t){for(var i=[],n=t.length,s=0;s<n;s++)i[s]=this._getActionsForOneObject(e,t[s],t[s].actions,"");return i},_getActionsForOneObject:function(e,t,i,n){for(var s=[],o=i.length,a=0;a<o;a++)s[a]=this._getOneActionForOneObject(e,t,i[a],n);return s},_getOneActionForOneObject:function(e,t,i,n){var s;if(null==i.items||void 0===i.items||Number.isNaN(i.items)){s={text:i.title,icon:i.image,multisel:i.multisel},void 0!==i.availabilityMode&&(s.availabilityMode=i.availabilityMode),void 0!==i.id&&(s.actionId=i.id,s.id=i.id,s.data=i.id),void 0!==i.accelerator&&(s.accelerator=i.accelerator),null==i.disabled||void 0===i.disabled||Number.isNaN(i.disabled)||(s.disabled=i.disabled),s.handler=function(n){var s={action:i.id,id:[t.id]};e._onCtxMenuItem(s)},null==n||void 0===n||Number.isNaN(n)||(s.menu=n)}else s={text:i.title},void 0!==i.id&&null!==i.id&&(s.actionId=i.id),s.items=this._getActionsForOneObject(e,t,i.items,i.title);return s},_menusIntersection:function(e,t){var i=[],n=t.length;if(0===n)return i;i=t[0];for(var s=[],o=1;o<n;o++){for(var a=t[o],r=a.length,l=0;l<r;l++){for(var d=i.length,c=!1,h=0;h<d;h++)if(null!=a[l].actionId&&null!=a[l].actionId&&null!=i[h].actionId&&null!=i[h].actionId){if(a[l].actionId===i[h].actionId){c=!0;break}}else if((void 0===a[l].actionId&&void 0===i[h].actionId||null===a[l].actionId&&null===i[h].actionId)&&a[l].text===i[h].text){c=!0;break}!0===c&&s.push(a[l])}i=s,s=[]}return i}}}),define("DS/SNNavigationMap/utils/ProbesUtils",["UWA/Class","UWA/Class/Options","DS/WAFData/WAFData","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/SNNavigationServices","DS/PADServices/utils/PADTrackerManager","DS/Usage/TrackerAPI","text!DS/SNNavigationMap/assets/NavigationTrackerMetrics.json"],function(e,t,i,n,s,o,a,r){"use strict";return e.singleton(t,{options:{},PERFORMANCELABEL:"enoripe_",TIMELABEL:"ENORIPE-",APPID:"ENORIPE_AP",lastStepObjectsInSession:0,init:function(e){},getTracker:function(e,t,i){let s,a={eventCategory:e,eventAction:t,tenant:n.getCurrentTenantName(),appID:this.APPID};return i&&(i.tenant&&""!=i.tenant&&(a.tenant=i.tenant),i.appID&&""!=i.appID&&(a.appID=i.appID)),"performance"===e?s=o.getPADTracker(a,r):"usage"===e&&(s=o.getPADTracker(a)),s},trackUsage:function(e,t,i,n){if(s.isWebInWin()){let o={appId:n&&n.appId?n.appId:this.APPID,category:"Usage",type:"",action:e,label:t,value:i||1};s.sendStringRelationsToWebInWin("AddUsageProbe",JSON.stringify(o))}else{var o=this.getTracker("usage",e,n);o&&(o.setEventData({eventLabel:t,eventValue:i||1}),o.trackPageEvent())}},trackMultiUsage:function(e,t,i){var s,o={},r={};o.pd1=n.getWidgetId(),r.pv1=1;for(var l=2;l<i.length+2;l++)o["pd"+l]=i[l-2],r["pv"+l]=1;s={persVal:r,appID:this.APPID,tenant:n.getCurrentTenantName()},console.debug("track page event with input = "),console.debug(e,t,o,s),a.trackPageEvent("usage",e,t,1,o,s)},trackPerformance:function(e,t,i){if(s.isWebInWin()){let e={stepName:t};s.sendStringRelationsToWebInWin("EndPerfoProbe",JSON.stringify(e))}else{var n=this.getStartTime(t),o=null,a={};(o=this.getTracker("performance",this.PERFORMANCELABEL+e))&&(n&&(a={Duration:Date.now()-n}),i&&(a={...a,...i}),o.addMultivaluedEventData(this.PERFORMANCELABEL+t,a),o.trackPageEvent(),this.stopTime(t))}},setStartTime:function(e){if(this.setOption(this.TIMELABEL+e+"-Start",Date.now()),s.isWebInWin()){let t={appId:this.APPID,category:"Performance",type:"",action:this.PERFORMANCELABEL+e,label:e+"_Duration",stepName:e};s.sendStringRelationsToWebInWin("StartPerfoProbe",JSON.stringify(t))}},setProbesAfterParsing:function(e,t){var i=e.filter(function(e){if("link"===e.modelType)return e}),n=e.filter(function(e){if("node"===e.modelType)return e}),s=t.where({modelType:"node"}),o=i.reduce((e,t)=>((e[t.type]=e[t.type]||[]).push(t),e),{}),a=n.length+s.length,r="";if(a<=10)r="i<=10";else if(a<=20)r="10<i<=20";else if(a<=100){for(var l=20;l<=80;l+=20)if(a>l&&a<=l+20){r=l+"<i<="+(l+20);break}}else if(a<=500){for(l=100;l<=400;l+=100)if(a>l&&a<=l+100){r=l+"<i<="+(l+100);break}}else for(l=500;l<=3e4;l+=500)a>l&&a<=l+500&&(r=l+"<i<="+(l+500));r!=this.lastStepObjectsInSession&&(this.lastStepObjectsInSession=r,this.trackUsage("ObjectsInSession","Step-"+r)),Object.keys(o).forEach(function(e){this.trackUsage("LinksUsage",e,o[e].length)}.bind(this))},getStartTime:function(e){return this.getOption(this.TIMELABEL+e+"-Start")},stopTime:function(e){this.setOption(this.TIMELABEL+e+"-Start")}})}),define("DS/SNNavigationMap/views/SelectionAssistantView",["UWA/Core","UWA/Class","UWA/Class/View","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/Button","DS/UIKIT/Input/Toggle","DS/SNNavigationMap/utils/ProbesUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a,r,l){"use strict";return i.extend({name:"SelectionAssistant",_dialog:null,className:function(){return this.getClassNames("-container")},setup:function(e){this._immersiveFrame=new s,this._immersiveFrame.inject(this.container),this.dimensions={},this.dimensions.position={},this.dimensions.position.offsetX=0,this.dimensions.position.offsetY=200,this.dimensions.dialogWidth=270,this.dimensions.dialogHeight=270,this.firstLaunch=!0},render:function(e){this._options=e;var t=this._getDialogContent();this._createDialog(t),this._immersiveFrame.elements.container.setStyle("z-index",300),this.show()},_createDialog:function(e){this._dialog=new n({title:l.get("SelectionAssistant-Title"),content:e,immersiveFrame:this._immersiveFrame,expandedFlag:!1,width:this.dimensions.dialogWidth,height:this.dimensions.dialogHeight,minWidth:200,minHeight:210,maxWidth:750,resizableFlag:!1,position:{at:"top center",my:"top center"},buttons:{Cancel:new o({label:l.get("SelectionAssistant-Cancel"),allowUnsafeHTMLContent:!1,onClick:this._cancelClick.bind(this)}),Save:new o({label:l.get("SelectionAssistant-OK"),allowUnsafeHTMLContent:!1,onClick:this._okClick.bind(this)})}}),this._dialog.addEventListener("close",this._cancelClick.bind(this)),this._isCheckBoxChecked()?this._dialog.buttons.Save.disabled=!1:this._dialog.buttons.Save.disabled=!0,this._adjustDialogDimensions()},_okClick:function(){var e=this,t=[];this.getElements("input").forEach(function(i){e._options.selOptions[i.value]=i.checked,i.checked&&t.push(i.value)}),this._destroyCurrentDialog(),r.trackUsage("SelectionAssistant","Options-"+t.join("_")),this.dispatchEvent("ENORIPE_UpdateSelection",[this._options])},_cancelClick:function(){this._destroyCurrentDialog()},_onCheckBoxClick:function(){var e=this._isCheckBoxChecked();this._dialog.buttons.Save.disabled=!e},_isCheckBoxChecked:function(){var e=this.getElements("input"),t=!1;return e.forEach(function(e){"checkbox"!==e.type||void 0===e.checked||!0!==e.checked||(t=!0)}),t},_getDialogContent:function(){var t=e.createElement("div",{class:"ENORipeSelAsst-Main"}),i=e.createElement("div",{class:"ENORipeSelAsst-SelOptions"}).inject(t),n=e.createElement("div",{class:"ENORipeSelAsst-CommonOptions"}).inject(t),s=new a({type:"checkbox",value:"SDP",className:"primary ENORIPE-SDP",events:{onClick:this._onCheckBoxClick.bind(this)},label:l.get("SelectionAssistant-SDP-Title")}).inject(i),o=new a({type:"checkbox",value:"SAP",className:"primary ENORIPE-SAP",events:{onClick:this._onCheckBoxClick.bind(this)},label:l.get("SelectionAssistant-SAP-Title")}).inject(i),r=new a({type:"checkbox",value:"SDS",className:"primary ENORIPE-SDS",events:{onClick:this._onCheckBoxClick.bind(this)},label:l.get("SelectionAssistant-SDS-Title")}).inject(i),d=new a({type:"checkbox",value:"SAS",className:"primary ENORIPE-SAS",events:{onClick:this._onCheckBoxClick.bind(this)},label:l.get("SelectionAssistant-SAS-Title")}).inject(i),c=new a({type:"switch",value:"CommonResults",className:"primary ENORIPE-SA-CommonResults",label:l.get("SelectionAssistant-CommonResults-Title")}).inject(n);return this._options&&this._options.selOptions&&(this._options.selOptions.SDP&&s.check(),this._options.selOptions.SAP&&o.check(),this._options.selOptions.SDS&&r.check(),this._options.selOptions.SAS&&d.check(),this._options.selOptions.CommonResults?c.check():this._options.disableCommon&&c.disable()),t},_adjustDialogDimensions:function(){this._dialog.position.offsetX=this.dimensions.position.offsetX,this._dialog.position.offsetY=this.dimensions.position.offsetY,this.dimensions.dialogHeight=this._dialog.height,this.dimensions.position.offsetY=this._dialog.position.offsetY,this._dialog._applyPosition(),this._dialog._applyHeight(),this._dialog._applyWidth()},_destroyCurrentDialog:function(){this._immersiveFrame.elements.container.setStyle("z-index",0),this.dimensions.dialogWidth=this._dialog.width,this.dimensions.dialogHeight=this._dialog.height,this.dimensions.position=this._dialog.position,this._dialog.destroy(),this._dialog=null,this.hide()}})}),define("DS/SNNavigationMap/utils/CommonUtils",["UWA/Class","UWA/Class/Options","DS/WAFData/WAFData","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/PromisesManager","DS/SNNavigationMap/utils/SNNavigationServices","DS/FedDictionaryAccess/FedDictionaryAccessAPI","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a,r){"use strict";return e.singleton(t,{_currentRequest:null,init:function(e){},getAttributes:function(e){var t=n.getDefaultAttributes(),i={};return e=e||"AllTypes",t&&(void 0!==t[e]?i.attributes=t[e].attributes:i.attributes=t.AllTypes.attributes),i.attributes&&(i.attrs=i.attributes.map(function(e){return e.uri})),i},_processData:function(t,i){var n=this;if((i=JSON.parse(i))&&i.results)for(var s={},o=0;o<i.results.length;o++)for(var a=i.results[o].attributes,r=0;r<a.length;r++)(a[r].name.contains("ds6w")||a[r].name.contains("ds6wg"))&&(s[a[r].name]?-1===s[a[r].name].indexOf(a[r].value)&&s[a[r].name].push(a[r].value):s[a[r].name]=[a[r].value]);return new e.Promise(function(e,o){i&&i.results&&i.results.length>0?n._getNls(s).then(function(s){t=n._processFetchData(t,i),t=n._processNlsDataForFetch(t,s),e(t)}):(console.log("no results in fetch service for tooltip"),e(t))})},_prepareDataToNls:function(e){var t=null,i=[],n=[],s={};if(e)for(var o=0;o<e.length;o++){t=e[o]._attributes,i=Object.keys(t),n=Object.values(t);for(var a=0;a<i.length;a++)(i[a].contains("ds6w")||i[a].contains("ds6wg"))&&(s[i[a]]?-1===s[i[a]].indexOf(n[a])&&s[i[a]].push(n[a]):s[i[a]]=[n[a]])}return s},_getNls:function(t,i){return new e.Promise(function(e,s){if(n.isWebInWin()){var o={myAppsBaseUrl:n.getMyAppsUrl(),userId:n.getUserID(),lang:n.getLang()};a.setConfigForMyApps(o)}a.getNlsOfPropertiesValues(JSON.stringify(t),{tenantId:n.getCurrentTenantName(),lang:n.getLang(),apiVersion:"R2019x",onComplete:function(t){t.ids=i,e(t)},onFailure:function(t){console.log("Error in fetching NLS data from FedDictionaryAccessAPI.getNlsOfPropertiesValues, the response received is ::"+t),e()}})})},_getNlsAndProcessData:function(t,i,n,s){var o=this;return new e.Promise(function(e,a){o._getNls(t,i).then(function(t){var i=o._getNlsObj(t,n,s);i.isInstances=s,e(i)})},function(){reject()})},_getNlsObj:function(e,t,i){for(var n={},s={ids:[],nlsObj:{}},o={},a=[],r=0;r<e.ids.length;r++){var l=null;Object.keys(t).indexOf(e.ids[r])>-1&&(l=t[e.ids[r]]._attributes),a.push(l)}for(var d=0;d<a.length;d++){var c=a[d];for(var h in n={},c)if(c.hasOwnProperty(h)&&h.contains("ds6w")&&e[h]&&e[h].hasOwnProperty(c[h])){var u=e[h][c[h]];n[h]=u}Object.keys(n).length>0&&(o[c.id]={...n},s.ids.push(c.id))}return s.nlsObj=o,s},_processFetchData:function(e,t){if(t){for(var i=t.results,n="",s=[],o=null,a=e.attrs,r=0;r<i.length;r++)if(i[r].attributes&&i[r].attributes.length>0)for(var l=0;l<i[r].attributes.length;l++){var d=i[r].attributes[l];if("resourceid"===d.name&&(o=this._getAttrForIds(d.value,i[r].attributes,a),s.push(o.id),"VPMInstance"!==o.type)){o&&(e.nlsObj||(e.nlsObj={}),e.nlsObj[d.value]=o),n=d.value;break}}for(r=0;r<i.length;r++)"VPMInstance"===(o=this._getAttrForIds(s[r],i[r].attributes,a)).type&&(e.nlsObj[n].instances||(e.nlsObj[n].instances=[]),o.nlsObj={...o},e.nlsObj[n].instances.push(o))}return e},getResourcesInfo:function(t){return new e.Promise(function(e,i){a.getResourcesInfo(t.join(","),{tenantId:n.getCurrentTenantName(),lang:n.getLang(),apiVersion:"R2019x",onComplete:function(t){e(t)},onFailure:function(t){console.log("Error in fetching NLS data from FedDictionaryAccessAPI.getNlsOfPropertiesValues, the response received is ::"+t),e()}})})},_getAttrForIds:function(e,t,i){if(e&&t){for(var n={},s=0;s<t.length;s++)-1!==i.indexOf(t[s].name)&&(n[t[s].name]?("string"==typeof n[t[s].name]&&(n[t[s].name]=n[t[s].name].split()),n[t[s].name].push(t[s].value)):(n[t[s].name]=t[s].value,"resourceid"===t[s].name&&(n.id=t[s].value),"ds6w:label"===t[s].name&&(n.name=t[s].value)));if(n.taxonomies&&("string"==typeof n.taxonomies&&(n.taxonomies.startsWith("types")||n.taxonomies.startsWith("reltypes"))?n.relTypesTaxonomies=n.taxonomies:n.taxonomies.every(function(e){if(e.startsWith("types")||e.startsWith("reltypes"))return n.relTypesTaxonomies=e,!1})),Object.keys(n).length>0)return n}return null},_processNlsDataForFetch:function(e,t){if(t){var i=e.nlsObj;for(var n in i)if(i.hasOwnProperty(n)){var s=i[n];for(var o in s)if(s.hasOwnProperty(o)&&void 0!==t[o]){s[o];void 0!==t[o][s[o]]&&(e.nlsObj[n][o]=t[o][s[o]])}}}return e},getContentForOpenWith:function(e,t,i){if(e&&t){var s={protocol:"3DXContent",version:"1.1",source:"ENORIPE_AP",widgetId:o.isWebInWin()?"web_in_win":n.getWidgetId(),data:{items:[{serviceId:"3DSpace",envId:n.getCurrentTenantName(),objectId:e,objectType:t}]}};if(i&&i.length>0){var a=this.getTaxonomies(i);a&&a.length>0&&(s.data.items[0].objectTaxonomies=a)}else"3DShape"===t&&(s.data.items[0].objectTaxonomies=["PLMEntity","PLMReference","PLMCoreRepReference","LPAbstractRepReference","LPAbstract3DRepReference","PHYSICALAbstract3DRepReference","VPMRepReference","3DShape"]);return s}},getTaxonomies:function(e){if(e&&e.length>0){for(var t=e.split(","),i=0;i<t.length;i++)if(t[i].contains("types")){t=t[i];break}var n=t.split("/");return n.length>1?(n.splice(0,1),n):[]}},getReverseRelations:function(e){return e.indexOf("_from")>-1?e.replace("_from","_to"):e.replace("_to","_from")},getMainRelName:function(e){return"_to"===e.substring(e.length-3)?e.substring(0,e.length-3):e.substring(0,e.length-5)},setAvailableRelations:function(e){for(var t=e,i={},n=0;n<t.length;n++)i[t[n].name]=!0;this._baseRelations=i,this._availableRelations=t},getProfileDirections:function(e){var t=e.indexOf("_from")>-1?e.replace("_from",""):e.replace("_to",""),i={};return i._from=this._baseRelations[t+"_from"],i._to=this._baseRelations[t+"_to"],void 0===this._baseRelations[t+"_from"]&&void 0===this._baseRelations[t+"_to"]&&(i={_from:!0,_to:!0}),i},switchRelationsDirection:function(e){var t=e.source,i=e.target;return"link"===e.modelType&&"in"===e.direction&&(this.getProfileDirections(e.type),e.type=e.type.replace("_from","_to"),e.source=i,e.target=t),e},getTitleLabel:function(e,t){if(t){for(var i="",s="",o=0;o<t.length;o++){if(s="",e.hasOwnProperty(t[o]))if(s=e[t[o]],t[o].contains("modified"))s=new Date(s).toLocaleString(n.getLang());if(s&&s.length>0&&(i=i.length>0?i+n.getOption("displayNameSeparator")+s:s),2===o)break}return i}},getRelationLinkNls:function(e){var t=e.display_name_attributes;return t&&t.length?r[e[t[0]]]||e[t[0]]:r[e.type+"_short"]||r[e.type]||e.type},getUser3DSwymPictureURL:function(e,t){let i,s=n.get3DSwymUrl();return s&&(i=s+"/api/user/getpicture/login/"+e,t&&(i+="/format/"+t)),i},getRefInstIdsFromNavigatedNodes:function(e){var t=[];return Object.keys(e)&&Object.keys(e).length>0&&(t=[...Object.keys(e)],Object.keys(e).forEach(function(i){e[i].instances&&e[i].instances.length>0&&e[i].instances.forEach(function(e){t.push(e.id)})})),t},downloadfile:function(e,t,i){var n=document,s=n.createElement("a");if(UWA.is(e)&&UWA.is(t)&&UWA.is(i)&&(i=i||"application/octet-stream","download"in s)){var o=URL.createObjectURL(new Blob([e],{type:i}));return s.setAttribute("href",o),s.setAttribute("download",t),s.innerHTML="downloading...",n.body.appendChild(s),setTimeout(function(){s.click(),n.body.removeChild(s),URL.revokeObjectURL(o)},66),!0}},getItemsFromSelection:function(e){for(var t={},i=0;i<e.length;i++)e[i].path&&e[i].path[e[i].path.length-2]&&e[i].path[e[i].path.length-2].type&&"VPMInstance"===e[i].path[e[i].path.length-2].type&&(e[i].instances||(e[i].instances=[]),e[i].instances.push({id:e[i].path[e[i].path.length-2].resourceid})),t[e[i].objectId]?t[e[i].objectId].instances=[...t[e[i].objectId].instances,...e[i].instances]:t[e[i].objectId]={instances:e[i].instances||[]},n.getOption("attributesForItems").forEach(function(n){e[i][n]&&(t[e[i].objectId][n]=e[i][n]),"id"===n&&(t[e[i].objectId][n]=e[i].objectId)});return t}})}),define("DS/SNNavigationMap/utils/PreferencesUtils",["UWA/Class","UWA/Class/Options","DS/WAFData/WAFData","DS/SNNavigationMap/MapSettings"],function(e,t,i,n){"use strict";return e.singleton(t,{_keyPrefix:"",init:function(e){n&&(this._keyPrefix=n.getUserID())},setPrefToWidget:function(e,t){e&&void 0!==t&&void 0!==e&&(e&&(e=this.buildPrefKey(e)),"string"!=typeof t&&(t=JSON.stringify(t)),widget&&widget.setValue(e,t))},setPrefToLocalStorage:function(e,t){e&&void 0!==t&&void 0!==e&&(e&&(e=this.buildPrefKey(e)),"string"!=typeof t&&(t=JSON.stringify(t)),localStorage.setItem(e,t))},setPrefEverywhere:function(e,t){e&&void 0!==t&&void 0!==e&&(widget?(this.setPrefToWidget(e,t),this.setPrefToLocalStorage(e,t)):this.setPrefToLocalStorage(e,t))},setPrefLocally:function(e,t){e&&void 0!==t&&void 0!==e&&(widget?this.setPrefToWidget(e,t):this.setPrefToLocalStorage(e,t))},getPref:function(e){var t,i;if(e&&(i=this.buildPrefKey(e),widget&&(t=widget.getValue(i)),t||(t=localStorage.getItem(i)),t||(t=this.restoreOldPref(e)),t))try{return t=JSON.parse(t),"ENORIPE_navigatedNodes"===e&&Array.isArray(t)&&(t=this.setNewNavigatedNodesPref(t)),t}catch(e){return t}},setNewNavigatedNodesPref:function(e){var t={};return e.forEach(function(e){t[e]={id:e,instances:[]}}),this.setPrefToWidget("ENORIPE_navigatedNodes",t),t},restoreOldPref:function(e){var t,i;if(widget&&((t=widget.getValue(e+"-ENORIPE_AP"))||(t=widget.getValue(e))),t){try{t=JSON.parse(t)}catch(e){}this.setPrefToWidget(e,t)}if((i=localStorage.getItem(e+"-ENORIPE_AP"))||(i=localStorage.getItem(e))||(i=localStorage.getItem(n.getUserID()+e)),i){try{i=JSON.parse(i)}catch(e){}t=i,this.setPrefToLocalStorage(e,i)}if(t)return t},buildPrefKey:function(e){var t=this._keyPrefix;return e&&"_"!==e[0]&&(t+="-"),t+=e}})}),define("DS/SNNavigationMap/utils/RelationsServices",["UWA/Controls/Abstract","UWA/Class/Events","UWA/Class","UWA/Class/Options","UWA/Core","UWA/Promise","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","DS/SNNavigationMap/utils/CommonUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/SNNavigationMap/utils/PromisesManager"],function(e,t,i,n,s,o,a,r,l,d,c){"use strict";return i.singleton(n,{promiseManager:null,init:function(){this.promiseManager=new c({debugMode:"1"===a.getOption("debug_me")})},getRelationsCount:function(e){var t=this,i={};return i={widgetId:a.getWidgetId(),label:a.getLabelAPI(),items:e.items},e.trueREST&&(i.trueREST=!0,i.widgetId=a.getUniqueId(),i.publicationsMode=a.getPublicationsMode(),i.ghostMode=a.getGhostMode(),a.getOption("LastUsedProfile")&&"AutoModeProfile"===a.getOption("LastUsedProfile")?(i.relations=["use-auto-by-type-relations"],i.excludedRelations=a.getExcludedAttributes()):i.relations=a.getOption("currentRelations")),e.excludedRelations&&(i.excludedRelations=i.excludedRelations.concat(e.excludedRelations)),r.setStartTime("getRelationCount",Date.now()),a.setOption("getRelationCountNoOfObjects",i.items.length),this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/getRelationCount?tenant="+a.getCurrentTenantName(),params:i,timeout:a.getTimeout(),xPrefCredential:a.getXPrefCredential(),onComplete:function(e){return new o(function(i,n){t.trackServices(),i(e)})}})},getEcosystem:function(e,t){var i=this,n={};return n={widgetId:a.getWidgetId(),label:a.getLabelAPI(),items:e,lang:a.getLang(),trueREST:!1,direction:"both",excludedRelations:[],restrictedMode:!!t.restrictedMode,responseMode:t.responseMode?t.responseMode:"ObjectsAndLinks"},!t.direction||"in"!==t.direction&&"out"!==t.direction||(n.direction=t.direction),t.widgetId&&(n.widgetId=t.widgetId),t.relations&&t.relations.length>0&&(n.relations=t.relations),t.fullImportMode&&(n.fullImportMode=t.fullImportMode),t.computeWithInstances&&(n.computeWithInstances=t.computeWithInstances),a.getOption("LastUsedProfile")&&"AutoModeProfile"===a.getOption("LastUsedProfile")&&(n.excludedRelations=a.getExcludedAttributes()),t.excludedRelations&&(n.excludedRelations=n.excludedRelations.concat(t.excludedRelations)),t.trueREST&&!0===t.trueREST&&(trueREST=!0,n.relations=["use-auto-by-type-relations"],n.widgetId=a.getUniqueId(),a.getOption("LastUsedProfile")&&"AutoModeProfile"!==!a.getOption("LastUsedProfile")||(n.relations=a.getOption("currentRelations"))),r.setStartTime("getecosystem",Date.now()),a.setOption("ecosystemNoOfObjects",n.items.length),this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/getEcosystem?tenant="+a.getCurrentTenantName(),params:n,timeout:a.getTimeout(),xPrefCredential:a.getXPrefCredential(),onComplete:function(e){return new o(function(t,n){i.trackServices(),t(e)})}})},getInfosForSupportedObjects:function(e){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/navigate/getInfosForSupportedObjects?tenant="+a.getCurrentTenantName(),params:{widgetId:a.getWidgetId(),ids:e,checkSupported:!1},xPrefCredential:a.getXPrefCredential(),timeout:a.getTimeout()})},setPreferences:function(e){var t=["use-auto-by-type-relations"],i=[],n={};return e.relations?t=e.relations:a.getOption("LastUsedProfile")&&"AutoModeProfile"!=a.getOption("LastUsedProfile")?t=a.getOption("currentRelations"):n.excludedRelations=a.getExcludedAttributes(),e.excludedRelations&&e.excludedRelations.length>0&&(i=n.excludedRelations?[...new Set([...e.excludedRelations,...n.excludedRelations])]:e.excludedRelations),n={widgetId:a.getWidgetId(),label:a.getLabelAPI(),relations:t,lang:a.getLang(),computeWithInstances:!1,allRelationsMode:void 0!==e.allRelationsMode&&e.allRelationsMode,publicationsMode:a.getPublicationsMode(),attributesForView:e.attributes,ghostMode:a.getGhostMode()},i.length>0&&(n.excludedRelations=i),e.widgetId&&(n.widgetId=e.widgetId),this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/setPreferences?tenant="+a.getCurrentTenantName(),params:n,xPrefCredential:a.getXPrefCredential(),timeout:a.getTimeout()})},getDetails:function(e,t){var i={};return i={widgetId:a.getWidgetId(),direction:"both",id:e},!t.direction||"in"!==t.direction&&"out"!==t.direction||(i.direction=t.direction),r.setStartTime("detail",Date.now()),this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/navigate/detail?tenant="+a.getCurrentTenantName(),params:i,xPrefCredential:a.getXPrefCredential(),timeout:a.getTimeout(),onComplete:function(e){return new o(function(t,i){that.trackServices(),t(e)})}})},clear:function(){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/clear?tenant="+a.getCurrentTenantName(),params:{widgetId:a.getWidgetId()},xPrefCredential:a.getXPrefCredential(),timeout:a.getTimeout()})},getFavorites:function(e){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnavfav/favorite/getFavorites?tenant="+a.getCurrentTenantName(),xPrefCredential:e,params:{widgetId:a.getWidgetId()}})},createFavorite:function(e,t){var i="",n={...t,...{name:a.getUniqueId(),favDescription:"my nav fav",layoutType:a.getLayoutType()}};i="<p>"+d.get("Favorite_ErrorNotAccess")+"</br>";return i+=d.get("Favorite_ErrorCheckAccess")+"</br>",this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnavfav/favorite/createFavorite?tenant="+a.getCurrentTenantName(),xPrefCredential:e,params:n,failureParams:{message:i,subtitle:d.get("Favorite_ErrorTypeObject"),level:"error"}})},updateFavorite:function(e,t){var i={...t,...{favDescription:"my nav fav",layoutType:a.getLayoutType()}};return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnavfav/favorite/updateFavorite?tenant="+a.getCurrentTenantName(),xPrefCredential:e,params:i})},getFavoriteInfo:function(e,t){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnavfav/favorite/getFavoriteInfo?tenant="+a.getCurrentTenantName(),xPrefCredential:e,params:{widgetId:a.getWidgetId(),id:t}})},isFavorite:function(e,t){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnavfav/favorite/isFavorite?tenant="+a.getCurrentTenantName(),xPrefCredential:e,params:{widgetId:a.getWidgetId(),id:t}})},getSettingsAndRelSets:function(e){var t=this.getRelSettings(e),i=this.getPatterns(),n=this.getProfiles();return o.all([t,i,n])},getRelSettings:function(e){var t=this;return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelcc/cc_services/getrelsettings?tenant="+a.getCurrentTenantName(),onComplete:function(i){return e?new o(function(e,t){e(JSON.parse(i))}):t._parseSettings(JSON.parse(i))}},"GET")},_parseSettings:function(e){var t=this;return new o(function(i,n){e.notexist||void 0===e.relation_apps?t.getResetRelApps().then(function(e){i(e)}):i(e=e)})},getResetRelApps:function(){var e=this;return void 0===e._resetSettingsFromServer?this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelcc/cc_services/getrelappsinit?tenant="+a.getCurrentTenantName(),onComplete:function(t){return new o(function(i,n){e._resetSettingsFromServer=JSON.parse(t),i(e._resetSettingsFromServer)})}},"GET"):new o(function(t,i){t(e._resetSettingsFromServer)})},getPatterns:function(){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/getPatterns?tenant="+a.getCurrentTenantName(),params:{widgetId:a.getWidgetId(),roles:a.getRoles(),lang:a.getLang(),label:a.getLabelAPI()},xPrefCredential:a.getXPrefCredential(),timeout:a.getTimeout()})},getProfiles:function(){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/getProfiles?tenant="+a.getCurrentTenantName(),params:{widgetId:a.getWidgetId(),roles:a.getRoles(),lang:a.getLang(),label:a.getLabelAPI()},xPrefCredential:a.getXPrefCredential(),timeout:a.getTimeout()})},getSynchroStatus:function(e){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/getSynchroStatus?tenant="+a.getCurrentTenantName(),params:{widgetId:a.getWidgetId(),ids:e},xPrefCredential:a.getXPrefCredential(),timeout:a.getTimeout()})},fetchAttributes:function(e){var t=this,i={},n={attrs:[]};for(var s in i=a.getDefaultAttributes())n.attrs=[...n.attrs,...Array.from(new Set(i[s].attributes.map(function(e){return e.uri})))];return n.attrs=[...n.attrs,...a.getFetchAttributes()],n.attrs=[...new Set(n.attrs)],e={...e,...n},new o(function(i,n){t._fetchCall(e).then(function(t){l._processData(e,t).then(function(e){i(e)},function(){n()})})})},fetchRecents:function(e){var t=this,i={attrs:[...a.getOption("attributes"),...a.getFetchAttributes()],ids:e};return new o(function(e,n){t._fetchCall(i).then(function(t){l._processData(i,t).then(function(t){e(t)},function(){n()})})})},_fetchCall:function(e){return this.promiseManager.createPromise({url:a.get3DSpaceUrl()+"/cvservlet/fetch/v2?tenant="+a.getCurrentTenantName(),params:{physicalid:e.ids,select_predicate:e.attrs},timeout:a.getTimeout()})},trackServices:function(){r.getStartTime("getRelationCount")&&r.trackPerformance("getRelationCount","getRelationCount",{NumberOfObjects:a.getOption("getRelationCountNoOfObjects")}),r.getStartTime("getecosystem")&&r.trackPerformance("getecosystem","getecosystem",{NumberOfObjects:a.getOption("ecosystemNoOfObjects")}),r.getStartTime("detail")&&r.trackPerformance("detail","detail")}})}),define("DS/SNNavigationMap/views/SNMapSelector",["UWA/Core","UWA/Class/View","UWA/Utils/InterCom","DS/SNNavigationMap/utils/SNNavigationServices","DS/SNNavigationMap/utils/PreferencesUtils","DS/i3DXCompassServices/i3DXCompassPubSub","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a){"use strict";return{_ctx:{},_mapView:{},_listView:{},_collection:{},_platformId:"",_widgetId:"",_ObjectSelected:{},_mapViewSelected:{},_listViewSelected:{},_objectsInCompass:[],_feedBackMultiSelNumber:null,isSetTypesCallbackSubscribed:!1,viewContext:"",initialize:function(e){this._ctx=e.ctx,this._mapView=this._ctx.mapView,this._listView=this._ctx.listView,this._collection=e.collection,this._platformId=e.platformId||"onPremise",this._widgetId=e.widgetId;var t="com.ds."+this._widgetId;this._compassSocket=new i.Socket(t);this._compassSocket.subscribeServer("com.ds.compass",window.parent),this.isSetTypesCallbackSubscribed||(o.subscribe("setTypesCallback",this._setTypesCallback.bind(this)),this.isSetTypesCallbackSubscribed=!0)},_onSetObject:function(e){if(null==e)o.publish("resetObject"),o.publish("resetX3DContent"),o.publish("resetTypes");else{var t={serviceId:"3DSpace",objectId:e.get?e.get("id"):e.id,envId:this._platformId,contextId:""};o.publish("setObject",t);var i={widgetId:this._widgetId};o.publish("setTypes",i)}},_setTypesCallback:function(e){if(e.widgetId===this._widgetId){var t={appId:e.appId,widgetId:e.widgetId};if(this.getSelectedIDs().length>0){var i=this.buildSelectionForNativeApps(e.appId);t.fileName="-file",t.fileContent=JSON.stringify(i)}o.publish("launchApp",t)}},buildSelectionForNativeApps:function(e){const t={version:"2.4",completionOnCAD:"yes",results:[],structures:[]};let i=1;return this.getSelectedIDs().forEach(e=>{const n={id:i.toString(),phid:e};t.results.push(n);const s={structure:[{id:i.toString(),show:!0,select:!0,children:[]}]};t.structures.push(s),i++}),t},_AddFocusMS:function(e){var t=this._ctx.getElement("#container-"+CSS.escape(e));if(t){var i=t.getAttribute("class");-1===i.indexOf(" focus")&&(i+=" focus",t.setAttribute("class",i))}},_RemoveFocusMS:function(e){var t=this._ctx.getElement("#container-"+CSS.escape(e));if(t){var i=t.getAttribute("class");if(0<i.indexOf(" focus")){var n=i.replace(" focus","");t.setAttribute("class",n)}}},_changeSelectionToMapView:function(){var e=this._mapView.container,t=this._listView.container;if(this.viewContext="MapView",e){var i=this.getMapViewSelectedIds();e.removeClassName("unfocused"),this._mapView.switchFocus(i,!1)}t&&t.addClassName("unfocused")},_handleContextSwitch:function(e){"MapView"===this.viewContext&&(this._ObjectSelected=this._mapViewSelected,e&&this._changeSelectionToMapView()),this.setMultiSelCount(this.nbSelected().toString()),e&&n.sendToMapWebInWin("CleanCSO",[])},onObjectToMultiSel:function(e,t,i){var o=Array.isArray(e)?e:[e],a=o.length,r=[],l="";this.viewContext;if("add"===t){for(var d=0;d<a;d++){var c=(h=o[d]).id;this.initSelection(),this._mapViewSelected[c]=h,this._AddFocusMS(c),r.push(c),void 0!==h&&h.set("focus",!0)}l="InsertInCSO"}else if("remove"===t){for(d=0;d<a;d++){var h;c=(h=o[d]).id;r.push(c),delete this._mapViewSelected[c],this._RemoveFocusMS(c)}l="RemoveFromCSO"}if(this._handleContextSwitch(i),this._syncObjectToCompass(),l.length)if(i){var u=this.getSelectedIDs();u.length>0&&n.sendToMapWebInWin(l,u)}else n.sendToMapWebInWin(l,r);s.setPrefToWidget("ENORIPE_selectedNode",Object.keys(this._mapViewSelected))},setMultiSelCount:function(e){this._feedBackMultiSelNumber?"0"===e?this._feedBackMultiSelNumber.setContent(""):this._feedBackMultiSelNumber.setContent(e):this.initFeedbackMultiSel()},initMultiSel:function(e){e&&this.clearMultiSel(2),""===this.viewContext&&(this.viewContext="MapView"),"ListView"===this.viewContext?this._ObjectSelected=this._listViewSelected:this._ObjectSelected=this._mapViewSelected;var t=this.getSelected();t.length>0&&this.onObjectToMultiSel(t,"add")},initSelection:function(){""===this.viewContext&&(this.viewContext="MapView"),"ListView"===this.viewContext?this._ObjectSelected=this._listViewSelected:this._ObjectSelected=this._mapViewSelected},clearMultiSel:function(e){var t=this.getAllIDs(),i=t.length;if(2!==e){if(0===e);else if("ListView"===this.viewContext)return void this.clearMultiSelForListView();var s=this;this._collection.where({focus:!0}).forEach(function(e){s._RemoveFocusMS(e.get("id")),e.set("focus",!1)}),this._listView.clearPanel(),this._listView.hidePanel()}for(var o=i-1;o>=0;o--)delete this._mapViewSelected[t[o]],delete this._listViewSelected[t[o]],delete this._ObjectSelected[t[o]];this._listView&&this._listView.container&&this._listView.container.removeClassName("unfocused"),this.setMultiSelCount(this.nbSelected().toString()),n.sendToMapWebInWin("CleanCSO",[]),this._syncObjectToCompass()},clearMultiSelForListView:function(){for(var e=this.getAllIDs(),t=e.length-1;t>=0;t--)delete this._listViewSelected[e[t]];this._ObjectSelected=this._listViewSelected,this.setMultiSelCount(this.nbSelected().toString()),n.sendToMapWebInWin("CleanCSO",[]),this._syncObjectToCompass()},initFeedbackMultiSel:function(){var t,i=document.getElementsByClassName("multisel-icons");i&&i.length>0&&(t=i[0].getChildren())&&t.length>0&&(this._feedBackMultiSelNumber=e.createElement("span",{class:"feedBackMultiSel-count",html:""}).inject(t[0]))},updateFeedBack:function(e){for(var t=0;t<e.length;t++)delete this._ObjectSelected[e[t]],delete this._mapViewSelected[e[t]];this.setMultiSelCount(this.nbSelected().toString())},nbSelected:function(){return this.getSelectedIDs().length},isSelected:function(e){return this._ObjectSelected.hasOwnProperty(e)},getSelectedIDs:function(){return Object.keys(this._ObjectSelected)},getAllIDs:function(){var e=Object.keys(this._mapViewSelected);e=e.concat(Object.keys(this._listViewSelected));for(var t=Object.keys(this._ObjectSelected),i=0;i<t.length;i++)-1===e.indexOf(t[i])&&e.push(t[i]);return e},getSelectedItemsForDragAndDrop:function(){return this._collection.where({focus:!0})},getSelected:function(){var e=this;return Object.keys(this._ObjectSelected).map(function(t){return e._ObjectSelected[t]})},getInverseSelection:function(){return this._collection.getNotSelectedNodes()},getMapViewSelectedIds:function(){return Object.keys(this._mapViewSelected)},getNetworkPaths:function(e,t){var i,n,s=[],o=[[]],a=[];if(i=this._collection.get(e),n=this._collection.get(t),i&&n){if(o[0]=[i._attributes],s=[i,n],(s=[...s,...this._getCommon(this.getAllSuccessors([i]),this.getAllPredecessors([n]))]).length>0){if((o=this.getPathObjects([i],t,s,0,o))&&o[0].length>1){for(var r=0;r<o.length;r++){a[r]=[];for(var l=o[r],d=0;d<l.length-1;d++){let e=this._collection.where({modelType:"link",sourceId:l[d].id,targetId:l[d+1].id});if(e.length>=1){0===d&&a[r].push(l[d]);for(var c=0;c<e.length;c++)a[r].push(e[c]._attributes);a[r].push(l[d+1])}}}return a}return null}return null}return null},getPathObjects:function(e,t,i,n,s){var o,a=e.map(function(e){return e.get("id")}),r=[...s[n]];if(o=r[0].id,a.indexOf(t)>-1)return s;if(""!=o&&r.length>1&&a.indexOf(o)>-1)return s.splice(n,1),null;{let o=this._getCommon(this.getSuccessors(e),i);for(var l=0;l<o.length;l++)0===l?s[n].push(o[l]._attributes):(s[n]&&s[n].length>0&&n++,s[n]=[...r],s[n].push(o[l]._attributes)),this.hasPairInPath(r,e[0]._attributes.id,o[l]._attributes.id)||this.getPathObjects([o[l]],t,i,n,s);return s}},hasPairInPath:function(e,t,i){for(let n=0;n<e.length-1;n++)if(e[n].id===t&&e[n+1].id===i)return!0;return!1},getPredecessors:function(e){if(0!==e.length)return this._getDescendantsOrAscendants(e,"ascendant")},getAllPredecessors:function(e){if(0!==e.length)return this._getAllDescendantsOrAscendants(e,"ascendant")},getSuccessors:function(e){if(0!==e.length)return this._getDescendantsOrAscendants(e,"descendant")},getAllSuccessors:function(e){if(0!==e.length)return this._getAllDescendantsOrAscendants(e,"descendant")},getAllNeighbors:function(e){if(0!==e.length)return[...this.getAllSuccessors(e),...this.getAllPredecessors(e)]},getCommonDirectPredecessors:function(e){if(!(e.length<2)){for(var t=this.getPredecessors([e[0]]),i=1;i<e.length;i++)t=this._getCommon(t,this.getPredecessors([e[i]]));return t}},getCommonAllPredecessors:function(e){if(!(e.length<2)){for(var t=this.getAllPredecessors([e[0]]),i=1;i<e.length;i++)t=this._getCommon(t,this.getAllPredecessors([e[i]]));return t}},getCommonDirectSuccessors:function(e){if(!(e.length<2)){for(var t=this.getSuccessors([e[0]]),i=1;i<e.length;i++)t=this._getCommon(t,this.getSuccessors([e[i]]));return t}},getCommonAllSuccessors:function(e){if(!(e.length<2)){for(var t=this.getAllSuccessors([e[0]]),i=1;i<e.length;i++)t=this._getCommon(t,this.getAllSuccessors([e[i]]));return t}},_getCommon:function(e,t){if(0===e.length||0===t.length)return[];for(var i=[],n=0;n<e.length;n++)t.indexOf(e[n])>-1&&i.push(e[n]);return i},_getAllDescendantsOrAscendants:function(e,t){for(var i,n=[],s=[],o=[],a=this,r=0;r<e.length;r++)if(!(n.indexOf(e[r].get("id"))>-1)){i=this._getdescendantOrAscendantID(e[r].get("id"),t),s=i.slice();for(var l,d=0;i.length>0;)this._getdescendantOrAscendantID(s[d],t).forEach(function(e){-1===s.indexOf(e)&&s.push(e),-1===i.indexOf(e)&&i.push(e)}),l=i.indexOf(s[d]),i.splice(l,1),d++;s.forEach(function(e){-1===n.indexOf(e)&&n.push(e)})}return n.forEach(function(e){o.push(a._collection.get(e))}),o},_getDescendantsOrAscendants:function(e,t){for(var i,n=[],s=[],o=this,a=0;a<e.length;a++){i=this._getdescendantOrAscendantID(e[a].get("id"),t);for(var r=0;r<i.length;r++)-1===n.indexOf(i[r])&&n.push(i[r])}return n.forEach(function(e){s.push(o._collection.get(e))}),s},_getdescendantOrAscendantID:function(e,t){var i,n,s=[];this._collection.get(e);return this._collection.forEach(function(o){"link"===o.get("modelType")&&("descendant"===t?o.get("source")&&o.get("source").id===e&&(i=o.get("target"))&&i.id&&-1===s.indexOf(i.id)&&s.push(i.id):"ascendant"===t&&o.get("target")&&o.get("target").id===e&&(n=o.get("source"))&&n.id&&-1===s.indexOf(n.id)&&s.push(n.id))}),s},_syncPathToCompass:function(e){e.data&&e.data.items&&(0===e.data.items.length?this._onSetObject(null):(this._onSetObject({id:e.data.items[0].objectId,isPath:!0}),o.publish("setX3DContent",e)))},_syncObjectToCompass:function(){var e=this.getSelected();if(0===e.length)this._onSetObject(null);else{1===e.length&&this._onSetObject(e[0]);var t=this._buildCompassData({widgetId:this._widgetId,envId:this._platformId,selectedModels:e});o.publish("setX3DContent",t)}},_buildCompassData:function(t){var i={};if(e.is(t)){var n=t.selectedModels;if(e.is(n,"array")){i={protocol:"3DXContent",version:"1.1",source:"ENORIPE_AP",widgetId:t.widgetId,data:{items:[]}};var s=[];n.forEach(function(e){var i={};i=e.get?{envId:t.envId,serviceId:"3DSpace",contextId:"",objectId:e.id,objectType:e.get("type"),displayName:e.get("name"),displayType:e.get("type")}:{envId:t.envId,serviceId:"3DSpace",contextId:"",objectId:e.id,objectType:e.type,displayName:e.name,displayType:e.type},s.push(i)}),i.data.items=s}}return i},handleClearMap:function(){this._feedBackMultiSelNumber&&(this._feedBackMultiSelNumber.destroy(),this._feedBackMultiSelNumber=null)}}}),define("DS/SNNavigationMap/views/PathPanelView",["UWA/Core","UWA/Class","UWA/Class/View","UWA/Class/Promise","DS/WAFData/WAFData","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","DS/SNNavigationMap/utils/CommonUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/TransientWidget/TransientWidget","DS/Windows/Dialog","DS/TreeModel/TreeDocument","DS/Controls/Button","DS/Windows/ImmersiveFrame","DS/Controls/TooltipModel","DS/Tree/Tree","DS/TreeModel/TreeNodeModel","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/i3DXCompassPlatformServices/OpenWith","DS/UIKIT/Mask","DS/ENOFilterBIUX/FilterBIComponentProxy","DS/SNNavigationMap/utils/SNNavigationServices","DS/SNNavigationMap/views/SNMapSelector","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/DataGridView/DataGridViewLayout","DS/DataGridView/DataGridView","DS/i3DXCompassServices/i3DXCompassPubSub"],function(e,t,i,n,s,o,a,r,l,d,c,h,u,g,p,f,m,v,_,S,b,N,w,C,I,E,y,D,M){"use strict";return i.extend({name:"path-panel-view",_dialog:null,_selectedPathsInfo:[],models:[],className:function(){return this.getClassNames("-container")},setup:function(e){this._debug=e.debugMode,this._addinMode=e.addinMode||void 0,this._widgetId=e.widgetId||null,this.dimensions={},this.dimensions.position={},this.dimensions.position.offsetX=e.position.offsetX?e.position.offsetX:0,this.dimensions.position.offsetY=e.position.offsetY?e.position.offsetY:-150,this.dimensions.dialogWidth=e.position.dialogWidth?e.position.dialogWidth:600,this.dimensions.dialogHeight=e.position.dialogHeight?e.position.dialogHeight:200,this._immersiveFrame=new g,this._immersiveFrame.inject(this.container),this.container.addEventListener("dragenter",function(e){e.stopPropagation(),e.preventDefault()}),this._filterProxy=new N({tenant:o.getCurrentTenantName(),widgetId:this._widgetId}),this.isSetTypesCallbackSubscribed||(M.subscribe("setTypesCallback",this.setTypesCallback.bind(this)),this.isSetTypesCallbackSubscribed=!0)},renderInit:function(){this._createDialogContent(),null===this._dialog&&this._createDialog(),this.show(),this._dialog.position.offsetX=this.dimensions.position.offsetX;window.innerHeight;var e=window.innerWidth-180;this._dialog.width>e&&(this._dialog.width=e),this._dialog._applyPosition(),this._dialog._applyWidth()},render:function(e){if(this.renderInit(),e&&!(e&&e.length<1)){for(var t=0;t<e.length;t++)this.addStop(),this.addNodes(e[t]);this.findBtn.disabled=!0,this.currentFocusedItem.removeAttribute("focused"),this.inputLineForStart.setAttribute("focused",""),this.currentFocusedItem=this.inputLineForStart}},_createDialog:function(){this._dialog=new c({title:l.get("FindPaths"),content:this.mainContainer,immersiveFrame:this._immersiveFrame,width:this.dimensions.dialogWidth,minWidth:100,resizableFlag:!0,position:{at:"left",my:"center",offsetY:48},touchMode:!1,verticallyStretchableFlag:!0,floatableFlag:!1}),this._immersiveFrame.getDockingElement(WUXDockAreaEnum.LeftDockArea).collapsibleFlag=!1,this._immersiveFrame.dockWindow(this._dialog,WUXDockAreaEnum.LeftDockArea),this._dialog.addEventListener("close",this._close.bind(this))},_createDialogContent:function(){var t=this;this.mainContainer=e.createElement("div",{class:"path-main-container"}),this.pathInputContainer=e.createElement("div",{class:"path-input-container"}).inject(this.mainContainer),this.inputLineForStart=e.createElement("div",{class:"path-input-line",focused:""}).inject(this.pathInputContainer),this.currentFocusedItem=this.inputLineForStart;var i=e.createElement("div",{class:"path-input-line-span-div"}).inject(this.inputLineForStart);this.startSpan=e.createElement("span",{text:l.get("FindPathStart")}).inject(i);var n=e.createElement("div",{class:"path-line-editor"}).inject(this.inputLineForStart);n.addEventListener("click",function(e){t._onClickInputLineEditor(this,e)});e.createElement("div",{class:"path-line-editor-icon"}).inject(n),e.createElement("div",{class:"path-line-editor-content","data-placeholder":l.get("SelectStart")}).inject(n);new u({displayStyle:"lite",icon:{iconName:"clear",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.inputLineForStart).addEventListener("click",function(e){t._onClickClearInputLine(this,e)});var s=e.createElement("div",{class:"addstops-container"}).inject(this.mainContainer);this.addStopsBtn=new u({label:l.get("FindPathAddStop"),icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS},onClick:t.addStop.bind(this)}).inject(s),this.pathOptionsContainer=e.createElement("div",{class:"path-options-container"}).inject(this.mainContainer),this.optionsButtonGroup=new E({type:"radio"});var o=new I({type:"radio",label:l.get("StructurePathsOptionLabel"),value:0,checkFlag:!0}),a=e.createElement("div",{class:"wux-ui-3ds-help wux-ui-3ds"});a.tooltipInfos=new p({shortHelp:l.get("StructurePathsOptionTooltip")}),o.getContent().appendChild(a);var r=new I({type:"radio",label:l.get("NetworkPathsOptionLabel"),value:1}),d=e.createElement("div",{class:"wux-ui-3ds-help wux-ui-3ds"});d.tooltipInfos=new p({shortHelp:l.get("NetworkPathsOptionTooltip")}),r.getContent().appendChild(d),this.optionsButtonGroup.addChild(o),this.optionsButtonGroup.addChild(r),this.optionsButtonGroup.inject(this.pathOptionsContainer),this.pathOptionsContainer.setAttribute("disabled","");var c=e.createElement("div",{class:"findbtn-container"}).inject(this.mainContainer);this.findBtn=new u({label:l.get("Find"),onClick:t.showPathsBetween.bind(this)}).inject(c),this.findBtn.disabled=!0,this.pathResultContainer=e.createElement("div",{class:"path-result-container"}).inject(this.mainContainer),this.resultLoadingContainer=e.createElement("div",{class:"path-result-loading-container"}).inject(this.pathResultContainer),this.pathsTreeDocument=new h,this.pathsTreeDocument.onPostExpand(function(e){if(void 0!==t.resultDatagridView&&1==t.resultDatagridView.visibleFlag){var i=t.resultDatagridView.layout.getColumnHeaderHeight()+t.pathsTreeDocument.getNumberOfVisibleDescendants()*t.resultDatagridView.layout.getRowHeight();this.pathResultContainer.style.setProperty("min-height",i+50+"px")}}.bind(this)),this.pathsTreeDocument.onPostCollapse(function(e){if(void 0!==t.resultDatagridView&&1==t.resultDatagridView.visibleFlag){var i=t.resultDatagridView.layout.getColumnHeaderHeight()+t.pathsTreeDocument.getNumberOfVisibleDescendants()*t.resultDatagridView.layout.getRowHeight();this.pathResultContainer.style.setProperty("min-height",i+50+"px")}}.bind(this))},addStop:function(){var t=this,i=e.createElement("div",{class:"path-input-line",focused:""}).inject(t.pathInputContainer),n=e.createElement("div",{class:"path-input-line-span-div"}).inject(i),s=e.createElement("span",{text:l.get("FindPathStop")}).inject(n),o=e.createElement("div",{class:"path-line-editor"});o.addEventListener("click",function(e){t._onClickInputLineEditor(this,e)}),o.inject(i);e.createElement("div",{class:"path-line-editor-icon"}).inject(o),e.createElement("div",{class:"path-line-editor-content","data-placeholder":l.get("SelectStop")}).inject(o);new u({displayStyle:"lite",icon:{iconName:"clear",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(i).addEventListener("click",function(e){t._onClickClearInputLine(this,e)}),t.currentFocusedItem.removeAttribute("focused"),t.currentFocusedItem=i;var a=t.startSpan.offsetWidth/2;s.style.marginLeft=a+15+"px";var r=t.startSpan.offsetLeft+t.startSpan.offsetWidth/2,d=s.offsetLeft-r-10;e.createElement("div",{class:"path-dotted-line",styles:{left:r,width:d}}).inject(i);t.addStopsBtn.disabled=!0},_createAndDisplayDatagrid:function(){var e=this.pathsTreeDocument.getRoots().length,t=[{dataIndex:"tree",text:l.replace(l.get("FindPathPathsFound"),{N:e}),getCellTooltip:function(e){var t=e.nodeModel;if(t&&t.options.grid&&t.isRoot()){for(var i=t.getAllDescendants(),n="",s=0;s<i.length;s++)0!==s&&(n+="\n"),n+=s+". "+i[s].getLabel();if(""!==n)return{shortHelp:n}}}}],i=new y({useLastColumnWidthAutoFlag:!0});this.resultDatagridView=new D({treeDocument:this.pathsTreeDocument,columns:t,showRowIndexFlag:!1,showContextualMenuColumnFlag:!0,cellDragEnabledFlag:!0,showRowBorderFlag:!0,showColumnBorderFlag:!0,showSelectionCheckBoxesFlag:!0,columnDragEnabledFlag:!1,rowSelection:"multiple",cellSelection:"none",useDragAndDrop:!0,selectionBehavior:{unselectAllOnEmptyArea:!0,toggle:!1,canMultiSelect:!0,enableShiftSelection:!0,canInteractiveMultiselectWithCheckboxClick:!0},defaultColumnDef:{editableFlag:!1,alignment:"near"},layout:i,onContextualEvent:function(e){return this._buildContextualMenu(e).then(function(e){return e})}.bind(this)}).inject(this.pathResultContainer);var n=this.resultDatagridView.columns.find(e=>"ContextualMenuColumn"===e.dataIndex);void 0!==n&&(n.getCellClassName=function(e){var t="";return e.nodeModel&&!e.nodeModel.isRoot()&&(t="hidden-contextual-menu"),t});var s=this.resultDatagridView.layout.getColumnHeaderHeight()+this.pathsTreeDocument.getNumberOfVisibleDescendants()*this.resultDatagridView.layout.getRowHeight();this._setRowEvent(),this.resultDatagridView.show(),this.pathResultContainer.style.setProperty("min-height",s+50+"px")},_destroyDatagrid(){this.resultDatagridView&&(this.resultDatagridView.hide(),this.resultDatagridView.destroy())},_setRowEvent:function(){var e=this,t=null;(t=e.pathsTreeDocument.getXSO()).onPostAdd(function(i){i.forEach(function(i){var n=i.getAttributeValue("pathInfo"),s=n.pathId;-1===e._selectedPathsInfo.findIndex(e=>e.pathId===s)&&(e._selectedPathsInfo.push(n),e._updatePathsOnCompass()),e._getAllNodesById(s).forEach(function(e){t.isIn(e)||t.add(e)})})}),t.onPostRemove(function(i){i.forEach(function(i){var n=i.getAttributeValue("pathInfo").pathId,s=e._selectedPathsInfo.findIndex(e=>e.pathId===n);-1!==s&&(e._selectedPathsInfo.splice(s,1),e._updatePathsOnCompass()),e._getAllNodesById(n).forEach(function(e){t.isIn(e)&&t.remove(e)})})}),e.resultDatagridView.onDragStartCell=function(t,i){var n=e._selectedPathsInfo,s=e._buildDragMessage(n);if(!s)return e.dispatchEvent("_showError",[{message:"noPathSelected"}]),!1;if(s=JSON.stringify(s),t.dataTransfer)if(w.isWebInWin())t.dataTransfer.setData("text",s);else try{t.dataTransfer.setData("text",s),t.dataTransfer.setData("text/searchitems",s)}catch(e){console.log(e),t.dataTransfer.setData("Text",s)}w.isWebInWin()||d.closeWidget()},e.resultDatagridView.onDragEndCell=function(t,i){e.dispatchEvent("ENORIPE_dragEnd")}},emptyGridViewSelection:function(){if(this.pathsTreeDocument){this.pathsTreeDocument.getRoots().forEach(e=>{this.pathsTreeDocument.getXSO().remove(e)})}},_getAllNodesById:function(e){return this.pathsTreeDocument.search({match:function(t){if(e&&t.nodeModel.getAttributeValue("pathInfo").pathId===e)return!0}})},_buildContextualMenu:function(e){var i=this,n=[],s={},o=null,r={};if(e.cellInfos&&e.cellInfos.nodeModel&&e.cellInfos.rowID>-1&&(o=e.cellInfos.nodeModel),o){var d=(r=o.getAttributeValue("pathInfo")).pathId;if(-1===i._selectedPathsInfo.findIndex(e=>e.pathId===d)){var c=i.pathsTreeDocument.getXSO();c.empty();var h=i._getAllNodesById(d);c.add(h[0])}}return new t.Promise(function(t,d){if(w.isWebInWin()){var c=i._buildDragMessage(i._selectedPathsInfo,!0);if(!c)return i.dispatchEvent("_showError",[{message:"noPathSelected"}]),!1;c=JSON.stringify(c);var h="",u=[];"StructurePath"===r.pathType?(h=i._buildAddMessage(i._selectedPathsInfo),u=i._getSelectedIds()):u=i._getSelectedNodesIds(),w.sendToMapWebInWin("onComputeCtxMenu",[]);var g={targetId:u,targetElement:e.infos.target,typeOfPath:r.pathType,jsonMsgForOpen:c,jsonMsgForAddInGraph:h};this.dispatchEvent("ContextualMenuFindPath",g)}else{var p=o.getAttributeValue("pathInfo").pathType;"StructurePath"===p?n.push({type:"PushItem",icon:{iconName:"plus",fontIconFamily:1},title:l.get("FindPathAddInGraph"),action:{callback:function(){var e=i._selectedPathsInfo,t=i._buildAddMessage(e),n=i._getSelectedIds();i.dispatchEvent("ENORIPE_AddInGraph",[n,t]),a.trackUsage("FindPath","AddInGraph")}}}):n.push({type:"PushItem",icon:{iconName:"select-on",fontIconFamily:1},title:l.get("FindPathSelectInGraph"),action:{callback:function(){var e=i._getSelectedIds();i.dispatchEvent("ENORIPE_SelectInGraph",[e]),a.trackUsage("FindPath","SelectInGraph")}}});var f=i._selectedPathsInfo,m=i._createOpenWithContent(f,p);(s=(new S).set3DXContent(m,!0)).retrieveCompatibleApps(function(e){if(e&&e.length>0){var t=[];if(e.forEach(function(e){t.push({type:"PushItem",title:e.text,fonticon:e.fonticon&&e.fonticon.length>0?{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon,family:WUXManagedFontIcons.Font3DS}:void 0,icon:e.icon?e.icon:"",action:{callback:function(){e.handler(),a.trackUsage("FindPath","OpenWith")}}})}),t.length>0){var i={name:"OpenWith",type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+s.DROPDOWN_CONF.fonticon},title:s.DROPDOWN_CONF.text,submenu:t};n.push(i)}}}),setTimeout(function(){t(n)},50)}}.bind(this))},_getSelectedIds:function(){var e=[];for(let t of this._selectedPathsInfo)for(let i of t.path)e.includes(i.resourceid)||e.push(i.resourceid);return e},_getSelectedNodesIds:function(){var e,t=[];for(let i of this._selectedPathsInfo)for(let n of i.path)void 0===(e=n.modelType)||"node"!==e||t.includes(n.resourceid)||t.push(n.resourceid);return t},_onClickInputLineEditor:function(e){var t=this.currentFocusedItem.getElement(".path-line-editor");if(void 0!==t&&t!==e){this.currentFocusedItem.removeAttribute("focused");var i=e.getParent();null!=i&&(i.setAttribute("focused",""),this.currentFocusedItem=i)}},_onClickClearInputLine:function(e){var t=this,i=e.getParent();if(void 0!==i){var n,s=i.getElement(".path-line-editor"),o=i.getData("id");if(void 0!==o){var a=t.models.findIndex(e=>e.get("id")===o);void 0!==a&&t.models.splice(a,1)}if(i===t.inputLineForStart)i.removeAttribute("data-id"),s.getElement(".path-line-editor-icon").setStyle("background-image",""),s.getElement(".path-line-editor-content").innerHTML="";else if(i.remove(),t.currentFocusedItem===i){var r=(n=t.pathInputContainer.getElements(".path-input-line")).find(e=>void 0===e.getData("id"));void 0!==r?(t.currentFocusedItem=r,t.currentFocusedItem.setAttribute("focused","")):(t.currentFocusedItem=t.inputLineForStart,t.inputLineForStart.setAttribute("focused",""))}var l=void 0!==t.inputLineForStart.getData("id"),d=t.models.length;n=t.pathInputContainer.getElements(".path-input-line"),l&&void 0!==n&&d>=2?(t.findBtn.disabled=!1,t.pathOptionsContainer.removeAttribute("disabled")):(t.findBtn.disabled=!0,t.pathOptionsContainer.setAttribute("disabled","")),n.find(e=>e!==t.inputLineForStart&&void 0===e.getData("id"))||(t.addStopsBtn.disabled=!1)}},_createOpenWithContent:function(e,t){var i=null,n={},s={},a=[];try{o.getPlatformId()||"OnPremise"}catch(e){""}if(s={protocol:"3DXContent",version:"1.1",source:"ENORIPE_AP",widgetId:w.isWebInWin()?"web_in_win":this._widgetId,data:{items:[]}},"StructurePath"===t)for(var r=0;r<e.length;r++){if((a=e[r].path).length>0){i=a[0],n={envId:o.getPlatformId()||"OnPremise",serviceId:"3DSpace",contextId:"",objectId:i.resourceid,objectType:i.type,displayName:i.displayName,displayType:i.type,session_object:!1,path:a};s.data.items.push(n)}}else{const t=new Set;for(r=0;r<e.length;r++){if((a=e[r].path).length>0)for(var l=0;l<a.length;l++)a[l].resourceid&&!t.has(a[l].resourceid)&&a[l].displayName&&(i=a[l],n={envId:o.getPlatformId()||"OnPremise",serviceId:"3DSpace",contextId:"",objectId:i.resourceid,objectType:i.type,displayName:i.displayName,displayType:i.type,session_object:!1},s.data.items.push(n),t.add(i.resourceid))}}return s},addNodes:function(e){var t=this;if(-1===t.models.findIndex(t=>t.get("id")===e.get("id"))){var i=t.currentFocusedItem.getData("id");if(void 0!==i&&""!==i){var n=t.models.findIndex(e=>e.get("id")===i);void 0!==n&&t.models.splice(n,1)}var s=t.currentFocusedItem.getElement(".path-line-editor");null!==s&&(s.getElement(".path-line-editor-icon").setStyle("background-image","url("+e.get("type_icon_url")+")"),s.getElement(".path-line-editor-content").innerHTML=e.get("name")),t.currentFocusedItem.setData("id",e.get("id")),t.models.push(e);var o=t.pathInputContainer.getElements(".path-input-line");o.find(e=>e!==t.inputLineForStart&&void 0===e.getData("id"))||(t.addStopsBtn.disabled=!1);var a=void 0!==t.inputLineForStart.getData("id"),r=t.models.length;a&&void 0!==o&&r>=2?(t.findBtn.disabled=!1,t.pathOptionsContainer.removeAttribute("disabled")):(t.findBtn.disabled=!0,t.pathOptionsContainer.setAttribute("disabled",""))}},showPathsBetween:function(){var e=this,t=e.inputLineForStart.getData("id"),i=e.models.find(e=>e.get("id")===t);if(void 0!==i){var s=e.models.filter(e=>e.get("id")!==t);if(!(s.length<=0)){e._destroyDatagrid(),e.pathsTreeDocument.empty(),b.mask(e.resultLoadingContainer);var o=e.optionsButtonGroup.value,r=Array.isArray(o)&&1===o.length&&1===o[0]?"NetworkPath":"StructurePath";if(a.trackUsage("FindPaths","TypeOfPath-"+r),"StructurePath"===r){for(var l=[],d=0;d<s.length;d++)"ENOStrRefinementSpecification"===i.get("type")?l.push(e.computeFilterPath(i,s[d])):l.push(e.computeStructurePaths(i,s[d]));n.all(l).then(function(){b.unmask(e.resultLoadingContainer),e._createAndDisplayDatagrid()})}else{var c=[],h=[],u=0;for(d=0;d<s.length;d++)u=s[d].get("id"),null!=(h=C.getNetworkPaths(t,u))&&h.length>0?c=c.concat(h):this.dispatchEvent("noPathsFound",{type:"NetworkPath",anchor:i.get("name"),selected:s[d].get("name")});this._parseResponse({paths:c}),b.unmask(e.resultLoadingContainer),e._createAndDisplayDatagrid()}}}},_renderStructurePaths:function(e){var t=[],i=[],n={};e.infos.error||void 0!==e.results&&0!==e.results.length&&(e.results.forEach(function(e){if(e.Path)t.push(e.Path);else if(e.resourceid){let t;if(e.from?e.name=e["ds6w:label"]:e.displayName=e["ds6w:label"],e.type=e["ds6w:type"],"Person"===e.type){let i=e["ds6w:identifier"];i&&(t=r.getUser3DSwymPictureURL(i))}e.type_icon_url=t||e.icon,n[e.resourceid]=e}}),t.forEach(function(e){var t=[];e.forEach(function(e){t.push(n[e])}),i.push(t)}),this._setStructurePaths(i))},_setStructurePaths:function(e){var t,i="StructurePath";this.pathsTreeDocument.prepareUpdate();for(let h of e){t=this._generateRandomPathId();var n=Math.floor(h.length/2)+1,s=l.replace(l.get("FindPathObjects"),{N:n}),o=new m({label:s,grid:{pathInfo:{path:h,pathType:i,pathId:t}}});this.pathsTreeDocument.addRoot(o);var a=new m({label:h[0].displayName,icons:h[0].type_icon_url?[h[0].type_icon_url]:"",children:[],grid:{label:h[0].displayName,nodeInfo:h[0],pathInfo:{path:h,pathType:i,pathId:t}}});o.addChild(a);for(var r,d="",c=2;c<h.length;c++)2===c?(d=h[c].displayName+" ("+h[1].name+")",r=a.addChild(new m({label:d,icons:h[c].type_icon_url?[h[c].type_icon_url]:"",grid:{label:d,nodeInfo:h[c],pathInfo:{path:h,pathType:i,pathId:t}}}))):h[c].displayName&&(d=h[c].displayName+" ("+h[c-1].name+")",r=r.addChild(new m({label:d,icons:h[c].type_icon_url?[h[c].type_icon_url]:"",grid:{label:d,nodeInfo:h[c],pathInfo:{path:h,pathType:i,pathId:t}}})));a.expandAll()}this.pathsTreeDocument.pushUpdate()},_setNetworkPaths:function(e){var t;this.pathsTreeDocument.prepareUpdate();for(let a of e){t=this._generateRandomPathId();var i=0,n=new m({grid:{pathInfo:{path:a,pathType:"NetworkPath",pathId:t}}});this.pathsTreeDocument.addChild(n);for(var s=0;s<a.length;s++)a[s].displayName&&(n.addChild(new m({label:a[s].displayName,icons:a[s].type_icon_url?[a[s].type_icon_url]:"",grid:{label:a[s].displayName,nodeInfo:a[s],pathInfo:{path:a,pathType:"NetworkPath",pathId:t}}})),i+=1);var o=l.replace(l.get("FindPathObjects"),{N:i});n.setLabel(o)}this.pathsTreeDocument.pushUpdate()},_generateRandomPathId:function(){return"path_"+Math.floor(1e4*Math.random())},_buildDragMessage:function(e,t){var i,n=null,s={},a={},r=[];try{i=o.getPlatformId()||"OnPremise"}catch(e){i=""}a={protocol:"3DXContent",version:"1.1",source:"ENORIPE_AP",widgetId:w.isWebInWin()?"web_in_win":this._widgetId,data:{items:[]}};for(var l=0;l<e.length;l++){var d=e[l];if(r=d.path,"StructurePath"===d.pathType)s={envId:i,serviceId:"3DSpace",contextId:"",objectId:(n=r[0]).resourceid,objectType:n.type,displayName:n.displayName,displayType:n.type,session_object:!1,path:r},a.data.items.push(s);else for(var c=0;c<r.length;c++)void 0!==r[c].displayName&&(s={envId:i,serviceId:"3DSpace",contextId:"",objectId:(n=r[c]).resourceid,objectType:n.type,displayName:n.displayName},a.data.items.push(s))}if(w.isWebInWin()&&t){var h,u,g,p=[];for(l=0;l<e.length;l++){[],0,g=[],n=(r=e[l].path)[0],u=(h=r).length;for(c=0;c<u;c++)g.push(h[c].resourceid);p.push(g)}p.length>0&&w.sendToMapWebInWin("RefreshOnDragPath",p,"path")}return a},_buildAddMessage:function(e){var t,i=null,n={},s={},a=[];try{t=o.getPlatformId()||"OnPremise"}catch(e){t=""}s={protocol:"3DXContent",version:"1.1",source:"ENORIPE_AP",widgetId:w.isWebInWin()?"web_in_win":this._widgetId,data:{items:[]}};for(var r=0;r<e.length;r++){a=e[r].path;for(var l=0;l<a.length;l++)void 0!==a[l].displayName&&(n={envId:t,serviceId:"3DSpace",contextId:"",objectId:(i=a[l]).resourceid,objectType:i.type,displayName:i.displayName},s.data.items.push(n))}return s},_getExpandParams:function(e,t){var i=[],n={sequence:[{uql:"physicalid:"+t}]},s={label:"Relations "+Date.now(),root:{physical_id:e},graph:{descending_condition:{uql:"[ds6w:type]:* AND (NOT(flattenedtaxonomies:(types/PLMPort) OR flattenedtaxonomies:(types/PLMConnection)))"}},filter:{or:{filters:[{sequence_filter:n}]}},aggregation_processors:[{truncate:{max_distance_from_prefix:0,compute_matching_subpaths_lengths:1,sequence_filter:n}}]};return i.push(s),{batch:{expands:i},outputs:{select_object:["physicalid","ds6w:label","ds6w:type","ds6w:identifier"],select_relation:["physicalid","ds6w:label","ds6w:type","ds6w:identifier"],matching_lengths:1,hits:{predefined_computation:["thumbnail_2d","icons"]},format:"entity_relation_occurrence"}}},_updatePathsOnCompass:function(){var e=this._selectedPathsInfo,t=this._buildDragMessage(e);this.dispatchEvent("ENORIPE_SetPathOnCompass",[t])},computeStructurePaths:function(e,t){var i=this,s=t.get("id"),o=e.get("id"),a=this._getExpandParams(o,s);return new n(function(n,s){i._expandCall(a).then(function(s){s=s.substring(0,s.length-2),(s=JSON.parse(s)).infos.error?n():void 0!==s.results?(0===s.results.length?i.dispatchEvent("noPathsFound",{type:"StructurePath",anchor:e.get("name"),selected:t.get("name")}):i._renderStructurePaths(s),n()):n()})})},computeFilterPath:function(e,t){var i=this;return new n(function(n,s){var a=t.get("id"),r=e.get("linked").get("id"),l=e.get("id");if(r!==a){var d=i._getExpandParams(r,a);o.get3DSpaceUrl(),o.getCurrentTenantName();i._filterProxy.getFilterIdSpec(l,{V2:{find_in_context:"physicalid:"+a}}).then(function(s){if(void 0!==s)if(void 0!==s.filter){try{delete s.filter.or.filters[0].and.filters[1].sequence_filter.sequence[0].uql_prefix_handler}catch(e){return console.log(e),void n()}d.batch.expands[0].filter=s.filter,i._expandCall(d).then(function(s){s=s.substring(0,s.length-2),(s=JSON.parse(s)).infos.error?n():void 0!==s.results?(0===s.results.length?i.dispatchEvent("noPathsFound",{type:"StructurePath",anchor:e.get("name"),selected:t.get("name")}):i._renderStructurePaths(s),n()):n()})}else n();else n()},function(e){console.log(e),n()})}else n()})},_expandCall:function(e){var t=o.get3DSpaceUrl()+"/cvservlet/progressiveexpand/v2?tenant="+o.getCurrentTenantName();return new n(function(i,n){s.authenticatedRequest(t,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",data:JSON.stringify(e),onComplete:function(e){i(e)},onFailure:function(e){console.log(e),n(e)},onTimeout:function(e){console.log(e),n(e)}})})},_parseResponse:function(e){e&&void 0!==typeof e.paths&&(e.paths.forEach(function(e){e.forEach(function(e){e.resourceid=e.id,void 0===e.displayName&&(e.type.contains("_to")||e.type.contains("_from")||(e.displayName=e.name))})}),this._setNetworkPaths(e.paths))},setTypesCallback:function(e){if(e.widgetId===this._widgetId){if(this._selectedPathsInfo.length>0){var t={appId:e.appId,widgetId:e.widgetId},i=this.buildSelectionForNativeApps();t.fileName="-file",t.fileContent=i}M.publish("launchApp",t)}},buildSelectionForNativeApps:function(){const e={version:"2.4",completionOnCAD:"yes",results:[],structures:[]};let t=1;if("StructurePath"===this._selectedPathsInfo[0].pathType){let i=0,n=-1;this._selectedPathsInfo.map(e=>e.path).forEach(s=>{const o={id:t.toString(),show:!0,select:!1,children:[]};s.reduce((s,o)=>{const a={id:t.toString(),phid:o.resourceid};if(e.results.push(a),n<i){n++;const t={structure:[s]};e.structures.push(t)}else{const e={id:t.toString(),show:!0,select:!1,children:[]};s.children.push(e),s=e}return t++,s},o),i++})}else if("NetworkPath"===this._selectedPathsInfo[0].pathType){this._getSelectedNodesIds().forEach(i=>{const n={id:t.toString(),phid:i};e.results.push(n);const s={structure:{id:t.toString(),show:!0,select:!1,children:[]}};e.structures.push(s),t++})}return JSON.stringify(e)},updateDialogSizeOnResize:function(){if(this._dialog){var e=window.innerWidth-180;this._dialog.width>e&&(this._dialog.width=e),this._dialog._applyPosition(),this._dialog._applyWidth()}},_close:function(){if(this._dialog){this.dimensions.dialogWidth=this._dialog.width,this.dimensions.dialogHeight=this._dialog.height;var e=this._dialog.position;e.offsetX=e.offsetX+this._dialog.width/2,this.dimensions.position=e,this.models=[],this.emptyGridViewSelection(),this._selectedPathsInfo=[],this._dialog.destroy(),this._dialog=null,this.hide(),this.dispatchEvent("PathPanelViewClose")}}})}),define("DS/SNNavigationMap/utils/SearchUtils",["UWA/Class","UWA/Utils/InterCom","DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI","DS/SNNavigationMap/MapSettings","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],function(e,t,i,n,s,o,a,r){"use strict";return e.extend({_currentRequest:null,init:function(e){this._debug=e.debugMode||!1,this._isWebInWin=e.isWebInWin,this._notifManager=a,r.setNotificationManager(this._notifManager)},_searchCall:function(t){var n=this,s={};return this._currentRequest&&this._currentRequest.cancel(),this._debug&&(s.debug=!0),s.label=this._getSearchLabel(),s.query=this._getQueryFromIds(t.ids,t.value),s.tenant=t.tenantName,s.with_synthesis_attribute=!1,s.with_synthesis=!1,s.select_predicate=["ds6w:label"],s=JSON.stringify(s),new e.Promise(function(e,a){n._currentRequest=i.authenticatedRequest(t.url,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",data:s,onComplete:function(t){n._currentRequest=null,e(t)},onFailure:function(e){n._currentRequest=null,console.log(e),n._notifManager.addNotif({level:"error",message:o.get("generic"),sticky:!0}),a(e)},onTimeout:function(e){n._currentRequest=null,console.log(e),n._notifManager.addNotif({level:"error",msg:Nls.get("timeout"),subtitle:Nls.get("verifyConnection"),sticky:!0}),a(e)}})})},_getQueryFromIds:function(e,t){for(var i=t+" AND",n=0;n<e.length;n++)i=0===n?i+" (physicalid:"+e[n]:(i+=" OR ")+"physicalid:"+e[n];return i+=")"},_getSearchLabel:function(){if(this._isWebInWin)return"ENORIPE_"+Date.now();var e=n.getUser();return"ENORIPE_"+(null!=e&&void 0!==e.login?e.login:"")+"_"+Date.now()},inAppSearch:function(e){var i=Object.assign(this._getDefaultRegistrationOpts(),e),n=new t.Socket(i.app_socket_id,{dispacthRetryInterval:0});!0===e.debug_mode&&n.setDebugMode(!0),UWA.is(e.parent_window)?n.subscribeServer("SearchComServer",window):n.subscribeServer("SearchComServer"),n.dispatchEvent("RegisterContext",i),i.default_search_criteria=e.fts_value,n.dispatchEvent("InContextSearch",i);var s=function(t){switch(t.selected_command){case"in_app_ok":e.callback.call(null,t.selected_data);break;default:e.cancel&&e.cancel.call(null)}n.removeListener("onCloseTransient",s),n.dispatchEvent("UnregisterContext",{widget_id:i.widget_id})};n.addListener("InContextSearch_Response",s),n.addListener("onCloseTransient",s)},_getDefaultRegistrationOpts(){var e=s.getWidgetId();return{mode:"furtive",default_with_precond:!0,widget_id:e,app_socket_id:"enosearchutils_"+e,idcard_activated:!1,multiSel:!0,advanced_search:{showByDefault:!1},tenant:s.getPlatformId()}}})}),define("DS/SNNavigationMap/utils/TaggerServices",["UWA/Controls/Abstract","UWA/Class/Events","UWA/Core","DS/ENOFilterBIUX/FilterBIComponentProxy","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/SNNavigationServices","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a){"use strict";return e.extend(t,{widgetId:null,addVolatileTags:!1,_filterProxy:null,_colorMapsForVolatileTags:{},_summariesForVolatileTags:[],_activate:!0,init:function(e){this.widgetId=e.widgetId,this.addVolatileTags=e.addVolatileTags,this.addVolatileTags&&(this._colorMapsForVolatileTags=e.colorMapsForVolatileTags,this._summariesForVolatileTags=e.summariesForVolatileTags),this.createFilterProxy(e.taggerProxyOptions)},createFilterProxy:function(e){var t=this,i={};i={tenant:s.getCurrentTenantName(),appId:s.getAppId(),colorize:!0,widgetId:this.widgetId,isWebInWin:o.isWebInWin(),platformServices:s.getOption("platform_services")},e&&e.activateSelection&&(i.selection={}),this._filterProxy||(this._filterProxy=new n(i),this._filterProxy.addEvent("fetchFilterBIColorizeEvent",function(e){t._activate&&t.dispatchEvent("Tagger_FilterBIColorize",[e])}),this._filterProxy.addEvent("FilterBIUnColorize",function(e){t._activate&&t.dispatchEvent("Tagger_FilterBIUnColorize")}),this._filterProxy.addEvent("fetchFilterBIFilteringEvent",function(e){t._activate&&t.dispatchEvent("Tagger_FilterBIFilteringEvent",e)}),this._filterProxy.addEvent("ColorizeVolatile",function(e){t._activate&&t.dispatchEvent("Tagger_ColorizeVolatile",e)}),this._filterProxy.addEvent("FilterVolatile",function(e){t._activate&&t.dispatchEvent("Tagger_FilteringVolatile",e)}),this._filterProxy.addEvent("FilterBISelectionEvent",function(e){t._activate&&t.dispatchEvent("Tagger_FilterBISelection",e)}),this._filterProxy.addEvent("SelectVolatile",function(e){t._activate&&t.dispatchEvent("Tagger_SelectVolatile",e)}))},updateFilterProxy:function(e,t){var i=this;t=t||!1,this._filterProxy&&(this.addVolatileTags?this._filterProxy.setTagsWithFetchSynthesis(e,function(e){i._filterProxy.setVolatileTags({summary:i._summariesForVolatileTags,colorMap:i._colorMapsForVolatileTags,paramsFromFBI:e})},t):this._filterProxy.setTagsWithFetchSynthesis(e))},updateVolatileTags:function(e){e&&(this._summariesForVolatileTags=e)},cleanProxy:function(){this._filterProxy&&this._filterProxy.cleanProxy()},removeRoots:function(e){this._filterProxy&&this._filterProxy.removeRoot(e)},deactivate:function(){this._activate=!1,this._filterProxy.deactivate()},activate:function(){this._activate=!0,this._filterProxy.activate()},isActivated(){return this._activate},setSelectStatus:function(){this._filterProxy&&this._filterProxy.setSelectStatus({status:!0})}})}),define("DS/SNNavigationMap/views/PreviewView",["UWA/Core","UWA/Class/View","UWA/Date","UWA/Utils/InterCom","DS/TreeModel/TreeNodeModel","DS/Controls/TooltipModel","DS/WebappsUtils/WebappsUtils","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/DropdownMenu","DS/UIKIT/Spinner","DS/UIKIT/Alert","DS/UIKIT/Tooltip","DS/UIKIT/Accordion","DS/UIKIT/Scroller","DS/PlatformAPI/PlatformAPI","DS/SNNavigationMap/utils/TaggerServices","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","DS/SNNavigationMap/utils/PreferencesUtils","DS/SNNavigationMap/utils/SNNavigationServices","DS/SNNavigationMap/utils/CommonUtils","DS/i3DXCompassPlatformServices/OpenWith","DS/i3DXCompassServices/i3DXCompassPubSub","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a,r,l,d,c,h,u,g,p,f,m,v,_,S,b,N,w,C,I){"use strict";return t.extend({_SERVICENAME:"3DSpace",name:"preview",_propertiesCommandRequire:"DS/ENOCollabSharingCmds/commands/EditPropCmd/EditPropCmdBase",_views:[{fonticon:"view-small-tile",text:I.get("TileView"),className:"tileview",loader:"DS/CollectionView/ResponsiveLargeTilesCollectionView",options:{height:"inherit",displayTitleTooltip:!0,displayedOptionalCellProperties:["description","contextualMenu"],useDragAndDrop:!0},layout:{columnMaxWidth:400}},{fonticon:"view-small-thb",text:I.get("ThumbnailView"),className:"thumbnailview",loader:"DS/CollectionView/ResponsiveThumbnailsCollectionView",options:{height:"inherit",allowUnsafeHTMLContent:!1,displayTitleTooltip:!0,displayedOptionalCellProperties:["description","contextualMenu"],useDragAndDrop:!0},layout:{columnMaxWidth:250}}],taggerServices:null,_currentListNodes:{},_currentFilteredNodes:[],_currentModels:{},_isWebInWin:b.isWebInWin(),_widgetId:"",separator:"",collectionsViews:{},direction:"",scrollerElement:null,previewAccordion:null,_accordionOpenedItem:[],_idsFilteredBySearch:null,className:function(){return this.getClassNames("-container")},setup:function(t){this._compassSocket=new n.Socket("com.ds."+widget.id),this._compassSocket.subscribeServer("com.ds.compass",window.parent),this._widgetId=t.widgetId?t.widgetId:null,this.separator=t.separator?t.separator:null,this.modalPreview=new r({className:"modal-preview",closable:!0,header:"<h4>"+I.get("previewUpAndDownstream")+"</h4>",events:{onHide:function(){this.cleanView(),this._cleanPreviewPanel()}.bind(this)}}).inject(this.container),t.direction&&this.setModalTitle(t.direction);var i=e.createElement("div",{class:"actionButton-container"});this.importInGraphButton=new l({value:I.get("addInGraph"),className:"primary extract",disabled:!0,events:{onClick:function(){this._extractNode()}.bind(this)}}).inject(i);new l({value:I.get("close"),className:"default cancel",events:{onClick:function(){this.modalPreview.hide()}.bind(this)}}).inject(i);this.modalPreview.setFooter(i),this.modalBody=e.createElement("div",{class:"modal-body-container"}),this.alertError=new h({lassName:"error"}).inject(this.modalBody);var s=e.createElement("div",{class:"iconbar-container"}).inject(this.modalBody),o=this._views.filter(function(e){return e.className===S.getPref("typeLayoutView")}.bind(this))[0];this._isWebInWin&&e.createElement("span",{class:"fonticon fonticon-search enoripe-preview-searchcommand",title:I.get("MapSearchView_search")}).inject(s).addEventListener("click",this._handleSearch.bind(this));var a=e.createElement("span",{class:"fonticon fonticon-select-all enoripe-preview-selectcommands",title:I.get("Select-Deselect-Nodes")}).inject(s),u=e.createElement("span",{class:"fonticon fonticon-"+o.fonticon,title:o.text}).inject(s);new d({target:u,className:"count-list-layout-dropdown",items:this._views,events:{onClick:function(e,t){this._currentListNodes&&Object.values(this._currentListNodes).length>0&&(S.setPrefEverywhere("typeLayoutView",t.className),u.set("class",t.elements.icon.className),u.title=t.text,this._showLoading(),this.setPreview(this.sourceId,this._currentListNodes,this.direction,!0))}.bind(this)}}),new d({target:a,className:"count-list-layout-dropdown",items:[{text:I.get("SNNavigationMap.selectAll.Title"),fonticon:"select-all",selectable:!1},{text:I.get("SNNavigationMap.clearSelection.Title"),fonticon:"select-none",selectable:!1}],events:{onClick:function(e,t){"select-all"===t.fonticon?this.selectAllVisibleNodes():this.unselectAll()}.bind(this)}});this.detailsContainer=e.createElement("div",{class:"detailsContainer"}).inject(this.modalBody),this.spinner=(new c).inject(this.modalBody).show(),this.modalPreview.setBody(this.modalBody),this._initTagger()},setPreview:function(t,i,n,s){var o=[];if(this.cleanView(),i&&(this._currentListNodes=i),t&&(this.sourceId=t),n&&(this.setModalTitle(n),this.direction=n),i&&Object.keys(i).length>0){for(var a in this.previewAccordion=new g({className:"preview-accordion",items:[],exclusive:!1}).inject(this.detailsContainer),i=Object.keys(i).sort(function(e,t){return e.localeCompare(t)}).reduce(function(e,t){return e[t]=i[t],e},{})){let t=null,n=0;n=i[a].reduce(function(e,t){if(t.relations&&t.relations.length>0){let i=0;return e+(i="in"===t.relations[0].direction?1:t.relations.length)}return e},0),this.previewAccordion.addItem({title:a+" ("+n+")",name:a}),t=e.createElement("div",{class:"collectionContainer"}).inject(this.previewAccordion.getItem(a).elements.content),this._createCollection(a,i[a],t),o=o.concat(i[a])}this._accordionOpenedItem.forEach(function(e){this.previewAccordion.selectItem(e)}.bind(this))}else{e.createElement("div",{class:"noResult",html:I.get("noResult")}).inject(this.detailsContainer);this._hideLoading()}this.scrollerElement=new p({element:this.detailsContainer}).inject(this.modalBody),s||this._updateFilterProxy([],o)},render:function(e){this.modalPreview.show(),e?this.setModalTitle(e):e="both",this._showLoading(),_.trackUsage("Commands","Preview"),_.trackUsage("PreviewView","Options-"+e)},setModalTitle:function(e){var t="";switch(e){case"in":t=I.get("previewUpstream");break;case"out":t=I.get("previewDownstream");break;default:t=I.get("previewUpAndDownstream")}this.modalPreview.setHeader("<h4>"+t+"</h4>")},_createCollection:function(t,i,n){var r=this,l=null,d=[],c={},h=[],u=[],g=0;if(this.collectionsViews[t]&&this.collectionsViews[t].TreedocModel.getSelectedNodes()){h=this.collectionsViews[t].TreedocModel.getSelectedNodes();for(var p=0;p<h.length;p++)u.push(h[p].getAttributeValue("id"))}if(!i||0===i.length){e.createElement("div",{class:"noResult",html:I.get("noResult")}).inject(this.detailsContainer);return this._hideLoading(),this.alertError.add({message:I.get("noDetails"),className:"error"}),void this.alertError.show()}c=this._views.filter(function(e){return e.className===S.getPref("typeLayoutView")}.bind(this))[0],require([c.loader],function(e){for(var h=0;h<i.length;h++){var p,f=i[h],m=f.type,_=v.getDefaultAttributes(),S=(p=void 0!==_[m]?_[m].attributes:_.AllTypes.attributes).map(function(e){return e.uri}),b=N.getTitleLabel(f,S.slice(0,3)),w=N.getTitleLabel(f,S.slice(3,6));let e;if("Person"===m){var C=f["ds6w:identifier"];C&&(e=N.getUser3DSwymPictureURL(C))}e?f.type_icon_url=e:e=f.preview_url?f.preview_url:a.getWebappsAssetUrl("SNNavigationMap","icons/thumbnailLargeDefault.png");var E={label:b,icons:[f.type_icon_url],subLabel:w,thumbnail:e,contextualMenu:"A",customTooltip:new o({shortHelp:b,longHelp:this._getLongHelp(f,p)}),grid:{id:f.id,type:f.type,element:f}};f.instances&&f.instances.length>0&&f.relations&&f.relations.length>0&&(E.description=f.relations.length+" ",f.relations.length>1?E.description+=I.get("instances"):E.description+=I.get("instance")),d.push(new s(E))}d.sort(function(e,t){return e.getAttributeValue("label").localeCompare(t.getAttributeValue("label"))}),c.options.onDragStartCell=this._onDragStart.bind(this),(l=new e(c.options)).selectionBehavior={unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!0,canInteractiveMultiselectWithCheckboxClick:!0,enableShiftSelection:!0,enableFeedbackForActiveCell:!1},l.layout&&l.layout.columnMaxWidth&&(l.layout.columnMaxWidth=c.layout.columnMaxWidth),l.onSelectionAdd(function(e){r._syncObjectToCompass(),1==r._getSelectedNodes().length&&r.importInGraphButton.enable()}),l.onSelectionRemove(function(e){r._syncObjectToCompass(),0==r._getSelectedNodes().length&&r.importInGraphButton.disable()}),l.updateView({updateCellContent:!0}),l.model=d,this._currentModels[t]=d,r._currentFilteredNodes&&r._currentFilteredNodes.length>0&&l.model.forEach(function(e){r._currentFilteredNodes.includes(e.getAttributeValue("id"))||e.hide()}),r._idsFilteredBySearch&&r._idsFilteredBySearch.length>0&&l.model.forEach(function(e){r._idsFilteredBySearch.includes(e.getAttributeValue("id"))||e.hide()}),this._updateAccordionItems(),u.length>0&&l.model.forEach(function(e){u.indexOf(e.getAttributeValue("id"))>-1&&l.selectNodeModel(e,!0,!1)}.bind(this)),l.onContextualEvent={this:r,callback:function(e){r._handleMenuClick(e),e.data.event.stopPropagation()}},l.getContent().inject(n),this.collectionsViews[t]=l,this._updateNls(i),this._hideLoading(),l.onReady(function(){l.getVisibleCellsInViewport();g=l.getContent().getElement(".wux-layouts-gridengine-poolcontainer-rel").getBoundingClientRect().height,n.setStyle("height",g+5)}.bind(this))}.bind(this))},_updateNls:function(e){var t,i,n=this,s={};e.forEach(function(e){if(!e.nlsObj&&!s[e.id]){var t={_attributes:e};s[e.id]=t}}),t=Object.values(s),i=Object.keys(s);var o=N._prepareDataToNls(t);N._getNlsAndProcessData(o,i,s).then(function(e){n._getCollectionsModels(!0).forEach(function(t){Object.keys(e.nlsObj).indexOf(t.getAttributeValue("id"))>-1&&n.updateAttributes(e.nlsObj[t.getAttributeValue("id")],t)})})},getFilteredIds:function(){if(this._currentFilteredNodes&&this._currentFilteredNodes.length>0)return this._currentFilteredNodes;var e=[];return this._getCollectionsModels(!0).forEach(function(t){-1===e.indexOf(t.getAttributeValue("id"))&&e.push(t.getAttributeValue("id"))}),e},getIdsSorted:function(e){var t=[];return this._getCollectionsModels(!0).forEach(function(i){e.indexOf(i.getAttributeValue("id"))>-1&&t.push(i.getAttributeValue("id"))}),t},filterBySearch:function(e){for(var t in this.collectionsViews)this._currentModels[t]&&(this.collectionsViews[t].model=this._currentModels[t]);this._getCollectionsModels(!0).forEach(function(t){e.includes(t.getAttributeValue("id"))?t.show():t.hide()}),this._updateAccordionItems(),e.length?this._idsFilteredBySearch=e:this._idsFilteredBySearch=[]},clearSearch:function(){var e=this.getFilteredIds();this._getCollectionsModels(!0).forEach(function(t){e.includes(t.getAttributeValue("id"))?t.show():t.hide()}),this._updateAccordionItems(),this._idsFilteredBySearch=null},_handleSearch:function(){var t=this;if(this._searchModule)this._searchModule.container.toggle();else{var i=e.createElement("li",{class:"Enoripe-SearchContainer"}).inject(this.getElement(".iconbar-container"),"top");require(["DS/SNNavigationMap/views/SearchViewForNative"],function(e){t._searchModule=new e({renderTo:i}),t._searchModule.render(),t.listenTo(t._searchModule,"ENORIPE_performSearch_native",function(e){t.dispatchEvent("ENORIPE_performSearch_native",e)}),t.listenTo(t._searchModule,"ENORIPE_resetSearch_native",function(){t.dispatchEvent("ENORIPE_resetSearch_native")})})}},selectNode:function(e){"All"===e?this.selectAllVisibleNodes():this._getCollectionsModels().forEach(function(t){t.options.grid.id===e?t.select():t.unselect()})},selectAllVisibleNodes:function(){for(var e in this.collectionsViews)this.collectionsViews[e].selectAllVisibleNodes()},unselectAll:function(){for(var e in this.collectionsViews)this.collectionsViews[e].unselectAll()},_getSelectedNodes:function(){var e=[];for(var t in this.collectionsViews)e=e.concat(this.collectionsViews[t].TreedocModel.getSelectedNodes());return e},_handleMenuClick:function(e){var t,i=null;e&&e.infos&&e.infos.target?t=e.infos.target:e&&e.data&&e.data.target&&(t=e.data.target),e.cellInfos&&e.cellInfos.cellModel?i=e.cellInfos.cellModel.getAttributeValue("element"):e.context&&e.context.cellInfos&&e.context.cellInfos.cellModel&&(i=e.context.cellInfos.cellModel.getAttributeValue("element"));var n={target:t,items:[],events:{onClick:function(e){e.stopPropagation()},onClickOutside:function(){this.destroy()}}};if(this.dropDownMenu&&(this.dropDownMenu.destroy(),this.dropDownMenu=null),this.dropDownMenu=new d(n),i)if(this._isWebInWin)this.dispatchEvent("ContextualMenuPreviewGroup",{targetId:i.id,targetElement:t}),b.sendToMapWebInWin("onComputeCtxMenu",[i.id]);else{this.dropDownMenu.addItem({text:I.get("Information"),name:"properties",fonticon:"info-open-in-a-new-window",handler:function(){this._manageEditProp([i])}.bind(this)});var s=N.getContentForOpenWith(i.id,i.type,i.relTypesTaxonomies);(new w).set3DXContent(s).render(this.dropDownMenu),0==this.dropDownMenu.items.length&&(this.dropDownMenu.items=[{}]),this.dropDownMenu.show(),i.type&&i.type.contains("Document")&&this.dropDownMenu.addItem({text:I.get("Download"),fonticon:"download",handler:function(){this.dispatchEvent("ENORIPE_DownloadDocument",[i.id,i.name])}.bind(this)})}},_extractNode:function(){var e=[],t=[],i=this._getSelectedNodes();i&&i.length>0&&i.forEach(function(i){e.push(i.getAttributeValue("element")),i.getAttributeValue("element").relations&&(t=[...t,...i.getAttributeValue("element").relations])}),e.length>0&&(this.dispatchEvent("ENORIPE_extractNode",{sourceIds:this.sourceId,objects:e,links:t}),this.modalPreview.hide(),_.trackUsage("Expand","WithPreview"),_.trackUsage("PreviewView","AddInGraph-Commands"),_.trackUsage("PreviewView","AddInGraph-ExtractNumber",e.length))},_onDragStart:function(e,t){var i;if((i=this._getSelectedNodes())&&i.length>0){var n=this._buildCompassData({widgetId:this._widgetId,envId:v.getPlatformId(),selectedModels:i});try{e.dataTransfer.setData("text/searchitems",JSON.stringify(n)),e.dataTransfer.setData("text",JSON.stringify(n))}catch(t){console.log(t),e.dataTransfer.setData("text",JSON.stringify(n))}}return e.stopPropagation(),!1},updateAttributes:function(e,t){var i,n,s,a;a=(s=N.getAttributes(t.getAttributeValue("type")).attributes).map(function(e){return e.uri}),i=N.getTitleLabel(e,a.slice(0,3)),n=N.getTitleLabel(e,a.slice(3,6)),t.setLabel(i),t._options.subLabel=n,t._options.customTooltip=new o({shortHelp:i,longHelp:this._getLongHelp(e,s)}),!t._options.preview_url&&e.preview_url&&(t._options.preview_url=e.preview_url),t.updateOptions()},_updateAccordionItems:function(){for(var e in this.collectionsViews)if(this.previewAccordion){const t=this.previewAccordion.items.find(t=>t.name===e);if(t){let i=this._currentModels[e].filter(e=>!1===e._isHidden);if(i.length>0){let n=i.reduce((t,i)=>{let n=this._currentListNodes[e].find(e=>e.id===i._options.grid.id),s=0;return t+(s="in"===n.relations[0].direction?1:n.relations.length)},0);this.previewAccordion.setTitle(e,'<i class="caret-left"></i>'+e+" ("+n+")"),t.elements.container.show()}else t.elements.container.hide()}}},_initTagger:function(){var e=this;this.taggerServices||(this.taggerServices=new m({widgetId:this._widgetId,addVolatileTags:!1}),this.taggerServices.addEvent("Tagger_FilterBIColorize",function(t){e.onFilterBIColorize(t)}),this.taggerServices.addEvent("Tagger_FilterBIUnColorize",function(t){e.onFilterBIUnColorize(t)}),this.taggerServices.addEvent("Tagger_FilterBIFilteringEvent",function(t){e.onFilterBIFilteringEvent(t)}))},_updateFilterProxy:function(e,t){var i=[],n=[],s=0,o=!1;if(this.taggerServices.activate(),e&&e.length>0&&(Object.keys(e.allfilters).length>0||e.volatileFilters&&Object.keys(e.volatileFilters).length>0)&&(o=!0),o){if(e&&e.matchingIDs)for(s=0;s<e.matchingIDs.length;s++)"_"!==e.matchingIDs[s].slice(-2,-1)&&(i.push(e.matchingIDs[s]),n.push([s]))}else for(s=0;s<t.length;s++)i.push(t[s].id),n.push([s]);this.taggerServices.updateFilterProxy(i)},onFilterBIColorize:function(e){var t=[];this.onFilterBIUnColorize(),e.forEach(function(e){t[e.id]=e.color}),this._getCollectionsModels().forEach(function(e){Object.keys(t).includes(e.getAttributeValue("id"))&&e.updateOptions({color:t[e.getAttributeValue("id")]})})},onFilterBIUnColorize:function(){this._getCollectionsModels().forEach(function(e){e.updateOptions({color:""})})},onFilterBIFilteringEvent:function(e){var t=this;if(this._currentFilteredNodes=e.matchingIDs,t._idsFilteredBySearch)this.dispatchEvent("ENORIPE_LaunchSearch");else{for(var i in this.collectionsViews)this._currentModels[i]&&(this.collectionsViews[i].model=this._currentModels[i]);this._getCollectionsModels().forEach(function(e){t._currentFilteredNodes.includes(e.getAttributeValue("id"))?e.show():e.hide()}),this._updateAccordionItems()}},_manageEditProp:function(e){var t=this._getSelectedNodes();require([this._propertiesCommandRequire],function(e){let i=v.getXPrefCredential();var n={getSecurityContext:function(){return{SecurityContext:i,tenant:v.getPlatformId()||"OnPremise"}},getSelectedNodes:function(){var e=[];return t.forEach(function(t){var i={id:t.getAttributeValue("id"),tenant:v.getPlatformId()||"OnPremise",source:"3DSpace",getID:function(){return t.getAttributeValue("id")},getRelationID:function(){return t.getAttributeValue("id")}};e.push(i)}),e}};(new e).launchProperties(n)}.bind(this))},_syncObjectToCompass:function(){var e=this._getSelectedNodes();if(0===e.length)this.updateSelection(null),C.publish("resetTypes");else{var t={widgetId:this._widgetId};C.publish("setTypes",t)}1===e.length&&this.updateSelection(e[0]);var i=this._buildCompassData({widgetId:this._widgetId,envId:v.getPlatformId(),selectedModels:e});this._compassSocket.dispatchEvent("onSetX3DContent",i),this._publishSelectionEvent(e)},_publishSelectionEvent:function(t){var i={metadata:{uid:e.Utils.getUUID(),originUid:this._selectUuid,timestamp:Date.now(),appid:"/no_private_channel",originWidgetId:this._widgetId,ignoreFromSameWidgetId:!1,origin:"SNNavigationMap"},data:{tenant:this._tenant,version:"1.1"}};"undefined"!=typeof widget&&null!==widget&&(void 0!==widget.getValue("x3dSharedId")?i.metadata.appid="/"+widget.getValue("x3dSharedId"):void 0!==widget.getValue("x3dAppId")?i.metadata.appid="/"+widget.getValue("x3dAppId"):void 0!==widget.getValue("appId")&&(i.metadata.appid="/"+widget.getValue("appId")+"_"+widget.id)),i.data.paths=[];for(var n=0;n<t.length;n++)i.data.paths[n]=[t[n].getAttributeValue("id")];try{require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],function(e){i.data.changeControl=e.get()})}catch(e){console.warn("No Change")}f.publish("DS/PADUtils/PADCommandProxy/select",i)},updateSelection:function(e){if(null===e){var t={objectId:"",envId:v.getPlatformId(),contextId:"",serviceId:this._serviceName||"3DSpace"};return this._compassSocket.dispatchEvent("onSetObject",t),void this._compassSocket.dispatchEvent("onResetX3DContent",{})}var i={objectId:e.getAttributeValue("id"),envId:v.getPlatformId(),contextId:"",serviceId:this._serviceName||"3DSpace"};if(this._compassSocket.dispatchEvent){this._compassSocket.dispatchEvent("onSetObject",i);var n={widgetId:this._widgetId};C.publish("setTypes",n)}},_buildCompassData:function(t){var i=this,n={};if(e.is(t)){var s=t.selectedModels;if(e.is(s,"array")){n={protocol:"3DXContent",version:"1.1",source:"ENORIPE_AP",widgetId:this._widgetId,data:{items:[]}};var o=[];s.forEach(function(e){var n={envId:t.envId,serviceId:i._serviceName,contextId:"",objectId:e.getAttributeValue("id"),objectType:e.getAttributeValue("type"),displayName:e._options.label,displayType:e.getAttributeValue("type")};o.push(n)}),n.data.items=o}}return n},buildSelectionForNativeApps:function(){for(var e,t={version:"2.1",results:[],structures:[{structure:[]}]},i=this._getSelectedNodes(),n=0;n<i.length;n++)e=JSON.stringify(n+1),t.results.push({id:e,phid:i[n].id}),t.structures[0].structure.push({id:e,show:!0,select:!0,children:[]});return JSON.stringify(t)},_showLoading:function(){this.spinner.show()},_hideLoading:function(){this.spinner.hide()},_getLongHelp:function(e,t){var i="",n="";if(e)for(var s=0;s<t.length;s++)if(void 0!==(n=e[t[s].uri])){var o=t[s].label;if(t[s].uri.contains("modified"))if(""!==n)n=new Date(n).toLocaleString(v.getLang());i=i+o+" : "+n+"\n"}return i},_getCollectionsModels:function(e){var t=[];for(var i in this.collectionsViews)t=e?t.concat(this.collectionsViews[i].TreedocModel.getRoots()):t.concat(this.collectionsViews[i].model);return t},_cleanPreviewPanel:function(){if(this._currentFilteredNodes=[],this.previewAccordion=null,this._accordionOpenedItem=[],this.collectionsViews){for(var e in this.collectionsViews)this.collectionsViews[e].destroy(),this.collectionsViews[e]=null;this.collectionsViews={}}this.importInGraphButton.disable(),this.taggerServices.cleanProxy(),this.taggerServices.deactivate(),this.dispatchEvent("PreviewHide")},cleanView:function(){if(this.previewAccordion){var e=this.previewAccordion.getUnselectedItems().map(function(e){return this.previewAccordion.getItem(e.id).name}.bind(this));this._accordionOpenedItem=this._accordionOpenedItem.filter(function(t){return e.indexOf(t)<0}),this.previewAccordion.getSelectedItems().forEach(function(e){this._accordionOpenedItem.indexOf(this.previewAccordion.getItem(e.id).name)<0&&this._accordionOpenedItem.push(this.previewAccordion.getItem(e.id).name)}.bind(this))}this.scrollerElement&&(this.scrollerElement.destroy(),this.scrollerElement=null),this.detailsContainer.destroy(),this.alertError.hide()}})}),define("DS/SNNavigationMap/models/CountOnNode",["UWA/Class/Model","UWA/Class/Collection","DS/SNNavigationMap/models/Count","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/CommonUtils","DS/WAFData/WAFData"],function(e,t,i,n,s,o){"use strict";return e.extend({defaults:{source:"",requestDone:!1,realCounts:null,allCounts:null},setup:function(e){this.set("realCounts",new UWA.Class.Collection([],{model:i})),this.set("allCounts",new UWA.Class.Collection([],{model:i})),this.set("source",e.source)},parse:function(e){e.forEach(function(e){this.get("allCounts").add(this.createCount(e))}.bind(this))},createCount:function(e){return new i(e)},resetRealCount:function(e){this.get("realCounts").reset(),this._buildRealCount(e,"in"),this._buildRealCount(e,"out")},_buildRealCount:function(e,t){var n=[],o=[],a={},r=null;this.getAllCounts(t).forEach(function(l){o=[],"out"===t?n=e.where({modelType:"link",sourceId:l.get("source")}):"in"===t&&(n=e.where({modelType:"link",targetId:l.get("source")})),n.forEach(function(e){s.getMainRelName(e.get("type"))===s.getMainRelName(l.get("name"))&&o.push(e)}),a=l.toJSON();let d=0;o.length>0?(d="in"===t?new Set(o.map(e=>e._attributes.sourceId)).size:o.length,a.count=a.count-d,a.count>0&&(r=new i(a),this.get("realCounts").add(r))):(a.count=parseInt(a.count),r=new i(a),this.get("realCounts").add(r))}.bind(this))},getCountsNumber:function(e){var t=0;return e.forEach(function(e){t+=parseInt(e.get("count"))}),t},isAllExpanded:function(e){return e?0===this.getCountsNumber(this.getRealCounts(e))||0===this.getRealCounts(e).length:this.isAllExpanded("in")&&this.isAllExpanded("out")},isAllCollapsed:function(e){return e?this.getCountsNumber(this.getRealCounts(e))===this.getCountsNumber(this.getAllCounts(e)):this.isAllCollapsed("in")&&this.isAllCollapsed("out")},isRequestDone:function(){return this.get("requestDone")},getExpandedRelations:function(){var e=[];return this.get("allCounts").filter(function(t){if(this.get("realCounts").get(t.id)){let i=this.get("realCounts").get(t.id);t.get("count")>i.get("count")&&e.push({count:t.get("count")-i.get("count"),relations:t.get("name")})}else e.push({count:t.get("count"),relations:t.get("name")})}.bind(this)),e},hasCount:function(e){return e?this.getCountsNumber(this.getAllCounts(e))>0:this.hasCount("in")||this.hasCount("out")},hasRealCount:function(e){return e?this.getCountsNumber(this.getRealCounts(e))>0:this.hasRealCount("in")||this.hasRealCount("out")},setRequestDone:function(e){!0!==e&&!1!==e||this.set("requestDone",e)},getAllCounts:function(e){return e?this.get("allCounts").where({direction:e}):[...this.getAllCounts("in"),...this.getAllCounts("out")]},getRealCounts:function(e){return e?this.get("realCounts").where({direction:e}):[...this.getRealCounts("in"),...this.getRealCounts("out")]},getRealCountAttribute:function(e,t){return this.getRealCounts(t).map(function(t){return t.get(e)})},getAllCountAttribute:function(e,t){return this.getAllCounts(t).map(function(t){return t.get(e)})}})}),define("DS/SNNavigationMap/views/CustomizeRelationsView",["UWA/Core","UWA/Class/View","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","DS/SNNavigationMap/utils/PreferencesUtils","DS/WebappsUtils/WebappsUtils","DS/Notifications/NotificationsManagerUXMessages","DS/UIKIT/Iconbar","DS/UIKIT/Autocomplete","DS/UIKIT/DropdownMenu","DS/UIKIT/SuperModal","DS/UIKIT/Form","DS/UIKIT/Modal","DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/UIKIT/Accordion","DS/UIKIT/Mask","DS/WUXAutoComplete/AutoComplete","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/Button","DS/Controls/TooltipModel","DS/DataGridView/DataGridViewLayout","DS/DataGridView/DataGridView","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a,r,l,d,c,h,u,g,p,f,m,v,_,S,b,N,w,C,I,E,y){"use strict";return t.extend({name:"Customize",_dialog:null,currentRelations:{},displayedRelations:[],datagridViewDisplayedR:null,datagridViewOthersR:null,displayedTree:null,othersRelationsTree:null,togglesHeader:[],accordionsElements:[],RECENTLIMIT:3,MARGINACCORDION:5,className:function(){return this.getClassNames("-container")},setup:function(t){e.clone(t,!1).settings&&(this.currentProfile=t.currentProfile,this.dimensions={},this.dimensions.position={},this.dimensions.position.offsetX=0,this.dimensions.position.offsetY=50,this.dimensions.dialogWidth=400,this.dimensions.dialogHeight=520,this.firstLaunch=!0,this._notifManager=a,this._thumbnails2d=t.thumbnails2d,this._recompute=t.recomputeLayout,this._autoNav=t.autoNav,this._initProfileAutoComplete(t))},render:function(e){null===this._dialog&&this.createDialogContent(),this.getElement("#relations-list")&&(this._relationsList=this.getElement("#relations-list")),this._previousProfile=this._getSelectedProfile(),this.handleProfileChange();this._dialog.getElement(".Customize_SearchCommand");this.loadingRelations()},showRelations:function(e){var t=[];this.currentRelations={...e},Object.keys(this.displayedRelations).forEach(function(i){Object.keys(e).indexOf(i)>-1&&(t[i]=e[i],delete e[i])}.bind(this)),this._refreshRelations(t,this.datagridViewDisplayedR,this.displayedTree),this._refreshRelations(e,this.datagridViewOthersR,this.othersRelationsTree),this._updateDatagridHeader(2),this._updateDatagridHeader(4)},createDialogContent:function(){var t,i,n;n=new e.createElement("div",{class:"customize-content",draggable:"false"}),i=new e.createElement("div",{class:"customize-headercontent",draggable:"false"}).inject(n),t=new e.createElement("div",{class:"customize-bodycontent",draggable:"false"}).inject(n),this._renderHeaderToolbar(i),this._renderBody(t),this._dialog=e.createElement("div",{html:n}).inject(this.container),this._createDropDownMenuToolbar();var s=this.container;this.alert=new g({visible:!0,autoHide:!0,hideDelay:3e3,animate:!0,className:"CustomizeAlert"}).inject(s)},_renderHeaderToolbar:function(e){var t=this;this._autocompleteInput=new l({noResultsMessage:!1,placeholder:y.get("Customize-SearchTextInvite"),events:{onKeyUp:t._onKeyUp.bind(t)}}).inject(e),this._renderProfileAutoComplete().inject(e),this._autocompleteInput.elements.container.addClassName("customize-autocomplete customize-hidden"),this._autocompleteInput.elements.clear.addEventListener("click",this._clearSearch.bind(t));var i=[{className:"divider selectionIcon",name:"divider"},{fonticon:"search",text:y.get("Customize_SearchCommmand"),className:"Customize_SearchCommand",handler:function(e,i){i.elements.container.toggleClassName("pressed"),t._autocompleteInput.elements.container.toggleClassName("customize-hidden"),t.customizeProfileContainer.toggleClassName("customize-hidden"),i.elements.container.hasClassName("pressed")||t._clearSearch()}},{fonticon:"plus",text:y.get("Customize_ModalCreate"),className:"Customize_AddRelationsSetCommand",handler:function(){t._onCreateClick()}},{fonticon:"menu-dot",text:y.get("Customize_RelationSet"),className:"Customize_RelationSet",id:"Customize_RelationSet"}];new r({renderTo:e,className:"customize-toolbar",items:i}).show()},_renderBody:function(t){var i,n=null,s=null;i=new e.createElement("div",{class:"customize-contentHeader",draggable:"false"}).inject(t),(n=new f({className:"customizeRelations-accordion accordionDisplayed",items:[],exclusive:!1})).inject(t),this.accordionsElements.push(n),(s=new f({className:"customizeRelations-accordion accordionOthers",items:[],exclusive:!1})).inject(t),this.accordionsElements.push(s),this._renderDatagridHeader(i),this._renderRelationsDisplayed(n),this._renderOthersRelations(s)},_renderDatagridHeader:function(t){var i=null;i=new e.createElement("div",{class:"customize-DatagridHeader",draggable:"false"}),this.togglesHeader.push(new b({name:"groupTitle",type:"checkbox",label:y.get("SNNavigationMap.CustomizeRelations.TypeTitle"),value:0,checkFlag:!0}));let n=new e.createElement("div",{class:"checkBoxContainer",draggable:"false"}).inject(i);this.togglesHeader[0].inject(n),this.togglesHeader[0].addEventListener("buttonclick",function(e){this.toggleSelectionColumn(this.togglesHeader[0].checkFlag,"titleValue",0),this.togglesHeader[1].checkFlag=this.togglesHeader[0].checkFlag,this.togglesHeader[2].checkFlag=this.togglesHeader[0].checkFlag}.bind(this)),this.togglesHeader.push(new b({type:"checkbox",label:y.get("Upstream"),value:1,checkFlag:!0}));let s=new e.createElement("div",{class:"checkBoxContainer",draggable:"false"}).inject(i);this.togglesHeader[1].inject(s),this.togglesHeader[1].addEventListener("buttonclick",function(e){this.toggleSelectionColumn(this.togglesHeader[1].checkFlag,"upstreamValue",2),this.togglesHeader[2].checkFlag===this.togglesHeader[1].checkFlag?this.togglesHeader[0].checkFlag=this.togglesHeader[1].checkFlag:this.togglesHeader[0].checkFlag=!0}.bind(this)),e.createElement("div",{class:"wux-ui-3ds-help wux-ui-3ds upstreamHelpIcon"}).inject(t).tooltipInfos=new C({shortHelp:y.get("SNNavigationMap.CustomizeRelations.UpstreamDescription")}),this.togglesHeader.push(new b({type:"checkbox",label:y.get("Downstream"),value:2,checkFlag:!0}));let o=new e.createElement("div",{class:"checkBoxContainer",draggable:"false"}).inject(i);this.togglesHeader[2].inject(o),this.togglesHeader[2].addEventListener("buttonclick",function(e){this.toggleSelectionColumn(this.togglesHeader[2].checkFlag,"downstreamValue",3),this.togglesHeader[2].checkFlag===this.togglesHeader[1].checkFlag?this.togglesHeader[0].checkFlag=this.togglesHeader[1].checkFlag:this.togglesHeader[0].checkFlag=!0}.bind(this)),e.createElement("div",{class:"wux-ui-3ds-help wux-ui-3ds downstreamHelpIcon"}).inject(t).tooltipInfos=new C({shortHelp:y.get("SNNavigationMap.CustomizeRelations.DownstreamDescription")}),i.inject(t)},_renderRelationsDisplayed:function(t){var i,n=[];i=new e.createElement("div",{class:"relationsDisplayed-content customizeRelations-content",draggable:"false"}),this.displayedTree=new _,this.datagridViewDisplayedR=this.createDatagrid(this.displayedTree,i),n.push({title:y.get("SNNavigationMap.CustomizeRelations.AlreadyDisplayTitle"),content:i,name:"accordionRelationsDisplayed",selected:!0}),this.datagridViewDisplayedR.container=i,t.addItem(n)},_renderOthersRelations:function(t){var i,n=[];i=new e.createElement("div",{class:"OthersRelations-content customizeRelations-content",draggable:"false"}),this.othersRelationsTree=new _,this.datagridViewOthersR=this.createDatagrid(this.othersRelationsTree,i),n.push({title:y.get("SNNavigationMap.CustomizeRelations.OthersRelationsTitle"),content:i,name:"accordionOthersRelations",selected:!0}),t.addItem(n)},createDatagrid:function(e,t){var i,n,s=null;return i=[{dataIndex:"titleValue",typeRepresentation:"boolean",editableFlag:!0,editionPolicy:"EditionInPlace",getCellSemantics:function(e){return{label:e.nodeModel.getAttributeValue("titleLabel")}},getCellTooltip:function(e){return e.nodeModel?{longHelp:e.nodeModel.getAttributeValue("tooltip")}:s.getCellDefaultTooltip(e)}},{dataIndex:"upstreamType",typeRepresentation:"string",visibleFlag:!1},{dataIndex:"upstreamValue",typeRepresentation:"boolean",editableFlag:!0,editionPolicy:"EditionInPlace",getCellSemantics:function(e){return{label:e.nodeModel.getAttributeValue("upstreamLabel")}}},{dataIndex:"downstreamType",typeRepresentation:"string",visibleFlag:!1},{dataIndex:"downstreamValue",typeRepresentation:"boolean",editableFlag:!0,editionPolicy:"EditionInPlace",getCellSemantics:function(e){return{label:e.nodeModel.getAttributeValue("downstreamLabel")}}}],n=new I({useLastColumnWidthAutoFlag:!0,columnsHeader:!1}),(s=new E({treeDocument:e,columns:i,showRowIndexFlag:!1,showRowHeaderBackgroundFlag:!1,showSelectionCheckBoxesFlag:!1,columnDragEnabledFlag:!1,cellSelection:"none",placeholder:y.get("Customize-NoRelation"),defaultColumnDef:{editableFlag:!1,alignment:"near"},layout:n}).inject(t)).onReady(function(){this.dimensialAdjustment(s)}.bind(this)),s.addEventListener("change",function(e,t){this._onCheckboxClick(s,t.nodeModel,t.columnID,!0)}.bind(this)),s},_refreshRelations:function(e,t,i){var n={},s=null,o={};if(i.empty(),i.prepareUpdate(),e&&Object.keys(e).length>0)for(var a=0;a<Object.keys(e).length;a++)o={titleLabel:e[Object.keys(e)[a]].nlsLabel,tooltip:e[Object.keys(e)[a]].title},Object.values(e)[a].length>0&&Object.values(e)[a].forEach(function(e){let t=this._getDirection(e.id);""!=t&&(o[t+"Value"]=e.value,o[t+"Label"]=e.relationName,o[t+"Type"]=e.id)}.bind(this)),o.titleValue=this._needToCheckTitleValue(o.upstreamValue,o.downstreamValue),n={label:e[Object.keys(e)[a]].nlsLabel,children:[],grid:o},s=new S(n),i.addRoot(s);i.pushUpdate({},!0),this.dimensialAdjustment(t),this.unloadRelations()},_createDropDownMenuToolbar:function(){var e=this,t={target:this.getElement(".Customize_RelationSet").getChildren()[0],closeOnClick:!0,className:"customize-dropdownmenu"};t.items=[{id:"customize-createrelationset",text:y.get("Customize_CreateRelationSet"),title:y.get("Customize_ModalCreate"),className:"customize-item",fonticon:"plus",handler:function(){e._onCreateClick()}},{id:"customize-saverelationset",text:y.get("Customize_SaveRelationSet"),title:y.get("Customize_SaveTooltip"),className:"customize-item",fonticon:"floppy",handler:function(){e._onSaveClick()}},{id:"customize-deleterelationset",text:y.get("Customize_DeleteRelationSet"),title:y.get("Customize_DeleteTooltip"),className:"customize-item",fonticon:"trash",handler:function(){e.showDeleteConfirmationDialog()}}],this.relationSetMenu=new d(t)},_renderProfileAutoComplete:function(){var t=this,i=e.createElement("div",{class:"relationSet_container",minWidth:150});e.createElement("span",{class:"autocomplete-label",html:y.get("RelationSet")}).inject(i),this.customizeProfileContainer=e.createElement("div",{class:"CustomizeProfile_Container item"}),this._profileAutoComplete&&this._profileAutoComplete.removeEventListener("change",this.handleProfileChange);var n=this.profileTreeDocument.search({match:function(e){return e.nodeModel.options.data.name===t.currentProfile}});return this._profileAutoComplete=new v({elementsTree:this.profileTreeDocument,allowFreeInputFlag:!1,placeholder:y.get("Customize-SelectRelationSet"),multiSearchMode:!1,fireOnlyFromUIInteractionFlag:!0,selectedItems:n,touchMode:!0}),this._profileAutoComplete.addEventListener("change",this.handleProfileChange.bind(this)),this._profileAutoComplete.inject(i),i.inject(this.customizeProfileContainer),this.customizeProfileContainer},_initProfileAutoComplete:function(e){for(var t=this._getProfilesForComboBox(e.profileArray,e.recentProfiles),i=e.currentProfile||e.lastUsedProfile,n=-1,s=2,o=0;o<t.length;o++)"AutoModeProfile"===t[o].name&&(s=o),null!==i&&""!==i&&void 0!==i&&(t[o].name===i&&"text"!==t[o].type&&(n=o),this._autoNav="AutoModeProfile"===i);-1===n&&(n=s),this.profileTreeDocument=new _({name:"test"}),this.profileTreeDocument.prepareUpdate();for(var a=0;a<t.length;a++){var r={label:t[a].nls?t[a].nls:t[a].name,data:{name:t[a].name,selectable:!1!==t[a].selectable}};t[a].isRecent?r.icons=[{iconName:"clock"}]:"UserDefined"!==t[a].type&&"custom"!==t[a].type||(r.icons=[{iconName:"user"}]),t[a].type&&(r.data.type=t[a].type),t[a].isRecent&&(r.data.isRecent=!0);var l=new S(r);this.profileTreeDocument.addRoot(l)}this.profileTreeDocument.pushUpdate(),this.currentProfile=t[n].name},_getProfilesForComboBox:function(e,t){var i=[],n=[],s=[];e.map(e=>e.name);t&&(t.sort((e,t)=>e.name>t.name?1:-1),t.forEach(function(e){e.isRecent=!0,n.push(e)})),e.sort((e,t)=>e.nls>t.nls?1:-1);for(var o=0;o<e.length;o++)"UserDefined"===e[o].type?s.push(e[o]):i.push(e[o]);return n.concat(s.concat(i))},_updateToolbar:function(e=!0){if(this._dialog){var t=this._dialog.getElement(".Customize_AddRelationsSetCommand"),i=this._dialog.getElement(".Customize_RelationSet"),n=this.relationSetMenu.getItem("customize-saverelationset").elements.container,s=this._dialog.getElement(".Customize_SearchCommand");e?(s.removeClassName("disabled"),t.removeClassName("disabled"),i.removeClassName("disabled"),this.isCustomProfileSet()?(t.hide(),i.show(),this._isSaveRequired()?n.show():n.hide()):(t.show(),i.hide())):(s.addClassName("disabled"),t.addClassName("disabled"),i.addClassName("disabled"))}},updateRelationsDisplayed:function(e,t){var i=!1;Object.keys(t).length!=Object.keys(this.displayedRelations).length?i=!0:Object.keys(t).forEach(function(e){Object.keys(this.displayedRelations).indexOf(e)<0&&(i=!0)}.bind(this)),i?(this.displayedRelations=t,this.showRelations(e)):this.unloadRelations()},_updateDatagridHeader:function(e){var t,i,n=this,s=0;t=e/2,i=this.togglesHeader[t].checkFlag;let o=this.displayedTree.search({match:function(t){let o=t.nodeModel.getAttributeValue(n.datagridViewDisplayedR.layout.getDataIndexFromColumnIndex(e));if(null!=o&&s++,o===!i)return!0}}),a=this.othersRelationsTree.search({match:function(t){let o=t.nodeModel.getAttributeValue(n.datagridViewDisplayedR.layout.getDataIndexFromColumnIndex(e));if(null!=o&&s++,o===!i)return!0}});this.togglesHeader[t].checkFlag&&o.length+a.length===s?this.togglesHeader[t].checkFlag=!1:o.length+a.length>0&&(this.togglesHeader[t].checkFlag=!0)},loadingRelations:function(){this.accordionsElements.forEach(function(e){e.unselectAll()}),m.mask(this.container.getElementsByClassName("customize-bodycontent")[0])},unloadRelations:function(){this.accordionsElements.forEach(function(e){e.selectAll()}),m.unmask(this.container.getElementsByClassName("customize-bodycontent")[0])},toggleSelectionColumn:function(e,t,i){var n=this;this.othersRelationsTree.prepareUpdate(),this.othersRelationsTree.processDescendants({processNode:function(s){null!=s.nodeModel.getAttributeValue(t)&&s.nodeModel.setAttribute(t,e),n._onCheckboxClick(n.datagridViewOthersR,s.nodeModel,i,!1)}}),this.othersRelationsTree.pushUpdate(),this.displayedTree.prepareUpdate(),this.displayedTree.processDescendants({processNode:function(s){null!=s.nodeModel.getAttributeValue(t)&&s.nodeModel.setAttribute(t,e),n._onCheckboxClick(n.datagridViewDisplayedR,s.nodeModel,i,!1)}}),this.displayedTree.pushUpdate()},showDeleteConfirmationDialog:function(){if(this.modalDelete)this.modalDelete.show();else{this.modalDelete=new u({className:"modal-delete modalWarning",closable:!0,header:"<h4>"+y.get("Customize_DeleteRelationSet")+" - "+y.get("RelationSet")+"</h4>"}).inject(this.container);var t=e.createElement("div",{class:"actionButton-container"});new p({value:y.get("Customize_DeleteRelationSet"),className:"primary delete",events:{onClick:function(){this._onDeleteClick(),this.modalDelete.hide()}.bind(this)}}).inject(t),new p({value:y.get("cancel"),className:"default cancel",events:{onClick:function(){this.modalDelete.hide()}.bind(this)}}).inject(t),this.modalDelete.setFooter(t);var i=e.createElement("div",{class:"modalBody-container"});e.createElement("img",{class:"modalBody-icon",src:o.getWebappsAssetUrl("SNNavigationMap","icons/warning_icon.png")}).inject(i);var n=e.createElement("div",{class:"modalBody-text-container"}).inject(i);e.createElement("span",{class:"modalBody-question",html:y.get("Customize-DeleteQuestion")}).inject(n),e.createElement("span",{class:"modalBody-text",html:y.get("Customize-DeleteText")}).inject(n),this.modalDelete.setBody(i),this.modalDelete.show()}},alertRelationSetSaved:function(e){if(e){var t={msg:'"'+e.name+'" '+y.get("Customize-SuccessfullySaved"),lvl:"success"};this.showNotif(t),this._updateToolbar()}},alertRelationSetDeleted:function(e){if(e){var t={msg:'"'+e+'" '+y.get("Customize-SuccessfullyDeleted"),lvl:"success"};this.showNotif(t),this._updateToolbar()}},showNotif:function(e){var t="",i="";e.title&&(t+=e.title),e.subtitle&&(t+=e.subtitle),e.msg&&(t+=e.msg),e.className&&(i=e.className),this.alert.add({className:e.lvl?i+" "+e.lvl:i+" error",message:t})},_onKeyUp:function(e){this._delayTimer&&clearTimeout(this._delayTimer);var t=this;this._delayTimer=setTimeout(function(){var i;i=(e.srcElement||e.target).value,t._performSearch(i)},500)},_onCreateClick:function(){var t=this,i=null,n=new c({className:"Customize-Relationsetmodal",animate:!0,events:{onHide:function(e){n.destroy()}}}),s={fields:[{type:"text",required:!0,pattern:"^[_ A-Za-z0-9]+$",value:"",placeholder:y.get("Customize_RelationSetCreation"),name:"inputval"}],events:{onSubmit:function(e){var s=!1;if((i=t.profileTreeDocument.getRoots())&&i.length)for(var o=0;o<i.length;o++)if(i[o]&&i[o].options&&i[o].options.data&&i[o].options.data.name===e.inputval&&"text"!==i[o].options.data.type){s=!0;break}s?!0===confirm(y.get("Customize-ExistingRelationSet"))&&(n.modals.current.hide(),t._createRelationSet(e.inputval)):(n.modals.current.hide(),t._createRelationSet(e.inputval))},onInvalid:function(){var e="";e=0===a.value.trim().length?y.get("Customize_EmptyProfileErr"):(e=y.get("Customize_SpecialCharErr")).concat(" !@#$%^&*()+=[]\\';,./{}|\":<>?-"),r.setContent(e)}}},o=new h(s),a=o.elements.container.getElement("input"),r=(e.createElement("p",{class:"CustomizeCreate",html:y.get("Customize_RelationSetTitle")}).inject(a,"before"),e.createElement("div",{class:"Customize-ProfileNameError",html:""}));n.dialog({body:o,title:y.get("Customize_ModalCreate"),buttons:[{className:"primary customize-newrelset-ok",value:y.get("SNNCustomize_Save"),action:function(){o.submit()}},{value:y.get("SNNCustomize_Cancel"),action:function(){n.modals.current.hide()}}]}),n.modals.current.elements.body&&n.modals.current.getBody().addContent(r),a.addEventListener("click",function(e){this.focus()})},_onSaveClick:function(){var e=this._getCheckedRelations(),t={};t.name=this._getSelectedProfile().options.data.name,t.relations=[];for(var i=0;i<e.length;i++)t.relations.push({name:e[i]});n.trackUsage("CustomizeRelations","ModifyCustom"),this.dispatchEvent("CustomizeAllView_SaveNewProfile",[t])},_onDeleteClick:function(){var e=[...this.profileTreeDocument.getRoots()],t=this._getSelectedProfile(),i=null,s=null,o="AutoModeProfile";if(t){t!=this._previousProfile?s=this._previousProfile:(s=this.profileTreeDocument.search({match:function(e){return"AutoModeProfile"===e.nodeModel.options.data.name&&!e.nodeModel.options.data.isRecent}})[0],this.showNotif({lvl:"warning",className:"warningChangeProfile",msg:y.replace(y.get("SNNavigationMap.CustomizeRelations.WarningCustomizeChange"),{profile:t.options.data.name})})),s&&(o=s.options.data.name);for(var a=0;a<e.length;a++)e[a]._options.data.name===t.options.data.name&&"text"!==e[a]._options.data.type&&(e[a]._options.data.isRecent?this.removeRecent(e[a]):this.profileTreeDocument.removeRoot(e[a]));i=t.options.data.name,this._updateProfile(i,s)}if(n.trackUsage("CustomizeRelations","DeleteCustom"),this.dispatchEvent("CustomizeAllView_DeleteProfile",[i,o]),"AutoModeProfile"===o){let e=this._getCheckedRelations();this.dispatchEvent("CustomizeAllView_UpdatePref",[e,o])}this._previousProfile.options.data.name===i&&(this._previousProfile=s)},_onCheckboxClick:function(e,t,i,n){var s="",o="",a="",r=!1,l=[];if(t&&(s=t.getAttributeValue("titleValue"),o=t.getAttributeValue("upstreamValue"),a=t.getAttributeValue("downstreamValue"),n&&l.push(i),"titleValue"===e.layout.getDataIndexFromColumnIndex(i)?(null!=o&&s!=o&&(t.setAttribute("upstreamValue",s),n&&l.indexOf(2)<0&&l.push(2)),null!=a&&s!=a&&(t.setAttribute("downstreamValue",s),n&&l.indexOf(4)<0&&l.push(4))):(r=this._needToCheckTitleValue(o,a))!=s&&(t.setAttribute("titleValue",r),n&&l.indexOf(0)<0&&l.push(0))),n)for(var d=0;d<l.length;d++)this._updateDatagridHeader(l[d]);this._updateToolbar(),this._isGlobalSaveRequired()},_performSearch:function(e){this._clearSearch(),0!==e.length&&(e=e.toLocaleLowerCase(),this._filterDatagrid(e,this.displayedTree),this.dimensialAdjustment(this.datagridViewDisplayedR),this._filterDatagrid(e,this.othersRelationsTree),this.dimensialAdjustment(this.datagridViewOthersR))},_filterDatagrid:function(e,t){t.prepareUpdate(),t.processDescendants({processNode:function(t){let i=t.nodeModel.getAttributeValue("downstreamLabel")?t.nodeModel.getAttributeValue("downstreamLabel").toLocaleLowerCase():"",n=t.nodeModel.getAttributeValue("upstreamLabel")?t.nodeModel.getAttributeValue("upstreamLabel").toLocaleLowerCase():"";e&&t.nodeModel.getLabel().toLocaleLowerCase().indexOf(e)<0&&i.indexOf(e)<0&&n.indexOf(e)<0&&t.nodeModel.hide()}}),t.pushUpdate()},_clearSearch:function(){this._removeFilterDatagrid(this.displayedTree),this.dimensialAdjustment(this.datagridViewDisplayedR),this._removeFilterDatagrid(this.othersRelationsTree),this.dimensialAdjustment(this.datagridViewOthersR)},_removeFilterDatagrid:function(e){e.prepareUpdate(),e.processDescendants({processNode:function(e){e.nodeModel.isHidden()&&e.nodeModel.show()}}),e.pushUpdate()},_getFilteredInputs:function(){},isCustomProfileSet:function(){var e=this._getSelectedProfile(),t=!1;return e&&e.options.data&&e.options.data.type&&"UserDefined"===e.options.data.type&&(t=!0),t},handleProfileChange:function(e,t){var i=this.getElement(".customize-bodycontent");if(t||void 0!==this._getSelectedProfile()){if(t){this.currentProfile=t;this.profileTreeDocument.getRoots()}else this.currentProfile=this._getSelectedProfile().options.data.name;"AutoModeProfile"===this.currentProfile?this._autoNav=!0:this._autoNav=!1,this.dispatchEvent("CustomizeAllView_UpdateRelations",[this.currentProfile]),i&&i.show(),this._updateToolbar();for(var n=0;n<this.togglesHeader.length;n++)this._updateDatagridHeader(2*n);this._isGlobalSaveRequired()}else i&&i.hide(),this._updateToolbar(!1),this.dispatchEvent("CustomizeAllView_UpdateSaveButton",{tabName:"CustomizeRelations",areThereChanges:!1})},setAutoNavMode:function(e){this._autoNav=e},_getProfileModel:function(e){if(this.profileTreeDocument)for(var t=this.profileTreeDocument.getAllDescendants(),i=0;t.length;i++)if(t[i].options.data.name===e)return t[i]},_createNewProfile:function(e){for(var t=!0,i=this.profileTreeDocument.getRoots(),s=null,o=0;o<i.length;o++)i[o].options.data.name===e.name&&"text"!==i[o].options.data.type&&(t=!1);var a=this._getRecentSize();t&&(s=new S({label:e.name,icons:[{iconName:"user"}],data:{type:"UserDefined",name:e.name,selectable:!0}}),this.profileTreeDocument.addRoot(s,a)),n.trackUsage("CustomizeRelations","NewCustom"),this.dispatchEvent("CustomizeAllView_CreateNewProfile",[e]),this._updateProfile(e.name,s)},_getSelectedProfile:function(){var e=this.profileTreeDocument.getSelectedNodes()[0];if(e)return e},addRecent:function(){var e=this._getSelectedProfile(),t=this.getRecents(),i=!1;if(t.length>0)for(var n=t.length-1;n>-1;){if(e.options.data.name===t[n].options.data.name){i=!0;break}n--}i||(t.unshift(new S({label:e.getLabel(),icons:[{iconName:"clock"}],data:{type:e.options.data.type,name:e.options.data.name,selectable:!0,isRecent:!0}})),this.profileTreeDocument.prepareUpdate(),t.length>this.RECENTLIMIT&&(t.splice(this.RECENTLIMIT,1),this.profileTreeDocument.removeRoot(this.RECENTLIMIT-1)),this.profileTreeDocument.addRoot(t[0],0),this.profileTreeDocument.pushUpdate(),this.dispatchEvent("CustomizeAllView_SetRecentRelationSet",[t]))},removeRecent:function(e){var t=[];e._options.data.isRecent&&(this.profileTreeDocument.removeRoot(e),t=this.getRecents(),this.dispatchEvent("CustomizeAllView_SetRecentRelationSet",[t]))},getRecents:function(){for(var e=this.profileTreeDocument.getRoots(),t=[],i=0;i<e.length;i++)e[i]._options.data&&e[i]._options.data.isRecent&&t.push(e[i]);return t},_getRecentSize:function(){for(var e=this.profileTreeDocument.getRoots(),t=0,i=0;i<e.length;i++)e[i]._options.data&&e[i]._options.data.isRecent&&t++;return t},_createRelationSet:function(e){var t=this._getCheckedRelations(),i={};i.name=e,i.relations=[];for(var n=0;n<t.length;n++)i.relations.push({name:t[n]});i.type="UserDefined",this._createNewProfile(i)},_getCheckedRelations:function(){var e=this._getAllRelations(),t=[];return e.forEach(function(e){e.getAttributeValue("upstreamValue")&&t.push(e.getAttributeValue("upstreamType")),e.getAttributeValue("downstreamValue")&&t.push(e.getAttributeValue("downstreamType"))}),t},_getAllRelations:function(){var e=[];e=this.displayedTree.getAllDescendants();let t=this.othersRelationsTree.getAllDescendants();return e=[...e,...t]},_getSavedRelationsForCustomProfile:function(e){for(var t=s.getPref("_ENORIPE_CustomRelationsSet"),i=[],n=[],o=0;o<t.length;o++)if(t[o].name===e){i=t[o].relations;break}for(var a=0;a<i.length;a++)i[a].name&&n.push(i[a].name);return n},_getSavedRelationsForProfile:function(){var e=[];return Object.values(this.currentRelations).forEach(function(t){let i=0;if(t[i])for(;t[i];)!0===t[i].value&&e.push(t[i].id),i++}),e},_getSavedRelationsForCurrentProfile:function(e,t){return e?this._getSavedRelationsForCustomProfile(t):this._getSavedRelationsForProfile()},_getCurrentRelations:function(){var e=[];return Object.values(this.currentRelations).forEach(function(t){let i=0;if(t[i])for(;t[i];)e.push(t[i].id),i++}),e},_needToCheckTitleValue:function(e,t){return void 0===e?t:void 0===t?e:!(!e&&!t)||!(!e&&!t)&&void 0},save:function(){var e=this._getCheckedRelations(),t=!0,i={},o=null,a={upstream:!0,downstream:!0};a=s.getPref("expandedDirection")?s.getPref("expandedDirection"):a,i=this._getCurrentRelations(),e.length===i.length&&e.every((e,t)=>i.includes(e))&&(t=!1),t&&n.trackUsage("CustomizeRelations","RelationsChange"),this.togglesHeader[1].checkFlag?(a.upstream||(a.upstream=!0,s.setPrefLocally("expandedDirection",a)),n.trackUsage("CustomizeRelations","Upstream-Displayed")):(a.upstream&&(a.upstream=!1,s.setPrefLocally("expandedDirection",a)),n.trackUsage("CustomizeRelations","Upstream-Hidden")),this.togglesHeader[2].checkFlag?(a.downstream||(a.downstream=!0,s.setPrefLocally("expandedDirection",a)),n.trackUsage("CustomizeRelations","Downstream-Displayed")):(a.downstream&&(a.downstream=!1,s.setPrefLocally("expandedDirection",a)),n.trackUsage("CustomizeRelations","Downstream-Hidden")),this.addRecent(),this._previousProfile=this._getSelectedProfile(),this.dispatchEvent("CustomizeAllView_UpdatePref",[e,this._previousProfile.options.data.name]),(o=this._dialog.getElement(".Customize_SearchCommand")).hasClassName("pressed")&&(this._autocompleteInput.elements.clear.click(),o.click())},cancel:function(){this._updateProfile(this._previousProfile.options.data.name,this._previousProfile)},_updateProfile:function(e,t){if(t||(t=this.profileTreeDocument.search({match:function(t){return t.nodeModel.options.data.name===e&&!t.nodeModel.options.data.isRecent}})[0]),t&&t!=this._profileAutoComplete.selectedItems)return this.handleProfileChange(null,e),this._profileAutoComplete.selectedItems=t,t},updateProfile:function(e,t){(t=this._updateProfile(e,t))&&(this._previousProfile=t)},isProfileAutoCompleteEmpty:function(){return void 0===this._getSelectedProfile()},_isGlobalSaveRequired:function(){var e=!1,t=!1,i=!0,n=this._getCheckedRelations(),s=this._getSavedRelationsForCurrentProfile();this._previousProfile&&this.currentProfile!=this._previousProfile.options.data.name&&(t=!0),n.length===s.length&&n.every((e,t)=>s.includes(e))&&(i=!1),(t||i)&&(e=!0),this.dispatchEvent("CustomizeAllView_UpdateSaveButton",{tabName:"CustomizeRelations",areThereChanges:e})},_translateRelations:function(e){return this._groupRelations?this._translateAndGroupRelations(e):this._translateAndFlatten(e)},_translateAndGroupRelations:function(e){return e.v6&&(e=e.v6),e},_translateAndFlatten:function(e){for(var t in e)if(e.hasOwnProperty(t))for(var i=0;i<e[t].length;i++);return e},_isSaveRequired:function(){var e=this.isCustomProfileSet(),t=this._getCheckedRelations(),i=this._getSelectedProfile().options.data.name,n=!0;if(e){var s=this._getSavedRelationsForCurrentProfile(e,i);t.length===s.length&&t.every((e,t)=>s.includes(e))&&(n=!1)}return n},_getDirection:function(e){var t=e.split("_"),i="";return"to"===t[t.length-1]?i="downstream":"from"===t[t.length-1]&&(i="upstream"),i},destroyCurrentDialog:function(){this.relationSetMenu.hide(),this._dialog=null,this.hide()},dimensialAdjustment:function(e){var t=e.elements.container.getParent(),i=e.getContent().getElement(".wux-layouts-gridengine-poolcontainer-rel").getBoundingClientRect().height;0!=i&&t.setStyle("height",i+this.MARGINACCORDION)},resizeDatagrid:function(){this.dimensialAdjustment(this.datagridViewDisplayedR),this.dimensialAdjustment(this.datagridViewOthersR)}})}),define("DS/SNNavigationMap/views/elements/Links",["UWA/Class","UWA/Core","DS/Controls/TooltipModel","DS/SNNavigationMap/utils/CommonUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s){"use strict";return e.extend({svgNS:null,init:function(){this.svgNS={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"}},createNode:function(e){var n=t.extendElement(document.createElementNS(this.svgNS.svg,"g")),o=t.extendElement(document.createElementNS(this.svgNS.svg,"title")),a=t.extendElement(document.createElementNS(this.svgNS.svg,"path")),r=t.extendElement(document.createElementNS(this.svgNS.svg,"text")),l=t.extendElement(document.createElementNS(this.svgNS.svg,"textPath")),d=!0===e.source.focus||!0===e.target.focus,c="link col"+e.source.columnID+"-col"+e.target.columnID,h=e.display_name_attributes,u="",g=e.instancelink?e.instanceTargetId:e.target.id;if(a.setAttributes({id:"from_"+e.source.id+"_to_"+g,class:"path-element",fill:"none","marker-end":d?"url(#node-arrow-focus)":"url(#node-arrow)"}),r.setAttributes({class:"labelText","text-anchor":"middle",dy:-5,"font-size":"13px"}),l.setAttributeNS(this.svgNS.xlink,"href","#from_"+e.source.id+"_to_"+g),l.setAttribute("startOffset","50%"),l.setAttribute("class","pathText"),(u=h&&h.length?s[e[h[0]]]||e[h[0]]:s[e.type+"_short"]||s[e.type]||e.type).length>12)var p=u.slice(0,12)+"...";p?l.setContent(p):l.setContent(u),r.setContent(l),o.setContent(u),n.setAttribute("class",d?c+" focus":c),e.instancelink&&(n.addClassName("displaynone"),n.addClassName("duplicate")),n.setAttribute("id",e.id),n.setContent([a,r]);var f=new i({shortHelp:this.getShortHelp(e),longHelp:this.getLongHelp(e),longHelpImageDimension:{x:2e3,y:1e3}});return n.tooltipInfos=f,n},updateLabel:function(e,t){var i=n.getRelationLinkNls(t);e.setContent(i)},getShortHelp:function(e){var t="",i="";return e&&(i=n.getRelationLinkNls(e)),i&&(t=i),t},getLongHelp:function(e){var t="";if(e){var i=n.getMainRelName(e.type),o=s[i+"_short"]||s[i]||s[e.type];o&&(t=o)}return t}})}),define("DS/SNNavigationMap/views/elements/RoundedRect",["UWA/Class","UWA/Core","UWA/Utils/Client","DS/WebappsUtils/WebappsUtils","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/CommonUtils","DS/TransientWidget/TransientWidget","DS/UIKIT/DropdownMenu","UWA/Date","DS/i3DXCompassPlatformServices/OpenWith","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/SNNavigationMap/utils/SNNavigationServices","UWA/Class/Events","DS/Controls/TooltipModel"],function(e,t,i,n,s,o,a,r,l,d,c,h,u,g){"use strict";return e.extend(u,{name:"Rounded-Rect",STRLIMIT:20,NODEWIDTH:170,THUMBNAILHEIGHT:130,PADDINGTOPINSTANCELIST:5,svgNS:null,mainContainer:null,_UncheckedIcon:n.getWebappsAssetUrl("SNNavigationMap","icons/16/MultiSel_Unchecked.png"),_CheckedIcon:n.getWebappsAssetUrl("SNNavigationMap","icons/16/MultiSel_Checked.png"),init:function(e){this._selector=e,this.svgNS={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"}},createNode:function(e){if(e.isGhost)return this.createGhost(e);this.mainContainer=t.extendElement(document.createElementNS(this.svgNS.svg,"g"));var i,n,a,r=t.extendElement(document.createElementNS(this.svgNS.svg,"g")),l=(t.extendElement(document.createElementNS(this.svgNS.svg,"title")),t.extendElement(document.createElementNS(this.svgNS.svg,"rect"))),d=t.extendElement(document.createElementNS(this.svgNS.svg,"foreignObject")),c=null,u=null,g=null,p=null,f=null,m=t.extendElement(document.createElementNS(this.svgNS.svg,"text")),v=null;if(n=(a=!1!==s.getThumbnailsMode()&&!!e.preview_url)?90:25,e.preview_url&&((p=t.extendElement(document.createElementNS(this.svgNS.svg,"image"))).setAttributeNS(this.svgNS.xlink,"href",e.preview_url),p.setAttributes({class:"thumbnail-image",x:10,y:10,height:110,width:150})),e.type_icon_url&&((f=t.extendElement(document.createElementNS(this.svgNS.svg,"image"))).setAttributeNS(this.svgNS.xlink,"href",e.type_icon_url),f.setAttributes({x:a?5:20,y:n,height:16,width:16,class:"map-type-icon"})),l.setAttributes({class:"background",width:this.NODEWIDTH,height:a?this.THUMBNAILHEIGHT:65}),(u=t.extendElement(document.createElementNS(this.svgNS.svg,"rect"))).setAttributes({class:"small-rect",x:5,y:85,height:42,width:160}),(c=t.extendElement(document.createElementNS(this.svgNS.svg,"rect"))).setAttributes({class:"thumbnail-background",x:5,y:5,width:160,height:a?120:55}),a?this.mainContainer.setAttribute("data-height",130):this.mainContainer.setAttribute("data-height",65),d.setAttributes({x:0,y:0,class:"drag-shape-container",width:this.NODEWIDTH,height:a?this.THUMBNAILHEIGHT:65}),g=t.createElement("div",{class:"drag-shape",draggable:"true","data-id":e.id}),d.setContent(g),this.setDragEvents(g,e),this.layoutingOn&&g.setStyle("display","none"),i=this._createMultiSelIcon(e),e.preview_url&&t.extendElement(document.createElementNS(this.svgNS.xhtml,"img")).setAttributes({src:e.preview_url}),m.setAttributes({class:"node-text","data-name":e.name,x:a?25:40,y:n}),this.mainContainer.setAttributes({class:"node"+(e.focus?" focus":"")+(e.preview_url?"":" no-thumbnail"),id:"container-"+e.id,"data-id":e.id}),r.setAttributes({class:"nodeReference",id:"referenceContainer-"+e.id,"data-id":e.id}),e.nlsObj){let t=o.getAttributes(e["ds6w:type"]||"AllTypes");m.setContent(this.wrapText(o.getTitleLabel(e.nlsObj,t.attrs.slice(0,3)),a)),this.updateToolTip(this.mainContainer,e.nlsObj,e.id)}else m.setContent(this.wrapText(e.name,a));return r.setContent([l,c,p,u,f,m,d,i]),this.mainContainer.setContent([r]),v=h.isWebInWin()?"":this._createForeignObject(e,this.mainContainer),this.mainContainer.addContent([v]),this._addInstancesList(this.mainContainer,e),e.nlsObj||this.dispatchEvent("ENORIPE_GetNlsAttrInfo",e.id),this.mainContainer},createGhost:function(e){var i=t.extendElement(document.createElementNS(this.svgNS.svg,"g")),n=t.extendElement(document.createElementNS(this.svgNS.svg,"g")),s=t.extendElement(document.createElementNS(this.svgNS.svg,"text")),o=t.extendElement(document.createElementNS(this.svgNS.svg,"rect")),a=null;return(a=t.extendElement(document.createElementNS(this.svgNS.svg,"image"))).setAttributeNS(this.svgNS.xlink,"href",e.type_icon_url),a.setAttributes({x:25,y:25,height:16,width:16,class:"ghost-icon"}),o.setAttributes({class:"ghostBackground",width:this.NODEWIDTH,height:65}),s.setAttributes({class:"node-text","data-name":e.name,x:50,y:38}),s.setContent(e.name),i.setAttributes({class:"node ghost"+(e.focus?" focus":""),id:"container-"+e.id,"data-id":e.id,"data-height":65}),n.setAttributes({class:"nodeReference",id:"referenceContainer-"+e.id,"data-id":e.id}),n.setContent([o,a,s]),i.setContent([n]),i},createThumbnail:function(e,i){if(e&&i&&!e.getElement(".thumbnail-image")){var n=e.getElement(".thumbnail-background"),s=t.extendElement(document.createElementNS(this.svgNS.svg,"image"));s.setAttributeNS(this.svgNS.xlink,"href",i),s.setAttributes({class:"thumbnail-image",x:10,y:10,height:110,width:150}).inject(n,"after")}},_createInstanceText:function(e,i,n,s){var o,a=this,r=this._trim(i.name),l="instance-text";this._trim(i.name)||(r=c.get("noTitle"),l+=" noTitle"),o=t.createElement("span",{class:l,id:"instance-"+i.id,text:r,events:{click:function(e){e.stopPropagation(),"chrome"===t.Utils.Client.Engine.name&&e&&e.detail&&"true"===e.detail.isCustom||a._toggleInstance(s,this,n.id)}}}),e.appendChild(o),i.nlsObj&&this.updateToolTip(o,i.nlsObj,i.id)},_createForeignObject:function(e,i){var n,o=this,a=t.extendElement(document.createElementNS(this.svgNS.svg,"foreignObject"));return n=!1!==s.getThumbnailsMode()&&!!i.getElement(".thumbnail-image"),a.setAttributes({class:"foreign-object-count-mobile",x:130,y:n?95:35,height:40,width:40}),a.setContent(t.createElement("span",{class:"fonticon-2x fonticon fonticon-chevron-down",events:{click:function(n){"chrome"===t.Utils.Client.Engine.name?"true"===n.detail.isCustom&&(o.dropDownMenu&&o.dropDownMenu.options.target===this?(o.dropDownMenu.destroy(),o.dropDownMenu=null):o._showDropDownContextualMenu(e,i)):o.dropDownMenu&&o.dropDownMenu.options.target===this?(o.dropDownMenu.destroy(),o.dropDownMenu=null):o._showDropDownContextualMenu(e,i)},touchstart:function(t){o.dropDownMenu&&o.dropDownMenu.options.target===this?(o.dropDownMenu.destroy(),o.dropDownMenu=null):o._showDropDownContextualMenu(e,i)}}})),a.addEvent("click",function(e){e.stopPropagation()}),i.addEventListener("contextmenu",function(t){o._showDropDownContextualMenu(e,i)}),a},_createMultiSelIcon:function(e){var i=t.extendElement(document.createElementNS(this.svgNS.svg,"image")),n=!0===e.focus?this._CheckedIcon:this._UncheckedIcon;return i.setAttributeNS(this.svgNS.xlink,"href",n),i.setAttributes({class:"multiSel-mapView-icon","data-id":e.id,"data-checked":e.focus||!1,x:149,y:5,width:16,height:16}),i},_getLongHelp:function(e,t){var i="",n="";if(e)for(var o=0;o<t.length;o++)if(void 0!==(n=e[t[o].uri])){var a=t[o].label;if(t[o].uri.contains("modified"))if(""!==n)n=new Date(n).toLocaleString(s.getLang());i=i+a+" : "+n+"\n"}return i},_showDropDownContextualMenu:function(e,t){var i=this,n=200,s=t.getElement(".foreign-object-count-mobile"),a={target:s.firstChild,renderTo:s,position:"bottom left",events:{onHide:function(){i.dropDownMenu.destroy(),i.dropDownMenu=null,s.setAttributes({height:40,width:40})},onShow:function(){this.items&&this.items.length>0&&(n=45*this.items.length+50),s.setAttributes({height:n||200,width:1e3})}},items:[{text:c.get("previewUpAndDownstream"),fonticon:"eye",handler:function(){i.dispatchEvent("ENORIPE_ShowPreview",{model:e.identifierData})}}]};e.type&&e.type.contains("Document")&&a.items.push({id:e.id,name:e.name,text:c.get("Download"),fonticon:"download",handler:function(t){t.stopPropagation(),i.dispatchEvent("ENORIPE_downloadDocument",[e.id,e.name])}}),this.dropDownMenu&&(this.dropDownMenu.destroy(),this.dropDownMenu=null),this.dropDownMenu=new r(a),this.dropDownMenu.inject(s),this.dropDownMenu.items&&this.dropDownMenu.items.length>0&&(n=45*this.dropDownMenu.items.length+50),s.setAttributes({height:n||200,width:200});var l=o.getContentForOpenWith(e.id,e.type,e.relTypesTaxonomies);(new d).set3DXContent(l,!0).render(this.dropDownMenu);this.dispatchEvent("ENORIPE_movetofront",t),this.dispatchEvent("ENORIPE_movetofront",s),setTimeout(function(){this.dropDownMenu.show()}.bind(this),50)},updateLabel:function(e,t){var i,n=t.ids[0],a=t.attrs.slice(0,3),r=o.getTitleLabel(t.nlsObj[n],a);i=!1!==s.getThumbnailsMode()&&!!e.getElement(".thumbnail-image"),e.getElement(".node-text").setContent(this.wrapText(r,i))},updateToolTip:function(e,t){if(e&&t){let i=o.getAttributes(t["ds6w:type"]||"AllTypes");e.tooltipInfos=new g({shortHelp:o.getTitleLabel(t,i.attrs.slice(0,3)),longHelp:this._getLongHelp(t,i.attributes)})}},updateListInstancesSize:function(e,t){var i=e.getElement("#toggleMoreInstance"),n=e.getElement(".instance-list-g");0!=(t=parseInt(t))&&(t=23*(i?n.getElements(".instance-text").length+1:n.getElements(".instance-text").length)+10),e.getElement(".instance-expander-g").style.transform="translateY("+t+"px)",e.getElement(".foreign-object-instances").setAttribute("height",t),e.getElement(".rect-list-instance").setAttribute("height",t)},toggleListInstances:function(e,t){var i=e.getElement(".instance-list-g");(t=void 0!==t?t:!i.classList.contains("expand"))&&!i.classList.contains("expand")?(i.classList.add("expand"),e.getElement(".foreign-object-expand .fonticon").className="fonticon fonticon-expand-up",this.updateListInstancesSize(e)):!t&&i.classList.contains("expand")&&(i.classList.remove("expand"),e.getElement(".foreign-object-expand .fonticon").className="fonticon fonticon-expand-down",this.updateListInstancesSize(e,0))},removeSelectedInstance:function(e,t){var i=e.getElement(".instance-text.select");if(i){var n=i.id.replace("instance-","");i.classList.remove("select"),this.dispatchEvent("ENORIPE_toggleInstance",{nodeId:t,selected:null,instanceId:n})}},_addInstancesList:function(e,i){if(i.instances){var n,o=this,a=Math.min(i.instances.length,s.getOption("showInstancesLimit")),r=t.extendElement(document.createElementNS(this.svgNS.svg,"g"));r.setAttribute("class","instance-expander-g"),r.addEvent("click",function(t){t.stopPropagation(),t.detail&&!t.detail.isCustom&&(this.dispatchEvent("ENORIPE_clickListInstance",[t.currentTarget.parentNode.getAttribute("data-id")]),this.toggleListInstances(e))}.bind(this)),r.tooltipInfos=new g({shortHelp:c.get("expander-help")});var l=t.extendElement(document.createElementNS(this.svgNS.svg,"rect"));n=!1!==s.getThumbnailsMode()&&!!i.preview_url,l.setAttributes({width:45,height:15,class:"rect-bkg-instance",y:n?130:65,x:65}),l.inject(r);var d=t.extendElement(document.createElementNS(this.svgNS.svg,"foreignObject"));d.inject(r),d.setAttributes({class:"foreign-object-expand",x:80,y:n?129:64,height:40,width:40}),d.setContent(t.createElement("span",{class:"fonticon-1x fonticon fonticon-expand-down "}));var h,u=t.extendElement(document.createElementNS(this.svgNS.svg,"g"));u.setAttributes({class:"instance-list-g"}),(h=t.extendElement(document.createElementNS(this.svgNS.svg,"rect"))).setAttributes({class:"rect-list-instance",y:n?this.THUMBNAILHEIGHT:68,width:o.NODEWIDTH,height:0}),h.inject(u);var p=t.extendElement(document.createElementNS(this.svgNS.svg,"foreignObject"));p.inject(u),p.setAttributes({class:"foreign-object-instances",y:n?this.THUMBNAILHEIGHT+this.PADDINGTOPINSTANCELIST:68+this.PADDINGTOPINSTANCELIST,x:-2,height:0,width:o.NODEWIDTH});for(var f=0;f<a;f++)this._createInstanceText(p,i.instances[f],i,u);i.instances.length-a>0&&p.appendChild(t.createElement("span",{class:"toggle-more-instance",id:"toggleMoreInstance",text:"+"+(i.instances.length-a),events:{click:function(n){if(n.stopPropagation(),"chrome"!==t.Utils.Client.Engine.name||!n||!n.detail||"true"!==n.detail.isCustom){for(var s=p.getElements(".instance-text").length;s<i.instances.length;s++)o._createInstanceText(p,i.instances[s],i,u);this.remove(),o.updateListInstancesSize(e)}}}})),r.inject(e),u.inject(e),this.toggleListInstances(e,s.getInstancesMode())}},updateInstancesList:function(e,t){var i=e.getElements(".instance-list-g")[0],n=[],s=!1;if(i){if((n=i.getElements(".instance-text")).length<t.instances.length)for(var o=i.getElements(".foreign-object-instances")[0],a=0;a<t.instances.length;a++)0===i.getElements("#instance-"+t.instances[a].id).length&&(this._createInstanceText(o,t.instances[a],t,i),s=!0);else{if(t.instances&&t.instances.length>0)for(a=0;a<n.length;a++){let e=n[a].id.replace("instance-","");t.instances.map(e=>e.id).includes(e)||(n[a].remove(),s=!0)}0!==(n=i.getElements(".instance-text")).length&&t.instances&&0!==t.instances.length||(i.remove(),e.getElement(".instance-expander-g").remove(),i=null)}i&&i.classList.contains("expand")&&s&&this.updateListInstancesSize(e)}else this._addInstancesList(e,t)},_toggleInstance:function(e,t,i){var n=!0,s=t.id.replace("instance-",""),o=e.getElement(".instance-text.select");o&&o!=t&&o.classList.remove("select"),t.classList.contains("select")?(n=!1,t.classList.remove("select")):t.classList.add("select"),this.dispatchEvent("ENORIPE_toggleInstance",{nodeId:i,selected:n,instanceId:s})},_trim:function(e){if(e)return e.length>this.STRLIMIT?e.slice(0,this.STRLIMIT)+"...":e},wrapText:function(e,i){for(var n,s=[],o=[],a=0,r=0,l=22,d=0,c=0;d<e.length;)0!==c&&1!==c||(d=r+22,a=this._widthOfText(e.substring(r,d)),0===c&&(a+=7),a>=34?l=10:a>22?(l=22-22/a*(a-22),l=Math.floor(l)):l=22),d=r+l,s.push(e.substring(r,d)),r=d,c++;s.length>2&&(s[1]=s[1].substring(0,s[1].length-3)+"...");for(var h=0;h<s.length&&(n=t.extendElement(document.createElementNS(this.svgNS.svg,"tspan")),0===h?n.setAttributes({x:i?26:40,dy:10*(h+1)}):n.setAttributes({x:10,dy:10*(h+1)}),n.setContent(s[h]),o.push(n),1!==h);h++);return o},_widthOfText:function(e){for(var t=0,i=["$","_","<",">","+","~","&"],n="",s=0;s<e.length;s++)"%"===(n=e.charAt(s))||"@"===n?t+=2.2:"#"===n||"$"===n||"?"===n?t+=1.2:n===n.toUpperCase()&&n!==n.toLowerCase()?t+=1.5:-1!==i.indexOf(n)?t+=1.3:t++;return Math.ceil(t)},setDragEvents:function(e,t){var i=this;e.addEventListener("mousedown",function(e){e.stopPropagation()}),e.addEventListener("dragstart",function(e){e.stopPropagation();var n={protocol:"3DXContent",version:"1.0",source:"ENORIPE_AP",data:{items:i.getSelectedItems({serviceId:"3DSpace",objectId:t.id,objectType:t.type,displayName:t.name})}};i.dispatchEvent("ENORIPE_dragElement",[e,n])})},getFeedbackReorder:function(e){var i;return this._reorderFeedback||(this._reorderFeedback=t.extendElement(document.createElementNS(this.svgNS.svg,"rect"))),i="top"===e?-10:"thumbnailsMode"===s.getThumbnailsMode()?this.THUMBNAILHEIGHT:65,this._reorderFeedback.setAttributes({y:i,id:"reorder-feedback",width:"170px",height:"10px"}),this._reorderFeedback},getSelectedItems:function(e){var t=[],i=!1,n=s.getCurrentTenantName()||"OnPremise";return this._selector.getSelectedItemsForDragAndDrop().forEach(function(s){s.get("id")===e.objectId&&(i=!0),t.push({envId:n,serviceId:"3DSpace",objectId:s.get("id"),objectType:s.get("type"),displayName:s.get("name")})}),!1===i&&(e.envId=n,t.push(e)),t},showColor:function(e,i){var n,s=null;if(n=e.hasClassName("no-thumbnail"),e){var o=e.getElements(".small-rect")[1]||e.getElement(".drag-shape-container");o?((s=t.extendElement(document.createElementNS(this.svgNS.svg,"rect"))).setAttributes({class:"colored-rect-bi",fill:i,x:5,y:5,width:5,height:n?55:120}).inject(o,"after"),n&&(s.style.height=55)):(o=e.closest(".instance-list-g"))&&t.extendElement(document.createElementNS(this.svgNS.svg,"rect")).setAttributes({class:"colored-rect-instance",fill:i,x:5,y:135,width:5,height:25}).inject(o)}}})}),define("DS/SNNavigationMap/collections/NavigationCollection",["UWA/Core","UWA/Class/Collection","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/models/CountOnNode","DS/WAFData/WAFData","DS/WebappsUtils/WebappsUtils","UWA/Promise","DS/PlatformAPI/PlatformAPI","DS/SNNavigationMap/utils/CommonUtils","DS/SNNavigationMap/utils/ProbesUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a,r,l,d,c){"use strict";return t.extend({updateColumnId:!1,instancesMatch:{},currentModelId:0,_noLinkedNodesIds:[],_requests:[],setup:function(e,t){this.add(e),this._layoutUtils=t.layoutUtils,this._widgetId=t.widgetId||null,this._savedColumns=t.savedColumns||{},this._debug=t.debugMode||!1},parse:function(e){var t,s=[],a=this,r=[],h={},u=0;try{e=JSON.parse(e)}catch(e){}return e.objectsAndLinksBySteps||(e.objectsAndLinksBySteps=[e]),e.unindexedObjects&&e.unindexedObjects.length>0&&this.dispatchEvent("ENORIPE_someObjectsNotIndex",e.unindexedObjects.length),e.objectsAndLinksBySteps.forEach(function(e){e.objects.forEach(function(e){if(!a.get(e.id)&&s.map(e=>e.id).indexOf(e.id)<0){var d=a._savedColumns||{};if(e.modelType="node",e.level=u,s.push(e),t=void 0,"Person"===e.type){var g=e["ds6w:identifier"];g&&(t=l.getUser3DSwymPictureURL(g))}t&&(e.preview_url=t,e.type_icon_url=t),e.isGhost&&(e.name=c.get("GhostName"),e["ds6w:label"]=c.get("GhostName"),e.type_icon_url=o.getWebappsAssetUrl("SNNavigationMap","icons/ghost_icon.png")),0===a.length&&(e.columnID=d[e.id]||0,a._savedColumns[e.id]=e.columnID),e.counts=new n({source:e.id}),r=e.instances?e.instances:[],e.identifierData={},i.getOption("attributesForItems").forEach(function(t){e[t]&&(e.identifierData[t]=e[t])}),h=e}else e.instances&&((h=a.get(e.id)?a.get(e.id)._attributes:s[s.map(e=>e.id).indexOf(e.id)]).instances&&h.instances.length>0?(r=e.instances.filter(({id:e})=>!h.instances.some(({id:t})=>t===e)),h.instances=[...h.instances,...r]):(r=e.instances,h.instances=e.instances),h.instancesNeedUpdate=!0,s.push(h));if(r&&r.length>0){h=a.setIdentifierDataInstance(r,h);for(var p=0;p<r.length;p++)a.instancesMatch[r[p].id]=h.id;h.counts&&h.counts.setRequestDone(!1)}}),e.links.forEach(function(e){var t=[];if(null!=e.uniqueId&&(t=a.where({uniqueId:e.uniqueId})),0===t.length&&!e.isReflexive){let t=!1;(t=s.some(function(t){return null!=t.uniqueId&&t.uniqueId===e.uniqueId}))||(e.modelType="link","in"===e.direction&&(e=l.switchRelationsDirection(e)),s.push(e))}})}),d.setProbesAfterParsing(s,this),u++,s},setColumnIds:function(e){this._savedColumns=e},fullImport:function(e){var t=this,n={widgetIdTo:i.getWidgetId(),timeout:i.getTimeout(),label:i.getLabelAPI()};e&&(n.widgetIdFrom=e),d.setStartTime("fullImport"),this.fetch({url:i.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/fullImport?tenant="+i.getCurrentTenantName(),data:JSON.stringify(n),remove:!1,timeout:i.getTimeout(),onComplete:function(e,i){i=JSON.parse(i),t._prepareNodesAndLinks(e)}})},getFocusedNode:function(){return 1===this.length?this._models[0]:this.findWhere({focus:!0})},getEcoSystem:function(e){this.currentModelId=e.id,this._isBusy();var t={widgetId:e.widgetId?e.widgetId:i.getWidgetId(),label:i.getLabelAPI(),lang:i.getLang(),trueREST:!1,direction:"both",restrictedMode:!!e.restrictedMode&&e.restrictedMode,responseMode:e.responseMode?e.responseMode:"ObjectsAndLinks"};return e.ids&&(t.ids=e.ids),e.items&&(t.items=e.items),!e.direction||"in"!==e.direction&&"out"!==e.direction||(t.direction=e.direction),e.relations&&e.relations.length>0&&(t.relations=e.relations),e.trueREST&&!0===e.trueREST&&(trueREST=!0,t.relations=["use-auto-by-type-relations"],t.widgetId=i.getUniqueId(),i.getOption("LastUsedProfile")&&"AutoModeProfile"!==!i.getOption("LastUsedProfile")||(t.relations=i.getOption("currentRelations"))),d.setStartTime("getecosystem",Date.now()),t.items&&i.setOption("ecosystemNoOfObjects",t.items.length),new a(function(n){this.fetch({url:i.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/getEcosystem?tenant="+i.getCurrentTenantName(),data:JSON.stringify(t),remove:!1,timeout:i.getTimeout(),onComplete:function(){this._prepareNodesAndLinks(this),n()}.bind(this),onFailure:function(t){console.log(t),that.dispatchEvent("ENORIPE_handleErrorMsgs",[e]),reject(t)},onTimeout:function(e){console.log(e),reject(e)}})}.bind(this))},getNotSelectedNodes:function(){return this.filter(function(e){return"node"===e.get("modelType")&&!0!==e.get("focus")})},removeNodes:function(e){var t=this,i=[];return new a(function(n){(i=this.getRemovedObject(e))&&(i.removedObjectsId.forEach(function(e){this.remove(e)}.bind(this)),Object.keys(i.removedInstances).forEach(function(e){if(this.get(e)){let t=this.get(e).get("instances").filter(t=>!i.removedInstances[e].includes(t.id)),n=this.get(e).get("identifierData");n.instances=t,this.get(e).set("identifierData",n),this.get(e).set("instances",t),this.get(e).set("instancesNeedUpdate",!0),0===t.length&&this.get(e).unset("instancesExpanded")}}.bind(this)),t._setColumnBasedOnLayout(),n())}.bind(this))},getRemovedObject:function(e){for(var t=this,i={},n=[],s=[],o=[],a=[],r=[],l=0;l<e.length;l++){for(var d=this.filter(function(n){if("link"===n.get("modelType")){if(n.get("source")===e[l]._attributes&&n.get("instanceTargetId")&&n.get("target").instances&&n.get("target").instances.map(e=>e.id).includes(n.get("instanceTargetId"))){let e=t.getAllModelLinks(n.get("target"),n.get("instanceTargetId")),s=t.where({modelType:"link",sourceId:n.get("source").id,instanceTargetId:n.get("instanceTargetId")});e.length===s.length&&(i[n.get("target").id]?i[n.get("target").id].push(n.get("instanceTargetId")):i[n.get("target").id]=[n.get("instanceTargetId")])}return n.get("target")===e[l]._attributes||n.get("source")===e[l]._attributes}return!1}),c=0;c<d.length;c++)-1===s.indexOf(d[c].id)&&s.push(d[c].id);o=o.concat(d),n.push(e[l].id),e[l]&&e[l]._attributes&&e[l]._attributes.instances&&e[l]._attributes.instances.forEach(function(e){-1===n.indexOf(e.id)&&n.push(e.id)})}return a=(a=a.concat(e)).concat(o),{removedObjectsId:r=(r=r.concat(n)).concat(s),removedNodesId:n,removedLinksId:s,removedObjects:a,removedInstances:i}},_isBusy:function(){var e=!1,t=[];return this._requests.forEach(function(i){4!==i.xhr.readyState&&(e=!0,t.push(i))}),this._requests=t,e},_prepareNodesAndLinks:function(t){this.trackServices();var i=t.filter(function(t){var i=t._attributes;return"link"===i.modelType&&(e.is(i.source,"string")||e.is(i.target,"string"))});t.where({modelType:"node"});i.forEach(function(e){(t.get(e.get("source"))?e.set("source",t.get(e.get("source"))._attributes):t.instancesMatch[e.get("source")]&&e.set("source",t.get(t.instancesMatch[e.get("source")])._attributes),e.set("sourceId",e.get("source").id),t.get(e.get("target"))?e.set("target",t.get(e.get("target"))._attributes):t.instancesMatch[e.get("target")]&&(e._attributes.target.id?e.set("instanceTargetId",e._attributes.target.id):e.set("instanceTargetId",e._attributes.target),e.set("target",t.get(t.instancesMatch[e.get("target")])._attributes)),e.set("targetId",e.get("target").id),!0!==e.get("instancelink"))&&t.where({source:e.get("source"),target:e.get("target"),"ro.xcadbasedependency.v_cadlinktype":e.get("ro.xcadbasedependency.v_cadlinktype")}).forEach(function(t){t.id!==e.id&&t.get("type")===e.get("type")&&t.set("instancelink",!0)})}),t._setColumnOnNodes(),t.dispatchEvent("ENORIPE_updateProxy")},_setRowBasedOnLayout:function(){var e,t={},i=null;t=this.groupBy("columnID"),e=Object.keys(t).sort(function(e,t){return e-t});for(var n=0;n<e.length;n++){i=t[e[n]].sort(this._sortRow.bind(this));for(var s=0;s<i.length;s++)void 0===i[s].get("rowID")&&i[s].set("rowID",s)}},_setColumnBasedOnLayout:function(e){this._layoutUtils._dagre.layout(this._layoutUtils._graphObject);for(var t,i={},n=null,s=null,o=this._layoutUtils._graphObject.nodes(),a=0;a<o.length;a++)(n=this.get(o[a]))&&(n.set("xColumn",this._layoutUtils._graphObject.node(o[a]).x),n.set("yColumn",this._layoutUtils._graphObject.node(o[a]).y));for(delete(i=this.groupBy("xColumn"))[void 0],t=Object.keys(i).sort(function(e,t){return e-t}),a=0;a<t.length;a++){s=i[t[a]].sort(function(e,t){return e.get("yColumn")-t.get("yColumn")});for(var r=0;r<s.length;r++)s[r].set("columnID",a),this._savedColumns[s[r].id]=a,e&&s[r].set("rowID",r)}},_setColumnOnNodes:function(){this._layoutUtils.setData(this.getLinksAndNodes()),"recompute"!==i.getLayoutMode()&&!0!==this.updateColumnId||(this._setColumnBasedOnLayout("recompute"===i.getLayoutMode()),this.updateColumnId=!1);for(var t=this.groupBy("level"),n=0;n<Object.keys(t).length;n++)if(!isNaN(parseInt(Object.keys(t)[n]))){var s=this,o=t[Object.keys(t)[n]].filter(function(e){return"node"===e.get("modelType")&&void 0===e.get("columnID")}),a=0,r=[],l=[],d=0,c=[],h=[],u=(e.is(this._savedColumns,"string")?JSON.parse(this._savedColumns):this._savedColumns)||{};for(var g in u)s.get(g)&&this.isLinked(s.get(g)._attributes)>0&&this._noLinkedNodesIds.indexOf(g)>-1&&(this._noLinkedNodesIds.splice(this._noLinkedNodesIds.indexOf(g),1),o.unshift(s.get(g)));for(var p=0;p<o.length;p++){if(r=s.where({target:o[p]._attributes}),l=s.where({source:o[p]._attributes}),d=r.length+l.length,r.length){for(var f=0;f<r.length;f++)Number.isInteger(r[f].get("source").columnID)&&(((a=this._noLinkedNodesIds.indexOf(r[f].get("source").id))<0||1===d)&&(void 0!==s.get(r[f].get("source").id)?c.push(s.get(r[f].get("source").id)):void 0!==s.get(r[f].get("source"))&&c.push(s.get(r[f].get("source")))),a>-1&&this._noLinkedNodesIds.splice(a,1));c.length>0&&o[p].set("columnID",Math.max.apply(Math,c.map(function(e){return e.get("columnID")}))+1)}if(l.length){for(n=0;n<l.length;n++)Number.isInteger(l[n].get("target").columnID)&&(((a=this._noLinkedNodesIds.indexOf(l[n].get("target").id))<0||1===d)&&(void 0!==s.get(l[n].get("target").id)?h.push(s.get(l[n].get("target").id)):void 0!==s.get(l[n].get("target"))&&c.push(s.get(l[n].get("target")))),a>-1&&this._noLinkedNodesIds.splice(a,1));h.length>0&&o[p].set("columnID",Math.min.apply(Math,h.map(function(e){return e.get("columnID")}))-1)}o[p].get("columnID")||o[p].set("columnID",0),u[o[p].get("id")]=o[p].get("columnID"),r=[],l=[],c=[],h=[],delete o[p]._attributes.level}var m=Object.keys(u).length>0?Math.min.apply(Math,Object.values(u)):0;for(var v in u){for(;Object.values(u).indexOf(u[v]-1)<0&&u[v]!=m;)Object.keys(u).filter(function(e){s.get(e)&&s.get(e).get("columnID")>=u[v]&&(u[e]--,s.get(e).set("columnID",u[e]))});if(s.get(v)){let e=this._noLinkedNodesIds.indexOf(v);0===this.isLinked(s.get(v)._attributes)&&e<0&&this._noLinkedNodesIds.push(v)}}this._savedColumns=u,"recompute"!=i.getLayoutMode()&&this._setRowBasedOnLayout(),this.dispatchEvent("ENORIPE_setSavedColumnIds",["ENORIPE_savedColumnIds",u])}},filterOrphanNodes:function(e){var t=this.filter(function(e){return"node"===e.get("modelType")}),n=[],s=[],o=[],a=[];o=i.getRootIds();for(var r=0;r<t.length;r++)n=this.where({target:t[r]._attributes}),s=this.where({source:t[r]._attributes}),0===n.length&&0===s.length&&(o&&o.indexOf(t[r].id)<0||e)&&(this.remove(t[r],{silent:!0}),a.push(t[r].id));return a},reset:function(e){if(this._savedColumns={},e)for(var t=0;t<e.length;t++)e[t].id&&e[t].columnID>-1&&(this._savedColumns[e[t].id]=e[t].columnID);return this._noLinkedNodesIds=[],this._parent(e)},remove:function(e){return e.id||(e=this.get(e)),e&&(Object.keys(this._savedColumns).indexOf(e.id)>-1&&delete this._savedColumns[e.id],this._noLinkedNodesIds.indexOf(e.id)>0&&this._noLinkedNodesIds.splice(this._noLinkedNodesIds.indexOf(e.id),1)),this._parent(e)},sync:function(t,n,o){var a=this;this._debug&&(e.is(o.data,"string")&&(o.data=JSON.parse(o.data)),o.data.debug=!0,o.data=JSON.stringify(o.data));try{switch(t){case"read":var r=s.authenticatedRequest(o.url,{headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:i.getXPrefCredential()},method:"POST",data:o.data,timeout:o.timeout,onComplete:o.onComplete,onFailure:function(e){console.log(e);var t={type:"generic"};a.dispatchEvent("ENORIPE_handleErrorMsgs",[t]),a.resetServiceTracker()},onTimeout:function(e){console.log(e);var t={type:"timeout"};a.dispatchEvent("ENORIPE_handleErrorMsgs",[t]),a.resetServiceTracker()}});break;case"create":break;case"update":case"patch":case"delete":break;default:throw new Error('Unsupported method "{0}"'.format(t))}this._requests.push(r)}catch(e){e.message}return{cancel:function(){}}},isLinked:function(e,t){var i=0,n=this.getAllModelLinks(e)||[];return 0!=n.length&&t?n.forEach(function(e){e.get("instanceTargetId")===t&&i++}):i=n.length,i},getModelsAttrs:function(e){if(e)return this.where({modelType:e}).invoke("toJSON");this.toJSON()},getLinksAndNodes:function(){var e=[],t=[];return this.filter(function(i){"node"===i.get("modelType")?e.push(i._attributes):"link"===i.get("modelType")&&t.push(i._attributes)}),{nodes:e,links:t}},getIdentifierDataById:function(e){var t=[],i={};if((t=e?this.filter(function(t){return"node"===t.get("modelType")&&e.indexOf(t.get("id"))>-1}):this.where({modelType:"node"})).length>0)for(var n=0;n<t.length;n++)i[t[n].id]=t[n].get("identifierData");return i},getNodesIds:function(){return this.getLinksAndNodes().nodes.map(function(e){return e.id})},getLinksIds:function(){return this.getLinksAndNodes().links.map(function(e){return e.id})},setIdentifierDataInstance:function(e,t){for(var n=0;e&&n<e.length;n++){let s={};i.getOption("attributesForItems").forEach(function(t){e[n][t]&&(s[t]=e[n][t])}),t.identifierData.instances||(t.identifierData.instances=[]),t.identifierData.instances.push(s)}return t},setNlsObj:function(e,t,i){let n;var s=this.get(e);return s&&t&&(s.set("nlsObj",t),n=t),i&&this.every(function(i){if("node"===i.get("modelType")&&i.get("instances")&&i.get("instances").length>0){let s=i.get("instances").find(t=>t.id===e);if(s)return s.nlsObj=t,n=t,!1}return!0}),n},trackServices:function(){d.getStartTime("getecosystem")&&d.trackPerformance("getecosystem","getecosystem",{NumberOfObjects:i.getOption("ecosystemNoOfObjects")}),d.getStartTime("fullImport")&&d.trackPerformance("fullImport","fullImport",{NumberOfObjects:i.getOption("fullImportNoOfObjects")})},resetServiceTracker:function(){d.stopTime("getecosystem")},_sortRow:function(e,t){var i=0;if("node"===e.get("modelType")&&"node"===t.get("modelType")){if(null!=e.get("rowID"))return-1;if(null!=t.get("rowID"))return 1;if(0===(i=this._groupByLinkType(e,t))){let i=l.getAttributes(e.get("type")).attrs.slice(0,3),n=l.getTitleLabel(e._attributes,i),s=l.getTitleLabel(t._attributes,i);return n.localeCompare(s)}}return i},_groupByLinkType:function(e,t){var i=this.getAllModelLinks(e),n=this.getAllModelLinks(t);if(i.length>0&&n.length>0){let e=l.getRelationLinkNls(i[0]._attributes),t=l.getRelationLinkNls(n[0]._attributes);return e.localeCompare(t)}return-1},addModel:function(e,t){this.add(e),t&&t.external&&!t.silent&&(this._prepareNodesAndLinks(this),t.callback&&"function"==typeof t.callback&&t.callback(this))},getAllModelLinks:function(e,t){var i,n,s=[],o={},a={};return o={modelType:"link",sourceId:e.id},a={modelType:"link",targetId:e.id},t&&(o.instanceTargetId=t,a.instanceTargetId=t),i=this.where(o),n=this.where(a),(s=[...i,...n]).sort(function(e,t){let i=l.getRelationLinkNls(e._attributes),n=l.getRelationLinkNls(t._attributes);return i.localeCompare(n)}),s}})}),define("DS/SNNavigationMap/views/ToolBarView",["UWA/Core","UWA/Class/View","UWA/Utils/Client","DS/Controls/ComboBox","DS/UIKIT/Iconbar","DS/UIKIT/DropdownMenu","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/SNNavigationMap/views/SNMapSelector","DS/UIKIT/Tooltip"],function(e,t,i,n,s,o,a,r,l,d,c){"use strict";return t.extend({name:"ToolBar",toolbar:null,optionsDropdownMenu:null,leftIconBar:null,rightIconBar:null,renderTo:null,_addinMode:!1,_isWebInWin:!1,_excludedCommands:[],className:function(){return this.getClassNames("-container")},setup:function(t){this.toolBar=new e.createElement("ul",{class:"map-toolbar",draggable:"false"}),this.renderTo=t.renderTo,this._addinMode=t.addinMode,this._isWebInWin=t.isWebInWin,this._excludedCommands=t.excludedCommands||[]},render:function(){var t=this,n=[{fonticon:"flow-tree-expand-down-cog",text:l.get("SNNavigationMap.ExpandCollapse.Title"),className:"ExpandCollapse_Command selectionIcon",id:"ExpandCollapse_Command",content:{type:"dropdownmenu",closeOnClick:!0,options:{multiSelect:!0,items:[{text:l.get("SNNavigationMap.Expand.Title"),className:"header"},{fonticon:"exchange-add",text:l.get("SNNavigationMap.ExpandUpAndDownstream.Title"),className:"ExpandUpAndDownstream_Command",name:"ExpandUpAndDownstream",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_Expand_Command"),r.trackUsage("Expand","AllDirectionsToolbar")}},{fonticon:"left-add",text:l.get("SNNavigationMap.ExpandUpstream.Title"),className:"ExpandUpstream_Command",name:"ExpandUpstream",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_Expand_Command","in"),r.trackUsage("Expand","OneDirectionToolbar")}},{fonticon:"right-add",text:l.get("SNNavigationMap.ExpandDownstream.Title"),className:"ExpandDownstream_Command",name:"ExpandDownstream",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_Expand_Command","out"),r.trackUsage("Expand","OneDirectionToolbar")}},{fonticon:"exchange-cog",text:l.get("SNNavigationMap.ExpandNLevel.Title"),className:"ExpandNLevel_Command",name:"ExpandNLevel",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_ExpandNLevel"),r.trackUsage("Expand","ExpandNLevelToolbar")}},{className:"divider"},{text:l.get("SNNavigationMap.Collapse.Title"),className:"header"},{fonticon:"exchange-minus",text:l.get("SNNavigationMap.CollapseUpAndDownstream.Title"),className:"CollapseUpAndDownstream_Command",name:"CollapseUpAndDownstream",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_Collapse_Command"),r.trackUsage("Collapse","AllDirectionsToolbar")}},{fonticon:"left-minus",text:l.get("SNNavigationMap.CollapseUpstream.Title"),className:"CollapseUpstream_Command",name:"CollapseUpstream",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_Collapse_Command","in"),r.trackUsage("Collapse","OneDirectionToolbar")}},{fonticon:"right-minus",text:l.get("SNNavigationMap.CollapseDownstream.Title"),className:"CollapseDownstream_Command",name:"CollapseDownstream",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_Collapse_Command","out"),r.trackUsage("Collapse","OneDirectionToolbar")}}],events:{onClick:function(e,t){r.trackUsage("Commands",t.name)}}}}},{fonticon:"eye-off",text:l.get("SNNavigationMap.HideObjects.Title"),className:"Hide_Command selectionIcon",name:"Hide",handler:function(e,i){r.trackUsage("Commands","Hide"),t.dispatchEvent("ENORIPE_HideCommand")}},{className:"divider selectionIcon",name:"divider"},{fonticon:"linearGraph"==a.getLayoutType()?"graph-linear":"view-list",text:"linearGraph"===a.getLayoutType()?l.get("SNNavigationMap.LinearGraph.Title"):l.get("SNNavigationMap.DataGrid.Title"),className:"LayoutType_Command",id:"LayoutType_Command",content:{type:"dropdownmenu",closeOnClick:!0,options:{multiSelect:!1,items:[{fonticon:"graph-linear",text:l.get("SNNavigationMap.LinearGraph.Title"),className:"linearGraph_Command",name:"linearGraph",selectable:!0,selected:"linearGraph"==a.getLayoutType()},{fonticon:"view-list",text:l.get("SNNavigationMap.DataGrid.Title"),className:"dataGrid_Command",name:"dataGridView",selectable:!0,selected:"dataGridView"==a.getLayoutType()}],events:{onClick:function(e,i){r.trackUsage("LayoutType","ChangeLT-"+i.name),t.dispatchEvent("ENORIPE_SwitchLayout",i.name)}}}}},{fonticon:"cog",text:l.get("SNNavigationMap.CustomizeAll.Title"),className:"Customize_Command",handler:function(){r.trackUsage("Commands","CustomizeAll"),t.dispatchEvent("ENORIPE_CustomizeAllCommandClick")}},{fonticon:"select-on",text:l.get("SNNavigationMap.MultiSelection.Title"),className:"multisel-icons",id:"Selection_Command",content:{type:"dropdownmenu",closeOnClick:!0,options:{multiSelect:!0,items:[{fonticon:"select-all",text:l.get("SNNavigationMap.selectAll.Title"),className:"SelectAll_Command",name:"SelectAll",selectable:!1,handler:function(e){t.dispatchEvent("ENORIPE_selectAllFromCommand")}},{fonticon:"filter-select-on",text:l.get("SNNavigationMap.selectFiltered.Title"),className:"SelectFiltered_Command disabledOnDatagrid",name:"SelectFiltered",id:"SelectFiltered",selectable:!1,handler:function(e){t.dispatchEvent("ENORIPE_selectOutFilteredFromCommand")}},{fonticon:"select-inverted",text:l.get("SNNavigationMap.selectInverse.Title"),className:"SelectInverse_Command",name:"SelectInverse",selectable:!1,handler:function(e){t.dispatchEvent("ENORIPE_selectInverseFromCommand")}},{fonticon:"select-on-cog",text:l.get("SelectionAssistant-Title"),className:"SelectionAssistant_Command",name:"SelectionAssistant",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_SelectionAssistantFromCommand")}},{fonticon:"select-none",text:l.get("SNNavigationMap.clearSelection.Title"),className:"ClearSelection_Command",name:"ClearSelection",selectable:!1,handler:function(){t.dispatchEvent("ENORIPE_clearSelectionFromCommand")}}],events:{onClick:function(e,t){r.trackUsage("Commands",t.name)},onShow:function(e,t){this.updateLayout()}.bind(this)}}}},{fonticon:"pencil",text:l.get("SNNavigationMap.EditLayout.Title"),className:"EditLayout_Command disabledOnDatagrid",id:"EditLayout_Command",selectable:!0,name:"EditLayout",handler:function(e,i){t.dispatchEvent("ENORIPE_EditLayoutCommandClick")}},{fonticon:"favorite-on",text:l.get("SNNavigationMap.Favorite.Title"),className:"Favorite_Command",name:"Favorite",handler:function(e,i){r.trackUsage("Commands","Favorite"),t.dispatchEvent("ENORIPE_FavoriteCommandClick")}},{fonticon:"info",text:l.get("SNNavigationMap.Information.Title"),className:"Info_Command",name:"Information",handler:function(e,i){t.dispatchEvent("ENORIPE_InfoCommandClick")}},{fonticon:"menu-dot",className:"DropdownMenu_Command",text:l.get("SNNavigationMap.Options.Title"),id:"toolBar-dropdownMenu",handler:function(){t.toolBar.getElement(".iconbar-overflow-menu-trigger")&&t.optionsDropdownMenu.show()}}].filter(function(e){return void 0!==e}),d=[{fonticon:"path-related",text:l.get("SNNavigationMap.computePaths.Title"),className:"ComputePath_Command",name:"ComputePath",handler:function(e,i){t.dispatchEvent("ENORIPE_ComputePathCommandClick")}},{className:"divider"},{fonticon:"arrow-double-combo",text:l.get("SNNavigationMap.fitAll.Title"),className:"FitAllIn_Command disabledOnDatagrid",name:"FitAllIn",handler:function(e,i){t.dispatchEvent("ENORIPE_FitAllCommandClick")}},{fonticon:"clear",text:l.get("SNNavigationMap.clearMap.Title"),className:"ClearView_Command",name:"ClearMap",handler:function(e,i){t.dispatchEvent("ENORIPE_ClearMapCommandClick")}},{fonticon:"refresh",text:l.get("SNNavigationMap.refreshMap.Title"),tooltipPosition:"bottom right",className:"Refresh_Command",name:"RefreshMap",handler:function(e,i){t.dispatchEvent("ENORIPE_RefreshMapCommandClick")}},{fonticon:"print",text:l.get("SNNavigationMap.printMap.Title"),className:"Print_Command",name:"PrintMap",handler:function(e,i){t.dispatchEvent("ENORIPE_PrintCommandClick")}},{fonticon:"export-to-csv",text:l.get("SNNavigationMap.export.Title"),className:"Export_Command disabledOnGraph",name:"Export",handler:function(e,i){t.dispatchEvent("ENORIPE_ExportCommandClick")}}].filter(function(e){return void 0!==e});i.Platform.android&&(d=d.filter(function(e){return"Print_Command"!==e.className})),"solidworks"!==this._addinMode&&"catiav5"!==this._addinMode||n.unshift({fonticon:"open",text:l.get("SNNavigationMap.openMap.Title"),className:"Open_Command",name:"Open",handler:function(e,i){r.trackUsage("Commands","Open"),t.dispatchEvent("ENORIPE_OpenCommandClick")}}),this._isWebInWin&&n.unshift({fonticon:"search",text:l.get("MapSearchView_search"),className:"Search_Command",name:"Search",handler:function(e,i){r.trackUsage("Commands","Search"),t._handleSearch()}});var h=[{fonticon:"home",text:l.get("SNNavigationMap.home.Title"),className:"Home_Command",name:"HomePage",handler:function(e,i){r.trackUsage("Commands","HomePage"),t.dispatchEvent("ENORIPE_HomeCommandClick")}},{className:"divider favorite-divider",name:"FavoriteDivider"}];return this._excludedCommands.length>0&&(n=1===this._excludedCommands.length&&"All"===this._excludedCommands[0]?[]:this.excludeCommands(n),h=1===this._excludedCommands.length&&"All"===this._excludedCommands[0]?[]:this.excludeCommands(h),d=1===this._excludedCommands.length&&"All"===this._excludedCommands[0]?[]:this.excludeCommands(d)),this.leftIconBar=new s({renderTo:t.toolBar,className:"left-toolbar-relations",tooltipsPosition:"bottom",items:h}),this.rightIconBar=new s({renderTo:t.toolBar,className:"right-toolbar-relations",tooltipsPosition:"bottom",items:n}),this.favoriteText=e.createElement("span",{class:"Enoripe-FavoriteText"}),this.favoriteText.addEventListener("mouseenter",e=>{let t=e.target;t.offsetWidth<t.scrollWidth?(t.tooltipInfos&&null!==t.tooltipInfos.elements||(t.tooltipInfos=new c({position:"bottom right",target:t,body:t.textContent})),e.touchFlag&&t.tooltipInfos.show()):t.tooltipInfos&&t.tooltipInfos.elements&&t.tooltipInfos.destroy()}),this.favoriteText.inject(this.leftIconBar.elements.container),this._hideFavoriteDivider(),this._isWebInWin&&(this.searchContainer=e.createElement("li",{class:"Enoripe-SearchContainer"})),this.toolBar.addEventListener("dragenter",function(e){e.stopPropagation()}),this.toolBar.inject(this.renderTo),-1===this._excludedCommands.indexOf("All")&&-1===this._excludedCommands.indexOf("DropdownMenu_Command")&&(this.optionsDropdownMenu=new o({target:this.rightIconBar.getItem("toolBar-dropdownMenu").elements.container,className:"optionsDropdownMenu",multiSelect:!0,items:d,responsiveMode:!0,events:{onClick:function(e,t){0!=t.selected&&r.trackUsage("Commands",t.name),this.dispatchEvent("ENORIPE_"+t.name,t.selected)}.bind(this),onShow:function(){this.updateLayout()}.bind(this)}})),this.updateLayout(),this.showAllToolbar(),this},getCommand:function(e){var t=this.toolBar.getElement("."+e);return t||((t=this.optionsDropdownMenu.elements.container.getElement("."+e))?t:void 0)},excludeCommands:function(e){for(var t=0;t<e.length;t++)this._excludedCommands.indexOf(e[t].className)>-1?(e.splice(t,1),t--):e[t].content&&"dropdownmenu"===e[t].content.type?e[t].content.options.items=this.excludeCommands(e[t].content.options.items):e[t].items&&(e[t].items=this.excludeCommands(e[t].items));return e},hideRightToolbar:function(){this.rightIconBar.hide()},hideItems:function(e){for(var t=document.getElementsByClassName("item "+e),i=0;i<t.length;i++)document.getElementById(t[i].id)&&document.getElementById(t[i].id).hide()},showItems:function(e){for(var t=document.getElementsByClassName("item "+e),i=0;i<t.length;i++)document.getElementById(t[i].id)&&document.getElementById(t[i].id).show()},hideSelectionIcon:function(){this.rightIconBar.elements.container.getElements(".selectionIcon").forEach(function(e){e.hide()}),this.toolBar.classList.remove("selectionIconOn"),this.rightIconBar.resize()},showSelectionIcon:function(){var e=a.getLayoutType();this.rightIconBar.elements.container.getElements(".selectionIcon").forEach(function(t){"dataGridView"===e&&t.className.contains("disabledOnDatagrid")||t.show()}.bind(this)),this.toolBar.addClassName("selectionIconOn"),this.rightIconBar.resize()},showAllToolbar:function(){this.toolBar.show(),this.rightIconBar.show(),this.leftIconBar.show()},toggleInfoCommand:function(){var e=this.getCommand("Info_Command");e.hasClassName("pressed")?e.removeClassName("pressed"):(e.addClassName("pressed"),r.trackUsage("Commands",e.getAttribute("name")))},updateLayout:function(){let e=this.rightIconBar.getItem("LayoutType_Command"),t=e.elements.container,i=e.content.component;var n=this.rightIconBar.getItem("LayoutType_Command").tooltip;switch(a.getLayoutType()){default:case"linearGraph":this.showItems("disabledOnDatagrid"),this.hideItems("disabledOnGraph"),d.getSelected().length<=0&&this.hideSelectionIcon(),t.firstChild.className="fonticon fonticon-graph-linear",n&&n.setBody(l.get("SNNavigationMap.LinearGraph.Title"));break;case"dataGridView":this.hideItems("disabledOnDatagrid"),this.showItems("disabledOnGraph"),t.firstChild.className="fonticon fonticon-view-list",n&&n.setBody(l.get("SNNavigationMap.DataGrid.Title")),i&&(i.getItem("linearGraph").elements.container.removeClassName("selected"),i.getItem("dataGridView").elements.container.addClassName("selected")),this.disableEditLayoutCommand();let e=this.getCommand("EditLayout_Command");e&&e.hasClassName("pressed")&&e.removeClassName("pressed")}},updateLayoutMenu:function(){let e=this.rightIconBar.getItem("LayoutType_Command"),t=e.elements.container,i=e.content.component;t.firstChild.className="fonticon fonticon-graph-linear",void 0!==i&&(i.getItem("linearGraph").elements.container.addClassName("selected"),i.getItem("dataGridView").elements.container.removeClassName("selected"))},disableSelectionAssistantCommand:function(){try{var e=this.rightIconBar.getItem("Selection_Command").content.component;void 0!==e&&e.disableItem("SelectionAssistant")}catch(e){console.log(e)}},enableSelectionAssistantCommand:function(){try{var e=this.rightIconBar.getItem("Selection_Command").content.component;void 0!==e&&e.enableItem("SelectionAssistant")}catch(e){console.log(e)}},disableEditLayoutCommand:function(){let e=this.getCommand("EditLayout_Command");e&&e.hasClassName("pressed")&&e.removeClassName("pressed")},updateFavoriteTitle:function(e){this.favoriteText&&void 0!==e&&null!=e&&(this.favoriteText.setContent(e),""!==e?this._showFavoriteDivider():this._hideFavoriteDivider())},_showFavoriteDivider:function(){let e=this.leftIconBar.getItem("FavoriteDivider");e&&e.elements.container.show()},_hideFavoriteDivider:function(){let e=this.leftIconBar.getItem("FavoriteDivider");e&&e.elements.container.hide()},_handleSearch:function(){var t=this;if(this._searchModule)this._searchModule.container.isHidden()||this._searchModule.clearSearch(),this._searchModule.container.toggle();else{var i=e.createElement("li",{class:"Enoripe-SearchContainer"}).inject(this.rightIconBar.getContent().getChildren()[0],"top");require(["DS/SNNavigationMap/views/SearchViewForNative"],function(e){t._searchModule=new e({renderTo:i}),t._searchModule.render(),t.listenTo(t._searchModule,"ENORIPE_performSearch_native",function(e){t.dispatchEvent("ENORIPE_performSearch_native",e)}),t.listenTo(t._searchModule,"ENORIPE_resetSearch_native",function(){t.dispatchEvent("ENORIPE_resetSearch_native")})})}},destroy:function(){this._parent(),this.toolBar.destroy(),this.toolBar=null,this.container=null},resizeHandler:function(){if(window&&window.innerWidth)window.innerWidth}})}),define("DS/SNNavigationMap/utils/LayoutUtils",["UWA/Class","DS/DagreShim/DagreShim","DS/SNNavigationMap/MapSettings"],function(e,t,i){return e.extend({init:function(e){this._dagre=t,this.layoutOptions=e},getNodesWidth:function(){return i.getNodesWidth()},getNodesHeight:function(){return i.getNodesHeight()},_setupGraph:function(){this._graphObject&&(this._graphObject=null,delete this._graphObject),this._graphObject=new this._dagre.graphlib.Graph({}).setGraph({rankdir:"LR",align:"DL",ranksep:350,directed:!0,multigraph:!0}).setDefaultEdgeLabel(function(){return{}})},setData:function(e){this._setupGraph();var t=this,i=0;return e.nodes.forEach(function(e){e.instances&&(!0===e.instancesCollapsed||(i=t.getNodesHeightWithInstance(e))),t._graphObject.setNode(e.id,{label:e.name,width:t.getNodesWidth(),height:i})}),e.links.forEach(function(e){t._graphObject.setEdge(e.source.id,e.target.id)}),this},getNodesHeightWithInstance:function(e){var t;return t=e.instances?30*e.instances.length:0,this.getNodesHeight()+t},findLoops:function(){return this._dagre.graphlib.alg.findCycles(this._graphObject)},getPathCoordinates:function(e,t,i,n,s){var o="";return"x"===this.layoutOptions.layoutAxis&&(o=this._getPathCoordinatesXAxis(e,t,i,n,s)),o},_getPathCoordinatesXAxis:function(e,t,n,s,o){var a,r,l=e.source.columnID===e.target.columnID-1||e.source.columnID===e.target.columnID+1,d=e.source.columnID===e.target.columnID,c=e.source.columnID<e.target.columnID,h="",u="",g=0,p=0,f=this.getNodesHeight()/2,m=this.getNodesWidth(),v=e.target.y,_=e.target.x;if(i.getThumbnailsMode()?(g=e.source.preview_url?i.getOption("nodeHeightWtThumb")/2:i.getOption("nodeHeightWtoutThumb")/2,p=e.target.preview_url?i.getOption("nodeHeightWtThumb")/2:i.getOption("nodeHeightWtoutThumb")/2):(g=i.getOption("nodeHeightWtoutThumb")/2,p=i.getOption("nodeHeightWtoutThumb")/2),o.classed("duplicate")&&o.classed("displaynone",!0),e.target.instancesExpanded>0&&e.instanceTargetId){var S=e.target.instances.map(function(e){return e.id}).indexOf(e.instanceTargetId);S>-1&&S<e.target.instancesExpanded&&(o.classed("duplicate")&&o.classed("displaynone",!1),v=e.target.y+17+23*S+p)}return(!d&&!e.target.instancesExpanded||e.target.instancesExpanded<=0)&&n&&c&&(f-=32.5,g-=32.5,p-=32.5),!e.target.counts||!e.target.counts.hasCount("in")||n&&c||(_-=15),!e.source.counts||!e.source.counts.hasCount("out")||n&&c||(m+=15),h=c?e.source.x+m+" "+(e.source.y+g):e.source.x+" "+(e.source.y+g),u=c?_+" "+(v+p):e.target.x+m+" "+(v+p),l?"M"+h+" L "+u:d?(a=e.source.y+(v-e.source.y)/2,h=e.source.x+m+" "+(e.source.y+g),u=e.target.x+m+" "+(v+p),"M"+h+" Q "+(e.target.x+220)+" "+a+" "+u):(c||(t.attr("marker-end")&&(r=t.attr("marker-end").slice(0,-1),r+="-reverse)",t.attr("marker-start",r),t.attr("marker-end",null)),o.attr("transform","rotate(180) translate("+parseFloat(-(e.source.x+(e.target.x+m)))+", "+parseFloat(-(e.source.y+f+(v+f)))+")")),"M"+h+" Q "+(a=e.source.x+(e.target.x-e.source.x)/2)+" 0 "+u)},rotateTextLabel:function(e,t){if("x"===this.layoutOptions.layoutAxis)return this._rotateTextLabelXlayout(e,t)},_rotateTextLabelXlayout:function(e,t){var i=e.source.columnID===e.target.columnID-1||e.source.columnID===e.target.columnID+1,n=(e.source.columnID,e.target.columnID,e.source.columnID<e.target.columnID),s=this.getNodesWidth(),o=this.getNodesHeight()/2,a=e.target.y;if(e.target.instancesExpanded>0&&e.instanceTargetId){var r=e.target.instances.map(function(e){return e.id}).indexOf(e.instanceTargetId);r>-1&&(a=e.target.y+17+23*r+this.getNodesHeight()/2)}if(!n&&i)return"rotate(180) translate("+parseFloat(-(e.source.x+(e.target.x+s)))+", "+parseFloat(-(e.source.y+o+(a+o)))+")"}})}),define("DS/SNNavigationMap/views/SplittedDropView",["UWA/Core","UWA/Class/View","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/SNNavigationMap/utils/SNNavigationServices"],function(e,t,i,n){"use strict";return t.extend({name:"SDV-drop",_zonesCounter:{add:0,replace:0},className:function(){return this.getClassNames("-container")},setup:function(){this._openIconAndLabelHTML=e.createElement("div",{class:"drop-zone",html:[{tag:"span",class:"fonticon fonticon-open fonticon-3x"},{tag:"p",html:i.get("dropZoneOpenContent")}]}),this._addIconAndLabelHTML=e.createElement("div",{class:"drop-zone",html:[{tag:"span",class:"fonticon fonticon-plus fonticon-3x"},{tag:"p",html:i.get("dropAddContent")}]}),this._addContentDiv=e.createElement("div",{class:"global-drop-zone add-content"}),this._addIconAndLabelHTML.inject(this._addContentDiv),this._replaceContentDiv=e.createElement("div",{class:"global-drop-zone replace-content",html:{tag:"div",class:"drop-zone",html:[{tag:"span",class:"fonticon fonticon-replace fonticon-3x"},{tag:"p",html:i.get("dropReplaceContent")}]}}),this._addContentDiv.addEventListener("dragenter",this._onDragEnter.bind(this)),this._addContentDiv.addEventListener("dragleave",this._dragleave.bind(this)),this._addContentDiv.addEventListener("drop",this._onDrop.bind(this)),this._replaceContentDiv.addEventListener("dragenter",this._onDragEnter.bind(this)),this._replaceContentDiv.addEventListener("dragleave",this._dragleave.bind(this)),this._replaceContentDiv.addEventListener("drop",this._onDrop.bind(this)),this.container.addEventListener("dragover",this._onDragOver),this.container.setContent(this._replaceContentDiv,this._addContentDiv),this.container.hide()},show:function(e,t){"none"===this.container.getStyle("display")&&(this.container.setStyle("width",e+"px"),"extract"===sessionStorage.getItem("ENORIPE_currentDrag")||!0===t?(this._addContentDiv.addClassName("full"),this._addContentDiv.innerHTML=this._openIconAndLabelHTML.outerHTML,this._replaceContentDiv.hide()):(this._addContentDiv.innerHTML=this._addIconAndLabelHTML.outerHTML,this._addContentDiv.removeClassName("full"),this._replaceContentDiv.show())),this.container.show()},hide:function(){this.container.getElements(".current-dragover").forEach(function(e){e.removeClassName("current-dragover")}),this.container.hide(),this._zonesCounter.add=0,this._zonesCounter.replace=0,this.dispatchEvent("ENORIPE_SDV_hide",[])},_onDragOver:function(e){e.stopPropagation(),e.preventDefault()},_onDragEnter:function(e){var t=e.currentTarget;e.stopPropagation(),e.preventDefault(),t.hasClassName("add-content")?this._zonesCounter.add++:this._zonesCounter.replace++,t.addClassName("current-dragover")},_dragleave:function(e){var t,i=e.currentTarget;e.stopPropagation(),e.preventDefault(),i.hasClassName("add-content")?(this._zonesCounter.add--,t=this._zonesCounter.add):(this._zonesCounter.replace--,t=this._zonesCounter.replace),0===t&&(i.removeClassName("current-dragover"),this.container.getElement(".current-dragover")||this.hide())},_onDrop:function(t){t.stopPropagation(),t.preventDefault(),this.hide();for(var i,s,o,a=e.is(t.dataTransfer.types.indexOf,"function")?"indexOf":"contains",r="",l=["text/searchitems","text/plain","Text"],d=t.currentTarget.hasClassName("add-content")?"add":"replace",c=0;c<l.length&&""===r;c++)o=t.dataTransfer.types[a](l[c]),(e.is(o,"number")&&o>=0||e.is(o,"boolean")&&!0===o)&&(r=l[c]);""===r?n.sendToMapWebInWin("RefreshOnDrop",[],d)||this.dispatchEvent("ENORIPE_dropNotSupported"):((s=t.dataTransfer.getData(r)).length&&(i=JSON.parse(s),d&&"add"===d&&i.action&&(d=i.action)),this.dispatchEvent("ENORIPE_drop",[d,i]),sessionStorage.removeItem("ENORIPE_currentDrag"))},updateHeight:function(e,t){t&&this.container.setStyle("width",t),this._addContentDiv.setStyle("height",e+"px"),this._replaceContentDiv.setStyle("height",e+"px")},_getFreeZoneWidth:function(){var e=document.querySelector(".list-view-container"),t=null,i=null;if(e&&!e.isHidden()&&(t=e.querySelector("div.wux-windows-docking-element-free-zone.wux-docking-element-right")),t){if(i=t.getStyle("width"))return parseFloat(i.substring(0,i.length-2))}else{var n=document.getElementById("svg-root").getStyle("width");if(n)return parseFloat(n.substring(0,n.length-2))-50}return window.innerWidth}})}),define("DS/SNNavigationMap/views/CustomizeAttributeView",["UWA/Core","UWA/Class","UWA/Class/View","DS/WAFData/WAFData","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","DS/Handlebars/Handlebars4","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/Button","DS/Controls/ComboBox","DS/Controls/TooltipModel","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Tree/TreeListView","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/UIKIT/Iconbar","DS/UIKIT/Mask","DS/UIKIT/Autocomplete","DS/UIKIT/Alert","DS/FedDictionaryAccess/FedDictionaryAccessAPI","text!DS/SNNavigationMap/assets/templates/customizeAttribute.html","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/SNNavigationMap/utils/AdditionalColumnsUtils"],function(e,t,i,n,s,o,a,r,l,d,c,h,u,g,p,f,m,v,_,S,b,N,w,C,I){"use strict";return i.extend({name:"CustomizeAttribute",_dialog:null,_attributesModel:[],_typesModified:[],_attributesAtLaunch:{},_renderOptions:{},className:function(){return this.getClassNames("-container")},setup:function(e){var t=a.compile(w);this.mainTemplateHtml=t.call(null,{typeNls:C.get("CustomizeAttr-Type"),selExtNls:C.get("CustomizeAttr-selExtNls")}),this.dimensions={},this.dimensions.position={},this.dimensions.position.offsetX=0,this.dimensions.position.offsetY=50,this.dimensions.dialogWidth=540,this.dimensions.dialogHeight=520,this.firstLaunch=!0,e.iswebinwin&&N.setConfigForMyApps({myAppsBaseUrl:s.getMyAppsUrl(),userId:s.getUserID(),lang:s.getLang()})},render:function(e){this._renderOptions=e,this.defaults=e.defaults||{},this.content=this._getDialogContent(e),this.content.inject(this.container),this._setEvents(),this._attributesAtLaunch={graphView:this._getSelectedAttributes("graphView").map(e=>e.getAttributeValue("name")),dgvColumns:this._getSelectedAttributes("dgvColumns").map(e=>e.getAttributeValue("name"))}},refreshRender:function(e){this._renderOptions=e,this.defaults=e.defaults||{},this._refreshLayoutTypeComboBox(),this._refreshTreeView(e),this._refreshSelectedTreeView(e),this._refreshSelectedTreeViewColumns(e),this._attributesAtLaunch={graphView:this._getSelectedAttributes("graphView").map(e=>e.getAttributeValue("name")),dgvColumns:this._getSelectedAttributes("dgvColumns").map(e=>e.getAttributeValue("name"))};let t=this.content.getElement(".Customize_SearchAttributesCommand");t.hasClassName("pressed")&&(t.toggleClassName("pressed"),this._srchAutocomplete.elements.container.toggleClassName("customize-hidden"),this.container.getElement(".ENORipeCustomizeAttr-TypeContainer").toggleClassName("customize-hidden"))},cancel:function(){},_refreshLayoutTypeComboBox:function(){if(this._viewSelectorCombobox){var e=s.getLayoutType(),t=0;"dataGridView"===e&&(t=1),this._viewSelectorCombobox.selectedIndex=t,this.comboboxInfoDiv&&this.comboboxInfoDiv.tooltipInfos&&(this.comboboxInfoDiv.tooltipInfos.longHelp=this._getComboboxTooltipBody(e))}},_refreshTreeView:function(e){this._attrTreeDocument.empty(),this._addToAttrTreeDoc(e)},_refreshSelectedTreeView:function(e){this._selectedAttrTreeDocument.empty(),this._addToSelectedAttrTreeDoc(e.defaults)},_refreshSelectedTreeViewColumns:function(e){this._selectedAttrTreeDocumentCols.empty(),this._addToSelectedAttrTreeDocCols(e.defaults)},_setUpToolBar:function(e){var t=this,i=[{fonticon:"reset",text:C.get("SNNavigationMap.CustomizeAttributes.Reset.Tooltip"),handler:function(){t._resetClick()}},{className:"divider selectionIcon",name:"divider"},{fonticon:"search",className:"Customize_SearchAttributesCommand",text:C.get("SearchAvailableAttrs"),handler:function(e,i){i.elements.container.toggleClassName("pressed"),t._handleSearch()}},{className:"divider selectionIcon",name:"divider"},{fonticon:"up",text:C.get("MoveUp"),handler:function(){t._handleMove("oneUp")}},{fonticon:"down",text:C.get("MoveDown"),handler:function(){t._handleMove("oneDown")}},{fonticon:"move-to-top",text:C.get("MoveTop"),handler:function(){t._handleMove("toTop")}},{fonticon:"move-to-bottom",text:C.get("MoveBottom"),handler:function(){t._handleMove("toBottom")}}];new v({renderTo:e,className:"customizeattr-arwcmd",items:i})},_setUpComboBox:function(t){var i=t.container;this.viewSelectorDoc=new u,this.viewSelectorDoc.addRoot(new g({label:C.get("TilesAndThumbnails"),grid:{value:"graphView"}})),this.viewSelectorDoc.addRoot(new g({label:C.get("DatagridColumns"),grid:{value:"dgvColumns"}}));var n=s.getLayoutType(),o=0;"dataGridView"===n&&(o=1);var a={elementsTree:this.viewSelectorDoc,nbDisplayedElements:this.viewSelectorDoc.getRoots().length,actionOnClickFlag:!1,selectedIndex:o,touchMode:!0,multiSelFlag:!1};this._viewSelectorCombobox=new c(a),this._viewSelectorCombobox.addEventListener("change",this._handleViewChange.bind(this));var r=i.getElement("#ENORipeCustomizeAttr-comboboxContainer");this._viewSelectorCombobox.inject(r),this.comboboxInfoDiv=e.createElement("div",{class:"wux-ui-3ds-help wux-ui-3ds"});var l=this._getComboboxTooltipBody(n);this.comboboxInfoDiv.tooltipInfos=new h({allowUnsafeHTMLLongHelp:!0,longHelp:l}),this.comboboxInfoDiv.inject(r)},_getComboboxTooltipBody:function(t){var i="linearGraph"===t?C.get("SNNavigationMap.CustomizeAttributes.ComboboxInfo.TilesAndThumbnails.Tooltip"):C.get("SNNavigationMap.CustomizeAttributes.ComboboxInfo.DataGrid.Tooltip"),n=e.createElement("div",{html:i,styles:{"text-align":"start"}});return"linearGraph"===t&&e.createElement("ul",{html:C.get("SNNavigationMap.CustomizeAttributes.ComboboxInfo.TilesAndThumbnails.Tooltip.ul"),styles:{"text-align":"start","list-style":"inside"}}).inject(n),n},_setTreeView:function(e){this._setAttributeTree(e);var t=[{dataIndex:"tree",typeRepresentation:"string",text:C.get("CustomizeAttr-AttributesAvailable"),height:"auto",width:"auto",alwaysVisibleFlag:!0,editableFlag:!1,sortableFlag:!1}];this._attrDGV=new f({showRowIndexFlag:!1,showRowBorderFlag:!0,showColumnBorderFlag:!0,showSelectionCheckBoxesFlag:!0,rowSelection:"multiple",cellSelection:"none",useDragAndDrop:!1,selectionBehavior:{unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!0,enableShiftSelection:!0,enableFeedbackForActiveCell:!1,canInteractiveMultiselectWithCheckboxClick:!0},useAsyncPreExpand:!0,columns:t,treeDocument:this._attrTreeDocument}).inject(e.container.getElement("#ENORipeCustomizeAttr-MainTable"))},_setEvents:function(){let e=this.container.getElement("#ENORipeCustomizeAttr-Movementctrlsright");e.addEventListener("click",this._addToSelectedAttributes.bind(this)),e.tooltipInfos=new h({shortHelp:C.get("SNNavigationMap.CustomizeAttributes.MovementCtrlsRight.Tooltip")});let t=this.container.getElement("#ENORipeCustomizeAttr-Movementctrlsleft");t.addEventListener("click",this._removeFromSelectedAttributes.bind(this)),t.tooltipInfos=new h({shortHelp:C.get("SNNavigationMap.CustomizeAttributes.MovementCtrlsLeft.Tooltip")})},_onKeyUp:function(e){this._delayTimer&&clearTimeout(this._delayTimer);var t=this;this._delayTimer=setTimeout(function(){var i;i=(e.srcElement||e.target).value,t._performSearch(i)},500)},_resetClick:function(){var e=this._getSelectedView(),t=this._selectedAttrTreeDocumentCols;C.get("CustAttrResetDGV");this.defaults=JSON.parse(JSON.stringify(s.getJSONAttributes())),"graphView"===e&&(t=this._selectedAttrTreeDocument,C.get("CustAttrResetGraph")),t.prepareUpdate(),t.removeRoots(),t.pushUpdate(),"graphView"===e?this._addToSelectedAttrTreeDoc(this.defaults):this._addToSelectedAttrTreeDocCols(this.defaults),this._disableEnableOkBtn()},save:function(){var e=this._getChangesStatus();this._saveChangesInDefaults(),e.changesOnGraphView&&(o.trackUsage("CustomizeAttributes","UpdatesOnView-GraphView"),Object.keys(this.defaults).forEach(function(e){"EnoripeColumns"!=e&&o.trackUsage("CustomizeAttributes","GraphViewAttributes-"+e)})),e.changesOnDatagridView&&this.defaults.EnoripeColumns&&o.trackUsage("CustomizeAttributes","UpdatesOnView-DatagridView"),this.dispatchEvent("CustomizeAllView_UpdateAttributes",[this.defaults])},_handleSearch:function(){this._srchAutocomplete.elements.container.toggleClassName("customize-hidden"),this.container.getElement(".ENORipeCustomizeAttr-TypeContainer").toggleClassName("customize-hidden")},_getMatchedNodesByTypeName:function(e,t,i){return e.search({match:function(e){if(e.nodeModel.options.grid.type===t&&e.nodeModel.options.grid.name===i)return!0}})},_setSearchAutoComplete:function(e){this._srchAutocomplete=new S({noResultsMessage:!1,placeholder:C.get("CustomizeAttr-SearchTextInvite"),events:{onKeyUp:this._onKeyUp.bind(this)}}).inject(e,"after"),this._srchAutocomplete.elements.container.addClassName("customizeattr-search-autocomplete customize-hidden"),this._srchAutocomplete.elements.clear.addEventListener("click",this._clearSearch.bind(this))},_clearSearch:function(){this._attrTreeDocument.prepareUpdate(),this._attrTreeDocument.getAllDescendants().forEach(function(e){"attribute"===e.getAttributeValue("type")&&e.show()}),this._attrTreeDocument.pushUpdate()},_performSearch:function(e){this.addLoader(),this._clearSearch(),0!==e.length?(e=e.toLocaleLowerCase(),this._attrTreeDocument.prepareUpdate(),this._attrTreeDocument.getAllDescendants().forEach(function(t){t.getLabel().toLocaleLowerCase().search(e)>-1?(t.show(),t.getParent()&&t.getParent().expand()):"attribute"===t.getAttributeValue("type")&&t.hide()}),this.removeLoader(),this._attrTreeDocument.pushUpdate()):this.removeLoader()},_setSelectedTreeView:function(e){this._setSelectedAttributeTree(e);var t=[{dataIndex:"tree",text:C.get("CustomizeAttr-AttributesSelected"),height:"auto",width:"auto",editableFlag:!1,sortableFlag:!1}];this._selectedAttrDGV=new f({showRowIndexFlag:!1,showRowBorderFlag:!0,showColumnBorderFlag:!0,showSelectionCheckBoxesFlag:!0,rowSelection:"multiple",cellSelection:"none",useDragAndDrop:!1,selectionBehavior:{unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!0,enableShiftSelection:!0,enableFeedbackForActiveCell:!1,canInteractiveMultiselectWithCheckboxClick:!0},columns:t,treeDocument:this._selectedAttrTreeDocument}).inject(e.container.getElement("#ENORipeCustomizeAttr-SelectedTable"))},_setSelectedTreeViewColumns:function(e){this._setSelectedAttributeTreeCols(e);var t=[{dataIndex:"tree",text:C.get("CustomizeAttr-AttributesSelected"),height:"auto",width:"auto",editableFlag:!1,sortableFlag:!1}];this._selectedAttrDGVCols=new f({showRowIndexFlag:!1,showRowBorderFlag:!0,showColumnBorderFlag:!0,showSelectionCheckBoxesFlag:!0,rowSelection:"multiple",cellSelection:"none",useDragAndDrop:!0,selectionBehavior:{unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!0,enableShiftSelection:!0,enableFeedbackForActiveCell:!1,canInteractiveMultiselectWithCheckboxClick:!0},columns:t,treeDocument:this._selectedAttrTreeDocumentCols}).inject(e.container.getElement("#ENORipeCustomizeAttr-SelectedTable")),"graphView"===this._getSelectedView()?this._selectedAttrDGVCols.hide():this._selectedAttrDGV.hide()},_addToSelectedAttributes:function(){var e=this._attrTreeDocument.getSelectedNodes(),t=this._getSelectedView();"graphView"===t?this._selectedAttrTreeDocument.prepareUpdate():this._selectedAttrTreeDocumentCols.prepareUpdate();for(var i=0;i<e.length;i++)if("attribute"===e[i].options.grid.type){if(this._isAlreadyAdded(e[i]))continue;var n,s=e[i].getParents(),o=new g({label:e[i].options.label,grid:e[i].options.grid});if("dgvColumns"===t){this._selectedAttrTreeDocumentCols.addRoot(o);continue}for(var a=0;a<s.length;a++)if("ParentType"===s[a].options.grid.type){n=s[a];break}var r=this._getMatchedNodesByTypeName(this._selectedAttrTreeDocument,n.options.grid.type,n.options.grid.name);if(r.length>0){0===this._getMatchedNodesByTypeName(this._selectedAttrTreeDocument,e[i].options.grid.type,e[i].options.grid.name).length&&(r[0].addChild(o),r[0].expand())}else{var l=new g({label:n.options.label,grid:n.options.grid});l.addChild(o),this._selectedAttrTreeDocument.addRoot(l),l.expand()}}"graphView"===t?this._selectedAttrTreeDocument.pushUpdate():this._selectedAttrTreeDocumentCols.pushUpdate(),this._disableEnableOkBtn()},_removeFromSelectedAttributes:function(){var e;if("graphView"===this._getSelectedView()){this._selectedAttrTreeDocument.prepareUpdate(),e=this._selectedAttrTreeDocument.getSelectedNodes();for(var t=0;t<e.length;t++){var i=e[t].getParent();1===i.getAllDescendants().length?this._selectedAttrTreeDocument.removeRoot(i):i.removeChild(e[t])}this._selectedAttrTreeDocument.pushUpdate()}else{this._selectedAttrTreeDocumentCols.prepareUpdate(),e=this._selectedAttrTreeDocumentCols.getSelectedNodes();for(t=0;t<e.length;t++)this._selectedAttrTreeDocumentCols.removeRoot(e[t]);this._selectedAttrTreeDocumentCols.pushUpdate()}this._disableEnableOkBtn()},_setAttributeTree:function(e){this._attrTreeDocument=new u({shouldBeSelected:function(e){var t=e.options.grid.type;return"MoreBtn"!==t&&"ParentType"!==t&&"extension"!==t}}),this._addToAttrTreeDoc(e)},_addToAttrTreeDoc:function(e){var i,n,s=this,o=[];this._attrTreeDocument.prepareUpdate();for(var a=e.types,r=0;r<a.length;r++)i={label:a[r].nlsLabel,children:[],grid:{name:a[r].name,type:"ParentType",label:a[r].nlsLabel}},n=new g(i),this._attrTreeDocument.addRoot(n),o.push(a[r].name);function l(e,t){var i=e.options.grid.type,n=t.options.grid.type,s=0;if(i===n){var o=e.getLabel().toUpperCase(),a=t.getLabel().toUpperCase();o>a?s=1:o<a&&(s=-1)}else"attribute"===i&&"extension"===n?s=-1:"extension"===i&&"attribute"===n&&(s=1);return s}i={label:C.get("Customize-More"),grid:{name:"MoreBtn",type:"MoreBtn",label:C.get("Customize-More")},children:[]},n=new g(i),this._attrTreeDocument.addRoot(n),this._attrTreeDocument.onPreExpand(function(e){var i=e.target;if(i.hasChildren())i.sortChildren({isRecursive:!1,sortFunction:l}),i.preExpandDone();else if("MoreBtn"===i.options.grid.type)s._attrTreeDocument.removeRoot(i),s._getAndAddMoreTypes(o).then(function(){i.preExpandDone()});else{var n=s._getAndAddAttributes(i),a=s._getAndAddExtension(i),r=s._getAndAddAdditionalColumns(i);t.Promise.all([n,a,r]).then(function(){i.sortChildren({isRecursive:!1,sortFunction:l}),i.preExpandDone()})}}),this._attrTreeDocument.pushUpdate()},_setSelectedAttributeTree:function(e){this._selectedAttrTreeDocument=new u({shouldAcceptDrop:function(e){return"middle"!==e.dropPosition},shouldBeSelected:function(e){return"ParentType"!==e.options.grid.type}}),this._addToSelectedAttrTreeDoc(e.defaults)},_addToSelectedAttrTreeDoc:function(e){for(var t in this._selectedAttrTreeDocument.prepareUpdate(),e)if(e.hasOwnProperty(t)){if("EnoripeColumns"===t)continue;var i=e[t],n={label:i.nlsLabel,grid:{name:i.name,type:"ParentType",label:i.nlsLabel},children:[]},s=new g(n);if(i.attributes)for(var o=0;o<i.attributes.length;o++){var a=i.attributes[o],r={label:a.label,grid:{name:a.uri,type:"attributes",label:a.label}};s.addChild(new g(r))}this._selectedAttrTreeDocument.addRoot(s)}this._selectedAttrTreeDocument.pushUpdate()},_setSelectedAttributeTreeCols:function(e){this._selectedAttrTreeDocumentCols=new u({shouldBeSelected:function(e){return"ds6w:label"!==e.options.grid.name}}),this._addToSelectedAttrTreeDocCols(e.defaults)},_addToSelectedAttrTreeDocCols:function(e){this._selectedAttrTreeDocumentCols.prepareUpdate();for(var t=e.EnoripeColumns.attributes,i=0;i<t.length;i++){var n=t[i],s={label:n.label,grid:{name:n.uri,type:"attributes",label:n.label,dataType:n.dataType,additionalColumn:n.additionalColumn}};this._selectedAttrTreeDocumentCols.addRoot(new g(s))}this._selectedAttrTreeDocumentCols.pushUpdate()},_handleMove:function(e){var t,i;if("graphView"===this._getSelectedView()){if(0===this._selectedAttrTreeDocument.getSelectedNodes().length)return;for(var n=this._selectedAttrTreeDocument.getRoots(),s=0;s<n.length;s++){i=(t=n[s]).getChildren();for(var o=0;o<i.length;o++)if(i[o].isSelected()){switch(e){case"oneUp":this._moveOneUp(t,i,this._selectedAttrTreeDocument);break;case"oneDown":this._moveOneDown(t,i,this._selectedAttrTreeDocument);break;case"toTop":this._moveToTop(t,i,this._selectedAttrTreeDocument);break;case"toBottom":this._moveToBottom(t,i,this._selectedAttrTreeDocument)}break}}}else{if(0===this._selectedAttrTreeDocumentCols.getSelectedNodes().length)return;switch(i=(t=this._selectedAttrTreeDocumentCols).getChildren(),e){case"oneUp":this._moveOneUp(t,i,this._selectedAttrTreeDocumentCols,!0);break;case"oneDown":this._moveOneDown(t,i,this._selectedAttrTreeDocumentCols,!0);break;case"toTop":this._moveToTop(t,i,this._selectedAttrTreeDocumentCols,!0);break;case"toBottom":this._moveToBottom(t,i,this._selectedAttrTreeDocumentCols,!0)}}this._disableEnableOkBtn()},_moveOneUp:function(e,t,i,n){for(var s=0,o=[];s<t.length&&t[s].isSelected();)t[s].options.grid.isSequence=!0,s++;for(var a=0;a<t.length;a++)t[a].isSelected()&&(o.push(t[a]),!0!==t[a].options.grid.isSequence&&(t[a].options.grid.moveToIndex=a-1));i.prepareUpdate();for(var r=0;r<t.length;r++)if(t[r].isSelected()&&void 0!==t[r].options.grid.moveToIndex){var l;if(n){if("ds6w:label"===(l=e.getNthRoot(t[r].options.grid.moveToIndex)).getAttributeValue("name"))continue}else l=e.getNthChild(t[r].options.grid.moveToIndex);e.insertBefore(t[r],l)}i.pushUpdate(),this._persistSelection(o),this._resetSequencing(i)},_moveOneDown:function(e,t,i,n){for(var s=[],o=t.length-1;o>-1&&t[o].isSelected();)t[o].options.grid.isSequence=!0,o--;for(var a=0;a<t.length;a++)t[a].isSelected()&&(s.push(t[a]),a!==t.length-1&&!0!==t[a].options.grid.isSequence&&(t[a].options.grid.moveToIndex=a+2));i.prepareUpdate();for(var r=t.length-1;r>-1;r--)if(void 0!==t[r].options.grid.moveToIndex){var l;if(t[r].options.grid.moveToIndex===t.length)e.insertBefore(t[r]);else l=n?e.getNthRoot(t[r].options.grid.moveToIndex):e.getNthChild(t[r].options.grid.moveToIndex),e.insertBefore(t[r],l);t[r].options.grid.moveToIndex=void 0}i.pushUpdate(),this._persistSelection(s),this._resetSequencing(i)},_moveToTop:function(e,t,i,n){for(var s=[],o=0;o<t.length&&t[o].isSelected();)t[o].options.grid.isSequence=!0,o++;var a=0;n&&(a=1);for(var r=0;r<t.length;r++)t[r].isSelected()&&(s.push(t[r]),!0!==t[r].options.grid.isSequence&&(t[r].options.grid.moveToIndex=a),a++);i.prepareUpdate();for(var l=0;l<t.length;l++)if(t[l].isSelected()&&void 0!==t[l].options.grid.moveToIndex){var d;if(n){if("ds6w:label"===(d=e.getNthRoot(t[l].options.grid.moveToIndex)).getAttributeValue("name"))continue}else d=e.getNthChild(t[l].options.grid.moveToIndex);t[l]!==d&&e.insertBefore(t[l],d)}i.pushUpdate(),this._persistSelection(s),this._resetSequencing(i)},_moveToBottom:function(e,t,i,n){for(var s=[],o=t.length-1;o>-1&&t[o].isSelected();)t[o].options.grid.isSequence=!0,o--;for(var a=t.length,r=t.length-1;r>=0;r--)t[r].isSelected()&&(s.push(t[r]),r!==t.length-1&&!0!==t[r].options.grid.isSequence&&(t[r].options.grid.moveToIndex=a),a--);i.prepareUpdate();for(var l=t.length-1;l>-1;l--)if(void 0!==t[l].options.grid.moveToIndex){var d;if(t[l].options.grid.moveToIndex===t.length)e.insertBefore(t[l]);else d=n?e.getNthRoot(t[l].options.grid.moveToIndex):e.getNthChild(t[l].options.grid.moveToIndex),e.insertBefore(t[l],d);t[l].options.grid.moveToIndex=void 0}i.pushUpdate(),this._persistSelection(s),this._resetSequencing(i)},_getAndAddExtension:function(e){var i=this,n=e.options.grid.name;return new t.Promise(function(t,s){"AllTypes"!==n&&"extension"!==e.options.grid.type?i._getDataSet(n).then(function(n){i._parseAndAddDataSet(n,e),t()},function(e){console.log(e),t("extensionFetch-err")}):t()})},_getAndAddAdditionalColumns:function(e){var i=e.options.grid.name,n=this._viewSelectorCombobox.selectedIndex;return new t.Promise(function(t,s){0!==n&&"AllTypes"===i?I.getConfigurationColumns().then(function(i){let n=[];if(i.forEach(function(e){n.push({name:e.dataIndex,value:e.text})}),n.length>0){let t,i;e.prepareUpdate();for(var s=0;s<n.length;s++)t={label:n[s].value,grid:{name:n[s].name,type:"attribute",label:n[s].value,additionalColumn:!0}},i=new g(t),e.addChild(i);e.pushUpdate()}t()},function(e){console.log(e),t("AdditionalColumns-err")}):t()})},_getDataSet:function(e){return new t.Promise(function(t,i){var n=s.getCurrentTenantName(),o=s.getLang();N.getExtensionsForClass(e,{tenantId:n,lang:o,apiVersion:"R2019x",onComplete:t,onFailure:function(e){i(e)}})})},_parseAndAddDataSet:function(e,t){var i=[];if(e&&e.extensions&&e.extensions.length>0&&(e.extensions.sort(function(e,t){return e.label.toUpperCase()<t.label.toUpperCase()?-1:e.label.toUpperCase()>t.label.toUpperCase()?1:0}),e.extensions.forEach(function(e){i.push({name:e.curi,value:e.label})})),i.length>0){var n,s;t.options.grid.name;t.prepareUpdate();for(var o=0;o<i.length;o++)n={label:i[o].value,grid:{name:i[o].name,type:"extension",label:i[o].value},children:[]},s=new g(n),t.addChild(s);t.pushUpdate()}},_getAndAddAttributes:function(e){var i=this,n=e.options.grid.name,s="ds6wg:";return"AllTypes"===n?s+="PLMEntity":n.contains("ds6wg:")?s=n:s+=n,new t.Promise(function(t,n){i._getAttrPredicates(s).then(function(n){i._processAndUpdateAttributes(n,s,e),t()},function(e){console.log(e),n()})})},_getAttrPredicates:function(e){return new t.Promise(function(t,i){N.getPropertiesForClass(e,{tenantId:s.getCurrentTenantName(),lang:s.getLang(),apiVersion:"R2019x",onComplete:function(e){t(e)},onFailure:function(e){i(e)}})})},_processAndUpdateAttributes:function(e,t,i){var n,s;if(e&&e.length>0){i.prepareUpdate();for(var o=e[0].properties,a=0;a<o.length;a++){var r=o[a].dataType;n={label:o[a].label,grid:{name:o[a].curi,typeUri:t,label:o[a].label,type:"attribute",dataType:r.slice(r.lastIndexOf("#")+1)}},s=new g(n),i.addChild(s)}i.pushUpdate()}},_getMoreTypes:function(){return new t.Promise(function(e,t){N.getVocabularyClasses("ds6wg",{tenantId:s.getCurrentTenantName(),lang:s.getLang(),apiVersion:"R2019x",onComplete:function(t){e(t)},onFailure:function(e){t(e)}})})},_getAndAddMoreTypes:function(e){var i=this;function n(e,t){var i=e.label.toUpperCase(),n=t.label.toUpperCase(),s=0;return i>n?s=1:i<n&&(s=-1),s}return new t.Promise(function(t,s){i._getMoreTypes().then(function(s){if(i._attrTreeDocument.prepareUpdate(),s.classes&&s.classes.length){s.classes.sort(n);for(var o=0;o<s.classes.length;o++)if(-1===e.indexOf(s.classes[o].curi.replace("ds6wg:",""))){var a=s.classes[o],r={label:a.label,grid:{name:a.curi,type:"ParentType",label:a.label},children:[]},l=new g(r);i._attrTreeDocument.addRoot(l)}i._attrTreeDocument.pushUpdate(),t()}})})},_getSelectedAttributes:function(e){var t=[];return e||(e=this._getSelectedView()),"graphView"===e?this._selectedAttrTreeDocument.getRoots().forEach(function(e){t=t.concat(e.getAllDescendants())}):t=t.concat(this._selectedAttrTreeDocumentCols.getAllDescendants()),t},_getChangesStatus:function(){var e={changesOnGraphView:!1,changesOnDatagridView:!1,areThereChanges:!1},t=this._getSelectedAttributes("graphView").map(e=>e.getAttributeValue("name")),i=this._getSelectedAttributes("dgvColumns").map(e=>e.getAttributeValue("name"));return e.changesOnGraphView=!UWA.Array.equals(t,this._attributesAtLaunch.graphView),e.changesOnDatagridView=!UWA.Array.equals(i,this._attributesAtLaunch.dgvColumns),e.areThereChanges=this.areThereEnoughAttributes()&&(e.changesOnGraphView||e.changesOnDatagridView),e},areThereEnoughAttributes:function(){return this._selectedAttrTreeDocument.getRoots().every(e=>!(e.getAllDescendants().length<3))&&this._getSelectedAttributes("dgvColumns").length>2},_disableEnableOkBtn:function(){var e=this._getChangesStatus();this.dispatchEvent("CustomizeAllView_updateSaveButton",{tabName:"CustomizeAttributes",areThereChanges:e.areThereChanges})},_getDialogContent:function(t){var i=e.createElement("div",{class:"ENORipeCustomizeAttr-Main",html:this.mainTemplateHtml}),n={types:t.types||[],container:i,selectedIndex:t.selectedIndex};return t.container=i,this._setUpComboBox(n),this._setSearchAutoComplete(i.getElement(".ENORipeCustomizeAttr-TypeContainer")),this._setUpToolBar(i.getElement(".ENORipeCustomizeAttr-ToolBar")),this._setTreeView(t),this._setSelectedTreeView(t),this._setSelectedTreeViewColumns(t),i},_isAlreadyAdded:function(e){var t;if("dgvColumns"===this._getSelectedView()){t=this._selectedAttrTreeDocumentCols.getAllDescendants();for(var i=0;i<t.length;i++)if(t[i].getAttributeValue("name")===e.getAttributeValue("name"))return!0}else for(var n=e.getParent().getAttributeValue("name"),s=this._selectedAttrTreeDocument.getRoots(),o=0;o<s.length;o++)if(s[o].getAttributeValue("name")===n){t=s[o].getAllDescendants();for(i=0;i<t.length;i++)if(t[i].getAttributeValue("name")===e.getAttributeValue("name"))return!0;break}return!1},_handleViewChange:function(){var e=this._getSelectedView();"graphView"===e?(this._selectedAttrDGV.show(),this._selectedAttrDGVCols.hide()):(this._selectedAttrDGVCols.show(),this._selectedAttrDGV.hide()),this.comboboxInfoDiv&&this.comboboxInfoDiv.tooltipInfos&&(this.comboboxInfoDiv.tooltipInfos.longHelp=this._getComboboxTooltipBody("graphView"===e?"linearGraph":"dataGridView")),this._refreshTreeView(this._renderOptions)},_getSelectedView:function(){return this.viewSelectorDoc.getRoots()[this._viewSelectorCombobox.selectedIndex].options.grid.value},_persistSelection:function(e){e.forEach(function(e){e.select()})},_resetSequencing:function(e){e.getAllDescendants().forEach(function(e){e.options.grid.isSequence=!1,e.options.grid.moveToIndex=void 0})},_saveChangesInDefaults:function(){var e=this._selectedAttrTreeDocument.getRoots(),t=this._selectedAttrTreeDocumentCols.getRoots(),i=this.defaults;this.defaults={EnoripeColumns:i.EnoripeColumns};for(var n=0;n<e.length;n++){var s=e[n].getAllDescendants(),o=[];s.forEach(function(e){o.push({uri:e.options.grid.name,label:e.getLabel()})}),this.defaults[e[n].options.grid.name]={name:e[n].options.grid.name,nlsLabel:e[n].getLabel(),attributes:o}}var a=[];for(n=0;n<t.length;n++)a.push({uri:t[n].options.grid.name,label:t[n].getLabel(),dataType:t[n].options.grid.dataType,additionalColumn:t[n].options.grid.additionalColumn});this.defaults.EnoripeColumns.attributes=a},showNotif:function(e){this.alert&&this.alert.destroy();var t=e.container||this.container;this.alert=new b({visible:!0,autoHide:!0,hideDelay:3e3,animate:!0}).inject(t),this.alert.add({className:e.lvl?e.lvl:"primary",message:e.message})},addLoader:function(e){e?_.mask(e):this.container?_.mask(this.container):_.mask(this.content)},removeLoader:function(e){e?_.unmask(e):this.container?_.unmask(this.container):_.unmask(this.content)}})}),define("DS/SNNavigationMap/views/ListView",["UWA/Core","UWA/Class/View","UWA/Class","DS/Windows/Panel","DS/Windows/ImmersiveFrame","DS/WAFData/WAFData","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/CommonUtils","DS/WebappsUtils/WebappsUtils","DS/UIKIT/Spinner","UWA/Class/Model","UWA/Date","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/EditPropWidget"],function(e,t,i,n,s,o,a,r,l,d,c,h,u,g,p,f){"use strict";return t.extend({name:"list-view",isVisible:!1,isWebInWin:!1,panel:null,model:{},_immersiveFrame:null,_informationPanel:null,_widgetId:"",_listSpinner:null,className:function(){return this.getClassNames("-container multisel-off")},setup:function(t){this._widgetId=t.widgetId||null,this._parent(t),this.isWebInWin=t.isWebInWin,this._immersiveFrame=new s,this._immersiveFrame.inject(this.container),this.panel=new n({closeButtonFlag:!1,width:a.getListViewPanelWidth(),resizableFlag:!0,immersiveFrame:this._immersiveFrame,position:{my:"bottom right",at:"bottom right",offsetY:48},touchMode:!0,verticallyStretchableFlag:!0,floatableFlag:!1}),this.hideTitle(),this._immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).collapsibleFlag=!1,this._immersiveFrame.dockWindow(this.panel,WUXDockAreaEnum.RightDockArea),this.panel.addEventListener("stopResize",function(e){this.dispatchEvent("ENORIPE_ResizeListViewPanel",this.panel.elements.container.offsetWidth)}.bind(this)),this._listSpinner=(new d).inject(e.createElement("div",{styles:{"text-align":"center",position:"absolute",top:"-4px",width:"95%"}}).inject(this.panel.elements.container)).show(),this.container.addEventListener("dragenter",function(e){e.stopPropagation()}),this.hidePanel();try{this.isWebInWin&&a.getSecurityContext()}catch(e){console.log(e)}},setModel:function(e){Array.isArray(e)||(e=[e]),(!this.model||this.container.isHidden()||this.model.length!=e.length||this.model[0]!=e[0]||e[0].get("instances")&&e[0].get("instances").length>1)&&(this.model=e,null!=this._informationPanel?this._setInformationPanelObject(this.model):this._initInformationsPanel(this.model))},_initInformationsPanel:function(e){var t=this;e&&e.length>0||this.model;if(null===t._informationPanel){var i=t.getpropOptions(g);t._informationPanel=new f(i),t._setInformationPanelObject(e),t.isLoading(!1),require(["DS/ENORIPE_Relations/RelationsTabSettings"],function(e){t.facetRelationsModule=e;var i={isDraggable:!0,isProfilesVisible:!1,appID:"ENORIPE_AP",publicationsMode:a.getPublicationsMode()};e.isAvailable(t._informationPanel.model,i).then(function(e){"object"==typeof e&&e.facetInfo?(e.facetInfo.options={defaultProfile:a.getOption("LastUsedProfile")},e.facetInfo.position=3,e.facetInfo.supportMerge=!0,t.relationsFacetInfos=e.facetInfo,t._informationPanel.addFacets([e.facetInfo]),require(["DS/PlatformAPI/PlatformAPI"],function(e){t.platformAPI=e;var i=t.facetRelationsModule.getLocalKey()+"/addInGraph";e.subscribe(i,function(e){e.models&&t._extractNode(e)});i=t.facetRelationsModule.getLocalKey()+"/downloadDocument",e.subscribe(i,function(e){e.modelId&&e.modelName&&t.dispatchEvent("ENORIPE_DownloadDocument",[e.modelId,e.modelName])})})):t.log("facets info is NOT in good format")},function(){t.log("this facet is not available for this context = "+e)})},function(e){console.warn("Cannot load "+e.requireModules)})}},_setInformationPanelObject:function(e){var t=this,i=[],n=1===(e=Array.isArray(e)?e:[e]).length;null!==t._informationPanel&&(e.forEach(function(e){if(e)if(e.get("selectedInstance")){e.get("selectedInstance").forEach(function(e){i.push(t.getPropModel(e,!0))})}else{let s=t.getPropModel(e.id,!1);if(n&&"Person"===e.get("type")){let t=e.get("ds6w:identifier");if(t){let e=r.getUser3DSwymPictureURL(t);e&&s.set("previewUrl",e)}}i.push(s)}}),i&&t._informationPanel.initDatas(i),t.panel.content=t._informationPanel,this.showPanel(),this.relationsFacetInfos&&this._informationPanel.addFacets([this.relationsFacetInfos]))},updateAttributes:function(){if(this.isVisible){var e=this.facetRelationsModule.getLocalKey()+"/updateAttributes",t={attrs:a.getDefaultAttributes()};this.platformAPI.publish(e,t)}},updateProfileRelations:function(e){this.facetRelationsModule&&this.facetRelationsModule.setProfile(e)},updatePublicationsMode:function(e){this.facetRelationsModule&&this.facetRelationsModule.updatePublicationsMode(e)},getWidth:function(){var e=0;return this.isVisible&&(e=this.panel.elements.container.offsetWidth),e},getpropOptions:function(e){var t=[e.FACET_PROPERTIES,e.FACET_INSTANCE,e.FACET_VIEWS,e.FACET_EFFECTIVITY,e.FACET_CHANGE,e.FACET_SWYMCOMMENTS,e.FACET_SHARING,e.FACET_PC_CONTENT];this.isWebInWin||t.push(e.FACET_REVISIONS);var i={typeOfDisplay:e.ALL,selectionType:e.NO_SELECTION,facets:t,readOnly:!0,extraNotif:!0,multiselection:!1,setCloseButton:!0,actions:[{name:"action_close_panel",text:u.get("close"),icon:"close",handler:function(){this.dispatchEvent("ENORIPE_CloseListView")}.bind(this)}]};try{var n=a.getXPrefCredential();n&&(n=n.replace("ctx::",""),i.context={getSecurityContext:function(){return{SecurityContext:n}}})}catch(e){console.log("error in getting security context"+e)}return i},getPropModel:function(t,i){if(!e.is(t))return null;var n=i?"relationship":"businessobject";return widget&&widget.setValue("x3dPlatformId",a.getPlatformId()),new p({metatype:n,objectId:t,source:"3DSpace",tenant:a.getPlatformId()||"OnPremise"})},hidePanel:function(){this.container.hide(),this.isVisible=!1,this._informationPanel&&this._informationPanel.initDatas([])},showPanel:function(){this.container.show(),this.isVisible=!0},hideTitle:function(){this.panel.elements._titleBarDiv.hide()},showTitle:function(){this.panel.elements._titleBarDiv.show()},isLoading:function(e){e?this._listSpinner.show():this._listSpinner.hide()},_extractNode:function(e){var t,i=[],n=[];t=this.model.map(function(e){return e.id}),(i=e.models).forEach(function(e){e.relations&&(n=[...n,...e.relations])}),i.length>0&&this.dispatchEvent("ENORIPE_extractNode",{sourceIds:t,objects:i,links:n})},clearPanel:function(){this.panel.title="",this.model=null},destroy:function(){this.clearPanel(),this._parent(),this.container=null}})}),define("DS/SNNavigationMap/views/popups/ExpandNLevel",["UWA/Core","UWA/Class/View","DS/UIKIT/SuperModal","DS/UIKIT/Input/Button","DS/UIKIT/Form","DS/SNNavigationMap/utils/PromisesManager","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/RelationsServices","DS/SNNavigationMap/utils/ProbesUtils","DS/SNNavigationMap/utils/PreferencesUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a,r,l,d,c){"use strict";return t.extend({name:"expandNLevel-view",superModal:null,widgetId:"",selectedNode:{},progressContainer:null,nodesExpandedIdByLevel:[null],expandSessionId:"",continueGetEcosystem:!0,level:2,setup:function(e){this._PM=new o({debugMode:"1"===a.getOption("debug_me")}),this.widgetId=e.widgetId;let t=d.getPref("expandNLevel");t&&t>0&&(this.level=t)},initModal:function(t){var n=this,o={},a=null;if(this.expandSessionId=t.expandSessionId?t.expandSessionId:this.getExpandSessionId(),this.continueGetEcosystem=!0,this.nodesExpandedIdByLevel=[null],t&&t.selectedNode){this.selectedNode=t.selectedNode,o={className:"vertical",grid:"1 2",fields:[{type:"select",label:c.get("NavigationDirectionLabel"),name:"navigationDirection",options:[{label:c.get("UpAndDownstream"),value:"",selected:!0},{label:c.get("Upstream"),value:"in"},{label:c.get("Downstream"),value:"out"}]},{type:"number",label:c.get("HowManyLevelExpand"),value:this.level,nativeNumber:!0,step:"1",min:"1",max:"5",name:"expandLevel",required:!0}],events:{onSubmit:function(e){e.expandLevel>0&&e.expandLevel<6?n.setCalculateView(e):(a.elements.container[1].style.borderColor="red",r.show())}}},a=new s(o);var r=e.createElement("span",{class:"error-text",text:c.get("NumberError")});r.hide(),a.elements.container[1].parentNode.insertBefore(r,a.elements.container[1].nextSibling),a.elements.container[1].addEventListener("blur",function(e){this.value<1||this.value>5?(this.style.borderColor="red",r.show()):(this.style.borderColor="#b4b6ba",r.hide())}),this.superModal=new i({renderTo:widget.body,className:"Enoripe-Modal-ExpandNLevel",animate:!0,events:{onHide:function(e){}.bind(this)}}),this.superModal.dialog({body:a,title:c.get("ExpandNLevelTitle")+" - 1/2",buttons:[{className:"primary",value:c.get("Calculate"),action:function(){a.submit()}},{value:c.get("cancel"),action:function(e){this.closeModal(e)}.bind(this)}]}),this.superModal.modals.current.elements.close.addEventListener("click",function(){this.closeModal(this.superModal.modals.current)}.bind(this))}},setCalculateView:function(t){var i,n,s=parseInt(t.expandLevel);this.progressContainer=e.createElement("div",{class:"progressContainer"}),n=e.createElement("div",{class:"progress w-0-percent",id:"self-animated"}).inject(this.progressContainer),i=e.createElement("div",{class:"separatorContainer"}).inject(n);for(var o=0;o<s;o++)e.createElement("div",{class:"separatorLevel","data-after":c.get("level")+" "+(o+1),styles:{width:"calc(100%/"+s+")",left:"calc((100%/"+s+")*"+o+")"}}).inject(i);e.createElement("div",{class:"progress-bar"}).inject(n),e.createElement("label",{id:"self-animated-label",text:c.get("Uploading")+"..."}).inject(n),this.superModal.dialog({body:this.progressContainer,title:c.get("ExpandNLevelTitle")+" - 2/2",buttons:[{className:"primary btn-create",value:c.get("OK"),disabled:!0},{value:c.get("cancel"),action:function(e){this.closeModal(e)}.bind(this)}]}),this.superModal.next();var a={progressLevel:0,expandLevel:s,selectedNode:this.selectedNode};t.navigationDirection&&(a.direction=t.navigationDirection),this.level=s,d.setPrefToLocalStorage("expandNLevel",s),this._getEcosystemByLevel(a)},endUploading:function(t,i,n,s){var o,r=null,d=null,h=0;(r=this.progressContainer.getElement("#self-animated-label"))&&r.setText(c.get("UploadComplete")),this.progressContainer.getElement(".progress").addClassName("progress-success"),o=e.createElement("div",{class:"uploadCommentContainer"}).inject(this.progressContainer),n!=i&&e.createElement("span",{class:"endingLevel",text:c.get("TheLevel")+" "+i+" "+c.get("noMoreObjects")}).inject(o);for(var u=1;u<t.length;u++)h+=Object.keys(t[u]).length;var g=h>1?c.get("objectsExpanded").format(h,i):c.get("objectExpanded").format(h,i);e.createElement("span",{class:"numberObjectsExpanded",text:g}).inject(o),h>0&&(e.createElement("span",{class:"addObjectsText",text:c.get("AddinGraphText")}).inject(o),(d=this.superModal.modals.current.getFooter().getElement(".btn-create")).removeClassName("disabled"),d.disabled=!1,d.addEventListener("click",function(){s=s||"both",l.trackMultiUsage("expandNLevel","expandNLevel",[n,s]),a.setOption("fullImportNoOfObjects",h),this.dispatchEvent("ENORIPE_fullImport",{sessionId:this.expandSessionId}),this.closeModal(this.superModal.modals.current)}.bind(this)))},closeModal:function(e){e.hide(),this.superModal.destroy(),this.continueGetEcosystem=!1},getExpandSessionId:function(){var e=new Date,t=e.getDay()+e.getMonth()+e.getFullYear()+"-"+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds();return"ENORIPE_Relations_Expand_"+Math.floor(1e4*Math.random())+"_"+t},_getEcosystemByLevel:function(e){var t,i=this,n=e.progressLevel?e.progressLevel:0,s=e.expandLevel?e.expandLevel:0;t={widgetId:this.expandSessionId,direction:e.direction,fullImportMode:!0},r.getEcosystem(Object.values(e.selectedNode),t).then(function(t){t=JSON.parse(t),n++,i.progressContainer.getElement(".progress-bar").style.width=Math.round(100/s*n)+"%",i.nodesExpandedIdByLevel[n]={};for(var o=0;o<t.objects.length;o++){var r=t.objects[o],l={},d=[];if(Object.keys(i.nodesExpandedIdByLevel[n]).indexOf(r)<0&&Object.keys(e.selectedNode).indexOf(r)<0){for(var c=0;t.objects[o].instances&&c<t.objects[o].instances.length;c++){let e={};a.getOption("attributesForItems").forEach(function(i){t.objects[o].instances[c][i]&&(e[i]=t.objects[o].instances[c][i])}),d.push(e)}l={instances:d},a.getOption("attributesForItems").forEach(function(e){t.objects[o][e]&&(l[e]=t.objects[o][e])}),i.nodesExpandedIdByLevel[n][t.objects[o].id]=l}}if(i.continueGetEcosystem)if(i.nodesExpandedIdByLevel[n]&&Object.keys(i.nodesExpandedIdByLevel[n]).length>0&&n<s){var h={progressLevel:n,expandLevel:s,selectedNode:i.nodesExpandedIdByLevel[n],direction:e.direction};i._getEcosystemByLevel(h)}else i.endUploading(i.nodesExpandedIdByLevel,n,s,e.direction)},function(){i.endUploading(i.nodesExpandedIdByLevel,n,s,e.direction)})}})}),define("DS/SNNavigationMap/views/elements/ExpandMenu",["UWA/Class/View","UWA/Core","UWA/Class/Events","DS/WebappsUtils/WebappsUtils","DS/Controls/TooltipModel","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","DS/UIKIT/Spinner","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a,r,l){"use strict";return e.extend(i,{name:"ExpandMenu",direction:"",nodeData:{},roundedRectContainer:null,isCollapse:!1,toggleEcosystemContainer:null,counts:[],nodeWidth:0,nodeHeight:0,setup:function(e,t,i,n){switch(this.svgNS={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},this.setMenuData({direction:e,nodeData:t,roundedRectContainer:i,isCollapse:!1}),this.nodeWidth=o.getNodesWidth(),this.nodeHeight=i.getAttribute("data-height"),n){default:case 0:this.setBubble(0);break;case 1:this.showExpandMenu();break;case 2:this.setCollapseMenu()}},setMenuData:function(e){e.direction&&(this.direction=e.direction),e.nodeData&&(this.nodeData=e.nodeData),e.roundedRectContainer&&(this.roundedRectContainer=e.roundedRectContainer),e.isCollapse&&(this.isCollapse=e.isCollapse),this.nodeData&&this.direction&&(this.counts=this.nodeData.counts.getRealCounts(this.direction))},setBubble:function(e){var i,n=this,s=0,o=0,r=0;"out"===this.direction&&(o=this.nodeWidth),i=this.nodeHeight/2,this.toggleEcosystemContainer=t.extendElement(document.createElementNS(this.svgNS.svg,"g")),this.toggleEcosystemContainer.setAttributes({class:"expandMenuDirection-"+this.direction,id:"toggleEcosystem",style:"transform:translate("+o+"px,"+(i-30)+"px)"}),this.toggleEcosystemContainer.inject(this.roundedRectContainer),this.expandMenu=t.extendElement(document.createElementNS(this.svgNS.svg,"foreignObject")),this.expandMenu.setAttributes({class:"foreignObjectExpandMenu",x:"in"===this.direction?-190:0,y:0}),this.expandMenu.inject(this.toggleEcosystemContainer);var l=t.extendElement(document.createElementNS(this.svgNS.svg,"g"));l.setAttributes({class:"expandBubble"}),l.inject(this.toggleEcosystemContainer);var d=t.extendElement(document.createElementNS(this.svgNS.svg,"foreignObject"));d.setAttributes({class:"foreignObjectCircleExpand",x:8,y:8,width:30,height:30}),d.inject(l),t.createElement("div",{class:"circleExpand"}).inject(d);var c=t.extendElement(document.createElementNS(this.svgNS.svg,"foreignObject"));c.inject(l),c.setAttributes({class:"foreignObjectFonticon",x:-20,y:20,height:40,width:40});var h=t.extendElement(document.createElementNS(this.svgNS.svg,"circle"));switch(h.setAttributes({class:"loadingExpander",cx:"0",cy:"32.5",r:"13"}),h.inject(l),this.createLoaderGif().inject(this.toggleEcosystemContainer),e){default:case 0:this.showWaiting();break;case 1:this.toggleEcosystemContainer.addEventListener("mouseenter",function(e){e.touchFlag||this.showExpandedMenu()}.bind(this)),this.toggleEcosystemContainer.addEventListener("mouseleave",this.hideExpandedMenu.bind(this)),c.setContent(t.createElement("span",{class:"fonticon fonticon-plus"})),l.addEventListener("click",function(e){e.stopPropagation(),e&&e.detail&&!e.detail.isCustom&&(this.splitCount(),a.trackUsage("Expand","OneDirectionCtx"))}.bind(this)),l.addEventListener("touchstart",function(e){e.stopPropagation(),e.preventDefault(),s=(new Date).getTime(),r=setTimeout(function(){n.showExpandedMenu(e)},1e3)}),l.addEventListener("touchend",function(e){e.stopPropagation(),e.preventDefault();var t=(new Date).getTime()-s;t?(t<1e3&&n.splitCount(),clearTimeout(r)):n.splitCount(),a.trackUsage("Expand","OneDirectionCtx")});break;case 2:c.setContent(t.createElement("span",{class:"fonticon fonticon-minus"})),l.addEventListener("click",function(e){e.stopPropagation(),e&&e.detail&&!e.detail.isCustom&&(this.dispatchEvent("ENORIPE_Collapse",[this.nodeData.id,this.direction]),a.trackUsage("Collapse","OneDirectionCtx"))}.bind(this))}},setExpandMenu:function(e){this.toggleEcosystemContainer&&(this.toggleEcosystemContainer.remove(),this.toggleEcosystemContainer=null),this.setMenuData({nodeData:e,isCollapse:!1}),this.showExpandMenu()},setCollapseMenu:function(){this.destroy(),this.setBubble(2),this.setMenuData({isCollapse:!0})},showExpandMenu:function(){var e,i=this;this.setBubble(1),e=this.calculateExpandNumber();var n=t.extendElement(document.createElementNS(this.svgNS.svg,"g"));n.inject(this.toggleEcosystemContainer),n.setAttributes({class:"expandNumberContainer"});var o=t.extendElement(document.createElementNS(this.svgNS.svg,"rect"));o.inject(n);var r=t.extendElement(document.createElementNS(this.svgNS.svg,"text"));r.inject(n);var d=t.extendElement(document.createElementNS(this.svgNS.svg,"tspan"));d.inject(r),d.setAttributes({class:"expandNumberText",dy:13,x:-3}),d.setContent(e);var c=d.getBBox();o.setAttributes({class:"expandNumberBackground",x:-4,y:0,width:c.width+2,height:17}),n.setContent([o,r]),this.expandMenuContainer=t.createElement("div",{class:"expandMenuContainer"}).inject(this.expandMenu);var h=t.createElement("div",{class:"expandMenuContents"}).inject(this.expandMenuContainer),u=e;u+=e>1?" "+l.get("objects"):" "+l.get("object");t.createElement("span",{class:"objectsNumber",text:u}).inject(h);for(var g=t.createElement("ul",{class:"expandMenuList"}).inject(h),p=0;p<this.counts.length;p++)t.createElement("li",{id:this.counts[p].get("id"),"data-relation":this.counts[p].get("name"),html:"<a>"+this.counts[p].get("count")+" "+this.getNlsRelationValue(this.counts[p].get("name"))+"</a>",events:{click:function(e){e.stopPropagation(),e.detail&&!e.detail.isCustom&&(console.log(this),i.splitCount([this.dataset.relation]),a.trackUsage("Expand","OneRelationCtx"))}}}).inject(g).tooltipInfos=new s({longHelp:this.getNlsRelationValue(this.counts[p].get("name"))});t.createElement("a",{class:"previewLink",text:l.get("PreviewAll"),events:{click:function(e){e.detail&&!e.detail.isCustom&&this.dispatchEvent("ENORIPE_ShowPreview",{model:this.nodeData.identifierData,direction:this.direction})}.bind(this)}}).inject(h)},showExpandedMenu:function(){var e=0;this.toggleEcosystemContainer&&!this.toggleEcosystemContainer.classList.contains("expanded")&&(this.toggleEcosystemContainer.classList.add("expanded"),this.dispatchEvent("ENORIPE_movetofront",this.roundedRectContainer),e=-15*this.counts.length,this.expandMenu.setAttributes({y:e,width:190,height:300}))},hideExpandedMenu:function(){this.toggleEcosystemContainer&&this.toggleEcosystemContainer.classList.contains("expanded")&&(this.toggleEcosystemContainer.classList.remove("expanded"),this.expandMenu.setAttributes({y:0,width:0,height:0}))},calculateExpandNumber:function(){var e=0;return this.counts&&this.counts.forEach(function(t){t.get("count")&&parseInt(t.get("count"))>0&&(e+=parseInt(t.get("count")))}),e},getNlsRelationValue:function(e){return l[e+"_short"]||l[e]||e},splitCount:function(e){if(!this.isLoading()){if(this.showLoading(),!e){e=[];for(var t=0;t<this.counts.length;t++)e.push(this.counts[t].get("name"))}e.length>0?this.dispatchEvent("ENORIPE_splitCount",[[this.nodeData.id],e,this.direction]):this.hideLoading()}},showLoading:function(){this.isLoading()||this.toggleEcosystemContainer.classList.add("is-loading")},hideLoading:function(){this.isLoading()&&this.toggleEcosystemContainer.classList.remove("is-loading")},showWaiting:function(){this.isWaiting()||this.toggleEcosystemContainer.classList.add("is-waiting")},hideWaiting:function(){this.isWaiting()&&this.toggleEcosystemContainer.classList.remove("is-waiting")},isLoading:function(){return this.toggleEcosystemContainer.classList.contains("is-loading")},isWaiting:function(){return this.toggleEcosystemContainer.classList.contains("is-wainting")},createLoaderGif:function(){var e=t.extendElement(document.createElementNS(this.svgNS.svg,"image"));return e.setAttributeNS(this.svgNS.xlink,"href",n.getWebappsAssetUrl("SNNavigationMap","icons/ui/uikit-loader.gif")),e.setAttributes({x:-15,y:17,height:30,width:30,class:"loader-icon"}),e},destroy:function(){this.toggleEcosystemContainer&&(this.toggleEcosystemContainer.remove(),this.toggleEcosystemContainer=null),this.container=null}})}),define("DS/SNNavigationMap/utils/DataGridCustoColumnsUtils",["UWA/Class","DS/WebappsUtils/WebappsUtils","DS/PADServices/utils/MaturityUtils","DS/PlatformAPI/PlatformAPI","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/CommonUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a){"use strict";return e.extend({init:function(e){this._dataGridCollection=e,this._availableCADMasters=new Map;let i=["CATIAV5","SOLIDWORKS","NX","CREO","SOLIDEDGE","ALTIUM","INVENTOR","AUTOCAD","CAAUPSAPP","CADENCEALLEGRO","3DEXPERIENCE","EPLAN","SURPAC"];for(var o=0;o<i.length;o++)this._availableCADMasters.set(i[o],t.getWebappsAssetUrl("PADServices","icons/cadmasters/I_CADMaster"+i[o]+".png"));this._isWebInWin=s.isWebInWin(),this._isWebInWin||(this._currentUser=n.getUser())},getCustoColumns:function(){var e=this;return{"ds6w:cadMaster":{dataIndex:"ds6w:cadMaster",kind:"image",width:40,minWidth:40,editableFlag:!1,typeRepresentation:"image",alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellValue:function(t){let i;if(t.nodeModel){let n=t.nodeModel.id,s=e._dataGridCollection.get(n);if(n&&s){let t=s._attributes["ds6w:cadMaster"];void 0!==t&&(i=e._availableCADMasters.get(t))}}return i?{iconPath:i,iconSize:{height:"22px"}}:""},getCellValueForExport:function(t){if(t.nodeModel){return e._dataGridCollection.get(t.nodeModel.id)._attributes["ds6w:cadMaster"]}return t.cellModel}},"ds6w:status":{dataIndex:"ds6w:status",kind:"tag",minWidth:50,editableFlag:!1,typeRepresentation:"tag",className:"lc-maturity-state",customisation:{exportable:{lock:!1,value:!0}},getCellClassName:function(t){if(t.nodeModel){let s=t.nodeModel.id,o=e._dataGridCollection.get(s);if(s&&o){let e=o._attributes["ds6w:status"];var n;return e&&(n=i.getAndCreateMaturityClass(e,"wux-controls-label")),n}}}},"ds6w:isLastRevision":{dataIndex:"ds6w:isLastRevision",kind:"boolean",typeRepresentation:"boolean",minWidth:50,editableFlag:!1,alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellTooltip:function(t){let i="";if(t.nodeModel){let n=t.nodeModel.id,s=e._dataGridCollection.get(n);if(n&&s){let e=s._attributes["ds6w:isLastRevision"];void 0!==e&&(i=("boolean"==typeof e?e:"TRUE"===e.toUpperCase())?{shortHelp:a.get("LastRevision")}:{shortHelp:a.get("NotlastRevision")})}}return i},getCellClassName:function(t){if(t.nodeModel){let i=t.nodeModel.id,n=e._dataGridCollection.get(i);if(i&&n){let e=n._attributes["ds6w:isLastRevision"];if(void 0!==e)return("boolean"==typeof e?e:"TRUE"===e.toUpperCase())?"lc_dgv-lastversion-check":"lc_dgv-lastversion-wrong"}}}},"ds6wg:PLMReference.V_isLastVersion":{dataIndex:"ds6wg:PLMReference.V_isLastVersion",kind:"boolean",typeRepresentation:"boolean",minWidth:50,editableFlag:!1,alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellClassName:function(t){if(t.nodeModel){let i=t.nodeModel.id,n=e._dataGridCollection.get(i);if(i&&n){let e=n._attributes["ds6wg:PLMReference.V_isLastVersion"];if(void 0!==e)return("boolean"==typeof e?e:"TRUE"===e.toUpperCase())?"lc_dgv-lastversion-check":"lc_dgv-lastversion-wrong"}}},getCellTooltip:function(t){let i="";if(t.nodeModel){let n=t.nodeModel.id,s=e._dataGridCollection.get(n);if(n&&s){let e=s._attributes["ds6w:isLastRevision"];void 0!==e&&(i=("boolean"==typeof e?e:"TRUE"===e.toUpperCase())?{shortHelp:a.get("LastRevision")}:{shortHelp:a.get("NotlastRevision")})}}return i}},"ds6w:reserved":{dataIndex:"ds6w:reserved",kind:"icon",minWidth:50,editableFlag:!1,typeRepresentation:"icon",alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellValue:function(t){var i=void 0;if(!t.isHeader&&t.nodeModel){let a=t.nodeModel.id,r=e._dataGridCollection.get(a);if(a&&r){let t=r._attributes["ds6w:reserved"],l=r._attributes["ds6w:reservedBy"]?e._dataGridCollection.get(a)._attributes["ds6w:reservedBy"]:"";if(i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-key lc_dgv_lock","boolean"==typeof t?t:"TRUE"===t.toUpperCase())if(e._isWebInWin)i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock lc_dgv_lock_default";else{var n=e._getUserLogin(),s=e._getUserName(),o=!1;l.trim().length>0&&((o=l.toUpperCase().trim()===n.toUpperCase().trim()||!1)||(o=l.toUpperCase().trim()===s.toUpperCase().trim()||!1)),o||(i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock lc_dgv_lock_other")}else i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock-open lc_dgv_unlock"}}return i},getCellValueForExport:function(t){if(t.nodeModel){return e._dataGridCollection.get(t.nodeModel.id)._attributes["ds6w:reserved"]}return t.cellModel}},"ds6w:responsible":{dataIndex:"ds6w:responsible",kind:"user",minWidth:150,editableFlag:!1,customisation:{exportable:{lock:!1,value:!0}},getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.isGroupingNode?"string":"user"},getCellValue:function(t){let i,n;if(t.nodeModel){let a=t.nodeModel.id,r=e._dataGridCollection.get(a);if(a&&r){let e=r._attributes.owner;var s=e?o.getUser3DSwymPictureURL(e):void 0;i=s?{iconPath:"url("+s+")",className:"dgv-user-thumbnail"}:{iconName:"topbar-user",fontIconFamily:1},n=r._attributes["ds6w:responsible"]}}return n?{icon:i,label:n}:void 0},getCellValueForExport:function(t){if(t.nodeModel){return e._dataGridCollection.get(t.nodeModel.id)._attributes.owner}return t.cellModel}}}},_getUserLogin:function(){var e=this._currentUser,t="";return void 0!==e&&(t=e.login),t},_getUserName:function(){var e=this._currentUser,t="";return void 0!==e&&(t=e.firstName+" "+e.lastName),t}})}),define("DS/SNNavigationMap/views/D3MapView",["UWA/Core","UWA/Class/View","DS/D3js_external/D3js","DS/SNNavigationMap/views/elements/RoundedRect","DS/SNNavigationMap/views/elements/ExpandMenu","DS/SNNavigationMap/views/elements/Links","DS/D3Cola/D3Cola","UWA/Utils/Client","DS/UIKIT/Tooltip","DS/WebappsUtils/WebappsUtils","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a,r,l,d,c,h,u){"use strict";return t.extend({name:"d3-map-view",className:function(){return this.getClassNames("-container multisel-off")},nodeMouseDown:!1,dragNodeStarted:!1,currentlyDraggingNode:!1,markersData:[{id:"node-arrow",position:10,color:"#77797c",dValue:"M 0 0 L 10 5 L 0 10 z"},{id:"node-arrow-focus",position:10,color:"#368ec4",dValue:"M 0 0 L 10 5 L 0 10 z"},{id:"node-arrow-focus-reverse",position:0,color:"#368ec4",dValue:"M 10 10 L 0 5 L 10 0 z"},{id:"node-arrow-reverse",position:0,color:"#77797c",dValue:"M 10 10 L 0 5 L 10 0 z"},{id:"node-arrow-red",position:10,color:"#EA4F37",dValue:"M 0 0 L 10 5 L 0 10 z"},{id:"node-arrow-green",position:10,color:"#57B847",dValue:"M 0 0 L 10 5 L 0 10 z"},{id:"node-arrow-orange",position:10,color:"#FFA500",dValue:"M 0 0 L 10 5 L 0 10 z"}],_highlightTimeout:null,_isMultiSelON:0,_currentDraggedNode:null,_selectedNode:null,_inFilteringMode:!1,_expandMenuViews:{out:{},in:{}},_scaleExtent:[.2,3],_UncheckedIcon:d.getWebappsAssetUrl("SNNavigationMap","icons/16/MultiSel_Unchecked.png"),_CheckedIcon:d.getWebappsAssetUrl("SNNavigationMap","icons/16/MultiSel_Checked.png"),_unfocusedIcon:d.getWebappsAssetUrl("SNNavigationMap","icons/16/MultiSel-unfocused.png"),setup:function(e){var t=this;i.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},this._selector=e.selector,this._spinnerMap=e.spinner,this.NodeCreator=new n(this._selector),this.NodeCreator.isChrome=this.isChrome(),this.NodeCreator._dropZone=e.dropZone,this.NodeCreator.layoutingOn=!1,this.NodeCreator.addEvent("ENORIPE_downloadDocument",function(e,i){t.dispatchEvent("ENORIPE_downloadDocument",[e,i])}),this.NodeCreator.addEvent("ENORIPE_Drop",function(e,i){t.dispatchEvent("ENORIPE_Drop",[e,i])}),this.NodeCreator.addEvent("ENORIPE_ShowPreview",function(e){t.dispatchEvent("ENORIPE_ShowPreview",e)}),this.NodeCreator.addEvent("ENORIPE_movetofront",function(e){i.select(e).moveToFront()}),this.NodeCreator.addEvent("ENORIPE_GetNlsAttrInfo",function(e){t.dispatchEvent("ENORIPE_GetNlsAttrInfo",e)}),this.NodeCreator.addEvent("ENORIPE_toggleInstance",function(e){t.dispatchEvent("ENORIPE_toggleInstance",e)}),this.NodeCreator.addEvent("ENORIPE_dragElement",function(e,i){t.dispatchEvent("ENORIPE_dragElement",[e,i])}),this.NodeCreator.addEvent("ENORIPE_clickListInstance",function(e){t.dispatchEvent("ENORIPE_clickListInstance",e)}),this.LinksCreator=new o,this.initDragListener(),this.layoutAxis=c.getLayoutAxis(),this.layoutDirection=c.getLayoutDirection(),!1===c.getThumbnailsMode()&&this.container.addClassName("no-thumbnails"),this._countLimit=e.countLimit,this.NodeCreator.nameLabel=e.nameLabel,this.NodeCreator.separator=e.separator,this._layoutUtils=e.layoutUtils,this.nodeRadius=80,this.width=window.innerWidth,this.height=window.innerHeight-150,this.zoomListener=i.behavior.zoom().scaleExtent(this._scaleExtent),this.svgContainer=i.select(this.container).append("svg").attr("id","svg-root").attr("width",this.width).attr("height",this.height).attr("pointer-events","all").call(this.zoomListener.on("zoom",this._redraw.bind(this))).on("dblclick.zoom",null).on("mousedown",function(){t.mouseDownTimeInContainer=new Date}).on("mouseup",function(){t.mouseUpTimeInContainer=new Date}).on("click",this._clearSelection.bind(this)).on("touchmove",function(){i.event.preventDefault()}),this.svgRootG=this.svgContainer.append("g"),this.linksContainer=this.svgRootG.append("g").attr("id","all-links"),this.nodesContainer=this.svgRootG.append("g").attr("id","all-nodes"),this.focusContainer=this.svgRootG.append("g").attr("id","focused-objects"),this.defs=this.svgContainer.append("svg:defs"),this.defs.selectAll("marker").data(this.markersData).enter().append("svg:marker").attr("id",function(e){return e.id}).attr("viewBox","0 0 10 10").attr("refX",function(e){return e.position}).attr("refY",5).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d",function(e){return e.dValue}).attr("fill",function(e){return e.color}),this.force=a.d3adaptor().linkDistance(150).size([this.width,this.height]).on("tick",this.tick.bind(this)).on("end",this.onViewReady.bind(this)),this.svgElement=this.getElement("svg")},render:function(e,t){var i=e.nodes;return this._resetFocusedLinksPosition(),this._d3Update(e),this.updateConstraints(e,t),i.forEach(function(e){if(!e.counts.isRequestDone()){var t=this.getElement("#container-"+CSS.escape(e.id));this.createExpandMenu("in",e,t,!1),this.createExpandMenu("out",e,t,!1)}}.bind(this)),this},_d3Update:function(e){var t=this,n=e.nodes,s=e.links,o=0;this.force.size([this.width,this.height]).nodes(n).links(s);var a=this.linksContainer.selectAll(".link").data(s,function(e){return e.id}),l=this.nodesContainer.selectAll(".node").data(n,function(e){return e.id});l.classed("focus",function(e){return e.focus}),a.classed("focus",function(e){var i=!0===e.source.focus||!0===e.target.focus,n=this.getElementsByTagName("textPath")[0];return i?(this.getElement("path").hasAttribute("marker-end")&&this.getElement("path").setAttribute("marker-end","url(#node-arrow-focus)"),this.getElement("path").hasAttribute("marker-start")&&this.getElement("path").setAttribute("marker-start","url(#node-arrow-focus)")):(this.getElement("path").hasAttribute("marker-end")&&this.getElement("path").setAttribute("marker-end","url(#node-arrow)"),this.getElement("path").hasAttribute("marker-start")&&this.getElement("path").setAttribute("marker-start","url(#node-arrow)")),t.LinksCreator.updateLabel(n,e),i});var d=l.enter().append(this.NodeCreator.createNode.bind(this.NodeCreator));d.on("mousedown",function(){t.nodeMouseDown=!0,i.event.stopPropagation()}).on("mouseup",function(){t.nodeMouseDown=!1}).on("touchmove",function(){i.event.preventDefault(),i.event.stopPropagation()}).on("touchstart",function(e){o=setTimeout(function(){t.nodeLongtouch(e)},1e3)}).on("touchend",function(){o&&clearTimeout(o)}).call(this.dragListener).on("click",this.nodeClicked.bind(this)).on("contextmenu",this.nodeRightClicked.bind(this)).each(this._setupEvents.bind(this)),!0!==r.Platform.ios&&!0!==r.Platform.ipad&&d.on("mouseenter",this._onMouseEnter.bind(this)).on("mouseleave",this._onMouseLeave.bind(this)),a.enter().append(this.LinksCreator.createNode.bind(this.LinksCreator)),this.dispatchEvent("ENORIPE_UpdateD3Map")},_redraw:function(e){this.nodeMouseDown||(e?this.svgRootG.transition():this.svgRootG).attr("transform","translate("+this.zoomListener.translate()+") scale("+this.zoomListener.scale()+")")},_generateConstraints:function(e,t){var i,n=[],s={},o={},a=[],r=0,l=[],d=function(e,t){return e._attributes.rowID>t._attributes.rowID?1:t._attributes.rowID>e._attributes.rowID?-1:0};for(var h in e.undefined&&delete e.undefined,e)if(e.hasOwnProperty(h)){a=e[h],h=parseInt(h),a=this._generateRowIDs(a);for(var u=0;u<a.length;u++)a[u].get("rowID")>-1&&(l[a[u].get("rowID")]?l[a[u].get("rowID")].push(a[u]):l[a[u].get("rowID")]=[a[u]]);if(e[h+1]&&n.push({axis:this.layoutAxis,left:t.indexOf(a[0]._attributes),right:t.indexOf(e[h+1][0]._attributes),gap:300}),a.length>1){a.sort(d),s={type:"alignment",axis:this.layoutAxis,offsets:[]},o={type:"alignment",axis:"x"===this.layoutAxis?"y":"x",offsets:[]};for(u=0;u<a.length;u++)r=o.offsets[u-1]?o.offsets[u-1].offset+c.getYOffset():0,(i=a[u-1])&&i.get("instances")&&(r+=c.getExpendHeight(),i.get("instancesExpanded")>0&&(r+=i.get("instancesExpanded")*c.getExpendHeight(),i.get("instancesExpanded")<i.get("instances").length&&(r+=c.getExpendHeight()))),s.offsets.push({node:t.indexOf(a[u]._attributes),offset:"0"}),o.offsets.push({node:t.indexOf(a[u]._attributes),offset:r});n.push(s,o)}}if(1===Object.keys(l).length){o={type:"alignment",axis:"x"===this.layoutAxis?"y":"x",offsets:[]};for(u=0;u<l[0].length;u++)o.offsets.push({node:t.indexOf(l[0][u]._attributes),offset:0});n.push(o)}return n},_generateRowIDs:function(e){for(var t,i=e.filter(function(e){return void 0!==e.get("rowID")}),n=e.filter(function(e){return void 0===e.get("rowID")}),s=[],o=e.length,a=0;a<i.length;a++)(t=i[a].get("rowID"))>e.length-1?i[a].set("rowID",e.length-1):t<0&&i[a].set("rowID",0),s[i[a].get("rowID")]?(i[a].unset("rowID"),n.push(i[a])):s[i[a].get("rowID")]=i[a];for(a=0;a<n.length;a++)for(var r=0;r<o;r++)if(void 0===s[r]){n[a].set("rowID",r),s[r]=n[a];break}return s},setAttrData:function(e,t){var i;if(e.isInstances)for(var n=0;n<e.ids.length;n++)(i=this.getElement("#instance-"+CSS.escape(e.ids[n])))&&this.NodeCreator.updateToolTip(i,e.nlsObj[e.ids[n]],e.ids[n]);else if((i=this.getElement("#container-"+CSS.escape(e.ids[0])))&&(this.NodeCreator.updateLabel(i,e),this.NodeCreator.updateToolTip(i.getElement(".drag-shape"),e.nlsObj[e.ids[0]],e.ids[0]),e.toFetchThumbnail)){var s=e.nlsObj[e.ids[0]].preview_url;this.NodeCreator.createThumbnail(i,s)}},initDragListener:function(){var e=this;this.nodeMousePressTime=0,this.dragListener=i.behavior.drag().on("dragstart",function(t){e.nodeMouseDownTime=new Date,e.mouseOriginalY=i.mouse(this)[1],e.dragNodeStarted=!0,e.currentlyDraggingNode=!0,i.event.sourceEvent.stopPropagation()}).on("drag",function(t){if(!1!==e.NodeCreator.layoutingOn){var n=i.mouse(this),s=i.mouse(e.svgContainer[0][0]);if(e.dragNodeStarted&&e.initiateDrag(t,this),s[1]<20)e._panTimer=!0,e._pan(this,"up");else if(s[1]>e.svgContainer[0][0].height.baseVal.value-20)e._panTimer=!0,e._pan(this,"down");else try{clearTimeout(e._panTimer)}catch(e){}t.y0+=n[1]-e.mouseOriginalY;var o,a=e.getElement("#"+CSS.escape(this.id)).getBoundingClientRect(),r=(a.top+a.bottom)/2;this._selectedNode=null,i.selectAll(".node").each(function(i){t.columnID===i.columnID&&t.id!==i.id&&(o=e.getElement("#"+CSS.escape(this.id)).getBoundingClientRect()).top<r&&r<o.bottom&&(e._selectedNode=i)}),i.select(this).attr("transform","translate("+t.x+","+t.y0+")"),e._updateReorderFeedback()}}).on("dragend",function(t){var n,s,o,a=i.select(this);if(e.nodeMouseUpTime&&new Date-e.nodeMouseUpTime<100)return;if(e.nodeMouseUpTime=new Date,e.nodeMousePressTime=e.nodeMouseUpTime-e.nodeMouseDownTime,a.classed("node-dragging",!1),e.currentlyDraggingNode=!1,e.mouseOriginalY=0,e.nodeMouseDown=!1,e._selectedNode?(n=e._currentDraggedNode.rowID<e._selectedNode.rowID?"down":"up",s=e._currentDraggedNode.y0<e._selectedNode.y-("thumbnailsMode"===c.getThumbnailsMode()?-20:-5)?"top":"bottom","up"===n&&"top"===s||"down"===n&&"bottom"===s?o=e._selectedNode.rowID:"up"===n&&"bottom"===s?o=e._selectedNode.rowID+1:"down"===n&&"top"===s&&(o=e._selectedNode.rowID-1),e._currentDraggedNode.rowID!==o?e.dispatchEvent("ENORIPE_ReorderColumn",[e._currentDraggedNode,e._selectedNode,o]):a.attr("transform","translate("+t.x+","+t.y+")")):a.attr("transform","translate("+t.x+","+t.y+")"),e._currentDraggedNode=null,e._selectedNode=null,e.svgContainer.classed("dragging",!1),e._updateReorderFeedback(),e.isChrome()&&1===i.event.sourceEvent.which&&0!==e.nodeMousePressTime&&e.nodeMousePressTime<250){var r=new CustomEvent("click",{detail:{isCustom:"true",ctrlKey:i.event.sourceEvent.ctrlKey},bubbles:!0,cancelable:!0});i.event.sourceEvent.toElement?i.event.sourceEvent.toElement.dispatchEvent(r):i.event.sourceEvent.target&&i.event.sourceEvent.target.dispatchEvent(r)}})},initiateDrag:function(e,t){this._currentDraggedNode=e,this.dragNodeStarted=!1,this.svgContainer.classed("dragging",!0),i.select(t).classed("node-dragging",!0).moveToFront()},nodeLongtouch:function(e){["in","out"].forEach(function(t){this._expandMenuViews[t][e.id]&&this._expandMenuViews[t][e.id].showExpandedMenu()}.bind(this))},nodeClicked:function(e){if(i.event.srcElement){if("multiSel-mapView-icon"===i.event.srcElement.className.baseVal)return}else if(i.event.target&&"multiSel-mapView-icon"===i.event.target.className.baseVal)return;if((!this.isChrome()||i.event.srcElement.hasClassName("drag-shape")||i.event.detail&&"true"===i.event.detail.isCustom)&&!(i.event.defaultPrevented&&this.nodeMousePressTime>100)){i.event.stopPropagation&&i.event.stopPropagation();var t=!1;t=i.event.detail&&i.event.detail.ctrlKey?i.event.detail.ctrlKey:i.event.ctrlKey;var n=this._updateMultiSelState(e);if(t||this._isTouchDevice())return this.initMultiSelection(),void this.dispatchEvent("ENORIPE_MultiSel_Object",[{models:e.id,sAction:n,origin:"MapView"}]);0===this._isMultiSelON&&(this._selector.clearMultiSel(),this.clearMultiSelection());this.getElement("#container-"+CSS.escape(e.id));this._resetOpacity(),this.dispatchEvent("onNodeClicked",[e.id,n]),void 0===this._nodeClickCounter&&(this._nodeClickCounter=0),this._nodeClickCounter++}},nodeRightClicked:function(e){i.event.stopPropagation(),i.event.preventDefault(),this._resetOpacity(),this.dispatchEvent("onNodeRightClicked",[{id:e.id,context:"D3MapView"}])},_setupDragEndEvent:function(e){var t=this.getElement("#container-"+CSS.escape(e.id)+" .drag-shap"),i=this;t&&t.addEventListener("dragend",function(){i.dispatchEvent("ENORIPE_dragEnd")})},_onMouseEnter:function(e){var t=this.getElement("#container-"+CSS.escape(e.id)+" .multiSel-mapView-icon");t&&t.show();var i=this;this._highlightTimeout&&clearTimeout(this._highlightTimeout),this._highlightTimeout=setTimeout(function(){i._fadeLinks(e)},1e3)},_onMouseLeave:function(e){this._highlightTimeout&&clearTimeout(this._highlightTimeout),this._resetOpacity();var t=this.getElement("#container-"+CSS.escape(e.id)+" .multiSel-mapView-icon");t&&!this._isMultiSelON&&t.removeAttribute("style")},_setupEvents:function(e){var t=this.getElement("#container-"+CSS.escape(e.id)+" #toggleMoreInstance");this._setupDragEndEvent(e),this._setupMultiSelEvent(e),t&&t.addEvent("click",function(t){this._onClickMoreInstances(t,e.instances)}.bind(this))},filter:function(e){var t=e.matchingIDs,i=[],n=[],s=[],o=[];this.endFilter(),this._inFilteringMode=!0,this.svgRootG.classed("links-nodes-faded",!0),(o=t.map(function(e){return"#referenceContainer-"+e})).length>0&&(i=document.querySelectorAll(o.join(", ")));for(var a=0;a<i.length;a++)i[a].addClassName("highlighted");if(e.filteredLinks)for(n=e.filteredLinks.map(function(e){return document.getElementById(e)}),a=0;a<n.length;a++)n[a]&&n[a].addClassName("highlighted");var r=t.map(function(e){return"#instance-"+e});r.length>0&&(s=document.querySelectorAll(r.join(", ")));for(a=0;a<s.length;a++){if(s[a].closest(".node")){var l=s[a].closest(".node").getElement(".nodeReference");l&&l.addClassName("highlighted")}s[a].addClassName("highlighted")}return t},endFilter:function(e){this._inFilteringMode=!1,this._resetOpacity(e)},highlightPath:function(e){this.svgRootG.classed("links-nodes-faded",!0),e.forEach(function(e){var t=document.getElementById("referenceContainer-"+e)||document.getElementById(e);i.select(t).classed("highlighted mouseover",!0)})},unhighlightPath:function(){this.svgRootG.classed("links-nodes-faded",!1),this.svgRootG.selectAll(".highlighted").classed("highlighted",!1).classed("mouseover",!1)},_fadeLinks:function(e){if(null!=this.container&&0!==this.getElements(".link").length){this.getElement("#container-"+CSS.escape(e.id));this.currentlyDraggingNode||(this.svgRootG.classed("links-nodes-faded",!0),this.svgRootG.selectAll(".link:not(.highlighted)").filter(function(t){if(t.source.id===e.id||t.target.id===e.id)return i.select("#referenceContainer-"+CSS.escape(t.source.id)+":not(.highlighted)").classed("highlighted mouseover",!0),i.select("#referenceContainer-"+CSS.escape(t.target.id)+":not(.highlighted)").classed("highlighted mouseover",!0),t.target.instancesExpanded>0&&i.select("#instance-"+CSS.escape(t.instanceTargetId)+":not(.highlighted)").classed("highlighted mouseover",!0),!0}).classed("highlighted mouseover",!0),this.svgRootG.selectAll(".link").filter(function(t){if(t.source.id===e.id||t.target.id===e.id)return!0}))}},_resetOpacity:function(e){!e&&this._inFilteringMode?(this.svgRootG.selectAll(".mouseover").classed("highlighted",!1).classed("mouseover",!1),this._inFilteringMode||0!=this.svgRootG.selectAll(".highlighted").data().length||(this.svgRootG.classed("links-nodes-faded",!1),clearTimeout(this._highlightTimeout),this._highlightTimeout=null)):(this._inFilteringMode=!1,this.svgRootG.selectAll(".highlighted").classed("highlighted",!1),this.svgRootG.classed("links-nodes-faded",!1),this.svgRootG.classed("links-faded",!1))},colorize:function(e){var t=null;e.matchingIDs.forEach(function(e){t=null,this.getElement("#container-"+CSS.escape(e.id))?t=this.getElement("#container-"+CSS.escape(e.id)):this.getElement("#instance-"+CSS.escape(e.id))&&(t=this.getElement("#instance-"+CSS.escape(e.id))),t&&this.NodeCreator.showColor(t,e.color)}.bind(this)),e.filteredLinks&&e.filteredLinks.colorMap&&this.colorizeLinks(e.filteredLinks)},unColorize:function(){this.getElements(".colored-rect-bi").forEach(function(e){e.remove()}),this.getElements(".colored-rect-instance").forEach(function(e){e.remove()}),this.uncolorizeLinks()},setColorOnLink:function(e,t,n){i.select(e).select("path").attr("marker-end","url(#"+t+"_"+n),e.setStyle("fill",n),e.setStyle("stroke",n),e.addClassName("filtered_rel")},setMarkerColorize:function(e,t){for(var i=!1,n=!1,s=0;s<t.length;s++){for(var o={id:e+"_"+t[s].color,position:10,color:t[s].color,dValue:"M 0 0 L 10 5 L 0 10 z"},a=(i=!1,0);a<this.markersData.length;a++)this.markersData[a].id===o.id&&(i=!0);!1===i&&(this.markersData.push(o),n=!0)}n&&this.defs.selectAll("marker").data(this.markersData).enter().append("svg:marker").attr("id",function(e){return e.id}).attr("viewBox","0 0 10 10").attr("refX",function(e){return e.position}).attr("refY",5).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("svg:path").attr("d",function(e){return e.dValue}).attr("fill",function(e){return e.color})},colorizeLinks:function(e){for(var t in this.setMarkerColorize("node-arrow-relations",e.tagColors),e.colorMap)if(e.colorMap.hasOwnProperty(t)){this.setColorOnLink(document.getElementById(t),"node-arrow-relations",e.colorMap[t]);var n=i.select(document.getElementById(t)).select("path").attr("marker-end");i.select(document.getElementById(t)).select("path").attr("previous-marker",n)}},uncolorizeLinks:function(){i.selectAll(".filtered_rel").select("path").attr("marker-end",function(e){return i.select(document.getElementById(e.id)).select("path").attr("previous-marker")}),i.selectAll(".link").select("path").attr("marker-end","url(#node-arrow)"),i.selectAll(".focus.link").select("path").attr("marker-end","url(#node-arrow-focus)"),this.svgRootG.selectAll(".filtered_rel").classed("filtered_rel",!1),i.selectAll(".link").style("fill",""),i.selectAll(".link").style("stroke","")},initMultiSelection:function(){this._isMultiSelON=1,this.container.removeClassName("multisel-off"),this.container.addClassName("multisel-on")},clearMultiSelection:function(){if(this._isMultiSelON=0,this.container){this.container.removeClassName("multisel-on"),this.container.addClassName("multisel-off"),this.container.removeClassName("unfocused");var e=this;this.getElements(".multiSel-mapView-icon").forEach(function(t){t.setAttribute("data-checked","false"),t.setAttributeNS("http://www.w3.org/1999/xlink","href",e._UncheckedIcon)})}},addToSelection:function(e){var t=this.getElement("#container-"+CSS.escape(e)+" .multiSel-mapView-icon");t?(t.setAttribute("data-checked","true"),t.setAttributeNS("http://www.w3.org/1999/xlink","href",this._CheckedIcon)):this.updateFocusClasses(e)},removeToSelection:function(e){var t=this.getElement("#container-"+CSS.escape(e)+" .multiSel-mapView-icon"),i=this.getElement("#container-"+CSS.escape(e));i&&(i.removeClassName("focus"),this.NodeCreator.removeSelectedInstance(i,e)),t&&(t.setAttribute("data-checked","false"),t.setAttributeNS("http://www.w3.org/1999/xlink","href",this._UncheckedIcon))},switchFocus:function(e,t){for(var i,n,s=0;s<e.length;s++)i=e[s],(n=this.getElement("#container-"+CSS.escape(i)+" .multiSel-mapView-icon"))&&(t?(n.setAttribute("data-checked","false"),n.setAttributeNS("http://www.w3.org/1999/xlink","href",this._unfocusedIcon)):(n.setAttribute("data-checked","true"),n.setAttributeNS("http://www.w3.org/1999/xlink","href",this._CheckedIcon)))},_clearSelection:function(){if(i.event.srcElement){if(""!==i.event.srcElement.className.baseVal)return}else if(i.event.target&&""!==i.event.target.className.baseVal)return;var e=this.mouseUpTimeInContainer-this.mouseDownTimeInContainer;i.event.defaultPrevented&&e>100||(this.hideAllExpandedMenu(),this.dispatchEvent("ENORIPE_clearSelection",["MapView"]))},_setupMultiSelEvent:function(e){var t=this.getElement("#container-"+CSS.escape(e.id)+" .multiSel-mapView-icon"),i=this;t&&t.addEventListener("click",function(t){if(!i.isChrome()||t.detail&&"true"===t.detail.isCustom){t.stopPropagation(),i.initMultiSelection();var n=i._updateMultiSelState(e);i.dispatchEvent("ENORIPE_MultiSel_Object",[{models:e.id,sAction:n,origin:"MapView"}])}})},_updateMultiSelState:function(e){var t=this.getElement("#container-"+CSS.escape(e.id)+" .multiSel-mapView-icon"),i="";if(t){this._xUncheckedIcon&&0,this._xCheckedIcon&&0;var n,s=t.getAttribute("data-checked");"false"===s?(s="true",n=this._CheckedIcon,i="add"):(s="false",n=this._UncheckedIcon,i="remove"),t.setAttributeNS("http://www.w3.org/1999/xlink","href",n),t.setAttribute("data-checked",s)}return i},toggleAllInstances:function(e,t){var i=this.getElements(".node");this.updateConstraints(e.getLinksAndNodes(),e.groupBy("columnID")),i.forEach(function(e){e.getElement(".instance-list-g")&&this.NodeCreator.toggleListInstances(e,t)}.bind(this))},updateInstancesList:function(e){e.forEach(function(e){let t=this.getElement("#container-"+e.id);t&&this.NodeCreator.updateInstancesList(t,e._attributes)}.bind(this))},_onClickMoreInstances:function(e,t){var i=e.currentTarget.closest(".node");e.stopPropagation(),i&&e.detail&&!e.detail.isCustom&&this.dispatchEvent("ENORIPE_clickMoreInstance",[i.getAttribute("data-id"),t])},updateNodesYposition:function(e){var t=[],i=null,n=null,s=null,o=null,a=null,r=null,l=null,d=null,h=!0,u=0,g=c.getNodesHeight();t=this.getElements(".node");for(var p=0;p<t.length;p++){h="thumbnailsMode"==e&&!!t[p].getElement(".thumbnail-image"),u=h?g:65,t[p].getElement(".drag-shape-container").setAttribute("height",u),(i=t[p].getElement(".node-text")).firstChild.setAttribute("x",h?26:40),i.setAttribute("y",u-40),i.setAttribute("x",h?25:40),(n=t[p].getElement(".map-type-icon"))&&(n.setAttribute("y",u-40),n.setAttribute("x",h?5:20)),(s=t[p].getElement(".background"))&&s.setAttribute("height",u),(o=t[p].getElement(".thumbnail-background"))&&o.setAttribute("height",u-10),(a=t[p].getElement(".foreign-object-count-mobile"))&&a.setAttribute("y",u-35),r=t[p].getElements("#toggleEcosystem");for(var f=0;f<r.length;f++)r[f].hasClassName("expandMenuDirection-in")?r[f].setAttribute("style","transform:translate(0px,"+(u/2-30)+"px"):r[f].setAttribute("style","transform:translate("+c.getNodesWidth()+"px,"+(u/2-30)+"px");var m;if(l=t[p].getElement(".instance-expander-g .rect-bkg-instance"),d=t[p].getElements(".rect-list-instance"),l&&d)l.setAttribute("y",u+3),t[p].getElement(".foreign-object-expand").setAttribute("y",u+2),t[p].getElement(".foreign-object-instances").setAttribute("y",u+5),d.forEach(function(e){e.setAttribute("y",u),m=e.getElements(".rect-bkg-instance"),i=e.getElements(".node-text");for(var t=0;t<m.length;t++)m[t].setAttribute("y",h?155+23*t:90+23*t);for(t=0;t<i.length;t++)i[t].setAttribute("y",h?170+23*t:105+23*t)})}var v=document.getElementsByClassName("loader-icon");for(p=0;p<v.length;p++){var _=v[p];h&&"20"===_.getAttribute("y")?_.setAttribute("y","40"):h||"40"!==_.getAttribute("y")||_.setAttribute("y","20")}},updateConstraints:function(e,t){var i=this._generateConstraints(t,e.nodes);this.force.constraints(i).start(),e.nodes.forEach(function(e){e.y0=e.y})},updateFocusClasses:function(e){e&&(this.svgRootG.selectAll(".node.focus").classed("focus",!1),this.nodesContainer.select("#container-"+CSS.escape(e)).classed({focus:!0}),this.svgRootG.selectAll(".link").classed("focus",function(e){var t=e.source.focus||e.target.focus;return i.select(this).select("path").attr("marker-end",t?"url(#node-arrow-focus)":"url(#node-arrow)"),t}))},centerTheGraph:function(e){var t=this.getBounds();if(t){var n=t.windowHeight,s=t.windowWidth,o=(n+e.actionBarHt)/2,a=(s-e.sidePanelWidth)/2,r=t.left+t.width/2,l=t.top+t.height/2,d=i.transform(i.select("g").attr("transform")),c=d.scale[0],h=d.translate[0]+(a-r),u=d.translate[1]+(o-l);this.zoomListener.translate([h,u]).scale(c),this._redraw(!0)}},fitAllIn:function(e){null==e&&(e={sidePanelWidth:0,actionBarHt:48});var t=this.getBounds(),n=t.windowWidth,s=t.windowHeight,o=s*n,a=t.nodeWidth*t.nodeHeight/o*100,r=Math.sqrt(10/a),l=t.width,d=t.height,c=n-e.sidePanelWidth,h=s-e.actionBarHt,u=Math.min(c/l,h/d);u=u>r?r:u;var g=i.transform(i.select("g").attr("transform")),p=g.scale[0],f=g.translate[0],m=g.translate[1];u=(u=(u*=p)>this._scaleExtent[1]?this._scaleExtent[1]:u)<this._scaleExtent[0]?this._scaleExtent[0]:u,this.zoomListener.translate([f,m]).scale(u),this._redraw(!1),this.centerTheGraph(e)},setSVGDimensions:function(e,t){this.width=t,this.height=e,this.container.setStyle(e),this.svgContainer.attr("width",t).attr("height",e)},addMissingThumbnail:function(e){var t=e.where({thumbnailTBU:!0}),i=this;t.length>0&&t.forEach(function(e){e.get("thumbnail")&&i.NodeCreator.createThumbnail(i.getElement("#container-"+CSS.escape(e.id)),e.get("thumbnail"))})},layoutingOff:function(){i.selectAll(".node .drag-shape").style("display",""),this.NodeCreator.layoutingOn=!1},layoutingOn:function(){i.selectAll(".node .drag-shape").style("display","none"),this.NodeCreator.layoutingOn=!0},tick:function(){var e=this.svgRootG.selectAll(".link"),t=this.nodesContainer.selectAll(".node"),n=this,s={};t.attr("transform",function(e){return"translate("+e.x+","+e.y+")"}),e.each(function(){var e=i.select(this),t=e.select("path"),o=e.select(".labelText"),a=i.select(this).datum(),l=n.getElements("#from_"+CSS.escape(a.source.id)+"_to_"+CSS.escape(a.target.id)),d=!1;if(l.length>1&&(s["#from_"+a.source.id+"_to_"+a.target.id]>=0&&(d=!0,s["#from_"+a.source.id+"_to_"+a.target.id]++),s["#from_"+a.source.id+"_to_"+a.target.id]||(d=!1,s["#from_"+a.source.id+"_to_"+a.target.id]=0)),"ie"===r.Engine.name&&this.parentNode.insertBefore(this,this),t.attr("d",function(e){var t=n.getElement("#from_"+CSS.escape(e.target.id)+"_to_"+CSS.escape(e.source.id));return n._layoutUtils.getPathCoordinates(e,i.select(this),t,d,i.select(this.parentNode))}),!0===d){var c=15*s["#from_"+a.source.id+"_to_"+a.target.id]+5;o.attr("dy",-c)}o.attr("transform",function(e){return n._layoutUtils.rotateTextLabel(e,d)})}),s={}},removeSelectedNodes:function(e,t){e.nodes;return this._removeSelectedNodes(e),this._d3Update(e),this.updateConstraints(e,t),this},_removeSelectedNodes:function(e){var t=e.nodes,i=e.links,n=this.linksContainer.selectAll(".link").data(i,function(e){return e.id});this.nodesContainer.selectAll(".node").data(t,function(e){return e.id}).exit().remove(),n.exit().remove()},_resetFocusedLinksPosition:function(){var e=this.focusContainer.selectAll("g").remove(),t=this;e.empty()||e.each(function(){var e=this;t.linksContainer.append(function(){return e})})},_updateReorderFeedback:function(){var e;i.select("#reorder-feedback").remove(),null!==this._currentDraggedNode&&null!==this._selectedNode&&(e=this._selectedNode.y-("thumbnailsMode"===c.getThumbnailsMode()?-20:-5),this._currentDraggedNode.y0<e?this.getElement("#container-"+CSS.escape(this._selectedNode.id)).appendChild(this.NodeCreator.getFeedbackReorder("top")):this.getElement("#container-"+CSS.escape(this._selectedNode.id)).appendChild(this.NodeCreator.getFeedbackReorder("bottom")))},_pan:function(e,t){var n,s,o,a=this;if(this._panTimer){clearTimeout(this._panTimer);var r=i.transform(this.svgRootG.attr("transform"));"up"!==t&&"down"!==t||(n=r.translate[0],s="up"===t?r.translate[1]+50:r.translate[1]-50),o=this.zoomListener.scale(),void 0!==n&&void 0!==s&&(this.zoomListener.translate([n,s]).scale(o),this.svgRootG.transition().attr("transform","translate("+this.zoomListener.translate()+") scale("+this.zoomListener.scale()+")"),this._panTimer=setTimeout(function(){a._pan(e,50,t)},50))}},removeLoadingClass:function(e){var t=this.getElement("#container-"+CSS.escape(e));t&&i.select(t).classed("is-loading",!1)},addLoader:function(e){if(e){var t=this.getElement("#container-"+CSS.escape(e));i.select(t).classed("is-loading",!0)}},removeLoader:function(e){if(e){var t=this.getElement("#container-"+CSS.escape(e));i.select(t).classed("is-loading",!1)}},getBounds:function(){var e=/(msie|trident)/i.test(navigator.userAgent),t=0;if(i.select("g").node()&&i.select(".node").node()){t=i.select("g").node().getBoundingClientRect();var n=i.select(".node").node().getBoundingClientRect(),s={};if(e){for(var o=this.getElements(".node"),a=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,d=Number.NEGATIVE_INFINITY,c=0;c<o.length;c++){var h=o[c].getOffsets();r=Math.min(r,h.x),l=Math.max(l,h.x),a=Math.min(a,h.y),d=Math.max(d,h.y)}var u=n.width,g=n.height,p=(d+=g)-a,f=(l+=u)-r;s.left=r,s.top=a,s.right=l,s.bottom=d,s.windowWidth=window.innerWidth,s.windowHeight=window.innerHeight,s.width=f,s.height=p,s.nodeWidth=u,s.nodeHeight=g}else s.left=t.left,s.top=t.top,s.right=t.right,s.bottom=t.bottom,s.windowWidth=window.innerWidth,s.windowHeight=window.innerHeight,s.width=t.width,s.height=t.height,s.nodeWidth=n.width,s.nodeHeight=n.height}return s},isPathPanel:function(){var e=document.getElementsByClassName("path-panel-view-container");return e.length>0&&"none"!=e[0].style.display},_isTouchDevice:function(){var e=!1;return(r.Platform.ios||r.Platform.android||r.Platform.tablet||r.Platform.blackberry||navigator&&navigator.maxTouchPoints>1)&&(e=!0),e},isChrome:function(){var t=!1;return"chrome"===e.Utils.Client.Engine.name&&(t=!0),t},isInitWithNodes:function(){if(this.nodesContainer){let e=this.nodesContainer.selectAll(".node");return!!(e[0]&&e[0].length>1)}return!1},_graphBounds:function(){var e=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return this.nodesContainer.selectAll(".node").each(function(s){e=Math.min(e,s.x-10),t=Math.max(t,s.x+180),i=Math.min(i,s.y),n=Math.max(n,s.y+70)}),{x:e,X:t,y:i,Y:n}},updateCount:function(e){var t=e.getLinksAndNodes().nodes,i=null;t.forEach(function(e){i=this.getElement("#container-"+CSS.escape(e.id)),this.expandMenuUpdate("in",e,i),this.expandMenuUpdate("out",e,i)}.bind(this)),this.tick()},expandMenuUpdate:function(e,t,i){var n,s=null,o=null;n=(o=t.counts).isAllExpanded(e),i.getElement(".expandMenuDirection-"+e)?this._expandMenuViews[e][t.id]&&(s=this._expandMenuViews[e][t.id],n?o.hasCount(e)?s.setCollapseMenu():s.destroy():s.setExpandMenu(t)):this.createExpandMenu(e,t,i,!0)},createExpandMenu:function(e,t,n,o){var a=null,r=0;n.getElement(".expandMenuDirection-"+e)||(o&&t.counts.hasCount(e)||!o)&&(r=o?t.counts.hasRealCount(e)?1:2:0,this._expandMenuViews[e][t.id]=new s(e,t,n,r),a=this._expandMenuViews[e][t.id],this.listenTo(a,"ENORIPE_ShowPreview",function(e){this.dispatchEvent("ENORIPE_ShowPreview",e)}.bind(this)),this.listenTo(a,"ENORIPE_splitCount",function(e,t,i){this.dispatchEvent("ENORIPE_splitCount",[e,t,i])}.bind(this)),this.listenTo(a,"ENORIPE_movetofront",function(e){i.select(e).moveToFront()}.bind(this)),this.listenTo(a,"ENORIPE_Collapse",function(e,t){this.dispatchEvent("ENORIPE_Collapse",[[e],t])}.bind(this)))},hideAllExpandedMenu:function(){for(var e=0;e<Object.keys(this._expandMenuViews).length;e++)for(var t=this._expandMenuViews[Object.keys(this._expandMenuViews)[e]],i=0;i<Object.keys(t).length;i++)t[Object.keys(t)[i]].hideExpandedMenu()},destroy:function(){this._parent(),this.container=null},hideSpinner:function(){this._spinnerMap&&this._spinnerMap.hide()},onViewReady:function(){this.hideSpinner()}})}),define("DS/SNNavigationMap/views/NavigationHomePage",["UWA/Core","UWA/Class/View","DS/WAFData/WAFData","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/CommonUtils","DS/SNNavigationMap/utils/ProbesUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/TransientWidget/TransientWidget","DS/WebappsUtils/WebappsUtils","DS/Handlebars/Handlebars4","DS/ENOXTriptych/js/ENOXTriptych","DS/TreeModel/TreeNodeModel","DS/UIKIT/DropdownMenu","DS/UIKIT/Mask","DS/CollectionView/ResponsiveTilesCollectionView","UWA/Date","DS/SNNavigationMap/utils/SNNavigationServices","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","text!DS/SNNavigationMap/assets/templates/homepageleft.html","text!DS/SNNavigationMap/assets/templates/homepageright.html"],function(e,t,i,n,s,o,a,r,l,d,c,h,u,g,p,f,m,v,_,S,b){"use strict";return t.extend({name:"navigationapp-homepage-view",models:[],_nameLabel:null,_detailLabel1:null,_detailLabel2:null,currentTab:null,_thumbnailIcon:l.getWebappsAssetUrl("SNNavigationMap","icons/I_RelatedObjectsFavoriteThumbnail.png"),_smallIcon:l.getWebappsAssetUrl("SNNavigationMap","icons/I_RelatedObjectsFavorite22.png"),className:function(){return this.getClassNames("-container")},setup:function(t){this._debug=t.debugMode,this._widgetId=t.widgetId||null,this._isWebInWin=t.isWebInWin,this._nameLabel=t.nameLabel,this._detailLabel1=t.detailLabel1,this._detailLabel2=t.detailLabel2,this._separator=t.separator,this._tenantId=t.platformId,this._leftWidth=270,this.tempDropZone=!1;var i=d.compile(S),n={header1:a.get("NavHomePage-Header1"),header2:a.get("NavHomePage-Header2"),quickAccess:a.get("NavHomePage-QuickAccess"),favorite:a.get("NavHomePage-Favorite"),recents:a.get("NavHomePage-Recents")},s=d.compile(b),o={header:a.get("NavHomePage-Recents")},r=i.call(null,n),l=s.call(null,o),h=e.createElement("div",{class:"ENORIPE-leftside-container",html:r}),u=e.createElement("div",{class:"ENORipe-rightside-container",html:l}),g=e.createElement("div",{class:"ENORipe-rightside-container-ignore",html:""}),p={left:{originalState:"open",overMobile:!0,minWidth:this._leftWidth,originalSize:this._leftWidth},borderLeft:!0,container:this.container,withtransition:!0,withoverflowhidden:!0};this._triptych=new c,this._triptych.init(p,h,u,g),this._notifManager=v,_.setNotificationManager(this._notifManager),this._setUpEvents()},render:function(){this.container.show();var e=this.getElement("#ENORipe-Favorite"),t=this.getElement("#ENORipe-Recents");this.changeTab(e,t),o.trackUsage("HomePage","OnHomepage")},showObjects:function(t){var i,n,o,a=null,r="",d="",c="",u=[];this.clearContent();try{if(Object.keys(t).length>0){this.responsiveTiles=this._getResponsiveTile({isDraggable:!0});for(var g=0;g<Object.keys(t).length;g++){if((a=Object.values(t)[g]).id=Object.keys(t)[g],r=this._getLabels(a,this._nameLabel),d=this._getLabels(a,this._detailLabel1),c=this._getLabels(a,this._detailLabel2),o=void 0,"Person"===a["ds6w:type"]){var p=a["ds6w:identifier"];p&&(o=s.getUser3DSwymPictureURL(p))}o?a.type_icon_url=o:o=a.preview_url?a.preview_url:l.getWebappsAssetUrl("SNNavigationMap","icons/thumbnailLargeDefault.png"),a.preview_url=o,n=new h({label:r,icons:[a.type_icon_url],subLabel:d,description:c,thumbnail:o,contextualMenu:"A",data:{id:a.id,type:a["ds6w:type"],element:a,name:a.name}}),u.push(n)}this.responsiveTiles.model=u,i=e.createElement("div",{class:"list-tiles-container"}).inject(this.getElement("#ENORipe-Recents-Container"));var f=window.innerHeight-47+"px";i.setStyle("height",f),this.responsiveTiles.getContent().inject(i)}else this.showDropInvite(this.getElement("#ENORipe-Recents-Container"))}catch(e){console.log(e),this.unmask()}this.unmask()},showFavorites:function(t){var i,s,o=null,r="",l="",d="",c=[],u={};try{if(this.clearContent(),t.favorite&&t.favorite.length>0){this.responsiveTiles=this._getResponsiveTile({isDraggable:!0}),t.favorite=t.favorite.sort(function(e,t){return new Date(t.modified)-new Date(e.modified)});for(var g=0;g<t.favorite.length;g++)r=(o=t.favorite[g]).title,l=o.owner+" | "+new Date(o.modified).toLocaleString(n.getLang()),d=a.get(o.profilename),u={label:r,icons:[this._smallIcon],subLabel:l,description:d,thumbnail:this._thumbnailIcon,contextualMenu:"A",data:{id:o.id,name:o.favoriteName,element:o,type:"ENORelationalExplorerFavorite",title:o.title,layoutType:o.layoutType||"linearGraph"}},o.rootIds&&(u.data.rootIds=o.rootIds),s=new h(u),c.push(s);this.responsiveTiles.model=c,i=e.createElement("div",{class:"list-tiles-container"}).inject(this.getElement("#ENORipe-Recents-Container"));var p=window.innerHeight-47+"px";i.setStyle("height",p),this.responsiveTiles.getContent().inject(i)}else this.showEmptyView("Favorite")}catch(e){console.log(e),this.unmask()}this.unmask()},changeTab:function(e,t){if(e&&e.id){this.getElements(".ENORipe-ActionContainer .selected").forEach(function(e){e&&e.removeClassName&&e.removeClassName("selected")}),e.addClassName("selected");var i=a.get("NavHomePage-Recents");e.id.contains("Favorite")?(i=a.get("NavHomePage-Favorite"),this.currentTab="Favorite",t?this.dispatchEvent("ENORIPE_HandleFavorite",t):this.dispatchEvent("ENORIPE_HandleFavorite")):e.id.contains("Recents")&&(i=a.get("NavHomePage-Recents"),this.currentTab="Recents",this.dispatchEvent("ENORIPE_HandleRecents")),this.getElement(".ENORipe-rightside-headertext").innerHTML=i}},mask:function(){g.mask(this.container)},unmask:function(){g.unmask(this.container)},showEmptyView:function(t){var i,n="",s="";switch(this.clearContent(),i=e.createElement("div",{class:"empty-container"}).inject(this.getElement("#ENORipe-Recents-Container")),t){default:case"Recents":s="fonticon-clock",n=a.get("NoRecentFound");break;case"Favorite":s="fonticon-favorite-on",n=a.get("NoFavoriteFound")}e.createElement("span",{class:"empty-view-icon center-block fonticon "+s+" fonticon-5x"}).inject(i),e.createElement("span",{class:"empty-view-title center-block",html:n}).inject(i),this.unmask()},getSelectedItems:function(e){var t=[],i=this._tenantId,n=null;return e.envId=i,t.push(e),(n=this.responsiveTiles.TreedocModel.getSelectedNodes())&&n.length>0&&n.forEach(function(n){n._options.data.id!==e.objectId&&t.push({envId:i,serviceId:"3DSpace",objectId:n._options.data.id,objectType:n._options.data.type,displayName:n._options.data.title})}),t},showDropInvite:function(t){this._dropInviteContainer=e.createElement("div",{class:"SDV-drop-container"}).inject(t),e.createElement("div",{class:"drop-invite",html:[{tag:"span",class:"wux-ui-3ds wux-ui-3ds-3x wux-ui-3ds-drag-drop"},{tag:"p",class:"drop-content-here",html:a.get("dropHere")}]}).inject(this._dropInviteContainer),this._addContentDiv=e.createElement("div",{class:"drop-zone add-content",html:{tag:"div",class:"dropzonemsg-container",html:[{tag:"span",class:"fonticon fonticon-open fonticon-3x"},{tag:"p",html:a.get("dropZoneOpenContent")}]}}).inject(this._dropInviteContainer).hide(),this._dropInviteContainer.addEventListener("dragenter",this._onDragEnter.bind(this)),this._addContentDiv.addEventListener("dragleave",this._onDragLeave.bind(this)),this._addContentDiv.addEventListener("drop",this._onDrop.bind(this)),this.getElement(".dropzonemsg-container").addEventListener("dragleave",function(e){e.stopPropagation(),e.preventDefault()})},hideDropInvite:function(){this._dropInviteContainer&&this._dropInviteContainer.hide()},removeDropInvite:function(){this._dropInviteContainer&&this._dropInviteContainer.parentNode.removeChild(this._dropInviteContainer)},_onDragEnter:function(e){e.stopPropagation(),e.preventDefault(),this._addContentDiv.show(),this._dropInviteContainer.addClassName("current-dragover")},_onDragLeave:function(e){e.stopPropagation(),e.preventDefault(),this._addContentDiv.hide(),this._dropInviteContainer.removeClassName("current-dragover"),!0===this.tempDropZone&&this.removeDropInvite(),this.tempDropZone=!1},_onDragOver:function(e){e.stopPropagation(),e.preventDefault()},_onDrop:function(t){t.stopPropagation(),t.preventDefault(),this._dropInviteContainer.removeClassName("current-dragover");for(var i,n,s,o=e.is(t.dataTransfer.types.indexOf,"function")?"indexOf":"contains",a="",r=["text/searchitems","text/plain","Text"],l=0;l<r.length&&""===a;l++)s=t.dataTransfer.types[o](r[l]),(e.is(s,"number")&&s>=0||e.is(s,"boolean")&&!0===s)&&(a=r[l]);if(""===a){if(!m.sendToMapWebInWin("RefreshOnDrop",[],"replace"))return this.dispatchEvent("ENORIPE_dropNotSupported"),void this._addContentDiv.hide();this.hideDropInvite(),this.hide(),this.clearContent()}else(n=t.dataTransfer.getData(a)).length&&(i=JSON.parse(n)),this.hideDropInvite(),this.hide(),this.clearContent(),this.dispatchEvent("ENORIPE_drop",["replace",i]);this._addContentDiv.hide()},_onDragStart:function(e,t){var i={protocol:"3DXContent",version:"1.0",source:"ENORIPE_AP",data:{items:this.getSelectedItems({serviceId:"3DSpace",objectId:t.cellModel._options.data.id,objectType:t.cellModel._options.data.type,displayName:t.cellModel._options.data.title})}};try{e.dataTransfer.setData("text/searchitems",JSON.stringify(i)),e.dataTransfer.setData("text",JSON.stringify(i))}catch(t){console.log(t),e.dataTransfer.setData("text",JSON.stringify(i))}r.closeWidget()},_getSelectedNodes:function(){var e=[];return this.responsiveTiles&&this.responsiveTiles.TreedocModel&&(e=this.responsiveTiles.TreedocModel.getSelectedNodes()),e=e.map(function(e){return e._options.data.element})},_getResponsiveTile:function(e){var t=this,i={height:"inherit",displayTitleTooltip:!0,displayPropertiesTooltip:!0,displayedOptionalCellProperties:["description","contextualMenu"],useDragAndDrop:e.isDraggable};e.isDraggable&&(i.onDragStartCell=this._onDragStart.bind(this));var n=new p(i);return(n=new p(i)).selectionBehavior={toggle:!0,unselectAllOnEmptyArea:!0,canMultiSelect:"Favorite"!==this.currentTab,canInteractiveMultiselectWithCheckboxClick:"Favorite"!==this.currentTab,enableShiftSelection:"Favorite"!==this.currentTab,enableFeedbackForActiveCell:!1},n.onContextualEvent={callback:function(e){var i=[];return e&&e.cellInfos&&i.push({type:"PushItem",title:a.get("open"),icon:"open",action:{callback:function(i){if("Recents"===t.currentTab){var n=t._getSelectedNodes()||[];n&&t._openRelExp(n)}else if("Favorite"===t.currentTab){var s=e.cellInfos.cellModel._options.data;s&&t._openRelExp([s])}}}}),i}},n.onCellDoubleClick(function(e){var i=e.cellModel._options.data;t._openRelExp([i])}),n},_openRelExp:function(e){e&&(this.hide(),this.clearContent(),e&&e.length>0&&(e=e.map(function(e){return(e={...e.element,...e}).objectId=e.id,delete e.element,e})),this.dispatchEvent("ENORIPE_OpenRelExp",[e]))},_getLabels:function(e,t){if(t){for(var i="",s=0,o="",a=0;a<t.length;a++){if(o="",e.hasOwnProperty(t[a]))if(o=e[t[a]],t[a].contains("modified"))if(""!==o)o=new Date(o).toLocaleString(n.getLang());if(o&&o.length>0&&(i=i.length>0?i+this._separator+o:o,s++),3===s)break}return i}},_hideLeftPanel:function(){this.getElement(".triptych-left").addClassName("display-none"),this.getElement(".fonticon-menu").removeClassName("display-none"),this.getElement(".openicon").addClassName("display-none"),this.getElement(".triptych-main").setStyle("left","0px"),this.getElement(".overlay-left").addClassName("display-none")},_showLeftPanel:function(){this._triptych._showPanel("left"),this.getElement(".triptych-left").removeClassName("display-none"),this.getElement(".openicon").removeClassName("display-none"),this.getElement(".triptych-left").removeClassName("close"),this.getElement(".triptych-left").addClassName("open"),this.getElement(".fonticon-menu").addClassName("display-none"),this.getElement(".triptych-main").setStyle("left",this._leftWidth+"px"),this.getElement(".triptych-left").setStyle("width",this._leftWidth+"px")},_updateContainerDimensions:function(){var t=this.container.parentElement;if(t){var i=(t=t.getDimensions?t:e.extendElement(t)).getDimensions();this.ctnWidth=i.width,this.ctnHeight=this._isWebInWin?window.innerHeight:i.height,this.container.setStyle("height",this.ctnHeight),this.container.getElement(".ENORipe-View-Container").setStyle("height",this.ctnHeight-55);var n=this.getElement(".list-tiles-container");if(n){var s=window.innerHeight-47+"px";n.setStyle("height",s)}this.getElement(".triptych-main")&&(window.innerWidth<580?this._hideLeftPanel():(this._isCollapsed,this._showLeftPanel()))}},_setUpEvents:function(){var e=this;this.getElements(".ENORipe-ActionContainer .action-btn").forEach(function(t){t.addEventListener("click",function(t){e.changeTab(t.currentTarget)})}),this.getElements(".ENORipe-rightside-header").forEach(function(t){t.addEventListener("click",e._handleArrowClick.bind(e))}),this.container.addEventListener("dragover",this._onDragOver),this.container.addEventListener("dragenter",function(){this.tempDropZone=!0,this.showDropInvite(this.container),this.getElement(".drop-invite")&&this.getElement(".drop-invite").hide()}.bind(this))},_handleArrowClick:function(e){var t=e.currentTarget.getElement(".fonticon-menu"),i=e.currentTarget.getElement(".openicon");t.hasClassName("display-none")?i.hasClassName("fonticon-open-left")?(this._leftWidth=45,this._isCollapsed=!0,i.removeClassName("fonticon-open-left"),i.addClassName("fonticon-open-right"),this.getElement(".triptych-left").addClassName("ENORIPE-collapsed"),this.getElement(".triptych-main").setStyle("left",this._leftWidth+"px")):(this._leftWidth=270,this._isCollapsed=!1,i.removeClassName("fonticon-open-right"),i.addClassName("fonticon-open-left"),this.getElement(".triptych-left").removeClassName("ENORIPE-collapsed"),this.getElement(".triptych-left").setStyle("width",this._leftWidth+"px"),this.getElement(".triptych-main").setStyle("left",this._leftWidth+"px")):this._handleMenuClick(t)},_handleMenuClick:function(e){var t=this;if(!this.dropDownMenu){var i={target:e,items:[{id:"favorite",text:a.get("NavHomePage-Favorite"),fonticon:"favorite-on"},{id:"recents",text:a.get("NavHomePage-Recents"),fonticon:"clock"}]};i.events={onClick:function(e,i){e.stopPropagation();var n=a.get("NavHomePage-Recents");i.id.contains("favorite")?(n=a.get("NavHomePage-Favorite"),t.currentTab="Favorite",t.dispatchEvent("ENORIPE_HandleFavorite")):i.id.contains("recents")&&(n=a.get("NavHomePage-Recents"),t.currentTab="Recents",t.dispatchEvent("ENORIPE_HandleRecents")),t.getElement(".ENORipe-rightside-headertext").innerHTML=n}},this.dropDownMenu=new u(i),this.dropDownMenu.show()}},onResize:function(){this._updateContainerDimensions()},clearContent:function(){var e=this.getElement("#ENORipe-Recents-Container"),t=this.getElement("#ENORipe-Recents-Container"),i=this.getElement(".list-tiles-container");e&&e.empty(),t&&t.empty(),i&&i.destroy()},destroy:function(){this.clearContent(),this._parent(),this.container.destroy(),this.container=null}})}),define("DS/SNNavigationMap/views/DataGridView",["UWA/Core","UWA/Class","UWA/Class/View","UWA/Controls/Abstract","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/SNNavigationMap/utils/PreferencesUtils","DS/i3DXCompassPlatformServices/OpenWith","DS/Windows/ImmersiveFrame","DS/Utilities/Utils","DS/SNNavigationMap/utils/CommonUtils","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/DataGridCustoColumnsUtils","DS/SNNavigationMap/utils/ProbesUtils","DS/WebappsUtils/WebappsUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/SNNavigationMap/utils/AdditionalColumnsUtils"],function(e,t,i,n,s,o,a,r,l,d,c,h,u,g,p,f,m,v,_){"use strict";return i.extend({name:"datagrid-view",tree:{},collectionView:{},models:[],cols:[],attributes:[],promiseManager:{},isWebInWin:!1,modelsToAdd:{},linksInTree:[],expandingModelIds:[],expandDirection:{upstream:!0,downstream:!0},rightClickModel:null,tenantName:"",instancesNumberByLinks:{},_countInfos:{},_custoColumns:[],_taggerInUse:!1,_nbFixedColumn:3,_fromSwitch:!1,_filterOn:!1,TIMEOUT:6e4,LOOPINTERVAL:1e3,className:function(){return this.getClassNames("-container")},setup:function(e){this.tree=new s,this.promiseManager=e.promiseManager||null,this.isWebInWin=e.isWebInWin||!1,this.collection=e.collection,this.tenantName=e.tenantName||"OnPremise",this._custoColumns=new p(this.collection).getCustoColumns()},buildSkeleton:async function(e,t,i,n){var s=this;if(this.additionalColumns={},!!i.find(e=>!0===e.additionalColumn)){(await _.getConfigurationColumns()).forEach(e=>{this.additionalColumns[e.dataIndex]=e})}this._fromSwitch=n,this.clear(),i&&(this.attributes=i),this.cols=[{text:v.get("DatagridColumn-Title"),dataIndex:"tree",typeRepresentation:"string",width:250,getCellKPIColor:function(e){if(!e.isHeader&&e.nodeModel&&e.nodeModel.options.color)return e.nodeModel.options.color}},{text:v.get("DatagridColumn-Title"),dataIndex:"instanceTitle",typeRepresentation:"string",icon:"flow-cascade",visibleFlag:g.getInstancesMode()},{text:v.get("DatagridColumn-Relation"),dataIndex:"relation",typeRepresentation:"string",icon:this.expandDirection.upstream&&this.expandDirection.downstream?"":"filter",width:100},{text:"Direction",dataIndex:"linkDirection",typeRepresentation:"string",visibleFlag:!1}],this._nbFixedColumn=g.getInstancesMode()?3:2;for(var o={},d=0;d<i.length;d++)if("ds6w:label"!==i[d].uri){if(i[d].uri in this._custoColumns)o={text:i[d].label,...this._custoColumns[i[d].uri]};else if(i[d].uri in this.additionalColumns)o={text:i[d].label,...this.additionalColumns[i[d].uri],typeRepresentation:"string",visibleFlag:!0};else{var u="ds6w:modified"===i[d].uri?"datetime":"string";void 0!==i[d].dataType&&(u=i[d].dataType.toLowerCase()),"real"===u?u="string":"timestamp"===u&&(u="datetime"),o={text:i[d].label,dataIndex:i[d].uri,typeRepresentation:u,alignment:"boolean"===u?"center":"near"}}this.cols.push(o)}this.cols=this.cols.map(e=>void 0===e.getCellTooltip?{...e,getCellTooltip:(e=>{var t=void 0;if(e.nodeModel&&e.nodeModel.options.grid&&e.nodeModel.options.grid.nlsObj){var i=s.collectionView.getColumnOrGroup(e.columnID),n=i.dataIndex;if("tree"===i.dataIndex&&(n="ds6w:label"),"relation"===n)t=e.nodeModel.options.grid.relation;else if(t=e.nodeModel.options.grid.nlsObj[n],"datetime"===i.typeRepresentation){t=new Intl.DateTimeFormat(g.getLang(),{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}).format(new Date(t))}}return void 0!==t?{shortHelp:t}:s.collectionView.getCellDefaultTooltip(e)}).bind(s)}:e),this.cols=this.setColumnsWidth(this.cols);var p=new r({cellHeight:38,useLastColumnWidthAutoFlag:!0});this.collectionView=new a({treeDocument:this.tree,columns:this.cols,showRowIndexFlag:!1,cellDragEnabledFlag:!0,showRowBorderFlag:!0,showColumnBorderFlag:!0,showSelectionCheckBoxesFlag:!0,columnDragEnabledFlag:!1,rowSelection:"multiple",cellSelection:"none",useDragAndDrop:!0,selectionBehavior:{unselectAllOnEmptyArea:!0,toggle:!1,canMultiSelect:!0,enableShiftSelection:!0,canInteractiveMultiselectWithCheckboxClick:!0},defaultColumnDef:{editableFlag:!1,alignment:"near"},layout:p,sortModel:[{dataIndex:"linkDirection",sort:"desc"},{dataIndex:"relation",sort:"asc"},{dataIndex:"tree",sort:"asc"}],onDelayedModelDataRequest:function(e){h.debounce(function(){this.updateAttributes(e),this.updateFiltering(e)}.bind(this),500)()}.bind(this),onContextualEvent:function(e){return this._buildContextualMenu(e).then(function(e){return e})}.bind(this)});var f=new c;f.setContentInBackgroundLayer(this.collectionView.getContent()),f.reactToPointerEventsFlag=!1,f.inject(this.container);let m=l.getPref("expandedDirection")||null;m&&this.setExpandDirection(m),this.setRootNodes(e,n,!0),this.setData(!1),this._setRowEvent(),this._setDatagridEvent(),this.collectionView.requestDelayedModelData("OnScrollEnd")},setData:function(e,t,i){var n={},s=[],o={},a=!1;s=this.collection.where({modelType:"link"}),this._fromSwitch=e,0===this.expandingModelIds.length&&(a=!0),this.tree.getAllDescendants().forEach(function(e){(0===this.expandingModelIds.length||this.expandingModelIds.indexOf(e._id)>-1)&&(n[e.id]||(n[e.id]=[]),n[e.id].push(e))}.bind(this)),this.instancesNumberByLinks={},g.getInstancesMode()||(s=this.filterLinksWOInstances(s,Object.keys(n))),s.forEach(function(e){o={...o,...this.getModelToAdd(e,n)}}.bind(this)),this.tree.prepareUpdate(),Object.keys(o).length>0&&(this._addRelationsNode(Object.keys(o),a),i++,(e||a)&&(!t||t&&i<=l.getPref("expandNLevel"))&&this.setData(e,t,i)),this.collectionView.reapplySortModel(),this.tree.pushUpdate()},createNode:function(e,t){var i,n,s={},a={},r="";if(e.nlsObj&&(e={...e,...e.nlsObj}),t&&(e={...e,...t},r=this.getDirectionIcon(t.linkDirection),Object.keys(this.instancesNumberByLinks).indexOf(t.linkId)>-1&&(e.relation=e.relation+" ("+this.instancesNumberByLinks[t.linkId]+")")),"Person"===e.type){let t=e["ds6w:identifier"];t&&(i=u.getUser3DSwymPictureURL(t))&&""!==i&&(e.type_icon_url=i,n={iconPath:e.type_icon_url,className:"dgv-user-thumbnail"})}if(n||(n={iconPath:e.type_icon_url}),a={label:e.name,icons:[{iconName:r},n],children:[],grid:e},this._fromSwitch||(a.icons[1].badges={topLeft:{iconName:"reload wux-ui-3ds-spin",fontIconSize:"1x",className:"dgv-badge-top"}}),(s=new o(a)).id=e.id,!0===e.focus){var l=this.tree.getXSO();let e={isMultisel:this.getSelectedModels().length>1,nodeId:s.id,action:"add",selected:!0};s.getAttributeValue("instanceId")&&(e.instanceId=s.getAttributeValue("instanceId")),this.dispatchEvent("ENORIPE_onRowClicked",e),l.add(s)}return s.onPostCollapse(function(e){var t=[...s.getAllDescendants({treeTraversalOrder:"postOrder"})];this._collapseNode(t,s),f.trackUsage("Collapse","AllDirectionsCtx")}.bind(this)),s.onPostExpand(function(t){var i=[],n=(this.TIMEOUT,this.LOOPINTERVAL,i=s.getChildren(),[]);this._taggerInUse||(i.forEach(function(e){e.isHidden()&&e.show()}),this.setNodeInExpandingState(s,!0),e.counts&&(n=e.counts.getRealCountAttribute("name")),this.dispatchEvent("ENORIPE_ExpandNode",[[s.id],n]),f.trackUsage("Expand","AllDirectionsCtx"))}.bind(this)),s},_isChild:function(e,t){var i=e.getChildren();if(i)for(var n=0;n<i.length;n++)if(i[n].id===t)return!0;return!1},_addRelationsNode:function(e,t){var i=!1;e.forEach(function(e){i=this.setNewChildNode(e,t),delete this.modelsToAdd[e]}.bind(this)),i&&this.dispatchEvent("ENORIPE_UpdateCollectionWithView")},_addRootNodes:function(e){var t={};this.tree.prepareUpdate(),e.forEach(function(e){g.getInstancesMode()&&e.instances&&e.instances.length>0?e.instances.forEach(function(i){let n={...e};n.instanceTitle=i["ds6w:label"],n.instanceId=i.id,t=this.createNode(n),this.tree.addRoot(t)}.bind(this)):(t=this.createNode(e),this.tree.addRoot(t))}.bind(this)),this.collectionView.reapplySortModel(),this.tree.pushUpdate()},setRootNodes:function(e,t,i){var n=[],s=[];this._fromSwitch=t,e.forEach(function(e){this.models.indexOf(e)<0&&this.models.push(e)}.bind(this)),e.forEach(function(e){var t=e._attributes;s.push(t),t.nlsObj||n.push({targetId:t.id})}.bind(this));this.collection.getNodesIds().length===e.length&&e.every(function(e){return this.collection.getNodesIds().includes(e.id)}.bind(this));this.tree.prepareUpdate(),this._addRootNodes(s),t&&this.setData(t),this.tree.pushUpdate()},setNewChildNode:function(e,t){var i=null,n=this.modelsToAdd[e],s=!1,o="collapsed",a=!1;return this.collection.get(e)&&this.collection.get(e)._attributes&&(i={...this.collection.get(e)._attributes}),i&&n.forEach(function(e){this.mustBeHidden(e)?a=!0:e.sources.forEach(function(n){this.collection.get(n.id)&&this.collection.get(n.id).get("counts");if(t&&(i.fromInit=!0),g.getInstancesMode()&&i.instances&&i.instances.length>0&&i.instances.forEach(function(t){if(e.linkId.contains(t.id)){i.instanceTitle=t["ds6w:label"],i.instanceId=t.id;let a=this.createNode(i,e);return n.addChild(a),o=this.getExpandStatus(a.getAttributeValue("counts"),a),this.expandingModelIds.indexOf(a._id)>-1&&this.expandingModelIds.splice(this.expandingModelIds.indexOf(a._id),1),void(s=!0)}}.bind(this)),!s){let t=this.createNode(i,e);n.addChild(t),o=this.getExpandStatus(t.getAttributeValue("counts"),t),this.expandingModelIds.indexOf(t._id)>-1&&this.expandingModelIds.splice(this.expandingModelIds.indexOf(t._id),1)}t&&this.setNodeInExpandingState(n),o=this.getExpandStatus(n.getAttributeValue("counts"),n),this.setNodeExpandState(n,o),this.expandingModelIds.indexOf(n._id)>-1&&this.expandingModelIds.splice(this.expandingModelIds.indexOf(n._id),1),s=!1}.bind(this))}.bind(this)),a},toggleAllInstances:function(){var e=!this.collectionView.layout.getColumnVisibleFlag("instanceTitle");this.collectionView.layout.setColumnVisibleFlag("instanceTitle",e),this._nbFixedColumn=e?3:2;var t=this.getRootModels();this.tree.empty(),this.clearTree(),this.setRootNodes(t,!0,!1)},setNodeInExpandingState:function(e,t){if(this.expandingModelIds.push(e._id),e.setState({state:"expanding"}),e.setAttribute("isExpanding",!0),e.options&&e.options.icons&&(t||!this._fromSwitch)){let t=UWA.clone(e.options.icons);t[1].badges={topLeft:{iconName:"reload wux-ui-3ds-spin",fontIconSize:"1x",className:"dgv-badge-top"}},e.updateOptions({icons:t})}},setNodeExpandState:function(e,t){var i=UWA.clone(e.options.icons);e.setState({state:t}),e.preExpandDone({state:t}),i[1].badges&&(i[1].badges.topLeft=null,e.updateOptions({icons:i}))},updateColumns:function(e){for(var t=-1,i=[],n=-1,s=-1,o=0;o<e.length;o++)"ds6w:label"!==e[o].uri&&(t=this.collectionView.layout.getColumnIndex(e[o].uri))>=0&&(n=(i=this.collectionView.layout.getVisibleOrderedColumnsIndexes()).indexOf(t)+1,s=i[o+(this._nbFixedColumn-1)],n!=o+this._nbFixedColumn&&this.collectionView.layout.moveColumn(t,s))},updateColumnIcon:function(e,t){var i;i=this.collectionView.layout.getColumnIndex(e),this.collectionView.layout.setColumnOrGroupProperties(i,{icon:t})},collapseNode:function(e,t){var i=[];this.tree.getSelectedNodes().forEach(function(n){t.indexOf(n.id)>-1&&(i=[],n.getChildren().forEach(function(t){e.indexOf(t.id)>-1&&i.push(t)}),i.length>0&&this._collapseNode(i,n))}.bind(this))},_collapseNode:function(e,t){var i=[];e.forEach(function(e){1===this.getAllNodesById(e.id).length&&i.push(e.id),e.remove(),e.getAttributeValue("linkId")&&this.linksInTree.indexOf(e.getAttributeValue("linkId"))>-1&&(this.linksInTree.splice(this.linksInTree.indexOf(e.getAttributeValue("linkId")),1),i.push(e.getAttributeValue("linkId")))}.bind(this)),t.getNumberOfVisibleChildren()>0?t.setState({state:"partiallyExpanded"}):t.setState({state:"collapsed"}),this.expandingModelIds.indexOf(t._id)>-1&&this.expandingModelIds.splice(this.expandingModelIds.indexOf(t._id),1),this.dispatchEvent("ENORIPE_CollapseNode",[[t.id],i,this.getVisibleNodes(!1)])},setExpandDirection:function(e){null!=e.upstream&&(this.expandDirection.upstream=e.upstream),null!=e.downstream&&(this.expandDirection.downstream=e.downstream)},setColumnsWidth:function(e){var t=[];return(t=l.getPref("dgvOptions"))&&(t.forEach(function(t){e.find(function(i,n){if(i.dataIndex===t.dataIndex&&t.width)return e[n].width=t.width,!0})}),l.setPrefLocally("dgvOptions",t)),e},addToSelection:function(e,t){var i=this.tree.getXSO();this.getAllNodesById(e).forEach(function(e){e.isSelected()||(t?e.getAttributeValue("instanceId")===t&&i.add(e):i.add(e))})},removeToSelection:function(e,t){var i=this.tree.getXSO();this.getAllNodesById(e).forEach(function(e){e.isSelected()&&(t?e.getAttributeValue("instanceId")===t&&i.remove(e):i.remove(e))})},updateAttributes:function(e){var t=this,i=this.getVisibleNodes(),n=[],s=[],o=[],a={},r={},l={};let d={ids:[],modelType:"AllTypes",isInstances:!0,models:{}};this.tree.prepareUpdate();for(var c=e.startNodeIndex;c<=e.endNodeIndex;c++)if(i[c]&&this.collection.get(i[c].id)){!(r=this.collection.get(i[c].id)._attributes).nlsObj&&n.indexOf(i[c].id)<0&&n.push(i[c].id),s.push(i[c].id);let e=r.instances||[];o.push(...e.map(e=>e.id));let t=i[c].options.grid.instanceId;if(t){let i=e.find(e=>e.id===t);i&&(i.nlsObj?a[i.id]=i:(d.modelType=i.type,d.ids.push(i.id),d.models[i.id]={_attributes:i}))}}Object.keys(a).forEach(e=>{const t=a[e].nlsObj;let n=i.filter(t=>{if(t.options.grid.instanceId)return t.options.grid.instanceId===e});n.length&&n.forEach(e=>{l=e.options.grid,l={...l,...t,...l.nlsObj},e.updateOptions({grid:l})})}),d.ids.length>0&&this._updateAttributesForInstances(i,d),n.length>0&&this._getNls(n).then(function(e){e.forEach(function(e){t.getAllNodesById(e).forEach(function(e){l=t.collection.get(e.id)._attributes,l={...l,...l.nlsObj},e.updateOptions({grid:l})})})}),this._updateConfigurationAttributes(i,s,o),this.tree.pushUpdate()},_updateAttributesForInstances:function(e,t){var i=this,n={},s={},o={};t.models&&(n=u.getAttributes(t.modelType),s=u._prepareDataToNls(Object.values(t.models)),u._getNlsAndProcessData(s,t.ids,t.models,t.isInstances).then(function(s){let a;s={...s,...n},Object.keys(s.nlsObj).forEach(n=>{a=i.collection.setNlsObj(n,s.nlsObj[n],t.isInstances);let r=e.filter(e=>{if(e._options.grid.instanceId)return e.options.grid.instanceId===n});r.length&&r.forEach(e=>{o=e.options.grid,o={...o,...a,...o.nlsObj},e.updateOptions({grid:o})})})}))},_updateConfigurationAttributes:function(e,t,i){if(g.getInstancesMode()){if(this.collectionView.layout._originalLeafColumns.filter(e=>"cfgEffectivty"===e.columnModule).length){require(["DS/CfgWebAppEffectivityUX/scripts/CfgEffectivityColumns"],function(n){let s={pids:t,relids:i,pairs:{}};n.updateAttributes(s,function(t){if(t.relids){let i={};s.relids.forEach(n=>{const s=t.relids[n];let o=e.filter(e=>{if(e._options.grid.instanceId)return e.options.grid.instanceId===n});o.length&&o.forEach(e=>{i=e.options.grid,i={...i,...s,...i.nlsObj},e.updateOptions({grid:i})})})}})})}}},_buildModelToAdd:function(e,t){for(var i=e.targetId,n=e.link,s={},o=null,a={sources:[]},r="",l="",d=[],c="",h=(this.tree.getAllDescendants(),0);h<t[e.sourceId].length;h++)if(o=t[e.sourceId][h],s=u.getProfileDirections(n.get("type")),e.inverseDirection&&s._from?(r=n.get("type").replace("_to","_from"),l=v[r+"_short"]||v[r]||r):(r=n.get("type"),l=v[r+"_short"]||v[r]||r),"to"===(d=r.split("_"))[d.length-1]?c="downstream":"from"===d[d.length-1]&&(c="upstream"),this._getIndexModelToAdd(i,o,n.id)<0&&!this._isInBranch(o,i,r,n)&&this.expandDirection[c])if(0===a.sources.length){a.sources.push(o);var g={relation:l,linkId:n.get("id"),linkDirection:c,linkType:r,sourceId:n.get("sourceId")};a={...a,...g}}else a.sources.push(o);return 0!=a.sources.length?a:null},_setModelToAdd:function(e,t){if(e){if(this.modelsToAdd[e]){let i=Object.values(this.modelsToAdd[e]).map(e=>e.sourceId),n=i.indexOf(t.sourceId)>-1?Object.values(this.modelsToAdd[e])[i.indexOf(t.sourceId)]:null;if("upstream"===t.linkDirection&&n&&n.relation===t.relation)return}else this.modelsToAdd[e]=[];this.modelsToAdd[e].push(t)}},_updateDirection:function(e){this.expandDirection[e]?(this.dispatchEvent("ENORIPE_HideOneDirection",e),f.trackUsage("Direction","HideDirection-"+e)):this.dispatchEvent("ENORIPE_ShowOneDirection",e),this.expandDirection[e]=!this.expandDirection[e]},updateCount:function(e,t){var i=this,n=[],s={};n=this.tree.search({match:function(e){s=UWA.clone(e.nodeModel.options.icons);let i=null;if(e.nodeModel.getParent()&&e.nodeModel.getParent().id&&e.nodeModel.getParent().getAttributeValue("isExpanding")&&(i=e.nodeModel.getParent()),t&&t.length>0){if(s[1].badges&&s[1].badges.topLeft&&(t.indexOf(e.nodeModel.id)>-1||null!=i&&t.indexOf(i.id)>-1))return!0}else if(s[1].badges&&s[1].badges.topLeft)return!0}}),this.tree.prepareUpdate(),n&&n.length>0?n.forEach(function(t){this.refreshCountNode(e,t),t.getAttributeValue("isExpanding")&&t.setAttribute("isExpanding",!1)}.bind(this)):this.tree.processDescendants({processNode:function(t){i.refreshCountNode(e,t)}}),this.tree.pushUpdate()},refreshCountNode:function(e,t){if(e.get(t.id)&&e.get(t.id).get("counts")){let i=UWA.clone(t.options.icons);if(i[1].badges&&i[1].badges.topLeft){let i=e.get(t.id).get("counts"),n=this.getExpandStatus(i,t);this.setNodeExpandState(t,n),this.expandingModelIds.indexOf(t._id)>-1&&this.expandingModelIds.splice(this.expandingModelIds.indexOf(t._id),1)}}},removeSelectedNodes:function(){return this.tree.getSelectedNodes().forEach(function(e){var t=[...e.getChildren()];t.length>0&&this.collapseNode(t,[e]),e.getParent()&&(e.getParent().removeChild(e),this.linksInTree.indexOf(e.getAttributeValue("linkId"))>-1&&this.linksInTree.splice(this.linksInTree.indexOf(e.getAttributeValue("linkId")),1))}.bind(this)),this},filterLinksWOInstances:function(e,t){if(e&&e.length>0){var i=[],n="",s=-1;return e=e.filter(function(t){if(s++,t.get("instanceTargetId")){n=n.replace(t.get("instanceTargetId"),t.get("targetId"));let o=i.findIndex(function(e){return e.sourceId===t.get("sourceId")&&e.targetId===t.get("targetId")&&e.type===t.get("type")&&"in"!=t.get("direction")});if(o<0)return i.push({sourceId:t.get("sourceId"),targetId:t.get("targetId"),type:t.get("type"),linkId:t.id}),!0;{let n=e.findIndex(function(e){return e.get("sourceId")===t.get("sourceId")&&e.get("targetId")===t.get("targetId")&&e.get("type")===t.get("type")&&"in"!=t.get("direction")});return n>-1&&n<s&&(Object.keys(this.instancesNumberByLinks).indexOf(i[o].linkId)<0?this.instancesNumberByLinks[i[o].linkId]=2:this.instancesNumberByLinks[i[o].linkId]=this.instancesNumberByLinks[i[o].linkId]+1),!1}}return!0}.bind(this))}return[]},filter:function(e){var t=[],i=[];this.endFilter(),this._taggerInUse=!0,this._filterOn=!0,this.tree.prepareUpdate(),e.matchingIDs.forEach(n=>{this.getAllNodesById(n).forEach(n=>{e.filteredLinks&&e.filteredLinks.length>0?e.filteredLinks.indexOf(n.getAttributeValue("linkId"))>-1&&(i.push(n),t.push(n)):(i.push(n),t.push(n))})}),t.forEach(e=>{e.getParents().forEach(e=>{0===i.filter(t=>t._rowID===e._rowID).length&&i.push(e)})}),this.tree.search({match:e=>{let t=e.nodeModel;if(i.indexOf(t)<0&&"collapsed"!=t.getParent().getState()){var n="partiallyExpanded"===t.getParent().getState();return t.setAttribute("filter",!0),t.hide(),0===t.getParent().getNumberOfVisibleChildren()&&n&&t.getParent().setState({state:"collapsed"}),!0}}}),this.tree.pushUpdate(),t.forEach(e=>{e.getParents().forEach(e=>{if(0===t.filter(t=>t._rowID===e._rowID).length){e.setAttribute("filterAndGrayed",!0);let t=this.collectionView.layout.getCellIDFromCoordinates({rowID:e._rowID,columnID:0});if(t){let e=this.collectionView.getCellInfosAt(t);e.cellView=this.collectionView._getViewAt(t),e.cellView&&e.cellView.getContent().parentNode.addClassName("filterGrayed")}}})});const n=t.map(e=>e.id);return this._taggerInUse=!1,n},endFilter:function(){this._taggerInUse=!0,this._filterOn=!1,this.tree.prepareUpdate(),this.tree.getAllDescendants().forEach(function(e){if(e.getAttributeValue("filterAndGrayed")){e.setAttribute("filterAndGrayed",!1);let t=this.collectionView.layout.getCellIDFromCoordinates({rowID:e._rowID,columnID:0});if(t){let e=this.collectionView.getCellInfosAt(t);e.cellView=this.collectionView._getViewAt(t),e.cellView&&e.cellView.getContent().parentNode.classList.remove("filterGrayed")}}}.bind(this)),this.tree.getAllDescendants().forEach(function(e){e.getAttributeValue("filter")&&(e.setAttribute("filter",!1),e.show(),e.getParent().isExpanded()||e.reverseExpand())}.bind(this)),this.tree.pushUpdate(),this._taggerInUse=!1},updateFiltering:function(e){var t=this.getVisibleNodes();this.tree.prepareUpdate();for(var i=e.startNodeIndex;i<=e.endNodeIndex;i++)if(t[i]){let e=t[i],n=this.collectionView.layout.getCellIDFromCoordinates({rowID:e._rowID,columnID:0});if(n){let t=this.collectionView.getCellInfosAt(n);t.cellView=this.collectionView._getViewAt(n),t.cellView&&(t.cellView.getContent().parentNode.classList.contains("filterGrayed")&&!e.getAttributeValue("filterAndGrayed")?t.cellView.getContent().parentNode.classList.remove("filterGrayed"):!t.cellView.getContent().parentNode.classList.contains("filterGrayed")&&e.getAttributeValue("filterAndGrayed")&&t.cellView&&t.cellView.getContent().parentNode.addClassName("filterGrayed"))}}this.tree.pushUpdate()},colorize:function(e){var t={};this.tree.prepareUpdate(),e.matchingIDs&&e.matchingIDs.forEach(function(e){this.getAllNodesById(e.id).forEach(function(t){t.updateOptions({color:e.color})}.bind(this))}.bind(this)),e.filteredLinks&&e.filteredLinks.colorMap&&(t=e.filteredLinks.colorMap,this.tree.search({match:function(e){Object.keys(t).indexOf(e.nodeModel.getAttributeValue("linkId"))>-1&&e.nodeModel.updateOptions({color:t[e.nodeModel.getAttributeValue("linkId")]})}})),this.tree.pushUpdate()},unColorize:function(){this.tree.prepareUpdate(),this.tree.getAllDescendants().forEach(function(e){e.updateOptions({color:null})}.bind(this)),this.tree.pushUpdate()},_setRowEvent:function(){var e=this,t={},i=null,n=!1;(i=this.tree.getXSO()).onPostAdd(function(s){s.forEach(function(s){g.getInstancesMode()||e.getAllNodesById(s.getAttributeValue("id")).forEach(function(e){i.add(e)}),n=e.getSelectedModels().length>1,t={isMultisel:n,nodeId:s.id,action:"add",selected:!0},s.getAttributeValue("instanceId")&&(t.instanceId=s.getAttributeValue("instanceId")),e.dispatchEvent("ENORIPE_onRowClicked",t)})}),i.onPostRemove(function(n){n.forEach(function(n){e.collection.get(n.id)&&(g.getInstancesMode()||e.getAllNodesById(n.getAttributeValue("id")).forEach(function(e){i.remove(e)}),t={isMultisel:!0,nodeId:n.id,action:"remove",selected:!1},n.getAttributeValue("instanceId")&&(t.instanceId=n.getAttributeValue("instanceId")),e.dispatchEvent("ENORIPE_onRowClicked",t))})})},_setDatagridEvent:function(){var e=this;this.collectionView.onDragStartCell=function(t,i){var n=[],s=[];i.draggedNodes.forEach(function(t){s.indexOf(t.getAttributeValue("id"))<0&&(s.push(t.getAttributeValue("id")),n.push({serviceId:"3DSpace",objectId:t.getAttributeValue("id"),objectType:t.getAttributeValue("type"),displayName:t.getAttributeValue("name"),envId:e.tenantName}))});var o={protocol:"3DXContent",version:"1.0",source:"ENORIPE_AP",data:{items:n}};e.dispatchEvent("ENORIPE_dragElement",[t,o])},this.collectionView.addEventListener("userPreferencesChange",function(e){for(var t=this.collectionView.layout.getOrderedColumnsIndexes(),i=[],n=0;n<t.length;n++){let e=this.collectionView.getColumnOrGroup(t[n]);e.width&&i.push({width:e.width,dataIndex:e.dataIndex})}l.setPrefEverywhere("dgvOptions",i)}.bind(this))},_buildContextualMenu:function(e){var i=this,n=[],s={},o={},a=null;if(e.cellInfos&&e.cellInfos.nodeModel&&e.cellInfos.rowID>-1&&(a=e.cellInfos.nodeModel,this.rightClickModel=a),a){var r=this.tree.getXSO();this.getAllNodesById(a.id).forEach(function(e){e.isSelected()||(r.empty(),r.add(e))})}return new t.Promise(function(t,r){this.isWebInWin?a&&(this.dispatchEvent("onRowRightClicked",[{id:a.id,context:"DataGridView"}]),t([])):a&&e.cellInfos&&e.cellInfos.rowID>-1&&(a.getAttributeValue("type")&&a.getAttributeValue("type").contains("Document")&&n.push({type:"PushItem",title:v.get("Download"),icon:{iconName:"download",fontIconFamily:1},action:{callback:function(){i.dispatchEvent("ENORIPE_DownloadDocument",[a.id,a.getAttributeValue("name")])}},state:"enabled"}),this.getExpandCollapseCtxMenu(a,!1).then(function(e){n=[...n,...e]}.bind(this)).finally(function(){s=u.getContentForOpenWith(a.id,a.getAttributeValue("type"),a.getAttributeValue("relTypesTaxonomies")),(o=(new d).set3DXContent(s,!0)).retrieveCompatibleApps(function(e){if(e&&e.length>0){var i=[];if(e.forEach(function(e){i.push({type:"PushItem",title:e.text,fonticon:e.fonticon&&e.fonticon.length>0?{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon,family:WUXManagedFontIcons.Font3DS}:void 0,icon:e.icon?e.icon:"",action:{callback:e.handler}})}),i.length>0){var s={name:"OpenWith",type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+o.DROPDOWN_CONF.fonticon},title:o.DROPDOWN_CONF.text,submenu:i};n.push(s)}}t(n)})})),e.cellInfos&&-1===e.cellInfos.rowID&&(n.push({type:"PushItem",title:this.expandDirection.upstream?v.get("HideUpstream"):v.get("ShowUpstream"),icon:{iconName:this.expandDirection.upstream?"left-minus":"left-add",fontIconFamily:1},action:{callback:function(){this._updateDirection("upstream")}.bind(this)}}),n.push({type:"PushItem",title:this.expandDirection.downstream?v.get("HideDownstream"):v.get("ShowDownstream"),icon:{iconName:this.expandDirection.downstream?"right-minus":"right-add",fontIconFamily:1},action:{callback:function(){this._updateDirection("downstream")}.bind(this)}}),t(n))}.bind(this))},getExpandCollapseCtxMenu:function(e,i){var n=[],s=[],o=[],a={};return new t.Promise(function(t,r){if("expanded"!==e.getState()&&"partiallyExpanded"!==e.getState()||((a={model:e,upstreamChildren:this.getChildrenInOneDirection(e,"upstream"),downstreamChildren:this.getChildrenInOneDirection(e,"downstream")}).upstreamChildren.length>0&&(a.direction="upstream",o=this._getCollapseSubMenu(a,i),n.push(o)),a.downstreamChildren.length>0&&(a.direction="downstream",o=this._getCollapseSubMenu(a,i),n.push(o)),"expanded"===e.getState()&&t(n)),"collapsed"===e.getState()||"partiallyExpanded"===e.getState()){var l={};a={model:e},e.getAttributeValue("counts")?((l=this._getCurrentCounts(e.getAttributeValue("counts"),e)).upstreamCounts.length>0&&(a.direction="upstream",s=this._getExpandSubMenu(a,l,i),n.push(s)),l.downstreamCounts.length>0&&(a.direction="downstream",s=this._getExpandSubMenu(a,l,i),n.push(s)),t(n)):r()}r()}.bind(this))},getChildrenInOneDirection:function(e,t){var i=[];return e.getChildren().forEach(function(e){e.isHidden()||e.getAttributeValue("linkDirection")===t&&i.push(e)}),i},_getExpandSubMenu:function(e,t,i){var n={},s=[],o="",a=0,r={},l={},d=[],c=[];if("upstream"===e.direction?(o="in",d=t.upstreamCounts,c=t.downstreamCounts||[]):(o="out",d=t.downstreamCounts,c=t.upstreamCounts||[]),d.forEach(function(t){(l={}).title=t.get("count")+" "+t.get("relationName"),l.callback=function(){this.setNodeInExpandingState(e.model),d.length>1?this.contextualExpandStatus="partiallyExpanded":this.contextualExpandStatus="expanded",this.dispatchEvent("ENORIPE_ExpandNode",[[e.model.id],[t.get("name")],o]),f.trackUsage("Expand","OneRelationCtx")}.bind(this),t.get("count")>0&&(s.push(this._getContextualObject(i,l)),a+=parseInt(t.get("count")))}.bind(this)),a>0){switch(e.direction){case"upstream":r.icon=i?m.getWebappsAssetUrl("SNNavigationMap","icons/upstream_arrow.png"):"left-add",r.title=v.get("SNNavigationMap.ExpandUpstream.Title")+" ("+a+")";break;case"downstream":r.icon=i?m.getWebappsAssetUrl("SNNavigationMap","icons/downstream_arrow.png"):"right-add",r.title=v.get("SNNavigationMap.ExpandDownstream.Title")+" ("+a+")";break;default:return n}r.callback=function(){this.setNodeInExpandingState(e.model),c.length>0?this.contextualExpandStatus="partiallyExpanded":this.contextualExpandStatus="expanded",this.dispatchEvent("ENORIPE_ExpandNode",[[e.model.id],[],o]),f.trackUsage("Expand","OneDirectionCtx")}.bind(this),i&&s.push(this._getContextualObject(i,{title:v.get("SNNavigationMap.ExpandAll.Title")+" ("+a+")",callback:r.callback})),n=this._getContextualObject(i,r,s)}return n},_getCollapseSubMenu:function(e,t){var i,n={},s=[],o={},a=[],r={},l=[];switch(i=e.model,e.direction){case"upstream":r.icon=t?m.getWebappsAssetUrl("SNNavigationMap","icons/upstream_arrow.png"):"left-minus",a=e.upstreamChildren,e.downstreamChildren,r.title=v.get("SNNavigationMap.CollapseUpstream.Title")+" ("+a.length+")";break;case"downstream":r.icon=t?m.getWebappsAssetUrl("SNNavigationMap","icons/downstream_arrow.png"):"right-minus",a=e.downstreamChildren,e.upstreamChildren,r.title=v.get("SNNavigationMap.CollapseDownstream.Title")+" ("+a.length+")";break;default:return n}return l=this.getCountsFromNodes(a),Object.keys(l).forEach(function(e){(o={}).title=l[e].length+" "+e,o.callback=function(){var t=[];a.forEach(function(i){l[e].indexOf(i.id)>-1&&t.push(i)}.bind(this)),this._collapseNode(t,i),f.trackUsage("Collapse","OneRelationCtx")}.bind(this),s.push(this._getContextualObject(t,o))}.bind(this)),r.callback=function(){this._collapseNode(a,i),f.trackUsage("Collapse","OneDirectionCtx")}.bind(this),t&&s.push(this._getContextualObject(t,{title:v.get("SNNavigationMap.CollapseAll.Title")+" ("+a.length+")",callback:r.callback})),n=this._getContextualObject(t,r,s)},_getContextualObject:function(e,t,i){var n={};return t.title&&(e?(n={text:t.title,handler:t.callback},t.icon&&(n.icon=t.icon),i&&i.length>0&&(n.items=i)):(n={type:"PushItem",title:t.title,action:{callback:t.callback}},t.icon&&(n.icon={iconName:t.icon,fontIconFamily:1}),i&&i.length>0&&(n.submenu=i))),n},getDirectionIcon:function(e){var t="";switch(e){case"upstream":t="left";break;case"downstream":t="right";break;default:t=""}return t},getOneDirectionLink:function(e){var t=[],i=!1;return this.tree.getAllDescendants().forEach(function(n){i=!1,t.indexOf(n.id)<0&&n.getAttributeValue("linkDirection")===e&&(this.getAllNodesById(n.id).forEach(function(t){t.getAttributeValue("linkDirection")!=e&&(i=!0)}),i||t.push(n.id))}.bind(this)),t},getRightClickModel:function(){return this.rightClickModel},getCountsFromNodes:function(e){var t={},i="";return e.forEach(function(e){e.isHidden()||(i=e.getAttributeValue("relation"),Object.keys(t).indexOf(i)<0?(t[i]=[],t[i].push(e.id)):t[i].push(e.id))}),t},getAllNodesByLabel:function(e){return this.tree.search({match:function(t){if(e&&-1!==t.nodeModel.getLabel().indexOf(e))return!0}})},getAllNodesById:function(e){return this.tree.search({match:function(t){if(e&&t.nodeModel.id===e)return!0}})},getSelectedModels:function(){var e=[];return this.tree.getSelectedNodes().forEach(function(t){this.collection.get(t.id)&&e.push(this.collection.get(t.id))}.bind(this)),e},getRootModels:function(){return[...this.models]},getRootModelsIds:function(){return this.models.map(function(e){return e.id})},getVisibleNodes:function(e){var t=[];return this.tree.processDescendants({onlyVisibleNodes:!0,processNode:function(i){e&&t.indexOf(i.nodeModel.id)<0?t.push(i.nodeModel.id):!e&&t.indexOf(i.nodeModel)<0&&t.push(i.nodeModel)}}),t},getAllNodes:function(e){var t=[];return this.tree.processDescendants({onlyVisibleNodes:!1,processNode:function(i){t.indexOf(i.nodeModel.id)<0&&(e?t.push(i.nodeModel.id):t.push(i.nodeModel))}}),t},_getCurrentCounts:function(e,t){var i=[],n=0,s="",o={};return o={downstreamCounts:[],upstreamCounts:[],counts:[],childrenNumber:0},"collapsed"!=t.getState()&&(i=this.getCountsFromNodes(t.getChildren())),e.getAllCounts().forEach(function(e){n=e.get("count"),s=e.get("relationName");let a=e.clone();t.getAttributeValue("linkType")&&u.getReverseRelations(t.getAttributeValue("linkType"))===e.get("name")&&n--,Object.keys(i).indexOf(s)>-1&&(n-=i[s].length),n>0&&(a.set(e,n),"out"===e.get("direction")?o.downstreamCounts.push(a):o.upstreamCounts.push(a)),o.childrenNumber+=parseInt(n)}),o.counts=[...o.downstreamCounts,...o.upstreamCounts],o.childrenNumber+=t.getNumberOfVisibleChildren(),o},_getIndexModelToAdd:function(e,t,i){if(this.modelsToAdd[e])for(var n=0;n<this.modelsToAdd[e].length;n++){var s=this.modelsToAdd[e][n];if(s.sources.indexOf(t)>-1&&s.linkId===i)return n}return-1},_isInBranch:function(e,t,i,n){var s=[],o=[];if(e){if(e.getRoot().id===t||e.id===t)return!0;if(s=e.getChildren())for(var a=0;a<s.length;a++)if(s[a].id===t&&s[a].getAttributeValue("linkType")===i)return!0;o=e.getParents(!0);for(a=0;a<o.length;a++)if(o[a].id===t){if(!o[a].getAttributeValue("instanceId")||!n.get("instanceTargetId"))return!0;if(n.get("instanceTargetId")===o[a].getAttributeValue("instanceId"))return!0}}return!1},getExpandStatus:function(e,t){var i=e.getCountsNumber(e.getAllCounts());if(t.getAttributeValue("isExpanding")){if(this.contextualExpandStatus){let e=this.contextualExpandStatus;return this.contextualExpandStatus=null,e}return 0===t.getChildren().length?"noChildren":"expanded"}return 0===i?"noChildren":"collapsed"},isInitWithNodes:function(){var e=this.getRootModels();return!!(e&&e.length>0)},mustBeHidden:function(e){return!(!e||!e.linkDirection||!1!==this.expandDirection[e.linkDirection])},getModelToAdd:function(e,t){var i=Object.keys(t),n={};return i.indexOf(e.get("source").id)>-1&&(n={...n,...this.getModelByDirection(e,t,!1)}),i.indexOf(e.get("target").id)>-1&&(n={...n,...this.getModelByDirection(e,t,!0)}),n},getModelByDirection:function(e,t,i){var n={},s={};if(e){n={inverseDirection:i,link:e},n=i?{...n,...{targetId:e.get("source").id,sourceId:e.get("target").id}}:{...n,...{targetId:e.get("target").id,sourceId:e.get("source").id}};var o=this._buildModelToAdd(n,t);o&&(this.linksInTree.push(e.id),s[n.targetId]=o,this._setModelToAdd(n.targetId,o))}return s},exportAsCSV:function(){var e,t=g.getExportLimit()&&g.getExportLimit()>0?g.getExportLimit():5e3;if((e=this.getVisibleNodes().length)<=t){var i=this.collectionView.getAsCSV({addLevelInformation:!0});u.downloadfile(i,"Relations_"+(new Date).toString().split(" ").splice(1,4).join(" ")+".csv","text/csv"),f.trackMultiUsage("export","export",[e]),this.dispatchEvent("ENORIPE_ExportMsg",{success:!0,nbLines:e})}else f.trackMultiUsage("export","export",[-1]),this.dispatchEvent("ENORIPE_ExportMsg",{success:!1,nbLines:e})},_getNls:function(e){var i,n=this,s={};return e.forEach(function(e){n.collection.get(e)&&(s[e]=n.collection.get(e))}),i=u._prepareDataToNls(Object.values(s)),new t.Promise(function(t,o){u._getNlsAndProcessData(i,e,s,!1).then(function(i){for(var s=0;s<Object.keys(i.nlsObj).length;s++)n.collection.setNlsObj(Object.keys(i.nlsObj)[s],Object.values(i.nlsObj)[s]);t(e)},function(){console.log("err while fetching attributes"),t()})})},updateColumnsHeaderNls:function(e){let t={};e.EnoripeColumns.attributes.forEach(e=>{t[e.uri]=e.label}),this.cols.forEach(e=>{void 0!==t[e.dataIndex]&&(e.text=t[e.dataIndex])})},clear:function(){this.cols=[],this.models=[],this.attributes=[],this.modelsToAdd={},this.tree=new s,this.linksInTree=[],this.expandingModelIds=[],this.container.innerHTML="",this.rightClickModel=null},clearTree:function(){this.models=[],this.modelsToAdd={},this.linksInTree=[],this.expandingModelIds=[]}})}),define("DS/SNNavigationMap/views/DisplayOptionsView",["UWA/Core","UWA/Class/View","DS/Controls/ButtonGroup","DS/Controls/Toggle","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a){"use strict";return t.extend({name:"DisplayOptions",className:function(){return this.getClassNames("-container")},setup:function(t){this.displayOptions=new e.createElement("div",{class:"display-options-view"}),this.currentChanges=[],this.isCancel=!1},render:function(){var e=this;e.displayOptionsBtnGroup=e._getDisplayOptionsBtnGroup(),e._displayOptionsBtnGroupValue=e.displayOptionsBtnGroup.value,e.displayOptionsBtnGroup.addEventListener("change",t=>{if(!e.isCancel){let t=this._displayOptionsBtnGroupValue,i=this.displayOptionsBtnGroup.value,n=new Set(t.concat(i)),s=Array.from(n).filter(e=>!t.includes(e)||!i.includes(e));e.dispatchEvent("CustomizeAllView_updateSaveButton",{tabName:"DisplayOptions",areThereChanges:s.length>0}),e.currentChanges=s}}),e.displayOptionsBtnGroup.inject(e.container)},save:function(){let e={};for(let i=0;i<this.currentChanges.length;i++){var t=this.displayOptionsBtnGroup.getButtonFromValue(this.currentChanges[i]).checkFlag;e[this.currentChanges[i]]=t,t&&o.trackUsage("DisplayOptions",this.currentChanges[i])}this.dispatchEvent("CustomizeAllView_updateDisplayOptions",e),this._displayOptionsBtnGroupValue=this.displayOptionsBtnGroup.value},cancel:function(){var e;this.isCancel=!0;for(let t=0;t<this.displayOptionsBtnGroup.getButtonCount();t++)(e=this.displayOptionsBtnGroup.getButton(t)).checkFlag=e.refreshCheckFlag();this.isCancel=!1},_getDisplayOptionsBtnGroup:function(){var e=new i({type:"checkbox",touchMode:!0});return e.addChild(this._createToggle("showThumbnails2D",()=>"thumbnailsMode"===s.getThumbnailsMode())),e.addChild(this._createToggle("showInstances",()=>s.getInstancesMode())),e.addChild(this._createToggle("showPublications",()=>s.getPublicationsMode())),e.addChild(this._createToggle("showGhost",()=>s.getGhostMode())),e.addChild(this._createToggle("recumputeLayout",()=>"recompute"===s.getLayoutMode())),e},_createToggle:function(e,t){let i=new n({type:"checkbox",label:a.get(e),value:e,checkFlag:t()});return i.refreshCheckFlag=t,i}})}),define("DS/SNNavigationMap/views/NavigationApp",["UWA/Core","UWA/Class","UWA/Class/View","UWA/Class/Model","DS/UIKIT/Spinner","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal","DS/SNNavigationMap/views/SplittedDropView","DS/UIKIT/Native/Dropdown","DS/SNNavigationMap/utils/SNNavigationServices","DS/SNNavigationMap/views/SNMapSelector","DS/SNNavigationMap/models/CountOnNode","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Alert","DS/UIKIT/Mask","DS/UIKIT/SuperModal","DS/UIKIT/Modal","DS/UIKIT/Form","DS/UIKIT/Input/Button","DS/Controls/Button","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/PreferencesUtils","DS/SNNavigationMap/utils/ProbesUtils","DS/SNNavigationMap/views/D3MapView","DS/SNNavigationMap/views/DataGridView","DS/SNNavigationMap/views/ListView","DS/SNNavigationMap/views/ToolBarView","DS/SNNavigationMap/views/NavigationPager","DS/SNNavigationMap/utils/TaggerServices","DS/SNNavigationMap/utils/CommonUtils","DS/SNNavigationMap/utils/RelationsServices","DS/SNNavigationMap/views/popups/ExpandNLevel","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/TransientWidget/TransientWidget","DS/SNNavigationMap/utils/SearchUtils","DS/WebappsUtils/WebappsUtils","css!DS/SNNavigationMap/SNNavigationMap"],function(e,t,i,n,s,o,a,r,l,d,c,h,u,g,p,f,m,v,_,S,b,N,w,C,I,E,y,D,M,P,O,x,T,A,R,V,k){"use strict";return i.extend({name:"navigation-app-view",rootModel:null,_isFiltered:!1,_isSearched:!1,_currentlyFilteredNodes:[],_currentlySearchedNodes:[],_lastFilterData:{},_isEmpty:!0,_isWebInWin:c.isWebInWin(),_theContextualMenu:null,_theContextualMenuTarget:{},_infoPanelCommandClick:!1,_isPreviewPanelOpen:!1,_appliedTags:0,_currentLayout:"linearGraph",_currentView:null,className:function(){return this.getClassNames("-container")},setup:function(t){this._autoNavMode=t.autoNavMode,this._layoutUtils=t.layoutUtils,this._countLimit=t.countLimit,this._lang=t.lang,this._isEmpty=t.isEmpty,this._widgetId=t.widgetId,this._widget=t.widget,this._platformId=t.platformId,this._lastRootID=t.lastRootID,this._debug=t.debugMode||!1,this._errorOnInit=t.errorOnInit,this._addinMode=t.addinMode,this._separator=t.separator,this._nameLabel=t.nameLabel,this._detailLabel1=t.detailLabel1,this._detailLabel2=t.detailLabel2,this.collection=t.collection?t.collection:null,this._PM=t.promiseManager,this._preSelectedObjectIds=t.preSelectedObjectIds,this._inAppOptions=t.inAppOptions,N.getLayoutType()&&(this._currentLayout=N.getLayoutType(),C.trackUsage("LayoutType","InitLT-"+this._currentLayout)),"catiav5"!==this._addinMode&&"solidworks"!==this._addinMode||this.container.addClassName("addin-mode-ripe"),this._spinner=(new s).inject(e.createElement("div",{styles:{position:"absolute","z-index":"201",top:"5px"}}).inject(this.container,"top")),this.showSpinner(),this._notifManager=o,a.setNotificationManager(this._notifManager),this._errorOnInit&&(this._errorOnInit.forEach(function(e){let t="";t=e.options?r.replace(r.get(e.errorMsg),{type:r.get(e.options.type),label:e.options.displayName}):r.get(e.errorMsg),this._showNotif({level:"error",msg:t})}.bind(this)),this._errorOnInit=!1),this._updateNLSForSavedAttrs(),this._initCollection(this.collection),this._initialize()},_initialize:function(){var t=this;this.setContainerEvents(),this._dropInvite=e.createElement("div",{class:"drop-invite",html:[{tag:"span",class:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-drag-drop"},{tag:"p",class:"drop-content-here",html:r.get("dropHere")}]}).inject(this.container),this._isWebInWin||(e.createElement("p",{class:"drop-invite-or",html:r.get("dropInviteOr")}).inject(this._dropInvite),this._openContentButton=new b({label:r.get("dropInviteOpenContent"),displayStyle:"normal",emphasize:"primary"}).inject(this._dropInvite),this._openContentButton.addEventListener("click",function(e){void 0===this._searchUtils&&(this._searchUtils=new V({debug:!1,isWebInWin:this._isWebInWin})),this._searchUtils.inAppSearch({showApplyButton:!1,title:r.get("inAppSearchOpenContentInRelations"),fts_value:"",search_criteria_to_display:"",callback:function(e){var i=e;t._handleDrop("add",i)}})}.bind(this))),this._dropInvite.hide(),this._dropZone=(new l).inject(this.container),this.listenTo(this._dropZone,"ENORIPE_drop",this._handleDrop),this.listenTo(this._dropZone,"ENORIPE_dropNotSupported",function(){t._showNotif({level:"error",msg:r.get("dropNotSupported")})}),this.listenTo(this._dropZone,"ENORIPE_SDV_hide",this.setContainerEvents),window.addEventListener("keyup",this._onKeyUp.bind(this)),this._isEmpty?this._initEmptyMap():this._initSubViews(),this._initTagger()},_initCollection:function(e){e&&e!=this.collection&&(this.collection=e,this.listenTo(this.collection,"onSync",this.render.bind(this)))},_initSubViews:function(){this.showSpinner();var e=this.collection.getFocusedNode(),t=this;if(this.mapView||(this.mapView=new I({layoutUtils:this._layoutUtils,layoutAxis:this._layoutAxis,layoutDirection:this._layoutDirection,countLimit:this._countLimit,nameLabel:this._nameLabel,separator:this._separator,selector:h,dropZone:this._dropZone,spinner:this._spinner}),this.mapView.setSVGDimensions(this.ctnHeight,this.ctnWidth),this.listenTo(this.mapView,"onNodeClicked",this.nodeClicked),this.listenTo(this.mapView,"onNodeRightClicked",function(e){var t=e.id;t&&(h.isSelected(t)||(this.clearSelection("MapView"),this._manageSelection({models:t,sAction:"add",origin:"MapView"}))),this._OnRightClick(e)}),this.listenTo(this.mapView,"ENORIPE_splitCount",this.splitCount),this.listenTo(this.mapView,"ENORIPE_Collapse",this.collapseNode),this.listenTo(this.mapView,"ENORIPE_dragEnd",this._hideDropZones),this.listenTo(this.mapView,"ENORIPE_showNotif",this._showNotif),this.listenTo(this.mapView,"ENORIPE_MultiSel_Object",function(e){this._manageSelection(e)}.bind(this)),this.listenTo(this.mapView,"ENORIPE_ReorderColumn",this._reorderColumn),this.listenTo(this.mapView,"ENORIPE_downloadDocument",this._handleDownload),this.listenTo(this.mapView,"ENORIPE_clearSelection",this.clearSelection),this.listenTo(this.mapView,"ENORIPE_Drop",this._handleDrop),this.listenTo(this.mapView,"ENORIPE_clickListInstance",this._clickListInstance),this.listenTo(this.mapView,"ENORIPE_clickMoreInstance",this._clickMoreInstance),this.listenTo(this.mapView,"ENORIPE_toggleInstance",this.toggleInstance),this.listenTo(this.mapView,"ENORIPE_dragElement",this.dragElement),this.listenTo(this.mapView,"ENORIPE_ShowPreview",this._showPreview),this.listenTo(this.mapView,"ENORIPE_HandlePathPanel",function(e){if(e){var i=t.collection.get(e);i&&("ENOStrRefinementSpecification"===i.get("type")&&this.collection.filter(function(e){"link"===e.get("modelType")&&(e.get("source").id===i.get("id")?i._attributes.linked=t.collection.get(e.get("target").id):e.get("target").id===i.get("id")&&(i._attributes.linked=t.collection.get(e.get("source").id)))}),t.pathPanel.addNodes(i))}}),this.listenTo(this.mapView,"removefocus",function(e){if(e){var i=t.collection.get(e);i&&i.set("focus",!1)}}),this.listenTo(this.mapView,"ENORIPE_GetNlsAttrInfo",this.updateMapViewAttributesNls.bind(this)),this.listenTo(this.mapView,"ENORIPE_UpdateD3Map",this._updateCollection),this.mapView.inject(this.container),this._currentView=this.mapView),this.dataGridView?this.dataGridView.clear():(this.dataGridView=new E({promiseManager:this._PM,isWebInWin:this._isWebInWin,collection:this.collection,tenantName:N.getCurrentTenantName()||"OnPremise"},this.collection),this.dataGridView.inject(this.container),this.dataGridView.hide(),this.listenTo(this.dataGridView,"handleServerErrorMsgs",this.handleServerErrorMsgs),this.listenTo(this.dataGridView,"ENORIPE_CollapseNode",this.collapseNodeOnDatagrid),this.listenTo(this.dataGridView,"ENORIPE_ExpandNode",this.splitCount),this.listenTo(this.dataGridView,"ENORIPE_DownloadDocument",this._handleDownload),this.listenTo(this.dataGridView,"onRowRightClicked",this._OnRightClick),this.listenTo(this.dataGridView,"ENORIPE_onRowClicked",function(e){e.nodeId&&e.action&&(N.getInstancesMode()&&e.instanceId?this.toggleInstance(e):this._manageSelection({models:e.nodeId,sAction:e.action,origin:"DataGridView"}))}.bind(this)),this.listenTo(this.dataGridView,"ENORIPE_dragElement",this.dragElement),this.listenTo(this.dataGridView,"ENORIPE_HideOneDirection",function(e){this.hideOneDirection(e)}.bind(this)),this.listenTo(this.dataGridView,"ENORIPE_ShowOneDirection",function(e){this.dispatchEvent("ENORIPE_ShowOneDirection",[e,!0])}.bind(this)),this.listenTo(this.dataGridView,"ENORIPE_UpdateCollectionWithView",this._updateCollectionWithView),this.listenTo(this.dataGridView,"ENORIPE_ExportMsg",function(e){this.exportMsg(e)}.bind(this))),!this.listView){this.listView=new y({model:e,widgetId:this._widgetId,isWebInWin:this._isWebInWin}),this.listenTo(this.listView,"ENORIPE_handleErrorMsgs",this.handleServerErrorMsgs),this.listenTo(this.listView,"ENORIPE_CloseListView",this.toggleInformationsPanel),this.listenTo(this.listView,"ENORIPE_ResizeListViewPanel",function(e){this.dispatchEvent("ENORIPE_ResizeListViewPanel",e)}.bind(this)),t.listenTo(t.listView,"ENORIPE_extractNode",function(e){t._extractNode(e)}),t.listenTo(t.listView,"ENORIPE_DownloadDocument",this._handleDownload);let i=this.container;this.listView.inject(i)}this._toolBarView?this._toolBarView.showAllToolbar():this.setUpToolBar(D);try{N.getOption("inAppMode")&&this._setupInAppView()}catch(e){console.log("inAppsError--"+e)}N.getInformationPanelVisibility()!=this.listView.isVisible&&this.toggleInformationsPanel(),this.expandNLevelView||(this.expandNLevelView=new T({widgetId:this._widgetId}),this.listenTo(this.expandNLevelView,"ENORIPE_fullImport",function(e){e&&e.sessionId&&this.collection.fullImport(e.sessionId)}.bind(this)));var i={ctx:this,collection:this.collection,platformId:this._platformId,widgetId:this._widgetId};h.initialize(i),!0===this._setFirstFocusOnCompass&&(this._setFirstFocusOnCompass=!1),!this._isEmpty&&this._dropInvite&&this._dropInvite.hide(),this._isEmpty||this.dispatchEvent("ENORIPE_HideHomePage")},_setupInAppView:function(){var t=this;if(!this._inAppView){var i,n,s,o=e.createElement("div",{class:"enoripe-inAppContainer"}).inject(this.container),a=new S({value:r.get("inAppOK"),className:"primary enoripe-inAppOK"}).inject(o),l=new S({value:r.get("inAppCancel"),className:"default enoripe-inAppCancel"}).inject(o);this._inAppOptions&&this._inAppOptions.localUID&&(i="ENORIPE-InApp-"+this._inAppOptions.localUID,n=i+"/onOK",s=i+"/onCancel"),a.addEvent("onClick",function(){var e=[];t.collection.where({modelType:"node",focus:!0}).forEach(function(t){e.push({id:t.id})}),t._inAppOptions&&t._inAppOptions.localUID&&g.publish(n,e),R.closeWidget()}),l.addEvent("onClick",function(){t._inAppOptions&&t._inAppOptions.localUID&&g.publish(s),R.closeWidget()}),this._inAppView={container:o,okBtn:a,cancelBtn:l}}},render:function(e,t,i){var n=e.getLinksAndNodes(!1),s=i?JSON.parse(i.data):"";t=t?JSON.parse(t):null;if(this._isSearched)if(this._continueSearch){var o=this._searchValue;o&&this.dispatchEvent("ENORIPE_Search",o),this._continueSearch=!1}else this.clearFilterBySearch();if(0!==n.nodes.length){if(this._lastRootID&&0!==this._lastRootID.length||this._initLastRootWithColumnId(),"dataGridView"==this._currentLayout){let i=!(!t||!t.objectsAndLinksBySteps);this._updateDatagridView(e,i),this._currentView=this.dataGridView}else if(this.mapView){let t=e.where({instancesNeedUpdate:!0});t&&t.length>0&&(this._currentView.updateInstancesList(t),t.forEach(function(e){e.set("instancesNeedUpdate",!1)}));let i=!1;this.mapView.isInitWithNodes()||(i=!0),this.mapView.render(n,e.groupBy("columnID")),this._currentView=this.mapView,i&&this._manageFocus()}if(C.getStartTime("init")){let e="linearGraph"===N.getLayoutType()?1:2;C.trackPerformance("init","init",{LayoutType:e})}this.dispatchEvent("ENORIPE_SetNavigatedNode",[this.collection.getIdentifierDataById()]);let i=[];return s&&s.items&&s.items.length>0&&(i=s.items.map(e=>e.id)),this._updateCountModel().then(function(){this._updateCountView(i)}.bind(this)).catch(function(){this._updateCountView(i)}.bind(this)),this.listView&&this._infoPanelCommandClick&&this.manageProperties(),this._isWebInWin&&(this.collection._isBusy()||c.sendStringRelationsToWebInWin("ENORIPE_ViewReady","done")),this._afterRender(),this.updateFilterProxy(),void 0!==this._preSelectedObjectIds&&Array.isArray(this._preSelectedObjectIds)&&this._preSelectedObjectIds.length>0&&(this.clearSelection(),this._selectInGraph(this._preSelectedObjectIds),this._preSelectedObjectIds=[]),N.getOption("inAppMode")&&(this._inAppOptions&&void 0!==this._inAppOptions.preSelectedObjectIds&&(this.clearSelection(),this._selectInGraph(this._inAppOptions.preSelectedObjectIds)),this._checkInAppOkBtn()),this}this.dispatchEvent("ENORIPE_ClearMap")},renderAfterRemove:function(){var e=this.collection.getLinksAndNodes(!1);if(this._lastRootID&&0!==this._lastRootID.length||this._initLastRootWithColumnId(),this._currentView.removeSelectedNodes(e,this.collection.groupBy("columnID")),this.mapView){let e=!1;this.mapView.isInitWithNodes()||(e=!0),e&&this._manageFocus()}return this.dispatchEvent("ENORIPE_SetNavigatedNode",[this.collection.getIdentifierDataById()]),this._updateCountModel().then(function(){this._updateCountView()}.bind(this)),this.updateFilterProxy(),this.hideSpinner(),this},setUpToolBar:function(e){var t=this;this.profileArray=[],this.dispatchEvent("ENORIPE_ProfileInfo");var i=[];this._inAppOptions&&void 0!==this._inAppOptions.excludedToolBarCommands&&(i=this._inAppOptions.excludedToolBarCommands);let n=this.container.parentElement||this.container;this._toolBarView=new e({renderTo:n,lang:this._lang,addinMode:this._addinMode,isWebInWin:this._isWebInWin,excludedCommands:i}),this._toolBarView.render(),this._favTitle&&this._toolBarView&&this._toolBarView.updateFavoriteTitle(this._favTitle),this.listenTo(this._toolBarView,"ENORIPE_selectAllFromCommand",this.selectAllFromCmd),this.listenTo(this._toolBarView,"ENORIPE_selectOutFilteredFromCommand",this.selectOutFilteredFromComd),this.listenTo(this._toolBarView,"ENORIPE_selectInverseFromCommand",this.inverseSelectionFromCmd),this.listenTo(this._toolBarView,"ENORIPE_clearSelectionFromCommand",this.clearSelection),this.listenTo(this._toolBarView,"ENORIPE_CustomizeAllCommandClick",this.customizeAll),this.listenTo(this._toolBarView,"ENORIPE_InfoCommandClick",this.toggleInformationsPanel),this.listenTo(this._toolBarView,"ENORIPE_PrintCommandClick",this.printMap),this.listenTo(this._toolBarView,"ENORIPE_ExportCommandClick",this.exportDatagrid),this.listenTo(this._toolBarView,"ENORIPE_ComputePathCommandClick",function(){t.pathPanel&&!t.pathPanel.container.isHidden()||t.computePaths()}),this.listenTo(this._toolBarView,"ENORIPE_FitAllCommandClick",this.fitAllInMap),this.listenTo(this._toolBarView,"ENORIPE_ClearMapCommandClick",this.clearMapClick),this.listenTo(this._toolBarView,"ENORIPE_RefreshMapCommandClick",this.refreshMapCmd),this.listenTo(this._toolBarView,"ENORIPE_OpenCommandClick",this.openCAD),this.listenTo(this._toolBarView,"ENORIPE_HideCommand",this.hideNodes),this.listenTo(this._toolBarView,"ENORIPE_ExcludeCommand",this.excludeNodes),this.listenTo(this._toolBarView,"ENORIPE_Expand_Command",this.expandSelectedNodes),this.listenTo(this._toolBarView,"ENORIPE_Collapse_Command",this.collapseSelectedNodes),this.listenTo(this._toolBarView,"ENORIPE_EditLayoutCommandClick",this.editLayout),this.listenTo(this._toolBarView,"ENORIPE_ExpandNLevel",this.expandNLevel.bind(this)),this.listenTo(this._toolBarView,"ENORIPE_HomeCommandClick",function(){this.collection&&this.collection.getNodesIds().length>0?this.dispatchEvent("ENORIPE_ShowSaveInFavoritesModal"):this.dispatchEvent("ENORIPE_ShowHomePage")}.bind(this)),this.listenTo(this._toolBarView,"ENORIPE_FavoriteCommandClick",this.handleFavorite.bind(this)),this.listenTo(this._toolBarView,"ENORIPE_SelectionAssistantFromCommand",this.selectionAssistant.bind(this)),this.listenTo(this._toolBarView,"ENORIPE_SwitchLayout",function(e){this.switchLayout(e)}),this._isWebInWin&&(this.listenTo(this._toolBarView,"ENORIPE_performSearch_native",function(e){this.dispatchEvent("ENORIPE_performSearch_native",e)}),this.listenTo(this._toolBarView,"ENORIPE_resetSearch_native",function(){this.clearFilterBySearch()}))},_initEmptyMap:function(e){"maximized"!==this._widgetStateAtInit||e||this._errorOnInit||this._showNotif({level:"error",msg:r.get("emptyMap")}),this._errorOnInit=!1,this.hideSpinner(),this._isEmpty&&this._dropInvite&&this._dropInvite.show()},_updateContainerDimensions:function(){var t=this.container.parentElement;if(t){var i=(t=t.getDimensions?t:e.extendElement(t)).getDimensions();this.ctnWidth=i.width,this.ctnHeight=this._isWebInWin?window.innerHeight:i.height,this.container.setStyle("height",this.ctnHeight)}},_updateDropZonesHeight:function(){var e=this.listView?this.container.getDimensions().width-this.listView.getWidth():this.container.getDimensions().width;this._dropZone&&this._dropZone.updateHeight(this.ctnHeight,e)},_updateSVGContainer:function(){this.mapView&&this.mapView.setSVGDimensions(this.ctnHeight,this.ctnWidth)},_reorderColumn:function(e,t,i){var n=this.collection.groupBy("columnID")[e.columnID];n.sort(function(e,t){return e._attributes.rowID>t._attributes.rowID?1:t._attributes.rowID>e._attributes.rowID?-1:0}),n.splice(i,0,n.splice(e.rowID,1)[0]);for(var s=0;s<n.length;s++)n[s].set("rowID",s);this.mapView.render(this.collection.getLinksAndNodes(),this.collection.groupBy("columnID"))},_afterRender:function(){this._pathSelReq&&(this._pathSelReq=!1,this._selectInGraph(this._pathSelReqNodes))},_checkInAppOkBtn:function(){if(this.collection){var e=this.collection.where({modelType:"node",focus:!0}).length;this._inAppView&&(e>0?this._inAppView.okBtn.enable():this._inAppView.okBtn.disable())}},_updateCollection:function(){var e=this,t=null,i=null;this.collection.filter(function(n){(t=e.mapView.getElement("#container-"+CSS.escape(n.id)+" .instance-list-g"))&&"node"===n.get("modelType")&&n.get("instances")&&n.get("instances").length>0&&(i=t.getElements(".instance-text"),t.classList.contains("expand")?n.set("instancesExpanded",i.length):n.get("instancesExpanded")>N.getOption("showInstancesLimit")?n.set("instancesExpanded",-1):n.set("instancesExpanded",0))})},_hideDropZones:function(){this._dropZone&&this._dropZone.hide()},_updateCountModel:function(){var e=[],i=[],n={},s=[],o=[],a=[];return new t.Promise(function(t,r){(e=this.collection.where({modelType:"node"})).forEach(function(e){e.get("counts")?e.get("counts").get("requestDone")||i.push(e.get("identifierData")):e.set("counts",new u({source:e.id}))}.bind(this)),i.length>0?(this.dispatchEvent("Customize_LoadingRelations"),x.getRelationsCount({items:i}).then(function(r){s=JSON.parse(r).counts,i.forEach(function(e){(n=this.collection.get(e.id).get("counts")).set("requestDone",!0),(o=s.filter(function(t){return t.source===e.id})).length>0&&n.parse(o),a.push(n)}.bind(this)),e.forEach(function(e){e.get("counts").resetRealCount(this.collection)}.bind(this)),this.updateRelationsDisplayed(),t()}.bind(this)).catch(function(){r()}.bind(this))):(e.forEach(function(e){e.get("counts").resetRealCount(this.collection)}.bind(this)),this.dispatchEvent("Customize_UnloadCustomizeRelations"),t())}.bind(this))},updateRelationsDisplayed:function(){var e=[];this.collection.where({modelType:"node"}).forEach(function(t){t.get("counts")&&t.get("counts").hasCount()&&t.get("counts").getAllCountAttribute("name").forEach(function(t){e.indexOf(t)<0&&e.push(t)})}),this.dispatchEvent("Customize_UpdateRelationsDisplayed",[e])},_updateCountView:function(e){this._currentView.updateCount(this.collection,e)},_clickListInstance:function(e){var t=this.collection.get(e),i=this.mapView.getElement("#container-"+CSS.escape(e)+" .instance-list-g"),n=[];if(i){if(t.get("instancesExpanded")>0){t.get("instancesExpanded")>N.getOption("showInstancesLimit")?t.set("instancesExpanded",-1):t.set("instancesExpanded",0);for(var s=i.getElements(".instance-text"),o=0;o<s.length;o++){var a=s[o].id.replace("instance-","");n.push(a),this._currentlyFilteredNodes&&this._currentlyFilteredNodes.indexOf(a)>-1&&this._currentlyFilteredNodes.splice(this._currentlyFilteredNodes.indexOf(a),1)}this.taggerServices.removeRoots(n)}else{s=i.getElements(".instance-text");if(t.set("instancesExpanded",s.length),this._currentlyFilteredNodes&&this._currentlyFilteredNodes.length>0)for(o=0;o<s.length;o++)this._currentlyFilteredNodes.indexOf(s[o].id.replace("instance-",""))<0&&this._currentlyFilteredNodes.push(s[o].id.replace("instance-",""))}this.mapView.updateConstraints(this.collection.getLinksAndNodes(),this.collection.groupBy("columnID")),this.updateFilterProxy()}},_clickMoreInstance:function(e,t){var i=this.collection.get(e);if(this.mapView.getElement("#container-"+CSS.escape(e)+" .instance-list-g")&&(i.set("instancesExpanded",t.length),this._currentlyFilteredNodes&&this._currentlyFilteredNodes.length>0))for(var n=0;n<t.length;n++)this._currentlyFilteredNodes.indexOf(t[n].id)<0&&this._currentlyFilteredNodes.push(t[n].id);this.mapView.updateConstraints(this.collection.getLinksAndNodes(),this.collection.groupBy("columnID")),this.updateFilterProxy()},toggleInstance:function(e){var t=this.collection.get(e.nodeId),i=[];if(null!=t.get("selectedInstance")&&(i=t.get("selectedInstance")),e.selected?(null!=i?i.push(e.instanceId):i=[e.instanceId],t.set("selectedInstance",i)):i.length>1&&e.instanceId&&i.indexOf(e.instanceId)?(i.splice(i.indexOf(e.instanceId),1),t.set("selectedInstance",i)):t.set("selectedInstance",null),null!=e.selected){var n=e.selected?"add":"remove";this._manageSelection({models:e.nodeId,sAction:n,instanceId:e.instanceId}),this.manageProperties()}},toggleListInstances:function(e){this.collection.filter(function(t){if("node"===t.get("modelType")&&t.get("instances")&&t.get("instances").length>0)if(e){var i=Math.min(t.get("instances").length,N.getOption("showInstancesLimit"));-1==t.get("instancesExpanded")&&(i=t.get("instances").length),t.set("instancesExpanded",i)}else t.set("selectedInstance",null),t.get("instancesExpanded")>0&&(t.get("instancesExpanded")>N.getOption("showInstancesLimit")?t.set("instancesExpanded",-1):t.set("instancesExpanded",0))}),this._currentView.toggleAllInstances(this.collection,e),this.updateFilterProxy(),this.listView&&this._infoPanelCommandClick&&this.manageProperties()},selectionAssistant:function(){var e=this,t=this.collection.where({modelType:"node",focus:!0}),i=!0;t&&t.length>1&&(i=!1),this._SARenderOption||(this._SARenderOption={selOptions:{SDP:!1,SAP:!1,SDS:!1,SAS:!1,CommonResults:!1},disableCommon:i}),this.addLoader(),this._selectionAssistant?(this._SARenderOption.disableCommon=i,i&&(this._SARenderOption.selOptions.CommonResults=!1),this._selectionAssistant.render(this._SARenderOption),this.removeLoader()):require(["DS/SNNavigationMap/views/SelectionAssistantView"],function(t){e._selectionAssistant=new t,e._selectionAssistant.inject(e.container.parentElement),e._selectionAssistant.render(e._SARenderOption),e.removeLoader(),e.listenTo(e._selectionAssistant,"ENORIPE_UpdateSelection",function(t){e._SARenderOption=t,e.handleSelections(t)})})},handleSelections:function(e){var t=e.selOptions,i=h.getSelected();if(t.CommonResults){var n,s=0;Object.values(t).forEach(function(e){e&&s++}),void 0!==(n=s>2?this._handleCommonSelForMultiCriteria(t,i):this._handleCommonSelections(t,i))&&n&&n.showNotif&&this._showNotif({level:"info",lvl:"primary",msg:r.get("SA-NoNewSelection")})}else for(var o in t)if(t[o])switch(o){case"SDP":this._handleSDP(i);break;case"SAP":this._handleSAP(i);break;case"SDS":this._handleSDS(i);break;case"SAS":this._handleSAS(i)}},_handleCommonSelForMultiCriteria:function(e,t){var i=!1,n=[],s=[];e.SAP?t.forEach(function(e){n[e.id]||(n[e.id]=[]);var t=h.getAllPredecessors([e]);t&&(n[e.id]=[...n[e.id],...t])}):e.SDP&&t.forEach(function(e){n[e.id]||(n[e.id]=[]);var t=h.getPredecessors([e]);t&&(n[e.id]=[...n[e.id],...t])}),e.SAS?t.forEach(function(e){n[e.id]||(n[e.id]=[]);var t=h.getAllSuccessors([e]);t&&(n[e.id]=[...n[e.id],...t])}):e.SDS&&t.forEach(function(e){n[e.id]||(n[e.id]=[]);var t=h.getSuccessors([e]);t&&(n[e.id]=[...n[e.id],...t])});s=n[Object.keys(n)[0]];for(var o=1;o<Object.keys(n).length;o++)s=h._getCommon(s,n[Object.keys(n)[o]]);s.length>0?this._manageSelection({models:s,sAction:"add"}):i=!0,i&&this._showNotif({level:"info",lvl:"primary",msg:r.get("SA-NoNewSelection")})},_handleCommonSelections:function(e,t){if(t.length<2)return{showNotif:!0};var i,n=!1;e.SDP?i=h.getCommonDirectPredecessors(t):e.SAP?i=h.getCommonAllPredecessors(t):e.SDS?i=h.getCommonDirectSuccessors(t):e.SAS&&(i=h.getCommonAllSuccessors(t)),i&&i.length>0&&(i=this._processSelection(i)).length?this._manageSelection({models:i,sAction:"add"}):n=!0,n&&this._showNotif({level:"info",lvl:"primary",msg:r.get("SA-NoNewSelection")})},_handleSDP:function(e){var t=h.getPredecessors(e),i=!1;if(t){var n=t.filter(function(t){if(!e.includes(t))return!0});(t=this._processSelection(n)).length?this._manageSelection({models:t,sAction:"add"}):i=!0}else i=!0;i&&this._showNotif({level:"info",lvl:"primary",msg:r.get("SA-NoNewSelection")})},_handleSAP:function(e){var t=h.getAllPredecessors(e),i=!1;if(t){var n=t.filter(function(t){if(!e.includes(t))return!0});(t=this._processSelection(n)).length?this._manageSelection({models:t,sAction:"add"}):i=!0}else i=!0;i&&this._showNotif({level:"info",lvl:"primary",msg:r.get("SA-NoNewSelection")})},_handleSDS:function(e){var t=h.getSuccessors(e),i=!1;if(t){var n=t.filter(function(t){if(!e.includes(t))return!0});(t=this._processSelection(n)).length?this._manageSelection({models:t,sAction:"add"}):i=!0}else i=!0;i&&this._showNotif({level:"info",lvl:"primary",msg:r.get("SA-NoNewSelection")})},_handleSAS:function(e){var t=h.getAllSuccessors(e),i=!1;if(t){var n=t.filter(function(t){if(!e.includes(t))return!0});(t=this._processSelection(n)).length?this._manageSelection({models:t,sAction:"add"}):i=!0}else i=!0;i&&this._showNotif({level:"info",lvl:"primary",msg:r.get("SA-NoNewSelection")})},openCAD:function(){g.publish("webinwin:web:notification",JSON.stringify({operation:"open/setTypes",operationVersion:"1.0",content:h.buildSelectionForNativeApps()}))},_handleDownload:function(e,t){var i=this;this.fileUtils?this.fileUtils.handleDownload(e,t):require(["DS/SNNavigationMap/utils/MapFileUtils"],function(n){i.fileUtils=new n({spinner:i._spinner,notifManager:i._notifManager}),i.fileUtils.handleDownload(e,t)})},getCustomizeAttributeOptions:function(){var e=this,i=[],n=[{name:"AllTypes",nlsLabel:r.get("AllTypes")}];return new t.Promise(function(t,s){e.collection.filter(function(e){if("node"===e.get("modelType")){var t=e.get("type");null!=t&&""!==t&&-1===i.indexOf(t)&&i.push(t);var n=e.get("instances");if(void 0!==n)for(var s=0;s<n.length;s++){var o=n[s].type;null!=o&&""!==o&&-1===i.indexOf(o)&&i.push(o)}}}),e._getTypesNls(i).then(function(e){for(var i in e)e.hasOwnProperty(i)&&n.push({name:i,nlsLabel:e[i]});var s={defaults:N.getDefaultAttributes(),selectedIndex:0,types:n};t(s)})})},toggleInformationsPanel:function(){this._toolBarView.getCommand("Info_Command").hasClassName("pressed")===this._infoPanelCommandClick&&this._toolBarView.toggleInfoCommand(),this._infoPanelCommandClick?(this.listView.hidePanel(),this._infoPanelCommandClick=!1):(this._infoPanelCommandClick=!0,this.manageProperties()),this.dispatchEvent("ENORIPE_ToggleInformationPanel",this._infoPanelCommandClick)},manageProperties:function(){var e=this.collection.where({focus:!0});e&&0!==e.length&&this._infoPanelCommandClick?this.listView.setModel(e):this.listView.hidePanel()},_initPreviewView:function(e,t){var i=this;require(["DS/SNNavigationMap/views/PreviewView"],function(n){i.previewView=new n({widgetId:i._widgetId,separator:i._separator,direction:t,collection:i.collection}),i.previewView.inject(i.container),i.previewView.render(),i.dispatchEvent("ENORIPE_ShowPreview",{model:e,direction:t}),i.listenTo(i.previewView,"ENORIPE_extractNode",function(e){i._extractNode(e)}),i.listenTo(i.previewView,"PreviewHide",function(){i.taggerServices.activate(),i.updateFilterProxy(),i._isPreviewPanelOpen=!1,i.clearFilterBySearch()}),i.listenTo(i.previewView,"ContextualMenuPreviewGroup",function(e){e.targetId&&(i._theContextualMenuTarget.targetId=e.targetId,i._theContextualMenuTarget.targetElement=e.targetElement,i._theContextualMenuTarget.context="PreviewGroup")}),i.listenTo(i.previewView,"ENORIPE_DownloadDocument",i._handleDownload),i._isWebInWin&&(i.listenTo(i.previewView,"ENORIPE_performSearch_native",function(e){i.dispatchEvent("ENORIPE_performSearch_native",e)}),i.listenTo(i.previewView,"ENORIPE_resetSearch_native",function(){i.clearFilterBySearch()})),i.listenTo(i.previewView,"ENORIPE_LaunchSearch",function(){i.dispatchEvent("ENORIPE_LaunchSearch")})})},_showPreview:function(e){this.clearFilterBySearch();var t=e.direction?e.direction:"both";this._isPreviewPanelOpen=!0,this._currentView.endFilter(),this.previewView?(this.previewView.render(t),this.dispatchEvent("ENORIPE_ShowPreview",e)):this._initPreviewView(e.model,t),this.taggerServices.deactivate()},expandNLevel:function(){this.getSelectedIds().length<1?this._showNotif({level:"error",msg:r.get("ActionWithoutSelection")}):this.dispatchEvent("ENORIPE_initExpandNLevel",{selectedNodes:this.collection.getIdentifierDataById(this.getSelectedIds()),expandNLevelView:this.expandNLevelView})},handleFavorite:function(e){var t=new m({className:"Enoripe-Modal",animate:!0});this._isFavOpen?this._favoriteSave(t,e):this._favoriteSaveAs(t,e)},_favoriteSave:function(t,i){var n=this,s=e.createElement("div",{class:"Favorite-OverwriteContainer"}),o=r.replace(r.get("Favorite-Overwrite"),{favName:this._favTitle});e.createElement("div",{html:o}).inject(s),e.createElement("div",{html:r.get("Favorite-Confirm")}).inject(s),t.dialog({body:s,title:r.get("SNNavigationMap.Favorite.Title"),maxlength:80,buttons:[{className:"primary",value:r.get("SNNCustomize_Save"),action:function(e){n.dispatchEvent("ENORIPE_updateFav",i),e.hide()}},{value:r.get("Favorite_SaveAs"),action:function(){n._favoriteSaveAs(t,i,!0)}},{value:r.get("SNNCustomize_Cancel"),action:function(e){e.hide()}}]})},_favoriteSaveAs:function(t,i,n){var s=this,o=null,a=null;N._getListOfSecurityContext().then(function(l){o=l,a=N.getOption("selectedSCForFav");for(var d=0;d<o.length;d++)if(a===o[d].value){o[d].selected=!0;break}var c={fields:[{type:"text",required:!0,pattern:"^[_ A-Za-z0-9]+$",value:"",placeholder:r.get("Favorite_SaveAsPlaceholder"),label:r.get("Favorite_SaveAsPlaceholder"),name:"inputval",maxlength:80},{type:"select",label:r.get("Favorite_SelectPlaceholder"),name:"securitycontext",options:o}],events:{onSubmit:function(e){if(0===e.inputval.trim().length){let e=r.get("Favorite_EmptyErr");g.setContent(e),g.getParent()||t.modals.current.elements.body&&t.modals.current.getBody().addContent(g)}else{s.dispatchEvent("ENORIPE_createFavorite",[e,i]),t.modals.current.hide()}},onInvalid:function(){var e="";e=0===u.value.trim().length?r.get("Favorite_EmptyErr"):(e=r.get("Customize_SpecialCharErr")).concat(" !@#$%^&*()+=[]\\';,./{}|\":<>?-"),g.setContent(e),g.getParent()||t.modals.current.elements.body&&t.modals.current.getBody().addContent(g)}}},h=new _(c),u=h.elements.container.getElement("input"),g=e.createElement("div",{class:"Customize-ProfileNameError",html:""});t.dialog({body:h,title:r.get("SNNavigationMap.Favorite.Title"),buttons:[{className:"primary",value:r.get("SNNCustomize_Save"),action:function(){h.submit()}},{value:r.get("SNNCustomize_Cancel"),action:function(e){e.hide()}}]}),n&&t.next(),u.addEventListener("click",function(e){this.focus()})})},_initDatagridView:function(e){var t=[],i=[],n=!e;this._manageFocus(),this.mapView&&this.mapView.hide(),e&&(t=this.collection.where({modelType:"node",focus:!0,isCount:void 0})).length>0&&(i=t.map(function(e){return e.id}),this.dispatchEvent("setLastRootNodeID",[i])),this.buildDatagrid(n,t),this._isFiltered&&this.updateFilterProxy()},buildDatagrid:function(e,t){var i,n=!e,s=[];t=[],i=N.getDefaultAttributes().EnoripeColumns.attributes,t&&0!==t.length||(s=w.getPref("lastRootNodeID")||[],t=this.collection.filter(function(e){if(s.indexOf(e.id)>-1)return!0})),this.dataGridView.buildSkeleton(t,this.collection,i,n).then(()=>{this.dataGridView.show(),this.hideSpinner(),n&&this._updateCollectionWithView()})},_updateDatagridView:function(e,t){var i=[];this.dataGridView&&(this.dataGridView.getRootModels()&&0!==this.dataGridView.getRootModels().length?(this._lastRootID.forEach(function(t){this.dataGridView.getRootModelsIds().indexOf(t)<0&&e.get(t)&&i.push(e.get(t))}.bind(this)),i.length>0?this.dataGridView.setRootNodes(i):this.dataGridView.setData(!1,t,1),this.hideSpinner()):this._initDatagridView())},collapseNodeOnDatagrid:function(e,t,i){var n=[];t&&e&&(i.map(function(e){return e.id}),n=this.collection.filter(function(e){if(t.indexOf(e.id)>-1)return!0}),t.length>0&&(this.collection.getRemovedObject(n).removedObjectsId.forEach(function(e){this.collection.remove(e)}.bind(this)),this.dispatchEvent("ENORIPE_SetNavigatedNode",[this.collection.getIdentifierDataById()]),this._updateCountModel().then(function(){this._updateCountView()}.bind(this)),this.updateFilterProxy()))},customizeAll:function(){this.dispatchEvent("ENORIPE_CustomizeAll")},customizeDisplay:function(){this.dispatchEvent("ENORIPE_CustomizeDisplay")},updateProfile:function(e){this.listView&&this.listView.updateProfileRelations(e),this.dataGridView&&"dataGridView"===this._currentLayout&&this.dataGridView.setExpandDirection({upstream:!0,downstream:!0}),this.dispatchEvent("ENORIPE_TrackProfileUsage",e)},computePaths:function(){var e=this.collection.where({focus:!0});this.pathPanel?this.pathPanel.render(e):this._initPathPanel()},managePathPanel:function(e){let t=this;if(e&&this.pathPanel&&!this.pathPanel.container.isHidden()){var i=this.collection.get(e);i&&("ENOStrRefinementSpecification"===i.get("type")&&this.collection.filter(function(e){"link"===e.get("modelType")&&(e.get("source").id===i.get("id")?i._attributes.linked=t.collection.get(e.get("target").id):e.get("target").id===i.get("id")&&(i._attributes.linked=t.collection.get(e.get("source").id)))}),this.pathPanel.addNodes(i))}},_initPathPanel:function(){var e=this;require(["DS/SNNavigationMap/views/PathPanelView"],function(t){e.pathPanel=new t({spinner:e._spinner,widgetId:e._widgetId,debugMode:e._debug,position:{offsetX:0,offsetY:24,dialogWidth:520,dialogHeight:600},addinMode:e._addinMode}),e.listenTo(e.pathPanel,"ENORIPE_dragEnd",e._hideDropZones),e.listenTo(e.pathPanel,"ENORIPE_handleErrorMsgs",e.handleServerErrorMsgs),e.listenTo(e.pathPanel,"ENORIPE_ComputePath",e.computePaths),e.listenTo(e.pathPanel,"ENORIPE_AddInGraph",e._addInGraph),e.listenTo(e.pathPanel,"ENORIPE_SelectInGraph",e._selectInGraph),e.listenTo(e.pathPanel,"ENORIPE_SetPathOnCompass",function(t){e.clearSelection("MapView","PathPanel"),h&&h._syncPathToCompass(t)}),e.listenTo(e.pathPanel,"ContextualMenuFindPath",function(t){t.targetId&&(e._theContextualMenuTarget.context="FindPath",e._theContextualMenuTarget.targetId=t.targetId,e._theContextualMenuTarget.targetElement=t.targetElement,e._theContextualMenuTarget.typeOfPath=t.typeOfPath,e._theContextualMenuTarget.jsonMsgForOpen=t.jsonMsgForOpen,e._theContextualMenuTarget.jsonMsgForAddInGraph=t.jsonMsgForAddInGraph)}),e.pathPanel.inject(e.container,"top"),e.pathPanel.addEvent("PathPanelViewRender",function(){e.hideSpinner()}.bind(e)),e.pathPanel.addEvent("PathPanelViewClose",function(){e._toolBarView.getCommand("ComputePath_Command").removeClassName("pressed")}.bind(e)),e.pathPanel.addEvent("ENORIPE_HighlightPath",e._highlightPath.bind(e)),e.pathPanel.addEvent("ENORIPE_UnHighlightPath",function(t){e._currentView.endFilter()}.bind(e)),e.pathPanel.addEvent("noPathsFound",function(t){var i="noPathsFoundNP";"StructurePath"===t.type&&(i="noPathsFoundSP"),e._showNotif({level:"info",lvl:"primary",msg:r.replace(r.get(i),{anchor:t.anchor,selected:t.selected}),sticky:!1})}.bind(e)),e.pathPanel.render(e.collection.where({focus:!0}))})},_highlightPath:function(e){for(var t=e.paths,i=[],n=0;n<t.length;n++)if("StructurePath"===e.typeOfPath&&(t[n].from||t[n].to)||"NetworkPath"===e.typeOfPath&&t[n].type&&(t[n].type.contains("_from")||t[n].type.contains("_to"))){this.collection.where({modelType:"link"});var s=t[n-1],o=t[n+1];s&&o&&s.resourceid&&o.resourceid&&this.collection.filter(function(e){if("link"===e.get("modelType")){var t=e.get("id"),n=e.get("source"),a=e.get("target");n&&a&&(s.resourceid===n.id?o.resourceid===a.id&&i.push(t):s.resourceid===a.id&&o.resourceid===n.id&&i.push(t))}})}else"0"!==t[n].resourceid&&i.push(t[n].resourceid);"linearGraph"===this._currentLayout&&this.mapView?this.mapView.highlightPath(i):this.dataGridView.filter({matchingIDs:i})},dragElement:function(e,t){if(c.isWebInWin()&&t.data.items[0].objectId&&c.sendToMapWebInWin("RefreshOnDrag",t.data.items[0].objectId),e.dataTransfer)if(c.isWebInWin())try{e.dataTransfer.setData("text",JSON.stringify(t))}catch(e){console.log("Error in set Data for web in win : "+e)}else try{e.dataTransfer.setData("text/searchitems",JSON.stringify(t)),e.dataTransfer.setData("text",JSON.stringify(t))}catch(i){console.log(i),e.dataTransfer.setData("Text",JSON.stringify(t))}R.closeWidget()},setContainerEvents:function(){var e=this;this.container.addEventListener("dragenter",this.onDragEnter.bind(this)),this.container.addEventListener("mousedown",function(){e.containerMouseDownTime=new Date})},_onHide:function(){this.hide(),this._toolBarView&&this._toolBarView.toolBar.hide(),this.listView&&this.listView.hidePanel(),this.dispatchEvent("ENORIPE_HideLeftToolBar")},_onShow:function(){this.show(),this._toolBarView&&this._toolBarView.toolBar.show(),this._infoPanelCommandClick&&this.listView.showPanel(),this.dispatchEvent("ENORIPE_ShowLeftToolBar")},_onKeyUp:function(e){if(!0===e.ctrlKey){e.stopPropagation(),e.preventDefault();var t=e.keyCode||e.which,i=String.fromCharCode(t);"a"!==i&&"A"!==i||this.selectAllFromCmd()}},_handleDrop:function(t,i){this.showSpinner(),this._doContinueSearch();"extract"===t&&i.id;var n=i.data&&e.is(i.data.items[0].objectId)?i.data.items:null,s="extract"===t&&i.data.sourceIds?i.data.sourceIds:[];this._pathSelReq||C.trackUsage("ObjectsDrop","Objectsdrop-"+t,n.length);var o=[t,s,n];this.dispatchEvent("ENORIPE_DropByMode",o)},onDropFromWebInWin:function(t){var i=t.action,n=t.objects&&e.is(t.objects)?JSON.parse(t.objects):null;n?(this.showSpinner(),this.dispatchEvent("ENORIPE_DropByMode",[i,n])):this._showNotif({level:"warning",lvl:"warning",msg:r.get("InvalidSelection")})},refreshMapCmd:function(){this.dispatchEvent("ENORIPE_refreshMap",[{initWithNodes:this.collection.getIdentifierDataById(),needClear:!0}]),this.refreshMsgPending=!0},refresh:function(e){this._isEmpty=e.isEmpty,e.isEmpty?this.hideSpinner():(this._initCollection(e.collection),this._initSubViews())},onResize:function(){if(this._updateContainerDimensions(),this._updateSVGContainer(),this._updateDropZonesHeight(),this._toolBarView&&this._toolBarView.resizeHandler(),this.pathPanel&&this.pathPanel.updateDialogSizeOnResize(),this.mapView){var e={sidePanelWidth:this.listView.getWidth(),actionBarHt:48};this.mapView.centerTheGraph(e)}},onDragEnter:function(e){e.stopPropagation(),e.preventDefault();var t=this.listView&&this.listView.container&&this.listView.isVisible?this.listView.getWidth():0;this._isPreviewPanelOpen||this._dropZone.show(parseFloat(this.container.getStyle("width").slice(0,-2))-t,this._isEmpty)},_getTypesNls:function(e){var i=this,n={},s={};return e.forEach(function(e){n[e]=r.get(e)}),new t.Promise(function(t,o){i._isWebInWin&&A.setConfigForMyApps({myAppsBaseUrl:N.getMyAppsUrl(),userId:N.getUserID(),lang:N.getLang()}),e.length>0?s={"ds6w:type":e}:t(n),A.getNlsOfPropertiesValues(JSON.stringify(s),{tenantId:N.getCurrentTenantName(),lang:N.getLang(),apiVersion:"R2019x",onComplete:function(e){e&&void 0!==e["ds6w:type"]?t(e["ds6w:type"]):t(n)},onFailure:function(e){console.log("Error in fetching NLS data from FedDictionaryAccessAPI.getNlsOfPropertiesValues, the response received is ::"+e),t(n)}})})},_updateNLSForSavedAttrs:function(){var e=this,i=N.getJSONAttributes(),n=N.getDefaultAttributes();return new t.Promise(function(t,s){for(var o,a=[],r=0;r<2;r++)for(var l in o=0===r?i:n)o.hasOwnProperty(l)&&o[l].attributes&&o[l].attributes.forEach(function(e){-1===a.indexOf(e.uri)&&a.push(e.uri)});O.getResourcesInfo(a).then(function(s){if(s){var a={};s.forEach(function(e){a[e.curi]=e.label});for(var r=0;r<2;r++)for(var l in o=0===r?i:n)o.hasOwnProperty(l)&&o[l].attributes&&o[l].attributes.forEach(function(e){a[e.uri]&&(e.label=a[e.uri])});N.setJSONAttributes(i),N.setDefaultAttributes(n),w.setPrefEverywhere("_ENORIPE_Type_Attrs",n),e.dataGridView&&e.dataGridView.updateColumnsHeaderNls(o)}t()})})},_checkDefaults:function(e){for(var t in e)if(e.hasOwnProperty(t))for(var i=e[t].attributes,n=i.length;n--;)void 0!==i[n].uri&&null!==i[n].uri||i.splice(n,1);return e},updateMapViewAttributes:function(e){if(null!=e&&0!==e.length){var t=this,i=[],n=null,s=model.get("type")||"AllTypes";toFetchThumbnail=!1,model=this.collection.get(e),model&&model.get("instances")&&model.get("instances").length>0&&model.get("instances").forEach(function(e){null===n&&(n=e.type),i.push(e.id)}),n=n||"AllTypes",model&&!model.get("thumbnail")&&N.getOption("Fetch_Thumbnails")&&(toFetchThumbnail=!0);var o={ids:[e],type:s,toFetchThumbnail:toFetchThumbnail},a={ids:i,type:n,isInstances:!0};this.mapView.addLoader(e),this._fetchAndSetAttributes(o).then(function(n){if(model&&!model.get("preview_url")){var s=o.nlsObj[o.ids[0]].preview_url;s&&model.set("preview_url",s)}t.mapView.setAttrData(n),model.set("nlsObj",n.nlsObj[o.ids[0]]),i.length>0?t._fetchAndSetAttributes(a).then(function(i){t.mapView.setAttrData(i),t.mapView.removeLoader(e)},function(){t.mapView.removeLoader(e)}):t.mapView.removeLoader(e)},function(){t.mapView.removeLoader(e)})}},updateMapViewAttributesNls:function(e){if(null!=e&&0!==e.length){var t={},i=null;(i=this.collection.get(e))&&((t={modelType:i.get("type")||"AllTypes",ids:[e],models:{}}).models[e]=i,this._getNlsAndSetAttributes(t),i.get("instances")&&i.get("instances").length>0&&(t={ids:[],modelType:"AllTypes",isInstances:!0,models:{}},i.get("instances").forEach(function(e){t.modelType=e.type,t.ids.push(e.id),t.models[e.id]={_attributes:e}}),this._getNlsAndSetAttributes(t)))}},_getNlsAndSetAttributes:function(e){var t=this,i={},n={};e.models&&(i=O.getAttributes(e.modelType),n=O._prepareDataToNls(Object.values(e.models)),O._getNlsAndProcessData(n,e.ids,e.models,e.isInstances).then(function(n){n={...n,...i};for(var s=0;s<Object.keys(n.nlsObj).length;s++)t.collection.setNlsObj(Object.keys(n.nlsObj)[s],Object.values(n.nlsObj)[s],e.isInstances);t.mapView&&"linearGraph"===t._currentLayout&&t.mapView.setAttrData(n)}))},_fetchAndSetAttributes:function(e){return new t.Promise(function(t,i){try{x.fetchAttributes(e).then(function(e){e&&e.nlsObj&&Object.keys(e.nlsObj).length>0&&t(e)},function(){i()})}catch(e){console.log("err while fetching attributes"),i()}})},_isDiffFromDefault:function(e){var t=w.getPref("_ENORIPE_Type_Attrs")||null;if(!t)return!0;if(Object.keys(e).length!==Object.keys(t).length)return!0;for(var i in e)if(e.hasOwnProperty(i)){if(void 0===t[i])return!0;var n=e[i].attributes,s=t[i].attributes;if(n.length!==s.length)return!0;for(var o=n.map(function(e){return e.uri}),a=0;a<s.length;a++)if(-1===o.indexOf(s[a].uri))return!0}return!1},_attributesOrderChange:function(e){var t=w.getPref("_ENORIPE_Type_Attrs")||null;if(!t||this._isDiffFromDefault(e))return!0;for(var i in e)if(e.hasOwnProperty(i))for(var n=e[i].attributes,s=t[i].attributes,o=0;o<n.length;o++)if(n[o].uri!==s[o].uri)return!0;return!1},hideOneDirection:function(e){this.showSpinner();var t=this.dataGridView.getOneDirectionLink(e);this.collection.filter(function(e){if(t.indexOf(e.id)>-1)return e}).length>0?(this.dispatchEvent("ENORIPE_SetNavigatedNode",[this.collection.getIdentifierDataById()]),this.dispatchEvent("ENORIPE_HideOneDirection",[e,!0]),this.updateFilterProxy()):this.dispatchEvent("ENORIPE_HideOneDirection",[e,!0])},collapseSelectedNodes:function(e){var t=this.getSelectedIds();t.length>0?this.collapseNode(t,e):this._showNotif({level:"error",msg:r.get("ActionWithoutSelection")})},collapseNode:function(e,t){var i,n,s=[];i=this.collection.filter(function(t){if(e.indexOf(t.id)>-1)return t}),("out"===t?h.getAllSuccessors(i):"in"===t?h.getAllPredecessors(i):h.getAllPredecessors(i).concat(h.getAllSuccessors(i))).forEach(function(t){e.indexOf(t.id)<0&&s.push(t)}),n=s.map(function(e){return e.id}),s.length>0?("linearGraph"===N.getLayoutType()?this.removeNodes(s):"dataGridView"===N.getLayoutType()&&this.dataGridView.collapseNode(n,e),this._updateLastRootID(n)):e.length>1?this._showNotif({level:"info",msg:r.get("NodesCantBeCollapsed")}):this._showNotif({level:"info",msg:r.get("NodeCantBeCollapsed")})},removeNodes:function(e){"dataGridView"===N.getLayoutType()&&N.getInstancesMode()&&e.forEach(function(t){let i=this.dataGridView.getAllNodesById(t.id);if(i.length>1){let n=0;i.forEach(function(e){e.isSelected()&&n++}),i.length>n&&e.splice(e.indexOf(t),1)}}.bind(this)),this.collection.removeNodes(e).then(function(){let t=this.collection.where({instancesNeedUpdate:!0});t&&t.length>0&&("linearGraph"==this._currentLayout&&this._currentView.updateInstancesList(t),t.forEach(function(e){e.set("instancesNeedUpdate",!1)})),this.renderAfterRemove(),this._manageSelection({models:e,sAction:"remove"})}.bind(this)),this.updateRelationsDisplayed()},hideNodes:function(){var e=[];this._doContinueSearch(),(e=this.collection.where({focus:!0})).length>0?this.collection.where({modelType:"node"}).length===e.length?this._showNotif({level:"error",msg:r.get("AllNodesHidden")}):(this.showSpinner(),this.removeNodes(e),this._updateLastRootID(e.map(function(e){return e.id})),this.listView&&this.listView.isVisible&&this.listView.hidePanel()):this._showNotif({level:"error",msg:r.get("ActionWithoutSelection")})},removeActions:function(e){var t=[];e&&e.length>0&&(h.updateFeedBack(e),this.collection.filter(function(i){"node"===i.get("modelType")&&e.indexOf(i.id)>-1&&t.push(i.id)}),this.taggerServices.removeRoots(t))},expandSelectedNodes:function(e){var t=[],i=[],n=[];N.getLayoutType();if((i=this.collection.where({focus:!0})).length>0){for(var s=0;s<i.length;s++)e?i[s].get("counts").hasRealCount(e)&&(t.push(i[s].id),n=[...n,...i[s].get("counts").getRealCountAttribute("name",e)]):i[s].get("counts").hasRealCount()&&(t.push(i[s].id),n=[...n,...i[s].get("counts").getRealCountAttribute("name")]);t.length>0?(this.showSpinner(),this.splitCount(t,n,e)):this.displayMsgAlreadyInGraph(e)}else this._showNotif({level:"error",msg:r.get("ActionWithoutSelection")})},splitCount:function(e,t,i){var n=[];e&&(e.forEach(function(e){let t=this.collection.get(e);t&&n.push(t.get("identifierData"))}.bind(this)),this.collection.getEcoSystem({items:n,relations:t||[],direction:i||"both"}),this._doContinueSearch())},_addInGraph:function(e,t){this._pathSelReq=!0,this._pathSelReqNodes=e,this._handleDrop("addInGraph",t)},_extractNode:function(e){this.showSpinner();var t=!1,i=this.collection.get(e.sourceIds).clone()._attributes;e.links.forEach(function(e){if(e.instance){if(i.instances){if(0===i.instances.filter(function(t){return t.id===e.instance}).length){let n=[...i.instances];n.push(e.instance),i.instances=n,t=!0}}else i.instances=[e.instance],t=!0;delete e.instance}}),t&&e.objects.unshift(i);var n=this.collection.parse(e);n.length>0?n.forEach(function(e){e===n[n.length-1]?this.collection.addModel(e,{external:!0,callback:this.render.bind(this)}):this.collection.addModel(e,{external:!0,silent:!0})}.bind(this)):(this.dispatchEvent("ENORIPE_noObjectToAdded"),this.hideSpinner())},printMap:function(e){var t;if("dataGridView"==this._currentLayout){if(!this._isWebInWin)return void this.dataGridView.collectionView.openPrintableViewWindow(!0);t=this.dataGridView.collectionView.generatePrintableViewHTML()}else t=this.getElements(".d3-map-view-container")[0].outerHTML;this.printHTML(t,e)},printHTML:function(e,t){setTimeout(function(){var i="";let n=window.document.styleSheets;for(let e=0;e<n.length;e++)i+='<link rel="stylesheet" type="text/css" href="'+n[e].href+'" />';const s="<!DOCTYPE html>\n              <html>\n                  <head>\n                      <title>Relations - Print</title>\n                      "+(i+='\n            <style type="text/css" media = "all">\n            @page {margin-top: 1cm; \tmargin-left: 1cm;}\n            #svg-root {overflow: visible; display: inline; zoom : 50%}\n            </style>\n          ')+"\n                  </head>\n                  <body>\n                    "+e+"\n                  </body>\n              </html>",o=URL.createObjectURL(new Blob([s],{type:"text/html"})),a=window.open(o,"_blank","width=1024,height=768,top=0,left=0,scrollbars=yes,status=no,resizable=yes");setTimeout(function(){!0===t?a.close():a.print(),a.close()},500)},0)},fitAllInMap:function(){if(this.mapView){var e={sidePanelWidth:0,actionBarHt:48};e.sidePanelWidth=this.listView.getWidth(),this.mapView.fitAllIn(e)}},switchLayout:function(e){if(this._currentLayout!=e){var t,i=this.collection.getNodesIds();if(t=this.getSelectedIds(!1),"linearGraph"===this._currentLayout&&0===t.length)return this._showNotif({level:"error",msg:r.get("commandWithoutSelection")}),void this._toolBarView.updateLayoutMenu();switch(i.length>N.getOption("navigatedNodeLimite")&&this.resetCollectionWithRoots(),this._currentLayout=e,N.setLayoutType(e),this.dispatchEvent("ENORIPE_SwitchLayout",e),this._toolBarView.updateLayout(),e){case"linearGraph":this.collection.getLinksAndNodes(!1);"recompute"===N.getLayoutMode()&&this.collection._setColumnOnNodes(),this.mapView&&(this.mapView.inject(this.container),this.mapView.show(),this._currentView=this.mapView),this.dataGridView&&this.dataGridView.hide(),this.dispatchEvent("ENORIPE_refreshMap",[{initWithNodes:this.collection.getIdentifierDataById(),needClear:!1,selectedNodes:t}]);break;case"dataGridView":this._currentView=this.dataGridView,this.clearMapSuccess(!0),this._initDatagridView(!0)}}},switchThumbnailsMode:function(e){"thumbnailsMode"===e?(this.getElement(".d3-map-view-container").removeClassName("no-thumbnails"),this.mapView.addMissingThumbnail(this.collection)):this.getElement(".d3-map-view-container").addClassName("no-thumbnails"),this.mapView.updateConstraints(this.collection.getLinksAndNodes(),this.collection.groupBy("columnID")),this.mapView.updateNodesYposition(e),this.getElements(".foreign-object-count-mobile").forEach(function(t){t.setAttribute("y","thumbnailsMode"===e?95:35)}),this.getElements(".colored-rect-bi").forEach(function(t){t.setAttribute("height","thumbnailsMode"===e?120:55)}),this.getElements("#toggleEcosystem").forEach(function(e){e.hasClassName("expandMenuDirection-in")?e.setAttribute("style","transform:translate(0px,"+(N.getNodesHeight()/2-30)+"px"):e.setAttribute("style","transform:translate("+N.getNodesWidth()+"px,"+(N.getNodesHeight()/2-30)+"px")})},editLayout:function(){var e=this._toolBarView.getCommand("EditLayout_Command");e&&this.mapView&&(e.hasClassName("pressed")?(e.removeClassName("pressed"),this.mapView.layoutingOff()):(C.trackUsage("Commands","EditLayout"),e.addClassName("pressed"),this.mapView.layoutingOn()))},excludeNodes:function(e,t){var i=[];(i=t?i.concat(t):i.concat(this.getSelectedIds())).length>0?this.collection.where({modelType:"node"}).length===i.length?this._showNotif({level:"error",msg:r.get("AllNodesExcluded")}):(this.collection.excludeElements(e,i),e&&this.dispatchEvent("ENORIPE_setExcludeNode",[i])):this._showNotif({level:"error",msg:r.get("ActionWithoutSelection")})},exportDatagrid:function(){this.dataGridView.exportAsCSV()},displayMsgAlreadyInGraph:function(e){var t="";switch(e){case"in":t=r.get("UpstreamAlreadyInGraph");break;case"out":t=r.get("DownstreamAlreadyInGraph");break;default:t=r.get("UpAndDownstreamAlreadyInGraph")}this._showNotif({level:"info",lvl:"primary",msg:t})},handleServerErrorMsgs:function(e){e&&("timeout"===e.type?(e.level="error",e.msg=r.get("timeout"),e.subtitle=r.get("verifyConnection")):"internalServerError"===e.type?(e.level="error",e.msg=r.get("internalServerError")):(e.level="error",e.msg=r.get("generic"))),this._spinner&&this.hideSpinner(),this._showNotif(e)},exportMsg:function(e){e.success?this._showNotif({level:"success",lvl:"success",msg:r.replace(r.get("InfoMsg.ExportSuccess"),{nbLines:e.nbLines})}):this._showNotif({level:"error",msg:r.replace(r.get("ErrorMsg.ExportLimit"),{nbLines:e.nbLines,exportLimit:N.getExportLimit()})})},maskMapView:function(){f.mask(this.container)},unmaskMapView:function(){f.unmask(this.container)},_saveForRefresh:function(e,t){this.dispatchEvent("ENORIPE_SaveForRefresh",[e,t])},_updateLastRootID:function(e){var t=this._lastRootID.filter(t=>!e.includes(t));t.length!=this._lastRootID&&this.dispatchEvent("ENORIPE_updateLastRootId",[t])},_updateCollectionWithView:function(){let e=[];this.collection.getNodesIds().forEach(function(t){this.dataGridView.getAllNodes(!0).indexOf(t)<0&&e.push(this.collection.get(t))}.bind(this)),e.length>0&&this.removeNodes(e)},resetCollectionWithRoots:function(){var e;(e=this.collection.where({modelType:"node",focus:!0,isCount:void 0})).length<N.getOption("navigatedNodeLimite")&&this._showNotif({level:"info",msg:r.replace(r.get("LoadingRootsOnly"),{limit:N.getOption("navigatedNodeLimite")})}),this.collection.reset(),e.forEach(function(t){t===e[e.length-1]?this.collection.addModel(e,{external:!0,callback:this.render.bind(this)}):this.collection.addModel(e,{external:!0,silent:!0})}.bind(this))},getSelectedIds:function(){return this.collection.where({focus:!0}).map(function(e){return e.id})},_getIdsSortedByColumn:function(e){for(var t=this.collection.sortBy("columnID"),i=[],n="",s=0;s<t.length;s++)if("link"!==t[s]._attributes.modelType){n=t[s]._attributes.id;for(var o=0;o<e.length;o++)if(n===e[o]){i.push(e[o]);break}}return i},_processSelection:function(e){var t=[],i=[...this._currentlyFilteredNodes,...this._currentlySearchedNodes],n=this._isFiltered||this._isSearched;return e.forEach(function(e){n?i.indexOf(e.get("id"))>-1&&t.push(e):t.push(e)}),t},_manageFirstFocusAndAnchor:function(e){var t=e&&e.length>0?e:this._lastRootID,i=w.getPref("ENORIPE_selectedNode")||[],n=[];if(i&&i.length>0){let e=this.collection.getNodesIds();i.forEach(function(t){e.indexOf(t)>-1&&n.push(this.collection.get(t))}.bind(this))}0===n.length&&t&&t.length>0&&(n=t.map(function(e){return this.collection.get(e)}.bind(this))),n.length>0&&n[0]&&(this._manageSelection({models:n,sAction:"add",origin:"MapView"}),this._setFirstFocusOnCompass=!0)},_manageFocus:function(){if(this._lastRootID&&0!==this._lastRootID.length){0===this.collection.where({modelType:"node",focus:!0,isCount:void 0}).length&&this._manageFirstFocusAndAnchor()}else this._initLastRootWithColumnId()},_initLastRootWithColumnId:function(){var e=[],t=[];t=Object.keys(this.collection.groupBy("columnID")).sort((e,t)=>e-t),this._lastRootID&&0!==this._lastRootID.length||(t.every(function(t){let i=parseInt(t);if(Number.isInteger(i)){let t=this.collection.where({modelType:"node",columnID:i});return!((e=t.map(function(e){return e.id})).length>0)}return!0}.bind(this)),this.dispatchEvent("setLastRootNodeID",[e]),this._currentView&&!this._currentView.isInitWithNodes()&&this._manageFirstFocusAndAnchor(e))},clearSelection:function(e,t){var i=[];e&&(h.viewContext=e),h.getSelectedIDs().forEach(function(e){this.collection.get(e)&&i.push(this.collection.get(e))}.bind(this)),this._manageSelection({models:i,sAction:"remove",origin:"MapView",caller:t}),h.clearMultiSel(0),this.mapView&&this.mapView.clearMultiSelection(),this._toolBarView&&(this._toolBarView.hideSelectionIcon(),this._toolBarView.disableSelectionAssistantCommand())},selectAllFromCmd:function(){var e,t;t=this.collection.where({modelType:"node"}),(e=this._processSelection(t)).length&&this._manageSelection({models:e,sAction:"add"})},selectOutFilteredFromComd:function(){var e=this._isFiltered||this._isSearched,t=[],i=[];e?(h.clearMultiSel(1),t=this._currentlyFilteredNodes,this.collection.where({modelType:"node"}).forEach(function(e){t.indexOf(e.get("id"))<0&&i.push(e)}),this._manageSelection({models:i,sAction:"add"})):this._showNotif({level:"info",lvl:"primary",msg:r.get("ActionWithoutFiltering")})},inverseSelectionFromCmd:function(){var e;e=h.getInverseSelection(),this._manageSelection({models:h.getSelected(),sAction:"remove"}),e.length>0&&this._manageSelection({models:e,sAction:"add"})},_manageSelection:function(e,t){this.pathPanel&&"PathPanel"!==e.caller&&this.pathPanel.emptyGridViewSelection();var i="string"==typeof e.models?[this.collection.get(e.models)]:e.models,n=!1;e.models&&(e.origin&&""!==h.viewContext&&(n=e.origin!==h.viewContext),"MapView"===e.origin?h.viewContext="MapView":"ListView"===e.origin&&(h.viewContext="ListView"),h.onObjectToMultiSel(i,e.sAction,n),this._toolBarView&&("remove"===e.sAction?this._toolBarView.disableSelectionAssistantCommand():this._toolBarView.enableSelectionAssistantCommand())),i.forEach(function(t){"add"===e.sAction?this._currentView.addToSelection(t.id,e.instanceId):"remove"===e.sAction&&this.removeFocus(t,e.instanceId)}.bind(this)),"add"===e.sAction&&i[0].id&&this.pathPanel&&!this.pathPanel.container.isHidden()&&!t&&this.managePathPanel(i[0].id),this.manageProperties(),this.updateToolbarSelectionIcon()},removeFocus:function(e,t){if("dataGridView"===N.getLayoutType()&&N.getInstancesMode()){let t=this.dataGridView.getAllNodesById(e.id);if(t.length>1){let i=0;t.forEach(function(e){e.isSelected()&&i++}),t.length<=i&&e.set("focus",!1)}else e.set("focus",!1)}else e.set("focus",!1);this._currentView.removeToSelection(e.id,t)},updateToolbarSelectionIcon:function(){0===this.getSelectedIds().length?(this._toolBarView&&(this._toolBarView.hideSelectionIcon(),this._toolBarView.disableSelectionAssistantCommand()),h.clearMultiSel(0)):this._toolBarView&&(this._toolBarView.showSelectionIcon(),this._toolBarView.enableSelectionAssistantCommand())},showSpinner:function(){this._spinner&&this._spinner.show(),this.dispatchEvent("Customize_LoadingRelations")},hideSpinner:function(){this._spinner&&this._spinner.hide()},_selectInGraph:function(e){if(e){if(0===e.length)return;var t,i=[],n=this;e.forEach(function(e){(t=n.collection.get(e))&&"node"===t.get("modelType")&&i.push(t)}),h.viewContext="MapView",this._manageSelection({models:i,sAction:"add"},!0)}},nodeClicked:function(e,t){var i=this.collection.get(e);if(i){this.currentModelClicked=i,this._manageSelection({models:e,sAction:t,origin:"MapView"});this.collection.where({modelType:"node",focus:!0});this._doContinueSearch()}},clearFilterBySearch:function(){if(this._isPreviewPanelOpen&&this.previewView)return this.previewView.clearSearch(),void(this._pager&&this._pager.closePager());this._isSearched=!1,this._continueSearch=!1,this._currentlySearchedNodes=[],this._isFiltered&&this._lastFilterData?this.filter(this._lastFilterData):(this._currentView.endFilter(),this.updateFilterProxy()),this._pager&&this._pager.closePager()},_doContinueSearch:function(){this._isWebInWin||(this._isSearched?this._continueSearch=!0:this._continueSearch=!1)},_onPager:function(e){this._pager||(this._pager=new M({debugMode:this._debug,isWebInWin:this._isWebInWin}),this.listenTo(this._pager,"ENORIPE_NavPagerClose",this.clearFilterBySearch),this.listenTo(this._pager,"ENORIPE_HighlightNode",this._highlightNodeByPager),this._pager.inject(this.container)),this._continueSearch&&(e.noChangeFocus=!0),this._pager.render(e)},_highlightNodeByPager:function(e){if(this._isPreviewPanelOpen)this.previewView.selectNode(e);else if(this.clearSelection(),"All"===e)this.selectAllFromCmd();else{var t=this.collection.get(e);this._manageSelection({models:[t],sAction:"add"})}},_initTagger:function(){var e=this;if(!this.taggerServices){this.summariesForVolatileTags=[{count:-1,dispValue:r.get("Synchronized"),object:"Synchronized",sixw:"ds6w:what/"+r.get("SynchronizationStatusPredicate"),type:"string",value:"Synchronized"},{count:-1,dispValue:r.get("NotSynchronized"),object:"NotSynchronized",sixw:"ds6w:what/"+r.get("SynchronizationStatusPredicate"),type:"string",value:"NotSynchronized"},{count:-1,dispValue:r.get("Unknown"),object:"Unknown",sixw:"ds6w:what/"+r.get("SynchronizationStatusPredicate"),type:"string",value:"Unknown"},{count:-1,dispValue:r.get("In"),object:"In",sixw:"ds6w:what/"+r.get("LoopsPredicate"),type:"string",value:"In"},{count:-1,dispValue:r.get("Out"),object:"Out",sixw:"ds6w:what/"+r.get("LoopsPredicate"),type:"string",value:"Out"},{count:-1,dispValue:r.get("Yes"),object:"Yes",sixw:"ds6w:what/"+r.get("IsLastVersionPredicate"),type:"string",value:"Yes"},{count:-1,dispValue:r.get("No"),object:"No",sixw:"ds6w:what/"+r.get("IsLastVersionPredicate"),type:"string",value:"No"}];var t={};t["ds6w:what/"+r.get("SynchronizationStatusPredicate")]=[{color:"#57B847",object:"Synchronized",type:"string"},{color:"#EA4F37",object:"NotSynchronized",type:"string"},{color:"#FFA500",object:"Unknown",type:"string"}],t["ds6w:what/"+r.get("LoopsPredicate")]=[{color:"#EA4F37",object:"In",type:"string"},{color:"#57B847",object:"Out",type:"string"}],t["ds6w:what/"+r.get("IsLastVersionPredicate")]=[{color:"#57B847",object:"Yes",type:"string"},{color:"#EA4F37",object:"No",type:"string"}],this.taggerServices=new P({widgetId:this._widgetId,addVolatileTags:!0,summariesForVolatileTags:this.summariesForVolatileTags,colorMapsForVolatileTags:t,taggerProxyOptions:{activateSelection:!0}}),this.taggerServices.addEvent("Tagger_FilterBIColorize",function(t){e.onFilterBIColorize(t)}),this.taggerServices.addEvent("Tagger_FilterBIUnColorize",function(){e.onFilterBIUnColorize()}),this.taggerServices.addEvent("Tagger_FilterBIFilteringEvent",function(t){e.onFilterBIFilteringEvent(t)}),this.taggerServices.addEvent("Tagger_ColorizeVolatile",function(t){t.isVolatileData=!0,e.onFilterColorizeVolatile(t)}),this.taggerServices.addEvent("Tagger_FilteringVolatile",function(t){t.isVolatileData=!0,e.onFilterVolatile(t)}),this.taggerServices.addEvent("Tagger_FilterBISelection",function(t){e.clearSelection(),e.onFilterSelection(t)}),this.taggerServices.addEvent("Tagger_SelectVolatile",function(t){e.onFilterSelectionVolatile(t)})}},updateFilterProxy:function(e,t){var i=[];e||this.collection.filter(function(e){if("node"===e.get("modelType")&&(i.push(e.get("id")),e.get("instancesExpanded")>0&&e.get("instances")))for(var t=0;t<e.get("instancesExpanded");t++)i.push(e.get("instances")[t].id)});var n=[],s=[];this.collection.filter(function(e){if("link"===e.get("modelType")){var t=e.get("type");if(-1===s.indexOf(t)){s.push(t);var i={count:-1,dispValue:r.get(t),object:t,sixw:"ds6w:what/"+r.get("RelationsPredicate"),type:"string",value:t};n.push(i)}}});var o=this.summariesForVolatileTags.concat(n);this.taggerServices.updateVolatileTags(o),this.taggerServices.updateFilterProxy(i,e)},onFilterBIFilteringEvent:function(e){this._appliedTags=0,this.filter(e)},onFilterBIColorize:function(e,t){var i={matchingIDs:[],filteredLinks:[]};e&&(i.matchingIDs=e),t&&(i.filteredLinks=t),(e||t)&&(this.onFilterBIUnColorize(),this._currentView.colorize(i))},onFilterBIUnColorize:function(){this._currentView.unColorize()},onFilterSelectionVolatile:function(e){if(e){var t={},i={},n=[];t.matchingIDs=e.matchingIDs,delete e.matchingIDs,t.allfilters=e,t.matchingIDs&&t.matchingIDs.length>0&&this.onFilterSelection(t),n=Object.keys(t.allfilters),this.addLoader(),this.clearSelection(),n.forEach(function(e){switch(t.matchingIDs=this.collection.getNodesIds(),e){case"ds6w:what/"+r.get("SynchronizationStatusPredicate"):this.dispatchEvent("SelectSynchro",t);break;case"ds6w:what/"+r.get("LoopsPredicate"):i=this.loopFiltering(t),this.onFilterSelection(i);break;case"ds6w:what/"+r.get("IsLastVersionPredicate"):this.dispatchEvent("SelectVersion",t);break;case"ds6w:what/"+r.get("RelationsPredicate"):i=this.relationsFiltering(t),this.onFilterSelection(i);break;default:this.removeLoader()}}.bind(this))}},onFilterColorizeVolatile:function(e){if(e&&e.tagColors&&e.tagColors.length>0)switch(this.addLoader(),this.onFilterBIUnColorize(),e.tagColors[0].predicate){case"ds6w:what/"+r.get("SynchronizationStatusPredicate"):this.dispatchEvent("ColorizeSynchro",e);break;case"ds6w:what/"+r.get("LoopsPredicate"):this.loopColorize(e);break;case"ds6w:what/"+r.get("IsLastVersionPredicate"):this.dispatchEvent("ColorizeVersion",e);break;case"ds6w:what/"+r.get("RelationsPredicate"):this.colorizeRelations(e);break;default:this.removeLoader()}},onFilterVolatile:function(e){this._appliedTags=0;e.matchingIDs;var t={};this.collection.filter(function(e){return"node"===e.get("modelType")});if(e&&e.allfilters){var i="";this.addLoader(),"linearGraph"===this._currentLayout&&(this.mapView._filteredOpacity=!1),this._currentView.endFilter();for(var n="",s=0;s<Object.keys(e.allfilters).length;s++){switch(i=Object.keys(e.allfilters)[s]){case"ds6w:what/"+r.get("SynchronizationStatusPredicate"):this.dispatchEvent("FilteringSynchro",e);break;case"ds6w:what/"+r.get("LoopsPredicate"):t=this.loopFiltering(e),this.filter(t);break;case"ds6w:what/"+r.get("IsLastVersionPredicate"):this.dispatchEvent("FilteringVersion",e);break;case"ds6w:what/"+r.get("RelationsPredicate"):t=this.relationsFiltering(e),this.filter(t);break;default:this.removeLoader()}var o=e.allfilters[i];o&&o.length&&o.forEach(function(e){n=n+e.object+","})}n.length>0&&(n=n.substr(0,n.length-1),C.trackMultiUsage("volatileTagUsage","volatileTagUsage",[i,n]))}},onFilterSelection:function(e){var t=[];e.matchingIDs&&e.matchingIDs.length>0&&(e.matchingIDs.forEach(function(e){this.collection.get(e)&&t.push(this.collection.get(e))}.bind(this)),t.length>0&&this._manageSelection({models:t,sAction:"add"})),this.removeLoader(),this.taggerServices.setSelectStatus()},colorizeSynchro:function(e){e.colorMap={};for(var t=0;t<e.tagColors.length;t++)e[e.tagColors[t].object]&&e[e.tagColors[t].object].forEach(function(i){e.colorMap[i]=e.tagColors[t].color});this.onFilterBIColorize([],e),this.removeLoader()},colorizeRelations:function(e){var t={};e.colorMap={};for(var i=0;i<e.tagColors.length;i++)t[e.tagColors[i].object]=e.tagColors[i].color;this.collection.filter(function(i){"link"===i.get("modelType")&&(e.colorMap[i.id]=t[i.get("type")])}),this.onFilterBIColorize([],e),this.removeLoader()},colorizeVersion:function(e){var t={};e.colorMap=[];for(var i=0;i<e.tagColors.length;i++)t[e.tagColors[i].object]=e.tagColors[i].color;this.collection.filter(function(i){"node"===i.get("modelType")&&(Object.values(e.lastVersionNodes).indexOf(i.id)>-1?e.colorMap.push({id:i.id,color:t.Yes}):Object.values(e.notLastVersionNodes).indexOf(i.id)>-1&&e.colorMap.push({id:i.id,color:t.No}))}),this.onFilterBIColorize(e.colorMap),this.removeLoader()},loopColorize:function(e){e.forColorize=!0;var t,i,n=[];e=this.loopFiltering(e);for(var s=0;s<e.tagColors.length;s++)"In"===e.tagColors[s].object?t=e.tagColors[s].color:"Out"===e.tagColors[s].object&&(i=e.tagColors[s].color);for(var o=0;o<e.inLoopNodes.length;o++)n.push({id:e.inLoopNodes[o],color:t});for(var a=0;a<e.outLoopNodes.length;a++)n.push({id:e.outLoopNodes[a],color:i});this.onFilterBIColorize(n),this.removeLoader()},loopFiltering:function(e,t){var i={excluded:!0,tags:[]},n=[],s=[];if(!e.forColorize)for(var o in e.allfilters)if(e.allfilters.hasOwnProperty(o)){o!=="ds6w:what/"+r.get("LoopsPredicate")&&!0;for(var a=0;a<e.allfilters[o].length;a++)if(!e.allfilters[o][a].excluded){i.excluded=!1;break}for(a=0;a<e.allfilters[o].length;a++)"In"!==e.allfilters[o][a].object&&"Out"!==e.allfilters[o][a].object||!e.allfilters[o][a].excluded!=!i.excluded||i.tags.push(e.allfilters[o][a].object)}for(var l=this._layoutUtils.findLoops(),d=0;d<l.length;d++)for(var c=l[d],h=0;h<c.length;h++){n.push(c[h]);var u=this.collection.get(c[h]);if(u&&u.get("instancesExpanded")>0&&u.get("instances"))for(a=0;a<u.get("instances").length;a++)n.push(u.get("instances")[a].id)}if(this.collection.filter(function(e){if("node"===e.get("modelType")&&n.indexOf(e.id)<0&&(s.push(e.id),e.get("instancesExpanded")>0&&e.get("instances")))for(a=0;a<e.get("instances").length;a++)s.push(e.get("instances")[a].id)}),e.forColorize)return e.inLoopNodes=n,e.outLoopNodes=s,e;for(a=0;a<i.tags.length;a++)"In"===i.tags[a]?i.excluded?e.matchingIDs=e.matchingIDs.filter(function(e){return n.indexOf(e)<0}):e.matchingIDs=n.filter(function(t){return e.matchingIDs.indexOf(t)>-1}):"Out"===i.tags[a]&&(i.excluded?e.matchingIDs=e.matchingIDs.filter(function(e){return s.indexOf(e)<0}):e.matchingIDs=s.filter(function(t){return e.matchingIDs.indexOf(t)>-1}));return e.isLoopData=!0,e},relationsFiltering:function(e){var t={excluded:!0,tags:[]},i={},n={},s=[];for(var o in e.filteredLinks=[],e.matchingIDs||(e.matchingIDs=[]),e.allfilters)if(e.allfilters.hasOwnProperty(o)&o==="ds6w:what/"+r.get("RelationsPredicate")){for(var a=0;a<e.allfilters[o].length;a++)if(!e.allfilters[o][a].excluded){t.excluded=!1;break}for(a=0;a<e.allfilters[o].length;a++)!e.allfilters[o][a].excluded==!t.excluded&&t.tags.push(e.allfilters[o][a].object)}return this.collection.filter(function(i){"link"===i.get("modelType")&&(t.excluded?t.tags.indexOf(i.get("type"))<0&&e.filteredLinks.push(i.id):-1!==t.tags.indexOf(i.get("type"))&&e.filteredLinks.push(i.id))}),this.collection.filter(function(t){if("link"===t.get("modelType")&&e.filteredLinks.indexOf(t.id)>-1){if(i=t.get("source"),n=t.get("target"),i.id&&s.indexOf(i.id)<0&&(s.push(i.id),i.instancesExpanded>0&&i.instances))for(var o=0;o<i.instances.length;o++)s.push(i.instances[o].id);if(n.id&&s.indexOf(n.id)<0&&(s.push(n.id),n.instancesExpanded>0&&n.instances))for(o=0;o<n.instances.length;o++)s.push(n.instances[o].id);t.get("instanceTargetId")&&s.indexOf(t.get("instanceTargetId"))<0&&s.push(t.get("instanceTargetId"))}}),e.matchingIDs=s.filter(function(t){return e.matchingIDs.indexOf(t)>-1}),e},filter:function(e){this._lastFilterData=e,Object.keys(e.allfilters).length>0?(this._isFiltered=!0,this._currentlyFilteredNodes=this._currentView.filter(e),e.isVolatileData&&this.updateFilterProxy(e.isVolatileData)):(this._isFiltered=!1,this._currentlyFilteredNodes=[],this._isSearched?(this._currentView.filter({matchingIDs:this._currentlySearchedNodes}),this.updateFilterProxy(e.isVolatileData,this._currentlySearchedNodes)):("linearGraph"===this._currentLayout&&this.mapView&&(this.mapView._filteredOpacity=!1),this._currentView.endFilter(!0))),this._appliedTags++,this._appliedTags===Object.keys(e.allfilters).length&&this.removeLoader()},filterBySearch:function(t){var i=e.clone(t);i=this._isPreviewPanelOpen?this.previewView.getIdsSorted(i):this._getIdsSortedByColumn(i),this._onPager({result:i}),this._isPreviewPanelOpen?this.previewView.filterBySearch(t):(this._isSearched=!0,this._currentlySearchedNodes=t,this._currentView.filter({matchingIDs:t})),0===i.length?this._showNotif({level:"error",msg:r.get("No-SearchMatch")}):this.updateFilterProxy(this._currentlySearchedNodes)},_OnRightClick:function(t){if(this._isWebInWin){var i=this.collection.get(t.id);if(this._theContextualMenuTarget.targetId=t.id,this._theContextualMenuTarget.context=t.context,e.is(i)){e.is(this._theContextualMenu)&&this._theContextualMenu.destroy();var n=[];(n=h.getSelectedIDs()).includes(t.id)||(n=[t.id]),c.sendToMapWebInWin("onComputeCtxMenu",n)}}},_onCtxMenuItem:function(e){if(this._isWebInWin){var t=h.getSelectedIDs();c.sendToMapWebInWin("onCtxMenuClick",t,e.action)}},SetContextualMenu:function(t){if(this._isWebInWin){var i,n=this,s=h.getSelectedIDs();if(s=s.length?s:[this._theContextualMenuTarget.targetId],i=c.ComputeContextualMenu(this,t),e.is(i))switch(i=i.filter(function(e){return"CATRelNavWebInWinCmdHdr"!==e.actionId}),this._theContextualMenuTarget.context){case"D3MapView":var o=this._theContextualMenuTarget.targetId,a=this.getElement("#container-"+CSS.escape(o)),l={id:"previewEcosys",text:r.get("previewUpAndDownstream"),icon:k.getWebappsAssetUrl("SNNavigationMap","icons/preview.png"),handler:function(){n._showPreview({modelId:o})}};i.push(l),this._theContextualMenu=new d({isContextual:!0,target:a,items:i}),this._theContextualMenu.show(),this._theContextualMenuTarget={};break;case"DataGridView":o=this._theContextualMenuTarget.targetId,a=this.getElement("#container-"+CSS.escape(o));var u=this.dataGridView.getRightClickModel();u&&this.dataGridView.getExpandCollapseCtxMenu(u,!0).then(function(e){i=[...i,...e],this._theContextualMenu=new d({isContextual:!0,target:a,items:i}),this._theContextualMenu.show(),this._theContextualMenuTarget={}}.bind(this));break;case"PreviewGroup":o=this._theContextualMenuTarget.targetId,a=this._theContextualMenuTarget.targetElement;o&&a&&(this._theContextualMenu=new d({isContextual:!0,target:a,items:i}),this._theContextualMenu.show(),this._theContextualMenuTarget={});break;case"FindPath":var g=this._theContextualMenuTarget.targetId,p=(a=this._theContextualMenuTarget.targetElement,this._theContextualMenuTarget.typeOfPath);if(g&&a){if("StructurePath"==p){var f=this._theContextualMenuTarget.jsonMsgForOpen,m=this._theContextualMenuTarget.jsonMsgForAddInGraph,v={accelerator:"Ctrl+O",availabilityMode:"Normal=YES CommandSet=YES Editability=YES SmallScale=YES LargeScale=YES ",id:"OpenSearch",multisel:!0,text:r.get("open"),icon:"I_OpenDB",handler:function(){c.sendStringRelationsToWebInWin("onOpenPathClick",f)}};i.push(v);var _={id:"findPathAddInGraph",text:r.get("FindPathAddInGraph"),icon:"I_AddResource",handler:function(){n._addInGraph(g,m)}};i.push(_)}else{v={accelerator:"Ctrl+O",availabilityMode:"Normal=YES CommandSet=YES Editability=YES SmallScale=YES LargeScale=YES ",id:"OpenSearch",multisel:!0,text:r.get("open"),icon:"I_OpenDB",handler:function(){c.sendToMapWebInWin("onCtxMenuClick",g,"OpenSearch")}};i.push(v);var S={id:"selectInGraphItem",text:r.get("FindPathSelectInGraph"),icon:"I_Select",handler:function(){n._selectInGraph(g)}};i.push(S)}this._theContextualMenu=new d({isContextual:!0,target:a,items:i}),this._theContextualMenu.show(),this._theContextualMenuTarget={}}}}},addLoader:function(){f.mask(this.container)},removeLoader:function(e){this.hideSpinner(),f.unmask(this.container)},_showNotif:function(e){if(c.isWebInWin()){this.alert&&this.alert.destroy();var t=e.container||this.container;this.alert=new p({visible:!0,autoHide:!0,hideDelay:3e3,animate:!0}).inject(t);var i="";return e.title&&(i+=e.title),e.subtitle&&(i+=e.subtitle),e.msg&&(i+=e.msg),this.alert.add({className:e.lvl?e.lvl:"error",message:i}),void this.alert.elements.container.setStyle("top","40px")}this._notifManager.addNotif({level:e.level,message:e.msg,title:e.title?e.title:"",subtitle:e.subtitle?e.subtitle:"",sticky:!1})},clearMapClick:function(){var e=this,t=new m({renderTo:e.container}),i=r.get("ClearConfirmHeader"),n=r.get("ClearConfirmBody");t.dialog({body:n,title:i,buttons:[{className:"primary",value:r.get("ClearView_ClearButton"),action:function(t){e.dispatchEvent("ENORIPE_ClearMap"),t.hide()}},{value:r.get("ClearView_Cancel"),action:function(e){e.hide()}}]})},clearMapFailure:function(){this._notifManager.addNotif({level:"info",message:r.get("clearView_failure"),sticky:!1})},clearMapSuccess:function(t){t||(this._isEmpty=!0),this._toolBarView&&(this._toolBarView.hideSelectionIcon(),this._toolBarView.disableSelectionAssistantCommand()),this.collection&&!t&&(this.collection.reset(),h&&(h.handleClearMap(),h.clearMultiSel(0))),e.is(this.mapView)&&(this.mapView.destroy(),this.mapView=null),e.is(this.dataGridView)&&!t&&(this.dataGridView.destroy(),this.dataGridView=null),e.is(this.listView)&&(this.listView.hidePanel(),this.listView.clearPanel(),this._infoPanelCommandClick=!1),e.is(this._pager)&&(this._pager.destroy(),this._pager=null),this._initEmptyMap(!0)},destroy:function(){this.stopListening(this.collection),this.stopListening(this.mapView),this.stopListening(this.listView),this.stopListening(this._dropZone),this.stopListening(this.pathPanel),this.collection.reset(),this.container=null,this._parent()}})}),define("DS/SNNavigationMap/views/CustomizeAllView",["UWA/Core","UWA/Class/View","DS/WebappsUtils/WebappsUtils","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Tab","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/SNNavigationMap/views/CustomizeRelationsView","DS/SNNavigationMap/views/CustomizeAttributeView","DS/SNNavigationMap/views/DisplayOptionsView","DS/SNNavigationMap/utils/SNNavigationServices","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a,r,l,d,c,h,u,g,p,f){"use strict";return t.extend({name:"CustomizeAll",_dialog:null,className:function(){return this.getClassNames("-container")},setup:function(e){this._immersiveFrame=new n,this._immersiveFrame.inject(this.container),this.dimensions={},this.dimensions.position={},this.dimensions.dialogWidth=800,this.dimensions.dialogHeight=500,this.dimensions.position.offsetY=0,this.dimensions.position.offsetY=0,this._changesInTabs={CustomizeRelations:!1,CustomizeAttributes:!1,DisplayOptions:!1},this._customizeRelationsOptions=e},render:function(e,t){if(null===this._dialog){var i=this._getDialogBody(e,t);this._createDialog(i)}else{if(this._customizeRelationsView)this._customizeRelationsView.resizeDatagrid();else if(this.customizeTab)this.customizeTab.getPageContentFromValue("CustomizeRelations").innerHTML=this._getErrorDiv(f.get("SNNavigationMap.CustomizeRelations.Title")).outerHTML;if(this._customizeAttributesView)this._customizeAttributesView.refreshRender(t);else if(this.customizeTab)if(null!=t)this.customizeTab.setPageContentFromValue("CustomizeAttributes",this._getCustomizeAttributesContent(t));else this.customizeTab.getPageContentFromValue("CustomizeAttributes").innerHTML=this._getErrorDiv(f.get("SNNavigationMap.CustomizeAttributes.Title")).outerHTML}this._immersiveFrame.elements.container.setStyle("z-index",300)},showRelations:function(e){this._customizeRelationsView&&this._customizeRelationsView.showRelations(e)},updateProfile:function(e){this._customizeRelationsView&&this._customizeRelationsView.updateProfile(e)},relationSetSaved:function(e){this._customizeRelationsView.alertRelationSetSaved(e)},relationSetDeleted:function(e){this._customizeRelationsView.alertRelationSetDeleted(e)},updateRelationsDisplayed:function(e,t){this._customizeRelationsView.updateRelationsDisplayed(e,t)},loadingCustomizeRelations:function(){this._customizeRelationsView&&this._customizeRelationsView.loadingRelations()},unloadCustomizeRelations:function(){this._customizeRelationsView.unloadRelations()},_updateSaveButton:function(e){if(this._dialog){e&&(this._changesInTabs[e.tabName]=e.areThereChanges);var t=Object.values(this._changesInTabs);this._dialog.buttons.Save.disabled=t.every(e=>!1===e)}},_createDialog:function(e){this._dialog=new s({title:f.get("SNNavigationMap.CustomizeAll.Title"),content:e,immersiveFrame:this._immersiveFrame,expandedFlag:!1,width:this.dimensions.dialogWidth,height:this.dimensions.dialogHeight,minWidth:400,minHeight:250,resizableFlag:!0,position:{at:"top left",my:"top left",offsetX:this.dimensions.position.offsetX,offsetY:this.dimensions.position.offsetY},buttons:{Cancel:new o({label:f.get("SNNCustomize_Cancel"),onClick:function(){this.areThereChangesInTabs()?this.showCancelConfirmationDialog():this._cancelClick()}.bind(this)}),Save:new o({label:f.get("SNNCustomize_Save"),onClick:function(){let e=!this._customizeRelationsView.isProfileAutoCompleteEmpty(),t=this._customizeAttributesView.areThereEnoughAttributes();e&&t?this._okClick():this.showCancelConfirmationDialog(e,t)}.bind(this)})},modalFlag:!0}),this._dialog.buttons.Save.disabled=!0,this._dialog.close=function(){this.areThereChangesInTabs()?this.showCancelConfirmationDialog():this._cancelClick()}.bind(this)},_getDialogBody:function(t,i){var n=new e.createElement("div",{class:"customize-all-dialog-body"});return this._getDialogTabBarComponentContent(t,i).inject(n),n},_getDialogTabBarComponentContent:function(e,t){this.customizeTab=new a({displayStyle:"strip",touchMode:!0});var i=null;i=null!=e?this._getCustomizeRelationsContent(e):this._getErrorDiv(f.get("SNNavigationMap.CustomizeRelations.Title")),this.customizeTab.add({label:f.get("SNNavigationMap.Customize.Title"),isSelected:!0,value:"CustomizeRelations",content:i,icon:{iconName:"object-related-cog",fontIconFamily:WUXManagedFontIcons.Font3DS}});var n=null;return n=null!=t?this._getCustomizeAttributesContent(t):this._getErrorDiv(f.get("SNNavigationMap.CustomizeAttributes.Title")),this.customizeTab.add({label:f.get("CustomizeAttr-Attributes"),content:n,value:"CustomizeAttributes",icon:{iconName:"attributes-cog",fontIconFamily:WUXManagedFontIcons.Font3DS}}),this.customizeTab.add({label:f.get("SNNavigationMap.CustomizeDisplayOptions.Title"),content:this._getDisplayOptionsContent(),value:"DisplayOptions",icon:{iconName:"eye-cog",fontIconFamily:WUXManagedFontIcons.Font3DS}}),this.customizeTab},_getCustomizeRelationsContent:function(t){var i=new e.createElement("div",{class:"customize-all-tab-content customize-relations-content"});return this._customizeRelationsView=new d(this._customizeRelationsOptions),this._customizeRelationsView.inject(i),this._setUpListenEventsForCustomizeRelationsView(),this._customizeRelationsView.render(t),i},_getCustomizeAttributesContent:function(t){var i=this,n=new e.createElement("div",{class:"customize-all-tab-content customize-attributes-content"});return this._customizeAttributesView=new c({iswebinwin:u.isWebInWin()}),this._customizeAttributesView.inject(n),i.listenTo(i._customizeAttributesView,"CustomizeAllView_updateSaveButton",i._updateSaveButton),this.listenTo(this._customizeAttributesView,"CustomizeAllView_UpdateAttributes",e=>{i.dispatchEvent("ENORIPE_UpdateAttributes",e)}),this._customizeAttributesView.render(t),n},_getDisplayOptionsContent:function(){var t=new e.createElement("div",{class:"customize-all-tab-content customize-displayoptions-content"});return this._displayOptionsView=new h,this._displayOptionsView.inject(t),this._setUpListenEventsForDisplayOptionsView(),this._displayOptionsView.render(),t},_getErrorDiv:function(t){let i=f.replace(f.get("SNNavigationMap.CustomizeErrorDiv.Msg"),{tabName:t});return e.createElement("div",{class:"customize-error-div",html:i})},showCancelConfirmationDialog:function(t=!0,n=!0){var s=f.get("Customize-SaveText");if(n||(s=f.get("SNNavigationMap.CustomizeAll.SaveModal.AtLeast3AttributesSelectedMsg")),t||(s=f.get("SNNavigationMap.CustomizeAll.SaveModal.NoRelationSetSelectedMsg")),this.modalSave)this.modalSave.getBody().getElement(".modalBody-text").innerHTML=s,this.modalSave.show();else{this.modalSave=new r({className:"modal-save modalWarning",closable:!0,header:"<h4>"+f.get("SNNavigationMap.CustomizeAll.SaveModal.Title")+"</h4>"}).inject(this.container);var o=e.createElement("div",{class:"actionButton-container"});new l({value:f.get("SNNCustomize_Save"),className:"primary save",events:{onClick:function(){this._okClick(),this.modalSave.hide()}.bind(this)}}).inject(o),new l({value:f.get("dontSave"),className:"default dontSave",events:{onClick:function(){this._cancelClick(),this.modalSave.hide()}.bind(this)}}).inject(o),new l({value:f.get("cancel"),className:"default cancel",events:{onClick:function(){this.modalSave.hide()}.bind(this)}}).inject(o),this.modalSave.setFooter(o);var a=e.createElement("div",{class:"modalBody-container"});e.createElement("img",{class:"modalBody-icon",src:i.getWebappsAssetUrl("SNNavigationMap","icons/warning_icon.png")}).inject(a);var d=e.createElement("div",{class:"modalBody-text-container"}).inject(a);e.createElement("span",{class:"modalBody-question",html:f.get("Customize-SaveQuestion")}).inject(d),e.createElement("span",{class:"modalBody-text",html:s}).inject(d),this.modalSave.setBody(a),this.modalSave.show()}},areThereChangesInTabs:function(){return Object.values(this._changesInTabs).some(function(e){if(!0===e)return!0})},_setUpListenEventsForCustomizeRelationsView:function(){var e=this;e.listenTo(e._customizeRelationsView,"CustomizeAllView_UpdateSaveButton",e._updateSaveButton),e.listenTo(e._customizeRelationsView,"CustomizeAllView_UpdatePref",(t,i)=>{e.dispatchEvent("ENORIPE_updatePref",[t,i])}),e.listenTo(e._customizeRelationsView,"CustomizeAllView_UpdateRelations",t=>{e.dispatchEvent("ENORIPE_updateRelations",t)}),e.listenTo(e._customizeRelationsView,"CustomizeAllView_CreateNewProfile",t=>{e.dispatchEvent("ENORIPE_CreateNewProfile",t)}),e.listenTo(e._customizeRelationsView,"CustomizeAllView_SaveNewProfile",t=>{e.dispatchEvent("ENORIPE_SaveNewProfile",t)}),e.listenTo(e._customizeRelationsView,"CustomizeAllView_DeleteProfile",(t,i)=>{e.dispatchEvent("ENORIPE_DeleteProfile",[t,i])}),e.listenTo(e._customizeRelationsView,"CustomizeAllView_SetRecentRelationSet",t=>{e.dispatchEvent("ENORIPE_SetRecentRelationSet",[t])})},_setUpListenEventsForDisplayOptionsView:function(){var e=this;e.listenTo(e._displayOptionsView,"CustomizeAllView_updateSaveButton",e._updateSaveButton),e.listenTo(e._displayOptionsView,"CustomizeAllView_updateDisplayOptions",t=>{e.dispatchEvent("ENORIPE_updateDisplayOptions",t)})},_okClick:function(){this._changesInTabs.CustomizeRelations&&(this._customizeRelationsView.save(),p.trackUsage("CustomizePanel","ChangesOnCustomizeRelations")),this._changesInTabs.CustomizeAttributes&&(this._customizeAttributesView.save(),p.trackUsage("CustomizePanel","ChangesOnCustomizeAttributes")),this._changesInTabs.DisplayOptions&&(this._displayOptionsView.save(),p.trackUsage("CustomizePanel","ChangesOnDisplayOptions")),this.destroyCurrentDialog(),this._updateSaveButton()},_cancelClick:function(){(this._changesInTabs.CustomizeRelations||this._customizeRelationsView.isProfileAutoCompleteEmpty())&&this._customizeRelationsView.cancel(),this._changesInTabs.CustomizeAttributes&&this._customizeAttributesView.cancel(),this._changesInTabs.DisplayOptions&&this._displayOptionsView.cancel(),this.destroyCurrentDialog(),this._updateSaveButton()},destroyCurrentDialog:function(){this._immersiveFrame.elements.container.setStyle("z-index",0),this.dimensions.dialogWidth=this._dialog.width,this.dimensions.dialogHeight=this._dialog.height,this.dimensions.position.offsetX=this._dialog.position.offsetX,this.dimensions.position.offsetY=this._dialog.position.offsetY,this._dialog._applyPosition(),this._changesInRelationsTab=!1,this._changesInAttributesTab=!1,this._changesInDisplayOptionsTab=!1,this._changesInTabs={CustomizeRelations:!1,CustomizeAttributes:!1,DisplayOptions:!1},this.hide()}})}),define("DS/SNNavigationMap/ENORIPE",["UWA/Class","UWA/Core","UWA/Promise","DS/SNNavigationMap/utils/PromisesManager","DS/SNNavigationMap/MapSettings","DS/SNNavigationMap/utils/ProbesUtils","DS/SNNavigationMap/views/NavigationApp","DS/SNNavigationMap/views/NavigationHomePage","DS/SNNavigationMap/views/CustomizeAllView","DS/SNNavigationMap/collections/NavigationCollection","DS/SNNavigationMap/utils/SNNavigationServices","DS/SNNavigationMap/utils/RelationsServices","DS/ENOFilterBIUX/FilterBIComponentProxy","DS/SNNavigationMap/utils/LayoutUtils","DS/SNNavigationMap/utils/SearchUtils","DS/SNNavigationMap/utils/CommonUtils","DS/SNNavigationMap/utils/PreferencesUtils","DS/UIKIT/Modal","DS/UIKIT/Iconbar","DS/UIKIT/Input/Button","DS/WAFData/WAFData","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/SNNavigationMap/utils/NlsManager","i18n!DS/SNNavigationMap/assets/nls/SNNavigationMap_internal"],function(e,t,i,n,s,o,a,r,l,d,c,h,u,g,p,f,m,v,_,S,b,N,w,C,I,E){"use strict";return e.extend({excludedNodes:[],currentProfile:"",_navigatedNodes:{},_currentRelations:[],_groupedRelations:{},_activeProfiles:[],_availableRelations:[],_lastSavedValues:{},_isHomePageVisible:!1,_preSelectedObjectIds:[],_tempPreferences:[],_isWebInWin:c.isWebInWin(),init:function(e){var i=this;if(t.merge(E,I.getNls()),o.setStartTime("init"),this._widget=e.widget||null,this.container=e.renderTo||null,this._navigatedNodes=m.getPref("ENORIPE_navigatedNodes")||{},this._addinMode=widget?widget.getValue("addinmode"):null,e.initWithNodes){if(e.initWithNodes="string"==typeof e.initWithNodes?JSON.parse(e.initWithNodes):e.initWithNodes,Array.isArray(e.initWithNodes)){let t={};e.initWithNodes.forEach(function(e){t[e]={id:e,instances:[]}}),e.initWithNodes=t}}else e.initWithNodes={};var a=e.initWithNodes||{};this._errorOnInit=e.errorOnInit,this._inAppOptions=e.inAppOptions,this._isWebInWin&&(this.container=t.extendElement(this.container)),s.setOption("iswebinwin",this._isWebInWin),this._PM=new n({debugMode:"1"===s.getOption("debug_me")}),this._notifManager=w,C.setNotificationManager(this._notifManager),this._widget&&(this._widgetId=this._widget&&this._widget.id?this._widget.id:void 0,this._widgetStateAtInit=this._widget.getView?this._widget.getView().type:""),this._widgetId=this._widgetId?this._widgetId:e.widgetId,s.setWidgetId(this._widgetId),e.profile&&void 0!==e.profile&&""!==e.profile&&this._savePreferencesLocally("LastUsedProfile",s.setLastUsedProfile.bind(s),e.profile),e.preSelectedObjectIds&&void 0!==e.preSelectedObjectIds&&(this._preSelectedObjectIds=e.preSelectedObjectIds),e.inAppMode&&s.setOption("inAppMode",!0),this._inAppOptions&&(void 0!==this._inAppOptions.relationSet&&""!==this._inAppOptions.relationSet&&this._savePreferencesLocally("LastUsedProfile",s.setLastUsedProfile.bind(s),e.profile),void 0!==this._inAppOptions.selectedObjectIds&&(a=JSON.stringify(this._inAppOptions.selectedObjectIds)));let r=m.getPref("favoriteID")||null;r&&null!==r&&(e.initWithFavorite=r),this._savePreferencesLocally("layoutType",s.setLayoutType.bind(s));let l=m.getPref("lastRootNodeID")||[];l&&l!==[]&&this._updateLastRootID(l);let d=m.getPref("_ENORIPE_Type_Attrs")||{};e.initWithTenant&&s.setCurrentTenant(e.initWithTenant),e.defaultTenant&&s.setDefaultTenant(e.defaultTenant),s.appInitializationPromised(e.mapSettings,null,d).then(function(){s.addCredentialPreferenceToWidget().then(function(){h.getSettingsAndRelSets().then(i._mergeSettings.bind(i)).then(i._parseRelations.bind(i)).then(function(e){i.trackProfileUsage(i.currentProfile)}).then(function(){a&&0!==Object.keys(a).length||!i._navigatedNodes||(e.initWithNodes=Object.keys(i._navigatedNodes).length>0?i._navigatedNodes:e.initWithNodes),i.getSelectedSCForFavorites(),a&&Object.keys(a).length>0?(i._addRecents(Object.keys(a)),i._initCollection(e)):e.initWithFavorite?i._isFavorite(e.initWithFavorite).then(function(t){t||m.getPref("favoriteID")?(i._openFavorite(e.initWithFavorite),o.trackUsage("Favorite","InitWithFavorite")):i._initCollection(e)},function(){i._addRecents(Object.keys(a)),i._initCollection(e)}):i._initCollection(e),i._updateWidgetHeader()})})},function(e){e.showMsg&&i._notifManager.addNotif({level:"error",message:E.get(e.msg),sticky:!0})}),s.setLang(e.lang),this._savePreferencesLocally("thumbnails2d",s.setThumbnailsMode.bind(s)),this._savePreferencesLocally("showInstances",s.setInstancesMode.bind(s)),this._savePreferencesLocally("showPublications",s.setPublicationsMode.bind(s)),this._savePreferencesLocally("showGhost",s.setGhostMode.bind(s)),this._savePreferencesLocally("layoutMode",s.setLayoutMode.bind(s)),this._savePreferencesLocally("listViewPanelWidth",s.setListViewPanelWidth.bind(s)),this._savePreferencesLocally("typeLayoutView",s.setTypeLayoutView.bind(s)),s.setInformationPanelStatus({isInformationPanelVisible:m.getPref("isInformationPanelVisible")||!1}),this._layoutUtils=new g({layoutAxis:s.getLayoutAxis(),layoutDirection:s.getLayoutDirection()})},getTaggerWebInWin:function(){return this._taggerWIWManager},synchroSelection:function(e){this.hideSpinner(),this.getSynchroStatus(e).then(function(e){this._navigationMap.onFilterSelection(e)}.bind(this))},synchroColorize:function(e){this.hideSpinner(),e.forColorize=!0,this.getSynchroStatus(e).then(function(e){this._navigationMap.colorizeSynchro(e)}.bind(this))},synchroFiltering:function(e){this.hideSpinner(),this.getSynchroStatus(e).then(function(t){this._navigationMap.filter(e)}.bind(this))},parseVersionInfo:function(e){var t,i={};return e&&e.results&&e.results.length>0&&e.results.forEach(function(e){if(e.attributes&&e.attributes.length&&e.attributes.length>0){var n;t=e.attributes;for(var s=0;s<t.length;s++)t[s].name&&"resourceid"===t[s].name&&(n=t[s].value),t[s].name&&"ds6wg:PLMReference.V_isLastVersion"===t[s].name&&n&&void 0===i[n]&&(i[n]=t[s].value)}}),i},processVersionInfo:function(e,t){var i=[],n=[],s={excluded:!0,tags:[]};for(var o in e.filteredLinks=[],t)t.hasOwnProperty(o)&&("TRUE"===t[o]?i.push(o):n.push(o));if(e.forColorize)return e.lastVersionNodes=i,e.notLastVersionNodes=n,e;for(var a in e.allfilters)if(e.allfilters.hasOwnProperty(a)){for(var r=0;r<e.allfilters[a].length;r++)if(!e.allfilters[a][r].excluded){s.excluded=!1;break}for(r=0;r<e.allfilters[a].length;r++)("Yes"===e.allfilters[a][r].object||"No"===e.allfilters[a][r].object&&!e.allfilters[a][r].excluded==!s.excluded)&&s.tags.push(e.allfilters[a][r].object)}this.collection.filter(function(e){if("node"===e.get("modelType")){if(i.indexOf(e.id)>-1&&e.get("instancesExpanded")>0&&e.get("instances"))for(r=0;r<e.get("instances").length;r++)i.push(e.get("instances")[r].id);if(n.indexOf(e.id)>-1&&e.get("instancesExpanded")>0&&e.get("instances"))for(r=0;r<e.get("instances").length;r++)n.push(e.get("instances")[r].id)}});for(r=0;r<s.tags.length;r++)"Yes"===s.tags[r]?s.excluded?e.matchingIDs=e.matchingIDs.filter(function(e){return i.indexOf(e)<0}):e.matchingIDs=i.filter(function(t){return e.matchingIDs.indexOf(t)>-1}):"No"===s.tags[r]&&(s.excluded?e.matchingIDs=e.matchingIDs.filter(function(e){return n.indexOf(e)<0}):e.matchingIDs=n.filter(function(t){return e.matchingIDs.indexOf(t)>-1}));return e},versionSelection:function(e){var t=this,i={...e};this.getLastVersionInfo().then(function(e){i=t.processVersionInfo(i,t.parseVersionInfo(JSON.parse(e))),t._navigationMap.onFilterSelection(i)},function(e){t.hideSpinner()})},versionFiltering:function(e){var t=this;this.getLastVersionInfo().then(function(i){e=t.processVersionInfo(e,t.parseVersionInfo(JSON.parse(i))),t._navigationMap.filter(e)},function(e){t.hideSpinner()})},versionColorize:function(e){var t=this;e.forColorize=!0,this.getLastVersionInfo().then(function(i){e=t.processVersionInfo(e,t.parseVersionInfo(JSON.parse(i))),t._navigationMap.colorizeVersion(e,!1)},function(e){t.hideSpinner()})},_cleanProxy:function(){this._navigationMap&&this._navigationMap.taggerServices&&this._navigationMap.taggerServices.cleanProxy()},_processSynchroData:function(e,t){e.isVolatileData=!0;var i,n=[],s=[],o=[],a=[],r={},l={},d=[],c={excluded:!0,tags:[]};if(!e.forColorize)for(var h in e.allfilters)if(e.allfilters.hasOwnProperty(h)){for(var u=0;u<e.allfilters[h].length;u++)if(!e.allfilters[h][u].excluded){c.excluded=!1;break}for(u=0;u<e.allfilters[h].length;u++)("NotSynchronized"===e.allfilters[h][u].object||"Synchronized"===e.allfilters[h][u].object||"Unknown"===e.allfilters[h][u].object&&!e.allfilters[h][u].excluded==!c.excluded)&&c.tags.push(e.allfilters[h][u].object)}t.outputlist&&t.outputlist.primitives&&(s=t.outputlist.primitives);for(var g=0;g<s.length;g++)"notuptodate"===s[g].stampvalue?n.push(s[g].parentRelationId):"unknown"===s[g].stampvalue?a.push(s[g].parentRelationId):"uptodate"===s[g].stampvalue&&o.push(s[g].parentRelationId);for(g=0;g<s.length;g++)o.indexOf(s[g].parentRelationId)>-1&&(-1!==n.indexOf(s[g].parentRelationId)?(i=o.indexOf(s[g].parentRelationId),o.splice(i,1)):-1!==a.indexOf(s[g].parentRelationId)&&(i=o.indexOf(s[g].parentRelationId),o.splice(i,1))),n.indexOf(s[g].parentRelationId)>-1&&-1!==a.indexOf(s[g].parentRelationId)&&(i=n.indexOf(s[g].parentRelationId),n.splice(i,1));if(e.forColorize)return e.Synchronized=o,e.NotSynchronized=n,e.Unknown=a,e;e.filteredLinks=[];for(u=0;u<c.tags.length;u++)c.excluded?this.collection.filter(function(t){"link"===t.get("modelType")&&("Synchronized"===c.tags[u]&&o.indexOf(t.id)<0&&e.filteredLinks.push(t.id),"NotSynchronized"===c.tags[u]&&n.indexOf(t.id)<0&&e.filteredLinks.push(t.id),"Unknown"===c.tags[u]&&a.indexOf(t.id)<0&&e.filteredLinks.push(t.id))}):"Synchronized"===c.tags[u]?e.filteredLinks=e.filteredLinks.concat(o):"NotSynchronized"===c.tags[u]?e.filteredLinks=e.filteredLinks.concat(n):"Unknown"===c.tags[u]&&(e.filteredLinks=e.filteredLinks.concat(a));return this.collection.filter(function(t){if("link"===t.get("modelType")&&e.filteredLinks.indexOf(t.id)>-1){if(r=t.get("source"),l=t.get("target"),r.id&&d.indexOf(r.id)<0&&(d.push(r.id),r.instancesExpanded>0&&r.instances))for(var i=0;i<r.instances.length;i++)d.push(r.instances[i].id);if(l.id&&d.indexOf(l.id)<0&&(d.push(l.id),l.instancesExpanded>0&&l.instances))for(i=0;i<l.instances.length;i++)d.push(l.instances[i].id)}}),e.matchingIDs&&(e.matchingIDs=d.filter(function(t){return e.matchingIDs.indexOf(t)>-1})),e},getLastVersionInfo:function(){var e=[];return this.collection.filter(function(t){"node"!==t.get("modelType")||t.get("isCount")||e.push(t.get("id"))}),this._navigationMap.listView&&this._navigationMap.listView.models&&Object.keys(this._navigationMap.listView.models).length&&(e=e.concat(Object.keys(this._navigationMap.listView.models))),this._PM.createPromise({url:s.get3DSpaceUrl()+"/cvservlet/fetch/v2?tenant="+s.getCurrentTenantName(),params:{widgetId:this._widgetId,physicalid:e,select_predicate:["ds6wg:PLMReference.V_isLastVersion"]},xPrefCredential:s.getXPrefCredential(),timeout:s.getTimeout()})},getSynchroStatus:function(e){var t=this,n=[],s={};return new i(function(i,o){(n=this.collection.getLinksIds()).length>0?h.getSynchroStatus(n).then(function(n){n&&(s=JSON.parse(n)),e=t._processSynchroData(e,s),i(e)},function(){t.hideSpinner(),o()}):(t._navigationMap.removeLoader(),o())}.bind(this))},_setPreferences:function(e){var t,i={},n=this._autoModeChanged;return i.attributes=this._getAttrForTypes(),i.excludedRelations=[],i.allRelationsMode="AutoModeProfile"===this.currentProfile,e&&(i.widgetId=e),(t=this._initExpandedDirection()).length>0&&(this._currentRelations=t),this._autoNavMode&&(i.excludedRelations=this._getExcludedRelations(),i.excludedRelations.push("v6_structure_roots_from")),n&&!i.allRelationsMode&&(i.relations=this._currentRelations),this._autoModeChanged=!1,h.setPreferences(i)},_initCollection:function(e){var t=e.initWithNodes,i=Object.keys(e.initWithNodes),n=this._navigatedNodes,o=this,a=m.getPref("ENORIPE_savedColumnIds"),r=e.needClear,l=e.selectedNodes||[];i&&0!==i.length||!n||(t=n.length?n:t,i=Object.keys(t)),i&&i.length>0?(this.collection||(this.collection=new d([],{widgetId:this._widgetId,layoutUtils:this._layoutUtils,savedColumns:a||null,debugMode:"1"===s.getOption("debug_me")}),this.collection.addEvent("ENORIPE_setSavedColumnIds",function(e,t){m.setPrefToWidget(e,t)}),this.collection.addEvent("ENORIPE_noObjectToAdded",function(){o._navigationMap&&o._navigationMap._showNotif({level:"info",lvl:"primary",msg:E.get("ObjectsAlreadyInGraph")})}),this.collection.addEvent("ENORIPE_handleErrorMsgs",function(e){o._navigationMap&&o._navigationMap.handleServerErrorMsgs(e)}),this.collection.addEvent("ENORIPE_someObjectsNotIndex",function(e){o.showMessageNotIndexed(e)})),e.needClear||0===this.collection.length?this._getInfosForObjects(t,r,l):(o._initMapView(!1),o._navigationMap.render(o.collection)),a&&Object.keys(a).length>0&&this.collection.setColumnIds(a)):(this._isEmpty=!0,this._initMapView(this._isEmpty),this.showHomePage())},_refreshCollection:function(e){if(this._navigationMap&&(this._navigationMap._spinner.show(),e.firedFromWidgetMenu&&(this._navigationMap.refreshMsgPending=!0)),this.collection&&this._navigatedNodes&&Object.keys(this._navigatedNodes).length){this._initCollection({initWithNodes:e.initWithNodes,objectType:e.objecType||null,needClear:e.needClear})}else{if(e.firedFromWidgetMenu)return void(this._navigationMap&&this._navigationMap._spinner.hide());this._initCollection({initWithNodes:e.initWithNodes,objectType:e.objecType||null})}},_setAvailableRelation:function(e){var t=[],i="",n="",s="false";this._availableRelations.forEach(function(e){t.push(e.name)});for(var o=0;o<e.length;o++)-1===t.indexOf(e[o])&&(i=e[o],n="",n=this.currentProfile+":"+i,f.getMainRelName(i),s=e.indexOf(i)>-1?"true":"false",this._saveTempPreferences(n,s),this._lastSavedValues[i]=s,this._availableRelations.push({name:i}));f.setAvailableRelations(this._availableRelations)},_initMapView:function(e){var t=this;if(this._navigationMap){if(this._navigationMap.refresh({isEmpty:e,collection:this.collection}),this._navigationMap._isFavOpen){var i=this._navigationMap._favTitle;this._updateFavoriteTitle(i)}}else this._navigationMap=new a({addinMode:this._addinMode,collection:this.collection,layoutUtils:this._layoutUtils,autoNavMode:this._autoNavMode,promiseManager:this._PM,countLimit:s.getOption("countLimit"),platformId:s.getPlatformId(),lang:s.getLang(),isEmpty:e,widgetId:this._widgetId,widget:this._widget,lastRootID:this._lastRootID,debugMode:"1"===s.getOption("debug_me"),separator:s.getOption("displayNameSeparator"),nameLabel:s.getOption("displayNameAttributes"),detailLabel1:s.getOption("detailAttributesLevel1"),detailLabel2:s.getOption("detailAttributesLevel2"),preSelectedObjectIds:this._preSelectedObjectIds,inAppOptions:this._inAppOptions,errorOnInit:this._errorOnInit}),e&&(this._navigationMap._isEmpty=this._isEmpty),this.collection&&this.collection.addEvent("onSync",function(e,i,n){t._navigationMap&&t._navigationMap.render(e,i,n)}),this._navigationMap.addEvent("ENORIPE_DropByMode",this._dropByMode.bind(this)),this._navigationMap.addEvent("ENORIPE_refreshMap",this._onRefresh.bind(this)),this._navigationMap.addEvent("ENORIPE_ClearMap",this.clearMap.bind(this)),this._navigationMap.addEvent("ENORIPE_SetNavigatedNode",this._setNavigatedNodes.bind(this)),this._navigationMap.addEvent("setLastRootNodeID",function(e){t._addRootNode(e,!0)}),this._navigationMap.addEvent("ENORIPE_CustomizeAll",this.showCustomizeAll.bind(this)),this._navigationMap.addEvent("ENORIPE_ProfileInfo",function(){var e=t._getValuesForProfile();null!==e&&""!==e&&void 0!==e&&(t._navigationMap.lastUsedProfile=e);for(var i=0;i<t._activeProfiles.length;i++)t._navigationMap.profileArray[i]=t._activeProfiles[i].name}),t._navigationMap.addEvent("ENORIPE_updateRelations",t._updateRelations.bind(t)),t._navigationMap.addEvent("ENORIPE_Search",t.onSearch.bind(t)),t._navigationMap.addEvent("ENORIPE_ShowHomePage",t.showHomePage.bind(t)),t._navigationMap.addEvent("ENORIPE_ShowSaveInFavoritesModal",t.showSaveInFavoriteModal.bind(t)),t._navigationMap.addEvent("ENORIPE_HideHomePage",t.hideHomePage.bind(t)),t._navigationMap.addEvent("ENORIPE_createFavorite",t._createFavorite.bind(t)),t._navigationMap.addEvent("ENORIPE_updateFav",t._updateFavorite.bind(t)),this._navigationMap.addEvent("ENORIPE_HideLeftToolBar",function(){t.leftIconBar&&t.leftIconBar.hide()}),this._navigationMap.addEvent("ENORIPE_ShowLeftToolBar",function(){t.leftIconBar&&t.leftIconBar.show()}),t._navigationMap.addEvent("ENORIPE_ShowPreview",function(e){var i={};e.direction&&"WhereUsed"===t.currentProfile&&(e.direction="in"),e.model&&h.getEcosystem([e.model],{direction:e.direction,responseMode:"objectsByPatterns"}).then(function(n){n=JSON.parse(n),i=t._parseEcosystem(n),t._navigationMap.previewView.setPreview(e.model.id,i)})}),t._navigationMap.addEvent("ColorizeSynchro",function(e){t.synchroColorize(e)}),t._navigationMap.addEvent("ColorizeVersion",function(e){t.versionColorize(e)}),t._navigationMap.addEvent("FilteringSynchro",function(e){t.synchroFiltering(e)}),t._navigationMap.addEvent("FilteringVersion",function(e){t.versionFiltering(e)}),t._navigationMap.addEvent("SelectSynchro",function(e){t.synchroSelection(e)}),t._navigationMap.addEvent("SelectVersion",function(e){t.versionSelection(e)}),t._navigationMap.addEvent("ENORIPE_ToggleInformationPanel",function(e){m.setPrefLocally("isInformationPanelVisible",e),s.setInformationPanelStatus({isInformationPanelVisible:e})}),t._navigationMap.addEvent("ENORIPE_UpdateAttributes",function(e){t._updatePreferences(e)}),t._navigationMap.addEvent("ENORIPE_ResizeListViewPanel",function(e){e&&m.setPrefEverywhere("listViewPanelWidth",e)}.bind(this)),t._navigationMap.addEvent("ENORIPE_initExpandNLevel",function(e){t.initExpandNLevel(e)}),t._navigationMap.addEvent("ENORIPE_SwitchLayout",function(e){e&&t._updateLayoutType(e)}),t._navigationMap.addEvent("ENORIPE_performSearch_native",t.onSearch.bind(t)),t._navigationMap.addEvent("ENORIPE_LaunchSearch",function(){var e=t._navigationMap._searchValue;e&&t.onSearch(e)}),t._favData&&(t._navigationMap._isFavOpen=!0,t._navigationMap._favTitle=t._favData.title),this._navigationMap.addEvent("ENORIPE_HideOneDirection",this._hideOneDirection.bind(this)),this._navigationMap.addEvent("ENORIPE_ShowOneDirection",this._showOneDirection.bind(this)),this._navigationMap.addEvent("ENORIPE_noObjectToAdded",function(){t._navigationMap&&t._navigationMap._showNotif({level:"info",lvl:"primary",msg:E.get("ObjectsAlreadyInGraph")})}),this._navigationMap.addEvent("ENORIPE_updateLastRootId",this._updateLastRootID.bind(this)),this._navigationMap.addEvent("ENORIPE_TrackProfileUsage",this.trackProfileUsage.bind(this)),this._navigationMap.addEvent("Customize_UpdateRelationsDisplayed",this.updateRelationsDisplayedCustomize.bind(this)),this._navigationMap.addEvent("Customize_UnloadCustomizeRelations",function(){this._customizeAllView.unloadCustomizeRelations()}.bind(this)),this._navigationMap.addEvent("Customize_LoadingRelations",function(){this._customizeAllView.loadingCustomizeRelations()}.bind(this)),this.container.setContent(this._navigationMap),this._navigationMap.onResize();this.initCustomizeAll()},initExpandNLevel:function(e){var t=this,i="";e&&e.selectedNodes&&e.expandNLevelView&&(this.expandNLevelView=e.expandNLevelView,(i=this.expandNLevelView.getExpandSessionId())&&this._setPreferences(i).then(function(){t.expandNLevelView.initModal({selectedNode:e.selectedNodes,expandSessionId:i})}))},_initHomePage:function(){var e=this;this._homePage=new r({addinMode:this._addinMode,collection:this.collection,platformId:s.getPlatformId(),lang:s.getLang(),widgetId:this._widgetId,separator:s.getOption("displayNameSeparator"),nameLabel:s.getOption("displayNameAttributes"),detailLabel1:s.getOption("detailAttributesLevel1"),detailLabel2:s.getOption("detailAttributesLevel2"),debugMode:"1"===s.getOption("debug_me")}).inject(this.container),e._homePage.addEvent("ENORIPE_HandleRecents",e._handleRecents.bind(e)),e._homePage.addEvent("ENORIPE_HandleFavorite",e._handleFavorites.bind(e)),e._homePage.addEvent("ENORIPE_OpenRelExp",e._openRelExp.bind(e)),e._homePage.addEvent("ENORIPE_drop",e._handleDropFromHomePage.bind(e)),e._homePage.addEvent("ENORIPE_showNotif",function(t){e._navigationMap._showNotif(t)}),e._homePage.addEvent("ENORIPE_dropNotSupported",function(){e._navigationMap._showNotif({level:"error",msg:E.get("dropNotSupported")})})},showHomePage:function(){this._homePage||this._initHomePage(),this.leftIconBar&&this.leftIconBar.elements.container.addClassName("displaynone"),this._navigationMap&&this._navigationMap._onHide(),this._homePage.render(),this._isHomePageVisible=!0},hideHomePage:function(){this._homePage&&(this._homePage.hide(),this._homePage.clearContent(),this._isHomePageVisible=!1),this.leftIconBar&&this.leftIconBar.elements.container.removeClassName("displaynone"),this._navigationMap&&this._navigationMap._onShow()},_handleDropFromHomePage:function(e,t){this._navigationMap&&(this._navigationMap._onShow(),this._navigationMap._handleDrop(e,t),this._isHomePageVisible=!1)},_handleRecents:function(){var e=this,t=m.getPref("_Recents")||[];0===t.length?e._homePage.showEmptyView("Recents"):(this._homePage.mask(),h.fetchRecents(t).then(function(t){t&&e._homePage.showObjects(t.nlsObj)},function(t){console.log(t),e._homePage.unmask()}))},_isFavorite:function(e){var t=this;return new i(function(i,n){t.getSelectedSCForFavorites().then(function(t){h.isFavorite(t,e).then(function(e){e?(e=JSON.parse(e),i(e.isFavorite)):n()},function(){n()})},function(e){n()})})},_openFavorite:function(e){var t=this;this.getSelectedSCForFavorites().then(function(i){h.getFavoriteInfo(i,e).then(function(e){e=JSON.parse(e),t._openRelExpFav(e.favorite[0])})})},_addFavoriteData:function(e){var t=this;this.getSelectedSCForFavorites().then(function(i){h.getFavoriteInfo(i,e).then(function(e){if(e){e=JSON.parse(e);var i={};e.favorite[0].rootPhysicalIds.forEach(function(e){i[e]={ids:e,instances:[]}}),t._dropAdd(i)}})})},_handleFavoritesDrop:function(e,t){"add"===e?this._isEmpty?this._openFavorite(t.objectId):this._addFavoriteData(t.objectId):"replace"===e&&(this.clearMap(),this._openFavorite(t.objectId),o.trackUsage("Favorite","OpenFavFrom-DropReplace"))},showSaveInFavoriteModal:function(){if(!this.saveFavoriteModal){this.saveFavoriteModal=new v({className:"modal-saveFavorite",closable:!0,header:'<h4 class="title">'+E.get("SNNavigationMap.SaveFavoriteModal.Title")+"</h4>",body:"<p>"+E.get("SNNavigationMap.SaveFavoriteModal.BodyIntroduction")+'</p><p class="question">'+E.get("SNNavigationMap.SaveFavoriteModal.BodyQuestion")+"</p>",events:{onHide:function(){}.bind(this)}}).inject(this.container);var e=t.createElement("div",{class:"actionButton-container"});new S({value:E.get("save"),className:"primary save",events:{onClick:function(){this._navigationMap.handleFavorite(!0),this.saveFavoriteModal.hide()}.bind(this)}}).inject(e),new S({value:E.get("dontSave"),className:"default dont-save",events:{onClick:function(){this.showHomePage(),this.saveFavoriteModal.hide()}.bind(this)}}).inject(e),new S({value:E.get("cancel"),className:"default cancel",events:{onClick:function(){this.saveFavoriteModal.hide()}.bind(this)}}).inject(e),this.saveFavoriteModal.setFooter(e)}this.saveFavoriteModal.show()},_handleFavorites:function(e){var t=this;this._homePage.mask(),this.getSelectedSCForFavorites().then(function(e){return h.getFavorites(e)}).then(function(i){(i=JSON.parse(i))&&i.favorite.length>0?t._homePage.showFavorites(i):e?t._homePage.changeTab(e):(t._homePage.showFavorites(i),t._homePage.unmask())},function(e){console.log(e),t._homePage.clearContent(),t._homePage.unmask()})},_openRelExp:function(e){if(this.showSpinner(),this._cleanProxy(),e[0].name&&"ENORelationalExplorerFavorite"===e[0].type)this._openRelExpFav(e[0]);else{let i=e.map(e=>e.id),n={};for(var t=0;t<e.length;t++)n[e[t].id]={id:e[t].id,instances:[]};this._resetMap(n,!0),this._addRootNode(i,!0),m.setPrefToWidget("favoriteID",null),this._navigationMap&&this._updateFavoriteTitle(""),this._navigationMap._isFavOpen=!1}},updateFavTitle:function(e){e.title&&(m.setPrefToWidget("favoriteID",e.id),this._navigationMap&&(this._navigationMap._onShow(),this._isHomePageVisible=!1,this._favData=e,this._navigationMap._isFavOpen=!0,this._navigationMap._favTitle=e.title,this._updateFavoriteTitle(e.title)))},_openRelExpFav:function(e){var t=e.preferences,i=!0,n=e.profilename,s=!1;if(n!==this.currentProfile&&(s=!0),s?("AutoModeProfile"===n?(this._autoNavMode=!0,this._autoModeChanged=!0):this._autoNavMode=!1,i=!0):i=!t.equals(this._currentRelations),e.rootIds&&e.rootIds.length>0&&this._addRootNode(e.rootIds,!0),i)this.checkDirections(t),this._updatePreferences(t,n,e);else{let t={};e.rootPhysicalIds.forEach(function(e){"string"==typeof e?t[e]={id:e,instances:[]}:t[e.id]=e}),this._onRefresh({initWithNodes:t,needClear:!0,isFav:!0,favData:e})}o.trackUsage("Favorite","OpenFavFrom-Homepage")},_createFavorite:function(e,t){var i,n=this,s=Object.values(this.collection.getIdentifierDataById(Object.keys(this._navigatedNodes)));i={title:e.inputval,ids:s,preferences:this._currentRelations,profilename:this.currentProfile,rootIds:this._lastRootID},this.setSelectedSCForFavorites(e.securitycontext),o.trackUsage("Favorite","CreateFav"),h.createFavorite(e.securitycontext,i).then(function(e){var i=JSON.parse(e).favorite[0];if(i){n._navigationMap._showNotif({level:"info",lvl:"primary",msg:i.title+" "+E.get("FavoriteSuccess")});e={name:i.favoriteName,type:"ENORelationalExplorerFavorite",title:i.title};e={...e,...i},t?n.showHomePage():n.updateFavTitle(e)}})},_updateFavorite:function(e){var t,i=this,n=Object.values(this.collection.getIdentifierDataById(Object.keys(this._navigatedNodes)));t={favoriteName:this._favData.favoriteName,title:this._favData.title,ids:n,preferences:this._currentRelations,profilename:this.currentProfile,rootIds:this._lastRootID},this.showSpinner(),this._favData&&(o.trackUsage("Favorite","UpdateFav"),this.getSelectedSCForFavorites().then(function(n){h.updateFavorite(n,t).then(function(t){i.hideSpinner();var n=JSON.parse(t);n&&i._navigationMap._showNotif({level:"info",lvl:"primary",msg:n.favorite[0].title+" "+E.get("FavoriteUpdate")}),e&&i.showHomePage()},function(){i.hideSpinner()})}))},getSelectedSCForFavorites:function(){var e=this;return new i(function(t,i){e._selectedSCForFav?t(e._selectedSCForFav):s._getListOfSecurityContext().then(function(n){let s=e.getKeyForSCFav(),o=!1,a=e._getValuesInSession(s);if(a)for(let e=0;e<n.length;e++)if(a===n[e].value){o=!0;break}o||(a=n[0].value),a?(e.setSelectedSCForFavorites(a),t(e._selectedSCForFav)):i()})})},getKeyForSCFav:function(){return(s.getUserID()||"defaultUserID")+"-selectedSCForFav"},setSelectedSCForFavorites:function(e){let t=this.getKeyForSCFav();this._selectedSCForFav=e,this._saveValuesInSession(t,e),s.setOption("selectedSCForFav",e)},initCustomizeAll:function(){var e=this;if(this._navigationMap&&(this._customizeAllView||(this._customizeAllView=new l(this._getCustomizeRelationsViewOptions()),this._initCustomizeAllListenEvents(),this._customizeAllView.inject(this.container),this._customizeAllView.hide()),this._customizeAllView)){var t=this._getCustomizeRelationsViewRenderOptions();this.collection?this._navigationMap.getCustomizeAttributeOptions().then(i=>{e._customizeAllView.render(t,i)}):e._customizeAllView.render(t)}},showCustomizeAll:function(){var e=this;if(this._navigationMap&&this._customizeAllView){this._customizeAllView.show();var t=this._getCustomizeRelationsViewRenderOptions();this._navigationMap.getCustomizeAttributeOptions().then(i=>{e._customizeAllView.render(t,i)})}},_setCustomizeRelationsOptions:function(){var e;(e=this._getCustomizeRelationsViewOptions())&&null!=e&&this._customizeAllView&&this._customizeAllView.setCustomizeRelationsContent(e)},_getCustomizeRelationsViewOptions:function(){var e,t,i=s.getOption("noautomode"),n=this._getValuesForProfile(),o=[];null!==n&&""!==n&&void 0!==n&&(t=n),i&&"AutoModeProfile"===t&&(t=this._activeProfiles[1].name,this._savePreferencesLocally("LastUsedProfile",s.setLastUsedProfile.bind(s),t));for(var a=0,r=0;r<this._activeProfiles.length;r++)if(i&&"AutoModeProfile"===this._activeProfiles[r].name)this._autoNavMode=!1;else{var l=this._activeProfiles[r].type,d=this._activeProfiles[r].nls;d||(d=E.get(this._activeProfiles[r].name)),this._activeProfiles[r].custom&&(l="custom",d=this._activeProfiles[r].nlsLabel),o[a]={name:this._activeProfiles[r].name,type:l,nls:d},a++}var c=this._groupedRelations;this._autoNavMode&&(c=(e=this._getRelForAutoMode({...this._groupedRelations})).present);let h=m.getPref("_ENORIPE_RecentRelationsSet")||[];return{settings:c,notPresentRelations:this._autoNavMode?e.notPresent:[],title:E.get("SNNavigationMap.Customize.Title"),currentProfile:this.currentProfile,thumbnails2d:"thumbnailsMode"===s.getThumbnailsMode(),recomputeLayout:"recompute"===s.getLayoutMode(),autoNav:this._autoNavMode,lastUsedProfile:t,profileArray:o,recentProfiles:h,lang:s.getLang()}},_getCustomizeRelationsViewRenderOptions:function(){var e={},t={};return this._autoNavMode&&(t=this._getRelForAutoMode({...this._groupedRelations}),e.settings=t.present,e.notPresentRelations=t.notPresent),e},_initCustomizeAllListenEvents:function(){var e=this;e._navigationMap&&(e._customizeAllView.addEvent("ENORIPE_updatePref",e._updatePreferences.bind(e)),e._customizeAllView.addEvent("ENORIPE_updateRelations",e._updateRelations.bind(e)),e._customizeAllView.addEvent("ENORIPE_CreateNewProfile",e._createNewProfile.bind(e)),e._customizeAllView.addEvent("ENORIPE_SaveNewProfile",e._createNewProfile.bind(e)),e._customizeAllView.addEvent("ENORIPE_DeleteProfile",e._deleteProfile.bind(e)),e._customizeAllView.addEvent("ENORIPE_SetRecentRelationSet",e.setRecentRelationSet.bind(e)),e._customizeAllView.addEvent("ENORIPE_SetCustomizeRelationsOptions",e._setCustomizeRelationsOptions.bind(e)),e._customizeAllView.addEvent("ENORIPE_UpdateAttributes",function(t){var i,n;if(t=e._navigationMap._checkDefaults(t),i=e._navigationMap._isDiffFromDefault(t),n=e._navigationMap._attributesOrderChange(t),i||n){var o=[];if(s.setDefaultAttributes(t),e._navigationMap.listView.updateAttributes(),e._navigationMap.dataGridView&&"dataGridView"===s.getLayoutType())e._navigationMap.dataGridView.updateColumns(t.EnoripeColumns.attributes);else{e._navigationMap.collection.filter(function(e){if("node"===e.get("modelType")){var t=e.get("id");-1===o.indexOf(t)&&o.push(t)}});for(var a=0;a<o.length;a++)e._navigationMap.updateMapViewAttributesNls(o[a])}m.setPrefEverywhere("_ENORIPE_Type_Attrs",t),i&&e._navigationMap.dispatchEvent("ENORIPE_UpdateAttributes")}}),e._customizeAllView.addEvent("ENORIPE_updateDisplayOptions",function(t){e._savePreferencesEverywhere("thumbnails2d",s.setThumbnailsMode.bind(s),t.showThumbnails2D),e._savePreferencesEverywhere("showInstances",s.setInstancesMode.bind(s),t.showInstances),e._savePreferencesEverywhere("showPublications",s.setPublicationsMode.bind(s),t.showPublications),e._savePreferencesEverywhere("showGhost",s.setGhostMode.bind(s),t.showGhost),e._savePreferencesEverywhere("layoutMode",s.setLayoutMode.bind(s),t.recumputeLayout),void 0!==t.showPublications||void 0!==t.showGhost?(e._onRefresh({initWithNodes:e._navigatedNodes,needClear:!0}),void 0!==t.showPublications&&"undefined"!==e._navigationMap.listView&&e._navigationMap.listView.updatePublicationsMode(t.showPublications)):(void 0!==t.showThumbnails2D&&"linearGraph"===s.getLayoutType()&&e._navigationMap.switchThumbnailsMode(s.getThumbnailsMode()),void 0!==t.showInstances&&e._navigationMap.toggleListInstances(t.showInstances),void 0!==t.recumputeLayout&&!0===t.recumputeLayout&&"linearGraph"===s.getLayoutType()&&(e.collection._setColumnOnNodes(),e._navigationMap.mapView.render(e.collection.getLinksAndNodes(),e.collection.groupBy("columnID"))))}))},_updateRelations:function(e){this._autoNavMode=!(!e||"AutoModeProfile"!==e);for(var t=0;t<this._activeProfiles.length;t++)if(this._activeProfiles[t].name===e){this.currentProfile=e,this._availableRelations=this._activeProfiles[t].relations,this._splitRelations(this._activeProfiles[t].relations);var i=this._groupedRelations;i=this._sortGroupedRel(i),this._customizeAllView&&this._customizeAllView.showRelations(i);break}},updateRelationsDisplayedCustomize:function(e){var t={};for(var i in this._groupedRelations)for(var n=0;n<this._groupedRelations[i].length;n++)for(var s=0;s<e.length;s++)this._groupedRelations[i][n].id.contains(e[s])&&(t[i]=this._groupedRelations[i]);this._customizeAllView.updateRelationsDisplayed({...this._groupedRelations},t)},getLastVersionInfo:function(){var e=[];return this.collection.filter(function(t){"node"===t.get("modelType")&&e.push(t.get("id"))}),this._navigationMap.listView&&this._navigationMap.listView.models&&Object.keys(this._navigationMap.listView.models).length&&(e=e.concat(Object.keys(this._navigationMap.listView.models))),this._PM.createPromise({url:s.get3DSpaceUrl()+"/cvservlet/fetch/v2?tenant="+s.getCurrentTenantName(),params:{widgetId:this._widgetId,physicalid:e,select_predicate:["ds6wg:PLMReference.V_isLastVersion"]},xPrefCredential:s.getXPrefCredential(),timeout:s.getTimeout()})},_getInfosForObjects:function(e,t,i){this.collection.reset(),this.collection.updateColumnId=!0,this._initMapView(!1),t?this._fetchData(e,i):this._setPreferences().then(function(){this._fetchData(e,i)}.bind(this))},_fetchData:function(e,t){var i=Object.keys(e),n=f.getRefInstIdsFromNavigatedNodes(e);if(1===i.length){var s={ids:n,type:"AllTypes"};h.fetchAttributes(s).then(function(e){if(e.nlsObj&&Object.keys(e.nlsObj).length>0){let t=this.collection.parse({objects:[e.nlsObj[i[0]]],links:[]});this.collection.addModel(t,{external:!0,callback:this._navigationMap.render.bind(this._navigationMap)}),this._navigatedNodes=this.collection.getIdentifierDataById(t.id),m.setPrefToWidget("ENORIPE_navigatedNodes",this._navigatedNodes),this._isEmpty=0===this.collection.length,this._navigationMap&&(this._navigationMap._isEmpty=this._isEmpty)}else this.showMessageNotIndexed(i.length)}.bind(this))}else this.collection.getEcoSystem({items:Object.values(e),restrictedMode:!0}).then(function(){let i=this.collection.getNodesIds();if(this._isEmpty=0===this.collection.length,this._navigationMap&&(this._navigationMap._isEmpty=this._isEmpty),i.length>0){let n=Object.keys(e).filter(e=>i.indexOf(e)>-1).reduce((t,i)=>Object.assign(t,{[i]:e[i]}),{});this._navigationMap._manageFirstFocusAndAnchor(t),this._navigatedNodes=n,m.setPrefToWidget("ENORIPE_navigatedNodes",this._navigatedNodes)}else this.hideSpinner()}.bind(this))},_getGrantedUsrGrp:function(){var e=this;return new i(function(t,i){if(s.getOption("user_granted_groups"))t(s.getOption("user_granted_groups"));else{var n={},o=s.get3DSearchUrl()+"/search",a=s.getUserID();n.label="ENORIPE_"+a+"_"+Date.now(),n.select_predicate=["ds6w:label"],n.query="[ds6w:type]:GROUP AND "+a,n.tenant=s.getCurrentTenantName(),n.nresults=100,n.with_synthesis_attribute=!1,n.with_synthesis=!1,n=JSON.stringify(n),b.authenticatedRequest(o,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",data:n,onComplete:function(i){var n=e._parseUserGroups(JSON.parse(i));s.setOption("user_granted_groups",n),t(n)},onFailure:function(e){console.log("failed in fetching granted usrgrps"+e),t([])},onTimeout:function(e){console.log("failed in fetching granted usrgrps"+e),t([])}})}})},_processSynchroData:function(e,t){var i,n=[],s=[],o=[],a=[],r={},l={},d=[],c={excluded:!0,tags:[]};if(!e.forColorize)for(var h in e.allfilters)if(e.allfilters.hasOwnProperty(h)){for(var u=0;u<e.allfilters[h].length;u++)if(!e.allfilters[h][u].excluded){c.excluded=!1;break}for(u=0;u<e.allfilters[h].length;u++)("NotSynchronized"===e.allfilters[h][u].object||"Synchronized"===e.allfilters[h][u].object||"Unknown"===e.allfilters[h][u].object&&!e.allfilters[h][u].excluded==!c.excluded)&&c.tags.push(e.allfilters[h][u].object)}t.outputlist&&t.outputlist.primitives&&(s=t.outputlist.primitives);for(var g=0;g<s.length;g++)"notuptodate"===s[g].stampvalue?n.push(s[g].parentRelationId):"unknown"===s[g].stampvalue?a.push(s[g].parentRelationId):"uptodate"===s[g].stampvalue&&o.push(s[g].parentRelationId);for(g=0;g<s.length;g++)o.indexOf(s[g].parentRelationId)>-1&&(-1!==n.indexOf(s[g].parentRelationId)?(i=o.indexOf(s[g].parentRelationId),o.splice(i,1)):-1!==a.indexOf(s[g].parentRelationId)&&(i=o.indexOf(s[g].parentRelationId),o.splice(i,1))),n.indexOf(s[g].parentRelationId)>-1&&-1!==a.indexOf(s[g].parentRelationId)&&(i=n.indexOf(s[g].parentRelationId),n.splice(i,1));if(e.forColorize)return e.Synchronized=o,e.NotSynchronized=n,e.Unknown=a,e;e.filteredLinks=[];for(u=0;u<c.tags.length;u++)c.excluded?this.collection.filter(function(t){"link"===t.get("modelType")&&("Synchronized"===c.tags[u]&&o.indexOf(t.id)<0&&e.filteredLinks.push(t.id),"NotSynchronized"===c.tags[u]&&n.indexOf(t.id)<0&&e.filteredLinks.push(t.id),"Unknown"===c.tags[u]&&a.indexOf(t.id)<0&&e.filteredLinks.push(t.id))}):"Synchronized"===c.tags[u]?e.filteredLinks=e.filteredLinks.concat(o):"NotSynchronized"===c.tags[u]?e.filteredLinks=e.filteredLinks.concat(n):"Unknown"===c.tags[u]&&(e.filteredLinks=e.filteredLinks.concat(a));return this.collection.filter(function(t){if("link"===t.get("modelType")&&e.filteredLinks.indexOf(t.id)>-1){if(r=t.get("source"),l=t.get("target"),r.id&&d.indexOf(r.id)<0&&(d.push(r.id),r.instancesExpanded>0&&r.instances))for(var i=0;i<r.instances.length;i++)d.push(r.instances[i].id);if(l.id&&d.indexOf(l.id)<0&&(d.push(l.id),l.instancesExpanded>0&&l.instances))for(i=0;i<l.instances.length;i++)d.push(l.instances[i].id)}}),e.matchingIDs&&(e.matchingIDs=d.filter(function(t){return e.matchingIDs.indexOf(t)>-1})),e},_parseRelations:function(e){if(e){var t=this,n="AutoModeProfile",o=e.profiles[0],a=this._getValuesForProfile();this.autoModeProfile&&e.profiles.unshift(this.autoModeProfile);var r=m.getPref("_ENORIPE_CustomRelationsSet");if(r)for(var l=0;l<r.length;l++)e.profiles.splice(l+1,0,r[l]);n=null!==a&&""!==a&&void 0!==a?a:this._settings.relation_apps.ENORIPE_AP,this.currentProfile=e.profiles[0].name,this._activeProfiles=e.profiles,s.getOption("noautomode")&&(n=e.profiles[1].name,this.currentProfile=e.profiles[1].name,this._autoNavMode=!1);for(var d=0;d<e.profiles.length;d++)if(n===e.profiles[d].name){o=e.profiles[d],this.currentProfile=e.profiles[d].name;break}return"AutoModeProfile"===this.currentProfile?this._autoNavMode=!0:this._autoNavMode=!1,this._savePreferencesLocally("LastUsedProfile",s.setLastUsedProfile.bind(s),this.currentProfile),new i(function(e,i){o?(t._availableRelations=o.relations,t._splitRelations(o.relations),t._setAvailableRelation(t._currentRelations),e()):i()})}},_parsePatterns:function(e){if(e){var t=JSON.parse(e);this.autoModeProfile={name:"AutoModeProfile"},this.autoModeProfile.relations=t.patterns?t.patterns:[];for(var n=this.autoModeProfile.relations.length;n--;)this.autoModeProfile.relations[n].name.contains("v6_structure_roots")&&this.autoModeProfile.relations.splice(n,1);return new i(function(e,t){e()})}},_mergeSettings:function(e){if(e&&e[1]&&e[2]){this._parsePatterns(e[1]);var t=JSON.parse(e[2]),n=s.getRoles(),o=this,a=!1;return o._settings=e[0],new i(function(e,i){o._settings.relation_sets||e(t),0===Object.keys(o._settings.relation_sets).length&&e(t);t.profiles.map(function(e){return e.name});for(var s=0;s<o._settings.relation_sets.length;s++){for(var r=o._settings.relation_sets[s].roles,l=o._settings.relation_sets[s].userGroups,d=!1,c=0;c<r.length;c++)if(n.indexOf(r[c])>-1){d=!0;break}if(l.length>0&&!d){a=!0;break}}a?o._getGrantedUsrGrp().then(function(i){t=o._filterRelSets(t,i),e(t)}):(t=o._filterRelSets(t,[]),e(t))})}},_filterRelSets:function(e,t){var i=s.getRoles(),n=this._getValuesForProfile(),o=e.profiles.map(function(e){return e.name});t=t.map(function(e){return e.resourceid});if(o.indexOf(n)){let t=o.indexOf(n);if(t>-1&&e.profiles[t].applications&&e.profiles[t].applications.length>0){e.profiles[t].applications.map(function(e){return e.name}).indexOf(s.getAppId())<0&&(e.profiles.splice(t,1),this._savePreferencesLocally("LastUsedProfile",s.setLastUsedProfile.bind(s),"AutoModeProfile"))}}for(var a=0;a<this._settings.relation_sets.length;a++){var r=this._settings.relation_sets[a].roles,l=this._settings.relation_sets[a].userGroups,d=(this._settings.relation_sets[a].applications,!1);r&&r.length>0&&(r=r.map(function(e){return e.name})),l&&l.length>0&&(l=l.map(function(e){return e.name}));for(var c=0;c<r.length;c++)if(i.indexOf(r[c])>-1){d=!0;break}if(!d)for(c=0;c<l.length;c++)if(t.indexOf(l[c])>-1){d=!0;break}var h=o.indexOf(this._settings.relation_sets[a].name);d?-1===h?e.profiles.push(this._settings.relation_sets[a]):e.profiles.splice(h,1,this._settings.relation_sets[a]):-1!==h&&e.profiles.splice(h,1)}var u=[...e.profiles];for(a=0;a<u.length;a++)if(u[a].applications){let t=u[a].applications;if(t.length>0&&(t=t.map(function(e){return e.name})).indexOf(s.getAppId())<0){let t=(o=e.profiles.map(function(e){return e.name})).indexOf(u[a].name);e.profiles.splice(t,1)}}return e},_parseEcosystem:function(e){var t={};if(e)for(var i in t=e.objectsByPatterns)t[E.get(i)]=t[i],delete t[i];return t},_parseUserGroups:function(e){var t=[];if(e.results)for(var i=0;i<e.results.length;i++){var n=e.results[i];if(n.attributes){for(var s={},o=0;o<n.attributes.length;o++)"resourceid"===n.attributes[o].name&&(s.resourceid=n.attributes[o].value),"ds6w:label"===n.attributes[o].name&&(s.label=n.attributes[o].value);void 0!==s.resourceid&&t.push(s)}}return t},_saveValuesInSession:function(e,t){this._isWebInWin?localStorage.setItem(e,t):this._widget&&(this._widget.setValue(e,t),localStorage.setItem(e,t)),s.setOption(e,t)},_getValuesInSession:function(e){var t;!this._isWebInWin&&(!!this._widgetId&&this._widgetId.contains("preview"));if(this._widget&&(t=this._widget.getValue(e)),t&&this._widget||(t=localStorage.getItem(e)),t)return t},_saveTempPreferences:function(e,t){e&&t&&(this._tempPreferences[e]=t)},_getTempPreferences:function(e){if(this._tempPreferences){var t=this._tempPreferences[e];if(t)return t}},_savePreferencesLocally:function(e,t,i){void 0===i&&(i=m.getPref(e)),""===i||void 0===i?i=s.getOption(e):t(i),m.setPrefLocally(e,i)},_savePreferencesEverywhere:function(e,t,i){void 0===i&&(i=m.getPref(e)),""===i||void 0===i?i=s.getOption(e):t(i),m.setPrefEverywhere(e,i)},_setRelationSet:function(e){JSON.stringify(e);var t=null,i=m.getPref("_ENORIPE_CustomRelationsSet"),n=!1;if(i){t=i;for(var s=0;s<t.length;s++)e.name===t[s].name&&(t[s].relations=e.relations,n=!0);n||t.push(e)}else(t=[]).push(e);m.setPrefToLocalStorage("_ENORIPE_CustomRelationsSet",t)},setRecentRelationSet:function(e){var t=[],i=null;e.forEach(function(e){i={name:e._options.data.name,type:e._options.data.type,selectable:e._options.data.selectable,isRecent:e._options.data.isRecent,nls:e.getLabel()},e._options.comboBoxSemantics&&(i.comboBoxSemantics=e._options.comboBoxSemantics),e._options.data.nls&&(i.nls=e._options.data.nls),t.push(i)}),m.setPrefToLocalStorage("_ENORIPE_RecentRelationsSet",t)},onSearch:function(e){var t=this;if(this._isHomePageVisible)this._navigationMap&&this._navigationMap._showNotif({level:"error",lvl:"error",msg:E.get("SearchCurrentTabHomepageErr"),container:this._homePage.container});else if(void 0!==this.collection&&null!==this.collection){void 0===this._searchUtils&&(this._searchUtils=new p({debug:!1,isWebInWin:this._isWebInWin}));var i=[];if(this._navigationMap._isPreviewPanelOpen?(i=this._navigationMap.previewView.getFilteredIds(),this._navigationMap.previewView._showLoading()):(this.showSpinner(),this.collection.filter(function(e){"node"===e.get("modelType")&&(t._navigationMap._isFiltered?-1!==t._navigationMap._currentlyFilteredNodes.indexOf(e.get("id"))&&i.push(e.get("id")):i.push(e.get("id")))})),e&&i.length>0){var n={};n.ids=i,n.value=e,n.url=s.get3DSearchUrl()+"/search",n.tenantName=s.getCurrentTenantName(),n.locale=s.getLang(),this._searchUtils._searchCall(n).then(function(i){var n=JSON.parse(i);if(n&&void 0!==n.results&&n.infos&&n.infos.nresults>0){var s=t._processSearchResult(n.results);t._navigationMap.filterBySearch(s)}else t._navigationMap.filterBySearch([]);t._navigationMap._searchValue=e,t.hideSpinner(),t._navigationMap.previewView&&t._navigationMap.previewView._hideLoading()},function(){t.hideSpinner(),t._navigationMap.previewView&&t._navigationMap.previewView._hideLoading()})}}},_processSearchResult:function(e){var t=[],i=[];return e.forEach(function(e){if(e.attributes){i=e.attributes;for(var n=0;n<i.length;n++)if("resourceid"===i[n].name){t.push(i[n].value);break}}}),t},onResetSearch:function(){this._navigationMap&&this._navigationMap.clearFilterBySearch()},_updateLastRootID:function(e){this._lastRootID=e,this._navigationMap&&(this._navigationMap._lastRootID=e),s.setRootIds(e),m.setPrefLocally("lastRootNodeID",e)},_updateLayoutType:function(e){e&&(this._savePreferencesEverywhere("layoutType",s.setLayoutType.bind(s),e),this._navigationMap&&(this._navigationMap._currentLayout=e,this._navigationMap._toolBarView&&this._navigationMap._toolBarView.updateLayout()),this.container.className.includes("mode-")?this.container.className=this.container.className.replace(/mode-\w*/,"mode-"+e):this.container.addClassName("mode-"+e))},_updateWidgetHeader:function(){if(!this._isWebInWin&&widget){var e;if(E[this.currentProfile])e=E[this.currentProfile];else for(var t=0;t<this._activeProfiles.length;t++)if(this._activeProfiles[t].name===this.currentProfile){e=this._activeProfiles[t].nlsLabel||E.get(this.currentProfile);break}widget.setTitle(e+" ("+s.getCurrentTenantLabel()+")")}},_changePlatformSL:function(e){s.setCurrentTenant(e),m.getPref("selected_tenant")!==e&&m.setPrefToWidget("selected_tenant",e),this._updateWidgetHeader(),this._navigationMap&&this._navigationMap._showNotif({level:"warning",lvl:"warning",msg:E.get("PlatformChangesTo")+" "+e})},_addRootNode:function(e,t){var i=m.getPref("lastRootNodeID")||[],n=[];if(t)i=e;else for(var s=0;s<e.length;s++)i.indexOf(e[s])<0&&i.push(e[s]),this.collection&&Object.keys(this._navigatedNodes).indexOf(e[s])<0&&this.collection.get(e[s])&&n.push(this.collection.get(e[s]).get("identifierData"));this._updateLastRootID(i),n.length>0&&this._setNavigatedNodes(n,!0)},addToRecents:function(e){var t=[];"string"==typeof e?t.push(e):t=e,this._addRecents(t)},_addRecents:function(e){for(var t,i=m.getPref("_Recents")||[],n=0;n<e.length;n++)-1===i.indexOf(e[n])?i.push(e[n]):(t=i.indexOf(e[n]),i.splice(t,1),i.push(e[n])),i.length>10&&i.shift();m.setPrefToLocalStorage("_Recents",i)},_setNavigatedNodes:function(e,t){t||(this._navigatedNodes={});for(var i=0;i<Object.keys(e).length;i++)Object.keys(this._navigatedNodes).indexOf(Object.keys(e)[i])<0&&(this._navigatedNodes[Object.keys(e)[i]]=Object.values(e)[i]);m.setPrefToWidget("ENORIPE_navigatedNodes",this._navigatedNodes)},_createNewProfile:function(e){if(e){e.name;var t=!1;this._setRelationSet(e),this.currentProfile=e.name;for(var i=this._activeProfiles,n=0;n<i.length;n++)i[n].name===e.name&&(this._activeProfiles[n].relations=e.relations,t=!0);t||this._activeProfiles.splice(1,0,e),this._customizeAllView.relationSetSaved(e)}},_deleteProfile:function(e,t){var i=m.getPref("_ENORIPE_CustomRelationsSet");if(i){for(var n=i,o=0;o<n.length;o++)n[o].name===e&&i.splice(o,1);m.setPrefToLocalStorage("_ENORIPE_CustomRelationsSet",i);for(var a=this._activeProfiles,r=0;r<a.length;r++)a[r].name===e&&this._activeProfiles.splice(r,1);this.currentProfile=t,this._savePreferencesEverywhere("LastUsedProfile",s.setLastUsedProfile.bind(s),t),this._customizeAllView.relationSetDeleted(e)}},_getRelForAutoMode:function(e){var t=[],i={};this.collection&&this.collection.filter(function(e){if("link"===e.get("modelType")){var i=e.get("type");-1===t.indexOf(i)&&t.push(i)}});var n=this._sortGroupedRel(e),s={};for(var o in e)if(e.hasOwnProperty(o))for(var a=0;a<e[o].length;a++)for(var r=0;r<t.length;r++)if(e[o][a].id.contains(t[r])){e[o][a].present=!0,0,s[o]=e[o],delete n[o];break}return i.present=s,i.notPresent=n,i},_sortGroupedRel:function(e){if(e){var t={},i=[];for(var n in e)i.push([e[n].nlsLabel,n]);i.sort(function(e,t){var i=e[0].toLowerCase(),n=t[0].toLowerCase();return i<n?-1:i>n?1:0});for(var s=0;s<i.length;s++){var o=i[s][1];t[o]=e[o]}return t}},_splitRelations:function(e){var i,n,o,a={},r=!1,l={},d=[],c="",h="",u={},g=[],p={};e.forEach(function(e){g.push(e.name)}),this._currentRelations=[],void 0!==m.getPref("expandedDirection")&&(p=m.getPref("expandedDirection"));for(var v=0;v<e.length;v++){if(h="",n=e[v].name,h=this.currentProfile+":"+n,c=f.getMainRelName(n),void 0===this._getTempPreferences(h))i=!0;else{var _=this._getTempPreferences(h);"true"===_?_=!0:"false"===_&&(_=!1),i=_}e[v].showdetail&&"done"!==u[c]&&(u[c]="done",r=void 0!==this._getTempPreferences(this.currentProfile+":details_"+c)&&this._getTempPreferences(this.currentProfile+":details_"+c)),i&&!r?this._currentRelations.push(n):i&&r&&(this._currentRelations=this._currentRelations.concat(e[v].showdetail),this._publications[n]=e[v].showdetail),r=!1,a={id:n,relationName:E[n],value:i},d=E.get(c);var S=c+"_to",b=c+"_from";g.indexOf(S)>-1?o=E[S+"_short"]||E[S]:g.indexOf(b)>-1&&(o=E[b+"_short"]||E[b]),t.is(l[d],"array")||(l[d]=[]),a.id.contains("_from")?(!1===p.upstream&&(a.value=!1),l[d].unshift(a)):(!1===p.downstream&&(a.value=!1),l[d].push(a)),l[d].title=E[c+"_short"]||E[c]||c,l[d].nlsLabel=o||E[c+"_short"]||E[c]||c}s.setOption("currentRelations",this._currentRelations),this._groupedRelations=this._sortGroupedRel(l)},_hideOneDirection:function(e,t){var i="",n=[],s={upstream:!0,downstream:!0};return(s=m.getPref("expandedDirection")?m.getPref("expandedDirection"):s)[e]=!1,m.setPrefLocally("expandedDirection",s),t&&("upstream"===e?i="to":"downstream"===e&&(i="from"),this._currentRelations.forEach(function(e){var t=e.split("_");t[t.length-1]===i&&n.push(e)}),this._updatePreferences(n)),n},_showOneDirection:function(e,t){var i="",n=[...this._currentRelations],s={upstream:!1,downstream:!1};return(s=m.getPref("expandedDirection")?m.getPref("expandedDirection"):s)[e]=!0,m.setPrefLocally("expandedDirection",s),t&&("upstream"===e?i="from":"downstream"===e&&(i="to"),this._availableRelations.forEach(function(e){var t=e.name.split("_");t[t.length-1]===i&&n.indexOf(e.name)<0&&n.push(e.name)}),this._updatePreferences(n)),n},_initExpandedDirection:function(){var e=[];if(void 0!==m.getPref("expandedDirection")){let t=m.getPref("expandedDirection");!1===t.upstream&&(e=this._hideOneDirection("upstream")),!1===t.downstream&&(e=this._hideOneDirection("downstream"))}return e},_getAttrForTypes:function(){var e=s.getDefaultAttributes(),t=[];for(var i in e){if(e.hasOwnProperty(i))e[i].attributes.map(function(e){return e.uri}).forEach(function(e){e&&-1===t.indexOf(e)&&t.push(e)})}return t},_getExcludedRelations:function(){for(var e=[],t=this.autoModeProfile.relations,i=0;i<t.length;i++)-1===this._currentRelations.indexOf(t[i].name)&&e.push(t[i].name);return e},_getValuesForProfile:function(){var e;!this._isWebInWin&&(!!this._widgetId&&this._widgetId.contains("preview"));if(!(e=m.getPref("LastUsedProfile"))){let t="AutoModeProfile";this._settings&&this._settings.relation_apps&&(t=this._settings.relation_apps.ENORIPE_AP),e=t,this._savePreferencesLocally("LastUsedProfile",s.setLastUsedProfile.bind(s),t)}return e},onEndEditPref:function(){if("catiav5"!==this._addinMode&&"solidworks"!==this._addinMode){var e=m.getPref("selected_tenant"),t=!1,i=widget.getValue("xPref_CREDENTIAL");i!==s.getXPrefCredential()&&(s.setXPrefCredential(i),t=!0),e!==s.getCurrentTenantName()&&(t=!1,this._isEmpty?this._changePlatformSL(e):(this._needToConfirmPlatformChange=!0,this._currentNewTenantValue=e,this._navigationMap?(this._modal||this._setupModal(),this._modal.show()):(this._changePlatformSL(e),this._currentNewTenantValue="",this._isEmpty=!0,this._initMapView(!0),this._navigationMap&&this._navigationMap._showNotif({level:"warning",lvl:"warning",msg:E.get("PlatformChangesTo")+" "+e}))),this._updateWidgetHeader()),t&&(this._dontRefresh=!0,this._onRefresh({initWithNodes:this._navigatedNodes,needClear:!0}))}else try{let e=JSON.parse(widget.getValue("X3DContentId")).data.items,t=f.getItemsFromSelection(e)||{};this._resetMap(t,!0)}catch(e){console.error(e)}},_dropByMode:function(e,t,i){var n=this.collection||null,s=[],o={},a={};if(i&&i.length>0){for(var r=0;r<i.length;r++)if(i[r].objectType&&"ENORelationalExplorerFavorite"===i[r].objectType)return void this._handleFavoritesDrop(e,i[r]);if(o=f.getItemsFromSelection(i)||{},"extract"===e&&n)s=i.map(function(e){return e.objectId}),t&&s.push(...t),a={items:Object.values(o),restrictedMode:!0},n.getEcoSystem(a);else if(i&&"replace"===e)this._resetMap(o,!0),this._addRecents(i.map(function(e){return e.objectId})),this._updateFavoriteTitle(""),this._navigationMap&&(m.setPrefToWidget("favoriteID",null),this._addRootNode(i.map(function(e){return e.objectId})),this._navigationMap._isFavOpen=!1);else{if(this._isEmpty)return this._resetMap(o,!0),void this._addRootNode(i.map(function(e){return e.objectId}));"addInGraph"===e?this._addInGraph(i.map(function(e){return e.objectId}),o):this._dropAdd(o),this._addRecents(i.map(function(e){return e.objectId}))}}},_dropAdd:function(e){for(var t=[],i=m.getPref("lastRootNodeID")||[],n=(this.collection,0);n<Object.keys(e).length;n++){if(Object.values(e)[n].envId&&s.getCurrentTenantName()!==Object.values(e)[n].envId)return this._addNewObjectsFromDifferentPlatform=e,this._currentNewTenantValue=Object.values(e)[n],this._modal||this._setupModal(),void this._modal.show();if(i.indexOf(Object.keys(e)[n])<0)t.push(Object.keys(e)[n]);else{let i=this.collection.get(Object.keys(e)[n]);i&&JSON.stringify(i.get("instances"))!=JSON.stringify(Object.values(e)[n].instances)&&t.push(Object.keys(e)[n])}}this._addInGraph(t,e)},_addInGraph:function(e,t){var i;i=this.collection.where({modelType:"node",focus:!0}),e.length>0?(this.collection.updateColumnId=!0,this._addRootNode(e),this._fetchData(t,i)):this.hideSpinner()},_updatePreferences:function(e,t,i){var n,o,a,r="",l=[];if(e||(e=this._currentRelations,this._onRefresh({initWithNodes:this._navigatedNodes,newRelations:e})),this._cleanProxy(),this._navigationMap&&this._navigationMap.filter({allfilters:{}}),this._availableRelations.forEach(function(e){l.push(e.name)}),r=m.getPref("LastUsedProfile"),t&&""!=t){this.currentProfile=t;for(var d=0;d<this._activeProfiles.length;d++)if(this._activeProfiles[d].name===this.currentProfile&&r!=this.currentProfile){this._savePreferencesEverywhere("LastUsedProfile",s.setLastUsedProfile.bind(s),this._activeProfiles[d].name),this._navigationMap&&(this._navigationMap.updateProfile(this._activeProfiles[d].name),this._customizeAllView.updateProfile(this.currentProfile)),r=this._activeProfiles[d].name;break}}for(d=0;d<this._availableRelations.length;d++)o=this._availableRelations[d].name,a=this.currentProfile+":"+o,f.getMainRelName(o),n=e.indexOf(o)>-1?"true":"false",this._saveTempPreferences(a,n),this._lastSavedValues[o]=n;for(var c=0;c<this._activeProfiles.length;c++)this._activeProfiles[c].name===this.currentProfile&&(this._availableRelations=this._activeProfiles[c].relations,this._splitRelations(this._activeProfiles[c].relations));this.collection&&this._setAvailableRelation(e),this._currentRelations=e,s.setOption("currentRelations",this._currentRelations),this._autoNavMode&&(this._autoModeChanged=!0);let h={};if(i){let t={};i.rootPhysicalIds.forEach(function(e){"string"==typeof e?t[e]={id:e,instances:[]}:t[e.id]=e}),h={initWithNodes:t,newRelations:e,isFav:!0,favData:i}}else h={initWithNodes:this._navigatedNodes,newRelations:e};this.checkDirections([...this._currentRelations]),this._onRefresh(h),this._customizeAllView&&this._customizeAllView.showRelations({...this._groupedRelations}),this._updateWidgetHeader()},checkDirections:function(e){var t={upstream:!0,downstream:!0};t=m.getPref("expandedDirection")?m.getPref("expandedDirection"):t,this._checkOneDirection(e,"upstream",t),this._checkOneDirection(e,"downstream",t)},_checkOneDirection:function(e,t,i){var n="";"upstream"===t?n="from":"downstream"===t&&(n="to"),(e=e.filter(function(e){let t=e.split("_");if(t[t.length-1]===n)return!0})).length>0&&!i[t]?this._showOneDirection(t,!1):0===e.length&&i[t]&&this._hideOneDirection(t,!1)},_setupModal:function(){var e=this,t=this.container;this._navigationMap&&this._navigationMap.container&&(t=this._navigationMap.container),this._modal=new v({className:"site-reset",closable:!1,header:"<h4>"+E.get("PlatformChange")+"</h4>",body:"<p>"+E.get("PlatformChangeMsg")+"</p>",footer:'<button type="button" id="confirm-change" class="btn btn-primary">'+E.get("SNNCustomize_Save")+'</button> <button type="button" id="cancel-change" class="btn btn-default">'+E.get("SNNCustomize_Cancel")+"</button>"}).inject(t),this._modal.getContent().getElements(".btn").forEach(function(t){t.addEvent("click",function(){e._needToConfirmPlatformChange=!1,e._modal.hide(),"confirm-change"===this.getAttribute("id")?(e.clearMap(),e._changePlatformSL(e._currentNewTenantValue),e._currentNewTenantValue="",e._addNewObjectsFromDifferentPlatform&&(e._resetMap(e._addNewObjectsFromDifferentPlatform),e._addNewObjectsFromDifferentPlatform=void 0)):(m.setPrefToWidget("selected_tenant",s.getCurrentTenantName()),e._currentNewTenantValue="",this.hideSpinner())})})},trackProfileUsage:function(e){var t=[],i=e,n=[],s=[];this._settings.relation_sets&&(t=this._settings.relation_sets.map(function(e){return e.name})),t.indexOf(e)>-1?i="AdminCustomProfile":((n=m.getPref("_ENORIPE_CustomRelationsSet"))&&(s=n.map(function(e){return e.name})),s.indexOf(e)>-1&&(i="UserCustomProfile")),o.trackUsage("ProfileUsage",i)},showMessageNotIndexed:function(e){var t=this,i=E.get("ObjectNotLoaded"),n={};e>1&&(i=E.replace(E.get("ObjectsNotLoaded"),{objectNbr:e})),n={level:"error",title:i,subtitle:E.get("ObjectNotIndexed")};let o=s.getXPrefCredential();b.authenticatedRequest(s.get3DSpaceUrl()+"/cvservlet/indexingdate?SecurityContext="+o,{headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:o},method:"POST",data:JSON.stringify({select_service:["FTS"]}),onComplete:function(e){if((e=JSON.parse(e)).FTS&&e.FTS.allvaultsacl){var i=new Date(1e3*e.FTS.allvaultsacl),s=i.getHours(),o="0"+i.getMinutes(),a="0"+i.getSeconds(),r=s+":"+o.substring(o.length-2)+":"+a.substring(a.length-2);n.msg=" "+E.get("LastIndexed")+" "+r}t._navigationMap._showNotif(n)},onFailure:function(e){t._navigationMap._showNotif(n)},onTimeout:function(e){t._navigationMap._showNotif(n)}})},onResize:function(){this._navigationMap&&this._navigationMap.onResize(),this._homePage&&this._homePage.onResize()},_updateFavoriteTitle:function(e){this._navigationMap&&this._navigationMap._toolBarView&&this._navigationMap._toolBarView.updateFavoriteTitle(e)},_resetMap:function(e,t){for(var i="",n=0;n<e.length;n++)""===i?i=e[n].envId:e[n].envId;i&&s.getCurrentTenantName()!==i&&this._changePlatformSL(i),0!==Object.keys(e).length?(this._cleanProxy(),this._addRootNode([],!0),this._onRefresh({initWithNodes:e,needClear:t})):this.hideSpinner()},_onRefreshWebInWin:function(e){var t=e.initWithNodes,i=this;if(!t&&e.initWithFavorite&&(t=[e.initWithFavorite]),t&&"[]"!==t){0===t.indexOf("[")?t=JSON.parse(t):"string"==typeof t&&(t=[t]);const n={};t.forEach(e=>{n[e]={id:e}}),e.initWithNodes=n,this._updateLastRootID(t),i._isFavorite(t[0]).then(function(n){n?i._openFavorite(t[0]):i._onRefresh(e)},function(){i._onRefresh(e)})}else i._onRefresh(e)},_onRefresh:function(e){if(e.newRelations&&(this._currentRelations=e.newRelations,s.setOption("currentRelations",this._currentRelations),e.needClear=!0),e.initWithNodes&&Object.keys(e.initWithNodes).length>0)if(this.showSpinner(),!0===e.needClear){var t=this;m.setPrefToWidget("ENORIPE_savedColumnIds",{}),t.clearMap(!0).then(function(){t._setNavigatedNodes(e.initWithNodes),t._initCollection({initWithNodes:e.initWithNodes,objectType:e.objecType||null,needClear:!0,selectedNodes:e.selectedNodes||[]}),e.isFav&&(e.favData.layoutType&&t._updateLayoutType(e.favData.layoutType),t.updateFavTitle(e.favData))})}else this._refreshCollection({initWithNodes:e.initWithNodes,objectType:e.objecType||null})},clearMap:function(e){return new i(function(t,i){this._cleanProxy(),this._isEmpty=!0,this._navigatedNodes=[],m.setPrefToWidget("ENORIPE_navigatedNodes",this._navigatedNodes),widget&&widget.setValue("X3DContentId","{}"),this.collection&&this.collection.reset(),this._updateFavoriteTitle(""),this._navigationMap&&this._navigationMap._toolBarView&&this._navigationMap._toolBarView.disableEditLayoutCommand(),e?h.clear().then(function(){this._setPreferences().then(function(){this._navigationMap&&this._navigationMap.clearMapSuccess(!1),t()}.bind(this),function(){this._navigationMap&&this._navigationMap.clearMapFailure(),i()}.bind(this))}.bind(this),function(){this._navigationMap&&this._navigationMap.clearMapFailure(),i()}.bind(this)):(this._navigationMap&&this._navigationMap.clearMapSuccess(!1),t())}.bind(this))},hideSpinner:function(){this._navigationMap&&this._navigationMap.hideSpinner()},showSpinner:function(){this._navigationMap&&this._navigationMap.showSpinner()}})});