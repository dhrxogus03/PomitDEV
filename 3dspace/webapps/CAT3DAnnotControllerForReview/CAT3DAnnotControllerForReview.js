/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/CAT3DAnnotControllerForReview/CATDIFAnnotSetLoader",["UWA/Class","DS/DibUDLWebLoader/CATDibUDLWebLoaderForAnnotationSet","DS/CAT3DAnnotationModelLoader/CAT3DAnnotationModelLoader","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt"],function(t,e,n,i,o){"use strict";return t.extend({init:function(t){this._parent(t);let a=t.context;this.load=function({id:t}){return new Promise(function(l){(new e).getProductIDAssociatedToAnnotationSet({physicalid:t,serverUrl:i.get3DSpaceUrl(),securityContext:o.getSetting("pad_security_ctx"),onComplete:function(e){if(e&&a)if(a.getController().getNode({id:e})){let t=n.giveAnnotationModelLoader({context:a});t&&t.loadFTAModel({idPath:[e]})}else a.addRoots({objects:[{path:[e]}]});let i=window.widget.getValue("xsceneStoredObjects");i&&"string"==typeof i||(i='{"products":{},"filters":{}}'),(i=JSON.parse(i)).difAnnotSet||(i.difAnnotSet={}),i.difAnnotSet[t]={},window.widget.setValue("xsceneStoredObjects",JSON.stringify(i)),require(["DS/PADServices/utils/GlobalModelEvents"],function(e){e.publish({event:"ENXViews/LandingPage/refreshCustom",data:[t]})}),a.getApplicativeData().removeDIFAnnotSetKeepPrd||(a.getApplicativeData().removeDIFAnnotSetKeepPrd=function(t){let e=n.giveAnnotationModelLoader({context:a});e&&e.removeDIFAnnotationSet({id:t})}),l()},onFailure:l})})}}})}),define("DS/CAT3DAnnotControllerForReview/CAT3DAnnotationSectionHideShowController",["require","exports","DS/CAT3DAnnotationController/CAT3DAnnotationController"],function(t,e,n){"use strict";class i{}return i.setSectionVisibilityFlag=function(t,e){let i=n.giveAnnotationController({context:t});i&&i.setSectionVisibleFlag(e)},i.getSectionVisibilityFlag=function(t){let e=n.giveAnnotationController({context:t});return!!e&&e.getSectionVisibleFlag()},i}),define("DS/CAT3DAnnotControllerForReview/CAT3DAnnotControllerForReview",["UWA/Class","DS/CoreEvents/ModelEvents","DS/CAT3DAnnotationModelLoader/CAT3DAnnotationModelLoader","DS/CAT3DAnnotationFavoriteCtx/CAT3DAnnotationFavoriteCtxManager","DS/CAT3DAnnotationController/CAT3DAnnotationController","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/CAT3DAnnotationBaseCmds/controllers/CAT3DAnnotationBrowserController","DS/CAT3DAnnotationUtils/CAT3DAnnotationUtils","DS/Selection/CSOManager","DS/CATWebUXComponents/DMUCommandsManager","DS/PADUtils/views/PADAlert","DS/CAT3DAnnotationUtils/CAT3DAnnotationStorageController","i18n!DS/CAT3DAnnotControllerForReview/assets/nls/CAT3DAnnotControllerForReview"],function(t,e,n,i,o,a,l,r,s,c,A,u,p){"use strict";var g=t.extend({init:function(t){this._parent(t);var g,f,d,C,v,D,h,b,S,m,I=this,x="FTA",y=t.ctxViewer,F=!1,T=new e,w=!1,E=!1,P=!0,O=!1,L=[],V=!1,U=!1,M=!1,R={},k={},B={},N=!0,W=!0,_=!1,j=null;function q(t){for(var e,n=[],i=t.externalPath,o=0;o<i.length;o++)(e=r.getNodeID(i[o]))&&n.push(e);return n}function H(t,e){T.publish({event:t,data:e})}function z(t){E||g||f||!v||!D||D.isRunning()||!w||(t&&t.node&&"tpsAnnotationSet"===t.node.getAnnotationClassType()?H("onApplicativeContextChanged",{id:x}):(b&&clearTimeout(b),b=setTimeout(function(){b=0,E||g||f||!v||!D||D.isRunning()||!w||(P=!1,H("onApplicativeContentChanged",{id:x}),P=!0)})))}function X(t){var e,n={visibleAnnotations:[],annots:[]};if(!t)return n;if("number"==typeof t.version){for(n.visibleAnnotations=t.context.data.slice(),e=0;e<n.visibleAnnotations.length;e++)if(n.visibleAnnotations[e].viewOrCaptureDisplayedID){n.viewOrCaptureDisplayedID=n.visibleAnnotations[e].viewOrCaptureDisplayedID;break}n.annots=t.content&&t.content.annots&&t.content.annots.slice?t.content.annots.slice():[]}else for(n.visibleAnnotations=t.visibleAnnotations.slice(),n.viewOrCaptureDisplayedID=t.viewOrCaptureDisplayedID,n.annots=[],e=0;e<n.visibleAnnotations.length;e++)if(n.visibleAnnotations[e].annotationIDs||n.visibleAnnotations[e].featureIDs){n.annots.push({annotationSetID:n.visibleAnnotations[e].annotationSetID,annotationIDs:n.visibleAnnotations[e].annotationIDs?n.visibleAnnotations[e].annotationIDs:[],featureIDs:n.visibleAnnotations[e].featureIDs?n.visibleAnnotations[e].featureIDs:[]});break}return n}function J(){if(w){if(!D||D&&D.isRunning()||!h)return m&&clearTimeout(m),void(m=setTimeout(function(){m=null,J()},10));var t,e;h&&h.getActiveState()&&_&&h.hideAttributeResultTable();var n=function(){g.cb(),g=null,f&&(g=f,f=null,J())};if(g){var i=g.state,o=function(){var o,a,l,r,s,c,A,u=D.getOrderedAnnotationSetPaths(),p=[],g=[],f=[],d=function(t,e,n,i){var o=t.getLastElement(!0);if(o.getAnnotationClassType){var a=e.indexOf(o.getAnnotationUuid());-1!==a?(e.splice(a,1),o.setVisibility(!0)):"tpsAnnotationSet"!==o.getAnnotationClassType()&&"tpsRoot"!==o.getAnnotationClassType()&&"tpsAttribute"!==o.getAnnotationClassType()&&o.setVisibility(!1),-1!==(a=n.indexOf(o.getAnnotationUuid()))&&(n.splice(a,1),l=t.clone(),p.push(l),g.push({pathElement:l})),-1!==(a=i.indexOf(o.getAnnotationUuid()))&&(i.splice(a,1),l=t.clone(),p.push(l),f.push({pathElement:l}));var r=t.getChildrenPathes();if(r.length)for(var s=0;s<r.length;s++)d(r[s],e,n,i)}};for(t=0;t<u.length;t++){for(o=u[t].annotSetPath.getLastElement(!0),a=!1,r=[],s=[],c=[],e=0;e<i.visibleAnnotations.length;e++)i.visibleAnnotations[e].annotationSetID===o.getAnnotationUuid()&&(a=!0,i.visibleAnnotations[e].displayedIDs&&(c=c.concat(i.visibleAnnotations[e].displayedIDs)),i.visibleAnnotations[e].displayOpts&&(A=i.visibleAnnotations[e].displayOpts));for(e=0;e<i.annots.length;e++)i.annots[e].annotationSetID===o.getAnnotationUuid()&&(a=!0,r=r.concat(i.annots[e].annotationIDs),s=s.concat(i.annots[e].featureIDs));a&&d(u[t].annotSetPath,r||[],s||[],c||[]),o.setVisibility(a)}O=!1,h&&h.getActiveState()&&(O=f&&f.length||h.getDisplayedElementPaths()&&h.getDisplayedElementPaths().length,_&&h.displayAttributeResultTable(p)),A=A?JSON.parse(A):void 0,h.setDisplayedElementPaths(f,A),h.setSelectedElementPaths(g,A),n()},a=function(){v.setSectionVisibleFlag(N),v.displayFTAViewOrCapture({uuid:i.viewOrCaptureDisplayedID,changeViewpoint:!1,changeAnnotationVisibleStates:!1,cb:o})};if(i.visibleAnnotations){var l=function(){var t,e=[];if(D.isRunning())return!1;for(t=0;t<i.visibleAnnotations.length;t++)e.push(i.visibleAnnotations[t].annotationSetID);var n,o=D.getLoadedAnnotationSets();for(t=0;t<o.length;t++)-1!==(n=e.indexOf(o[t].getAnnotationUuid()))&&e.splice(n,1);return 0===e.length};if(l())a();else{for(t=0;t<i.visibleAnnotations.length;t++)i.visibleAnnotations[t].path&&D.loadFTAModel({idPath:i.visibleAnnotations[t].path});var r=0,s=setInterval(function(){l()?(clearInterval(s),a()):++r>=50&&(clearInterval(s),A.displayNotification({eventID:"info",msg:p.errorWhileSettingAppCtx}),n())},100)}}}else n()}}function G(){if(U){h&&h.setControllerEnableFlag(w);var t=l.give3DAnnotBrowserController({context:y});t&&t.setControllerEnableFlag(w),require([].concat(["DS/CAT3DAnnotationCommands/controllers/CAT3DAnnotationFilterController"]),function(t){var e=t.give3DAnnotFilterController({context:y});e&&e.setControllerEnableFlag(w)})}}this.subscribe=function(t,e){return t&&e?T.subscribe({event:t},e):void 0},this.unsubscribe=function(t){T&&t&&T.unsubscribe(t)},this.setActiveState=function(t){if(w!==t&&y){if(w=t,F){if(U){var e=i.giveFavoriteContextManager({context:y});e&&e.setActivationDropState(w)}if(w)R.onBeginDisplayViewOrCapture||(R.onBeginDisplayViewOrCapture=v.subscribe("onBeginDisplayViewOrCapture",function(){E=!0}),R.onViewOrCaptureDisplayed=v.subscribe("onViewOrCaptureDisplayed",function(){E=!1,g||f||H("onApplicativeContextRequested",{id:x})}),R.onFilteringAndClippingRemoved=v.subscribe("onFilteringAndClippingRemoved",function(t){t&&t.interactiveAction&&(g||f||H("onApplicativeContextChanged",{id:x}))}),R.onDisplayedAnnotationsOrFeaturesChanged=v.subscribe("onDisplayedAnnotationsOrFeaturesChanged",function(){E||g||f||O||H("onApplicativeContextChanged",{id:x}),O=!1}),k.onAnnotationVisibilityModified=D.subscribe("onAnnotationVisibilityModified",z),k.onAnnotationSetLoadedToken=D.subscribe("onAnnotationSetLoaded",function(){!E&&!g&&!f&&v&&D&&w&&H("onApplicativeContextChanged",{id:x})}),B.onCommentSelected=h.subscribe("onCommentSelected",function(t){if(t&&t.path){var e=t.path.getLastElement(!0);e&&e.getAnnotationUuid&&H("onApplicativeContextRequested",{id:x,data:{selectedFeature:e.getAnnotationUuid()},forceDisplay:!0})}})),V&&U||h.setActiveState(!0),h.allowTableExportInCSV(!1),v.setActiveState(w),D.setActiveState(w&&U?1:w&&!U?2:0),L&&h.updateCommentColumn(L),I.setMinimalUIFlag(!(U&&V)),f&&!g&&(g=f,f=null,J());else{var n,o;if(g=f=null,E=!1,h){for(h.allowTableExportInCSV(!0),n=Object.keys(B),o=0;o<n.length;o++)h.unsubscribe(B[n[o]]);B={},V&&U||h.setActiveState(!1)}if(v){for(n=Object.keys(R),o=0;o<n.length;o++)v.unsubscribe(R[n[o]]);R={},M&&v.saveLastFTAViewOrCaptureDisplayed(!0),v.setActiveState(!1)}if(D){for(n=Object.keys(k),o=0;o<n.length;o++)D.unsubscribe(k[n[o]]);k={},M||D.setActiveState(0)}}H("onApplicativeContextActiveStateModified",{id:x,state:w})}G()}},this.getActiveState=function(){return w},this.setMinimalUIFlag=function(t){t!==_&&(_=t,h&&h.setResultRepresentationModeFlag(_||!V))},this.setAnnotationUIVisibleFlag=function(t){v&&v.setAnnotationUIVisibleFlag(t)},this.getMinimalUIFlag=function(){return _},this.onLeavingApp=function(t){M=t&&"CATA3I_AP"===t.targetApp},this.initializeAppContainer=function(t){U=!!(t&&t.options&&t.options.authoring)&&t.options.authoring,a.getGrantedRoles(function(e){V=!1,e.forEach(function(t){("InternalDS"===t.id||("YED"===t.id||"RED"===t.id||"PAU"===t.id||"DMRMH"===t.id)&&(t.platforms||[]).indexOf(require("DS/PADUtils/PADUtilsServices").getPlatformId())>-1)&&(V=!0)});var a=V?["DS/CAT3DAnnotSemanticController/CAT3DAnnotSemanticContInstance"]:["DS/CAT3DAnnotationExpController/CAT3DAnnotExpControllerInstance"];a.push("DS/CAT3DAnnotationAttributeController/CAT3DAnnotationAttributeController"),require(a,function(e,a){if(d=e,C=a,t.onDataWorkbenchReadyCB({wkb:"3D",file:V?"CAT3DAnnotSemanticControllerForReview.xml":"CAT3DAnnotExpControllerForReview.xml",module:"CAT3DAnnotControllerForReview",cb:G}),t.onPreferencesReadyCB(u.getPreferenceDefinitions({thumbnailPrefs:U,attributePrefs:U&&V,loadingPrefs:U,annotDisplayPrefs:!0,keepSelectedFeaturesPrefs:U,favoriteCtxPrefs:U})),!(D=n.giveAnnotationModelLoader({context:y}))){var l=i.getFavoriteContextManager({context:y});D=n.getAnnotationModelLoader({context:y,favoriteCtxManager:l})}if(!v&&!(v=o.giveAnnotationController({context:y}))){var r=new d({ctxViewer:y,slideShowCtrl:!1});r.disableCtxCommandsAvailability(!U||["CAT3DAnnotationLevelSelectorHdr","RemoveRootHdr"]),o.registerAnnotationController({annotController:r,context:y}),v=o.giveAnnotationController({context:y})}!h&&C&&(h=C.get3DAnnotAttrBrowserController({context:y})),u.initPrefManager({context:y.getFrameWindow()}).then(()=>{var e=0;j=setInterval(function(){(!V||V&&c.getCommandCheckHeader("CAT3DAnnotationBrowserHdr",y.getCommandContext())||e>=30)&&(clearInterval(j),F=!0,"boolean"==typeof w&&(w=!w,I.setActiveState(!w)),t.onApplicativeControllerInitialized()),e++},100)})})})},this.clear=function(){I.setActiveState(!1),S&&(clearInterval(S),S=null),v&&o.unreferenceAnnotationController({context:y}),D&&!M&&(n.unreferenceAnnotationModelLoader({context:y}),i.unreferenceFavoriteContextManager({context:y})),h&&C&&C.unreference3DAnnotAttrBrowserController({context:y}),j&&(clearInterval(j),j=null),F=!1,L.length=0,v=D=h=null,V=!1,d=C=T=y=null},this.updateAppContainer=function({slidesEditableFlag:t,slidesAppData:e}){var n,i,o,a,l={};if(e&&e.length)for(i=0;i<e.length;i++)if(n=X(e[i].state)){if(n.visibleAnnotations&&n.visibleAnnotations.length)for(o=0;o<n.visibleAnnotations.length;o++)if(n.visibleAnnotations[o].displayedIDs)for(a=0;a<n.visibleAnnotations[o].displayedIDs.length;a++)l[n.visibleAnnotations[o].displayedIDs[a]]||(l[n.visibleAnnotations[o].displayedIDs[a]]=0),l[n.visibleAnnotations[o].displayedIDs[a]]++;if(n.annots&&n.annots.length)for(o=0;o<n.annots.length;o++)if(n.annots[o].featureIDs)for(a=0;a<n.annots[o].featureIDs.length;a++)l[n.annots[o].featureIDs[a]]||(l[n.annots[o].featureIDs[a]]=0),l[n.annots[o].featureIDs[a]]++}h&&h.getActiveState()&&(h.forceCommentColumnVisibilityFlag(t),h.updateCommentColumn(l)),L=l},this.displayAppContainerState=function(t){if(t&&"function"==typeof t.callback&&w){var e=X(t.state);if(e)if(F&&!g){g={state:e,cb:t.callback};for(var n=s.get(),i=n.length-1;i>=0;i--)n[i].pathElement.getLastElement(!0).getAnnotationClassType&&s.remove(n[i]);J()}else f={state:e,cb:t.callback};else t.callback()}},this.getCurrentAppContainerState=function(){if(w){var t,e,n={version:0,context:{},content:{}},i=D.getOrderedAnnotationSetPaths();if(i.length){var o,a,l,r,c,A=s.get(),u=[];P&&(u=A.filter(function(t){return"function"==typeof t.pathElement.getLastElement(!0).getAnnotationClassType})),n.context.data=[],n.content.annots=[];var p=v.getFTAViewOrCaptureDisplayed();for(t=0;t<i.length;t++)if((l=i[t].annotSetPath.getLastElement(!0))&&l.isVisible()){var g;(o={}).path=q(i[t].referencePath),o.annotationSetID=l.getAnnotationUuid(),p&&p.getParentPath().getParentPath().getLastElement(!0)===l&&(o.viewOrCaptureDisplayedID=p.getLastElement(!0).getAnnotationUuid()),h.getDisplayedElementsFilteringOpts&&h.getDisplayedElementsFilteringOpts()&&(o.displayOpts=JSON.stringify(h.getDisplayedElementsFilteringOpts()));var f=h.getDisplayedElementPaths();if(f&&f.length)for(o.displayedIDs=[],e=f.length-1;e>=0;e--){for(g=f[e].pathElement.clone();g&&g.getLastElement(!0).getAnnotationClassType&&"tpsAnnotationSet"!==g.getLastElement(!0).getAnnotationClassType();)g=g.getParentPath();g&&g.getLastElement(!0)&&g.getLastElement(!0).getAnnotationClassType&&i[t].annotSetPath.getLastElement(!0)===g.getLastElement(!0)&&f[e].pathElement.getLastElement(!0).getAnnotationUuid()&&o.displayedIDs.push(f[e].pathElement.getLastElement(!0).getAnnotationUuid())}for(n.context.data.push(o),(a={}).annotationSetID=l.getAnnotationUuid(),a.annotationIDs=[],e=0;e<l.children.length;e++)if("RootAttributes"!==(r=l.children[e]).getAnnotationType())for(var d=0;d<r.children.length;d++)(c=r.children[d]).isVisible()&&c.getAnnotationUuid()&&a.annotationIDs.push(c.getAnnotationUuid());for(a.featureIDs=[],e=u.length-1;e>=0;e--){for(g=u[e].pathElement;g&&g.getLastElement(!0).getAnnotationClassType&&"tpsAnnotationSet"!==g.getLastElement(!0).getAnnotationClassType();)g=g.getParentPath();g&&g.getLastElement(!0)&&g.getLastElement(!0).getAnnotationClassType&&i[t].annotSetPath.getLastElement(!0)===g.getLastElement(!0)&&u[e].pathElement.getLastElement(!0).getAnnotationUuid()&&a.featureIDs.push(u[e].pathElement.getLastElement(!0).getAnnotationUuid())}n.content.annots.push(a)}return n}}},this.getCurrentAppContainerStateTitle=function(){var t,e=v.getFTAViewOrCaptureDisplayed();if(e)t=e.getLastElement(!0).getAnnotationName();else{let e=s.get().filter(function(t){return"function"==typeof t.pathElement.getLastElement(!0).getAnnotationName});1===e.length&&(t=e[0].pathElement.getLastElement(!0).getAnnotationName())}return t},this.getFeatureInformation=function(t){let e;if(v&&v.getActiveState())if(t)e=v.getAssociatedInformations([t],!0);else if(h){let t=h.getDisplayedElementPaths();t&&1===t.length&&t[0].pathElement&&(e=v.getAssociatedInformations([t[0].pathElement],!0))}return e&&e.length?e[0]:{}},this.getApplicativeContainerID=function(){return x},this.getOrderedAppContainerStates=function(t,e){var n,i,o,a,l=[],r=v.getFTAViewOrCaptureDisplayed();if(r&&(n=r.getLastElement(!0).getAnnotationUuid()),e&&e.selectedFeature){for(i=0;i<t.length;i++)if(a=X(t[i])){var s=!1;if(a.visibleAnnotations&&a.visibleAnnotations.length)for(o=0;o<a.visibleAnnotations.length;o++)if(a.visibleAnnotations[o].displayedIDs&&-1!==a.visibleAnnotations[o].displayedIDs.indexOf(e.selectedFeature)){l.push(t[i]),s=!0;break}if(!s&&a.annots&&a.annots.length)for(o=0;o<a.annots.length;o++)if(a.annots[o].featureIDs&&-1!==a.annots[o].featureIDs.indexOf(e.selectedFeature)){l.push(t[i]);break}}}else for(i=0;i<t.length;i++)(a=X(t[i]))&&a.viewOrCaptureDisplayedID===n&&l.push(t[i]);return l},this.setAppSectionPlanesVisibleFlag=function(t){N=t},this.getAppSectionPlanesVisibleFlag=function(){return N},this.setAppViewpointManipFlag=function(t){W=t},this.getAppViewpointManipFlag=function(){return W}}}),f=[];return t.singleton({init:function(){},getApplicativeController:function(t){if(t&&t.context){for(var e=!1,n=0;n<f.length;n++)if(f[n].context===t.context){e=!0;break}return e||f.push({context:t.context,controller:new g({ctxViewer:t.context})}),this.giveApplicativeController(t)}},giveApplicativeController:function(t){if(t&&t.context){for(var e,n,i=0;i<f.length;i++)if(f[i].context===t.context){n=f[i],e=n.controller;break}if(e)return Object.freeze({setActiveState:function(t){e&&e.setActiveState(t)},getActiveState:function(){return e?e.getActiveState():null},subscribe:function(t,n){return e?e.subscribe(t,n):void 0},unsubscribe:function(t){e&&e.unsubscribe(t)},initializeAppContainer:function(t){e&&e.initializeAppContainer(t)},updateAppContainer:function(t){e&&e.updateAppContainer(t)},onLeavingApp:function(t){e&&e.onLeavingApp(t)},displayAppContainerState:function(t){e&&e.displayAppContainerState(t)},getCurrentAppContainerState:function(){return e?e.getCurrentAppContainerState():null},getApplicativeContainerID:function(){return e?e.getApplicativeContainerID():null},getOrderedAppContainerStates:function(t,n){return e?e.getOrderedAppContainerStates(t,n):null},getCurrentAppContainerStateTitle:function(){return e?e.getCurrentAppContainerStateTitle():null},setMinimalUIFlag:function(t){e&&e.setMinimalUIFlag(t)},getMinimalUIFlag:function(){return e?e.getMinimalUIFlag():null},setAnnotationUIVisibleFlag:function(t){e&&e.setAnnotationUIVisibleFlag(t)},setAppSectionPlanesVisibleFlag:function(t){e&&e.setAppSectionPlanesVisibleFlag(t)},getAppSectionPlanesVisibleFlag:function(){return e?e.getAppSectionPlanesVisibleFlag():null},setAppViewpointManipFlag:function(t){e&&e.setAppViewpointManipFlag(t)},getAppViewpointManipFlag:function(){return e?e.getAppViewpointManipFlag():null},getFeatureInformation:function(t){return e?e.getFeatureInformation(t):null}})}},unreferenceApplicativeController:function(t){if(t&&t.context)for(var e=0;e<f.length;e++)f[e].context===t.context&&(f[e].controller&&f[e].controller.clear(),f.splice(e,1))}})}),define("DS/CAT3DAnnotControllerForReview/CAT3DAnnotationSwitchOnOffCmd",["DS/CATWebUXComponents/DMUCommandCheckHeader","DS/PADUtils/PADContext","DS/CAT3DAnnotControllerForReview/CAT3DAnnotControllerForReview"],function(t,e,n){"use strict";let i,o,a=this,l=t.extend({init:function(t){this._parent(t,{}),a=this,i=e.get();var r=this.onStateChange(function(){a.getState()?l.SwitchOn():l.SwitchOff()});this._destroy=function(){var t=n.giveApplicativeController({context:i});t&&t.setActiveState(!1),o&&clearInterval(o),a._modelEvents.unsubscribe(r),i=o=null},a.setState("true"===localStorage.getItem("CAT3DAnnotationSwitchOnOffCmd"))}});return l.SwitchOn=function(t,a){!i&&a?i=a.executionContext.getComponent("Viewer"):i||a||(i=e.get());var l=n.giveApplicativeController({context:i});l&&l.setActiveState(!0),o||(o=setInterval(()=>{(l=n.getApplicativeController({context:i}))&&(clearInterval(o),o=null,l.setActiveState(!0))},100)),localStorage.setItem("CAT3DAnnotationSwitchOnOffCmd","true"),t&&t()},l.SwitchOff=function(t,a){!i&&a?i=a.executionContext.getComponent("Viewer"):i||a||(i=e.get());var l=n.giveApplicativeController({context:i});l&&l.setActiveState(!1),o||(o=setInterval(()=>{(l=n.getApplicativeController({context:i}))&&(clearInterval(o),o=null,l.setActiveState(!1))},100)),localStorage.setItem("CAT3DAnnotationSwitchOnOffCmd","false"),t&&t()},l});