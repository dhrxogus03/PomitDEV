define("DS/WUXAutoComplete/AutoComplete",["UWA/Core","DS/Utilities/Dom","DS/Controls/Abstract","DS/Controls/SelectionChips","DS/Controls/LineEditor","DS/Controls/Popup","DS/Controls/TooltipModel","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Utilities/Array","DS/Utilities/KeyboardUtils","DS/Utilities/Utils","DS/Utilities/TouchUtils","i18n!DS/WUXAutoComplete/assets/nls/translation","DS/Menu/Menu","DS/Controls/Loader","css!DS/WUXAutoComplete/assets/css/wuxautocompleteloader.css"],function(e,t,i,o,s,l,a,n,d,r,h,p,u,c,_,m,f){"use strict";const g=3,v={ADD:1,REMOVE:2},y={classic:{expanderStyle:"classic",buildLinks:!0,depthIncrement:14},triangle:{expanderStyle:"triangle",buildLinks:!1,depthIncrement:14},none:{expanderStyle:"none",buildLinks:!1,depthIncrement:14}};function C(e){return void 0!==e?Array.isArray(e)?this.multiSearchMode?e:e.length?[e[0]]:[]:[e]:[]}const w={CLOSED:0,DISPLAY_SEARCH:1,DISPLAY_COMPLETE_MODEL:2},b={RESET:0,SELECTION_CHANGE:1,INPUT_CHANGE:2,SHOW_POPUP:3,HIDE_POPUP:4,ESCAPE:5};function I(e){e===b.SELECTION_CHANGE?this._autoCompleteState===w.DISPLAY_SEARCH&&(this._autoCompleteState=w.DISPLAY_COMPLETE_MODEL):e===b.RESET?this._autoCompleteState=w.CLOSED:e===b.INPUT_CHANGE?this._autoCompleteState=w.DISPLAY_SEARCH:e===b.SHOW_POPUP?this._autoCompleteState===w.CLOSED&&(this._autoCompleteState=w.DISPLAY_COMPLETE_MODEL):e===b.HIDE_POPUP?this._autoCompleteState=w.CLOSED:e===b.ESCAPE&&(this._autoCompleteState=w.CLOSED)}function M(e){L.call(this,this._valueOperation,{operationType:v.ADD,noOfItemsModified:1},function(){const t=()=>{this.multiSearchMode?this._editor.value="":this._editor.value=this.selectedItems&&this.selectedItems.getLabel?this.selectedItems.getLabel():""};if(!e)return void(this.multiSearchMode||(this.selectedItems=void 0));let i=!0;if(!(i=this.multiSearchMode?!this.selectedItems||this.selectedItems.every(t=>t.getLabel()!==e):!this.selectedItems||this.selectedItems.getLabel&&this.selectedItems.getLabel()!==e))return void t();let o,s=N.call(this,e);if(!(s=s&&s[0])){if(!this.allowFreeInputFlag)return void t();s=new r({label:e,value:e,customNode:!0})}this.multiSearchMode?(o=(o=C.call(this,this.selectedItems)).slice(0),h.pushUnique(o,s)):o=[s],this.selectedItems=o})}function S(e){let t=0,i=!1;if(!this._dataGridView||!this._dataGridViewContainer)return i;let o=this._dataGridView.layout.getDefaultCellHeight();if(this._pendingPromise)t=o*g;else{t=0;let i=this._maximumItemsDisplayed*(o+1),s=e?Math.min(e.bottom-4,i):i;if(0===this._model.getNumberOfVisibleDescendants())t=o;else{for(let[e,i,l]=[0,0,this._model?this._model.getNumberOfVisibleDescendants():0];e<l&&t<s;e++)t+=i=(this._dataGridView.layout&&this._dataGridView.layout.getRowHeightFunction?this._dataGridView.layout.getRowHeightFunction(e):o)+1;this._hasScrollBar=t>=s,t=Math.min(t,s)}}const s=t+"px";return this._dataGridViewContainer.style.height!==s&&(this._dataGridViewContainer.style.height=s,i=!0),i}function V(e,i){let o=!1,s=0;if(this.popupSizeAdjustPolicy===l.SizeAdjustPolicyEnum.NoAdjust)s=this._DGVContainerFitWidth;else if(this._dataGridView){const e=this._hasScrollBar?u.getScrollbarWidth():0;let i,o=!0;if(this._model&&this._model.processDescendants({onlyVisibleNodes:!0,processNode:()=>(o=!1,{stopProcessing:!0})}),o){if(void 0===this._customFilterMessageWidth){const e=parseFloat(window.getComputedStyle(this.getContent(),null).getPropertyValue("font-size"));this._customFilterMessageWidth=t.computeStringWidth(this.customFilterMessage,e,"Arial",!0)}i=this._customFilterMessageWidth+(e?0:20)}else i=this._dataGridView._getMaxContentSizeInfo(["tree"],{computeAllRows:this.popupSizeAdjustPolicy===l.SizeAdjustPolicyEnum.AdjustToAllContents}).tree.maxContentSize;s=Math.max(this._DGVContainerMinWidth,i+e),this._DGVContainerWidth!==s&&(this._DGVContainerMinWidth=s)}if(this._availableSpaceObject=e,e){const t=this._DGVContainerFitWidth+e.left+e.right;s=Math.min(s,t)}return 0!==s&&this._DGVContainerWidth!==s&&(this._DGVContainerWidth=s,this._dataGridViewContainer.setStyle("width",s+"px"),o=!0),(o||i)&&this.elements.popup._updateView(),!this._popupVisibility&&this.elements.popup&&this.elements.popup.visibleFlag&&!this._lockPopupVisibilityChange&&(this._popupVisibility=!0,this.elements.popup.getContent().setStyle("visibility","visible"),this.fire("popupVisibilityChange")),o||i}function D(e){const t=S.call(this,e);return V.call(this,e,t)}function P(){var e=void 0;this._selectionChips&&(e=this._selectionChips.getContent().getDimensions().height),e!==this._selectionChipsHeight&&(this.elements.popup&&this.elements.popup._updateView(),D.call(this)),this._selectionChipsHeight=e}function A(e){let t=this.filterCB(e)||this._getFirstMatchingCellID();D.call(this),this.allowFreeInputFlag&&!this.displayCustomNodeInDropDown||""===e||O.call(this,t)}function O(e){this._dataGridView&&(this._dataGridView.setActiveCell(e,!0,!0),this._dataGridView.setPreselectedCell(e))}function E(e){if(!this._model)return;const t=this._model.getRoots(),i=t.length>0&&t[0].options.customNode?t[0]:void 0;if(!e||!this.allowFreeInputFlag||!this.displayCustomNodeInDropDown)return void(i&&this._model.removeRoot(i));const o=N.call(this,e);if(o&&o[0])return void(i&&i!==o[0]&&this._model.removeRoot(t[0]));if(i)return void i.updateOptions({label:e,value:e});const s=new r({label:e,value:e,icons:[{iconName:"pencil"}],customNode:!0,_freeInputNode:!0});this._model.addRoot(s,0)}function T(t,i){if(!this._modelLoaded)if(this.selectedItems&&i&&(L.call(this,this._valueModifiedbyAPI,!0,function(){this._model&&(this._model.getXSO().isEmpty()||this._model.getXSO().empty())}),I.call(this,b.RESET),this._properties.value.value=void 0,this._properties.selectedItems.value=void 0,this._selectionChips&&this._selectionChips.removeAllChips(),this._editor&&(this._editor.value="")),this._model&&A.call(this,""),function(){this._model&&(this._modelToken.forEach(e=>this._model.removeEventListener(e)),this._modelToken=[],this._xsoToken.forEach(e=>this._model.getXSO().unsubscribe(e)),this._xsoToken=[])}.call(this),void 0===t)this._ownModel||(this._model=this._defaultModel,this._dataGridView&&(this._dataGridView.model=this._defaultModel)),this._model.empty(),this._modelLoaded=!0;else{if(t instanceof d)return function(e){if(e instanceof d){this._ownModel=!1;const t=!this.isDirty("value")&&!this.isDirty("selectedItems"),i=C.call(this,this.selectedItems);if(t){const t=e.getXSO().get(),o=Array(i.length).fill(!1);i.length>0&&(e.search({match:e=>{const s=i.indexOf(e.nodeModel);if(-1!==s){o[s]=!0,i[s].select(),delete i[s].options.customNode;const l=t.indexOf(e.nodeModel);return-1!==l&&t.splice(l,1),!0}return!1},shouldStop:()=>o.every(e=>!0===e)}),i.forEach((e,t)=>{!1===o[t]&&(e.options.customNode=!0)}),i.push(...t))}this._model=e,this._modelLoaded=!0,this._dataGridView&&(this._dataGridView.treeDocument=this._model),t&&i.length>0&&L.call(this,this._valueOperation,{operationType:v.ADD,noOfItemsModified:i.length},function(){(this.multiSearchMode||this.selectedItems!==i[0])&&(this.selectedItems=i)}),F.call(this)}}.call(this,t);if(Array.isArray(t))return function(t){if(Array.isArray(t)){this._ownModel=!0;const s=!this.isDirty("value")&&!this.isDirty("selectedItems"),l=C.call(this,this.selectedItems),a=Array(l.length).fill(!1);for(var i=[],o=0;o<t.length;o++){const n=t[o],d="object"==typeof n,h=d?void 0!==n.value&&null!==n.value?n.value:n.label:n+"",p=d?n.label||("object"==typeof n.value?n.value.label:n.value+""):n+"",u=d?n.typeRepresentation:typeof n,c=d?n.tooltip:void 0,_=d&&n.hasOwnProperty("grid");let m=d?n.icons:void 0;!m&&n.icon&&(m=[n.icon]);const f=m;let g,v=!0;if(s&&(v=l.every((t,i)=>!!a[i]||(t.getLabel()!==p||t.options.value!==h&&t.options.value.value!==h||!e.equals(t.options.icons,f)||(g=t,a[i]=!0,delete g.options.customNode,!1)))),v){let e={label:p,value:h,icons:f,typeRepresentation:u,tooltip:c};_&&(e.grid=n.grid),d&&this.columnOptions&&this.columnOptions.typeRepresentation&&"object"!=typeof n.value&&(e.value=n.hasOwnProperty("value")?n.value:n),g=new r(e)}i.push(g)}s&&l.forEach((e,t)=>{!1===a[t]&&(e.options.customNode=!0)}),this._model&&this._ownModel||(this._model=this._defaultModel),this._model.empty(),this._model.addRoot(i),this._dataGridView&&(this._dataGridView.treeDocument=this._model),this._modelLoaded=!0,s&&this._model.getXSO().add(l),F.call(this)}}.call(this,t);if(t instanceof Function)return this._lastSearchedString=this._editor?this._editor.valueToCommit:"",T.call(this,t.call(this,this._lastSearchedString),!1);if(t instanceof Promise){this._pendingPromise=!0,this._dataGridView?(this._dataGridView.displayModalLoader(_.get("AutoComplete").Loading),this._dataGridView.placeholder=""):this._displayDGVLoader=!0;var o=this;t.then(function(e){T.call(o,e,!1),E.call(o,o._editor.valueToCommit)}).finally(function(e){o._pendingPromise=!1,o._dataGridView&&(o._dataGridView.removeModalLoader(_.get("AutoComplete").Loading),o._dataGridView.placeholder=o.customFilterMessage,o._editor&&A.call(o,o._editor.valueToCommit))})}}}function G(){this._editor&&void 0!==this._editor.valueToCommit&&this._editor.valueToCommit.length>=this.minLengthBeforeSearch&&(!this._modelLoaded&&!this._pendingPromise||!this.keepSearchResultsFlag&&!this._pendingPromise||this.elementsTree instanceof Function&&this.minLengthBeforeSearch>0&&this._editor.valueToCommit.toLowerCase().indexOf(this._lastSearchedString.toLowerCase())<0)&&(this._modelLoaded=!1,T.call(this,this.elementsTree,!1))}function F(){const e=this;if(0===this._modelToken.length){const t=()=>{D.call(this)},i=this._model.addModelEventListener("addChild",t);this._modelToken.push(i);const o=this._model.addModelEventListener("removeChild",t);this._modelToken.push(o);const s=this._model.onPostExpand(function(){D.call(e)});this._modelToken.push(s);const l=this._model.onPostCollapse(function(){D.call(e)});this._modelToken.push(l)}if(0===this._xsoToken.length){const t=this._model.getXSO().onPostAdd(function(t){e._valueModifiedbyAPI||L.call(e,e._valueOperation,{operationType:v.ADD,noOfItemsModified:t.length},function(){if(e.multiSearchMode){var i=[];e.selectedItems&&(i=e.selectedItems.slice(0)),t&&t.forEach(function(e){h.pushUnique(i,e)}),e.selectedItems=i,e.minLengthBeforeSearch?e._hidePopup():P.call(e)}else e._hidePopup(),e.selectedItems=t[0];I.call(e,b.SELECTION_CHANGE)})});this._xsoToken.push(t);const i=this._model.getXSO().onPostRemove(function(t){e.displayCustomNodeInDropDown&&t[0].options&&t[0].options.customNode||e._valueModifiedbyAPI||L.call(e,e._valueOperation,{operationType:v.REMOVE,noOfItemsModified:t.length},function(){if(e.multiSearchMode){var i=[];e.selectedItems&&(i=e.selectedItems.slice(0)),t.forEach(function(e){for(var t=i.length-1;t>=0;t--)if(i[t]===e){i.splice(t,1);break}}),e.selectedItems=i,I.call(e,b.SELECTION_CHANGE),e.minLengthBeforeSearch&&void 0!==e._editor.value&&e._editor.value.length<e.minLengthBeforeSearch?e._hidePopup():P.call(e)}})});this._xsoToken.push(i)}}function L(e,t,i){var o=this._valueModifiedbyAPI;!0===e.hasOwnProperty("operationType")&&!0===e.hasOwnProperty("noOfItemsModified")?(this._valueOperation.operationType=t.operationType,this._valueOperation.noOfItemsModified=t.noOfItemsModified):this._valueModifiedbyAPI=t,i.call(this),e.operationType&&e.noOfItemsModified?(this._valueOperation.operationType=void 0,this._valueOperation.noOfItemsModified=void 0):this._valueModifiedbyAPI=o}function N(t){let i;i=Array.isArray(t)?Array.from(t,e=>({value:e,found:!1})):[{value:t,found:!1}];const o=Array(i.length).fill(void 0);if(!this._model||0===i.length)return o;const s=i.length;let l=0;const a=(e,t)=>(l++,i[e].found=!0,o[e]=t,!0);return this._model.search({useTransaction:!1,match:t=>{const o=t.nodeModel,s=o.options.label,l=o.options.value,n=l instanceof Object&&l.hasOwnProperty("value")?l.value:l;for(let t=0;t<i.length;t++){const l=i[t].value,d=i[t].found,h=typeof l;if(null!=l&&!0!==d){if(o.options.hasOwnProperty("value")&&void 0!==n)if("string"===h){if("string"==typeof n&&e.equals(l.toLowerCase(),n.toLowerCase()))return a(t,o)}else if("number"===h){if("number"==typeof n&&l===n)return a(t,o)}else if("object"===h){if(l instanceof r&&e.equals(l.options.value,n)||e.equals(l,n))return a(t,o);if(l.hasOwnProperty("value")&&e.equals(l.value,n))return a(t,o);if(e.equals(l,n))return a(t,o)}if(o.options.hasOwnProperty("label")&&void 0!==s)if("string"===h){if("string"==typeof s&&e.equals(l.toLowerCase(),s.toLowerCase()))return a(t,o)}else if("number"===h){if("number"==typeof s&&l===s)return a(t,o)}else if("object"===h&&(l instanceof r&&e.equals(l.options.label,s)||e.equals(l,s)))return a(t,o)}}},shouldStop:()=>s===l}),o}function R(){var e=this,t=void 0;return this.selectedItems&&Array.isArray(this.selectedItems)&&this.selectedItems.forEach(function(i,o){e._selectionChips._items[o].isSelected&&(t=i)}),void 0===t&&(t=Array.isArray(this.selectedItems)?this.selectedItems[this.selectedItems.length-1]:this.selectedItems),t}return i.inherit({name:"autoComplete",publishedProperties:{placeholder:{defaultValue:_.get("AutoComplete").Placeholder,type:"string",category:"Appearance"},multiSearchMode:{defaultValue:!0,type:"boolean",category:"Behavior"},displayCustomNodeInDropDown:{defaultValue:!0,type:"boolean",category:"Behavior",noNeedToApplyFlag:!0},value:{defaultValue:void 0,type:"object",category:"Appearance"},elementsTree:{defaultValue:void 0,type:"object",category:"Model"},selectedItems:{defaultValue:void 0,type:"Array",category:"Appearance"},filterCB:{defaultValue:function(e){return this.filterItems(e,{filterId:"stringRegexp"}),this._getFirstMatchingCellID()},type:"function"},customFilterMessage:{defaultValue:_.get("AutoComplete").CustomFilterMessage,type:"string",category:"Appearance"},allowFreeInputFlag:{defaultValue:!0,type:"boolean",category:"Behavior",noNeedToApplyFlag:!0},allowResetToUndefinedByUIFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},minLengthBeforeSearch:{defaultValue:0,type:"integer",category:"Behavior",noNeedToApplyFlag:!0},typeDelayBeforeSearch:{defaultValue:0,type:"integer",category:"Behavior",noNeedToApplyFlag:!0},keepSearchResultsFlag:{defaultValue:!0,type:"boolean",category:"Behavior",noNeedToApplyFlag:!0},popupSizeAdjustPolicy:{defaultValue:l.SizeAdjustPolicyEnum.AdjustToVisibleContents,type:"integer",category:"Appearance"},popupConstraint:{defaultValue:"screen",type:"string",category:"Appearance"},getChipInfo:{defaultValue:function(e){return this.getDefaultChipInfo(e)},type:"function"},columnOptions:{defaultValue:void 0,type:"object",category:"Appearance"},displayLoader:{defaultValue:!1,type:"boolean",category:"Appearance"}},_privateProperties:{_maximumItemsDisplayed:{defaultValue:10,type:"integer",category:"Appearance"}},_autoCompleteState:w.CLOSED,getDefaultChipInfo:function(e){let t="object"==typeof e.options.value?e.options.value.label||e.getLabel():e.getLabel()||e.options.value+"",i=void 0,o=void 0;if(!e.options._freeInputNode){if(e.options.icons){for(var s=0;s<e.options.icons.length;s++)if("object"==typeof e.options.icons[s]?!e.options.icons[s].position||"near"===e.options.icons[s].position:e.options.icons[s]){i=e.options.icons[s];break}}else i=e.options.icon||("object"==typeof e.options.value?e.options.value.icon:void 0);const t="user"===this.getTypeRepresentation(e)||"detailedUser"===this.getTypeRepresentation(e);!i&&t&&(i={userName:"object"==typeof e.options.value?e.options.value.label||e.getLabel():e.getLabel()||e.options.value+""}),o={roundFlag:t}}return{label:t,icon:i,_iconOptions:o}},canClosePopup:function(e){if(e)return!0;var t=R.call(this);if(null!=t){if(this._dataGridView){var i;i=this._dataGridView.layout.getCellIDFromCoordinates({rowID:t._rowID,columnID:0}),O.call(this,i)}return!1}return!0},getTypeRepresentation:function(e){return(e?e.options.typeRepresentation:void 0)||this.columnOptions&&void 0!==this.columnOptions.getTypeRepresentation&&this.columnOptions.getTypeRepresentation({nodeModel:e})||this.columnOptions&&this.columnOptions.typeRepresentation||"string"},keymaps:{tab:"manageTab","shift+tab":"manageTab",esc:"manageEscape",up:"upMove",down:"downMove",pageup:"pageupMove",pagedown:"pagedownMove",home:"homeMove",end:"endMove"},commands:{manageTab:function(e){return this._hidePopup(),I.call(this,b.SELECTION_CHANGE),M.call(this,this._editor.valueToCommit),{stopPropagation:!1}},manageEscape:function(e){return I.call(this,b.ESCAPE),this.elements.popup&&this.elements.popup.visibleFlag&&(!this.multiSearchMode&&this._editor&&this._editor._myInput&&this.selectedItems&&(this._editor.valueToCommit=this.selectedItems.getLabel(),this._editor.value=this.selectedItems.getLabel()),this.callMethodFromUIInteraction("_hidePopup")),{stopPropagation:!1}},upMove:function(){return this._manageNavigationKey("up")},downMove:function(){return this._manageNavigationKey("down")},pageupMove:function(){return this._manageNavigationKey("pageup")},pagedownMove:function(){return this._manageNavigationKey("pagedown")},homeMove:function(){return this._manageNavigationKey("home",!0)},endMove:function(){return this._manageNavigationKey("end",!0)}},buildView:function(){this.elements.container.addClassName("wux-controls-autoComplete"),this._modelLoaded=!1,this._defaultModel=new d,this._ownModel=!1,this._model=null,this._lastSearchedString="",this._valueOperation={operationType:void 0,noOfItemsModified:void 0},this._xsoToken=[],this._modelToken=[],this._nbItemsToDisplay=-1,this._valueModifiedbyAPI=!1,this._selectionChipsHeight=0,this._DGVContainerFitWidth=0,this._DGVContainerMinWidth=0,this._DGVContainerWidth=0},_postBuildView:function(){if(void 0===this._editor){this._editor=new s({placeholder:this.placeholder,displayStyle:"text",fireOnlyFromUIInteractionFlag:!0,selectAllOnFocus:!0,disabled:this.disabled}),this._editor.getContent().addClassName("wux-controls-autoComplete-editor"),this._updateEditorMinWidth();var e=this;this._editor.tooltipInfos=new a({getAllInformationCB:function(){return e._buildLineEditorTooltip()}})}this._editor.touchMode=this.touchMode,this._applyMultiSearchMode(),this.multiSearchMode||this.selectedItems&&(this._editor.value=Array.isArray(this.selectedItems)?this.selectedItems[0].options.label:this.selectedItems.options.label),this._delayPopupCreation()},_buildLineEditorTooltip:function(){let e,i,o;return this.touchMode||c.getTouchMode()?(e=14,i=22,o=2):(e=12,i=12,o=2),e=this.touchMode||c.getTouchMode()?14:12,{model:{updateModel:!0,shortHelp:t.computeStringWidth(this.placeholder,e,"Arial")+i+o>this._editor.getContent().offsetWidth&&this.placeholder||""}}},handleEvents:function(){var e=this,i=function(){var t=!1;!e._valueModifiedbyAPI&&e._dataGridView&&(e._dataGridView.setScrollerPosition({x:0,y:0,animate:!1}),e._dataGridView.setActiveCell(-1,!0,!0),e._dataGridView.setPreselectedCell(-1)),e._valueModifiedbyAPI||(!(e._editor&&""!==e._editor.valueToCommit&&e._editor.valueToCommit.length>=e.minLengthBeforeSearch)||e.elements.popup&&e.elements.popup.visibleFlag?e.elements.popup&&e.elements.popup.visibleFlag&&e._editor&&void 0!==e._editor.valueToCommit&&e._editor.valueToCommit.length<e.minLengthBeforeSearch&&e._hidePopup():(e._showPopup(),t=!0)),!t&&e.elements.popup&&e.elements.popup.visibleFlag&&G.call(e),e.displayCustomNodeInDropDown&&E.call(e,e._editor.valueToCommit),A.call(e,e._editor.valueToCommit),e.elements.popup&&e.elements.popup.visibleFlag&&e._dataGridView&&(e._dataGridView.setFindStr(e._editor.valueToCommit,!1,void 0,!0,e._hasARegExpFilter),V.call(e))};t.addEventOnElement(this,this._editor,"uncommittedChange",function(t){if(t.stopPropagation(),e._selectionAllowed=!1,!e._valueModifiedbyAPI){if(m.hide(),e.elements.popup&&e.elements.popup.visibleFlag&&e._editor&&void 0!==e._editor.valueToCommit&&e._editor.valueToCommit.length<e.minLengthBeforeSearch)return void e._hidePopup();O.call(e,-1)}I.call(e,b.INPUT_CHANGE),!e._valueModifiedbyAPI&&e.typeDelayBeforeSearch>0?(this._debouncedlaunchSearch||(this._debouncedlaunchSearch=u.debounce(i,e.typeDelayBeforeSearch)),this._debouncedlaunchSearch()):i(),e.fire("uncommittedChange",t.options)}),t.addEventOnElement(this,this._editor,"change",function(t){t.stopPropagation(),e._valueModifiedbyAPI||(M.call(e,e._editor.value),e._hidePopup())}),t.addEventOnElement(this,this,"keydown",function(t){t.keyCode==p.SPACE&&e._selectionAllowed&&!t.actionPerformed?e._manageSpace(t):t.keyCode===p.HOME?e._manageNavigationKey("home",!0):t.keyCode===p.END?e._manageNavigationKey("end",!0):t.keyCode!=p.ENTER||t.actionPerformed||e._manageReturn(t)},!0)},_manageSpace:function(e){if(this.multiSearchMode&&this.elements.popup&&this.elements.popup.visibleFlag&&this._dataGridView){var t=this._dataGridView.getActiveCellID();if(t>=0){var i=this._dataGridView.getNodeModelAt(t);i&&(i.isSelected()?i.unselect():i.select(),e&&(e.stopPropagation(),e.preventDefault()),this._editor&&this._editor.focus({preventScroll:!0}))}}},_manageReturn:function(e){var t,i=!1;if(this.elements.popup&&this.elements.popup.visibleFlag){if(this._dataGridView){var o=this._dataGridView.getActiveCellID();o>=0&&(t=this._dataGridView.getNodeModelAt(o))}this._hidePopup()}return t&&(this.allowFreeInputFlag||void 0===t.options.customNode)?(t.select(),i=!0):this._editor.value&&(M.call(this,this._editor.value),i=!0),{stopPropagation:!1,infos:{actionPerformed:i}}},_manageNavigationKey:function(e,t){if(m.hide(),I.call(this,b.SHOW_POPUP),this.elements.popup&&this.elements.popup.visibleFlag){if(this._dataGridView){var i=-1,o=this._dataGridView.getActiveCellID();this._selectionAllowed=!0,i=void 0===o||o<0?this._dataGridView.layout.getCellIDFromCoordinates({rowID:"end"===e?this._dataGridView.model.length-1:0,columnID:0}):this._dataGridView.computeCellIDFromActiveCell(e,t),O.call(this,i)}}else this._showPopup();return{preventDefault:!0}},_getDefaultCellHeight:function(){if(this.columnOptions&&this.columnOptions.autoRowHeightFlag||!this._dataGridView.layout||this._dataGridView.layout.getRowHeightFunction)return this.touchMode?40:27;this._dataGridView.layout.getRowHeightFunction=function(){return this._dataGridView.layout.getDefaultCellHeight()}.bind(this)},_delayPopupCreation:function(){if(!this._delayPopupCreationInfos){var i=this,o={target:this,position:"bottom",offset:{x:0,y:4},trigger:"click escape",toggleFlag:!0,forceKeepOrientation:!0,constraint:this.popupConstraint,className:"wux-controls-autoComplete-popup wux-controls-popup",alignment:"near",overlap:!1,shouldDisplayCallback:function(){return G.call(i),!(i._editor&&(!(""!==i._editor.valueToCommit||i._model&&0!==i._model.getRoots().length||i._pendingPromise)||void 0!==i._editor.valueToCommit&&i._editor.valueToCommit.length<i.minLengthBeforeSearch))},getBody:function(){i._dataGridViewContainer=new e.Element("div"),i._dataGridViewContainer.addClassName("wux-controls-autoComplete-dataGridViewContainer");let o=i.columnOptions&&i.columnOptions.style&&y[i.columnOptions.style]?i.columnOptions.style:"classic";var s={treeDocument:i._model,cellSelection:"none",selectionBehavior:{toggle:!0,selectOnPointerUp:!0},showAlternateBackgroundFlag:!1,showRowBorderFlag:!0,selectionStyle:"lightSelectionEdging",rowSelection:i.multiSearchMode?"multiple":"single",selectNextCellOnEnterFlag:!1,layoutOptions:{columnsHeader:!1,rowsHeader:!1},treeNodeCellOptions:y[o],touchMode:i.touchMode};let a={autoRowHeightFlag:!1,typeRepresentation:i.typeRepresentation,getCellTypeRepresentation:i.typeRepresentation?void 0:function(e){return i.getTypeRepresentation(e.nodeModel)},getCellValue:function(e){return e.nodeModel?"string"===i.getTypeRepresentation(e.nodeModel)&&"string"==typeof e.nodeModel.options.label&&""!==e.nodeModel.options.label?e.nodeModel.options.label:e.nodeModel.options.value:""},getCellIcons:function(e){let t=e.nodeModel&&e.nodeModel.getIcons?e.nodeModel.getIcons():[];return!t&&e.nodeModel&&e.nodeModel.options.icon&&(t=[e.nodeModel.options.icon]),t},getCellTooltip:function(e){return e.nodeModel&&e.nodeModel.options.tooltip?e.nodeModel.options.tooltip:i._dataGridView?i._dataGridView.getCellDefaultTooltip(e):void 0}},d=Object.assign(a,i.columnOptions),r={dataIndex:"tree",text:"",showTextFlag:!1,icon:void 0,minWidth:40,width:"auto",visibleFlag:!0,editableFlag:!1,editionPolicy:"EditionOnDoubleClick",resizableFlag:!1,selectableFlag:!1,sortableFlag:!1,groupableFlag:!1,printableFlag:!1,massUpdateAllowedFlag:!1,splittableFlag:!1,compareFunctionCB:void 0,autoSizePadding:0,pinned:"unpinned",onCellRequest:void 0,hasCellValue:void 0,setCellValue:void 0,getCellValueForCopy:void 0,getCellValueForSort:void 0,processCellValueFromPaste:void 0,getCellValueForExport:void 0,getCellValueForSort:void 0,getCellKPIColor:void 0,getCellGroupingKey:void 0,getGroupingNodeOptions:void 0};return d=Object.assign(d,r),s.columns=[d],i._dataGridView=new n(s),i._dataGridView._setScrollbarsHidden({horizontal:!0}),i.customFilterMessage&&(i._dataGridView.placeholder=i.customFilterMessage),i._displayDGVLoader&&(i._dataGridView.placeholder="",i._dataGridView.displayModalLoader(_.get("AutoComplete").Loading),i._displayDGVLoader=void 0),i._dataGridView.getContent().addClassName("wux-controls-autoComplete-dataGridView"),i._dataGridView.inject(i._dataGridViewContainer),t.addEventOnElement(i,i._dataGridView,"focus",function(e){i._editor&&i._editor._onFocusReceived(!1)}),t.addEventOnElement(i,i._dataGridView,"click",function(e){if(this._preselectedCellStableID&&this._preselectedCellStableID.nodeModel){let e=this._preselectedCellStableID.nodeModel._options.label;if(i._properties.selectedItems.value&&i._properties.selectedItems.value._options){e===i._properties.selectedItems.value._options.label&&(i._editor.valueToCommit=e)}}}),t.addEventOnElement(i,i._dataGridView,"preselectedCellChange",function(e){if(!i._selectionChips||!i._selectionChips._items||0===i._selectionChips._items.length)return;let t=!1;e.dsModel._preselectedCellStableID&&i._selectionChips._items.forEach(function(o){e.dsModel._preselectedCellStableID.nodeModel===o.chipOptions.value&&(i._selectionChips.selectChip(o),t=!0)}),void 0!==e.dsModel._preselectedCellStableID&&t||i._selectionChips._items.forEach(function(e){i._selectionChips.unselectChip(e)}),e.stopPropagation()}),i._dataGridView._getScroller().onScrollEnd(function(){(i.popupSizeAdjustPolicy===l.SizeAdjustPolicyEnum.AdjustToVisibleContents||i._lockPopupVisibilityChange)&&(i._lockPopupVisibilityChange=!1,V.call(i))}),i._dataGridViewContainer},overlapCallback:function(e){let t=e.availableSpaces;this._lockPopupVisibilityChange=!0,D.call(this,t),this._lockPopupVisibilityChange=!1}.bind(this),beforeDisplayCallback:function(){i._lockPopupVisibilityChange=!0,i.elements.popup.getContent().setStyle("visibility","hidden"),i._popupVisibility=!1;let e=0,t=0;if(!i.multiSearchMode&&i._editor&&i._editor._myInput){const o=window.getComputedStyle(i._editor._myInput);0===parseInt(o.borderLeft.slice(0,-2))&&(e=-1,t=2),i.elements.popup.offset={x:e,y:4}}{let e="";i._autoCompleteState!==w.DISPLAY_SEARCH&&(i.displayCustomNodeInDropDown&&E.call(i,i._editor.valueToCommit),A.call(i,""),i._dataGridView&&i._dataGridView.setFindStr(e,!1,void 0,!0))}i._DGVContainerFitWidth=i.elements.container.getBoundingClientRect().width+t,i._DGVContainerMinWidth=i._DGVContainerFitWidth,i._DGVContainerWidth=i._DGVContainerFitWidth,i._dataGridViewContainer.style.width=i._DGVContainerWidth+"px",i._lockPopupVisibilityChange=!1}};this._delayPopupCreationInfos=l.delayPopupCreation(o,function(e){i.elements.popup=e,i._editor.preventBlurForTargetedElements([i.elements.popup]),t.addEventOnElement(i,e,"show",async function(e){e.stopPropagation(),I.call(i,b.SHOW_POPUP),i._dataGridView.subscribeOnceToAllCellsRendered(function(){i._dataGridView.layout.prepareLayout(),S.call(i,i._availableSpaceObject),function(){if(this._dataGridView){var e=-1;if(this._autoCompleteState===w.DISPLAY_COMPLETE_MODEL){var t=R.call(this);if(t){if(t.options.customNode||this._model!==t.getTreeDocument())return!1;e=this._dataGridView.layout.getCellIDFromCoordinates({rowID:t._getRowID(),columnID:0})}O.call(this,e)}else t=(e=this._dataGridView.getPreselectedCellID())&&e>=0?this._dataGridView.getNodeModelAt(e):void 0;return this._dataGridView.ensureNodeModelVisible(t,!1,!0,0)}}.call(i)?i._lockPopupVisibilityChange=!0:V.call(i,i._availableSpaceObject),i.fire("show")})}),t.addEventOnElement(i,e,"hide",function(e){e.stopPropagation(),i.fire("hide")})})}},_applyProperties:function(e){if(this._parent(e),this.isDirty("placeholder")&&this._applyPlaceholder(e.placeholder),this.isDirty("multiSearchMode")&&this._applyMultiSearchMode(e.multiSearchMode),this.isDirty("elementsTree")&&this._applyElementsTree(e.elementsTree),this.isDirty("value")&&e&&e.hasOwnProperty("value"))this._applyValue(e.value);else if(this.isDirty("selectedItems")&&e&&e.hasOwnProperty("selectedItems"))this._applySelectedItems(e.selectedItems);else if(this.isDirty("elementsTree")&&this.elementsTree&&this.elementsTree instanceof d){var t=this.elementsTree.getXSO().get();t.length>0&&L.call(this,this._valueOperation,{operationType:v.ADD,noOfItemsModified:t.length},function(){this.selectedItems=t})}this.isDirty("customFilterMessage")&&this._applyCustomFilterMessage(e.customFilterMessage),this.isDirty("allowResetToUndefinedByUIFlag")&&this._applyAllowResetToUndefinedByUIFlag(e.allowResetToUndefinedByUIFlag),this.isDirty("displayLoader")&&this._applyDisplayLoader()},_applyDisabled:function(){this._parent(),this._editor&&(this._editor.disabled=this.disabled),this._selectionChips&&(this._selectionChips.disabled=this.disabled)},_applyPlaceholder:function(){this._editor&&(this._editor.placeholder=this.placeholder,this._updateEditorMinWidth())},_updateEditorMinWidth:function(){if(this._editor){let e=40;if(this.placeholder){let i,o,s,l,a;this.touchMode||c.getTouchMode()?(i=14,o=22,s=2,l=40,a=93):(i=12,o=12,s=2,l=40,a=80);let n=t.computeStringWidth(this.placeholder,i,"Arial",!1,!1);e=Math.max(Math.min(n+o+s,a),l)}this._editor.getContent().setStyle("min-width",e+"px"),this._editorMinWidth=e}},_applyMultiSearchMode:function(e){this.multiSearchMode?(this._editor&&!0===this.elements.container.hasChildNodes()&&this._editor.remove(),void 0!==this.elements.popup&&L.call(this,this._valueModifiedbyAPI,!0,function(){this._dataGridView.rowSelection="multiple"}),this._selectionChips||function(){this._selectionChips=new o({fireOnlyFromUIInteractionFlag:!0,disabled:this.disabled}),this._selectionChips.getContent().addClassName("wux-controls-autoComplete-selectionChips"),this._selectionChips.touchMode=this.touchMode,this._selectionChips.selection.mode=o.SELECTION_MODE.SINGLE;var e=this;t.addEventOnElement(this,this._selectionChips,"onPostRemove",function(t){e._valueModifiedbyAPI||L.call(e,e._valueOperation,{operationType:v.REMOVE,noOfItemsModified:t.options.chips.length},function(){if(e.multiSearchMode&&t.options.chips){if(t.options.allChipsRemoved)return void(e.selectedItems=[]);for(var i=0;i<t.options.chips.length;i++){const s=t.options.chips[i].chipOptions;if(s.value&&s.value.options.customNode){const t=C.call(e,e.selectedItems).findIndex(e=>e===s.value);if(-1!==t){const i=e.selectedItems.slice(0);i.splice(t,1),e.selectedItems=i}}else if(s.value){var o=N.call(e,s.value);o&&o[0]&&s.value.unselect()}}}})}),t.addEventOnElement(this,this._selectionChips,"change",function(e){e.stopPropagation()})}.call(this),this._editor&&this._editor._myInput&&this._selectionChips&&!1===this.elements.container.hasChildNodes()&&(this._editor.displayStyle="lite",this._selectionChips.addLastWidget(this._editor),this._selectionChips.inject(this.elements.container))):(this._selectionChips&&!0===this.elements.container.hasChildNodes()&&this._selectionChips.remove(),this.elements.popup&&L.call(this,this._valueModifiedbyAPI,!0,function(){this._dataGridView.rowSelection="single"}),this._editor&&this._editor._myInput&&!1===this.elements.container.hasChildNodes()&&(this._editor.displayStyle="text",this._editor.inject(this.elements.container))),this._applyAllowResetToUndefinedByUIFlag(),void 0!==e&&this.multiSearchMode!==e&&(this.isDirty("value")||this.isDirty("selectedItems")||(L.call(this,this._valueModifiedbyAPI,!0,function(){this._model&&(this._model.getXSO().isEmpty()||this._model.getXSO().empty())}),this._properties.value.value=void 0,this._properties.selectedItems.value=void 0,this._selectionChips&&this._selectionChips.removeAllChips(),this._editor&&(this._editor.value="")))},_applyValue:function(e,t){if(void 0===this.value)return this.selectedItems=[],I.call(this,b.SELECTION_CHANGE),void(this._modelLoaded||this.fire("change"));var i=C.call(this,this.value);this.multiSearchMode?Array.isArray(this.value)||(this._properties.value.value=i):Array.isArray(this.value)&&(this._properties.value.value=i[0]),L.call(this,this._valueModifiedbyAPI,!0,function(){var o=[];const s=N.call(this,i);for(var l=0;i.length>l;l++){var a=s[l];if(!a&&i[l]&&""!==i[l])if(this.allowFreeInputFlag||this.elementsTree instanceof Function){let e=i[l],t=i[l],o=void 0,s=void 0;i[l]instanceof r?(t=i[l].options.value,e=i[l].options.label,o=i[l].options.icon,s=i[l].options.icons,e=e||t):"object"==typeof i[l]&&this.columnOptions&&this.columnOptions.typeRepresentation&&"object"!=typeof i[l].value?(e=i[l].label,t=i[l]):"object"==typeof i[l]&&i[l].value&&(e=i[l].label?i[l].label:i[l].value,t=i[l].value,o=i[l].icon,s=i[l].icons),s&&o?s.push(o):o&&(s=[o]),a=new r({label:e,value:t,icon:o,icons:s,customNode:!0})}else if(!this.multiSearchMode){if(this._modelLoaded)return this.value=e,void(this._editor.value=e);this._editor.value=t}a&&h.pushUnique(o,a)}this.selectedItems=this.multiSearchMode?o:o[0],I.call(this,b.SELECTION_CHANGE)}),P.call(this)},_applyElementsTree:function(e){this._modelLoaded=!1,(this.elements.popup&&this.elements.popup.visibleFlag||!this.elementsTree||this.elementsTree instanceof d||Array.isArray(this.elementsTree))&&T.call(this,this.elementsTree,!this.isDirty("value")&&!this.isDirty("selectedItems"))},filterItems:function(e,t){if(this._model){var i=t&&t.property||"label",o=t&&t.type||"contains",s=t&&t.filterId||"stringRegexp",l=t?t.filterOptions:void 0;"stringRegExp"===s&&(this._hasARegExpFilter="stringRegexp"===s),this._model.getFilterManager().setPropertyFilterModel(i,{filterId:s,filterModel:{condition1:{type:o,filter:e}},filterOptions:l})}},_getFirstMatchingCellID:function(){let e=-1;if(!this._dataGridView||!this._model)return e;let t=this._model.getFilterManager();return this._model.processDescendants({processNode:i=>{if(i.nodeModel.canBeFiltered(t.propertyId)&&!t.isDataFiltered(i.nodeModel))return e=this._dataGridView.layout.getCellIDFromCoordinates({rowID:i.nodeModel._getRowID(),columnID:0}),{stopProcessing:!0}},onlyVisibleNodes:!0}),e},_applySelectedItems:function(){O.call(this,-1);var e=this,t=C.call(this,this.selectedItems);this.multiSearchMode?Array.isArray(this.selectedItems)||(this._properties.selectedItems.value=t):Array.isArray(this.selectedItems)&&(this._properties.selectedItems.value=t[0]),I.call(this,b.SELECTION_CHANGE);for(var i=[],o=0;o<t.length;o++)h.pushUnique(i,t[o]);t.length!==i.length&&(t=i,this.multiSearchMode?this._properties.selectedItems.value=t:this._properties.selectedItems.value=t[0]);const s=N.call(this,t);for(let e=0;e<s.length;e++)s[e]||(t[e].options.customNode=!0);if(this.multiSearchMode){let i=[];L.call(this,this._valueModifiedbyAPI,!0,function(){this._model&&!this._model.getXSO().isEmpty()&&this._model.getXSO().empty();for(var i=0;t.length>i;i++)t[i].select();if(this._selectionChips){var o=[];let i;t.forEach(function(t){i=e.getChipInfo(t),h.pushUnique(o,{label:i.label,value:t,icon:i.icon,tooltip:i.tooltip||t.options.tooltip,_iconOptions:i._iconOptions})}),this._selectionChips.removeAllChips(),this._selectionChips.addChips(o)}A.call(this,""),this._editor&&(this._editor.valueToCommit="",this._editor.value="")});e=this;t.forEach(function(e){e.options.hasOwnProperty("value")&&void 0!==e.options.value?i.push(e.options.value):i.push(e.options.label)}),(this._properties.value.value||i&&i.length>0)&&(this._properties.value.value=i)}else L.call(this,this._valueModifiedbyAPI,!0,function(){this._valueOperation.operationType!==v.REMOVE&&(this._model&&!this._model.getXSO().isEmpty()&&this._model.getXSO().empty(),t.length>0&&t[0]&&t[0].select());var e="";this._editor&&(t[0]&&("string"==typeof t[0]||"number"==typeof t[0]?e=t[0]+"":"object"==typeof t[0].options&&(t[0].options.label?e=t[0].options.label:t[0].options.value&&("string"==typeof t[0].options.value||"number"==typeof t[0].options.value?e=t[0].options.value+"":"object"==typeof t[0].options.value&&(e=t[0].options.value.label?t[0].options.value.label:"")))),this._editor.value=e);var i=void 0;if(t[0])if(t[0].options.hasOwnProperty("value")&&void 0!==t[0].options.value){let e=t[0].options.value;i=e instanceof Object&&e.hasOwnProperty("value")?e.value:e}else i=t[0].options.label;this._properties.value.value=i});E.call(this,""),this.fire("change")},hide:function(){m.hide(),this._hidePopup(),this._parent()},_showPopup:function(){if(this.elements.popup){if(this.elements.popup.visibleFlag)return;this.elements.popup.visibleFlag=!0}else this._delayPopupCreationInfos&&"function"==typeof this._delayPopupCreationInfos.createVisiblePopup&&this._delayPopupCreationInfos.createVisiblePopup()},_hidePopup:function(){if(this.elements.popup&&this.elements.popup.visibleFlag&&(this.elements.popup.visibleFlag=!1,I.call(this,b.HIDE_POPUP),this._editor)){var e=this;setTimeout(function(){e._editor&&!e._editor._isFocused()&&e._editor._onFocusReceived(!1)},1)}},_onFocusReceived:function(){this._parent(),this._editor&&this._editor._onFocusReceived()},_giveFocus:function(){this._parent(),this._editor&&this._editor._giveFocus()},_applyCustomFilterMessage:function(){this._dataGridView&&(this._dataGridView.placeholder=this.customFilterMessage),this._customFilterMessageWidth=void 0},_applyAllowResetToUndefinedByUIFlag:function(){this._editor&&(this._editor.displayClearFieldButtonFlag=this.allowResetToUndefinedByUIFlag&&!this.multiSearchMode)},_applyTouchMode:function(){this._parent(),this._getCurrentTouchMode()?this.elements.container.setAttributeNode(document.createAttribute("touch-mode")):this.elements.container.removeAttribute("touch-mode"),this._editor&&(this._editor.touchMode=this.touchMode),this._selectionChips&&(this._selectionChips.touchMode=this.touchMode),this._dataGridView&&(this._dataGridView.touchMode=this.touchMode),this._customFilterMessageWidth=void 0},_applyDisplayLoader:function(){let t=!("boolean"==typeof this.displayLoader&&!this.displayLoader);if(t&&this._loaderStarted)return void this._updateLoaderValue();if(!t){this._loaderStarted=!1;let e=function(){if(this._loadingContainer&&!this._loaderStarted){this._loadingContainer.remove();let e=this._dataGridView.getContent();e&&e.removeClassName("wux-controls-autoComplete-dataGridView-loading"),this._dataGridViewContainer.removeClassName("wux-controls-autoComplete-dataGridViewContainer-withLoader")}}.bind(this);return void(this._loader&&(this.__ODT_TEST_NO_ANIMATION?(this._loader.off(),e()):(this._loader._modelEvents.subscribeOnce({event:"END"},e),this._loader.off())))}this._loaderStarted=!0;let i=function(){if(!this._loaderStarted)return;this._loadingContainer||(this._loadingContainer=new e.Element("div"),this._loadingContainer.addClassName("wux-controls-autoComplete-loader-container"),this._loader=new f({text:_.get("AutoComplete").Loading_Alt}),this._loader.getContent().addClassName("wux-controls-autoComplete-loader"),this._loader.__underDefaultHeightUseAltValueDisplay=!0,this._loader.inject(this._loadingContainer)),this._loader.touchMode=this.touchMode,this._loader.elements.progressBar.touchMode=this.touchMode;let t=this._dataGridView.layout.getDefaultCellHeight();t+=1,this._loader.height=this.touchMode?22:16,this._updateLoaderValue(),this._loader.on(),this._loadingContainer.style.setProperty("--autocomplete-loader-container-height",t+"");let i=this._dataGridView.getContent();i&&(i.addClassName("wux-controls-autoComplete-dataGridView-loading"),i.style.setProperty("--autocomplete-loader-container-height",t+"")),this._dataGridViewContainer.appendChild(this._loadingContainer),this._dataGridViewContainer.addClassName("wux-controls-autoComplete-dataGridViewContainer-withLoader"),this._dataGridViewContainer.style.setProperty("--autocomplete-loader-container-height",t+"")}.bind(this);this.elements.popup&&this.elements.popup.visibleFlag?i():this.addEventListener("show",i,{once:!0})},_updateLoaderValue:function(){this._loader&&("number"==typeof this.displayLoader?this._loader.update(this.displayLoader+"%"):this._loader.update(""))},_getElementToFocus:function(){return this._editor._getElementToFocus()},getValueToCommit:function(){return this._editor?this._editor.valueToCommit:""},destroy:function(){this._dataGridView&&(this._dataGridView.destroy(),delete this._dataGridView),this._editor&&(this._editor.destroy(),delete this._editor),this._selectionChips&&(this._selectionChips.destroy(),delete this._selectionChips),this.elements.popup&&this.elements.popup.visibleFlag&&(this.elements.popup.visibleFlag=!1),this._parent()}})});