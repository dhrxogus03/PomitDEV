define("DS/DMUControls/DMUCurrentPageWidget",["UWA/Core","UWA/Class","DS/VisuEvents/EventsManager","css!DS/DMUControls/DMUControls.css"],function(e,t,n){"use strict";return t.extend({init:function(t){var i=t||{};if(i.frameWindow){this._parent(i);var o,l,a,s=this,r=0;this.setOffset=function(e){o&&r!==e&&(r=e,o.setStyle("left",e+20+"px"))},this.updateCurrentPage=function(e){l&&l.value!==e.toString()&&(l.value=e,a=e.toString())},this.enableCurrentPageEdition=function(){l&&o&&(l.focus(),l.select(),o.addClassName("focused"))},this.setVisibility=function(e){o&&o.setStyle("visibility",e?"visible":"hidden")},this.clean=function(){l&&l.removeEvents(),o&&i.frameWindow.getUIFrame().removeChild(o),n.removeEvent(o,"onPrimaryPointerClick",s.enableCurrentPageEdition),o=l=null},o=e.createElement("div",{id:"DMUCurrentPageWidget",class:"DMUCurrentPageMainDiv"}).inject(i.frameWindow.getUIFrame()),n.addEvent(o,"onPrimaryPointerClick",s.enableCurrentPageEdition);var d=e.createElement("div",{class:"DMUCurrentPageDiv"}).inject(o),c=i.maxValue.toString().length;(l=e.createElement("input",{id:"DMUCurrentPageWidgetInput",class:"DMUCurrentPageInput",maxlength:c,value:1,autocomplete:"off",styles:{width:c+window.devicePixelRatio+"ch"}}).inject(d)).onchange=function(){h(parseInt(l.value)),o.removeClassName("focused")},l.onkeyup=function(e){"Enter"===e.key&&(h(parseInt(l.value)),this.blur())},l.onblur=function(){o.removeClassName("focused")},l.onclick=function(){l.select(),o.addClassName("focused")},e.createElement("span",{text:"/",styles:{margin:"0px 5px"}}).inject(d),e.createElement("span",{text:i.maxValue}).inject(d)}function h(e){isNaN(e)||e<=0||e>i.maxValue?l.value=a:(a=e,i.onValueChanged&&i.onValueChanged(e))}}})}),define("DS/DMUControls/DMUHTMLBox",["UWA/Core","UWA/Controls/Abstract","DS/DMUBaseExperience/EXPUtils","DS/DMUBaseExperience/EXPToolsVisualization","DS/SceneGraphNodes/CSS2DNode","DS/Visualization/ThreeJS_DS","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,l){"use strict";return t.extend({init:function(t){let a;this._parent(t);let s=new e.Element("div",{class:"DMUHTMLBoxWidget",style:{whiteSpace:"pre-line"}}),r=new e.Element("div",{class:"DMUHTMLMainDiv"}).inject(s),d=e.createElement("p",{contenteditable:!1,class:"DMUHTMLBoxParagraph"}).inject(r);function c(e){e.stopPropagation()}d.addEventListener("contextmenu",c),t.onTextModifiedCB&&t.onTextModificationEndCB&&(s.addEventListener("input",t.onTextModifiedCB),s.addEventListener("paste",e=>{if(!e)return;e.preventDefault();let t=e.clipboardData.getData("text/plain");document.execCommand("insertText",!1,t)}),s.addEventListener("keydown",e=>{e&&("Escape"!==e.key&&27!==e.keyCode&&("Enter"!==e.key&&13!==e.keyCode||e.shiftKey)||(e.preventDefault(),t.onTextModificationEndCB()))}));let h=new o({html:s,position:t.positionBreakPoint3D,name:t.title});function u(e,n){a=e.clone();let o=i.getWindowPositionFromPoint(t.viewer,a,t.window);if(h&&h.getElement()&&(h.setMatrix((new l.Matrix4).setPosition(a)),h.updatePosition(),"center"===n)){let e=function(e){let t,n;if(h&&h.getElement()){let e=h.getElement();t=e.offsetHeight||e.style.pixelHeight,n=e.offsetWidth||e.style.pixelWidth}return t&&n?{left:e.left+n/2,top:e.top+t/2}:void 0}(o);e&&e.left&&e.top&&h.setOffset(new l.Vector2((o.left-e.left)*window.devicePixelRatio,(o.top-e.top)*window.devicePixelRatio))}}s.parentNode&&s.parentNode.style&&(s.parentNode.style.border="solid 0px transparent"),h._getExcludeFromCSO=function(){return!0},h.css2DNode.primitive=!0,t.parentNode.addChild(h),this.remove=function(){d&&d.removeEventListener("contextmenu",c),s&&s.destroy(),t&&t.parentNode&&t.parentNode.removeChild(h),h=s=null},this.focusAndSelectText=function(){window.getSelection().removeAllRanges();let e=document.createRange();e.selectNodeContents(d),window.getSelection().addRange(e),d.focus()},this.getText=function(){let e=[],t=(d.innerText||"").split("\n");for(let n=0;n<t.length;n++)(t[n]||n!==t.length-1)&&(t[n]=t[n].replace("\r",""),e.push(t[n]));return e},this.update=function(t){if(t.lOwnerData){let n=new e.Element("div",{class:"DMUHTMLBox"});r.insertBefore(n,d),t.lOwnerData.leftBorder&&r.setStyle("border-left",t.lOwnerData.leftBorder);let i=e.createElement("img",{class:"DMUHTMLBoxImage"}).inject(n);t.lOwnerData.imgURL&&(i.src=t.lOwnerData.imgURL);let o=new e.Element("div",{class:"DMUHTMLImageBox"}).inject(n),l=e.createElement("div",{class:"DMUHTMLOwnerBox"}).inject(o);e.createElement("p",{class:"DMUHTMLBoxOwner",text:t.lOwnerData.owner[0]}).inject(l).setStyles({color:t.lOwnerData.ownerColor}),e.createElement("p",{class:"DMUHTMLBoxDate",text:t.lOwnerData.owner[1]}).inject(l).setStyles({color:t.lOwnerData.dateColor,fontSize:t.lOwnerData.dateFontSize}),e.createElement("p",{class:"DMUHTMLBoxStampParagraph",text:t.lOwnerData.content}).inject(o).setStyles({color:t.lOwnerData.stampColor,fontWeight:t.lOwnerData.stampFontStyle}),d.setStyle("margin-left","30px")}let i;if(t.textAlign&&(r.style.textAlign=t.textAlign),t.padding&&(r.style.padding=t.padding),t.sFontName&&(r.style.fontFamily=t.sFontName),t.iFontSize&&(r.style.fontSize=t.iFontSize),t.sFontStyle&&("bold"===t.sFontStyle?r.style.fontWeight=t.sFontStyle:r.style.fontStyle=t.sFontStyle),t.cFontColor&&(r.style.color=n.colorToHex(t.cFontColor)),void 0!==t.bIsFilled&&(t.bIsFilled?t.cFillStyleColor&&(r.style.background=n.hexToRgb(n.colorToHex(t.cFillStyleColor),t.fOpacity?t.fOpacity:1)):r.style.background="none"),void 0!==t.bHasBorder&&(t.bHasBorder?(s.style.borderStyle="solid",t.cLineStyleColor&&(s.style.borderColor=n.colorToHex(t.cLineStyleColor)),t.fLineStyleThickness&&(s.style.borderWidth=t.fLineStyleThickness)):s.style.border="none"),t.borderRadius&&(s.style.borderRadius=t.borderRadius,s.parentElement.style.borderRadius=t.borderRadius,r.style.borderRadius=t.borderRadius,r.parentElement.style.borderRadius=t.borderRadius),t.lineHeight&&(s.style.lineHeight=t.lineHeight,d.style.lineHeight=t.lineHeight),t.sTextContents)for(d.innerHTML="",i=0;i<t.sTextContents.length;i++)d.innerHTML+=t.sTextContents[i],i!==t.sTextContents.length-1&&(d.innerHTML+="<br>");void 0!==t.bEditable&&d.contenteditable!==t.bEditable&&d.setAttributes({contenteditable:t.bEditable}),void 0!==t.rotationAngle&&(s.parentElement.style.transform="rotate("+-t.rotationAngle+"rad)"),t.position&&u(t.position,t.anchorMode)}}})}),define("DS/DMUControls/EXPNotify",["UWA/Class","DS/CATWebUXComponents/CATWebUXNotification"],function(e,t){"use strict";return e.extend({init:function(e){var n=new t;void 0===e.autoHide&&(e.autoHide=!0),n.build(e),this.destroy=function(){n&&n.destroy(),n=null}}})}),define("DS/DMUControls/EXPNavBar",["UWA/Core","UWA/Class","DS/Controls/TabBar","css!DS/DMUControls/DMUControls.css"],function(e,t,n){"use strict";return t.extend({init:function(t){var i=t||{};if(i.frameWindow){var o;this._parent(i);var l,a={},s=i.offset?i.offset:0,r=i.activeTabIndex?i.activeTabIndex:i.tabs?i.tabs[0].id:null,d=!0,c=function(){if(o&&l){var e=i.frameWindow.getImmersiveFrame().getFreeZone().getSize();if(e.width){var t=l.getWidthWithoutScroll(),n=e.width-s,a=t+100>n?n:t+100;o.setStyles({"max-width":a-50+"px",width:a-50+"px"});var r=0;let d=i.frameWindow.getImmersiveFrame().getDockingElement(WUXDockAreaEnum.LeftDockArea);(d.getContainedVisibleWindows().length>0||d.interactiveDockAreaVisibleFlag)&&(r=d._collapserSize,d.collapseDockingZoneFlag||(r+=d.dockingZoneSize)),r+=(n-a)/2+s+25,o.setStyles({left:r+"px"})}}};this.setOffset=function(e){s!==e&&(s=e,c())},this.getOffset=function(){return s},this.setVisibleFlag=function(e){o.setStyles({display:e?"":"none"})},this.getVisibleFlag=function(){return""===o.style.display},this.setActiveNarBarItem=function(e){l&&(d=!1,l.value=[e],r=e,d=!0)},this.getActiveNarBarItem=function(){if(l)return l.value},this.clean=function(){l&&(l.displayStyle="normal",l.destroy()),o&&i.frameWindow.getUIFrame().removeChild(o),a.onFreeZoneResize&&i.frameWindow&&i.frameWindow.getImmersiveFrame().removeEventListener("freeZoneResize",c),o=l=null,a={}};if((o=e.createElement("div",{class:"EXPNavBar"}).inject(i.frameWindow.getUIFrame())).setStyles({opacity:0}),(l=new n({displayStyle:["strip","strip-box"],showComboBoxFlag:!0}).inject(o)).addEventListener("change",function(e){d&&e.dsModel.value[0]&&e.dsModel.value[0]!==r&&(r=e.dsModel.value[0],i.onClickCB(r)),d=!0}),i.tabs&&i.tabs.length)for(var h=0;h<i.tabs.length;h++)l.add({value:i.tabs[h].id,label:i.tabs[h].label});a.onFreeZoneResize||(i.frameWindow.getImmersiveFrame().addEventListener("freeZoneResize",c),a.onFreeZoneResize=1),r&&this.setActiveNarBarItem(i.activeTabIndex),setTimeout(function(){o&&(c(),o.setStyles({opacity:1}))},50)}}})}),define("DS/DMUControls/EXPColorPicker",["UWA/Core","UWA/Class","DS/Controls/Gauge","DS/Visualization/ThreeJS_DS","DS/VisuEvents/EventsManager","DS/WebappsUtils/WebappsUtils","DS/CoreEvents/Events","DS/VisuEvents/EventsManager","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,l,a,s){"use strict";return t.extend({init:function(t){var r,d,c=t||{};this._parent(c);var h,u,m,g,p,f,v,C,w,y,b=l.getWebappsAssetUrl("DMUBaseUI","images/"),D=!1,S=this,x=!0,E=!0,k={color:!0,opacity:!0},M=!0,P=[{r:0,g:0,b:0},{r:25,g:25,b:25},{r:61,g:61,b:61},{r:75,g:75,b:75},{r:100,g:100,b:100},{r:125,g:125,b:125},{r:150,g:150,b:150},{r:175,g:175,b:175},{r:190,g:190,b:190},{r:205,g:205,b:205},{r:230,g:230,b:230},{r:255,g:255,b:255}],I=[{r:109,g:40,b:40},{r:204,g:9,b:47},{r:143,g:76,b:0},{r:255,g:138,b:46},{r:254,g:224,b:0},{r:87,g:184,b:71},{r:71,g:119,b:56},{r:141,g:222,b:228},{r:54,g:142,b:196},{r:77,g:98,b:186},{r:0,g:37,b:150},{r:155,g:42,b:152}];function U(e){"boolean"==typeof e.color&&(k.color=e.color,v&&v.setStyles({display:e.color?"block":"none"}),(-1!==P.indexOf(y)&&M||-1!==I.indexOf(y)&&!M)&&m()),"boolean"==typeof e.opacity&&(k.opacity=e.opacity,C&&(C.setStyles({display:e.opacity?"block":"none"}),e.opacity&&w.getContent().hasClassName("EXPOpacitySliderDisableHover")?w.getContent().removeClassName("EXPOpacitySliderDisableHover"):e.opacity||w.getContent().addClassName("EXPOpacitySliderDisableHover")))}function B(e){for(var t=e.from[0].view;t;){if(t.className&&-1!==t.className.indexOf("EXPColorPicker"))return;t=t.parentNode}S.clean()}this.getContent=function(){return r},this.build=function(t){if(x=!1,S.clean(),x=!0,t.displayColorSlider||t.displayOpacitySlider){var F,_,T;if(r=e.createElement("div",{class:"EXPColorPicker"}),t.displayColorSlider&&function(t){var l;d=new e.createElement("div",{class:"EXPColorPickerColorSlider"}).inject(r);var a=-1,s=-1;if(t.defaultColor){for(var c=new i.Color,h=0;h<I.length;h++)if(c.setRGB(I[h].r/255,I[h].g/255,I[h].b/255),c.equals(t.defaultColor)){s=h,M=!0,y=I[h];break}if(-1===s)for(var u=0;u<P.length;u++)if(c.setRGB(P[u].r/255,P[u].g/255,P[u].b/255),c.equals(t.defaultColor)){a=u,M=!1,y=P[u];break}}else s=0,M=!0;var p=M?-1!==s?s:6:a;g=new e.Element("div",{class:"EXPColorPickerBWSwitch"}).inject(d);var C=new e.createElement("img").inject(g);C.src=b+(M?"I_SwitchBWPalette.png":"I_SwitchColorPalette.png");var w=new n({className:"EXPColorPickerColorGauge",minValue:0,maxValue:I.length-1,stepValue:1,value:p,graduationsLabel:!1,dynamicGaugeColor:!1,eventsList:[]}).inject(d);l=w.getContent(),w.elements.control.setStyles({height:"30px",margin:0}),(v=w._cursors[1]).setStyles({height:"30px",width:"20px","border-radius":"0px","border-width":"4px 3px","border-style":"solid","border-color":"rgb(240, 240, 240)",outline:"1px solid #adadad"}),v.setHTML(""),w._cursors[0].setStyles({backgroundColor:"none"}),l.setAttributes({id:M?"color_gauge":"bw_gauge"}),l.setStyles({backgroundImage:'url("'+b+(M?"ColorPalette.jpg":"BWPalette.jpg")+'")',position:"absolute","margin-top":"14px",left:"30px"});var D=function(e){var n=[];if("color_gauge"===l.id?n=I:"bw_gauge"===l.id&&(n=P),!isNaN(w.getValue())){var i=w.getValue();y=n[i],v.setHTML(""),v.setStyles({backgroundImage:"none",backgroundColor:"rgb("+n[i].r+","+n[i].g+","+n[i].b+")","-webkit-transform":"translate3d(-50%,0,0)","-moz-transform":"translate3d(-50%,0,0)","-ms-transform":"translate3d(-50%,0,0)","-o-transform":"translate3d(-50%,0,0)",transform:"translate3d(-50%,0,0)"}),t.onColorChangedCB&&(p=i,e.sendCB&&t.onColorChangedCB({color:"rgb("+n[p].r+","+n[p].g+","+n[p].b+")"}))}};w.addEvent("change",function(){f&&f.hasClassName("EXPColorPickerResetButtonActiveState")&&f.removeClassName("EXPColorPickerResetButtonActiveState"),D({sendCB:!0}),U({color:!0,opacity:t.colorAndOpacityBinded})}),m=function(){M=!M,"color_gauge"===l.id?(l.style.backgroundImage='url("'+b+'BWPalette.jpg")',l.id="bw_gauge",C.src=b+"I_SwitchColorPalette.png"):"bw_gauge"===l.id&&(l.style.backgroundImage='url("'+b+'ColorPalette.jpg")',l.id="color_gauge",C.src=b+"I_SwitchBWPalette.png"),k.color&&(p=-1,D({sendCB:!0}))},o.addEvent(g,"onPrimaryPointerClick",m),U({color:null!==t.defaultColor,opacity:t.colorAndOpacityBinded&&null!==t.defaultColor}),D({sendCB:!1})}(t),t.displayOpacitySlider&&(F=t,T=new e.createElement("div",{class:"EXPColorPickerOpacitySlider"}).inject(r),_=0===F.defaultOpacity?0:F.defaultOpacity?F.defaultOpacity:1,(w=new n({className:"EXPColorPickerOpacityGauge",minValue:F.minOpacity?F.minOpacity:0,maxValue:F.maxOpacity?F.maxOpacity:1,stepValue:.1,value:_,graduationsLabel:!1,dynamicGaugeColor:!1,eventsList:[]}).inject(T)).getContent().setStyles({"margin-top":"5px",border:"none"}),w.elements.control.setStyles({height:"10px",top:"4px"}),C=w._cursors[1],U({opacity:null!==F.defaultOpacity,color:F.colorAndOpacityBinded&&null!==F.defaultOpacity}),w._cursors[1].setStyles({height:"20px",top:"-4px"}),w.addEvent("change",function(){f&&f.hasClassName("EXPColorPickerResetButtonActiveState")&&f.removeClassName("EXPColorPickerResetButtonActiveState"),U({opacity:!0,color:F.colorAndOpacityBinded}),F.onOpacityChangedCB&&F.onOpacityChangedCB({opacity:this.getValue()}),this._cursors[1].setStyles({"-webkit-transform":"translate3d(-50%,0,0)","-moz-transform":"translate3d(-50%,0,0)","-ms-transform":"translate3d(-50%,0,0)","-o-transform":"translate3d(-50%,0,0)",transform:"translate3d(-50%,0,0)"})})),t.displayResetButton&&function(t){(f=new e.createElement("div",{class:"EXPColorPickerResetButton"}).inject(d)).title=t.resetButtonLabel,t.defaultResetState&&(f.addClassName("EXPColorPickerResetButtonActiveState"),U({color:!1,opacity:!1})),new e.createElement("img",{class:"EXPColorPickerResetButtonIcon"}).inject(f).src=l.getWebappsAssetUrl("DMUControls","icons/22/")+"I_ResetButton.png",p=function(){f.hasClassName("EXPColorPickerResetButtonActiveState")||(t.onResetButtonPressedCB(),f.addClassName("EXPColorPickerResetButtonActiveState"),U({color:!1,opacity:!1}))},o.addEvent(f,"onPrimaryPointerClick",p)}(t),E=!1!==t.hideWithDistance,c.frameWindow){var R=c.frameWindow.getContextualUIManager().getContextualBar(),j=R.getPosition();if(j&&R||t.position&&t.position.x&&t.position.y){var A=t.displayColorSlider&&t.displayOpacitySlider?80:t.displayColorSlider?53:30,N=238;t.displayResetButton&&(N+=35);var L=t.position?0:R.elements.container.getDimensions().width/2-N/2,V=t.position?0:R.elements.container.getDimensions().height,O=t.position?t.position.x:j.x+L,H=t.position?t.position.y:j.y-V-A-5;H<0&&(H=j.y+5),(h=new e.Element("div",{class:"EXPContextualColorPicker",styles:{position:"absolute",top:H+"px",left:O+"px",width:N+"px",height:A+"px",opacity:1}}).inject(c.frameWindow.getUIFrame())).appendChild(r),u=a.subscribe({event:"/VISU/"},function(e){var t=e.eventType;if("@onViewpointBeginMove"===t)S.clean();else if("@onMoveEvent"===t&&E){var n=new i.Box2(new i.Vector2(O,H),new i.Vector2(O+N,H+A)).distanceToPoint(e.event.getCurrentPosition(c.frameWindow.getContent()));n>200?S.clean():h.setStyles({opacity:Math.min((200-n)/200,1)})}}),s.addEvent(document,"onLeftMouseDown",B),s.addEvent(document,"onTouch",B)}}D=!0}},this.getVisibleFlag=function(){return!c.frameWindow||D},this.setVisibleFlag=function(e){c.frameWindow&&h&&(!D&&e?h.inject(c.frameWindow.getUIFrame()):D&&!e&&c.frameWindow.getUIFrame().removeChild(h),D=e)},this.clean=function(){c.frameWindow&&h&&h.parentNode===c.frameWindow.getUIFrame()&&c.frameWindow.getUIFrame().removeChild(h),m&&g&&o.removeEvent(g,"onPrimaryPointerClick",m),p&&f&&o.removeEvent(f,"onPrimaryPointerClick",p),u&&a.unsubscribe(u),s.removeEvent(document,"onLeftMouseDown",B),s.removeEvent(document,"onTouch",B),r=h=u=g=m=p=f=null,x&&c.onDestroyCB&&c.onDestroyCB()}}})}),define("DS/DMUControls/DMUContextToolsMenu",["UWA/Class","UWA/Core","DS/Controls/Button","css!DS/DMUControls/DMUControls.css"],function(e,t,n){"use strict";return e.extend({init:function(e){var i,o,l=[],a=[],s=t.createElement("div",{id:"DMUContextToolsMenu",class:"DMUContextToolsMenu"}).inject(e.frameWindow.getUIFrame()),r=t.createElement("div",{id:"DMUContextToolsCmdsContainer",class:"DMUContextToolsCmdsContainer"}).inject(s);function d(){var t=0,n=0,i=0,l=e.frameWindow.getImmersiveFrame().getDockingElement(WUXDockAreaEnum.RightDockArea),a=e.frameWindow.getImmersiveFrame().getDockingElement(WUXDockAreaEnum.BottomDockArea),r=e.frameWindow.getImmersiveFrame().getDockingElement(WUXDockAreaEnum.LeftDockArea),d=l.getContainedVisibleWindows().length>0,c=a.getContainedVisibleWindows().length>0,h=r.getContainedVisibleWindows().length>0;(d||l.interactiveDockAreaVisibleFlag)&&(t=l._collapserSize,l.collapseDockingZoneFlag||(t+=l.dockingZoneSize)),(c||a.interactiveDockAreaVisibleFlag)&&(n=a._collapserSize,a.collapseDockingZoneFlag||(n+=a.dockingZoneSize)),(h||r.interactiveDockAreaVisibleFlag)&&(i=r._collapserSize,r.collapseDockingZoneFlag||(i+=r.dockingZoneSize)),o&&o.setStyles({left:"calc("+i+"px + 10px)",bottom:"calc("+n+"px + 40px)"}),s&&(s.setStyles({right:t+"px",top:"50%",transform:"translateY(calc(-50% - "+.5*n+"px))"}),s.getPosition().y<=0&&s.setStyles({right:t+"px",top:"0px",transform:""}))}function c(e){if(l&&l.length)for(var t=0;t<l.length;t++)l[t].buttonDiv.removeClassName("DMUContextToolsSelectedCmd"),l[t].id!==e||l[t].isOneShot||l[t].buttonDiv.addClassName("DMUContextToolsSelectedCmd")}function h(e){if(a&&a.length)for(var t=0;t<a.length;t++)a[t].removeClassName("selected"),a[t].id===e&&a[t].addClassName("selected")}e.frameWindow.getImmersiveFrame().addEventListener("freeZoneResize",d),this.addButton=function(e){if(e&&e.label&&e.id&&e.icon&&e.onClickCB){var i=t.createElement("div",{id:e.id,title:e.label,class:"DMUContextToolsCmdButton"}).inject(r),o=new n({label:e.id,showLabelFlag:!1,icon:e.icon,displayStyle:"lite",onClick:function(t){c(t.dsModel.label),e.onClickCB({id:t.dsModel.label})}}).inject(i),a={id:e.id,type:e.type?e.type:"exclusive",button:o,buttonDiv:i,isOneShot:void 0!==e.isOneShot&&e.isOneShot};l.push(a),e.isSelected&&c(e.id),d()}},this.createCornerButton=function(n){(o=new t.Element("button",{id:n.id,class:"DMUContextToolsCornerButton",styles:{"background-image":"url("+n.disabledIcon+")"}}).inject(e.frameWindow.getUIFrame())).addEvent("click",function(e){var t=o.hasClassName("selected");t?(o.removeClassName("selected"),o.setStyles({"background-image":"url("+n.disabledIcon+")"})):(o.addClassName("selected"),o.setStyles({"background-image":"url("+n.enabledIcon+")"})),n.onClickCB({id:e.target.id,checked:!t})}),d()},this.addSeparator=function(){t.createElement("div",{id:"DMUContextToolsCmdSeparator",class:"DMUContextToolsCmdSeparator"}).inject(r)},this.createColorPalette=function(e){e&&e.length&&(i||(this.addSeparator(),i=t.createElement("div",{id:"DMUContextColorPalette",class:"DMUContextColorPalette"}).inject(s),e.forEach(function(e){var n=new t.Element("button",{id:e.id,class:"DMUContextColorPaletteButton",styles:{"background-color":e.color.getStyle()}});n.addEvent("click",function(t){h(t.target.id),e.onClickCB({id:t.target.id})}),n.inject(i),a.push(n),e.isSelected&&n.addClassName("selected")})),d())},this.setColor=function(e){i&&h(e)},this.isCornerButtonActive=function(){return!(!o||!o.hasClassName("selected"))},this.setVisibleFlag=function(e){e?(o&&o.show(),s&&s.show()):(o&&o.hide(),s&&s.hide())},this.destroy=function(){e.frameWindow.getImmersiveFrame().removeEventListener("freeZoneResize",d),l&&l.length&&(l.forEach(function(e){e.buttonDiv.remove(),e.button=null}),l=null),s&&(e.frameWindow.getUIFrame().removeChild(s),s.remove(),s=null),r&&(r.remove(),r=null),i&&(i.remove(),i=null),o&&(o.remove(),o=null)}}})}),define("DS/DMUControls/EXPFileBrowser",["UWA/Core","UWA/Controls/Abstract"],function(e,t){"use strict";return t.extend({init:function(t){this._parent(t);var n=null,i=new FileReader,o=!1,l=null;function a(){!o&&t.onErrorCB&&t.onErrorCB()}(n=new e.createElement("input",{id:"DMUFileSelector"}).inject(window.widget.body)).setAttribute("type","file"),n.setAttribute("accept","image/*"),n.setStyles({opacity:0}),n.onchange=function(){if(n){var e=n.files;if(!e||e&&!e.length)return void a();l=e[0].name,i.onload=function(){var e=new Image;e.src=i.result,e.name=l,e.onload=function(){o=!0,t.onFileLoadedCB({img:e,name:l})},e.onerror=a},setTimeout(a,5e3),i.readAsDataURL(e[0])}},this.openFileBrowser=function(){n.click()},this.cleanFileBrowser=function(){n&&n.parentNode===window.widget.body&&window.widget.body.removeChild(n),n=null}}})}),define("DS/DMUControls/DMUBaseSlider",["UWA/Core","UWA/Class","DS/Utilities/TouchUtils","DS/Controls/Slider","DS/Controls/Toggle","DS/Controls/ComboBox","DS/VisuEvents/EventsManager","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,l,a,s){"use strict";return t.extend({init:function(t){if(!t)return;let r,d,c,h,u,m=0,g={},p=null,f=null;function v(){if(!r)return;let e=t.getImmersiveFrame().getFreeZone().getSize();if(e.width){let n=0,i=t.getImmersiveFrame().getDockingElement(WUXDockAreaEnum.LeftDockArea);(i.getContainedVisibleWindows().length>0||i.interactiveDockAreaVisibleFlag)&&(n=i._collapserSize,i.collapseDockingZoneFlag||(n+=i.dockingZoneSize)),n+=e.width/2-m/2,r.setStyles({opacity:"1",left:n+"px",width:m+"px"})}}this.build=function(C){let w=C||{};if(isNaN(w.value))return;if(isNaN(w.minValue))return;if(isNaN(w.maxValue))return;if(isNaN(w.stepValue))return;(w.value<w.minValue||w.value>w.maxValue)&&(w.value=.5*(w.minValue+w.maxValue)),w.viewerCanvas&&(p=w.viewerCanvas),(r=new e.Element("div",{class:"DMUBaseTranslationSliderSpinnerContainer"}).inject(t.getUIFrame())).setStyles({opacity:"0"}),void 0!==w.leftButton&&(void 0!==w.leftButton.color?(c=e.createElement("div",{class:"DMUBaseSideButton",title:w.leftButton.title}).inject(r),n.getTouchMode()&&c.setStyles({width:"24px",height:"24px"}),c.style.background=w.leftButton.color,c.addEventListener("click",function(){f&&(f.value!==w.minValue?(u=f.value,f.value=w.minValue):u&&(f.value=u,u=void 0))})):void 0!==w.leftButton.icon&&(c=new e.createElement("img",{class:"DMUBaseSideButton",src:w.leftButton.iconPath,styles:{left:"0px"}}).inject(r)),m+=n.getTouchMode()?36:24);let y,b,D=e.createElement("div",{class:"DMUBaseTranslationSliderContainer",styles:{display:""}}).inject(r);if(f=new i({minValue:w.minValue,maxValue:w.maxValue,stepValue:w.stepValue,value:w.value}).inject(D),m+=220,f.addEventListener("change",function(){w.onChangeCB&&w.onChangeCB(f.value)}),void 0!==w.rightButton&&(void 0!==w.rightButton.color?(h=e.createElement("div",{class:"DMUBaseSideButton",title:w.rightButton.title}).inject(r),n.getTouchMode()&&h.setStyles({width:"24px",height:"24px"}),h.style.background=w.rightButton.color,h.addEventListener("click",function(){f&&(f.value!==w.maxValue?(u=f.value,f.value=w.maxValue):void 0!==u&&(f.value=u,u=void 0))})):void 0!==w.rightButton.icon&&(h=new e.createElement("img",{class:"DMUBaseSideButton",src:w.rightButton.iconPath}).inject(r)),m+=n.getTouchMode()?36:24),w.subMenuItems){let t,i;(b=new e.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-menu-dot",title:s.compareMenuIcon}).inject(r)).addClassName("DMUBaseViewMenuIcon"),n.getTouchMode()&&b.setStyles({"font-size":"24px"}),b.addEventListener("click",function(){b&&y&&(b.hasClassName("DMUBaseViewMenuIconOnClick")?(b.removeClassName("DMUBaseViewMenuIconOnClick"),y.setStyle("display","none")):(b.addClassName("DMUBaseViewMenuIconOnClick"),y.setStyle("display","")))}),m+=n.getTouchMode()?34:24,y=e.createElement("div",{class:"DMUBaseViewMenuContainer",styles:{display:"none"}}).inject(r),w.subMenuItems.forEach(function(e){"combo"===e.type?((i=new l({elementsList:e.elementList,enableSearchFlag:e.enableSearchFlag,value:e.value})).addEventListener("change",function(){e.callBack&&e.callBack(i.value)}),i.inject(y)):((t=new o({type:e.type,label:e.label,checkFlag:e.checkFlag})).addEventListener("buttonclick",function(){e.callBack&&e.callBack(t.checkFlag)}),t.inject(y))}),w.subMenuItems.length>=1&&y.setStyles({height:10+w.subMenuItems.length*(n.getTouchMode()?38:24)+"px"}),d=function(){b.hasClassName("DMUBaseViewMenuIconOnClick")&&(b.removeClassName("DMUBaseViewMenuIconOnClick"),y.setStyle("display","none"))},p&&a.addEvent(p,"onPrimaryPointerClick",d)}if(w.lastButton){let t=new e.createElement("div",{class:w.lastButton.iconClassName,title:w.lastButton.title}).inject(r);t.addClassName("DMUBaseViewMenuIcon"),n.getTouchMode()&&t.setStyles({"font-size":"24px"}),t.addEventListener("click",function(){w.lastButton.callBack(!0)}),m+=n.getTouchMode()?34:24}g.onFreeZoneResize||(t.getImmersiveFrame().addEventListener("freeZoneResize",v),g.onFreeZoneResize=1),setTimeout(function(){r&&v()},50)},this.update=function(e){e.value&&f&&(f.value=e.value),h&&(e.rightButton.color&&(h.style.background=e.rightButton.color),e.rightButton.title&&(h.title=e.rightButton.title)),c&&(e.leftButton.color&&(c.style.background=e.leftButton.color),e.leftButton.title&&(c.title=e.leftButton.title))},this.clean=function(){t&&r&&r.parentNode===t.getUIFrame()&&t.getUIFrame().removeChild(r),g.onFreeZoneResize&&t&&t.getImmersiveFrame().removeEventListener("freeZoneResize",v),p&&d&&a.removeEvent(p,"onPrimaryPointerClick",d),f=p=null,d=null,r=null,u=void 0,m=0}}})}),define("DS/DMUControls/EXPWindow",["UWA/Controls/Abstract","UWA/Controls/Drag","i18n!DS/DMUControls/assets/nls/DMUControls","WebappsUtils/WebappsUtils"],function(e,t,n,i){"use strict";return e.extend({defaultOptions:{body:null,height:"320",width:"320",title:"Window Title",position:{top:"50",left:"50"},fTopbarHeight:30,fManipulatorSize:10,fMarginAroundViewer:10,fResizeMinHeight:320,fResizeMinWidth:320,fCornerRoundRadius:4,bTopBarButtons:!0,bFullScreenOnDbclickTopbar:!0,bScaleManipulator:!0,bMoveManipulator:!0,bBoxShadow:!0,bBoldTitle:!1},init:function(e){this._domElements={_mainContainer:null,_topbarContainer:null,_topbarTitle:null,_topbarButtonContainer:null,_topbarTitleText:null,_Containerviewer:null,_viewer:null,_sizeControlLeft:null,_sizeControlRight:null,_sizeControlBottom:null,_sizeControlBottomLeft:null,_sizeControlBottomRight:null};var t=UWA.extend(this.defaultOptions,e);this._fullscreenObject={_bFullscreenIsEnable:!1,mainContainerPreFullscreenPosition:null,mainContainerPreFullscreenSize:null},this._dragEventParameters={mainContainerOriginalPosition:null,mainContainerOriginalSize:null},this._parent(t),this._createWindow()},setHTMLContent:function(e){e&&e.inject&&(e.inject(this._domElements._viewer),e.style.width="100%",e.style.height="100%")},setVisibility:function(e){var t=e?"block":"none";this._domElements._mainContainer.setStyle("display",t)},show:function(){this._domElements._mainContainer.setStyle("display","block")},noShow:function(){this._domElements._mainContainer.setStyle("display","none")},clear:function(){this._domElements._mainContainer.destroy()},isShow:function(){return!("none"===this._domElements._mainContainer.getStyle("display"))},setFullScreen:function(e,t){e?(this._fullscreenObject.mainContainerPreFullscreenPosition=this._domElements._mainContainer.getPosition(),this._fullscreenObject.mainContainerPreFullscreenSize=this._domElements._mainContainer.getSize(),this._domElements._mainContainer.setStyle("width",this.options.body.parentElement.getSize().width+"px"),this._domElements._mainContainer.setStyle("height",this.options.body.parentElement.getSize().height+"px"),this._domElements._mainContainer.setPosition({x:0,y:0}),this.options.bTopBarButtons&&(this._domElements._topBarMinimizeButton.setStyle("display","inline-block"),this._domElements._topBarMaximizeButton.setStyle("display","none")),this._fullscreenObject._bFullscreenIsEnable=!0):(this.options.bTopBarButtons&&(this._domElements._topBarMinimizeButton.setStyle("display","none"),this._domElements._topBarMaximizeButton.setStyle("display","inline-block")),t||(this._domElements._mainContainer.setStyle("width",this._fullscreenObject.mainContainerPreFullscreenSize.width+"px"),this._domElements._mainContainer.setStyle("height",this._fullscreenObject.mainContainerPreFullscreenSize.height+"px"),this._domElements._mainContainer.setPosition(this._fullscreenObject.mainContainerPreFullscreenPosition)),this._fullscreenObject._bFullscreenIsEnable=!1),this._updateSize()},isFullScreen:function(){return this._fullscreenObject._bFullscreenIsEnable},_createWindow:function(){this._createMainContainer(),this._createTopbarContainer(),this._createTopbarTitle(),this.options.bTopBarButtons&&this._createTopbarButtonContainer(),this._createViewerContainer(),this._createViewer(),this.options.bScaleManipulator&&this._createSizeControl(),this.setHTMLContent(this.options.HTMLContent)},_createUWADiv:function(e){return UWA.createElement("div",{styles:e})},_createUWATopButton:function(e,t,n){var i='<span title="'+t+'"><img src='+e+" ></span>";return UWA.createElement("button",{html:i,styles:{padding:"0",border:"0",backgroundColor:"#F0F0F0",display:"inline-block",verticalAlign:"middle",marginLeft:"5px",outlineStyle:"none"},events:{click:function(){n()}}})},_createMainContainer:function(){this._domElements._mainContainer=this._createUWADiv({position:"absolute",height:this.options.height,borderRadius:this.options.fCornerRoundRadius+"px",width:this.options.width,backgroundColor:"#F0F0F0",boxShadow:this.options.bBoxShadow?"0 1px 1px 0px rgba(26,25,25,0.24)":"none",top:this.options.position.top+"px",left:this.options.position.left+"px",overflow:"visible",border:"1px solid #D1D1D1"}),this._domElements._mainContainer.inject(this.options.body)},_createTopbarContainer:function(){this._domElements._topbarContainer=this._createUWADiv({position:"relative",height:this.options.fTopbarHeight+"px",width:"100%",cursor:"default",overflow:"hidden"}),this._domElements._topbarContainer.inject(this._domElements._mainContainer);var e=this;if(this.options.bFullScreenOnDbclickTopbar&&this._domElements._topbarContainer.addEvent("dblclick",function(){e.setFullScreen(!e.isFullScreen())}),this.options.bMoveManipulator){var n=new t({element:this._domElements._topbarContainer});n.move=function(){if(e.isFullScreen()){var t=e._domElements._mainContainer.getSize(),n=e._domElements._mainContainer.getPosition(),i=100*this.currentEvent.clientX/t.width*e._fullscreenObject.mainContainerPreFullscreenSize.width/100,o=this.currentEvent.clientX-i,l=n.y+this.currentDelta.y;e._domElements._mainContainer.setPosition({x:o,y:l}),e._startDrag(this,e),e.setFullScreen(!1)}var a=e._manipulatorComputeChecker(this,"drag");e._domElements._mainContainer.setPosition({x:a.position.x,y:a.position.y})},n.start=function(){e._startDrag(this,e)}}},_createTopbarTitle:function(){this._domElements._topbarTitle=this._createUWADiv({position:"absolute",height:"100%",lineHeight:this.options.fTopbarHeight+"px",width:"auto",overflow:"hidden"}),this._domElements._topbarTitle.className="topbarTitleEXPWin",this._domElements._topbarTitle.inject(this._domElements._topbarContainer),this._domElements._topbarTitleText=this._createUWADiv({display:"inline-block",verticalAlign:"middle",lineHeight:"normal",overflow:"hidden",marginLeft:this.options.fMarginAroundViewer+"px",fontFamily:"Open Sans,Segoe UI,Helvetica,Arial,sans-serif",whiteSpace:"nowrap",textOverflow:"ellipsis",fontSize:"13px",fontWeight:this.options.bBoldTitle?"bold":"normal"}),this._domElements._topbarTitleText.inject(this._domElements._topbarTitle),this._domElements._topbarTitleText.setText(this.options.title)},_createTopbarButtonContainer:function(){var e=this;this._domElements._topbarButtonContainer=this._createUWADiv({position:"absolute",height:"100%",width:100,right:0,textAlign:"right",lineHeight:this.options.fTopbarHeight+"px",marginRight:this.options.fMarginAroundViewer+"px",overflow:"hidden"}),this._domElements._topbarButtonContainer.inject(this._domElements._topbarContainer);var t=i.getWebappsBaseUrl()+"DMUControls/assets/icons/maximize.png",o=n.maximize,l=function(){e.setFullScreen(!0)};this._domElements._topBarMaximizeButton=this._createUWATopButton(t,o,l),this._domElements._topBarMaximizeButton.inject(this._domElements._topbarButtonContainer),t=i.getWebappsBaseUrl()+"DMUControls/assets/icons/minimize.png",o=n.minimize,l=function(){e.setFullScreen(!1)},this._domElements._topBarMinimizeButton=this._createUWATopButton(t,o,l),this._domElements._topBarMinimizeButton.setStyle("display","none"),this._domElements._topBarMinimizeButton.inject(this._domElements._topbarButtonContainer),t=i.getWebappsBaseUrl()+"DMUControls/assets/icons/cancel.png",o=n.close,l=function(){e.setVisibility(!1)},this._createUWATopButton(t,o,l).inject(this._domElements._topbarButtonContainer)},_createViewerContainer:function(){this._domElements._viewerContainer=this._createUWADiv({position:"relative",height:this._domElements._mainContainer.offsetHeight-this.options.fTopbarHeight,width:"100%",overflow:"hidden",paddingRight:this.options.fMarginAroundViewer+"px",paddingLeft:this.options.fMarginAroundViewer+"px",paddingBottom:this.options.fMarginAroundViewer+"px"}),this._domElements._viewerContainer.inject(this._domElements._mainContainer)},_createViewer:function(){this._domElements._viewer=this._createUWADiv({position:"relative",height:"100%",width:"100%",overflow:"hidden"}),this._domElements._viewer.inject(this._domElements._viewerContainer)},_manipulatorComputeChecker:function(e,t){var n={size:{width:null,height:null},position:{x:null,y:null}};if("left"===t){let t=this._dragEventParameters.mainContainerOriginalSize.width-e.currentDelta.x;if(t<this.options.fResizeMinWidth){var i=this._domElements._mainContainer.getPosition().x+this._domElements._mainContainer.getSize().width;n.size.width=this.options.fResizeMinWidth,n.position.x=i-this.options.fResizeMinWidth}else n.size.width=t,n.position.x=this._dragEventParameters.mainContainerOriginalPosition.x+e.currentDelta.x}if("right"===t){let t=this._dragEventParameters.mainContainerOriginalSize.width+e.currentDelta.x;t<this.options.fResizeMinWidth?n.size.width=this.options.fResizeMinWidth:n.size.width=t}if("bottom"===t){var o=this._dragEventParameters.mainContainerOriginalSize.height+e.currentDelta.y;o<this.options.fResizeMinHeight?n.size.height=this.options.fResizeMinHeight:n.size.height=o}if(n.position.x<0){var l=this._dragEventParameters.mainContainerOriginalPosition.x+this._dragEventParameters.mainContainerOriginalSize.width;n.position.x=0,n.size.width=l}return this._domElements._mainContainer.getPosition().x+n.size.width>this.options.body.parentElement.getSize().width&&(n.size.width=this.options.body.parentElement.getSize().width-this._domElements._mainContainer.getPosition().x),this._domElements._mainContainer.getPosition().y+n.size.height>this.options.body.parentElement.getSize().height&&(n.size.height=this.options.body.parentElement.getSize().height-this._domElements._mainContainer.getPosition().y),"drag"===t&&(n.position.x=this._dragEventParameters.mainContainerOriginalPosition.x+e.currentDelta.x,n.position.y=this._dragEventParameters.mainContainerOriginalPosition.y+e.currentDelta.y,n.position.x+this._domElements._mainContainer.getSize().width>this.options.body.parentElement.getSize().width&&(n.position.x=this.options.body.parentElement.getSize().width-this._domElements._mainContainer.getSize().width),n.position.y+this._domElements._mainContainer.getSize().height>this.options.body.parentElement.getSize().height&&(n.position.y=this.options.body.parentElement.getSize().height-this._domElements._mainContainer.getSize().height),n.position.x<0&&(n.position.x=0),n.position.y<0&&(n.position.y=0)),n},_createSizeControl:function(){var e=this;this._domElements._sizeControlLeft=this._createUWADiv({position:"absolute",bottom:0,height:"100%",width:this.options.fManipulatorSize+"px",cursor:"ew-resize",overflow:"hidden"}),this._domElements._sizeControlLeft.inject(this._domElements._mainContainer);var n=new t({element:this._domElements._sizeControlLeft});n.start=function(){e._startDrag(this,e)},n.move=function(){var t=e._manipulatorComputeChecker(this,"left");e._domElements._mainContainer.setStyle("width",t.size.width+"px"),e._domElements._mainContainer.setPosition({x:t.position.x,y:e._dragEventParameters.mainContainerOriginalPosition.y}),e.isFullScreen()&&e.setFullScreen(!1,!0)},this._domElements._sizeControlRight=this._createUWADiv({position:"absolute",bottom:0,right:0,height:"100%",width:this.options.fManipulatorSize+"px",cursor:"ew-resize",overflow:"hidden"}),this._domElements._sizeControlRight.inject(this._domElements._mainContainer);var i=new t({element:this._domElements._sizeControlRight});i.start=function(){e._startDrag(this,e)},i.move=function(){var t=e._manipulatorComputeChecker(this,"right");e._domElements._mainContainer.setStyle("width",t.size.width+"px"),e.isFullScreen()&&e.setFullScreen(!1,!0)},this._domElements._sizeControlBottom=this._createUWADiv({position:"absolute",left:0,bottom:0,height:this.options.fManipulatorSize+"px",width:"100%",cursor:"ns-resize",overflow:"hidden"}),this._domElements._sizeControlBottom.inject(this._domElements._mainContainer);var o=new t({element:this._domElements._sizeControlBottom});o.start=function(){e._startDrag(this,e)},o.move=function(){var t=e._manipulatorComputeChecker(this,"bottom");e._domElements._mainContainer.setStyle("height",t.size.height+"px"),e.isFullScreen()&&e.setFullScreen(!1,!0),e._updateSize()},this._domElements._sizeControlBottomLeft=this._createUWADiv({position:"absolute",left:0,bottom:0,width:this.options.fManipulatorSize+"px",height:this.options.fManipulatorSize+"px",cursor:"nesw-resize",overflow:"hidden"}),this._domElements._sizeControlBottomLeft.inject(this._domElements._mainContainer);var l=new t({element:this._domElements._sizeControlBottomLeft});l.start=function(){e._startDrag(this,e)},l.move=function(){var t=e._manipulatorComputeChecker(this,"left");e._domElements._mainContainer.setStyle("width",t.size.width+"px"),e._domElements._mainContainer.setPosition({x:t.position.x,y:e._dragEventParameters.mainContainerOriginalPosition.y}),t=e._manipulatorComputeChecker(this,"bottom"),e._domElements._mainContainer.setStyle("height",t.size.height+"px"),e.isFullScreen()&&e.setFullScreen(!1,!0),e._updateSize()},this._domElements._sizeControlBottomRight=this._createUWADiv({position:"absolute",right:0,bottom:0,width:this.options.fManipulatorSize+"px",height:this.options.fManipulatorSize+"px",cursor:"nwse-resize",overflow:"hidden"}),this._domElements._sizeControlBottomRight.inject(this._domElements._mainContainer);var a=new t({element:this._domElements._sizeControlBottomRight});a.start=function(){e._startDrag(this,e)},a.move=function(){var t=e._manipulatorComputeChecker(this,"right");e._domElements._mainContainer.setStyle("width",t.size.width+"px"),t=e._manipulatorComputeChecker(this,"bottom"),e._domElements._mainContainer.setStyle("height",t.size.height+"px"),e.isFullScreen()&&e.setFullScreen(!1,!0),e._updateSize()}},_updateSize:function(){this._domElements._viewerContainer.setStyle("height",this._domElements._mainContainer.offsetHeight-this.options.fTopbarHeight+"px")},_startDrag:function(e,t){t._dragEventParameters.mainContainerOriginalPosition=t._domElements._mainContainer.getPosition(),t._dragEventParameters.mainContainerOriginalSize=t._domElements._mainContainer.getSize()}})}),define("DS/DMUControls/panels/DMUCustomColorPanel",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS","DS/Controls/ColorChooser","DS/Controls/Button","DS/WebappsUtils/WebappsUtils","DS/VisuEvents/EventsManager","DS/CoreEvents/ModelEvents","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,l,a,s,r){"use strict";return t.extend({init:function(t){let d,c,h=t||{};this._parent(h);let u,m=new s,g=[],p=[];function f(e,t){return m.publish({event:e,data:t,context:this})}function v(e){if(e){let t=e.from[0].view.style.background;u=new n.Color(t.split(" ").join("")).getHexString()}u&&p.forEach(e=>{e.div.setStyles({outline:e.color===u?"4px #42a2da solid":""})})}function C(){for(;c.firstChild;)c.removeChild(c.firstChild);var t,n;g.forEach(e=>{a.removeEventFromToken(e)}),g.length=0;var i=new e.Element("div",{class:"DMUCustomColorContainer"}).inject(c);if(h.touchMode&&i.setAttributeNode(document.createAttribute("touch-mode")),p.length>0)for(t=0;t<5;t++)p[t]&&(n=new e.Element("div",{class:"DMUCustomColorSquare"}).inject(i),h.touchMode&&n.setAttributeNode(document.createAttribute("touch-mode")),n.style.background="#"+p[t].color,g.push(a.addEvent(n,"onPrimaryPointerClick",v)),p[t].div=n);if(p.length>5)for(i=new e.Element("div",{class:"DMUCustomColorContainer"}).inject(c),h.touchMode&&i.setAttributeNode(document.createAttribute("touch-mode")),t=5;t<10;t++)p[t]&&(n=new e.Element("div",{class:"DMUCustomColorSquare"}).inject(i),h.touchMode&&n.setAttributeNode(document.createAttribute("touch-mode")),n.style.background="#"+p[t].color,g.push(a.addEvent(n,"onPrimaryPointerClick",v)),p[t].div=n);v()}this.build=function(t){d=new e.Element("div",{class:"DMU3DCustomMainDiv"}),c=new e.Element("div",{class:"DMUCustomColorPalette"}).inject(d),h.touchMode&&c.setAttributeNode(document.createAttribute("touch-mode")),t.forEach(e=>{p.push({color:e})}),C();var n=new i({value:"ffffff"});n.getContent().setStyles({width:h.touchMode?"400px":"360px"});var a=new e.Element("div",{class:"DMUCustomPanelBtnDiv"}).inject(d);h.touchMode&&a.setAttributeNode(document.createAttribute("touch-mode"));var s=new o({icon:l.getWebappsAssetUrl("DMUBaseUI","images/")+"I_DMRAddColor.png"}).inject(a);h.touchMode&&s.getContent().setStyles({width:"40px","min-width":"40px"});var m=new o({icon:l.getWebappsAssetUrl("DMUBaseUI","images/")+"I_DMRRemoveColor.png",disabled:0===p.length}).inject(a);h.touchMode&&m.getContent().setStyles({width:"40px","min-width":"40px"});var g=new o({icon:l.getWebappsAssetUrl("DMUBaseUI","images/")+"I_DMRUpdateColor.png",disabled:0===p.length}).inject(a);h.touchMode&&g.getContent().setStyles({width:"40px","min-width":"40px"}),s.getContent().addClassName("DMUCustomSwitchColorButton"),s.addEventListener("click",function(){if(0===p.length&&(m.disabled=!1,g.disabled=!1),p.length<10){for(let e=0;e<p.length;e++)if(n.value===p[e].color)return;p.push({color:n.value}),null!==u&&(n.referenceValue=u),u=n.value,C(),10===p.length&&(s.disabled=!0)}}),m.getContent().addClassName("DMUCustomSwitchColorButton"),m.addEventListener("click",function(){if(1===p.length?(m.disabled=!0,g.disabled=!0):10===p.length&&(s.disabled=!1),p.length>0&&u)for(let e=0;e<p.length;e++)if(u===p[e].color)return p.splice(e,1),u=p.length&&p[e]?p[e].color:p[e-1]?p[e-1].color:null,void C()}),g.getContent().addClassName("DMUCustomSwitchColorButton"),g.addEventListener("click",function(){if(p.length>0&&u){for(let e=0;e<p.length;e++)if(n.value===p[e].color)return;for(let e=0;e<p.length;e++)if(u===p[e].color)return n.referenceValue=u,p[e].color=n.value,u=n.value,void C()}}),n.inject(d);var v=new e.Element("div",{class:"DMUCustomPanelBottomBtnDiv"}).inject(d),w=new o({label:r.grpPanelLabel.ok}).inject(v);w.getContent().addClassName("DMUCustomColorButton"),w.getContent().addEventListener("buttonclick",function(){f("onCustomColorPanelOk",{customColors:p.map(e=>e.color),selectedColor:u})});var y=new o({label:r.grpPanelLabel.cancel}).inject(v);return y.getContent().addClassName("DMUCustomColorButton"),y.getContent().addEventListener("buttonclick",function(){f("onCustomColorPanelCancel")}),d},this.setCurrentCustomColor=function(e){p.length>0&&p.forEach(t=>{new n.Color("#"+t.color).equals(e)&&(t.div.setStyles({outline:"4px #42a2da solid"}),u=t.color)})},this.clean=function(){g.forEach(e=>{a.removeEventFromToken(e)}),g.length=0,d=null},this.subscribe=function(e,t){if(e&&t)return m.subscribe({event:e},t)},this.unsubscribe=function(e){null!=e&&m.unsubscribe(e)}}})}),define("DS/DMUControls/DMUPasteWithOptionsPanel",["UWA/Core","UWA/Class","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Toggle","i18n!DS/DMUControls/assets/nls/DMUControls"],function(e,t,n,i,o,l){"use strict";return t.extend({init:function(t){var a=t||{};if(this._parent(a),a.frmWindow){var s,r,d=e.createElement("div",{class:"DMUPasteSpecialPanelMainDiv"});if(a.prefs&&a.prefs.overloadPasteSpecial){var c=new o({label:l.PasteSpecialPanel.graphicOverloads,value:"DMUPasteSpecial_OccGraphicProps",type:"checkbox",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_OccGraphicProps")}).inject(d),h=new o({label:l.PasteSpecialPanel.positionOverloads,value:"DMUPasteSpecial_OccPositions",type:"checkbox",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_OccPositions")}).inject(d);r=function(e){var t={},n=c.checkFlag;localStorage.setItem("DMUPasteSpecial_OccGraphicProps",n?"true":"false"),t.graphicProps=n,n=h.checkFlag,localStorage.setItem("DMUPasteSpecial_OccPositions",n?"true":"false"),t.positions=n,a&&a.cb&&a.cb(t,e),s.close?s.close():s.destroy()}}else{var u;a.prefs&&a.prefs.displayCameraPref&&(u=new o({label:l.PasteSpecialPanel.cameraLabel,value:"DMUPasteSpecial_Camera",type:"checkbox",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_Camera")}).inject(d));var m,g,p,f=new o({label:l.PasteSpecialPanel.formattingLabel,value:"DMUPasteSpecial_3DFormatting",type:"checkbox",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_3DFormatting")}).inject(d),v=new o({label:l.PasteSpecialPanel.markers3DLabel,value:"DMUPasteSpecial_3DMarkers",type:"checkbox",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_3DMarkers")}).inject(d),C=new o({label:l.PasteSpecialPanel.markers2DLabel,value:"DMUPasteSpecial_2DMarkers",type:"checkbox",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_2DMarkers")}).inject(d);a.prefs&&a.prefs.displayAssociateFormatPref&&(m=new o({label:l.PasteSpecialPanel.formatLabel,value:"DMUPasteSpecial_Format",type:"checkbox",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_Format")}).inject(d)),a.prefs&&a.prefs.displayAssociateFormatToSlidePref&&(g=new o({label:l.PasteSpecialPanel.associateFormatLabel,value:"DMUPasteSpecial_AssociateFormat",type:"switch",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_AssociateFormat")}).inject(d)).elements.container.setStyles({"text-align":"right","margin-top":"10px"}),a.prefs&&a.prefs.displayCreateNewSlidePref&&(p=new o({label:l.PasteSpecialPanel.createNewSlideLabel,value:"DMUPasteSpecial_CreateNewSlide",type:"switch",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_CreateNewSlide")}).inject(d)).elements.container.setStyles({"text-align":"right","margin-top":"10px"}),r=function(e){var t,n={};u&&(t=u.checkFlag,localStorage.setItem("DMUPasteSpecial_Camera",t?"true":"false"),n.camera=t),t=f.checkFlag,localStorage.setItem("DMUPasteSpecial_3DFormatting",t?"true":"false"),n.formatting=t,t=v.checkFlag,localStorage.setItem("DMUPasteSpecial_3DMarkers",t?"true":"false"),n.markers3D=t,t=C.checkFlag,localStorage.setItem("DMUPasteSpecial_2DMarkers",t?"true":"false"),n.markers2D=t,m&&(t=m.checkFlag,localStorage.setItem("DMUPasteSpecial_Format",t?"true":"false"),n.format=t),g&&(t=g.checkFlag,localStorage.setItem("DMUPasteSpecial_AssociateFormat",t?"true":"false"),n.associateFormat=t),p&&(t=p.checkFlag,localStorage.setItem("DMUPasteSpecial_CreateNewSlide",t?"true":"false"),n.createNewSlide=t),a&&a.cb&&a.cb(n,e),s.close?s.close():s.destroy()}}var w={};w.Ok=new i({emphasize:"primary",onClick:function(){r(!1)}}),w.Abort=new i({label:l.warningPanel.cancelLabel,onClick:function(){s.close?s.close():s.destroy()}}),a.prefs&&a.prefs.applyButtonNls&&(w.Apply=new i({label:a.prefs.applyButtonNls,onClick:function(){r(!0)}})),s=new n({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:t.panelTitle?t.panelTitle:l.PasteSpecialPanel.pasteSpecialPanelTitle,content:d,immersiveFrame:a.frmWindow.getImmersiveFrame(),buttons:w})}}})}),define("DS/DMUControls/DMUWarningPanel",["UWA/Core","UWA/Class","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Toggle","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,l){"use strict";return t.extend({init:function(t){if(this._parent(t),t&&t.frmWindow&&t.message){var a,s,r=e.createElement("div",{class:"DMUWarningPanelMainDiv"});e.createElement("span",{class:"DMUWarningPanelIcon fonticon fonticon-attention fonticon-3x"}).inject(r),e.createElement("p",{class:"DMUWarningPanelLabel"}).inject(r).innerHTML=t.message,t.checkboxMessage&&(a=new o({type:"checkbox",label:t.checkboxMessage,value:0,checkFlag:t.checked})).inject(r);var d={Ok:new i({emphasize:"primary",label:l.warningPanel.okLabel,onClick:function(){t.callbacks&&t.callbacks.onValidateCB&&t.callbacks.onValidateCB(a?a.checkFlag:null),s.close()}})};t.callbacks&&t.callbacks.onCancelCB&&(d.Cancel=new i({label:l.warningPanel.cancelLabel,onClick:function(){t.callbacks.onCancelCB(),s.close()}})),(s=new n({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:t.title?t.title:l.warningPanel.defaultTitle,content:r,immersiveFrame:t.frmWindow.getImmersiveFrame(),buttons:d})).addEventListener("close",function(){t.callbacks&&t.callbacks.onCloseCB&&t.callbacks.onCloseCB(),s=null}),this.destroy=function(){s&&s.close()}}}})}),define("DS/DMUControls/DMUInfoModalDiv",["require","exports","DS/UIKIT/Spinner","UWA/Core","DS/Windows/Dialog","DS/Controls/ProgressBar"],function(e,t,n,i,o,l){"use strict";return class{constructor(){let e,t,a,s,r;function d(){let e=0;if(!s)return;let t=s.getImmersiveFrame().getDockingElement(WUXDockAreaEnum.RightDockArea);(t.getContainedVisibleWindows().length>0||t.interactiveDockAreaVisibleFlag)&&(e=t._collapserSize,t.collapseDockingZoneFlag||(e+=t.dockingZoneSize)),e+=20,a&&a.setStyles({right:e+"px"})}this.display=function(c){if(!c||!c.frmWindow||!c.type)return;if(a)return;let h;if(s=c.frmWindow,(a=i.createElement("div",{class:"DMUInfoDiv"})).dsModel=this,"load"===c.type)h=i.createElement("div",{class:"DMULoadingDivProgressBar"}).inject(a),t=new n({visible:!0}).inject(h),c.message&&i.createElement("p",{class:"DMULoadingDivLabel"}).inject(a).setText(c.message);else if("message"===c.type)i.createElement("p",{class:"DMUMessageDivLabel"}).inject(a).setText(c.message);else if("save"===c.type)h=i.createElement("div",{class:"DMULoadingDivProgressBar"}).inject(a),t=new l({infiniteFlag:!0,displayStyle:"lite",shape:"circular",height:25,emphasize:"info"}).inject(h),a.setStyles({top:"20px"});else if("error"===c.type)h=i.createElement("div",{class:"DMULoadingDivProgressBar"}).inject(a),t=new l({infiniteFlag:!0,displayStyle:"lite",shape:"circular",height:25,emphasize:"high-attention"}).inject(h),a.setStyles({top:"20px"});else if("button"===c.type){let e;h=i.createElement("button",{class:"DMULoadingDivProgressBarButton"}).inject(a),c.label&&(e=i.createElement("div",{text:c.label}).inject(a)).addClassName("DMULoadingDivProgressBarLabel"),c.onClick&&h.addEvent("click",c.onClick),h.addEvent("mouseenter",function(){null==h||h.addClassName("highlighted"),e&&e.addClassName("shown")}),h.addEvent("mouseleave",function(){null==h||h.removeClassName("highlighted"),e&&e.removeClassName("shown")})}c.modal?(h&&h.setStyles({position:"absolute",top:"calc(50 % - 13px)",left:"50px"}),a.addClassName("DMUModalBackgroundDiv"),(e=new o({modalFlag:!0,immersiveFrame:s.getImmersiveFrame()})).elements.container.setStyles({display:"none"}),e.elements.container.parentNode.appendChild(a),a.setStyles({top:"calc(50% - "+a.offsetHeight/2+"px)",left:"calc(50% - "+a.offsetWidth/2+"px)"})):(s.getImmersiveFrame().addEventListener("freeZoneResize",d),r=1,a.inject(s.getUIFrame()),d()),c.styles&&a.setStyles(c.styles)},this.updateMessage=function(e){let t=null==a?void 0:a.lastChild;t&&t.setText(e)},this.getContent=function(){return a},this.destroy=function(){s&&r&&s.getImmersiveFrame().removeEventListener("freeZoneResize",d),t&&t.destroy(),e?e.close():s&&a&&s.getUIFrame().removeChild(a),e=a=t=null}}}}),define("DS/DMUControls/EXPSnapshotControl",["UWA/Core","UWA/Class","DS/Windows/Dialog","DS/Controls/Button","DS/UIKIT/Spinner","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,l){"use strict";return void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return t?new Promise(function(n,i){t.call(navigator,e,n,i)}):Promise.reject(new Error("getUserMedia is not implemented"))}),t.extend({init:function(t){var a;this._parent(t);var s=e.createElement("div",{class:"EXPSnapshotControl"}),r=e.createElement("div",{class:"EXPSnapshotControlSpinnerDiv"}).inject(s),d=e.createElement("video",{class:"EXPSnapshotVideo"}).inject(s),c=e.createElement("div",{class:"EXPSnapshotControlSnapDiv",styles:{opacity:0}}).inject(s),h=new o({visible:!0}).inject(r),u=new Image,m=e.createElement("canvas"),g=[],p=300;function f(){for(var e=0;e<g.length;e++)for(var t=g[e].getTracks(),n=0;n<t.length;n++)t[n].stop();g.length=0,h&&h.destroy(),a&&a.destroy(),a=h=s=d=null}var v=new i({emphasize:"primary",label:l.snapshotValidate,onClick:function(){var e=u.width,n=u.height;e>p&&(n=p*n/e,e=p),n>p&&(e=p*e/n,n=p),t.onValidateSnapshotCB({img:u,width:e,height:n}),f()}}),C=new i({label:l.snapshotReset,onClick:function(){d.play(),c.removeClassName("EXPSnapshotAnimation"),v.elements.button.setStyles({display:"none"}),C.elements.button.setStyles({display:"none"}),w.elements.button.setStyles({display:""})}}),w=new i({label:l.captureSnapshot,onClick:function(){c.setStyles({width:d.videoWidth,height:d.videoHeight}),c.addClassName("EXPSnapshotAnimation"),d.pause(),m.width=d.videoWidth,m.height=d.videoHeight,m.getContext("2d").drawImage(d,0,0,d.videoWidth,d.videoHeight),u.src=m.toDataURL("image/png"),u.width=d.videoWidth,u.height=d.videoHeight,v.elements.button.setStyles({display:""}),C.elements.button.setStyles({display:""}),w.elements.button.setStyles({display:"none"})}});(a=new n({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:l.snapshotTitle,content:s,immersiveFrame:t.immersiveFrame,buttons:{Abort:w,Ok:v,Apply:C}})).addEventListener("close",function(){f(),t.onCloseSnapshotCB&&t.onCloseSnapshotCB()}),w.disabled=!0,w.elements.button.setStyles({display:""}),v.elements.button.setStyles({display:"none"}),C.elements.button.setStyles({display:"none"});var y=navigator.mediaDevices.getUserMedia({video:{width:{min:50,max:640},height:{min:50,max:360}}});y.then(function(e){if(!e)return t.onErrorCB&&t.onErrorCB(),f();"srcObject"in d?d.srcObject=e:d.src=window.URL.createObjectURL(e),g.push(e),d.onloadedmetadata=function(){w.disabled=!1,s.removeChild(r),d.play()}}),y.catch(function(){t.onErrorCB&&t.onErrorCB(),f()})}})}),define("DS/DMUControls/panels/DMU3DComparePanel",["UWA/Core","UWA/Class","DS/CATWebUXComponents/CATWebUXPanel","DS/Controls/Button","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o){"use strict";return t.extend({init:function(t){var l,a,s,r,d;this._parent(t);var c=null,h=!0;this.buildPanel=function(t){this.clean(),c=t.displayType,l||(l=e.createElement("div",{id:"DMU3DCompareMainDiv"}));var m=e.createElement("div",{id:"panelcontent",class:"DMU3DCompareContainerDiv"}).inject(l),g=e.createElement("div",{id:"comparecontent",class:"DMU3DCompareCompareContentDiv"}).inject(m);if((s=u({leftLabel:o.dmuCompareNewLabel,color:t.newStyleColor,rightLabel:t.newStyleLabel||o.dmuCompareLoadingLabel})).inject(g),(r=u({leftLabel:o.dmuCompareOldLabel,color:t.oldStyleColor,rightLabel:t.oldStyleLabel||o.dmuCompareLoadingLabel})).inject(g),(d=u({leftLabel:o.dmuCompareCommonLabel,color:t.commonStyleColor,rightLabel:t.commonStyleLabel||null})).inject(g),"reduce"!==c){var p=e.createElement("div",{class:"DMU3DCompareButtonDiv"}).inject(m);new i({label:o.dmuCompareButtonLabel,emphasize:"secondary",onClick:function(){t.onClickCB&&t.onClickCB()}}).inject(p)}var f={id:"DMU3DComparePanel",className:"DMU3DComparePanel",title:t.title||o.dmuCompareTitle,icon:t.icon,immersiveFrame:t.immersiveFrame,content:l,closeButtonFlag:!1,minWidth:250,width:250,allowedDockAreas:WUXDockAreaEnum.RightDockArea|WUXDockAreaEnum.LeftDockArea,position:{at:"top right"}};return a=new n(f),this.displaying(h),l},this.clean=function(){if(l){for(;l.firstChild;)l.removeChild(l.firstChild);a&&a.clean(),l=a=null}},this.displaying=function(e){h=e,a&&a.setPanelVisibilityFlag(h)},this.updatePanel=function(e){l&&(e.firstLabel&&s&&(s.querySelector(".DMU3DCompareRightLabel").innerHTML=e.firstLabel),e.secondLabel&&r&&(r.querySelector(".DMU3DCompareRightLabel").innerHTML=e.secondLabel),e.thirdLabel&&r&&(d.querySelector(".DMU3DCompareRightLabel").innerHTML=e.secondLabel))};var u=function(t){var n=new e.Element("div",{class:"DMU3DCompareLine"});"reduce"!==c&&new e.Element("div",{class:"DMU3DCompareText DMU3DCompareLeftLabel",html:t.leftLabel}).inject(n),e.createElement("div",{class:"DMU3DCompareColorDot"}).inject(n).style.background=t.color;var i=new e.Element("div",{class:"DMU3DCompareText DMU3DCompareRightLabel",html:t.rightLabel});return i.inject(n),"reduce"===c&&i.setStyles({width:"calc(100% - 28px)"}),n}}})}),define("DS/DMUControls/EXPLevelSelector",["UWA/Class","DS/LevelSelector/LevelSelector","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUMeasurable/DMUToolsSceneGraph"],function(e,t,n,i,o){"use strict";return e.extend({init:function(e){var l=this;if(e&&(!e||e.iFrameWindow)){this.clean=function(){var e=t._noAnim;t._noAnim=!0,t.destroyView(),t._noAnim=e};var a=function(t,i){for(var l=[],a=e.iGetPathElementCB(),s=[],r=a.externalPath.length,d=0;d<r;++d){var c=a.getLastElement(!0);e.iFilterNodeCB(a)&&(l.push({pathElement:a.clone(),name:c.name,internalLevel:r-d}),s.push(c)),a=a.getParentPath()}if(!i){var h=n.getContextViewer({viewer:e.iFrameWindow.getViewer()});h&&o.getName(s,function(e){for(var n=0;n<e.length;++n)l[n].name=e[n];t()},h,"")}return l},s=function(t){e.iOnLevelHoverCB&&e.iOnLevelHoverCB(t)},r=function(t){d(e.iGet3DPositionCB,e.iGet2DPositionCB,e.iGetDelta2DPosition),e.iOnLevelSelectCB(t)};d(e.iGet3DPositionCB,e.iGet2DPositionCB,e.iGetDelta2DPosition)}function d(n,o,d){var c=o?o():i.getWindowPositionFromPoint(e.iFrameWindow.getViewer(),n(),e.iFrameWindow),h=d?d():{left:0,top:0},u={positionX:c.left+h.left,positionY:c.top+h.top,uiFrame:e.iFrameWindow.getUIFrame(),getLevels:a,onHover:s,onSelect:r};l.clean(),t.createView(u)}}})}),define("DS/DMUControls/panels/DMUGraphicPropertiesPanel",["UWA/Core","UWA/Class","DS/VisuEvents/EventsManager","DS/Visualization/ThreeJS_DS","DS/Controls/Tab","DS/Controls/ComboBox","DS/Controls/Label","DS/Controls/Slider","DS/Controls/SpinBox","DS/Controls/Button","DS/Controls/Toggle","DS/WebappsUtils/WebappsUtils","DS/CoreEvents/ModelEvents","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,l,a,s,r,d,c,h,u,m,g){"use strict";return t.extend({init:function(t){var p=t||{};this._parent(p);var f,v,C,w,y=this,b=h.getWebappsAssetUrl("DMUBaseCtxCommands","icons/32/"),D=0,S=[],x=[],E={fill:[],line:[],text:[]},k=[],M={fill:{colors:[],currentColor:null},line:{colors:[],currentColor:null},text:{colors:[],currentColor:null}},P=[{r:255,g:255,b:255},{r:204,g:9,b:47},{r:255,g:138,b:46},{r:254,g:224,b:0},{r:87,g:184,b:71},{r:0,g:0,b:0},{r:155,g:42,b:152},{r:0,g:37,b:150},{r:54,g:142,b:196},{r:71,g:119,b:56}],I=new u;function U(e,t){return I.publish({event:e,data:t,context:this})}function B(){var e;e=S[D],M[e].colors.forEach(t=>{t.div.setStyles({outline:M[e].currentColor&&t.color.equals(M[e].currentColor)?"4px #42a2da solid":""})}),E[e].forEach(t=>{t.div.setStyles({outline:M[e].currentColor&&new i.Color("#"+t.color).equals(M[e].currentColor)?"4px #42a2da solid":""})})}function F(e){let t=e.from[0].view.style.backgroundColor,n=new i.Color(t.split(" ").join(""));M[S[D]].currentColor=n,B(),U("fill"===S[D]?"onFillColorChanged":"line"===S[D]?"onLineColorChanged":"onTextColorChanged",n.getHex())}function _(t){M[t].colors.length=0;var o,l,a,s=new e.Element("div",{class:"DMU3DColorPalette"}),r=new e.Element("div",{class:"DMU3DColorContainer"}).inject(s);for(p.touchMode&&r.setAttributeNode(document.createAttribute("touch-mode")),o=0;o<5;o++)a="rgb("+P[o].r+","+P[o].g+","+P[o].b+")",(l=new e.Element("div",{class:"DMU3DColorSquare"}).inject(r)).style.background=a,p.touchMode&&l.setAttributeNode(document.createAttribute("touch-mode")),x.push(n.addEvent(l,"onPrimaryPointerClick",F)),M[t].colors.push({color:(new i.Color).setRGB(P[o].r/255,P[o].g/255,P[o].b/255),div:l});for(r=new e.Element("div",{class:"DMU3DColorContainer"}).inject(s),p.touchMode&&r.setAttributeNode(document.createAttribute("touch-mode")),o=5;o<10;o++)a="rgb("+P[o].r+","+P[o].g+","+P[o].b+")",(l=new e.Element("div",{class:"DMU3DColorSquare"}).inject(r)).style.background=a,p.touchMode&&l.setAttributeNode(document.createAttribute("touch-mode")),x.push(n.addEvent(l,"onPrimaryPointerClick",F)),M[t].colors.push({color:(new i.Color).setRGB(P[o].r/255,P[o].g/255,P[o].b/255),div:l});return s}function T(){var e=new d({label:g.customPanelTitle,icon:h.getWebappsAssetUrl("DMUBaseUI","images/")+"I_SwitchColorPalette.png"});return e.getContent().addClassName("DMUAddCustomColorButton"),e.getContent().addEventListener("buttonclick",function(){U("onCustomColorPanelRequired",M[S[D]].currentColor)}),e}this.setCustomColors=function(t){if(0===t.length){var o="rgb("+P[1].r+","+P[1].g+","+P[1].b+")";let e=new i.Color(o.split(" ").join(""));U("fill"===S[D]?"onFillColorChanged":"line"===S[D]?"onLineColorChanged":"onTextColorChanged",e.getHex()),B()}E.fill=t?t.map(e=>({color:e})):[],E.line=t?t.map(e=>({color:e})):[],E.text=t?t.map(e=>({color:e})):[],k.forEach(t=>{!function(t){for(;t.div.firstChild;)t.div.removeChild(t.div.firstChild);let i,o,l;if(t.tokens.forEach(e=>{n.removeEventFromToken(e)}),t.tokens.length=0,E[t.tab].length>0)for(i=new e.Element("div",{class:"DMU3DColorContainer"}).inject(t.div),p.touchMode&&i.setAttributeNode(document.createAttribute("touch-mode")),o=0;o<5;o++)E[t.tab][o]&&(l=new e.Element("div",{class:"DMU3DColorSquare"}).inject(i),p.touchMode&&l.setAttributeNode(document.createAttribute("touch-mode")),l.style.background="#"+E[t.tab][o].color,t.tokens.push(n.addEvent(l,"onPrimaryPointerClick",F)),E[t.tab][o].div=l);if(E[t.tab].length>5)for(i=new e.Element("div",{class:"DMU3DColorContainer"}).inject(t.div),p.touchMode&&i.setAttributeNode(document.createAttribute("touch-mode")),o=5;o<10;o++)E[t.tab][o]&&(l=new e.Element("div",{class:"DMU3DColorSquare"}).inject(i),p.touchMode&&l.setAttributeNode(document.createAttribute("touch-mode")),l.style.background="#"+E[t.tab][o].color,t.tokens.push(n.addEvent(l,"onPrimaryPointerClick",F)),E[t.tab][o].div=l)}(t)})},this.setCurrentColor=function(e){let t=new i.Color("#"+e);M[S[D]].currentColor=t,U("fill"===S[D]?"onFillColorChanged":"line"===S[D]?"onLineColorChanged":"onTextColorChanged",t.getHex()),B()},this.update=function(e){e&&(void 0!==e.isFilled&&C?(C.checkFlag="boolean"!=typeof e.isFilled||e.isFilled,C.mixedState=null===e.isFilled):void 0!==e.hasBorder&&w&&(w.checkFlag="boolean"!=typeof e.hasBorder||e.hasBorder,w.mixedState=null===e.hasBorder))},this.build=function(t){return f||(f=e.createElement("div",{class:"DMUGraphicPropertyDiv"}),v=new o({displayStyle:["strip"],centeredFlag:!1}).inject(f)),void 0===t.values.isFilled&&void 0===t.values.fillColor&&void 0===t.values.fillOpacity||(v.add({label:g.grpPanelFillTab,icon:{iconName:"fonticon wux-ui-3ds-paint-can-fill",fontIconFamily:1},isSelected:!0,content:function(t){var n=new e.Element("div",{class:"GraphicTabContent"});if(void 0!==t.fillColor){_("fill").inject(n),M.fill.currentColor=t.fillColor;let i=new e.Element("div",{class:"DMUGraphicPropCustomColorPaletteDiv"}).inject(n);p.touchMode&&i.setAttributeNode(document.createAttribute("touch-mode")),k.push({tab:"fill",div:i,tokens:[]})}if(void 0!==t.fillOpacity){var i=new e.Element("div",{class:"DMU3DSecondLayerDiv"}).inject(n),o=new s({value:"number"==typeof t.fillOpacity?100*(1-t.fillOpacity):null,minValue:0,maxValue:100,stepValue:1,displayStyle:"horizontal"}).inject(i);o.getContent().setStyles({width:"50%",display:"inline-block"});var l=new r({value:"number"==typeof t.fillOpacity?100*(1-t.fillOpacity):null,minValue:0,maxValue:100,decimals:0,stepValue:1,units:"%",pageStepValue:1}).inject(i);l.getContent().setStyles({width:"50%","min-width":"0px","vertical-align":"top"}),o.addEventListener("change",function(){l.value=o.value}),l.addEventListener("change",function(){o.value=l.value,U("onFillOpacityChanged",1-l.value/100)})}if(void 0!==t.isFilled){var a=new e.Element("div",{class:"DMU3DSecondLayerDiv"}).inject(n);(C=new c({type:"checkbox",label:g.grpFillLabel,checkFlag:"boolean"!=typeof t.isFilled||t.isFilled,mixedState:null===t.isFilled}).inject(a)).getContent().setStyles({"margin-left":"10px"}),C.addEventListener("change",function(){U("onFilledPropertyChanged",C.checkFlag)})}return void 0!==t.fillColor&&T().inject(n),n}(t.values)}),S.push("fill")),void 0===t.values.hasBorder&&void 0===t.values.lineColor&&void 0===t.values.thickness&&void 0===t.values.pattern&&void 0===t.values.lineOpacity||(v.add({label:g.grpPanelLineTab,icon:{iconName:"fonticon wux-ui-3ds-brush",fontIconFamily:1},isSelected:!1,content:function(t){var n,i=new e.Element("div",{class:"GraphicTabContent"});if(void 0!==t.lineColor){_("line").inject(i),M.line.currentColor=t.lineColor;let n=new e.Element("div",{class:"DMUGraphicPropCustomColorPaletteDiv"}).inject(i);p.touchMode&&n.setAttributeNode(document.createAttribute("touch-mode")),k.push({tab:"line",div:n,tokens:[]})}if(void 0!==t.lineOpacity){var o=new e.Element("div",{class:"DMU3DSecondLayerDiv"}).inject(i),d=new s({value:"number"==typeof t.lineOpacity?100*(1-t.lineOpacity):null,minValue:0,maxValue:100,stepValue:1,displayStyle:"horizontal"}).inject(o);d.getContent().setStyles({width:"50%",display:"inline-block"});var h=new r({value:"number"==typeof t.lineOpacity?100*(1-t.lineOpacity):null,minValue:0,maxValue:100,decimals:0,stepValue:1,units:"%",pageStepValue:1}).inject(o);h.getContent().setStyles({width:"50%","min-width":"0px","vertical-align":"top"}),d.addEventListener("change",function(){h.value=d.value}),h.addEventListener("change",function(){d.value=h.value,U("onLineOpacityChanged",1-h.value/100)})}if(void 0!==t.pattern){(n=new e.Element("div",{class:"DMU3DSecondLayerDiv"}).inject(i)).setStyle("text-align","center"),new a({value:g.LineType}).inject(n).getContent().setStyles({"text-align":"left",background:"none"});var u=new l({elementsList:[{label:g.solid,icon:b+"I_DMULineType_1.png"},{label:g.dotted,icon:b+"I_DMULineType_2.png"},{label:g.dashed,icon:b+"I_DMULineType_3.png"},{label:g.dotDashed,icon:b+"I_DMULineType_4.png"},{label:g.phantom,icon:b+"I_DMULineType_5.png"},{label:g.smallDots,icon:b+"I_DMULineType_6.png"},{label:g.jisAxis,icon:b+"I_DMULineType_7.png"}],selectedIndex:"number"==typeof t.pattern?t.pattern-1:-1,enableSearchFlag:!1}).inject(n);u.addEventListener("change",function(){U("onLineTypeChanged",u.selectedIndex+1)})}if(void 0!==t.thickness){(n=new e.Element("div",{class:"DMU3DSecondLayerDiv"}).inject(i)).setStyle("text-align","center"),new a({value:g.thickness}).inject(n).getContent().setStyles({"text-align":"left",background:"none"});var m=new l({elementsList:[{label:g.thickness1,icon:b+"I_DMULineThickness_1.png"},{label:g.thickness2,icon:b+"I_DMULineThickness_2.png"},{label:g.thickness3,icon:b+"I_DMULineThickness_3.png"},{label:g.thickness4,icon:b+"I_DMULineThickness_4.png"},{label:g.thickness5,icon:b+"I_DMULineThickness_5.png"},{label:g.thickness6,icon:b+"I_DMULineThickness_6.png"},{label:g.thickness7,icon:b+"I_DMULineThickness_7.png"},{label:g.thickness8,icon:b+"I_DMULineThickness_8.png"},{label:g.thickness9,icon:b+"I_DMULineThickness_16.png"},{label:g.thickness10,icon:b+"I_DMULineThickness_32.png"},{label:g.thickness11,icon:b+"I_DMULineThickness_64.png"}],selectedIndex:"number"==typeof t.thickness?t.thickness:-1,enableSearchFlag:!1}).inject(n);m.addEventListener("change",function(){U("onLineThicknessChanged",m.selectedIndex)})}return void 0!==t.hasBorder&&(n=new e.Element("div",{class:"DMU3DSecondLayerDiv"}).inject(i),(w=new c({type:"checkbox",label:g.grpBorderLabel,checkFlag:"boolean"!=typeof t.hasBorder||t.hasBorder,mixedState:null===t.hasBorder}).inject(n)).getContent().setStyles({"margin-left":"10px"}),w.addEventListener("change",function(){U("onHasBorderPropertyChanged",w.checkFlag)})),void 0!==t.lineColor&&T().inject(i),i}(t.values)}),S.push("line")),void 0===t.values.fontColor&&void 0===t.values.fontStyle&&void 0===t.values.fontSize||(v.add({label:g.grpPanelTextTab,icon:{iconName:"fonticon wux-ui-3ds-text",fontIconFamily:1},isSelected:!1,content:function(t){var n=new e.Element("div",{class:"GraphicTabContent"});if(void 0!==t.fontColor){_("text").inject(n),M.text.currentColor=t.fontColor;let i=new e.Element("div",{class:"DMUGraphicPropCustomColorPaletteDiv"}).inject(n);p.touchMode&&i.setAttributeNode(document.createAttribute("touch-mode")),k.push({tab:"text",div:i,tokens:[]})}var i=new e.Element("div",{class:"DMU3DSecondLayerDiv"}).inject(n);if(i.setStyle("text-align","center"),void 0!==t.fontSize){var o=t.fontSize,l=1,a=.5,s="mm",c=t.unitDetails;c&&c.unit&&("Inch"===c.unit||"Foot"===c.unit)&&(s="in",l=2,o=m.convert(o,"Length","Millimeter","Inch"),a=m.convert(a,"Length","Millimeter","Inch")),i.setStyles({"margin-bottom":"10px"});var h=new r({value:o,minValue:0,decimals:l,stepValue:a,units:s,pageStepValue:a}).inject(i);h.getContent().setStyles({width:"100px","vertical-align":"middle"}),h.addEventListener("change",function(){U("onFontSizeChanged","mm"===h.units?h.value:m.convert(h.value,"Length","Inch","Millimeter"))})}if(void 0!==t.fontStyle){var u=new d({type:"check",checkFlag:t.fontStyle&&-1!==t.fontStyle.indexOf("bold"),icon:{iconName:"fonticon wux-ui-3ds-text-bold",fontIconFamily:1}}).inject(i);u.getContent().addClassName("FontButton"),p.touchMode&&u.getContent().setStyles({width:"40px","min-width":"40px"});var g=new d({type:"check",checkFlag:t.fontStyle&&-1!==t.fontStyle.indexOf("italic"),icon:{iconName:"fonticon wux-ui-3ds-text-italic",fontIconFamily:1}}).inject(i);g.getContent().addClassName("FontButton"),p.touchMode&&g.getContent().setStyles({width:"40px","min-width":"40px"}),u.addEventListener("click",function(){var e="normal";u.checkFlag&&g.checkFlag?e="bold italic":u.checkFlag&&!g.checkFlag?e="bold":!u.checkFlag&&g.checkFlag&&(e="italic"),U("onFontStyleChanged",e)}),g.addEventListener("click",function(){var e="normal";u.checkFlag&&g.checkFlag?e="bold italic":u.checkFlag&&!g.checkFlag?e="bold":!u.checkFlag&&g.checkFlag&&(e="italic"),U("onFontStyleChanged",e)})}return void 0!==t.fontColor&&T().inject(n),n}(t.values)}),S.push("text")),t.customColors.length&&y.setCustomColors(t.customColors),B(),v.addEventListener("change",function(e){e&&e.dsModel&&e.dsModel.value&&e.dsModel===v&&(D=e.dsModel.value[0],U("onActiveTabChanged",{activeTab:S[D]}),B())}),t.activeTab&&-1!==S.indexOf(t.activeTab)&&S.length>S.indexOf(t.activeTab)?(v.value=[S.indexOf(t.activeTab)],D=S.indexOf(t.activeTab)):(v.value=[0],D=0),f},this.clean=function(){x.forEach(e=>{n.removeEventFromToken(e)}),x.length=0,v&&v.destroy(),f=v=null},this.subscribe=function(e,t){if(e&&t)return I.subscribe({event:e},t)},this.unsubscribe=function(e){null!=e&&I.unsubscribe(e)}}})}),define("DS/DMUControls/panels/DMUBookmarksPanel",["UWA/Core","UWA/Class","DS/CoreEvents/ModelEvents","UWA/Controls/ThemedScroller","DS/Utilities/TouchUtils","DS/CATWebUXComponents/CATWebUXSectionHeader","DS/CATWebUXComponents/CATWebUXButtonExpander","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,l,a,s){"use strict";return t.extend({init:function(){this._parent();var t,r,d,c,h,u,m=this,g=new n,p=o.getTouchMode()?18:14,f=o.getTouchMode()?16:12,v=function(e,t){return g.publish({event:e,data:t,context:this})};function C(e){u&&u!==e.div&&u.setHighlight(!1),u=e.div,e.div.setHighlight(!0),v("onBookmarkSelected",e)}function w(e){v("onBookmarkExpanded",e)}function y(e,t,n){if(e&&t){for(var i,o=0;o<e.length;o++)if(e[o].pointedPage<t)i=e[o];else{if(e[o].pointedPage!==t)break;if(!e[o].pointedPosition||e[o].pointedPosition.y>n)i=e[o];else{if(e[o].pointedPosition&&Math.abs(e[o].pointedPosition.y-n)<=1e-4)return e[o];if(e[o].pointedPosition&&e[o].pointedPosition.y<n)break}}return i}}function b(e){for(var t=h;t&&t.length;)t.forEach(function(t){t.view.setExpanded(e)}),t=t.reduce(function(e,t){return e.concat(t.items)},[]);w()}function D(e,t){return e?e.findIndex(function(e){return e.pointedId===t||D(e.items,t)>=0}):-1}this.buildPanel=function(n){m.cleanPanel(),t||(t=e.createElement("div",{id:"DMUBookmarksPanelMainDiv"})),t.setStyles({height:"100%"});var o=e.createElement("div",{class:"DMUBookmarksPanelSectionMainDiv"}).inject(t);o.setStyles({height:"100%"});var u=n.filter(function(e){return e.items.length});d=new l({draggable:!1,sectionLabel:s.bookmarksPanel.title,quickAccessBtnList:u.length?[{id:"ExpandAllButton",type:"toggle",initialFontIcon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-expand-all",alternativeFontIcon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-collapse-all",title:s.bookmarksPanel.expandOrCollapseAll,cb:b}]:[]}),o.appendChild(d.getContent());return c=e.createElement("div",{id:"DMUBookmarksPanelMainContainer",styles:{"background-color":"white",padding:"5px"}}),(r=(new i).inject(o)).getInnerElement().setContent(c),r.getContent().setStyle("height","calc(100% - 40px)"),h||(h=[]),function e(t,n,i,o){if(t&&t.length&&n&&o){var l=Math.max(i,f);t.forEach(function(t){var i={onClickData:t,displayExpander:t.items&&t.items.length>0,icon:t.icon,title:t.title,bold:t.bold,italic:t.italic,fontSize:l,onClickCB:C,onExpandCB:w},s=new a(i),r={view:s,pointedPage:t.pointedPage,pointedPosition:t.pointedPosition,pointedId:t.pointedId,items:[]};o.push(r),n.appendChild(s.getMainDiv()),e(t.items,s.getContentDiv(),l-1,r.items)})}}(n,c,p,h),1===h.length&&h[0].view.setExpanded(!0),h.sort(function(e,t){return e.pointedPage<t.pointedPage?-1:e.pointedPage>t.pointedPage?1:e.pointedPosition?t.pointedPosition?e.pointedPosition.y>t.pointedPosition.y?-1:e.pointedPosition.y<t.pointedPosition.y?1:0:1:-1}),t},this.highlightBookmark=function(e){if(e){var t,n;if(e.pageNumber&&e.yCoordinate)for(n=y(h,e.pageNumber,e.yCoordinate);n&&(t=n,n.view.isExpanded()&&n.items.length);)n=y(n.items,e.pageNumber,e.yCoordinate);else if(e.elementId){var i=D(h,e.elementId);for(i>=0&&(n=h[i]);n&&i>=0&&(t=n,n.view.isExpanded()&&n.items.length);)(i=D(n.items,e.elementId))>=0&&(n=n.items[i])}t?(u&&u.setHighlight(!1),t.view.setHighlight(!0),u=t.view):u&&(u.setHighlight(!1),u=null)}},this.subscribe=function(e,t){if(e&&t)return g.subscribe({event:e},t)},this.unsubscribe=function(e){null!=e&&g.unsubscribe(e)},this.cleanPanel=function(){if(t){for(u&&u.setHighlight(!1),h&&h.forEach(function(e){e.view.remove()});t.firstChild;)t.removeChild(t.firstChild);d&&d.clear(),r&&r.destroy(),h=g=d=r=t=u=null}}}})}),define("DS/DMUControls/DMUCustomExpander",["require","exports","UWA/Core","DS/Controls/Toggle","DS/Controls/LineEditor","DS/Utilities/TouchUtils","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,l){"use strict";return class{constructor(e){let t,a,s,r,d,c,h,u,m,g,p,f=e||{},v=this,C=l.getTouchMode(),w={},y=!1,b=!1,D=!1,S=!1,x=!0,E=!1,k=!0,M=!0,P=!1,I=!1,U=!1;function B(){if(U||!a||!m||!t||!r||!c||!h||!s||!u)return;C||b||(P||D?u.show():u.hide()),b&&(D=!1);let e=y&&a.firstChild;t.setStyles({outline:D?"2px solid #368ec4":e||P?"1px solid #c8c8c8":"","background-color":e||P?"rgba(40, 57, 106, 0.06)":"",height:e?"auto":"0px","grid-template-rows":e&&S?"28px calc(100% - 28px)":"18px calc(100% - 18px)"}),a.setStyles({opacity:e?1:0});let n=[],i=[],o=0;(w.icon||w.fontIcon)&&!S&&y&&n.push(25),!w.icon&&!w.fontIcon||y||n.push(25),a.firstChild&&E&&k?i.push(14):i.push(0),w.additionalDiv&&w.additionalDiv.additionalDiv1&&w.additionalDiv.additionalDiv2?(y?i.push(30):i.push(50),w.additionalDiv.additionalDiv2.setStyles({"padding-left":"3px","padding-right":"3px"})):w.additionalDiv&&(w.additionalDiv.additionalDiv1||w.additionalDiv.additionalDiv2)?y?i.push(30):i.push(31):y?i.push(30):i.push(0),n.forEach(e=>{o+=e}),i.forEach(e=>{o+=e});let l=n.length?n[0]+"px":"0px";l+=o?" calc(100% - "+o+"px)":"100%",i.length&&i.forEach(e=>{l+=" "+e+"px"}),r.setStyles({display:w.icon||w.fontIcon?"":"none"}),c.setStyles({display:a.firstChild&&E?"":"none"}),h.setStyles({display:w.additionalDiv&&k?"":"none"}),r.setStyles({display:M?"":"none"}),s.setStyles({"grid-template-columns":l,padding:y&&S?"0px 2px":"0px"})}this.build=(e=>{v.clear(),U=!0,w={icon:e.icon,fontIcon:e.fontIcon,fontIconColor:e.fontIconColor,label:e.label,additionalDiv:e.additionalDiv,body:e.body},(t=new n.Element("div",{class:"DMUCustomExpanderMainDiv"}))&&(t.dsModel=this,t.addEventListener("click",e=>{e.stopPropagation(),function(e){I?I=!1:(!x||e.shiftKey||e.ctrlKey||(y?v.collapse():v.expand()),e.ctrlKey&&!0===D?v.setSelectedFlag(!1,e):v.setSelectedFlag(!0,e))}(e)}),C||(t.addEventListener("mouseenter",()=>{P=!0,B()}),t.addEventListener("mouseleave",()=>{P=!1,B()})),(u=new n.Element("div",{class:"DMUCustomExpanderCheckBox"}).inject(t))&&(m=new i({type:"checkbox",checkFlag:D}).inject(u))&&(m.getContent().addClassName("checkBox"),m.getContent().getChildren()[0].setStyles({"margin-bottom":"0px"}),m.addEventListener("buttonclick",function(e){e.stopPropagation(),I=!0,v.setSelectedFlag(!D,e)}),(a=new n.Element("div",{class:"DMUCustomExpanderBody"}).inject(t))&&(e.body&&a.appendChild(e.body),s=new n.Element("div",{class:"DMUCustomExpanderHeader"}).inject(t),r=new n.Element("div",{class:"DMUCustomExpHeaderIconContainer"}).inject(s),d=new n.Element("div",{class:"DMUCustomExpHeaderLabelContainer"}).inject(s),e.checkEditMode&&(g=e.checkEditMode),e.highlightEditMode&&(p=e.highlightEditMode),g&&g.canEditState&&y?d.setStyles({"grid-column":"1 / span 2","padding- left":"1px"}):d.setStyles({"grid-column":"2"}),c=new n.Element("div",{class:"DMUCustomExpHeaderExpCollapseContainer"}).inject(s),new n.Element("div",{class:"DMUCustomExpHeaderExpIcon wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds "+(y?"wux-ui-3ds-resize-small":"wux-ui-3ds-resize-full")}).inject(c),c&&c.addEventListener("click",e=>{e.stopPropagation(),y?this.collapse():this.expand()}),h=new n.Element("div",{class:"DMUCustomExpHeaderAddDivContainer"}).inject(s),v.setIcon({icon:e.icon,fontIcon:e.fontIcon,fontIconColor:e.fontIconColor}),v.setLabel(e.label),v.setAdditionalDiv(e.additionalDiv),U=!1,B())))}),this.getContent=(()=>t),this.setIcon=(e=>{if(r){for(w.icon=e?e.icon:"",w.fontIcon=e?e.fontIcon:"";r.firstChild;)r.removeChild(r.firstChild);if(w.icon)new n.Element("img",{class:"DMUCustomExpHeaderIcon",src:w.icon}).inject(r);else if(w.fontIcon){let e=new n.Element("div",{class:"DMUCustomExpHeaderFontIcon wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds "+w.fontIcon}).inject(r);w.fontIconColor&&e.setStyles({color:w.fontIconColor})}B()}}),this.setLabel=(e=>{if(d){for(;d.firstChild;)d.removeChild(d.firstChild);if(S&&!b){let t=new o({value:e,selectAllOnFocus:!0,displayClearFieldButtonFlag:!1}).inject(d);t.addEventListener("change",function(){w.label=t.value,f.onLabelChanged&&f.onLabelChanged({value:w.label,type:"name"})}),t.elements.inputField.setStyles({width:"111%"}),t.getContent().title=e}else{y?(g&&g.canEditState||p&&p.canEditPriority)&&(d.style.cssText="grid-column: 1 / span 2; padding-left: 1px;"):d.style.gridColumn="2";let t=new n.Element("p",{class:"DMUCustomExpHeaderLabel"}).inject(d);t.innerText=e,t.title=e}w.label!==e&&f.onLabelChanged&&f.onLabelChanged({value:e,type:"name"}),w.label=e,B()}}),this.setAdditionalDiv=(e=>{if(!h)return;let t;for(e&&((t=new n.Element("div",{class:"finalAdditionalDiv"})).setStyles({display:"flex"}),e.additionalDiv1&&e.additionalDiv2?(e.additionalDiv1.inject(t),e.additionalDiv2.inject(t)):e.additionalDiv1?e.additionalDiv1.inject(t):e.additionalDiv2&&e.additionalDiv2.inject(t)),w.additionalDiv=e;h.firstChild;)h.removeChild(h.firstChild);t&&h.appendChild(t),B()}),this.setAdditionalDivVisibleFlag=(e=>{k=e,B()}),this.setCheckBoxClickedFlag=(e=>{I=e,B()}),this.setExpandOrCollapseButtonVisibleFlag=(e=>{E=e,B()}),this.setLabelEditionFlag=(e=>{S=e,v.setLabel(w.label)}),this.setHeaderIconVisibleFlag=(e=>{M=e,B()}),this.expandOrCollapseAtClick=(e=>{x=e}),this.setSelectedFlag=((e,t)=>{e===D&&t&&!t.ctrlKey||(e!==D&&(D=e),m&&(m.checkFlag=D,B()),f.onSelectedFlagChanged&&f.onSelectedFlagChanged({state:D,event:t}))}),this.setSelectionVisibility=(e=>{e!==D&&(D=e),m&&(m.checkFlag=D,B())}),this.setReadOnly=(e=>{b!==e&&(b=e,B())}),this.expand=(()=>{!y&&(y=!0,f.onExpandOrCollapse&&f.onExpandOrCollapse({object:v,state:y}),B(),c&&c.setStyles({"grid-column":"3"}),c&&c.getElementsByClassName("DMUCustomExpHeaderExpIcon").length)&&(c.getElementsByClassName("DMUCustomExpHeaderExpIcon")[0].className="DMUCustomExpHeaderExpIcon wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-resize-small")}),this.collapse=(()=>{y&&(y=!1,f.onExpandOrCollapse&&f.onExpandOrCollapse({object:v,state:y}),B(),c&&c.setStyles({"grid-column":"4"}),c&&c.getElementsByClassName("DMUCustomExpHeaderExpIcon").length)&&(c.getElementsByClassName("DMUCustomExpHeaderExpIcon")[0].className="DMUCustomExpHeaderExpIcon wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-resize-full")}),this.clear=(()=>{w={},t=m=a=void 0,I=P=!1}),this.isCheckBoxClicked=(()=>I),this.isSelected=(()=>D),this.isReadOnly=(()=>b),this.isExpanded=(()=>y)}}}),define("DS/DMUControls/DMUThumbnailChooser",["UWA/Core","UWA/Class","DS/CATWebUXComponents/CATWebUXThumbnail","UWA/Controls/ThemedScroller","DS/VisuEvents/EventsManager","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o){"use strict";var l=t.extend({init:function(t){var n,i,l=t||{};if(this._parent(l),this.inject=function(e){return n.inject(e),this},this.clear=function(){o.removeEvent(n,"onPrimaryPointerClick",i)},n=e.createElement("div",{class:"DMUAdditionalCommand"}),l.icon){var a=e.createElement("img",{src:l.icon}).inject(n);a.setStyles({width:"22px",height:"22px"}),a.ondragstart=function(){return!1}}i=function(){l.cb()};var s=e.createElement("p").inject(n);s.innerHTML=l.nls,s.title=l.nls,o.addEvent(n,"onPrimaryPointerClick",i)}});return t.extend({init:function(t){var o=t||{};this._parent(o);var a,s,r=this,d=[],c=[];this.build=function(t){var o;r.clean(),a=e.createElement("div",{class:"DMUThumbnailChooserMainDiv"}),(s=(new i).inject(a)).getContent().setStyle("height","100%");var h=e.createElement("div",{class:"DMUThumbnailScrollerContainer"});s.getInnerElement().setContent(h);var u=e.createElement("div",{class:"DMUThumbnailChooserMainContainer"}).inject(h);if(!t||!t.thumbnailData)return a;var m,g=function(e){for(o=0;o<d.length;o++)d[o].setDisplayFlag(d[o].getThumbnailID()===e.id);t.onThumbnailSelectedCB&&t.onThumbnailSelectedCB({id:e.id})};for(o=0;o<t.thumbnailData.length;o++)m=new n({id:t.thumbnailData[o].id,icon:t.thumbnailData[o].icon,width:208,height:121,title:t.thumbnailData[o].title,preview:t.thumbnailData[o].preview,displayFlag:t.thumbnailData[o].isSelected,clickCB:g}).inject(u),d.push(m);if(t.additionalCommands)for(o=0;o<t.additionalCommands.length;o++){var p=new l(t.additionalCommands[o]);p.inject(h),c.push(p)}return a.setStyles({width:r.getWidth()+"px",height:r.getHeight()+"px"}),a},this.getHeight=function(){var e=c?40*c.length:0;return d.length<=3?e+121:d.length<=6?e+242:e+363},this.getWidth=function(){return 1===d.length?208:2===d.length?416:624},this.getContent=function(){return a},this.clean=function(){for(var e=0;e<d.length;e++)d[e].clear();d.length=0,s&&s.destroy(),a=s=null}}})}),define("DS/DMUControls/panels/DMUDocumentPanel",["UWA/Core","DS/Windows/Dialog","DS/Controls/Button","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","UWA/Class","i18n!DS/DMUControls/assets/nls/DMUControls"],function(e,t,n,i,o,l,a,s){"use strict";return a.extend({init:function(a){this._parent(a);let r,d=this;this.build=function(c,h,u){if(d.destroy(),a.immersiveFrame&&c&&c.data&&c.title){let d=new e.Element("div"),v=s.documentPanel?s.documentPanel:{};"delete"===c.mode&&new e.Element("div",{html:"<p>"+v.documentDelete+"</p><p>"+v.documentReroute+"</p>"}).inject(d);var m=new o;c.data.forEach(function(e){m.addRoot(new l({label:e.title,grid:e}))});var g=[{text:v.documentTitle,dataIndex:"tree"}];c.displayRevisions&&g.push({text:v.documentRevision,dataIndex:"revision"}),g=g.concat([{text:v.documentModificationDate,dataIndex:"modifiedDate"},{text:v.documentCreationDate,dataIndex:"creationDate"}]);var p=new i({identifier:"DMUDocumentPanelDataGrid",treeDocument:m,columns:g,rowSelection:"single",cellSelection:{defaultValue:"none"},rowDragEnabledFlag:!1,allowUnsafeHTMLContent:!1,cellDragEnabledFlag:!1,activateAllCellsRenderedEventFlag:!0,showRowBorderFlag:!0,placeholder:"",recId:"DMUDocumentPanelDataGrid",position:"relative"});if("delete"===c.mode){var f=e.createElement("div",{styles:{position:"relative",height:150,margin:"10px 0px"}});p.inject(f),f.inject(d)}else p.inject(d);let C=new n({label:v.okLabel,onClick:function(){var e=p.getTreeDocument().getSelectedNodes();if(e&&e.length){var t=e[0].options.grid.versions;h(e[0].options.grid.fileId,t),r&&r.destroy(),r=null}}}),w=new n({label:v.cancelLabel,onClick:function(){r&&r.close()}});(r=new t({identifier:"dialog",modalFlag:!0,title:c.title,content:d,height:200,width:650,position:{my:"center",at:"center"},resizableFlag:!0,immersiveFrame:a.immersiveFrame,buttons:{Ok:C,Cancel:w}})).addEventListener("close",function(){u&&u(),r&&r.destroy(),r=null})}},this.destroy=function(){r&&r.destroy(),r=null}}})}),define("DS/DMUControls/DMUOptionsPanel",["UWA/Core","UWA/Class","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Toggle","i18n!DS/DMUControls/assets/nls/DMUControls"],function(e,t,n,i,o,l){"use strict";return t.extend({init:function(t){var a=t||{};if(this._parent(a),a.frmWindow&&a.options&&a.options.length&&a.cb){var s,r=e.createElement("div",{class:"DMUPasteSpecialPanelMainDiv"}),d=[];if(t.options&&t.options.length)for(var c=0;c<t.options.length;c++)d.push(new o({label:t.options[c].nls,value:t.options[c].id,type:"checkbox",checkFlag:t.options[c].value}).inject(r));var h={};h.Ok=new i({emphasize:"primary",onClick:function(){u(!1)}}),h.Abort=new i({label:l.cancelButton,onClick:function(){s.close?s.close():s.destroy()}}),a.prefs&&a.prefs.applyButtonNls&&(h.Apply=new i({onClick:function(){u(!0)}})),s=new n({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:t.panelTitle,content:r,immersiveFrame:a.frmWindow.getImmersiveFrame(),buttons:h})}function u(e){for(var t={},n=0;n<d.length;n++)t[d[n].value]=d[n].checkFlag;a&&a.cb&&a.cb(t,e),e||(s.close?s.close():s.destroy())}}})});var __classPrivateFieldSet=this&&this.__classPrivateFieldSet||function(e,t,n,i,o){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?o.call(e,n):o?o.value=n:t.set(e,n),n},__classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};define("DS/DMUControls/DMUCommentFilterView",["require","exports","UWA/Core","DS/Controls/Button","DS/Controls/ButtonGroup","DS/Controls/Toggle","DS/Controls/Expander","DS/DMUBaseUIComponents/DMURichTextServices","DS/DMUBaseUI/DMUToolsUsers","i18n!DS/DMUControls/assets/nls/DMUControls"],function(e,t,n,i,o,l,a,s,r,d){"use strict";var c,h;const u={1:{id:"1",order:0,label:d.reviewPanel.noPriorityDefined},2:{id:"2",order:4,label:d.reviewPanel.highlightRatingLow,icon:"wux-ui-3ds-level-low",color:"rgb(71,119,56)"},3:{id:"3",order:3,label:d.reviewPanel.highlightRatingMedium,icon:"wux-ui-3ds-level-medium",color:"rgb(232,123,0)"},4:{id:"4",order:2,label:d.reviewPanel.highlightRatingHigh,icon:"wux-ui-3ds-level-high",color:"rgb(234,79,55)"},5:{id:"5",order:5,label:d.reviewPanel.highlightRatingProcessed,icon:"wux-ui-3ds-check",color:"rgb(71, 119, 56)"},6:{id:"6",order:1,label:d.reviewPanel.highlightRatingUrgent,icon:"wux-ui-3ds-alert",color:"rgb(153, 7, 7)"}},m={today:{id:"today",label:d.today,order:1},yesterday:{id:"yesterday",label:d.yesterday,order:2},thisWeek:{id:"thisWeek",label:d.thisWeek,order:3},lastWeek:{id:"lastWeek",label:d.lastWeek,order:4},older:{id:"older",label:d.older,order:5}},g={noHighlight:{id:"noHighlight",label:d.noHighlight,order:1},withIssue:{id:"withIssue",label:d.withIssue,icon:"wux-ui-3ds-issue-type",order:2},withoutIssue:{id:"withoutIssue",label:d.withoutIssue,icon:"wux-ui-3ds-highlight-review",order:3}},p={noImpactedCheck:{id:"noImpactedCheck",label:d.noImpactedCheck,order:1},impactedCheck:{id:"impactedCheck",label:d.impactedCheck,icon:"wux-ui-3ds-check-review",order:2}};function f(e){const t=new Date;return e.toDateString()===t.toDateString()?m.today:e.toDateString()===new Date((new Date).setDate(t.getDate()-1)).toDateString()?m.yesterday:e.getTime()>=new Date(new Date((new Date).setDate(t.getDate()-(t.getDay()+6)%7)).toDateString()).getTime()?m.thisWeek:e.getTime()>=new Date(new Date((new Date).setDate(t.getDate()-(t.getDay()+6)%7-7)).toDateString()).getTime()?m.lastWeek:m.older}const v=[{id:"what",label:d.filterCommentSections.What,icon:"wux-ui-3ds-6w-what",sortMethod:(e,t)=>u[e.id].order-u[t.id].order},{id:"who",label:d.filterCommentSections.Who,icon:"wux-ui-3ds-6w-who",sortMethod:(e,t)=>e.label===d.me?-1:t.label===d.me?1:e.label>=t.label?1:-1},{id:"when",label:d.filterCommentSections.When,icon:"wux-ui-3ds-6w-when",sortMethod:(e,t)=>m[e.id].order-m[t.id].order},{id:"where",label:d.filterCommentSections.Where,icon:"wux-ui-3ds-6w-where",sortMethod:(e,t)=>e.label>=t.label?1:-1},{id:"how",label:d.filterCommentSections.How,icon:"wux-ui-3ds-6w-how",sortMethod:(e,t)=>g[e.id].order-g[t.id].order},{id:"why",label:d.filterCommentSections.Why,icon:"wux-ui-3ds-6w-why",sortMethod:(e,t)=>p[e.id].order-p[t.id].order}],C=(e,t)=>{if(s.getMentionsFromContent(e.content).forEach(e=>{const n=e.id===r.getUserLogin();t.who.some(t=>t.id===e.id)||t.who.push({id:e.id,label:n?d.me:e.name+` (${e.id.toUpperCase()})`,image:r.getUserImageURL(e.id)})}),!t.who.some(t=>t.id===e.owner.login)){const n=e.owner.login===r.getUserLogin();t.who.push({id:e.owner.login,label:n?d.me:(e.owner.name||e.owner.login)+` (${e.owner.login.toUpperCase()})`,image:e.owner.imageUrl})}},w=(e,t)=>{const n=f(new Date(e.dateInMs));t.when.some(e=>e.id===n.id)||t.when.push(n)};class y{static build(e,t,s){const r=[],m={what:[],who:[],when:[],where:[],how:[],why:[]};let f=structuredClone(t);__classPrivateFieldSet(y,c,n.createElement("div",{id:"DMUCommentsPanelFilterView",class:"DMUCommentsPanelFilter-main"}),"f",h),e.forEach(({commentData:e})=>{var t,n;e.highlights&&e.highlights.length?e.highlights.forEach(e=>{m.what.some(t=>t.id===u[e.rating].id)||m.what.push(u[e.rating])}):m.what.some(e=>e.id===u[1].id)||m.what.push(u[1]),C(e,m),null===(t=e.replies)||void 0===t||t.forEach(e=>C(e,m)),w(e,m),null===(n=e.replies)||void 0===n||n.forEach(e=>w(e,m)),e.markupName&&!m.where.some(t=>t.id===e.markupName)&&m.where.push({id:e.markupName,label:e.markupName});const i=e.highlights&&e.highlights.length?e.highlights.some(e=>e.hasIssue)?g.withIssue:g.withoutIssue:g.noHighlight;m.how.some(e=>e.id===i.id)||m.how.push(i);const o=e.highlights&&e.highlights.length&&e.highlights.some(e=>e.hasImpactedChecks)?p.impactedCheck:p.noImpactedCheck;m.why.some(e=>e.id===o.id)||m.why.push(o)}),Object.keys(m).forEach(e=>{var t;m[e].sort(null===(t=v.find(t=>t.id===e))||void 0===t?void 0:t.sortMethod)});let b=n.createElement("div",{class:"DMUCommentsPanelFilterExpanders"}).inject(__classPrivateFieldGet(y,c,"f",h));v.forEach(e=>{if(!m[e.id].length)return;let i=n.createElement("div",{styles:{display:"flex","align-items":"center",gap:"5px"}});n.createElement("i",{class:`${e.icon} wux-ui-3ds`}).inject(i);let s=new o({type:"checkbox"});m[e.id].forEach(i=>{var o;const a=n.createElement("div",{class:"DMUCommentsPanelFilter-content"});if(i.image){let e=n.createElement("img",{class:"DMUCommentsPanelFilter-content-image",src:i.image,events:{error:function(){e&&a.removeChild(e);let t=n.createElement("i",{class:"wux-ui-3ds wux-ui-3ds-user DMUCommentsPanelFilter-content-image"});a.insertBefore(t,a.firstElementChild)}}}).inject(a)}i.icon&&n.createElement("i",{class:`${i.icon} wux-ui-3ds`,styles:{color:i.color}}).inject(a),n.createElement("span",{class:"DMUCommentsPanelFilter-content-label",text:i.label}).inject(a);const d=new l({type:"checkbox",label:a,allowUnsafeHTMLLabel:!0,value:0,checkFlag:(null===(o=t[e.id])||void 0===o?void 0:o.includes(i.id))||!1});d.addEventListener("change",()=>{var t,n,o,l;d.checkFlag?(f[e.id]||(f[e.id]=[]),null===(t=f[e.id])||void 0===t||t.push(i.id)):(null===(n=f[e.id])||void 0===n||n.splice((null===(o=f[e.id])||void 0===o?void 0:o.indexOf(i.id))||0,1),(null===(l=f[e.id])||void 0===l?void 0:l.length)||delete f[e.id])}),r.push(d),s.addChild(d)});const d=new a({header:e.label,expandedFlag:"false"!==localStorage.getItem("DMUCommentsPanelFilterView-"+e.id),body:s,customHeader:i});d.inject(b),d.addEventListener("expand",function(){localStorage.setItem("DMUCommentsPanelFilterView-"+e.id,"true")}),d.addEventListener("collapse",function(){localStorage.setItem("DMUCommentsPanelFilterView-"+e.id,"false")})});const D=n.createElement("div",{class:"DMUCommentsPanelFilter-buttons"}).inject(__classPrivateFieldGet(y,c,"f",h)),S=n.createElement("button",{class:"DMUCommentsPanelFilter-buttons-reset",text:d.snapshotReset});S.inject(D),S.addEventListener("click",function(){r.forEach(e=>e.checkFlag=!1),f={}});const x=new i({label:d.documentPanel.okLabel,emphasize:"primary"});x.inject(D),x.addEventListener("buttonclick",function(){s.onOk(f)});const E=new i({label:d.documentPanel.cancelLabel,emphasize:"secondary"});return E.inject(D),E.addEventListener("buttonclick",function(){s.onCancel()}),__classPrivateFieldGet(y,c,"f",h)}static commentMatchesFilters(e,t){return Object.keys(t).every(n=>{var i,o,l,a,r,d,c;if("what"===n)return e.highlights&&e.highlights.length?null===(o=e.highlights)||void 0===o?void 0:o.some(e=>{var i;return null===(i=t[n])||void 0===i?void 0:i.includes(e.rating.toString())}):(null===(i=t[n])||void 0===i?void 0:i.includes(u[1].id))&&!e.isReply;if("who"===n){if(null===(l=t[n])||void 0===l?void 0:l.includes(e.owner.login))return!0;return s.getMentionsFromContent(e.content).some(e=>{var i;return null===(i=t[n])||void 0===i?void 0:i.includes(e.id)})}return"when"===n?null===(a=t[n])||void 0===a?void 0:a.includes(f(new Date(e.dateInMs)).id):"where"===n?e.markupName&&(null===(r=t[n])||void 0===r?void 0:r.includes(e.markupName)):"how"===n?e.highlights&&e.highlights.length?e.highlights.some(e=>{var i;return null===(i=t[n])||void 0===i?void 0:i.includes(e.hasIssue?g.withIssue.id:g.withoutIssue.id)}):(null===(d=t[n])||void 0===d?void 0:d.includes(g.noHighlight.id))&&!e.isReply:"why"===n?e.highlights&&e.highlights.length?e.highlights.some(e=>{var i,o;return e.hasImpactedChecks&&(null===(i=t[n])||void 0===i?void 0:i.includes(p.impactedCheck.id))||!e.hasImpactedChecks&&(null===(o=t[n])||void 0===o?void 0:o.includes(p.noImpactedCheck.id))}):(null===(c=t[n])||void 0===c?void 0:c.includes(p.noImpactedCheck.id))&&!e.isReply:void 0})}static destroy(){__classPrivateFieldGet(y,c,"f",h)&&(__classPrivateFieldGet(y,c,"f",h).destroy(),__classPrivateFieldSet(y,c,null,"f",h))}}return c=y,h={value:null},y}),define("DS/DMUControls/panels/DMUSlidesPanel",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS","DS/CoreEvents/ModelEvents","DS/CATWebUXComponents/CATWebUXThumbnail","UWA/Controls/ThemedScroller","DS/Controls/Expander","DS/Utilities/TouchUtils","DS/VisuEvents/EventsManager","DS/CATWebUXComponents/CATWebUXSectionHeader","DS/Menu/ContextualMenu","DS/DMUBaseUI/DMUToolsUsers","DS/Controls/TooltipModel","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,l,a,s,r,d,c,h,u,m){"use strict";let g,p;const f={1:{icon:"wux-ui-3ds-attention",color:"#007DA3"},2:{icon:"wux-ui-3ds-level-low",color:"rgb(71,119,56)"},3:{icon:"wux-ui-3ds-level-medium",color:"rgb(232,123,0)"},4:{icon:"wux-ui-3ds-level-high",color:"rgb(234,79,55)"},5:{icon:"wux-ui-3ds-check",color:"rgb(71, 119, 56)"},6:{icon:"wux-ui-3ds-alert",color:"rgb(153, 7, 7)"}};let v=a.extend({init:function(t){let n=t||{};if(n.onMarkupCtxMenuCB){n.customHeader||(n.customHeader=e.createElement("div",{class:"DMUBrowserSectionCustomHeader"}));const i=e.createElement("div",{class:"DMUBrowserSectionMenuButton"}).inject(n.customHeader);i.appendChild(e.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-menu-dot"})),i.addEventListener("click",function(e){e.stopPropagation(),t.onMarkupCtxMenuCB({id:t.id,event:e})})}this._parent(n);let i,o,l=!1,a=e.createElement("div",{class:"DMUBrowserSectionShadingCol"}),s=this,d=!1,g=[],p=!1,f="",v=e.createElement("div",{class:"DMUBrowserSectionReplySection"}),C=e.createElement("div",{class:"DMUReplySubSectionHeaderDiv"}).inject(v);C.setStyle("padding-left","10px");let w=e.createElement("div",{class:"DMUReplySubSectionArrow wux-ui-3ds wux-ui-3ds-expand-right"}).inject(C),y=e.createElement("p",{class:"DMUReplySubSectionHeaderText"}).inject(C);y.setText(m.showMoreLabel);let b=r.addEvent(C,"onPrimaryPointerClick",function(){s.setReplySectionExpandedFlag(!p)});if(this.addChild=function(e,t){null!=t?s.body.insertBefore(e,s.body.children[t]):(e.inject(s.body),g.length&&(s.body.removeChild(v),s.body.appendChild(v)))},this.getChildIndex=function(e){return Array.prototype.indexOf.call(s.body.children,e)},this.removeChild=function(e){s.body.removeChild(e)},this.setNoDiv=function(e){e?(s.body.appendChild(e),o=e):s.body.contains(o)&&s.body.removeChild(o)},this.getContent=function(){return this.elements.container},this.setShadingColor=function(e){l=e,a.setStyle("background-color",l?"rgb(87, 184, 71)":"")},this.addReply=function(e){g.push(e),v.appendChild(e.getContent()),g.length&&s.body.appendChild(v),e.setVisibleFlag(p)},this.setReplySectionExpandedFlag=function(e){if(p!==e){p=e;for(let e=g.length-1;e>=0;e--)g[e].setVisibleFlag(p);y.setText(p?m.showLessLabel:m.showMoreLabel),p?(w.hasClassName("wux-ui-3ds-expand-right")&&w.removeClassName("wux-ui-3ds-expand-right"),w.addClassName("wux-ui-3ds-expand-down")):(w.hasClassName("wux-ui-3ds-expand-down")&&w.removeClassName("wux-ui-3ds-expand-down"),w.addClassName("wux-ui-3ds-expand-right"))}},this.getReplySectionExpandedFlag=function(){return p},this.removeReply=function(e){-1!==g.indexOf(e)&&g.splice(g.indexOf(e,1)),v.removeChild(e.getContent()),g.length||s.body.removeChild(v)},this.setActiveMarkup=function(e){d=e,s.elements.header.setStyles({color:!s.expandedFlag&&d?"#368ec4":""})},this.setCtxMenuVisibility=function(e){n.customHeader&&n.customHeader.setStyle("display",e?"":"none")},this.clear=function(){i&&c.removeEventListener(this.elements.header,i),r.removeEventFromToken(b),i=b=null},this.setTitle=function(e){this.headerTooltipInfos||(this.headerTooltipInfos=new u({title:n.name})),this.headerTooltipInfos.title=f?`${e} - ${f}`:e,s.header=e},this.body=e.createElement("div",{class:"DMUBrowserSectionThumbsMainContainer DMUSlidePanelMarkupDiv"}),this.elements.header.appendChild(a),this.style="simple",this.icon=n.icon,n.onMarkupCtxMenuCB&&(i=c.addEventListener(this.elements.header,{callback:function(e){n.onMarkupCtxMenuCB({id:n.id,event:e.data.event})}})),n.children&&n.children.length)for(let e=0;e<n.children.length;e++)s.addChild(n.children[e].getContent());this.getContent().addEventListener("expand",function(){s.elements.header.setStyle("color",""),a.setStyle("display","none")}),this.getContent().addEventListener("collapse",function(){d&&s.elements.header.setStyle("color","#368ec4"),a.setStyle("display","")}),this.getContent().addClassName("DMUMarkupExpander"),this.expand(),this.setTitle(n.name),n.owner&&(f=n.owner,h.getUserName(n.owner).then(t=>{f=t,this.headerTooltipInfos.title=`${n.name} - ${t}`,n.customHeader||(n.customHeader=e.createElement("div",{class:"DMUBrowserSectionCustomHeader"}));const i=e.createElement("span",{class:"DMUBrowserSectionThumbsMarkupName",text:t});n.customHeader.firstElementChild?n.customHeader.insertBefore(i,n.customHeader.firstElementChild):n.customHeader.appendChild(i)}))}}),C=t.extend({init:function(t){let n=t||{};this._parent(n);let i,o,l,a,d,c,h,u,f,C,w,y,b=null,D=null,S=null,x=e.createElement("div",{class:"DMUBrowserNoSlidesTitleDiv"}),E=!1,k=this,M=[],P=e.createElement("div",{id:"DMUDraggableThumbnailDiv",class:"DMUDraggableThumbnailDiv"}),I=!1,U=!0,B=[],F=!!n.allowSlideReorder&&n.allowSlideReorder,_=!1===n.webMarkup,T=!1,R=0;const j=10*window.devicePixelRatio;function A(e){(("Escape"===e.key||27===e.keyCode)&&"keydown"===e.type||"keyup"===e.type&&"Shift"===e.key)&&(c&&(c.setStyles({"padding-top":"","padding-bottom":""}),c=null),h=!0,V())}function N(e){(!e.shiftKey&&C||e.shiftKey&&!C)&&(w=!0,setTimeout(function(){w=!1},400))}function L(n){if(w)return void(w=!1);if(f){let e=document.querySelector(".DMUSlidePanelThumbMainContainer");e&&(e.addEventListener("touchstart",H,!1),e.addEventListener("touchmove",H,!1))}h=!1,document.querySelector(".DMUBrowserThumbsMainContainer.DMUSlidePanelMarkupDiv")?y=document.querySelector(".DMUBrowserThumbsMainContainer.DMUSlidePanelMarkupDiv").parentElement.parentElement:document.querySelector(".DMUBrowserSectionThumbsMainContainer.DMUSlidePanelMarkupDiv")&&(y=document.querySelector(".DMUBrowserSectionThumbsMainContainer.DMUSlidePanelMarkupDiv").parentElement.parentElement.parentElement.parentElement.parentElement);let i=n.from[0].view.closest(".DMUSlideAndReplyMainDiv"),o=M.find(function(e){return e.getContent()===i});if(!o||o.isInEdition())return;document.addEventListener("keydown",A),document.addEventListener("keyup",A),o.isChecked()?M.forEach(function(e){e.isChecked()&&B.push(e)}):B.push(o);let l=o.getContent().getPosition(document.body),a=n.from[0].getCurrentPosition(document.body);u={x:l.x-a.x,y:l.y-a.y},B.forEach(function(e){let t=e.getContent(),n=t.getPosition(document.body),i=t.firstChild.cloneNode(!0);t.setStyle("display","none"),i.removeChild(i.firstElementChild),i.style.opacity=.8,i.style.left=n.x-a.x+"px",i.style.top=n.y-a.y+"px",i.style.position="absolute",i.classList.add("DMUAnimateDrag"),i.addEventListener("transitionend",function(){i.classList.remove("DMUAnimateDrag")},{once:!0}),P.appendChild(i)}),B.length>1&&e.createElement("div",{id:"DMUDragThumbnailCount",class:"DMUDragThumbnailCount",text:B.length}).inject(P),P.setStyle("transform",`translate(${a.x}px, ${a.y}px)`),document.body.appendChild(P),U=!0,t.onSlidesDragStart()}function V(){if(f){let e=document.querySelector(".DMUSlidePanelThumbMainContainer");e&&(e.removeEventListener("touchstart",H),e.removeEventListener("touchmove",H)),r.removeEvent(f,"onPrimaryPointerMoveUnique",W),r.removeEvent(f,"onPrimaryPointerUpUnique",V),f=null}if(T=!1,y=null,B.length){for(document.removeEventListener("keydown",A),document.removeEventListener("keyup",A),document.body.contains(P)&&document.body.removeChild(P),P.setStyles({transform:""});P.children.length;)P.removeChild(P.firstElementChild);if(B.forEach(function(e){let t=e.getContent();t.setStyle("display",""),t.remove()}),c){let e;b?(e=b.getChildIndex(c),B.forEach(function(t,n){b.addChild(t.getContent(),(I?e:e+1)+n)})):(e=Array.prototype.indexOf.call(D.children,c),B.forEach(function(t,n){let i=t.getContent();I?D.insertBefore(i,c):D.insertBefore(i,D.children[e+n+1])})),M.sort(function(e,t){let n,i;return b?(n=b.getChildIndex(e.getContent()),i=b.getChildIndex(t.getContent())):(n=Array.prototype.indexOf.call(D.children,e.getContent()),i=Array.prototype.indexOf.call(D.children,t.getContent())),n<i?-1:n>i?1:0}),t.onSlidesDragEnd({orderedSlideIDs:M.map(function(e){return e.getID()})}),c.addClassName("noTransition"),c.setStyles({"padding-top":"","padding-bottom":""}),window.requestAnimationFrame(function(){c&&(c.removeClassName("noTransition"),c=null)})}else M.forEach(function(e,t){let n=e.getContent();if(b&&-1===b.getChildIndex(n))if(M[t-1]){let e=b.getChildIndex(M[t-1].getContent());b.addChild(n,e+1)}else b.addChild(n,0);else b||!D||D.contains(n)||(M[t-1]?D.insertBefore(n,M[t-1].getContent().nextSibling):D.insertBefore(n,D.children[1]))}),t.onSlidesDragEnd({});B.length=0,u=null}}function O(){if(!T)return;let e=document.querySelector(".DMUSlidePanelSectionMainDiv"),t=e.getSize().height?e.getSize().height:850;R>=.75*t?y.scrollTo(0,y.scrollTop+j):y.scrollTo(0,y.scrollTop-j),window.requestAnimationFrame(function(){O()})}function H(e){e.preventDefault()}function W(e){if(h&&"begin"!==e.state)return;let n=e.from[0].event;if(C&&n.shiftKey||!C&&!n.shiftKey)return;let i=n.composedPath();if("begin"===e.state)L(e);else if(i&&i.includes(D)){if(!B.length)return;U&&(U=!1,P.getChildren().forEach(function(e,t,n){let i=2*(n.length-t-1);e.style.left=i+u.x+"px",e.style.top=i+u.y+"px"}),f&&t.onSlidesDragStart({isTouch:s.getTouchMode()}));let n=e.from[0].getCurrentPosition(document.body);if(P.setStyle("transform",`translate(${n.x}px, ${n.y}px)`),!window.__karma__){let e=document.querySelector(".DMUSlidePanelSectionMainDiv"),t=e.getSize().height?e.getSize().height:850;.75*t<=n.y||n.y<=.25*t?(R=n.y,T||(T=!0,window.requestAnimationFrame(O))):T=!1}let i=document.elementFromPoint(n.x,n.y),o=i&&i.hasClassName&&i.getParent?i.hasClassName("DMUSlideAndReplyMainDiv")?i:i.getParent(".DMUSlideAndReplyMainDiv"):null;if(o){let e=P.firstElementChild.offsetHeight;o.firstElementChild.getPosition(document.body,{y:"center"}).y>=n.y?c===o&&I||(c&&c.setStyles({"padding-top":"","padding-bottom":""}),(c=o).setStyles({"padding-top":e+"px"}),I=!0):(c!==o||I)&&(c&&c.setStyles({"padding-top":"","padding-bottom":""}),(c=o).setStyles({"padding-bottom":e+"px"}),I=!1)}else c&&(c.setStyles({"padding-top":"","padding-bottom":""}),c=null)}"end"===e.state&&V()}function q(e){C&&(f=e.gesture.view[0],L(e),r.addEvent(f,"onPrimaryPointerMoveUnique",W),r.addEvent(f,"onPrimaryPointerUpUnique",V))}if(this.enableDefaultReorder=function(e){C=e},n.displayInExpanders)n.noSlideDiv=x,b=new v(n),D=b.getContent();else if(D=e.createElement("div",{class:"DMUSlidePanelMarkupDiv DMUBrowserThumbsMainContainer"}),S=e.createElement("div",{class:"DMUBrowserThumbsTitleDiv"}).inject(D),l=e.createElement("div",{class:"DMUBrowserSectionShadingCol"}).inject(S),n.icon&&(d=e.createElement("img",{class:"DMUBrowserThumbsIcon",src:n.icon}).inject(S)),a=e.createElement("p",{class:"DMUBrowserThumbsTitle"}).inject(S),n.name||S.setStyle("display","none"),a.textContent=n.name,n.children&&n.children.length)for(let e=0;e<n.children.length;e++){M.push(n.children[e]);let t=M[e].getContent();i||!F||_||(s.getTouchMode()?r.addEvent(t,"onMediumHold",q):r.addEvent(t,"onPrimaryPointerDownUnique",z)),t.inject(D)}else x.inject(D);function z(e){let t=0,n=0;if(n=window&&window.__karma__?1:4,e.from[0].event.shiftKey&&!C||!e.from[0].event.shiftKey&&C){let i=!1,o=r.addEvent(e.from[0].view.getClosest(".DMUSlidePanelThumbMainContainer"),"onMouseMove",e=>{++t<n||(i?W(e):(L(e),i=!0))}),l=r.addEvent(document.body,"onPrimaryPointerUpUnique",()=>{r.removeEventFromToken(l),r.removeEventFromToken(o),i&&(V(),i=!1),t=0})}}this.refreshNoSlideDiv=function(){for(;x.firstChild;)x.removeChild(x.firstChild);let l;o&&r.removeEventFromToken(o),x.hasClassName("DMUBrowserCreateElementTitleDiv")&&x.removeClassName("DMUBrowserCreateElementTitleDiv"),i||_?(l=e.createElement("div",{class:"DMUBrowserNoElementsTitleTextDiv"}).inject(x)).innerText=p||m.noSlidesTitle:(x.addClassName("DMUBrowserCreateElementTitleDiv"),e.createElement("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-plus DMUEmptyMarkupPlusBtn"}).inject(x),(l=e.createElement("div",{class:"DMUBrowserCreateElementTextDiv"}).inject(x)).innerText=g||m.createSlideTitle,o=r.addEvent(x,"onPrimaryPointerClick",function(){t.onNewSlideCreated(n.id)}))},this.setReadOnlyFlag=function(e){if(i!==e){i=e,k.setAllowSlideReorderFlag(n.allowSlideReorder&&!i&&!_),k.refreshNoSlideDiv(),b&&b.setCtxMenuVisibility(!i);for(let e=0;e<M.length;e++)M[e].setReadOnlyFlag(i)}},this.setAllowSlideReorderFlag=function(e){F!==e&&(F=e&&!i&&!_,M.forEach(function(e){F?s.getTouchMode()?r.addEvent(e.getContent(),"onMediumHold",q):(r.addEvent(e.getContent(),"onPrimaryPointerDownUnique",z),e.getContent().addEventListener("drop",N)):s.getTouchMode()?r.removeEvent(e.getContent(),"onMediumHold",q):(r.removeEvent(e.getContent(),"onPrimaryPointerDownUnique",z),e.getContent().removeEventListener("drop",N))}))},this.setExpandedFlag=function(e){b&&b.expandedFlag!==e&&(e?b.expand():b.close())};let X=!1;this.startTitleEdition=function(){if(b&&!i){let t=b.elements.header.children;for(let e=0;e<t.length;e++)t[e].style.display="none";let i=e.createElement("p",{class:"DMUMarkupEditableDiv",contenteditable:!0}).inject(b.elements.header);i.innerText=n.name,window.getSelection().removeAllRanges();let o=document.createRange();o.selectNodeContents(i),window.getSelection().addRange(o),i.focus(),X=!0;let l=function(e){if(X){X=!1,b.elements.header.removeChild(i);for(let e=0;e<t.length;e++)t[e].style.display="";e||(n.name=i.innerText,b.setTitle(i.innerText),n.onMarkupRenamed(i.innerText))}};i.addEventListener("keyup",function(e){e.stopPropagation()}),i.addEventListener("click",function(e){e.stopPropagation()}),i.addEventListener("keydown",function(e){"Enter"!==e.key&&13!==e.keyCode&&"Escape"!==e.key&&27!==e.keyCode||l("Escape"===e.key||27===e.keyCode)}),i.addEventListener("blur",l)}},this.getExpandedFlag=function(){return Boolean(b&&b.expandedFlag)},this.getExpanderHeader=function(){return b?b.elements.header:null},this.getContent=function(){return D},this.addChild=function(e,t){if(null!=t&&t<M.length?M.splice(t,0,e):M.push(e),i||_||!F||(s.getTouchMode()?r.addEvent(e.getContent(),"onMediumHold",q):(r.addEvent(e.getContent(),"onPrimaryPointerDownUnique",z),e.getContent().addEventListener("drop",N))),b){let n;if(t>0){n=0;for(let e=0;e<t;e++)M[e]&&(n+=1,n+=M[e].getReplies().length)}b.addChild(e.getContent(),n),b.icon=void 0,b.setNoDiv(null)}else D.contains(x)&&D.removeChild(x),null!=t?D.insertBefore(e.getContent(),D.children[t+1]):e.getContent().inject(D),d&&(S.removeChild(d),d=null,a&&a.setStyles({"margin-left":"25px"}));e.setReadOnlyFlag(i)},this.removeChild=function(e){let t=M.indexOf(e);-1!==t&&(s.getTouchMode()?r.removeEvent(e.getContent(),"onMediumHold",q):(r.removeEvent(e.getContent(),"onPrimaryPointerDownUnique",z),e.getContent().removeEventListener("drop",N)),b?b.removeChild(e.getContent()):D.removeChild(e.getContent()),e.clear(),M.splice(t,1),M.length||(b?b.setNoDiv(x):x.inject(D)))},this.removeChildren=function(){for(let e=M.length-1;e>=0;e--)k.removeChild(M[e])},this.updateShadingColor=function(){let e,t=!1;if(M&&M.length){for(t=!0,e=0;e<M.length;e++)if(!M[e].getDisplayFlag()){t=!1;break}if(t)for(e=0;e<M.length;e++)M[e].setDisplayFlag(!0,!0)}k.setShadingColor(t)},this.setShadingColor=function(e){b?b.setShadingColor(e):l&&l.setStyles({"background-color":e?"rgb(87, 184, 71)":"",top:"5px",left:"3px"})},this.setActiveMarkup=function(e){if(b&&b.setActiveMarkup(e),E=e,M)for(let e=0;e<M.length;e++)M[e].setReplyButtonActiveFlag(!n.readOnly&&E)},this.isActiveMarkup=function(){return E},this.setTitle=function(e){b&&b.setTitle(e)},this.clear=function(){for(let e=M.length-1;e>=0;e--)k.removeChild(M[e]);M.length=0,b&&b.clear(),b=null};let Z=[];this.addReply=function(e){Z.push(e),b&&b.addReply(e)},this.removeReply=function(e){if(b&&e&&e.id)for(let t=Z.length-1;t>=0;t--)Z[t].getThumbnailID()===e.id&&(b.removeReply(Z[t]),Z.splice(t,1))},this.removeReplies=function(e){if(b&&e&&e.replyID)for(let t=Z.length-1;t>=0;t--)Z[t].getParentID()===e.replyID&&(b.removeReply(Z[t]),Z.splice(t,1))},this.setReplySectionExpandedFlag=function(e){b&&b.setReplySectionExpandedFlag(e)},this.updateRepliesShadingColor=function(){let e,t=!1;if(Z&&Z.length){for(t=!0,e=0;e<Z.length;e++)if(!Z[e].getDisplayFlag()){t=!1;break}if(t)for(e=0;e<Z.length;e++)Z[e].setDisplayFlag(!0,!0)}},this.getReplies=function(){return Z},this.setReadOnlyFlag(Boolean(n.readOnly)),this.updateShadingColor(),this.refreshNoSlideDiv(),b?b.setNoDiv(x):x.inject(D)}}),w=o.extend({init:function(t){this._parent(t);let n,i,o,l,a=this,s=[],d=e.createElement("div",{class:"DMUSlideAndReplyMainDiv"}),c=!1,h="single",u=t.userName,g=t.showReplyButton,p=!0,v=!1===t.webMarkup,C=!0===t.readOnly;function w(){if(s.length){let e=0;for(let t=0;t<s.length;t++)e++,s[t].setThumbnailPrefix(a.getThumbnailPrefix()+e.toString()+".")}}function y(){let e,t="DMUReplySingleColRepLink"+(u?"_WithUserCred":""),i="DMUReplyMultiColRepLink"+(u?"_WithUserCred":""),o="DMUReplyMultiColAfterLink"+(u?"_WithUserCred":"");for(let n=s.length-1;n>=0;n--)e=s[n].getContent(),"multi"===h?(e.hasClassName("DMUReplySingleColRep")&&e.removeClassName("DMUReplySingleColRep"),e.hasClassName(t)&&e.removeClassName(t),e.hasClassName("DMUReplyMultiColRep")||e.addClassName("DMUReplyMultiColRep"),e.hasClassName(i)||e.addClassName(i),n<s.length-1&&!e.hasClassName(o)?e.addClassName(o):n===s.length-1&&e.hasClassName(o)&&e.removeClassName(o)):"single"===h&&(e.hasClassName("DMUReplyMultiColRep")&&e.removeClassName("DMUReplyMultiColRep"),e.hasClassName(i)&&e.removeClassName(i),e.hasClassName(o)&&e.removeClassName(o),e.hasClassName("DMUReplySingleColRep")||e.addClassName("DMUReplySingleColRep"),n<s.length-1&&!e.hasClassName(t)?e.addClassName(t):n===s.length-1&&e.hasClassName(t)&&e.removeClassName(t));n&&n.setStyles({"text-align":"single"===h?"left":"right"})}let b=this.getContent;this.getContent=function(){return d},this.getDate=function(){return t.creationDate},this.updateReplyButtonVisibility=function(){a.setReplyButtonVisibility(!C&&g&&p&&(!t.isReply||t.isReply&&!v)),s&&s.forEach(e=>{e.updateReplyButtonVisibility()})};let D=this.setThumbnailPrefix;this.setThumbnailPrefix=function(e){D(e),w()};let S=this.setThumbnailActiveFlag;function x(){let e="DMUSlideWithReplies"+(u?"_WithUserCred":"");"single"!==h&&c&&s.length?b().hasClassName(e)||b().addClassName(e):b().hasClassName(e)&&b().removeClassName(e)}function E(){s&&s.length&&s.sort(function(e,t){return e.getDate()-t.getDate()})}this.setThumbnailActiveFlag=function(e){S(e),s&&s.forEach(t=>{t.setThumbnailActiveFlag(e)})};let k=this.setReadOnlyFlag;this.setReadOnlyFlag=function(e){if(k(e||v),C=e,a.setCtxMenuAvailability(!C&&!v),a.setIsCheckableFlag(!C&&!v),a.updateReplyButtonVisibility(),s)for(let t=0;t<s.length;t++)s[t].setReadOnlyFlag(e)},this.allowReply=function(e){g=e,a.updateReplyButtonVisibility()},this.setReplyButtonActiveFlag=function(e){p=e,a.updateReplyButtonVisibility()};let M=this.setVisibleFlag;this.setVisibleFlag=function(e){M(e),d.setStyles({display:e?"":"none"});for(let t=0;t<s.length;t++)s[t].setVisibleFlag(e)},this.getID=function(){return t.id},this.getParentID=function(){return t.parentID},this.setReplySectionExpandedFlag=function(e){if(c!==e){c=e;for(let e=s.length-1;e>=0;e--)s[e].setVisibleFlag(c);i.setText(c?m.hideRepliesLabel:m.showRepliesLabel),c?(o.hasClassName("wux-ui-3ds-expand-right")&&o.removeClassName("wux-ui-3ds-expand-right"),o.addClassName("wux-ui-3ds-expand-down")):(o.hasClassName("wux-ui-3ds-expand-down")&&o.removeClassName("wux-ui-3ds-expand-down"),o.addClassName("wux-ui-3ds-expand-right")),x()}},this.getReplySectionExpandedFlag=function(){return c},this.addReply=function(h){s.push(h),t.markedAsDeleted&&h.allowReply(!1),1!==s.length||n||(n=e.createElement("div",{class:"DMUReplySubSectionHeaderDiv"}).inject(d),o=e.createElement("div",{class:"DMUReplySubSectionArrow wux-ui-3ds wux-ui-3ds-expand-right"}).inject(n),(i=e.createElement("p",{class:"DMUReplySubSectionHeaderText"}).inject(n)).setText(m.showRepliesLabel),l=r.addEvent(n,"onPrimaryPointerClick",function(){a.setReplySectionExpandedFlag(!c)}));let u=s.length>1?s[s.length-2].getContent():d;u.nextSibling?d.parentNode.insertBefore(h.getContent(),u.nextSibling):d.parentNode.appendChild(h.getContent()),h.setVisibleFlag(c),E(),y(),x(),w()},this.removeReplies=function(e){if(e&&e.replyID){for(let t=s.length-1;t>=0;t--)s[t].getParentID()===e.replyID&&(s[t].getContent().parentNode.removeChild(s[t].getContent()),s[t].clear(),s.splice(t,1));s.length||(l&&r.removeEventFromToken(l),n&&d.removeChild(n),n=null,c=!1),E(),x(),w()}},this.updateCreationDates=function(){t.creationDate&&a.updateUserCredentials({date:e.String.parseRelativeTime(t.creationDate.toString())}),s&&s.length&&s.forEach(e=>{e.updateCreationDates()})},this.removeReply=function(e){if(e&&e.id)for(let t=s.length-1;t>=0;t--)if(s[t].getThumbnailID()===e.id)return s[t].getContent().parentNode.removeChild(s[t].getContent()),s[t].clear(),s.splice(t,1),s.length||(l&&r.removeEventFromToken(l),d.removeChild(n),n=null,c=!1),E(),x(),w(),!0},this.updateRepliesShadingColor=function(){let e,t=!1;if(s&&s.length){for(t=!0,e=0;e<s.length;e++)if(!s[e].getDisplayFlag()){t=!1;break}if(t)for(e=0;e<s.length;e++)s[e].setDisplayFlag(!0,!0)}},this.updateRepliesPosition=function(){for(let e=s.length-1;e>=0;e--){let t=s[e];t.getContent().remove(),d.nextSibling?d.parentElement.insertBefore(t.getContent(),d.nextSibling):d.parentElement.appendChild(t.getContent())}w()};let P=this.setTitleAndIconSectionVisibleFlag;this.setTitleAndIconSectionVisibleFlag=function(e){P(e),s.forEach(t=>{t.setTitleAndIconSectionVisibleFlag(e)})},this.getReply=function(e){if(e&&e.id)for(let t=s.length-1;t>=0;t--)if(s[t].getThumbnailID()===e.id)return{reply:s[t],parent:a};return!1},this.getReplies=function(){return s},this.updateReply=function(e){if(e&&e.id&&e.info)for(let n=s.length-1;n>=0;n--)if(s[n].getThumbnailID()===e.id&&(e.info.name&&s[n].setThumbnailTexts({title:e.info.name}),e.info.img&&s[n].setPreview(e.info.img),void 0!==e.info.titleEditionAllowed&&s[n].allowTitleEdition(e.info.titleEditionAllowed),void 0!==e.info.checkFlag&&s[n].setCheckFlag(e.info.checkFlag,null,!1),"isPreview"in e.info&&(e.info.isPreview?s[n].addInformationIcon({id:"favoriteSlide",fontIcon:"wux-ui-3ds-favorite-on"}):s[n].removeInformationIcon("favoriteSlide")),"highlights"in e.info))if(e.info.highlights){let i={id:"",rating:"0"};e.info.highlights.forEach(e=>{(5===parseInt(e.rating)?0:parseInt(e.rating))>=(5===parseInt(i.rating)?0:parseInt(i.rating))&&(i=e)}),s[n].addInformationIcon({id:"highlightData",fontIcon:f[i.rating].icon,color:f[i.rating].color,onClick:function(){t.onInformationIconClickCB({replyId:e.id,highlightId:i.id})}}),s[n].hideReplyButton(!0)}else s[n].removeInformationIcon("highlightData"),s[n].hideReplyButton(!1)},this.clear=function(){for(let e=s.length-1;e>=0;e--)s[e].getContent().parentNode.removeChild(s[e].getContent()),s[e].clear(),s.splice(e,1);l&&r.removeEventFromToken(l)},this.setReplyRepresentation=function(e){h!==e&&(h=e,y(),x())},d.appendChild(b()),a.updateCreationDates(),a.allowReply(g),a.setReadOnlyFlag(Boolean(C))}});return t.extend({init:function(t){this._parent(t);let o,a,c,h,u,v,y,b,D,S,x,E,k=t||{},M=this,P=[],I=[],U=[],B=!1,F=!1,_=!!k.allowReplies&&k.allowReplies,T=!!k.allowSlideReorder&&k.allowSlideReorder,R=!!k.allowMarkupReorder&&k.allowMarkupReorder,j=!1,A=new i,N=-1,L=[],V=[],O=!1,H=e.createElement("div",{id:"DMUDraggableExpanderDiv",class:"DMUDraggableThumbnailDiv"});function W(e,t){return A.publish({event:e,data:t,context:M})}function q(){let e;for(let t=0;t<P.length;t++){if(P[t].markupSlides)for(e=0;e<P[t].markupSlides.length;e++)j?P[t].markupSlides[e].setVisibleFlag(-1!==U.indexOf(P[t].markupSlides[e].getThumbnailID())):P[t].markupSlides[e].setVisibleFlag(!0);if(P[t].section.view&&P[t].section.view.getReplies()){let n=P[t].section.view.getReplies();for(e=n.length-1;e>=0;e--)j?n[e].setVisibleFlag(-1!==U.indexOf(n[e].getThumbnailID())):n[e].setVisibleFlag(!0)}}}function z(e){let t;for(let n=0;n<P.length;n++){if(P[n].markupSlides)for(t=0;t<P[n].markupSlides.length;t++)if(P[n].markupSlides[t]){if(P[n].markupSlides[t].getThumbnailID()===e)return{section:P[n].section,thumbnail:P[n].markupSlides[t]};let i=P[n].markupSlides[t].getReply({id:e});if(i&&i.reply)return{section:P[n].section,thumbnail:i.reply,parent:i.parent}}if(P[n].section.view&&P[n].section.view.getReplies()){let i=P[n].section.view.getReplies();for(t=i.length-1;t>=0;t--)if(i[t].getThumbnailID()===e)return{section:P[n].section,thumbnail:i[t],parent:P[n].section.view}}}}function X(){let e,t=0;for(let n=0;n<P.length;n++){if(P[n].markupSlides)for(e=0;e<P[n].markupSlides.length;e++)P[n].markupSlides[e]&&(t++,P[n].markupSlides[e].setThumbnailPrefix(t.toString()+"."));if(P[n].section.view&&P[n].section.view.getReplies()){let i=P[n].section.view.getReplies();for(e=0;e<i.length;e++)t++,i[e].setThumbnailPrefix(t.toString()+".")}}}function Z(e){W("onSlidePreselected",e)}function G(e){c.closeContextualSectionHeader();let t,n,i=e.isFromCheck?e.event.shiftKey:e.event.from[0].event.shiftKey,o=e.isFromCheck?!i:e.event.from[0].event.ctrlKey,l=e.id,a=0,s=null,r=0;for(t=0;t<P.length;t++)if(P[t].section){if(P[t].markupSlides)for(n=0;n<P[t].markupSlides.length;n++){if(P[t].markupSlides[n].getThumbnailID()===l){s=P[t].markupSlides[n];break}a++}if(P[t].section.view&&P[t].section.view.getReplies()){let e=P[t].section.view.getReplies();for(n=e.length-1;n>=0;n--){if(e[n].getThumbnailID()===l){s=e[n];break}a++}}if(s)break}if(B||!i&&!o)N=a,W("onSlideDisplayed",e);else{if(!s)return;if(i||(N=a),o)W("onSlideSelected",{id:l,checkFlag:e.isFromCheck?s.isChecked():!s.isChecked()});else if(i)if(-1===N)W("onSlideSelected",{id:l,checkFlag:e.isFromCheck?s.isChecked():!s.isChecked()}),N=a;else if(N===a)for(r=0,t=0;t<P.length;t++){if(P[t].section&&P[t].markupSlides)for(n=0;n<P[t].markupSlides.length;n++)W("onSlideSelected",{id:P[t].markupSlides[n].getThumbnailID(),checkFlag:r===a}),r++;if(P[t].section.view&&P[t].section.view.getReplies()){let e=P[t].section.view.getReplies();for(n=e.length-1;n>=0;n--)W("onSlideSelected",{id:e[n].getThumbnailID(),checkFlag:r===a}),r++}}else{let e=a>N?N:a,i=a>N?a:N;for(r=0,t=0;t<P.length;t++)if(P[t].section){if(P[t].markupSlides)for(n=0;n<P[t].markupSlides.length;n++)r<e||r>i?W("onSlideSelected",{id:P[t].markupSlides[n].getThumbnailID(),checkFlag:!1}):r>=e&&r<=i&&W("onSlideSelected",{id:P[t].markupSlides[n].getThumbnailID(),checkFlag:!0}),r++;if(P[t].section.view&&P[t].section.view.getReplies()){let o=P[t].section.view.getReplies();for(n=o.length-1;n>=0;n--)r<e||r>i?W("onSlideSelected",{id:o[n].getThumbnailID(),checkFlag:!1}):r>=e&&r<=i&&W("onSlideSelected",{id:o[n].getThumbnailID(),checkFlag:!0}),r++}}}}}function K(e){W("onSlideNameChanged",e)}function Y(e){e.event?G({...e,isFromCheck:!0}):W("onSlideSelected",e)}function $(e){W("onSlideUpdateRequired",e)}function Q(t,i,o){return new w({id:t.id,parentID:t.parentID,isReply:i,displayPrefix:!0,webMarkup:o,width:240,height:135,readOnly:B||!t.isEditable(),markedAsDeleted:t.markedAsDeleted,displayTitleAndIcon:"boolean"==typeof F&&F,icon:t.icon,title:t.title?t.title:"",subtitle:t.parentSlideName?t.parentSlideName:"",allowCtxMenu:!B,isCheckable:!B&&(!0===o||void 0===o),isFavorite:t.isPreview,enableDrag:y,preview:t.img,userName:i?t.userName:null,userColor:i?t.userColor:null,userPic:i?t.userPic:null,defaultUserPic:i?t.defaultUserPic:null,creationDate:i?t.date:null,date:i&&t.date?e.String.parseRelativeTime(t.date.toString()):null,onEnterCB:Z,onLeaveCB:Z,clickCB:G,onTitleEditedCB:K,checkFlagChangedCB:Y,allowTitleEdition:t.titleEditionAllowed,onLabelContentClickCB:$,onCtxMenuCB:function(e){let t={id:e.id,openFromButton:e.openFromButton};t.shiftKeyPressed=e.event.shiftKey,t.ctrlKeyPressed=e.event.ctrlKey;let i=e.event,o=i.pageX?{x:i.pageX,y:i.pageY}:null;o||(o=i.screenX?{x:i.screenX,y:i.screenY}:null),!o&&i.type&&-1!==i.type.indexOf("touch")&&i.changedTouches&&i.changedTouches[0]&&((o=(i=i.changedTouches[0]).pageX?{x:i.pageX,y:i.pageY}:null)||(o=i.screenX?{x:i.screenX,y:i.screenY}:null)),o||(o={x:0,y:0}),t.position=new n.Vector2(o.x,o.y),setTimeout(function(){W("onSlideCtxMenuRequired",t)})},showReplyButton:_&&!B&&t.isEditable(),onReplyCB:function(e){W("onSlideReplyCreated",e)},onInformationIconClickCB:function({replyId:e,highlightId:t}){setTimeout(()=>{W("onSlideHighlightSelected",{slideId:e,highlightId:t})},100)}})}function J(e){"Escape"!==e.key&&27!==e.keyCode||(D&&(D.setStyles({"padding-top":"","padding-bottom":""}),D=null),S=!0,te())}function ee(e){S=!1;let t=e.gesture.view[0];if(!(v=P.find(function(e){return e.section.view.getExpanderHeader()===t})))return;document.addEventListener("keydown",J);let n=v.section.view.getContent(),i=n.getPosition(document.body);P.forEach(function(e){e.section.view.getExpandedFlag()&&(e.section.view.setExpandedFlag(!1),L.push(e.section.view))});let o=n.cloneNode(!0);n.setStyle("display","none");let l=e.from[0].getCurrentPosition(document.body);o.style.opacity=.8,o.style.left=i.x-l.x+"px",o.style.top=i.y-l.y+"px",o.style.position="absolute",H.appendChild(o),H.setStyle("transform",`translate(${l.x}px, ${l.y}px)`),document.body.appendChild(H)}function te(){if(E&&(r.removeEvent(E,"onPrimaryPointerMoveUnique",ne),r.removeEvent(E,"onPrimaryPointerUpUnique",te),E=null),v){for(document.removeEventListener("keydown",J),document.body.contains(H)&&document.body.removeChild(H),H.setStyles({transform:""});H.children.length;)H.removeChild(H.firstElementChild);if(v.section.view.getContent().setStyle("display",""),v.section.view.getContent().remove(),D){if(v.section.view.getContent()!==D){let e=Array.prototype.indexOf.call(u.children,D);e>=0&&(u.insertBefore(v.section.view.getContent(),u.children[O?e:e+1]),P.sort(function(e,t){let n,i;return(n=Array.prototype.indexOf.call(u.children,e.section.view.getContent()))<(i=Array.prototype.indexOf.call(u.children,t.section.view.getContent()))?-1:n>i?1:0}),X(),W("onMarkupReordered",{orderedMarkupIDs:P.map(function(e){return e.section.id})}))}D.addClassName("noTransition"),D.setStyles({"padding-top":"","padding-bottom":""}),window.requestAnimationFrame(function(){D&&(D.removeClassName("noTransition"),D=null)})}else P.forEach(function(e,t){let n=e.section.view.getContent();u.contains(n)||(P[t-1]?u.insertBefore(n,P[t-1].section.view.getContent().nextSibling):u.insertBefore(n,u.children[0]))});v=null,window.requestAnimationFrame(()=>{L.forEach(function(e){e.setExpandedFlag(!0)}),L.length=0})}}function ne(e){if(S&&"begin"!==e.state)return;let t=e.from[0].event.composedPath();if("begin"===e.state)ee(e);else if(t&&t.includes(u)){if(!v)return;let t=e.from[0].getCurrentPosition(document.body);H.setStyle("transform",`translate(${t.x}px, ${t.y}px)`);let n=document.elementFromPoint(t.x,t.y),i=n&&n.hasClassName&&n.getParent?n.hasClassName("wux-controls-expander")?n:n.getParent(".wux-controls-abstract.wux-controls-expander-placeholder.wux-controls-expander.DMUMarkupExpander"):null;if(i){let e=H.firstElementChild.offsetHeight;i.getPosition(document.body,{y:"center"}).y>=t.y?D===i&&O||(D&&D.setStyles({"padding-top":"","padding-bottom":""}),(D=i).setStyles({"padding-top":e+"px"}),O=!0):(D!==i||O)&&(D&&D.setStyles({"padding-top":"","padding-bottom":""}),(D=i).setStyles({"padding-bottom":e+"px"}),O=!1)}else D&&(D.setStyles({"padding-top":"","padding-bottom":""}),D=null)}"end"===e.state&&te()}function ie(e){E=e.gesture.view[0],ee(e),r.addEvent(E,"onPrimaryPointerMoveUnique",ne),r.addEvent(E,"onPrimaryPointerUpUnique",te)}function oe(e,t){for(let n=0;n<P.length;n++)P[n].section.view&&P[n].section.view.setActiveMarkup(e===P[n].section.view?t:!t)}this.buildPanel=function(t){M.cleanPanel(),o||(o=e.createElement("div",{id:"DMUSlidePanelThumbMainDiv"})),o.setStyles({height:"100%"});let n=e.createElement("div",{class:"DMUSlidePanelSectionMainDiv"}).inject(o);n.setStyles({height:"100%"}),t.noSlideLabel&&(p=t.noSlideLabel),t.createSlideLabel&&(g=t.createSlideLabel),c=new d({draggable:!0,onDragStart:function(){return v||""},sectionLabel:t.panelTitle?t.panelTitle:m.dmuPanelTitle,cmdList:t.contextualCmdList,quickAccessBtnList:t.quickAccessBtnList,doubleClickCB:function(){W("onTopBarDoubleClick")}}),n.appendChild(c.getContent());return u=e.createElement("div",{class:"DMUSlidePanelThumbMainContainer"}),(a=(new l).inject(n)).getInnerElement().setContent(u),a.getContent().setStyle("height","calc(100% - 40px)"),window&&window.__karma__||(x=setInterval(function(){let e;for(let t=0;t<P.length;t++){if(P[t].markupSlides)for(e=0;e<P[t].markupSlides.length;e++)P[t].markupSlides[e]&&P[t].markupSlides[e].updateCreationDates();if(P[t].section.view&&P[t].section.view.getReplies()){let n=P[t].section.view.getReplies();for(e=n.length-1;e>=0;e--)n[e].updateCreationDates()}}},6e4)),o},this.cleanPanel=function(){if(o){for(let e=0;e<P.length;e++)P[e].section?P[e].section.view.clear():P[e].clear();for(U.length=0,x&&clearInterval(x),x=null;o.firstChild;)o.removeChild(o.firstChild);P.splice(0,P.length),c&&c.clear(),h&&h.clear(),a&&a.destroy(),c=h=a=P=o=null}},this.setNoSlideLabel=function(e){p=e;for(let e=0;e<P.length;e++)P[e].section&&P[e].section.view.refreshNoSlideDiv()},this.setCreateSlideLabel=function(e){g=e;for(let e=0;e<P.length;e++)P[e].section&&P[e].section.view.refreshNoSlideDiv()},this.setDragContent=function(e){v=e},this.setSlideDragContent=function(e){let t=!1;if(P.length)for(let n=0;n<P.length;n++){let i=P[n].markupSlides;if(i&&i.length){for(let n=0;n<i.length;n++)if(e.parentSlideId){let o=i[n].getReplies();if(o){for(let n=0;n<o.length;n++)if(e.id===o[n].getID()){o[n].setSlideViewTransferDragContent(e.data),o[n].setIsDraggable(!0),t=!0;break}if(t)break}}else if(e.id===i[n].getID()){i[n].setSlideViewTransferDragContent(e.data),i[n].setIsDraggable(!0),t=!0;break}if(t)break}}},this.enableDragContent=function(e){if(y!==e&&(y=e,P.length))for(let t=0;t<P.length;t++){P[t].section.view.enableDefaultReorder(!e);let n=P[t].markupSlides;if(n)for(let t=0;t<n.length;t++){n[t].enableDragContent(e);let i=n[t].getReplies();if(i)for(let t=0;t<i.length;t++)i[t].enableDragContent(e)}}},this.getColumnMinimumWidth=function(){return P&&P.length&&"default"!==P[0].section.id?273:267},this.getColumnWidthStep=function(){return 240},this.resizePanel=function(e){b="single";let t,n=M.getColumnMinimumWidth()-M.getColumnWidthStep();b=e.width-n>=2*M.getColumnWidthStep()?"multi":"single";for(let e=0;e<P.length;e++){if(P[e].markupSlides)for(t=0;t<P[e].markupSlides.length;t++)P[e].markupSlides[t]&&P[e].markupSlides[t].setReplyRepresentation(b);if(P[e].section.view&&P[e].section.view.getReplies()){let n=P[e].section.view.getReplies();for(t=n.length-1;t>=0;t--)n[t].setReplyRepresentation(b)}}},this.setPanelTitle=function(e){c&&c.setHeaderLabel(e)},this.switchFilterActivation=function(){j=!j,q()},this.getFilterActivationFlag=function(){return j},this.setListOfVisibleSlides=function(e){U=e&&e.length?e.slice():[],q()},this.allowReplies=function(e){if(_===e)return;let t;_=e;for(let e=0;e<P.length;e++)if(P[e].markupSlides)for(t=0;t<P[e].markupSlides.length;t++){if(P[e].markupSlides[t]){P[e].markupSlides[t].allowReply(_);let n=P[e].markupSlides[t].getReplies();if(n&&n.length)for(let e=0;e<n.length;e++)n[e].allowReply(_)}if(P[e].section.view&&P[e].section.view.getReplies()){let t=P[e].section.view.getReplies();for(let e=t.length-1;e>=0;e--)t[e].allowReply(_)}}},this.setAllowMarkupReorderFlag=function(e){if(R!==e){R=e;for(let e=0;e<P.length;e++)R&&!B?s.getTouchMode()?r.addEvent(P[e].section.view.getExpanderHeader(),"onMediumHold",ie):r.addEvent(P[e].section.view.getExpanderHeader(),"onDrag",ne):s.getTouchMode()?r.removeEvent(P[e].section.view.getExpanderHeader(),"onMediumHold",ie):r.removeEvent(P[e].section.view.getExpanderHeader(),"onDrag",ne)}},this.setAllowSlideReorderFlag=function(e){if(T!==e){T=e;for(let e=0;e<P.length;e++)P[e].section.view.setAllowSlideReorderFlag(T&&!B)}},this.resetSlideDisplayHistory=function(){let e,t;for(let n=0;n<P.length;n++)if(P[n].markupSlides)for(t=0;t<P[n].markupSlides.length;t++){if(P[n].markupSlides[t]){P[n].markupSlides[t].getDisplayFlag()&&(P[n].markupSlides[t].setDisplayFlag(!1),P[n].section.view&&P[n].section.view.updateShadingColor()),e=P[n].markupSlides[t].getReplies();for(let t=0;t<e.length;t++)e[t].getDisplayFlag()&&e[t].setDisplayFlag(!1)}if(P[n].section.view&&P[n].section.view.getReplies())for(let t=(e=P[n].section.view.getReplies()).length-1;t>=0;t--)e[t].getDisplayFlag()&&e[t].setDisplayFlag(!1)}},this.setReadOnlyFlag=function(e){N=-1,B=e,M.enableDragContent(e||y),c.closeContextualSectionHeader(),M.setAllowMarkupReorderFlag(k.allowMarkupReorder&&!B),M.setAllowSlideReorderFlag(k.allowSlideReorder&&!B);for(let e=0;e<P.length;e++)if(P[e].section&&P[e].section.view&&P[e].section.view.setReadOnlyFlag(B),P[e].markupSlides)for(let t=0;t<P[e].markupSlides.length;t++){if(P[e].markupSlides[t]){P[e].markupSlides[t].setReadOnlyFlag(B);let n=P[e].markupSlides[t].getReplies();for(let e=0;e<n.length;e++)n[e].setReadOnlyFlag(B)}if(P[e].section.view&&P[e].section.view.getReplies()){let t=P[e].section.view.getReplies();for(let e=t.length-1;e>=0;e--)t[e].setReadOnlyFlag(B)}}},this.setPanelSubMenuCommands=function(e){c.closeContextualSectionHeader(),c.setSubMenuCommands(e)},this.setPanelQuickAccessCommands=function(e){c.closeContextualSectionHeader(),c.setQuickAccessCommands(e)},this.setQuickAccessCommandActiveFlag=function(e,t){c.setQuickAccessCommandActiveFlag(e,t)};let le=!0;function ae(e){for(let t=P.length-1;t>=0;t--)if(P[t].section&&P[t].section.id===e)return e;for(let t=0;t<I.length;t++)if(I[t].id===e)return ae(I[t].parentID)}this.getPanelActiveFlag=function(){return le},this.setPanelActiveFlag=function(e){let t;e||M.removeSlideUpdateRequiredFlags(),le=e,c.closeContextualSectionHeader(),c.setAdditionalCheckBoxActiveFlag(0,le);for(let n=0;n<P.length;n++){if(P[n].markupSlides)for(t=0;t<P[n].markupSlides.length;t++)P[n].markupSlides[t]&&P[n].markupSlides[t].setThumbnailActiveFlag(e);if(P[n].section.view&&P[n].section.view.getReplies()){let i=P[n].section.view.getReplies();for(t=i.length-1;t>=0;t--)i[t].setThumbnailActiveFlag(e)}}},this.addMarkup=function(e){if(N=-1,c.closeContextualSectionHeader(),!e.id)return;let t=P.length,i=0;for(i=0;i<t;i++)if(P[i].section.id===e.id)return;let o={section:{name:e.title,id:e.id,webMarkup:e.webMarkup,view:new C({name:e.title,id:e.id,owner:e.owner,webMarkup:e.webMarkup,allowSlideReorder:T,displayInExpanders:"default"!==e.id,onNewSlideCreated:function(){W("onNewSlideCreated",e)},onSlidesDragStart:function(e){if(e)return W("onSlideDragStart",e);P.forEach(function(e){e!==o?e.section.view.getExpandedFlag()&&(e.section.view.setExpandedFlag(!1),L.push(e.section.view)):e.markupSlides.forEach(function(e){e.getReplySectionExpandedFlag()&&(e.setReplySectionExpandedFlag(!1),V.push(e))})})},onSlidesDragEnd:function(t){L.forEach(function(e){e.setExpandedFlag(!0)}),L.length=0,V.forEach(function(e){e.setReplySectionExpandedFlag(!0)}),V.length=0;let n=P.indexOf(o);n>=0&&(t&&t.orderedSlideIDs&&t.orderedSlideIDs.length?(t.orderedSlideIDs.forEach(function(e){let t=P[n].markupSlides.findIndex(t=>t.getID()===e),i=P[n].markupSlides.splice(t,1)[0];P[n].markupSlides.push(i)}),X(),P[n].markupSlides.forEach(function(e){e.updateRepliesPosition()}),W("onSlideReordered",Object.assign(t,{markupID:e.id}))):P[n].markupSlides.forEach(function(e){e.updateRepliesPosition()}))},onMarkupRenamed:function(t){W("onMarkupRenamed",{id:e.id,title:t})},onMarkupCtxMenuCB:function(e){let t=e.event,i=t.pageX?{x:t.pageX,y:t.pageY}:null;i||(i=t.screenX?{x:t.screenX,y:t.screenY}:null),!i&&t.type&&-1!==t.type.indexOf("touch")&&t.changedTouches&&t.changedTouches[0]&&((i=(t=t.changedTouches[0]).pageX?{x:t.pageX,y:t.pageY}:null)||(i=t.screenX?{x:t.screenX,y:t.screenY}:null)),i||(i={x:0,y:0}),W("onMarkupCtxMenuRequired",{id:e.id,position:new n.Vector2(i.x,i.y)})},readOnly:B})}};"default"!==e.id&&!B&&R&&(s.getTouchMode()?r.addEvent(o.section.view.getExpanderHeader(),"onMediumHold",ie):r.addEvent(o.section.view.getExpanderHeader(),"onDrag",ne)),P.push(o),P[0].section.view.title=e.title,P[0].section.view.id=e.id,o.section.view.enableDefaultReorder(!y),u.appendChild(P[t].section.view.getContent())},this.removeMarkup=function(e){let t;for(let n=P.length-1;n>=0;n--)if(P[n].section&&(P[n].section.id===e||P[n].section.parentID===e)){if(P[n].markupSlides)for(t=P[n].markupSlides.length-1;t>=0;t--)P[n].section.view.removeChild(P[n].markupSlides[t]);P[n].section.view.clear(),u.removeChild(P[n].section.view.getContent()),P.splice(n,1)}X()},this.updateMarkup=function(e,t){for(let n=P.length-1;n>=0;n--)if(P[n].section&&P[n].section.id===e)return void(t.name&&P[n].section.view.setTitle(t.name))},this.editMarkupName=function(e){let t;for(let n=P.length-1;n>=0;n--)if(P[n].section&&P[n].section.id===e){t=P[n].section.view;break}t&&t.startTitleEdition()},this.addReply=function(e){if(N=-1,c.closeContextualSectionHeader(),!e.id||!e.parentID)return;let t;for(t=0;t<I.length;t++)if(I[t].id===e.id)return;I.push(e)},this.removeReply=function(e){let t,n;for(n=I.length-1;n>=0;n--)if(I[n].id===e){t=I[n].parentID;break}if(t)for(n=P.length-1;n>=0;n--)if(P[n].section&&P[n].section.id===t){if(P[n].markupSlides)for(let t=P[n].markupSlides.length-1;t>=0;t--)P[n].markupSlides[t].removeReplies({replyID:e});P[n].section.view&&P[n].section.view.getReplies()&&P[n].section.view.removeReplies({replyID:e})}},this.addSlide=function(e){let t,n,i;if(N=-1,c.closeContextualSectionHeader(),P.length||M.addMarkup({id:"default"}),!e.parentID)for(t=0;t<P.length;t++){if(P[t].section.view&&P[t].section.view.isActiveMarkup()){e.parentID=P[t].section.id;break}t===P.length-1&&P[0].section.view&&(oe(P[0].section.view,!0),e.parentID=P[0].section.id)}for(t=0;t<P.length;t++)if(e.parentID===P[t].section.id){for(i=Q(e,null,P[t].section.webMarkup),P[t].markupSlides?null!==e.index&&void 0!==e.index?P[t].markupSlides.splice(e.index,0,i):P[t].markupSlides.push(i):(P[t].section.view.removeChildren(),P[t].markupSlides=[i]),P[t].section.view.addChild(i,e.index),n=0;n<I.length;n++){if(ae(I[n].parentID)===P[t].section.id&&I[n].pendingReplies&&I[n].pendingReplies.length)for(let e=I[n].pendingReplies.length-1;e>=0;e--){let o=!1,l=I[n].pendingReplies[e];l.parentSlideID?i.getID()===l.parentSlideID&&(i.addReply(l.thumbnail),o=!0):(P[t].section.view.addReply(l.thumbnail),o=!0),o&&I[n].pendingReplies.splice(e,1)}}break}if(!i){let o=ae(e.parentID);for(t=0;t<I.length;t++)if(I[t].id===e.parentID){let l=!1;for(n=0;n<P.length;n++)if(o===P[n].section.id)if(e.parentSlideID){if(P[n].markupSlides)for(let o=0;o<P[n].markupSlides.length;o++)P[n].markupSlides[o].getID()===e.parentSlideID&&(i=Q(e,!0,I[t].webMarkup),P[n].markupSlides[o].addReply(i),l=!0)}else e.parentSlideName=I[t].title,i=Q(e,!0,I[t].webMarkup),P[n].section.view.addReply(i),l=!0;l||(I[t].pendingReplies||(I[t].pendingReplies=[]),e.parentSlideName=e.parentSlideID?"":I[t].title,i=Q(e,!0,I[t].webMarkup),I[t].pendingReplies.push({thumbnail:i,parentSlideID:e.parentSlideID}));break}}for(X(),i&&i.setReplyRepresentation(b),t=0;t<P.length;t++)P[t].section.view.getContent().setStyles({"grid-template-columns":"repeat(auto-fit, "+M.getColumnWidthStep()+"px)"})},this.removeSlide=function(e){let t,n;for(N=-1,t=0;t<P.length;t++)if(P[t].section&&P[t].markupSlides&&P[t].markupSlides.length){for(n=0;n<P[t].markupSlides.length;n++){if(P[t].markupSlides[n].getThumbnailID()===e)return P[t].section.view.removeChild(P[t].markupSlides[n]),P[t].markupSlides[n].clear(),P[t].markupSlides.splice(n,1),void X();if(P[t].markupSlides[n].removeReply({id:e}))return}if(P[t].section.view.removeReply({id:e}))return}},this.updateSlide=function(e,t){let n=function(n){if(t.id&&n.setThumbnailID(t.id),t.name&&n.setThumbnailTexts({title:t.name}),t.img&&n.setPreview(t.img),void 0!==t.titleEditionAllowed&&n.allowTitleEdition(t.titleEditionAllowed),void 0!==t.checkFlag&&n.setCheckFlag(t.checkFlag,null,!0),"isPreview"in t&&(t.isPreview?n.addInformationIcon({id:"favoriteSlide",fontIcon:"wux-ui-3ds-favorite-on"}):n.removeInformationIcon("favoriteSlide")),"highlights"in t)if(t.highlights&&t.highlights.length){let i={id:"",rating:"0"};t.highlights.forEach(e=>{(5===parseInt(e.rating)?0:parseInt(e.rating))>=(5===parseInt(i.rating)?0:parseInt(i.rating))&&(i=e)}),n.addInformationIcon({id:"highlightData",fontIcon:f[i.rating].icon,color:f[i.rating].color,onClick:function(){setTimeout(()=>{W("onSlideHighlightSelected",{slideId:e,highlightId:i.id})},100)}}),n.hideReplyButton(!0)}else n.removeInformationIcon("highlightData"),n.hideReplyButton(!1)};for(let i=0;i<P.length;i++)if(P[i].section){if(P[i].markupSlides)for(let o=0;o<P[i].markupSlides.length;o++){if(P[i].markupSlides[o].getThumbnailID()===e)return void n(P[i].markupSlides[o]);if(P[i].markupSlides[o].getReply({id:e}))return void P[i].markupSlides[o].updateReply({id:e,info:t})}if(P[i].section.view&&P[i].section.view.getReplies()){let t=P[i].section.view.getReplies();for(let i=0;i<t.length;i++)if(t[i].getThumbnailID()===e)return void n(t[i])}}},this.setActiveSlide=function(e,{recenter:t=!1}={}){c.closeContextualSectionHeader();let n=0,i=0,o=z(e);if(o){if(t&&a){let e=a.getInnerElement();if(e&&o.thumbnail){const t=o.thumbnail.getContent();if(t){let n=t.getPosition().y-e.offsetHeight/2+t.getSize().height/2;e.scrollTo({top:n,behavior:"smooth"})}}}if(B)for(o.thumbnail.getDisplayFlag()||(o.thumbnail.setDisplayFlag(!0),o.parent?o.parent.updateRepliesShadingColor():o.section.view&&o.section.view.updateShadingColor()),n=0;n<P.length;n++){if(P[n].markupSlides)for(i=0;i<P[n].markupSlides.length;i++)P[n].markupSlides[i].highlightThumbnail(P[n].markupSlides[i]===o.thumbnail);if(P[n].section.view&&P[n].section.view.getReplies()){let e=P[n].section.view.getReplies();for(i=0;i<e.length;i++)e[i].highlightThumbnail(e[i]===o.thumbnail)}}else for(n=0;n<P.length;n++){if(P[n].markupSlides)for(i=0;i<P[n].markupSlides.length;i++){P[n].markupSlides[i].setDisplayFlag(P[n].markupSlides[i]===o.thumbnail),P[n].markupSlides[i].highlightThumbnail(P[n].markupSlides[i]===o.thumbnail);let e=P[n].markupSlides[i].getReplies();for(let t=0;t<e.length;t++)e[t].setDisplayFlag(e[t]===o.thumbnail),e[t].highlightThumbnail(e[t]===o.thumbnail)}if(P[n].section.view&&P[n].section.view.getReplies()){let e=P[n].section.view.getReplies();for(i=0;i<e.length;i++)e[i].setDisplayFlag(e[i]===o.thumbnail),e[i].highlightThumbnail(e[i]===o.thumbnail)}}oe(o.section.view,!0),o.parent&&o.parent.setReplySectionExpandedFlag(!0)}else for(n=0;n<P.length;n++){if(P[n].markupSlides)for(i=0;i<P[n].markupSlides.length;i++)P[n].markupSlides[i].setDisplayFlag(P[n].markupSlides[i].getThumbnailID()===e),P[n].markupSlides[i].highlightThumbnail(P[n].markupSlides[i].getThumbnailID()===e);if(P[n].section.view&&P[n].section.view.getReplies()){let t=P[n].section.view.getReplies();for(i=0;i<t.length;i++)t[i].setDisplayFlag(t[i].getThumbnailID()===e),t[i].highlightThumbnail(t[i].getThumbnailID()===e)}}},this.setSlideTitleVisibleFlag=function(e){if(("boolean"==typeof e&&e)!==F){let t;F=e;for(let e=0;e<P.length;e++){if(P[e].markupSlides)for(t=0;t<P[e].markupSlides.length;t++)P[e].markupSlides[t]&&P[e].markupSlides[t].setTitleAndIconSectionVisibleFlag(F);if(P[e].section.view&&P[e].section.view.getReplies()){let n=P[e].section.view.getReplies();for(t=0;t<n.length;t++)n[t].setTitleAndIconSectionVisibleFlag(F)}}}},this.setSlideUpdateRequiredFlag=function(e,t){let n=z(e);n&&n.thumbnail&&n.thumbnail&&n.thumbnail.setThumbnailLabelClickableFlag(t,{title:m.updateSlideViewpoint,fontIcon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-refresh"})},this.removeSlideUpdateRequiredFlags=function(){let e;for(let t=0;t<P.length;t++){if(P[t].markupSlides)for(e=0;e<P[t].markupSlides.length;e++)if(P[t].markupSlides[e]){P[t].markupSlides[e].setThumbnailLabelClickableFlag(!1);let n=P[t].markupSlides[e].getReplies();for(let e=0;e<n.length;e++)n[e].setThumbnailLabelClickableFlag(!1)}if(P[t].section.view&&P[t].section.view.getReplies()){let n=P[t].section.view.getReplies();for(e=0;e<n.length;e++)n[e].setThumbnailLabelClickableFlag(!1)}}},this.setInProgress=((e,t)=>{let n=z(e);n&&n.thumbnail&&n.thumbnail&&(t?n.thumbnail.displayProgress():n.thumbnail.hideProgress())}),this.subscribe=function(e,t){if(e&&t)return A.subscribe({event:e},t)},this.unsubscribe=function(e){null!=e&&A.unsubscribe(e)}}})}),define("DS/DMUControls/DMUToolsSave",["require","exports","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUControls/DMUInfoModalDiv","DS/Windows/Dialog","DS/Controls/Button","UWA/Core","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls"],function(e,t,n,i,o,l,a,s){"use strict";let r=null,d=null,c=null,h="success";return class{static clean(){r&&(clearTimeout(r),r=null),d&&(d.destroy(),d=null),c&&(c.destroy(),c=null)}static tryToSaveData({frameWindow:e,saveFunction:t}){return new Promise((u,m)=>{r&&(clearTimeout(r),r=null),d||(d=new i),d.display({frmWindow:e,type:"error"===h?"error":"save"}),r=setTimeout(async()=>{let g=r,p=()=>g!==r;try{if("error"===h)throw new Error;p()||await t()}catch(r){if(p())return m(r);d&&(d.destroy(),d.display({frmWindow:e,type:"error"}));try{if("error"===h)throw new Error;await t()}catch(r){if(p())return m(r);const u=r=>new Promise((h,m)=>{c&&(c.destroy(),c=null),d||(d=new i),d.display({frmWindow:e,type:"error"}),t().then(()=>{r&&(new n).build({body:e.getUIFrame(),autoHide:!0,type:"success",message:s.saveSucceeded}),h()}).catch(t=>{if(p())return m(t);if(d){d.destroy();const t=a.createElement("div",{class:"DMUToolsSaveDialog"});a.createElement("i",{class:"wux-ui-3ds wux-ui-3ds-error DMUToolsSaveDialog-icon"}).inject(t),a.createElement("span",{class:"DMUToolsSaveDialog-message",text:s.saveFailedMessage}).inject(t),(c=new o({immersiveFrame:e.getImmersiveFrame(),title:s.saveFailed,content:t,modalFlag:!0,buttons:{Retry:new l({onClick:()=>{u(!0).then(h).catch(m)}}),Cancel:new l({onClick:function(){null==c||c.close()}})}})).addEventListener("close",()=>{null==c||c.destroy(),c=null,m(new Error("Last attempt save failed"))})}})});try{await u()}catch(e){return null==d||d.destroy(),d=null,window.console.warn(e),h="error",m(new Error("Save failed"))}}}null==d||d.destroy(),d=null,h="success",u()},750)})}}}),define("DS/DMUControls/panels/DMUCommentsPanel",["require","exports","DS/Visualization/ThreeJS_DS","UWA/Controls/ThemedScroller","DS/CATWebUXComponents/CATWebUXSectionHeader","DS/VisuEvents/EventsManager","DS/Menu/ContextualMenu","DS/DMUBaseUIComponents/DMUComment","UWA/Core","DS/CoreEvents/ModelEvents","DS/DMUBaseUI/DMUToolsUsers","DS/Controls/ComboBox","DS/Controls/LineEditor","DS/DMUControls/DMUCommentFilterView","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,l,a,s,r,d,c,h,u,m,g){"use strict";const p={1:{icon:"wux-ui-3ds-attention",color:"#007DA3"},2:{icon:"wux-ui-3ds-level-low",color:"rgb(71,119,56)"},3:{icon:"wux-ui-3ds-level-medium",color:"rgb(232,123,0)"},4:{icon:"wux-ui-3ds-level-high",color:"rgb(234,79,55)"},5:{icon:"wux-ui-3ds-check",color:"rgb(71, 119, 56)"},6:{icon:"wux-ui-3ds-alert",color:"rgb(153, 7, 7)"}};class f{constructor(e){let t=[],n=r.createElement("div",{class:"DMUCommentsPanelMarkupCombo"}),i=r.createElement("div",{class:"DMUCommentsPanelMarkupCombo-user_color"}),o=r.createElement("div",{class:"DMUCommentsPanelMarkupCombo-label",text:g.commentsPanel.markup+":"}),s=r.createElement("div",{class:"DMUCommentsPanelMarkupCombo-combo"}),d=new h({enableSearchFlag:!1,placeholder:g.commentsPanel.noActiveMarkup,reachablePlaceholderFlag:!0});d.setProperties({getMainElementCustomization:function(){if(t&&t[d.selectedIndex])return{label:t[d.selectedIndex].name}}}),d.getContent().style.width="100%",s.appendChild(d.getContent());let m=r.createElement("div",{class:"DMUCommentsPanelMarkupCombo-ctx_menu"});m.appendChild(r.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-menu-dot"}));let p=l.addEvent(m,"onPrimaryPointerClick",function(t){e.onContextMenuRequested&&e.onContextMenuRequested({id:d.value,event:t.from[0].event})});n.appendChild(o),n.appendChild(i),n.appendChild(s),n.appendChild(m);let f=a.addEventListener(n,{callback:t=>{e.onContextMenuRequested&&e.onContextMenuRequested({id:d.value,event:t.data.event})}});function v(){t&&d&&(t.length?m.setStyle("display",""):m.setStyle("display","none"),d.setProperties({elementsList:t.map(e=>({value:e.id,label:`${e.name} | ${e.ownerName||e.owner}`,description:e.ownerName||e.owner}))}))}d.addEventListener("change",function(){d.value&&e.onCurrentMarkupChanged(d.value)}),this.addMarkup=(e=>{if(!t||t.some(t=>t.id===e.id))return;const n={id:e.id,name:e.name,owner:e.owner};n.owner&&c.getUserName(n.owner,e=>{n.ownerName=e,v()}),t.push(n),v()}),this.setVisibility=(e=>{e?n.setStyle("display",""):n.setStyle("display","none")}),this.startMarkupNameEdition=(n=>{if(!t)return;const i=t.findIndex(e=>e.id===n);if(-1!==i){let o=new u({placeholder:"Markup Name",requiredFlag:!0,value:t[i].name});const l=e=>{e&&t&&t[i]&&(t[i].name=e,v()),requestAnimationFrame(()=>{o.removeEvents(),o.remove(),d.show()})};d.hide(),o.inject(s),o.focus({}),o.addEventListener("change",function(){e.onMarkupRenamed(n,o.value),l(o.value)}),o.addEventListener("blur",function(){l()})}}),this.setCurrentMarkup=(e=>{if(d&&t){if(e){const n=t.find(t=>t.id===e);if(n&&n.owner){const e=c.getUserColor(n.owner);e&&(i.style.backgroundColor=e.getStyle()),i.title=n.ownerName||n.owner}}else i.style.backgroundColor="#B4B6BA",i.title=g.commentsPanel.noActiveMarkup;d.value=e||void 0}}),this.removeMarkup=(n=>{if(!t)return;const i=t.findIndex(e=>e.id===n);-1!==i&&(t.splice(i,1),v(),t.length&&e.onCurrentMarkupChanged(t[i%t.length].id))}),this.getContent=(()=>n),this.remove=(()=>{f&&a.removeEventListener(n,f),p&&l.removeEventFromToken(p),d.remove(),f=p=null,t=d=null})}}return class{constructor(){let e,t,a,h,u,v,C,w,y,b,D,S,x=this,E=!1,k=!1,M=!1,P=new Map,I=new Set,U=new Map,B=new d,F=[],_={};function T({element:e,page:t,number:n}){return e&&"number"!=typeof e.index&&e.id&&-1===e.id.indexOf("_")?"ErrorContainer":e&&e.id&&e.id.indexOf("_")>=0?"-"+e.id:"-"+(n||(e?e.index:t||"externalComments"))}function R({element:e,page:t,containerId:n,notCreate:i}){if(n)return U.get(n);let o=T({element:e,page:t}),l=(e?e.index:t)||-1;const a=U.get(o);if(a)return a;if(!i){let n=e?e.title:t?g.page+" "+t:g.commentsPanel.fileCommentsTitle,i={id:o,number:l,elemID:null==e?void 0:e.id,view:r.createElement("div",{id:`DMUCommentPanelContainer${o}`,text:n||"",class:"DMUCommentContainer",title:n}),commentIds:[]};v.appendChild(i.view),U.set(o,i);const a=[...U.values()];return a.sort(function(e,t){return e.number>t.number?1:e.number<t.number?-1:0}),a.forEach(function(e){v.removeChild(e.view),v.appendChild(e.view)}),i}}function j(e,t){return B.publish({event:e,data:t,context:x})}function A(e){j("onCommentSelected",e)}function N(e){j("onCommentPreselected",e)}function L(e){if(e.target.isReply){const t=e.target.parentObject,n=P.get(t.getAttribute("sUuid"));n&&n.view.updateTimelineLength()}j("onCommentEditionEnd",e)}function V(e){j("onCommentReply",e)}function O(e){j("onPanelScroll",e)}function H(e){e&&(e.commentIds.sort((e,t)=>{const n=P.get(e),i=P.get(t);if(n&&i){if(!n.commentData.pointedPosition)return-1;if(!i.commentData.pointedPosition)return 1;if(n.commentData.pointedPosition.y>i.commentData.pointedPosition.y)return-1;if(n.commentData.pointedPosition.y<i.commentData.pointedPosition.y)return 1}return 0}),e.commentIds.forEach(t=>{const n=P.get(t);n&&(e.view.removeChild(n.view.getCommentDiv()),e.view.appendChild(n.view.getCommentDiv()))}))}function W(e,t){e.owner.login&&(e.owner.name=e.owner.name||e.owner.login,c.getUserName(e.owner.login,function(n){e.owner.name!==n&&(e.owner.name=n,e.isReply&&y&&t?function(e,t){if(!e||!t||!P)return;const n=P.get(t);if(n){const t=n.replies.get(e.uuid);t&&(e.dateInMs&&(t.dateInMs=e.dateInMs,e.date=c.formatDate(e.dateInMs)),t.view.update(e))}}(e,t):x.updateComment(e))}),e.owner.color=c.getUserColor(e.owner.login).getStyle(),e.owner.imageUrl=c.getUserImageURL(e.owner.login))}function q(e){e&&(e.view.getSize().height>t.getInnerElement().getSize().height?e.view.hasClassName("repliesContracted")?e.view.hasClassName("allContracted")||e.view.addClassName("allContracted"):(e.view.addClassName("repliesContracted"),e.view.getSize().height>t.getInnerElement().getSize().height&&e.view.addClassName("allContracted")):e.view.hasClassName("allContracted")?(e.view.removeClassName("allContracted"),q(e)):e.view.hasClassName("repliesContracted")&&(e.view.removeClassName("repliesContracted"),q(e)))}function z(){if(v)if(P.size)D&&(S&&l.removeEventFromToken(S),D.remove(),D=S=null);else{if(D)for(;D.firstChild;)D.removeChild(D.firstChild);else D=r.createElement("div",{styles:{padding:10}}).inject(v);let e;D.hasClassName("DMUCreateCommentTitleDiv")&&D.removeClassName("DMUCreateCommentTitleDiv"),S&&(l.removeEventFromToken(S),S=null),E||k?(e=r.createElement("div",{class:"DMUBrowserNoElementsTitleTextDiv"}).inject(D)).innerText=g.commentsPanel.noCommentsTitle:(D.addClassName("DMUCreateCommentTitleDiv"),r.createElement("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-plus DMUEmptyMarkupPlusBtn"}).inject(D),(e=r.createElement("div",{class:"DMUBrowserCreateElementTextDiv"}).inject(D)).innerText=g.commentsPanel.createCommentTitle,S=l.addEvent(D,"onPrimaryPointerClick",function(){j("onNewCommentCreated",void 0)}))}}function X(e){E&&e&&-1===F.indexOf(e.commentData.uuid)&&(e.view.setDisplayFlag(!0),F.push(e.commentData.uuid),F.length===P.size&&F.forEach(function(e){const t=P.get(e);t&&t.view.setDisplayFlag(!0,!0)}))}this.buildPanel=function(n){x.cleanPanel(),e||(e=r.createElement("div",{id:"DMUCommentsPanelMainDiv"})),e.setStyles({height:"100%"});let l=r.createElement("div",{class:"DMUCommentsPanelSectionMainDiv"}).inject(e);return a=new o({draggable:!0,onDragStart:function(){return w||""},sectionLabel:n.panelTitle,cmdList:n.contextualCmdList,quickAccessBtnList:n.quickAccessBtnList}),l.appendChild(a.getContent()),y=n.allowReplies,v=r.createElement("div",{class:"DMUCommentsPanelMainContainer"}),(t=(new i).inject(l)).getInnerElement().setContent(v),t.getInnerElement().addEventListener("scroll",O),t.getContent().setStyle("flex",1),z(),e},this.addMarkup=function(e){a.closeContextualSectionHeader(),e.id&&(b||(b=new f({onCurrentMarkupChanged:e=>{j("onSetCurrentMarkup",e)},onMarkupRenamed:(e,t)=>{j("onMarkupRenamed",{id:e,title:t})},onContextMenuRequested:function(e){let t=e.event.touchFlag?e.event.touches[0]:e.event,i={x:t.pageX||t.screenX||0,y:t.pageY||t.screenY||0};j("onMarkupCtxMenuRequired",{id:e.id,position:new n.Vector2(i.x,i.y)})}}),a.getContent().appendChild(b.getContent()),b.setVisibility(!E)),b.addMarkup({id:e.id,name:e.title,owner:e.owner}))},this.removeMarkup=function(e){b&&b.removeMarkup(e)},this.editMarkupName=function(e){b&&b.startMarkupNameEdition(e)},this.setCurrentMarkup=function(e){b&&b.setCurrentMarkup(e)},this.setAllowReplies=(e=>{y=e}),this.addComment=function(e){if(!e||!P)return;W(e),e.date=c.formatDate(e.dateInMs);let t=new s({commentData:e,allowReplies:y,onClickCB:A,onReplyCB:V,onEditionEndCB:L,onEnterCB:N,onLeaveCB:N,onNewMentionsCB:({target:e,mentions:t})=>{j("onNewMentions",{commentId:e.uuid,mentions:t})},onCheckSelectedCB:({target:e,check:t})=>{j("onCommentCheckSelected",{dmuObject:e.dmuObject,checkId:t.id})},onCtxMenuCB:function(e){let t=e.event.touchFlag?e.event.touches[0]:e.event;j("onCommentCtxMenuRequired",{target:e.target,shiftKeyPressed:e.event.shiftKey,ctrlKeyPressed:e.event.ctrlKey,position:new n.Vector2(t.pageX?t.pageX:t.screenX,t.pageY?t.pageY:t.screenY)})}}),i=R({page:e.pointedPage,element:e.pointedElement});if(i){i.commentIds.push(e.uuid);const n=t.getCommentDiv();n&&i.view.appendChild(n),P.set(e.uuid,{containerId:i.id,commentData:e,view:t,replies:new Map}),t.setCtxMenuAvailability(!E),e.pointedPosition&&H(i),e.replies&&e.replies.length&&e.replies.forEach(function(t){x.addReply(t,e.uuid)}),t.updateRepliesCount(e.replies&&e.replies.length?e.replies.length:0),q(i),z()}},this.updateComment=function(e,t){if(!e||!P)return;const n=P.get(e.uuid);if(n){let i=R({page:e.pointedPage,element:e.pointedElement});W(e);let o=T({element:e.pointedElement,page:e.pointedPage});if(o&&o!==n.containerId&&(function(e,t,n){const i=R(t);if(i){i.view.removeChild(e.view.getCommentDiv()),0===i.view.childElementCount?(i.view.remove(),U.delete(i.id)):i.commentIds.splice(i.commentIds.indexOf(e.commentData.uuid),1);const t=R(n);t&&(t.commentIds.push(e.commentData.uuid),t.view.appendChild(e.view.getCommentDiv()))}}(n,{containerId:n.containerId},{page:e.pointedPage,element:e.pointedElement}),n.containerId=o,(i=R({page:e.pointedPage,element:e.pointedElement}))&&H(i)),e.pointedPosition&&t&&i&&H(i),e.date=c.formatDate(n.commentData.dateInMs),e.isPreview?n.view.addInformationIcon({id:"favoriteComment",fontIcon:"wux-ui-3ds-favorite-on"}):n.view.removeInformationIcon("favoriteComment"),e.highlights&&e.highlights.length){let t={id:"",rating:"0"};e.highlights.forEach(e=>{(5===parseInt(e.rating)?0:parseInt(e.rating))>=(5===parseInt(t.rating)?0:parseInt(t.rating))&&(t=e)}),n.view.addInformationIcon({id:"highlightData",fontIcon:p[t.rating].icon,color:p[t.rating].color,onClick:function(){var i;(null===(i=e.highlights)||void 0===i?void 0:i.length)&&j("onCommentHighlightSelected",{highlightId:t.id,dmuObject:n.commentData.dmuObject})}}),n.view.hideReplyButton(!0)}else n.view.removeInformationIcon("highlightData"),n.view.hideReplyButton(!1);if(n.view.update(e),n.replies){let t=0;n.replies.forEach(n=>{e.replies&&(W(e.replies[t],e.uuid),e.replies[t].dateInMs&&(n.dateInMs=e.replies[t].dateInMs,e.replies[t].date=c.formatDate(e.replies[t].dateInMs)),e.replies[t].isPreview?n.view.addInformationIcon({id:"favoriteComment",fontIcon:"wux-ui-3ds-favorite-on"}):n.view.removeInformationIcon("favoriteComment"),n.view.update(e.replies[t])),t++})}i&&q(i)}},this.selectComment=function(e,n,i){if(!e)return;const o=P.get(e);o&&(o.view.updateDate(c.formatDate(o.commentData.dateInMs)),o.view.setInEdition(!0),o.replies.forEach(function(e){e.view.updateDate(c.formatDate(e.dateInMs))}),h||(h=[]),h.push(o.view),X(o),("number"==typeof n||i)&&(C&&clearTimeout(C),C=setTimeout(function(){if(t&&P&&o){let e=t.getInnerElement();if(e){let t=o.view.getCommentDiv();if(t){let o=e.scrollTop+t.getPosition().y;i?o-=e.offsetHeight/2-t.getSize().height/2:"number"==typeof n&&(o+=132-n),e.scrollTo({top:o,behavior:"smooth"})}}}C=null},100)))},this.preSelectComment=function(e){if(!e)return;const t=P.get(e);t&&(t.view.updateDate(c.formatDate(t.commentData.dateInMs)),t.view.setHovered(!0),t.replies.forEach(function(e){e.view.updateDate(c.formatDate(e.dateInMs))}),u||(u=[]),u.push(t.view))},this.removeComment=function(e){if(!e)return;const t=P.get(e);if(t){x.restoreCommentPreSelection(),x.restoreCommentSelection(),t.view.remove();let n=R({containerId:t.containerId});if(n){n.commentIds.splice(n.commentIds.indexOf(e),1),0===n.view.childElementCount?(n.view.remove(),U.delete(n.id)):q(n);const i=F.indexOf(t.commentData.uuid);-1!==i&&F.splice(i,1)}P.delete(e)}z()},this.addReply=function(e,t){if(!e)return;const i=P.get(t);if(i){W(e,t),e.date=c.formatDate(e.dateInMs);let o=new s({commentData:e,allowReplies:y,onClickCB:A,onEditionEndCB:L,onReplyCB:V,onCtxMenuCB:function(e){let t=e.event.touchFlag?e.event.touches[0]:e.event;j("onCommentCtxMenuRequired",{target:e.target,shiftKeyPressed:e.event.shiftKey,ctrlKeyPressed:e.event.ctrlKey,position:new n.Vector2(t.pageX?t.pageX:t.screenX,t.pageY?t.pageY:t.screenY)})},onNewMentionsCB:({target:e,mentions:t})=>{j("onNewMentions",{commentId:e.uuid,mentions:t})},onCheckSelectedCB:({target:e,check:t})=>{j("onCommentCheckSelected",{dmuObject:e.dmuObject,checkId:t.id})}});i.view.getCommentDiv().appendChild(o.getCommentDiv()),i.replies.set(e.uuid,{uuid:e.uuid,dateInMs:e.dateInMs,replyData:e,view:o}),o.setCtxMenuAvailability(!E),i.view.updateRepliesCount(i.replies.size);const l=R({containerId:i.containerId});l&&q(l)}},this.selectReply=function(e,t){if(!e||!t)return;const n=P.get(t);if(n){const t=n.replies.get(e);t&&(n.view.updateDate(c.formatDate(n.commentData.dateInMs)),n.view.setInEdition(!0),t.view.updateDate(c.formatDate(t.dateInMs)),t.view.setInEdition(!0),h||(h=[]),h.push(t.view),h.push(n.view),X(n))}},this.removeReply=function(e,t){if(!e||!t)return;const n=P.get(t);if(n){const t=n.replies.get(e);if(t){x.restoreCommentPreSelection(),x.restoreCommentSelection(),t.view.remove(),n.replies.delete(e),n.view.updateRepliesCount(n.replies.size);const i=R({containerId:n.containerId});i&&q(i)}}},this.getDivPositionFrom=function(e,n,i){if(!e)return;const o=P.get(e);if(o){let e=t.getInnerElement(),l=o.view.getCommentDiv().getPosition(n);l.y+=30;let a=e.getPosition(n);return i&&(a.x+=e.getDimensions().width,l.x+=e.getDimensions().width),l.y<a.y?a:l.y>a.y+e.getDimensions().height-10?{x:a.x,y:a.y+e.getDimensions().height-10}:l}},this.scrollPanelToContainer=function(e){if(!e)return;let n=R({containerId:T({number:e}),notCreate:!0});n&&(C&&clearTimeout(C),C=setTimeout(function(){if(t&&n){let e=t.getInnerElement();e&&e.scrollTo({top:e.scrollTop+n.view.getPosition().y,behavior:"smooth"})}C=null},100))},this.updatePanelHeader=function(e){a&&e&&(e.quickAccessBtnList&&a.setQuickAccessCommands(e.quickAccessBtnList),e.contextualCmdList&&a.setSubMenuCommands(e.contextualCmdList),e.panelTitle&&a.setHeaderLabel(e.panelTitle),void 0!==e.headerDrag&&a.enableHeaderDrag(e.headerDrag),e.quickAccessBtnAvailability&&a.setQuickAccessCommandActiveFlag(e.quickAccessBtnAvailability.id,e.quickAccessBtnAvailability.flag))},this.setDragContent=function(e){w=e},this.setReadOnlyFlag=function(e){E!==e&&(E=e,P&&P.forEach(function(t){t.view.setCtxMenuAvailability(!e),t.replies.forEach(function(t){t.view.setCtxMenuAvailability(!e)})}),b&&b.setVisibility(!e),z())},this.setRestrictedModeFlag=function(e){k=e,z()},this.setFilterViewFlag=function(e){if(M=e,e){b&&a.getContent().removeChild(b.getContent());const e=m.build(P,_,{onCancel:()=>{x.setFilterViewFlag(!1)},onOk:e=>{if(I.size&&(I.forEach(e=>{const[t,n]=e.split("/"),i=P.get(t);if(i&&(i.view.setVisibleFlag(!0),n)){const e=i.replies.get(n);e&&e.view.setVisibleFlag(!0)}}),U.forEach(e=>e.view.show())),_=e,!Object.keys(e).length)return x.setFilterViewFlag(!1),I.clear(),void j("onCommentFiltersApplied",{hasFilters:!1});P.forEach(t=>{const n=t.replies.values();for(let i=0;i<t.replies.size;i++){const t=n.next().value;if(m.commentMatchesFilters(t.replyData,e))return}m.commentMatchesFilters(t.commentData,e)?t.replies.size&&t.replies.forEach(e=>{e.view.setVisibleFlag(!1),I.add(t.commentData.uuid+"/"+e.replyData.uuid)}):(t.view.setVisibleFlag(!1),I.add(t.commentData.uuid))}),U.forEach(e=>{for(let t=0;t<e.view.children.length;t++)if("none"!==e.view.children[t].getStyle("display"))return;e.view.hide()}),x.setFilterViewFlag(!1),j("onCommentFiltersApplied",{hasFilters:!0})}});t.getInnerElement().setContent(e)}else b&&a.getContent().appendChild(b.getContent()),m.destroy(),t.getInnerElement().setContent(v)},this.getFilterViewFlag=(()=>M),this.hasFiltersApplied=(()=>!M&&Object.keys(_).length>0),this.isCommentFiltered=(e=>I.has(e)),this.resetCommentDisplayHistory=function(){F.forEach(function(e){const t=P.get(e);t&&t.view.setDisplayFlag(!1)}),F.length=0},this.enableContentEdition=function(e,t){const n=P.get(t||e);if(n)if(t){let t=n.replies.get(e);n.view.updateDate(c.formatDate(n.commentData.dateInMs)),n.view.setInEdition(!0),t&&(t.view.updateDate(c.formatDate(t.dateInMs)),t.view.setInEdition(!0),t.view.enableContentEdition()),h||(h=[]),h.push(n.view),X(n),t&&h.push(t.view)}else n.view.updateDate(c.formatDate(n.commentData.dateInMs)),n.view.setInEdition(!0),n.view.enableContentEdition(),X(n),h||(h=[]),h.push(n.view)},this.restoreCommentSelection=function(){h&&h.length&&(h.forEach(function(e){e.setInEdition(!1)}),h.length=0)},this.restoreCommentPreSelection=function(){u&&u.length&&(u.forEach(function(e){e.setHovered(!1)}),u.length=0)},this.setCommentLoading=function(e,t){const n=P.get(e);n&&n.view.setLoadingFlag(t)},this.setReviewVisuCheckFlag=function(e){a.closeContextualSectionHeader(),a.setAdditionalCheckBoxActiveFlag(0,e)},this.subscribe=function(e,t){return e&&t?B.subscribe({event:e},t):""},this.unsubscribe=function(e){null!=e&&B.unsubscribe(e)},this.cleanPanel=function(){if(x.restoreCommentPreSelection(),x.restoreCommentSelection(),U&&P.forEach(e=>e.view.remove()),U&&U.forEach(e=>e.view.remove()),e)for(;e.firstChild;)e.removeChild(e.firstChild);C&&clearTimeout(C),P.clear(),U.clear(),b&&b.remove(),z(),C=e=h=u=b=null},this.clear=function(){x.cleanPanel(),a&&a.clear(),t&&t.destroy(),S&&l.removeEventFromToken(S),D&&D.remove(),E=!1,B.destroy(),a=t=D=null}}}}),define("DS/DMUControls/DMUReviewExpander",["UWA/Core","UWA/Class","DS/Controls/Button","DS/Controls/Editor","DS/Controls/ComboBox","DS/DMUControls/DMUCustomExpander","DS/Utilities/TouchUtils","i18n!DS/DMUControls/assets/nls/DMUControls"],function(e,t,n,i,o,l,a,s){"use strict";var r=0;return t.extend({init:function(t){var d=t||{};this._parent(d),r++;var c,h,u,m=this,g=!1,p=!1,f=d.objectData,v=d.icons,C=0,w=0,y=0,b=0;this.getContent=function(){return O.getContent()},this.getMainDiv=function(){return O},this.inject=function(e){return O.getContent().inject(e),m};var D=e.createElement("div",{id:"expanderView_"+r+"_"+f.id,class:"DMUReviewExpanderContainer"});this.destroy=function(){O.getContent().destroy()},this.expand=function(){O.expand()},this.collapse=function(){O.collapse()},this.setCheckComboValue=function(e){g=e},this.setHighlightComboValue=function(e){p=e},this.unselect=function(){O.setSelectedFlag(!1)},this.updateAdditionalDiv=function(){var t,n,i,o,l={};"Check"===d.type?(C>0&&(t=new e.Element("div",{class:"additionalDiv1"}),new e.Element("div",{text:C,class:"number"}).inject(t),new e.Element("span",{class:"additionalDivIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-target"}).inject(t),l.additionalDiv1=t),w>0&&(n=new e.Element("div",{class:"additionalDiv2"}),new e.Element("div",{text:w,class:"number"}).inject(n),new e.Element("span",{class:"additionalDivIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-level-medium"}).inject(n),l.additionalDiv2=n)):"Highlight"===d.type&&(b>0&&(i=new e.Element("div",{class:"additionalDiv1"}),new e.Element("div",{text:b,class:"number"}).inject(i),new e.Element("span",{class:"additionalDivIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-change"}).inject(i),l.additionalDiv1=i),y>0&&(o=new e.Element("div",{class:"additionalDiv2"}),new e.Element("div",{text:y,class:"number"}).inject(o),new e.Element("span",{class:"additionalDivIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-issue-type"}).inject(o),l.additionalDiv2=o)),O.setAdditionalDiv(l)},this.deactivatePlusButtons=function(){var e=O.getContent().getElementsByClassName("highlightsPanel-impCheckPlusButton");e.length&&(e[0].dsModel.checkFlag=!1);var t=O.getContent().getElementsByClassName("highlightsPanel-issuePlusButton");t.length&&(t[0].dsModel.checkFlag=!1);var n=O.getContent().getElementsByClassName("highlightsPanel-caPlusButton");n.length&&(n[0].dsModel.checkFlag=!1)},this.addImpactedCheck=function(t){if("Highlight"===d.type){var n=d.checkIcons[t.check.status-1],i=t.check.name,o=t.check.id,l=T.getElementsByClassName("highlightsPanel-impCheckDiv")[0];if(l){l.show();var a=new e.Element("span",{class:n.fonticonClass}).inject(l);a.addClassName("highlightsPanel-objectIcon"),a.id=f.id+"_"+o,a.setStyles({color:n.fonticonColor,width:"fit-content",margin:"auto"}),new e.Element("div",{text:i,class:"highlightsPanel-check",id:f.id+"_"+o}).inject(l).title=i;var s=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove"}).inject(l);l.show(),s.addClassName("highlightsPanel-impCheckRemoveButton"),s.id=o,s.hide(),s.onclick=function(){d.onImpactedCheckRemoved(f.id,this.id)}}}else{w+=1;var r=d.highlightIcons[t.highlight.rating-1],c=t.highlight.name,h=t.highlight.id,u=T.getElementsByClassName("checksPanel-editableImpHighlightDiv")[0];if(u){u.show();var m=new e.Element("span",{class:r.fonticonClass,id:f.id+"_"+h}).inject(u);m.addClassName("checksPanel-impHighlightIcon"),m.setStyles({color:r.fonticonColor,width:"fit-content",margin:"auto"}),new e.Element("div",{text:c,class:"checksPanel-impHighlight",id:f.id+"_"+h}).inject(u).title=c}}this.updateAdditionalDiv()},this.removeImpactedCheck=function(e,t){if("Highlight"===d.type){var n=O.getContent().getElementsByClassName("highlightsPanel-impCheckDiv")[0],i=n.getElementsByClassName("highlightsPanel-check"),o=n.getElementsByClassName("highlightsPanel-objectIcon"),l=n.getElementsByClassName("highlightsPanel-impCheckRemoveButton");for(let e=0;e<i.length;e++)i[e].id.split("_")[1]===t&&i[e].destroy();for(let e=0;e<o.length;e++)o[e].id.split("_")[1]===t&&o[e].destroy();for(let e=0;e<l.length;e++)l[e].id===t&&l[e].destroy()}else{w-=1;var a=O.getContent().getElementsByClassName("checksPanel-editableImpHighlightDiv"),s=a[0].getElementsByClassName("checksPanel-impHighlightIcon"),r=a[0].getElementsByClassName("checksPanel-impHighlight");for(let t=0;t<s.length;t++)s[t].id.split("_")[1]===e&&s[t].destroy();for(let t=0;t<r.length;t++)r[t].id.split("_")[1]===e&&r[t].destroy()}this.updateAdditionalDiv()},this.updateImpactedCheckDisplay=function(e){var t;let n=O.getContent().getElementsByClassName("highlightsPanel-check"),i=O.getContent().getElementsByClassName("highlightsPanel-objectIcon");if(e.name)for(let i=0;i<n.length;i++)t=n[i].id.split("_")[1],e.id===t&&n[i].setText(e.name);if(e.status)for(let n=0;n<i.length;n++)if(t=i[n].id.split("_")[1],e.id===t){var o=i[n];o.removeClassName(i[n].className),o.addClassName("highlightsPanel-objectIcon "+d.checkIcons[e.status-1].fonticonClass),o.setStyles({color:d.checkIcons[e.status-1].fonticonColor})}},this.updateAssociatedHighlightsDisplay=function(e){var t;let n=O.getContent().getElementsByClassName("checksPanel-impHighlight"),i=O.getContent().getElementsByClassName("checksPanel-impHighlightIcon");if(e.name)for(let i=0;i<n.length;i++)t=n[i].id.split("_")[1],e.id===t&&n[i].setText(e.name);if(e.rating)for(let n=0;n<i.length;n++)if(t=i[n].id.split("_")[1],e.id===t){var o=i[n];o.removeClassName(i[n].className),o.addClassName("checksPanel-impHighlightIcon "+d.highlightIcons[e.rating-1].fonticonClass),o.setStyles({color:d.highlightIcons[e.rating-1].fonticonColor})}},this.addIssue=function(t,n){y+=1,f.issues.push(t);var i=O.getContent().getElementsByClassName("highlightsPanel-issueDiv")[0];i.show();var o=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-issue-type"}).inject(i);o.setStyles({color:"#77797C"}),o.addClassName("highlightsPanel-issueIcon"),new e.Element("div",{text:n,class:"highlightsPanel-issue"}).inject(i).onclick=function(){d.onAttachedObjClicked(t)},this.updateAdditionalDiv()},this.addCA=function(t,n){b+=1,f.changeAction.push(t);var i=O.getContent().getElementsByClassName("highlightsPanel-changeActionDiv")[0];i.show(),new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-change"}).inject(i).addClassName("highlightsPanel-caIcon"),new e.Element("div",{text:n,class:"highlightsPanel-ca"}).inject(i).onclick=function(){d.onAttachedObjClicked(t)},this.updateAdditionalDiv()},this.addRequirement=function(t,n,i){C+=1,O.getContent().getElementsByClassName("checksPanel-requirementDropZone")[0].hide();var o=O.getContent().getElementsByClassName("checksPanel-checkExpanderBody")[0],l=new e.Element("div",{class:"checksPanel-requirementDiv"}).inject(o),a=new e.Element("span",{class:v[3].fonticonClass}).inject(l);a.addClassName("checksPanel-requirementIcon"),a.setStyles({color:v[3].fonticonColor});var s=new e.Element("div",{text:i,class:"checksPanel-requirement"});s.inject(l),s.onclick=function(){d.onAttachedObjClicked(n)};var r=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove"}).inject(l);r.addClassName("checksPanel-requirementRemoveButton"),r.id=t,r.hide(),r.onclick=function(){d.onRequirementRemove(this.id,n)},this.updateAdditionalDiv()},this.removeRequirement=function(){C-=1;var e=O.getContent().getElementsByClassName("checksPanel-requirementDropZone")[0];e.show(),e.removeClassName("checksPanel-reqDropZoneDrag"),O.getContent().getElementsByClassName("checksPanel-requirementPlusIcon")[0].hide(),O.getContent().getElementsByClassName("infoReq")[0].show(),O.getContent().getElementsByClassName("checksPanel-requirementDiv")[0].destroy(),this.updateAdditionalDiv()},this.updatePreview=function(){var e=O.getContent(),t=e.getElementsByClassName("highlightsPanel-editableHighlightThumbDiv");if(t[0].getElementsByClassName("DMUCommentMainDiv ").length)t[0].getElementsByClassName("lightCommentRepresentation")[0].isHidden()?(t[0].getElementsByClassName("lightCommentRepresentation")[0].show(),t[0].getElementsByClassName("normalCommentRepresentation")[0].hide()):(t[0].getElementsByClassName("lightCommentRepresentation")[0].hide(),t[0].getElementsByClassName("normalCommentRepresentation")[0].show());else{var n=e.getElementsByClassName("highlightsPanel-editableHighlightSlideBlock");t[0].isHidden()&&"false"===localStorage.getItem("DMUReviewPanel_ThumbnailShowState")?(t[0].show(),n[0].hide()):(t[0].hide(),n[0].show())}},this.updateRatingComboValues=function(){6===c.elementsList.length&&(c.elementsList=c.elementsList.slice(0,5))};var S=function(){if(f.description){var t=new e.Element("div",{text:f.description,class:"reviewPanel-description"});t.inject(T),t.setStyles({"grid-column":"1/2 span"})}},x=function(){var e;if("Check"===d.type)e=f.status?f.status:-1,(h=new o({elementsList:[{labelItem:s.reviewPanel.checkStatusInProgress,iconItem:{iconClasses:v[0].fonticonClass+" checkUNDIconColor"},valueItem:0},{labelItem:s.reviewPanel.checkStatusPassed,iconItem:{iconClasses:v[1].fonticonClass+" checkOKIconColor"},valueItem:1},{labelItem:s.reviewPanel.checkStatusFailed,iconItem:{iconClasses:v[2].fonticonClass+" checkKOIconColor"},valueItem:2}],enableSearchFlag:!1,value:-1===e?2:e-1}).inject(T)).getContent().addClassName("checksPanel-statusCombo"),h.getContent().id=f.id,h.elements.iconPlaceholder.style.marginRight="11px",a.getTouchMode()&&h.getContent().setStyles({width:"87%","margin-left":"29px"}),h.elements.mainElement.onclick=function(e){m.getMainDiv().isSelected()||m.getMainDiv().setSelectedFlag(!0,e)},h.elements.expander.onclick=function(e){m.getMainDiv().isSelected()||m.getMainDiv().setSelectedFlag(!0,e)},h.addEventListener("change",function(){g||d.onCheckAttributeChanged(this.id,"status",this.dsModel.value+1);var e=O.getContent().getElementsByClassName("DMUCustomExpHeaderFontIcon")[0];e.className=v[this.dsModel.value].fonticonClass+" DMUCustomExpHeaderFontIcon",e.setStyles({color:v[this.dsModel.value].fonticonColor,"font-size":"14px"}),g=!1});else{e=f.rating?f.rating:-1;let t=[];t.push({labelItem:s.reviewPanel.highlightRatingUrgent,iconItem:{iconClasses:v[5].fonticonClass+" highlightUrgentIconColor"},valueItem:5},{labelItem:s.reviewPanel.highlightRatingHigh,iconItem:{iconClasses:v[3].fonticonClass+" highlightHighIconColor"},valueItem:3},{labelItem:s.reviewPanel.highlightRatingMedium,iconItem:{iconClasses:v[2].fonticonClass+" highlightMediumIconColor"},valueItem:2},{labelItem:s.reviewPanel.highlightRatingLow,iconItem:{iconClasses:v[1].fonticonClass+" highlightLowIconColor"},valueItem:1},{labelItem:s.reviewPanel.highlightRatingProcessed,iconItem:{iconClasses:v[4].fonticonClass+" highlightProIconColor"},valueItem:4}),"1"===f.rating&&t.push({labelItem:s.reviewPanel.highlightRatingTBA,iconItem:{iconClasses:v[0].fonticonClass+" highlightTBAIconColor"},valueItem:0}),(c=new o({elementsList:t,enableSearchFlag:!1,value:-1===e?2:e-1}).inject(T)).getContent().addClassName("highlightsPanel-highlightRatingCombo"),c.getContent().id=f.id,c.elements.iconPlaceholder.style.marginRight="11px",a.getTouchMode()&&c.getContent().setStyles({width:"87%","margin-left":"29px"}),c.elements.mainElement.onclick=function(e){m.getMainDiv().isSelected()||m.getMainDiv().setSelectedFlag(!0,e)},c.elements.expander.onclick=function(e){m.getMainDiv().isSelected()||m.getMainDiv().setSelectedFlag(!0,e)},c.addEventListener("change",function(){p||d.onHighlightAttributeChanged(this.id,"rating",this.dsModel.value+1);var e=O.getContent().getElementsByClassName("DMUCustomExpHeaderFontIcon")[0];e.className=v[this.dsModel.value].fonticonClass+" DMUCustomExpHeaderFontIcon",e.setStyles({color:v[this.dsModel.value].fonticonColor,"font-size":"14px"}),p=!1})}},E=function(){(u=new i({value:f.description?f.description:"",widthInCharNumber:33,nbRows:4,newLineMode:"shiftEnter",placeholder:"Check"===d.type?s.reviewPanel.writeCheckDescription:s.reviewPanel.writeHighlightDescription}).inject(T)).getContent().id=f.id,u.getContent().addClassName("Check"===d.type?"checksPanel-checkDescriptionEditor":"highlightsPanel-highlightDescriptionEditor"),u.elements.container.getChildren()[0].setStyles({width:"100%"}),a.getTouchMode()&&u.elements.container.getChildren()[0].setStyles({"margin-left":"29px","margin-top":"7px",width:"87%"}),u.addEventListener("change",function(){d.onCheckAttributeChanged?d.onCheckAttributeChanged(this.id,"description",this.dsModel.value):d.onHighlightAttributeChanged(this.id,"description",this.dsModel.value)})},k=function(){if(f.requirements&&f.requirements.length>0){var t=new e.Element("div",{class:"checksPanel-requirementDiv"}).inject(T);for(let l=0;l<f.requirements.length;l++){C+=1;var n=new e.Element("span",{class:v[3].fonticonClass}).inject(t);n.addClassName("checksPanel-requirementIcon"),n.setStyles({color:v[3].fonticonColor});var i=f.requirements[l].id,o=f.requirements[l].getName()?f.requirements[l].getName():i;new e.Element("div",{id:i||f.requirements[l].getPlmID(),text:o||f.requirements[l].getPlmID(),class:"checksPanel-requirement"}).inject(t).onclick=function(){d.onAttachedObjClicked(this.id)}}}},M=function(){var t=new e.Element("div",{class:"highlightsPanel-editableHighlightThumbDiv"}).inject(T);if(a.getTouchMode()&&t.setStyles({"margin-top":"7px","margin-left":"26px"}),d.normalCommentRepresentation&&(d.normalCommentRepresentation.inject(t),d.normalCommentRepresentation.addClassName("normalCommentRepresentation"),"false"===localStorage.getItem("DMUReviewPanel_ThumbnailShowState")?d.normalCommentRepresentation.hide():d.normalCommentRepresentation.show()),d.lightCommentRepresentation)d.lightCommentRepresentation.inject(t),d.lightCommentRepresentation.addClassName("lightCommentRepresentation"),"false"===localStorage.getItem("DMUReviewPanel_ThumbnailShowState")?d.lightCommentRepresentation.show():d.lightCommentRepresentation.hide();else{var n=new e.Element("div",{class:"highlightsPanel-editableHighlightSlideBlock"}).inject(T);new e.Element("span",{class:"highlightsPanel-slideIcon"}).inject(n),new e.Element("div",{class:"highlightsPanel-slide"}).inject(n),"false"===localStorage.getItem("DMUReviewPanel_ThumbnailShowState")?(t.hide(),n.show()):(t.show(),n.hide())}},P=function(){var t,n=d.impChecksInfos[f.id],i=new e.Element("div",{class:"highlightsPanel-impCheckDiv",id:f.id}).inject(T);if(i.hide(),"facet"===d.panelType.type&&i.setStyles({"grid-row":"3"}),n){i.show();for(let o=0;o<n.length;o++)(t=new e.Element("span",{class:d.checkIcons[n[o].status-1].fonticonClass}).inject(i)).addClassName("highlightsPanel-objectIcon"),t.id=f.id+"_"+n[o].id,t.setStyles({color:d.checkIcons[n[o].status-1].fonticonColor,width:"fit-content",margin:"auto"}),new e.Element("div",{text:n[o].name,class:"highlightsPanel-check",id:f.id+"_"+n[o].id}).inject(i).title=n[o].name}},I=function(){var t,n,i=d.impChecksInfos[f.id],o=new e.Element("div",{class:"checksPanel-editableImpHighlightDiv"}).inject(T);if(a.getTouchMode()&&o.setStyles({"margin-left":"30px"}),o.hide(),i){o.show(),"reviewApp"===d.panelType.type&&!d.editionMode&&d.readOnly&&T.setStyles({"grid-template-row":" 20px"});for(let l=0;l<i.length;l++)w+=1,(t=new e.Element("span",{class:d.highlightIcons[i[l].rating-1].fonticonClass,id:f.id+"_"+i[l].id}).inject(o)).addClassName("checksPanel-impHighlightIcon"),t.setStyles({color:d.highlightIcons[i[l].rating-1].fonticonColor}),n=i[l].name,new e.Element("div",{text:n,class:"checksPanel-impHighlight",id:f.id+"_"+i[l].id}).inject(o).title=i[l].name}},U=function(){var t;new e.Element("div",{text:s.reviewPanel.issues,class:"highlightsPanel-issueTitle"}).inject(T);var i=new e.Element("div",{class:"highlightsPanel-issuePlaceholder"}).inject(T),o=new n({displayStyle:"lite",label:"add Impacted Check Button",icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS},type:"check",showLabelFlag:!1}).inject(i);o.getContent().id=f.id,o.getContent().addClassName("highlightsPanel-issuePlusButton"),o.getContent().getElementsByClassName("wux-button-icon-placeholder")[0].setStyles({"line-height":"12px"}),i.setStyles({"min-height":"12px"}),o.getContent().onclick=function(e){O.isSelected()&&e.stopPropagation()},o.getContent().addEventListener("change",function(){!0===this.dsModel.checkFlag&&(O.isSelected()||O.setSelectedFlag(!0),d.onAddIssueRequested(f.id,f.name))});var l=new e.Element("div",{class:"highlightsPanel-issueDiv",id:f.id}).inject(T);if(l.hide(),f.issues&&f.issues.length){l.show();for(let n=0;n<f.issues.length;n++)y+=1,(t=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-issue-type"}).inject(l)).setStyles({color:"#77797C"}),t.addClassName("highlightsPanel-issueIcon"),new e.Element("div",{id:f.issues[n].id,text:f.issues[n].name,class:"highlightsPanel-issue"}).inject(l).onclick=function(){d.onAttachedObjClicked(this.id)}}else l.hide()},B=function(){var t,n=new e.Element("div",{class:"highlightsPanel-issueDiv"}).inject(T);if("facet"===d.panelType.type&&n.setStyles({"grid-row":"4"}),n.hide(),f.issues){n.show();for(let i=0;i<f.issues.length;i++)y+=1,(t=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-issue-type"}).inject(n)).setStyles({color:"#77797C"}),t.addClassName("highlightsPanel-issueIcon"),new e.Element("div",{id:f.issues[i].id,text:f.issues[i].name,class:"highlightsPanel-issue"}).inject(n).onclick=function(){d.onAttachedObjClicked(this.id)}}},F=function(){new e.Element("div",{text:s.reviewPanel.changeActions,class:"highlightsPanel-caTitle"}).inject(T);var t=new e.Element("div",{class:"highlightsPanel-caPlaceholder"}).inject(T),i=new n({displayStyle:"lite",label:"add Impacted Check Button",icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS},type:"check",showLabelFlag:!1}).inject(t);a.getTouchMode()&&t.setStyles({"margin-top":"-9px"}),i.getContent().id=f.id,i.getContent().addClassName("highlightsPanel-caPlusButton"),i.getContent().getElementsByClassName("wux-button-icon-placeholder")[0].setStyles({"line-height":"12px"}),t.setStyles({"min-height":"12px"}),i.getContent().onclick=function(e){O.isExpanded()&&e.stopPropagation()},i.getContent().addEventListener("change",function(){!0===this.dsModel.checkFlag&&(O.isSelected()||O.setSelectedFlag(!0),d.onAddCARequested(f.id,f.name))});var o=new e.Element("div",{class:"highlightsPanel-changeActionDiv",id:f.id}).inject(T);if(o.hide(),f.changeAction&&f.changeAction.length){o.show();for(let t=0;t<f.changeAction.length;t++)b+=1,new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-change"}).inject(o).addClassName("highlightsPanel-caIcon"),new e.Element("div",{id:f.changeAction[t].id,text:f.changeAction[t].name,class:"highlightsPanel-ca"}).inject(o).onclick=function(){d.onAttachedObjClicked(this.id)}}else o.hide()},_=function(){var t=new e.Element("div",{class:"highlightsPanel-changeActionDiv"}).inject(T);if("facet"===d.panelType.type&&t.setStyles({"grid-row":"5"}),t.hide(),f.changeAction){t.show();for(let n=0;n<f.changeAction.length;n++)b+=1,new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-change"}).inject(t).addClassName("highlightsPanel-caIcon"),new e.Element("div",{id:f.changeAction[n].id,text:f.changeAction[n].name,class:"highlightsPanel-ca"}).inject(t).onclick=function(){d.onAttachedObjClicked(this.id)}}},T=new e.Element("div",{class:"Check"===d.type?"checksPanel-checkExpanderBody":"highlightsPanel-highlightExpanderBody"}).inject(D);"reviewApp"===d.panelType.type?d.editionMode&&!d.readOnly?("Check"===d.type&&(T.setStyles({"grid-template-rows":"auto"}),d.checkEditMode.canEditState?x():d.checkEditMode.canEditDef&&function(){let t;if("Check"===d.type){t=f.status?f.status:-1;const o=[{labelItem:s.reviewPanel.checkStatusInProgress,iconItem:{iconClasses:v[0].fonticonClass+" checkUNDIconColor",fonticonColor:v[0].fonticonColor},valueItem:0},{labelItem:s.reviewPanel.checkStatusPassed,iconItem:{iconClasses:v[1].fonticonClass+" checkOKIconColor",fonticonColor:v[1].fonticonColor},valueItem:1},{labelItem:s.reviewPanel.checkStatusFailed,iconItem:{iconClasses:v[2].fonticonClass+" checkKOIconColor",fonticonColor:v[2].fonticonColor},valueItem:2}][-1===t?2:t-1];var n=new e.Element("div",{class:"checksPanel-checkStatusDiv"}).inject(T);n.setStyles({"align-content":"center"});var i=new e.Element("span",{class:o.iconItem.iconClasses}).inject(n);i.addClassName("checksPanel-checkStatusIcon"),i.setStyles({color:o.iconItem.fonticonColor}),new e.Element("div",{text:o.labelItem,class:"checksPanel-checkStatus"}).inject(n)}}(),d.checkEditMode.canEditDef?(E(),function(){var t=new e.Element("div",{class:"checksPanel-requirementDropZone"}).inject(T);new e.Element("div",{text:s.reviewPanel.reqDropZoneInfo,class:"infoReq"}).inject(t);var n=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-plus",id:f.id}).inject(t);if(n.addClassName("checksPanel-requirementPlusIcon"),n.hide(),a.getTouchMode()&&t.setStyles({"margin-left":"29px"}),t.ondrop=function(e){e.preventDefault(),e.stopPropagation();var t=JSON.parse(e.dataTransfer.getData("Text"));t.data&&t.data.items&&t.data.items.length>0&&"Requirement"===t.data.items[0].objectType&&d.onRequirementDrop(f.id,t.data.items[0].objectId,t.data.items[0].displayName)},t.ondragenter=function(e){e.preventDefault(),e.stopPropagation(),this.getElementsByClassName("checksPanel-requirementPlusIcon")[0].show(),this.getElementsByClassName("infoReq")[0].hide(),this.addClassName("checksPanel-reqDropZoneDrag")},t.ondragleave=function(){this.getElementsByClassName("checksPanel-requirementPlusIcon")[0].hide(),this.getElementsByClassName("infoReq")[0].show(),this.removeClassName("checksPanel-reqDropZoneDrag")},t.ondragover=function(e){e.preventDefault(),e.stopPropagation()},t.ondragend=function(e){e.preventDefault(),e.stopPropagation()},f.requirements&&f.requirements.length>0){t.hide();var i=new e.Element("div",{class:"checksPanel-requirementDiv"}).inject(T);for(let t=0;t<f.requirements.length;t++){C+=1;var o=new e.Element("span",{class:v[3].fonticonClass}).inject(i);o.addClassName("checksPanel-requirementIcon"),o.setStyles({color:v[3].fonticonColor});var l=f.requirements[t].getPlmID(),r=f.requirements[t].getName();new e.Element("div",{id:l,text:r||l,class:"checksPanel-requirement"}).inject(i).onclick=function(){d.onAttachedObjClicked(this.id)};var c=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove"}).inject(i);c.addClassName("checksPanel-requirementRemoveButton"),c.id=f.id,c.hide(),c.onclick=function(){d.onRequirementRemove(this.id,f.requirements[0].getPlmID())}}}}()):(S(),k()),I()),"Highlight"===d.type&&(d.highlightEditMode.canEditDef?(x(),E(),M(),function(){new e.Element("div",{text:s.reviewPanel.impactedChecks,class:"highlightsPanel-impCheckTitle"}).inject(T);var t=new e.Element("div",{class:"highlightsPanel-impCheckPlaceholder"}).inject(T),i=new n({displayStyle:"lite",label:"add Impacted Check Button",icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS},type:"check",showLabelFlag:!1}).inject(t);i.getContent().addClassName("highlightsPanel-impCheckPlusButton"),i.getContent().getElementsByClassName("wux-button-icon-placeholder")[0].setStyles({"line-height":"12px"}),t.setStyles({"min-height":"12px"}),a.getTouchMode()&&t.setStyles({"margin-top":"-9px"}),i.getContent().addEventListener("change",function(){!0===this.dsModel.checkFlag?d.onSetImpactedCheckRequested(f.id):d.onSetImpactedCheckCanceled()});var o=new e.Element("div",{class:"highlightsPanel-impCheckDiv",id:f.id}).inject(T);o.hide();var l,r=d.impChecksInfos[f.id];if(r&&r.length){o.show();for(let t=0;t<r.length;t++){(l=new e.Element("span",{class:d.checkIcons[r[t].status-1].fonticonClass}).inject(o)).addClassName("highlightsPanel-objectIcon"),l.id=f.id+"_"+r[t].id,l.setStyles({color:d.checkIcons[r[t].status-1].fonticonColor,width:"fit-content",margin:"auto"}),new e.Element("div",{text:r[t].name,class:"highlightsPanel-check",id:f.id+"_"+r[t].id}).inject(o).title=r[t].name;var c=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove"}).inject(o);o.show(),c.addClassName("highlightsPanel-impCheckRemoveButton"),c.id=r[t].id,c.hide(),c.onclick=function(){d.onImpactedCheckRemoved(f.id,this.id)}}}else o.hide()}(),U(),"Document"!==d.contextType&&"Requirement"!==d.contextType&&"Requirement Specification"!==d.contextType&&F()):(T.setStyles({"grid-template-rows":"auto"}),S(),M(),P(),B(),_()))):(T.setStyles({"grid-template-rows":"auto"}),"Check"===d.type&&(S(),k(),I()),"Highlight"===d.type&&(S(),M(),P(),!d.readOnly&&(d.editionMode||!d.editionMode&&"ENOR3R_AP"!==d.panelType.app)&&d.highlightEditMode.canEditDef?(U(),"Document"!==d.contextType&&"Requirement"!==d.contextType&&"Requirement Specification"!==d.contextType&&F()):(B(),_()))):"facet"===d.panelType.type&&(T.setStyles({"padding-top":"5px"}),"Check"===d.type&&(d.checkEditMode.canEditState&&x(),S(),k(),I()),"Highlight"===d.type&&(d.highlightEditMode.canEditPriority&&x(),S(),P(),B(),_()));var R,j,A,N,L,V=(L={},"Check"===d.type?(C>0&&(R=new e.Element("div",{class:"additionalDiv1"}),new e.Element("div",{text:C,class:"number"}).inject(R),new e.Element("span",{class:"additionalDivIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-target"}).inject(R),L.additionalDiv1=R),w>0&&(j=new e.Element("div",{class:"additionalDiv2"}),new e.Element("div",{text:w,class:"number"}).inject(j),new e.Element("span",{class:"additionalDivIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-level-medium"}).inject(j),L.additionalDiv2=j)):"Highlight"===d.type?(b>0&&(A=new e.Element("div",{class:"additionalDiv1"}),new e.Element("div",{text:b,class:"number"}).inject(A),new e.Element("span",{class:"additionalDivIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-change"}).inject(A),L.additionalDiv1=A),y>0&&(N=new e.Element("div",{class:"additionalDiv2"}),new e.Element("div",{text:y,class:"number"}).inject(N),new e.Element("span",{class:"additionalDivIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-issue-type"}).inject(N),L.additionalDiv2=N)):"Validated"===d.type&&(L.additionalDiv1=d.validRemoveButton),L),O=new l({onLabelChanged:function(e){"Check"===d.type&&d.onCheckAttributeChanged(f.id,e.type,e.value),"Highlight"===d.type&&d.onHighlightAttributeChanged(f.id,e.type,e.value)},onExpandOrCollapse:"Check"===d.type?function(e){const{editionMode:t,checkEditMode:n,panelType:i}=d;e.state?(e.object.setAdditionalDivVisibleFlag(!1),e.object.setExpandOrCollapseButtonVisibleFlag(!0),e.object.setLabelEditionFlag(t&&n.canEditDef),e.object.setHeaderIconVisibleFlag(!n.canEditDef&&!n.canEditState||"facet"!==i.type&&!t),e.object.expandOrCollapseAtClick(!1)):(e.object.setExpandOrCollapseButtonVisibleFlag(!1),e.object.setHeaderIconVisibleFlag(!0),e.object.setAdditionalDivVisibleFlag(!0),e.object.setLabelEditionFlag(!1),e.object.expandOrCollapseAtClick(!0))}:function(e){e.state?(e.object.setAdditionalDivVisibleFlag(!1),e.object.setExpandOrCollapseButtonVisibleFlag(!0),"facet"===d.panelType.type&&d.highlightEditMode.canEditPriority?(e.object.setHeaderIconVisibleFlag(!1),e.object.setLabelEditionFlag(!1)):d.editionMode&&d.highlightEditMode.canEditDef&&(e.object.setHeaderIconVisibleFlag(!1),e.object.setLabelEditionFlag(!0)),e.object.expandOrCollapseAtClick(!1),"Highlight"===d.type&&d.onHighlightExpandCB&&d.onHighlightExpandCB({object:e.object.getContent(),id:f.id})):(e.object.setExpandOrCollapseButtonVisibleFlag(!1),e.object.setHeaderIconVisibleFlag(!0),e.object.setAdditionalDivVisibleFlag(!0),e.object.setLabelEditionFlag(!1),e.object.expandOrCollapseAtClick(!0))},onSelectedFlagChanged:function(e){e.state?("Validated"===d.type&&O.setAdditionalDivVisibleFlag(!0),d.onExpanderSelectedCB&&d.onExpanderSelectedCB({id:"Validated"===d.type||"Context"===d.type?m.getContent().id?parseInt(m.getContent().id):f.id:m.getContent().id,element:O,type:d.type,event:e.event})):("Validated"===d.type&&O.setAdditionalDivVisibleFlag(!1),d.onExpanderUnselectCB&&d.onExpanderUnselectCB({id:"Validated"===d.type||"Context"===d.type?m.getContent().id?parseInt(m.getContent().id):f.id:m.getContent().id,element:O,type:d.type}))}});O.build({fontIcon:"Check"===d.type?v[d.objectData.status-1].fonticonClass:"Highlight"===d.type?v[d.objectData.rating-1].fonticonClass:void 0,fontIconColor:"Check"===d.type?v[d.objectData.status-1].fonticonColor:"Highlight"===d.type?v[d.objectData.rating-1].fonticonColor:void 0,icon:"Validated"===d.type||"Context"===d.type?d.objectData.icon:void 0,label:d.objectData.name,additionalDiv:V,body:D,checkEditMode:!("Check"!==d.type||!d.editionMode)&&d.checkEditMode,highlightEditMode:"Highlight"===d.type&&d.editionMode?d.highlightEditMode:null}),"Highlight"===d.type&&(O.getContent().draggable=!0,O.getContent().ondragstart=function(e){var t=d.onHighlightDragStart(e);e.dataTransfer.setData("text",t)}),O.setReadOnly(!1),"Validated"!==d.type&&"Context"!==d.type||O.expandOrCollapseAtClick(!1),d.editionMode||(O.setLabelEditionFlag(!1),O.setHeaderIconVisibleFlag(!0))}})}),define("DS/DMUControls/panels/DMUHighlightsPanel",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS","UWA/Controls/ThemedScroller","DS/DMUControls/DMUReviewExpander","DS/Controls/Expander","DS/Controls/Button","DS/Utilities/TouchUtils","DS/Windows/Dialog","DS/CoreEvents/ModelEvents","DS/DMUControls/EXPNotify","DS/DMUBaseExperience/DMUContextManager","DS/CATWebUXComponents/CATWebUXSectionHeader","DS/DMUBaseExperience/EXPToolsContext","DS/Controls/TooltipModel","DS/Menu/ContextualMenu","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,l,a,s,r,d,c,h,u,m,g,p,f){"use strict";return t.extend({init:function(t){var n,l;this._parent(t);var s,c,h,m,g,p,v,C,w,y,b,D,S,x,E,k=[],M=new d,P=[],I=[];let U,B,F,_;var T=function(e,t){return M.publish({event:e,data:t,context:this})};this.subscribe=function(e,t){if(e&&t)return M.subscribe({event:e},t)},this.getColumnMinimumWidth=function(){return 273},this.getColumnWidthStep=function(){return 240},this.setRestrictions=(e=>{F=e}),this.getSectionHeader=function(){return m},this.deactiveButtons=function(){for(let e=0;e<k.length;e++)"Highlight"===k[e].type&&k[e].expander.deactivatePlusButtons()},this.expandAll=function(){for(let e=0;e<k.length;e++)k[e].expander.expand()},this.collapseAll=function(){for(let e=0;e<k.length;e++)k[e].expander.collapse()},this.updatePanel=(()=>{C.destroy(),(C=this.buildHighlights(localStorage.getItem("DMUReviewPanel_highlightExpandedFlags"))).inject(w)}),this.setPanelReadOnlyFlag=function(e){g=e.editionMode,n=e.readOnly,C.destroy();var t=localStorage.getItem("DMUReviewPanel_highlightExpandedFlags");(C=this.buildHighlights(t)).inject(w)},this.addIssue=function(e){I[e.highlightId].issues.push(e.id);for(let t=0;t<k.length;t++)k[t].id===e.highlightId&&k[t].expander.addIssue(e.id,e.name)},this.addCa=function(e){I[e.highlightId].changeAction.push(e.id);for(let t=0;t<k.length;t++)k[t].id===e.highlightId&&k[t].expander.addCA(e.id,e.name)},this.getExpanders=function(){return k},this.updateSlidePreview=function(e){for(let i=0;i<k.length;i++)if(k[i].id===e.id){var t=k[i].expander.getContent().getElementsByClassName("highlightsPanel-thumbnail");t.length&&t[0].dsModel.remove();var n=k[i].expander.getContent().getElementsByClassName("highlightsPanel-editableHighlightThumbDiv");n.length&&n[0].destroy()}},this.updateHighlightAttributes=function(e){for(let o=0;o<k.length;o++)if(k[o].id===e.objectId){k[o].expander.getMainDiv().setLabel(e.name);var t=k[o].expander.getContent().getElementsByClassName("highlightsPanel-highlightDescriptionEditor");t.length&&(t[0].dsModel.value=e.description,O(e.objectId,"description",e.description));var n=k[o].expander.getContent().getElementsByClassName("highlightsPanel-highlightRatingCombo");if(n.length){var i;switch(e.priority){case"Low":i=2;break;case"Medium":i=3;break;case"High":i=4;break;case"Urgent":i=6}n[0].dsModel.value=i,O(e.objectId,"rating",i)}}},this.unsubscribe=function(e){null!=e&&M.unsubscribe(e)},this.updateImpactedCheckDisplay=function(e){if("Check"===e.type){let t=p.filter(t=>t.id===e.id)[0];e.name&&(t.name=e.name),e.status&&(t.status=e.status),e.description&&(t.description=e.description);for(let t=0;t<k.length;t++)"Highlight"===k[t].type&&k[t].expander.updateImpactedCheckDisplay(e)}},this.addImpactedCheck=function(e){var t=e.highlightId,n=e.highlightRating,i=e.highlightTitle,o=e.checkId,l=e.checkStatus,a=e.checkTitle;P[t]||(P[t]=[]),P[t].push({id:o,status:l,name:a}),P[o]||(P[o]=[]),P[o].push({id:t,rating:n,name:i});for(let e=0;e<k.length;e++)k[e].id===t&&k[e].expander.addImpactedCheck({check:{id:o,status:l,name:a}})},this.unSelectAllExpanders=function(){for(let t=0;t<k.length;t++){k[t].expander.getMainDiv().setSelectionVisibility(!1);var e=k[t].expander.getContent().getElementsByClassName("highlightsPanel-impCheckRemoveButton");if(e.length)for(let t=0;t<e.length;t++)e[t].hide()}},this.unSelectAllValidated=function(){for(let e=0;e<k.length;e++)"Validated"===k[e].type&&k[e].expander.getMainDiv().setSelectedFlag(!1)},this.unSelectExpander=function(e){for(let t=0;t<k.length;t++)k[t].id===e&&k[t].expander.getMainDiv().setSelectedFlag(!1)},this.updateHighlightDisplay=function(e){for(let n=0;n<e.length;n++)for(let i=0;i<k.length;i++)if(k[i].id===e[n]){var t=k[i].expander.getContent().getParent();k[i].expander.destroy(),t.destroy(),R(e[n])}0===v.length&&C.getElementsByClassName("highlightsPanel-noHighlightDisplay")[0].show()},this.removeImpactedCheck=function(e){var t=e.highlightId,n=e.checkId;for(let e=0;e<k.length;e++)k[e].id===t&&k[e].expander.removeImpactedCheck(t,n);let i=P[t];if(i){let e=-1;for(let t=0;t<i.length;t++)if(i[t]&&i[t].id===n){e=t;break}e>=0&&i.splice(e,1)}};var R=function(e){var t,n=[];for(t=0;t<v.length;t++)v[t].id!==e?n[v[t].id]={name:v[t].name,id:v[t].id,description:v[t].description,issues:v[t].issues,changeAction:v[t].changeAction,rating:v[t].rating,associatedCheck:v.associatedCheck,expander:I[v[t].id].expander}:(v.splice(t,1),t-=1);for(t=0;t<k.length;t++)k[t].id===e&&k.splice(t,1);for(t=0;t<k.length;t++)k[t].index=t;I=[],I=n},j=function(e){for(let t=0;t<v.length;t++)for(let n=0;n<v[t].associatedCheck.length;n++)if(v[t].associatedCheck[n]===e){v[t].associatedCheck.splice(n,1),I[v[t].id].associatedCheck.splice(n,1);break}};this.updateHighlightSeverity=function(e,t){for(let i=0;i<k.length;i++)if(k[i].id===e){k[i].rating=t,k[i].expander.setHighlightComboValue(!0);var n=k[i].expander.getContent().getElementsByClassName("highlightsPanel-highlightRatingCombo");n.length&&(k[i].expander.updateRatingComboValues(),n[0].dsModel.value=t-1)}},this.updateCheckDisplay=function(e){for(let t=0;t<e.length;t++){j(e[t]);for(let n=0;n<k.length;n++)"Highlight"===k[n].type&&k[n].expander.removeImpactedCheck(e[t])}};var A=function(t,n){var i=e.createElement("div",{class:"DMURemoveValidatedMainDiv"});new e.Element("div",{text:f.reviewPanel.removeImpactedCheck,class:"warningMessage"}).inject(i);var o=new a({emphasize:"primary",label:f.reviewPanel.YesBtn?f.reviewPanel.YesBtn:"Yes",onClick:function(){T("onImpCheckRemoveRequested",{highlightId:t,checkId:n}),B&&B.destroy()}});o.getContent().addClassName("confirmRemoveButton");var s=new a({label:f.reviewPanel.NoBtn?f.reviewPanel.NoBtn:"No",onClick:function(){B&&B.destroy()}});B=new r({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:f.reviewPanel.removeImpactedCheckTitle,resizableFlag:!0,immersiveFrame:l.getImmersiveFrame(),buttons:{Ok:o,Cancel:s},width:400,content:i})},N=function(e){var t,n=0;for(let t=0;t<k.length;t++)e.id===k[t].id?n=k[t].index:!e.element.isCheckBoxClicked()&&e.element.isSelected()&&(!e.event||e.event.shiftKey||e.event.ctrlKey||k[t].expander.getMainDiv().setSelectedFlag(!1));if("Highlight"===e.type){var i=e.element.getContent().getElementsByClassName("highlightsPanel-impCheckRemoveButton");if(i.length)for(let e=0;e<i.length;e++)i[e].show();t={event:e.event,element:e.element,index:n,expanders:k},T("onExpanderSelectionRequested",t)}},L=function(e){var t=e.element.getContent().getElementsByClassName("highlightsPanel-impCheckRemoveButton");if(t.length)for(let e=0;e<t.length;e++)t[e].hide();var n={id:e.id,type:e.type,expanders:k};T("onExpanderUnselectRequested",n)},V=function(e){D(e)};this.highlightUpdatePreview=function(){for(var e=0;e<k.length;e++)"Highlight"===k[e].type&&k[e].expander.updatePreview();"false"===localStorage.getItem("DMUReviewPanel_ThumbnailShowState")?localStorage.setItem("DMUReviewPanel_ThumbnailShowState",!0):localStorage.setItem("DMUReviewPanel_ThumbnailShowState",!1)},this.scrollToHighlight=function(e,t){if(e&&e.dmuObject&&e.highlightId){var n,i=e.dmuObject.getAttribute("sUuid");for(let t=0;t<k.length;t++)k[t].slideId===i&&(k[t].id===e.highlightId&&(n=k[t]),k[t].expander.getMainDiv().setSelectedFlag(!0));n&&(E&&clearTimeout(E),E=setTimeout(function(){if(h){let e=h.getInnerElement();if(e){let i=n.expander.getContent();if(i){let o=e.scrollTop+i.getPosition().y;e.scrollTo({top:o,behavior:"smooth"}),n.expander.getMainDiv().expand(),t()}}}E=null},100))}},this.getImpactedChecksById=function(){for(var e=0;e<v.length;e++){I[v[e].id]=v[e];var t=v[e].associatedCheck;if(t)for(var n=0;n<t.length;n++){P[v[e].id]||(P[v[e].id]=[]);for(let i=0;i<p.length;i++)t[n]===p[i].id&&P[v[e].id].push({id:p[i].id,status:p[i].status,name:p[i].name})}}},this.updateHeaderIcon=function(e,t){for(let n=0;n<k.length;n++)k[n].id===parseInt(e)&&k[n].expander.getMainDiv().setIcon({icon:t})},this.updateHeaderLabel=function(e,t){for(let n=0;n<k.length;n++)k[n].id===parseInt(e)&&k[n].expander.getMainDiv().setLabel(t)};var O=function(e,t,n){"name"===t&&T("onHighlightAttributeChanged",{objectId:e,name:n}),"rating"===t&&T("onHighlightAttributeChanged",{objectId:e,rating:n}),"description"===t&&T("onHighlightAttributeChanged",{objectId:e,description:n})},H=function(e){T("onImpCheckRequested",{objectId:e})},W=function(){T("onImpCheckCancelCmd")},q=function(e,t){var n=-1;for(let t=0;t<k.length;t++)if(e===k[t].id){n=k[t].index;break}T("onIssueAddRequested",{id:e,name:t,index:n,expanders:k})},z=function(e,t){var n=-1;for(let t=0;t<k.length;t++)if(e===k[t].id){n=k[t].index;break}T("onCaAddRequested",{id:e,name:t,index:n,expanders:k})},X=function(e){return S(e.target.id,I[e.target.id].name)};this.buildPanel=function(t){var o=localStorage.getItem("DMUReviewPanel_highlightExpandedFlags");return v=t.highlights,p=t.checks,y=t.icons,b=t.highlightIcons,D=t.onHighlightExpand,S=t.getHighlightDragContent,x=t.onAttachedObjClicked,n=t.readOnlyFlag,l=t.frmWindow,g=t.editionMode,U=t.contextType,_=t.appId,F=t.restrictions,this.getImpactedChecksById(),c||(c=e.createElement("div",{class:"DMUHighlightsPanelMainDiv"})),c.setStyles({height:"100%","overflow-y":"hidden"}),(m=new u({draggable:!1,height:60..toString()+"px",onDragStart:function(){return t.reviewDragContent||""},sectionLabel:f.reviewPanel.highlightsPanelHeaderTitle,cmdList:t.contextualCmdList,quickAccessBtnList:t.quickAccessBtnList,doubleClickCB:function(){T("onPanelResized")}})).getContent().addClassName("reviewPanelSectionHeader"),m.getContent().getElementsByClassName("CATWebUXSectionHeaderLabel")[0].setStyles({"padding-left":"7px"}),c.appendChild(m.getContent()),w=e.createElement("div",{class:"highlightsPanel-highlightsContent"}),(C=this.buildHighlights(o)).inject(w),(h=(new i).inject(c)).getInnerElement().setContent(w),h.getContent().setStyle("height","calc(100% - 40px)"),c},this.updateReviewPanelContent=function(e){e.reviewNoContextMode?C.visibleFlag=!1:C.visibleFlag=!0},this.cleanPanel=function(){if(c){for(;c.firstChild;)c.removeChild(c.firstChild);m&&m.clear(),h&&h.destroy(),m=h=c=null}},this.buildHighlights=function(){s=new e.Element("div",{class:"highlightsPanel-highlightsExpanders"});var t,i=new e.Element("div",{text:f.reviewPanel.noHighlight,class:"highlightsPanel-noHighlightDisplay"});for(i.inject(s),v.length&&i.hide(),t=0;t<v.length;t++){var l=new e.Element("div",{class:"flowContainer"}).inject(s),a=new o({objectData:v[t],editionMode:g,readOnly:n,highlightEditMode:F.highlight,onHighlightAttributeChanged:O,onSetImpactedCheckRequested:H,onSetImpactedCheckCanceled:W,onImpactedCheckRemoved:A,onHighlightExpandCB:V,onExpanderSelectedCB:N,onExpanderUnselectCB:L,onAddIssueRequested:q,onAddCARequested:z,onHighlightDragStart:X,onAttachedObjClicked:x,icons:b,checkIcons:y,impChecksInfos:P,type:"Highlight",panelType:{type:"reviewApp",app:_},contextType:U}).inject(l);k.push({expander:a,id:v[t].id,index:k.length,rating:v[t].rating,slideId:v[t].slideId,type:"Highlight"}),a.getContent().id=v[t].id}return s},this.addNewHighlight=function(t){v.push({name:t.name,id:t.id,description:t.description,issues:t.issues,changeAction:t.changeAction,rating:t.rating,associatedCheck:t.associatedCheck?t.associatedCheck:[],type:"DMUValidationExposedPresentation",slideId:t.slideObject.getAttribute("sUuid")}),I[t.id]={name:t.name,rating:t.rating,description:t.description,id:t.id,issues:[],changeAction:[]},s.getElementsByClassName("highlightsPanel-noHighlightDisplay")[0].hide();var i=new e.Element("div",{class:"flowContainer"}).inject(s),l=new o({objectData:t,editionMode:g,normalCommentRepresentation:t.normalComment?t.normalComment:void 0,lightCommentRepresentation:t.lightComment?t.lightComment:void 0,readOnly:n,onHighlightAttributeChanged:O,onSetImpactedCheckRequested:H,onSetImpactedCheckCanceled:W,onImpactedCheckRemoved:A,onHighlightExpandCB:V,onExpanderSelectedCB:N,onExpanderUnselectCB:L,onAddIssueRequested:q,onAddCARequested:z,onAttachedObjClicked:x,icons:b,checkIcons:y,impChecksInfos:P,type:"Highlight",panelType:{type:"reviewApp",app:_},contextType:U,highlightEditMode:F.highlight}).inject(i);k.push({expander:l,id:t.id,index:k.length,rating:t.rating,slideId:t.slideObject.getAttribute("sUuid"),type:"Highlight"}),l.getContent().id=t.id,l.getContent().draggable=!0,l.getContent().ondragstart=function(e){var t=S(e.target.id,I[e.target.id].name);e.dataTransfer.setData("text",t)},l.getMainDiv().setSelectedFlag(!0),l.getMainDiv().expand()},this.setPanelQuickAccessCommands=function(e){m&&(m.closeContextualSectionHeader(),m.setQuickAccessCommands(e))}}})}),define("DS/DMUControls/panels/DMUChecksPanel",["UWA/Core","UWA/Class","UWA/Controls/ThemedScroller","DS/DMUControls/DMUReviewExpander","DS/Controls/Button","DS/Utilities/TouchUtils","DS/Windows/Dialog","DS/CoreEvents/ModelEvents","DS/DMUControls/EXPNotify","DS/CATWebUXComponents/CATWebUXSectionHeader","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,l,a,s,r,d,c){"use strict";return t.extend({init:function(t){var l,r;this._parent(t);var h,u,m,g,p,f,v,C,w,y,b,D,S,x=[],E=new s,k=[],M=[];let P,I;var U,B=function(e,t){return E.publish({event:e,data:t,context:this})};this.subscribe=function(e,t){if(e&&t)return E.subscribe({event:e},t)},this.getColumnMinimumWidth=function(){return 273},this.getColumnWidthStep=function(){return 240},this.setRestrictions=(e=>{P=e}),this.getSectionHeader=function(){return g},this.expandAll=function(){for(let e=0;e<x.length;e++)x[e].expander.expand()},this.collapseAll=function(){for(let e=0;e<x.length;e++)x[e].expander.collapse()},this.getExpanders=function(){return x},this.updatePanel=(()=>{C.destroy(),x=x.filter(e=>"Check"!==e.type),(C=this.buildChecks(localStorage.getItem("DMUReviewPanel_checkExpandedFlags"))).inject(w)}),this.setPanelReadOnlyFlag=function(e){p=e.editionMode,l=e.readOnly,C.destroy();var t=localStorage.getItem("DMUReviewPanel_checkExpandedFlags");(C=this.buildChecks(t)).inject(w)},this.removeRequirement=function(e){for(let t=0;t<x.length;t++)x[t].id===e.checkId&&x[t].expander.removeRequirement()},this.scrollToCheck=function(e,t){if(e&&e.checkId){var n;for(let t=0;t<x.length;t++)x[t].id===e.checkId&&(n=x[t],x[t].expander.getMainDiv().setSelectedFlag(!0));n&&(U&&clearTimeout(U),U=setTimeout(function(){if(m){let e=m.getInnerElement();if(e){let i=n.expander.getContent();if(i){let o=e.scrollTop+i.getPosition().y;e.scrollTo({top:o,behavior:"smooth"}),n.expander.getMainDiv().expand(),t()}}}U=null},100))}},this.addRequirement=function(e){for(let t=0;t<x.length;t++)x[t].id===e.checkId&&x[t].expander.addRequirement(e.checkId,e.requirementId,e.requirementTitle)},this.unsubscribe=function(e){null!=e&&E.unsubscribe(e)};var F=function(t,n){var i=e.createElement("div",{class:"DMURemoveValidatedMainDiv"});new e.Element("div",{text:c.reviewPanel.removeRequirement,class:"warningMessage"}).inject(i);var l=new o({emphasize:"primary",label:c.reviewPanel.YesBtn?c.reviewPanel.YesBtn:"Yes",onClick:function(){B("onRequirementRemoveRequested",{type:"ValidationRequirement",checkId:t,objectId:n}),y&&y.destroy()}});l.getContent().addClassName("confirmRemoveButton");var s=new o({label:c.reviewPanel.NoBtn?c.reviewPanel.NoBtn:"No",onClick:function(){y&&y.destroy()}});y=new a({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:c.reviewPanel.removeImpactedCheckTitle,resizableFlag:!0,immersiveFrame:r.getImmersiveFrame(),buttons:{Ok:l,Cancel:s},width:400,content:i})};this.removeImpactedCheck=function(e){var t=e.highlightId,n=e.checkId;for(let e=0;e<x.length;e++)x[e].id===n&&x[e].expander.removeImpactedCheck(t,n);let i=k[n];if(i){let e=-1;for(let n=0;n<i.length;n++)if(i[n]&&i[n].id===t){e=n;break}e>=0&&i.splice(e,1)}},this.updateImpactedCheckDisplay=function(e){if("Highlight"===e.type){let t=v.filter(t=>t.id===e.id)[0];e.name&&(t.name=e.name),e.rating&&(t.rating=parseInt(e.rating)),e.description&&(t.description=e.description);for(let t=0;t<x.length;t++)"Check"===x[t].type&&x[t].expander.updateAssociatedHighlightsDisplay(e)}},this.addImpactedCheck=function(e){var t=e.highlightId,n=e.highlightRating,i=e.highlightTitle,o=e.checkId;k[o]||(k[o]=[]),k[o].push({id:t,rating:n,name:i});for(let e=0;e<x.length;e++)x[e].id===o&&x[e].expander.addImpactedCheck({highlight:{id:t,rating:n,name:i}})},this.unSelectAllExpanders=function(){for(let e=0;e<x.length;e++)x[e].expander.getMainDiv().setSelectionVisibility(!1)},this.unSelectAllValidated=function(){for(let e=0;e<x.length;e++)"Validated"===x[e].type&&x[e].expander.getMainDiv().setSelectedFlag(!1)},this.unSelectExpander=function(e){for(let t=0;t<x.length;t++)x[t].id===e&&x[t].expander.getMainDiv().setSelectedFlag(!1)},this.updateCheckStatus=function(e,t){for(let i=0;i<x.length;i++)if(x[i].id===e){x[i].expander.setCheckComboValue(!0);var n=x[i].expander.getContent().getElementsByClassName("checksPanel-statusCombo");n.length&&(n[0].dsModel.value=t-1)}},this.updateCheckDisplay=function(e){for(let n=0;n<e.length;n++){for(let i=0;i<x.length;i++)if(x[i].id===e[n]){var t=x[i].expander.getContent().getParent();x[i].expander.destroy(),t.destroy()}_(e[n])}0===f.length&&C.getElementsByClassName("checksPanel-noCheckDisplay")[0].show()};var _=function(e){var t,n=[];for(t=0;t<f.length;t++)f[t].id!==e?n[f[t].id]={name:f[t].name,id:f[t].id,requirements:f[t].requirements,status:f[t].status,expander:M[f[t].id].expander}:(f.splice(t,1),t-=1);for(t=0;t<x.length;t++)x[t].id===e&&x.splice(t,1);for(t=0;t<x.length;t++)x[t].index=t;M=[],M=n},T=function(e){var t,n=0;for(let t=0;t<x.length;t++)e.id===x[t].id?n=x[t].index:!e.element.isCheckBoxClicked()&&e.element.isSelected()&&(!e.event||e.event.shiftKey||e.event.ctrlKey||x[t].expander.getMainDiv().setSelectedFlag(!1));var i=e.element.getContent().getElementsByClassName("checksPanel-requirementRemoveButton");if(i.length)for(let t=0;t<i.length;t++)i[t].id===e.id&&i[t].show();t={event:e.event,element:e.element,index:n,expanders:x},B("onExpanderSelectionRequested",t)},R=function(e){var t=e.element.getContent().getElementsByClassName("checksPanel-requirementRemoveButton");if(t.length)for(let n=0;n<t.length;n++)t[n].id===e.id&&t[n].hide();var n={id:e.id,type:e.type,expanders:x};B("onExpanderUnselectRequested",n)};this.getImpactedChecksById=function(){for(var e=0;e<f.length;e++)M[f[e].id]=f[e];for(var t=0;t<v.length;t++){var n=v[t].associatedCheck;if(n)for(var i=0;i<n.length;i++)k[n[i]]||(k[n[i]]=[]),k[n[i]].push({id:v[t].id,rating:v[t].rating,name:v[t].name})}},this.updateHeaderIcon=function(e,t){for(let n=0;n<x.length;n++)x[n].id===parseInt(e)&&x[n].expander.getMainDiv().setIcon({icon:t})},this.updateHeaderLabel=function(e,t){for(let n=0;n<x.length;n++)x[n].id===parseInt(e)&&x[n].expander.getMainDiv().setLabel(t)};var j=function(e,t,n){"name"===t&&B("onCheckAttributeChanged",{objectId:e,name:n}),"status"===t&&B("onCheckAttributeChanged",{objectId:e,status:n}),"description"===t&&B("onCheckAttributeChanged",{objectId:e,description:n})},A=function(e,t,n){B("onRequirementAddRequested",{checkId:e,requirementId:t,requirementTitle:n})};this.buildPanel=function(t){var i=localStorage.getItem("DMUReviewPanel_checkExpandedFlags");return f=t.checks,v=t.highlights,b=t.icons,D=t.highlightIcons,S=t.onAttachedObjClicked,l=t.readOnlyFlag,r=t.frmWindow,p=t.editionMode,I=t.appId,P=t.restrictions,this.getImpactedChecksById(),u||(u=e.createElement("div",{class:"DMUChecksPanelMainDiv"})),u.setStyles({height:"100%","overflow-y":"hidden"}),(g=new d({draggable:!1,height:60..toString()+"px",onDragStart:function(){return t.reviewDragContent||""},sectionLabel:c.reviewPanel.checksPanelHeaderTitle,cmdList:t.contextualCmdList,quickAccessBtnList:t.quickAccessBtnList,doubleClickCB:function(){B("onPanelResized")}})).getContent().addClassName("reviewPanelSectionHeader"),g.getContent().getElementsByClassName("CATWebUXSectionHeaderLabel")[0].setStyles({"padding-left":"7px"}),u.appendChild(g.getContent()),w=e.createElement("div",{class:"checksPanel-checksContent"}),(C=this.buildChecks(i)).inject(w),(m=(new n).inject(u)).getInnerElement().setContent(w),m.getContent().setStyle("height","calc(100% - 40px)"),u},this.cleanPanel=function(){if(u){for(;u.firstChild;)u.removeChild(u.firstChild);g&&g.clear(),m&&m.destroy(),g=m=u=null}},this.buildChecks=function(){h=new e.Element("div",{class:"checksPanel-checksExpanders"});var t=new e.Element("div",{text:c.reviewPanel.noCheck,class:"checksPanel-noCheckDisplay"});t.inject(h),f.length>0&&t.hide();for(var n=0;n<f.length;n++){M[f[n].id]||(M[f[n].id]={name:f[n].name,status:parseInt(f[n].status),description:f[n].description,id:f[n].id});var o=new e.Element("div",{class:"flowContainer"}).inject(h),a=new i({objectData:f[n],editionMode:p,checkEditMode:P.check,readOnly:l,onCheckAttributeChanged:j,onRequirementDrop:A,onRequirementRemove:F,onExpanderSelectedCB:T,onExpanderUnselectCB:R,onAttachedObjClicked:S,icons:b,highlightIcons:D,impChecksInfos:k,type:"Check",panelType:{type:"reviewApp",app:I}}).inject(o);x.push({expander:a,id:f[n].id,index:x.length,type:"Check"}),a.getContent().id=f[n].id}return h},this.addNewCheck=function(t){f.push({name:t.name,description:t.description,requirements:t.requirements?t.requirements:[],status:t.status,id:t.id}),M[t.id]={name:t.name,status:t.status,description:t.description,id:t.id},h.getElementsByClassName("checksPanel-noCheckDisplay")[0].hide();var n=new e.Element("div",{class:"flowContainer"}).inject(h),o=new i({objectData:t,editionMode:p,checkEditMode:P.check,readOnly:l,onCheckAttributeChanged:j,onRequirementDrop:A,onRequirementRemove:F,onExpanderSelectedCB:T,onExpanderUnselectCB:R,onAttachedObjClicked:S,icons:b,highlightIcons:D,impChecksInfos:k,type:"Check",panelType:{type:"reviewApp",app:I}}).inject(n);x.push({expander:o,id:t.id,index:x.length,type:"Check"}),o.getContent().id=t.id,o.getMainDiv().setSelectedFlag(!0,t.evt),o.getMainDiv().expand()},this.setPanelQuickAccessCommands=function(e){g&&(g.closeContextualSectionHeader(),g.setQuickAccessCommands(e))}}})}),define("DS/DMUControls/panels/DMUReviewPanel",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS","UWA/Controls/ThemedScroller","DS/DMUControls/DMUReviewExpander","DS/Controls/Expander","DS/Controls/Button","DS/Utilities/TouchUtils","DS/Windows/Dialog","DS/CoreEvents/ModelEvents","DS/DMUControls/EXPNotify","DS/DMUBaseExperience/DMUContextManager","DS/CATWebUXComponents/CATWebUXSectionHeader","DS/DMUBaseExperience/EXPToolsContext","DS/Menu/ContextualMenu","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,l,a,s,r,d,c,h,u,m,g,p){"use strict";return t.extend({init:function(t){var l,f;this._parent(t);var v,C,w,y,b,D,S,x,E,k,M,P,I,U,B,F,_,T=0,R=[],j=new d,A=!1,N=[],L=[];let V,O,H,W,q,z=!1;function X(e,t){O&&(O.destroy(),O=null),O=new c({body:f.getUIFrame(),type:e,message:t})}var Z=function(e,t){return j.publish({event:e,data:t,context:this})};this.subscribe=function(e,t){if(e&&t)return j.subscribe({event:e},t)},this.getColumnMinimumWidth=function(){return 273},this.updateValidatedList=function(e){S=e},this.getColumnWidthStep=function(){return 240},this.deactiveValidatedButton=function(){v.checkFlag=!1},this.setContextType=function(e){V=e},this.setRestrictions=(e=>{W=e}),this.getSectionHeader=function(){return b},this.getExpanders=function(){return R},this.deactiveButtons=function(){for(let e=0;e<R.length;e++)"Highlight"===R[e].type&&R[e].expander.deactivatePlusButtons()},this.editMarkupName=function(t){let n,i,o=I.getElementsByClassName("reviewPanel-markupRect");for(let e=o.length-1;e>=0;e--)if(o[e].id===t){n=o[e].getElementsByClassName("reviewPanel-markupName"),i=o[e];break}let l=!1;if(n&&i){n[0].setStyles({display:"none"});let o=e.createElement("p",{class:"DMUMarkupEditableDiv",contenteditable:!0}).inject(i);o.innerText=n[0].innerText,window.getSelection().removeAllRanges();let a=document.createRange();a.selectNodeContents(o),window.getSelection().addRange(a),o.focus(),l=!0;let s=function(e){l&&(l=!1,i.removeChild(o),e||(n[0].innerText=o.innerText,n[0].setStyles({display:"inline-block"}),Z("onMarkupRenamed",{id:t,title:o.innerText})))};o.addEventListener("keyup",function(e){e.stopPropagation()}),o.addEventListener("click",function(e){e.stopPropagation()}),o.addEventListener("keydown",function(e){"Enter"!==e.key&&13!==e.keyCode&&"Escape"!==e.key&&27!==e.keyCode||s("Escape"===e.key||27===e.keyCode)}),o.addEventListener("blur",s)}},this.expandAll=function(e){for(let t=0;t<R.length;t++)("Checks"===e&&"Check"===R[t].type||"Highlights"===e&&"Highlight"===R[t].type)&&R[t].expander.expand()},this.collapseAll=function(e){for(let t=0;t<R.length;t++)("Checks"===e&&"Check"===R[t].type||"Highlights"===e&&"Highlight"===R[t].type)&&R[t].expander.collapse()},this.updatePanel=(()=>{M.destroy(),T=0,R=R.filter(e=>"Validated"!==e.type),(M=this.buildValidatedObjects(localStorage.getItem("DMUReviewPanel_validExpandedFlags"))).inject(I),Z("updateIconValidated")}),this.setPanelReadOnlyFlag=function(e){D=e.editionMode,l=e.readOnly,k.destroy(),M.destroy(),T=0,(k=this.buildContext()).inject(I),(M=this.buildValidatedObjects()).inject(I),Z("updateIconValidated")},this.setAddValidatedButtonVisibilityFlag=function(e){A=e},this.setDropZoneVisibilityFlag=function(e){z=e},this.unsubscribe=function(e){null!=e&&j.unsubscribe(e)},this._processValidatedObjDeletion=function(){let e=x.getElementsByClassName("reviewPanel-dropValidatedObjZone");var t,n,i=!1;e.length&&z&&["Requirement","R2V_FeatureState","Requirement Specification"].includes(V)&&e[0]&&e[0].show();var o=M.getElementsByClassName("validatedObjectExpander");for(t=R.length-1;t>=0;t--)if("Validated"===R[t].type)if(!1===R[t].expander.getMainDiv().isSelected())i||(R[t].id-=7);else{var l=R[t].expander.getMainDiv().getContent().getParent();R[t].expander.getMainDiv().getContent().destroy(),l.destroy(),R.splice(t,1),i=!0}for(T=0,n=0;n<o.length;n++)o[n].id=T,T+=7;var a=M.getElementsByClassName("reviewPanel-addValidatedButton");a.length>0&&a[0].show(),0===o.length&&(M.getElementsByClassName("reviewPanel-noValidatedDisplay")[0].show(),["Requirement","R2V_FeatureState","Requirement Specification"].includes(V)?M.getElementsByClassName("flowContainer").length&&M.getElementsByClassName("flowContainer")[0].destroy():M.getElementsByClassName("validatedPlaceholder")[0].destroy(),a.length>0&&a[0].setStyles({"margin-top":"0px"}))},this.updateContextInformations=function(e){var t=_.getElementsByClassName("flowContainer")[0];if(0===t.getElementsByClassName("contextObjectExpander").length){var n=new o({objectData:{name:e.name,icon:e.icon,id:-1},editionMode:D,readOnly:l,onExpanderSelectedCB:G,icons:void 0,type:"Context",panelType:{type:"reviewApp",app:q},contextType:V}).inject(t);R.push({expander:n,id:-1,index:R.length,type:"Context"}),n.getContent().addClassName("contextObjectExpander"),n.getContent().id=-1,_.getElementsByClassName("reviewPanel-noContextDisplay")[0].hide()}},this.unSelectAllExpanders=function(){for(let e=0;e<R.length;e++)R[e].expander.getMainDiv().setSelectionVisibility(!1),"Validated"===R[e].type&&R[e].expander.getMainDiv().setAdditionalDivVisibleFlag(!1)},this.unSelectAllValidated=function(){for(let e=0;e<R.length;e++)"Validated"===R[e].type&&R[e].expander.getMainDiv().setSelectedFlag(!1)},this.unSelectExpander=function(e){for(let t=0;t<R.length;t++)R[t].id===e&&R[t].expander.getMainDiv().setSelectedFlag(!1)};var G=function(e){var t;for(let t=0;t<R.length;t++)e.id!==R[t].id&&!e.element.isCheckBoxClicked()&&e.element.isSelected()&&(!e.event||e.event.shiftKey||e.event.ctrlKey||R[t].expander.getMainDiv().setSelectedFlag(!1));"Validated"===e.type?((t={}).event=e.event,t.element=e.element,t.validatedRects=L,Z("onValidatedSelected",t)):"Context"===e.type&&((t={}).event=e.event,t.element=e.element,t.validatedRects=L,Z("onContextSelected",t))},K=function(e){var t={id:e.id,type:e.type,expanders:R};Z("onExpanderUnselectRequested",t)};this.updateHeaderIcon=function(e,t){for(let n=0;n<R.length;n++)R[n].id===parseInt(e)&&R[n].expander.getMainDiv().setIcon({icon:t})},this.updateHeaderLabel=function(e,t){for(let n=0;n<R.length;n++)R[n].id===parseInt(e)&&R[n].expander.getMainDiv().setLabel(t)};let Y=(t,n)=>{let i,o;switch(V){case"Requirement Specification":case"Requirement":o=new e.Element("div",{text:p.reviewPanel.reqDropZoneInfo,class:"infoReq"});break;case"DIFLayout":o=new e.Element("div",{text:p.reviewPanel.difSheetDropZoneInfo,class:"infoReq"});break;case"DesignSight":o=new e.Element("div",{text:p.reviewPanel.msrDropZoneInfo,class:"infoReq"});break;case"R2V_FeatureState":o=new e.Element("div",{text:p.reviewPanel.r2vDropZoneInfo,class:"infoReq"});break;case null:o=new e.Element("div",{text:p.reviewPanel.noContextDropZoneInfo,class:"infoReq"})}i=new e.Element("div",{class:"reviewPanel-dropValidatedObjZone"}).inject(t),o.inject(i);let l=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-plus"}).inject(i);"check"===n?l.addClassName("objPlusIcon checksPanel-checkObjPlusIcon"):l.addClassName("objPlusIcon reviewPanel-validatedObjPlusIcon"),l.hide(),i.ondrop=function(e){let t=h.getReviewContext({viewer:f.getViewer()}),i=t.getValidation().getValidated().getPathElements(),o=[],l=[];i.length>0&&i.forEach(e=>{o.push(e.pathElement)}),this.getElementsByClassName("objPlusIcon")[0].hide(),this.getElementsByClassName("infoReq")[0].show(),this.removeClassName("valDropZoneDrag"),e.preventDefault(),e.stopPropagation();let a=JSON.parse(e.dataTransfer.getData("Text"));if(a.data&&a.data.items&&a.data.items.length>0){let e=H,i=[];if("check"===n){for(let e=0;e<a.data.items.length;e++)-1!==["Requirement","Requirement Specification","Chapter"].indexOf(a.data.items[e].objectType)?i.push(a.data.items[e]):X("warning",p.reviewPanel.DropRequirementObjError);e.fireEvent("onRequirementDropped",i)}else{let n=V;for(let i=0;i<a.data.items.length;i++)"DIFLayout"===n&&"DIFSheet"!==a.data.items[i].objectType?X("warning",p.reviewPanel.DropValidatedObjError):"Requirement Specification"!==n||["Requirement Specification","Requirement","Chapter"].includes(a.data.items[i].objectType)?"DesignSight"===n&&"VPMReference"!==a.data.items[i].objectType?X("warning",p.reviewPanel.DropValidatedObjError):"Requirement"===n&&"Requirement"!==a.data.items[i].objectType?X("warning",p.reviewPanel.DropRequirementValidatedObjError):"R2V_FeatureState"!==n||"r2vsurvey"===a.data.items[i].serviceId&&t.getReviewCtxInformation().contextId===a.data.items[i].objectId?["Requirement Specification","Requirement","Chapter"].includes(a.data.items[i].objectType)?new Promise(t=>{let n,i={};i.cb=(e=>{n=e}),e.fireEvent("onGetLoadedReqSpecInformations",i),t(n)}).then(t=>{-1!==t.indexOf(a.data.items[i].objectId)?new Promise((e,t)=>{o.forEach(e=>{e.includes(a.data.items[i].objectId)&&t()}),e()}).then(()=>{o.push([a.data.items[i].objectId]),l.push([a.data.items[i].objectId]),i===a.data.items.length-1&&e.fireEvent("onValidatedObjectDropped",{path:o,pathToAdd:l})},()=>{X("warning",p.reviewPanel.ValidatedObjExist)}):["Requirement Specification","Requirement","Chapter"].includes(n)?X("warning",p.reviewPanel.DropRequirementValidatedObjError):X("warning",p.reviewPanel.DropValidatedObjError)}):"DIFSheet"===a.data.items[i].objectType?new Promise(t=>{let n,i={};i.cb=(e=>{n=e}),e.fireEvent("onGetLoadedSheetInformations",i),t(n)}).then(t=>{-1!==t.sheetIDList.indexOf(a.data.items[i].objectId)?new Promise((e,t)=>{o.forEach(e=>{e.includes(a.data.items[i].objectId)&&t()}),e()}).then(()=>{o.push([a.data.items[0].objectId]),l.push([a.data.items[i].objectId]),i===a.data.items.length-1&&e.fireEvent("onValidatedObjectDropped",{path:o,pathToAdd:l})},()=>{X("warning",p.reviewPanel.ValidatedObjExist)}):X("warning",p.reviewPanel.DropValidatedObjError)}):"VPMReference"!==a.data.items[i].objectType&&"r2vsurvey"!==a.data.items[i].serviceId||new Promise((e,t)=>{o.forEach(e=>{e.includes(a.data.items[i].objectId)&&t()}),e()}).then(()=>{o.push([a.data.items[0].objectId]),l.push([a.data.items[i].objectId]),e.fireEvent("onValidatedObjectDropped",{path:o,pathToAdd:l,serviceId:"r2vsurvey"===a.data.items[i].serviceId?"r2vsurvey":""})},()=>{X("warning",p.reviewPanel.ValidatedObjExist)}):X("warning",p.reviewPanel.DropRequirementValidatedObjError):X("warning",p.reviewPanel.DropValidatedObjError)}}},i.ondragenter=function(e){e.preventDefault(),e.stopPropagation(),this.getElementsByClassName("objPlusIcon")[0].show(),this.getElementsByClassName("infoReq")[0].hide(),this.addClassName("valDropZoneDrag")},i.ondragleave=function(){this.getElementsByClassName("objPlusIcon")[0].hide(),this.getElementsByClassName("infoReq")[0].show(),this.removeClassName("valDropZoneDrag")},i.ondragover=function(e){e.preventDefault(),e.stopPropagation()},i.ondragend=function(e){e.preventDefault(),e.stopPropagation()}};this.buildPanel=function(t){return S=t.validatedNames,F=t.onAddValidatedClicked,l=t.readOnlyFlag,f=t.frmWindow,D=t.editionMode,V=t.contextType,q=t.appId,H=h.giveEventsController({viewer:f.getViewer()}),W=t.restrictions,w||(w=e.createElement("div",{class:"DMUReviewPanelMainDiv"})),w.setStyles({height:"98%","overflow-y":"hidden"}),(b=new u({draggable:!0,height:60..toString()+"px",onDragStart:function(){return t.reviewDragContent||""},sectionLabel:t.panelTitle?t.panelTitle:p.dmuPanelTitle,cmdList:t.contextualCmdList,quickAccessBtnList:t.quickAccessBtnList,doubleClickCB:function(){Z("onPanelResized")}})).getContent().addClassName("reviewPanelSectionHeader"),w.appendChild(b.getContent()),I=e.createElement("div",{class:"reviewPanel-reviewContent"}),t.contextNames?(U=t.contextNames,(k=this.buildContext()).inject(I)):(k=this.buildContext()).inject(I),(M=this.buildValidatedObjects()).inject(I),(P=this.buildMarkups()).inject(I),P.hide(),(y=(new i).inject(w)).getInnerElement().setContent(I),y.getContent().setStyle("height","calc(100% - 60px)"),w},this.updateReviewPanelContent=function(e){const t=h.getReviewContext({viewer:f.getViewer()}).getValidation();e.reviewNoContextMode?(k.setStyles({display:"block"}),M.setStyles({display:"none"}),t&&"Activated"===t.getRestrictedEditionFlag()&&"PRIVATE"===t.getCurrentState()?P.hide():P.show()):(k.setStyles({display:"block"}),M.setStyles({display:"block"}),!e.rootType||"DIFLayout"!==e.rootType&&"Requirement Specification"!==e.rootType&&"DesignSight"!==e.rootType?"Document"===e.rootType?(M.querySelector(".reviewPanel-addValidatedButton")&&M.querySelector(".reviewPanel-addValidatedButton").hide(),M.querySelector(".reviewPanel-dropValidatedObjZone")&&M.querySelector(".reviewPanel-dropValidatedObjZone").hide()):M.querySelector(".reviewPanel-dropValidatedObjZone")&&M.querySelector(".reviewPanel-dropValidatedObjZone").hide():M.querySelector(".reviewPanel-addValidatedButton")&&M.querySelector(".reviewPanel-addValidatedButton").hide(),P.hide())},this.cleanPanel=function(){if(w){for(;w.firstChild;)w.removeChild(w.firstChild);b&&b.clear(),y&&y.destroy(),b=y=w=null,N=null}},this.buildContext=function(t){(_=new e.Element("div",{class:"reviewPanel-contextDiv"})).setStyles({"padding-top":"10px"}),new e.Element("div",{text:p.reviewPanel.contextExpanderTitle,class:"reviewPanel-contextTitle"}).inject(_);var n=new e.Element("div",{class:"reviewPanel-contextObjDiv"}).inject(_),i=new e.Element("div",{class:"flowContainer"});if(i.inject(n),U&&U.length){var a=new o({objectData:{name:"",icon:t,id:-1},editionMode:D,readOnly:l,onExpanderSelectedCB:G,onExpanderUnselectCB:K,icons:void 0,type:"Context",panelType:{type:"reviewApp",app:q},contextType:V}).inject(i);R.push({expander:a,id:-1,index:R.length,type:"Context"}),a.getContent().id=-1,a.getContent().addClassName("contextObjectExpander")}var s=new e.Element("div",{text:p.reviewPanel.noContext,class:"reviewPanel-noContextDisplay"});return s.inject(n),U&&(U.length?s.hide():i.hide()),_},this.buildValidatedObjects=function(){let t=h.getReviewContext({viewer:f.getViewer()});if(t.getValidation().getContext()){let e=t.getValidation().getContext().getJsonContextTypes()[0],n=m.getParentType(e)?m.getParentType(e):e;if(["Requirement Specification","Requirement","Document","Specification Report","DesignSight","R2V_FeatureState"].includes(n)){let e=t.getValidation().getValidated().getPathElements();e.length&&e.forEach(e=>{t.getValidation().addValidatedNode({docInfo:{validatedId:t.getValidation().getValidated().getPlmID(),validatedPaths:e.pathElement,validatedName:e.referenceName}})})}}var n=new e.Element("div",{class:"reviewPanel-validDiv"}),i=new e.Element("div",{class:"reviewPanel-validatedHeaderDiv"}).inject(n);new e.Element("div",{text:p.reviewPanel.validatedObjectsExpanderTitle,class:"reviewPanel-validatedTitle"}).inject(i),x=new e.Element("div",{class:"reviewPanel-validObjDiv"}).inject(n);let o=new e.Element("div",{text:p.reviewPanel.noValidatedObject,class:"reviewPanel-noValidatedDisplay"});const s=["DIFLayout","Requirement Specification","Requirement","DesignSight","R2V_FeatureState"];if(s.includes(V)||!V){if(!l&&D&&W.review.canEditValObj){var r=new e.Element("div",{class:"validatedPlaceholder"});r.inject(x),Y(r,"validatedObject")}if(S.length>0){o.hide();for(var d=0;d<S.length;d++)this.addValidatedObject(S[d])}}if((!s.includes(V)||!V)&&((v=new a({displayStyle:"icon",icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.font3DS},type:"check"}).inject(i)).getContent().addClassName("reviewPanel-addValidatedButton"),v.getContent().setStyles({"padding-left":"12px"}),v.hide(),!l&&D&&W.review.canEditValObj&&(v.show(),A&&v.getContent().hide(),v.getContent().addEventListener("change",function(e){var t=e.dsModel;!0===t.checkFlag?F(t.checkFlag):Z("onUpdateValidatedListCmdCancel")})),S.length>0)){o.hide();for(var c=0;c<S.length;c++)this.addValidatedObject(S[c])}return new e.Element("div",{class:"validatedObjects"}).inject(x),o.inject(x),n},this.addValidatedObject=function(t,n){let i=x.getElementsByClassName("reviewPanel-addValidatedButton");i.length&&A&&i[0]&&i[0].hide();let d=x.getElementsByClassName("reviewPanel-dropValidatedObjZone");d.length&&!z&&["Requirement","R2V_FeatureState"].includes(V)&&d[0]&&d[0].hide();var c=x.getElementsByClassName("reviewPanel-noValidatedDisplay");c.length&&c[0].hide(),v&&!0===v.checkFlag&&(v.checkFlag=!1);let h=x.getElementsByClassName("reviewPanel-dropValidatedObjZone")[0];var u,m=x.getElementsByClassName("validatedPlaceholder")[0];h&&m&&m.removeChild(h),m||(m=new e.Element("div",{class:"validatedPlaceholder"})),m.inject(x);var g=new a({displayStyle:"lite",label:"lite displayStyle",icon:{iconName:"remove",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1});g.getContent().addClassName("reviewPanel-validRemoveButton"),g.getContent().id=T,D&&W.review.canEditValObj&&(u=new e.Element("div",{class:"reviewPanel-validRemovePlaceholder"}),-1===["Document","Specification Report","DIFSheet","Drawing"].indexOf(V)&&g.inject(u),s.getTouchMode()&&u.setStyles({width:"25px"})),g.getContent().onclick=function(t){t.preventDefault(),t.stopPropagation();var n=e.createElement("div",{class:"DMURemoveValidatedMainDiv"});new e.Element("div",{text:p.reviewPanel.removeValidatedObject,class:"warningMessage"}).inject(n);var i=new a({emphasize:"primary",label:p.reviewPanel.YesBtn?p.reviewPanel.YesBtn:"Yes",onClick:function(){Z("onValidatedRemove"),B&&B.destroy()}});i.getContent().addClassName("validatedRemoveButton");var o=new a({label:p.reviewPanel.NoBtn?p.reviewPanel.NoBtn:"No",onClick:function(){B&&B.destroy()}});B=new r({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:p.reviewPanel.removeValidatedObjectTitle,resizableFlag:!0,immersiveFrame:f.getImmersiveFrame(),buttons:{Ok:i,Cancel:o},width:400,content:n})};var C=new e.Element("div",{class:"flowContainer"}).inject(m),w=new o({objectData:{name:t,icon:n,id:T},editionMode:D,readOnly:l,onExpanderSelectedCB:G,onExpanderUnselectCB:K,validRemoveButton:u,icons:void 0,type:"Validated",panelType:{type:"reviewApp",app:q}}).inject(C);return w.getContent().addClassName("validatedObjectExpander"),w.getContent().id=T,L.push(w),R.push({expander:w,id:T,index:R.length,type:"Validated"}),T+=7,w.getMainDiv().setAdditionalDivVisibleFlag(!1),h&&h.inject(m),w},this.buildMarkups=function(){var t=new e.Element("div",{class:"reviewPanel-markupsDiv"}),n=new e.Element("div",{class:"reviewPanel-markupsHeaderDiv"}).inject(t);new e.Element("div",{text:"Markups",class:"reviewPanel-markupsTitle"}).inject(n),E=new e.Element("div",{class:"markupsObjDiv"}).inject(t);var i=new e.Element("div",{text:p.reviewPanel.noMarkup,class:"reviewPanel-noMarkupDisplay"});return i.inject(E),N.length>0&&i.hide(),l||((C=new a({displayStyle:"icon",icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.font3DS}}).inject(n)).getContent().addClassName("reviewPanel-addMarkupButton"),C.getContent().setStyles({"padding-left":"12px"}),C.getContent().addEventListener("buttonclick",function(){Z("onMarkupCreationRequested")})),t},this.addNewMarkup=function(t){var i=E.getElementsByClassName("reviewPanel-noMarkupDisplay");i.length&&(i[0].hide(),C&&C.getContent().setStyles({"margin-top":"0px"}));var o=new e.Element("div",{class:"reviewPanel-markupPlaceholder"});o.inject(E);var l=new e.Element("div",{class:"reviewPanel-markupRect",id:t.id});l.inject(o),new e.createElement("span",{class:"reviewPanel-markupIcon wux-ui-3ds wux-ui-3ds-markup-review new-glyph"}).inject(l),new e.Element("div",{text:t.title,class:"reviewPanel-markupName"}).inject(l);let a=g.addEventListener(l,{callback:function(e){let i={id:t.id,event:e.data.event},o=i.event.from?i.event.from[0].event:i.event,l=o.pageX?{x:o.pageX,y:o.pageY}:null;l||(l=o.screenX?{x:o.screenX,y:o.screenY}:null),!l&&o.type&&-1!==o.type.indexOf("touch")&&o.changedTouches&&o.changedTouches[0]&&((l=(o=o.changedTouches[0]).pageX?{x:o.pageX,y:o.pageY}:null)||(l=o.screenX?{x:o.screenX,y:o.screenY}:null)),l||(l={x:0,y:0}),i.position=new n.Vector2(l.x,l.y),Z("onMarkupCtxMenuRequired",i)}});N.push({title:t.title,content:t.content,id:t.id,ctxMenuToken:a})},this.removeMarkup=function(e){void 0},this.setPanelQuickAccessCommands=function(e){b&&(b.closeContextualSectionHeader(),b.setQuickAccessCommands(e))},this.updateValidationStatusWarning=function(e){}}})}),define("DS/DMUControls/EXPWindowWithBar",["DS/DMUControls/EXPWindow","WebappsUtils/WebappsUtils"],function(e,t){"use strict";return e.extend({defaultOptions:{fLeftPanelSize:40},init:function(e){var t=UWA.extend(this.defaultOptions,e);this._parent(t),this._createBar()},addButton:function(e){var t=this,n=UWA.createElement("div",{class:e.className,title:e.nls,styles:{position:"relative",background:"rgba(255,255,255,0.5)",opacity:"1",borderRadius:"50%",left:this.options.fMarginAroundViewer,height:"30px",width:"30px",marginTop:"7px",marginBottom:"7px",cursor:"pointer",lineHeight:"25px",textAlign:"center",border:"1px solid #727476"},events:{click:function(){e.callback(t)}}}).inject(this._domElements._actionButtonContainer);this._buildButtonIcon(e.url).inject(n)},setFullScreen:function(e,t){this._parent(e,t),e?(this._domElements._leftPanelMainContainer.setStyle("left",0),this._domElements._actionButtonContainer.setStyles({width:"130%",borderBottomRightRadius:"2pc",borderTopRightRadius:"2pc"})):(this._domElements._leftPanelMainContainer.setStyle("left",-this.options.fLeftPanelSize+"px"),this._domElements._actionButtonContainer.setStyles({width:"100%",borderBottomRightRadius:"0",borderTopRightRadius:"0"}))},_createBar:function(){this._createLeftButtonArrowOpenPanel(),this._createLeftButtonsCommandPanel(),this._createLeftPanelContainer(),this._createLeftButtonArrowClosePanel(),this._createLeftActionButtonContainer()},_createLeftButtonArrowOpenPanel:function(){var e=this,n=t.getWebappsBaseUrl()+"DMUControls/assets/icons/expanderBigLeftArrow.png";this._domElements._leftPanelArrow=this._createUWADiv({position:"absolute",left:0,top:"50%",height:"20px",width:"20px",overflow:"hidden",backgroundImage:"url("+n+")",backgroundSize:"contain",backgroundRepeat:"no-repeat",cursor:"pointer"}),this._domElements._leftPanelArrow.addEvent("click",function(t){e._domElements._leftPanelArrow.setStyle("display","none"),e._domElements._leftPanelMainContainer.setStyle("display","block"),UWA.Event.stop(t)}),this._domElements._leftPanelArrow.inject(this._domElements._mainContainer)},_createLeftButtonsCommandPanel:function(){this._domElements._leftPanelMainContainer=this._createUWADiv({position:"absolute",left:-this.options.fLeftPanelSize+"px",top:0,height:"100%",width:this.options.fLeftPanelSize+"px",overflow:"visible",paddingTop:this.options.fTopbarHeight+"px",lineHeight:this._domElements._mainContainer.getSize().height-this.options.fTopbarHeight+"px",textAlign:"center",display:"none"}),this._domElements._leftPanelMainContainer.inject(this._domElements._mainContainer)},_createLeftPanelContainer:function(){this._domElements._leftPanelContainer=this._createUWADiv({height:"auto",width:"100%",overflow:"visible",display:"inline-block",verticalAlign:"middle",lineHeight:"normal"}),this._domElements._leftPanelContainer.inject(this._domElements._leftPanelMainContainer)},_createLeftButtonArrowClosePanel:function(){var e=this,n=t.getWebappsBaseUrl()+"DMUControls/assets/icons/expanderBigRightArrow.png";this._domElements._leftPanelCloseArrow=this._createUWADiv({height:"20px",width:"100%",overflow:"hidden",backgroundImage:"url("+n+")",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center center",cursor:"pointer",position:"relative",right:-this.options.fMarginAroundViewer/2}),this._domElements._leftPanelCloseArrow.addEvent("click",function(t){e._domElements._leftPanelArrow.setStyle("display","block"),e._domElements._leftPanelMainContainer.setStyle("display","none"),UWA.Event.stop(t)}),this._domElements._leftPanelCloseArrow.inject(this._domElements._leftPanelContainer)},_createLeftActionButtonContainer:function(){this._domElements._actionButtonContainer=this._createUWADiv({height:"auto",width:"100%",backgroundColor:"#F0F0F0",overflow:"visible",borderTop:"1px solid #D1D1D1",borderBottom:"1px solid #D1D1D1",borderLeft:"1px solid #D1D1D1",borderTopLeftRadius:this.options.fCornerRoundRadius+"px",borderBottomLeftRadius:this.options.fCornerRoundRadius+"px",paddingTop:"10px",paddingBottom:"10px"}),this._domElements._actionButtonContainer.inject(this._domElements._leftPanelContainer)},_buildButtonIcon:function(e){var t=new UWA.Controls.Img({url:e});return t.elements.container.setStyles({height:"75%",width:"75%",display:"inline-block",verticalAlign:"middle",lineHeight:"normal"}),t},_updateSize:function(){this._domElements._leftPanelMainContainer.setStyle("lineHeight",this._domElements._mainContainer.getSize().height-this.options.fTopbarHeight+"px"),this._parent()}})}),define("DS/DMUControls/EXPSecondaryViewer",["DS/DMUControls/EXPWindowWithBar","DS/WebappsUtils/WebappsUtils","DS/Visualization/WebGLV6Viewer","i18n!DS/DMUControls/assets/nls/DMUControls"],function(e,t,n,i){"use strict";return e.extend({init:function(e){this.options=e,this._addViewer(),this._parent(e),this._addDefaultButtons()},_addDefaultButtons:function(){for(var e=t.getWebappsAssetUrl("DMUControls","icons/32/"),n=[{className:"secondaryViewerPrintCmd",nls:i.print,url:e+"I_3DSHAREPROPrint.png",callback:function(e){e._printScreenshot(!0)}},{className:"secondaryViewerReframeCmd",nls:i.reframe,url:e+"I_3DSHAREPROReframe.png",callback:function(e){e.options.viewer.currentViewpoint.reframe()}}],o=0;o<n.length;o++)this.addButton(n[o])},_addViewer:function(){var e=new UWA.Element("div").inject(this.options.body,"top");e.setStyle("visibility","visible");var t={div:e,antiAliasing:!0,useShadowMap:!1,infinitePlane:!1,displayGrid:!1,ssao:!1,debugShadowLight:!1,debugBSphere:!1,debugBBox:!1,multiViewer:!0};this._viewerSecondary=new n(t),this._viewerSecondary.setPrePicking({activated:!0,displayHL:!0,gpu:!0,computeNormalDepth:!1,primitive:!1}),this.options.viewer=this._viewerSecondary,this.options.HTMLContent=e},_printScreenshot:function(){var e=this,t=this.options.viewer;if(t.print)t.print();else{this._iframe=new UWA.Element("iframe",{styles:{position:"fixed",top:"0",left:"-150%",width:"100%",height:"100%"}}).inject(document.body);var n,i=new UWA.Element("img",{src:this._getScreenShot(),styles:{"max-width":"100%","max-height":"100%"}}).inject(this._iframe.contentWindow.document.body);if(window.navigator.userAgent.indexOf("Firefox")>-1)this._doPrint();else e=this,n=setInterval(function(){if(i.offsetHeight){clearInterval(n);try{!1===e._iframe.contentWindow.document.execCommand("print",!1,null)&&e._iframe.contentWindow.print()}catch(t){e._iframe.contentWindow.print()}setTimeout(function(){document.body.removeChild(e._iframe)},6e4)}},100)}},_doPrint:function(){var e=this._iframe.contentWindow.document.body.innerHTML,t=window.open("","popup","width=750,height=800,toolbar = no, status = no,resizable =no,location=no");t.document.write(e),t.document.close(),t.focus(),t.print(),t.close(),document.body.removeChild(this._iframe),this._iframe=null},_getScreenShot:function(e,t){var n=this.options.viewer;n.save&&n.save();var i=n.currentViewpoint,o={data:null,width:n.SCREEN_WIDTH,height:n.SCREEN_HEIGHT},l=document.createElement("canvas");l.width=e||o.width,l.height=t||o.height,i.getControl().update(),n.renderToTarget(o,i);var a=l.getContext("2d"),s=a.getImageData(0,0,l.width,l.height);if(s.width===l.width){if(s.height===l.height){var r=(o.width-1)/(s.width-1),d=(o.height-1)/(s.height-1),c=o.data,h=s.data,u=function(e,t,n,i,o){return o?(t=i-t,n*Math.floor(t-1)+Math.floor(e)):n*Math.floor(t)+Math.floor(e)};if(1===r&&1===d){var m=s.height,g=s.width,p=4*g;for(let e=0;e<m;e++){let t=e*g*4,n=(m-e)*g*4;for(let e=p;e>0;e--)h[t+e]=c[n+e]}}else{var f=s.height,v=s.width;for(let e=0;e<f;e++)for(let t=0;t<v;t++){let n=4*u(t,e,s.width,s.height,!1),i=4*u(t,e,o.width,o.height,!0);h[n]=c[i],h[n+1]=c[i+1],h[n+2]=c[i+2],h[n+3]=c[i+3]}}return a.putImageData(s,0,0,0,0,l.width,l.height),l.toDataURL("image/png")}window.console.error("error")}else window.console.error("error")},getViewer:function(){return this._viewerSecondary}})});