define("DS/DELWKOFilteringModule/DELWKOFilteringSetFilterView",["UWA/Class","UWA/Core","DS/DataGridView/DataGridViewSetFilterView","DS/Controls/Toggle","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DELWKOModelServices/DELWKOCollectionUtilsCloud","i18n!DS/DELWKOFilteringModule/assets/nls/DELWKOFilteringSetFilterView"],function(e,t,i,l,s,n,r,o){"use strict";var d=function(e){var t=void 0!==e?e.nodes:this.filter.filterModel,i=Array.isArray(t),l=!1;t&&0!==t.length&&i||(l=!0);var s=[];for(var n in this._possibleValues){var r=this._possibleValues[n];if(l)s.push(r);else if(i){var o=r.options.attributeName;null==o||""===o?-1===t.indexOf(void 0)&&-1===t.indexOf(null)&&-1===t.indexOf("")||s.push(r):-1!==t.indexOf(o)&&s.push(r)}}this._treeDocumentPossibleValues.getXSO().add(s)},a=function(){if(!this._treeDocumentPossibleValues)return;this._xsoListeningDisabled=!0,this._treeDocumentPossibleValues.prepareUpdate(),this._treeDocumentPossibleValues.empty(),this._possibleValues={};const e=this.filterViewManager.filterManager.model,i=this;i._selectAllCheckedFlag=void 0,e.processDescendants({processNode:function(e){t.is(e.nodeModel)&&e.nodeModel.isRoot()&&!function(e,i,l){var s=!1;t.is(e)&&Object.keys(e).forEach(n=>{if(n!=i){var r=e[n].filter;t.is(r)&&r.isDataFiltered(l)&&(s=!0)}});return s}(i.filterViewManager.getFilterViews(),i.propertyId,e.nodeModel)&&u.call(i,e.nodeModel)}});for(let e in this._possibleValues){const t=this._possibleValues[e];t.updateOptions({label:t.options.attributeId+" ("+t.options.count+")"})}this._treeDocumentPossibleValues.pushUpdate(),this._xsoListeningDisabled=!1},u=function(e){const t=e.getAttributeValue(this.propertyId),i=function(e){let t=e;return null!=e&&""!==e||(t="(Blank)"),t}.call(this,t);if(!this._possibleValues[i]){const e=new n({label:i+" (1)",attributeName:t,attributeId:i,count:0});this._treeDocumentPossibleValues.addRoot(e),this._possibleValues[i]=e}return this._possibleValues&&this._possibleValues[i]&&this._possibleValues[i].options.count++,this._possibleValues[i]};return i.extend({name:"DELWKOFilteringSetFilterView",_implLinkToggleButton:null,_expandToggleButton:null,_build:function(){this._parent(),this._possibleValues=null,this._treeDocumentPossibleValues=null,this._searchLineEditor=null,this._dataGridViewPossibleValues=null},buildFilterModelFromView:function(){if(!this._dataGridViewPossibleValues)return this.filter&&this.filter.filterModel;let e=[];if(this._treeDocumentPossibleValues){const t=this._treeDocumentPossibleValues.getRoots();if(t){const i=this._treeDocumentPossibleValues.getSelectedNodes();this._filterOnlyOnVisibleNodeToggle.checkFlag?this._filterOnlyOnVisibleNode&&t.forEach(t=>{t.isVisible()&&e.push(t.options.attributeName)}):i.length>0&&t.forEach(function(t){const i=t.options.attributeName;t.isSelected()&&(null==i||""===i?e.push(void 0,null,""):e.push(i))})}}return{nodes:e,implLink:this._implLinkToggleButton.checkFlag,expand:this._expandToggleButton.checkFlag}},buildContentView:function(){this._parent();var e=this._popupContentDiv;this._filterOnlyOnVisibleNodeToggle.addEventListener("change",()=>{this._filterOnlyOnVisibleNode=this._filterOnlyOnVisibleNodeToggle.checkFlag,function(){this._numberOfSelectedEntries=0;const e=this._dataGridViewPossibleValues.elements.statusBar.getNodeModelByID("selectedItems"),t=this._treeDocumentPossibleValues._numberOfNodesInDocument,i=this._treeDocumentPossibleValues.getXSO().get();this._filterOnlyOnVisibleNode?this._numberOfSelectedEntries=i.reduce((e,t)=>t.isVisible()?++e:e,0):this._numberOfSelectedEntries=i.length,e.updateOptions({grid:{data:`${this._numberOfSelectedEntries} of ${t} selected`}}),this.validFlag=this._numberOfSelectedEntries>0}.call(this),this.fire("change")}),this._implLinkToggleButton=new l({type:"checkbox",label:o.WithAssignedItems,checkFlag:!0}),this._implLinkToggleButton.inject(e),this._expandToggleButton=new l({type:"checkbox",label:o.ExpandAllChildren,checkFlag:!1}),this._expandToggleButton.inject(e)},changeEvent:function(){},clearFilterViewContent:function(){this._parent()},refreshContentView:function(e){null===e?d.call(this,{nodes:[]}):this.filter&&this.elements._popup&&(a.call(this),d.call(this,this.filter.filterModel),this._dataGridViewPossibleValues.reapplySortModel())}})}),define("DS/DELWKOFilteringModule/DELWKOFilteringBaseFilter",["UWA/Class","UWA/Core","DS/TreeModel/BaseFilter","DS/CoreEvents/Events","DS/DELWKOModelServices/DELWKOCollectionUtilsCloud"],function(e,t,i,l,s){"use strict";return i.extend({publishedProperties:{},getFilterByValuesId:function(){return"wkoFilter"},isDataFiltered:function(e){let t=!1;if(e&&this.filterModel&&this.filterModel.nodes&&this.filterModel.nodes.length>0&&this.propertyId&&""!==this.propertyId){var i=e.getAttributeValue(this.propertyId);let l=!1,s=!1,n=0;for(;n<this.filterModel.nodes.length&&!s;)(this.filterModel.nodes[n]===i||"undefined"===this.filterModel.nodes[n]&&void 0===i)&&(s=!0),this.filterModel.nodes[n]&&!l&&(l=!0),n++;if(!s&&!e.isRoot()&&this.filterModel.expand)for(n=0,e=e.getParent();null!=e&&!s;)i=e.getAttributeValue(this.propertyId),(this.filterModel.nodes.includes(i)||this.filterModel.nodes.includes("undefined")&&void 0===i)&&(s=!0),e=e.getParent();t=!s}return t},isEmpty:function(e,t){if(!(void 0!==e?e:this.filterModel))return!0;void 0!==t||this.filterManager&&this.filterManager.model;return!1},_applyFilterModel:function(e){this._listOfFilteredData.forEach(function(e){e.decrementFilteredCount()}),this._listOfFilteredData=[];var i=this.filterManager;if(t.is(i)){var l=i.model;l&&l.prepareUpdate&&l.prepareUpdate();var n=this;this.filterOptions&&this.filterOptions.keepChildren&&l.processDescendants({treeTraversalOrder:"preOrder",processNode:function(e){if(!e.nodeModel.canBeFiltered(n.propertyId)||!n.isDataFiltered(e.nodeModel))return n._preventFilteringOnNodeAndDescendants(e.nodeModel),{shouldProcessDescendants:!1}}}),this.filterModel&&0===this.filterModel.nodes.length&&this.reset(),i.filterModel[this.propertyId].filterModel=this.filterModel,l.processDescendants({treeTraversalOrder:"postOrder",processNode:function(e){var i=n.filterModel;if(e.nodeModel.canBeFiltered(n.propertyId)&&n.isDataFiltered(e.nodeModel)&&(e.nodeModel.incrementFilteredCount(),n._listOfFilteredData.push(e.nodeModel)),t.is(i)&&t.is(i.nodes)&&i.nodes.includes(e.nodeModel.getReferenceLabel())){var l=s.getReferenceModel(e.nodeModel._referencePID);if(t.is(l)){l.getAdditionalInfo("queriedForChildren");i.expand?delete e.nodeModel.options.expandState:e.nodeModel.options.expandState="noChildren"}}}}),i.publish("filterModelChange",{propertyId:this.propertyId,filter:this}),l&&l.pushUpdate&&l.pushUpdate()}}})}),define("DS/DELWKOFilteringModule/DELWKOFilterManager",["UWA/Class","UWA/Core","DS/TreeModel/FilterManager"],function(e,t,i){"use strict";return i.extend({setPropertyFilterModel:function(e,t,i){}})}),define("DS/DELWKOFilteringModule/DELWKOFilteringModule",["UWA/Core","DS/DataGridView/DataGridViewFilterPopup","DS/DataGridView/DataGridViewBaseFilterView","DS/DataGridView/DataGridViewSetFilterView","DS/TreeModel/BaseFilter","DS/DELWKOFilteringModule/DELWKOFilteringBaseFilter","DS/DELWKOFilteringModule/DELWKOFilteringSetFilterView"],function(e,t,i,l,s,n,r){"use strict";return{behaviors:["UXFactoryBehavior","EGraphViewBehaviour","ResourceBehavior","GroupingViewBehavior","SelectionBehavior","WUXNodeModelBehavior","TreeListViewBehavior","ModelBehavior","DELWKOFilteringViewBehavior"],creator:function(t,i,l,s,n,r,o,d,a,u){var h,c,p;return h=function(i){let l=this._dataGridView;if(i&&e.is(i.propertyId)&&e.is(i.filter)){var s=i.filter.filterModel;const n=i.propertyId;let r=[];l.treeDocument.processDescendants({processNode:function(t){if(e.is(s)&&e.is(s.implLink)&&e.is(s.nodes)&&!0===s.implLink&&s.nodes.includes(t.nodeModel.getAttributeValue(n))&&(a.getImpactedConnections([t.nodeModel.getReferencePID()]).forEach(t=>{var i=t.get("to");e.is(i)&&!r.includes(i)&&r.push(i),i=t.get("from"),e.is(i)&&!r.includes(i)&&r.push(i)}),!0===s.expand)){var i=t.nodeModel.getAllDescendants();i.push(t.nodeModel),i.forEach(t=>{a.getImpactedConnections([t.getReferencePID()]).forEach(t=>{var i=t.get("to");e.is(i)&&!r.includes(i)&&r.push(i),i=t.get("from"),e.is(i)&&!r.includes(i)&&r.push(i)})})}}}),e.is(s)&&!0===s.implLink?t.notify("UpperViewsFilter",[r]):(s=i.filter.filterModel,e.is(s)&&e.is(s.implLink)&&!s.implLink&&t.notify("resetUpperViewsFilter"))}},c=function(e,i){var l=e.getTreeDocument().getFilterManager();"tree"!=i.dataIndex?l.getFilters()[i.dataIndex].reset():l.getFilters().label.reset(),t.notify("resetUpperViewsFilter"),l.unsubscribe("filterModelChange")},p=function(e,t){this._dataGridView=e;const i=e.getTreeDocument().getFilterManager(),l=e.getFilterViewManager();i.subscribe("filterModelChange",h.bind(this)),"tree"!=t.dataIndex?l.getFilterPopups()[t.dataIndex].showPopup():l.getFilterPopups().label.showPopup()},{listenTo:function(){return{FilterColumn:p,ResetFilterColumn:c}},onStart:function(e){},onStop:function(){},start:function(){},stop:function(){}}}}});