define("DS/Object3D/Object3D",["DS/Mesh/ThreeJS_Base","DS/Visualization/FixedSizeArrayPool","DS/Visualization/GeometryProcessing"],function(t,e,i){"use strict";var s=0,r=new t.Matrix4;const a=t._VisuFilterType,n=t.ProgramIDs;var o=function(e){if(e.geometry&&e.geometry.boundingSphere&&0!==e.geometry.boundingSphere.radius){var i=new t.Vector3(.259873987,.2768791234,.2458947843);i.multiplyScalar(e.geometry.boundingSphere.radius);var s=(new t.Matrix4).extractMatrix3(e._matrixWorldForDoubleGPU),r=(new t.Vector3).copy(i).applyMatrix4(s);r.x=t.SplitFloat32(r.x).high,r.y=t.SplitFloat32(r.y).high,r.z=t.SplitFloat32(r.z).high;var a=(new t.Matrix4).extractMatrix3(e.matrixWorld),o=(new t.Vector3).copy(i).applyMatrix4(a);r.sub(o),r.length()>.01?e._programID&=~n.LARGE_SCALE:(e._programID|=n.LARGE_SCALE,e._modelViewMatrix=null)}},h=(new Float32Array(3),new t.Matrix4),l=new t.Vector3,d=new t.Vector3(1,0,0),c=new t.Vector3(0,1,0),u=new t.Vector3(0,0,1);class g{constructor(){this._slowProperties={},this._bitsContainer=0,this.id=s++,this.name="",this.parent=void 0,this.children=[],this.up=new t.Vector3(0,1,0),this.position=new t.Vector3,this.rotation=new t.Vector3,this.eulerOrder=g.defaultEulerOrder,this.scale=new t.Vector3(1,1,1),this.worldCenter=new t.Vector3,this.worldRadius=0,this.pixelRadius=0,this._ratioData=null,this._billboardData=null,this._programID=n.LARGE_SCALE,this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new t.Matrix4,this.matrixWorld=new t.Matrix4,this._matrixWorldForDoubleGPU=new t._Float32Matrix4,this._mElements=this._matrixWorldForDoubleGPU.elements,this.matrixRotationWorld=new t.Matrix4,this.modelViewInvTranspMatrix=null,this.modelViewInvMatrix=null,this.modelInvTranspMatrix=null,this._modelInvRotMatrix=null,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.quaternion=new t.Quaternion,this.useQuaternion=!1,this.visible=!0,this.visibilityFree=!1,this._noZPriority=!1,this._castShadow=!1,this._receiveShadow=!1,this.applyBackgroundViewMode=!1,this._planeSpace=null,this._applyPlaneViewMode=t.PlaneViewMode.NORMAL,this._frustumCulled=!0,this.userData={},this.__webglActive=null,this.__webglInit=!1,this._modelViewMatrix=null,this._normalMatrix=null,this.orientation=0,this.boundingSphere=null,this.boundingBox=null,this.isUniformlyScaled=!0,this._matrixScale=1}static call(t){console.warn("Old school inheritance on Object3D, please migrate to ES6 classes");var e=new g;Object.assign(t,e)}_updateBackgroundViewMode(t){this.applyBackgroundViewMode=this._occurrence&&!this._occurrence._isAlwaysInForeground()&&this._occurrence.node.getLinkedToSceneGraph()&&this._occurrence.isInBackground()!==t}_computePlaneSpace(){let t=this.geometry;t.length||0===t.length||(t=[t]);let e=null;for(let s=0;s<t.length;s++){const r=t[s].drawingGroups;for(let t=0;t<r.length;t++){const s=r[t],a=i.FitPlaneSpace.compute(s.geometry,[s.start,s.start+s.count]);e=i.FitPlaneSpace.combine(e,a)}}return e||i.FitPlaneSpace.space_none()}_updatePlaneSpace(){this._planeSpace||(this._planeSpace=this._computePlaneSpace())}_canBeFittedByPlane(t){return this._updatePlaneSpace(),i.FitPlaneSpace.fit({plane:t,space:this._planeSpace,transform:this.matrixWorld})}_updatePlaneViewMode(e,i){this._occurrence&&this._occurrence.node.getLinkedToSceneGraph()&&(this._canBeFittedByPlane(e)||(i===t.PlaneViewMode.NO_PICK&&this._applyPlaneViewMode===t.PlaneViewMode.LOWLIGHT||i===t.PlaneViewMode.LOWLIGHT&&this._applyPlaneViewMode===t.PlaneViewMode.NO_PICK?this._applyPlaneViewMode=t.PlaneViewMode.LOWLIGHT_NO_PICK:i>this._applyPlaneViewMode&&(this._applyPlaneViewMode=i)))}applyMatrix(t){this.matrix.multiplyMatrices(t,this.matrix),this.position.getPositionFromMatrix(this.matrix),this.scale.getScaleFromMatrix(this.matrix),this.isUniformlyScaled=Math.abs(this.scale.x-this.scale.y)<1e-4&&Math.abs(this.scale.z-this.scale.y)<1e-4,this.isUniformlyScaled?this._programID&=~n.NON_UNIFORM_SCALE:this._programID|=n.NON_UNIFORM_SCALE,this._updateWorldCenterAndRadius(),h.extractRotation(this.matrix),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(h):this.rotation.setEulerFromRotationMatrix(h,this.eulerOrder)}_getMMMatrix(){return this.matrixWorld}_getFilter(t){return this._occurrence?this._occurrence._getFilter(t):null}getDynamicMode(t){var e=this._getFilter(a.DYNAMIC_MODE);return!!e&&(t?!e.pick:!e.draw)}getFilterGeomType(){var t=this._getFilter(a._STATIC_GEOM_TYPE)||this._getFilter(a.GEOM_TYPE);return t?t._geomType:0}_updateWorldCenterAndRadius(){for(var e=this.matrixWorld,i=this.geometry&&this.geometry.boundingSphere,s=!1,r=this._occurrence;r&&r.node._getPixelCullingFromParent()&&r.parent;){s=!0,e=(r=r.parent).matrix;var a=r.getBoundingSphere("visibleSpace",!0),o=r.getBoundingSphere("invisibleSpace",!0);if(a&&!o)i=a;else if(o&&!a)i=o;else{if(!a||!o){s=!1,e=this.matrixWorld,console.error("Missing bounding element on parent");break}i=new t.Sphere,a.mergeWithSphere(o,i)}if(!e){s=!1,e=this.matrixWorld;break}}if(r&&r._instancingInfos&&r._instancingInfos.useDefaultInstancing){for(;r&&!r.node._instancingInfos;)r=r.parent;if(r){let i=this._occurrence.getBoundingSphere("visibleSpace",!0),s=this._occurrence.getBoundingSphere("invisibleSpace",!0),a=new t.Sphere;i&&s?i.mergeWithSphere(s,a):a=i||s,a.applyMatrix4(e),(a=r.node._modifyBE(a,t.mergeBoundingSphereInto)).applyMatrix4(r.matrix),this.worldCenter.copy(a.center),this.worldRadius=a.radius,this.pixelRadius=a.pixelRadius,this._matrixScale=r.node.getMaxScaleOnAxis(this._occurrence,r)}}else i?(this.worldCenter.copy(i.center),this.worldRadius=i.radius,this.pixelRadius=i.pixelRadius,s||(this._billboardData&&0!==this._billboardData.type&&(this.worldRadius+=this.worldCenter.length(),this.worldCenter.set(0,0,0)),this._ratioData&&this._ratioData.ratio>0&&(this.worldRadius+=this._ratioData.center.length()/this._ratioData.ratio,this.worldRadius+=this.worldCenter.length(),this.worldRadius*=this._ratioData.ratio,this.pixelRadius=Math.max(this.worldRadius,this.pixelRadius),this.worldRadius=0,this.worldCenter.set(0,0,0)))):(this.worldCenter.set(0,0,0),this.worldRadius=0,this.pixelRadius=0),this._matrixScale=e.getMaxScaleOnAxis(),this.worldRadius*=this._matrixScale,this.worldCenter.applyMatrix4(e);if(this._ratioData&&this._ratioData.ratio>0?this._programID|=n.FIXED_SIZE:this._programID&=~n.FIXED_SIZE,this._billboardData&&this._billboardData.type>=1?this._programID|=n.BILLBOARD:(this._modelInvRotMatrix=null,this._programID&=~n.BILLBOARD),this.geometry){var h=null,l=0;this.geometry.length>=0?(h=this.geometry[0],l=this.geometry.length):2===this.geometry._type&&(h=this.geometry,l=1);for(var d=0;d<l;d++){var c=this.geomWorldBE[d];if(h.boundingSphere)if(c||(this.geomWorldBE[d]={radius:0,center:new t.Vector3},c=this.geomWorldBE[d]),r&&r._instancingInfos&&r._instancingInfos.useDefaultInstancing){for(;r&&!r.node._instancingInfos;)r=r.parent;if(r){let i=h.boundingSphere.clone();i.applyMatrix4(e),(i=r.node._modifyBE(i,t.mergeBoundingSphereInto)).applyMatrix4(r.matrix),c.center.copy(i.center),c.radius=i.radius}}else c.center.copy(h.boundingSphere.center),c.radius=h.boundingSphere.radius,this._billboardData&&0!==this._billboardData.type&&(c.radius+=c.center.length(),c.center.set(0,0,0)),this._ratioData&&this._ratioData.ratio>0&&(c.radius+=this._ratioData.center.length()/this._ratioData.ratio,c.radius+=c.center.length(),c.radius*=this._ratioData.ratio,c.center.set(0,0,0)),c.radius*=e.getMaxScaleOnAxis(),c.center.applyMatrix4(e);h=this.geometry[d+1]}}}_removeFromAllStateSortingResults(){var t=this._tokens;if(t){for(var e in t)this._removeFromStateSortingResult(e);t={}}}_removeFromStateSortingResult(i){var s=this._tokens?this._tokens[i]:null;if(s){for(var r=0;r<s.length;++r){var a=s[r];if(this.isCurvedPipe){for(var n=!1,o=0;o<this.geometry.drawingGroups.length;o++){var h=this.id+"_"+o,l=t.InstancedCurvedPipeManager._perRenderableData.get(h);n=a.autoInstancingData.removeInstances(this.id,o,l)}if(!n)continue}var d=a.previous;a.previous=null,d.next=a.next,a.next&&(a.next.previous=d),a.next=null;var c=d.tree;c&&null===d.next&&c.delete(d.sortId),a.instanced?e.prototype.releaseInstanced(a):e.prototype.release(a)}this._tokens[i]=[]}}_flagAsGSSOInvalidated(){}_flagAsFrustumCulled(){}translate(t,e){return l.copy(e),!0===this.useQuaternion?l.applyQuaternion(this.quaternion):l.applyEuler(this.rotation,this.eulerOrder),l.multiplyScalar(t),this.position.add(l),this}translateX(t){return this.translate(t,d)}translateY(t){return this.translate(t,c)}translateZ(t){return this.translate(t,u)}lookAt(t){h.lookAt(t,this.position,this.up),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(h):this.rotation.setEulerFromRotationMatrix(h,this.eulerOrder)}add(e,i){if(e!==this){if(e instanceof g){void 0!==e.parent&&!e instanceof t.Light&&e.parent.remove(e),e.parent=this,this.children.push(e);var s=this.getScene();s&&s.__addObject(e,i)}}else console.warn("Object3D.add: An object can't be added as a child of itself.")}remove(t){var e=this.children.indexOf(t);if(-1!==e){t.parent=void 0,this.children.splice(e,1);var i=this.getScene();i&&i.__removeObject(t)}}traverse(t){t(this);for(var e=0,i=this.children.length;e<i;e++)this.children[e].traverse(t)}traverseObject3DWithCondition(t){if(t(this))for(var e=0,i=this.children.length;e<i;e++)this.children[e].traverseObject3DWithCondition(t)}getChildByName(t,e){for(var i=0,s=this.children.length;i<s;i++){var r=this.children[i];if(r.name===t)return r;if(!0===e&&void 0!==(r=r.getChildByName(t,e)))return r}}getDescendants(t){void 0===t&&(t=[]),Array.prototype.push.apply(t,this.children);for(var e=0,i=this.children.length;e<i;e++)this.children[e].getDescendants(t);return t}updateMatrix(){if(this.matrix.setPosition(this.position),!1===this.useQuaternion?this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),1===this.scale.x&&1===this.scale.y&&1===this.scale.z||this.matrix.scale(this.scale),this.isUniformlyScaled=Math.abs(this.scale.x-this.scale.y)<1e-4&&Math.abs(this.scale.z-this.scale.y)<1e-4,this.isUniformlyScaled?this._programID&=~n.NON_UNIFORM_SCALE:this._programID|=n.NON_UNIFORM_SCALE,this._updateWorldCenterAndRadius(),null!==this.modelInvTranspMatrix&&this.modelInvTranspMatrix.getInverse(this.matrixWorld).transpose(),null!==this._modelInvRotMatrix){var e=(new t.Matrix4).getInverse(this.matrixWorld);this._modelInvRotMatrix.extractRotation(e)}this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){if(!this.isRoot3ds){if(!0===this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldNeedsUpdate||!0===e){if(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this._updateWorldCenterAndRadius(),this._matrixWorldForDoubleGPU._fromMatrix4WithLowPartTranslation(this.matrixWorld),o(this),null!==this.modelInvTranspMatrix&&this.modelInvTranspMatrix.getInverse(this.matrixWorld).transpose(),null!==this._modelInvRotMatrix){var i=(new t.Matrix4).getInverse(this.matrixWorld);this._modelInvRotMatrix.extractRotation(i)}this.matrixWorldNeedsUpdate=!1,e=!0}for(var s=0,r=this.children.length;s<r;s++)this.children[s].updateMatrixWorld(e)}}clone(e){void 0===e&&(e=new g),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.rotation instanceof t.Vector3&&e.rotation.copy(this.rotation),e.eulerOrder=this.eulerOrder,e.scale.copy(this.scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e._matrixWorldForDoubleGPU._fromMatrix4WithLowPartTranslation(e.matrixWorld),e.matrixRotationWorld.copy(this.matrixRotationWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.quaternion.copy(this.quaternion),e.useQuaternion=this.useQuaternion,e.visible=this.visible,e.visibilityFree=this.visibilityFree,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e._programID=this._programID,e.frustumCulled=this.frustumCulled;for(var i=0;i<this.children.length;i++){var s=this.children[i];e.add(s.clone())}return e}getWebGLObjects(){return null}getScene(){return null!=this.parent?this.parent.getScene():null}getUniqueColor(){var e=Number(this.id).toString(16);return this.id>=4194303&&console.warn("max  number of pickingId values reached"),(e="000000".substr(0,6-e.length)+e).toUpperCase(),e="#"+e,new t.Color(e)}recompileShaders(t){var e,i;for(e=0,i=this.children.length;e<i;e++)this.children[e].recompileShaders(t)}getMeshInstances(){if(!this.parent)return[];for(var t=this;void 0!==t.parent;)t=t.parent;return t.getMeshInstances()}containsLensFlare(e){if(e instanceof t.LensFlare){var i=this.getScene();if(i&&i.__webglFlares&&-1!==i.__webglFlares.indexOf(e))return!0}return!1}containsLight(e){if(e instanceof t.Light){var i=this.getScene();if(i&&-1!==i.__lights.indexOf(e))return!0}return!1}containsMesh(e){if(e instanceof t.Mesh||e instanceof t.CSS2DNode){var i=this.getScene();if(i&&i.__objects.has(e))return!0}return!1}containsObject(t){for(var e=this;void 0!==e.parent;)e=e.parent;var i=t.parent;if(void 0===i)return!1;for(;void 0!==i.parent;)i=i.parent;return i===e}setMatrix(e,i){if(this.matrix=e,e){this.scale.getScaleFromMatrix(this.matrix);var s=r.extractRotation(this.matrix);this.rotation.setEulerFromRotationMatrix(s,this.eulerOrder),this.position.getPositionFromMatrix(this.matrix)}else this.scale.set(1,1,1),this.rotation.set(0,0,0),this.position.set(0,0,0);this.isUniformlyScaled=Math.abs(this.scale.x-this.scale.y)<1e-4&&Math.abs(this.scale.z-this.scale.y)<1e-4,this.isUniformlyScaled?this._programID&=~n.NON_UNIFORM_SCALE:this._programID|=n.NON_UNIFORM_SCALE,!1===i?(this.matrixWorldNeedsUpdate=!1,this.matrixWorld=this.matrix||t.IdentityMatrix):this.matrixWorldNeedsUpdate=!0,this._updateWorldCenterAndRadius(),this._matrixWorldForDoubleGPU._fromMatrix4WithLowPartTranslation(this.matrixWorld),o(this),null!==this.modelInvTranspMatrix&&this.modelInvTranspMatrix.getInverse(this.matrixWorld).transpose()}getLookAt(){var e=this._getMMMatrix().elements;return new t.Vector3(-e[8],-e[9],-e[10])}cloneSimple(e){return void 0===e&&(e=new g),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.rotation instanceof t.Vector3&&e.rotation.copy(this.rotation),e.eulerOrder=this.eulerOrder,e.scale.copy(this.scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e._matrixWorldForDoubleGPU._fromMatrix4WithLowPartTranslation(e.matrixWorld),e.matrixRotationWorld.copy(this.matrixRotationWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.quaternion.copy(this.quaternion),e.useQuaternion=this.useQuaternion,e.visible=this.visible,e.visibilityFree=this.visibilityFree,e._noZPriority=this._noZPriority,e._programID=this._programID,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.isUniformlyScaled=this.isUniformlyScaled,e}_isDecal(){return!1}_isReceivingDecal(){return!1}_isInDecalPass(){return!1}_isLastLOD(){var t=this._getFilter(a._LOD_BRANCH);return!t||t.isLastLOD()}}return Object.defineProperty(g.prototype,"receiveShadow",{get:function(){if(this._occurrence){var t=this._occurrence._getShadow()[1];return null===t?this._receiveShadow:t}return this._receiveShadow},set:function(t){this._receiveShadow=t}}),Object.defineProperty(g.prototype,"castShadow",{get:function(){if(this._occurrence){var t=this._occurrence._getShadow()[0];return null===t?this._castShadow:t}return this._castShadow},set:function(t){this._castShadow=t}}),Object.defineProperty(g.prototype,"frustumCulled",{set:function(t){this._flagAsFrustumCulled(t),this._frustumCulled=t},get:function(){return this._frustumCulled}}),g.defaultEulerOrder="XYZ",t.defineSlowProperty(g,"name"),t.defineSlowProperty(g,"userData"),t.defineSlowProperty(g,"eulerOrder"),t.defineSlowProperty(g,"quaternion"),t.defineSlowProperty(g,"rotation"),t.defineSlowProperty(g,"scale"),t.defineSlowProperty(g,"parent"),t.definePackedBoolean(g,"_noZPriority"),t.definePackedBoolean(g,"rotationAutoUpdate"),t.definePackedBoolean(g,"matrixAutoUpdate"),t.definePackedBoolean(g,"matrixWorldNeedsUpdate"),t.definePackedBoolean(g,"useQuaternion"),t.definePackedBoolean(g,"_castShadow"),t.definePackedBoolean(g,"applyBackgroundViewMode"),t.definePackedBoolean(g,"__webglInit"),g}),define("DS/Object3D/Root3D",["DS/Mesh/ThreeJS_Base","DS/Object3D/Object3D"],function(t,e){"use strict";return class extends e{constructor(){super(),this.isRoot3ds=!0,this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.viewer=null,this.internalSceneGraph=null,this.node=null}setViewer(t){this.viewer=t}setInternalSceneGraph(t){this.internalSceneGraph=t}setNode(t){this.node=t}isSGOrdered(){return this.parent._inheritSGorder&&this.viewer._sgOrder}}}),define("DS/Object3D/Mesh",["DS/Mesh/ThreeJS_Base","DS/Object3D/Object3D","DS/Mesh/Mesh","DS/Materials/MeshBasicMaterial"],function(t,e,i,s){"use strict";var r=1,a=[],n=function(t){0!=t&&a.push(t)},o=function(){var t;return(t=a.length?a.pop():r++)>=4194303&&console.warn("max  number of pickingId values reached"),t};class h extends e{constructor(e,i,r){super(),this.geometry=[],this._sgOrdered=!1,this._forceBackFacesOnSolid=!1,this._instancingInfos=null,this.outlinesGeometry=null,this.isCurvedPipe=!1,this.layer=null,this.sectionLinesBuilder=null,e&&(e.length?this.geometry=e.slice():void 0===e.length&&(this.geometry=e),this.geometry.boundingSphere=e.boundingSphere,this.geometry.boundingBox=e.boundingBox),t.disableJHGDev?this.material=void 0!==i?i:new s({color:16777215*Math.random(),wireframe:!1}):this.material=void 0!==i?i:null,this.matApp=null,this.gas=null,this.geometry&&null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.geometry.boundingSphere||(this.geometry.boundingSphere=new t.Sphere),this.geometry.boundingBox||(this.geometry.boundingBox=new t.Box3),this.beforeRenderCB=null,this._meshRef=0,this.pickable=!0,this.pickingID=0,this.sceneGraph=null,this.highLight=null,this.noPickThrough=!0,this.enableNormalDepth=!0,this.visible=!0,this.visibilityFree=!1,this._noZPriority=!1,this._priorityMode=t.PriorityMode.ClassicPriority,this._bodyDim=0,this.hasPoint=!1,this.renderPointsOnly=!1,this._checkGeometry(),this.boundingSphere=this.geometry.boundingSphere,this.boundingBox=this.geometry.boundingBox,this.geomWorldBE=[],this.__webglInit=!1,this.__webglActive=null,this._normalMatrix=null,this.render=!0,this.z=0,this.renderLineMode=null,this._occurrence=null,this.pickingPriorityID=0,this.occurrenceRenderingOverride=null,this._BEbottomZ=0,this.highlightMeshes=null,this.preHighlight=null,this.selectionGroups=null,this.primToSelGroup=null,this.clippingPlane=null,this.disableMirror=0,this._manipulators=void 0,this._3dxmlMaterial=null,this._gsso_cache=null,this._advancedPriority=!1,this.fromLoadedModel=!1,this.materialMode=2,this.geometry.length&&(e[0].compressedVertices&&(this._programID|=t.ProgramIDs.COMPRESSED_VERTICES),e[0].compressedNormals&&(this._programID|=t.ProgramIDs.COMPRESSED_NORMALS),e[0].compressedUVs&&(this._programID|=t.ProgramIDs.COMPRESSED_UVS),e[0].compressedColors&&(this._programID|=t.ProgramIDs.COMPRESSED_COLORS)),this._vertexColors=t.VertexColorType.NoColors,this._skinning=null,this._skinningInstancing=null,this.lightMapData=null,this._decalData=null,this._tokens={},this._scenes=null,r||window.sealWebVisuObjects&&Object.seal(this),this._depthPriority=0,this.filtered=!1,this.kdTree=null}static call(t,e,i,s){console.warn("Old school inheritance on Mesh, please migrate to ES6 classes");var r=new h(e,i,s);Object.assign(t,r)}_isDecal(){return this._decalData&&this._decalData.key>0&&this._decalData.key%2==1}_isReceivingDecal(){return this._decalData&&this._decalData.key>0&&this._decalData.key%2==0}_isInDecalPass(){return this._decalData&&this._decalData.stencilID>0&&this._decalData.key>0}_forceGeomType(e){for(var i="string"==typeof e?t.GeomTypeEnum[e]:e,s=0;s<this.geometry.length;s++)for(var r=this.geometry[s],a=0;a<r.drawingGroups.length;a++){r.drawingGroups[a]._geomType=i}}getMorphTargetIndexByName(t){return void 0!==this.morphTargetDictionary[t]?this.morphTargetDictionary[t]:(console.log("Mesh.getMorphTargetIndexByName: morph target "+t+" does not exist. Returning 0."),0)}clone(t){return void 0===t&&(t=new h(this.geometry,this.material)),this.matApp&&(t.matApp=this.matApp),super.clone(t),t._vertexColors=this._vertexColors,t._skinningInstancing=this._skinningInstancing,t._skinning=this._skinning,t}setVertexColors(e){this._vertexColors=e,e?this._programID|=t.ProgramIDs.VERTEX_COLORS:this._programID&=~t.ProgramIDs.VERTEX_COLORS,this._flagAsGSSOInvalidated()}setSkinningTransformations(e){this._skinning=e,this._skinningInstancing=null,this._programID&=~t.ProgramIDs.SKINNING_INSTANCING,e?this._programID|=t.ProgramIDs.SKINNING:this._programID&=~t.ProgramIDs.SKINNING,this._flagAsGSSOInvalidated()}setSkinningTransformationsInstancing(e){this._skinning=null,this._skinningInstancing=e,this._programID&=~t.ProgramIDs.SKINNING,e?this._programID|=t.ProgramIDs.SKINNING_INSTANCING:this._programID&=~t.ProgramIDs.SKINNING_INSTANCING,this._flagAsGSSOInvalidated()}getOwningScene(){return this.getScene()}_flagAsGSSOInvalidated(){this._gsso_cache=null,this._sgOrdered=!1;var t,e=this;if(this._scenes){this._scenes.length;this._scenes.forEach(function(t){null!==t&&t.flagAsGSSOInvalidated(e)})}if(this.highlightMeshes)for(t=0;t<this.highlightMeshes.length;t++)this.highlightMeshes[t].renderable._flagAsGSSOInvalidated();this.preHighlight&&this.preHighlight._flagAsGSSOInvalidated()}_compactArrays(t){for(var e=0;e<this.geometry.length;e++)this.geometry[e]._compactArrays(t)}recompileShaders(e){var i;if(this.material&&this.material.recompileShaders(!0,iParams),this.matApp&&this.matApp.recompileShaders(iParams),this.userData&&this.userData.oldMaterial&&this.userData.oldMaterial.recompileShaders(!0,iParams),this.layer&&this.layer.layers)for(i=0;i<this.layer.layers.length;i++){var s=this.layer.layers[i].drawableInterval.material;s&&s.recompileShaders(!0,iParams)}var r=null,a=0;this.geometry.length>=0?(r=this.geometry[0],a=this.geometry.length):2===this.geometry._type&&(r=this.geometry,a=1);for(var n=0;n<a;n++){for(var o=r.drawingGroups,h=0;h<o.length;h++)o[h].gas&&!o[h].gas.isGAS&&o[h].gas.recompileShaders(!1,iParams),o[h].material&&o[h].material instanceof t.Material&&o[h].material.recompileShaders(!1,iParams);r=this.geometry[n+1]}}_getMMMatrix(){var i,s=null,r=function(t){if(!t)return null;var e=t._getViewpoint();if(e)return e;var i=t.scene3js&&t.scene3js.viewer;return i?i.currentViewpoint:null},a=this.matrixWorld;if(this._billboardData&&this._billboardData.type>=1&&a&&(i=r(this._occurrence))){var n=(x=i.camera).getLookAt();n.add(x.position);var o=(new t.Matrix4).extractRotation(a),h=(new t.Matrix4).getInverse(o),l=null;if(1===this._billboardData.type)l=(new t.Matrix4).lookAt(x.position,n,x.up);else{var d=this._billboardData.axis,c=new t.Vector3,u=new t.Vector3,g=new t.Vector3,p=new t.Vector3,m=new t.Vector3,_=new t.Vector3,y=new t.Vector3;if(d?u.copy(d).transformDirection(a).normalize():u.set(a.elements[8],a.elements[9],a.elements[10]).normalize(),3===this._billboardData.type){var f=new t.Projector;y.getPositionFromMatrix(a),c.subVectors(y,x.position),_.addVectors(y,u);var v=y.clone();f.projectVector(v,x),f.projectVector(_,x),_.z=v.z,f.unprojectVector(_,x),_.sub(y),_.normalize(),u.copy(_)}else c.subVectors(n,x.position);if(c.normalize(),g.crossVectors(c,u),g.lengthSq()<1e-10){var w=Math.abs(c.z)<.999?m.set(0,0,1):m.set(1,0,0);g.crossVectors(w,c)}g.normalize(),p.crossVectors(u,g),p.normalize(),l=(new t.Matrix4).set(g.x,p.x,u.x,0,g.y,p.y,u.y,0,g.z,p.z,u.z,0,0,0,0,1)}s=(new t.Matrix4).multiplyMatrices(h,l);this._billboardData.rotation&&(s=(new t.Matrix4).multiplyMatrices(s,this._billboardData.rotation))}if(this._ratioData&&this._ratioData.ratio>0&&a&&(i=r(this._occurrence))){var b=new t.Vector3;b.getPositionFromMatrix(a);var x,S=1/a.getMaxScaleOnAxis(),M=S*(x=i[this._ratioData.cameraName?this._ratioData.cameraName:"camera"]).getWorldSizeFromPixelSize(1,b,i.viewer._getDivClientHeight(),1),I=new t.Matrix4;if(this._ratioData.center.lengthSq()>0){var P=(new t.Vector3).copy(this._ratioData.center);P.multiplyScalar(M);var C=(new t.Vector3).copy(P);C.applyMatrix4(a),M=this._ratioData.ratio*S*x.getWorldSizeFromPixelSize(1,C,i.viewer._getDivClientHeight(),1),I.makeScale(M,M,M),I.setPosition(P)}else M*=this._ratioData.ratio,I.makeScale(M,M,M);var D=new t.Matrix4;if(D.multiplyMatrices(a,I),s){var L=new t.Matrix4;return L=(new t.Matrix4).multiplyMatrices(D,s)}return D}return s&&a?((L=new t.Matrix4).multiplyMatrices(a,s),L):e.prototype._getMMMatrix.call(this)}computeKDTree(e){if(!this._occurrence||!t.KDTree)return null;var i=this._occurrence.node.mesh3js;if(i.kdTree)return this.kdTree=i.kdTree,i.kdTree;var s=new t.KDTree(100,20),r="build kd-tree for renderable "+this.id,a=performance.now();return s.buildFromMesh(i,!!e),r+=" took "+(performance.now()-a)/1e3+" s",t.VisualizationTraces.info(r),s.getNbNodes()>1&&s.getNbTotalElts()>100?(this.kdTree=s,i.kdTree=s,s):(console.warn("kdTree too small to be used"),this.kdTree=null,i.kdTree=null,null)}_flagAsFrustumCulled(t){this._frustumCulled=t;var e,i=this;if(this._scenes){this._scenes.length;this._scenes.forEach(function(e){null!==e&&e.flagAsFrustumCulled(i,t)})}if(this.highlightMeshes)for(e=0;e<this.highlightMeshes.length;e++)this.highlightMeshes[e].renderable._flagAsFrustumCulled(t);this.preHighlight&&this.preHighlight._flagAsFrustumCulled(t)}copyInstancingInfos(t){this._instancingInfos&&(t._instancingInfos={isInstanceNode3D:this._instancingInfos.isInstanceNode3D,nbInstances:this._instancingInfos.nbInstances,instancingSelectionMode:this._instancingInfos.instancingSelectionMode,instanceAttribArrays:this._instancingInfos.instanceAttribArrays,pickedInstanceId:[],useDefaultInstancing:this._instancingInfos.useDefaultInstancing})}_getPriority(e,i){var s=-1;if(this._noZPriority&&(s=4),i&&i._noZPriority>=0&&(s=i._noZPriority),-1==s&&e&&e._type==t.GASTypeEnum.NOZ&&(s=e._priority),this._priorityMode==t.PriorityMode.DepthPriority||s>=0&&!(i._geomType&t.NoNoZPriorityMask))switch(this._priorityMode){case t.PriorityMode.ClassicPriority2D:case t.PriorityMode.ClassicPriority:s=t.nbDisplayListPriority-t.displayListPriorityEnum.priority[noZ];break;case t.PriorityMode.Advanced:s=t.nbDisplayListPriority-t.displayListPriorityEnum.priorityP[noZ];break;case t.PriorityMode.DepthPriority:s=s-4+this._depthPriority}return s}addRefVBO(t){t||(0==this._meshRef&&(this.pickingID=o()),this._meshRef++);var e=null,i=0;this.geometry.length>=0?(e=this.geometry[0],i=this.geometry.length):2===this.geometry._type&&(e=this.geometry,i=1);for(var s=0;s<i;s++)e.addRefVBO(this,t),e=this.geometry[s+1]}releaseVBO(t){t||(this._meshRef--,0==this._meshRef&&(n(this.pickingID),this.pickingID=0));var e=null,i=0;this.geometry.length>=0?(e=this.geometry[0],i=this.geometry.length):2===this.geometry._type&&(e=this.geometry,i=1);for(var s=0;s<i;s++)e.releaseVBO(this,t),e=this.geometry[s+1];this.clearOutlines()}clearOutlines(){this.outlinesGeometry&&(this.outlinesGeometry.dispose(),this.outlinesGeometry=null)}dispose(){var t=null,e=0;n(this.pickingID),this.pickingID=0,this.geometry.length>=0?(t=this.geometry[0],e=this.geometry.length):2===this.geometry._type&&(t=this.geometry,e=1);for(var i=0;i<e;i++)t.dispose(),t=this.geometry[i+1]}computeTangents(t){var e=null,i=0;this.geometry.length>=0?(e=this.geometry[0],i=this.geometry.length):2===this.geometry._type&&(e=this.geometry,i=1);for(var s=0;s<i;s++)e.computeTangents(t),e=this.geometry[s+1]}computeUVs(){var t=null,e=0;this.geometry.length>=0?(t=this.geometry[0],e=this.geometry.length):2===this.geometry._type&&(t=this.geometry,e=1);for(var i=0;i<e;i++)t.computeUVs(this.geometry.boundingBox),t=this.geometry[i+1]}detachGeometry(t){if(t&&this.layer){for(var e=this.layer.getIntervals(t,null,!0),i=0;i<e.length;i++)-1!==(s=this.layer.layers.indexOf(e[i]))&&(this.layer.layers.splice(s,1),this.layer.upToDate=!1);if(this.geometry&&this.geometry.length){var s=this.geometry.indexOf(t);-1!==s&&this.geometry.splice(s,1)}}}removeGeometry(t){if(t){for(var e=t.meshList,i=0;i<e.length;i++){if((r=e[i]).layer){var s=r.layer.getIntervals(t,null,!0);for(i=0;i<s.length;i++)-1!==(a=r.layer.layers.indexOf(s[i]))&&(r.layer.layers.splice(a,1),r.layer.upToDate=!1)}}for(i=0;i<e.length;i++){var r;if((r=e[i]).geometry&&r.geometry.length){var a=r.geometry.indexOf(t);-1!==a&&r.geometry.splice(a,1)}}}}addGeometry(e,s,r){for(var a=!1,n=0;n<this.geometry.length;n++)if(this.geometry[n]===e){a=!0;break}if(a)if(r){this.layer||this.initLayers(1);var o=this.layer.getIntervals(e,null,!0);if(o.length===r.length){var h=function(t,e){return t.drawableGroup.start!==e.drawableGroup.start?t.drawableGroup.start-e.drawableGroup.start:t.drawableGroup.count!==e.drawableGroup.count?t.drawableGroup.count-e.drawableGroup.count:t.drawableInterval.start!==e.drawableInterval.start?t.drawableInterval.start-e.drawableInterval.start:t.drawableInterval.count-e.drawableInterval.count};o.sort(h),r.sort(h);let t=!0;for(let e=0;e<o.length;e++){let i=r[e],s=o[e];if(s.drawableGroup!==i.drawableGroup||s.drawableInterval.start!==i.drawableInterval.start||s.drawableInterval.count!==i.drawableInterval.count||s.drawableInterval.layerNum!==i.drawableInterval.layerNum||
//!dstLayer.drawableInterval.gas._isEqual(srcLayer.drawableInterval.gas) ||
s.drawableInterval.material!==i.drawableInterval.material||s.drawableInterval.noZ!==i.drawableInterval.noZ){t=!1;break}}if(t)return}for(var l=0;l<r.length;l++){var d=r[l],c=d.drawableInterval;if(1===c.layerNum||c.material){for(var u=[],g=Math.min(d.drawableGroup.getPrimitivesCount(),c.primitiveStart+c.primitiveCount),p=c.primitiveStart;p<g;p++){var m=new i.SGPrimitiveHelper;m.set(d.drawableGroup,p),u.push(m)}this.layer.addPrimitivesToLayer(e,d.drawableGroup,u,c.layerNum,c.material)}}}else this._initLayersForGeometry(1,e);else{if(e.boundingBox||e.computeBoundingBox(),this.geometry.boundingBox||(this.geometry.boundingBox=new t.Box3),s&&this.geometry.boundingBox.expandByPoint(e.boundingBox.min),s&&this.geometry.boundingBox.expandByPoint(e.boundingBox.max),e.boundingSphere||e.computeBoundingSphere(),this.geometry.boundingSphere||(this.geometry.boundingSphere=new t.Sphere),s&&this.geometry.boundingSphere.clone().mergeWithSphere(e.boundingSphere,this.geometry.boundingSphere),this._occurrence&&this._occurrence.scene3js&&e.addRefVBO(this,!1),!this.layer&&!r)return this.geometry.push(e),void this._checkGeometry();this.layer||this.initLayers(1),this.geometry.push(e),r?this._copyLayers(r):this._initLayersForGeometry(1,e),this._checkGeometry()}}getRenderablesFromGeometries(){if(this.geometry&&this.geometry.length){for(var t={},e=0;e<this.geometry.length;e++)for(var i=this.geometry[e],s=0;s<i.meshList.length;s++){var r=i.meshList[s];t[r.id]=r}var a=[];for(var e in t)a.push(t[e]);return a}}optimizeBuffers(){}isMeshHiddenByLayer(){if(null===this.layer||!this.layer.layers.length)return!1;for(var t=0;t<this.layer.layers.length;t++){if(0!==this.layer.layers[t].drawableInterval.layerNum)return!1}return!0}initLayers(e){if(null===this.layer){this.layer=new t.BufferLayer(this);var i=1,s=this.geometry;this.geometry.length>=0&&(s=this.geometry[0],i=this.geometry.length);for(var r=0;r<i;r++)this._initLayersForGeometry(e,s),s=this.geometry[r+1]}}_initLayersForGeometry(e,i){this.layer||(this.layer=new t.BufferLayer(this));for(var s=this.layer.getIntervals(i,null,!0),r=0;r<s.length;r++){var a=this.layer.layers.indexOf(s[r]);-1!==a&&this.layer.layers.splice(a,1)}for(var n=0;n<i.drawingGroups.length;n++){var o=i.drawingGroups[n],h=new t.DrawableInterval(e,o.start,o.count);h.primitiveStart=0,h.primitiveCount=o.getPrimitivesCount();var l=new t.LayerInterval(i,o,h);this.layer.layers.push(l)}}_copyLayers(e){this.layer||(this.layer=new t.BufferLayer(this));for(var i=0;i<e.length;i++){var s=e[i];this.layer.layers.push(s.clone())}}hasPriorityManipulators(){if(this._manipulators)for(var t in this._manipulators)if(this._manipulators[t].active&&this._manipulators[t].getPickingPriority())return!0;return!1}getManipulators(){for(var t={},e=this._occurrence;e;){if(e._manipulators)for(var i in e._manipulators){var s=e._manipulators[i];t[i]=s}e=e.parent}return t}hasManipulators(){if(this._manipulators)for(var t in this._manipulators)if(this._manipulators[t].active)return!0;return!1}_checkGeometry(){var t,e,i,s,r,a;if(this.geometry.length)for(t=this.geometry.length,i=0;i<t;i++)if(2===(r=this.geometry[i])._type)for(e=(a=r.drawingGroups).length,s=0;s<e;s++)if(0===a[s].glType)return this.hasPoint=!0,!0;return!1}getNode(){return this._occurrence&&this._occurrence.node}getSelectionGroup(t){if(!this.selectionGroups)return null;if(this.primToSelGroup){var e=t.getCgmId()+"_"+t.getStart()+"_"+t.getCount();return this.primToSelGroup.get(e)}for(var i=0;i<this.selectionGroups.length;i++){var s=this.selectionGroups[i];if(s.contains(t))return s}return null}removeSelectionGroup(t){if(this.selectionGroups)if(this.primToSelGroup){var e=t.getCgmId()+"_"+t.getStart()+"_"+t.getCount();if(!(r=this.primToSelGroup.get(e)))return;var i=this.selectionGroups.indexOf(r);i>=0&&this.selectionGroups.splice(i,1)}else for(var s=0;s<this.selectionGroups.length;s++){var r;if((r=this.selectionGroups[s]).contains(t)){this.selectionGroups.splice(s,1);break}}}addSelectionGroup(t){this.selectionGroups||(this.selectionGroups=[]),this.selectionGroups.push(t),this.primToSelGroup||(this.primToSelGroup=new Map);var e=this;t.applyToPrimitives(function(i){var s=i.getCgmId()+"_"+i.getStart()+"_"+i.getCount();e.primToSelGroup.set(s,t)})}_performFrustumCulling(t,e,i,s,r){return e.performFrustumCulling(i,s)}getMin(e,i){var s,r,a,n,o,h=void 0!==e?e:"z",l=(i=null,new t.Vector3);for(r=null,a=0,this.geometry.length>=0?(r=this.geometry[0],a=this.geometry.length):2===this.geometry._type&&(r=this.geometry,a=1),n=0;n<a;n++)if(null!==r.vertexPositionArray){if(this._instancingInfos&&this._instancingInfos.useDefaultInstancing){let t=this._occurrence;for(;t&&!t.node._instancingInfos;)t=t.parent;t&&(i=t.node.getMin(this,t,h,r,i))}else{s=this._getMMMatrix();const t=r.getVertexCount();for(o=0;o<t;o++)r.getVertexPosition(o,l),l.applyMatrix4(s),(l[h]<i||null===i)&&(i=l[h])}r=this.geometry[n+1]}else r=this.geometry[n+1];return i}static DuplicateMesh(e,i){var s,r=e.material;if(e.isCurvedPipe?((s=new t.CurvedPipeMesh(e.geometry,r))._capWorldRadius=e._capWorldRadius,s._nbLODsMinusOne=e._nbLODsMinusOne,s.currentLOD=e.currentLOD,t.InstancedCurvedPipeManager.addLinkedCurvedPipe(s,e)):s=new t.Mesh(e.geometry,r),s.matApp=e.matApp,s.gas=e.gas,s.materialMode=e.materialMode,s.matrixAutoUpdate=e.matrixAutoUpdate,s.visible=e.visible,s.visibilityFree=e.visibilityFree,s.fromLoadedModel=e.fromLoadedModel,s.receiveShadow=e.receiveShadow,s.castShadow=e.castShadow,s._programID=e._programID,s._vertexColors=e._vertexColors,s._skinning=e._skinning,s._skinningInstancing=e._skinningInstancing,s._ratioData=e._ratioData,s._billboardData=e._billboardData,e.layer&&(s.layer=e.layer.clone(i.ignoreVisibility)),s.frustumCulled=e.frustumCulled,s.setMatrix(e.matrix),e._instancingInfos&&e._instancingInfos.isInstanceNode3D){if(s._instancingInfos={isInstanceNode3D:!0,nbInstances:-1,instancingSelectionMode:e._instancingInfos.instancingSelectionMode,instanceAttribArrays:null,pickedInstanceId:[],useDefaultInstancing:e._instancingInfos.useDefaultInstancing},"instance"===e._instancingInfos.instancingSelectionMode){var a,n,o,h,l,d=e._instancingInfos.instanceAttribArrays;for(a in s._instancingInfos.nbInstances=1,s._instancingInfos.instanceAttribArrays={id:d.id},d)"id"!==a&&(h=d[a].itemSize,s._instancingInfos.instanceAttribArrays[a]={itemSize:h},16===(l=d[a].isMat4?16:h)&&(s._instancingInfos.instanceAttribArrays[a].isMat4=!0),o=(n=(e._instancingInfos.pickedInstanceId[0]/5-1)*l)+l,s._instancingInfos.instanceAttribArrays[a].array=d[a].array.subarray(n,o),s._instancingInfos.instanceAttribArrays[a].buffer=null);s._instancingInfos.pickedInstanceId.push(e._instancingInfos.pickedInstanceId[0])}else s._instancingInfos.nbInstances=e._instancingInfos.nbInstances,s._instancingInfos.instanceAttribArrays=e._instancingInfos.instanceAttribArrays;e._instancingInfos.pickedInstanceId=[]}return s}}return Object.defineProperty(h.prototype,"instanceAttribArrays",{get:function(){return this._instancingInfos?this._instancingInfos.instanceAttribArrays:null},set:function(t){this._instancingInfos&&(this._instancingInfos.instanceAttribArrays=t)}}),Object.defineProperty(h.prototype,"instancingSelectionMode",{get:function(){return this._instancingInfos?this._instancingInfos.instancingSelectionMode:""},set:function(t){this._instancingInfos&&(this._instancingInfos.instancingSelectionMode=t)}}),Object.defineProperty(h.prototype,"nbInstances",{get:function(){return this._instancingInfos?this._instancingInfos.nbInstances:-1},set:function(t){this._instancingInfos&&(this._instancingInfos.nbInstances=t)}}),Object.defineProperty(h.prototype,"drawInHLRender",{get:function(){return t.getWebVisualizationLevel()>425?console.error("drawInHLRender deprecated, use noPickThrough instead"):console.warn("drawInHLRender deprecated, use noPickThrough instead"),this.noPickThrough},set:function(e){t.getWebVisualizationLevel()>425?console.error("drawInHLRender deprecated, use noPickThrough instead"):console.warn("drawInHLRender deprecated, use noPickThrough instead"),this.noPickThrough=e}}),t.definePackedBoolean(h,"pickable"),t.definePackedBoolean(h,"enableNormalDepth"),t.definePackedBoolean(h,"noPickThrough"),t.definePackedBoolean(h,"applyBackgroundViewMode"),t.definePackedBoolean(h,"fromLoadedModel"),t.definePackedBoolean(h,"hasPoint"),t.definePackedBoolean(h,"filtered"),t.definePackedBoolean(h,"_noZPriority"),t.definePackedBoolean(h,"render"),t.definePackedBoolean(h,"_advancedPriority"),h}),define("DS/Object3D/Camera",["DS/Mesh/ThreeJS_Base","DS/Object3D/Object3D"],function(t,e){"use strict";var i="undefined"!=typeof EXPERIENCE_PLAYER,s=window.SIMULATE_EXPERIENCE_PLAYER,r={NONE:0,FULL_SCREEN:1,_PRINCIPAL_START:2,PRINCIPAL:2,_NON_PRINCIPAL_START:2<<25,STEREO_RIGHT:2<<25,STEREO_LEFT:2<<26,REFLECTED:1<<27,BACKGROUND:1<<28,ROBOT_CONNECTED:1<<29,ROBOT_ORTHO:1<<30},a=new t.Matrix4;class n extends e{constructor(e){super(),this.matrixWorldInverse=new t.Matrix4,this.projectionMatrix=new t.Matrix4,this.projectionMatrixInverse=new t.Matrix4,this.realProjectionMatrixInverse=new t.Matrix4,this.pixelCulling=4.5,this.isOrtho=!1,this._hasChanged=!0,this.externalProjectionMatrix=!1,this.matrixAutoUpdate=!0,this._pixelToWorldSizeCst=1,this.pixelCullingCst=0,this._cstLOD=0,this._viewpoint=null,this.aspect=1,this._renderingRole=r.NONE,this.useRealSize=!1,this.visualizedHeight=0,this.fullWidth=null,this.fullHeight=null,this.x=null,this.y=null,this.width=null,this.height=null,this.pickingRatioW=null,this.pickingRatioH=null,this.webgpu=!!e,this.left=null,this.right=null,this.top=null,this.bottom=null}_setBackgroundRenderingRoleFromPrincipal(t){t._renderingRole!==r.NONE&&(this._renderingRole=t._renderingRole|r.BACKGROUND)}_setReflectedRenderingRoleFromPrincipal(t){t._renderingRole!==r.NONE&&(this._renderingRole=t._renderingRole|r.REFLECTED)}_setRobotRenderingRoleFromPrincipal(t){t._renderingRole!==r.NONE&&(this._renderingRole=t._renderingRole|r.ROBOT_ORTHO)}_setRobotConnectedRenderingRoleFromPrincipal(t){t._renderingRole!==r.NONE&&(this._renderingRole=t._renderingRole|r.ROBOT_CONNECTED)}_setStereoLeftRenderingRoleFromPrincipal(t){t._renderingRole!==r.NONE&&(this._renderingRole=t._renderingRole|r.STEREO_LEFT)}_setStereoRightRenderingRoleFromPrincipal(t){t._renderingRole!==r.NONE&&(this._renderingRole=t._renderingRole|r.STEREO_RIGHT)}setWebGPU(t){this.webgpu=t}clone(t){return void 0===t&&(t=new n),e.prototype.cloneSimple.call(this,t),t.matrixWorldInverse.copy(this.matrixWorldInverse),t.projectionMatrix.copy(this.projectionMatrix),t.projectionMatrixInverse.copy(this.projectionMatrixInverse),t._pixelToWorldSizeCst=this._pixelToWorldSizeCst,t.pixelCullingCst=this.pixelCullingCst,t._viewpoint=this._viewpoint,t.aspect=this.aspect,t.pixelCulling=this.pixelCulling,t.webgpu=this.webgpu,t}lookAt(t){a.lookAt(this.position,t,this.up),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(a):this.rotation.setEulerFromRotationMatrix(a,this.eulerOrder)}setViewOffsetInternal(t,e,i,s,r,a,n,o){(this.fullWidth!=t||this.fullHeight!=e||this.x!=i||this.y!=s||this.width!=r||this.height!=a||this.pickingRatio)&&(this.fullWidth=t,this.fullHeight=e,this.x=i,this.y=s,this.width=r,o||(n&&this.height?this.visualizedHeight=this.height:this.visualizedHeight=0,this._hasChanged=!0),n?(this.pickingRatioW=n.ratioW,this.pickingRatioH=n.ratioH):(this.pickingRatioW=null,this.pickingRatioH=null),this.height=a,this.realProjectionMatrixInverse=this.projectionMatrixInverse.clone(),this.updateProjectionMatrix())}setViewOffset(t,e,i,s,r,a){console.warn("deprecated ! use viewpoint.setViewOffset instead"),this.setViewOffsetInternal(t,e,i,s,r,a)}}Object.defineProperty(n.prototype,"fixedSizeCameraConstant",{get:function(){return this._pixelToWorldSizeCst},set:function(t){console.error("Read only parameter fixedSizeCameraConstant")}});class o extends n{constructor(t,e,i,s,r,a,n){super(n),this.left=t,this.right=e,this.top=i,this.bottom=s,this.near=void 0!==r?r:.1,this.far=void 0!==a?a:2e3,this.fov=45,this.isOrtho=!0,this.updateProjectionMatrix(),this.visualizedHeight=400}clone(t){return void 0===t&&(t=new o),n.prototype.clone.call(this,t),this.fullWidth?(t.fullWidth=this.fullWidth,t.fullHeight=this.fullHeight,t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height):(t.fullWidth=null,t.fullHeight=null,t.x=null,t.y=null,t.width=null,t.height=null),t.left=this.left,t.right=this.right,t.top=this.top,t.bottom=this.bottom,t.near=this.near,t.far=this.far,this.visualizedHeight&&(t.visualizedHeight=this.visualizedHeight),t.updateProjectionMatrix(),t}getCameraConstant(t,e){return t*(this.top-this.bottom)/(e||1)}getWorldSizeFromPixelSize(t,e,i,s){let r=t*(this.top-this.bottom)/(i||1);s&&this.fullWidth&&(r*=1==s?this.height/this.fullHeight:Math.max(this.width/this.fullWidth,this.height/this.fullHeight));return r}makeProjectionMatrix(t,e,i,s,r,a){this.webgpu?this.projectionMatrix.makeOrthographicWebGPU(t,e,i,s,r,a):this.projectionMatrix.makeOrthographic(t,e,i,s,r,a)}updateProjectionMatrix(t,e){var i=Math.abs(this.right-this.left),s=Math.abs(this.top-this.bottom),r=t||0,a=e||0;if(this.fullWidth){this.aspect=this.fullWidth/this.fullHeight;var n=this.fullWidth/this.fullHeight,o=this.top,h=o-s,l=n*h,d=n*o;i=Math.abs(d-l),s=Math.abs(o-h);this.makeProjectionMatrix(l+(this.x+r*this.width)/this.fullWidth*i,l+(this.x+(1+r)*this.width)/this.fullWidth*i,o-(this.y+a*this.height)/this.fullHeight*s,o-(this.y+(1+a)*this.height)/this.fullHeight*s,this.near,this.far)}else this.makeProjectionMatrix(this.left+r*i,this.right+r*i,this.top+a*s,this.bottom+a*s,this.near,this.far);this.projectionMatrixInverse.getInverse(this.projectionMatrix)}setVisualizedHeight(t,e,i){this.fov=i||(this.fov?this.fov:45);var s=this.visualizedHeight;this.visualizedHeight=t?2*t*Math.tan(Math.PI*this.fov/360):this.visualizedHeight?this.visualizedHeight:400,this.visualizedHeight!==s&&(this._hasChanged=!0),this.aspect=e||(this.aspect?this.aspect:1),this.top=this.visualizedHeight/2,this.bottom=-this.top,this.left=this.aspect*this.bottom,this.right=-this.left,this.updateProjectionMatrix()}setViewportInfos(t,e,i,s){t==this.top&&e==this.bottom&&i==this.left&&s==this.right||(this._hasChanged=!0,this.top=t,this.bottom=e,this.left=i,this.right=s,this.updateProjectionMatrix())}}class h extends n{constructor(t,e,i,s,r){super(r),this.fov=void 0!==t?t:50,this.aspect=void 0!==e?e:1,this.near=void 0!==i?i:.1,this.far=void 0!==s?s:2e3,this.offsetX=0,this.offsetY=0,this.sensorSizeHeight=24,this.sensorSizeWidth=36,this.focalLength=.5*this.sensorSizeHeight/Math.tan(this.fov*Math.PI/360),this.aperture=.9,this.blades=0,this.updateProjectionMatrix()}clone(t){return void 0===t&&(t=new h),n.prototype.clone.call(this,t),t.fov=this.fov,t.aspect=this.aspect,t.near=this.near,t.far=this.far,t.externalProjectionMatrix=this.externalProjectionMatrix,t.sensorSizeHeight=this.sensorSizeHeight,t.sensorSizeWidth=this.sensorSizeWidth,t.focalLength=this.focalLength,t.aperture=this.aperture,t.blades=this.blades,this.fullWidth?(t.fullWidth=this.fullWidth,t.fullHeight=this.fullHeight,t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height):(t.fullWidth=null,t.fullHeight=null,t.x=null,t.y=null,t.width=null,t.height=null),t.updateProjectionMatrix(),t}setLens(e,i,s){i&&i.length&&(this.sensorSizeHeight=i[1],this.sensorSizeWidth=i[0]),this.focalLength=e||this.focalLength,this.fov=s?2*t.Math.radToDeg(Math.atan(this.sensorSizeWidth/(2*this.focalLength))):2*t.Math.radToDeg(Math.atan(this.sensorSizeHeight/(2*this.focalLength))),this.updateProjectionMatrix()}setAperture(t,e){this.aperture=t,this.blades=void 0!==e?e:0}getCameraConstant(t,e){return 2*Math.tan(.5*this.fov*Math.PI/180)*t/(e||1)}getWorldSizeFromPixelSize(t,e,i,s){var r=this.matrixWorldInverse.elements,a=2*Math.abs(r[2]*e.x+r[6]*e.y+r[10]*e.z+r[14])*Math.tan(.5*this.fov*Math.PI/180)*t/(i||1);s&&this.fullWidth&&(a*=1==s?this.height/this.fullHeight:Math.max(this.width/this.fullWidth,this.height/this.fullHeight));return a}performPixelAndFrustumCullingOnGeometry(t,e,i,s){if(2!==s._type||!i.frustumCulled)return!0;var r=s===i.geometry?s:i.geometry.indexOf(s),a=i.geomWorldBE[r];if(!a)return!0;var n=a.center,o=a.radius,h=this.pixelCulling,l=this.matrixWorldInverse.elements;if(h>0){var d=h;if(!i._ratioData||0===i._ratioData.ratio){var c=Math.abs(l[2]*n.x+l[6]*n.y+l[10]*n.z+l[14]);d=this.pixelCullingCst*c}if(o<d)return!1}var u=o;if(i._ratioData&&i._ratioData.ratio>0){c=Math.abs(l[2]*n.x+l[6]*n.y+l[10]*n.z+l[14]);u*=this._pixelToWorldSizeCst*c}return t.performFrustumCulling(u,n)}performPixelCullingOnDG(t,e,r,a,n){if(i&&!EXPERIENCE_PLAYER||!i&&!s){var o=t.geometry.indexOf(e),h=t.geomWorldBE[o];if(!h)return n;if(this.pixelCulling>0){var l=h.center,d=h.radius,c=0,u=r.cullingData.length-1,g=this.matrixWorldInverse.elements,p=this.pixelCulling,m=!t._ratioData||0===t._ratioData.ratio,_=t._matrixScale,y=t._ratioData.ratio/_;if(m){var f=Math.abs(g[2]*l.x+g[6]*l.y+g[10]*l.z+g[14])-d;p=this.pixelCullingCst*f}for(;u-c>1;){var v=Math.floor(.5*(c+u));(x=r.cullingData[v]).start;if(x.start<a&&(c=v),x.start>a+n)return n;var w=x.radius*_;m||(w*=y),w<p?u=v:c=v}var b=u;if(c!==u){w=(x=r.cullingData[c]).radius*_;m||(w*=y),w<p&&(b=c)}if(b<r.cullingData.length-1){var x=r.cullingData[b];return Math.max(x.start-a,0)}w=(x=r.cullingData[b]).radius*_;if(m||(w*=y),w<p)return Math.max(x.start-a,0)}return n}}makeFrustumMatrix(t,e,i,s,r,a){this.webgpu?this.projectionMatrix.makeFrustumWebGPU(t,e,i,s,r,a):this.projectionMatrix.makeFrustum(t,e,i,s,r,a)}updateProjectionMatrix(e,i){if(!this.externalProjectionMatrix){var s=e||0;s+=this.offsetX?this.offsetX:0;var r=i||0;if(r+=this.offsetY?this.offsetY:0,this.fullWidth){var a=this.fullWidth/this.fullHeight,n=a*(c=-(d=Math.tan(t.Math.degToRad(.5*this.fov))*this.near)),o=a*d,h=Math.abs(o-n),l=Math.abs(d-c);this.makeFrustumMatrix(n+(this.x+s*this.width)/this.fullWidth*h,n+(this.x+(1+s)*this.width)/this.fullWidth*h,d-(this.y+(1+r)*this.height)/this.fullHeight*l,d-(this.y+r*this.height)/this.fullHeight*l,this.near,this.far)}else if(this._viewpoint&&this._viewpoint._nativeTranslationOffset){var d,c=-(d=Math.tan(t.Math.degToRad(.5*this.fov))*this.near);n=this.aspect*c,o=this.aspect*d,h=Math.abs(o-n),l=Math.abs(d-c);this.makeFrustumMatrix(n+this._viewpoint._nativeTranslationOffset.x*this.near,o+this._viewpoint._nativeTranslationOffset.x*this.near,c+this._viewpoint._nativeTranslationOffset.y*this.near,d+this._viewpoint._nativeTranslationOffset.y*this.near,this.near,this.far)}else{var u=this.near*Math.tan(t.Math.degToRad(.5*this.fov)),g=-u,p=g*this.aspect,m=u*this.aspect;s&&(p+=s*=Math.abs(m-p),m+=s),r&&(g+=r*=Math.abs(u-g),u+=r),this.makeFrustumMatrix(p,m,g,u,this.near,this.far)}this.projectionMatrixInverse.getInverse(this.projectionMatrix)}}}return{_CameraRoles:r,_FrameTypes:{MAIN:0,GPU_INTERSECTION:1,GPU_INTERSECTION_SMALL:2,COLLISION:3},BaseCamera:n,OrthographicCamera:o,PerspectiveCamera:h}}),define("DS/Object3D/Light",["DS/Mesh/ThreeJS_Base","DS/Object3D/Object3D"],function(t,e){"use strict";var i=new t.Color,s={LUMINOUS_POWER:0,LUMINOUS_EXITANCE:1},r=1e6/Math.PI;class a extends e{constructor(e){super(),this.onlyShadow=!1,e=e instanceof t.Color?e:new t.Color(e),this.color=e,this.sRGB=!1,this._vptPosition=null,this._phongReduction=!0,this._sceneShadow=!1,this.matrixAutoUpdate=!1}clone(t){return void 0===t&&(t=new a),super.clone(t),t.color.copy(this.color),t.sRGB=this.sRGB,t._vptPosition=this._vptPosition,t._phongReduction=this._phongReduction,t._sceneShadow=this._sceneShadow,t}allocateShadows(t,e){return 0}setup(t,e,i,s){}allocate(t){}updateShadowParameters(t,e){}dispose(){}}a.prototype._sortKey=0;class n extends a{constructor(t){super(t)}clone(t){return void 0===t&&(t=new n),super.clone(t),t}setup(t,e,s,r){if(this.visible){var a=this.color;if(r.gammaInput&&!this.sRGB){var n=i.copyToLinear(a,r.simpleGamma);t.ambient[0]+=n.r,t.ambient[1]+=n.g,t.ambient[2]+=n.b}else t.ambient[0]+=a.r,t.ambient[1]+=a.g,t.ambient[2]+=a.b}}}class o extends a{constructor(t,e,i,r){super(t),this.intensity=void 0!==e?e:1,this.radius=void 0!==i?i:1,this.mode=void 0!==r?r:s.LUMINOUS_EXITANCE,this._internalScale=1}clone(t){return void 0===t&&(t=new o),super.clone(t),t.intensity=this.intensity,t.radius=this.radius,t.mode=this.mode,t._internalScale=this._internalScale,t}setup(e,i,a,n){if(e.sphere.sphereCount+=1,this.visible){var o=4*e.sphere.sphereLength,h=this.matrixWorld.getMaxScaleOnAxis()/this._internalScale*this.radius,l=this.mode===s.LUMINOUS_POWER?r*this.intensity/(h*h*4*Math.PI):this.intensity;n.gammaInput&&!this.sRGB?i(e.sphere.sphereColors,o,this.color,l,n.simpleGamma):a(e.sphere.sphereColors,o,this.color,l);var d=new t.Vector3;d.getPositionFromMatrix(this.matrixWorld),e.sphere.spherePositions[o]=d.x,e.sphere.spherePositions[o+1]=d.y,e.sphere.spherePositions[o+2]=d.z,e.sphere.spherePositions[o+3]=h,e.sphere.sphereLength+=1}}allocate(t){t.sphereLights++}}class h extends a{constructor(t,e,i,r){super(t),this.intensity=void 0!==e?e:1,this.radius=void 0!==i?i:1,this.mode=void 0!==r?r:s.LUMINOUS_EXITANCE,this._internalScale=1}clone(t){return void 0===t&&(t=new h),super.clone(t),t.intensity=this.intensity,t.radius=this.radius,t.mode=this.mode,t._internalScale=this._internalScale,t}setup(e,i,a,n){if(e.disk.diskCount+=1,this.visible){var o=4*e.disk.diskLength,h=Math.max(this.matrixWorld.getScaleOnAxisX(),this.matrixWorld.getScaleOnAxisY())/this._internalScale*this.radius,l=this.mode===s.LUMINOUS_POWER?r*this.intensity/(h*h*Math.PI):this.intensity;n.gammaInput&&!this.sRGB?i(e.disk.diskColors,o,this.color,l,n.simpleGamma):a(e.disk.diskColors,o,this.color,l);var d=new t.Vector3;d.getPositionFromMatrix(this.matrixWorld),e.disk.diskPositions[o]=d.x,e.disk.diskPositions[o+1]=d.y,e.disk.diskPositions[o+2]=d.z,e.disk.diskPositions[o+3]=h;var c=new t.Vector4;c.getColumnFromMatrix(2,this.matrixWorld),c.w=0,c.normalize(),e.disk.diskNormals[o]=c.x,e.disk.diskNormals[o+1]=c.y,e.disk.diskNormals[o+2]=c.z,e.disk.diskNormals[o+3]=0,c.getColumnFromMatrix(1,this.matrixWorld),c.w=0,c.normalize(),e.disk.diskUps[o]=c.x,e.disk.diskUps[o+1]=c.y,e.disk.diskUps[o+2]=c.z,e.disk.diskUps[o+3]=0,e.disk.diskLength+=1}}allocate(t){t.diskLights++}}class l extends a{constructor(t,e,i,r,a){super(t),this.intensity=void 0!==e?e:1,this.radius=void 0!==i?i:1,this.width=void 0!==r?r:1,this.mode=void 0!==a?a:s.LUMINOUS_EXITANCE,this._internalScale=1}clone(t){return void 0===t&&(t=new l),super.clone(t),t.intensity=this.intensity,t.radius=this.radius,t.width=this.width,t.mode=this.mode,t._internalScale=this._internalScale,t}setup(e,i,a,n){if(e.tube.tubeCount+=1,this.visible){var o=4*e.tube.tubeLength,h=this.matrixWorld.getScaleOnAxisX()/this._internalScale,l=this.matrixWorld.getScaleOnAxisY()/this._internalScale*this.radius,d=h*this.width,c=this.mode===s.LUMINOUS_POWER?r*this.intensity/(2*Math.PI*d*l+l*l*4*Math.PI):this.intensity;n.gammaInput&&!this.sRGB?i(e.tube.tubeColors,o,this.color,c,n.simpleGamma):a(e.tube.tubeColors,o,this.color,c);var u=new t.Vector3;u.getPositionFromMatrix(this.matrixWorld),e.tube.tubePositions[o]=u.x,e.tube.tubePositions[o+1]=u.y,e.tube.tubePositions[o+2]=u.z,e.tube.tubePositions[o+3]=l;var g=new t.Vector4;g.getColumnFromMatrix(1,this.matrixWorld),g.w=0,g.normalize(),e.tube.tubeRights[o]=g.x,e.tube.tubeRights[o+1]=g.y,e.tube.tubeRights[o+2]=g.z,e.tube.tubeRights[o+3]=d,e.tube.tubeLength+=1}}allocate(t){t.tubeLights++}}class d extends a{constructor(t,e,i,r,a){super(t),this.intensity=void 0!==e?e:1,this.height=void 0!==r?r:1,this.width=void 0!==i?i:1,this.mode=void 0!==a?a:s.LUMINOUS_EXITANCE,this._internalScale=1}clone(t){return void 0===t&&(t=new d),super.clone(t),t.intensity=this.intensity,t.width=this.width,t.height=this.height,t.mode=this.mode,t._internalScale=this._internalScale,t}setup(e,i,a,n){if(e.rectangle.rectangleCount+=1,this.visible){var o=4*e.rectangle.rectangleLength,h=this.matrixWorld.getScaleOnAxisX()/this._internalScale,l=this.matrixWorld.getScaleOnAxisY()/this._internalScale*this.height,d=h*this.width,c=this.mode===s.LUMINOUS_POWER?r*this.intensity/(l*d):this.intensity;n.gammaInput&&!this.sRGB?i(e.rectangle.rectangleColors,o,this.color,c,n.simpleGamma):a(e.rectangle.rectangleColors,o,this.color,c);var u=new t.Vector3;u.getPositionFromMatrix(this.matrixWorld),e.rectangle.rectanglePositions[o]=u.x,e.rectangle.rectanglePositions[o+1]=u.y,e.rectangle.rectanglePositions[o+2]=u.z,e.rectangle.rectanglePositions[o+3]=d;var g=new t.Vector4;g.getColumnFromMatrix(2,this.matrixWorld),g.w=0,g.normalize(),e.rectangle.rectangleNormals[o]=g.x,e.rectangle.rectangleNormals[o+1]=g.y,e.rectangle.rectangleNormals[o+2]=g.z,e.rectangle.rectangleNormals[o+3]=l,g.getColumnFromMatrix(1,this.matrixWorld),g.w=0,g.normalize(),e.rectangle.rectangleUps[o]=g.x,e.rectangle.rectangleUps[o+1]=g.y,e.rectangle.rectangleUps[o+2]=g.z,e.rectangle.rectangleUps[o+3]=0,e.rectangle.rectangleLength+=1}}allocate(t){t.rectangleLights++}}class c extends a{constructor(i,s){super(i),this.position.set(0,1,0),this.target=new e,this.intensity=void 0!==s?s:1,this.castShadow=!1,this.onlyShadow=!1,this.castGroundShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowCameraHelperToUpdate=!0,this.shadowBias=-.005,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new t.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.updateShadowMap=!0,this.blockUpdate=!1,this.shadowMap=null,this.transparentShadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.transparentShadowCamera=null,this.shadowMatrix=null,this.LiSPSM=!1}clone(e){return void 0===e&&(e=new c),super.clone(e),null!==this.target?(null===e.target&&(e.target=new t.Object3D),this.target.clone(e.target)):e.target=null,e.intensity=this.intensity,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e}allocateShadows(t,e){return this.shadowCascade||this.isVirtual&&!t.shadowMapCascade||(e.tex2d++,e.dirLight++),0}_getLightDirection(e){var i=new t.Vector3;new t.Vector3;if(this.target)i.getPositionFromMatrix(this.matrixWorld),i.sub(this.target.position),0===i.x&&0===i.y&&0===i.z&&(i.copy(e),i.applyMatrix4((new t.Matrix4).extractRotation(this.matrixWorld)));else if(i.copy(e),i.applyMatrix4((new t.Matrix4).extractRotation(this.matrixWorld)),this._occurrence&&this._occurrence.node._attachedToVpt){var s=(new t.Vector3).crossVectors(this._vptSight,this._vptUp);i=new t.Vector3(s.x*i.x+this._vptUp.x*i.y-this._vptSight.x*i.z,s.y*i.x+this._vptUp.y*i.y-this._vptSight.y*i.z,s.z*i.x+this._vptUp.z*i.y-this._vptSight.z*i.z)}return i.normalize(),i}setup(t,e,i,s){if(t.directional.dirCount+=1,this.visible){var r=this._getLightDirection(s.baseLightDirection);if(0!==r.x||0!==r.y||0!==r.z){var a=4*t.directional.dirLength;t.directional.dirPositions[a]=r.x,t.directional.dirPositions[a+1]=r.y,t.directional.dirPositions[a+2]=r.z,t.directional.dirPositions[a+3]=0,s.gammaInput&&!this.sRGB?(e(t.directional.dirColors,a,this.color,this.intensity,s.simpleGamma,t.directional.dirColorsNoIntensity),e(t.directional.dirColorsPhong,a,this.color,this.intensity,s.simpleGamma)):(i(t.directional.dirColors,a,this.color,this.intensity,t.directional.dirColorsNoIntensity),i(t.directional.dirColorsPhong,a,this.color,this.intensity)),this._phongReduction&&(t.directional.dirColorsPhong[a]/=Math.PI,t.directional.dirColorsPhong[a+1]/=Math.PI,t.directional.dirColorsPhong[a+2]/=Math.PI),t.directional.dirLength+=1}}}allocate(t){t.dirLights++}updateShadowParameters(e,i){if(null!==e){var s=this._getLightDirection(i),r=null!==this.target?this.target.position:e.center;this.position=(new t.Vector3).copy(s).multiplyScalar(2*e.radius).add(r);var a=this.position.distanceTo(e.center),n=Math.acos(s.dot(i))/Math.PI,o=Math.PI*Math.max(.1,.5-n),h=Math.sin(o)+(Math.cos(o)+1)/Math.tan(o);this.shadowCamera&&!this.LiSPSM?(this.updateShadowMap=!this.blockUpdate&&(this.updateShadowMap||this.shadowCamera.top!==e.radius),this.shadowCamera.far=a+h*e.radius,this.shadowCamera.near=Math.max(.001*this.shadowCamera.far,a-e.radius),this.shadowCamera.left=-e.radius,this.shadowCamera.right=e.radius,this.shadowCamera.bottom=-e.radius,this.shadowCamera.top=e.radius,this.shadowCamera.updateProjectionMatrix()):(this.shadowCameraFar=a+h*e.radius,this.shadowCameraNear=Math.max(.001*this.shadowCameraFar,a-e.radius),this.updateShadowMap=!0)}}dispose(){this.shadowMap&&this.shadowMap.dispose(),this.transparentShadowMap&&this.transparentShadowMap.dispose()}}c.prototype._sortKey=32;class u extends c{constructor(t,e){super(t,e),this.castShadow=!0}clone(t){return void 0===t&&(t=new u),super.clone(t),t}allocateShadows(t,e){return this.shadowCascade||this.isVirtual&&!t.shadowMapCascade||e.dirIBLLight++,0}setup(t,e,i,s){if(t.directionalIBL.dirIBLCount+=1,this.visible){var r=this._getLightDirection(s.baseLightDirection);if(0!==r.x||0!==r.y||0!==r.z){var a=4*t.directionalIBL.dirIBLLength;t.directionalIBL.dirIBLPositions[a]=r.x,t.directionalIBL.dirIBLPositions[a+1]=r.y,t.directionalIBL.dirIBLPositions[a+2]=r.z,t.directionalIBL.dirIBLPositions[a+3]=0,i(t.directionalIBL.dirIBLColors,a,this.color,this.intensity),t.directionalIBL.dirIBLLength+=1}}}allocate(t){t.dirIBLLights++}}u.prototype._sortKey=8;class g extends c{constructor(t,e){super(t,e),this.castShadow=!1}clone(t){return void 0===t&&(t=new g),super.clone(t),t}allocateShadows(t,e){return 0}setup(t,e,i,s){if(t.directionalPhong.dirPhongCount+=1,this.visible){var r=this._getLightDirection(s.baseLightDirection);if(0!==r.x||0!==r.y||0!==r.z){var a=4*t.directionalPhong.dirPhongLength;t.directionalPhong.dirPhongPositions[a]=r.x,t.directionalPhong.dirPhongPositions[a+1]=r.y,t.directionalPhong.dirPhongPositions[a+2]=r.z,t.directionalPhong.dirPhongPositions[a+3]=0,i(t.directionalPhong.dirPhongColors,a,this.color,this.intensity),t.directionalPhong.dirPhongColors[a]/=Math.PI,t.directionalPhong.dirPhongColors[a+1]/=Math.PI,t.directionalPhong.dirPhongColors[a+2]/=Math.PI,t.directionalPhong.dirPhongLength+=1}}}allocate(t){t.dirPhongLights++}}class p extends a{constructor(t,e,i){super(t),this.intensity=void 0!==e?e:1,this.distance=void 0!==i?i:0,this.isPhysicallyAttenuated=!1,this.attenuationScale=1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=90,this.shadowCameraVisible=!1,this.shadowCameraHelperToUpdate=!0,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.updateShadowMap=!0,this.shadowMap=null,this.transparentShadowMap=null,this.shadowMapSize=null,this.shadowCameras=null,this.transparentShadowCameras=null,this.shadowMatrix=null}clone(t){return void 0===t&&(t=new p),super.clone(t),t.intensity=this.intensity,t.distance=this.distance,t.isPhysicallyAttenuated=this.isPhysicallyAttenuated,t.attenuationScale=this.attenuationScale,t.castShadow=this.castShadow,t.onlyShadow=this.onlyShadow,t}allocateShadows(t,e){e.texCube++}setup(e,i,s,r){if(e.point.pointCount+=1,this.visible){var a=4*e.point.pointLength;r.gammaInput&&!this.sRGB?(i(e.point.pointColors,a,this.color,this.intensity,r.simpleGamma,e.point.pointColorsNoIntensity),i(e.point.pointColorsPhong,a,this.color,this.intensity,r.simpleGamma)):(s(e.point.pointColors,a,this.color,this.intensity,e.point.pointColorsNoIntensity),s(e.point.pointColorsPhong,a,this.color,this.intensity)),this._phongReduction&&(e.point.pointColorsPhong[a]/=Math.PI,e.point.pointColorsPhong[a+1]/=Math.PI,e.point.pointColorsPhong[a+2]/=Math.PI);var n=new t.Vector3;this._occurrence&&this._occurrence.node._attachedToVpt?n.copy(this._vptPosition):n.getPositionFromMatrix(this.matrixWorld),e.point.pointPositions[a]=n.x,e.point.pointPositions[a+1]=n.y,e.point.pointPositions[a+2]=n.z,e.point.pointPositions[a+3]=this.isPhysicallyAttenuated?this.attenuationScale:this.distance,e.point.pointPhysicalAttenuations[e.point.pointLength]=this.isPhysicallyAttenuated,e.point.pointLength+=1}}setupShadowPositions(e){if(this.visible){var i=new t.Vector3;this._occurrence&&this._occurrence.node._attachedToVpt?i.copy(this._vptPosition):i.getPositionFromMatrix(this.matrixWorld),e.push(i.x),e.push(i.y),e.push(i.z)}}allocate(t){t.pointLights++}dispose(){this.shadowMap&&this.shadowMap.dispose(),this.transparentShadowMap&&this.transparentShadowMap.dispose()}}p.prototype._sortKey=4;class m extends a{constructor(t,i,s,r,a){super(t),this.position.set(0,1,0),this.target=new e,this.intensity=void 0!==i?i:1,this.distance=void 0!==s?s:0,this.angle=void 0!==r?r:Math.PI/2,this.innerAngle=void 0!==a?a:this.angle-.001,this.exponent=1,this.isPhysicallyAttenuated=!1,this.attenuationScale=1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowCameraHelperToUpdate=!0,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.updateShadowMap=!0,this.shadowMap=null,this.transparentShadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.transparentShadowCamera=null,this.shadowMatrix=null}clone(e){return void 0===e&&(e=new m),super.clone(e),null!==this.target?(null===e.target&&(e.target=new t.Object3D),this.target.clone(e.target)):e.target=null,e.intensity=this.intensity,e.localDirection=this.localDirection,e.distance=this.distance,e.angle=this.angle,e.innerAngle=this.innerAngle,e.exponent=this.exponent,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.isPhysicallyAttenuated=this.isPhysicallyAttenuated,e.attenuationScale=this.attenuationScale,e}allocateShadows(t,e){e.tex2d++,e.spotLight++}setup(e,i,s,r){if(e.spot.spotCount+=1,this.visible){var a=4*e.spot.spotLength;r.gammaInput&&!this.sRGB?(i(e.spot.spotColors,a,this.color,this.intensity,r.simpleGamma,e.spot.spotColorsNoIntensity),i(e.spot.spotColorsPhong,a,this.color,this.intensity,r.simpleGamma)):(s(e.spot.spotColors,a,this.color,this.intensity,e.spot.spotColorsNoIntensity),s(e.spot.spotColorsPhong,a,this.color,this.intensity)),this._phongReduction&&(e.spot.spotColorsPhong[a]/=Math.PI,e.spot.spotColorsPhong[a+1]/=Math.PI,e.spot.spotColorsPhong[a+2]/=Math.PI),e.spot.spotColorsPhong[a+3]=this.isPhysicallyAttenuated?this.attenuationScale:this.distance,e.spot.spotColors[a+3]=this.isPhysicallyAttenuated?this.attenuationScale:this.distance;var n=new t.Vector3,o=new t.Vector3;if(this._occurrence&&this._occurrence.node._attachedToVpt)n.copy(this._vptPosition),o.copy(this._vptSight),o.negate();else{n.getPositionFromMatrix(this.matrixWorld);var h=e.spot.spotLength;e.spot.spotPhysicalAttenuations[h]=this.isPhysicallyAttenuated,this.target?(o.copy(n),o.sub(this.target.position),0===o.x&&0===o.y&&0===o.z&&(o.set(0,0,1),o.applyMatrix4((new t.Matrix4).extractRotation(this.matrixWorld)))):(o.set(0,0,1),o.applyMatrix4((new t.Matrix4).extractRotation(this.matrixWorld)))}o.normalize(),e.spot.spotPositions[a]=n.x,e.spot.spotPositions[a+1]=n.y,e.spot.spotPositions[a+2]=n.z,e.spot.spotPositions[a+3]=Math.cos(this.angle),e.spot.spotDirections[a]=o.x,e.spot.spotDirections[a+1]=o.y,e.spot.spotDirections[a+2]=o.z,e.spot.spotDirections[a+3]=Math.cos(this.innerAngle),e.spot.spotLength+=1}}allocate(t){t.spotLights++}dispose(){this.shadowMap&&this.shadowMap.dispose(),this.transparentShadowMap&&this.transparentShadowMap.dispose()}}m.prototype._sortKey=16;class _ extends a{constructor(t,e,i,s){super(t),this.intensity=void 0!==e?e:1,this.distance=void 0!==i?i:0,this.isPhysicallyAttenuated=!1,this.attenuationScale=1,this.iesTexture=s}clone(t){return void 0===t&&(t=new _),super.clone(t),t.intensity=this.intensity,t.distance=this.distance,t.isPhysicallyAttenuated=this.isPhysicallyAttenuated,t.attenuationScale=this.attenuationScale,t.iesTexture=this.iesTexture,t}setup(e,i,s,r){if(e.ies.iesCount+=1,this.visible){var a=4*e.ies.iesLength;r.gammaInput&&!this.sRGB?i(e.ies.iesColors,a,this.color,this.intensity,r.simpleGamma):s(e.ies.iesColors,a,this.color,this.intensity);var n=new t.Vector3;this._occurrence&&this._occurrence.node._attachedToVpt?n.copy(this._vptPosition):n.getPositionFromMatrix(this.matrixWorld),e.ies.iesPositions[a]=n.x,e.ies.iesPositions[a+1]=n.y,e.ies.iesPositions[a+2]=n.z,e.ies.iesPositions[a+3]=this.isPhysicallyAttenuated?this.attenuationScale:this.distance,e.ies.iesPhysicalAttenuations[e.ies.iesCount-1]=this.isPhysicallyAttenuated,e.ies.iesLightTexture[e.ies.iesCount-1]=this.iesTexture;var o=new t.Matrix4;e.ies.matrixWorldInv[e.ies.iesCount-1]=o.getInverse(this.matrixWorld),e.ies.iesLength+=1}}allocate(t){t.iesLights++}}return{AreaLightUnits:s,BaseLight:a,PointLight:p,SpotLight:m,DirectionalLight:c,DirectionalIBLLight:u,DirectionalPhongLight:g,RectangleLight:d,TubeLight:l,DiskLight:h,SphereLight:o,AmbientLight:n,IESLight:_}}),define("DS/Object3D/Scene",["DS/Mesh/ThreeJS_Base","DS/Object3D/Object3D","DS/Object3D/Light","DS/Object3D/Camera","DS/Object3D/Mesh","DS/Visualization/WebGLObjectManager","DS/Visualization/CullingSystem","DS/Visualization/BufferGPUManager"],function(t,e,i,s,r,a,n,o){const h=t._VisuFilterType;const l=["main"],d=n.WebGLObjectCullingStatus,c=a.__WebGLObject,u=a.__WebGLObjectNoPoints,g=a.__WebGLObjectCurvedPipe,p=a.__WebGLObjectFixedSize,m=a.__WebGLObjectHybrid,_=a.__WebGLObjectHybridNoPoints,y=a.__WebGLObjectInstancing,f=a.__WebGLObjectInstancingNoPoints,v=a.__WebGLObjectLOD;function w(t,e,i,s){var r,n,o=t.__webglObjects,w=t.__webglObjectsAll,b=t._cullingSystems,x=null;s||(s=l);var S=null;for(S=i._instancingInfos&&i._instancingInfos.useDefaultInstancing?i.hasPoint?new y(e,i):new f(e,i):i.isCurvedPipe?new g(e,i):0===i.worldRadius&&i.pixelRadius>0?new p(e,i):i.worldRadius>0&&i.pixelRadius>0?i.hasPoint?new m(e,i):new _(e,i):i.hasPoint?new c(e,i):new u(e,i),i._getFilter(h._LOD_BRANCH)&&(S=new v(e,S)),r=0;r<s.length;r++){o[n=s[r]]||(o[n]=new a),o[n].add(S);for(var M=0;M<b.length;M++){(x=b[M]).objectManagers[n]||(x.objectManagers[n]={list:new a,frame:-1});var I=new d(S);x.objectManagers[n].list.add(I),x.objectManagers[n].frame=-2}}w.add(S)}function b(e,i,s){var r,a,n=e.object,o=e.passes,h=!1;n.__webglActive===i?h=!0:n.__webglActive instanceof Array&&n.__webglActive.indexOf(i)>=0&&(h=!0);var l=null;if(!h){if(n instanceof t.Mesh){if(1===(a=n.geometry)._type)w(i,a,n,o);else if(2===a._type||a.length>=0)w(i,a,n,o);else if(0===a._type)for(r in a.geometryGroups)w(i,a.geometryGroups[r],n,o)}else n instanceof t.Line||n instanceof t.ParticleSystem?w(i,a=n.geometry,n,o):n instanceof t.Sprite?(i.__webglSprites.push(n),!1):n instanceof t.CSS2DNode?w(i,null,n,["css2d"]):n instanceof t.CSS3DNode&&w(i,null,n,["css3d"]);n.__webglActive?n.__webglActive instanceof Array?n.__webglActive.push(i):n.__webglActive=[n.__webglActive,i]:n.__webglActive=i,s||(l=n)}return l}function x(e,i,s){e instanceof t.Mesh||e instanceof t.ParticleSystem||e instanceof t.Line||e instanceof t.CSS2DNode||e instanceof t.CSS3DNode?(s&&function(t,e){var i,s=t.__webglObjects,r=t.__webglObjectsAll;for(i in s)s[i].remove(e);r.remove(e);for(var a=t._cullingSystems,n=null,o=0;o<a.length;o++)for(i in(n=a[o]).objectManagers)n.objectManagers[i].list.remove(e),n.objectManagers[i].frame=-2}(i,e),e._removeFromAllStateSortingResults()):e instanceof t.Sprite&&function(t,e){for(var i=t.length-1;i>=0;i--)t[i]===e&&t.splice(i,1)}(i.__webglSprites,e);var r,a=e.__webglActive;a&&(a instanceof Array?(r=a.indexOf(i))<=0&&(a.splice(r,1),1===a.length&&(e.__webglActive=a[0])):e.__webglActive=!1)}return class extends e{constructor(){super(),this.overrideMaterial=null,this.matrixAutoUpdate=!1,this.envMipMap=[],this.envMipMapID=null,this.envMipMapSheenID=null,this.ambienceMatrix=new t.Matrix4,this.ambienceLightState=-1,this.reflectionProbes=null,this.useFiniteEnvMap=!1,this.parallaxCorrectionParameters={sphereCenter:[],sphereRadius:1,projectionCenter:[]},this._cullingSystems=[],this.__objects=new Set,this.__lights=[],this.__objectsAdded=new Map,this.__objectsRemoved=new Set,this.__objectsUpdated=new Map,this.defaultRenderList="main",this.isBackground=!1,this.highlightData=null,this.initWebGLObjectFrameIndex=-1,this.__webglObjects=null,this.__webglObjectsAll=null,this.__webglObjectsSharedToInit=null,this.__webglSprites=null,this.__webglFlares=null,this._forShaderPass=!1,this._inheritSGorder=!0,this.renderResultIndices=null}_lightSort(t,e){var i=t._sortKey,s=e._sortKey;return i=t.onlyShadow?0:i,s=e.onlyShadow?0:s,i+=t.castShadow?1:0,s+=e.castShadow?1:0,i+=t.shadowCascade?2:0,(s+=e.shadowCascade?2:0)-i}__addObject(e,r){if(e instanceof i.BaseLight)-1===this.__lights.indexOf(e)&&(this.__lights.push(e),this.__lights.sort(this._lightSort)),e.target&&void 0===e.target.parent&&this.add(e.target);else if(e instanceof t.LensFlare)this.__webglFlares||(this.__webglFlares=[]),this.__webglFlares.push(e);else if(!(e instanceof s.BaseCamera||e instanceof t.Bone)){if(e._scenes||(e._scenes=new Set),e._scenes.add(this),this.__objects.add(e),this.__objectsUpdated.has(e)?this.__objectsUpdated.set(e,r):this.__objectsAdded.set(e,r),!this._forShaderPass){let t=e._occurrence&&e._occurrence.getViewer();(t?t.renderer.renderer.bufferGPUManager:o).addGeometryFromObject(e)}this.__objectsRemoved.delete(e)}for(var a=0;a<e.children.length;a++)this.__addObject(e.children[a])}dispose(t){var e,i=this.children.length;if(!t)for(e=0;e<this.__lights.length;e++){var s=this.__lights[e];s.shadowMap&&s.shadowMap.dispose&&s.shadowMap.dispose()}for(e=0;e<i;e++)this.remove(this.children[0]);if(this.__objects.clear(),this.__lights=[],this.__objectsAdded.clear(),this.__objectsRemoved.clear(),this.__objectsUpdated.clear(),this.__webglObjects={main:new a},this.__webglObjectsAll=new a,this.__webglSprites=[],this._cullingSystems=[],n.__CullingSystemFactory){var r=n.__CullingSystemFactory.map,o=r.get(this.id);o&&(o.clear(),r.delete(this.id))}}updateObjectPasses(e,r){e instanceof i.BaseLight||e instanceof t.LensFlare||e instanceof s.BaseCamera||e instanceof t.Bone||(this.__objectsAdded.has(e)?this.__objectsAdded.set(e,r||null):this.__objectsUpdated.set(e,r||null),this.__objectsRemoved.delete(e))}getScene(){return this}getMeshInstances(){var t=[],e=this.getWebGLObjectsLinkedList("main");if(!e)return t;for(var i=e.first;i>-1;i=e.nexts[i]){var s=e.objects[i].object;s instanceof r&&t.push(s)}return t}__removeObject(e){if(e instanceof i.BaseLight)-1!==(r=this.__lights.indexOf(e))&&this.__lights.splice(r,1);else if(e instanceof t.LensFlare){var r;-1!==(r=this.__webglFlares.indexOf(e))&&this.__webglFlares.splice(r,1)}else e instanceof s.BaseCamera||this.__objects.delete(e)&&(this.__objectsRemoved.add(e),e._scenes&&e._scenes.delete(this),this.flagAsGSSOInvalidated(e),e._removeFromAllStateSortingResults(),this.__objectsAdded.delete(e));for(var a=0;a<e.children.length;a++)this.__removeObject(e.children[a])}getWebGLObjects(t){var e=this.__webglObjects[t&&"main"!==t?t:this.defaultRenderList];return e?e.getObjects():[]}getWebGLObjectsLinkedList(t){var e=this.__webglObjects[t&&"main"!==t?t:this.defaultRenderList];return e?e.getLinkedList():null}flagAsGSSOInvalidated(t){if(null!==t)for(var e=this._cullingSystems,i=0;i<e.length;i++){var s=e[i];for(var r in s.objectManagers)s.objectManagers[r].list._applyToObject(t,function(t){t.invalidated=!0})}}flagAsFrustumCulled(t,e){if(null!==t){var i=this.__webglObjectsAll;null!==i&&i._applyToObject(t,function(t){t.frustumCulled=e})}}getNbWebGLObjects(t){if(!this.__webglObjects)return 0;var e=this.__webglObjects[t&&"main"!==t?t:this.defaultRenderList];return e?e.size:0}getAllWebGLObjects(){return this.__webglObjectsAll.getObjects()}getAllWebGLObjectsLinkedList(){return this.__webglObjectsAll.getLinkedList()}getNbAllWebGLObjects(){return this.__webglObjects?this.__webglObjectsAll.size:0}computeLightsKey(){for(var t=this.__lights,e={dirLights:0,dirIBLLights:0,dirPhongLights:0,pointLights:0,spotLights:0,sphereLights:0,rectangleLights:0,diskLights:0,tubeLights:0,iesLights:0,key:0},i={dirLight:0,dirIBLLight:0,spotLight:0,tex2d:0,texCube:0},s=t.length,r=0;r<s;r++){var a=t[r];a.onlyShadow||(a.allocate(e),a.castShadow&&a.allocateShadows(null,i))}var n=e.iesLights;return n=16*(n=16*(n=16*(n=16*(n=16*(n=16*(n=16*(n=16*(n=16*(n=16*(n=16*(n=16*(n=16*n+e.pointLights)+e.spotLights)+e.dirLights)+e.dirIBLLights)+e.dirPhongLights)+e.rectangleLights)+e.sphereLights)+e.diskLights)+e.tubeLights)+i.texCube)+i.spotLight)+i.dirLight)+i.dirIBLLight,e.key=n,e}__processAddedObjects(t){var e=this;this.__objectsAdded.forEach(function(i,s,r){t({object:s,passes:i},e,!1,b)}),this.__objectsAdded.clear()}__processUpdatedObjects(t){var e=this;this.__objectsUpdated.forEach(function(i,s,r){x(s,e,!0),t({object:s,passes:i},e,!0,b)}),this.__objectsUpdated.clear()}__processRemovedObjects(t){var e=this;t&&t.removeGeometryList(this.__objectsRemoved),this.__objectsRemoved.forEach(function(t,i,s){x(t,e,!1)}),function(t){var e,i=t.__webglObjects,s=t.__webglObjectsAll,r=t.__objectsRemoved;for(e in i)i[e].removeCollection(r);s.removeCollection(r);for(var a=t._cullingSystems,n=null,o=0;o<a.length;o++)for(e in(n=a[o]).objectManagers)n.objectManagers[e].list.removeCollection(r),n.objectManagers[e].frame=-2}(this),this.__objectsRemoved.clear()}setSGOrderHeritage(t){this._inheritSGorder=t}}});