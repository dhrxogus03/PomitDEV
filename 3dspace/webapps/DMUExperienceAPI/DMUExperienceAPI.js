define("DS/DMUExperienceAPI/DMUExperienceImporterAPI",["UWA/Class","DS/DMUBaseUIControllers/DMUReviewContextInitializer","DS/DMUBaseExperience/EXPImportServices","DS/DMUBaseUIServices/DMUSlidePreferences","DS/DMUBaseExperience/EXPUtils","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUBaseUIControllers/DMUSlidesController","DS/DMUBaseExperience/DMUContextManager"],function(e,t,i,n,r,a,o,s){"use strict";return e.extend({init:function(e){var l,d=e||{},c=d.context,u=this;c&&d.markupsLinkedTo3DXmlModels&&(l=c.getViewer().getIdPathMatcher(),a.initIdPathMatcher(c.getViewer())),this.importModel=async function(a){if(c&&a&&(a.json||a.markupStream)){a.json&&window.console.warn('============ DMUExperienceImporterAPI.importModel - "json" is a DEPRECATED attribute. Please use "markupStream" instead ============'),u.removeModel();var s=await t.createReviewContext({context:c}),l="boolean"!=typeof e.bDisplayNominal||e.bDisplayNominal,d="boolean"!=typeof e.bDisplayInWork||e.bDisplayInWork,p="boolean"!=typeof e.displayDMUSlidePanel||e.displayDMUSlidePanel;n.setSlidePreferences({context:c.getFrameWindow(),preferences:{displayNominal:l,displayInWork:d,panelTitle:e.thumbnailListTitle,displaySlidePanel:p,beforeApplySlideCB:e.beforeApplySlideCB,afterApplySlideCB:e.afterApplySlideCB}});var g=a.markupStream?JSON.parse(r.cleanJSONString(a.markupStream)):a.json;if(s&&g.Model){var M=new i({viewer:c.getViewer(),experience:s,appType:"3dPlay"});M.importDataModel(g,function(t){if(M.postImport(),s.setCurrentSessionMarkup(t[0].getMarkupContent?t[0].getMarkupContent():t[0]),s.setReadOnly(!0),s.getCurrentSessionMarkup()){var i=o.giveDMUSlidesController({context:c.getFrameWindow()});if(i){var r=s.getCurrentSessionMarkup().getSlides();if(r&&r.length){if(a.slideUUIDs&&a.slideUUIDs.length)for(var d=a.slideUUIDs.slice(),u=l?1:0;u<r.length&&d.length;u++)r[u].getAttribute("bInWork")||(r[u].setAttribute("sUuid",d[0]),i.updateSlide(r[u],{uuid:d[0]}),d.splice(0,1));a.doNotDisplayFirstSlide||r[0]&&i.setActiveSlide(r[0]),p&&!e.thumbnailListTitle&&n.setSlidePreferences({context:c.getFrameWindow(),preferences:{panelTitle:s.getCurrentSessionMarkup().getAttribute("sName")}})}}}a.onModelLoadedCB&&a.onModelLoadedCB({uuidMappingTable:M.getUUIDMappingTable()})})}}},this.removeModel=function(){c&&(n.removeSlidePreferences({context:c.getFrameWindow()}),s.removeReviewContext({context:c}))},this.destroyDMUImporter=function(){d.markupsLinkedTo3DXmlModels&&c&&c.getViewer().setIdPathMatcher(l)}}})}),define("DS/DMUExperienceAPI/DMUOptionsManager",["DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseUIControllers/DMUReviewContextInitializer"].concat(["DS/ApplicationFrame/CommandsManager"]),function(e,t,i){"use strict";var n={setDMUUnit:async function(i){if(i.context&&i.parameter){var r=e.getReviewContext(i);if(r||(r=await t.createReviewContext(i)),r){var a=n.getDMUUnit(i);r.getDMUPreferenceRepository().setPreference(i.parameter,i.unit),a!==n.getDMUUnit(i)&&(r.getCurrentSessionMarkup()&&r.getCurrentSessionMarkup().refreshNode(),r.getTransientReviewBag()&&r.getTransientReviewBag().refreshNode(),i.context.getViewer().render())}}},getDMUUnit:function(t){if(t.context&&t.parameter){var i=e.getReviewContext(t);return i?i.getDMUPreferenceRepository().getPreference(t.parameter):void 0}},setCommandMode:function(e){if(e.context&&e.cmdHeader){var t=i.getCommand(e.cmdHeader,e.context.getCommandContext());t&&t.setCommandMode(e.mode)}}};return n}),define("DS/DMUExperienceAPI/DMUWebDesignReviewMarkerServices",["DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager"],function(e,t){"use strict";return{selectDMUObjects:function(i){if(i&&i.context&&i.uuids&&i.uuids.length){var n=e.getReviewContext(i);if(n){var r=n.getCurrentSessionMarkup();if(r){var a=[],o=[r];o=o.concat(r.getOccurrenceOverloaders());var s=r.getSlides();s.forEach(function(e){o=o.concat(e.getDMUObjects())}),(s=r.getFormats()).forEach(function(e){o=o.concat(e.getDMUObjects())}),o.forEach(function(e){e&&e.getPathElement&&e.getAttribute&&-1!==i.uuids.indexOf(e.getAttribute("sUuid"))&&a.push({pathElement:e.getPathElement()})}),a.length&&t.add(a)}}}},getSelectedDMUObjectIDs:function(i){if(i&&i.context){var n=[],r=e.getReviewContext(i);if(r){var a=r.getCurrentSessionMarkup();if(a)t.get().forEach(function(e){var t=a.getDMUObjectFromPathElement(e.pathElement);t&&t.getAttribute("sUuid")&&n.push(t.getAttribute("sUuid"))})}return n}}}}),define("DS/DMUExperienceAPI/DMUExperienceAPI",[],function(){}),define("DS/DMUExperienceAPI/DMUWebDesignReviewSlideServices",["DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseUIControllers/DMUSlidesController"],function(e,t){"use strict";return{applySlide:function(i){if(i&&i.context&&i.uuid){var n=e.getReviewContext(i);if(n){var r=n.getCurrentSessionMarkup();if(r){for(var a=null,o=r.getSlides(),s=0;s<o.length;s++)if("Nominal"!==i.uuid&&o[s].getAttribute("sUuid")===i.uuid||"Nominal"===i.uuid&&!o[s].getAttribute("sUuid")){a=o[s];break}var l=t.giveDMUSlidesController({context:i.context.getFrameWindow()});l?l.setActiveSlide(a,{duration:i.duration,afterSlideActivationCB:i.onSlideActivated}):t.setActiveSlide({context:i.context,slide:a,duration:i.duration,onSlideActivated:i.onSlideActivated})}}}},getSlidesDefinition:function(t){var i=[];if(!t||!t.context)return i;var n=e.getReviewContext(t);if(n){var r=n.getCurrentSessionMarkup();if(r)for(var a=r.getSlides(),o=0;o<a.length;o++)i.push({name:a[o].getAttribute("sName"),uuid:a[o].getAttribute("sUuid"),preview:a[o].getPreview(),inWork:a[o].getAttribute("bInWork")})}return i}}});