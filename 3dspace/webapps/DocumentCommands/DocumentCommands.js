define("DS/DocumentCommands/DOCMClipboard",["UWA/Core","UWA/Promise","DS/WAFData/WAFData","DS/CoreEvents/ModelEvents","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],function(e,t,o,n,i,a){"use strict";return{events:new n,contentCopied:!1,copy:function(e){window.docmClipboard=e,this.contentCopied=!0,this.events.publish({event:"x3dcontent-copied",data:{cancelled:!1,data:this.contentCopied}})},paste:function(e){window.docmClipboard&&e&&e({action:"Paste",data:window.docmClipboard})}}}),define("DS/DocumentCommands/V2/FileActions/CopyLink",["UWA/Core","UWA/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Dropdown","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o,n,i,a,s){"use strict";var l=function(e){return{id:"CopyLink",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"link",fontIconFamily:1},tooltip:s.get("CopyLink"),label:s.get("CopyLink"),position:"far",category:"colllaboration",value:function(t){t.options=e,l.execute(t)},visibleFlag:!1},execute:function(){l.execute({options:e})},updateForSelection:function(o,n){return new t(function(t){o({visibleFlag:"MultiFilePreviewtoolbar"==e.getOrigin().component||1==e.getSelectedNodes().length}),t(!0)})}}};return l.execute=function(t){var a=t.options.getSelectedNodes(),l=void 0;a.length>0&&(l=a[0]);var c=void 0;l&&(c=t.options.getDocumentFromNodeModel(l));var r=t.options.getParentDocument(),d=t.options.container,u=void 0;c&&null==(u=c.title||c.name)&&c.dataelements&&(u=c.dataelements.title||c.dataelements.name);var m=function(e){var t={protocol:"3DXContent",data:{items:[]}};t.data.items.push({envId:e.envId,objectId:e.objectId,openLink:!0,objectType:"Document"}),e.fileid&&(t.data.items[0].fileid=e.fileid,t.data.items[0].openFile=!0);return t}({objectId:r,envId:t.options.platformUrls.platformId,fileid:c?c.id:void 0,titleOrName:u}),p=e.createElement("div",{styles:{display:"flex"}}),f=new n("input",{attributes:{readonly:"readonly"}});f.getContent().setStyles({display:"inline-block","border-top-right-radius":0,"border-bottom-right-radius":0}),f.inject(p);var g=new o({value:s.get("CopyLink"),className:"block",events:{onClick:function(o){f.setFocus(),f.elements.input.select(),f.elements.input.setSelectionRange(0,99999),document.execCommand("cut"),v.hide(),u&&""!==u?t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:s.get("LinkCopiedTitle"),subtitle:e.String.format(s.get("LinkCopiedMsg"),u),message:"",sticky:!1,allowUnsafeHTML:!1}}):t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:s.get("LinkCopiedTitle"),subtitle:s.get("LinkCopied"),message:"",sticky:!1,allowUnsafeHTML:!1}})}}});g.getContent().setStyles({display:"inline-block","border-top-left-radius":0,"border-bottom-left-radius":0,padding:"0 10px"}),g.inject(p);var v=new i({body:p,closeOnClick:!1,events:{onClickOutside:function(e){console.log("DDClickOutside")}}});v.options.target=d;var D=t.options.widget.widgetDomain;if(null==D&&(D=t.options.platformUrls["3DDashboard"]),console.log(D),null==D)throw"url is undefined.";v.hide(),v.show(),f.setFocus(),f.setValue(D+"#app:ENXWDOC_AP/content:X3DContentId="+encodeURIComponent(JSON.stringify(m))),f.elements.input.select(),f.elements.input.setSelectionRange(0,99999,"backward"),g.getContent().click()},l}),define("DS/DocumentCommands/V2/Actions/Subscription/UnSubscribe",["i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e){"use strict";var t=function(o){return{id:"UnSubscribe",type:"PushItem",title:e.get("UnSubscribe"),dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"bell-delete",fontIconFamily:1},label:e.get("UnSubscribe"),tooltip:e.get("UnSubscribe"),position:"far",category:"information",value:function(e){e.options=o,t.execute(e)},visibleFlag:!1},execute:function(){t.execute({options:o})},updateForSelection:function(e,t){e({visibleFlag:o.getSelectedNodes().length>=1})}}};return t.execute=function(e){require(["DS/ENOSubscriptionMgmt/Commands/UnSubscribe"],function(t){var o=e.options.getSelectedNodes().map(function(t){var o=e.options.getDocumentFromNodeModel(t);return{physicalid:o.id,type:o.type,getID:function(){return o.id},getType:function(){return o.type}}});new t({ID:"UnSubscribeCmdHdr",context:{getSelectedNodes:()=>o},objIDType:"modelID"}).execute(e)})},t}),define("DS/DocumentCommands/V2/FileActions/Delete",["UWA/Core","UWA/Promise","DS/UIKIT/Modal","DS/WAFData/WAFData","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o,n,i,a){"use strict";var s=function(e){return{id:"Delete",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"trash",fontIconFamily:1},label:a.get("Delete"),tooltip:a.get("Delete"),position:"far",category:"destructive",value:function(t){t.options=e,s.execute(t)},visibleFlag:!1},execute:function(){s.execute({options:e})},updateForSelection:function(o,n){return new t(function(t){o({visibleFlag:e.getSelectedNodes().length>0}),t(!0)})}}};return s.execute=function(t){if(t.options.getSelectedNodes().length>0){var i='<div style="display: flex;"><span class="fonticon fonticon-attention text-warning fonticon-2x"></span><p style="margin-left: 10px; white-space: pre-line">'+a.get("DeleteConfirmationMsg")+"</p></div>",s=new o({className:"site-reset",header:a.get("DeleteConfirmation",""),body:i,footer:'<button type="button" class="btn btn-primary">'+a.get("Confirm")+'</button> <button type="button" class="btn btn-default">'+a.get("Cancel")+"</button>",animate:!0,resizable:!0,autocenter:!0,visible:!0,limitParent:!0,overlay:!0,closable:!1});s.show(),s.elements.container.setStyle("z-index","50000"),s.inject(t.options.widget.body),s.getContent().getElements(".btn.btn-primary").forEach(function(o){o.addEvent("click",function(){!function(t){var o={},i=t.options.getParentDocument(),s=t.options.getSelectedNodes();o.tenant=t.options.platformUrls.platformId,o.securityContext=t.options.fetchSecurityContext(),o.tenantUrl=t.options.platformUrls["3DSpace"],o.onFailure=function(e,o){if(o.error)t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("YouCannotDeleteX",{typeNLS:"Document"}),subtitle:a.get("VerifyCredentials"),message:a.get("NotHaveRequiredAccessRole"),sticky:!1,allowUnsafeHTML:!1}});else if(e&&e.error)if((e.error.match(/\n/g)||[]).length>=2){for(var n=e.error.split("\n"),i=[],s=2;s<n.length;s++)i.push(n[s]);i=i.join("<br/>"),t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:n[0],subtitle:n[1],message:i,sticky:!1,allowUnsafeHTML:!0}})}else t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("YouCannotDeleteX",{typeNLS:"Document"}),subtitle:e.error,message:"",sticky:!1,allowUnsafeHTML:!1}});else t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("YouCannotDeleteX",{typeNLS:"Document"}),subtitle:e,message:"",sticky:!1,allowUnsafeHTML:!1}});console.error("Document Delete Failed Due to:"),console.error(e)},o.onComplete=function(o){t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:a.get("Filedeletesuccessful"),subtitle:e.String.format(a.get("FiledeletesuccessfulMsg")),message:"",sticky:!1,allowUnsafeHTML:!1}}),t.options.events.publish({event:"enox-docfiles-delete-complete",data:{nodeModels:s,data:o.data}}),require(["DS/PlatformAPI/PlatformAPI"],function(e){e.publish("docm-files-deleted-from-document",{platformId:t.options.platformUrls.platformId,documentId:i,deletedFileIds:s.map(function(e){return e.options.data.id})})})};var l=[];s.map(function(e){var o=t.options.getDocumentFromNodeModel(e),n={id:o.id,updateAction:"DELETE"};l.push(n)}),n.authenticatedRequest(o.tenantUrl+"/resources/v1/application/E6WFoundation/CSRF",e.extend({},{method:"GET",url_temp:o.tenantUrl,onComplete:function(e){o.onComplete,o.onFailure;var t=o.tenantUrl+"/resources/v1/modeler/documents/"+i+"/files";o.type="json",o.url=encodeURI(t);var a=JSON.parse(e).csrf;o.data=JSON.stringify({csrf:a,data:l}),o.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:o.securityContext},o.method="PUT",n.authenticatedRequest(o.url,o)}}))}(t),s.hide(),s.destroy()})}),s.getContent().getElements(".btn.btn-default").forEach(function(e){e.addEvent("click",function(){s.hide(),s.destroy()})})}},s}),define("DS/DocumentCommands/V2/Actions/Move",["UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t){"use strict";var o=function(n){return{id:"Move",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"move-to",fontIconFamily:1},label:t.get("Move"),tooltip:t.get("Move"),position:"far",category:"colllaboration",value:function(e){e.options=n,o.execute(e)},visibleFlag:!1},execute:function(){o.execute({options:n})},updateForSelection:function(t,o){return new e(function(e){t({visibleFlag:n.getSelectedNodes().length>=1}),e(!0)})}}};return o.execute=function(e){require(["DS/ENOCollabSharingCmds/commands/TransferOwnershipCmd/ActionBar_ChangeOwnerCmd"],function(t){var o=e.options.getSelectedNodes().map(function(e){var t=e;return t.options.physicalid&&0!=t.options.physicalid.length||(t.options.physicalid=t.options.data.id),t.getID||(t.getID=function(){return t.options.physicalid}),t});(t=new t({ID:"changeOwner_cmd_id",context:{getSelectedNodes:()=>o,securityContext:{SecurityContext:e.options.fetchSecurityContext()},getSecurityContext:function(){return this.securityContext}}})).begin()})},o}),define("DS/DocumentCommands/V2/FileActions/Preview",["UWA/Core","UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o){"use strict";var n=void 0,i=void 0,a=function(e){return{id:"Preview",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"eye",fontIconFamily:1},label:o.get("Preview"),tooltip:o.get("Preview"),position:"far",category:"view",value:function(t){t.options=e,a.execute(t)},visibleFlag:!1},execute:function(){a.execute({options:e})},updateForSelection:function(o,n){return new t(function(t){o({visibleFlag:1==e.getSelectedNodes().length}),t(!0)})}}};return a.execute=function(e){var t=e.options.getSelectedNodes()[0],o=e.options.getParentDocument(),a=e.options.getDocumentFromNodeModel(t);e.options.getDocumentFromNodeModel(t)&&e.options.ctrl.controller.data.getFiles(o).then(function(t){var o=t.e6wDocument;require(["DS/DocumentMultiFilePreview/MultiFilePreviewComponent"],function(t){n&&(e.options.events.unsubscribe(n),n=void 0),n=e.options.events.subscribe({event:"docv2-preview-reload-viewer"},function(t){if(e.options.widget.multiFilePreviewComponent&&1==e.options.getSelectedNodes().length&&null!=t.nodeModel){var o=e.options.getSelectedNodes()[0],n=e.options.getDocumentFromNodeModel(o);e.options.getDocumentFromNodeModel(t.nodeModel).id==n.id&&e.options.widget.multiFilePreviewComponent.updateDocument(n,!0)}}),i&&(e.options.events.unsubscribe(i),i=void 0),i=e.options.events.subscribe({event:"docv2-preview-reload-toolbar"},function(t){if(e.options.widget.multiFilePreviewComponent&&1==e.options.getSelectedNodes().length&&null!=t.nodeModel){var o=e.options.getSelectedNodes()[0],n=e.options.getDocumentFromNodeModel(o);e.options.getDocumentFromNodeModel(t.nodeModel).id==n.id&&e.options.widget.multiFilePreviewComponent.updateDocument(n,!1)}}),e.options.widget.multiFilePreviewComponent?(e.options.widget.multiFilePreviewComponent.setOptions({platformUrls:e.options.platformUrls,modelEvents:e.options.events,tenant:e.options.platformUrls.platformId,securityContext:e.options.fetchSecurityContext(),hideNextPrev:!0,enableFavoriteToggle:!1,documentManagedByPreview:!0,selectedFileId:a.id}),
//! argumentList.options.widget.multiFilePreviewComponent.updateDocument(e6wDocument, true);
e.options.widget.multiFilePreviewComponent.updateDocument(o,a.id)):(window.previewLoadStart=new Date,e.options.widget.multiFilePreviewComponent=new t({document:o,platformUrls:e.options.platformUrls,modelEvents:e.options.events,tenant:e.options.platformUrls.platformId,securityContext:e.options.fetchSecurityContext(),selectedFileId:a.id,hideNextPrev:!0,enableFavoriteToggle:!1,documentManagedByPreview:!0,uaSource:e.options.getSourceForUsageAnalytics()}),e.options.widget.multiFilePreviewComponent.loaded=function(e){},e.options.widget.multiFilePreviewComponent.elements.container.setStyles({background:"white",width:"100%",height:"100%"}),e.options.widget.multiFilePreviewComponent.close=function(){e.options.widget.multiFilePreviewComponent.destroy(),e.options.widget.multiFilePreviewComponent=void 0},e.options.widget.multiFilePreviewComponent.inject(e.options.widget.body))})})},a}),define("DS/DocumentCommands/V2/Actions/Share",["UWA/Core","UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o){"use strict";var n=function(e){return{id:"Share",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"forward",fontIconFamily:1},label:o.get("Share"),tooltip:o.get("Share"),position:"far",category:"colllaboration",value:function(t){t.options=e,n.execute(t)},visibleFlag:!1},execute:function(){n.execute({options:e})},updateForSelection:function(o,n){return new t(function(t){o({visibleFlag:e.getSelectedNodes().length>=1}),t(!0)})}}};return n.execute=function(t){var o=t.options.getSelectedNodes();require(["DS/ENOCollabSharingCmds/BaseModels/ResultElement","DS/SharePopup/SharePopup"],function(n,i){var a=o.map(function(o){var i=t.options.getDocumentFromNodeModel(o),a=void 0;i&&null==(a=i.title||i.name)&&i.dataelements&&(a=i.dataelements.title||i.dataelements.name);var s=void 0;i.revision?s=i.revision:i.dataelements&&(s=i.dataelements.revision);var l=void 0;i.typeNLS?l=i.typeNLS:i.dataelements&&(l=i.dataelements.typeNLS);var c=void 0;i.collabSpaceTitle?c=i.collabSpaceTitle:i.dataelements&&(c=i.dataelements.collabSpaceTitle);var r=void 0;i.organizationTitle?r=i.organizationTitle:i.dataelements&&(r=i.dataelements.organizationTitle);var d=void 0;return e.is(i.firstname,"string")?d=i.firstname+" "+i.lastname:i.relateddata&&i.relateddata.ownerInfo&&i.relateddata.ownerInfo[0]&&i.relateddata.ownerInfo[0].dataelements&&e.is(i.relateddata.ownerInfo[0].dataelements.firstname,"string")&&(d=i.relateddata.ownerInfo[0].dataelements.firstname+" "+i.relateddata.ownerInfo[0].dataelements.lastname),new n({physicalId:i.id,Revision:s,typeDisplayName:l,name:a,organizationTitle:r,collabSpaceTitle:c,responsibleName:d})});t.options.sharePanel?(t.options.sharePanel.show(a),t.options.sharePanel.container.centerIt()):(t.options.sharePanel=new i(t.options.widget,t.options.widget.body,{removeAtClose:!0,events:{onClose:function(){t.options.sharePanel=null}}}),t.options.sharePanel.show(a))})},n}),define("DS/DocumentCommands/V2/Actions/Subscription/MySubscriptions",["i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e){"use strict";var t=function(o){return{id:"MySubscriptions",type:"PushItem",title:e.get("MySubscriptions"),dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"bell",fontIconFamily:1},label:e.get("MySubscriptions"),tooltip:e.get("MySubscriptions"),position:"far",category:"information",value:function(e){e.options=o,t.execute(e)},visibleFlag:!0},execute:function(){t.execute({options:o})},updateForSelection:function(e,t){e({visibleFlag:0==o.getSelectedNodes().length})}}};return t.execute=function(e){require(["DS/ENOSubscriptionMgmt/Commands/MySubscriptions"],function(t){var o=e.options.getSelectedNodes().map(function(t){var o=e.options.getDocumentFromNodeModel(t);return{physicalid:o.id,type:o.type,getID:function(){return o.id},getType:function(){return o.type}}});new t({ID:"MySubscriptionsCmdHdr",context:{getSelectedNodes:()=>o},objIDType:"modelID"}).execute(e)})},t}),define("DS/DocumentCommands/V2/Actions/Relations",["UWA/Promise","UWA/Utils/InterCom","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o){"use strict";var n=function(t){return{id:"Relations",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"object-related",fontIconFamily:1},label:o.get("Relations"),tooltip:o.get("Relations"),position:"far",category:"information",value:function(e){e.options=t,n.execute(e)},visibleFlag:!1},execute:function(){n.execute({options:t})},updateForSelection:function(o,n){return new e(function(e){o({visibleFlag:t.getSelectedNodes().length>0}),e(!0)})}}};return n.execute=function(e){var o=function(e,t){var o={protocol:"3DXContent",version:"2.0",source:"ENOXATTACHMENTS",widgetId:t.widget.id,data:{items:[]}};return e.forEach(function(e){var n={envId:t.platformUrls.platformId,serviceId:"3DSpace",contextId:t.fetchSecurityContext(),objectId:t.getDocumentFromNodeModel(e).id,objectType:t.getDocumentFromNodeModel(e).type};t&&t.includeObjectTaxonomies&&(n.objectTaxonomies=e.options.taxonomies),o.data.items.push(n)}),o}(e.options.getSelectedNodes(),e.options);o.appId="ENORIPE_AP";var n=new t.Socket("compassPageSocket");n.subscribeServer("com.ds.compass",window.parent),n.dispatchEvent("onSetX3DContent",o,"compassPageSocket"),n.addListener("launchApp",function(e,t,o){n.unsubscribeServer("com.ds.compass"),n.disconnect()}),n.dispatchEvent("onLaunchApp",o,"compassPageSocket")},n}),define("DS/DocumentCommands/V2/Actions/Download",["UWA/Core","UWA/Element","UWA/Promise","DS/DocumentManagement/DocumentManagement","DS/DocumentCommonInfra/TrackerAPI","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o,n,i,a){"use strict";var s=e.createElement("iframe",{name:"multidocdownloaderFrame",styles:{display:"none"}}),l=e.createElement("form",{method:"POST",enctype:"application/x-www-form-urlencoded",target:"multidocdownloaderFrame",html:[{tag:"input",value:"true",name:"attachment"}],styles:{display:"none"}}),c=function(e){return{id:"Download",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"download",fontIconFamily:1},label:a.get("Download"),tooltip:a.get("Download"),position:"far",category:"information",value:function(t){t.options=e,c.execute(t)},visibleFlag:!1},execute:function(){c.execute({options:e})},updateForSelection:function(t,n){return new o(function(o){var n=!0;e.getOrigin&&"MultiFilePreviewtoolbar"==e.getOrigin().component&&(1==e.previewedDocumentStatusModel.getPreviewedDocumentFiles().length||(n=!1));t({visibleFlag:e.getSelectedNodes().length>0&&n}),o(!0)})}}};return c.execute=function(t){if(t.options.getSourceForUsageAnalytics=t.options.getSourceForUsageAnalytics||function(e){t.options.uaSource||(t.options.uaSource="unknown");var o=t.options.uaSource;return e&&(o=o+"."+e),t.options.isFromContextMenu?o+=" Contextual Menu":o+=" Tool bar",o},1==t.options.getSelectedNodes().length){var o=new Date,c=t.options.getSelectedNodes()[0],r=t.options.getDocumentFromNodeModel(c),d=[];r.files?d=r.files:r.relateddata&&r.relateddata.files&&(d=r.relateddata.files);var u=void 0;if(r&&null==(u=r.title||r.name)&&r.dataelements&&(u=r.dataelements.title||r.dataelements.name),0==d.length)return void t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("DownloadFailed"),subtitle:"",message:a.get("DocumentHasNoFile",{documents:u}),sticky:!1,allowUnsafeHTML:!1}});var m=void 0;e.is(t.options.getSelectedFile,"function")&&null!=t.options.getSelectedFile()&&(m=t.options.getSelectedFile().id,u=t.options.getSelectedFile().dataelements.title),(h={asZip:!0,autoDownload:!0,additionalURLParams:"useDOCMParamSettings=true"}).tenant=t.options.platformUrls.platformId,h.securityContext=t.options.fetchSecurityContext(),h.tenantUrl=t.options.platformUrls["3DSpace"],h.onComplete=function(n){var s=new Date-o;if(i.sendTrackerPageEvent({category:"docm.command.download",action:"click",label:"Document Download",pd:{docType:r.type,docId:r.id,source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:s,success:1,numberOfDocuments:1}}),u&&""!==u){var l={subtitle:e.String.format(a.DOWNLOAD_FILES_INITIATED,u)};t.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:l.title||"",subtitle:l.subtitle||"",message:"",sticky:!1,allowUnsafeHTML:!1}})}else t.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:a.Download_Initiated,subtitle:"",message:"",sticky:!1,allowUnsafeHTML:!1}})},h.onFailure=function(e){var n=new Date-o;i.sendTrackerPageEvent({category:"docm.command.download",action:"click",label:"Document Download",pd:{docType:r.type,docId:r.id,source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:n,failure:0,numberOfDocuments:1}}),t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("DownloadFailed"),subtitle:a.get("VerifyCredentials"),message:a.get("NotHaveRequiredAccessRole"),sticky:!1,allowUnsafeHTML:!1}})},t.options.widget&&t.options.widget.MSFDocumentClient&&null===n.MSFDocumentClient?n.MSFDocumentClient=t.options.widget.MSFDocumentClient:t.options.MSFDocumentClient&&null===n.MSFDocumentClient&&(n.MSFDocumentClient=t.options.MSFDocumentClient),n.downloadDocument(r.id,m,!1,h)}else if(t.options.getSelectedNodes().length>1){var p=new Date,f=t.options.getSelectedNodes().map(function(e){return t.options.getDocumentFromNodeModel(e)}).map(function(e){var t=[];e.files?t=e.files:e.relateddata&&e.relateddata.files&&(t=e.relateddata.files);var o=e.title||e.name;return null==o&&e.dataelements&&(o=e.dataelements.title||e.dataelements.name),{title:o,count:t.length}}),g=[],v=[];for(var D of f)D.count>1&&g.push(D.title),0==D.count&&v.push(D.title);if(v.length>0)return void t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("DownloadFailed"),subtitle:"",message:a.get("DocumentHasNoFile",{documents:v.join(", ")}),sticky:!1,allowUnsafeHTML:!1}});if(g.length>0)t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("DownloadFailed"),subtitle:"",message:a.get("MoreThanOneFileInMultipleDocuments",{documents:g.join(", ")}),sticky:!1,allowUnsafeHTML:!1}});else{var h,S=t.options.getSelectedNodes().map(function(e){return t.options.getDocumentFromNodeModel(e).id});(h={asZip:!0,autoDownload:!0,additionalURLParams:"useDOCMParamSettings=true"}).tenant=t.options.platformUrls.platformId,h.securityContext=t.options.fetchSecurityContext(),h.tenantUrl=t.options.platformUrls["3DSpace"],h.onComplete=function(o){var n=new Date-p;i.sendTrackerPageEvent({category:"docm.command.mulitpledownload",action:"click",label:"Multiple Document Download",pd:{source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:n,success:1,numOfDocuemnts:S.length,numOfFiles:o[0].fileNames.length}});var c=o;e.is(c,"array")&&c.forEach(function(o){if(o.downloadUrl){var n=new URL(o.downloadUrl),i=(s.isInjected()||s.inject(document.body),l.isInjected()||l.inject(document.body),l.empty(),e.createElement("input",{name:"attachment",value:"true"}).inject(l),l);for(var c of n.searchParams)e.createElement("input",{name:c[0],value:c[1]}).inject(i);n.search="",i.action=n.href,console.log(n),i.submit(),t.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:a.get("DownloadHasStarted"),subtitle:"",message:a.get("DownloadHasStarted"),sticky:!1,allowUnsafeHTML:!1}})}else t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("DownloadNotInitiated"),subtitle:"",message:"",sticky:!1,allowUnsafeHTML:!1}})})},h.onFailure=function(e){var o=new Date-p;i.sendTrackerPageEvent({category:"docm.command.mulitpledownload",action:"click",label:"Multiple Document Download",pd:{source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:o,failure:1,numOfDocuemnts:S.length}}),t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("DownloadFailed"),subtitle:e[0].errorMessage,message:"",sticky:!1,allowUnsafeHTML:!1}})},t.options.widget&&t.options.widget.MSFDocumentClient&&null===n.MSFDocumentClient?n.MSFDocumentClient=t.options.widget.MSFDocumentClient:t.options.MSFDocumentClient&&null===n.MSFDocumentClient&&(n.MSFDocumentClient=t.options.MSFDocumentClient),n.downloadDocuments(S,h)}}},c}),define("DS/DocumentCommands/V2/Actions/Subscription/SubscriptionForOthers",["i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e){"use strict";var t=function(o){return{id:"SubscriptionForOthers",type:"PushItem",title:e.get("SubscriptionForOthers"),dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"subscription-others-add",fontIconFamily:1},label:e.get("SubscriptionForOthers"),tooltip:e.get("SubscriptionForOthers"),position:"far",category:"information",value:function(e){e.options=o,t.execute(e)},visibleFlag:!1},execute:function(){t.execute({options:o})},updateForSelection:function(e,t){e({visibleFlag:o.getSelectedNodes().length>=1})}}};return t.execute=function(e){require(["DS/ENOSubscriptionMgmt/Commands/PushSubscribe"],function(t){var o=e.options.getSelectedNodes().map(function(t){var o=e.options.getDocumentFromNodeModel(t);return{physicalid:o.id,type:o.type,getID:function(){return o.id},getType:function(){return o.type}}});new t({ID:"PushSubscribeHdr",context:{getSelectedNodes:()=>o},objIDType:"modelID"}).execute(e)})},t}),define("DS/DocumentCommands/V2/Actions/ChangeOwner",["UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t){"use strict";var o=function(n){return{id:"ChangeOwner",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"user-change",fontIconFamily:1},label:t.get("ChangeOwner"),tooltip:t.get("ChangeOwner"),position:"far",category:"colllaboration",value:function(e){e.options=n,o.execute(e)},visibleFlag:!1},execute:function(){o.execute({options:n})},updateForSelection:function(t,o){return new e(function(e){t({visibleFlag:n.getSelectedNodes().length>=1}),e(!0)})}}};return o.execute=function(e){require(["DS/ENOCollabSharingCmds/commands/TransferOwnershipCmd/ActionBar_TransferOwnershipCmd"],function(t){var o=e.options.getSelectedNodes().map(function(e){var t=e;return t.options.physicalid&&0!=t.options.physicalid.length||(t.options.physicalid=t.options.data.id),t.getID||(t.getID=function(){return t.options.physicalid}),t});(t=new t({ID:"transferOwnership_cmd_id",context:{getSelectedNodes:()=>o,securitycontext:e.options.fetchSecurityContext(),getSecurityContext:function(){return{SecurityContext:this.securitycontext}}}})).begin()})},o}),define("DS/DocumentCommands/Jobs",["UWA/Core"],function(e){"use strict";return function(e){var t={name:"doco-jobs",MAX_PARALLEL_JOBS:1,jobs:[],states:{WAIT:1,PROCESSING:2,FINISHED:3},init:function(e){this.app=e},latestJobId:0,process:function(){var e=this.jobs.filter(function(e){return e.processing==t.states.PROCESSING});if(e.length<this.MAX_PARALLEL_JOBS)for(var o=this.MAX_PARALLEL_JOBS-e.length,n=this.jobs.filter(function(e){return e.processing==t.states.WAIT}),i=0;i<n.length&&i<o;i++){var a=n[i];a.processing=t.states.PROCESSING,a.process()}},addJob:function(e){e.id=this.latestJobId++,e.processing=t.states.WAIT,e.ui&&(this.app.progressPane.addProgress(e),e.update=function(t){e.progress.update(e.title,.99*t.loaded,t.total)}),this.jobs.push(e),this.process()},finishJob:function(e,o){e.processing=t.states.FINISHED;var n=this.jobs.indexOf(e);-1!=n?this.jobs.splice(n,1):console.error("This wasn't supposed to happen, Unable to splice Q"),this.process(),e.ui&&(e.progress.update(e.title,100,100,o),setTimeout(function(){e.progress.destroy(),0==t.jobs.length&&t.app.progressPane.hide()},2e3))},cancelAll:function(){for(var e=this.jobs.length-1;e>=0;e--)this.jobs[e].cancel&&this.jobs[e].cancel()}};return t.init(e),t}}),define("DS/DocumentCommands/Resources",[],function(){"use strict";return{REPLACE_BY_REVISION:"/resources/v1/modeler/commondocuments/documentaction/replacebyrevision",LATEST_REVISION:"/resources/v1/dslc/getlastversions",NEW_REVISION:"/resources/lifecycle/revise/major"}}),define("DS/DocumentCommands/V2/Actions/Maturity",["UWA/Core","UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o){"use strict";var n=function(e){return{id:"Maturity",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"collaborative-lifecycle-management",fontIconFamily:1},tooltip:o.get("Maturity"),label:o.get("Maturity"),position:"far",category:"lifecycle",value:function(t){t.options=e,n.execute(t)},visibleFlag:!1},execute:function(){n.execute({options:e})},updateForSelection:function(o,n){return new t(function(t){o({visibleFlag:e.getSelectedNodes().length>0}),t(!0)})}}};return n.execute=function(t){var o=t.options.getSelectedNodes(),n={securitycontext:t.options.fetchSecurityContext(),context:{securitycontext:t.options.fetchSecurityContext(),getSecurityContext:function(){return{SecurityContext:this.securitycontext}},getUUID:function(){return t.options.getOrigin?JSON.stringify(e.extend(t.options.getOrigin(),{action:"maturity"})):"docv2.maturity."+Date.now()}}};require(["DS/LifecycleCmd/MaturityCmd"],function(e){new e(n).executeAsync(o.map(function(e){var o=t.options.getDocumentFromNodeModel(e),n=void 0;o.collabSpaceTitle?n=o.collabSpaceTitle:o.dataelements&&(n=o.dataelements.collabSpaceTitle);var i=void 0;return o.organizationTitle?i=o.organizationTitle:o.dataelements&&(i=o.dataelements.organizationTitle),{physicalid:o.id,organizationTitle:i,collabSpaceTitle:n,serviceurl:t.options.platformUrls["3DSpace"]+"/resources/lifecycle/maturity/"}})).then(function(e,n,i){o.forEach(function(e){t.options.events.publish({event:"docv2-maturity-complete",data:{nodeModel:e}})})})})},n}),define("DS/DocumentCommands/V2/Actions/Revisions",["UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t){"use strict";var o=function(n){return{id:"Revisions",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"flow-branch-list",fontIconFamily:1},label:t.get("Revisions"),tooltip:t.get("Revisions"),position:"far",category:"lifecycle",value:function(e){e.options=n,o.execute(e)},visibleFlag:!1},execute:function(){o.execute({options:n})},updateForSelection:function(t,o){return new e(function(e){t({visibleFlag:1==n.getSelectedNodes().length}),e(!0)})}}};return o.execute=function(e){require(["DS/LifecycleCmd/HistoryCmd"],function(t){var o=e.options.getSelectedNodes().map(function(e){var t=e;return t.options.physicalid&&0!=t.options.physicalid.length||(t.options.physicalid=t.options.data.id),t.getID||(t.getID=function(){return t.options.physicalid}),t});(t=new t({ID:"revisions_cmd_ID",context:{getSelectedNodes:()=>o}})).begin()})},o}),define("DS/DocumentCommands/TypeDerivativesCache",["UWA/Core","UWA/Promise","DS/WAFData/WAFData"],function(e,t,o){"use strict";return{csrfs:{},ready:{},types:{},platformUrls:void 0,setup:function(t){this.ready[t]=e.Promise.deferred(),this.ready[t].resolve(!0)},getTypeDerivatives:function(e,t,o){var n=this,i={};e.every(e=>null!=n.types[e])?(e.forEach(e=>{i[e]=n.types[e]}),t&&t(i)):n.fetchTypeDerivatives(e,t,o)},fetchTypeDerivatives:function(e,t,n){var i=this,a=n+"/resources/v1/modeler/documents/typeDerivatives";o.authenticatedRequest(a,{method:"post",type:"json",onComplete:function(e){if(e.success){var o={};e.data.forEach(e=>{i.types[e.type]=e.children.map(e=>e.type),i.types[e.type]=i.types[e.type].filter(function(e){return e}),0==i.types[e.type].length&&i.types[e.type].push(e.type),o[e.type]=i.types[e.type]}),t&&t(o)}},data:JSON.stringify({data:e.map(function(e){return{type:e}})}),headers:{"content-type":"application/json"}})}}}),define("DS/DocumentCommands/V2/Actions/Subscription/EditSubscriptionForOthers",["i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e){"use strict";var t=function(o){return{id:"EditSubscriptionForOthers",type:"PushItem",title:e.get("EditSubscriptionForOthers"),dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"subscription-others-pencil",fontIconFamily:1},label:e.get("EditSubscriptionForOthers"),tooltip:e.get("EditSubscriptionForOthers"),position:"far",category:"information",value:function(e){e.options=o,t.execute(e)},visibleFlag:!1},execute:function(){t.execute({options:o})},updateForSelection:function(e,t){e({visibleFlag:o.getSelectedNodes().length>=1})}}};return t.execute=function(e){require(["DS/ENOSubscriptionMgmt/Commands/ViewSubscriptions"],function(t){var o=e.options.getSelectedNodes().map(function(t){var o=e.options.getDocumentFromNodeModel(t);return{physicalid:o.id,type:o.type,getID:function(){return o.id},getType:function(){return o.type}}});new t({ID:"ViewSubscriptionsCmdHdr",context:{getSelectedNodes:()=>o},objIDType:"modelID"}).execute(e)})},t}),define("DS/DocumentCommands/V2/Actions/Subscription/EditSubscriptions",["i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e){"use strict";var t=function(o){return{id:"EditSubscriptions",type:"PushItem",title:e.get("EditSubscriptions"),dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"bell-pencil",fontIconFamily:1},label:e.get("EditSubscriptions"),tooltip:e.get("EditSubscriptions"),position:"far",category:"information",value:function(e){e.options=o,t.execute(e)},visibleFlag:!1},execute:function(){t.execute({options:o})},updateForSelection:function(e,t){e({visibleFlag:o.getSelectedNodes().length>=1})}}};return t.execute=function(e){require(["DS/ENOSubscriptionMgmt/Commands/EditSubscribe"],function(t){var o=e.options.getSelectedNodes().map(function(t){var o=e.options.getDocumentFromNodeModel(t);return{physicalid:o.id,type:o.type,getID:function(){return o.id},getType:function(){return o.type}}});new t({ID:"EditSubscriptionCmdHdr",context:{getSelectedNodes:()=>o},objIDType:"modelID"}).execute(e)})},t}),define("DS/DocumentCommands/V2/Actions/Subscription/Subscribe",["i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e){"use strict";var t=function(o){return{id:"Subscribe",type:"PushItem",title:e.get("Subscribe"),dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"bell-add",fontIconFamily:1},label:e.get("Subscribe"),tooltip:e.get("Subscribe"),position:"far",category:"information",value:function(e){e.options=o,t.execute(e)},visibleFlag:!1},execute:function(){t.execute({options:o})},updateForSelection:function(e,t){e({visibleFlag:o.getSelectedNodes().length>=1})}}};return t.execute=function(e){require(["DS/ENOSubscriptionMgmt/Commands/Subscribe"],function(t){var o=e.options.getSelectedNodes().map(function(t){var o=e.options.getDocumentFromNodeModel(t);return{physicalid:o.id,type:o.type,getID:function(){return o.id},getType:function(){return o.type}}});new t({ID:"SubscribeCmdHdr",context:{getSelectedNodes:()=>o},objIDType:"modelID"}).execute(e)})},t}),define("DS/DocumentCommands/V2/Actions/Preview",["UWA/Core","UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o){"use strict";var n=void 0,i=void 0,a=function(e){return{id:"Preview",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"eye",fontIconFamily:1},label:o.get("Preview"),tooltip:o.get("Preview"),position:"far",category:"view",value:function(t){t.options=e,a.execute(t)},visibleFlag:!1},execute:function(){a.execute({options:e})},updateForSelection:function(o,n){return new t(function(t){o({visibleFlag:1==e.getSelectedNodes().length}),t(!0)})}}};return a.execute=function(e){var t=e.options.getSelectedNodes()[0];if(!e.options.getDocumentFromNodeModel(t))throw"e6wDocument cannot be loaded from nodeModel";!function(t){require(["DS/DocumentMultiFilePreview/MultiFilePreviewComponent"],function(o){n&&(e.options.events.unsubscribe(n),n=void 0),n=e.options.events.subscribe({event:"docv2-preview-reload-viewer"},function(t){if(e.options.widget.multiFilePreviewComponent&&1==e.options.getSelectedNodes().length&&null!=t.nodeModel){var o=e.options.getSelectedNodes()[0],n=e.options.getDocumentFromNodeModel(o);e.options.getDocumentFromNodeModel(t.nodeModel).id==n.id&&
//! argumentList.options.widget.multiFilePreviewComponent.updateDocument(latestDocument, true);
e.options.widget.multiFilePreviewComponent.updateDocument(n,void 0)}}),i&&(e.options.events.unsubscribe(i),i=void 0),i=e.options.events.subscribe({event:"docv2-preview-reload-toolbar"},function(t){if(e.options.widget.multiFilePreviewComponent&&1==e.options.getSelectedNodes().length&&null!=t.nodeModel){var o=e.options.getSelectedNodes()[0],n=e.options.getDocumentFromNodeModel(o);e.options.getDocumentFromNodeModel(t.nodeModel).id==n.id&&e.options.widget.multiFilePreviewComponent.updateDocument(n,void 0)}}),e.options.widget.multiFilePreviewComponent?(e.options.widget.multiFilePreviewComponent.setOptions({platformUrls:e.options.platformUrls,modelEvents:e.options.events,tenant:e.options.platformUrls.platformId,securityContext:e.options.fetchSecurityContext(),documentManagedByPreview:!0,nodeModel:t,hideNextPrev:!0,enableFavoriteToggle:!1}),
//! argumentList.options.widget.multiFilePreviewComponent.updateDocument(argumentList.options.getDocumentFromNodeModel(nodeModel), true);
e.options.widget.multiFilePreviewComponent.updateDocument(e.options.getDocumentFromNodeModel(t),void 0)):(window.previewLoadStart=new Date,e.options.widget.multiFilePreviewComponent=new o({document:e.options.getDocumentFromNodeModel(t),platformUrls:e.options.platformUrls,modelEvents:e.options.events,tenant:e.options.platformUrls.platformId,securityContext:e.options.fetchSecurityContext(),nodeModel:t,documentManagedByPreview:!0,hideNextPrev:!0,enableFavoriteToggle:!1,uaSource:e.options.getSourceForUsageAnalytics()}),e.options.widget.multiFilePreviewComponent.loaded=function(e){},e.options.widget.multiFilePreviewComponent.elements.container.setStyles({background:"white",width:"100%",height:"100%"}),e.options.widget.multiFilePreviewComponent.close=function(){e.options.widget.multiFilePreviewComponent.destroy(),e.options.widget.multiFilePreviewComponent=void 0},e.options.widget.multiFilePreviewComponent.inject(e.options.widget.body))})}(t)},a}),define("DS/DocumentCommands/V2/ConvertCmdToWebUX",[],function(){"use strict";return function(e){return e.map(e=>{var t=void 0;UWA.is(e.dataElements.value,"function")&&(t={callback:e.dataElements.value||function(e,t,o){console.error("This command doesnt have value")}});var o=void 0;UWA.is(e.dataElements.value.menu,"array")&&(o=e.dataElements.value.menu);var n={rawItem:e,type:"PushItem",title:e.dataElements.label,fonticon:{content:"wux-ui-3ds wux-ui-3ds-"+e.dataElements.icon.iconName},action:t,submenu:o,recId:e.id,category:e.dataElements.category};return"FileIterations"==e.id&&(delete n.fonticon,n.icon=e.dataElements.icon),n})}}),define("DS/DocumentCommands/V2/Actions/Compare",["UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t){"use strict";var o=function(n){return{id:"Compare",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"part-compare",fontIconFamily:1},label:t.get("Compare"),tooltip:t.get("Compare"),position:"far",category:"lifecycle",value:function(e){e.options=n,o.execute(e)},visibleFlag:!1},execute:function(){o.execute({options:n})},updateForSelection:function(t,o){return new e(function(e){t({visibleFlag:n.getSelectedNodes().length>=1}),e(!0)})}}};return o.execute=function(e){require(["DS/CompareCmd/CompareCmd"],function(t){var o=e.options.platformUrls.platformId,n=e.options.getSelectedNodes().map(function(t){return{contextId:e.options.fetchSecurityContext(),id:t.options.data.id,objIDType:"modelID",objTenant:o}});(t=new t({ID:"CompareHdr"})).launchCompare(o,n,void 0,void 0)})},o}),define("DS/DocumentCommands/V2/Actions/CopyLink",["UWA/Core","UWA/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Dropdown","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o,n,i,a,s){"use strict";var l=function(e){return{id:"CopyLink",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"link",fontIconFamily:1},tooltip:s.get("CopyLink"),label:s.get("CopyLink"),position:"far",category:"colllaboration",value:function(t){t.options=e,l.execute(t)},visibleFlag:!1},execute:function(){l.execute({options:e})},updateForSelection:function(o,n){return new t(function(t){o({visibleFlag:1==e.getSelectedNodes().length}),t(!0)})}}};return l.execute=function(t){var a=t.options.getSelectedNodes()[0],l=t.options.getDocumentFromNodeModel(a),c=t.options.container,r=void 0;l&&null==(r=l.title||l.name)&&l.dataelements&&(r=l.dataelements.title||l.dataelements.name);var d={objectId:l.id,envId:t.options.platformUrls.platformId};e.is(t.options.getSelectedFile,"function")&&null!=t.options.getSelectedFile()&&(d.fileid=t.options.getSelectedFile().id,r=t.options.getSelectedFile().dataelements.title);var u=function(e){var t={protocol:"3DXContent",data:{items:[]}};t.data.items.push({envId:e.envId,objectId:e.objectId,openLink:!0,objectType:"Document"}),e.fileid&&(t.data.items[0].fileid=e.fileid,t.data.items[0].openFile=!0);return t}(d),m=e.createElement("div",{styles:{display:"flex"}}),p=new n("input",{attributes:{readonly:"readonly"}});p.getContent().setStyles({display:"inline-block","border-top-right-radius":0,"border-bottom-right-radius":0}),p.inject(m);var f=new o({value:s.get("CopyLink"),className:"block",events:{onClick:function(o){p.setFocus(),p.elements.input.select(),p.elements.input.setSelectionRange(0,99999),document.execCommand("cut"),g.hide(),r&&""!==r?t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:s.get("LinkCopiedTitle"),subtitle:e.String.format(s.get("LinkCopiedMsg"),r),message:"",sticky:!1,allowUnsafeHTML:!1}}):t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:s.get("LinkCopiedTitle"),subtitle:s.get("LinkCopied"),message:"",sticky:!1,allowUnsafeHTML:!1}})}}});f.getContent().setStyles({display:"inline-block","border-top-left-radius":0,"border-bottom-left-radius":0,padding:"0 10px"}),f.inject(m);var g=new i({body:m,closeOnClick:!1,events:{onClickOutside:function(e){console.log("DDClickOutside")}}});g.options.target=c;var v=t.options.widget.widgetDomain;if(null==v&&(v=t.options.platformUrls["3DDashboard"]),console.log(v),null==v)throw"url is undefined.";g.hide(),g.show(),p.setFocus(),p.setValue(v+"#app:ENXWDOC_AP/content:X3DContentId="+encodeURIComponent(JSON.stringify(u))),p.elements.input.select(),p.elements.input.setSelectionRange(0,99999,"backward"),f.getContent().click()},l}),define("DS/DocumentCommands/V2/FileActions/Download",["UWA/Core","UWA/Element","UWA/Promise","DS/DocumentManagement/DocumentManagement","DS/DocumentCommonInfra/TrackerAPI","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o,n,i,a){"use strict";var s=e.createElement("iframe",{name:"multidocdownloaderFrame",styles:{display:"none"}}),l=e.createElement("form",{method:"POST",enctype:"application/x-www-form-urlencoded",target:"multidocdownloaderFrame",html:[{tag:"input",value:"true",name:"attachment"}],styles:{display:"none"}}),c=function(e){return{id:"Download",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"download",fontIconFamily:1},label:a.get("Download"),tooltip:a.get("Download"),position:"far",category:"information",value:function(t){t.options=e,c.execute(t)},visibleFlag:!1},execute:function(){c.execute({options:e})},updateForSelection:function(t,n){return new o(function(o){t({visibleFlag:e.getSelectedNodes().length>0}),o(!0)})}}};return c.execute=function(t){var o=t.options.getParentDocument();if(1==t.options.getSelectedNodes().length){var c=new Date,r=t.options.getSelectedNodes()[0],d=t.options.getDocumentFromNodeModel(r),u=void 0;d&&null==(u=d.title||d.name)&&d.dataelements&&(u=d.dataelements.title||d.dataelements.name);e.is(t.options.getSelectedFile,"function")&&null!=t.options.getSelectedFile()&&(t.options.getSelectedFile().id,u=t.options.getSelectedFile().dataelements.title),(m={asZip:!0,autoDownload:!0}).tenant=t.options.platformUrls.platformId,m.securityContext=t.options.fetchSecurityContext(),m.tenantUrl=t.options.platformUrls["3DSpace"],m.onComplete=function(n){var s=new Date-c;if(i.sendTrackerPageEvent({category:"docm.command.file.download",action:"click",label:"File Download",pd:{docId:o,source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:s,success:1,numberOfFiles:1,fileid:d.id}}),u&&""!==u){var l={subtitle:e.String.format(a.DOWNLOAD_FILES_INITIATED,u)};t.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:l.title||"",subtitle:l.subtitle||"",message:"",sticky:!1,allowUnsafeHTML:!1}})}else t.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:a.Download_Initiated,subtitle:"",message:"",sticky:!1,allowUnsafeHTML:!1}})},m.onFailure=function(e){var n=new Date-c;i.sendTrackerPageEvent({category:"docm.command.file.download",action:"click",label:"File Download",pd:{docId:o,source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:n,failure:0,numberOfFiles:1,fileId:d.id}}),t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:e.data[0].updateMessage,subtitle:"",message:"",sticky:!1,allowUnsafeHTML:!1}})},t.options.widget&&t.options.widget.MSFDocumentClient&&null===n.MSFDocumentClient?n.MSFDocumentClient=t.options.widget.MSFDocumentClient:t.options.MSFDocumentClient&&null===n.MSFDocumentClient&&(n.MSFDocumentClient=t.options.MSFDocumentClient),n.downloadDocument(o,d.id,!1,m)}else if(t.options.getSelectedNodes().length>1){var m,p=new Date,f=(t.options.getSelectedNodes().map(function(e){return t.options.getDocumentFromNodeModel(e)}),t.options.getSelectedNodes().map(function(e){return t.options.getDocumentFromNodeModel(e).id}));(m={asZip:!0,autoDownload:!0}).tenant=t.options.platformUrls.platformId,m.securityContext=t.options.fetchSecurityContext(),m.additionalURLParams="isFilesFacet=true",m.tenantUrl=t.options.platformUrls["3DSpace"],m.onComplete=function(n){var c=new Date-p;i.sendTrackerPageEvent({category:"docm.command.mulitpleFile.download",action:"click",label:"Multiple File Download",pd:{docId:o,source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:c,success:1,fileIds:f,numOfFiles:n[0].fileNames.length}});var r=n;e.is(r,"array")&&r.forEach(function(o){if(o.downloadUrl){var n=new URL(o.downloadUrl),i=(s.isInjected()||s.inject(document.body),l.isInjected()||l.inject(document.body),l.empty(),e.createElement("input",{name:"attachment",value:"true"}).inject(l),l);for(var c of n.searchParams)e.createElement("input",{name:c[0],value:c[1]}).inject(i);n.search="",i.action=n.href,console.log(n),i.submit(),t.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:a.get("DownloadHasStarted"),subtitle:"",message:a.get("DownloadHasStarted"),sticky:!1,allowUnsafeHTML:!1}})}else t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("DownloadNotInitiated"),subtitle:"",message:"",sticky:!1,allowUnsafeHTML:!1}})})},m.onFailure=function(e){var n=new Date-p;i.sendTrackerPageEvent({category:"docm.command.mulitpleFile.download",action:"click",label:"Multiple File Download",pd:{docId:o,source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:n,failure:0}}),t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:a.get("DownloadFailed"),subtitle:e[0].errorMessage,message:"",sticky:!1,allowUnsafeHTML:!1}})},t.options.widget&&t.options.widget.MSFDocumentClient&&null===n.MSFDocumentClient?n.MSFDocumentClient=t.options.widget.MSFDocumentClient:t.options.MSFDocumentClient&&null===n.MSFDocumentClient&&(n.MSFDocumentClient=t.options.MSFDocumentClient),m.documentIdForMSF=o,n.downloadDocuments(f,m)}},c}),define("DS/DocumentCommands/Constants",[],function(){"use strict";return{PREVIEW:"Preview",PREVIEW2:"Preview2",REPLACE_BY_REVISION:"ReplaceBy",DOWNLOAD:"Download",NEW_REVISION:"NEW REVISION",DELETE:"Delete",COPY_LINK:"CopyLink",RELATION:"Relation",REMOVE:"Remove",MATURITY:"Maturity",UPDATE:"Update",UPLOAD_FILE:"UploadFile",UPDATE_AND_UNLOCK:"UpdateAndUnlock",UNLOCK:"Unlock",LOCK:"Lock",LOCK_AND_DOWNLOAD:"LockAndDownload",EDIT:"Edit",UNDO_EDIT:"UndoEdit",COPY:"Copy",PASTE:"Paste",SHARE:"Share",PROPERTIES:"Properties",OFFICE_WEB_EDITION:"OfficeWebEdition"}}),define("DS/DocumentCommands/V2/Actions/Duplicate",["UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t){"use strict";var o=function(n){return{id:"Duplicate",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"duplicate",fontIconFamily:1},label:t.get("Duplicate"),tooltip:t.get("Duplicate"),position:"far",category:"lifecycle",value:function(e){e.options=n,o.execute(e)},visibleFlag:!1},execute:function(){o.execute({options:n})},updateForSelection:function(t,o){return new e(function(e){t({visibleFlag:n.getSelectedNodes().length>=1}),e(!0)})}}};return o.execute=function(e){require(["DS/LifecycleCmd/DuplicateCmd"],function(t){var o=e.options.getSelectedNodes().map(function(t){var o=e.options.getDocumentFromNodeModel(t),n=void 0;o&&null==(n=o.title||o.name)&&o.dataelements&&(n=o.dataelements.title||o.dataelements.name);var i=void 0;return o.revision?i=o.revision:o.dataelements&&(i=o.dataelements.revision),{physicalid:o.id,displayName:n,revision:i,icon:o.dataelements.indexedTypeicon||o.dataelements.typeicon,type:o.type,typeDisplayName:o.dataelements.typeNLS,current:o.dataelements.state,currentDisplayName:o.dataelements.stateNLS,getID:function(){return o.id},getLabel:function(){return n},getType:function(){return o.type},getAttribute:function(e){return e.contains("revision")?i:e.contains("type")?o.type:e.contains("status")?o.dataelements.stateNLS:void 0}}});(t=new t({ID:"duplicate_cmd_id",context:{getSelectedNodes:()=>o,securitycontext:e.options.fetchSecurityContext(),getSecurityContext:function(){return{SecurityContext:this.securitycontext}},getUUID:function(){return e.options.getOrigin?JSON.stringify(UWA.extend(e.options.getOrigin(),{action:"duplicate"})):"docv2.duplicate."+Date.now()}}})).begin()})},o}),define("DS/DocumentCommands/V2/Actions/AddTo/Libraries",["i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e){"use strict";var t=function(o){return{id:"Libraries",type:"PushItem",title:e.get("Libraries"),dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"library-add",fontIconFamily:1},label:e.get("Libraries"),tooltip:e.get("Libraries"),position:"far",category:"edit",value:function(e){e.options=o,t.execute(e)},visibleFlag:!1},execute:function(){t.execute({options:o})},updateForSelection:function(e,t){e({visibleFlag:o.getSelectedNodes().length>=1})}}};return t.execute=function(e){require(["DS/LibraryActive/commands/ActionBar_MultipleClassificationCmd"],function(t){var o=e.options.getSelectedNodes().map(function(t){return e.options.getDocumentFromNodeModel(t).id});(new t).execute({id:"Classfy_cmd_id",securityContext:e.options.fetchSecurityContext(),tenantId:e.options.platformUrls.platformId,objects:o},{launchMode:"Classify",selectionMode:"DefaultSingle",ComponentTitle:"Libraries",OKButtonLabel:"Add"})})},t}),define("DS/DocumentCommands/V2/Actions/Delete",["UWA/Core","UWA/Promise","DS/UIKIT/Modal","DS/DocumentManagement/DocumentManagement","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o,n,i){"use strict";var a=function(e){return{id:"Delete",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"trash",fontIconFamily:1},label:i.get("Delete"),tooltip:i.get("Delete"),position:"far",category:"destructive",value:function(t){t.options=e,a.execute(t)},visibleFlag:!1},execute:function(){a.execute({options:e})},updateForSelection:function(o,n){return new t(function(t){o({visibleFlag:e.getSelectedNodes().length>0}),t(!0)})}}};return a.execute=function(t){if(t.options.getSelectedNodes().length>0){var o=t.options.getSelectedNodes();require(["DS/LifecycleCmd/DeleteCmd"],function(n){new n({securitycontext:t.options.fetchSecurityContext(),context:{securitycontext:t.options.fetchSecurityContext(),getSecurityContext:function(){return{SecurityContext:this.securitycontext}},displayNotification:function(n){if("primary"==n.eventID)if(1==o.length){var a=t.options.getSelectedNodes()[0],s=t.options.getDocumentFromNodeModel(a),l=void 0;s&&null==(l=s.title||s.name)&&s.dataelements&&(l=s.dataelements.title||s.dataelements.name),t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:i.get("DeletionSuccessful"),subtitle:e.String.format(i.get("DeletionSuccessfulMsg"),l),message:"",sticky:!1,allowUnsafeHTML:!1}})}else o.length>1&&t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:i.get("DeletionSuccessful"),subtitle:i.get("MultipleDeletionSuccessfulMsg",{count:o.length}),message:"",sticky:!1,allowUnsafeHTML:!1}})},getUUID:function(){return t.options.getOrigin?JSON.stringify(e.extend(t.options.getOrigin(),{action:"delete"})):"docv2.delete."+Date.now()}}}).execute(o.map(function(e){var o=t.options.getDocumentFromNodeModel(e),n=void 0;o&&null==(n=o.title||o.name)&&o.dataelements&&(n=o.dataelements.title||o.dataelements.name);var i=void 0;return o.revision?i=o.revision:o.dataelements&&(i=o.dataelements.revision),{physicalid:o.id,displayName:n,revision:i,icon:o.dataelements.indexedTypeicon||o.dataelements.typeicon,type:o.type,typeDisplayName:o.dataelements.typeNLS,current:o.dataelements.state,currentDisplayName:o.dataelements.stateNLS}}))})}},a}),define("DS/DocumentCommands/ENOXDocumentCommands",["UWA/Core","UWA/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Modal","DS/UIKIT/Form","DS/UIKIT/Input/File","UWA/Utils/InterCom","DS/CoreEvents/ModelEvents","DS/UIKIT/DropdownMenu","DS/UIKIT/Dropdown","DS/WAFData/WAFData","DS/LifecycleCmd/MaturityCmd","DS/ENOXVersionExplorerController/VersionExplorerController","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerViews/VersionExplorerModal","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/DocumentManagement/DocumentManagement","DS/DocumentCommands/Resources","DS/DocumentCommands/Constants","DS/DocumentCommands/TypeDerivativesCache","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/DocumentCommands/DOCMClipboard","DS/Controls/Loader","DS/Controls/ModalContainer","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o,n,i,a,s,l,c,r,d,u,m,p,f,g,v,D,h,S,y,b,C,w,F,U,I,E){"use strict";var P={},x={},A=function(e){this._name="ENOXDocCommands",x=e||window.widget};function N(){this._myVersionExplorer.unsubscribeAll()}function k(e,t,o,n,i,a,s){var l={level:e,title:t,subtitle:o,message:n,sticky:i,allowUnsafeHTML:s||!1};window.notifs||(window.notifs=D,h.setNotificationManager(window.notifs)),a?h.inject(a):h.elements.container.isInjected()||h.inject(),window.notifs.addNotif(l)}function T(t){var o={protocol:"3DXContent",version:"2.0",source:e.is(x.data.appId)?x.data.appId:x.environment.data._data._x_appId,widgetId:x.id,data:{items:[]}};return o.data.items.push({envId:t.document.envId,serviceId:t.document.serviceId||"3DSpace",contextId:t.document.contextId,objectId:t.document.id}),o}function M(a,s,c){var r=a.options.document.index||1,D={};D.index=r;var h={title:E.get("Preview"),name:"Preview",text:E.get("Preview"),fonticon:"eye",handler:function(){var e=T(a.options);require(["DS/ENOFloatingPanel/ENOFloatingPanel","DS/DocumentPreview/PreviewComponent"],function(t,o){var n=new o({x3dcontent:e,options:a.options});n.loaded=function(e){},n.elements.container.setStyles({background:"white",width:"100%",height:"100%"}),n.close=function(){i.destroy()};var i=new t({header:n.topBar.container,body:n.elements.container,overlay:!0,closable:!1,resizable:!0,animate:!0,visible:!0,limitParent:!0,autocenter:!0});i.inject(x.body),n.topBar.container.getParent().setStyle("padding","5px"),n.elements.container.getParent().setStyle("padding","5px"),i._maximize()})}},C={title:E.get("Preview"),name:"Preview2",text:E.get("Preview"),fonticon:"eye",handler:function(){function o(e,t){require(["DS/DocumentMultiFilePreview/MultiFilePreviewComponent"],function(o){x.multiFilePreviewComponent?(x.multiFilePreviewComponent.setOptions({platformUrls:s,modelEvents:P.modelEvents,tenant:a.options.document.envId,securityContext:a.options.document.contextId,nodeModel:void 0,hideNextPrev:!0,enableFavoriteToggle:!1,documentManagedByPreview:t}),x.multiFilePreviewComponent.updateDocument(e,void 0)):(x.multiFilePreviewComponent=new o({document:e,platformUrls:s,modelEvents:P.modelEvents,tenant:a.options.document.envId,securityContext:a.options.document.contextId,nodeModel:void 0,hideNextPrev:!0,enableFavoriteToggle:!1,documentManagedByPreview:t}),x.multiFilePreviewComponent.loaded=function(e){},x.multiFilePreviewComponent.elements.container.setStyles({background:"white",width:"100%",height:"100%"}),x.multiFilePreviewComponent.close=function(){x.multiFilePreviewComponent.destroy(),x.multiFilePreviewComponent=void 0},x.multiFilePreviewComponent.inject(x.body))})}if(a.options.document.data)o(a.options.document.data,!1);else{var n=new U({text:E.get("LOADINGPREVIEW"),showButtonFlag:!0});n.canceller=t.deferred(),n.elements.stopButton.addEventListener("buttonclick",function(e){n.canceller.reject("usercancelled")}),I.createModal(x.body,n.elements.container),n.on(E.get("LOADINGPREVIEW"));var i=new e.Promise(function(e,t){S.getDocuments([a.options.document.id],{tenant:a.options.document.envId,securityContext:a.options.document.contextId,tenantUrl:a.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedTypeicon",onComplete:function(o){o.success&&Array.isArray(o.data)?e(o.data[0]):t({error:"BAD_RESPONSE"})},onFailure:function(e){t({error:"GETDOCUMENT_FAILED",reason:e})}})}),l=n.canceller.promise;e.Promise.race([i,l]).then(function(e){n.on(E.get("LOADINGPREVIEW")),I.removeModal(x.body),o(e,!0)},function(e){"usercancelled"!=e&&(e.reason?k("error",E.get("CannotPreviewDocument"),E.get("CannotAccessDocument"),e.reason.error,!1):k("error",E.get("CannotPreviewDocument"),E.get("CannotAccessDocument"),"",!1)),I.removeModal(x.body)})}}},A={title:E.get("Download"),name:"Download",text:E.get("Download"),fonticon:"download",handler:function(){var t=void 0;a.options.document.data&&null==(t=a.options.document.data.title||a.options.document.data.name)&&a.options.document.data.dataelements&&(t=a.options.document.data.dataelements.title||a.options.document.data.dataelements.name);var o={asZip:!0,autoDownload:!0};o.tenant=a.options.document.envId,o.securityContext=a.options.document.contextId,o.tenantUrl=a.options.platformUrls["3DSpace"],o.onComplete=function(o){if(t&&""!==t){var n={subtitle:e.String.format(E.DOWNLOAD_FILES_INITIATED,t)};k("info",n.title||"",n.subtitle||"","",!1)}else k("info",E.Download_Initiated,"",!1)},o.onFailure=function(e){k("error",e.data[0].updateMessage,"","",!1)},x.MSFDocumentClient&&null===S.MSFDocumentClient&&(S.MSFDocumentClient=x.MSFDocumentClient),S.downloadDocument(a.options.document.id,a.options.document.fileid,!1,o)}},M={title:E.get("Edit"),name:"Edit",text:E.get("Edit"),fonticon:"pencil",handler:function(){var t=void 0;if(a.options.document.data&&null==(t=a.options.document.data.title||a.options.document.data.name)&&a.options.document.data.dataelements&&(t=a.options.document.data.dataelements.title||a.options.document.data.dataelements.name),1==a.options.document.data.files.length){var o={asZip:!0,autoDownload:!0};o.tenant=a.options.document.envId,o.securityContext=a.options.document.contextId,o.tenantUrl=a.options.platformUrls["3DSpace"],o.onComplete=function(o){if(t&&""!==t){var n={title:E.get("Download_Initiated"),subtitle:e.String.format(E.get("Filedownloadstartedforedit"),t)};k("info",n.title||"",n.subtitle||"","",!1)}else k("info",E.get("checkout_initiated"),"",!1);a.options.onComplete&&S.getDocuments([a.options.document.id],{tenant:a.options.document.envId,securityContext:a.options.document.contextId,tenantUrl:a.options.platformUrls["3DSpace"],onComplete:function(e){if(e.success){if(!Array.isArray(e.data))return;a.options.onComplete({action:"Edit",data:e.data})}}})},o.onFailure=function(e){var t="Document";a.options.document&&a.options.document.data&&a.options.document.data.dataelements?t=a.options.document.data.dataelements.typeNLS||a.options.document.data.dataelements.type:a.options.document.type&&(t=a.options.document.type),e&&e.data&&e.data.length>0&&e.data[0].updateMessage?k("error",E.get("YouCannotEditX",{typeNLS:t}),E.get("VerifyCredentials"),E.get("NotHaveRequiredAccessRole")):k("error",E.get("YouCannotEditX",{typeNLS:t}),e),console.error("Document Edit Failed Due to:",e)},x.MSFDocumentClient&&null===S.MSFDocumentClient&&(S.MSFDocumentClient=x.MSFDocumentClient),S.downloadDocument(a.options.document.id,a.options.document.fileid,!0,o)}else 0==a.options.document.data.files.length?k("error","",E.get("objectcontainsnofile"),"",!1):k("error","",E.get("Nomultifilesupport"),"",!1)}},L={title:E.get("Copy"),name:"Copy",text:E.get("Copy"),fonticon:"copy",handler:function(){var e=T(a.options);F.copy(e),a.options.onComplete({action:"Copy"})}},O={title:E.get("Paste"),name:"Paste",text:E.get("Paste"),fonticon:"paste",handler:function(){F.paste(a.options.onComplete)}},R={title:E.get("Relations"),name:"Relations",text:E.get("Relations"),fonticon:"object-related",handler:function(){var e=T(a.options);e.appId="ENORIPE_AP";var t=new l.Socket("compassPageSocket");t.subscribeServer("com.ds.compass",window.parent),t.dispatchEvent("onSetX3DContent",e,"compassPageSocket"),t.addListener("launchApp",function(e,o,n){t.unsubscribeServer("com.ds.compass"),t.disconnect()}),t.dispatchEvent("onLaunchApp",e,"compassPageSocket")}},V={title:E.get("CopyLink"),name:"CopyLink",text:E.get("CopyLink"),fonticon:"link",handler:function(){var t=void 0;a.options.document.data&&null==(t=a.options.document.data.title||a.options.document.data.name)&&a.options.document.data.dataelements&&(t=a.options.document.data.dataelements.title||a.options.document.data.dataelements.name);var i,l,c=(i=a.options,(l={protocol:"3DXContent",data:{items:[]}}).data.items.push({envId:i.document.envId,objectId:i.document.id,openLink:!0}),i.document.fileid&&(l.data.items[0].fileid=i.document.fileid,l.data.items[0].openFile=!0),l),r=e.createElement("div",{styles:{display:"flex"}}),u=new n("input",{attributes:{readonly:"readonly"}});u.getContent().setStyles({display:"inline-block","border-top-right-radius":0,"border-bottom-right-radius":0}),u.inject(r);var m=new o({value:E.get("CopyLink"),className:"block",events:{onClick:function(o){u.setFocus(),u.elements.input.select(),u.elements.input.setSelectionRange(0,99999),document.execCommand("cut"),p.hide(),k("success",E.get("LinkCopiedTitle"),t&&""!==t?e.String.format(E.get("LinkCopiedMsg"),t):E.get("LinkCopied"),"",!1,a.options.notificationTarget)}}});m.getContent().setStyles({display:"inline-block","border-top-left-radius":0,"border-bottom-left-radius":0,padding:"0 10px"}),m.inject(r);var p=new d({body:r,closeOnClick:!1,events:{onClickOutside:function(e){console.log("DDClickOutside")}}});p.options.target=this.options.target;var f=x.widgetDomain;null==f&&(f=s["3DDashboard"]),console.log(f),null==f?w.getPlatformServices({platformId:a.options.document.envId,onComplete:function(e){p.hide(),p.show(),u.setFocus(),u.setValue(e["3DDashboard"]+"#app:ENXWDOC_AP/content:X3DContentId="+encodeURIComponent(JSON.stringify(c))),u.elements.input.select(),u.elements.input.setSelectionRange(0,99999,"backward"),m.getContent().click()}}):(p.hide(),p.show(),u.setFocus(),u.setValue(f+"#app:ENXWDOC_AP/content:X3DContentId="+encodeURIComponent(JSON.stringify(c))),u.elements.input.select(),u.elements.input.setSelectionRange(0,99999,"backward"),m.getContent().click())}},W={title:E.get("ReplaceBy"),name:"ReplaceBy",text:E.get("ReplaceBy"),fonticon:"replace-by-revision",items:[{text:E.get("ReplacebyRevision"),title:E.get("ReplacebyRevision"),name:"ReplacebyRevision",fonticon:"replace-by-revision",handler:function(){this.platformUrls=a.options.platformUrls,this.securityContext=a.options.document.contextId,this.parentId=a.options.document.data.parentId,this.relName=a.options.document.data.relName,this.oldDocumentId=a.options.document.id,this.parentDirection=a.options.document.data.parentDirection,this.tenant=a.options.document.envId,this.tenantUrl=a.options.platformUrls["3DSpace"];var t=this;this.that=a;var o=e.createElement("div",{class:"revisionUpdate-dialog"}).inject(document.body);this._myVersionExplorer=new p({versionGraphContainer:null,selectionMode:g.SELECTION_MODES.SINGLE_SELECT_ONLY,widget:x}),this._myVersionExplorer.disableDrag(),this._myVersionExplorer.showDialog({x:100,y:100},o,!0),f.loadUserSettingsPromise({displayMode:g.DISPLAY_MODES.SUBWAY_VIEW,displayLegend:!0},!0),this._myVersionExplorer.publishEvent("ENOXVersionExplorerLoadVersionModel",{id:this.oldDocumentId,tenantId:a.options.document.envId,securityContext:this.securityContext,onComplete:function(){},dataModelType:g.DATA_MODEL_TYPES.MODEL_HISTORY}),this._myVersionExplorer.subscribeEvent("ENOXVersionExplorerModalOK",function(){var t=this.that,o=this;this._myVersionExplorer.unsubscribeAll();var n=this._myVersionExplorer.getSelectedNodes().shift(),i=n.getAttribute("id");if(i===o.oldDocumentId){console.log("selected revison and current revison is same.");var a={result:{message:E.SameRevision},action:"ReplacebyRevision",targetDocumentId:i};t.options.onComplete(a)}else if(""!==i&&null!=i){null==o.relName&&(o.relName="Reference Document");var s={onComplete:function(e){(e=e||{}).message=E.ReplacedRevision+" "+n.options.data.revision;var o={result:e,action:"ReplacebyRevision",targetDocumentId:i};t.options.onComplete(o)},onFailure:function(e,t){k("error","",t.error,"",!1)}};u.authenticatedRequest(o.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",e.extend({},{method:"GET",url_temp:o.platformUrls["3DSpace"],onComplete:function(n){s.onComplete,s.onFailure;var a=o.platformUrls["3DSpace"]+"/resources/v1/modeler/documents/?parentRelName="+o.relName+"&parentDirection="+o.parentDirection+"&tenant="+o.platformUrls.platformId;s.type="json",s.url=encodeURI(a);var l=JSON.parse(n).csrf;s.data=JSON.stringify({csrf:l,data:[{id:o.oldDocumentId,updateAction:"NONE",relateddata:{parents:[{id:o.parentId,updateAction:"DELETE"}]}},{id:i,updateAction:"NONE",relateddata:{parents:[{id:o.parentId,updateAction:"CREATE"}]}}]}),s.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:o.securityContext},s.method="PUT",s.SecurityContext=o.securityContext,s.headers=e.merge(s.headers,e.is(t.options.getWorkUnderHeaders,"function")?t.options.getWorkUnderHeaders():{}),u.authenticatedRequest(s.url,s)}}))}}.bind(this)),this._myVersionExplorer.subscribeEvent("ENOXVersionExplorerModalCancel",N.bind(this)),this._dlgVersionExplorer=v._dlg,v._dlg&&v._dlg.rightButtons&&v._dlg.rightButtons.addEventListener("click",N.bind(this)),this._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!0,this._myVersionExplorer.subscribeEvent("select",function(e){t._dlgVersionExplorer.isVisible&&(t._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!1)}),this._myVersionExplorer.subscribeEvent("unselect",function(e){t._dlgVersionExplorer.isVisible&&(t._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!0)})}},{text:E.get("ReplacebyLatestRevision"),title:E.get("ReplacebyLatestRevision"),name:"ReplacebyLatestRevision",fonticon:"replace-by-latest-version",handler:function(){var t=a.options.platformUrls,o=a.options.document.contextId,n=a.options.document.data.parentId,i=a.options.document.data.relName,s=a.options.document.id,l=a.options.document.data.parentDirection,c={};c.data=JSON.stringify({lastVersionRequests:[{id:s}]}),c.onComplete=function(c){if((c=JSON.parse(c)).lastVersionRequests[0].islast){console.log("Existing document is in latest revision.");var r={result:c={message:E.WarningLatestRevision},action:"ReplacebyLatestRevision",targetDocumentId:s};a.options.onComplete(r)}else{var d=c.lastVersionRequests[0].candidates[0],m={onComplete:function(e){(e={}).message=E.get("ReplacedByLatest");var t={result:e,action:"ReplacebyLatestRevision",targetDocumentId:d};a.options.onComplete(t)},onFailure:function(e,t){k("error","",t.error,"",!1)}};u.authenticatedRequest(t["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",e.extend({},{method:"GET",url_temp:t["3DSpace"],onComplete:function(c){m.onComplete,m.onFailure;var r=t["3DSpace"]+"/resources/v1/modeler/documents/?parentRelName="+i+"&parentDirection="+l+"&tenant=OnPremise";m.type="json",m.url=encodeURI(r);var p=JSON.parse(c).csrf;m.data=JSON.stringify({csrf:p,data:[{id:s,updateAction:"NONE",relateddata:{parents:[{id:n,updateAction:"DELETE"}]}},{id:d,updateAction:"NONE",relateddata:{parents:[{id:n,updateAction:"CREATE"}]}}]}),m.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:o},m.headers=e.merge(m.headers,e.is(a.options.getWorkUnderHeaders,"function")?a.options.getWorkUnderHeaders():{}),m.method="PUT",m.SecurityContext=o,u.authenticatedRequest(m.url,m)}}))}},c.onFailure=function(e){console.log("Get Latest version failed."+e),k("error",e.data[0].updateMessage,"","",!1)},c.method="POST",c.headers={Accept:"application/json","Content-Type":"application/json",securitycontext:o},c.proxy="passport",c.url=t["3DSpace"]+y.LATEST_REVISION,u.authenticatedRequest(c.url,c)}}]},_={title:E.get("Remove"),name:"Remove",text:E.get("Remove"),fonticon:"remove",handler:function(){var e={relInfo:{parentId:a.options.document.data.parentId,parentRelName:a.options.document.data.relName,parentDirection:a.options.document.data.parentDirection},tenant:a.options.document.envId,securityContext:a.options.document.contextId,tenantUrl:a.options.platformUrls["3DSpace"],onFailure:function(e){(e=JSON.parse(e)).message=E.DocumentDisconnectFailed;b.REMOVE,a.options.document.id},onComplete:function(e){console.log("Disconnect document completed.");var t={result:{message:E.DocumentDisconnect},action:b.REMOVE,targetDocumentId:a.options.document.id};a.options.onComplete(t)}};S.disconnectDocumentFromParent(a.options.document.id,e)}},j={title:E.get("NewRevision"),name:"New Revision",text:E.get("NewRevision"),fonticon:"flow-line-add",handler:function(){var t=void 0;a.options.document.data&&null==(t=a.options.document.data.title||a.options.document.data.name)&&a.options.document.data.dataelements&&(t=a.options.document.data.dataelements.title||a.options.document.data.dataelements.name);var o=a.options.platformUrls,n=a.options.document.contextId,i=(a.options.document.data.parentId,a.options.document.data.relName,a.options.document.id),s=a.options.document.envId,l=(a.options.document.data.parentDirection,{});l.data=JSON.stringify({data:[{physicalid:i,folderid:null}]}),l.onComplete=function(i){"success"==(i=JSON.parse(i)).status?(k("success","",e.String.format(E.get("NewRevisionSuccessfulMsg"),t),"",!1),a.options.onComplete&&S.getDocuments([i.results[0].physicalid],{tenant:s,securityContext:n,tenantUrl:o["3DSpace"],onComplete:function(e){if(e.success){if(!Array.isArray(e.data))return;a.options.onComplete({action:"New Revision",data:e.data})}}})):"failure"==i.status&&(console.log(i.status+" : "+i.report[0].error),k("error","",i.report[0].error,"",!1))},l.onFailure=function(e){console.log("Get Latest version failed."+e),k("error",e.data[0].updateMessage,"","",!1)},l.method="POST",l.headers={Accept:"application/json","Content-Type":"application/json",securitycontext:n},l.headers=e.merge(l.headers,e.is(a.options.getWorkUnderHeaders,"function")?a.options.getWorkUnderHeaders():{}),l.proxy="passport",l.url=o["3DSpace"]+y.NEW_REVISION+"?tenant="+s,u.authenticatedRequest(l.url,l)}},H={title:E.get("UndoEdit"),name:b.UNDO_EDIT,text:E.get("UndoEdit"),fonticon:"undo",handler:function(){var t=void 0;a.options.document.data&&null==(t=a.options.document.data.title||a.options.document.data.name)&&a.options.document.data.dataelements&&(t=a.options.document.data.dataelements.title||a.options.document.data.dataelements.name),1==a.options.document.data.files.length?u.authenticatedRequest(s["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",url_temp:s["3DSpace"],onComplete:function(o){var n={};n.tenant=a.options.document.envId,n.securityContext=a.options.document.contextId,n.tenantUrl=a.options.platformUrls["3DSpace"],n.onComplete=function(o){k("success","",e.String.format(E.get("Editoperationcancelled"),t),!1),a.options.onComplete&&S.getDocuments([a.options.document.id],{tenant:a.options.document.envId,securityContext:a.options.document.contextId,tenantUrl:a.options.platformUrls["3DSpace"],onComplete:function(e){if(e.success){if(!Array.isArray(e.data))return;a.options.onComplete({action:"UndoEdit",data:e.data})}}})},n.onFailure=function(e,t){k("error","",t.error,"",!1)};var i=n.tenantUrl+"/resources/v1/modeler/documents/"+a.options.document.id+"/unlock";n.type="json",n.url=i,n.data=JSON.stringify({csrf:JSON.parse(o).csrf}),n.headers=n.headers||{Accept:"*/*","Content-Type":"application/ds-json"},n.method="POST",u.authenticatedRequest(i,n)}}):0==a.options.document.data.files.length?k("error","",E.get("objectcontainsnofile"),"",!1):k("error","",E.get("Nomultifilesupport"),"",!1)}},J={title:E.get("Update"),name:"Update",text:E.get("Update"),fonticon:"update",handler:function(){var t=void 0;a.options.document.data&&null==(t=a.options.document.data.title||a.options.document.data.name)&&a.options.document.data.dataelements&&(t=a.options.document.data.dataelements.title||a.options.document.data.dataelements.name);var o=void 0;if(a.options.document.data.revision?o=a.options.document.data.revision:a.options.document.data.dataelements&&(o=a.options.document.data.dataelements.revision),o&&(t=t+" "+o),1==a.options.document.data.files.length){var n=e.createElement("input",{attributes:{id:"btnUpload_chooser",type:"file",multiple:!1},styles:{display:"none"},events:{change:function(e){if(e.target&&e.target.files&&e.target.files.length>0||e.dataTransfer&&e.dataTransfer.files){var o=e.target&&e.target.files&&e.target.files.length>0?e.target.files:e.dataTransfer.files;if(0==o.length&&(o=e.detail.files),o.length>1)throw E.get("Cannotselectmorethanonefile");1==o.length?a.file=o[0]:a.file=null}else a.file=null;if(a.options.document.data.files&&a.file)if(a.options.document.data.files[0].dataelements.title!=a.file.name){var s='<div style="display: flex;"><span class="fonticon fonticon-attention text-warning fonticon-2x"></span><p style="margin-left: 10px; white-space: pre-line">'+E.get("UpdateConfirmationMsg",{newFileName:a.file.name,oldFileName:a.options.document.data.files[0].dataelements.title})+"</p></div>",l=new i({className:"site-reset",header:E.get("UpdateConfirmation",{documentTitle:t}),body:s,footer:'<button type="button" class="btn btn-primary">'+E.get("Update")+'</button> <button type="button" class="btn btn-default">'+E.get("Cancel")+"</button>",animate:!0,resizable:!0,autocenter:!0,visible:!0,limitParent:!0,overlay:!0,closable:!1});l.show(),l.elements.container.setStyle("z-index","50000"),l.inject(x.body),l.getContent().getElements(".btn.btn-primary").forEach(function(e){e.addEvent("click",function(){J.sendFile(a.file,t),l.hide(),l.destroy()})}),l.getContent().getElements(".btn.btn-default").forEach(function(e){e.addEvent("click",function(){l.hide(),l.destroy()})})}else J.sendFile(a.file,t);n.destroy()}}}).inject(x.body);n.click()}else 0==a.options.document.data.files.length?k("error","",E.get("objectcontainsnofile"),"",!1):k("error","",E.get("Nomultifilesupport"),"",!1)},sendFile:function(t,o){var n={tenant:a.options.document.envId,securityContext:a.options.document.contextId,tenantUrl:a.options.platformUrls["3DSpace"],onFailure:function(e){P.jobs.finishJob(l,"failed");var t="Document";if(a.options.document&&a.options.document.data&&a.options.document.data.dataelements?t=a.options.document.data.dataelements.typeNLS||a.options.document.data.dataelements.type:a.options.document.type&&(t=a.options.document.type),e&&e.length>0&&e[0].updateMessage)k("error",E.get("YouCannotUpdateX",{typeNLS:t}),E.get("VerifyCredentials"),E.get("NotHaveRequiredAccessRole"));else if(e&&e.error)if((e.error.match(/\n/g)||[]).length>=2){for(var o=e.error.split("\n"),n=[],i=2;i<o.length;i++)n.push(o[i]);n=n.join("<br/>"),k("error",o[0],o[1],n,void 0,void 0,!0)}else k("error",E.get("YouCannotUpdateX",{typeNLS:t}),e.error);else k("error",E.get("YouCannotUpdateX",{typeNLS:t}),e);console.error("Document Update Failed Due to:"),console.error(e)},onProgress:function(e){l.update(e)},onComplete:function(t){P.jobs.finishJob(l),k("success",E.get("Fileuploadsuccessful"),e.String.format(E.get("FileuploadsuccessfulMsg"),o),"",!1),a.options.onComplete&&a.options.onComplete({action:"Update",data:t.data})}},i={file:t};t.name&&(i.fileName=t.name);var s={id:a.options.document.id,fileInfo:i},l={title:E.get("UPLOADING_X",{title:a.file.name}),ui:!!s.fileInfo,process:function(){l.xhr=S.modifyDocument(s,n)}};P.jobs.addJob(l)}},X={title:E.get("Delete"),name:"Delete",text:E.get("Delete"),fonticon:"trash",handler:function(){var t=void 0;a.options.document.data&&null==(t=a.options.document.data.title||a.options.document.data.name)&&a.options.document.data.dataelements&&(t=a.options.document.data.dataelements.title||a.options.document.data.dataelements.name);var o=void 0;a.options.document.data.revision?o=a.options.document.data.revision:a.options.document.data.dataelements&&(o=a.options.document.data.dataelements.revision),o&&(t=t+" "+o);var n=e.createElement("div",{styles:{display:"flex"}});e.createElement("span",{styles:{color:"red"},class:"fonticon fonticon-attention fonticon-2x"}).inject(n);var s=e.createElement("p");s.innerText=e.String.format(E.get("DeleteConfirmation"),t),s.inject(n);var l=n,c=new i({className:"site-reset",closable:!0,header:E.get("Delete"),body:l,footer:'<button type="button" class="btn btn-primary">'+E.get("Ok")+'</button> <button type="button" class="btn btn-default">'+E.get("Cancel")+"</button>",animate:!0,resizable:!0,autocenter:!0,visible:!0,limitParent:!0,overlay:!0});c.show(),c.inject(x.body);var r={onComplete:function(o){k("success",E.get("DeletionSuccessful"),e.String.format(E.get("DeletionSuccessfulMsg"),t),"",!1),a.options.onComplete&&a.options.onComplete({action:"Delete"})},onFailure:function(e){k("error","",e.error,"",!1)}};r.tenant=a.options.document.envId,r.securityContext=a.options.document.contextId,r.tenantUrl=a.options.platformUrls["3DSpace"],c.getContent().getElements(".btn.btn-primary").forEach(function(e){e.addEvent("click",function(){S.deleteDocument(a.options.document.id,r),c.hide(),c.destroy()})}),c.getContent().getElements(".btn.btn-default").forEach(function(e){e.addEvent("click",function(){c.hide(),c.destroy()})})}},q={title:E.get("Maturity"),name:"Maturity",text:E.get("Maturity"),fonticon:"collaborative-lifecycle-management",handler:function(){a.options.document.contextId,a.options.document.envId;(new m).executeAsync([{physicalId:a.options.document.id}]).then(function(e,t,o){console.log("Maturity view.");var n={result:{message:"Maturity View."},action:"maturity",targetDocumentId:a.options.document.id};a.options.onComplete(n)})}},B={title:E.get("Share"),name:"Share",text:E.get("Share"),fonticon:"share",handler:function(){var e=void 0;a.options.document.data&&null==(e=a.options.document.data.title||a.options.document.data.name)&&a.options.document.data.dataelements&&(e=a.options.document.data.dataelements.title||a.options.document.data.dataelements.name),require(["DS/ENOCollabSharingCmds/BaseModels/ResultElement","DS/SharePopup/SharePopup"],function(t,o){var n=[new t({physicalId:a.options.document.id,name:e})];a.sharePanel?(a.sharePanel.show(n),a.sharePanel.container.centerIt()):(a.sharePanel=new o(x,x.body,{removeAtClose:!0,events:{onClose:function(){a.sharePanel=null}}}),a.sharePanel.show(n))})}},K=!1,z=!1;if(a.options.document.data&&a.options.document.data.files&&a.options.document.data.files.length>1&&(z=!0),a.options.document.data&&a.options.document.data.files&&0!=a.options.document.data.files.length&&(K=""!=a.options.document.data.files[0].dataelements.locker),void 0===c){var G={};return a.options.document.type?a.supportedTypes.includes(a.options.document.type)?(G[b.PREVIEW]=h,G[b.PREVIEW2]=C,G[b.REPLACE_BY_REVISION]=W,G[b.MATURITY]=q,G[b.DOWNLOAD]=A,G[b.SHARE]=B,G[b.COPY_LINK]=V,G[b.RELATION]=R,G[b.REMOVE]=_,G[b.NEW_REVISION]=j,G[b.DELETE]=X,G[b.COPY]=L,F.contentCopied&&(G[b.PASTE]=O),(a.options.document.filesCallback||a.options.document.data&&a.options.document.data.files)&&(G[b.UPDATE]=J,!K||z?G[b.EDIT]=M:G[b.UNDO_EDIT]=H)):(G[b.MATURITY]=q,G[b.RELATION]=R,G[b.REMOVE]=_):(G[b.PREVIEW]=h,G[b.PREVIEW2]=C,G[b.REPLACE_BY_REVISION]=W,G[b.MATURITY]=q,G[b.DOWNLOAD]=A,G[b.SHARE]=B,G[b.COPY_LINK]=V,G[b.RELATION]=R,G[b.REMOVE]=_,G[b.NEW_REVISION]=j,G[b.DELETE]=X,G[b.COPY]=L,F.contentCopied&&(G[b.PASTE]=O),(a.options.document.filesCallback||a.options.document.data&&a.options.document.data.files)&&(G[b.UPDATE]=J,!K||z?G[b.EDIT]=M:G[b.UNDO_EDIT]=H)),a.options.renderToArray?Object.values(G):G}D={index:r},c.addItem(e.merge(D,h)),D={index:r+=1},c.addItem(e.merge(D,W)),D={index:r+=1},c.addItem(e.merge(D,q)),D={index:r+=1},c.addItem(e.merge(D,A)),D={index:r+=1},c.addItem(e.merge(D,B)),D={index:r+=1},c.addItem(e.merge(D,V)),D={index:r+=1},c.addItem(e.merge(D,R)),D={index:r+=1},c.addItem(e.merge(D,_)),D={index:r+=1},c.addItem(e.merge(D,j)),D={index:r+=1},c.addItem(e.merge(D,X)),D={index:r+=1},c.addItem(e.merge(D,J)),D={index:r+=1},!K||z?c.addItem(e.merge(D,M)):c.addItem(e.merge(D,H))}return A.prototype.init=function(e){var o=this;this.options=e,this.supportedTypes=["Document","Quality System Document","Technical Document"],C.setup(o.options.platformUrls);var n=new t(function(e,t){C.getTypeDerivatives(o.supportedTypes,function(t){var n=[];o.supportedTypes.length>0&&(o.supportedTypes.forEach(e=>{n.push(...t[e])}),o.supportedTypes=n),e(!0)},o.options.platformUrls["3DSpace"])});return x&&x.app&&x.app.jobs&&"doco-jobs"==x.app.jobs.name&&x.app.progressPane&&"doco-progress"==x.app.progressPane.name?P=x.app:(null==P.jobs&&require(["DS/DocumentCommands/Jobs"],function(e){null==P.jobs&&(P.jobs=new e(P))}),null==P.progressPane&&require(["DS/DocumentCommands/ProgressPane"],function(e){null==P.progressPane&&(P.progressPane=new e(P),P.progressPane.inject(x.body))}),null==P.modelEvents&&(P.modelEvents=new c,P.modelEvents.ownedBy="ENOXDocumentCommands")),n},A.prototype.render=function(){var e=this,o=e.options.contextmenu,n=e.options.platformUrls,i={};if(e.options.document.data&&e.options.document.data.relateddata&&e.options.document.data.relateddata.files&&(e.options.document.data.files=e.options.document.data.relateddata.files),null!=e.options.document.data&&null!=e.options.document.data.files||!o&&!e.options.document.filesCallback){if(void 0===o)return i=M(e,n);M(e,n,o)}else{var a={tenant:n.platformId,securityContext:e.options.document.contextId,tenantUrl:e.options.platformUrls["3DSpace"],additionalURLParams:"$include=none,files"};new t(function(t,o){a.onComplete=t,a.onFailure=o,S.getDocuments([e.options.document.id],a)}).then(function(t){e.options.document.data=t.data[0],e.options.document.data.files=t.data[0].relateddata.files,void 0!==o?M(e,n,o):(i=M(e,n),e.options.document.filesCallback(i))},function(e){console.error("Failed to get file Info",e)})}},A}),define("DS/DocumentCommands/Helper",["UWA/Promise","DS/WAFData/WAFData","DS/DocumentCommands/Constants","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o,n,i){"use strict";var a=new UWA.Promise(function(e,t){n.getUser({onComplete:function(t){e(t)},onFailure:function(e){t(e)}})}),s={formatBytes:function(e,t){if(0===e)return"0 "+i.get("fileSizeBytes");if(1===e)return"1 "+i.get("fileSizeByte");var o=t+1||3,n=[i.get("fileSizeBytes"),i.get("fileSizeKiB"),i.get("fileSizeMiB"),i.get("fileSizeGiB"),i.get("fileSizeTiB"),i.get("fileSizePiB"),i.get("fileSizeEiB"),i.get("fileSizeZiB"),i.get("fileSizeYiB")],a=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,a)).toPrecision(o)+" "+n[a]},isIpadPro:function(){return"MacIntel"===navigator.platform&&navigator.maxTouchPoints&&navigator.maxTouchPoints>1},IsWebEditionAvailable:function(){let t=widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise",o="OnPremise"!=t;return null==this.isODEGrantedPromise&&(this.isODEGrantedPromise=new e(function(e){require(["DS/OfficeDocumentEditorClient/Editor"],function(n){o?n.isGranted({platformId:t}).then(()=>{e(!0)}).catch(t=>{e(!1)}):e(!1)},function(t){e(!1)})})),this.isODEGrantedPromise},IsWebEditionDocumentSessionActive:function(t,o){return new e(function(e,n){require(["DS/OfficeDocumentEditorClient/Editor"],function(i){i.state({platformId:t,key:o}).then(t=>{e(t)}).catch(e=>{n(e)})},function(e){n(e)})})},IsFileFormatSupported:function(t){return new e(function(e,o){require(["DS/OfficeDocumentEditorClient/Editor"],function(n){n.isFileFormatSupported({format:t}).then(t=>{e(t)}).catch(e=>{o(e)})},function(e){o(e)})})},AuthoringCommandVisibiltyPromise:function(t,o,n){return new e(function(e){s.CalculateDocumentModificationCommandsVisibility(t,o).then(function(t){n({visibleFlag:t[o]}),e(!0)})})},AuthoringFilesCommandVisibiltyPromise:function(t,o,n){return new e(function(e){s.CalculateFileModificationCommandsVisibility(t,o).then(function(t){n({visibleFlag:t[o]}),e(!0)})})},CalculateDocumentModificationCommandsVisibility:function(t,n){var i=this.IsWebEditionAvailable(),a=this;return new e(function(e){var l=/(android|iPhone|iPod|iPad)/i.test(navigator.userAgent)||a.isIpadPro(),c={};c[o.EDIT]=!1,c[o.OFFICE_WEB_EDITION]=!1,c[o.LOCK_AND_DOWNLOAD]=!1,c[o.UNDO_EDIT]=!1,c[o.UNLOCK]=!1,c[o.UPDATE_AND_UNLOCK]=!1,c[o.UPDATE]=!1,c[o.UPLOAD_FILE]=!1;var r=t.getSelectedNodes();if(1==r.length){c[o.UPLOAD_FILE]=!0;var d=t.getDocumentFromNodeModel(r[0]),u=[];if(d.relateddata&&d.relateddata.files?u=d.relateddata.files:d.files&&(u=d.files),1==u.length)if(""!=u[0].dataelements.locker){"OnPremise"==t.platformUrls.platformId?(c[o.UNDO_EDIT]=!0,c[o.UPDATE]=!0,e(c)):i.then(function(t){if(t){c[o.UNLOCK]=!0,c[o.UPDATE_AND_UNLOCK]=!0;let t=u[0].dataelements.title,i=t.lastIndexOf("."),a=t.substring(i+1,t.length);n!=o.OFFICE_WEB_EDITION?e(c):l?e(c):s.IsFileFormatSupported(a).then(t=>{t?(c[o.OFFICE_WEB_EDITION]=!0,e(c)):e(c)}).catch(function(t){e(c)})}else c[o.UNDO_EDIT]=!0,c[o.UPDATE]=!0,e(c)})}else{"OnPremise"==t.platformUrls.platformId?(c[o.EDIT]=!0,c[o.UPDATE]=!0,e(c)):i.then(function(t){if(t){c[o.LOCK_AND_DOWNLOAD]=!0,c[o.UPDATE]=!0;let t=u[0].dataelements.title,i=t.lastIndexOf("."),a=t.substring(i+1,t.length);n!=o.OFFICE_WEB_EDITION?e(c):l?e(c):s.IsFileFormatSupported(a).then(t=>{t?(c[o.OFFICE_WEB_EDITION]=!0,e(c)):e(c)}).catch(function(t){e(c)})}else c[o.EDIT]=!0,c[o.UPDATE]=!0,e(c)})}else e(c)}else e(c)})},CalculateFileModificationCommandsVisibility:function(t,n){var i=this.IsWebEditionAvailable(),a=this;return new e(function(e){var l=/(android|iPhone|iPod|iPad)/i.test(navigator.userAgent)||a.isIpadPro(),c={};c[o.EDIT]=!1,c[o.OFFICE_WEB_EDITION]=!1,c[o.LOCK_AND_DOWNLOAD]=!1,c[o.LOCK]=!1,c[o.UNDO_EDIT]=!1,c[o.UNLOCK]=!1,c[o.UPDATE_AND_UNLOCK]=!1,c[o.UPDATE]=!1;var r=t.getSelectedNodes();if(1==r.length){var d=t.getDocumentFromNodeModel(r[0]);if(""!=d.dataelements.locker){"OnPremise"==t.platformUrls.platformId?(c[o.UNDO_EDIT]=!0,c[o.UNLOCK]=!0,c[o.UPDATE_AND_UNLOCK]=!0,e(c)):i.then(function(t){if(t){c[o.UNLOCK]=!0,c[o.UPDATE_AND_UNLOCK]=!0;let t=d.dataelements.title,i=t.lastIndexOf("."),a=t.substring(i+1,t.length);n!=o.OFFICE_WEB_EDITION?e(c):l?e(c):s.IsFileFormatSupported(a).then(t=>{t?(c[o.OFFICE_WEB_EDITION]=!0,e(c)):e(c)}).catch(function(t){e(c)})}else c[o.UNDO_EDIT]=!0,c[o.UNLOCK]=!0,c[o.UPDATE_AND_UNLOCK]=!0,e(c)})}else{"OnPremise"==t.platformUrls.platformId?(c[o.EDIT]=!0,c[o.LOCK]=!0,c[o.UPDATE]=!0,e(c)):i.then(function(t){if(t){c[o.LOCK_AND_DOWNLOAD]=!0,c[o.LOCK]=!0,c[o.UPDATE]=!0;let t=d.dataelements.title,i=t.lastIndexOf("."),a=t.substring(i+1,t.length);n!=o.OFFICE_WEB_EDITION?e(c):l?e(c):s.IsFileFormatSupported(a).then(t=>{t?(c[o.OFFICE_WEB_EDITION]=!0,e(c)):e(c)}).catch(function(t){e(c)})}else c[o.EDIT]=!0,c[o.LOCK]=!0,c[o.UPDATE]=!0,e(c)})}}else{var u=[],m=[];r.forEach(e=>{""!=t.getDocumentFromNodeModel(e).dataelements.locker?m.push(!0):u.push(!0)}),c[o.LOCK]=u.includes(!0)&&!u.includes(!1),c[o.UNLOCK]=m.includes(!0)&&!m.includes(!1),e(c)}})},getFile:function(o,n,i){return new e(function(e,a){var s=o.fetchSecurityContext(),l=o.platformUrls["3DSpace"]+"/resources/v1/modeler/documents/"+n+"/files/"+i+"/";t.authenticatedRequest(l,{method:"GET",type:"json",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:s},onComplete:function(t){if(t.success){if(!Array.isArray(t.data))return;e(t.data[0])}else console.error("Data.GetFiles onComplete Failed",t),a(t)},onFailure:function(e){a(e)}})})},fetchCurrentUser:function(){return a}};return s}),define("DS/DocumentCommands/ProgressPane",["UWA/Core","UWA/Controls/Abstract","DS/DocumentCommands/Helper","i18n!DS/DocumentCommands/assets/nls/DocumentCommands","css!DS/DocumentCommands/DocumentCommands.css"],function(e,t,o,n){"use strict";return e.Controls.Abstract.extend({name:"doco-progress",options:{className:""},init:function(e){this.app=e,this._parent(e.options),this.buildSkeleton()},buildSkeleton:function(){var t=this;this.container=e.createElement("div",{class:t.getClassNames("-progresspane popover")});var o=e.createElement("div",{class:"progresspane-titlebar popover-title"});o.inject(this.container),(t.titleElement=e.createElement("div",{class:"progresspane-title",text:n.get("PROGRESS")})).inject(o),t.titlebarCancelAll=e.createElement("div",{class:"progresspane-title-cancelall fonticon-clickable",text:n.get("CancelAll")}),t.titlebarCancelAll.addEvent("click",function(){t.app.jobs.cancelAll()}),t.titlebarCancelAll.inject(o),t.titlebarCancelAll.hide();var i=e.createElement("button",{class:"close fonticon fonticon-chevron-down",type:"button"});i.inject(o),i.addEvent("click",function(){i.classList.contains("fonticon-chevron-down")?(i.classList.remove("fonticon-chevron-down"),i.classList.add("fonticon-chevron-up"),t.content.hide()):(i.classList.remove("fonticon-chevron-up"),i.classList.add("fonticon-chevron-down"),t.content.show())}),this.content=e.createElement("div",{class:"progresspane-content popover-content"}),this.content.inject(this.container),this.hide()},show:function(){this.container.show()},hide:function(){this.container.hide(),this.totalSize=0,this.completedSize=0,this.ongoingSizes={},this.titlebarCancelAll.hide(),this.titleElement.setText(n.get("PROGRESS"))},addPendingSize:function(e){this.totalSize+=e},totalSize:0,completedSize:0,ongoingSizes:{},addProgress:function(t){var i=this;i.show();var a=e.createElement("div",{class:"progresspane-job"}),s=e.createElement("div",{class:"progresspane-jobtitle",text:t.title,title:t.tooltip||t.title});s.inject(a);var l=e.createElement("progress",{class:"progress progresspane-jobprogress",value:0,max:100}).hide();l.inject(a);var c=e.createElement("div",{class:"progresspane-jobstatus",text:n.get("Pending")}).inject(a);if(t.cancel){var r=e.createElement("span",{class:"progresspane-jobcancel fonticon fonticon-close fonticon-clickable",title:n.get("Cancel")}).inject(a);r.addEvent("click",function(){t.cancel()}),this.titlebarCancelAll.show()}a.inject(i.content),t.progress=a,t.progress.update=function(e,a,d,u){s.setText(e),l.setAttributes({value:100*a/d,max:100,title:e}),0!=a&&(c.hide(),l.show()),a==d&&(r&&r.hide(),u&&"failed"==u?c.setText(n.get("Failed")):u&&"cancelled"==u?c.setText(n.get("Cancelled")):(c.setText(n.get("Completed")),t.size&&i.titleElement.setText(n.get("PROGRESSOF",{current:o.formatBytes(i.completedSize,2),max:o.formatBytes(i.totalSize,2)}))),l.addClassName("progress-success"),c.show(),l.hide())}}})}),define("DS/DocumentCommands/V2/FileActions/UndoEdit",["UWA/Core","DS/WAFData/WAFData","DS/DocumentCommands/Helper","i18n!DS/DocumentCommands/assets/nls/DocumentCommands","css!DS/DocumentCommands/DocumentCommands.css"],function(e,t,o,n){"use strict";var i=function(e){return{id:"UndoEdit",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"pencil-block",fontIconFamily:1},label:n.get("UndoEdit"),tooltip:n.get("UndoEdit"),position:"far",category:"edit",value:function(t){t.options=e,i.execute(t)},visibleFlag:!1},execute:function(){i.execute({options:e})},updateForSelection:function(t,n){return o.AuthoringFilesCommandVisibiltyPromise(e,this.id,t)}}};return i.execute=function(i){var a=i.options.getSelectedNodes()[0],s=i.options.getDocumentFromNodeModel(a),l=i.options.getParentDocument(),c=void 0;s&&null==(c=s.title||s.name)&&s.dataelements&&(c=s.dataelements.title||s.dataelements.name),t.authenticatedRequest(i.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",url_temp:i.options.platformUrls["3DSpace"],onComplete:function(r){var d={};d.tenant=i.options.platformUrls.platformId,d.securityContext=i.options.fetchSecurityContext(),d.tenantUrl=i.options.platformUrls["3DSpace"],d.onComplete=function(t){i.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:"",subtitle:e.String.format(n.get("Editoperationcancelled"),c),message:"",sticky:!1,allowUnsafeHTML:!1}}),i.options.events&&(i.options.events.publish({event:"enox-docfiles-undoedit-complete",data:{nodeModel:a,fileId:s.id}}),o.getFile(i.options,l,s.id).then(function(e){require(["DS/PlatformAPI/PlatformAPI"],function(t){t.publish("docm-file-undoedited-in-document",{platformId:i.options.platformUrls.platformId,documentId:l,file:e})})}))},d.onFailure=function(e,t){i.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:t.error,message:"",sticky:!1,allowUnsafeHTML:!1}})};var u=d.tenantUrl+"/resources/v1/modeler/documents/"+l+"/files/"+s.id+"/unlock";d.type="json",d.url=u,d.data=JSON.stringify({csrf:JSON.parse(r).csrf}),d.headers=d.headers||{Accept:"*/*","Content-Type":"application/ds-json"},d.method="POST",t.authenticatedRequest(u,d)}})},i}),define("DS/DocumentCommands/V2/Actions/UpdateAndUnlock",["UWA/Core","DS/UIKIT/Modal","DS/DocumentManagement/DocumentManagement","DS/DocumentCommands/Helper","DS/DocumentFiles/data/Model","DS/DocumentCommonInfra/TrackerAPI","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o,n,i,a,s,l){"use strict";var c=function(e){return{id:"UpdateAndUnlock",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"update-lock-open",fontIconFamily:1},label:l.get("UpdateAndUnlock"),tooltip:l.get("UpdateAndUnlock"),position:"far",category:"edit",value:function(t){t.options=e,c.execute(t)},visibleFlag:!1},execute:function(){c.execute({options:e})},updateForSelection:function(t,o){return n.AuthoringCommandVisibiltyPromise(e,this.id,t)}}};function r(t,n,c,r){var d=new Date,u={},m=c.options.getDocumentFromNodeModel(t),p=[];m.files?p=m.files:m.relateddata&&m.relateddata.files&&(p=m.relateddata.files),u.additionalHeaders=function(){let t=s.get();var o=e.is(t)&&e.is(t.change.id)?t.change.id:null;return""!=o?{"DS-Change-Authoring-Context":"pid:"+o}:{}}(),u.tenant=c.options.platformUrls.platformId,u.securityContext=c.options.fetchSecurityContext(),u.tenantUrl=c.options.platformUrls["3DSpace"],u.onFailure=function(e){var o=new Date-d;a.sendTrackerPageEvent({category:"docm.command.update",action:"click",label:"Document Update",pd:{docType:m.type,docId:m.id,newFileExtension:i.getFileExtension(n.name),oldFileExtension:i.getFileExtension(p[0].dataelements.title),source:c.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:o,failure:0}}),c.options.getJobsProcessorPromise.then(function(e){e.finishJob(v,"failed")});var s="Document";if(m&&m.dataelements?s=m.dataelements.typeNLS||m.dataelements.type:t.options.type&&(s=t.options.type),e&&e.length>0&&e[0].updateMessage)c.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:l.get("YouCannotUpdateX",{typeNLS:s}),subtitle:l.get("VerifyCredentials"),message:l.get("NotHaveRequiredAccessRole"),sticky:!1,allowUnsafeHTML:!1}});else if(e&&e.error)if((e.error.match(/\n/g)||[]).length>=2){for(var r=e.error.split("\n"),u=[],f=2;f<r.length;f++)u.push(r[f]);u=u.join("<br/>"),c.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:r[0],subtitle:r[1],message:u,sticky:!1,allowUnsafeHTML:!0}})}else c.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:l.get("YouCannotUpdateX",{typeNLS:s}),subtitle:e.error,message:"",sticky:!1,allowUnsafeHTML:!1}});else c.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:l.get("YouCannotUpdateX",{typeNLS:s}),subtitle:e,message:"",sticky:!1,allowUnsafeHTML:!1}});console.error("Document Update Failed Due to:"),console.error(e)},u.onProgress=function(e){v.update(e)},u.onComplete=function(o){var s=new Date-d;a.sendTrackerPageEvent({category:"docm.command.update",action:"click",label:"Document Update",pd:{docType:m.type,docId:m.id,newFileExtension:i.getFileExtension(n.name),oldFileExtension:i.getFileExtension(p[0].dataelements.title),source:c.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:s,success:1}}),c.options.getJobsProcessorPromise.then(function(e){e.finishJob(v)}),c.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:l.get("Fileuploadsuccessful"),subtitle:e.String.format(l.get("FileuploadsuccessfulMsg"),r),message:"",sticky:!1,allowUnsafeHTML:!1}}),c.options.events.publish({event:"docv2-update-complete",data:{nodeModel:t,data:o.data}}),require(["DS/PlatformAPI/PlatformAPI"],function(e){e.publish("docm-file-updated-to-document",{platformId:c.options.platformUrls.platformId,documentId:m.id,oldFileId:p[0].id,updatedFile:o.data[0].relateddata.files[0]})})};var f={file:n};n.name&&(f.fileName=n.name);var g={id:m.id,fileInfo:f},v={title:l.get("UPLOADING_X",{title:n.name}),ui:!!g.fileInfo,process:function(){v.xhr=o.modifyDocument(g,u)}};c.options.getJobsProcessorPromise.then(function(e){e.addJob(v)})}return c.execute=function(e){c.executeUpdate(e)},c.executeUpdate=function(t){let o=t.options.platformUrls.platformId;var i=t.options.getSelectedNodes()[0],a=t.options.getDocumentFromNodeModel(i),s=[];a.files?s=a.files:a.relateddata&&a.relateddata.files&&(s=a.relateddata.files);a&&a.dataelements?a.dataelements.typeNLS||a.dataelements.type:a.type&&a.type;var r=void 0;a&&null==(r=a.title||a.name)&&a.dataelements&&(r=a.dataelements.title||a.dataelements.name);var d=void 0;if(a.revision?d=a.revision:a.dataelements&&(d=a.dataelements.revision),d&&(r=r+" "+d),1==s.length){var u=window.FilePicker=e.createElement("input",{attributes:{id:"btnUpload_chooser",type:"file",multiple:!1},styles:{display:"none"},events:{change:function(e){var i;if(e.target&&e.target.files&&e.target.files.length>0||e.dataTransfer&&e.dataTransfer.files){var a=e.target&&e.target.files&&e.target.files.length>0?e.target.files:e.dataTransfer.files;if(0==a.length&&(a=e.detail.files),a.length>1)throw l.get("Cannotselectmorethanonefile");i=1==a.length?a[0]:null}else i=null;(this.docKeyToUse="docm_"+s[0].dataelements.name.replace(/[!^@&\/\\#, +()$~%.'":*?<>{}]/g,"_"),"OnPremise"!=o&&1==a.length)?n.IsWebEditionDocumentSessionActive(o,this.docKeyToUse).then(e=>{e&&e.opened?t.options.events.publish({event:"docv2-show-notification",data:{level:"warning",title:"",subtitle:l.get("UpdateErrorMessageAsWebEditionSessionActive"),message:"",sticky:!1,allowUnsafeHTML:!0}}):c.executeFileUpload(t,i,u)}).catch(e=>{c.executeFileUpload(t,i,u)}):c.executeFileUpload(t,i,u)}}}).inject(t.options.widget.body);window.preventFilePickerClicks||u.click()}else 0==s.length?t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:l.get("objectcontainsnofile"),message:"",sticky:!1,allowUnsafeHTML:!1}}):t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:l.get("Nomultifilesupport"),message:"",sticky:!1,allowUnsafeHTML:!1}})},c.executeFileUpload=function(e,o,n){var i=e.options.getSelectedNodes()[0],a=e.options.getDocumentFromNodeModel(i),s=[];a.files?s=a.files:a.relateddata&&a.relateddata.files&&(s=a.relateddata.files);var c=void 0;if(a&&null==(c=a.title||a.name)&&a.dataelements&&(c=a.dataelements.title||a.dataelements.name),s[0].dataelements.title!=o.name){var d='<div style="display: flex;"><span class="fonticon fonticon-attention text-warning fonticon-2x"></span><p style="margin-left: 10px; white-space: pre-line">'+l.get("UpdateConfirmationMsg",{newFileName:o.name,oldFileName:s[0].dataelements.title})+"</p></div>",u=new t({className:"site-reset",header:l.get("UpdateConfirmation",{documentTitle:c}),body:d,footer:'<button type="button" class="btn btn-primary">'+l.get("Update")+'</button> <button type="button" class="btn btn-default">'+l.get("Cancel")+"</button>",animate:!0,resizable:!0,autocenter:!0,visible:!0,limitParent:!0,overlay:!0,closable:!1});u.show(),u.elements.container.setStyle("z-index","50000"),u.inject(e.options.widget.body),u.getContent().getElements(".btn.btn-primary").forEach(function(t){t.addEvent("click",function(){r(i,o,e,c),u.hide(),u.destroy()})}),u.getContent().getElements(".btn.btn-default").forEach(function(e){e.addEvent("click",function(){u.hide(),u.destroy()})})}else r(i,o,e,c);n.destroy()},c}),define("DS/DocumentCommands/V2/Actions/LockAndDownload",["UWA/Core","DS/DocumentManagement/DocumentManagement","DS/DocumentCommands/Helper","DS/DocumentCommonInfra/TrackerAPI","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o,n,i){"use strict";var a=function(e){return{id:"LockAndDownload",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"lock-download",fontIconFamily:1},label:i.get("LockAndDownload"),tooltip:i.get("LockAndDownload"),position:"far",category:"edit",value:function(t){t.options=e,a.execute(t)},visibleFlag:!1},execute:function(){a.execute({options:e})},updateForSelection:function(t,n){return o.AuthoringCommandVisibiltyPromise(e,this.id,t)}}};return a.execute=function(e){a.executeLockAndDownload(e)},a.executeEdit=function(s){var l=new Date,c=s.options.getSelectedNodes()[0],r=s.options.getDocumentFromNodeModel(c),d=[];r.files?d=r.files:r.relateddata&&r.relateddata.files&&(d=r.relateddata.files);var u=void 0;if(r&&null==(u=r.title||r.name)&&r.dataelements&&(u=r.dataelements.title||r.dataelements.name),1==d.length){var m={asZip:!0,autoDownload:!0};m.tenant=s.options.platformUrls.platformId,m.securityContext=s.options.fetchSecurityContext(),m.tenantUrl=s.options.platformUrls["3DSpace"],m.onComplete=function(t){var m=new Date-l;if(n.sendTrackerPageEvent({category:"docm.command.lockanddownload",action:"click",label:"Document LockAndDownload",pd:{docType:r.type,docId:r.id,source:s.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:m,success:1,numOfFiles:1}}),u&&""!==u){var p={title:i.get("Download_Initiated"),subtitle:e.String.format(i.get("Filedownloadstartedforedit"),u)};a.showNotification(s,"info",p.title||"",p.subtitle||"","",!1,!1)}else a.showNotification(s,"info",i.get("checkout_initiated"),"","",!1,!1);s.options.events&&(s.options.events.publish({event:"docv2-edit-complete",data:{nodeModel:c}}),o.getFile(s.options,r.id,d[0].id).then(function(e){require(["DS/PlatformAPI/PlatformAPI"],function(t){t.publish("docm-file-edited-in-document",{platformId:s.options.platformUrls.platformId,documentId:r.id,file:e})})}))},m.onFailure=function(e){var t=new Date-l;n.sendTrackerPageEvent({category:"docm.command.lockanddownload",action:"click",label:"Document LockAndDownload",pd:{docType:r.type,docId:r.id,source:s.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:t,failure:0,numOfFiles:1}});var o="Document";r&&r.dataelements?o=r.dataelements.typeNLS||r.dataelements.type:r.type&&(o=r.type),e&&e.data&&e.data.length>0&&e.data[0].updateMessage?a.showNotification(s,"error",i.get("YouCannotEditX",{typeNLS:o}),i.get("VerifyCredentials"),i.get("NotHaveRequiredAccessRole"),!1,!1):a.showNotification(s,"error",i.get("YouCannotEditX",{typeNLS:o}),e,"",!1,!1),console.error("Document Edit Failed Due to:",e)},s.options.widget&&s.options.widget.MSFDocumentClient&&null===t.MSFDocumentClient?t.MSFDocumentClient=s.options.widget.MSFDocumentClient:s.options.MSFDocumentClient&&null===t.MSFDocumentClient&&(t.MSFDocumentClient=s.options.MSFDocumentClient),t.downloadDocument(r.id,r.fileid,!0,m)}else 0==d.length?a.showNotification(s,"error","",i.get("objectcontainsnofile"),"",!1,!1):a.showNotification(s,"error","",i.get("Nomultifilesupport"),"",!1,!1)},a.executeLockAndDownload=function(e){let t=e.options.platformUrls.platformId;var n=e.options.getSelectedNodes()[0],s=e.options.getDocumentFromNodeModel(n),l=[];(s.files?l=s.files:s.relateddata&&s.relateddata.files&&(l=s.relateddata.files),this.docKeyToUse="docm_"+l[0].dataelements.name.replace(/[!^@&\/\\#, +()$~%.'":*?<>{}]/g,"_"),"OnPremise"!=t&&1==l.length)?o.IsWebEditionDocumentSessionActive(e.options.platformUrls.platformId,this.docKeyToUse).then(t=>{t&&t.opened?a.showNotification(e,"warning","",i.get("EditErrorMessageWebEditionSessionActive"),"",!0,!0):a.executeEdit(e)}).catch(t=>{a.executeEdit(e)}):a.executeEdit(e)},a.showNotification=function(e,t,o,n,i,a,s){e.options.events.publish({event:"docv2-show-notification",data:{level:t,title:o,subtitle:n,message:i,sticky:a,allowUnsafeHTML:s}})},a}),define("DS/DocumentCommands/V2/FileActions/LockAndDownload",["UWA/Core","DS/DocumentManagement/DocumentManagement","DS/DocumentCommands/Helper","DS/DocumentCommonInfra/TrackerAPI","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o,n,i){"use strict";var a=function(e){return{id:"LockAndDownload",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"lock-download",fontIconFamily:1},label:i.get("LockAndDownload"),tooltip:i.get("LockAndDownload"),position:"far",category:"edit",value:function(t){t.options=e,a.execute(t)},visibleFlag:!1},execute:function(){a.execute({options:e})},updateForSelection:function(t,n){return o.AuthoringFilesCommandVisibiltyPromise(e,this.id,t)}}};return a.execute=function(e){a.executeLockAndDownload(e)},a.executeEdit=function(s){var l=new Date,c=s.options.getSelectedNodes()[0],r=s.options.getDocumentFromNodeModel(c),d=s.options.getParentDocument(),u=void 0;r&&null==(u=r.title||r.name)&&r.dataelements&&(u=r.dataelements.title||r.dataelements.name);var m={asZip:!0,autoDownload:!0};m.tenant=s.options.platformUrls.platformId,m.securityContext=s.options.fetchSecurityContext(),m.tenantUrl=s.options.platformUrls["3DSpace"],m.onComplete=function(t){var m=new Date-l;if(n.sendTrackerPageEvent({category:"docm.command.lockanddownload",action:"click",label:"Document LockAndDownload",pd:{docType:r.type,docId:r.id,source:s.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:m,success:1,numOfFiles:1}}),u&&""!==u){var p={title:i.get("Download_Initiated"),subtitle:e.String.format(i.get("Filedownloadstartedforedit"),u)};a.showNotification(s,"info",p.title||"",p.subtitle||"","",!1,!1)}else a.showNotification(s,"info",i.get("checkout_initiated"),"","",!1,!1);s.options.events&&(s.options.events.publish({event:"enox-docfiles-edit-complete",data:{nodeModel:c,fileId:r.id}}),o.getFile(s.options,d,r.id).then(function(e){require(["DS/PlatformAPI/PlatformAPI"],function(t){t.publish("docm-file-edited-in-document",{platformId:s.options.platformUrls.platformId,documentId:d,file:e})})}))},m.onFailure=function(e){var t=new Date-l;n.sendTrackerPageEvent({category:"docm.command.lockanddownload",action:"click",label:"Document LockAndDownload",pd:{docType:r.type,docId:r.id,source:s.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:t,failure:0,numOfFiles:1}});var o="Document";r&&r.dataelements?o=r.dataelements.typeNLS||r.dataelements.type:r.type&&(o=r.type),e&&e.data&&e.data.length>0&&e.data[0].updateMessage?a.showNotification(s,"error",i.get("YouCannotEditX",{typeNLS:o}),i.get("VerifyCredentials"),i.get("NotHaveRequiredAccessRole"),!1,!1):a.showNotification(s,"error",i.get("YouCannotEditX",{typeNLS:o}),e,"",!1,!1),console.error("Document Edit Failed Due to:")},s.options.widget&&s.options.widget.MSFDocumentClient&&null===t.MSFDocumentClient?t.MSFDocumentClient=s.options.widget.MSFDocumentClient:s.options.MSFDocumentClient&&null===t.MSFDocumentClient&&(t.MSFDocumentClient=s.options.MSFDocumentClient),t.downloadDocument(d,r.id,!0,m)},a.executeLockAndDownload=function(e){let t=e.options.platformUrls.platformId;var n=e.options.getSelectedNodes()[0],s=e.options.getDocumentFromNodeModel(n);(this.docKeyToUse="docm_"+s.dataelements.name.replace(/[!^@&\/\\#, +()$~%.'":*?<>{}]/g,"_"),"OnPremise"!=t)?o.IsWebEditionDocumentSessionActive(e.options.platformUrls.platformId,this.docKeyToUse).then(t=>{t&&t.opened?a.showNotification(e,"warning","",i.get("EditErrorMessageWebEditionSessionActive"),"",!0,!0):a.executeEdit(e)}).catch(t=>{a.executeEdit(e)}):a.executeEdit(e)},a.showNotification=function(e,t,o,n,i,a,s){e.options.events.publish({event:"docv2-show-notification",data:{level:t,title:o,subtitle:n,message:i,sticky:a,allowUnsafeHTML:s}})},a}),define("DS/DocumentCommands/V2/FileActions/UpdateAndUnlock",["UWA/Core","DS/UIKIT/Modal","DS/DocumentManagement/DocumentManagement","DS/DocumentCommands/Helper","DS/DocumentFiles/data/Model","DS/DocumentCommonInfra/TrackerAPI","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o,n,i,a,s,l){"use strict";var c=function(e){return{id:"UpdateAndUnlock",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"update-lock-open",fontIconFamily:1},label:l.get("UpdateAndUnlock"),tooltip:l.get("UpdateAndUnlock"),position:"far",category:"edit",value:function(t){t.options=e,c.execute(t)},visibleFlag:!1},execute:function(){c.execute({options:e})},updateForSelection:function(t,o){return n.AuthoringFilesCommandVisibiltyPromise(e,this.id,t)}}};function r(t,n,c,r){var d=new Date,u={},m=c.options.getDocumentFromNodeModel(t),p=c.options.getParentDocument();u.additionalHeaders=function(){let t=s.get(),o=e.is(t)&&e.is(t.change.id)?t.change.id:null;return""!=o?{"DS-Change-Authoring-Context":"pid:"+o}:{}}(),u.tenant=c.options.platformUrls.platformId,u.securityContext=c.options.fetchSecurityContext(),u.tenantUrl=c.options.platformUrls["3DSpace"],u.onFailure=function(e){var o=new Date-d;a.sendTrackerPageEvent({category:"docm.command.update",action:"click",label:"Document Update",pd:{docType:m.type,docId:m.id,newFileExtension:i.getFileExtension(n.name),oldFileExtension:i.getFileExtension(m.dataelements.title),source:c.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:o,failure:0}}),c.options.getJobsProcessorPromise.then(function(e){e.finishJob(v,"failed")});var s="Document";if(m&&m.dataelements?s=m.dataelements.typeNLS||m.dataelements.type:t.options.type&&(s=t.options.type),e&&e.length>0&&e[0].updateMessage)c.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:l.get("YouCannotUpdateX",{typeNLS:s}),subtitle:l.get("VerifyCredentials"),message:l.get("NotHaveRequiredAccessRole"),sticky:!1,allowUnsafeHTML:!1}});else if(e&&e.error)if((e.error.match(/\n/g)||[]).length>=2){for(var r=e.error.split("\n"),u=[],p=2;p<r.length;p++)u.push(r[p]);u=u.join("<br/>"),c.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:r[0],subtitle:r[1],message:u,sticky:!1,allowUnsafeHTML:!0}})}else c.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:l.get("YouCannotUpdateX",{typeNLS:s}),subtitle:e.error,message:"",sticky:!1,allowUnsafeHTML:!1}});else c.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:l.get("YouCannotUpdateX",{typeNLS:s}),subtitle:e,message:"",sticky:!1,allowUnsafeHTML:!1}});console.error("Document Update Failed Due to:"),console.error(e)},u.onProgress=function(e){v.update(e)},u.onComplete=function(o){var s=new Date-d;a.sendTrackerPageEvent({category:"docm.command.update",action:"click",label:"Document Update",pd:{docType:m.type,docId:m.id,newFileExtension:i.getFileExtension(n.name),oldFileExtension:i.getFileExtension(m.dataelements.title),source:c.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:s,success:1}}),c.options.getJobsProcessorPromise.then(function(e){e.finishJob(v)}),c.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:l.get("Fileuploadsuccessful"),subtitle:e.String.format(l.get("FileuploadsuccessfulMsg"),r),message:"",sticky:!1,allowUnsafeHTML:!1}}),c.options.events.publish({event:"enox-docfiles-update-complete",data:{nodeModel:t,updatedFile:o.data[0].relateddata.files[0]}}),require(["DS/PlatformAPI/PlatformAPI"],function(e){e.publish("docm-file-updated-to-document",{platformId:c.options.platformUrls.platformId,documentId:p,oldFileId:m.id,updatedFile:o.data[0].relateddata.files[0]})})};var f={file:n};n.name&&(f.fileName=n.name,f.id=m.id);var g={id:p,fileInfo:f},v={title:l.get("UPLOADING_X",{title:n.name}),ui:!!g.fileInfo,process:function(){v.xhr=o.modifyDocument(g,u)}};c.options.getJobsProcessorPromise.then(function(e){e.addJob(v)})}return c.execute=function(e){c.executeUpdate(e)},c.executeUpdate=function(t){var o=this,i=t.options.getSelectedNodes()[0];let a=t.options.platformUrls.platformId;var s=t.options.getDocumentFromNodeModel(i);this.docKeyToUse="docm_"+s.dataelements.name.replace(/[!^@&\/\\#, +()$~%.'":*?<>{}]/g,"_");var r=t.options.getDocumentFromNodeModel(i);r&&r.dataelements?r.dataelements.typeNLS||r.dataelements.type:r.type&&r.type;var d=void 0;r&&null==(d=r.title||r.name)&&r.dataelements&&(d=r.dataelements.title||r.dataelements.name);var u=void 0;r.revision?u=r.revision:r.dataelements&&(u=r.dataelements.revision),u&&(d=d+" "+u);var m=window.FileActionsFilePicker=e.createElement("input",{attributes:{id:"btnUpload_chooser",type:"file",multiple:!1},styles:{display:"none"},events:{change:function(e){var s;t.options.getDocumentFromNodeModel(i);if(e.target&&e.target.files&&e.target.files.length>0||e.dataTransfer&&e.dataTransfer.files){var r=e.target&&e.target.files&&e.target.files.length>0?e.target.files:e.dataTransfer.files;if(0==r.length&&(r=e.detail.files),r.length>1)throw l.get("Cannotselectmorethanonefile");s=1==r.length?r[0]:null}else s=null;"OnPremise"!=a?n.IsWebEditionDocumentSessionActive(a,o.docKeyToUse).then(e=>{e&&e.opened?t.options.events.publish({event:"docv2-show-notification",data:{level:"warning",title:"",subtitle:l.get("UpdateErrorMessageAsWebEditionSessionActive"),message:"",sticky:!1,allowUnsafeHTML:!0}}):c.executeFileUpload(t,s,m)}).catch(e=>{c.executeFileUpload(t,s,m)}):c.executeFileUpload(t,s,m)}}}).inject(t.options.widget.body);window.preventFilePickerClicks||m.click()},c.executeFileUpload=function(e,o,n){var i=e.options.getSelectedNodes()[0],a=e.options.getDocumentFromNodeModel(i),s=void 0;if(a&&null==(s=a.title||a.name)&&a.dataelements&&(s=a.dataelements.title||a.dataelements.name),a.dataelements.title!=o.name){var c='<div style="display: flex;"><span class="fonticon fonticon-attention text-warning fonticon-2x"></span><p style="margin-left: 10px; white-space: pre-line">'+l.get("UpdateConfirmationMsg",{newFileName:o.name,oldFileName:a.dataelements.title})+"</p></div>",d=new t({className:"site-reset",header:l.get("UpdateConfirmation",{documentTitle:s}),body:c,footer:'<button type="button" class="btn btn-primary">'+l.get("Update")+'</button> <button type="button" class="btn btn-default">'+l.get("Cancel")+"</button>",animate:!0,resizable:!0,autocenter:!0,visible:!0,limitParent:!0,overlay:!0,closable:!1});d.show(),d.elements.container.setStyle("z-index","50000"),d.inject(e.options.widget.body),d.getContent().getElements(".btn.btn-primary").forEach(function(t){t.addEvent("click",function(){r(i,o,e,s),d.hide(),d.destroy()})}),d.getContent().getElements(".btn.btn-default").forEach(function(e){e.addEvent("click",function(){d.hide(),d.destroy()})})}else r(i,o,e,s);n.destroy()},c}),define("DS/DocumentCommands/V2/Actions/AddTo",["DS/DocumentCommands/V2/Actions/AddTo/Libraries","DS/DocumentCommands/V2/ConvertCmdToWebUX","UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o,n){"use strict";return function(i){var a=new e(i);return{id:"AddTo",dataElements:{docV2Public:!0,typeRepresentation:"functionMenuIcon",icon:{iconName:"plus",fontIconFamily:1},label:n.get("AddTo"),tooltip:n.get("AddTo"),position:"far",category:"edit",value:{menu:t([a])},visibleFlag:!1},updateForSelection:function(e,t){return new o(function(t){e({visibleFlag:i.getSelectedNodes().length>=1}),t(!0)})}}}}),define("DS/DocumentCommands/V2/Actions/UploadFile",["UWA/Core","DS/DocumentManagement/DocumentManagement","DS/DocumentCommands/Helper","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o,n,i){"use strict";var a=function(e){return{id:"UploadFile",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"upload",fontIconFamily:1},label:i.get("UploadFile"),tooltip:i.get("UploadFile"),position:"far",category:"edit",value:function(t){t.options=e,a.execute(t)},visibleFlag:!0},execute:function(){a.execute({options:e})},updateForSelection:function(t,n){return o.AuthoringCommandVisibiltyPromise(e,this.id,t)}}};function s(o,a){var s={},l=a.options.getSelectedNodes()[0],c=a.options.getDocumentFromNodeModel(l).id;s.tenant=a.options.platformUrls.platformId,s.securityContext=a.options.fetchSecurityContext(),s.additionalHeaders=function(){let t=n.get(),o=e.is(t)&&e.is(t.change.id)?t.change.id:null;return""!=o?{"DS-Change-Authoring-Context":"pid:"+o}:{}}(),s.tenantUrl=a.options.platformUrls["3DSpace"],s.onFailure=function(e){a.options.getJobsProcessorPromise.then(function(e){e.finishJob(u,"failed")});if(e&&e.length>0&&e[0].updateMessage)a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:i.get("YouCannotUpdateX",{typeNLS:"Document"}),subtitle:i.get("VerifyCredentials"),message:i.get("NotHaveRequiredAccessRole"),sticky:!1,allowUnsafeHTML:!1}});else if(e&&e.error)if((e.error.match(/\n/g)||[]).length>=2){for(var t=e.error.split("\n"),o=[],n=2;n<t.length;n++)o.push(t[n]);o=o.join("<br/>"),a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:t[0],subtitle:t[1],message:o,sticky:!1,allowUnsafeHTML:!0}})}else a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:i.get("YouCannotUpdateX",{typeNLS:"Document"}),subtitle:e.error,message:"",sticky:!1,allowUnsafeHTML:!1}});else a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:i.get("YouCannotUpdateX",{typeNLS:"Document"}),subtitle:e,message:"",sticky:!1,allowUnsafeHTML:!1}});console.error("Document Update Failed Due to:"),console.error(e)},s.onProgress=function(e){u.update(e)},s.onComplete=function(t){a.options.getJobsProcessorPromise.then(function(e){e.finishJob(u)}),a.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:i.get("Fileuploadsuccessful"),subtitle:e.String.format(i.get("FileuploadsuccessfulMsg"),""),message:"",sticky:!1,allowUnsafeHTML:!1}}),a.options.events.publish({event:"docv2-uploadfile-complete",data:{nodeModel:l,files:t.data[0].relateddata.files}}),require(["DS/PlatformAPI/PlatformAPI"],function(e){e.publish("docm-file-added-to-document",{platformId:a.options.platformUrls.platformId,documentId:c,newFiles:t.data[0].relateddata.files})})};var r={file:o};o.name&&(r.fileName=o.name,r.newFile=!0);var d={id:c,fileInfo:r},u={title:i.get("UPLOADING_X",{title:o.name}),ui:!!d.fileInfo,process:function(){u.xhr=t.modifyDocument(d,s)}};a.options.getJobsProcessorPromise.then(function(e){e.addJob(u)})}return a.execute=function(e){a.updateandUnlockFile(e)},a.executeUpdate=function(t){var o=e.createElement("input",{attributes:{id:"btnUpload_chooser",type:"file",multiple:!1},styles:{display:"none"},events:{change:function(e){if(e.target&&e.target.files&&e.target.files.length>0||e.dataTransfer&&e.dataTransfer.files){var n=e.target&&e.target.files&&e.target.files.length>0?e.target.files:e.dataTransfer.files;0==n.length&&(n=e.detail.files);for(var i=0;i<n.length;i++)s(n[i],t)}o.destroy()}}}).inject(t.options.widget.body);o.click()},a.updateandUnlockFile=function(e){a.executeUpdate(e)},a}),define("DS/DocumentCommands/V2/Actions/Edit",["DS/DocumentCommands/V2/Actions/LockAndDownload","DS/DocumentCommands/Helper","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o){"use strict";var n=function(e){return{id:"Edit",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"pencil",fontIconFamily:1},label:o.get("Edit"),tooltip:o.get("Edit"),position:"far",category:"edit",value:function(t){t.options=e,n.execute(t)},visibleFlag:!1},execute:function(){n.execute({options:e})},updateForSelection:function(o,n){return t.AuthoringCommandVisibiltyPromise(e,this.id,o)}}};return n.execute=function(t){e.executeLockAndDownload(t)},n}),define("DS/DocumentCommands/V2/FileActions/UploadFile",["UWA/Core","DS/UIKIT/Modal","DS/DocumentManagement/DocumentManagement","DS/DocumentCommands/Helper","DS/DocumentFiles/data/Model","DS/DocumentCommonInfra/TrackerAPI","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o,n,i,a,s,l){"use strict";var c=function(e){return{id:"UploadFile",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"upload",fontIconFamily:1},label:l.get("UploadFile"),tooltip:l.get("UploadFile"),position:"far",category:"edit",value:function(t){t.options=e,c.execute(t)},visibleFlag:!0},execute:function(t){c.execute({options:e,files:t})},updateForSelection:function(e,t){}}};function r(){let t=s.get(),o=e.is(t)&&e.is(t.change.id)?t.change.id:null;return""!=o?{"DS-Change-Authoring-Context":"pid:"+o}:{}}function d(t){for(var n=0;n<t.files.length;n++){!function(n){var s={},c=t.options.getParentDocument();s.tenant=t.options.platformUrls.platformId,s.securityContext=t.options.fetchSecurityContext(),s.tenantUrl=t.options.platformUrls["3DSpace"],s.additionalHeaders=r(),s.onFailure=function(e){var o=new Date-m.fileUploadStart;a.sendTrackerPageEvent({category:"docm.file.upload.complete",action:"click",label:"File Upload Done",pd:{parentId:void 0,parentRelName:void 0,securityContext:s.securityContext,docType:n.type,fileType:i.getFileExtension(n.name),filesize:n.size},pv:{totalTimeTaken:o,failure:0}}),t.options.getJobsProcessorPromise.then(function(e){e.finishJob(m,"failed")});if(e&&e.length>0&&e[0].updateMessage)t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:l.get("YouCannotUpdateX",{typeNLS:"Document"}),subtitle:l.get("VerifyCredentials"),message:l.get("NotHaveRequiredAccessRole"),sticky:!1,allowUnsafeHTML:!1}});else if(e&&e.error)if((e.error.match(/\n/g)||[]).length>=2){for(var c=e.error.split("\n"),r=[],d=2;d<c.length;d++)r.push(c[d]);r=r.join("<br/>"),t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:c[0],subtitle:c[1],message:r,sticky:!1,allowUnsafeHTML:!0}})}else t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:l.get("YouCannotUpdateX",{typeNLS:"Document"}),subtitle:e.error,message:"",sticky:!1,allowUnsafeHTML:!1}});else t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:l.get("YouCannotUpdateX",{typeNLS:"Document"}),subtitle:e,message:"",sticky:!1,allowUnsafeHTML:!1}});console.error("Document Update Failed Due to:"),console.error(e)},s.onProgress=function(e){m.update(e)},s.onComplete=function(o){var r=new Date-m.fileUploadStart;a.sendTrackerPageEvent({category:"docm.file.upload.complete",action:"click",label:"File Upload Done",pd:{parentId:void 0,parentRelName:void 0,securityContext:s.securityContext,docType:n.type,fileType:i.getFileExtension(n.name),filesize:n.size},pv:{totalTimeTaken:r,success:1}}),t.options.getJobsProcessorPromise.then(function(e){e.finishJob(m)}),t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:l.get("Fileuploadsuccessful"),subtitle:e.String.format(l.get("FileuploadsuccessfulMsg"),""),message:"",sticky:!1,allowUnsafeHTML:!1}}),t.options.events.publish({event:"enox-docfiles-upload-complete",data:{parentId:c,files:o.data[0].relateddata.files}}),require(["DS/PlatformAPI/PlatformAPI"],function(e){e.publish("docm-file-added-to-document",{platformId:t.options.platformUrls.platformId,documentId:c,newFiles:o.data[0].relateddata.files})})};var d={file:n};n.name&&(d.fileName=n.name,d.newFile=!0);var u={id:c,fileInfo:d},m={title:l.get("UPLOADING_X",{title:n.name}),ui:!!u.fileInfo,process:function(){m.fileUploadStart=new Date,m.xhr=o.modifyDocument(u,s)}};t.options.getJobsProcessorPromise.then(function(e){e.addJob(m)})}(t.files[n])}}return c.execute=function(e){c.selectFiles(e)},c.selectFiles=function(t){if(null==t.files){var o=e.createElement("input",{attributes:{id:"btnUpload_chooser",type:"file",multiple:!1},styles:{display:"none"},events:{change:function(e){(e.target&&e.target.files&&e.target.files.length>0||e.dataTransfer&&e.dataTransfer.files)&&(t.files=e.target&&e.target.files&&e.target.files.length>0?e.target.files:e.dataTransfer.files,0==t.files&&(t.files=e.detail.files),d(t)),o.destroy()}}}).inject(t.options.widget.body);o.click()}else d(t)},c.uploadFile=function(e){},c}),define("DS/DocumentCommands/V2/FileActions/Unlock",["UWA/Core","DS/DocumentCommands/V2/FileActions/UndoEdit","DS/WAFData/WAFData","DS/DocumentCommands/Helper","DS/DocumentCommonInfra/TrackerAPI","i18n!DS/DocumentCommands/assets/nls/DocumentCommands","css!DS/DocumentCommands/DocumentCommands.css"],function(e,t,o,n,i,a){"use strict";var s=function(e){return{id:"Unlock",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"lock-open",fontIconFamily:1},label:a.get("Unlock"),tooltip:a.get("Unlock"),position:"far",category:"edit",value:function(t){t.options=e,s.execute(t)},visibleFlag:!1},execute:function(){s.execute({options:e})},updateForSelection:function(t,o){return n.AuthoringFilesCommandVisibiltyPromise(e,this.id,t)}}};return s.execute=function(t){var s=t.options.getParentDocument(),l=t.options.getSelectedNodes();if(1==l.length){var c=new Date,r=l[0],d=t.options.getDocumentFromNodeModel(r),u=void 0;if(d)null==(u=d.title||d.name)&&d.dataelements&&(u=d.dataelements.title||d.dataelements.name),""!=d.dataelements.locker?o.authenticatedRequest(t.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",url_temp:t.options.platformUrls["3DSpace"],onComplete:function(l){var m=new Date-c;i.sendTrackerPageEvent({category:"docm.command.unlock",action:"click",label:"Document Unlock",pd:{docType:d.type,docId:d.id,source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:m,success:1}});var p={};p.tenant=t.options.platformUrls.platformId,p.securityContext=t.options.fetchSecurityContext(),p.tenantUrl=t.options.platformUrls["3DSpace"],p.onComplete=function(o){t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:a.get("FileUnlocked"),subtitle:e.String.format(a.get("FileXUnlocked"),u),message:"",sticky:!1,allowUnsafeHTML:!1}}),t.options.events&&(t.options.events.publish({event:"enox-docfiles-unlock-complete",data:{nodeModel:r,fileId:d.id}}),n.getFile(t.options,s,d.id).then(function(e){require(["DS/PlatformAPI/PlatformAPI"],function(o){o.publish("docm-file-unlocked-in-document",{platformId:t.options.platformUrls.platformId,documentId:s,file:e})})}))},p.onFailure=function(e,o){t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:o.error,message:"",sticky:!1,allowUnsafeHTML:!1}})};var f=p.tenantUrl+"/resources/v1/modeler/documents/"+s+"/files/"+d.id+"/unlock";p.type="json",p.url=f,p.data=JSON.stringify({csrf:JSON.parse(l).csrf}),p.headers=p.headers||{Accept:"*/*","Content-Type":"application/ds-json"},p.method="POST",o.authenticatedRequest(f,p)},onFailure:function(e,o){var n=new Date-c;i.sendTrackerPageEvent({category:"docm.command.unlock",action:"click",label:"Document Unlock",pd:{docType:d.type,docId:d.id,source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:n,failure:0}}),t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:o.error,message:"",sticky:!1,allowUnsafeHTML:!1}})}}):t.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:a.get("FileUnlocked"),subtitle:e.String.format(a.get("FileXAlreadyUnlocked"),u),message:"",sticky:!1,allowUnsafeHTML:!1}})}else l.forEach(l=>{var c=t.options.getDocumentFromNodeModel(l),r=void 0;if(c&&null==(r=c.title||c.name)&&c.dataelements&&(r=c.dataelements.title||c.dataelements.name),""!=c.dataelements.locker){var d={title:e.String.format(a.get("LOCKING_X"),r),ui:!1,process:function(){var u=new Date;o.authenticatedRequest(t.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",url_temp:t.options.platformUrls["3DSpace"],onComplete:function(m){var p={};p.tenant=t.options.platformUrls.platformId,p.securityContext=t.options.fetchSecurityContext(),p.tenantUrl=t.options.platformUrls["3DSpace"],p.onComplete=function(o){var m=new Date-u;i.sendTrackerPageEvent({category:"docm.command.unlock",action:"click",label:"Document Unlock",pd:{docType:c.type,docId:c.id,source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:m,success:1}}),t.options.getJobsProcessorPromise.then(function(e){e.finishJob(d)}),t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:a.get("FileUnlocked"),subtitle:e.String.format(a.get("FileXUnlocked"),r),message:"",sticky:!1,allowUnsafeHTML:!1}}),t.options.events&&(t.options.events.publish({event:"enox-docfiles-unlock-complete",data:{nodeModel:l,fileId:c.id}}),n.getFile(t.options,s,c.id).then(function(e){require(["DS/PlatformAPI/PlatformAPI"],function(o){o.publish("docm-file-unlocked-in-document",{platformId:t.options.platformUrls.platformId,documentId:s,file:e})})}))},p.onFailure=function(e,o){var n=new Date-u;i.sendTrackerPageEvent({category:"docm.command.unlock",action:"click",label:"Document Unlock",pd:{docType:c.type,docId:c.id,source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:n,failure:0}}),t.options.getJobsProcessorPromise.then(function(e){e.finishJob(d,"failed")}),t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:o.error,message:"",sticky:!1,allowUnsafeHTML:!1}})};var f=p.tenantUrl+"/resources/v1/modeler/documents/"+s+"/files/"+c.id+"/unlock";p.type="json",p.url=f,p.data=JSON.stringify({csrf:JSON.parse(m).csrf}),p.headers=p.headers||{Accept:"*/*","Content-Type":"application/ds-json"},p.method="POST",o.authenticatedRequest(f,p)},onFailure:function(e,o){var n=new Date-u;i.sendTrackerPageEvent({category:"docm.command.unlock",action:"click",label:"Document Unlock",pd:{docType:c.type,docId:c.id,source:t.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:n,failure:0}}),t.options.getJobsProcessorPromise.then(function(e){e.finishJob(d,"failed")}),t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:o.error,message:"",sticky:!1,allowUnsafeHTML:!1}})}})}};t.options.getJobsProcessorPromise.then(function(e){e.addJob(d)})}else t.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:a.get("FileUnlocked"),subtitle:e.String.format(a.get("FileXAlreadyUnlocked"),r),message:"",sticky:!1,allowUnsafeHTML:!1}})})},s}),define("DS/DocumentCommands/V2/FileActions/Edit",["DS/DocumentCommands/V2/FileActions/LockAndDownload","DS/DocumentCommands/Helper","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o){"use strict";var n=function(e){return{id:"Edit",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"pencil",fontIconFamily:1},label:o.get("Edit"),tooltip:o.get("Edit"),position:"far",category:"edit",value:function(t){t.options=e,n.execute(t)},visibleFlag:!1},execute:function(){n.execute({options:e})},updateForSelection:function(o,n){return t.AuthoringFilesCommandVisibiltyPromise(e,this.id,o)}}};return n.execute=function(t){e.executeLockAndDownload(t)},n}),define("DS/DocumentCommands/V2/Actions/Update",["DS/DocumentCommands/Helper","DS/DocumentCommands/V2/Actions/UpdateAndUnlock","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o){"use strict";var n=function(t){return{id:"Update",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"update",fontIconFamily:1},label:o.get("Update"),tooltip:o.get("Update"),position:"far",category:"edit",value:function(e){e.options=t,n.execute(e)},visibleFlag:!1},execute:function(){n.execute({options:t})},updateForSelection:function(o,n){return e.AuthoringCommandVisibiltyPromise(t,this.id,o)}}};return n.execute=function(e){t.executeUpdate(e)},n}),define("DS/DocumentCommands/V2/FileActions/FileIterations",["UWA/Core","UWA/Promise","DS/DocumentManagement/DocumentManagement","DS/WAFData/WAFData","DS/DocumentCommands/Resources","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o,n,i,a){"use strict";var s=function(e){return{id:"FileIterations",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"database-history wux-ui-3ds",fontIconFamily:1},label:a.get("FileIterations"),tooltip:a.get("FileIterations"),position:"far",category:"lifecycle",value:function(t){t.options=e,s.execute(t)},visibleFlag:!1},execute:function(){s.execute({options:e})},updateForSelection:function(o,n){return new t(function(t){o({visibleFlag:1==e.getSelectedNodes().length}),t(!0)})}}};return s.execute=function(t){require(["DS/LifecycleCmd/IterationsCmd"],function(o){if(1==t.options.getSelectedNodes().length)var n={securitycontext:t.options.fetchSecurityContext(),context:{getUUID:function(){return t.options.getOrigin?JSON.stringify(e.extend(t.options.getOrigin(),{action:"new-fileiteration"})):"docv2.new-fileiteration."+Date.now()}}};o=new o(n);var i=[{physicalid:t.options.getSelectedNodes()[0].options.data.id,tenant:t.options.platformUrls.platformId,type:t.options.getSelectedNodes()[0].options.data.type,displayName:t.options.getSelectedNodes()[0].options.title}];o.execute(i)})},s}),define("DS/DocumentCommands/V2/Actions/Lock",["UWA/Core","DS/WAFData/WAFData","DS/DocumentCommands/Helper","DS/DocumentCommonInfra/TrackerAPI","i18n!DS/DocumentCommands/assets/nls/DocumentCommands","css!DS/DocumentCommands/DocumentCommands.css"],function(e,t,o,n,i){"use strict";var a=function(e){return{id:"Lock",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"lock",fontIconFamily:1},label:i.get("Lock"),tooltip:i.get("Lock"),position:"far",category:"edit",value:function(t){t.options=e,a.execute(t)},visibleFlag:!1},execute:function(){a.execute({options:e})},updateForSelection:function(t,n){return o.AuthoringCommandVisibiltyPromise(e,this.id,t)}}};return a.execute=function(a){var s=a.options.getSelectedNodes();if(1==s.length){var l=new Date,c=s[0],r=a.options.getDocumentFromNodeModel(c),d=[];r.files?d=r.files:r.relateddata&&r.relateddata.files&&(d=r.relateddata.files);var u=void 0;if(r&&null==(u=r.title||r.name)&&r.dataelements&&(u=r.dataelements.title||r.dataelements.name),1==d.length)""!=d[0].dataelements.locker?a.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:i.get("DocumentLocked"),subtitle:e.String.format(i.get("FileInXAlreadyLocked"),u),message:"",sticky:!1,allowUnsafeHTML:!1}}):t.authenticatedRequest(a.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",url_temp:a.options.platformUrls["3DSpace"],onComplete:function(s){var m=new Date-l;n.sendTrackerPageEvent({category:"docm.command.lock",action:"click",label:"Document lock",pd:{docType:r.type,docId:r.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:m,success:1}});var p={};p.tenant=a.options.platformUrls.platformId,p.securityContext=a.options.fetchSecurityContext(),p.tenantUrl=a.options.platformUrls["3DSpace"],p.onComplete=function(t){a.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:i.get("DocumentLocked"),subtitle:e.String.format(i.get("FileInXLocked"),u),message:"",sticky:!1,allowUnsafeHTML:!1}}),a.options.events&&(a.options.events.publish({event:"docv2-lock-complete",data:{nodeModel:c}}),o.getFile(a.options,r.id,d[0].id).then(function(e){require(["DS/PlatformAPI/PlatformAPI"],function(t){t.publish("docm-file-locked-in-document",{platformId:a.options.platformUrls.platformId,documentId:r.id,file:e})})}))},p.onFailure=function(t,n){o.fetchCurrentUser().then(t=>{n&&e.is(n.internalError,"string")&&n.internalError.includes("Business object locked by '"+t.id+"'")?a.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:i.get("DocumentLocked"),subtitle:e.String.format(i.get("FileInXAlreadyLocked"),u),message:"",sticky:!1,allowUnsafeHTML:!1}}):a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:n.error,message:"",sticky:!1,allowUnsafeHTML:!1}})}).catch(e=>{a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:n.error,message:"",sticky:!1,allowUnsafeHTML:!1}})})};var f=p.tenantUrl+"/resources/v1/modeler/documents/"+r.id+"/lock";p.type="json",p.url=f,p.data=JSON.stringify({csrf:JSON.parse(s).csrf}),p.headers=p.headers||{Accept:"*/*","Content-Type":"application/ds-json"},p.method="POST",t.authenticatedRequest(f,p)},onFailure:function(e,t){var o=new Date-l;n.sendTrackerPageEvent({category:"docm.command.lock",action:"click",label:"Document lock",pd:{docType:r.type,docId:r.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:o,failure:0}}),a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:t.error,message:"",sticky:!1,allowUnsafeHTML:!1}})}})}else s.forEach(s=>{var l=a.options.getDocumentFromNodeModel(s),c=[];l.files?c=l.files:l.relateddata&&l.relateddata.files&&(c=l.relateddata.files);var r=void 0;if(l&&null==(r=l.title||l.name)&&l.dataelements&&(r=l.dataelements.title||l.dataelements.name),1==c.length)if(""!=c[0].dataelements.locker)a.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:i.get("DocumentLocked"),subtitle:e.String.format(i.get("FileInXAlreadyLocked"),r),message:"",sticky:!1,allowUnsafeHTML:!1}});else{var d={title:e.String.format(i.get("LOCKING_X"),r),ui:!0,process:function(){var u=new Date;t.authenticatedRequest(a.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",url_temp:a.options.platformUrls["3DSpace"],onComplete:function(m){d.update({loaded:.5,total:1});var p={};p.tenant=a.options.platformUrls.platformId,p.securityContext=a.options.fetchSecurityContext(),p.tenantUrl=a.options.platformUrls["3DSpace"],p.onComplete=function(t){var m=new Date-u;n.sendTrackerPageEvent({category:"docm.command.lock",action:"click",label:"Document lock",pd:{docType:l.type,docId:l.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:m,success:1}}),a.options.getJobsProcessorPromise.then(function(e){e.finishJob(d)}),a.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:i.get("DocumentLocked"),subtitle:e.String.format(i.get("FileInXLocked"),r),message:"",sticky:!1,allowUnsafeHTML:!1}}),a.options.events&&(a.options.events.publish({event:"docv2-lock-complete",data:{nodeModel:s}}),o.getFile(a.options,l.id,c[0].id).then(function(e){require(["DS/PlatformAPI/PlatformAPI"],function(t){t.publish("docm-file-locked-in-document",{platformId:a.options.platformUrls.platformId,documentId:l.id,file:e})})}))},p.onFailure=function(t,s){var c=new Date-u;n.sendTrackerPageEvent({category:"docm.command.lock",action:"click",label:"Document lock",pd:{docType:l.type,docId:l.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:c,failure:0}}),a.options.getJobsProcessorPromise.then(function(e){e.finishJob(d,"failed")}),o.fetchCurrentUser().then(t=>{s&&e.is(s.internalError,"string")&&s.internalError.includes("Business object locked by '"+t.id+"'")?a.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:i.get("DocumentLocked"),subtitle:e.String.format(i.get("FileInXAlreadyLocked"),r),message:"",sticky:!1,allowUnsafeHTML:!1}}):a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:s.error,message:"",sticky:!1,allowUnsafeHTML:!1}})}).catch(e=>{a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:s.error,message:"",sticky:!1,allowUnsafeHTML:!1}})})};var f=p.tenantUrl+"/resources/v1/modeler/documents/"+l.id+"/lock";p.type="json",p.url=f,p.data=JSON.stringify({csrf:JSON.parse(m).csrf}),p.headers=p.headers||{Accept:"*/*","Content-Type":"application/ds-json"},p.method="POST",t.authenticatedRequest(f,p)},onFailure:function(e,t){a.options.getJobsProcessorPromise.then(function(e){e.finishJob(d,"failed")}),a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:t.error,message:"",sticky:!1,allowUnsafeHTML:!1}})}})}};a.options.getJobsProcessorPromise.then(function(e){e.addJob(d)})}else 0==c.length?a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:i.get("objectcontainsnofile"),message:"",sticky:!1,allowUnsafeHTML:!1}}):a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:i.get("Nomultifilesupport"),message:"",sticky:!1,allowUnsafeHTML:!1}})})},a}),define("DS/DocumentCommands/V2/Actions/UndoEdit",["UWA/Core","DS/WAFData/WAFData","DS/DocumentCommands/Helper","i18n!DS/DocumentCommands/assets/nls/DocumentCommands","css!DS/DocumentCommands/DocumentCommands.css"],function(e,t,o,n){"use strict";var i=function(e){return{id:"UndoEdit",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"pencil-block",fontIconFamily:1},label:n.get("UndoEdit"),tooltip:n.get("UndoEdit"),position:"far",category:"edit",value:function(t){t.options=e,i.execute(t)},visibleFlag:!1},execute:function(){i.execute({options:e})},updateForSelection:function(t,n){return o.AuthoringCommandVisibiltyPromise(e,this.id,t)}}};return i.execute=function(i){var a=i.options.getSelectedNodes()[0],s=i.options.getDocumentFromNodeModel(a),l=[];s.files?l=s.files:s.relateddata&&s.relateddata.files&&(l=s.relateddata.files);var c=void 0;s&&null==(c=s.title||s.name)&&s.dataelements&&(c=s.dataelements.title||s.dataelements.name),1==l.length?t.authenticatedRequest(i.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",url_temp:i.options.platformUrls["3DSpace"],onComplete:function(r){var d={};d.tenant=i.options.platformUrls.platformId,d.securityContext=i.options.fetchSecurityContext(),d.tenantUrl=i.options.platformUrls["3DSpace"],d.onComplete=function(t){i.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:"",subtitle:e.String.format(n.get("Editoperationcancelled"),c),message:"",sticky:!1,allowUnsafeHTML:!1}}),i.options.events&&(i.options.events.publish({event:"docv2-undoedit-complete",data:{nodeModel:a}}),o.getFile(i.options,s.id,l[0].id).then(function(e){require(["DS/PlatformAPI/PlatformAPI"],function(t){t.publish("docm-file-undoedited-in-document",{platformId:i.options.platformUrls.platformId,documentId:s.id,file:e})})}))},d.onFailure=function(e,t){i.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:t.error,message:"",sticky:!1,allowUnsafeHTML:!1}})};var u=d.tenantUrl+"/resources/v1/modeler/documents/"+s.id+"/unlock";d.type="json",d.url=u,d.data=JSON.stringify({csrf:JSON.parse(r).csrf}),d.headers=d.headers||{Accept:"*/*","Content-Type":"application/ds-json"},d.method="POST",t.authenticatedRequest(u,d)}}):0==l.length?i.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:n.get("objectcontainsnofile"),message:"",sticky:!1,allowUnsafeHTML:!1}}):i.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:n.get("Nomultifilesupport"),message:"",sticky:!1,allowUnsafeHTML:!1}})},i}),define("DS/DocumentCommands/V2/Actions/Unlock",["UWA/Core","DS/WAFData/WAFData","DS/DocumentCommands/Helper","DS/DocumentCommonInfra/TrackerAPI","i18n!DS/DocumentCommands/assets/nls/DocumentCommands","css!DS/DocumentCommands/DocumentCommands.css"],function(e,t,o,n,i){"use strict";var a=function(e){return{id:"Unlock",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"lock-open",fontIconFamily:1},label:i.get("Unlock"),tooltip:i.get("Unlock"),position:"far",category:"edit",value:function(t){t.options=e,a.execute(t)},visibleFlag:!1},execute:function(){a.execute({options:e})},updateForSelection:function(t,n){return o.AuthoringCommandVisibiltyPromise(e,this.id,t)}}};return a.execute=function(a){var s=a.options.getSelectedNodes();if(1==s.length){var l=new Date,c=s[0],r=a.options.getDocumentFromNodeModel(c),d=[];r.files?d=r.files:r.relateddata&&r.relateddata.files&&(d=r.relateddata.files);var u=void 0;if(r&&null==(u=r.title||r.name)&&r.dataelements&&(u=r.dataelements.title||r.dataelements.name),1==d.length)""!=d[0].dataelements.locker?t.authenticatedRequest(a.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",url_temp:a.options.platformUrls["3DSpace"],onComplete:function(s){var m=new Date-l;n.sendTrackerPageEvent({category:"docm.command.unlock",action:"click",label:"Document Unlock",pd:{docType:r.type,docId:r.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:m,success:1}});var p={};p.tenant=a.options.platformUrls.platformId,p.securityContext=a.options.fetchSecurityContext(),p.tenantUrl=a.options.platformUrls["3DSpace"],p.onComplete=function(t){a.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:i.get("DocumentUnlocked"),subtitle:e.String.format(i.get("FileInXUnlocked"),u),message:"",sticky:!1,allowUnsafeHTML:!1}}),a.options.events&&(a.options.events.publish({event:"docv2-undoedit-complete",data:{nodeModel:c}}),o.getFile(a.options,r.id,d[0].id).then(function(e){require(["DS/PlatformAPI/PlatformAPI"],function(t){t.publish("docm-file-undoedited-in-document",{platformId:a.options.platformUrls.platformId,documentId:r.id,file:e})})}))},p.onFailure=function(e,t){a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:t.error,message:"",sticky:!1,allowUnsafeHTML:!1}})};var f=p.tenantUrl+"/resources/v1/modeler/documents/"+r.id+"/unlock";p.type="json",p.url=f,p.data=JSON.stringify({csrf:JSON.parse(s).csrf}),p.headers=p.headers||{Accept:"*/*","Content-Type":"application/ds-json"},p.method="POST",t.authenticatedRequest(f,p)},onFailure:function(e,t){var o=new Date-l;n.sendTrackerPageEvent({category:"docm.command.unlock",action:"click",label:"Document Unlock",pd:{docType:r.type,docId:r.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:o,failure:0}}),a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:t.error,message:"",sticky:!1,allowUnsafeHTML:!1}})}}):a.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:i.get("DocumentUnlocked"),subtitle:e.String.format(i.get("FileInXAlreadyUnocked"),u),message:"",sticky:!1,allowUnsafeHTML:!1}});else 0==d.length?a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:i.get("objectcontainsnofile"),message:"",sticky:!1,allowUnsafeHTML:!1}}):a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:i.get("Nomultifilesupport"),message:"",sticky:!1,allowUnsafeHTML:!1}})}else s.forEach(s=>{var l=a.options.getDocumentFromNodeModel(s),c=[];l.files?c=l.files:l.relateddata&&l.relateddata.files&&(c=l.relateddata.files);var r=void 0;if(l&&null==(r=l.title||l.name)&&l.dataelements&&(r=l.dataelements.title||l.dataelements.name),1==c.length)if(""!=c[0].dataelements.locker){var d={title:e.String.format(i.get("UNLOCKING_X"),r),ui:!0,process:function(){var u=new Date;t.authenticatedRequest(a.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",url_temp:a.options.platformUrls["3DSpace"],onComplete:function(m){d.update({loaded:.5,total:1});var p={};p.tenant=a.options.platformUrls.platformId,p.securityContext=a.options.fetchSecurityContext(),p.tenantUrl=a.options.platformUrls["3DSpace"],p.onComplete=function(t){var m=new Date-u;n.sendTrackerPageEvent({category:"docm.command.unlock",action:"click",label:"Document Unlock",pd:{docType:l.type,docId:l.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:m,success:1}}),a.options.getJobsProcessorPromise.then(function(e){e.finishJob(d)}),a.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:i.get("DocumentUnlocked"),subtitle:e.String.format(i.get("FileInXUnlocked"),r),message:"",sticky:!1,allowUnsafeHTML:!1}}),a.options.events&&(a.options.events.publish({event:"docv2-undoedit-complete",data:{nodeModel:s}}),o.getFile(a.options,l.id,c[0].id).then(function(e){require(["DS/PlatformAPI/PlatformAPI"],function(t){t.publish("docm-file-undoedited-in-document",{platformId:a.options.platformUrls.platformId,documentId:l.id,file:e})})}))},p.onFailure=function(e,t){var o=new Date-u;n.sendTrackerPageEvent({category:"docm.command.unlock",action:"click",label:"Document Unlock",pd:{docType:l.type,docId:l.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:o,failure:0}}),a.options.getJobsProcessorPromise.then(function(e){e.finishJob(d,"failed")}),a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:t.error,message:"",sticky:!1,allowUnsafeHTML:!1}})};var f=p.tenantUrl+"/resources/v1/modeler/documents/"+l.id+"/unlock";p.type="json",p.url=f,p.data=JSON.stringify({csrf:JSON.parse(m).csrf}),p.headers=p.headers||{Accept:"*/*","Content-Type":"application/ds-json"},p.method="POST",t.authenticatedRequest(f,p)},onFailure:function(e,t){var o=new Date-u;n.sendTrackerPageEvent({category:"docm.command.unlock",action:"click",label:"Document Unlock",pd:{docType:l.type,docId:l.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:o,failure:0}}),a.options.getJobsProcessorPromise.then(function(e){e.finishJob(d,"failed")}),a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:t.error,message:"",sticky:!1,allowUnsafeHTML:!1}})}})}};a.options.getJobsProcessorPromise.then(function(e){e.addJob(d)})}else a.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:i.get("DocumentUnlocked"),subtitle:e.String.format(i.get("FileInXAlreadyUnlocked"),r),message:"",sticky:!1,allowUnsafeHTML:!1}});else 0==c.length?a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:i.get("objectcontainsnofile"),message:"",sticky:!1,allowUnsafeHTML:!1}}):a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:i.get("Nomultifilesupport"),message:"",sticky:!1,allowUnsafeHTML:!1}})})},a}),define("DS/DocumentCommands/V2/FileActions/Update",["DS/DocumentCommands/Helper","DS/DocumentCommands/V2/FileActions/UpdateAndUnlock","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o){"use strict";var n=function(t){return{id:"Update",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"update",fontIconFamily:1},label:o.get("Update"),tooltip:o.get("Update"),position:"far",category:"edit",value:function(e){e.options=t,n.execute(e)},visibleFlag:!1},execute:function(){n.execute({options:t})},updateForSelection:function(o,n){return e.AuthoringFilesCommandVisibiltyPromise(t,this.id,o)}}};return n.execute=function(e){t.executeUpdate(e)},n}),define("DS/DocumentCommands/V2/Actions/OfficeWebEdition",["DS/PlatformAPI/PlatformAPI","DS/DocumentManagement/DocumentManagement","DS/DocumentCommands/Helper","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o,n){"use strict";var i=function(e){return{id:"OfficeWebEdition",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"pencil",fontIconFamily:1},label:n.get("OfficeWebEdition"),tooltip:n.get("OfficeWebEdition"),position:"far",category:"edit",value:function(t){t.options=e,i.execute(t)},visibleFlag:!1,priority:10},execute:function(){i.execute({options:e})},updateForSelection:function(t,n){if(!window.dscef){return o.AuthoringCommandVisibiltyPromise(e,this.id,t)}t({visibleFlag:!1})}}};return i.execute=function(o){var i=o.options.getSelectedNodes()[0],a=o.options.getDocumentFromNodeModel(i);t.getDocuments([a.id],{files:[],tenant:o.options.platformUrls.platformId,securityContext:o.options.securityContext,tenantUrl:o.options.platformUrls["3DSpace"],onComplete:function(t){var s=this;if(t.success){if(!Array.isArray(t.data))return void console.error("no data received in DocumentManagement.getDocuments");if((a=t.data[0]).relateddata&&a.relateddata.files?s.files=a.relateddata.files:a.files&&(s.files=a.files),1==s.files.length){let t=e.getUser().login;var l;if(""!=s.files[0].dataelements.locker&&s.files[0].dataelements.locker!=t)s.files[0].relateddata.lockerInfo&&s.files[0].relateddata.lockerInfo.length>0&&(l=s.files[0].relateddata.lockerInfo[0].dataelements.firstname+" "+s.files[0].relateddata.lockerInfo[0].dataelements.lastname),o.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:n.get("DocumentEditNotAllowed"),subtitle:l+" "+n.get("DocumentLockedBySomeone"),message:"",sticky:!1,allowUnsafeHTML:!1}});else{if(!o.options.getDocumentFromNodeModel(i))throw"e6wDocument cannot be loaded from nodeModel";!function(e){require(["DS/DocumentWebEdition/OfficeWebEditorComponent"],function(t){o.options.widget.officeWebEditorComponent=new t({title:o.options.getDocumentFromNodeModel(e).dataelements.title,icon:o.options.getDocumentFromNodeModel(e).typeicon||o.options.getDocumentFromNodeModel(e).dataelements.indexedTypeicon||o.options.getDocumentFromNodeModel(e).dataelements.typeicon,file:s.files[0],documentId:o.options.getDocumentFromNodeModel(e).id,platformUrls:o.options.platformUrls,modelEvents:o.options.events,tenant:o.options.platformUrls.platformId,securityContext:o.options.fetchSecurityContext(),nodeModel:e,actionIntiatedAt:"document"}),o.options.widget.officeWebEditorComponent.loaded=function(e){},o.options.widget.officeWebEditorComponent.elements.container.setStyles({background:"white",width:"100%",height:"100%"}),o.options.widget.officeWebEditorComponent.close=function(){o.options.widget.officeWebEditorComponent&&(o.options.widget.officeWebEditorComponent.destroy(),o.options.widget.officeWebEditorComponent=void 0)},o.options.widget.officeWebEditorComponent.inject(o.options.widget.body)})}(i)}}}}})},i}),define("DS/DocumentCommands/V2/FileActions/Lock",["UWA/Core","DS/WAFData/WAFData","DS/DocumentCommands/Helper","DS/DocumentCommonInfra/TrackerAPI","i18n!DS/DocumentCommands/assets/nls/DocumentCommands","css!DS/DocumentCommands/DocumentCommands.css"],function(e,t,o,n,i){"use strict";var a=function(e){return{id:"Lock",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"lock",fontIconFamily:1},label:i.get("Lock"),tooltip:i.get("Lock"),position:"far",category:"edit",value:function(t){t.options=e,a.execute(t)},visibleFlag:!1},execute:function(){a.execute({options:e})},updateForSelection:function(t,n){return o.AuthoringFilesCommandVisibiltyPromise(e,this.id,t)}}};return a.execute=function(t){var n=t.options.getParentDocument(),s=t.options.platformUrls.platformId,l=t.options.getSelectedNodes();if(1==l.length){var c=l[0],r=t.options.getDocumentFromNodeModel(c),d="docm_"+r.dataelements.name.replace(/[!^@&\/\\#, +()$~%.'":*?<>{}]/g,"_"),u=void 0;if(r)if(null==(u=r.title||r.name)&&r.dataelements&&(u=r.dataelements.title||r.dataelements.name),""!=r.dataelements.locker)t.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:i.get("FileLocked"),subtitle:e.String.format(i.get("FileXAlreadyLocked"),u),message:"",sticky:!1,allowUnsafeHTML:!1}});else if("OnPremise"!=s)o.IsWebEditionDocumentSessionActive(s,d).then(o=>{o&&o.opened?t.options.events.publish({event:"docv2-show-notification",data:{level:"warning",title:"",subtitle:e.String.format(i.get("EditErrorMessageWebEditionSessionActiveOnFileFacet"),u),message:"",sticky:!1,allowUnsafeHTML:!0}}):a.executeSingleLock(t,r,n,u,c)}).catch(e=>{console.error("Error in state promise in File->Lock action"),a.executeSingleLock(t,r,n,u,c)});else a.executeSingleLock(t,r,n,u,c)}else l.forEach(l=>{var c=t.options.getDocumentFromNodeModel(l),r="docm_"+c.dataelements.name.replace(/[!^@&\/\\#, +()$~%.'":*?<>{}]/g,"_"),d=void 0;if(c&&null==(d=c.title||c.name)&&c.dataelements&&(d=c.dataelements.title||c.dataelements.name),""!=c.dataelements.locker)t.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:i.get("FileLocked"),subtitle:e.String.format(i.get("FileXAlreadyLocked"),d),message:"",sticky:!1,allowUnsafeHTML:!1}});else{var u={title:e.String.format(i.get("LOCKING_X"),d),ui:!1,process:function(){"OnPremise"!=s?o.IsWebEditionDocumentSessionActive(s,r).then(o=>{o&&o.opened?(t.options.getJobsProcessorPromise.then(function(e){e.finishJob(u)}),t.options.events.publish({event:"docv2-show-notification",data:{level:"warning",title:"",subtitle:e.String.format(i.get("EditErrorMessageWebEditionSessionActiveOnFileFacet"),d),message:"",sticky:!1,allowUnsafeHTML:!0}})):a.executeMultipleLock(t,c,n,d,l,u)}).catch(e=>{console.error("Error in state promise in File->Lock action in multiselection flow"),a.executeMultipleLock(t,c,n,d,l,u)}):a.executeMultipleLock(t,c,n,d,l,u)}};t.options.getJobsProcessorPromise.then(function(e){e.addJob(u)})}})},a.executeSingleLock=function(a,s,l,c,r){var d=new Date;t.authenticatedRequest(a.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",url_temp:a.options.platformUrls["3DSpace"],onComplete:function(u){var m=new Date-d;n.sendTrackerPageEvent({category:"docm.command.lock",action:"click",label:"Document lock",pd:{docType:s.type,docId:s.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:m,success:1}});var p={};p.tenant=a.options.platformUrls.platformId,p.securityContext=a.options.fetchSecurityContext(),p.tenantUrl=a.options.platformUrls["3DSpace"],p.onComplete=function(t){a.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:i.get("FileLocked"),subtitle:e.String.format(i.get("FileXLocked"),c),message:"",sticky:!1,allowUnsafeHTML:!1}}),a.options.events&&(a.options.events.publish({event:"enox-docfiles-lock-complete",data:{nodeModel:r,fileId:s.id}}),o.getFile(a.options,l,s.id).then(function(e){require(["DS/PlatformAPI/PlatformAPI"],function(t){t.publish("docm-file-locked-in-document",{platformId:a.options.platformUrls.platformId,documentId:l,file:e})})}))},p.onFailure=function(t,n){o.fetchCurrentUser().then(t=>{n&&e.is(n.internalError,"string")&&n.internalError.includes("Business object locked by '"+t.id+"'")?a.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:i.get("FileLocked"),subtitle:e.String.format(i.get("FileXAlreadyLocked"),c),message:"",sticky:!1,allowUnsafeHTML:!1}}):a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:n.error,message:"",sticky:!1,allowUnsafeHTML:!1}})}).catch(e=>{a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:n.error,message:"",sticky:!1,allowUnsafeHTML:!1}})})};var f=p.tenantUrl+"/resources/v1/modeler/documents/"+l+"/files/"+s.id+"/lock";p.type="json",p.url=f,p.data=JSON.stringify({csrf:JSON.parse(u).csrf}),p.headers=p.headers||{Accept:"*/*","Content-Type":"application/ds-json"},p.method="POST",t.authenticatedRequest(f,p)},onFailure:function(e,t){var o=new Date-d;n.sendTrackerPageEvent({category:"docm.command.lock",action:"click",label:"Document lock",pd:{docType:s.type,docId:s.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:o,failure:0}}),a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:t.error,message:"",sticky:!1,allowUnsafeHTML:!1}})}})},a.executeMultipleLock=function(a,s,l,c,r,d){var u=new Date;t.authenticatedRequest(a.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",url_temp:a.options.platformUrls["3DSpace"],onComplete:function(m){var p={};p.tenant=a.options.platformUrls.platformId,p.securityContext=a.options.fetchSecurityContext(),p.tenantUrl=a.options.platformUrls["3DSpace"],p.onComplete=function(t){var m=new Date-u;n.sendTrackerPageEvent({category:"docm.command.lock",action:"click",label:"Document lock",pd:{docType:s.type,docId:s.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:m,success:1}}),a.options.getJobsProcessorPromise.then(function(e){e.finishJob(d)}),a.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:i.get("FileLocked"),subtitle:e.String.format(i.get("FileXLocked"),c),message:"",sticky:!1,allowUnsafeHTML:!1}}),a.options.events&&(a.options.events.publish({event:"enox-docfiles-lock-complete",data:{nodeModel:r,fileId:s.id}}),o.getFile(a.options,l,s.id).then(function(e){require(["DS/PlatformAPI/PlatformAPI"],function(t){t.publish("docm-file-locked-in-document",{platformId:a.options.platformUrls.platformId,documentId:l,file:e})})}))},p.onFailure=function(t,l){var r=new Date-u;n.sendTrackerPageEvent({category:"docm.command.lock",action:"click",label:"Document lock",pd:{docType:s.type,docId:s.id,source:a.options.getSourceForUsageAnalytics()},pv:{totalTimeTaken:r,failure:0}}),a.options.getJobsProcessorPromise.then(function(e){e.finishJob(d,"failed")}),o.fetchCurrentUser().then(t=>{l&&e.is(l.internalError,"string")&&l.internalError.includes("Business object locked by '"+t.id+"'")?a.options.events.publish({event:"docv2-show-notification",data:{level:"info",title:i.get("FileLocked"),subtitle:e.String.format(i.get("FileXAlreadyLocked"),c),message:"",sticky:!1,allowUnsafeHTML:!1}}):a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:l.error,message:"",sticky:!1,allowUnsafeHTML:!1}})}).catch(e=>{a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:l.error,message:"",sticky:!1,allowUnsafeHTML:!1}})})};var f=p.tenantUrl+"/resources/v1/modeler/documents/"+l+"/files/"+s.id+"/lock";p.type="json",p.url=f,p.data=JSON.stringify({csrf:JSON.parse(m).csrf}),p.headers=p.headers||{Accept:"*/*","Content-Type":"application/ds-json"},p.method="POST",t.authenticatedRequest(f,p)},onFailure:function(e,t){a.options.getJobsProcessorPromise.then(function(e){e.finishJob(d,"failed")}),a.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:"",subtitle:t.error,message:"",sticky:!1,allowUnsafeHTML:!1}})}})},a}),define("DS/DocumentCommands/V2/Actions/Subscription",["DS/DocumentCommands/V2/Actions/Subscription/Subscribe","DS/DocumentCommands/V2/Actions/Subscription/UnSubscribe","DS/DocumentCommands/V2/Actions/Subscription/EditSubscriptions","DS/DocumentCommands/V2/Actions/Subscription/MySubscriptions","DS/DocumentCommands/V2/Actions/Subscription/EditSubscriptionForOthers","DS/DocumentCommands/V2/Actions/Subscription/SubscriptionForOthers","DS/DocumentCommands/V2/ConvertCmdToWebUX","UWA/Promise","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o,n,i,a,s,l,c){"use strict";return function(r){var d=new e(r),u=new t(r),m=new o(r),p=new n(r),f=new a(r),g=new i(r);return{id:"Subscription",dataElements:{docV2Public:!0,typeRepresentation:"functionMenuIcon",icon:{iconName:"bell-list",fontIconFamily:1},label:c.get("Subscriptions"),tooltip:c.get("Subscriptions"),position:"far",category:"information",value:{menu:s([d,u,m,p,f,g])},visibleFlag:!1},updateForSelection:function(e,t){return new l(function(t){e({visibleFlag:r.getSelectedNodes().length>=1}),t(!0)})}}}}),define("DS/DocumentCommands/V2/FileActions/OfficeWebEdition",["DS/PlatformAPI/PlatformAPI","DS/DocumentCommands/Helper","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o){"use strict";var n=function(e){return{id:"OfficeWebEdition",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"pencil",fontIconFamily:1},label:o.get("OfficeWebEdition"),tooltip:o.get("OfficeWebEdition"),position:"far",category:"edit",value:function(t){t.options=e,n.execute(t)},visibleFlag:!1,priority:10},execute:function(){n.execute({options:e})},updateForSelection:function(o,n){if(!window.dscef){return t.AuthoringFilesCommandVisibiltyPromise(e,this.id,o)}o({visibleFlag:!1})}}};return n.execute=function(t){var n=t.options.getSelectedNodes()[0],i=t.options.getDocumentFromNodeModel(n);let a=e.getUser().login;var s;if(""!=i.dataelements.locker&&i.dataelements.locker!=a)i.relateddata.lockerInfo&&i.relateddata.lockerInfo.length>0&&(s=i.relateddata.lockerInfo[0].dataelements.firstname+" "+i.relateddata.lockerInfo[0].dataelements.lastname),t.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:o.get("DocumentEditNotAllowed"),subtitle:s+" "+o.get("DocumentLockedBySomeone"),message:"",sticky:!1,allowUnsafeHTML:!1}});else{if(!t.options.getDocumentFromNodeModel(n))throw"e6wDocument cannot be loaded from nodeModel";!function(e){require(["DS/DocumentWebEdition/OfficeWebEditorComponent"],function(o){t.options.widget.officeWebEditorComponent=new o({file:t.options.getDocumentFromNodeModel(e),title:t.options.getDocumentFromNodeModel(e).dataelements.title,icon:e.options.icons[0],documentId:t.options.getParentDocument(),platformUrls:t.options.platformUrls,modelEvents:t.options.events,tenant:t.options.platformUrls.platformId,securityContext:t.options.fetchSecurityContext(),nodeModel:e,actionIntiatedAt:"file"}),t.options.widget.officeWebEditorComponent.loaded=function(e){},t.options.widget.officeWebEditorComponent.elements.container.setStyles({background:"white",width:"100%",height:"100%"}),t.options.widget.officeWebEditorComponent.close=function(){t.options.widget.officeWebEditorComponent&&(t.options.widget.officeWebEditorComponent.destroy(),t.options.widget.officeWebEditorComponent=void 0)},t.options.widget.officeWebEditorComponent.inject(t.options.widget.body)})}(n)}},n}),define("DS/DocumentCommands/DocumentFileCommandsV2",["UWA/Core","UWA/Promise","DS/DocumentCommands/V2/FileActions/Preview","DS/DocumentCommands/V2/FileActions/Edit","DS/DocumentCommands/V2/FileActions/LockAndDownload","DS/DocumentCommands/V2/FileActions/Lock","DS/DocumentCommands/V2/FileActions/UndoEdit","DS/DocumentCommands/V2/FileActions/Unlock","DS/DocumentCommands/V2/FileActions/FileIterations","DS/DocumentCommands/V2/FileActions/CopyLink","DS/DocumentCommands/V2/FileActions/Download","DS/DocumentCommands/V2/FileActions/Update","DS/DocumentCommands/V2/FileActions/UpdateAndUnlock","DS/DocumentCommands/V2/FileActions/UploadFile","DS/DocumentCommands/V2/FileActions/Delete","DS/DocumentCommands/V2/FileActions/OfficeWebEdition","DS/DocumentCommands/V2/ConvertCmdToWebUX"],function(e,t,o,n,i,a,s,l,c,r,d,u,m,p,f,g,v){"use strict";return e.Class.extend({init:function(t){t.widget=null==t.widget?window.widget:t.widget,t.getSourceForUsageAnalytics=t.getSourceForUsageAnalytics||function(e){t.uaSource||(t.uaSource="unknown");var o=t.uaSource;return e&&(o=o+"."+e),t.isFromContextMenu?o+=" Contextual Menu":o+=" Tool bar",o},t.getJobsProcessorPromise=t.getJobsProcessorPromise||new e.Promise(function(e,o){var n={};t.widget&&t.widget.app&&t.widget.app.jobs&&"doco-jobs"==t.widget.app.jobs.name&&t.widget.app.progressPane&&"doco-progress"==t.widget.app.progressPane.name?(n=t.widget.app,e(n.jobs)):(console.warn("DocumentFileCommandsV2 had to initialize jobs and progressPane"),require(["DS/DocumentCommands/Jobs","DS/DocumentCommands/ProgressPane"],function(o,i){null==n.jobs&&(n.jobs=new o(n)),null==n.progressPane&&(n.progressPane=new i(n),t.widget&&t.widget.body?n.progressPane.inject(t.widget.body):n.progressPane.inject(document.body)),e(n.jobs)}))}),this._parent(t),this.commands={Preview:new o(t),Edit:new n(t),LockAndDownload:new i(t),Lock:new a(t),UndoEdit:new s(t),Unlock:new l(t),Download:new d(t),FileIterations:new c(t),CopyLink:new r(t),Update:new u(t),UpdateAndUnlock:new m(t),UploadFile:new p(t),Delete:new f(t),OfficeWebEdition:new g(t)}},commands:[],connectToWebUXToolbar:function(e){e.items.getRoots().forEach(e=>{e.options.docV2Public&&e.options.extend&&e.options.extend(e)})},selectionChangedForWebUXToolbar:function(e){e.items.getRoots().forEach(e=>{e.options.docV2Public&&(e.options.grid.action=e,e.options.updateForSelection&&e.options.updateForSelection(function(t){e.updateOptions(t)}))})},getWebUXContextMenuItemsForCurrentSelection:function(o,n){return new e.Promise(function(i,a){var s=[],l=o[0].dataElements.category,c=[!0];o.forEach(t=>{if(t.updateForSelection){var o=t.updateForSelection(function(o){t.dataElements=e.extend(t.dataElements,o,!0)});c.push(o)}else c.push(!0)}),t.all(c).then(function(e){o.forEach(e=>{e.dataElements.visibleFlag&&(n&&l!=e.dataElements.category&&s.push({type:"SeparatorItem"}),s.push(v([e])[0]),l=e.dataElements.category)}),i(s)})})},getUIKitItemsForCurrentSelection:function(o,n){var i=[!0],a=o[0].dataElements.category,s=[];return new e.Promise(function(l,c){o.forEach(t=>{if(t.updateForSelection){var o=t.updateForSelection(function(o){t.dataElements=e.extend(t.dataElements,o,!0)});i.push(o)}else i.push(!0)}),t.all(i).then(function(){o.forEach(e=>{e.dataElements.visibleFlag&&(n&&a!=e.dataElements.category&&s.push({className:"divider"}),s.push({rawItem:e,title:e.dataElements.label,name:e.id,text:e.dataElements.label,fonticon:e.dataElements.icon.iconName,handler:e.execute||function(e,t,o){console.error("This command doesnt have value")},category:e.dataElements.category}),a=e.dataElements.category)}),l(s)})})}})}),define("DS/DocumentCommands/V2/Actions/NewRevision",["UWA/Core","UWA/Promise","DS/DocumentManagement/DocumentManagement","DS/WAFData/WAFData","DS/DocumentCommands/Resources","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,o,n,i,a){"use strict";var s=function(e){return{id:"NewRevision",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"flow-line-add",fontIconFamily:1},label:a.get("NewRevision"),tooltip:a.get("NewRevision"),position:"far",category:"lifecycle",value:function(t){t.options=e,s.execute(t)},visibleFlag:!1},execute:function(){s.execute({options:e})},updateForSelection:function(o,n){return new t(function(t){o({visibleFlag:e.getSelectedNodes().length>=1}),t(!0)})}}};return s.execute=function(t){if(t.options.getSelectedNodes().length>0){var o=t.options.getSelectedNodes();require(["DS/LifecycleCmd/ReviseCmd"],function(n){new n({securitycontext:t.options.fetchSecurityContext(),context:{securitycontext:t.options.fetchSecurityContext(),getSecurityContext:function(){return{SecurityContext:this.securitycontext}},displayNotification:function(n){if("primary"==n.eventID)if(1==o.length){var i=t.options.getSelectedNodes()[0],s=t.options.getDocumentFromNodeModel(i),l=void 0;s&&null==(l=s.title||s.name)&&s.dataelements&&(l=s.dataelements.title||s.dataelements.name),t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:a.get("RevisionSuccessful"),subtitle:e.String.format(a.get("RevisionSuccessfulMsg"),l),message:"",sticky:!1,allowUnsafeHTML:!1}})}else o.length>1&&t.options.events.publish({event:"docv2-show-notification",data:{level:"success",title:a.get("RevisionSuccessful"),subtitle:a.get("MultipleRevisionSuccessfulMsg",{count:o.length}),message:"",sticky:!1,allowUnsafeHTML:!1}})},getUUID:function(){return t.options.getOrigin?JSON.stringify(e.extend(t.options.getOrigin(),{action:"new-revision"})):"docv2.new-revision."+Date.now()}}}).execute(o.map(function(e){var o=t.options.getDocumentFromNodeModel(e),n=void 0;o&&null==(n=o.title||o.name)&&o.dataelements&&(n=o.dataelements.title||o.dataelements.name);var i=void 0;return o.revision?i=o.revision:o.dataelements&&(i=o.dataelements.revision),{physicalid:o.id,displayName:n,revision:i,icon:o.dataelements.indexedTypeicon||o.dataelements.typeicon,type:o.type,typeDisplayName:o.dataelements.typeNLS,current:o.dataelements.state,currentDisplayName:o.dataelements.stateNLS}}))})}},s}),define("DS/DocumentCommands/DocumentCommandsV2",["UWA/Core","UWA/Promise","DS/DocumentCommands/V2/Actions/Preview","DS/DocumentCommands/V2/Actions/Edit","DS/DocumentCommands/V2/Actions/LockAndDownload","DS/DocumentCommands/V2/Actions/UndoEdit","DS/DocumentCommands/V2/Actions/Unlock","DS/DocumentCommands/V2/Actions/Lock","DS/DocumentCommands/V2/Actions/Share","DS/DocumentCommands/V2/Actions/CopyLink","DS/DocumentCommands/V2/Actions/Download","DS/DocumentCommands/V2/Actions/Relations","DS/DocumentCommands/V2/Actions/Maturity","DS/DocumentCommands/V2/Actions/NewRevision","DS/DocumentCommands/V2/Actions/Update","DS/DocumentCommands/V2/Actions/UpdateAndUnlock","DS/DocumentCommands/V2/Actions/Delete","DS/DocumentCommands/V2/Actions/Revisions","DS/DocumentCommands/V2/Actions/Duplicate","DS/DocumentCommands/V2/Actions/Compare","DS/DocumentCommands/V2/Actions/Move","DS/DocumentCommands/V2/Actions/ChangeOwner","DS/DocumentCommands/V2/Actions/AddTo/Libraries","DS/DocumentCommands/V2/Actions/AddTo","DS/DocumentCommands/V2/ConvertCmdToWebUX","DS/DocumentCommands/V2/Actions/Subscription/Subscribe","DS/DocumentCommands/V2/Actions/Subscription/UnSubscribe","DS/DocumentCommands/V2/Actions/Subscription/EditSubscriptions","DS/DocumentCommands/V2/Actions/Subscription/MySubscriptions","DS/DocumentCommands/V2/Actions/Subscription/EditSubscriptionForOthers","DS/DocumentCommands/V2/Actions/Subscription","DS/DocumentCommands/V2/Actions/OfficeWebEdition","DS/DocumentCommands/V2/Actions/UploadFile"],function(e,t,o,n,i,a,s,l,c,r,d,u,m,p,f,g,v,D,h,S,y,b,C,w,F,U,I,E,P,x,A,N,k){"use strict";return e.Class.extend({init:function(t){t.widget=window.widget=null==t.widget?window.widget:t.widget,t.getSourceForUsageAnalytics=t.getSourceForUsageAnalytics||function(e){t.uaSource||(t.uaSource="unknown");var o=t.uaSource;return e&&(o=o+"."+e),t.isFromContextMenu?o+=" Contextual Menu":o+=" Tool bar",o},t.getJobsProcessorPromise=t.getJobsProcessorPromise||new e.Promise(function(e,o){var n={};t.widget&&t.widget.app&&t.widget.app.jobs&&"doco-jobs"==t.widget.app.jobs.name&&t.widget.app.progressPane&&"doco-progress"==t.widget.app.progressPane.name?(n=t.widget.app,e(n.jobs)):(console.warn("DocumentCommandsV2 had to initialize jobs and progressPane"),require(["DS/DocumentCommands/Jobs","DS/DocumentCommands/ProgressPane"],function(o,i){null==n.jobs&&(n.jobs=new o(n)),null==n.progressPane&&(n.progressPane=new i(n),t.widget&&t.widget.body?n.progressPane.inject(t.widget.body):n.progressPane.inject(document.body)),e(n.jobs)}))}),this._parent(t),this.commands={Preview:new o(t),Edit:new n(t),LockAndDownload:new i(t),UndoEdit:new a(t),Unlock:new s(t),Lock:new l(t),Download:new d(t),Share:new c(t),CopyLink:new r(t),Relations:new u(t),Maturity:new m(t),NewRevision:new p(t),Update:new f(t),UpdateAndUnlock:new g(t),UploadFile:new k(t),Delete:new v(t),Revisions:new D(t),Duplicate:new h(t),Compare:new S(t),Move:new y(t),ChangeOwner:new b(t),Libraries:new C(t),AddTo:new w(t),Subscribe:new U(t),UnSubscribe:new I(t),EditSubscriptions:new E(t),MySubscriptions:new P(t),EditSubscriptionForOthers:new x(t),Subscription:new A(t),OfficeWebEdition:new N(t)}},commands:[],connectToWebUXToolbar:function(e){e.items.getRoots().forEach(e=>{e.options.docV2Public&&e.options.extend&&e.options.extend(e)})},selectionChangedForWebUXToolbar:function(e){e.items.getRoots().forEach(e=>{e.options.docV2Public&&(e.options.grid.action=e,e.options.updateForSelection&&e.options.updateForSelection(function(t){e.updateOptions(t)}))})},getWebUXContextMenuItemsForCurrentSelection:function(o,n){return new e.Promise(function(i,a){var s=[],l=o[0].dataElements.category,c=[!0];o.forEach(t=>{if(t.updateForSelection){var o=t.updateForSelection(function(o){t.dataElements=e.extend(t.dataElements,o,!0)});c.push(o)}else c.push(!0)}),t.all(c).then(function(e){o.forEach(e=>{e.dataElements.visibleFlag&&(n&&l!=e.dataElements.category&&s.push({type:"SeparatorItem"}),s.push(F([e])[0]),l=e.dataElements.category)}),i(s)})})},getUIKitItemsForCurrentSelection:function(o,n){var i=[!0],a=o[0].dataElements.category,s=[];return new e.Promise(function(l,c){o.forEach(t=>{if(t.updateForSelection){var o=t.updateForSelection(function(o){t.dataElements=e.extend(t.dataElements,o,!0)});i.push(o)}else i.push(!0)}),t.all(i).then(function(){o.forEach(e=>{e.dataElements.visibleFlag&&(n&&a!=e.dataElements.category&&s.push({className:"divider"}),s.push({rawItem:e,title:e.dataElements.label,name:e.id,text:e.dataElements.label,fonticon:e.dataElements.icon.iconName,handler:e.execute||function(e,t,o){console.error("This command doesnt have value")},category:e.dataElements.category}),a=e.dataElements.category)}),l(s)})})}})});