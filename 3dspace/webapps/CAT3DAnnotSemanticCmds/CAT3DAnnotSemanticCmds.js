/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/CAT3DAnnotSemanticCmds/CAT3DAnnotSemanticSolveAttrLinkCmd",["UWA/Class","DS/ENOCollabSharingCmds/commands/EditPropCmd/EditPropCmdBase"],function(t,e){"use strict";return t.extend(e,{init:function(t){this._parent(t,{mode:"shared",isAsynchronous:!0}),this.beginExecute=function(){this.launchProperties(t.args.args)}}})}),define("DS/CAT3DAnnotSemanticCmds/CAT3DAnnotSemanticAttrBrowserCmd",["DS/CATWebUXComponents/DMUCommandCheckHeader","DS/PADUtils/PADContext","DS/CAT3DAnnotationAttributeController/CAT3DAnnotationAttributeController"],function(t,e,n){"use strict";var i,o=t.extend({init:function(t){this._parent(t,{});var e=this,a=this.onStateChange(function(){e.getState()?o.OpenSemanticBrowser():o.CloseSemanticBrowser()}),r=this._destroy;this._destroy=function(){i&&n.unreference3DAnnotAttrBrowserController({context:i}),e._modelEvents.unsubscribe(a),r.call(e)},this.setState("false"!==localStorage.getItem("CAT3DAnnotSemanticAttrBrowserCmd"),!0)},_destroy:function(){this._parent()}});return o.OpenSemanticBrowser=async function(t,o){!i&&o?i=o.executionContext.getComponent("Viewer"):i||o||(i=e.get());let a=n.get3DAnnotAttrBrowserController({context:i});await a.setActiveState(!0),localStorage.setItem("CAT3DAnnotSemanticAttrBrowserCmd","true"),t&&t()},o.CloseSemanticBrowser=async function(t,o){!i&&o?i=o.executionContext.getComponent("Viewer"):i||o||(i=e.get());let a=n.get3DAnnotAttrBrowserController({context:i});a&&await a.setActiveState(!1),localStorage.setItem("CAT3DAnnotSemanticAttrBrowserCmd","false"),t&&t()},o}),define("DS/CAT3DAnnotSemanticCmds/CAT3DAnnotSemanticCmds",[],function(){}),define("DS/CAT3DAnnotSemanticCmds/CAT3DAnnotSemanticShowRelatedAnnotCmd",["DS/CATWebUXComponents/DMUCommand","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/PADUtils/PADContext","DS/CAT3DAnnotationController/CAT3DAnnotationController"],function(t,e,n,i,o){"use strict";return t.extend({init:function(t){this._parent(t,{mode:"shared",isAsynchronous:!0})},beginExecute:function(){var t=function(t){if(!t)return null;var e=void 0!==t.getLastElement(!0).getAnnotationID?t.getLastElement(!0).getAnnotationID():null,n=t.getParentPath().getParentPath();if(!n.getLastElement(!0).getAnnotationClassType||"tpsAnnotationSet"!==n.getLastElement(!0).getAnnotationClassType())return null;var i,o,a=null,r=n.getChildrenPathes();for(i=0;i<r.length;i++)if("RootViews"===r[i].getLastElement(!0).getAnnotationType()){a=r[i];break}if(a){var s=a.getChildrenPathes();for(i=0;i<s.length;i++){var l=s[i].getLastElement(!0).getTPSList();if(l&&l.length)for(o=0;o<l.length;o++)if(l[o]===e)return s[i]}}},n=e.get();n.length||this._endExecute(),this.ctxBarPosition=this.getFrameWindow().getContextualUIManager().getContextualBar().getPosition(),this.ctxBarPosition=this.ctxBarPosition?{x:this.ctxBarPosition.x,y:this.ctxBarPosition.y}:{x:0,y:0};var a,r,s,l=i.get(),h=o.giveAnnotationController({context:l}),c=[],g=[];for(a=0;a<n.length;a++){var m=h.getPontingAnnotations(n[a].pathElement);if(m&&m.length)for(r=0;r<m.length;r++){c.push(m[r]);var C=t(m[r]);C&&C.getLastElement(!0).isVisible()&&-1===c.indexOf(C)&&c.push(C);var d=m[r].getParentPath().getParentPath();-1===g.indexOf(d)&&g.push(d)}}if(g&&g.length)for(a=0;a<g.length;a++){var u=g[a].getChildrenPathes();for(r=0;r<u.length;r++){var A=u[r].getChildrenPathes();for(s=0;s<A.length;s++)A[s].getLastElement(!0).setVisibility(!1)}}if(c&&c.length)for(a=0;a<c.length;a++)c[a].getLastElement(!0).setVisibility(!0);this._endExecute()},_endExecute:function(){for(var t=e.get(),i=[],o=0;o<t.length;o++)i.push({pathElement:t[o].pathElement.clone()});e.empty(),n.empty(),e.add(i),n.add(i),this.ctxBarPosition&&(this.getFrameWindow().getExecutionContext?this.getFrameWindow().getContextualUIManager()._showContextualBar({hideWithDistance:!0,x:this.ctxBarPosition.x,y:this.ctxBarPosition.y}):this.getFrameWindow().getContextualUIManager().showContextualBar({hideWithDistance:!0,x:this.ctxBarPosition.x,y:this.ctxBarPosition.y})),this.getFrameWindow().getViewer().render(),this.ctxBarPosition=null,this.cancel()},destroy:function(){this._endExecute()}})}),define("DS/CAT3DAnnotSemanticCmds/CAT3DAnnotSemanticShowGeomAttachCmd",["DS/CATWebUXComponents/DMUCommand","DS/Selection/CSOManager","DS/Selection/HSOManager"],function(t,e,n){"use strict";return t.extend({init:function(t){this._parent(t,{mode:"shared",isAsynchronous:!0})},beginExecute:function(){var t=e.get();t.length||this._endExecute(),this.ctxBarPosition=this.getFrameWindow().getContextualUIManager().getContextualBar().getPosition(),this.ctxBarPosition=this.ctxBarPosition?{x:this.ctxBarPosition.x,y:this.ctxBarPosition.y}:{x:0,y:0};for(var n=0;n<t.length;n++)if(t[n].pathElement.getLastElement(!0).isVisible()){var i=t[n].pathElement.getLastElement(!0).getGeometricalAttachmentList();if(i&&i.length)for(var o=t[n].pathElement.getParentPath().getParentPath().getLastElement(!0).children,a=0;a<o.length;a++)if("RootViews"!==o[a].getAnnotationType()&&"RootCaptures"!==o[a].getAnnotationType()&&"RootGeometries"!==o[a].getAnnotationType())for(var r=o[a].children,s=0;s<r.length;s++){-1===i.indexOf(r[s].getAnnotationID())||r[s].isVisible()||r[s].setVisibility(!0)}}this._endExecute()},_endExecute:function(){for(var t=e.get(),i=[],o=0;o<t.length;o++)i.push({pathElement:t[o].pathElement.clone()});e.empty(),n.empty(),e.add(i),n.add(i),this.ctxBarPosition&&(this.getFrameWindow().getExecutionContext?this.getFrameWindow().getContextualUIManager()._showContextualBar({hideWithDistance:!0,x:this.ctxBarPosition.x,y:this.ctxBarPosition.y}):this.getFrameWindow().getContextualUIManager().showContextualBar({hideWithDistance:!0,x:this.ctxBarPosition.x,y:this.ctxBarPosition.y})),this.getFrameWindow().getViewer().render(),this.ctxBarPosition=null,this.cancel()},destroy:function(){this._endExecute()}})}),define("DS/CAT3DAnnotSemanticCmds/CAT3DAnnotSemanticWidgetDefaultCmd",["DS/CAT3DAnnotationCommands/CAT3DAnnotationWidgetDefaultCmd"],function(t){"use strict";return t.extend({init:function(t){var e=t||{};e.annotControllerLib="DS/CAT3DAnnotSemanticController/CAT3DAnnotSemanticContInstance",this._parent(e)}})});