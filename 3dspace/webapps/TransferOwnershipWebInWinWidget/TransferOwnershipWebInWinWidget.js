define("DS/TransferOwnershipWebInWinWidget/TransferOwnershipWebInWinWidget",["UWA/Controls/Abstract","DS/WidgetServices/WidgetServices","DS/TransferOwnershipWidget/component/TransferOwnershipWidget","DS/TransferOwnershipWidget/TransferOwnershipConstant","text!DS/TransferOwnershipWidget/assets/TOSettings.json","DS/WebToWinInfra/WebToWinCom","DS/WebInWinHelper/WebInWinHelper","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/ENOCollabSharingCmds/BaseModels/ResultElement","DS/UIKIT/Mask","css!DS/TransferOwnershipWidget/component/TransferOwnershipWidget.css","i18n!DS/TransferOwnershipWidget/assets/nls/TOSNls","i18n!DS/ENOCollabSharingCmds/assets/nls/langSharingCmds"],function(e,t,i,n,o,s,r,a,l,d,p,c,g){"use strict";return e.extend({itemListHasPriority:!1,defaultOptions:{className:"",context:null,ForbiddenChar:'"#$@%*,?\\<>[]|:',serverName:"",serverUri:"",activeFirstLineTable:!1,displaySoftDialog:!0,model:!0,wintop:!0,odtMode:!1,serverUrl:""},init:function(e,i,n){var o=null;this._parent(n),this.refreshData={};var l=this;if(this.options=n,r.initTenant(l),this.widget=e,this._parent(n),r.getServices(l),1==n.wintop&&(this.webToWinCom_Socket=s.createSocket({socket_id:"webinwinTransferOwnership_socket_"+Math.floor(1e5*Math.random()+1)})),this.options.webToWinComSocket=this.webToWinCom_Socket,this.options.webInWinHelper=r,this.options=n,this.parentWidget=i,1==n.wintop){void 0!==n.serverUrl&&n.serverUrl.length>0&&void 0!==n.serverUrl[0].platformId&&(o=n.serverUrl[0].platformId,this.tenantId=o,this.serverUrl=n.serverUrl[0]["3DSpace"],t.setTenantID(o)),this.container=UWA.createElement("div",{class:"collab-transfer-ownership-content"});l=this;var d={wintop:n.wintop,serverUrl:n.serverUrl};a.getInstance(d).getSecurityContext()}},initDatafromWin:function(e){this.phyIdList=[],this.mapOfPhyId={};var t=this;e.forEach(function(e){e.physicalId&&(e.physicalId in t.mapOfPhyId||(t.mapOfPhyId[e.physicalId]=e.name),t.phyIdList.push(e.physicalId))}),require(["DS/WidgetServices/WidgetServices","DS/TransferOwnershipWidget/component/TransferOwnershipWidget","DS/PADUtils/PADContext","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings"],function(e,i,n,o,s){s.app_initialization(function(){o.listAttributes(t.tenantId,t.phyIdList,["attribute[PLMEntity.V_usage]","attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]","physicalid","owner","revision","attribute[PLMCoreRepReference.V_isOnceInstantiable]","attribute[Marketing Name]","organization","organization.property[Title].value","project","type","displayType","project.property[Title].value"],function(e){for(var i=0,n=0,o=[],s=0;s<e.results.length;s++){var r=e.results[s],a=r.physicalid,d={},p=t.mapOfPhyId[a];d.physicalId=r.physicalid;"3DPart"==r["attribute[PLMEntity.V_usage]"]&&r.type;null===r["attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]"]||0==r["attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]"]?d.v_IsEmbeddedComponent=0:(d.v_IsEmbeddedComponent=1,i++);var c;1==(c="3DPart"==r["attribute[PLMEntity.V_usage]"]&&"3DShape"==r.type)&&n++,d.aggrObj=c,d.Revision=r.revision,d.organization=r.organization,d.type=r.type,null==r["organization.property[Title].value"]||""===r["organization.property[Title].value"]?d.organizationTitle=r.organization:d.organizationTitle=r["organization.property[Title].value"],d.project=r.project,null===r["project.property[Title].value"]||""===r["project.property[Title].value"]?d.projectTitle=r.project:d.projectTitle=r["project.property[Title].value"],d.owner=r.owner,d.responsibleName=r.ownerFullName,d.typeDisplayName=r.displayType;var h=new l({urlIcon:"",physicalId:d.physicalId,name:p,title:p,category:"bus",type:d.type,typeDisplayName:d.typeDisplayName,relID:"",parentID:"",cadMaster:"",parentCADMaster:"",responsibleName:d.responsibleName,Revision:d.Revision,projectTitle:d.projectTitle,project:d.project,organizationTitle:d.organizationTitle,organization:d.organization,aggrObj:d.aggrObj,v_IsEmbeddedComponent:d.v_IsEmbeddedComponent});o.push(h)}if(i!=t.phyIdList.length)if(n!=t.phyIdList.length)t.createWidget(),t.TOSWidget&&t.TOSWidget.initData(o,"");else{m=g.get("selectOwning");t.options.webToWinComSocket.dispatchEvent("onDispatchToWin",{notif_name:"invalidSelection",notif_parameters:{severity:"error",message:m}},"lf_web_in_win")}else{var m=g.get("selectOwning");t.options.webToWinComSocket.dispatchEvent("onDispatchToWin",{notif_name:"invalidSelection",notif_parameters:{severity:"error",message:m}},"lf_web_in_win")}})})})},createWidget:function(){var e=this,t={wintop:e.options.wintop,serverUrl:e.options.serverUrl};a.getInstance(t).getSecurityContext(),a.getInstance(t).getSecurityContext({onSuccess:function(t){if(null!=t&&""!=t&&t.hasOwnProperty("SecurityContext")){0!=t.SecurityContext.indexOf("ctx::")&&"ctx::"}e.TOSWidget=e.container=new i(e.widget,e.parentWidget,{className:"transferOwnership_innerComponent",setCloseButton:!0,showTopBar:!0,genericTransfer:!0,topClassHeight:"TOSP_PopupDial",serverName:e.serverUrl,serverUri:e.serverUrl,activeDnD:e.options.activeDnD,activeOptions:e.options.activeOptions,oldClassName:e.options.className,securityContext:t.SecurityContext,serverUrl:e.options.serverUrl,wintop:e.options.wintop,odtMode:e.options.odtMode,events:{onNewSize:function(e){},onCancel:function(){e.options.webToWinComSocket.dispatchEvent("onDispatchToWin",{notif_name:"ClosePanel",notif_parameters:{}},"lf_web_in_win")},onValidation:function(t){e.dispatchEvent("onValidation",t)},onTitleChange:function(e){},onLaunchReportingPanel:function(t){e.setRefreshSessionData(t),e.hideWidget()},onTransferStart:function(){e.options.webInWinHelper.transferStart(e.options.webToWinComSocket)},onMaskUnmask:function(t){if(t)if(1==t.mask){var i="";t.message&&(i=t.message),1==e.options.odtMode?d.mask(e.widget.lastChild,i):d.mask(e.widget.body,i)}else 1==e.options.odtMode?d.unmask(e.widget.lastChild,i):d.unmask(e.widget.body)}}}),e.container.inject(e.parentWidget)},onFailure:function(e){alert("Error")}})},hideWidget:function(){this.TOSWidget&&this.TOSWidget.hide(),this.widget.getElement(".command_dialog")&&(this.widget.getElement(".modal-header").style.display="none",this.widget.getElement(".floatingPanel_RightButtons")&&this.widget.getElement(".fonticon-resize-full")&&this.widget.getElement(".fonticon-resize-full").click(),this.widget.getElement(".modal-body")&&(this.widget.getElement(".modal-body").style.maxHeight="100%",this.widget.getElement(".modal-body").style.maxWidth="100%"))},setRefreshSessionData:function(e){var t,i=[];if(e&&e.OKdata&&Array.isArray(e.OKdata))for(var n=0;n<e.OKdata.length;n++)i.push(e.OKdata[n]);i.length>0&&(t=this.options.webInWinHelper.createMoveJSONArray(i),this.refreshData=t,this.options.webToWinComSocket.dispatchEvent("onDispatchToWin",{notif_name:"refreshsession",notif_parameters:t},"lf_web_in_win"))},postResize:function(e){var t=this.widget.getElement(".command_dialog");t&&t.length>0&&(this.widget.getElement(".command_dialog").style.height="100%",this.widget.getElement(".command_dialog").style.width="100%",this.widget.getElement(".toolbar-view-container").style.display="none")},onResize:function(){this.widget.getElement(".command_dialog")&&(this.widget.getElement(".command_dialog").style.height="100%",this.widget.getElement(".command_dialog").style.width="100%",this.widget.getElement(".modal-body")&&(this.widget.getElement(".modal-body").style.maxHeight="100%",this.widget.getElement(".modal-body").style.maxWidth="100%"),this.widget.getElement(".toolbar-view-container").style.display="none")},getDimensions:function(){return this.widget.getElement(".collab-transfer-ownership-content").getBoundingClientRect()}})});