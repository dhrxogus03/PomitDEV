define("DS/SocialGlobeAPI/Core/Viewer",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(t,o){this.id=t,this.type=o,this.renderers=new Map,document.getElementById(t).classList.add(e.cssClassContainer)}return e.prototype.forEachRenderer=function(e){this.renderers.forEach(function(t,o){e(o,t)})},e.prototype.connectManager2Renderer=function(e){var t=this.renderers.get(e.getType());t&&e.connectRenderer(t)},e.prototype.registerStrategies=function(e){this.renderers.forEach(function(t,o){e.registerSelectionStrategy(o,t.handleSelection),e.registerUnSelectionStrategy(o,t.handleUnSelection)})},e.prototype.getId=function(){return this.id},e.prototype.getModel=function(e){var t=!1;return this.renderers.forEach(function(o){o.hasFeature(e)&&(t=o.getFeature(e))}),t},e.prototype.showRenderers=function(){this.renderers.forEach(function(e){e.show()})},e.prototype.getType=function(){return this.type},e.prototype.hideRenderers=function(){this.renderers.forEach(function(e){e.hide()})},e.prototype.reset=function(){this.renderers.forEach(function(e){return e.reset()})},e.cssClassContainer="map-component",e}();t.default=o}),define("DS/SocialGlobeAPI/Manager/SelectionManager",[],function(){"use strict";class e{constructor(e,t){this._name=e,this._handler=t}getName(){return this._name}execute(e){return this._handler(e)}}return class{constructor(){this.selectionStrategies=[],this.unSelectionStrategies=[],this.selectedItems=[]}addToSelection(e,t){this.selectedItems.push({name:e,model:t})}removeFromSelection(e){const t=this.selectedItems.findIndex(t=>t.model===e);this.selectedItems.splice(t,1)}clearSelection(){this.selectedItems.forEach(({name:e,model:t})=>{this.unSelectByClick(e,t)}),this.selectedItems=[]}registerSelectionStrategy(t,o){this.selectionStrategies.push(new e(t,o))}registerUnSelectionStrategy(t,o){this.unSelectionStrategies.push(new e(t,o))}select(e,t){t.isSelectable()?(this._getSelectionStrategies(e).forEach(e=>e.execute(t)),this.clearSelection(),this.addToSelection(e,t)):t.setSelected(!1,{silent:!0})}selectByClick(e,t){const o=this._getSelectionStrategies(e);if(o.forEach(e=>e.execute(t)),o.length>0){t.setSelected(!0,{silent:!0});const e=t.getOnSelectCallback();e&&e(t)}this.clearSelection(),this.addToSelection(e,t)}unSelect(e,t){this._getUnSelectionStrategies(e).forEach(e=>e.execute(t)),this.removeFromSelection(t)}unSelectByClick(e,t){const o=this._getUnSelectionStrategies(e);if(o.forEach(e=>e.execute(t)),o.length>0){t.setSelected(!1,{silent:!0});const e=t.getOnUnSelectCallback();e&&e(t)}this.removeFromSelection(t)}_getSelectionStrategies(e){return this.selectionStrategies.filter(t=>t.getName()===e)}_getUnSelectionStrategies(e){return this.unSelectionStrategies.filter(t=>t.getName()===e)}}}),define("DS/SocialGlobeAPI/Core/Renderer",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){this.viewerId=e,this.type=t,this.views=new Map,this.handleSelection=this.handleSelection.bind(this),this.handleUnSelection=this.handleUnSelection.bind(this)}return e.prototype.hasFeature=function(e){return this.views.has(e)},e.prototype.getFeature=function(e){return this.views.get(e).getModel()},e.prototype.getId=function(){return this.viewerId},e.prototype.loadFeatures=function(e){var t=this;e.forEach(function(e){t.addView(e)})},e.prototype.update=function(e,t){var o=t.getId();if(this.views.has(o)){var n=this.views.get(o),r="update".concat(e.charAt(0).toUpperCase()).concat(e.slice(1));if(console.log(r),console.log(n),console.log(n.hasOwnProperty(r)),!Object.hasOwn(n,r))throw new Error("".concat(this.type,"Renderer - ").concat(r," unexists for views."));n[r]()}},e.prototype.handleSelection=function(e){var t=e.getId(),o=this.views.get(t);o&&o.select()},e.prototype.handleUnSelection=function(e){var t=e.getId(),o=this.views.get(t);o&&o.unselect()},e}();t.default=o}),define("DS/SocialGlobeAPI/HTML/Marker",["require","exports","DS/Utilities/Dom","DS/Controls/Popup"],function(e,t,o,n){"use strict";return function(){function e(){}return e.getHTMLElement=function(e){return(new DOMParser).parseFromString(e,"text/html").body.firstChild},e.getMarkerHTMLString=function(t){var o="<div class='marker2d'  id=\"".concat(t.getId(),'" >');return o+=e.getIconHTMLString(t.getIcon(),t.getColor()),o+=t.getNotification()?e.getNotificationHTMLString(t.getNotification().text,t.getNotification().color):"",o+=t.getBadge()?e.getBadgeHTMLString(t.getBadge().icon,t.getBadge().color):"",o+="</div>"},e.getIconHTMLString=function(t,o){var n='\n      <div class="gv-marker"><svg version="1.1" baseProfile="basic" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 32 32" xml:space="preserve">\n        <g>\n          <path class="'.concat(e.svgMarkerClassName,'" fill="#FFFFFF" d="M16,31.5c-0.6,0-1.2-0.3-1.6-0.8l-7.2-9.6c-0.2-0.3-0.4-0.6-0.6-0.9c-1.5-2.5-2-5.5-1.2-8.3\n            C6,9,7.8,6.6,10.3,5.1C12,4,14,3.5,16,3.5c2,0,4,0.5,5.7,1.6c2.5,1.5,4.3,3.9,5,6.8c0.7,2.8,0.3,5.8-1.2,8.3\n            c-0.2,0.3-0.4,0.6-0.6,0.9l-7.2,9.6C17.2,31.2,16.6,31.5,16,31.5z" />\n          <path fill="#3d3d3d" d="M16,4L16,4c1.9,0,3.8,0.5,5.4,1.5c2.4,1.4,4.1,3.7,4.8,6.5c0.7,2.7,0.3,5.5-1.2,7.9\n            c-0.2,0.3-0.4,0.6-0.6,0.9l-7.2,9.6C16.9,30.8,16.5,31,16,31c-0.5,0-0.9-0.2-1.2-0.6l-7.2-9.6c-0.2-0.3-0.4-0.6-0.6-0.9\n            c-1.4-2.4-1.9-5.2-1.2-7.9c0.7-2.7,2.4-5,4.8-6.5C12.2,4.5,14.1,4,16,4L16,4 M16,3C16,3,16,3,16,3C16,3,16,3,16,3L16,3\n            C16,3,16,3,16,3c-2,0-4.1,0.5-5.9,1.6C4.6,7.9,2.9,15,6.1,20.4c0.2,0.3,0.4,0.7,0.7,1L14,31c0.5,0.6,1.2,1,2,1c0.8,0,1.5-0.4,2-1\n            l7.2-9.6c0.2-0.3,0.5-0.6,0.7-1c3.3-5.4,1.5-12.5-3.9-15.8C20.1,3.5,18,3,16,3C16,3,16,3,16,3L16,3L16,3z" />\n        </g>\n      </svg></div>\n    ');return n+="<div class='".concat(e.iconClassName,"' style='color:").concat(o,"'>").concat(e.getUiIcon(t),"</div>")},e.getUiIcon=function(e){var t=o.generateIcon(e);return t.removeClassName("wux-ui-3ds-lg"),t.outerHTML},e.getDivIcon=function(t,o){var n="<div class='".concat(t,"'>").concat(e.getUiIcon(o),"</div>");return e.getHTMLElement(n)},e.getNotificationHTMLString=function(t,o){var n="";if(!t)return n;var r=parseInt(t)<99?t.toString():"99+",i=o||"#E87B00";return n+='<div class="'.concat(e.notificationClassName,'" style="background-color:').concat(i,'">').concat(r,"</div>")},e.getBadgeHTMLString=function(t,o){var n="";if(!t)return n;var r=t||"user",i=o||"#00B8DE";return n+='<div class="'.concat(e.badgeClassName,'" style="background-color:').concat(i,'">').concat(this.getUiIcon(r),"</div>")},e.createPopup=function(e,t){var o=t.content,r=t.offset,i=t.trigger;if(null==o)return null;var a=new n({target:e,trigger:"click"!==i?"hover":"",offset:r});return a.addEventListener("show",function(e){a.getBody()||a.setBody("function"!=typeof o?o:o.call())}),a},e.iconClassName="gv-marker-icon",e.badgeClassName="gv-badge",e.notificationClassName="gv-notif",e.svgMarkerClassName="svg-marker",e}()}),define("DS/SocialGlobeAPI/Core/Orchestrator",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];var n=this;this.managers=new Map,this.viewers=new Map,this.selectionManager=e,t.forEach(function(e){n.managers.set(e.getType(),e)}),this.add=this.add.bind(this)}return e.prototype.getDataModel=function(){var e=[];return this.managers.forEach(function(t){e=e.concat(Array.from(t.dataModel,function(e){e[0];return e[1]}))}),e},e.prototype.onEachFeature=function(e){this.managers.forEach(function(t){t.dataModel.forEach(function(t){return e(t)})})},e.prototype.hideModelViews=function(){this.viewers.forEach(function(e){e.hide()})},e.prototype.showModelViews=function(){this.viewers.forEach(function(e){e.show()})},e.prototype.getFeature=function(e){var t=null;return this.managers.forEach(function(o){o.hasFeature(e)&&(t=o.getFeature(e))}),t},e.prototype.addViewer=function(e){var t=e.getId();if(this.viewers.get(t))throw new Error("Viewer Error: ".concat(t," -> Id already in use"));this.viewers.set(t,e),this.managers.forEach(function(t){return e.connectManager2Renderer(t)}),e.registerStrategies(this.selectionManager)},e.prototype.removeViewer=function(e){var t=this.viewers.get(e);t&&(t.hide(),this.viewers.delete(e))},e.prototype.defaultDisplayMode=function(){this.onEachFeature(function(e){return e.setEditable(!0)}),this.showModelViews()},e.prototype.connectDisplayMode=function(e){this.onEachFeature(function(e){return e.setEditable(!1)}),this.hideModelViews(),this.viewers.forEach(function(t){return e.connect(t)})},e.prototype.moveCamera=function(e,t,o){this.viewers.forEach(function(n){n.moveCamera(e,t,o)})},e.prototype.fitBounds=function(e,t){this.viewers.forEach(function(o){o.fitBounds(e,t)})},e.prototype.add=function(e,t){var o=this.managers.get(e);return o&&o.add(t)},e.prototype.remove=function(e){var t=this.managers.get(e.getType());console.log("Orchestrator remove: ".concat(e.getType(),", manager => ").concat(t)),t&&t.remove(e)},e.prototype.reset=function(){this.managers.forEach(function(e){return e.reset()}),this.viewers.forEach(function(e){return e.reset()})},e.prototype.forEachFeatures=function(e){this.managers.forEach(function(t){t.dataModel.forEach(function(t){return e(t)})})},e.prototype.onClick=function(e){this.viewers.forEach(function(t){return t.onClick(e)})},e.prototype.offClick=function(){this.viewers.forEach(function(e){return e.offClick()})},e}();t.default=o}),define("DS/SocialGlobeAPI/Core/Manager",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){this.type=e,this.sm=t,this.dataModel=new Map,this.renderers=new Map,this.updateSelection=this.updateSelection.bind(this)}return e.prototype.hasFeature=function(e){return this.dataModel.has(e)},e.prototype.getFeature=function(e){return this.dataModel.get(e)},e.prototype.connectRenderer=function(e){this.renderers.has(e.getId())||this.renderers.set(e.getId(),e);var t=Array.from(this.dataModel,function(e){e[0];return e[1]});e.loadFeatures(t)},e.prototype.addModel=function(e){e.addEvent("onChange:selected",this.updateSelection),this.dataModel.set(e.getId(),e),this.renderers.forEach(function(t){t.addView(e)})},e.prototype.removeModel=function(e){console.log("Manager removeModel"),this.renderers.forEach(function(t){t.removeView(e)}),e.removeEvent("onChange:selected"),e.clear({silent:!0}),this.dataModel.delete(e.getId())},e.prototype.updateSelection=function(e){e.isSelected()?this.sm.select(this.type,e):this.sm.unSelect(this.type,e)},e.prototype.getType=function(){return this.type},e.prototype.update=function(e){var t=this;return function(o){t.renderers.forEach(function(t){t.update(e,o)})}},e.prototype.reset=function(){this.dataModel.clear()},e}();t.default=o});var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};define("DS/SocialGlobeAPI/Core/DisplayModeController",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){return function(e,t){this.options=__assign(__assign({},t),e)}}();t.default=o}),define("DS/SocialGlobeAPI/Model/Feature",["UWA/Class/Model","UWA/Utils"],function(e,t){"use strict";const o={trigger:"click",offset:{x:0,y:0},content:null};return e.extend({urlRoot:"/feature",defaults:{type:"feature",id:"",title:"",desc:"",color:"Blue",visible:!1,editable:!0,selectable:!0,selected:!1,onSelectCallback:null,onUnSelectCallback:null,userData:{},popup:{trigger:null,offset:{x:0,y:0},content:null}},setup:function(){this.id||(this.id=t.getUUID()),this._attributes.id=this.id},select:function(){this.setSelected(!0)},unSelect:function(){this.setSelected(!1)},setDesc:function(e){this.getEditable()&&this.set("desc",e)},setUserData:function(e){this.getEditable()&&this.set("userData",e)},setUserDatum:function(e,t){if(!this.getEditable())return;const o=this.getUserData();o[e]=t,this.setUserData(o)},setVisible:function(e){this.set("visible",e)},setSelectable:function(e){this.set("selectable",e)},setEditable:function(e){this.set("editable",e)},setSelected:function(e,t){this.set("selected",e,t)},setOnSelectCallback:function(e){this.set("onSelectCallback",e)},setOnUnSelectCallback:function(e){this.set("onUnSelectCallback",e)},setColor:function(e){this.getEditable()&&this.set("color",e)},setTitle:function(e){this.getEditable()&&this.set("title",e)},setPopup:function(e){this.set("popup",{...o,...e})},getTitle:function(){return this.get("title")},getUserData:function(){return this.get("userData")},getUserDatum:function(e){return this.get("userData")[e]},getPopup:function(){return this.get("popup")},getEditable:function(){return this.get("editable")},getColor:function(){return this.get("color")},getId:function(){return this.get("id")},getType:function(){return this.get("type")},getDesc:function(){return this.get("desc")},isVisible:function(){return this.get("visible")},isSelectable:function(){return this.get("selectable")},isSelected:function(){return this.get("selected")},getOnSelectCallback:function(){return this.get("onSelectCallback")},getOnUnSelectCallback:function(){return this.get("onUnSelectCallback")}})}),define("DS/SocialGlobeAPI/Core/ModelView",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this.model=e}return e.prototype.getModel=function(){return this.model},e.prototype.popupHasContent=function(){return null!=this.model.getPopup().content},e.prototype.isClickPopup=function(){return"hover"!==this.model.getPopup().trigger},e.prototype.isBothPopup=function(){return"both"===this.model.getPopup().trigger},e.prototype.isHoverPopup=function(){return"click"!==this.model.getPopup().trigger},e.prototype.openPopup=function(){this.popupHasContent()&&this.isClickPopup()&&(this.isBothPopup()&&(this.popup.trigger=""),this.popup.show())},e.prototype.closePopup=function(){var e;this.isClickPopup()&&(null===(e=this.popup)||void 0===e||e.hide(),this.isBothPopup()&&(this.popup.trigger="hover"))},e}();t.default=o});var __extends=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();define("DS/SocialGlobeAPI/VisuModel/Marker2D",["require","exports","DS/SocialGlobeAPI/HTML/Marker","SocialGlobe/assets/leaflet/leaflet","DS/SocialGlobeAPI/Core/ModelView"],function(e,t,o,n,r){"use strict";return function(e){function t(r){var i=e.call(this,r)||this;i.updatePosition=function(){i.layer.setLatLng(i.model.getLatLng())},i.updateColor=function(){var e=i.model.getColor(),n=i.domNode.querySelector(".".concat(o.iconClassName));t.changeColor(n,e)},i.updateNotification=function(){var e=i.model.getNotification(),n=e.text,r=e.color,a=i.domNode.querySelector(".".concat(o.notificationClassName));if(null!=n)if(null!==a)t.changeBackgroundColor(a,r),a.innerText=n>99?"99+":n;else{var s=o.getHTMLElement(o.getNotificationHTMLString(n,r));i.domNode.appendChild(s)}else null!==a&&i.domNode.removeChild(a)},i.updateBadge=function(){var e=i.model.getBadge(),n=e.icon,r=e.color,a=i.domNode.querySelector(".".concat(o.badgeClassName));if(null!=n)if(null!==a)t.changeBackgroundColor(a,r),a.innerHTML=o.getUiIcon(n);else{var s=o.getHTMLElement(o.getBadgeHTMLString(n,r));i.domNode.appendChild(s)}else null!==a&&i.domNode.removeChild(a)},i.updateIcon=function(){var e=i.model.getIcon(),t=i.domNode.querySelector(".".concat(o.iconClassName));null!=(null==t?void 0:t.firstChild)&&t.removeChild(t.firstChild),t.innerHTML=o.getUiIcon(e)},i.updatePopup=function(){console.log(i.popup),i.popup&&(i.popup.hide(),i.popup=null),i.popupHasContent()&&(i.popup=o.createPopup(i.domNode,i.model.getPopup()))},i.domNode=o.getHTMLElement(o.getMarkerHTMLString(i.model)),i.popup=o.createPopup(i.domNode,i.model.getPopup()),i.parent=null;var a=n.divIcon({html:i.domNode,className:"",iconSize:[32,32],iconAnchor:[16,32]});return i.layer=n.marker(n.latLng(r.getLatLng()),{icon:a,uuid:r.getId(),pmIgnore:!0,bubblingMouseEvents:!0}),i}return __extends(t,e),t.prototype.select=function(){var e=this.domNode.querySelector(".".concat(o.iconClassName)),n=this.domNode.querySelector(".".concat(o.svgMarkerClassName));t.changeColor(e,"#FFFFFF"),t.changeColor(n,"#368ec4"),this.domNode.classList.add("selected"),this.openPopup()},t.prototype.unselect=function(){var e=this.model.getColor(),n=this.domNode.querySelector(".".concat(o.iconClassName)),r=this.domNode.querySelector(".".concat(o.svgMarkerClassName));t.changeColor(n,e),t.changeColor(r,"#FFFFFF"),this.domNode.classList.remove("selected"),this.closePopup()},t.prototype.addTo=function(e){this.layer.addTo(e),this.parent=e},t.prototype.delete=function(){console.log("Marker 2D Delete parent = ",this.parent),this.parent&&(this.layer.removeFrom(this.parent),this.parent=null),this.popup&&this.popup.hide()},t.changeColor=function(e,t){switch(e.nodeName){case"DIV":e.style.color=t;break;case"path":e.setAttribute("fill",t)}},t.changeBackgroundColor=function(e,t){switch(e.nodeName){case"DIV":e.style.backgroundColor=t}},t}(r.default)});__extends=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();define("DS/SocialGlobeAPI/DisplayMode/Bubble/BubbleController",["require","exports","DS/SocialGlobeAPI/Core/DisplayModeController","DS/VEND3js/5.7.0/d3.min","SocialGlobe/assets/leaflet/leaflet"],function(e,t,o,n,r){"use strict";return function(e){function t(t,o){var r=e.call(this,t,o)||this;return r.getMaxPropertyValue=function(e,t){return n.max(e,function(e){return e.getProperty(t)})},r.layerViewers=[],r}return __extends(t,e),t.prototype.process=function(e){this.markers=e.filter(function(e){return"marker"===e.getType()}),this.setScaleSize(this.markers),this.setColorGenerator(this.markers)},t.prototype.setColorGenerator=function(e){var t=this.options,o=t.gradiantSettings,r=t.primaryColor;if(o){var i=o.colorPropertyName,a=o.secondaryColor||"#FFF",s=this.getMaxPropertyValue(e,i),c=n.scaleSequential(n.interpolate(a,r)).domain([0,s]);this.colorGenerator=function(e){return c(e.getProperty(i))}}else this.colorGenerator=function(){return r}},t.prototype.setScaleSize=function(e){var t=this.options,o=t.maxValue,r=t.minValue,i=t.sizePropertyName,a=null!=o?o:this.getMaxPropertyValue(e,i);this.sizeScaler=n.scaleSqrt().domain([r,a]).range([0,15])},t.prototype.connect=function(e){var t=this;if("3d"!==e.getType()){var o=r.layerGroup(),n=this.options,i=n.sizePropertyName,a=n.scale,s=n.strokeColor,c=n.opacity,l=n.strokeWidth;this.markers.forEach(function(e){if(e.getProperty(i)){var n=t.sizeScaler(e.getProperty(i))*a,u=t.colorGenerator(e),p=s,d=c,h=l,f=r.circleMarker(e.getLatLng(),{radius:n,fillColor:u,color:p,fillOpacity:d,weight:h});o.addLayer(f)}}),e.attach(o),this.layerViewers.push([e,o])}},t.prototype.clear=function(){this.layerViewers.forEach(function(e){var t=e[0],o=e[1];t.detach(o)})},t}(o.default)}),define("DS/SocialGlobeAPI/Model/Link",["DS/SocialGlobeAPI/Model/Feature"],function(e){"use strict";return e.extend({defaults:{type:"link",origin:null,destination:null,bidirectional:!1,icon:null,pattern:"solid",color:"#3d3d3d",weight:3.5,opacity:.9},setup:function(e,t){this._parent(e,t)},setOrigin:function(e){this.getEditable()&&this.set("origin",e)},setDestination:function(e){this.getEditable()&&this.set("destination",e)},setBidirectional:function(e){this.getEditable()&&this.set("bidirectional",e)},setIcon:function(e){this.getEditable()&&this.set("icon",e)},setPattern:function(e){this.getEditable()&&this.set("pattern",e)},setWeight:function(e){this.getEditable()&&this.set("weight",e)},setOpacity:function(e){this.getEditable()&&this.set("opacity",e)},getOrigin:function(){return this.get("origin")},getDestination:function(){return this.get("destination")},getBidirectional:function(){return this.get("bidirectional")},getIcon:function(){return this.get("icon")},getPattern:function(){return this.get("pattern")},getWeight:function(){return this.get("weight")},getOpacity:function(){return this.get("opacity")},getLatLngs:function(){return[this.getOrigin().getLatLng(),this.getDestination().getLatLng()]}})}),define("DS/SocialGlobeAPI/VisuModel/Link/Link2DBuilder",["require","exports","SocialGlobe/assets/leaflet/leaflet","SocialGlobe/assets/leaflet/leaflet-polyline-decorator","DS/SocialGlobeAPI/HTML/Marker"],function(e,t,o,n,r){"use strict";return o.Symbol.ArrowHead.Opposite=o.Symbol.ArrowHead.extend({_buildArrowPath:function(e,t){return e.heading+=180,o.Symbol.ArrowHead.prototype._buildArrowPath.call(this,e,t)}}),o.Symbol.arrowHead.opposite=function(e){return new o.Symbol.ArrowHead.Opposite(e)},function(){function e(){}return e.createArrow=function(t){return o.polylineDecorator(e.getLeafletLatLng(t),{patterns:[{offset:"100%",repeat:0,symbol:o.Symbol.arrowHead({pixelSize:15,polygon:!1,pathOptions:{stroke:!0,color:t.getColor(),weight:t.getWeight()}})}]})},e.createOppositeArrow=function(t){return t.getBidirectional()?o.polylineDecorator(e.getLeafletLatLng(t),{patterns:[{offset:"0%",repeat:0,symbol:o.Symbol.arrowHead.opposite({pixelSize:15,polygon:!1,pathOptions:{stroke:!0,color:t.getColor(),weight:t.getWeight()}})}]}):null},e.createBackgroundArrow=function(t){return o.polylineDecorator(e.getLeafletLatLng(t),{patterns:[{offset:"100%",repeat:0,symbol:o.Symbol.arrowHead({pixelSize:15,polygon:!1,pathOptions:{pane:"background-link",stroke:!0,color:"transparent",weight:t.getWeight()+2}})}]})},e.createBackgroundOppositeArrow=function(e){return e.getBidirectional()?o.polylineDecorator(this.getLeafletLatLng(e),{patterns:[{offset:"0%",repeat:0,symbol:o.Symbol.arrowHead.opposite({pixelSize:15,polygon:!1,pathOptions:{pane:"background-link",stroke:!0,color:"transparent",weight:e.getWeight()+3}})}]}):null},e.createLine=function(t,n,r,i,a,s,c){void 0===c&&(c=null);var l={className:n,weight:r,opacity:i,color:a,dashArray:e.patterns[s],bubblingMouseEvents:!0};return c&&(l.pane=c),o.polyline(t,l)},e.createMiddleMarker=function(t,n){var r=e._getMiddle(t),i=o.divIcon({html:n,iconSize:[0,0]});return o.marker(r,{icon:i})},e.createIcon=function(t,n){var i=n.getIcon();if(!i)return!1;var a=e._getMiddle(n),s=o.divIcon({html:r.getDivIcon(t,i),iconSize:[17,14.5]});return o.marker(a,{icon:s})},e._getMiddle=function(e){var t=e.getOrigin().getLatLng(),o=e.getDestination().getLatLng();return[(t[0]+o[0])/2,(t[1]+o[1])/2]},e.getLeafletLatLng=function(e){return e.getLatLngs().map(function(e){return o.latLng(e)})},e.createPopup=function(e,t){return r.createPopup(e,t)},e.patterns={solid:[1],dotted:[1,4],dashed:[7,7],dashdotted:[7,4,1,4]},e}()});__extends=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();define("DS/SocialGlobeAPI/DisplayMode/Clustering/ClusteringController",["require","exports","SocialGlobe/assets/leaflet/leaflet","DS/SocialGlobeAPI/VisuModel/Marker2D","SocialGlobe/assets/leaflet/leaflet-markercluster","DS/SocialGlobeAPI/Core/DisplayModeController"],function(e,t,o,n,r,i){"use strict";return function(e){function t(t,o){var n=e.call(this,t,o)||this;return console.log("CklusteringController opts = ",n.options),n.layerViewers=[],n}return __extends(t,e),t.prototype.process=function(e){this.markers=e.filter(function(e){return"marker"===e.getType()})},t.prototype.connect=function(e){if("3d"!==e.getType()){var t=this.options,r=t.animate,i=t.disableClusteringAtZoom,a=t.maxClusterRadius,s=t.zoomToBoundsOnClick,c=o.markerClusterGroup({maxClusterRadius:a,disableClusteringAtZoom:i,animate:r,zoomToBoundsOnClick:s,iconCreateFunction:function(e){return o.divIcon({html:e.getChildCount(),className:"customCluster",iconSize:o.point(40,40)})},showCoverageonHover:!1,removeOutsideVisibleBounds:!1});this.markers.map(function(e){return c.addLayer(new n(e).layer)}),e.attach(c),this.layerViewers.push([e,c])}},t.prototype.clear=function(){this.layerViewers.forEach(function(e){var t=e[0],o=e[1];t.detach(o)})},t}(i.default)}),define("DS/SocialGlobeAPI/PluginsSettings",["require","exports","DS/SocialGlobeAPI/DisplayMode/Clustering/ClusteringController","DS/SocialGlobeAPI/DisplayMode/Bubble/BubbleController"],function(e,t,o,n){"use strict";return{clustering:{controller:o,defaultOpts:{animate:!0,zoomToBoundsOnClick:!0,disableClusteringAtZoom:19,maxClusterRadius:80}},bubble:{controller:n,defaultOpts:{minValue:0,opacity:.8,primaryColor:"#005685",scale:1,strokeColor:"#fff",strokeWidth:1}}}}),define("DS/SocialGlobeAPI/Manager/PlugInManager",["require","exports","DS/SocialGlobeAPI/PluginsSettings"],function(e,t,o){"use strict";return function(){function e(){this.plugins=new Map}return e.prototype.loadPlugIn=function(e){if(this.plugins.has(e))return this.plugins.get(e);console.log(o[e])},e}()});__extends=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();define("DS/SocialGlobeAPI/VisuModel/Link/Link2D",["require","exports","SocialGlobe/assets/leaflet/leaflet","DS/SocialGlobeAPI/VisuModel/Link/Link2DBuilder","DS/SocialGlobeAPI/Core/ModelView"],function(e,t,o,n,r){"use strict";return function(e){function t(r){var i=e.call(this,r)||this;return i.parent=null,i.updatePosition=function(){var e=n.getLeafletLatLng(i.getModel()),t=i.link,o=t.line,r=t.arrow,a=t.oppositeArrow,s=t.middleMarker,c=t.hoverLine,l=i.background,u=l.line,p=l.arrow,d=l.oppositeArrow;o.setLatLngs(e),c.setLatLngs(e),u.setLatLngs(e),r.setPaths(e),p.setPaths(e),s.setLatLng(n._getMiddle(i.getModel())),a&&a.setPaths(e),d&&d.setPaths(e)},i.updateIcon=function(){var e=i.getModel().getIcon(),o=i.link,r=o.layerGroup,a=o.iconMarker;if(r.hasLayer(a)&&r.removeLayer(a),e){var s=n.createIcon(t.divIconClassName,i.model);r.addLayer(s),i.link.iconMarker=s}},i.updateColor=function(){var e=n.createArrow(i.getModel()),t=i.link,o=t.line,r=t.arrow,a=t.layerGroup;o.setStyle({color:i.getModel().getColor()}),a.removeLayer(r),a.addLayer(e),i.link.arrow=e},i.updatePattern=function(){i.link.line.setStyle({dashArray:n.patterns[i.getModel().getPattern()]})},i.updateBidirectional=function(){var e=i.link,t=e.layerGroup,o=e.oppositeArrow,r=i.background,a=r.layerGroup,s=r.oppositeArrow,c=n.createOppositeArrow(i.getModel()),l=n.createBackgroundOppositeArrow(i.getModel());o&&t.removeLayer(o),s&&a.removeLayer(s),t.addLayer(c),a.addLayer(l),i.link.oppositeArrow=c,i.background.oppositeArrow=l},i.popupTarget=document.createElement("div"),i.createLink(),i.createBackground(),i.addHoverBehavior(),i.layerGroup=o.layerGroup().addLayer(i.link.layerGroup).addLayer(i.background.layerGroup),i.popup=n.createPopup(i.popupTarget,i.getModel().getPopup()),console.log("LinkView Created"),i}return __extends(t,e),t.prototype.addTo=function(e){this.layerGroup.addTo(e),this.parent=e},t.prototype.addHoverBehavior=function(){var e=this,t=this.link.hoverLine,o=this.background.line;t.on("mouseover",function(){"#368ec4"!==o.options.color&&(e.isHoverPopup()&&e.popupTarget.dispatchEvent(new MouseEvent("mouseover",{bubbles:!0})),e.colorizeLink("#FFFFFF",e.getModel().getColor()))}),t.on("mouseout",function(){var t;"#368ec4"!==o.options.color&&(e.isHoverPopup()&&(null===(t=e.popup)||void 0===t||t.hide()),e.colorizeLink(e.getModel().getColor(),"transparent"))})},t.prototype.colorizeLink=function(e,t){var o=this.link,n=o.line,r=o.arrow,i=o.oppositeArrow,a=this.background,s=a.line,c=a.arrow,l=a.oppositeArrow;n.setStyle({color:e}),r.setStyle({color:e}),i&&i.setStyle({color:e}),s.setStyle({color:t}),c.setStyle({color:t}),l&&l.setStyle({color:t})},t.prototype.createBackground=function(){var e=n.createLine(n.getLeafletLatLng(this.getModel()),"background-line",this.getModel().getWeight()+2,.9,"transparent","solid","background-link"),t=n.createBackgroundArrow(this.getModel()),r=n.createBackgroundOppositeArrow(this.getModel()),i=o.layerGroup().addLayer(e).addLayer(t);r&&i.addLayer(r),this.background={arrow:t,layerGroup:i,line:e,oppositeArrow:r}},t.prototype.createLink=function(){var e=n.createLine(n.getLeafletLatLng(this.getModel()),"link-line",this.getModel().getWeight(),this.getModel().getOpacity(),this.getModel().getColor(),this.getModel().getPattern()),r=n.createLine(n.getLeafletLatLng(this.getModel()),"hover-line ".concat(this.getModel().getId()),this.getModel().getWeight()+4,this.getModel().getOpacity(),"transparent",this.getModel().getPattern()),i=n.createArrow(this.getModel()),a=n.createMiddleMarker(this.getModel(),this.popupTarget),s=n.createIcon(t.divIconClassName,this.getModel()),c=n.createOppositeArrow(this.getModel()),l=o.layerGroup().addLayer(e).addLayer(r).addLayer(i).addLayer(a);c&&l.addLayer(c),s&&l.addLayer(s),this.link={arrow:i,hoverLine:r,middleMarker:a,layerGroup:l,line:e,oppositeArrow:c,iconMarker:s}},t.prototype.getModel=function(){return this.model},t.prototype.select=function(){this.colorizeLink("#FFFFFF","#368ec4"),this.openPopup()},t.prototype.unselect=function(){this.colorizeLink(this.getModel().getColor(),"transparent"),this.closePopup()},t.prototype.delete=function(){var e;this.parent&&this.parent.removeLayer(this.layerGroup),null===(e=this.popup)||void 0===e||e.hide()},t.divIconClassName="link-icon",t}(r.default)}),define("DS/SocialGlobeAPI/DisplayMode/DisplayModeFactory",["require","exports","DS/SocialGlobeAPI/PluginsSettings"],function(e,t,o){"use strict";return function(){function e(){}return e.hasDisplayMode=function(e){return o.hasOwnProperty(e)},e.build=function(t,o){var n=e.getController(t,o);return n||!1},e.getController=function(t,n){if(!e.hasDisplayMode(t))return!1;var r=o[t],i=r.controller,a=r.defaultOpts;return console.log("DisplayModeFactory. Name = "+t+", controller = ",i),console.log("Pluggins : ",o[t]),new i(n,a)},e}()});__extends=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();define("DS/SocialGlobeAPI/Renderer/Renderer2D",["require","exports","SocialGlobe/assets/leaflet/leaflet","DS/SocialGlobeAPI/VisuModel/Marker2D","DS/SocialGlobeAPI/VisuModel/Link/Link2D","DS/SocialGlobeAPI/Core/Renderer"],function(e,t,o,n,r,i){"use strict";return function(e){function t(n,r,i){var a=e.call(this,n,i)||this;return a.parent=r,a.layerGroup=o.layerGroup(),a.layerGroup.addTo(r),a.modelViewConstructor=t.MODELVIEWS[i],console.log("New Renderer2D _ type:".concat(i)),a}return __extends(t,e),t.prototype.addView=function(e){var t=e.getId();if(this.views.has(t))return!1;var o=new this.modelViewConstructor(e);return o.addTo(this.layerGroup),e.setVisible(!0),this.views.set(t,o),!0},t.prototype.removeView=function(e){var t=e.getId();this.views.has(t)&&(this.views.get(t).delete(),this.views.delete(t))},t.prototype.reset=function(){this.layerGroup.clearLayers(),this.views.clear()},t.prototype.hide=function(){this.layerGroup.removeFrom(this.parent)},t.prototype.show=function(){this.layerGroup.addTo(this.parent)},t.MODELVIEWS={marker:n,link:r},t}(i.default)});__extends=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();define("DS/SocialGlobeAPI/Manager/LinkManager",["require","exports","DS/SocialGlobeAPI/Core/Manager","DS/SocialGlobeAPI/Model/Link"],function(e,t,o,n){"use strict";return function(e){function t(t){var o=e.call(this,"link",t)||this;return console.log("new Link Manager"),o}return __extends(t,e),t.prototype.add=function(t){var o=new n(t);return o.addEvent("onChange:pattern",this.update("pattern")),o.addEvent("onChange:icon",this.update("icon")),o.addEvent("onChange:color",this.update("color")),o.addEvent("onChange:bidirectional",this.update("bidirectional")),o.addEvent("onChange:origin",this.update("position")),o.addEvent("onChange:destination",this.update("position")),e.prototype.addModel.call(this,o),o},t.prototype.remove=function(t){t.removeEvent("onChange:pattern"),t.removeEvent("onChange:icon"),t.removeEvent("onChange:color"),t.removeEvent("onChange:bidirectional"),t.removeEvent("onChange:origin"),t.removeEvent("onChange:destination"),e.prototype.removeModel.call(this,t)},t}(o.default)});__extends=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();define("DS/SocialGlobeAPI/Viewer/Viewer2D",["require","exports","DS/SocialGlobeAPI/Core/Viewer","DS/SocialGlobeAPI/Renderer/Renderer2D","SocialGlobe/assets/leaflet/leaflet"],function(e,t,o,n,r){"use strict";return function(e){function t(t,o){var n=e.call(this,t,"2d")||this;return n.container=document.getElementById(t),n.initMap(o),n.layerGroup=r.layerGroup(),n.layerGroup.addTo(n.map),n.setTrademark2D(),n.trackResize(),n.initRenderers(),n}return __extends(t,e),t.prototype.initMap=function(e){var t=e.initialCoordinates,o=void 0===t?[48.786192,2.210616]:t,n=e.initialZoomLevel,i=void 0===n?8:n,a=e.initialMaxLevel,s=void 0===a?19:a;if(this.map=r.map(this.container,{zoomControl:!1,maxBounds:[[-90,-180],[90,180]],doubleClickZoom:!1,maxZoom:s,maxBoundsViscosity:1,center:o,zoom:i}),!this.map.getPane("background-link")){var c=this.map.createPane("background-link");c.style.zIndex=350,c.style.pointerEvents="none"}r.DomUtil.addClass(this.container,"crosshair-cursor-enabled")},t.prototype.initRenderers=function(){var e=new n(this.getId(),this.layerGroup,"marker"),t=new n(this.getId(),this.layerGroup,"link");this.renderers.set("marker",e),this.renderers.set("link",t)},t.prototype.onClick=function(e){this.map.on("click",function(t){e(t.latlng.lat,t.latlng.lng)})},t.prototype.offClick=function(){this.map.off("click")},t.prototype.setTrademark2D=function(){this.map.attributionControl.addAttribution('© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'),this.map.attributionControl._container.classList.add("trademark")},t.prototype.addTileLayer=function(e){this.tileLayer=r.tileLayer(e,{maxNativeZoom:20,maxZoom:20,noWrap:!0}),this.map.addLayer(this.tileLayer)},t.prototype.trackResize=function(){var e=this;if(!window.ResizeObserver)throw new Error("ResizeObserver not available on this browser");this.resizeObserver=new ResizeObserver(function(){e.map.invalidateSize()}),this.resizeObserver.observe(this.container)},t.prototype.moveCamera=function(e,t,o){var n=(void 0===o?{}:o).zoomLevel,r=(void 0===n?null:n)||this.map.getZoom();this.map.flyTo([e,t],r,{animate:!0,duration:2.5})},t.prototype.fitBounds=function(e){console.log("FitBounds, bounds = ",e),this.map.fitBounds(e)},t.prototype.enableSelection=function(e){this.handleSelection=function(t){var o=t.target,n=o.getAttribute("id");if(!n){var r=new RegExp(/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i);o.classList.forEach(function(e){e.match(r)&&(n=e)})}e(n)},this.container.addEventListener("click",this.handleSelection,!0)},t.prototype.disableSelection=function(){this.container.removeEventListener("click",this.handleSelection)},t.prototype.onDnDLink=function(e){var o=this;this.map.on("mousedown",function(n){var i=o.getMarkerFromEvent(n);if(i){var a=i.getLatLng(),s=[n.latlng.lat,n.latlng.lng],c=r.polyline([a,s],{color:"#3d3d3d",opacity:.4}).addTo(o.layerGroup);o.map.on("mousemove",function(e){o.map.dragging.disable();var n=[e.latlng.lat,e.latlng.lng];c.setLatLngs([a,n]);var i=e.containerPoint,s=o.map.latLngToContainerPoint(r.latLng(a));t.closeToBorders(i,o.map.getSize())&&o.map.panBy(t.calculateVector(s,i))}),o.map.on("mouseup",function(t){var n=o.getMarkerFromEvent(t);c.removeFrom(o.layerGroup),n&&e([i,n]),o.map.off("mousemove"),o.map.off("mouseup"),o.map.off("move"),o.map.dragging.enable()})}})},t.prototype.offDnDLink=function(){this.map.off("mousedown")},t.prototype.getMarkerFromEvent=function(e){var t=e.originalEvent.target.getAttribute("id"),o=this.getModel(t);return console.log("VIEWER2D: getMarkerFromEvent => ",o),!(!o||"marker"!==o.getType())&&o},t.closeToBorders=function(e,t){var o=e.x,n=e.y,r=t.x,i=t.y;return o<10||o>r-10||n<10||n>i-10},t.calculateVector=function(e,t){var o=e.x,n=e.y,r=t.x-o,i=t.y-n,a=Math.sqrt(Math.pow(r,2)+Math.pow(i,2));return{x:30*(r/a),y:30*(i/a)}},t.prototype.hide=function(){this.renderers.forEach(function(e){e.hide()})},t.prototype.show=function(){this.renderers.forEach(function(e){e.show()})},t.prototype.attach=function(e){this.layerGroup.addLayer(e)},t.prototype.detach=function(e){this.layerGroup.removeLayer(e)},t}(o.default)}),define("DS/SocialGlobeAPI/Model/Marker",["DS/SocialGlobeAPI/Model/Feature"],function(e){"use strict";return e.extend({defaults:{type:"marker",lat:0,lng:0,icon:"record",notification:{text:null,color:"#E87B00"},badge:{icon:null,color:"#00B8DE"},properties:{},color:"#3d3d3d"},setup:function(e,t){this._parent(e,t),e.popup&&this.setPopup(e.popup)},setLat:function(e){this.getEditable()&&this.set("lat",e)},setLng:function(e){this.getEditable()&&this.set("lng",e)},setIcon:function(e){if(!this.getEditable())return;const t=e||"record";this.set("icon",t)},setNotification:function(e){if(!this.getEditable())return;this.set("notification",{...{text:null,color:"#E87B00"},...e})},setBadge:function(e){if(!this.getEditable())return;this.set("badge",{...{icon:null,color:"#00B8DE"},...e})},setProperty:function(e,t){if(!this.getEditable())return;const o=this.get("properties");this.set("properties",{...o,[e]:t})},getLatLng:function(){return[this.get("lat"),this.get("lng")]},getLat:function(){return this.get("lat")},getLng:function(){return this.get("lng")},getIcon:function(){return this.get("icon")},getNotification:function(){return this.get("notification")},getBadge:function(){return this.get("badge")},getProperty:function(e){return this.get("properties")[e]}})});__extends=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();define("DS/SocialGlobeAPI/Manager/MarkerManager",["require","exports","DS/SocialGlobeAPI/Core/Manager","DS/SocialGlobeAPI/Model/Marker"],function(e,t,o,n){"use strict";return function(e){function t(t){var o=e.call(this,"marker",t)||this;return console.log("new Marker Manager"),o}return __extends(t,e),t.prototype.add=function(t){var o=new n(t);return o.addEvent("onChange:lat",this.update("position")),o.addEvent("onChange:lng",this.update("position")),o.addEvent("onChange:badge",this.update("badge")),o.addEvent("onChange:icon",this.update("icon")),o.addEvent("onChange:notification",this.update("notification")),o.addEvent("onChange:color",this.update("color")),o.addEvent("onChange:popup",this.update("popup")),o.addEvent("onChange:selected",this.updateSelection),e.prototype.addModel.call(this,o),o},t.prototype.remove=function(t){console.log("Marker Manager remove"),t.removeEvent("onChange:lat"),t.removeEvent("onChange:lng"),t.removeEvent("onChange:badge"),t.removeEvent("onChange:icon"),t.removeEvent("onChange:notification"),t.removeEvent("onChange:color"),t.removeEvent("onChange:popup"),e.prototype.removeModel.call(this,t)},t}(o.default)});__extends=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();define("DS/SocialGlobeAPI/APIOrchestrator",["require","exports","DS/SocialGlobeAPI/Manager/MarkerManager","DS/SocialGlobeAPI/Manager/LinkManager","DS/SocialGlobeAPI/Core/Orchestrator"],function(e,t,o,n,r){"use strict";return function(e){function t(t){var r=this,i=new o(t),a=new n(t);return(r=e.call(this,t,i,a)||this).handleSelection=r.handleSelection.bind(r),r}return __extends(t,e),t.prototype.addViewer=function(t){e.prototype.addViewer.call(this,t),t.enableSelection(this.handleSelection)},t.prototype.handleSelection=function(e){console.log("APIOrchestrator(HandleClick): id = ".concat(e," hasId : ").concat(this.getFeature(e)));var t=this.getFeature(e);t?t.isSelected()?this.selectionManager.unSelectByClick(t.getType(),t):this.selectionManager.selectByClick(t.getType(),t):this.selectionManager.clearSelection()},t.prototype.enableLinkEditMode=function(){var e=this;this.viewers.forEach(function(t){t.onDnDLink(function(t){var o=t[0],n=t[1];e.add("link",{origin:o,destination:n})})})},t.prototype.disableLinkEditMode=function(){this.viewers.forEach(function(e){return e.offDnDLink()})},t.prototype.select=function(e){"object"==typeof e&&this.managers.forEach(function(t){t.dataModel.forEach(function(t){for(var o=0,n=Object.entries(e);o<n.length;o++){var r=n[o],i=r[0],a=r[1];t.getUserDatum(i)===a&&t.select()}})})},t.prototype.unSelect=function(e){"object"==typeof e&&this.managers.forEach(function(t){t.dataModel.forEach(function(t){for(var o=0,n=Object.entries(e);o<n.length;o++){var r=n[o],i=r[0],a=r[1];t.getUserDatum(i)===a&&t.unSelect()}})})},t}(r.default)});__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};var __awaiter=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(a,s)}c((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var o,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(o)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(o=1,n&&(r=2&s[0]?n.return:s[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,s[1])).done)return r;switch(n=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{o=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},__rest=this&&this.__rest||function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(o[n[r]]=e[n[r]])}return o};define("DS/SocialGlobeAPI/GlobeAPI",["require","exports","DS/Web3DXCityFoundation/Geocoder","DS/SocialGlobeServices/MapNavigator/MapNavigatorServices","DS/SocialGlobeServices/Geocoding/GeocodingServices","DS/SocialGlobe/Utils","DS/SocialGlobeAPI/Manager/SelectionManager","DS/SocialGlobeAPI/Viewer/Viewer2D","DS/SocialGlobeAPI/APIOrchestrator","DS/SocialGlobeAPI/DisplayMode/DisplayModeFactory","css!SocialGlobeAPI/style.css","css!SocialGlobeAPI/leaflet.css"],function(e,t,o,n,r,i,a,s,c,l){"use strict";var u,p;return function(e){e.Default="default",e.Clustering="clustering",e.Bubble="bubble"}(u||(u={})),function(e){e.Default="default",e.Link="link"}(p||(p={})),function(){function e(e,t,o,n,r){void 0===r&&(r={}),this._onSelectCallback=null,this.tmsUrl=o,this.appId=n,this._displayMode=u.Default,this._editMode=p.Default,this.tenantId=t,this.geocodingServiceUrl=r.geocodingServiceUrl||"",this.selectionManager=new a,this.orchestrator=new c(this.selectionManager),this.displayModeController=null,this.add2DViewer(e,r)}return e.build=function(t,o,r){return void 0===r&&(r={}),__awaiter(this,void 0,void 0,function(){var a,s,c;return __generator(this,function(l){return a=i.getAppId("MapComponentDefault"),s=function(e,t,o){return void 0===o&&(o="png"),"".concat(e,"{z}/{x}/{y}.").concat(o,"?tenant=").concat(t,"&appid=").concat(a)},"string"==typeof(c=null==r?void 0:r.tmsUrl)?(c=s(c,o,r.tmsExtension),[2,new Promise(function(n){return n(new e(t,o,c,a,r))})]):[2,n.retrieveMapUrl(o,a).then(function(i){return c=n.get2dTmsUrl(i,o),c=s(c,o),new e(t,o,c,a,r)})]})})},e.prototype.add2DViewer=function(e,t){var o=new s(e,t);o.addTileLayer(this.tmsUrl),console.log("addViewer id: "+e),this.orchestrator.addViewer(o)},e.prototype.addGeoJson=function(e){var t=this;if(!this.guard())return!1;var o=[];return this.reset(),"FeatureCollection"===e.type?e.features.forEach(function(e){o.push(t.readGeoJson(e))}):o.push(this.readGeoJson(e)),o},e.prototype.readGeoJson=function(e){var t,o=e.properties,n=e.geometry;switch(n.type){case"Point":var r=n.coordinates,i=r[0],a=r[1],s=o.title,c=o.description,l=__rest(o,["title","description"]);t=this.addMarker(a,i,s,c,{properties:l})}return t},e.prototype.moveCamera=function(e,t,o){this.orchestrator.moveCamera(e,t,o)},e.prototype.fitBounds=function(e,t){this.orchestrator.fitBounds(e,t)},e.prototype.addMarker=function(e,t,o,n,r){if(this.guard()){var i=this.orchestrator.add("marker",__assign(__assign({},r),{lat:e,lng:t,title:o,desc:n}));return i.setOnSelectCallback(this._onSelectCallback),i}},e.prototype.reset=function(){this.guard()&&(this.orchestrator.reset(),this.selectionManager.clearSelection())},e.prototype.select=function(e){this.orchestrator.select(e)},e.prototype.unselect=function(e){this.orchestrator.unSelect(e)},e.prototype.setOnSelectCallback=function(e){this._onSelectCallback=e,this.orchestrator.forEachFeatures(function(t){return t.setOnSelectCallback(e)})},e.prototype.setOnClickCallback=function(e){this.orchestrator.onClick(e)},e.prototype.addLink=function(e,t){if(this.guard()){var o=e[0],n=e[1],r=__assign({origin:o,destination:n},t);return this.orchestrator.add("link",r)}},e.prototype.removeLink=function(e){this.guard()&&this.orchestrator.remove(e)},e.prototype.removeMarker=function(e){this.guard()&&this.orchestrator.remove(e)},e.prototype._getGeocodingUrl=function(){var e=this;return r.retrieveGeocodingUrl(this.tenantId).then(function(t){if(""===t)return Promise.reject(new Error("Unable to retrieve Geocoding service URL."));e.geocodingServiceUrl=t+"/resources/geocoding"})},e.prototype.getTypedGeocodingURL=function(e){return this.geocodingServiceUrl&&"".concat(this.geocodingServiceUrl,"/").concat(e,"?appid=").concat(this.appId)},e.prototype.geocoding=function(e,t){return __awaiter(this,void 0,void 0,function(){var o,n=this;return __generator(this,function(i){return"search",o=function(e){return"string"==typeof e?r.geocoding(e,n.tenantId,n.getTypedGeocodingURL("search"),t):r.stucturedGeocoding(e,n.tenantId,n.getTypedGeocodingURL("search"))},this.geocodingServiceUrl?[2,o(e)]:[2,this._getGeocodingUrl().then(function(){return o(e)})]})})},e.prototype.reverseGeocoding=function(e,t,o,n){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(a){return"reverse",this.geocodingServiceUrl?[2,r.reverseGeocoding(e,t,o,n,this.tenantId,this.getTypedGeocodingURL("reverse"))]:[2,this._getGeocodingUrl().then(function(){return r.reverseGeocoding(e,t,o,n,i.tenantId,i.getTypedGeocodingURL("reverse"))})]})})},e.prototype._loadProj=function(e){return new Promise(function(t){o.loadProjection(e,t)})},e.prototype.proj=function(e,t,n,r){var i=this._loadProj(t),a=this._loadProj(n);return Promise.all([i,a]).then(function(){return o.proj(e,t,n,r)})},e.prototype.setEditMode=function(e){switch(void 0===e&&(e="default"),e){case"link":this._editMode=p.Link,this.orchestrator.enableLinkEditMode();break;case"default":this._editMode=p.Default,this.orchestrator.disableLinkEditMode()}},e.prototype.display=function(e,t){if(void 0===e&&(e="default"),void 0===t&&(t=null),"default"!==e){if(!l.hasDisplayMode(e))throw new Error("Display Exception: ".concat(e," doesn't exists"));var o=l.build(e,t);o.process(this.orchestrator.getDataModel()),this.clearDisplayModeController(),this.orchestrator.connectDisplayMode(o),this.displayModeController=o,this._displayMode=e}else this.defaultDisplay()},e.prototype.defaultDisplay=function(){this._displayMode=u.Default,this.clearDisplayModeController(),this.orchestrator.defaultDisplayMode()},e.prototype.clearDisplayModeController=function(){this.displayModeController&&this.displayModeController.clear(),this.displayModeController=null},e.prototype.guard=function(){return this._displayMode===u.Default&&this._editMode===p.Default},e}()});