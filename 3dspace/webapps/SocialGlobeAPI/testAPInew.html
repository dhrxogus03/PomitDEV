<html xmlns="http://www.w3.org/1999/xhtml" xmlns:widget="http://www.netvibes.com/ns/">

<head>

    <link rel="stylesheet" href="GlobeViewer2D.css" />
    <link rel="stylesheet" href="test.css" />

    <!-- AMDLoader -->
    <script type="text/javascript" src="../AmdLoader/AmdLoader.js"></script>
    <script type="text/javascript" src="../WebappsUtils/WebappsUtils.js"></script>

    <!-- UWA -->
    <script type="text/javascript" src="../c/UWA/js/UWA_Standalone_Alone.js"></script>

    <!--script type="text/javascript" src="../WebUX/WebUX.js"></script>
    <script type="text/javascript" src="../WebVisualization/WebVisualization.js"></script>
    <script type="text/javascript" src="../SocialGlobe/SocialGlobe.js"></script>
    <script type="text/javascript" src="../SocialGlobe/Globe.js"></script-->

    <!-- <script src="GlobeViewer2D.js"></script> -->

    <script>
        require(["DS/SocialGlobeAPI/GlobeAPI"
        ], function (GlobeAPI) {
            const geoJson = {
  "type": "FeatureCollection",
  "representation" : "heatmap",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "_id": "62a0501fe931bb929ea5ff8e",
        "amount1": 849,
        "amount2": 4
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          0.2002,
          47.4148
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "_id": "62a0501ffdf685fb0c99c24c",
        "amount1": 795,
        "amount2": 4
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          -1.0419,
          46.9666
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "_id": "62a0501ffa8b70987a23fbcc",
        "amount1": 899,
        "amount2": 3
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          5.1978,
          44.2068
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "_id": "62a0501fdb1bdce01fc943d4",
        "amount1": 698,
        "amount2": 3
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          -2.9279,
          45.3291
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "_id": "62a0501f9ac545834a11a517",
        "amount1": 638,
        "amount2": 8
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          0.5258,
          44.6454
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "_id": "62a0501f4213d7a5c9ac5c2c",
        "amount1": 361,
        "amount2": 2
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          0.6799,
          45.502
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "_id": "62a0501f9157436126728c82",
        "amount1": 920,
        "amount2": 4
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          2.2112,
          43.6739
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "_id": "62a0501ffe2bf24f8dc1ba6c",
        "amount1": 636,
        "amount2": 6
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          2.6328,
          49.4206
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "_id": "62a0501f1a644e528ebcc270",
        "amount1": 386,
        "amount2": 1
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          1.9934,
          44.9021
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "_id": "62a0501f89077f52c69dea46",
        "amount1": 925,
        "amount2": 4
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          -2.9639,
          45.4878
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "_id": "62a0501f596c36b03ecce331",
        "amount1": 155,
        "amount2": 9
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          1.814,
          48.3594
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "_id": "62a0501fa840d9c850a55dc7",
        "amount1": 479,
        "amount2": 8
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          -2.5925,
          43.7605
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "_id": "62a0501f4ad1eee0d86e33c9",
        "amount1": 321,
        "amount2": 7
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          3.1741,
          46.2624
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "_id": "62a0501f68a6cd78e3ca6bdb",
        "amount1": 612,
        "amount2": 6
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          -0.4766,
          48.4593
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "_id": "62a0501f94400792a2e55601",
        "amount1": 337,
        "amount2": 3
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          -2.5709,
          47.8434
        ]
      }
    }]
  };
			// SET DELAY FOR TESTS
			function sleep(ms) {
				return new Promise(
				resolve => setTimeout(resolve, ms)
				);
			}
			function getContent(url){
				// read text from URL location
				var request = new XMLHttpRequest();
				request.withCredentials = true;
				request.open('GET', url, true);
				request.send(null);
				request.onreadystatechange = function () {
					if (request.readyState === 4 && request.status === 200) {
						var type = request.getResponseHeader('Content-Type');
						if (type.indexOf("text") !== 1) {
							return request.responseText;
						}
					}
				}
			}
			
			async function launchTest() {
				var geocodingUrl = "https://3dmap-geocoding.uwglobe.com/nominatim/search.php";
			
				var options = {
					initialCoordinates: [48.786192,2.210616],
					initialZoomLevel: 8,
					tmsUrl: "https://mapnavigator.uwglobe.com/3ds_globe_2d/",
					tmsMaxLevel: 19,
					geocodingServiceUrl: geocodingUrl
				};
				
				// init the map
				var globeMap = new GlobeAPI("left-map", "devopspx2mchy26131936", options);
				await sleep(2000);
				// globeMap.addGeoJson(geoJson)
				// load a geojson
				/*var jsonContent = {
					"type": "FeatureCollection",
					"features": [
					{ "type": "Feature", "properties": { "color": "#005685", "title": "<h3 style='margin-bottom: 0.1em'>RENAULT DREAM</h3>", "description": "<style>.nav td {  background-color: #f9f9f9;  border-width: 1px;  padding: 5px;  border-style: solid;  border-color: #d1d4d4;}</style><div style='max-height:600px;overflow:auto;'><table style='margin-bottom: 5px;font-size: 12px;color: #003e61;width: 100%;border-width: 1px;border-color: #ffffff;'><tbody class='nav'><tr><td>Location</td><td>Boulogne Billancour (FRANCE)</td></tr><tr><td>Users</td><td>1912 users</td></tr><tr><td>Industry</td><td>Transportation & Mobility</td></tr><tr><td>Engagement Model</td><td>Customer Solution Experience</td></tr><tr><td>Website</td><td><a href='http://www.renault.fr'>http://www.renault.fr</a></td></tr></tbody></table></div>","tags": [{"tagName":"ds6w:where/ds6w:location","tagValue": ["EUROPE","France","BOULOGNE BILLANCOURT"]},{"tagName":"ds6w:who/ds6w:Users","tagValue":">100"},{"tagName":"ds6w:what/ds6w:industry","tagValue":"Transportation & Mobility"},{ "tagName":"ds6w:how/ds6w:engagement model","tagValue":"Customer Solution Experience"}]}, "geometry": { "type": "Point", "coordinates": [2.22,48.89 ] } },
					{ "type": "Feature", "properties": { "color": "#005685", "title": "<h3 style='margin-bottom: 0.1em'>PEUGEOT</h3>", "description": "<style>.nav td {  background-color: #f9f9f9;  border-width: 1px;  padding: 5px;  border-style: solid;  border-color: #d1d4d4;}</style><div style='max-height:600px;overflow:auto;'><table style='margin-bottom: 5px;font-size: 12px;color: #003e61;width: 100%;border-width: 1px;border-color: #ffffff;'><tbody class='nav'><tr><td>Location</td><td>Gouda (THE NETHERLANDS)</td></tr><tr><td>Users</td><td>1 users</td></tr><tr><td>Industry</td><td></td></tr><tr><td>Engagement Model</td><td>Customer Role Experience</td></tr><tr><td>Website</td><td><a href=' '> </a></td></tr></tbody></table></div>","tags": [{"tagName":"ds6w:where/ds6w:location","tagValue": ["EUROPE","The Netherlands","Gouda"]},{"tagName":"ds6w:who/ds6w:Users","tagValue":"<10"},{"tagName":"ds6w:what/ds6w:industry","tagValue":""},{ "tagName":"ds6w:how/ds6w:engagement model","tagValue":"Customer Role Experience"}]}, "geometry": { "type": "Point", "coordinates": [75.70,22.01 ] } },
					{ "type": "Feature", "properties": { "color": "#FFD700", "title": "<h3 style='margin-bottom: 0.1em'>ANDHRA PRADESH STATE SKILL DEVELOPMENT CORPORATION</h3>", "description": "<style>.nav td {  background-color: #f9f9f9;  border-width: 1px;  padding: 5px;  border-style: solid;  border-color: #d1d4d4;}</style><div style='max-height:600px;overflow:auto;'><table style='margin-bottom: 5px;font-size: 12px;color: #003e61;width: 100%;border-width: 1px;border-color: #ffffff;'><tbody class='nav'><tr><td>Location</td><td>Vijayawada (INDIA)</td></tr><tr><td>Users</td><td>841 users</td></tr><tr><td>Industry</td><td>Business Services</td></tr><tr><td>Engagement Model</td><td>Customer Solution Experience</td></tr><tr><td>Website</td><td><a href='http://apssdc.in/'>http://apssdc.in/</a></td></tr></tbody></table></div>","tags": [{"tagName":"ds6w:where/ds6w:location","tagValue": ["ASIA","India","VIJAYAWADA"]},{"tagName":"ds6w:who/ds6w:Users","tagValue":">100"},{"tagName":"ds6w:what/ds6w:industry","tagValue":"Business Services"},{ "tagName":"ds6w:how/ds6w:engagement model","tagValue":"Customer Solution Experience"}]}, "geometry": { "type": "Point", "coordinates": [80.82,16.78 ] } },
					{ "type": "Feature", "properties": { "color": "#005685", "title": "<h3 style='margin-bottom: 0.1em'>IOTOPUS</h3>", "description": "<style>.nav td {  background-color: #f9f9f9;  border-width: 1px;  padding: 5px;  border-style: solid;  border-color: #d1d4d4;}</style><div style='max-height:600px;overflow:auto;'><table style='margin-bottom: 5px;font-size: 12px;color: #003e61;width: 100%;border-width: 1px;border-color: #ffffff;'><tbody class='nav'><tr><td>Location</td><td>Gouda (THE NETHERLANDS)</td></tr><tr><td>Users</td><td>1 users</td></tr><tr><td>Industry</td><td></td></tr><tr><td>Engagement Model</td><td>Customer Role Experience</td></tr><tr><td>Website</td><td><a href=' '> </a></td></tr></tbody></table></div>","tags": [{"tagName":"ds6w:where/ds6w:location","tagValue": ["EUROPE","The Netherlands","Gouda"]},{"tagName":"ds6w:who/ds6w:Users","tagValue":"<10"},{"tagName":"ds6w:what/ds6w:industry","tagValue":""},{ "tagName":"ds6w:how/ds6w:engagement model","tagValue":"Customer Role Experience"}]}, "geometry": { "type": "Point", "coordinates": [4.70,52.01 ] } },
					{ "type": "Feature", "properties": { "color": "#005685", "title": "<h3 style='margin-bottom: 0.1em'>K_DLC CO__LTD</h3>", "description": "<style>.nav td {  background-color: #f9f9f9;  border-width: 1px;  padding: 5px;  border-style: solid;  border-color: #d1d4d4;}</style><div style='max-height:600px;overflow:auto;'><table style='margin-bottom: 5px;font-size: 12px;color: #003e61;width: 100%;border-width: 1px;border-color: #ffffff;'><tbody class='nav'><tr><td>Location</td><td>Gunpo (REPUBLIC OF KOREA)</td></tr><tr><td>Users</td><td>1 users</td></tr><tr><td>Industry</td><td></td></tr><tr><td>Engagement Model</td><td>Customer Role Experience</td></tr><tr><td>Website</td><td><a href=' '> </a></td></tr></tbody></table></div>","tags": [{"tagName":"ds6w:where/ds6w:location","tagValue": ["ASIA","Republic of Korea","Gunpo"]},{"tagName":"ds6w:who/ds6w:Users","tagValue":"<10"},{"tagName":"ds6w:what/ds6w:industry","tagValue":""},{ "tagName":"ds6w:how/ds6w:engagement model","tagValue":"Customer Role Experience"}]}, "geometry": { "type": "Point", "coordinates": [126.93,37.36 ] } }]
				};
				globeMap.addGeoJson(jsonContent);
				await sleep(2000);
				
				// move the camera without and with a distance option
				globeMap.moveCamera(48.13729150787028, -1.6215134739695942);
				await sleep(2000);
				globeMap.moveCamera(48.13729150787028, -1.6215134739695942, {zoomLevel: 12});
				await sleep(2000);*/
				// await sleep(2000);
				// globeMap.moveCamera(48.13729150787028, -1.6215134739695942, {zoomLevel: 17});				
				// await sleep(2000);
				// globeMap.moveCamera(48.13729150787028, -1.6215134739695942, {zoomLevel: 2});				
				// await sleep(2000);
				
				
				// try the Geocoding APIs
				// globeMap.geocoding("place de bretagne").then(function (result) {
				// 	console.log("Geocoding call on 'place de bretagne': " + JSON.stringify(result));
				// });
				// globeMap.reverseGeocoding(48.128444258937044, -1.6558077904350896, 18).then(function (result) {
				// 	console.log("Reverse geocoding call on '48.128444258937044, -1.6558077904350896': " + JSON.stringify(result));
				// });
				// globeMap.geocoding({"street": "6 rue de hué", "city": "rennes"}).then(function (result) {
				// 	console.log("Geocoding call on '{street: 6 rue de hué, city: rennes}': " + JSON.stringify(result));
				// });
				
				// try to set a callback
				/*globeMap.setOnSelectCallback(function(data) {console.log("callback function : " + data);});
				globeMap.setOnClickCallback(function(lat, lon) {console.log("click callback : " + lat + " - " + lon);});
				*/
				// add new markers
				var marker1 = globeMap.addMarker(48.13729150787028, -1.6215134739695942, "Dassault Systemes", "Cesson Sevigne Office", {"icon": "user-change", "notification": {"text": 99, "color": "#ff0000"}, "badge": {"icon":"search"}, color: "purple"});
				var marker2 = globeMap.addMarker(48.13729150787028, -1.6185, "Dassault Systemes 2", "Cesson Sevigne Office", {"notification": {"text": "7", "color": "#0000ff"}});
				var marker3 = globeMap.addMarker(48.1375, -1.6187, "Dassault Systemes 3", "Cesson Sevigne Office", {"color": "#00ff00", "badge": {"color": "#A0522D"}});
				// await sleep(2000);
				
				// // select one of the markers
				// globeMap.select([marker1]);
				
				// await sleep(2000);
				// globeMap.unselect([marker1]);
								
				// add connections
				var conn1 = globeMap.addLink([marker1, marker3], {"color": "#ff0000",
         "pattern": "dashdotted",
         "icon": "https://globeproc.uwglobe.com/mfe10/flowicons/planecustom.svg"
        });
        var conn2 = globeMap.addLink([marker1, marker2], {"color": "#00ff00",
         "pattern": "dashdotted",
         "icon": "https://globeproc.uwglobe.com/mfe10/flowicons/planecustom.svg"
        });

        conn1.setOnSelectCallback((link) => console.log("YOHOHOHO linkId = " + link.getId()));
        marker1.setOnUnSelectCallback((marker) => console.log("UNSELECT markerId = " + marker.getId()));
        globeMap.moveCamera(48.13729150787028, -1.6215134739695942, { zoomLevel: 16});
				await sleep(2000);
				conn1.setIcon("https://globeproc.uwglobe.com/mfe10/flowicons/boatcustom.svg");
				await sleep(2000);
        marker1.setTitle("Bonsoir");
        // marker1.setColor("purple");
        conn1.select();
        conn1.setColor("blue")
        conn1.setPattern("solid");
        await sleep(2000);
        conn1.setDestination(marker2)
        marker2.setBadge({"icon":"search"});
        await sleep(2000);
        marker3.setDesc("New Desc");
        marker3.setLng(-2.7187);
        conn1.setOrigin(marker3);
        await sleep(2000);
        globeMap.setEditMode("link");
        // globeMap.removeLink(conn1);
        // conn1.setColor("purple")
				await sleep(30000);				
        console.log("default mode");
        globeMap.setEditMode("default");
/*
				
				await sleep(2000);
				marker1.delete();
				await sleep(500);
				marker2.delete();
				await sleep(500);
				marker3.delete();
				
				
				// valid big geojson content
				var bigGeoContent = '{  "type": "FeatureCollection",  "features": [    {      "type": "Feature",      "properties": {        "id": 1,        "start_city": "New York",        "start_country": "United States",        "end_city": "Paris",        "end_country": "France",        "flow_type": "Plane",        "icon": "https://globeproc.uwglobe.com/mfe10/flowicons/planecustom.svg"      },      "geometry": {        "type": "LineString",        "coordinates": [          [            -73.935242,            40.730610          ],          [            2.34428,            48.85922          ]        ]      }    },    {      "type": "Feature",      "properties": {        "id": 2,        "start_city": "Cape Town",        "start_country": "South Africa",        "end_city": "New York",        "end_country": "United States",        "flow_type": "Boat",        "icon": "https://globeproc.uwglobe.com/mfe10/flowicons/boatcustom.svg"      },      "geometry": {        "type": "LineString",        "coordinates": [          [            18.423300,            -33.918861          ],          [            -73.935242,            40.730610          ]        ]      }    },    {      "type": "Feature",      "properties": {        "id": 3,        "start_city": "Hechi",        "start_country": "China",        "end_city": "Paris",        "end_country": "France",        "flow_type": "Plane",        "icon": "https://globeproc.uwglobe.com/mfe10/flowicons/planecustom.svg"      },      "geometry": {        "type": "LineString",        "coordinates": [          [            109.6091129,            23.09653465          ],          [            2.34428,            48.85922          ]        ]      }    },    {      "type": "Feature",      "properties": {        "id": 4,        "start_city": "Paris",        "start_country": "France",        "end_city": "Abidjan",        "end_country": "Ivory Coast",        "flow_type": "Plane",        "icon": "https://globeproc.uwglobe.com/mfe10/flowicons/planecustom.svg"      },      "geometry": {        "type": "LineString",        "coordinates": [          [            2.34428,            48.85922          ],          [            -4.024429,            5.345317          ]        ]      }    },    {      "type": "Feature",      "properties": {        "id": 5,        "start_city": "Paris",        "start_country": "France",        "end_city": "Montpellier",        "end_country": "France",        "flow_type": "Truck",        "icon": "https://globeproc.uwglobe.com/mfe10/flowicons/truckcustom.svg"      },      "geometry": {        "type": "LineString",        "coordinates": [          [            2.34428,            48.85922          ],          [            3.876716,            43.610769          ]        ]      }    },    {      "type": "Feature",      "properties": {        "id": 6,        "start_city": "Helsinki",        "start_country": "Finland",        "end_city": "Cape Town",        "end_country": "South Africa",        "flow_type": "Plane",        "icon": "https://globeproc.uwglobe.com/mfe10/flowicons/planecustom.svg"      },      "geometry": {        "type": "LineString",        "coordinates": [          [            24.945831,            60.192059          ],          [            18.423300,            -33.918861          ]        ]      }    },    {      "type": "Feature",      "properties": {        "id": 7,        "start_city": "Rio de Janeiro",        "start_country": "Brasil",        "end_city": "Antananarivo",        "end_country": "Madagascar",        "flow_type": "Plane",        "icon": "https://globeproc.uwglobe.com/mfe10/flowicons/planecustom.svg"      },      "geometry": {        "type": "LineString",        "coordinates": [          [            -43.196388,            -22.908333          ],          [            47.516667,            -18.933333          ]        ]      }    },    {      "type": "Feature",      "properties": {        "id": 8,        "start_city": "New York",        "start_country": "United States",        "end_city": "Rabat",        "end_country": "Morocco",        "flow_type": "Boat",        "icon": "https://globeproc.uwglobe.com/mfe10/flowicons/boatcustom.svg"      },      "geometry": {        "type": "LineString",        "coordinates": [          [            -73.935242,            40.730610          ],          [            -6.841650,            34.020882          ]        ]      }    },    {      "type": "Feature",      "properties": {        "id": 9,        "start_city": "Paris",        "start_country": "France",        "end_city": "Melbourne",        "end_country": "Australia",        "flow_type": "Plane",        "icon": "https://globeproc.uwglobe.com/mfe10/flowicons/planecustom.svg"      },      "geometry": {        "type": "LineString",        "coordinates": [          [            2.34428,            48.85922          ],          [            144.946457,            -37.840935          ]        ]      }    }  ]}'//getContent("https://globeproc.uwglobe.com/mfe10/data-test-geojson/curved_flows/flow_test.geojson");
				globeMap.addGeoJson(JSON.parse(bigGeoContent));*/
				
				
				// test reproj
				// globeMap.proj({x:-180507.2366240,y:6129749.2448020}, "EPSG:900913", "EPSG:27561", false).then(function (reprojCoords) {
				// 	console.log("reprojected coords: " + reprojCoords.x + " - " + reprojCoords.y);
				// });
        // console.log("toto");
				// await sleep(2000);
        // console.log("Yo")
        // globeMap.display("bubble", {
        //   sizePropertyName: "amount1",
        // })
				// await sleep(5000);
        // console.log("Yo")
        // globeMap.display("bubble", {
        //   sizePropertyName: "amount12",
        //   scale: 2,
        //   primaryColor: " #ff5733",
        //   strokeColor: "lightgreen",
        //   strokeWidth: 3
        // })
        // await sleep(5000);
        // console.log("Yo")
        // globeMap.display();
				// await sleep(5000);
        // console.log("Yo")
        // globeMap.display("bubble", {
        //   sizePropertyName: "amount1",
        //   gradiantSettings: {
        //     colorPropertyName: "amount2",
        //     secondaryColor: "purple"
        //   }
        // })


			}
			console.log("LAUNCH");
			launchTest();
			
        });
    </script>



</head>

<body>
    <div>
        <div id="left-map">
        </div>
        <div id="right">
            <div id="right-left">
            </div>
            <div id="right-right">
            </div>
            </div>
        </div>
</body>

</html>
