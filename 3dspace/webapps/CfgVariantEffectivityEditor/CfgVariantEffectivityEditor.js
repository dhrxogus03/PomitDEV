define("DS/CfgVariantEffectivityEditor/scripts/CfgVariantEffectivityModel",["UWA/Core","DS/TreeModel/TreeNodeModel","DS/CfgBaseUX/scripts/CfgColumnManager","UWA/Class/Model","DS/CfgBaseUX/scripts/CfgUXEnvVariables","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json","i18n!DS/CfgVariantEffectivityEditor/assets/nls/CfgVariantEffectivityEditor"],function(e,t,i,o,a,n,s){return o.extend({columnsCounter:0,_onNodeModelUpdateSubscriptionToken:"",defaults:function(){return{title:"",subtitle:"",content:"",image:"",icon:"",color:"",url:"",idModel:"",jsonAttr:"",evoExp:"",columns:[],treeDocument:null}},registeronNodeUpdateEvent:function(){var e=this;this._onNodeModelUpdateSubscriptionToken=this.get("treeDocument").onNodeModelUpdate(function(t){if(1==Object.keys(t.data.attributes).length&&1==Object.keys(t.data.attributes).at(0).includes("_")){let i=Object.keys(t.data.attributes).at(0),o=t.data.attributes[i];e.undoRegisteronNodeUpdateEvent(),e.updateVariantsSelection(t.data.nodeModel,i,o),e.registeronNodeUpdateEvent()}})},undoRegisteronNodeUpdateEvent:function(){this.get("treeDocument").unsubscribe(this._onNodeModelUpdateSubscriptionToken)},getXMLExpression:function(e){var t=this.get("columns"),i=this.get("treeDocument");i.prepareUpdate();for(var o=i.getRoots(),a=[],n=0;n<t.length;n++){var s="",l=0;if("tristate"===t[n].typeRepresentation){for(var r=0;r<o.length;r++){var d=o[r].getChildren();if("Exclusive"!=o[r]._options.data.featureType)for(var c=0;c<d.length;c++){var u="";if("undefined"!=(v=d[c]._options.grid[t[n].dataIndex])){var p="",f="";"TXT"==e?(p=encodeURIComponent(o[r]._options.data.label),f=encodeURIComponent(d[c]._options.data.label)):(p=o[r]._options.data.value.replace(/&(?!amp;)/g,"&amp;"),f=d[c]._options.data.value.replace(/&(?!amp;)/g,"&amp;")),u='<Feature Type = "ConfigFeature" Name = "'+p+'"><Feature Type = "ConfigFeature" Name = "'+f+'"/></Feature>',l++}"undefined"!=v&&0==v&&(u="<NOT>"+u+"</NOT>"),s+=u}else{var h="",g="";for(u="",c=0;c<d.length;c++){var v;"undefined"!=(v=d[c]._options.grid[t[n].dataIndex])&&(g=g+'<Feature Type = "ConfigFeature" Name = "'+(f="TXT"==e?encodeURIComponent(d[c]._options.data.label):d[c]._options.data.value.replace(/&(?!amp;)/g,"&amp;"))+'"/>'),0==v&&(h=!0)}""!=g&&(u='<Feature Type = "ConfigFeature" Name = "'+(p="TXT"==e?encodeURIComponent(o[r]._options.data.label):o[r]._options.data.value.replace(/&(?!amp;)/g,"&amp;"))+'">'+g+"</Feature>",l++),1==h&&(u="<NOT>"+u+"</NOT>"),s+=u}}""!=s&&a.push({xml:s,featureInCondition:l})}}for(var m="",C=0;C<a.length;C++)a[C].featureInCondition>1?m=m+"<AND>"+a[C].xml+"</AND>":m+=a[C].xml;a.length>1&&(m="<OR>"+m+"</OR>");var y="",V="";return V="TXT"==e?encodeURIComponent(this.get("title")):this.get("subtitle").replace(/&(?!amp;)/g,"&amp;"),""!=m&&(y='<Context HolderType = "Model" HolderName = "'+V+'">'+m+"</Context>"),i.pushUpdate(),y},updateVariantsSelection:function(e,t,i){if(e&&null!=e.getParent()._options&&e.getParent()._options.children.length>1&&null!=e.getParent()._options.data&&"Exclusive"==e.getParent()._options.data.featureType){console.log("inside updateVariantsSelection");var o=e;this.get("treeDocument").prepareUpdate();let a=o.getParent().getAllDescendants();for(let e=0;e<a.length;e++){let o=a[e]._options.grid[t];if(1==i&&0==o||0==i&&1==o){let i={};i[t]="undefined",a[e].updateOptions({grid:i})}}this.get("treeDocument").pushUpdate()}this.onModelUpdateCallback&&this.onModelUpdateCallback()},deleteColumns:function(e){for(var t=this.get("columns"),i=[],o=[],a=0;a<t.length;a++)-1==e.indexOf(a)||"string"==t[a].typeRepresentation?o.push(t[a]):i.push(t[a].dataIndex);var n=this.get("treeDocument");n.prepareUpdate();for(var s=n.getAllDescendants(),l=0;l<s.length;l++){var r=s[l],d=r._options.grid;for(a=0;a<i.length;a++)delete d[i[a]];r.updateOptions({grid:d})}n.pushUpdate(),this.set("columns",o)},copyColumns:function(e){for(var t=this.get("columns"),i=[],o=0;o<e.length;o++)"string"!=t[e[o]].typeRepresentation&&i.push(e[o]);e=i;var a=[],n=[];for(o=0;o<e.length;o++)n.push(t[e[o]].dataIndex),a.push(this.addColumn());for(o=0;o<e.length;o++){var s=this.get("treeDocument");s.prepareUpdate();for(var l=s.getAllDescendants(),r=0;r<l.length;r++){for(var d=l[r],c=d._options.grid,u=0;u<a.length;u++)c[a[o]]=c[n[o]];d.updateOptions({grid:c})}s.pushUpdate()}},addRow:function(e){console.log(e),this.undoRegisteronNodeUpdateEvent();var o=i.getColumnIndexes("VariantsAndOptionGroups"),a=this.get("columns"),n=this.get("treeDocument");n.prepareUpdate();for(var s={},l={},r=0;r<a.length;r++)"tree"!=a[r].dataIndex&&(l[a[r].dataIndex]="",s[a[r].dataIndex]="undefined");for(r=0;r<o.length;r++)l[o[r]]="",s[o[r]]="undefined";var d=n.getRoots();if(null==e.items){for(var c=0,u=0;u<d.length;u++)if(d[u]._options.data.value==e.parentReference.value){for(var p=Object.assign({},s),f=new t({label:e.label,grid:p,data:{value:e.value,label:e.label,featureType:e.featureType}}),h="-1",g=0;g<e.originalData.feature.options.length;g++){var v=e.originalData.feature.options[g].name;e.value==v&&(h=g)}"-1"!=h&&this.updateAttributes(f,e.originalData.feature.options[h]),d[u].addChild(f),c=1}if(0==c){p=Object.assign({},l);var m=new t({label:e.parentReference.label,grid:p,data:{value:e.parentReference.value,label:e.parentReference.label,featureType:e.featureType}});this.updateAttributes(m,e.originalData.feature),n.addRoot(m);p=Object.assign({},s),f=new t({label:e.label,grid:p,data:{value:e.value,label:e.label,featureType:e.featureType}});this.updateAttributes(f,e.originalData.self),m.addChild(f),m.expandAll()}}else{p=Object.assign({},l),m=new t({label:e.label,grid:p,data:{value:e.value,label:e.label,featureType:e.featureType}});this.updateAttributes(m,e.originalData.feature),n.addRoot(m);for(g=0;g<e.items.length;g++){var C=e.items[g];p=Object.assign({},s);Object.assign({},e).self=C;f=new t({label:C.label,grid:p,data:{value:C.value,label:C.label,featureType:e.featureType}});this.updateAttributes(f,e.originalData.feature.options[g]),m.addChild(f),m.expandAll()}}n.pushUpdate(),this.registeronNodeUpdateEvent()},addRowWebUX:function(e){console.log(e),this.undoRegisteronNodeUpdateEvent();var o=i.getColumnIndexes("VariantsAndOptionGroups"),a=this.get("columns"),n=this.get("treeDocument");n.prepareUpdate();for(var s={},l={},r=0;r<a.length;r++)"tree"!=a[r].dataIndex&&(l[a[r].dataIndex]="",a[r].dataIndex.includes("_")&&"tristate"===a[r].typeRepresentation?s[a[r].dataIndex]="undefined":s[a[r].dataIndex]="");for(r=0;r<o.length;r++)l[o[r]]="",s[o[r]]="undefined";var d=n.getRoots();if(null==e.children){for(var c=0,u=0;u<d.length;u++)if(d[u]._options.data.value==e._parentNode.value){for(var p=Object.assign({},s),f=new t({label:e.label,grid:p,data:{value:e.value,label:e.label,featureType:e.featureType}}),h="-1",g=0;g<e.originalData.feature.options.length;g++){var v=e.originalData.feature.options[g].name;e.value==v&&(h=g)}if("-1"!=h&&this.updateAttributes(f,e.originalData.feature.options[h]),d[u].options&&d[u].options.children){d[u].options.children.map(e=>e.options.data.value).includes(e.value)||d[u].addChild(f)}c=1}if(0==c){p=Object.assign({},l);var m=new t({label:e._parentNode.label,grid:p,data:{value:e._parentNode.value,label:e._parentNode.label,featureType:e.featureType}});this.updateAttributes(m,e.originalData.feature),n.addRoot(m);p=Object.assign({},s),f=new t({label:e.label,grid:p,data:{value:e.value,label:e.label,featureType:e.featureType}});this.updateAttributes(f,e.originalData.self),m.addChild(f),m.expandAll()}}else{let i,o=!1;if(d.forEach((t,a)=>{t._options.data.value===e.value&&(o=!0,i=a)}),!1===o){p=Object.assign({},l),m=new t({label:e.label,grid:p,data:{value:e.value,label:e.label,featureType:e.featureType}});this.updateAttributes(m,e.originalData.feature),n.addRoot(m);for(g=0;g<e.children.length;g++){var C=e.children[g]._options;p=Object.assign({},s);Object.assign({},e).self=C;f=new t({label:C.label,grid:p,data:{value:C.value,label:C.label,featureType:e.featureType}});this.updateAttributes(f,e.originalData.feature.options[g]),m.addChild(f),m.expandAll()}}else if(!0===o){let o=[];d[i]._options.children.forEach(e=>{o.push(e._options.data.value)});for(g=0;g<e.children.length;g++){C=e.children[g]._options,p=Object.assign({},s);Object.assign({},e).self=C;f=new t({label:C.label,grid:p,data:{value:C.value,label:C.label,featureType:e.featureType}});o.includes(C.value)||(this.updateAttributes(f,e.originalData.feature.options[g]),d[i].addChild(f))}}}n.pushUpdate(),this.registeronNodeUpdateEvent()},updateAttributes:function(e,t){for(var o=e._options.grid,n=i.getColumnIndexes("VariantsAndOptionGroups"),s=0;s<n.length;s++)o[n[s]]=t[n[s]];!0===a.getCfgUXEnvVariables().isCustomAttributesEnabled&&(e.options.data.self={},e.options.data.self.physicalID=t.physicalID),e.updateOptions({grid:o})},clearRows:function(){var e=this.get("treeDocument");e.prepareUpdate(),e.selectAll(),this.removeRows(),e.pushUpdate()},clearColumns:function(){for(var e=this.get("columns"),t=[],i=0;i<e.length;i++)0!=i&&"string"!=e[i].typeRepresentation&&i!=e.length-1||t.push(e[i]);this.set("columns",t)},removeRows:function(){this.undoRegisteronNodeUpdateEvent(),this.deletedRowValues=[],this.deletedRowPhysicalId=[];var e=this.get("treeDocument"),t=e.getSelectedNodes(),i=[];e.prepareUpdate();for(var o=0;o<t.length;o++){if(1==t[o].hasChildren()){t[o].remove(),this.deletedRowValues.push(t[o]._options.data.value),t[o].options&&t[o].options.data&&t[o].options.data.self&&t[o].options.data.self.physicalID&&this.deletedRowPhysicalId.push(t[o].options.data.self.physicalID);let e=t[o].options.children.map(e=>{if(e.options.data&&e.options.data.self&&e.options.data.self.physicalID)return e.options.data.self.physicalID});this.deletedRowPhysicalId=this.deletedRowPhysicalId.concat(e)}}e.pushUpdate(),t=e.getSelectedNodes(),e.prepareUpdate();for(o=0;o<t.length;o++){0==t[o].hasChildren()&&(i.push(t[o].getParent()),t[o].remove(),this.deletedRowValues.push(t[o]._options.data.value),t[o].options.data&&t[o].options.data.self&&t[o].options.data.self.physicalID&&this.deletedRowPhysicalId.push(t[o].options.data.self.physicalID),i.length>0&&i[0].options.data.value&&this.deletedRowValues.push(i[0].options.data.value))}for(o=0;o<i.length;o++){0==i[o].hasChildren()&&(i[o].remove(),this.deletedRowValues.push(i[o]._options.data.value),i[o]._options.data.self&&i[o]._options.data.self.physicalID&&this.deletedRowPhysicalId.push(i[o]._options.data.self.physicalID))}e.pushUpdate(),this.registeronNodeUpdateEvent()},addColumn:function(){this.undoRegisteronNodeUpdateEvent();var e=this.get("columns"),t=this.getColumnDefination(),i=t.dataIndex="_"+this.columnsCounter;this.columnsCounter++,t.text=s.Combination+this.columnsCounter,e.push(t);var o=this.get("treeDocument");o.prepareUpdate();for(var a=o.getAllDescendants(),n=0;n<a.length;n++){var l={};l[i]="",1!=a[n].hasChildren()?(l[i]="undefined",a[n].updateOptions({grid:l})):a[n].updateOptions({grid:l})}return o.pushUpdate(),this.registeronNodeUpdateEvent(),i},addBasicAndCustomColumns:function(e){var t=this.get("columns");let i=t.findIndex(e=>e.dataIndex.includes("_")&&"tristate"===e.typeRepresentation),o=t.map(e=>e.dataIndex);e.length>0&&e.forEach(e=>{o.includes(e.dataIndex)||t.splice(i,0,e)})},getSelectedFeatureOptions:function(){for(var e=[],t=this.get("treeDocument").getAllDescendants(),i=0;i<t.length;i++)e.push(t[i]._options.data.value);let o=a.getCfgUXEnvVariables().isWebUXAutocompleteEnabled,n=this.get("treeDocumentVariantDictionary");if(1==o&&n){n.getAllDescendants().forEach(t=>{if(t.options&&t.options.children){if(!1===t.options.children.map(e=>e.options.grid.name).every(t=>e.includes(t))){let i=e.indexOf(t.options.grid.name);i>=0&&e.splice(i,1)}}})}return e},getDeletedFeatureOptions:function(){return this.deletedRowValues?this.deletedRowValues:void 0},getColumnDefination:function(){return{dataIndex:"",typeRepresentation:"tristate",editionPolicy:"EditionInPlace",alwaysVisibleFlag:"true",width:"29",minWidth:"29",resizableFlag:!0,sortableFlag:!1,groupableFlag:!1}},ConvertJsonEffectivitytoColumns:function(e,t){var i={text:s.Title,dataIndex:"tree",typeRepresentation:"string",alwaysVisibleFlag:"true",width:"220",minWidth:"220",pinned:"left"},o=[];o.push(i),o=o.concat(t);for(var a=0;a<e.Combinations.length;a++){var n=this.getColumnDefination();n.dataIndex="_"+this.columnsCounter,this.columnsCounter++,n.text=s.Combination+this.columnsCounter,o.push(n)}return o}})}),define("DS/CfgVariantEffectivityEditor/scripts/CfgVariantAutocomplete",["UWA/Core","DS/WebappsUtils/WebappsUtils","DS/CfgBaseUX/scripts/CfgUtility","DS/UIKIT/Autocomplete","i18n!DS/CfgVariantEffectivityEditor/assets/nls/CfgVariantEffectivityEditor"],function(e,t,i,o,a){var n={initialiseAutocomplete:function(e){this.options=e,e.parent.autocompleteContainer.setHTML(""),this.autocompleteHierarchicalInput=new o({multiSelect:!1,showSuggestsOnFocus:!1,placeholder:a.Auto_Place_Holder,disabled:!0,allowFreeInput:!0,events:{onSelect:function(e,t){event.stopPropagation(),n.options.onSelectCallback(e),this.onUnselect(e)},onUnselect:function(e,t){}}});var t=UWA.createElement("div",{class:"CfgAutoPickContainer"});t.setStyles({position:"relative",marginRight:"15px",display:"flex"}),this.autocompleteHierarchicalInput.inject(t),t.inject(e.parent.autocompleteContainer),e.parent.autocompleteContainer.getElement(".autocomplete").setStyle("width","100%"),e.parent.autocompleteContainer.getElement(".autocomplete-reset").setStyles({right:"30px",top:"6px"});var i=UWA.createElement("span",{class:"fonticon fonticon-1x fonticon-search"});i.setStyles({"font-size":"14px !important",position:"absolute",right:"2px",bottom:"10px","margin-top":"5px"});var s=UWA.createElement("div",{class:"imgSearchContainer1",id:"searchIconCont"});return s.style.opacity="0.5",s.addClassName("imgFocusIdenty"),s.addContent(i),i.inject(s),s.addEventListener("click",function(){n.autocompleteHierarchicalInput.showAll()}),s.inject(t),n},setDisable:function(e){this.autocompleteHierarchicalInput.getItems().forEach(function(t){n.autocompleteHierarchicalInput.enableItem(t.value),1==e.includes(t.value)&&n.autocompleteHierarchicalInput.disableItem(t.value)})},drawDictionary:function(e){if(0==e.length)i.showwarning(a.No_Conf_Features_Title,"warning");else{for(var t={name:"Objects",items:[]},o=0;o<e.length;o++)if(0!=e[o].options.length){var s={};s.featureType=e[o].selectionType,s.label=e[o].displayName,s.value=e[o].name,s.items=[],s.originalData={feature:e[o],self:e[o]};for(var l=0;l<e[o].options.length;l++){var r={};r.featureType=e[o].selectionType,r.label=e[o].options[l].displayName,r.value=e[o].options[l].name,r.parentSelectionType=e[o].selectionType,r.selection=e[o].options[l].selection,r.originalData={feature:e[o],self:e[o].options[l]},s.items.push(r)}t.items.push(s)}this.autocompleteHierarchicalInput.addDataset(t),this.autocompleteHierarchicalInput.getItems().forEach(function(e){n.autocompleteHierarchicalInput.enableItem(e.value)}),n.autocompleteHierarchicalInput.setDisabled(!1)}}};return n}),define("DS/CfgVariantEffectivityEditor/scripts/CfgVariantEditorDataGridViewToolbar",["i18n!DS/CfgVariantEffectivityEditor/assets/nls/CfgVariantEffectivityEditor"],function(e){var t=Object.create(null);return t.toolbar=null,t.writetoolbarDefination=function(){var t={entries:[{id:"ID_SEARCHFEATUREOPTION",dataElements:{typeRepresentation:"string",value:"",label:"",visibleFlag:!1,tooltip:e.CFG_Search_Features,placeholder:e.CFG_Search_Features,overflowPriority:"none",displayLabel:!0},position:"far",children:[]},{id:"ID_Plus",dataElements:{typeRepresentation:"functionIcon",tooltip:e.Add_Col,disabled:!1,icon:{iconName:"plus",fontIconFamily:1},category:"Touch",action:{module:"DS/CfgVariantEffectivityEditor/scripts/CfgVariantEditorDataGridViewToolbar",func:"onPlusClick"}},position:"far",children:[]},{id:"ID_Copy",dataElements:{typeRepresentation:"functionIcon",tooltip:e.Clone_Col,disabled:!0,icon:{iconName:"duplicate",fontIconFamily:1},category:"Touch",action:{module:"DS/CfgVariantEffectivityEditor/scripts/CfgVariantEditorDataGridViewToolbar",func:"onCopyClick"}},position:"far",children:[]},{id:"ID_Delete",dataElements:{typeRepresentation:"functionIcon",tooltip:e.Del_Col,disabled:!0,icon:{iconName:"trash",fontIconFamily:1},category:"Touch",action:{module:"DS/CfgVariantEffectivityEditor/scripts/CfgVariantEditorDataGridViewToolbar",func:"onDeleteClick"}},position:"far",children:[]},{id:"ID_SwitchView",dataElements:{typeRepresentation:"functionIcon",tooltip:e.CFG_HorizontalSwitchView,disabled:!0,visibleFlag:!0,icon:{iconName:"table",fontIconFamily:1},category:"TouchNext",action:{module:"DS/CfgVariantEffectivityEditor/scripts/CfgVariantEditorDataGridViewToolbar",func:"onSwitchViewClick"}},position:"far",children:[]},{id:"ID_Dictionary",dataElements:{typeRepresentation:"functionIcon",tooltip:e.DictionaryHeader,disabled:!1,icon:{iconName:"book-open",fontIconFamily:1},category:"TouchNext",action:{module:"DS/CfgVariantEffectivityEditor/scripts/CfgVariantEditorDataGridViewToolbar",func:"onShowDictionaryClick"}},position:"far",children:[]},{id:"ID_ColumnManager",dataElements:{typeRepresentation:"functionIcon",tooltip:e.ColumnPropertiesManagerHeader,disabled:!1,visibleFlag:!1,icon:{iconName:"cog",fontIconFamily:1},category:"TouchNext",action:{module:"DS/CfgVariantEffectivityEditor/scripts/CfgVariantEditorDataGridViewToolbar",func:"onUserSettingsClick"}},position:"far",children:[]}]};return JSON.stringify(t)},t.onPlusClick=function(e){e._event="ID_PLUS",t.onToolbarClickCallback(e)},t.onCopyClick=function(e){e._event="ID_COPY",t.onToolbarClickCallback(e)},t.onClearClick=function(e){e._event="ID_CLEAR",t.onToolbarClickCallback(e)},t.onDeleteClick=function(e){e._event="ID_DELETE",t.onToolbarClickCallback(e)},t.onShowDictionaryClick=function(e){e._event="ID_DICTIONARY",t.onToolbarClickCallback(e)},t.onSwitchViewClick=function(e){e._event="ID_HORIZONTALVIEW",t.onToolbarClickCallback(e)},t.onUserSettingsClick=function(e){e._event="ID_USERSETTINGS",e.viewId="effectivityView",t.onToolbarClickCallback(e)},t.setToolbarState=function(e){if(e)for(var i=0;i<e.length;i++){var o=e[i];t.toolbar.updateNodeModel(o.IdValue,{disabled:o.StateValue})}},t}),define("DS/CfgVariantEffectivityEditor/scripts/CfgTweakerVerticalTristate",["UWA/Core","DS/Tweakers/TweakerBase","DS/Utilities/Dom","DS/Utilities/Utils","DS/Core/PointerEvents"],function(e,t,i,o,a){"use strict";var n=t.inherit({name:"TweakerTristate",publishedProperties:{value:{defaultValue:!1,type:"boolean",advancedSetter:!0},valueType:{defaultValue:"boolean",type:"string"},displayStyle:{defaultValue:"checkbox",type:"string"},minValue:{defaultValue:"",type:"string"}},computeTweakerContentLength:function(){return this._getCurrentTouchMode()?19:14},_upgradeValue:function(e){return"1"===e||1===e||"true"===e||!0===e||"0"!==e&&0!==e&&"false"!==e&&!1!==e&&(""==e?"":"undefined")}}),s=function(e,i){t.prototype.baseViewModule.call(this,e,i)};o.applyMixin(s,t.prototype.baseViewModule);var l=function(e,t){s.call(this,e,t)};o.applyMixin(l,s),l.prototype.buildView=function(){if(this._tweaker.elements.container){var t,i=this._options.viewOptions||{};i.type=this._options.viewOptions.displayStyle,i.touchMode=this._tweaker._getCurrentTouchMode(),i.fireOnlyFromUIInteractionFlag=!0,this._view=new e.Element("div"),this.icon=new e.Element("div"),this.icon.inject(this._view),this.icon.setStyles({height:"100%",width:"100%"}),"undefined"===this._tweaker.value?t="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-checkbox-off wux-ui-3ds-lg unselectedIcon":!0===this._tweaker.value?t="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check wux-ui-3ds-lg checkIcon":!1===this._tweaker.value&&(t="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong wux-ui-3ds-lg notIcon"),this.icon.addClassName(t),this.setValue(this._tweaker.value)}},l.prototype.handleEvents=function(){var e=this._view,t=this.icon,o=this._tweaker;i.addEventOnElement(o,e,a.POINTERHIT,function(e){e.stopPropagation(),t.className="";var i="";!1===o.value?(i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-checkbox-off wux-ui-3ds-lg unselectedIcon",o.value="undefined"):!0===o.value?(i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-checkbox-off wux-ui-3ds-lg unselectedIcon",o.value="undefined"):"undefined"===o.value&&(o.value=!0,i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check wux-ui-3ds-lg checkIcon"),t.addClassName(i)})},l.prototype.setValue=function(e,t){if(this.icon){var i="";"undefined"===this._tweaker.value?i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-checkbox-off wux-ui-3ds-lg unselectedIcon":!0===this._tweaker.value?i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check wux-ui-3ds-lg checkIcon":!1===this._tweaker.value&&(i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong wux-ui-3ds-lg notIcon"),this.icon.className="",this.icon.addClassName(i)}},l.prototype.setTouchMode=function(e,t){this.icon&&(this.icon.touchMode=e)};var r=function(e,t){s.call(this,e,t)};return o.applyMixin(r,s),r.prototype.buildView=function(){var t;this._tweaker.elements.container&&(this._view=new e.Element("span"),"undefined"===this._tweaker.value?t="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-checkbox-off wux-ui-3ds-lg unselectedIcon":!0===this._tweaker.value?t="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check wux-ui-3ds-lg ":!1===this._tweaker.value&&(t="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong wux-ui-3ds-lg "),this._view.addClassName(t),this.setValue(this._tweaker.value),this.setTouchMode(this._tweaker._getCurrentTouchMode()))},r.prototype.setValue=function(e,t){if(this._view){var i="";"undefined"===this._tweaker.value?i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-checkbox-off wux-ui-3ds-lg unselectedIcon":!0===this._tweaker.value?i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check wux-ui-3ds-lg ":!1===this._tweaker.value&&(i="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong wux-ui-3ds-lg "),this._view.className="",this._view.addClassName(i)}},r.prototype.setTouchMode=function(e,t){this._view&&(this._tweaker.readOnly?this._view.style.paddingLeft=e?"14px":"7px":this._view.touchMode=e)},n.prototype.baseViewModule=s,n.prototype.VIEW_MODULES={switch:{classObject:l,options:{viewOptions:{displayStyle:"switch"}}},readOnly:{classObject:r,options:{viewOptions:{displayStyle:"switch"}}},checkbox:{classObject:l,options:{viewOptions:{displayStyle:"checkbox"}}}},n.prototype.registerViewModule=function(e,t){},n}),define("DS/CfgVariantEffectivityEditor/scripts/CfgVariantWUXAutocomplete",["DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/WUXAutoComplete/AutoComplete","DS/CfgBaseUX/scripts/CfgUtility","i18n!DS/CfgVariantEffectivityEditor/assets/nls/CfgVariantEffectivityEditor"],function(e,t,i,o,a){var n={model:null,myAutoComplete:null,selectedist:[],initialiseAutocomplete:function(e){this.options=e,e.parent.autocompleteContainer.setHTML("");return this.createModel([]),this.createAutoComplete(),this.myAutoComplete.inject(e.parent.autocompleteContainer),this.selectedist=[],n},enableAutocompleteItems:function(e,t){if(this.selectedist=[...e],this.itemsDeleted=t,this.myAutoComplete&&this.myAutoComplete._dataGridView){this.myAutoComplete.value=void 0;let e=this.myAutoComplete._dataGridView.getTreeDocument();e.prepareUpdate(),e.getAllDescendants().forEach(e=>{this.itemsDeleted&&this.itemsDeleted.includes(e._options.value)&&(e._isHighlighted=!1,e._isSelected=!1,e._options.children&&e._options.children.forEach(e=>{e._isHighlighted=!1,e._isSelected=!1}))}),e.pushUpdate(),model.expandAll()}},drawDictionary:function(e,t){let i=e,n=!0;0==i.length?o.showwarning(a.No_Conf_Features_Title,"warning"):n=!1,t.parent.autocompleteContainer.setHTML(""),this.createModel(i),this.myAutoComplete.elementsTree=model,this.myAutoComplete.disabled=n,this.myAutoComplete.inject(t.parent.autocompleteContainer)},createNode:function(e,i,o){return new t({label:e.displayName,value:e.name,icon:i,featureType:e.selectionType,originalData:o,grid:{tags:e.displayName+e.name}})},createModel:function(t){model=new e({shouldBeSelected:function(e){return(!e||!0!==e._isSelected)&&(!e||!n.selectedist.includes(e.options.value))}}),model.prepareUpdate();let i=enoviaServerFilterWidget.baseURL+"/snresources/images/icons/large/I_Variant_Thumbnail.png",o=enoviaServerFilterWidget.baseURL+"/snresources/images/icons/large/I_VariantValue_Thumbnail.png";for(var a=0;a<t.length;a++){let e={feature:t[a],self:t[a]},n=this.createNode(t[a],i,e);model.addRoot(n);for(var s=0;s<t[a].options.length;s++){let e={feature:t[a],self:t[a].options[s]};var l=this.createNode(t[a].options[s],o,e);n.addChild(l)}}model.expandAll(),model.pushUpdate()},createAutoComplete:function(){this.myAutoComplete=new i({elementsTree:model,allowFreeInputFlag:!1,multiSearchMode:!1,disabled:!0,filterCB:function(e){this.filterItems(e,{property:"tags"})}}),this.myAutoComplete.addEventListener("change",function(e){var t=null;if(e.dsModel.selectedItems){t=e.dsModel.selectedItems.options;if(e.dsModel.selectedItems._isHighlighted=!0,!t.children){n.selectedist.push(t.value);let i={};(i=e.dsModel.selectedItems.options)._parentNode=e.dsModel.selectedItems._parentNode.options,n.options.onSelectCallback(i)}t.children&&(t.children.forEach(e=>{n.selectedist.push(e.options.value),e._isHighlighted=!0}),n.options.onSelectCallback(t))}document.querySelector(".CfgBodyContainer #containerAuto >div >div >input").value="",model.expandAll()}),this.myAutoComplete.addEventListener("show",function(e){let t=e.dsModel._dataGridView.getTreeDocument();t.prepareUpdate(),t.getAllDescendants().forEach(e=>{n.selectedist.includes(e._options.value)&&(e._isHighlighted=!0)}),t.pushUpdate(),model.expandAll()})}};return n}),define("DS/CfgVariantEffectivityEditor/scripts/CfgVariantEditorDataGridView",["UWA/Class/View","DS/DataGridView/DataGridView","DS/CfgVariantEffectivityEditor/scripts/CfgVariantEditorDataGridViewToolbar","DS/Core/PointerEvents","DS/CfgBaseUX/scripts/CfgUtility","DS/Selection/XSO","DS/CfgBaseUX/scripts/CfgUserSettings","DS/CfgBaseUX/scripts/CfgUXEnvVariables","i18n!DS/CfgVariantEffectivityEditor/assets/nls/CfgVariantEffectivityEditor"],function(e,t,i,o,a,n,s,l,r){return e.extend({toolbar:null,processedColumns:null,selectedColumnsIndexes:[],init:function(e){this._parent(e)},render:function(){this.columnsDeepCloned=JSON.parse(JSON.stringify(this.options.columns)),this.isCustomAttributesEnabled=l.getCfgUXEnvVariables().isCustomAttributesEnabled,this.updateColumnSelectionEventsPrototype(),this.selectedColumnsIndexes=[],this.VariantGridView=new t({treeDocument:this.options.treeDocument,columns:this.columnsDeepCloned,selectionMode:"cell",touchMode:this.options.touchMode,showSelectionCheckBoxesFlag:!0,defaultColumnDef:{width:"auto",typeRepresentation:"string",editableFlag:!0,resizableFlag:!0,sortableFlag:!1,editionPolicy:""},identifier:"edit_variant_effectivityView"});return this.VariantGridView.getTypeRepresentationFactory().registerTypeTemplates({tristatetemplate:{path:"DS/CfgVariantEffectivityEditor/scripts/CfgTweakerVerticalTristate",options:{}}}),this.VariantGridView.getTypeRepresentationFactory().registerTypeRepresentations({tristate:{stdTemplate:"tristatetemplate"}}),this.VariantGridView.showEditableFeedbackFlag=!1,this.VariantGridView.layout.rowsHeader=!0,this.VariantGridView.showRowIndexFlag=!1,this.VariantGridView.columnSelection="multiple",this.VariantGridView.showColumnBorderFlag=!0,this.VariantGridView.placeholder=r.No_Eff_IconMsg,this._getCellTooltip(),i.toolbar=this.VariantGridView.setToolbar(i.writetoolbarDefination()),this.toolbar=i.toolbar,i.onToolbarClickCallback=this.options.onToolbarClickCallback,this.registerUpdateToolbarCommandStatesEvent(),this.registerToolbarSearchEvents(),this.buildContextualMenu(),this},refreshColumns:function(e){var t=JSON.parse(JSON.stringify(e));if(!0===this.isCustomAttributesEnabled){let e=this.VariantGridView.columns.filter(e=>e.visibleFlag).map(e=>e.dataIndex);t.forEach(t=>{e.includes(t.dataIndex)&&(t.visibleFlag=!0)})}this.VariantGridView.columns=t},_getCellTooltip:function(){this.VariantGridView.getCellTooltip=function(e){var t=null;return e.cellModel&&("undefined"==e.cellModel||1==e.cellModel||(t=e.cellModel)),{shortHelp:t,updateModel:!1}}.bind(this)},registerUpdateToolbarCommandStatesEvent:function(){var e=this;e.setAddToolBarState(!1),this.VariantGridView.treeDocument.getXSO().onPostAdd(function(t){var o=[{IdValue:"ID_Delete",StateValue:!1}];i.setToolbarState(o),e.setAddToolBarState(!1)}),this.VariantGridView.treeDocument.getXSO().onPostRemove(function(t){if(e.VariantGridView.treeDocument.getXSO().isEmpty()&&e.VariantGridView._columnsXSO.isEmpty()){var o=[{IdValue:"ID_Delete",StateValue:!0}];i.setToolbarState(o)}})},setDeleteToolBarState:function(){},setAddToolBarState:function(e){var t;t={IdValue:"ID_Plus",StateValue:e},i.setToolbarState([t])},isValidNotMenuCell:function(e){if(!0===e.cellInfos.cellModel||!1===e.cellInfos.cellModel||"undefined"===e.cellInfos.cellModel)return!0},setCellValues:function(e,t){var i=this.options.treeDocument.getAllDescendants()[e.cellInfos.rowID];this.options.treeDocument.prepareUpdate();var o,a=i._options.grid,n=[];for(var s in a)a.hasOwnProperty(s)&&n.push(s);if(this.isCustomAttributesEnabled){o=this.VariantGridView.columns.map(e=>e.dataIndex)[e.cellInfos.columnID]}else o=n[e.cellInfos.columnID-1];var l=i.getParents()[0];if("Exclusive"==l._options.data.featureType&&"undefined"!=t){for(var r=l.getAllDescendants(),d="undefined",c=0;c<r.length;c++)"undefined"!=r[c]._options.grid[o]&&(d=r[c]._options.grid[o]);if(t!=d)for(c=0;c<r.length;c++){var u;(u={})[o]="undefined",r[c].updateOptions({grid:u})}}(u={})[o]=t,i.updateOptions({grid:u}),this.options.treeDocument.pushUpdate()},buildCellSelectionContextualMenu:function(e){var t=this,i=[];return i.push({type:"PushItem",title:r.Menu_Title_Reject,fonticon:"",state:"",action:{callback:function(i){i&&i.context&&i.context.id&&t.setCellValues(e,!1)},context:{id:"NOT"}}},{type:"PushItem",title:r.Menu_Title_Select,fonticon:"",state:"",action:{callback:function(i){i&&i.context&&i.context.id&&t.setCellValues(e,!0)},context:{id:"Select"}}},{type:"PushItem",title:r.Menu_Title_Deselect,fonticon:"",state:"",action:{callback:function(i){i&&i.context&&i.context.id&&t.setCellValues(e,"undefined")},context:{id:"Unselect"}}}),i},buildContextualMenu:function(){var e=this;this.VariantGridView.onContextualEvent=function(t){if(1==e.isValidNotMenuCell(t))return e.buildCellSelectionContextualMenu(t);if(!0===e.isCustomAttributesEnabled){var i=[];if(t&&t.collectionView){let e={};i=t.collectionView.buildDefaultContextualMenu(t,e)}return i}}},registerToolbarSearchEvents:function(){if(void 0!==this.toolbar){var e=this;this.toolbar.addEventListener("liveChange",function(t){if(1==t.dsModel._properties.value.dirty){var i=s.UserSettings.effectivityView_VariantsAndOptionGroups;e.options.treeDocument.prepareUpdate(),e.options.treeDocument.getAllDescendants().forEach(function(e){e.show()}),e.options.treeDocument.getRoots().forEach(function(e){e.expandAll()});var o=t.dsModel._properties.value.value;if(""==o)return void e.options.treeDocument.pushUpdate();for(var a=e.options.treeDocument.getRoots(),n=0;n<a.length;n++){var l=a[n],r=l.getAllDescendants();if(!e.isFeatureSearchCriteria(l,o,i)){for(var d=0,c=0;c<r.length;c++)e.isOptionSearchCriteria(r[c],o,i)&&(r[c].hide(),d++);d==r.length&&l.hide()}}}e.options.treeDocument.pushUpdate()})}},isFeatureSearchCriteria:function(e,t,i){return-1!=e._options.label.toUpperCase().indexOf(t.toUpperCase())||-1!=e._options.grid.name.toUpperCase().indexOf(t.toUpperCase())||-1!=e._options.grid.type.toUpperCase().indexOf(t.toUpperCase())&&1==i.type||-1!=e._options.grid.description.toUpperCase().indexOf(t.toUpperCase())&&1==i.description},isOptionSearchCriteria:function(e,t,i){var o=!1,a=!1,n=!1,s=!1;return-1==e._options.label.toUpperCase().indexOf(t.toUpperCase())&&(o=!0),-1==e._options.grid.name.toUpperCase().indexOf(t.toUpperCase())&&(a=!0),-1==e._options.grid.type.toUpperCase().indexOf(t.toUpperCase())&&(n=!0),-1==e._options.grid.description.toUpperCase().indexOf(t.toUpperCase())&&(s=!0),0==n&&0==i.type&&(n=!0),0==s&&0==i.description&&(s=!0),o&&a&&n&&s},updateColumnSelectionEventsPrototype:function(){var e=this;t.prototype._applyColumnSelection=function(){if(this.getContent().setAttribute("column-selection",this.columnSelection),"none"===this.columnSelection||this._columnsXSO)"none"===this.columnSelection&&this._columnsXSO&&this._columnsXSO.empty();else{var t=this;this._columnsXSO=new n({useUniqueID:!0,getElementID:this.getXSOColumnID}),this._columnsXSO.onPostAdd(function(o){var a=0;if(o.forEach(function(i){a=i,-1==e.selectedColumnsIndexes.indexOf(a)&&e.selectedColumnsIndexes.push(a),t.updateRenderedColumn(a,{updateCellContent:!1,updateCellLayout:!1,updateCellAttributes:!0}),t._updateColumnHeaderCells({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0})}),-1!=e.selectedColumnsIndexes.indexOf(e.VariantGridView.columns.length-1)){var n={_event:"ID_PLUS"};i.onToolbarClickCallback(n)}var s=[{IdValue:"ID_Delete",StateValue:!1}];i.setToolbarState(s);s=[{IdValue:"ID_Copy",StateValue:!1}];i.setToolbarState(s)}),this._columnsXSO.onPostRemove(function(o){if(o.forEach(function(o){var a=o,n=e.selectedColumnsIndexes.indexOf(a);if(-1!==n&&e.selectedColumnsIndexes.splice(n,1),t.updateRenderedColumn(a,{updateCellContent:!1,updateCellLayout:!1,updateCellAttributes:!0}),t._updateColumnHeaderCells({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0}),!t._columnsXSO.isEmpty()){var s=[{IdValue:"ID_Copy",StateValue:!1}];i.setToolbarState(s)}}),e.VariantGridView.treeDocument.getXSO().isEmpty()&&t._columnsXSO.isEmpty()){var a=[{IdValue:"ID_Delete",StateValue:!0}];i.setToolbarState(a)}if(t._columnsXSO.isEmpty()){a=[{IdValue:"ID_Copy",StateValue:!0}];i.setToolbarState(a)}})}this._isReady&&this._renderViewport({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0})}}})}),define("DS/CfgVariantEffectivityEditor/scripts/CfgVariantEffectivityCollection",["UWA/Class/Collection","DS/WebappsUtils/WebappsUtils","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/TreeModel/DataModelSet","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgVariantEffectivityEditor/scripts/CfgVariantEffectivityModel","DS/CfgBaseUX/scripts/CfgColumnManager","i18n!DS/CfgVariantEffectivityEditor/assets/nls/CfgVariantEffectivityEditor"],function(e,t,i,o,a,n,s,l,r,d){return e.extend({model:l,initialiseCollectionOptions:function(e){this.options=e,0==this.options.hasEffectivity?console.log("Has No Effectivity, Models would be initilized to default values with Model Name and Empty Combinations"):(this.options.finalJson=s.VariantXMLToJSONConverter(this.options.varEffXML),this.options.descJson=s.VariantDescXMLtoJSONConverter(this.options.varEffXML)),this.options.evoEffXML&&(this.options.evoExpJson=s.EvolutionXMLtoJSONforFilterVariant(this.options.evoEffXML))},init:function(e){this._parent(e)},getEvoExpVal:function(e){Array.isArray(e)&&(e=e[0]);var t="";if(this.options.evoEffXML)for(var i=0;i<this.options.evoExpJson.contextsFilterXML.length;i++)if(this.options.evoExpJson.contextsFilterXML[i].name==e){t=this.options.evoExpJson.contextsFilterXML[i].expression;break}return t},getJsonAttrValue:function(e,t){Array.isArray(e)&&(e=e[0]),Array.isArray(t)&&(t=t[0]);var i={name:e,displayValue:t,Combinations:[]};if(1==this.options.hasEffectivity)for(var o=0;o<this.options.finalJson.length;o++){var a=JSON.parse(this.options.finalJson[o]);if(a.displayValue=t,a.name==e){a.Combinations.length>0&&(i=a=n.fillVariantDictionaryWithDisplayName(a,this.options.descJson));break}}return i},initialiseModels:function(e){var t=this.options.contextData,i=enoviaServerFilterWidget.baseURL,o="",a="";null!=i&&"undefined"!=i&&""!=i&&(o=enoviaServerFilterWidget.baseURL+"/common/images/I_Model_Thumbnail.png",a=enoviaServerFilterWidget.baseURL+"/common/images/iconSmallModel.png");for(var s=0;s<=t.length-1;s++){var c=t[s],u=c.physicalID,p=o;null!=c.preview_url&&"undefined"!=c.preview_url&&""!=c.preview_url&&(p=c.preview_url);var f=n.getAttributeValue(c.data,"Marketing Name"),h=n.getAttributeValue(c.basicData,"name"),g="<span style='color:#77797c'>"+(d.Maturity+":"+n.getAttributeValue(c.basicData,"current"))+"</span><br><span style='color:#77797c'>"+(d.Owner+":"+n.getAttributeValue(c.basicData,"owner"))+"</span>",v=this.getJsonAttrValue(h,f),m=this.getEvoExpVal(h),C='{ "id": "'+u+'", "title": "'+f+'", "subtitle": "'+h+'", "content": "'+g+'","image": "'+p+'", "icon": "'+a+'", "color": "", "url": "", "idModel": "'+u+'" ,"jsonAttr":""}',y=JSON.parse(C);y.jsonAttr=JSON.stringify(v),y.evoExp=m;var V=new l;this.add(V),V.set(y);var b=r.getTypeColumns("VariantsAndOptionGroups"),E=V.ConvertJsonEffectivitytoColumns(v,b);V.onModelUpdateCallback=e,V.set("columns",E),V.set("treeDocument",this.ConvertJsonEffectivitytoTreeDocument(v,E)),V.registeronNodeUpdateEvent(),V.addColumn()}},getModelswithEffExpression:function(){for(var e=this.length,t=[],i=0;i<e;i++){var o=this.at(i);""!=o.getXMLExpression()&&t.push(o.get("id"))}return t},getGlobalXMLExpression:function(e){for(var t=this.length,i="",o="",a=0;a<t;a++){o+=this.at(a).getXMLExpression(e)}return this.length>1?""!=o&&(i="<MultiContextView>"+o+"</MultiContextView>"):i=o,""!=i&&(i='<CfgEffectivityExpression xs:schemaLocation = "urn:com:dassault_systemes:config CfgEffectivityExpression.xsd" xmlns:xs = "http://www.w3.org/2001/XMLSchema-instance" xmlns = "urn:com:dassault_systemes:config"><Expression>'+i+"</Expression></CfgEffectivityExpression>"),i},ConvertJsonEffectivitytoTreeDocument:function(e,t){for(var n={},s={},l=0;l<t.length;l++)"tree"!=t[l].dataIndex&&(n[t[l].dataIndex]="",s[t[l].dataIndex]="undefined","string"==t[l].typeRepresentation&&(s[t[l].dataIndex]=""));var r=new a,d=new i({dataModelSet:r});d.prepareUpdate();for(var c=new Object,u=0;u<e.Combinations.length;u++)for(var p=e.Combinations[u].Combination,f=0;f<p.length;f++){null==c[p[f].Feature.value]&&(c[p[f].Feature.value]=p[f].Feature,c[p[f].Feature.value].Options=new Object);for(var h=0;h<p[f].Options.length;h++)null==c[p[f].Feature.value].Options[p[f].Options[h].Option.value]&&(c[p[f].Feature.value].Options[p[f].Options[h].Option.value]=p[f].Options[h].Option,c[p[f].Feature.value].Options[p[f].Options[h].Option.value].grid={...s}),"S"==p[f].Options[h].Option.selection?c[p[f].Feature.value].Options[p[f].Options[h].Option.value].grid["_"+u]=!0:"R"==p[f].Options[h].Option.selection&&(c[p[f].Feature.value].Options[p[f].Options[h].Option.value].grid["_"+u]=!1)}for(var g in c)if(c.hasOwnProperty(g)){var v=c[g],m=UWA.clone(n),C=new o({label:v.label,grid:m,data:c[g]});for(var y in d.addRoot(C),c[g].Options)if(c[g].Options.hasOwnProperty(y)){var V=c[g].Options[y],b=(m=UWA.clone(V.grid),new o({label:V.label,grid:m,data:V}));C.addChild(b)}}return d.expandAll(),d.pushUpdate(),d}})}),define("DS/CfgVariantEffectivityEditor/scripts/CfgVariantEffectivityController",["UWA/Core","UWA/Class/Model","UWA/Class/Collection","UWA/Class/View","DS/Handlebars/Handlebars","DS/CfgBaseUX/scripts/CfgSliderView","DS/CfgBaseUX/scripts/CfgUtility","WebappsUtils/WebappsUtils","DS/CfgVariantEffectivityEditor/scripts/CfgVariantEditorDataGridView","DS/CfgVariantEffectivityEditor/scripts/CfgVariantAutocomplete","DS/CfgVariantEffectivityEditor/scripts/CfgVariantWUXAutocomplete","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgFeatureOptionsView","DS/Controls/Toggle","text!DS/CfgVariantEffectivityEditor/scripts/CfgVariantDialogLayout.html","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/TreeModel/DataModelSet","DS/CfgVariantEffectivityEditor/scripts/CfgVariantEditorDataGridViewToolbar","DS/CfgVariantEffectivityEditor/scripts/CfgVariantEffectivityCollection","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorModelsCollection","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorServices","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEditorDataGridView","DS/CfgMassVariantEffectivityEditor/scripts/CfgMassVariantEffectivityEditorModelSelector","DS/CfgBaseUX/scripts/CfgDialog","DS/CfgBaseUX/scripts/CfgEffectivityExpressionContainer","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgBaseUX/scripts/CfgColumnManager","DS/CfgBaseUX/scripts/CfgUserSettings","DS/UIKIT/Mask","DS/CfgBaseUX/scripts/CfgUXEnvVariables","DS/CfgBaseUX/scripts/CfgCustomAttributeUtility","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json","i18n!DS/CfgVariantEffectivityEditor/assets/nls/CfgVariantEffectivityEditor"],function(e,t,i,o,a,n,s,l,r,d,c,u,p,f,h,g,v,m,C,y,V,b,E,w,D,I,_,S,T,x,A,O,M,U){var N=a.compile(h),F={currentSelectedModelId:null,isMultipleModelsAttached:!1,resetDialogShow:!1,checkFlag:!0,isModified:!1,init:function(e){return this.options=e,T.retrieveUserSettings(),F.checkFlag=!0,F.isModified=!1,F.isWebUXAutocompleteEnabled=A.getCfgUXEnvVariables().isWebUXAutocompleteEnabled,this.isCustomAttributesEnabled=A.getCfgUXEnvVariables().isCustomAttributesEnabled,this.readServiceLimit=A.getCfgUXEnvVariables().readServiceLimit,this.attachedModels=this.processAttachedModels(e.contextData),1==this.attachedModels.length?this.isMultipleModelsAttached=!1:this.isMultipleModelsAttached=!0,this.buildSliderView(),this.sliderView._leftPanel.getElement(".gridViewContainer").setHTML(N(U)),this.sliderView._leftPanel.getElement(".modalBodyWithoutFooter").setAttribute("style","height: 100% !important"),"Dashboard"!=this.options.mode&&(this.sliderView._leftPanel.setStyle("height","calc(100% - 68px)"),this.sliderView._rightPanel.setStyle("height","calc(100% - 68px)")),b.isReadOnlyMode=!1,this.initialiseContainers(),this.initialiseModelSelector(),this.initialiseVerticalCollection(),"Native"!=window.enoviaServerFilterWidget.mode&&"EXTERNAL"!=window.enoviaServerFilterWidget.mode&&this.initialiseHorizontalCollection(),this.currentSelectedModelId=this.cfgCollectionVertical.at(0).get("id"),this.initialiseUI(this.cfgCollectionVertical.at(0)),this.initialiseExpandCollpaseEvents(),this.loadNextModelsDictionaryAsyncronously(this.attachedModels,e),F},loadNextModelsDictionaryAsyncronously:function(e,t){for(var i=[],o=1;o<e.length;o++){var a="",n=F.cfgCollectionVertical.at(o),l=F.cfgCollectionVertical.at(o).get("evoExp");""!==l&&(a={evolutionExpression:JSON.stringify({filterExpression:_.getValidXmlWithoutDescId(l)})}),i.push(s.getLegacyCfgDico(n.get("idModel"),a))}Promise.all(i).then(function(e){for(var t=0;t<e.length;t++){for(var i=[],o=F.cfgCollectionVertical.at(t+1),a=0;a<e[t].features.length;a++){var n=e[t].features[a];"Preliminary"!==n.current&&"Obsolete"!==n.current&&i.push(n)}e[t].features=i,u.addDictionaryByCriteria(o.get("idModel"),e[t],"features");var s=F.processDictionary(e[t]),l=F.createDictionaryTreeDocument(s);o.set("treeDocumentVariantDictionary",l),F.initialiseFeatureTypeForEffectivityOptions(o,e[t]),F.isModified=!1}},function(){s.showwarning(U.Dictionary_Error,"error")})},buildSliderView:function(){var e={isReadOnlyMode:!1,position:"absolute",gridpadding:"10px",leftHeader:"",Cancel:U.Edit_Var_Cancel,rightHeader:U.DictionaryHeader,isRightFooter:!1,isLeftFooter:!1,headerControl:null,headerText:"",parent:this.options.parent};this.sliderView=new n(e).render()},initialiseHorizontalCollection:function(){this.cfgCollectionHorizontal=new V,this.cfgCollectionHorizontal.setAttachedModels(this.attachedModels),this.cfgCollectionHorizontal.setSelectedInstances(this.options.selectedInstances),this.cfgCollectionHorizontal.setEvolutionExpression(""),this.cfgCollectionHorizontal.initialiseModels(),b.getFilterablesVariantGrid(F.attachedModels[0].physicalId,F.options.selectedInstances).then(function(e){C.setToolbarState([{IdValue:"ID_SwitchView",StateValue:!1}]);var t=F.cfgCollectionHorizontal.at(0);t.set("gridEffectivityForConfigurationContext",e),t.onModelUpdateCallback=F.onModelUpdateCallback,t.createColumns(e),t.createTreeDocument(e),console.log(e),F.loadNextModelsEffectivitiesAsyncronously(F.attachedModels,F.options)})},loadNextModelsEffectivitiesAsyncronously:function(e,t){for(var i=[],o=1;o<e.length;o++)i.push(b.getFilterablesVariantGrid(e[o].physicalId,t.selectedInstances));Promise.all(i).then(function(t){for(var i=0;i<t.length;i++){var o=F.cfgCollectionHorizontal.get(e[i+1].physicalId);o.set("gridEffectivityForConfigurationContext",t[i]),o.onModelUpdateCallback=F.onModelUpdateCallback,o.createColumns(t[i]),o.createTreeDocument(t[i]),F.isModified=!1}})},resetHorizontalCollection:function(){for(var e=this.cfgCollectionHorizontal.length,t=0;t<e;t++){var i=this.cfgCollectionHorizontal.at(t),o=i.get("gridEffectivityForConfigurationContext");console.log(o),i.createColumns(o),i.createTreeDocument(o)}},initialiseModelSelector:function(){var t={onChangeCB:this.onHeaderControlChangeCB,data:this.attachedModels};if(this.modelSelector=new w(t),!0===this.options.touchMode?this.options.parent.getElement(".CfgModelName").setAttributeNode(document.createAttribute("touch-mode")):!1===this.options.touchMode&&this.options.parent.getElement(".CfgModelName").removeAttribute(document.createAttribute("touch-mode")),this.modelSelector.render(),this.modelSelector.enable(),1==this.isMultipleModelsAttached){var i=e.createElement("div",{});i.setStyle("width","calc(100% - 320px)"),i.inject(this.options.parent.header),this.modelSelector._wuxComboBox.inject(i),this.modelSelector._wuxComboBox.elements.container.setStyle("width","300px"),this.options.parent.getElement(".CfgModelName").setStyle("margin","0px 10px 0px 0px")}else{var o=e.createElement("div",{class:"modelTitle",html:this.modelSelector._text});!0===this.options.touchMode?o.setAttributeNode(document.createAttribute("touch-mode")):!1===this.options.touchMode&&o.removeAttribute(document.createAttribute("touch-mode")),o.inject(this.options.parent.header),this.options.parent.header.setStyle("height","40px")}},onModelUpdateCallback:function(){F.isModified=!0,F.updateDisplayExpression()},updateDisplayExpression:function(){var e="";1==F.checkFlag?e=F.cfgCollectionVertical.getGlobalXMLExpression("TXT"):e=F.cfgCollectionHorizontal.processJsonToXml("TXT")[F.options.selectedInstances[0].instanceId].xml;var t="";""!=e&&(t=decodeURIComponent(s.getDisplayExpressionUsingXSLT(e))),""==t?this.cfgExpressionViewObj.updateExpression(U.No_Eff_Msg):(t=null==t?" ":t,this.cfgExpressionViewObj.updateExpression(t))},getProbesInfoDetailsWithXML:function(e){let t=[];for(let e=0;e<F.cfgCollectionVertical.length;e++){let i=F.cfgCollectionVertical.at(e).id,o=u.getDictionaryByCriteria(i,"features");null!=o&&t.push({currentModelName:o.name,currentModelFeatures:o})}return _.getProbesVariantCriteria(e,t)},getGlobalXMLExpression:function(){return 1==F.checkFlag?F.cfgCollectionVertical.getGlobalXMLExpression():F.cfgCollectionHorizontal.processJsonToXml("XML")[F.options.selectedInstances[0].instanceId].xml},initialiseContainers:function(){this.options.parent.header=this.options.parent.getElement(".CfgVariantheader"),this.options.parent.body=this.options.parent.getElement(".CfgBodyContainer"),this.initialiseExpressionContainer(),this.options.parent.autocompleteContainer=this.options.parent.getElement(".containerAuto"),this.options.parent.toolbarContainer=this.options.parent.getElement(".containerIconbar"),this.options.parent.effectivityGridContainer=this.options.parent.getElement(".containerEffectivityTable"),this.options.parent.containerHeaderBar=this.options.parent.getElement(".containerHeaderBar"),F.isWebUXAutocompleteEnabled&&!0===F.isWebUXAutocompleteEnabled&&(this.options.parent.body.addClassName("CfgWuxBodyContainer"),!0===this.options.touchMode?this.options.parent.containerHeaderBar.setAttributeNode(document.createAttribute("touch-mode")):!1===this.options.touchMode&&this.options.parent.containerHeaderBar.removeAttribute(document.createAttribute("touch-mode")),this.options.parent.containerHeaderBar.addClassName("cfgWuxAutocomplete"))},initialiseExpressionContainer:function(){e.createElement("div",{styles:{height:"100%"},html:this.options.parent.body.children[0]}).inject(this.options.parent.body);var t={effArea:"",effExpHeaderTitle:U.Eff_Expression,viewContainer:this.options.parent.body,defaultExpressionContainerHeight:70,displayCompactMode:!this.options.touchMode,inputData:"",minimizeTooltip:U.Min_EBox,maximizeTooltip:U.Max_EBox};this.cfgExpressionViewObj=new I(t),this.cfgExpressionViewObj.render()},initialiseVerticalCollection:function(){this.cfgCollectionVertical=new y,this.cfgCollectionVertical.initialiseCollectionOptions(F.options),this.cfgCollectionVertical.initialiseModels(this.onModelUpdateCallback)},resetAttributes:function(){for(var e=0;e<F.cfgCollectionVertical.length;e++){var t=F.cfgCollectionVertical.at(e),i=u.getDictionaryByCriteria(t.get("idModel"),"features");F.initialiseFeatureTypeForEffectivityOptions(t,i)}},onHeaderControlChangeCB:function(e){F.initialiseUI(F.cfgCollectionVertical.get(e.physicalId));var t=F.getCurrentSelectedView();F.cssAdjustmentsForLayout(t,F.attachedModels.length),F.updateDisplayExpression()},initialiseUI:function(e){this.currentSelectedModelId=e.get("id"),this.options.onSelectCallback=this.addFeatureOptionsinTreeDocument,this.initialiseAutocompleteView(this.options),this.buildUI(e),this.initialiseDictionary(e)},buildUI:function(e){let t=[{IdValue:"ID_Dictionary",StateValue:!1}];1==F.checkFlag?(F.initialiseVerticalEffectivityView(e),F.initialiseToolbar(F.effectivityGridView.toolbar),C.setToolbarState(t),"Native"!=window.enoviaServerFilterWidget.mode?F.effectivityGridView.toolbar.updateNodeModel("ID_SwitchView",{visibleFlag:!0}):F.effectivityGridView.toolbar.updateNodeModel("ID_SwitchView",{visibleFlag:!1}),!1!==this.isCustomAttributesEnabled&&void 0!==this.isCustomAttributesEnabled||F.effectivityGridView.toolbar.updateNodeModel("ID_ColumnManager",{visibleFlag:!0}),F.effectivityGridView.toolbar.updateNodeModel("ID_SEARCHFEATUREOPTION",{visibleFlag:!0})):(F.initialiseHorizontalEffectivityView(e.get("idModel")),F.initialiseToolbar(F.horizontalGridView.toolbar));let i=F.getCurrentSelectedView();F.cssAdjustmentsForLayout(i,F.attachedModels.length),F.updateDisplayExpression(),F.isModified=!1},addFeatureOptionsinTreeDocumentFromTreeView:function(e,t){if(!0===F.isWebUXAutocompleteEnabled){var i=F.autocomplete.myAutoComplete._model.getAllDescendants(),o={};if(e.self.options){for(var a=0;a<i.length;a++)if(e.self.name==i[a].options.value){o=i[a].options;break}}else{var n={};for(a=0;a<i.length;a++)e.feature.name==i[a].options.value&&(n=i[a].options),e.self.name==i[a].options.value&&(o=i[a].options);o._parentNode=n}o.originalData=e}else{i=F.autocomplete.autocompleteHierarchicalInput.datasets[0].items,o={};if(e.self.options){for(a=0;a<i.length;a++)if(e.self.name==i[a].value){o=i[a];break}}else{for(n={},a=0;a<i.length;a++)e.feature.name==i[a].value&&(n=i[a]),e.self.name==i[a].value&&(o=i[a]);o.parentReference=n}o.originalData=e}0==t?F.addFeatureOptionsinTreeDocument(o):F.removeFeatureOptionsinTreeDocument(o)},removeFeatureOptionsinTreeDocument:function(e){var t=(a=F.cfgCollectionVertical.get(F.currentSelectedModelId)).get("treeDocument");t.prepareUpdate(),t.unselectAll();for(var i=t.getAllDescendants(),o=0;o<i.length;o++)i[o]._options.data.value==e.value&&(i[o].select(),!0===F.isCustomAttributesEnabled&&i[o].options.data.self&&i[o].options.data.self.physicalID&&a.objListDataPopulated&&(a.objListDataPopulated.delete(i[o].options.data.self.physicalID),i[o].options.children&&i[o].options.children.forEach(e=>{e.options.data.self&&e.options.data.self.physicalID&&a.objListDataPopulated.delete(e.options.data.self.physicalID)})));if(t.pushUpdate(),a.removeRows(),F.disableDictionaryItems(a),0==F.checkFlag){F.horizontalGridView.toolbar.isCopyOperationPerformed="NO",F.horizontalGridView.toolbar.currentModel.set("copiedInstances",[]),F.horizontalGridView.options.treeDocument.unselectAll();var a=F.cfgCollectionHorizontal.get(F.currentSelectedModelId),n=F.getSelectedObjectFromDictionaryView(e);a.removeEffectivityGridViewColumn(n),F.horizontalGridView.refreshColumns(a.get("gridViewEffectivityColumns")),F.horizontalGridView.massVariantGridView.layout.setColumnVisibleFlag("Expression",!1),F.horizontalGridView.massVariantGridView.layout.setColumnWidth("instance",0)}F.onModelUpdateCallback()},addFeatureOptionsinTreeDocument:function(e){(t=F.cfgCollectionVertical.get(F.currentSelectedModelId)).get("columns");if(F.isWebUXAutocompleteEnabled&&!0===F.isWebUXAutocompleteEnabled?t.addRowWebUX(e):t.addRow(e),F.disableDictionaryItems(t),0==F.checkFlag){F.horizontalGridView.toolbar.isCopyOperationPerformed="NO",F.horizontalGridView.toolbar.currentModel.set("copiedInstances",[]),F.horizontalGridView.options.treeDocument.unselectAll();var t=F.cfgCollectionHorizontal.get(F.currentSelectedModelId),i=F.getSelectedObjectFromDictionaryView(e);F.isWebUXAutocompleteEnabled&&!0===F.isWebUXAutocompleteEnabled?t.addEffectivityGridViewColumnWUX(i):t.addEffectivityGridViewColumn(i),F.horizontalGridView.refreshColumns(t.get("gridViewEffectivityColumns")),F.horizontalGridView.massVariantGridView.layout.setColumnVisibleFlag("Expression",!1),F.horizontalGridView.massVariantGridView.layout.setColumnWidth("instance",0)}F.onModelUpdateCallback()},getSelectedObjectFromDictionaryView:function(e){for(var t=F.cfgCollectionVertical.get(F.currentSelectedModelId).get("treeDocumentVariantDictionary").getAllDescendants(),i=0;i<t.length;i++){var o=t[i];if(o._options.data.self.name==e.value)return o._options.data;if(F.isWebUXAutocompleteEnabled&&!0===F.isWebUXAutocompleteEnabled&&void 0===e.value&&o._options.data.self.name==e._options.value)return o._options.data}return null},disableDictionaryItems:function(e){if(F.isWebUXAutocompleteEnabled&&!0===F.isWebUXAutocompleteEnabled){var t=e.getSelectedFeatureOptions(),i=e.getDeletedFeatureOptions();F.autocomplete.enableAutocompleteItems(t,i)}else{t=e.getSelectedFeatureOptions();F.autocomplete.setDisable(t)}null!=F.featureOptionsView&&F.featureOptionsView.setChecked(t)},initialiseVerticalEffectivityView:async function(e){this.options.parent.effectivityGridContainer.setHTML("");var t={};t.columns=e.get("columns"),t.columns[0].selectableFlag=!1,t.treeDocument=e.get("treeDocument"),t.onToolbarClickCallback=F.onToolbarClickCallback,t.touchMode=this.options.touchMode,this.effectivityGridView=new r(t),this.effectivityGridView.render().VariantGridView.inject(this.options.parent.effectivityGridContainer),!0===this.isCustomAttributesEnabled&&(this.effectivityGridView.VariantGridView.onDelayedModelDataRequest=(async e=>{if("OnScrollEnd"===e.context||"OnReady"===e.context||"OnSyncModel"===e.context){var t=e.collectionView;let i=[],o=[],a=F.cfgCollectionVertical.get(F.currentSelectedModelId);if(-1!=e.endNodeIndex&&-1!=e.startNodeIndex){for(let n=e.startNodeIndex;n<=e.endNodeIndex;n++)t.model[n].options.data&&t.model[n].options.data.self&&t.model[n].options.data.self.physicalID&&(a.objListDataPopulated&&a.objListDataPopulated.size>0&&!a.objListDataPopulated.has(t.model[n].options.data.self.physicalID)?(i.push(t.model[n].options.data.self.physicalID),o.push(t.model[n])):a.objListDataPopulated&&0===a.objListDataPopulated.size&&(i.push(t.model[n].options.data.self.physicalID),o.push(t.model[n])));if(i.length>0){if(o.length<=this.readServiceLimit){let e=await O.updateAsyncAttrColForDictionary(this.inputPredicates,i,o);0===a.objListDataPopulated.size&&await this.updateBasicAndCustomAttributes(e)}else if(o.length>this.readServiceLimit){for(let e=0;e<o.length;e+=this.readServiceLimit){let t=i.slice(e,e+this.readServiceLimit),n=o.slice(e,e+this.readServiceLimit),s=await O.updateAsyncAttrColForDictionary(this.inputPredicates,t,n);0===a.objListDataPopulated.size&&await this.updateBasicAndCustomAttributes(s)}}a.objListDataPopulated=new Set([...i,...a.objListDataPopulated])}}}}))},updateBasicAndCustomAttributes:async function(e,t){let i;F.effectivityGridView&&F.effectivityGridView.VariantGridView&&F.effectivityGridView.VariantGridView.treeDocument&&F.effectivityGridView.VariantGridView.treeDocument.getAllDescendants()&&(i=F.effectivityGridView.VariantGridView.treeDocument.getAllDescendants());let o,a=[];t?(o=t.get("treeDocument").getAllDescendants()).forEach(e=>{e&&e.options&&e.options.data&&e.options.data.self&&a.push(e.options.data.self.physicalID)}):i&&i.forEach(e=>{e&&e.options&&e.options.data&&e.options.data.self&&a.push(e.options.data.self.physicalID)});let n,l=a.slice(0,this.readServiceLimit);n=e||await s.getInstanceObjectsByReadService(l,"true","true"),await this.updateVariantGridViewColumns(n,t);let r,d=this.effectivityGridView.VariantGridView.columns.map(e=>e.dataIndex);this.inputPredicates=d.filter(e=>!e.startsWith("_")&&e),t&&o?(r=o.splice(0,this.readServiceLimit),t.objListDataPopulated=new Set(l)):r=i.splice(0,this.readServiceLimit),await O.updateAsyncAttrColumnValues(this.inputPredicates,r,n)},updateVariantGridViewColumns:async function(e,t){var i=await S.getTypeColumnsForDictionary("VariantsAndOptionGroups",e);if(t)t.addBasicAndCustomColumns(i);else if(void 0===t){F.cfgCollectionVertical.get(F.currentSelectedModelId).addBasicAndCustomColumns(i)}let o=JSON.parse(JSON.stringify(F.effectivityGridView.VariantGridView.columns)),a=o.findIndex(e=>e.dataIndex.includes("_")&&"tristate"===e.typeRepresentation),n=o.map(e=>e.dataIndex);i.forEach(e=>{n.includes(e.dataIndex)||o.splice(a,0,e)}),this.effectivityGridView.VariantGridView.columns.length<i.length&&(this.effectivityGridView.VariantGridView.columns=o,this.updatedVariantGridViewColumnsList=this.effectivityGridView.VariantGridView.columns)},initialiseHorizontalEffectivityView:function(e){var t=null,i={treeDocument:(t=void 0===e?this.cfgCollectionHorizontal.at(0):this.cfgCollectionHorizontal.get(e)).get("treeDocumentEffectivityGridView"),columns:t.get("gridViewEffectivityColumns"),context:t.get("configurationContext")};i.columns[0].minWidth=0,i.columns[0].resizableFlag=!1,i.columns[0].alwaysVisibleFlag=!1,this.horizontalGridView=new E(i),this.horizontalGridView.isExpressionColumnAvailable=!1,this.horizontalGridView.render(),null!=this.horizontalGridView.toolbar&&(this.horizontalGridView.toolbar.currentModel=t,this.addDictionaryCallbackToHorizontalToolbar()),this.options.parent.effectivityGridContainer.setHTML(""),this.horizontalGridView.massVariantGridView.inject(this.options.parent.effectivityGridContainer),this.horizontalGridView.massVariantGridView.layout.setColumnVisibleFlag("Expression",!1),this.horizontalGridView.massVariantGridView.layout.setColumnVisibleFlag("instance",!1),this.horizontalGridView.massVariantGridView.layout.setColumnWidth("instance",0)},addDictionaryCallbackToHorizontalToolbar:function(){"Native"!=window.enoviaServerFilterWidget.mode?this.horizontalGridView.toolbar.updateNodeModel("ID_SwitchView",{visibleFlag:!0}):this.horizontalGridView.toolbar.updateNodeModel("ID_SwitchView",{visibleFlag:!1}),this.horizontalGridView.toolbar.updateNodeModel("ID_Dictionary",{visibleFlag:!0}),this.horizontalGridView.toolbarExportExtentionsForCallbacks.onShowDictionaryClick=function(e){e._event="ID_DICTIONARY",F.onToolbarClickCallback(e)},this.horizontalGridView.toolbarExportExtentionsForCallbacks.onSwitchViewClick=function(e){e._event="ID_VERTICALVIEW",F.onToolbarClickCallback(e)}},initialiseToolbar:function(e){this.options.parent.toolbarContainer.setHTML(""),e.inject(this.options.parent.toolbarContainer)},onToolbarClickCallback:function(e){"ID_DELETE"==e._event&&((t=F.cfgCollectionVertical.get(F.currentSelectedModelId)).removeRows(),0==t.get("treeDocument").getAllDescendants().length&&t.clearColumns(),t.deletedRowPhysicalId.length>0&&!0===F.isCustomAttributesEnabled&&(t.deletedRowPhysicalId=[...new Set(t.deletedRowPhysicalId)],t.deletedRowPhysicalId.forEach(e=>{t.objListDataPopulated.delete(e)})),F.disableDictionaryItems(t),t.deleteColumns(F.effectivityGridView.selectedColumnsIndexes),F.effectivityGridView.VariantGridView._columnsXSO.empty(),F.effectivityGridView.refreshColumns(t.get("columns")),F.onModelUpdateCallback());"ID_CLEAR"==e._event&&((t=F.cfgCollectionVertical.get(F.currentSelectedModelId)).clearRows(),F.disableDictionaryItems(t),F.onModelUpdateCallback());"ID_COPY"==e._event&&((t=F.cfgCollectionVertical.get(F.currentSelectedModelId)).copyColumns(F.effectivityGridView.selectedColumnsIndexes),F.effectivityGridView.refreshColumns(t.get("columns")),F.onModelUpdateCallback());if("ID_PLUS"==e._event){var t=F.cfgCollectionVertical.get(F.currentSelectedModelId);F.addColumn(t),F.onModelUpdateCallback()}if("ID_DICTIONARY"==e._event&&F.sliderView._expandCollapseDockedPanel(e),"ID_HORIZONTALVIEW"==e._event&&(1==F.isModified?R("ID_HORIZONTALVIEW"):F.switchViews("ID_HORIZONTALVIEW")),"ID_VERTICALVIEW"==e._event&&(1==F.isModified?R("ID_VERTICALVIEW"):F.switchViews("ID_VERTICALVIEW")),"ID_USERSETTINGS"==e._event){var i={};i.viewId=e.viewId,F.showColumnManager(i),F.sliderView.hide()}},buildfeatureOptionView:async function(e,t){var i={touchMode:this.options.touchMode,treeDocument:e,onFeatureOptionSelectionChange:F.addFeatureOptionsinTreeDocumentFromTreeView,features:t,onToolbarClickCallback:F.onToolbarClickCallback};F.featureOptionsView=new p(i),await F.featureOptionsView.render(),F.featureOptionsView.setColumnRemoveWarningToShow(!1),F.sliderView.clearRightLayout(),F.sliderView.setRightView(F.featureOptionsView.featureOptionGridView,F.featureOptionsView.toolbar),F.featureOptionsView.cssAdjustmentsForLayout(this.options.touchMode,!0)},createDictionaryTreeDocument:function(e){var t=new m,i=new g({dataModelSet:t});i.prepareUpdate();for(var o=0;o<e.length;o++){for(var a=e[o],n={},s=S.getColumnIndexes("VariantsAndOptionGroups"),l=0;l<s.length;l++)n[s[l]]="";var r=new v({label:a.displayName,grid:{name:a.name,type:a.type,checkbx:!1},data:{self:a,feature:a}});this.updateAttributes(r,a),i.addRoot(r);for(var d=0;d<a.options.length;d++){var c=a.options[d],u=new v({label:c.displayName,grid:{name:c.name,type:c.type,checkbx:!1},data:{self:c,feature:a}});this.updateAttributes(u,c),r.addChild(u)}}return i.expandAll(),i.pushUpdate(),i},processFilterablesVariantGrid:function(e){var t=[];if(null!=e.features.criterias)for(var i=0;i<e.features.criterias.features.length;i++){var o=e.features.criterias.features[i],a="",n="",s="",l="",r="",d="";o.featureAttributes.results[0].basicData.forEach(function(e){"name"==e.name&&(a=e.value[0]),"type"==e.name&&(s=e.value[0]),"current"==e.name&&(l=e.value[0]),"originated"==e.name&&(r=e.value[0]),"description"==e.name&&null!=e.value&&(d=e.value[0])}),o.featureAttributes.results[0].data.forEach(function(e){"Display Name"==e.name&&(n=e.value[0])});for(var c={name:a,displayName:n,revision:"-",options:[],type:s,current:l,originated:r,description:d,selectionType:o.featureType,check:!1,physicalID:o.featurePID},u=0;u<o.options.length;u++){var p=o.options[u],f="",h="",g="",v="",m="",C="";p.optionAttributes.results[0].basicData.forEach(function(e){"name"==e.name&&(f=e.value[0]),"type"==e.name&&(g=e.value[0]),"current"==e.name&&(v=e.value[0]),"originated"==e.name&&(m=e.value[0]),"description"==e.name&&null!=e.value&&(C=e.value[0])}),p.optionAttributes.results[0].data.forEach(function(e){"Display Name"==e.name&&(h=e.value[0])}),c.options.push({name:f,displayName:h,type:g,current:v,originated:m,description:C,selectionType:o.featureType,check:!1,physicalID:p.optionPID})}t.push(c)}return t},processDictionary:function(e){for(var t=[],i=0;i<e.features.length;i++){var o=e.features[i],a={name:o.name,displayName:o.displayValue,revision:o.revision,options:[],type:o.type_NLS,current:o.current_NLS,originated:o.originated,description:null!=o.description?o.description:"",selectionType:o.featureType,check:!1,physicalID:"xRevision"===this.options.isEvolutionBasedOn&&o.physicalid?o.physicalid:o.id.replace("pid:","")};if("Preliminary"!==o.current&&"Obsolete"!==o.current){for(var n=0;n<o.options.length;n++){var s=o.options[n];a.options.push({name:s.name,displayName:s.displayValue,type:s.type_NLS,current:s.current_NLS,originated:s.originated,description:null!=s.description?s.description:"",selectionType:o.featureType,check:!1,physicalID:"xRevision"===this.options.isEvolutionBasedOn&&s.physicalid?s.physicalid:s.id.replace("pid:","")})}t.push(a)}}return t},initialiseDictionary:function(e){this.getDictionary(e)},getDictionary:async function(t){var i=u.getDictionaryByCriteria(t.get("idModel"),"features");if(F.sliderView.clearRightLayout(),F.sliderView.disableRightLayout(),null==i.features){var o=this,a="",n=t.get("evoExp");""!==n&&(a={evolutionExpression:JSON.stringify({filterExpression:_.getValidXmlWithoutDescId(n)})});var l=!1;if("EXTERNAL"==enoviaServerFilterWidget.mode&&void 0!==this.options.configurable&&void 0!==this.options.configurable.contextType&&"MODEL_VERSION"==this.options.configurable.contextType&&(l=!0),"xRevision"===o.options.isEvolutionBasedOn){if(options={version:"1.0",referencePID:t.collection.options.parentID},!o.options.cfg_auth_ctx){let e={instancePID:t.collection.options.instanceID,effectivityCompiledForm:t.collection.options.evoEffXML?"":"No Effectivity"};options.instances=[e]}if(o.options&&o.options.cfg_auth_ctx&&o.options.cfg_auth_ctx.AuthoringContextHeader){let e=Object.keys(o.options.cfg_auth_ctx.AuthoringContextHeader)[0],t={operationheader:{key:e,value:o.options.cfg_auth_ctx.AuthoringContextHeader[e]}};options.wsHeaderOptions=t}try{let i=await s.getAvailableFeaturesAndOptions(options);var r=[];if(i&&i.result&&i.result.length>0){for(var d=0;d<i.result[0].features.length;d++){var c=i.result[0].features[d];"Preliminary"!==c.current&&"Obsolete"!==c.current&&r.push(c)}i.features=r,u.addDictionaryByCriteria(t.get("idModel"),i,"features"),o.modelSelector&&o.modelSelector._wuxComboBox&&o.modelSelector._wuxComboBox.currentValue&&o.modelSelector._wuxComboBox.currentValue.physicalId===i.result[0].modelPID&&F.processVariantOptionsData(i,t)}else{s.showNotifs("warning","",U.No_Conf_Features_Title),F.sliderView._rightSpinner.hide();let t=e.createElement("div",{class:"featureOptionsMsg",html:U.No_Variants_Available});F.sliderView.setRightView(t)}}catch{s.showNotifs("error","",U.Dictionary_Error)}}else s.getLegacyCfgDico(t.get("idModel"),a,l).then(function(e){for(var i=[],a=0;a<e.features.length;a++){var n=e.features[a];"Preliminary"!==n.current&&"Obsolete"!==n.current&&i.push(n)}if(e.features=i,u.addDictionaryByCriteria(t.get("idModel"),e,"features"),o.modelSelector&&o.modelSelector._wuxComboBox&&o.modelSelector._wuxComboBox.currentValue&&o.modelSelector._wuxComboBox.currentValue.physicalId===e.id.substr(4,e.id.length)){var s=F.processDictionary(e);F.isWebUXAutocompleteEnabled&&!0===F.isWebUXAutocompleteEnabled?F.autocomplete.drawDictionary(s,o.options):F.autocomplete.drawDictionary(s);var l=F.createDictionaryTreeDocument(s);t.set("treeDocumentVariantDictionary",l),F.buildfeatureOptionView(l,e),F.disableDictionaryItems(t),F.initialiseFeatureTypeForEffectivityOptions(t,e),!1!==o.isCustomAttributesEnabled&&void 0!==o.isCustomAttributesEnabled||F.updateColumnsFromSettings();var r=F.cfgCollectionVertical.get(F.currentSelectedModelId);F.effectivityGridView.refreshColumns(r.get("columns")),F.isModified=!1}},function(e){s.showwarning(U.Dictionary_Error,"error"),x.unmask(o.options.parent.body)})}else{o=this;var p=F.processDictionary(i);if(F.isWebUXAutocompleteEnabled&&!0===F.isWebUXAutocompleteEnabled?F.autocomplete.drawDictionary(p,o.options):F.autocomplete.drawDictionary(p),void 0===(f=t.get("treeDocumentVariantDictionary"))){var f=F.createDictionaryTreeDocument(p);t.set("treeDocumentVariantDictionary",f)}f=t.get("treeDocumentVariantDictionary"),F.buildfeatureOptionView(f,p),F.disableDictionaryItems(t),C.setToolbarState([{IdValue:"ID_SwitchView",StateValue:!1}]),!0===this.isCustomAttributesEnabled&&this.updatedVariantGridViewColumnsList&&this.effectivityGridView.VariantGridView.columns.length<this.updatedVariantGridViewColumnsList.length&&(this.effectivityGridView.VariantGridView.columns=this.updatedVariantGridViewColumnsList)}},processVariantOptionsData:function(e,t){let i=this;var o=F.processDictionary(e);F.isWebUXAutocompleteEnabled&&!0===F.isWebUXAutocompleteEnabled?F.autocomplete.drawDictionary(o,i.options):F.autocomplete.drawDictionary(o);var a=F.createDictionaryTreeDocument(o);t.set("treeDocumentVariantDictionary",a),F.buildfeatureOptionView(a,e),F.disableDictionaryItems(t),F.initialiseFeatureTypeForEffectivityOptions(t,e),!1!==i.isCustomAttributesEnabled&&void 0!==i.isCustomAttributesEnabled||F.updateColumnsFromSettings();var n=F.cfgCollectionVertical.get(F.currentSelectedModelId);F.effectivityGridView.refreshColumns(n.get("columns")),F.isModified=!1},isValidEffectivityForDictionary:function(e,t){let i=!0;if(e){let o=[];if(e.length>0){for(let e=0;e<t.features.length;e++)o.push(t.features[e].name);for(let t=0;t<e.length;t++){let a=e[t]._options.data.value;if(-1==o.indexOf(a)){i=!1;break}}}}return i},initialiseFeatureTypeForEffectivityOptions:function(e,t){var i=e.get("treeDocument"),o=t;i.prepareUpdate();var a=i.getRoots();if(1==this.isValidEffectivityForDictionary(a,o)){for(var n=0;n<a.length;n++)for(var l=a[n]._options.data.value,r=0;r<o.features.length;r++)if(l==o.features[r].name){this.updateAttributes(a[n],o.features[r]),a[n]._options.data.featureType=o.features[r].featureType,a[n]._options.data.self={},a[n]._options.data.self.physicalID="xRevision"===this.options.isEvolutionBasedOn&&o.features[r].physicalid?o.features[r].physicalid:o.features[r].id.slice(4);for(var d=a[n].getChildren(),c=0;c<d.length;c++){d[c]._options.data.featureType=o.features[r].featureType;for(var u=o.features[r].options,p=0;p<u.length;p++)d[c]._options.data.value==u[p].name&&(d[c]._options.data.self={},d[c]._options.data.self.physicalID="xRevision"===this.options.isEvolutionBasedOn&&u[p].physicalid?u[p].physicalid:u[p].id.slice(4),this.updateAttributes(d[c],u[p]),p=u.length)}}}else s.showwarning(U.Evolution_Impact_Msg,"warning");i.pushUpdate(),!0===this.isCustomAttributesEnabled&&this.updateBasicAndCustomAttributes("",e)},updateAttributes:function(e,t){for(var i=e._options.grid,o=S.getColumnIndexes("VariantsAndOptionGroups"),a=0;a<o.length;a++){var n=o[a];"type"!=o[a]&&"current"!=o[a]||(n+="_NLS"),null==t[n]&&(n=o[a]),null==t[n]&&(t[n]=""),i[o[a]]=t[n]}e.updateOptions({grid:i})},addColumn:function(e){e.addColumn(),F.effectivityGridView.refreshColumns(e.get("columns"))},getCurrentSelectedView:function(){return 1==F.checkFlag?F.effectivityGridView.VariantGridView:F.horizontalGridView.massVariantGridView},cssAdjustmentsForLayout:function(e,t){1==t?e.getContent(".wux-layouts-collectionview").setStyles({height:"calc(100% - 10px)",top:"10px",bottom:"160px",left:"0px",width:"calc(100% - 0px) ",border:"1px solid rgb(212, 212, 212)"}):e.getContent(".wux-layouts-collectionview").setStyles({height:"calc(100% - 10px)",top:"10px",bottom:"150px",left:"0px",width:"calc(100% - 0px)",border:"1px solid rgb(212, 212, 212)"})},cssAdjustmentsForHeightMinimise:function(e,t){"fullScreenSingle"==t?e.getContent(".wux-layouts-collectionview").setStyles({bottom:"40px"}):"partialScreenSingle"==t&&e.getContent(".wux-layouts-collectionview").setStyles({bottom:"160px"}),"fullScreenMultiple"==t?e.getContent(".wux-layouts-collectionview").setStyles({bottom:"40px"}):"partialScreenMultiple"==t&&e.getContent(".wux-layouts-collectionview").setStyles({bottom:"150px"})},initialiseAutocompleteView:function(e){F.isWebUXAutocompleteEnabled&&!0===F.isWebUXAutocompleteEnabled?F.autocomplete=c.initialiseAutocomplete(e):F.autocomplete=d.initialiseAutocomplete(e)},processAttachedModels:function(e){for(var t=[],i=e,o=0;o<i.length;o++){var a={displayName:"",name:"",revision:""};a.physicalId=i[o].physicalID;for(var n=0;n<i[o].data.length;n++)"Marketing Name"==i[o].data[n].name&&(a.displayName=i[o].data[n].value&&i[o].data[n].value[0]?i[o].data[n].value[0]:"");for(n=0;n<i[o].basicData.length;n++)"name"==i[o].basicData[n].name&&(a.name=i[o].basicData[n].value[0]),"ds6wg:revision"==i[o].basicData[n].name&&(a.revision=i[o].basicData[n].value[0]);""==a.displayName&&(a.displayName=a.name),t.push(a)}return t},initialiseExpandCollpaseEvents:function(){},getModelswithEffExpression:function(){return F.cfgCollectionVertical.getModelswithEffExpression()},switchViews:function(e){F.checkFlag="ID_HORIZONTALVIEW"!=e,F.initialiseVerticalCollection(),F.resetAttributes(),F.updateColumnsFromSettings(),F.resetHorizontalCollection(),F.initialiseUI(F.cfgCollectionVertical.get(F.currentSelectedModelId));var t=F.getCurrentSelectedView();F.cssAdjustmentsForLayout(t,F.attachedModels.length),F.updateDisplayExpression(),F.isModified=!1},showColumnManager:function(e){var t={type:"VariantsAndOptionGroups",viewId:e.viewId,parent:F.options.parent,onCloseCallback:F.onColumnManagerComplete,touchMode:!0};S.create(t)},updateColumnsFromSettings:function(){for(var e=T.UserSettings.effectivityView_VariantsAndOptionGroups,t=0;t<F.cfgCollectionVertical.length;t++){for(var i=F.cfgCollectionVertical.at(t),o=i.get("columns"),a=0;a<o.length;a++)"string"==o[a].typeRepresentation&&null!=o[a]&&null!=e[o[a].dataIndex]&&(o[a].visibleFlag=e[o[a].dataIndex]);i.set("columns",o)}},onColumnManagerComplete:function(e){if("SAVE"==e._event)if("effectivityView"==S.options.viewId){F.updateColumnsFromSettings();var t=F.cfgCollectionVertical.get(F.currentSelectedModelId);F.effectivityGridView.refreshColumns(t.get("columns"))}else F.featureOptionsView.updateColumnsFromSettings();F.sliderView.show()}};function R(e){var t=function(){o.closeDialog()},i={width:539,height:170,isResizable:!1,dialogue:{header:U.SwitchingView,buttonArray:[{label:"Ok",labelValue:U.Ok,handler:function(){F.isModified=!1,F.switchViews(e),o.closeDialog()},className:"primary"},{label:"Cancel",labelValue:U.Cancel,handler:t,className:"default"}],target:widget.body,object:null,postCrossHandler:t}},o=new D(i);o.render(),o.container.setStyle("overflow","auto"),o.container.setHTML(U.EffectivityReset+"<br><br>"+U.ResetQuestion+"<br>")}return F}),define("DS/CfgVariantEffectivityEditor/scripts/CfgVariantEffectivityInit",["DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgDialog","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgVariantEffectivityEditor/scripts/CfgVariantEffectivityController","DS/CfgBaseUX/scripts/CfgContainerView","DS/Utilities/TouchUtils","DS/CfgTracker/CfgTracker","DS/CfgTracker/CfgDimension","DS/CfgTracker/CfgValue","DS/CfgBaseUX/scripts/CfgUXEnvVariables","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUXNLS","i18n!DS/CfgVariantEffectivityEditor/assets/nls/CfgVariantEffectivityEditor","css!DS/CfgVariantEffectivityEditor/assets/styles/CfgVariantEffectivityEditor.css"],function(e,t,i,o,a,n,s,l,r,d,c,u){"use strict";var p={cancelDialog:function(){p.cfgVarDialog.closeDialog(),console.log("cfgVarDialog closed")},sendEditVariantTrackerEvent:function(e){let t="",i="",o=e.noOfContext,a=e.noOfReference,n=e.totalVariantLength,d=e.totalVariantValueLength,c=e.totalOptionGroupLength,u=e.totalOptionLength,p=e.totalNotOperatorLength,f=e.variantComplexity,h=e.totalFeaturesLength,g=e.totalFeatureOptionsLength;"Native"==e.mode?(t="Native",i="Web In Win"):(t=widget.data.appId,i=null!=widget.options?widget.options.title:"ODT Environment");let v=s.getDeviceUsedForOperation(),m=s.ConfigOperationMode.CREATE;"Edit"==e.variantMode&&(m=s.ConfigOperationMode.EDIT);let C=s.AuthoringMode.EMPTY;"Empty"!=e.authoringMode&&(C=s.AuthoringMode[e.authoringMode]);let y=s.EditVariantMode.SINGLE;s.createEventBuilder({category:s.Category.USAGE,action:s.Events.CLICK,tenant:enoviaServerFilterWidget.tenant}).setLabel(s.Labels.EDIT_VARIANT_EFFECTIVITY).setAppId(t).addDimension(l.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_EFFECTIVITY_WIDGET,i).addDimension(l.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_EFFECTIVITY_MEDIA,v).addDimension(l.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_EFFECTIVITY_MODE,m).addDimension(l.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_AUTHORING_MODE,C).addDimension(l.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_EFFECTIVITY_TYPE_MODE,y).addPersonalValue(r.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_NO_OF_MODEL,o).addPersonalValue(r.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_REFERENCE_SELECTED,a).addPersonalValue(r.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_TOTAL_NO_VARIANT,n).addPersonalValue(r.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_TOTAL_NO_VARIANT_VALUE,d).addPersonalValue(r.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_TOTAL_NO_OPTION_GROUP,c).addPersonalValue(r.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_TOTAL_NO_OPTION,u).addPersonalValue(r.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_TOTAL_NO_NOT_OPERATOR,p).addPersonalValue(r.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_COMPLEXITY,f).addPersonalValue(r.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_DICTIONARY_FEATURES,h).addPersonalValue(r.EDIT_VARIANT_EFFECTIVITY.EDIT_VARIANT_DICTIONARY_FEATURE_OPTIONS,g).send()},callEditVariantTrackerEvent:function(e){let t={noOfContext:p.MySkeleton.attachedModels.length,mode:"Dashboard"};"Native"==e.mode&&(t.mode="Native"),t.variantMode="Create",1==p.MySkeleton.options.hasEffectivity&&(t.variantMode="Edit"),t.authoringMode="Empty",p.MySkeleton.options.ca.headers.length>0&&("DS-Change-Authoring-Context"==p.MySkeleton.options.ca.headers[0].key?t.authoringMode="CHANGE":"DS-Configuration-Authoring-Context"==p.MySkeleton.options.ca.headers[0].key&&(t.authoringMode="EVOLUTION")),t.noOfReference=1;let i=p.MySkeleton.getProbesInfoDetailsWithXML(e.globalExpression);t.totalVariantLength=i.totalVariantLength,t.totalVariantValueLength=i.totalVariantValueLength,t.totalOptionGroupLength=i.totalOptionGroupLength,t.totalOptionLength=i.totalOptionLength,t.totalNotOperatorLength=i.totalNotOperatorLength,t.variantComplexity=i.variantComplexity,t.totalFeaturesLength=i.totalFeaturesLength,t.totalFeatureOptionsLength=i.totalFeatureOptionsLength,p.sendEditVariantTrackerEvent(t)},setVariantEffectivity:function(){null!=p.cfgVarDialog.footerButton.Apply&&(p.cfgVarDialog.footerButton.Apply.disabled=!0);var e=p.MySkeleton.getGlobalXMLExpression();if(console.log("Variant XMLExpression : "+e),1!=p.varOptions.isEmptyVariantEffectivity||""!=e){p.globalExpression=e;var t,o=function(e){console.log(e);var t=" ",o=" ";if(null!=e.GlobalStatus&&"SUCCESS"==e.GlobalStatus){var a=e.results[0],n=a.existing,s=a.new;if(null!=n&&null!=n.pid&&(t=n.pid,null!=n.content&&null!=n.content.Variant)){var l=n.content.Variant;e.results[0].existing.content.displayExpression=i.getDisplayExpressionUsingXSLT(l)}if(null!=s&&null!=s.pid&&(o=s.pid,null!=s.content&&null!=s.content.Variant)){var r=s.content.Variant;e.results[0].new.content.displayExpression=i.getDisplayExpressionUsingXSLT(r)}}if(p.varOptions.postOKHandler&&p.varOptions.postOKHandler(e),null!=e.GlobalStatus&&"SUCCESS"==e.GlobalStatus){var d={commandName:"cfgEditVariant",widgetId:widget.id,response:i.getEventResponse(e),data:{}};i.publishPostProcessingEventForApplications(d)}if(" "!=t&&" "!=o&&i.showwarning(u.CFG_Application_Refresh_For_Instance_Evolved,"info"),p.cfgVarDialog.closeDialog(),void 0!==e.GlobalStatus&&"SUCCESS"==e.GlobalStatus||void 0!==e.unset&&("SUCCESS"===e.unset.Variant.status.toUpperCase()||"WARNING"===e.unset.Variant.status.toUpperCase()))i.showwarning(u.Save_Successful_Var_Effectivity,"success");else if(void 0!==e.GlobalStatus&&"ERROR"==e.GlobalStatus&&void 0!==e.results[0].errorDetails){if(126==e.results[0].errorCode){let e="";null!=p.cfgVarDialog&&null!=p.cfgVarDialog.options&&null!=p.cfgVarDialog.options.dialogue&&null!=p.cfgVarDialog.options.dialogue.header&&2==p.cfgVarDialog.options.dialogue.header.split("- ").length&&p.cfgVarDialog.options.dialogue.header.split("- ")[1].length>0&&(e=p.cfgVarDialog.options.dialogue.header.split("- ")[1]);let t=c.CfgMessageNoEditVariantTitle.replace("{1}",e),o=c.CfgMessageNoEditVariantAction.replace("{1}","<b>"+c.CfgHeaderEditConfigurationContext+"</b>");i.showNotifs("error",t,c.CfgMessageNoEditVariantSubTitle,o)}else 135==e.results[0].errorCode||136==e.results[0].errorCode?i.showwarning(u.Save_Fail_Var_Effectivity+" "+e.results[0].message,"error"):i.showwarning(u.Save_Fail_Var_Effectivity+" "+e.results[0].errorDetails,"error");console.log("Edit Variant Effectivity operation error = "+e.results[0].errorDetails)}else i.showwarning(u.Save_Fail_Var_Effectivity,"error");p.callEditVariantTrackerEvent({mode:"Dashboard",globalExpression:p.globalExpression})},a=function(e){console.log(e),p.cfgVarDialog.closeDialog(),i.isDefined(e)&&i.isDefined(e.errorMessage)?i.showwarning(u.Save_Fail_Var_Effectivity+"\n"+e.errorMessage,"error"):i.showwarning(u.Save_Fail_Var_Effectivity,"error")},n=null;if(p.varOptions.ca.headers.length>0&&(n={operationheader:{key:p.varOptions.ca.headers[0].key,value:p.varOptions.ca.headers[0].value}}),""==e){var s=[];s.push(p.varOptions.instanceID),t={version:"1.0",wsOptions:n,unsetList:s,domain:"Variant"},i.unsetVariantEffectivities(t).then(function(e){o(e)},function(e){a(e)})}else t={version:"1.1",domain:"Variant",view:"All",expressionList:[{pid:p.varOptions.instanceID,VariantContent:e}],wsOptions:n},"xRevision"===p.varOptions.isEvolutionBasedOn&&(t.version="2.0"),i.setVariantEffectivities(t).then(function(e){o(e)},function(e){a(e)})}else p.cfgVarDialog.closeDialog()},onSaveEffectivity:function(e){var t={eventName:"cfgEditVariantEffectivity",operation:"firstButton"==e.buttonId?"OK":"Cancel",operationVersion:"1.0",content:""};if("Native"==window.enoviaServerFilterWidget.mode){null!=p.variantContainer&&null!=p.variantContainer._firstButton&&(p.variantContainer._firstButton.disabled=!0);var o={modelIdsWithEffectivity:p.MySkeleton.getModelswithEffExpression(),globalEffectivityExpression:p.MySkeleton.getGlobalXMLExpression(),propagateSessionEffectivity:e.propagateSessionEffectivity};t.content=JSON.stringify(o),i.sendNotificationWebInWin(t),p.callEditVariantTrackerEvent({mode:"Native",globalExpression:o.globalEffectivityExpression})}else if("EXTERNAL"==window.enoviaServerFilterWidget.mode){var a={version:"0.1",xmlExpression:p.MySkeleton.getGlobalXMLExpression(),configurable:p.varOptions.configurable,filterables:p.varOptions.filterables};if(1==i.isParamDefined(a.xmlExpression))i.setVariantforExternal(a).then(function(e){t.content=JSON.stringify(e),i.sendNotificationWebInWin(t)});else if(1==i.isDefined(a.filterables))if(0==a.filterables.length){var n={filterables:[]};t.content=JSON.stringify(n),i.sendNotificationWebInWin(t)}else{a={version:"0.1",configurable:p.varOptions.configurable,filterables:p.varOptions.filterables};i.unsetVariantforExternal(a).then(function(e){t.content=JSON.stringify(e),i.sendNotificationWebInWin(t)})}else{n={filterables:[]};t.content=JSON.stringify(n),i.sendNotificationWebInWin(t)}}},init:function(i){e.clear(),this.varOptions=i,this.varOptions.touchMode=n.getTouchMode();if("Dashboard"==this.varOptions.mode)this.varOptions.dialogue.buttonArray=[{label:"Apply",labelValue:u.Edit_Var_OK,handler:this.setVariantEffectivity,className:"primary"},{label:"Cancel",labelValue:u.Edit_Var_Cancel,handler:this.cancelDialog,className:"default"}],this.varOptions.height=1e3,this.varOptions.width=1100,this.varOptions.minHeight=406,this.varOptions.minWidth=320,this.varOptions.touchMode=!!this.varOptions.touchMode,this.cfgVarDialog=new t(this.varOptions),this.cfgVarDialog.render(),this.varOptions.parent=this.cfgVarDialog.container,this.varOptions.parentElement=this.cfgVarDialog.container,this.MySkeleton=o.init(this.varOptions);else{var s={isHeader:!1,isFooter:!0,firstButtonText:u.Edit_Var_OK,secondButtonText:u.Edit_Var_Cancel,headerText:"",toggleSessionEffectivity:!1,onButtonClickCB:this.onSaveEffectivity};this.variantContainer=new a(s).render(),this.variantContainer.inject(i.parentElement),this.varOptions.parent=this.variantContainer._body,this.MySkeleton=o.init(this.varOptions)}}};return p});