define("DS/DMUPlayMarker/DMUMarker2DSpline",["DS/DMUPlayMarker/DMUMarker2D","DS/DMUPlayMarker/DMUMarker2DSplineNode3D","DS/DMUPlayMarker/DMUMarker2DPoint","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPImportServices","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r,n,o){"use strict";var a=[{name:"oPoints",type:"objectDefinition",JSONname:"Properties2DMultiPoint.Points"}];return e.extend({init:function(e,s){this._parent(e,s),this.addParameters(a),this.removeParameters(["cFillStyleColor","bIsFilled","bHasBorder","fOpacity"]),this.setAttribute("sType","Marker2DSpline");var l=this,d=[],c=new n;this.getPoints=function(e){var t;if(e||!d.length){var n=l.getAttribute("oPoints");for(t=0;t<d.length;t++)d[t].remove();for(d.length=0,t=0;t<n.length;t++){var o=r.getReviewContext({viewer:l._viewer}),a=new i(l._viewer,o.getCurrentSessionMarkup());c.fillObjectAttributes(a,n[t]),d.push(a)}}return d},this.setNode(new t({frmWindow:this._frmWindow,getType:this.getType,getPoints:l.getPoints})),this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar");var p=this.refreshNode;this.refreshNode=function(){l.getNode()&&!s.isImporting()&&(l.getNode().update({name:l.getAttribute("sName"),isVisible:l.getAttribute("bVisible"),windowAnchor:l.getAttribute("sWindowAnchor"),isPositionProportional:l.getAttribute("bProportionalPosition"),points:l.getAttribute("oPoints"),rotationAngle:"number"==typeof l.getAttribute("fScreenRotationAngle")?l.getAttribute("fScreenRotationAngle"):l.getAttribute("fRotationAngle"),graphicProperties:{lineStyle:{thickness:o.getLineThickness(l.getAttribute("fLineStyleThicknessIndex"))||l.getAttribute("fLineStyleThickness"),pattern:l.getAttribute("sLineStylePattern"),color:l.getAttribute("cLineStyleColor"),opacity:l.getAttribute("fLineStyleOpacity")}}}),p())},this.getMaximumProportionalWidth=function(){var e=0;if(l.getAttribute("bProportionalPosition"))for(var t,i=l.getPoints(),r=0;r<i.length;r++)t=i[r].getAttribute("vPosition"),Math.abs(t.x)>e&&(e=Math.abs(t.x));return e}}})}),define("DS/DMUPlayMarker/DMUMarker2DSplineNode3D",["DS/Visualization/ThreeJS_DS","DS/DMUBaseUI/DMUNode2D","DS/DMUBaseExperience/EXPToolsMaterial","DS/Visualization/SceneGraphFactory","DS/SceneGraphNodes/BillBoardNode3D","DS/SceneGraphNodes/FixedSizeNode3D"],function(e,t,i,r,n,o){"use strict";return t.extend({init:function(t){var a=t||{};this._parent(a);var s,l,d=this,c={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}},p=new n({type:"Spherical"});this.addChild(p),p.setPickParent(!0);var h=new o({ratio:1});p.addChild(h),h.setPickParent(!0),this.removeDMUNode3DOverload=function(){d=h=s=null},this.updateScreenPosition=function(){l&&d.setMatrix((new e.Matrix4).setPosition(d.get3DPositionFromScreenCoordinates({coords:l,width:c.fullWidthPx,anchor:"center",windowAnchor:c.windowAnchor,proportionalPosition:c.isPositionProportional})))},this.update=function(t){var n;if(d){if(JSON.stringify(t)!==JSON.stringify(c)||c.isPositionProportional&&(c.screenWidth!==d.getViewer().SCREEN_WIDTH||c.screenHeight!==d.getViewer().SCREEN_HEIGHT)){var o=c.graphicProperties&&c.graphicProperties.lineStyle?JSON.stringify(c.graphicProperties.lineStyle):"";(c=d.mergeParams(c,t)).screenWidth=d.getViewer().SCREEN_WIDTH,c.screenHeight=d.getViewer().SCREEN_HEIGHT,d.setName(c.name);var p,u=a.getPoints(!0),g=[];for(l=new e.Vector2,n=0;n<u.length;n++)(p=u[n].getAttribute("vPosition"))&&(g.push(p),l.x+=p.x,l.y+=p.y);g.length&&l.multiplyScalar(1/g.length),s&&JSON.stringify(c.graphicProperties.lineStyle)===o||(s=i.createLineMaterial({color:c.graphicProperties.lineStyle.color,opacity:c.graphicProperties.lineStyle.opacity,lineWidth:c.graphicProperties.lineStyle.thickness*window.devicePixelRatio,pattern:c.graphicProperties.lineStyle.pattern})),h.removeChildren();var P,f=[],y=[];if(g.length>1){var D=c.isPositionProportional?d.convertCoordsInPixels({coords:l,windowAnchor:c.windowAnchor,fitOnX:!0}):l.clone();for(n=0;n<g.length;n++)P=g[n].clone(),c.isPositionProportional&&(P=d.convertCoordsInPixels({coords:P,proportionalPosition:c.isPositionProportional,windowAnchor:c.windowAnchor,fitOnX:!0})),P.sub(D),y.push(P);for(y=new e.SplineCurve(y).getPoints(150),n=0;n<y.length;n++)f.push(new e.Vector3(y[n].x,-y[n].y,0));var S,m,M=new e.Matrix4;c.rotationAngle&&(M=M.multiply((new e.Matrix4).makeRotationAxis(new e.Vector3(0,0,1),c.rotationAngle))),f.forEach(function(e){e.applyMatrix4(M),void 0===S?(S=e.x,m=e.x):(S=Math.max(S,e.x),m=Math.min(e.x,m))}),c.fullWidthPx=S-m;var b=r.createLineNode({points:f,material:s});b.setShadow(!1),b.setPickParent(!0),h.addChild(b)}d.setVisibility(c.isVisible)}d.updateScreenPosition()}},this.onViewerEventCB=function(e){d&&"onSwapVisibleSpace"===e.eventType&&c&&d.setVisibility(c.isVisible)}}})}),define("DS/DMUPlayMarker/DMUMarker2DPictureNode3D",["DS/Visualization/Node3D","DS/DMUBaseUI/DMUNode2D","DS/Visualization/ThreeJS_DS","DS/DMUMarkerVisu/DMUMarkerVisuPictureShapeNode","DS/DMUBaseUI/DMUToolsLeader","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUMeasurable/DMUMathsInfiniteGeometry"],function(e,t,i,r,n,o,a){"use strict";return t.extend({init:function(t){var s=t||{};this._parent(s);var l=this,d={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}},c=new r({window:s.frmWindow,data:{isPicture:!0,mkvShape:s.mkvShape,graphicProperties:{padding:0}}});this.addChild(c),c.setPickParent(!0);var p=new e;function h(t,r,c,h){if(!d.hasALeader)return p.setVisibility(!1),void p.setVisibilityFree(!0);if(p.setVisibility(!0),p.setVisibilityFree(!1),0===l.getViewer().getVisibleSpace()&&!1===d.isVisible||1===l.getViewer().getVisibleSpace()&&!0===d.isVisible){var u=0;switch(d.leaderEndType){case"Arrow":u=1;break;case"Bubble":u=2;break;case"Cross":u=4;break;case"Square":u=3}if(c.offsetWidth>0&&c.offsetHeight>0){var g=t.clone(),P={offsetWidth:c.width/window.devicePixelRatio,offsetHeight:c.height/window.devicePixelRatio,rotationAngle:h};if("topleft"===d.anchorMode){var f=o.getViewerPositionFromPoint(l.getViewer(),g);if(!isNaN(f.left)&&!isNaN(f.top)){var y=new i.Vector2(f.left+P.offsetWidth/2,f.top+P.offsetHeight/2),D=o.getLineFromWindowPosition(l.getViewer(),y.x,y.y),S=o.getViewpointInfo(l.getViewer().currentViewpoint),m=a.computeLinePlaneDistance(D.position.toArray(),D.direction.toArray(),t.toArray(),S.sight.toArray());g=new i.Vector3(m.aPosition[0],m.aPosition[1],m.aPosition[2])}}var M,b,v=r;if(void 0!==v&&v.length){var A=p.getChildren().filter(function(e){return!e.isManipulator});if(v.length<A.length)for(var x=A.length-1;x>=v.length;x--)p.removeChild(A[x]);for(var w=0;w<v.length;w++){b=l.get3DPositionFromScreenCoordinates({coords:v[w],windowAnchor:d.windowAnchor,proportionalPosition:d.isPositionProportional}),(M=A[w])||((M=new e("DMUMarkerLeaderNode")).setPickParent(!0),p.addChild(M));let t={width:d.leaderAttachWidthRatio,height:d.leaderAttachLengthRatio},i=n.modifyLeaderNode(l.getViewer(),M,!0,g,b,t,d.graphicProperties.leaderStyle.thickness*window.devicePixelRatio,d.graphicProperties.leaderStyle.color,d.graphicProperties.leaderStyle.pattern,u,P,s.frmWindow);M.setVisibility(i)}}}}}this.addChild(p),p.setPickParent(!0),this.linkManipulatorToNode(c.getBackNode()),this.getRepNode=function(){return{leader:p,box:c.getLabelNode()}},this.getLabelDimensions=function(){var e=c.getDimensions();return e.position=d.position,e},this.updateRepresentation=function(e,t){c.setTransformation({scaleMatrix:(new i.Matrix4).makeScale(d.imageWidth?e.imgWidth/d.imageWidth:1,d.imageHeight?e.imgHeight/d.imageHeight:1,1),rotationAngle:e.rotationAngle}),c.setMatrix((new i.Matrix4).setPosition(e.position));var r=e.leaderPoints.map(function(e){var t=o.getViewerPositionFromPoint(l.getViewer(),e);return new i.Vector2(t.left,t.top)});h(e.position,r,{width:e.width,height:e.height,offsetWidth:e.imgWidth,offsetHeight:e.imgHeight},e.rotationAngle),c.setGhostMode(t)},this.getLabelParams=function(){var e=c.getDimensions();return{leaderPoints:d.pointingPoints.map(function(e){return l.get3DPositionFromScreenCoordinates({coords:e,windowAnchor:d.windowAnchor,proportionalPosition:d.isPositionProportional})}),position:d.position,rotationAngle:d.boxRotationAngle?d.boxRotationAngle:0,anchorMode:d.anchorMode,width:e.width,height:e.height,imgWidth:d.imageWidth,imgHeight:d.imageHeight}};var u=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){u(),c&&c.remove(),l=p=c=null},this.getPixelFontSize=function(){var e=d.graphicProperties.fontStyle.fontSize;return!e&&d.graphicProperties.fontStyle.pxheight&&(e=o.convertPixelToModel({sizeInPixels:d.graphicProperties.fontStyle.pxheight,viewer:l.getViewer()})),o.convertModelToPixels({sizeInMM:e,viewer:l.getViewer()})},this.updateScreenPosition=function(){d&&d.breakPoint2D&&(d.position=l.get3DPositionFromScreenCoordinates({coords:d.breakPoint2D.clone(),anchor:d.anchorMode,windowAnchor:d.windowAnchor,width:c.getDimensions().width,proportionalPosition:d.isPositionProportional}),c.setMatrix((new i.Matrix4).setPosition(d.position)),h(d.position,d.pointingPoints,c.getDimensions(),d.boxRotationAngle))},this.update=function(e){if(l){d.graphicProperties.fontStyle.height=void 0,e.graphicProperties.fontStyle.height=void 0,d=d?l.mergeParams(d,e):e,l.setName(d.name);var t=l.getRepManipulator();t&&t.deactivate(),d.isPositionProportional&&(d.graphicProperties.padding=0,d.imageWidth=l.convertProportionalCoordInPixels(d.imageWidth,!0),d.imageHeight=l.convertProportionalCoordInPixels(d.imageHeight,!0)),d.graphicProperties.fontStyle.height=l.getPixelFontSize(),c.modify(d),l.updateScreenPosition(),t&&t.activate(),l.setVisibility(d.isVisible),l.getViewer().render()}},this.onViewerEventCB=function(e){l&&"onSwapVisibleSpace"===e.eventType&&d&&(l.setVisibility(d.isVisible),h(d.position,d.pointingPoints,c.getDimensions(),d.boxRotationAngle))}}})}),define("DS/DMUPlayMarker/DMUMarker2DRectangleNode3D",["DS/DMUBaseExperience/EXPToolsMaterial","DS/SceneGraphNodes/FixedSizeNode3D","DS/Visualization/ThreeJS_DS","DS/DMUBaseUI/DMUNode2D","DS/Visualization/SceneGraphFactory","DS/SceneGraphNodes/BillBoardNode3D"],function(e,t,i,r,n,o){"use strict";return r.extend({init:function(r){this._parent(r);var a=this,s={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}},l=new o({type:"Spherical"});l.setPickParent(!0),this.addChild(l);var d,c,p=new t({ratio:1});l.addChild(p),p.setPickParent(!0),this.updateScreenPosition=function(){s&&s.position&&a.setMatrix((new i.Matrix4).setPosition(a.get3DPositionFromScreenCoordinates({coords:s.position,width:s.widthPx,anchor:s.anchor,windowAnchor:s.windowAnchor,proportionalPosition:s.isPositionProportional})))},this.update=function(t){if(a){if(!s||JSON.stringify(t)!==JSON.stringify(s)||s.isPositionProportional&&(s.screenWidth!==a.getViewer().SCREEN_WIDTH||s.screenHeight!==a.getViewer().SCREEN_HEIGHT)){var r=s&&s.graphicProperties&&s.graphicProperties.fillStyle?JSON.stringify(s.graphicProperties.fillStyle):"",o=s&&s.graphicProperties&&s.graphicProperties.lineStyle?JSON.stringify(s.graphicProperties.lineStyle):"";s=s?a.mergeParams(s,t):t,a.setName(s.name),s.screenWidth=a.getViewer().SCREEN_WIDTH,s.screenHeight=a.getViewer().SCREEN_HEIGHT,s.isPositionProportional?(s.widthPx=a.convertProportionalCoordInPixels(s.width,!0),s.heightPx=a.convertProportionalCoordInPixels(s.height,!0)):(s.widthPx=s.width,s.heightPx=s.height),p.removeChildren(),c&&JSON.stringify(s.graphicProperties.fillStyle)===r||(c=e.createBasicMaterial({color:s.graphicProperties.fillStyle.color,opacity:s.graphicProperties.fillStyle.opacity})),d&&JSON.stringify(s.graphicProperties.lineStyle)===o||(d=e.createLineMaterial({color:s.graphicProperties.lineStyle.color,opacity:s.graphicProperties.lineStyle.opacity,lineWidth:s.graphicProperties.lineStyle.thickness*window.devicePixelRatio,pattern:s.graphicProperties.lineStyle.pattern}));var l,h=new i.Matrix4;s.rotationAngle&&h.makeRotationAxis(new i.Vector3(0,0,1),s.rotationAngle),h.multiply((new i.Matrix4).makeTranslation(-s.widthPx/2,-s.heightPx/2,0)),s.isFilled&&((l=n.createRectangleNode({width:s.widthPx,height:s.heightPx,fill:!0,material:c})).setShadow(!1),l.setPickParent(!0),l.setMatrix(h),p.addChild(l)),s.hasBorder&&((l=n.createRectangleNode({width:s.widthPx,height:s.heightPx,fill:!1,material:d})).setShadow(!1),l.setPickParent(!0),l.setMatrix(h),p.addChild(l)),a.setVisibility(s.isVisible)}a.updateScreenPosition()}},this.removeDMUNode3DOverload=function(){l=a=p=null},this.onViewerEventCB=function(e){a&&"onSwapVisibleSpace"===e.eventType&&s&&a.setVisibility(s.isVisible)}}})}),define("DS/DMUPlayMarker/DMUMarkerTools",["UWA/Core","DS/WebappsUtils/WebappsUtils","DS/DMUBaseExperience/DMUContextManager","DS/Visualization/ThreeJS_DS","DS/PADUtils/PADSettingsMgt"],function(e,t,i,r,n){"use strict";var o={getCircleSegments:function(e,t){let i;return t>0&&(i=Math.round(2*Math.PI/Math.acos(1-1/((e||0)/t))),(isNaN(i)||i<20)&&(i=20)),i},getArrowSpecs:function(e,t,i,n,o){var a=(1-i)*t,s=e/2,l=0,d=null!=n?n:.5,c=[],p=[];"beginSide"===o?(c[l++]=0,c[l++]=0,c[l++]=0,c[l++]=a,c[l++]=-s-e*d,c[l++]=0,c[l++]=a,c[l++]=-s,c[l++]=0,c[l++]=t,c[l++]=-s,c[l++]=0,c[l++]=t,c[l++]=s,c[l++]=0,c[l++]=a,c[l++]=s,c[l++]=0,c[l++]=a,c[l++]=s+e*d,c[l++]=0):"bothSide"===o&&(c[l++]=0,c[l++]=0,c[l++]=0,c[l++]=a,c[l++]=-s-e*d,c[l++]=0,c[l++]=a,c[l++]=-s,c[l++]=0,c[l++]=t-a,c[l++]=-s,c[l++]=0,c[l++]=t-a,c[l++]=-s-e*d,c[l++]=0,c[l++]=t,c[l++]=0,c[l++]=0,c[l++]=t-a,c[l++]=s+e*d,c[l++]=0,c[l++]=t-a,c[l++]=s,c[l++]=0,c[l++]=a,c[l++]=s,c[l++]=0,c[l++]=a,c[l++]=s+e*d,c[l++]=0);var h=[];l=0,h[l++]=0,h[l++]=0,h[l++]=1;var u=[];l=0,"beginSide"===o?(u[l++]=1,u[l++]=1,u[l++]=1,u[l++]=1,u[l++]=1,u[l++]=1,u[l++]=1,p.push(0),p.push(1),p.push(2),p.push(0),p.push(2),p.push(3),p.push(0),p.push(3),p.push(4),p.push(0),p.push(4),p.push(5),p.push(0),p.push(5),p.push(6)):"bothSide"===o&&(u[l++]=1,u[l++]=1,u[l++]=1,u[l++]=1,u[l++]=1,u[l++]=1,u[l++]=1,u[l++]=1,u[l++]=1,u[l++]=1,p.push(0),p.push(1),p.push(2),p.push(0),p.push(2),p.push(3),p.push(3),p.push(4),p.push(5),p.push(3),p.push(6),p.push(5),p.push(3),p.push(7),p.push(8),p.push(0),p.push(8),p.push(3),p.push(0),p.push(8),p.push(9));var g=[];l=0;for(var P=0;P<c.length/3;P++)g.push(new r.Vector3(c[3*P],c[3*P+1],c[3*P+2]));return g.push(new r.Vector3(c[0],c[1],c[2])),{bufferPosition:c,bufferNormal:h,bufferUV:u,bufferIndex:p,coordinates:g}},getBentArrowSpecs:function(e,t,i,n,o,a,s){var l,d,c,p=[],h=[],u=0,g=e/2;"beginSide"===s?(p[u++]=0,p[u++]=0,p[u++]=0,p[u++]=g,p[u++]=-(1-o)*i,p[u++]=0,p[u++]=g-a*n,p[u++]=-(1-o)*i,p[u++]=0,p[u++]=g-a*n,p[u++]=-i,p[u++]=0,p[u++]=-n+g,p[u++]=-i,p[u++]=0,p[u++]=-n+g,p[u++]=-i+t,p[u++]=0,p[u++]=a*n-g,p[u++]=-i+t,p[u++]=0,p[u++]=a*n-g,p[u++]=-(1-o)*i,p[u++]=0,p[u++]=-g,p[u++]=-(1-o)*i,p[u++]=0):"bothSide"===s&&(l=(1-o-a)*i,d=(1-o-a)*n,p[u++]=0,p[u++]=0,p[u++]=0,p[u++]=g,p[u++]=-l,p[u++]=0,p[u++]=g-a*n,p[u++]=-l,p[u++]=0,p[u++]=g-a*n,p[u++]=a*i-i,p[u++]=0,p[u++]=-n+g+d,p[u++]=a*i-i,p[u++]=0,p[u++]=-n+g+d,p[u++]=-i,p[u++]=0,p[u++]=-n+g,p[u++]=t/2-i,p[u++]=0,p[u++]=-n+g+d,p[u++]=-i+t,p[u++]=0,p[u++]=-n+g+d,p[u++]=-i+t-a*i,p[u++]=0,p[u++]=a*n-g,p[u++]=-i+t-a*i,p[u++]=0,p[u++]=a*n-g,p[u++]=-l,p[u++]=0,p[u++]=-g,p[u++]=-l,p[u++]=0);var P=n/2-g,f=i/2;for(c=0;c<p.length/3;c++)p[3*c]+=P,p[3*c+1]+=f;var y=[];u=0,y[u++]=0,y[u++]=0,y[u++]=1;var D=[];u=0,"beginSide"===s?(D[u++]=1,D[u++]=1,D[u++]=1,D[u++]=1,D[u++]=1,D[u++]=1,D[u++]=1,D[u++]=1,D[u++]=1,h.push(0),h.push(1),h.push(8),h.push(2),h.push(6),h.push(7),h.push(2),h.push(3),h.push(6),h.push(3),h.push(5),h.push(6),h.push(3),h.push(4),h.push(5)):"bothSide"===s&&(D[u++]=1,D[u++]=1,D[u++]=1,D[u++]=1,D[u++]=1,D[u++]=1,D[u++]=1,D[u++]=1,D[u++]=1,D[u++]=1,D[u++]=1,D[u++]=1,h.push(0),h.push(1),h.push(2),h.push(0),h.push(2),h.push(3),h.push(3),h.push(4),h.push(8),h.push(4),h.push(5),h.push(6),h.push(4),h.push(6),h.push(7),h.push(3),h.push(8),h.push(9),h.push(0),h.push(3),h.push(9),h.push(0),h.push(9),h.push(10),h.push(0),h.push(10),h.push(11));var S=[];for(u=0,c=0;c<p.length/3;c++)S.push(new r.Vector3(p[3*c],p[3*c+1],p[3*c+2]));return S.push(new r.Vector3(p[0],p[1],p[2])),{bufferPosition:p,bufferNormal:y,bufferUV:D,bufferIndex:h,coordinates:S}},getEllipseSpecs:function(e,t,i){var n,o,a=new r.Vector3;i>0&&(n=Math.round(2*Math.PI/Math.acos(1-1/(e/i))),o=Math.round(2*Math.PI/Math.acos(1-1/(t/i)))),(isNaN(n)||n<0)&&(n=20),(isNaN(o)||o<0)&&(o=20);var s=n>o?n:o,l=[],d=[],c=[],p=0;d[p++]=a.x,d[p++]=a.y,d[p++]=a.z;var h=[];h[0]=1;for(var u=0;u<=s;u++){var g=new r.Vector3(e*Math.cos(Math.PI*u/(s/2)),-t*Math.sin(Math.PI*u/(s/2)),0);l.push(g),h[p]=1,d[p++]=g.x,d[p++]=g.y,d[p++]=g.z}for(var P=0;P<d.length/3;P++)c.push(0),c.push(P),c.push(P+1);c.push(0),c.push(d.length/3-1),c.push(1);var f=[],y=0;return f[y++]=0,f[y++]=0,f[y++]=1,{bufferPosition:d,bufferNormal:f,bufferUV:h,bufferIndex:c,coordinates:l}},solveHyperlink:function(e,t){if(e){if(e.urls&&e.urls.length)for(var r=0;r<e.urls.length;r++)-1!==e.urls[r].indexOf("http")&&window.open(e.urls[r]);if(e.ids&&e.ids.length){var o=i.getContextViewer({viewer:t});o&&o.getController().getAttributes({ids:e.ids,attributes:["ds6w:type","ds6w:label"],callbacks:{onComplete:function(t){require(["DS/PADUtils/PADUtilsServices","DS/TransientWidget/TransientWidget"],function(i,r){for(var o,a=[],s=0;s<e.ids.length;s++)t[e.ids[s]]["ds6w:type"]&&(o={protocol:"3DXContent",version:"0.1",source:"X3DCSMA_AP",data:{items:[{envId:i.getPlatformId(),serviceId:"3DSpace",objectId:e.ids[s],objectType:t[e.ids[s]]["ds6w:type"],contextId:n.getSetting("pad_security_ctx")}]}},a.push({id:"X3DPLAW_AP",title:t[e.ids[s]]["ds6w:label"],data:{x3dSharedId:widget.getValue("x3dSharedId"),x3dPlatformId:widget.getValue("x3dPlatformId"),X3DContentId:JSON.stringify(o)}}));1===a.length?r.showWidget(a[0].id,a[0].title,a[0].data):a.length>1&&r.showWidget(a)})},onFailure:function(){}}})}}},getHyperlinkIcon:function(e){return t.getWebappsAssetUrl("DMUPlayMarker","icons/32/")+(e&&e.urls&&e.urls.length?"I_WebMarkerHyperlink_url_Old.png":"I_WebMarkerHyperlink_default_Old.png")},createHyperlinkDiv:function(t){var i;if(t&&t.urls&&t.urls.length){var r;i=e.createElement("div");for(var n=0;n<t.urls.length;n++)-1!==t.urls[n].indexOf("http")?((r=e.createElement("a",{styles:{margin:"2px",padding:0}}).inject(i)).href=t.urls[n],e.createElement("br").inject(i)):r=e.createElement("p",{styles:{margin:"2px",padding:0,userSelect:"text"}}).inject(i),r.innerHTML=t.urls[n]}return i},getPointedReferencesVisibilityStates:function(e,t){var r=[];if(!t||!e)return r;var n=Array.isArray(t)?t:[t];if(n.length){var o=e.getSceneGraphOverrideSetManager(),a=i.getReviewContext({viewer:e});if(a&&a.getCurrentSessionMarkup()){var s=a.getCurrentSessionMarkup().getAttribute("oLinksManager");if(s&&o)for(var l=0;l<n.length;l++)if("null"!==n[l]){var d=s.getOccurrencePathElement(n[l]);d&&!1!==o.getCurrentVisibility(d)?r.push(!0):r.push(!1)}else r.push(!0)}}return r},is3DMarkerDisplayed:function(e,t,i){var r=o.getPointedReferencesVisibilityStates(e,t);return 0===r.length||!i&&-1!==r.indexOf(!0)||i&&-1===r.indexOf(!1)},compareAndMergeParams:function(e){var t=!1,i=function(e,t){if(Array.isArray(e)&&Array.isArray(t)){if("object"!=typeof e[0])return e.toString()===t.toString();if(e.length===t.length){for(var r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1;return!0}return!1}var n=e&&t&&e.equals?e.equals(t):void 0;return void 0===n?e===t:n};if("object"!=typeof e.paramA&&"object"!=typeof e.paramB)return i(e.paramA,e.paramB);if("object"==typeof e.paramA&&"object"==typeof e.paramB){t=!0,e.mergedKeys||(e.mergedKeys=[]);var r=Object.keys(e.paramB),n=Object.keys(e.paramA).slice();r.forEach(function(e){n.includes(e)||n.push(e)}),n.forEach(function(r){if(!e.paramA[r]||!e.paramB[r]||Array.isArray(e.paramA[r])||Array.isArray(e.paramB[r])||e.paramB[r].clone||"object"!=typeof e.paramA[r]&&"object"!=typeof e.paramB[r])i(e.paramA[r],e.paramB[r])||(t=!1,e.merge&&(e.paramA[r]=null!=(a=e.paramB[r])?Array.isArray(a)?a.slice():a.clone?a.clone():a:a,e.mergedKeys.push(r)));else{var n={paramA:e.paramA[r],paramB:e.paramB[r],merge:e.merge,mergedKeys:e.mergedKeys};o.compareAndMergeParams(n)||(t=!1,e.merge&&e.mergedKeys.push(r))}var a})}return t},getControlPoints:function(e,t){for(var i,r,n,o,a=0,s=0,l=[],d=1;d<e.length;d++){var c=(i=e[0],r=e[e.length-1],n=e[d],o=void 0,o=r.clone().sub(i).normalize(),i.clone().sub(n).sub(o.multiplyScalar(i.clone().sub(n).dot(o))).length());c>a&&(a=c,s=d)}if(a>t){var p=this.getControlPoints(e.slice(0,s+1),t),h=this.getControlPoints(e.slice(s+1,e.length),t);p.pop(),l=p.concat(h)}else l.push(e[0]),l.push(e[e.length-1]);return l}};return o}),define("DS/DMUPlayMarker/DMUMarker2DCircleNode3D",["DS/SceneGraphNodes/BillBoardNode3D","DS/Visualization/ThreeJS_DS","DS/SceneGraphNodes/FixedSizeNode3D","DS/Visualization/SceneGraphFactory","DS/DMUBaseExperience/EXPToolsMaterial","DS/DMUBaseUI/DMUNode2D"],function(e,t,i,r,n,o){"use strict";return o.extend({init:function(o){this._parent(o);var a,s,l=this,d={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}},c=new e({type:"Spherical"});this.addChild(c),c.setPickParent(!0);var p=new i({ratio:1});c.addChild(p),p.setPickParent(!0),this.removeDMUNode3DOverload=function(){l=a=s=c=p=null},this.updateScreenPosition=function(){d&&l.setMatrix((new t.Matrix4).setPosition(l.get3DPositionFromScreenCoordinates({coords:d.center,width:2*d.radiusPx,anchor:"center",windowAnchor:d.windowAnchor,proportionalPosition:d.isPositionProportional})))},this.update=function(e){if(l){if(JSON.stringify(e)!==JSON.stringify(d)||d.isPositionProportional&&(d.screenWidth!==l.getViewer().SCREEN_WIDTH||d.screenHeight!==l.getViewer().SCREEN_HEIGHT)){var i=d.graphicProperties&&d.graphicProperties.fillStyle?JSON.stringify(d.graphicProperties.fillStyle):"",o=d.graphicProperties&&d.graphicProperties.lineStyle?JSON.stringify(d.graphicProperties.lineStyle):"";d=l.mergeParams(d,e),l.setName(d.name),d.screenWidth=l.getViewer().SCREEN_WIDTH,d.screenHeight=l.getViewer().SCREEN_HEIGHT,d.isPositionProportional?d.radiusPx=l.convertProportionalCoordInPixels(d.radius,!0):d.radiusPx=d.radius,p.removeChildren();var c,h=Math.round(2*Math.PI/Math.acos(1-1/d.radiusPx));if((isNaN(h)||h<0)&&(h=20),d.isFilled&&(a&&JSON.stringify(d.graphicProperties.fillStyle)===i||(a=n.createBasicMaterial({color:d.graphicProperties.fillStyle.color,opacity:d.graphicProperties.fillStyle.opacity})),(c=r.createCircleNode({radius:d.radiusPx,fill:!0,segments:h,startAngle:0,endAngle:2*Math.PI,material:a})).setShadow(!1),c.setPickParent(!0),p.addChild(c)),d.hasBorder){s&&JSON.stringify(d.graphicProperties.lineStyle)===o||(s=n.createLineMaterial({color:d.graphicProperties.lineStyle.color,opacity:d.graphicProperties.lineStyle.opacity,lineWidth:d.graphicProperties.lineStyle.thickness*window.devicePixelRatio,pattern:d.graphicProperties.lineStyle.pattern}));for(var u=[],g=0;g<=h;g++)u.push(new t.Vector3(d.radiusPx*Math.cos(Math.PI*g/(h/2)),d.radiusPx*Math.sin(Math.PI*g/(h/2)),0));(c=r.createLineNode({points:u,material:s})).setShadow(!1),c.setPickParent(!0),p.addChild(c)}l.setVisibility(d.isVisible)}l.updateScreenPosition()}},this.onViewerEventCB=function(e){l&&"onSwapVisibleSpace"===e.eventType&&d&&l.setVisibility(d.isVisible)}}})}),define("DS/DMUPlayMarker/DMUMarker2DPointNode3D",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/DMUBaseUI/DMUNode2D"],function(e,t,i){"use strict";return i.extend({init:function(i){this._parent(i);var r=this,n=new t;this.addChild(n),this.removeDMUNode3DOverload=function(){r=n=null},this.update=function(t){r&&(t.name&&r.setName(t.name),t.position&&n.setMatrix((new e.Matrix4).setPosition(r.get3DPositionFromScreenCoordinates({coords:t.position,windowAnchor:t.windowAnchor,proportionalPosition:t.isPositionProportional}))))}}})}),define("DS/DMUPlayMarker/DMUMarker3DPointNode3D",["require","exports","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/DMUBaseUI/DMUNode3D"],function(e,t,i,r,n){"use strict";return class extends n{constructor(e){super(e||{});let t=this,n=new r;this.addChild(n),n.setPickParent(!0),this.removeDMUNode3DOverload=function(){n=null},this.update=function(e){t&&(e&&e.name&&t.setName(e.name),e&&e.position&&n.setMatrix((new i.Matrix4).setPosition(e.position)))}}}}),define("DS/DMUPlayMarker/DMUMarker2DPolylineNode3D",["DS/Visualization/ThreeJS_DS","DS/DMUBaseUI/DMUNode2D","DS/DMUBaseExperience/EXPToolsMaterial","DS/Visualization/SceneGraphFactory","DS/SceneGraphNodes/BillBoardNode3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/SceneGraphNodes/ArrowNode"],function(e,t,i,r,n,o,a){"use strict";return t.extend({init:function(t){var s=t||{};this._parent(s);var l,d,c=this,p={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}},h=new n({type:"Spherical"});this.addChild(h),h.setPickParent(!0);var u=new o({ratio:1});function g(e,t,r){var n=p.graphicProperties.lineStyle.thickness;u.addChild(new a({arrowWidth:n,viewpoint:c.getViewer().currentViewpoint,arrowDashType:i.getDashType(p.graphicProperties.lineStyle.pattern),arrowScale:2,color:p.graphicProperties.lineStyle.color,head:1,headLength:r*Math.max(n,3),initialPoint:e.clone(),finalPoint:t.clone()}))}h.addChild(u),u.setPickParent(!0),this.removeDMUNode3DOverload=function(){c=u=l=null},this.updateScreenPosition=function(){p&&d&&c.setMatrix((new e.Matrix4).setPosition(c.get3DPositionFromScreenCoordinates({coords:d,width:p.fullWidthPx,anchor:"center",windowAnchor:p.windowAnchor,proportionalPosition:p.isPositionProportional})))},this.update=function(t){if(c){var n;if(JSON.stringify(t)!==JSON.stringify(p)||p.isPositionProportional&&(p.screenWidth!==c.getViewer().SCREEN_WIDTH||p.screenHeight!==c.getViewer().SCREEN_HEIGHT)){var o=p.graphicProperties&&p.graphicProperties.lineStyle?JSON.stringify(p.graphicProperties.lineStyle):"";p=c.mergeParams(p,t),c.setName(p.name),p.screenWidth=c.getViewer().SCREEN_WIDTH,p.screenHeight=c.getViewer().SCREEN_HEIGHT;var a,h=s.getPoints(!0),P=[];for(d=new e.Vector2,n=0;n<h.length;n++)(a=h[n].getAttribute("vPosition"))&&(P.push(a),d.x+=a.x,d.y+=a.y);P.length&&d.multiplyScalar(1/P.length),l&&JSON.stringify(p.graphicProperties.lineStyle)===o||(l=i.createLineMaterial({color:p.graphicProperties.lineStyle.color,opacity:p.graphicProperties.lineStyle.opacity,lineWidth:p.graphicProperties.lineStyle.thickness*window.devicePixelRatio,pattern:p.graphicProperties.lineStyle.pattern})),u.removeChildren();var f,y=[];if(P.length>1){var D=p.isPositionProportional?c.convertCoordsInPixels({coords:d,windowAnchor:p.windowAnchor,fitOnX:!0}):d.clone();for(n=0;n<P.length;n++)f=P[n].clone(),p.isPositionProportional&&(f=c.convertCoordsInPixels({coords:f,windowAnchor:p.windowAnchor,fitOnX:!0})),f.sub(D),y.push(new e.Vector3(f.x,-f.y,0));var S=1===h[0].getAttribute("iPointType"),m=1===h[h.length-1].getAttribute("iPointType");S&&g(y[1],y[0],h[0].getAttribute("iSize")),m&&g(y[y.length-2],y[y.length-1],h[h.length-1].getAttribute("iSize"));var M,b,v=new e.Matrix4;if(p.rotationAngle&&(v=v.multiply((new e.Matrix4).makeRotationAxis(new e.Vector3(0,0,1),p.rotationAngle))),y.forEach(function(e){e.applyMatrix4(v),void 0===M?(M=e.x,b=e.x):(M=Math.max(M,e.x),b=Math.min(e.x,b))}),p.fullWidthPx=M-b,S&&y.splice(0,1),m&&y.splice(y.length-1,1),y.length){var A=r.createLineNode({points:y,material:l});A.setShadow(!1),A.setPickParent(!0),u.addChild(A)}}c.setVisibility(p.isVisible)}c.updateScreenPosition()}},this.onViewerEventCB=function(e){c&&"onSwapVisibleSpace"===e.eventType&&p&&c.setVisibility(p.isVisible)}}})}),define("DS/DMUPlayMarker/DMUMarkerShapeGrid",["UWA/Class","UWA/Core","DS/DMUMarkerVisu/DMUMarkerVisuGrid","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUBaseUI/DMUToolsUsers"],function(e,t,i,r,n){"use strict";return e.extend({init:function(e){this._parent();var o,a=this;this.getMarkUpGrid=function(){return o||(o=new i),o},this.buildTextGrid=function(i,r){var n,o=1,s=1,l=e,d=l.getType();"DMUMarker3DText"===d||"DMUMarker2DText"===d||"DMUMarker3DHyperlink"===d||"DMUMarker2DHyperlink"===d?(l.getImageToDisplay&&l.getImageToDisplay()&&s++,n=l.getAttribute("sTextContents")):"DMUMarker3DPicture"!==d&&"DMUMarker2DPicture"!==d||(n=l.getPictureLabel())&&n.length&&n[0]&&n[0].length&&o++;var c=a.getMarkUpGrid().getMarkUpCell(o-1,s-1);if(c){var p=c.getCellText();if(p){var h,u=l.getPixelFontSize(),g=l.getAttribute("sFontStyle"),P=l.getAttribute("sFontName");if(i){l.getAttribute("sRelatedObjectId")&&(r-=32);var f=t.createElement("canvas").getContext("2d"),y=g?g+" ":"";y+=u+"px "+l.getAttribute("sFontName"),f.font=y;var D="";h=[];for(var S=0;S<n.length;S++){if((D=n[S])&&f.measureText(" "+D+" ").width*window.devicePixelRatio>r){for(var m=D.length-4,M=D;m>=2&&f.measureText(" "+M+" ").width*window.devicePixelRatio>r;)M=D.substring(0,m)+"...",m--;D=M}h.push(D)}}n&&p.setTextContent(n),h&&p.setTextToDisplay(h),p.setFontSize(u),p.setFontName(P),p.setFontStyle(g)}}},this.buildGrid=function(i){var o,s,l,d=a.getMarkUpGrid();if(d){var c,p,h=1,u=1,g=null,P=e,f=P.getAttribute("bProportionalPosition"),y=P.getNode().getProportionalFactor?P.getNode().getProportionalFactor(!0):1;if(P){var D=P.getType();if("DMUMarker3DText"===D||"DMUMarker2DText"===D||"DMUMarker3DHyperlink"===D||"DMUMarker2DHyperlink"===D){if((g=P.getImageToDisplay?P.getImageToDisplay():null)&&u++,d.setNbofRows(h),d.setNbofColumns(u),g&&(c=d.getMarkUpCell(0,0))){let e=t.createElement("img");c.setCellImage(e),"string"==typeof g&&0!==g.indexOf("data:")?n.getImage(g,function(t,i){i||(e.src=t)}):e.src=g,o=P.getAttribute("fImageWidth"),s=P.getAttribute("fImageHeight"),o&&s?P.getAttribute("vLeaderBreakPoint3D")?(o=r.convertModelToPixels({sizeInMM:o,viewer:P._viewer})*window.devicePixelRatio,s=r.convertModelToPixels({sizeInMM:s,viewer:P._viewer})*window.devicePixelRatio):f&&(o*=y,s*=y):(o=40,s=40),c.setCellWd(o),c.setCellHt(s)}a.buildTextGrid()}else if("DMUMarker3DPicture"===D||"DMUMarker2DPicture"===D){g=P.getImageToDisplay();var S=P.getPictureLabel();S&&S.length&&S[0]&&S[0].length&&h++;var m=0;d.setNbofRows(h),d.setNbofColumns(u),g&&(c=d.getMarkUpCell(0,0))&&(g=t.createElement("img",{src:g}),c.setCellImage(g),m=P.getAttribute("fImageWidth"),s=P.getAttribute("fImageHeight"),m&&s?P.getAttribute("vLeaderBreakPoint3D")?(m=r.convertModelToPixels({sizeInMM:m,viewer:P._viewer})*window.devicePixelRatio,s=r.convertModelToPixels({sizeInMM:s,viewer:P._viewer})*window.devicePixelRatio):f&&(m*=y,s*=y):(m=g.naturalWidth,s=g.naturalHeight),m||(m=300),s||(s=300),c.setCellWd(m),c.setCellHt(s)),a.buildTextGrid(2===h,m)}else if("DMUMarker3DStamp"===D){d.setNbofRowsAndColumns(3,2),g=t.createElement("img"),n.getImage(n.getUserImageURL(n.getUserLogin()),function(e,t){t||(g.src=e)}),(c=d.getMarkUpCell(0,0))&&(c.setCellImage(g),c.setCellWd(30*window.devicePixelRatio),c.setCellHt(30*window.devicePixelRatio));var M=P.getPixelFontSize(),b=d.getMarkUpCell(0,1);b&&(l=b.getCellText())&&(l.setTextContent(i),l.setFontSize(M),l.setFontName("sans-serif"),l.setFontStyle("normal"));var v=d.getMarkUpCell(1,1);v&&(l=v.getCellText())&&(l.setTextContent(P.getAttribute("sTextContents")),l.setFontSize(M),l.setFontName("sans-serif"),l.setFontStyle("bold"));var A=d.getMarkUpCell(2,1);A&&(l=A.getCellText())&&(l.setTextContent(P.getAttribute("lTextComment")),l.setFontSize(M),l.setFontName(P.getAttribute("sFontName")),l.setFontStyle(P.getAttribute("sFontStyle"))),p=[{row:0,column:1}]}}d.updateGrid(p)}}}})}),define("DS/DMUPlayMarker/DMUMarkerServices",["DS/WAFData/WAFData","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/WebappsUtils/WebappsUtils","i18n!DS/DMUPlayMarker/assets/nls/DMUPlayMarker"],function(e,t,i,r,n){"use strict";return{getDataFromRelatedId:function(o){if(o.onComplete)switch(o.type){case"DMUMarker3DPicture":!function(r,n,o){var a=i.getSetting("pad_security_ctx"),s=t.get3DSpaceUrl()+"/cvservlet/fetch/v2?SecurityContext="+a+"&tenant="+t.getPlatformId(),l=n.predicates||[],d=n.files||[];if(l.length||d.length){var c={physicalid:[r],label:"DMUFetchForMarkerVisualization-"+t.getRequestLabel(),select_predicate:l,select_file:d};e.authenticatedRequest(s,{data:JSON.stringify(c),method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":i.getSetting("lang"),SecurityContext:a},timeout:6e4,onComplete:function(e){var t=e?JSON.parse(e):null,i=l.concat(d),r=(t&&t.results&&t.results[0]&&t.results[0].attributes?t.results[0].attributes:[]).filter(function(e){return i.indexOf(e.name)>=0});o(r)},onFailure:function(){o([])},onTimeout:function(){o([])}})}}(o.objectId,{predicates:["ds6w:label","ds6w:type"],files:["thumbnail_2d","preview_url","icon","type_icon_url"]},function(a){if(a){var s=a.find(function(e){return"ds6w:type"===e.name}),l=a.find(function(e){return"ds6w:label"===e.name}),d=0,c={label:l&&l.dispValue?l.dispValue:n.defaultSymbolLabel};c.draggableContent=JSON.stringify({protocol:"3DXContent",version:"1.1",data:{items:[{envId:t.getPlatformId(),serviceId:"3DSpace",contextId:i.getSetting("pad_security_ctx")?i.getSetting("pad_security_ctx"):void 0,objectId:o.objectId,objectType:s.value,displayType:s.dispValue,displayName:l.dispValue}]},source:window.widget&&window.widget.getValue("appId")?window.widget.getValue("appId"):"ENOR3D_AP",widgetId:window.widget?window.widget.id:void 0});var p=a.find(function(e){return"preview_url"===e.name});p&&p.value||(p={value:r.getWebappsAssetUrl("DMUPlayMarker","images")+"/Default_Symbol_Preview.png"}),d++;e.authenticatedRequest(p.value,{proxy:"none",type:"blob",timeout:18e4,onComplete:function(e){var t=new FileReader;t.onload=function(){var e=new Image;e.src=t.result,e.onload=function(){d--,c.image=e,0===d&&o.onComplete(c)}},t.readAsDataURL(e)},onFailure:function(){0===--d&&o.onComplete(c)},onTimeout:function(){0===--d&&o.onComplete(c)}});var h=a.find(function(e){return"type_icon_url"===e.name});if(h&&h.value){d++;e.authenticatedRequest(h.value,{proxy:"none",type:"blob",timeout:18e4,onComplete:function(e){var t=new FileReader;t.onload=function(){var e=new Image;e.src=t.result,e.onload=function(){d--,c.icon=e,0===d&&o.onComplete(c)}},t.readAsDataURL(e)},onFailure:function(){0===--d&&o.onComplete(c)},onTimeout:function(){0===--d&&o.onComplete(c)}})}}else o.onComplete()})}}}}),define("DS/DMUPlayMarker/DMUMarkerImport",["UWA/Class","DS/DMUPlayMarker/DMUMarkerServices"],function(e,t){"use strict";return e.extend({init:function(e){this.importData=function(t,i,r){t&&i&&e&&(i.fillObjectAttributes(e,t,r),i.registerForPostImport(e))},this.afterImport=function(){if(e){for(var i=e;i&&"DMUMarkup"!==i.getType();)i=i.getParent();if(e.getAttribute("sRelatedObjectId"))t.getDataFromRelatedId({type:e.getType(),objectId:e.getAttribute("sRelatedObjectId"),onComplete:function(t){t&&(e.setRelatedObjectData(t),e.fireEvent("onDMUObjectInitialized",{dmuObject:e,dmuCont:i}))}});else{if(e.getDMUComments){let t=e.getDMUComments();t&&t.forEach(t=>{t.importDeprecatedReplies(e)})}e.fireEvent("onDMUObjectInitialized",{dmuObject:e,dmuCont:i})}}}}})}),define("DS/DMUPlayMarker/DMUMarker3DPoint",["require","exports","DS/DMUPlayMarker/DMUMarkerImport","DS/DMUBaseExperience/DMUOverloadableObject","DS/DMUPlayMarker/DMUMarker3DPointNode3D"],function(e,t,i,r,n){"use strict";let o=[{name:"iPointType",type:"int",JSONname:"PointType",defaultValue:0},{name:"iSize",type:"float",JSONname:"Size",defaultValue:1},{name:"vPosition",type:"Vector3",JSONname:"Point3D"},{name:"vRelativePosition",type:"Vector3",JSONname:"Point3DRelativePosition"}];return class extends r{constructor(e,t){super(e,t),this.addParameters(o),this.setAttribute("sType","Marker3DPoint");let r=this,a=new i(r);this.importData=a.importData,this.afterImport=a.afterImport,this.setNode(new n({frmWindow:this._frmWindow,getType:this.getType}));let s=this.refreshNode;this.refreshNode=function(){r.getNode()&&!t.getParent().isImporting()&&(r.getNode().update({name:r.getAttribute("sName"),pointType:r.getAttribute("iPointType"),size:r.getAttribute("iSize"),position:r.getAttribute("vRelativePosition")||r.getAttribute("vPosition")}),s())},this._parentGetAttribute=this.getAttribute,this.getAttribute=function(e){return"vPosition"===e?r._parentGetAttribute(e).clone():r._parentGetAttribute(e)}}}}),define("DS/DMUPlayMarker/DMUMarker3DTextNode3D",["DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/DMUBaseUI/DMUToolsLeader","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUBaseUI/DMUManipulableNode3D","DS/DMUMarkerVisu/DMUMarkerVisuTextShapeNode","DS/DMUPlayMarker/DMUMarkerTools"],function(e,t,i,r,n,o,a,s){"use strict";return o.extend({init:function(o){var l=o||{};this._parent(l),this._getExcludeFromCSO=function(){return!0};var d,c=this,p=c.getViewer(),h=1;let u,g=!1,P=!1;var f={horizontalAlignement:"topLeft"};if(l.defaultGraphicProps)for(var y=Object.keys(l.defaultGraphicProps),D=0;D<y.length;D++)f[y[D]]=l.defaultGraphicProps[y[D]];var S=new a({window:l.frmWindow,data:{mkvShape:l.mkvShape,graphicProperties:f},onStartContentEditionCB:l.onStartContentEditionCB,onEndContentEditionCB:l.onEndContentEditionCB,onContentModifiedCB:l.onContentModifiedCB});this.addChild(S),S.setPickParent(!0);var m=new e;function M(){if(m&&d){let e=!g&&!P&&d.hasALeader;m.setVisibility(e),m.setVisibilityFree(!e)}}function b(o,a,c){if(M(),d.hasALeader){var h=0;switch(d.leaderEndType){case"Arrow":h=1;break;case"Bubble":h=2;break;case"Cross":h=4;break;case"Square":h=3}var u=S.getDimensions();if(u.offsetWidth>0&&u.offsetHeight>0){var g,P,f=o.clone(),y={offsetWidth:r.convertModelToPixels({sizeInMM:u.offsetWidth,viewer:p,coords:d.zoomMode?f:null}),offsetHeight:r.convertModelToPixels({sizeInMM:u.offsetHeight,viewer:p,coords:d.zoomMode?f:null}),rotationAngle:c};if(y.offsetWidth/=window.devicePixelRatio,y.offsetHeight/=window.devicePixelRatio,"topleft"===d.anchorMode)if(d.zoomMode){var D=p.currentViewpoint.getUpDirection().clone(),b=(new t.Vector3).crossVectors(p.currentViewpoint.getSightDirection(),D).setLength(u.offsetWidth/2);D.setLength(-u.offsetHeight/2),f.add(D),f.add(b)}else{var v=r.getViewerPositionFromPoint(p,f);if(v&&!isNaN(v.left)&&!isNaN(v.top)&&v.right-v.left!=0){var A=new t.Vector2(v.left+y.offsetWidth/2,v.top+y.offsetHeight/2),x=r.getLineFromWindowPosition(p,A.x,A.y),w=r.getViewpointInfo(p.currentViewpoint),k=n.computeLinePlaneDistance(x.position.toArray(),x.direction.toArray(),o.toArray(),w.sight.toArray());f=new t.Vector3(k.aPosition[0],k.aPosition[1],k.aPosition[2])}}if(a&&a.length){var N=[];if(1===p.getVisibleSpace()&&d.pointedReferences&&d.pointedReferences.length){var U=s.getPointedReferencesVisibilityStates(p,d.pointedReferences);for(P=U.length-1;P>=0;P--)U[P]&&a[P]&&N.push(a[P])}else N=a.slice();var C=m.getChildren();for(P=0;P<N.length;P++){(g=C[P])||((g=new e("DMUMarkerLeaderNode")).setPickParent(!0),m.addChild(g));let t={width:d.leaderAttachWidthRatio,height:d.leaderAttachLengthRatio},r=i.modifyLeaderNode(p,g,!0,f,N[P],t,d.graphicProperties.leaderStyle.thickness*window.devicePixelRatio,d.graphicProperties.leaderStyle.color,d.graphicProperties.leaderStyle.pattern,h,y,l.frmWindow);g.setVisibility(r)}if(C=m.getChildren(),N.length<C.length)for(P=C.length-1;P>=N.length;P--)C[P].isManipulator||m.removeChild(C[P])}}}}this.addChild(m),m.setPickParent(!0),this.linkManipulatorToNode(S.getBackNode()),this.getRepNode=function(){return{leader:m,box:S.getLabelNode()}},this.hasTessellatedRepresentation=function(){return d&&d.tessRep&&d.tessRep.length},this.getLabelDimensions=function(){var e=S.getDimensions();return e.position=d.position,e},this.updateRepresentation=function(e,i){S.setTransformation({rotationAngle:e.rotationAngle}),S.setMatrix((new t.Matrix4).setPosition(e.position)),b(e.position,e.leaderPoints,e.rotationAngle),S.setGhostMode(i)},this.getLabelParams=function(){var e=S.getDimensions(),t={};return t.leaderPoints=d.pointingPoints.slice(),t.position=d.position,t.anchorMode=d.anchorMode,t.rotationAngle=d.boxRotationAngle?d.boxRotationAngle:0,t.width=e.width,t.height=e.height,t};var v=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){v(),u&&clearTimeout(u),u=null,S&&S.remove(),S=m=c=d=null},this.getPixelFontSize=function(e){var t,i=e||d;return i.graphicProperties.fontStyle.pxheight&&(t=r.convertPixelToModel({sizeInPixels:i.graphicProperties.fontStyle.pxheight,viewer:c.getViewer()})),t||(t=i.graphicProperties.fontStyle.fontSize),r.convertModelToPixels({sizeInMM:t,viewer:c.getViewer()})},this.startEdition=function(){S.startEdition(c)},this._updateVisibility=function(e,t){if(!d)return;void 0!==e&&(h=e);let i=d.pointedReferences;i&&i.length!==d.pointingPoints.length&&(i=d.pointedReferences.slice(0,d.pointingPoints.length));var r=d.isVisible&&s.is3DMarkerDisplayed(p,i)&&h>0;c.setVisibility(r),0!==h&&S.setOpacity(h),(0===p.getVisibleSpace()&&!r||1===p.getVisibleSpace()&&r)&&(t&&h<1?(g=!0,M()):(g=!1,b(d.position,d.pointingPoints,d.boxRotationAngle))),p.render()},this.update=function(e){if(c){d||(d={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}}),e.graphicProperties.fontStyle.height=c.getPixelFontSize(e),e.devicePixelRatio=window.devicePixelRatio,e.markerImage&&!function(e){if(e.content&&e.content.length)for(var t=0;t<e.content.length;t++)if(e.content[t].length)return!0;return!1}(e)&&(e.graphicProperties.padding=0);var t=[],i={paramA:d,paramB:e,merge:!0,mergedKeys:t};if(!s.compareAndMergeParams(i)){var r=c.getRepManipulator();r&&r.deactivate(),c.setName(d.name),S.modify(d),t.includes("content")||S.stopEdition(),r&&r.activate(),c._updateVisibility()}}};let A=function(){c&&c._updateVisibility(),u=null};this.onViewerEventCB=function(e){c&&e&&("onDMUSlideStartDisplay"!==e.eventType&&"onDMUSlideDisplayed"!==e.eventType||(P="onDMUSlideStartDisplay"===e.eventType,M()),d&&S&&("@onViewpointBeginMove"!==e.eventType&&"@onViewpointEndMove"!==e.eventType&&S.stopEdition(),("@onWindowResized"===e.eventType||"onSwapVisibleSpace"===e.eventType||d.pointedReferences&&("onHideShow"===e.eventType||"onRepresentationLoaded"===e.eventType))&&("@onWindowResized"===e.eventType||"onHideShow"===e.eventType||"onRepresentationLoaded"===e.eventType?u||(u=setTimeout(A)):c._updateVisibility())))}}})}),define("DS/DMUPlayMarker/DMUCommentableObject",["DS/DMUBaseExperience/DMUOverloadableObject","DS/DMUBaseUIControllers/DMUMarkupsController","DS/DMUPlayMarker/DMUMarkerImport","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPManagerSet","DS/Selection/CSOManager"],function(e,t,i,r,n,o){"use strict";var a=[{name:"fPointedPageNumber",type:"float",JSONname:"PropertiesCommentableObject.PointedPageNumber"},{name:"sPointedElementID",type:"string",JSONname:"PropertiesCommentableObject.PointedElementID"},{name:"lComments",type:"listObjects",JSONname:"PropertiesCommentableObject.Comments"},{name:"bMarkedAsDeleted",type:"boolean",JSONname:"PropertiesCommentableObject.MarkedAsDeleted"}];return e.extend({init:function(e,s){this._parent(e,s),this.addParameters(a);var l,d,c=this,p=!1;this.initContextualBar=function(e){e&&(d=e),d&&!c.getContextualCommandList&&-1!==r.getAuthoringFeatureTypes().indexOf("Marker")&&require([d],function(e){var t=new e;c.getContextualCommandList=t.getContextualCommandList,c.getSharedContextualCommandList=t.getSharedContextualCommandList,c.getSharedHeaderTypes=t.getSharedHeaderTypes,c.getSharedContextualMenuCommandList=t.getSharedContextualMenuCommandList,c.getContextualMenuCommandList=t.getContextualMenuCommandList,t.applyStateToContextHdr&&(c.applyStateToContextHdr=t.applyStateToContextHdr),t.setCheckCmdHdrState&&(c.setCheckCmdHdrState=t.setCheckCmdHdrState),t.register({frmWindow:c._frmWindow});var i=1===o.get().length?o.get()[0].pathElement.clone():null;i&&i.getLastElement(!0).getDMUType&&i.getLastElement(!0)===c.getNode()&&(o.empty(),o.add({pathElement:i}))})},this.initAuthoringData=function(){c.initContextualBar()},this.removeAuthoringData=function(){d&&-1!==r.getAuthoringFeatureTypes().indexOf("Marker")&&require([d],function(e){var t=new e;c.getContextualCommandList=null,c.getSharedContextualCommandList=null,c.getSharedHeaderTypes=null,c.getSharedContextualMenuCommandList=null,c.getContextualMenuCommandList=null,c.applyStateToContextHdr=null,c.setCheckCmdHdrState=t.setCheckCmdHdrState,t.unregister({frmWindow:c._frmWindow})})};var h=new i(c);this.importData=h.importData,this.afterImport=h.afterImport,this.initAuthoringData();var u=t.getDMUMarkupsController({context:this._viewer,frmWindow:this._frmWindow});u&&u.registerMarker(this),this.addDMUComment=function(e,t){if(e&&e.getType&&"DMUComment"===e.getType()){var i=c.getAttribute("lComments")||[];"number"==typeof t?i.splice(t,0,e):i.push(e),c.setAttribute("lComments",i),e.getNode&&c.getNode().addChild(e.getNode()),c.fireEvent("onDMUObjectAddedInObject",{dmuObject:e,parentObject:c})}},this.getDMUComments=function(){return c.getAttribute("lComments")||[]},this.removeDMUComment=function(e){if(e&&e.getType&&"DMUComment"===e.getType()){var t=c.getAttribute("lComments");if(t&&t.length){var i=t.findIndex(function(t){return t.getAttribute("sUuid")===e.getAttribute("sUuid")});i>=0&&(t[i].getNode()&&c.getNode().removeChild(t[i].getNode()),t.splice(i,1),c.setAttribute("lComments",t),e.remove(),c.fireEvent("onDMUObjectRemovedFromObject",{dmuObject:e,parentObject:c}))}}},this.updatePointedElement=function(e){var t=n.getManager({name:"DMU2DSheetManager",context:c._frmWindow});if(t){var i=t.getPointedElemIDAtPosition(e);"number"==typeof i?i!==c.getAttribute("fPointedPageNumber")&&c.setAttribute("fPointedPageNumber",i):i&&i!==c.getAttribute("sPointedElementID")&&c.setAttribute("sPointedElementID",i)}},this.getPointedPosition=function(){if(l)return l.clone()},this.updatePointedPosition=function(e){l=e.clone()};var g=this.setInEdition;this.setInEdition=function(e){var t=c.getAttribute("lComments");t&&t.length&&t.forEach(function(t){t.setInEdition(e)}),g(e)};var P=this.refreshNode;this.refreshNode=function(){var e=c.getAttribute("lComments");e&&e.length&&e.forEach(function(e){e.setAlertFlag(p),e.refreshNode()}),P()};var f=this.setReadOnly;this.setReadOnly=function(e,t){e=e||c.getAttribute("bMarkedAsDeleted");for(var i=c.getDMUComments(),r=0;r<i.length;r++)i[r].setReadOnly(e,t);f(e,t)},this.hasAlertFlag=function(){return p},this.setAlertFlag=function(e){p=e};let y=this.setAttribute.bind(this);this.setAttribute=function(e,t){"bMarkedAsDeleted"===e&&c.setReadOnly(c.isReadOnly()||t),y(e,t)}},remove:function(){var e=t.giveDMUMarkupsController({context:this._viewer});e&&e.unregisterMarker(this),t.unreferenceDMUMarkupsController({context:this._viewer}),this._parent()}})}),define("DS/DMUPlayMarker/DMUMarker2DTextNode3D",["UWA/Core","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/DMUBaseUI/DMUToolsLeader","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUBaseUI/DMUNode2D","DS/DMUMarkerVisu/DMUMarkerVisuTextShapeNode","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUPlayMarker/DMUMarkerTools"],function(e,t,i,r,n,o,a,s,l){"use strict";return o.extend({init:function(o){var d=o||{};this._parent(d),this._getExcludeFromCSO=function(){return!0};var c=this,p={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}},h={},u={horizontalAlignement:"topLeft"};if(d.defaultGraphicProps)for(var g=Object.keys(d.defaultGraphicProps),P=0;P<g.length;P++)u[g[P]]=d.defaultGraphicProps[g[P]];var f=new a({window:d.frmWindow,data:{mkvShape:d.mkvShape,graphicProperties:u},onStartContentEditionCB:d.onStartContentEditionCB,onEndContentEditionCB:d.onEndContentEditionCB,onContentModifiedCB:d.onContentModifiedCB});this.addChild(f),f.setPickParent(!0);var y=new t;function D(e,o,a){if(!p.hasALeader)return y.setVisibility(!1),void y.setVisibilityFree(!0);if(y.setVisibility(!0),y.setVisibilityFree(!1),0===c.getViewer().getVisibleSpace()&&!1===p.isVisible||1===c.getViewer().getVisibleSpace()&&!0===p.isVisible){var l=0;switch(p.leaderEndType){case"Arrow":l=1;break;case"Bubble":l=2;break;case"Cross":l=4;break;case"Square":l=3}var h=f.getDimensions();if(h.offsetWidth>0&&h.offsetHeight>0){var u=e.clone(),g={offsetWidth:n.convertModelToPixels({sizeInMM:h.offsetWidth,viewer:c.getViewer()}),offsetHeight:n.convertModelToPixels({sizeInMM:h.offsetHeight,viewer:c.getViewer()}),rotationAngle:a};if(g.offsetWidth/=window.devicePixelRatio,g.offsetHeight/=window.devicePixelRatio,"topleft"===p.anchorMode){var P=n.getViewerPositionFromPoint(c.getViewer(),u);if(!isNaN(P.left)&&!isNaN(P.top)){var D=new i.Vector2(P.left+g.offsetWidth/2,P.top+g.offsetHeight/2),S=n.getLineFromWindowPosition(c.getViewer(),D.x,D.y),m=n.getViewpointInfo(c.getViewer().currentViewpoint),M=s.computeLinePlaneDistance(S.position.toArray(),S.direction.toArray(),e.toArray(),m.sight.toArray());u=new i.Vector3(M.aPosition[0],M.aPosition[1],M.aPosition[2])}}var b,v,A=o;if(void 0!==A&&A.length){var x=y.getChildren().filter(function(e){return!e.isManipulator});if(A.length<x.length)for(var w=x.length-1;w>=A.length;w--)y.removeChild(x[w]);for(var k=0;k<A.length;k++){v=c.get3DPositionFromScreenCoordinates({coords:A[k],windowAnchor:p.windowAnchor,proportionalPosition:p.isPositionProportional}),(b=x[k])||((b=new t("DMUMarkerLeaderNode")).setPickParent(!0),y.addChild(b));let e={width:p.leaderAttachWidthRatio,height:p.leaderAttachLengthRatio},i=r.modifyLeaderNode(c.getViewer(),b,!0,u,v,e,p.graphicProperties.leaderStyle.thickness*window.devicePixelRatio,p.graphicProperties.leaderStyle.color,p.graphicProperties.leaderStyle.pattern,l,g,d.frmWindow);b.setVisibility(i)}}}}}this.addChild(y),y.setPickParent(!0),this.linkManipulatorToNode(f.getBackNode()),this.getRepNode=function(){return{leader:y,box:f.getLabelNode()}},this.startEdition=function(){f.startEdition(c)},this.getLabelDimensions=function(){var e=f.getDimensions();return e.position=p.position,e},this.updateRepresentation=function(e,t){f.setTransformation({rotationAngle:e.rotationAngle}),f.setMatrix((new i.Matrix4).setPosition(e.position));var r=e.leaderPoints.map(function(e){var t=n.getViewerPositionFromPoint(c.getViewer(),e);return new i.Vector2(t.left,t.top)});D(e.position,r,e.rotationAngle),f.setGhostMode(t)},this.getLabelParams=function(){var e=f.getDimensions();return{leaderPoints:p.pointingPoints.map(function(e){return c.get3DPositionFromScreenCoordinates({coords:e,windowAnchor:p.windowAnchor,proportionalPosition:p.isPositionProportional})}),anchorMode:p.anchorMode,position:p.position,rotationAngle:p.boxRotationAngle?p.boxRotationAngle:0,width:e.width,height:e.height}};var S=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){S(),f&&f.remove(),f=c=y=p=null};var m=e.createElement("canvas");m.width=1e3,m.height=300,this.getPixelFontSize=function(e){var t,i=e||p,r=c.getViewer().SCREEN_WIDTH,o=c.getViewer().SCREEN_HEIGHT;if(i.graphicProperties.fontStyle.pxheight&&(t=n.convertPixelToModel({sizeInPixels:i.graphicProperties.fontStyle.pxheight,viewer:c.getViewer()})),t||(t=i.graphicProperties.fontStyle.fontSize),!(i.tessRep&&i.tessRep.length||h.viewerWidth===r&&h.viewerHeight===o&&h.fontSize&&h.modelSize===t)&&(h.modelSize=t,h.viewerWidth=r,h.viewerHeight=o,h.fontSize=n.convertModelToPixels({sizeInMM:t,viewer:c.getViewer()}),i.isPositionProportional)){var a=c.convertPixelsInProportionalCoord(10),s=(i.boxHeight-a)/i.content.length;h.fontSize=Math.max(c.convertProportionalCoordInPixels(s,!0),1),i.boxWidth&&(h.fontSize=Math.max(function(e,t){for(var i=t,r=e.content,n=c.convertProportionalCoordInPixels(e.boxWidth,!0),o=m.getContext("2d"),a=0;10!==a;){o.clearRect(0,0,m.width,m.height);var s=e.graphicProperties.fontStyle.familyStyle||"",l=s?s+" ":"",d=e.graphicProperties.fontStyle.familyName||"sans-serif";l+=i*window.devicePixelRatio+"px ",l+=d,d.split(" ").length>1&&(d='"'+d+'"'),o.font=l;for(var p=0,h="",u=0;u<r.length;++u)h=r[u]?r[u]:"aA_{}",o.clearRect(0,0,m.width,m.height),o.fillText(h,0,m.height),p=Math.max(p,o.measureText(h).width);if(p<n)break;a++,i*=.98}return i}(i,h.fontSize),1))}return h.fontSize},this.updateScreenPosition=function(){if(p&&p.breakPoint2D){var e=f.getDimensions();p.position=c.get3DPositionFromScreenCoordinates({coords:p.breakPoint2D.clone(),width:e.width,anchor:p.anchorMode,windowAnchor:p.windowAnchor,proportionalPosition:p.isPositionProportional}),D(p.position,p.pointingPoints,p.boxRotationAngle),f.updatePosition(p)}},this.update=function(e){if(!c)return;p||(p={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}}),e.graphicProperties.fontStyle.height=c.getPixelFontSize(e),e.devicePixelRatio=window.devicePixelRatio,e.markerImage&&!function(e){if(e.content&&e.content.length)for(var t=0;t<e.content.length;t++)if(e.content[t].length)return!0;return!1}(e)&&(e.graphicProperties.padding=0);var t=[];let i=p.position;p.position=void 0;var r={paramA:p,paramB:e,merge:!0,mergedKeys:t};if(l.compareAndMergeParams(r))p.position=i;else{var n=c.getRepManipulator();n&&n.deactivate(),c.setName(p.name),p.isPositionProportional&&(p.imageWidth=c.convertProportionalCoordInPixels(p.imageWidth,!0),p.imageHeight=c.convertProportionalCoordInPixels(p.imageHeight,!0),p.boxWidth=c.convertProportionalCoordInPixels(p.boxWidth,!0),p.boxHeight=c.convertProportionalCoordInPixels(p.boxHeight,!0)),f.modify(p),c.updateScreenPosition(),t.includes("content")||f.stopEdition(),n&&n.activate(),c.setVisibility(p.isVisible)}c.getViewer().render()},this.onViewerEventCB=function(e){c&&("@onViewpointChange"!==e.eventType&&"onSwapVisibleSpace"!==e.eventType||(f.stopEdition(),"onSwapVisibleSpace"===e.eventType&&p&&(c.setVisibility(p.isVisible),D(p.position,p.pointingPoints,p.boxRotationAngle))))}}})}),define("DS/DMUPlayMarker/DMUMarker",["DS/DMUPlayMarker/DMUCommentableObject","DS/Visualization/ThreeJS_DS","DS/DMUBaseExperience/EXPUtils"],function(e,t,i){"use strict";var r=[{name:"cFillStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.FillStyle.color",defaultValue:new t.Color("#ffffff")},{name:"cLineStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.color",defaultValue:new t.Color("#000000")},{name:"sLineStylePattern",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.pattern",defaultValue:"1"},{name:"fLineStyleThicknessIndex",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.thicknessIndex"},{name:"fLineStyleThickness",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.thickness",defaultValue:1},{name:"fLineStyleOpacity",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.opacity",defaultValue:1},{name:"bVisible",type:"bool",JSONname:"PropertiesMarkerBase.GraphicProperties.visible",defaultValue:!0},{name:"bIsFilled",type:"bool",JSONname:"PropertiesMarkerBase.filled",defaultValue:!0},{name:"bHasBorder",type:"bool",JSONname:"PropertiesMarkerBase.border",defaultValue:!1},{name:"fOpacity",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.FillStyle.opacity",defaultValue:1},{name:"oGradient",type:"objectDefinition",JSONname:"PropertiesMarkerBase.GraphicProperties.FillStyle.gradient"},{name:"fRotationAngle",type:"float",JSONname:"PropertiesMarkerBase.RotationAngle"}];return e.extend({init:function(e,t){this._parent(e,t),this.addParameters(r)},onViewerEventCB:function(e){this.getNode()&&this.getNode().onViewerEventCB&&this.getNode().onViewerEventCB(e)},_checkUnderCertainCommand:function(){return i.checkIfCommandIsRunning(this._viewer)||this.isReadOnly()},setAttribute:function(e,t){"fLineStyleThicknessIndex"===e&&this._parent("fLineStyleThickness",null),this._parent(e,t)}})}),define("DS/DMUPlayMarker/DMUMarker3D",["DS/DMUPlayMarker/DMUMarker"],function(e){"use strict";return e.extend({init:function(e,t){this._parent(e,t),this.addParameters([{name:"lPointedReferences",type:"listStrings",JSONname:"Properties3DMarker.PointedReferences"}]);var i=this;this.getPointedReferences=function(){return i.getAttribute("lPointedReferences")},this.getPointedReference=function(e){let t=i.getAttribute("lPointedReferences");if(t)return t[e]}}})}),define("DS/DMUPlayMarker/DMUMarker2D",["DS/DMUPlayMarker/DMUMarker"],function(e){"use strict";var t=[{name:"sWindowAnchor",type:"String",JSONname:"PropertiesMarker2D.windowAnchor",defaultValue:"topLeft"},{name:"bProportionalPosition",type:"bool",JSONname:"PropertiesMarker2D.proportionalPosition"},{name:"fScreenRotationAngle",type:"float",JSONname:"PropertiesMarker2D.RotationAngle"}];return e.extend({init:function(e,i){this._parent(e,i),this.addParameters(t);var r=this;this.setMaximalProportionalZoneWidth=function(e){r.getNode()&&r.getNode().setMaximalProportionalZoneWidth(e)}}})}),define("DS/DMUPlayMarker/DMUMarker2DCircle",["DS/DMUPlayMarker/DMUMarker2D","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker2DCircleNode3D","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r){"use strict";var n=[{name:"vCenter",type:"Vector2",JSONname:"Properties2DCircle.Center",defaultValue:new t.Vector2},{name:"fRadius",type:"float",JSONname:"Properties2DCircle.Radius",defaultValue:100}];return e.extend({init:function(e,t){this._parent(e,t),this.addParameters(n),this.setAttribute("sType","Marker2DCircle");var o=this;this.setNode(new i({frmWindow:this._frmWindow,getType:this.getType})),this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar");var a=this.refreshNode;this.refreshNode=function(){o.getNode()&&!t.isImporting()&&(o.getNode().update({name:o.getAttribute("sName"),radius:o.getAttribute("fRadius"),center:o.getAttribute("vCenter"),windowAnchor:o.getAttribute("sWindowAnchor"),inEdition:o.isInEdition(),isVisible:o.getAttribute("bVisible"),isFilled:o.getAttribute("bIsFilled"),hasBorder:o.getAttribute("bHasBorder"),isPositionProportional:o.getAttribute("bProportionalPosition"),graphicProperties:{fillStyle:{color:o.getAttribute("cFillStyleColor"),opacity:o.getAttribute("fOpacity")},lineStyle:{pattern:o.getAttribute("sLineStylePattern"),thickness:r.getLineThickness(o.getAttribute("fLineStyleThicknessIndex"))||o.getAttribute("fLineStyleThickness"),color:o.getAttribute("cLineStyleColor"),opacity:o.getAttribute("fLineStyleOpacity")}}}),a())},this.getMaximumProportionalWidth=function(){var e=0;if(o.getAttribute("bProportionalPosition")){var t=o.getAttribute("vCenter"),i=o.getAttribute("fRadius");t&&i&&Math.abs(t.x)+i>e&&(e=Math.abs(t.x)+i)}return e}},setAttribute:function(e,t){!1!==t||"bHasBorder"!==e||this.getAttribute("bIsFilled")?!1!==t||"bIsFilled"!==e||this.getAttribute("bHasBorder")?"fRadius"===e?t>0&&this._parent(e,t):this._parent(e,t):(this.setAttribute("bHasBorder",!0),this._parent(e,t)):(this.setAttribute("bIsFilled",!0),this._parent(e,t))},getAttribute:function(e){return"vCenter"===e?this._parent("vCenter").clone():this._parent(e)}})}),define("DS/DMUPlayMarker/DMUMarker2DRectangle",["DS/DMUPlayMarker/DMUMarker2D","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker2DRectangleNode3D","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r){"use strict";var n=[{name:"fWidth",type:"float",JSONname:"Properties2DRectangle.width",defaultValue:10},{name:"fHeight",type:"float",JSONname:"Properties2DRectangle.height",defaultValue:10},{name:"vPosition",type:"Vector2",JSONname:"Properties2DRectangle.position",defaultValue:new t.Vector2},{name:"sAnchor",type:"string",JSONname:"Properties2DRectangle.anchor",defaultValue:"center"}];return e.extend({init:function(e,t){this._parent(e,t),this.addParameters(n),this.setAttribute("sType","Marker2DRectangle");var o=this;this.setNode(new i({frmWindow:this._frmWindow,getType:this.getType})),this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar");var a=this.refreshNode;this.refreshNode=function(){o.getNode()&&!t.isImporting()&&(o.getNode().update({name:o.getAttribute("sName"),position:o.getAttribute("vPosition"),width:o.getAttribute("fWidth"),height:o.getAttribute("fHeight"),anchor:o.getAttribute("sAnchor"),windowAnchor:o.getAttribute("sWindowAnchor"),inEdition:o.isInEdition(),isVisible:o.getAttribute("bVisible"),isFilled:o.getAttribute("bIsFilled"),hasBorder:o.getAttribute("bHasBorder"),isPositionProportional:o.getAttribute("bProportionalPosition"),rotationAngle:"number"==typeof o.getAttribute("fScreenRotationAngle")?o.getAttribute("fScreenRotationAngle"):o.getAttribute("fRotationAngle"),graphicProperties:{fillStyle:{color:o.getAttribute("cFillStyleColor"),opacity:o.getAttribute("fOpacity")},lineStyle:{pattern:o.getAttribute("sLineStylePattern"),thickness:r.getLineThickness(o.getAttribute("fLineStyleThicknessIndex"))||o.getAttribute("fLineStyleThickness"),color:o.getAttribute("cLineStyleColor"),opacity:o.getAttribute("fLineStyleOpacity")}}}),a())},this.getMaximumProportionalWidth=function(){var e=0;if(o.getAttribute("bProportionalPosition")){var t=o.getAttribute("vPosition"),i=o.getAttribute("fWidth");"center"===o.getAttribute("sAnchor")&&(i/=2,t&&i&&Math.abs(t.x-i)>e&&(e=Math.abs(t.x-i))),t&&i&&Math.abs(t.x)+i>e&&(e=Math.abs(t.x)+i)}return e}},setAttribute:function(e,t){!1!==t||"bHasBorder"!==e||this.getAttribute("bIsFilled")?!1!==t||"bIsFilled"!==e||this.getAttribute("bHasBorder")?this._parent(e,t):(this.setAttribute("bHasBorder",!0),this._parent(e,t)):(this.setAttribute("bIsFilled",!0),this._parent(e,t))},getAttribute:function(e){return"vPosition"===e?this._parent(e).clone():this._parent(e)}})}),define("DS/DMUPlayMarker/DMUMarker3DText",["DS/DMUPlayMarker/DMUMarker3D","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker3DTextNode3D","DS/DMUPlayMarker/DMUMarkerShapeGrid","DS/DMUBaseExperience/EXPUtils","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r,n,o){"use strict";var a=[{name:"sTextContents",type:"string",JSONname:"Properties3DText.TextContents",defaultValue:[""]},{name:"sTextGraphicRepresentation",type:"string",JSONname:"Properties3DText.textGraphicRepresentation"},{name:"sTextGraphicRepresentationID",type:"string",JSONname:"Properties3DText.textGraphicRepresentationID"},{name:"bHasALeader",type:"bool",JSONname:"Properties3DText.HasALeader",defaultValue:!0},{name:"sLeaderEndType",type:"string",JSONname:"Properties3DText.LeaderEndType",defaultValue:"None"},{name:"vLeaderBreakPoint3D",type:"Vector3",JSONname:"Properties3DText.LeaderBreakPoint3D",defaultValue:new t.Vector3},{name:"lLeaderPointingPoints",type:"ListVector3",JSONname:"Properties3DText.LeaderPointingPoints",defaultValue:[]},{name:"lLeaderRelativePointingPoints",type:"ListVector3",JSONname:"Properties3DText.LeaderRelativePointingPoints",defaultValue:null},{name:"fTextBoxLength",type:"float",JSONname:"Properties3DText.TextBoxLength"},{name:"fTextBoxWidth",type:"float",JSONname:"Properties3DText.TextBoxWidth"},{name:"fLeaderAttachWidthRatio",type:"float",JSONname:"Properties3DText.LeaderAttachWidthRatio"},{name:"fLeaderAttachLengthRatio",type:"float",JSONname:"Properties3DText.LeaderAttachLengthRatio"},{name:"sFontName",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.familyName",defaultValue:"sans-serif"},{name:"sFontStyle",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.familyStyle",defaultValue:"normal"},{name:"fFontSize",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.fontSize"},{name:"sLineStylePattern",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.pattern",defaultValue:"1"},{name:"fLineStyleThickness",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.thickness",defaultValue:1},{name:"cFontColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.color",defaultValue:new t.Color("#000000")},{name:"sLeaderStylePattern",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.pattern",defaultValue:"1"},{name:"fLeaderStyleThickness",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.thickness",defaultValue:1},{name:"fLeaderStyleThicknessIndex",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.thicknessIndex"},{name:"cLeaderStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.color",defaultValue:new t.Color("#3d3d3d")},{name:"sAnchorMode",type:"string",JSONname:"Properties3DText.AnchorMode",defaultValue:"center"},{name:"fImageWidth",type:"float",JSONname:"Properties3DText.imgData.imgWidth"},{name:"fImageHeight",type:"float",JSONname:"Properties3DText.imgData.imgHeight"},{name:"sImageType",type:"string",JSONname:"Properties3DText.imgData.type"},{name:"sImageData",type:"string",JSONname:"Properties3DText.imgData.data"},{name:"bInvertH",type:"bool",JSONname:"Properties3DText.imgData.InvertH"},{name:"bInvertV",type:"bool",JSONname:"Properties3DText.imgData.InvertV"},{name:"fBorderRadius",type:"float",JSONname:"Properties3DText.BorderRadius",defaultValue:4},{name:"bZoomMode",type:"bool",JSONname:"Properties3DText.ZoomMode",defaultValue:!1},{name:"oHyperlinks",type:"objectDefinition",JSONname:"Properties3DText.hyperlink"},{name:"fBoxRotationAngle",type:"float",JSONname:"Properties3DText.BoxRotationAngle"},{name:"vRelativePosition",type:"Vector3",JSONname:"Properties3DText.RelativePoint"},{name:"sPositionalReference",type:"string",JSONname:"Properties3DText.PositionalReference"},{name:"sImageSrc",type:"ImageURL",JSONname:"Properties3DText.imgData.imgSrc"},{name:"iFontSize",type:"int",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.height"},{name:"MarkerImg",type:"ImageURL",JSONname:"Properties3DText.MarkerImg",defaultValue:""},{name:"vLeaderPointingPoint3D",type:"Vector3",JSONname:"Properties3DText.LeaderPointingPoint3D"}];return e.extend({init:function(e,t,s){this._parent(e,t),this.addParameters(a),this.removeParameters(["fLineStyleOpacity"]);var l=s||{};this.setAttribute("sType",l.type?l.type:"Marker3DText");var d=this;let c=t;this.getPixelFontSize=function(){if(d.getNode())return d.getNode().getPixelFontSize()},this.convertPixelToModelOnScreen=function(e){if(d.getNode())return d.getNode().convertPixelToModel({sizeinPixels:e})};var p=!1;this.setTextEditionFlag=function(e){(p=e)||d.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:d})},this.isTextEdited=function(){return p};var h={frmWindow:this._frmWindow,getType:this.getType,mkvShape:new r(this),onStartContentEditionCB:function(){d.setTextEditionFlag(!0)},onEndContentEditionCB:function(){d.setTextEditionFlag(!1)},onContentModifiedCB:l.onContentModifiedCB?l.onContentModifiedCB:function(e){if(e.text!==d.getAttribute("sTextContents")){var t,i=e.text,r=!0;for(t=0;t<i.length;t++)if(i[t]){r=!1;break}if(r)for(t=0;t<i.length;t++)i[t]=" ";d.setAttribute("sTextContents",i),d.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:d})}}};l.nodeParams&&Object.keys(l.nodeParams).forEach(function(e){h[e]=l.nodeParams[e]}),this.setNode(new(l.nodeClass?l.nodeClass:i)(h)),this.initContextualBar(l.ctxBar?l.ctxBar:"DS/DMUMarker/DMUMarkerTextContextualBar"),this.getImageToDisplay=function(){return d.getAttribute("sImageType")&&d.getAttribute("sImageData")?n.getImageDataUrl(d.getAttribute("sImageType"),d.getAttribute("sImageData")):d.getAttribute("sImageSrc")?d.getAttribute("sImageSrc"):d.getAttribute("MarkerImg")},this.getManipulationData=function(){return this.getNode().getLabelParams()},this.updateModel=function(e){for(var t=0;t<e.leaderPoints.length;t++)d.getAttribute("bHasALeader")?d.updatePointedElement(e.leaderPoints[t]):d.updatePointedElement(e.position),d.modifyLeaderPointingPoint(t,o.getRelativePosition(d,e.leaderPoints[t]));d.setAttributes([{name:"vLeaderBreakPoint3D",value:o.getRelativePosition(d,e.position)},{name:"fBoxRotationAngle",value:e.rotationAngle}])},this.startEdition=function(){!d.isReadOnly()&&d.isInEdition()&&d.getNode().startEdition&&d.getNode().startEdition()},this.isZoomMode=function(){return d.getAttribute("bZoomMode")},this.getPointingPoints=function(){let e=d.getAttribute("lLeaderRelativePointingPoints")||[];return d.getAttribute("lLeaderPointingPoints").map((t,i)=>o.getAbsolutePosition(d,e[i],t,d.getPointedReference(i)))};var u=this.refreshNode;this.refreshNode=function(){d.getNode()&&!t.isImporting()&&(d.getNode().update({name:d.getAttribute("sName"),pointedReferences:d.getAttribute("lPointedReferences"),isVisible:d.getAttribute("bVisible"),content:d.getAttribute("sTextContents"),tessRep:d.getAttribute("sTextGraphicRepresentationID")?function(e){let t=c?c.getAttribute("oLinksManager"):void 0;return t?t.getTesselatedRepByID(e):void 0}(d.getAttribute("sTextGraphicRepresentationID")):d.getAttribute("sTextGraphicRepresentation"),position:o.getAbsolutePosition(d,d.getAttribute("vRelativePosition"),d.getAttribute("vLeaderBreakPoint3D"),d.getAttribute("sPositionalReference")),pointingPoints:d.getPointingPoints(),anchorMode:d.getAttribute("sAnchorMode"),hasALeader:d.getAttribute("bHasALeader"),markerImage:d.getImageToDisplay(),imageWidth:d.getAttribute("fImageWidth"),imageHeight:d.getAttribute("fImageHeight"),boxWidth:d.getAttribute("fTextBoxWidth"),boxHeight:d.getAttribute("fTextBoxLength"),imageInvertH:d.getAttribute("bInvertH"),imageInvertV:d.getAttribute("bInvertV"),leaderEndType:d.getAttribute("sLeaderEndType"),isFilled:d.getAttribute("bIsFilled"),hasBorder:d.getAttribute("bHasBorder"),zoomMode:d.getAttribute("bZoomMode"),leaderAttachWidthRatio:d.getAttribute("fLeaderAttachWidthRatio"),leaderAttachLengthRatio:d.getAttribute("fLeaderAttachLengthRatio"),hyperlinks:d.getAttribute("oHyperlinks"),boxRotationAngle:d.getAttribute("fBoxRotationAngle"),graphicProperties:{borderRadius:d.getAttribute("fBorderRadius"),fontStyle:{pxheight:d.getAttribute("iFontSize")*(4/3),fontSize:d.getAttribute("fFontSize"),familyName:d.getAttribute("sFontName"),familyStyle:d.getAttribute("sFontStyle"),color:d.getAttribute("cFontColor")},fillStyle:{color:d.getAttribute("cFillStyleColor"),opacity:d.getAttribute("fOpacity"),gradient:d.getAttribute("oGradient")},lineStyle:{thickness:o.getLineThickness(d.getAttribute("fLineStyleThicknessIndex"))||d.getAttribute("fLineStyleThickness"),pattern:d.getAttribute("sLineStylePattern"),color:d.getAttribute("cLineStyleColor")},leaderStyle:{thickness:o.getLineThickness(d.getAttribute("fLeaderStyleThicknessIndex"))||d.getAttribute("fLeaderStyleThickness"),pattern:d.getAttribute("sLeaderStylePattern"),color:d.getAttribute("cLeaderStyleColor")}}}),u())}},setAttribute:function(e,t){"sImageData"===e?(this._parent("MarkerImg",null),this._parent("sImageSrc",null)):"fFontSize"===e?this._parent("iFontSize",null):"vLeaderBreakPoint3D"===e?this.updatePointedPosition(t):"fLeaderStyleThicknessIndex"===e&&this._parent("fLeaderStyleThickness",null),this._parent(e,t)},getAttribute:function(e){var t;if("lLeaderPointingPoints"===e){var i=this._parent("lLeaderPointingPoints"),r=[];if(i&&i.length)for(t=0;t<i.length;t++)r.push(i[t].clone());else{var n=this._parent("vLeaderPointingPoint3D");n&&r.push(n.clone())}return r}return this._parent(e)},modifyLeaderPointingPoint:function(e,t){var i=this.getAttribute("lLeaderPointingPoints");e<i.length&&(i[e]=t),this.setAttribute("lLeaderPointingPoints",i)}})}),define("DS/DMUPlayMarker/DMUCommentAnnotationBase",["require","exports","DS/DMUPlayMarker/DMUCommentableObject"],function(e,t,i){"use strict";let r=[{name:"vPosition",type:"Vector3",JSONname:"PropertiesCommentBase.Position"}];return class extends i{constructor(e,t){super(e,t),this.addParameters(r);let i=this;this.initContextualBar("DS/DMUComment/DMUCommentContextualBar"),this.getOwner=function(){let e=i.getAttribute("lComments");if(e&&e.length)return e[0].getAttribute("sOwner")},this._parentSetAttribute=this.setAttribute,this.setAttribute=function(e,t){"vPosition"===e&&i.updatePointedPosition(t),i._parentSetAttribute(e,t)}}}}),define("DS/DMUPlayMarker/DMUMarker2DText",["DS/DMUPlayMarker/DMUMarker2D","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker2DTextNode3D","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUPlayMarker/DMUMarkerShapeGrid","DS/DMUBaseExperience/EXPUtils","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r,n,o,a){"use strict";var s=[{name:"sTextContents",type:"string",JSONname:"Properties2DText.TextContents",defaultValue:[""]},{name:"sTextGraphicRepresentation",type:"string",JSONname:"Properties2DText.textGraphicRepresentation"},{name:"sTextGraphicRepresentationID",type:"string",JSONname:"Properties2DText.textGraphicRepresentationID"},{name:"bHasALeader",type:"bool",JSONname:"Properties2DText.HasALeader",defaultValue:!1},{name:"sLeaderEndType",type:"string",JSONname:"Properties2DText.LeaderEndType",defaultValue:"None"},{name:"vLeaderBreakPoint2D",type:"Vector2",JSONname:"Properties2DText.LeaderBreakPoint2D",defaultValue:new t.Vector2(0,0)},{name:"lLeaderPointingPoints",type:"ListVector2",JSONname:"Properties2DText.LeaderPointingPoints",defaultValue:[]},{name:"fTextBoxLength",type:"float",JSONname:"Properties2DText.TextBoxLength"},{name:"fTextBoxWidth",type:"float",JSONname:"Properties2DText.TextBoxWidth"},{name:"fLeaderAttachWidthRatio",type:"float",JSONname:"Properties2DText.LeaderAttachWidthRatio"},{name:"fLeaderAttachLengthRatio",type:"float",JSONname:"Properties2DText.LeaderAttachLengthRatio"},{name:"sAnchorMode",type:"string",JSONname:"Properties2DText.AnchorMode",defaultValue:"center"},{name:"sFontName",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.familyName",defaultValue:"sans-serif"},{name:"sFontStyle",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.familyStyle",defaultValue:"normal"},{name:"fFontSize",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.fontSize"},{name:"sLineStylePattern",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.pattern",defaultValue:"1"},{name:"fLineStyleThickness",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.thickness",defaultValue:1},{name:"sLeaderStylePattern",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.pattern",defaultValue:"1"},{name:"fLeaderStyleThickness",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.thickness",defaultValue:1},{name:"fLeaderStyleThicknessIndex",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.thicknessIndex"},{name:"cLeaderStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.color",defaultValue:new t.Color(4013373)},{name:"cFontColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.color",defaultValue:new t.Color(0)},{name:"fImageWidth",type:"float",JSONname:"Properties2DText.imgData.imgWidth"},{name:"fImageHeight",type:"float",JSONname:"Properties2DText.imgData.imgHeight"},{name:"sImageType",type:"string",JSONname:"Properties2DText.imgData.type"},{name:"sImageData",type:"string",JSONname:"Properties2DText.imgData.data"},{name:"bInvertH",type:"bool",JSONname:"Properties2DText.imgData.InvertH"},{name:"bInvertV",type:"bool",JSONname:"Properties2DText.imgData.InvertV"},{name:"fBorderRadius",type:"float",JSONname:"Properties2DText.BorderRadius",defaultValue:4},{name:"oHyperlinks",type:"objectDefinition",JSONname:"Properties2DText.hyperlink"},{name:"fBoxRotationAngle",type:"float",JSONname:"Properties2DText.BoxRotationAngle"},{name:"sImageSrc",type:"ImageURL",JSONname:"Properties2DText.imgData.imgSrc"},{name:"iFontSize",type:"int",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.height"},{name:"MarkerImg",type:"ImageURL",JSONname:"Properties2DText.MarkerImg"},{name:"vLeaderPointingPoint2D",type:"Vector2",JSONname:"Properties2DText.LeaderPointingPoint2D"}];return e.extend({init:function(e,l,d){this._parent(e,l),this.addParameters(s),this.removeParameters(["fLineStyleOpacity"]);let c=l;var p=d||{};this.setAttribute("sType",p.type?p.type:"Marker2DText");var h=this;this.getPixelFontSize=function(){if(h.getNode())return h.getNode().getPixelFontSize()},this.convertPixelToModelOnScreen=function(e){if(h.getNode())return h.getNode().convertPixelToModel({sizeinPixels:e})};var u=!1;this.setTextEditionFlag=function(e){(u=e)||h.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:h})},this.isTextEdited=function(){return u};var g={frmWindow:this._frmWindow,getType:this.getType,mkvShape:new n(this),onStartContentEditionCB:function(){h.setTextEditionFlag(!0)},onEndContentEditionCB:function(){h.setTextEditionFlag(!1)},onContentModifiedCB:function(e){if(e.text!==h.getAttribute("sTextContents")){var t,i=e.text,r=!0;for(t=0;t<i.length;t++)if(i[t]){r=!1;break}if(r)for(t=0;t<i.length;t++)i[t]=" ";h.setAttribute("sTextContents",i),h.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:h})}}};p.nodeParams&&Object.keys(p.nodeParams).forEach(function(e){g[e]=p.nodeParams[e]}),this.setNode(new(p.nodeClass?p.nodeClass:i)(g)),this.initContextualBar(p.ctxBar?p.ctxBar:"DS/DMUMarker/DMUMarkerTextContextualBar"),this.getManipulationData=function(){return this.getNode().getLabelParams()},this.getImageToDisplay=function(){return h.getAttribute("sImageType")&&h.getAttribute("sImageData")?o.getImageDataUrl(h.getAttribute("sImageType"),h.getAttribute("sImageData")):h.getAttribute("sImageSrc")?h.getAttribute("sImageSrc"):h.getAttribute("MarkerImg")},this.updateModel=function(e){for(var i,n=0;n<e.leaderPoints.length;n++)i=r.getViewerPositionFromPoint(h.getViewer(),e.leaderPoints[n]),h.modifyLeaderPointingPoint(n,new t.Vector2(i.left,i.top));i=r.getViewerPositionFromPoint(h.getViewer(),e.position),h.setAttributes([{name:"vLeaderBreakPoint2D",value:new t.Vector2(i.left,i.top)},{name:"fBoxRotationAngle",value:e.rotationAngle}])},this.startEdition=function(){!h.isReadOnly()&&h.isInEdition()&&h.getNode().startEdition&&h.getNode().startEdition()},this.getMaximumProportionalWidth=function(){var e=0;if(h.getAttribute("bProportionalPosition")){var t=h.getAttribute("vLeaderBreakPoint2D"),i=h.getAttribute("fTextBoxWidth");if("center"===h.getAttribute("sAnchorMode")&&(i/=2,t&&i&&Math.abs(t.x-i)>e&&(e=Math.abs(t.x-i))),t&&i&&Math.abs(t.x)+i>e&&(e=Math.abs(t.x)+i),h.getAttribute("bHasALeader")&&(t=h.getAttribute("lLeaderPointingPoints"))&&t.length)for(var r=0;r<t.length;r++)Math.abs(t[r].x)>e&&(e=Math.abs(t[r].x))}return e};var P=this.refreshNode;this.refreshNode=function(){h.getNode()&&!l.isImporting()&&(h.getNode().update({name:h.getAttribute("sName"),isVisible:h.getAttribute("bVisible"),content:h.getAttribute("sTextContents"),tessRep:h.getAttribute("sTextGraphicRepresentationID")?function(e){let t=c?c.getAttribute("oLinksManager"):void 0;return t?t.getTesselatedRepByID(e):void 0}(h.getAttribute("sTextGraphicRepresentationID")):h.getAttribute("sTextGraphicRepresentation"),breakPoint2D:h.getAttribute("vLeaderBreakPoint2D"),pointingPoints:h.getAttribute("lLeaderPointingPoints"),inEdition:h.isInEdition(),windowAnchor:h.getAttribute("sWindowAnchor"),hasALeader:h.getAttribute("bHasALeader"),leaderEndType:h.getAttribute("sLeaderEndType"),isFilled:h.getAttribute("bIsFilled"),hasBorder:h.getAttribute("bHasBorder"),anchorMode:h.getAttribute("sAnchorMode"),isPositionProportional:h.getAttribute("bProportionalPosition"),leaderAttachWidthRatio:h.getAttribute("fLeaderAttachWidthRatio"),leaderAttachLengthRatio:h.getAttribute("fLeaderAttachLengthRatio"),hyperlinks:h.getAttribute("oHyperlinks"),markerImage:h.getImageToDisplay(),imageWidth:h.getAttribute("fImageWidth"),imageHeight:h.getAttribute("fImageHeight"),boxHeight:h.getAttribute("fTextBoxLength"),boxWidth:h.getAttribute("fTextBoxWidth"),imageInvertH:h.getAttribute("bInvertH"),imageInvertV:h.getAttribute("bInvertV"),boxRotationAngle:h.getAttribute("fBoxRotationAngle"),graphicProperties:{borderRadius:h.getAttribute("fBorderRadius"),fontStyle:{pxheight:h.getAttribute("iFontSize")*(4/3),fontSize:h.getAttribute("fFontSize"),familyName:h.getAttribute("sFontName"),familyStyle:h.getAttribute("sFontStyle"),color:h.getAttribute("cFontColor")},fillStyle:{color:h.getAttribute("cFillStyleColor"),opacity:h.getAttribute("fOpacity"),gradient:h.getAttribute("oGradient")},lineStyle:{thickness:a.getLineThickness(h.getAttribute("fLineStyleThicknessIndex"))||h.getAttribute("fLineStyleThickness"),pattern:h.getAttribute("sLineStylePattern"),color:h.getAttribute("cLineStyleColor")},leaderStyle:{thickness:a.getLineThickness(h.getAttribute("fLeaderStyleThicknessIndex"))||h.getAttribute("fLeaderStyleThickness"),pattern:h.getAttribute("sLeaderStylePattern"),color:h.getAttribute("cLeaderStyleColor")}}}),P())},this.modifyLeaderPointingPoint=function(e,t){var i=h.getAttribute("lLeaderPointingPoints");e<i.length&&(i[e]=t),h.setAttribute("lLeaderPointingPoints",i)}},setAttribute:function(e,t){"sImageData"===e?(this._parent("MarkerImg",null),this._parent("sImageSrc",null)):"fFontSize"===e?this._parent("iFontSize",null):"fLeaderStyleThicknessIndex"===e&&this._parent("fLeaderStyleThickness",null),this._parent(e,t)},getAttribute:function(e){var t;if("lLeaderPointingPoints"===e){var i=this._parent("lLeaderPointingPoints"),r=[];if(i&&i.length)for(t=0;t<i.length;t++)r.push(i[t].clone());else{var n=this._parent("vLeaderPointingPoint2D");n&&r.push(n.clone())}return r}return"vLeaderBreakPoint2D"===e?this._parent(e).clone():this._parent(e)}})}),define("DS/DMUPlayMarker/DMUMarker2DPicture",["DS/DMUPlayMarker/DMUMarker2DText","DS/DMUPlayMarker/DMUMarker2DPictureNode3D","DS/DMUBaseUI/DMUToolsUsers","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r){"use strict";var n=[{name:"bShortDisplay",type:"bool",JSONname:"Properties2DPicture.Shortdisplay",defaultValue:!1},{name:"fCreationDate",type:"float",JSONname:"Properties2DPicture.CreationDate",defaultValue:null}];return e.extend({init:function(e,o){this._parent(e,o,{type:"Marker2DPicture",ctxBar:"DS/DMUMarker/DMUMarkerPictureContextualBar",nodeClass:t}),this.addParameters(n);var a=this,s=this.updateModel;this.updateModel=function(e){s(e),a.setAttributes([{name:"fImageWidth",value:e.imgWidth},{name:"fImageHeight",value:e.imgHeight}])},this.getPictureLabel=function(){if(a.getAttribute("bShortDisplay"))return[];var e=a.getAttribute("sTextContents")[0]||"";return a.getAttribute("fCreationDate")&&(e+=" | "+i.formatDate(a.getAttribute("fCreationDate"))),[e]};var l=this.refreshNode;this.refreshNode=function(){a.getNode()&&!o.isImporting()&&(a.getNode().update({name:a.getAttribute("sName"),content:a.getAttribute("bShortDisplay")?[]:a.getAttribute("sTextContents"),isVisible:a.getAttribute("bVisible"),hasALeader:a.getAttribute("bHasALeader"),leaderEndType:a.getAttribute("sLeaderEndType"),breakPoint2D:a.getAttribute("vLeaderBreakPoint2D"),pointingPoints:a.getAttribute("lLeaderPointingPoints"),inEdition:a.isInEdition(),isFilled:a.getAttribute("bIsFilled"),hasBorder:a.getAttribute("bHasBorder"),imageWidth:a.getAttribute("fImageWidth"),imageHeight:a.getAttribute("fImageHeight"),imageInvertH:a.getAttribute("bInvertH"),imageInvertV:a.getAttribute("bInvertV"),markerImage:a.getImageToDisplay(),shortDisplay:a.getAttribute("bShortDisplay")||!a.getPictureLabel()[0],windowAnchor:a.getAttribute("sWindowAnchor"),anchorMode:a.getAttribute("sAnchorMode"),isPositionProportional:a.getAttribute("bProportionalPosition"),leaderAttachWidthRatio:a.getAttribute("fLeaderAttachWidthRatio"),leaderAttachLengthRatio:a.getAttribute("fLeaderAttachLengthRatio"),boxRotationAngle:a.getAttribute("fBoxRotationAngle"),creationDate:a.getAttribute("fCreationDate"),graphicProperties:{borderRadius:a.getAttribute("fBorderRadius"),fontStyle:{pxheight:a.getAttribute("iFontSize")*(4/3),fontSize:a.getAttribute("fFontSize"),familyName:a.getAttribute("sFontName"),familyStyle:a.getAttribute("sFontStyle"),color:a.getAttribute("cFontColor")},fillStyle:{color:a.getAttribute("cFillStyleColor"),opacity:a.getAttribute("fOpacity"),gradient:a.getAttribute("oGradient")},lineStyle:{thickness:r.getLineThickness(a.getAttribute("fLineStyleThicknessIndex"))||a.getAttribute("fLineStyleThickness"),pattern:a.getAttribute("sLineStylePattern"),color:a.getAttribute("cLineStyleColor")},leaderStyle:{thickness:r.getLineThickness(a.getAttribute("fLeaderStyleThicknessIndex"))||a.getAttribute("fLeaderStyleThickness"),pattern:a.getAttribute("sLeaderStylePattern"),color:a.getAttribute("cLeaderStyleColor")}}}),l())}},getMaximumProportionalWidth:function(){var e=this._parent();if(this.getAttribute("bProportionalPosition")){var t=this.getAttribute("vLeaderBreakPoint2D"),i=this.getAttribute("fImageWidth");"center"===this.getAttribute("sAnchorMode")&&(i/=2),t&&i&&Math.abs(t.x)+i>e&&(e=Math.abs(t.x)+i)}return e},setAttribute:function(e,t){"fTextBoxWidth"===e?(this._parent("fTextBoxWidth",null),this._parent("fImageWidth",t)):"fTextBoxLength"===e?(this._parent("fTextBoxLength",null),this._parent("fImageHeight",t)):this._parent(e,t)},getAttribute:function(e){var t=this._parent(e);return"fImageWidth"===e?null==t&&(t=this._parent("fTextBoxWidth")):"fImageHeight"===e&&null==t&&(t=this._parent("fTextBoxLength")),t}})}),define("DS/DMUPlayMarker/DMUMarker3DHyperlinkNode3D",["DS/DMUPlayMarker/DMUMarker3DTextNode3D","DS/Mesh/MeshUtils","DS/DMUPlayMarker/DMUMarkerTools","DS/Selection/PSOManager","DS/DMUMeasurable/DMUToolsSceneGraph"],function(e,t,i,r,n){"use strict";return e.extend({init:function(e){var o=e||{};o.defaultGraphicProps={padding:0},this._parent(o);var a,s=this;this.getTooltip=function(){return i.createHyperlinkDiv(o.getHyperlinks())},this.onClickCB=function(){s.getViewer().setCursor("auto"),i.solveHyperlink(o.getHyperlinks(),s.getViewer())},this.onBeginPreactivateCB=function(e){a||(a=n.buildPathElement(s.children[0])),r.add({pathElement:a,event:e.event.from[0]}),s.getViewer().setCursor("pointer")},this.onEndPreactivateCB=function(){a||(a=n.buildPathElement(s.children[0])),r.isIn({pathElement:a})&&r.remove({pathElement:a}),s.getViewer().setCursor("auto")};var l=this.update;this.update=function(e){l(e),s.setPickable(t.PICKABLE),s._getExcludeFromCSO=o.isReadOnly}}})}),define("DS/DMUPlayMarker/DMUMarker3DHyperlink",["DS/DMUPlayMarker/DMUMarker3DText","DS/DMUPlayMarker/DMUMarker3DHyperlinkNode3D","DS/DMUPlayMarker/DMUMarkerTools"],function(e,t,i){"use strict";return e.extend({init:function(e,r){var n=this;this._parent(e,r,{type:"Marker3DHyperlink",nodeClass:t,nodeParams:{getHyperlinks:function(){return n.getAttribute("oHyperlinks")},isReadOnly:function(){return n.isReadOnly()}}});let o=this.getImageToDisplay;this.getImageToDisplay=function(){return o()?o():i.getHyperlinkIcon(this.getAttribute("oHyperlinks"))}}})}),define("DS/DMUPlayMarker/DMUMarker3DArrowNode3D",["require","exports","DS/SceneGraphNodes/BillBoardNode3D","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/DMUBaseExperience/EXPToolsMaterial","DS/DMUPlayMarker/DMUMarkerTools","DS/DMUBaseUI/DMUManipulableNode3D"],function(e,t,i,r,n,o,a,s,l){"use strict";return class extends l{constructor(e){super(e);let t,l,d,c,p,h,u=this,g=u.getViewer(),P=new i({type:"Cylindrical"}),f=1;this.addChild(P),P.setPickParent(!0);let y=new n;P.addChild(y),y.setPickParent(!0),y.setMatrix(new r.Matrix4(0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1)),this.linkManipulatorToNode(y),this.getRepNode=function(){return P},this.updateRepresentation=function(e,i){if(!p)return;let n=e.endingPoint.clone().sub(e.pointingPoint),a=s.getArrowSpecs(e.width,n.length(),e.shaftRatio,p.headRatio,p.style);if(y.removeChildren(),p.isFilled){a.material=t;let e=o.createSimpleMeshNode(a);e.setShadow(!1),e.setPickParent(!0),y.addChild(e)}if(p.hasBorder){let e=o.createLineNode({points:a.coordinates,material:l});e.setShadow(!1),e.setPickParent(!0),y.addChild(e)}P.setConstraintAxis(n.clone()),u.setMatrix((new r.Matrix4).setPosition(e.pointingPoint)),t&&l&&(t.setOpacity((p.graphicProperties.fillStyle.opacity||0)*(i?.6:1)),l.setOpacity((p.graphicProperties.lineStyle.opacity||0)*(i?.6:1)))},this.getArrowParams=function(){return p?{pointingPoint:p.firstPoint,endingPoint:p.secondPoint,width:p.width,shaftRatio:p.shaftRatio,pointedPage:p.pointedPage}:{}};let D=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){D(),h&&clearTimeout(h),h=null,l&&l.dispose(),t&&t.dispose(),t=l=P=y=p=null},this._updateVisibility=function(e){if(!p)return;void 0!==e&&(f=e);let t=s.is3DMarkerDisplayed(g,p.pointedReferences,!0);u.setVisibility(f>0&&p.isVisible&&t),g.render()},this.getArrowSpecs=function(){return d},this.update=function(e){if(!u)return;p||(p={graphicProperties:{fillStyle:{},lineStyle:{}}});let i=!1,n=[],h={paramA:p,paramB:e,merge:!0,mergedKeys:n},g=this.getRepManipulator();if(g&&g.deactivate(),!s.compareAndMergeParams(h)){if(u.setName(p.name),(!d||n.includes("secondPoint")||n.includes("firstPoint")||n.includes("width")||n.includes("shaftRatio")||n.includes("headRatio")||n.includes("style"))&&(i=!0,c=p.secondPoint.clone().sub(p.firstPoint),d=s.getArrowSpecs(p.width,c.length(),p.shaftRatio,p.headRatio,p.style)),t?n.includes("fillStyle")&&(t.color=p.graphicProperties.fillStyle.color,t.setOpacity(p.graphicProperties.fillStyle.opacity)):(i=!0,t=a.createBasicMaterial({color:p.graphicProperties.fillStyle.color,opacity:p.graphicProperties.fillStyle.opacity})),l?n.includes("lineStyle")&&(l.color=p.graphicProperties.lineStyle.color,l.setOpacity(p.graphicProperties.lineStyle.opacity),l.setLineWidth((p.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio),l.setDashPatternType(a.getDashType(p.graphicProperties.lineStyle.pattern))):(i=!0,l=a.createLineMaterial({color:p.graphicProperties.lineStyle.color,opacity:p.graphicProperties.lineStyle.opacity,lineWidth:(p.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio,pattern:p.graphicProperties.lineStyle.pattern})),(n.includes("isFilled")||n.includes("hasBorder"))&&(i=!0),i){if(y.removeChildren(),p.isFilled){d.material=t;let e=o.createSimpleMeshNode(d);e.setShadow(!1),e.setPickParent(!0),y.addChild(e)}if(p.hasBorder){let e=o.createLineNode({points:d.coordinates,material:l});e.setShadow(!1),e.setPickParent(!0),y.addChild(e)}}P.setConstraintAxis(c.clone()),u.setMatrix((new r.Matrix4).setPosition(p.firstPoint)),u._updateVisibility()}g&&g.activate()};let S=function(){u&&u._updateVisibility(),h=null};this.onViewerEventCB=function(e){u&&p&&(h||!p.pointedReferences||"onHideShow"!==e.eventType&&"onRepresentationLoaded"!==e.eventType||(h=setTimeout(S)))}}}}),define("DS/DMUPlayMarker/DMUMarker3DArrow",["require","exports","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker3D","DS/DMUBaseUIServices/DMUObjectsServices","DS/DMUPlayMarker/DMUMarker3DArrowNode3D"],function(e,t,i,r,n,o){"use strict";let a=[{name:"vFirstPoint",type:"Vector3",JSONname:"Properties3DArrow.FirstPoint",defaultValue:new i.Vector3},{name:"vSecondPoint",type:"Vector3",JSONname:"Properties3DArrow.SecondPoint",defaultValue:new i.Vector3(10,0,0)},{name:"vFirstPointRelativePosition",type:"Vector3",JSONname:"Properties3DArrow.FirstPointRelativePosition",defaultValue:null},{name:"vSecondPointRelativePosition",type:"Vector3",JSONname:"Properties3DArrow.SecondPointRelativePosition",defaultValue:null},{name:"fWidth",type:"float",JSONname:"Properties3DArrow.Width",defaultValue:1},{name:"sStyle",type:"string",JSONname:"Properties3DArrow.Style",defaultValue:"beginSide"},{name:"fShaftRatio",type:"float",JSONname:"Properties3DArrow.ShaftRatio",defaultValue:.8},{name:"fHeadRatio",type:"float",JSONname:"Properties3DArrow.HeadRatio",defaultValue:.5}];return class extends r{constructor(e,t){super(e,t),this.addParameters(a),this.setAttribute("sType","Marker3DArrow");let i=this;this.setNode(new o({frmWindow:this._frmWindow,getType:this.getType})),this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar"),this.getManipulationData=function(){return this.getNode().getArrowParams()},this.updateModel=function(e){i.updatePointedElement(e.pointingPoint),i.setAttributes([{name:"fWidth",value:e.width},{name:"vFirstPoint",value:n.getRelativePosition(i,e.pointingPoint)},{name:"vSecondPoint",value:n.getRelativePosition(i,e.endingPoint)},{name:"fShaftRatio",value:e.shaftRatio}])};let r=this.refreshNode;this.refreshNode=function(){i.getNode()&&!t.isImporting()&&(i.getNode().update({name:i.getAttribute("sName"),pointedReferences:i.getAttribute("lPointedReferences"),firstPoint:n.getAbsolutePosition(i,i.getAttribute("vFirstPointRelativePosition"),i.getAttribute("vFirstPoint"),i.getPointedReference(0)),secondPoint:n.getAbsolutePosition(i,i.getAttribute("vSecondPointRelativePosition"),i.getAttribute("vSecondPoint"),i.getPointedReference(1)),width:i.getAttribute("fWidth"),style:i.getAttribute("sStyle"),shaftRatio:i.getAttribute("fShaftRatio"),headRatio:i.getAttribute("fHeadRatio"),inEdition:i.isInEdition(),isVisible:i.getAttribute("bVisible")&&!i.hasAlertFlag(),isFilled:i.getAttribute("bIsFilled"),hasBorder:i.getAttribute("bHasBorder"),pointedPage:i.getAttribute("fPointedPageNumber"),graphicProperties:{fillStyle:{color:i.getAttribute("cFillStyleColor"),opacity:i.getAttribute("fOpacity")},lineStyle:{pattern:i.getAttribute("sLineStylePattern"),thickness:n.getLineThickness(i.getAttribute("fLineStyleThicknessIndex"))||i.getAttribute("fLineStyleThickness"),color:i.getAttribute("cLineStyleColor"),opacity:i.getAttribute("fLineStyleOpacity")}}}),r())},this._parentSetAttribute=this.setAttribute,this.setAttribute=function(e,t){!1!==t||"bHasBorder"!==e||i.getAttribute("bIsFilled")?!1!==t||"bIsFilled"!==e||i.getAttribute("bHasBorder")?"vFirstPoint"===e&&i.updatePointedPosition(t):i.setAttribute("bHasBorder",!0):i.setAttribute("bIsFilled",!0),i._parentSetAttribute(e,t)},this._parentGetAttribute=this.getAttribute,this.getAttribute=function(e){return"vFirstPoint"===e||"vSecondPoint"===e?i._parentGetAttribute(e).clone():i._parentGetAttribute(e)}}}}),define("DS/DMUPlayMarker/DMUMarker3DPictureNode3D",["DS/Visualization/Node3D","DS/DMUBaseUI/DMUManipulableNode3D","DS/Visualization/ThreeJS_DS","DS/DMUMarkerVisu/DMUMarkerVisuPictureShapeNode","DS/DMUBaseUI/DMUToolsLeader","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUPlayMarker/DMUMarkerTools"],function(e,t,i,r,n,o,a,s){"use strict";return t.extend({init:function(t){var l=t||{};this._parent(l);var d=this,c={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}},p=d.getViewer(),h=1;let u,g=!1,P=!1;var f=new r({window:l.frmWindow,data:{isPicture:!0,mkvShape:l.mkvShape,graphicProperties:{padding:0}},onDragStart:function(e){e&&e.dataTransfer&&e.dataTransfer.setData("text",c.draggableContent||"")}});this.addChild(f),f.setPickParent(!0);var y=new e;function D(){if(y&&c){let e=!g&&!P&&c.hasALeader;y.setVisibility(e),y.setVisibilityFree(!e)}}function S(t,r,d,h){if(D(),c.hasALeader&&(0===p.getVisibleSpace()&&!1===c.isVisible||1===p.getVisibleSpace()&&!0===c.isVisible)){var u=0;switch(c.leaderEndType){case"Arrow":u=1;break;case"Bubble":u=2;break;case"Cross":u=4;break;case"Square":u=3}if(d.offsetWidth>0&&d.offsetWidth>0){var g,P,f=t.clone(),S={offsetWidth:d.width/window.devicePixelRatio,offsetHeight:d.height/window.devicePixelRatio,rotationAngle:h};if("topleft"===c.anchorMode)if(c.zoomMode){var m=p.currentViewpoint.getUpDirection().clone(),M=(new i.Vector3).crossVectors(p.currentViewpoint.getSightDirection(),m).setLength(d.offsetWidth/2);m.setLength(-d.offsetHeight/2),f.add(m),f.add(M)}else{var b=o.getViewerPositionFromPoint(p,f);if(b&&!isNaN(b.left)&&!isNaN(b.top)){var v=new i.Vector2(b.left+S.offsetWidth/2,b.top+S.offsetHeight/2),A=o.getLineFromWindowPosition(p,v.x,v.y),x=o.getViewpointInfo(p.currentViewpoint),w=a.computeLinePlaneDistance(A.position.toArray(),A.direction.toArray(),c.position.toArray(),x.sight.toArray());f=new i.Vector3(w.aPosition[0],w.aPosition[1],w.aPosition[2])}}if(r&&r.length){var k=[];if(1===p.getVisibleSpace()&&c.pointedReferences&&c.pointedReferences.length){var N=s.getPointedReferencesVisibilityStates(p,c.pointedReferences);for(P=N.length-1;P>=0;P--)N[P]&&r[P]&&k.push(r[P])}else k=r.slice();var U=y.getChildren();for(P=0;P<k.length;P++){(g=U[P])||((g=new e("DMUMarkerLeaderNode")).setPickParent(!0),y.addChild(g));let t={width:c.leaderAttachWidthRatio,height:c.leaderAttachLengthRatio},i=n.modifyLeaderNode(p,g,!0,f,k[P],t,c.graphicProperties.leaderStyle.thickness*window.devicePixelRatio,c.graphicProperties.leaderStyle.color,c.graphicProperties.leaderStyle.pattern,u,S,l.frmWindow);g.setVisibility(i)}if(U=y.getChildren(),k.length<U.length)for(P=U.length-1;P>=k.length;P--)U[P].isManipulator||y.removeChild(U[P])}}}}this.addChild(y),y.setPickParent(!0),this.linkManipulatorToNode(f.getBackNode()),this.getRepNode=function(){return{leader:y,box:f.getLabelNode()}},this.hasTessellatedRepresentation=function(){return c&&c.tessRep&&c.tessRep.length},this.getLabelDimensions=function(){var e=f.getDimensions();return e.position=c.position,e},this.updateRepresentation=function(e,t){var r=o.convertPixelToModel({sizeInPixels:e.imgWidth,coords:c.zoomMode?e.position:null,viewer:p}),n=o.convertPixelToModel({sizeInPixels:e.imgHeight,coords:c.zoomMode?e.position:null,viewer:p});f.setTransformation({scaleMatrix:(new i.Matrix4).makeScale(c.imageWidth?r/c.imageWidth:1,c.imageHeight?n/c.imageHeight:1,1),rotationAngle:e.rotationAngle}),f.setMatrix((new i.Matrix4).setPosition(e.position)),S(e.position,e.leaderPoints,{width:e.width,height:e.height,offsetWidth:r,offsetHeight:n},e.rotationAngle),f.setGhostMode(t)},this.getLabelParams=function(){var e=f.getDimensions();return{leaderPoints:c.pointingPoints.slice(),position:c.position,rotationAngle:c.boxRotationAngle?c.boxRotationAngle:0,anchorMode:c.anchorMode,width:e.width,height:e.height,imgWidth:o.convertModelToPixels({sizeInMM:c.imageWidth,coords:c.zoomMode?c.position:null,viewer:p}),imgHeight:o.convertModelToPixels({sizeInMM:c.imageHeight,coords:c.zoomMode?c.position:null,viewer:p})}};var m=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){m(),u&&clearTimeout(u),u=null,f&&f.remove(),y=f=d=null},this.getPixelFontSize=function(){var e;return c.graphicProperties.fontStyle.pxheight&&(e=o.convertPixelToModel({sizeInPixels:c.graphicProperties.fontStyle.pxheight,viewer:p})),e||(e=c.graphicProperties.fontStyle.fontSize),o.convertModelToPixels({sizeInMM:e,viewer:p})},this._updateVisibility=function(e,t){if(!c)return;void 0!==e&&(h=e);let i=c.pointedReferences;i&&i.length!==c.pointingPoints.length&&(i=c.pointedReferences.slice(0,c.pointingPoints.length));var r=c.isVisible&&s.is3DMarkerDisplayed(p,i)&&h>0;d.setVisibility(r),0!==h&&f.setOpacity(h),(0===p.getVisibleSpace()&&!r||1===p.getVisibleSpace()&&r)&&(t&&h<1?(g=!0,D()):(g=!1,S(c.position,c.pointingPoints,f.getDimensions(),c.boxRotationAngle))),p.render()},this.update=function(e){if(d){c=c?d.mergeParams(c,e):e;var t=this.getRepManipulator();t&&t.deactivate(),d.setName(c.name),c.graphicProperties.fontStyle.height=d.getPixelFontSize(),f.modify(c),t&&t.activate(),d._updateVisibility()}};let M=function(){d&&d._updateVisibility(),u=null};this.onViewerEventCB=function(e){d&&e&&("onDMUSlideStartDisplay"!==e.eventType&&"onDMUSlideDisplayed"!==e.eventType||(P="onDMUSlideStartDisplay"===e.eventType,D()),c&&("@onWindowResized"!==e.eventType&&"onSwapVisibleSpace"!==e.eventType&&"onHideShow"!==e.eventType&&"onRepresentationLoaded"!==e.eventType||("@onWindowResized"===e.eventType||c.pointedReferences&&("onHideShow"===e.eventType||"onRepresentationLoaded"===e.eventType)?u||(u=setTimeout(M)):d._updateVisibility())))}}})}),define("DS/DMUPlayMarker/DMUMarker2DEllipseNode3D",["DS/SceneGraphNodes/BillBoardNode3D","DS/Visualization/ThreeJS_DS","DS/SceneGraphNodes/FixedSizeNode3D","DS/Visualization/SceneGraphFactory","DS/DMUBaseExperience/EXPToolsMaterial","DS/DMUBaseUI/DMUNode2D","DS/DMUPlayMarker/DMUMarkerTools"],function(e,t,i,r,n,o,a){"use strict";return o.extend({init:function(o){this._parent(o);var s,l,d=this,c={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}},p=new e({type:"Spherical"});this.addChild(p),p.setPickParent(!0);var h=new i({ratio:1});p.addChild(h),h.setPickParent(!0),this.removeDMUNode3DOverload=function(){d=s=l=p=h=null},this.updateScreenPosition=function(){c&&d.setMatrix((new t.Matrix4).setPosition(d.get3DPositionFromScreenCoordinates({coords:c.center,width:2*Math.max(c.xAxisLengthPx,c.yAxisLengthPx),anchor:"center",windowAnchor:c.windowAnchor,proportionalPosition:c.isPositionProportional})))},this.update=function(e){if(d){if(JSON.stringify(e)!==JSON.stringify(c)||c.isPositionProportional&&(c.screenWidth!==d.getViewer().SCREEN_WIDTH||c.screenHeight!==d.getViewer().SCREEN_HEIGHT)){var i=c.graphicProperties&&c.graphicProperties.fillStyle?JSON.stringify(c.graphicProperties.fillStyle):"",o=c.graphicProperties&&c.graphicProperties.lineStyle?JSON.stringify(c.graphicProperties.lineStyle):"";c=d.mergeParams(c,e),d.setName(c.name),c.screenWidth=d.getViewer().SCREEN_WIDTH,c.screenHeight=d.getViewer().SCREEN_HEIGHT,c.isPositionProportional?(c.xAxisLengthPx=d.convertProportionalCoordInPixels(c.xAxisLength,!0),c.yAxisLengthPx=d.convertProportionalCoordInPixels(c.yAxisLength,!0),c.CenterPx=d.convertCoordsInPixels({coords:c.center,windowAnchor:c.windowAnchor,fitOnX:!0})):(c.xAxisLengthPx=c.xAxisLength,c.yAxisLengthPx=c.yAxisLength,c.CenterPx=c.center),h.removeChildren();var p=new t.Matrix4;c.rotationAngle&&p.makeRotationAxis(new t.Vector3(0,0,1),c.rotationAngle);var u,g=a.getEllipseSpecs(c.xAxisLengthPx,c.yAxisLengthPx,1);c.isFilled&&(s&&JSON.stringify(c.graphicProperties.fillStyle)===i||(s=n.createBasicMaterial({color:c.graphicProperties.fillStyle.color,opacity:c.graphicProperties.fillStyle.opacity})),g.material=s,(u=r.createSimpleMeshNode(g)).setShadow(!1),u.setPickParent(!0),u.setMatrix(p),h.addChild(u)),c.hasBorder&&(l&&JSON.stringify(c.graphicProperties.lineStyle)===o||(l=n.createLineMaterial({color:c.graphicProperties.lineStyle.color,opacity:c.graphicProperties.lineStyle.opacity,lineWidth:c.graphicProperties.lineStyle.thickness*window.devicePixelRatio,pattern:c.graphicProperties.lineStyle.pattern})),(u=r.createLineNode({points:g.coordinates,material:l})).setShadow(!1),u.setPickParent(!0),u.setMatrix(p),h.addChild(u)),d.setVisibility(c.isVisible)}d.updateScreenPosition()}},this.onViewerEventCB=function(e){d&&"onSwapVisibleSpace"===e.eventType&&c&&d.setVisibility(c.isVisible)}}})}),define("DS/DMUPlayMarker/DMUMarker2DEllipse",["DS/DMUPlayMarker/DMUMarker2D","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker2DEllipseNode3D","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r){"use strict";var n=[{name:"vCenter",type:"Vector2",JSONname:"Properties2DEllipse.center",defaultValue:new t.Vector2},{name:"fxAxisLength",type:"float",JSONname:"Properties2DEllipse.xAxisLength",defaultValue:100},{name:"fyAxisLength",type:"float",JSONname:"Properties2DEllipse.yAxisLength",defaultValue:100}];return e.extend({init:function(e,t){this._parent(e,t),this.addParameters(n),this.setAttribute("sType","Marker2DEllipse");var o=this;this.setNode(new i({frmWindow:this._frmWindow,getType:this.getType})),this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar");var a=this.refreshNode;this.refreshNode=function(){o.getNode()&&!t.isImporting()&&(o.getNode().update({name:o.getAttribute("sName"),xAxisLength:o.getAttribute("fxAxisLength"),yAxisLength:o.getAttribute("fyAxisLength"),center:o.getAttribute("vCenter"),windowAnchor:o.getAttribute("sWindowAnchor"),inEdition:o.isInEdition(),isVisible:o.getAttribute("bVisible"),isFilled:o.getAttribute("bIsFilled"),hasBorder:o.getAttribute("bHasBorder"),isPositionProportional:o.getAttribute("bProportionalPosition"),rotationAngle:"number"==typeof o.getAttribute("fScreenRotationAngle")?o.getAttribute("fScreenRotationAngle"):o.getAttribute("fRotationAngle"),graphicProperties:{fillStyle:{color:o.getAttribute("cFillStyleColor"),opacity:o.getAttribute("fOpacity")},lineStyle:{pattern:o.getAttribute("sLineStylePattern"),thickness:r.getLineThickness(o.getAttribute("fLineStyleThicknessIndex"))||o.getAttribute("fLineStyleThickness"),color:o.getAttribute("cLineStyleColor"),opacity:o.getAttribute("fLineStyleOpacity")}}}),a())},this.getMaximumProportionalWidth=function(){var e=0;if(o.getAttribute("bProportionalPosition")){var t=o.getAttribute("vCenter"),i=o.getAttribute("fxAxisLength")/2;t&&i&&Math.abs(t.x-i)>e&&(e=Math.abs(t.x-i)),t&&i&&Math.abs(t.x)+i>e&&(e=Math.abs(t.x)+i)}return e}},setAttribute:function(e,t){!1!==t||"bHasBorder"!==e||this.getAttribute("bIsFilled")?!1!==t||"bIsFilled"!==e||this.getAttribute("bHasBorder")?"fxAxisLength"===e||"fyAxisLength"===e?t>0&&this._parent(e,t):this._parent(e,t):(this.setAttribute("bHasBorder",!0),this._parent(e,t)):(this.setAttribute("bIsFilled",!0),this._parent(e,t))},getAttribute:function(e){return"vCenter"===e?this._parent("vCenter").clone():this._parent(e)}})}),define("DS/DMUPlayMarker/DMUCommentHighlightNode",["require","exports","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/DMUPlayMarker/DMUMarkerTools","DS/DMUBaseUI/DMUToolsUsers","DS/DMUBaseUI/DMUManipulableNode3D"],function(e,t,i,r,n,o,a,s){"use strict";return class extends s{constructor(e){super(e);let t,s,l=this,d=l.getViewer(),c=new i;c.setPickParent(!0),this.addChild(c),this.update=function(e){if(!l)return;t||(t={});let i={paramA:t,paramB:e,merge:!0,mergedKeys:[]};if(!o.compareAndMergeParams(i)){let e;if(l.setName(t.name),t.selection)if(s){let i=c.getChildren();for(let n=0;n<t.selection.length;n++)e=(new r.Matrix4).makeRotationZ(t.selection[n].rotationAngle),i[n].setMatrix((new r.Matrix4).setPosition(t.selection[n].position).multiply(e))}else{s=new r.MeshBasicMaterial({force:!0,side:r.FrontSide,transparent:!0,color:a.getUserColor(t.owner),opacity:t.isExternal?0:.3});for(let i=0;i<t.selection.length;i++){let o=n.createRectangleNode({width:t.selection[i].width,height:-t.selection[i].height,fill:!0,noEdge:!0,material:s});e=(new r.Matrix4).makeRotationZ(t.selection[i].rotationAngle),o.setShadow(!1),o.setPickParent(!0),o.setMatrix((new r.Matrix4).setPosition(t.selection[i].position).multiply(e)),c.addChild(o)}}!function(){if(!t)return;let e=o.is3DMarkerDisplayed(d);l.setVisibility(t.isVisible&&e),d.render()}()}};let p=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){s&&s.dispose(),l.removeChildren(),s=t=null,p()}}}}),define("DS/DMUPlayMarker/DMUCommentHighlight",["require","exports","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUCommentAnnotationBase","DS/DMUPlayMarker/DMUCommentHighlightNode","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r,n,o){"use strict";let a=[{name:"oSelection",type:"objectDefinition",JSONname:"PropertiesCommentHighlight.Selection"}];return class extends r{constructor(e,t,r){super(e,t),this.addParameters(a);let s=this,l=r;this.setAttribute("sType","CommentHighlight"),this.setNode(new n({frmWindow:this._frmWindow,getType:this.getType})),this.isExternal=function(){return Boolean(l)},this.getSelection=function(){let e=s.getAttribute("oSelection"),t=[];if(e){let r=o.getAbsoluteRotation(s,0);e.forEach(function(e){e.rects.forEach(function(n){t.push({position:o.getAbsolutePosition(s,null,new i.Vector3(n.position.x,n.position.y,0),void 0,e.page||e.element),width:n.width,height:n.height,rotationAngle:r})})})}return t};let d=this.refreshNode;this.refreshNode=function(){if(s.getNode()&&(!t||!t.isImporting())){let e=s.getAttribute("vPosition");s.getNode().update({name:s.getAttribute("sName"),owner:s.getOwner(),pointedPage:s.getAttribute("fPointedPageNumber"),position:o.getAbsolutePosition(s,null,new i.Vector3(e.x,e.y,0)),selection:s.getSelection(),inEdition:s.isInEdition(),isVisible:!s.hasAlertFlag(),isExternal:s.isExternal()}),d()}}}}}),define("DS/DMUPlayMarker/DMUMarker3DEllipseNode3D",["require","exports","DS/SceneGraphNodes/BillBoardNode3D","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/DMUBaseExperience/EXPToolsMaterial","DS/DMUPlayMarker/DMUMarkerTools","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUBaseUI/DMUManipulableNode3D"],function(e,t,i,r,n,o,a,s,l,d){"use strict";return class extends d{constructor(e){super(e);let t,d,c,p,h=this,u=h.getViewer(),g=1,P=new i({type:"Spherical"});this.addChild(P),P.setPickParent(!0);let f,y=new n;P.addChild(y),y.setPickParent(!0),this.linkManipulatorToNode(y),this.getRepNode=function(){return P},this.updateRepresentation=function(e,i){if(!p)return;let n=new r.Vector3(p.xAxisLength?Math.abs(e.width)/p.xAxisLength:1,p.yAxisLength?Math.abs(e.height)/p.yAxisLength:1,1),o=(new r.Matrix4).makeRotationZ(e.rotation).scale(n);y.setMatrix((new r.Matrix4).multiply(o)),h.setMatrix((new r.Matrix4).setPosition(e.position)),t&&d&&(t.setOpacity((p.graphicProperties.fillStyle.opacity||0)*(i?.6:1)),d.setOpacity((p.graphicProperties.lineStyle.opacity||0)*(i?.6:1)))},this.getBoundingBoxDimensions=function(){return p?{position:p.center,height:p.yAxisLength,width:p.xAxisLength,rotation:p.rotationAngle,lineWidth:p.hasBorder?p.graphicProperties.lineStyle.thickness:0,pointedPage:p.pointedPage}:{}};let D=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){D(),f&&clearTimeout(f),f=null,d&&d.dispose(),t&&t.dispose(),t=d=P=y=null},this._updateVisibility=function(e){if(!p)return;void 0!==e&&(g=e);let t=s.is3DMarkerDisplayed(u,p.pointedReferences);h.setVisibility(g>0&&p.isVisible&&t),u.render()},this.update=function(e){if(!h)return;p||(p={graphicProperties:{fillStyle:{},lineStyle:{}}});let i=!1,n=[],u={paramA:p,paramB:e,merge:!0,mergedKeys:n};if(!s.compareAndMergeParams(u)){let e=this.getRepManipulator();if(e&&e.deactivate(),h.setName(p.name),(!c||n.includes("center")||n.includes("xAxisLength")||n.includes("yAxisLength"))&&(i=!0,c=s.getEllipseSpecs((p.xAxisLength||0)/2,(p.yAxisLength||0)/2,l.getMMPerPixelRatio(h.getViewer(),p.center))),t?n.includes("fillStyle")&&(t.color=p.graphicProperties.fillStyle.color,t.setOpacity(p.graphicProperties.fillStyle.opacity)):(i=!0,t=a.createBasicMaterial({color:p.graphicProperties.fillStyle.color,opacity:p.graphicProperties.fillStyle.opacity})),d?n.includes("lineStyle")&&(d.color=p.graphicProperties.lineStyle.color,d.setOpacity(p.graphicProperties.lineStyle.opacity),d.setLineWidth((p.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio),d.setDashPatternType(a.getDashType(p.graphicProperties.lineStyle.pattern))):(i=!0,d=a.createLineMaterial({color:p.graphicProperties.lineStyle.color,opacity:p.graphicProperties.lineStyle.opacity,lineWidth:(p.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio,pattern:p.graphicProperties.lineStyle.pattern})),(n.includes("isFilled")||n.includes("hasBorder"))&&(i=!0),i){if(y.removeChildren(),p.isFilled){c.material=t;let e=o.createSimpleMeshNode(c);e.setShadow(!1),e.setPickParent(!0),y.addChild(e)}if(p.hasBorder){let e=o.createLineNode({points:c.coordinates,material:d});e.setShadow(!1),e.setPickParent(!0),y.addChild(e)}}y.setMatrix((new r.Matrix4).makeRotationZ(p.rotationAngle)),h.setMatrix((new r.Matrix4).setPosition(p.center)),e&&e.activate(),h._updateVisibility()}};let S=function(){h&&h._updateVisibility(),f=null};this.onViewerEventCB=function(e){h&&p&&(f||!p.pointedReferences||"onHideShow"!==e.eventType&&"onRepresentationLoaded"!==e.eventType||(f=setTimeout(S)))}}}}),define("DS/DMUPlayMarker/DMUMarker3DRectangleNode3D",["require","exports","DS/DMUBaseExperience/EXPToolsMaterial","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/SceneGraphNodes/BillBoardNode3D","DS/DMUPlayMarker/DMUMarkerTools","DS/DMUBaseUI/DMUManipulableNode3D"],function(e,t,i,r,n,o,a,s,l){"use strict";return class extends l{constructor(e){super(e);let t=this,l=1,d=new a({position:new n.Vector3,type:"Spherical"});d.setPickParent(!0),this.addChild(d);let c,p,h,u=t.getViewer(),g=new r;d.addChild(g),g.setPickParent(!0),this.linkManipulatorToNode(g),this.getRepNode=function(){return d},this.updateRepresentation=function(e,i){if(!c)return;let r=new n.Vector3(c.width?Math.abs(e.width)/c.width:1,c.height?Math.abs(e.height)/c.height:1,1),o=(new n.Matrix4).makeRotationZ(e.rotation).scale(r),a=new n.Vector3(-(c.width||0)/2,-(c.height||0)/2,0).applyMatrix4(o);g.setMatrix((new n.Matrix4).setPosition(a).multiply(o)),t.setMatrix((new n.Matrix4).setPosition(e.position)),p&&p.line&&(p.setOpacity((c.graphicProperties.fillStyle.opacity||0)*(i?.6:1)),p.line.setOpacity((c.graphicProperties.lineStyle.opacity||0)*(i?.6:1)))},this.getBoundingBoxDimensions=function(){return c?{position:c.position,height:c.height,width:c.width,rotation:c.rotationAngle,pointedPage:c.pointedPage}:{}};let P=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){P(),h&&clearTimeout(h),h=null,p&&p.dispose(),d=g=p=c=null},this._updateVisibility=function(e){if(!c)return;void 0!==e&&(l=e);let i=s.is3DMarkerDisplayed(u,c.pointedReferences);t.setVisibility(l>0&&c.isVisible&&i),u.render()},this.update=function(e){if(!t)return;c||(c={graphicProperties:{fillStyle:{},lineStyle:{}}});let r=!1,a=[],l={paramA:c,paramB:e,merge:!0,mergedKeys:a};if(!s.compareAndMergeParams(l)){let e=this.getRepManipulator();if(e&&e.deactivate(),t.setName(c.name),p?(a.includes("fillStyle")&&(p.color=c.graphicProperties.fillStyle.color,p.setOpacity(c.graphicProperties.fillStyle.opacity)),a.includes("lineStyle")&&(p.line.color=c.graphicProperties.lineStyle.color,p.line.setOpacity(c.graphicProperties.lineStyle.opacity),p.line.setLineWidth((c.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio),p.line.setDashPatternType(i.getDashType(c.graphicProperties.lineStyle.pattern)))):(r=!0,(p=i.createBasicMaterial({color:c.graphicProperties.fillStyle.color,opacity:c.graphicProperties.fillStyle.opacity})).line=i.createLineMaterial({color:c.graphicProperties.lineStyle.color,opacity:c.graphicProperties.lineStyle.opacity,lineWidth:(c.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio,pattern:c.graphicProperties.lineStyle.pattern})),(a.includes("width")||a.includes("height")||a.includes("isFilled")||a.includes("hasBorder"))&&(r=!0),r){g.removeChildren();let e=o.createRectangleNode({width:c.width,height:c.height,fill:c.isFilled,noEdge:!c.hasBorder,material:p});e.setShadow(!1),e.setPickParent(!0),g.addChild(e)}if(a.includes("width")||a.includes("height")||a.includes("rotationAngle")){let e=(new n.Matrix4).makeRotationZ(c.rotationAngle),t=new n.Vector3(-(c.width||0)/2,-(c.height||0)/2,0).applyMatrix4(e);"topleft"===c.anchor&&t.add(new n.Vector3((c.width||0)/2,-(c.height||0)/2,0)),g.setMatrix((new n.Matrix4).setPosition(t).multiply(e))}t.setMatrix((new n.Matrix4).setPosition(c.position)),e&&e.activate()}t._updateVisibility()};let f=function(){t._updateVisibility(),h=null};this.onViewerEventCB=function(e){t&&c&&(h||!c.pointedReferences||"onHideShow"!==e.eventType&&"onRepresentationLoaded"!==e.eventType||(h=setTimeout(f)))}}}}),define("DS/DMUPlayMarker/DMUMarker3DStampNode3D",["DS/Visualization/Node3D","DS/DMUBaseUI/DMUManipulableNode3D","DS/Visualization/ThreeJS_DS","DS/DMUBaseUI/DMUToolsLeader","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUPlayMarker/DMUMarkerTools","DS/DMUMarkerVisu/DMUMarkerVisuStampShapeNode","DS/DMUBaseUI/DMUToolsUsers"],function(e,t,i,r,n,o,a,s,l){"use strict";return t.extend({init:function(t){var d=t||{};let c;this._parent(d),this._getExcludeFromCSO=function(){return!0};var p,h=this,u=h.getViewer(),g=1;let P=!1,f=!1;var y={horizontalAlignement:"topLeft"};if(d.defaultGraphicProps)for(var D=Object.keys(d.defaultGraphicProps),S=0;S<D.length;S++)y[D[S]]=d.defaultGraphicProps[D[S]];var m=new s({window:d.frmWindow,data:{mkvShape:d.mkvShape,graphicProperties:y},onStartContentEditionCB:d.onStartContentEditionCB,onEndContentEditionCB:d.onEndContentEditionCB,onContentModifiedCB:d.onContentModifiedCB});this.addChild(m),m.setPickParent(!0);var M=new e;function b(){if(M&&p){let e=!P&&!f&&p.hasALeader;M.setVisibility(e),M.setVisibilityFree(!e)}}function v(t,s,l){if(b(),p.hasALeader){var c=0;switch(p.leaderEndType){case"Arrow":c=1;break;case"Bubble":c=2;break;case"Cross":c=4;break;case"Square":c=3}var h=m.getDimensions();if(h.offsetWidth>0&&h.offsetHeight>0){var g,P,f=t.clone(),y={offsetWidth:n.convertModelToPixels({sizeInMM:h.offsetWidth,viewer:u,coords:p.zoomMode?f:null}),offsetHeight:n.convertModelToPixels({sizeInMM:h.offsetHeight,viewer:u,coords:p.zoomMode?f:null}),rotationAngle:l};if(y.offsetWidth/=window.devicePixelRatio,y.offsetHeight/=window.devicePixelRatio,"topleft"===p.anchorMode)if(p.zoomMode){var D=u.currentViewpoint.getUpDirection().clone(),S=(new i.Vector3).crossVectors(u.currentViewpoint.getSightDirection(),D).setLength(h.offsetWidth/2);D.setLength(-h.offsetHeight/2),f.add(D),f.add(S)}else{var v=n.getViewerPositionFromPoint(u,f);if(v&&!isNaN(v.left)&&!isNaN(v.top)&&v.right-v.left!=0){var A=new i.Vector2(v.left+y.offsetWidth/2,v.top+y.offsetHeight/2),x=n.getLineFromWindowPosition(u,A.x,A.y),w=n.getViewpointInfo(u.currentViewpoint),k=o.computeLinePlaneDistance(x.position.toArray(),x.direction.toArray(),t.toArray(),w.sight.toArray());f=new i.Vector3(k.aPosition[0],k.aPosition[1],k.aPosition[2])}}if(s&&s.length){var N=[];if(1===u.getVisibleSpace()&&p.pointedReferences&&p.pointedReferences.length){var U=a.getPointedReferencesVisibilityStates(u,p.pointedReferences);for(P=U.length-1;P>=0;P--)U[P]&&N.push(s[P])}else N=s.slice();var C=M.getChildren();for(P=0;P<N.length;P++){(g=C[P])||((g=new e("DMUMarkerLeaderNode")).setPickParent(!0),M.addChild(g));var T={width:p.leaderAttachWidthRatio,height:p.leaderAttachLengthRatio};r.modifyLeaderNode(u,g,!0,f,N[P],T,p.graphicProperties.leaderStyle.thickness*window.devicePixelRatio,p.graphicProperties.leaderStyle.color,p.graphicProperties.leaderStyle.pattern,c,y,d.frmWindow)}if(C=M.getChildren(),N.length<C.length)for(P=C.length-1;P>=N.length;P--)C[P].isManipulator||M.removeChild(C[P])}}}}this.addChild(M),M.setPickParent(!0),this.linkManipulatorToNode(m.getBackNode()),this.getRepNode=function(){return{leader:M,box:m.getLabelNode()}},this.hasTessellatedRepresentation=function(){return!1},this.getLabelDimensions=function(){var e=m.getDimensions();return e.position=p.position,e},this.updateRepresentation=function(e,t){m.setTransformation({rotationAngle:e.rotationAngle}),m.setMatrix((new i.Matrix4).setPosition(e.position)),v(e.position,e.leaderPoints,e.rotationAngle),m.setGhostMode(t)},this.getLabelParams=function(){var e=m.getDimensions(),t={};return t.leaderPoints=p.pointingPoints.slice(),t.position=p.position,t.anchorMode=p.anchorMode,t.rotationAngle=p.boxRotationAngle?p.boxRotationAngle:0,t.width=e.width,t.height=e.height,t};var A=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){A(),c&&clearTimeout(c),c=null,m&&m.remove(),m=M=h=p=null},this.getPixelFontSize=function(e){var t,i=e||p;return i.graphicProperties.fontStyle.pxheight&&(t=n.convertPixelToModel({sizeInPixels:i.graphicProperties.fontStyle.pxheight,viewer:h.getViewer()})),t||(t=i.graphicProperties.fontStyle.fontSize),n.convertModelToPixels({sizeInMM:t,viewer:h.getViewer()})},this.startEdition=function(){m.startEdition(h)},this._updateVisibility=function(e,t){if(p){void 0!==e&&(g=e);var i=p.isVisible&&a.is3DMarkerDisplayed(u,p.pointedReferences)&&g>0;h.setVisibility(i),0!==g&&m.setOpacity(g),(0===u.getVisibleSpace()&&!i||1===u.getVisibleSpace()&&i)&&(t&&g<1?(P=!0,b()):(P=!1,v(p.position,p.pointingPoints,p.boxRotationAngle))),u.render()}},this.update=function(e){if(h){p||(p={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}}),e.graphicProperties.fontStyle.height=h.getPixelFontSize(e);var t=[],i={paramA:p,paramB:e,merge:!0,mergedKeys:t};if(!a.compareAndMergeParams(i)){var r=h.getRepManipulator();r&&r.deactivate(),h.setName(p.name),l.getUserName(p.owner,function(e){p.userDate=[e||p.owner,l.formatDate(p.creationDate)],m.modify(p)}),t.includes("textComment")||m.stopEdition(),r&&r.activate(),h._updateVisibility()}}};let x=function(){h&&h._updateVisibility(),c=null};this.onViewerEventCB=function(e){h&&e&&("onDMUSlideStartDisplay"!==e.eventType&&"onDMUSlideDisplayed"!==e.eventType||(f="onDMUSlideStartDisplay"===e.eventType,b()),!p||"@onViewpointChange"!==e.eventType&&"onSwapVisibleSpace"!==e.eventType&&"onHideShow"!==e.eventType&&"onRepresentationLoaded"!==e.eventType||(m.stopEdition(),("onSwapVisibleSpace"===e.eventType||"@onWindowResized"===e.eventType||p.pointedReferences&&("onHideShow"===e.eventType||"onRepresentationLoaded"===e.eventType))&&("@onWindowResized"===e.eventType||"onHideShow"===e.eventType||"onRepresentationLoaded"===e.eventType?c||(c=setTimeout(x)):h._updateVisibility())))}}})}),define("DS/DMUPlayMarker/DMUMarker3DStamp",["DS/DMUPlayMarker/DMUMarker3DText","DS/DMUPlayMarker/DMUMarker3DStampNode3D","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i){"use strict";var r=[{name:"sStampType",type:"string",JSONname:"Properties3DStamp.StampType"},{name:"sOwner",type:"string",JSONname:"Properties3DStamp.Owner"},{name:"lTextComment",type:"listStrings",JSONname:"Properties3DStamp.TextComment",defaultValue:[""]},{name:"fCreationDate",type:"float",JSONname:"Properties3DStamp.CreationDate"}];return e.extend({init:function(e,n){var o=this;this._parent(e,n,{type:"Marker3DStamp",nodeClass:t,onContentModifiedCB:function(e){if(e.text!==o.getAttribute("lTextComment")){e.text&&0!==e.text.length||(e.text=[""]);var t,i=e.text,r=!0;for(t=0;t<i.length;t++)if(i[t]){r=!1;break}if(r)for(t=0;t<i.length;t++)i[t]=" ";o.setAttribute("lTextComment",i),o.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:o})}}}),this.addParameters(r),this.refreshNode=function(){o.getNode()&&!n.isImporting()&&o.getNode().update({stampType:o.getAttribute("sStampType"),owner:o.getAttribute("sOwner"),textComment:o.getAttribute("lTextComment"),creationDate:o.getAttribute("fCreationDate"),name:o.getAttribute("sName"),pointedReferences:o.getAttribute("lPointedReferences"),isVisible:o.getAttribute("bVisible"),content:o.getAttribute("sTextContents"),tessRep:o.getAttribute("sTextGraphicRepresentation"),position:i.getAbsolutePosition(o,o.getAttribute("vRelativePosition"),o.getAttribute("vLeaderBreakPoint3D"),o.getAttribute("sPositionalReference")),pointingPoints:o.getPointingPoints(),anchorMode:o.getAttribute("sAnchorMode"),hasALeader:o.getAttribute("bHasALeader"),markerImage:o.getImageToDisplay(),imageWidth:o.getAttribute("fImageWidth"),imageHeight:o.getAttribute("fImageHeight"),boxWidth:o.getAttribute("fTextBoxWidth"),boxHeight:o.getAttribute("fTextBoxLength"),leaderEndType:o.getAttribute("sLeaderEndType"),isFilled:o.getAttribute("bIsFilled"),hasBorder:o.getAttribute("bHasBorder"),leaderAttachWidthRatio:o.getAttribute("fLeaderAttachWidthRatio"),leaderAttachLengthRatio:o.getAttribute("fLeaderAttachLengthRatio"),boxRotationAngle:o.getAttribute("fBoxRotationAngle"),inEdition:o.isInEdition(),graphicProperties:{borderRadius:o.getAttribute("fBorderRadius"),fontStyle:{fontSize:o.getAttribute("fFontSize"),familyName:o.getAttribute("sFontName"),familyStyle:o.getAttribute("sFontStyle"),color:o.getAttribute("cFontColor")},fillStyle:{color:o.getAttribute("cFillStyleColor"),opacity:o.getAttribute("fOpacity"),gradient:o.getAttribute("oGradient")},lineStyle:{thickness:i.getLineThickness(o.getAttribute("fLineStyleThicknessIndex"))||o.getAttribute("fLineStyleThickness"),pattern:o.getAttribute("sLineStylePattern"),color:o.getAttribute("cLineStyleColor")},leaderStyle:{thickness:i.getLineThickness(o.getAttribute("fLeaderStyleThicknessIndex"))||o.getAttribute("fLeaderStyleThickness"),pattern:o.getAttribute("sLeaderStylePattern"),color:o.getAttribute("cLeaderStyleColor")}}})},this.setListOfReadOnlyAttributes(["cFillStyleColor","fOpacity","oGradient","fLineStyleThickness","fLineStyleThicknessIndex","fLeaderStyleThickness","fLeaderStyleThicknessIndex","sLeaderStylePattern","sLineStylePattern","cLineStyleColor","cLeaderStyleColor","bIsFilled","bHasBorder"])}})}),define("DS/DMUPlayMarker/DMUMarker3DSplineNode3D",["require","exports","DS/DMUBaseExperience/EXPToolsMaterial","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/SceneGraphNodes/BillBoardNode3D","DS/DMUPlayMarker/DMUMarkerTools","DS/DMUBaseUI/DMUManipulableNode3D"],function(e,t,i,r,n,o,a,s,l){"use strict";return class extends l{constructor(e){super(e);let t,l,d,c,p,h,u,g=this,P=g.getViewer(),f=1,y=new a({type:"Spherical"});y.setPickParent(!0),this.addChild(y);let D=new r;y.addChild(D),D.setPickParent(!0),this.linkManipulatorToNode(D),this.updateRepresentation=function(e,i){if(!t)return;let r=new n.Vector3(p?Math.abs(e.width)/p:1,c?Math.abs(e.height)/c:1,1),o=(new n.Matrix4).makeRotationZ(e.rotation).scale(r);D.setMatrix((new n.Matrix4).multiply(o)),g.setMatrix((new n.Matrix4).setPosition(e.position)),l&&l.setOpacity((t.graphicProperties.lineStyle.opacity||0)*(i?.6:1))},this.getRepNode=function(){return y},this.getBoundingBoxDimensions=function(){return{position:h,height:c||0,width:p||0,rotation:t&&t.rotationAngle||0,pointedPage:t?t.pointedPage:void 0}};let S=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){S(),u&&clearTimeout(u),u=null,l&&l.dispose(),y=D=t=l=null,c=p=null},this._updateVisibility=function(e){if(!t)return;void 0!==e&&(f=e);let i=s.is3DMarkerDisplayed(P,t.pointedReferences);g.setVisibility(f>0&&t.isVisible&&i),P.render()},this.update=function(e){if(!g)return;t||(t={graphicProperties:{lineStyle:{}}});let r=!1,a=[],u={paramA:t,paramB:e,merge:!0,mergedKeys:a};if(!s.compareAndMergeParams(u)){let e=this.getRepManipulator();if(e&&e.deactivate(),g.setName(t.name),d&&!a.includes("points")||(r=!0,d=function(e,t){if(!e||!e.length||!t)return;let i=t.up,r=t.right,o=(new n.Vector3).crossVectors(r,i),a=[];e.forEach(function(e){a.push(new n.Vector3(e[0],e[1],e[2]))});let s=new n.SplineCurve3(a).getPoints(200),l=-1/0,d=1/0,u=-1/0,g=1/0,P=-1/0,f=1/0;s.forEach(function(e){l=Math.max(l,e.dot(r)),d=Math.min(d,e.dot(r)),u=Math.max(u,e.dot(i)),g=Math.min(g,e.dot(i)),P=Math.max(P,e.dot(o)),f=Math.min(f,e.dot(o))});let y=new n.Vector3(d,u,P),D=new n.Vector3(l,g,f);(h=(new n.Vector3).addVectors(y,D).multiplyScalar(.5)).applyMatrix4((new n.Matrix4).makeBasis(r,i,o)),c=u-g,p=l-d;let S=[];return s.forEach(function(e){let t=e.clone().sub(h);S.push(new n.Vector3(t.dot(r),t.dot(i),0))}),S}(t.points,t.projectionPlaneVectors)),l?a.includes("lineStyle")&&(l.color=t.graphicProperties.lineStyle.color,l.setOpacity(t.graphicProperties.lineStyle.opacity),l.setLineWidth((t.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio),l.setDashPatternType(i.getDashType(t.graphicProperties.lineStyle.pattern))):(r=!0,l=i.createLineMaterial({color:t.graphicProperties.lineStyle.color,opacity:t.graphicProperties.lineStyle.opacity,lineWidth:(t.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio,pattern:t.graphicProperties.lineStyle.pattern})),r&&d&&d.length>1){D.removeChildren();let e=o.createLineNode({points:d,material:l});e.setShadow(!1),e.setPickParent(!0),D.addChild(e)}(r||a.includes("rotationAngle"))&&D.setMatrix((new n.Matrix4).makeRotationZ(t.rotationAngle)),h&&g.setMatrix((new n.Matrix4).setPosition(h)),e&&e.activate(),g._updateVisibility()}};let m=function(){g&&g._updateVisibility(),u=null};this.onViewerEventCB=function(e){g&&t&&(u||!t.pointedReferences||"onHideShow"!==e.eventType&&"onRepresentationLoaded"!==e.eventType||(u=setTimeout(m)))}}}}),define("DS/DMUPlayMarker/DMUMarker2DArrowNode3D",["DS/Visualization/ThreeJS_DS","DS/SceneGraphNodes/BillBoardNode3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/Visualization/SceneGraphFactory","DS/DMUBaseExperience/EXPToolsMaterial","DS/DMUBaseUI/DMUNode2D","DS/DMUPlayMarker/DMUMarkerTools"],function(e,t,i,r,n,o,a){"use strict";return o.extend({init:function(o){this._parent(o);var s,l,d=this,c={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}},p=new t({type:"Spherical"});this.addChild(p),p.setPickParent(!0);var h,u=new i({ratio:1});p.addChild(u),u.setPickParent(!0),this.removeDMUNode3DOverload=function(){d=s=p=u=null},this.updateScreenPosition=function(){c&&h&&d.setMatrix((new e.Matrix4).setPosition(d.get3DPositionFromScreenCoordinates({coords:h,width:c.fullWidthPx,anchor:"center",windowAnchor:c.windowAnchor,proportionalPosition:c.isPositionProportional})))},this.update=function(t){if(d){if(JSON.stringify(t)!==JSON.stringify(c)||c.isPositionProportional&&(c.screenWidth!==d.getViewer().SCREEN_WIDTH||c.screenHeight!==d.getViewer().SCREEN_HEIGHT)){var i=c.graphicProperties&&c.graphicProperties.fillStyle?JSON.stringify(c.graphicProperties.fillStyle):"",o=c.graphicProperties&&c.graphicProperties.lineStyle?JSON.stringify(c.graphicProperties.lineStyle):"";c=d.mergeParams(c,t),d.setName(c.name),c.screenWidth=d.getViewer().SCREEN_WIDTH,c.screenHeight=d.getViewer().SCREEN_HEIGHT,h=(new e.Vector2).copy(c.firstPoint).add(c.secondPoint).multiplyScalar(.5);var p=(new e.Vector2).copy(c.firstPoint),g=(new e.Vector2).copy(c.secondPoint),P=c.bentPoint?(new e.Vector2).copy(c.bentPoint):null;c.isPositionProportional?(c.firstPointPx=d.convertCoordsInPixels({coords:p,windowAnchor:c.windowAnchor,fitOnX:!0}),c.secondPointPx=d.convertCoordsInPixels({coords:g,windowAnchor:c.windowAnchor,fitOnX:!0}),c.widthPx=d.convertProportionalCoordInPixels(c.width,!0),P&&(c.bentPointPx=d.convertCoordsInPixels({coords:P,windowAnchor:c.windowAnchor,fitOnX:!0})),c.endwidth&&(c.endwidthPx=d.convertProportionalCoordInPixels(c.endwidth,!0))):(c.firstPointPx=p.clone(),c.secondPointPx=g.clone(),c.widthPx=c.width,P&&(c.bentPointPx=P.clone()),c.endwidth&&(c.endwidthPx=c.endwidth));var f=Math.max(c.firstPointPx.x,c.secondPointPx.x),y=Math.min(c.firstPointPx.x,c.secondPointPx.x);c.bentPointPx&&(f=Math.max(f,c.bentPointPx.x),y=Math.min(y,c.bentPointPx.x)),c.fullWidthPx=f-y+c.widthPx;var D,S,m,M=c.secondPointPx.clone().sub(c.firstPointPx.clone()),b=(new e.Matrix4).makeTranslation(-M.x/2,M.y/2,0);if(c.bentPointPx){var v=c.bentPointPx.clone().sub(c.firstPointPx.clone()).length()+c.endwidthPx/2,A=c.bentPointPx.clone().sub(c.secondPointPx.clone()).length()+c.widthPx/2;b.multiply((new e.Matrix4).makeTranslation(c.widthPx/2-A/2,-v/2,0)),c.rotationAngle&&b.multiply((new e.Matrix4).makeRotationAxis(new e.Vector3(0,0,1),c.rotationAngle)),S=a.getBentArrowSpecs(c.widthPx,c.endwidthPx,v,A,c.shaftRatio,c.headRatio,c.style)}else(D=Math.atan2(M.y,M.x))<0&&(D+=2*Math.PI),D=2*Math.PI-D,b.multiply((new e.Matrix4).makeRotationAxis(new e.Vector3(0,0,1),D)),S=a.getArrowSpecs(c.widthPx,M.length(),c.shaftRatio,c.headRatio,c.style);u.removeChildren(),c.isFilled&&(s&&JSON.stringify(c.graphicProperties.fillStyle)===i||(s=n.createBasicMaterial({color:c.graphicProperties.fillStyle.color,opacity:c.graphicProperties.fillStyle.opacity})),S.material=s,(m=r.createSimpleMeshNode(S)).setShadow(!1),m.setPickParent(!0),m.setMatrix(b),u.addChild(m)),c.hasBorder&&(l&&JSON.stringify(c.graphicProperties.lineStyle)===o||(l=n.createLineMaterial({color:c.graphicProperties.lineStyle.color,opacity:c.graphicProperties.lineStyle.opacity,lineWidth:c.graphicProperties.lineStyle.thickness*window.devicePixelRatio,pattern:c.graphicProperties.lineStyle.pattern})),(m=r.createLineNode({points:S.coordinates,material:l})).setShadow(!1),m.setPickParent(!0),m.setMatrix(b),u.addChild(m)),d.setVisibility(c.isVisible)}d.updateScreenPosition()}},this.onViewerEventCB=function(e){d&&"onSwapVisibleSpace"===e.eventType&&c&&d.setVisibility(c.isVisible)}}})}),define("DS/DMUPlayMarker/DMUMarker2DArrow",["DS/DMUPlayMarker/DMUMarker2D","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker2DArrowNode3D","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r){"use strict";var n=[{name:"vFirstPoint",type:"Vector2",JSONname:"Properties2DArrow.FirstPoint",defaultValue:new t.Vector2},{name:"vSecondPoint",type:"Vector2",JSONname:"Properties2DArrow.SecondPoint",defaultValue:new t.Vector2(10,0)},{name:"fWidth",type:"float",JSONname:"Properties2DArrow.Width",defaultValue:1},{name:"sStyle",type:"string",JSONname:"Properties2DArrow.Style",defaultValue:"beginSide"},{name:"fShaftRatio",type:"float",JSONname:"Properties2DArrow.ShaftRatio",defaultValue:.8},{name:"fHeadRatio",type:"float",JSONname:"Properties2DArrow.HeadRatio",defaultValue:.5},{name:"vBentPoint",type:"Vector2",JSONname:"Properties2DArrow.BentPoint"},{name:"fEndWidth",type:"float",JSONname:"Properties2DArrow.EndWidth"}];return e.extend({init:function(e,t){this._parent(e,t),this.addParameters(n),this.setAttribute("sType","Marker2DArrow");var o=this;this.setNode(new i({frmWindow:this._frmWindow,getType:this.getType})),this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar");var a=this.refreshNode;this.refreshNode=function(){o.getNode()&&!t.isImporting()&&(o.getNode().update({name:o.getAttribute("sName"),firstPoint:o.getAttribute("vFirstPoint"),secondPoint:o.getAttribute("vSecondPoint"),bentPoint:o.getAttribute("vBentPoint"),windowAnchor:o.getAttribute("sWindowAnchor"),width:o.getAttribute("fWidth"),endwidth:o.getAttribute("fEndWidth"),style:o.getAttribute("sStyle"),shaftRatio:o.getAttribute("fShaftRatio"),headRatio:o.getAttribute("fHeadRatio"),inEdition:o.isInEdition(),isVisible:o.getAttribute("bVisible"),isFilled:o.getAttribute("bIsFilled"),hasBorder:o.getAttribute("bHasBorder"),isPositionProportional:o.getAttribute("bProportionalPosition"),rotationAngle:"number"==typeof o.getAttribute("fScreenRotationAngle")?o.getAttribute("fScreenRotationAngle"):o.getAttribute("fRotationAngle"),graphicProperties:{fillStyle:{color:o.getAttribute("cFillStyleColor"),opacity:o.getAttribute("fOpacity")},lineStyle:{pattern:o.getAttribute("sLineStylePattern"),thickness:r.getLineThickness(o.getAttribute("fLineStyleThicknessIndex"))||o.getAttribute("fLineStyleThickness"),color:o.getAttribute("cLineStyleColor"),opacity:o.getAttribute("fLineStyleOpacity")}}}),a())},this.getMaximumProportionalWidth=function(){var e=0;if(o.getAttribute("bProportionalPosition")){var t=o.getAttribute("vFirstPoint");t&&Math.abs(t.x)>e&&(e=Math.abs(t.x)),(t=o.getAttribute("vSecondPoint"))&&Math.abs(t.x)>e&&(e=Math.abs(t.x)),(t=o.getAttribute("vBentPoint"))&&Math.abs(t.x)>e&&(e=Math.abs(t.x))}return e}},setAttribute:function(e,t){!1!==t||"bHasBorder"!==e||this.getAttribute("bIsFilled")?!1!==t||"bIsFilled"!==e||this.getAttribute("bHasBorder")?this._parent(e,t):(this.setAttribute("bHasBorder",!0),this._parent(e,t)):(this.setAttribute("bIsFilled",!0),this._parent(e,t))},getAttribute:function(e){return"vFirstPoint"===e||"vSecondPoint"===e?this._parent(e).clone():this._parent(e)}})}),define("DS/DMUPlayMarker/DMUMarker3DPicture",["DS/DMUPlayMarker/DMUMarker3DText","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUPlayMarker/DMUMarker3DPictureNode3D","DS/DMUBaseUI/DMUToolsUsers","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r,n){"use strict";var o=[{name:"bShortDisplay",type:"bool",JSONname:"Properties3DPicture.Shortdisplay",defaultValue:!1},{name:"fCreationDate",type:"float",JSONname:"Properties3DPicture.CreationDate",defaultValue:null},{name:"sRelatedObjectId",type:"string",JSONname:"Properties3DPicture.PointedObjectId",defaultValue:null}];return e.extend({init:function(e,a){this._parent(e,a,{type:"Marker3DPicture",ctxBar:"DS/DMUMarker/DMUMarkerPictureContextualBar",nodeClass:i}),this.addParameters(o);var s=this,l={},d=this.updateModel;this.updateModel=function(e){d(e);var i=s.getAttribute("bZoomMode");s.setAttributes([{name:"fImageWidth",value:t.convertPixelToModel({sizeInPixels:e.imgWidth,coords:i?e.position:null,viewer:s.getViewer()})},{name:"fImageHeight",value:t.convertPixelToModel({sizeInPixels:e.imgHeight,coords:i?e.position:null,viewer:s.getViewer()})}])},this.setRelatedObjectData=function(e){e&&(l.image=e.image&&e.image.src?e.image.src:"",l.label=e.label,l.icon=e.icon,l.draggableContent=e.draggableContent)},this.getPictureLabel=function(){if(s.getAttribute("bShortDisplay"))return[];var e=(s.getAttribute("sRelatedObjectId")?[l.label]:s.getAttribute("sTextContents")[0])||"";return s.getAttribute("fCreationDate")&&(e+=" | "+r.formatDate(s.getAttribute("fCreationDate"))),[e]};let c=this.getImageToDisplay;this.getImageToDisplay=function(){return s.getAttribute("sRelatedObjectId")?l.image:c()};var p=this.refreshNode;this.refreshNode=function(){s.getNode()&&!a.isImporting()&&s.getImageToDisplay()&&(s.getNode().update({name:s.getAttribute("sName"),pointedReferences:s.getAttribute("lPointedReferences"),content:s.getAttribute("bShortDisplay")||s.getAttribute("sRelatedObjectId")?[]:s.getAttribute("sTextContents"),isVisible:s.getAttribute("bVisible"),hasALeader:s.getAttribute("bHasALeader"),inEdition:s.isInEdition(),leaderEndType:s.getAttribute("sLeaderEndType"),position:n.getAbsolutePosition(s,s.getAttribute("vRelativePosition"),s.getAttribute("vLeaderBreakPoint3D"),s.getAttribute("sPositionalReference")),pointingPoints:s.getPointingPoints(),isFilled:s.getAttribute("bIsFilled"),hasBorder:s.getAttribute("bHasBorder"),imageWidth:s.getAttribute("fImageWidth"),imageHeight:s.getAttribute("fImageHeight"),imageInvertH:s.getAttribute("bInvertH"),imageInvertV:s.getAttribute("bInvertV"),markerImage:s.getImageToDisplay(),shortDisplay:s.getAttribute("bShortDisplay")||!s.getPictureLabel()[0],windowAnchor:s.getAttribute("sWindowAnchor"),anchorMode:s.getAttribute("sAnchorMode"),zoomMode:s.getAttribute("bZoomMode"),leaderAttachWidthRatio:s.getAttribute("fLeaderAttachWidthRatio"),leaderAttachLengthRatio:s.getAttribute("fLeaderAttachLengthRatio"),boxRotationAngle:s.getAttribute("fBoxRotationAngle"),pointedObjectId:s.getAttribute("sRelatedObjectId"),elementIconType:s.getAttribute("sRelatedObjectId")?l.icon:null,creationDate:s.getAttribute("fCreationDate"),draggableContent:l.draggableContent,graphicProperties:{borderRadius:s.getAttribute("fBorderRadius"),fontStyle:{pxheight:s.getAttribute("iFontSize")*(4/3),fontSize:s.getAttribute("fFontSize"),familyName:s.getAttribute("sFontName"),familyStyle:s.getAttribute("sFontStyle"),color:s.getAttribute("cFontColor")},fillStyle:{color:s.getAttribute("cFillStyleColor"),opacity:s.getAttribute("fOpacity"),gradient:s.getAttribute("oGradient")},lineStyle:{thickness:n.getLineThickness(s.getAttribute("fLineStyleThicknessIndex"))||s.getAttribute("fLineStyleThickness"),pattern:s.getAttribute("sLineStylePattern"),color:s.getAttribute("cLineStyleColor")},leaderStyle:{thickness:n.getLineThickness(s.getAttribute("fLeaderStyleThicknessIndex"))||s.getAttribute("fLeaderStyleThickness"),pattern:s.getAttribute("sLeaderStylePattern"),color:s.getAttribute("cLeaderStyleColor")}}}),p())}},setAttribute:function(e,t){this.getParent().isImporting()||"fTextBoxWidth"!==e?this.getParent().isImporting()||"fTextBoxLength"!==e?this._parent(e,t):(this._parent("fTextBoxLength",null),this._parent("fImageHeight",t)):(this._parent("fTextBoxWidth",null),this._parent("fImageWidth",t))},getAttribute:function(e){var i;return"fImageWidth"===e?null==(i=this._parent("fImageWidth"))&&(i=t.convertPixelToModel({sizeInPixels:this._parent("fTextBoxWidth"),viewer:this._viewer})):"fImageHeight"===e?null==(i=this._parent("fImageHeight"))&&(i=t.convertPixelToModel({sizeInPixels:this._parent("fTextBoxLength"),viewer:this._viewer})):i=this._parent(e),i}})}),define("DS/DMUPlayMarker/DMUMarker3DSpline",["require","exports","DS/DMUBaseExperience/EXPImportServices","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker3D","DS/DMUPlayMarker/DMUMarker3DSplineNode3D","DS/DMUPlayMarker/DMUMarker3DPoint","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r,n,o,a,s){"use strict";let l=[{name:"oPoints",type:"listObjects",JSONname:"PropertiesMultiPoint.Points"}];return class extends n{constructor(e,t){super(e,t),this.addParameters(l),this.removeParameters(["cFillStyleColor","bIsFilled","bHasBorder","fOpacity"]),this.setAttribute("sType","Marker3DSpline");let n,d,c=this;this.setNode(new o({frmWindow:this._frmWindow,getType:this.getType})),this.initContextualBar("DS/DMUMarker/DMUMarkerLineContextualBar"),this._pointsImporter=new i,this.getPoints=function(){return c.getAttribute("oPoints")},this.getManipulationData=function(){return c.getNode().getBoundingBoxDimensions()},this.updateProjectionPlaneDefinition=function({up:e,right:t}){if(!n||n.equals(e)||d.equals(t))n=e.clone(),d=t.clone();else{let i=c.getNode().getBoundingBoxDimensions(),o=s.getRelativePosition(c,i.position),l=n.clone(),p=d.clone(),h=(new r.Vector3).crossVectors(p,l),u=(new r.Matrix4).makeBasis(p,l,h).setPosition(o),g=(new r.Matrix4).getInverse(u);n=e.clone(),d=t.clone();let P=(new r.Vector3).crossVectors(d,n),f=(new r.Matrix4).makeBasis(d,n,P).setPosition(o).clone().multiply(g);(c.getPoints()||[]).forEach(function(e){if(e instanceof a){let t=e.getAttribute("vPosition");t.applyMatrix4(f),e.setAttribute("vPosition",t)}})}c.refreshNode()},this.updateModel=function(e){let t=(new r.Vector3).crossVectors(d,n),i=c.getNode().getBoundingBoxDimensions(),o=(new r.Matrix4).makeRotationZ(s.getRelativeRotation(c,0)),l=new r.Vector3((Math.cos(s.getRelativeRotation(c,0))+Math.sin(s.getRelativeRotation(c,0)))*Math.abs(e.width/i.width),(Math.cos(s.getRelativeRotation(c,0))-Math.sin(s.getRelativeRotation(c,0)))*Math.abs(e.height/i.height),1).applyMatrix4(o),p=(new r.Matrix4).makeScale(l.x,l.y,l.z),h=(new r.Matrix4).makeBasis(d,n,t),u=(new r.Matrix4).multiplyMatrices(h,p),g=(new r.Matrix4).getInverse(h,!0);u.multiply(g);let P=c.getPoints()||[],f=s.getRelativePosition(c,i.position);c.updatePointedElement(e.position),c.updatePointedPosition(s.getRelativePosition(c,e.position));let y=(new r.Matrix4).getInverse(o);P.forEach(function(t){if(t instanceof a){let i=t.getAttribute("vPosition");i.sub(f),i.applyMatrix4(u),i.applyMatrix4(y),i.add(e.position),t.setAttribute("vPosition",s.getRelativePosition(c,i))}}),c.setAttribute("fRotationAngle",e.rotation)};let p=this.refreshNode;this.refreshNode=function(){c.getNode()&&!t.isImporting()&&n&&d&&(c.getNode().update({name:c.getAttribute("sName"),pointedReferences:c.getAttribute("lPointedReferences"),inEdition:c.isInEdition(),points:function(){let e=c.getPoints()||[],t=[];return e.forEach(function(e){e instanceof a&&t.push(s.getAbsolutePosition(c,null,e.getAttribute("vPosition")).toArray())}),t}(),projectionPlaneVectors:{up:n,right:d},rotationAngle:c.getAttribute("fRotationAngle")||0,pointedPage:c.getAttribute("fPointedPageNumber"),isVisible:c.getAttribute("bVisible")&&!c.hasAlertFlag(),graphicProperties:{lineStyle:{thickness:s.getLineThickness(c.getAttribute("fLineStyleThicknessIndex"))||c.getAttribute("fLineStyleThickness"),pattern:c.getAttribute("sLineStylePattern"),color:c.getAttribute("cLineStyleColor"),opacity:void 0===c.getAttribute("fLineStyleOpacity")?1:c.getAttribute("fLineStyleOpacity")}}}),p())},this._parentSetAttribute=this.setAttribute,this.setAttribute=function(e,t){if("oPoints"===e&&Array.isArray(t)&&t.length){let i=c.getPoints();i||(i=[]);let r=[];for(let e=0;e<t.length;e++)t[e]&&t[e].getType&&"DMUMarker3DPoint"===t[e].getType()?r.push({Point3D:t[e].getAttribute("vPosition").toArray()}):r.push(t[e]);for(let e=0;e<r.length;e++){if(i[e]&&i[e]instanceof a)c._pointsImporter.fillObjectAttributes(i[e],r[e]);else{let t=new a(c._viewer,c);c._pointsImporter.fillObjectAttributes(t,r[e]),i[e]=t}0===e&&c.updatePointedPosition(i[e].getAttribute("vPosition"))}c._parentSetAttribute(e,i)}else c._parentSetAttribute(e,t)}}}}),define("DS/DMUPlayMarker/DMUMarker3DRectangle",["require","exports","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker3D","DS/DMUBaseUIServices/DMUObjectsServices","DS/DMUPlayMarker/DMUMarker3DRectangleNode3D"],function(e,t,i,r,n,o){"use strict";let a=[{name:"fWidth",type:"float",JSONname:"Properties3DRectangle.width",defaultValue:10},{name:"fHeight",type:"float",JSONname:"Properties3DRectangle.height",defaultValue:10},{name:"vPosition",type:"Vector3",JSONname:"Properties3DRectangle.position",defaultValue:new i.Vector3},{name:"vRelativePosition",type:"Vector3",JSONname:"Properties3DRectangle.RelativePosition",defaultValue:null},{name:"sAnchor",type:"string",JSONname:"Properties3DRectangle.anchor",defaultValue:"center"}];return class extends r{constructor(e,t){super(e,t),this.addParameters(a),this.setAttribute("sType","Marker3DRectangle");let i=this;this.setNode(new o({frmWindow:this._frmWindow,getType:this.getType})),this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar"),this.getManipulationData=function(){return this.getNode().getBoundingBoxDimensions()},this.updateModel=function(e){i.updatePointedElement(e.position),i.setAttributes([{name:"fWidth",value:e.width},{name:"fHeight",value:e.height},{name:"vPosition",value:n.getRelativePosition(i,e.position)},{name:"fRotationAngle",value:n.getRelativeRotation(i,e.rotation)}])};let r=this.refreshNode;this.refreshNode=function(){i.getNode()&&!t.isImporting()&&(i.getNode().update({name:i.getAttribute("sName"),pointedReferences:i.getAttribute("lPointedReferences"),position:n.getAbsolutePosition(i,i.getAttribute("vRelativePosition"),i.getAttribute("vPosition"),i.getPointedReference(0)),rotationAngle:n.getAbsoluteRotation(i,i.getAttribute("fRotationAngle")||0),width:i.getAttribute("fWidth"),height:i.getAttribute("fHeight"),anchor:i.getAttribute("sAnchor"),inEdition:i.isInEdition(),isVisible:i.getAttribute("bVisible")&&!i.hasAlertFlag(),isFilled:i.getAttribute("bIsFilled"),hasBorder:i.getAttribute("bHasBorder"),pointedPage:i.getAttribute("fPointedPageNumber"),graphicProperties:{fillStyle:{color:i.getAttribute("cFillStyleColor"),opacity:i.getAttribute("fOpacity")},lineStyle:{pattern:i.getAttribute("sLineStylePattern"),thickness:n.getLineThickness(i.getAttribute("fLineStyleThicknessIndex"))||i.getAttribute("fLineStyleThickness"),color:i.getAttribute("cLineStyleColor"),opacity:i.getAttribute("fLineStyleOpacity")}}}),r())},this._parentSetAttribute=this.setAttribute,this.setAttribute=function(e,t){!1!==t||"bHasBorder"!==e||i.getAttribute("bIsFilled")?!1!==t||"bIsFilled"!==e||i.getAttribute("bHasBorder")?"vPosition"===e&&i.updatePointedPosition(t):i.setAttribute("bHasBorder",!0):i.setAttribute("bIsFilled",!0),i._parentSetAttribute(e,t)},this._parentGetAttribute=this.getAttribute,this.getAttribute=function(e){return"vPosition"===e?i._parentGetAttribute(e).clone():i._parentGetAttribute(e)}}}}),define("DS/DMUPlayMarker/DMUMarker3DEllipse",["require","exports","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker3D","DS/DMUPlayMarker/DMUMarker3DEllipseNode3D","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r,n,o){"use strict";let a=[{name:"vCenter",type:"Vector3",JSONname:"Properties3DEllipse.Center",defaultValue:new i.Vector3},{name:"fxAxisLength",type:"float",JSONname:"Properties3DEllipse.xAxisLength",defaultValue:100},{name:"fyAxisLength",type:"float",JSONname:"Properties3DEllipse.yAxisLength",defaultValue:100}];return class extends r{constructor(e,t){super(e,t),this.addParameters(a),this.setAttribute("sType","Marker3DEllipse");let i=this;this.setNode(new n({frmWindow:this._frmWindow,getType:this.getType})),this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar"),this.getManipulationData=function(){return this.getNode().getBoundingBoxDimensions()},this.updateModel=function(e){i.updatePointedElement(e.position),i.setAttributes([{name:"fxAxisLength",value:e.width},{name:"fyAxisLength",value:e.height},{name:"vCenter",value:o.getRelativePosition(i,e.position)},{name:"fRotationAngle",value:o.getRelativeRotation(i,e.rotation)}])};let r=this.refreshNode;this.refreshNode=function(){i.getNode()&&!t.isImporting()&&(i.getNode().update({name:i.getAttribute("sName"),pointedReferences:i.getAttribute("lPointedReferences"),xAxisLength:i.getAttribute("fxAxisLength"),yAxisLength:i.getAttribute("fyAxisLength"),rotationAngle:o.getAbsoluteRotation(i,i.getAttribute("fRotationAngle")||0),center:o.getAbsolutePosition(i,null,i.getAttribute("vCenter")),inEdition:i.isInEdition(),isVisible:i.getAttribute("bVisible")&&!i.hasAlertFlag(),isFilled:i.getAttribute("bIsFilled"),hasBorder:i.getAttribute("bHasBorder"),pointedPage:i.getAttribute("fPointedPageNumber"),graphicProperties:{fillStyle:{color:i.getAttribute("cFillStyleColor"),opacity:i.getAttribute("fOpacity")},lineStyle:{pattern:i.getAttribute("sLineStylePattern"),thickness:o.getLineThickness(i.getAttribute("fLineStyleThicknessIndex"))||i.getAttribute("fLineStyleThickness"),color:i.getAttribute("cLineStyleColor"),opacity:i.getAttribute("fLineStyleOpacity")}}}),r())},this._parentSetAttribute=this.setAttribute,this.setAttribute=function(e,t){!1!==t||"bHasBorder"!==e||i.getAttribute("bIsFilled")?!1!==t||"bIsFilled"!==e||i.getAttribute("bHasBorder")?"fxAxisLength"===e||"fyAxisLength"===e?t=Math.abs(t):"vCenter"===e&&i.updatePointedPosition(t):i.setAttribute("bHasBorder",!0):i.setAttribute("bIsFilled",!0),i._parentSetAttribute(e,t)},this._parentGetAttribute=this.getAttribute,this.getAttribute=function(e){return"vCenter"===e?i._parentGetAttribute("vCenter").clone():i._parentGetAttribute(e)}}}}),define("DS/DMUPlayMarker/DMUMarker2DHyperlinkNode3D",["DS/DMUPlayMarker/DMUMarker2DTextNode3D","DS/Mesh/MeshUtils","DS/DMUPlayMarker/DMUMarkerTools","DS/Selection/PSOManager","DS/DMUMeasurable/DMUToolsSceneGraph"],function(e,t,i,r,n){"use strict";return e.extend({init:function(e){var o=e||{};o.defaultGraphicProps={padding:0},this._parent(o);var a,s=this;this.getTooltip=function(){return i.createHyperlinkDiv(o.getHyperlinks())},this.onClickCB=function(){s.getViewer().setCursor("auto"),i.solveHyperlink(o.getHyperlinks(),s.getViewer())},this.onBeginPreactivateCB=function(e){a||(a=n.buildPathElement(s.children[0])),r.add({pathElement:a,event:e.event.from[0]}),s.getViewer().setCursor("pointer")},this.onEndPreactivateCB=function(){a||(a=n.buildPathElement(s.children[0])),r.isIn({pathElement:a})&&r.remove({pathElement:a}),s.getViewer().setCursor("auto")};var l=this.update;this.update=function(e){l(e),s.setPickable(t.PICKABLE),s._getExcludeFromCSO=o.isReadOnly}}})}),define("DS/DMUPlayMarker/DMUMarker2DHyperlink",["DS/DMUPlayMarker/DMUMarker2DText","DS/DMUPlayMarker/DMUMarker2DHyperlinkNode3D","DS/DMUPlayMarker/DMUMarkerTools"],function(e,t,i){"use strict";return e.extend({init:function(e,r){var n=this;this._parent(e,r,{type:"Marker2DHyperlink",nodeClass:t,nodeParams:{getHyperlinks:function(){return n.getAttribute("oHyperlinks")},isReadOnly:function(){return n.isReadOnly()}}});let o=this.getImageToDisplay;this.getImageToDisplay=function(){return o()?o():i.getHyperlinkIcon(n.getAttribute("oHyperlinks"))}}})}),define("DS/DMUPlayMarker/DMUMarker3DCloudNode3D",["require","exports","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/Visualization/PolygonTessellator","DS/DMUBaseExperience/EXPToolsMaterial","DS/SceneGraphNodes/BillBoardNode3D","DS/DMUPlayMarker/DMUMarkerTools","DS/DMUBaseUI/DMUManipulableNode3D","DS/DMUBaseExperience/EXPToolsVisualization"],function(e,t,i,r,n,o,a,s,l,d,c){"use strict";return class extends d{constructor(e){super(e);let t,d,p,h,u,g,P,f=this,y=f.getViewer(),D=1;const S=1.6,m=1.1,M=1.8,b=.8,v=.1,A=15;let x=new s({type:"Spherical"});x.setPickParent(!0),this.addChild(x);let w,k=new r;function N(e,t){return{x:t.x-e.x,y:t.y-e.y}}function U(e){let t=[];if(e){e.push(e[0]);const r=15*c.getMMPerPixelRatio(y,P);let n,o,a=function(e){const t=e.length;let i=0,r=0;for(const t of e)i+=t.x,r+=t.y;return{x:i/t,y:r/t}}(e),s=function(e,t,i){const r=N(e,t),n=N(e,i),o=(s=n,(a=r).x*s.y-a.y*s.x);var a,s;return o>0?1:o<0?-1:0}(e[0],e[1],a);for(let a=0,l=1;a<e.length-1;a++,l++){let d,c,p,h=e[a].x,u=e[l].x,g=e[a].y,P=h,f=g,y=0,D=u-h,x=e[l].y-g,w=Math.sqrt(D*D+x*x)/(r*S),k=w-Math.floor(w),N=Math.atan2(x,D);s<=0?(c=b,p=v,d=!1):(c=m,p=M,d=!0);for(let e=0;e<w;e++){P=h+r*e*Math.cos(N)*S,f=g+r*e*Math.sin(N)*S,y=0;let s,l=0===e&&a>0,u=e===Math.ceil(w-1),D=c*Math.PI+N,m=p*Math.PI+N;if(l&&o&&n){let e;e=o<=.3?.42:o>.3&&o<.6?.28:.14,D=d?D+e*Math.PI-N+n:D-e*Math.PI-N+n}else if(u){let e;e=k<=.3?.3:k>.3&&k<.6?.2:.1,m=d?m-e*Math.PI:m+e*Math.PI}for(let e=0;e<A;e++){let n=m-D>Number(Math.PI)?2*Math.PI-(m-D):m-D;!d&&D<m||d&&D>m?(d&&D>m&&(D%=2*Math.PI),s=D-e/A*n):s=D+e/A*(m-D);let o=new i.Vector3(P+r*Math.cos(s),f+r*Math.sin(s),y);t.push(o)}n=N,o=k}}}return e&&e.pop(),t}x.addChild(k),k.setPickParent(!0),this.linkManipulatorToNode(k),this.getRepNode=function(){return x},this.getBoundingBoxDimensions=function(){return{position:P,height:u||0,width:g||0,rotation:p&&p.rotationAngle||0,pointedPage:p?p.pointedPage:void 0}},this.updateRepresentation=function({points:e,boundingBoxDimensions:r},a){if(!p)return;let s=U(e);if(s&&s.length>1){if(s.push(s[0]),k.removeChildren(),p.isFilled){let e=new o;for(let t=0;t<s.length;t++)e.addPointToCurrentPolygonLoop(s[t].x,-1*s[t].y);e.closeCurrentPolygonLoop(),e.endCurrentPolygon();let i=e.createNode3D(t,0);k.addChild(i)}if(p.hasBorder){let e=n.createLineNode({points:s,material:d});e.setShadow(!1),e.setPickParent(!0),k.addChild(e)}t&&d&&(t.setOpacity((p.graphicProperties.fillStyle.opacity||0)*(a?.6:1)),d.setOpacity((p.graphicProperties.lineStyle.opacity||0)*(a?.6:1)))}let l=(new i.Matrix4).makeRotationZ(r.rotation);k.setMatrix((new i.Matrix4).multiply(l)),f.setMatrix((new i.Matrix4).setPosition(r.position))},this.getPointsPosition=function(){return h};let C=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){C(),w&&clearTimeout(w),w=null,d&&d.dispose(),t&&t.dispose(),t=d=x=k=p=null},this._updateVisibility=function(e){if(!p)return;void 0!==e&&(D=e);let t=l.is3DMarkerDisplayed(y,p.pointedReferences);f.setVisibility(D>0&&p.isVisible&&t),y.render()},this.update=function(e){if(!f)return;p||(p={graphicProperties:{fillStyle:{},lineStyle:{}}});let r=!1,s=[],c={paramA:p,paramB:e,merge:!0,mergedKeys:s};if(!l.compareAndMergeParams(c)){let e=this.getRepManipulator();e&&e.deactivate(),f.setName(p.name),t?s.includes("fillStyle")&&(t.color=p.graphicProperties.fillStyle.color,t.setOpacity(p.graphicProperties.fillStyle.opacity)):(r=!0,t=a.createBasicMaterial({color:p.graphicProperties.fillStyle.color,opacity:p.graphicProperties.fillStyle.opacity})),d?s.includes("lineStyle")&&(d.color=p.graphicProperties.lineStyle.color,d.setOpacity(p.graphicProperties.lineStyle.opacity),d.setLineWidth((p.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio),d.setDashPatternType="SOLID"):(r=!0,d=a.createLineMaterial({color:p.graphicProperties.lineStyle.color,opacity:p.graphicProperties.lineStyle.opacity,lineWidth:(p.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio,pattern:"SOLID"})),(s.includes("isFilled")||s.includes("hasBorder"))&&(r=!0),p.points&&s.includes("points")&&(r=!0,h=[],h=function(e,t){if(!e||!e.length||!t)return;let r=t.up,n=t.right,o=(new i.Vector3).crossVectors(n,r),a=[];e.forEach(function(e){a.push(new i.Vector3(e[0],e[1],e[2]))});let s=a,l=-1/0,d=1/0,c=-1/0,p=1/0,h=-1/0,f=1/0;s.forEach(function(e){l=Math.max(l,e.dot(n)),d=Math.min(d,e.dot(n)),c=Math.max(c,e.dot(r)),p=Math.min(p,e.dot(r)),h=Math.max(h,e.dot(o)),f=Math.min(f,e.dot(o))});let y=new i.Vector3(d,c,h),D=new i.Vector3(l,p,f);(P=(new i.Vector3).addVectors(y,D).multiplyScalar(.5)).applyMatrix4((new i.Matrix4).makeBasis(n,r,o)),u=c-p,g=l-d;let S=[];return s.forEach(function(e){let t=e.clone().sub(P);S.push(new i.Vector3(t.dot(n),t.dot(r),0))}),S}(p.points,p.projectionPlaneVectors));let l=U(h);if(r&&l&&l.length>1){if(l.push(l[0]),k.removeChildren(),p.isFilled){let e=new o;for(let t=0;t<l.length;t++)e.addPointToCurrentPolygonLoop(l[t].x,-1*l[t].y);e.closeCurrentPolygonLoop(),e.endCurrentPolygon();let i=e.createNode3D(t,0);k.addChild(i)}if(p.hasBorder){let e=n.createLineNode({points:l,material:d});e.setShadow(!1),e.setPickParent(!0),k.addChild(e)}}k.setMatrix((new i.Matrix4).makeRotationZ(p.rotationAngle)),P&&f.setMatrix((new i.Matrix4).setPosition(P)),e&&e.activate(),f._updateVisibility()}};let T=function(){f&&f._updateVisibility(),w=null};this.onViewerEventCB=function(e){f&&p&&(w||!p.pointedReferences||"onHideShow"!==e.eventType&&"onRepresentationLoaded"!==e.eventType||(w=setTimeout(T)))}}}}),define("DS/DMUPlayMarker/DMUMarker3DCloud",["require","exports","DS/DMUBaseExperience/EXPImportServices","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker3D","DS/DMUPlayMarker/DMUMarker3DCloudNode3D","DS/DMUPlayMarker/DMUMarker3DPoint","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r,n,o,a,s){"use strict";let l=[{name:"oPoints",type:"listObjects",JSONname:"Properties3DCloud.Points"}];return class extends n{constructor(e,t){super(e,t),this.addParameters(l),this.setAttribute("sType","Marker3DCloud"),this.removeParameters(["sLineStylePattern"]);let n,d,c=this;this.setNode(new o({frmWindow:this._frmWindow,getType:this.getType})),this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar"),this.getManipulationData=function(){return{boundingBoxDimensions:this.getNode().getBoundingBoxDimensions(),points:this.getNode().getPointsPosition()}},this._pointsImporter=new i,this.getPoints=function(){let e=c.getAttribute("oPoints")||[];return e&&e.length&&e[0]instanceof a?e:(c.setAttribute("oPoints",e),e)},this.updateProjectionPlaneDefinition=function({up:e,right:t}){if(!n||n.equals(e)||d.equals(t))n=e.clone(),d=t.clone();else{let i=c.getNode().getBoundingBoxDimensions(),o=s.getRelativePosition(c,i.position),l=n.clone(),p=d.clone(),h=(new r.Vector3).crossVectors(p,l),u=(new r.Matrix4).makeBasis(p,l,h).setPosition(o),g=(new r.Matrix4).getInverse(u);n=e.clone(),d=t.clone();let P=(new r.Vector3).crossVectors(d,n),f=(new r.Matrix4).makeBasis(d,n,P).setPosition(o).clone().multiply(g);(c.getPoints()||[]).forEach(function(e){if(e instanceof a){let t=e.getAttribute("vPosition");t.applyMatrix4(f),e.setAttribute("vPosition",t)}})}c.refreshNode()},this.updateModel=function({points:e,boundingBoxDimensions:t}){let i=(new r.Vector3).crossVectors(d,n),o=(new r.Matrix4).makeBasis(d,n,i),l=c.getPoints()||[];c.updatePointedElement(t.position),c.updatePointedPosition(s.getRelativePosition(c,t.position)),l.forEach(function(i,r){if(i instanceof a){let n=e[r].clone();n.applyMatrix4(o),n.add(t.position),i.setAttribute("vPosition",s.getRelativePosition(c,n))}}),c.setAttribute("fRotationAngle",t.rotation)};let p=this.refreshNode;this.refreshNode=function(){this.getPoints().forEach(function(e){e.refreshNode()}),c.getNode()&&!t.isImporting()&&n&&d&&(c.getNode().update({name:c.getAttribute("sName"),pointedReferences:c.getAttribute("lPointedReferences"),inEdition:c.isInEdition(),points:function(){let e=c.getAttribute("oPoints")||[],t=[];return e.forEach(function(e){e instanceof a&&t.push(s.getAbsolutePosition(c,null,e.getAttribute("vPosition")).toArray())}),t}(),projectionPlaneVectors:{up:n,right:d},rotationAngle:c.getAttribute("fRotationAngle")||0,pointedPage:c.getAttribute("fPointedPageNumber"),isVisible:c.getAttribute("bVisible")&&!c.hasAlertFlag(),isFilled:c.getAttribute("bIsFilled"),hasBorder:c.getAttribute("bHasBorder"),graphicProperties:{fillStyle:{color:c.getAttribute("cFillStyleColor"),opacity:c.getAttribute("fOpacity")},lineStyle:{thickness:s.getLineThickness(c.getAttribute("fLineStyleThicknessIndex"))||c.getAttribute("fLineStyleThickness"),color:c.getAttribute("cLineStyleColor"),opacity:c.getAttribute("fLineStyleOpacity")}}}),p())};const h=this.setAttribute.bind(this);this.setAttribute=function(e,t){if(!1!==t||"bHasBorder"!==e||c.getAttribute("bIsFilled")?!1!==t||"bIsFilled"!==e||c.getAttribute("bHasBorder")||c.setAttribute("bHasBorder",!0):c.setAttribute("bIsFilled",!0),"oPoints"===e&&Array.isArray(t)&&t.length){let i=c.getAttribute("oPoints");i||(i=[]);let r=[];for(let e=0;e<t.length;e++){let i;i=0===e?"Begin":e===t.length-1?"End":void 0,t[e]&&t[e].getType&&"DMUMarker3DPoint"===t[e].getType()?r.push({Name:void 0===t[e].getAttribute("sName")?i:t[e].getAttribute("sName"),Point3D:t[e].getAttribute("vPosition").toArray()}):(r.push(t[e]),r[e].Name||(r[e].Name=i))}for(let e=0;e<r.length;e++){if(i[e]&&i[e]instanceof a)c._pointsImporter.fillObjectAttributes(i[e],r[e]);else{let t=new a(c._viewer,c);c._pointsImporter.fillObjectAttributes(t,r[e]),i[e]=t}0===e&&this.updatePointedPosition(i[e].getAttribute("vPosition"))}h(e,i)}else h(e,t)}}}}),define("DS/DMUPlayMarker/DMUMarker3DFreehandNode3D",["require","exports","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/DMUBaseExperience/EXPToolsMaterial","DS/DMUPlayMarker/DMUMarkerTools","DS/SceneGraphNodes/BillBoardNode3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/DMUBaseUI/DMUManipulableNode3D","DS/DMUBaseExperience/EXPToolsVisualization"],function(e,t,i,r,n,o,a,s,l,d,c){"use strict";return class extends d{constructor(e){super(e);let t,d,p,h,u,g,P,f=this,y=f.getViewer(),D=1,S=new s({type:"Spherical"});S.setPickParent(!0),this.addChild(S);let m,M=new r;S.addChild(M),M.setPickParent(!0),this.linkManipulatorToNode(M),this.getRepNode=function(){return S},this.updateRepresentation=function(e,r){if(void 0!==e.position){if(!t)return;let n=new i.Vector3(g?Math.abs(e.width)/g:1,u?Math.abs(e.height)/u:1,1),o=(new i.Matrix4).makeRotationZ(e.rotation).scale(n);M.setMatrix((new i.Matrix4).multiply(o)),f.setMatrix((new i.Matrix4).setPosition(e.position)),d&&d.setOpacity((t.graphicProperties.lineStyle.opacity||0)*(r?.6:1)),p&&p.setOpacity((t.graphicProperties.lineStyle.opacity||0)*(r?.6:1))}else{if(!t)return;M.removeChildren();let i=n.createLineNode({points:e,material:d});i.setShadow(!1),i.setPickParent(!0),M.addChild(i),d&&d.setOpacity((t.graphicProperties.lineStyle.opacity||0)*(r?.6:1)),p&&p.setOpacity((t.graphicProperties.lineStyle.opacity||0)*(r?.6:1))}},this.getPointsPosition=function(){return h||[]},this.getBoundingBoxDimensions=function(){return{position:P,height:u||0,width:g||0,rotation:(null==t?void 0:t.rotationAngle)||0,pointedPage:(null==t?void 0:t.pointedPage)||void 0}};let b=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){b(),m&&clearTimeout(m),m=null,d&&d.dispose(),p&&p.dispose(),S=M=t=d=p=null,u=g=null},this._updateVisibility=function(e){if(!t)return;void 0!==e&&(D=e);let i=a.is3DMarkerDisplayed(y,t.pointedReferences);f.setVisibility(D>0&&t.isVisible&&i),y.render()},this.update=function(e){var r,s;if(!f)return;t||(t={graphicProperties:{lineStyle:{}}});let D=!1,S=[],m={paramA:t,paramB:e,merge:!0,mergedKeys:S};if(!a.compareAndMergeParams(m)){let e=this.getRepManipulator();if(e&&e.deactivate(),f.setName(t.name),d?(1===(null===(s=null==t?void 0:t.points)||void 0===s?void 0:s.length)&&p&&(p.color=t.graphicProperties.lineStyle.color,p.setOpacity(t.graphicProperties.lineStyle.opacity),D=!0),S.includes("lineStyle")&&(d.color=t.graphicProperties.lineStyle.color,d.setOpacity(t.graphicProperties.lineStyle.opacity),d.setLineWidth((t.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio),d.setDashPatternType(o.getDashType(t.graphicProperties.lineStyle.pattern)))):(D=!0,1!==(null===(r=null==t?void 0:t.points)||void 0===r?void 0:r.length)||p||(p=o.createBasicMaterial({color:t.graphicProperties.lineStyle.color,opacity:t.graphicProperties.lineStyle.opacity})),d=o.createLineMaterial({color:t.graphicProperties.lineStyle.color,opacity:t.graphicProperties.lineStyle.opacity,lineWidth:(t.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio,pattern:t.graphicProperties.lineStyle.pattern})),!t.points||h&&!S.includes("points")||(D=!0,h=function(e,t){if(!e||!e.length||!t)return;let r=t.up,n=t.right,o=(new i.Vector3).crossVectors(n,r),a=[];e.forEach(function(e){a.push(new i.Vector3(e[0],e[1],e[2]))});let s=-1/0,l=1/0,d=-1/0,c=1/0,p=-1/0,h=1/0;a.forEach(function(e){s=Math.max(s,e.dot(n)),l=Math.min(l,e.dot(n)),d=Math.max(d,e.dot(r)),c=Math.min(c,e.dot(r)),p=Math.max(p,e.dot(o)),h=Math.min(h,e.dot(o))});let f=new i.Vector3(l,d,p),y=new i.Vector3(s,c,h);(P=(new i.Vector3).addVectors(f,y).multiplyScalar(.5)).applyMatrix4((new i.Matrix4).makeBasis(n,r,o)),u=d-c,g=s-l;let D=[];return a.forEach(function(e){let t=e.clone().sub(P);D.push(new i.Vector3(t.dot(n),t.dot(r),0))}),D}(t.points,t.projectionPlaneVectors)),D&&h&&h.length>=1){let e;if(M.removeChildren(),1===h.length){let t=c.getMMPerPixelRatio(y,P),i=.5;i=d.lineWidth<16?1/window.devicePixelRatio:16===d.lineWidth?.75/window.devicePixelRatio:.5/window.devicePixelRatio;let r=d.lineWidth*i,o=a.getCircleSegments(r,t);e=new l({ratio:1});let s=n.createCircleNode({radius:r,fill:!0,segments:o,noEdge:!0,material:p});s.setPickParent(!0),s.setShadow(!1),e.addChild(s)}else(e=n.createLineNode({points:h,material:d})).setShadow(!1);e.setPickParent(!0),M.addChild(e)}(D||S.includes("rotationAngle"))&&M.setMatrix((new i.Matrix4).makeRotationZ(t.rotationAngle)),P&&f.setMatrix((new i.Matrix4).setPosition(P)),e&&e.activate(),f._updateVisibility()}};let v=function(){f&&f._updateVisibility(),m=null};this.onViewerEventCB=function(e){f&&t&&(m||!t.pointedReferences||"onHideShow"!==e.eventType&&"onRepresentationLoaded"!==e.eventType||(m=setTimeout(v)))}}}}),define("DS/DMUPlayMarker/DMUCommentPositionedNode",["require","exports","DS/DMUBaseExperience/EXPToolsMaterial","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/DMUPlayMarker/DMUMarkerTools","DS/WebappsUtils/WebappsUtils","DS/DMUBaseUI/DMUToolsUsers","DS/DMUBaseUI/DMUManipulableNode3D"],function(e,t,i,r,n,o,a,s,l,d){"use strict";return class extends d{constructor(e){super(e);let t,d,c,p,h=this,u=h.getViewer(),g=new r;g.setPickParent(!0),this.addChild(g),this.linkManipulatorToNode(g),this.getCommentParams=function(){return{position:t?t.position:null}},this.updateRepresentation=function(e){h.setMatrix((new n.Matrix4).setPosition(e.position))},this.update=function(e){if(!h)return;t||(t={});let r={paramA:t,paramB:e,merge:!0,mergedKeys:[]};if(!a.compareAndMergeParams(r)){h.setName(t.name);let e=this.getRepManipulator();if(e&&e.deactivate(),!d){let e;(p=n.ImageUtils.loadTexture(s.getWebappsAssetUrl("DMUPlayMarker","icons/32/")+"I_Comment.png")).needsUpdate=!0;let r=l.getUserColor(t.owner);d=i.createBasicMaterial({color:r});let a=6,h=5,u=function(e,t,i){let r=new n.Shape;return r.moveTo(-t/2,-i/2+e),r.lineTo(-t/2,i/2-e),e&&r.absarc(-t/2+e,i/2-e,e,Math.PI,.5*Math.PI,!0),r.lineTo(t/2-e,i/2),e&&r.absarc(t/2-e,i/2-e,e,.5*Math.PI,0,!0),r.lineTo(t/2,-i/2+e),e&&r.absarc(t/2-e,-i/2+e,e,2*Math.PI,1.5*Math.PI,!0),r.lineTo(-t/2+.45*t,-i/2),r.lineTo(-t/2+.1*t,-i/2-.3*i),e&&r.absarc(-t/2+e,-i/2+e,e,1.5*Math.PI,Math.PI,!0),r}(1,a,h);(e=o.createNodeFromTHREEMesh(new n.Mesh(new n.ShapeGeometry(u),d))).setShadow(!1),e.setPickParent(!0),e.setRenderDepth(1),g.addChild(e);let P=r.getHSL();P.s=1,P.l*=.5,c=i.createLineMaterial({color:r.clone().setHSL(P.h,P.s,P.l),lineWidth:2*window.devicePixelRatio,pattern:"1"});let f=u.getPoints(5).map(function(e){return new n.Vector3(e.x,e.y,0)}),y=o.createLineNode({points:f,material:c});y.setShadow(!1),y.setPickParent(!0),g.addChild(y);let D=o.createLineNode({points:[new n.Vector3(-a/2+.2*a,-h/2+.7*h),new n.Vector3(-a/2+.8*a,-h/2+.7*h)],material:c});D.setRenderDepth(0),D.setShadow(!1),D.setPickParent(!0),g.addChild(D);let S=o.createLineNode({points:[new n.Vector3(-a/2+.2*a,-h/2+.4*h),new n.Vector3(-a/2+.65*a,-h/2+.4*h)],material:c});S.setShadow(!1),S.setPickParent(!0),g.addChild(S)}h.setMatrix((new n.Matrix4).setPosition(t.position)),e&&e.activate(),function(){if(!t)return;let e=a.is3DMarkerDisplayed(u);h.setVisibility(t.isVisible&&e),u.render()}()}};let P=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){p&&p.dispose(),d&&d.dispose(),h.removeChildren(),p=d=t=null,P()}}}}),define("DS/DMUPlayMarker/DMUCommentPositioned",["require","exports","DS/DMUPlayMarker/DMUCommentAnnotationBase","DS/DMUBaseUIServices/DMUObjectsServices","DS/DMUPlayMarker/DMUCommentPositionedNode"],function(e,t,i,r,n){"use strict";let o=[{name:"bVisible",type:"bool",JSONname:"PropertiesMarkerBase.GraphicProperties.visible",defaultValue:!0}];return class extends i{constructor(e,t){super(e,t),this.addParameters(o);let i=this;this.setAttribute("sType","CommentPositioned"),this.setNode(new n({frmWindow:this._frmWindow,getType:this.getType})),this.getManipulationData=function(){return this.getNode().getCommentParams()},this.updateModel=function(e){i.updatePointedElement(e.position),i.setAttribute("vPosition",r.getRelativePosition(i,e.position))};let a=this.refreshNode;this.refreshNode=function(){i.getNode()&&!t.isImporting()&&(i.getNode().update({name:i.getAttribute("sName"),owner:i.getOwner(),pointedPage:i.getAttribute("fPointedPageNumber"),position:r.getAbsolutePosition(i,null,i.getAttribute("vPosition")),isVisible:!i.hasAlertFlag(),inEdition:i.isInEdition()}),a())}}}}),define("DS/DMUPlayMarker/DMUMarker3DCircleNode3D",["require","exports","DS/SceneGraphNodes/BillBoardNode3D","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/DMUBaseExperience/EXPToolsMaterial","DS/DMUPlayMarker/DMUMarkerTools","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUBaseUI/DMUManipulableNode3D"],function(e,t,i,r,n,o,a,s,l,d){"use strict";return class extends d{constructor(e){super(e);let t,d,c,p,h=this,u=h.getViewer(),g=1,P=new i({type:"Spherical"});this.addChild(P),P.setPickParent(!0);let f=new n;P.addChild(f),f.setPickParent(!0),this.linkManipulatorToNode(f),this.getRepNode=function(){return P},this.updateRepresentation=function(e,i){if(c){let n=c.radius?e.radius/c.radius:1,o=new r.Vector3(n,n,1);f.setMatrix((new r.Matrix4).scale(o)),h.setMatrix((new r.Matrix4).setPosition(e.position)),t&&t.line&&(t.setOpacity((c.graphicProperties.fillStyle.opacity||0)*(i?.6:1)),t.line.setOpacity((c.graphicProperties.lineStyle.opacity||0)*(i?.6:1)))}},this.getCircleParams=function(){return c?{position:c.center,radius:c.radius,pointedPage:c.pointedPage}:{}};let y=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){y(),p&&clearTimeout(p),p=null,t&&t.dispose(),t=P=c=f=null},this._updateVisibility=function(e){if(!c)return;void 0!==e&&(g=e);let t=s.is3DMarkerDisplayed(u,c.pointedReferences);h.setVisibility(g>0&&c.isVisible&&t),u.render()},this.update=function(e){if(!h)return;c||(c={graphicProperties:{fillStyle:{},lineStyle:{}}});let i=!1,n=[],p={paramA:c,paramB:e,merge:!0,mergedKeys:n};if(!s.compareAndMergeParams(p)||!d){let e=h.getRepManipulator();if(e&&e.deactivate(),h.setName(c.name),!d||n.includes("center")||n.includes("radius")){i=!0;let e=l.getMMPerPixelRatio(u,c.center);d=s.getCircleSegments(c.radius,e)}if(t?(n.includes("fillStyle")&&(i=!0,t.color=c.graphicProperties.fillStyle.color,t.setOpacity(c.graphicProperties.fillStyle.opacity)),n.includes("lineStyle")&&(i=!0,t.line.color=c.graphicProperties.lineStyle.color,t.line.setOpacity(c.graphicProperties.lineStyle.opacity),t.line.setLineWidth((c.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio),t.line.setDashPatternType(a.getDashType(c.graphicProperties.lineStyle.pattern)))):(i=!0,(t=a.createBasicMaterial({color:c.graphicProperties.fillStyle.color,opacity:c.graphicProperties.fillStyle.opacity})).line=a.createLineMaterial({color:c.graphicProperties.lineStyle.color,opacity:c.graphicProperties.lineStyle.opacity,lineWidth:(c.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio,pattern:c.graphicProperties.lineStyle.pattern})),(n.includes("isFilled")||n.includes("hasBorder"))&&(i=!0),i){f.removeChildren();let e=o.createCircleNode({radius:c.radius,fill:c.isFilled,segments:d,noEdge:!c.hasBorder,startAngle:0,endAngle:2*Math.PI,material:t});e.setShadow(!1),e.setPickParent(!0),f.addChild(e),f.setMatrix(new r.Matrix4)}h.setMatrix((new r.Matrix4).setPosition(c.center)),e&&e.activate(),h._updateVisibility()}};let D=function(){h&&h._updateVisibility(),p=null};this.onViewerEventCB=function(e){h&&c&&("onHideShow"!==e.eventType&&"onRepresentationLoaded"!==e.eventType&&"@onViewpointEndMove"!==e.eventType||("@onViewpointEndMove"===e.eventType&&h.isVisible()&&d!==s.getCircleSegments(c.radius,l.getMMPerPixelRatio(u,c.center))?(p&&clearTimeout(p),p=null,d=null,h.update(c)):p||!c.pointedReferences||"onHideShow"!==e.eventType&&"onRepresentationLoaded"!==e.eventType||(p=setTimeout(D))))}}}}),define("DS/DMUPlayMarker/DMUMarker3DPolylineNode3D",["require","exports","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/DMUBaseExperience/EXPToolsMaterial","DS/DMUPlayMarker/DMUMarkerTools","DS/DMUBaseUI/DMUManipulableNode3D"],function(e,t,i,r,n,o,a,s){"use strict";return class extends s{constructor(e){super(e);let t,s,l,d=this,c=d.getViewer(),p=1,h=new r;this.addChild(h),h.setPickParent(!0);let u,g=new r;h.addChild(g),g.setPickParent(!0),this.linkManipulatorToNode(g),this.getRepNode=function(){return h},this.updateRepresentation=function(e,i){if(!t)return;g.removeChildren();let r=n.createLineNode({points:e,material:s});r.setShadow(!1),r.setPickParent(!0),g.addChild(r),s&&s.setOpacity((t.graphicProperties.lineStyle.opacity||0)*(i?.6:1))},this.getPointsPosition=function(){return l||[]};let P=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){P(),u&&clearTimeout(u),u=null,s&&s.dispose(),h=g=t=s=l=null},this._updateVisibility=function(e){if(!t)return;void 0!==e&&(p=e);let i=a.is3DMarkerDisplayed(c,t.pointedReferences);d.setVisibility(p>0&&t.isVisible&&i),c.render()},this.update=function(e){if(!d)return;t||(t={graphicProperties:{lineStyle:{}}});let r=!1,c=[],p={paramA:t,paramB:e,merge:!0,mergedKeys:c},h=this.getRepManipulator();if(h&&h.deactivate(),!a.compareAndMergeParams(p)){if(d.setName(t.name),s?c.includes("lineStyle")&&(s.color=t.graphicProperties.lineStyle.color,s.setOpacity(t.graphicProperties.lineStyle.opacity),s.setLineWidth((t.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio),s.setDashPatternType(o.getDashType(t.graphicProperties.lineStyle.pattern))):(r=!0,s=o.createLineMaterial({color:t.graphicProperties.lineStyle.color,opacity:t.graphicProperties.lineStyle.opacity,lineWidth:(t.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio,pattern:t.graphicProperties.lineStyle.pattern})),!t.points||l&&!c.includes("points")||(r=!0,l=[],t.points.forEach(function(e){l&&l.push(new i.Vector3(e[0],e[1],e[2]))})),r&&l&&l.length>1){g.removeChildren();let e=n.createLineNode({points:l,material:s});e.setShadow(!1),e.setPickParent(!0),g.addChild(e)}d._updateVisibility()}h&&h.activate()};let f=function(){d&&d._updateVisibility(),u=null};this.onViewerEventCB=function(e){d&&t&&(u||!t.pointedReferences||"onHideShow"!==e.eventType&&"onRepresentationLoaded"!==e.eventType||(u=setTimeout(f)))}}}}),define("DS/DMUPlayMarker/DMUMarker3DPolyline",["require","exports","DS/DMUBaseExperience/EXPImportServices","DS/DMUPlayMarker/DMUMarker3D","DS/DMUPlayMarker/DMUMarker3DPolylineNode3D","DS/DMUPlayMarker/DMUMarker3DPoint","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r,n,o,a){"use strict";let s=[{name:"oPoints",type:"listObjects",JSONname:"PropertiesMultiPoint.Points"}];return class extends r{constructor(e,t,r){super(e,t),this.addParameters(s),this.removeParameters(["cFillStyleColor","bIsFilled","bHasBorder","fOpacity"]),this.setAttribute("sType","Marker3DPolyline");let l=this;this.setNode(r?new r({frmWindow:this._frmWindow,getType:this.getType}):new n({frmWindow:this._frmWindow,getType:this.getType})),this.initContextualBar("DS/DMUMarker/DMUMarkerLineContextualBar"),this.getManipulationData=function(){return this.getNode().getPointsPosition()},this.updateModel=function(e){let t=[];for(let i=0;i<e.length;i++)0===i&&l.updatePointedElement(e[i]),t.push({Point3D:a.getRelativePosition(l,e[i]).toArray()});l.setAttribute("oPoints",t)},this._pointsImporter=new i,this.getPointsPosition=function(){let e=l.getAttribute("oPoints")||[],t=[];return e.forEach(function(e){e instanceof o&&t.push(a.getAbsolutePosition(l,e.getAttribute("vRelativePosition"),e.getAttribute("vPosition"),l.getPointedReference(0)).toArray())}),t},this.getPoints=function(){let e=l.getAttribute("oPoints")||[];return e&&e.length&&e[0]instanceof o?e:(l.setAttribute("oPoints",e),e)};let d=this.refreshNode;this.refreshNode=function(){this.getPoints().forEach(function(e){e.refreshNode()}),l.getNode()&&!t.isImporting()&&(l.getNode().update({name:l.getAttribute("sName"),pointedReferences:l.getAttribute("lPointedReferences"),inEdition:l.isInEdition(),points:this.getPointsPosition(),pointedPage:l.getAttribute("fPointedPageNumber"),isVisible:l.getAttribute("bVisible")&&!l.hasAlertFlag(),graphicProperties:{lineStyle:{thickness:a.getLineThickness(l.getAttribute("fLineStyleThicknessIndex"))||l.getAttribute("fLineStyleThickness"),pattern:l.getAttribute("sLineStylePattern"),color:l.getAttribute("cLineStyleColor"),opacity:l.getAttribute("fLineStyleOpacity")}}}),d())};const c=this.setAttribute.bind(this);this.setAttribute=function(e,t){if("oPoints"===e&&Array.isArray(t)&&t.length){let i=l.getAttribute("oPoints");i||(i=[]);let r=[];for(let e=0;e<t.length;e++){let i;i=0===e?"Begin":e===t.length-1?"End":void 0,t[e]&&t[e].getType&&"DMUMarker3DPoint"===t[e].getType()?r.push({Name:void 0===t[e].getAttribute("sName")?i:t[e].getAttribute("sName"),Point3D:t[e].getAttribute("vPosition").toArray()}):(r.push(t[e]),r[e].Name||(r[e].Name=i))}for(let e=0;e<r.length;e++){if(i[e]&&i[e]instanceof o)l._pointsImporter.fillObjectAttributes(i[e],r[e]);else{let t=new o(l._viewer,l);l._pointsImporter.fillObjectAttributes(t,r[e]),i[e]=t}0===e&&this.updatePointedPosition(i[e].getAttribute("vPosition"))}c(e,i)}else c(e,t)}}}}),define("DS/DMUPlayMarker/DMUMarker3DCircle",["require","exports","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker3D","DS/DMUBaseUIServices/DMUObjectsServices","DS/DMUPlayMarker/DMUMarker3DCircleNode3D"],function(e,t,i,r,n,o){"use strict";let a=[{name:"vCenter",type:"Vector3",JSONname:"Properties3DCircle.Center",defaultValue:new i.Vector3},{name:"vCenterRelativePosition",type:"Vector3",JSONname:"Properties3DCircle.CenterRelativePosition",defaultValue:null},{name:"fRadius",type:"float",JSONname:"Properties3DCircle.Radius",defaultValue:100}];return class extends r{constructor(e,t){super(e,t),this.addParameters(a),this.setAttribute("sType","Marker3DCircle");let i=this;this.setNode(new o({frmWindow:this._frmWindow,getType:this.getType})),this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar"),this.getManipulationData=function(){return this.getNode().getCircleParams()},this.updateModel=function(e){i.updatePointedElement(e.position),i.setAttributes([{name:"vCenter",value:n.getRelativePosition(i,e.position)},{name:"fRadius",value:e.radius}])};let r=this.refreshNode;this.refreshNode=function(){if(i.getNode()&&!t.isImporting()){let e=!i.getAttribute("bHasBorder")&&!i.getAttribute("bIsFilled")||i.getAttribute("bHasBorder"),t=i.getAttribute("bHasBorder")||i.getAttribute("bIsFilled")?i.getAttribute("cLineStyleColor"):i.getAttribute("cFillStyleColor"),o=i.getAttribute("bHasBorder")||i.getAttribute("bIsFilled")?n.getLineThickness(i.getAttribute("fLineStyleThicknessIndex"))||i.getAttribute("fLineStyleThickness"):5;i.getNode().update({name:i.getAttribute("sName"),pointedReferences:i.getAttribute("lPointedReferences"),radius:i.getAttribute("fRadius"),center:n.getAbsolutePosition(i,i.getAttribute("vCenterRelativePosition"),i.getAttribute("vCenter"),i.getPointedReference(0)),inEdition:i.isInEdition(),isVisible:i.getAttribute("bVisible")&&!i.hasAlertFlag(),isFilled:i.getAttribute("bIsFilled"),hasBorder:e,pointedPage:i.getAttribute("fPointedPageNumber"),pointedElement:i.getAttribute("sPointedElementID"),graphicProperties:{fillStyle:{color:i.getAttribute("cFillStyleColor"),opacity:i.getAttribute("fOpacity")},lineStyle:{pattern:i.getAttribute("sLineStylePattern"),thickness:o,color:t,opacity:i.getAttribute("fLineStyleOpacity")}}}),r()}};const s=this.setAttribute.bind(this);this.setAttribute=function(e,t){i.getParent().isImporting()||!1!==t||"bHasBorder"!==e||i.getAttribute("bIsFilled")?i.getParent().isImporting()||!1!==t||"bIsFilled"!==e||i.getAttribute("bHasBorder")?"cLineStyleColor"!==e||i.getAttribute("bIsFilled")||i.getAttribute("bHasBorder")?"vCenter"===e?(i.updatePointedPosition(t),s(e,t)):"fRadius"===e?t>0&&s("fRadius",t):s(e,t):s("cFillStyleColor",t):(i.setAttribute("bHasBorder",!0),s(e,t)):(i.setAttribute("bIsFilled",!0),s(e,t))};const l=this.getAttribute.bind(this);this.getAttribute=function(e){return"cLineStyleColor"!==e||this.getAttribute("bIsFilled")||this.getAttribute("bHasBorder")?"vCenter"===e?l("vCenter").clone():l(e):l("cFillStyleColor")}}}}),define("DS/DMUPlayMarker/DMUMarker3DLine",["require","exports","DS/DMUPlayMarker/DMUMarker3DPolyline"],function(e,t,i){"use strict";return class extends i{constructor(e,t){super(e,t),this.setAttribute("sType","Marker3DLine")}}}),define("DS/DMUPlayMarker/DMUMarker3DFreehand",["require","exports","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker3DFreehandNode3D","DS/DMUPlayMarker/DMUMarker3DPoint","DS/DMUBaseUIServices/DMUObjectsServices","DS/DMUPlayMarker/DMUMarker3DPolyline"],function(e,t,i,r,n,o,a){"use strict";return class extends a{constructor(e,t){super(e,t,r),this.setAttribute("sType","Marker3DFreehand");let a,s,l=this;this.getType=function(){return"DMUMarker3DFreehand"},this.getManipulationData=function(){return l.getNode().getBoundingBoxDimensions()},this.updateProjectionPlaneDefinition=function({up:e,right:t}){if(!a||a.equals(e)||s.equals(t))a=e.clone(),s=t.clone();else{let r=l.getNode().getBoundingBoxDimensions(),d=o.getRelativePosition(l,r.position),c=a.clone(),p=s.clone(),h=(new i.Vector3).crossVectors(p,c),u=(new i.Matrix4).makeBasis(p,c,h).setPosition(d),g=(new i.Matrix4).getInverse(u);a=e.clone(),s=t.clone();let P=(new i.Vector3).crossVectors(s,a),f=(new i.Matrix4).makeBasis(s,a,P).setPosition(d).clone().multiply(g);(l.getPoints()||[]).forEach(function(e){if(e instanceof n){let t=e.getAttribute("vPosition");t.applyMatrix4(f),e.setAttribute("vPosition",t)}})}l.refreshNode()},this.updateModel=function(e){let t=(new i.Vector3).crossVectors(s,a),r=l.getNode().getBoundingBoxDimensions(),d=(new i.Matrix4).makeRotationZ(o.getRelativeRotation(l,0)),c=new i.Vector3((Math.cos(o.getRelativeRotation(l,0))+Math.sin(o.getRelativeRotation(l,0)))*Math.abs(e.width/r.width),(Math.cos(o.getRelativeRotation(l,0))-Math.sin(o.getRelativeRotation(l,0)))*Math.abs(e.height/r.height),1).applyMatrix4(d),p=(new i.Matrix4).makeScale(c.x,c.y,c.z),h=(new i.Matrix4).makeBasis(s,a,t),u=(new i.Matrix4).multiplyMatrices(h,p),g=(new i.Matrix4).getInverse(h,!0);u.multiply(g);let P=l.getPoints()||[],f=o.getRelativePosition(l,r.position);l.updatePointedElement(e.position),l.updatePointedPosition(o.getRelativePosition(l,e.position));let y=(new i.Matrix4).getInverse(d);P.forEach(function(t){if(t instanceof n){let i=t.getAttribute("vPosition");i.sub(f),i.applyMatrix4(u),i.applyMatrix4(y),i.add(e.position),t.setAttribute("vPosition",o.getRelativePosition(l,i))}}),l.setAttribute("fRotationAngle",e.rotation)},this.refreshNode=function(){l.getNode()&&!t.isImporting()&&a&&s&&l.getNode().update({name:l.getAttribute("sName"),pointedReferences:l.getAttribute("lPointedReferences"),inEdition:l.isInEdition(),points:l.getPointsPosition(),projectionPlaneVectors:{up:a,right:s},rotationAngle:l.getAttribute("fRotationAngle")||0,pointedPage:l.getAttribute("fPointedPageNumber"),isVisible:l.getAttribute("bVisible")&&!l.hasAlertFlag(),graphicProperties:{lineStyle:{thickness:o.getLineThickness(l.getAttribute("fLineStyleThicknessIndex"))||l.getAttribute("fLineStyleThickness"),pattern:l.getAttribute("sLineStylePattern"),color:l.getAttribute("cLineStyleColor"),opacity:void 0===l.getAttribute("fLineStyleOpacity")?1:l.getAttribute("fLineStyleOpacity")}}})}}}}),define("DS/DMUPlayMarker/DMUMarkerFactory",["UWA/Utils","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker3DSpline","DS/DMUPlayMarker/DMUMarker3DLine","DS/DMUPlayMarker/DMUMarker3DCircle","DS/DMUPlayMarker/DMUMarker3DEllipse","DS/DMUPlayMarker/DMUMarker3DRectangle","DS/DMUPlayMarker/DMUMarker3DPicture","DS/DMUPlayMarker/DMUMarker3DFreehand","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUPlayMarker/DMUMarkerTools"],function(e,t,i,r,n,o,a,s,l,d,c){"use strict";var p,h=0;return{create3DMarker:function(u){if(!(u&&u.viewer&&u.shape&&u.shape.type&&u.parent))return;var g,P,f=u.viewer;let y,D=Boolean(u.pointedElement||u.pageNb);switch(D&&(y=new t.Vector3(0,0,0)),u.shape.type){case"circle":if(u.shape.data&&u.shape.data.centre&&u.getRelativePositionCB&&u.getRelativeRotationCB){var S=d.getNearPositionFrom2DCoordinates(new t.Vector2(u.shape.data.centre.x,u.shape.data.centre.y),f,y,D);P=d.getMMPerPixelRatio(f,S),g=new n(f,u.parent);let i=u.getElementIDAtPosition(S);g.setAttributes([{name:"sID",value:u.parent.computeNewID()},{name:"sUuid",value:e.getUUID()},{name:"sName",value:u.parent.computeNewName({object:g,prefix:"CircleMarker3D"})},{name:"vCenter",value:u.getRelativePositionCB(S,i)},{name:"fRadius",value:u.shape.data.radius*P},{name:"cLineStyleColor",value:u.graphicProperties.lineStyleColor?u.graphicProperties.lineStyleColor:new t.Color(13371695)},{name:"cFillStyleColor",value:u.graphicProperties.lineStyleColor?u.graphicProperties.lineStyleColor:new t.Color(13371695)},{name:"fLineStyleThicknessIndex",value:void 0!==u.graphicProperties.lineStyleThicknessIndex?u.graphicProperties.lineStyleThicknessIndex:3},{name:"fLineStyleOpacity",value:void 0!==u.graphicProperties.lineStyleOpacity?u.graphicProperties.lineStyleOpacity:1},{name:"fOpacity",value:void 0!==u.graphicProperties.lineStyleOpacity?u.graphicProperties.lineStyleOpacity:1},{name:"bIsFilled",value:void 0!==u.graphicProperties.isFilled&&u.graphicProperties.isFilled},{name:"bHasBorder",value:void 0===u.graphicProperties.hasBorder||u.graphicProperties.hasBorder},{name:"fPointedPageNumber",value:u.pageNb},{name:"sPointedElementID",value:u.getElementIDAtPosition(S,i)}])}break;case"square":case"rectangle":if(u.shape.data&&u.shape.data.vertices&&4===u.shape.data.vertices.length&&u.getRelativePositionCB&&u.getRelativeRotationCB){var m=u.shape.data.vertices[0].clone().sub(u.shape.data.vertices[3]).length(),M=u.shape.data.vertices[0].clone().sub(u.shape.data.vertices[1]).length(),b=u.shape.data.vertices[0].clone().sub(u.shape.data.vertices[3]).angle()*Math.sign(u.shape.data.vertices[0].y-u.shape.data.vertices[3].y);if(b%=Math.PI/2,Math.abs(b)>Math.PI/4){b-=Math.PI/2*Math.sign(b);var v=m;m=M,M=v}var A=d.getNearPositionFrom2DCoordinates(new t.Vector2((u.shape.data.vertices[0].x+u.shape.data.vertices[2].x)/2,(u.shape.data.vertices[0].y+u.shape.data.vertices[2].y)/2),f,y,D);P=d.getMMPerPixelRatio(f,A),g=new a(f,u.parent);let i=u.getElementIDAtPosition(A);g.setAttributes([{name:"sID",value:u.parent.computeNewID()},{name:"sUuid",value:e.getUUID()},{name:"sName",value:u.parent.computeNewName({object:g,prefix:"RectangleMarker3D"})},{name:"vPosition",value:u.getRelativePositionCB(A,i)},{name:"fWidth",value:m*P},{name:"fHeight",value:M*P},{name:"fRotationAngle",value:u.getRelativeRotationCB(b)},{name:"cLineStyleColor",value:u.graphicProperties.lineStyleColor?u.graphicProperties.lineStyleColor:new t.Color(13371695)},{name:"cFillStyleColor",value:u.graphicProperties.lineStyleColor?u.graphicProperties.lineStyleColor:new t.Color(13371695)},{name:"fLineStyleThicknessIndex",value:void 0!==u.graphicProperties.lineStyleThicknessIndex?u.graphicProperties.lineStyleThicknessIndex:3},{name:"fLineStyleOpacity",value:void 0!==u.graphicProperties.lineStyleOpacity?u.graphicProperties.lineStyleOpacity:1},{name:"fOpacity",value:void 0!==u.graphicProperties.lineStyleOpacity?u.graphicProperties.lineStyleOpacity:1},{name:"bIsFilled",value:void 0!==u.graphicProperties.isFilled&&u.graphicProperties.isFilled},{name:"bHasBorder",value:void 0===u.graphicProperties.hasBorder||u.graphicProperties.hasBorder},{name:"fPointedPageNumber",value:u.pageNb},{name:"sPointedElementID",value:u.getElementIDAtPosition(A,i)}])}break;case"ellipse":if(u.shape.data&&u.shape.data.centre&&u.getRelativePositionCB&&u.getRelativeRotationCB){var x=d.getNearPositionFrom2DCoordinates(new t.Vector2(u.shape.data.centre.x,u.shape.data.centre.y),f,y,D);P=d.getMMPerPixelRatio(f,x);var w=2*u.shape.data.radius1*P,k=2*u.shape.data.radius2*P,N=-u.shape.data.angle*Math.PI/180;if(Math.abs(N)>Math.PI/4){N%=Math.PI/2,N-=Math.PI/2*Math.sign(N);var U=w;w=k,k=U}g=new o(f,u.parent);let i=u.getElementIDAtPosition(x);g.setAttributes([{name:"sID",value:u.parent.computeNewID()},{name:"sUuid",value:e.getUUID()},{name:"sName",value:u.parent.computeNewName({object:g,prefix:"EllipseMarker3D"})},{name:"vCenter",value:u.getRelativePositionCB(x,i)},{name:"fxAxisLength",value:w},{name:"fyAxisLength",value:k},{name:"fRotationAngle",value:u.getRelativeRotationCB(N)},{name:"cLineStyleColor",value:u.graphicProperties.lineStyleColor?u.graphicProperties.lineStyleColor:new t.Color(13371695)},{name:"cFillStyleColor",value:u.graphicProperties.lineStyleColor?u.graphicProperties.lineStyleColor:new t.Color(13371695)},{name:"fLineStyleThicknessIndex",value:void 0!==u.graphicProperties.lineStyleThicknessIndex?u.graphicProperties.lineStyleThicknessIndex:3},{name:"fLineStyleOpacity",value:void 0!==u.graphicProperties.lineStyleOpacity?u.graphicProperties.lineStyleOpacity:1},{name:"fOpacity",value:void 0!==u.graphicProperties.lineStyleOpacity?u.graphicProperties.lineStyleOpacity:1},{name:"bIsFilled",value:void 0!==u.graphicProperties.isFilled&&u.graphicProperties.isFilled},{name:"bHasBorder",value:void 0===u.graphicProperties.hasBorder||u.graphicProperties.hasBorder},{name:"fPointedPageNumber",value:u.pageNb},{name:"sPointedElementID",value:u.getElementIDAtPosition(x,i)}])}break;case"picture":var C=u.shape.data.image?u.shape.data.image.width:300,T=u.shape.data.image?u.shape.data.image.height:300;C>300&&(T=300*T/C,C=300),T>300&&(C=300*C/T,T=300),C=Math.round(C),T=Math.round(T),p&&p.equals(u.shape.pointingPoint)?h++:(p=u.shape.pointingPoint.clone(),h=0);var V=u.shape.pointingPoint,I=d.getWindowPositionFromPoint(f,V,u.frameWindow),R=d.getDistanceFromPixel(f,V,C,u.frameWindow);I.right<C&&(R=-R);var L=d.getViewpointInfo(f.currentViewpoint),B=L.right.clone().multiplyScalar(R);V=u.shape.pointingPoint.clone().add(B),h&&(P=d.getMMPerPixelRatio(f,V),V.add(L.right.clone().multiplyScalar(20*h*P)).add(L.up.clone().multiplyScalar(20*-h*P))),(g=new s(f,u.parent)).setAttributes([{name:"sID",value:u.parent.computeNewID()},{name:"sUuid",value:e.getUUID()},{name:"sName",value:u.parent.computeNewName({object:g,prefix:"PictureMarker3D"})},{name:"lLeaderPointingPoints",value:[u.shape.pointingPoint]},{name:"bHasALeader",value:!0},{name:"sLeaderEndType",value:"Arrow"},{name:"bIsFilled",value:!0},{name:"bHasBorder",value:!1},{name:"fFontSize",value:3.5},{name:"fBorderRadius",value:4},{name:"bShortDisplay",value:!1},{name:"sRelatedObjectId",value:u.objectId},{name:"fCreationDate",value:u.date},{name:"vLeaderBreakPoint3D",value:V},{name:"fImageWidth",value:d.convertPixelToModel({sizeInPixels:C,viewer:f})},{name:"fImageHeight",value:d.convertPixelToModel({sizeInPixels:T,viewer:f})}]),g.setRelatedObjectData(u.shape.data);break;case"freehand":if(u.points&&u.points.length){let i=[],r=[];i=u.points;let n=-1/0,o=1/0,a=-1/0,s=1/0;i.forEach(function(e){n=Math.max(n,e.x),o=Math.min(o,e.x),a=Math.max(a,e.y),s=Math.min(s,e.y)});let c=new t.Vector2(o,a),p=new t.Vector2(n,s),h=(new t.Vector2).addVectors(c,p).multiplyScalar(.5),P=d.getNearPositionFrom2DCoordinates(h,f,u.pointedElement||u.pageNb?y:u.projectionPoint,!0);i.forEach(function(e){let t=u.getElementIDAtPosition(P),i=d.get3DPositionFromScreenCoordinates({coords:e,viewer:f}),n=u.getRelativePositionCB(d.getPositionFromIntersection(f,i,P),t);r.push({Point3D:n.toArray()})}),g=new l(f,u.parent);let D=u.getElementIDAtPosition(P);g.setAttributes([{name:"sID",value:u.parent.computeNewID()},{name:"sUuid",value:e.getUUID()},{name:"sName",value:u.parent.computeNewName({object:g,prefix:"FreehandMarker3D"})},{name:"oPoints",value:r},{name:"fRotationAngle",value:0},{name:"cLineStyleColor",value:u.graphicProperties.lineStyleColor?u.graphicProperties.lineStyleColor:new t.Color(13371695)},{name:"fLineStyleThicknessIndex",value:void 0!==u.graphicProperties.lineStyleThicknessIndex?u.graphicProperties.lineStyleThicknessIndex:3},{name:"fLineStyleOpacity",value:void 0!==u.graphicProperties.lineStyleOpacity?u.graphicProperties.lineStyleOpacity:1},{name:"fPointedPageNumber",value:u.pageNb},{name:"sPointedElementID",value:u.getElementIDAtPosition(P,D)}]);let S=d.getViewpointInfo(f.currentViewpoint);g.updateProjectionPlaneDefinition({up:S.up,right:S.right})}break;default:if(u.points&&u.points.length){var O=[],E=[];if(2===(O=c.getControlPoints(u.points,15)).length){var F,W,_,H;Math.abs(O[0].y-O[1].y)<d.convertModelToPixels({sizeInMM:5})&&(O[1].y=O[0].y);var J=(new t.Vector2).addVectors(O[0],O[1]).multiplyScalar(.5),z=d.getPickingInfo(f,O[0]),G=d.getPickingInfo(f,O[1]);z.paths&&z.paths.length&&G.paths&&G.paths.length?(F=z.point,W=G.point):(H=d.getPickingInfo(f,J),z.paths&&z.paths.length?(F=z.point,_=H.paths&&H.paths.length?H.point:z.point,W=d.getPositionFromIntersection(f,d.get3DPositionFromScreenCoordinates({coords:O[1],viewer:f}),_)):G.paths&&G.paths.length?(W=G.point,_=H.paths&&H.paths.length?H.point:G.point,F=d.getPositionFromIntersection(f,d.get3DPositionFromScreenCoordinates({coords:O[0],viewer:f}),_)):H.paths&&H.paths.length?(F=d.getPositionFromIntersection(f,d.get3DPositionFromScreenCoordinates({coords:O[0],viewer:f}),H.point),W=d.getPositionFromIntersection(f,d.get3DPositionFromScreenCoordinates({coords:O[1],viewer:f}),H.point)):(F=d.getNearPositionFrom2DCoordinates(O[0],f,y,D),W=d.getNearPositionFrom2DCoordinates(O[1],f,F)));let i=u.getElementIDAtPosition(F)?u.getElementIDAtPosition(F):u.getElementIDAtPosition(W);E.push({Name:"Begin",PointType:0,Size:1,Point3D:u.getRelativePositionCB(F,i).toArray()}),E.push({Name:"End",PointType:0,Size:1,Point3D:u.getRelativePositionCB(W,i).toArray()}),(g=new r(f,u.parent)).setAttributes([{name:"sID",value:u.parent.computeNewID()},{name:"sUuid",value:e.getUUID()},{name:"sName",value:u.parent.computeNewName({object:g,prefix:"LineMarker3D"})},{name:"oPoints",value:E},{name:"cLineStyleColor",value:u.graphicProperties.lineStyleColor?u.graphicProperties.lineStyleColor:new t.Color(13371695)},{name:"fLineStyleThicknessIndex",value:void 0!==u.graphicProperties.lineStyleThicknessIndex?u.graphicProperties.lineStyleThicknessIndex:3},{name:"fLineStyleOpacity",value:void 0!==u.graphicProperties.lineStyleOpacity?u.graphicProperties.lineStyleOpacity:1},{name:"fPointedPageNumber",value:u.pageNb},{name:"sPointedElementID",value:i}])}else{var j=-1/0,q=1/0,X=-1/0,Z=1/0;O.forEach(function(e){j=Math.max(j,e.x),q=Math.min(q,e.x),X=Math.max(X,e.y),Z=Math.min(Z,e.y)});var K=new t.Vector2(q,X),Q=new t.Vector2(j,Z),Y=(new t.Vector2).addVectors(K,Q).multiplyScalar(.5),$=d.getNearPositionFrom2DCoordinates(Y,f,y,D);O.forEach(function(e){let t=u.getElementIDAtPosition($);var i=d.get3DPositionFromScreenCoordinates({coords:e,viewer:f}),r=u.getRelativePositionCB(d.getPositionFromIntersection(f,i,$),t);E.push({Point3D:r.toArray()})}),g=new i(f,u.parent);let r=u.getElementIDAtPosition($);g.setAttributes([{name:"sID",value:u.parent.computeNewID()},{name:"sUuid",value:e.getUUID()},{name:"sName",value:u.parent.computeNewName({object:g,prefix:"SplineMarker3D"})},{name:"oPoints",value:E},{name:"fRotationAngle",value:0},{name:"cLineStyleColor",value:u.graphicProperties.lineStyleColor?u.graphicProperties.lineStyleColor:new t.Color(13371695)},{name:"fLineStyleThicknessIndex",value:void 0!==u.graphicProperties.lineStyleThicknessIndex?u.graphicProperties.lineStyleThicknessIndex:3},{name:"fLineStyleOpacity",value:void 0!==u.graphicProperties.lineStyleOpacity?u.graphicProperties.lineStyleOpacity:1},{name:"fPointedPageNumber",value:u.pageNb},{name:"sPointedElementID",value:u.getElementIDAtPosition($,r)}]);let n=d.getViewpointInfo(f.currentViewpoint);g.updateProjectionPlaneDefinition({up:n.up,right:n.right})}}}return g}}}),define("DS/DMUPlayMarker/DMUMarker2DPoint",["DS/DMUBaseExperience/DMUOverloadableObject","DS/DMUPlayMarker/DMUMarker2DPointNode3D","DS/DMUPlayMarker/DMUMarkerImport"],function(e,t,i){"use strict";var r=[{name:"iPointType",type:"int",JSONname:"PointType"},{name:"iSize",type:"float",JSONname:"Size"},{name:"vPosition",type:"Vector2",JSONname:"Point2D"},{name:"vRelativePosition",type:"Vector2",JSONname:"RelativePos"}];return e.extend({init:function(e,n){this._parent(e,n),this.addParameters(r),this.setAttribute("sType","Marker2DPoint");var o=this,a=new i(o);this.importData=a.importData,this.afterImport=a.afterImport,this.setNode(new t({frmWindow:this._frmWindow,getType:this.getType}));var s=this.refreshNode;this.refreshNode=function(){o.getNode()&&!n.isImporting()&&(o.getNode().update({name:o.getAttribute("sName"),pointType:o.getAttribute("iPointType"),size:o.getAttribute("iSize"),position:o.getAttribute("vPosition"),relativePos:o.getAttribute("vRelativePosition"),windowAnchor:o.getAttribute("sWindowAnchor"),isPositionProportional:o.getAttribute("bProportionalPosition")}),s())}}})}),define("DS/DMUPlayMarker/DMUMarker2DPolyline",["DS/DMUPlayMarker/DMUMarker2D","DS/DMUPlayMarker/DMUMarker2DPolylineNode3D","DS/DMUPlayMarker/DMUMarker2DPoint","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPImportServices","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r,n,o){"use strict";var a=[{name:"oPoints",type:"objectDefinition",JSONname:"Properties2DMultiPoint.Points"}];return e.extend({init:function(e,s){this._parent(e,s),this.addParameters(a),this.removeParameters(["cFillStyleColor","bIsFilled","bHasBorder","fOpacity"]),this.setAttribute("sType","Marker2DPolyline");var l=this,d=[],c=new n;this.getPoints=function(e){var t;if(e||!d.length){var n=l.getAttribute("oPoints");for(t=0;t<d.length;t++)d[t].remove();for(d.length=0,t=0;t<n.length;t++){var o=r.getReviewContext({viewer:l._viewer}),a=new i(l.getViewer(),o.getCurrentSessionMarkup());c.fillObjectAttributes(a,n[t]),d.push(a)}}return d},this.setNode(new t({frmWindow:this._frmWindow,getType:this.getType,getPoints:this.getPoints})),this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar");var p=this.refreshNode;this.refreshNode=function(){l.getNode()&&!s.isImporting()&&(l.getNode().update({name:l.getAttribute("sName"),isVisible:l.getAttribute("bVisible"),windowAnchor:l.getAttribute("sWindowAnchor"),isPositionProportional:l.getAttribute("bProportionalPosition"),points:l.getAttribute("oPoints"),rotationAngle:"number"==typeof l.getAttribute("fScreenRotationAngle")?l.getAttribute("fScreenRotationAngle"):l.getAttribute("fRotationAngle"),graphicProperties:{lineStyle:{thickness:o.getLineThickness(l.getAttribute("fLineStyleThicknessIndex"))||l.getAttribute("fLineStyleThickness"),pattern:l.getAttribute("sLineStylePattern"),color:l.getAttribute("cLineStyleColor"),opacity:l.getAttribute("fLineStyleOpacity")}}}),p())},this.getMaximumProportionalWidth=function(){var e=0;if(l.getAttribute("bProportionalPosition"))for(var t,i=l.getPoints(),r=0;r<i.length;r++)t=i[r].getAttribute("vPosition"),Math.abs(t.x)>e&&(e=Math.abs(t.x));return e}}})}),define("DS/DMUPlayMarker/DMUMarker2DLine",["DS/DMUPlayMarker/DMUMarker2DPolyline"],function(e){"use strict";return e.extend({init:function(e,t){this._parent(e,t),this.setAttribute("sType","Marker2DLine")}})});