define("DS/VCXWebDressup/CXPCameraActorVCXCXPConvertor",["DS/VCXWebEWS/CXPExperienceObjectVCXCXPConvertor"],function(e){"use strict";var t=e.extend({init:function(){this._tab=[{variableName:"_varName",propertyName:"Actor.Name"},{variableName:"viewAngle",propertyName:"Ambience.Background.Radius"},{variableName:"projectionType",propertyName:"Ambience.Background.Position",NFVFunction:function(e){return 0!==e},VFNFunction:function(e){return e?1:0}},{variableName:"focusDistance",propertyName:"Ambience.Background.Rotation"}]}});return Object.defineProperty(t.prototype,"componentType",{enumerable:!0,get:function(){return"CXPCameraActorVCXCXPConvertor"}}),t}),define("DS/VCXWebDressup/VCXComponentPartListManager",["UWA/Class","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebModifiables/VCXModelChangeListener","DS/VCXWebVisu/VCXModifiablesAccess"],function(e,t,i,r,o,a,n,s,l){"use strict";var p=e.extend({init:function(){},postUpdate:function(e){this.filterHasChanged=!1,this.turnOnPartListVisibility=!1},GetColumn:function(e){var t=this.QueryInterface("VCXIModifiable");if(t){var i=t.GetProperty("ColumnTreeList.ColumnList").GetPropertyValue();if(e>=i._value.length)return;return i.GetValueAtIndex(e)}},GetColumnName:function(e){var t=this.GetColumn(e);return void 0===t?void 0:t.GetValueAtIndex(0)},GetColumnWidth:function(e){var t=this.GetColumn(e);return void 0===t?void 0:t.GetValueAtIndex(1)},GetColumnCommonRoot:function(e){var t=this.GetColumn(e);return void 0===t?void 0:t.GetValueAtIndex(2)},GetColumnLabel:function(e){var t=this.GetColumn(e);return void 0===t?void 0:t.GetValueAtIndex(3)},GetPropertyValueAt:function(e,t){var i=this.GetColumn(e);return void 0===i?void 0:i.GetValueAtIndex(t)},GetPropertyValueIdentifierAt:function(e,t){var i=void 0;switch(t){case 0:i="ColumnTree.Name";break;case 1:i="ColumnTree.Width";break;case 2:i="ColumnTree.CommonRoot";break;case 3:i="ColumnTree.Label"}return i},GetColumnNumber:function(){var e=this.QueryInterface("VCXIModifiable");return e?e.GetProperty("ColumnTreeList.ColumnList").GetPropertyValue()._value.length:0},SetSortOption:function(e){var n=this.QueryInterface("VCXIModifiable");if(n){var s=new r;s.SetValue(e.propertyName);var l=new t(new i("BOM.Sort.PropertyName",0),s),p=new a(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.getManager("VCXCommandManager"),!0);p.ChangeProperty(n,l),this._experienceBase.getManager("VCXCommandManager").Push(p),(s=new o).SetValue(e.ascendant),l=new t(new i("BOM.Sort.Ascendant",0),s),(p=new a(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.getManager("VCXCommandManager"),!0)).ChangeProperty(n,l),this._experienceBase.getManager("VCXCommandManager").Push(p)}},GetSortOption:function(){var e=this.QueryInterface("VCXIModifiable");if(e){var t=e.GetProperty("BOM.Sort.Ascendant"),i=t.GetPropertyValue().Value;return{propertyName:(t=e.GetProperty("BOM.Sort.PropertyName")).GetPropertyValue().Value,ascendant:i}}return 0},GetColumnPropertyValuesNumber:function(){return 4},GetBOMId:function(e){for(var t=this.GetBOMContent(!1),i=e.GetObject().QueryInterface("W3AISGNodeHolder").getPathElement().getLastElement(),r=1;;r++){if(!t[r])return r;if(t[r].element===i)return r}},GetBOMContent:function(e){for(var t=!1,i=[],r=this._experienceBase.getManager("VCXDressupManager").getDressupsFromGroup("Callouts"),o=0;o<r.length&&e;o++){var a=r[o];if(a){var s=a.QueryInterface("VCXIVisibility");if(s&&s.GetVisibility()!==n.EVisState.Hidden){var p=a.QueryInterface("VCXIModifiable");if(p){let e=null;var u=p.GetAttachedOccurences();if(u&&u.length>0&&(e=u[0]),!e)continue;let r=p.GetProperty("Collab.Text").GetPropertyValue().ToString(),o=l.GetLinkedParentLevelFromPropertyValue(r,e.GetObject().GetID(),this._experienceBase);if(o){var h=o.QueryInterface("VCXIVisibility");if(o.PartListEnabled&&h&&h.GetVisibility()){let e=o.PartListID;e&&(t=!0,i[e]||(i[e]={},i[e].calloutComponents=[],i[e].itemComponents=[]),i[e].calloutComponents.push(a),i[e].itemComponents.indexOf(o)<0&&i[e].itemComponents.push(o),null!==o.QueryInterface("W3AISGNodeHolder").getPathElement()&&(i[e].element=o.QueryInterface("W3AISGNodeHolder").getPathElement().getLastElement()))}}}}}}t||(e=!1);for(var d=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceComposer"),c=0;c<d.length;c++){var y=d[c];if(y)if((h=y.QueryInterface("VCXIVisibility"))&&h.GetVisibility())if(y.PartListEnabled){var C=y.PartListID;C>0&&(e||i[C]||(i[C]={},i[C].itemComponents=[]),i[C]&&i[C].itemComponents.indexOf(y)<0&&(i[C].itemComponents.push(y),i[C].element=y.QueryInterface("W3AISGNodeHolder").getPathElement().getLastElement()))}}return i}});return Object.defineProperty(p.prototype,"filterHasChanged",{enumerable:!0,get:function(){return this._filterHasChanged},set:function(e){this._filterHasChanged=e}}),Object.defineProperty(p.prototype,"turnOnPartListVisibility",{enumerable:!0,get:function(){return this._turnOnPartListVisibility},set:function(e){this._turnOnPartListVisibility=e}}),Object.defineProperty(p.prototype,"ListHasChanged",{enumerable:!0,get:function(){var e=!1,t=this._experienceBase.getManager("VCXModelChangeListener");return t&&(e|=t.hasChanged(s.FChangeFlag.PartListID),e|=t.hasChanged(s.FChangeFlag.PartListEnabled),e|=t.hasChanged(s.FChangeFlag.PartListDescription),e|=t.hasChanged(s.FChangeFlag.DressupVisibility),e|=t.hasChanged(s.FChangeFlag.Visibility)),e|=this.filterHasChanged}}),Object.defineProperty(p.prototype,"componentType",{enumerable:!0,get:function(){return"VCXComponentPartListManager"}}),p}),define("DS/VCXWebDressup/VCXDressupModelNavigable",["UWA/Class","DS/WebApplicationBase/VCXAModelNavigable"],function(e,t){"use strict";return t.extend({isSelfOrganized:function(){return!0}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShape",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools"],function(e,t,i){"use strict";return e.extend({init:function(e){this.sizeView=e,this.fHalfSizeX=.5*this.sizeView.x,this.fHalfSizeY=.5*this.sizeView.y,this.iCurrent=0},next:function(){return this.iCurrent++,this.iCurrent>=this.iNbPt&&(this.iCurrent=this.iNbPt-1),!1},rewind:function(){this.iCurrent=0,this.iNbPt=(Math.floor(this.sizeView.x/this.fCellSize)+1)*(Math.floor(this.sizeView.y/this.fCellSize)+1)},getPoint:function(){}})}),define("DS/VCXWebDressup/VCX3DGridManager",["UWA/Class","DS/CoreEvents/Events","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueLink","DS/VCXWebProperties/VCXPropertyValueLocation","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebIO/VCXLogServices"],function(e,t,i,r,o,a,n,s,l,p,u,h){"use strict";const d=e.extend({init:function(){this.patternColors=[],this._isSomethingManipulatedOn=null,this._logUUID=null},initialize:function(){this.grids={},this.tokens={}},postInitialize:function(){this.currentChosenColorIdx=-1,this.patternColors.push((new r).FromRGBA(.52,.25,.22,1)),this.patternColors.push((new r).FromRGBA(.28,.47,.22,1)),this.patternColors.push((new r).FromRGBA(0,.24,.35,1)),this.patternColors.push((new r).FromRGBA(0,0,0,1)),this.patternColors.push((new r).FromRGBA(.56,.3,0,1)),this.tokens.addDressup=t.subscribe({event:"VCX_DRESSUPS_ADDED"},e=>this.addNewGrid(e)),this.tokens.removeDressup=t.subscribe({event:"VCX_DRESSUPS_PREREMOVED"},e=>this.removeGrid(e)),this.tokens.unLinkGrids=t.subscribe({event:"VCX_INTERACTOR_END_MANIPULATE"},()=>{for(let e in this.grids)if(this.grids.hasOwnProperty(e)){let t=this.grids[e];if(t){const e=t.QueryInterface("VCXIManipulable");e&&e.unLinkSnappedAfterManipulation()}}}),this.tokens.destroyGrids=t.subscribe({event:"VCX_END_RULERS"},()=>{this._destroyAllRulers()})},unInitialize:function(){for(let e in this.tokens)this.tokens.hasOwnProperty(e)&&(t.unsubscribe(this.tokens[e]),delete this.tokens.tokenID)},getCurrentColor:function(){return this.patternColors[this.currentChosenColorIdx]},addNewGrid:function(e){e&&e.forEach(e=>{if(e.IsKindOf("VCX3DGrid_Spec")){this.grids[e.GetID()]=e;let t=e.QueryInterface("VCXIModifiable");t&&(this.currentChosenColorIdx++,this.currentChosenColorIdx%=this.patternColors.length,t.OnChangeProperty("Actor.Color",new u(this.patternColors[this.currentChosenColorIdx]))),this.Dirty=!0}})},showHideAllGrids:function(e){if(this.grids)for(let t in this.grids)if(this.grids.hasOwnProperty(t)){this.grids[t].QueryInterface("W3AISGNodeHolder").getSGNode().setVisibility(e)}},_getGridByID:function(e){const t=this.grids[e];return t||null},checkSnappingGrid:function(e){let t=this._getGridByID(e.GetID());if(t){const e=t.QueryInterface("VCXIModifiable");if(e){const t=e.GetProperty("3DGrid.Active");if(t){return t.GetPropertyValue().GetValue()}}}return!1},_logPerfo:function(e,t,i){const r=this._getGridByID(e.GetID());if(r){const e=r.QueryInterface("VCXIManipulable");if(e){const r=e.getNode();if(r){const e=r.GetGridSizeAllLines();e&&h.memoryLog("Snap on Grid",i,t,{N:e,parameterName:"cell"})}}}},_destroyAllRulers:function(){for(let e in this.grids)if(this.grids.hasOwnProperty(e)){let t=this.grids[e];if(t){const e=t.QueryInterface("VCXIManipulable");e&&e._rulers&&e._rulers.hideAllRulers()}}},manageAllGuidingLines:function(e,t){for(let i in this.grids)if(this.grids.hasOwnProperty(i)){let r=this.grids[i];const o=r.QueryInterface("VCXIManipulable");if(r&&o){const i=o.getNode();i&&(e&&r.GetID()===e?i._AddNodeForDebugSnapping(t):i._removeLinesCoordinates())}}},detectGrid:function(e,t,r,o){this._destroyAllRulers();let a=this._getGridByID(e.GetID());if(a){const e=a.QueryInterface("VCXIManipulable"),n=a.QueryInterface("VCXIModifiable");if(e&&n){const s=e.getNode();if(s){const e=s.GetWorldGridNodeCorners(),l=s.GetGridUnit();if(l){const p=n.GetProperty("Actor.Position").GetPropertyValue();if(p){const n=p.GetFrame().GetValue();let u=(new i.Vector3).getPositionFromMatrix(n);const h=(new i.Vector3).subVectors(e.TopLeft,e.BottomLeft).normalize(),d=(new i.Vector3).subVectors(e.TopRight,e.TopLeft).normalize(),c=(new i.Vector3).crossVectors(d,h).normalize();let y=new i.Plane;y.setFromNormalAndCoplanarPoint(c,u);let C=new i.Vector3;t.intersectPlane(y,C);let m=new i.Vector3;y.projectPoint(C,m);let f=new i.Vector3;y.projectPoint(u,f);let V=(new i.Vector3).subVectors(m,f),b=V.dot(d),P=V.dot(h);const g=s.GetNodeDimensionsLimit(),_=this._findClosestVertexToPoint(b,P,l,g);if(_){this.manageAllGuidingLines(a.GetID(),_);const e=_.clone().applyMatrix4(s.getMatrixWorld());o.globalPosition=e,o.globalNormal=c.clone();const t=a.QueryInterface("VCXIManipulable");return t&&t.linkSnappedDuringManipulation(r),{point:e,globalPosition:e,globalNormal:c.clone()}}}}}}this.manageAllGuidingLines(null,null)}return null},_findClosestVertexToPoint(e,t,r,o){let a=Math.round(e/r)*r,n=Math.round(t/r)*r;return a>o.XMax||a<o.XMin||n>o.YMax||n<o.YMin?null:new i.Vector3(a,n,0)},_linkDressupToSnap:function(e,t,r){if(!(r&&r.component&&r.id))return;let o=r.component.QueryInterface("VCXIModifiable")._Anchors;if(("Actor."+r.id.substring(r.id.indexOf("Anchor"))).includes("Anchor")&&o){let r=Object.keys(o)[manipulatedInteractordata.anchor];if(null!=r&&o.hasOwnProperty(r)){let a=o[r],n=a.GetValueLink();if(n){n.GetValue();let r=new s(e.GetID());a.SetValueLink(r);let o=a.GetValueFrame(),l=(new i.Matrix4).setPosition(t);o.SetValue(l),a.SetValueFrame(o)}}}},removeGrid:function(e){e&&e.forEach(e=>{if(e.IsKindOf("VCX3DGrid_Spec")){let t=e.GetID();this.grids&&this.grids[t]&&(delete this.grids[t],this.currentChosenColorIdx--,this.Dirty=!0)}})},update:function(e){this.Dirty&&(this.Dirty=!1)},postUpdate:function(e){},preRender:function(e){},postRender:function(e){},getVersion:function(){return"1.0.1"}});return Object.defineProperty(d.prototype,"Dirty",{enumerable:!0,get:function(){return this._Dirty},set:function(e){this._Dirty=e}}),Object.defineProperty(d.prototype,"componentType",{enumerable:!0,get:function(){return"VCX3DGridManager"}}),d});var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXDressupPrepareRenderToTexture",["require","exports","DS/VCXWebVisualization/VCXAPrepareRenderToTexture","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXColor"],function(e,t,i,r,o,a){"use strict";r=__importDefault(r),o=__importDefault(o),a=__importDefault(a);return class extends i{GetType(){return"VCXDressupPrepareRenderToTexture"}constructor(e=!0){super(),e||this.addOrNew("white",["Collab.Border.Line.Color","Collab.Border.Line.2.Color"]),this.addOrNew("visibletop",["Actor.IsAlwaysOnTop"])}getValueForMask(e){var t,i,n,s;if("Actor.IsAlwaysOnTop"===e)return new r.default(!0);{let e=null===(s=null===(n=null===(i=null===(t=this._object)||void 0===t?void 0:t.QueryInterface("VCXIModifiable"))||void 0===i?void 0:i.GetProperty("Collab.Background.Color.Opacity"))||void 0===n?void 0:n.GetPropertyValue())||void 0===s?void 0:s.GetValue();return e||(e=1),new o.default((new a.default).FromRGBA(e,e,e,1))}}}}),define("DS/VCXWebDressup/VCXCmdChangeDressup",["DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdChangeModifiable","DS/VCXWebKernelCommands/VCXCmdChangeComponent","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebVisibility/VCXIVisibility"],function(e,t,i,r,o){"use strict";return e.extend({init:function(e,t,i,r){this._parent(),this._commandManager=e,this._dressupManager=t,this._scenarioManager=i,this._ComponentsMap=r,this._dressupsToAdd=[],this._dressupsToRemove=[],this._bLockEvents=!1},GetType:function(){return"VCXCmdChangeDressup"},GetTitle:function(){return"Change Dressup"},RemoveDressups:function(e){this._dressupsToRemove=this._dressupsToRemove.concat(e)},AddDressups:function(e){this._dressupsToAdd=this._dressupsToAdd.concat(e)},Do:function(){var e=new i(this._commandManager,this._ComponentsMap);e.AddComponents(this._dressupsToAdd),this._commandManager.Push(e);var r=new t(this._scenarioManager);r.SetLockEvents(this._bLockEvents),this._dressupsToAdd.forEach(function(e){r.AddModifiables(e.QueryInterface("VCXIModifiable"))}),this._dressupsToRemove.forEach(function(e){r.RemoveModifiables(e.QueryInterface("VCXIModifiable"))}),this._commandManager.Push(r),0!==this._dressupsToAdd.length&&this._dressupManager.AddDressups(this._dressupsToAdd),this._removeDressup();var o=new i(this._commandManager,this._ComponentsMap);o.RemoveComponents(this._dressupsToRemove),this._commandManager.Push(o);var a=this._scenarioManager.GetCurrentScenario(),n=this._scenarioManager._experienceBase.ComponentsMap.GetComponentFromID(a);n&&this._scenarioManager._experienceBase.getManager("VCXExperience")&&this._scenarioManager._experienceBase.getManager("VCXExperience").UpdateScenarioThumbnail(n)},_removeDressup:function(){0!==this._dressupsToRemove.length&&this._dressupManager.RemoveDressups(this._dressupsToRemove),this._bLockEvents||this._dressupManager.RefreshVisuAfterDressupChange()},Undo:function(){0!==this._dressupsToAdd.length&&this._dressupManager.RemoveDressups(this._dressupsToAdd),0!==this._dressupsToRemove.length&&this._dressupManager.AddDressups(this._dressupsToRemove),this._bLockEvents||this._dressupManager.RefreshVisuAfterDressupChange();var e=this._scenarioManager.GetCurrentScenario(),t=this._scenarioManager._experienceBase.ComponentsMap.GetComponentFromID(e);t&&this._scenarioManager._experienceBase.getManager("VCXExperience")&&this._scenarioManager._experienceBase.getManager("VCXExperience").UpdateScenarioThumbnail(t)},Redo:function(){0!==this._dressupsToAdd.length&&this._dressupManager.AddDressups(this._dressupsToAdd),0!==this._dressupsToRemove.length&&this._dressupManager.RemoveDressups(this._dressupsToRemove),this._bLockEvents||this._dressupManager.RefreshVisuAfterDressupChange();var e=this._scenarioManager.GetCurrentScenario(),t=this._scenarioManager._experienceBase.ComponentsMap.GetComponentFromID(e);t&&this._scenarioManager._experienceBase.getManager("VCXExperience")&&this._scenarioManager._experienceBase.getManager("VCXExperience").UpdateScenarioThumbnail(t)},SetLockEvents:function(e){this._bLockEvents=e}})}),define("DS/VCXWebDressup/VCXIDressupModifiable",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("DS/VCXWebDressup/VCXPartListInfoComponent",["UWA/Class"],function(e){"use strict";var t=e.extend({init:function(){this._name="",this.treeBomInfo={}},smartCompare:function(e,t){var i=e,r=t;if(i!==r){var o=Number(i),a=Number(r);return o==i&&a==r?!0*(o-a):(i.toLowerCase&&(i=i.toLowerCase()),r.toLowerCase&&(r=r.toLowerCase()),i>r||-1)}return 0},GetType:function(){return this.componentType},SetName:function(e){this._name!==e&&(this._name=e)},GetName:function(){return this._name},getDescription:function(e){return e in this.treeBomInfo?this.treeBomInfo[e]:null},addBomInfoRow:function(e,t){this.treeBomInfo[e]=t}});return Object.defineProperty(t.prototype,"componentType",{enumerable:!0,get:function(){return"VCXPartListInfoComponent"}}),t}),define("DS/VCXWebDressup/VCX3DGridPrepareRenderToTexture",["require","exports","DS/VCXWebVisualization/VCXAPrepareRenderToTexture"],function(e,t,i){"use strict";return class extends i{constructor(){super(),this._needToRestoreVisibility=!1}async prepareRender(){let e=this._object.QueryInterface("W3AISGNodeHolder").getSGNode();e.isVisible()&&(this._needToRestoreVisibility=!0,e.setVisibility(!1))}async postRender(){this._needToRestoreVisibility&&(this._object.QueryInterface("W3AISGNodeHolder").getSGNode().setVisibility(!0),this._needToRestoreVisibility=!1)}GetType(){return"VCX3DGridPrepareRenderToTexture"}}}),define("DS/VCXWebDressup/VCXSectionManager",["UWA/Class","DS/Visualization/ClippingContext","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/VCXWebModifiables/VCXModelChangeListener","DS/CoreEvents/Events"],function(e,t,i,r,o){"use strict";var a=e.extend({init:function(){},postInitialize:function(){this._clippingContext=null,this._activeSections={};var e=this;this.event_VCX_VIEWER_ADDED=o.subscribe({event:"VCX_VIEWER_ADDED"},function(){e.Dirty=!0,e._cappingActive=null}),this.VCX_DRESSUPS_ADDED=o.subscribe({event:"VCX_DRESSUPS_ADDED"},function(t){e.registerSections(t)}),this.VCX_DRESSUPS_PREREMOVED=o.subscribe({event:"VCX_DRESSUPS_PREREMOVED"},function(t){e.unregisterSections(t)})},getUpdatePriority:function(){return 3},unInitialize:function(){if(o.unsubscribe(this.VCX_DRESSUPS_ADDED),delete this.VCX_DRESSUPS_ADDED,o.unsubscribe(this.VCX_DRESSUPS_PREREMOVED),delete this.VCX_DRESSUPS_PREREMOVED,o.unsubscribe(this.event_VCX_VIEWER_ADDED),delete this.event_VCX_VIEWER_ADDED,this._overrideSet){var e=this._overrideSet;this._clippingOverride&&this._overrideSet.deleteOverride(this._clippingOverride),this._experienceBase.getManager("VCXContextManager").applyToViewers(function(t){t.getSceneGraphOverrideSetManager().removeSceneGraphOverrideSet(e)}),delete this._overrideSet}this._clippingOverride&&(this._clippingOverride.setClippingContext(null),delete this._clippingOverride),this._activeSections&&delete this._activeSections,this._clippingContext&&delete this._clippingContext,this._cutObjects&&delete this._cutObjects},update:function(e){if(this.Dirty){o.publish({event:"VCX_SECTION_LIST_CHANGED",data:this._activeSections}),this.Dirty=!1;var r=[];if(this._overrideSet){var a=this._overrideSet;this._experienceBase.getManager("VCXContextManager").applyToViewers(function(e){e.getSceneGraphOverrideSetManager().removeSceneGraphOverrideSet(a)}),this._overrideSet=null}var n=1,s=0,l=!1;for(var p in this._activeSections){var u=this._activeSections[p];r.push(u._plane);var h=u.QueryInterface("VCXIModifiable");h.GetPropertyValue("Section.SpaceBackAlpha")<h.GetPropertyValue("Section.SpaceFrontAlpha")&&(n=0,s=1),h.GetPropertyValue("Section.Capping")&&(l=!0)}if(this._cappingActive!==l&&(this._cappingActive=l,this._experienceBase.getManager("VCXContextManager").applyToViewers(function(e){l?(e.setRenderPriority(!1),e.setSectionCapping(!0)):e.setSectionCapping(!1)})),0===r.length)return;for(var p in this._clippingContext=new t,this._clippingContext.setPlanes(r),this._clippingContext.setFrontAndBackOpacity(n,s),this._activeSections){u=this._activeSections[p];this._clippingContext.setSectionCappingMaterial(u._cappingMaterial,u._plane)}for(var p in this._cutObjects=[],this._activeSections){var d=!1,c=(u=this._activeSections[p]).QueryInterface("VCXIModifiable"),y=c.GetProperty("Actor.ListActors");if(y){var C=y.GetPropertyValue().GetValue();if(C&&C.length)for(var m=0;m<C.length;m++){var f=this._experienceBase.ComponentsMap.GetComponentFromID(C[m].GetValue());if(f&&!f.IsKindOf("VCXDressup_Spec")){var V=f.QueryInterface("W3AISGNodeHolder").getPathElement();-1===this._cutObjects.indexOf(V)&&this._cutObjects.push(V),d=!0}}}if(!d)if(c.GetPropertyValue("Section.ComposerSMG"))for(var b=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceExt"),P=0;P<b.length;++P){var g=b[P];if(g&&g.IsMesh()){V=g.QueryInterface("W3AISGNodeHolder").getPathElement();-1===this._cutObjects.indexOf(V)&&this._cutObjects.push(V)}}else{var _=this._experienceBase.getManager("VCXContextManager").getRootPathElement();this._cutObjects.push(_)}}if(!this._overrideSet){var S=this._experienceBase.getManager("VCXContextManager").getRootNode();this._overrideSet=new i(S);a=this._overrideSet;this._experienceBase.getManager("VCXContextManager").applyToViewers(function(e){e.getSceneGraphOverrideSetManager().pushSceneGraphOverrideSet(a)})}this._clippingOverride=this._overrideSet.createOverride(this._cutObjects),this._clippingOverride.setClippingContext(this._clippingContext)}},registerSections:function(e){var t=this;e&&e.forEach(function(e){e.IsKindOf("VCXSection_Spec")&&e.isActive()&&t.registerSection(e)})},unregisterSections:function(e){var t=this;e&&e.forEach(function(e){e.IsKindOf("VCXSection_Spec")&&t.unregisterSection(e)})},isUnionModeActived:function(){let e=this.getActiveSections();if(e)for(let t of Object.keys(e)){if(e[t].QueryInterface("VCXIModifiable").GetPropertyValue("Section.SpaceFrontAlpha"))return!0}return!1},registerSection:function(e){this._activeSections[e.GetID()]=e,this.Dirty=!0},unregisterSection:function(e){var t=e.GetID();this._activeSections&&this._activeSections[t]&&(delete this._activeSections[t],this.Dirty=!0)},getActiveSections:function(){return this._activeSections},postUpdate:function(e){this._parent(e)},isCut:function(e,t){let i=this.isUnionModeActived(),r=[];for(let o of Object.keys(this._activeSections)){let a=this._activeSections[o],n=e?e.QueryInterface("VCXICuttableObject"):null,s=!!n&&n.isCut(e,t,a);if(r.push(s),!i&&s)return!0}return!!i&&r.every(e=>!0===e)},preRender:function(e){},postRender:function(e){},getVersion:function(){return"1.0.1"},toggleSpaceAlphaSection:function(e,t,i=!0,r){let o=void 0!==r?r:this.isUnionModeActived(),a=e.QueryInterface("VCXIModifiable");if(a.GetPropertyValue("Section.SpaceFrontAlpha")||!1!==o){let e=a.GetNewProperty("Section.SpaceFrontAlpha",o?1:0);i?t.ChangeProperty(a,e):a.OnChangeProperty("Section.SpaceFrontAlpha",e.GetPropertyValue())}if(a.GetPropertyValue("Section.SpaceBackAlpha")||!1!=!o){let e=a.GetNewProperty("Section.SpaceBackAlpha",o?0:1);i?t.ChangeProperty(a,e):a.OnChangeProperty("Section.SpaceFrontAlpha",e.GetPropertyValue())}}});return Object.defineProperty(a.prototype,"Dirty",{enumerable:!0,get:function(){return this._Dirty},set:function(e){this._Dirty=e}}),Object.defineProperty(a.prototype,"componentType",{enumerable:!0,get:function(){return"VCXSectionManager"}}),a}),define("DS/VCXWebDressup/VCXComponentDressupGrp",["UWA/Class","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup"],function(e,t){"use strict";var i=e.extend({init:function(){this._parent(),this._name="Others"},GetType:function(){return this.componentType},setName:function(e){this._name=e},getName:function(){return this._name},getNLSName:function(){return t["TreeNode."+this.getName()]},descriptionDump:function(){return{name:this.getName(),type:this.componentType}}});return Object.defineProperty(i.prototype,"componentType",{enumerable:!0,get:function(){return"VCXComponentDressupGrp"}}),i});__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXDressup_Spec",["require","exports","DS/VCXWebSystem/VCXMathTools","DS/VCXWebExperienceBase/VCXComponentOccurrenceExperience"],function(e,t,i,r){"use strict";i=__importDefault(i),r=__importDefault(r);class o extends r.default{constructor(){super(),this._previousAnchors=[],this._pointedObjectMoved=null,this.componentType.startsWith("VCXComponent")&&(this._name=this.componentType.slice(12)),this._IsDressupPropertiesChangeIndependent=!1,this._IsViewPointDependent=!1,this._IsAnchorDependent=!1,this._dirty=!1,this._isPickerSensitive=!1,this._postUpdateShouldBeDone=!1}GetType(){return this.componentType}hasPointedObjectMoved(e){var t=this.QueryInterface("VCXIModifiable"),r=t&&t._Anchors;if(!(r&&Object.keys(r).length>0))return!1;if(this._previousAnchors||(this._previousAnchors=[]),null===this._pointedObjectMoved){this._pointedObjectMoved=!1;var o=this;t&&t.processAnchorsIDs(function(r){var a=t.GetAnchorWorldMatrix(r,e);if(!i.default.IsMat1EqualsToMat2(o._previousAnchors[r],a))return o._previousAnchors[r]=a,o._pointedObjectMoved=!0,!1},null)}return this._pointedObjectMoved}getWorkingRootComponent(){var e=this.QueryInterface("VCXIModelNavigable");if(e){var t=null==e?void 0:e.getWorkingRoot();return t?t.GetObject():(console.error("No working root for modifiable ??"),null)}console.warn("Not a navigable ??")}getWorkingRootPathElement(){var e=this.getWorkingRootComponent();if(e)return e.QueryInterface("W3AISGNodeHolder").getPathElement()}setDirty(e){this._dirty=void 0===e||e;var t=this.QueryInterface("W3AISGNodeHolder");t&&t.setSGNodeDirty(this._dirty),this._dirty&&this._experienceBase.getManager("VCXDressupManager").SetDirty()}isDirty(){return this._dirty}update(e){this._postUpdateShouldBeDone=!0;var t=this.QueryInterface("W3AISGNodeHolder");t&&t.update&&t.update(e)&&this._experienceBase.getManager("VCXContextManager").renderAll()}postUpdate(e){if(this._pointedObjectMoved=null,this._postUpdateShouldBeDone){this._postUpdateShouldBeDone=!1;var t=this.QueryInterface("W3AISGNodeHolder");t&&t.postUpdate&&t.postUpdate(e),this.isDirty()&&this.setDirty(!1),this._dirtyMask=0}}preRender(e){var t=this.QueryInterface("W3AISGNodeHolder");t&&t.preRender&&t.preRender(e)}postRender(e){var t=this.QueryInterface("W3AISGNodeHolder");t&&t.postRender&&t.postRender(e)}descriptionDump(){return{name:this._name,type:this.componentType}}set IsDressupPropertiesChangeIndependent(e){this._IsDressupPropertiesChangeIndependent=e}get IsDressupPropertiesChangeIndependent(){return this._IsDressupPropertiesChangeIndependent}set IsViewPointDependent(e){this._IsViewPointDependent=e}get IsViewPointDependent(){return this._IsViewPointDependent}set IsAnchorDependent(e){this._IsAnchorDependent=e}get IsAnchorDependent(){return this._IsAnchorDependent}get IsPickerSensitive(){return this._isPickerSensitive}set IsPickerSensitive(e){this._isPickerSensitive=e}get IsDressup(){return!0}}return function(e){let t;!function(e){e[e.NoFreeze=0]="NoFreeze",e[e.Freeze=1]="Freeze",e[e.FreezeInPlay=2]="FreezeInPlay"}(t=e.EFreeze||(e.EFreeze={}))}(o||(o={})),Object.defineProperty(o.prototype,"componentType",{enumerable:!0,get:function(){return"VCXDressup_Spec"}}),o.prototype.dressupGroupName="",o.prototype.getDefaultName=function(){return"Dressup"},o}),define("DS/VCXWebDressup/VCXPartListManagerModifiable",["DS/VCXWebModifiables/VCXModifiable","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueMap"],function(e,t,i,r,o,a,n,s){"use strict";return e.extend({init:function(e){this._Properties=[]},BuildProp:function(e,r,o){var a=new i(e,1),n=new r;n.Value=o,this._Properties[e]=new t(a,n),this.SetProperty(e,n)},BuildColumn:function(e,t,i,r){var o=new s,l=new n;return l.SetValue(e),o.SetValueAtIndex(0,l),(l=new a).SetValue(t),o.SetValueAtIndex(1,l),(l=new a).SetValue(i),o.SetValueAtIndex(2,l),(l=new n).SetValue(r),o.SetValueAtIndex(3,l),o},Build:function(){this._parent(),this.BuildProp("BOM.Filter",a,0),this.BuildProp("BOM.Sort.Ascendant",o,!0),this.BuildProp("BOM.Sort.PropertyName",n,"Actor.PartList.ID");var e=new s;e.SetValueAtIndex(0,this.BuildColumn("Actor.PartList.ID",40,0,"")),e.SetValueAtIndex(1,this.BuildColumn("Actor.PartList.Description",120,0,"")),e.SetValueAtIndex(2,this.BuildColumn("Bom.Quantity",40,0,""));var r=new i("ColumnTreeList.ColumnList",1);this._Properties["ColumnTreeList.ColumnList"]=new t(r,e),this.SetProperty("ColumnTreeList.ColumnList",e)},SetProperty:function(e,r){var o=new i(e,0);this._Properties[e]=new t(o,r.Clone())},OnChangeProperty:function(e,t,i){if(i||(i={}),i.fromChildClass);else if(this.OnChangePropertyBegin(e,t))return!0;this.SetProperty(e,t)},OnChangePropertiesEnd:function(){this.GetObject().update&&this.GetObject().update()},GetProperty:function(e){var i=null;return void 0!==this._Properties[e]&&(i=new t(this._Properties[e].GetPropertyInfo(),this._Properties[e].GetPropertyValue().Clone())),i},GetProperties:function(e){var t=new r;for(var i in this._Properties)this._Properties.hasOwnProperty(i)&&t.AddOrModifyProperty(this.GetProperty(i));return t}})}),define("DS/VCXWebDressup/VCXCoveringMaterialSelectBehavior",["UWA/Class"],function(e){"use strict";return e.extend({init:function(){},GetListForSelection:function(){return[this._object.QueryInterface("CATI3DExperienceObject").GetValueByName("appearance")]}})}),define("DS/VCXWebDressup/VCXPropertyValueHTMLFormater",["UWA/Class"],function(e){"use strict";var t=e.extend({init:function(){}});return t.dumpDate=function(e,t){return t?"%"===t[0]?e.strftime(t):e.toLocaleDateString(t):e.toUTCString()},t.format=function(e){var i,r,o=e.GetPropertyValue(),a="left";switch(o.GetType()){case"VCXPropertyValueColor":r="border:1px solid #000;background:#"+o.GetThreeColor().getHexString()+";";break;case"VCXPropertyValueFloat":a="right",i=o.Value.toFixed(2);break;case"VCXPropertyValueDate":a="right",i=t.dumpDate(o.Value,"%d/%m/%Y");break;case"VCXPropertyValueInt":a="right",i=o.ToString();break;default:i=o.ToString()}var n="<div style='width:100%;height:100%;text-align:"+a+";";return r&&(n+=r),n+="'>",i&&(n+=i),n+="</div>"},t}),define("DS/VCXWebDressup/VCXPropertyValueUnitFormater",["UWA/Class","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup"],function(e,t){"use strict";var i=e.extend({init:function(){}});return i.format=function(e,i){var r,o=e.GetPropertyValue(),a=e.GetPropertyInfo();switch(o.GetType()){case"VCXPropertyValueFloat":var n=a.GetUnitType();if(n){var s=i.getManager("VCXUnitManager");if(s)return s.getString(o.Value,n)}return o.Value.toFixed(2);case"VCXPropertyValueEnum":r=o.ToString();var l=a.GetMapChoiceEnum();if(l){r=l[o.Value];var p=t[r];r=void 0===p?"":p}break;default:r=o.ToString()}return r},i}),define("DS/VCXWebDressup/CXPRenderingFeatureModelVCXCXPConvertor",["DS/VCXWebEWS/CXPExperienceObjectVCXCXPConvertor","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValuePoint","DS/VCXWebProperties/VCXPropertyValueEnum","DS/CAT3DExpModel/interfaces/CATI3DExperienceObject"],function(e,t,i,r,o,a,n,s){"use strict";var l=e.extend({init:function(){},getTab:function(){if(this._tab)return this._tab;let e=[];const t=this.QueryInterface("CATI3DExperienceObject").ListVariables();let i=["_varName","linktomaterial"];return t.forEach(t=>{if(!i.includes(t)){let i=this._getMaterialVariableType(t);e.push({variableName:t,propertyName:"Material."+t,typeProperty:i,type:i===a?"Vector3":void 0})}}),this._tab=e,e},_getMaterialVariableType:function(e){const n=this.QueryInterface("CATI3DExperienceObject");switch(n.GetVariableType(e)){case s.VarType.Integer:case s.VarType.Double:return r;case s.VarType.String:return t;case s.VarType.Boolean:return i;case s.VarType.Color:return o}const l=n.GetValueByName(e);if(l)switch(l.GetType()){case"Color_Spec":return o;case"Vector3D_Spec":return a}}});return Object.defineProperty(l.prototype,"componentType",{enumerable:!0,get:function(){return"CXPRenderingFeatureModelVCXCXPConvertor"}}),l}),define("DS/VCXWebDressup/VCXMagnetLinePrepareRenderToTexture",["require","exports","DS/VCXWebVisualization/VCXAPrepareRenderToTexture"],function(e,t,i){"use strict";return class extends i{constructor(){super(),this._needToRestoreVisibility=!1}async prepareRender(){let e=this._object.QueryInterface("W3AISGNodeHolder").getSGNode();e.isVisible()&&(this._needToRestoreVisibility=!0,e.setVisibility(!1))}async postRender(){this._needToRestoreVisibility&&(this._object.QueryInterface("W3AISGNodeHolder").getSGNode().setVisibility(!0),this._needToRestoreVisibility=!1)}GetType(){return"VCXMagnetLinePrepareRenderToTexture"}}}),define("DS/VCXWebDressup/VCXMagnetLineManager",["UWA/Class","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebModifiables/VCXModelChangeListener"],function(e,t,i,r,o,a,n,s){"use strict";var l=e.extend({init:function(){},postUpdate:function(e){}});return Object.defineProperty(l.prototype,"componentType",{enumerable:!0,get:function(){return"VCXMagnetLineManager"}}),l}),define("DS/VCXWebDressup/VCXPartListInfoModifiable",["UWA/Core","DS/VCXWebModifiables/VCXModifiable","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyValueMap"],function(e,t,i,r,o,a){"use strict";return t.extend({init:function(){this._parent()},GetType:function(){return"VCXPartListInfoModifiable"},OnChangeProperty:function(e,t,i){if(i||(i={}),i.fromChildClass);else if(this.OnChangePropertyBegin(e,t))return!0;switch(e){case"GroupInfoPropSet":for(var r=t.GetValue(),o=0;o<r.length;o++){for(var a=r[o].GetValue(),n=null,s=null,l=0;l<a.length;l++){var p=a[l];switch(p.name){case"Id":n=p.GetValue();break;case"Name":s=p.GetValue()}}this.GetObject().addBomInfoRow(n,s)}break;default:return i.fromChildClass=!0,this._parent(e,t,i)}return!0},OnChangePropertiesEnd:function(){},GetProperty:function(e){var t=null;return"GroupInfoPropSet"===e||(t=this._parent(e)),t},GetProperties:function(){var e=this._parent();return e.AddOrModifyProperty(this.GetProperty("Actor.Opacity")),e}})}),define("DS/VCXWebDressup/VCXMagnetLineManagerModifiable",["DS/VCXWebModifiables/VCXModifiable","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueMap"],function(e,t,i,r,o,a,n,s){"use strict";return e.extend({init:function(e){this._Properties=[]},BuildProp:function(e,r,o){var a=new i(e,1),n=new r;n.Value=o,this._Properties[e]=new t(a,n),this.SetProperty(e,n)},Build:function(){this._parent()},SetProperty:function(e,r){var o=new i(e,0);this._Properties[e]=new t(o,r.Clone())},OnChangeProperty:function(e,t,i){if(i||(i={}),i.fromChildClass);else if(this.OnChangePropertyBegin(e,t))return!0;this.SetProperty(e,t)},OnChangePropertiesEnd:function(){this.GetObject().update&&this.GetObject().update()},GetProperty:function(e){var i=null;return void 0!==this._Properties[e]&&(i=new t(this._Properties[e].GetPropertyInfo(),this._Properties[e].GetPropertyValue().Clone())),i},GetProperties:function(e){var t=new r;for(var i in this._Properties)this._Properties.hasOwnProperty(i)&&t.AddOrModifyProperty(this.GetProperty(i));return t}})}),define("DS/VCXWebDressup/AmbienceModelVCXCXPConvertor",["DS/VCXWebEWS/CXPExperienceObjectVCXCXPConvertor"],function(e){"use strict";var t=e.extend({init:function(){this._tab=[{variableName:"_varName",propertyName:"Actor.Name"},{variableName:"Dome Origin",propertyName:"Ambience.Background.Position",type:"Vector3"},{variableName:"Dome Radius",propertyName:"Ambience.Background.Radius"},{variableName:"Dome Rotation Z",propertyName:"Ambience.Background.Rotation"},{variableName:"Exposure",propertyName:"Ambience.Background.Exposure"},{variableName:"Finite Dome",propertyName:"Ambience.Background.Finite"},{variableName:"Ground Glossiness",propertyName:"Ambience.Ground.Glossiness"},{variableName:"Ground Offset",propertyName:"Ambience.Ground.Offset"},{variableName:"Ground Reflectivity",propertyName:"Ambience.Ground.Reflectivity"},{variableName:"Ground Scale Ratio",propertyName:"Ambience.Ground.Scaleratio"},{variableName:"Lighting Rotation Z",propertyName:"Ambience.Background.Rotation"},{variableName:"Lighting Exposure",propertyName:"Ambience.Background.Exposure"}]}});return Object.defineProperty(t.prototype,"componentType",{enumerable:!0,get:function(){return"AmbienceModelVCXCXPConvertor"}}),t}),define("DS/VCXWebDressup/VCXWebDressupDictionary",[],function(){"use strict";var e={VCXDressup_Spec:{VCXIContextualContent:"DS/VCXWebDressup/VCXContextualContentDressup_Spec",VCXIVisibility:"DS/VCXWebDressup/VCXVisibilityDressup",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup",VCXIStylesHolder:"DS/VCXWebStyles/VCXAStylesHolder",VCXICuttableObject:"DS/VCXWebDressup/VCXACuttableObject"},CXPCameraActor_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXCameraModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXCameraModifiableView",W3AISGNodeHolder:"DS/VCXWebDressup/VCXCameraSGNodeHolder",VCXIViewpointController:"DS/VCXWebDressup/VCXAViewpointController"},VCXViewpoint_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXViewpointModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXViewpointModifiableView",W3AISGNodeHolder:"DS/VCXWebDressup/VCXDressupSGNodeHolder",VCXIViewpointController:"DS/VCXWebDressup/VCXAViewpointController"},VCXViewport_Spec:{VCXIVisibility:"DS/VCXWebVisibilityImpl/VCXVisibilityHidden",VCXIModifiable:"DS/VCXWebDressup/VCXViewportModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXViewportModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXViewportModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXViewportSGNodeHolder",VCXIViewpointController:"DS/VCXWebDressup/VCXAViewpointController"},AmbienceModel_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXAmbienceModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXAmbienceModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXAmbienceModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXAmbienceSGNodeHolder",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeAmbience",VCXIReadiness:"DS/WebApplicationBase/VCXAReadiness",VCXIVisibility:"DS/VCXWebVisibilityImpl/VCXVisibilityHidden"},VCXArrow_Spec:{VCXICuttableObject:"DS/VCXWebDressup/VCXCuttableObjectArrowAndCircle"},VCXLinearArrow_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXArrowLinearModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXArrowLinearModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXArrowLinearModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXArrowLinearSGNodeHolder",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXArrowPrepareRenderToTexture"},VCXCircularArrow_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXArrowCircularModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXArrowCircularModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXArrowCircularModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXArrowCircularSGNodeHolder",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXArrowPrepareRenderToTexture"},VCXCornerArrow_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXArrowCornerModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXArrowModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXArrowCornerModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXArrowCornerSGNodeHolder",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXArrowPrepareRenderToTexture"},VCXCircle_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXCircleModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXCircleModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXCircleModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXCircleSGNodeHolder",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXCirclePrepareRenderToTexture",VCXICuttableObject:"DS/VCXWebDressup/VCXCuttableObjectArrowAndCircle"},VCXRedLine_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXRedLineModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXRedLineModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXRedLineModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXRedLineSGNodeHolder",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXRedlinePrepareRenderToTexture"},VCXCompass_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXCompassModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXCompassModifiableView",W3AISGNodeHolder:"DS/VCXWebDressup/VCXCompassSGNodeHolder"},VCXPanel_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXPanelModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXPanelModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXPanelModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXPanelSGNodeHolder",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXPulseBehaviorDressupPanel",VCXIReadiness:"DS/WebApplicationBase/VCXAReadiness",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXPanelPrepareRenderToTexture"},VCXDiggerPanel_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXDiggerPanelModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXPanelModifiableView",W3AISGNodeHolder:"DS/VCXWebDressup/VCXDiggerPanelSGNodeHolder",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXPulseBehaviorDressupPanel",VCXIReadiness:"DS/WebApplicationBase/VCXAReadiness"},VCXLabel_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXLabelModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXLabelModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXLabelModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXLabelSGNodeHolder",VCXIPulseBehavior:"DS/VCXWebPulseManager/VCXPulseBehaviorDressupPanel",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXMarkupPrepareRenderToTexture"},VCXMeasurement_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXMeasurementModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXMeasurementModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXMeasurementModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXMeasurementSGNodeHolder",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXMeasurementPrepareRenderToTexture"},VCXSection_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXSectionModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXSectionModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXSectionModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXSectionSGNodeHolder"},VCX3DAligner_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCX3DAlignerModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCX3DAlignerModifiableView",W3AISGNodeHolder:"DS/VCXWebDressup/VCX3DAlignerSGNodeHolder"},VCX3DGrid_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCX3DGridModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCX3DGridModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCX3DGridModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCX3DGridSGNodeHolder",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCX3DGridPrepareRenderToTexture"},VCXCallout_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXCalloutModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXCalloutModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXCalloutModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXCalloutSGNodeHolder",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXMarkupPrepareRenderToTexture"},VCXPolyline_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXPolylineModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXPolylineModifiableView",VCXIModifiableFormatPainter:"DS/VCXWebDressup/VCXPolylineModifiable",W3AISGNodeHolder:"DS/VCXWebDressup/VCXPolylineSGNodeHolder",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXPolylinePrepareRenderToTexture"},VCXMagnetLine_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXMagnetLineModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXMagnetLineModifiableView",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup",W3AISGNodeHolder:"DS/VCXWebDressup/VCXMagnetLineSGNodeHolder",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXMagnetLinePrepareRenderToTexture"},VCXComponentDressupGrp:{VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressupGrp",W3AISGNodeHolder:"DS/VCXWebDressup/VCXDressupGrpSGNodeHolder",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable"},VCXDressupManager:{W3AISGNodeHolder:"DS/VCXWebDressup/VCXDressupManagerSGNodeHolder",W3AIManager:"DS/WebApplicationBase/W3AAManager",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable"},VCXSectionManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCX3DGridManager:{W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXPartList_Spec:{VCXIModifiable:"DS/VCXWebDressup/VCXPartListModifiable",VCXIModifiableView:"DS/VCXWebDressup/VCXPartListModifiableView",VCXIVisibility:"DS/VCXWebDressup/VCXVisibilityDressup",W3AISGNodeHolder:"DS/VCXWebDressup/VCXPartListSGNodeHolder",VCXISensible:"DS/VCXWebComposer/VCXASensible",VCXITreeNode:"DS/VCXWebTreeExtensions/VCXTreeNodeDressup",VCXIModelNavigable:"DS/VCXWebDressup/VCXDressupModelNavigable",VCXIPrepareRenderToTexture:"DS/VCXWebDressup/VCXPartListPrepareRenderToTexture"},VCXPartListInfoComponent:{VCXIModifiable:"DS/VCXWebDressup/VCXPartListInfoModifiable",VCXIModifiableView:"DS/VCXWebModifiables/VCXModifiableView"},VCXComponentPartListManager:{VCXIModifiable:"DS/VCXWebDressup/VCXPartListManagerModifiable",W3AIManager:"DS/WebApplicationBase/W3AAManager"},VCXMagnetLineManager:{VCXIModifiable:"DS/VCXWebDressup/VCXMagnetLineManagerModifiable",W3AIManager:"DS/WebApplicationBase/W3AAManager"}},t={VCXIPrepareRenderToTexture:"DS/VCXWebVisualization/VCXIPrepareRenderToTexture",VCXIStylesHolder:"DS/VCXWebStyles/VCXIStylesHolder"},i={VCXViewport_Spec:"DS/VCXWebDressup/VCXViewport_Spec",VCXViewpoint_Spec:"DS/VCXWebDressup/VCXViewpoint_Spec",VCXComponentViewport:"DS/VCXWebDressup/VCXViewport_Spec",AmbienceModel_Spec:"DS/VCXWebDressup/AmbienceModel_Spec",VCXLinearArrow_Spec:"DS/VCXWebDressup/VCXLinearArrow_Spec",VCXComponentArrowLinear:"DS/VCXWebDressup/VCXLinearArrow_Spec",VCXCircularArrow_Spec:"DS/VCXWebDressup/VCXCircularArrow_Spec",VCXComponentArrowCircular:"DS/VCXWebDressup/VCXCircularArrow_Spec",VCXCornerArrow_Spec:"DS/VCXWebDressup/VCXCornerArrow_Spec",VCXComponentArrowCorner:"DS/VCXWebDressup/VCXCornerArrow_Spec",VCXCircle_Spec:"DS/VCXWebDressup/VCXCircle_Spec",VCXComponentCircle:"DS/VCXWebDressup/VCXCircle_Spec",VCXPolyline_Spec:"DS/VCXWebDressup/VCXPolyline_Spec",VCXComponentPolyline:"DS/VCXWebDressup/VCXPolyline_Spec",VCXMagnetLine_Spec:"DS/VCXWebDressup/VCXMagnetLine_Spec",VCXPanel_Spec:"DS/VCXWebDressup/VCXPanel_Spec",VCXComponentPanel:"DS/VCXWebDressup/VCXPanel_Spec",VCXDiggerPanel_Spec:"DS/VCXWebDressup/VCXDiggerPanel_Spec",VCXComponentDiggerPanel:"DS/VCXWebDressup/VCXDiggerPanel_Spec",VCXLabel_Spec:"DS/VCXWebDressup/VCXLabel_Spec",VCXComponentLabel:"DS/VCXWebDressup/VCXLabel_Spec",VCXMeasurement_Spec:"DS/VCXWebDressup/VCXMeasurement_Spec",VCXComponentMeasurement:"DS/VCXWebDressup/VCXMeasurement_Spec",VCXSection_Spec:"DS/VCXWebDressup/VCXSection_Spec",VCXComponentSection:"DS/VCXWebDressup/VCXSection_Spec",VCX3DAligner_Spec:"DS/VCXWebDressup/VCX3DAligner_Spec",VCXComponent3DAligner:"DS/VCXWebDressup/VCX3DAligner_Spec",VCX3DGrid_Spec:"DS/VCXWebDressup/VCX3DGrid_Spec",VCXComponent3DGrid:"DS/VCXWebDressup/VCX3DGrid_Spec",VCXCallout_Spec:"DS/VCXWebDressup/VCXCallout_Spec",VCXComponentCallout:"DS/VCXWebDressup/VCXCallout_Spec",VCXComponentDressupGrp:"DS/VCXWebDressup/VCXComponentDressupGrp",VCXRedLine_Spec:"DS/VCXWebDressup/VCXRedLine_Spec",VCXComponentRedLine:"DS/VCXWebDressup/VCXRedLine_Spec",VCXCompass_Spec:"DS/VCXWebDressup/VCXCompass_Spec",VCXComponentCompass:"DS/VCXWebDressup/VCXCompass_Spec",CXPCameraActor_Spec:"DS/VCXWebDressup/CXPCameraActor_Spec",VCXComponentCamera:"DS/VCXWebDressup/CXPCameraActor_Spec",VCXExperience:"DS/VCXWebComposer/VCXExperience",VCXDressupManager:"DS/VCXWebDressup/VCXDressupManager",VCXSectionManager:"DS/VCXWebDressup/VCXSectionManager",VCXMagnetLineManager:"DS/VCXWebDressup/VCXMagnetLineManager",VCX3DGridManager:"DS/VCXWebDressup/VCX3DGridManager",VCXMagnetLineManager:"DS/VCXWebDressup/VCXMagnetLineManager",VCXPartList_Spec:"DS/VCXWebDressup/VCXPartList_Spec",VCXComponentPartListManager:"DS/VCXWebDressup/VCXComponentPartListManager",VCXComponentPartList:"DS/VCXWebDressup/VCXPartList_Spec",VCXPartListInfoComponent:"DS/VCXWebDressup/VCXPartListInfoComponent",VCXICuttableObject:"DS/VCXWebKernel/VCXICuttableObject"},r=[];return{GetDictionary:function(){return{interfaces:t,components:i,extensions:e}},getNLSModules:function(){return r}}}),define("DS/VCXWebDressup/VCXPartListPrepareRenderToTexture",["require","exports","DS/VCXWebVisualization/VCXAPrepareRenderToTexture"],function(e,t,i){"use strict";return class extends i{constructor(){super(),this._nRows=0,this._nColumns=0,this._tableColumns=[],this.VCX_PT2MM=.3527,this._emptyPartList=!1}async prepareRender(){}partList_Getters(e,t){switch(e){case"text":var i=[];t&&(this._nRows=t.length);for(let e=0;e<this._nRows;e++){i[e]=[],this._tableColumns=t[e].getChildren(),this._nColumns=this._tableColumns.length;for(let t=0;t<this._nColumns;t++)void 0!==this._tableColumns[t].getText()&&(i[e][t]=this._tableColumns[t].getText())}return i;case"textStartCoordinates":let o=[];t&&(this._nRows=t.length);for(let e=0;e<this._nRows;e++){o[e]=[],this._tableColumns=t[e].getChildren(),this._nColumns=this._tableColumns.length;for(let t=0;t<this._nColumns;t++)void 0!==this._tableColumns&&null!==this._tableColumns&&(o[e][t]={x:this._tableColumns[t].getChildren()[0].getBoundingClientRect().left,y:this._tableColumns[t].getChildren()[0].getBoundingClientRect().top})}return o;case"textEndCoordinates":let a=[];t&&(this._nRows=t.length);for(let e=0;e<this._nRows;e++){a[e]=[],this._tableColumns=t[e].getChildren(),this._nColumns=this._tableColumns.length;for(let t=0;t<this._nColumns;t++)void 0!==this._tableColumns&&null!==this._tableColumns&&(a[e][t]={x:this._tableColumns[t].getChildren()[0].getBoundingClientRect().right,y:this._tableColumns[t].getChildren()[0].getBoundingClientRect().top})}return a;case"textCenterCoordinates":let n=[];t&&(this._nRows=t.length);for(let e=0;e<this._nRows;e++){n[e]=[],this._tableColumns=t[e].getChildren(),this._nColumns=this._tableColumns.length;for(let t=0;t<this._nColumns;t++)void 0!==this._tableColumns&&null!==this._tableColumns&&(n[e][t]={x:(this._tableColumns[t].getChildren()[0].getBoundingClientRect().left+this._tableColumns[t].getChildren()[0].getBoundingClientRect().right)/2,y:this._tableColumns[t].getChildren()[0].getBoundingClientRect().top})}return n;case"column_width":if(t[0])var r=t[0].getChildren();return[r[0].getBoundingClientRect().width,r[1].getBoundingClientRect().width,r[2].getBoundingClientRect().width];case"row_height":if(t[1])return t[1].getBoundingClientRect().height;case"row_length":return t.length;case"position":if(t[0])return[t[0].getBoundingClientRect().x,t[0].getBoundingClientRect().y];case"font_size":if(t)return parseFloat(t.style.fontSize);case"text_alignment":if(t[0])return t[0].getChildren()[0].getStyle("justify-content");default:console.error("Invalid parameter!")}}async postRender(e,t){var i;if("normal"===t){const t=e.canvas,n=t.getContext("2d");let s=[],l=document.getElementById("partListTableContainer");if(null==l)return;let p,u,h=l.children;for(let e=0;e<h.length;e++)"divBom"==h[e].getAttribute("id")&&(p=h[e]);let d=this._object._experienceBase.getManager("VCXPaperManager");d.updatePaper();var r=this._object.QueryInterface("W3AISGNodeHolder").giveSGNode().GlobalOpacity;let c=this._object.QueryInterface("VCXIModifiable");const y=d._PaperSize.x,C=d._PaperSize.y,m=Number(t.attributes.width.value),f=Number(t.attributes.height.value);u=p.getChildren(),this._emptyPartList="divBomEmptyRow"===u[1].getAttribute("id");let V=[];for(let e=0;e<=u.length&&(!(e===u.length||"divBomRowHead"===u[e].getAttribute("id")&&V.length>0)||(s.push(V),V=[],e!==u.length));e++)V.push(u[e]);for(let e=0;e<s.length;e++){const t=this.partList_Getters("position",s[e]),p=d.PixelToMMX(t[0])/y*m,u=d.PixelToMMY(t[1])/C*f,h=this.partList_Getters("column_width",s[e]),V=this.partList_Getters("row_length",s[e]),b=h.length;let P=this.partList_Getters("row_height",s[e]);const g=1,_=this.partList_Getters("text",s[e]);let S=this.partList_Getters("font_size",l);const M=this.partList_Getters("text_alignment",s[e]);for(let e=0;e<h.length;e++)h[e]=d.PixelToMM(h[e]),h[e]/=y,h[e]*=m;P=d.PixelToMM(P),P/=C,P*=f,S=d.PixelToMM(S),S/=C,S*=f;const G=h.reduce((e,t)=>e+t,0);let D=c.GetProperty("Collab.PartList.Body.ConsiderAlternateColor").GetPropertyValue().GetValue(),x=c.GetProperty("Collab.PartList.Header.Background.Color").GetPropertyValue().GetValue();x.a=c.GetProperty("Collab.PartList.Header.Background.Color.Opacity").GetPropertyValue().GetValue()*r;let v=c.GetProperty("Collab.PartList.Body.Row.Color").GetPropertyValue().GetValue();var o;v.a=c.GetProperty("Collab.PartList.Body.Row.Color.Opacity").GetPropertyValue().GetValue()*r,D?(o=c.GetProperty("Collab.PartList.Body.SecondRow.Color").GetPropertyValue().GetValue()).a=c.GetProperty("Collab.PartList.Body.SecondRow.Color.Opacity").GetPropertyValue().GetValue()*r:(o=c.GetProperty("Collab.PartList.Body.Row.Color").GetPropertyValue().GetValue()).a=c.GetProperty("Collab.PartList.Body.Row.Color.Opacity").GetPropertyValue().GetValue()*r;let A=c.GetProperty("Collab.PartList.Header.Text.Color").GetPropertyValue().GetValue();A.a=c.GetProperty("Collab.PartList.Header.Text.Color.Opacity").GetPropertyValue().GetValue()*r;let X,I,T=c.GetProperty("Collab.PartList.Container.Text.Color").GetPropertyValue().GetValue();if(T.a=c.GetProperty("Collab.PartList.Container.Text.Color.Opacity").GetPropertyValue().GetValue()*r,n.strokeStyle=`rgba(0,0,0,${r})`,n.lineWidth=g,this._emptyPartList)for(let t=0;t<2;t++)for(let i=0,r=0;i<b&&(!t||!i);i++){let l;l=t?G:h[i];const V=t*P;0===t?(X=`rgb(${255*x.r},${255*x.g},${255*x.b},${x.a})`,I=`rgb(${255*A.r},${255*A.g},${255*A.b},${A.a})`):D?t%2?(X=`rgb(${255*v.r},${255*v.g},${255*v.b},${v.a})`,I=`rgb(${255*T.r},${255*T.g},${255*T.b},${T.a})`):(X=`rgb(${255*o.r},${255*o.g},${255*o.b},${o.a})`,I=`rgb(${255*T.r},${255*T.g},${255*T.b},${T.a})`):(X=`rgb(${255*v.r},${255*v.g},${255*v.b},${v.a})`,I=`rgb(${255*T.r},${255*T.g},${255*T.b},${T.a})`),n.fillStyle=X,n.fillRect(p+r,u+V,l,P);var a=c.GetProperty("Collab.Text.Font").GetPropertyValue().GetValue()[0];t?(n.fillStyle="rgb(193,198,201)",n.font=`italic ${S}pt ${a._value}`):(n.fillStyle=I,n.font=`normal ${S}pt ${a._value}`),n.textBaseline="middle";const b=this.partList_Getters("textStartCoordinates",s[e]);_[t][i]&&b[t][i]&&(n.textAlign="start",n.fillText(_[t][i],d.PixelToMMX(b[t][i].x)/y*m,d.PixelToMMY(b[t][i].y)/C*f+P/2)),r+=l}else for(let t=0;t<V;t++)for(let r=0,l=0;r<b;r++){const C=h[r],f=t*P;switch(0===t?(X=`rgb(${255*x.r},${255*x.g},${255*x.b},${x.a})`,I=`rgb(${255*A.r},${255*A.g},${255*A.b},${A.a})`):D?t%2?(X=`rgb(${255*v.r},${255*v.g},${255*v.b},${v.a})`,I=`rgb(${255*T.r},${255*T.g},${255*T.b},${T.a})`):(X=`rgb(${255*o.r},${255*o.g},${255*o.b},${o.a})`,I=`rgb(${255*T.r},${255*T.g},${255*T.b},${T.a})`):(X=`rgb(${255*v.r},${255*v.g},${255*v.b},${v.a})`,I=`rgb(${255*T.r},${255*T.g},${255*T.b},${T.a})`),n.fillStyle=X,n.fillRect(p+l,u+f,C,P),a=c.GetProperty("Collab.Text.Font").GetPropertyValue().GetValue()[0],n.fillStyle=I,n.font=`normal ${S}pt ${a._value}`,n.textBaseline="middle",M){case"start":const h=this.partList_Getters("textStartCoordinates",s[e]);_[t][r]&&h[t][r]&&(n.textAlign="start",n.fillText(_[t][r],d.PixelToMMX(h[t][r].x)/y*m,u+f+P/2));break;case"justify":const V=this.partList_Getters("textStartCoordinates",s[e]);_[t][r]&&V[t][r]&&(n.textAlign="start",n.fillText(_[t][r],d.PixelToMMX(V[t][r].x)/y*m,u+f+P/2));break;case"end":const b=this.partList_Getters("textEndCoordinates",s[e]);_[t][r]&&b[t][r]&&(n.textAlign="end",n.fillText(_[t][r],d.PixelToMMX(b[t][r].x)/y*m,u+f+P/2));break;case"center":const g=this.partList_Getters("textCenterCoordinates",s[e]);_[t][r]&&g[t][r]&&(n.textAlign="center",n.fillText(_[t][r],d.PixelToMMX(g[t][r].x)/y*m,u+f+P/2));break;default:const G=this.partList_Getters("textStartCoordinates",s[e]);_[t][r]&&G[t][r]&&(n.textAlign="start",n.fillText(null!==(i=_[t][r])&&void 0!==i?i:"",d.PixelToMMX(G[t][r].x)/y*m,u+f+P/2))}l+=C}for(let e=0;e<=V;e++)n.beginPath(),n.moveTo(p,u+(e*P+g/2)),n.lineTo(p+G,u+(e*P+g/2)),n.strokeStyle="#F1F1F1",n.stroke();let w=p;for(const e of h)n.beginPath(),n.moveTo(w+e-g/2,u),this._emptyPartList?n.lineTo(w+e-g/2,u+1*P):n.lineTo(w+e-g/2,u+V*P),n.strokeStyle="#F1F1F1",n.stroke(),w+=e;n.beginPath(),n.moveTo(p+g/2,u),n.lineTo(p+g/2,u+V*P),n.strokeStyle="#F1F1F1",n.stroke(),n.beginPath(),n.moveTo(p+G-g/2,u),n.lineTo(p+G-g/2,u+V*P),n.strokeStyle="#F1F1F1",n.stroke()}d.updatePaper({viewportSize:e.viewportSize})}}GetType(){return"VCXPartListPrepareRenderToTexture"}}}),define("DS/VCXWebDressup/VCXContextualContentDressup_Spec",["DS/VCXWebKernel/VCXContextualContentOccurenceExperience"],function(e){"use strict";return e.extend({createContentCommandsPanel:function(e,t,i){let r={};e.sort((e,t)=>e.order-t.order);let o=0;for(let a of e){let e={type:"button"};e.name="Change"+t+"0"+o,e.cmdId=a.name,e.iconFolder=i,e.icon="icons/32/"+a.icon+".png",r[e.name]=e,o++}return r},appendContent:function(e,t,i){if(t&&1===t.length){if("VCXViewpoint_Spec"!==t[0].GetType()){e.Visibility={type:"button",name:"Dropdown_hide",cmdId:"VCXHideSelectionCmd",index:10},e.Duplicate={type:"button",name:"DuplicateSelection",cmdId:"VCXDuplicateCmd",index:20};var r=[];r.push({type:"PushItem",title:"Cut",state:"enabled",action:"VCXCutCmd",fonticon:{content:"wux-ui-3ds-cut wux-ui-3ds"}}),r.push({type:"PushItem",title:"Copy",state:"enabled",action:"VCXCopyCmd",fonticon:{content:"wux-ui-3ds-copy wux-ui-3ds"}}),r.push({type:"PushItem",title:"Paste",state:"enabled",action:"VCXPasteCmd",fonticon:{content:"wux-ui-3ds-paste wux-ui-3ds"}}),r.push({type:"PushItem",title:"Apply To",fonticon:{content:"wux-ui-3ds-propagate wux-ui-3ds"},submenu:[{type:"PushItem",title:"Apply on all scenes",fonticon:{content:"wux-ui-3ds-select-all-checkboxes wux-ui-3ds"},action:"VCXApplyToAllCmd"},{type:"PushItem",title:"Apply on selected scenes",fonticon:{content:"wux-ui-3ds-select-on wux-ui-3ds"},action:"VCXApplyToSelectedCmd"}]}),r.push({type:"PushItem",title:"Add to Selection Set",state:this.GetObject()._experienceBase.getManager("VCXSelectionSetManager").getSelectionSetCache().length>0?"enabled":"disabled",action:"VCXAddToSelectionSetCmd",fonticon:{content:"wux-ui-3ds-folder-add wux-ui-3ds"}}),r.push({type:"PushItem",title:"Delete",state:"enabled",action:"VCXDeleteDressupSelectionCmd",fonticon:{content:"wux-ui-3ds-trash wux-ui-3ds"}}),r.push({type:"PushItem",title:"Restore Default",state:"enabled",action:"VCXRestoreNeutralsCmd",fonticon:{content:"wux-ui-3ds-reset wux-ui-3ds"}}),e.Menu={type:"menu",name:"Dropdown_hide",cmdId:"VCXMenuCmd",content:r,index:100}}this.GetObject()._experienceBase.getManager("VCXContextManager").isSupported("VCXCustomStylesSupport")&&(e.VCXSaveStylesToDocument={type:"button",name:"VCXSaveStylesToDocument",cmdId:"VCXSaveStylesToDocumentCmd",index:15},e.VCXLoadStylesFromDocument={type:"button",name:"VCXLoadStylesFromDocument",cmdId:"VCXLoadStylesFromDocumentCmd",index:16})}}})}),define("DS/VCXWebDressup/VCXACuttableObject",["UWA/Class","DS/Visualization/ThreeJS_DS"],function(e,t){"use strict";return e.extend({init:function(){console.log("init is called",this)},isCut:function(e,t,i){return!!(i._plane&&i.sectionActive&&e.GetPropertyValue("Collab.Attach.3DAttach")&&e.GetPropertyGroupVisibility("Group.Attach"))&&this.isObjectIncludeInCut(e,t,i)},isObjectIncludeInCut:function(e,i,r){var o=!1,a=r;return e.processAnchorsIDs(function(r){o=!0;var n=e._Anchors[r];if(n){var s=e.GetAnchorWorldMatrix(r,i).clone();let p=a.QueryInterface("VCXIModifiable"),u=a._plane.clone();if(p&&p.GetPropertyValue("Section.SpaceBackAlpha")<p.GetPropertyValue("Section.SpaceFrontAlpha")&&u.negate(),u.distanceToPoint((new t.Vector3).getPositionFromMatrix(s))>0)return o=!1,!1;var l=n.GetValueLink();if(l&&l.Value&&!a.isInCuttedObjectList(l.Value))return o=!1,!1}}),o}})}),define("DS/VCXWebDressup/VCXVisibilityDressup",["DS/VCXWebVisibility/VCXVisibility"],function(e){"use strict";return e.extend({init:function(){this._parent(),this._visible=0},GetType:function(){return"VCXVisibilityDressup"},SetVisibility:function(e){var t=e;if("boolean"==typeof e)console.warn("Method SetVisibility use only a number as unique parameter"),t="number"!=typeof e||1!==e&&0!==e?!0===e?1:!1===e?0:-1:e;else if("number"!=typeof e)return void console.warn("Method SetVisibility use only a number as unique parameter");this._parent(t),this.GetObject().setDirty(),this.GetObject()._experienceBase.getManager("VCXDressupManager").changeDressupVisibility()}})}),define("DS/VCXWebDressup/VCXPropertiesObserver",["UWA/Class"],function(e){"use strict";return e.extend({init:function(e){this._observedProperties=[],this._dirtyProperties=0},add:function(e,t){var i=e.QueryInterface("VCXIModifiable");if(i&&t){var r=i.GetProperty(t),o=null;r&&(o=r.GetPropertyValue()),this._observedProperties.push({modifiable:i,propertyName:t,previousPropertyValue:null,currentPropertyValue:o,dirty:!0}),this._dirtyProperties++}},update:function(){for(var e=0;e<this._observedProperties.length;e++){var t=!1,i=this._observedProperties[e].modifiable.GetProperty(this._observedProperties[e].propertyName),r=null;i&&(r=i.GetPropertyValue());var o=this._observedProperties[e].currentPropertyValue;o?o.IsEqualTo(r)||(t=!0):r&&(t=!0),t&&(this._observedProperties[e].previousPropertyValue=o,this._observedProperties[e].currentPropertyValue=r,this._dirtyProperties++)}},dirtify:function(){this._dirtyProperties++},postUpdate:function(){this._dirtyProperties=0;for(var e=0;e<this._observedProperties.length;e++)this._observedProperties[e].dirty=!1},isDirty:function(){return this._dirtyProperties>0}})});__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXCompass_Spec",["require","exports","DS/VCXWebDressup/VCXDressup_Spec"],function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{}return r.prototype.getDefaultName=function(){return"Compass"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXCompass_Spec"}}),r.prototype.dressupGroupName="Environment",r});__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXViewpoint_Spec",["require","exports","DS/VCXWebDressup/VCXDressup_Spec"],function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{}return r.prototype.getDefaultName=function(){return"ViewpointCamera"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXViewpoint_Spec"}}),r.prototype.dressupGroupName="ViewpointCamera",r}),define("DS/VCXWebDressup/VCXPolylinePrepareRenderToTexture",["require","exports","DS/VCXWebDressup/VCXDressupPrepareRenderToTexture"],function(e,t,i){"use strict";return class extends i{constructor(){super(),this.addOrNew("white",["Collab.Body.Line.Color","Collab.Body.Line.Back.Color"])}GetType(){return"VCXPolylinePrepareRenderToTexture"}}}),define("DS/VCXWebDressup/VCXContextualContentDressupCopyStyles",["DS/VCXWebDressup/VCXContextualContentDressup_Spec"],function(e){"use strict";return e.extend({appendContent:function(e,t,i){this._parent(e,t,i),t&&1===t.length&&(e.CopyStyle={type:"button",name:"CopyStyle",cmdId:"VCXFormatPainterCmd",index:30})}})});__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXPartList_Spec",["require","exports","DS/VCXWebDressup/VCXDressup_Spec"],function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{isDirty(){return!this._dirty&&this._experienceBase.getManager("VCXComponentPartListManager")?this._experienceBase.getManager("VCXComponentPartListManager").ListHasChanged:this._dirty}}return r.prototype.getDefaultName=function(){return"PartList"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXPartList_Spec"}}),r.prototype.dressupGroupName="PartList",r}),define("DS/VCXWebDressup/VCXRedlinePrepareRenderToTexture",["require","exports","DS/VCXWebDressup/VCXDressupPrepareRenderToTexture"],function(e,t,i){"use strict";return class extends i{constructor(){super(),this.addOrNew("white",["Actor.Color"])}GetType(){return"VCXRedlinePrepareRenderToTexture"}}});__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXMagnetLine_Spec",["require","exports","DS/VCXWebDressup/VCXDressup_Spec"],function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{constructor(){super(),this.IsAnchorDependent=!0}}return r.prototype.getDefaultName=function(){return"MagnetLine"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXMagnetLine_Spec"}}),r.prototype.dressupGroupName="MagnetLine",r}),define("DS/VCXWebDressup/VCXArrowPrepareRenderToTexture",["require","exports","DS/VCXWebDressup/VCXDressupPrepareRenderToTexture"],function(e,t,i){"use strict";return class extends i{constructor(){super(!1),this.addOrNew("white",["Arrow.Body.Color","Arrow.Body.2.Color"])}GetType(){return"VCXArrowPrepareRenderToTexture"}}});__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXPolyline_Spec",["require","exports","DS/VCXWebDressup/VCXDressup_Spec"],function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{constructor(){super(),this.IsAnchorDependent=!0}}return r.prototype.getDefaultName=function(){return"Polyline"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXPolyline_Spec"}}),r.prototype.dressupGroupName="Markups",r});__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/CXPCameraActor_Spec",["require","exports","DS/VCXWebDressup/VCXDressup_Spec"],function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{constructor(){super(),this.IsViewPointDependent=!1,this.IsAnchorDependent=!0,this._tooltip=""}updatePosition(){var e,t=this.GetObject()._experienceBase.getManager("VCXVisuManager");let i=this.QueryInterface("VCXIViewpointController");i&&(i.resetMatrixAndDOI(),t.CameraControlsViewpoint&&(null===(e=this.QueryInterface("VCXIModifiable"))||void 0===e?void 0:e.GetProperty("Actor.IsActive").GetPropertyValue().Value)&&i.toViewpoint());var r=t.getActiveViewport();r&&(i=r.QueryInterface("VCXIViewpointController"))&&i.fromViewpoint()}}return r.prototype.getDefaultName=function(){return"Camera"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"CXPCameraActor_Spec"}}),r.prototype.dressupGroupName="Cameras",r});__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCX3DGrid_Spec",["require","exports","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXDressup_Spec"],function(e,t,i,r){"use strict";r=__importDefault(r);class o extends r.default{constructor(){super(),this._plane=null,this._isPickerSensitive=!0,this.alpha=.15}preRender(e){if(this._plane){var t=this.QueryInterface("VCXIModifiable"),r=this.QueryInterface("W3AISGNodeHolder");if(!r||!t)return;var o=r.getWorldMatrix(e.viewer);this._plane.set(new i.Vector3(0,100,1),0).applyMatrix4(o)}super.preRender(e)}update(e){this._plane||(this._plane=new i.Plane(new i.Vector3(0,1,-1),0)),super.update(e)}postUpdate(e){super.postUpdate(e)}Dispose(){this._plane=null}}return o.prototype.getDefaultName=function(){return"3DGrid"},Object.defineProperty(o.prototype,"componentType",{enumerable:!0,get:function(){return"VCX3DGrid_Spec"}}),o.prototype.dressupGroupName="Grids",o});__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXRedLine_Spec",["require","exports","DS/VCXWebDressup/VCXDressup_Spec"],function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{constructor(){super(),this.IsAnchorDependent=!0}}return r.prototype.getDefaultName=function(){return"Redline"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXRedLine_Spec"}}),r.prototype.dressupGroupName="Markups",r});__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXCallout_Spec",["require","exports","DS/VCXWebSystem/VCXTextTools","DS/VCXWebModifiables/VCXModelChangeListener","DS/VCXWebVisu/VCXModifiablesAccess","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebDressup/VCXDressup_Spec","DS/VCXWebProperties/VCXProperty"],function(e,t,i,r,o,a,n,s,l){"use strict";a=__importDefault(a),n=__importDefault(n),s=__importDefault(s),l=__importDefault(l);class p extends s.default{constructor(){super(),this._IsAnchorDependent=!0,this._DelegatePropChangeForHTMLEditor=!0}DelegatePropChangeForHTMLEditor(e,t){let s=!1;if(e&&t&&"Collab.Text.html"===t.GetPropertyInfo().GetPropertyName()){let p=this.QueryInterface("VCXIModifiable");if(p){let u=p.GetProperty("Collab.Text").GetPropertyValue().ToString();if(u.includes("#Actor.PartList.ID")){let h=p.GetAttachedOccurences();for(let p=0;p<h.length;p++){let d=h[p];if(!d)continue;let c=o.GetLinkedParentLevelFromPropertyValue(u,d._ID,this._experienceBase);if(c){let o=c.QueryInterface("VCXIModifiable");if(o){if(!c.PartListEnabled){let t=c.PartListDescription;""===t&&""===(t=o.GetProperty("Actor.Name.ReferenceTitle")&&o.GetProperty("Actor.Name.ReferenceTitle").GetPropertyValue().Value)&&(t=o.GetProperty("Actor.Name")&&o.GetProperty("Actor.Name").GetPropertyValue().Value);let i=o.GetProperty("Actor.PartList.Enabled").GetPropertyInfo(),r=new a.default(!0),s=new l.default(i,r),p=o.GetProperty("Actor.PartList.Description").GetPropertyInfo(),u=new n.default(t),h=new l.default(p,u);e.ChangeProperty(o,s),e.ChangeProperty(o,h)}let p=i.htmlDecode(t.GetPropertyValue().Value),u=o.GetProperty("Actor.PartList.ID").GetPropertyInfo(),h=new n.default(p),d=new l.default(u,h);e.ChangeProperty(o,d);let y=this._experienceBase.getManager("VCXModelChangeListener");y&&(y.hasChanged(r.FChangeFlag.PartListEnabled,!0),s=!0)}}}}}}return s}isDirty(){var e,t;return!!((null===(e=this.QueryInterface("VCXIVisibility"))||void 0===e?void 0:e.GetVisibility())&&(null===(t=this.QueryInterface("VCXIModifiable"))||void 0===t?void 0:t.GetPropertyValue("Collab.Body.ContributeToEqualSize")))||this._dirty}}return p.prototype.getDefaultName=function(){return"Callout"},Object.defineProperty(p.prototype,"componentType",{enumerable:!0,get:function(){return"VCXCallout_Spec"}}),p.prototype.dressupGroupName="Callouts",p});__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXSection_Spec",["require","exports","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXPropertiesObserver","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebProperties/VCXColor","DS/VCXWebDressup/VCXDressup_Spec"],function(e,t,i,r,o,a,n){"use strict";o=__importDefault(o),a=__importDefault(a),n=__importDefault(n);class s extends n.default{constructor(){super(),this.sectionActive=!1,this.IsAnchorDependent=!0,this._keyValues={},this._plane=null,this._planeClipped=!1,this._cappingMaterial=null,this._previousSectionActive=!1,this.alpha=.15}isInCuttedObjectList(e){var t=!1,i=this.QueryInterface("VCXIModifiable"),r=null==i?void 0:i.GetProperty("Actor.ListActors");if(r){var o=r.GetPropertyValue().GetValue();if(o&&o.length)for(var a=0;a<o.length;a++){t=!0;let i=this._experienceBase.ComponentsMap.GetComponentFromID(e);for(;i;){if(o[a].GetValue()===i.GetID())return!0;const e=i.QueryInterface("VCXIModelNavigable"),t=e&&e.getParent();i=t&&t.GetObject()}}}return!t}preRender(e){if(this._plane){var t=this.QueryInterface("VCXIModifiable"),r=this.QueryInterface("W3AISGNodeHolder");if(!r||!t)return;var o=r.getWorldMatrix(e.viewer);this._plane.set(new i.Vector3(0,0,1),0).applyMatrix4(o),t.GetPropertyValue("Section.AutoFlip")&&e.viewpoint.getSightDirection().dot(this._plane.normal)<0&&this._plane.negate()}super.preRender(e)}isActive(){var e=this.QueryInterface("VCXIVisibility");if(e&&e.GetVisibility()!==o.default.EVisState.Hidden){var t=this.QueryInterface("VCXIModifiable");if(t&&t.GetPropertyValue("Section.Enable")&&t.GetPropertyValue("Actor.Visibility.Opacity")>.5)return!0}return!1}update(e){if(this.recomputeSectionManager&&(this.recomputeSectionManager.update(),this.recomputeSectionManager.isDirty()&&this._experienceBase.getManager("VCXSectionManager")&&(this._experienceBase.getManager("VCXSectionManager").Dirty=!0)),this.sectionActive=this.isActive(),this._previousSectionActive!==this.sectionActive&&(this._previousSectionActive=this.sectionActive,this.sectionActive?this._experienceBase.getManager("VCXSectionManager").registerSection(this):this._experienceBase.getManager("VCXSectionManager").unregisterSection(this)),this._plane||(this._plane=new i.Plane(new i.Vector3(0,0,-1),0)),this.sectionActive){if(!this.recomputeSectionManager){this.recomputeSectionManager=new r;var t=this.QueryInterface("VCXIModifiable");this.recomputeSectionManager.add(t,"Section.Enable"),this.recomputeSectionManager.add(t,"Section.SpaceBackAlpha"),this.recomputeSectionManager.add(t,"Section.Capping"),this.recomputeSectionManager.add(t,"Section.Capping.ActorColor")}if(!this._cappingMaterial){let e=this.QueryInterface("VCXIModifiable");if(!e)return;this._experienceBase.getManager("VCXContextManager").getMainViewer().setClippingPlaneUpVector(this._plane,new i.Vector3(0,0,1));var o=Math.cos(e.GetPropertyValue("Section.Hatching.Angle")*Math.PI/180),n=Math.sin(e.GetPropertyValue("Section.Hatching.Angle")*Math.PI/180),s=e.GetColorPropertyValue("Section.Capping");this._cappingMaterial=new i.HatchingMeshMaterial({stripesDirection:new i.Vector2(o+n,n-o),spaceWidth:10,stripesWidth:1.5,spaceColor:s.GetThreeColor(),stripesColor:(new a.default).FromRGBA(1,0,0).GetThreeColor()})}}super.update(e)}postUpdate(e){super.postUpdate(e),this.sectionActive&&this.recomputeSectionManager&&this.recomputeSectionManager.postUpdate()}Dispose(){this._experienceBase.getManager("VCXSectionManager").unregisterSection(this)}}return s.prototype.getDefaultName=function(){return"Section"},Object.defineProperty(s.prototype,"componentType",{enumerable:!0,get:function(){return"VCXSection_Spec"}}),s.prototype.dressupGroupName="Sections",s}),define("DS/VCXWebDressup/VCXCirclePrepareRenderToTexture",["require","exports","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXColor","DS/VCXWebDressup/VCXDressupPrepareRenderToTexture"],function(e,t,i,r,o,a,n){"use strict";return class extends n{constructor(){super(),this.addOrNew("white",["Collab.Body.Line.Color","Collab.Background.Color","Collab.Background2.Color","Circle.Background.Type"])}getValueForMask(e){return"Collab.Background2.Color"===e?new i((new a).FromRGBA(0,0,0,1)):"Circle.Background.Type"===e?new r(3):super.getValueForMask(e)}GetType(){return"VCXCirclePrepareRenderToTexture"}}}),define("DS/VCXWebDressup/VCXCuttableObjectArrowAndCircle",["DS/VCXWebDressup/VCXACuttableObject","DS/Visualization/ThreeJS_DS"],function(e,t){"use strict";return e.extend({isCut:function(e,t,i){return!(!i._plane||!i.sectionActive||!e._bIsArrow&&!e._bIsCircle)&&this.isObjectIncludeInCut(e,t,i)}})});__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCX3DAligner_Spec",["require","exports","DS/VCXWebExperienceBase/VCXSceneGraphOverridesServices","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXDressup_Spec","DS/CoreEvents/Events","DS/VCXWebProperties/VCXPropertyValueFrame"],function(e,t,i,r,o,a,n){"use strict";o=__importDefault(o);class s extends o.default{constructor(){super(...arguments),this.objectsToMove={}}lock(){var e,t;this.objectsToMove={};const o=this.QueryInterface("VCXIModifiable");if(!o)return!1;let a=0;const n=o.GetProperty("Actor.ListActors");if(n){const e=n.GetPropertyValue().GetValue();if(e&&e.length)for(var s=0;s<e.length;s++){const t=this._experienceBase.ComponentsMap.GetComponentFromID(e[s].GetValue());t&&(this.objectsToMove[t.GetID()]={object:t},a++)}}if(!a){const e=o.GetAttachedOccurence(0);this.objectsToMove[e.GetID()]={object:e},a++}if(!a)return!1;this._SceneGraphOverrideSet||(this._SceneGraphOverrideSet=i.createAndPushSceneGraphOverrideSet(this._experienceBase));const l=this._experienceBase.getManager("VCXContextManager").getMainViewer();this._experienceBase.getManager("VCXSelectionManager").setOverrideStyle(l,!1,{visibleAlpha:.01});for(let a in this.objectsToMove){const n=this.objectsToMove[a];let s=n.object.QueryInterface("VCXIModelNavigable");s=s&&s.getParent();let p=!1;for(;s&&!p;){const t=null===(e=null==s?void 0:s.GetObject())||void 0===e?void 0:e.GetID();t&&this.objectsToMove[t]&&(p=!0),s=s.getParent()}if(!p){const e=(new r.Matrix4).getInverse(o.GetAnchorWorldMatrix(0,l)),a=n.object.QueryInterface("W3AISGNodeHolder"),s=(null===(t=null==a?void 0:a.getPathElement())||void 0===t?void 0:t.getParentPath().getWorldMatrix(l))||new r.Matrix4,p=n.object.QueryInterface("VCXIModifiable"),u=p&&p.GetProperty("Actor.Position").GetPropertyValue();if(u){n.initialWFrameInRM=(new r.Matrix4).multiplyMatrices(e,(new r.Matrix4).multiplyMatrices(u.GetFrame().GetValue(),s)),n.initialWPivotInRM=(new r.Matrix4).multiplyMatrices(e,(new r.Matrix4).multiplyMatrices(u.GetPivot().GetValue(),s));const t=i.getSceneGraphOverride(this._SceneGraphOverrideSet,null,a.getPathElement());t.setOpacity(.5,!0),t.setPickability("IGNORED",!0)}}}const p=this.QueryInterface("W3AISGNodeHolder");if(p){p.getSGNode().switchOff2On()}return!0}move(e,t){const i=this._experienceBase.getManager("VCXContextManager").getMainViewer();for(let o in this.objectsToMove){const a=this.objectsToMove[o];if(a.initialWFrameInRM&&a.initialWPivotInRM){const o=a.object.QueryInterface("W3AISGNodeHolder"),s=a.object.QueryInterface("VCXIModifiable"),l=(new r.Matrix4).multiplyMatrices(e,a.initialWFrameInRM),p=(new r.Matrix4).multiplyMatrices(e,a.initialWPivotInRM),u=(null==o?void 0:o.getPathElement().getParentPath().getWorldMatrix(i))||new r.Matrix4,h=(new r.Matrix4).getInverse(u),d=(new r.Matrix4).multiplyMatrices(h,l),c=(new r.Matrix4).multiplyMatrices(h,p),y=s.GetProperty("Actor.Position").Clone(),C=y.GetPropertyValue();C.SetFrame(new n(d)),C.SetPivot(new n(c)),y.SetPropertyValue(C),t.AddOrModifyProperty(s.GetHashing(),y)}}this._setRobot(e)}unlock(){i.removeSceneGraphOverrideSet(this._experienceBase,this._SceneGraphOverrideSet),this._SceneGraphOverrideSet=null;const e=this._experienceBase.getManager("VCXContextManager").getMainViewer();this._experienceBase.getManager("VCXSelectionManager").resetOverrideStyle(e,!1);const t=this.QueryInterface("W3AISGNodeHolder");if(t){t.getSGNode().switchOn2Off()}}_setRobot(e){if(this.objectsToMove){const t=[];for(let e in this.objectsToMove){const i=this.objectsToMove[e];t.push(i.object)}a.publish({event:"VCX_DONT_CHNG_ROBOT_POS_AT_TRANSFORM_BEGIN",data:{targets:t,matrix:e}})}}}return s.prototype.getDefaultName=function(){return"3DAligner"},Object.defineProperty(s.prototype,"componentType",{enumerable:!0,get:function(){return"VCX3DAligner_Spec"}}),s.prototype.dressupGroupName="3DAligner",s});__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/AmbienceModel_Spec",["require","exports","DS/Visualization/ThreeJS_DS","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebDressup/VCXDressup_Spec"],function(e,t,i,r,o){"use strict";r=__importDefault(r),o=__importDefault(o);class a extends o.default{CallDispose(){super.CallDispose(),this._ambience&&this._ambience.dispose()}updatePosition(){if(!this._ambience)return!1;var e=this.QueryInterface("VCXIVisibility");if(e&&e.GetVisibility()!==r.default.EVisState.Hidden){let e=this.QueryInterface("VCXIModifiable");if(e)this._experienceBase.getManager("VCXVisuManager").updateGroundPosition({radius:e.GetPropertyValue("Ambience.Background.Radius.Auto")?-1:e.GetPropertyValue("Ambience.Background.Radius"),position:e.GetPropertyValue("Ambience.Background.Position.Auto")?null:e.GetPropertyValue("Ambience.Background.Position"),ambience:this._ambience}),this._ambience.setAutoGroundOffset(!1),this._ambience.setGroundHeight(new i.Vector3(0,0,e.GetPropertyValue("Ambience.Ground.Scaleratio")/6)),this._ambience.setGroundOffset(e.GetPropertyValue("Ambience.Ground.Offset")),this._ambience.getTransform().makeRotationZ(e.GetPropertyValue("Ambience.Background.Rotation")*Math.PI/180),this._ambience.updateMatrix(),this._ambience.setFiniteMode(e.GetPropertyValue("Ambience.Background.Finite"))}}}return a.prototype.getDefaultName=function(){return"Ambience"},Object.defineProperty(a.prototype,"componentType",{enumerable:!0,get:function(){return"AmbienceModel_Spec"}}),a.prototype.dressupGroupName="Ambiences",a}),define("DS/VCXWebDressup/VCXMarkup_Spec",["require","exports","DS/VCXWebDressup/VCXPropertyValueUnitFormater","DS/VCXWebDressup/VCXDressup_Spec","DS/VCXWebVisualization/VCXImageManager"],function(e,t,i,r,o){"use strict";class a extends r{constructor(){super(...arguments),this.fontHeight=12,this._imageType=o.Effect.None,this._IsDressupPropertiesChangeIndependent=!1}isDirty(){var e=this.QueryInterface("VCXIModifiable");if(e.GetPropertyGroupVisibility("Group.Text")){var t=e.GetComputedStringProperty("Collab.Text",i.format);if(t||(t=""),this._currentText!==t)return this._currentText=t,!0}return super.isDirty()}clearImage(){delete this.backgroundImage,delete this.imagePromise,this._imageType=o.Effect.None,this._docID=-10}getImage(e){this._imageType=e;var t=this,i=this.QueryInterface("VCXIModifiable");if(i){let r;const o=i.GetPropertyValue("Collab.PIP.Scenario.ID");if(o){const e=this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[o];if(e){const t=e.GetPIPDocId&&e.GetPIPDocId();this._imageTS!==t.timeStamp&&(this.clearImage(),this._imageTS=t.timeStamp),r=t.docID}}if(null!=(r=r||i.GetPropertyValue("Collab.Image.Doc.ID"))&&i.GetPropertyGroupVisibility("Group.Image")||(r=-1),this._imageType===e&&this._docID===r){if(this.imagePromise)return this.imagePromise}else this.clearImage();return this._imageType,this._docID,r>=0?this.imagePromise=this._experienceBase.getManager("VCXImageManager").GetImageFromDocID(r,e).then(e=>{var i=this.QueryInterface("VCXIModifiable");if(i&&i.GetPropertyValue("Collab.Image.Doc.PrepareRender")){var r=document.createElement("canvas"),o=r.getContext("2d");r.width=e.width,r.height=e.height;for(var a=e.getContext("2d").getImageData(0,0,e.width,e.height),n=a.data,s=0;s<n.length;s+=4)n[s]=255,n[s+1]=255,n[s+2]=255;o.putImageData(a,0,0),r._IsReadyToUse=!0,e=r}return t.backgroundImage=e,e}):(this.backgroundImage=null,this.imagePromise=Promise.resolve(null)),this.imagePromise}console.warn(new Error("Component does not implement modifiable"))}get componentType(){return"VCXMarkup_Spec"}get IsDressupPropertiesChangeIndependent(){if(this._IsDressupPropertiesChangeIndependent)return!0;var e=this.QueryInterface("VCXIModifiable");return!!(e&&e.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<a.EPositionType.EndOfAutomaticPositionning)||this._IsDressupPropertiesChangeIndependent}}return function(e){let t,i,r,o,a,n,s,l,p,u,h,d;!function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right"}(t=e.EHAlignment||(e.EHAlignment={})),function(e){e[e.Top=0]="Top",e[e.Middle=1]="Middle",e[e.Bottom=2]="Bottom"}(i=e.EVAlignment||(e.EVAlignment={})),function(e){e[e.Left=0]="Left",e[e.Centered=1]="Centered",e[e.Justified=3]="Justified",e[e.Right=2]="Right"}(r=e.EHTextAlignment||(e.EHTextAlignment={})),function(e){e[e.Top=0]="Top",e[e.Middle=1]="Middle",e[e.Bottom=2]="Bottom"}(o=e.EVTextAlignment||(e.EVTextAlignment={})),function(e){e[e.None=0]="None",e[e.Rectangle=10]="Rectangle",e[e.RoundedRectangle=1]="RoundedRectangle",e[e.Square=20]="Square",e[e.RoundedSquare=2]="RoundedSquare",e[e.Ellipse=4]="Ellipse",e[e.Circle=3]="Circle",e[e.Rhombus=5]="Rhombus",e[e.RemoveBorder=6]="RemoveBorder",e[e.User=7]="User",e[e.CircumscribedCircle=8]="CircumscribedCircle"}(a=e.EBodyShape||(e.EBodyShape={})),function(e){e[e.None=0]="None",e[e.Paper=1]="Paper"}(n=e.ESizeControlType||(e.ESizeControlType={})),function(e){e[e.None=0]="None",e[e.Spherical=2]="Spherical",e[e.AlongX_yInCamUp=4]="AlongX_yInCamUp"}(s=e.EBillboardType||(e.EBillboardType={})),function(e){e[e.Perimetric=0]="Perimetric",e[e.Circle=1]="Circle",e[e.Rectangle=2]="Rectangle",e[e.Bottom=3]="Bottom",e[e.BottomAndLeft=4]="BottomAndLeft",e[e.BottomAndRight=5]="BottomAndRight",e[e.BottomAndTop=6]="BottomAndTop",e[e.Top=7]="Top",e[e.TopAndLeft=8]="TopAndLeft",e[e.TopAndRight=9]="TopAndRight",e[e.Left=10]="Left",e[e.LeftAndRight=11]="LeftAndRight",e[e.Right=12]="Right",e[e.EndOfAutomaticPositionning=13]="EndOfAutomaticPositionning",e[e.RelativeToReferential=101]="RelativeToReferential",e[e.Free2D=1e3]="Free2D",e[e.Free3D=1001]="Free3D"}(l=e.EPositionType||(e.EPositionType={})),function(e){e[e.None=0]="None",e[e.Model=1]="Model",e[e.Vertex=2]="Vertex",e[e.GradientTooltip=3]="GradientTooltip",e[e.TooltipStyle=4]="TooltipStyle",e[e.Line=5]="Line",e[e.User=6]="User",e[e.Simple=7]="Simple",e[e.ArcTooltip=8]="ArcTooltip",e[e.Arrow=9]="Arrow",e[e.Basic=30]="Basic",e[e.Modern=100]="Modern",e[e.Custom=101]="Custom"}(p=e.EAttachType||(e.EAttachType={})),function(e){e[e.None=0]="None",e[e.Sphere=1]="Sphere",e[e.FullArrow_1=2]="FullArrow_1",e[e.FullArrow_2=3]="FullArrow_2",e[e.HalfArrow_B1=4]="HalfArrow_B1",e[e.HalfArrow_T1=5]="HalfArrow_T1",e[e.HalfArrow_T2=6]="HalfArrow_T2",e[e.HalfArrow_B2=7]="HalfArrow_B2",e[e.Dot=20]="Dot",e[e.Yellow=10]="Yellow",e[e.White=30]="White",e[e.Red=40]="Red",e[e.Line=45]="Line",e[e.SmallRed=50]="SmallRed"}(u=e.EExtremityType||(e.EExtremityType={})),function(e){e[e.None=0]="None",e[e.Middle=10]="Middle",e[e.Bent=20]="Bent",e[e.Line=30]="Line",e[e.Mustache=40]="Mustache"}(h=e.ELeadType||(e.ELeadType={})),function(e){e[e.Uniform=0]="Uniform",e[e.Custom=1]="Custom"}(d=e.EMLSpacing||(e.EMLSpacing={}))}(a||(a={})),a}),define("DS/VCXWebDressup/VCXDressupNode",["DS/Visualization/Node3D","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebDressup/VCXPropertiesObserver","DS/VCXWebModifiables/VCXModelChangeListener"],function(e,t,i,r){"use strict";var o=e.extend({init:function(e){this._parent(e.name),this._globalOpacity=null;return this._Modifiable=e.modifiable,this._Modifiable?this._ExperienceBase=this._Modifiable.ExperienceBase:this._ExperienceBase=e.experience,this.Dirty=!0,this.Modifiable&&(this.layerObserver=new i,this.layerObserver.add(this.Modifiable,"Actor.IsAlwaysOnTop"),this.layerObserver.add(this.Modifiable,"Collab.3D.Paper.Positioning.Type"),this.layerObserver.add(this.Modifiable,"Collab.3D.Paper.Is.Background")),this._handles={},this.setPickingPriorityId("VCXDressup"),this},dispose:function(){delete this._ExperienceBase,delete this._Modifiable,delete this.layerObserver,delete this._overrides,this._parent()},GetPropertyValue:function(e,t){return this.Modifiable.GetPropertyValue(e,t)},GetFontPropertyValue:function(e){return this.Modifiable.GetFontPropertyValue(e)},GetColorPropertyValue:function(e){return this.Modifiable.GetColorPropertyValue(e)},GetFramePropertyValue:function(e){return this.Modifiable.GetFramePropertyValue(e)},GetAnchorValue:function(e){return this.Modifiable.GetAnchorValue(e)},GetAnchorWorldMatrix:function(e,t){return this.Modifiable.GetAnchorWorldMatrix(e,t)},GetPropertyGroupVisibility:function(e){return this.Modifiable.GetPropertyGroupVisibility(e)},GetOpacity:function(){return this.Modifiable.GetOpacity()},RecursiveSetRenderDepth:function(e){this.traverse(function(e,t){e.setRenderDepth&&void 0!==t?e.setRenderDepth(t):e.renderDepth=t},e)},RecursiveSetRenderPasses:function(e){this.traverse(function(e,t){e.setRenderPasses&&(e.noAA&&t.noAA?e.setRenderPasses(t.noAA):e.setRenderPasses(t.AA))},e)},onAddChildNode:function(e,t){var i={noTreatment:!1,setFrustumCulled:!1,setShadow:!1,setMirror:!1,exludeFromBounding:!0,setPickParent:!0};if(UWA.extend(i,t,!0),!(this.isDressupGrp||e&&e.isDressupGrp||i.noTreatment)){e.traverse(function(e){e.setFrustumCulled&&e.setFrustumCulled(i.setFrustumCulled),e.setShadow&&e.setShadow(i.setShadow,i.setShadow),e.setMirror&&e.setMirror(i.setMirror),e.exludeFromBounding&&e.exludeFromBounding(i.exludeFromBounding),e.setPickParent&&e.setPickParent(i.setPickParent)});var r=this.getParents()&&this.getParents()[0];r?r&&r.isDressupGrp&&this.setPickParent(!1):this.setPickParent(!1)}},add:function(e,t){var i=this._parent(e);return this.onAddChildNode(e,t),i},addChild:function(e,t){var i=this._parent(e);return this.onAddChildNode(e,t),i},getOverride:function(e){this._overrides||(this._overrides={});var t=this._overrides[e.viewerID];return t||(t=this.ExperienceBase.getManager("VCXDressupManager").getDressupDressupNodeOverride(e,this),this._overrides[e.viewerID]=t),t},update:function(e){var t=this.GlobalOpacity;t<=0&&(this.lastAlwaysOnTop=null);var i=!1;if(this._previousOpacity!==t&&(0===this._previousOpacity||0===t)){var o=this._ExperienceBase.getManager("VCXModelChangeListener");o&&(o.hasChanged(r.FChangeFlag.DressupVisibility,!0),o.hasChanged(r.FChangeFlag.Visibility,!0)),this._previousOpacity=t,i=!0}(t||i)&&this.layerObserver&&(this.layerObserver.update(),this.layerObserver.isDirty()&&(this.needToChangeLayer=!0))},postUpdate:function(e){this.layerObserver&&this.layerObserver.postUpdate(e)},preRender:function(e){if(!(e&&e.viewer&&e.viewer._isDigger)){var t=this.Modifiable.ExperienceBase;if(this.viewpointVisibility=!0,this.GlobalOpacity){var i=t.getManager("VCXVisuManager"),r=t.getManager("VCXIVManager");if(this.allAnchorsReady=i.areAllAnchorsReadyAndVisible(e,this.Modifiable),this.allAnchorsReady&&(i.isInFrustum(e,this.Modifiable)||r&&r.scenario)){var o=t.getManager("VCXSectionManager");o&&(this.viewpointVisibility=!o.isCut(this.Modifiable,e))}else this.viewpointVisibility=!1}}},handleLayers:function(e){this.alwaysOnTop=this.GetPropertyValue("Actor.IsAlwaysOnTop");var i=this.ExperienceBase.getManager("VCXIVManager");if(i&&i.scenario)this.RecursiveSetRenderPasses(["main"]);else{if(this.lastAlwaysOnTop!==this.alwaysOnTop||e||this.needToChangeLayer){this.needToChangeLayer=!1;var r=this.ExperienceBase.getManager("VCXVisuManager");this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=t.EPositionType.Free2D?this.GetPropertyValue("Collab.3D.Paper.Is.Background")?this.RecursiveSetRenderPasses({AA:[r.getRenderList("VCXBackground2DDressups")]}):this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<t.EPositionType.EndOfAutomaticPositionning?this.RecursiveSetRenderPasses({AA:[r.getRenderList("VCXPre2DDressups"),r.getRenderList("VCX2DDressups")],noAA:[r.getRenderList("VCXPre2DDressups"),r.getRenderList("VCXNoAADressups")]}):this.RecursiveSetRenderPasses({AA:[r.getRenderList("VCXPre2DDressups"),r.getRenderList("VCX2DDressups2"),"PassToCheckAvailableSpace"],noAA:[r.getRenderList("VCXPre2DDressups"),r.getRenderList("VCXNoAADressups"),"PassToCheckAvailableSpace"]}):this.alwaysOnTop?this.RecursiveSetRenderPasses({AA:[r.getRenderList("VCXNOc3DDressups")],noAA:[r.getRenderList("VCXPre2DDressups"),r.getRenderList("VCXNoAADressups")]}):this.RecursiveSetRenderPasses({AA:["main"]})}this.lastAlwaysOnTop=this.alwaysOnTop}},isNodeBuilt:function(){var e=this.Modifiable.QueryInterface("W3AISGNodeHolder").giveSGNode();return Boolean(e)}});return Object.defineProperty(o.prototype,"ExperienceBase",{enumerable:!0,get:function(){return this._ExperienceBase?this._ExperienceBase:this._Modifiable?this._Modifiable.ExperienceBase:void 0}}),Object.defineProperty(o.prototype,"Modifiable",{enumerable:!0,get:function(){return this._Modifiable}}),Object.defineProperty(o.prototype,"Anchors",{enumerable:!0,get:function(){return this.Modifiable._Anchors}}),Object.defineProperty(o.prototype,"GlobalOpacity",{enumerable:!0,get:function(){return this.GetOpacity()}}),o}),define("DS/VCXWebDressup/VCXDressupGrpSGNodeHolder",["DS/WebApplicationBase/W3AASGNodeHolder","DS/VCXWebDressup/VCXDressupNode"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e=this.GetObject().QueryInterface("VCXIModifiable"),i={name:this.GetObject().getName(),modifiable:e};this._sgNode=new t(i),this._sgNode.isDressupGrp=!0}this._sgNode.setVisibilityInTree(!1);var r=this.QueryInterface("VCXIModelNavigable");if(r){var o=r.getParent().QueryInterface("W3AISGNodeHolder");o&&(o.getSGNode().addChild(this._sgNode,{noTreatment:!0}),this._pathElement=o.getPathElement().clone(),this._pathElement.addElement(this._sgNode))}return this._sgNode},isSelfManagedPathElement:function(){return!0}})}),define("DS/VCXWebDressup/VCXDressupSGNodeHolder",["DS/WebApplicationBase/W3AASGNodeHolder","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXMarkup_Spec"],function(e,t,i){"use strict";return e.extend({init:function(){},buildSGNode:function(){return this._sgNode&&(this._sgNode.setVisibilityInTree(!0),this._sgNode._isDressupNode=!0),this._sgNode},getWorldMatrix:function(e,t){return this.getAnchorReferential(t)},getAnchorReferential:function(e){var r=new t.Matrix4,o=this.QueryInterface("VCXIModifiable");if(o){var a=this.GetObject()._experienceBase.getManager("VCXContextManager"),n=e;if(!n){var s=a.getMainViewer();n={viewer:s,viewpoint:s.currentViewpoint}}var l=o.getAnchorsCount();if(0===l)return this.computePointAtOptimalDistance(n);o.GetPropertyValue("Collab.3D.Paper.UsesBarycenter")||(l=1);var p=new t.Vector3,u=this;o.processAnchorsIDs(function(e){if(o.GetPropertyValue("Collab.3D.Paper.Referential.In.World")||1!==l){var s=o.GetAnchorWorldMatrix(e,n);if(!s)return null;var h=(new t.Vector3).getPositionFromMatrix(s);h.divideScalar(l),p.add(h);var d=u.GetObject().getWorkingRootPathElement();r.makeTranslation(p.x,p.y,p.z).extractRotation(d.getWorldMatrix(a.getMainViewer()))}else r=o.GetAnchorWorldMatrix(e,n);var c=o.GetPropertyValue("Collab.3D.Paper.Positioning.Type"),y=c<=i.EPositionType.Free2D,C=c===i.EPositionType.RelativeToReferential;if(o.GetProperty("Collab.Attach.Show")&&o.GetPropertyGroupVisibility("Group.Attach")&&(o.GetPropertyValue("Collab.Attach.LeadType")||o.GetPropertyValue("Collab.Measurement.Attach.Type"))||!y||C||(r=u.computePointAtOptimalDistance(n)),!o.GetPropertyValue("Collab.3D.Paper.UsesBarycenter"))return!1},{sort:!0})}return r},getCenterSceneBoundingSphereMat:function(e,i){var r=i instanceof t.Matrix4?i:new t.Matrix4,o=this.GetObject()._experienceBase.getManager("VCXPaperManager");if(!o)return console.warn("Couldn't find the PaperManager, return input matrix"),r;var a=e.viewer.getSceneBoundingSphere().center.clone(),n=o.ModelToMM2(e,a),s=(new t.Vector3).getPositionFromMatrix(r);return o.ModelToMM2(e,s).z=n.z,s=o.MMToModel2(e,n),(new t.Matrix4).setPosition(s)},computePointAtOptimalDistance:function(e){var i=e.viewpoint.camera.fov,r=e.viewer.getSceneBoundingSphere().radius;null===!this.tanFov&&this.oldFov===i||(this.oldFov=i,this.tanFov=Math.tan(i*Math.PI/180));var o=r/this.tanFov,a=e.viewpoint.camera.position.clone();return a.add(e.viewpoint.getSightDirection().clone().multiplyScalar(o)),(new t.Matrix4).setPosition(a)},getPathElement:function(){return this._pathElement?this._pathElement:this._sgNode?(console.warn("???? Ask ITY"),this._pathElement):null},unreferenceSGNode:function(){this._sgNode&&(this._sgNode.dispose&&this._sgNode.dispose(),delete this._sgNode)},isSelfManagedPathElement:function(){return!0}})}),define("DS/VCXWebDressup/VCXSmart3DPaperNode",["require","exports","DS/VCXWebDressup/VCXDressupNode","DS/CoreEvents/Events","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools","DS/VCXWebDressup/VCXMarkup_Spec"],function(e,t,i,r,o,a,n){"use strict";class s extends i{constructor(e){return super(e),this._Depth=0,this._VerticalToUse=s.VerticalToUseEnum.CAMERA,this._BillboardDirectionType=s.BillboardDirectionTypeEnum.CAMERA_DIRECTION,this._Position2D=new o.Vector2,this._Position=new o.Vector3,this._PositioningType=n.EPositionType.Free3D,this._PositionRadius=0,this._ScalingFactor=1,this._SizeControlType=s.SizeControlTypeEnum.NoControl,this._BillboardType=s.BillboardTypeEnum.NO_BILLBOARD,this._Opacity=1,this._ModifiableProperties=!0,this._posDirty=!0,this._zRotation=0,this._Depth=0,this._VerticalToUse=s.VerticalToUseEnum.CAMERA,this._BillboardDirectionType=s.BillboardDirectionTypeEnum.CAMERA_DIRECTION,this._Position2D=new o.Vector2,this._Position=new o.Vector3,this._PositioningType=n.EPositionType.Free3D,this._PositionRadius=0,this._ScalingFactor=1,this._SizeControlType=0,this._BillboardType=s.BillboardTypeEnum.NO_BILLBOARD,this._Opacity=1,this._ModifiableProperties=!0,this._posDirty=!0,this}_ComputeBillboardMatrix(e,t,i){var r=(new o.Matrix4).extractRotation(this.GetReferential(e)),n=e.viewpoint.getEyePosition(),l=e.viewpoint.getSightDirection().clone();l.normalize();var p,u,h=this.ExperienceBase.getManager("VCXIVManager")&&this.ExperienceBase.getManager("VCXIVManager").scenario;if(p=this.VerticalToUse!==s.VerticalToUseEnum.CAMERA||h?new o.Vector3(0,0,1):e.viewpoint.getUpDirection(),this.BillboardDirectionType===s.BillboardDirectionTypeEnum.CAMERA_DIRECTION?u=(new o.Vector3).subVectors(t,l):this.BillboardDirectionType===s.BillboardDirectionTypeEnum.CAMERA_POSITION&&(u=n.clone()),this.BillboardType===s.BillboardTypeEnum.CYLINDRICAL);else if(this.BillboardType===s.BillboardTypeEnum.SPHERICAL)r=(new o.Matrix4).lookAt(u,t,p);else if(this.BillboardType===s.BillboardTypeEnum.PRESERVE_X_AXIS_Y_IN_CAM_PLANE||this.BillboardType===s.BillboardTypeEnum.PRESERVE_X_AXIS_Y_IN_CAM_PLANE_Y_ALWAYS_UP){var d;d=this.BillboardXAxis?this.BillboardXAxis:a.getVxFromMatrix(i).normalize();var c=e.viewpoint.getSightDirection(),y=(new o.Vector3).crossVectors(p,c).normalize();r=(new o.Matrix4).lookAt(u,t,p);var C=this.ExperienceBase.getManager("VCXPaperManager");if(C){var m=C.ModelToMM2(e,t),f=C.ModelToMM2(e,(new o.Vector3).addVectors(t,d)).sub(m).normalize(),V=C.ModelToMM2(e,(new o.Vector3).addVectors(t,y)).sub(m).normalize(),b=(new o.Vector3).crossVectors(f,V),P=new o.Quaternion(0,0,b.z,1+f.dot(V));P.normalize(),r.multiply((new o.Matrix4).makeRotationFromQuaternion(P)),this.BillboardType===s.BillboardTypeEnum.PRESERVE_X_AXIS_Y_IN_CAM_PLANE_Y_ALWAYS_UP&&V.dot(f)<.001&&r.multiply((new o.Matrix4).makeRotationZ(Math.PI))}}return r}_Build(){}is2D(){return this.PositioningType==n.EPositionType.Free2D||this.PositioningType<n.EPositionType.EndOfAutomaticPositionning}GetReferential(e){if(this._referential)return this._referential;if(this.Modifiable&&this.ExperienceBase){var t=this.Modifiable.QueryInterface("W3AISGNodeHolder"),i=e.viewer||this.ExperienceBase.getManager("VCXContextManager").getMainViewer();return t.getWorldMatrix(i,e)}return new o.Matrix4}SetReferential(e){this._referential=e}_computeMatrix(e,t){var i=this.Position.clone();if(this.PositioningType===n.EPositionType.Free3D)i.applyMatrix4(this.GetReferential(e));else if(this.PositioningType===n.EPositionType.RelativeToReferential){var r=this.ExperienceBase.getManager("VCXPaperManager"),s=(new o.Vector3).getPositionFromMatrix(this.GetReferential(e));i=r.GetModelPointFromModelPointAndPaperPosition(e,s,this.Position2D,this.PositionRadius)}else if(this.PositioningType<=n.EPositionType.Free2D){s=(new o.Vector3).getPositionFromMatrix(this.GetReferential(e));var l=this.ExperienceBase.getManager("VCXPaperManager").ModelToMM2(e,s),p=a.clamp(l.z,-.99,.99);(m=new o.Vector3).x=this.Position2D.x,m.y=this.Position2D.y,m.z=p,i=this.ExperienceBase.getManager("VCXPaperManager").MMToModel2(e,m)}var u=1;if(1===this.SizeControlType)u=this.ExperienceBase.getManager("VCXPaperManager").GetPaperRatio(e,i);else if(2===this.SizeControlType){var h=e.viewpoint.getEyePosition().distanceTo(i);h||(h=1);var d=.5*e.viewer.div.clientHeight*Math.abs(1/(Math.tan(Math.PI*e.viewpoint.getAngle()/360)*h));(u=0!==(d*=this.ExperienceBase.getManager("VCXPaperManager").Zoom)?1/d:1)||(u=1)}u*=this.ScalingFactor;r=this.ExperienceBase.getManager("VCXPaperManager");const c=new o.Matrix4,y=new o.Matrix4,C=new o.Matrix4;if(C.makeScale(u,u,u),this.is2D()&&r.shouldUsePaperReferential()){var m;(m=new o.Vector3).x=this.Position2D.x,m.y=-this.Position2D.y,m.z=0,y.setPosition(m);var f=r.getPaperReferential();c.copy(f),c.multiply(y),c.multiply((new o.Matrix4).makeRotationZ(this._zRotation))}else{y.setPosition(i);var V=this._ComputeBillboardMatrix(e,i,this.GetReferential(e));c.multiply(y),c.multiply(V),c.multiply((new o.Matrix4).makeRotationZ(this._zRotation)),c.multiply(C)}return t&&this.setMatrix(c),c}updateMatrix(){var e=this.ExperienceBase.getManager("VCXContextManager").getMainViewer(),t={viewer:e,viewpoint:e.currentViewpoint};this.setMatrix(this._computeMatrix(t,!1))}_onLinkedToSceneGraph(){super._onLinkedToSceneGraph(),this.tokenChange=r.subscribe({event:"/VISU/"},e=>{"@onViewpointChange"===e.eventType&&(this._posDirty=!0)})}_onUnlinkedToSceneGraph(){super._onUnlinkedToSceneGraph(),r.unsubscribe(this.tokenChange)}preRender(e){if(this._posDirty&&(this._posDirty=!1,this.updateMatrix(),this.AttachedDiv&&this.ExperienceBase.getManager("VCXContextManager").getMainViewer()===e.viewer)){var t=this.ExperienceBase.getManager("VCXPaperManager");if(t){var i=(new o.Vector3).getPositionFromMatrix(this.getMatrix()),r=t.ModelToMM2(e,i),a=t.MMToPixel2(e,r),n=t.GetMmToPxRatio();n*=.3527,this._previousRatio!==n&&(this._previousRatio=n,this.AttachedDiv.style.transform="scale("+n+")"),this._previousLeft===a.x&&this._previousTop===a.y||(this._previousLeft=a.x,this._previousTop=a.y,this.AttachedDiv.style.left=a.x+"px",this.AttachedDiv.style.top=a.y+"px")}}}update(){if(super.update(),!(this.GlobalOpacity<=0)){if(this._ModifiableProperties){if(void 0!==this.GetPropertyValue("Collab.3D.Paper.Billboard.Type")&&(this.BillboardType=this.GetPropertyValue("Collab.3D.Paper.Billboard.Type")),void 0!==this.GetPropertyValue("Collab.3D.Paper.3D.Text.Position")&&(this.Position=this.GetPropertyValue("Collab.3D.Paper.3D.Text.Position")),void 0!==this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")){if(this.PositioningType=this.GetPropertyValue("Collab.3D.Paper.Positioning.Type"),this.lastPositioningType!==this.PositioningType){var e=this.PositioningType<=n.EPositionType.Free2D,t=this.Modifiable.QueryInterface("W3AISGNodeHolder").giveSGNode();t.exludeFromBounding&&t.exludeFromBounding(e)}this.lastPositioningType=this.PositioningType}void 0!==this.GetPropertyValue("Collab.3D.Paper.Size.Control.Type")&&(this.SizeControlType=this.GetPropertyValue("Collab.3D.Paper.Size.Control.Type")),void 0!==this.GetPropertyValue("Collab.3D.Paper.Scaling.Factor")&&(this.ScalingFactor=this.GetPropertyValue("Collab.3D.Paper.Scaling.Factor")),void 0!==this.GetPropertyValue("Collab.Body.Rotation")&&(this.ZRotation=this.GetPropertyValue("Collab.Body.Rotation")*Math.PI/180),void 0!==this.GetPropertyValue("Collab.3D.Paper.Paper.Position")?this.Position2D=this.GetPropertyValue("Collab.3D.Paper.Paper.Position"):(void 0!==this.GetPropertyValue("Collab.3D.Paper.Paper.Position.X")&&(this.Position2D.x=this.GetPropertyValue("Collab.3D.Paper.Paper.Position.X")),void 0!==this.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y")&&(this.Position2D.y=this.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y"))),void 0!==this.GetPropertyValue("Collab.3D.Paper.3D.Text.Radius")&&(this.PositionRadius=this.GetPropertyValue("Collab.3D.Paper.3D.Text.Radius"))}this._posDirty=!0,this.handleLayers()}}get ModifiableProperties(){return this._ModifiableProperties}set ModifiableProperties(e){this._ModifiableProperties=e}get Opacity(){return this._Opacity}set Opacity(e){this._Opacity=e}get BillboardType(){return this._BillboardType}set BillboardType(e){this._BillboardType=e}get BillboardXAxis(){return this._BillboardXAxis}set BillboardXAxis(e){this._BillboardXAxis=e}get SizeControlType(){return this._SizeControlType}set SizeControlType(e){this._SizeControlType=e}get ScalingFactor(){return this._ScalingFactor}set ScalingFactor(e){this._ScalingFactor=e}get PositioningType(){return this._PositioningType}set PositioningType(e){this._PositioningType=e}get Position(){return this._Position}set Position(e){this._Position=e}get Position2D(){return this._Position2D}set Position2D(e){this._Position2D=e}get PositionRadius(){return this._PositionRadius}set PositionRadius(e){this._PositionRadius=e}get Referential(){if(this._referential)return this._referential;if(this.Modifiable&&this.ExperienceBase){var e=this.Modifiable.QueryInterface("W3AISGNodeHolder"),t=this.ExperienceBase.getManager("VCXContextManager");return e.getWorldMatrix(t.getMainViewer())}return new o.Matrix4}set Referential(e){this._referential=e}get Depth(){return this._Depth}set Depth(e){this._Depth=e}get VerticalToUse(){return this._VerticalToUse}set VerticalToUse(e){this._VerticalToUse=e}get BillboardDirectionType(){return this._BillboardDirectionType}set BillboardDirectionType(e){this._BillboardDirectionType=e}get ZRotation(){return this._zRotation}set ZRotation(e){this._zRotation=e}get AttachedDiv(){return this._AttachedDiv}set AttachedDiv(e){this._AttachedDiv=e}}return function(e){let t,i,r,o;!function(e){e[e.NO_BILLBOARD=0]="NO_BILLBOARD",e[e.CYLINDRICAL=1]="CYLINDRICAL",e[e.SPHERICAL=2]="SPHERICAL",e[e.PRESERVE_X_AXIS_Y_IN_CAM_PLANE=3]="PRESERVE_X_AXIS_Y_IN_CAM_PLANE",e[e.PRESERVE_X_AXIS_Y_IN_CAM_PLANE_Y_ALWAYS_UP=4]="PRESERVE_X_AXIS_Y_IN_CAM_PLANE_Y_ALWAYS_UP"}(t=e.BillboardTypeEnum||(e.BillboardTypeEnum={})),function(e){e[e.NoControl=0]="NoControl",e[e.InPaper=1]="InPaper",e[e.InViewer=2]="InViewer"}(i=e.SizeControlTypeEnum||(e.SizeControlTypeEnum={})),function(e){e[e.WORLD=0]="WORLD",e[e.CAMERA=1]="CAMERA"}(r=e.VerticalToUseEnum||(e.VerticalToUseEnum={})),function(e){e[e.CAMERA_DIRECTION=0]="CAMERA_DIRECTION",e[e.CAMERA_POSITION=1]="CAMERA_POSITION"}(o=e.BillboardDirectionTypeEnum||(e.BillboardDirectionTypeEnum={}))}(s||(s={})),s}),define("DS/VCXWebDressup/VCXRayTracingNode",["DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/VCXWebIO/VCXPixelImage"],function(e,t,i,r,o,a){"use strict";return e.extend({init:function(e){return this.ExperienceBase=e,this._parent("RayTracingNode"),this.bool=!1,this.dirty=!0,this.previousImage="",this},dispose:function(){this._Smart3DPaperNode&&(this._Smart3DPaperNode.dispose(),this._Smart3DPaperNode=null),this._parent()},_Build:function(e){var t=this.ExperienceBase.getManager("VCXVisuManager");this.setRenderPasses([t.getRenderList("VCXPreRaytracing"),t.getRenderList("VCXRaytracing")]),this._PrimitiveGroup=new i.PrimitiveGroup;var a=new i.Buffer({component:i.VertexComponentEnum.POSITION,data:new Float32Array(12)});a.dimension=3,this._PrimitiveGroup.addBuffer(0,a);var n=new i.Buffer({component:i.VertexComponentEnum.TEX_COORD_0,data:new Float32Array(16)});n.dimension=3,this._PrimitiveGroup.addBuffer(1,n);var s,l=new i.Buffer({indexBuffer:!0,data:new Uint16Array(6)});this._PrimitiveGroup.addBuffer(2,l);var p=0;(s=a.data)[p++]=0,s[p++]=0,s[p++]=0,s[p++]=1,s[p++]=0,s[p++]=0,s[p++]=1,s[p++]=-1,s[p++]=0,s[p++]=0,s[p++]=-1,s[p++]=0;p=0;(s=n.data)[p++]=0,s[p++]=1,s[p++]=0,s[p++]=1,s[p++]=1,s[p++]=0,s[p++]=1,s[p++]=0,s[p++]=0,s[p++]=0,s[p++]=0,s[p++]=0,p=0,(s=l.data)[p++]=0,s[p++]=2,s[p++]=1,s[p++]=0,s[p++]=3,s[p++]=2;var u=new i.Primitive({nbIndices:6,connectivity:i.ConnectivityTypeEnum.TRIANGLES,fillGAS:new i.FillAttributes}),h=new i.VertexComponent({nbVertices:4,bufferId:0,indices:new i.IndexArray({bufferId:2,offset:0})}),d=new i.VertexComponent({nbVertices:4,bufferId:1,indices:new i.IndexArray({bufferId:2,offset:0})});u.addVertexComponent(h),u.addVertexComponent(d),this._PrimitiveGroup.addPrimitive(u),this._MeshNode=r.createMeshNode(this._PrimitiveGroup),this.setMaterial(),this._MeshNode.setVisibilityInTree(!1);var c={name:"BackgroundSmartNode",experience:this.ExperienceBase};this._Smart3DPaperNode=new o(c),this._Smart3DPaperNode.BillboardType=2,this._Smart3DPaperNode.SizeControlType=1,this._Smart3DPaperNode.PositioningType=1e3,this._Smart3DPaperNode.Depth=0,this._Smart3DPaperNode.add(this._MeshNode),this.add(this._Smart3DPaperNode),this.traverse(function(e,t){return e.setPickable(i.PICKTHROUGH),e.excludeFromHighlight(t,t),!1},!0)},preRender:function(e){this._Smart3DPaperNode&&this._Smart3DPaperNode.preRender(e)},setMaterial:function(e){this._bodyMat||(this._bodyMat=new t.MeshBasicMaterial({side:t.FrontSide,forceSide:!0,color:"#ffffff",opacity:this.backgroundOpacity,force:!0,depthWrite:!1}),this._MeshNode&&this._MeshNode.setMaterial(this._bodyMat)),e?(this._bodyMat.map=e,this._bodyMat.needsUpdate=!0):(this._bodyMat.map=null,this._bodyMat.needsUpdate=!0)},downloadURI:function(e,t){var i=document.createElement("a");i.download=t,i.href=e,document.body.appendChild(i),i.click(),document.body.removeChild(i)},update:function(e){this._parent();let i=this.ExperienceBase.getManager("VCXLivePreviewRenderingManager");if(!i)return;let r=i.livePreviewWEB.visible;if(this.backgroundOpacity=1,this._Smart3DPaperNode||this._Build(),!this._MeshNode)return;let o=i.livePreviewWEB._frameId;if((o&&o!==this.lastImage||r!==this.bool)&&(this.dirty=!0),this.dirty&&(this.bool=r,this.lastImage=o,this.bool||(this.setVisibility(!1),this.ExperienceBase.getManager("VCXContextManager").getMainViewer().render(),this.dirty=!1),i.livePreviewWEB.lastBuffer&&r)){let e=i.livePreviewWEB.lastBuffer,r=i.livePreviewWEB.lastBufferMask;if(r&&r.length&&e&&e.data&&e.data.length===r.length){i.livePreviewWEB.lastBuffer.done=!0;for(let t=0;t<e.data.length;t+=4){let i=r[t+3]/255;e.data[t]=r[t]*i+e.data[t]*(1-i),e.data[t+1]=r[t+1]*i+e.data[t+1]*(1-i),e.data[t+2]=r[t+2]*i+e.data[t+2]*(1-i)}}let o=new a(e.data,e.width,e.height).toDataUrl("image/jpeg");if(o===i.livePreviewWEB.lastImage)return;i.livePreviewWEB.lastImage=o,t.ImageUtils.loadTexture(o,{},e=>{this.setMaterial(e),this.setVisibility(!0)}),this.dirty=!1}this._Smart3DPaperNode&&this._bodyMat&&(this._bodyMat.opacity=this.backgroundOpacity);var n=this.ExperienceBase.getManager("VCXPaperManager");if(n){var s=n.Size;this._MeshNode.setMatrix((new t.Matrix4).makeScale(s.x,s.y,1))}}})});__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXPanel_Spec",["require","exports","DS/VCXWebDressup/VCXMarkup_Spec"],function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{}return function(e){let t;!function(e){e[e.None=0]="None",e[e.Image=1]="Image",e[e.Text=2]="Text"}(t=e.ESubType||(e.ESubType={}))}(r||(r={})),r.prototype.getDefaultName=function(){return"Panel"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXPanel_Spec"}}),r.prototype.dressupGroupName="Panels",r});__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXDiggerPanel_Spec",["require","exports","DS/VCXWebDressup/VCXPanel_Spec"],function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{}return r.prototype.getDefaultName=function(){return"DiggerPanel"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXDiggerPanel_Spec"}}),r.prototype.dressupGroupName="Panels",r}),define("DS/VCXWebDressup/VCXExtremityNode",["DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXMarkup_Spec","DS/Visualization/Node3D","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory"],function(e,t,i,r,o,a,n,s){"use strict";var l=e.extend({init:function(e){return this._parent(e),this.anchorID=e.anchorID,this._Type=1,this._ArrowTail=!0,e&&"number"==typeof e.type&&(this.Type=e.type),this},_getExtremityNode:function(){var e="#00ff00",a=1;switch(this._lineWidth=null,this.Type){case void 0:case t.EExtremityType.None:return null;case t.EExtremityType.Sphere:return s.createSphereNode({radius:a});case t.EExtremityType.FullArrow_1:case t.EExtremityType.FullArrow_2:case t.EExtremityType.HalfArrow_B1:case t.EExtremityType.HalfArrow_T1:case t.EExtremityType.HalfArrow_T2:case t.EExtremityType.HalfArrow_B2:var l=new n.PrimitiveGroup;l.editable=!0,l.fillAttr=new n.FillAttributes,l.lineAttr=new n.LineAttributes(this.GetColorPropertyValue("Collab.Attach.Line").GetThreeColor(),this.GetPropertyValue("Collab.Attach.Line.Width")),l.pointAttr=new n.PointAttributes;var p=new n.Buffer;p.size=9,p.component=n.VertexComponentEnum.POSITION,p.format=n.DataTypeEnum.FLOAT,p.dimension=3,p.data=new Float32Array(p.size),p.data[0]=0,p.data[1]=0,p.data[2]=0,p.data[3]=3.5,4===this.Type||7===this.Type?p.data[4]=0:p.data[4]=-1.5,p.data[5]=0,p.data[6]=3.5,5===this.Type||6===this.Type?p.data[7]=0:p.data[7]=1.5,p.data[8]=0,l.addBuffer(0,p);var u=new n.Buffer;u.indexBuffer=!0,u.size=3,u.format=n.DataTypeEnum.UINT,u.dimension=1,u.data=new Uint16Array(u.size);var h=u.data;h[0]=0,h[1]=1,h[2]=2,l.addBuffer(1,u);var d=new n.Primitive;d.nbIndices=3,d.connectivity=n.ConnectivityTypeEnum.TRIANGLES;var c=new n.VertexComponent;if(c.component=n.VertexComponentEnum.POSITION,c.nbVertices=3,c.nbValuesPerVertex=3,c.format=n.DataTypeEnum.FLOAT,c.cardinality=0,c.bufferId=0,c.indices=new n.IndexArray,c.indices.bufferId=1,c.indices.format=n.DataTypeEnum.UINT,c.indices.offset=0,d.addVertexComponent(c),l.addPrimitive(d),(f=new i).add(s.createMeshNode(l)),this._ArrowTail){var y={type:r.ELineType.Plain,lineWidth:this.LineWidth,color:this.GetColorPropertyValue("Collab.Attach.Line").GetThreeColor()},C=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(y),m=s.createLineNode({points:[new o.Vector3(0,0,0),new o.Vector3(7,0,0)],material:C});f.add(m)}return this.handleLayers(!0),f;case t.EExtremityType.SmallRed:case t.EExtremityType.Yellow:case t.EExtremityType.Dot:case t.EExtremityType.Red:case t.EExtremityType.White:case t.EExtremityType.Line:switch(this.Type){case t.EExtremityType.Yellow:e="#ffff00";break;case t.EExtremityType.Dot:a*=.5;break;case t.EExtremityType.Red:e="#ff0000";break;case t.EExtremityType.White:e="#ffffff";break;case t.EExtremityType.SmallRed:e="#ff0000",a*=.5;break;case t.EExtremityType.Line:}var f;return this._Material=new o.MeshBasicMaterial({side:o.DoubleSide,transparent:!1,opacity:1,color:e,force:!0,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:-10}),this._lineWidth=1,this._Material.line=new o.LineBasicMaterial({side:o.DoubleSide,transparent:!1,color:"#000000",opacity:1,force:!0,polygonBorderMode:!0,lineWidth:this._lineWidth,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:-20,linecap:"round"}),this.Type!==t.EExtremityType.Dot&&this.Type!==t.EExtremityType.SmallRed||(this._Material.line.visible=!1),f=s.createCircleNode({radius:.7*a,material:this._Material,fill:!0});default:console.warn("Extremity "+this.Type+" not defined")}},dispose:function(){this._Smart3DPaperNode&&(this._Smart3DPaperNode.dispose(),this._Smart3DPaperNode=null),this._parent()},_Build:function(){var e={name:"AttachExtremitySmartNode",modifiable:this.Modifiable,type:this._type};this._Smart3DPaperNode=new a(e),this._referential&&this._Smart3DPaperNode.SetReferential(this._referential),this._Smart3DPaperNode.ModifiableProperties=!1,this._Smart3DPaperNode.SizeControlType=1,this._Smart3DPaperNode.BillboardType=3,this.add(this._Smart3DPaperNode),this.handleLayers(!0)},preRender:function(e){if(this._parent(e),this.viewpointVisibility&&this.allAnchorsReady&&this.GlobalOpacity){if(this.setVisibility(!0),this._Material&&this._Material.line){this._Material.line.handleByPrerender=!0;let e=this.ExperienceBase.getManager("VCXPaperManager").UnitValueToPixel(null!==this._lineWidth?this._lineWidth:this.LineWidth);e>=1?(this._Material.line.setLineWidth(e),this._Material.line.visible=!0):this._Material.line.visible=!1}this._Smart3DPaperNode&&this._Smart3DPaperNode.preRender(e)}else this.setVisibility(!1)},update:function(e){if(this._parent(),this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var i=this._globalOpacity>0;i&&(this._Smart3DPaperNode||this._Build()),this.setVisibility(i)}if(!(this._globalOpacity<=0)&&(this.LineWidth=this.Modifiable.GetPropertyValue("Collab.Attach.Line.Width"),this._previousType===this.Type&&this._previousLineWidth===this.LineWidth||(this._previousType=this.Type,this._previousLineWidth=this.LineWidth,this._Node&&(this._Smart3DPaperNode.remove(this._Node),this._Material=null,this._Node=null)),!this._Node&&this._Smart3DPaperNode&&(this._Node=this._getExtremityNode(0),this._Node&&this._Smart3DPaperNode.add(this._Node)),this._Smart3DPaperNode&&this._Smart3DPaperNode.update(e),this._Node)){var r=this.GetColorPropertyValue("Collab.Attach.Line");this._Material||(this._Material=new o.MeshBasicMaterial({}),this._lineWidth=1,this._Material.line=new o.LineBasicMaterial({side:o.DoubleSide,transparent:!1,color:"#000000",opacity:1,force:!0,polygonBorderMode:!0,lineWidth:this._lineWidth,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:-20,linecap:"round"}),this._Node.setMaterial(this._Material)),this._Material.opacity=r.a*this._globalOpacity,this.Type!==t.EExtremityType.Yellow&&this.Type!==t.EExtremityType.Red&&this.Type!==t.EExtremityType.White&&this.Type!==t.EExtremityType.SmallRed&&(this._Material.color=r.GetThreeColor(),this._Material.line&&(this._Material.color=r.GetThreeColor())),this._Material.line&&(this._Material.line.opacity=this._Material.opacity),this._Material.force=!0,this.handleLayers()}},SetReferential:function(e){this._referential=e.clone(),this._Smart3DPaperNode&&(this._Smart3DPaperNode.Referential=this._referential)},GetReferential:function(e){return this._Smart3DPaperNode?this._Smart3DPaperNode.GetReferential(e):null}});return Object.defineProperty(l.prototype,"Type",{enumerable:!0,get:function(){return this._Type},set:function(e){this._Type=e}}),Object.defineProperty(l.prototype,"LineWidth",{enumerable:!0,get:function(){return this._LineWidth},set:function(e){this._LineWidth=e}}),l});__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXArrow_Spec",["require","exports","DS/VCXWebDressup/VCXDressup_Spec"],function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{constructor(){super(),this._IsAnchorDependent=!0}}return Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXArrow_Spec"}}),r.prototype.dressupGroupName="Markups",r});__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXCornerArrow_Spec",["require","exports","DS/VCXWebDressup/VCXArrow_Spec"],function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{constructor(){super(),this.IsAnchorDependent=!0}}return r.prototype.getDefaultName=function(){return"CornerArrow"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXCornerArrow_Spec"}}),r.prototype.dressupGroupName="Markups",r});__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXLinearArrow_Spec",["require","exports","DS/VCXWebDressup/VCXArrow_Spec"],function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{}return r.prototype.getDefaultName=function(){return"Arrow"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXLinearArrow_Spec"}}),r.prototype.dressupGroupName="Markups",r}),define("DS/VCXWebDressup/VCXArrowSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder"],function(e){"use strict";return e.extend({init:function(){}})}),define("DS/VCXWebDressup/VCXArrowNode",["DS/VCXWebDressup/VCXDressupNode","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/Visualization/Node3D"],function(e,t,i,r,o){"use strict";return e.extend({init:function(e){return this._parent(e),this._Node=null,this._verticesNb=null,this._trianglesIndicesNb=null,this._lineIndicesNb=null,this},_Build:function(){var e=0,a=0,n=0,s=0;this._verticesNb=2*this._step+8,this._lineIndicesNb=2*this._verticesNb;var l=2*this._step+6;this._trianglesIndicesNb=3*l,this._bkGrndPrimGrp=new i.PrimitiveGroup({editable:!0}),this._borderPrimGrp=new i.PrimitiveGroup({editable:!0});var p=new i.Buffer({component:i.VertexComponentEnum.POSITION,data:new Float32Array(3*this._verticesNb),dimension:3}),u=new i.Buffer({component:i.VertexComponentEnum.DIFFUSE_COLOR,data:new Float32Array(4*this._verticesNb),dimension:4}),h=new i.Buffer({indexBuffer:!0,data:new Uint16Array(this._trianglesIndicesNb)}),d=new i.Buffer({component:i.VertexComponentEnum.POSITION,data:new Float32Array(3*this._verticesNb),dimension:3}),c=new i.Buffer({component:i.VertexComponentEnum.DIFFUSE_COLOR,data:new Float32Array(4*this._verticesNb),dimension:4}),y=new i.Buffer({indexBuffer:!0,data:new Uint16Array(this._lineIndicesNb)});this._bkGrndPrimGrp.addBuffer(0,p),this._bkGrndPrimGrp.addBuffer(1,u),this._bkGrndPrimGrp.addBuffer(2,h),this._borderPrimGrp.addBuffer(0,d),this._borderPrimGrp.addBuffer(1,c),this._borderPrimGrp.addBuffer(2,y);var C=h.data;for(C[e++]=0,C[e++]=1,C[e++]=2,C[e++]=0,C[e++]=2,C[e++]=2*this._step+6,C[e++]=0,C[e++]=2*this._step+6,C[e++]=2*this._step+7,a=2;a<this._step+2;++a)n=a+1,s=this._verticesNb-a,C[e++]=a,C[e++]=n,C[e++]=s,C[e++]=s,C[e++]=n,C[e++]=s-1;for(C[e++]=this._step+2,C[e++]=this._step+3,C[e++]=this._step+4,C[e++]=this._step+2,C[e++]=this._step+4,C[e++]=this._step+6,C[e++]=this._step+6,C[e++]=this._step+4,C[e++]=this._step+5,C=y.data,e=0,a=0;a<this._verticesNb;a++)C[e++]=a,C[e++]=a===this._verticesNb-1?0:a+1;var m=new i.Primitive({nbIndices:this._trianglesIndicesNb,connectivity:i.ConnectivityTypeEnum.TRIANGLES}),f=new i.VertexComponent({nbVertices:this._verticesNb,bufferId:0,indices:new i.IndexArray({bufferId:2,offset:0})}),V=new i.VertexComponent({nbVertices:this._verticesNb,bufferId:1,indices:new i.IndexArray({bufferId:2,offset:0})});m.addVertexComponent(f),m.addVertexComponent(V),this._bkGrndPrimGrp.addPrimitive(m);var b=new i.Primitive({nbIndices:this._lineIndicesNb,connectivity:i.ConnectivityTypeEnum.LINES}),P=new i.VertexComponent({nbVertices:this._verticesNb,bufferId:0,indices:new i.IndexArray({bufferId:2,offset:0})}),g=new i.VertexComponent({nbVertices:this._verticesNb,bufferId:1,indices:new i.IndexArray({bufferId:2,offset:0})});b.addVertexComponent(P),b.addVertexComponent(g),this._borderPrimGrp.addPrimitive(b),this._bodyMat=new t.MeshBasicMaterial({side:t.DoubleSide,vertexColors:t.VertexColors,color:"#ffffff",transparent:!0,opacity:1,force:!0,polygonOffset:!0,polygonOffsetFactor:-1,polygonOffsetUnits:-10});var _=this.Modifiable.getLineMaterialParams("Collab.Border.Line",this._lineMat,this._lastFrontLineType);Object.keys(_).length>0&&("number"==typeof _.type&&_.type!==this._lastFrontLineType&&(this._lastFrontLineType=_.type),_.polygonBorderMode=!0,this._lineMat=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(_,this._lineMat)),this._NodeBkGrnd=r.createMeshNode(this._bkGrndPrimGrp),this._NodeBkGrnd.setMaterial(this._bodyMat),this._NodeBkGrnd.setVisibilityInTree(!1),this._NodeBorder=r.createMeshNode(this._borderPrimGrp),this._NodeBorder.setMaterial(this._lineMat),this._NodeBorder.setVisibilityInTree(!1),this._Node=new o,this._Node.setVisibilityInTree(!0),this._Node.addChild(this._NodeBkGrnd),this._Node.addChild(this._NodeBorder),this.addChild(this._Node,{exludeFromBounding:!1})},preRender:function(e){if(this._parent(e),this.viewpointVisibility&&this.allAnchorsReady&&this.GlobalOpacity){if(this.setVisibility(!0),this._lineMat){this._lineMat.handleByPrerender=!0;let e=this.ExperienceBase.getManager("VCXPaperManager").UnitValueToPixel(this.Modifiable.GetPropertyValue("Collab.Border.Line.Width"));this.Modifiable.GetPropertyValue("Collab.Border.AlwaysVisible")?(this._lineMat.setLineWidth(e),this._lineMat.visible=!0):e>=1?(this._lineMat.setLineWidth(e),this._lineMat.visible=!0):this._lineMat.visible=!1}this._updateNodeBuffers(e,!0)}else this.setVisibility(!1)},update:function(){this._parent(),this.handleLayers()},_updateArrowMaterialsParameters:function(){if(this._Node)if(this._bodyMat&&(this._bodyMat.opacity=this._globalOpacity),this.GetPropertyGroupVisibility("Group.Border")){var e=this.Modifiable.getLineMaterialParams("Collab.Border.Line",this._lineMat,this._lastFrontLineType,this._globalOpacity);Object.keys(e).length>0&&("number"==typeof e.type&&e.type!==this._lastFrontLineType&&(this._lastFrontLineType=e.type),e.polygonBorderMode=!0,this._lineMat=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(e,this._lineMat)),(!this._NodeBorder.material||this._lineMat&&this._NodeBorder.material.id!==this._lineMat.id)&&this._NodeBorder.setMaterial(this._lineMat)}else this._lineMat.opacity=0,this._lineMat.setLineWidth(0)},_updateNodeBuffers:function(e,t){var r=this.Modifiable.GetObject().IsKindOf("VCXLinearArrow_Spec")||!0===this.Modifiable.GetPropertyValue("Collab.Is.Paper")||2===this.Modifiable.GetPropertyValue("Arrow.Circular.Flat");if((t&&r||!t&&!r)&&this._NodeBkGrnd&&this._NodeBorder){var o=this._NodeBkGrnd.getBuffer(i.VertexComponentEnum.POSITION),a=this._NodeBkGrnd.getBuffer(i.VertexComponentEnum.DIFFUSE_COLOR),n=this._NodeBorder.getBuffer(i.VertexComponentEnum.POSITION),s=this._NodeBorder.getBuffer(i.VertexComponentEnum.DIFFUSE_COLOR);if(void 0!==o&&void 0!==a&&void 0!==n&&void 0!==s){var l=this._ComputePosBuffer(e,o,a,n,s);this._NodeBkGrnd.updateBuffer(i.VertexComponentEnum.POSITION,0,l),this._NodeBkGrnd.updateBuffer(i.VertexComponentEnum.DIFFUSE_COLOR,0,l),this._NodeBkGrnd.computeBoundingElements(),this._NodeBorder.updateBuffer(i.VertexComponentEnum.POSITION,0,l),this._NodeBorder.updateBuffer(i.VertexComponentEnum.DIFFUSE_COLOR,0,l),this._NodeBorder.computeBoundingElements()}}},_updateNodePositionFromAnchor:function(e){if(this.GetAnchorWorldMatrix(1,null))console.log("This arrow has another anchor.. may be the one determining the position");else{var i=this.GetAnchorWorldMatrix(0,null);i||(console.warn("No matrix has been found for arrow's anchor.0 position..."),i=new t.Matrix4),e&&i.multiply(e),this.setMatrix(i)}},_fillColorBuffer:function(e,t){var i=0,r=0,o=this.GetColorPropertyValue("Arrow.Body"),a=this.GetColorPropertyValue("Arrow.Body.2"),n=o.GetRGBA(),s=a.GetRGBA(),l=this.GetColorPropertyValue("Collab.Border.Line"),p=this.GetColorPropertyValue("Collab.Border.Line.2"),u=l.GetRGBA(),h=p.GetRGBA(),d=0;for(r=this._verticesNb-2;3!==r;r=++r%this._verticesNb)for(i=4*r,d=0;d<4;i++,d++)e[i]=s[d],t[i]=h[d];for(r=3;r<this._step+2;++r){var c=a.Clone().Lerp(o,(r-2)/this._step),y=p.Clone().Lerp(l,(r-2)/this._step);e[(i=4*r)+0]=c.r,e[i+1]=c.g,e[i+2]=c.b,e[i+3]=c.a,t[i+0]=y.r,t[i+1]=y.g,t[i+2]=y.b,t[i+3]=y.a,e[(i=4*(this._verticesNb-r))+0]=c.r,e[i+1]=c.g,e[i+2]=c.b,e[i+3]=c.a,t[i+0]=y.r,t[i+1]=y.g,t[i+2]=y.b,t[i+3]=y.a}for(r=this._step+2;r<=this._step+6;++r)for(i=4*r,d=0;d<4;i++,d++)e[i]=n[d],t[i]=u[d]}})});__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXViewport_Spec",["require","exports","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXDressup_Spec"],function(e,t,i,r){"use strict";r=__importDefault(r);class o extends r.default{constructor(){super(),this.IsViewPointDependent=!0,this.IsAnchorDependent=!1,this._hdrUrl=null}Build(){return this._experienceBase.getManager("VCXVisuManager").setActiveViewport(this),this}getActiveAmbienceID(){var e=this.QueryInterface("VCXIModifiable");if(e){var t=e.GetPropertyValue("Viewport.ActiveAmbience");if(t&&t.length)return t}return null}setLightingMode(e,t,r,a){var n=this.GetObject()._experienceBase.getManager("VCXContextManager");n.getMainViewer().planeV2=e;var s=!1,l=16777215,p=1,u=null,h=!1,d=16777215,c=1,y=null,C=!1,m=1,f=null;switch(t){case o.ERenderLightingMode.Custom:case o.ERenderLightingMode.Soft:s=!0,p=.8*r,u=new i.Vector3(0,0,1);break;case o.ERenderLightingMode.Medium:var V=.5;s=!0,p=.8*r,u=new i.Vector3(V,V,1),h=!0,c=.8*r,y=new i.Vector3(-V,-V,-1);break;case o.ERenderLightingMode.Metal:V=.7;s=!0,p=r,u=new i.Vector3(V,V,1),h=!0,c=.6*r,y=new i.Vector3(-V,-V,1),C=!0,m=.5*r,f=new i.Vector3(-1,1,-.5);break;case o.ERenderLightingMode.HeavyMetal:V=.7;s=!0,l=15461375,p=.8*r,u=new i.Vector3(2*V,V,1),h=!0,d=15268095,c=.8*r,y=new i.Vector3(-V,-2*V,1),C=!0,m=.5*r,f=new i.Vector3(-1,1,-.5);break;case o.ERenderLightingMode.HighContrast:V=-.7;s=!0,l=16772075,p=.9*r,u=new i.Vector3(2*V,V,1),h=!0,d=15268095,c=.9*r,y=new i.Vector3(-V,-2*V,1),C=!0,m=.5*r,f=new i.Vector3(1,-1,-1);break;case o.ERenderLightingMode.ShadedIllustration:V=.2;s=!0,l=13158455,p=.9*r,u=new i.Vector3(V,0,1),h=!0,d=3618760,c=.9*r,y=new i.Vector3(-V,0,1);break;case o.ERenderLightingMode.Archi:s=!0,p=1,u=new i.Vector3(-1,1,1);break;case o.ERenderLightingMode.DefaultComposer:s=!0,u=new i.Vector3(-.25,.25,.5),h=!0,c=.6,y=new i.Vector3(.25,-.75,0)}e||(p=0,c=0,m=0),n.applyToViewers(function(t){t.setVisuAppearanceMode(e?i.DefaultAppearanceMode.BASIC:i.DefaultAppearanceMode.GASLOOK),s&&u?t.setLightParameters({isPhysical:!1,lightIndex:0,intensity:p,color:l,direction:u.normalize(),directionType:"camera"}):t.setLightParameters({lightIndex:0,intensity:0,color:0,direction:new i.Vector3(0,0,1),directionType:"camera"}),h&&y?t.setLightParameters({isPhysical:!1,lightIndex:1,intensity:c,color:d,direction:y.normalize(),directionType:"camera"}):t.setLightParameters({lightIndex:1,intensity:0,color:0,direction:new i.Vector3(0,0,1),directionType:"camera"}),C&&f?t.setLightParameters({isPhysical:!1,lightIndex:2,intensity:m,color:16777215,direction:f.normalize(),directionType:"camera"}):t.setLightParameters({lightIndex:2,intensity:0,color:0,direction:new i.Vector3(0,0,1),directionType:"camera"})})}setLightingModeForComposerPlayer(e,t,r,a){var n=this.GetObject()._experienceBase.getManager("VCXContextManager");n.getMainViewer().planeV2=e;var s=!1,l=16777215,p=1,u=null,h=!1,d=16777215,c=1,y=null,C=!1,m=1,f=null,V=null,b=null,P=null;switch(t){case o.ERenderLightingMode.Custom:case o.ERenderLightingMode.Soft:s=!0,p=.8*r,u=new i.Vector3(0,0,1),V=0;break;case o.ERenderLightingMode.Medium:var g=.5;s=!0,p=.8*r,u=new i.Vector3(g,g,1),h=!0,c=.8*r,y=new i.Vector3(-g,-g,-1),V=3355469,b=3355469;break;case o.ERenderLightingMode.Metal:g=.7;s=!0,p=r,u=new i.Vector3(g,g,1),h=!0,c=.6*r,y=new i.Vector3(-g,-g,1),C=!0,m=.5*r,f=new i.Vector3(-1,1,-.5),V=3355443,b=0,P=0;break;case o.ERenderLightingMode.HeavyMetal:g=.7;s=!0,l=15461375,p=.8*r,u=new i.Vector3(2*g,g,1),h=!0,d=15268095,c=.8*r,y=new i.Vector3(-g,-2*g,1),C=!0,m=.5*r,f=new i.Vector3(-1,1,-.5),V=3355443,b=0,P=0;break;case o.ERenderLightingMode.HighContrast:g=-.7;s=!0,l=16772075,p=.9*r,u=new i.Vector3(2*g,g,1),h=!0,d=15268095,c=.9*r,y=new i.Vector3(-g,-2*g,1),C=!0,m=.5*r,f=new i.Vector3(1,-1,-1),V=3355443,b=0,P=0;break;case o.ERenderLightingMode.ShadedIllustration:g=.2;s=!0,l=13158455,p=.9*r,u=new i.Vector3(g,0,1),h=!0,d=3618760,c=.9*r,y=new i.Vector3(-g,0,1),V=this.rgbToHex(1*p,1*p,0*p),b=this.rgbToHex(0*c,0*c,1*c);break;case o.ERenderLightingMode.Archi:s=!0,p=1,u=new i.Vector3(-1,1,1),V=0;break;case o.ERenderLightingMode.DefaultComposer:s=!0,u=new i.Vector3(-.25,.25,.5),h=!0,c=.25,y=new i.Vector3(.25,-.75,0),V=0,b=0}e||(p=0,c=0,m=0),n.applyToViewers(function(t){t.setVisuAppearanceMode(e?i.DefaultAppearanceMode.BASIC:i.DefaultAppearanceMode.GASLOOK),s&&u?(null!==V&&t.setAmbientLight(V),t.setLightParameters({isPhysical:!1,lightIndex:0,intensity:p,color:l,direction:u.normalize(),directionType:"camera"})):t.setLightParameters({lightIndex:0,intensity:0,color:0,direction:new i.Vector3(0,0,1),directionType:"camera"}),h&&y?(null!==b&&t.setAmbientLight(b),t.setLightParameters({isPhysical:!1,lightIndex:1,intensity:c,color:d,direction:y.normalize(),directionType:"camera"})):t.setLightParameters({lightIndex:1,intensity:0,color:0,direction:new i.Vector3(0,0,1),directionType:"camera"}),C&&f?(null!==P&&t.setAmbientLight(P),t.setLightParameters({isPhysical:!1,lightIndex:2,intensity:m,color:16777215,direction:f.normalize(),directionType:"camera"})):t.setLightParameters({lightIndex:2,intensity:0,color:0,direction:new i.Vector3(0,0,1),directionType:"camera"})})}rgbToHex(e,t,i){e=Math.round(255*e),t=Math.round(255*t),i=Math.round(255*i);let r=e.toString(16),o=t.toString(16),a=i.toString(16);return 1==r.length&&(r="0"+e),1==o.length&&(o="0"+t),1==a.length&&(a="0"+i),parseInt("0x"+r+o+a)}}return function(e){let t,i,r,o,a,n;!function(e){e[e.Portrait=0]="Portrait",e[e.Landscape=1]="Landscape"}(t=e.EPaperOrientation||(e.EPaperOrientation={})),function(e){e[e["X+"]=0]="X+",e[e["Y+"]=1]="Y+",e[e["Z+"]=2]="Z+",e[e["X-"]=3]="X-",e[e["Y-"]=4]="Y-",e[e["Z-"]=5]="Z-"}(i=e.EVertical||(e.EVertical={})),function(e){e[e.NoAA=0]="NoAA",e[e.SMAA=1]="SMAA",e[e.FXAA=3]="FXAA",e[e.FSAA=4]="FSAA",e[e.SSAA=6]="SSAA",e[e.TAA=8]="TAA"}(r=e.EAA||(e.EAA={})),function(e){e[e.NoSSAO=1]="NoSSAO",e[e.OnIdle=2]="OnIdle",e[e.Always=3]="Always"}(o=e.ESSAO||(e.ESSAO={})),function(e){e[e.None=0]="None",e[e.exterior_parking=1]="exterior_parking",e[e.arches_pinetree=2]="arches_pinetree",e[e.barcelona_rooftop=3]="barcelona_rooftop",e[e.exterior_plaza_4=4]="exterior_plaza_4",e[e.exterior_scenic_5=5]="exterior_scenic_5",e[e.exterior_sky=6]="exterior_sky",e[e.interior_apartment_1=7]="interior_apartment_1",e[e.studio_panel_3=8]="studio_panel_3",e[e.studio_spot_1=9]="studio_spot_1",e[e.studio_spot_2=10]="studio_spot_2",e[e.PLM=100]="PLM"}(a=e.EEnvironment||(e.EEnvironment={})),function(e){e[e.Custom=0]="Custom",e[e.Soft=1]="Soft",e[e.Medium=2]="Medium",e[e.Metal=3]="Metal",e[e.HeavyMetal=4]="HeavyMetal",e[e.HighContrast=5]="HighContrast",e[e.ShadedIllustration=6]="ShadedIllustration",e[e.Archi=7]="Archi",e[e.DefaultComposer=8]="DefaultComposer"}(n=e.ERenderLightingMode||(e.ERenderLightingMode={}))}(o||(o={})),o.prototype.getDefaultName=function(){return"Viewport"},Object.defineProperty(o.prototype,"componentType",{enumerable:!0,get:function(){return"VCXViewport_Spec"}}),o.prototype.dressupGroupName="Environment",Object.defineProperty(o.prototype,"renderMode",{enumerable:!0,set:function(e){this._renderMode=e},get:function(){return this._renderMode}}),Object.defineProperty(o.prototype,"outlineType",{enumerable:!0,set:function(e){this._outlineType=e},get:function(){return this._outlineType}}),o}),define("DS/VCXWebDressup/VCXAnchorServices",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebVisu/VCXModifiablesAccess","DS/VCXWebDressup/VCXMarkup_Spec"],function(e,t,i,r,o,a,n,s,l,p,u){"use strict";var h=e.extend({init:function(){}});return h.GetNewPropertyAnchorFromMatrix=function(e,t,i){var r="Actor.Anchor."+t,o=e.QueryInterface("VCXIModifiable").GetProperty(r).Clone(),a=o.GetPropertyValue(),n=a.GetValueLink(),s=e._experienceBase.ComponentsMap.GetComponentFromLink(n);s||(s=e.getWorkingRootComponent());var l=s.QueryInterface("W3AISGNodeHolder").getMatrixInLCS(e._experienceBase.getManager("VCXContextManager").getMainViewer(),i),p=o.GetPropertyValue().GetValueFrame();return p.Value=l,a.SetValueFrame(p),o.SetPropertyValue(a),o},h.GetNewPropertyValueAnchor=function(e,i){var r=new n,o=new s(e||new t.Matrix4);return r.SetValueFrame(o),r.SetValueLinkFromComponent(i),r},h.GetNewPropertyValueAnchorFromPickinfo=function(e){return h.GetNewPropertyValueAnchor(e&&e.localMatrix,e&&e.modifiable&&e.modifiable.GetObject())},h.GetComponentToAttachTo=function(e,t){if(e){var i=null;if(t){var r=p.BuildCleanedPathElement(t),o=e._experienceBase.ComponentsMap.GetComponentFromPathElement(r);o&&(i=o)}return i||(i=e.getWorkingRootComponent()),i}},h.BuildNewPropertyValueAnchor=function(e,i,r){if(e instanceof t.Matrix4){var o=this.GetComponentToAttachTo(i,r);if(o){var a=o.QueryInterface("W3AISGNodeHolder").getMatrixInLCS(i._experienceBase.getManager("VCXContextManager").getMainViewer(),e),l=new n,p=new s;return l.SetValueFrame(p),p.Value=a,r?l.SetValueLinkFromComponent(o):l.SetValueLinkFromComponent(null),l}console.warn("Creation of Anchor Property Value aborted: No object has been found to link the anchor.")}else console.warn("BuildNewPropertyValueAnchor Usage: BuildNewPropertyValueAnchor(iAnchorFrameInWorld <THREE.Matrix4>, iAnchorHolderComponent <VCXComponentOccurrence>, iPathObjectToLink <WebVizu.PathElement>) !")},h.getWorldMatrix=function(e,r,o){if(!e)return null;var a=e.GetValueFrame().Value,n=r._experienceBase.ComponentsMap.GetComponentFromLink(e.GetValueLink());if(n||(n=r.getWorkingRootComponent()),!n)return a;var s=n.QueryInterface("W3AISGNodeHolder"),l=u.EPositionType.Free3D,p=n.QueryInterface("VCXIModifiable");if(p){var h=p.GetProperty("Collab.3D.Paper.Positioning.Type");h&&(l=h.GetPropertyValue().Value)}if(!(e.is2DAnchor&&s&&s.getSGNode()&&s.getSGNode().GetShapeInfo&&o&&l===u.EPositionType.Free2D))return s&&l===u.EPositionType.Free3D?s.getPathElement()?s.getMatrixInWCS(n._experienceBase.getManager("VCXContextManager").getMainViewer(),a):null:a;if(r){var d=s.getSGNode().GetShapeInfo();if(d){var c=i.getOFromMatrix(a),y=r._experienceBase.getManager("VCXPaperManager");if(y){var C=y.ModelToMM2(o,i.getOFromMatrix(d.smartNode.getMatrix(o))),m=new t.Vector3(d.smartNode.Position2D.x+d.size.x*c.x,d.smartNode.Position2D.y+d.size.y*c.y,.9999*C.z),f=y.MMToModel2(o,m);return(new t.Matrix4).setPosition(f)}}}},h.requestNewAnchor=function(e,t,i,n){var s=e.GetPropertyValue("Collab.ListAnchorsIDs").slice(0),p=null,u="Actor.Anchor."+(p="number"==typeof i||"string"==typeof i?i:e.getNewAnchorID()),d=h.GetNewPropertyValueAnchorFromPickinfo(t);s.push(p);var c=new l(s),y=new a(u,0),C=new a("Collab.ListAnchorsIDs",0);return n||(n=new o),n.AddOrModifyProperty(new r(y,d)),n.AddOrModifyProperty(new r(C,c)),{anchorPropName:u,propertySet:n,anchorID:p}},h.deleteAnchor=function(e,t,i){var n=e.GetPropertyValue("Collab.ListAnchorsIDs").slice(0),s=null;if("number"!=typeof t&&"string"!=typeof t)return;s=t;const p=n.indexOf(s);if(p){n.splice(p,1);var u=new l(n),h=new a("Collab.ListAnchorsIDs",0);return i||(i=new o),i.AddOrModifyProperty(new r(h,u)),{propertySet:i}}},h}),define("DS/VCXWebDressup/VCXAViewpointController",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/Visualization/Viewpoint","DS/VCXWebTracks/VCXInterpolator","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebTracks/VCXInterpolatorLinear","DS/VCXWebTracks/VCXInterpolatorCubic","DS/VCXWebTracks/VCXInterpolatorSpherical","DS/VCXWebSystem/VCXMathTools","DS/VCXWebKernelCommands/VCXCmdChangePropertiesWithAnimation","DS/VCXWebProperties/VCXProperty","DS/VCXWebDressup/VCXAnchorServices"],function(e,t,i,r,o,a,n,s,l,p,u,h){"use strict";return e.extend({init:function(){this._parent()},GetInterpolator:function(e){if("Camera.Position"===e){if(this.shouldUseSphericalInterpolator()){var t=new s;return t.setPositionPropertyName("Actor.Anchor.1"),t.setTargetPropertyName("Actor.Anchor.2"),t.setHeightPropertyName("Camera.Height"),t.setAnglePropertyName("Camera.Angle"),t.setOrthoPropertyName("Camera.Ortho"),t}return null}if("Actor.Anchor.1"===e||"Actor.Anchor.2"===e){var i=this.GetObject()._experienceBase.getManager("VCXVisuManager"),o=this.QueryInterface("VCXIModifiable");return"Actor.Anchor.1"===e&&(i.isInTransitionMode()||o.GetPropertyValue("Camera.Arcball")&&o.GetPropertyValue("Actor.Interpolation.Type")===r.EInterpolationType.Linear)?new a:o.GetPropertyValue("Actor.Interpolation.Type")===r.EInterpolationType.Linear?new a:new n}return null},toViewpoint:function(){if(this.GetObject()._experienceBase.getManager("VCXVisuManager").getUpdateViewport()){var e=this.GetObject()._experienceBase.getManager("VCXContextManager"),r=this.QueryInterface("VCXIModifiable");if(e&&r){var o=e.getMainViewer().currentViewpoint;if(o){this.__translation||(this.__translation=new t.Vector3),this.__quaternion||(this.__quaternion=new t.Quaternion);var a=this.getMatrixAndDOI();a.matrix.decompose(this.__translation,this.__quaternion,void 0),o.moveTo({eyePosition:this.__translation,orientation:this.__quaternion,distanceToTarget:a.doi});var n=o.camera.pixelCulling;o.setProjectionType(r.GetPropertyValue("Camera.Ortho")?i.ORTHOGRAPHIC:i.PERSPECTIVE),o.setPixelCulling(n);var s=45;r.GetPropertyValue("Camera.Ortho")?a.doi&&(s=360*Math.atan(.5*r.GetPropertyValue("Camera.Height")/a.doi)/Math.PI):r.GetPropertyValue("Camera.Angle")>0&&(s=r.GetPropertyValue("Camera.Angle")),s=Math.max(.001,Math.min(s,179)),o.setAngle(s);var p=this.GetObject()._experienceBase.getManager("VCXIVManager");if(p&&p.scenario){var u=new t.Vector3(0,0,1),h=(new t.Vector3).crossVectors(u,o.getSightDirection()),d=(new t.Vector3).crossVectors(u,h),c=l.getMatrixFromOVxVy(new t.Vector3,h,d),y=e.getRootNode().getMatrix().clone().multiply(p.scenario.getInverseTranslationToCenterModelOnTable()),C=(new t.Matrix4).getInverse(y,!1);c.multiply(C),p.scenario.setTurnTableBasis(c)}}}}},fromViewpoint:function(e){var r=this.GetObject()._experienceBase.getManager("VCXContextManager"),a=this.QueryInterface("VCXIModifiable");if(r&&a){var n=r.getMainViewer().currentViewpoint;if(n){var s=n.getEyePosition(),l=n.getTarget(),p=n.getSightDirection();p.negate();var u,h=n.getUpDirection(),d=(new t.Vector3).crossVectors(h,p),c=(new t.Matrix4).makeBasis(d,h,p).setPosition(s),y=a.GetProperty("Actor.Anchor.1"),C=this.GetObject()._experienceBase.ComponentsMap.GetComponentFromLink(y.GetPropertyValue().GetValueLink());C||(C=this.GetObject().getWorkingRootComponent()),C&&(u=C.QueryInterface("W3AISGNodeHolder").getWorldMatrix(r.getMainViewer())),u||(u=new t.Matrix4);var m=(new t.Matrix4).getInverse(u),f=(new t.Matrix4).multiplyMatrices(m,c),V=a.GetProperty("Camera.Position"),b=new o(f);V.SetPropertyValue(b),e?e.AddOrModifyProperty(V):a.OnChangeProperty("Camera.Position",b),(b=(V=a.GetProperty("Actor.Anchor.1")).GetPropertyValue()).SetValueFrame(new o(f)),V.SetPropertyValue(b),e?e.AddOrModifyProperty(V):a.OnChangeProperty("Actor.Anchor.1",b);var P=(new t.Matrix4).makeBasis(d,h,p).setPosition(l),g=(new t.Matrix4).multiplyMatrices(m,P);(b=(V=a.GetProperty("Actor.Anchor.2")).GetPropertyValue()).SetValueFrame(new o(g)),V.SetPropertyValue(b),e?e.AddOrModifyProperty(V):a.OnChangeProperty("Actor.Anchor.2",b),(b=(V=a.GetProperty("Camera.Ortho")).GetPropertyValue()).SetValue(n.getProjectionType()===i.ORTHOGRAPHIC),V.SetPropertyValue(b),e?e.AddOrModifyProperty(V):a.OnChangeProperty("Camera.Ortho",b);var _=n.getAngle();(b=(V=a.GetProperty("Camera.Angle")).GetPropertyValue()).SetValue(_),V.SetPropertyValue(b),e?e.AddOrModifyProperty(V):a.OnChangeProperty("Camera.Angle",b),_/=360/Math.PI;var S=Math.tan(_)*n.getTargetDistance();S*=2,(b=(V=a.GetProperty("Camera.Height")).GetPropertyValue()).SetValue(S),V.SetPropertyValue(b),e?e.AddOrModifyProperty(V):a.OnChangeProperty("Camera.Height",b)}}},resetMatrixAndDOI:function(){this._matrixAndDOI=null},shouldUseSphericalInterpolator:function(){var e=this.QueryInterface("VCXIModifiable");return this.GetObject()._experienceBase.getManager("VCXVisuManager").isInTransitionMode()||
/*!cameraModifiable.GetPropertyValue("Camera.Ortho") && */e.GetPropertyValue("Camera.Arcball")&&e.GetPropertyValue("Actor.Interpolation.Type")===r.EInterpolationType.Linear},getMatrixAndDOI:function(){if(this._matrixAndDOI)return this._matrixAndDOI;var e=this.QueryInterface("VCXIModifiable");if(e){var i,r=this.shouldUseSphericalInterpolator();if(r){var o=this.GetObject()._experienceBase.getManager("VCXContextManager"),a=e.GetProperty("Actor.Anchor.1"),n=this.GetObject()._experienceBase.ComponentsMap.GetComponentFromLink(a.GetPropertyValue().GetValueLink());if(n||(n=this.GetObject().getWorkingRootComponent()),n){var s=n.QueryInterface("W3AISGNodeHolder").getWorldMatrix(o.getMainViewer());s||(s=new t.Matrix4),i=s.multiply(e.GetPropertyValue("Camera.Position"))}else i=e.GetPropertyValue("Camera.Position")}else i=e.GetAnchorWorldMatrix(1,null);var p=e.GetAnchorWorldMatrix(2,null),u=(new t.Vector3).getPositionFromMatrix(p),h=(new t.Vector3).getPositionFromMatrix(i);if(e.GetPropertyValue("Camera.Ortho")){var d=e.GetPropertyValue("Camera.Height");h=new t.Vector3(0,0,d).applyMatrix4(p),i.setPosition(h)}if(!r){if(!e.GetPropertyValue("Camera.Pitch")&&!e.GetPropertyValue("Camera.Yaw")&&e.GetPropertyValue("Camera.LockDistCOI")){var c=new t.Vector3,y=new t.Vector3,C=new t.Vector3;i.extractBasis(c,y,C),i.setPosition((new t.Vector3).addVectors(u,C.multiplyScalar(Math.abs(e.GetPropertyValue("Camera.DistCOI")))))}if(!e.GetPropertyValue("Camera.Pitch")){var m=(new t.Matrix3).copy(i),f=(new t.Matrix3).getInverse(i);h=(new t.Vector3).getPositionFromMatrix(i);(V=(new t.Vector3).subVectors(u,h)).applyMatrix3(f),V.y=0,V.applyMatrix3(m),i.setPosition((new t.Vector3).subVectors(u,V))}if(!e.GetPropertyValue("Camera.Yaw")){var V;m=(new t.Matrix3).copy(i),f=(new t.Matrix3).getInverse(i),h=(new t.Vector3).getPositionFromMatrix(i);(V=(new t.Vector3).subVectors(u,h)).applyMatrix3(f),V.x=0,V.applyMatrix3(m),i.setPosition((new t.Vector3).subVectors(u,V))}h=(new t.Vector3).getPositionFromMatrix(i);if(e.GetPropertyValue("Camera.Roll")){c=new t.Vector3,y=new t.Vector3,C=new t.Vector3;if(i.extractBasis(c,y,C),(S=(new t.Vector3).subVectors(h,u)).length()){S.normalize();var b=(new t.Vector3).crossVectors(y,S).normalize(),P=(new t.Vector3).crossVectors(S,b).normalize(),g=(new t.Vector3).crossVectors(b,P).normalize(),_=(new t.Vector3).crossVectors(g,b);i.makeBasis(b,_,g).setPosition(h)}}else{var S=(new t.Vector3).subVectors(h,u);b=(new t.Vector3).crossVectors(new t.Vector3(0,0,1),S),P=new t.Vector3;0===b.length()?(b=new t.Vector3(1,0,0),P=new t.Vector3(0,1,0)):P.crossVectors(S,b);g=(new t.Vector3).crossVectors(b,P).normalize();b.normalize();_=(new t.Vector3).crossVectors(g,b);i.makeBasis(b,_,g),i.setPosition(h)}if(e.GetPropertyValue("Camera.LockDistCOI")){c=new t.Vector3,y=new t.Vector3,C=new t.Vector3;i.extractBasis(c,y,C),i.setPosition((new t.Vector3).addVectors(u,C.multiplyScalar(Math.abs(e.GetPropertyValue("Camera.DistCOI")))))}}h.getPositionFromMatrix(i);var M=h.distanceTo(u),G=l.getVzFromMatrix(i),D=(new t.Vector3).crossVectors(new t.Vector3(0,0,1),G),x=l.getVxFromMatrix(i),v=D.angleTo(x);D.cross(x).dot(G)<=0&&(v=-v);var A=45;d=100;if(e.GetPropertyValue("Camera.Ortho"))M&&(d=e.GetPropertyValue("Camera.Height"),A=360*Math.atan(.5*e.GetPropertyValue("Camera.Height")/M)/Math.PI);else A=e.GetPropertyValue("Camera.Angle"),d=Math.tan(.5*A*Math.PI/180)*M*2;return A=Math.max(.001,Math.min(A,179)),e._matrixAndDOI={matrix:i,target:u,doi:M,angle:A,height:d,roll:v},e._matrixAndDOI}},alignToObject:function(e){var i=this.GetObject()._experienceBase,r=i.getManager("VCXContextManager").getMainViewer(),o=e.QueryInterface("W3AISGNodeHolder");if(o){var a=this.QueryInterface("VCXIModifiable");if(a){var n=o.getWorldMatrix(r).multiply((new t.Matrix4).makeRotationY(Math.PI)),s=i.ComponentsMap.GetComponentFromLink(a.GetProperty("Actor.Anchor.2").GetPropertyValue().GetValueLink());s||(s=this.GetObject().getWorkingRootComponent());var d=s.QueryInterface("W3AISGNodeHolder");if(d){var c=h.GetNewPropertyValueAnchor(d.getMatrixInLCS(r,n),s),y=.5*a.GetPropertyValue("Camera.Angle"),C=o.getPathElement().getBoundingSphere(r).radius/Math.tan(y);n.setPosition(o.getPathElement().getBoundingSphere(r).center);var m=l.getOFromMatrix(n).add(l.getVzFromMatrix(n).normalize().multiplyScalar(C)),f=n.clone().setPosition(m),V=i.ComponentsMap.GetComponentFromLink(a.GetProperty("Actor.Anchor.1").GetPropertyValue().GetValueLink());V||(V=this.GetObject().getWorkingRootComponent());var b=V.QueryInterface("W3AISGNodeHolder");if(b){var P=h.GetNewPropertyValueAnchor(b.getMatrixInLCS(r,f),V),g=new p(i.getManager("VCXScenarioManager"),i.ComponentsMap,i.getManager("VCXCommandManager"));g.SetTransitionTime(1e3);var _=new u(a.GetProperty("Actor.Anchor.1").GetPropertyInfo(),P);g.ChangeProperty(a,_);_=new u(a.GetProperty("Actor.Anchor.2").GetPropertyInfo(),c);g.ChangeProperty(a,_),i.getManager("VCXCommandManager").Push(g)}}}}}})}),define("DS/VCXWebDressup/VCXDressupModifiable",["DS/VCXWebExperienceBase/VCXModifiableOccurrenceExperience","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXAnchorServices","DS/VCXWebVisu/VCXModifiablesAccess","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebTracks/VCXInterpolator","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyGroup","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyInfoEnum","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueLocation","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueVector","DS/Visualization/ThreeJS_DS","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup"],function(e,t,i,r,o,a,n,s,l,p,u,h,d,c,y,C,m,f,V,b){"use strict";var P=e.extend({init:function(){this._parent(),this._Properties=[],this._PropertiesFormatPainter=[],this._PropertyGroups=[],this._Anchors={}},Build:function(){this._parent();var e=[{Name:"Actor.Color",Type:c,i18n:V,visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Actor.Color.Defined",Type:h,DefaultValue:!0,i18n:V,visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Actor.Position",Type:y,DefaultValue:(new y).GetValue(),i18n:V,visibleInPropertyGroups:!1},{Name:"Collab.HideIfOutsideAnchorFrustrum",Type:h,DefaultValue:!1},{Name:"Actor.Interpolation.Type",Type:C,DefaultValue:a.EInterpolationType.Linear,i18n:V,MapChoice:this._generateMapChoiceFromEnumAndId(a.EInterpolationType,"Interpolation",["Custom","Smooth"]),visibleInPropertyGroups:!1},{Name:"Actor.IsAlwaysOnTop",Type:h,DefaultValue:!0}];this._BuildPropertyValues(e)},_BuildPropertyValues:function(e){for(var t=this.QueryInterface("VCXIModifiableView"),i=t&&t.getGroupPropertiesOrders(),r=0;r<e.length;++r){var o=e[r].Name,a=this._Properties[o],n=null,h=null;if(a&&(n=a.GetPropertyInfo(),h=a.GetPropertyValue()),!n){var d=0;void 0!==e[r].BehaviorType&&(d=e[r].BehaviorType);let t=b;void 0!==e[r].i18n&&(t=e[r].i18n);var c=!0;void 0!==e[r].Persistent&&(c=e[r].Persistent),e[r].ControlsGroupAvailability?(n=new u(o,d=2,c,t)).SetMapChoiceEnum(this._generateMapChoiceFromEnumAndId(P.EAvailability,"Group.Availability")):void 0!==e[r].MapChoice?(n=new u(o,d,c,t),void 0!==e[r].MapChoice&&n.SetMapChoiceEnum(e[r].MapChoice)):n=new p(o,d,c,t)}void 0!==e[r].Bounds&&n.SetBounds(e[r].Bounds.Min,e[r].Bounds.Max,e[r].Bounds.Step),e[r].UnitType&&n.SetUnitType(e[r].UnitType),e[r].GroupId?n.SetGroupId(e[r].GroupId):n.GetGroupId()?e[r].GroupId=n.GetGroupId():(e[r].GroupId="Group.Essentials",n.SetGroupId(e[r].GroupId));var y=e[r].GroupId;this._PropertyGroups[y]||(this._PropertyGroups[y]=new s({groupID:y})),this._PropertyGroups[y].i18nGroup||("Group.Essentials"===y?this._PropertyGroups[y].i18nGroup=V:t&&(this._PropertyGroups[y].i18nGroup=t.getPropertyGroupsi18n()));var C=e[r].ControlsGroupAvailability||this._PropertyGroups[y].PropertyControlingGroupAvailability===o,m=e[r].ControlsGroupVisibility||this._PropertyGroups[y].PropertyControlingGroupVisibility===o;if(i&&i[y])this._PropertyGroups[y].setPropertiesOrder(i[y]);else{var f=this.ExperienceBase.getManager("VCXContextManager");f&&void 0!==f.getUrlVars().debug&&console.warn("PropertiesOrder missing for "+y+" !! (component "+this.GetObject().GetType()+")")}if(C){var g=e[r].DefaultValue;void 0!==g&&(g===P.EAvailability.AppForceAvailable?this._PropertyGroups[y].availability=!0:g===P.EAvailability.AppForceNotAvailable?this._PropertyGroups[y].availability=!1:this._PropertyGroups[y].availability=void 0),this._PropertyGroups[y].PropertyControlingGroupAvailability=o}if(m){var _=e[r].DefaultValue;void 0!==_&&(this._PropertyGroups[y].visibility=_),this._PropertyGroups[y].PropertyControlingGroupVisibility=o,n.SetControlsGroupVisibility(!0)}var S={propertyName:o,i18n:n.Geti18n()};e[r].hiddenFields&&(S.hiddenFields=e[r].hiddenFields);for(var M=Object.keys(this._PropertyGroups),G=0;G<M.length;G++){var D=M[G],x=this._PropertyGroups[D];x.isIn(o)&&(this._PropertyGroups[y].addPropertyFromPropertyGroup(x,o),x.removeProperty(o))}this._PropertyGroups[y].addProperty(S),"boolean"==typeof e[r].visibleInPropertyGroups&&this._PropertyGroups[y].setVisible(o,e[r].visibleInPropertyGroups),!h&&e[r].Type&&(h=new e[r].Type),h?(h&&void 0!==e[r].DefaultValue&&h.SetValue(e[r].DefaultValue),a||(this._Properties[o]=new l(n,h)),void 0!==e[r].DefaultValue&&this.OnChangeProperty(o,h),!a&&e[r].FormatPainter&&this._PropertiesFormatPainter.push(o)):console.warn("No propertyValue found for "+o+".")}this._PropertiesFormatPainter&&this._PropertiesFormatPainter.length&&(this._PropertiesFormatPainter.indexOf("Actor.Hyperlink")<0&&this._PropertiesFormatPainter.push("Actor.Hyperlink"),this._PropertiesFormatPainter.indexOf("Actor.Opacity")<0&&this._PropertiesFormatPainter.push("Actor.Opacity")),this.SetPropertiesInfo(),t&&t.SetPropertiesViewInfo()},SetPropertiesInfo:function(){this.SetPropertyInvisible("Actor.Interpolation.Type",!0),this.SetPropertyInvisible("Actor.Color",!0),this.SetPropertyInvisible("Actor.Color.Defined",!0),this.SetPropertyInvisible("Actor.Opacity.Defined",!0),this.SetPropertyInvisible("Actor.Visibility.Opacity",!0),this.SetPropertyInvisible("Actor.Position",!0),this.SetPropertyInvisible("Collab.HideIfOutsideAnchorFrustrum",!0)},GetPropertyValue:function(e,t){var i;if(t?i=this.GetProperty(e):(i=this._Properties[e])||(i=this.GetProperty(e)),i&&i.GetPropertyValue())return i.GetPropertyValue().Value},GetNewProperty:function(e,t){var i=null;if(this._Properties[e]){var r=this._Properties[e].GetPropertyValue().Clone();r.SetValue(t),i=new l(this._Properties[e].GetPropertyInfo(),r)}return i},GetNewEnumProperty:function(e,t){if(this._Properties[e]){var i=this._Properties[e].GetPropertyInfo().GetMapChoiceEnum();let r=Object.entries(i).filter(e=>e[0]===t);if(r.length>0)return this.GetNewProperty(e,parseInt(r[0][1]));if((r=Object.entries(i).filter(e=>e[1]===t)).length>0)return this.GetNewProperty(e,parseInt(r[0][0]))}return null},GetAttachedOccurence:function(e){var t=this._Anchors&&this._Anchors[e],i=t&&t.GetValueLink().Value;if(i)return this.ExperienceBase.ComponentsMap.GetComponentFromID(i)},GetAttachedOccurences:function(){var e=[];return this.processAnchorsIDs(t=>{var i=this.GetAttachedOccurence(t);i&&e.push(i)}),e},GetComputedStringProperty:function(e,t){var i,o=this.GetProperty(e);if(o&&(i=o.GetPropertyValue().ToString())){var a="",n=this._Anchors[0];return n&&(a=n.GetValueLink().Value),r.ValuateLinkedProperties(i,this.ExperienceBase,a,this.GetObject().GetID(),t)}},getAnchorsCount:function(){var e=0,t=this.GetPropertyValue("Collab.ListAnchorsIDs");return t&&(e+=t.length),(t=this.GetPropertyValue("Collab.List2DAnchorsIDs"))&&(e+=t.length),e},getNewAnchorID:function(){for(var e=this.getAnchorsCount();this._Anchors[e];)++e;return e},GetAnchorValue:function(e){return this._Anchors[e]?this._Anchors[e].GetValueFrame().Value:null},GetAnchorWorldMatrix:function(e,t){var r=this._Anchors[e];return r?i.getWorldMatrix(r,this.GetObject(),t):null},GetFontPropertyValue:function(e){var t=this.GetProperty(e);if(t){var i=t.GetPropertyValue();if(i)return i.GetFont()}return null},GetColorPropertyValue:function(e){var t=this.GetPropertyValue(e+".Color"),i=this.GetPropertyValue(e+".Color.Opacity");void 0===i&&(i=this.GetPropertyValue(e+".Opacity"));var r=new n;return"object"==typeof t&&(r=t.Clone()),void 0===i&&(i=1),"number"==typeof i&&i>=0&&i<=1?r.a=i:console.warn("Opacity range [0.0,1.0]"),r},GetFramePropertyValue:function(e){var t=this.GetProperty(e);return t?t.GetPropertyValue().GetFrame().Value:null},_SetProperty:function(e,t){if(void 0===this._Properties[e]&&t){var i;if("Actor.Anchor."!==e.substring(0,13))return!1;(i=new p(e,0)).SetVisible(!1),i&&(this._Properties[e]=new l(i,t.Clone())),!0}var r=this._Properties[e];if(t){if(!t.IsEqualTo(r.GetPropertyValue()))if(void 0!==r.GetPropertyValue()&&void 0!==t){r.SetPropertyValue(t.Clone()),!0;var o=r.GetPropertyInfo().GetGroupId(),a=this._PropertyGroups[o];if(a&&e===a.PropertyControlingGroupVisibility&&(this._PropertyGroups[o].visibility=t.GetValue()),a&&e===a.PropertyControlingGroupAvailability){var n=t.GetValue();n===P.EAvailability.AppForceAvailable?this._PropertyGroups[o].availability=!0:n===P.EAvailability.AppForceNotAvailable?this._PropertyGroups[o].availability=!1:this._PropertyGroups[o].availability=void 0}}else console.warn("WTF !!!")}else!0,delete this._Properties[e];if("Actor.Anchor."===e.substring(0,13)){var s=e.substring(13,30);if(t){if(!t.IsEqualTo(this._Anchors[s])){!0;var u=null;this._Anchors[s]&&(u=this._Anchors[s].is2DAnchor),this._Anchors[s]=t.Clone(),null!==u&&(this._Anchors[s].is2DAnchor=u)}}else{!0,delete this._Anchors[s];var h=this.GetPropertyValue("Collab.ListAnchorsIDs"),d=h.indexOf(s);if(d>=0){h.splice(d,1);var c=new m(h);this.OnChangeProperty("Collab.ListAnchorsIDs",c)}}}if("Actor.Name"===e){var y=t.Value,C=this.QueryInterface("W3AISGNodeHolder");if(C){var f=C.giveSGNode();f&&f.setName(y)}}return!0},OnChangeProperty:function(e,t,i){if(i||(i={}),i.fromChildClass);else if(this.OnChangePropertyBegin(e,t))return!0;if("Collab.ListAnchorsIDs"!==e&&"Collab.List2DAnchorsIDs"!==e||(this._needToUpdateAnchors=!0),!this._SetProperty(e,t)){var r=!1;if(!r&&(i.fromChildClass=!0,r=this._parent(e,t,i))){var o=this.QueryInterface("W3AISGNodeHolder");o&&o.setSGNodeDirty(!0)}return r||console.warn("Unknown property on "+this.GetPropertyValue("Actor.Name")+" : "+e),r}return!0},OnChangePropertiesEnd:function(){this._needToUpdateAnchors&&(this.updateAnchorsType(),this._needToUpdateAnchors=!1),this._parent(),this.GetObject().setDirty&&this.GetObject().setDirty()},GetProperty:function(e){var t=null,i=this._Properties[e];if(i)t=new l(i.GetPropertyInfo(),i.GetPropertyValue().Clone());else{if(e.endsWith("._ComputedText")){var r=e.substring(0,e.length-"._ComputedText".length),o=this.GetComputedStringProperty(r),a=new d(o),n=new p(r,1,!1);t=new l(n,a)}t||(t=this._parent(e))}return t},GetProperties:function(e){this.SetPropertiesInfo();var t,i=this._parent(),r=this;for(t in this._Anchors&&Object.keys(this._Anchors).length>0&&this.processAnchorsIDs(function(e){i.AddOrModifyProperty(r.GetProperty("Actor.Anchor."+e))}),this._Properties)if(this._Properties.hasOwnProperty(t)){var o=!0,a=!0,n=this._Properties[t].GetPropertyInfo(),s=n.GetGroupId();if(s){var l=this._PropertyGroups[s];if(l){var p=l.PropertyControlingGroupAvailability&&t===l.PropertyControlingGroupAvailability,u=l.PropertyControlingGroupVisibility&&t===l.PropertyControlingGroupVisibility;!1!==l.availability||p||(o=!1),o&&(u?!0===l.availability&&(a=!1):!1===l.visibility&&(a=!1))}}n.IsVisible()!==(a&&!this._Properties[t].Invisible)&&n.SetVisible(a&&!this._Properties[t].Invisible),o&&i.AddOrModifyProperty(this.GetProperty(t))}return i},getPropertiesFormatPainter:function(){return this._PropertiesFormatPainter},getPropertiesToBePasted:function(e){let t=e.Clone();if(e&&e._map){var i=this.ExperienceBase.getManager("VCXExperience");for(let o in e._map)if(e._map.hasOwnProperty(o)){let a=e.GetProperty(o);if(a){if("Actor.Name"==o)(a=a.Clone()).GetPropertyValue().SetValue(a.GetPropertyValue().GetValue()+" - Copy ("+i._ccp_number+")");else if("Collab.3D.Paper.Paper.Position.X"==o)a.GetPropertyValue().SetValue(a.GetPropertyValue().GetValue()+5);else if("Collab.3D.Paper.Paper.Position.Y"==o)a.GetPropertyValue().SetValue(a.GetPropertyValue().GetValue()+5);else if("Collab.MagnetLine.Position.A.X"==o||"Collab.MagnetLine.Position.A.Y"==o||"Collab.MagnetLine.Position.B.X"==o||"Collab.MagnetLine.Position.B.Y"==o)a.GetPropertyValue().SetValue(a.GetPropertyValue().GetValue()+5);else if("Actor.Anchor.0"==o){var r=a.GetPropertyValue().GetValueFrame().GetValue();r.elements[12]+=10,r.elements[13]+=10}t.AddOrModifyProperty(a)}}return t}},getPropertyGroups:function(e){var t=this.QueryInterface("VCXIModifiableView");if(t)return t.getPropertyGroups(iGroupName)},GetPropertyGroupVisibility:function(e){var t=this.QueryInterface("VCXIModifiableView");return!t||t.GetPropertyGroupVisibility(e)},SetPropertyInvisible:function(e,t){var i=this.QueryInterface("VCXIModifiableView");i&&i.SetPropertyInvisible(e,t)},ChangeGroupAvailability:function(e,t){var i=this.QueryInterface("VCXIModifiableView");i&&i.ChangeGroupAvailability(e,t)},changeMapChoice:function(e,t){this._Properties[e]&&this._Properties[e].GetPropertyInfo().SetMapChoiceEnum(t)},Dispose:function(){},processAnchorsIDs:function(e,t){var i,r=[];t&&t.no3DAnchors||(i=this.GetPropertyValue("Collab.ListAnchorsIDs"))&&(r=r.concat(i));t&&t.no2DAnchors||(i=this.GetPropertyValue("Collab.List2DAnchorsIDs"))&&(r=r.concat(i));if(t&&t.sort&&r.sort(),Array.isArray(r)&&r.length>0)for(var o=0;o<r.length;++o){if(!1===e(r[o]))return}},updateAnchorsType:function(){var e=this.GetPropertyValue("Collab.ListAnchorsIDs");if(Array.isArray(e)&&e.length>0)for(var t=0;t<e.length;++t){var i=e[t];this._Anchors[i]?this._Anchors[i].is2DAnchor=!1:console.warn("Can't find refered anchor:"+i)}if(e=this.GetPropertyValue("Collab.List2DAnchorsIDs"),Array.isArray(e)&&e.length>0)for(t=0;t<e.length;++t){i=e[t];this._Anchors[i]?this._Anchors[i].is2DAnchor=!0:console.warn("Can't find refered anchor:"+i)}},getPositionOfFirstAnchor:function(){var e=this.GetPropertyValue("Collab.ListAnchorsIDs")[0],t=this.GetAnchorWorldMatrix(e);return(new f.Vector3).getPositionFromMatrix(t)},getPositionOfLastAnchor:function(){var e=this.GetPropertyValue("Collab.ListAnchorsIDs"),t=e[e.length-1],i=this.GetAnchorWorldMatrix(t);return(new f.Vector3).getPositionFromMatrix(i)},getLineMaterialParams:function(e,i,r,o){"number"!=typeof o&&(o=1);var a={},n=this.GetPropertyValue(e+".Type"),s=this.GetPropertyValue(e+".Width"),l=this.GetColorPropertyValue(e),p=l.GetThreeColor(),u=l.a,h=this.GetProperty(e+".2.Color");if(!i||r!==n)if(n===t.ELineType.UserDefined){var d=this.GetPropertyValue(e+".StipplingMotif");if(d){var c=d.split(" ");a.dashPattern=c.map(function(e){return 4*parseInt(e)})}}else a.type=n;if(i&&i.lineWidth===s&&(1!==i.lineWidth||i.visible)||(a.lineWidth=s),h)i&&i.vertexColors===f.VertexColors||(a.vertexColors=f.VertexColors),i&&i.opacity===o||(a.opacity=o);else{i&&i.color.equals(p)||(a.color=p);var y=u*o;i&&i.opacity===y||(a.opacity=y)}return a},GetOpacity:function(){var e=this.GetPropertyValue("Actor.Opacity");if((e*=this.GetPropertyValue("Actor.Visibility.Opacity"))>0){var t=this.QueryInterface("VCXIVisibility");t&&t.GetVisibility()===o.EVisState.Hidden&&(e=0)}return e}});return P.EAvailability={NoControl:0,AppForceAvailable:1,AppForceNotAvailable:2,AppNotVisible:3},Object.defineProperty(P.prototype,"ExperienceBase",{enumerable:!0,get:function(){return this.GetObject()._experienceBase}}),P}),define("DS/VCXWebDressup/VCXMagnetLineModifiable",["DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXDressup_Spec","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebProperties/VCXColor","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebDressup/VCXMarkup_Spec"],function(e,t,i,r,o,a,n,s,l,p,u,h,d,c,y,C,m,f){"use strict";return i.extend({init:function(){this._bIsMagnetLine=!0,this.arrayModifiableAttached=[],this.arrayModifiableRatioPos=[],this._parent()},Build:function(){this._parent();var e=[{Name:"Actor.Color",DefaultValue:(new n).FromRGBA(0,0,0,1),Type:h,visibleInPropertyGroups:!0,FormatPainter:!0},{Name:"Actor.Opacity",DefaultValue:1,visibleInPropertyGroups:!1},{Name:"MagnetLine.Length",Type:u,DefaultValue:0,GroupId:"Group.Position"},{Name:"MagnetLine.Rotation",Type:u,DefaultValue:0,Persistent:!1,GroupId:"Group.Position"},{Name:"MagnetLine.Magnetic",Type:l,DefaultValue:!0},{Name:"Collab.3D.Paper.Paper.Position.X",Type:u,DefaultValue:10,Persistent:!1},{Name:"Collab.3D.Paper.Paper.Position.Y",Type:u,DefaultValue:50,Persistent:!1},{Name:"Collab.MagnetLine.Position.A.X",Type:u,DefaultValue:0},{Name:"Collab.MagnetLine.Position.A.Y",Type:u,DefaultValue:-50},{Name:"Collab.MagnetLine.Position.B.X",Type:u,DefaultValue:0},{Name:"Collab.MagnetLine.Position.B.Y",Type:u,DefaultValue:50},{Name:"MagnetLine.Spacing",Type:d,DefaultValue:f.EMLSpacing.Uniform,MapChoice:this._generateMapChoiceFromEnumAndId(f.EMLSpacing,"MagnetLine.Spacing")}];this._BuildPropertyValues(e)},SetPropertiesInfo:function(){this.SetPropertyInvisible("Collab.MagnetLine.Position.A.X",!0),this.SetPropertyInvisible("Collab.MagnetLine.Position.A.Y",!0),this.SetPropertyInvisible("Collab.MagnetLine.Position.B.X",!0),this.SetPropertyInvisible("Collab.MagnetLine.Position.B.Y",!0),this.SetPropertyInvisible("Collab.3D.Paper.Paper.Position.X",!0),this.SetPropertyInvisible("Collab.3D.Paper.Paper.Position.Y",!0),this.SetPropertyInvisible("Actor.IsAlwaysOnTop",!0),this.SetPropertyInvisible("Collab.HideIfOutsideAnchorFrustrum",!0),this.SetPropertyInvisible("Collab.MagnetLine.Position.A.X",!0),this.SetPropertyInvisible("Actor.Hyperlink",!0)},GetProperty:function(e){if("MagnetLine.Rotation"===e){var t=this.GetProperty("Collab.MagnetLine.Position.A.X").GetPropertyValue().GetValue(),i=this.GetProperty("Collab.MagnetLine.Position.A.Y").GetPropertyValue().GetValue(),r=this.GetProperty("Collab.MagnetLine.Position.B.X").GetPropertyValue().GetValue(),o=this.GetProperty("Collab.MagnetLine.Position.B.Y").GetPropertyValue().GetValue(),a=new s.Vector2(t,i),n=new s.Vector2(r,o);const h=new s.Vector2(n.x-a.x,n.y-a.y),d=new s.Vector2(1,0);var l=d.x*h.x+d.y*h.y,p=Math.sqrt(d.x*d.x+d.y*d.y),u=Math.sqrt(h.x*h.x+h.y*h.y);const c=Math.acos(l/(p*u))*(180/Math.PI);return this.GetNewProperty(e,c)}if("MagnetLine.Length"===e){t=this.GetProperty("Collab.MagnetLine.Position.A.X").GetPropertyValue().GetValue(),i=this.GetProperty("Collab.MagnetLine.Position.A.Y").GetPropertyValue().GetValue(),r=this.GetProperty("Collab.MagnetLine.Position.B.X").GetPropertyValue().GetValue(),o=this.GetProperty("Collab.MagnetLine.Position.B.Y").GetPropertyValue().GetValue(),a=new s.Vector2(t,i),n=new s.Vector2(r,o);return this.GetNewProperty(e,a.distanceTo(n))}return this._parent(e)},OnChangeProperty:function(e,t,i){if("MagnetLine.Magnetic"==e)t.GetValue();else if("MagnetLine.Length"==e)this.updateAttachedPosition();else if("MagnetLine.Rotation"==e)this.updateAttachedPosition();else if("MagnetLine.Spacing"==e){if(t.GetValue()===f.EMLSpacing.Custom){this.arrayModifiableRatioPos.splice(0,this.arrayModifiableRatioPos.lenght),this.arrayModifiableRatioPos.lenght=0,this.arrayModifiableRatioPos=[];for(var r=0;r<this.arrayModifiableAttached.length;r++){var o=this.arrayModifiableAttached[r],a=this.getProportionalPosition(o);this.arrayModifiableRatioPos.push(a)}}else this.updateAttachedPosition()}this._parent(e,t,i)},RequestModification:function(e,t){var i=this.GetProperty("Collab.MagnetLine.Position.A.X").GetPropertyValue().GetValue(),r=this.GetProperty("Collab.MagnetLine.Position.A.Y").GetPropertyValue().GetValue(),o=this.GetProperty("Collab.MagnetLine.Position.B.X").GetPropertyValue().GetValue(),a=this.GetProperty("Collab.MagnetLine.Position.B.Y").GetPropertyValue().GetValue(),n=new s.Vector2(i,r),l=new s.Vector2(o,a),p=new s.Vector2(o-i,a-r);if("MagnetLine.Length"===e.GetPropertyInfo().GetPropertyName()){var u=e.GetPropertyValue().GetValue();p.normalize(),p.multiplyScalar(u);var h=n.x+p.x,d=n.y+p.y;return t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.MagnetLine.Position.B.X",h)),t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.MagnetLine.Position.B.Y",d)),t.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,t)}if("MagnetLine.Rotation"===e.GetPropertyInfo().GetPropertyName()){var c=(l.x+n.x)/2,y=(l.y+n.y)/2,C=new s.Vector2(c,y),m=n.distanceTo(l)/2;const i=e.GetPropertyValue().GetValue()*(Math.PI/180),r=new s.Vector2(1,0),o=r.x*Math.cos(i)-r.y*Math.sin(i),a=r.x*Math.sin(i)+r.y*Math.cos(i);var f=new s.Vector2(o,a);f.normalize();var V=new s.Vector2(f.x,f.y);f.multiplyScalar(m),V.multiplyScalar(-1*m);var b=new s.Vector2(C.x,C.y);b.add(f);var P=new s.Vector2(C.x,C.y);return P.add(V),t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.MagnetLine.Position.A.X",P.x)),t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.MagnetLine.Position.A.Y",P.y)),t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.MagnetLine.Position.B.X",b.x)),t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.MagnetLine.Position.B.Y",b.y)),t.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,t)}return this._parent(e,t)},isOnMagnetLine:function(e){return this._isPointOnSegment(e)},_isPointOnSegment:function(e){var t=this.GetProperty("Collab.MagnetLine.Position.A.X").GetPropertyValue().GetValue(),i=this.GetProperty("Collab.MagnetLine.Position.A.Y").GetPropertyValue().GetValue(),r=this.GetProperty("Collab.MagnetLine.Position.B.X").GetPropertyValue().GetValue(),o=this.GetProperty("Collab.MagnetLine.Position.B.Y").GetPropertyValue().GetValue(),a=new s.Vector2(t,i),n=new s.Vector2(r,o),l=(new s.Vector2).copy(n).sub(a),p=(new s.Vector2).copy(e).sub(a),u=l.dot(p),h=l.length(),d=p.length(),c=u/h;return c>=-1&&c<=h+1&&Math.abs(d-c)<=1},getProposalPositionIndexOnMagnetLine:function(e){var t=this.GetProperty("Collab.MagnetLine.Position.A.X").GetPropertyValue().GetValue(),i=this.GetProperty("Collab.MagnetLine.Position.A.Y").GetPropertyValue().GetValue(),r=this.GetProperty("Collab.MagnetLine.Position.B.X").GetPropertyValue().GetValue(),o=this.GetProperty("Collab.MagnetLine.Position.B.Y").GetPropertyValue().GetValue(),a=new s.Vector2(t,i),n=new s.Vector2(r,o);let l=(new s.Vector2).subVectors(n,a),p=(new s.Vector2).copy(l).normalize(),u=(new s.Vector2).subVectors(e,a).dot(p),h=p.clone().multiplyScalar(u),d=(new s.Vector2).addVectors(a,h);for(var c=new s.Vector2(0,0),y=0,C=-1,m=this.arrayModifiableAttached.length,f=0;f<m;f++){var V=(f+1)/(m+1),b=l.clone().multiplyScalar(V),P=t+b.x,g=i+b.y,_=new s.Vector2(P,g),S=d.distanceTo(_);0===f?(c.x=P,c.y=g,y=S,C=f):S<y&&(c.x=P,c.y=g,y=S,C=f)}return{proposalPoint:c,index:C}},getProposalPositionProjectedOnMagnetLine:function(e){var t=this.GetProperty("Collab.MagnetLine.Position.A.X").GetPropertyValue().GetValue(),i=this.GetProperty("Collab.MagnetLine.Position.A.Y").GetPropertyValue().GetValue(),r=this.GetProperty("Collab.MagnetLine.Position.B.X").GetPropertyValue().GetValue(),o=this.GetProperty("Collab.MagnetLine.Position.B.Y").GetPropertyValue().GetValue(),a=new s.Vector2(t,i),n=new s.Vector2(r,o).clone().sub(a).normalize(),l=e.clone().sub(a).dot(n),p=n.clone().multiplyScalar(l);return a.clone().add(p)},getNewProposalMagnetPositionIn2D:function(e,t){if(this.isCustomAlignment())return this.getProposalPositionProjectedOnMagnetLine(t);var i=this.arrayModifiableAttached.length;if(-1===this.arrayModifiableAttached.indexOf(e))return this.getPositionIn2D(i,i+1);var r=this.getProposalPositionIndexOnMagnetLine(t);return this.updateModifiableIndex(e,r.index),this.updateAttachedPosition(),r.proposalPoint},updateModifiableIndex:function(e,t){if(t<0||t>this.arrayModifiableAttached.length)return!1;var i=this.arrayModifiableAttached.indexOf(e);return-1!==i&&(this.arrayModifiableAttached.splice(i,1),this.arrayModifiableAttached.splice(t,0,e),!0)},getPositionIn2D:function(e,t){var i=this.GetProperty("Collab.MagnetLine.Position.A.X").GetPropertyValue().GetValue(),r=this.GetProperty("Collab.MagnetLine.Position.A.Y").GetPropertyValue().GetValue(),o=this.GetProperty("Collab.MagnetLine.Position.B.X").GetPropertyValue().GetValue(),a=this.GetProperty("Collab.MagnetLine.Position.B.Y").GetPropertyValue().GetValue(),n=new s.Vector2(i,r),l=new s.Vector2(o,a),p=new s.Vector2;p.subVectors(l,n);var u=1/(t+1),h=p.clone().multiplyScalar(u),d=i+h.x*(e+1),c=r+h.y*(e+1);return new s.Vector2(d,c)},cleanModifiableAttached:function(){this.arrayModifiableAttached.splice(0,this.arrayModifiableAttached.lenght),this.arrayModifiableAttached.lenght=0,this.arrayModifiableAttached=[],this.arrayModifiableRatioPos.splice(0,this.arrayModifiableRatioPos.lenght),this.arrayModifiableRatioPos.lenght=0,this.arrayModifiableRatioPos=[]},removeModifiableAttached:function(e){var t=this.arrayModifiableAttached.indexOf(e);-1!==t&&(this.arrayModifiableAttached.splice(t,1),this.updateAttachedPosition()),-1!==(t=this.arrayModifiableRatioPos.indexOf(e))&&this.arrayModifiableRatioPos.splice(t,1)},addModifiableAttached:function(e){if(this.arrayModifiableAttached.includes(e)){if(this.isCustomAlignment()){var t=this.getProportionalPosition(e);this.arrayModifiableRatioPos[this.arrayModifiableAttached.indexOf(e)]=t}}else{for(var i=!1,r=this.ExperienceBase.ComponentsMap.GetComponentFromType("VCXMagnetLine_Spec"),o=0;o<r.length;o++){const t=r[o];if(t){const r=t.QueryInterface("VCXIVisibility");if(r&&r.GetVisibility()){const r=t.QueryInterface("VCXIModifiable");if(r._hashing===this._hashing)continue;r.arrayModifiableAttached.includes(e)&&(i=!0)}}}if(!i){this.arrayModifiableAttached.push(e);t=this.getProportionalPosition(e);this.arrayModifiableRatioPos.push(t)}}},getProportionalPosition:function(e){var t=this.GetProperty("Collab.MagnetLine.Position.A.X").GetPropertyValue().GetValue(),i=this.GetProperty("Collab.MagnetLine.Position.A.Y").GetPropertyValue().GetValue(),r=this.GetProperty("Collab.MagnetLine.Position.B.X").GetPropertyValue().GetValue(),o=this.GetProperty("Collab.MagnetLine.Position.B.Y").GetPropertyValue().GetValue(),a=new s.Vector2(t,i),n=new s.Vector2(r,o),l=new s.Vector2;l.subVectors(n,a);var p=e.QueryInterface("VCXIMagnetLine").get2DPosition(),u=new s.Vector2;u.subVectors(p,a);var h=0;return Math.abs(l.x)>Number.EPSILON?h=u.x/l.x:Math.abs(l.y)>Number.EPSILON&&(h=u.y/l.y),h},updatePropMapWithNewPosition:function(e,t,i){var o=new r,a=t.QueryInterface("VCXIMagnetLine");a&&(a.set2DPosition(i,o),e.AddOrModifyPropertySet(t.GetHashing(),o))},updatePropMapOfAttachedMagnet:function(e){if(this.isCustomAlignment()){var t=this.GetProperty("Collab.MagnetLine.Position.A.X").GetPropertyValue().GetValue(),i=this.GetProperty("Collab.MagnetLine.Position.A.Y").GetPropertyValue().GetValue(),o=this.GetProperty("Collab.MagnetLine.Position.B.X").GetPropertyValue().GetValue(),a=this.GetProperty("Collab.MagnetLine.Position.B.Y").GetPropertyValue().GetValue(),n=new s.Vector2(t,i),l=new s.Vector2(o,a);let m=(new s.Vector2).subVectors(l,n);for(var p=0;p<this.arrayModifiableAttached.length;p++){var u=this.arrayModifiableAttached[p],h=this.arrayModifiableRatioPos[p];if(y=u.QueryInterface("VCXIMagnetLine")){let o=m.clone();o.multiplyScalar(h);var d=new s.Vector2(t+o.x,i+o.y),c=new r;y.set2DPosition(d,c),(C=y.QueryInterface("VCXIModifiable"))&&e.AddOrModifyPropertySet(C.GetHashing(),c)}}}else for(p=0;p<this.arrayModifiableAttached.length;p++){var y;if(y=(u=this.arrayModifiableAttached[p]).QueryInterface("VCXIMagnetLine")){var C,m=this.getPositionIn2D(p,this.arrayModifiableAttached.length);c=new r;y.set2DPosition(m,c),(C=y.QueryInterface("VCXIModifiable"))&&e.AddOrModifyPropertySet(C.GetHashing(),c)}}},updateAttachedPosition:function(){if(this.isCustomAlignment());else for(var e=0;e<this.arrayModifiableAttached.length;e++){var t=this.arrayModifiableAttached[e].QueryInterface("VCXIMagnetLine");if(t){var i=this.getPositionIn2D(e,this.arrayModifiableAttached.length);t.do2DPosition(i)}}},GetNewExtremityAlignWith:function(e){var t=this.GetProperty("Collab.MagnetLine.Position.A.X").GetPropertyValue().GetValue(),i=this.GetProperty("Collab.MagnetLine.Position.A.Y").GetPropertyValue().GetValue(),r=this.GetProperty("Collab.MagnetLine.Position.B.X").GetPropertyValue().GetValue(),o=this.GetProperty("Collab.MagnetLine.Position.B.Y").GetPropertyValue().GetValue(),a=new s.Vector3(t,i,0),n=new s.Vector3(r,o,0),l=new s.Vector3((n.x-a.x)/2+a.x,(n.y-a.y)/2+a.y,(n.z-a.z)/2+a.z),p=a.distanceTo(n),u=e.normalize();u.multiplyScalar(p/2);var h=new s.Vector3;h.addVectors(l,u),u.multiplyScalar(-1);var d=new s.Vector3;return d.addVectors(l,u),{extremityA:h,extremityB:d}},isCustomAlignment:function(){return null!==this.GetProperty("MagnetLine.Spacing")&&this.GetProperty("MagnetLine.Spacing").GetPropertyValue().GetValue()===f.EMLSpacing.Custom}})}),define("DS/VCXWebDressup/VCXRedLineModifiable",["DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueMap"],function(e,t,i,r,o,a,n,s,l){"use strict";return t.extend({init:function(){this._parent()},Build:function(){this._parent();var t=[{Name:"Actor.Color",DefaultValue:(new i).FromRGBA(1,0,0,1),GroupId:"Group.Line",FormatPainter:!0},{Name:"Collab.Body.Line.Width",Type:o,DefaultValue:2,GroupId:"Group.Line",FormatPainter:!0},{Name:"Actor.Anchor.0",Type:n,DefaultValue:(new n).SetValueFrame((new a).SetValueFromVector(new e.Vector3(0,0,0))).GetValue()},{Name:"Collab.ListAnchorsIDs",Type:s,DefaultValue:[0]},{Name:"Collab.VertexBuffers",Type:l,BehaviorType:2,DefaultValue:new l}];this._BuildPropertyValues(t)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Actor.Color",!1),this.SetPropertyInvisible("Collab.ListAnchorsIDs",!0),this.SetPropertyInvisible("Collab.VertexBuffers",!0),this.SetPropertyInvisible("Actor.Color",!1),this.SetPropertyInvisible("Actor.Anchor.0",!0)}})}),define("DS/VCXWebDressup/VCXViewportModifiable",["DS/VCXWebDressup/VCXViewport_Spec","DS/CoreEvents/Events","DS/VCXWebDressup/VCXDressupModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelCommands/VCXCmdChangePropertiesVolatile","DS/VCXWebSystem/VCXMathTools","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValuePoint","DS/VCXWebProperties/VCXPropertyValueLink","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueDocId","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebVisualization/VCXVisuManager","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup"],function(e,t,i,r,o,a,n,s,l,p,u,h,d,c,y,C,m,f,V,b,P,g,_,S,M){"use strict";return i.extend({init:function(){this._parent(),this._bIsViewport=!0,this._envMapNeverLoaded=!1,this._forceRefresh=!1,this._fullFrameSize=36},Dispose:function(){this._parent(),delete this._currentAmbienceIDXs},Build:function(){this._parent();var t=[{Name:"Actor.Name",Type:C,DefaultValue:"Viewport",i18n:S,visibleInPropertyGroups:!1},{Name:"Camera.Position",Type:c,DefaultValue:new r.Matrix4,Persistent:!1,hiddenFields:["Orientation","Scale"],GroupId:"Group.Camera",visibleInPropertyGroups:!1},{Name:"Camera.Position.Frame",Type:f,Persistent:!1,GroupId:"Group.Camera"},{Name:"Camera.Target.Frame",Type:f,Persistent:!1,GroupId:"Group.Camera"},{Name:"Camera.Dolly",Type:p,Persistent:!0,GroupId:"Group.Camera"},{Name:"Actor.Anchor.1",Type:y,DefaultValue:(new y).SetValueFrame((new c).SetValueFromVector(new r.Vector3(0,0,0))).GetValue(),Persistent:!1},{Name:"Actor.Anchor.2",Type:y,DefaultValue:(new y).SetValueFrame((new c).SetValueFromVector(new r.Vector3(0,0,0))).GetValue(),Persistent:!1},{Name:"Collab.ListAnchorsIDs",Type:m,DefaultValue:[1,2],visibleInPropertyGroups:!1},{Name:"Camera.Focal.Length",Type:u,GroupId:"Group.Camera",Persistent:!1,Bounds:{Min:10,Max:600,Step:1}},{Name:"Camera.Angle",Type:u,DefaultValue:45,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.Height",Type:u,DefaultValue:400,GroupId:"Group.Camera",Persistent:!1},{Name:"Camera.Ortho",Type:p,DefaultValue:!1,GroupId:"Group.Camera",Persistent:!1},{Name:"Camera.Arcball",Type:p,DefaultValue:!0,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.Pitch",Type:p,DefaultValue:!0,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.Roll",Type:p,DefaultValue:!1,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.Roll.Angle",Type:u,DefaultValue:0,GroupId:"Group.Camera",Persistent:!1,Bounds:{Min:-179,Max:180,Step:1}},{Name:"Camera.Yaw",Type:p,DefaultValue:!0,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.LockDistCOI",Type:p,DefaultValue:!1,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.DistCOI",Type:u,DefaultValue:500,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.Mouse.Controls.Profile",Type:h,GroupId:"Group.Camera",Persistent:!1,BehaviorType:1,MapChoice:{10:"SIMPLE",20:"COMBINED",30:"CATIA",40:"SWX"},visibleInPropertyGroups:!1},{Name:"Paper.Width",Type:u,GroupId:"Group.Paper",DefaultValue:300},{Name:"Paper.Height",Type:u,GroupId:"Group.Paper",DefaultValue:168.75},{Name:"Paper.Orientation",Type:h,GroupId:"Group.Paper",MapChoice:this._generateMapChoiceFromEnumAndId(e.EPaperOrientation,"Paper.Orientation"),Persistent:!1},{Name:"Viewport.ActiveAmbience",Type:V,DefaultValue:"",GroupId:"Group.Environment",BehaviorType:1,visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Viewport.ActiveAmbience.IDX",Type:h,GroupId:"Group.Environment",Persistent:!1,BehaviorType:1,MapChoice:{0:M["Ambience.DefaultAmbience"]},returnedOnGetProperties:!1,FormatPainter:!0},{Name:"Viewport.ActiveCamera",Type:l,DefaultValue:0,GroupId:"Group.Environment",Persistent:!1,BehaviorType:1,visibleInPropertyGroups:!1},{Name:"Environment.Vertical",Type:h,DefaultValue:e.EVertical["Z+"],GroupId:"Group.Environment",MapChoice:this._generateMapChoiceFromEnumAndId(e.EVertical),FormatPainter:!0},{Name:"Environment.Background.Override",Type:p,ControlsGroupVisibility:!0,DefaultValue:!1,GroupId:"Group.Environment.Background"},{Name:"Environment.Background.Color",Type:d,DefaultValue:(new b).FromRGBA(236/255,236/255,236/255),GroupId:"Group.Environment.Background",FormatPainter:!0},{Name:"Environment.Background.Color.Opacity",Type:u,DefaultValue:1,GroupId:"Group.Environment.Background",FormatPainter:!0},{Name:"Environment.Background.Image",Type:P,DefaultValue:-1,GroupId:"Group.Environment.Background",FormatPainter:!0},{Name:"Environment.Background.Gradient",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Background",FormatPainter:!0},{Name:"Environment.Background.Foot.Color",Type:d,DefaultValue:(new b).FromRGBA(236/255,236/255,236/255),GroupId:"Group.Environment.Background",FormatPainter:!0},{Name:"Environment.Shadow",Type:p,DefaultValue:!1,Persistent:!1,GroupId:"Group.Environment.Effects",FormatPainter:!0},{Name:"Environment.AA",Type:h,DefaultValue:e.EAA.SMAA,GroupId:"Group.Environment.Effects",MapChoice:this._generateMapChoiceFromEnumAndId(e.EAA,"Environment.AA"),FormatPainter:!0},{Name:"Environment.SSAO",Type:h,DefaultValue:e.ESSAO.OnIdle,GroupId:"Group.Environment.Effects",MapChoice:this._generateMapChoiceFromEnumAndId(e.ESSAO,"Environment.SSAO"),FormatPainter:!0},{Name:"Environment.Vignetting",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Effects",FormatPainter:!0},{Name:"Environment.DOF",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Effects",FormatPainter:!0},{Name:"Environment.Bloom",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Effects",FormatPainter:!0},{Name:"Environment.Flare",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Effects",FormatPainter:!0},{Name:"Environment.BackFaceCulling",Type:p,DefaultValue:!0,GroupId:"Group.Environment.Effects",FormatPainter:!0},{Name:"Render.Mode",Type:h,DefaultValue:g.ERenderingMode.Smooth,GroupId:"Group.Render",MapChoice:this._generateMapChoiceFromEnumAndId(g.ERenderingMode,"Render"),FormatPainter:!0},{Name:"Render.OutlineType",Type:h,DefaultValue:g.EOutlineType.Construction,GroupId:"Group.Render",MapChoice:this._generateMapChoiceFromEnumAndId(g.EOutlineType,"Render.OutlineType"),FormatPainter:!0},{Name:"Render.Lighting.Availability",Type:h,DefaultValue:i.EAvailability.AppForceAvailable,ControlsGroupAvailability:!0,GroupId:"Group.Render.Lighting"},{Name:"Render.Lighting.Override",Type:p,ControlsGroupVisibility:!0,DefaultValue:!1,GroupId:"Group.Render.Lighting"},{Name:"Render.Lighting.Intensity",Type:u,DefaultValue:.9,GroupId:"Group.Render.Lighting",FormatPainter:!0},{Name:"Render.Lighting.Mode",Type:h,DefaultValue:e.ERenderLightingMode.DefaultComposer,GroupId:"Group.Render.Lighting",MapChoice:this._generateMapChoiceFromEnumAndId(e.ERenderLightingMode,"Render.Lighting.Mode"),FormatPainter:!0},{Name:"Render.ShowConstructions",Type:p,DefaultValue:!1,GroupId:"Group.Render",FormatPainter:!0},{Name:"Render.ChildrenStronger",Type:p,DefaultValue:!1,GroupId:"Group.Render",FormatPainter:!0},{Name:"Environment.Debug.Availability",Type:h,DefaultValue:i.EAvailability.AppForceNotAvailable,ControlsGroupAvailability:!0,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.Show",Type:p,DefaultValue:!1,ControlsGroupVisibility:!0,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.ShadowLight",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.BSphere",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.PrimitiveBSphere",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.RepBBox",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.Picking",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.Normals",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.PickHybrid",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.PostProcessing",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.ShadowMaps",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.FPS",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Debug"},{Name:"Render.PixelCulling",Type:u,DefaultValue:1,GroupId:"Group.Environment.Debug"},{Name:"Environment.Debug.Render.DefaultAppearanceMode",Type:h,DefaultValue:0,GroupId:"Group.Environment.Debug",MapChoice:this._generateMapChoiceFromEnumAndId(r.DefaultAppearanceMode,"")},{Name:"Viewport.DefaultAmbience",Type:h,GroupId:"Group.Environment.Debug",DefaultValue:1e4,Persistent:!0,BehaviorType:1,MapChoice:this._generateMapChoiceFromEnumAndId(_.EDefaultAmbience,""),FormatPainter:!0},{Name:"Actor.Color",visibleInPropertyGroups:!1},{Name:"Actor.Opacity",visibleInPropertyGroups:!1},{Name:"Actor.IsAlwaysOnTop",visibleInPropertyGroups:!1}];const o=this.GetObject()._experienceBase.getManager("VCXContextManager");o&&o.isSupported("VCXPIPSupport")&&t.push({Name:"Environment.Background.Transparent",Type:p,DefaultValue:!1,GroupId:"Group.Environment.Background",FormatPainter:!0}),this._BuildPropertyValues(t),this.SetPropertyInvisible("Collab.ListAnchorsIDs",!0)},GetVirtualProperties:function(){var e={"Camera.Position":!0};return e},GetRequiredPropertiesForTransition:function(){var e=this.QueryInterface("VCXIViewpointController");e&&e.fromViewpoint();var t={"Camera.Position":!0,"Actor.Anchor.1":!0,"Actor.Anchor.2":!0,"Camera.Angle":!0,"Camera.Height":!0,"Camera.Ortho":!0,"Camera.Arcball":!0,"Actor.Interpolation.Type":!0,"Camera.Pitch":!0,"Camera.Roll":!0,"Camera.Roll.Angle":!0,"Camera.Yaw":!0,"Camera.LockDistCOI":!0,"Camera.DistCOI":!0};return t},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Environment.Background.Color.Opacity",-1===this.GetPropertyValue("Environment.Background.Image")),this.SetPropertyInvisible("Environment.Background.Color",!this.GetPropertyValue("Environment.Background.Override")),this.SetPropertyInvisible("Environment.Background.Color.Opacity",!this.GetPropertyValue("Environment.Background.Override")),this.SetPropertyInvisible("Environment.Background.Gradient",!this.GetPropertyValue("Environment.Background.Override")),this.SetPropertyInvisible("Environment.Background.Image",!this.GetPropertyValue("Environment.Background.Override")),this.SetPropertyInvisible("Environment.Background.Foot.Color",!this.GetPropertyValue("Environment.Background.Override")||!this.GetPropertyValue("Environment.Background.Gradient"));const e=this.GetObject()._experienceBase.getManager("VCXContextManager");e&&e.isSupported("VCXPIPSupport")&&this.SetPropertyInvisible("Environment.Background.Transparent",!this.GetPropertyValue("Environment.Background.Override")||!this.GetPropertyValue("Environment.Background.Gradient")),this.SetPropertyInvisible("Viewport.ActiveAmbience",!0),e.isSupported("3DSync")||(this.SetPropertyInvisible("Render.ShowConstructions",!0),this.ChangeGroupAvailability("Group.Render.Lighting",i.EAvailability.AppForceAvailable)),this.SetPropertyInvisible("Render.Lighting.Intensity",!this.GetPropertyValue("Render.Lighting.Override")),this.SetPropertyInvisible("Render.Lighting.Mode",!this.GetPropertyValue("Render.Lighting.Override")),this.SetPropertyInvisible("Camera.Focal.Length",this.GetPropertyValue("Camera.Ortho")),this.SetPropertyInvisible("Camera.Height",!this.GetPropertyValue("Camera.Ortho")),e.isSupported("ViewportDebug")?(this.ChangeGroupAvailability("Group.Environment.Debug",i.EAvailability.AppForceAvailable),this.SetPropertyInvisible("Camera.Mouse.Controls.Profile",!1),this.ChangeGroupAvailability("Group.Render.Lighting",i.EAvailability.AppForceAvailable)):(this.changeMapChoice("Render.Mode",this._generateMapChoiceFromEnumAndId(g.ERenderingMode,"Render",["FlatTechnical"])),this.changeMapChoice("Render.OutlineType",this._generateMapChoiceFromEnumAndId(g.EOutlineType,"Render.OutlineType",["Smart"])),this.SetPropertyInvisible("Render.ChildrenStronger",!0),this.SetPropertyInvisible("Environment.Vignetting",!0),this.SetPropertyInvisible("Environment.Flare",!0),this.SetPropertyInvisible("Environment.DOF",!0),this.SetPropertyInvisible("Environment.Bloom",!0)),this.ChangeGroupAvailability("Group.Actions",i.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Camera",i.EAvailability.AppForceNotAvailable)},GetProperties:function(e){var t=this.QueryInterface("VCXIViewpointController");return t&&t.fromViewpoint(),this._parent(e)},GetProperty:function(e){if("Camera.Roll.Angle"===e){if(i=this.QueryInterface("VCXIViewpointController")){var t=i.getMatrixAndDOI();return this.GetNewProperty(e,180*t.roll/Math.PI)}}else if("Camera.Position.Frame"===e||"Camera.Target.Frame"===e){var i;if(i=this.QueryInterface("VCXIViewpointController")){t=i.getMatrixAndDOI();if("Camera.Position.Frame"===e)return this.GetNewProperty(e,a.getOFromMatrix(t.matrix));if("Camera.Target.Frame"===e)return this.GetNewProperty(e,t.target)}}else{if("Camera.Focal.Length"===e){var r=this.GetPropertyValue("Camera.Angle");r/=360/Math.PI;var o=Math.tan(r),s=.5*this._fullFrameSize/o;return this.GetNewProperty(e,s)}if("Camera.Mouse.Controls.Profile"===e){var l={SIMPLE:10,COMBINED:20,CATIA:30,SWX:40},p=l[localStorage.getItem("DS_VCX_MOUSE_CONTROLS_PROFILE")];return p||(p=l.SIMPLE),this.GetNewProperty(e,p)}if("Paper.Width"===e){if(u=this.ExperienceBase.getManager("VCXPaperManager"))return this.GetNewProperty(e,u.GetWidth())}else if("Paper.Height"===e){if(u=this.ExperienceBase.getManager("VCXPaperManager"))return this.GetNewProperty(e,u.GetHeight())}else if("Paper.Orientation"===e){var u;if(u=this.GetObject()._experienceBase.getManager("VCXPaperManager"))return this.GetNewProperty(e,u.GetWidth()<u.GetHeight()?0:1)}else if("Environment.AA"===e){if(g=this.ExperienceBase.getManager("VCXContextManager").getMainViewer())return this.GetNewEnumProperty(e,e+"."+g.antiAliasing)}else if("Environment.Shadow"===e){if(g=this.ExperienceBase.getManager("VCXContextManager").getMainViewer())return this.GetNewProperty(e,g.useShadowMap)}else if("Environment.Vignetting"===e){if(g=this.ExperienceBase.getManager("VCXContextManager").getMainViewer())return this.GetNewProperty(e,g.useVignetting)}else if("Environment.DOF"===e){if(g=this.ExperienceBase.getManager("VCXContextManager").getMainViewer())return this.GetNewProperty(e,g.useDOF)}else if("Environment.Bloom"===e){if(g=this.ExperienceBase.getManager("VCXContextManager").getMainViewer())return this.GetNewProperty(e,g.useBloom)}else if("Environment.Flare"===e){if(g=this.ExperienceBase.getManager("VCXContextManager").getMainViewer())return this.GetNewProperty(e,g.useFlare)}else if("Environment.BackFaceCulling"===e){if(g=this.ExperienceBase.getManager("VCXContextManager").getMainViewer())return this.GetNewProperty(e,!1===g.renderer.disableBackFaceCulling)}else{if("Render.PixelCulling"!==e){if("Render.ShowConstructions"===e)return this.GetNewProperty(e,this.GetObject().showConstructions);if("Viewport.ActiveAmbience.IDX"===e){var d=this._Properties["Viewport.ActiveAmbience.IDX"]._propertyInfo;this._currentAmbienceIDXs=[];var c=this.ExperienceBase.ComponentsMap.GetComponentFromType("AmbienceModel_Spec");d.AddOrModifyChoice(0,M["Ambience.DefaultAmbience"]);for(var y=0,C=0;C<c.length;C++){var m=c[C].GetID();this._currentAmbienceIDXs[C]=m,m===this.GetPropertyValue("Viewport.ActiveAmbience")&&(y=C+1);var f=m,V=c[C].QueryInterface("VCXIModifiable");if(V){var b=V.GetProperty("Actor.Name");b&&(f=b.GetPropertyValue().Value)}d.AddOrModifyChoice(C+1,f)}var P=new h(y);return new n(d,P)}return this._parent(e)}var g;if(g=this.ExperienceBase.getManager("VCXContextManager").getMainViewer())return this.GetNewProperty(e,g.currentViewpoint.camera.pixelCulling)}}},RequestModification:function(e,t){if(e){var i=e.GetPropertyInfo().GetPropertyName();if("Camera.Position.Frame"===i||"Camera.Target.Frame"===i){if(this._needToUpdateViewpoint=!0,m=this.QueryInterface("VCXIViewpointController")){var o,n,s=this.ExperienceBase.getManager("VCXVisuManager"),l=m.getMatrixAndDOI(),p=new r.Vector3(0,0,1);o="Camera.Position.Frame"===i?e.GetPropertyValue().Value:a.getOFromMatrix(l.matrix),n="Camera.Target.Frame"===i?e.GetPropertyValue().Value:l.target;var u=(new r.Vector3).subVectors(o,n),h=u.length(),d=s.getMatrixToAdjustVertical().clone().multiply(a.rotateMatrixAroundZ(a.getMatrixFromOVzVy(o,u,p),l.roll)),c=s.getMatrixToAdjustVertical().clone().multiply(a.rotateMatrixAroundZ(a.getMatrixFromOVzVy(n,u,p),l.roll));if((f=this.GetProperty("Camera.Position").Clone()).GetPropertyValue().SetValue(d),t.AddOrModifyProperty(this.GetHashing(),f),(f=this.GetProperty("Actor.Anchor.2").Clone()).GetPropertyValue().GetValueFrame().SetValue(c),t.AddOrModifyProperty(this.GetHashing(),f),this.GetPropertyValue("Camera.Dolly")&&!this.GetPropertyValue("Camera.Ortho")){var y=360*Math.atan(.5*l.height/h)/Math.PI;t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Camera.Angle",y))}}return this._parent(e,t)}if("Camera.Focal.Length"===i){y=360*Math.atan(.5*this._fullFrameSize/e.GetPropertyValue().Value)/Math.PI;if(t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Camera.Angle",y)),this.GetPropertyValue("Camera.Dolly")&&!this.GetPropertyValue("Camera.Ortho")){s=this.ExperienceBase.getManager("VCXVisuManager");if(m=this.QueryInterface("VCXIViewpointController")){h=.5*(l=m.getMatrixAndDOI()).height/Math.tan(.5*y*Math.PI/180);var C=l.target.add(a.getVzFromMatrix(l.matrix).normalize().multiplyScalar(h));d=s.getMatrixToAdjustVertical().clone().multiply(l.matrix.setPosition(C));(f=this.GetProperty("Camera.Position").Clone()).GetPropertyValue().SetValue(d),t.AddOrModifyProperty(this.GetHashing(),f)}}return this._parent(e,t)}if("Camera.Roll.Angle"===i){s=this.ExperienceBase.getManager("VCXVisuManager");var m=this.QueryInterface("VCXIViewpointController");if(s&&m){l=m.getMatrixAndDOI();var f,V=a.getMatrixFromOVzVy(a.getOFromMatrix(l.matrix),a.getVzFromMatrix(l.matrix),new r.Vector3(0,0,1));d=s.getMatrixToAdjustVertical().clone().multiply(a.rotateMatrixAroundZ(V,e.GetPropertyValue().Value*Math.PI/180));(f=this.GetProperty("Camera.Position").Clone()).GetPropertyValue().SetValue(d),t.AddOrModifyProperty(this.GetHashing(),f)}return this._parent(e,t)}if("Viewport.ActiveAmbience.IDX"===i){var b=e.GetPropertyValue().Value-1;if(this._currentAmbienceIDXs&&b>=0){var P=this._currentAmbienceIDXs[b];t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Viewport.ActiveAmbience",P))}else t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Viewport.ActiveAmbience",""));return this._parent(e,t)}if("Paper.Orientation"===i){var g=(S=this.GetObject()._experienceBase.getManager("VCXPaperManager")).GetWidth(),_=S.GetHeight();return(0===e.GetPropertyValue().Value&&_<g||1===e.GetPropertyValue().Value&&_>g)&&(t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Paper.Width",_)),t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Paper.Height",g))),t.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,t)}if("Paper.Width"===i||"Paper.Height"===i){var S;g=(S=this.GetObject()._experienceBase.getManager("VCXPaperManager")).GetWidth(),_=S.GetHeight();if("Paper.Width"===i?(g=e.GetPropertyValue().Value,t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Paper.Height",_))):(_=e.GetPropertyValue().Value,t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Paper.Width",g))),_<g&&0===this.GetProperty("Paper.Orientation").GetPropertyValue().Value||_>g&&1===this.GetProperty("Paper.Orientation").GetPropertyValue().Value){var M=this.GetProperty("Paper.Orientation").GetPropertyValue().Value?0:1;t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Paper.Orientation",M))}return t.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,t)}}return this._parent(e,t)},OnChangeProperty:function(e,t,i){if(i||(i={}),i.fromChildClass);else if(this.OnChangePropertyBegin(e,t))return!0;i.fromChildClass=!0,this._parent(e,t,i);var r,o=this.ExperienceBase.getManager("VCXContextManager");if("Camera.Mouse.Controls.Profile"===e){var a={10:"SIMPLE",20:"COMBINED",30:"CATIA",40:"SWX"};localStorage.setItem("DS_VCX_MOUSE_CONTROLS_PROFILE",a[t.Value]),this.ExperienceBase.getManager("VCXVisuManager").SetController(a[t.Value])}else if("Paper.Width"===e)this._paperRequestedWidth=t;else if("Paper.Height"===e)this._paperRequestedHeight=t;else if("Environment.AA"===e){let i=this.GetProperty(e);var n=(r=i&&i.GetPropertyInfo().GetMapChoiceEnum())&&r[t.Value];n&&(this._requestedAA=n.split(".").pop())}else"Environment.SSAO"===e?this._requestedSSAO=t.Value:"Environment.Mirror"===e?o.applyToViewers(function(e){e.setMirror(t.Value)}):"Environment.Shadow"===e?o.applyToViewers(function(e){e.setShadow(t.Value)}):"Environment.Vignetting"===e?o.applyToViewers(function(e){e.setVignetting(t.Value)}):"Environment.DOF"===e?o.applyToViewers(function(e){e.setDOF(t.Value)}):"Environment.Bloom"===e?o.applyToViewers(function(e){e.setBloom(t.Value)}):"Environment.Flare"===e?o.applyToViewers(function(e){e.setFlare(t.Value)}):"Environment.BackFaceCulling"===e?o.applyToViewers(function(e){e.setDisableBackFaceCulling(!1===t.Value)}):"Render.PixelCulling"===e?o.applyToViewers(function(e){e.currentViewpoint.setPixelCulling(t.Value)}):"Render.ShowConstructions"===e?this._requestedShowConstructions=t.Value:"Environment.Debug.ShadowLight"===e?o.applyToViewers(function(e){e.debugShadowLight=t.Value}):"Environment.Debug.BSphere"===e?o.applyToViewers(function(e){e.debugBSphere=t.Value}):"Environment.Debug.PrimitiveBSphere"===e?o.applyToViewers(function(e){e.debugPrimitiveBSphere=t.Value}):"Environment.Debug.RepBBox"===e?o.applyToViewers(function(e){e.debugRepBBox=t.Value}):"Environment.Debug.Picking"===e?o.applyToViewers(function(e){e.debugPicking=t.Value}):"Environment.Debug.Normals"===e?o.applyToViewers(function(e){e.debugNormals=t.Value}):"Environment.Debug.BackfaceCulling"===e?o.applyToViewers(function(e){e.debugBackfaceCulling=t.Value}):"Environment.Debug.PickHybrid"===e?o.applyToViewers(function(e){e.debugPickHybrid=t.Value}):"Environment.Debug.PostProcessing"===e?o.applyToViewers(function(e){e.setDebugPostProcessing(t.Value)}):"Environment.Debug.ShadowMaps"===e?o.applyToViewers(function(e){e.setDebugShadowMaps(t.Value)}):"Environment.Debug.Render.DefaultAppearanceMode"===e?o.applyToViewers(function(e){e.setVisuAppearanceMode(t.Value)}):"Environment.Debug.FPS"===e||("Render.Mode"===e?this._requestedRenderMode=t.Value:"Render.OutlineType"===e&&(this._requestedOutlineType=t.Value))},OnChangePropertiesEnd:function(){if(this._parent(),this._requestedAA||this._requestedSSAO){var i=this._requestedAA||this.GetPropertyValue("Environment.AA"),r=this._requestedSSAO||this.GetPropertyValue("Environment.SSAO"),a=r!==e.ESSAO.NoSSAO,l=a&&"MSAA"===i,u=r===e.ESSAO.Always;(V=this.ExperienceBase.getManager("VCXContextManager")).applyToViewers(function(e){e.setAntiAliasing(i),e.setSSAO(a,"static"),e.setIterativeSSAO(l),e.setSSAO(u,"dynamic")})}if(this._requestedRenderMode!==this.GetObject().renderMode||this._requestedOutlineType!==this.GetObject().outlineType||this._requestedShowConstructions!==this.GetObject().showConstructions||this._forceRefresh){this.GetObject().renderMode=this._requestedRenderMode,this.GetObject().outlineType=this._requestedOutlineType,this.GetObject().showConstructions=this._requestedShowConstructions;var h=this.GetObject().renderMode,d=this.GetObject().outlineType,c=this.GetObject().showConstructions;(V=this.ExperienceBase.getManager("VCXContextManager")).getRootComponent().setDirtyFlag&&V.getRootComponent().setDirtyFlag(g.FDirty.RenderingMode),V.traverseGraphMustBePerformed=!0;var y=this.ExperienceBase.getManager("VCXVisuManager"),C=this.ExperienceBase.ComponentsMap.GetComponentFromType("VCXWebComponentOccurrence"),m=this.ExperienceBase.getManager("VCXMaterialManager").getRenderStyle(h,d,c);V.applyToViewers(function(e){switch(e.setRenderStyle(m),h){case g.ERenderingMode.Smooth:case g.ERenderingMode.SmoothOutline:e.setRenderPriority&&e.setRenderPriority(!1),e.setRenderPriority&&e.setRenderPriorityDefaultOpacity(1);break;case g.ERenderingMode.Custom:y&&y.dirtifyRenderPriority()}if(!V.useTraverseGraph)for(var t=0;t<C.length;++t){var i=C[t],r=i.QueryInterface("VCXIModifiable");r&&(i.setDirtyFlag(g.FDirty.RenderingMode,!0),r.applyChanges&&r.applyChanges())}}),t.publish({event:"VCX_ENVIRONNEMENT_PROPERTY_CHANGED"})}if(this._paperRequestedWidth||this._paperRequestedHeight||this._paperRequestedVisibility){var f=this.ExperienceBase.getManager("VCXPaperManager");f&&(this._paperRequestedWidth&&(this._paperRequestedWidth.Value!==f.GetWidth()||this._forceRefresh)&&(f.SetWidth(this._paperRequestedWidth.Value),this._paperRequestedWidth=null),this._paperRequestedHeight&&(this._paperRequestedHeight.Value!==f.GetHeight()||this._forceRefresh)&&(f.SetHeight(this._paperRequestedHeight.Value),this._paperRequestedHeight=null),f.updatePaper({propagateEvent:!0}))}var V;if((V=this.ExperienceBase.getManager("VCXContextManager"))&&(this._previousEnvMapStr=this._envMapStr,this._previousShowEnv=this._showEnv),this._previousVertical!==this.GetPropertyValue("Environment.Vertical")||this._forceRefresh){this._previousVertical=this.GetPropertyValue("Environment.Vertical"),this.ExperienceBase.getManager("VCXVisuManager").setVertical(this.GetPropertyValue("Environment.Vertical"));var b=this.ExperienceBase.getManager("VCXVisuManager").getInverseMatrixToAdjustVertical();this.ExperienceBase.getManager("VCXContextManager").getRootNode().setMatrix(b);var P=this.ExperienceBase.ComponentsMap.GetComponentFromType("CXPCameraActor_Spec")[this.GetPropertyValue("Viewport.ActiveCamera")];P&&P.updatePosition()}if(this._previousActiveAmbience!==this.GetPropertyValue("Viewport.ActiveAmbience")||this._previousDefaultAmbience!==this.GetPropertyValue("Viewport.DefaultAmbience")){var _=this.ExperienceBase.ComponentsMap.GetComponentFromID(this._previousActiveAmbience);if(_&&"AmbienceModel_Spec"===_.GetType()&&_.update(),(_=this.ExperienceBase.ComponentsMap.GetComponentFromID(this.GetPropertyValue("Viewport.ActiveAmbience")))&&"AmbienceModel_Spec"===_.GetType()&&_.update(),this._previousActiveAmbience=this.GetPropertyValue("Viewport.ActiveAmbience"),this._previousDefaultAmbience=this.GetPropertyValue("Viewport.DefaultAmbience"),!_)(y=this.ExperienceBase.getManager("VCXVisuManager")).activateDefaultAmbience(this.GetPropertyValue("Viewport.DefaultAmbience"))}if(this._previousActiveCam!==this.GetPropertyValue("Viewport.ActiveCamera")||this._forceRefresh){this._previousActiveCam=this.GetPropertyValue("Viewport.ActiveCamera");var S=this.ExperienceBase.ComponentsMap.GetComponentFromType("CXPCameraActor_Spec")[this.GetPropertyValue("Viewport.ActiveCamera")];if(S){var M=S.QueryInterface("VCXIModifiable"),G=new o,D=new n(new s("Actor.IsActive",2),new p(!0));G.ChangeProperty(M,D),this.ExperienceBase.getManager("VCXCommandManager").Do(G),S.updatePosition()}}var x=this.QueryInterface("VCXIViewpointController");this._needToUpdateViewpoint&&(this._needToUpdateViewpoint=!1,x.toViewpoint()),x&&!this.ExperienceBase.getManager("VCXVisuManager").CameraControlsViewpoint&&(x.resetMatrixAndDOI(),x.toViewpoint())},GetInterpolator:function(e){var t=this.QueryInterface("VCXIViewpointController");if(t)return t.GetInterpolator(e)}})}),define("DS/VCXWebDressup/VCXSectionModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueMap","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueLocation","DS/VCXWebProperties/VCXPropertySet"],function(e,t,i,r,o,a,n,s,l,p,u,h,d,c){"use strict";return e.extend({init:function(){this._parent(),this._bIsSection=!0},Build:function(){this._parent();var e=[{Name:"Actor.Anchor.0",Type:p,Visibility:!1,DefaultValue:(new p).SetValueFrame((new s).SetValueFromVector(new t.Vector3(0,0,0))).GetValue(),visibleInPropertyGroups:!1},{Name:"Actor.Color",DefaultValue:(new r).FromRGBA(0,.337,.525,1),GroupId:"Group.Section.Plane"},{Name:"Actor.Opacity",DefaultValue:.075,GroupId:"Group.Section.Plane"},{Name:"Actor.IsAlwaysOnTop",DefaultValue:!1,GroupId:"Group.Section.Plane"},{Name:"Section.Plane.Enable",Type:o,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Section.Plane"},{Name:"Section.Origin.Position",Type:d,DefaultValue:(new d).GetValue(),visibleInPropertyGroups:!1,GroupId:"Group.Section"},{Name:"Section.Enable",Type:o,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Section"},{Name:"Section.AutoFlip",Type:o,DefaultValue:!1,GroupId:"Group.Section"},{Name:"Section.SpaceBackAlpha",Type:n,DefaultValue:1,GroupId:"Group.Section",Bounds:{Min:0,Max:1,Step:1},visibleInPropertyGroups:!1},{Name:"Section.SpaceFrontAlpha",Type:n,DefaultValue:0,GroupId:"Group.Section",Bounds:{Min:0,Max:1,Step:1},visibleInPropertyGroups:!1},{Name:"Actor.ListActors",Type:u,GroupId:"Group.Section",visibleInPropertyGroups:!1},{Name:"Section.ComposerSMG",Type:o,DefaultValue:!1,GroupId:"Group.Section",visibleInPropertyGroups:!1},{Name:"Section.Capping",Type:o,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Section.Capping"},{Name:"Section.Capping.Color",Type:l,DefaultValue:(new r).FromRGBA(.0706,.7451,.9804,1),GroupId:"Group.Section.Capping"},{Name:"Section.Capping.ActorColor",Type:o,DefaultValue:!0,GroupId:"Group.Section.Capping"},{Name:"Section.Hatching.Color",Type:l,DefaultValue:(new r).FromRGBA(0,0,0,1),GroupId:"Group.Section.Hatching"},{Name:"Section.Hatching.Frequency",Type:a,DefaultValue:80,GroupId:"Group.Section.Hatching",Bounds:{Min:0,Max:300,Step:1}},{Name:"Section.Hatching.Angle",Type:n,DefaultValue:0,GroupId:"Group.Section.Hatching",Bounds:{Min:-90,Max:90,Step:1}},{Name:"Collab.ListAnchorsIDs",Type:h,DefaultValue:[0],visibleInPropertyGroups:!1}];this._BuildPropertyValues(e),this.SetPropertyInvisible("Collab.ListAnchorsIDs",!0)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Actor.Color",!1),this.ChangeGroupAvailability("Group.Section.Hatching",this.GetPropertyValue("Section.Capping")?e.EAvailability.NoControl:e.EAvailability.AppForceNotAvailable)},getPropertiesFormatPainter:function(){console.log("Test section format painter");let e=[];return e.push("Actor.Color"),e.push("Actor.Opacity"),e.push("Actor.IsAlwaysOnTop"),e.push("Section.Capping"),e.push("Section.Capping.Color"),e.push("Section.Capping.ActorColor"),e.push("Section.Hatching.Color"),e.push("Section.Hatching.Frequency"),e.push("Section.Hatching.Angle"),e}})}),define("DS/VCXWebDressup/VCX3DGridModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphUtils","DS/VCXWebSystem/VCXMathTools","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValuePoint","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueMap","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueLocation","DS/VCXWebProperties/VCXPropertySet"],function(e,t,i,r,o,a,n,s,l,p,u,h,d,c,y,C,m){"use strict";return e.extend({init:function(){this._parent()},Build:function(){this._parent();const e=[{Name:"Actor.Anchor.0",Type:d,Visibility:!1,DefaultValue:(new d).SetValueFrame((new p).SetValueFromVector(new t.Vector3(0,0,0))).GetValue(),visibleInPropertyGroups:!0,GroupId:"3DGrid.Origin"},{Name:"3DGrid.Origin.Position",Type:C,DefaultValue:(new C).GetValue(),visibleInPropertyGroups:!0,GroupId:"3DGrid.Origin"},{Name:"3DGrid.Origin.Local.Position",Type:C,DefaultValue:(new C).GetValue(),visibleInPropertyGroups:!1,GroupId:"3DGrid.Origin"},{Name:"3DGrid.Default.Orientation",Type:u,DefaultValue:"None",visibleInPropertyGroups:!1,GroupId:"3DGrid.Origin"},{Name:"3DGrid.Origin.Show",Type:a,DefaultValue:!0,visibleInPropertyGroups:!0,GroupId:"3DGrid.Origin"},{Name:"Actor.Opacity",DefaultValue:.075},{Name:"Actor.Color",DefaultValue:(new o).FromRGBA(.2,.2,0,1)},{Name:"Actor.IsAlwaysOnTop",DefaultValue:!0},{Name:"3DGrid.Active",DefaultValue:!0,Type:a,visibleInPropertyGroups:!0},{Name:"3DGrid.CellSize",DefaultValue:1},{Name:"3DGrid.Plane.Enable",Type:a,DefaultValue:!0,visibleInPropertyGroups:!1},{Name:"3DGrid.DepthZoom",Type:l,DefaultValue:0,visibleInPropertyGroups:!1,Bounds:{Min:0,Max:30,Step:.01}},{Name:"3DGrid.Texture.RepeatFactor.X",Type:l,DefaultValue:0,visibleInPropertyGroups:!1},{Name:"3DGrid.Texture.RepeatFactor.Y",Type:l,DefaultValue:0,visibleInPropertyGroups:!1},{Name:"3DGrid.Corner.Top.Left",Type:n,DefaultValue:new t.Vector3,visibleInPropertyGroups:!1},{Name:"3DGrid.Corner.Bottom.Left",Type:n,DefaultValue:new t.Vector3,visibleInPropertyGroups:!1},{Name:"3DGrid.Corner.Top.Right",Type:n,DefaultValue:new t.Vector3,visibleInPropertyGroups:!1},{Name:"3DGrid.Corner.Bottom.Right",Type:n,DefaultValue:new t.Vector3,visibleInPropertyGroups:!1},{Name:"3DGrid.Position.Min",Type:n,DefaultValue:new t.Vector3,visibleInPropertyGroups:!1},{Name:"3DGrid.Position.Max",Type:n,DefaultValue:new t.Vector3,visibleInPropertyGroups:!1},{Name:"3DGrid.Vector.X",Type:n,DefaultValue:new t.Vector3,visibleInPropertyGroups:!1},{Name:"3DGrid.Vector.Y",Type:n,DefaultValue:new t.Vector3,visibleInPropertyGroups:!1},{Name:"3DGrid.Width",Type:l,DefaultValue:0,GroupId:"3DGrid.Group.Size",visibleInPropertyGroups:!0},{Name:"3DGrid.Height",Type:l,DefaultValue:0,GroupId:"3DGrid.Group.Size",visibleInPropertyGroups:!0},{Name:"Collab.ListAnchorsIDs",Type:y,DefaultValue:[],visibleInPropertyGroups:!1},{Name:"3DGrid.Snapped.Dressups",Type:y,DefaultValue:[],visibleInPropertyGroups:!1}];this._BuildPropertyValues(e),this.SetPropertyInvisible("Collab.ListAnchorsIDs",!0),this.SetPropertyInvisible("Actor.Position",!0)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Actor.Color",!1),this.SetPropertyInvisible("Actor.Position",!0)},getPropertiesFormatPainter:function(){console.log("Test 3DGrid format painter");let e=[];return e.push("Actor.Color"),e.push("Actor.Opacity"),e.push("Actor.IsAlwaysOnTop"),e},getPropertiesToBePasted:function(e){let t=e.Clone();if(e&&e._map){var i=this.ExperienceBase.getManager("VCXExperience");for(let r in e._map)if(e._map.hasOwnProperty(r)){let o=e.GetProperty(r);if(o){if("Actor.Name"==r)(o=o.Clone()).GetPropertyValue().SetValue(o.GetPropertyValue().GetValue()+" - Copy ("+i._ccp_number+")");else if("Actor.Color"===r){const e=this.ExperienceBase.getManager("VCX3DGridManager");let t=o.GetPropertyValue().GetValue();e&&(t=e.getCurrentColor()),(o=o.Clone()).GetPropertyValue().SetValue(t)}t.AddOrModifyProperty(o)}}return t}}})}),define("DS/VCXWebDressup/VCXCameraModifiable",["DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebTracks/VCXInterpolator","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXProperty"],function(e,t,i,r,o,a,n,s,l,p,u,h){"use strict";return t.extend({init:function(){this._parent(),this._bIsCamera=!0},Build:function(){this._parent();var t=[{Name:"Camera.Position",Type:a,DefaultValue:new e.Matrix4,Persistent:!1,visibleInPropertyGroups:!1},{Name:"Actor.IsActive",Type:n,DefaultValue:!1,Persistent:!1,BehaviorType:1},{Name:"Actor.Anchor.1",Type:o,DefaultValue:(new o).SetValueFrame((new a).SetValueFromVector(new e.Vector3(0,0,0))).GetValue()},{Name:"Actor.Anchor.2",Type:o,DefaultValue:(new o).SetValueFrame((new a).SetValueFromVector(new e.Vector3(0,0,0))).GetValue()},{Name:"Camera.Angle",Type:s,DefaultValue:45,GroupId:"Group.Camera"},{Name:"Camera.Height",Type:s,DefaultValue:400,GroupId:"Group.Camera"},{Name:"Camera.Ortho",Type:n,DefaultValue:!1,GroupId:"Group.Camera"},{Name:"Camera.Arcball",Type:n,DefaultValue:!0,GroupId:"Group.Camera"},{Name:"Camera.Pitch",Type:n,DefaultValue:!0,GroupId:"Group.Camera"},{Name:"Camera.Roll",Type:n,DefaultValue:!0,GroupId:"Group.Camera"},{Name:"Camera.Roll.Angle",Type:s,DefaultValue:0,GroupId:"Group.Camera",Bounds:{Min:-180,Max:180,Step:1}},{Name:"Camera.Yaw",Type:n,DefaultValue:!0,GroupId:"Group.Camera"},{Name:"Camera.LockDistCOI",Type:n,DefaultValue:!1,GroupId:"Group.Camera"},{Name:"Camera.DistCOI",Type:s,DefaultValue:500,GroupId:"Group.Camera"},{Name:"Collab.Gizmo.Show",Type:n,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Collab.Gizmo"},{Name:"Collab.Gizmo.Line.Color",Type:p,DefaultValue:(new r).FromRGBA(1,1,1,1),GroupId:"Group.Collab.Gizmo"},{Name:"Collab.Gizmo.Line.Color.Opacity",Type:s,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Collab.Gizmo"},{Name:"Collab.Gizmo.Line.Width",Type:s,DefaultValue:1,GroupId:"Group.Collab.Gizmo"},{Name:"Collab.ListAnchorsIDs",Type:u,DefaultValue:[1,2],visibleInPropertyGroups:!1}];this._BuildPropertyValues(t)},GetVirtualProperties:function(){var e={"Camera.Position":!0};return e},GetRequiredPropertiesForTransition:function(){var e={"Camera.Position":!0,"Actor.Anchor.1":!0,"Actor.Anchor.2":!0,"Camera.Angle":!0,"Camera.Height":!0,"Camera.Ortho":!0,"Camera.Arcball":!0,"Camera.Pitch":!0,"Camera.Roll":!0,"Camera.Roll.Angle":!0,"Camera.Yaw":!0,"Camera.LockDistCOI":!0,"Camera.DistCOI":!0};return e},GetProperty:function(e){if("Actor.IsActive"===e){var t=null;if(void 0!==this._Properties[e]){var i=this._Properties[e].GetPropertyValue().Clone(),r=this.ExperienceBase.getManager("VCXContextManager").getActiveCamera();i.SetValue(r.GetID()===this.GetObject().GetID()),t=new h(this._Properties[e].GetPropertyInfo(),i)}return t}return this._parent(e)},OnChangeProperty:function(e,t,i){if(i||(i={}),i.fromChildClass);else if(this.OnChangePropertyBegin(e,t))return!0;this._parent(e,t,i);this.ExperienceBase.getManager("VCXVisuManager");"Actor.IsActive"===e&&!0===t.Value&&this.ExperienceBase.getManager("VCXContextManager").setActiveCamera(this.GetObject())},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Collab.ListAnchorsIDs",!0),this.SetPropertyInvisible("Camera.Position",!0),this.SetPropertyInvisible("Actor.Interpolation.Type",!1),this.SetPropertyInvisible("Camera.Angle",this.GetPropertyValue("Camera.Ortho")),this.SetPropertyInvisible("Camera.Height",!this.GetPropertyValue("Camera.Ortho")),this.SetPropertyInvisible("Camera.Pitch",this.GetPropertyValue("Camera.Arcball")),this.SetPropertyInvisible("Camera.Roll",this.GetPropertyValue("Camera.Arcball")),this.SetPropertyInvisible("Camera.Yaw",this.GetPropertyValue("Camera.Arcball")),this.SetPropertyInvisible("Camera.LockDistCOI",this.GetPropertyValue("Camera.Arcball")),this.SetPropertyInvisible("Camera.DistCOI",this.GetPropertyValue("Camera.Arcball")||!this.GetPropertyValue("Camera.LockDistCOI")),this.SetPropertyInvisible("Camera.Roll.Angle",this.GetPropertyValue("Camera.Arcball")||this.GetPropertyValue("Camera.Roll"))},OnChangePropertiesEnd:function(){this._parent(),this.GetObject().updatePosition()},GetInterpolator:function(e){var t=this.QueryInterface("VCXIViewpointController");if(t)return t.GetInterpolator(e)}})}),define("DS/VCXWebDressup/VCX3DAlignerModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueMap","DS/VCXWebProperties/VCXPropertyValueVector"],function(e,t,i,r,o,a,n,s){"use strict";return e.extend({init:function(){this._bIs3DAligner=!0,this._parent()},Build:function(){this._parent();var e=[{Name:"Actor.Anchor.0",Type:a,Visibility:!1,DefaultValue:(new a).SetValueFrame((new o).SetValueFromVector(new t.Vector3(0,0,0))).GetValue(),visibleInPropertyGroups:!1},{Name:"Alignment.Enable",Type:r,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Alignment"},{Name:"Alignment.Locked",Type:r,DefaultValue:!1,GroupId:"Group.Alignment"},{Name:"Actor.ListActors",Type:n,GroupId:"Group.Alignment",visibleInPropertyGroups:!1},{Name:"Collab.ListAnchorsIDs",Type:s,DefaultValue:[0],visibleInPropertyGroups:!1}];this._BuildPropertyValues(e)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Actor.Color",!0),this.SetPropertyInvisible("Actor.Opacity",!0),this.SetPropertyInvisible("Actor.IsAlwaysOnTop",!0)}})}),define("DS/VCXWebDressup/VCXViewpointModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValuePoint","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables"],function(e,t,i,r,o,a,n,s,l,p){"use strict";return e.extend({init:function(){this._parent()},Dispose:function(){this._parent(),this.viewport=null,delete this._currentAmbienceIDXs},Build:function(){this._parent();var e=[{Name:"Actor.Name",Type:n,DefaultValue:"Viewpoint",i18n:p,visibleInPropertyGroups:!1},{Name:"Camera.Position",Type:o,DefaultValue:new t.Matrix4,Persistent:!1,hiddenFields:["Orientation","Scale"],GroupId:"Group.Camera",visibleInPropertyGroups:!1},{Name:"Camera.Position.Frame",Type:l,Persistent:!1,GroupId:"Group.Camera"},{Name:"Camera.Target.Frame",Type:l,Persistent:!1,GroupId:"Group.Camera"},{Name:"Camera.Dolly",Type:i,Persistent:!0,GroupId:"Group.Camera"},{Name:"Actor.Anchor.1",Type:a,DefaultValue:(new a).SetValueFrame((new o).SetValueFromVector(new t.Vector3(0,0,0))).GetValue(),Persistent:!1},{Name:"Actor.Anchor.2",Type:a,DefaultValue:(new a).SetValueFrame((new o).SetValueFromVector(new t.Vector3(0,0,0))).GetValue(),Persistent:!1},{Name:"Collab.ListAnchorsIDs",Type:s,DefaultValue:[1,2],visibleInPropertyGroups:!1},{Name:"Camera.Focal.Length",Type:r,GroupId:"Group.Camera",Persistent:!1,Bounds:{Min:10,Max:600,Step:1}},{Name:"Camera.Angle",Type:r,DefaultValue:45,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.Height",Type:r,DefaultValue:400,GroupId:"Group.Camera",Persistent:!1},{Name:"Camera.Ortho",Type:i,DefaultValue:!1,GroupId:"Group.Camera",Persistent:!1},{Name:"Camera.Arcball",Type:i,DefaultValue:!0,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.Pitch",Type:i,DefaultValue:!0,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.Roll",Type:i,DefaultValue:!1,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.Roll.Angle",Type:r,DefaultValue:0,GroupId:"Group.Camera",Persistent:!1,Bounds:{Min:-179,Max:180,Step:1}},{Name:"Camera.Yaw",Type:i,DefaultValue:!0,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.LockDistCOI",Type:i,DefaultValue:!1,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Camera.DistCOI",Type:r,DefaultValue:500,GroupId:"Group.Camera",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Actor.Color",visibleInPropertyGroups:!1},{Name:"Actor.Opacity",visibleInPropertyGroups:!1},{Name:"Actor.IsAlwaysOnTop",visibleInPropertyGroups:!1}];this._BuildPropertyValues(e),this.SetPropertyInvisible("Collab.ListAnchorsIDs",!0),this.viewport=null;let u=this.GetObject()._experienceBase.ComponentsMap.GetComponentFromType("VCXViewport_Spec");u&&u.length>0&&(this.viewport=u[0])},GetVirtualProperties:function(){var e={"Camera.Position":!0};return e},GetRequiredPropertiesForTransition:function(){let e=this.viewport.QueryInterface("VCXIModifiable");return e&&e.GetRequiredPropertiesForTransition?e.GetRequiredPropertiesForTransition():(console.warn("no viewportModifiable found"),null)},SetPropertiesInfo:function(){if(this._parent(),!this.viewport)return;let t=this.viewport.QueryInterface("VCXIModifiable");t&&(this.SetPropertyInvisible("Camera.Focal.Length",t.GetPropertyValue("Camera.Ortho")),this.SetPropertyInvisible("Camera.Height",!t.GetPropertyValue("Camera.Ortho"))),this.ChangeGroupAvailability("Group.Actions",e.EAvailability.AppForceNotAvailable)},GetProperties:function(e){let t=this.viewport.QueryInterface("VCXIModifiable");return t&&t.GetProperties?t.GetProperties(e):(console.warn("no viewportModifiable found"),null)},GetProperty:function(e){if(!this.viewport)return;let t=this.viewport.QueryInterface("VCXIModifiable");return t&&t.GetProperty?t.GetProperty(e):(console.warn("no viewportModifiable found"),null)},RequestModification:function(e,t){let i=this.viewport.QueryInterface("VCXIModifiable");return i&&i.RequestModification?i.RequestModification(e,t):(console.warn("no viewportModifiable found"),null)},OnChangeProperty:function(e,t,i){if(!this.viewport)return;let r=this.viewport.QueryInterface("VCXIModifiable");return r&&r.OnChangeProperty?r.OnChangeProperty(e,t,i):(console.warn("no viewportModifiable found"),null)},OnChangePropertiesEnd:function(){this._parent();let e=this.viewport.QueryInterface("VCXIModifiable");return e&&e.OnChangePropertiesEnd?e.OnChangePropertiesEnd():(console.warn("no viewportModifiable found"),null)},GetInterpolator:function(e){let t=this.viewport.QueryInterface("VCXIModifiable");return t&&t.GetInterpolator?t.GetInterpolator(e):(console.warn("no viewportModifiable found"),null)}})}),define("DS/VCXWebDressup/VCXAmbienceModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/CoreEvents/Events","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValuePoint","DS/Visualization/ThreeJS_DS"],function(e,t,i,r,o,a){"use strict";return e.extend({init:function(){this._parent(),this._bIsGround=!0,this._envMapNeverLoaded=!1},Build:function(){this._parent();var e=[{Name:"Actor.Opacity",visibleInPropertyGroups:!1},{Name:"Ambience.Lighting.Exposure",Type:r,DefaultValue:0,Bounds:{Min:-9,Max:9,Step:.1},GroupId:"Group.Ambience.Lighting",FormatPainter:!0},{Name:"Ambience.Lighting.Rotation",Type:r,DefaultValue:0,Bounds:{Min:-180,Max:180,Step:1},GroupId:"Group.Ambience.Lighting",FormatPainter:!0},{Name:"Ambience.Background.Show",Type:i,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Ambience.Background",FormatPainter:!0},{Name:"Ambience.Background.Finite",Type:i,DefaultValue:!0,GroupId:"Group.Ambience.Background",FormatPainter:!0},{Name:"Ambience.Background.Radius.Auto",Type:i,DefaultValue:!0,GroupId:"Group.Ambience.Background",FormatPainter:!0},{Name:"Ambience.Background.Radius.FinalValue",Type:r,DefaultValue:15e3,GroupId:"Group.Ambience.Background",FormatPainter:!0,visibleInPropertyGroups:!1},{Name:"Ambience.Background.Radius",Type:r,DefaultValue:15e3,GroupId:"Group.Ambience.Background",FormatPainter:!0},{Name:"Ambience.Background.Rotation",Type:r,DefaultValue:0,Bounds:{Min:-180,Max:180,Step:1},GroupId:"Group.Ambience.Background",FormatPainter:!0,visibleInPropertyGroups:!1},{Name:"Ambience.Background.Position.Auto",Type:i,DefaultValue:!0,GroupId:"Group.Ambience.Background",FormatPainter:!0},{Name:"Ambience.Background.Position.FinalValue",Type:o,DefaultValue:new a.Vector3,GroupId:"Group.Ambience.Background",FormatPainter:!0,visibleInPropertyGroups:!1},{Name:"Ambience.Background.Position",Type:o,DefaultValue:new a.Vector3,GroupId:"Group.Ambience.Background",FormatPainter:!0},{Name:"Ambience.Background.Exposure",Type:r,DefaultValue:0,Bounds:{Min:-9,Max:9,Step:.1},GroupId:"Group.Ambience.Background",FormatPainter:!0,visibleInPropertyGroups:!1},{Name:"Ambience.Ground.Scaleratio",Type:r,DefaultValue:.8,Bounds:{Min:.01,Max:6,Step:.1},GroupId:"Group.Ambience.Ground",FormatPainter:!0},{Name:"Ambience.Ground.Offset",Type:r,DefaultValue:0,GroupId:"Group.Ambience.Ground",FormatPainter:!0},{Name:"Ambience.Ground.Reflectivity",Type:r,DefaultValue:0,Bounds:{Min:0,Max:100,Step:.1},GroupId:"Group.Ambience.Ground",FormatPainter:!0},{Name:"Ambience.Ground.Glossiness",Type:r,DefaultValue:0,Bounds:{Min:0,Max:100,Step:.1},GroupId:"Group.Ambience.Ground",FormatPainter:!0},{Name:"Ambience.Ground.ShadowIntensity",Type:r,DefaultValue:0,Bounds:{Min:0,Max:100,Step:.1},GroupId:"Group.Ambience.Ground",FormatPainter:!0}];this._BuildPropertyValues(e)},OnChangePropertiesEnd:function(){t.publish({event:"VCX_ENVIRONNEMENT_PROPERTY_CHANGED"}),this._parent()},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Actor.Color",!0),this.GetProperty("Actor.Color").GetPropertyInfo()._bPersistent=!1,this.SetPropertyInvisible("Actor.Color.Defined",!0),this.GetProperty("Actor.Color.Defined").GetPropertyInfo()._bPersistent=!1,this.SetPropertyInvisible("Actor.Opacity",!0),this.GetProperty("Actor.Opacity").GetPropertyInfo()._bPersistent=!1,this.SetPropertyInvisible("Actor.IsAlwaysOnTop",!0),this.GetProperty("Actor.IsAlwaysOnTop").GetPropertyInfo()._bPersistent=!1,this.GetPropertyValue("Ambience.Background.Finite")?(this.SetPropertyInvisible("Ambience.Background.Position.Auto",!1),this.SetPropertyInvisible("Ambience.Background.Radius.Auto",!1),this.SetPropertyInvisible("Ambience.Background.Position",this.GetPropertyValue("Ambience.Background.Position.Auto")),this.SetPropertyInvisible("Ambience.Background.Radius",this.GetPropertyValue("Ambience.Background.Radius.Auto"))):(this.SetPropertyInvisible("Ambience.Background.Position.Auto",!0),this.SetPropertyInvisible("Ambience.Background.Radius.Auto",!0),this.SetPropertyInvisible("Ambience.Background.Position",!0),this.SetPropertyInvisible("Ambience.Background.Radius",!0)),this.ChangeGroupAvailability("Group.Actions",e.EAvailability.AppForceNotAvailable)},RequestModification:function(e,t){if(e){var i=e.GetPropertyInfo().GetPropertyName();if("Ambience.Lighting.Exposure"===i)return t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Ambience.Background.Exposure",e.GetPropertyValue().Value)),t.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,t);if("Ambience.Background.Exposure"===i)return t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Ambience.Lighting.Exposure",e.GetPropertyValue().Value)),t.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,t);if("Ambience.Lighting.Rotation"===i)return t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Ambience.Background.Rotation",e.GetPropertyValue().Value)),t.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,t);if("Ambience.Background.Rotation"===i)return t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Ambience.Lighting.Rotation",e.GetPropertyValue().Value)),t.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,t)}return this._parent(e,t)}})}),define("DS/VCXWebDressup/VCXPolylineModifiable",["DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXDressup_Spec","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueVector"],function(e,t,i,r,o,a,n,s,l,p,u){"use strict";return i.extend({init:function(){this._bIsPolyline=!0,this._parent()},Build:function(){this._parent();var t=this._generateMapChoiceFromEnumAndId(e.ELineType,"Collab.DashType"),i=[{Name:"Actor.IsAlwaysOnTop",DefaultValue:!0},{Name:"Polyline.Is.Closed",Type:o,DefaultValue:!1},{Name:"Collab.Body.Line.UseHiddenStyle",Type:o,DefaultValue:!1,visibleInPropertyGroups:!1},{Name:"Collab.Body.Line.Color",Type:s,DefaultValue:(new r).FromRGBA(0,0,0,1),GroupId:"Group.FrontLine",FormatPainter:!0},{Name:"Collab.Body.Line.Color.Opacity",Type:n,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.FrontLine",FormatPainter:!0},{Name:"Collab.Body.Line.Width",Type:n,DefaultValue:2,GroupId:"Group.FrontLine",FormatPainter:!0},{Name:"Collab.Body.Line.Type",Type:l,DefaultValue:e.ELineType.Plain,GroupId:"Group.FrontLine",MapChoice:t,FormatPainter:!0},{Name:"Collab.Body.Line.StipplingMotif",Type:p,DefaultValue:"0",GroupId:"Group.FrontLine",FormatPainter:!0},{Name:"Collab.Body.Line.Back.Color",Type:s,DefaultValue:(new r).FromRGBA(.5,.5,.5,1),GroupId:"Group.BackLine",FormatPainter:!0},{Name:"Collab.Body.Line.Back.Color.Opacity",Type:n,DefaultValue:.5,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.BackLine",FormatPainter:!0},{Name:"Collab.Body.Line.Back.Type",Type:l,DefaultValue:e.ELineType.SmallDash,GroupId:"Group.BackLine",MapChoice:t,FormatPainter:!0},{Name:"Collab.Body.Line.Back.Width",Type:n,DefaultValue:1.5,GroupId:"Group.BackLine",FormatPainter:!0},{Name:"Collab.Body.Line.Back.StipplingMotif",Type:p,DefaultValue:"0",GroupId:"Group.BackLine",FormatPainter:!0},{Name:"Collab.ListAnchorsIDs",Type:u,DefaultValue:[],visibleInPropertyGroups:!1}];this._BuildPropertyValues(i)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Actor.Color",!0),this.GetProperty("Actor.Color").GetPropertyInfo()._bPersistent=!1,this.SetPropertyInvisible("Collab.Body.Line.UseHiddenStyle",!0),this.SetPropertyInvisible("Collab.Body.Line.StipplingMotif",this.GetPropertyValue("Collab.Body.Line.Type")!==e.ELineType.UserDefined),this.SetPropertyInvisible("Collab.Body.Line.Back.StipplingMotif",this.GetPropertyValue("Collab.Body.Line.Back.Type")!==e.ELineType.UserDefined),this.SetPropertyInvisible("Collab.ListAnchorsIDs",!0)},GetProperty:function(e){return"Actor.Color"===e?this.GetNewProperty(e,this.GetPropertyValue("Collab.Body.Line.Color")):this._parent(e)},RequestModification:function(e,t){if(e&&"Actor.Color"===e.GetPropertyInfo().GetPropertyName()){var i=e.GetPropertyValue().Value.getAssociatedColors();return t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Body.Line.Color",i.body)),t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Body.Line.Back.Color",i.border)),this._parent(e,t)}return this._parent(e,t)}})}),define("DS/VCXWebDressup/VCXCompassModifiable",["DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValuePoint","DS/VCXWebProperties/VCXPropertyValuePoint2D","DS/VCXWebProperties/VCXPropertyValueDocId","DS/VCXWebProperties/VCXPropertyValueFrame","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables"],function(e,t,i,r,o,a,n,s,l,p,u,h){"use strict";return t.extend({init:function(){this._parent()},Build:function(){this._parent();var t=this.GetProperties();if(t)for(var i in t._map){var l=this.GetProperty(i);l&&l.GetPropertyInfo()&&l.GetPropertyInfo().SetVisible(!1)}var d=[{Name:"Actor.Name",Type:r,DefaultValue:"Compass",i18n:h},{Name:"Actor.Visibility.Opacity",Type:n,DefaultValue:1,i18n:h},{Name:"Compass.GeomPath",Type:p,DefaultValue:-1,GroupId:"Group.Compass.General",BehaviorType:1},{Name:"Compass.AbsoluteSize",Type:o,DefaultValue:!1,GroupId:"Group.Compass.Size",BehaviorType:1},{Name:"Compass.Size",Type:n,DefaultValue:.1,Bounds:{Min:0,Max:1,Step:.1},GroupId:"Group.Compass.Size",BehaviorType:1},{Name:"Compass.SizePixel",Type:a,DefaultValue:300,GroupId:"Group.Compass.Size",BehaviorType:1},{Name:"Compass.Translation",Type:s,DefaultValue:new e.Vector3(0,0,0),BehaviorType:1},{Name:"Compass.Alignment",Type:u,DefaultValue:new e.Matrix4,BehaviorType:1}];if(void 0!==this.GetObject()._experienceBase.odt){var c={Name:"Compass.ODT.CustomRobotState",Type:o,DefaultValue:!1,GroupId:"Group.Compass.General",BehaviorType:1},y={Name:"Compass.ODT.CustomRobotGeomNodesNumber",Type:a,DefaultValue:0,GroupId:"Group.Compass.General",BehaviorType:1};d.push(c),d.push(y)}this._BuildPropertyValues(d),this.GetProperty("Compass.Translation").GetPropertyInfo().SetVisible(!1),this.GetProperty("Compass.Alignment").GetPropertyInfo().SetVisible(!1)},GetProperty:function(e){if(void 0!==this.GetObject()._experienceBase.odt){var t=null,r=this._Properties[e],n=this.ExperienceBase.getManager("VCXContextManager").getMainViewer().getCustomReferenceAxisSystem();switch(e){case"Compass.ODT.CustomRobotState":var s=new o;s.SetValue(null!==n),t=new i(r.GetPropertyInfo(),s);break;case"Compass.ODT.CustomRobotGeomNodesNumber":var l=new a;if(l.SetValue(0),t=new i(r.GetPropertyInfo(),l),n){var p=n.node,u=p&&p.children?p.children[0]:null;l.SetValue(u&&u.children?u.children.length:0)}}if(t)return t}return this._parent(e)}})}),define("DS/VCXWebDressup/VCXRenderingFeatureModelModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/CoreEvents/Events","DS/VCXWebDressup/VCXViewport_Spec","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValuePoint","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXColor","DS/Visualization/ThreeJS_DS"],function(e,t,i,r,o,a,n,s,l,p,u,h,d,c,y){"use strict";return e.extend({init:function(){this._parent(),this._bIsGround=!0,this._envMapNeverLoaded=!1},Build:function(){this._parent();let e=this.QueryInterface("CATI3DExpVCXObjectConvertor").getTab();var t=[];e.forEach(e=>{let i={Name:e.propertyName,Type:e.typeProperty,GroupId:"Group.Material",FormatPainter:!0};"Material.metallic"===e.propertyName&&(i.DefaultValue=.3),t.push(i)}),this._BuildPropertyValues(t)},OnChangeProperty:function(e,t,i){this._object.dirty=!0,this._parent(e,t,i)},OnChangePropertiesEnd:function(){this._object.dirty=!0,this._parent()},SetPropertiesInfo:function(){this._parent(),this.ChangeGroupAvailability("Group.Actions",e.EAvailability.AppForceNotAvailable)},RequestModification:function(e,t){if(e)e.GetPropertyInfo().GetPropertyName();return this._parent(e,t)}})}),define("DS/VCXWebDressup/VCXDressupModifiableView",["DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebExperienceBase/VCXModifiableViewOccurrenceExperience","DS/VCXWebProperties/VCXPropertyGroup","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup"],function(e,t,i,r,o){"use strict";var a=t.extend({init:function(){this._parent()},SetPropertiesViewInfo:function(){},getPropertyGroupsi18n:function(){return o},GetPropertyGroupVisibility:function(e){var t=this.QueryInterface("VCXIModifiable")._PropertyGroups[e];if(t){if(!1===t.availability||!1===t.visibility)return!1}else console.warn("Does the property group "+e+" exists ?");return!0},getPropertyGroups:function(e){e||(e={});var t=this.QueryInterface("VCXIModifiable");t.SetPropertiesInfo(),this._parent(e);var o=this.getGroupPropertiesOrders();for(var a in e["Group.Essentials"]||(e["Group.Essentials"]=new i({groupID:"Group.Essentials"}),e["Group.Essentials"].i18nGroup=r),e["Group.Essentials"].setPropertiesOrder(o["Group.Essentials"]),e["Group.Essentials"].priority=0,e["Group.Essentials"].addProperties([{propertyName:"Actor.Color",i18n:r}]),t._PropertyGroups)if(t._PropertyGroups.hasOwnProperty(a))if(!1!==t._PropertyGroups[a].availability)if(e.hasOwnProperty(a)){var n=t._PropertyGroups[a].PropertyControlingGroupAvailability||e[a].PropertyControlingGroupAvailability,s=t._PropertyGroups[a].PropertyControlingGroupVisibility||e[a].PropertyControlingGroupVisibility;const i=e[a]._propertiesInfos;for(const i in t._PropertyGroups[a])e[a][i]=t._PropertyGroups[a][i];for(const t in i)e[a]._propertiesInfos[t]||(e[a]._propertiesInfos[t]=i[t]);e[a].PropertyControlingGroupAvailability=n,e[a].PropertyControlingGroupVisibility=s}else e[a]=t._PropertyGroups[a];else delete e[a];var l=null;if(this._getGroupsPriorities?l=this._getGroupsPriorities():console.warn("Missing _getGroupsPriorities method for component "+this.GetObject().GetType()+" !!"),l)for(var a in e)e.hasOwnProperty(a)&&l&&"number"==typeof l[a]&&(e[a].priority=l[a]);return e},getGroupPropertiesOrders:function(){var e={"Group.Essentials":["Actor.Name","Modifiable.Style","Actor.Color","Actor.Opacity"]},t=this._parent()||{};for(const i in e)t[i]=e[i];return t},SetPropertyInvisible:function(e,t){var i=this._getPropertyGroupFromPropertyName(e);i&&i.setVisible(e,!t)},SetPropertyLocked:function(e,t){var i=this._getPropertyGroupFromPropertyName(e);i&&i.setLocked(e,t)},IsPropertyLocked:function(e){var t=this._getPropertyGroupFromPropertyName(e);return t&&t.isLocked(e)},_getPropertyGroupFromPropertyName:function(e){var t=this.QueryInterface("VCXIModifiable"),r=t.GetProperty(e);if(r){var o=r.GetPropertyInfo().GetGroupId();return o||(o="Group.Essentials"),t._PropertyGroups[o]||(t._PropertyGroups[o]=new i({groupID:o})),t._PropertyGroups[o]}},ChangeGroupAvailability:function(t,r){if(Object.values(e.EAvailability).includes(r)){var o=this.QueryInterface("VCXIModifiable"),a=o._PropertyGroups[t];a||(o._PropertyGroups[t]=new i({groupID:t}),a=o._PropertyGroups[t]);var n=a.PropertyControlingGroupAvailability,s=o._Properties[n];s&&s.GetPropertyValue().SetValue(r),r===e.EAvailability.AppForceAvailable?a.availability=!0:r===e.EAvailability.AppForceNotAvailable?a.availability=!1:a.availability=void 0}},getCollapsedGroupsNames:function(){return["Group.Actions"]}});return a.prototype._getGroupsPriorities=function(){return{"Group.Essentials":0}},a}),define("DS/VCXWebDressup/VCXViewportModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],function(e){"use strict";return e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e={"Group.Camera":["Camera.Ortho","Camera.Height","Camera.Focal.Length","Camera.Angle","Camera.Dolly","Camera.Position.Frame","Camera.Target.Frame","Camera.Arcball","Camera.Pitch","Camera.Roll","Camera.Roll.Angle","Camera.Yaw","Camera.LockDistCOI","Camera.DistCOI"],"Group.Paper":["Paper.Width","Paper.Height","Paper.Orientation"],"Group.Environment":["Viewport.ActiveAmbience","Viewport.ActiveAmbience.IDX","Viewport.ActiveCamera","Environment.Vertical"],"Group.Environment.Background":["Environment.Background.Color","Environment.Background.Color.Opacity","Environment.Background.Image","Environment.Background.Gradient","Environment.Background.Foot.Color"],"Group.Environment.Effects":["Environment.Shadow","Environment.AA","Environment.SSAO","Environment.Vignetting","Environment.DOF","Environment.Bloom","Environment.Flare","Environment.BackFaceCulling"],"Group.Render":["Render.Mode","Render.OutlineType","Render.ShowConstructions"],"Group.Render.Lighting":["Render.Lighting.Intensity","Render.Lighting.Mode"],"Group.Environment.Debug":["Environment.Debug.Availability","Environment.Debug.Show","Environment.Debug.ShadowLight","Environment.Debug.BSphere","Environment.Debug.PrimitiveBSphere","Environment.Debug.RepBBox","Environment.Debug.Picking","Environment.Debug.Normals","Environment.Debug.PickHybrid","Environment.Debug.PostProcessing","Environment.Debug.ShadowMaps","Environment.Debug.FPS","Render.PixelCulling"]},t=this._parent()||{};for(const i in e)t[i]=e[i];return t}})}),define("DS/VCXWebDressup/VCXAmbienceModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],function(e){"use strict";var t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{"Group.Ambience.Lighting":["Ambience.Lighting.Exposure","Ambience.Lighting.Rotation"],"Group.Ambience.Background":["Ambience.Background.Show","Ambience.Background.Finite","Ambience.Background.Radius.Auto","Ambience.Background.Radius","Ambience.Background.Position.Auto","Ambience.Background.Position"],"Group.Ambience.Ground":["Ambience.Ground.Scaleratio","Ambience.Ground.Offset","Ambience.Ground.Reflectivity","Ambience.Ground.Glossiness","Ambience.Ground.ShadowIntensity"]}),e}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.Ambience.Lighting":10,"Group.Ambience.Background":20,"Group.Ambience.Ground":30}),i},t}),define("DS/VCXWebDressup/VCXRenderingFeatureModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],function(e){"use strict";var t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{}),e}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0}),i},t}),define("DS/VCXWebDressup/VCXMagnetLineModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],function(e){"use strict";var t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e={"Group.Essentials":["Actor.Name","Actor.Color","MagnetLine.Magnetic"],"Group.Position":["MagnetLine.Length","MagnetLine.Rotation"]},t={};for(const i in e)t[i]=e[i];return t}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.Position":20}),i},t}),define("DS/VCXWebDressup/VCX3DGridModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],function(e){"use strict";const t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){const e={"Group.3DGrid":[],"3DGrid.Group.Size":["3DGrid.Width","3DGrid.Height"],"3DGrid.Origin":["Actor.Position","3DGrid.Origin.Show"]},t=this._parent()||{};for(const i in e)t[i]=e[i];return t}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"3DGrid.Group.Size":10,"3DGrid.Origin":20}),i},t}),define("DS/VCXWebDressup/VCXCompassModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],function(e){"use strict";return e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e={"Group.Compass.General":["Compass.GeomPath","Compass.ODT.CustomRobotState","Compass.ODT.CustomRobotGeomNodesNumber"],"Group.Compass.Size":["Compass.AbsoluteSize","Compass.Size","Compass.SizePixel"]},t=this._parent()||{};for(const i in e)t[i]=e[i];return t}})}),define("DS/VCXWebDressup/VCXPolylineModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],function(e){"use strict";var t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e={"Group.Essentials":["Actor.Name","Modifiable.Style","Actor.Color","Actor.Opacity","Polyline.Is.Closed","Collab.Body.Line.UseHiddenStyle"],"Group.FrontLine":["Collab.Body.Line.Color","Collab.Body.Line.Width","Collab.Body.Line.Color.Opacity","Collab.Body.Line.Type","Collab.Body.Line.StipplingMotif"],"Group.BackLine":["Collab.Body.Line.Back.Color","Collab.Body.Line.Back.Width","Collab.Body.Line.Back.Color.Opacity","Collab.Body.Line.Back.Type","Collab.Body.Line.Back.StipplingMotif"]},t=this._parent()||{};for(const i in e)t[i]=e[i];return t}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.FrontLine":10,"Group.BackLine":20,"Group.Actions":30}),i},t}),define("DS/VCXWebDressup/VCXViewpointModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],function(e){"use strict";return e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e={"Group.Camera":["Camera.Ortho","Camera.Height","Camera.Focal.Length","Camera.Angle","Camera.Dolly","Camera.Position.Frame","Camera.Target.Frame","Camera.Arcball","Camera.Pitch","Camera.Roll","Camera.Roll.Angle","Camera.Yaw","Camera.LockDistCOI","Camera.DistCOI"]},t=this._parent()||{};for(const i in e)t[i]=e[i];return t}})}),define("DS/VCXWebDressup/VCXCircleModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],function(e){"use strict";var t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e={"Group.Circle":["Circle.Radius","Collab.Background.Color","Collab.Background.Color.Opacity","Circle.Background.Type","Circle.Thickness","Collab.3D.Paper.Billboard.Type"],"Group.CircleBorder":["Collab.Body.Line.Color","Collab.Body.Line.Color.Opacity","Collab.Body.Line.Width","Collab.Body.Line.Type"]},t=this._parent()||{};for(const i in e)t[i]=e[i];return t}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.Circle":10,"Group.CircleBorder":20,"Group.Actions":30}),i},t}),define("DS/VCXWebDressup/VCXSectionModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],function(e){"use strict";var t=e.extend({init:function(){this._parent(),this._bIsSection=!0},getGroupPropertiesOrders:function(){var e={"Group.Section":["Section.AutoFlip","Section.SpaceBackAlpha","Section.SpaceFrontAlpha"],"Group.Section.Capping":["Section.Capping.Color","Section.Capping.ActorColor"],"Group.Section.Hatching":["Section.Hatching.Color","Section.Hatching.Frequency","Section.Hatching.Angle"],"Group.Section.Plane":["Section.Plane.Enable","Actor.Color","Actor.Opacity","Actor.IsAlwaysOnTop"]},t=this._parent()||{};for(const i in e)t[i]=e[i];return t}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.Section.Plane":10,"Group.Section":20,"Group.Section.Capping":30,"Group.Section.Hatching":40,"Group.Actions":100}),i},t}),define("DS/VCXWebDressup/VCXRedLineModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],function(e){"use strict";var t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e={"Group.Line":["Actor.Color","Collab.Body.Line.Width"]},t=this._parent()||{};for(const i in e)t[i]=e[i];return t}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.Line":10}),i},t}),define("DS/VCXWebDressup/VCX3DAlignerModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],function(e){"use strict";return e.extend({init:function(){this._parent(),this._bIs3DAligner=!0},getGroupPropertiesOrders:function(){return this._parent()||{}}})}),define("DS/VCXWebDressup/VCXCameraModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],function(e){"use strict";return e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e={"Group.Camera":["Camera.Angle","Camera.Height","Camera.Ortho","Camera.Arcball","Camera.Pitch","Camera.Roll","Camera.Roll.Angle","Camera.Yaw","Camera.LockDistCOI","Camera.DistCOI"],"Group.Collab.Gizmo":["Collab.Gizmo.Line.Color","Collab.Gizmo.Line.Color.Opacity","Collab.Gizmo.Line.Width"]},t=this._parent()||{};for(const i in e)t[i]=e[i];return t}})}),define("DS/VCXWebDressup/VCXMarkupModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],function(e){"use strict";return e.extend({init:function(){this._parent()},SetPropertiesViewInfo:function(){this._parent()},getGroupPropertiesOrders:function(){var e={"Group.Essentials":["Actor.Name","Modifiable.Style","Actor.Color","Actor.Opacity","Collab.Text"],"Group.Text":["Collab.Text.Color","Collab.Text.Color.Opacity","Collab.Text.Font","Collab.Text.SizeToFit","Collab.Text.html"],"Group.Paragraph":["Collab.Text.ParagraphSpacing","Collab.Text.HAlignment","Collab.Text.VAlignment"],"Group.Body":["Collab.Body.Shape","Collab.Body.Width","Collab.Body.Height","Collab.3D.Paper.Is.Background","Collab.Body.HAlignment","Collab.Body.VAlignment"],"Group.Background":["Collab.Background.Color","Collab.Background.Color.Opacity","Collab.Body.InnerMargin"],"Group.Image":["Collab.PIP.Scenario","Collab.Image.Doc.ID","Collab.Image.DPI","Collab.Image.Transparency"],"Group.Position":["Collab.3D.Paper.Positioning.Type","Collab.3D.Paper.Paper.Position.X","Collab.3D.Paper.Paper.Position.Y","Collab.3D.Paper.3D.Text.Position","Collab.3D.Paper.Depth"],"Group.Border":["Collab.Border.Line.Color","Collab.Border.Line.Color.Opacity","Collab.Border.Line.Width"],"Group.Attach":["Collab.Attach.Line.Color","Collab.Attach.Line.Color.Opacity","Collab.Attach.LeadType","Collab.Attach.ExtremityType","Collab.Attach.BentDot","Collab.Attach.Line.Width","Collab.Attach.Line.Type"],"Group.Shadow":["Collab.Body.Shadow.Opacity","Collab.Body.Shadow.Distance","Collab.Body.Shadow.Orientation","Collab.Body.Shadow.Blur"],"Group.BOM":["Collab.BOM.FilterOnVisibleCallouts","Collab.BOM.Header.Text.Color","Collab.BOM.Header.Background.Color","Collab.BOM.OddRow.Background.Color","Collab.BOM.EvenRow.Background.Color"],"Group.Measurement":["Collab.Measurement.DisplayValue","Collab.Measurement.PreSymbol","Collab.Measurement.PreString","Collab.Measurement.MiddleSymbol","Collab.Measurement.MiddleString","Collab.Measurement.PostSymbol","Collab.Measurement.PostString","Collab.Measurement.Value","Collab.Measurement.Length","Collab.Measurement.Length1","Collab.Measurement.Length2","Collab.Measurement.Radius","Collab.Measurement.Radius1","Collab.Measurement.Radius2","Collab.Measurement.Area","Collab.Measurement.Volume","Collab.Measurement.ShowConstructionLines","Collab.Measurement.ShowRedlines","Collab.Measurement.ShowPlanes","Collab.Measurement.ShowEndPoints","Collab.Measurement.Type"]},t=this._parent()||{};for(const i in e)t[i]=e[i];return t},getAdditionalPropertySettings:function(e){var t=this._parent()||{};return t["Collab.Text"]={displayStyle:"editorInline"},t}})}),define("DS/VCXWebDressup/VCXPanelModifiableView",["DS/VCXWebDressup/VCXMarkupModifiableView","DS/VCXWebDressup/VCXPanel_Spec"],function(e,t){"use strict";var i=e.extend({init:function(){this._parent()},getCollapsedGroupsNames:function(){return this._parent().concat(["Group.Position","Group.Border","Group.Attach","Group.Shadow","Group.Effect"])}});return i.prototype._getGroupsPriorities=function(i){var r=this.QueryInterface("VCXIModifiable"),o=e.prototype._getGroupsPriorities();return r.GetPropertyValue("Collab.Markup.SubType")===t.ESubType.Image?UWA.extend(o,{"Group.Essentials":0,"Group.Image":10,"Group.Body":15,"Group.Border":20,"Group.Position":30,"Group.Shadow":40,"Group.Effect":80,"Group.Actions":100}):r.GetPropertyValue("Collab.Markup.SubType")===t.ESubType.Text?UWA.extend(o,{"Group.Essentials":0,"Group.Text":10,"Group.Paragraph":15,"Group.Background":20,"Group.Body":30,"Group.Border":40,"Group.Position":50,"Group.Shadow":60,"Group.Actions":100,"Group.Effect":110}):UWA.extend(o,{"Group.Essentials":0,"Group.Text":10,"Group.Paragraph":15,"Group.Image":18,"Group.Background":20,"Group.Body":30,"Group.Border":40,"Group.Position":50,"Group.Attach":60,"Group.Shadow":70,"Group.Actions":100,"Group.Effect":110}),o},i}),define("DS/VCXWebDressup/VCXLabelModifiableView",["DS/VCXWebDressup/VCXMarkupModifiableView"],function(e){"use strict";var t=e.extend({init:function(){this._parent()},getCollapsedGroupsNames:function(){return this._parent().concat(["Group.Paragraph","Group.Position","Group.Border","Group.Attach","Group.Shadow","Group.Effect"])}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.Text":10,"Group.Background":20,"Group.Body":25,"Group.Paragraph":30,"Group.Position":40,"Group.Border":50,"Group.Attach":60,"Group.Shadow":70,"Group.Effect":80,"Group.Actions":100}),i},t}),define("DS/VCXWebDressup/VCXPartListModifiableView",["DS/VCXWebDressup/VCXMarkupModifiableView"],function(e){"use strict";var t=e.extend({init:function(){this._parent()},SetPropertiesViewInfo:function(){this._parent()},getGroupPropertiesOrders:function(){var e={"Group.Essentials":["Actor.Name","Collab.3D.Paper.Paper.Position.X","Collab.3D.Paper.Paper.Position.Y","Collab.Body.Width","Collab.Body.Height","Actor.Opacity"]},t=this._parent()||{};for(const i in e)t[i]=e[i];return t}});return t.prototype._getGroupsPriorities=function(){return{"Group.Essentials":0,"Group.Header":10,"Group.Body":20,"Group.Text":30,"Group.Border":50,"Group.Shadow":60,"Group.Filter":70}},t}),define("DS/VCXWebDressup/VCXMeasurementModifiableView",["DS/VCXWebDressup/VCXMarkupModifiableView"],function(e){"use strict";var t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{"Group.Measurement":["Collab.Measurement.DisplayValue","Collab.Measurement.Value","Collab.Measurement.PreSymbol","Collab.Measurement.PreString","Collab.Measurement.MiddleSymbol","Collab.Measurement.MiddleString","Collab.Measurement.PostSymbol","Collab.Measurement.PostString"]}),e},getCollapsedGroupsNames:function(){return this._parent().concat(["Group.Position","Group.Border","Group.Attach","Group.Shadow","Group.Effect"])}});return t.prototype._getGroupsPriorities=function(){var t=e.prototype._getGroupsPriorities();return UWA.extend(t,{"Group.Essentials":0,"Group.Text":10,"Group.Background":20,"Group.Body":30,"Group.Measurement":40,"Group.Actions":50,"Group.Position":60,"Group.Border":70,"Group.Attach":80,"Group.Shadow":90}),t},t}),define("DS/VCXWebDressup/VCXCalloutModifiableView",["DS/VCXWebDressup/VCXMarkupModifiableView"],function(e){"use strict";var t=e.extend({init:function(){this._parent()},getCollapsedGroupsNames:function(){return this._parent().concat(["Group.Position","Group.Border","Group.Attach","Group.Shadow"])}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.Text":10,"Group.Background":20,"Group.Body":30,"Group.Actions":40,"Group.Position":50,"Group.Border":60,"Group.Attach":70,"Group.Shadow":80,"Group.Effect":90}),i},t}),define("DS/VCXWebDressup/VCXMarkupModifiable",["DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebDressup/VCXPanel_Spec","DS/VCXWebDressup/VCXDressupModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueFont","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValuePoint","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueDocId","DS/VCXWebProperties/VCXPropertyValueLink","DS/VCXWebSystem/VCXTextTools","DS/VCXWebExperienceBase/VCXPathElementTools"],function(e,t,i,r,o,a,n,s,l,p,u,h,d,c,y,C,m,f,V){"use strict";var b=r.extend({init:function(){this._bIsMarkup=!0,this._parent()},Build:function(){this._parent();var r=[{Name:"Collab.Text.Availability",Type:p,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Text"},{Name:"Collab.Text.Show",Type:s,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Text"},{Name:"Collab.Text",Type:d,DefaultValue:""},{Name:"Collab.Text.html",Type:d,DefaultValue:"",GroupId:"Group.Text",Persistent:!1},{Name:"Collab.Text.LinkedProperty",Type:d,DefaultValue:"Actor.ToolTip",GroupId:"Group.Text",Persistent:!1,visibleInPropertyGroups:!1},{Name:"Collab.Text.Color",Type:h,DefaultValue:(new n).FromRGBA(0,0,0,1),GroupId:"Group.Text",FormatPainter:!0},{Name:"Collab.Text.Color.Opacity",Type:l,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Text",FormatPainter:!0},{Name:"Collab.Text.Font",Type:u,GroupId:"Group.Text",FormatPainter:!0},{Name:"Collab.Text.SizeToFit",Type:s,DefaultValue:!1,GroupId:"Group.Text"},{Name:"Collab.Text.Wordwrap",Type:s,DefaultValue:!1,GroupId:"Group.Paragraph",visibleInPropertyGroups:!1},{Name:"Collab.Text.LineSpacing",Type:l,DefaultValue:1.2,GroupId:"Group.Paragraph",visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Collab.Text.ParagraphSpacing",Type:l,DefaultValue:1.4,GroupId:"Group.Paragraph",FormatPainter:!0},{Name:"Collab.Text.HAlignment",Type:p,DefaultValue:t.EHTextAlignment.Centered,GroupId:"Group.Paragraph",MapChoice:this._generateMapChoiceFromEnumAndId(t.EHTextAlignment,"Collab.Text.HAlignment"),FormatPainter:!0},{Name:"Collab.Text.VAlignment",Type:p,DefaultValue:t.EVTextAlignment.Middle,GroupId:"Group.Paragraph",MapChoice:this._generateMapChoiceFromEnumAndId(t.EVTextAlignment,"Collab.Text.VAlignment"),FormatPainter:!0},{Name:"Collab.Body.Shape",Type:p,DefaultValue:t.EBodyShape.RoundedRectangle,GroupId:"Group.Body",MapChoice:this._generateMapChoiceFromEnumAndId(t.EBodyShape,"Collab.Body.Shape",["User","CircumscribedCircle"]),FormatPainter:!0},{Name:"Collab.Body.FitToText",Type:s,DefaultValue:!0,GroupId:"Group.Body",visibleInPropertyGroups:!1},{Name:"Collab.Body.KeepAspectRatio",Type:s,DefaultValue:!1,GroupId:"Group.Body"},{Name:"Collab.Body.Width",Type:l,DefaultValue:50,GroupId:"Group.Body"},{Name:"Collab.Body.Height",Type:l,DefaultValue:50,GroupId:"Group.Body"},{Name:"Collab.Body.InnerMargin",Type:l,DefaultValue:2,GroupId:"Group.Background",FormatPainter:!0},{Name:"Collab.Body.HAlignment",Type:p,DefaultValue:t.EHAlignment.Left,GroupId:"Group.Body",MapChoice:this._generateMapChoiceFromEnumAndId(t.EHAlignment,"Collab.Body.HAlignment"),visibleInPropertyGroups:!1},{Name:"Collab.Body.VAlignment",Type:p,DefaultValue:t.EVAlignment.Top,GroupId:"Group.Body",MapChoice:this._generateMapChoiceFromEnumAndId(t.EVAlignment,"Collab.Body.VAlignment"),visibleInPropertyGroups:!1},{Name:"Collab.Body.ContributeToEqualSize",Type:s,DefaultValue:!1,GroupId:"Group.Body",visibleInPropertyGroups:!1},{Name:"Collab.Background.Availability",Type:p,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Background",FormatPainter:!0},{Name:"Collab.Background.Show",Type:s,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Background",FormatPainter:!0},{Name:"Collab.Background.Color",Type:h,DefaultValue:(new n).FromRGBA(1,1,1,1),GroupId:"Group.Background",FormatPainter:!0},{Name:"Collab.Background.Color.Opacity",Type:l,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Background",FormatPainter:!0},{Name:"Collab.Image.Availability",Type:p,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Image",FormatPainter:!0},{Name:"Collab.Image.Show",Type:s,DefaultValue:!1,ControlsGroupVisibility:!0,GroupId:"Group.Image"},{Name:"Collab.Image.DPI",Type:l,DefaultValue:-1,GroupId:"Group.Image",Persistent:!1},{Name:"Collab.Image.Doc.ID",Type:C,DefaultValue:-1,GroupId:"Group.Image"},{Name:"Collab.Image.Doc.PrepareRender",Type:s,DefaultValue:!1,visibleInPropertyGroups:!1},{Name:"Collab.Image.Color",Type:h,DefaultValue:(new n).FromRGBA(1,1,1,1),GroupId:"Group.Image",FormatPainter:!0},{Name:"Collab.Image.Color.Opacity",Type:l,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Image",FormatPainter:!0},{Name:"Collab.Image.Scale",Type:l,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Image",FormatPainter:!0},{Name:"Collab.Border.Availability",Type:p,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Show",Type:s,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Line.Width",Type:l,DefaultValue:2,GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Line.Color",Type:h,DefaultValue:(new n).FromRGBA(0,0,0,1),GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Line.Color.Opacity",Type:l,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Body.Shadow.Availability",Type:p,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Shadow",FormatPainter:!0},{Name:"Collab.Body.Shadow.Show",Type:s,DefaultValue:!1,ControlsGroupVisibility:!0,GroupId:"Group.Shadow",FormatPainter:!0},{Name:"Collab.Body.Shadow.Opacity",Type:l,DefaultValue:.55,GroupId:"Group.Shadow",FormatPainter:!0,Bounds:{Min:0,Max:1,Step:.1}},{Name:"Collab.Body.Shadow.Distance",Type:l,DefaultValue:3,GroupId:"Group.Shadow",FormatPainter:!0,Bounds:{Min:0,Max:20,Step:.1}},{Name:"Collab.Body.Shadow.Orientation",Type:l,DefaultValue:45,GroupId:"Group.Shadow",FormatPainter:!0,Bounds:{Min:0,Max:360,Step:.1}},{Name:"Collab.Body.Shadow.Blur",Type:l,DefaultValue:12,GroupId:"Group.Shadow",FormatPainter:!0,Bounds:{Min:0,Max:20,Step:.1}},{Name:"Collab.3D.Paper.Positioning.Type",Type:p,DefaultValue:t.EPositionType.Free3D,GroupId:"Group.Position",MapChoice:this._generateMapChoiceFromEnumAndId(t.EPositionType,"Positioning.Type",["EndOfAutomaticPositionning"])},{Name:"Collab.3D.Paper.3D.Text.Position",Type:c,DefaultValue:new o.Vector3,GroupId:"Group.Position"},{Name:"Collab.3D.Paper.Size.Control.Type",Type:p,DefaultValue:t.ESizeControlType.Paper,GroupId:"Group.Position",MapChoice:this._generateMapChoiceFromEnumAndId(t.ESizeControlType,"Size.Control.Type"),visibleInPropertyGroups:!1},{Name:"Collab.3D.Paper.Scaling.Factor",Type:l,DefaultValue:1,GroupId:"Group.Body",visibleInPropertyGroups:!1},{Name:"Collab.3D.Paper.Paper.Position.X",Type:l,DefaultValue:0,GroupId:"Group.Position"},{Name:"Collab.3D.Paper.Paper.Position.Y",Type:l,DefaultValue:0,GroupId:"Group.Position"},{Name:"Collab.3D.Paper.Is.Background",Type:s,DefaultValue:!1,GroupId:"Group.Body",FormatPainter:!0},{Name:"Collab.3D.Paper.Depth",Type:l,DefaultValue:0,GroupId:"Group.Position"},{Name:"Collab.3D.Paper.Billboard.Type",Type:p,DefaultValue:t.EBillboardType.Spherical,GroupId:"Group.Position",MapChoice:this._generateMapChoiceFromEnumAndId(t.EBillboardType,"Billboard.Type",["AlongX_yInCamUp"])},{Name:"Collab.3D.Paper.3D.Text.Radius",Type:l,DefaultValue:0,GroupId:"Group.Position",visibleInPropertyGroups:!1},{Name:"Collab.3D.Paper.UsesBarycenter",Type:s,DefaultValue:!1,GroupId:"Group.Position",visibleInPropertyGroups:!1},{Name:"Collab.3D.Paper.Referential.In.World",Type:s,DefaultValue:!0,GroupId:"Group.Position",visibleInPropertyGroups:!1},{Name:"Collab.Attach.Availability",Type:p,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Attach",FormatPainter:!0},{Name:"Collab.Attach.Show",Type:s,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Attach",FormatPainter:!0},{Name:"Collab.Attach.3DAttach",Type:s,DefaultValue:!0,GroupId:"Group.Attach",visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Collab.Attach.Preset",Type:p,DefaultValue:t.EAttachType.Line,GroupId:"Group.Attach",MapChoice:this._generateMapChoiceFromEnumAndId(t.EAttachType,"Collab.Attach.Type"),Persistent:!1,visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Collab.Attach.LeadType",Type:p,DefaultValue:t.ELeadType.Bent,GroupId:"Group.Attach",MapChoice:this._generateMapChoiceFromEnumAndId(t.ELeadType,"Collab.Attach.LeadType"),FormatPainter:!0},{Name:"Collab.Attach.ExtremityType",Type:p,DefaultValue:t.EExtremityType.Yellow,GroupId:"Group.Attach",FormatPainter:!0,MapChoice:this._generateMapChoiceFromEnumAndId(t.EExtremityType,"Collab.Attach.ExtremityType",["FullArrow_1","FullArrow_2","HalfArrow_B1","HalfArrow_T1","HalfArrow_T2","HalfArrow_B2"])},{Name:"Collab.Attach.ExtremityType.Additionnal",Type:p,DefaultValue:t.EExtremityType.Yellow,GroupId:"Group.Attach",visibleInPropertyGroups:!1,FormatPainter:!0,MapChoice:this._generateMapChoiceFromEnumAndId(t.EExtremityType,"Collab.Attach.ExtremityType",["FullArrow_1","FullArrow_2","HalfArrow_B1","HalfArrow_T1","HalfArrow_T2","HalfArrow_B2"])},{Name:"Collab.Attach.BentDot",Type:s,DefaultValue:!1,GroupId:"Group.Attach",FormatPainter:!0},{Name:"Collab.Attach.Background.Gradient",Type:s,DefaultValue:!1,GroupId:"Group.Attach",visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Collab.Attach.Border.Gradient",Type:s,DefaultValue:!1,GroupId:"Group.Attach",visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Collab.Attach.Curvature",Type:l,DefaultValue:40,Bounds:{Min:-100,Max:100,Step:.01},GroupId:"Group.Attach",visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Collab.Attach.Origin",Type:c,DefaultValue:new o.Vector3,GroupId:"Group.Attach",visibleInPropertyGroups:!1},{Name:"Collab.Attach.CenteredOrigin",Type:s,DefaultValue:!0,GroupId:"Group.Attach",visibleInPropertyGroups:!1},{Name:"Collab.Attach.Line.Color",Type:h,DefaultValue:(new n).FromRGBA(0,0,0,1),GroupId:"Group.Attach",FormatPainter:!0},{Name:"Collab.Attach.Line.Color.Opacity",Type:l,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Attach",FormatPainter:!0},{Name:"Collab.Attach.Line.Width",Type:l,DefaultValue:2,GroupId:"Group.Attach",FormatPainter:!0},{Name:"Collab.Lead.AlwaysVisible",Type:s,DefaultValue:!1,GroupId:"Group.Attach",visibleInPropertyGroups:!1},{Name:"Collab.Attach.Line.Type",Type:p,DefaultValue:e.ELineType.Plain,GroupId:"Group.Attach",MapChoice:this._generateMapChoiceFromEnumAndId(e.ELineType,"Collab.DashType",["UserDefined","Advanced"]),FormatPainter:!0},{Name:"Collab.ListAnchorsIDs",Type:y,DefaultValue:[],visibleInPropertyGroups:!1},{Name:"Collab.List2DAnchorsIDs",Type:y,DefaultValue:[],visibleInPropertyGroups:!1},{Name:"Collab.Markup.SubType",Type:p,DefaultValue:i.ESubType.None,visibleInPropertyGroups:!1}];const a=this.GetObject()._experienceBase.getManager("VCXContextManager");a&&a.isSupported("VCXPIPSupport")&&(r.push({Name:"Collab.PIP.Scenario.ID",Type:m,DefaultValue:"",GroupId:"Group.Image",FormatPainter:!0,visibleInPropertyGroups:!1}),r.push({Name:"Collab.PIP.Scenario",Type:p,DefaultValue:0,GroupId:"Group.Image",Persistent:!1,MapChoice:{0:"None"}})),this._BuildPropertyValues(r),this._Properties["Collab.Text.Font"].GetPropertyValue().SetFamily(new d("Arial")),this._Properties["Collab.Text.Font"].GetPropertyValue().SetHeight(new l(11))},SetPropertiesInfo:function(){const e=this.GetObject()._experienceBase.getManager("VCXContextManager");this._parent(),this.GetProperty("Actor.Color").GetPropertyInfo()._bPersistent=!1,this.SetPropertyInvisible("Collab.3D.Paper.UsesBarycenter",!0),this.SetPropertyInvisible("Collab.3D.Paper.Scaling.Factor",!0),this.SetPropertyInvisible("Collab.Text.html","1"!==e.getUrlVars().debug),this.SetPropertyInvisible("Collab.Text.SizeToFit",!this.GetPropertyValue("Collab.Text.Show")||this.GetPropertyValue("Collab.Body.FitToText")),this.SetPropertyInvisible("Collab.Body.KeepAspectRatio",!e.getPlayerMode()),this.SetPropertyInvisible("Collab.Body.Width",this.GetPropertyValue("Collab.Body.FitToText")&&this.GetPropertyValue("Collab.Text.Show")),this.SetPropertyInvisible("Collab.Body.Height",this.GetPropertyValue("Collab.Body.FitToText")&&this.GetPropertyValue("Collab.Text.Show")||this.GetPropertyValue("Collab.Body.KeepAspectRatio")&&this.GetPropertyValue("Collab.Image.Show")),this.SetPropertyInvisible("Collab.Background.Show",this.GetPropertyValue("Collab.Body.Shape")===t.EBodyShape.None),this.SetPropertyInvisible("Collab.Background.Color",!this.GetPropertyValue("Collab.Background.Show")||this.GetPropertyValue("Collab.Body.Shape")===t.EBodyShape.None),this.SetPropertyInvisible("Collab.Background.Color.Opacity",!this.GetPropertyValue("Collab.Background.Show")||this.GetPropertyValue("Collab.Body.Shape")===t.EBodyShape.None),this.SetPropertyInvisible("Actor.IsAlwaysOnTop",this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=t.EPositionType.Free2D);var i=this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=t.EPositionType.Free2D||this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")===t.EPositionType.Free3D&&this.GetPropertyValue("Collab.3D.Paper.Billboard.Type")!==t.EBillboardType.Spherical;this.SetPropertyInvisible("Collab.3D.Paper.Size.Control.Type",i),this.SetPropertyInvisible("Collab.3D.Paper.3D.Text.Position",this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=t.EPositionType.Free2D),this.SetPropertyInvisible("Collab.3D.Paper.Billboard.Type",this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=t.EPositionType.Free2D),this.SetPropertyInvisible("Collab.3D.Paper.Referential.In.World",this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=t.EPositionType.Free2D);var o=this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")!==t.EPositionType.Free2D&&this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")!==t.EPositionType.RelativeToReferential;this.SetPropertyInvisible("Collab.3D.Paper.Paper.Position.X",o),this.SetPropertyInvisible("Collab.3D.Paper.Paper.Position.Y",o),this.SetPropertyInvisible("Collab.3D.Paper.Depth",this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")>t.EPositionType.Free2D),this.SetPropertyInvisible("Collab.3D.Paper.Is.Background",this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")>t.EPositionType.Free2D),this.SetPropertyInvisible("Collab.Attach.CenteredOrigin",this.GetPropertyValue("Collab.Attach.LeadType")!==t.ELeadType.Mustache),this.SetPropertyInvisible("Collab.Attach.BentDot",this.GetPropertyValue("Collab.Attach.LeadType")!==t.ELeadType.Bent&&this.GetPropertyValue("Collab.Attach.LeadType")!==t.ELeadType.Line),this.SetPropertyInvisible("Collab.Attach.Origin",this.GetPropertyValue("Collab.Attach.CenteredOrigin")||this.GetPropertyValue("Collab.Attach.LeadType")===t.ELeadType.Mustache),this.SetPropertyInvisible("Collab.Attach.3DAttach",!0),this.SetPropertyInvisible("Collab.Attach.Line.Type",this.GetPropertyValue("Collab.Attach.LeadType")===t.ELeadType.Mustache),this.SetPropertyInvisible("Collab.Attach.Curvature",this.GetPropertyValue("Collab.Attach.LeadType")!==t.ELeadType.Mustache),this.SetPropertyInvisible("Collab.Attach.Background.Gradient",this.GetPropertyValue("Collab.Attach.LeadType")!==t.ELeadType.Mustache),this.SetPropertyInvisible("Collab.Attach.Border.Gradient",this.GetPropertyValue("Collab.Attach.LeadType")!==t.ELeadType.Mustache),this.SetPropertyInvisible("Collab.Body.ContributeToEqualSize",!0),this.SetPropertyInvisible("Collab.ListAnchorsIDs",!0),this.SetPropertyInvisible("Collab.List2DAnchorsIDs",!0),this.SetPropertyInvisible("Collab.Markup.SubType",!0),this.ChangeGroupAvailability("Group.Image",r.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Paragraph",this.GetPropertyValue("Collab.Text.Show")?r.EAvailability.NoControl:r.EAvailability.AppForceNotAvailable),this.GetPropertyValue("Collab.Image.Doc.ID")>0?this.changeMapChoice("Collab.Body.Shape",this._generateMapChoiceFromEnumAndId(t.EBodyShape,"Collab.Body.Shape",["User","CircumscribedCircle"])):this.changeMapChoice("Collab.Body.Shape",this._generateMapChoiceFromEnumAndId(t.EBodyShape,"Collab.Body.Shape",["User","CircumscribedCircle","RemoveBorder"])),e.isSupported("VCXPIPSupport")&&this.changeMapChoice("Collab.PIP.Scenario",this.getScenarioEnum())},getScenarioEnum:function(e){if(e&&!e.id&&!e.idx)return{idx:0,scenario:null};const t=this.ExperienceBase.getManager("VCXScenarioManager").GetScenarios(),i={0:"None"};let r=1;for(let o in t){const a=t[o];if(e&&(e.id===o||e.idx===r))return{idx:r,scenario:a};i[r++]=a.GetName()}return e?{0:"None"}:i},GetDepthFromAttachedAnchors:function(){for(var e=0,t=this.GetAttachedOccurences(),i=0;i<t.length;i++){var r=t[i];if(r){var o=r.QueryInterface("VCXIModifiable");if(o){var a=o.GetProperty("Collab.3D.Paper.Depth");if(a){var n=a.GetPropertyValue().Value;n>e&&(e=n)}}}}return e},GetProperty:function(e){var i,r;if("Actor.Color"===e)return this.GetNewProperty(e,this.GetPropertyValue("Collab.Background.Color"));if("Collab.3D.Paper.Paper.Position.X"===e){if(this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<t.EPositionType.EndOfAutomaticPositionning&&(i=this.QueryInterface("W3AISGNodeHolder"))&&(r=i.getSGNode())&&r._Smart3DPaperNode)return this.GetNewProperty(e,r._Smart3DPaperNode.Position2D.x)}else if("Collab.3D.Paper.Paper.Position.Y"===e){if(this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<t.EPositionType.EndOfAutomaticPositionning&&(i=this.QueryInterface("W3AISGNodeHolder"))&&(r=i.getSGNode())&&r._Smart3DPaperNode)return this.GetNewProperty(e,r._Smart3DPaperNode.Position2D.y)}else{if("Collab.Image.DPI"===e){if(this.GetObject().backgroundImage){var o=25.4*this.GetObject().backgroundImage.width/this.GetPropertyValue("Collab.Body.Width"),a=25.4*this.GetObject().backgroundImage.height/this.GetPropertyValue("Collab.Body.Height");if(a>5&&o>5&&o/a>.999&&o/a<1.001)return this.GetNewProperty(e,o)}return this.GetNewProperty(e,-1)}if("Collab.PIP.Scenario"===e){const t=this.GetPropertyValue("Collab.PIP.Scenario.ID"),i=this.getScenarioEnum({id:t}).idx;return this.GetNewProperty(e,i)}if("Collab.Attach.Preset"===e){const i=Object.keys(t.EAttachType).filter(e=>Number.isNaN(+e));for(let r=0;r<i.length;r++){const o=i[r],a=b.GetAttachPresets(t.EAttachType[o]);let s=!0;for(var n in a)if(a.hasOwnProperty(n)&&this.GetProperty(n)&&this.GetProperty(n).GetPropertyInfo().IsVisible()&&a[n]!==this.GetPropertyValue(n)){s=!1;break}if(s)return this.GetNewProperty(e,t.EAttachType[o])}}else if("Collab.3D.Paper.Depth"===e&&this.GetPropertyValue("Collab.UseDepthFromAnchor")){var s=this.GetDepthFromAttachedAnchors();return 0<s&&(s+=1),this.GetNewProperty(e,s)}}return this._parent(e)},RequestModification:function(e,i){if(e){if("Collab.Attach.Preset"===e.GetPropertyInfo().GetPropertyName()){var r=b.GetAttachPresets(e.GetPropertyValue().Value);for(var o in r)r.hasOwnProperty(o)&&i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty(o,r[o]));return this._parent(e,i)}if("Collab.Image.DPI"===e.GetPropertyInfo().GetPropertyName())return e.GetPropertyValue().Value>5?this.GetObject().backgroundImage&&(i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Body.Width",25.4*this.GetObject().backgroundImage.width/e.GetPropertyValue().Value)),i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Body.Height",25.4*this.GetObject().backgroundImage.height/e.GetPropertyValue().Value))):i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Image.DPI",-1)),i.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,i);if("Collab.Text"===e.GetPropertyInfo().GetPropertyName())return i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Text.html",f.htmlEncode(e.GetPropertyValue().Value))),i.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,i);if("Collab.Text.html"===e.GetPropertyInfo().GetPropertyName())return i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Text",f.htmlDecode(e.GetPropertyValue().Value))),i.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,i);if("Collab.PIP.Scenario"===e.GetPropertyInfo().GetPropertyName()){const t=this.getScenarioEnum({idx:e.GetPropertyValue().Value}).scenario,r=this._parent;if(i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.PIP.Scenario.ID",t?t.GetID():"")),t){const o=t.GetPIPDocId&&t.GetPIPDocId();if(o.docID>=0)return this.ExperienceBase.getManager("VCXImageManager").GetImageFromDocID(o.docID).then(t=>{var o=25.4*t.width/this.GetPropertyValue("Collab.Body.Width"),a=25.4*t.height/o;return i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Body.Height",a)),i.AddOrModifyProperty(this.GetHashing(),e),r.bind(this)(e,i)})}return this._parent(e,i)}if("Collab.Image.Doc.ID"===e.GetPropertyInfo().GetPropertyName()){const t=this._parent;return this.ExperienceBase.getManager("VCXImageManager").GetImageFromDocID(e.GetPropertyValue().Value).then(r=>{var o=25.4*r.width/this.GetPropertyValue("Collab.Body.Width"),a=25.4*r.height/o;return i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Body.Height",a)),i.AddOrModifyProperty(this.GetHashing(),e),t.bind(this)(e,i)})}if("Actor.Color"===e.GetPropertyInfo().GetPropertyName()){var n=e.GetPropertyValue().Value.getAssociatedColors();return i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Background.Color",n.body)),i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Text.Color",n.text)),i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Image.Color",n.image)),i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Border.Line.Color",n.border)),i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Attach.Line.Color",n.attach)),this._parent(e,i)}if("Collab.3D.Paper.Positioning.Type"===e.GetPropertyInfo().GetPropertyName()){this.ExperienceBase.getManager("VCXDressupManager").alignmentDirty=2;var s=this.ExperienceBase.getManager("VCXContextManager").getMainViewer(),l=this.ExperienceBase.getManager("VCXPaperManager"),p=this.QueryInterface("W3AISGNodeHolder"),u={viewer:s,viewpoint:s.currentViewpoint};if(s&&l&&p){var h=p.getSGNode()&&p.getSGNode(),d=h&&h.GetShapeInfo(),c=d&&d.smartNode&&V.buildPathElement(p.getPathElement(),d.smartNode),y=c&&a.getOFromMatrix(c.getWorldMatrix(s));y||(y=a.getOFromMatrix(p.getWorldMatrix(s)));var C=l.ModelToMM2(u,y);if(e.GetPropertyValue().Value<=t.EPositionType.Free2D){if(e.GetPropertyValue().Value===t.EPositionType.RelativeToReferential){var m=a.getOFromMatrix(d.smartNode.GetReferential(u)),P=l.ModelToMM2(u,m);C.x-=P.x,C.y-=P.y,i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.3D.Paper.3D.Text.Radius",0))}i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.3D.Paper.Paper.Position.X",C.x)),i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.3D.Paper.Paper.Position.Y",C.y)),i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.3D.Paper.Billboard.Type",t.EBillboardType.Spherical)),i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.3D.Paper.Size.Control.Type",t.ESizeControlType.Paper))}else{m=a.getOFromMatrix(d.smartNode.GetReferential(u)),P=l.ModelToMM2(u,m);C.z=P.z;var g=l.MMToModel2(u,C);i.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.3D.Paper.3D.Text.Position",p.getPositionInLCS(s,g)))}}return i.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,i)}}return this._parent(e,i)}});return b.GetAttachPresets=function(e){var i={};switch(e){case t.EAttachType.None:i["Collab.Attach.LeadType"]=t.ELeadType.None,i["Collab.Attach.ExtremityType"]=t.EExtremityType.None,i["Collab.Attach.Curvature"]=0,i["Collab.Attach.Background.Gradient"]=!1,i["Collab.Attach.Border.Gradient"]=!1,i["Collab.Attach.BentDot"]=!1;break;case t.EAttachType.Model:i["Collab.Attach.LeadType"]=t.ELeadType.Bent,i["Collab.Attach.ExtremityType"]=t.EExtremityType.Yellow,i["Collab.Attach.Curvature"]=0,i["Collab.Attach.Background.Gradient"]=!1,i["Collab.Attach.Border.Gradient"]=!1,i["Collab.Attach.BentDot"]=!1;break;case t.EAttachType.Vertex:i["Collab.Attach.LeadType"]=t.ELeadType.Bent,i["Collab.Attach.ExtremityType"]=t.EExtremityType.Red,i["Collab.Attach.Curvature"]=0,i["Collab.Attach.Background.Gradient"]=!1,i["Collab.Attach.Border.Gradient"]=!1,i["Collab.Attach.BentDot"]=!1;break;case t.EAttachType.GradientTooltip:i["Collab.Attach.LeadType"]=t.ELeadType.Mustache,i["Collab.Attach.ExtremityType"]=t.EExtremityType.Red,i["Collab.Attach.Curvature"]=0,i["Collab.Attach.Background.Gradient"]=!0,i["Collab.Attach.Border.Gradient"]=!0,i["Collab.Attach.BentDot"]=!1;break;case t.EAttachType.TooltipStyle:i["Collab.Attach.LeadType"]=t.ELeadType.Mustache,i["Collab.Attach.ExtremityType"]=t.EExtremityType.Red,i["Collab.Attach.Curvature"]=0,i["Collab.Attach.Background.Gradient"]=!1,i["Collab.Attach.Border.Gradient"]=!0,i["Collab.Attach.BentDot"]=!1;break;case t.EAttachType.Line:case t.EAttachType.User:i["Collab.Attach.LeadType"]=t.ELeadType.Bent,i["Collab.Attach.ExtremityType"]=t.EExtremityType.SmallRed,i["Collab.Attach.Curvature"]=0,i["Collab.Attach.Background.Gradient"]=!1,i["Collab.Attach.Border.Gradient"]=!1,i["Collab.Attach.BentDot"]=!1;break;case t.EAttachType.Simple:i["Collab.Attach.LeadType"]=t.ELeadType.Middle,i["Collab.Attach.ExtremityType"]=t.EExtremityType.SmallRed,i["Collab.Attach.Curvature"]=0,i["Collab.Attach.Background.Gradient"]=!1,i["Collab.Attach.Border.Gradient"]=!1,i["Collab.Attach.BentDot"]=!1;break;case t.EAttachType.ArcTooltip:i["Collab.Attach.LeadType"]=t.ELeadType.Mustache,i["Collab.Attach.ExtremityType"]=t.EExtremityType.Red,i["Collab.Attach.Curvature"]=40,i["Collab.Attach.Background.Gradient"]=!1,i["Collab.Attach.Border.Gradient"]=!1,i["Collab.Attach.BentDot"]=!1;break;case t.EAttachType.Arrow:i["Collab.Attach.LeadType"]=t.ELeadType.Bent,i["Collab.Attach.ExtremityType"]=t.EExtremityType.FullArrow_1,i["Collab.Attach.Curvature"]=0,i["Collab.Attach.Background.Gradient"]=!1,i["Collab.Attach.Border.Gradient"]=!1,i["Collab.Attach.BentDot"]=!1;break;case t.EAttachType.Basic:i["Collab.Attach.LeadType"]=t.ELeadType.Line,i["Collab.Attach.ExtremityType"]=t.EExtremityType.SmallRed,i["Collab.Attach.Curvature"]=0,i["Collab.Attach.Background.Gradient"]=!1,i["Collab.Attach.Border.Gradient"]=!1,i["Collab.Attach.BentDot"]=!1;break;case t.EAttachType.Modern:i["Collab.Attach.LeadType"]=t.ELeadType.Line,i["Collab.Attach.ExtremityType"]=t.EExtremityType.Line,i["Collab.Attach.Curvature"]=0,i["Collab.Attach.Background.Gradient"]=!1,i["Collab.Attach.Border.Gradient"]=!1,i["Collab.Attach.BentDot"]=!0}return i},b}),define("DS/VCXWebDressup/VCXLabelModifiable",["DS/VCXWebDressup/VCXMarkupModifiable","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebProperties/VCXColor"],function(e,t,i,r){"use strict";return e.extend({init:function(){this._bIsLabel=!0,this._parent()},Build:function(){this._parent();var e=[{Name:"Collab.Text.Availability",DefaultValue:t.EAvailability.AppForceAvailable},{Name:"Collab.Text",DefaultValue:"$(##Actor.Name.DisplayTitle)"},{Name:"Collab.Text.Color",DefaultValue:(new r).FromRGBA(1,1,1,1),FormatPainter:!0},{Name:"Collab.Background.Color",DefaultValue:(new r).FromRGBA(.0666666666666667,.596078431372549,.8980392156862745,1),FormatPainter:!0},{Name:"Collab.Body.Shape",DefaultValue:i.EBodyShape.RoundedRectangle,FormatPainter:!0},{Name:"Collab.HideIfOutsideAnchorFrustrum",DefaultValue:!0,visibleInPropertyGroups:!0},{Name:"Collab.Image.Availability",DefaultValue:t.EAvailability.AppForceNotAvailable},{Name:"Collab.Body.HAlignment",DefaultValue:i.EHAlignment.Center},{Name:"Collab.Body.VAlignment",DefaultValue:i.EVAlignment.Middle},{Name:"Collab.3D.Paper.Billboard.Type",visibleInPropertyGroups:!1}];this._BuildPropertyValues(e),this.SetPropertyInvisible("Collab.HideIfOutsideAnchorFrustrum",!1),this.SetPropertyInvisible("Collab.3D.Paper.Is.Background",!0)}})}),define("DS/VCXWebDressup/VCXCalloutModifiable",["DS/VCXWebDressup/VCXMarkupModifiable","DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueString"],function(e,t,i,r,o){"use strict";return e.extend({init:function(){this._bIsCallout=!0,this._parent()},Build:function(){this._parent();var e=[{Name:"Collab.Text.Availability",DefaultValue:t.EAvailability.AppForceAvailable},{Name:"Collab.Text",DefaultValue:"$(##Actor.PartList.ID)"},{Name:"Collab.Text.ComputedText",Type:o,DefaultValue:"",visibleInPropertyGroups:!1},{Name:"Collab.Text.Color",DefaultValue:(new r).FromRGBA(0,0,0,1),FormatPainter:!0},{Name:"Collab.Body.InnerMargin",DefaultValue:1.5,FormatPainter:!0},{Name:"Collab.Background.Color",DefaultValue:(new r).FromRGBA(1,1,1,1),FormatPainter:!0},{Name:"Collab.Body.Shape",DefaultValue:i.EBodyShape.Circle,FormatPainter:!0},{Name:"Collab.Body.HAlignment",DefaultValue:i.EHAlignment.Center},{Name:"Collab.Body.VAlignment",DefaultValue:i.EVAlignment.Bottom},{Name:"Collab.HideIfOutsideAnchorFrustrum",DefaultValue:!0},{Name:"Collab.Image.Availability",DefaultValue:t.EAvailability.AppForceNotAvailable},{Name:"Collab.Body.ContributeToEqualSize",DefaultValue:!0},{Name:"Collab.Body.Width",DefaultValue:5},{Name:"Collab.Body.Height",DefaultValue:5}];this._BuildPropertyValues(e),this.SetPropertyInvisible("Collab.HideIfOutsideAnchorFrustrum",!1)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Collab.3D.Paper.Is.Background",!0),this.ChangeGroupAvailability("Group.Paragraph",t.EAvailability.AppForceNotAvailable)},GetProperty:function(e){return"Collab.Text.ComputedText"===e?this.GetNewProperty(e,this.GetPropertyValue("Collab.Text._ComputedText")):this._parent(e)},RequestModification:function(e,t){return e&&"Collab.Text.ComputedText"===e.GetPropertyInfo().GetPropertyName()?(t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Text",e.GetPropertyValue().Value)),this._parent(e,t)):this._parent(e,t)}})}),define("DS/VCXWebDressup/VCXPartListModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebDressup/VCXMarkupModifiable","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFont","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValuePoint2D","DS/Visualization/ThreeJS_DS","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebDressup/VCXMarkup_Spec","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup","DS/VCXWebProperties/VCXPropertyValueInt"],function(e,t,i,r,o,a,n,s,l,p,u,h,d,c,y){"use strict";return t.extend({init:function(){this._bIsPartList=!0,this._parent()},Build:function(){this._parent();var e=[{Name:"Collab.Body.FitToText",DefaultValue:!1},{Name:"Collab.PartList.Scenario.Fontsize",Type:n,DefaultValue:9.1},{Name:"Collab.PartList.Split.headercount",Type:n,DefaultValue:0},{Name:"Collab.3D.Paper.Billboard.Type",Type:o,DefaultValue:d.EBillboardType.Spherical},{Name:"Actor.Name",Type:l,DefaultValue:"Part List",GroupId:"Group.Essentials"},{Name:"Collab.3D.Paper.Paper.Position.X",Type:n,DefaultValue:50,GroupId:"Group.Essentials"},{Name:"Collab.3D.Paper.Paper.Position.Y",Type:n,DefaultValue:50,GroupId:"Group.Essentials"},{Name:"Collab.Body.Width",Type:n,DefaultValue:50,GroupId:"Group.Essentials"},{Name:"Collab.Body.Height",Type:n,DefaultValue:50,GroupId:"Group.Essentials"},{Name:"Collab.PartList.Header.Availability",Type:o,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Header",FormatPainter:!0},{Name:"Collab.PartList.Header.Show",Type:r,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Header",FormatPainter:!0},{Name:"Collab.PartList.Header.Background.Color",Type:a,DefaultValue:(new i).FromHexString("#42A2DA"),GroupId:"Group.Header",FormatPainter:!0},{Name:"Collab.PartList.Header.Background.Color.Opacity",Type:n,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Header",FormatPainter:!0},{Name:"Collab.PartList.Header.Text.Color",Type:a,DefaultValue:(new i).FromHexString("#ffffff"),GroupId:"Group.Header",FormatPainter:!0},{Name:"Collab.PartList.Header.Text.Color.Opacity",Type:n,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Header",FormatPainter:!0},{Name:"Collab.PartList.Body.Row.Color",Type:a,DefaultValue:(new i).FromHexString("#ffffff"),GroupId:"Group.Body",BehaviorType:1,i18n:c},{Name:"Collab.PartList.Body.Row.Color.Opacity",Type:n,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Body",FormatPainter:!0},{Name:"Collab.PartList.Body.ConsiderAlternateColor",Type:r,DefaultValue:!1,GroupId:"Group.Body"},{Name:"Collab.PartList.Body.SecondRow.Color",Type:a,DefaultValue:(new i).FromHexString("#ffffff"),GroupId:"Group.Body",BehaviorType:1,i18n:c},{Name:"Collab.PartList.Body.SecondRow.Color.Opacity",Type:n,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Body",FormatPainter:!0},{Name:"Collab.PartList.Container.Text.Color",Type:a,DefaultValue:(new i).FromHexString("#747474"),GroupId:"Group.Body",FormatPainter:!0},{Name:"Collab.PartList.Container.Text.Color.Opacity",Type:n,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Body",FormatPainter:!0},{Name:"Collab.Text.Font",Type:s,GroupId:"Group.Text",hiddenFields:["Italic","Bold"],FormatPainter:!0},{Name:"Collab.Text.HAlignment",DefaultValue:d.EHTextAlignment.Left,FormatPainter:!0},{Name:"Collab.Border.Availability",Type:o,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Show",Type:r,DefaultValue:!1,ControlsGroupVisibility:!0,GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Line.Width",Type:n,DefaultValue:2,GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Line.Color",Type:a,DefaultValue:(new i).FromHexString("#000000"),GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Line.Color.Opacity",Type:n,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Body.Shadow.Availability",Type:o,DefaultValue:0,ControlsGroupAvailability:!0,GroupId:"Group.Shadow",FormatPainter:!0},{Name:"Collab.Body.Shadow.Show",Type:r,DefaultValue:!1,ControlsGroupVisibility:!0,GroupId:"Group.Shadow",FormatPainter:!0},{Name:"Collab.Body.Shadow.Opacity",Type:n,DefaultValue:.55,GroupId:"Group.Shadow",FormatPainter:!0,Bounds:{Min:0,Max:1,Step:.1}},{Name:"Collab.Body.Shadow.Distance",Type:n,DefaultValue:3,GroupId:"Group.Shadow",FormatPainter:!0,Bounds:{Min:0,Max:20,Step:.1}},{Name:"Collab.Body.Shadow.Orientation",Type:n,DefaultValue:45,GroupId:"Group.Shadow",FormatPainter:!0,Bounds:{Min:0,Max:360,Step:.1}},{Name:"Collab.Body.Shadow.Blur",Type:n,DefaultValue:12,GroupId:"Group.Shadow",FormatPainter:!0,Bounds:{Min:0,Max:20,Step:.1}},{Name:"Collab.3D.Paper.Positioning.Type",Type:o,DefaultValue:d.EPositionType.Free2D},{Name:"Collab.PartList.FilterOnVisibleCallouts",Type:r,DefaultValue:!0,GroupId:"Group.Filter"}];this._BuildPropertyValues(e)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Collab.Text",!0),this.SetPropertyInvisible("Collab.Text.SizeToFit",!0),this.SetPropertyInvisible("Collab.Text.Color",!0),this.SetPropertyInvisible("Collab.3D.Paper.Billboard.Type",!0),this.SetPropertyInvisible("Collab.Body.FitToText",!0),this.SetPropertyInvisible("Collab.3D.Paper.Is.Background",!0),this.SetPropertyInvisible("Collab.Body.Shape",!0),this.SetPropertyInvisible("Collab.PartList.Scenario.Fontsize",!0),this.SetPropertyInvisible("Collab.PartList.Split.headercount",!0),this.SetPropertyInvisible("Collab.Text.HAlignment",!0),this.ChangeGroupAvailability("Group.Paragraph",e.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Actions",e.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Attach",e.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Background",e.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Position",e.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Animation",e.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Border",e.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Shadow",e.EAvailability.AppForceNotAvailable)},OnChangeProperty:function(e,t,i){if(i||(i={}),i.fromChildClass);else if(this.OnChangePropertyBegin(e,t))return!0;"Collab.PartList.FilterOnVisibleCallouts"===e&&(this._resquestedFilterOnVisibleCallouts=t.Value),this._parent(e,t,i)},OnChangePropertiesEnd:function(){if(this._resquestedFilterOnVisibleCallouts!==this._filterOnVisibleCallouts){var e=this.ExperienceBase.getManager("VCXComponentPartListManager");e&&(e.filterHasChanged=!0),this._filterOnVisibleCallouts=this._resquestedFilterOnVisibleCallouts}this._parent()}})}),define("DS/VCXWebDressup/VCXArrowModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebSystem/VCXMathTools","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueVector","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables"],function(e,t,i,r,o,a,n,s,l,p,u){"use strict";return e.extend({init:function(){this._bIsArrow=!0,this._parent()},Build:function(){this._parent();var e=[{Name:"Collab.Is.Paper",Type:o,DefaultValue:!0,GroupId:"Group.Arrow"},{Name:"Arrow.Scale",Type:n,DefaultValue:1,GroupId:"Group.Arrow",visibleInPropertyGroups:!1},{Name:"Collab.Border.Show",Type:o,DefaultValue:!0,ControlsGroupVisibility:!0,GroupId:"Group.Border",visibleInPropertyGroups:!1,FormatPainter:!0},{Name:"Collab.Border.Line.Width",Type:n,DefaultValue:1,GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Line.Type",Type:a,DefaultValue:t.ELineType.Plain,GroupId:"Group.Border",MapChoice:this._generateMapChoiceFromEnumAndId(t.ELineType,"Collab.DashType",["UserDefined","Advanced"]),FormatPainter:!0},{Name:"Arrow.Body.Color",Type:s,DefaultValue:(new r).FromRGBA(.9294117647058824,.3176470588235294,.3176470588235294,1),GroupId:"Group.Arrow.Head",FormatPainter:!0},{Name:"Arrow.Body.Color.Opacity",Type:n,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Arrow.Head",FormatPainter:!0},{Name:"Arrow.Width.1",Type:n,DefaultValue:5,GroupId:"Group.Arrow.Head"},{Name:"Arrow.Head.ShowMode",Type:o,DefaultValue:!0,GroupId:"Group.Arrow.Head",FormatPainter:!0},{Name:"Arrow.Head.Length",Type:n,DefaultValue:10,GroupId:"Group.Arrow.Head",FormatPainter:!0},{Name:"Arrow.Head.Size",Type:n,DefaultValue:4,GroupId:"Group.Arrow.Head",FormatPainter:!0},{Name:"Arrow.Head.Shape",Type:n,DefaultValue:0,GroupId:"Group.Arrow.Head",FormatPainter:!0},{Name:"Collab.Border.Line.Color",Type:s,DefaultValue:(new r).FromRGBA(.6431372549019608,.1686274509803922,.1568627450980392,1),GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Line.Color.Opacity",Type:n,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Border",FormatPainter:!0},{Name:"Arrow.Body.2.Color",Type:s,DefaultValue:(new r).FromRGBA(.9294117647058824,.3176470588235294,.3176470588235294,.5),GroupId:"Group.Arrow.Head.2",FormatPainter:!0},{Name:"Arrow.Body.2.Color.Opacity",Type:n,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Arrow.Head.2",FormatPainter:!0},{Name:"Arrow.Width.2",Type:n,DefaultValue:5,GroupId:"Group.Arrow.Head.2"},{Name:"Arrow.Head.2.ShowMode",Type:o,DefaultValue:!1,GroupId:"Group.Arrow.Head.2",FormatPainter:!0},{Name:"Arrow.Head.2.Length",Type:n,DefaultValue:10,GroupId:"Group.Arrow.Head.2",FormatPainter:!0},{Name:"Arrow.Head.2.Size",Type:n,DefaultValue:4,GroupId:"Group.Arrow.Head.2",FormatPainter:!0},{Name:"Arrow.Head.2.Shape",Type:n,DefaultValue:0,GroupId:"Group.Arrow.Head.2",FormatPainter:!0},{Name:"Collab.Border.Line.2.Color",Type:s,DefaultValue:(new r).FromRGBA(.6431372549019608,.1686274509803922,.1568627450980392,1),GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.Border.Line.2.Color.Opacity",Type:n,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Border",FormatPainter:!0},{Name:"Collab.ListAnchorsIDs",Type:l,DefaultValue:[],visibleInPropertyGroups:!1}];this._BuildPropertyValues(e)},SetPropertiesInfo:function(){this._parent(),this.GetProperty("Actor.Color").GetPropertyInfo()._bPersistent=!1,this.GetProperty("Actor.Color").GetPropertyInfo().Seti18nGroup(p),this.GetProperty("Actor.Color").GetPropertyInfo().Seti18n(u),this.SetPropertyInvisible("Actor.Color",!1),this.SetPropertyInvisible("Arrow.Head.Length",!1===this.GetPropertyValue("Arrow.Head.ShowMode")),this.SetPropertyInvisible("Arrow.Head.Size",!1===this.GetPropertyValue("Arrow.Head.ShowMode")),this.SetPropertyInvisible("Arrow.Head.Shape",!1===this.GetPropertyValue("Arrow.Head.ShowMode")),this.SetPropertyInvisible("Arrow.Head.2.Length",!1===this.GetPropertyValue("Arrow.Head.2.ShowMode")),this.SetPropertyInvisible("Arrow.Head.2.Size",!1===this.GetPropertyValue("Arrow.Head.2.ShowMode")),this.SetPropertyInvisible("Arrow.Head.2.Shape",!1===this.GetPropertyValue("Arrow.Head.2.ShowMode")),this.SetPropertyInvisible("Arrow.Head.2.Shape",!1===this.GetPropertyValue("Arrow.Head.2.ShowMode")),this.SetPropertyInvisible("Arrow.Head.2.Shape",!1===this.GetPropertyValue("Arrow.Head.2.ShowMode")),this.SetPropertyInvisible("Collab.Border.Line.Color",!1===this.GetPropertyValue("Collab.Border.Show")),this.SetPropertyInvisible("Collab.Border.Line.Color.Opacity",!1===this.GetPropertyValue("Collab.Border.Show")),this.SetPropertyInvisible("Collab.Border.Line.2.Color",!1===this.GetPropertyValue("Collab.Border.Show")),this.SetPropertyInvisible("Collab.Border.Line.2.Color.Opacity",!1===this.GetPropertyValue("Collab.Border.Show")),this.SetPropertyInvisible("Collab.ListAnchorsIDs",!0)},GetProperty:function(e){return"Actor.Color"===e?this.GetNewProperty(e,this.GetPropertyValue("Arrow.Body.Color")):this._parent(e)},getScaledDimensions:function(e,t){var r=this.ExperienceBase.getManager("VCXPaperManager"),o=[{idx:0},{idx:this.GetPropertyValue("Arrow.Head.2.Position.Is.Paper")?0:1}];o.forEach(o=>{if(this.GetPropertyValue("Collab.Is.Paper")===e)o.scaleToApply=1;else{let a=t||i.getOFromMatrix(this.GetAnchorWorldMatrix(0)),n=r.GetPaperRatio(null,a),s=1;e?s/=n:s*=n,o.scaleToApply=s}});var a={};return[{idx:0,propertyName:"Arrow.Length"},{idx:0,propertyName:"Arrow.Width.1"},{idx:0,propertyName:"Arrow.Head.Length"},{idx:0,propertyName:"Arrow.Head.Size"},{idx:0,propertyName:"Arrow.Head.Shape"},{idx:1,propertyName:"Arrow.Width.2"},{idx:1,propertyName:"Arrow.Head.2.Length"},{idx:1,propertyName:"Arrow.Head.2.Size"},{idx:1,propertyName:"Arrow.Head.2.Shape"}].forEach(e=>{let t=this.GetPropertyValue(e.propertyName);void 0!==t&&(t*=o[e.idx].scaleToApply,a[e.propertyName]=t)}),a},RequestModification:function(e,t){if(e){var i=e.GetPropertyInfo().GetPropertyName();if("Actor.Color"===i){var r=e.GetPropertyValue().Value.getAssociatedColors();return t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Arrow.Body.Color",r.body)),t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Arrow.Body.2.Color",r.body)),t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Border.Line.Color",r.border)),t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Border.Line.2.Color",r.border)),this._parent(e,t)}if(i.includes("Collab.Border.Line")&&i.includes("Color")){var o="Collab.Border.Line"+(i.includes("2")?"":".2")+".Color"+(i.includes(".Opacity")?".Opacity":"");return t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty(i,e.GetPropertyValue().Value)),t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty(o,e.GetPropertyValue().Value)),this._parent(e,t)}if("Collab.Is.Paper"===i){var a=this.getScaledDimensions(e.GetPropertyValue().Value);for(let e in a)t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty(e,a[e]));return t.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,t)}return this._parent(e,t)}}})}),define("DS/VCXWebDressup/VCXArrowCornerModifiable",["DS/VCXWebDressup/VCXArrowModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueVector"],function(e,t,i,r,o,a){"use strict";return e.extend({init:function(){this._parent(),this._handleAnchor=null},Build:function(){this._parent();var e=[{Name:"Arrow.Corner.Length.1",Type:i,DefaultValue:50,GroupId:"Group.Arrow"},{Name:"Arrow.Corner.Length.2",Type:i,DefaultValue:50,GroupId:"Group.Arrow"},{Name:"Actor.Anchor.0",Type:o,DefaultValue:(new o).SetValueFrame((new r).SetValueFromVector(new t.Vector3(0,0,0))).GetValue(),GroupId:"Group.Arrow"},{Name:"Collab.ListAnchorsIDs",Type:a,DefaultValue:[0]}];this._BuildPropertyValues(e)}})}),define("DS/VCXWebDressup/VCXArrowLinearModifiable",["DS/VCXWebDressup/VCXArrowModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueVector"],function(e,t,i,r,o,a,n){"use strict";return e.extend({init:function(){this._parent()},Build:function(){this._parent();var e=[{Name:"Arrow.Fixed.Length",Type:i,DefaultValue:!1,GroupId:"Group.Arrow"},{Name:"Arrow.Length",Type:r,DefaultValue:20,GroupId:"Group.Arrow"},{Name:"Arrow.Billboarded",Type:i,DefaultValue:!0,GroupId:"Group.Arrow",FormatPainter:!0},{Name:"Arrow.ZRotation",Type:r,DefaultValue:90,Bounds:{Min:0,Max:180,Step:1},GroupId:"Group.Arrow",visibleInPropertyGroups:!1},{Name:"Actor.Anchor.0",Type:a,DefaultValue:(new a).SetValueFrame((new o).SetValueFromVector(new t.Vector3(0,0,0))).GetValue(),GroupId:"Group.Arrow.Head",visibleInPropertyGroups:!1},{Name:"Actor.Anchor.1",Type:a,DefaultValue:(new a).SetValueFrame((new o).SetValueFromVector(new t.Vector3(1,1,1))).GetValue(),GroupId:"Group.Arrow.Head.2",visibleInPropertyGroups:!1},{Name:"Collab.Border.AlwaysVisible",Type:i,DefaultValue:!1},{Name:"Arrow.Head.2.Position.Is.Paper",Type:i,DefaultValue:!1,GroupId:"Group.Arrow.Head.2",visibleInPropertyGroups:!1},{Name:"Arrow.Head.2.Position.X",Type:r,DefaultValue:0,GroupId:"Group.Arrow.Head.2",visibleInPropertyGroups:!1},{Name:"Arrow.Head.2.Position.Y",Type:r,DefaultValue:0,GroupId:"Group.Arrow.Head.2",visibleInPropertyGroups:!1},{Name:"Collab.ListAnchorsIDs",Type:n,DefaultValue:[0,1]}];this._BuildPropertyValues(e)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Arrow.Length",!this.GetPropertyValue("Arrow.Fixed.Length")),this.SetPropertyInvisible("Arrow.Head.2.Position.Is.Paper",!0),this.SetPropertyInvisible("Arrow.Head.2.Position.X",!0),this.SetPropertyInvisible("Arrow.Head.2.Position.Y",!0);var e=this.GetProperty("Actor.Anchor.1")&&this.GetProperty("Actor.Anchor.1").GetPropertyValue()&&this.GetProperty("Actor.Anchor.1").GetPropertyValue().GetValueLink()&&this.GetProperty("Actor.Anchor.1").GetPropertyValue().GetValueLink().Value;this.SetPropertyInvisible("Arrow.Billboarded",!e),this.SetPropertyInvisible("Arrow.ZRotation",!(e&&!this.GetPropertyValue("Arrow.Billboarded")))}})}),define("DS/VCXWebDressup/VCXAttachSegmentNode",["DS/Mesh/MeshUtils","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXDressup_Spec","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXExtremityNode","DS/VCXWebSystem/VCXMathTools","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS"],function(e,t,i,r,o,a,n,s,l){"use strict";var p=o.extend({init:function(e){return this._parent(e),this.anchorID=e.anchorID,this._StartExtremity=new l.Vector3,this._BreakExtremity=new l.Vector3,this._EndExtremity=new l.Vector3,this._EndExtremityType=t.EExtremityType.Dot,e&&"number"==typeof e.endExtremityType&&(this._EndExtremityType=e.endExtremityType),this},_ComputePosBuffer:function(e){return e[0]=this.StartExtremity.x,e[1]=this.StartExtremity.y,e[2]=this.StartExtremity.z,e[3]=this.BreakExtremity.x,e[4]=this.BreakExtremity.y,e[5]=this.BreakExtremity.z,e[6]=this.EndExtremity.x,e[7]=this.EndExtremity.y,e[8]=this.EndExtremity.z,3},dispose:function(){this._Node&&this.removeChild(this._Node),this._ExtremityNode&&(this._ExtremityNode.dispose(),this.removeChild(this._ExtremityNode)),this._ExtremityStart&&(this._ExtremityStart.dispose(),this.removeChild(this._ExtremityStart)),this._ExtremityBreak&&(this._ExtremityBreak.dispose(),this.removeChild(this._ExtremityBreak)),this._parent()},_Build:function(){this._PrimitiveGroup=new e.PrimitiveGroup({editable:!0,lineGAS:new e.LineAttributes(this.GetColorPropertyValue("Collab.Attach.Line").GetThreeColor(),this.GetPropertyValue("Collab.Attach.Line.Width"))});var i=new e.Buffer({component:e.VertexComponentEnum.POSITION,data:new Float32Array(9),dimension:3}),r=new e.Buffer({indexBuffer:!0,data:new Uint16Array(4)});this._PrimitiveGroup.addBuffer(0,i),this._PrimitiveGroup.addBuffer(1,r),this._ComputePosBuffer(i.data);var o=r.data;o[0]=0,o[1]=1,o[2]=1,o[3]=2;var n=new e.VertexComponent({bufferId:0,indices:new e.IndexArray({bufferId:1,offset:0})}),l=new e.Primitive({nbIndices:4,connectivity:e.ConnectivityTypeEnum.LINES,fillGAS:new e.FillAttributes(this.GetColorPropertyValue("Collab.Attach.Line").GetThreeColor()),lineGAS:new e.LineAttributes(this.GetColorPropertyValue("Collab.Attach.Line").GetThreeColor(),this.GetPropertyValue("Collab.Attach.Line.Width"))});l.addVertexComponent(n),this._PrimitiveGroup.addPrimitive(l);var p=this.Modifiable.getLineMaterialParams("Collab.Attach.Line",this._lineMaterial,this._lastFrontLineType);if(Object.keys(p).length>0&&("number"==typeof p.type&&p.type!==this._lastFrontLineType&&(this._lastFrontLineType=p.type),this._lineMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(p,this._lineMaterial)),this._Node=s.createMeshNode(this._PrimitiveGroup,this._lineMaterial),this.add(this._Node),this.GetPropertyValue("Collab.Attach.BentDot")){var u={name:this.name+" ExtremityBreak",experience:this.ExperienceBase,modifiable:this.Modifiable,anchorID:this.anchorID,type:t.EExtremityType.Dot};this._ExtremityBreak=new a(u),this.add(this._ExtremityBreak)}this.handleLayers(!0)},preRender:function(t){if(this._parent(t),this.viewpointVisibility&&this.allAnchorsReady&&this.GlobalOpacity){if(this.setVisibility(!0),this._lineMaterial){this._lineMaterial.handleByPrerender=!0;let e=this.ExperienceBase.getManager("VCXPaperManager").UnitValueToPixel(this.Modifiable.GetPropertyValue("Collab.Attach.Line.Width"));this.Modifiable.GetPropertyValue("Collab.Lead.AlwaysVisible")?(this._lineMaterial.setLineWidth(e),this._lineMaterial.visible=!0):e>=1?(this._lineMaterial.setLineWidth(e),this._lineMaterial.visible=!0):this._lineMaterial.visible=!1}if(this._Node){var i=this._Node.getBuffer(e.VertexComponentEnum.POSITION);if(void 0!==i){var r=this._ComputePosBuffer(i);this._Node.updateBuffer(e.VertexComponentEnum.POSITION,0,r),this._Node.computeBoundingElements()}}if(this._ExtremityNode){var o=(new l.Vector3).subVectors(this.EndExtremity,this.BreakExtremity);this._ExtremityNode.SetReferential(n.getMatrixFromOVx(this.EndExtremity,o)),this._ExtremityNode.preRender(t)}if(this._ExtremityStart){o=(new l.Vector3).subVectors(this.BreakExtremity,this.StartExtremity);this._ExtremityStart.SetReferential(n.getMatrixFromOVx(this.StartExtremity,o)),this._ExtremityStart.preRender(t)}if(this._ExtremityBreak){o=(new l.Vector3).subVectors(this.BreakExtremity,this.StartExtremity);this._ExtremityBreak.SetReferential(n.getMatrixFromOVx(this.BreakExtremity,o)),this._ExtremityBreak.preRender(t)}}else this.setVisibility(!1)},update:function(e){if(this._parent(),this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var t=this._globalOpacity>0;t&&(this._Node||this._Build()),this._Node&&this._Node.setVisibility(t),this._ExtremityNode&&this._ExtremityNode.setVisibility(t),this._ExtremityBreak&&this._ExtremityBreak.setVisibility(t),this._ExtremityEnd&&this._ExtremityEnd.setVisibility(t)}if(!(this._globalOpacity<=0)){if(this._EndExtremityType=this.GetPropertyValue("Collab.Attach.ExtremityType"),this._previousEndExtremityType!==this._EndExtremityType&&(this._previousEndExtremityType=this._EndExtremityType,this.remove(this._ExtremityNode),this._ExtremityNode=null,this._EndExtremityType)){var i={name:this.name+" Extremity",modifiable:this.Modifiable,anchorID:this.anchorID,type:this._EndExtremityType};this._ExtremityNode=new a(i),this.add(this._ExtremityNode),this.handleLayers(!0)}if(this._ExtremityNode&&this._ExtremityNode.update(e),this._ExtremityStart&&this._ExtremityStart.update(e),this._ExtremityBreak&&this._ExtremityBreak.update(e),this._Node){var r=this.Modifiable.getLineMaterialParams("Collab.Attach.Line",this._lineMaterial,this._lastFrontLineType,this._globalOpacity);Object.keys(r).length>0&&("number"==typeof r.type&&r.type!==this._lastFrontLineType&&(this._lastFrontLineType=r.type),this._lineMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(r,this._lineMaterial)),(!this._Node.material||this._lineMaterial&&this._Node.material.id!==this._lineMaterial.id)&&this._Node.setMaterial(this._lineMaterial),this.handleLayers()}}},postUpdate:function(e){this._parent(),this._ExtremityNode&&this._ExtremityNode.postUpdate(e),this._ExtremityStart&&this._ExtremityStart.postUpdate(e),this._ExtremityBreak&&this._ExtremityBreak.postUpdate(e)}});return Object.defineProperty(p.prototype,"StartExtremity",{enumerable:!0,get:function(){return this._StartExtremity},set:function(e){this._StartExtremity=e}}),Object.defineProperty(p.prototype,"BreakExtremity",{enumerable:!0,get:function(){return this._BreakExtremity},set:function(e){this._BreakExtremity=e}}),Object.defineProperty(p.prototype,"EndExtremity",{enumerable:!0,get:function(){return this._EndExtremity},set:function(e){this._EndExtremity=e}}),Object.defineProperty(p.prototype,"EndExtremityType",{enumerable:!0,get:function(){return this._EndExtremityType},set:function(e){this._EndExtremityType=e}}),p}),define("DS/VCXWebDressup/VCXArrowModifiableView",["DS/VCXWebDressup/VCXDressupModifiableView"],function(e){"use strict";var t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{"Group.Arrow.Head":["Arrow.Body.Color","Arrow.Body.Color.Opacity","Arrow.Width.1","Arrow.Head.ShowMode","Arrow.Head.Length","Arrow.Head.Size","Arrow.Head.Shape"],"Group.Arrow.Head.2":["Arrow.Body.2.Color","Arrow.Body.2.Color.Opacity","Arrow.Width.2","Arrow.Head.2.ShowMode","Arrow.Head.2.Length","Arrow.Head.2.Size","Arrow.Head.2.Shape"],"Group.Border":["Collab.Border.Line.Color","Collab.Border.Line.Color.Opacity","Collab.Border.Line.Width","Collab.Border.Line.Type","Collab.Border.Line.2.Color","Collab.Border.Line.2.Color.Opacity"]}),e}});return t.prototype._getGroupsPriorities=function(t){var i=e.prototype._getGroupsPriorities();return UWA.extend(i,{"Group.Essentials":0,"Group.Arrow":10,"Group.Arrow.Head":20,"Group.Arrow.Head.2":30,"Group.Border":35,"Group.Actions":100}),i},t}),define("DS/VCXWebDressup/VCXArrowLinearModifiableView",["DS/VCXWebDressup/VCXArrowModifiableView"],function(e){"use strict";return e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{"Group.Arrow":["Arrow.Fixed.Length","Arrow.Length","Arrow.Scale","Collab.Is.Paper","Arrow.Billboarded","Arrow.ZRotation"]}),e}})}),define("DS/VCXWebDressup/VCXArrowCircularModifiableView",["DS/VCXWebDressup/VCXArrowModifiableView"],function(e){"use strict";var t=e.extend({init:function(){this._parent()},getGroupPropertiesOrders:function(){var e=this._parent()||{};return UWA.extend(e,{"Group.Arrow":["Arrow.Circular.Radius","Arrow.Circular.Angle","Arrow.Circular.Step","Arrow.Circular.Flat","Arrow.Scale","Collab.Is.Paper"]}),e}});return t.prototype._getGroupsPriorities=function(t){return e.prototype._getGroupsPriorities()},t}),define("DS/VCXWebDressup/VCXMarkupPrepareRenderToTexture",["require","exports","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebDressup/VCXDressupPrepareRenderToTexture"],function(e,t,i,r,o,a){"use strict";return class extends a{constructor(){super(),this.addOrNew("white",["Collab.Text.Color","Collab.Background.Color","Collab.Image.Color","Collab.Border.Line.Color","Collab.Attach.Line.Color","Collab.Attach.ExtremityType.Additionnal"]),this.addOrNew("visibletop",["Collab.3D.Paper.Is.Background"])}GetType(){return"VCXMarkupPrepareRenderToTexture"}getValueForMask(e){return"Collab.Attach.ExtremityType.Additionnal"===e?new i(o.EExtremityType.White):"Collab.3D.Paper.Is.Background"===e?new r(!1):super.getValueForMask(e)}}}),define("DS/VCXWebDressup/VCXMeasurementPrepareRenderToTexture",["require","exports","DS/VCXWebDressup/VCXMarkupPrepareRenderToTexture"],function(e,t,i){"use strict";return class extends i{constructor(){super(),this.addOrNew("white",["Collab.Measurement.Plane.Color","Collab.Measurement.Plane.Border.Color","Collab.Measurement.Additional.Color","Collab.Measurement.Additional.2.Color","Collab.Measurement.Additional.3.Color","Collab.Measurement.Additional.4.Color"])}async prepareRender(e,t){var i,r;let o=null===(r=null===(i=this._object)||void 0===i?void 0:i.QueryInterface("W3AISGNodeHolder"))||void 0===r?void 0:r.getSGNode();o._primaryAdditionalGeometryMaterial=null,o._secondaryAdditionalGeometryMaterial=null,o._thirdAdditionalGeometryMaterial=null,o._fourthAdditionalGeometryMaterial=null,super.prepareRender(e,t)}async postRender(e,t){super.postRender(e,t)}GetType(){return"VCXMeasurementPrepareRenderToTexture"}}}),define("DS/VCXWebDressup/VCXPanelPrepareRenderToTexture",["require","exports","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebDressup/VCXMarkupPrepareRenderToTexture"],function(e,t,i,r){"use strict";return class extends r{constructor(){super(),this.addOrNew("white",["Collab.Image.Doc.PrepareRender"])}GetType(){return"VCXPanelPrepareRenderToTexture"}getValueForMask(e){return"Collab.Image.Doc.PrepareRender"===e?new i(!0):super.getValueForMask(e)}}}),define("DS/VCXWebDressup/VCXPolylineNode",["DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXDressup_Spec","DS/VCXWebDressup/VCXDressupNode","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory"],function(e,t,i,r,o,a){"use strict";return i.extend({init:function(e){return this._parent(e),this},_getPosVectArray:function(){var e=[],t=0,i=this;if(this.Modifiable._Anchors&&Object.keys(this.Modifiable._Anchors).length>0){this.Modifiable.processAnchorsIDs(function(o){var a=i.GetAnchorWorldMatrix(o);if(a){var n=new r.Vector3(0,0,0);n.getPositionFromMatrix(a),e[t++]=n}});var o=t+1;return this._currentPointsNumber!==o?-1:(this.GetPropertyValue("Polyline.Is.Closed")?e[o-1]=e[0].clone():e[o-1]=e[o-2].clone(),e)}console.log("No point")},_ComputePosBuffer:function(e){if(this._currentPointsNumber!==this._getCurrentPointsNumber())return-1;var t=this._getPosVectArray();if(!(Array.isArray(t)&&t.length>0))return t;for(var i=t.length,r=0;r<i;r++)e[3*r+0]=t[r].x,e[3*r+1]=t[r].y,e[3*r+2]=t[r].z;return i},_Build:function(){if(0!==this.Modifiable.getAnchorsCount()){this._currentPointsNumber=this._getCurrentPointsNumber();var e=this._getPosVectArray();if(!Array.isArray(e)||e.length<2)console.log("Can't build the polyline");else{for(var t=this._currentPointsNumber-1,i=new Uint16Array(2*t),r=0;r<t;++r)i[2*r+0]=r,i[2*r+1]=r+1;if(!this.Modifiable.GetPropertyValue("Actor.IsAlwaysOnTop")&&this.Modifiable.GetPropertyValue("Collab.Body.Line.UseHiddenStyle")){var n=this.Modifiable.getLineMaterialParams("Collab.Body.Line.Back",this._lineBackMaterial,this._lastBackLineType);Object.keys(n).length>0&&("number"==typeof n.type&&n.type!==this._lastBackLineType&&(this._lastBackLineType=n.type),this._lineBackMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(n,this._lineBackMaterial),n.backMaterial=this._lineBackMaterial)}else if(this._lineBackMaterial&&0!==this._lineBackMaterial.opacity){var s=this.ExperienceBase.getManager("VCXMaterialManager");this._lineBackMaterial=s.getLineMaterialFromParams({opacity:0},this._lineBackMaterial)}var l=this.Modifiable.getLineMaterialParams("Collab.Body.Line",this._lineMaterial,this._lastFrontLineType);Object.keys(l).length>0&&("number"==typeof l.type&&l.type!==this._lastFrontLineType&&(this._lastFrontLineType=l.type),this._lineBackMaterial&&(l.backMaterial=this._lineBackMaterial),this._lineMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(l,this._lineMaterial));var p={points:e,idx:i,editable:!0,drawMode:o.ConnectivityTypeEnum.LINES,material:this._lineMaterial};this._Node=a.createLineNode(p),this._Node.setVisibilityInTree(!1),this.add(this._Node)}}else console.log("No point")},preRender:function(e){if(this._parent(e),this.viewpointVisibility&&this.allAnchorsReady&&this.GlobalOpacity){this.setVisibility(!0);var t=this.ExperienceBase.getManager("VCXPaperManager");if(this._lineBackMaterial){this._lineBackMaterial.handleByPrerender=!0;let e=t.UnitValueToPixel(this.Modifiable.GetPropertyValue("Collab.Body.Line.Back.Width"));e>=1?(this._lineBackMaterial.setLineWidth(e),this._lineBackMaterial.visible=!0):this._lineBackMaterial.visible=!1}if(this._lineMaterial){this._lineMaterial.handleByPrerender=!0;let e=t.UnitValueToPixel(this.Modifiable.GetPropertyValue("Collab.Body.Line.Width"));e>=1?(this._lineMaterial.setLineWidth(e),this._lineMaterial.visible=!0):this._lineMaterial.visible=!1}return!0}this.setVisibility(!1)},update:function(e){if(this._parent(),this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var t=this._globalOpacity>0;t&&(this._Node||this._Build()),this._Node&&(this._Node.setVisibility(t),this.setVisibility(t))}if(!(this._globalOpacity<=0)&&this._Node){var i=this._Node.getBuffer(o.VertexComponentEnum.POSITION);if(void 0!==i){var r=this._ComputePosBuffer(i);-1===r?(this.remove(this._Node),this._Node=null,this._Build()):"number"==typeof r&&(this._Node.updateBuffer(o.VertexComponentEnum.POSITION,0,r),this._Node.computeBoundingElements())}var a=this.ExperienceBase.getManager("VCXMaterialManager");if(!this.Modifiable.GetPropertyValue("Actor.IsAlwaysOnTop")&&this.Modifiable.GetPropertyValue("Collab.Body.Line.UseHiddenStyle")){var n=this.Modifiable.getLineMaterialParams("Collab.Body.Line.Back",this._lineBackMaterial,this._lastBackLineType,this._globalOpacity);Object.keys(n).length>0&&("number"==typeof n.type&&n.type!==this._lastBackLineType&&(this._lastBackLineType=n.type),this._lineBackMaterial=a.getLineMaterialFromParams(n,this._lineBackMaterial),n.backMaterial=this._lineBackMaterial)}else this._lineBackMaterial&&0!==this._lineBackMaterial.opacity&&(this._lineBackMaterial=a.getLineMaterialFromParams({opacity:0},this._lineBackMaterial));var s=this.Modifiable.getLineMaterialParams("Collab.Body.Line",this._lineMaterial,this._lastFrontLineType,this._globalOpacity);s&&s.type&&"number"==typeof s.type&&s.type!==this._lastFrontLineType&&(this._lastFrontLineType=s.type),!this._lineBackMaterial||this._lineMaterial&&this._lineMaterial.backMaterial===this._lineBackMaterial||(s.backMaterial=this._lineBackMaterial),Object.keys(s).length>0&&(this._lineMaterial=a.getLineMaterialFromParams(s,this._lineMaterial)),this._Node&&(!this._Node.material||this._lineMaterial&&this._Node.material.id!==this._lineMaterial.id)&&this._Node.setMaterial(this._lineMaterial),this.handleLayers()}},isNodeBuilt:function(){return Boolean(this._Node)},_getCurrentPointsNumber:function(){return this.Modifiable.getAnchorsCount()+1}})}),define("DS/VCXWebDressup/VCXPolylineSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXPolylineNode"],function(e,t){"use strict";return e.extend({init:function(){},getWorldMatrix:function(e){var t=this.GetObject()._experienceBase.getManager("VCXContextManager"),i=this.GetObject().getWorkingRootPathElement().getWorldMatrix(t.getMainViewer()),r=this.QueryInterface("VCXIModifiable");if(r)return this._actorPosition=r.GetFramePropertyValue("Actor.Position"),this._actorPosition&&i.multiply(this._actorPosition),i},buildSGNode:function(){if(!this._sgNode){var e={name:"Polyline",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_PolylineLeaf.png")}return this._parent()}})});__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXLabel_Spec",["require","exports","DS/VCXWebDressup/VCXMarkup_Spec"],function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{constructor(){super(...arguments),this._IsAnchorDependent=!0}}return r.prototype.getDefaultName=function(){return"Label"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXLabel_Spec"}}),r.prototype.dressupGroupName="Annotations",r});__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXMeasurement_Spec",["require","exports","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXLabel_Spec","DS/VCXWebSystem/VCXMathTools","DS/VCXWebDressup/VCXMarkup_Spec"],function(e,t,i,r,o,a){"use strict";r=__importDefault(r),o=__importDefault(o),a=__importDefault(a);class n extends r.default{constructor(){super(),this.IsAnchorDependent=!0,this._keyValues={}}getAttachType(){var e=this.QueryInterface("VCXIModifiable");if(e)switch(e.GetPropertyValue("Collab.Measurement.Type")){case n.EType.Arc:case n.EType.GDT:case n.EType.Area:case n.EType.Volume:case n.EType.PipeLength:case n.EType.AreaMultiplePoints:case n.EType.VolumeMultiplePoints:case n.EType.PipeLengthMultiplePoints:case n.EType.Coord:case n.EType.Projected:return n.EAttachTypeMeasurement.Simple;case n.EType.Angle:return n.EAttachTypeMeasurement.Double;case n.EType.BetweenAxis:case n.EType.BetweenLines:case n.EType.BetweenPlanes:case n.EType.PlanePoint:case n.EType.LinePoint:case n.EType.BetweenPoints:case n.EType.Linear:case n.EType.BetweenCentres:return n.EAttachTypeMeasurement.Double;case n.EType.Diameter:case n.EType.Radius:return e.GetPropertyValue("Collab.Measurement.Attach.Type")}}getKeyPoints(e,t){var r=this.QueryInterface("VCXIModifiable");if(r){switch(this._keyValues.labelLineExtremity0=o.default.getOFromMatrix(t.getMatrix()),this.newLabel0Position=this._keyValues.labelLineExtremity0,r.GetPropertyValue("Collab.Measurement.Type")){case n.EType.Arc:case n.EType.GDT:case n.EType.Area:case n.EType.Volume:case n.EType.PipeLength:case n.EType.AreaMultiplePoints:case n.EType.VolumeMultiplePoints:case n.EType.PipeLengthMultiplePoints:case n.EType.BetweenAxis:case n.EType.BetweenCentres:case n.EType.Coord:case n.EType.Projected:break;case n.EType.Angle:this._keyValues.angle=!0,this._keyValues.measurementExtremity1||this.getValue(e,t);break;case n.EType.BetweenLines:case n.EType.BetweenPlanes:case n.EType.PlanePoint:case n.EType.LinePoint:this._keyValues.measurementExtremity1||this.getValue(e,t);break;case n.EType.Linear:this._getMeasurementExtremity1(),this._keyValues.measurementExtremity2=new i.Vector3(this.getValue(e,t),0,0).applyMatrix4(this._keyValues.measurementExtremity1Frame);break;case n.EType.BetweenPoints:var s=(new i.Vector3).subVectors(this._getMeasurementExtremity2(),this._getMeasurementExtremity1()).normalize();this._keyValues.measurementExtremity1Frame=o.default.getMatrixFromOVxVy(this._keyValues.measurementExtremity1,s,this.newLabel0Position);break;case n.EType.Radius:case n.EType.Diameter:if(!this._keyValues.labelLineExtremity1||!this._keyValues.labelLineExtremity2){this._keyValues.measurementExtremity0Frame=r.GetAnchorWorldMatrix(0,e),this._keyValues.measurementExtremity0=o.default.getOFromMatrix(this._keyValues.measurementExtremity0Frame),this._keyValues.value=r.GetPropertyValue("Collab.Measurement.Radius");var l=(new i.Vector3).subVectors(this.newLabel0Position,this._keyValues.measurementExtremity0),p=o.default.getVzFromMatrix(this._keyValues.measurementExtremity0Frame);p.normalize();s=(new i.Vector3).crossVectors(p,l).normalize();r.GetPropertyValue("Collab.Measurement.Type")===n.EType.Radius?(s.multiplyScalar(this._keyValues.value),this._keyValues.measurementExtremity1=this._keyValues.measurementExtremity0.clone()):(s.multiplyScalar(.5*this._keyValues.value),this._keyValues.measurementExtremity1=this._keyValues.measurementExtremity0.clone().add(s)),this._keyValues.measurementExtremity2=this._keyValues.measurementExtremity0.clone().sub(s),s.negate().normalize(),this._keyValues.measurementExtremity1Frame=o.default.getMatrixFromOVxVy(this._keyValues.measurementExtremity1,s,p),this._keyValues.labelLineExtremity1=this._keyValues.measurementExtremity1.clone().add(l),this._keyValues.labelLineExtremity2=this._keyValues.measurementExtremity2.clone().add(l),this._keyValues.arrowLineExtremity1=this._keyValues.labelLineExtremity1,this._keyValues.arrowLineExtremity2=this._keyValues.labelLineExtremity2}}switch(r.GetPropertyValue("Collab.Measurement.Type")){case n.EType.Arc:case n.EType.Area:case n.EType.Volume:case n.EType.PipeLength:case n.EType.AreaMultiplePoints:case n.EType.VolumeMultiplePoints:case n.EType.PipeLengthMultiplePoints:case n.EType.Radius:case n.EType.Diameter:case n.EType.GDT:case n.EType.Coord:case n.EType.Projected:break;case n.EType.Angle:case n.EType.BetweenLines:case n.EType.BetweenPlanes:case n.EType.LinePoint:case n.EType.BetweenPoints:case n.EType.PlanePoint:case n.EType.BetweenAxis:case n.EType.BetweenCentres:if(t.PositioningType<=a.default.EPositionType.Free2D){s=(new i.Vector3).subVectors(this._getMeasurementExtremity2(),this._getMeasurementExtremity1()).normalize();var u=(new i.Vector3).subVectors(this.newLabel0Position,e.viewpoint.getEyePosition()).normalize(),h=o.default.getNearestDistanceBetween2Lines(this.newLabel0Position,u,this._getMeasurementExtremity1(),s);this.newLabel0Position=h.p1}}switch(r.GetPropertyValue("Collab.Measurement.Type")){case n.EType.Arc:case n.EType.Area:case n.EType.Volume:case n.EType.PipeLength:case n.EType.AreaMultiplePoints:case n.EType.VolumeMultiplePoints:case n.EType.PipeLengthMultiplePoints:case n.EType.Radius:case n.EType.Diameter:case n.EType.GDT:case n.EType.Coord:case n.EType.Projected:break;case n.EType.Angle:case n.EType.BetweenLines:case n.EType.BetweenPlanes:case n.EType.LinePoint:case n.EType.BetweenPoints:case n.EType.PlanePoint:case n.EType.BetweenAxis:case n.EType.Linear:case n.EType.BetweenCentres:if(!this._keyValues.labelLineExtremity1||!this._keyValues.labelLineExtremity2)if(this._keyValues.angle){var d=(new i.Plane).setFromNormalAndCoplanarPoint(o.default.getVzFromMatrix(this._keyValues.measurementExtremity0Frame),this._keyValues.measurementExtremity0);this._keyValues.projectedPoint=d.projectPoint(this.newLabel0Position),this._keyValues.radius=this._keyValues.projectedPoint.distanceTo(this._keyValues.measurementExtremity1);var c=Math.max(this._keyValues.radius,this._keyValues.measurementAnglePoint1.distanceTo(this._keyValues.measurementExtremity0)),y=(new i.Vector3).subVectors(this._keyValues.measurementExtremity5,this._keyValues.measurementExtremity1).normalize();this._keyValues.labelLineExtremity1=this._keyValues.measurementExtremity1.clone().add(y.clone().multiplyScalar(c)),this._keyValues.labelLineExtremity1Frame=this._keyValues.measurementExtremity1Frame.clone().setPosition(this._keyValues.labelLineExtremity1),this._keyValues.arrowLineExtremity1=this._keyValues.measurementExtremity1.clone().add(y.clone().multiplyScalar(this._keyValues.radius));c=Math.max(this._keyValues.radius,this._keyValues.measurementAnglePoint2.distanceTo(this._keyValues.measurementExtremity0));r.GetPropertyValue("Collab.Measurement.Type")===n.EType.BetweenLines&&(c=Math.max(this._keyValues.radius,r.GetPropertyValue("Collab.Measurement.Length2")));var C=(new i.Vector3).subVectors(this._keyValues.measurementExtremity6,this._keyValues.measurementExtremity2).normalize();this._keyValues.labelLineExtremity2=this._keyValues.measurementExtremity2.clone().add(C.clone().multiplyScalar(c)),this._keyValues.labelLineExtremity2Frame=this._keyValues.measurementExtremity1Frame.clone().setPosition(this._keyValues.labelLineExtremity2),this._keyValues.arrowLineExtremity2=this._keyValues.measurementExtremity2.clone().add(C.clone().multiplyScalar(this._keyValues.radius))}else{s=(new i.Vector3).subVectors(this._getMeasurementExtremity2(),this._getMeasurementExtremity1());var m=(new i.Vector3).subVectors(this.newLabel0Position,this._getMeasurementExtremity1()),f=(new i.Vector3).crossVectors(s,m).normalize(),V=(new i.Vector3).crossVectors(f,s).normalize(),b=m.dot(V);V.multiplyScalar(b),this._keyValues.labelLineExtremity1=V.clone().add(this._getMeasurementExtremity1()),this._keyValues.labelLineExtremity2=V.clone().add(this._getMeasurementExtremity1()).add(s),this._keyValues.arrowLineExtremity1=this._keyValues.labelLineExtremity1,this._keyValues.arrowLineExtremity2=this._keyValues.labelLineExtremity2}}}return this._keyValues}_getMeasurementExtremity1(){if(!this._keyValues.measurementExtremity1){var e=this.QueryInterface("VCXIModifiable");e&&(this._keyValues.measurementExtremity1Frame=e.GetAnchorWorldMatrix(0,null),this._keyValues.measurementExtremity1=o.default.getOFromMatrix(this._keyValues.measurementExtremity1Frame))}return this._keyValues.measurementExtremity1}_getMeasurementExtremity2(){if(!this._keyValues.measurementExtremity2){var e=this.QueryInterface("VCXIModifiable");e&&(this._keyValues.measurementExtremity2Frame=e.GetAnchorWorldMatrix(1,null),this._keyValues.measurementExtremity2=o.default.getOFromMatrix(this._keyValues.measurementExtremity2Frame))}return this._keyValues.measurementExtremity2}_getMeasurementExtremity3(){if(!this._keyValues.measurementExtremity3){var e=this.QueryInterface("VCXIModifiable");e&&(this._keyValues.measurementExtremity3Frame=e.GetAnchorWorldMatrix(2,null),this._keyValues.measurementExtremity3=o.default.getOFromMatrix(this._keyValues.measurementExtremity3Frame))}return this._keyValues.measurementExtremity3}getValue(e,t){if(void 0===this._keyValues.value){this.newLabel0Position||(this.newLabel0Position=o.default.getOFromMatrix(this.getReferential()));var r=this.QueryInterface("VCXIModifiable");if(r)switch(r.GetPropertyValue("Collab.Measurement.Type")){case n.EType.GDT:case n.EType.Projected:this._keyValues.value=r._Properties["Collab.Measurement.Value"].GetPropertyValue().Value;break;case n.EType.Radius:case n.EType.Diameter:this._keyValues.value=r.GetPropertyValue("Collab.Measurement.Radius");break;case n.EType.Arc:case n.EType.PipeLength:case n.EType.PipeLengthMultiplePoints:case n.EType.Linear:this._keyValues.value=r.GetPropertyValue("Collab.Measurement.Length");break;case n.EType.Coord:this._keyValues.value=0;break;case n.EType.Area:case n.EType.AreaMultiplePoints:this._keyValues.value=r.GetPropertyValue("Collab.Measurement.Area");break;case n.EType.Volume:case n.EType.VolumeMultiplePoints:this._keyValues.value=r.GetPropertyValue("Collab.Measurement.Volume");break;case n.EType.BetweenAxis:case n.EType.BetweenPoints:case n.EType.BetweenCentres:this._keyValues.value=this._getMeasurementExtremity1().distanceTo(this._getMeasurementExtremity2());break;case n.EType.Angle:this._keyValues.angle=!0,this._getMeasurementExtremity1(),this._getMeasurementExtremity2(),this._getMeasurementExtremity3(),this._keyValues.measurementAnglePoint1=this._keyValues.measurementExtremity3.clone(),this._keyValues.measurementAnglePoint2=this._keyValues.measurementExtremity2.clone(),this._keyValues.measurementExtremity4=this._keyValues.measurementExtremity2.clone(),this._keyValues.measurementExtremity4Frame=this._keyValues.measurementExtremity2Frame.clone().setPosition(this._keyValues.measurementExtremity4),this._keyValues.measurementExtremity2=this._keyValues.measurementExtremity1.clone(),this._keyValues.measurementExtremity2Frame=this._keyValues.measurementExtremity1Frame.clone().setPosition(this._keyValues.measurementExtremity2),this._keyValues.measurementExtremity5=this._keyValues.measurementExtremity3.clone(),this._keyValues.measurementExtremity5Frame=this._keyValues.measurementExtremity3Frame.clone().setPosition(this._keyValues.measurementExtremity5),this._keyValues.measurementExtremity6=this._keyValues.measurementExtremity4.clone(),this._keyValues.measurementExtremity6Frame=this._keyValues.measurementExtremity4Frame.clone().setPosition(this._keyValues.measurementExtremity6);var a=(new i.Vector3).subVectors(this._keyValues.measurementExtremity3,this._keyValues.measurementExtremity1).normalize(),s=(new i.Vector3).subVectors(this._keyValues.measurementExtremity4,this._keyValues.measurementExtremity2).normalize();this._keyValues.value=a.angleTo(s),this._keyValues.measurementExtremity0=this._keyValues.measurementExtremity1,this._keyValues.measurementExtremity0Frame=o.default.getMatrixFromOVxVy(this._keyValues.measurementExtremity1,a,s);break;case n.EType.BetweenLines:if(this._getMeasurementExtremity1(),this._getMeasurementExtremity2(),V=o.default.getNearestDistanceBetween2Lines(this._getMeasurementExtremity1(),o.default.getVxFromMatrix(this._keyValues.measurementExtremity1Frame),this._getMeasurementExtremity2(),o.default.getVxFromMatrix(this._keyValues.measurementExtremity2Frame)))if(this._keyValues.measurementExtremity3Frame=this._keyValues.measurementExtremity1Frame.clone(),this._keyValues.measurementExtremity3=this._keyValues.measurementExtremity1.clone(),this._keyValues.measurementExtremity4Frame=this._keyValues.measurementExtremity2Frame.clone(),this._keyValues.measurementExtremity4=this._keyValues.measurementExtremity2.clone(),Math.abs(V.d)<=.001){this._keyValues.angle=!0,"Angle"!==r._Properties["Collab.Measurement.Value"].GetPropertyInfo().GetUnitType()&&r._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Angle");var l=o.default.getVxFromMatrix(this._keyValues.measurementExtremity1Frame).normalize(),p=o.default.getVxFromMatrix(this._keyValues.measurementExtremity2Frame).normalize();if(this.newLabel0Position){var u=(new i.Vector3).crossVectors(l,p).normalize(),h=(new i.Plane).setFromNormalAndCoplanarPoint(u,V.p1);this._keyValues.projectedPoint=h.projectPoint(this.newLabel0Position),this._keyValues.radius=this._keyValues.projectedPoint.distanceTo(V.p1);var d=this._keyValues.projectedPoint.clone().sub(V.p1).normalize(),c=(new i.Vector3).crossVectors(l,d).normalize();u.dot(c)<0&&p.negate();u=(new i.Vector3).crossVectors(p,l).normalize();var y=this._keyValues.projectedPoint.clone().sub(V.p2).normalize();c=(new i.Vector3).crossVectors(p,y).normalize();u.dot(c)<0&&l.negate()}this._keyValues.measurementExtremity5=V.p1.clone().add(l.clone().multiplyScalar(this._keyValues.radius)),this._keyValues.measurementExtremity5Frame=this._keyValues.measurementExtremity1Frame.clone().setPosition(this._keyValues.measurementExtremity5),this._keyValues.measurementExtremity6=V.p2.clone().add(p.clone().multiplyScalar(this._keyValues.radius)),this._keyValues.measurementExtremity6Frame=this._keyValues.measurementExtremity2Frame.clone().setPosition(this._keyValues.measurementExtremity6),this._keyValues.measurementAnglePoint1=V.p1.clone().add(l.clone().multiplyScalar(r.GetPropertyValue("Collab.Measurement.Length1"))),this._keyValues.measurementAnglePoint2=V.p2.clone().add(p.clone().multiplyScalar(r.GetPropertyValue("Collab.Measurement.Length2"))),this._keyValues.value=l.angleTo(p),this._keyValues.measurementExtremity1=V.p1,this._keyValues.measurementExtremity2=V.p2,this._keyValues.measurementExtremity0=V.p1,this._keyValues.measurementExtremity0Frame=o.default.getMatrixFromOVxVy(V.p1,l,p)}else this._keyValues.angle=!1,"Length"!==r._Properties["Collab.Measurement.Value"].GetPropertyInfo().GetUnitType()&&r._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Length"),this._keyValues.measurementExtremity1=V.p1,this._keyValues.measurementExtremity2=V.p2,this._keyValues.value=V.d;break;case n.EType.LinePoint:this._getMeasurementExtremity1(),this._getMeasurementExtremity2(),this._keyValues.measurementExtremity3Frame=this._keyValues.measurementExtremity1Frame.clone(),this._keyValues.measurementExtremity3=this._keyValues.measurementExtremity1.clone(),new i.Ray(this._keyValues.measurementExtremity3,o.default.getVxFromMatrix(this._keyValues.measurementExtremity3Frame)).closestPointToPoint(this._keyValues.measurementExtremity2,this._keyValues.measurementExtremity1),this._keyValues.value=this._keyValues.measurementExtremity2.distanceTo(this._keyValues.measurementExtremity1);break;case n.EType.PlanePoint:if(!this._keyValues.measurementExtremity1){this._getMeasurementExtremity1();var C=(new i.Plane).setFromNormalAndCoplanarPoint(o.default.getVzFromMatrix(this._keyValues.measurementExtremity1Frame),this._getMeasurementExtremity1());this._keyValues.measurementExtremity3Frame=this._keyValues.measurementExtremity1Frame.clone(),this._keyValues.measurementExtremity3=o.default.getOFromMatrix(this._keyValues.measurementExtremity3Frame),this._keyValues.measurementExtremity4Frame=this._keyValues.measurementExtremity1Frame.clone(),this._getMeasurementExtremity2(),this._keyValues.value=Math.abs(C.distanceToPoint(this._keyValues.measurementExtremity2)),this._keyValues.measurementExtremity1=C.projectPoint(this._keyValues.measurementExtremity2),this._keyValues.measurementExtremity1Frame.setPosition(this._keyValues.measurementExtremity1);var m=(new i.Plane).setFromNormalAndCoplanarPoint(o.default.getVzFromMatrix(this._keyValues.measurementExtremity1Frame),this._getMeasurementExtremity2());this._keyValues.measurementExtremity4=m.projectPoint(this._keyValues.measurementExtremity3),this._keyValues.measurementExtremity4Frame.setPosition(this._keyValues.measurementExtremity4)}break;case n.EType.BetweenPlanes:if(!this._keyValues.measurementExtremity1){this._getMeasurementExtremity1();C=(new i.Plane).setFromNormalAndCoplanarPoint(o.default.getVzFromMatrix(this._keyValues.measurementExtremity1Frame),this._getMeasurementExtremity1());this._getMeasurementExtremity2();m=(new i.Plane).setFromNormalAndCoplanarPoint(o.default.getVzFromMatrix(this._keyValues.measurementExtremity2Frame),this._getMeasurementExtremity2());this._keyValues.measurementExtremity3=this._keyValues.measurementExtremity1.clone(),this._keyValues.measurementExtremity3Frame=this._keyValues.measurementExtremity1Frame.clone();var f=o.default.getVzFromMatrix(this._keyValues.measurementExtremity2Frame).normalize().dot(o.default.getVzFromMatrix(this._keyValues.measurementExtremity1Frame).normalize());if(Math.abs(f)>=.999)this._keyValues.measurementExtremity4=m.projectPoint(this._keyValues.measurementExtremity1),this._keyValues.measurementExtremity4Frame=this._keyValues.measurementExtremity2Frame.clone().setPosition(this._keyValues.measurementExtremity4),this._keyValues.measurementExtremity5=C.projectPoint(this._keyValues.measurementExtremity2),this._keyValues.measurementExtremity5Frame=this._keyValues.measurementExtremity1Frame.clone().setPosition(this._keyValues.measurementExtremity5),this._keyValues.measurementExtremity6=this._keyValues.measurementExtremity2.clone(),this._keyValues.measurementExtremity6Frame=this._keyValues.measurementExtremity2Frame.clone(),this._keyValues.value=Math.abs(C.distanceToPoint(this._keyValues.measurementExtremity2)),this._keyValues.angle=!1,"Length"!==r._Properties["Collab.Measurement.Value"].GetPropertyInfo().GetUnitType()&&r._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Length"),this._keyValues.measurementExtremity1=(new i.Vector3).addVectors(this._keyValues.measurementExtremity3,this._keyValues.measurementExtremity5).multiplyScalar(.5),this._keyValues.measurementExtremity1Frame.setPosition(this._keyValues.measurementExtremity1),this._keyValues.measurementExtremity2=(new i.Vector3).addVectors(this._keyValues.measurementExtremity4,this._keyValues.measurementExtremity6).multiplyScalar(.5),this._keyValues.measurementExtremity2Frame.setPosition(this._keyValues.measurementExtremity2);else{this._keyValues.angle=!0,this._keyValues.measurementAnglePoint2=this._keyValues.measurementExtremity2.clone(),"Angle"!==r._Properties["Collab.Measurement.Value"].GetPropertyInfo().GetUnitType()&&r._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Angle");var V,b=o.default.getVzFromMatrix(this._keyValues.measurementExtremity1Frame).normalize(),P=o.default.getVzFromMatrix(this._keyValues.measurementExtremity2Frame).normalize(),g=(u=(new i.Vector3).crossVectors(b,P).normalize(),(new i.Vector3).crossVectors(b,u).normalize()),_=(new i.Vector3).crossVectors(P,u).normalize();if((V=o.default.getNearestDistanceBetween2Lines(this._getMeasurementExtremity1(),g,this._getMeasurementExtremity2(),_)).p2){var S=V.p2,M=this._keyValues.measurementExtremity1.clone().add(V.p2).sub(V.p1),G=this._keyValues.measurementExtremity2.clone();let e=(new i.Vector3).subVectors(M,S),t=(new i.Vector3).subVectors(G,S);if(this.newLabel0Position){h=(new i.Plane).setFromNormalAndCoplanarPoint(u,S);this._keyValues.projectedPoint=h.projectPoint(this.newLabel0Position),this._keyValues.radius=this._keyValues.projectedPoint.distanceTo(S),this._keyValues.measurementAnglePoint1=h.projectPoint(this._keyValues.measurementExtremity1)}this._keyValues.measurementExtremity0=S.clone(),this._keyValues.measurementExtremity0Frame=o.default.getMatrixFromOVxVy(S,e,t),this._keyValues.measurementExtremity4=this._keyValues.measurementExtremity2.clone(),this._keyValues.measurementExtremity4Frame=this._keyValues.measurementExtremity2Frame.clone(),this._keyValues.measurementExtremity5=S.clone().add(e.clone().multiplyScalar(this._keyValues.radius)),this._keyValues.measurementExtremity5Frame=o.default.getMatrixFromOVxVz(S,e,o.default.getVzFromMatrix(this._keyValues.measurementExtremity1Frame)),this._keyValues.measurementExtremity6=S.clone().add(t.clone().multiplyScalar(this._keyValues.radius)),this._keyValues.measurementExtremity6Frame=o.default.getMatrixFromOVxVz(S,t,o.default.getVzFromMatrix(this._keyValues.measurementExtremity2Frame)),this._keyValues.value=e.angleTo(t),this._keyValues.measurementExtremity1=S.clone(),this._keyValues.measurementExtremity2=S.clone()}}}}}return this._keyValues.value}getReferential(){if(this._keyValues.referential)return this._keyValues.referential;var e=this.QueryInterface("VCXIModifiable");if(e)switch(e.GetPropertyValue("Collab.Measurement.Type")){case n.EType.LinePoint:case n.EType.BetweenLines:var t,r=e.GetAnchorWorldMatrix(0,null),a=o.default.getOFromMatrix(r),s=e.GetAnchorWorldMatrix(1,null),l=o.default.getOFromMatrix(s),p=(new i.Vector3).addVectors(l,a).multiplyScalar(.5);return(t=this.QueryInterface("W3AISGNodeHolder"))&&(this._keyValues.referential=t.getAnchorReferential()),this._keyValues.referential.setPosition(p),this._keyValues.referential;case n.EType.Angle:r=e.GetAnchorWorldMatrix(0,null),a=o.default.getOFromMatrix(r),s=e.GetAnchorWorldMatrix(1,null),l=o.default.getOFromMatrix(s);var u=e.GetAnchorWorldMatrix(2,null),h=o.default.getOFromMatrix(u),d=(new i.Vector3).subVectors(l,a),c=(new i.Vector3).subVectors(h,a);return d.lengthSq()<1e-4&&(d=new i.Vector3(1,0,0)),this._keyValues.referential=o.default.getMatrixFromOVxVy(a,d,c),this._keyValues.referential;case n.EType.PlanePoint:case n.EType.BetweenPlanes:case n.EType.BetweenPoints:r=e.GetAnchorWorldMatrix(0,null),a=o.default.getOFromMatrix(r),s=e.GetAnchorWorldMatrix(1,null),l=o.default.getOFromMatrix(s);var y=(new i.Vector3).subVectors(l,a);return y.lengthSq()<1e-4&&(y=new i.Vector3(1,0,0)),this._keyValues.referential=o.default.getMatrixFromOVx(a,y),this._keyValues.referential}return(t=this.QueryInterface("W3AISGNodeHolder"))&&(this._keyValues.referential=t.getAnchorReferential()),this._keyValues.referential}postUpdate(e){super.postUpdate(e),this._keyValues={}}}return function(e){let t,i,r;!function(e){e[e.None=0]="None",e[e.Straightness=1]="Straightness",e[e.Flatness=2]="Flatness",e[e.Circularity=3]="Circularity",e[e.Cylindricity=4]="Cylindricity",e[e.LineProfile=5]="LineProfile",e[e.SurfaceProfile=6]="SurfaceProfile",e[e.Angularity=7]="Angularity",e[e.Perpendicularity=8]="Perpendicularity",e[e.Parallelism=9]="Parallelism",e[e.Position=10]="Position",e[e.Concentricity=11]="Concentricity",e[e.Symmetry=12]="Symmetry",e[e.CircularRunout=13]="CircularRunout",e[e.TotalRunout=14]="TotalRunout",e[e.ProjectedToleranceZone=15]="ProjectedToleranceZone",e[e.MaxMaterialCondition=16]="MaxMaterialCondition",e[e.MinMaterialCondition=17]="MinMaterialCondition",e[e.FreeStateVariations=18]="FreeStateVariations",e[e.Diameter=20]="Diameter",e[e.PlusMinus=21]="PlusMinus",e[e.Plus=22]="Plus",e[e.Minus=23]="Minus",e[e.Equal=24]="Equal",e[e.ToBeDefined=25]="ToBeDefined"}(t=e.ESymbol||(e.ESymbol={})),function(e){e[e.Simple=0]="Simple",e[e.Double=1]="Double"}(i=e.EAttachTypeMeasurement||(e.EAttachTypeMeasurement={})),function(e){e[e.Arc=110]="Arc",e[e.Angle=120]="Angle",e[e.Linear=130]="Linear",e[e.Diameter=140]="Diameter",e[e.GDT=150]="GDT",e[e.BetweenAxis=160]="BetweenAxis",e[e.BetweenCentres=170]="BetweenCentres",e[e.BetweenPlanes=180]="BetweenPlanes",e[e.PlanePoint=190]="PlanePoint",e[e.BetweenPoints=200]="BetweenPoints",e[e.Area=220]="Area",e[e.Volume=230]="Volume",e[e.PipeLength=240]="PipeLength",e[e.AreaMultiplePoints=250]="AreaMultiplePoints",e[e.VolumeMultiplePoints=260]="VolumeMultiplePoints",e[e.PipeLengthMultiplePoints=270]="PipeLengthMultiplePoints",e[e.BetweenLines=280]="BetweenLines",e[e.LinePoint=290]="LinePoint",e[e.Radius=300]="Radius",e[e.Coord=310]="Coord",e[e.Projected=320]="Projected"}(r=e.EType||(e.EType={}))}(n||(n={})),n.prototype.getDefaultName=function(){return"Measurement"},Object.defineProperty(n.prototype,"componentType",{enumerable:!0,get:function(){return"VCXMeasurement_Spec"}}),n.prototype.dressupGroupName="Measurements",n}),define("DS/VCXWebDressup/VCXMeasurementModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebDressup/VCXMeasurement_Spec","DS/VCXWebDressup/VCXMarkupModifiable","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebSystem/VCXMathTools","DS/VCXWebDressup/VCXPropertyValueUnitFormater","DS/VCXWebUnits/VCXUnitType","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueColor"],function(e,t,i,r,o,a,n,s,l,p,u,h,d){"use strict";return i.extend({init:function(){this._bIsMeasurement=!0,this._parent()},Build:function(){this._parent();var e=this._generateMapChoiceFromEnumAndId(t.ESymbol,"Collab.Measurement.Symbol"),i=[{Name:"Collab.Measurement.DisplayValue",Type:u,DefaultValue:!0,GroupId:"Group.Measurement"},{Name:"Collab.Measurement.PreSymbol",Type:h,DefaultValue:t.ESymbol.None,GroupId:"Group.Measurement",MapChoice:e},{Name:"Collab.Measurement.PreString",Type:p,DefaultValue:"",GroupId:"Group.Measurement"},{Name:"Collab.Measurement.MiddleSymbol",Type:h,DefaultValue:t.ESymbol.None,GroupId:"Group.Measurement",MapChoice:e},{Name:"Collab.Measurement.MiddleString",Type:p,DefaultValue:"",GroupId:"Group.Measurement"},{Name:"Collab.Measurement.PostSymbol",Type:h,DefaultValue:t.ESymbol.None,GroupId:"Group.Measurement",MapChoice:e},{Name:"Collab.Measurement.PostString",Type:p,DefaultValue:"",GroupId:"Group.Measurement"},{Name:"Collab.Measurement.Attach.Type",Type:h,DefaultValue:t.EAttachTypeMeasurement.Double,GroupId:"Group.Attach",MapChoice:this._generateMapChoiceFromEnumAndId(t.EAttachTypeMeasurement,"Collab.Measurement.Attach.Type")},{Name:"Collab.Measurement.Value",Type:l,DefaultValue:0,GroupId:"Group.Measurement"},{Name:"Collab.Measurement.Length",Type:l,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Length",visibleInPropertyGroups:!1},{Name:"Collab.Measurement.Length1",Type:l,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Length",visibleInPropertyGroups:!1},{Name:"Collab.Measurement.Length2",Type:l,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Length",visibleInPropertyGroups:!1},{Name:"Collab.Measurement.Radius",Type:l,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Length",visibleInPropertyGroups:!1},{Name:"Collab.Measurement.Radius1",Type:l,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Length",visibleInPropertyGroups:!1},{Name:"Collab.Measurement.Radius2",Type:l,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Length",visibleInPropertyGroups:!1},{Name:"Collab.Measurement.Area",Type:l,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Area",visibleInPropertyGroups:!1},{Name:"Collab.Measurement.Volume",Type:l,DefaultValue:0,GroupId:"Group.Measurement",UnitType:"Volume",visibleInPropertyGroups:!1},{Name:"Collab.Measurement.ShowConstructionLines",Type:u,DefaultValue:!0,GroupId:"Group.Measurement"},{Name:"Collab.Measurement.ShowRedlines",Type:u,DefaultValue:!0,GroupId:"Group.Measurement"},{Name:"Collab.Measurement.ShowPlanes",Type:u,DefaultValue:!0,GroupId:"Group.Measurement"},{Name:"Collab.Measurement.ShowEndPoints",Type:u,DefaultValue:!0,GroupId:"Group.Measurement",visibleInPropertyGroups:!1},{Name:"Collab.3D.Paper.Billboard.Type",DefaultValue:2,FormatPainter:!0},{Name:"Collab.Text",DefaultValue:""},{Name:"Collab.Text.Color",DefaultValue:(new s).FromRGBA(1,1,1,1),FormatPainter:!0},{Name:"Collab.Background.Color",DefaultValue:(new s).FromRGBA(.0666666666666667,.596078431372549,.8980392156862745,1),FormatPainter:!0},{Name:"Collab.Body.Shape",DefaultValue:r.EBodyShape.RoundedRectangle,FormatPainter:!0},{Name:"Collab.3D.Paper.Referential.In.World",DefaultValue:!1},{Name:"Collab.Body.HAlignment",DefaultValue:r.EHAlignment.Center},{Name:"Collab.Body.VAlignment",DefaultValue:r.EVAlignment.Bottom},{Name:"Collab.3D.Paper.UsesBarycenter",DefaultValue:!1},{Name:"Collab.Body.InnerMargin",DefaultValue:1,FormatPainter:!0},{Name:"Collab.HideIfOutsideAnchorFrustrum",DefaultValue:!0},{Name:"Collab.Measurement.Plane.Color",Type:d,visibleInPropertyGroups:!1,DefaultValue:(new s).FromRGBA(.533,.533,.533)},{Name:"Collab.Measurement.Plane.Border.Color",Type:d,visibleInPropertyGroups:!1,DefaultValue:(new s).FromRGBA(0,0,0)},{Name:"Collab.Measurement.Additional.Color",Type:d,visibleInPropertyGroups:!1,DefaultValue:(new s).FromRGBA(0,0,0)},{Name:"Collab.Measurement.Additional.2.Color",Type:d,visibleInPropertyGroups:!1,DefaultValue:(new s).FromRGBA(.784,.392,0)},{Name:"Collab.Measurement.Type",Type:h,DefaultValue:t.EType.BetweenPoints,GroupId:"Group.Measurement",MapChoice:this._generateMapChoiceFromEnumAndId(t.EType,"Collab.Measurement.Type"),visibleInPropertyGroups:!0}];this._BuildPropertyValues(i),this.SetPropertyInvisible("Collab.HideIfOutsideAnchorFrustrum",!1),this.SetPropertyInvisible("Collab.Text",!0)},SetPropertiesInfo:function(){switch(this._parent(),this.GetPropertyValue("Collab.Measurement.Type")){case t.EType.BetweenPlanes:case t.EType.PlanePoint:this.SetPropertyInvisible("Collab.Measurement.ShowPlanes",!1);break;case t.EType.Arc:case t.EType.Angle:case t.EType.Volume:case t.EType.Area:case t.EType.AreaMultiplePoints:case t.EType.VolumeMultiplePoints:case t.EType.Coord:this.SetPropertyInvisible("Collab.Measurement.ShowConstructionLines",!0),this.SetPropertyInvisible("Collab.Measurement.ShowRedlines",!0);break;case t.EType.BetweenPoints:this.SetPropertyInvisible("Collab.Measurement.ShowRedlines",!0);break;default:this.SetPropertyInvisible("Collab.Measurement.ShowConstructionLines",!1),this.SetPropertyInvisible("Collab.Measurement.ShowRedlines",!1),this.SetPropertyInvisible("Collab.Measurement.ShowPlanes",!0)}this.SetPropertyInvisible("Collab.Measurement.Type",!0),this.SetPropertyInvisible("Collab.Measurement.Length",!0),this.SetPropertyInvisible("Collab.Measurement.Length1",!0),this.SetPropertyInvisible("Collab.Measurement.Length2",!0),this.SetPropertyInvisible("Collab.Measurement.Radius",!0),this.SetPropertyInvisible("Collab.Measurement.Radius1",!0),this.SetPropertyInvisible("Collab.Measurement.Radius2",!0),this.SetPropertyInvisible("Collab.Measurement.Area",!0),this.SetPropertyInvisible("Collab.Measurement.Volume",!0),this.SetPropertyInvisible("Collab.Body.KeepAspectRatio",!0),this.ChangeGroupAvailability("Group.Paragraph",e.EAvailability.AppForceNotAvailable)},OnChangeProperty:function(e,t,i,r){"Collab.Measurement.Type"===e&&(this.GetObject()._keyValues={}),this._parent(e,t,i,r)},GetProperty:function(e){if("Collab.Measurement.Value"===e){if(this._Properties["Collab.Measurement.Value"])switch(this.GetPropertyValue("Collab.Measurement.Type")){case t.EType.Angle:this._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Angle");break;case t.EType.AreaMultiplePoints:case t.EType.Area:this._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Area");break;case t.EType.VolumeMultiplePoints:case t.EType.Volume:this._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Volume");break;case t.EType.BetweenPlanes:case t.EType.BetweenLines:break;default:this._Properties["Collab.Measurement.Value"].GetPropertyInfo().SetUnitType("Length")}var i=this.GetObject().getValue();return this.GetNewProperty(e,i)}return this._parent(e)},GetComputedStringProperty:function(e,i){switch(this.GetPropertyValue("Collab.Measurement.Type")){case t.EType.Coord:var r=this.ExperienceBase.getManager("VCXUnitManager"),s=this.GetAnchorWorldMatrix(0,null),l=o.getOFromMatrix(s),p="",u=r.getUnitType("Length"),h=u.SymbolDisplay;return u.SymbolDisplay=n.ESymbolDisplay.None,p+="x = "+u.getString(l.x)+"\n",p+="y = "+u.getString(l.y)+"\n",p+="z = "+u.getString(l.z),u.SymbolDisplay=h,p;default:p="";return p+=a.format(this.GetProperty("Collab.Measurement.PreSymbol"),this.ExperienceBase),(p+=this.GetPropertyValue("Collab.Measurement.PreString")).length>0&&(p+=" "),this.GetPropertyValue("Collab.Measurement.DisplayValue")&&(p+=a.format(this.GetProperty("Collab.Measurement.Value"),this.ExperienceBase)),p+=a.format(this.GetProperty("Collab.Measurement.MiddleSymbol"),this.ExperienceBase),p+=this.GetPropertyValue("Collab.Measurement.MiddleString"),p+=a.format(this.GetProperty("Collab.Measurement.PostSymbol"),this.ExperienceBase),p+=this.GetPropertyValue("Collab.Measurement.PostString")}return this._parent(i)}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShapeLeftAndRight",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools"],function(e,t,i){"use strict";return e.extend({rewind:function(){this._parent(),this.iPariteX=0,this.iPariteY=0,this.fX=this.fHalfSizeX-this.fCellSize,this.dy=0,this.fY=0,this.fX<0&&(this.fX=0)},next:function(){return this._parent(),this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,0===this.fY&&this.iPariteY++,this.iPariteY++,2===this.iPariteY&&(this.iPariteY=0,this.fY+=this.fCellSize,this.fY>this.fHalfSizeY-this.fCellSize&&(0===this.dy?this.dy=.5*this.fCellSize:this.dy=0,this.fY=0,this.fX-=this.fCellSize,this.fX<this.fCellSize)))&&(this.rewind(),!0)},getPoint:function(){var e=new t.Vector2;return 1&this.iPariteX?e.x=this.fHalfSizeX-this.fX:e.x=this.fHalfSizeX+this.fX,1&this.iPariteY?e.y=this.fHalfSizeY-this.fY+this.dy:e.y=this.fHalfSizeY+this.fY+this.dy,e}})}),define("DS/VCXWebDressup/VCXAmbienceNode",["DS/CoreEvents/Events","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXViewport_Spec","DS/VCXWebDressup/VCXPropertiesObserver","DS/Visualization/Node3D","DS/Visualization/Ambience","DS/WebappsUtils/WebappsUtils","DS/Visualization/ThreeJS_DS","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup"],function(e,t,i,r,o,a,n,s,l){"use strict";return t.extend({init:function(e){return this._parent(e),this},preRender:function(e){this._parent(e)},_Build:function(e){this.Modifiable.ExperienceBase.getManager("VCXContextManager");var t=this.Modifiable.GetObject();if(!t._ambienceLoading)return t._ambienceLoading=new Promise(async i=>{t._ambience=null,this._envMapStr="PLM";var r=t.QueryInterface("CATI3DXAmbienceAsset");let o=await r.getAmbience();if(o){if(this.invalidLink=!0,!t._experienceBase.isValid)return console.error(new Error("Experience not valid anymore")),void i();t._ambience=o,delete t._ambienceLoading,t.setDirty(!0),this.update(e)}else this.invalidLink=!1;i()}),t._experienceBase.getManager("VCXNotificationManager").addProgressNotification({strObjectType:l["ProgressNotification.Ambience"],strObjectName:t.QueryInterface("VCXIModifiable").GetPropertyValue("Actor.Name"),iPromise:t._ambienceLoading}),t.QueryInterface("VCXIReadiness").registerPromise(t._ambienceLoading),t._ambienceLoading},update:function(t){if(this._parent(),!this.Modifiable.GetObject()._ambienceLoading){var i=!1,r=this.Modifiable.ExperienceBase.getManager("VCXContextManager"),o=r.getActiveViewport(),a=r.getMainViewer(),n=o.getActiveAmbienceID();n===this.Modifiable.GetObject().GetID()&&(i=!0);var s=this.Modifiable.GetObject()._ambience;if(a&&(a.ambience,i)){if(!s)return void(this.invalidLink||this._Build());s!==a.ambience&&(this.Modifiable.ExperienceBase.getManager("VCXVisuManager").requestSetAmbience(s,!0),e.publish({event:"VCX_ENVIRONNEMENT_PROPERTY_CHANGED"}),e.publish({event:"VCX_AMBIENCE_CHANGED"}))}if(i&&s){const e=e=>{devicePixelRatio=e.devicePixelRatio;let t=a.currentViewpoint,i=a.SCREEN_HEIGHT;const r=t.camera.fullHeight,o=t.camera.fullWidth,n=(parseFloat(parseInt(r)/o).toFixed(2),parseFloat(parseInt(e.textureWidth)/e.textureHeight).toFixed(2));let l=r,p=parseInt(l*n);p<o&&(l=(p=o)/n),s.setBackplateOffset((o-p)*devicePixelRatio/2-t.camera.x,(r-l)*devicePixelRatio/2+i+t.camera.y-r),s.setBackplateSize(1/(p*devicePixelRatio),1/(l*devicePixelRatio))};"backplate"===s.getBackground().getType()&&s.setCustomBackplateCallback(t=>e(t)),s.getEnvironmentLight().setIntensity(Math.pow(2,this.Modifiable.GetPropertyValue("Ambience.Lighting.Exposure")));var l=s.getEnvironmentLightMatrix();l.makeRotationZ(this.Modifiable.GetPropertyValue("Ambience.Lighting.Rotation")*Math.PI/180),s.setEnvironmentLightMatrix(l);var p=r.getActiveViewport(),u=p&&p.QueryInterface("VCXIModifiable");u&&u.QueryInterface("VCXIModifiable").GetPropertyValue("Environment.Background.Override")||(s.getBackground().setActivated(this.Modifiable.GetPropertyValue("Ambience.Background.Show")),s.getBackground().setIntensity(Math.pow(2,this.Modifiable.GetPropertyValue("Ambience.Background.Exposure")))),s.setGroundGlossiness(this.Modifiable.GetPropertyValue("Ambience.Ground.Glossiness")/100),s.setGroundReflectivitiy(this.Modifiable.GetPropertyValue("Ambience.Ground.Reflectivity")/100),s.setGroundShadowIntensity&&s.setGroundShadowIntensity(this.Modifiable.GetPropertyValue("Ambience.Ground.ShadowIntensity")/100),this.Modifiable.GetObject().updatePosition()}}},postUpdate:function(e){this._parent()},dispose:function(){this.Modifiable.ExperienceBase.getManager("VCXContextManager").applyToViewers(function(e){e.removeAmbience()}),this._parent()}})}),define("DS/VCXWebDressup/VCXAmbienceSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXAmbienceNode"],function(e,t){"use strict";return e.extend({init:function(){},getWorldMatrix:function(e){var t=this.QueryInterface("VCXIModifiable");if(t)return t.GetFramePropertyValue("Actor.Position")},buildSGNode:function(){if(!this._sgNode){var e={name:"Ambience",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_AmbienceLeaf.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXMagnetLineNode",["DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXDressup_Spec","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/VCXWebProperties/VCXColor"],function(e,t,i,r,o,a,n,s){"use strict";return i.extend({init:function(e){return this._parent(e),this._axisMat=null,this._Smart3DPaperNode=null,this._lineNode=null,this._lineNodeManip=null,this._displayExtendedLine=!1,this},DisplayExtendedLine:function(e){console.log("DisplayExtendedLine: "+e),e!=this._displayExtendedLine&&(this._Smart3DPaperNode||this._Build(),e?(this._displayExtendedLine=!0,this._posBeforeManipulateA=this._getExtremityA(),this._posBeforeManipulateB=this._getExtremityB()):(this._displayExtendedLine=!1,this._posBeforeManipulateA=null,this._posBeforeManipulateB=null,this.remove(this._lineNodeManip)))},_getExtremityA:function(){var e=this.GetPropertyValue("Collab.MagnetLine.Position.A.X"),t=this.GetPropertyValue("Collab.MagnetLine.Position.A.Y");return new o.Vector3(e,t,0)},_getExtremityB:function(){var e=this.GetPropertyValue("Collab.MagnetLine.Position.B.X"),t=this.GetPropertyValue("Collab.MagnetLine.Position.B.Y");return new o.Vector3(e,t,0)},_Build:function(){var t=this._getExtremityA(),i=this._getExtremityB();this._axisMat=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams({type:e.ELineType.Dot,lineWidth:2,color:(new s).SetRGB(0,0,0).GetThreeColor(),opacity:1});var l={points:[t,i],editable:!0,drawMode:a.ConnectivityTypeEnum.LINES,material:this._axisMat};this._lineNode=n.createLineNode(l),this._lineNode.setVisibilityInTree(!1);var p={matrix:new o.Matrix4,radius:.4,material:this._axisMat};this._dotA=n.createSphereNode(p),this._dotA.applyMatrix((new o.Matrix4).makeTranslation(t.x,t.y,0)),this._dotB=n.createSphereNode(p),this._dotB.applyMatrix((new o.Matrix4).makeTranslation(i.x,i.y,0));var u=new o.Vector3(i.x-t.x,i.y-t.y,i.z-t.z),h=new o.Vector3(t.x-i.x,t.y-i.y,t.z-i.z);u.normalize(),u.multiplyScalar(10),h.normalize(),h.multiplyScalar(10);var d=t;d.add(h);var c=i;c.add(u),this._axisMatManipulate=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams({type:e.ELineType.Dot,lineWidth:1,color:(new s).SetRGB(1,123/255,0).GetThreeColor(),opacity:1});var y={points:[d,c],editable:!0,drawMode:a.ConnectivityTypeEnum.LINES,material:this._axisMatManipulate};this._lineNodeManip=n.createLineNode(y),this._lineNodeManip.setVisibilityInTree(!1),this._lineNodeManip.excludeFromHighlight(!0,!0),this._posBeforeManipulateA=this._getExtremityA(),this._posBeforeManipulateB=this._getExtremityB();var C={name:"MagnetLineSmartNode",modifiable:this.Modifiable};this._Smart3DPaperNode=new r(C),this._Smart3DPaperNode.BillboardType=r.BillboardTypeEnum.SPHERICAL,this._Smart3DPaperNode.SizeControlType=r.SizeControlTypeEnum.InPaper,this._Smart3DPaperNode.PositioningType=1e3,this._Smart3DPaperNode.Depth=0,this._Smart3DPaperNode.add(this._lineNode),this._Smart3DPaperNode.add(this._dotA),this._Smart3DPaperNode.add(this._dotB),this._displayExtendedLine&&this.add(this._lineNodeManip),this.add(this._Smart3DPaperNode)},preRender:function(e){this._parent(e),this._Smart3DPaperNode&&this._Smart3DPaperNode.preRender(e)},update:function(e){if(this._parent(),this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var t=this._globalOpacity>0;t&&(this._Smart3DPaperNode||this._Build()),this._Smart3DPaperNode&&this._Smart3DPaperNode.setVisibility(t)}if(this._Smart3DPaperNode){var i=this._getExtremityA(),r=this._getExtremityB(),n=new o.Vector3((r.x-i.x)/2+i.x,(r.y-i.y)/2+i.y,(r.z-i.z)/2+i.z),s=this.Modifiable.GetNewProperty("Collab.3D.Paper.Paper.Position.X",n.x),l=this.Modifiable.GetNewProperty("Collab.3D.Paper.Paper.Position.Y",n.y);if(this.Modifiable.OnChangeProperty("Collab.3D.Paper.Paper.Position.X",s.GetPropertyValue()),this.Modifiable.OnChangeProperty("Collab.3D.Paper.Paper.Position.Y",l.GetPropertyValue()),this._Smart3DPaperNode.update(e),this._lineNodeManip&&this._displayExtendedLine){var p=this._lineNodeManip.getBuffer(a.VertexComponentEnum.POSITION);if(void 0!==p){const e=this.ExperienceBase.getManager("VCXPaperManager");var u=this.ExperienceBase.getManager("VCXContextManager").getMainViewer(),h=e.MMToModel2({viewer:u,viewpoint:u.currentViewpoint},this._posBeforeManipulateA),d=e.MMToModel2({viewer:u,viewpoint:u.currentViewpoint},this._posBeforeManipulateB);p[0]=h.x,p[1]=h.y,p[2]=h.z,p[3]=d.x,p[4]=d.y,p[5]=d.z,this._lineNodeManip.updateBuffer(a.VertexComponentEnum.POSITION,0,p.length)}}if(this._displayExtendedLine?this.add(this._lineNodeManip):this._Smart3DPaperNode.remove(this._lineNodeManip),this._lineNode){var c=this.GetPropertyValue("Actor.Color");this._axisMat.color=c,this._lineNode.setMaterial(this._axisMat);var y=this._lineNode.getBuffer(a.VertexComponentEnum.POSITION);void 0!==y&&(y[0]=i.x-n.x,y[1]=r.y-n.y,y[2]=0,y[3]=r.x-n.x,y[4]=i.y-n.y,y[5]=0,this._lineNode.updateBuffer(a.VertexComponentEnum.POSITION,0,y.length),console.log("Update pos buffer")),this._dotA.setMatrix((new o.Matrix4).makeTranslation(y[0],y[1],0)),this._dotB.setMatrix((new o.Matrix4).makeTranslation(y[3],y[4],0))}}}})}),define("DS/VCXWebDressup/VCXMagnetLineSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXMagnetLineNode"],function(e,t){"use strict";return e.extend({init:function(){},getWorldMatrix:function(e){var t=this.GetObject()._experienceBase.getManager("VCXContextManager"),i=this.GetObject().getWorkingRootPathElement().getWorldMatrix(t.getMainViewer()),r=this.QueryInterface("VCXIModifiable");if(r)return this._actorPosition=r.GetFramePropertyValue("Actor.Position"),this._actorPosition&&i.multiply(this._actorPosition),i},buildSGNode:function(){if(!this._sgNode){var e={name:"MagnetLine",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_MagnetLineLeaf.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXRedLineNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Mesh/MeshUtils","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebSystem/VCXMeshServices"],function(e,t,i,r,o){"use strict";return r.extend({init:function(t){return this._parent(t),this._localMaterial=new e.LineBasicMaterial({color:(new e.Color).setRGB(1,0,0),opacity:1,dashSize:0,gapSize:0}),this},_Build:function(){this._Node||(this._Node=new t,this.add(this._Node));for(var e=this._Node.getChildren(),r=e.length-1;r>=0;--r)this._Node.removeChild(e[r]);var a=this.Modifiable.GetPropertyValue("Collab.VertexBuffers");if(a)for(var n=0;n<a.length;++n){var s=a[n].GetValue(),l=this._BuildFloat32arrayFromBase64(s);if(l){var p=o.buildLine(l,new i.Color(1,0,0,1),1,null,null);p.setPickParent(!0),this._updateGeom(p,1)}}},_BuildFloat32arrayFromBase64:function(e){if(!e||!e.length)return null;for(var t=window.atob(e),i=new Uint8Array(t.length),r="",o=0,a=0;a<t.length;++a)","!==t[a]?r+=t[a]:(i[o++]=parseInt(r),r="");i[o++]=parseInt(r);var n=new ArrayBuffer(o),s=new Uint8Array(n);for(a=0;a<s.length;++a)s[a]=i[a];return n.byteLength%4?null:new Float32Array(n)},_updateGeom:function(e,t){if(this._Node){if(t)this._Node.addChild(e);else{var i=this._Node.getChildren();i.length&&this._Node.removeChild(i[i.length-1]),this._Node.addChild(e)}e.setMaterial(this._localMaterial),this._localMaterial.force=!0,this.update()}},preRender:function(e){if(this._parent(e),this._localMaterial){this._localMaterial.handleByPrerender=!0;let e=this.ExperienceBase.getManager("VCXPaperManager").UnitValueToPixel(this.Modifiable.GetPropertyValue("Collab.Body.Line.Width"));e>=1?(this._localMaterial.setLineWidth(e),this._localMaterial.visible=!0):this._localMaterial.visible=!1}},update:function(e){if(this._Node||this._Build(),this._parent(),this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var t=this._globalOpacity>0;t&&(this._Node&&this._Node.getChildren().length||this._Build()),this._Node&&this._Node.setVisibility(t)}if(!(this._globalOpacity<=0)&&this._Node){var i=this.GetAnchorWorldMatrix(0,e);i&&this.setMatrix(i);var r=this.GetColorPropertyValue("Actor");this._localMaterial.color=r.GetThreeColor(),this._localMaterial.force=!0;var o=this.GetPropertyValue("Collab.Body.Line.Width");this._localMaterial.setLineWidth(o),this._localMaterial.opacity=this._globalOpacity,this.handleLayers()}}})}),define("DS/VCXWebDressup/VCXRedLineSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXRedLineNode"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode||void 0===this._sgNode){var e={name:"RedLine",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_RedLineLeaf.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXAttachTooltipNode",["DS/Mesh/MeshUtils","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXExtremityNode","DS/VCXWebSystem/VCXMathTools","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D"],function(e,t,i,r,o,a,n,s){"use strict";var l=i.extend({init:function(e){return this._parent(e),this.anchorID=e.anchorID,this._bConsiderCurvature="boolean"!=typeof e.bConsiderCurvature||e.bConsiderCurvature,this.updateParams(),this._StartExtremity=new n.Vector3,this._EndExtremity=new n.Vector3,this._zValue=new n.Vector3,this},updateParams:function(){this._bConsiderCurvature||console.log("Shouldn't we consider a curvature at anytime, to be sure ?"),this._bGradientBackGround=this.GetPropertyValue("Collab.Attach.Background.Gradient"),this._bGradientBorder=this.GetPropertyValue("Collab.Attach.Border.Gradient"),this._step=this._bConsiderCurvature?32:1,this._verticesNb=2*this._step+1,this._lineIndicesNb=2*this._verticesNb;var e=2*this._step-1;this._trianglesIndicesNb=3*e},dispose:function(){this._Node&&this.removeChild(this._Node)},_getAngleBetweenXAxisAndVector:function(e){var t=new n.Vector3(1,0,0),i=new n.Vector3(0,1,0),r=Math.acos(t.dot(e));return i.dot(e)<0&&(r=2*Math.PI-r),r},_getArcVerticesPosFromStartEndPosRadDiffAndCurvSign:function(e,t,i,r,o){var a=[],s=new n.Vector3(0,0,1),l=o?1:-1,p=(new n.Vector3).addVectors(e,t).multiplyScalar(.5),u=(new n.Vector3).subVectors(e,t);u.cross(s),u.normalize(),p.x+=u.x*i,p.y+=u.y*i;var h,d,c,y=(new n.Vector3).subVectors(e,p),C=(new n.Vector3).subVectors(t,p);o?(h=y.length(),d=this._getAngleBetweenXAxisAndVector(y.normalize()),c=this._getAngleBetweenXAxisAndVector(C.normalize())):(h=C.length(),d=this._getAngleBetweenXAxisAndVector(C.normalize()),c=this._getAngleBetweenXAxisAndVector(y.normalize())),c-d<0&&r*l==1?d-=2*Math.PI:c-d>0&&r*l==-1&&(c-=2*Math.PI);for(var m,f=0,V=Math.abs((c-d)%(2*Math.PI)),b=0;b<=this._step;++b){var P=b/this._step;f=d+r*l*V*P,m=o?e.z*(1-P)+t.z*P:e.z*P+t.z*(1-P);var g=new n.Vector3(p.x+h*Math.cos(f),p.y+h*Math.sin(f),m);a.push(g)}return a},_getAttachShapeVerticesPositionsWithCurvature:function(e,t,i,r){var o=new n.Vector3(0,0,1),a=(new n.Vector3).subVectors(e,t),s=.5*a.length(),l=s;0===r&&(r=.001),l=Math.abs(100*l/r);var p=r>0?-1:1,u=(new n.Vector3).addVectors(e,t).multiplyScalar(.5),h=(l-s)*p;a.z=0,a.cross(o),a.normalize();var d=a.clone().multiplyScalar(h);u.add(d),u.z=0;var c=(new n.Vector3).subVectors(e,u);c.z=0,c.normalize();var y=(new n.Vector3).copy(c).multiplyScalar(2.5*i).add(e),C=(new n.Vector3).copy(c).multiplyScalar(-2.5*i).add(e),m=this._getArcVerticesPosFromStartEndPosRadDiffAndCurvSign(y,t,h,p,!0);m.pop();var f=this._getArcVerticesPosFromStartEndPosRadDiffAndCurvSign(C,t,h,p,!1);return m.concat(f)},_getAttachShapeVerticesPositionsWithoutCurvature:function(e,t,i){var r=[],o=new n.Vector3(0,0,1),a=(new n.Vector3).subVectors(e,t),s=(new n.Vector3).crossVectors(a,o).normalize(),l=(new n.Vector3).copy(s).multiplyScalar(2.5*i).add(e),p=(new n.Vector3).copy(s).multiplyScalar(-2.5*i).add(e);return r.push(l),r.push(t),r.push(p),r},_computePosBuffers:function(e,t,i){var r,o=this.ExperienceBase.getManager("VCXPaperManager"),a=this.StartExtremity.clone(),n=this.EndExtremity.clone(),s=o.ModelToMM2(e,a),l=o.ModelToMM2(e,n),p=this.GetPropertyValue("Collab.Attach.Line.Width");if(this._bConsiderCurvature){var u=this.GetPropertyValue("Collab.Attach.Curvature");r=this._getAttachShapeVerticesPositionsWithCurvature(s,l,p,u)}else r=this._getAttachShapeVerticesPositionsWithoutCurvature(s,l,p);for(var h=[],d=0;d<r.length;++d){var c=r[d],y=o.MMToModel2(e,c);h.push(y)}for(var C=h.length,m=0;m<C;++m)t[3*m+0]=h[m].x,t[3*m+1]=h[m].y,t[3*m+2]=h[m].z,i[3*m+0]=h[m].x,i[3*m+1]=h[m].y,i[3*m+2]=h[m].z},_computeColorBuffers:function(e,t){for(var i=this.GetColorPropertyValue("Collab.Attach.Line").GetRGBA(),r=0;r<=this._step;++r){var o=4*r,a=4*(this._verticesNb-1-r),n=this._bGradientBackGround?r*i[3]/this._step:i[3];e[o+0]=i[0],e[o+1]=i[1],e[o+2]=i[2],e[o+3]=n,e[a+0]=i[0],e[a+1]=i[1],e[a+2]=i[2],e[a+3]=n;var s=this._bGradientBorder?r*i[3]/this._step:i[3];t[o+0]=0,t[o+1]=0,t[o+2]=0,t[o+3]=s,t[a+0]=0,t[a+1]=0,t[a+2]=0,t[a+3]=s}},_computeBuffers:function(e,t,i,r,o){this._computePosBuffers(e,t,r),this._computeColorBuffers(i,o)},_Build:function(){this._bkGrndPrimGrp=new e.PrimitiveGroup({editable:!0}),this._borderPrimGrp=new e.PrimitiveGroup({editable:!0});var t=new e.Buffer({component:e.VertexComponentEnum.POSITION,data:new Float32Array(3*this._verticesNb),dimension:3}),i=new e.Buffer({component:e.VertexComponentEnum.DIFFUSE_COLOR,data:new Float32Array(4*this._verticesNb),dimension:4}),r=new e.Buffer({indexBuffer:!0,data:new Uint16Array(this._trianglesIndicesNb)}),o=new e.Buffer({component:e.VertexComponentEnum.POSITION,data:new Float32Array(3*this._verticesNb),dimension:3}),l=new e.Buffer({component:e.VertexComponentEnum.DIFFUSE_COLOR,data:new Float32Array(4*this._verticesNb),dimension:4}),p=new e.Buffer({indexBuffer:!0,data:new Uint16Array(this._lineIndicesNb)});this._bkGrndPrimGrp.addBuffer(0,t),this._bkGrndPrimGrp.addBuffer(1,i),this._bkGrndPrimGrp.addBuffer(2,r),this._borderPrimGrp.addBuffer(0,o),this._borderPrimGrp.addBuffer(1,l),this._borderPrimGrp.addBuffer(2,p);var u=0,h=0,d=r.data,c=this._verticesNb-1;for(h=0;h<this._step-1;++h)d[u++]=h,d[u++]=c-h,d[u++]=c-(h+1),d[u++]=h,d[u++]=c-(h+1),d[u++]=h+1;for(d[u++]=this._step-1,d[u++]=this._step+1,d[u++]=this._step,d=p.data,u=0,h=0;h<this._verticesNb;++h)d[u++]=h,d[u++]=h!==this._verticesNb-1?h+1:0;var y=new e.Primitive({nbIndices:this._trianglesIndicesNb,connectivity:e.ConnectivityTypeEnum.TRIANGLES}),C=new e.VertexComponent({nbVertices:this._verticesNb,bufferId:0,indices:new e.IndexArray({bufferId:2,offset:0})}),m=new e.VertexComponent({nbVertices:this._verticesNb,bufferId:1,indices:new e.IndexArray({bufferId:2,offset:0})});y.addVertexComponent(C),y.addVertexComponent(m),this._bkGrndPrimGrp.addPrimitive(y);var f=new e.Primitive({nbIndices:this._lineIndicesNb,connectivity:e.ConnectivityTypeEnum.LINES}),V=new e.VertexComponent({nbVertices:this._verticesNb,bufferId:0,indices:new e.IndexArray({bufferId:2,offset:0})}),b=new e.VertexComponent({nbVertices:this._verticesNb,bufferId:1,indices:new e.IndexArray({bufferId:2,offset:0})});f.addVertexComponent(V),f.addVertexComponent(b),this._borderPrimGrp.addPrimitive(f);this._bodyMat=new n.MeshBasicMaterial({side:n.DoubleSide,vertexColors:n.VertexColors,color:"#ffffff",transparent:!0,opacity:1,force:!0,depthTest:!0,depthWrite:!1}),this._lineMat=new n.LineBasicMaterial({side:n.DoubleSide,vertexColors:n.VertexColors,color:"#ffffff",transparent:!0,opacity:1,polygonBorderMode:!1,force:!0,depthTest:!0,depthWrite:!1}),this._NodeBkGrnd=a.createMeshNode(this._bkGrndPrimGrp),this._NodeBkGrnd.setMaterial(this._bodyMat),this._NodeBkGrnd.setVisibilityInTree(!1),this._NodeBorder=a.createMeshNode(this._borderPrimGrp),this._NodeBorder.setMaterial(this._lineMat),this._NodeBorder.setVisibilityInTree(!1),this._Node=new s,this._Node.addChild(this._NodeBkGrnd),this._Node.addChild(this._NodeBorder),this.addChild(this._Node),this.handleLayers(!0)},preRender:function(t){var i=this._NodeBkGrnd.getBuffer(e.VertexComponentEnum.POSITION),r=this._NodeBkGrnd.getBuffer(e.VertexComponentEnum.DIFFUSE_COLOR),o=this._NodeBorder.getBuffer(e.VertexComponentEnum.POSITION),a=this._NodeBorder.getBuffer(e.VertexComponentEnum.DIFFUSE_COLOR);void 0!==i&&void 0!==r&&void 0!==o&&void 0!==a&&(this._computeBuffers(t,i,r,o,a),this._NodeBkGrnd.updateBuffer(e.VertexComponentEnum.POSITION,0,this._verticesNb),this._NodeBkGrnd.updateBuffer(e.VertexComponentEnum.DIFFUSE_COLOR,0,this._verticesNb),this._NodeBkGrnd.computeBoundingElements(),this._NodeBorder.updateBuffer(e.VertexComponentEnum.POSITION,0,this._verticesNb),this._NodeBorder.updateBuffer(e.VertexComponentEnum.DIFFUSE_COLOR,0,this._verticesNb),this._NodeBorder.computeBoundingElements())},update:function(e){if(this._parent(),this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var t=this._globalOpacity>0;t&&(this._Node||this._Build()),this._Node&&(this._lineMat.setLineWidth(2),this._Node.setVisibility(t)),this._ExtremityNode&&this._ExtremityNode.setVisibility(t)}this._globalOpacity<=0||(this._ExtremityNode&&this._ExtremityNode.update(e),this._Node&&(this.updateParams(),this._bodyMat&&(this._bodyMat.opacity=this._globalOpacity),this._lineMat&&(this._lineMat.opacity=this._globalOpacity),this.handleLayers()))},postUpdate:function(e){this._parent(),this._ExtremityNode&&this._ExtremityNode.postUpdate(e)}});return Object.defineProperty(l.prototype,"StartExtremity",{enumerable:!0,get:function(){return this._StartExtremity},set:function(e){this._StartExtremity=e}}),Object.defineProperty(l.prototype,"EndExtremity",{enumerable:!0,get:function(){return this._EndExtremity},set:function(e){this._EndExtremity=e}}),l}),define("DS/VCXWebDressup/VCXDressupOrganisationShapeCircle",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS"],function(e,t){"use strict";return e.extend({rewind:function(){this._parent(),this.iCurrent=0,this.rMax=Math.min(this.sizeView.x,this.sizeView.y),this.rMax=.5*this.rMax-this.fCellSize,this.rMax<this.fCellSize&&(this.rMax=this.fCellSize),this.r=this.rMax,this.nbPerCircle=Math.floor(2*Math.PI*this.r/this.fCellSize+.5),this.iT=0,this.dt=0,this.iParite=0},next:function(){if(this._parent(),this.iT++,this.iT>=this.nbPerCircle){if(this.r-=this.fCellSize,this.r<this.fCellSize)return this.rewind(),!0;this.iT=0,this.nbPerCircle=Math.floor(2*Math.PI*this.r/this.fCellSize+.5),1&this.iParite?this.dt=Math.PI/this.nbPerCircle:this.dt=0,this.iParite++}return!1},getPoint:function(){var e=new t.Vector2,i=this.dt+2*Math.PI*this.iT/this.nbPerCircle;return e.x=Math.cos(i)*this.r+.5*this.sizeView.x,e.y=Math.sin(i)*this.r+.5*this.sizeView.y,e}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShapeBottom",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools"],function(e,t,i){"use strict";return e.extend({rewind:function(){this._parent(),this.iPariteX=0,this.fX=0,this.dx=0,this.fY=this.fHalfSizeY-this.fCellSize,this.fY<0&&(this.fY=0)},next:function(){return this._parent(),0===this.fX&&this.iPariteX++,this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,this.fX+=this.fCellSize,this.fX>this.fHalfSizeX-this.fCellSize&&(0===this.dx?this.dx=.5*this.fCellSize:this.dx=0,this.fX=0,this.fY-=this.fCellSize,this.fY<-this.fHalfSizeY+this.fCellSize))&&(this.rewind(),!0)},getPoint:function(){var e=new t.Vector2;return 1&this.iPariteX?e.x=this.fHalfSizeX-this.fX+this.dx:e.x=this.fHalfSizeX+this.fX+this.dx,e.y=this.fHalfSizeY+this.fY,e}})}),define("DS/VCXWebDressup/VCXSectionNode",["DS/VCXWebDressup/VCXDressupNode","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/Visualization/Node3D","DS/VCXWebSystem/VCXMathTools","DS/SceneGraphNodes/AxisSystemNode","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebProperties/VCXColor","DS/Visualization/SceneGraphUtils"],function(e,t,i,r,o,a,n,s,l,p){"use strict";return e.extend({init:function(e){return this._parent(e),this},_Build:function(e){this._bodyMat=new t.MeshBasicMaterial({side:t.DoubleSide,opacity:1,force:!0}),this._bodyMat.line=new t.LineBasicMaterial({side:t.DoubleSide,opacity:1,force:!0,polygonBorderMode:!0,lineWidth:2}),this._borderMat=new t.MeshBasicMaterial({side:t.DoubleSide,color:(new l).SetRGB(255,255,255).GetThreeColor(),opacity:1,force:!0}),this._borderMat.line=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams({lineWidth:2,color:(new l).SetRGB(0,0,0).GetThreeColor(),opacity:1}),this._borderMat.line.polygonOffset=!0,this._borderMat.line.polygonOffsetFactor=1,this._borderMat.line.polygonOffsetUnits=-200,this._borderMat.line.linecap="round";this._rightLineNode=new o("RightMiddle"),this._rightLineNode.setMatrix((new t.Matrix4).makeRotationZ(.5*Math.PI)),this._leftLineNode=new o("LeftMiddle"),this._leftLineNode.setMatrix((new t.Matrix4).makeRotationZ(.5*-Math.PI)),this._bottomLineNode=new o("BottomMiddle"),this._topLineNode=new o("TopMiddle"),this._axisSystemNode=new n({name:"AxisSystem",headLength:10,arrowLength:50,arrowWidth:2,colors:{colorX:new i.Color(1,0,0,0),colorY:new i.Color(0,1,0,0),colorZ:new i.Color(0,0,1,0)},head:n.types.ARROW}),this._axisSystemNode.setVisibility(!0),this._MeshNode=r.createRectangleNode({width:1,height:1,cornerPoint:new t.Vector2(-.5,-.5),fill:!0,material:this._bodyMat}),this._MeshNode.setVisibilityInTree(!1),this._MeshNodeHolder=new o("mesh"),this._MeshNodeHolder.add(this._MeshNode),this._ScalingNode=new o("scaling"),this._ScalingNode.add(this._MeshNodeHolder),this._CenteringNode=new o("CenterNode"),this._CenteringNode.add(this._ScalingNode),this._CenteringNode.add(this._topLineNode),this._CenteringNode.add(this._leftLineNode),this._CenteringNode.add(this._rightLineNode),this._CenteringNode.add(this._bottomLineNode),this.add(this._CenteringNode,{exludeFromBounding:!1}),this._axisMat=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams({type:s.ELineType.Dot,lineWidth:1,color:(new l).SetRGB(255,255,255).GetThreeColor(),opacity:1});var a=this.ExperienceBase.getManager("VCXVisuManager");this._rightAxisNode=r.createLineNode({points:[new t.Vector3(0,0,0),new t.Vector3(1,0,0)],material:this._axisMat}),this._leftAxisNode=r.createLineNode({points:[new t.Vector3(0,0,0),new t.Vector3(-1,0,0)],material:this._axisMat}),this._bottomAxisNode=r.createLineNode({points:[new t.Vector3(0,0,0),new t.Vector3(0,-1,0)],material:this._axisMat}),this._topAxisNode=r.createLineNode({points:[new t.Vector3(0,0,0),new t.Vector3(0,1,0)],material:this._axisMat});var p=this;[this._rightAxisNode,this._leftAxisNode,this._bottomAxisNode,this._topAxisNode].forEach(function(e){e.setVisibility(!1),e.setRenderPasses([a.getRenderList("VCXPreManipulators"),a.getRenderList("VCXManipulators")]),e.excludeFromCSO(!0),e.excludeFromHighlight(!0,!0),e.setNoHighlightNoZ(!0),p.add(e)}),this._MeshNodeHolder.setPickingPriorityId("VCXSection"),this._MeshNode.setPickingPriorityId("VCXSection")},preRender:function(e){if(this._globalOpacity>0&&this._MeshNodeHolder&&(this.Modifiable.GetObject()._plane&&this.Modifiable.ExperienceBase.getManager("VCXContextManager"))){var i=this.Modifiable.GetObject().getWorkingRootPathElement();if(i){var r=(u=this.Modifiable.QueryInterface("W3AISGNodeHolder")).getWorldMatrix(e.viewer),o=(new t.Matrix4).getInverse(r),n=this.Modifiable.GetPropertyValue("Actor.ListActors"),s=[];if(n.length)for(var l=0;l<n.length;l++){var u,h=this.Modifiable.GetObject()._experienceBase.ComponentsMap.GetComponentFromID(n[l].Value);if(h)if(u=h.QueryInterface("W3AISGNodeHolder")){var d=u.getPathElement();d&&s.push(d)}}s.length||s.push(i);var c=p.getOrientedBoundingBoxFromPathElements(s,r,e.viewer);c.localBBox.expandByPoint(a.getOFromMatrix(r).applyMatrix4(o));var y=c.localBBox.min,C=c.localBBox.max,m=this.ExperienceBase.getManager("VCXPaperManager");if(this.compactMode){var f=10*m.GetPaperRatio(e,a.getOFromMatrix(r));c.localBBox.min.set(-f,-f),c.localBBox.max.set(f,f)}var V=(new t.Vector3).addVectors(y,C).multiplyScalar(.5);y.clone().applyMatrix4(r),C.clone().applyMatrix4(r),V.clone().applyMatrix4(r);this.setMatrix(r),this._MeshNodeHolder.setMatrix((new t.Matrix4).setPosition(new t.Vector3(0,0,.001*-C.length()))),this._CenteringNode.setMatrix((new t.Matrix4).setPosition(new t.Vector3(V.x,V.y,0)));var b=r.clone().multiply(this._CenteringNode.getMatrix()),P=10*m.GetPaperRatio(e,a.getOFromMatrix(r)),g=1e3*P,_=Math.min(Math.max(P,Math.abs(C.x-y.x)),g),S=Math.min(Math.max(P,Math.abs(C.y-y.y)),g);this._ScalingNode.setMatrix((new t.Matrix4).makeScale(1.1*_,1.1*S,1));var M=new t.Vector3(1.1*-_*.5,0,0),G=4*m.GetPaperRatio(e,M.clone().applyMatrix4(b));this._rightLineNode.setMatrix(this._rightLineNode.getMatrix().setPosition(M));var D=new t.Vector3(1.1*_*.5,0,0),x=4*m.GetPaperRatio(e,D.clone().applyMatrix4(b));this._leftLineNode.setMatrix(this._leftLineNode.getMatrix().setPosition(D));var v=new t.Vector3(0,1.1*-S*.5,0),A=4*m.GetPaperRatio(e,v.clone().applyMatrix4(b));this._bottomLineNode.setMatrix(this._bottomLineNode.getMatrix().setPosition(v));var X=new t.Vector3(0,1.1*S*.5,0),I=4*m.GetPaperRatio(e,X.clone().applyMatrix4(b));this._topLineNode.setMatrix(this._topLineNode.getMatrix().setPosition(X)),this._rightAxisNode.setMatrix((new t.Matrix4).makeScale(C.x+.05*_+2*G,1,1)),this._leftAxisNode.setMatrix((new t.Matrix4).makeScale(-y.x+.05*_+2*x,1,1)),this._topAxisNode.setMatrix((new t.Matrix4).makeScale(1,C.y+.05*S+2*I,1)),this._bottomAxisNode.setMatrix((new t.Matrix4).makeScale(1,-y.y+.05*S+2*A,1))}}},update:function(e){this._parent();var i=!1,r=this.Modifiable.QueryInterface("VCXIVisibility");r&&(i=r.GetVisibility());var o=this.GetPropertyValue("Section.Plane.Enable")?this.GlobalOpacity:0;if(this._globalOpacity!==o){this._globalOpacity=o;var a=this._globalOpacity>0;a&&(this._MeshNode||this._Build()),this.setVisibility(a)}var n=this.Modifiable.GetObject()._cappingMaterial;if(n&&i){var s=Math.cos(this.GetPropertyValue("Section.Hatching.Angle")*Math.PI/180),l=Math.sin(this.GetPropertyValue("Section.Hatching.Angle")*Math.PI/180),p=this.GetColorPropertyValue("Section.Capping"),u=this.GetColorPropertyValue("Section.Hatching"),h=this.GetPropertyValue("Section.Hatching.Frequency");n.stripesDirection=new t.Vector2(s+l,l-s),n.spaceWidth=500/(h+1),n.stripesWidth=Boolean(h)?1.5:0,n.spaceColor=p.GetThreeColor(),n.stripesColor=u.GetThreeColor(),n.autoSpaceColor!==this.GetPropertyValue("Section.Capping.ActorColor")&&(n.autoSpaceColor=this.GetPropertyValue("Section.Capping.ActorColor"))}if(!(this._globalOpacity<=0)){this._bodyMat&&(this._bodyMat.opacity=this._globalOpacity);var d=this.GetColorPropertyValue("Actor");this._bodyMat&&this._bodyMat.line&&(this._bodyMat.line.color=d.GetThreeColor(),this._bodyMat.line.opacity=1,this._bodyMat.color=d.GetThreeColor(),this._axisMat.color=d.GetThreeColor()),this.handleLayers()}}})}),define("DS/VCXWebDressup/VCXSectionSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXSectionNode"],function(e,t){"use strict";return e.extend({init:function(){},getWorldMatrix:function(e){var t=this.getAnchorReferential(),i=this.QueryInterface("VCXIModifiable");return i&&(this._actorPosition=i.GetFramePropertyValue("Actor.Position"),this._actorPosition&&t.multiply(this._actorPosition)),t},buildSGNode:function(){if(!this._sgNode){var e={name:"Section",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Section.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShapePerimetric",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS"],function(e,t){"use strict";return e.extend({rewind:function(){this._parent(),this.iCurrent=0,this.rMax=Math.min(this.sizeView.x,this.sizeView.y),this.rMax<this.fCellSize&&(this.rMax=this.fCellSize),this.r=this.fCellSize,this.nbPerCircle=Math.floor(2*Math.PI*this.r/this.fCellSize+.5),this.iT=0,this.dt=0,this.iParite=0},next:function(){if(this._parent(),this.iT++,this.iT>=this.nbPerCircle){if(this.r+=this.fCellSize,this.r>this.rMax)return this.rewind(),!0;this.iT=0,this.nbPerCircle=Math.floor(2*Math.PI*this.r/this.fCellSize+.5),1&this.iParite?this.dt=Math.PI/this.nbPerCircle:this.dt=0,this.iParite++}return!1},getPoint:function(e){var i=new t.Vector2,r=this.dt+2*Math.PI*this.iT/this.nbPerCircle;return i.x=Math.cos(r)*this.r+e.x,i.y=Math.sin(r)*this.r+e.y,i}})});__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXCircularArrow_Spec",["require","exports","DS/VCXWebDressup/VCXArrow_Spec"],function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{constructor(){super(),this.IsAnchorDependent=!0}}return function(e){let t;!function(e){e[e.Cylindrical=0]="Cylindrical",e[e.Flat=1]="Flat",e[e.Hybrid=2]="Hybrid"}(t=e.EFlatMode||(e.EFlatMode={}))}(r||(r={})),r.prototype.getDefaultName=function(){return"CircularArrow"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXCircularArrow_Spec"}}),r.prototype.dressupGroupName="Markups",r}),define("DS/VCXWebDressup/VCXArrowCircularModifiable",["DS/VCXWebDressup/VCXArrowModifiable","DS/VCXWebDressup/VCXCircularArrow_Spec","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueVector"],function(e,t,i,r,o,a,n,s,l){"use strict";return e.extend({init:function(){this._parent(),this._handleAnchor=null},Build:function(){this._parent();var e=[{Name:"Actor.Anchor.0",Type:s,DefaultValue:(new s).SetValueFrame((new n).SetValueFromVector(new i.Vector3(0,0,0))).GetValue(),GroupId:"Group.Arrow",visibleInPropertyGroups:!1},{Name:"Arrow.Circular.Flat",Type:r,DefaultValue:t.EFlatMode.Flat,GroupId:"Group.Arrow",MapChoice:this._generateMapChoiceFromEnumAndId(t.EFlatMode,"Flatness.Type",["Hybrid"])},{Name:"Arrow.Circular.Angle",Type:o,DefaultValue:270,Bounds:{Min:0,Max:360,Step:1},GroupId:"Group.Arrow"},{Name:"Arrow.Circular.Radius",Type:o,DefaultValue:100,GroupId:"Group.Arrow"},{Name:"Arrow.Circular.Step",Type:a,DefaultValue:64,Bounds:{Min:2,Max:100,Step:1},GroupId:"Group.Arrow",visibleInPropertyGroups:!1},{Name:"Actor.Position.Frame",Type:n,Persistent:!1,GroupId:"Group.Position",hiddenFields:["Orientation","Scale"]},{Name:"Collab.ListAnchorsIDs",Type:l,DefaultValue:[0]}];this._BuildPropertyValues(e)},GetProperty:function(e){if("Actor.Position.Frame"===e){var t=this.GetProperty("Actor.Anchor.0");return this.GetNewProperty(e,t.GetPropertyValue().GetValueFrame().Value)}return this._parent(e)},RequestModification:function(e,t){if(e&&"Actor.Position.Frame"===e.GetPropertyInfo().GetPropertyName()){var i=this.GetProperty("Actor.Anchor.0").Clone();return i.GetPropertyValue().SetValueFrame(e.GetPropertyValue()),propSet.AddOrModifyProperty(this.GetHashing(),i),propSet.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,propSet)}return this._parent(e,t)}})}),define("DS/VCXWebDressup/VCXAttachesNode",["DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXAttachSegmentNode","DS/VCXWebDressup/VCXAttachTooltipNode","DS/Visualization/ThreeJS_DS","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup"],function(e,t,i,r,o,a){"use strict";var n="warning",s={unsupportedAttach:{level:n,title:a["Notification.UnSupportedAttach.Title"],message:a["Notification.UnSupportedAttach.Message"]},noPaperManager:{level:n,title:a["Notification.noPaperManager.Title"],message:a["Notification.noPaperManager.Message"]}};return t.extend({init:function(t){return this._parent(t),this._PanelNode=t.panelNode,this._BentLineSize=2,this._MinAngleAllowed=5,this._MinAngleAllowedRad=this._MinAngleAllowed*Math.PI/180,this._horizontalLineMargin=1,this._AttachType=e.ELeadType.Middle,this._AttachNodes={},this._smartNodeCenter=new o.Vector3,this._xAxis=new o.Vector3,this._yAxis=new o.Vector3,this._zAxis=new o.Vector3,this},_getBentLineVerticesPosInPaper:function(e,t){var i=t?-1:1,r=e.clone();r.x=r.x+i*this._PanelNode.GetShapeInfo().size.x*.5;var o=r.clone();return o.x=o.x+i*this._BentLineSize,{start:r,end:o}},_getHorizontalLineVerticesPosInPaper:function(e,t,i){var r=t?-1:1,o=i?-1:1,a=e.clone();a.x=a.x-r*this._PanelNode.GetShapeInfo().size.x*.5,a.y=a.y+o*(.5*this._PanelNode.GetShapeInfo().size.y+this._horizontalLineMargin);var n=a.clone();return n.x=n.x+r*this._PanelNode.GetShapeInfo().size.x,{start:a,end:n}},_checkBreakStillToBeUsedFromBentEndPos:function(e,t,i){var r=new o.Vector3(e.EndExtremityPaper.x-t.x,e.EndExtremityPaper.y-t.y,e.EndExtremityPaper.z);return i.angleTo(r)*(180/Math.PI)>=90+this._MinAngleAllowed},_findBestCorner:function(e,t){return{left:e.x>t.EndExtremityPaper.x,top:e.y>t.EndExtremityPaper.y}},_ComputePosLinesAttaches:function(t,i){var r,a,n=null,s=null,l=!0,p=!0,u=(new o.Vector3).getPositionFromMatrix(this._PanelNode.GetShapeInfo().smartNode.getMatrix(t)),h=i.ModelToMM2(t,u);if(h.x+=this._PanelNode.GetShapeInfo().center.x,h.y+=this._PanelNode.GetShapeInfo().center.y,this._AttachType===e.ELeadType.Middle)l=!1,p=!1;else if(this._AttachType===e.ELeadType.Line){var d=0,c=0;for(n in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(n)){s=this._AttachNodes[n];var y=this._findBestCorner(h,s);y.top?d++:d--,y.left?c++:c--}var C=this._getHorizontalLineVerticesPosInPaper(h,c>0,d>0),m=this._getHorizontalLineVerticesPosInPaper(h,c<0,d>0);r=i.MMToModel2(t,C.start),a=i.MMToModel2(t,C.end)}else{C=this._getBentLineVerticesPosInPaper(h,!0),m=this._getBentLineVerticesPosInPaper(h,!1);var f=new o.Vector3(h.x-C.end.x,h.y-C.end.y,h.z),V=new o.Vector3(h.x-m.end.x,h.y-m.end.y,h.z);for(n in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(n)){if(!l&&!p)break;s=this._AttachNodes[n],l=l&&this._checkBreakStillToBeUsedFromBentEndPos(s,C.end,f),p=p&&this._checkBreakStillToBeUsedFromBentEndPos(s,m.end,V)}l?(r=i.MMToModel2(t,C.start),a=i.MMToModel2(t,C.end)):p&&(r=i.MMToModel2(t,m.start),a=i.MMToModel2(t,m.end))}for(n in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(n)){if(s=this._AttachNodes[n],this._AttachType===e.ELeadType.Line)s.StartExtremity=r,s.BreakExtremity=a;else if(l||p)s.StartExtremity=r,s.BreakExtremity=a;else{var b=h.clone(),P=new o.Vector3;s.EndExtremityPaper.sub(new o.Vector3(b.x,b.y,0));var g=.5*this._PanelNode.GetShapeInfo().size.x,_=.5*this._PanelNode.GetShapeInfo().size.y,S=this._PanelNode.GetShapeInfo().shape;(S!==e.EBodyShape.None&&S!==e.EBodyShape.RoundedRectangle&&S!==e.EBodyShape.Rectangle&&S!==e.EBodyShape.RoundedSquare&&S!==e.EBodyShape.Square||!this.SegmentIntersectRectangle(s.EndExtremityPaper,-g,-_,g,_,P))&&(S!==e.EBodyShape.Circle&&S!==e.EBodyShape.Ellipse||!this.SegmentIntersectEllipse(s.EndExtremityPaper,g,_,!1,P))||b.add(new o.Vector3(P.x,P.y,0)),s.StartExtremity=i.MMToModel2(t,b),s.BreakExtremity=s.StartExtremity.clone()}s.preRender(t)}},_ComputePosTooltipAttaches:function(e,t){var i,r,a=this.getBodyCenterPosInPaper(e,t);if(this.Modifiable.GetPropertyValue("Collab.Attach.CenteredOrigin"))r=a;else{var n=this.Modifiable.GetPropertyValue("Collab.Attach.Origin");if(n.equals(new o.Vector3)){var s=this.Modifiable.GetProperty("Collab.Attach.Origin").GetPropertyValue().Clone();s.SetValue(a.clone()),this.Modifiable.OnChangeProperty("Collab.Attach.Origin",s),r=this.Modifiable.GetPropertyValue("Collab.Attach.Origin")}else{r=(new o.Vector3).copy(n).setZ(a.z)}}for(var l in i=t.MMToModel2(e,r),this._AttachNodes)if(this._AttachNodes.hasOwnProperty(l)){var p=this._AttachNodes[l];p.StartExtremity=i,p.preRender(e)}},getBodyCenterPosInPaper:function(e,t){var i=(new o.Vector3).getPositionFromMatrix(this._PanelNode.GetShapeInfo().smartNode.getMatrix(e)),r=t.ModelToMM2(e,i);return r.x+=this._PanelNode.GetShapeInfo().center.x,r.y+=this._PanelNode.GetShapeInfo().center.y,r},_ComputePosAttaches:function(t){var i=this.ExperienceBase.getManager("VCXPaperManager");if(i){if(this._AttachType!==e.ELeadType.None&&0!==Object.keys(this._AttachNodes).length){for(var r in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(r)){var o=this.GetAnchorWorldMatrix(r,t);if(o){var a=this._AttachNodes[r];a.EndExtremity.getPositionFromMatrix(o),a.EndExtremityPaper=i.ModelToMM2(t,a.EndExtremity)}}switch(this._AttachType){case e.ELeadType.Mustache:this._ComputePosTooltipAttaches(t,i);break;default:this._ComputePosLinesAttaches(t,i)}}}else this.ExperienceBase.getManager("VCXNotificationManager").addNotification(s.noPaperManager)},dispose:function(){for(var e in this._AttachNodes)this._AttachNodes.hasOwnProperty(e)&&this._AttachNodes[e].dispose();this._AttachNodes={},this._parent()},_Build:function(){},preRender:function(e){this._parent(e),this.viewpointVisibility&&this.allAnchorsReady&&this.GlobalOpacity?(this.setVisibility(!0),this._ComputePosAttachesSmartNode(e)):this.setVisibility(!1)},update:function(t){this._parent();var o=this.GlobalOpacity,a=this.GetPropertyValue("Collab.Attach.LeadType");if(this._AttachType!==a){for(var n in this._AttachNodes)this._AttachNodes.hasOwnProperty(n)&&this._AttachNodes[n].dispose();this._AttachNodes={},this._AttachType=a}var s=!1,l=this.Modifiable&&this.Modifiable._Anchors;for(let e in l)l[e].toDelete=!0;if(l&&Object.keys(l).length>0){this.Modifiable.processAnchorsIDs(t=>{if("Location"!==t)if(this.GetPropertyGroupVisibility("Group.Attach")&&this._AttachType!==e.ELeadType.None&&o>0){if(l[t].toDelete=!1,!this._AttachNodes.hasOwnProperty(t)){var a={name:"AttachNode "+t,modifiable:this.Modifiable,type:this._type,anchorID:t};this._AttachType===e.ELeadType.Mustache?(a.bConsiderCurvature=!0,a.gradientBackGround=this.GetPropertyValue("Collab.Attach.Background.Gradient"),a.gradientBorder=this.GetPropertyValue("Collab.Attach.Border.Gradient"),this._AttachNodes[t]=new r(a)):(a.endExtremityType=this.GetPropertyValue("Collab.Attach.ExtremityType"),this._AttachNodes[t]=new i(a)),this._AttachNodes[t].exludeFromBounding(!0),this.add(this._AttachNodes[t]),s=!0,this.handleLayers(!0)}}else this._AttachNodes.hasOwnProperty(t)&&(this.remove(this._AttachNodes[t]),delete this._AttachNodes[t],s=!0)});for(let e in l)l[e].toDelete&&this._AttachNodes.hasOwnProperty(e)&&(this.remove(this._AttachNodes[e]),delete this._AttachNodes[e],s=!0);for(var p in this._AttachNodes)this._AttachNodes.hasOwnProperty(p)&&this._AttachNodes[p].update(t)}this.handleLayers(s)},postUpdate:function(e){for(var t in this._parent(),this._AttachNodes)this._AttachNodes.hasOwnProperty(t)&&this._AttachNodes[t].postUpdate(e)},_ComputePosAttachesSmartNode:function(t){const i=this.ExperienceBase.getManager("VCXPaperManager");if(!i)return void this.ExperienceBase.getManager("VCXNotificationManager").addNotification(s.noPaperManager);if(this._AttachType===e.ELeadType.None||0===Object.keys(this._AttachNodes).length)return;const r=this._PanelNode.GetShapeInfo().smartNode.getMatrix(t);if(!r)return;this._smartNodeCenter.getPositionFromMatrix(r),r.extractBasis(this._xAxis,this._yAxis,this._zAxis),this._xAxis.normalize(),this._yAxis.normalize(),this._zAxis.normalize();const a=i.GetPaperRatio(t,this._smartNodeCenter);var n=this._xAxis.clone().multiplyScalar(this._PanelNode.GetShapeInfo().center.x*a),l=this._yAxis.clone().multiplyScalar(-this._PanelNode.GetShapeInfo().center.y*a);this._smartNodeCenter.add(n).add(l);var p=(new o.Plane).setFromNormalAndCoplanarPoint(this._zAxis,this._smartNodeCenter),u=t.viewpoint.getEyePosition();for(var h in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(h)){var d=this.GetAnchorWorldMatrix(h,t);if(d){var c=this._AttachNodes[h];c.EndExtremity.getPositionFromMatrix(d);var y=new o.Ray(u,c.EndExtremity.clone().sub(u));c.EndExtremityInSmartNodePlane=y.intersectPlane(p)}}switch(this._AttachType){case e.ELeadType.Mustache:this._ComputePosTooltipAttachesSmartNode(a,t,i);break;default:this._ComputePosLinesAttachesSmartNode(a,t)}},_ComputePosTooltipAttachesSmartNode:function(e,t){var i;if(this.Modifiable.GetPropertyValue("Collab.Attach.CenteredOrigin")||!this._PanelNode.GetShapeInfo().smartNode.is2D())i=this._smartNodeCenter.clone();else{var r=this.Modifiable.GetPropertyValue("Collab.Attach.Origin");if(r.equals(new o.Vector3)){var a=this.Modifiable.GetProperty("Collab.Attach.Origin").GetPropertyValue().Clone();a.SetValue(this._smartNodeCenter),this.Modifiable.OnChangeProperty("Collab.Attach.Origin",a),i=this._smartNodeCenter.clone()}else{var n=this._PanelNode.GetShapeInfo().smartNode.Position2D,s=r.x-n.x,l=-(r.y-n.y),p=this.Modifiable.GetPropertyValue("Collab.Body.HAlignment")-1,u=this.Modifiable.GetPropertyValue("Collab.Body.VAlignment")-1;s+=p*this._PanelNode.GetShapeInfo().size.x*.5,l-=u*this._PanelNode.GetShapeInfo().size.y*.5;var h=this._xAxis.clone().multiplyScalar(s*e),d=this._yAxis.clone().multiplyScalar(l*e);i=this._smartNodeCenter.clone().add(h).add(d)}}for(var c in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(c)){var y=this._AttachNodes[c];y.StartExtremity=i,y.preRender(t)}},_ComputePosLinesAttachesSmartNode:function(t,i){var r,a,n=null,s=null,l=!0,p=!0;if(this._AttachType===e.ELeadType.Middle)l=!1,p=!1;else if(this._AttachType===e.ELeadType.Line){var u=0,h=0;for(n in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(n)){s=this._AttachNodes[n];var d=this._findBestCornerSmartNode(s);d.top?u++:u--,d.left?h++:h--}var c=this._getHorizontalLineVerticesSmartNode(t,h>0,u>0);r=c.start,a=c.end}else{var y=this._getBentLineVerticesSmartNode(t,!0),C=this._getBentLineVerticesSmartNode(t,!1);for(n in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(n)){if(!l&&!p)break;s=this._AttachNodes[n],l=l&&this._checkBreakStillToBeUsed(s,y),p=p&&this._checkBreakStillToBeUsed(s,C)}l?(r=y.start,a=y.end):p&&(r=C.start,a=C.end)}for(n in this._AttachNodes)if(this._AttachNodes.hasOwnProperty(n)){if(s=this._AttachNodes[n],this._AttachType===e.ELeadType.Line)s.StartExtremity=r,s.BreakExtremity=a;else if(l||p)s.StartExtremity=r,s.BreakExtremity=a;else{var m=this._smartNodeCenter.clone(),f=new o.Vector3,V=s.EndExtremityInSmartNodePlane.clone().sub(this._smartNodeCenter),b=this._xAxis.clone().dot(V)/t,P=this._yAxis.clone().dot(V)/t,g=new o.Vector2(b,P),_=.5*this._PanelNode.GetShapeInfo().size.x,S=.5*this._PanelNode.GetShapeInfo().size.y,M=this._PanelNode.GetShapeInfo().shape;(M!==e.EBodyShape.None&&M!==e.EBodyShape.RoundedRectangle&&M!==e.EBodyShape.Rectangle&&M!==e.EBodyShape.RoundedSquare&&M!==e.EBodyShape.Square||!this.SegmentIntersectRectangle(g,-_,-S,_,S,f))&&(M!==e.EBodyShape.Circle&&M!==e.EBodyShape.Ellipse||!this.SegmentIntersectEllipse(g,_,S,!1,f))||m.add(this._xAxis.clone().multiplyScalar(f.x*t)).add(this._yAxis.clone().multiplyScalar(f.y*t)),s.StartExtremity=m,s.BreakExtremity=s.StartExtremity.clone()}s.preRender(i)}},_getBentLineVerticesSmartNode:function(e,t){var i=t?-1:1,r=this._xAxis.clone().multiplyScalar(.5*i*this._PanelNode.GetShapeInfo().size.x*e),o=this._xAxis.clone().multiplyScalar(i*this._BentLineSize*e),a=this._smartNodeCenter.clone().add(r),n=a.clone().add(o);return{start:a,end:n}},_getHorizontalLineVerticesSmartNode:function(e,t,i){var r=t?1:-1,o=i?-1:1,a=this._xAxis.clone().multiplyScalar(.5*r*this._PanelNode.GetShapeInfo().size.x*e),n=this._yAxis.clone().multiplyScalar((.5*o*this._PanelNode.GetShapeInfo().size.y+this._horizontalLineMargin)*e),s=this._smartNodeCenter.clone().add(a).add(n),l=s.clone().sub(a.clone().multiplyScalar(2));return{start:s,end:l}},_checkBreakStillToBeUsed:function(e,t){var i=e.EndExtremityInSmartNodePlane.clone().sub(t.end);return t.start.clone().sub(t.end).angleTo(i)>=.5*Math.PI+this._MinAngleAllowedRad},_findBestCornerSmartNode:function(e){var t=e.EndExtremityInSmartNodePlane.clone().sub(this._smartNodeCenter);return{left:this._xAxis.dot(t)<0,top:this._yAxis.dot(t)<0}},SegmentIntersectRectangle:function(e,t,i,r,a,n){if(e.x>t&&e.x<r&&e.y>i&&e.y<a)return!1;var s=new o.Vector2(r,a),l=new o.Vector2(t,a);if(this.IntersectSegment(e,s,l,n))return!0;var p=new o.Vector2(t,i);if(this.IntersectSegment(e,l,p,n))return!0;var u=new o.Vector2(r,i);return!!this.IntersectSegment(e,u,s,n)||(!!this.IntersectSegment(e,u,p,n)||(n=e.clone(),!1))},SegmentIntersectEllipse:function(e,t,i,r,a){var n,s;a.x=e.x,a.y=e.y,a.z=e.z;var l,p,u=new o.Vector2(e.x,e.y),h=new o.Vector2(e.x,e.y),d=!1,c=0,y=0,C=0,m=0,f=0;l=t*t,p=i*i,Math.abs(h.y)>Math.abs(h.x)?(d=!0,C=1/p+(c=h.x/h.y)*c/l,m=2*c*(y=u.x-c*u.y)/l,f=y*y/l-1):(C=1/l+(c=h.y/h.x)*c/p,m=2*c*(y=u.y-c*u.x)/p,f=y*y/p-1);var V=m*m-4*C*f;if(V<0)return!1;var b=!1;if(0===V)d?(s=-m/2*C,u.x=c*s+y,u.y=s):(n=-m/2*C,u.x=n,u.y=c*n+y),(b=!!r||this.IsPointInSegment(e,u))&&(a.x=u.x,a.y=u.y);else{var P=Math.sqrt(V);d?n=c*(s=(-m+P)/(2*C))+y:s=c*(n=(-m+P)/(2*C))+y;var g,_=new o.Vector2(n,s);g=!!r||this.IsPointInSegment(e,_),d?n=c*(s=(-m-P)/(2*C))+y:s=c*(n=(-m-P)/(2*C))+y;var S=new o.Vector2(n,s),M=!1;if(M=!!r||this.IsPointInSegment(e,S),g&&M){var G=_.x-S.x,D=_.y-S.y,x=G*G+D*D,v=.1*Math.min(t,i);if(x<v*v)return!1;x=(G=_.x-a.x)*G+(D=_.y-a.y)*D,(G=S.x-a.x)*G+(D=S.y-a.y)*D<x?(a.x=S.x,a.y=S.y):(a.x=_.x,a.y=_.y),b=!0}else g?(a.x=_.x,a.y=_.y,b=!0):M&&(a.x=S.x,a.y=S.y,b=!0)}return b},IsPointInSegment:function(e,t){var i=e.x,r=e.y,o=i*i+r*r,a=i*t.x+r*t.y;return!(a<0||a>o)},IntersectSegment:function(e,t,i,r){var o=-e.x*(t.y-e.y)- -e.y*(t.x-e.x),a=(i.x-t.x)*(t.y-e.y)-(i.y-t.y)*(t.x-e.x),n=-e.y*(i.x-t.x)- -e.x*(i.y-t.y);if(0===n)return!1;var s=o/n,l=a/n;return r.x=t.x+s*(i.x-t.x),r.y=t.y+s*(i.y-t.y),s>=0&&s<=1&&l>=0&&l<=1}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShapeTop",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS"],function(e,t){"use strict";return e.extend({rewind:function(){this._parent(),this.iPariteX=0,this.fX=0,this.dx=0,this.fY=this.fHalfSizeY-this.fCellSize,this.fY<0&&(this.fY=0)},next:function(){return this._parent(),0===this.fX&&this.iPariteX++,this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,this.fX+=this.fCellSize,this.fX>this.fHalfSizeX-this.fCellSize&&(0===this.dx?this.dx=.5*this.fCellSize:this.dx=0,this.fX=0,this.fY-=this.fCellSize,this.fY<-this.fHalfSizeY+this.fCellSize))&&(this.rewind(),!0)},getPoint:function(){var e=new t.Vector2;return 1&this.iPariteX?e.x=this.fHalfSizeX-this.fX+this.dx:e.x=this.fHalfSizeX+this.fX+this.dx,e.y=this.fHalfSizeY-this.fY,e}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShapeBottomAndRight",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools"],function(e,t,i){"use strict";return e.extend({rewind:function(){this._parent(),this.iSwap=0,this.iPariteX=0,this.iPariteY=0,this.fX=0,this.dx=0,this.fY=this.fHalfSizeY-this.fCellSize,this.fY<0&&(this.fY=0),this.maxfx=this.fHalfSizeX-this.fCellSize-this.fCellSize,this.LRiPariteX=0,this.LRiPariteY=0,this.LRfX=this.fHalfSizeX-this.fCellSize,this.LRfX<0&&(this.LRfX=0),this.LRdy=0,this.LRfY=0,this.LRmaxfy=this.fHalfSizeY-this.fCellSize},next:function(){if(this._parent(),this.iSwap++,1&this.iSwap){if(this.LRiPariteY++,2===this.LRiPariteY&&(this.LRiPariteY=0,this.LRfY+=this.fCellSize,this.LRfY>this.fHalfSizeY-this.fCellSize&&(0===this.LRdy?this.LRdy=.5*this.fCellSize:this.LRdy=0,this.LRfY=0,this.LRfX-=this.fCellSize,this.LRfX<this.fCellSize)))return this.rewind(),!0}else if(0===this.fX&&this.iPariteX++,this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,this.fX+=this.fCellSize,this.fX>this.maxfx&&(this.maxfx-=this.fCellSize,this.maxfx<this.fCellSize&&(this.maxfx=this.fCellSize),0===this.dx?this.dx=.5*this.fCellSize:this.dx=0,this.fX=0,this.fY-=this.fCellSize,this.fY<this.fCellSize)))return this.rewind(),!0;return!1},getPoint:function(){var e=new t.Vector2;return 1&this.iSwap?(e.x=this.fHalfSizeX+this.LRfX,1&this.LRiPariteY?e.y=this.fHalfSizeY-this.LRfY+this.LRdy:e.y=this.fHalfSizeY+this.LRfY+this.LRdy):(1&this.iPariteX?e.x=this.fHalfSizeX-this.fX+this.dx:e.x=this.fHalfSizeX+this.fX+this.dx,e.y=this.fHalfSizeY+this.fY),e}})}),define("DS/VCXWebDressup/VCXCircleNode",["DS/VCXWebDressup/VCXAnchorServices","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/Visualization/Node3D","DS/SceneGraphNodes/AxisSystemNode","DS/VCXWebSystem/VCXMathTools"],function(e,t,i,r,o,a,n,s,l){"use strict";return t.extend({_circleSubdivision:64,init:function(e){this._parent(e),this._verticesNb=2*this._circleSubdivision;var t=2*this._circleSubdivision;return this._trianglesIndicesNb=3*t,this._lineIndicesNb=2*this._circleSubdivision,this},_getPosVectArray:function(){for(var e=[],t=2*Math.PI/this._circleSubdivision,i=0;i<this._circleSubdivision;++i){var o=i*t,a=new r.Vector3(Math.cos(o),Math.sin(o),0);e.push(a)}if(2===this.GetPropertyValue("Circle.Background.Type"))for(i=this._circleSubdivision;i<this._verticesNb;++i)e.push(new r.Vector3(0,0,0));else if(1===this.GetPropertyValue("Circle.Background.Type")){var n=(100-this.GetPropertyValue("Circle.Thickness"))/100;for(i=this._circleSubdivision;i<this._verticesNb;++i){o=i*t;var s=new r.Vector3(n*Math.cos(o),n*Math.sin(o),0);e.push(s)}}return e},_computePosBuffer:function(e){for(var t=this._getPosVectArray(),i=0;i<t.length;++i)e[3*i+0]=t[i].x,e[3*i+1]=t[i].y,e[3*i+2]=t[i].z},_computeColorBuffers:function(e){var t=0,i=this.GetColorPropertyValue("Collab.Background");0===this.GetPropertyValue("Circle.Background.Type")&&(i.a=0);var r=i.Clone();this.GetPropertyValue("Circle.Background.Type")<2&&(r.a=0),3===this.GetPropertyValue("Circle.Background.Type")&&(r=this.GetColorPropertyValue("Collab.Background2"));var o=i.GetRGBA(),a=r.GetRGBA();for(t=0;t<this._circleSubdivision;++t)e[4*t+0]=o[0],e[4*t+1]=o[1],e[4*t+2]=o[2],e[4*t+3]=o[3];for(t=this._verticesNb/2;t<this._verticesNb;++t)e[4*t+0]=a[0],e[4*t+1]=a[1],e[4*t+2]=a[2],e[4*t+3]=a[3]},_ComputeBuffers:function(e,t){return this._computePosBuffer(e),this._computeColorBuffers(t),this._verticesNb},dispose:function(){this._Smart3DPaperNode&&(this._Smart3DPaperNode.dispose(),this._Smart3DPaperNode=null),this._parent()},_Build:function(){this._PrimitiveGroup=new o.PrimitiveGroup({editable:!0});var e=new o.Buffer({component:o.VertexComponentEnum.POSITION,data:new Float32Array(3*this._verticesNb),dimension:3}),t=new o.Buffer({component:o.VertexComponentEnum.DIFFUSE_COLOR,data:new Float32Array(4*this._verticesNb),dimension:4}),s=new o.Buffer({indexBuffer:!0,data:new Uint16Array(this._trianglesIndicesNb+this._lineIndicesNb)});this._PrimitiveGroup.addBuffer(0,e),this._PrimitiveGroup.addBuffer(1,t),this._PrimitiveGroup.addBuffer(2,s);var l=s.data,p=0,u=0,h=0;for(p=0,u=1;p<this._circleSubdivision;++p,++u)u===this._circleSubdivision&&(u=0),l[h++]=p,l[h++]=u,l[h++]=this._circleSubdivision+p,l[h++]=this._circleSubdivision+p,l[h++]=u,l[h++]=this._circleSubdivision+u;for(p=0;p<this._circleSubdivision;++p)l[h++]=p,l[h++]=p===this._circleSubdivision-1?0:p+1;var d=new o.Primitive({nbIndices:this._trianglesIndicesNb,connectivity:o.ConnectivityTypeEnum.TRIANGLES}),c=new o.VertexComponent({bufferId:0,indices:new o.IndexArray({bufferId:2,offset:0})}),y=new o.VertexComponent({bufferId:1,indices:new o.IndexArray({bufferId:2,offset:0})});d.addVertexComponent(c),d.addVertexComponent(y),this._PrimitiveGroup.addPrimitive(d);var C=new o.Primitive({nbIndices:this._lineIndicesNb,connectivity:o.ConnectivityTypeEnum.LINES}),m=new o.VertexComponent({bufferId:0,indices:new o.IndexArray({bufferId:2,offset:this._trianglesIndicesNb})});C.addVertexComponent(m),this._PrimitiveGroup.addPrimitive(C),this._bodyMat=new r.MeshBasicMaterial({side:r.DoubleSide,vertexColors:r.VertexColors,color:"#ffffff",transparent:!0,opacity:1,polygonOffset:!0,polygonOffsetFactor:-1,polygonOffsetUnits:-10,force:!0});var f=this.Modifiable.getLineMaterialParams("Collab.Body.Line",this._bodyMat.line,this._lastFrontLineType);f.polygonOffset=!0,f.polygonOffsetFactor=1,f.polygonOffsetUnits=-2,Object.keys(f).length>0&&("number"==typeof f.type&&f.type!==this._lastFrontLineType&&(this._lastFrontLineType=f.type),f.polygonBorderMode=!0,this._bodyMat.line=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(f,this._bodyMat.line));var V=new r.Vector3(0,0,0),b=this.GetAnchorWorldMatrix(0,null);b?V.getPositionFromMatrix(b):console.log("centerMatrix is null or undefined...");var P=(new r.Quaternion).setFromRotationMatrix(b),g=(new r.Matrix4).compose(V,P,new r.Vector3(1,1,1));this._MeshNode=a.createMeshNode(this._PrimitiveGroup),this._MeshNode.setMaterial(this._bodyMat),this._MeshNode.setVisibilityInTree(!1),this._MeshNode.setMatrix(g),this._MeshNode.excludeFromHighlight(!0,!0),this._hlMeshNode=a.createCircleNode({radius:1,segments:this._circleSubdivision,fill:!0,color:new o.Color(0,0,0,0),noEdge:!0}),this._hlMeshNode.setVisibilityInTree(!1),this._hlMeshNode.setMatrix(g),this._hlMeshNode.setPickable(o.PICKABLE);var _={name:"CircleSmartNode",modifiable:this.Modifiable};if(this._Smart3DPaperNode=new i(_),this._Smart3DPaperNode.add(this._MeshNode),this._Smart3DPaperNode.add(this._hlMeshNode),this.add(this._Smart3DPaperNode),this._Smart3DPaperNode&&!this._radiusHandleNodes){this._radiusHandleNodes=[{id:1}];var S=0;this._radiusHandleNodes.forEach(function(e){var t=(new r.Matrix4).makeRotationZ(S+Math.PI/2),i=(new r.Matrix4).setPosition({x:Math.cos(S),y:Math.sin(S),z:0});S+=Math.PI/2,e.matrixLocal=(new r.Matrix4).multiplyMatrices(i,t),e.node=new n,this._Smart3DPaperNode.add(e.node)}.bind(this))}},preRender:function(e){if(this._parent(e),this.viewpointVisibility&&this.allAnchorsReady&&this.GlobalOpacity){if(this.setVisibility(!0),this._bodyMat&&this._bodyMat.line){this._bodyMat.line.handleByPrerender=!0;let e=this.ExperienceBase.getManager("VCXPaperManager").UnitValueToPixel(this.Modifiable.GetPropertyValue("Collab.Body.Line.Width"));this.Modifiable.GetPropertyValue("Collab.Border.AlwaysVisible")?(this._bodyMat.line.setLineWidth(e),this._bodyMat.line.visible=!0):e>=1?(this._bodyMat.line.setLineWidth(e),this._bodyMat.line.visible=!0):this._bodyMat.line.visible=!1}this._Smart3DPaperNode&&this._Smart3DPaperNode.preRender(e)}else this.setVisibility(!1)},update:function(e){if(this._parent(),this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var t=this._globalOpacity>0;t&&(this._Smart3DPaperNode||this._Build()),this._Smart3DPaperNode&&this._Smart3DPaperNode.setVisibility(t)}if(!(this._globalOpacity<=0)&&this._Smart3DPaperNode){this._Smart3DPaperNode.SizeControlType=this.GetPropertyValue("Collab.Is.Paper")?1:0,this._Smart3DPaperNode.update(e);var i=this._MeshNode.getBuffer(o.VertexComponentEnum.POSITION),a=this._MeshNode.getBuffer(o.VertexComponentEnum.DIFFUSE_COLOR);if(i&&a){var n=this._ComputeBuffers(i,a);this._MeshNode.updateBuffer(o.VertexComponentEnum.POSITION,0,n),this._MeshNode.updateBuffer(o.VertexComponentEnum.DIFFUSE_COLOR,0,n),this._MeshNode.computeBoundingElements()}this._Smart3DPaperNode&&this._bodyMat&&(this._bodyMat.opacity=this._globalOpacity);var s=this.GetPropertyValue("Circle.Radius");s*=this.GetPropertyValue("Circle.Scale");var p=(new r.Matrix4).makeScale(s,s,1);this._MeshNode.setMatrix(p),this._hlMeshNode.setMatrix(p),this._radiusHandleNodes.forEach(function(e){var t=(new r.Matrix4).multiplyMatrices(p,e.matrixLocal),i=l.normalizeMatrix(t);i.setPosition(l.getOFromMatrix(t)),e.node.setMatrix(i)});var u=this.Modifiable.getLineMaterialParams("Collab.Body.Line",this._bodyMat.line,this._lastFrontLineType,this._globalOpacity);Object.keys(u).length>0&&("number"==typeof u.type&&u.type!==this._lastFrontLineType&&(this._lastFrontLineType=u.type),u.polygonBorderMode=!0,this._bodyMat.line=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(u,this._bodyMat.line)),this.handleLayers()}}})}),define("DS/VCXWebDressup/VCXCircleSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXCircleNode"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Circle",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Circle.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShapeLeft",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools"],function(e,t,i){"use strict";return e.extend({rewind:function(){this._parent(),this.iPariteY=0,this.fX=this.fHalfSizeX-this.fCellSize,this.fX<0&&(this.fX=0),this.dy=0,this.fY=0},next:function(){return this._parent(),0===this.fY&&this.iPariteY++,this.iPariteY++,2===this.iPariteY&&(this.iPariteY=0,this.fY+=this.fCellSize,this.fY>this.fHalfSizeY-this.fCellSize&&(0===this.dy?this.dy=.5*this.fCellSize:this.dy=0,this.fY=0,this.fX-=this.fCellSize,this.fX<-this.fHalfSizeX+this.fCellSize))&&(this.rewind(),!0)},getPoint:function(){var e=new t.Vector2;return e.x=this.fHalfSizeX-this.fX,1&this.iPariteY?e.y=this.fHalfSizeY-this.fY+this.dy:e.y=this.fHalfSizeY+this.fY+this.dy,e}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShapeTopAndLeft",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS"],function(e,t){"use strict";return e.extend({rewind:function(){this._parent(),this.iSwap=0,this.iPariteX=0,this.iPariteY=0,this.fX=0,this.dx=0,this.fY=this.fHalfSizeY-this.fCellSize,this.fY<0&&(this.fY=0),this.maxfx=this.fHalfSizeX-this.fCellSize-this.fCellSize,this.LRiPariteX=0,this.LRiPariteY=0,this.LRfX=this.fHalfSizeX-this.fCellSize,this.LRfX<0&&(this.LRfX=0),this.LRdy=0,this.LRfY=0,this.LRmaxfy=this.fHalfSizeY-this.fCellSize},next:function(){if(this._parent(),this.iSwap++,1&this.iSwap){if(this.LRiPariteY++,2===this.LRiPariteY&&(this.LRiPariteY=0,this.LRfY+=this.fCellSize,this.LRfY>this.fHalfSizeY-this.fCellSize&&(0===this.LRdy?this.LRdy=.5*this.fCellSize:this.LRdy=0,this.LRfY=0,this.LRfX-=this.fCellSize,this.LRfX<this.fCellSize)))return this.rewind(),!0}else if(0==this.fX&&this.iPariteX++,this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,this.fX+=this.fCellSize,this.fX>this.maxfx&&(this.maxfx-=this.fCellSize,this.maxfx<this.fCellSize&&(this.maxfx=this.fCellSize),0===this.dx?this.dx=.5*this.fCellSize:this.dx=0,this.fX=0,this.fY-=this.fCellSize,this.fY<this.fCellSize)))return this.rewind(),!0;return!1},getPoint:function(){var e=new t.Vector2;return 1&this.iSwap?(e.x=this.fHalfSizeX-this.LRfX,1&this.LRiPariteY?e.y=this.fHalfSizeY-this.LRfY+this.LRdy:e.y=this.fHalfSizeY+this.LRfY+this.LRdy):(1&this.iPariteX?e.x=this.fHalfSizeX-this.fX+this.dx:e.x=this.fHalfSizeX+this.fX+this.dx,e.y=this.fHalfSizeY-this.fY),e}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShapeRectangle",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS"],function(e,t){"use strict";return e.extend({rewind:function(){this._parent(),this.iSwap=0,this.iPariteX=0,this.iPariteY=0,this.fX=0,this.dx=0,this.fY=this.fHalfSizeY-this.fCellSize,this.fY<0&&(this.fY=0),this.maxfx=this.fHalfSizeX-this.fCellSize-this.fCellSize,this.LRiPariteX=0,this.LRiPariteY=0,this.LRfX=this.fHalfSizeX-this.fCellSize,this.LRfX<0&&(this.LRfX=0),this.LRdy=0,this.LRfY=0,this.LRmaxfy=this.fHalfSizeY-this.fCellSize},next:function(){if(this._parent(),this.iSwap++,1===this.iSwap)return!1;if(1&this.iSwap){if(this.LRiPariteX++,2===this.LRiPariteX&&(this.LRiPariteX=0,0===this.LRfY&&this.LRiPariteY++,this.LRiPariteY++,2===this.LRiPariteY&&(this.LRiPariteY=0,this.LRfY+=this.fCellSize,this.LRfY>this.fHalfSizeY-this.fCellSize&&(0===this.LRdy?this.LRdy=.5*this.fCellSize:this.LRdy=0,this.LRfY=0,this.LRfX-=this.fCellSize,this.LRfX<this.fCellSize))))return this.rewind(),!0}else if(this.iPariteY++,2===this.iPariteY&&(this.iPariteY=0,0==this.fX&&this.iPariteX++,this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,this.fX+=this.fCellSize,this.fX>this.maxfx&&(this.maxfx-=this.fCellSize,this.maxfx<this.fCellSize&&(this.maxfx=this.fCellSize),0===this.dx?this.dx=.5*this.fCellSize:this.dx=0,this.fX=0,this.fY-=this.fCellSize,this.fY<this.fCellSize))))return this.rewind(),!0;return!1},getPoint:function(){var e=new t.Vector2;return 1&this.iSwap?(1&this.LRiPariteX?e.x=this.fHalfSizeX-this.LRfX:e.x=this.fHalfSizeX+this.LRfX,1&this.LRiPariteY?e.y=this.fHalfSizeY-this.LRfY+this.LRdy:e.y=this.fHalfSizeY+this.LRfY+this.LRdy):(1&this.iPariteX?e.x=this.fHalfSizeX-this.fX+this.dx:e.x=this.fHalfSizeX+this.fX+this.dx,1&this.iPariteY?e.y=this.fHalfSizeY-this.fY:e.y=this.fHalfSizeY+this.fY),e}})}),define("DS/VCXWebDressup/VCXForegroundNode",["DS/VCXWebDressup/VCXDressupNode","DS/WebappsUtils/WebappsUtils","DS/Visualization/ThreeJS_DS","DS/VCXWebVisualization/VCXImageManager","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/VCXWebDressup/VCXSmart3DPaperNode"],function(e,t,i,r,o,a,n){"use strict";return e.extend({init:function(e){return this._parent(e),this},dispose:function(){this._Smart3DPaperNode&&(this._Smart3DPaperNode.dispose(),this._Smart3DPaperNode=null),this._parent()},_Build:function(e){var r=this.Modifiable.ExperienceBase.getManager("VCXVisuManager");this.setRenderPasses([r.getRenderList("VCXPreForeground"),r.getRenderList("VCXForeground")]),this._currentTime=0;var s=i.ImageUtils.loadTexture(t.getWebappsBaseUrl()+"VCXWebDressup/assets/textures/fgTextureA.png");s.wrapS=i.RepeatWrapping,s.wrapT=i.RepeatWrapping,s.repeat.set(500,500),this._bodyMat=new i.MeshLambertMaterial({color:"#ffffff",map:s,side:i.DoubleSide}),this._bodyMat.force=!0,this._MeshNode=a.createRectangleNode({width:1,height:1,fill:!0,material:this._bodyMat});var l=new i.Vector2(1e3,1e3,1),p=this.Modifiable.ExperienceBase.getManager("VCXPaperManager");p&&(l=p.Size,this._MeshNode.setMatrix((new i.Matrix4).makeScale(l.x,l.y,1)));var u=new i.Matrix4;u.multiply((new i.Matrix4).makeScale(100*l.x,100*l.y,1)),u.multiply((new i.Matrix4).makeRotationAxis(new i.Vector3(0,0,1),.3*Math.PI)),u.multiply((new i.Matrix4).makeTranslation(-.5,-.5,0)),this._MeshNode.setMatrix(u),this._MeshNode.setVisibilityInTree(!1);var h={name:"ForegroundSmartNode",experience:this.ExperienceBase};this._Smart3DPaperNode=new n(h),this._Smart3DPaperNode.Position2D.x=.5*l.x,this._Smart3DPaperNode.Position2D.y=.5*l.y,this._Smart3DPaperNode.BillboardType=2,this._Smart3DPaperNode.SizeControlType=1,this._Smart3DPaperNode.PositioningType=1e3,this._Smart3DPaperNode.Depth=0,this._Smart3DPaperNode.add(this._MeshNode),this.add(this._Smart3DPaperNode),this.traverse(function(e,t){e.setPickable(o.PICKTHROUGH),e.excludeFromHighlight(t,t)},!0)},preRender:function(e){this._bodyMat&&(this._currentTime+=.01,this._bodyMat.opacity=this._globalOpacity*(.4*Math.cos(this._currentTime)+.6)),this._Smart3DPaperNode&&this._Smart3DPaperNode.preRender(e)},update:function(e){var t=0;if(this.Modifiable.ExperienceBase.getManager("VCXDRMManager").GetDisplayWatermark()&&(t=1),this._globalOpacity!==t){this._globalOpacity=t;var i=this._globalOpacity>0;i&&(this._Smart3DPaperNode||this._Build()),this._Smart3DPaperNode&&this._Smart3DPaperNode.setVisibility(i)}}})}),define("DS/VCXWebDressup/VCXBackgroundNode",["DS/VCXWebDressup/VCXDressupNode","DS/Visualization/ThreeJS_DS","DS/VCXWebVisualization/VCXImageManager","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/VCXWebProperties/VCXColor"],function(e,t,i,r,o,a,n){"use strict";return e.extend({init:function(e){return this._parent(e),this._previousBackgroundDocID=null,this},dispose:function(){this._Smart3DPaperNode&&(this._Smart3DPaperNode.dispose(),this._Smart3DPaperNode=null),this._parent()},_Build:function(e){var t=this.Modifiable.ExperienceBase.getManager("VCXVisuManager");this.setRenderPasses([t.getRenderList("VCXBackground")]),this._PrimitiveGroup=new r.PrimitiveGroup;var i=new r.Buffer({component:r.VertexComponentEnum.POSITION,data:new Float32Array(12)});i.dimension=3,this._PrimitiveGroup.addBuffer(0,i);var n=new r.Buffer({component:r.VertexComponentEnum.TEX_COORD_0,data:new Float32Array(16)});n.dimension=3,this._PrimitiveGroup.addBuffer(1,n);var s,l=new r.Buffer({indexBuffer:!0,data:new Uint16Array(6)});this._PrimitiveGroup.addBuffer(2,l);var p=0;(s=i.data)[p++]=0,s[p++]=0,s[p++]=0,s[p++]=1,s[p++]=0,s[p++]=0,s[p++]=1,s[p++]=-1,s[p++]=0,s[p++]=0,s[p++]=-1,s[p++]=0;p=0;(s=n.data)[p++]=0,s[p++]=1,s[p++]=0,s[p++]=1,s[p++]=1,s[p++]=0,s[p++]=1,s[p++]=0,s[p++]=0,s[p++]=0,s[p++]=0,s[p++]=0,p=0,(s=l.data)[p++]=0,s[p++]=2,s[p++]=1,s[p++]=0,s[p++]=3,s[p++]=2;var u=new r.Primitive({nbIndices:6,connectivity:r.ConnectivityTypeEnum.TRIANGLES,fillGAS:new r.FillAttributes}),h=new r.VertexComponent({nbVertices:4,bufferId:0,indices:new r.IndexArray({bufferId:2,offset:0})}),d=new r.VertexComponent({nbVertices:4,bufferId:1,indices:new r.IndexArray({bufferId:2,offset:0})});u.addVertexComponent(h),u.addVertexComponent(d),this._PrimitiveGroup.addPrimitive(u),this._MeshNode=o.createMeshNode(this._PrimitiveGroup),this.setMaterial(),this._MeshNode.setVisibilityInTree(!1);var c={name:"BackgroundSmartNode",experience:this.ExperienceBase};this._Smart3DPaperNode=new a(c),this._Smart3DPaperNode.BillboardType=2,this._Smart3DPaperNode.SizeControlType=1,this._Smart3DPaperNode.PositioningType=1e3,this._Smart3DPaperNode.Depth=0,this._Smart3DPaperNode.add(this._MeshNode),this.add(this._Smart3DPaperNode),this.traverse(function(e,t){return e.setPickable(r.PICKTHROUGH),e.excludeFromHighlight(t,t),!1},!0)},preRender:function(e){this._Smart3DPaperNode&&this._Smart3DPaperNode.preRender(e)},setMaterial:function(e){this._bodyMat||(this._bodyMat=new t.MeshBasicMaterial({side:t.FrontSide,forceSide:!0,color:"#ffffff",opacity:this.backgroundOpacity,force:!0,depthWrite:!1}),this._MeshNode&&this._MeshNode.setMaterial(this._bodyMat)),e?(this._bodyMat.map=e,this._bodyMat.needsUpdate=!0):(this._bodyMat.map=null,this._bodyMat.needsUpdate=!0)},update:function(e){this._parent();var r=this.ExperienceBase.getManager("VCXIVManager");if(r&&r.scenario&&r.scenario.transparentBackground){var o=this.ExperienceBase.getManager("VCXVisuManager");o&&o.setTransparentBackground(!0)}else{var a=this.GetColorPropertyValue("Environment.Background"),s=this.GetColorPropertyValue("Environment.Background.Foot"),l=this.GlobalOpacity,p=this.GetPropertyValue("Environment.Background.Override"),u=this.GetPropertyValue("Environment.Background.Gradient"),h=this.GetPropertyValue("Environment.Background.Transparent"),d=this.GetPropertyValue("Environment.Background.Image");null==d&&(d=-1);l=1;if(d>=0&&p?(l=this.GlobalOpacity,a=(new n).SetRGBA(1,1,1,1),s=(new n).SetRGBA(1,1,1,1)):l=0,this.backgroundOpacity=this.GlobalOpacity,this.backgroundOpacity=a.a,this._globalOpacity!==l){this._globalOpacity=l;var c=this._globalOpacity>0;c&&(this._Smart3DPaperNode||this._Build()),this._Smart3DPaperNode&&this._Smart3DPaperNode.setVisibility(c)}if((!this._hasBeenActivated&&p||this._hasBeenActivated)&&(u!==this._previousGradient||h!==this._previousTransparent||d!==this._previousImageDocID||p!==this._previousBackgroundVisible||a&&!a.IsEqualTo(this._previousColor)||s&&!s.IsEqualTo(this._previousFootColor)||e&&e.force)){this._previousImageDocID=d,this._hasBeenActivated=!0,this._previousGradient=u,this._previousColor=a.Clone(),this._previousFootColor=s.Clone(),this._previousBackgroundVisible=p,this._previousTransparent=h;var y=a.Clone();u&&y.Lerp(s,.5);var C=this.Modifiable.ExperienceBase.getManager("VCXContextManager"),m=this;C.applyToViewers(function(e){var t=e.ambience&&e.ambience.getBackground();t&&!t._initialType&&(t._initialType=t.getType()),p?(t&&t.setActivated(!1),h?(t.setActivated(!1),e.setGrid(!1),e.setBackgroundColor("rgb(0,0,0)","0"),e._transparentBackground=!0):(e._transparentBackground&&(e.removeAmbience(),e.restoreAmbiance(),e._transparentBackground=!1),e.setBackgroundColor(y.GetHex(),m.backgroundOpacity),u&&-1===d?e.setGradientBackground([a.GetHex(),y.GetHex(),s.GetHex()]):e.setGradientBackground(null))):t&&(t.setActivated(!0),t.setType(t._initialType))})}if(!(l<=0)&&this._MeshNode){if(this._previousBackgroundDocID!==d)if(this._previousBackgroundDocID=d,-1!==d){m=this;this.ExperienceBase.getManager("VCXImageManager").GetImageFromDocID(d,i.Effect.None).then(function(e){t.ImageUtils.loadTexture(e.toDataURL(),{},function(e){m.setMaterial(e),m=null})})}else this.setMaterial();this._Smart3DPaperNode&&this._bodyMat&&(this._bodyMat.opacity=this.backgroundOpacity);var f=this.Modifiable.ExperienceBase.getManager("VCXPaperManager");if(f){var V=f.Size;this._MeshNode.setMatrix((new t.Matrix4).makeScale(V.x,V.y,1))}}}}})}),define("DS/VCXWebDressup/VCXArrowLinearNode",["DS/VCXWebDressup/VCXArrowNode","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools"],function(e,t,i){"use strict";return e.extend({init:function(e){this._parent(e)},_ComputePosBuffer:function(e,r,o,a,n){var s,l=this.GetAnchorWorldMatrix(0,e),p=(new t.Vector3).getPositionFromMatrix(l);if(this.GetPropertyValue("Arrow.Head.2.Position.Is.Paper")){var u=new t.Vector2(this.GetPropertyValue("Arrow.Head.2.Position.X"),this.GetPropertyValue("Arrow.Head.2.Position.Y")),h=0;this.GetPropertyValue("Arrow.Fixed.Length")&&(h=this.GetPropertyValue("Arrow.Length")),s=this.ExperienceBase.getManager("VCXPaperManager").GetModelPointFromModelPointAndPaperPosition(e,p,u,h)}else{var d=this.GetAnchorWorldMatrix(1,e);s=(new t.Vector3).getPositionFromMatrix(d)}var c=e.viewpoint.getEyePosition(),y=new t.Vector3(1,0,0);y.subVectors(s,p);var C,m=y.length();if(y.normalize(),!(this.Modifiable.GetProperty("Actor.Anchor.1")&&this.Modifiable.GetProperty("Actor.Anchor.1").GetPropertyValue()&&this.Modifiable.GetProperty("Actor.Anchor.1").GetPropertyValue().GetValueLink()&&this.Modifiable.GetProperty("Actor.Anchor.1").GetPropertyValue().GetValueLink().Value)||this.GetPropertyValue("Arrow.Billboarded"))C=(new t.Vector3).subVectors(c,p);else{let e=this.GetPropertyValue("Arrow.ZRotation"),t=Math.PI*e/180;C=i.getVxFromMatrix(l).applyAxisAngle(y,t)}var f=new t.Vector3(0,1,0);1===C.normalize().dot(y.normalize())||(f.crossVectors(C,y),f.normalize()),this.GetPropertyValue("Arrow.Fixed.Length")&&(m=this.GetPropertyValue("Arrow.Length"));var V=1,b=1;this.GetPropertyValue("Collab.Is.Paper")&&(V=this.ExperienceBase.getManager("VCXPaperManager").GetPaperRatio(e,p),b=this.ExperienceBase.getManager("VCXPaperManager").GetPaperRatio(e,s),V*=this.GetPropertyValue("Arrow.Scale"),b*=this.GetPropertyValue("Arrow.Scale"),this.GetPropertyValue("Arrow.Fixed.Length")&&(m*=V));var P=this.GetPropertyValue("Arrow.Width.1")*V,g=0,_=0,S=0;this.GetPropertyValue("Arrow.Head.ShowMode")&&(g=this.GetPropertyValue("Arrow.Head.Length")*V,_=this.GetPropertyValue("Arrow.Head.Size")*V,S=this.GetPropertyValue("Arrow.Head.Shape")*V);var M=this.GetPropertyValue("Arrow.Width.2")*b,G=0,D=0,x=0;this.GetPropertyValue("Arrow.Head.2.ShowMode")&&(G=this.GetPropertyValue("Arrow.Head.2.Length")*b,D=this.GetPropertyValue("Arrow.Head.2.Size")*b,x=this.GetPropertyValue("Arrow.Head.2.Shape")*b);var v=0,A=[];for(A[2*v+0]=m,A[2*v+1]=0,A[2*++v+0]=m-G,A[2*v+1]=.5*M+D,A[2*++v+0]=m-(G+x),A[2*v+1]=.5*M,A[2*++v+0]=g+S,A[2*v+1]=.5*P,A[2*++v+0]=g,A[2*v+1]=.5*P+_,A[2*++v+0]=0,A[2*v+1]=0,A[2*++v+0]=A[8],A[2*v+1]=-A[9],A[2*++v+0]=A[6],A[2*v+1]=-A[7],A[2*++v+0]=A[4],A[2*v+1]=-A[5],A[2*++v+0]=A[2],A[2*v+1]=-A[3],v++,v=0;v<this._verticesNb;v++)r[3*v+0]=p.x+A[2*v+0]*y.x+A[2*v+1]*f.x,r[3*v+1]=p.y+A[2*v+0]*y.y+A[2*v+1]*f.y,r[3*v+2]=p.z+A[2*v+0]*y.z+A[2*v+1]*f.z,a[3*v+0]=p.x+A[2*v+0]*y.x+A[2*v+1]*f.x,a[3*v+1]=p.y+A[2*v+0]*y.y+A[2*v+1]*f.y,a[3*v+2]=p.z+A[2*v+0]*y.z+A[2*v+1]*f.z;return this._fillColorBuffer(o,n),v},preRender:function(e){this._parent(e),this.viewpointVisibility&&this.allAnchorsReady&&this.GlobalOpacity?this.setVisibility(!0):this.setVisibility(!1)},update:function(){this._parent(),this._step||(this._step=this._getArrowStep()),this._updateNodePresence(),this._globalOpacity<=0||this._Node&&(this._updateArrowMaterialsParameters(),this.handleLayers())},_updateNodePresence:function(){if(!this._Node&&this.GlobalOpacity>0||this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var e=this._globalOpacity>0;e&&!this._Node&&this._Build(),this._Node&&this._Node.setVisibility(e)}},_getArrowStep:function(){return 1}})}),define("DS/VCXWebDressup/VCXArrowLinearSGNodeHolder",["DS/VCXWebDressup/VCXArrowSGNodeHolder","DS/VCXWebDressup/VCXArrowLinearNode"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Linear Arrow",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Arrow.png")}return this._parent()}})});__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebDressup/VCXCircle_Spec",["require","exports","DS/VCXWebDressup/VCXDressup_Spec"],function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{}return function(e){let t;!function(e){e[e.Empty=0]="Empty",e[e.Gradient=1]="Gradient",e[e.Plain=2]="Plain"}(t=e.EBackgroundType||(e.EBackgroundType={}))}(r||(r={})),r.prototype.getDefaultName=function(){return"Circle"},Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXCircle_Spec"}}),r.prototype.dressupGroupName="Markups",r}),define("DS/VCXWebDressup/VCXCircleModifiable",["DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXCircle_Spec","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebDressup/VCXDressupModifiable","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebSystem/VCXMathTools"],function(e,t,i,r,o,a,n,s,l,p,u,h,d,c){"use strict";return r.extend({init:function(){this._parent(),this._bIsCircle=!0},Build:function(){this._parent();var r=[{Name:"Actor.Anchor.0",Type:u,DefaultValue:(new u).SetValueFrame((new l).SetValueFromVector(new o.Vector3(0,0,0))).GetValue(),visibleInPropertyGroups:!1},{Name:"Circle.Radius",Type:s,DefaultValue:1,GroupId:"Group.Circle"},{Name:"Circle.Scale",Type:s,DefaultValue:1,GroupId:"Group.Circle"},{Name:"Circle.Thickness",Type:s,DefaultValue:20,Bounds:{Min:0,Max:100,Step:.1},GroupId:"Group.Circle",FormatPainter:!0},{Name:"Collab.Border.AlwaysVisible",Type:n,DefaultValue:!1},{Name:"Collab.3D.Paper.Billboard.Type",Type:h,DefaultValue:i.EBillboardType.Spherical,GroupId:"Group.Circle",MapChoice:this._generateMapChoiceFromEnumAndId(i.EBillboardType,"Billboard.Type",["AlongX_yInCam","AlongX_yInCamUp"]),FormatPainter:!0},{Name:"Collab.Is.Paper",Type:n,DefaultValue:!0,GroupId:"Group.Circle"},{Name:"Circle.Background.Type",Type:h,DefaultValue:t.EBackgroundType.Gradient,GroupId:"Group.Circle",MapChoice:this._generateMapChoiceFromEnumAndId(t.EBackgroundType,"Circle.BackgroundType"),FormatPainter:!0},{Name:"Collab.Background.Color",Type:p,DefaultValue:(new a).FromRGBA(.9294117647058824,.3176470588235294,.3176470588235294,.5),GroupId:"Group.Circle",FormatPainter:!0},{Name:"Collab.Background.Color.Opacity",Type:s,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.Circle",FormatPainter:!0},{Name:"Collab.Background2.Color",Type:p,DefaultValue:(new a).FromRGBA(.9294117647058824,.3176470588235294,.3176470588235294,.5),GroupId:"Group.Circle",FormatPainter:!0,visibleInPropertyGroups:!1},{Name:"Collab.Body.Line.Width",Type:s,DefaultValue:1,GroupId:"Group.CircleBorder",FormatPainter:!0},{Name:"Collab.Body.Line.Color",Type:p,DefaultValue:(new a).FromRGBA(.6431372549019608,.1686274509803922,.1568627450980392,1),GroupId:"Group.CircleBorder",FormatPainter:!0},{Name:"Collab.Body.Line.Color.Opacity",Type:s,DefaultValue:1,Bounds:{Min:0,Max:1,Step:.01},GroupId:"Group.CircleBorder",FormatPainter:!0},{Name:"Collab.Body.Line.Type",Type:h,DefaultValue:e.ELineType.Plain,GroupId:"Group.CircleBorder",MapChoice:this._generateMapChoiceFromEnumAndId(e.ELineType,"Collab.DashType",["UserDefined","Advanced"]),FormatPainter:!0},{Name:"Collab.ListAnchorsIDs",Type:d,DefaultValue:[0]}];this._BuildPropertyValues(r),this.SetPropertyInvisible("Collab.ListAnchorsIDs",!0)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Actor.Color",!0),this.GetProperty("Actor.Color").GetPropertyInfo()._bPersistent=!1,this.SetPropertyInvisible("Collab.Background.Color",0===this.GetPropertyValue("Circle.Background.Type")),this.SetPropertyInvisible("Collab.Background.Color.Opacity",0===this.GetPropertyValue("Circle.Background.Type")),this.SetPropertyInvisible("Circle.Thickness",1!==this.GetPropertyValue("Circle.Background.Type")),this.SetPropertyInvisible("Circle.Scale",!0)},GetProperty:function(e){return"Actor.Color"===e?this.GetNewProperty(e,this.GetPropertyValue("Collab.Background.Color")):this._parent(e)},RequestModification:function(e,t){if(e){var i=e.GetPropertyInfo().GetPropertyName();if("Actor.Color"===i){var r=e.GetPropertyValue().Value.getAssociatedColors();return t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Background.Color",r.body)),t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty("Collab.Body.Line.Color",r.border)),this._parent(e,t)}if("Collab.Is.Paper"===i){var o=this.ExperienceBase.getManager("VCXPaperManager"),a=[{idx:0}];a.forEach(t=>{var i=c.getOFromMatrix(this.GetAnchorWorldMatrix(t.idx)),r=o.GetPaperRatio(null,i),a=1;e.GetPropertyValue().Value?a/=r:a*=r,t.scaleToApply=a});return[{idx:0,propertyName:"Circle.Radius"}].forEach(e=>{var i=this.GetPropertyValue(e.propertyName);i*=a[e.idx].scaleToApply,t.AddOrModifyProperty(this.GetHashing(),this.GetNewProperty(e.propertyName,i))}),t.AddOrModifyProperty(this.GetHashing(),e),this._parent(e,t)}}return this._parent(e,t)}})}),define("DS/VCXWebDressup/VCXViewportNode",["DS/Visualization/Node3D","DS/VCXWebDressup/VCXDressupNode","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXForegroundNode","DS/VCXWebDressup/VCXBackgroundNode","DS/VCXWebDressup/VCXPropertiesObserver","DS/VCXWebSystem/VCXMathTools"],function(e,t,i,r,o,a,n){"use strict";return t.extend({init:function(t){return this._parent(t),this._foreground=new r(t),this.add(this._foreground),this._background=new o(t),this.add(this._background),this._viewpointNode=new e,this.add(this._viewpointNode),this.lightingModeObserver=new a,this.lightingModeObserver.add(this.Modifiable,"Render.Lighting.Override"),this.lightingModeObserver.add(this.Modifiable,"Render.Lighting.Intensity"),this.lightingModeObserver.add(this.Modifiable,"Render.Lighting.Mode"),this.lightingModeObserver.add(this.Modifiable,"Render.Lighting.Static"),this},dispose:function(){this._foreground&&(this._foreground.dispose(),this._foreground=null),this._background&&(this._background.dispose(),this._background=null),this.lightingModeObserver=null,this._parent()},preRender:function(e){this._foreground.preRender(e),this._background.preRender(e),e&&e.viewpoint&&this._viewpointNode.setMatrix(e.viewpoint.camera.matrix.clone().setPosition(new i.Vector3(0,0,0)))},update:function(e){(this._parent(),this.lightingModeObserver)&&(this.lightingModeObserver.update(),(this.lightingModeObserver.isDirty()||e&&e.force)&&(this.ExperienceBase.getManager("VCXContextManager").getExperienceIn3DPlay()?this.Modifiable.GetObject().setLightingModeForComposerPlayer(this.GetPropertyValue("Render.Lighting.Override"),this.GetPropertyValue("Render.Lighting.Mode"),this.GetPropertyValue("Render.Lighting.Intensity"),this.GetPropertyValue("Render.Lighting.Static")):this.Modifiable.GetObject().setLightingMode(this.GetPropertyValue("Render.Lighting.Override"),this.GetPropertyValue("Render.Lighting.Mode"),this.GetPropertyValue("Render.Lighting.Intensity"),this.GetPropertyValue("Render.Lighting.Static"))));this._foreground.update(e),this._background.update(e)},postUpdate:function(e){this._parent(),this.lightingModeObserver&&this.lightingModeObserver.postUpdate()},getViewpointNode:function(){return this._viewpointNode}})}),define("DS/VCXWebDressup/VCXViewportSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXViewportNode"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Viewport",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_ViewportLeaf.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCX3DAlignerNode",["DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/Visualization/ThreeJS_DS"],function(e,t,i){"use strict";return e.extend({init:function(e){return this._parent(e),this._nodeMagnetOn=null,this._nodeMagnetOff=null,this},_Build:function(e){var i={name:"HandSmartNode",modifiable:this.Modifiable};this._Smart3DPaperNode=new t(i),this._Smart3DPaperNode.SizeControlType=1,this._Smart3DPaperNode.ScalingFactor=2,this._Smart3DPaperNode.setVisibilityInTree(!1),this._Smart3DPaperNode.excludeFromCSO(!0),this._Smart3DPaperNode.excludeFromHighlight(!0,!0),this.add(this._Smart3DPaperNode);let r=this.ExperienceBase.getManager("VCXVisuManager");this._nodeMagnetOn=r.load3DXMLModel("3DAligner_MagnetON"),this._nodeMagnetOff=r.load3DXMLModel("3DAligner_MagnetOFF"),this._nodeMagnetOff&&this._Smart3DPaperNode.add(this._nodeMagnetOff),this._nodeMagnetOn&&this._Smart3DPaperNode.add(this._nodeMagnetOn),this.switchOn2Off(),this._Smart3DPaperNode.traverse(function(e){return e.excludeFromHighlight(!0,!0),!1},!0)},switchOff2On:function(){this._nodeMagnetOff&&this._nodeMagnetOff.setVisibility(!1),this._nodeMagnetOn&&this._nodeMagnetOn.setVisibility(!0)},switchOn2Off:function(){this._nodeMagnetOff&&this._nodeMagnetOff.setVisibility(!0),this._nodeMagnetOn&&this._nodeMagnetOn.setVisibility(!1)},preRender:function(e){this._globalOpacity>0&&this._Smart3DPaperNode&&this._Smart3DPaperNode.preRender(e)},update:function(e){if(this._parent(),this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var t=this._globalOpacity>0;t&&(this._Smart3DPaperNode||this._Build()),this._Smart3DPaperNode&&this._Smart3DPaperNode.setVisibility(t)}this._globalOpacity<=0||(this._Smart3DPaperNode&&this._Smart3DPaperNode.update(e),this.handleLayers())}})}),define("DS/VCXWebDressup/VCX3DAlignerSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCX3DAlignerNode"],function(e,t){"use strict";return e.extend({init:function(){},getWorldMatrix:function(e){var t=this.getAnchorReferential(),i=this.QueryInterface("VCXIModifiable");return i&&(this._actorPosition=i.GetFramePropertyValue("Actor.Position"),this._actorPosition&&t.multiply(this._actorPosition)),t},buildSGNode:function(){if(!this._sgNode){var e={name:"3DAligner",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Section.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXArrowCircularNode",["DS/VCXWebDressup/VCXArrowNode","DS/Visualization/ThreeJS_DS","DS/SceneGraphNodes/AxisSystemNode","DS/Mesh/MeshUtils","DS/Visualization/Node3D","DS/VCXWebSystem/VCXMathTools"],function(e,t,i,r,o,a){"use strict";return e.extend({init:function(e){this._parent(e)},_ComputePosBuffer:function(e,i,r,o,a){var n=this.GetAnchorWorldMatrix(0,e);if(n){var s=(new t.Vector3).getPositionFromMatrix(n),l=1;this.GetPropertyValue("Collab.Is.Paper")&&(l=this.ExperienceBase.getManager("VCXPaperManager").GetPaperRatio(e,s),l*=this.GetPropertyValue("Arrow.Scale"));var p=this.GetPropertyValue("Arrow.Width.1")*l,u=0,h=0,d=0;this.GetPropertyValue("Arrow.Head.ShowMode")&&(u=this.GetPropertyValue("Arrow.Head.Length")*l,h=this.GetPropertyValue("Arrow.Head.Size")*l,d=this.GetPropertyValue("Arrow.Head.Shape")*l);var c=this.GetPropertyValue("Arrow.Width.2")*l,y=0,C=0,m=0;this.GetPropertyValue("Arrow.Head.2.ShowMode")&&(y=this.GetPropertyValue("Arrow.Head.2.Length")*l,C=this.GetPropertyValue("Arrow.Head.2.Size")*l,m=this.GetPropertyValue("Arrow.Head.2.Shape")*l);var f=this.GetPropertyValue("Arrow.Circular.Flat");"number"!=typeof f&&(f=1);var V=this.GetPropertyValue("Arrow.Circular.Angle"),b={width1:p,head1Length:u,head1Size:h,head1Shape:d,width2:c,head2Length:y,head2Size:C,head2Shape:m,arcAngleRad:2*Math.PI*V/360,arrowRadius:this.GetPropertyValue("Arrow.Circular.Radius"),flatnessMode:f};return this._fillPosBuffer(i,o,b),this._fillColorBuffer(r,a),this._verticesNb}console.error("anchorMatrix is null or undefined for circular arrow: ",this.Modifiable.GetObject())},_addCoupleVerticesConsideredMainTransfMatrix:function(e,i,r,o,a){var n=((this._step-o)*r.width2+o*r.width1)/(2*this._step),s=new t.Vector3(-n,0,0).applyMatrix4(a),l=new t.Vector3(+n,0,0).applyMatrix4(a),p=o+2,u=3*p,h=3*(this._verticesNb-p);e[u]=s.x,e[u+1]=s.y,e[u+2]=s.z,e[h]=l.x,e[h+1]=l.y,e[h+2]=l.z,i[u]=s.x,i[u+1]=s.y,i[u+2]=s.z,i[h]=l.x,i[h+1]=l.y,i[h+2]=l.z},_addHeadPosInBuffer:function(e,i,r,o,n){var s,l,p,u,h,d=new t.Matrix4;if(1===o)s=3*(this._step+3),l=r.width1,p=r.head1Size,u=r.head1Length,h=r.head1Shape;else{if(2!==o)throw new Error("Arguments for _addHeadPosInBuffer method not valid.");s=3*(2*this._step+7),l=r.width2,p=r.head2Size,u=r.head2Length,h=r.head2Shape,d.makeRotationZ(Math.PI)}n.multiply(d);var c=new t.Vector3(-(l/2+p),h,0),y=new t.Vector3(0,u,0),C=new t.Vector3(-c.x,c.y,c.z);c.applyMatrix4(n),y.applyMatrix4(n),C.applyMatrix4(n),this._headRootNodes&&this._headRootNodes[o-1]&&this._headRootNodes[o-1].node.setMatrix(a.rotateMatrixAroundZ(n,.5*Math.PI)),e[s]=c.x,i[s]=c.x,e[++s]=c.y,i[s]=c.y,e[++s]=c.z,i[s]=c.z,s++,e[s%=3*this._verticesNb]=y.x,i[s]=y.x,e[++s]=y.y,i[s]=y.y,e[++s]=y.z,i[s]=y.z,e[++s]=C.x,i[s]=C.x,e[++s]=C.y,i[s]=C.y,e[++s]=C.z,i[s]=C.z,s++},_fillPosBuffer:function(e,i,r){var o=new t.Matrix4,n=new t.Matrix4,s=new t.Matrix4,l=new t.Matrix4,p=new t.Matrix4;0===r.flatnessMode&&o.makeRotationY(Math.PI/2),n.makeTranslation(r.arrowRadius,0,0),l.multiply(n).multiply(o),this._addHeadPosInBuffer(e,i,r,2,l.clone());for(var u=0;u<=this._step;++u)s.makeRotationZ(r.arcAngleRad*u/this._step),p.copy(s).multiply(l),u===Math.round(.5*this._step)&&this._headRootNodes&&this._headRootNodes[2]&&this._headRootNodes[2].node.setMatrix(a.rotateMatrixAroundZ(p,.5*Math.PI)),this._addCoupleVerticesConsideredMainTransfMatrix(e,i,r,u,p.clone());s.makeRotationZ(r.arcAngleRad),p.copy(s).multiply(l),this._addHeadPosInBuffer(e,i,r,1,p.clone())},preRender:function(e){this._parent(e),this.viewpointVisibility&&this.allAnchorsReady&&this.GlobalOpacity?this.setVisibility(!0):this.setVisibility(!1)},update:function(e){this._parent(),this._updateNodePositionFromAnchor(),this._step=this.GetPropertyValue("Arrow.Circular.Step"),this._updateNodePresence(),this._updateNodeBuffers(e,!1),this._globalOpacity<=0||this._Node&&(this._updateArrowMaterialsParameters(),this.handleLayers())},_Build:function(){this._parent(),this._Node&&(this._headRootNodes||(this._headRootNodes=[{id:1},{id:2},{id:3}],this._headRootNodes.forEach(function(e){e.node=new o,this._Node.add(e.node)}.bind(this))))},_updateNodePresence:function(){if(this._lastStep!==this._step&&(this.removeChild(this._Node),this._Node=null),!this._Node&&this.GlobalOpacity>0||this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var e=this._globalOpacity>0;e&&!this._Node&&(this._Build(),this._lastStep=this._step),this._Node&&this._Node.setVisibility(e)}}})}),define("DS/VCXWebDressup/VCXArrowCircularSGNodeHolder",["DS/VCXWebDressup/VCXArrowSGNodeHolder","DS/VCXWebDressup/VCXArrowCircularNode"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Circular Arrow",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_ArrowCircular.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXPartListPaperNode",["DS/VCXWebDressup/VCXSmart3DPaperNode","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebSystem/VCXMathTools"],function(e,t,i,r){"use strict";return e.extend({init:function(e){return this._parent(e),this},update:function(e){if(this._parent(e),this._ModifiableProperties){if(void 0!==this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")){if(this.PositioningType=this.GetPropertyValue("Collab.3D.Paper.Positioning.Type"),this.lastPositioningType!==this.PositioningType){var t=this.PositioningType<=i.EPositionType.Free2D,r=this.Modifiable.QueryInterface("W3AISGNodeHolder").giveSGNode();r.exludeFromBounding&&r.exludeFromBounding(t)}this.lastPositioningType=this.PositioningType}void 0!==this.GetPropertyValue("Collab.3D.Paper.Paper.Position")?this.Position2D=this.GetPropertyValue("Collab.3D.Paper.Paper.Position"):(void 0!==this.GetPropertyValue("Collab.3D.Paper.Paper.Position.X")&&(this.Position2D.x=this.GetPropertyValue("Collab.3D.Paper.Paper.Position.X")),void 0!==this.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y")&&(this.Position2D.y=this.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y")))}},_computeBOMPosition:function(){if(this.Modifiable&&this.Modifiable._bIsPartList){var e=this.Modifiable.GetPropertyValue("Collab.3D.Paper.Positioning.Type"),t=this.Modifiable.GetPropertyValue("Collab.3D.Paper.BOM.Percentage");if(e===i.EPositionType.Free2D)return;var r=this.ExperienceBase.getManager("VCXPaperManager");if(r){var o=r._PaperSize,a=r.GetMmToPxRatio();a*=.3527;var n=this.AttachedDiv.style.width,s=this.AttachedDiv.style.height,l=n.slice(0,this.AttachedDiv.style.width.indexOf("px")),p=s.slice(0,this.AttachedDiv.style.height.indexOf("px"));l*=a,p*=a;var u=r.PixelToMM(l),h=r.PixelToMM(p);if(e===i.EPositionType.Bottom||e===i.EPositionType.Top)this.Position2D.x=.5*(o.x-u),e===i.EPositionType.Bottom?this.Position2D.y=o.y-o.y*t*.01-7:this.Position2D.y=7;else if(e===i.EPositionType.Left||e===i.EPositionType.Right){this.Position2D.y=.5*(o.y-h);var d=.5*(o.x*t*.01-u);e===i.EPositionType.Left?this.Position2D.x=.5*(o.x*t*.01-u)+7:this.Position2D.x=o.x-o.x*t*.01+d-7}}}},_computeMatrix:function(e,o){var a=this.Position.clone();if(this.PositioningType<=i.EPositionType.Free2D){this._computeBOMPosition();var n=(new t.Vector3).getPositionFromMatrix(this.GetReferential(e)),s=this.ExperienceBase.getManager("VCXPaperManager").ModelToMM2(e,n),l=r.clamp(s.z,-.99,.99);(m=new t.Vector3).x=this.Position2D.x,m.y=this.Position2D.y,m.z=l,a=this.ExperienceBase.getManager("VCXPaperManager").MMToModel2(e,m)}var p=1;if(1===this.SizeControlType)p=this.ExperienceBase.getManager("VCXPaperManager").GetPaperRatio(e,a);else if(2===this.SizeControlType){var u=e.viewpoint.getEyePosition().distanceTo(a);u||(u=1);var h=.5*e.viewer.div.clientHeight*Math.abs(1/(Math.tan(Math.PI*e.viewpoint.getAngle()/360)*u));(p=0!==(h*=this.ExperienceBase.getManager("VCXPaperManager").Zoom)?1/h:1)||(p=1)}p*=this.ScalingFactor;var d=this.ExperienceBase.getManager("VCXPaperManager"),c=new t.Matrix4,y=new t.Matrix4,C=new t.Matrix4;if(C.makeScale(p,p,p),this.is2D()&&d.shouldUsePaperReferential()){var m;(m=new t.Vector3).x=this.Position2D.x,m.y=-this.Position2D.y,m.z=0,y.setPosition(m);var f=d.getPaperReferential();c.copy(f),c.multiply(y)}else{y.setPosition(a);var V=this._ComputeBillboardMatrix(e,a,this.GetReferential(e));c.multiply(y),c.multiply(V),c.multiply(C)}return o&&this.setMatrix(c),c}})}),define("DS/VCXWebDressup/VCXArrowCornerNode",["DS/VCXWebDressup/VCXArrowNode","DS/Visualization/ThreeJS_DS"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},_ComputePosBuffer:function(e,i,r,o,a){var n=this.GetAnchorWorldMatrix(0,e);if(null!=n){var s=(new t.Vector3).getPositionFromMatrix(n),l=1;this.GetPropertyValue("Collab.Is.Paper")&&(l=this.ExperienceBase.getManager("VCXPaperManager").GetPaperRatio(e,s),l*=this.GetPropertyValue("Arrow.Scale"));var p=this.GetPropertyValue("Arrow.Width.1")*l,u=0,h=0,d=0;this.GetPropertyValue("Arrow.Head.ShowMode")&&(u=this.GetPropertyValue("Arrow.Head.Length")*l,h=this.GetPropertyValue("Arrow.Head.Size")*l,d=this.GetPropertyValue("Arrow.Head.Shape")*l);var c=this.GetPropertyValue("Arrow.Width.2")*l,y=0,C=0,m=0;this.GetPropertyValue("Arrow.Head.2.ShowMode")&&(y=this.GetPropertyValue("Arrow.Head.2.Length")*l,C=this.GetPropertyValue("Arrow.Head.2.Size")*l,m=this.GetPropertyValue("Arrow.Head.2.Shape")*l);var f=this.GetPropertyValue("Arrow.Corner.Length.1")*l,V=this.GetPropertyValue("Arrow.Corner.Length.2")*l,b=p/2,P=c/2,g=[],_=0;g[2*_+0]=y,g[2*_+1]=0,g[2*++_+0]=0,g[2*_+1]=-(c/2+C),g[2*++_+0]=-m,g[2*_+1]=-c/2,g[2*++_+0]=-b,g[2*_+1]=-P,g[2*++_+0]=-p/2,g[2*_+1]=-d,g[2*++_+0]=-(p/2+h),g[2*_+1]=0,g[2*++_+0]=0,g[2*_+1]=u,g[2*++_+0]=-g[10],g[2*_+1]=g[11],g[2*++_+0]=-g[8],g[2*_+1]=g[9],g[2*++_+0]=-g[6],g[2*_+1]=-g[7],g[2*++_+0]=g[4],g[2*_+1]=-g[5],g[2*++_+0]=g[2],g[2*_+1]=-g[3],++_;var S=new t.Vector3;for(_=0;_<this._verticesNb;_++){var M=(_+2)%this._verticesNb;M<5?S.set(V,0,0):M>5&&M<11?S.set(0,f,0):S.set(0,0,0),i[3*_+0]=S.x+g[2*_+0],i[3*_+1]=S.y+g[2*_+1],i[3*_+2]=S.z,o[3*_+0]=S.x+g[2*_+0],o[3*_+1]=S.y+g[2*_+1],o[3*_+2]=S.z}return this._fillColorBuffer(r,a),this._verticesNb}console.error("anchorMatrix is null or undefined for circular arrow: ",this.Modifiable.GetObject())},preRender:function(e){this._parent(e),this.viewpointVisibility&&this.allAnchorsReady&&this.GlobalOpacity?this.setVisibility(!0):this.setVisibility(!1)},update:function(e){this._parent(),this._step||(this._step=2),this._updateNodePresence(),this._updateNodeBuffers(e,!1),this._updateNodePositionFromAnchor(),this._globalOpacity<=0||this._Node&&(this._updateArrowMaterialsParameters(),this.handleLayers())},_updateNodePresence:function(){if(!this._Node&&this.GlobalOpacity>0||this._globalOpacity!==this.GlobalOpacity){this._globalOpacity=this.GlobalOpacity;var e=this._globalOpacity>0;e&&!this._Node&&this._Build(),this._Node&&this._Node.setVisibility(e)}}})}),define("DS/VCXWebDressup/VCXArrowCornerSGNodeHolder",["DS/VCXWebDressup/VCXArrowSGNodeHolder","DS/VCXWebDressup/VCXArrowCornerNode"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Arrow Corner",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_ArrowCircular.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShapeTopAndRight",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools"],function(e,t,i){"use strict";return e.extend({rewind:function(){this._parent(),this.iSwap=0,this.iPariteX=0,this.iPariteY=0,this.fX=0,this.dx=0,this.fY=this.fHalfSizeY-this.fCellSize,this.fY<0&&(this.fY=0),this.maxfx=this.fHalfSizeX-this.fCellSize-this.fCellSize,this.LRiPariteX=0,this.LRiPariteY=0,this.LRfX=this.fHalfSizeX-this.fCellSize,this.LRfX<0&&(this.LRfX=0),this.LRdy=0,this.LRfY=0,this.LRmaxfy=this.fHalfSizeY-this.fCellSize},next:function(){if(this._parent(),this.iSwap++,1&this.iSwap){if(this.LRiPariteY++,2===this.LRiPariteY&&(this.LRiPariteY=0,this.LRfY+=this.fCellSize,this.LRfY>this.fHalfSizeY-this.fCellSize&&(0===this.LRdy?this.LRdy=.5*this.fCellSize:this.LRdy=0,this.LRfY=0,this.LRfX-=this.fCellSize,this.LRfX<this.fCellSize)))return this.rewind(),!0}else if(0==this.fX&&this.iPariteX++,this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,this.fX+=this.fCellSize,this.fX>this.maxfx&&(this.maxfx-=this.fCellSize,this.maxfx<this.fCellSize&&(this.maxfx=this.fCellSize),0===this.dx?this.dx=.5*this.fCellSize:this.dx=0,this.fX=0,this.fY-=this.fCellSize,this.fY<this.fCellSize)))return this.rewind(),!0;return!1},getPoint:function(){var e=new t.Vector2;return 1&this.iSwap?(e.x=this.fHalfSizeX+this.LRfX,1&this.LRiPariteY?e.y=this.fHalfSizeY-this.LRfY+this.LRdy:e.y=this.fHalfSizeY+this.LRfY+this.LRdy):(1&this.iPariteX?e.x=this.fHalfSizeX-this.fX+this.dx:e.x=this.fHalfSizeX+this.fX+this.dx,e.y=this.fHalfSizeY-this.fY),e}})}),define("DS/VCXWebDressup/VCXCompassNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebVisibility/VCXIVisibility"],function(e,t,i,r,o){"use strict";return r.extend({init:function(e){return this._convertFunc=null,this._currentGeomId=-1,this._nodeGeom=null,this._geomBSphereRadius=-1,this._compassMaterial=null,this._currentViewportWidth=0,this._currentViewportHeight=0,this._parent(e),this},_Build:function(){this._Node=null},setGeomConverter:function(e){this._convertFunc=e},preRender:function(e){},_showDefaultRobot:function(e){if(this.ExperienceBase.getManager("VCXContextManager").getPlayerMode()){var t=this.ExperienceBase.getManager("VCXContextManager").getMainViewer();if(t){var i=t.getRobot();i&&(e?(i.setVisibility(!1),t.setReferenceAxisSystem(!0)):(this._defaultRobotState={isConnected:i.isConnected,matrix:i.getMatrix(),visibility:!0,ratio:7},i.setVisibility(!1),t.setReferenceAxisSystem(!1)))}}},_updateCompassAspect:function(){var e=this.ExperienceBase.getManager("VCXContextManager").getMainViewer(),t=e.getRobot(),i=t._isEnabled();this._showDefaultRobot(!1);var r=0;r=!0===this.GetPropertyValue("Compass.AbsoluteSize")?this.GetPropertyValue("Compass.SizePixel"):this.GetPropertyValue("Compass.Size")*e.div.width;var o=-this.GetPropertyValue("Compass.Translation").x*e.div.width,a=+this.GetPropertyValue("Compass.Translation").y*e.div.height,n=2*this._geomBSphereRadius;e.setCustomReferenceAxisSystem(null),e.setCustomReferenceAxisSystem({node:this._nodeGeom,getPosition:function(e,t){return{x:2*((e-o-.5*r)/e)-1,y:2*((t-a-.5*r)/t)-1}},ratio:r/n}),t._setEnabled(i)},update:function(i){this._parent();var r=this.GetPropertyValue("Compass.GeomPath"),a=this.ExperienceBase.getManager("VCXContextManager").getMainViewer();if(-1===r)return a.setCustomReferenceAxisSystem(null),this._showDefaultRobot(!0),a.render(),this._currentGeomId=-1,this._nodeGeom=null,void(this._geomBSphereRadius=-1);if(this.Modifiable.QueryInterface("VCXIVisibility")._visible===o.EVisState.Visible){if(r!==this._currentGeomId&&this._convertFunc){var n=this,s=n.ExperienceBase.getManager("VCXDocManager").GetPropPath(r).GetValueURL().GetValue();this._convertFunc(s,function(i){if(r===n._currentGeomId){var o=new t;n._nodeGeom=o;var s=new t;o.addChild(s),n._compassMaterial||(n._compassMaterial=new e.MeshPhongMaterial({color:(new e.Color).setRGB(.5,.5,.5),opacity:1}),n._compassMaterial.force=!0),s.material=n._compassMaterial,i.forEach(function(e,t){s.add(e.geode)}),a.setCustomReferenceAxisSystem(o?{node:o,getPosition:function(e,t){return{x:0,y:0}},ratio:1}:null),n._geomBSphereRadius=1.1*o.bSphere.radius;var l=new e.Vector3(-o.bSphere.center.x,-o.bSphere.center.y,-o.bSphere.center.z),p=(new e.Matrix4).setPosition(l);o.setMatrix(p),s.setMatrix(n.GetPropertyValue("Compass.Alignment")),n._updateCompassAspect()}})}else this._updateCompassAspect();this._currentGeomId=r}else a.getCustomReferenceAxisSystem()&&(a.setCustomReferenceAxisSystem(null),this._showDefaultRobot(!0),a.render(),this._currentGeomId=-1,this._nodeGeom=null,this._geomBSphereRadius=-1)}})}),define("DS/VCXWebDressup/VCXCompassSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXCompassNode"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Compass",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_CompassLeaf.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXDressupManagerNode",["DS/VCXWebDressup/VCXDressupNode"],function(e){"use strict";return e.extend({init:function(e){return this._parent(e),this},setVisibility:function(e){this._parent(e);let t=this._ExperienceBase.getManager("VCXDressupManager").getDressupsOverViewerDiv();t&&(e?t.show():t.hide())}})}),define("DS/VCXWebDressup/VCXDressupManagerSGNodeHolder",["DS/WebApplicationBase/W3AASGNodeHolder","DS/Visualization/PathElement","DS/VCXWebDressup/VCXDressupManagerNode"],function(e,t,i){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Design",experience:this.GetObject()._experienceBase};this._sgNode=new i(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_DressupManagerLeaf.png")}return this.GetObject()._experienceBase.getManager("VCXContextManager").getMainViewer().addNode(this._sgNode),this._pathElement=new t,this._pathElement.setFromArray([this._sgNode]),this._sgNode},isSelfManagedPathElement:function(){return!0}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShapeBottomAndTop",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools"],function(e,t,i){"use strict";return e.extend({rewind:function(){this._parent(),this.iPariteX=0,this.iPariteY=0,this.fX=0,this.dx=0,this.fY=this.fHalfSizeY-this.fCellSize,this.fY<0&&(this.fY=0)},next:function(){return this._parent(),this.iPariteY++,2===this.iPariteY&&(this.iPariteY=0,0===this.fX&&this.iPariteX++,this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,this.fX+=this.fCellSize,this.fX>this.fHalfSizeX-this.fCellSize&&(0===this.dx?this.dx=.5*this.fCellSize:this.dx=0,this.fX=0,this.fY-=this.fCellSize,this.fY<this.fCellSize)))&&(this.rewind(),!0)},getPoint:function(){var e=new t.Vector2;return 1&this.iPariteX?e.x=this.fHalfSizeX-this.fX+this.dx:e.x=this.fHalfSizeX+this.fX+this.dx,1&this.iPariteY?e.y=this.fHalfSizeY-this.fY:e.y=this.fHalfSizeY+this.fY,e}})}),define("DS/VCXWebDressup/VCXPartListCSSNode",["DS/Core/Core","DS/Core/PointerEvents","DS/CoreEvents/Events","UWA/Core","DS/VCXWebDressup/VCXDressupNode","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXPartListPaperNode","DS/VCXWebVisu/VCXModifiablesAccess","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebDressup/VCXPropertyValueHTMLFormater","DS/VCXWebDressup/VCXPropertiesObserver","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdChangeVisibility"],function(e,t,i,r,o,a,n,s,l,p,u,h,d,c,y,C,m){"use strict";var f=o.extend({init:function(e){this._parent(e),this._BOMPaperNode=null,this._BomContent=null,this._totalBOMColmnsWidthMM=0,this._BOMAlignment=d.EPositionType.Free2D,this._BOMPercentage=0,this._trapSelection=!1,this.addCallbacks();var t=this;return this.tokens={},this.tokens.VCX_SELECTION_COMPONENTSLIST_ADD=i.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},e=>{t._updateManipulatorDisplay(e)}),this.tokens.VCX_SELECTION_COMPONENTSLIST_REMOVE=i.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},e=>{t._updateManipulatorDisplay(e)}),this.tokens.VISU=i.subscribe({event:"/VISU/"},async e=>{let t=document.getElementById("partListTableContainer");if(null!=t&&e&&e.event&&"@onClickEvent"===e.eventType&&e.trapSelection){let i=e.event._startPosition,r=e.event._lastPosition,o={x:Math.min(i.x,r.x),y:Math.min(i.y,r.y),width:Math.abs(i.x-r.x),height:Math.abs(i.y-r.y)},a=parseFloat(t.style.transform.replace(/[A-Za-z$-()]/g,"")),n={x:t.offsetLeft,y:t.offsetTop,width:t.offsetWidth*a,height:t.offsetHeight*a};if(!(o.x>n.x+n.width||o.x+o.width<n.x||o.y>n.y+n.height||o.y+o.height<n.y)){let t=this._Modifiable,i=this._ExperienceBase.getManager("VCXSelectionManager"),r=new l(i);r.AddToSelection(t.GetObject()),this._ExperienceBase.getManager("VCXCommandManager").Do(r),this._showSelection(),this._displayContextualMenu(e),this._trapSelection=!0}}}),this},_UpdateDIV:async function(e){var t=this.Modifiable.ExperienceBase;this.data={columns:[],data:[]};for(var i=t.getManager("VCXComponentPartListManager").GetColumnNumber(),r=0;r<i;r++){var o=t.getManager("VCXComponentPartListManager").GetColumnName(r).Value;(d=t.getManager("VCXComponentPartListManager").GetColumnLabel(r).Value)||(d=(d=o).slice(d.indexOf(".")+1)),"Quantity"===d?d="Quantity":"PartList.ID"===d?d="ID":"PartList.Description"===d&&(d="Description"),this.data.columns.push({text:d,dataIndex:o,width:"auto"})}for(var a in this._BomContent)if(""!==a&&this._BomContent.hasOwnProperty(a)){var n={},u=this._BomContent[a];if(u){var h=u.itemComponents[0].QueryInterface("VCXIModifiable");for(r=0;r<i;r++){var d,y;if("Actor.PartList.Description"===(d=t.getManager("VCXComponentPartListManager").GetColumnName(r).Value)){var C=t.ComponentsMap.GetComponentFromType("VCXPartListInfoComponent");C&&1===C.length&&(C[0].getDescription(a)||(d="Actor.Name"))}switch(d){case"Actor.PartList.Description":y=h.GetObject().PartListDescription;break;case"Bom.Quantity":y=u.itemComponents.length;break;case"Actor.PartList.ID":y=h.GetObject().PartListID;break;default:if(y="",h){e&&this._bomContentObserver.add(h,d);var m=h.GetProperty(d);m&&(y="VCXPropertyValueString"===m.GetPropertyValue().GetType()?s.ValuateLinkedProperties(m.GetPropertyValue().Value,t,h.GetObject().GetID(),null,p.format):p.format(m))}}n[this.data.columns[r].dataIndex]=y,0}}n["Actor.PartList.ID"]||(n["Actor.PartList.ID"]=a),this.data.data.push(n)}var f=t.getManager("VCXComponentPartListManager").GetSortOption();this.data.data.sort(function(e,t){var i=f.ascendant?1:-1,r=e[f.propertyName],o=t[f.propertyName];if(r!==o){var a=Number(r),n=Number(o);return a==r&&n==o?(a-n)*i:(r.toLowerCase&&(r=r.toLowerCase()),o.toLowerCase&&(o=o.toLowerCase()),r>o?i:-i)}return 0});var V=document.getElementById("divBom");V&&(this._removeRowsEvents(V),this._myDiv.removeChild(V)),(V=this._buildBOM(f,e))&&this._myDiv.appendChild(V);var b=document.getElementById("partListTableContainer");let P=t.getManager("VCXPaperManager");var g=this,_=this.Modifiable;b.addEventListener("click",e=>{if(e.stopImmediatePropagation(),"divBomRowHead"===e.target.id){this._showSelection();let t=new l(g.ExperienceBase.getManager("VCXSelectionManager"));t.AddToSelection(_.GetObject()),g.ExperienceBase.getManager("VCXCommandManager").Do(t),this._displayContextualMenu(e)}}),document.addEventListener("click",e=>{e.stopImmediatePropagation(),"divBomRowHead"===e.target.id||this._trapSelection||"BOM_Row"===e.target.className||"partListCorner"===e.target.className||this._hideSelection(),this._editMode&&this._disableEditMode(),this._trapSelection=!1}),b.addEventListener("mousedown",e=>{if("partListCorner"!==e.target.className&&!this._editMode&&"partListSplitManipulator"!==e.target.className){let i,r;function t(e){e.stopImmediatePropagation();const t=e.clientX-i,o=e.clientY-r;if(b.style.left=t+"px",b.style.top=o+"px",P){let e=P.PixelToMMX(parseFloat(getComputedStyle(b).left)),t=P.PixelToMMY(parseFloat(getComputedStyle(b).top)),i=_.GetProperty("Collab.3D.Paper.Paper.Position.X"),r=_.GetProperty("Collab.3D.Paper.Paper.Position.Y"),o=new c(e),a=new c(t);g._updatePropertyValues(i,o),g._updatePropertyValues(r,a)}}i=e.clientX-b.getBoundingClientRect().left,r=e.clientY-b.getBoundingClientRect().top,b.style.cursor="grabbing",g._hideContextualBar(),document.addEventListener("mousemove",t),document.addEventListener("mouseup",function e(i){let r=null;if(i.clientX&&i.clientY&&(r={x:i.clientX+45,y:i.clientY-45}),g._displayContextualMenu(r),b.style.cursor="default",P){let e=P.PixelToMMX(parseFloat(getComputedStyle(b).left)),t=P.PixelToMMY(parseFloat(getComputedStyle(b).top)),i=_.GetProperty("Collab.3D.Paper.Paper.Position.X"),r=_.GetProperty("Collab.3D.Paper.Paper.Position.Y"),o=new c(e),a=new c(t);g._updatePropertyValues(i,o),g._updatePropertyValues(r,a)}document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",e)})}});let S,M=b.querySelectorAll(".partListCorner");b.querySelectorAll(".partListSplitManipulator");if(!M.length){let e=A("partListCorner","corner-bottom-right","nwse-resize",null,"-4px","-4px",null),t=A("partListCorner","corner-top-right","nesw-resize","-4px","-4px",null,null),i=A("partListCorner","corner-top-left","nwse-resize","-4px",null,null,"-4px"),r=A("partListCorner","corner-bottom-left","nesw-resize",null,null,"-4px","-4px");b.appendChild(e),b.appendChild(r),b.appendChild(i),b.appendChild(t),M=b.querySelectorAll(".partListCorner");for(let e=0;e<M.length;e++)M[e].style.display="none"}var G;let D;function x(e){e.stopImmediatePropagation(),g.divParent.style["pointer-events"]="unset";const t=b.getBoundingClientRect().bottom,i=b.getBoundingClientRect().right,r=b.getBoundingClientRect().left,o=b.getBoundingClientRect().top,a=i-r,n=t-o;G=document.getElementById("divBomCell").clientHeight;let s,l,p,u=parseFloat(b.style.fontSize);switch(S){case"corner-top-left":if(s=(a-(e.clientX-r))/D,l=(n-(e.clientY-o+2))/D,p=G/2,s<100)break;if(p<7&&l<n/D){p=7,b.style.fontSize=`${p}px`;break}b.style.width=`${s}px`,b.style.height=`${l}px`,b.style.left=`${e.clientX}px`,b.style.top=`${e.clientY}px`,b.style.fontSize=`${p}px`;break;case"corner-top-right":if(s=(e.clientX-r)/D,l=(n-(e.clientY-o+2))/D,p=G/2,s<100)break;if(p<7&&l<n/D){p=7,b.style.fontSize=`${p}px`;break}b.style.width=`${s}px`,b.style.height=`${l}px`,b.style.top=`${e.clientY}px`,b.style.fontSize=`${p}px`;break;case"corner-bottom-left":if(s=(a-(e.clientX-r))/D,l=(e.clientY-o)/D,p=G/2,s<100)break;if(p<7&&l<n/D){p=7,b.style.fontSize=`${p}px`;break}b.style.width=`${s}px`,b.style.height=`${l}px`,b.style.left=`${e.clientX}px`,b.style.fontSize=`${p}px`;break;case"corner-bottom-right":if(s=(e.clientX-r)/D,l=(e.clientY-o)/D,p=G/2,s<100)break;if(p<7&&l<n/D){p=7,b.style.fontSize=`${p}px`;break}b.style.width=`${s}px`,b.style.height=`${l}px`,b.style.fontSize=`${p}px`;break;default:console.error("Error in resize")}g.appearance.text.font.fontSize=p,g._checkTruncation()&&u<p&&(b.style.fontSize=`${u}px`);let h=P.PixelToMMX(parseFloat(getComputedStyle(b).left)),d=P.PixelToMMY(parseFloat(getComputedStyle(b).top)),y=_.GetProperty("Collab.3D.Paper.Paper.Position.X"),C=_.GetProperty("Collab.3D.Paper.Paper.Position.Y"),m=new c(h),f=new c(d);g._updatePropertyValues(y,m),g._updatePropertyValues(C,f)}function v(e){g.divParent.style["pointer-events"]="none",document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",v);let t=.3527*parseInt(document.defaultView.getComputedStyle(b).width,10),i=.3527*parseInt(document.defaultView.getComputedStyle(b).height,10),r=_.GetProperty("Collab.Body.Width"),o=_.GetProperty("Collab.Body.Height"),a=new c(t),n=new c(i),s=P.PixelToMMX(parseFloat(getComputedStyle(b).left)),p=P.PixelToMMY(parseFloat(getComputedStyle(b).top)),u=_.GetProperty("Collab.3D.Paper.Paper.Position.X"),h=_.GetProperty("Collab.3D.Paper.Paper.Position.Y"),d=new c(s),y=new c(p),C=_.GetProperty("Collab.Text.Font"),m=parseFloat(b.style.fontSize),f=new c(m);g._updatePropertyValues(u,d),g._updatePropertyValues(h,y),g._updatePropertyValues(r,a),g._updatePropertyValues(o,n),g._updatePropertyValues(C,f,"fontHeight");let V=new l(g._ExperienceBase.getManager("VCXSelectionManager"));V.RemoveFromSelection(g._Modifiable.GetObject()),g._ExperienceBase.getManager("VCXCommandManager").Do(V)}function A(e,t,i,r,o,a,n){let s=document.createElement("div");return s.className=e,s.id=t,s.style.position="absolute",s.style.width="8px",s.style.height="8px",s.style.backgroundColor="#FFFFFF",s.style.borderRadius="50%",s.style.cursor=i,s.style.border="1px solid black",s.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.3)",s.style.top=r,s.style.right=o,s.style.bottom=a,s.style.left=n,s}M.length&&b.addEventListener("mousedown",e=>{e&&"partListCorner"===e.target.className&&e.target.id&&(document.addEventListener("mousemove",x),document.addEventListener("mouseup",v),S=e.target.id,D=parseFloat(b.style.transform.replace(/[A-Za-z$-()]/g,"")),g._hideContextualBar())}),b.addEventListener("touchstart",e=>{const i=document.getElementById("partListTableContainer");let r=e.touches[0].clientX-i.getBoundingClientRect().left,o=e.touches[0].clientY-i.getBoundingClientRect().top;function a(e){const t=e.touches[0].clientX-r,a=e.touches[0].clientY-o;i.style.left=`${t}px`,i.style.top=`${a}px`}document.addEventListener("touchmove",a),document.addEventListener("touchend",function e(){var r=t.getManager("VCXPaperManager");if(r){let e=r.PixelToMMX(parseFloat(getComputedStyle(i).left)),t=r.PixelToMMY(parseFloat(getComputedStyle(i).top)),o=_.GetProperty("Collab.3D.Paper.Paper.Position.X"),a=_.GetProperty("Collab.3D.Paper.Paper.Position.Y"),n=new c(e),s=new c(t);g._updatePropertyValues(o,n),g._updatePropertyValues(a,s)}document.removeEventListener("touchmove",a),document.removeEventListener("touchend",e)})})},_updatePropertyValues:function(e,t,i,r=this.Modifiable){var o=this.Modifiable.ExperienceBase;i?"fontHeight"===i&&e.GetPropertyValue().SetHeight(t):e.SetPropertyValue(t);var a=new C(o.getManager("VCXScenarioManager"),o.getManager("VCXCommandManager"));a.ChangeProperty(r,e),o.getManager("VCXCommandManager").Push(a)},_throttle:function(e,t){let i=!1;return(...r)=>{i||(e(...r),i=!0,setTimeout(()=>{i=!1},t))}},_showSelection:function(){let e=document.getElementById("partListTableContainer");if(!e)return;let t=e.querySelectorAll(".partListCorner"),i=e.querySelectorAll(".partListSplitManipulator");e.style.outline="2px solid #42A2DA",e.style.outlineOffset="-2px";for(let e=0;e<t.length;e++)t[e].style.display="block";for(let e=0;e<i.length;e++)i[e].style.display="block"},_hideSelection:function(){let e=document.getElementById("partListTableContainer");if(!e)return;let t=e.querySelectorAll(".partListCorner"),i=e.querySelectorAll(".partListSplitManipulator");e.style.outline="none";for(let e=0;e<t.length;e++)t[e].style.display="none";for(let e=0;e<i.length;e++)i[e].style.display="none"},_getColorPropStrToApply:function(e,t){let i=1;void 0!==this.GetPropertyValue(t)&&(i=this.GetPropertyValue(t));var r=this.GetPropertyValue(e);return`rgba(${(255*r.r).toFixed(0)},${(255*r.g).toFixed(0)},${(255*r.b).toFixed(0)},${i})`},_getTextLength:function(e,t,i){this._span||(this._span=new r.Element("span",{}),this._span.style.visibility="hidden",this._span.style.pointerEvents="none",this._span.style.whiteSpace="nowrap",this._span.style.position="absolute",this._span.style.left="-500px",this.divParent=this.Modifiable.ExperienceBase.getManager("VCXDressupManager").getDressupsOverViewerDiv(),this._span.inject(this.divParent)),this._span.style.fontFamily=t.text.font.fontFamily,this._myDiv.style.fontSize=t.text.font.fontSize+"px",this._span.style.fontSize=t.text.font.fontSize+"px";var o=0;return e.length&&(o+=12),this._span.style.fontWeight=i?"600":"normal",this._span.innerHTML=e,o+=this._span.offsetWidth},_fetchPartListTableProperties:function(){var e={text:{font:{fontFamily:"Arial",fontSize:12,currentsize:11},headerColor:"white",rowColor:0},background:{visible:!0,headerColor:"gray",oddRowColor:0,evenRowColor:0},border:{visible:!0,thickness:1,color:0},alignment:{textAlign:"start"}},t=this.GetPropertyValue("Collab.PartList.Body.ConsiderAlternateColor");this.GetPropertyValue("Collab.PartList.FilterOnVisibleCallouts");void 0!==this.GetPropertyValue("Collab.PartList.Container.Text.Color")&&(e.text.contentColor=this._getColorPropStrToApply("Collab.PartList.Container.Text.Color","Collab.PartList.Container.Text.Color.Opacity")),void 0!==this.GetPropertyValue("Collab.PartList.Header.Text.Color")&&(e.text.headerColor=this._getColorPropStrToApply("Collab.PartList.Header.Text.Color","Collab.PartList.Header.Text.Color.Opacity")),void 0!==this.GetPropertyValue("Collab.PartList.Header.Background.Color")&&(e.background.headerColor=this._getColorPropStrToApply("Collab.PartList.Header.Background.Color","Collab.PartList.Header.Background.Color.Opacity")),void 0!==this.GetPropertyValue("Collab.PartList.Body.Row.Color")&&(e.background.oddRowColor=this._getColorPropStrToApply("Collab.PartList.Body.Row.Color","Collab.PartList.Body.Row.Color.Opacity")),void 0!==this.GetPropertyValue("Collab.PartList.Body.SecondRow.Color")&&(e.background.evenRowColor=t?this._getColorPropStrToApply("Collab.PartList.Body.SecondRow.Color","Collab.PartList.Body.SecondRow.Color.Opacity"):this._getColorPropStrToApply("Collab.PartList.Body.Row.Color","Collab.PartList.Body.Row.Color.Opacity")),this.GetFontPropertyValue("Collab.Text.Font")&&(e.text.font.fontFamily=this.GetFontPropertyValue("Collab.Text.Font").Family,e.text.font.fontSize=this.GetFontPropertyValue("Collab.Text.Font").Height),this.GetPropertyValue("Collab.PartList.Scenario.Fontsize")&&(e.text.font.currentsize=this.GetPropertyValue("Collab.PartList.Scenario.Fontsize"));let i=this.GetPropertyValue("Collab.Text.HAlignment");return i===d.EHTextAlignment.Right?e.alignment="end":i===d.EHTextAlignment.Centered?e.alignment="center":i===d.EHTextAlignment.Justified?e.alignment="justify":e.alignment="start",e},_buildBOM:function(e,t){let i=document.getElementById("partListTableContainer");var r=null,o=!0;let a=this._fetchPartListTableProperties();this.appearance=a;var n=null;for(a.text.font.fontSize<7&&(a.text.font.fontSize=7);o;){if(r&&this._removeRowsEvents(r),r=this._buildFlexBOM(a),i){let e=document.getElementById("divBom");e&&i.removeChild(e)}i.appendChild(r);n=this._analyzeBOM(r);var s=this._addBorderTop(n);n=this._analyzeBOM(r),this._addHeader(n,r,a,e),n=this._analyzeBOM(r),this._removeBorderTop(s),this._addBorderTop(n);var l=this._calcColumnProportion(n,a);if(this._applyColumnProportion(n,l),this._calcSizeInPixel(),i.style.width=this.Size.x+"px",i.style.height=this.Size.y+"px",t){let e=document.querySelectorAll(".BOM_Row");for(let t=0;t<e.length;t++)e[t].style.height="auto";i.style.height="fit-content";for(let t=0;t<e.length;t++)e[t].style.height="100%"}let C=document.querySelectorAll(".BOM");if(o=!1,C.length)for(let e=0;e<C.length;e++)for(var p=C[e].children,u=0;u<p.length;u++)for(var h=p[u].children,d=0;d<h.length;d++)for(var c=h[d],y=this._getTextLength(c.textContent,a,!1);c.clientWidth<y;)i.style.width=parseFloat(i.style.width)+10+"px",y=this._getTextLength(c.textContent,a,!1);i.removeChild(r);break}return n&&n.length,r&&(r.style.justifyContent="flex-start"),i.style.alignItems="flex-start",i.style.visibility="visible",r},_checkTruncation:function(){let e=document.querySelectorAll(".BOM");for(let s=0;s<e.length;s++)for(var t=e[s].children,i=0;i<t.length;i++)for(var r=t[i].children,o=0;o<r.length;o++){var a=r[o],n=this._getTextLength(a.textContent,this.appearance,!1);if(a.clientWidth<n)return!0}return!1},_analyzeBOM:function(e){var t,i=[],r=[],o=e.children,a=0,n=null,s=0;for(t=0;t<o.length;t++){var l=o[t],p=l.offsetLeft;n?p===s?(r.push(l),0):(i[a]=r,1,(r=[]).push(l),a++):(0,r.push(l)),n=l,s=p}return i[a]=r,i},_removeBorderTop:function(e){for(var t=0;t<e.length;t++){e[t].style.borderTop=""}},_addBorderTop:function(e){for(var t=[],i=0;i<e.length;i++)for(var r=e[i],o=0;o<r.length;o++){var a=r[o];0===o&&(a.style.borderTop="1px solid #F1F1F1",t.push(a))}return t},_addHeader:function(e,t,i,r){if(e.length>1)for(var o=0,a=1;a<e.length;a++){for(var n=e[a][0],s=0;s<o;s++)n=n.previousSibling;var l=this.createHeader(i,r);t.insertBefore(l,n),o++}},_calcColumnProportion:function(e,t){var i=[];this._totalBOMColmnsWidthMM=0;for(var r=0;r<e.length;r++){for(var o=[],a=e[r],n=a.length,s=0;s<n;s++)for(var l=a[s].children,p=0;p<l.length;p++){var u=l[p],h=this._getTextLength(u.textContent,t,!1);o[p]?o[p]=Math.max(o[p],h):o[p]=h}var d=o.length,c=0;for(p=0;p<d;p++)c+=o[p];for(p=0;p<d;p++){var y=100*o[p]/c;o[p]=y.toFixed(2)}if(c>0&&t){var C=.3527*c,m=C*(t.text.font.fontSize/100);this._totalBOMColmnsWidthMM+=C+m}i[r]=o}return i},_applyColumnProportion:function(e,t){e[0][1]&&"divBomEmptyRow"===e[0][1].id&&(t[0][0]="10",t[0][1]="70",t[0][2]="20");for(var i=0;i<e.length;i++)for(var r=t[i],o=e[i],a=o.length,n=0;n<a;n++){var s=o[n],l=s.children;if("divBomEmptyRow"===s.id){l[0].style.flexBasis="100%"}else for(var p=0;p<l.length;p++){l[p].style.flexBasis=r[p]+"%"}}},_createHeaderCell:function(e){var t=this._createCell(e);return t.style.color=e.text.headerColor,t.style.borderColor=e.border.color,t.style.backgroundColor=e.background.headerColor,t},_fillHeaderCell:function(e,t){var i=this.data.columns[t].text;this._setContent(e,i)},_fillEmptyCell:function(e){let t;t="There is no part with the part list option activated",this._setContent(e,"There is no part with the part list option activated")},_createCell:function(e){var t=new r.Element("div",{id:"divBomCell",class:"BOM_Cell"});return t.style.fontFamily=e.text.font.fontFamily,t.style.justifyContent=e.alignment,t},_fillCell:function(e,t,i){var r;r=this.data.data[t][this.data.columns[i].dataIndex],this._setContent(e,r)},_fillEmptyCell:function(e){let t;t="There is no part with the part list option activated",this._setContent(e,"There is no part with the part list option activated")},_setContent:function(e,t){var i=new r.Element("span",{});i.innerHTML=t,i.inject(e)},_getDescriptionColId:function(){for(var e=1,t=0;t<this.data.columns.length;t++){if("Bom.Description"===this.data.columns[t].dataIndex){e=t;break}}return e},createHeader:function(e){for(var t=new r.Element("div",{id:"divBomRowHead",class:"BOM_Row"}),i=0;i<this.data.columns.length;i++){var o=this._createHeaderCell(e);this._fillHeaderCell(o,i),o.inject(t)}return t},_buildFlexBOM:function(t,i){var o=new r.Element("div",{id:"divBom",class:"BOM"});if(this.createHeader(t,i).inject(o),this.data.data.length)for(var a=0;a<this.data.data.length;a++){var n=this._BomContent[this.data.data[a]["Actor.PartList.ID"]];n||(n=this._BomContent[a+1]),(l=new r.Element("div",{id:"divBomRow"+this.data.data[a]["Actor.PartList.ID"],class:"BOM_Row"})).inject(o),l._bomLine=n,n._tr=l,e.Selection.CSOManager.isIn({pathElement:n.itemComponents[0].QueryInterface("W3AISGNodeHolder").getPathElement()})&&l.classList.add("selected"),u=a%2==0?t.background.oddRowColor:t.background.evenRowColor,l.style.backgroundColor=u;for(var s=0;s<this.data.columns.length;s++){(p=this._createCell(t)).style.color=t.text.contentColor,p.classList.add(this.data.columns[s].text),this._fillCell(p,a,s),p.inject(l)}this._addRowEvents(l)}else{var l;(l=new r.Element("div",{id:"divBomEmptyRow",class:"BOM_Row"})).inject(o);var p,u=t.background.oddRowColor;l.style.backgroundColor=u,l.style.borderColor=u,(p=this._createCell(t)).style.color="rgb(193,198,201)",p.style.borderColor=u,p.style.fontStyle="italic",this._fillEmptyCell(p),p.inject(l)}return o},_addRowEvents:function(e){e.addEventListener("mouseenter",f.rowMouseEnter,!1),e.addEventListener("mouseleave",f.rowMouseLeave,!1),e._experienceBase=this.Modifiable.ExperienceBase,e._this=this,e.addEventListener(t.POINTERUP,f.rowPointerEventUp,!1)},_removeRowEvents:function(e){e.removeEventListener("mouseenter",f.rowMouseEnter),e.removeEventListener("mouseleave",f.rowMouseLeave),e.removeEventListener(t.POINTERUP,f.rowPointerEventUp),e._experienceBase=null},_removeRowsEvents:function(e){var t,i=e.children;for(t=1;t<i.length;t++){var r=i[t];this._removeRowEvents(r)}},_calcSizeInPixel:function(){this.Size=new a.Vector2,this.Size.x=this.GetPropertyValue("Collab.Body.Width"),this.Size.y=this.GetPropertyValue("Collab.Body.Height");this.Size.x/=.3527,this.Size.y/=.3527},dispose:function(){this._BOMPaperNode&&(this._BOMPaperNode.dispose(),this._BOMPaperNode=null),delete this._bomContentObserver,this._parent()},_Build:function(){var e={name:"BOMSmartNode",modifiable:this.Modifiable,type:this._type};this._BOMPaperNode=new n(e),this._BOMPaperNode.setVisibilityInTree(!1),this.add(this._BOMPaperNode),this._myDiv||(this._myDiv=new r.Element("div",{class:"CSSTableGenerator",id:"partListTableContainer"}),this._myDiv.style.position="absolute",this._myDiv.style["pointer-events"]="all",this.divParent=this.Modifiable.ExperienceBase.getManager("VCXDressupManager").getDressupsOverViewerDiv(),this._myDiv.inject(this.divParent)),this._bomContentObserver=new u,this._bomContentObserver.add(this.Modifiable,"Collab.PartList.Header.Background.Color"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.Header.Background.Color.Opacity"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.Container.Text.Color.Opacity"),this._bomContentObserver.add(this.Modifiable,"CCollab.PartList.Container.Text.Color"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.Header.Text.Color"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.Header.Text.Color.Opacity"),this._bomContentObserver.add(this.Modifiable,"Collab.Text.Font"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.Body.Row.Color"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.Body.Row.Color.Opacity"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.Body.ConsiderAlternateColor"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.Body.SecondRow.Color"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.Body.SecondRow.Color.Opacity"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.Container.Text.Color"),this._bomContentObserver.add(this.Modifiable,"Collab.PartList.Container.Text.Color.Opacity"),this._bomContentObserver.add(this.Modifiable,"Collab.Border.Line.Color"),this._bomContentObserver.add(this.Modifiable,"Collab.Border.Line.Color.Opacity"),this._bomContentObserver.add(this.Modifiable,"Collab.Text.HAlignment"),this._bomContentObserver.add(this.Modifiable,"Collab.Body.Width"),this._bomContentObserver.add(this.Modifiable,"Collab.Body.Height"),addEventListener("keydown",this._onKeydownEvent),addEventListener("keyup",this._onKeyupEvent),this._BOMPaperNode.AttachedDiv=this._myDiv},removeDiv:function(){this._myDiv&&(this.divParent=this.Modifiable.ExperienceBase.getManager("VCXDressupManager").getDressupsOverViewerDiv(),this.divParent.removeChild(this._myDiv)),removeEventListener("keydown",this._onKeydownEvent),removeEventListener("keyup",this._onKeyupEvent),delete this._bomContentObserver;for(let e in this.tokens)i.unsubscribe(this.tokens[e]);this.tokens={}},preRender:function(e){this._BOMPaperNode&&this._BOMPaperNode.preRender(e)},addOrRemoveObjectToFromPSO:function(t,i){if(this._BomContent){var r=s.GetModifiableFromPathElement(t,this.ExperienceBase);if(r){var o;if(r._bIsCallout&&r.GetComputedStringProperty)o=r.GetComputedStringProperty("Collab.Text");else{var a=r.GetProperty("Actor.PartList.ID");a&&(o=a.GetPropertyValue().Value)}if(o){var n=this._BomContent[o];if(n&&n.itemComponents){var l=0;for(l=0;l<n.itemComponents.length;l++){var p={pathElement:n.itemComponents[l].QueryInterface("W3AISGNodeHolder").getPathElement()},u=e.Selection.PSOManager;i?u.add(p):u.remove(p)}n._tr&&(i?n._tr.classList.add("hover"):n._tr.classList.remove("hover"))}}}}},addOrRemoveObjectToFromCSO:function(t,i){if(this._BomContent&&t&&this.GlobalOpacity){var r=s.GetModifiableFromPathElement(t,this.ExperienceBase);if(r){var o,a=r.GetProperty("Actor.PartList.ID");if(a&&(o=a.GetPropertyValue().Value),o){var n=this._BomContent[o];if(n){var l;if(l=n._bIsSelectedInTable,n._bIsSelectedInTable=!1,i){if(n.itemComponents){var p=0;if(l)for(p=0;p<n.itemComponents.length;p++){var u={pathElement:n.itemComponents[p].QueryInterface("W3AISGNodeHolder").getPathElement()};e.Selection.CSOManager.add(u)}else{u={pathElement:t};e.Selection.CSOManager.add(u)}n._tr&&n._tr.classList.add("selected")}}else n._tr&&n._tr.classList.remove("selected")}}}}},addToPSO:function(e){this.addOrRemoveObjectToFromPSO(e,!0)},removeFromPSO:function(e){this.addOrRemoveObjectToFromPSO(e,!1)},emptyPSO:function(){for(var e in this._BomContent)""!==e&&this._BomContent.hasOwnProperty(e)&&this._BomContent[e]._tr&&this._BomContent[e]._tr.classList.contains("hover")&&this._BomContent[e]._tr.classList.remove("hover")},addToCSO:function(e){this.addOrRemoveObjectToFromCSO(e,!0)},removeFromCSO:function(e){this.addOrRemoveObjectToFromCSO(e,!1)},emptyCSO:function(){for(var e in this._BomContent)""!==e&&this._BomContent.hasOwnProperty(e)&&this._BomContent[e]._tr&&this._BomContent[e]._tr.classList.contains("selected")&&this._BomContent[e]._tr.classList.remove("selected")},postUpdate:function(){this._parent(),this._bomContentObserver&&this._bomContentObserver.postUpdate(),this.addCallbacks()},checkPartListVisibility:function(){if(this.ExperienceBase.getManager("VCXComponentPartListManager")){let i=this.ExperienceBase.getManager("VCXComponentPartListManager").turnOnPartListVisibility;if(i&&(this.Modifiable.GetObject()._experienceBase.getManager("VCXComponentPartListManager").turnOnPartListVisibility=!1),i&&!this.GlobalOpacity)if(this.Modifiable.GetObject().QueryInterface("VCXIVisibility")){var e=new m(this.ExperienceBase.getManager("VCXScenarioManager"),this.ExperienceBase.ComponentsMap,this.ExperienceBase.getManager("VCXCommandManager"));if(e.ChangeVisibility([this.Modifiable.GetObject()],h.EVisState.Visible),this.ExperienceBase.getManager("VCXCommandManager").Push(e),this.Modifiable){var t=new c;t.SetValue(1),this.Modifiable.OnChangeProperty("Actor.Visibility.Opacity",t),this.Modifiable.OnChangePropertiesEnd()}}}},update:function(e){if(this.checkPartListVisibility(),this._parent(),(this.needToRebuildDiv||this.ExperienceBase.getManager("VCXComponentPartListManager"))&&(this.needToRebuildDiv=this.ExperienceBase.getManager("VCXComponentPartListManager").ListHasChanged),this.Modifiable&&this.Modifiable._bIsPartList){var t=this.Modifiable.GetPropertyValue("Collab.3D.Paper.Positioning.Type"),i=this.Modifiable.GetPropertyValue("Collab.3D.Paper.BOM.Percentage");t===this._BOMAlignment&&i===this._BOMPercentage||(this.needToRebuildDiv=!0,this._BOMAlignment=t,this._BOMPercentage=i)}var r=!1,o=this.GlobalOpacity;if(this.Modifiable&&this.Modifiable.GetObject()){var a=this.Modifiable.GetObject().QueryInterface("VCXIVisibility");a&&a.GetVisibility()===h.EVisState.Hidden&&(o=0)}o&&(this.needToRebuildDiv?this.Modifiable.ExperienceBase.getManager("VCXComponentPartListManager")&&this.Modifiable.ExperienceBase.getManager("VCXComponentPartListManager").GetBOMContent&&(this._BomContent=this.Modifiable.ExperienceBase.getManager("VCXComponentPartListManager").GetBOMContent(this.Modifiable.GetPropertyValue("Collab.PartList.FilterOnVisibleCallouts"))):this._bomContentObserver&&(this._bomContentObserver.update(),r=this._bomContentObserver.isDirty()));if(this._BomContent&&this._BomContent.length&&!0,this._globalOpacity!==o){if(this._globalOpacity=o,this._globalOpacity<=0)return this._myDiv&&(this._myDiv.parentNode.removeChild(this._myDiv),this._myDiv=null),this._BOMPaperNode&&(this.remove(this._BOMPaperNode),this._BOMPaperNode=null),void(this._currentText=null);this._BOMPaperNode||(this._Build(),this.needToRebuildDiv=!0),this._myDiv&&this._myDiv.style.opacity!==this._globalOpacity&&(this._myDiv.style.opacity=this._globalOpacity)}this._BOMPaperNode&&(this._BOMPaperNode.update(e),(this.needToRebuildDiv||r)&&(this._UpdateDIV(this.needToRebuildDiv),this.needToRebuildDiv&&(this.needToRebuildDiv=!1)),this.handleLayers())},_hideContextualBar:function(e){this.Modifiable.ExperienceBase.getManager("VCXContextualContentManager").contextualShortcutToolbarCtrl.isContextualBarDisplayed()&&this.Modifiable.ExperienceBase.getManager("VCXContextualContentManager").contextualShortcutToolbarCtrl.hideContextualBar()},_displayContextualMenu:function(e){let t=null;e&&e.clientX&&e.clientY&&(t={x:e.clientX,y:e.clientY},this.Modifiable.ExperienceBase.getManager("VCXContextualContentManager").contextualShortcutToolbarCtrl.displayContextualBar(t))},onKeydownEvent:function(e){17===e.keyCode&&(this._keyState=1)},onKeyupEvent:function(e){17===e.keyCode&&(this._keyState=0)},addCallbacks:function(){var e=this;this._onKeydownEvent=function(t){e.onKeydownEvent(t)},this._onKeyupEvent=function(t){e.onKeyupEvent(t)}},_enableEditMode:function(e,t){this._editMode=!0;let i=e.getChildren();if(!e.getAttribute("contenteditable")){self._editMode=!0,e.setAttribute("contenteditable","true"),e.setAttribute("spellcheck","false");for(let r=0;r<i.length;r++)i[r].classList.contains("Quantity")?i[r].setAttribute("contenteditable","false"):t.x>=i[r].getBoundingClientRect().left&&t.x<=i[r].getBoundingClientRect().right&&t.y>=i[r].getBoundingClientRect().top&&t.y<=i[r].getBoundingClientRect().bottom&&e.addEventListener("onClick",this.selectText(i[r]))}},selectText:function(e){if(document.selection)(t=document.body.createTextRange()).moveToElementText(e),t.select();else if(window.getSelection){var t;(t=document.createRange()).selectNode(e),window.getSelection().removeAllRanges(),window.getSelection().addRange(t)}},_disableEditMode:function(){this._editMode=!1;let e=document.querySelectorAll(".BOM_Row");for(let t=0;t<e.length;t++)if(e[t].getAttribute("contenteditable")){let i,r,o=e[t]._bomLine.itemComponents[0].QueryInterface("VCXIModifiable"),a=o.GetProperty("Actor.PartList.ID"),n=o.GetProperty("Actor.PartList.Description");e[t].removeAttribute("contenteditable"),e[t].removeAttribute("spellcheck"),e[t].removeAttribute("onclick");let s=e[t].getChildren();for(let e=0;e<s.length;e++)s[e].classList.contains("Quantity")&&s[e].removeAttribute("contenteditable"),s[e].classList.contains("Description")&&(r=new y(s[e].innerText)),s[e].classList.contains("ID")&&(i=new y(s[e].innerText));this._updatePropertyValues(a,i,null,o),this._updatePropertyValues(n,r,null,o)}this._UpdateDIV(!1)},_updateManipulatorDisplay:function(e){if(!e||!e[0]||!e[0]._experienceBase)return;let t=e[0]._experienceBase.getManager("VCXSelectionManager"),i=t?t.GetComponentsFromCurrentSelection("VCXPartList_Spec"):null;document.getElementById("partListTableContainer")&&(i&&1===i.length?this._showSelection():this._hideSelection())}});return f.rowMouseEnter=function(t){t.stopPropagation(),t.stopImmediatePropagation();var i=t.currentTarget,r=e.Selection.PSOManager;if(i._bomLine.itemComponents)for(var o=0;o<i._bomLine.itemComponents.length;o++){var a={pathElement:i._bomLine.itemComponents[o].QueryInterface("W3AISGNodeHolder").getPathElement()};r.add(a)}if(i._bomLine.calloutComponents)for(o=0;o<i._bomLine.calloutComponents.length;o++){a={pathElement:i._bomLine.calloutComponents[o].QueryInterface("W3AISGNodeHolder").getPathElement()};r.add(a)}},f.rowMouseLeave=function(t){t.stopPropagation(),t.stopImmediatePropagation(),e.Selection.PSOManager.empty()},f.rowPointerEventUp=function(t){let i=t.currentTarget;if(i._bomLine.itemComponents){let r=!0,o=i._experienceBase,a=o.getManager("VCXSelectionManager"),n=a.GetComponentsFromCurrentSelection("VCXPartList_Spec");n&&1===n.length&&(r=!1);let s=a.GetComponentsFromSelection("CSO");for(let e=0;e<s.length&&r;e++){let t=s[e];t&&t.PartListEnabled&&(r=!1)}let p=i._this,u=p.Modifiable,h=new l(a);if(p._editMode&&!i.getAttribute("contenteditable")&&p._disableEditMode(),0===p._keyState&&h.RemoveComponentsFromSelection(s),r)h.AddToSelection(u.GetObject());else{h.RemoveFromSelection(u.GetObject()),i._bomLine._bIsSelectedInTable=!0;let r=!1;for(let t=0;t<i._bomLine.itemComponents.length&&!r;t++)e.Selection.CSOManager.isIn({pathElement:i._bomLine.itemComponents[t].QueryInterface("W3AISGNodeHolder").getPathElement()})&&(r=!0);for(let e=0;e<i._bomLine.itemComponents.length;e++)r?p._enableEditMode(i,t):h.AddToSelection(i._bomLine.itemComponents[e])}o.getManager("VCXCommandManager").Do(h),i._this._displayContextualMenu(t)}},f}),define("DS/VCXWebDressup/VCXPartListSGNodeHolder",["DS/CoreEvents/Events","DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXPartListCSSNode"],function(e,t,i){"use strict";return t.extend({init:function(){},buildSGNode:function(){if(void 0===this._sgNode){var t={name:"PartList",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new i(t)}var r=this._sgNode;return this.event_VCX_PREHIGHLIGHT_EMPTY=e.subscribe({event:"VCX_PREHIGHLIGHT_EMPTY"},function(e){r.emptyPSO()}),this.event_VCX_PREHIGHLIGHT_REMOVE=e.subscribe({event:"VCX_PREHIGHLIGHT_REMOVE"},function(e){if(Array.isArray(e))for(var t=0;t<e.length;++t)r.removeFromPSO(e[t].pathElement);else e.pathElement?r.removeFromPSO(e.pathElement):console.warn("Data given by SelectionManager for removes have changed..")}),this.event_VCX_PREHIGHLIGHT_ADD=e.subscribe({event:"VCX_PREHIGHLIGHT_ADD"},function(e){if(Array.isArray(e))for(var t=0;t<e.length;++t)r.addToPSO(e[t].pathElement);else console.warn("Data given by SelectionManager for adds have changed..")}),this.event_VCX_SELECTION_EMPTY=e.subscribe({event:"VCX_SELECTION_EMPTY"},function(e){r.emptyCSO()}),this.event_VCX_SELECTION_COMPONENTSLIST_REMOVE=e.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},function(e){if(Array.isArray(e))for(var t=0;t<e.length;++t){var i=e[t];if(i){var o=i.QueryInterface("W3AISGNodeHolder");o&&r.removeFromCSO(o.getPathElement())}}else console.log("Problem: Something changed with the VCX_SELECTION_COMPONENTSLIST_REMOVE event...")}),this.event_VCX_SELECTION_COMPONENTSLIST_ADD=e.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},function(e){if(Array.isArray(e))for(var t=0;t<e.length;++t){var i=e[t];if(i){var o=i.QueryInterface("W3AISGNodeHolder");if(o){var a=o.getPathElement();a&&r.addToCSO(a)}}}else console.log("Problem: Something changed with the VCX_SELECTION_COMPONENTSLIST_ADD event...")}),this._parent()},Dispose:function(){this.event_VCX_PREHIGHLIGHT_EMPTY&&(e.unsubscribe(this.event_VCX_PREHIGHLIGHT_EMPTY),delete this.event_VCX_PREHIGHLIGHT_EMPTY),this.event_VCX_PREHIGHLIGHT_REMOVE&&(e.unsubscribe(this.event_VCX_PREHIGHLIGHT_REMOVE),delete this.event_VCX_PREHIGHLIGHT_REMOVE),this.event_VCX_PREHIGHLIGHT_ADD&&(e.unsubscribe(this.event_VCX_PREHIGHLIGHT_ADD),delete this.event_VCX_PREHIGHLIGHT_ADD),this.event_VCX_SELECTION_EMPTY&&(e.unsubscribe(this.event_VCX_SELECTION_EMPTY),delete this.event_VCX_SELECTION_EMPTY),this.event_VCX_SELECTION_REMOVE&&(e.unsubscribe(this.event_VCX_SELECTION_REMOVE),delete this.event_VCX_SELECTION_REMOVE),this.event_VCX_SELECTION_COMPONENTSLIST_REMOVE&&(e.unsubscribe(this.event_VCX_SELECTION_COMPONENTSLIST_REMOVE),delete this.event_VCX_SELECTION_COMPONENTSLIST_REMOVE),this.event_VCX_SELECTION_COMPONENTSLIST_ADD&&(e.unsubscribe(this.event_VCX_SELECTION_COMPONENTSLIST_ADD),delete this.event_VCX_SELECTION_COMPONENTSLIST_ADD),this._sgNode&&(this._sgNode.removeDiv(),delete this._sgNode),this._parent()}})}),define("DS/VCXWebDressup/VCX3DGridNode",["DS/VCXWebDressup/VCXDressupNode","DS/VCXWebSystem/VCXGridHelper","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/Visualization/Node3D","DS/VCXWebSystem/VCXMathTools","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValuePoint","DS/Visualization/SceneGraphUtils","DS/CoreEvents/Events","DS/WebappsUtils/WebappsUtils","DS/SceneGraphNodes/BillBoardNode3D"],function(e,t,i,r,o,a,n,s,l,p,u,h,d,c,y){"use strict";return e.extend({init:function(e){return this.CellSize=1,this.GridStep=-1,this.TextureName="grid512_new",this.GridUnit=1,this.GridBigUnit=1,this.width=0,this.height=0,this._active=!0,this.addZoomLevel=null,this._bodyMat=new i.MeshBasicMaterial({side:i.DoubleSide,opacity:1,force:!0}),this.textureMaterials={},this.textures={},this._bodyMat.line=new i.LineBasicMaterial({side:i.DoubleSide,opacity:1,force:!0,polygonBorderMode:!0,lineWidth:2}),this._bodyMat.line2=new i.LineBasicMaterial({side:i.DoubleSide,opacity:.5,force:!0,polygonBorderMode:!0,lineWidth:.3}),this._parent(e),this},_ComputeGridCellSize:function(e){let t=Math.floor(e/40);this.CellSize=t,0===this.CellSize&&(this.CellSize=1),this.GridStep=5*this.CellSize,this.GridUnit=this.GridStep,this.previousGridUnit=this.GridUnit},GetNodeDimensionsLimit:function(){return{XMin:this.XGridListHelper.head,XMax:this.XGridListHelper.tail,YMin:this.YGridListHelper.head,YMax:this.YGridListHelper.tail}},_UpdateTextureTiling:function(e){let t={TopLeft:{height:Math.abs(this.YGridListHelper.tail),width:Math.abs(this.XGridListHelper.head)},TopRight:{height:Math.abs(this.YGridListHelper.tail),width:Math.abs(this.XGridListHelper.tail)},BottomRight:{height:Math.abs(this.YGridListHelper.head),width:Math.abs(this.XGridListHelper.tail)},BottomLeft:{height:Math.abs(this.YGridListHelper.head),width:Math.abs(this.XGridListHelper.head)}};this.GridBigUnit=this.GridStep/e,this.GridUnit=this.CellSize/e,this.previousGridUnit!==this.GridUnit&&(this.previousGridUnit=this.GridUnit),this.XGridListHelper&&(this.XGridListHelper.step=this.GridUnit),this.YGridListHelper&&(this.YGridListHelper.step=this.GridUnit);for(let i in t)t.hasOwnProperty(i)&&this._UpdateTextureTilingForEachSide(i,t[i].width,t[i].height,e)},_UpdateTextureTilingForEachSide:function(e,t,i,r){let o=r*t/this.GridStep,a=r*i/this.GridStep;this.textures.hasOwnProperty(e)&&this.textureMaterials.hasOwnProperty(e)&&(this.textures[e].repeat.set(o,a),this.textureMaterials[e].updatePDSFXUniform("gridTexture",this.textures[e]))},GetGridUnit:function(){return this.GridUnit.toFixed(3)},GetGridSizeAllLines:function(){return this.XGridListHelper&&this.YGridListHelper?this.XGridListHelper.getSize()*this.YGridListHelper.getSize():0},ComputeGridUnit:function(e,t){if(!e.position||!e.camera)return;const r=this.GetWorldGridNodeCorners();let o=(new i.Vector3).subVectors(r.TopRight,r.TopLeft),a=(new i.Vector3).subVectors(r.TopLeft,r.BottomLeft),n=(new i.Vector3).crossVectors(o,a).normalize(),s=(new i.Vector3).getPositionFromMatrix(this.getMatrixWorld()),l=(new i.Vector3).subVectors(e.position,s),p=Math.abs(l.dot(n)),u=1;e.camera instanceof i.PerspectiveCamera&&(u=100*Math.tan(Math.PI*e.getAngle()/360)*p/t._getDivClientHeight()),e.camera instanceof i.OrthographicCamera&&(u=50*(e.camera.top-e.camera.bottom)/t._getDivClientHeight());let h=u/this.CellSize,d=1,c=Math.floor(Math.log2(h));d=h<1?Math.pow(c,2):1/Math.pow(2,c),this._UpdateTextureTiling(d)},SetCoordinatesLinesSnapping:function(){this.tokenCoordinatesLines=d.subscribe({event:"/3DGrid/CoordinatesLines"},e=>{if(!e.gridObject)return;if(!e.hasOwnProperty("x")||!e.hasOwnProperty("y"))return;if(!this.GridNodeHolder&&!this.Modifiable)return;if(e.gridObject.GetID()!==this.Modifiable.GetObject().GetID())return void this._removeLinesCoordinates();let t=e.x,r=e.y,a=this.GridNodeHolder.getChildByName("XLineCoordinate"),n=this.GridNodeHolder.getChildByName("YLineCoordinate");a&&a.removeChildren(),n&&n.removeChildren();let s=this.Modifiable.GetProperty("3DGrid.Corner.Top.Left").GetPropertyValue().GetValue(),l=this.Modifiable.GetProperty("3DGrid.Corner.Bottom.Left").GetPropertyValue().GetValue(),p=this.Modifiable.GetProperty("3DGrid.Corner.Top.Right").GetPropertyValue().GetValue(),u=(this.Modifiable.GetProperty("3DGrid.Corner.Bottom.Right").GetPropertyValue().GetValue(),o.createLineNode({points:[new i.Vector3(t,s.y,0),new i.Vector3(t,l.y,0)],material:this._bodyMat.line})),h=o.createLineNode({points:[new i.Vector3(p.x,r,0),new i.Vector3(s.x,r,0)],material:this._bodyMat.line});a.addChild(u),n.addChild(h),this.Modifiable.ExperienceBase.getManager("VCXContextManager").renderAll()}),this.tokenRemoveCoordinatesLines=d.subscribe({event:"VCX_INTERACTOR_END_MANIPULATE"},()=>{this._removeLinesCoordinates(),this.Modifiable.ExperienceBase.getManager("VCXContextManager").renderAll()})},_removeLinesCoordinates:function(){if(!this.GridNodeHolder||!this.Modifiable)return;let e=this.GridNodeHolder.getChildByName("XLineCoordinate"),t=this.GridNodeHolder.getChildByName("YLineCoordinate");e&&e.removeChildren(),t&&t.removeChildren(),this.GridNodeHolder.getChildByName("CandidatePoint").removeChildren()},_GetOrientedBB:function(e){let t=[this.Modifiable.GetObject().getWorkingRootPathElement()];const r=this.Modifiable.QueryInterface("W3AISGNodeHolder").getWorldMatrix(e.viewer);this.setMatrix(r);const o=(new i.Matrix4).getInverse(r);let a=h.getOrientedBoundingBoxFromPathElements(t,r,e.viewer);return a.localBBox.expandByPoint(n.getOFromMatrix(r).applyMatrix4(o)),{orientedBB:a,worldMatrix:r}},_SetGridDimensions:function(e){const t=this._GetOrientedBB(e),r=t.worldMatrix,o=t.orientedBB,a=o.localBBox.min,s=o.localBBox.max;this.Modifiable.OnChangeProperty("3DGrid.Position.Min",new u(a)),this.Modifiable.OnChangeProperty("3DGrid.Position.Max",new u(s));let l=10*this.Modifiable.ExperienceBase.getManager("VCXPaperManager").GetPaperRatio(e,n.getOFromMatrix(r)),h=1e3*l,d=Math.min(Math.max(l,Math.abs(s.x-a.x)),h),c=Math.min(Math.max(l,Math.abs(s.y-a.y)),h);const y=this.Modifiable.GetProperty("3DGrid.Width").GetPropertyValue().GetValue(),C=this.Modifiable.GetProperty("3DGrid.Height").GetPropertyValue().GetValue();y&&C&&(d=y,c=C),this._ComputeGridCellSize(Math.max(d,c));let m=Math.floor(d/this.CellSize)*this.CellSize,f=Math.floor(c/this.CellSize)*this.CellSize;m%2&&(m=(Math.floor(d/this.CellSize)+1)*this.CellSize),f%2&&(f=(Math.floor(d/this.CellSize)+1)*this.CellSize);const V=new p(m),b=new p(f);this.width=m,this.height=f,this.Modifiable.OnChangeProperty("3DGrid.Width",V),this.Modifiable.OnChangeProperty("3DGrid.Height",b);let P=new i.Vector3(-m/2,f/2,0);this.Modifiable.OnChangeProperty("3DGrid.Corner.Top.Left",new u(P)),P=new i.Vector3(m/2,f/2,0),this.Modifiable.OnChangeProperty("3DGrid.Corner.Top.Right",new u(P)),P=new i.Vector3(-m/2,-f/2,0),this.Modifiable.OnChangeProperty("3DGrid.Corner.Bottom.Left",new u(P)),P=new i.Vector3(m/2,-f/2,0),this.Modifiable.OnChangeProperty("3DGrid.Corner.Bottom.Right",new u(P))},_BuildGridTextureNode:function(e,t,i,a){const n=new r.PrimitiveGroup({editable:!0});let s=new r.Buffer({component:r.VertexComponentEnum.POSITION,data:new Float32Array(12)});s.dimension=3,n.addBuffer(0,s);let l=new r.Buffer({component:r.VertexComponentEnum.TEX_COORD_0,data:new Float32Array(16)});l.dimension=3,n.addBuffer(1,l);let p,u=new r.Buffer({indexBuffer:!0,data:new Uint16Array(6)});n.addBuffer(2,u);let h=0;(p=s.data)[h++]=i.x,p[h++]=i.y,p[h++]=0,p[h++]=i.x+e,p[h++]=i.y,p[h++]=0,p[h++]=i.x+e,p[h++]=i.y+t,p[h++]=0,p[h++]=i.x,p[h++]=i.y+t,p[h++]=0,h=0,(p=l.data)[h++]=0,p[h++]=0,p[h++]=0,p[h++]=1,p[h++]=0,p[h++]=0,p[h++]=1,p[h++]=1,p[h++]=0,p[h++]=0,p[h++]=1,p[h++]=0,h=0,(p=u.data)[h++]=0,p[h++]=2,p[h++]=1,p[h++]=0,p[h++]=3,p[h++]=2;const d=new r.Primitive({nbIndices:6,connectivity:r.ConnectivityTypeEnum.TRIANGLES,fillGAS:new r.FillAttributes}),c=new r.VertexComponent({nbVertices:4,bufferId:0,indices:new r.IndexArray({bufferId:2,offset:0})}),y=new r.VertexComponent({nbVertices:4,bufferId:1,indices:new r.IndexArray({bufferId:2,offset:0})});d.addVertexComponent(c),d.addVertexComponent(y),n.addPrimitive(d);let C=o.createMeshNode(n);return this._CreateTextureMaterial(e,t,a),this.textureMaterials[a]&&C.setMaterial(this.textureMaterials[a]),C},_BuildGridBorderPlaneNode:function(e,t,r,a,n){return o.createRectangleNode({width:e,height:t,fill:a,cornerPoint:new i.Vector2(r.x,r.y),material:this._bodyMat,noEdge:n})},_BuiLdAxisNode:function(e,t,r){let n=.1*t,s=.1*r;const l=this.Modifiable.ExperienceBase.getManager("VCXVisuManager");let p,u,h={XAxis:[new i.Vector3(e.TopLeft.x-n,-this.offsetY,0),new i.Vector3(e.TopRight.x+n,-this.offsetY,0)],YAxis:[new i.Vector3(-this.offsetX,e.BottomLeft.y-s,0),new i.Vector3(-this.offsetX,e.TopLeft.y+s,0)]},d=[];for(let e in h)h.hasOwnProperty(e)&&(p=new a(e),(u=o.createLineNode({points:h[e],material:this._axisMat})).setVisibility(!1),u.setRenderPasses([l.getRenderList("VCXPreManipulators"),l.getRenderList("VCXManipulators")]),u.excludeFromCSO(!0),u.excludeFromHighlight(!0,!0),u.setNoHighlightNoZ(!0),p.addChild(u),d.push(p));return d},_CreateTextureMaterial:function(e,t,r){let o=e/this.GridStep,a=t/this.GridStep;this.Modifiable.OnChangeProperty("3DGrid.Texture.RepeatFactor.X",new p(o)),this.Modifiable.OnChangeProperty("3DGrid.Texture.RepeatFactor.Y",new p(a));let n=i.ImageUtils.loadTexture(c.getWebappsBaseUrl()+"VCXWebDressup/assets/textures/"+this.TextureName+".png");n.anisotropy=8,n.wrapS=i.RepeatWrapping,n.wrapT=i.RepeatWrapping,n.repeat=new i.Vector2(o,a),this.textures[r]=n,this.texture=n;let s=new i.MeshBasicMaterial({useBlending:!0,depthTest:!0,transparent:!0,enableClipPlanes:!1,map:n,force:!0,opacity:1,side:i.DoubleSide});s.needsUpdate=!0,this.textureMaterials[r]=s},_BuildGridLinesLists:function(e,i,r){this.XGridListHelper=new t(this.GridUnit),this.YGridListHelper=new t(this.GridUnit),this.XGridListHelper.head=r.TopLeft.x,this.XGridListHelper.tail=r.TopRight.x,this.YGridListHelper.head=r.BottomLeft.y,this.YGridListHelper.tail=r.TopLeft.y},_AddNodeForDebugSnapping:function(e){if(void 0===e.x||void 0===e.y)return;if(!this.GridNodeHolder&&!this.Modifiable)return;let t=this.GridNodeHolder.getChildByName("CandidatePoint");if(t&&0===t.getChildren().length){var r=o.createSphereNode({radius:3,material:this._bodyMat.line});r.setNoZ(!0);var a=o.createFixedSizeNode();a.addChild(r),a.setNoZ(!0),a.setVisibility(this.Modifiable.GetProperty("3DGrid.Origin.Show").GetPropertyValue().GetValue()),t.addChild(a)}const n=t.getChildren()[0];let s=(new i.Matrix4).setPosition(e);n.setMatrix(s);let l=this.GridNodeHolder.getChildByName("XLineCoordinate"),p=this.GridNodeHolder.getChildByName("YLineCoordinate");l&&l.removeChildren(),p&&p.removeChildren();let u=this.Modifiable.GetProperty("3DGrid.Corner.Top.Left").GetPropertyValue().GetValue(),h=this.Modifiable.GetProperty("3DGrid.Corner.Bottom.Left").GetPropertyValue().GetValue(),d=this.Modifiable.GetProperty("3DGrid.Corner.Top.Right").GetPropertyValue().GetValue(),c=(this.Modifiable.GetProperty("3DGrid.Corner.Bottom.Right").GetPropertyValue().GetValue(),o.createLineNode({points:[new i.Vector3(e.x,u.y,0),new i.Vector3(e.x,h.y,0)],material:this._bodyMat})),y=o.createLineNode({points:[new i.Vector3(d.x,e.y,0),new i.Vector3(u.x,e.y,0)],material:this._bodyMat});l.addChild(c),p.addChild(y),this.Modifiable.ExperienceBase.getManager("VCXContextManager").renderAll()},_Build:function(e){this._axisMat=this.Modifiable.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams({type:s.ELineType.Dot,lineWidth:1,color:(new l).SetRGB(255,255,255).GetThreeColor(),opacity:1});const t=this.Modifiable.ExperienceBase.getManager("VCXVisuManager");this.GridNodeHolder=new a("GridNodeHolder");const r=new a("CenterNode"),n=new a("CornersNode"),p=new a("PlaneNode"),u=(new a("BorderNode"),new a("TextureNode")),h=new a("GridPlaneNode"),d=new a("TranslationNode"),c=new a("RotationNode"),y=new a("PlaneDragNode"),C=new a("MiddlesNode"),m=new a("AxisNode");let f=this.Modifiable.GetProperty("3DGrid.Width").GetPropertyValue().GetValue(),V=this.Modifiable.GetProperty("3DGrid.Height").GetPropertyValue().GetValue();const b=this.Modifiable.GetProperty("3DGrid.Position.Min").GetPropertyValue().GetValue(),P=this.Modifiable.GetProperty("3DGrid.Position.Max").GetPropertyValue().GetValue();let g=(new i.Vector3).addVectors(b,P).multiplyScalar(.5);var _=o.createSphereNode({radius:2.05,material:this._bodyMat.line});_.setNoZ(!0);var S=o.createFixedSizeNode();S.addChild(_);let M=this.Modifiable.GetProperty("3DGrid.Origin.Local.Position").GetPropertyValue().GetFrame();S.setMatrix(M.GetValue()),S.setNoZ(!0),S.setVisibility(this.Modifiable.GetProperty("3DGrid.Origin.Show").GetPropertyValue().GetValue()),r.addChild(S),this._CreateTextureMaterial(f,V);let G={TopLeft:this.Modifiable.GetProperty("3DGrid.Corner.Top.Left").GetPropertyValue().GetValue(),TopRight:this.Modifiable.GetProperty("3DGrid.Corner.Top.Right").GetPropertyValue().GetValue(),BottomLeft:this.Modifiable.GetProperty("3DGrid.Corner.Bottom.Left").GetPropertyValue().GetValue(),BottomRight:this.Modifiable.GetProperty("3DGrid.Corner.Bottom.Right").GetPropertyValue().GetValue()};this.offsetX=g.x,this.offsetY=g.y;let D,x,v={TopMiddle:{position:new i.Vector3(0,G.TopLeft.y,0),rotation:(new i.Matrix4).makeRotationZ(Math.PI)},RightMiddle:{position:new i.Vector3(G.TopRight.x,0,0),rotation:(new i.Matrix4).makeRotationZ(Math.PI/2)},BottomMiddle:{position:new i.Vector3(0,G.BottomLeft.y,0),rotation:new i.Matrix4},LeftMiddle:{position:new i.Vector3(G.TopLeft.x,0,0),rotation:(new i.Matrix4).makeRotationZ(-Math.PI/2)}};for(let e in G)G.hasOwnProperty(e)&&((D=new a("Corner"+e)).setMatrix(D.getMatrix().setPosition(G[e])),n.addChild(D));for(let e in v)v.hasOwnProperty(e)&&((x=new a(e)).setMatrix(v[e].rotation),x.setMatrix(x.getMatrix().setPosition(v[e].position)),C.addChild(x));let A={Z:(new i.Matrix4).makeRotationX(-Math.PI/2),Y:(new i.Matrix4).makeRotationX(-Math.PI),X:(new i.Matrix4).makeRotationZ(-Math.PI/2)},X=null;for(let e in A)A.hasOwnProperty(e)&&((X=new a(e+"Translation")).setRenderPasses([t.getRenderList("VCXPreManipulators"),t.getRenderList("VCXManipulators")]),X.excludeFromCSO(!0),X.excludeFromHighlight(!0,!0),X.setNoHighlightNoZ(!0),X.setNoZ(!0),d.addChild(X));let I={Z:(new i.Matrix4).makeRotationX(-Math.PI/2),Y:(new i.Matrix4).makeRotationX(-Math.PI),X:(new i.Matrix4).makeRotationZ(-Math.PI/2)},T=null;for(let e in I)I.hasOwnProperty(e)&&((T=new a(e+"Rotation")).setRenderPasses([t.getRenderList("VCXPreManipulators"),t.getRenderList("VCXManipulators")]),T.excludeFromCSO(!0),T.excludeFromHighlight(!0,!0),T.setNoHighlightNoZ(!0),T.setNoZ(!0),c.addChild(T));this._BuiLdAxisNode(G,f,V).forEach(e=>{m.addChild(e)}),this.planeNode_=this._BuildGridBorderPlaneNode(f,V,G.BottomLeft,!0,!1),p.addChild(this.planeNode_);let w=new i.Vector3(0,0,0);this.textureNodeGroup={},this.textureNodeGroup.TopRight=this._BuildGridTextureNode(f/2,V/2,w,"TopRight"),this.textureNodeGroup.TopLeft=this._BuildGridTextureNode(f/2,V/2,w,"TopLeft"),this.textureNodeGroup.BottomRight=this._BuildGridTextureNode(f/2,V/2,w,"BottomRight"),this.textureNodeGroup.BottomLeft=this._BuildGridTextureNode(f/2,V/2,w,"BottomLeft"),this.textureNodeGroup.BottomLeft.setMatrix((new i.Matrix4).makeRotationZ(-Math.PI)),this.textureNodeGroup.TopLeft.setMatrix((new i.Matrix4).makeRotationY(-Math.PI)),this.textureNodeGroup.BottomRight.setMatrix((new i.Matrix4).makeRotationX(-Math.PI));for(let e in this.textureNodeGroup)this.textureNodeGroup.hasOwnProperty(e)&&u.addChild(this.textureNodeGroup[e]);this._BuildGridLinesLists(f,V,G),this.GridNodeHolder.addChild(r),this.GridNodeHolder.addChild(n),this.GridNodeHolder.addChild(C),this.GridNodeHolder.addChild(d),this.GridNodeHolder.addChild(c),this.GridNodeHolder.addChild(y),this.GridNodeHolder.addChild(m),h.addChild(p),h.addChild(u),h.setVisibilityInTree(!1),[h,p,u].forEach(e=>{e.setRenderPasses([t.getRenderList("VCXPreManipulators"),t.getRenderList("VCXManipulators")]),e.setNoHighlightNoZ(!0),e.setNoZ(!0)}),h.setPickingPriorityId("VCXMagnetGrid"),this.GridNodeHolder.addChild(h),this.GridNodeHolder.addChild(new a("XLineCoordinate")),this.GridNodeHolder.addChild(new a("YLineCoordinate")),this.GridNodeHolder.addChild(new a("CandidatePoint")),this.GridNodeHolder.setPickingPriorityId("VCXMagnetGrid"),this.GridNodeHolder.setVisibilityInTree(!1);const N=this.Modifiable.GetProperty("3DGrid.Default.Orientation").GetPropertyValue().GetValue();if("None"!==N){let e=null;switch(N){case"X":e=(new i.Matrix4).makeRotationX(Math.PI/2);break;case"Y":e=(new i.Matrix4).makeRotationY(Math.PI/2);break;case"Z":default:e=(new i.Matrix4).makeRotationZ(Math.PI/2)}this.GridNodeHolder.setMatrix(e)}this.addChild(this.GridNodeHolder,{exludeFromBounding:!1})},updateXSONodes:function(){},_UpdateTexturesNodes:function(e,t){const i=Math.abs(e.TopLeft.x-e.TopRight.x),o=Math.abs(e.TopLeft.y-e.BottomLeft.y);let a=this.textureNodeGroup[t].getBuffer(r.VertexComponentEnum.POSITION),n=0;a[n++]=e.BottomLeft.x,a[n++]=e.BottomLeft.y,n++,a[n++]=e.BottomRight.x,a[n++]=e.BottomRight.y,n++,a[n++]=e.TopRight.x,a[n++]=e.TopRight.y,n++,a[n++]=e.TopLeft.x,a[n++]=e.TopLeft.y,n++,this.textureNodeGroup[t].updateBuffer(r.VertexComponentEnum.POSITION,0,4),this.textureNodeGroup[t].computeBoundingElements();let s=i/this.GridStep,l=o/this.GridStep;this.textures[t].repeat.set(s,l),this.textureMaterials[t].updatePDSFXUniform("gridTexture",this.textures[t])},_UpdatePlaneNode:function(e){const t=Math.abs(e.TopLeft.x-e.TopRight.x),i=Math.abs(e.TopLeft.y-e.BottomLeft.y);this.GridNodeHolder.getChildByName("PlaneNode").removeChild(this.planeNode_),this.planeNode_=this._BuildGridBorderPlaneNode(t,i,e.BottomLeft,!0,!1),this.GridNodeHolder.getChildByName("PlaneNode").addChild(this.planeNode_),this.GridNodeHolder.getChildByName("AxisNode").removeChildren(),this._BuiLdAxisNode(e,t,i).forEach(e=>{this.GridNodeHolder.getChildByName("AxisNode").addChild(e)})},_UpdateCornersAndMiddles:function(e){this.getChildByName("CornerTopLeft").setMatrix(this.getChildByName("CornerTopLeft").getMatrix().setPosition(new i.Vector3(e.TopLeft.x,e.TopLeft.y,0))),this.getChildByName("CornerTopRight").setMatrix(this.getChildByName("CornerTopRight").getMatrix().setPosition(new i.Vector3(e.TopRight.x,e.TopRight.y,0))),this.getChildByName("CornerBottomLeft").setMatrix(this.getChildByName("CornerBottomLeft").getMatrix().setPosition(new i.Vector3(e.BottomLeft.x,e.BottomLeft.y,0))),this.getChildByName("CornerBottomRight").setMatrix(this.getChildByName("CornerBottomRight").getMatrix().setPosition(new i.Vector3(e.BottomRight.x,e.BottomRight.y,0))),this.getChildByName("TopMiddle").setMatrix(this.getChildByName("TopMiddle").getMatrix().setPosition(new i.Vector3((e.TopLeft.x+e.TopRight.x)/2,e.TopLeft.y,0))),this.getChildByName("BottomMiddle").setMatrix(this.getChildByName("BottomMiddle").getMatrix().setPosition(new i.Vector3((e.TopLeft.x+e.TopRight.x)/2,e.BottomLeft.y,0))),this.getChildByName("RightMiddle").setMatrix(this.getChildByName("RightMiddle").getMatrix().setPosition(new i.Vector3(e.TopRight.x,(e.TopRight.y+e.BottomRight.y)/2,0))),this.getChildByName("LeftMiddle").setMatrix(this.getChildByName("LeftMiddle").getMatrix().setPosition(new i.Vector3(e.TopLeft.x,(e.TopRight.y+e.BottomRight.y)/2,0)));var t=this.GetColorPropertyValue("Actor");if(this.textureMaterials)for(let e in this.textureMaterials)this.textureMaterials.hasOwnProperty(e)&&(this.textureMaterials[e].color=t.GetThreeColor(),this.textureMaterials[e].opacity=1)},UpdateCornersPropertiesAfterResize_:function(e,t){let r=e.x,o=e.y,a=Math.floor(Math.abs(r/this.GridUnit)),n=Math.floor(Math.abs(o/this.GridUnit));switch(t){case"topLeftResize":if(a)for(let e=0;e<=a;e++){let e=this.XGridListHelper.head;if(r<0){if(e+this.GridUnit>=0)break;this.XGridListHelper.shiftLine()}else this.XGridListHelper.addNewLine(e-this.GridUnit,!0)}if(n)for(let e=0;e<=n;e++){let e=this.YGridListHelper.tail;if(o<0){if(e-this.GridUnit<=0)break;this.YGridListHelper.popLine()}else this.YGridListHelper.addNewLine(e+this.GridUnit,!1)}break;case"topRightResize":if(a)for(let e=0;e<=a;e++){let e=this.XGridListHelper.tail;if(r<0){if(e-this.GridUnit<=0)break;this.XGridListHelper.popLine()}else this.XGridListHelper.addNewLine(e+this.GridUnit,!1)}if(n)for(let e=0;e<=n;e++){let e=this.YGridListHelper.tail;if(o<0){if(e-this.GridUnit<=0)break;this.YGridListHelper.popLine()}else this.YGridListHelper.addNewLine(e+this.GridUnit,!1)}break;case"bottomRightResize":if(a)for(let e=0;e<=a;e++){let e=this.XGridListHelper.tail;if(r<0){if(e-this.GridUnit<=0)break;this.XGridListHelper.popLine()}else this.XGridListHelper.addNewLine(e+this.GridUnit,!1)}if(n)for(let e=0;e<=n;e++){let e=this.YGridListHelper.head;if(o<0){if(e+this.GridUnit>=0)break;this.YGridListHelper.shiftLine()}else this.YGridListHelper.addNewLine(e-this.GridUnit,!0)}break;case"bottomLeftResize":if(a)for(let e=0;e<=a;e++){let e=this.XGridListHelper.head;if(r<0){if(e+this.GridUnit>=0)break;this.XGridListHelper.shiftLine()}else this.XGridListHelper.addNewLine(e-this.GridUnit,!0)}if(n)for(let e=0;e<=n;e++){let e=this.YGridListHelper.head;if(o<0){if(e+this.GridUnit>=0)break;this.YGridListHelper.shiftLine()}else this.YGridListHelper.addNewLine(e-this.GridUnit,!0)}}const s=Math.abs(this.XGridListHelper.tail-this.XGridListHelper.head),l=Math.abs(this.YGridListHelper.tail-this.YGridListHelper.head);let h={TopLeft:new i.Vector3(this.XGridListHelper.head,this.YGridListHelper.tail,0),TopRight:new i.Vector3(this.XGridListHelper.tail,this.YGridListHelper.tail,0),BottomLeft:new i.Vector3(this.XGridListHelper.head,this.YGridListHelper.head,0),BottomRight:new i.Vector3(this.XGridListHelper.tail,this.YGridListHelper.head,0)};this.Modifiable.OnChangeProperty("3DGrid.Corner.Top.Left",new u(h.TopLeft)),this.Modifiable.OnChangeProperty("3DGrid.Corner.Top.Right",new u(h.TopRight)),this.Modifiable.OnChangeProperty("3DGrid.Corner.Bottom.Left",new u(h.BottomLeft)),this.Modifiable.OnChangeProperty("3DGrid.Corner.Bottom.Right",new u(h.BottomRight)),this.width=s,this.height=l,this.Modifiable.OnChangeProperty("3DGrid.Width",new p(s)),this.Modifiable.OnChangeProperty("3DGrid.Height",new p(l)),this._UpdateCornersAndMiddles(h);let d={TopLeft:new i.Vector3(0,this.YGridListHelper.tail,0),TopRight:new i.Vector3(this.XGridListHelper.tail,this.YGridListHelper.tail,0),BottomLeft:new i.Vector3(0,0,0),BottomRight:new i.Vector3(this.XGridListHelper.tail,0,0)};this._UpdateTexturesNodes(d,"TopRight"),d={TopLeft:new i.Vector3(0,this.YGridListHelper.tail,0),TopRight:new i.Vector3(-this.XGridListHelper.head,this.YGridListHelper.tail,0),BottomLeft:new i.Vector3(0,0,0),BottomRight:new i.Vector3(-this.XGridListHelper.head,0,0)},this._UpdateTexturesNodes(d,"TopLeft"),d={TopLeft:new i.Vector3(0,-this.YGridListHelper.head,0),TopRight:new i.Vector3(this.XGridListHelper.tail,-this.YGridListHelper.head,0),BottomLeft:new i.Vector3(0,0,0),BottomRight:new i.Vector3(this.XGridListHelper.tail,0,0)},this._UpdateTexturesNodes(d,"BottomRight"),d={TopLeft:new i.Vector3(0,-this.YGridListHelper.head,0),TopRight:new i.Vector3(-this.XGridListHelper.head,-this.YGridListHelper.head,0),BottomLeft:new i.Vector3(0,0,0),BottomRight:new i.Vector3(-this.XGridListHelper.head,0,0)},this._UpdateTexturesNodes(d,"BottomLeft"),this._UpdatePlaneNode(h)},GetGridStep:function(){return this.CellSize},GetWorldGridNodeCorners:function(e){return{TopLeft:(new i.Vector3).getPositionFromMatrix(this.getChildByName("CornerTopLeft").getMatrixWorld()),TopRight:(new i.Vector3).getPositionFromMatrix(this.getChildByName("CornerTopRight").getMatrixWorld()),BottomLeft:(new i.Vector3).getPositionFromMatrix(this.getChildByName("CornerBottomLeft").getMatrixWorld()),BottomRight:(new i.Vector3).getPositionFromMatrix(this.getChildByName("CornerBottomRight").getMatrixWorld())}},GetGridNodeCorners:function(){return{TopLeft:(new i.Vector3).getPositionFromMatrix(this.getChildByName("CornerTopLeft").getMatrix()),TopRight:(new i.Vector3).getPositionFromMatrix(this.getChildByName("CornerTopRight").getMatrix()),BottomLeft:(new i.Vector3).getPositionFromMatrix(this.getChildByName("CornerBottomLeft").getMatrix()),BottomRight:(new i.Vector3).getPositionFromMatrix(this.getChildByName("CornerBottomRight").getMatrix())}},UpdateCornersPropertiesAfterResize:function(e,t){let i=e.x,r=e.y,o=Math.floor(Math.abs(i/this.GridUnit)),a=Math.floor(Math.abs(r/this.GridUnit));i=o*this.GridUnit,r=a*this.GridUnit;let n={TopLeft:this.Modifiable.GetProperty("3DGrid.Corner.Top.Left").GetPropertyValue().GetValue(),TopRight:this.Modifiable.GetProperty("3DGrid.Corner.Top.Right").GetPropertyValue().GetValue(),BottomLeft:this.Modifiable.GetProperty("3DGrid.Corner.Bottom.Left").GetPropertyValue().GetValue(),BottomRight:this.Modifiable.GetProperty("3DGrid.Corner.Bottom.Right").GetPropertyValue().GetValue()};switch(t){case"topLeftResize":n.TopLeft.x=n.TopLeft.x-i,n.TopLeft.y=n.TopLeft.y+r,n.TopRight.y=n.TopRight.y+r,n.BottomLeft.x=n.BottomLeft.x-i;break;case"topRightResize":n.TopRight.x=n.TopRight.x+i,n.TopRight.y=n.TopRight.y+r,n.TopLeft.y=n.TopLeft.y+r,n.BottomRight.x=n.BottomRight.x+i;break;case"bottomLeftResize":n.BottomLeft.x=n.BottomLeft.x-i,n.BottomLeft.y=n.BottomLeft.y-r,n.TopLeft.x=n.TopLeft.x-i,n.BottomRight.y=n.BottomRight.y-r;break;case"bottomRightResize":n.BottomRight.x=n.BottomRight.x+i,n.BottomRight.y=n.BottomRight.y-r,n.TopRight.x=n.TopRight.x+i,n.BottomLeft.y=n.BottomLeft.y-r}this.Modifiable.OnChangeProperty("3DGrid.Corner.Top.Left",new u(n.TopLeft)),this.Modifiable.OnChangeProperty("3DGrid.Corner.Top.Right",new u(n.TopRight)),this.Modifiable.OnChangeProperty("3DGrid.Corner.Bottom.Left",new u(n.BottomLeft)),this.Modifiable.OnChangeProperty("3DGrid.Corner.Bottom.Right",new u(n.BottomRight));let s=Math.abs(n.TopRight.x-n.TopLeft.x),l=Math.abs(n.TopRight.y-n.BottomRight.y);this.width=s,this.height=l,this.Modifiable.OnChangeProperty("3DGrid.Width",new p(s)),this.Modifiable.OnChangeProperty("3DGrid.Height",new p(l)),this._UpdateCornersAndMiddles(n),this._UpdateTexturesNodes(n)},preRender:function(e){if(this._globalOpacity>0&&this.GridNodeHolder){if(this.Modifiable.GetObject()._plane){let a;const s=this.Modifiable.ExperienceBase.getManager("VCXPaperManager"),l=this._GetOrientedBB(e),p=l.worldMatrix,u=l.orientedBB;var t=10*s.GetPaperRatio(e,n.getOFromMatrix(p));u.localBBox.min.set(-t,-t,u.localBBox.min.z),u.localBBox.max.set(t,t,u.localBBox.max.z);var r=u.localBBox.min,o=u.localBBox.max;s.GetPaperRatio(e,n.getOFromMatrix(p));this.setMatrix(p),a=(new i.Vector3).addVectors(r,o).multiplyScalar(.5),this.GridNodeHolder.setMatrix((new i.Matrix4).setPosition(new i.Vector3(a.x,a.y,0))),this.compactMode?this.GridNodeHolder.setMatrix((new i.Matrix4).makeScale(.2,.2,1)):this.ComputeGridUnit(e.viewpoint,e.viewer)}}},GetGridDimensions:function(){return{width:this.Modifiable.GetProperty("3DGrid.Width").GetPropertyValue().GetValue(),height:this.Modifiable.GetProperty("3DGrid.Height").GetPropertyValue().GetValue()}},getActiveStatus:function(){return this._active},update:function(e){this._parent();let t=this.Modifiable.QueryInterface("VCXIVisibility"),i=!1;t&&(i=t.GetVisibility());var r=this.GetPropertyValue("3DGrid.Plane.Enable")?this.GlobalOpacity:0;if(this._globalOpacity!==r){this._globalOpacity=r;var o=this._globalOpacity>0;o&&(this.GridNodeHolder||(this._SetGridDimensions(e),this._Build(e),this.SetCoordinatesLinesSnapping())),this.setVisibility(o)}if(this.GridNodeHolder){var a=this.GetPropertyValue("3DGrid.Origin.Show");this.GridNodeHolder.getChildByName("CenterNode").setVisibility(a);const e=this.GetPropertyValue("3DGrid.Active");this._active=e;let t=this.Modifiable.GetProperty("3DGrid.Width").GetPropertyValue().GetValue(),i=this.Modifiable.GetProperty("3DGrid.Height").GetPropertyValue().GetValue(),r=t-this.width,o=i-this.height;this.width=t,this.height=i,this.UpdateCornersPropertiesAfterResize_({x:r,y:o},"topRightResize")}if(!(this._globalOpacity<=0)){this._bodyMat&&(this._bodyMat.opacity=this._globalOpacity);var n=this.GetColorPropertyValue("Actor");if(this._axisMat&&(this._axisMat.color=n.GetThreeColor(),this._axisMat.opacity=1),this._bodyMat&&this._bodyMat.line&&(this._bodyMat.line.color=n.GetThreeColor(),this._bodyMat.line.opacity=1,this._bodyMat.line2.color=n.GetThreeColor(),this._bodyMat.line2.opacity=.6,this._bodyMat.color=n.GetThreeColor()),this.textureMaterials)for(let e in this.textureMaterials)this.textureMaterials.hasOwnProperty(e)&&(this.textureMaterials[e].color=n.GetThreeColor(),this.textureMaterials[e].opacity=1);this._arrowMat&&(this._arrowMat.opacity=1),this.handleLayers()}},dispose:function(){this.token&&(d.unsubscribe(this.token),delete this.token),this.tokenCoordinatesLines&&(d.unsubscribe(this.tokenCoordinatesLines),delete this.tokenCoordinatesLines),this.tokenRemoveCoordinatesLines&&(d.unsubscribe(this.tokenRemoveCoordinatesLines),delete this.tokenRemoveCoordinatesLines),this.GridNodeHolder.removeChildren(),this.GridNodeHolder=null,this.XGridListHelper=null,this.YGridListHelper=null,this._parent()}})}),define("DS/VCXWebDressup/VCX3DGridSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCX3DGridNode"],function(e,t){"use strict";return e.extend({init:function(){},getWorldMatrix:function(e){var t=this.getAnchorReferential(),i=this.QueryInterface("VCXIModifiable");return i&&(this._actorPosition=i.GetFramePropertyValue("Actor.Position"),this._actorPosition&&t.multiply(this._actorPosition)),t},buildSGNode:function(){if(!this._sgNode){var e={name:"3DGrid",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Grids.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXMeasurementAttachesNode",["DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXAttachSegmentNode","DS/VCXWebDressup/VCXDressup_Spec","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebDressup/VCXMeasurement_Spec","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXExtremityNode","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/VCXWebDressup/VCXPropertiesObserver","DS/VCXWebSystem/VCXMathTools","DS/VCXWebProperties/VCXColor","DS/Mesh/MeshUtils","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS"],function(e,t,i,r,o,a,n,s,l,p,u,h,d,c,y){"use strict";return a.extend({init:function(e){return this._parent(e),this._PanelNode=e.panelNode,this._BentLineSize=2,this._MinAngleAllowed=5,this._AttachType=r.EAttachType.Line,this._AttachNodes={},this.additionalGeometryRebuildObserver=new l,this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Value"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Area"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Volume"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Type"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Radius"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Radius1"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Radius2"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Length"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.ShowConstructionLines"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.ShowEndPoints"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.ShowRedlines"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.ShowPlanes"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Length1"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Length2"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Plane.Color"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Plane.Border.Color"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Additional.Color"),this.additionalGeometryRebuildObserver.add(this.Modifiable,"Collab.Measurement.Additional.2.Color"),this},_computePosBuffer:function(e,t,i){return e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=i.x,e[4]=i.y,e[5]=i.z,2},_getLineNode:function(){var t=[new y.Vector3,new y.Vector3],i=new Uint16Array([0,1]),r=this.GetPropertyValue("Collab.Attach.Line.Type"),o=this.GetColorPropertyValue("Collab.Attach.Line"),a=1;if(r!==e.ELineType.Plain){var n=1;0===n&&(n=1),a=1/n}var s={type:this.GetPropertyValue("Collab.Attach.Line.Type"),lineWidth:this.GetPropertyValue("Collab.Attach.Line.Width"),color:o.GetThreeColor(),opacity:o.a,scale:a};this._LineMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(s,this._LineMaterial);var l={points:t,idx:i,editable:!0,drawMode:h.ConnectivityTypeEnum.LINES,material:this._LineMaterial};return c.createLineNode(l)},dispose:function(){this._attachMeasurementLabelLine1&&(this._attachMeasurementLabelLine1.dispose(),this._attachMeasurementLabelLine1=null),this._attachMeasurementLabelLine2&&(this._attachMeasurementLabelLine2.dispose(),this._attachMeasurementLabelLine2=null),this._attachMeasurementExtremity1&&(this._attachMeasurementExtremity1.dispose(),this._attachMeasurementExtremity1=null),this._attachMeasurementExtremity2&&(this._attachMeasurementExtremity2.dispose(),this._attachMeasurementExtremity2=null),this.additionalGeometryRebuildObserver=null,this._parent()},_ComputePosAttaches:function(e){var t=this.Modifiable.GetObject().getKeyPoints(e,this._PanelNode.GetShapeInfo().smartNode);this._PanelNode.GetShapeInfo().smartNode.BillboardXAxis=(new y.Vector3).subVectors(t.labelLineExtremity2,t.labelLineExtremity1);var i,o=(new y.Vector3).addVectors(t.labelLineExtremity1,t.labelLineExtremity2).multiplyScalar(.5);i=t.angle&&t.projectedPoint?t.projectedPoint:t.labelLineExtremity0;var a,n=(new y.Vector3).subVectors(i,t.labelLineExtremity1),s=(new y.Vector3).subVectors(i,t.labelLineExtremity2),l=n.dot(s)>0;if(this.extremityType=r.EExtremityType.FullArrow_1,t.labelLineExtremity0&&t.labelLineExtremity1&&t.measurementExtremity1){if(t.angle){this._attachMeasurementExtremity1._ArrowTail=!1;var u=t.labelLineExtremity0.distanceTo(t.labelLineExtremity1);this._attachMeasurementLabelLine1.StartExtremity=p.getVxFromMatrix(t.measurementExtremity0Frame).multiplyScalar(.1*u).add(t.labelLineExtremity1)}else this._attachMeasurementLabelLine1._ArrowTail=!0,this._attachMeasurementLabelLine1.StartExtremity=o;this._attachMeasurementLabelLine1.BreakExtremity=t.labelLineExtremity1,this._attachMeasurementLabelLine1.EndExtremity=t.measurementExtremity1,this._attachMeasurementLabelLine1.preRender(e),this._attachMeasurementExtremity1&&(this._attachMeasurementExtremity1.Type=this.extremityType,a=t.angle?p.getVyFromMatrix(t.measurementExtremity0Frame).negate():(new y.Vector3).subVectors(this._attachMeasurementLabelLine1.BreakExtremity,this._attachMeasurementLabelLine1.StartExtremity),l&&(this._attachMeasurementExtremity1.Type=this.extremityType+1,a.negate()),this._attachMeasurementExtremity1.SetReferential(p.getMatrixFromOVx(t.arrowLineExtremity1,a)),this._attachMeasurementExtremity1.preRender(e))}if(t.labelLineExtremity0&&t.labelLineExtremity2&&t.measurementExtremity2){if(t.angle){this._attachMeasurementExtremity2._ArrowTail=!1;u=t.labelLineExtremity0.distanceTo(t.labelLineExtremity2);this._attachMeasurementLabelLine2.StartExtremity=p.getVxFromMatrix(t.measurementExtremity0Frame).applyAxisAngle(p.getVzFromMatrix(t.measurementExtremity0Frame),Math.PI+t.value).multiplyScalar(-.1*u).add(t.labelLineExtremity2)}else this._attachMeasurementExtremity2._ArrowTail=!0,this._attachMeasurementLabelLine2.StartExtremity=o;this._attachMeasurementLabelLine2.BreakExtremity=t.labelLineExtremity2,this._attachMeasurementLabelLine2.EndExtremity=t.measurementExtremity2,this._attachMeasurementLabelLine2.preRender(e),this._attachMeasurementExtremity2&&(this._attachMeasurementExtremity2.Type=this.extremityType+1,a=t.angle?p.getVyFromMatrix(t.measurementExtremity0Frame).applyAxisAngle(p.getVzFromMatrix(t.measurementExtremity0Frame),t.value):(new y.Vector3).subVectors(this._attachMeasurementLabelLine2.BreakExtremity,this._attachMeasurementLabelLine2.StartExtremity),l&&(this._attachMeasurementExtremity2.Type=this.extremityType,a.negate()),this._attachMeasurementExtremity2.SetReferential(p.getMatrixFromOVx(t.arrowLineExtremity2,a)),this._attachMeasurementExtremity2.preRender(e))}if(this._lineNode){var d,C=this._lineNode.getBuffer(h.VertexComponentEnum.POSITION);if(C)d=t.angle&&t.projectedPoint?this._computePosBuffer(C,t.projectedPoint,t.labelLineExtremity0):l?t.labelLineExtremity0.distanceToSquared(t.labelLineExtremity1)<t.labelLineExtremity0.distanceToSquared(t.labelLineExtremity2)?this._computePosBuffer(C,t.labelLineExtremity1,t.labelLineExtremity0):this._computePosBuffer(C,t.labelLineExtremity2,t.labelLineExtremity0):this._computePosBuffer(C,t.labelLineExtremity0,t.labelLineExtremity0),this._lineNode.updateBuffer(h.VertexComponentEnum.POSITION,0,d),this._lineNode.computeBoundingElements()}if(this._additionalGeometryBasedOnAttach0&&t.measurementExtremity0Frame&&this._additionalGeometryBasedOnAttach0.setMatrix(t.measurementExtremity0Frame),this._additionalGeometryBasedOnAttach1&&t.measurementExtremity1Frame&&this._additionalGeometryBasedOnAttach1.setMatrix(t.measurementExtremity1Frame),this._additionalGeometryBasedOnAttach2&&t.measurementExtremity2Frame&&this._additionalGeometryBasedOnAttach2.setMatrix(t.measurementExtremity2Frame),this._additionalGeometryBasedOnAttach3&&t.measurementExtremity3Frame&&this._additionalGeometryBasedOnAttach3.setMatrix(t.measurementExtremity3Frame),this._additionalGeometryBasedOnAttach4&&t.measurementExtremity4Frame&&this._additionalGeometryBasedOnAttach4.setMatrix(t.measurementExtremity4Frame),t.angle){var m=0,f=t.value;if(t.projectedPoint){var V=(new y.Vector3).subVectors(t.projectedPoint,t.measurementExtremity0),b=(new y.Vector3).crossVectors(p.getVxFromMatrix(t.measurementExtremity0Frame),V),P=p.getVxFromMatrix(t.measurementExtremity0Frame).angleTo(V);p.getVzFromMatrix(t.measurementExtremity0Frame).dot(b)<0?(m=-P,f+=.05*Math.PI):P>f&&(f=P,m-=.05*Math.PI)}this._arcNode&&(this._additionalGeometryBasedOnAttach0.remove(this._arcNode),this._arcNode=null),this._arcNode=c.createCircleNode({radius:t.radius,startAngle:m,endAngle:f,material:this._attachMeasurementLabelLine1._lineMaterial}),this._additionalGeometryBasedOnAttach0.add(this._arcNode),this._geometryAdded=!0}return 2},postUpdate:function(e){this._parent(),this.additionalGeometryRebuildObserver&&this.additionalGeometryRebuildObserver.postUpdate()},preRender:function(e){if(this._parent(e),this.viewpointVisibility&&this.allAnchorsReady&&this.GlobalOpacity){this.setVisibility(!0);var t=this.ExperienceBase.getManager("VCXPaperManager");if(this._lineMaterial){this._lineMaterial.handleByPrerender=!0;let e=t.UnitValueToPixel(this.Modifiable.GetPropertyValue("Collab.Attach.Line.Width"));e>=1?(this._lineMaterial.setLineWidth(e),this._lineMaterial.visible=!0):this._lineMaterial.visible=!1}if(this._primaryAdditionalGeometryMaterial){this._primaryAdditionalGeometryMaterial.handleByPrerender=!0;let e=t.UnitValueToPixel(2);e>=1?(this._primaryAdditionalGeometryMaterial.setLineWidth(e),this._primaryAdditionalGeometryMaterial.visible=!0):this._primaryAdditionalGeometryMaterial.visible=!1}if(this._secondaryAdditionalGeometryMaterial){this._secondaryAdditionalGeometryMaterial.handleByPrerender=!0;let e=t.UnitValueToPixel(1);e>=1?(this._secondaryAdditionalGeometryMaterial.setLineWidth(e),this._secondaryAdditionalGeometryMaterial.visible=!0):this._secondaryAdditionalGeometryMaterial.visible=!1}if(this._thirdAdditionalGeometryMaterial){this._thirdAdditionalGeometryMaterial.handleByPrerender=!0;let e=t.UnitValueToPixel(1);e>=1?(this._thirdAdditionalGeometryMaterial.setLineWidth(e),this._thirdAdditionalGeometryMaterial.visible=!0):this._thirdAdditionalGeometryMaterial.visible=!1}if(this._fourthAdditionalGeometryMaterial){this._fourthAdditionalGeometryMaterial.handleByPrerender=!0;let e=t.UnitValueToPixel(1);e>=1?(this._fourthAdditionalGeometryMaterial.setLineWidth(e),this._fourthAdditionalGeometryMaterial.visible=!0):this._fourthAdditionalGeometryMaterial.visible=!1}this._ComputePosAttaches(e);for(var i=0;i<this._preRenderGeometries.length;i++)this._preRenderGeometries[i].preRender(e)}else this.setVisibility(!1)},getPlaneNode:function(e){var t=new y.MeshBasicMaterial({side:y.DoubleSide,opacity:.3,color:this.GetColorPropertyValue("Collab.Measurement.Plane").GetThreeColor(),force:!0});t.line=new y.LineBasicMaterial({side:y.DoubleSide,transparent:!1,color:this.GetColorPropertyValue("Collab.Measurement.Plane.Border").GetThreeColor(),opacity:1,force:!0,polygonBorderMode:!0,lineWidth:2});var i=c.createRectangleNode({width:1,height:1,fill:!0,material:t}),r=new a({name:"plane"});r.setMatrix((new y.Matrix4).setPosition(new y.Vector3(-.5,-.5,0))),r.add(i);var o=new s(e);return o.ModifiableProperties=!1,o.SizeControlType=1,o.ScalingFactor=10,o.add(r),o},update:function(i){this._parent();var s=this.GlobalOpacity,l=this.GetPropertyValue("Collab.Attach.LeadType");this._AttachType!==l&&(this._AttachType=l);this._AttachType!==r.ELeadType.None&&s>0&&(this._AxisSystemNode,this._AxisSystemNode&&this._AxisSystemNode.setMatrix(this.Modifiable.GetObject().getReferential()),this._attachMeasurementLabelLine1||(D={name:"AttachMeasurementLabelLine1",modifiable:this.Modifiable,endExtremityType:r.EExtremityType.Yellow},this._attachMeasurementLabelLine1=new t(D),this.add(this._attachMeasurementLabelLine1),this._geometryAdded=!0),this._attachMeasurementLabelLine2||(D={name:"AttachMeasurementLabelLine2",modifiable:this.Modifiable,endExtremityType:r.EExtremityType.Yellow},this._attachMeasurementLabelLine2=new t(D),this.add(this._attachMeasurementLabelLine2),this._geometryAdded=!0),this._lineNode||(this._lineNode=this._getLineNode(),this.add(this._lineNode),this._geometryAdded=!0),this._attachMeasurementExtremity1||(D={name:"AttachMeasurementExtremity1",modifiable:this.Modifiable,type:r.EExtremityType.Dot},this._attachMeasurementExtremity1=new n(D),this.add(this._attachMeasurementExtremity1),this._geometryAdded=!0),this._attachMeasurementExtremity2||(D={name:"AttachMeasurementExtremity2",modifiable:this.Modifiable,type:r.EExtremityType.Dot},this._attachMeasurementExtremity2=new n(D),this.add(this._attachMeasurementExtremity2),this._geometryAdded=!0));this.additionalGeometryRebuildObserver&&this.additionalGeometryRebuildObserver.update(),(this.additionalGeometryRebuildObserver&&this.additionalGeometryRebuildObserver.isDirty()||this.Modifiable.GetObject().hasPointedObjectMoved(i))&&(this._preRenderGeometries=[],this._additionalGeometryToUpdate&&(this.remove(this._additionalGeometryToUpdate),this._additionalGeometryToUpdate=null),this._additionalGeometryBasedOnAttach0&&(this.remove(this._additionalGeometryBasedOnAttach0),this._additionalGeometryBasedOnAttach0=null),this._additionalGeometryBasedOnAttach1&&(this.remove(this._additionalGeometryBasedOnAttach1),this._additionalGeometryBasedOnAttach1=null),this._additionalGeometryBasedOnAttach2&&(this.remove(this._additionalGeometryBasedOnAttach2),this._additionalGeometryBasedOnAttach2=null),this._additionalGeometryBasedOnAttach3&&(this.remove(this._additionalGeometryBasedOnAttach3),this._additionalGeometryBasedOnAttach3=null),this._additionalGeometryBasedOnAttach4&&(this.remove(this._additionalGeometryBasedOnAttach4),this._additionalGeometryBasedOnAttach4=null),this._primaryAdditionalGeometryMaterial&&(this.remove(this._primaryAdditionalGeometryMaterial),this._primaryAdditionalGeometryMaterial=null),this._secondaryAdditionalGeometryMaterial&&(this.remove(this._secondaryAdditionalGeometryMaterial),this._secondaryAdditionalGeometryMaterial=null),this._thirdAdditionalGeometryMaterial&&(this.remove(this._thirdAdditionalGeometryMaterial),this._thirdAdditionalGeometryMaterial=null),this._fourthAdditionalGeometryMaterial&&(this.remove(this._fourthAdditionalGeometryMaterial),this._fourthAdditionalGeometryMaterial=null));var p=this.ExperienceBase.getManager("VCXMaterialManager");if(!this._primaryAdditionalGeometryMaterial){var h={type:e.ELineType.Plain,lineWidth:3,color:(new u).SetRGB(255,0,0).GetThreeColor(),opacity:s};this._primaryAdditionalGeometryMaterial=p.getLineMaterialFromParams(h)}if(!this._secondaryAdditionalGeometryMaterial){var d={type:e.ELineType.Dot,lineWidth:1,color:this.GetColorPropertyValue("Collab.Measurement.Additional").GetThreeColor(),opacity:s};this._secondaryAdditionalGeometryMaterial=p.getLineMaterialFromParams(d)}if(!this._thirdAdditionalGeometryMaterial){var C={type:e.ELineType.Plain,lineWidth:1,color:this.GetColorPropertyValue("Collab.Measurement.Additional.2").GetThreeColor(),opacity:s};this._thirdAdditionalGeometryMaterial=p.getLineMaterialFromParams(C)}if(!this._fourthAdditionalGeometryMaterial){var m={type:e.ELineType.Dot,lineWidth:1,color:(new u).SetRGB(255,0,0).GetThreeColor(),opacity:s};this._fourthAdditionalGeometryMaterial=p.getLineMaterialFromParams(m)}this._PanelNode.GetShapeInfo().smartNode.update(i),this._PanelNode.GetShapeInfo().smartNode.preRender(i);var f,V,b,P,g=this.Modifiable.GetObject().getKeyPoints(i,this._PanelNode.GetShapeInfo().smartNode);if(g.angle&&this.GetPropertyValue("Collab.Measurement.Type")===o.EType.BetweenLines){var _=(new y.Matrix4).getInverse(this._PanelNode.GetShapeInfo().smartNode.GetReferential(i));this._PanelNode.GetShapeInfo().smartNode.Position=g.projectedPoint.clone().applyMatrix4(_)}if(!this._additionalGeometryToUpdate){if(this._additionalGeometryToUpdate=new a({name:"additionalGeometryA"}),this.add(this._additionalGeometryToUpdate),this._geometryAdded=!0,this.GetPropertyValue("Collab.Measurement.ShowConstructionLines"))switch(this.GetPropertyValue("Collab.Measurement.Type")){case o.EType.BetweenCentres:case o.EType.BetweenPoints:case o.EType.LinePoint:case o.EType.BetweenLines:case o.EType.PlanePoint:case o.EType.BetweenPlanes:if(!g.angle){var S=c.createLineNode({points:[g.measurementExtremity1,g.measurementExtremity2],material:this._secondaryAdditionalGeometryMaterial});this._additionalGeometryToUpdate.add(S)}}if(g.angle&&this.GetPropertyValue("Collab.Measurement.ShowEndPoints")){var M;if(g.measurementAnglePoint1)D={name:"MeasurementAnglePoint1",modifiable:this.Modifiable,type:this.GetPropertyValue("Collab.Attach.ExtremityType.Additionnal")},(M=new n(D)).SetReferential((new y.Matrix4).setPosition(g.measurementAnglePoint1)),this._additionalGeometryToUpdate.add(M),this._preRenderGeometries.push(M);if(g.measurementAnglePoint2)D={name:"MeasurementAnglePoint2",modifiable:this.Modifiable,type:this.GetPropertyValue("Collab.Attach.ExtremityType.Additionnal")},(M=new n(D)).SetReferential((new y.Matrix4).setPosition(g.measurementAnglePoint2)),this._additionalGeometryToUpdate.add(M),this._preRenderGeometries.push(M)}switch(this.GetPropertyValue("Collab.Measurement.Type")){case o.EType.BetweenLines:S=c.createLineNode({points:[g.measurementExtremity2,g.measurementExtremity4],material:this._fourthAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(S),this._geometryAdded=!0;break;case o.EType.LinePoint:S=c.createLineNode({points:[g.measurementExtremity1,g.measurementExtremity3],material:this._fourthAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(S),this._geometryAdded=!0;break;case o.EType.PlanePoint:case o.EType.BetweenPlanes:if(this.GetPropertyValue("Collab.Measurement.ShowPlanes")){this._geometryAdded=!0;var G,D={name:"planeSmartNode",modifiable:this.Modifiable,type:this._type};if(g.measurementExtremity3Frame)D.name="planeSmartNode1",(G=this.getPlaneNode(D)).SetReferential(g.measurementExtremity3Frame),this._preRenderGeometries.push(G),this._additionalGeometryToUpdate.add(G);if(g.angle){if(g.measurementExtremity4Frame)D.name="planeSmartNode2",(G=this.getPlaneNode(D)).SetReferential(g.measurementExtremity4Frame),this._preRenderGeometries.push(G),this._additionalGeometryToUpdate.add(G)}else if(g.measurementExtremity6Frame)D.name="planeSmartNode2",(G=this.getPlaneNode(D)).SetReferential(g.measurementExtremity6Frame),this._preRenderGeometries.push(G),this._additionalGeometryToUpdate.add(G)}this.GetPropertyValue("Collab.Measurement.ShowConstructionLines")&&(!g.angle&&g.measurementExtremity4&&(S=c.createLineNode({points:[g.measurementExtremity4,g.measurementExtremity3],material:this._secondaryAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(S)),!g.angle&&g.measurementExtremity6&&(S=c.createLineNode({points:[g.measurementExtremity6,g.measurementExtremity5],material:this._secondaryAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(S)),g.angle&&(S=c.createLineNode({points:[g.measurementExtremity1,g.measurementExtremity3],material:this._secondaryAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(S))),!g.angle&&this.GetPropertyValue("Collab.Measurement.ShowRedlines")&&(S=c.createLineNode({points:[g.measurementExtremity1,g.measurementExtremity3],material:this._thirdAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(S),S=c.createLineNode({points:[g.measurementExtremity2,g.measurementExtremity4],material:this._thirdAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(S),g.measurementExtremity5&&(S=c.createLineNode({points:[g.measurementExtremity1,g.measurementExtremity5],material:this._thirdAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(S)),g.measurementExtremity6&&(S=c.createLineNode({points:[g.measurementExtremity2,g.measurementExtremity6],material:this._thirdAdditionalGeometryMaterial}),this._additionalGeometryToUpdate.add(S)))}}if(!this._additionalGeometryBasedOnAttach0)switch(this._additionalGeometryBasedOnAttach0=new a({name:"additionalGeometryB"}),this.add(this._additionalGeometryBasedOnAttach0),this._geometryAdded=!0,this.GetPropertyValue("Collab.Measurement.Type")){case o.EType.Radius:case o.EType.Diameter:f=this.GetPropertyValue("Collab.Measurement.Radius"),this.GetPropertyValue("Collab.Measurement.Type")===o.EType.Diameter&&(f*=.5),this.GetPropertyValue("Collab.Measurement.ShowRedlines")&&(V=c.createCircleNode({radius:f,material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach0.add(V),b=c.createLineNode({points:[new y.Vector3(.2*-f,.2*-f,0),new y.Vector3(.2*f,.2*f,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach0.add(b),P=c.createLineNode({points:[new y.Vector3(.2*-f,.2*f,0),new y.Vector3(.2*f,.2*-f,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach0.add(P))}if(!this._additionalGeometryBasedOnAttach1)switch(this._additionalGeometryBasedOnAttach1=new a({name:"additionalGeometryB1"}),this.add(this._additionalGeometryBasedOnAttach1),this._geometryAdded=!0,this.GetPropertyValue("Collab.Measurement.Type")){case o.EType.LinePoint:case o.EType.BetweenLines:this.GetPropertyValue("Collab.Measurement.ShowRedlines")&&(S=c.createLineNode({points:[new y.Vector3(0,0,0),new y.Vector3(this.GetPropertyValue("Collab.Measurement.Length1"),0,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach1.add(S));break;case o.EType.Linear:this.GetPropertyValue("Collab.Measurement.ShowRedlines")&&(S=c.createLineNode({points:[new y.Vector3(0,0,0),new y.Vector3(g.value,0,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach1.add(S));break;case o.EType.BetweenCentres:f=this.GetPropertyValue("Collab.Measurement.Radius1"),this.GetPropertyValue("Collab.Measurement.ShowRedlines")&&(V=c.createCircleNode({radius:f,material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach1.add(V),b=c.createLineNode({points:[new y.Vector3(.2*-f,.2*-f,0),new y.Vector3(.2*f,.2*f,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach1.add(b),P=c.createLineNode({points:[new y.Vector3(.2*-f,.2*f,0),new y.Vector3(.2*f,.2*-f,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach1.add(P));break;case o.EType.Radius:case o.EType.Diameter:this.GetPropertyValue("Collab.Measurement.ShowConstructionLines")&&(S=c.createLineNode({points:[new y.Vector3(0,0,0),new y.Vector3(g.value,0,0)],material:this._secondaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach1.add(S))}if(!this._additionalGeometryBasedOnAttach2)switch(this._additionalGeometryBasedOnAttach2=new a({name:"additionalGeometryB2"}),this.add(this._additionalGeometryBasedOnAttach2),this._geometryAdded=!0,this.GetPropertyValue("Collab.Measurement.Type")){case o.EType.BetweenLines:this.GetPropertyValue("Collab.Measurement.ShowRedlines")&&(S=c.createLineNode({points:[new y.Vector3(0,0,0),new y.Vector3(this.GetPropertyValue("Collab.Measurement.Length2"),0,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach2.add(S));break;case o.EType.BetweenCentres:f=this.GetPropertyValue("Collab.Measurement.Radius2"),this.GetPropertyValue("Collab.Measurement.ShowRedlines")&&(V=c.createCircleNode({radius:f,material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach2.add(V),b=c.createLineNode({points:[new y.Vector3(.2*-f,.2*-f,0),new y.Vector3(.2*f,.2*f,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach2.add(b),P=c.createLineNode({points:[new y.Vector3(.2*-f,.2*f,0),new y.Vector3(.2*f,.2*-f,0)],material:this._primaryAdditionalGeometryMaterial}),this._additionalGeometryBasedOnAttach2.add(P))}this._additionalGeometryBasedOnAttach3||(this._additionalGeometryBasedOnAttach3=new a({name:"additionalGeometryB3"}),this.add(this._additionalGeometryBasedOnAttach3),this._geometryAdded=!0,this.GetPropertyValue("Collab.Measurement.Type")),this._additionalGeometryBasedOnAttach4||(this._additionalGeometryBasedOnAttach4=new a({name:"additionalGeometryB4"}),this.add(this._additionalGeometryBasedOnAttach4),this._geometryAdded=!0,this.GetPropertyValue("Collab.Measurement.Type"));for(var x=0;x<this._preRenderGeometries.length;x++)this._preRenderGeometries[x].update(i);this.GetPropertyValue("Collab.Measurement.ShowEndPoints")?(this._attachMeasurementLabelLine1.EndExtremityType=r.EExtremityType.Yellow,this._attachMeasurementLabelLine2.EndExtremityType=r.EExtremityType.Yellow):(this._attachMeasurementLabelLine1.EndExtremityType=r.EExtremityType.None,this._attachMeasurementLabelLine2.EndExtremityType=r.EExtremityType.None),this._attachMeasurementLabelLine1.update(i),this._attachMeasurementLabelLine2.update(i),this._attachMeasurementExtremity1.update(i),this._attachMeasurementExtremity2.update(i);var v=this.Modifiable.getLineMaterialParams("Collab.Attach.Line",this._LineMaterial,this._lastFrontLineType,s);Object.keys(v).length>0&&("number"==typeof v.type&&v.type!==this._lastFrontLineType&&(this._lastFrontLineType=v.type),this._LineMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(v,this._LineMaterial)),this._primaryAdditionalGeometryMaterial.opacity=s,this._secondaryAdditionalGeometryMaterial.opacity=s,this._thirdAdditionalGeometryMaterial.opacity=s,this._fourthAdditionalGeometryMaterial.opacity=s,this.handleLayers(!1)}})}),define("DS/VCXWebDressup/VCXPanelNode",["DS/Mesh/MeshUtils","DS/SceneGraphNodes/CanvasNode","DS/SceneGraphNodes/CanvasNodeTexture","DS/VCXWebDressup/VCXAttachesNode","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXMeasurementAttachesNode","DS/VCXWebDressup/VCXPropertiesObserver","DS/VCXWebDressup/VCXPropertyValueUnitFormater","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/VCXWebVisualization/VCXImageManager","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS","DS/VCXWebDressup/VCXPanel_Spec","DS/VCXWebSystem/VCXTextTools","DS/VCXWebSystem/VCXHardwareServices"],function(e,t,i,r,o,a,n,s,l,p,u,h,d,c,y,C){"use strict";return a.extend({init:function(e){return this._parent(e),this._previousBackgroundDocID=null,this._CanvasNode=null,this._CanvasNodeTexture=null,this._HighlightCanvasNode=null,this._HighlightCanvasNodeTexture=null,this._Smart3DPaperNode=null,this._externalMargin=0,this._lineWidth=0,this._editingState=null,this._TextSize=new d.Vector2,this._currentText=null,this._analysedText=null,this._requestedFontRatio=1,this.visible=!1,this.FirstDrawDeferred=UWA.Promise.deferred(),this},_SetShadow:function(e,t,i){e.shadowColor="transparent",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,t&&this.GetPropertyGroupVisibility("Group.Shadow")&&(e.shadowColor="rgba(0, 0, 0, "+this.GetPropertyValue("Collab.Body.Shadow.Opacity")+")",e.shadowBlur=i*this.GetPropertyValue("Collab.Body.Shadow.Blur")/4,e.shadowOffsetX=i*Math.cos(this.GetPropertyValue("Collab.Body.Shadow.Orientation")/180*Math.PI)*this.GetPropertyValue("Collab.Body.Shadow.Distance"),e.shadowOffsetY=i*Math.sin(this.GetPropertyValue("Collab.Body.Shadow.Orientation")/180*Math.PI)*this.GetPropertyValue("Collab.Body.Shadow.Distance"))},_DrawShape:function(e,t,i,r,a){var n=t.shape;this._SetShadow(e,i,a),n===o.EBodyShape.Circle||n===o.EBodyShape.Ellipse?(e.beginPath(),e.save(),e.translate(t.x+.5*t.width,t.y+.5*t.height),e.translate(.5*-t.width,.5*-t.height),e.scale(.5*t.width,.5*t.height),e.arc(1,1,1,0,2*Math.PI,!1),e.restore(),e.closePath(),r&&"stroke"!==t.type&&e.clip()):n===o.EBodyShape.Rhombus?(e.beginPath(),e.moveTo(t.x+.5*t.width,t.y),e.lineTo(t.x+t.width,t.y+.5*t.height),e.lineTo(t.x+.5*t.width,t.y+t.height),e.lineTo(t.x,t.y+.5*t.height),e.closePath(),r&&"stroke"!==t.type&&e.clip()):n===o.EBodyShape.Rectangle||n===o.EBodyShape.Square?(e.beginPath(),e.rect(t.x,t.y,t.width,t.height),e.closePath()):(e.beginPath(),e.moveTo(t.x+t.cornerRadius,t.y),e.lineTo(t.x+t.width-t.cornerRadius,t.y),e.quadraticCurveTo(t.x+t.width,t.y,t.x+t.width,t.y+t.cornerRadius),e.lineTo(t.x+t.width,t.y+t.height-t.cornerRadius),e.quadraticCurveTo(t.x+t.width,t.y+t.height,t.x+t.width-t.cornerRadius,t.y+t.height),e.lineTo(t.x+t.cornerRadius,t.y+t.height),e.quadraticCurveTo(t.x,t.y+t.height,t.x,t.y+t.height-t.cornerRadius),e.lineTo(t.x,t.y+t.cornerRadius),e.quadraticCurveTo(t.x,t.y,t.x+t.cornerRadius,t.y),e.closePath()),"fill"===t.type?e.fill():"stroke"===t.type?(this._SetShadow(e,!1,a),e.stroke()):"clip"===t.type&&e.clip()},_DrawRegularCanvas:function(e,t,i,r){this._DrawCanvas(e,t,i,r,!1),this.FirstDrawDeferred.resolve()},_DrawHighlightCanvas:function(e,t,i,r){this._DrawCanvas(e,t,i,r,!0)},_DrawCanvas:function(e,t,i,r,a){if(this.Modifiable){var n=this.Modifiable.GetProperty("Collab.Attach.Preset");if(n)if(30===n.GetPropertyValue()._value)(m=this.GetShapeInfo())&&m.shape&&(m.shape=o.EBodyShape.None)}var s=this.GetShapeInfo().externalSize.x-2*this._externalMargin,l=this.GetShapeInfo().externalSize.y-2*this._externalMargin,p=0;void 0!==this.GetPropertyValue("Collab.Body.InnerMargin")&&(p=this.GetPropertyValue("Collab.Body.InnerMargin"));var u=p,h=this._externalMargin,d=this._externalMargin;if(this.GetShapeInfo().shape===o.EBodyShape.Square||this.GetShapeInfo().shape===o.EBodyShape.RoundedSquare||this.GetShapeInfo().shape===o.EBodyShape.Circle){var c=Math.max(s,l);s=c,l=c}var m={shape:this.GetShapeInfo().shape,x:h,y:d,width:s,height:l,cornerRadius:u,type:"fill",border:this.GetShapeInfo().border},f=this.GetColorPropertyValue("Collab.Background"),V=f.Clone();V.a=0;var b=V.GetStyle();t.save(),t.globalCompositeOperation="copy",t.fillStyle=b,t.globalAlpha=1,t.fillRect(0,0,e.width,e.height),t.restore();var P=!1;if(this.GetShapeInfo().shape===o.EBodyShape.None||this.GetShapeInfo().shape===o.EBodyShape.RemoveBorder||(t.save(),a?(t.globalCompositeOperation="copy",V.a=2/255,t.fillStyle=V.GetStyle(),t.globalAlpha=1):(t.globalCompositeOperation="source-over",t.fillStyle=f.GetStyle(),f.a>100/255&&this.GetPropertyGroupVisibility("Group.Background")&&(P=!0)),a||this.GetPropertyGroupVisibility("Group.Background")||(m.type="none"),this._DrawShape(t,m,P,!1,r),t.restore(),!a)){var g=this.GetPropertyValue("Collab.Image.Scale"),_=p+this._externalMargin,S=p+this._externalMargin,M=s-2*p,G=l-2*p,D=M*g,x=G*g;if(_+=.5*(M-D),S+=.5*(G-x),!a&&this.Modifiable.GetObject().backgroundImage&&this.Modifiable.GetObject().backgroundImage._IsReadyToUse){t.save(),t.globalCompositeOperation="source-over";var v=this.GetColorPropertyValue("Collab.Image"),A=v.a;v.a=1,t.fillStyle=v.GetStyle(),t.globalAlpha=A,C.isIE11()||1===v.r&&1===v.g&&1===v.b?(m.type="none",this._DrawShape(t,m,!1,!0,r),t.globalCompositeOperation="source-over",this._SetShadow(t,!P,r),P=!0,t.drawImage(this.Modifiable.GetObject().backgroundImage,_,S,D,x)):(m.type="fill",this._DrawShape(t,m,!1,!0,r),t.globalCompositeOperation="destination-in",this._SetShadow(t,!1,r),t.drawImage(this.Modifiable.GetObject().backgroundImage,_,S,D,x),t.globalCompositeOperation="multiply",this._SetShadow(t,!P,r),P=!0,t.drawImage(this.Modifiable.GetObject().backgroundImage,_,S,D,x)),t.restore()}if(a&&this.Modifiable.GetObject().backgroundImage&&this.Modifiable.GetObject().backgroundImage._IsReadyToUse){t.save(),t.globalCompositeOperation="source-over",t.globalAlpha=1;var X=f.Clone();return X.a=1,t.fillStyle=X.GetStyle(),this._SetShadow(t,!1,r),m.type="fill",this._DrawShape(t,m,!1,!0,r),t.globalCompositeOperation="destination-in",t.drawImage(this.Modifiable.GetObject().backgroundImage,_,S,D,x),void t.restore()}if(!a&&this._lineWidth&&this.GetShapeInfo().shape>0){t.save(),t.globalCompositeOperation="source-over";var I=this.GetColorPropertyValue("Collab.Border.Line");t.strokeStyle=I.GetStyle(),t.lineWidth=this._lineWidth,t.globalAlpha=I.a,m.type="stroke",this._DrawShape(t,m,!1,!1,r),t.restore()}if((!a||this.GetShapeInfo().shape===o.EBodyShape.None)&&this._analysedText){t.save(),m.type="clip",this._DrawShape(t,m,!1,!0,r),t.globalCompositeOperation="source-over",this._SetShadow(t,!P,r),P=!0;var T=h+p;T/=.3527;var w=d+p;this.GetPropertyValue("Collab.Text.VAlignment")===o.EVTextAlignment.Middle?w+=.5*(G-this._TextSize.y):this.GetPropertyValue("Collab.Text.VAlignment")===o.EVTextAlignment.Bottom&&(w+=G-this._TextSize.y),w/=.3527,t.scale(.3527,.3527),this._SetContextToDrawText(t),y.drawText(this._analysedText,t,T,w,M/.3527,this.GetPropertyValue("Collab.Text.HAlignment")),t.restore()}a&&(t.save(),t.globalCompositeOperation="source-over",t.fillStyle=b,t.globalAlpha=1,m.shape=o.EBodyShape.Rectangle,m.type="fill",this._DrawShape(t,m,!1,!0,r),t.restore())}},_SetContextToDrawText:function(e){var t=this.GetColorPropertyValue("Collab.Text");e.fillStyle=t.GetStyle(),this.Modifiable._panelDiv&&this.Modifiable._panelDiv.ckEditor&&this.Modifiable._panelDiv.ckEditor.isEditing?e.globalAlpha=0:e.globalAlpha=t.a;var i=this.GetFontPropertyValue("Collab.Text.Font");if(i){this.Modifiable.GetObject().fontHeight=this._requestedFontRatio*i.Height;var r="";r+=" "+(i.Italic?"italic":"normal"),r+=" "+(i.Weight||400),r+=" "+(this.Modifiable.GetObject().fontHeight||22)+"px",r+=" "+(i.Family||"Arial"),e.font=r}},GetShapeInfo:function(){return this.Modifiable.GetObject().shapeInfo||(this.Modifiable.GetObject().shapeInfo={},this.Modifiable.GetObject().shapeInfo.border={top:!1,bottom:!0,left:!1,right:!1}),this.Modifiable.GetObject().shapeInfo},_ComputeShapeInfo:function(){this._ComputeSize(),this._ComputeCenter()},_ComputeCenter:function(){var e={};switch(e.hPosition=-this._externalMargin,e.vPosition=-this._externalMargin,e.horizontalPosition=-this._externalMargin,e.verticalPosition=-this._externalMargin,e.horizontalPosition-=.5*this.GetShapeInfo().size.x,e.verticalPosition-=0,this.GetPropertyValue("Collab.Body.HAlignment")){case o.EHAlignment.Left:this.GetShapeInfo().center.x=.5*this.GetShapeInfo().size.x,e.hPosition-=0;break;case o.EHAlignment.Center:this.GetShapeInfo().center.x=0,e.hPosition-=.5*this.GetShapeInfo().size.x;break;case o.EHAlignment.Right:this.GetShapeInfo().center.x=.5*-this.GetShapeInfo().size.x,e.hPosition-=1*this.GetShapeInfo().size.x}switch(this.GetPropertyValue("Collab.Body.VAlignment")){case o.EVAlignment.Top:this.GetShapeInfo().center.y=.5*this.GetShapeInfo().size.y,e.vPosition-=1*this.GetShapeInfo().size.y;break;case o.EVAlignment.Middle:this.GetShapeInfo().center.y=0,e.vPosition-=.5*this.GetShapeInfo().size.y;break;case o.EVAlignment.Bottom:this.GetShapeInfo().center.y=.5*-this.GetShapeInfo().size.y,e.vPosition-=0}return e},_ComputeSize:function(){this.GetShapeInfo().size.set(this.GetPropertyValue("Collab.Body.Width"),this.GetPropertyValue("Collab.Body.Height"));var e=0;if(void 0!==this.GetPropertyValue("Collab.Body.InnerMargin")&&(e=this.GetPropertyValue("Collab.Body.InnerMargin")),this._currentText&&this.GetPropertyValue("Collab.Body.FitToText")&&(this.GetPropertyValue("Collab.Text.Wordwrap")?this.GetShapeInfo().size.y=this._TextSize.y:this.GetShapeInfo().size.copy(this._TextSize),this.GetShapeInfo().size.x+=2*e,this.GetShapeInfo().size.y+=2*e),this.GetShapeInfo().keepAspectRatio=!1,this.GetPropertyValue("Collab.Body.KeepAspectRatio")&&(this.GetShapeInfo().keepAspectRatio=!0,this.Modifiable.GetObject().backgroundImage?this.GetShapeInfo().size.y=this.GetShapeInfo().size.x*this.Modifiable.GetObject().backgroundImage.height/this.Modifiable.GetObject().backgroundImage.width:this._TextSize.x>0&&(this.GetShapeInfo().size.y=this.GetShapeInfo().size.x*this._TextSize.y/this._TextSize.x)),this._TextSize&&this._TextSize.x>0?this.GetShapeInfo().sizeBeforeEqualization=this.GetShapeInfo().size.clone():delete this.GetShapeInfo().sizeBeforeEqualization,this.GetPropertyValue("Collab.Body.ContributeToEqualSize")&&(this.GetShapeInfo().size.x=this.ExperienceBase.getManager("VCXDressupManager").GetCalloutMaxWidth()),this.GetShapeInfo().shape===o.EBodyShape.Square||this.GetShapeInfo().shape===o.EBodyShape.RoundedSquare||this.GetShapeInfo().shape===o.EBodyShape.Circle){this.GetShapeInfo().keepAspectRatio=!0;var t=Math.max(this.GetShapeInfo().size.x,this.GetShapeInfo().size.y);this.GetShapeInfo().size.x=t,this.GetShapeInfo().size.y=t}this.GetShapeInfo().internalSize.copy(this.GetShapeInfo().size),this.GetShapeInfo().internalSize.x-=2*e,this.GetShapeInfo().internalSize.y-=2*e,this.GetShapeInfo().externalSize.copy(this.GetShapeInfo().size),this.GetPropertyGroupVisibility("Group.Shadow")?this._externalMargin=this.GetPropertyValue("Collab.Body.Shadow.Distance")+1:this._externalMargin=.5,this._externalMargin+=.5*this._lineWidth,this.GetShapeInfo().externalSize.x+=2*this._externalMargin,this.GetShapeInfo().externalSize.y+=2*this._externalMargin},computePow:function(e){let t=262144;if(!e){t=Math.pow(2024,2);let e=this.Modifiable.GetObject().backgroundImage&&this.Modifiable.GetObject().backgroundImage._IsReadyToUse,i=!(this.GetPropertyGroupVisibility("Group.Shadow")&&0!==this.GetPropertyValue("Collab.Body.Shadow.Opacity")||1!==this.GetPropertyValue("Collab.Border.Line.Color").GetRGBA()[3]&&0!==this.GetPropertyValue("Collab.Border.Line.Width"));e&&i&&(t=Math.min(t,this.Modifiable.GetObject().backgroundImage.width*this.Modifiable.GetObject().backgroundImage.height))}return Math.log(t/(this.GetShapeInfo().externalSize.x*this.GetShapeInfo().externalSize.y))/(2*Math.log(2))},_ReBuildCanvasNodeTexture:function(r){if(this._ComputeSize(),!this._CanvasNode||!this._CanvasNodeTexture||Math.abs(this._CanvasNodeTexture.width-this.GetShapeInfo().externalSize.x)>.1||Math.abs(this._CanvasNodeTexture.height-this.GetShapeInfo().externalSize.y)>.1||this.realignCanvasObserver.isDirty()){if(this._CanvasNode&&this._Smart3DPaperNode&&(this._Smart3DPaperNode.remove(this._CanvasNode),this._CanvasNode=null,this._CanvasNodeTexture=null,this._Smart3DPaperNode.remove(this._HighlightCanvasNode),this._HighlightCanvasNode=null,this._HighlightCanvasNodeTexture=null),this.GetShapeInfo().externalSize.x*this.GetShapeInfo().externalSize.y>0){var a=this._ComputeCenter(),n=this._computePanelCenterMM(r);n&&(this.GetShapeInfo().centerInPaper=n);var s=new d.Vector3(a.hPosition,a.vPosition,0);this.tempCorner=new d.Vector3(a.horizontalPosition,a.verticalPosition,0);var l=!0;this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=o.EPositionType.Free2D&&!this.GetPropertyValue("Collab.3D.Paper.Is.Background")&&(l=!1);var p=new d.Vector3(this.GetShapeInfo().externalSize.x,0,0),u=new d.Vector3(0,this.GetShapeInfo().externalSize.y,0);if(!this._HighlightCanvasNodeTexture){var c=this.GetShapeInfo().externalSize.x,y=this.GetShapeInfo().externalSize.y,C=!0;this._HighlightCanvasNodeTexture=new i({width:c,height:y,rectangleTexture:C,drawCB:this._DrawHighlightCanvas.bind(this),alphaTest:.005,materialParams:{opacity:0,depthTest:l,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:-10,polygonOffsetUnits:-10}}),this._HighlightCanvasNodeTexture.maxPow=this.computePow(!0)}if(this._HighlightCanvasNode=new t({name:"highlightCanvas",bottomLeftcorner:s,widthVector:p,heightVector:u,canvasNodeTexture:this._HighlightCanvasNodeTexture},h),this._Smart3DPaperNode&&(this._Smart3DPaperNode.add(this._HighlightCanvasNode),this.handleLayers(!0)),!this._CanvasNodeTexture){c=this.GetShapeInfo().externalSize.x,y=this.GetShapeInfo().externalSize.y,C=!0;this._CanvasNodeTexture=new i({width:c,height:y,rectangleTexture:C,drawCB:this._DrawRegularCanvas.bind(this),alphaTest:0,materialParams:{opacity:this._globalOpacity,depthTest:l,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:-10,polygonOffsetUnits:-10}}),this._CanvasNodeTexture.maxPow=this.computePow(!1)}this._CanvasNode=new t({name:"regularCanvas",bottomLeftcorner:s,widthVector:p,heightVector:u,canvasNodeTexture:this._CanvasNodeTexture},h),this._CanvasNode.setPickable(e.PICKTHROUGH),this._CanvasNode.rectangle.excludeFromHighlight(!0,!0),this._CanvasNode.traverse(function(e,t){return e.noAA=!0,!1},!0),this._Smart3DPaperNode&&this._Smart3DPaperNode.add(this._CanvasNode),this._AttachesNodeContainer&&this._AttachesNodeContainer.RecursiveSetRenderDepth(this.renderDepth),this._Smart3DPaperNode&&this._Smart3DPaperNode.RecursiveSetRenderDepth(this.renderDepth+.1),this.handleLayers(!0),this._CanvasNodeTexture._requestRedraw(),this._HighlightCanvasNodeTexture._requestRedraw()}}else this._CanvasNodeTexture._requestRedraw(),this._HighlightCanvasNodeTexture._requestRedraw();return this.ExperienceBase.getManager("VCXContextManager").renderAll(),this._CanvasNode},isNodeBuilt:function(){return Boolean(this._Smart3DPaperNode)},dispose:function(){this._Smart3DPaperNode&&(this._Smart3DPaperNode.dispose(),this._Smart3DPaperNode=null,this.GetShapeInfo().smartNode=null),this._AttachesNode&&(this._AttachesNode.dispose(),this._AttachesNode=null),delete this.realignCanvasObserver,delete this.rebuildAttachesObserver,delete this.rebuildCanvasObserver,delete this.textChangeObserver,delete this.textFontObserver,delete this.htmlChangeObserver,delete this.redrawCanvasObserver,delete this.otherOptionsObserver,delete this.observers,this._parent()},_Build:function(){this.GetShapeInfo().shape=1,this.GetShapeInfo().externalSize=new d.Vector2,this.GetShapeInfo().internalSize=new d.Vector2,this.GetShapeInfo().center=new d.Vector2,this.GetShapeInfo().centerInPaper=new d.Vector2,this.GetShapeInfo().size=new d.Vector2,this.GetShapeInfo().keepAspectRatio=null;var e={name:"AttachContainerNode",modifiable:this.Modifiable};this._AttachesNodeContainer=new a(e),this.add(this._AttachesNodeContainer);e={name:"PanelSmartNode",modifiable:this.Modifiable};this._Smart3DPaperNode=new p(e),this.GetShapeInfo().smartNode=this._Smart3DPaperNode,this.add(this._Smart3DPaperNode),this.handleLayers(!0),this.observers=[],this.realignCanvasObserver=new s,this.observers.push(this.realignCanvasObserver),this.realignCanvasObserver.add(this.Modifiable,"Collab.Body.HAlignment"),this.realignCanvasObserver.add(this.Modifiable,"Collab.Body.VAlignment"),this.rebuildAttachesObserver=new s,this.observers.push(this.rebuildAttachesObserver),this.rebuildAttachesObserver.add(this.Modifiable,"Collab.Measurement.Type"),this.rebuildAttachesObserver.add(this.Modifiable,"Collab.Measurement.Attach.Type"),this.rebuildAttachesObserver.add(this.Modifiable,"Collab.Attach.BentDot"),this.rebuildAttachesObserver.add(this.Modifiable,"Collab.Attach.LeadType"),this.rebuildAttachesObserver.add(this.Modifiable,"Collab.Attach.Origin"),this.rebuildCanvasObserver=new s,this.observers.push(this.rebuildCanvasObserver),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.Shape"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.Width"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.Height"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.InnerMargin"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.KeepAspectRatio"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Border.Show"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Border.Line.Width"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Image.Show"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Image.Doc.ID"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.PIP.Scenario.ID"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Image.Doc.PrepareRender"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Image.Scale"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.Shadow.Show"),this.rebuildCanvasObserver.add(this.Modifiable,"Collab.Body.Shadow.Distance"),this.textChangeObserver=new s,this.observers.push(this.textChangeObserver),this.textChangeObserver.add(this.Modifiable,"Collab.Text"),this.textChangeObserver.add(this.Modifiable,"Collab.Text.Show"),this.textChangeObserver.add(this.Modifiable,"Collab.Body.FitToText"),this.textChangeObserver.add(this.Modifiable,"Collab.Text.Wordwrap"),this.textChangeObserver.add(this.Modifiable,"Collab.Text.Font"),this.textChangeObserver.add(this.Modifiable,"Collab.Text.HAlignment"),this.textChangeObserver.add(this.Modifiable,"Collab.Text.LineSpacing"),this.textChangeObserver.add(this.Modifiable,"Collab.Text.ParagraphSpacing"),this.textChangeObserver.add(this.Modifiable,"Collab.Text.SizeToFit"),this.textChangeObserver.add(this.Modifiable,"Collab.Body.Width"),this.textChangeObserver.add(this.Modifiable,"Collab.Body.InnerMargin"),this.textFontObserver=new s,this.observers.push(this.textFontObserver),this.textFontObserver.add(this.Modifiable,"Collab.Text.Font"),this.textFontObserver.add(this.Modifiable,"Collab.Text.SizeToFit"),this.htmlChangeObserver=new s,this.observers.push(this.htmlChangeObserver),this.htmlChangeObserver.add(this.Modifiable,"Collab.Body.Width"),this.htmlChangeObserver.add(this.Modifiable,"Collab.Body.Height"),this.htmlChangeObserver.add(this.Modifiable,"Collab.Text.html"),this.redrawCanvasObserver=new s,this.observers.push(this.redrawCanvasObserver),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Background.Color"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Background.Color.Opacity"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Background.Show"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Border.Line.Color"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Border.Line.Color.Opacity"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Text.Color"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Text.Color.Opacity"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Image.Color"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Image.Color.Opacity"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Body.Shadow.Orientation"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Body.Shadow.Opacity"),this.redrawCanvasObserver.add(this.Modifiable,"Collab.Body.Shadow.Blur"),this.otherOptionsObserver=new s,this.observers.push(this.otherOptionsObserver),this.otherOptionsObserver.add(this.Modifiable,"Collab.3D.Paper.Depth"),this.otherOptionsObserver.add(this.Modifiable,"Actor.IsAlwaysOnTop"),this.otherOptionsObserver.add(this.Modifiable,"Collab.3D.Paper.Billboard.Type")},preRender:function(e){var t=!1;if(this._isVisible){if(this._parent(e),!(this.viewpointVisibility&&this.allAnchorsReady&&this.GlobalOpacity))return void this.setVisibility(!1);this.setVisibility(!0),this._Smart3DPaperNode&&(t|=this._Smart3DPaperNode.preRender(e)),this._AttachesNode&&(t|=this._AttachesNode.preRender(e))}return t},postUpdate:function(e){this._parent(),this.Modifiable._panelDiv&&this.Modifiable._panelDiv.ckEditor&&this.Modifiable._panelDiv.ckEditor.checkForNecessaryRessources()&&(this.Modifiable._panelDiv.ckEditor.updateDivPosition(),this.Modifiable._panelDiv.ckEditor.updateDivSize()),this._Smart3DPaperNode&&this._Smart3DPaperNode.postUpdate(e),this._AttachesNode&&this._AttachesNode.postUpdate(e),this.observers&&this.observers.every(function(e){return e.postUpdate(),!0})},update:function(e){if(this._parent(),this._globalOpacity!==this.GlobalOpacity&&(this._globalOpacity=this.GlobalOpacity,this._isVisible=this._globalOpacity>0,this._isVisible?this._Smart3DPaperNode||this._Build():null!==this._Smart3DPaperNode&&(this._CanvasNode&&(this._Smart3DPaperNode.remove(this._CanvasNode),this._CanvasNodeTexture=null,this._CanvasNode=null),this._HighlightCanvasNode&&(this._Smart3DPaperNode.remove(this._HighlightCanvasNode),this._HighlightCanvasNode=null,this._HighlightCanvasNodeTexture=null)),this.setVisibility(this._isVisible),this._myDiv&&this._myDiv.style.opacity!==this._globalOpacity&&(this._myDiv.style.opacity=this._globalOpacity)),this._globalOpacity<=0)return;var t=!1;if(this._Smart3DPaperNode&&this._Smart3DPaperNode.update(e),this.observers&&this.observers.every(function(e){return e.update(),!0}),!this._AttachesNode||this.rebuildAttachesObserver.isDirty()){this.rebuildAttachesObserver.isDirty()&&(this._AttachesNodeContainer.remove(this._AttachesNode),this._AttachesNode=null);var i={name:"AttachesNode",modifiable:this.Modifiable,panelNode:this};this.Modifiable.GetPropertyGroupVisibility("Group.Attach")&&(this.Modifiable.GetObject().getAttachType&&this.Modifiable.GetObject().getAttachType()?this._AttachesNode=new n(i):this._AttachesNode=new r(i),this._AttachesNodeContainer&&this._AttachesNodeContainer.add(this._AttachesNode))}this._AttachesNode&&this._AttachesNode.update(e);var a=!0;this.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<=o.EPositionType.Free2D&&!this.GetPropertyValue("Collab.3D.Paper.Is.Background")&&(a=!1);var s=this._computePanelCenterMM(e);this.GetShapeInfo().centerInPaper=s,this._CanvasNodeTexture&&this._CanvasNodeTexture.setMaterialParams&&this._CanvasNodeTexture.setMaterialParams({opacity:this._globalOpacity,depthTest:a,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:-10,polygonOffsetUnits:-10}),this._HighlightCanvasNodeTexture&&this._HighlightCanvasNodeTexture.setMaterialParams&&this._HighlightCanvasNodeTexture.setMaterialParams({opacity:0,depthTest:a,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:-10,polygonOffsetUnits:-10});var p=this.textFontObserver.isDirty(),h=this.redrawCanvasObserver.isDirty();h||(this.Modifiable._panelDiv&&!this._editingState?(this._editingState=!0,h=!0):!this.Modifiable._panelDiv&&this._editingState&&(this._editingState=!1,h=!0));var d=this.textChangeObserver.isDirty(),c=null===this._HighlightCanvasNode||null===this._CanvasNode||d||this.rebuildCanvasObserver.isDirty()||this.realignCanvasObserver.isDirty(),C="";if(this.GetPropertyGroupVisibility("Group.Text")&&((C=this.Modifiable.GetComputedStringProperty("Collab.Text",l.format))||(C=" ")),C||(C=""),this._currentText!==C&&(p=!0,this._currentText=C,c=!0,d=!0),this.GetPropertyValue("Collab.Text.SizeToFit")&&c&&(d=!0),this.GetPropertyValue("Collab.Body.ContributeToEqualSize")&&this._calloutMaxWidth!==this.ExperienceBase.getManager("VCXDressupManager").GetCalloutMaxWidth()&&(this._calloutMaxWidth=this.ExperienceBase.getManager("VCXDressupManager").GetCalloutMaxWidth(),c=!0),!(this.otherOptionsObserver.isDirty()||c||h||d||p))return;if(this._CanvasNodeTexture&&this._CanvasNodeTexture.setMaterialParams&&this._CanvasNodeTexture.setMaterialParams({opacity:this._globalOpacity,depthTest:a,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:-10,polygonOffsetUnits:-10}),this._HighlightCanvasNodeTexture&&this._HighlightCanvasNodeTexture.setMaterialParams&&this._HighlightCanvasNodeTexture.setMaterialParams({opacity:0,depthTest:a,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:-10,polygonOffsetUnits:-10}),this.GetShapeInfo().shape=this.GetPropertyValue("Collab.Body.Shape"),this._lineWidth=this.GetPropertyValue("Collab.Border.Line.Width"),this.GetPropertyGroupVisibility("Group.Border")?this._lineWidth*=.3527:this._lineWidth=0,void 0!==this.GetPropertyValue("Collab.3D.Paper.Depth")&&(this.renderDepth=this.GetPropertyValue("Collab.3D.Paper.Depth",!0),this._AttachesNodeContainer&&this._AttachesNodeContainer.RecursiveSetRenderDepth(this.renderDepth),this._Smart3DPaperNode&&this._Smart3DPaperNode.RecursiveSetRenderDepth(this.renderDepth+.1)),d)if(this._currentText&&""!==this._currentText){var m=document.createElement("canvas");m.width=0,m.height=0;var f=m.getContext("2d"),V=-1;if(this.Modifiable.GetPropertyValue("Collab.Text.SizeToFit")){this._ComputeSize(),this._requestedFontRatio=1,this._SetContextToDrawText(f),this._analysedText=y.analyseText(this._currentText,null,f,V,this.Modifiable.GetObject().fontHeight,this.GetPropertyValue("Collab.Text.LineSpacing"),this.GetPropertyValue("Collab.Text.ParagraphSpacing")),this._TextSize.x=.3527*this._analysedText.maxWidth,this._TextSize.y=.3527*this._analysedText.maxHeight;var b=this.GetShapeInfo().internalSize.x/this._TextSize.x,P=this.GetShapeInfo().internalSize.y/this._TextSize.y;this._requestedFontRatio=Math.min(b,P),p=!0}else this._requestedFontRatio=1,this.GetPropertyValue("Collab.Text.Wordwrap")&&(this._ComputeSize(),V=this.GetShapeInfo().internalSize.x/.3527);this._SetContextToDrawText(f),this._analysedText=y.analyseText(this._currentText,p?null:this._analysedText,f,V,this.Modifiable.GetObject().fontHeight,this.GetPropertyValue("Collab.Text.LineSpacing"),this.GetPropertyValue("Collab.Text.ParagraphSpacing")),this._TextSize.x=.3527*this._analysedText.maxWidth,this._TextSize.y=.3527*this._analysedText.maxHeight}else this._TextSize.x=0,this._TextSize.y=0,this._analysedText=null;var g=!1;let _=this.getDocID();if(this._previousBackgroundDocID!==_||this._previousShape!==this.GetShapeInfo().shape||this.GetPropertyValue("Collab.Image.Doc.PrepareRender"))if(this._previousShape=this.GetShapeInfo().shape,this._previousBackgroundDocID=_,this.GetPropertyValue("Collab.Image.Doc.PrepareRender")&&(this._previousBackgroundDocID=-1),-1!==_){var S=u.Effect.None;if(this.GetShapeInfo().shape===o.EBodyShape.RemoveBorder&&(S=u.Effect.RemoveBorder),this.Modifiable){var M=this.Modifiable.GetObject().getImage(S).then(i=>{this._ReBuildCanvasNodeTexture(e),t=!0});this.Modifiable.GetObject().QueryInterface("VCXIReadiness").registerPromise(M)}g=!0}else this.Modifiable.GetObject().backgroundImage&&(this.Modifiable&&this.Modifiable.GetObject().clearImage(),c=!0);g||(!this._CanvasNode||c?(this._ReBuildCanvasNodeTexture(e),t=!0):h&&(this._CanvasNodeTexture._requestRedraw(),this._HighlightCanvasNodeTexture._requestRedraw(),this.ExperienceBase.getManager("VCXContextManager").renderAll())),this.handleLayers(t)},getDocID(){let e=null;const t=this.GetPropertyValue("Collab.PIP.Scenario.ID");if(t){const i=this.ExperienceBase.getManager("VCXScenarioManager").GetScenarios()[t];if(i){const t=i.GetPIPDocId&&i.GetPIPDocId();t.docID>=0&&(this._scenarioDocTS!==t.timeStamp&&(this._previousBackgroundDocID=-1,this._scenarioDocTS=t.timeStamp),e=t.docID)}}return null!=(e=e||this.GetPropertyValue("Collab.Image.Doc.ID"))&&this.GetPropertyGroupVisibility("Group.Image")||(e=-1),e},_computePanelCenterMM:function(e){var t=this.Modifiable,i=null,r=this.GetShapeInfo().smartNode.BillboardType===o.EBillboardType.Spherical;switch(this.GetShapeInfo().smartNode.PositioningType){case o.EPositionType.Free3D:if(!r)return;var a=this._ExperienceBase.getManager("VCXContextManager").getMainViewer(),n=this.GetShapeInfo().smartNode.Position,s=t.QueryInterface("W3AISGNodeHolder").getPositionInWCS(a,n),l=this._ExperienceBase.getManager("VCXPaperManager"),p={viewer:a,viewpoint:a.currentViewpoint},u=l.ModelToMM2(p,s);i=new d.Vector2(u.x,u.y);break;case o.EPositionType.RelativeToReferential:l=this.ExperienceBase.getManager("VCXPaperManager");var h=(new d.Vector3).getPositionFromMatrix(this.GetShapeInfo().smartNode.GetReferential(e)),c=l.GetModelPointFromModelPointAndPaperPosition(e,h,this.GetShapeInfo().smartNode.Position2D,this.GetShapeInfo().smartNode.PositionRadius);i=l.ModelToMM2(e,c);break;default:var y=t.GetPropertyValue("Collab.3D.Paper.Paper.Position.X"),C=t.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y");i=new d.Vector2(y,C)}return i.x+=this.GetShapeInfo().center.x,i.y+=this.GetShapeInfo().center.y,i},_getPanelBoundsMM:function(e){var t=this._computePanelCenterMM(e);if(t){this.GetShapeInfo().centerInPaper=t;var i=this.GetShapeInfo().size.x,r=this.GetShapeInfo().size.y;return{center:t,left:t.x-.5*i,right:t.x+.5*i,top:t.y-.5*r,bottom:t.y+.5*r}}}})}),define("DS/VCXWebDressup/VCXLabelSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXPanelNode"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Label",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_LabelLeaf.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXCalloutSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXPanelNode"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Callout",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_CalloutLeaf.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXMeasurementSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXPanelNode"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Measurement",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_LabelLeaf.png")}return this._parent()},getWorldMatrix:function(e){return this.GetObject().getReferential()}})}),define("DS/VCXWebDressup/VCXCameraNode",["DS/Mesh/MeshUtils","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebDressup/VCXDressupNode","DS/VCXWebDressup/VCXExtremityNode","DS/VCXWebDressup/VCXSmart3DPaperNode","DS/VCXWebSystem/VCXMathTools","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/VCXWebDressup/VCXMarkup_Spec"],function(e,t,i,r,o,a,n,s,l,p){"use strict";return i.extend({init:function(e){return this._parent(e),this._Node=null,this},_getPosVectArray:function(){if(!this.matrixAndDOI){var e=this.Modifiable.QueryInterface("VCXIViewpointController");if(!e)return;this.matrixAndDOI=e.getMatrixAndDOI()}var t=[],i=-this.matrixAndDOI.doi,r=Math.abs(Math.tan(Math.PI*this.GetPropertyValue("Camera.Angle")/360)*i),o=1,a=this.Modifiable.ExperienceBase.getManager("VCXPaperManager");a&&(o=a.Ratio);var s=r/o,l=new n.Vector3(0,0,0);t.push(l);var p=new n.Vector3(0,0,-this.matrixAndDOI.doi);t.push(p);var u=new n.Vector3(-s,r,i);t.push(u);var h=new n.Vector3(s,r,i);t.push(h);var d=new n.Vector3(-s,-r,i);t.push(d);var c=new n.Vector3(s,-r,i);return t.push(c),t},_ComputePosBuffer:function(e){var t=this._getPosVectArray();if(!(Array.isArray(t)&&t.length>0))return t;for(var i=t.length,r=0;r<i;r++)e[3*r+0]=t[r].x,e[3*r+1]=t[r].y,e[3*r+2]=t[r].z;return i},dispose:function(){this._CameraBodyNode&&(this._CameraBodyNode.dispose(),this._CameraBodyNode=null),this._targetExtremityNode&&(this._targetExtremityNode.dispose(),this._targetExtremityNode=null),this._parent()},_Build:function(i){if(this._Node||(this._Node=new s,this.add(this._Node)),!this._FrustrumNode&&this.GetPropertyGroupVisibility("Group.Collab.Gizmo")){var a=this._getPosVectArray(),u=new Uint16Array([0,1,0,2,0,3,0,4,0,5,2,3,3,5,5,4,4,2]),h={type:t.ELineType.Plain,lineWidth:1,color:(new n.Color).setRGB(1,1,1)};this._lineMaterial=this.ExperienceBase.getManager("VCXMaterialManager").getLineMaterialFromParams(h,this._lineMaterial);var d={points:a,idx:u,editable:!0,drawMode:e.ConnectivityTypeEnum.LINES,material:this._lineMaterial};this._FrustrumNode=l.createLineNode(d),this._FrustrumNode.setVisibilityInTree(!1),this._FrustrumNode.setPickParent(!0),this._Node.addChild(this._FrustrumNode)}if(!this._targetExtremityNode&&this.GetPropertyGroupVisibility("Group.Collab.Gizmo")){var c={name:"TargetExtremity",modifiable:this.Modifiable,type:p.EExtremityType.Dot};this._targetExtremityNode=new r(c),this.add(this._targetExtremityNode)}if(!this._CameraBodyNode){this._bodyMat=new n.MeshLambertMaterial({side:n.DoubleSide}),this._bodyMat.force=!0;var y=l.createCuboidNode({cornerPoint:new n.Vector3(-8,-10,0),firstAxis:new n.Vector3(16,0,0),secondAxis:new n.Vector3(0,20,0),thirdAxis:new n.Vector3(0,0,40)}),C=l.createCuboidNode({cornerPoint:new n.Vector3(-8.1,-8,5),firstAxis:new n.Vector3(16.2,0,0),secondAxis:new n.Vector3(0,16,0),thirdAxis:new n.Vector3(0,0,30),material:this._bodyMat}),m=l.createCuboidNode({cornerPoint:new n.Vector3(-5,-5,-10),firstAxis:new n.Vector3(10,0,0),secondAxis:new n.Vector3(0,10,0),thirdAxis:new n.Vector3(0,0,20)}),f=l.createCylinderNode({bottomCenterPoint:new n.Vector3(-4,20,30),topCenterPoint:new n.Vector3(4,20,30),radius:9,sag:16,material:this._bodyMat}),V=l.createCylinderNode({bottomCenterPoint:new n.Vector3(-4,20,10),topCenterPoint:new n.Vector3(4,20,10),radius:9,sag:16,material:this._bodyMat});c={name:"CameraBodyNode",experience:this.ExperienceBase,type:this._type};this._CameraBodyNode=new o(c),this._CameraBodyNode.SizeControlType=1,this._CameraBodyNode.ScalingFactor=.2,this._CameraBodyNode.addChild(y),this._CameraBodyNode.addChild(C),this._CameraBodyNode.addChild(m),this._CameraBodyNode.addChild(f),this._CameraBodyNode.addChild(V),this.add(this._CameraBodyNode),this._CameraBodyNode.SetReferential(new n.Matrix4)}},preRender:function(e){var t=!1;if(this._Node){var i=a.getOFromMatrix(this._Node.getMatrix()).sub(e.viewpoint.getEyePosition());t=100*i.length()>this.matrixAndDOI.doi&&i.dot(e.viewpoint.getSightDirection())>0&&this._visible,this._Node.setVisibility(t)}this.setVisibility(t),t&&(this._CameraBodyNode&&this._CameraBodyNode.preRender(e),this._targetExtremityNode&&this._targetExtremityNode.preRender(e))},update:function(t){this._parent();var i=this.ExperienceBase.getManager("VCXContextManager"),r=i&&i.isSupported("3DSync");if(!this._Node&&r){var o=this.Modifiable.QueryInterface("W3AISGNodeHolder");if(o){var s=o.getPathElement();s&&(this._Node=s.getLastElement())}}var l=this.GlobalOpacity;if(this._globalOpacity!==l&&(this._globalOpacity=l,this._visible=this._globalOpacity>0,this._visible&&(this._Node||this._Build()),this.setVisibility(this._visible),this._Node&&this._Node.setVisibility(this._visible)),!(this._globalOpacity<=0)){this._Node||this._Build();var p=this.Modifiable.QueryInterface("VCXIViewpointController");if(p){if(this.matrixAndDOI=p.getMatrixAndDOI(),this._FrustrumNode&&this.GetPropertyGroupVisibility("Group.Collab.Gizmo")){var u=this._FrustrumNode.getBuffer(e.VertexComponentEnum.POSITION);if(void 0!==u){var h=this._ComputePosBuffer(u);this._FrustrumNode.updateBuffer(e.VertexComponentEnum.POSITION,0,h),this._FrustrumNode.computeBoundingElements()}}else this._targetAxisSystemNode&&(this._Node.remove(this._targetAxisSystemNode),this._targetAxisSystemNode=null),this._positionAxisSystemNode&&(this._Node.remove(this._positionAxisSystemNode),this._positionAxisSystemNode=null);this._FrustrumNode&&this._FrustrumNode.setVisibility(this.GetPropertyGroupVisibility("Group.Collab.Gizmo")),this._targetExtremityNode&&this._targetExtremityNode.setVisibility(this.GetPropertyGroupVisibility("Group.Collab.Gizmo"));var d=this.matrixAndDOI.matrix;if(r&&(d=(new n.Matrix4).multiplyMatrices(d,(new n.Matrix4).makeRotationY(.5*-Math.PI))),this._Node.setMatrix(d),this._CameraBodyNode&&this._CameraBodyNode.SetReferential(this.matrixAndDOI.matrix),this._targetExtremityNode&&this._targetExtremityNode.update(t),this._positionAxisSystemNode){var c=(new n.Matrix4).getInverse(this.matrixAndDOI.matrix),y=(new n.Matrix4).multiplyMatrices(c,this.GetAnchorWorldMatrix(1,null));this._positionAxisSystemNode.setMatrix(y),this._positionAxisSystemNode.setNoZ(this.GetPropertyValue("Actor.IsAlwaysOnTop"))}if(this._targetAxisSystemNode){c=(new n.Matrix4).getInverse(this.matrixAndDOI.matrix),y=(new n.Matrix4).multiplyMatrices(c,this.GetAnchorWorldMatrix(2,null));this._targetAxisSystemNode.setMatrix(y),this._targetAxisSystemNode.setNoZ(this.GetPropertyValue("Actor.IsAlwaysOnTop"))}if(this._targetExtremityNode&&this._targetExtremityNode.SetReferential(a.getMatrixFromOVx(this.matrixAndDOI.target,a.getVzFromMatrix(this.matrixAndDOI.matrix))),this._bodyMat){var C=this.GetColorPropertyValue("Actor");this._bodyMat.color=C.GetThreeColor(),this._bodyMat.opacity=this._globalOpacity,this._bodyMat.opacity*=C.a}if(this._lineMaterial){var m=this.GetColorPropertyValue("Collab.Gizmo.Line");this._lineMaterial.color=m.GetThreeColor(),this._lineMaterial.opacity=this._globalOpacity*m.a,this._lineMaterial.setLineWidth(this.GetPropertyValue("Collab.Gizmo.Line.Width"))}this.handleLayers()}}}})}),define("DS/VCXWebDressup/VCXCameraSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXCameraNode"],function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){var e={name:"Camera",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Camera.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXDiggerPanelNode",["DS/CoreEvents/Events","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebDressup/VCXPanelNode","DS/VCXWebGUIInfra/VCXArcBar","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebKernel/VCXCmdChangeSelection","DS/WebappsUtils/WebappsUtils","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup"],function(e,t,i,r,o,a,n,s){"use strict";return i.extend({init:function(e){return this._parent(e),this},dispose:function(){this.deleteDiggerPanelToolbar()},isDiggerPanel:function(e){return!!(void 0===e?this.Modifiable:e.QueryInterface("VCXIModifiable")).GetPropertyValue("Collab.AssociatedObjectID")},_Build:function(){this._parent(),this.isDiggerPanel()&&this.createDiggerPanelToolbar()},preRender:function(e){if(this._isVisible&&(this._parent(e),this.isDiggerPanel()&&this._toolbar&&this._toolbar.isVisible())){var t=this.Modifiable.QueryInterface("VCXIManipulable");t&&this._toolbar.setInManipulation(t.isManipulated());var i=this.calcToolbarInfo();this._toolbar.updateLayout(i.centerPx,i.radiusPx),this._toolbar.updateVisibilityStyle()}return!1},update:function(e){var t=this._isVisible;this._parent(e),t!==this._isVisible&&this.isDiggerPanel()&&this._toolbar&&(this._toolbar.setVisible(this._isVisible),this._toolbar.updateVisibilityStyle())},addDiggerPanelEvents:function(){this._WUXEventTokens={};var t=this,i=function(e,i){if(t._toolbar&&t._isVisible)for(var r=0;r<i.length;++r){if(i[r]===t.Modifiable.GetObject()){t._toolbar.setSelected(e),t._toolbar.updateVisibilityStyle();break}}};this._WUXEventTokens.VCX_SELECTION_ADD=e.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},function(e){i(!0,e)}),this._WUXEventTokens.VCX_SELECTION_REMOVE=e.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},function(e){i(!1,e)})},removeDiggerPanelEvents:function(){for(var t in this._WUXEventTokens)this._WUXEventTokens.hasOwnProperty(t)&&this._WUXEventTokens[t]&&(e.unsubscribe(this._WUXEventTokens[t]),this._WUXEventTokens[t]=null)},calcToolbarInfo:function(){var e={},t=this.ExperienceBase.getManager("VCXPaperManager"),i=t.GetMmToPxRatio();e.radiusPx=(i*this.GetShapeInfo().size.x+32)/2+5;var r=this.GetShapeInfo().centerInPaper;e.centerPx={x:i*r.x,y:i*r.y};var o=t._ViewBoxPx;return e.centerPx.x+=o.x,e.centerPx.y+=o.y,e},createDiggerPanelToolbar:function(){if(!this._toolbar){var e=this._ExperienceBase.getManager("VCXContextManager");if(!e.getExperienceIn3DPlay()){var t=this.calcToolbarInfo(),i=this;this._toolbar=new r({experienceBase:this._ExperienceBase,body:e.getUIFrame(),frmWindow:e.getFrameWindow(),title:"Digger Panel",actionBar:e.getActionBar(),heightElem:22,widthElem:22,padding:2,updateOpacity:!1,startAngle:50,clockwise:!1,center:t.centerPx,radius:t.radiusPx,lJsonElement:[{nls:s["DiggerPanel.Update"],url:n.getWebappsAssetUrl("VCXWebDressup","icons/I_VCX_DiggerPanel_Update.png"),id:"id_1",type:"element",callback:function(e){i.reliveDiggers(!0)}},{nls:s["DiggerPanel.Relive"],url:n.getWebappsAssetUrl("VCXWebDressup","icons/I_VCX_DiggerPanel_Relive.png"),id:"id_2",type:"element",callback:function(e){i.reliveDiggers(!1)}}]}),this.addDiggerPanelEvents()}}},deleteDiggerPanelToolbar:function(){this.removeDiggerPanelEvents(),this._toolbar&&(this._toolbar.clear(),this._toolbar=null)},reliveDiggers:function(e){var t=this._ExperienceBase.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO"),i=this.Modifiable.GetObject();t.includes(i)||t.push(i);for(var r=0;r<t.length;++r){i=t[r];if(this.isDiggerPanel(i)){var o=i.QueryInterface("W3AISGNodeHolder");if(o){var a=o.getSGNode();a&&a.reliveDigger(e,i)}}}},reliveDigger:function(e,i){var r,n=(r=void 0===i?this.Modifiable:i.QueryInterface("VCXIModifiable")).GetPropertyValue("Collab.AssociatedObjectID");if(n){var s=this._ExperienceBase.ComponentsMap.GetComponentFromID(n);if(s){var l=r.GetObject().QueryInterface("VCXIVisibility");l&&l.SetVisibility(o.EVisState.Hidden),!e&&this._toolbar&&this._toolbar.setVisible(!1);var p=s.QueryInterface("W3AISGNodeHolder");if(p){var u=p.getSGNode();if(u){var h=this.GetShapeInfo(),d=this.Modifiable.GetPropertyValue("Collab.Attach.Show")&&this.Modifiable.GetPropertyValue("Collab.Attach.LeadType")!==t.ELeadType.None,c=Object.keys(this.Anchors)[0],y=this.Modifiable.GetAnchorWorldMatrix(c,null);if(u.SetPropertiesFromPanel(h,d,y),e)(C=s.QueryInterface("VCXIVisibility"))&&C.SetVisibility(o.EVisState.Visible),this.ExperienceBase.webApplication.runloop.func.apply(this.ExperienceBase.webApplication.runloop.data,[{time:1,deltaTime:1}]),u.createSnapshot2D(!1),C&&C.SetVisibility(o.EVisState.Hidden)}}if(!e){var C;(C=s.QueryInterface("VCXIVisibility"))&&C.SetVisibility(o.EVisState.Visible);var m=new a(this.ExperienceBase.getManager("VCXSelectionManager"));m.SetSelection(s),this.ExperienceBase.getManager("VCXCommandManager").Do(m)}}}},onDoubleClick:function(){this.isDiggerPanel()&&this.reliveDigger(!1)}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShapeBottomAndLeft",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools"],function(e,t,i){"use strict";return e.extend({rewind:function(){this._parent(),this.iSwap=0,this.iPariteX=0,this.iPariteY=0,this.fX=0,this.dx=0,this.fY=this.fHalfSizeY-this.fCellSize,this.fY<0&&(this.fY=0),this.maxfx=this.fHalfSizeX-this.fCellSize-this.fCellSize,this.LRiPariteX=0,this.LRiPariteY=0,this.LRfX=this.fHalfSizeX-this.fCellSize,this.LRfX<0&&(this.LRfX=0),this.LRdy=0,this.LRfY=0,this.LRmaxfy=this.fHalfSizeY-this.fCellSize},next:function(){if(this._parent(),this.iSwap++,1&this.iSwap){if(this.LRiPariteY++,2===this.LRiPariteY&&(this.LRiPariteY=0,this.LRfY+=this.fCellSize,this.LRfY>this.fHalfSizeY-this.fCellSize&&(0===this.LRdy?this.LRdy=.5*this.fCellSize:this.LRdy=0,this.LRfY=0,this.LRfX-=this.fCellSize,this.LRfX<this.fCellSize)))return this.rewind(),!0}else if(0==this.fX&&this.iPariteX++,this.iPariteX++,2===this.iPariteX&&(this.iPariteX=0,this.fX+=this.fCellSize,this.fX>this.maxfx&&(this.maxfx-=this.fCellSize,this.maxfx<this.fCellSize&&(this.maxfx=this.fCellSize),0===this.dx?this.dx=.5*this.fCellSize:this.dx=0,this.fX=0,this.fY-=this.fCellSize,this.fY<this.fCellSize)))return this.rewind(),!0;return!1},getPoint:function(){var e=new t.Vector2;return 1&this.iSwap?(e.x=this.fHalfSizeX-this.LRfX,1&this.LRiPariteY?e.y=this.fHalfSizeY-this.LRfY+this.LRdy:e.y=this.fHalfSizeY+this.LRfY+this.LRdy):(1&this.iPariteX?e.x=this.fHalfSizeX-this.fX+this.dx:e.x=this.fHalfSizeX+this.fX+this.dx,e.y=this.fHalfSizeY+this.fY),e}})}),define("DS/VCXWebDressup/VCXPanelModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebDressup/VCXMarkupModifiable","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebDressup/VCXPanel_Spec","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueLink","DS/VCXWebProperties/VCXPropertyValueString"],function(e,t,i,r,o,a,n,s,l){"use strict";return t.extend({init:function(){this._bIsPanel=!0,this._parent()},Build:function(){this._parent();var e=[{Name:"Collab.Markup.SubType",DefaultValue:r.ESubType.None},{Name:"Collab.Text.Show",DefaultValue:!1,FormatPainter:!0},{Name:"Collab.Text.Wordwrap",DefaultValue:!0},{Name:"Collab.Text.HAlignment",DefaultValue:i.EHTextAlignment.Justified,FormatPainter:!0},{Name:"Collab.Text.VAlignment",DefaultValue:i.EVTextAlignment.Top,FormatPainter:!0},{Name:"Collab.Body.InnerMargin",DefaultValue:0,FormatPainter:!0},{Name:"Collab.Body.Shape",DefaultValue:i.EBodyShape.Rectangle,FormatPainter:!0},{Name:"Collab.Body.Width",DefaultValue:100},{Name:"Collab.Body.Height",DefaultValue:100},{Name:"Collab.Border.Show",DefaultValue:!1,FormatPainter:!0},{Name:"Collab.Background.Show",DefaultValue:!1,FormatPainter:!0},{Name:"Collab.Image.Show",DefaultValue:!0},{Name:"Collab.Attach.Show",DefaultValue:!0,FormatPainter:!0},{Name:"Collab.3D.Paper.Billboard.Type",DefaultValue:2},{Name:"Collab.3D.Paper.Referential.In.World",DefaultValue:!1},{Name:"Collab.3D.Paper.Size.Control.Type",DefaultValue:1},{Name:"Actor.IsAlwaysOnTop",DefaultValue:!0,FormatPainter:!0},{Name:"Collab.Body.VAlignment",DefaultValue:i.EVAlignment.Bottom,visibleInPropertyGroups:!1},{Name:"Collab.3D.Paper.Positioning.Type",DefaultValue:i.EPositionType.Free2D},{Name:"Collab.UseDepthFromAnchor",Type:n,DefaultValue:!1,visibleInPropertyGroups:!1,Persistent:!1}];this._BuildPropertyValues(e)},SetPropertiesInfo:function(){this._parent(),this.SetPropertyInvisible("Collab.3D.Paper.Positioning.Type",!0),this.GetPropertyValue("Collab.Markup.SubType")===r.ESubType.Image||this.GetPropertyValue("Collab.Markup.SubType")===r.ESubType.Text?(this.SetPropertyInvisible("Collab.Image.Color",!0),this.SetPropertyInvisible("Collab.Image.Color.Opacity",!0),this.SetPropertyInvisible("Collab.Image.Scale",!0),this.ChangeGroupAvailability("Group.Attach",e.EAvailability.AppForceNotAvailable),this.GetPropertyValue("Collab.Markup.SubType")===r.ESubType.Image&&(this.SetPropertyInvisible("Collab.Text",!0),this.ChangeGroupAvailability("Group.Text",e.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Background",e.EAvailability.AppForceNotAvailable),this.ChangeGroupAvailability("Group.Image",e.EAvailability.NoControl))):(this.ChangeGroupAvailability("Group.Image",e.EAvailability.NoControl),this.ChangeGroupAvailability("Group.Attach",e.EAvailability.NoControl))},Set2DPanelProperties:function(e,t,r,p){var u=new o(e);this.OnChangeProperty("Collab.Markup.SubType",u);var h=new n(!1);if(this.OnChangeProperty("Collab.Body.FitToText",h),this._Properties["Collab.Text.Font"].GetPropertyValue().SetHeight(new a(30)),this.OnChangeProperty("Collab.Background.Show",new n(!0)),this.OnChangeProperty("Collab.Background.Color.Opacity",new a(.5)),this.OnChangeProperty("Collab.Image.Show",new n(Boolean(t||p))),this.OnChangeProperty("Collab.Text.Show",new n(!t&&!p)),t&&this.OnChangeProperty("Collab.Image.Doc.ID",t),p&&this.OnChangeProperty("Collab.PIP.Scenario.ID",new s(p)),r){var d=new n(!0);this.OnChangeProperty("Collab.Text.Show",d);var c=new l(r);this.OnChangeProperty("Collab.Text",c);var y=new a(2);this.OnChangeProperty("Collab.Body.InnerMargin",y)}this.OnChangeProperty("Collab.Body.KeepAspectRatio",new n(!1));var C=new n(!1);this.OnChangeProperty("Collab.Attach.Show",C);var m=new o(2);this.OnChangeProperty("Collab.3D.Paper.Billboard.Type",m);var f=new o(1);this.OnChangeProperty("Collab.3D.Paper.Size.Control.Type",f);var V=new o(1e3);this.OnChangeProperty("Collab.3D.Paper.Positioning.Type",V);var b=new a(this.GetObject()._experienceBase.getManager("VCXDressupManager").GetDepthInformation().highest+1);this.OnChangeProperty("Collab.3D.Paper.Depth",b),p&&(this.OnChangeProperty("Collab.Body.HAlignment",new a(i.EHAlignment.Center)),this.OnChangeProperty("Collab.Body.VAlignment",new a(i.EVAlignment.Middle))),this.OnChangeProperty("Collab.Body.Width",new a(40)),this.OnChangeProperty("Collab.Body.Height",new a(30)),this.OnChangeProperty("Collab.Body.Shadow.Show",new n(!0))}})}),define("DS/VCXWebDressup/VCXDiggerPanelModifiable",["DS/VCXWebDressup/VCXDressupModifiable","DS/VCXWebDressup/VCXPanelModifiable","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebDressup/VCXPanel_Spec"],function(e,t,i,r){"use strict";return t.extend({init:function(){this._parent()},Build:function(){this._parent();var t=[{Name:"Collab.AssociatedObjectID",Type:i,DefaultValue:""},{Name:"Collab.Attach.Availability",DefaultValue:e.EAvailability.NoControl},{Name:"Collab.Markup.SubType",DefaultValue:r.ESubType.Image}];this._BuildPropertyValues(t),this.SetPropertyInvisible("Collab.AssociatedObjectID",!0)},SetPropertiesInfo:function(){this._parent(),this.ChangeGroupAvailability("Group.Attach",e.EAvailability.NoControl),this.SetPropertyInvisible("Collab.Image.Color",!1),this.SetPropertyInvisible("Collab.Image.Color.Opacity",!1)}})}),define("DS/VCXWebDressup/VCXDressupOrganisationShapeRight",["DS/VCXWebDressup/VCXDressupOrganisationShape","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools"],function(e,t,i){"use strict";return e.extend({rewind:function(){this._parent(),this.iPariteY=0,this.fX=this.fHalfSizeX-this.fCellSize,this.fX<0&&(this.fX=0),this.dy=0,this.fY=0},next:function(){return this._parent(),0===this.fY&&this.iPariteY++,this.iPariteY++,2===this.iPariteY&&(this.iPariteY=0,this.fY+=this.fCellSize,this.fY>this.fHalfSizeY-this.fCellSize&&(0===this.dy?this.dy=.5*this.fCellSize:this.dy=0,this.fY=0,this.fX-=this.fCellSize,this.fX<-this.fHalfSizeX+this.fCellSize))&&(this.rewind(),!0)},getPoint:function(){var e=new t.Vector2;return e.x=this.fHalfSizeX+this.fX,1&this.iPariteY?e.y=this.fHalfSizeY-this.fY+this.dy:e.y=this.fHalfSizeY+this.fY+this.dy,e}})}),define("DS/VCXWebDressup/VCXPanelSGNodeHolder",["DS/VCXWebDressup/VCXDressupSGNodeHolder","DS/VCXWebDressup/VCXPanelNode"],function(e,t){"use strict";return e.extend({init:function(){this._parent()},buildSGNode:function(){if(!this._sgNode){var e={name:"Panel",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Image2DLeaf.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXDiggerPanelSGNodeHolder",["DS/VCXWebDressup/VCXPanelSGNodeHolder","DS/VCXWebDressup/VCXDiggerPanelNode"],function(e,t){"use strict";return e.extend({init:function(){},unreferenceSGNode:function(){this._sgNode&&(this._sgNode.dispose(),delete this._sgNode)},buildSGNode:function(){if(!this._sgNode){var e={name:"Panel",modifiable:this.GetObject().QueryInterface("VCXIModifiable")};this._sgNode=new t(e),this._sgNode.setIcon("../VCXWebDressup/assets/icons/32/I_VCX_Panel_Tree_Image2DLeaf.png")}return this._parent()}})}),define("DS/VCXWebDressup/VCXDressupOrganisationManager",["UWA/Class","DS/VCXWebDressup/VCXMarkup_Spec","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools","DS/VCXWebDressup/VCXDressupOrganisationShapePerimetric","DS/VCXWebDressup/VCXDressupOrganisationShapeCircle","DS/VCXWebDressup/VCXDressupOrganisationShapeRectangle","DS/VCXWebDressup/VCXDressupOrganisationShapeBottom","DS/VCXWebDressup/VCXDressupOrganisationShapeBottomAndLeft","DS/VCXWebDressup/VCXDressupOrganisationShapeBottomAndRight","DS/VCXWebDressup/VCXDressupOrganisationShapeBottomAndTop","DS/VCXWebDressup/VCXDressupOrganisationShapeTop","DS/VCXWebDressup/VCXDressupOrganisationShapeTopAndLeft","DS/VCXWebDressup/VCXDressupOrganisationShapeTopAndRight","DS/VCXWebDressup/VCXDressupOrganisationShapeLeft","DS/VCXWebDressup/VCXDressupOrganisationShapeLeftAndRight","DS/VCXWebDressup/VCXDressupOrganisationShapeRight","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXColor","DS/VCXWebVisibility/VCXIVisibility"],function(e,t,i,r,o,a,n,s,l,p,u,h,d,c,y,C,m,f,V,b,P){"use strict";var g=e.extend({setExperienceBase:function(e){this._experienceBase=e},_checkIfCellFree:function(e,t,i,r){for(var o=t-r-1;o<t+r;o++)for(var a=i-r-1;a<i+r;a++){if(!(a>0&&a<e.height&&o>0&&o<e.width))return!1;var n=(e.height-a)*e.width+o;if(n*=4,0!==e.data[n+0]||0!==e.data[n+1]||0!==e.data[n+2]||255!==e.data[n+3])return!1}return!0},_flagCellBusy:function(e,t,i,r){for(var o=t-r-1;o<t+r;o++)for(var a=i-r-1;a<i+r;a++)if(a>0&&a<e.height&&o>0&&o<e.width){var n=(e.height-a)*e.width+o;n*=4,e.data[n+0]=1,e.data[n+1]=1,e.data[n+2]=1,e.data[n+3]=1}},_findFirstCellCandidatePerimetric:function(e,t){for(var i=this._experienceBase.getManager("VCXPaperManager").Size,r=Math.floor(t.leadGridPositionInMM.x*e.width/i.x),o=Math.floor(t.leadGridPositionInMM.y*e.height/i.y),a=0,n=0,s=1;s<Math.max(e.width,e.height);s++){for(a=Math.max(0,r-s);a<Math.min(e.width,r+s);a++){n=Math.max(0,o-s);if(this._checkIfCellFree(e,a,n))return{col:a,row:n};if(n=Math.min(e.height,o+s),this._checkIfCellFree(e,a,n))return{col:a,row:n}}for(n=Math.max(0,o-s-1);n<Math.min(e.height,o+s-1);n++){a=Math.max(0,r-s);if(this._checkIfCellFree(e,a,n))return{col:a,row:n};if(a=Math.min(e.width,r+s),this._checkIfCellFree(e,a,n))return{col:a,row:n}}}},autoAlignDressups:function(e){var f=this._experienceBase.getManager("VCXDressupManager");if(this._dressupsToAlign=f._automaticAlignmentDressups,this._dressupsToAlign&&0!==this._dressupsToAlign.length){var V=this._experienceBase.getManager("VCXVisuManager"),b=this._experienceBase.getManager("VCXPaperManager"),g=b.Size,_=Math.round(256/g.x*g.y),S=V.getOccupationGrid(256,_,e.viewer);for(var M in this.organisationShapes||(this.organisationShapes={}),this.organisationShapes)this.organisationShapes.hasOwnProperty(M)&&(this.organisationShapes[M]._dressups=[],this.organisationShapes[M].rewind());if(S){const f=this._experienceBase.getManager("VCXContextManager").getActivePartList();if(f){var G=f.QueryInterface("VCXIVisibility");if(G&&G.GetVisibility()!==P.EVisState.Hidden){var D=f.QueryInterface("VCXIModifiable");if(D.GetPropertyValue("Actor.Opacity"))for(var x=D.GetPropertyValue("Collab.3D.Paper.Paper.Position.X"),v=D.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y"),A=D.GetPropertyValue("Collab.Body.Width"),X=D.GetPropertyValue("Collab.Body.Height"),I=Math.floor(x*S.width/g.x),T=Math.ceil((x+A)*S.width/g.x),w=Math.floor(v*S.height/g.y),N=Math.ceil((v+X)*S.height/g.y),E=I;E<=T;E++)for(var B=w;B<=N;B++){var L=(S.height-B)*S.width+E;L*=4,S.data[L+0]=1,S.data[L+1]=1,S.data[L+2]=1,S.data[L+3]=1}}}for(var O,R=0;R<this._dressupsToAlign.length;R++){var W=this._dressupsToAlign[R];W.leadAutoPosLock=!1,W.textAutoPosLock=!1;var F=W.shapeInfo&&W.shapeInfo.size&&W.shapeInfo.size.x||1;F/b.Size.x<.001&&(F=.01*b.Size.x);var k=W.QueryInterface("VCXIModifiable"),H=k.GetPropertyValue("Collab.3D.Paper.Positioning.Type");if(!(O=this.organisationShapes[H])){switch(H){case t.EPositionType.Perimetric:O=new o(g);break;case t.EPositionType.Circle:O=new a(g);break;case t.EPositionType.Rectangle:O=new n(g);break;case t.EPositionType.Bottom:O=new s(g);break;case t.EPositionType.BottomAndLeft:O=new l(g);break;case t.EPositionType.BottomAndRight:O=new p(g);break;case t.EPositionType.BottomAndTop:O=new u(g);break;case t.EPositionType.Top:O=new h(g);break;case t.EPositionType.TopAndLeft:O=new d(g);break;case t.EPositionType.TopAndRight:O=new c(g);break;case t.EPositionType.Left:O=new y(g);break;case t.EPositionType.LeftAndRight:O=new C(g);break;case t.EPositionType.Right:O=new m(g)}this.organisationShapes[H]=O,O&&(O.fCellSize=1.5*F,O.rewind())}if(O&&(O.fCellSize=1.5*F,H===t.EPositionType.Perimetric&&O.rewind(),O._dressups||(O._dressups=[]),O._dressups.push(W)),k.processAnchorsIDs(function(t){if("Location"!==t){var o=r.getOFromMatrix(k.GetAnchorWorldMatrix(t,e)),a=b.ModelToMM2(e,o);W.leadGridPositionInMM=new i.Vector2(a.x,a.y);var n=Math.floor(W.leadGridPositionInMM.x*S.width/g.x),s=Math.floor(W.leadGridPositionInMM.y*S.height/g.y),l=(S.height-s)*S.width+n;l*=4,S.data[l+0]=1,S.data[l+1]=1,S.data[l+2]=1,S.data[l+3]=1}}),O){for(var z,U=!1,Y=!1;!U;){z=O.getPoint(W.leadGridPositionInMM);var j=Math.floor(z.x*S.width/g.x),Q=Math.floor(z.y*S.height/g.y),q=Math.floor(.5*F*g.x/S.width);(U=Y||this._checkIfCellFree(S,j,Q,q))&&this._flagCellBusy(S,j,Q,q),O.next()&&(Y=!0)}W.textGridPositionInMM=z}}}for(var M in this.organisationShapes)this.organisationShapes.hasOwnProperty(M)&&(this.organisationShapes[M]&&0!==this.organisationShapes[M]._dressups.length||delete this.organisationShapes[M]);this._uncrossLinks(e)}},_locateCallout:function(e,t,i){var r=e.QueryInterface("W3AISGNodeHolder");if(r){var o=r.getSGNode();o&&o._Smart3DPaperNode&&o._Smart3DPaperNode.Position2D.copy(t)}var a=e.QueryInterface("VCXIModifiable");if(a){var n=!1;if(t.x!==a.GetPropertyValue("Collab.3D.Paper.Paper.Position.X")){n=!0;var s=new f(t.x);a.OnChangeProperty("Collab.3D.Paper.Paper.Position.X",s)}if(t.y!==a.GetPropertyValue("Collab.3D.Paper.Paper.Position.Y")){n=!0;var l=new f(t.y);a.OnChangeProperty("Collab.3D.Paper.Paper.Position.Y",l)}n&&(a.OnChangePropertiesEnd(),o.update(i))}},_uncrossLinks:function(e){for(var t in this.organisationShapes)if(this.organisationShapes.hasOwnProperty(t)){var i=this.organisationShapes[t],r=i._dressups.length;i._squareDistances&&i._squareDistances.length===r*r||(i._squareDistances=new Array(r*r));for(var o=0;o<r;o++){var a=i._dressups[o];a.leadSector=0,a.textSector=0;for(var n=0;n<r;n++){var s=i._dressups[n];if(s&&s.leadGridPositionInMM){s.leadSector=0,s.textSector=0;var l=o*r+n,p=s.leadGridPositionInMM.distanceToSquared(a.textGridPositionInMM);i._squareDistances[l]={textComponent:a,textSector:0,leadComponent:s,leadSector:0,squareDistance:p}}}}i._squareDistances.sort(function(e,t){return e.squareDistance-t.squareDistance}),this._splitSectorInto2Sectors(0,0,i,e)}},_splitSectorInto2Sectors:function(e,t,r,o){for(var a=0,n=0;n<e;n++)a|=1<<n;for(var s=r._squareDistances.length,l=new i.Vector2,p=new i.Vector2,u=!1,h=0;h<s&&!u;h++){var d=r._squareDistances[h];if(d&&!d.leadComponent.leadAutoPosLock&&!d.textComponent.textAutoPosLock&&t===(d.leadComponent.leadSector&a)&&t===(d.textComponent.textSector&a)){d.leadComponent.leadAutoPosLock=!0,d.textComponent.textAutoPosLock=!0,l.copy(d.leadComponent.leadGridPositionInMM).sub(d.textComponent.textGridPositionInMM);for(var c,y,C,m,f=0,V=0,b=0,P=1<<e,g=~P,_=r._dressups.length,S=0;S<_;S++){var M=r._dressups[S];M.leadAutoPosLock||t!==(M.leadSector&a)||(p.copy(M.leadGridPositionInMM).sub(d.textComponent.textGridPositionInMM),l.x*p.y>l.y*p.x?(f++,c=M,M.leadSector|=P):(b++,y=M,M.leadSector&=g)),M.textAutoPosLock||t!==(M.textSector&a)||(p.copy(M.textGridPositionInMM).sub(d.textComponent.textGridPositionInMM),l.x*p.y>l.y*p.x?(V++,C=M,M.textSector|=P):(0,m=M,M.textSector&=g))}f===V?(u=!0,this._locateCallout(d.leadComponent,d.textComponent.textGridPositionInMM,o),f>1?this._splitSectorInto2Sectors(e+1,t|P,r,o):1===f&&C&&c&&this._locateCallout(c,C.textGridPositionInMM,o),b>1?this._splitSectorInto2Sectors(e+1,t,r,o):1===b&&m&&y&&this._locateCallout(y,m.textGridPositionInMM,o)):(d.leadComponent.leadAutoPosLock=!1,d.textComponent.textAutoPosLock=!1,d=null)}}u||console.warn("No candidate found")}});return Object.defineProperty(g.prototype,"componentType",{enumerable:!0,get:function(){return"VCXDressupOrganisationManager"}}),g}),define("DS/VCXWebDressup/VCXDressupManager",["DS/CoreEvents/Events","DS/VisuEvents/EventsManager","UWA/Class","DS/VCXWebDressup/VCXDressupOrganisationManager","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebModifiables/VCXModelChangeListener","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXMathTools","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebVisu/VCXModifiablesAccess","DS/VCXWebProperties/VCXPropertyValueString","DS/Mesh/MeshUtils","DS/VCXWebExperienceBase/VCXPathElementTools","DS/SceneGraphOverrides/SceneGraphOverrideSet","i18n!DS/VCXWebDressup/assets/nls/VCXWebDressup"],function(e,t,i,r,o,a,n,s,l,p,u,h,d,c,y){"use strict";var C=i.extend({initialize:function(){this._calloutMaxWidth=0,this._DressupRoot=null,this._DressupComponents={},this._DressupGrpsComponents=null,this._DressupVisibilityHasChanged=!0,this._autoAlignmentDirty=!1,this._DressupComponentsToPreRender={},this._DressupSectionsToPreRender={},this._DressupComponentsToPostRender={},this.event_VCX_ROOT_COMPONENT_CREATED=e.subscribe({event:"VCX_ROOT_COMPONENT_CREATED"},function(){this.createDressupsBases()}.bind(this)),this.event_VCX_PROPERTIES_CHANGED=e.subscribe({event:"VCX_PROPERTIES_CHANGED"},function(){this.SetDirty()}.bind(this))},postInitialize:function(){this._currentWorkingRootMatrix=new n.Matrix4,this._experienceBase.getManager("VCXContextManager").loadCssFile("VCXWebDressup/VCXWebDressup.css",1);if(this._experienceBase.getManager("VCXContextManager").isSupported("ViewpointCamera")&&!this._experienceBase.ComponentsMap.GetComponentFromID("ViewpointID")){const e=this._experienceBase.Factory.BuildComponent("VCXViewpoint_Spec");this._experienceBase.ComponentsMap.AddComponent(e),e.SetID("ViewpointID"),e.SetPersistency(2)}if(this._experienceBase.getManager("VCXContextManager").isSupported("3DAlignerSupport")){let e=this._experienceBase.getManager("VCXVisuManager");e.load3DXMLModel("3DAligner_MagnetON",{module:"VCXWebAuthoringDressup",path:"models/VCX3DMagnetOn.3dxml",callBackCreation:e=>{var t=(new n.Matrix4).makeScale(.03,.03,.03);t.multiply((new n.Matrix4).makeRotationY(Math.PI/2)),e.setMatrix(t),e.setVisibilityInTree(!1)}}),e.load3DXMLModel("3DAligner_MagnetOFF",{module:"VCXWebAuthoringDressup",path:"models/VCX3DMagnetOff.3dxml",callBackCreation:e=>{var t=(new n.Matrix4).makeScale(.03,.03,.03);t.multiply((new n.Matrix4).makeRotationY(Math.PI/2)),e.setMatrix(t),e.setVisibilityInTree(!1)}})}},getDressupGroups:function(){return this._DressupGrpsComponents||(this._DressupGrpsComponents={},this._DressupGrpsComponents.Annotations=null,this._DressupGrpsComponents.Callouts=null,this._DressupGrpsComponents.Grids=null,this._experienceBase.getManager("VCXContextManager").isSupported("CameraDisplay")&&(this._DressupGrpsComponents.Cameras=null),this._experienceBase.getManager("VCXContextManager").isSupported("Section")&&(this._DressupGrpsComponents.Sections=null),this._DressupGrpsComponents.Diggers=null,this._DressupGrpsComponents.Markups=null,this._DressupGrpsComponents.Measurements=null,this._DressupGrpsComponents.Panels=null,this._DressupGrpsComponents.MagnetLine=null,this._experienceBase.getManager("VCXContextManager").isSupported("PartList")&&(this._DressupGrpsComponents.PartList=null),this._experienceBase.getManager("VCXContextManager").isSupported("Paths")&&(this._DressupGrpsComponents.Paths=null),this._experienceBase.getManager("VCXContextManager").isSupported("EnvironmentDisplay")&&(this._DressupGrpsComponents.Environment=null),this._DressupGrpsComponents.Ambiences=null,this._experienceBase.getManager("VCXContextManager").isSupported("ViewpointCamera")&&(this._DressupGrpsComponents.ViewpointCamera=null)),this._DressupGrpsComponents},SetDirty:function(){this.needUpdate=2},getUpdatePriority:function(){return-5},getInitPhase:function(){return 4},unInitialize:function(){this._DressupOrganisationManager=null,e.unsubscribe(this.event_VCX_ROOT_COMPONENT_CREATED),this.event_VCX_ROOT_COMPONENT_CREATED=null,e.unsubscribe(this.event_VCX_PROPERTIES_CHANGED),this.event_VCX_PROPERTIES_CHANGED=null;var t=this._experienceBase.getManager("VCXContextManager");for(var i in t.applyToViewers(function(e){delete e.dressupSGOS}),t.unloadCssFile("VCXWebDressup/VCXWebDressup.css",1),this.RemoveDressups(this._DressupComponents),this._DressupRoot&&(t.getMainViewer().removeNode(this._DressupRoot),this._DressupRoot=null),this._DressupComponents)this._DressupComponents[i].CallDispose();this._DressupComponents=null,this._DressupGrpsComponents=null,this._DressupComponentsToPreRender=null,this._DressupSectionsToPreRender=null,this._DressupComponentsToPostRender=null,this._automaticAlignmentDressups=null},CheckDressupIsAlignable:function(e){let t={modifiable:null,isAlignableValue:!1};if(e.IsKindOf("VCXMarkup_Spec")){const i=e.QueryInterface("VCXIVisibility");if(i&&i.GetVisibility()){const i=e.QueryInterface("VCXIModifiable");i&&i.GetPropertyValue("Collab.3D.Paper.Positioning.Type")===l.EPositionType.Free2D&&(t.modifiable=i,t.isAlignableValue=!0)}}return t},createDressupsBases:function(){var e=this.QueryInterface("W3AISGNodeHolder");this._DressupRoot=e.getSGNode();let t=this._experienceBase.getManager("VCXContextManager");if(t.getRootComponent()){var i=this._experienceBase.getManager("VCXContextManager").getRootComponent().QueryInterface("VCXIModelNavigable"),r=this.QueryInterface("VCXIModelNavigable");if(r)for(var o in r.setParent(i),this.getDressupGroups())if(this.getDressupGroups().hasOwnProperty(o)){if(this.getDressupGroups().dressupGrpType)continue;this.GetDressupGroup(o,!0)}}if(t.getMainViewer()){let e=t.getMainViewer().getContent();this.dressupsOverViewerDiv=new UWA.Element("div",{id:"divDressupsOverViewer",styles:{height:"100%",width:"100%",position:"absolute",top:"0px",left:"0px","pointer-events":"none"}}),this.dressupsOverViewerDiv.inject(e)}},getDressupsOverViewerDiv(){return this.dressupsOverViewerDiv},GetDepthInformation:function(){var e={highest:0,lowest:0};for(var t in this._DressupComponents)if(this._DressupComponents.hasOwnProperty(t)){var i=this._DressupComponents[t];if(i.IsKindOf("VCXMarkup_Spec")){var r=i.QueryInterface("VCXIModifiable");if(r){var o=r.GetPropertyValue("Collab.3D.Paper.Depth");e.highest<o&&(e.highest=o),e.lowest>o&&(e.lowest=o)}}}return e},getDressupDressupNodeOverride:function(e,t){var i=this.QueryInterface("W3AISGNodeHolder"),r=i.giveSGNode();if(!e.dressupSGOS){var o=e.getSceneGraphOverrideSetManager();e.dressupSGOS=new c(r),o.pushSceneGraphOverrideSet(e.dressupSGOS)}var a=d.buildPathElement(i.getPathElement(),t);return e.dressupSGOS.createOverride(a)},FindBestName:function(e,t,i){var r=this.GetDressupGroup(e),o=y["DefaultComponentName."+t]||i&&i["DefaultComponentName."+t];if(o||(o="Dressup"),!r)return o;if(!r.highestValue){var a=r.QueryInterface("VCXIModelNavigable");r.highestValue=0;for(var n=a.getChildren(),s=n.length,l=0;l<s;++l){var p=n[l].QueryInterface("VCXIModifiable");if(p){var u=p.GetPropertyValue("Actor.Name"),h=RegExp(o+"_(\\d*)$"),d=u.match(h);d&&parseInt(d[1])>r.highestValue&&(r.highestValue=d[1])}}}return r.highestValue++,o+"_"+(r.highestValue+"").padStart(3,"0")},GetDressupGroup:function(e,t){e||console.warn("?? Check with ITY");var i=this.getDressupGroups()[e];if(!i&&t){(i=this._experienceBase.Factory.BuildComponent("VCXComponentDressupGrp")).SetID(e+"ID"),i.setName(e),i.SetPersistency(2),this._experienceBase.ComponentsMap.AddComponent(i),this.getDressupGroups()[e]=i;var r=this.QueryInterface("VCXIModelNavigable"),o=i.QueryInterface("VCXIModelNavigable");o&&r&&o.setParent(r)}return i},AddDressups:function(t){for(var i=0;i<t.length;++i)this._addDressup(t[i]);0!==t.length&&e.publish({event:"VCX_DRESSUPS_ADDED",data:t})},_addDressup:function(e){var t=e.QueryInterface("VCXIModifiable");if(t){if(""===t.GetPropertyValue("Actor.Name")){var i=this.FindBestName(e.dressupGroupName,e.getDefaultName());t.OnChangeProperty("Actor.Name",new u(i))}var r=e.GetID();if(r){if(this._DressupComponents[r])return;this._DressupComponents[r]=e,e.preRender&&(e.IsKindOf("VCXSection_Spec")?this._DressupSectionsToPreRender[r]=e:this._DressupComponentsToPreRender[r]=e),e.postRender&&(this._DressupComponentsToPostRender[r]=e);var o=this.GetDressupGroup(e.dressupGroupName,!0).QueryInterface("VCXIModelNavigable"),a=e.QueryInterface("VCXIModelNavigable");a&&o&&a.setParent(o);var n=e.QueryInterface("W3AISGNodeHolder");if(n){var s=n.getSGNode();if(s){var l=e.QueryInterface("VCXIModelNavigable");if(l){var p=l.getParent().QueryInterface("W3AISGNodeHolder");p&&(s.getParents()&&0!==s.getParents().length||p.getSGNode().addChild(s),n._pathElement||(n._pathElement=p.getPathElement().clone(),n._pathElement.addElement(s)),this._experienceBase.ComponentsMap.addToHashTree(e))}s.setVisibility(!0)}}}}},RemoveDressups:function(t){if(t&&0!==Object.keys(t).length){for(var i in e.publish({event:"VCX_DRESSUPS_PREREMOVED",data:t}),t)t.hasOwnProperty(i)&&this._removeDressup(t[i]);for(i=0;i<t.length;++i){var r=t[i].GetID();delete this._DressupComponents[r],delete this._DressupComponentsToPreRender[r],delete this._DressupSectionsToPreRender[r],delete this._DressupComponentsToPostRender[r]}e.publish({event:"VCX_DRESSUPS_REMOVED",data:t})}},_removeDressup:function(e){var t;this.getDressupGroups()[e.dressupGroupName]&&(t=this.getDressupGroups()[e.dressupGroupName].QueryInterface("VCXIModelNavigable"))&&t.removeChild(e);var i=e.QueryInterface("W3AISGNodeHolder");if(i){var r=i.giveSGNode();if(r){r.setVisibility(!1);var o=r.getParents()[0];if(o){try{o.removeChild(r)}catch(e){console.warn(e)}0===o.getChildren().length&&o.setVisibilityInTree(!1)}}}},_deleteDressup:function(e){var t=this._experienceBase.getManager("VCXCAT3DXModelManager");return t&&e&&e.QueryInterface("CATI3DExperienceObject")?t.DeleteActor(e):UWA.Promise.resolve(e.CallDispose())},DeleteDressups:function(e){if(this.RemoveDressups(e),!e||!e.length)return UWA.Promise.resolve();var t=this,i=[];return e.forEach(function(e){e.IsDressup&&i.push(t._deleteDressup(e))}),UWA.Promise.all(i)},RefreshVisuAfterDressupChange:function(){this.SetDirty(),this.UpdateDressupList();var e=this._experienceBase.getManager("VCXModelChangeListener");e&&(e.hasChanged(a.FChangeFlag.BomID,!0),e.hasChanged(a.FChangeFlag.Visibility,!0),e.hasChanged(a.FChangeFlag.DressupVisibility,!0)),this._experienceBase.getManager("VCXContextManager").renderAll()},changeDressupsPickability:function(e){for(var t in this._DressupComponents)if(this._DressupComponents.hasOwnProperty(t)){var i=this._DressupComponents[t];if(!i.IsPickerSensitive){var r=i.QueryInterface("W3AISGNodeHolder");r&&r.giveSGNode()&&r.giveSGNode().setPickable(e?h.PICKABLE:h.PICKTHROUGH)}}},getDressups:function(){return this._DressupComponents},getDressupsFromGroup:function(e){var t=[],i=this.GetDressupGroup(e);if(i){var r=i.QueryInterface("VCXIModelNavigable");if(r)for(var o=r.getChildren(),a=o.length,n=0;n<a;++n)t.push(o[n].GetObject())}return t},GetDressupCount:function(){var e=0;for(var t in this._DressupComponents)this._DressupComponents.hasOwnProperty(t)&&e++;return e},shouldComponentBeDisplayedInTree:function(e){if(this._experienceBase)return e.IsKindOf("VCXWebComponentCamera")||e.IsKindOf("CXPCameraActor_Spec")||e.IsKindOf("VCXComponentDressupGrp")&&"Cameras"===e.getName()?this._experienceBase.getManager("VCXContextManager").isSupported("CameraDisplay"):e.IsKindOf("VCXViewport_Spec")||e.IsKindOf("VCXComponentDressupGrp")&&"Environment"===e.getName()?this._experienceBase.getManager("VCXContextManager").isSupported("EnvironmentDisplay"):e.IsKindOf("VCXSection_Spec")||e.IsKindOf("VCXComponentDressupGrp")&&"Sections"===e.getName()?this._experienceBase.getManager("VCXContextManager").isSupported("Section"):e.IsKindOf("VCXComponentPath")||e.IsKindOf("VCXComponentDressupGrp")&&"Paths"===e.getName()?this._experienceBase.getManager("VCXContextManager").isSupported("Paths"):e.IsKindOf("VCXComponentDressupGrp")||e.IsKindOf("VCXDressup_Spec")},update:function(e){this._parent(e);var t=this._experienceBase.getManager("VCXContextManager");if(t){var i=this.QueryInterface("VCXIModelNavigable").getWorkingRoot();if(i){var a=i.QueryInterface("W3AISGNodeHolder");if(a){var n=a.getWorldMatrix(t.getMainViewer());n&&!s.IsMat1EqualsToMat2(n,this._currentWorkingRootMatrix)&&(this._currentWorkingRootMatrix=n.clone(),this.SetDirty())}}if(t.partHasMoved&&(this.groundDirty=2),this.groundDirty>0){if(1===this.groundDirty){var p=-1,u=t.getActiveGround();if(u){var h=u.QueryInterface("VCXIModifiable");h&&!h.GetPropertyValue("Environment.Ground.Diameter.Auto")&&(p=h.GetPropertyValue("Environment.Ground.Diameter")/2),this._experienceBase.getManager("VCXVisuManager").updateGroundPosition({radius:p})}else if(t.getActiveViewport()){var d=t.getActiveViewport().getActiveAmbienceID(),c=d&&this._experienceBase.ComponentsMap.GetComponentFromID(d);c?c.updatePosition():this._experienceBase.getManager("VCXVisuManager").updateGroundPosition({radius:-1})}}this.groundDirty--}var y=this._experienceBase.getManager("VCXVisuManager");for(var C in this._automaticAlignmentDressups&&this._automaticAlignmentDressups.length?(y.HasViewpointMoved||t.partHasMoved||this._DressupVisibilityHasChanged||this._autoAlignmentDirty)&&(this.alignmentDirty=2,this._DressupOrganisationManager||(this._DressupOrganisationManager=new r,this._DressupOrganisationManager.setExperienceBase(this._experienceBase)),this._DressupOrganisationManager.autoAlignDressups(e),this._autoAlignmentDirty=!1):this.alignmentDirty=0,this._dressupsHaveBeenAligned=!1,this._automaticAlignmentDressups=[],this._DressupComponents)if(this._DressupComponents.hasOwnProperty(C)){var m=this._DressupComponents[C];if(this.needUpdate||m.IsDressupPropertiesChangeIndependent){var f=!1,V=m.QueryInterface("VCXIVisibility");if(V&&V.GetVisibility()!==o.EVisState.Hidden){f=!0;var b=m.QueryInterface("VCXIModifiable");b&&b.GetPropertyValue("Collab.3D.Paper.Positioning.Type")<l.EPositionType.EndOfAutomaticPositionning&&this._automaticAlignmentDressups.push(m)}var P=m.isDirty();if(!P&&f&&(m.IsAnchorDependent&&m.hasPointedObjectMoved(e)||m.IsViewPointDependent&&y.HasViewpointMoved)&&(P=!0),(P||e&&e.force)&&m.update)try{m.update(e)}catch(e){console.warn(e)}}}}},postUpdate:function(e){this._parent(e);var t=0;for(var i in this._DressupComponents)if(this._DressupComponents.hasOwnProperty(i)){var r=this._DressupComponents[i];if(r.postUpdate)try{r.postUpdate(e)}catch(e){console.warn(e)}var o=r.QueryInterface("VCXIModifiable");o&&r.shapeInfo&&r.shapeInfo.sizeBeforeEqualization&&o.GetOpacity()&&o.GetPropertyValue("Collab.Body.ContributeToEqualSize")&&(t=Math.max(t,r.shapeInfo.sizeBeforeEqualization.x))}this._calloutMaxWidth!==t&&(this._calloutMaxWidth=t,this.SetDirty()),this.needUpdate&&this.needUpdate--,this._DressupVisibilityHasChanged=!1},preRender:function(e){if(this._parent(e),this._preRenderDone=!1,!e.onlyPostProcess){var t=this._experienceBase.getManager("VCXContextManager");if(t.getMainViewer()===e.viewer){for(var i in t.applyToViewers(function(e){e.lockRenderIteration&&e.lockRenderIteration()}),this._DressupSectionsToPreRender)if(this._DressupSectionsToPreRender.hasOwnProperty(i)){if((a=(r=this._DressupSectionsToPreRender[i]).QueryInterface("VCXIVisibility"))&&a.GetVisibility()===o.EVisState.Hidden)continue;if(r.preRender)try{r.preRender(e)}catch(e){console.warn(e)}}for(var i in this._DressupComponentsToPreRender)if(this._DressupComponentsToPreRender.hasOwnProperty(i)){var r,a;if((a=(r=this._DressupComponentsToPreRender[i]).QueryInterface("VCXIVisibility"))&&a.GetVisibility()===o.EVisState.Hidden)continue;if(r.preRender)try{r.preRender(e)}catch(e){console.warn(e)}}this._preRenderDone=!0,t.applyToViewers(function(e){e.unlockRenderIteration&&e.unlockRenderIteration()})}}},postRender:function(e){if(this._parent(e),this._preRenderDone)for(var t in this._DressupComponentsToPostRender)if(this._DressupComponentsToPostRender.hasOwnProperty(t)){var i=this._DressupComponentsToPostRender[t],r=i.QueryInterface("VCXIVisibility");if(r&&r.GetVisibility()!==o.EVisState.Hidden&&i.postRender)try{i.postRender(e)}catch(e){console.warn(e)}}},toggleVisiblityDressupGroup:function(e,t){for(let i of e){let e=this._experienceBase.ComponentsMap.GetComponentFromID(i);if(e){let i=e.QueryInterface("W3AISGNodeHolder");if(i){let e=i.getSGNode();e&&e.setVisibility(t)}}}},ChangeVisuProperties:function(e,t,i,r){},UpdateDressupList:function(){for(var e in this._DressupComponents)if(this._DressupComponents.hasOwnProperty(e)){var t=this._DressupComponents[e];if(t.update){var i={deltaTime:0,viewer:this._experienceBase.getManager("VCXContextManager").getMainViewer(),viewpoint:this._experienceBase.getManager("VCXContextManager").getMainViewer().currentViewpoint};try{t.update(i)}catch(e){console.warn(e)}}}},GetCalloutMaxWidth:function(){return this._calloutMaxWidth},getVersion:function(){return"1.0.6"},changeDressupVisibility:function(){this._DressupVisibilityHasChanged=!0,this._autoAlignmentDirty=!0}});return Object.defineProperty(C.prototype,"componentType",{enumerable:!0,get:function(){return"VCXDressupManager"}}),C});