define("DS/ENOX3DSpaceAttributesMgt/views/actions/RemoveAttributesHandler",[],()=>{return class{static async execute(e){if(!e||!e.options)return;const[t,i]=await this.fetchDepencies(["DS/PADServices/utils/GlobalUtils","i18n!DS/PADServices/assets/nls/PADServices.json"]),{attrModel:n}=e.options,s=n?n.getSelectedNodes():[];n.withTransactionUpdate(()=>{s.forEach(e=>{this.isNodeRemovable(e)?n.removeRoot(e):(e.unselect(),t.displayNotif({level:"warning",message:i.replace(i.attributesCustomization.cannotRemove,{attr:e.getReferenceValue("attrTitle")})}))})})}static isNodeRemovable(e){const{layout:t,isAdditionalColumn:i}=e.options.grid;return!(!0===i||t&&!1===t.removable)}static fetchDepencies(e){return e.map(()=>({})),new Promise(t=>{require([...e],(...e)=>{t(e)})})}}}),define("DS/ENOX3DSpaceAttributesMgt/views/actions/MoveColumnsHandler",[],function(){"use strict";return{execute:function(e,t){var i=e.options.attrModel.getSelectedNodes();!0===e.options.withDgv?this.__dgvMoveColumn.apply(e,[t,i]):this.__treeMoveColumn.apply(e,[t,i])},__dgvMoveColumn:function(e,t){var i=this;1===t.length&&this.options.attrModel.withTransactionUpdate(function(){var n,s=t[0],o=s.getReferenceValue("pinContent"),a=s._getLocalID?s._getLocalID():s._localID,r=i.__locateFirstAndLastPin(o),l=r.first._getLocalID?r.first._getLocalID():r.first._localID,d=r.last?r.last._getLocalID?r.last._getLocalID():r.last._localID:i.options.getRoots().length-1;switch(e){case"moveFirst":n=l;break;case"moveUp":n=l<=a-1?a-1:a;break;case"moveDown":n=d>=a+1?a+1:a;break;case"moveLast":n=d}if(a!==n){var c={fromID:a,toID:n};i._isMoving=!0,i.options.attrModel.addChild(s,c.toID),s.select(),i._isMoving=!1,i.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"moveColumn",move2perform:c}})}})},__treeMoveColumn:function(e,t){var i=this;1===t.length&&this.options.attrModel.withTransactionUpdate(function(){var n=t[0],s=n._getLocalID?n._getLocalID():n._localID,o={fromID:s,toID:-1};switch(e){case"moveFirst":o.toID=0;break;case"moveUp":o.toID=s-1;break;case"moveDown":o.toID=s+1;break;case"moveLast":o.toID=i.options.attrModel.getRoots().length-1}-1!==o.toID&&s!==o.toID&&o.toID<i.options.attrModel.getRoots().length&&(i._isMoving=!0,i.options.attrModel.addChild(n,o.toID),n.select(),i._isMoving=!1,i.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"moveColumn",move2perform:o}}))})}}}),define("DS/ENOX3DSpaceAttributesMgt/services/loadModuleUtils",[],()=>{return class{static async loadRuntimeLibrary(e){return await new Promise((t,i)=>{require([e],e=>{t(e)},t=>{i(new Error(`${e} loading fails error : ${t}`))})})}static async loadRuntimeLibraries(e){return Array.isArray(e)&&e.length?new Promise((t,i)=>{require(e,(...e)=>{t(e)},e=>{i(e)})}):Promise.reject(new Error("wrong inputs"))}}}),define("DS/ENOX3DSpaceAttributesMgt/views/AttributesContants",[],()=>{return{COLUMNS_EXPORT:"export",TOOLBAR_ACTION_MORE_ATTRIBUTES:"moreAttributes",TOOLBAR_ACTION_DIVISER:"diviser",TOOLBAR_ACTION_MOVE_UP:"moveUp",TOOLBAR_ACTION_MOVE_DOWN:"moveDown",TOOLBAR_ACTION_MOVE_TOP:"moveFirst",TOOLBAR_ACTION_MOVE_BOTTOM:"moveLast",TOOLBAR_ACTION_CHANGE_COLOR:"changeColor",TOOLBAR_ACTION_REMOVE:"trash",TOOLBAR_DEFAULT_ACTIONS:["moreAttributes","diviser","trash"]}}),define("DS/ENOX3DSpaceAttributesMgt/views/actions/ChangeColorHandler",[],function(){"use strict";return{execute:function(e){var t=e,i=e.options.attrModel.getSelectedNodes();require(["DS/PADServices/views/private/ColorPicker"],function(e){t.elements.container.disabled=!0;var n={background_color:"#ffffff",color:"#000000"};if(1===i.length&&i[0].getReferenceValue("columnColor")){var s=i[0].getReferenceValue("columnColor");n={background_color:s["background-color"],color:s.color}}new e({selected_color:n,renderTo:document.body,events:{onColorOK:function(e){t.elements.container.disabled=!1;for(var n=[],s=0;s<i.length;s++){var o=i[s],a={};"#ffffff"===e.background_color?a["background-color"]=void 0:a["background-color"]=e.background_color,"#000000"===e.color?a.color=void 0:a.color=e.color,o.updateOptions({grid:{columnColor:a}}),n.push(o.options.columnIndex)}t.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"changeColor",modifiedColumns:n,"background-color":a["background-color"]+";",color:a.color+";"}})},onClose:function(){t.elements.container.disabled=!1}}})})}}}),define("DS/ENOX3DSpaceAttributesMgt/views/AttributesCommons",["i18n!DS/PADServices/assets/nls/PADServices.json","DS/PADServices/utils/GlobalUtils","UWA/Core","DS/TreeModel/TreeNodeModel"],(e,t,i,n)=>{const s="trash",o="attrRemove",a="moreAttributes",r=["selection","hide_show","find_in_ctx","instanceName","instanceMatrix","thumbnail"],l={properties:[function(){return{property:"label",value:this.options.grid.attrTitle}},function(){const e={property:"text",value:void 0};return(void 0===this.options.grid.hasTitle||this.options.grid.hasTitle)&&(e.value=this.options.grid.attrTitle),e},function(){return{property:"dataIndex",value:this.options.columnIndex}},function(){return{property:"attrParent",value:this.options.grid.attrParent}},function(){return{property:"attrDim",value:this.options.grid.attrDim}},function(){return{property:"provider",value:this.options.grid.provider}},function(){return{property:"attrUnit",value:this.options.grid.attrUnit}},function(){return{property:"ds6w",value:this.options.grid.attrName}},function(){return{property:"hasNLS",value:void 0===this.options.grid.hasTitle||this.options.grid.hasTitle}},function(){return{property:"noTitleColumn",value:void 0!==this.options.grid.hasTitle&&!this.options.grid.hasTitle}},function(){return{property:"kind",value:this.options.kind}},function(){return{property:"ds6wFrom",value:"Instance"===this.options.grid.attrParent?"rel":void 0}},function(){return{property:"isAdditionalColumn",value:this.options.grid.isAdditionalColumn}},function(){return{property:"attrVisible",value:this.options.grid.attrVisible}},function(){return{property:"description",value:this.options.grid.attrDesc}},function(){const e=i.clone(this.options.grid.layout||{});return e.canBeGrouped=!!this.options.grid&&this.options.grid.canBeGrouped,{property:"customisation",value:{layout:e}}},function(){return{property:"attrSelectable",value:this.options.grid.attrSelectable}},function(){return{property:"attrNature",value:this.options.grid.attrNature}},function(){return{property:"attrUserAccess",value:this.options.grid.attrUserAccess}},function(){return{property:"attrRangeValue",value:this.options.grid.attrRangeValue}},function(){return{property:"attrEditable",value:this.options.grid.attrEditable}}]};return class{static get specificColumns(){return r}static get dumpProp(){return l}static get required(){return{columns:[],ActionsColumn:[{icon:{iconName:s,fontIconFamily:1},dataIndex:o,alignmentValue:"center",alwaysVisibleFlag:!0,width:30,sortableFlag:!1,resizableFlag:!1,editableFlag:!1,getCellTypeRepresentation:e=>{let t="actionRemove";return e.nodeModel&&!0===e.nodeModel.options.pinColumn?t="string":e.nodeModel&&(!0===e.nodeModel.options.grid.isAdditionalColumn||e.nodeModel.options.grid.layout&&!1===e.nodeModel.options.grid.layout.removable)&&(t="actionNotRemove"),t},getCellSemantics:e=>{const{options:t}=e?e.nodeModel:{},{isAdditionalColumn:i,layout:n}=t?t.grid:{};let s=null;return(!0===i||n&&!1===n.removable)&&(s={disabled:!0}),s}}]}}static get provided(){return{columns:{groupability:{icon:{iconName:"group",fontIconFamily:1},dataIndex:"canBeGrouped",typeRepresentation:"boolean",alignmentValue:"center",alwaysVisibleFlag:!0,width:30,editableFlag:!0,editionPolicy:"EditionInPlace",sortableFlag:!1,resizableFlag:!1,getCellEditableState:e=>{let t=!0;return e.nodeModel.options.grid.layout&&e.nodeModel.options.grid.layout.groupingLocked&&(t=!1),t},getCellTypeRepresentation:e=>{let t="boolean";return e.nodeModel&&!0===e.nodeModel.options.pinColumn&&(t="string"),t}}}}}static getToolbarActionView(e,t){const i=this.toolbarActionsDefinition[e];return"function"==typeof i?i(t):{}}static invokeActionByColumnID(e){const{columnID:t}=e||{},i=this.columnActionsMapping[t];i?this.invokeActionByID({actionId:i,...e}):console.error(`${t} don't have a mapped action`)}static createAttributeNode(e){const t={columnIndex:e.dataIndex,label:e.label,kind:e.kind?e.kind:"string",icons:e.icons||[],grid:{attrTitle:e.label,attrVisible:void 0===e.attrVisible||e.attrVisible,canBeGrouped:void 0!==e.canBeGrouped&&e.canBeGrouped,attrName:e.attrName,attrDim:e.attrDim,attrUnit:e.attrUnit,provider:e.provider&&e.provider.length>0?e.provider:void 0,layout:e.layout,isAdditionalColumn:void 0!==e.isAdditionalColumn&&e.isAdditionalColumn,attrRemove:!0,attrParent:e.attrInstRef||"Reference",attrInstRef:e.attrInstRef||"Reference",attrAlert:null,attrSelectable:e.attrSelectable,attrNature:e.attrNature,attrUserAccess:e.attrUserAccess,attrRangeValue:e.attrRangeValue,attrEditable:e.attrEditable},children:null};return new n(t)}static getAttributeIcons(e){let t;switch(e){case"Reference":t=[{iconName:"product"}];break;case"Instance":t=[{iconName:"flow-cascade"}];break;case"AdditionalColumn":t=[{iconName:"insert"}];break;default:t=void 0}return t}static invokeActionByID(e){const{actionId:t,context:i}=e||{};if(t&&i)if(this.actionsMeta[t]){const n=this.actionsMeta[t];require([n.executor],t=>{const{input:n}=e;t.execute(i,n)})}else console.error(`${t} action not found`)}static get toolbarActionsDefinition(){return{moreAttributes:t=>({fonticon:"attributes-add",title:e.attributesCustomization.moreAttributes,name:a,handler:()=>this.invokeActionByID({actionId:a,context:t})}),diviser:()=>({className:"divider"}),trash:t=>({fonticon:s,title:e.attributesCustomization.remove,name:"remove",handler:()=>this.invokeActionByID({actionId:s,context:t})})}}static get columnActionsMapping(){return{attrRemove:"trash"}}static get actionsMeta(){return{moreAttributes:{executor:"DS/ENOX3DSpaceAttributesMgt/views/actions/MoreAttributesHandler"},trash:{executor:"DS/ENOX3DSpaceAttributesMgt/views/actions/RemoveAttributesHandler"}}}}}),define("DS/ENOX3DSpaceAttributesMgt/services/predicatesServices",["DS/FedDictionaryAccess/FedDictionaryAccessAPI"],e=>{class t{static getSelectableInfoFromPredicateInfo(e){const{nature:t,selectable:i,userAccess:n,dataType:s,range:o,rangeValues:a,multiValuated:r}=e||{};return{nature:t,selectable:i,userAccess:n,dataType:s,range:o,rangeValues:a,multiValuated:r}}static createANewAttributePredicate(e,i,n){if(!e||!i||!n)throw new Error("wrong input");const{manipulationUnit:s,dimension:o,isAppPredicate:a,isAppPredicateEditable:r}=n||{};return{uri:e,manipulationUnit:s,dimension:o,isAppPredicate:a,isAppPredicateEditable:r,predicates:[{classNames:[i],...this.getSelectableInfoFromPredicateInfo(n)}],get curi(){return this.uri},get isAnAppPredicate(){return"boolean"==typeof this.isAppPredicate&&this.isAppPredicate},get isAnAppPredicateEditable(){return"boolean"==typeof this.isAppPredicateEditable&&this.isAppPredicateEditable},get inTypes(){const e=[];return this.predicates.forEach(t=>e.push(...t.classNames)),[...new Set(e)]},get nature(){const e=this.getPredicateInfo();return e?e.nature:null},get userAccess(){const e=this.getPredicateInfo();return e?e.userAccess:null},get multiValuated(){const e=this.getPredicateInfo();return e?e.multiValuated:null},get dataType(){const e=Array.isArray(this.predicates)&&this.predicates.length?this.predicates[0]:null;if(!e)return"";const t=e.dataType;return t.substring(t.indexOf("#")+1)},get rangeValues(){const e=this.getPredicateInfo();return e&&e.rangeValues||null},get selectable(){const e=this.getPredicateInfo();return e?e.selectable:null},getSelectables(e=null){return("function"==typeof e?this.predicates.filter(e):this.predicates).map(e=>e.selectable)},get description(){return n.description},get label(){return n.label},get isAMultiPredicate(){return this.predicates.length>1},findPredicateInfo(e){return"function"!=typeof e?null:this.predicates.find(e)},getPredicateInfo(){if(!this.isAMultiPredicate)return this.predicates[0];if(!this.forceEdition)return null;const e=this.predicates.filter(t.isAPredicateForEdition);if(!e.length)return null;const i=e.findIndex(e=>e.selectable===this.forceEdition);return-1===i?null:e[i]},get isEditable(){return this.isAnAppPredicate?this.isAnAppPredicateEditable:!!this.forceEdition||t.isAPredicateEditable(this)},set forceEditionWith(e){if(e){const i=this.findPredicateInfo(t=>t.selectable===e);i&&t.isAPredicateForEdition(i)&&(this.forceEdition=e)}else delete this.forceEdition},get canBeForceForEdition(){return this.getSelectables(t.isAPredicateForEdition).length>0}}}static canBeEdited(e){return"string"==typeof e&&-1!==e.search(/([wW]rite)/g)}static getAttributePredicatesFromClassPredicates(e,t=null,i=null){if(!e)throw new Error("invalid input");if(!Array.isArray(e))throw new Error("invalid format");const n=[];return e.forEach(e=>{const{classInfo:s}=e,o=s.curi,a=e.properties;Array.isArray(a)&&a.forEach(e=>{const s=this.getUriFromPredicateInfo(e);if(this.isPredicateIgnoredByApplication(s,t))return;const a=this.getSelectableInfoFromPredicateInfo({...e,multiValuated:this.isAMultiValuatedPredicate(e,i)}),r=n.find(e=>e.uri===s);if(r){const{predicates:t}=r,i=t.find(t=>this.isPredicateInfoEqual(t,e));i?i.classNames.find(e=>e===o)||i.classNames.push(o):t.push({classNames:[o],...a})}else{let a=!1;const r=this.isPredicateControlledByApplication(s,t);r&&(a=this.isAnEditablePredicateControlledByApplication(s,t)),n.push(this.createANewAttributePredicate(s,o,{...e,multiValuated:this.isAMultiValuatedPredicate(e,i),isAppPredicate:r,isAppPredicateEditable:a}))}})}),n}static isAMultiValuatedPredicate(e,t){if(!e||!Array.isArray(t))return!1;const{selectable:i}=e;return!!i&&-1!==t.map(e=>{const{Name:t,Owner:i}=e;return i?`${i}.${t}`:t}).indexOf(i)}static isPredicateInfoEqual(e,t){if(!e||!t)throw new Error("isPredicateInfoEqual invalid input");const{nature:i,selectable:n,userAccess:s}=e,{nature:o,selectable:a,userAccess:r}=t;return i===o&&n===a&&s===r}static isAPredicateForEdition(e){const{nature:i,multiValuated:n}=e||{};return!n&&!!t.isAnAttribute(i)}static isAPredicateEditable(e){if(!e)return!1;const{isAMultiPredicate:i}=e;return!i&&t.isAPredicateForEdition(e)}static isAnAttribute(e){return"string"==typeof e&&e.toUpperCase()==="attribute".toUpperCase()}static isAGeneratedPredicate(e){return"string"==typeof e&&e.startsWith("ds6wg:")}static isAnEditablePredicateControlledByApplication(e,t){if(!this.isPredicateControlledByApplication(e,t))return!1;const{userAccess:i}=t[e]||{};return this.canBeEdited(i)}static isPredicateControlledByApplication(e,t){if("string"!=typeof e||!t)return!1;return-1!==Reflect.ownKeys(t).indexOf(e)}static isPredicateIgnoredByApplication(e,t){if(!this.isPredicateControlledByApplication(e,t))return!1;const{ignored:i}=t[e]||{};return"boolean"==typeof i&&i}static getUriFromPredicateInfo(e){const{curi:t}=e||{};if(!t)throw new Error("predicateInfo without uri");return{"ds6wg:XCADExtension.V_CADOrigin":"ds6w:cadMaster"}[t]||t}static async getNLSPropertiesForClass(t,i){if(!Array.isArray(t))throw new Error("invalid inputs");const{settingManager:n}=i||{};if(!n||"function"!=typeof n.getPlatformId||"function"!=typeof n.getLanguage)throw new Error("invalid inputs");if(0===t.length)return[];const s=t.join(",");let o=null;try{o=await new Promise((i,o)=>{e.getResourcesInfo(s,{tenantId:n.getPlatformId(),lang:n.getLanguage(),apiVersion:"R2019x",onComplete:e=>{const n="string"==typeof e?JSON.parse(e):e;Array.isArray(n)&&t.length===n.length||o(new Error("inconsistent nls answer compare to classes input"));const s={};t.forEach((e,t)=>{s[e]=n[t]}),i(s)},onFailure:e=>{o(e)}})})}catch(e){throw new Error(`getNLSPropertiesForClass fails ${e}`)}return o}}return t}),define("DS/ENOX3DSpaceAttributesMgt/services/fetchDictionaryServices",["UWA/Core","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/DictionaryMgt"],(e,t,i,n)=>{class s{static async fetchTypesClasses(e){if(!Array.isArray(e)||!e.length)throw new Error("fetchExtensionsForTypes invalid input arguments");if(s.lastFetchedTypesClasses&&s.lastFetchedTypesClasses.isValidWith(e))return s.lastFetchedTypesClasses.getTypesClasses();const t={classes:[],getNLSForType:e=>n.getNLSForTypes(e),getTypesMapToBaseTypes(e){const t={unknown:new Set};return Reflect.ownKeys(e).forEach(i=>{t[i]=Array.isArray(e[i])?new Set(e[i]):new Set}),Reflect.ownKeys(this.classes).forEach(i=>{const n=this.classes[i].parent||i,s=Reflect.ownKeys(e).find(e=>t[e].has(n));s?t[s].add(i):t.unknown.add(i)}),Reflect.ownKeys(t).forEach(e=>{t[e]=[...t[e]]}),t}};try{await s.initializefetchDictionaryServices(),t.classes=await n.getTypesInfo({baseTypes:e},!0)}catch(e){throw new Error(`fetchExtensionsForTypes fails ${e}`)}finally{s.lastFetchedTypesClasses={types:e,typesClasses:t,isValidWith(e){if(e.length!==this.types.length)return!1;return-1===e.findIndex(e=>-1===this.types.indexOf(e))},getTypesClasses(){return this.typesClasses}}}return t}static syncFetchTypesClasses(){return s.lastFetchedTypesClasses?e.clone(s.lastFetchedTypesClasses.getTypesClasses()):[]}static async fetchExtensionsClassesForTypes(e,t=!1){if(!Array.isArray(e)||!e.length)throw new Error("fetchExtensionsForTypes invalid input arguments");if(s.lastFetchedExtensionsClasses&&s.lastFetchedExtensionsClasses.isValidWith(e,t))return s.lastFetchedExtensionsClasses.getExtensionClasses();let i=null;try{await s.initializefetchDictionaryServices(),i=await n.interfaces({onlyCustomer:t,classes:e},!0)}catch(e){throw new Error(`fetchExtensionsForTypes fails ${e}`)}finally{s.lastFetchedExtensionsClasses={types:e,extensionsClasses:i,onlyCustomer:t,isValidWith(e,t){if(t!==this.onlyCustomer)return!1;if(e.length!==this.types.length)return!1;return-1===e.findIndex(e=>-1===this.types.indexOf(e))},getExtensionClasses(){return this.extensionsClasses}}}return i}static syncFetchExtensionsClassesForTypes(){return s.lastFetchedExtensionsClasses?e.clone(s.lastFetchedExtensionsClasses.getExtensionClasses()):[]}static async fetchPredicatesForClasses(e,i){if(!Array.isArray(e))throw new Error("invalid inputs");const{settingManager:n}=i||{};if(!n||"function"!=typeof n.getPlatformId||"function"!=typeof n.getLanguage)throw new Error("invalid inputs");if(s.lastFetchedPredicatesClasses&&s.lastFetchedPredicatesClasses.isValidWith(e))return s.lastFetchedPredicatesClasses.getPredicates();const o=e.join(",");let a=null;try{a=await new Promise((e,i)=>{t.getPropertiesForClass(o,{tenantId:n.getPlatformId(),lang:n.getLanguage(),apiVersion:"R2019x",onComplete:t=>{const i="string"==typeof t?JSON.parse(t):t;e(i)},onFailure:e=>{i(e)}})})}catch(e){throw new Error(`fetchClassificationAttributes fails ${e}`)}finally{s.lastFetchedPredicatesClasses={classes:e,predicatesClasses:a,isValidWith(e){if(e.length!==this.classes.length)return!1;return-1===e.findIndex(e=>-1===this.classes.indexOf(e))},getPredicates(){return this.predicatesClasses}}}return a}static async initializefetchDictionaryServices(){s.isfetchDictionaryServicesInitialized||(await i.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0}),s.isfetchDictionaryServicesInitialized=!0)}}return s}),define("DS/ENOX3DSpaceAttributesMgt/views/actions/MoreAttributesHandler",["DS/ENOX3DSpaceAttributesMgt/views/AttributesCommons","DS/ENOX3DSpaceAttributesMgt/services/predicatesServices","i18n!DS/ENOX3DSpaceAttributesMgt/assets/nls/ENOXAttributesMgtNls.json"],(e,t,i)=>{return class{static execute(n){const{options:s}=n;require(["DS/ENOX3DSpaceAttributesMgt/views/private/MoreAttributesWizard","DS/PADServices/utils/AttributesMgt","i18n!DS/PADServices/assets/nls/PADServices.json"],(o,a,r)=>{const l=s.attrModel.getRoots().map(e=>{const t={name:e.getReferenceValue("attrName"),instRef:e.getReferenceValue("attrParent")},i=e.getReferenceValue("attrEditable");return"boolean"==typeof i&&(t.attrEditable=i,t.attrSelectable=e.getReferenceValue("attrSelectable")),t});let d=s.modelEvents.subscribe({event:"ENXViews/MoreAttributesWizard/selectedAttributes"},o=>{s.modelEvents.unsubscribe(d);const a=(s.attrModel.getRoots()||[]).map(e=>e.options.columnIndex);s.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{restore:!0}}),s.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{idView:"customize",html:n.elements.container,title:r.attributesCustomization.apptitle}}),s.selectedExtensions=o.selectedExtensions,s.selectedTypes=o.selectedTypes,n._globalUpdate=!0;const l=o.selectedAttributes.filter(e=>-1!==a.indexOf(e.dataIndex)||"ds6w:label"===e.dataIndex).map(e=>e.dataIndex),c=a.filter(e=>-1===l.indexOf(e)&&"tree"!==e),u=o.selectedAttributes.filter(e=>-1===a.indexOf(e.dataIndex)&&"ds6w:label"!==e.dataIndex),p=a.map(t=>s.attrModel.getRoots().find(e=>e.options.columnIndex===t).dump(e.dumpProp));o.selectedAttributes.filter(e=>{if(!Reflect.has(e,"attrEditable")||"boolean"!=typeof e.attrEditable)return!1;const{attrName:i}=e;if(t.isPredicateControlledByApplication(i,s.predicatesManagedByApplication))return!1;const{attrEditable:n,attrSelectable:o}=e,a=p.find(e=>e.ds6w===i);if(!a||!Reflect.has(a,"attrEditable")||"boolean"!=typeof a.attrEditable)return!1;const{attrEditable:r,attrSelectable:l}=a||{};return n!==r||o!==l}).forEach(e=>{const t=s.attrModel.getRoots().find(t=>{const i="Instance"===e.attrParent?`${e.attrName}-Instance`:e.attrName;return t.options.columnIndex===i});t&&(Reflect.has(e,"attrEditable")&&"boolean"==typeof e.attrEditable&&(t.options.grid.attrEditable=e.attrEditable),Reflect.has(e,"attrSelectable")&&"string"==typeof e.attrSelectable&&(t.options.grid.attrSelectable=e.attrSelectable))});const h=[];c.forEach(t=>{const i=s.attrModel.search({match:e=>{let i=!1;return e.nodeModel.options.columnIndex===t&&!0!==e.nodeModel.options.grid.isAdditionalColumn&&"ds6w:type"!==t&&"Thumbnail"!==t&&"occurence"!==t&&"level"!==t&&"rollup"!==t&&"quantity"!==t&&(i=!0),i}});s.attrModel.withTransactionUpdate(()=>{i.forEach(t=>{s.attrModel.removeRoot(t),h.push(t.dump(e.dumpProp))})})});const m=[],f=[];u.forEach(t=>{let o=t.label;"Instance"===t.attrParent&&(o=`${o} (${i.instance})`);const a=e.createAttributeNode({dataIndex:t.dataIndex,label:o,attrName:t.attrName&&!t.attrName.endsWith("-Instance")?t.attrName:t.attrName.substring(0,t.attrName.length-"-Instance".length),kind:t.kind,attrDim:t.attrDim,attrUnit:t.attrUnit,icons:null,attrInstRef:t.attrParent,attrVisible:!0,isAdditionalColumn:!1,canBeGrouped:!1,attrSelectable:t.attrSelectable,attrNature:t.attrNature,attrUserAccess:t.attrUserAccess,attrRangeValue:t.attrRangeValue,attrEditable:t.attrEditable}),r=n.__locateFirstAndLastPin("right");r.first?s.attrModel.insertBefore(a,r.first):s.attrModel.addChild(a),a.select(),f.push(a)}),f.forEach(t=>m.push(t.dump(e.dumpProp))),(h.length||m.length)&&s.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"addRemoveColumns",selectedTypes:s.selectedTypes,selectedExtensions:s.selectedExtensions,removedColumns:h,addedColumns:m}}),delete n._globalUpdate});const c=s.modelEvents.subscribe({event:"ENXViews/MoreAttributesWizard/closeWizard"},()=>{s.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{restore:!0}}),s.modelEvents.unsubscribe(c),s.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{idView:"customize",html:n.elements.container,title:r.attributesCustomization.apptitle}})}),u=a.getDefaultTypesAndExtensions();new o({settingManager:s.settingManager,modelEvents:s.modelEvents,baseTypes:s.baseTypes,baseDocumentTypes:s.baseDocumentTypes,baseInstanceTypes:s.baseInstanceTypes,baseExtensions:s.baseExtensions,selectedTypes:s.selectedTypes,selectedExtensions:s.selectedExtensions,selectedAttributes:l,defaultTypes:u.defaultTypes,defaultExtensions:u.defaultExtensions,predicatesManagedByApplication:s.predicatesManagedByApplication,multiValuatedAttributes:s.multiValuatedAttributes})})}}}),define("DS/ENOX3DSpaceAttributesMgt/views/AttributesCustomization",["i18n!DS/PADServices/assets/nls/PADServices.json","DS/PADServices/views/private/Iconbar","DS/ENOX3DSpaceAttributesMgt/views/AttributesCommons","DS/PADServices/utils/GlobalUtils","css!DS/UIKIT/UIKIT","UWA/Core","UWA/Controls/Abstract","DS/Controls/Button","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Controls/Toggle","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/PADServices/utils/PlatformURL","i18n!DS/ENOX3DSpaceAttributesMgt/assets/nls/ENOXAttributesMgtNls.json","css!DS/PADServices/PADServices","css!DS/ENOX3DSpaceAttributesMgt/views/AttributesCustomization.css"],function(e,t,i,n,s,o,a,r,l,d,c,u,p,h,m){"use strict";return a.extend({name:"attr-customization",defaultOptions:{renderTo:null,modelEvents:null,subscribeTokens:[],modelSubscribeTokens:[],compactMode:!1,applyOnlyToThisApp:!1,baseTypes:[],selectedTypes:[],selectedExtensions:[],rowHeaderActivated:!0,thumbnailsActivated:!1,pinModel:{},dgvOptions:{defaultColumnDef:{width:"auto",typeRepresentation:"string"},showRowIndexFlag:!1,showRowBorderFlag:!0,showAlternateBackgroundFlag:!1,rowSelection:"multiple",cellSelection:"none",selectionBehavior:{canInteractiveMultiselectWithCheckboxClick:!0,canMultiSelect:!0,enableFeedbackForActiveCell:!0,enableShiftSelection:!0,toggle:!1,unselectAllOnEmptyArea:!0},columns:[{icon:{iconName:"database",fontIconFamily:1},tooltip:e.attributesCustomization.attrVisible,dataIndex:"attrVisible",typeRepresentation:"boolean",alignmentValue:"center",alwaysVisibleFlag:!0,width:30,editableFlag:!0,editionPolicy:"EditionInPlace",sortableFlag:!1,resizableFlag:!1,getCellEditableState:function(e){var t=!0;return e.nodeModel.options.grid.layout&&void 0!==e.nodeModel.options.grid.layout.removableFromView?t=e.nodeModel.options.grid.layout.removableFromView:!0===e.nodeModel.options.pinColumn&&(t=!1),t},getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.pinColumn?"string":"boolean"}},{text:e.attributesCustomization.attrTitle,dataIndex:"tree",typeRepresentation:"string",editableFlag:!1,sortableFlag:!1,resizableFlag:!1}]},dgvLayoutOptions:{cellHeight:28,columnHeaderHeight:38,rowsHeader:!0}},init:function(t){this._parent(t);var s=this,a=n.isWebInWinContext()?"-immersivePanelWebInWin":"-immersivePanel";s.elements.container=o.createElement("div",{class:s.getClassNames(a)}),h.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0}).then(function(){s.instanceMgt=!!(s.options.baseInstanceTypes&&s.options.baseInstanceTypes.length>0);var t=s.options.dgvOptions;t.columns=t.columns.concat(i.required.columns,i.required.ActionsColumn),t.columns.push(i.provided.columns.groupability),s._buildBody(),s._buildFooter(),s.elements.panel2small=o.createElement("div",{class:s.getClassNames("-panel2small"),text:e.attributesCustomization.panel2small}).inject(s.elements.container),s.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{idView:"customize",title:e.attributesCustomization.apptitle,html:s.elements.container}})})},destroy:function(){for(var e=0;e<this.options.subscribeTokens.length;e++)this.options.modelEvents.unsubscribe(this.options.subscribeTokens[e]);this.options.toolbar.destroy(),this.options.grid.destroy(),this.options.grid=null,this._parent()},_buildBody:function(){this._buildIconBar(),this.elements.dgv=o.createElement("div",{class:this.getClassNames("-dgv")}).inject(this.elements.container),this.options.dgvOptions.columns.splice(4,1);var t=o.extend({identifier:"DataGridView-attrCusto-"+n.uid()},this.options.dgvOptions);t.layout=new p(this.options.dgvLayoutOptions);var s=this.options.grid=new u(t);s.onContextualEvent=function(){return[]},s.getCellTooltip=function(t){if(-1===t.columnID)return{shortHelp:-1!==t.rowID?`${t.rowID+1}`:null,updateModel:!1};var i=this.options.grid.getColumnOrGroup(t.columnID).dataIndex;return t.dataIndex=i,-1===t.rowID?{shortHelp:e.attributesCustomization[i],updateModel:!1}:"tree"===i&&t.nodeModel&&!0!==t.nodeModel.getReferenceValue("isAdditionalColumn")?{shortHelp:e.replace(e.attributesCustomization.tooltipColName,{label:t.nodeModel.getLabel(),instRef:e.attributesCustomization[t.nodeModel.getReferenceValue("attrInstRef")]}),updateModel:!1}:void 0}.bind(this);var a={actionRemove:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"trash",fontIconFamily:WUXManagedFontIcons.Font3DS}}},actionNotRemove:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"block",fontIconFamily:WUXManagedFontIcons.Font3DS}}}},r={};r[e.attributesCustomization.pinLeft]="left",r[e.attributesCustomization.pinRight]="right",r[e.attributesCustomization.unpinned]="unpinned";var d={pin:{stdTemplate:"enumCombo",semantics:{possibleValues:r,valueType:"enumCustom"}}};s.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(d)),s.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(a));this.options.attrModel=new l({shouldBeSelected:function(e){return!0!==e.options.pinColumn}}),s.treeDocument=this.options.attrModel,s.getContent().addClassName("enxdatagridview"),s.getContent().inject(this.elements.dgv);var c=this;s.onReady(function(){s.addEventListener("change",c._cellModified.bind(c)),s.addEventListener("click",c._cellClicked.bind(c)),c.options.toolbar.show()}),this._addColumns(),this.options.attrModel.getXSO().onPostAdd(this._manageAttrSelection.bind(this)),this.options.attrModel.getXSO().onPostRemove(this._manageAttrSelection.bind(this)),this.options.attrModel.getXSO().onEmpty(this._manageAttrSelection.bind(this)),this.options.modelSubscribeTokens.push(this.options.attrModel.getModelEvents().subscribe({event:"addChild"},function(e){!0!==c._isMoving&&!0!==c._globalUpdate&&c.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"addRemoveColumns",addedColumns:[e.data.nodeModel.dump(i.dumpProp)]}})})),this.options.modelSubscribeTokens.push(this.options.attrModel.getModelEvents().subscribe({event:"removeChild"},function(e){if(!0!==c._isMoving&&!0!==c._globalUpdate){var t=e.data.nodeModel.getReferenceValue("attrName");if(-1!==i.specificColumns.indexOf(t)){if(!1===c.options.withDgv){var n=c.options.toolbar.getItem("specificColumns"),s=n.content.component;if(s)s.isSelected(t)&&s.toggleSelection(s.getItem(t));else{var o=n.content.options.items,a=!1,r=0,l=o.length;do{o[r].id===t?(o[r].selected=!1,a=!0):r++}while(!1===a&&r<l);c.options.toolbar.menu.updateItem(n)}}"thumbnail"===t&&c.elements.comboCompact.disabled(!1)}c.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"addRemoveColumns",removedColumns:[e.data.nodeModel.dump(i.dumpProp)]}})}})),this.elements.behavior=o.createElement("div",{class:this.getClassNames("-behavior")}).inject(this.elements.container)},_buildFooter:function(){var t=this,i=o.createElement("div",{class:t.getClassNames("-footer")}).inject(t.elements.container),n=new r({label:e.attributesCustomization.close,emphasize:"primary",touchMode:!0});n.addEventListener("click",function(){t._closePanel(),t.destroy()}),n.inject(i);var s=new r({label:e.attributesCustomization.reset,touchMode:!0});s.addEventListener("click",function(){t.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"reset",applyOnlyToThisApp:t.options.applyOnlyToThisApp}}),t.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{restore:!0}}),t.destroy()}),s.inject(i)},_closePanel:function(){var e=[];this.options.attrModel.getRoots().forEach(function(t){e.push(t.dump(i.dumpProp))}),this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"close",selectedTypes:this.options.selectedTypes,selectedExtensions:this.options.selectedExtensions,selectedAttributes:e,applyOnlyToThisApp:this.options.applyOnlyToThisApp}}),this.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{restore:!0}})},_addColumns:function(){var e=this;void 0===this.options.appColumns?console.error("AttributesCustomization## Invalid input. Missing property appColumns"):e.options.attrModel.withTransactionUpdate(function(){e.options.appColumns.forEach(function(t){if("bi_color"!==t.dataIndex){var n=o.is(t.text,"string")&&t.text.length>0?t.text:e._retrieveColumnName(t.dataIndex),s=!(!t.customisation||!t.customisation.layout)&&t.customisation.layout.canBeGrouped,a=t.customisation&&t.customisation.layout?t.customisation.layout:null,r=void 0!==t.visibleFlag?t.visibleFlag:!t.isHidden,l=t.ds6wFrom&&"rel"===t.ds6wFrom?"Instance":"Reference";(t.isAdditionalColumn||"Thumbnail"===t.dataIndex)&&(l="AdditionalColumn"),-1!==["level","occurence","quantity","rollup"].indexOf(t.dataIndex)&&(l="CalculatedColumn"),!0===e.instanceMgt&&i.getAttributeIcons(l),"Instance"===l&&(n=`${n} (${m.instance})`);const d={dataIndex:t.dataIndex,label:n,attrName:t.ds6w||t.dataIndex,kind:t.kind,attrDim:t.attrDim,attrUnit:t.attrUnit,icons:null,attrInstRef:l,attrVisible:r,provider:t.provider,isAdditionalColumn:t.isAdditionalColumn,canBeGrouped:s,layout:a},{nature:c,userAccess:u,rangeValues:p,editable:h}=t;c&&(d.attrNature=c),u&&(d.attrUserAccess=u),p&&(d.attrRangeValue=p),d.attrEditable="boolean"==typeof h?h:null,d.attrSelectable=t.dbName?t.dbName:null;const f=i.createAttributeNode(d);f&&e.options.attrModel.addChild(f)}}),e.options.attrModel.expandAll()})},_cellModified:function(e,t){if(t&&t.nodeModel&&t.nodeModel.options.grid)switch(this.options.grid.layout.getDataIndexFromColumnIndex(t.columnID)){case"attrVisible":this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"visibilityColumn",modifiedColumn:t.nodeModel.options.columnIndex,visibilityFlag:t.nodeModel.getReferenceValue("attrVisible")}});break;case"attrTitle":this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"changeTitle",modifiedColumn:t.nodeModel.options.columnIndex,newTitle:t.nodeModel.getReferenceValue("attrTitle")}});break;case"exportContent":this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"exportColumn",modifiedColumn:t.nodeModel.options.columnIndex,exportFlag:t.nodeModel.getReferenceValue("exportContent")}});break;case"pinContent":var i=this,n=t.nodeModel.getReferenceValue("attrName"),s=t.nodeModel.getReferenceValue("pinContent"),o=i.__locateFirstAndLastPin(s);i.options.attrModel.withTransactionUpdate(function(){i._globalUpdate=!0;var e=o.last?o.last._getLocalID?o.last._getLocalID():o.last._localID:i.options.getRoots().length-1;0===e&&(e=1),i.options.attrModel.addChild(t.nodeModel,e),t.nodeModel.select(),delete i._globalUpdate}),this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"pinChange",modifiedColumn:n,pin:s}})}},_cellClicked:function(e,t){if(t&&t.nodeModel&&t.nodeModel.options.grid){if(!0===t.nodeModel.options.pinColumn)return;i.invokeActionByColumnID({columnID:this.options.grid.layout.getDataIndexFromColumnIndex(t.columnID),context:this,input:[t.nodeModel]})}},_retrieveColumnName:function(t){return e.attributesCustomization[t]?e.attributesCustomization[t]:t},_buildIconBar:function(){this.elements.toolbar=o.createElement("div",{class:this.getClassNames("-toolbar")}).inject(this.elements.container);var e=this,n={renderTo:this.elements.toolbar,multiSelect:!0,items:(e.options.toolbarActions||[]).map(function(t){return i.getToolbarActionView(t,e)||{}})};this.options.toolbar=new t(n),this.options.toolbar.elements.container.setStyle("display",void 0)},_manageAttrSelection:function(){var e=this.options.attrModel.getSelectedNodes(),t=["moveUp","moveDown","moveFirst","moveLast"],i=["remove","changeColor"],n=e.length,s=!1,o=0;for(o=0;o<n;o++)!0===e[o].options.grid.isAdditionalColumn||e[o].options.grid.layout&&!1===e[o].options.grid.layout.removable||(s=!0);if(0===n){for(o=0;o<t.length;o++)this.options.toolbar.disableItem(t[o]);for(o=0;o<i.length;o++)this.options.toolbar.disableItem(i[o])}else if(1===n){for(o=0;o<t.length;o++)this.options.toolbar.enableItem(t[o]);for(o=0;o<i.length;o++)"remove"===i[o]&&!1===s?this.options.toolbar.disableItem(i[o]):this.options.toolbar.enableItem(i[o])}else if(n>=1){for(o=0;o<t.length;o++)this.options.toolbar.disableItem(t[o]);for(o=0;o<i.length;o++)"remove"===i[o]&&!1===s?this.options.toolbar.disableItem(i[o]):this.options.toolbar.enableItem(i[o])}},_manageSpecificColumn:function(t,i){var n=this,s=!1,o=!0;"instanceName"===t&&(s=!0,o=!1);var a=["hide_show","instanceName","instanceMatrix","thumbnail"],r=e.attributesCustomization[t]?e.attributesCustomization[t]:t;if(!0===i){if("thumbnail"===t)this.elements.comboCompact.options.treedocument.getRoots()[0].select(!0),this.elements.comboCompact.disabled(!0);this.options.attrModel.withTransactionUpdate(function(){var e=-1!==a.indexOf(t),i=new d({columnIndex:t,label:r,grid:{attrTitle:r,attrVisible:!0,exportContent:s,exportLock:o,canBeGrouped:!1,attrRemove:!0,columnColor:{background_color:"#ffffff",color:"#000000"},attrName:t,hasTitle:e},modelEvents:n.options.modelEvents});n.options.attrModel.addChild(i)})}else{"thumbnail"===t&&this.elements.comboCompact.disabled(!1);var l=this.options.attrModel.search({match:function(e){return e.nodeModel.options.label===t||e.nodeModel.options.columnIndex===t}});this.options.attrModel.withTransactionUpdate(function(){for(var e=0;e<l.length;e++)n.options.attrModel.removeRoot(l[e])})}},_manageInstanceAttributes:function(t,i){var n=this;if(!0===i)this.options.attrModel.withTransactionUpdate(function(){var i=e.attributesCustomization[t]?e.attributesCustomization[t]:t;switch(t){case"instanceName":var s=new d({columnIndex:t,label:i,grid:{attrTitle:i,attrVisible:!0,exportContent:!0,exportLock:!1,canBeGrouped:!1,attrRemove:!0,columnColor:{background_color:"#ffffff",color:"#000000"},pinContent:"left",attrName:t,hasTitle:!0},modelEvents:n.options.modelEvents});(o=n.__locateFirstAndLastPin("right")).first?n.options.attrModel.insertBefore(s,o.first):n.options.attrModel.addChild(s);break;case"instanceMatrix":var o,a=new d({columnIndex:t,label:i,grid:{attrTitle:i,attrVisible:!0,exportContent:!0,exportLock:!1,canBeGrouped:!1,attrRemove:!0,columnColor:{background_color:"#ffffff",color:"#000000"},pinContent:"unpinned",attrName:t,hasTitle:!0},modelEvents:n.options.modelEvents});(o=n.__locateFirstAndLastPin("right")).first?n.options.attrModel.insertBefore(a,o.first):n.options.attrModel.addChild(a)}});else{var s=this.options.attrModel.search({match:function(e){return e.nodeModel.options.label===t||e.nodeModel.options.columnIndex===t}});this.options.attrModel.withTransactionUpdate(function(){for(var e=0;e<s.length;e++)n.options.attrModel.removeRoot(s[e])})}},_manageThumbnailAttribute:function(t,i){var n=this;if(!0===i)this.elements.comboCompact.disabled(!0),this.options.attrModel.withTransactionUpdate(function(){var i=e.attributesCustomization[t]?e.attributesCustomization[t]:t,s=new d({columnIndex:t,label:i,grid:{attrTitle:i,attrVisible:!0,exportContent:!1,exportLock:!0,canBeGrouped:!1,attrRemove:!0,columnColor:{background_color:"#ffffff",color:"#000000"},pinContent:"unpinned",attrName:t,hasTitle:!1},modelEvents:n.options.modelEvents}),o=n.__locateFirstAndLastPin("right");o.first?n.options.attrModel.insertBefore(s,o.first):n.options.attrModel.addChild(s)});else{this.elements.comboCompact.disabled(!1);var s=this.options.attrModel.search({match:function(e){return e.nodeModel.options.label===t||e.nodeModel.options.columnIndex===t}});this.options.attrModel.withTransactionUpdate(function(){for(var e=0;e<s.length;e++)n.options.attrModel.removeRoot(s[e])})}},__locateFirstAndLastPin:function(e){for(var t,i,n=this.options.attrModel.getRoots(),s=0;s<n.length&&(!t||!i);s++)n[s].getReferenceValue("pinContent")!==e||t?n[s].getReferenceValue("pinContent")!==e&&t&&(i=n[s-1]):t=n[s];return t&&!i&&(i=n[n.length-1]),{first:t,last:i}}})}),define("DS/ENOX3DSpaceAttributesMgt/services/fetchClassificationServices",["UWA/Core","DS/ENOX3DSpaceAttributesMgt/services/loadModuleUtils","DS/ENOX3DSpaceAttributesMgt/services/predicatesServices","i18n!DS/ENOX3DSpaceAttributesMgt/assets/nls/ENOXAttributesMgtNls.json"],(e,t,i,n)=>{const s={name:"ClassificationAttributes",nlsName:n.Classification.title,declareIn:["VPMReference"]};class o{static get classificationExtensionProperties(){return"function"!=typeof s.isAvailable&&(s.isAvailable=async function(){if(Reflect.has(this,"ClassificationUtil"))return e.is(this.ClassificationUtil);try{this.ClassificationUtil=await t.loadRuntimeLibrary("DS/ClassificationUtil/ClassificationUtil")}catch(e){this.ClassificationUtil=null}return e.is(this.ClassificationUtil)}),s}static async fetchPropertiesForClassificationClass(e){const{settingManager:t}=e||{};if(!t||"function"!=typeof t.getLanguage)throw new Error("fetchClassificationServices.fetchPropertiesForClassificationClass invalid inputs");if(!await this.classificationExtensionProperties.isAvailable())throw new Error("ClassificationUtil loading fails");let i=null;try{i=await new Promise((i,n)=>{const{ClassificationUtil:s}=this.classificationExtensionProperties;s.fetchClassificationAttributes({apiVersion:"R2019x",lang:t.getLanguage(),onComplete(t){const n="string"==typeof t?JSON.parse(t):t;o.updateNlsPropertiesForClassificationClass(n,e).catch(()=>{console.error("problems fetching nls properties for classification attributes")}).finally(()=>{Array.isArray(n)&&(n.forEach(e=>{const{properties:t}=e;Array.isArray(t)&&t.forEach(e=>{-1===Reflect.ownKeys(e).indexOf("userAccess")&&(e.userAccess="ReadWrite")})}),o.classifClasses=n),i(n)})},onFailure(e){o.classifClasses=[],n(e)}})})}catch(e){throw new Error(`fetchClassificationAttributes fails ${e}`)}return i}static syncFetchPropertiesForClassificationClass(){return o.classifClasses?e.clone(o.classifClasses):null}static async updateNlsPropertiesForClassificationClass(e,t){if(!Array.isArray(e)||!t)throw new Error("invalid inputs");const[n]=e,{properties:s}=n||{};if(!Array.isArray(s))throw new Error("invalid inputs");const o=s.filter(e=>{const{curi:t}=e;return!i.isAGeneratedPredicate(t)});if(!o.length)return;const a=o.map(e=>e.curi),r=[...new Set(a)];let l=null;try{l=await i.getNLSPropertiesForClass(r,t)}catch(e){return void console.error("updateNlsPropertiesForClassificationClass: problem with getNLSPropertiesForClass")}o.forEach(e=>{const{curi:t}=e,i=l[t],{label:n}=i||{};"string"==typeof n&&(e.label=n)})}}return o}),define("DS/ENOX3DSpaceAttributesMgt/services/fetchPredicatesServices",["DS/ENOX3DSpaceAttributesMgt/services/fetchClassificationServices","DS/ENOX3DSpaceAttributesMgt/services/fetchDictionaryServices"],(e,t)=>{return class{static async getPropertiesForClasses(i,n){if(!Array.isArray(i)||!i.length||!n)throw new Error("invalid input");const s=i.indexOf(e.classificationExtensionProperties.name);let o=i;-1!==s&&(o=[...i]).splice(s,1);const a=[...new Set(o)].map(e=>`ds6wg:${e}`);let r=null;try{if(r=await t.fetchPredicatesForClasses(a,n),-1!==s)try{const t=await e.fetchPropertiesForClassificationClass(n);r.push(...t)}catch(e){console.error("error with predicatesServices fetching classification class attributes")}}catch(e){console.error("error with predicatesServices fetching class attributes")}return r}}}),define("DS/ENOX3DSpaceAttributesMgt/views/private/MoreAttributesWizard",["css!DS/PADServices/PADServices","UWA/Core","UWA/Controls/Abstract","DS/PADServices/utils/GlobalUtils","DS/PADServices/views/private/WizardSteps","text!DS/PADServices/assets/init/MoreAttrWizardSteps.json","DS/PADServices/views/private/SearchInput","DS/PADServices/views/private/Iconbar","DS/ENOX3DSpaceAttributesMgt/views/AttributesCommons","DS/PADServices/utils/DictionaryMgt","DS/Controls/Button","DS/Controls/Loader","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/Utilities/Utils","DS/ENOX3DSpaceAttributesMgt/services/predicatesServices","DS/ENOX3DSpaceAttributesMgt/services/fetchPredicatesServices","DS/ENOX3DSpaceAttributesMgt/services/fetchClassificationServices","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/PADServices/assets/nls/PADServices.json","i18n!DS/ENOX3DSpaceAttributesMgt/assets/nls/ENOXAttributesMgtNls.json"],(e,t,i,n,s,o,a,r,l,d,c,u,p,h,m,f,b,g,v,y,w,A,C,E)=>{const I=JSON.parse(o),M={attributesView:"attributesView",typesView:"typesView",extensionsView:"extensionsView"},S=E.isCellEditableColumns.title,x=E.attributeForEditingColumns.title,V={properties:[function(){return{property:"dataIndex",value:this.options.grid.dataIndex}},function(){return{property:"attrName",value:this.options.grid.attrName}},function(){return{property:"attrParent",value:this.options.grid.attrParent}},function(){return{property:"attrDim",value:this.options.grid.attrDim}},function(){return{property:"attrUnit",value:this.options.grid.attrUnit}},function(){return{property:"label",value:this.options.label}},function(){return{property:"kind",value:this.options.grid.attrKind}},function(){return{property:"description",value:this.options.grid.attrDesc}},function(){return{property:"attrSelectable",value:this.options.grid.attrSelectable}},function(){return{property:"attrNature",value:this.options.grid.attrNature}},function(){return{property:"attrUserAccess",value:this.options.grid.attrUserAccess}},function(){return{property:"attrRangeValue",value:this.options.grid.attrRangeValue}},function(){return{property:"attrEditable",value:this.options.grid.attrEditable}}]};return A.setNotificationManager(w),i.extend({name:"more-attr",defaultOptions:{baseTypes:[],baseInstanceTypes:[],selectedTypes:[],automaticExtensions:[],selectedExtensions:[],selectedAttributes:[],defaultTypes:[],defaultExtensions:[],subscribeTokens:[],modelEvents:null,renderTo:null,steps:null,activeView:null,maps:{referenceTypes:[],instanceTypes:[],documentTypes:[]},views:{typesView:null,extensionsView:null,attributesView:null},toolbar:null,grids:{},models:{},dgvOptions:{defaultColumnDef:{width:"auto",typeRepresentation:"string"},showRowBorderFlag:!0,alternateBackgroundFlag:!1,columns:[{icon:{iconName:"check",fontIconFamily:1},dataIndex:"attrSel",typeRepresentation:"boolean",alwaysVisibleFlag:!0,width:40,resizableFlag:!1,editableFlag:!0,editionPolicy:"EditionInPlace",getCellEditableState:function(e){var t=!0;return e.nodeModel&&e.nodeModel.getReferenceValue("attrRO")&&(t=!1),t}},{dataIndex:"attrParent",editableFlag:!1,width:30,sortableFlag:!0,resizableFlag:!1,getCellTypeRepresentation:function(e){return e.nodeModel&&e.nodeModel.options.grid.attrParent?e.nodeModel.options.grid.attrParent:"Unknown"},getCellSemantics:function(e){if(e.nodeModel)return{disabled:!0}}},{dataIndex:"tree",text:C.moreAttributesWizard.attrTitle}]},dgvLayoutOptions:{cellHeight:26,columnHeaderHeight:38,rowsHeader:!1}},init:function(e){this._parent(e),this._realInit(e)},_realInit:async function(){const e=n.isWebInWinContext()?"-immersivePanelWebInWin":"-immersivePanel";this.elements.container=t.createElement("div",{class:this.getClassNames(e)}),this.instanceMgt=this.options.baseInstanceTypes&&this.options.baseInstanceTypes.length>0,await this._buildBody(),await this._buildFooter(),this.switchView(I.activeStep),this.options.subscribeTokens.push(this.options.modelEvents.subscribe({event:"ENXViews/WizardSteps/stepChanged"},e=>{const t=e.stepId;this.switchView(t)})),this.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{restore:!0}}),this.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{idView:"moreAttr",html:this.elements.container}})},destroy:function(){this.options.subscribeTokens.forEach(e=>this.options.modelEvents.unsubscribe(e)),this.options.toolbar.destroy(),Object.keys(this.options.grids).forEach(e=>{this.options.grids[e].destroy(),this.options.grids[e]=null}),this._parent()},_buildBody:function(){return new Promise(e=>{this.elements.wizard=t.createElement("div",{class:this.getClassNames("-wizard")}).inject(this.elements.container),this.options.wizard=new s({modelEvents:this.options.modelEvents,renderTo:this.elements.wizard,steps:I});const i=t.createElement("div",{class:this.getClassNames("-toolbar-container")}).inject(this.elements.container);this.elements.content=t.createElement("div",{class:this.getClassNames("-content")}).inject(this.elements.container),this._generateToolbar({renderTo:i}),e()})},_buildFooter:function(){return new Promise((e,i)=>{this.elements.footer=t.createElement("div",{class:this.getClassNames("-footer")}).inject(this.elements.container);const n=new c({label:C.moreAttributesWizard.next,value:"next",emphasize:"primary",touchMode:!0});this.elements.nextButton=n,n.addEventListener("click",()=>{if("typesView"===this.options.activeView)this.options.modelEvents.publish({event:"ENXViews/WizardSteps/changeStep",data:{stepId:"extensionsView"}});else if("extensionsView"===this.options.activeView)this.options.modelEvents.publish({event:"ENXViews/WizardSteps/changeStep",data:{stepId:"attributesView"}});else if("attributesView"===this.options.activeView){const e=this.options.models.attributesView.search({match:e=>!0===e.nodeModel.options.grid.attrSel}).map(e=>e.dump(V)),t=[].concat(this.options.selectedExtensions).concat(this.options.automaticExtensions);this.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/selectedAttributes",data:{selectedAttributes:e,selectedTypes:this.options.selectedTypes,selectedExtensions:t}}),this.destroy()}}),n.inject(this.elements.footer);const s=new c({label:C.moreAttributesWizard.cancel,emphasize:"secondary",touchMode:!0});this.elements.closeButton=s,s.addEventListener("click",()=>{this.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/closeWizard"}),this.destroy()}),s.inject(this.elements.footer),e()})},switchView:function(e){if(this.options.activeView!==e)if(this.elements.toolbarSearch.clear(),this.__setToolbarCmds(e),this.options.previousView=this.options.activeView,this.options.activeView=e,null===this.options.views[e]){const n=this.elements.content.getElement("div.more-attr-chooser-view");n&&this.elements.content.removeChild(n),t.is(this.elements.loader)||(this.elements.loaderDiv=t.createElement("div",{class:this.getClassNames("-loader")}).inject(this.elements.content),this.elements.loader=(new u).inject(this.elements.loaderDiv),this.elements.loader.getContent().addClassName("enx-loader")),this.elements.loaderDiv.removeClassName("hidden"),this.elements.loader.on();const s=[];let o=null,a=0,r=I.steps.length;do{I.steps[a].id===e&&(o=I.steps[a]),a++}while(a<r||null===o);if(o.prerequisiteViews)for(var i=0;i<o.prerequisiteViews.length;i++)null===this.options.views[o.prerequisiteViews[i]]&&s.push(this["_build"+o.prerequisiteViews[i]](!0));Promise.all(s).then(()=>{this["_build"+e]().then(e=>{this.elements.loaderDiv.addClassName("hidden"),this.elements.loader.off(),this.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/viewReady",data:{activeView:this.options.activeView}})})})}else{const t=this.elements.content.getElements("div.more-attr-chooser-view");if(t&&Array.isArray(t)&&t.forEach(e=>{this.elements.content.removeChild(e)}),this.options.views[e].inject(this.elements.content),!0===this.typesUpdated&&"extensionsView"===this.options.activeView)this.__updateExtensionsView().then(()=>{delete this.typesUpdated,this.extensionsUpdated=!0,this.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/viewReady",data:{activeView:this.options.activeView}})});else if(!0!==this.typesUpdated&&!0!==this.extensionsUpdated||"attributesView"!==this.options.activeView){this.options.grids[this.options.activeView].getContent().removeClassName("loading"),"extensionsView"===this.options.activeView||"typesView"===this.options.activeView?this.elements.nextButton.label=C.moreAttributesWizard.next:this.elements.nextButton.label=C.moreAttributesWizard.done,this.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/viewReady",data:{activeView:this.options.activeView}})}else this.__updateAttributesView().then(()=>{delete this.typesUpdated,delete this.extensionsUpdated,this.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/viewReady",data:{activeView:this.options.activeView}})})}},_buildtypesView:function(e){return new Promise((i,s)=>{this.elements.nextButton.label=C.moreAttributesWizard.next,this.elements.nextButton.disabled=!0,this.options.wizard.getContent().addClassName("disabled"),this.options.views.typesView=t.createElement("div",{class:this.getClassNames("-typesView more-attr-chooser-view")});const o=t.createElement("div",{class:this.getClassNames("-typesViewDgv more-attr-dgv-container")}).inject(this.options.views.typesView),a=t.extend({identifier:"MoreAttrWizard-"+n.uid()},t.clone(this.options.dgvOptions));a.layout=new f(this.options.dgvLayoutOptions);const r=this.options.grids.typesView=new m(a);this._declareInstRefTypeReps(r),r.onContextualEvent=(()=>[]),r.getCellTooltip=(e=>{const t=this.options.grids.typesView.getColumnOrGroup(e.columnID).dataIndex;if(e.dataIndex=t,-1===e.rowID)return{shortHelp:C.moreAttributesWizard[t],updateModel:!1}}),r.mandatorySelected=this.options.defaultTypes,this.options.models.typesView=new p({}),r.treeDocument=this.options.models.typesView,r.getContent().addClassName("enxdatagridview loading"),r.getContent().inject(o),this.options.views.typesView.inject(this.elements.content),r.onReady(()=>{this.__updateTypesViewModel(!0).finally(()=>{!0!==e&&(r.getContent().removeClassName("loading"),this.elements.nextButton.disabled=!1,this.options.wizard.getContent().removeClassName("disabled")),i()}),r.addEventListener("change",this._changeType.bind(this))})})},_changeType:function(e,t){var i=this.options.grids[this.options.activeView];if(t&&t.nodeModel&&t.nodeModel.options.grid&&"attrSel"===i.layout.getDataIndexFromColumnIndex(t.columnID)){var n=t.nodeModel.getReferenceValue("attrName"),s=this.options.selectedTypes.indexOf(n);!0===t.nodeModel.options.grid.attrSel?-1===s&&this.options.selectedTypes.push(n):-1!==s&&this.options.selectedTypes.splice(s,1),this.typesUpdated=!0}},_buildextensionsView:function(e){var i=this;return new Promise(function(s,o){i.elements.nextButton.label=C.moreAttributesWizard.next,i.elements.nextButton.disabled=!0;i.options.wizard.getContent().addClassName("disabled"),i.options.views.extensionsView=t.createElement("div",{class:i.getClassNames("-extensionsView more-attr-chooser-view")});var a=t.createElement("div",{class:i.getClassNames("-extensionsView-Dgv more-attr-dgv-container")}).inject(i.options.views.extensionsView),r=t.extend({identifier:"MoreAttrWizard-"+n.uid()},t.clone(i.options.dgvOptions));r.layout=new f(i.options.dgvLayoutOptions);var l=i.options.grids.extensionsView=new m(r);i._declareInstRefTypeReps(l),l.onContextualEvent=function(){return[]},l.getCellTooltip=function(e){var t=i.options.grids.extensionsView.getColumnOrGroup(e.columnID).dataIndex;return e.dataIndex=t,-1===e.rowID?{shortHelp:C.moreAttributesWizard[t],updateModel:!1}:e.nodeModel?{shortHelp:C.replace(C.moreAttributesWizard.declaredInWithTypes,{types:e.nodeModel.getReferenceValue("attrInTypeNLS").join("\n")}),updateModel:!1}:void 0}.bind(this),l.mandatorySelected=i.options.defaultExtensions,i.options.models.extensionsView=new p({}),i.options.models.autoExtensionsView=new p({}),l.treeDocument=i.options.models.extensionsView,l.getContent().addClassName("enxdatagridview loading"),l.getContent().inject(a),i.options.views.extensionsView.inject(i.elements.content),l.onReady(function(){i.__updateExtensionsViewModel(!0).finally(function(){!0!==e&&(l.getContent().removeClassName("loading"),i.elements.nextButton.disabled=!1,i.options.wizard.getContent().removeClassName("disabled")),s({})}),l.addEventListener("change",i._changeExtension.bind(i))})})},_checkExtensionSelectionValidity:async function(e){if("ClassificationAttributes"===e){if(!await y.classificationExtensionProperties.isAvailable())throw w.addNotif({level:"error",title:"Classification",message:"Classification attributes are not available.\nPlease checks that ENOVIAIPClassificationFoundation (LBC) is present."}),new Error("Classification not valid env")}},_changeExtension:async function(e,t){const i=this.options.grids[this.options.activeView];if(t&&t.nodeModel&&t.nodeModel.options.grid&&"attrSel"===i.layout.getDataIndexFromColumnIndex(t.columnID)){const i=t.nodeModel.getReferenceValue("attrName");var n=this.options.selectedExtensions.indexOf(i);if(!0===t.nodeModel.options.grid.attrSel){if(-1===n)try{await this._checkExtensionSelectionValidity(i),this.options.selectedExtensions.push(i)}catch(e){t.nodeModel.prepareUpdate(),t.nodeModel.setAttribute("attrSel",!1),t.nodeModel.pushUpdate()}}else-1!==n&&this.options.selectedExtensions.splice(n,1);this.extensionsUpdated=!0}},buildAdditionalAttributesColumns:function(){return[{text:S,dataIndex:"attrEditable",typeRepresentation:"boolean",editableFlag:!1,width:150,sortableFlag:!1,resizableFlag:!0,editionPolicy:"EditionInPlace",getCellEditableState:function(e){if(!e||!e.nodeModel)return!1;if(e.nodeModel.getAttributeValue("attrIsAnAppPredicate"))return!1;const t=e.nodeModel.getAttributeValue("attrPredicate");return!(!t.isEditable&&!t.canBeForceForEdition)&&!(t.isEditable&&!t.forceEdition)},setCellValue:function(e,t){if(!e||!e.nodeModel)return;let i=null;if(t){const t=e.nodeModel.getAttributeValue("attrEditableSelectables");if(Array.isArray(t)&&t.length){const{value:n}=t[0];i=n,e.nodeModel.setAttribute("attrSelectable",i)}}else e.nodeModel.setAttribute("attrSelectable",null);e.nodeModel.getAttributeValue("attrPredicate").forceEditionWith=i,e.nodeModel.prepareUpdate(),e.nodeModel.setAttribute("attrEditable",t),e.nodeModel.pushUpdate()}},{text:x,dataIndex:"attrSelectable",typeRepresentation:"string",editableFlag:!1,width:350,sortableFlag:!1,resizableFlag:!0,editionPolicy:"EditionInPlace",getCellValue:function(e){if(!e||!e.nodeModel)return"";if(e.nodeModel.getAttributeValue("attrIsAnAppPredicate"))return"";if(!e.nodeModel.getAttributeValue("attrEditable"))return"";const t=e.nodeModel.getAttributeValue("attrPredicate");return t.isEditable&&!t.forceEdition?"":e.nodeModel.getAttributeValue("attrSelectable")},setCellValue:function(e,t){if(!e||!e.nodeModel)return"";e.nodeModel.getAttributeValue("attrPredicate").forceEditionWith=t,e.nodeModel.prepareUpdate(),e.nodeModel.options.grid.attrSelectable=t,e.nodeModel.pushUpdate()},getCellEditableState:function(e){if(!e||!e.nodeModel)return!1;return!e.nodeModel.getAttributeValue("attrIsAnAppPredicate")&&(!!e.nodeModel.getAttributeValue("attrEditable")&&!!e.nodeModel.getAttributeValue("attrSelectablesEnum"))},getCellTypeRepresentation:function(e){if(!e||!e.nodeModel)return"string";return e.nodeModel.getAttributeValue("attrIsAnAppPredicate")?"string":e.nodeModel.getAttributeValue("attrEditable")&&e.nodeModel.getAttributeValue("attrSelectablesEnum")||"string"}}]},_buildattributesView:function(e){const{predicatesManagedByApplication:i}=this.options;var s=this;return new Promise(i=>{s.elements.nextButton.label=C.moreAttributesWizard.done,s.elements.nextButton.disabled=!0;s.options.wizard.getContent().addClassName("disabled"),s.options.views.attributesView=t.createElement("div",{class:s.getClassNames("-attributesView more-attr-chooser-view")});var o=t.createElement("div",{class:s.getClassNames("-attributesView-Dgv more-attr-dgv-container")}).inject(s.options.views.attributesView),a=t.extend({identifier:"MoreAttrWizard-"+n.uid()},t.clone(s.options.dgvOptions));let r=null;a.layout=new f(s.options.dgvLayoutOptions),(r=s.options.grids.attributesView=new m(a)).onContextualEvent=function(){return[]},r.getCellTooltip=function(e){var t=s.options.grids.attributesView.getColumnOrGroup(e.columnID).dataIndex;if(e.dataIndex=t,-1===e.rowID)return{shortHelp:C.moreAttributesWizard[t],updateModel:!1};if(e.nodeModel){var i=e.nodeModel.getReferenceValue("attrInTypeNLS");return{shortHelp:C.replace(C.moreAttributesWizard.declaredInWithTypes,{types:i?i.join("\n"):""}),updateModel:!1}}}.bind(this),r.mandatorySelectedWithParent={Reference:["ds6w:label","ds6w:type"]},s.options.models.attributesView=new p({}),r.treeDocument=s.options.models.attributesView,r.getContent().addClassName("enxdatagridview loading"),r.getContent().inject(o),s.options.views.attributesView.inject(s.elements.content),r.onReady(function(){var t=[];void 0===s.options.grids.extensionsView&&t.push(s._buildextensionsView(!0)),Promise.all(t).then(s.__updateAttributesViewModel.bind(s)).finally(function(){!0!==e&&(r.getContent().removeClassName("loading"),s.elements.nextButton.disabled=!1,s.options.wizard.getContent().removeClassName("disabled")),i()}),r.addEventListener("change",s._changeAttributes.bind(s))})})},_changeAttributes:function(e,t){var i=this.options.grids[this.options.activeView];if(t&&t.nodeModel&&t.nodeModel.options.grid)if("attrSel"===i.layout.getDataIndexFromColumnIndex(t.columnID)){var n=this.options.selectedAttributes.indexOf(t.nodeModel.getLabel());if(!0===t.nodeModel.options.grid.attrSel){if(-1===n){const e={name:t.nodeModel.getReferenceValue("attrName"),instRef:t.nodeModel.getReferenceValue("attrParent")},i=t.nodeModel.getReferenceValue("attrEditable");"boolean"==typeof i&&(e.attrEditable=i,e.attrSelectable=t.nodeModel.getReferenceValue("attrSelectable")),this.options.selectedAttributes.push(e)}}else-1!==n&&this.options.selectedAttributes.splice(n,1)}else if("attrEditable"===i.layout.getDataIndexFromColumnIndex(t.columnID)){if(!0===t.nodeModel.options.grid.attrSel){const e=this.options.selectedAttributes.findIndex(e=>e.name===t.nodeModel.getReferenceValue("attrName"));this.options.selectedAttributes[e].attrEditable=t.nodeModel._options.grid.attrEditable}}else if("attrSelectable"===i.layout.getDataIndexFromColumnIndex(t.columnID)&&!0===t.nodeModel.options.grid.attrSel){const e=this.options.selectedAttributes.findIndex(e=>e.name===t.nodeModel.getReferenceValue("attrName"));this.options.selectedAttributes[e].attrSelectable=t.nodeModel._options.grid.attrSelectable}},_generateToolbar:function(e){var i=this,n=b.debounce(function(e){i.options.models[i.options.activeView].withTransactionUpdate(function(){var t=e.searchStr,n=!0;i.options.filterInProgress=!0,i.options.models[i.options.activeView].search({match:function(e){(function(e,t){var i=!1,n=new RegExp(e,"i");return(n.test(t.nodeModel.options.grid.attrTitle)||n.test(t.nodeModel.getLabel()))&&(i=!0),i})(t,e)&&i._isNodeVisible(e.nodeModel)?(e.nodeModel.show(),t.length>0&&n?(e.nodeModel.select(!0),e.nodeModel.matchSearch(),n=!1):(e.nodeModel.unmatchSearch(),e.nodeModel.unselect())):(e.nodeModel.unmatchSearch(),e.nodeModel.unselect(),e.nodeModel.hide())}}),i.options.filterInProgress=!1}),i.options.models[i.options.activeView].getXSO().onPostAdd(function(){}),i.options.models[i.options.activeView].getXSO().onPostRemove(function(){})},500);this.elements.toolbar=t.createElement("div",{class:this.getClassNames("-toolbar")}).inject(e.renderTo);var s=t.createElement("div",{class:this.getClassNames("-toolbar-input")}).inject(this.elements.toolbar);this.elements.toolbarIconbar=t.createElement("div",{class:this.getClassNames("-toolbar-iconbar")}).inject(this.elements.toolbar);s.addEventListener("touchstart",function(e){e.target.style.fontSize="16px"},!1),s.addEventListener("mouseleave",function(e){e.target.style.fontSize="14px"},!1),this.elements.toolbarSearch=new a({events:{onSearch:n}}).inject(s)},_isNodeVisible:function(e){switch(this.currentSelectFilter+"-"+this.currentInstRefFilter){case"none-none":return!0;case"selected-none":return!0===e.getReferenceValue("attrSel");case"unselected-none":return!1===e.getReferenceValue("attrSel");case"none-reference":return"Instance"!==e.getReferenceValue("attrParent");case"none-instance":return"Reference"!==e.getReferenceValue("attrParent");case"selected-reference":return!0===e.getReferenceValue("attrSel")&&"Instance"!==e.getReferenceValue("attrParent");case"selected-instance":return!0===e.getReferenceValue("attrSel")&&"Reference"!==e.getReferenceValue("attrParent");case"unselected-reference":return!1===e.getReferenceValue("attrSel")&&"Instance"!==e.getReferenceValue("attrParent");case"unselected-instance":return!1===e.getReferenceValue("attrSel")&&"Reference"!==e.getReferenceValue("attrParent")}return!0},__setToolbarCmds:function(e){var t=this;this.currentSelectFilter="none",this.currentInstRefFilter="none";var i,n=function(){t.options.models[t.options.activeView].withTransactionUpdate(function(){for(var e=t.options.models[t.options.activeView].getRoots(),i=(t.currentSelectFilter,t.currentInstRefFilter,0);i<e.length;i++){t._isNodeVisible(e[i])?e[i].show():e[i].hide()}}),t.options.models[t.options.activeView].getXSO().onPostAdd(function(){}),t.options.models[t.options.activeView].getXSO().onPostRemove(function(){})},s=(C.replace(C.moreAttributesWizard.reload,{what:C.moreAttributesWizard.availableTypes}),C.replace(C.moreAttributesWizard.reload,{what:C.moreAttributesWizard.availableExtensions}),C.replace(C.moreAttributesWizard.reload,{what:C.moreAttributesWizard.availableAttributes}),{fonticon:"tag-active",text:C.moreAttributesWizard.filterRowsKind,name:"filter-kind",content:{type:"dropdownmenu",options:{items:[{fonticon:"block",text:C.moreAttributesWizard.none,name:"none",selectable:!0,selected:!0},{fonticon:"product",text:C.moreAttributesWizard.filterreference,name:"reference",selectable:!0},{fonticon:"flow-cascade",text:C.moreAttributesWizard.filterinstance,name:"instance",selectable:!0}],events:{onClick:function(e,i){var s;s=i.name,t.currentInstRefFilter=s,n()}}}}}),o={fonticon:"filter",text:C.moreAttributesWizard.filterRows,name:"filter",content:{type:"dropdownmenu",options:{items:[{fonticon:"block",text:C.moreAttributesWizard.none,name:"none",selectable:!0,selected:!0},{fonticon:"checkbox-on",text:C.moreAttributesWizard.selected,name:"selected",selectable:!0},{fonticon:"checkbox-off",text:C.moreAttributesWizard.unselected,name:"unselected",selectable:!0}],events:{onClick:function(e,i){var s;s=i.name,t.currentSelectFilter=s,n()}}}}};if(!this.options.toolbar||this.options.toolbar.currentView!==e){if(!0===this.instanceMgt)switch(e){case"typesView":case"extensionsView":case"attributesView":i=[s,o]}else i=[{className:"divider"},o];var a={renderTo:this.elements.toolbarIconbar,items:i};this.options.toolbar&&(this.options.toolbar.destroy(),this.options.toolbar=null),this.options.toolbar=new r(a),this.options.toolbar.elements.container.setStyle("display",void 0)}},_declareInstRefTypeReps:function(e){var t={Reference:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"object-reference wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Instance:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"object-instance wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Both:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"part-replace",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Extension:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"part-add",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Unknown:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"i-question",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Document:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"doc",fontIconFamily:WUXManagedFontIcons.Font3DS}}}};e.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(t))},_checkSelected:function(e,t){const i=this.options.selectedAttributes.filter(i=>i.name===e&&i.instRef===t);return i.length>1&&console.warn("Several attributes found "+JSON.stringify(i)),1===i.length?i[0]:null},__updateTypesViewModel:async function(e){const i=this.options.baseInstanceTypes.length?this.options.baseTypes.concat(this.options.baseInstanceTypes):this.options.baseTypes;Array.isArray(this.options.baseDocumentTypes)&&this.options.baseDocumentTypes.length&&i.push(...this.options.baseDocumentTypes);const n=await d.getTypesInfo({baseTypes:i},e);this.typesInfos=n,Reflect.ownKeys(n).forEach(e=>{const i=n[e],s=-1!==this.options.selectedTypes.indexOf(e),o=i.parent||e;let a=-1!==this.options.baseTypes.indexOf(o)||-1!==this.options.baseDocumentTypes.indexOf(o)?"Reference":-1!==this.options.baseInstanceTypes.indexOf(o)?"Instance":"Unknown";(()=>!(!t.is(localStorage)||!t.is(localStorage.getItem("XEN_setSpecificIconForDocument")))&&"true"===localStorage.getItem("XEN_setSpecificIconForDocument"))()&&(a=-1!==this.options.baseTypes.indexOf(o)?"Reference":-1!==this.options.baseInstanceTypes.indexOf(o)?"Instance":-1!==this.options.baseDocumentTypes.indexOf(o)?"Document":"Unknown");const r=new h({label:i.displayName,grid:{attrName:e,attrTitle:i.displayName,attrSel:s,attrParent:a},icons:[i.iconUrl]});this.options.models.typesView.addRoot(r,s?0:void 0);let l=null;switch(a){case"Reference":l=this.options.maps.referenceTypes;break;case"Instance":l=this.options.maps.instanceTypes;break;case"Document":l=this.options.maps.documentTypes;break;default:l=null}l&&-1===l.indexOf(e)&&l.push(e)})},__updateExtensionsView:async function(){this.elements.loader.on(),this.elements.loaderDiv.removeClassName("hidden"),this.options.grids.extensionsView.getContent().addClassName("loading"),this.elements.nextButton.disabled=!0,this.options.wizard.getContent().addClassName("disabled"),this.options.models.extensionsView.removeRoots(),await this.__updateExtensionsViewModel(!0),this.elements.loader.off(),this.options.grids.extensionsView.getContent().removeClassName("loading"),this.elements.nextButton.disabled=!1,this.options.wizard.getContent().removeClassName("disabled")},__updateExtensionsViewModel:async function(e){const t=await d.interfaces({onlyCustomer:!1,classes:this.options.selectedTypes},e);Array.isArray(this.options.baseExtensions)&&this.options.baseExtensions.forEach(e=>{t.extensions[e.name]||(t.extensions[e.name]=e)});const i=y.classificationExtensionProperties;t.extensions[i.name]=i,Reflect.ownKeys(t.extensions).forEach(e=>{const i=-1!==this.options.selectedExtensions.indexOf(e),n=t.extensions[e],s=this.buildAnExtensionTreeNodelNode(e,n,i);this.options.models.extensionsView.addRoot(s,i?0:void 0)}),Reflect.ownKeys(t.automaticExtensions).forEach(e=>{const i=-1!==this.options.selectedExtensions.indexOf(e),n=t.automaticExtensions[e];if(!this.options.models.autoExtensionsView.search({match:t=>t.nodeModel.getReferenceValue("attrName")===e}).length){const t=this.buildAnExtensionTreeNodelNode(e,n,i);this.options.models.autoExtensionsView.addRoot(t,i?0:void 0),this.options.automaticExtensions.push(e)}})},buildAnExtensionTreeNodelNode(e,t,i){let n=!1,s=!1,o=[];t.declareIn.forEach(e=>{if(-1!==this.options.baseTypes.indexOf(e))n=!0;else if(-1!==this.options.baseInstanceTypes.indexOf(e))s=!0;else if(this.typesInfos&&Reflect.has(this.typesInfos,e)){const{parent:t}=this.typesInfos[e]||{};"string"==typeof t&&0!=t.trim().length&&(-1!==this.options.baseTypes.indexOf(t)?n=!0:-1!==this.options.baseInstanceTypes.indexOf(t)&&(s=!0))}o.push(d.getNLSForTypes(e))});let a="";return a=!0===n&&!0===s?"Both":!0===n?"Reference":!0===s?"Instance":"Unknown",new h({label:t.nlsName,grid:{attrName:e,attrTitle:t.nlsName,attrSel:i,attrInType:t.declareIn,attrInTypeNLS:o,attrParent:a}})},__updateAttributesView:async function(){this.elements.loader.on(),this.elements.loaderDiv.removeClassName("hidden"),this.options.grids.attributesView.getContent().addClassName("loading"),this.elements.nextButton.disabled=!0,this.elements.nextButton.label=C.moreAttributesWizard.done,this.options.wizard.getContent().addClassName("disabled"),this.options.models.attributesView.removeRoots(),await this.__updateAttributesViewModel(!0),this.elements.loader.off(),this.options.grids.attributesView.getContent().removeClassName("loading"),this.elements.nextButton.disabled=!1,this.options.wizard.getContent().removeClassName("disabled")},computeCustomTypeNameFromAttrName:function(e){return`${e.replace(/[^a-zA-Z0-9 ]/g,"")}Enum_${Date.now()}`},__updateAttributesViewModel:async function(e){const{automaticExtensions:t,selectedExtensions:i,selectedTypes:n,predicatesManagedByApplication:s,multiValuatedAttributes:o}=this.options,a=[].concat(t).concat(i).concat(n);let r=[],l=null;try{const e=await v.getPropertiesForClasses(a,this.options);r=g.getAttributePredicatesFromClassPredicates(e,s,o),l=await this.getSelectablesNlsForEditablePredicates(r,this.options)}catch(e){console.log("error with predicatesServices fetching class attributes")}const d=[];r.forEach(e=>{const{uri:t}=e;if(-1!==d.indexOf(t))return;const i=this.computeParentInfos(e),{attrParent:n}=i;try{if("Both"===n){const n=this.buildAnAttributeTreeModelNode(t,e,i,"Instance",l);this.addATreeModelNodeInView(n,M.attributesView),d.push(n.getReferenceValue("dataIndex"));const s=this.buildAnAttributeTreeModelNode(t,e,i,"Reference",l);this.addATreeModelNodeInView(s,M.attributesView),d.push(s.getReferenceValue("dataIndex"))}else{const s=this.buildAnAttributeTreeModelNode(t,e,i,n,l);this.addATreeModelNodeInView(s,M.attributesView),d.push(s.getReferenceValue("dataIndex"))}}catch(e){console.log("error with attribute node attributes")}})},async getSelectablesNlsForEditablePredicates(e,t){if(!Array.isArray(e)||!t)throw new Error("invalid inputs");const i=e.reduce((e,t)=>{const i=t.getSelectables(g.isAPredicateForEdition);return Array.isArray(i)&&i.length&&e.push(...i),e},[]);return await g.getNLSPropertiesForClass(i,t)},buildAnAttributeTreeModelNode(e,t,i,n,s){if(!e||!t||!i)throw new Error("invalid node inputs");if("Reference"!==n&&"Instance"!==n&&"Document"!==n)throw new Error("invalid parent type");const o=this._checkSelected(e,n),a=!!o;let{isEditable:r,selectable:l,isAnAppPredicate:d}=t;o&&"boolean"==typeof o.attrEditable&&null!==o.attrSelectable&&(r=o.attrEditable,l=o.attrSelectable);const c=t.getSelectables(g.isAPredicateForEdition);if(a&&l&&r){if(-1!==c.indexOf(l))r!==t.isEditable&&(t.forceEditionWith=l);else{t.findPredicateInfo(e=>e.selectable===l)?(r=t.isEditable,l=t.selectable):c.splice(0,0,l)}}const u={label:t.label,grid:{attrName:e,dataIndex:"Instance"===n?`${e}-Instance`:e,attrSel:a,attrRO:a,attrParent:n,attrInType:"Instance"===n?i.attrInTypeInst:[...i.attrInTypeRef,...i.attrInTypeDoc],attrInTypeNLS:"Instance"===n?i.attrInTypeInstNLS:[...i.attrInTypeRefNLS,...i.attrInTypeDocNLS],attrDim:t.dimension,attrUnit:t.manipulationUnit,attrTitle:t.label,attrDesc:t.description,attrKind:t.dataType,attrSelectable:r?l:null,attrNature:t.nature,attrUserAccess:t.userAccess,attrRangeValue:t.rangeValues,attrEditable:r,attrPredicate:t,attrIsAnAppPredicate:d}};if(c.length){let t=null;if(c.length>1){t=c.map(e=>{const{label:t}=s[e]||{};return{value:e,label:t||e}});const i=this.registerSelectablesTypeEnumForAttribute(e,t);i&&(u.grid.attrSelectablesEnum=i)}else{const[e]=c,{label:i}=s[e]||{};t=[{value:e,label:i||e}]}Array.isArray(t)&&(u.grid.attrEditableSelectables=t)}return new h(u)},registerSelectablesTypeEnumForAttribute(e,t){if(!e||!Array.isArray(t))return;const i=this.computeCustomTypeNameFromAttrName(e),n={};return n[i]={stdTemplate:"enumCombo",semantics:{valueType:"enumString",possibleValues:t}},this.options.grids[this.options.activeView].getTypeRepresentationFactory().registerTypeRepresentations(n),i},addATreeModelNodeInView(e,t){if(!e)throw new Error("invalid node");if(!M[t])throw new Error("unknow view type");if(!this.options.models[t])throw new Error("invalid view");const{attrSel:i}=e;this.options.models[t].addRoot(e,i?0:void 0)},computeParentInfos(e){let t="",i=!1,n=!1,s=!1,o=!1,a=[],r=[],l=[],c=[];attrInTypeDoc=[],attrInTypeDocNLS=[];const{inTypes:u}=e||{};return Array.isArray(u)?(u.forEach(e=>{const t=e.substring(e.indexOf(":")+1,e.length);let u=null;if(-1!==this.options.baseTypes.indexOf(t))i=!0;else if(-1!==this.options.baseInstanceTypes.indexOf(t))n=!0;else if(-1!==this.options.baseDocumentTypes.indexOf(t))o=!0;else if(-1!==this.options.selectedExtensions.indexOf(t)||-1!==this.options.automaticExtensions.indexOf(t)){s=!0,u=this.options.models.extensionsView.search({match:e=>e.nodeModel.getReferenceValue("attrName")===t});const e=this.options.models.autoExtensionsView.search({match:e=>e.nodeModel.getReferenceValue("attrName")===t});if(u.push(...e),u.length){const e=u[0].getReferenceValue("attrParent");"Reference"===e?i=!0:"Document"===e?o=!0:"Instance"===e?n=!0:"Both"===e&&(i=!0,n=!0)}}if("XP_VPMReference_Ext"!==t&&"DELFmiContQuantity_Mass"!==t&&"DELFmiContQuantity_Volume"!==t||(i=!0,a.push("VPMReference"),r.push(d.getNLSForTypes("VPMReference"))),"ClassificationAttributes"===t&&(i=!0,a.push("VPMReference"),r.push(d.getNLSForTypes("VPMReference"))),-1!==this.options.maps.referenceTypes.indexOf(t)&&(i=!0,a.push(t),r.push(d.getNLSForTypes(e))),-1!==this.options.maps.instanceTypes.indexOf(t)&&(n=!0,l.push(t),c.push(d.getNLSForTypes(e))),-1!==this.options.maps.documentTypes.indexOf(t)&&(o=!0,attrInTypeDoc.push(t),attrInTypeDocNLS.push(d.getNLSForTypes(e))),s&&Array.isArray(u)&&u.length>0){var p=u[0],h=Array.isArray(p.options.grid.attrInType)?p.options.grid.attrInType[0]:"";-1!==this.options.maps.referenceTypes.indexOf(h)&&(i=!0,a.push(h),r.push(d.getNLSForTypes(e))),-1!==this.options.maps.instanceTypes.indexOf(h)&&(n=!0,l.push(h),c.push(d.getNLSForTypes(e))),-1!==this.options.maps.documentTypes.indexOf(h)&&(o=!0,attrInTypeDoc.push(h),attrInTypeDocNLS.push(d.getNLSForTypes(e)))}}),{attrParent:t=!0===i&&!0===n?"Both":!0===i?"Reference":!0===n?"Instance":!0===s?"Extension":!0===o?"Document":"Both",declaredInRef:i,declaredInInst:n,declaredInExt:s,attrInTypeRef:a,attrInTypeRefNLS:r,attrInTypeInst:l,attrInTypeInstNLS:c,declaredInDoc:o,attrInTypeDoc:attrInTypeDoc,attrInTypeDocNLS:attrInTypeDocNLS}):{attrParent:t,declaredInRef:i,declaredInInst:n,declaredInExt:s,declaredInDoc:o,attrInTypeRef:a,attrInTypeRefNLS:r,attrInTypeInst:l,attrInTypeInstNLS:c,attrInTypeDoc:attrInTypeDoc,attrInTypeDocNLS:attrInTypeDocNLS}}})});