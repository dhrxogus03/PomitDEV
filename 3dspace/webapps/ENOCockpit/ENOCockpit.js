function ENOCockpit(e){"use strict";var t={widget:null,pad3DViewer:null,landingPage:null,mainDiv:null,paddebug:!1,_availableForRole:!1,_prefManager:null,_tokenPrefMgr:null,init:function(e){this.pcsPrefix=e.widget.id?e.widget.id:"_"+e.widget.title,window.top.performance.mark(this.pcsPrefix+"_init"),window.top.performance.measure(this.pcsPrefix+"_call_init","ENOCockpit_load_html",this.pcsPrefix+"_init"),this.widget=e.widget,this.widget.addEvent("onLoad",this.onLoad.bind(this)),this.widget.addEvent("onRefresh",this.onRefresh.bind(this)),this.widget.addEvent("onSearch",this.onSearch.bind(this)),window.addEventListener("unload",this.onDestroy.bind(this))},onRefresh:function(){setTimeout(function(){this.pad3DViewer.refresh()}.bind(this),500)},onLoad:function(){var e=this;window.top.performance.mark(this.pcsPrefix+"_onload"),window.top.performance.measure(this.pcsPrefix+"_call_onload",this.pcsPrefix+"_init",this.pcsPrefix+"_onload"),window.top.performance.measure(this.pcsPrefix+"_fromHtmlToOnLoad","ENOCockpit_load_html",this.pcsPrefix+"_onload"),this.widget.setValue("tenantAware",!0),require(["DS/PADUtils/PADUtilsServices","DS/WebUAUtils/WebUAUtils"],function(t,i){i.setAppid("ENXDISC_AP"),require(["DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSharedSettings","text!DS/ENOCockpit/assets/json/ENOCockpitSettingsMgt.json","DS/ENOPAD3DViewer/PAD3DViewer","DS/Selection/CSOManager","UWA/Utils/Client","DS/Visualization/ThreeJS_DS","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/PADServices/utils/PADTrackerManager"],function(t,i,n,o,a,r,s,d,l){n=UWA.is(n,"string")?JSON.parse(n):n,null===t.app_context&&t.setApp(n,"enocockpit"),i.addSharedSettings(e.widget,["x3dPlatformId","showWelcomePanel","autoreload","pad_security_ctx","synthesisModeOnInstance","pgpFromServer"]);var g=n.actionBarWkb.standard;n.enocockpit.layout_options.frmWindow_opts.workbench=g.file,n.enocockpit.layout_options.frmWindow_opts.workbenchModule=g.module,null===e.pad3DViewer&&(!function(){t.setSetting("lang",e.widget.lang);var i=e.widget.getValue("enopad3dviewer_CGRorTHB");"boolean"==typeof i&&(i?e.widget.setValue("enopad3dviewer_CGRorTHB","HIGH"):e.widget.setValue("enopad3dviewer_CGRorTHB","OPTIMIZED"));var n=widget.getValue("authorizeChangeControl");UWA.is(n,"string")&&"true"===n.toLowerCase()&&t.setSetting("authorizeChangeControl",n),e.widget.addEvent("endEdit",t.updateWidgetPreferences.bind(t)),e.widget.addEvent("endEdit",function(i){if(i&&!1===i.submitted){var n="top-right";n=sessionStorage.getItem("changeControlPosition3DNavigation")?sessionStorage.getItem("changeControlPosition3DNavigation"):t.getSetting("changeControlPosition"),!1===e.widget.getBool("changeControlActivation")?(d.hide(),e.widget.addPreference({name:"changeControlPosition",type:"hidden",defaultValue:n})):(d.show(),e.widget.addPreference({name:"changeControlPosition",defaultValue:n,type:"list",label:"changeControlPosition_label",options:[{label:"top-right_label",value:"top-right"},{label:"top-left_label",value:"top-left"},{label:"bottom-left_label",value:"bottom-left"},{label:"bottom-right_label",value:"bottom-right"}]}))}}),e.widget.mergePreferences(t.getWidgetPreferences()),t.addEvent("onEnopad3dviewer_CGRorTHB",function(t){e.pad3DViewer&&e.pad3DViewer.getController()&&e.pad3DViewer.setDefaultStreamToLoad(t)}),t.addEvent("onPaddebug_section",function(t){e.pad3DViewer&&t&&!1===e.paddebug&&(e.paddebug=!0,e.pad3DViewer.loadActionBar({merge:!0,file:"PADDebug.xml",module:"PADDebug"}))}),t.updateWidgetPreferences()}(),require(["DS/PADServices/views/LandingPage","i18n!DS/ENOCockpit/assets/nls/ENOCockpit"],function(i,a){e.mainDiv=UWA.createElement("div",{class:"appMain",styles:{width:"auto",height:"100%"}}),e.landingPage=new i({widget:e.widget,readOnlyApp:!0,appTitle:"3D Navigate",description:a.appDescription,renderDiv:e.mainDiv,structKey:"xsceneStoredObjects",onLandingPageReady:function(t){e.widget.setBody(e.mainDiv)},onReady:function(){e.widget.dispatchEvent("onENOPADReady")}}),e.landingPage.initialize().then(function(i){window.top.performance.mark(e.pcsPrefix+"new pad3dviewer begin"),e.pad3DViewer=new o({widget:e.widget,css_view_class:e.css_view_class,windowOptions:n.enocockpit.layout_options.frmWindow_opts,allowAuthoring:!1,binaryPrimitives:!0,authorizeSet3DStructure:!0,selectiveLoading:UWA.is(t.getSetting("enopad3dviewer_selectiveLoading"),"boolean")?t.getSetting("enopad3dviewer_selectiveLoading"):"true"===t.getSetting("enopad3dviewer_selectiveLoading"),enableSidePanel:!0,propertiesFacet:UWA.is(t.getSetting("propertiesFacet"),"array")?t.getSetting("propertiesFacet"):[],objects2Load:i,pcsPrefix:e.pcsPrefix}),e.landingPage.setViewer(e.pad3DViewer),e.pad3DViewer.subscribe({event:"onActionBarReady"},function(){window.top.performance.mark(e.pcsPrefix+"actionbarInitDone"),window.top.performance.measure(e.pcsPrefix+"actionbarInit",e.pcsPrefix+"frameWindowInitBegin",e.pcsPrefix+"actionbarInitDone"),e.landingPage.appReady(),e.addChangeCtx(),t.getSetting("paddebug_section")&&!1===e.paddebug&&(console.log("PADDebug ActionBar added"),e.paddebug=!0,e.pad3DViewer.loadActionBar({merge:!0,file:"PADDebug.xml",module:"PADDebug"})),e.pad3DViewer.getLevelSelectorCommand&&e.pad3DViewer.getLevelSelectorCommand(function(e){e&&e.displayLabels(!0)})}),e.pad3DViewer.subscribe({event:"onReady"},function(){window.top.performance.mark(e.pcsPrefix+"init_pad3dviewer_done"),window.top.performance.measure(e.pcsPrefix+"3d_app_init","ENOCockpit_load_html",e.pcsPrefix+"init_pad3dviewer_done"),window.top.performance.measure(e.pcsPrefix+"init_landingpage",e.pcsPrefix+"_onload",e.pcsPrefix+"new pad3dviewer begin"),window.top.performance.measure(e.pcsPrefix+"require_pad3dviewer",e.pcsPrefix+"new pad3dviewer begin",e.pcsPrefix+"frameWindowInitBegin");var t=l.getPADTracker({eventCategory:"performance",eventAction:"3d_app_init"}),i=e.pad3DViewer.getPCSTrackerResult(e.pcsPrefix+"3d_app_init");t.setEventData({eventLabel:"app_loading_duration",eventValue:i.duration});var n=e.pad3DViewer.getPCSTrackerResult(e.pcsPrefix+"_call_init"),o=e.pad3DViewer.getPCSTrackerResult(e.pcsPrefix+"_call_onload"),a=e.pad3DViewer.getPCSTrackerResult(e.pcsPrefix+"init_landingpage"),r=e.pad3DViewer.getPCSTrackerResult(e.pcsPrefix+"require_pad3dviewer"),s=e.pad3DViewer.getPCSTrackerResult(e.pcsPrefix+"actionbarInit"),d=e.pad3DViewer.getPCSTrackerResult(e.pcsPrefix+"frameWindowInit");t.addMultivaluedEventData("3d_app_init",{call_init_start:n?n.startTime:0,call_init_duration:n?n.duration:0,call_onload_start:o?o.startTime:0,call_onload_duration:o?o.duration:0,init_landingpage_start:a?a.startTime:0,init_landingpage_duration:a?a.duration:0,require_pad3dviewer_start:r?r.startTime:0,require_pad3dviewer_duration:r?r.duration:0,actionbarInit_start:s?s.startTime:0,actionbarInit_duration:s?s.duration:0,frameWindowInit_start:d?d.startTime:0,frameWindowInit_duration:d?d.duration:0}),t.trackPageEvent(),require(["DS/CATWebUXPreferences/CATWebUXPreferencesManager","DS/CATWebUXPreferences/CATWebUXPreferencesUtils"],function(t,i){this._prefManager=t.getPreferenceManager({context:e.pad3DViewer.getFrameWindow()}),this._tokenPrefMgr=[],this._prefManager&&(this._prefManager.setUnitsPreferencesDisplayFlag(!0),this._prefManager.setDisplayPreferencesDisplayFlag(!0),this._prefManager.setPreferredPreferenceContainersOrder(["MeasurePreferences","SectionPreferences"]),i.readPreferences([{Repository:"VisualizationRepository",PreferenceNames:["Gravity"]},{Repository:"FrameGeneral",PreferenceNames:["ProjectionType"]}]).then(function(e){if(e&&e.repositories&&e.repositories.length){if(e.repositories[0].preferences&&1===e.repositories[0].preferences.length){const t="true"===e.repositories[0].preferences[0].value;this.pad3DViewer.getViewer().currentViewpoint.control.lockZ=t}if(e.repositories[1]&&e.repositories[1].preferences&&1===e.repositories[1].preferences.length){const t="Parallel"===e.repositories[1].preferences[0].value?1:0;this.pad3DViewer.getViewer().currentViewpoint.setProjectionType(t)}}}.bind(e)),this._tokenPrefMgr.push(this._prefManager.subscribe("com.ds.mep:onPrefUpdate",function(e){if(3===e.length&&e[1].preferences){const t=JSON.parse(e[1].preferences);for(let e=0;e<t.repositories.length;++e)if("VisualizationRepository"===t.repositories[e].name||"FrameGeneral"===t.repositories[e].name){const i=t.repositories[e].preferences;for(let e=0;e<i.length;++e){if("Gravity"===i[e].name&&this.pad3DViewer&&this.pad3DViewer.getViewer()&&this.pad3DViewer.getViewer().currentViewpoint){const t="true"===i[e].value;this.pad3DViewer.getViewer().currentViewpoint.control.lockZ=t}if("ProjectionType"===i[e].name){const t="Parallel"===i[e].value?1:0;this.pad3DViewer.getViewer().currentViewpoint.setProjectionType(t)}}}}}.bind(e))))});var g=e.widget.getValue("X3DContentId");e.widget.deleteValue("X3DContentId"),g&&setTimeout(function(){e.pad3DViewer.addRootNodesFromContent({json3DXContent:JSON.parse(g),dispatch:!1})},0)})})}))})})},onSearch:function(e){var t={searchQuery:e};this.pad3DViewer.search(t)},onDestroy:function(){require(["DS/CATWebUXPreferences/CATWebUXPreferencesManager"],function(e){e.unreferencePreferenceManager(this._prefManager)}.bind(this)),this.pad3DViewer&&(this.pad3DViewer.destroy(),this.pad3DViewer=null)},addChangeCtx:function(){var e=this,t=require("DS/PADUtils/PADSettingsMgt");!0===t.getSetting("authorizeChangeControl")&&require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/PADUtils/PADCommandProxy"],function(i,n){var o=e.pad3DViewer.elements.triptych.getMainPanelContainer();i.initialize2(o,n.appId(),"hide",t.getSetting("changeControlPosition"),function(o){e.debouncePrefSynchro=!1,e._proxy=n.create({events:{onPreferenceModification:function(i){"changeControlActivation"===i.name&&(e.debouncePrefSynchro=!0,e.widget.setValue(i.name,i.value),t.setSetting(i.name,i.value))}}});var a=t.getSetting("changeControlActivation");a=void 0!==e.widget.getValue("changeControlActivation")?e.widget.getBool("changeControlActivation"):o.isAuthoringContextVisible;var r="top-right";r=sessionStorage.getItem("changeControlPosition3DNavigation")?sessionStorage.getItem("changeControlPosition3DNavigation"):t.getSetting("changeControlPosition"),i.setPosition(r),e.widget.addPreference({name:"changeControlActivation",defaultValue:a,type:"boolean",label:"changeControlActivation_label",onchange:"onChangeControlUpdate"}),!0===a?(i.show(),e.widget.addPreference({name:"changeControlPosition",defaultValue:r,type:"list",label:"changeControlPosition_label",options:[{label:"top-right_label",value:"top-right"},{label:"top-left_label",value:"top-left"},{label:"bottom-left_label",value:"bottom-left"},{label:"bottom-right_label",value:"bottom-right"}]})):(i.hide(),e.widget.addPreference({name:"changeControlPosition",type:"hidden",defaultValue:r})),t.setSetting("changeControlActivation",a,!0),t.addEvent("onChangeControlActivation",e._onChangeControlActivation.bind(e)),i.addEvent&&i.addEvent("onAuthoringCtxVisible",function(i){t.setSetting("changeControlActivation",i.showAuthoringContext,!0),e._onChangeControlActivation(i.showAuthoringContext)}),t.addEvent("onChangeControlPosition",function(e){i.setPosition(e),sessionStorage.setItem("changeControlPosition3DNavigation",e)}),e.widget.addEvent("onChangeControlUpdate",function(i,n){var o="top-right";o=sessionStorage.getItem("changeControlPosition3DNavigation")?sessionStorage.getItem("changeControlPosition3DNavigation"):t.getSetting("changeControlPosition");var a=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");!1===n?(a.hide(),e.widget.addPreference({name:"changeControlPosition",type:"hidden",defaultValue:o})):(a.show(),e.widget.addPreference({name:"changeControlPosition",defaultValue:o,type:"list",label:"changeControlPosition_label",options:[{label:"top-right_label",value:"top-right"},{label:"top-left_label",value:"top-left"},{label:"bottom-left_label",value:"bottom-left"},{label:"bottom-right_label",value:"bottom-right"}]})),e.widget.dispatchEvent("onEdit")})})})},_onChangeControlActivation:function(e){var t=require("DS/PADUtils/PADSettingsMgt"),i=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");this.debouncePrefSynchro?this.debouncePrefSynchro=!1:this._proxy.preferenceModification({name:"changeControlActivation",value:e});var n="top-right";n=sessionStorage.getItem("changeControlPosition3DNavigation")?sessionStorage.getItem("changeControlPosition3DNavigation"):t.getSetting("changeControlPosition"),!0===e?(i.show(),this.widget.addPreference({name:"changeControlPosition",defaultValue:n,type:"list",label:"changeControlPosition_label",options:[{label:"top-right_label",value:"top-right"},{label:"top-left_label",value:"top-left"},{label:"bottom-left_label",value:"bottom-left"},{label:"bottom-right_label",value:"bottom-right"}]})):(i.hide(),this.widget.addPreference({name:"changeControlPosition",type:"hidden",defaultValue:n}))}};return t.init(e),t}define("DS/ENOCockpit/ENOCockpitTransition",["i18n!DS/ENOCockpit/assets/nls/ENOCockpit.json","i18n!DS/ENOPAD3DViewer/assets/nls/PAD3DViewer.json","DS/WAfrContainer/App","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/ApplicationFrame/CommandsManager","DS/PADServices/utils/PADTrackerManager","DS/CATWebUXPreferences/CATWebUXPreferencesManager"],function(e,t,i,n,o,a,r,s){"use strict";return i.extend({widget:null,pad3DViewer:null,landingPage:null,appMainDiv:null,paddebug:!1,debouncePrefSynchro:null,css_view_class:null,pcsPrefix:null,_proxy:null,_prefManager:null,_tokenPrefMgr:null,_evtIds:[],setUp:function(e){if(require(["DS/PADServices/utils/PADTrackerManager"],function(e){var t=e.getPADTracker({eventCategory:"usage",eventAction:"ENXDISC_AP_version"});t.setEventData({eventLabel:"AFR"}),t.trackPageEvent()}),this.widget=widget,this.widget.setTitle(""),this.onLoad=this.onLoad.bind(this),this.onRefresh=this.onRefresh.bind(this),this.onSearch=this.onSearch.bind(this),this.onDestroy=this.onDestroy.bind(this),e.sourceApp)if(e.sourceApp.pad3DViewer){this.pad3DViewer=e.sourceApp.pad3DViewer;var t=n.getLayout_options("frmWindow_opts");t&&t.viewerOptions&&t.viewerOptions.viewPanelConfig&&t.viewerOptions.viewPanelConfig.uiConfig&&this.pad3DViewer.getViewer().updateViewPanelUIConfiguration(t);var i=e.sourceApp.appMainDiv;e.sourceApp.appMainDiv||(i=widget.body.firstChild),e.sourceApp.dispose(),n.setSetting("enopad_webapis",!1),this.restoreENOCockpitApp(i),this.pad3DViewer&&this.pad3DViewer.getController&&this.pad3DViewer.getController()._enableElasticLoadingForTransition(),e.done()}else e.failure("3D Navigate - Unable to perform transition or create widget.");else this.pcsPrefix=widget.id?widget.id:"_"+widget.title,window.top.performance.mark(this.pcsPrefix+"_init"),this.createENOCockpitApp(),e.done()},dispose:function(e){this.widget&&this.widget.removeEvent&&(this.widget.removeEvent("onLoad",this.onLoad),this.widget.removeEvent("onRefresh",this.onRefresh),this.widget.removeEvent("onSearch",this.onSearch)),window.removeEventListener("unload",this.onDestroy);for(let e=0;e<this._evtIds.length;++e)this.pad3DViewer&&this.pad3DViewer.unsubscribe&&this.pad3DViewer.unsubscribe(this._evtIds[e]);this.landingPage&&(this.landingPage.dispose(),this.landingPage=null),s.unreferencePreferenceManager(this._prefManager),this._parent(e)},onWillEnter:function(e){var t=r.getPADTracker({eventCategory:"usage",eventAction:"transition-from"});return t.setEventData({eventLabel:e.options.id}),t.trackPageEvent(),e.pad3DViewer&&e.pad3DViewer.getController&&(e.pad3DViewer.getController()._enableStaticMappingSupport(),e.pad3DViewer.toggleStartupView(!0),n.setSetting("enopad_webapis",!1),require("DS/PADUtils/PADSession").softInit(!0,!0)),this._parent(e)},onWillLeave:function(t){var i=r.getPADTracker({eventCategory:"usage",eventAction:"transition-to"});return i.setEventData({eventLabel:t.options.id}),i.trackPageEvent(),!o.isCloud()&&this.pad3DViewer.getController().isLargeSession()&&(this.pad3DViewer.getController()._freezeRoots(),this.pad3DViewer.displayNotification({eventID:"warning",msg:e.rootFrozen})),!0===this._declineTransition("staticMapping")?Promise.reject(new Error(` ${e.transitionRefusedStaticMapping}`)):!0===this._declineTransition("flexAssemblies")?Promise.reject(new Error(` ${e.transitionRefusedFlexibleAssemblies}`)):(this.pad3DViewer.getController()._disableElasticLoadingForTransition(),this.pad3DViewer.toggleStartupView(!1),Promise.resolve())},restoreENOCockpitApp:function(e){this.resetCommands(),require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSharedSettings","text!DS/ENOCockpit/assets/json/ENOCockpitSettingsMgt.json","DS/Selection/CSOManager","UWA/Utils/Client","DS/Visualization/ThreeJS_DS","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/ENOXInterWdgCom/LinkManager"],function(i,o,a,r,s,d,l,g){a=UWA.is(a,"string")?JSON.parse(a):a,null===n.app_context&&n.setApp(a,"enocockpit"),o.addSharedSettings(this.widget,["x3dPlatformId","showWelcomePanel","autoreload","pad_security_ctx","synthesisModeOnInstance"]);var p=a.actionBarWkb.standard;a.enocockpit.layout_options.frmWindow_opts.workbench=p.file,a.enocockpit.layout_options.frmWindow_opts.workbenchModule=p.module,g.updateLinkability(a.enocockpit.run_options.widgetLink_options.value),n.setSetting("activateWidgetLink",!0),this._setupPreferences(),this.widget.addEvent("onLoad",this.onLoad),this.widget.addEvent("onRefresh",this.onRefresh),this.widget.addEvent("onSearch",this.onSearch),window.addEventListener("unload",this.onDestroy),require(["DS/PADServices/views/LandingPage","i18n!DS/ENOCockpit/assets/nls/ENOCockpit"],function(o,r){this.widget.setValue("showWelcomePanel",!1),this.landingPage=new o({widget:this.widget,readOnlyApp:!1,appTitle:"3D Navigate",description:r.appDescription,renderDiv:e,structKey:"xsceneStoredObjects",externalViewerMgt:!1,globalSearchPrecond:n.getSetting("landingPage_defaultSearchPrecondition"),onLandingPageReady:function(t){this.widget.setBody(e)}.bind(this),onReady:function(){this.widget.dispatchEvent("onENOPADReady")}.bind(this)}),this.landingPage.initialize().then(function(e){this.landingPage.setViewer(this.pad3DViewer,!0),window.top.performance.mark(this.pcsPrefix+"new pad3dviewer begin");var o=this.pad3DViewer.subscribe({event:"onActionBarReady"},function(){this.pad3DViewer.unsubscribe(o),this.pad3DViewer.registerDefaultContextMenu(a.enocockpit.layout_options.frmWindow_opts.contextualMenuContent),this.pad3DViewer.setDefaultContextualMenuVisibility(!0),this.pad3DViewer.setDefaultContextualBarVisibility(!0),this.pad3DViewer.setOpenWithMenuAvailability(!0),this.pad3DViewer.publish({event:"onReady",data:{injectInView:!0,fromTransition:!0}}),this.widget.addEvent("onChangeFlexibleAssembliesSupport",function(e,t){n.setSetting(e,t)}.bind(this)),this.pad3DViewer&&this.pad3DViewer.getController&&!i.isCloud()&&!this.pad3DViewer.getController()._elasticLoadingGranted?this.widget.getPreference("enopad3dviewer_flexibleAssemblySupportActivated")||(this.widget.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"boolean",defaultValue:!1,label:t.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:void 0!==this.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated")&&this.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated")}),n.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",this.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated"))):(this.widget.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"hidden",defaultValue:!1,label:t.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:!1}),n.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",!1)),this.widget.setValue("showWelcomePanel",!0)}.bind(this));this._setupCallbacks(!0);var r={file:p.file,module:p.module,merge:!1};this.pad3DViewer.loadActionBar(r)}.bind(this))}.bind(this))}.bind(this))},resetCommands:function(){var e={lastCommand:[],currentCommand:null,defaultCommand:null},t=this.pad3DViewer.getCommandContext();t?a._commandsState[t]=e:a._commandsState=e,a.resetDefaultCommand(t),a._isCommandEnding=!1,a._ignoreCommandBeginWhileEndingCommand=!1,["_commands","_cmdCheckHeader"].forEach(function(e){var i=t?a[e][t]:a[e];Object.keys(i).forEach(function(e){var t=i[e];t&&t._destroy&&t._destroy(),delete i[e]})})},createENOCockpitApp:function(){this.widget=widget,this.widget.addEvent("onLoad",this.onLoad),this.widget.addEvent("onRefresh",this.onRefresh),this.widget.addEvent("onSearch",this.onSearch),window.addEventListener("unload",this.onDestroy)},onRefresh:function(){window.setTimeout(function(){this.pad3DViewer.refresh()}.bind(this),500)},onLoad:function(){window.top.performance.mark(this.pcsPrefix+"_onload"),window.top.performance.measure(this.pcsPrefix+"_call_onload",this.pcsPrefix+"_init",this.pcsPrefix+"_onload"),this.widget.setValue("tenantAware",!0),require(["DS/ENOXInterWdgCom/LinkManager","DS/PADUtils/PADSharedSettings","text!DS/ENOCockpit/assets/json/ENOCockpitSettingsMgt.json"],(e,t,i)=>{i=UWA.is(i,"string")?JSON.parse(i):i,null===n.app_context&&(n.setApp(i,"enocockpit"),n.setSetting("enopad3dviewer_staticMappingSupportActivated",!0)),!0===n.getSetting("activateWidgetLink")?e.initializeWidgetLink(this.widget,n.getSetting("widgetLink_options")).then(()=>{this.initialize(i,t)}):this.initialize(i,t)})},initialize:function(e,t){t.addSharedSettings(this.widget,["x3dPlatformId","showWelcomePanel","autoreload","pad_security_ctx","synthesisModeOnInstance","pgpFromServer"]),require(["DS/PADUtils/PADUtilsServices","DS/ENOPAD3DViewer/PAD3DViewer","DS/Selection/CSOManager","UWA/Utils/Client","DS/Visualization/ThreeJS_DS","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],function(t,i,o,a,r,s){var d=e.actionBarWkb.standard;e.enocockpit.layout_options.frmWindow_opts.workbench=d.file,e.enocockpit.layout_options.frmWindow_opts.workbenchModule=d.module,null===this.pad3DViewer&&(this._setupPreferences(),this.appMainDiv=UWA.createElement("div",{class:"appMain",styles:{width:"auto",height:"100%"}}),require(["DS/PADServices/views/LandingPage","i18n!DS/ENOCockpit/assets/nls/ENOCockpit"],function(t,o){this.landingPage=new t({widget:this.widget,readOnlyApp:!0,appTitle:"3D Navigate",description:o.appDescription,renderDiv:this.appMainDiv,structKey:"xsceneStoredObjects",globalSearchPrecond:n.getSetting("landingPage_defaultSearchPrecondition"),onLandingPageReady:function(e){this.widget.setBody(this.appMainDiv)}.bind(this),onReady:function(){this.widget.dispatchEvent("onENOPADReady")}.bind(this)}),this.landingPage.initialize().then(function(t){window.top.performance.mark(this.pcsPrefix+"new pad3dviewer begin"),this.pad3DViewer=new i({widget:this.widget,css_view_class:this.css_view_class,windowOptions:e.enocockpit.layout_options.frmWindow_opts,allowAuthoring:!1,binaryPrimitives:!0,authorizeSet3DStructure:!0,selectiveLoading:UWA.is(n.getSetting("enopad3dviewer_selectiveLoading"),"boolean")?n.getSetting("enopad3dviewer_selectiveLoading"):"true"===n.getSetting("enopad3dviewer_selectiveLoading"),enableSidePanel:!0,propertiesFacet:UWA.is(n.getSetting("propertiesFacet"),"array")?n.getSetting("propertiesFacet"):[],objects2Load:t,pcsPrefix:this.pcsPrefix,activateStartupViewAutoloader:!0}),this.landingPage.setViewer(this.pad3DViewer),this._setupCallbacks(!1)}.bind(this))}.bind(this)))}.bind(this))},onSearch:function(e){this.pad3DViewer&&this.pad3DViewer.search({searchQuery:e})},onDestroy:function(){this.pad3DViewer&&(this.pad3DViewer.destroy(),this.pad3DViewer=null)},addChangeCtx:function(){var e=require("DS/PADUtils/PADSettingsMgt");!0===e.getSetting("authorizeChangeControl")&&require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/PADUtils/PADCommandProxy"],function(t,i){var n=this.pad3DViewer.elements.triptych.getMainPanelContainer();t.initialize2(n,i.appId(),"hide",e.getSetting("changeControlPosition"),function(n){this.debouncePrefSynchro=!1,this._proxy=i.create({events:{onPreferenceModification:function(t){"changeControlActivation"===t.name&&(this.debouncePrefSynchro=!0,this.widget.setValue(t.name,t.value),e.setSetting(t.name,t.value))}.bind(this)}});var o=e.getSetting("changeControlActivation");o=void 0!==this.widget.getValue("changeControlActivation")?this.widget.getBool("changeControlActivation"):n.isAuthoringContextVisible;var a="top-right";a=sessionStorage.getItem("changeControlPosition3DNavigation")?sessionStorage.getItem("changeControlPosition3DNavigation"):e.getSetting("changeControlPosition"),t.setPosition(a),this.widget.addPreference({name:"changeControlActivation",defaultValue:o,type:"boolean",label:"changeControlActivation_label",onchange:"onChangeControlUpdate"}),!0===o?(t.show(),this.widget.addPreference({name:"changeControlPosition",defaultValue:a,type:"list",label:"changeControlPosition_label",options:[{label:"top-right_label",value:"top-right"},{label:"top-left_label",value:"top-left"},{label:"bottom-left_label",value:"bottom-left"},{label:"bottom-right_label",value:"bottom-right"}]})):(t.hide(),this.widget.addPreference({name:"changeControlPosition",type:"hidden",defaultValue:a})),e.setSetting("changeControlActivation",o,!0),e.addEvent("onChangeControlActivation",this._onChangeControlActivation.bind(this)),t.addEvent&&t.addEvent("onAuthoringCtxVisible",function(t){e.setSetting("changeControlActivation",t.showAuthoringContext,!0),this._onChangeControlActivation(t.showAuthoringContext)}.bind(this)),e.addEvent("onChangeControlPosition",function(e){t.setPosition(e),sessionStorage.setItem("changeControlPosition3DNavigation",e)}),this.widget.addEvent("onChangeControlUpdate",function(t,i){var n="top-right";n=sessionStorage.getItem("changeControlPosition3DNavigation")?sessionStorage.getItem("changeControlPosition3DNavigation"):e.getSetting("changeControlPosition");var o=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");!1===i?(o.hide(),this.widget.addPreference({name:"changeControlPosition",type:"hidden",defaultValue:n})):(o.show(),this.widget.addPreference({name:"changeControlPosition",defaultValue:n,type:"list",label:"changeControlPosition_label",options:[{label:"top-right_label",value:"top-right"},{label:"top-left_label",value:"top-left"},{label:"bottom-left_label",value:"bottom-left"},{label:"bottom-right_label",value:"bottom-right"}]})),this.widget.dispatchEvent("onEdit")}.bind(this))}.bind(this))}.bind(this))},_setupCallbacks:function(e){this._evtIds.push(this.pad3DViewer.subscribe({event:"onActionBarReady"},function(){e||(window.top.performance.mark(this.pcsPrefix+"actionbarInitDone"),window.top.performance.measure(this.pcsPrefix+"actionbarInit",this.pcsPrefix+"frameWindowInitBegin",this.pcsPrefix+"actionbarInitDone")),this.landingPage.appReady(),this.addChangeCtx(),n.getSetting("paddebug_section")&&!1===this.paddebug&&(this.paddebug=!0,this.pad3DViewer.loadActionBar({merge:!0,file:"PADDebug.xml",module:"PADDebug"})),this.pad3DViewer.getLevelSelectorCommand&&this.pad3DViewer.getLevelSelectorCommand(function(e){e&&e.displayLabels(!0)})}.bind(this))),this._evtIds.push(this.pad3DViewer.subscribe({event:"onReady"},function(){if(!e){window.top.performance.mark(this.pcsPrefix+"init_pad3dviewer_done"),window.top.performance.measure(this.pcsPrefix+"init_landingpage",this.pcsPrefix+"_onload",this.pcsPrefix+"new pad3dviewer begin"),window.top.performance.measure(this.pcsPrefix+"require_pad3dviewer",this.pcsPrefix+"new pad3dviewer begin",this.pcsPrefix+"frameWindowInitBegin");var i=r.getPADTracker({eventCategory:"performance",eventAction:"3d_app_init"}),a=this.pad3DViewer.getPCSTrackerResult(this.pcsPrefix+"_call_init"),d=this.pad3DViewer.getPCSTrackerResult(this.pcsPrefix+"_call_onload"),l=this.pad3DViewer.getPCSTrackerResult(this.pcsPrefix+"init_landingpage"),g=this.pad3DViewer.getPCSTrackerResult(this.pcsPrefix+"require_pad3dviewer"),p=this.pad3DViewer.getPCSTrackerResult(this.pcsPrefix+"actionbarInit"),c=this.pad3DViewer.getPCSTrackerResult(this.pcsPrefix+"frameWindowInit");i.addMultivaluedEventData("3d_app_init",{call_init_start:a?a.startTime:0,call_init_duration:a?a.duration:0,call_onload_start:d?d.startTime:0,call_onload_duration:d?d.duration:0,init_landingpage_start:l?l.startTime:0,init_landingpage_duration:l?l.duration:0,require_pad3dviewer_start:g?g.startTime:0,require_pad3dviewer_duration:g?g.duration:0,actionbarInit_start:p?p.startTime:0,actionbarInit_duration:p?p.duration:0,frameWindowInit_start:c?c.startTime:0,frameWindowInit_duration:c?c.duration:0}),i.trackPageEvent(),this.widget.addEvent("onChangeFlexibleAssembliesSupport",function(e,t){n.setSetting(e,t)}.bind(this)),this.pad3DViewer&&this.pad3DViewer.getController&&!o.isCloud()&&!this.pad3DViewer.getController()._elasticLoadingGranted?this.widget.getPreference("enopad3dviewer_flexibleAssemblySupportActivated")||(this.widget.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"boolean",defaultValue:!1,label:t.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:void 0!==this.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated")&&this.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated")}),n.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",this.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated"))):(this.widget.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"hidden",defaultValue:!1,label:t.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:!1}),n.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",!1))}require(["DS/CATWebUXPreferences/CATWebUXPreferencesUtils"],function(e){this._prefManager=s.getPreferenceManager({context:this.pad3DViewer.getFrameWindow()}),this._tokenPrefMgr=[],this._prefManager&&(this._prefManager.removeAllPreferences(),this._prefManager.setUnitsPreferencesDisplayFlag(!0),this._prefManager.setDisplayPreferencesDisplayFlag(!0),this._prefManager.setPreferredPreferenceContainersOrder(["MeasurePreferences","SectionPreferences"]),e.readPreferences([{Repository:"VisualizationRepository",PreferenceNames:["Gravity"]},{Repository:"FrameGeneral",PreferenceNames:["ProjectionType"]}]).then(function(e){if(e&&e.repositories&&e.repositories.length){if(e.repositories[0].preferences&&1===e.repositories[0].preferences.length){const t="true"===e.repositories[0].preferences[0].value;this.pad3DViewer.getViewer().currentViewpoint.control.lockZ=t}if(e.repositories[1]&&e.repositories[1].preferences&&1===e.repositories[1].preferences.length){const t="Parallel"===e.repositories[1].preferences[0].value?1:0;this.pad3DViewer.getViewer().currentViewpoint.setProjectionType(t)}}}.bind(this)),this._tokenPrefMgr.push(this._prefManager.subscribe("com.ds.mep:onPrefUpdate",function(e){if(3===e.length&&e[1].preferences){const t=JSON.parse(e[1].preferences);for(let e=0;e<t.repositories.length;++e)if("VisualizationRepository"===t.repositories[e].name||"FrameGeneral"===t.repositories[e].name){const i=t.repositories[e].preferences;for(let e=0;e<i.length;++e){if("Gravity"===i[e].name&&this.pad3DViewer&&this.pad3DViewer.getViewer()&&this.pad3DViewer.getViewer().currentViewpoint){const t="true"===i[e].value;this.pad3DViewer.getViewer().currentViewpoint.control.lockZ=t}if("ProjectionType"===i[e].name){const t="Parallel"===i[e].value?1:0;this.pad3DViewer.getViewer().currentViewpoint.setProjectionType(t)}}}}}.bind(this))))}.bind(this));var h=this.widget.getValue("X3DContentId");-1===this.widget.id.indexOf("preview")?this.widget.deleteValue("X3DContentId"):h&&setTimeout(function(){this.pad3DViewer.addRootNodesFromContent({json3DXContent:JSON.parse(h),dispatch:!1})}.bind(this),0)}.bind(this)))},_setupPreferences:function(){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],function(e){n.setSetting("lang",this.widget.lang);var t=this.widget.getValue("enopad3dviewer_CGRorTHB");"boolean"==typeof t&&(t?this.widget.setValue("enopad3dviewer_CGRorTHB","HIGH"):this.widget.setValue("enopad3dviewer_CGRorTHB","OPTIMIZED"));var i=widget.getValue("authorizeChangeControl");UWA.is(i,"string")&&"true"===i.toLowerCase()&&n.setSetting("authorizeChangeControl",i),this.widget.addEvent("endEdit",n.updateWidgetPreferences.bind(n)),this.widget.addEvent("endEdit",function(t){if(t&&!1===t.submitted){var i="top-right";i=sessionStorage.getItem("changeControlPosition3DNavigation")?sessionStorage.getItem("changeControlPosition3DNavigation"):n.getSetting("changeControlPosition"),!1===this.widget.getBool("changeControlActivation")?(e.hide(),this.widget.addPreference({name:"changeControlPosition",type:"hidden",defaultValue:i})):(e.show(),this.widget.addPreference({name:"changeControlPosition",defaultValue:i,type:"list",label:"changeControlPosition_label",options:[{label:"top-right_label",value:"top-right"},{label:"top-left_label",value:"top-left"},{label:"bottom-left_label",value:"bottom-left"},{label:"bottom-right_label",value:"bottom-right"}]}))}}.bind(this)),this.widget.mergePreferences(n.getWidgetPreferences()),n.addEvent("onEnopad3dviewer_CGRorTHB",function(e){this.pad3DViewer&&this.pad3DViewer.getController()&&this.pad3DViewer.setDefaultStreamToLoad(e)}.bind(this)),n.addEvent("onPaddebug_section",function(e){this.pad3DViewer&&e&&!1===this.paddebug&&(this.paddebug=!0,this.pad3DViewer.loadActionBar({merge:!0,file:"PADDebug.xml",module:"PADDebug"}))}.bind(this)),n.updateWidgetPreferences()}.bind(this))},_onChangeControlActivation:function(e){var t=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");this.debouncePrefSynchro?this.debouncePrefSynchro=!1:this._proxy.preferenceModification({name:"changeControlActivation",value:e});var i="top-right";i=sessionStorage.getItem("changeControlPosition3DNavigation")?sessionStorage.getItem("changeControlPosition3DNavigation"):n.getSetting("changeControlPosition"),!0===e?(t.show(),this.widget.addPreference({name:"changeControlPosition",defaultValue:i,type:"list",label:"changeControlPosition_label",options:[{label:"top-right_label",value:"top-right"},{label:"top-left_label",value:"top-left"},{label:"bottom-left_label",value:"bottom-left"},{label:"bottom-right_label",value:"bottom-right"}]})):(t.hide(),this.widget.addPreference({name:"changeControlPosition",type:"hidden",defaultValue:i}))},_declineTransition:function(e){return!1},getId:function(){return"ENXDISC_AP"},getTitle:function(){return"3D Navigate"},getBrand:function(){return"ENOVIA"}})});