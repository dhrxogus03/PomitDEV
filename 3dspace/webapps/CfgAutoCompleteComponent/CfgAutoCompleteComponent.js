define("DS/CfgAutoCompleteComponent/Presenter/CfgAutoCompleteUtils",["UWA/Core","DS/CfgDictionary/CfgDictionaryTypeEnum","DS/CfgDictionary/CfgDictionaryOperatorEnum"],function(e,t,a){"use strict";var o,r,n={},s={};return n.getDatasetItemFromId=function(e,t){var a=0,o=0;for(a=0;a<e.datasets.length;a+=1)for(o=0;o<e.datasets[a].items.length;o+=1)if(e.datasets[a].items[o].id_===t)return e.datasets[a].items[o];return null},n.getDatasetItemFrom=function(t,a){var o=0,r=0;for(o=0;o<t.datasets.length;o+=1)for(r=0;r<t.datasets[o].items.length;r+=1){if(t.datasets[o].items[r].id_===a||e.is(t.datasets[o].items[r].value,"string")&&(t.datasets[o].items[r].value&&t.datasets[o].items[r].value.toUpperCase()===a.toUpperCase()||t.datasets[o].items[r].name&&t.datasets[o].items[r].name.toUpperCase()===a.toUpperCase()))return t.datasets[o].items[r];if(a===t.datasets[o].items[r].label)return t.datasets[o].items[r]}return null},n.getFlatListOfIds=function(e){var t,a=[];if(t=e.dataTransfer.getData("Text"),!(t=JSON.parse(t)))return[];var o=0,r=0;if("2.0"===t._version||2===t._version){if(t.variantClasses&&t.variantClasses!==[])for(o=0;o<t.variantClasses.length;o+=1)if(t.variantClasses[o].variants&&t.variantClasses[o].variants.length>0)for(r=0;r<t.variantClasses[o].variants.length;r+=1)a.push(t.variantClasses[o].variants[r].id);else a.push(t.variantClasses[o].id);if(t.options&&t.options!==[])for(o=0;o<t.options.length;o+=1)a.push(t.options[o].id);if(t.packs)for(o=0;o<t.packs.length;o+=1)a.push(t.packs[o].id)}else if(t.features&&t.features!==[])for(o=0;o<t.features.length;o+=1)if(t.features[o].options&&t.features[o].options.length>0)for(r=0;r<t.features[o].options.length;r+=1)a.push(t.features[o].options[r].id);else a.push(t.features[o].id);return a},n.getRelativeBadgeAndIndexOnLeft=function(e,t){return 0===e?null:-1===e?t.length>0?{badge:t[t.length-1],index:t.length-1}:null:{badge:t[e-1],index:e-1}},n.getEvalContextStartPosition=function(e,t){for(var a of(-1===e&&(e=t.length),Object.keys(s))){if(a<e&&(e<=s[a]||-1===s[a]))return a;if(a>=e)break}},n.addSelectedEval=function(e,t){for(var a in s)if(parseInt(a)<=e&&e<=s[a])return;e=-1===e?t.length-1:e,s[e]&&(s[e+1]=-1===s[e]?-1:s[e]+1,o=e+1),s[e]=-1,r=e},n.removeSelectedEval=function(e){delete s[e]},n.updateSelectedEvalPositions=function(e,t,a){if(Object.keys(s).length>0){var n,i,l={};a?(e=-1===e?t.length-1:e,Object.keys(s).forEach(t=>{t=parseInt(t),n=t,i=s[t],o===n?o=null:r===n?r=null:t>=e?(n=t+1,i=-1===s[t]?-1:s[t]+1):(s[t]>e||s[t]===e)&&(i=s[t]+1),l[n]=i})):Object.keys(s).forEach(t=>{t=parseInt(t),n=t,i=s[t],t>=e&&(n=0===t?0:t-1,i=-1===s[t]?-1:s[t]-1),s[t]>=e&&(i=s[t]-1),l[n]=i}),s=l}},n.updateSelectedEvalEndPosition=function(e,t,o){var r;if(o){var n;for(r of Object.keys(s)){if(!(parseInt(r)<e&&s[r]<=e))break;(!n||n&&n<r)&&(n=parseInt(r))}void 0!==n&&(s[n]=e)}else{if(!this.isClosingSeparatorEndOfEval(e)||t[e]&&t[e].type===a.closing_separator)return;var i=-1;for(r of(t[e-1]&&t[e-1].type===a.closing_separator&&(i=e-1),Object.keys(s))){if(!(parseInt(r)<e))break;s[r]===e&&(s[r]=i)}}},n.isClosingSeparatorEndOfEval=function(e){for(var t of Object.keys(s)){if(s[t]===e)return!0;if(parseInt(t)>e||s[t]>e)return!1}return!1},n.getSelectedEval=function(){return s},n.resetSelectedEval=function(){s={}},n.selectedItemsToString=function(e){var t="";return e.forEach(e=>{t+=" "+e.label}),t},n.hasBadgeTypeInEval=function(t,a,o){a=-1===a?o.length:a;var r=this.getEvalContextStartPosition(a,o);if(e.is(r,"string"))for(var n=-1===s[r]?o.length-1:s[r],i=parseInt(r)+2;i<n;i++)if(o[i].type===t&&i!==a)return!0;return!1},n.isParameterInCurrentEval=function(a,o){a=-1===a?o.length:a;var r=this.getEvalContextStartPosition(a,o);if(e.is(r,"string"))for(var n=-1===s[r]?o.length-1:s[r],i=parseInt(r)+2;i<n;i++)if(i!==a&&a<o.length&&o[i].type===t.PARAMETER&&o[i].value===o[a].value)return!0;return!1},n.getParametersInCurrentEval=function(a,o){a=-1===a?o.length:a;var r=this.getEvalContextStartPosition(a,o),n=[];if(e.is(r,"string"))for(var i=-1===s[r]?o.length-1:s[r],l=parseInt(r)+2;l<i;l++)o[l].type===t.PARAMETER&&n.push(o[l].value);return n},n.getCurrentParameterUnit=function(a,o,r){a=-1===a?o.length:a;var n=this.getEvalContextStartPosition(a,o);if(e.is(n,"string"))for(var i=-1===s[n]?o.length-1:s[n],l=parseInt(n)+2;l<i;l++)if(o[l].type===t.PARAMETER){var c=r[o[l].id_].min.split(" ");return c[1]?c[1]:""}},n.hasParametersWithSameUnit=function(a,o,r){a=-1===a?o.length:a;var n,i=this.getEvalContextStartPosition(a,o);if(e.is(i,"string"))for(var l,c=-1===s[i]?o.length-1:s[i],p=parseInt(i)+2;p<c;p++)if(o[p].type===t.PARAMETER)if(l=(l=r[o[p].id_].min.split(" ")[1])||"",void 0===n)n=l;else if(n!==l)return!1;return!0},n.getRelativeContext=function(e,a){var o=this.getRelativeBadgeAndIndexOnLeft(e,a);if(!o)return null;var r=o.badge,n=o.index;if(r.type!==t.VALUE)return r;for(var s=r.parent_,i=n-1,l=i>=0;l;){switch(a[i].type){case t.VALUE:if(s!==a[i].parent_)return null;break;case t.VARIANT:return s===a[i].id_?a[i]:null;default:return null}--i<0&&(l=!1)}return null},n._isBadgeAllowedAfterClosingSeparator=function(t,o,r){return!e.is(this.getEvalContextStartPosition(o,r),"string")&&(t===a.binary_operator_id||t===a.closing_separator_id)},n._isBadgeAllowedAfterOpeningSeparator=function(o,r,n){return e.is(this.getEvalContextStartPosition(r,n),"string")?o===t.PARAMETER||o===t.NUMBER||o===t.FRACTION||o===a.arithmetic_operator_id:o!==a.binary_operator_id&&o!==a.closing_separator_id&&o!==t.PARAMETER&&o!==t.NUMBER&&o!==t.FRACTION&&o!==a.arithmetic_operator_id},n._isBadgeAllowedAfterArithmeticOperator=function(e){return e===t.PARAMETER||e===t.FRACTION||e===t.NUMBER},n._isBadgeAllowedAfterComparisonOperator=function(e){return e===t.PARAMETER||e===a.arithmetic_operator_id||e===t.FRACTION||e===t.NUMBER},n._isBadgeAllowedAfterEvalFunction=function(e,t){return(!t||t.badge.type!==a.opening_separator)&&e===a.opening_separator_id},n._isBadgeAllowedAfterUnaryOperator=function(o,r,n){return!e.is(this.getEvalContextStartPosition(r,n),"string")&&o!==a.binary_operator_id&&o!==a.closing_separator_id&&o!==a.comparison_operator_id&&o!==a.arithmetic_operator_id&&o!==t.PARAMETER&&o!==t.FRACTION&&o!==t.NUMBER},n._isBadgeAllowedAfterBinaryOperator=function(o,r,n){return!e.is(this.getEvalContextStartPosition(r,n),"string")&&o!==a.binary_operator_id&&o!==a.closing_separator_id&&o!==a.comparison_operator_id&&o!==a.arithmetic_operator_id&&o!==t.PARAMETER&&o!==t.FRACTION&&o!==t.NUMBER},n._isBadgeAllowedAfterOption=function(t,o,r){return!e.is(this.getEvalContextStartPosition(o,r),"string")&&(t===a.binary_operator_id||t===a.closing_separator_id)},n._isBadgeAllowedAfterValue=function(t,o,r,n){var s=!0;return this.getRelativeContext(o,r)&&(s=t===n.badge.parent_||t===a.binary_operator_id||t===a.closing_separator_id),e.is(this.getEvalContextStartPosition(o,r),"string")&&(s=!1),s},n._isBadgeAllowedAfterNumberAndFraction=function(e,o,r){return e===a.comparison_operator_id&&!this.hasBadgeTypeInEval(a.comparison_operator,o,r)||e===a.arithmetic_operator_id||e===t.PARAMETER||e===a.closing_separator_id},n._isBadgeAllowedAfterParameter=function(e,t,o){return e===a.comparison_operator_id&&!this.hasBadgeTypeInEval(a.comparison_operator,t,o)||e===a.arithmetic_operator_id||e===a.closing_separator_id},n._isBadgeAllowedAfterVariant=function(t,o,r,n){return!e.is(this.getEvalContextStartPosition(o,n),"string")&&(t===r||t===a.binary_operator_id||t===a.closing_separator_id)},n._isBadgeAllowedAfterBadgeType=function(e,o,r,n,s){var i=!0;switch(e.badge.type){case t.VARIANT:i=this._isBadgeAllowedAfterVariant(r,n,e.badge.id_autocomplete,s);break;case t.PARAMETER:i=this._isBadgeAllowedAfterParameter(r,n,s);break;case t.FRACTION:case t.NUMBER:i=this._isBadgeAllowedAfterNumberAndFraction(r,n,s);break;case t.VALUE:i=this._isBadgeAllowedAfterValue(r,n,s,e);break;case t.OPTION:case t.PACK:i=this._isBadgeAllowedAfterOption(r,n,s);break;case a.binary_operator:i=this._isBadgeAllowedAfterBinaryOperator(r,n,s);break;case a.unary_operator:i=this._isBadgeAllowedAfterUnaryOperator(r,n,s);break;case a.eval_function:i=this._isBadgeAllowedAfterEvalFunction(r,o);break;case a.comparison_operator:i=this._isBadgeAllowedAfterComparisonOperator(r);break;case a.arithmetic_operator:i=this._isBadgeAllowedAfterArithmeticOperator(r);break;case a.opening_separator:i=this._isBadgeAllowedAfterOpeningSeparator(r,n,s);break;case a.closing_separator:i=this._isBadgeAllowedAfterClosingSeparator(r,n,s)}return i},n.isBadgeAllowedInContext=function(o,r,n,s,i,l){if(!e.is(n,"number"))return r!==a.binary_operator_id&&r!==a.closing_separator_id;var c=this.getRelativeBadgeAndIndexOnLeft(n,s),p=-1===n?null:this.getRelativeBadgeAndIndexOnLeft(n+1,s),u=o.isA||o.type,d=!0;if(u===t.VARIABILITY_GROUP&&i(),c?(u!==t.VARIANT||c.badge.type!==t.VARIANT&&c.badge.type!==t.VALUE||i(),d=this._isBadgeAllowedAfterBadgeType(c,p,r,n,s)):d=r!==a.binary_operator_id&&r!==a.closing_separator_id&&r!==a.comparison_operator_id&&r!==a.arithmetic_operator_id&&r!==t.PARAMETER&&r!==t.FRACTION&&r!==t.NUMBER,d&&(p&&p.badge&&p.badge.type===a.eval_function&&(d=d&&r!==a.eval_function_id),r===t.PARAMETER&&l)){var m=this.getCurrentParameterUnit(n,s,l),_=o.id_||o.id,g=l[_].min.split(" ")[1];if(g=g||"",e.is(m,"string")&&g!==m)d=!1;else this.getParametersInCurrentEval(n,s).includes(l[_].title)&&(d=!1)}return d},n}),define("DS/CfgAutoCompleteComponent/Presenter/CfgAutoCompleteChecks",["UWA/Core","DS/CfgDictionary/CfgDictionaryTypeEnum","DS/CfgDictionary/CfgDictionaryOperatorEnum","DS/CfgAutoCompleteComponent/Presenter/CfgAutoCompleteUtils","i18n!DS/CfgAutoCompleteComponent/assets/nls/CfgAutoCompleteComponent"],function(e,t,a,o,r){"use strict";var n="ERROR",s={dicoCheck:function(e,a,o){var s,i={};i._rc="S_OK",i.discrepancyElements=[];var l=[],c={};for(s in e)e.hasOwnProperty(s)&&(l.push(s),c[e[s].name]="operand");for(s in a)a.hasOwnProperty(s)&&(l.push(s),c[a[s].value]="operator");var p=0;if(o&&o.selectedItems)for(p=0;p<o.selectedItems.length;p+=1){var u=o.selectedItems[p].value,d=o.selectedItems[p].id_;if(!d||-1===l.indexOf(d)&&!d.startsWith(t.NUMBER+"_")&&!d.startsWith(t.FRACTION+"_")){i._rc=n;var m=u+" "+r.isUnknown;i.discrepancyElements.push({id:null,idx:p,description:m})}}if(o&&o.badges)for(p=0;p<o.badges.length;p+=1)o.badges[p].elements.container.classList.remove("badge-operator"),o.badges[p].elements.container.classList.remove("badge-operand"),o.badges[p].elements.container.classList.remove("badge-unknown"),"operator"===c[o.selectedItems[p].value]?o.badges[p].elements.container.classList.add("badge-operator"):"operand"===c[o.selectedItems[p].value]?o.badges[p].elements.container.classList.add("badge-operand"):o.selectedItems[p].type===t.NUMBER||o.selectedItems[p].type===t.FRACTION?o.badges[p].elements.container.classList.add("badge-number"):o.badges[p].elements.container.classList.add("badge-unknown");return i},_checkNextTypeUnknown:function(e){var t,a=!1;return e&&e.id_||(a=!0,t=r.unknown),{error:a,nextType:t}},_grammarCheckForFirstBadge:function(e,o,n,i){var l,c,p=!1;switch(o.type){case t.VARIANT:case t.OPTION:case a.opening_separator:case a.eval_function:break;case a.unary_operator:if(1===e.selectedItems.length)p=!0,c=r.unknown;else{n=e.selectedItems[i+1];var u=s._checkNextTypeUnknown(n);p=u.error,c=u.nextType,p||n.type===t.OPTION||n.type===t.VARIANT||n.type===a.opening_separator||n.type===a.unary_operator||n.type===a.eval_function||(p=!0,c=n.label)}break;case t.PARAMETER:case t.NUMBER:case t.FRACTION:case a.arithmetic_operator:case a.comparison_operator:p=!0,l=r.notExpectedOutOfEval;break;case a.binary_operator:p=!0,l=r.cannotStartExpressionWith+" "+o.label;break;default:p=!0}return{error:p,errorMessage:l,nextType:c}},_grammarCheckForValue:function(n,s,i,l){var c,p,u=!1;if(e.is(o.getEvalContextStartPosition(l,n.selectedItems),"string"))u=!0,c=r.notExpectedInEval;else{switch(s.type){case t.VALUE:s.parent_!==i.parent_&&(u=!0);break;case t.VARIANT:s.id_!==i.parent_&&(u=!0);break;default:u=!0}var d=n.selectedItems[l+1];!d||d.type!==t.PARAMETER&&d.type!==t.NUMBER&&d.type!==t.FRACTION&&d.type!==a.comparison_operator&&d.type!==a.arithmetic_operator||(u=!0,p=d.label)}return{error:u,errorMessage:c,nextType:p}},_grammarCheckForComparisonOperator:function(n,i,l){var c,p,u=!1,d=n.selectedItems[l+1];if(e.is(o.getEvalContextStartPosition(l,n.selectedItems),"string"))if(o.hasBadgeTypeInEval(a.comparison_operator,l,n.selectedItems))u=!0,c=r.notExpectingSeveralComparisonOperatorsInEval;else if(i.type!==t.PARAMETER&&i.type!==t.NUMBER&&i.type!==t.FRACTION)u=!0;else{var m=s._checkNextTypeUnknown(d);u=m.error,p=m.nextType,u||d.type===t.PARAMETER||d.type===t.NUMBER||d.type===t.FRACTION||d.type===a.arithmetic_operator||(u=!0,p=d.label)}else u=!0,c=r.notExpectedOutOfEval;return{error:u,errorMessage:c,nextType:p}},_grammarCheckForArithmeticOperator:function(n,i,l){var c,p,u=!1,d=n.selectedItems[l+1];if(e.is(o.getEvalContextStartPosition(l,n.selectedItems),"string"))if(i.type!==t.PARAMETER&&i.type!==t.NUMBER&&i.type!==t.FRACTION&&i.type!==a.opening_separator&&i.type!==a.comparison_operator)u=!0;else{var m=s._checkNextTypeUnknown(d);u=m.error,p=m.nextType,u||d.type===t.PARAMETER||d.type===t.FRACTION||d.type===t.NUMBER||(u=!0,p=d.label)}else u=!0,c=r.notExpectedOutOfEval;return{error:u,errorMessage:c,nextType:p}},_grammarCheckForEvalFunction:function(t,n,i){var l,c,p=!1,u=t.selectedItems[i+1];if(e.is(o.getEvalContextStartPosition(i,t.selectedItems),"string"))p=!0,l=r.notExpectedInEval;else if(n.type!==a.binary_operator&&n.type!==a.unary_operator&&n.type!==a.opening_separator)p=!0;else{var d=s._checkNextTypeUnknown(u);p=d.error,c=d.nextType,p||u.type===a.opening_separator||(p=!0,c=u.label)}return{error:p,errorMessage:l,nextType:c}},_grammarCheckForClosingSeparator:function(n,s,i,l){var c,p=!1;return e.is(o.getEvalContextStartPosition(i,n.selectedItems),"string")?o.isClosingSeparatorEndOfEval(i)?(l=void 0,s.type!==t.PARAMETER&&s.type!==t.FRACTION&&s.type!==t.NUMBER?p=!0:o.hasBadgeTypeInEval(t.PARAMETER,i,n.selectedItems)?o.hasBadgeTypeInEval(a.comparison_operator,i,n.selectedItems)||(p=!0,c=r.missingComparisonOperatorInEval):(p=!0,c=r.missingParameterInEval)):(p=!0,c=r.notExpectedInEval):s.type!==t.OPTION&&s.type!==t.VARIANT&&s.type!==t.VALUE&&s.type!==a.closing_separator&&(p=!0),{error:p,errorMessage:c,hasParametersWithSameUnit:l}},_grammarCheckForOpeningSeparator:function(n,i,l){var c,p=n.selectedItems[l+1],u=s._checkNextTypeUnknown(p),d=u.error,m=u.nextType;return e.is(o.getEvalContextStartPosition(l-1,n.selectedItems),"string")?(d=!0,c=r.notExpectedInEval):l>0&&n.selectedItems[l-1].type===a.eval_function?d||p.type===a.arithmetic_operator||p.type===t.PARAMETER||p.type===t.FRACTION||p.type===t.NUMBER||(d=!0,m=p.label):i.type!==a.binary_operator&&i.type!==a.opening_separator&&i.type!==a.unary_operator?d=!0:d||p.type===t.OPTION||p.type===t.VARIANT||p.type===a.opening_separator||p.type===a.unary_operator||p.type===a.eval_function||(d=!0,m=p.label),{error:d,errorMessage:c,nextType:m}},_grammarCheckForUnaryOperator:function(n,i,l){var c,p,u=!1,d=n.selectedItems[l+1];if(e.is(o.getEvalContextStartPosition(l,n.selectedItems),"string"))u=!0,c=r.notExpectedInEval;else if(i.type!==a.binary_operator&&i.type!==a.opening_separator&&i.type!==a.unary_operator)u=!0;else{var m=s._checkNextTypeUnknown(d);u=m.error,p=m.nextType,u||d.type===t.OPTION||d.type===t.VARIANT||d.type===a.opening_separator||d.type===a.unary_operator||d.type===a.eval_function||(u=!0,p=d.label)}return{error:u,errorMessage:c,nextType:p}},_grammarCheckForBinaryOperator:function(n,i,l){var c,p,u=!1,d=n.selectedItems[l+1];if(e.is(o.getEvalContextStartPosition(l,n.selectedItems),"string"))u=!0,c=r.notExpectedInEval;else if(i.type!==t.OPTION&&i.type!==t.VARIANT&&i.type!==t.VALUE&&i.type!==a.closing_separator)u=!0;else{var m=s._checkNextTypeUnknown(d);u=m.error,p=m.nextType,u||d.type===t.OPTION||d.type===t.VARIANT||d.type===a.opening_separator||d.type===a.unary_operator||d.type===a.eval_function||(u=!0,p=d.label)}return{error:u,errorMessage:c,nextType:p}},_grammarCheckForNumberAndFraction:function(n,i,l){var c,p,u=!1,d=n.selectedItems[l+1];if(e.is(o.getEvalContextStartPosition(l,n.selectedItems),"string"))if(i.type!==a.opening_separator&&i.type!==a.comparison_operator&&i.type!==a.arithmetic_operator)u=!0;else{var m=s._checkNextTypeUnknown(d);u=m.error,p=m.nextType,u||d.type===a.comparison_operator||d.type===a.arithmetic_operator||d.type===a.closing_separator||d.type===t.PARAMETER||(u=!0,p=d.label)}else u=!0,c=r.notExpectedOutOfEval;return{error:u,errorMessage:c,nextType:p}},_grammarCheckForParameter:function(n,i,l,c,p){var u,d,m=!1,_=n.selectedItems[l+1];if(e.is(o.getEvalContextStartPosition(l,n.selectedItems),"string"))if(void 0===c&&(c=o.hasParametersWithSameUnit(l,n.selectedItems,p)),c)if(i.type!==a.opening_separator&&i.type!==t.NUMBER&&i.type!==t.FRACTION&&i.type!==a.comparison_operator&&i.type!==a.arithmetic_operator)m=!0;else{var g=s._checkNextTypeUnknown(_);m=g.error,d=g.nextType,m||_.type===a.comparison_operator||_.type===a.arithmetic_operator||_.type===a.closing_separator?o.isParameterInCurrentEval(l,n.selectedItems)&&(m=!0,u=r.parameterCannotBeComparedToItself):(m=!0,d=_.label)}else m=!0,u=r.parametersShouldHaveTheSameUnit;else m=!0,u=r.notExpectedOutOfEval;return{error:m,errorMessage:u,nextType:d,hasParametersWithSameUnit:c}},_grammarCheckForVariantAndOption:function(n,s,i){var l,c,p=!1,u=n.selectedItems[i+1];return e.is(o.getEvalContextStartPosition(i,n.selectedItems),"string")?(p=!0,l=r.notExpectedInEval):s.type!==a.opening_separator&&s.type!==a.unary_operator&&s.type!==a.binary_operator&&(p=!0),!u||u.type!==t.PARAMETER&&u.type!==t.NUMBER&&u.type!==t.FRACTION&&u.type!==a.comparison_operator&&u.type!==a.arithmetic_operator||(p=!0,c=u.label),{error:p,errorMessage:l,nextType:c}},_grammarCheckByBadgeType:function(e,o,r,n,i,l){var c;switch(o.type){case t.VALUE:c=s._grammarCheckForValue(r,n,o,i);break;case t.VARIANT:case t.OPTION:c=s._grammarCheckForVariantAndOption(r,n,i);break;case t.PARAMETER:c=s._grammarCheckForParameter(r,n,i,l,e);break;case t.FRACTION:case t.NUMBER:c=s._grammarCheckForNumberAndFraction(r,n,i);break;case a.binary_operator:c=s._grammarCheckForBinaryOperator(r,n,i);break;case a.unary_operator:c=s._grammarCheckForUnaryOperator(r,n,i);break;case a.opening_separator:c=s._grammarCheckForOpeningSeparator(r,n,i);break;case a.closing_separator:c=s._grammarCheckForClosingSeparator(r,n,i,l);break;case a.eval_function:c=s._grammarCheckForEvalFunction(r,n,i);break;case a.arithmetic_operator:c=s._grammarCheckForArithmeticOperator(r,n,i);break;case a.comparison_operator:c=s._grammarCheckForComparisonOperator(r,n,i);break;default:c={error:!0,unknown:!0}}return c},grammarCheck:function(e,t){var o={_rc:"S_OK",discrepancyElements:[]},l=!1,p=null,u=!1,d=null,m=[];if(t&&t.selectedItems){var _=0;for(_=0;_<t.selectedItems.length;_+=1){l=!1,p=null,u=!1,d=null;var g=t.selectedItems[_],f=null,v=void 0;if(_>0&&(f=t.selectedItems[_-1]),f){var h=s._grammarCheckByBadgeType(e,g,t,f,_,v);l=h.error,d=h.errorMessage,p=h.nextType,v=h.hasParametersWithSameUnit,u=h.unknown}else{var E=s._grammarCheckForFirstBadge(t,g,null,_);l=E.error,d=E.errorMessage,p=E.nextType}if(l){m.push(_),o._rc=n;var y=g.id_,I=f&&f.value?r.inContextOF+" : "+f.label:r.error;d?I=d:p?I=r.notExpectingToBeFollowedBy+" : "+p:u&&(I=g.value+" "+r.isUnknownFromDictionary),o.discrepancyElements.push({id:y,idx:_,description:I})}}var A=i(t);if(A._rc===n)for(o._rc=n,_=0,_=0;_<A.discrepancyElements.length;_+=1){var C=A.discrepancyElements[_].idx,b=c(o,C);b?b.description+=" "+A.discrepancyElements[_].description:(o.discrepancyElements.push(A.discrepancyElements[_]),C>0&&!c(o,C-1)&&t.selectedItems[C-1].type===a.eval_function&&o.discrepancyElements.push({id:a.eval_function_id,idx:C-1,description:o.discrepancyElements[o.discrepancyElements.length-1].description}))}}return o},dicoAndGrammarCheckAndUpdateUI:function(e,t,a){var o=s.dicoCheck(e,t,a),r=s.grammarCheck(e,a),i={_rc:"S_OK"};return i._rc=o._rc===n?n:i._rc,i._rc=r._rc===n?n:i._rc,i.discrepancyElements=o.discrepancyElements.concat(r.discrepancyElements),l(i,a,"badge-error"),i},getGlobalErrorCounts:function(e,t,a){var o=s.dicoCheck(e,t,a),r=s.grammarCheck(e,a),i={_rc:"S_OK"};i._rc=o._rc===n?n:i._rc,i._rc=o._rc===n?n:i._rc;var l=[],c=0;for(c=0;c<o.discrepancyElements.length;c+=1)l.push(o.discrepancyElements[c].idx);var p=[];for(c=0;c<r.discrepancyElements.length;c+=1)p.push(r.discrepancyElements[c].idx);var u=l.concat(p);return(u=u.filter(function(e,t){return u.indexOf(e)===t})).length}},i=function(e){var t={_rc:"S_OK",discrepancyElements:[]},o=e.selectedItems.length,s=[],i=[],l=0,c=0,p=0;for(c=0;c<o;c+=1)if(e.selectedItems[c].type===a.opening_separator){for(l=1,p=c+1;p<o;p+=1)if(e.selectedItems[p].type===a.opening_separator?l+=1:e.selectedItems[p].type===a.closing_separator&&(l-=1),0===l){s.push(c),i.push(p);break}0!==l&&(t._rc=n,t.discrepancyElements.push({id:e.selectedItems[c].id_,idx:c,description:r.correspondingClosingOperatorNotFound}))}for(c=0;c<o;c+=1)e.selectedItems[c].type===a.closing_separator&&-1===i.indexOf(c)&&(t._rc=n,t.discrepancyElements.push({id:e.selectedItems[c].id_,idx:c,description:r.correspondingOpeningOperatorNotFound}));return t},l=function(e,t,a){var o=0;for(o=0;o<t.badges.length;o+=1)t.badges[o].getContent().title="",t.badges[o].getContent().classList.remove(a),t.badges[o].getContent().classList.remove("badge-default"),t.badges[o].getContent().classList.remove("badge-closable"),t.badges[o].getContent().classList.remove("badge-selected"),null!==c(e,o)?(t.badges[c(e,o).idx].getContent().classList.add(a),t.badges[o].getContent().title=c(e,o).description):t.badges[o].getContent().classList.add("badge-default");return e.discrepancyElements},c=function(e,t){var a=0;for(a=0;a<e.discrepancyElements.length;a+=1)if(e.discrepancyElements[a].idx===t)return e.discrepancyElements[a];return null};return s}),define("DS/CfgAutoCompleteComponent/Presenter/CfgAutoCompletePresenter",["UWA/Core","UWA/Class/View","UWA/Class/Model","DS/Handlebars/Handlebars","DS/CfgAutoCompleteComponent/Presenter/CfgAutoCompleteChecks","DS/CfgAutoCompleteComponent/Presenter/CfgAutoCompleteUtils","DS/UIKIT/Autocomplete","DS/CfgDictionary/CfgDictionaryMapperUtils","DS/CfgDictionary/CfgDictionaryOperatorEnum","DS/CfgDictionary/CfgDictionaryOperatorMapper","DS/CfgDictionary/CfgDictionaryTypeEnum","text!DS/CfgAutoCompleteComponent/assets/NumericalParameterConstants.json","i18n!DS/CfgAutoCompleteComponent/assets/nls/CfgAutoCompleteComponent","text!DS/CfgAutoCompleteComponent/View/CfgAutoCompleteTemplate.html","css!DS/CfgAutoCompleteComponent/View/CfgAutoComplete.css","css!DS/UIKIT/UIKIT.css"],function(e,t,a,o,r,n,s,i,l,c,p,u,d,m){"use strict";const _=JSON.parse(u);var g=o.compile(m);return t.extend({name:"autocomplete-rule-view",tagName:"div",init:function(t){var a=this;for(var o in t)t.hasOwnProperty(o)&&(this[o]=t[o]);this._minLengthBeforeSearch=e.is(t.minLengthBeforeSearch,"number")?t.minLengthBeforeSearch:1,this._showOptionGroup=t.showOptionGroup,this._parent(t),this.container.setHTML(g(t)),a._autocomplete.inject(a.container.getElement(".autocomplete-rule-content-section")),a.container.getElement(".autocomplete-rule-content-section").ondrop=function(t){t.preventDefault();var o;o=n.getFlatListOfIds(t);var s=null,i=0,l=t.target,c=-1;for(i=0;i<a._autocomplete.innerInputs.length;i+=1)if(l===a._autocomplete.innerInputs[i]){c=i;break}var u=c>=0?c:a._autocomplete.badges.length;for(i=0;i<o.length;i+=1)if(s=o[i]){var d=n.getDatasetItemFromId(a._autocomplete,s);if(d){if(d.type===p.VALUE){var m=n.getRelativeContext(u,a._autocomplete.selectedItems);if(m&&m.id_===d.parent_)a._autocomplete.onSelect(d,u),u+=1,n.updateSelectedEvalPositions(u,a._autocomplete.selectedItems,!0);else{a._autocomplete.onSelect(d,u),n.updateSelectedEvalPositions(u,a._autocomplete.selectedItems,!0);var _=n.getDatasetItemFromId(a._autocomplete,d.parent_);a._autocomplete.onSelect(_,u),n.updateSelectedEvalPositions(u,a._autocomplete.selectedItems,!0),u+=2}}else a._autocomplete.onSelect(d,u),n.updateSelectedEvalPositions(u,a._autocomplete.selectedItems,!0),u+=1;var g=r.dicoAndGrammarCheckAndUpdateUI(a._mapDico,a._mapOperator,a._autocomplete);a._errorDicoOrGrammar="S_OK"!==g._rc,a.updateExpression(),a._localModelEvent&&a._localModelEvent.publish({event:"onChangeExpression",data:null})}else e.log("object with id "+s+" not found in dictionary")}else e.log("object dropped not supported");a._autocomplete.onHideSuggests()},a.container.getElement(".autocomplete-rule-content-section").onpaste=function(t){e.log("paste");var o=[];t.clipboardData?o=t.clipboardData.getData("text/plain").split("|"):window.clipboardData&&(o=window.clipboardData.getData("text").split("|"));var s=t.target,i=-1,c=0;for(c=0;c<a._autocomplete.innerInputs.length;c+=1)if(s===a._autocomplete.innerInputs[c]){i=c;break}var p,u=i>=0?i:a._autocomplete.badges.length,d=0;for(d=0;d<o.length;d+=1){if(p=a._getNumberOrFractionWithoutUnnecessaryZeroAndWhitespace(o[d]),a._isCorrectNumber(p))a._selectNumber(p,u);else if(a._isCorrectFraction(p))a._selectFraction(p,u);else{var m=n.getDatasetItemFrom(a._autocomplete,o[d]);m?(a._autocomplete.onSelect(m,u),m.type===l.closing_separator?e.is(n.getEvalContextStartPosition(u,a._autocomplete.selectedItems),"string")?n.isClosingSeparatorEndOfEval(u)?n.updateSelectedEvalPositions(u,a._autocomplete.selectedItems,!0):n.updateSelectedEvalEndPosition(u,a._autocomplete.selectedItems,!0):n.updateSelectedEvalPositions(u,a._autocomplete.selectedItems,!0):m.type===l.eval_function&&(n.addSelectedEval(u,a._autocomplete.selectedItems),n.updateSelectedEvalPositions(u,a._autocomplete.selectedItems,!0))):(a._autocomplete.onSelect({label:o[d],value:o[d],id_:null},u),n.updateSelectedEvalPositions(u,a._autocomplete.selectedItems,!0))}u>=0&&(u+=1)}var _=r.dicoAndGrammarCheckAndUpdateUI(a._mapDico,a._mapOperator,a._autocomplete);a._errorDicoOrGrammar="S_OK"!==_._rc,a.updateExpression(),a._localModelEvent&&o.length>0&&a._localModelEvent.publish({event:"onChangeExpression",data:null}),t.preventDefault(),a._autocomplete.currentPosition+=o.length-1,a._autocomplete.innerInputs[a._autocomplete.currentPosition]?(a._autocomplete.innerInputs[a._autocomplete.currentPosition].focus(),a._autocomplete.innerInputs[a._autocomplete.currentPosition].select()):(a.container.querySelector(".autocomplete-input").focus(),a.container.querySelector(".autocomplete-input").select())},a.createInitialExpression(),a._autocomplete.onHideSuggests(),a.currentInput=a._autocomplete.elements.input},setup:function(t){var o=this;o._mapDico={},o._mapOperator={},o._errorDicoOrGrammar=!0,o._editable=t.editable,o.container.addClassName(this.getClassNames("-container")),o._context=null,o._badgeOnLeft=null,o._lastPosition=-1,o.model=new a(t),o._localModelEvent=t._localModelEvent;o._localModelEvent&&o._editable&&o._localModelEvent.subscribe({event:"onPlus"},function(t){if(t.clickedId){var a=n.getDatasetItemFromId(o._autocomplete,t.clickedId);if(a){var s=o._lastPosition;if(a.type===p.VALUE){var i,l=n.getRelativeContext(s,o._autocomplete.selectedItems);l&&l.id_===a.parent_?(o._autocomplete.onSelect(a,s),n.updateSelectedEvalPositions(s,o._autocomplete.selectedItems,!0),o._lastPosition>=0&&(o._lastPosition+=1)):s>=0?(o._autocomplete.onSelect(a,s),n.updateSelectedEvalPositions(s,o._autocomplete.selectedItems,!0),o._lastPosition>=0&&(o._lastPosition+=1),i=n.getDatasetItemFromId(o._autocomplete,a.parent_),o._autocomplete.onSelect(i,s),n.updateSelectedEvalPositions(s,o._autocomplete.selectedItems,!0),o._lastPosition>=0&&(o._lastPosition+=1)):(o._autocomplete.onSelect(a,s),n.updateSelectedEvalPositions(s,o._autocomplete.selectedItems,!0),o._lastPosition>=0&&(o._lastPosition+=1),i=n.getDatasetItemFromId(o._autocomplete,a.parent_),o._autocomplete.onSelect(i,o._autocomplete.badges.length-1),n.updateSelectedEvalPositions(s,o._autocomplete.selectedItems,!0),o._lastPosition>=0&&(o._lastPosition+=1))}else o._autocomplete.onSelect(a,s),n.updateSelectedEvalPositions(s,o._autocomplete.selectedItems,!0),o._lastPosition>=0&&(o._lastPosition+=1);var c=r.dicoAndGrammarCheckAndUpdateUI(o._mapDico,o._mapOperator,o._autocomplete);o._errorDicoOrGrammar="S_OK"!==c._rc,o.updateExpression(),o._localModelEvent&&o._localModelEvent.publish({event:"onChangeExpression",data:null})}else e.log("object with id "+t.clickedId+" not found in dictionary")}o._autocomplete.onHideSuggests()});var i=function(e){if(e.items[0].disabled=!1,n.isBadgeAllowedInContext(e.items[0],e.id_autocomplete,o._autocomplete.currentPosition,o._autocomplete.selectedItems,()=>{e.items[0].disabled=!0})){if(e.id_autocomplete===p.PARAMETER){var t=e.suggestions.filter(t=>n.isBadgeAllowedInContext(t,e.id_autocomplete,o._autocomplete.currentPosition,o._autocomplete.selectedItems,()=>{e.items[0].disabled=!0},o._mapDico));e.suggestions=t}return e}},c=!1;0===o._minLengthBeforeSearch&&(c=!0),o._autocomplete=new s({showSuggestsOnFocus:c,minLengthBeforeSearch:o._minLengthBeforeSearch,floatingSuggestions:!0,multiSelect:!0,itemMultiSelect:!0,placeholder:"",noResultsMessage:!1,closableItems:!1,allowFreeInput:!0,filterEngine:function(e){var t=o._autocomplete.getDataset("dataset"+l.comparison_operator);if(o.currentInput)if(e[0]&&o._isCorrectNumber(o.currentInput.value)){var a=e.find(e=>e.name==="datasetname"+p.NUMBER&&e.suggestions[0].value===o.currentInput.value);(e=e.filter(e=>e.name!=="datasetname"+p.NUMBER)).unshift(a),e[0].id_autocomplete=p.NUMBER}else if(e[0]&&o._isCorrectFraction(o.currentInput.value)){var r=e.find(e=>e.name==="datasetname"+p.FRACTION&&e.suggestions[0].value===o.currentInput.value);(e=e.filter(e=>e.name!=="datasetname"+p.FRACTION)).unshift(r),e[0].id_autocomplete=p.FRACTION}else switch(o.currentInput.value){case"+":case"-":var n;(e=e.filter(e=>e.id_autocomplete!==l.arithmetic_operator_id||(n=e,!1))).unshift(n);break;case"=":(e=[t])[0].suggestions=t.items.filter(e=>e.id_===l.equal_id||e.id_===l.not_equal_id);break;case"≠":(e=[t])[0].suggestions=t.items.filter(e=>e.id_===l.not_equal_id);break;case"<":(e=[t])[0].suggestions=t.items.filter(e=>e.id_===l.lower_id||e.id_===l.lower_equal_id);break;case"≤":case"<=":(e=[t])[0].suggestions=t.items.filter(e=>e.id_===l.lower_equal_id);break;case">":(e=[t])[0].suggestions=t.items.filter(e=>e.id_===l.greater_id||e.id_===l.greater_equal_id);break;case"≥":case">=":(e=[t])[0].suggestions=t.items.filter(e=>e.id_===l.greater_equal_id)}return e=e.filter(i)},events:{onSelectBadge:function(){o._autocomplete.onHideSuggests()},onSelect:function(t){var a=document.activeElement;if(t.type)switch(t.type){case p.VALUE:var s;if(n.updateSelectedEvalPositions(o._autocomplete.currentPosition,o._autocomplete.selectedItems,!0),null===n.getRelativeContext(o._autocomplete.currentPosition,o._autocomplete.selectedItems)||n.getRelativeContext(o._autocomplete.currentPosition,o._autocomplete.selectedItems).type!==p.VARIANT||n.getRelativeContext(o._autocomplete.currentPosition,o._autocomplete.selectedItems).id_!==t.parent_)if(-1!==o._autocomplete.currentPosition){var i=o._autocomplete.currentPosition;s=n.getDatasetItemFromId(o._autocomplete,t.parent_),o._autocomplete.onSelect(s,i),o._autocomplete.currentPosition+=1,n.updateSelectedEvalPositions(i,o._autocomplete.selectedItems,!0)}else s=n.getDatasetItemFromId(o._autocomplete,t.parent_),o._autocomplete.onSelect(s,o._autocomplete.badges.length-1),o._autocomplete.currentPosition=-1,n.updateSelectedEvalPositions(o._autocomplete.badges.length-1,o._autocomplete.selectedItems,!0);break;case l.closing_separator:if(e.is(n.getEvalContextStartPosition(o._autocomplete.currentPosition,o._autocomplete.selectedItems),"string")){var c=-1===o._autocomplete.currentPosition?o._autocomplete.selectedItems.length-1:o._autocomplete.currentPosition;n.isClosingSeparatorEndOfEval(c)?n.updateSelectedEvalPositions(c,o._autocomplete.selectedItems,!0):n.updateSelectedEvalEndPosition(c,o._autocomplete.selectedItems,!0)}else n.updateSelectedEvalPositions(o._autocomplete.currentPosition,o._autocomplete.selectedItems,!0);break;case l.eval_function:n.addSelectedEval(o._autocomplete.currentPosition,o._autocomplete.selectedItems),n.updateSelectedEvalPositions(o._autocomplete.currentPosition,o._autocomplete.selectedItems,!0),o._autocomplete.currentPosition=-1!==o._autocomplete.currentPosition?o._autocomplete.currentPosition+1:-1;var u=o._autocomplete.getDataset("dataset"+l.opening_separator);o._autocomplete.onSelect(u.items.find(e=>e.id_===l.open_id),o._autocomplete.currentPosition),n.updateSelectedEvalPositions(o._autocomplete.currentPosition,o._autocomplete.selectedItems,!0);break;default:n.updateSelectedEvalPositions(o._autocomplete.currentPosition,o._autocomplete.selectedItems,!0)}else{n.updateSelectedEvalPositions(o._autocomplete.currentPosition,o._autocomplete.selectedItems,!0);var d=o._getNumberOrFractionWithoutUnnecessaryZeroAndWhitespace(t.value);if(o._isCorrectNumber(d))o._autocomplete.onUnselect(t,o._autocomplete.currentPosition),o._selectNumber(d,o._autocomplete.currentPosition);else if(o._isCorrectFraction(d))o._autocomplete.onUnselect(t,o._autocomplete.currentPosition),o._selectFraction(d,o._autocomplete.currentPosition);else{var m=o._autocomplete.getDataset("dataset"+l.comparison_operator);"<="===t.value?(o._autocomplete.onUnselect(t),o._autocomplete.onSelect(m.items.find(e=>e.id_===l.lower_equal_id),o._autocomplete.currentPosition),o._autocomplete.currentPosition=-1!==o._autocomplete.currentPosition?o._autocomplete.currentPosition+1:-1):">="===t.value&&(o._autocomplete.onUnselect(t),o._autocomplete.onSelect(m.items.find(e=>e.id_===l.greater_equal_id),o._autocomplete.currentPosition),o._autocomplete.currentPosition=-1!==o._autocomplete.currentPosition?o._autocomplete.currentPosition+1:-1)}}o._autocomplete.onHideSuggests();var _=r.dicoAndGrammarCheckAndUpdateUI(o._mapDico,o._mapOperator,o._autocomplete);o._errorDicoOrGrammar="S_OK"!==_._rc,o.updateExpression(),o._localModelEvent&&o._localModelEvent.publish({event:"onChangeExpression",data:null}),a.focus()},onUnselect:function(t,a){t.type!==l.eval_function||e.is(n.getEvalContextStartPosition(a,o._autocomplete.selectedItems),"string")||n.removeSelectedEval(a);var s=n.getRelativeBadgeAndIndexOnLeft(a,o._autocomplete.selectedItems),i=n.getRelativeBadgeAndIndexOnLeft(a+1,o._autocomplete.selectedItems);i&&(t.type!==l.opening_separator||!s||!s.badge||s.badge.type!==l.eval_function||i.badge&&i.badge.type===l.opening_separator?t.type===l.eval_function&&i.badge&&i.badge.type===l.opening_separator&&(o._autocomplete.onUnselect(i.badge,i.index),n.updateSelectedEvalPositions(i.index,o._autocomplete.selectedItems,!1)):(o._autocomplete.onUnselect(s.badge,s.index),n.removeSelectedEval(s.index),n.updateSelectedEvalPositions(s.index,o._autocomplete.selectedItems,!1))),t.type===l.closing_separator&&n.isClosingSeparatorEndOfEval(a)?n.updateSelectedEvalEndPosition(a,o._autocomplete.selectedItems,!1):n.updateSelectedEvalPositions(a,o._autocomplete.selectedItems,!1);var c=r.dicoAndGrammarCheckAndUpdateUI(o._mapDico,o._mapOperator,o._autocomplete);o._errorDicoOrGrammar="S_OK"!==c._rc,o.updateExpression(),o._localModelEvent&&o._localModelEvent.publish({event:"onChangeExpression",data:null})},onBlur:function(){o._lastPosition=o._autocomplete.currentPosition},onKeyUp:function(e){o.currentInput=e.target;var t=o.currentInput.value.replaceAll(/\s/g,"");if(o._isCorrectNumber(t)){o.currentInput.value=t;var a=o._autocomplete.getDataset("datasetname"+p.NUMBER),r=o._getNumberOrFractionWithoutUnnecessaryZeroAndWhitespace(o.currentInput.value);o.currentInput.value!==r&&(o.currentInput.value=r,o.currentInput.setSelectionRange(o.currentInputPosition,o.currentInputPosition),o.currentInput.focus()),a.items=[],o._autocomplete.addItems([{type:p.NUMBER,label:o.currentInput.value,value:o.currentInput.value,id_:p.NUMBER+"_"+o.currentInput.value,subLabel:"(number)"}],a),a.dataCache[o.currentInput.value]&&0!==a.dataCache[o.currentInput.value].length||(a.dataCache[o.currentInput.value]=a.items)}else if(o._isCorrectFraction(t)){o.currentInput.value=t;var n=o._autocomplete.getDataset("datasetname"+p.FRACTION),s=o._getNumberOrFractionWithoutUnnecessaryZeroAndWhitespace(o.currentInput.value);o.currentInput.value!==s&&(o.currentInput.value=s,o.currentInput.setSelectionRange(o.currentInputPosition,o.currentInputPosition),o.currentInput.focus()),n.items=[],o._autocomplete.addItems([{type:p.FRACTION,label:o.currentInput.value,value:o.currentInput.value,id_:p.FRACTION+"_"+o.currentInput.value,subLabel:"(fraction)"}],n),n.dataCache[o.currentInput.value]&&0!==n.dataCache[o.currentInput.value].length||(n.dataCache[o.currentInput.value]=n.items)}else"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||o._localModelEvent.publish({event:"refreshDictionary"});e.stopPropagation()}}}),o.createMapDico(),o.createDataSet(),!1===o._editable&&o._autocomplete.disable(),o._autocomplete.elements.inputContainer.addEventListener("click",function(){o._localModelEvent&&o._localModelEvent.publish({event:"refreshDictionary"})})},createMapDico:function(){this._mapDico=i.dicoMinifiedV3ToMap(this.model.get("dictionary"))},createDataSet:function(){var e,t,a,o=this,r=0,n=o._mapDico,s=null,i=[],l={name:"datasetname"+p.PARAMETER,id_autocomplete:p.PARAMETER,id_:p.PARAMETER,displayName:!1,items:[]},u={name:"datasetname"+p.NUMBER,id_autocomplete:p.NUMBER,id_:p.NUMBER,displayName:!1,items:[]},d={name:"datasetname"+p.FRACTION,id_autocomplete:p.FRACTION,id_:p.FRACTION,displayName:!1,items:[]},m=null;for(s in n)if(n.hasOwnProperty(s)){switch(n[s].type){case p.VALUE:break;case p.VARIANT:for((m={}).name="datasetname"+n[s].title,m.id_autocomplete=s,m.id_=s,m.displayName=!1,m.items=[],m.items.push({value:n[s].title,id_autocomplete:s,id_:s,type:p.VARIANT}),m.items[0].items=[],r=0;r<n[s].values.length;r+=1)e=n[s].values[r],m.items[0].items.push({parent_:s,value:n[e].title,id_:e,type:p.VALUE});break;case p.PARAMETER:l.items.push({value:n[s].title,id_autocomplete:s,id_:s,type:p.PARAMETER});break;case p.VARIABILITY_GROUP:for((m={}).name="datasetname"+n[s].title,m.id_autocomplete=s,m.id_=s,m.displayName=!1,m.items=[],m.items.push({value:n[s].title,id_autocomplete:s,id_:s,type:p.VARIABILITY_GROUP}),m.items[0].items=[],r=0;r<n[s].content.length;r+=1)e=n[s].content[r],m.items[0].items.push({parent_:s,value:n[e].title,id_:e,type:p.OPTION})}null!==m&&(i.push(m),m=null)}for(l.items.length>0&&i.push(l),i.push(u),i.push(d),r=0;r<i.length;r+=1)o._autocomplete.addDataset(i[r]);Object.entries(c).forEach(([e,r])=>{(a=r.operators).forEach(t=>{t.type=e,o._mapOperator[t.id_]={value:t.value,type:t.type},t.label&&(o._mapOperator[t.id_].label=t.label)}),t={name:"dataset"+e,displayName:!1,id_autocomplete:r.id,items:a},o._autocomplete.addDataset(t)})},updateExpression:function(){var e=this._autocomplete.selectedItems,t=0,a=[];for(t=0;t<e.length;t+=1){var o={};o.id=e[t].id_?e[t].id_:"undefined",o.label=e[t].label?e[t].label:"undefined",o.type=e[t].type?e[t].type:"dummy",o.value=e[t].value?e[t].value:"undefined",a.push(o)}var r=this.model.get("currentExpression");null==r&&(r={}),r.items=a,a.length>0?this.container.querySelector(".autocomplete-input").placeholder="":this.container.querySelector(".autocomplete-input").placeholder=d._type_expression+"...",this.model.set("currentExpression",r)},getExpression:function(){var e=this.model.get("currentExpression");return e&&e.items?e.items:[]},setExpression:function(e){this.model.set("currentExpression",e)},_getNumberOrFractionWithoutUnnecessaryZeroAndWhitespace:function(e){var t=e.replaceAll(/\s/g,"");if(e.contains("/")){var a=t.split("/");return parseInt(a[0])+"/"+parseInt(a[1])}return parseInt(t).toString()},_isCorrectNumber:function(e){return!!(/^[0-9]+$/.test(e)&&e<=_.numberMaxValue)},_isCorrectFraction:function(e){if(/^[0-9]+\/[0-9]+$/.test(e)){var t=e.split("/");if(t[0]<=_.fractionMaxValue&&t[1]<=_.fractionMaxValue&&t[1]>0)return!0}return!1},_selectNumber:function(e,t){var a=this._autocomplete.getDataset("datasetname"+p.NUMBER);a.items=[],this._autocomplete.addItems([{type:p.NUMBER,label:e,value:e,id_:p.NUMBER+"_"+e,subLabel:"(number)"}],a),this._autocomplete.onSelect(a.items[0],t)},_selectFraction:function(e,t){var a=this._autocomplete.getDataset("datasetname"+p.FRACTION);a.items=[],this._autocomplete.addItems([{type:p.FRACTION,label:e,value:e,id_:p.FRACTION+"_"+e,subLabel:"(fraction)"}],a),this._autocomplete.onSelect(a.items[0],t)},_isPlusOperatorNecessary:function(e,t){if(t>0)switch(e[t-1].type){case l.opening_separator:case l.comparison_operator:case l.arithmetic_operator:return!1}return!0},_createNumberOrFractionFromInitialExpression:function(e,t,a){var o,r=e.items[t].value.substring(0,1);for(var s of c[l.arithmetic_operator].operators)if(r===s.value&&(s.id_!==l.plus_id||s.id_===l.plus_id&&this._isPlusOperatorNecessary(this._autocomplete.selectedItems,this._autocomplete.badges.length))&&(o=n.getDatasetItemFromId(this._autocomplete,s.id_))){this._autocomplete.onSelect(o,this._autocomplete.badges.length),n.updateSelectedEvalPositions(this._autocomplete.badges.length,this._autocomplete.selectedItems,!0);break}switch(a){case p.NUMBER:var i=e.items[t].value.substring(1);this._selectNumber(i,this._autocomplete.badges.length);break;case p.FRACTION:var u=e.items[t].value.substring(1);this._selectFraction(u,this._autocomplete.badges.length)}return n.updateSelectedEvalPositions(this._autocomplete.badges.length,this._autocomplete.selectedItems,!0),o},createInitialExpression:function(){this._autocomplete.unselectAll(),n.resetSelectedEval();var t=this.model.get("currentExpression"),a=JSON.parse(JSON.stringify(t));if(t&&t.items&&0!==t.items.length){var o,s=0;for(this.container.querySelector(".autocomplete-input").placeholder="",s=0;s<a.items.length;s+=1){var i=this._autocomplete.badges.length;if(i>0&&a.items[s].type===p.PARAMETER&&this._autocomplete.selectedItems[i-1].type===p.NUMBER&&"1"===this._autocomplete.selectedItems[i-1].value&&this._autocomplete.onUnselect(a.items[s-1],this._autocomplete.badges.length-1),a.items[s].type===p.VARIABILITY_GROUP);else if(!a.items[s].type||a.items[s].type.toLowerCase()!==p.NUMBER&&a.items[s].type.toLowerCase()!==p.FRACTION)if((o=n.getDatasetItemFromId(this._autocomplete,a.items[s].id))&&o.type===p.VARIABILITY_GROUP);else if(o)this._autocomplete.onSelect(o,this._autocomplete.badges.length),o.type===l.eval_function?n.addSelectedEval(this._autocomplete.currentPosition,this._autocomplete.selectedItems):o.type===l.closing_separator&&e.is(n.getEvalContextStartPosition(this._autocomplete.currentPosition,this._autocomplete.selectedItems),"string")&&n.updateSelectedEvalEndPosition(this._autocomplete.currentPosition,this._autocomplete.selectedItems,!0);else{for(var u of c[l.comparison_operator].operators)if(t.items[s].value===u.value){o=n.getDatasetItemFromId(this._autocomplete,u.id_);break}o?this._autocomplete.onSelect(o,this._autocomplete.badges.length):this._autocomplete.onSelect({label:t.items[s].value,value:t.items[s].value,id_:null},this._autocomplete.badges.length),n.updateSelectedEvalPositions(this._autocomplete.badges.length,this._autocomplete.selectedItems,!0)}else o=this._createNumberOrFractionFromInitialExpression(a,s,a.items[s].type.toLowerCase());o=void 0}}else this.container.querySelector(".autocomplete-input").placeholder=d._type_expression+"...";var m=r.dicoAndGrammarCheckAndUpdateUI(this._mapDico,this._mapOperator,this._autocomplete);this._errorDicoOrGrammar="S_OK"!==m._rc},getErrorsCount:function(){return r.getGlobalErrorCounts(this._mapDico,this._mapOperator,this._autocomplete)},isThereError:function(){return this._errorDicoOrGrammar},getAutocomplete:function(){return this._autocomplete}})});