define("DS/TerminologyEditor/TerminologyEditor",["UWA/Core","DS/ApplicationFrame/CommandsManager","DS/LifecycleServices/LifecycleServicesSettings","DS/Windows/ImmersiveFrame","DS/WebUAUtils/WebUAUtils","DS/IPClassifyUtil/bsd_utils/BSDCommandProxy","DS/IPClassifyUtil/bsd_utils/BSDSettingsMgt","DS/IPClassifyUtil/bsd_utils/BSDContext","DS/TerminologyEditor/TerminologyComponent","DS/TerminologyEditor/TerminologyIdCardCont","DS/TerminologyEditor/views/TerminologyMode","DS/TerminologyEditor/TerminologyTreeCont","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/ActionBar/TerminologyCommandManager","DS/TerminologyEditor/utils/TerminologyEditorEvents","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TerminologyEditor/service/TerminologyServices","DS/TerminologyEditor/service/TerminologyTypeService","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUtil/IPClassifyUtility","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/utils/TerminologyEditorKeyboardListener","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/TerminologyEditor/utils/TerminologyCommunication","DS/IPClassifyUtil/bsd_utils/BSDAttributeMgt","DS/IPClassifyUtil/IPClassifyModelEvents","DS/WidgetServices/WidgetServices","DS/IPClassifyUXUtil/CredentialsView","DS/PlatformAPI/PlatformAPI","text!DS/TerminologyEditor/assets/terminology_settings.json","DS/TerminologyEditor/utils/TerminologyLoaderGlobal"],function(e,t,o,n,i,r,l,a,s,d,c,u,g,m,p,f,h,y,T,v,_,C,S,E,w,b,D,I,x,P,A){"use strict";function N(){var t=this;t.options=t.options||{},e.extend(t.options,{custo_view_title:f.name_Widget_Title}),t.checkOnCommand=!1,a.set(t),window.top.performance.mark("loadRequire_end");var n=function(e){var t=l.getSpecificWidgetPreference(e);t&&t.length>0&&function(e){if(e){var t=f[e.label];e.label=t||e.label,e.options&&e.options.forEach(function(e){e.label=f[e.label]})}}(t[0]),"useIndexAcceleration"===e&&(t[0].onchange="onUseOnlyDBChange",widget.addEvent("onUseOnlyDBChange",function(){var e=JSON.parse(JSON.stringify(widget.getPreference("autoSwitch")));widget.getValue("useIndexAcceleration")?e.disabled=!1:e.disabled=!0,widget.addPreference(e),widget.dispatchEvent("onEdit")})),"autoSwitch"===e&&(t[0].disabled=!widget.getValue("useIndexAcceleration")),t&&widget.mergePreferences(t)},i=JSON.parse(P);"function"==typeof window.updateSettings&&window.updateSettings(i),l.setApp(i.padsettings,"enopad",!0),widget.setValue("tenantAware",!0),widget.addEventOnce("onNoSecurityContext",function(t){!0!==t&&(_._isSecurityCTXInitialized=!1,widget.setBody(" "),e.createElement("div",{text:f.authentication_error.title+f.authentication_error.subtitle,class:"TerminologyEditor_auth_error"}).inject(widget.body))}),widget.addEventOnce("onNoPlatform",function(){_._isTenantInitialized=!1,widget.setBody(" "),e.createElement("div",{text:f.get("noPlatform_error"),class:"TerminologyEditor_auth_error"}).inject(widget.body)}),t.updateTitle=function(){t.setTitle&&t.setTitle(t._label)},widget.addEvent("onPad_security_ctx",t.updateTitle.bind(t)),widget.addEvent("onTenantChange",t.updateTitle.bind(t)),widget.addPreference({name:"xPref_CREDENTIAL",type:"hidden"}),n("activateBIFilter"),D.addWidgetPreference({name:"bsdActivateTreeFilter",type:"hidden"}),D.getWidgetObject().setValue("bsdActivateTreeFilter",!1),n("useIndexAcceleration"),n("autoSwitch"),!0===widget.getValue("noCompass")&&widget.setValue("autoSwitch","Never"),window.authoringModeODT&&widget.setValue("useIndexAcceleration",!1),"1"===widget.getValue("debug_me")&&(n("expandSaveLimitation"),n("resetCustomization"),n("compactModeForLeftSidebar")),!0===D.getWidgetPreferenceValue("Activate_relationsColumns")?n("activateRelationsColumns"):widget.addPreference({name:"activateRelationsColumns",type:"hidden"}),t.widget.addEvent("endEdit",l.updateWidgetPreferences.bind(l)),l.updateWidgetPreferences(),l.setSetting("activate_autodownload",!1),l.setSetting("EditModeActivated",!0),l.setSetting("compactMode",!0),t.widget.getValue("x3dAppId")||t.widget.addPreference({name:"x3dAppId",type:"hidden",defaultValue:"ENOTERME_AP"}),t.widget.addEvent("onPlatformIdChange",function(e,t){"x3dPlatformId"===e&&widget.dispatchEvent("onTenantChange")}),_.setWidgetRefresh(t.onRefresh.bind(t));let s={};s.onRefresh=_.getWidgetRefresh(),s.widgetCBOnPopup=_.onTenantSecurityCTXPopup,I.render(s),t.promiseCtx=new Promise(function(e){_.checkSecurityCTXandTenantInitialization(function(){e()},!0),o.app_initialization(()=>{})}),p.onCurrentTerminologyChange(function(e){t.setTitle(this.getLabel())});var d=D.getWidgetId()+D.getTenantID()+"ENOTERME_AP";if(x.subscribe(d,function(){t.terminologyTree_Cont.refreshTerminologyTreeAndContent()}),p.onTerminologyRename(function(o){o.getID()===g.getCurrentTerminologyID()&&e.is(widget)&&t.setTitle(o.getLabel())}),t.setTitle=function(e){var o=D.getTenantID(),n=D.getWidgetPreferenceValue("xPref_CREDENTIAL");t._csName&&t._currentSC===n?t._setTitle(e,o,t._csName):(t._currentSC=n,t._csName=n?n.slice(n.lastIndexOf(".")+1,n.length).trim():"",t._setTitle(e,o,t._csName))},t._setTitle=function(e,o,n){var i=e||"";n&&(i=n+" - "+i),(o="OnPremise"===D.getTenantID()?"":o)&&(i+=" ("+o+")"),t._label=e,widget.setTitle(i)},t._onRefreshTerminology=function(o){var n=!1,i=[];if(c.switchtoAuthoringMode(),e.is(o.authored.connected,"array")){var r=g.getCurrentTerminology().getID(),l=o.authored.connected;if(l.length>0)for(var a=0;a<l.length;a++){var s=l[a];if(e.is(s,"array")){var d=s[0];if(s.length>1&&i.push(s[1]),d===r){n=!0;break}}}}n&&t.terminologyContent_Cont.loadContentAndSelect(g.getCurrentTerminology(),i)},E.subscribe("TerminologyEditor.refresh",t._onRefreshTerminology.bind(t)),t._commandProxy=r.create({events:{onRefresh:t._onRefreshTerminology.bind(t)}}),null===t.terminologyTree_Cont||void 0===t.terminologyTree_Cont){t.core=e,t.widget.body.empty(),t._buildSkeleton(),A.setContainer("global",this.widget.body.globalLoaderContainer),A.addComponentsToLoad("global",{widget:""});t.widget.addEvent("endEdit",function(){t.widget.getPreferences().forEach(function(o){var n="boolean"===o.type&&e.is(o.value,"string")?t.convertToBool(o.value):o.value;t.widget.setValue(o.name,n)})}),t.terminologyGlobal_div=t.widget.body.container,t.terminologyTree_div=t.widget.body.left_side_div,t.terminologySlide_div=t.widget.body.slide_div,t.terminologyTreeDoc_div=t.widget.body.right_side_div,t.terminologyIdCard_div=t.widget.body.top_right_side_div,t.terminologyContent_div=t.widget.body.bottom_right_side_div;var u=t._initializeTerminologyEditorComponent.bind(t);if(null===t.terminologyContent_Cont){var h={x3dAppId:t.widget.getValue("x3dAppId"),lang:t.widget.lang?t.widget.lang:t.widget.getValue("lang"),layout:{view_customization:null,css_view_class:t.css_view_class,store_roots_in_pref:!0,padshell:!0},authorize_setStructure:!0,settings:i};!0===D.getWidgetPreferenceValue("resetCustomization")?(localStorage.removeItem("PADTreeListDefinition."+t.widget.getValue("x3dAppId")+"_"+widget.getValue("x3dPlatformId")),u(h)):S.getContentViewPreference().then(function(e){if(e){var t=e.preference;h.layout.view_customization=t;var o=widget.getValue("vMigration");t&&o!==t.version&&console.log("Terminology migration needed for preferences")}Promise.all([]).then(function(){u(h)})}),t.getSelectedNodes=function(){var e=m.getTempSelection(),t=e||g.getSelectedNodes();if(1===(Array.isArray(t)?t.length:0)){var o=t[0];if(o&&"TerminologySection_Trash"===o.plmType){var n=_.getTrashCont();if(n){var i=n.getSelectedNodes();Array.isArray(i)&&i.length>0&&(t=i)}}}return t},t.getCurrentTerminology=function(){var e=S.getCurrentSecurityContextAndTerminologyData(!0);return JSON.stringify(e)},t.getSecurityContext=function(){var e=S.getTenant();return{SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL"),tenant:e}},t.beginBlockingTransaction=function(e){require(["DS/UIKIT/Mask"],function(o){o.mask(t.terminologyContent_div,e)})},t.endBlockingTransaction=function(){require(["DS/UIKIT/Mask"],function(e){e.unmask(t.terminologyContent_div)})},t.author=function(e){},t.displayNotification=function(e){e&&e.eventID&&"error"===e.eventID&&e.msg&&-1!==e.msg.indexOf(f.msg_error_createNewFromFramework)?T.displayNotification({title:f.replace(f.msg_error_createNew.Title,{type:y.TYPE_SECTION===g.getCurrentTerminologyID()?f.name_Terminology_type:f.name_Term_type}),subtitle:f.msg_error_createNew.Advice,message:f.msg_error_createNew.Details,className:e.eventID}):T.displayNotification({message:e.msg,className:e.eventID})},t.getPADTreeDocument=function(){return _.getContent()?_.getContent().getPADTreeDocument():this.options.model},t.toggleView=function(t){e.is(_.getContent().toggleView)&&_.getContent().toggleView(t)},t.getPADTreeListView=function(){return _.getContent().getPADTreeListView()},t.compactMode=function(e){return _.getContent().compactMode(e)}}}}function M(e){return void 0===widget.getValue(e)||null===widget.getValue(e)}function R(e){console.log(e)}var O=new Promise(function(e){require(["DS/TerminologyEditor/utils/TerminologyEditorUtil"],e)}),V=e.extend({widget:null,promiseCtx:null,promiseInit:null,terminologyContent_Cont:null,terminologyTree_div:null,terminologyTreeDoc_div:null,terminologyTree_Cont:null,terminologyIdCard_div:null,terminologyIdCard_Cont:null,core:null,widthToHideLeftPanel:300,_actionbar:null,_commandProxy:null,terminologyTree_W_NotLinked:!1,css_view_class:"windowed",_mouseEventsManager:{unlockMouseMove:!1,draggingXSlider:null,mouseStartXSlider:null,initialMouseStartXSlider:null,dragginDirection:null,cancelDragging:!1,spanPosition:null,widthLeftDiv:null,widthRightDiv:null,widthLeftDivSave:null,widthRightDivSave:null,widthGlobalDiv:null,newWidthGlobalDiv:null},init:function(t){var o=this;this.widget=t.widget,t.launchWithReadMode&&(this.widget.launchWithReadMode=this.widget.readOnly=t.launchWithReadMode),this.widget.terminologyToOpen=t.terminologyToOpen,this.reInitialize=t.reInitialize;var n=null,i={};this.widget=t.widget,this.widget.changeInPreference={},this.widget.refreshDuetoChangeInPreference=!1,this.widget.addEvent("onLoad",this.onLoad.bind(this)),this.widget.addEvent("onRefresh",this.onRefresh.bind(this)),this.widget.addEvent("onDestroy",this.onDestroy.bind(this)),this.widget.addEvent("onResize",this.onResize.bind(this)),this.widget.addEvent("onEdit",function(){n||(n=n||{},o.widget.preferences.forEach(function(e){"hidden"!==e.type&&(n[e.name]=o.widget.getValue(e.name))}))}),this.widget.addEvent("endEdit",function(t){o._manageOpenWith(),!(!t||!t.submitted&&!t.needRefresh)&&n&&(o.widget.changeInPreference={},Object.keys(n).forEach(function(e){if(i[e]=o.widget.getValue(e),n[e]!==i[e]){if("xPref_CREDENTIAL"===e&&i[e])require("DS/TerminologyEditor/service/TerminologyEditorWebService").setPreferredSecurityContext(i[e]);o.widget.changeInPreference[e]=i[e]}}),e.log(o.widget.changeInPreference),o.widget.refreshDuetoChangeInPreference=!0,n=null)})},onRefresh:function(t){if(t&&t.reInitialize)this._onReInit();else{if(this.terminologyContent_Cont.addEvent("onCompleteRefreshNodes",function(e){this.removeEvent("onCompleteRefreshNodes"),T.displayNotification({message:f.msg_info_refresh,className:"primary"})}),t&&e.is(t.authored.deleted,"array")){var o=g.getCurrentTerminology();o.getID()===t.authored.deleted[0]&&o.getParent().select(!0),c.switchtoAuthoringMode()}var n=_.getFindInCtx();n&&n.visibleFlag&&n.closeViewafterRefresh(),c.updateIconAndSettings(!1),this.terminologyTree_Cont.refreshTerminologyTreeAndContent(),this.widget.refreshDuetoChangeInPreference=!1,this.widget.changeInPreference={}}},onClearSelection:function(){},onDestroy:function(){},onResize:function(){var e=this;setTimeout(function(){e.terminologyGlobal_div&&e.terminologyIdCard_Cont&&0!==e.terminologyGlobal_div.clientWidth&&e.terminologyIdCard_Cont.updateDisplayPath()},500);var t=_.getTreeCont();t&&(v.isWidgetMaximized()?t.setOrderToolAreaSelectable(!0):(t.activateTreeFilter(!1),t.setOrderToolAreaSelectable(!1)))},setSupportedTenant:function(){return new Promise((e,t)=>{require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],o=>{o.getAppInfo({appId:widget.getValue("x3dAppId")?widget.getValue("x3dAppId"):"ENOTERME_AP",onComplete:function(t){t.platforms.length>0&&widget.setValue("x3dPlatformId",t.platforms[0].id),e()},onFailure:t})})})},onLoad:function(){v.setPCSEntry(widget.id+"_TerminologyWidgetLoad",!0);var e=!0===widget.getValue("noCompass");this._assignTenantFromX3DContentId();var t=widget.getValue("x3dPlatformId"),o=Promise.resolve();t||e||(o=this.setSupportedTenant()),o.then(this._preLoad.bind(this))},_preLoad:function(){window.top.performance.mark("onLoad_begin");if(M("vMigration")&&M("xPref_CREDENTIAL"))widget.setValue("vMigration",7);else{var e=widget.getValue("vMigration");e=e||0}this._onLoad()},_onReInit:function(){delete V.terminologyTree_Cont,V.terminologyTree_Cont=null,delete V.terminologyContent_Cont,V.terminologyContent_Cont=null,delete V.terminologyIdCard_Cont,V.terminologyIdCard_Cont=null,V.widget.body.container=null,V.terminologyTree_W_NotLinked=!1,p.unsubscribeAll(),V.init({widget:this.widget,reInitialize:!0})},_onLoad:function(){var e=this;this.promiseInit=new Promise(function(t){!0===widget.getValue("noCompass")?p.onTerminologyEditorReadyforWenInWin(function(){t()}):e.widget.addEvent("onTerminologyEditorReady",function(){t()})}),require(["DS/IPClassifyUtil/bsd_utils/BSDConfiguration","text!DS/TerminologyEditor/assets/TerminologyEditorConf.json"],function(t,o){var n=JSON.parse(o);t.mergeConfig(n);var i=[];if(!0!==e.reInitialize){var r=w.initialize({defaultAttributesJSON:"DS/TerminologyEditor/assets/TerminologyEditorColumns.json"});i.push(r)}Promise.all(i).then(function(t){N.apply(e,t[0])})})},_slidderMoveEndCallback:function(){this.terminologyIdCard_Cont&&this.terminologyIdCard_Cont.updateDisplayPath()},_buildSkeleton:function(){if(!this.core.is(this.widget.body.container)){var t=e.createElement("div",{class:"wux-control-inline-container",style:{"vertical-align":"top"}}).inject(this.widget.body),o=new n({identifier:"TerminologyEditor_helpFrame"});o.inject(t),"false"!==D.getUrlParameter("UAPanel")&&i.setPanelHelpMode({immersiveFrame:o}),this.widget.body.container=e.createElement("div",{class:"TerminologyEditor_global_container"}).inject(o.getFreeZone(),"top"),this.widget.body.globalLoaderContainer=e.createElement("div",{class:"TerminologyEditor_global_loader"}).inject(this.widget.body.container),this.widget.body.left_side_div=e.createElement("div",{class:"TerminologyEditor_left_side_div"}).inject(this.widget.body.container),this.widget.body.right_side_div=e.createElement("div",{class:"TerminologyEditor_right_side_div"}).inject(this.widget.body.container),this.widget.body.top_right_side_div=e.createElement("div",{class:"TerminologyEditor_top_right_side_div"}).inject(this.widget.body.right_side_div),this.widget.body.bottom_right_side_div=e.createElement("div",{class:"TerminologyEditor_bottom_right_side_div"}).inject(this.widget.body.right_side_div)}},convertToBool:function(e){return"true"===e.toLowerCase()},_assignTenantFromX3DContentId:function(){var t=this.widget.getValue("X3DContentId");if(t){var o=e.is(t,"string")?JSON.parse(t):t;if(o.data&&o.data.items&&o.data.items.length>0){var n=o.data.items[0].envId;n&&"OnPremise"!==n&&this.widget.setValue("x3dPlatformId",n)}}},_assignSelectedContentIdFromX3DContentId:function(){var t=widget.getValue("X3DContentId");if(t){var o=e.is(t,"string")?JSON.parse(t):t;if(o.data&&o.data.items&&o.data.items.length>0&&o.data.items[0].contentId){var n=o.data.items[0].contentId;this.widget.setValue("x3dSelectedContentId",n)}}},_manageOpenWith:function(){var t=this.widget.getValue("X3DContentId");if(t){var o=e.is(t,"string")?JSON.parse(t):t;if(o.data.items.length>0){this._assignTenantFromX3DContentId(),this._assignSelectedContentIdFromX3DContentId();var n=o.data.items[0],i=n.objectType;if("Terminology"===i||"Term"===i||void 0===i){c.switchtoAuthoringMode();var r=n.objectId,l=_.getTreeCont();this.widget.setValue("X3DContentId",""),l.expandTreeAndSelectTerminology({terminologyToFindAndSelect:{ids:[r]},partiallyExpandPath:!0,onComplete:function(){},onGiveUp:R.bind(null," expandTreeAndSelectTerminology:onGiveUp"),onFailure:function(e){T.displayNotification({message:e instanceof Error?e.message:e,className:"error"})}})}}}},_initializeTerminologyEditorComponent:function(t){var o=this,n=o.terminologyTree_Cont;o.terminologyTree_Cont||(n=new u({lang:o.widget.lang?o.widget.lang:o.widget.getValue("lang"),css_view_class:o.css_view_class,events:{onReady:function(){if(_.setTreeCont(this),o.terminologyTree_Cont=this,null!==o.terminologyContent_Cont)o.terminologyTree_Cont.setOption("_terminologyContentView",o.terminologyContent_Cont);else{if(!0===o.terminologyTree_W_NotLinked)throw new Error("TerminologyTree are not linked !!!");o.terminologyTree_W_NotLinked=!0}o.terminologyTree_Cont._commonToolSection.inject(this.elements.container,0),o._manageOpenWith(),!0===widget.getValue("noCompass")?p.notifyTerminologyEditorReady():o.widget.dispatchEvent("onTerminologyEditorReady")}}}));var i,r=o._retrieveinitializationOpts(),l=e.extend(t,r);(i=[]).length&&(l.additionalColumnsModules=i),new s(l,n),o.promiseInit.then(()=>{if(o.terminologyTree_Cont){o.terminologyTree_Cont._doScrolltotheSavedPosition(),v.setPCSEntry(widget.id+"_TerminologyWidgetLoad",!1),v.sendPCSTracketPageEvent("TerminologyWidget_Performance","TerminologyWidgetLoad",widget.id+"_TerminologyWidgetLoad");var e=window.top.performance.getEntriesByName("createWidget_begin");e&&e.length>0&&window.top.performance.mark("createWidget_end")}}),o._keyboardListener||(o._keyboardListener=new C,o._keyboardListener.startObservingKeyboard())},_viewChanged:function(){b.getModelEvents().publish({event:"ENOTerm/AttributesCustomization/columnSwitchDone",data:{}})},_retrieveinitializationOpts:function(){var e=this;return{renderTo:e.terminologyContent_div,events:{onActionBarReadyToBuild:function(){e.elements=this.elements,e.options=this.options,e.togglePanel=this.togglePanel,null===e.terminologyIdCard_Cont&&new d({lang:e.widget.lang?e.widget.lang:e.widget.getValue("lang"),css_view_class:e.css_view_class,events:{onReady:function(){e.terminologyIdCard_Cont=this,e.terminologyIdCard_Cont.render().inject(e.terminologyIdCard_div)}}})},onReady:function(){if(e.terminologyContent_Cont=this,e.addEvent=e.terminologyContent_Cont.addEvent.bind(e.terminologyContent_Cont),null!==e.terminologyTree_Cont)e.terminologyTree_Cont.setOption("_terminologyContentView",e.terminologyContent_Cont);else{if(!0===e.terminologyTree_W_NotLinked)throw new Error("TerminologyTree are not linked !!!");e.terminologyTree_W_NotLinked=!0}e.terminologyContent_Cont.options.renderTo&&e.terminologyContent_Cont.render().inject(e.terminologyContent_Cont.options.renderTo),e.promiseInit.then(function(){if(e.terminologyTree_Cont){e.terminologyContent_Cont._OnPADComponentReady();var t=e.terminologyContent_Cont.getPADTreeListView();if(t&&e.terminologyTree_Cont.modeChange({viewMode:t.options.viewMode}),e.widget.dispatchEvent("onTerminologyComponentReady"),!0===e.widget.launchWithReadMode&&e.widget.terminologyToOpen){var o=e.widget.terminologyToOpen;e.terminologyTree_Cont.expandTreeAndSelectTerminology({terminologyToFindAndSelect:{ids:[o]},partiallyExpandPath:!0,onComplete:R.bind(null," expandTreeAndSelectTerminology:onComplete"),onGiveUp:R.bind(null," expandTreeAndSelectTerminology:onGiveUp"),onFailure:function(e){T.displayNotification({message:e instanceof Error?e.message:e,className:"error"})}})}}}),require(["DS/IPClassifyUtil/IPClassifyCommunication"],function(t){if(!0===widget.getValue("noCompass")){var o;const n=function(n){clearTimeout(o),o=setTimeout(function(){var o=e.terminologyContent_Cont.getPADTreeDocument().getXSO().get(),n=[];o.forEach(function(e){n.push(e.getID())}),t.publish("onObjectSelected",n);var i=[];o.forEach(function(e){var t={id:e.getID(),label:e.getLabel(),type:e.options.type,cadMaster:e.options.grid["ds6w:cadMaster"],kind:e.options.grid["ds6w:kind"],contentStructure:e.options.grid["ds6w:contentStructure"]};i.push(t)}),t.publish("selectedObjectsInContent",i)},n)};e.terminologyContent_Cont.getPADTreeDocument().getXSO().onChange(function(){n(20)})}})},onCustoViewChange:function(t){O.then(function(o){o.setContentViewPreference(t,!1).then(e._viewChanged.bind(e))})},onSaveAsTemplate:function(t){O.then(function(o){o.setContentViewPreference(t,!0).then(e._viewChanged.bind(e))})},onToggleView:function(){m.updateCommands()}}}}});return V}),define("DS/TerminologyEditor/service/TerminologyEditorWebService",["UWA/Core","DS/WAFData/WAFData","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/WidgetServices/WidgetServices","DS/TerminologyEditor/utils/TerminologySearch"],function(e,t,o,n,i){"use strict";var r={createCSRF:{url:"/resources/v1/application/CSRF",method:"GET"},fetch:{url:"/cvservlet/fetch/v2",method:"POST"},getContent:{url:"/resources/v1/TerminologyManagement/Terminologies/{pid}/getContent",method:"POST"},navigate:{url:"/cvservlet/navigate",method:"POST"},setSecurityCtx:{url:"/resources/pno/person/setsecuritycontext",method:"POST"},getPath:{url:"/resources/v1/TerminologyManagement/Terminologies/path",method:"POST"}};return{content:function(t){var o=this,i=t;n.get3DSpaceUrlAsync({onComplete:l=>{this.createCSRFTokens({onComplete:function(a){var s=JSON.parse(a).csrf.value,d=l+r.getContent.url.replace("{pid}",t.pid);return i.headers={Accept:"application/json","content-type":"application/json","Accept-Language":n.getLanguage(),SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL"),ENO_CSRF_TOKEN:s},i.payload={isRoot:!1,level:t.hasOwnProperty("level")?t.level:1,type:t.type,detailed:!0},i.data=e.Json.encode(i.payload),i.method=r.getContent.method,i.timeout=12e4,o._executeRequest(d,i,"content")},onFailure:function(e){console.error(e)}},l)}})},roots:function(t){var o=this,i=t;n.get3DSpaceUrlAsync({onComplete:t=>{this.createCSRFTokens({onComplete:function(l){var a=JSON.parse(l).csrf.value,s=t+r.getContent.url.replace("{pid}","Root");return i.headers={Accept:"application/json","content-type":"application/json","Accept-Language":n.getLanguage(),SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL"),ENO_CSRF_TOKEN:a},i.payload={isRoot:!0,level:1,detailed:!0},i.data=e.Json.encode(i.payload),i.method=r.getContent.method,i.timeout=12e4,o._executeRequest(s,i,"TerminologyEditor_getRoots")},onFailure:function(e){console.error(e)}},t)}})},createCSRFTokens:function(e,t){var o=e,n=t+r.createCSRF.url;o.method=r.createCSRF.method,this._executeRequest(n,o,"FolderActive-createCSRFToken")},allTerminologies:function(e){return e.start||(e.start=0),e.fetchAll=!0,e.noIcon=!0,this._performSearchQuery(e,"(type:Terminology)","allTerminologies")},_performSearchQuery:function(t,o){var r={};e.extend(r,t);var l=i.get3DSearchUrl()+"/search";r.payload=Object.assign({},i.getSearchInfo()),r.select_predicate&&(r.payload.select_predicate=r.select_predicate);var a=new Date,s=Math.random().toString(36).substring(2,11);r.payload.label=("TerminologyWidgetSearch_"+s+"_"+a.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-");var d=widget.lang?widget.lang:widget.getValue("lang");r.payload.locale=d,r.payload.query=o,r.payload.tenant=n.getTenantID(),r.payload.next_start=t.next_start,r.payload.start=t.start,t.noIcon&&(r.payload.select_file=void 0),r.payload.source=["3dspace"];var c="ctx::"+widget.getValue("xPref_CREDENTIAL");return c&&(r.payload.login={"3dspace":{SecurityContext:c}}),r.method="POST",r.headers={"content-type":"application/json"},r.withoutSC=!0,r.type="json",t.order_field&&(r.payload.order_field=t.order_field,r.payload.order_by=t.order_by),t.searchPageCount&&(r.payload.nresults=t.searchPageCount),!0===t.fetchAll&&(r.payload.nresults=1e3),r.filters&&(r.payload.refine=r.filters),r.data=e.Json.encode(r.payload),this._executeRequest(l,r,"searchInLibrary")},getTerminologyPathsforItem:function(t){var o={};e.extend(o,t),n.get3DSpaceUrlAsync({onComplete:i=>{var r=i+"/cvservlet/navigate",l=widget.lang?widget.lang:widget.getValue("lang");o.payload={},o.payload.locale=l,o.payload.order_by="asc",o.payload.order_field="ds6w:label",o.payload.tenant=n.getTenantID(),o.query={SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL"),tenant:n.getTenantID()},o.payload.input_physical_ids=t.id,o.payload.attributes=["ds6w:label","ds6w:type"],o.payload.version=3,o.payload.primitives=[{navigate_from_rel:{id:1,filter:{bo_type:["Terminology","Term"]}}}],o.payload.patterns={GET_PARENT:[{id:1,iter:-1}]},o.payload.patternFlags={GET_PARENT:{flags:["returnPaths"]}},o.payload.attributes=["ds6w:label","ds6w:type"],o.payload.source=["3dspace"];var a=new Date;return o.payload.label=("terminologyWidgetNavigate_"+a.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),o.timeout=12e4,o.payload.start=0,o.method="POST",o.headers={Accept:"application/json","content-type":"application/json","Accept-Language":l},o.type="json",o.data=e.Json.encode(o.payload),this._executeRequest(r,o,"getTerminologyPathsforItem")}})},_findTerminologiesInTerminology:function(t){var o={};e.extend(o,t);var r=i.get3DSearchUrl()+"/search",l=widget.lang?widget.lang:widget.getValue("lang");o.payload={},o.payload.locale=l,t.searchFTSquery&&(o.payload.query=t.searchFTSquery),t.rscIdToSearch&&(o.payload.query="physicalid:"+t.rscIdToSearch),o.payload.select_bo=["physicalid","ds6w:type","ds6w:globalType","ds6w:label"],"TerminologySection_AllTerminologies"===t.type?o.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_path_physicalid:t.pid,type_filter_rel:["Terminology","Sub Term"]}}}}:o.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_physicalid:t.pid,type_filter_rel:["Terminology","Sub Term"]}}}},o.payload.nresults=100,o.payload.source=["3dspace"];var a=new Date;return o.payload.label=("_findTerminologiesInTerminology"+a.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),o.timeout=12e4,o.method="POST",o.payload.tenant=n.getTenantID(),o.headers={Accept:"application/json","content-type":"application/json","Accept-Language":l,SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL")},o.type="json",o.data=e.Json.encode(o.payload),this._executeRequest(r,o,"_findTerminologiesInTerminology")},setPreferredSecurityContext:function(e,t){var o=null,i=new Promise((i,l)=>{o=n.get3DSpaceUrlAsync({onComplete:n=>{var a=t||{};"OnPremise"!==widget.getValue("x3dPlatformId")&&(n=n.replace("ifwe","space").replace("3DSpace","enovia"));var s=n+r.setSecurityCtx.url;a.query={SecurityContext:e},a.method=r.setSecurityCtx.method,a.withoutSC=!0,(o=this._executeQuery(s,a,"commands")).then(i).catch(l)}})});return i.cancel=(()=>{o&&o.cancel()}),i},terminologies:function(e){var t=e;n.get3DSpaceUrlAsync({onComplete:e=>{e=e+"/resources/v1/TerminologyManagement/Terminology/"+t.pid+"/terminologies",t.query={Level:t.level},t.method="GET",this._executeRequest(e,t,"terminologies")}})},terminologyTree:function(t){var o=this,i=t;n.get3DSpaceUrlAsync({onComplete:l=>{this.createCSRFTokens({onComplete:function(a){var s=JSON.parse(a).csrf.value,d=l,c=!!t.hasOwnProperty("indexMode")&&t.indexMode,u=t.isRoot?"Root":t.pid,g=t.hasOwnProperty("level")&&void 0!==t.level?t.level:1;return d+=r.getContent.url.replace("{pid}",u),i.payload={partialExpandList:t.partialExpandList,expandList:t.expandList,isRoot:t.isRoot,level:g,detailed:t.isRoot&&1===g,useIndex:c},c&&(i.refine=""),i.data=e.Json.encode(i.payload),i.method=r.getContent.method,i.headers={Accept:"application/json","content-type":"application/json","Accept-Language":n.getLanguage(),SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL"),ENO_CSRF_TOKEN:s},i.timeout=12e4,o._executeRequest(d,i,"terminologyTree")},onFailure:function(e){console.error(e)}},l)}})},copyterminology:function(t){var o=t;n.get3DSpaceUrlAsync({onComplete:n=>{n+="/resources/v1/TerminologyManagement/Terminologies/duplicateStructure",o.headers={"content-type":"application/json"},o.TargetPhysicalId&&o.PhysicalId&&(o.data={sourcePhysicalId:"",targetPhysicalId:o.TargetPhysicalId,physicalIds:o.PhysicalId},t.hasOwnProperty("withContent")&&(o.data.withContent=t.withContent),o.data=e.Json.encode(o.data)),o.method="POST",o.timeout=12e4,this._executeRequest(n,o,"copyTerminology")}})},getTerminologyProperties:function(e){var t=e;n.get3DSpaceUrlAsync({onComplete:e=>{e+="/resources/v1/TerminologyManagement/Terminologies/"+t.pid+"/properties",t.method="GET",this._executeRequest(e,t,"getTerminologyProperties")}})},getHeadersInformations:function(){n.get3DSpaceUrlAsync({onComplete:e=>{return{service:"3DSpace",serviceBaseUrl:e,tenant:n.getTenantID(),header:{SecurityContext:encodeURIComponent("ctx::"+widget.getValue("xPref_CREDENTIAL"))}}}})},setTerminologyProperties:function(t){var o=this,i=t;n.get3DSpaceUrlAsync({onComplete:r=>{this.createCSRFTokens({onComplete:function(l){var a=JSON.parse(l).csrf.value,s=r;return"Terminology"===t.type?s+="/resources/v1/modeler/dsbsd/dsbsd:BrowsingStructure/"+i.pid+"?$mask=dsbsd:BsdMask.Details":"Term"===t.type&&(s+="/resources/v1/modeler/dsbsd/dsbsd:BrowsingNode/"+i.pid+"?$mask=dsbsd:BsdMask.Details"),i.headers={Accept:"application/json","content-type":"application/json","Accept-Language":n.getLanguage(),SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL"),ENO_CSRF_TOKEN:a},i.method="PATCH",i.data=e.Json.encode(i.properties),o._executeRequest(s,i,"setTerminologyProperties")},onFailure:function(e){console.error(e)}},r)}})},getTerminologyPath:function(t){var o=t;n.get3DSpaceUrlAsync({onComplete:t=>{t+=r.getPath.url,o.headers={"content-type":"application/json"},o.pids&&(o.data={browsingNodesIds:function(t){return e.is(t,"array")?t.toString():t}(o.pids)},o.data=e.Json.encode(o.data)),o.method=r.getPath.method,o.timeout=12e4,this._executeRequest(t,o,"getTerminologyPath")}})},deleteTerminology:function(e){var t=this,o=e;n.get3DSpaceUrlAsync({onComplete:i=>{this.createCSRFTokens({onComplete:function(r){var l=JSON.parse(r).csrf.value,a=i;return"Terminology"===e.type?a+="/resources/v1/modeler/dsbsd/dsbsd:BrowsingStructure/"+e.pid:"Term"===e.type&&(a+="/resources/v1/modeler/dsbsd/dsbsd:BrowsingNode/"+e.pid),o.headers={Accept:"application/json","content-type":"application/json","Accept-Language":n.getLanguage(),SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL"),ENO_CSRF_TOKEN:l},o.method="DELETE",o.timeout=12e4,t._executeRequest(a,o,"deleteTerminology")},onFailure:function(e){console.error(e)}},i)}})},_executeQuery:function(e,t,o){var n=null,i=new Promise((i,r)=>{t.onTimeout=r,t.onFailure=r,t.onComplete=i,n=this._executeRequest(e,t,o)});return i.cancel=n?n.cancel:()=>{},i},_executeRequest:function(i,r,l){var a=Math.round(1e3*Math.random()).toString(),s=widget.id+"_"+widget.getTitle()+"_";window.top.performance.mark("terminologyRequest_begin"+a);var d={};e.extend(d,r),e.is(d.onTimeout,"function")||(d.onTimeout=function(){var e={type:"timeout",toString:function(){return o.msg_InfoAction_Timeout}};d.onFailure(e)},d.onComplete=function(e){window.top.performance.mark("terminologyRequest_end"+a);var t=window.top.performance.getEntriesByName("terminologyRequest_begin"+a);t&&1===t.length&&(window.top.performance.measure(s+"_Request"+l,"terminologyRequest_begin"+a,"terminologyRequest_end"+a),window.top.performance.clearMarks("terminologyRequest_end"+a),window.top.performance.clearMarks("terminologyRequest_begin"+a)),r.onComplete&&r.onComplete(e)});var c={Accept:"application/json","Accept-Language":widget.lang?widget.lang:widget.getValue("lang")};r.withoutSC||(c.SecurityContext=encodeURIComponent("ctx::"+widget.getValue("xPref_CREDENTIAL"))),r.headers?d.headers=e.extend(c,r.headers):d.headers=c,e.is(d.query)||(d.query={}),d.query.tenant||!0===r.withoutTenant||(d.query.tenant=n.getTenantID());var u=i;return 0!==Object.keys(d.query).length&&(u+=(i.indexOf("?")<0?"?":"&")+e.Utils.toQueryString(d.query)),t.authenticatedRequest(u,d)}}}),define("DS/TerminologyEditor/commands/ActionBar_ExpandNCmd",["UWA/Core","DS/ApplicationFrame/Command"],function(e,t){"use strict";return t.extend({labelTopBar:e.i18n("Expand N levels"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1}),require(["DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUtil/bsd_utils/BSDSelLevel","DS/TerminologyEditor/Terminology_CSO","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TerminologyEditor/utils/TerminologyEditorcontrol"],function(e,t,o,n,i){})},beginExecute:function(){},execute:function(){var e=require("DS/IPClassifyUtil/IPClassifyAlert"),t=require("DS/IPClassifyUtil/bsd_utils/BSDSelLevel"),o=require("DS/TerminologyEditor/Terminology_CSO"),n=require("i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor"),i=o.getCurrentTerminology();null===i?e.displayNotification({message:n.msg_warning_noselection,className:"warning"}):new t({events:{onApply:function(e){i.expand({expandLevel:parseInt(e),clearLast:!0,initialLevel:i.getNodeDepth()})}}})},endExecute:function(){}})}),define("DS/TerminologyEditor/utils/TerminologyLoaderGlobal",["UWA/Core","UWA/Class","DS/Controls/Loader","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor"],function(e,t,o,n){"use strict";function i(e){console.log("%c"+e,"color: orange")}return t.singleton({init:function(){this.container={global:null,contentView:null},this.loader={global:new o({height:35}),contentView:new o({height:35})},this.counter={global:0,contentView:0},this.displayedMessages={global:0,contentView:0}},setContainer:function(e,t){this.container.hasOwnProperty(e)?(this.container[e]=t,this.loader[e].inject(t)):i('The type of loader "'+e+'" is not defined.')},addComponentsToLoad:function(t,o){var r,l,a=e.clone(this.counter);if(this.loader.hasOwnProperty(t)){for(var s in o)this.displayedMessages.hasOwnProperty(s)&&this.removeComponentToLoad(t,s),r=s[0].toUpperCase()+s.substring(1)+"_Loading",l=void 0!==n[r]?n[r]:o[s],this.loader[t].on(l),this.displayedMessages[s]=l,this.counter[t]++,this.displayedMessages[t]++;a[t]>=0&&this._show(this.container[t])}else i('The type of loader "'+t+'" is not defined.')},removeComponentToLoad:function(e,t){this.loader.hasOwnProperty(e)?this.displayedMessages.hasOwnProperty(e)?(this.loader[e].off(this.displayedMessages[t]),delete this.displayedMessages[t],this.counter[e]--,this.displayedMessages[e]--,this.displayedMessages[e]=this.displayedMessages[e]>0?this.displayedMessages[e]:0,this.counter[t]--,this.counter[t]=this.counter[t]>0?this.counter[t]:0,this.counter[e]=this.counter[e]>0?this.counter[e]:0,0===this.counter[e]&&this._hide(this.container[e])):(console.log("loaderType :  "+this.counter[e]+"  key:  "+this.counter[t]),i('The "'+t+'" message is not displayed on the loader.')):i("The type of loader "+e+" is not defined.")},_show:function(e){e.style.display="flex"},_hide:function(e){e.style.display="none"}})}),define("DS/TerminologyEditor/utils/TerminologyEditorDataConversion",[],function(){"use strict";return{getObjectIdsFromSearchRes:function(e){var t=[];return e&&e.forEach(function(e){if(!e||!e.attributes||e.attributes.length<=0);else for(var o=0;o<e.attributes.length;++o)"physicalid"===e.attributes[o].name&&t.push(e.attributes[o].value)}),t},getParChildrenMapFromNavRes:function(e){var t={};return!e||!e.result||e.result.length<=0?t:(e.result.forEach(function(e){if(e&&e.input_object){var o=e.input_object.physicalid,n=o;e.outputs&&e.outputs.WORKSPACE&&e.outputs.WORKSPACE.length>0&&(n=e.outputs.WORKSPACE[0].physicalid),t[n]?t[n].push(o):t[n]=[o]}}),t)}}}),define("DS/TerminologyEditor/utils/TerminologyCommunication",["DS/PlatformAPI/PlatformAPI"],function(e){"use strict";return{publish:function(t,o,n){e.publish(t,o),!1!==n&&e.publish("webinwin:web:notification",JSON.stringify({event:t,content:o}))},subscribe:function(t,o,n){var i=window,r=function(){if(i===top||i.parent)return o.apply(this,arguments);throw new Error("widget has been destroyed")};e.subscribe(t,r),!1!==n&&e.subscribe("webinwin:win:notification",function(e){"string"==typeof e&&(e=JSON.parse(e)),e&&e.event===t&&r(e.content)})}}}),define("DS/TerminologyEditor/models/TerminologyInfo",["UWA/Controls/Abstract","UWA/Class/Options"],function(e,t){"use strict";return e.extend(t,{_id:null,_type:null,_label:null,init:function(e){this._parent(e),this._id=e.id,this._type=e.type,this._label=e.label},getID:function(){return this._id},getType:function(){return this._type},getLabel:function(){return this._label}})}),define("DS/TerminologyEditor/Terminology_Clipboard",["UWA/Core","UWA/Class"],function(e,t){"use strict";return t.singleton({name:"terminology_clipboard",_currentTerminology:null,_currentSelectedNodes:null,_Mode:null,_IsEmpty:!0,init:function(e){this._parent(e)},addInTerminologyClipboard:function(t,o,n){if(!e.is(o))throw new Error("No terminologyNode specified");if(!e.is(t))throw new Error("No selected nodes specified");n=n.toUpperCase(),this._Mode=n,this._IsEmpty=!1,this._currentTerminology=o,this._currentSelectedNodes=e.extend([],t)},IsEmpty:function(){return this._IsEmpty},getSelectedNodes:function(){return this._currentSelectedNodes},getMode:function(){return this._Mode}})}),define("DS/TerminologyEditor/service/TerminologyTypeService",["UWA/Controls/Abstract"],function(e){"use strict";return e.singleton({TYPE_BROWSING_STRUCTURE:"Browsing Structure",TYPE_TERMINOLOGY:"Terminology",TYPE_BROWSING_NODE:"Browsing Node",TYPE_TERM:"Term",TYPE_SECTION:"TerminologySection_AllTerminologies",init:function(){},isTerminology:function(e){return e===this.TYPE_BROWSING_STRUCTURE||e===this.TYPE_TERMINOLOGY},isTerm:function(e){return e===this.TYPE_BROWSING_NODE||e===this.TYPE_TERM},inFamilyTerminology:function(e){return this.isTerminology(e)||this.isTerm(e)},isSection:function(e){return e===this.TYPE_SECTION}})}),define("DS/TerminologyEditor/utils/ColorUtil",["UWA/Class"],function(e){"use strict";return e.singleton({colorMap:{},active:!1,setMapColor:function(e){this.colorMap=e},setActive:function(e){this.active=e},isActive:function(){return this.active},getCellKPIColor:function(e){var t=null;if(this.isActive()){var o=e.nodeModel.getID(),n=this.colorMap[o];t=n||"transparent"}return t}})}),define("DS/TerminologyEditor/views/ViewLoader",["UWA/Core","UWA/Class","UWA/Promise"],function(e,t,o){"use strict";var n={graphview:"graphview",datagridview:"datagridview"};Object.freeze(n);var i=["onDragOverGraph","onDropBlankGraph","onDragLeaveGraph"],r=["onDragEnterColumnHeader","onDragOverColumnHeader","onDragEndColumnHeader","onDragLeaveColumnHeader","onDropColumnHeader","onDragStartColumnHeader"];return t.extend({init:function(e){this.options=e},loadView:function(e,t){var o=this;this.options.component.options.views[e]?t():this.buildOptions(e).then(function(n){o.requireView(e,n,t)})},requireView:function(e,t,o){var i=this,r=this.options.amd[e],l=function(){i.postLoad(e),o&&o()};require([r],function(o){var r=i.options.component;r.options.views[e]=new o(t),e===n.datagridview?r.options.views[e].initialize().then(function(){l()}):l()})},postLoad:function(e){var t=this.options.component;switch(t.options.views[e].isActiveView=t.options.active_view===e,e){case n.graphview:var o=!1;t.options.views.graphview.isActiveView&&(o=!0,t.options.views.graphview.setModel(t.options.model)),t.setDnD_onGraph(),t.options.isReady.graphview=!0,o&&t.options.views.graphview.reframeAll();break;case n.datagridview:t.options.views.datagridview.isActiveView&&t.options.views.datagridview.setModel(t.options.model),t.options.isReady.datagridview=!0}t.options.model.applyActiveView(e)},buildOptions:function(e){switch(e){case n.graphview:return this._buildGraphViewOptions();case n.datagridview:return this._builddatagridViewOptions();default:throw new Error("Invalid View Trying to load")}},mapCallbacks:function(t,o){var n=o,i={};return t.forEach(function(t){e.is(n.options.views_cb[t],"function")?i[t]=n.options.views_cb[t]:e.is(n[t],"function")&&(i[t]=n[t].bind(n))}),i},_buildGraphViewOptions:function(){var t=this;return new o(function(o,n){var r=t.options.component,l={x3dAppId:t.options.x3dAppId,renderTo:t.options.renderTo,context:r};l.active_view=e.clone(r.options.active_view),l.isActiveView="graphview"===l.active_view;var a=t.mapCallbacks(i,r);l=e.extend(l,a,!0),e.is(r.getOnContextualEvent)&&(l.onContextualEvent=r.getOnContextualEvent()),o(l)})},_builddatagridViewOptions:function(){var t=this;return new o(function(o,n){var i=t.options.component,l={x3dAppId:t.options.x3dAppId,renderTo:t.options.renderTo,context:i};l.active_view=e.clone(i.options.active_view),l.isActiveView="datagridview"===l.active_view,l.view_customization=i.options.layout.view_customization,l.callbacks=t.mapCallbacks(r,i),i.options.additionalColumnsModules&&(l.additionalColumnsModules=i.options.additionalColumnsModules),o(l)})}})}),define("DS/TerminologyEditor/controllers/CommonMode",["UWA/Controls/Abstract"],function(e){"use strict";var t=[];return e.extend({init:function(e){this._parent(e),this._contentHandleRequest=null},cancelQuery:function(){this._contentHandleRequest&&this._contentHandleRequest.cancel(),this._contentHandleRequest=null},loadContents:function(){t.forEach(e=>{e.cancelQuery()}),t=[]},loadContent:function(){var e=this.loadContents.apply(this,arguments);return e&&e.finally(()=>{this._contentHandleRequest=null}),t.push(this),e},disable:function(){this.cancelQuery()}})}),define("DS/TerminologyEditor/models/xTermNodeModel",["UWA/Core","DS/TreeModel/TreeNodeModel","DS/WebappsUtils/WebappsUtils","DS/IPClassifyUtil/bsd_utils/BSDAttributeMgt"],function(e,t,o,n){"use strict";function i(e){e._getFilterInfo||(e._getFilterInfo=l.prototype._getFilterInfo.bind(e),e._getChildrenFilterInfo=l.prototype._getChildrenFilterInfo.bind(e),e._removeChildrenFilterInfo=l.prototype._removeChildrenFilterInfo.bind(e),e.filterInChild=l.prototype.filterInChild.bind(e),e.filterOutChild=l.prototype.filterOutChild.bind(e))}var r={label:"",icons:[],grid:{},padgrid:{},resourceid:"",type:"",plmType:"",relationid:"",relationtype:"",relationOrder:-1,did:"",relcount:null,isPADHidden:!1,padstate:"collapsed",children:[],thumbnail:null,useAsyncPreExpand:!0,emptyStatusbarVisibleFlag:!0,contextualMenu:[{type:"SeparatorItem"}]};function l(n){this.options=e.clone(r),this.options.grid.bi_color="rgba(0, 0, 0, 0)",n&&n.grid&&(this.options.subLabel=n.grid["ds6w:responsible"],this.options.description=n.grid["ds6w:identifier"],this.options.thumbnail=n.thumbnail?n.thumbnail:o.getWebappsAssetUrl("PADUtils","icons/32/I_DefaultThumbnail.png")),n&&e.is(n.relcount)&&0===n.relcount&&(n.children=null),this.options=e.extend(this.options,n),t.call(this,this.options)}l.prototype=Object.create(t.prototype);var a={getType:function(){return this.plmType},getOccurencePath:function(t){if(e.is(t,"function")&&t(this),!this.isRoot()&&this.getParent()){var o=this.getParent().getOccurencePath(t);return o.push(this.options.relationid),o.push(this.options.resourceid),o}return[this.options.resourceid]},getOccurencePathWithType:function(){if(!this.isRoot()&&this.getParent()){var e=this.getParent().getOccurencePathWithType();return e.push({resourceid:this.options.relationid,type:this.options.relationtype}),e.push({resourceid:this.options.resourceid,type:this.options.type}),e}return[{resourceid:this.options.resourceid,type:this.options.type}]},getNodeByPath:function(e,t,o,n){if(("number"!=typeof t||t<0)&&(t=0),("number"!=typeof o||o<0||o>=e.length)&&(o=e.length-1),this.options.resourceid instanceof Array&&this.options.resourceid.indexOf(e[t])>=0||this.options.resourceid===e[t]){if(t!==o&&(this.isExpanded()||this.childComputed||void 0!==n&&!1!==n)){var i=e[t+1],r=this.getChildren();if(r&&0!==r.length){for(var l=null,a=0;a<r.length&&null===l;a++){var s=r[a];i===s.options.relationid&&(l=s)}return null===l?this:l.getNodeByPath(e,t+2,o,n)}return this}return this}},getID:function(){return this.options.resourceid},getRelationID:function(){return!0===this.isRelationsObjectNode?null:this.options.relationid},getNodesById:function(e){var t={listOfFoundNodes:[]};return this._getNodesById(e,t),t.listOfFoundNodes},_removeFilterInfo:function(){delete this.options._filterInfo},_removeChildrenFilterInfo:function(){delete this.options._childrenFilterInfo},_getFilterInfo:function(e){return!this.options._filterInfo&&Boolean(e)&&(this.options._filterInfo={}),this.options._filterInfo},_getChildrenFilterInfo:function(e){return!this.options._childrenFilterInfo&&Boolean(e)&&(this.options._childrenFilterInfo={}),this.options._childrenFilterInfo},filterOut:function(){var e=this.isRoot()?this.getTreeDocument():this.getParent();null!==e&&(i(e),e.filterOutChild(this))},filterIn:function(e){var t=this._getFilterInfo();if(t&&t.parentBeforeFiltering){var o=t.parentBeforeFiltering;i(o),o.filterInChild(this)}if(Boolean(e)){var n,r=this._getChildrenFilterInfo();(n=r&&r.childrenBeforeFiltering?r.childrenBeforeFiltering:this.getChildren())&&n.forEach(function(t){t.filterIn(e)})}},filterOutChild:function(t){var o=this.getChildren();if(o.indexOf(t)<0)throw new Error("Not a child");var n=this._getChildrenFilterInfo(!0);if(!n.childrenBeforeFiltering){n.childrenBeforeFiltering=o&&o.length>0?o.slice(0):[];e.is(this._expandState)&&(n.expandStateBeforeFiltering={noExpandState:"noChildren",expandingState:"expanding",partiallyExpandedState:"partiallyExpanded",collapseState:"expanded",expandState:"collapsed"}[this._expandState])}t._getFilterInfo(!0).parentBeforeFiltering=this,e.is(this.removeChild,"function")?this.removeChild(t):this.removeRoot(t,!0,!0),e.is(this.setState,"function")&&this.setState({state:n.expandStateBeforeFiltering}),n.filteredOutChildren||(n.filteredOutChildren=[]),n.filteredOutChildren.push(t)},filterInChild:function(t){var o=this._getChildrenFilterInfo();if(o){var n=o.childrenBeforeFiltering;if(n){var i=n.indexOf(t);if(i>=0){var r=t._getFilterInfo();if(r&&r.parentBeforeFiltering===this){var l,a=this.getChildren();if(a)for(var s=0;s<a.length;s++){var d=a[s];if(n.indexOf(d)>i){l=d;break}}delete r.parentBeforeFiltering,this.insertBefore(t,l),e.is(this.setState,"function")&&this.setState({state:o.expandStateBeforeFiltering}),t._removeFilterInfo();var c=o.filteredOutChildren.indexOf(t);o.filteredOutChildren.splice(c,1),0===o.filteredOutChildren.length&&this._removeChildrenFilterInfo()}}}}},_getNodesById:function(e,t){var o=!1;if(this.getID()===e)t.listOfFoundNodes.push(this),o=!0;else{var n=this.getChildren();if(n)for(var i=0;i<n.length;i++)o=n[i]._getNodesById(e,t)||o}return o},updateAttributes:function(t,o){if(!e.is(t,"array")||!e.is(o,"array"))throw new Error("Invalid argument(s)");var i=o,r=o.tree?o.tree:n.getTreeColumn(),l={};t.forEach(function(t){e.is(t.value)&&e.is(t.value.replace,"function")&&(t.value=t.value.replace(/\\n/g," ")),"ds6w:type"===t.name&&(l.type=t.value,this.plmType=t.value),t.name===r?l.label=t.value:"type_icon_url"===t.name?(l.icons=[],l.icons.push(t.value)):"preview_url"===t.name||"thumbnail_2d"===t.name?(l.thumbnail=t.value,l.grid=l.grid?l.grid:{},l.grid.thumbnail="url("+t.value+")"):-1!==i.indexOf(t.name)&&(l.grid||(l.grid={}),l.grid[t.name]=t.value)}),this.updateOptions(l)},isDescendantOf:function(e){var t;if(t=e instanceof l?e.getID():e,this.getID()===t)return!0;if(!this.isRoot()){var o=this.getParent();if(o)return o.isDescendantOf(t)}return!1},getDepth:function(){for(var e=this,t=0;!e.isRoot();)e=e.getParent(),t++;return t},getLeaves:function(){var e=[];return this.processDescendants({processNode:function(){!1===this.hasChildren()&&e.push(this)}}),e},getAttribute:function(e){var t;return this.options.grid[e]&&(t=this.options.grid[e]),t},updateOptions:function(e){e.grid&&(this.options.thumbnail||e.thumbnail||(e.thumbnail=o.getWebappsAssetUrl("PADUtils","icons/32/I_DefaultThumbnail.png")),e.subLabel=e.grid["ds6w:responsible"]?e.grid["ds6w:responsible"]:this.options.grid&&this.options.grid["ds6w:responsible"]?this.options.grid["ds6w:responsible"]:"",e.description=e.grid["ds6w:identifier"]?e.grid["ds6w:identifier"]:this.options.grid&&this.options.grid["ds6w:identifier"]?this.options.grid["ds6w:identifier"]:""),t.prototype.updateOptions.call(this,e)}};for(var s in a)l.prototype[s]=a[s];return l}),define("DS/TerminologyEditor/utils/TerminologyEditorManageSecurityContextCustomization",["UWA/Core","UWA/Class","DS/Logger/Logger"],function(e,t,o){"use strict";var n=o.getLogger("DS/TerminologyEditor/utils/TerminologyEditorManageSecurityContextCustomization");return t.singleton({name:"TerminologyEditorManageSecurityContextCustomization",init:function(e){this._parent(e),this._isSecurityContextComputedByOpening=" "},adaptSecurityContextToCurrentTerminology:function(e){if(e&&this._isSecurityContextComputedByOpening){var t=[],o=widget.getPreference("xPref_CREDENTIAL");if(o){var i=o.options;Array.isArray(i)?i.forEach(function(e){e.value&&t.push(e.value)}):n.warn("The widget has no options for xPref_CREDENTIAL preference")}else n.warn("The widget has no xPref_CREDENTIAL preference");t.length>0&&console.log("tests removing T.E.Openness"),n.warn('SecurityContext "undefined" returned by TerminologyEditorOpenness is not valid')}}})}),define("DS/TerminologyEditor/views/TerminologyWebInWinTaggerProxy",["DS/SNResultUX/webinwin/WebInWinTaggerProxy","UWA/Core","DS/CoreEvents/ModelEvents"],function(e,t,o){"use strict";return e.extend(o,{init:function(e){e.proxyId=e.widgetId+"LibraryEditor_WebInWin",this._parent.call(this,e)},_dispatchEvent:function(e){if(!t.is(e,"object")||!t.is(e.notif_name)||void 0===e.notif_parameters)throw console.log("E_INVALIDARG, expect to have parameters.notif_name arg & parameters.notif_parameters in _dispathTowin !!!"),new Error("No parameters.notif_name arg & parameters.notif_parameters given to _dispathTowin method !");console.log("ResultWebInWin._dispathTowin for "+e.notif_name);var o=t.is(e.notif_parameters,"string")?e.notif_parameters:JSON.stringify(e.notif_parameters);"undefined"!=typeof dscef&&dscef.sendString(e.notif_name+"="+o)}})}),define("DS/TerminologyEditor/utils/TerminologyEditorcontrol",["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/bsd_utils/BSDSettingsMgt","UWA/Controls/Abstract","DS/IPClassifyUXUtil/PlatformCredSelector","DS/TerminologyEditor/utils/TerminologyLoaderGlobal"],function(e,t,o,n,i,r){"use strict";return n.singleton({_Content:null,_TreeCont:null,_IdCardCont:null,_isDebugMode:!1,_treeFilter:null,_actionBar:null,_findInCtx:null,_onWidgetRefresh:null,init:function(){this.checkRolesAvailability()},getContent:function(){return this._Content},getTreeCont:function(){return this._TreeCont},getIdCardCont:function(){return this._IdCardCont},getTrashCont:function(){return this._TrashCont},getTreeFilter:function(){return this._treeFilter},getActionBar:function(){return this._actionBar},getFindInCtx:function(){return this._findInCtx},getWidgetRefresh:function(){return this._onWidgetRefresh},setContent:function(e){this._Content=e},setTreeCont:function(e){this._TreeCont=e},setIdCardCont:function(e){this._IdCardCont=e},setTrashCont:function(e){this._TrashCont=e},setTreeFilter:function(e){this._treeFilter=e},setActionBar:function(e){this._actionBar=e},setFindInCtx:function(e){this._findInCtx=e},setWidgetRefresh:function(e){this._onWidgetRefresh=e},isDebugMode:function(){return this._isDebugMode},setDebugMode:function(e){this._isDebugMode=e},isCustomizedEnv:function(){return void 0===this._isCustomizedEnv&&(this._isCustomizedEnv=!1),this._isCustomizedEnv},checkRolesAvailability:function(t){var o=this;void 0===o._isPAUroleAvailable||void 0===o._isPARroleAvailable||void 0===o._isCSVroleAvailable?e.getGrantedRoles(function(e){o._isPAUroleAvailable=!1,o._isPARroleAvailable=!1,o._isCSVroleAvailable=!1;for(var n=0;n<e.length;n++){var i=e[n]?e[n].id:"";"CSV"===i?o._isCSVroleAvailable=!0:"PAU"===i||"CDR"===i||"EXL"===i||"InternalDS"===i?(o._isPAUroleAvailable=!0,o._isCSVroleAvailable=!0):"PAR"===i&&(o._isPARroleAvailable=!0,o._isCSVroleAvailable=!0)}t&&t(o._isPAUroleAvailable,o._isPARroleAvailable,o._isCSVroleAvailable)}):t&&t(o._isPAUroleAvailable,o._isPARroleAvailable,o._isCSVroleAvailable)},checkSecurityCTXandTenantInitialization:function(e,n){var r=this;require(["DS/IPClassifyUXUtil/CredentialsView"],function(l){if("function"==typeof e){var a=function(){r._isSecurityCTXInitialized&&(!0===n||r._isTenantInitialized)&&e.call()};if(void 0===r._isSecurityCTXInitialized){var s=l.getCredential();r._isSecurityCTXInitialized=!!s||void 0,r._isSecurityCTXInitialized||o.addEventOnce("onPad_security_ctx",function(e){r._isSecurityCTXInitialized=null!=e,a()})}if(!0!==n&&void 0===r._isTenantInitialized){var d=t.getTenantID();d||(d="OnPremise",t.setTenantID("OnPremise"));let e=!1;if(e="OnPremise"!==d&&e){r.onTenantSecurityCTXPopup();let t={};t.onRefresh=r.getWidgetRefresh(),i.render(e,t)}r._isTenantInitialized=void 0!==d,r._isTenantInitialized||widget.addEventOnce("onTenantChange",function(e){r._isTenantInitialized=!!e||void 0,a()})}a()}})},onTenantSecurityCTXPopup:function(){r.removeComponentToLoad("global","widget")},getPlaceholder:function(){return new Promise(function(e){require(["DS/TerminologyEditor/views/TerminologyPlaceHolder"],function(t){e(new t)})})},getMapforPreferenceRefresh:function(){return new Map([["activateBIFilter",1],["useIndexAcceleration",1],["activateTXO",1],["activateDGV",1]])}})}),define("DS/TerminologyEditor/utils/TerminologyEditorEvents",["UWA/Core","UWA/Class","DS/IPClassifyUtil/IPClassifyModelEvents","DS/TerminologyEditor/utils/TerminologyCommunication","DS/TerminologyEditor/service/TerminologyTypeService"],function(e,t,o,n,i){"use strict";return t.singleton({EVT_CURRENT_BROWSINGITEM_CHANGE:"/BSD/CURRENTFOLDER_CHANGE",EVT_NODEMODEL_MODIFY:"/BSD/NODEMODEL_MODIFY",EVT_TREEFILTER_CHANGE:"/BSD/EVT_TREEFILTER_CHANGE",EVT_TAGGER_STATUS_CHANGE:"/BSD/EVT_TAGGER_STATUS_CHANGE",EVT_CURRENT_BROWSINGITEM_COLUMN_CHANGE:"/LIBRARY_EDITOR/CURRENT_LIBRARY_COLUMN_CHANGE",EVT_BSD_READY:"onTerminologyEditorReady",_modelEvents:null,init:function(e){this._parent(e),this._modelEvents=o.getModelEvents()},createTerminologyForPublication:function(e,t){var o=e,n={From:"TerminologyEditor",TerminologyID:null,TerminologyLabel:null,TerminologyType:null,IsInDeletedItems:!1,Timestamp:Date.now()};return o&&(i.inFamilyTerminology(o.plmType)||t)&&(n.TerminologyID=o.getID(),n.TerminologyLabel=o.getLabel(),n.TerminologyType=o.getType()),n},notifyTerminologyRename:function(t){if(!e.is(t,"array"))throw new Error("input parameter should be array");var o=this;t.forEach(function(e){var t=o.createTerminologyForPublication(e);n.publish("TerminologyEditor.TerminologyUpdated",JSON.stringify(t),!0),o._modelEvents.publish({event:o.EVT_NODEMODEL_MODIFY,context:e,data:e})})},notifyTerminologyLoadingEnd:function(t){if(!e.is(t))throw new Error("input parameter should be a TreeNodeModel");this._modelEvents.publish({event:this.EVT_FOLDER_LOADINGEND,context:t,data:t})},onTerminologyLoadingEnd:function(t){if(!e.is(t,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:this.EVT_FOLDER_LOADINGEND},t)},onTerminologyRename:function(t){if(!e.is(t,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:this.EVT_NODEMODEL_MODIFY},t)},notifyCurrentTerminologyChange:function(t){if(!e.is(t,"object"))throw new Error("input parameter should be object");if(!t.currentNode)throw new Error("input object should have currentNode");this._modelEvents.publish({event:this.EVT_CURRENT_BROWSINGITEM_CHANGE,context:t.currentNode,data:t})},onCurrentTerminologyChange:function(t){if(!e.is(t,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:this.EVT_CURRENT_BROWSINGITEM_CHANGE},t)},notifyCurrentTerminologyColumnChange:function(){this._modelEvents.publish({event:this.EVT_CURRENT_BROWSINGITEM_COLUMN_CHANGE})},onCurrentTerminologyColumnChange:function(t){if(!e.is(t,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:this.EVT_CURRENT_BROWSINGITEM_COLUMN_CHANGE},t)},notifyTerminologyEditorReady:function(){this._modelEvents.publish({event:this.EVT_BSD_READY})},onTerminologyEditorReadyforWenInWin:function(t){if(!e.is(t,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:this.EVT_BSD_READY},t)},notifyTreeFilterChange:function(e){this._modelEvents.publish({event:this.EVT_TREEFILTER_CHANGE,data:e})},onTreeFilterChange:function(t){if(!e.is(t,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:this.EVT_TREEFILTER_CHANGE},t)},notifyTaggerStatusChange:function(){this._modelEvents.publish({event:this.EVT_TAGGER_STATUS_CHANGE})},onTaggerStatusChange:function(t){if(!e.is(t,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:this.EVT_TAGGER_STATUS_CHANGE},t)},subscribeEvents:function(){var e=this;return this._modelEvents.subscribe({event:"welcome-panel-collapse"},function(){e._modelEvents.publish({event:"triptych-hide-panel",data:"left"})}),this._modelEvents.subscribe({event:"welcome-panel-expand"},function(){e._modelEvents.publish({event:"triptych-show-panel",data:"left"})}),this._modelEvents.subscribe({event:"information-panel-close"},function(){e._modelEvents.publish({event:"triptych-hide-panel",data:"right"})}),this._modelEvents.subscribe({event:"information-panel-open"},function(){e._modelEvents.publish({event:"triptych-show-panel",data:"right"})}),this._modelEvents},subEvent:function(t,o){if(!e.is(o,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:t},o)},leftPanelOpen:function(e){this.subEvent("triptych-show-panel",e)},leftPanelClose:function(e){this.subEvent("triptych-hide-panel",e)},rightPanelOpen:function(e){this.subEvent("triptych-show-panel",e)},rightPanelClose:function(e){this.subEvent("triptych-hide-panel",e)},unsubscribeAll:function(){this._modelEvents.unsubscribeAll()}})}),define("DS/TerminologyEditor/Terminology_CSO",["UWA/Core","DS/Selection/XSO","DS/Logger/Logger","DS/TerminologyEditor/service/TerminologyTypeService","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/TerminologyEditor/utils/TerminologyEditorEvents","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/utils/TerminologyEditorManageSecurityContextCustomization"],function(e,t,o,n,i,r,l,a){"use strict";var s=function(e){var t="";if(e){var o=e.plmType;t="Term"===o?"Term":"Terminology"===o?"Terminology":o}return t},d=t.singleton({name:"terminology_cso",_logger:null,_currentTerminology:null,init:function(t){var n={areEquals:function(e,t){return e===t}};e.extend(n,t),this._parent(n),this._logger=o.getLogger(d);var i=this;this.onPostAdd(function(t){var o="CONTENT";e.is(t,"array")&&(t=t[0]),t&&e.is(t.getID,"function")&&t.getID()===i.getCurrentTerminologyID()&&(o="TREE"),e.is(t)&&i._modelEvents.publish({event:"FOLDER_CSO/SELECT",data:{context:o,selectedNode:t}})}),r.onTerminologyRename(function(e){if(i._currentTerminologyPath){var t=e.getID(),o=e.getLabel(),n=i.getCurrentTerminologyID();i._currentTerminologyPath.forEach(function(e){e.id===t&&(e.label=o)}),t===n&&l.getIdCardCont().setCurrentLocation()}})},addInTerminologyCSO:function(t,o){if(!e.is(t))throw new Error("No terminologyNode specified");if(!e.is(o))throw new Error("No context specified");if("TREE"===(o=o.toUpperCase())){var d=this;this.empty(!1);var c=this._currentTerminology;this._currentTerminology=t;var u=function(e,t){n.inFamilyTerminology(t.plmType)&&t.id&&l.isCustomizedEnv()&&a.adaptSecurityContextToCurrentTerminology(t.id),r.notifyCurrentTerminologyChange({previousNode:e,currentNode:t}),d.add(t)};this._currentTerminologyPath=[{id:t.id,type:s(t),label:t.getLabel(),mxid:t.options.mxid}];var g=!1;if(n.inFamilyTerminology(t.plmType)){if(t.isVisible&&t.isVisible()&&t.getPath){var m=t.getPath();if(Array.isArray(m)&&m.length>=2&&m[0]&&"TerminologySection_AllTerminologies"===m[0].plmType){this._currentTerminologyPath=[];for(var p=1;p<m.length;p++){var f=m[p];this._currentTerminologyPath.push({id:f.id,type:s(f),label:f.getLabel(),mxid:f.options.mxid})}g=!0}}}else g=!0;g?u(c,t):i.getTerminologyPath({pids:[t.id],onComplete:function(e){var o=(e=JSON.parse(e))[t.id],n=o?o.length:0;!o&&e.error&&(d._logger.warn("Unable to retrieve TerminologyPath using WebService"),u(c,d._currentTerminology)),n>=1&&o[n-1]?d._currentTerminology&&o[n-1].id===d._currentTerminology.id?(d._currentTerminologyPath=[],o.forEach(function(e){d._currentTerminologyPath.push({id:e.id,type:e.type,label:e.label,mxid:e.mxid})}),u(c,d._currentTerminology)):d._logger.log("TerminologyPath returned by WebService do not corresponds to the current Terminology"):d._logger.warn("Empty TerminologyPath returned by WebService")},onFailure:function(e){d._logger.warn("Unable to retrieve TerminologyPath using WebService"+e),u(c,d._currentTerminology)}})}else{this.empty(!1);var h=null;0===(h="array"===e.typeOf(t)?t:[t]).length?this.add(this._currentTerminology):this.add(h)}},getCurrentTerminology:function(){return this._currentTerminology},updateLabelCurrentTerminologyPath:function(){if(this._currentTerminologyPath){var e=this._currentTerminologyPath.length,t=this._currentTerminology.getLabel();this._currentTerminologyPath[e-1].label!==t&&(this._currentTerminologyPath[e-1].label=t)}},getCurrentTerminologyID:function(){var e=null;return this._currentTerminology&&this._currentTerminology.getID&&(e=this._currentTerminology.getID()),e},getCurrentTerminologyPath:function(){var e=[];return this._currentTerminologyPath&&this._currentTerminologyPath.forEach(function(t){e.push({id:t.id,type:t.type,label:t.label,mxid:t.mxid})}),e},getSelectedNodes:function(){var e=[];return this.get()&&this.get().forEach(function(t){e.push(t)}),e},getCurrentSelection:function(){var e=l.getContent().getSelectedNodes(),t=d.getCurrentTerminology();return e=null!==e&&e.length>0?e:t?[t]:[]},getSelectedNodesID:function(){var e=[];return this.get()&&this.get().forEach(function(t){e.push(t.getID())}),e},onTerminologySelected:function(e){return this._modelEvents.subscribe({event:"FOLDER_CSO/SELECT"},e)}});return d}),define("DS/TerminologyEditor/commands/ActionBar_NewBrowsingStructureCmd",["UWA/Core","DS/IPClassifyUtil/IPClassifyAlert","DS/ENONewWidget/command/NewContentCommandBase","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/IPClassifyUtil/IPClassifyModelEvents","DS/TerminologyEditor/utils/TerminologyLoaderGlobal"],function(e,t,o,n,i,r,l,a,s){"use strict";return o.extend({_newType:"Terminology",_commandName:"NewBrowsingStructure",init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0})},getType:function(){return this._newType},getCreationDialogParameters:function(){let o=l.getHeadersInformations();var s=i.getContent().getSelectedNodes(),d=r.getCurrentTerminology();s=s.length>0?s:[d];var c={type:this._newType,notification:!0,events:{onSuccess:function(o){a.getModelEvents().publish({event:"switch_to_author"}),t.displayNotification({message:n.msg_success_createBS,className:"success"}),e.is(i.getTreeCont())&&e.is(i.getContent())&&(i.getTreeCont().updateTreeWithNewTerminology(s[0]),o=e.is(o,"string")?JSON.parse(o):o,i.getContent().loadContentAndSelect(d,o.result[0].identifier))},onFailure:function(e){console.log(e)},onCancel:function(e){console.log(e)}},silentMode:!1,viewType:"listView",labelTopBar:n.commands.newBrowsingStructure,commandName:this._commandName,options:{},context:o};this.launchCreateNew(c)},execute:function(){var e=this;this.showModalLoader(),require(["DS/ENONewWidget/ENONew/Events"],function(t){t.addEvent("onCreationDialogAction",function(t){t&&"ready"===t.action&&e.hideModalLoader()})});let t=this.getCreationDialogParameters();this.launchCreateNew(t)},hideModalLoader:function(){s.removeComponentToLoad("global","new")},showModalLoader:function(){s.addComponentsToLoad("global",{new:""})}})}),define("DS/TerminologyEditor/commands/ActionBar_NewBrowsingNodeCmd",["UWA/Core","DS/IPClassifyUtil/IPClassifyAlert","DS/ENONewWidget/command/NewContentCommandBase","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TerminologyEditor/service/TerminologyTypeService","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/IPClassifyUtil/IPClassifyModelEvents","DS/TerminologyEditor/utils/TerminologyLoaderGlobal"],function(e,t,o,n,i,r,l,a,s,d){"use strict";return o.extend({_newType:"Term",_commandName:"NewBrowsingNode",init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0})},getType:function(){return this._newType},getCreationDialogParameters:function(){let o=a.getHeadersInformations();var d=r.getContent().getSelectedNodes(),c="",u=l.getCurrentTerminology();if(1!==(d=d.length>0?d:[u]).length)throw new Error(n.msg_error_invalidselection);var g=d[0];(i.isTerminology(g.getType())||i.isTerm(g.getType()))&&(c=g.getID());var m={type:this._newType,notification:!0,events:{onSuccess:function(o){s.getModelEvents().publish({event:"switch_to_author"}),t.displayNotification({message:n.msg_success_createBN,className:"success"}),e.is(r.getTreeCont())&&e.is(r.getContent())&&(r.getTreeCont().updateTreeWithNewTerminology(d[0]),o=e.is(o,"string")?JSON.parse(o):o,r.getContent().loadContentAndSelect(u,o.result[0].identifier))},onFailure:function(e){console.log(e)},onCancel:function(e){console.log(e)}},silentMode:!1,viewType:"listView",labelTopBar:n.commands.newBrowsingNode,commandName:this._commandName,options:{parentPIDs:[c]},context:o};this.launchCreateNew(m)},execute:function(){var e=this;this.showModalLoader(),require(["DS/ENONewWidget/ENONew/Events"],function(t){t.addEvent("onCreationDialogAction",function(t){t&&"ready"===t.action&&e.hideModalLoader()})});let t=this.getCreationDialogParameters();this.launchCreateNew(t)},hideModalLoader:function(){d.removeComponentToLoad("global","new")},showModalLoader:function(){d.addComponentsToLoad("global",{new:""})}})}),define("DS/TerminologyEditor/utils/TerminologySearch",["UWA/Core","UWA/Class","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/IPClassifyUtil/IPClassifyModelEvents","DS/WidgetServices/WidgetServices","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor"],function(e,t,o,n,i,r){"use strict";var l={tree:"ds6w:label"};return t.singleton({init:function(t){this._parent(t),this._currentSearch=null,this._searchInfo=null,this._indexInfo=null,this._lListener=[],this._lListenerResult=[],this._refine=null,this._originTerminology=null,this._previousViewCommand=null,this._3DSearchUrl=null,this._defaultPredicates=["ds6w:label","physicalid","mxid","ds6w:type","ds6w:identifier","ds6w:classification","icon_2ddefaultthb.subtype","relcount","taxonomies","ds6w:kind","ds6w:cadMaster"],this._attrPredicateMap=new Map,this._predAttrMapDefault=[["ds6w:label",null],["physicalid",null],["mxid",null],["ds6w:type",null],["ds6w:identifier",null],["ds6w:classification",null],["icon_2ddefaultthb.subtype",null],["relcount",null],["taxonomies",null]],this._predAttrMap=new Map(this._predAttrMapDefault);this._searchInfo={with_indexing_date:!0,select_predicate:e.clone(this._defaultPredicates),select_file:["icon","thumbnail_2d"],order_field:"ds6w:modified",order_by:"desc",nresults:25},this.get3DSearchUrl(),this._facets=null,this._refine=null},setNumberResults:function(e){this._searchInfo.nresults=e},getNumberResults:function(){return this._searchInfo.nresults},setPreviousView:function(e){this._previousViewCommand=e},getPreviousView:function(){return this._previousViewCommand},get3DSearchUrl:function(){if(this._3DSearchUrl&&this._3DSearchUrl.length>0)return this._3DSearchUrl;var e=this;i.get3DSearchUrlAsync({onComplete:function(t){if(""!==t)return"OnPremise"!==widget.getValue("x3dPlatformId")&&(t=t.replace("ifwe","fedsearch").replace("3DSearch","federated")),e._3DSearchUrl=t,e._3DSearchUrl}})},setPredicates:function(e){var t=this;t._attrPredicateMap.clear(),this._predAttrMap=new Map(this._predAttrMapDefault),Array.isArray(e)&&e.forEach(function(e){var o=e.ds6w;o||(o=e.dataIndex);var n=null;if(e.attrDBName)for(var i in n=e.attrDBName)t._attrPredicateMap.set(n[i],o);t._predAttrMap.set(o,n)}),this._searchInfo.select_predicate=Array.from(t._predAttrMap.keys())},addPredicates:function(e){var t=this;Array.isArray(e)&&e.forEach(function(e){var o=null;if(e.attrDBName)for(var n in o=e.attrDBName)t._attrPredicateMap.set(o[n],e.dataIndex);t._predAttrMap.set(e.dataIndex,o)}),this._searchInfo.select_predicate=Array.from(t._predAttrMap.keys())},removePredicates:function(e){for(var t=0;t<e.length;++t)if(this._predAttrMap.delete(e[t].dataIndex),e[t].attrDBName){var o=e[t].attrDBName;for(var n in o)this._attrPredicateMap.delete(o[n])}this._searchInfo.select_predicate=Array.from(this._predAttrMap.keys())},getIndexPredicates:function(){return Array.from(this._searchInfo.select_predicate)},getAttrPredicateMap:function(){return this._attrPredicateMap},onSearchChange:function(e){"function"==typeof e&&this._lListener.push(e)},onSearchResult:function(e){"function"==typeof e&&this._lListenerResult.push(e)},_notifyChange:function(){},changeSortField:function(e,t){var o=this._getDS6WFromColumnIndex(e),n=this._getColumnPredicate(o);if(!n||!n.startsWith("ds6w"))return{message:r.get("msg_info_SortNonAvailable"),className:"primary"};this._searchInfo.order_field!==n&&(this._searchInfo.order_field=n,this.setInfoIndex(null,!1)),t&&this._notifyChange()},changeOrderSort:function(e,t){e.length>0&&this._searchInfo.order_by!==e&&(this._searchInfo.order_by=e,this.setInfoIndex(null,!1)),t&&this._notifyChange()},columnIsAvailable:function(e){return!(null===this._getColumnPredicate(e))},_getColumnPredicate:function(e){var t=this._getDS6WFromColumnIndex(e),o=this.getSearchInfo().select_predicate.indexOf(t)>=0?t:null;return o=!o&&this.getSearchInfo().select_predicate.indexOf(t)>=0?t.toLowerCase():o},_getDS6WFromColumnIndex:function(e){var t=l[e];return t||(t=e),t},getSearchInfo:function(){return this._searchInfo},setInfoIndex:function(e,t){var o=this;if(this._indexInfo=e,!1!==t){if(this._lListenerResult.forEach(function(t){t.call(o,e)}),e){var i=require("DS/TerminologyEditor/Terminology_CSO").getCurrentTerminology().getLabel();e.objectName=i;var r=this.getDateLastIndexation();e.lastIndexation=r}n.getModelEvents().publish({event:"searchUpdated",data:e})}},resetInfoIndex:function(){this._indexInfo=null},getOrderFieldForTree:function(){var e=this.getOrderField();for(var t in l)l[t]===e&&(e=t);return e},getOrderField:function(){return this.getSearchInfo()?this.getSearchInfo().order_field:null},getOrderBy:function(){return this.getSearchInfo()?this.getSearchInfo().order_by:null},getInfoIndex:function(){return this._indexInfo},getNumberLastResult:function(){return this._indexInfo?this._indexInfo.nresults:0},getNumberHits:function(){return this._indexInfo?this._indexInfo.nhits:0},getDateLastIndexation:function(){var e=null,t=this.getInfoIndex();if(t&&t.sources){var o=null;t.sources.forEach(function(e){if(e.indexingDate)var t=e.indexingDate;for(var n in t)t[n]&&-1!==t[n]&&(o?t[n]<o&&(o=t[n]):o=t[n])}),o&&(e=new Date(1e3*o))}return e},setRefine:function(e){var t=this.getRefine();JSON.stringify(t)!==JSON.stringify(e)&&(this._searchInfo.refine=e,this.setInfoIndex(null,!1),this._notifyChange())},getRefine:function(){return this._searchInfo.refine},clearRefine:function(){delete this._searchInfo.refine},isSearchInProgress:function(){return!!this._indexInfo&&!!this._currentSearch},getSearchValue:function(){return this._currentSearch},getOriginTerminology:function(){return this._originTerminology},setOriginTerminology:function(e){this._originTerminology=e},getResultsCount:function(){let e=o.getContent();if(e){let t=e.getGridViewRowHeight(),o=e.getContentHeight();if(t&&o)return Math.ceil(o/t)+10}return 0},getSearchTags:function(){return this._facets},setSearchTags:function(e){this._facets=e},setRefineTags:function(e){this._refine=e},getRefineTags:function(){return this._refine}})}),define("DS/TerminologyEditor/views/TerminologyPlaceHolder",["UWA/Core","UWA/Controls/Abstract","DS/Controls/Button","DS/Controls/TooltipModel","DS/TerminologyEditor/utils/TerminologyEditorEvents","DS/ApplicationFrame/CommandsManager","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/utils/TerminologyEditorcontrol","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TerminologyEditor/utils/TerminologySearch"],function(e,t,o,n,i,r,l,a,s,d){"use strict";return t.extend({init:function(e){this._parent(e),this._buttonComponents=null,this.text={},this.buildSkeleton()},buildSkeleton:function(){var t=this,o="TerminologySection_AllTerminologies";function n(e){t._getComponentToReplace(e).inject(t.elements.container)}l.getCurrentTerminology()&&(o=l.getCurrentTerminology().plmType),this.elements.container=e.createElement("div",{class:"content-placeholder"}),this.elements.icon=e.createElement("div",{class:"content-placeholder-icon"}).inject(this.elements.container),this.elements.description=e.createElement("div",{class:"content-placeholder-description"}).inject(this.elements.container),i.onCurrentTerminologyChange(function(e){t._removeButtonComponent(),n(e.currentNode.plmType)}),d.onSearchChange(function(){o=l.getCurrentTerminology().plmType,t._removeButtonComponent(),n(o)}),n(o)},_buildButtonComponents:function(t){var n=[];function i(e,t){var n=e.commands[t].callback,i={label:e.commands[t].name,emphasize:e.commands[t].emphasize,icon:e.commands[t].icon},r=new o(i);return r.getContent().addEventListener("buttonclick",function(){n()}),r}function r(e,t){if(e.commands)for(var o=0;o<e.commands.length;o++){i(e,o).inject(t)}}for(var l in t){var a=this.commonCommand=e.createElement("div",{class:"content-placeholder-common-command"});r(t[l],a),n[l]=a,this.text[l]=t[l].text}return n},_getComponentToReplace:function(e){var t=this._getButtonComponents();if(null===t){var o=this._getOptions();t=this._buttonComponents=this._buildButtonComponents(o)}return"TerminologySection_AllTerminologies"===e?widget.launchWithReadMode?(this._getText(this.text.terminologySection_Read),t.terminologySection_Read):(this._getText(this.text.terminologySection),t.terminologySection):widget.launchWithReadMode?(this._getText(this.text.terminology_Read),t.terminology_Read):(this._getText(this.text.terminology),t.terminology)},_getOptions:function(){return{terminologySection:{text:s.get("placeholder_msg_section"),commands:[{name:s.get("placeholder_CreateTerminology"),emphasize:"primary",callback:function(){var e=r.getCommand("ActionBar_NewBrowsingStructureCmd",a.getContent());e&&e.begin()}}]},terminologySection_Read:{text:s.get("placeholder_msg_terminology")},terminology:{text:s.get("placeholder_msg_terms"),commands:[{name:s.get("placeholder_CreateTerm"),emphasize:"primary",callback:function(){var e=r.getCommand("ActionBar_NewBrowsingNodeCmd",a.getContent());e&&e.begin()}}]},terminology_Read:{text:s.get("placeholder_msg_terminology")},search:{text:s.get("placeholder_msg_search")}}},_removeButtonComponent:function(){this.getContent().getElementsByClassName("content-placeholder-common-command")[0].remove(),this.elements.icon.getChildren().forEach(function(e){e.remove()})},_getText:function(e){this.getContent().getElementsByClassName("content-placeholder-description")[0].innerText=e},_getButtonComponents:function(){return this._buttonComponents}})}),define("DS/TerminologyEditor/views/TerminologyMode",["UWA/Controls/Abstract","DS/Controls/TooltipModel","DS/TerminologyEditor/Terminology_CSO","DS/Utilities/Dom","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/utils/TerminologyEditorEvents","DS/TerminologyEditor/utils/TerminologySearch","DS/IPClassifyUtil/IPClassifyAlert","DS/CoreEvents/ModelEvents","DS/IPClassifyUtil/bsd_utils/BSDSession","DS/IPClassifyUtil/IPClassifyModelEvents","DS/TerminologyEditor/utils/TerminologyLoaderGlobal","DS/IPClassifyUtil/IPClassifyUtility"],function(e,t,o,n,i,r,l,a,s,d,c,u,g,m){"use strict";var p=null,f=null;function h(){return{icon:{iconName:widget.getValue("useIndexAcceleration")?isNaN(widget.getValue("autoSwitch"))?"database hoverGlass":"database-hourglass":"database hoverGlass",fontIconFamily:1,className:"check-active"},disabled:!widget.getValue("useIndexAcceleration")}}var y=e.singleton({_currentModeType:"read",_instantTime:null,_lastRefreshMode:null,_modelEvents:null,init:function(e){this._parent(e),this._tooltip=new t,u.getModelEvents().subscribe({event:"switch_to_author"},this.switchtoAuthoringMode.bind(this)),setInterval(()=>{this.updateToolTip()},1e4),this._modelEvents=new d},getToolbarEntry:function(){var e="read"===y.getCurrentModeType()?{icon:{iconName:"database-refresh",fontIconFamily:1,className:""},disabled:!1}:h(),t={id:"indexMode",dataElements:{typeRepresentation:"functionIcon",tooltip:this._tooltip,label:i.indexMode.Label,action:{module:"DS/TerminologyEditor/views/TerminologyMode",func:"switchModeButtonUI"},visibleFlag:!widget.launchWithReadMode}};for(var o in e)t[o]=e[o];return t},switchModeButtonUI:function(){m.sendTrackerPageEvent("TerminologyWidget_iconBar","Active Mode");var e;e=300,clearTimeout(f),f=setTimeout(function(){g.addComponentsToLoad("global",{tree:""}),"read"===y.getCurrentModeType()?(y.setCurrentMode("authoring"),y.updateIconAndSettings()):(y.setCurrentMode("read"),y.updateIconAndSettings());try{r.getTreeCont().refreshTerminologyTreeAndContent()}catch(e){console.log("Error in tree mode"),g.removeComponentToLoad("global","tree")}},e)},updateIconAndSettings:function(e){var t=e||!0;if(widget.refreshDuetoChangeInPreference){var o=widget.changeInPreference;o.hasOwnProperty("useIndexAcceleration")&&(o.useIndexAcceleration?this.setCurrentMode("read"):this.setCurrentMode("authoring"),this._modelEvents.publish({event:"changeInContentFilterType"}))}(t&&this._registerTimeandModeOfRefresh(this.getCurrentModeType()),"read"===this.getCurrentModeType())&&(this._enableIndexModeSwitch(),y.stopRefresh(),(!widget.refreshDuetoChangeInPreference||Object.keys(o).length>0)&&r.getContent().getSpecficMode("read").resetInfoIndex());if("authoring"===this.getCurrentModeType())if(widget.getValue("useIndexAcceleration")){var n=widget.getValue("autoSwitch");this._enableAuthoringMode(),y.setIndexModeAfterTimeInterval(n)}else this._enableAuthoringMode();this.updateToolTip()},_enableAuthoringMode:function(){if(r.getIdCardCont()){var e=h();r.getIdCardCont().updateCommand("indexMode",e)}},_enableIndexModeSwitch:function(){if(r.getIdCardCont()){var e={icon:{iconName:"database-refresh",fontIconFamily:1,className:""},disabled:!1};r.getIdCardCont().updateCommand("indexMode",e)}},getCurrentModeType:function(){return this._currentModeType},setCurrentModeType:function(e){this._currentModeType=e,"read"===e?(c.setAuthoringState(!1),c.setUseIndexPreference(!0)):(c.setAuthoringState(!0),c.setUseIndexPreference(!1))},onGlobalModeChange:function(e){this._modelEvents.subscribe({event:"changeInTerminologyGlobalMode"},e)},_registerTimeandModeOfRefresh:function(e){this._instantTime=(new Date).getTime(),this._lastRefreshMode=e},updateToolTip:function(){var e=this._instantTime,t=Math.floor(((new Date).getTime()-e)/1e3);t=t<60?t+" "+i.indexMode.seconds:t/60<60?Math.floor(t/60)+" "+i.indexMode.minutes:Math.floor(t/3600)+" "+i.indexMode.hours;var o="read"===this._currentModeType?i.indexMode.Index:i.indexMode.Authoring,n=i.replace(i.indexMode.activeMode,{mode:o})+"\n"+i.replace(i.indexMode.lastRefresh,{timeElapsed:t}),l=widget.getValue("useIndexAcceleration")&&"authoring"===this._currentModeType&&!isNaN(widget.getValue("autoSwitch"))?n+"\n"+i.replace(i.indexMode.reactIndexMode,{autoSwitch:widget.getValue("autoSwitch")}):n;this._tooltip.shortHelp=l,r.getIdCardCont()&&r.getIdCardCont().updateCommand("indexMode",{tooltip:this._tooltip})},setIndexModeAfterTimeInterval:function(e){var t=this;if(this.stopRefresh(),!isNaN(e)){var o=parseInt(e);p=setTimeout(function(){widget.getPreference("useIndexAcceleration").value&&(t.setCurrentMode("read"),t.updateIconAndSettings(),s.displayNotification({message:i.indexMode.info_msg_DataNotUptoDate,className:"info"}))},60*o*1e3)}},stopRefresh:function(){p&&clearTimeout(p)},setCurrentMode:function(e){var t=this._currentModeType!==e;this.setCurrentModeType(e),/*!TerminologySearch.isSearchActive() && */r.getContent()&&r.getContent().setCurrentMode(e),t&&this._modelEvents.publish({event:"changeInTerminologyGlobalMode"})},switchtoAuthoringMode:function(){"read"===y.getCurrentModeType()&&y.setCurrentMode("authoring"),y.updateIconAndSettings()},isTerminologyProxyToBeUsed:function(){var e=r.getContent(),t=e?e.getCurrentModeType():widget.getValue("useIndexAcceleration")?"read":"authoring",n=o.getCurrentTerminology(),i=!!n&&"TerminologySection_AllTerminologies"===n.getID();return"read"===t&&i}});return y}),define("DS/TerminologyEditor/utils/TerminologyEditorUtil",["UWA/Utils","UWA/Core","DS/WebappsUtils/WebappsUtils","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/TerminologyEditor/service/TerminologyTypeService","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/utils/TerminologyEditorEvents","DS/TerminologyEditor/utils/TerminologyCommunication","DS/TerminologyEditor/Terminology_CSO","DS/IPClassifyActive/utils/EventsManager","DS/IPClassifyActive/utils/WidgetDataProvider","DS/LifecycleServices/LifecycleServicesSettings","DS/WidgetServices/WidgetServices","DS/PlatformAPI/PlatformAPI","DS/IPClassifyUtil/bsd_utils/BSDAttributeMgt","UWA/Utils/Client","DS/TerminologyEditor/utils/TerminologySearch","DS/TerminologyEditor/views/TerminologyMode","DS/ZipJS/deflate","DS/ZipJS/inflate"],function(e,t,o,n,i,r,l,a,s,d,c,u,g,m,p,f,h,y,T,v){"use strict";var _=null,C={iconName:"browsing-structure-node",fontIconFamily:1},S={iconName:"browsing-structure-root",fontIconFamily:1};function E(e){var t=x.jsonUnzip(e),o=null;try{o=JSON.parse(t)}catch(e){o=null}return o}function w(e){return x.jsonZip(JSON.stringify(e))}function b(){if(!_){var e=widget.getValue("view_status");_={},e&&(_=E(e))}return _||{}}function D(e,t){var o=b();o[e]=t,widget.setValue("view_status",w(o))}function I(e){return b()[e]}var x={jsonZip:function(t){if(t.length>0&&"{"!==t[0]&&"["!==t[0])return t;for(var o=new ArrayBuffer(t.length),n=new Uint8Array(o),i=0;i<t.length;i++)n[i]=t.charCodeAt(i);var r=new Deflater;r.append(n);var l=r.flush(),a=String.fromCharCode.apply(null,l);return e.base64Encode(a)},jsonUnzip:function(t){if(t.length>0&&("{"===t[0]||"["===t[0]))return t;if(t.length>0&&0===t.indexOf("root,"))return"{}";var o=t;try{o=e.base64Decode(t)}catch(e){console.log(e)}for(var n=new ArrayBuffer(o.length),i=new Uint8Array(n),r=0;r<o.length;r++)i[r]=o.charCodeAt(r);var l=new Inflater,a=l.append(i);return l.flush(),String.fromCharCode.apply(null,a)},_getManipulationColumns:function(){let e=a.getContent().getPADTreeListView(),t=[];if(e){let n=e.getManipulationUnitColumns();for(var o=0;o<n.length;++o)t.push(n[o].dataIndex)}return t},convertToExaleadDataFormatFederated:function(e){var t={children:null},o=e.attributes,n={"ds6w:type":"type","ds6w:label":"label"},i={};let r=a.getContent().getPADTreeListView(),l=this._getManipulationColumns();return o.forEach(function(e){if("resourceid"===e.name||"physicalid"===e.name)t.resourceid=e.value;else if("type_icon_url"===e.name||"icon"===e.name)t.icons=[e.value];else if("preview_url"===e.name||"thumbnail_2d"===e.name)t.thumbnail=e.value;else if(e.name.startsWith("ds6w")){var o=e.name.split("/"),a=o[o.length-1],s=e.object?e.object:e.value;s=s||e.dispValue;var d=e.dispValue?e.dispValue:e.value;d||(d=s);let g=null,m=null;if(r){-1!==l.indexOf(a)&&(g=a+"_SortKey",m=d);let e=r.getColumnUnitNls(a,!0);e&&(d=d+" "+e)}var c=i[a];if(c&&!Array.isArray(c)&&(c=[c]),Array.isArray(c)&&c.push(d),Array.isArray(c)?i[a]=c:i[a]=d,g){let e=i[g];e&&!Array.isArray(e)&&(e=[e]),Array.isArray(e)&&e.push(m),Array.isArray(e)?i[g]=e:i[g]=m}a!==e.name&&(i[e.name]=s);var u=n[a];u&&(t[u]=s,i[u]=s)}else"relcount"===e.name?"0"!==e.value&&(t.children=[]):i[(g=e.name,m=g.toLowerCase(),p=h.getAvailableColumns(),f=null,Array.isArray(p)&&p.every(function(e){return m===e.toLowerCase()&&(f=e),null===f}),f=f||g)]=e.value;var g,m,p,f}),e.id||(e.id=t.resourceid),t.isSearchWithinData=!0,t.grid=i,"read"===a.getContent().getCurrentModeType()&&("Term"===t.type?(t.icons=[C],t.grid["ds6w:classification"]="Term"):"Terminology"===t.type&&(t.icons=[S],t.grid["ds6w:classification"]="Terminology")),t},convertToExaleadDataFormat:function(e){if(Array.isArray(e.attributes))return this.convertToExaleadDataFormatFederated(e);var o={};o.resourceid=e.id,o.label=void 0!==e.label?e.label:e.title,o.type=e.type,o.isDownloadable=e.isDownloadable||a.isCustomizedEnv()&&i.inFamilyTerminology(e.type),o.checkout=e.checkout,t.is(e.mxid)&&(o.mxid=e.mxid);var n=e.icon,r=e.largeicon,l=e.thumbnail?e.thumbnail:null;for(var s in i.isTerminology(e.type)?(n=S,r=S):i.isTerm(e.type)&&(n=C,r=C),o.icons=n?[n]:[],o.thumbnail=null!==l?l:null!==r?r:n,t.is(e.description)&&t.is(e.description.replace,"function")&&(e.description=e.description.replace(/\\n/g," ")),o.grid={},o.padgrid={},o.grid["ds6w:identifier"]=e.name,o.grid["ds6w:description"]=e.description?e.description:"",o.grid["ds6w:modified"]=e.modified,o.grid["ds6w:created"]=e.created,o.grid["ds6w:responsible"]=e.owner,o.grid["ds6w:type"]=e.displayType?e.displayType:e.type,o.grid["ds6w:policy"]=e.policy?e.policy:"",o.grid["ds6w:organizationResponsible"]=e.organizationResponsible?e.organizationResponsible:e.organization?e.organization:"",o.grid["ds6w:project"]=e.project?e.project:e.collabspace?e.collabspace:"",o.grid["ds6w:status"]=e.status?e.status:e.state?e.state:"",e)"string"==typeof e[s]?e[s].length>0&&(o.grid[s]=e[s]):o.grid[s]=e[s];t.is(e.isDuplicated)&&(o.grid.isDuplicated=e.isDuplicated);let d=a.getContent().getPADTreeListView(),c=this._getManipulationColumns();var u=T.getAttrPredicateMap();return Object.keys(e).forEach(function(n){var i=u.get(n);if(i&&e[n].length>0){o.grid[i]=e[n];let r=null;if(-1!==c.indexOf(i)&&(r=i+"_SortKey",o.grid[r]=e[n]),d){let r=d.getColumnUnitNls(i,!0);if(r)if(t.is(e[n],"array")){let t=[];for(let o=0;o<e[n].length;++o){let i=e[n][o]+" "+r;t.push(i)}o.grid[i]=t}else o.grid[i]=e[n]+" "+r}}}),t.is(e.logicalDeleteBy)&&(o.grid.logicalDeleteBy=e.logicalDeleteBy),t.is(e.logicalDeleteStamp)&&(o.grid.logicalDeleteStamp=e.logicalDeleteStamp),t.is(o.thumbnail)&&(o.grid.thumbnail=o.thumbnail),o.children=null,o},convertToArray:function(e){return[{name:"ds6w:description",value:e.grid["ds6w:description"]},{name:"ds6w:modified",value:e.grid["ds6w:modified"]},{name:"ds6w:created",value:e.grid["ds6w:created"]},{name:"ds6w:type",value:e.grid["ds6w:type"]},{name:"ds6w:policy",value:e.grid["ds6w:policy"]},{name:"ds6w:organizationResponsible",value:e.grid["ds6w:organizationResponsible"]},{name:"ds6w:project",value:e.grid["ds6w:project"]},{name:"isDuplicated",value:e.grid.isDuplicated},{name:"ds6w:leaf",value:e.padgrid["ds6w:leaf"]},{name:"ds6w:root",value:e.padgrid["ds6w:root"]},{name:"ds6w:responsible",value:e.grid["ds6w:responsible"]},{name:"ds6w:status",value:e.grid["ds6w:status"]}]},generateJSON:function(e){var t,o,n,i=e.length,r={};for(t=0;t<i;++t)o={label:(n=e[t]).title,type:n.type,icon:n.icon,id:n.id,mxid:n.mxid,terminologyClassification:n.type},r[n.id]=o;return r},hasDeniedAttributes:function(e){var t=!1;return(e.hasOwnProperty("title")&&"#DENIED!"===e.title||e.hasOwnProperty("state")&&"#DENIED!"===e.state)&&(t=!0),t},shouldBeEditable:function(e){return i.inFamilyTerminology(this.plmType)},onNodeModelUpdate:function(e){var t=e.data.nodeModel;if(i.inFamilyTerminology(t.plmType)){var o=t._lastUpdateTime?t._lastUpdateTime:0,d=Date.now()-o;if(t._lastUpdateTime=Date.now(),!(0!==o&&d<300))if(t._resetting)t._resetting=!1;else{var c=t.getID(),u=t.options.label,g=t.options.oldLabel;if(void 0===g&&(g=""),u!==g){var m=!0;u&&u.trim&&(u.trim()===g.trim()&&(m=!1),u=u.trim()),0===u.trim().length&&(r.displayNotification({message:l.get("msg_error_name_empty"),className:"error"}),m=!1),m?(v.switchtoAuthoringMode(),n.setTerminologyProperties({pid:c,type:t.plmType,properties:{title:u},onComplete:function(){t.options.oldLabel=u,s.notifyTerminologyRename([t]);var e=i.isTerminology(t.plmType)?"msg_info_rename_bs":"msg_info_rename_bn";r.displayNotification({message:l.replace(l.get(e),{name1:g,name2:u}),className:"success"}),a.getContent().getPADTreeListView().escape(),a.getTreeCont().escape()},onFailure:function(e){let o=l.get("msg_error_rename");r.displayNotification({title:l.replace(o.Title,{name:g}),subtitle:o.Advice,message:o.Details,className:"error"}),t._resetting=!0,setTimeout(function(){t.withTransactionUpdate(function(){this.setLabel(g)}),t._resetting=!1}),a.getContent().getPADTreeListView().escape(),a.getTreeCont().escape()}})):setTimeout(function(){t.withTransactionUpdate(function(){this.setLabel(g)});var e=require("DS/TerminologyEditor/commands/TerminologyCommands");t.hasOwnProperty("pathId")?e._cellToRename&&e.RenameCmd(e._cellToRename.cellInfos,"TREE"):e._cellToRename&&e.RenameCmd(e._cellToRename.cellInfos,"CONTENT")})}}}},getTenant:function(){var e=p.getTenantID(),t=null;return e&&null===t&&(t={label:e,value:e}),t},getCurrentSecurityContextAndTerminologyData:function(e){var t=c.getCurrentTerminology(),o="ctx::"+widget.getValue("xPref_CREDENTIAL"),n=this.getTenant(),i=s.createTerminologyForPublication(t,e);return i.Tenant=n,i.SecurityContext=o,i},objectSelectionProvider:{widgetEventsProvider:{selection:"TerminologyEditor.Public.Terminology"},widgetDataProvider:{getObjectForPublication:function(e){return e&&i.inFamilyTerminology(e.getType())?{TerminologyID:e.getID(),TerminologyLabel:e.getLabel()}:null}}},dipatchSecurityContextAndTerminology:function(){var e={current:null,active:null,origin:widget.id},t=this.getCurrentSecurityContextAndTerminologyData();e.current=t;var o=JSON.stringify(t);d.publish("TerminologyEditor.CurrentTerminology",o),d.publish("TerminologyEditor.Terminology",e);var n=c.getCurrentTerminology();g.setDataProvider(this.objectSelectionProvider),u.notifyObjectSelection(n)},compareLabels:function(e,o){return e||(e=""),o||(o=""),t.is(e,"array")&&(e=e.length>0?e[0]:""),t.is(o,"array")&&(o=o.length>0?o[0]:""),p.compareValue(o,e)},setBadge:function(e,t,o){var n={};n[t]=o,this.setBadges(e,n)},setBadges:function(e,t){var o=e.getBadges();for(var n in o=o||{},t){var i=t[n];o[n]=i?"string"==typeof i?{iconPath:i,iconSize:{width:"16px",height:"16px"}}:i:"none"}e.setBadges(o)},copyTexttoCLipboard:function(e){var t=document.createElement("textarea");if(t.classList.add("bsd-txt-link"),t.value=e,document.body.appendChild(t),y.Platform.hasOwnProperty("ios")&&!0===y.Platform.ios){t.contentEditable=!0,t.readOnly=!0;var o=document.createRange();o.selectNodeContents(t);var n=window.getSelection();n.removeAllRanges(),n.addRange(o),t.setSelectionRange(0,t.value.length)}else t.select();try{var i=document.execCommand("copy")}catch(e){}return document.body.removeChild(t),!!i},getDefaultView:function(){var e=I("default_view");return e&&"treelistview"!==e?e:"datagridview"},getContentSortmodel:function(){var e,t=I("treeSort")||e,o=[{sort:"asc",dataIndex:"tree"}];return t&&(t.id?o=[{sort:t.param?t.param.sortOrder:"asc",dataIndex:t.id}]:Array.isArray(t)&&(o=t)),o},getRightPanelStatus:function(){var e=I("rightPanel");return e||{rightPanelState:!1,size:300}},getLeftPanelStatus:function(){var e=I("leftPanel");return e||{leftPanelState:!0,isWelcomePanelCollapsed:!1}},getTreeViewScrollerPosition:function(){var e=I("TreeViewScrollerPosition");return e||{x:0,y:0}},setDefaultView:function(e){D("default_view",e)},setContentSortmodel:function(e){D("treeSort",e)},setRightPanelStatus:function(e){D("rightPanel",e)},setLeftPanelStatus:function(e){D("leftPanel",e)},setTreeViewScrollerPosition:function(e){D("TreeViewScrollerPosition",e)},getContentViewPreference:function(){return new Promise(function(e,t){var o=widget.getValue("TerminologyCusto_treelistview");if(o)e({preference:E(o)});else{new Promise(function(e){require(["DS/IPClassifyUtil/bsd_utils/BSDPUWSAccess"],function(t){e(t)})}),new Promise(function(e){m.app_initialization(e)});e({preference:null})}})},setContentViewPreference:function(e,t,o){return new Promise(function(n){try{e.selectedTypes=h.getSelectedTypes(),e.selectedExtensions=h.getSelectedExtensions()}catch(e){}e.version=o||widget.getValue("vMigration"),e.hasOwnProperty("columnsOptimized")&&e.columnsOptimized.forEach(function(e){e.hasOwnProperty("label")&&delete e.label}),"only"!==t&&widget.setValue("TerminologyCusto_treelistview",w(e)),t?require(["DS/IPClassifyUtil/bsd_utils/BSDPUWSAccess"],function(t){t.saveMyAppsTemplate({preference_name:widget.getValue("x3dAppId")+"_template",value:w(e),onComplete:function(e){console.log("Saved as template"),n()},onFailure:function(e){console.warn("Cannot save customization template"),n()}})}):n()})},setTreeTaggerPreference:function(e,t){t=JSON.stringify(t),t=x.jsonZip(t),widget.setValue(e,t)},getTreeTaggerPreference:function(e){return function(e){if(e)try{e=x.jsonUnzip(e),e=JSON.parse(e)}catch(t){e={}}else e={};return e}(widget.getValue(e))},isTreeTaggerActive:function(){return!0===p.getWidgetPreference("bsdActivateTreeFilter").value},isContentTaggerActive:function(){var e=p.getWidgetPreferenceValue("activateBIFilter"),t=p.getWidgetPreference("bsdActivateTreeFilter").value;return!0===e&&"false"===t},filterDBOnlyAttrs:function(e){for(var t=[],o=0;o<e.length;++o)(!e[o].attrDBName||e[o].attrDBName.length>0)&&t.push(e[o]);return t},isRelationsColumnsActive:function(){let e=!0===p.getWidgetPreferenceValue("activateRelationsColumns"),t=!0===p.getWidgetPreferenceValue("Activate_relationsColumns"),o=window&&window.isReplayRelatedObjectsODT;return t&&e||o}};return x}),define("DS/TerminologyEditor/views/TerminologyLeftSidePanelView",["UWA/Core","UWA/Controls/Abstract","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/IPClassifyUtil/bsd_utils/BSDContext","DS/TerminologyEditor/utils/TerminologyEditorEvents","DS/TerminologyEditor/utils/TerminologyEditorcontrol"],function(e,t,o,n,i,r){"use strict";return t.extend({_context:null,_callbackAdd:!1,init:function(e){this._parent(e,{}),this._context=n.get(),this.addCallback()},updatePanelVisibility:function(e,t){"left"===t&&(this.setPreferences(),r.getIdCardCont().updateLeftPanelIcon(e))},addCallback:function(){var e=this,t=r.getTreeCont()?r.getTreeCont()._terminologies_TreeView:null;t._getScroller()&&t._getScroller().onScrollEnd(function(){o.setTreeViewScrollerPosition(t.getScrollerPosition())}),!1===this._callbackAdd&&this._context.elements.padshell&&this._context.elements.padshell._modelEvents&&(this._context.elements.padshell._modelEvents.subscribe({event:"triptych-panel-hidden"},e.updatePanelVisibility.bind(this,!1)),this._context.elements.padshell._modelEvents.subscribe({event:"triptych-panel-visible"},e.updatePanelVisibility.bind(this,!0)),i.leftPanelOpen(function(t){"left"===t&&(!e._context.elements.padshell.getLeftOpen()&&widget.body.getSize().width,e._context.togglePanel("left"),e.setPreferences())}),i.leftPanelClose(function(t){"left"===t&&(e._context.elements.padshell.getLeftOpen()&&(e._context.togglePanel("left"),e.setPreferences()))}),this._callbackAdd=!0)},setPreferences:function(){var e=this._context.elements.padshell.getLeftOpen(),t={leftPanelState:e,isWelcomePanelCollapsed:!e};o.setLeftPanelStatus(t),e?i._modelEvents.publish({event:"welcome-panel-expanded"}):i._modelEvents.publish({event:"welcome-panel-collapsed"})},isLeftPanelOpen:function(){return this._context.elements.padshell.getLeftOpen()}})}),define("DS/TerminologyEditor/views/TerminologyRightSidePanelView",["UWA/Core","UWA/Controls/Abstract","UWA/Promise","DS/IPClassifyUtil/bsd_utils/BSDContext","DS/WidgetServices/commandProxy/CommandProxy","DS/TerminologyEditor/Terminology_CSO","UWA/Class/Model","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/utils/TerminologyEditorEvents","DS/IPClassifyUtil/IPClassifyUtility"],function(e,t,o,n,i,r,l,a,s,d,c,u){"use strict";var g=[];return t.extend({_context:null,_propertiesWdg:null,_callbackAdd:!1,init:function(e){this._parent(e,{}),this._context=n.get();var t=this;if(this._propertiesWdg=null,this._context.elements.padshell){var i=new o(function(e){null===t._propertiesWdg?require(["DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/utils/EditPropUtils"],function(o,n,i){if(t.EditPropUtils=i,null===t._propertiesWdg){t._propertiesWdg=new o({className:"enxpropertiestab",setEditButton:!0,readOnly:!0===widget.launchWithReadMode,typeOfDisplay:n.ALL,selectionType:n.NO_SELECTION,multiselection:!1,collapseTabs:!1,context:t._context,actions:[{name:"action_close_panel",text:a.button_close,icon:"close",handler:function(){t._context.elements.padshell.getRightOpen()&&(t._context.togglePanel("right"),t._selectionChange(),t.setPreferences())}}]}),t._propertiesWdg.removeFacets([n.FACET_VIEWS]);var r=t._context.elements.padshell.getRightPanelContent();t._propertiesWdg.inject(r),t._propertiesWdg.elements.container.getContent().addEvent("resize",function(){t.size=t._context.elements.padshell._currentRight;var e={rightPanelState:t._context.elements.padshell.getRightOpen(),size:t.size};s.setRightPanelStatus(e)});var l=s.getRightPanelStatus();l.rightPanelState?(t.size=t._context.elements.padshell._currentRight=l.size,t._context.togglePanel("right"),t.setPreferences(),t._selectionChange(),c._modelEvents.publish({event:"information-panel-visible"})):(t.size=t._context.elements.padshell._currentRight=l.size,t.setPreferences())}e()}):e()});i.then(function(e){t.addCallback()}),g.push(i)}},updatePanelVisibility:function(e,t){"right"===t&&(this.setPreferences(),d.getIdCardCont().updateRightPanelIcon(e),!0===e&&u.sendTrackerPageEvent("TerminologyWidget_iconBar","Information"))},addCallback:function(){var e=this;!1===e._callbackAdd&&(i.create({events:{onSelect:e._selectionChange.bind(e)}}),e._context.elements.padshell&&e._context.elements.padshell._modelEvents&&(e._context.elements.padshell._modelEvents.subscribe({event:"triptych-panel-hidden"},e.updatePanelVisibility.bind(this,!1)),e._context.elements.padshell._modelEvents.subscribe({event:"triptych-panel-visible"},e.updatePanelVisibility.bind(this,!0)),c.rightPanelOpen(function(t){"right"===t&&(e._context.elements.padshell.getRightOpen()||(e._context.togglePanel("right"),e._selectionChange(),e.setPreferences()))}),c.rightPanelClose(function(t){"right"===t&&(e._context.elements.padshell.getRightOpen()&&(e._context.togglePanel("right"),e._selectionChange(),e.setPreferences()))}),e._callbackAdd=!0))},_selectionChange:function(e,t){if(this._context.elements.padshell.getRightOpen()&&this.EditPropUtils&&(!t||t.metadata&&t.metadata.originWidgetId===widget.id&&"ENORIPE_Relations"!==t.metadata.origin)){var n=this,i=r.getCurrentSelection(),l=[];i.length&&i.forEach(function(e){var t=n.EditPropUtils.getModelFromSelectedNode(e);t&&l.push(t)});var a=new o(function(e){o.all(g).then(function(){n._propertiesWdg.initDatas(l),e()})});g.push(a)}},setPreferences:function(){var e=this._context.elements.padshell.getRightOpen(),t={rightPanelState:e,size:this.size};s.setRightPanelStatus(t),e?c._modelEvents.publish({event:"information-panel-visible"}):c._modelEvents.publish({event:"information-panel-hidden"})},_getAppContext:function(e){return{getPlatformUrls:function(){return e.platformUrls},getSecurityContext:function(){return widget.getValue("xPref_CREDENTIAL")}}}})}),define("DS/TerminologyEditor/service/TerminologyEditorWebServiceReadMode",["DS/WidgetServices/WidgetServices","DS/TerminologyEditor/utils/TerminologySearch","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/service/TerminologyEditorWebService","UWA/Core"],function(e,t,o,n,i){"use strict";var r=function(e){var t="TREE"===e?o.getTreeCont():o.getContent();if(t){var n=t.getGridViewRowHeight(),i=t.getContentHeight();if(n&&i)return Math.ceil(i/n)+10}return 25};return i.extend(n,{getContentReadMode:function(o){var n={};i.extend(n,o);var l=t.get3DSearchUrl()+"/search";n.payload={},n.payload.select_predicate=t.getIndexPredicates(),n.payload.query=-1===o.content?"NOT(physicalid:"+o.pid+")":"NOT(physicalid:"+o.pid+') AND NOT(type === "Term")';var a=new Date,s=Math.random().toString(36).substring(2,11);n.payload.label=("Terminology_getContentReadMode"+s+"_"+a.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-");var d=widget.lang?widget.lang:widget.getValue("lang");null!==o.next_start?n.payload.next_start=o.next_start:n.payload.start=0,n.filters&&(n.payload.refine=n.filters),n.payload.specific_source_parameter={"3dspace":{option:{with_Idx_Search:!0},search_in_context:{expand:{root_physicalid:o.pid,expand_iter:"1"}}}},n.payload.nresults=r(),n.payload.locale=d,n.payload.tenant=e.getTenantID(),n.payload.select_file=["icon","thumbnail_2d"],n.payload.source=["3dspace"],n.payload.with_indexing_date="false",!0!==n.synthesis&&(n.payload.with_synthesis="false");var c=require("DS/TerminologyEditor/utils/TerminologyEditorUtil").getContentSortmodel();return c&&c.length>0&&(n.payload.order_by=c[0].sort,n.payload.order_field="tree"===c[0].dataIndex?"ds6w:label":c[0].dataIndex),n.payload.login={"3dspace":{SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL")}},n.headers={"content-type":"application/json"},n.data=i.Json.encode(n.payload),n.method="POST",n.timeout=12e4,this._executeRequest(l,n,"getContentReadMode")},getRoots:function(n){var l={};i.extend(l,n);var a=t.get3DSearchUrl()+"/search";if(l.payload={},l.payload.select_predicate=["ds6w:label","physicalid","mxid","ds6w:type","ds6w:classification","icon_2ddefaultthb.subtype","ds6w:status","ds6w:description","ds6w:responsible","ds6w:modified","ds6w:created","ds6w:identifier","flattenedtaxonomies"],n.contentView){var s=require("DS/TerminologyEditor/utils/TerminologyEditorUtil").getContentSortmodel();!0!==l.synthesis&&(l.payload.with_synthesis="false"),s&&s.length>0&&(l.payload.order_by=s[0].sort,l.payload.order_field="tree"===s[0].dataIndex?"ds6w:label":s[0].dataIndex),l.payload.select_predicate=t.getIndexPredicates(),n.next_start?l.payload.next_start=n.next_start:l.payload.start=0,l.payload.nresults=r()}else{var d=o.getTreeCont()._terminologies_SortElmt;l.payload.order_by=d.sortOrder,l.payload.order_field="alpha"===d.sortMode?"ds6w:label":"ds6w:modified";var c=o.getTreeCont()._indexModeforReadData.getNextStart();l.payload.start=c,l.payload.nresults=r("TREE")}l.filters&&(l.payload.refine=l.filters),l.payload.query='flattenedtaxonomies:"types/Terminology"';var u=new Date,g=Math.random().toString(36).substring(2,11);l.payload.label=("Terminology_read_getRoots"+g+"_"+u.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-");var m=widget.lang?widget.lang:widget.getValue("lang");return l.payload.locale=m,l.payload.tenant=e.getTenantID(),l.payload.select_file=["icon","thumbnail_2d"],l.payload.source=["3dspace"],l.payload.indexmode="true",l.payload.login={"3dspace":{SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL")}},l.headers={"content-type":"application/json"},l.data=i.Json.encode(l.payload),l.method="POST",l.timeout=12e4,this._executeRequest(a,l,"Terminology_read_getRoots")},getTerminologyPathsforItems:function(o){var n={};if(i.extend(n,o),!i.is(n,"object"))throw new Error("Invalid inputs for TerminologyEditorWebService.getTerminologyPathsforItems");e.get3DSpaceUrlAsync({onComplete:r=>{var l=r+"/cvservlet/navigate",a=widget.lang?widget.lang:widget.getValue("lang");n.payload={},n.payload.locale=a,n.payload.tenant=e.getTenantID(),n.query={SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL"),tenant:e.getTenantID()},n.payload.input_physical_ids=o.ids,n.payload.attributes=t.getIndexPredicates(),n.payload.version=3,n.payload.primitives=[{navigate_from_rel:{id:1,filter:{bo_type:["Terminology","Term"]}}}],n.payload.patterns={GET_PARENT:[{id:1,iter:-1}]},n.payload.patternFlags={GET_PARENT:{flags:["returnPaths"]}},n.payload.source=["3dspace"];var s=new Date;return n.payload.label=("terminologyWidgetNavigate_"+s.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),n.timeout=12e4,n.payload.start=0,n.method="POST",n.headers={Accept:"application/json","content-type":"application/json","Accept-Language":a},n.type="json",n.data=i.Json.encode(n.payload),this._executeRequest(l,n,"getTerminologyPathsforItems")}})},filterTerminology:function(t){if(!i.is(t,"object"))throw new Error("Invalid inputs for TerminologyEditorWebService.content");var o={};i.extend(o,t);e.get3DSpaceUrlAsync({onComplete:e=>(e+="/resources/v1/TerminologyManagement/Terminology/"+o.pid+"/filterTerminology",o.data={IDs:function(e){return i.is(e,"array")?e.toString():e}(o.prd)},o.headers={"content-type":"application/json"},o.data=i.Json.encode(o.data),o.method="POST",o.timeout=12e4,this._executeRequest(e,o,"filterTerminology"))})}})}),define("DS/TerminologyEditor/ActionBar/TerminologyCommandManager",["UWA/Core","UWA/Class","DS/WidgetServices/WidgetServices","DS/ApplicationFrame/CommandsManager","DS/IPClassifyUtil/IPClassifyUtility","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/LifecycleServices/LifecycleServicesSettings","DS/TerminologyEditor/Terminology_Clipboard","DS/TerminologyEditor/service/TerminologyTypeService","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/utils/TerminologySearch","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/IPClassifyUXUtil/ActionBar/IPCommandManager","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/IPClassifyUtil/IPClassifyModelEvents","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","text!DS/TerminologyEditor/assets/TerminologyProbesCommandMapping.json","text!DS/TerminologyEditor/assets/TerminologyEditorCmds.json"],function(e,t,o,n,i,r,l,a,s,d,c,u,g,m,p,f,h,y){"use strict";var T=JSON.parse(h);var v={RenameCmd:{multisel:!1,TREE:{Sections:!1},CONTENT:{Terminologies:!0}},SelectChildren:{TREE:!1,CONTENT:{check:function(e){return null!==e.getChildren()}}},SelectParent:{TREE:!1,CONTENT:{check:function(e){return e.getDepth()>0}}},SelectAll:!0,SelectInversion:{TREE:!1,CONTENT:!0},SelectSiblings:{TREE:!1,CONTENT:!0},SelectLeaves:{TREE:!1,CONTENT:{check:function(e){return null!==e.getChildren()}}},Copy:{TREE:{FavSection:!1,Sections:!1},CONTENT:!0},Paste:{search:!1,white_click:!0,clipboard:!0,TREE:{FavSection:!1},CONTENT:{Terminologies:!0,rootInClipboard:!1}},ActionBar_Attributes:{TREE:{Sections:!1},CONTENT:!0},ActionBar_TransferOwnership:{TREE:{Sections:!1},CONTENT:!0},MaturityHdr:{TREE:{Sections:!1,Root:!0},CONTENT:{Root:!0}},ActionBar_ChangeOwner:{TREE:{Sections:!1},CONTENT:!0},ActionBar_NewBrowsingStructureCmd:{author:!1,white_click:!0,search:!1,TREE:{Sections:!0,Terminologies:!1},CONTENT:{check:e=>"Section"===e.options.type}},ActionBar_NewBrowsingNodeCmd:{author:!1,white_click:!0,search:!1,multisel:!1,TREE:{Sections:!1,Terminologies:!0},CONTENT:{check:function(e){return"Section"!==e.options.type}}},DeleteHdr:{TREE:{Sections:!1,Terminologies:!0},CONTENT:!0},treeview:!0,ExpandAll:{TREE:{Favorites:!1},CONTENT:{check:function(e){return null!==e.getChildren()}}},ExpandN:{TREE:{FavSection:!1,Favorites:!1},CONTENT:{check:function(e){return null!==e.getChildren()}}},CollapseAll:{TREE:{Favorites:!1},CONTENT:{check:function(e){return null!==e.getChildren()}}},Print:{search:!1,ios:!1,views:["datagridview"]},PrintOptions:{search:!1,ios:!1},ActionBar_ShareTerminologyLink:{multisel:!1,TREE:{Sections:!1},CONTENT:{search:!1}}};return t.singleton(g,{noSizeToFit:[],initialize:function(){d.onTerminologySelected(()=>{this.updateCommands()}),d.onEmpty(()=>{this.enableAllCommands(!1)}),n.onCommandStart(e=>{var t=v[e.getId()];t&&!0===t.author&&this.getModelEvents().publish({event:"switch_to_author"})});var e=new Promise(e=>{new Promise(e=>{e(y)}).then(e)});return new Promise(t=>{e.then(e=>{var o={};if(e)for(var n in(o=JSON.parse(e)).headers){var i=o.headers[n],r=v[n];i.ID=n,r&&"CATAfrHeaderCheck"===i.Behavior&&(r.type="check")}t(o)})})},launchCommand:function(e,t,o,n){let r=e;T&&T[e]&&(r=T[e]),"ContextualMenu"===n?i.sendTrackerPageEvent("TerminologyWidget_contextual",r):i.sendTrackerPageEvent("TerminologyWidget_iconBar",r),this._parent.apply(this,arguments)},getHeaderCtxMenu:function(e){e.defaultColumnManagement=!0;var t=this._parent.apply(this,arguments),o=e.cellInfos;return t.push({ID:"clearSort",title:f.CMDClearSort,type:"PushItem",icon:"clear",state:o.manager&&o.manager.sortModel&&o.manager.sortModel.length>0&&(o.manager.sortModel.length>1||"defaultSort"!==o.manager.sortModel[0].dataIndex)?"enabled":"disabled",action:{callback:function(){var e;(e=o).manager.prepareUpdateView(),e.manager.sortModel=[{dataIndex:"defaultSort",sort:"asc"}],e.manager.layout.saveColumnSortModelInPreferences(),e.manager.pushUpdateView({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1},!0)}}}),t},_manageSwitchOfCommands:function(t,n,i,l){var d=this,c=i&&!!n&&0===n.length,g=!1,m=!1,p=!1,f=!1,h=!1,y=a.IsEmpty(),T=!1;y||a.getSelectedNodes().every(e=>!(T=T||s.isTerminology(e.plmType)));var _=!1,C=!1,S=!1;t&&(S="TerminologySection_AllTerminologies"===t.plmType,_=s.isTerminology(t.plmType),C=s.isTerm(t.plmType));var E=S,w=!1,b=u.isRelationsColumnsActive();n&&n.every(function(e){return g=g||s.isTerminology(e.plmType),m=m||s.isTerm(e.plmType),w=w||"Busy"===e.plmType,p=0!==e.getParents().length,f=f||b&&!0===e.isRelationsObjectNode,h=h||b&&!0===e.isRelationsObjectGroupingNode,!g||!m||!w||b&&(!f||!h)});var D=!0;if((w||(S||!t)&&n&&0===n.length)&&(D=!1),i||this.enableAllCommands(D),!w){var I={},x=Object.keys(v);return l&&(x=l),x.forEach(function(l){var a=v[l];if(a){var s=!!n&&n.length>0,u=!!t&&!s,S=!0,w=!n||n.length<=1;if("object"==typeof a){if(S&&b&&h&&(S=!1),(S&&!1===a.TREE&&u||!1===a.CONTENT&&s)&&(S=!1),S&&c&&!0!==a.white_click&&(S=!1),S&&void 0!==a.clipboard&&(S=!y),S&&void 0!==a.multisel&&(S=w),S&&void 0!==a.custo&&(S=r.isCustomizedEnv()),S&&void 0!==a.setting&&(S=!0===o.getWidgetPreferenceValue(a.setting)),S&&a.check&&(S=a.check({oneIsRoot:g,oneIsTerminology:m,treeIsRoot:_,treeIsTerminology:C})),S&&a.views&&(S=a.views.indexOf(r.getContent().getActiveView())>=0),S&&!1===a.dashboard&&(S=o.isWebInWinEnvironment()),S&&!1===a.webInWin&&(S=!o.isWebInWinEnvironment()),S&&!1===a.ios&&(S=!e.Utils.Client.Platform.ios),S&&!1===a.CATIAV6&&(S=!0!==widget.getValue("noCompass")),u=null,S&&a.TREE&&(u=!(!t||s&&void 0!==a.CONTENT))&&(!0===a.TREE?u=!0:(u&&a.TREE.custo&&(u=r.isCustomizedEnv()),c||u&&i&&!1===a.TREE.ctxMenu&&(u=!1),!1!==u&&(!0===a.TREE.Root?u=_:!1===a.TREE.Root&&(u=!_)),!1!==u&&(!0===a.TREE.Terminology?u=C:!1===a.TREE.Terminology&&(u=!C)),!1!==u&&(!0===a.TREE.Terminologies?u=C||_:!1===a.TREE.Terminologies&&(u=!C&&!_)),!1!==u&&(!0===a.TREE.Sections?u=E:!1===a.TREE.Sections&&(u=!E)),!1!==u&&(!0===a.TREE.FavSection?u=!1:!1===a.TREE.FavSection&&(u=!0)),!1!==u&&a.TREE.check&&(u=a.TREE.check(t)))),s=null,S&&a.CONTENT&&(s=!!n&&n.length>0))if(!0!==a.CONTENT||b&&f){if(s&&a.CONTENT.custo&&(s=r.isCustomizedEnv()),!1!==s&&(!0===a.CONTENT.Root?s=g:!1===a.CONTENT.Root&&(s=!g)),!1!==s&&(!0===a.CONTENT.Terminology?s=m:!1===a.CONTENT.Terminology&&(s=!m)),!1!==s&&(!0===a.CONTENT.Terminologies?s=m||g:!1===a.CONTENT.Terminologies&&(s=!m&&!g)),!1!==s&&(!0===a.CONTENT.FavContent?s=n[0].isFavorite:!1===a.CONTENT.FavContent&&(s=!n[0].isFavorite)),!1!==s&&!1===a.CONTENT.rootInClipboard&&(s=!T),!1!==s&&!1===a.CONTENT.childProduct&&(S=s=!p),!1!==s&&(a.CONTENT.check||a.CONTENT.types)){var D=a.CONTENT.types,x=a.CONTENT.check,P=!1;n.every(function(e){return P=(P=D&&e.options&&e.options.type?D.indexOf(e.options.type)>=0:!D)&&(!x||x(e))}),s=P}}else s=!0;S=S&&(!0===s||!0===u||null===s&&null===u)}I[l]=S,i||d._switchCommand(l,S,a.type)}}),I}},enableAllCommands:function(t){var o=n.getCommands();for(var i in o){var r=n.getCommand(i);e.is(r)&&r.enable&&(t?this._switchCommand(i,!0):"ListSnapshotsHdr"!==i&&this._switchCommand(i,!1))}},getModelEvents:function(){return p.getModelEvents()},updateCommands:function(e,t){if(t||(t=d.getCurrentTerminology()),r.getContent()){var o=r.getContent().getSelectedNodes();o=o||(e?[e]:[]),this._parent(t,o)}}})}),define("DS/TerminologyEditor/TerminologyIdCardCont",["UWA/Core","DS/IPClassifyUXUtil/ActionBar/IPToolbar","UWA/Class/Options","DS/Utilities/TouchUtils","DS/TerminologyEditor/views/TerminologyMode","DS/TerminologyEditor/utils/TerminologyEditorEvents","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/ActionBar/TerminologyCommandManager","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/models/TerminologyInfo","DS/TerminologyEditor/utils/TerminologySearch","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/IPClassifyUtil/IPClassifyModelEvents"],function(e,t,o,n,i,r,l,a,s,d,c,u,g){"use strict";return t.extend(o,{name:"enoTerminologyIdCard_Container",getCommandManager:function(){return a},createPathInfo:e=>new d({id:e.id,mxid:e.mxid,type:e.type,label:e.label}),getEntryForCommand:e=>{var t=null;return"IndexMode"===e&&(t=i.getToolbarEntry()),t},init:function(e){l.setIdCardCont(this);var t=this,o=u.getLeftPanelStatus(),n=u.getRightPanelStatus();widget.addEvent("ontoolbarReady",()=>{var t=u.getDefaultView(),o=a.getCommand(t);o&&o.options.icon&&e.modelEvents.publish({event:"toolbar_update_command",data:{commandID:"display",data:{icon:{iconName:o.options.icon,fontIconFamily:1}}}})}),e.leftOpened=o&&o.leftPanelState,e.rightOpened=n&&n.rightPanelState,e.modelEvents=g.getModelEvents(),e.searchInCurrentTab=!0,this._parent(e),this._buildSkeleton(),r.onCurrentTerminologyChange(function(e){t.setCurrentLocation()}),this.noSearchConfiguration(),this.dispatchEvent.call(this,"onReady")},inject:function(){this._parent.apply(this,arguments),this.setCurrentLocation()},setCurrentLocation:function(){var e=s.getCurrentTerminologyPath();this._parent({objectPath:e})},isSearchAvailable:function(e){return!1},showSearch:function(e){this._parent(!1),this.noSearchConfiguration()},noSearchConfiguration:function(){var e=n.getTouchMode()?"150px":"101px";this.elements.elementStableCommands.setStyle("flex-basis",e)},render:function(){return this},_buildSkeleton:function(){this.topRightSideDiv=document.getElementsByClassName("TerminologyEditor_top_right_side_div"),r.subscribeEvents(),this.topRightSideDiv[0].addEventListener("contextmenu",this._rightClick)},_rightClick:function(e){var t=e?e.target:null;return(!t||"INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName)&&(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()),!1}})}),define("DS/TerminologyEditor/service/TerminologyServices",["UWA/Core","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/TerminologyEditor/service/TerminologyTypeService","DS/IPClassifyUtil/IPClassifyAlert","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/views/TerminologyMode","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor"],function(e,t,o,n,i,r,l,a){"use strict";return{CopyTerminology:function(e){l.switchtoAuthoringMode();var t=e.targetPhysicalId,n=t?t.getID():"";n&&"TerminologySection_AllTerminologies"!==t.plmType||(n="Root");var i="ctx::"+widget.getValue("xPref_CREDENTIAL");n.length&&e.physicalIds.length?o.copyterminology({PhysicalId:e.physicalIds,TargetPhysicalId:n,SecurityContext:i,withContent:e.withContent,onComplete:function(t){var o=t?JSON.parse(t):void 0;if(o&&o.error){var n=o.error;console.log("CopyTerminology WebService Err : "+n),n.length>200&&(n=null),e.callbacks.onFailure(o.advice?o:n)}else e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure}):e.callbacks.onFailure(e)},activateTerminologyEditorItem:function(e,t,o){if(n.isTerm(t)?t="Term":n.isTerminology(t)&&(t="Terminology"),e&&n.inFamilyTerminology(t)){var l=r.getTreeCont();l&&l.expandTreeAndSelectTerminology({terminologyToFindAndSelect:{ids:[e],type:t,name:o},partiallyExpandPath:!0,onComplete:function(e){console.log(" expandTreeAndSelectTerminology:onComplete")},onGiveUp:function(e){console.log(" expandTreeAndSelectTerminology:onGiveUp")},onFailure:function(e){i.displayNotification({title:a.replace(a.msg_error_TerminologyActivate.title,{name1:o}),subtitle:a.msg_error_TerminologyActivate.subtitle,className:"error"})}})}else console.log("Selected (Double Clicked) object is not terminology")}}}),define("DS/TerminologyEditor/commands/TerminologyCommands",["UWA/Core","UWA/Utils","DS/IPClassifyUtil/IPClassifyAlert","DS/TerminologyEditor/Terminology_CSO","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TerminologyEditor/service/TerminologyServices","DS/TerminologyEditor/service/TerminologyTypeService","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/Terminology_Clipboard","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/WidgetServices/WidgetServices","DS/UIKIT/Native/Dropdown","DS/IPClassifyUtil/IPClassifyCommunication","DS/TerminologyEditor/ActionBar/TerminologyCommandManager","DS/IPClassifyUtil/IPClassifyModelEvents"],function(e,t,o,n,i,r,l,a,s,d,c,u,g,m,p,f){"use strict";return{_activeCuttingNodes:!1,escapCmd:function(){a.getContent().getPADTreeListView().escape(),a.getTreeCont().escape()},RenameCmd:function(e,t){var o=null;o=t?a.getTreeCont()._terminologies_TreeView:a.getContent().getPADTreeListView().getManager();var n=e.rowID?e.rowID:void 0!==e._rowID?e._rowID:null,i=o.layout.getColumnIndex("tree"),r=o.layout.getCellIDFromCoordinates({rowID:n,columnID:i});o.setCellInEdition(r)},CopyCmd:function(){var e=[];e=a.getContent().getSelectedNodes();var t=n.getCurrentTerminology();e=e.length>0?e:[t],s.addInTerminologyClipboard(e,t,"COPY")},PasteCmd:function(t){var d=n.getCurrentTerminology(),c=s.getSelectedNodes(),u=s.getMode(),g=t&&l.inFamilyTerminology(t.plmType)?t:null;if(g||(g=d),c){var m=[],p=[];c.length>0?c.forEach(function(t){m.push(e.is(t.id)?t.id:t.options.resourceid),l.inFamilyTerminology(t.plmType)&&p.push(e.is(t.id)?t.id:t.options.resourceid)}):(m.push(c),l.inFamilyTerminology(t.plmType)&&p.push(c.id));var h,y=p.length;if(g){if("COPY"===u&&p.length>0){h=!0,function(e,t){let n=!1,r="";for(var a=0;a<t.length;a++){let s=t[a];if(l.isTerminology(s.plmType)&&!l.isSection(e.plmType)?(n=!0,r=i.msg_error_pasteDestination.InvalidParameters+i.msg_error_pasteDestination.BSDestination):l.isTerm(s.plmType)&&l.isSection(e.plmType)&&(n=!0,r=i.msg_error_pasteDestination.InvalidParameters+i.msg_error_pasteDestination.BNDestination),n)return o.displayNotification({title:i.msg_error_pasteDestination.Title,subtitle:r,className:"error"}),!1}return!0}(g,c)&&r.CopyTerminology({physicalIds:p,targetPhysicalId:g,withContent:h,callbacks:{onComplete:function(){f.getModelEvents().publish({event:"switch_to_author"}),a.getContent().loadContentAndSelect(d),o.displayNotification({message:i.replace(i.msg_info_terminologycopied,{number:y,terminologyname:g.options.label}),className:"success"}),null!==d&&d.isExpanded()&&e.is(a.getTreeCont())&&a.getTreeCont().updateTreeWithNewTerminology(d)},onFailure:function(t,n){void 0!==n&&(n=JSON.parse(n)),n&&n.hasOwnProperty("error")?o.displayNotification({message:n.error,className:"error"}):t&&t.message&&t.message.contains("NetworkError")&&t.message.contains("500")?o.displayNotification({title:i.msg_error_objectNoLongerAccessible.Title,subtitle:i.msg_error_objectNoLongerAccessible.Advice,message:i.msg_error_objectNoLongerAccessible.Details,className:"error"}):function(t,n,i){var r=n;if(i&&i.advice)console.error(t,i.error),o.displayNotification({title:r,subtitle:i.advice,message:i.error,className:"error"});else{let t={className:"error"};t.message=r,!e.is(i)||i instanceof Error||(t.title=r,t.message=i),o.displayNotification(t)}}("PasteCmd",i.msg_error_CopyTerminology,t)}}})}}else o.displayNotification({message:i.msg_warning_nocurrentterminology,className:"warning"})}},ExpandAllCmd:function(e,t){var r=[];e?r.push(e):r=n.getCurrentSelection();var l=null;l=n.getCurrentTerminology(),r.length?r.forEach(function(e){null!==e.options.children&&("TREE"===t||"Terminology"===e.plmType||"TerminologySection_AllTerminologies"===e.plmType?e.expand({expandLevel:0}):e.expandAll())}):null===l?o.displayNotification({message:i.msg_warning_nocurrentterminology,className:"warning"}):l.expandAll()},CollapseAllCmd:function(e){var t=[],r=n.getCurrentTerminology();e?t.push(e):t=n.getCurrentSelection(),t.length?t.forEach(function(e){e.collapseAll()}):null===r?o.displayNotification({message:i.msg_warning_noselection,className:"warning"}):r.collapseAll()},GetContextualMenu:function(e,t,o){var i,r=!!e.white_Click&&e.white_Click,l=o?a.getContent().getSelectedNodes():[];return void 0===(i=!0===r?i=n.getCurrentTerminology():l&&l.length>0?l:e.nodeModel)&&(i=e),r&&l.length>0&&l.forEach(function(e){e.unselect()}),Array.isArray(i)||(i=[i]),o||(o={cellInfos:e,data:{event:{pageX:0,pageY:0}}}),p.getContextualMenu(i,"TREE"===t,o)},getCtxMenu:function(e){var t=this;return new Promise(function(o,i){var r=null,l=null;r=e.graphview?(l=e.graphview).node:e.treeview?(l=e.treeview).nodeModel?l.nodeModel:l.cellModel:(l=e.cellInfos)?l.nodeModel?l.nodeModel:l.cellModel:null;var a=!0===widget.getValue("noCompass"),s=!0===widget.getValue("standalone"),d=u.isSolidworksEnvironment();if(a&&null!==r&&"object"==typeof r&&(!d&&!s))return m.publish("Create_ContextMenu",{ids:r?[r.id]:[]}),r&&!1===r.isSelected()&&r.select(!0),void o(void 0);null==l&&(l=n.getCurrentTerminology());var c=l.rowID<0;if(l.cellView||e.graphview&&r||(l.white_Click=!0),r&&"Busy"===r.plmType)o(void 0);else{var g=null;l.white_Click||!0===c?g=l:r&&(!1===r.isSelected()&&r.select(!0),!0===r.isSelected()&&(g=e.graphview?r:l)),t.GetContextualMenu(g,"CONTENT",e).then(o).catch(i)}})},_createLink:function(e,t){var r=null,a=null,s=null,c="";if(e)l.inFamilyTerminology(e.getType())&&(a=e.getID(),s=e.getLabel());else{var g=n.getCurrentSelection();1===g.length&&(c="function"==typeof g[0].getType?g[0].getType():g[0].plmType,l.inFamilyTerminology(c)&&(a=g[0].getID(),s=g[0].getLabel()))}a.length>0&&u.getSourceUrlAsync({platformId:u.getTenantID(),source:"3DDashboard",onComplete:function(e){var t={data:{items:[{objectId:a,contentId:"",envId:widget.getValue("x3dPlatformId")}]}};if(r=e+"#app:ENOTERME_AP/content:X3DContentId="+encodeURIComponent(JSON.stringify(t)),d.copyTexttoCLipboard(r)&&l.inFamilyTerminology(c)){var n=l.isTerminology(c)?i.replace(i.msg_success_copyLink_terminology,{terminologyname:s}):i.replace(i.msg_success_copyLink_term,{termname:s});o.displayNotification({message:n,className:"success"})}else o.displayNotification({title:i.msg_error_copylink.title,subtitle:i.msg_error_copylink.subtitle,className:"error"})}})}}}),define("DS/TerminologyEditor/commands/ActionBar_PasteCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/IPClassifyUtil/bsd_utils/BSDContext","DS/TerminologyEditor/service/TerminologyTypeService","DS/TerminologyEditor/commands/TerminologyCommands"],function(e,t,o,n,i){"use strict";return t.extend({labelTopBar:e.i18n("Copy"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){var e=void 0,t=o.get().getSelectedNodes();1===t.length&&n.inFamilyTerminology(t[0].plmType)&&(e=t[0]),i.PasteCmd(e)},endExecute:function(){}})}),define("DS/TerminologyEditor/commands/ActionBar_CopyCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/TerminologyEditor/commands/TerminologyCommands"],function(e,t,o){"use strict";return t.extend({labelTopBar:e.i18n("Copy"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){o.CopyCmd()},endExecute:function(){}})}),define("DS/TerminologyEditor/commands/ActionBar_CollapseAllCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/TerminologyEditor/commands/TerminologyCommands","DS/TerminologyEditor/Terminology_CSO"],function(e,t,o,n){"use strict";return t.extend({labelTopBar:e.i18n("Collapse All"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){var e=n.getCurrentTerminology();o.CollapseAllCmd(e,"TREE")},endExecute:function(){}})}),define("DS/TerminologyEditor/commands/ActionBar_ExpandAllCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/TerminologyEditor/commands/TerminologyCommands","DS/TerminologyEditor/Terminology_CSO"],function(e,t,o,n){"use strict";return t.extend({labelTopBar:e.i18n("Expand All"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){var e=n.getCurrentTerminology();o.ExpandAllCmd(e,"TREE")},endExecute:function(){}})}),define("DS/TerminologyEditor/commands/ActionBar_ShareTerminologyLink",["UWA/Core","DS/ApplicationFrame/Command","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TerminologyEditor/commands/TerminologyCommands"],function(e,t,o,n){"use strict";return t.extend({labelTopBar:e.i18n("Share Terminology Link"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){n._createLink()},endExecute:function(){}})}),define("DS/TerminologyEditor/commands/CtxCommands",["DS/ApplicationFrame/Command","DS/TerminologyEditor/commands/TerminologyCommands","DS/IPClassifyUtil/bsd_utils/BSDContext"],function(e,t,o){"use strict";return e.extend({execute:function(){switch(this.options.ID){case"RenameCmd":var e=o.get().getSelectedNodes().at(0);i=(n=e).hasOwnProperty("_instanceType"),t.RenameCmd(n,i)}var n,i}})}),define("DS/TerminologyEditor/utils/TerminologyEditorKeyboardListener",["UWA/Core","UWA/Class","UWA/Event","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/commands/TerminologyCommands","DS/TerminologyEditor/ActionBar/TerminologyCommandManager","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/service/TerminologyTypeService","DS/Logger/Logger"],function(e,t,o,n,i,r,l,a,s){"use strict";var d=function(){var e=document.activeElement;return e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName)},c=t.extend({name:"TerminologyEditorKeyboardListener",init:function(e){this._parent(e),this._logger=s.getLogger(c)},startObservingKeyboard:function(){e.Element.addEvent.call(document,"keydown",this._onKeyDown.bind(this))},_onKeyDown:function(e){var t=o.whichKey(e),n=this.launchKeyAction(t);n&&!0===n.stopPropagation&&o.stop(e)},launchKeyAction:function(e){var t=this,o={stopPropagation:!1},s=function(e,n,i){var l,a,s,c,u=(l=e,a=n,s=r.getCommand(a),c=null,s&&s.isEnabled()?d()?c="Info : '"+l+"' key pressed in INPUT field, no command launched":s.begin():c="Info : '"+l+"' key pressed, but command '"+a+"' is disabled",c);o.stopPropagation=!1!==i,u&&(t._logger.log(u),o.stopPropagation=!1)};switch(e){case"ctrl+a":s(e,"SelectAll");break;case"del":s(e,"DeleteHdr");break;case"ctrl+c":s(e,"Copy",!1);break;case"ctrl+v":s(e,"Paste");break;case"alt+return":s(e,"ActionBar_Attributes");break;case"f2":if(d())this._logger.log("Info : '"+e+"' key pressed in INPUT field, no command launched");else{var c=l.getSelectedNodes(),u=l.getCurrentTerminology();if((Array.isArray(c)?c.length:0)>=1){var g=c[0];if(g&&a.inFamilyTerminology(g.plmType))if(u.getID()===g.getID()){var m=n.getTreeCont();m&&m.switchTerminologyTreeNodeLabelToWriteView&&m.switchTerminologyTreeNodeLabelToWriteView(u)}else{var p=n.getContent();p&&p.switchTerminologyTreeNodeLabelToWriteView&&p.switchTerminologyTreeNodeLabelToWriteView(g)}else this._logger.log("Info : '"+e+"' key pressed but selected element is not a Terminology, no command launched")}else this._logger.log("Info : '"+e+"' key pressed when no element selected, no command launched")}break;case"esc":i.escapCmd()}return o}});return c}),define("DS/TerminologyEditor/infra/xTermComponent",["i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","UWA/Promise","DS/UIKIT/Mask","DS/Utilities/Utils","DS/IPClassifyUtil/IPClassifyAlert","DS/LifecycleServices/LifecycleServicesSettings","DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/IPClassifyModelEvents","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/TerminologyEditor/utils/TerminologyEditorcontrol"],function(e,t,o,n,i,r,l,a,s,d,c,u,g,m){"use strict";function p(){var e=this,o={},n=new r(function(n){require([e.options.amd_custo.TreeDocument],function(i){o.renderTo=e.options.renderTo,o=function(){var e=this,o={};return["doDnDDragStart","shouldAcceptDnDDrop","doDnDDrop"].forEach(function(n){t.is(e[n],"function")&&(o[n]=e[n].bind(e))}),o}.call(e),e.options.model=new i(o),e.options.model.getModelEvents().subscribe({event:"onRootAdded"},function(t){if(t.data.added_node&&!1===e.options.layout.withWelcomePanel){var o=t.data.added_node.getID();e.dispatchEvent("onAddPaths",{addedPaths:[[o]]})}}),e.options.model.getModelEvents().subscribe({event:"onCenterGraph"},function(t){e.options.views.treelistview?e.options.views.treelistview.getManager().scrollToNode(t.data,void 0,!1):e.options.views.datagridview.options.dgv.ensureNodeModelVisible(t.data),e.options.views.graphview&&e.options.views.graphview.reframeOn()}),e.options.model.addEventListener("beginBlockingTransaction",function(t){e.beginBlockingTransaction(t.data)}),e.options.model.addEventListener("endBlockingTransaction",function(){e.endBlockingTransaction()}),e.options.isReady.model=!0,n()})});return n.name="build",n}function f(){var e=this;e.elements.container.empty(),t.createElement("div",{class:"xnav_hdr"}).inject(e.elements.container),t.createElement("div",{class:"xnav_body"}).inject(e.elements.container),t.createElement("div",{class:"xnav_footer"}).inject(e.elements.container);var o=new r(function(o,n){var i=[],l=e.elements.container.querySelector(".xnav_body"),a=new r(function(o,n){require(["DS/ENOXTriptych/js/ENOXTriptych"],function(n){var i=t.createElement("div",{class:"xterm_viewmain"}),r=t.clone(e.options.layout.triptychOpts);r.container=e.elements.container.querySelector(".xnav_body");var l=t.createElement("div",{class:"xterm_viewright rightSidePanel"});e.elements.padshell=new n,e.elements.padshell.init(r,e.createRootListSlidder2(),i,l),e.elements.padshell.togglePanel=function(t){"left"===t?e.elements.padshell._modelEvents.publish({event:"triptych-toggle-panel",data:"left"}):(e.elements.padshell._modelEvents.publish({event:"triptych-toggle-panel",data:"right"}),e.elements.padshell._modelEvents.subscribe({event:"triptych-clicked-overlay"},function(e){e&&"right"===e&&u.publish({event:"onOverlayClick"})}))},u.publish({event:"on2DTriptychReady"}),require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=e.getCommandCheckHeader("RootPanel");t&&t.addCallback()}),function(e,t){var o=this;require(["DS/TerminologyEditor/views/ViewLoader"],function(n){var i={component:o,x3dAppId:o.options.x3dAppId,renderTo:e.renderTo,amd:{datagridview:o.options.amd_custo.DataGridView,treelistview:o.options.amd_custo.TreeListView}};o.loader=new n(i),o.loader.loadView(o.options.active_view,function(){t()})})}.call(e,{renderTo:i},o)})});a.name="slidder",i.push(a),r.all(i).then(function(){e.elements.padstatus&&(!0===e.options.layout.padshell?e.elements.padstatus.inject(e.elements.padshell.getMainPanelContainer()):e.elements.padstatus.inject(l)),o()})});return o.name="buildSkeleton",o}return o.extend(n,i,{_dispatchReady_NotDone:!0,defaultOptions:{widget:null,elements:null,active_view:"treelistview",toolbar_opts:null,layout:{padshell:!1,title_update:!0,view_customization:null,store_roots_in_pref:!0,drop_invite:"dynamic",keyboard_inputs:!0,withWelcomePanel:!1,triptychOpts:{left:{resizable:!0,originalState:"close",overMobile:!0,minWidth:300,withClose:!0},withtransition:!0,withoverflowhidden:!0,right:{resizable:!0,originalState:"close",overMobile:!0,minWidth:250,withClose:!1}},amdTreeView:"treelistview"},amd_custo:{TreeDocument:"DS/TerminologyEditor/xTermDocument",TreeListView:null,DataGridView:null},views:{treelistview:null,graphview:null,datagridview:null},views_cb:{},isReady:{model:!1,actionbar:!1,treelistview:!1,graphview:!1}},setDnD_onGraph:function(){},init:function(o){this._parent(o),this.options=t.extend(this.options,o,!0),this.elements.container=t.createElement("div",{class:"xterm_component"}),this.options.flags={};var n=this;d.app_initialization(function(o){var i=p.call(n),l=f.call(n);r.all([i,l]).then(function(){n.options.model.getVisibleAdditionalColumns=function(){var e=[];if(n.options.views.treelistview)var o=n.getPADTreeListView().getManager();else o=n.options.views.datagridview;if(n.options.additionalColumnsModules&&n.options.additionalColumnsModules.length)for(var i=0;i<n.options.additionalColumnsModules.length;i++){for(var r=[],l=n.options.additionalColumnsModules[i],a=l.getManagedColumnNames(),s=0;s<a.length;s++)(l.allViewsSupported||o&&t.is(o.isColumnHidden,"function")&&!o.isColumnHidden(a[s]))&&r.push(a[s]);r.length&&e.push({module:l,columns:r})}return e},n._dispatchReady(!1),u.subscribe({event:"TerminologyEditor/expandStatus"},function(t){t.status&&!0===t.status.expandTooLarge&&("find_in_ctx"===t.mode?s.displayNotification({message:e.replace(e.notifications.tooManyResultFound,{maxResult:c.getWidgetPreferenceValue("maxPathsForSearch")}),className:"warning"}):s.displayNotification({message:e.notifications.expandTooLarge,className:"warning"}))})})})},render:function(){return this.elements.container},toggleView:function(e){if(e!==this.options.active_view){var t=this;"treeview"===e&&(e=this.options.layout.amdTreeView),this.loader.loadView(e,function(){t.options.views[t.options.active_view].unsetModel(),t.options.active_view=e,t.options.model.applyActiveView(t.options.active_view),t.options.views[t.options.active_view].setModel(t.options.model),"graphview"===t.options.active_view&&t.options.views.graphview.reframeOn(),t.dispatchEvent("onToggleView",t.options.active_view)})}},togglePanel:function(e,t){(this.elements.padshell?this.elements.padshell:this.elements.padinfo).togglePanel(e,t)},beginBlockingTransaction:function(e){l.mask(this.elements.container,e)},endBlockingTransaction:function(){l.unmask(this.elements.container)},onResize:function(){this.options.model.invalidateViewPort(),"graphview"===this.options.active_view&&this.options.views.graphview.setSize(),this.dispatchEvent("onParentResize")},getPADTreeDocument:function(){return this.options.model},getRoots:function(){return this.options.model.getRoots()},getPADTreeListView:function(){return this.options.views.datagridview},displayNotification:function(e){s.displayNotification(e)},compactMode:function(e){this.getPADTreeListView().compactMode(e),this.dispatchEvent("onCompactMode",e)},updateAttributesDelayed:function(e){var t=this;this._debounceMethod=this._debounceMethod?this._debounceMethod:a.debounce(function(e){var o=e.displayNodesArray;if(void 0===o&&e&&e.collectionView&&e.collectionView.model){var n=e.collectionView;o=e.endNodeIndex>=0?n.model.slice(e.startNodeIndex,e.endNodeIndex+1):n.model.slice(e.startNodeIndex,e.endNodeIndex)}if(o.length){for(var i=[],r=0;r<o.length;r++)o[r]._canBeGrouped()&&!0!==o[r].isRelationsObjectGroupingNode&&i.push(o[r]);t.options.additionalColumnsModules&&t.options.additionalColumnsModules.length&&t.options.model.fillAttributesAsync4VisibleNodes(i,t.options.additionalColumnsModules);for(var l=require("DS/IPClassifyUtil/bsd_utils/BSDPredicateNls"),a=0,s=o.length;a<s;a++)!0===o[a]._manageNLS&&(delete o[a]._manageNLS,l.updateNLS(o[a]));"datagridview"===t.getActiveView()&&g.isRelationsColumnsActive()&&require(["DS/ENORIPE_Columns/RelationsColumns","DS/IPClassifyUtil/bsd_utils/BSDPlatformUrl"],(e,n)=>{n.retrievePlatformUrl().then(()=>{e.setHardcodedConfiguration("BME");var n=new Set;if(o.forEach(function(e){e.isRelationsObjectNode||e._isProcessedForRelationsColumns||(n.add(e.getID()),e._isProcessedForRelationsColumns=!0)}),n.size>0){var i=m.getContent().getSelectedNodes();e.updateAttributes({pids:[...n]},()=>{i.forEach(function(e){e.select()})},t.options.model)}})})}},200);let o=!0;e&&e.collectionView&&e.collectionView.getRowModelLength&&0===e.collectionView.getRowModelLength()&&(o=!1),o&&this._debounceMethod(e)}})}),define("DS/TerminologyEditor/views/customize_views/_TerminologyDGVUtils",["UWA/Core","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor.json","DS/IPClassifyUtil/bsd_utils/BSDAttributeMgt","DS/IPClassifyUtil/bsd_utils/BSDDictionaryAccess","DS/TerminologyEditor/service/TerminologyTypeService"],function(e,t,o,n,i){"use strict";function r(e){}return r.prototype.buildColumns=function(t){return new Promise(function(t,i){var r=[],l=0,a=o.getColumnsOrder(void 0);o.updateAttributesWithKind(void 0).then(function(){for(l=0;l<a.length;l++){var i=o.getColumn(a[l],void 0);i&&r.push(this.buildColumnFromSetting(i))}var s=e.clone(r);n.updateColumnsWithNLS(s,function(e){var o={};o.columns=s,"success"===e.status&&(o.columns=e.columns),t(o)})}.bind(this)).catch(i)}.bind(this))},r.prototype.buildColumnFromSetting=function(o){var n=Object.assign({editableFlag:!1,customisation:{exportable:{lock:!1,value:!0}}},o);if(!e.is(n.dataIndex)){if(!e.is(n.ds6w))throw new Error("Wrong column definition for ["+JSON.stringify(o)+"]");n.dataIndex=n.ds6w}switch(n.kind){case"string":n.typeRepresentation="string";break;case"timestamp":case"dateTime":n.typeRepresentation="datetime",n.getCellValueForExport=function(e){var t=new Date(e.cellModel),o=e.cellModel;return"Invalid Date"!==t&&(o=t.toLocaleString()),o};break;case"boolean":n.typeRepresentation="boolean";break;case"image":n.typeRepresentation="image";break;case"icon":n.typeRepresentation="icon";break;case"functionIcon":n.typeRepresentation="functionIcon";break;default:n.typeRepresentation||(n.typeRepresentation="string")}switch(n.dataIndex){case"thumbnail":n.ds6w=void 0,n.typeRepresentation="image",n.text=t.column_Thumbnail,n.sortableFlag=!1;break;case"tree":n.getCellEditableState=function(e){return!0!==widget.launchWithReadMode&&(e&&e.nodeModel&&i.inFamilyTerminology(e.nodeModel.plmType))},n.editionPolicy="DelayedEditionOnClick",n.setCellValue=function(e,t){e.nodeModel&&(require("DS/TerminologyEditor/commands/TerminologyCommands")._cellToRename={cellInfos:e,context:"CONTENT"},function(e,t,o){e.getTreeDocument().withTransactionUpdate(function(){if("tree"===t){var n={};n.label=o,n.display=o,n.oldLabel=e.options.label,e.updateOptions(n)}})}(e.nodeModel,"tree",t))}}return n},r.prototype.buildColumnsFromStorage=function(t){var n=this;return new Promise(function(i,r){var l=[],a=0;o.updateAttributesWithKind(void 0,t).then(function(t){o.updateAttributesWithKind().then(function(){var r=[];if(t)for(a=0;a<t.length;a++)r.push(new Promise(function(e){var i=t[a].dataIndex;o.addAvailableColumn(i,t[a]).then(function(t){var o=n.buildColumnFromSetting(t);o&&l.push(o),e()})}));Promise.all(r).then(function(){var t=e.clone(l);i(t)})})})})},r}),define("DS/TerminologyEditor/views/TerminologyTagger",["UWA/Class","DS/TagNavigatorProxy/TagNavigatorProxy","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/TerminologyEditor/utils/TerminologyEditorDataConversion","DS/TerminologyEditor/utils/TerminologyEditorEvents","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/IPClassifyUtil/IPClassifyAlert","DS/TerminologyEditor/views/TerminologyWebInWinTaggerProxy","DS/TerminologyEditor/utils/TerminologyEditorcontrol","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor"],function(e,t,o,n,i,r,l,a,s,d){"use strict";var c={},u={};return e.extend({init:function(){var e=this;if(!0===widget.getValue("noCompass")){window.widgetId||(window.widgetId="BSD_Tagger_"+Math.random().toString(36).substr(2,9)),(o=n(window.widgetId)).events.addFilterChangeListener=e._onFilterChange.bind(e),o.events.addCriteriaChangeListener=e._onFilterChange.bind(e),e.taggerProxy=new a(o)}else{var o=n(widget.id);(e.taggerProxy=t.createProxy(o)).addEvent("onFilterChange",e._onFilterChange.bind(e))}function n(t){return{widgetId:t,filteringMode:"FilteringOnServer",colorize:!1,events:{addOpenTaggerListener:e._onOpenTagger.bind(e),addCloseTaggerListener:e._onCloseTagger.bind(e)}}}e._isFilterSet=!1,e._filterObjs=null,e.taggerProxy.deactivate(),e._retrieveFiltersFromPref(),e._isFirstView=!0},_setSubjectTags:function(e){if(e&&this.taggerProxy){var t={};for(var o in e){var n=e[o];if(t[n.sixw])t[n.sixw][n.object]=n;else{var i={};i[n.object]=n,t[n.sixw]=i}}var r=[];for(var l in t)for(var a in c[l]||(u[l]=t[l]),u[l])r.push(u[l][a]);this.taggerProxy.setTags(null,r)}else this.taggerProxy.setTags(null,[])},_unsetTags:function(){var e=this.taggerProxy;e&&e.unsetTags()},_onFilterChange:function(e){if(s.getTreeCont()&&s.getTreeCont()._indexModeforReadData.resetInfoIndex(),s.getContent()&&s.getContent().getSpecficMode("read").resetInfoIndex(),e){var t=this;for(var o in c={},e.localfilters||(e.localfilters={}),e.localfilters)c[o]=[];this.setLocaFilter(e.localfilters);var n=t._fetchTerminologyIDs(e.localfilters);if(t._isFilterSet=!(0===Object.keys(e.localfilters).length),!t._isFilterSet)return i.notifyTreeFilterChange(t._isFilterSet),void t._saveSelectedFiltersInPref();Promise.all([n]).then(function(e){var o=e[0];t._filterObjs=new Set(o),i.notifyTreeFilterChange(t._isFilterSet)}),t._saveSelectedFiltersInPref()}},_fetchTerminologyIDs:function(e){var t=this;return new Promise(function(i){o.allTerminologies({filters:e,select_predicate:["physicalid"],onComplete:function(e){t._setSubjectTags(e.facets),i(n.getObjectIdsFromSearchRes(e.results))},onFailure:function(){i([])}})})},_onOpenTagger:function(){r.isTreeTaggerActive()&&this.populateData()},populateData:function(){var e=this,t=e.taggerProxy.getCurrentFilter();o.allTerminologies({filters:t&&t.localfilters?t.localfilters:{},select_predicate:["physicalid"],onComplete:function(t){e._setSubjectTags(t.facets)},onFailure:function(){console.error("Unable to update Content root node, Error in getting content Properties")}})},setSelectedFiltersFromPref:function(){this.taggerProxy&&this._localFilters&&this._isFirstView&&(this._isFirstView=!1,this.taggerProxy.setLocalFilter(this._localFilters))},_retrieveFiltersFromPref:function(){this._localFilters=r.getTreeTaggerPreference("tree_filter_v1")},_saveSelectedFiltersInPref:function(){if(this.taggerProxy){var e=this.taggerProxy.getCurrentFilter();r.setTreeTaggerPreference("tree_filter_v1",e.localfilters?e.localfilters:{})}},removeFilters:function(){if(this.taggerProxy){var e=this.taggerProxy.getCurrentFilter();e&&e.localfilters&&Object.keys(e.localfilters).length>0&&(this.taggerProxy.clearLocalFilter(),this.taggerProxy.dispatchEvent("onFilterChange",{localfilters:{}}),l.displayNotification({message:d.msg_info_treeFilterRemove,className:"primary"}))}},activateTaggerProxy:function(){this.taggerProxy&&(this.taggerProxy.activate(),this.populateData())},deactivateTaggerProxy:function(){this.taggerProxy&&this.taggerProxy.deactivate()},_onCloseTagger:function(){r.isTreeTaggerActive()&&this._unsetTags()},isObjectVisible:function(e){var t=!1;return!this._filterObjs||!this.isFilterSet()||(this._filterObjs.has(e)&&(t=!0),t)},getFilteredTerminologies:function(){var e=[];return this._filterObjs.forEach(t=>e.push(t)),e},isFilterSet:function(){return!0===this._isFilterSet},setLocaFilter:function(e){this._localFilters=e},getLocalFilter:function(){return this._localFilters}})}),define("DS/TerminologyEditor/TermXNavComponent",["UWA/Core","DS/TerminologyEditor/infra/xTermComponent"],function(e,t){"use strict";return t.extend({name:"pad_component",init:function(t){var o,n,i=(o=t,(n={x3dAppId:"ENOPAD",widget:widget,amd_custo:{TreeDocument:"DS/TerminologyEditor/TerminologyTreeDocument",TreeListView:"DS/TerminologyEditor/views/TerminologyTreeListView"},layout:{}}).layout=e.clone(o.layout_opts),delete(n=e.extend(n,o,!0)).layout_opts,n),r=this._parent.bind(this);this.setTerminologyCommunicationChannel(),require(["UWA/Utils/Client"],function(e){r(i)})},render:function(){return this},addRootNodes:function(t){if(!e.is(t,"array"))throw new Error("nodes parameter must be an array");var o=this.options.model;o&&o.wrapInTransaction(function(){o.withTransactionUpdate(function(){o.addRoot(t);var e=o.getRoots().length;o.getModelEvents().publish({event:"onRootAdded",data:{nb_root:e,added_node:t[e-1]}})})})},getSelectedNodes:function(){return this.options.model.getSelectedNodes()},getActiveView:function(){return this.options?this.options.active_view:"datagridview"},_dispatchReady:function(){!0===this.options.isReady.model&&!0!==this.options.isReady.PADmodel&&(this.options.isReady.PADmodel=!0),!0===this._dispatchReady_NotDone&&!0===this.options.isReady.model&&!0===this.options.isReady[this.options.active_view]&&(this.dispatchEvent.call(this,"onReady"),this.dispatchEvent("onActionBarReadyToBuild"),this._dispatchReady_NotDone=!1)}})}),define("DS/TerminologyEditor/dataProvider/TerminologyFindInDataProvider",["UWA/Class","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/utils/TerminologyEditorEvents","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/TerminologyEditor/service/TerminologyTypeService","i18n!DS/TerminologyEditor/assets/nls/TerminologyFindInTree"],function(e,t,o,n,i,r,l){"use strict";return e.singleton({NlsTree:l,autoCompleteKey:"BSD_FindInTree_savedQueries",supportedSection:r.TYPE_SECTION,unSupportedSection:r.TYPE_FAVORITES_SECTION,getTreeGridView:function(){return o.getTreeCont()._terminologies_TreeView},getTreeVisibleNodesyId:function(e){return o.getTreeCont()._getVisibleNodeById(e)},getTreeSectionNodeForFind:function(){return o.getTreeCont()._terminologies_TreeDocument.getRoots()[0]},getTreeElementToAddCommand:function(){var e=o.getTreeCont().getContent(),t=null;return e&&(t=e.getElement(".TerminologyTree_Cont-root_treeview_container")),t},getTreeSelectedNode:function(){return t.getCurrentTerminology()},expandTreeAndSelectNode:function(e){o.getTreeCont().expandTreeAndSelectTerminology(e)},findTreeNodes:function(e){i._findTerminologiesInTerminology(e)},onTreeFilterChange:function(e){return n.onTreeFilterChange(e)},onCurrentSelectionChange:function(e){return n.onCurrentTerminologyChange(e)}})}),define("DS/TerminologyEditor/utils/TerminologyListContent_Read",["UWA/Utils","DS/TerminologyEditor/service/TerminologyEditorWebServiceReadMode"],function(e,t){"use strict";return{listContent:function(e){return"TerminologySection_AllTerminologies"===e.pid?(e.contentView=!0,t.getRoots(e)):t.getContentReadMode({content:e.content,filterChildren:e.filterChildren,next_start:e.next_start,pid:e.pid,filters:e.filters,onComplete:function(t){e.onComplete(t)},onFailure:function(e){}})}}}),define("DS/TerminologyEditor/controllers/AuthoringMode",["DS/TerminologyEditor/controllers/CommonMode","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/utils/TerminologyEditorUtil","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor"],function(e,t,o,n,i){"use strict";return e.extend({init:function(e){this._parent(e)},convertData:function(e){return n.convertToExaleadDataFormat(e)},loadContents:function(e){this._parent();var n=this;return new Promise(function(r,l){e.onComplete=function(t){var n=null;if(o.getCurrentTerminology()&&(n=o.getCurrentTerminology().getID()),n===e.pid)if(void 0!==t){var a=(t="string"==typeof t?JSON.parse(t):t).member;void 0!==a?(t.contents=a,r(t)):(t.contents=[],r(t))}else l({message:i.msg_error_contentnotavailable,className:"error"})},e.onFailure=function(e,t){l({err:e,serverErr:t})},n._contentHandleRequest="TerminologySection_AllTerminologies"===e.type?t.roots(e):t.content(e)})},getModeType:function(){return"authoring"}})}),define("DS/TerminologyEditor/utils/TerminologyNavigateUtil_Read",["UWA/Utils","DS/TerminologyEditor/service/TerminologyEditorWebServiceReadMode"],function(e,t){"use strict";return{getNavigateDataforTerminology:function(e){var o=this;t.getTerminologyPathsforItems({ids:e.pids,onComplete:function(t){var n=o.createTerminologyPathData(t);e.onComplete(JSON.stringify(n))},onFailure:function(t){e.onFailure(t)}})},createTerminologyPathData:function(e){var t=this;if(!(e.result&&e.result.length>0))return{error:"No valid paths found"};var o=e.result,n={};return o.forEach(function(e){var o=e.input_object.physicalid,i="Terminology"===e.input_object["ds6w:type"],r=e.outputs.GET_PARENT&&e.outputs.GET_PARENT.length>0;if(i||r){var l=i?e.input_object:e.outputs.GET_PARENT[0],a={},s=[],d=[];for(var c in l){var u=t.getMappingforProperties_Navigate().get(c);if(u&&(a[u]=l[c]),"paths"===c&&l.paths.length>0){var g=l.paths[0];d=t._getArrayofSubPaths(g)}}s.push(a);for(var m=d.length-1;m>=0;m--){var p=d[m];s.push(p)}n[o]=s}}),Object.keys(n).length>0?n:void 0},_getArrayofSubPaths:function(e){var t=this,o=[];return e.forEach(function(e){var n={};for(var i in e){var r=t.getMappingforProperties_Navigate().get(i);r&&(n[r]=e[i])}o.push(n)}),o},getMappingforProperties_Navigate:function(){return new Map([["physicalid","id"],["did","did"],["ds6w:created","created"],["ds6w:modified","modified"],["ds6w:label","label"],["ds6w:identifier","name"],["ds6w:type","type"],["ds6w:policy","policy"],["ds6w:organizationResponsible","organizationResponsible"],["ds6w:responsible","responsible"],["ds6w:originator","owner"],["ds6w:status","status"],["ds6w:project","project"],["mxid","mxid"]])}}}),define("DS/TerminologyEditor/controllers/ReadMode",["DS/TerminologyEditor/controllers/CommonMode","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/service/TerminologyEditorWebServiceReadMode","DS/TerminologyEditor/utils/TerminologySearch","DS/TerminologyEditor/utils/TerminologyListContent_Read","DS/TerminologyEditor/views/TerminologyMode"],function(e,t,o,n,i,r,l,a){"use strict";return e.extend({supportClientSort:!1,init:function(e){this._parent(e);var t=this;this._indexInfo=null,this._currentFldId=null,this._isPageRefreshed=!1,this._methodsTobeExecutedAfterFirstScroll=[],r.onSearchChange(function(){t.resetInfoIndex()})},convertData:function(e){return t.convertToExaleadDataFormat(e)},manageError:function(e){return(e=JSON.parse(e)).error.errorMessage},loadContents:function(e){var t=this;return this.isTagSet=!1,this.cancelQuery(),new Promise(function(o,n){e.next_start=null;var i=t.getInfoIndex();null!==i?e.next_start=i.next_start:t.isInfiniteScrollingTobeDone()&&t.setSearchTags(e),e.filters=t.getRefineTagsTobeApplied(),e.onComplete=function(e){null===t._indexInfo&&(t._isPageRefreshed=!0),e=JSON.parse(e),t.setInfoIndex(e.infos);var n=e.results,i={contents:n=n||[],sorted:!0,inProgress:t.isInfiniteScrollingTobeDone()};o(i)},e.onFailure=function(e,t){n({err:e,serverErr:t})},t._contentHandleRequest=l.listContent(e)})},onSetPathTags:function(e){this.unColorizeChildren(e)},getObjectsInTree:function(){return n.getContent().getPADTreeDocument().getAllDescendants().length},onFilterFilteringEvent:function(){},unColorizeChildren:function(e){e.options.model.withTransactionUpdate(function(){e.options.model.getRoots().forEach(function(e){var t={grid:{bi_color:"rgba(0, 0, 0, 0)"}};e.getAllDescendants().forEach(function(e){delete e.options.color,e.updateOptions(t)})})})},getNumberLastResult:function(){return this._indexInfo?this._indexInfo.nresults:0},setInfoIndex:function(e){var t=this._infoIndex;this._indexInfo=e||null,this.isInfiniteScrollingTobeDone()&&null===t&&this._indexInfo&&this._methodsTobeExecutedAfterFirstScroll.forEach(function(e){e()})},onreadResult:function(e){this._methodsTobeExecutedAfterFirstScroll.push(e)},getInfoIndex:function(){return this._indexInfo},resetInfoIndex:function(){this._isPageRefreshed=!0,this._indexInfo=null},getModeType:function(){return"read"},getSearchTags:function(){return this._facets},setSearchTags:function(e){var t=this;e.next_start=null,e.synthesis=!0,e.onComplete=function(e){e=JSON.parse(e),t._facets=e.facets,t.isTagSet=!0,t.dispatchEvent("searchTagisSet")},e.filters=this.getRefineTagsTobeApplied(),this.isItTerminologySection()?i.getRoots(e):i.getContentReadMode(e)},setRefineTags:function(e){this._refine=e},getRefineTags:function(){return this._refine},isInfiniteScrollingTobeDone:function(){var e=this.isItTerminologySection();return"read"===a.getCurrentModeType()&&e},getRefineTagsTobeApplied:function(){if("TerminologySection_AllTerminologies"===o.getCurrentTerminology().getType()){var e=n.getTreeCont()._tagNavigator;return{...e.getLocalFilter()?e.getLocalFilter():{},...this.getRefineTags()?this.getRefineTags():{}}}return this.getRefineTags()?this.getRefineTags():{}},isItTerminologySection:function(){return"TerminologySection_AllTerminologies"===o.getCurrentTerminology().getID()}})}),define("DS/TerminologyEditor/TerminologyComponent",["UWA/Core","DS/Logger/Logger","DS/WebappsUtils/WebappsUtils","DS/TerminologyEditor/models/xTermNodeModel","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/controllers/AuthoringMode","DS/TerminologyEditor/controllers/ReadMode","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/TerminologyEditor/service/TerminologyTypeService","DS/TerminologyEditor/commands/TerminologyCommands","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/Terminology_Clipboard","DS/TerminologyEditor/utils/TerminologyEditorEvents","DS/TerminologyEditor/utils/TerminologySearch","DS/TerminologyEditor/views/TerminologyMode","DS/TerminologyEditor/utils/TerminologyLoaderGlobal","DS/TerminologyEditor/TermXNavComponent","DS/IPClassifyUtil/IPClassifyModelEvents","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TreeModel/TreeNodeModel","DS/IPClassifyUtil/bsd_utils/BSDAttributeMgt","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUtil/IPClassifyCommunication","DS/IPClassifyUX/service/PlatformServices","DS/LifecycleServices/LifecycleServicesSettings","DS/WidgetServices/UIInfra/UIInfra","DS/WidgetServices/WidgetServices","text!DS/TerminologyEditor/assets/TerminologyEditorConf.json"],function(e,t,o,n,i,r,l,a,s,d,c,u,g,m,p,f,h,y,T,v,_,C,S,E,w,b,D,I,x){"use strict";var P={authoring:new r,read:new l},A=h.extend({name:"TerminologyComponent",defaultOptions:{x3dAppId:"TerminologyEditor",amd_custo:{TreeDocument:"DS/TerminologyEditor/TerminologyTreeDocument",DataGridView:"DS/TerminologyEditor/views/TerminologyDataGridView"},active_view:a.getDefaultView(),layout:{keyboard_inputs:!1,root_panel:!1,action_bar:!1,statusInfo:!1,slidder:!1,title_update:!1,drop_invite:"none",triptychOpts:{borderLeft:!0,withtransition:!I.isReplayedODT(),left:{resizable:!0}},amdTreeView:"datagridview"},insert_replace:!0},_contentDiv:null,init:function(o,n){var i=this;this._contentDiv=o.renderTo;var r=p.getCurrentModeType();this._currentMode=P[r],this._handlerThumbnails=null,this._treeCont=n,this.setOptions(o),this._parent(this.options),this.elements||(this.elements={}),this.elements.tempLeftContent=null,this._logger=t.getLogger(A),c.getPlaceholder().then(function(e){i._placeHolder=e}),g.onTerminologyRename(function(e){i._sortingNodesContent(e)});var l=e.createElement("div",{class:"containerTools"});y.getModelEvents().subscribe({event:"IPClassifyColumnCusto/Views/showInWidgetBody"},function(e){e.html?(l.empty(),e.html.inject(l),l.inject(widget.body)):!0===e.restore&&l.remove()}),o.layout&&o.layout.view_customization&&Array.isArray(o.layout.view_customization.selectedExtensions)&&Array.isArray(o.layout.view_customization.selectedTypes)&&_.updateSelectedParams({selectedExtensions:o.layout.view_customization.selectedExtensions,selectedTypes:o.layout.view_customization.selectedTypes})},createRootListSlidder2:function(){return this._treeCont.elements.container},switchMode:function(e,t){if(e&&void 0!==P[e]||(e=widget.getValue("useIndexAcceleration")?p.getCurrentModeType():"authoring"),P[e]!==this._currentMode&&(this._currentMode.disable&&this._currentMode.disable(),this._currentMode=P[e],this._currentMode.enable&&this._currentMode.enable(),t=!0),"read"!==e&&"authoring"!==e||p.getCurrentModeType()!==e&&(p.setCurrentModeType(e),p.updateIconAndSettings()),t)var o=widget.getValue("x3dSelectedContentId");null===o||""===o?this.loadContentAndSelect():(widget.setValue("x3dSelectedContentId",""),this.loadContentAndSelect(void 0,[o]))},getObjectsInTree:function(){return this._currentMode.getObjectsInTree?this._currentMode.getObjectsInTree(this):this.options.model.getAllDescendants().length},_addStyleOnTreeCont:function(e){var t=this.elements.padshell._getLeftWidth();t=e&&e>t?e:t,I.addNewStyles("treeContResize",{".TerminologyTree_Cont-root_container":{overflow:"hidden"},".TerminologyTree_Cont-root_treeview_container":{width:t+"px !important"}},!0)},_OnPADComponentReady:function(){var e=this;this.addEvent("onToggleView",a.setDefaultView),require(["DS/TerminologyEditor/views/TerminologyLeftSidePanelView","DS/TerminologyEditor/views/TerminologyRightSidePanelView"],function(t,o){e.terminologyLeftPanel=new t,(new w).initializePlatform({onComplete:function(t){e.terminologyRightPanel=new o({platformUrls:t.platformurls})}})}),a.getLeftPanelStatus().leftPanelState&&this.elements.padshell.togglePanel("left"),this.addEvent("onToggleView",function(){0===c.getContent().getObjectsInTree()&&e._addPlaceHolder(),e._filterRelatedNodes()});var t=widget.getValue("customLeftWidth");this._addStyleOnTreeCont(t),this.elements.padshell._modelEvents.subscribe({event:"triptych-panel-show-started"},function(t){"left"===t&&e._addStyleOnTreeCont()}),this.elements.padshell._modelEvents.subscribe({event:"triptych-panel-visible"},function(e){"left"===e&&I.clearJSStylesheet("treeContResize")}),t&&this.elements.padshell._modelEvents.publish({event:"triptych-set-size",data:{side:"left",size:t}}),this.elements.padshell._modelEvents.subscribe({event:"triptych-resized"},function(e){"left"===e.side&&widget.setValue("customLeftWidth",e.width)}),this.elements.padshell._leftPanelContent.addEventListener("click",function(e){if(e&&e.target&&e.target.id&&"terminology-common-tool-Section"===e.target.id&&S.isWidgetMaximized()){var t=I.getWidgetPreferenceValue("bsdActivateTreeFilter");c.getTreeCont().activateTreeFilter(!t)}}),c.setContent(this),m.setPredicates(_.getAvailableColumnsOpts()),g.onCurrentTerminologyChange(function(t){e.getSpecficMode("read").resetInfoIndex(),e.switchMode(null,!0)}),g.onTreeFilterChange(function(){if("TerminologySection_AllTerminologies"===i.getCurrentTerminologyID()){var t=i.getCurrentTerminology();t&&e.loadContentAndSelect(t)}}),g.onTaggerStatusChange(function(){e.loadContentAndSelect()}),g.onCurrentTerminologyColumnChange(function(){m.isSearchInProgress()&&m.resetInfoIndex(),e.getSpecficMode("read").resetInfoIndex(),e.loadContentAndSelect(null,null)});var o=i.getCurrentTerminology();if(o){var n=widget.getValue("x3dSelectedContentId");n&&0!==n.length?this.loadContentAndSelect(o,[n],{copylink:!0}):this.loadContentAndSelect(o)}require("DS/TerminologyEditor/views/TerminologyMode").updateIconAndSettings()},_filterRelatedNodes:function(){var e=this.getPADTreeDocument();let t="datagridview"===this.getActiveView()?"IN":"OUT";if(e){var o=e.getRoots(!0).slice(0);e.wrapInTransaction(function(){e.withTransactionUpdate(function(){var e,n=o.length;for(e=0;e<n;++e)o[e].filterIn(!0);var i=function(e){e.isRelationsObjectNode?e._filterStatus=t:e._filterStatus="IN";var o=e.getChildren();o&&o.length>0&&o.slice(0).forEach(function(e){i(e)})},r=function(e){if("IN"===e._filterStatus){var t=e.getChildren();t&&t.length>0&&t.slice(0).forEach(function(e){r(e)})}else e.filterOut(),e.__treeGraphRoot__&&delete e.__treeGraphRoot__;delete e._filterStatus};o.forEach(function(e){i(e)}),o.forEach(function(e){r(e)})})})}},_isTreeTaggerContentVisible:function(e){var t=c.getTreeFilter();return!t||!t.isFilterSet()||("TerminologySection_AllTerminologies"!==i.getCurrentTerminologyID()||t.isObjectVisible(e))},setTerminologyCommunicationChannel:function(){},getOnContextualEvent:function(){return{this:this,callback:function(e){return new Promise(function(t){d.getCtxMenu(e).then(function(e){t(e)}).catch(e=>console.log(e))})}}},_createSimulatedEvent:function(e){function t(){}return{dataTransfer:e,preventDefault:t,stopPropagation:t}},getActiveView:function(){return this._parent()},removeNodesInContent:function(){var e=this.getPADTreeDocument();if(e){var t=e.getRoots(!0).slice(0);e.wrapInTransaction(function(){e.withTransactionUpdate(function(){var o,n=t.length;for(o=0;o<n;++o)t[o].filterIn(!0);for(e.unselectAll(),o=0;o<n;++o)e.removeRoot(t[o],!0,!1)})})}},_loadContent:function(t,o,i){var r=this;if(null===f.container.contentView){var l=this._contentDiv,a=null;l&&(a=l.getElement(".xterm_viewmain")),widget.body.contentViewLoaderContainer=e.createElement("div",{class:"TerminologyEditor_contentView_loader"}).inject(a),f.setContainer("contentView",widget.body.contentViewLoaderContainer)}f.removeComponentToLoad("global","tree"),f.addComponentsToLoad("contentView",{content:""});var d=null;d=!0===widget.getValue("standalone")?Promise.resolve({isCSVroleAvailable:!0}):new Promise(function(e){c.checkRolesAvailability(function(t,o,n){e({isPAUroleAvailable:t,isPARroleAvailable:o,isCSVroleAvailable:n})})});var u=t.getID?t.getID():"",g=t.getType?t.getType():"",m=this._currentMode.loadContent({pid:u,type:g,content:-1,filterChildren:""});Promise.all([d,m]).then(function(l){var a=l[0].isPAUroleAvailable,d=l[0].isPARroleAvailable,c=l[0].isCSVroleAvailable,u=l[1];r.getPADTreeDocument().wrapInTransaction(function(){t.options.contentAvailable=!0;var l=u.contents;if(r._placeHolder&&r._placeHolder.getContent().remove(),0===u.contents.length&&r._addPlaceHolder(),void 0!==l){var g=[],m=[],h="read"===p.getCurrentModeType()&&!0===r.getCurrentMode()._isPageRefreshed;(!0!==u.inProgress||h)&&(r.removeNodesInContent(),h&&(r.getCurrentMode()._isPageRefreshed=!1));var y=[],v=[];l.forEach(function(t){if("read"===r.getCurrentModeType()||r._isTreeTaggerContentVisible(t.id)){var i=r._currentMode.convertData(t);!0!==d&&!0!==a&&!0!==c&&(i.children=null);var l=null;if(g.forEach(function(e){(e.id||e.getID())===i.resourceid&&(l=e)}),null===l){i.grid&&(i.grid.bi_color="rgba(0, 0, 0, 0)");var u=i.icons&&i.icons.length>0?i.icons[0]:"";i.icons="object"==typeof u?[u]:[{iconPath:"url("+u+")"}];var p=new n(i);if(i.nodeAttrs)for(var f in i.nodeAttrs)p[f]=i.nodeAttrs[f];if(p.options.grid.thumbnail=i.thumbnail?i.thumbnail:"",!p.plmType){var h=i.grid.type?i.grid.type:i.grid["ds6w:type"];s.isTerminology(h)?p.plmType="Terminology":s.isTerm(h)&&(p.plmType="Term")}p.id=i.resourceid,p.options.oldLabel=i.label,p._manageNLS=!0,(e.is(o,"array")?o.indexOf(i.resourceid)>=0:i.resourceid===o)&&v.push(p),y.push(p)}else{y.push(l);var T=!1;if(Array.isArray(l.getChildren())&&l.getChildren().length>0){var _=l.getChildren()[0];_.hasOwnProperty("isRelationsObjectGroupingNode")&&(T=_.isRelationsObjectGroupingNode)}T||m.push(l);var C=l.id||l.getID();(e.is(o,"array")?o.indexOf(C)>=0:C===o)&&v.push(l)}}}),y&&!0!==u.sorted&&y.sort(r._ascendingSortingRootNodeByTitle);var _="datagridview"===r.getActiveView()&&null!==r.getPADTreeListView();_&&r._listenEndUIRefreshEvent(y),r.addRootNodes(y),_||r._endRefreshView();var S=r.getPADTreeListView();if(S)S.getManager().reapplySortModel();v.length>0&&(v.forEach(function(e){e.select()}),i&&"add"===i.insertMode&&r._defaultEnableNameEdit(v[v.length-1]),1===v.length&&"datagridview"===r.getActiveView()&&r.getPADTreeListView().scrollToVisibleNode(v[0])),void 0!==i&&i.copylink&&0===v.length&&C.displayNotification({message:T.msg_warning_contentnotavailable,className:"warning"})}f.removeComponentToLoad("global","tree"),r._endLoadAndSelect(),r._endContentSelect()})}).catch(this._manageException.bind(this,t))},_manageException:function(e,t){if(this._logger.log("WebService content, Err : "+(t&&t.stack?t.stack:"unknown")),this._endContentSelect(),this.removeNodesInContent(),t){if(!t.message){var o,n,i,r=t.err,l=t.serverErr,a="error";"timeout"===r.type?(n=T.msg_error_timeout.title,i=T.msg_error_timeout.subtitle):(this._currentMode.manageError&&(o=this._currentMode.manageError(l),a="warning"),o||e&&(e.options.contentAvailable=!1,n=T.msg_error_contentnotavailable.title,i=T.msg_error_contentnotavailable.subtitle,o=T.msg_error_contentnotavailable.message)),t={title:n,subtitle:i,message:o,className:a}}C.displayNotification(t)}this._endLoadAndSelect()},_switchNameToEdit:function(e){try{if("datagridview"===this.getActiveView()){var t=this.getPADTreeListView().getManager(),o=t.layout.getColumnIndex("tree"),n=t.layout.getCellsFromNodeModel(e)[o];t.scrollToCellAt({cellID:n});var i=t.getCellInfosAt(n);d._cellToRename={cellInfos:i,context:"CONTENT"},t.setCellInEdition(n)}}catch(e){}},_defaultEnableNameEdit:function(e){setTimeout(function(){this._switchNameToEdit(e)}.bind(this),1e3)},_manageSortForMultiColumns:function(){let e=this.getPADTreeListView();if(e){let o=e.getManager().sortModel;var t=a.getContentSortmodel();/*!TerminologySearch.isSearchActive() &&*/o.length!==t.length&&(e.getManager().sortModel=t)}return!1},loadContentAndSelect:function(e,t,o){if(S.setPCSEntry(widget.id+"_TerminologyContentLoad",!0),!this._manageSortForMultiColumns()){void 0===t&&(t=void 0!==this.nodeToSelectID?this.nodeToSelectID:t),this._handlerThumbnails&&this._handlerThumbnails.cancel(),this._handlerThumbnails=null;var n,r;e||(e=i.getCurrentTerminology()),e&&(e.getType&&(n=e.getType()),e.getID&&(r=e.getID())),s.inFamilyTerminology(n)&&r||"TerminologySection_AllTerminologies"===n?this._loadContent(e,t,o):(this.removeNodesInContent(),this._endLoadAndSelect())}},_endLoadAndSelect:function(){f.removeComponentToLoad("contentView","content"),widget.dispatchEvent("onLoadReady");var e=this.getPADTreeListView(),t=e?e.getManager():null;if(t&&(/*!TerminologySearch.isSearchActive() && */"read"!==this.getCurrentModeType()&&(this._componentScrollerPosition?t.setScrollerPosition(this._componentScrollerPosition):t.setScrollerPosition({x:0,y:0},!1)),this._componentScrollerPosition=null),void 0!==this.nodeToSelectID){var o=c.getContent().getPADTreeDocument().getNodesById(this.nodeToSelectID)[0];if(void 0===o)C.displayNotification({message:T.msg_error_contentnotavailable,className:"error"});else{var n=t.layout.getCellsFromNodeModel(o)[0];t.scrollToCellAt({cellID:n}),delete this.nodeToSelectID}}},_endContentSelect:function(){var e=this.getPADTreeListView(),t=e?e.getManager():null;t&&t.infiniteScrollProcessDone(),S.setPCSEntry(widget.id+"_TerminologyContentLoad",!1),S.sendPCSTracketPageEvent("TerminologyWidget_Performance","TerminologyContentLoad",widget.id+"_TerminologyContentLoad")},_listenEndUIRefreshEvent:function(e){var t=this,o=this.getPADTreeListView();new Promise(function(n,i){if("datagridview"!==t.getActiveView()||0===e.length)n();else{var r=function(){t.removeEvent("onToggleView",r),n()};t.addEvent("onToggleView",r),o&&o.getManager().onPostUpdateViewOnce(function(){if(t._currentMode.supportClientSort&&this.sortModel&&this.sortModel.length>0){var e=this.sortModel[0];e&&(this.sortModel=[{sort:e.sort,dataIndex:e.dataIndex}])}r()})}}).then(function(){t._endRefreshView()})},_endRefreshView:function(){this.dispatchEvent("onCompleteRefreshNodes",i.getCurrentTerminology().getID())},removeNodeInContent:function(e){var t=this.getPADTreeDocument();t.getRoots().forEach(function(o){(o.id||o.getID())===e&&t.removeRoot(o)})},switchTerminologyTreeNodeLabelToWriteView:function(e){var t=!1;return e instanceof v&&s.inFamilyTerminology(e.plmType)&&this.getPADTreeDocument()&&e.getTreeDocument()===this.getPADTreeDocument()&&(this._switchNameToEdit(e),t=!0),t},_sortingNodesContent:function(e){var t=this.getPADTreeListView();if(t&&e){var o=t.getManager(),n=o.sortModel;n&&n.length>0?o.reapplySortModel():o.sortModel=[{sort:"asc",dataIndex:"tree"}];var i=o.layout.getCellsFromNodeModel(e)[0];o.scrollToCellAt({cellID:i})}},_ascendingSortingRootNodeByTitle:function(e,t){return a.compareLabels(e.options.label,t.options.label)},_addPlaceHolder:function(){},getGridViewRowHeight:function(){let e=JSON.parse(x).settings.dgvOptions.value.dgvLayout.cellHeight,t=this.getPADTreeListView();return t&&(e=t.getRowHeight()),e},getContentHeight:function(){let e=0;if(document){let t=document.getElementsByClassName("xterm_viewmain");if(t&&t.length>0){let o=t[0].getElementsByClassName("wux-layouts-left-scroller-container");if(o&&o.length>0&&(e=o[0].clientHeight),!e){let o=t[0].getElementsByClassName("wux-layouts-body");o&&o.length>0&&(e=o[0].clientHeight)}}}return e},getCurrentMode:function(){return this._currentMode},setCurrentMode:function(e){this._currentMode=P[e]},getCurrentModeType:function(){return this._currentMode.getModeType()},getSpecficMode:function(e){return P[e]},processForInfiniteScroll:function(e,t){if(e.reachBottom){var o=0;if("read"===this.getCurrentModeType()&&this._currentMode.isInfiniteScrollingTobeDone()){var n=this.getCurrentMode(),i=this.getPADTreeDocument().getAllDescendants({onlyVisibleNodes:!0}).length;o=n.getInfoIndex().nhits===i?0:n.getNumberLastResult()}o>0&&this.loadContentAndSelect()}t.infiniteScrollProcessDone()}});return A}),define("DS/TerminologyEditor/views/TerminologyOrderCmd",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","DS/TerminologyEditor/utils/TerminologyEditorUtil","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/Controls/TooltipModel","DS/Menu/Menu","DS/TerminologyEditor/views/TerminologyMode"],function(e,t,o,n,i,r,l,a,s,d){"use strict";return t.extend(o,n,{_name:"terminology_orderTools",_defaultOptions:{sortMode:"alpha",sortOrder:"asc"},init:function(e){this._parent(e),this.sortMode=widget.getValue("sortMode")||this._defaultOptions.sortMode,this.sortOrder=widget.getValue("order")||this._defaultOptions.sortOrder,this.oldSelected=null,this._buildSkeleton()},_buildSkeleton:function(){var t=this;this.elements.container=e.createElement("div",{id:"terminology_orderTools"}),this._filterFonticon=e.createElement("i",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-filter terminology_fonticon_filter",title:r.fonticon_filter}).inject(this.elements.container),this._filterFonticon.hide(),this._dropDownMenu=e.createElement("i",{id:"bsd_orderby_menu_icon",class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-alpha-sorting-a-z terminology_fonticon_orderby sprite",title:r.alpha_sorting}).inject(this.elements.container),this._dropDownMenu.show(),this._dropDownMenu.addEventListener("click",function(e){var o=t._getMenuItems();s.show(o,{position:{x:e.target.getBoundingClientRect().left,y:e.target.getBoundingClientRect().bottom}})})},_getMenuItems:function(){var e="wux-ui-3ds wux-ui-3ds-1x ";e+="alpha"===this.sortMode&&"asc"===this.sortOrder&&null!==this.oldSelected?"wux-ui-3ds-alpha-sorting-z-a":"wux-ui-3ds-alpha-sorting-a-z";var t="wux-ui-3ds wux-ui-3ds-1x ";return t+="date"===this.sortMode&&"asc"===this.sortOrder?"wux-ui-3ds-date-sorting-31-1":"wux-ui-3ds-date-sorting-1-31",[{title:r.alpha_sort_label,type:"PushItem",fonticon:{content:e},tooltip:r.alpha_sorting,action:{this:this,callback:this.toggleButton,context:{sortMode:"alpha"}}},{title:r.date_sort_label,type:"PushItem",fonticon:{content:t},tooltip:r.date_sorting,action:{this:this,callback:this.toggleButton,context:{sortMode:"date"}}}]},_getMenuIcon:function(e,t){return"alpha"===e?"asc"===t?"wux-ui-3ds wux-ui-3ds-1x terminology_fonticon_orderby sprite wux-ui-3ds-alpha-sorting-a-z":"wux-ui-3ds wux-ui-3ds-1x terminology_fonticon_orderby sprite wux-ui-3ds-alpha-sorting-z-a":"asc"===t?"wux-ui-3ds wux-ui-3ds-1x terminology_fonticon_orderby sprite wux-ui-3ds-date-sorting-1-31":"wux-ui-3ds wux-ui-3ds-1x terminology_fonticon_orderby sprite wux-ui-3ds-date-sorting-31-1"},toggleButton:function(e){var t=e.context.sortMode;if(this.sortOrder=this.oldSelected===t?"desc"===this.sortOrder?"asc":"desc":this._defaultOptions.sortOrder,this.oldSelected=t,this.sortMode=t,this._dropDownMenu.className=this._getMenuIcon(this.sortMode,this.sortOrder),"read"===d.getCurrentModeType()){var o=l.getTreeCont();o._indexModeforReadData.resetInfoIndex(),o._rootNodeTerminologies.collapse({updateView:!0}),o._rootNodeTerminologies.expand({updateView:!0})}else this.sortingNodesUnsensitiveCase();widget.setValue("sortMode",this.sortMode),widget.setValue("order",this.sortOrder)},getSortMode:function(){return this.sortMode},sortingNodesUnsensitiveCase:function(){var e=l.getTreeCont();e&&e._terminologies_TreeView&&(e._terminologies_TreeView.sortModel=[{dataIndex:"tree",sort:this.sortOrder}],e._terminologies_TreeView.reapplySortModel())},sortingChildrenNodes:function(e){var t=this,o=l.getTreeCont()._terminologies_TreeView;o.prepareUpdateView(),e.sortChildren({isRecursive:!0,sortFunction:function(e,o){return("asc"===t.sortOrder?1:-1)*t.mySortFunction(e,o)}}),o.pushUpdateView()},mySortFunction:function(e,t){if(e.isRoot()&&t.isRoot())return null;if("date"!==this.sortMode)return i.compareLabels(e.options.label,t.options.label);try{var o=new Date(e.options.modified),n=new Date(t.options.modified);return o>n?1:o<n?-1:0}catch(o){return e.options.modified<t.options.modified?-1:1}},setOrderToolAreaSelectable:function(e){e?this.elements.container.style.setProperty("cursor","pointer"):this.elements.container.style.setProperty("cursor","default")}})}),define("DS/TerminologyEditor/TerminologyTreeCont",["UWA/Core","UWA/Utils","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","UWA/Promise","DS/Logger/Logger","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/WebappsUtils/WebappsUtils","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/TerminologyEditor/Terminology_CSO","DS/IPClassifyUtil/bsd_utils/BSDCommandProxy","DS/IPClassifyUtil/IPClassifyAlert","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/TerminologyEditor/utils/TerminologyEditorEvents","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TerminologyEditor/service/TerminologyTypeService","DS/TerminologyEditor/commands/TerminologyCommands","DS/TerminologyEditor/Terminology_Clipboard","DS/IPClassifyUtil/IPClassifyModelEvents","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/utils/TerminologyCommunication","DS/TerminologyEditor/utils/TerminologyEditorKeyboardListener","DS/TerminologyEditor/views/TerminologyOrderCmd","DS/LifecycleServices/LifecycleServicesSettings","DS/TerminologyEditor/views/TerminologyTagger","DS/DataGridView/DataGridView","DS/Core/PointerEvents","DS/IPClassifyUtil/bsd_utils/BSDConfiguration","DS/DataGridView/DataGridViewLayout","DS/WidgetServices/WidgetServices","DS/TerminologyEditor/utils/TerminologyLoaderGlobal","DS/IPClassifyFindInContext/FindInTree","i18n!DS/TerminologyEditor/assets/nls/TerminologyFindInTree","DS/TerminologyEditor/utils/TerminologyNavigateUtil_Read","DS/TerminologyEditor/views/TerminologyMode","text!DS/TerminologyEditor/assets/TerminologyEditorConf.json","DS/TerminologyEditor/dataProvider/TerminologyFindInDataProvider"],function(e,t,o,n,i,r,l,a,s,d,c,u,g,m,p,f,h,y,T,v,_,C,S,E,w,b,D,I,x,P,A,N,M,R,O,V,U,L,F){"use strict";var W=new E,B=d.getWebappsAssetUrl("TerminologyEditor","icons/22/I_Browsing_Structure_22.png"),k={iconName:"browsing-structure-node",fontIconFamily:1},j={iconName:"browsing-structure-root",fontIconFamily:1};function z(e){return e._modelEvents}var G=o.extend(n,i,{name:"TerminologyTree_Cont",time_to_expand_node:1500,_terminologies_TreeDocument:null,_terminologies_TreeView:null,_logger:null,_terminologyContentView:null,_commandProxy:null,_rootNodeTerminologies:null,_terminologies_SortElmt:null,_currentDragEnterTerminology:null,_timerDragEnter:null,propIDCard:"not initialized!",defaultOptions:{limitExpand:2e3},init:function(t){var o=this;this._parent(t),this._terminologyStructurePreference.options=this.options,this.elements.container=e.createElement("div",{class:this.getClassNames()+"_container"});var n=widget.getValue("useIndexAcceleration")?U.getCurrentModeType():"authoring";U.setCurrentModeType(n),this.refreshMap=C.getMapforPreferenceRefresh(),this._donNotApplyFilterForRead=!1,b.app_initialization(function(){o._buildUI()}),_.getModelEvents().subscribe({event:"select_breadcrumb_object"},({id:e,type:t,name:o})=>{this.expandTreeAndSelectTerminology({terminologyToFindAndSelect:{ids:[e],type:t,name:o},onComplete:function(e){console.log(" expandTreeAndSelectTerminology:onComplete")},onGiveUp:function(e){console.log(" expandTreeAndSelectTerminology:onGiveUp")},onFailure:function(e){m.displayNotification({title:h.replace(h.msg_error_TerminologyActivate.title,{name1:o}),subtitle:h.msg_error_TerminologyActivate.subtitle,className:"error"})}})})},_buildUI:function(){this._rootServiceHandler=null,this._logger=l.getLogger(G);var t=this;this._commandProxy=g.create({events:{onRefresh:t._onRefresh.bind(t)}}),f.onTerminologyRename(function(e){var o=e.getID(),n=e.getLabel();t.updateNodeLabel(o,n)}),S.subscribe("TerminologyEditor.RequestCurrentTerminology",function(){p.dipatchSecurityContextAndTerminology()}),f.onCurrentTerminologyChange(function(e){if(t._terminologyStructurePreference.select(this.pathId),this.id&&""!==this.id&&y.inFamilyTerminology(this.plmType)){for(var o=u.getCurrentTerminologyPath(),n=[],i=Array.isArray(o)?o.length:0,r=0;r<i-1;r++)n.push({resourceid:o[r].id,type:o[r].type});var l={};if(i>=1){var a=i-1;o[a].id&&(l[o[a].id]={type:o[a].type,label:o[a].label})}e.currentNode&&!y.isSection(e.currentNode.getType())&&[e.currentNode],t._commandProxy.select({paths:[[this.id]],attributes:l,terminologyPath:n,doNotSetOnCompass:!0}),require(["DS/IPClassifyUtil/IPClassifyCommunication"],function(t){if(!0===widget.getValue("noCompass")){var o={id:e.currentNode.getID(),label:e.currentNode.getLabel(),type:e.currentNode.options.type};t.publish("selectedTerminologyInTree",o)}})}else"TerminologySection_AllTerminologies"===this.plmType&&t._commandProxy.select({paths:[],attributes:{},terminologyPath:[],doNotSetOnCompass:!0});t._scrollOnPostUpdateView(e.currentNode),p.dipatchSecurityContextAndTerminology()}),t._buildSkeleton(),t._terminologies_SortElmt=new w,t._terminologies_FindInTree=new R({dataProvider:F,isBookMarkWidget:!1}),t._commonToolSection=e.createElement("div",{class:"terminology-common-tool-Section",id:"terminology-common-tool-Section"}),N.isTouchDevice()&&t._commonToolSection.setAttributeNode(document.createAttribute("touch-mode")),t.getSortingContainer().inject(t._commonToolSection),t.getFindInTreeIcon().inject(t._commonToolSection),t._terminologies_FindInTree.getUI().inject(t._commonToolSection);var o=this._terminologies_TreeView?this._terminologies_TreeView.getTreeDocument():void 0;this._terminologies_TreeDocument=o,o&&(o.options.shouldBeEditable=p.shouldBeEditable,o.onNodeModelUpdate(p.onNodeModelUpdate),o._getTrueRoot().onPreExpand(this._onPreExpandTreeNode.bind(this)),o.getXSO().onChange(function(e){var o=t._terminologies_TreeDocument.getXSO().get();if(o&&o.length>0){var n=o[o.length-1];n.getID=n.getID?n.getID:function(){return this.id},n.getType||(n.getType=function(){return this.plmType});var i=u.getCurrentTerminology();if(i!==n){u.addInTerminologyCSO(n,"TREE")}}})),C.checkSecurityCTXandTenantInitialization(function(){b.app_initialization(function(){M.addComponentsToLoad("global",{tree:""}),M.removeComponentToLoad("global","widget");var e=d.getWebappsAssetUrl("TerminologyEditor","icons/32/I_Browsing_Structure_32.png"),o={useAsyncPreExpand:!0};o.label=h.name_Section_AllTerminologies,o.icons=[e],o.children=[],o.id="",o.plmType="TerminologySection_AllTerminologies",t._rootNodeTerminologies=t._createTreeNodeModel(o,t._terminologies_TreeDocument),t.dispatchEvent.call(t,"onReady"),t._terminologyStructurePreference.isExpanded(t._rootNodeTerminologies.pathId,e=>{e||M.removeComponentToLoad("global","tree")})})}),t._tagNavigator=new D,t._tagNavigator.setSelectedFiltersFromPref(),C.setTreeFilter(t._tagNavigator),f.onTreeFilterChange(function(e){t._applyFilterOnTerminologies(),t._updateFilterIconOnToolbox(e)}),f.onTaggerStatusChange(function(){t.manageTreeTaggerVisibility()})},manageTreeTaggerVisibility:function(){p.isTreeTaggerActive()?this._tagNavigator.activateTaggerProxy():this._tagNavigator.deactivateTaggerProxy()},_applyFilterOnTerminologies:function(e){if(this._tagNavigator)if(e)this._tagNavigator.isObjectVisible(e.getID())?e.show():e.hide();else if(this._terminologies_TreeDocument){if("read"===U.getCurrentModeType())return this._donNotApplyFilterForRead?(this._indexModeforReadData.resetInfoIndex(),this._terminologies_TreeDocument.getRoots()[0].removeChildren(),void this._populateRootTerminology()):void(this._donNotApplyFilterForRead=!0);for(var t=this._terminologies_TreeDocument.getRoots(),o=u.getCurrentTerminology(),n=[],i=null,r=0;r<t.length;++r)t[r]&&(n=n.concat(t[r].getChildren()),o&&-1!==o.pathId.indexOf(t[r].plmType)&&(i=t[r]));o&&!this._tagNavigator.isObjectVisible(o.getID())&&i&&i.select({onlyUI:!0})}},_getIcon:function(e){var t=e.icon,o=e.type;return y.isTerminology(o)?t=j:y.isTerm(o)&&(t=k),t||B},_refreshNodes:function(e){var t=this;this._terminologies_TreeDocument.withTransactionUpdate(function(){for(var o=0;o<e.length;o++)t.updateNodeLabel(e[o])})},_getAllRoots:function(){var e=this._terminologies_TreeDocument.getRoots(),t=[];return e.forEach(function(e){"TerminologySection_AllTerminologies"===e.plmType&&(t=e.getChildren())}),t},_onRefresh:function(t){if(t&&t.authored&&(t.authored.modified&&e.is(t.authored.modified,"array")&&this._refreshNodes(t.authored.modified),t.authored.deleted&&e.is(t.authored.deleted,"array")&&t.authored.deleted.length>0)){var o=this._getAllRoots(),n=!1;o.every(function(e){return!(n=!!e&&t.authored.deleted.indexOf(e.id)>=0)}),n?this.refreshTerminologyTreeAndContent(t.authored.deleted):this._refreshNodes(t.authored.deleted)}},render:function(){return this},destroy:function(){this._logger.log("destroy"),this._parent()},_onContextualEvent:function(e){var t=this;if(e&&e.cellInfos)return e.cellInfos.nodeModel.select(),new r(function(o){t.__onContextualMenuReady(e).then(function(e){o(e)})})},_buildSkeleton:function(){var t=this;this.elements.container=e.createElement("div",{class:this.getClassNames()+"_container"}),this.getOption("css_view_class")&&this.elements.container.addClassName(this.getOption("css_view_class")),this.elements.terminologyTreeView_container=e.createElement("div",{class:this.getClassNames()+"_treeview_container"}).inject(this.elements.container);var o=e.clone(P.getConfig("dgvOptions")),n=o&&o.dgv?o.dgv:{};n.selectionBehavior.toggle=N.isTouchDevice(),n.selectionBehavior.unselectAllOnEmptyArea=!1,n.infiniteScrolling=!0,n.onContextualEvent=t._onContextualEvent.bind(t),n.rowSelection="single",n.showRowBorderFlag=!1,n.columns=[{dataIndex:"tree",sortableFlag:!1,typeRepresentation:"string",getCellEditableState:function(e){return!0!==widget.launchWithReadMode&&(e&&e.nodeModel&&y.inFamilyTerminology(e.nodeModel.plmType))},editionPolicy:"DelayedEditionOnClick",setCellValue:function(e,t){if(e.nodeModel){var o=e.nodeModel;require("DS/TerminologyEditor/commands/TerminologyCommands")._cellToRename={cellInfos:e,context:"TREE"},o.getTreeDocument().withTransactionUpdate(function(){var e={};e.label=t,e.display=t,e.oldLabel=o.options.label,o.updateOptions(e)})}},compareFunction:function(e,o,n,i,r){return t._terminologies_SortElmt.mySortFunction(n,i)},onCellRequest:function(e){e.isHeader||(e.nodeModel&&e.nodeModel.options.isBeingCut?e.cellView.getContent().addClassName("terminology-state-is-being-cut"):e.cellView.getContent().removeClassName("terminology-state-is-being-cut")),this.defaultOnCellRequest(e)}}];var i=e.extend({identifier:"DataGridView-"+t.name+"-"+widget.id},n),r=e.clone(o.dgvLayout);i.layout=new A(r),i.layout.useLastColumnWidthAutoFlag=!0,i.layout.columnsHeader=!1;var l=new a;i.treeDocument=l,i.rowReorderEnabledFlag=!0,i.useAsyncPreExpand=!0;var s=new I(i).inject(this.elements.terminologyTreeView_container);this._terminologies_TreeView=s;["esc","del","ctrl+f","alt+return","f2","ctrl+x","ctrl+v"].forEach(function(e){s._keymapManager.registerKeymap(e,void 0)}),s.setUseClipboardFlag(!1),s.onCopy=W.launchKeyAction.bind(W,"ctrl+c"),s.onCut=W.launchKeyAction.bind(W,"ctrl+x"),s.onPaste=W.launchKeyAction.bind(W,"ctrl+v"),s.showAlternateBackgroundFlag=!1,s.treeNodeCellOptions.depthIncrement=14,s.treeNodeCellOptions.buildLinks=!0,s.treeNodeCellOptions.expanderStyle="triangle",s.selectNextCellOnEnterFlag=!1,s.onEndResizeOrOnReadyModelRequest(function(e){e.RowMaxNumber>=25&&e.RowMaxNumber>=s.getModelLength()&&(e.reachBottom=!0,t._processForInfiniteScroll(e,s)),s.EndResizeOrOnReadyModelRequestDone()}),s.onInfiniteScroll(function(e){t._processForInfiniteScroll(e,s)})},_processForInfiniteScroll:function(e,t){var o=this;if(e.reachBottom){var n=!1;if("read"===U.getCurrentModeType()){var i=this._indexModeforReadData.getInfoIndex(),r=this._indexModeforReadData.getNextStart(),l=i?i.nhits:null;isNaN(l)||(n=r<l)}n&&!this._indexModeforReadData.isInfiniteScrollingInProcess()&&(this._indexModeforReadData.setInfiniteScrollingStatus(!0),this._populateRootTerminology(function(){o._indexModeforReadData.setInfiniteScrollingStatus(!1)},!0))}t.infiniteScrollProcessDone()},_populateRootTerminology:function(e,t){t="boolean"==typeof t&&t,M.addComponentsToLoad("global",{tree:""}),this._rootNodeTerminologies.expand({updateView:!0,doNotRemoveNodes:t,explicitMethodToBeExecuted:e})},escape:function(){this._terminologies_TreeView.commands.escape.bind(this._terminologies_TreeView)()},_cancelRootServiceHandler:function(){this._rootServiceHandler&&this._rootServiceHandler.cancel(),this._rootServiceHandler=null},_preExpandDone:function(e){let t="partiallyExpanded"===e.getState();e.preExpandDone(),t?e.setState({state:"partiallyExpanded"}):"expanded"===e.getState()&&e.setState({state:"expanded"})},_onPreExpandTreeNode:function(e){setTimeout(this.__onPreExpandTreeNode.bind(this,e))},__onPreExpandTreeNode:function(e,t,o){var n=e.data.nodeModel;if(e.data.onlyUI)this._preExpandDone(n);else{var i,r,l=this;C.isCustomizedEnv(),l._terminologyStructurePreference.getExpandedChildren(e.parent.pathId,function(e){i=e}),l._terminologyStructurePreference.getExpandedChildren(e.parent.pathId,function(e){r=e},!0,e.data&&!0===e.data.updateView);var a="TerminologySection_AllTerminologies"===n.plmType;a&&(this._cancelRootServiceHandler(),!0!==e.data.doNotRemoveNodes&&this._indexModeforReadData.resetInfoIndex());var s=n.getNodeDepth(),d={pid:n.id,level:e.data.expandLevel,expandList:i,partialExpandList:r,isRoot:a,isTerminology:"Terminology"===n.plmType,onComplete:function(t){if((t=JSON.parse(t)).error)return m.displayNotification({message:t.error.message,className:"error"}),n.loadHasFailed=!0,l._preExpandDone(n),void n.collapse();!0!==e.data.doNotRemoveNodes&&n.removeChildren();var o=void 0!==t.terminologies?t.terminologies:t.member,d=void 0!==o?o:[],c={0:n},g=[],p=[].concat.apply([],r),f=a?"root":n.getID();if(p.indexOf(f)>=0&&g.push(n),d.forEach(function(t){var o={useAsyncPreExpand:!0};o.label=void 0!==t.label?t.label:t.title,o.icons=[l._getIcon(t)],o.children=[],o.id=t.id,o.mxid=t.mxid,o.created=t.created,o.modified=t.modified,o.plmType=t.type,o.type=t.type,o.terminologyClassification=t.terminologyClassification;var a=t&&t.level?parseInt(t.level):1;if(1===a&&"TerminologySection_AllTerminologies"===n.plmType){var s=l._getIcon(t);o.icons=[s],o.plmType="Terminology"}if(c[a]=l._createTreeNodeModel(o,c[a-1]),"Terminology"===o.plmType&&l._applyFilterOnTerminologies(c[a]),!e.data.expandLevel)if(-1!==i.indexOf(o.id))c[a].expand({onlyUI:!0});else if(-1!==p.indexOf(o.id))for(var d in r)if(-1!==r[d].indexOf(o.id)){r[d].indexOf(o.id)!==r[d].length-1&&(c[a].expand({onlyUI:!0}),g.push(c[a]));break}}),n.loadHasFailed=!1,l._preExpandDone(n),e.data.expandLevel>=0&&d.length>0){var y={onlyUI:!0,initialLevel:s,expandLevel:e.data.expandLevel,clearLast:e.data.clearLast};0===e.data.expandLevel?(y.expandAll=!0,n.expandNLevels(y)):(y.numberOfLevelsToExpand=e.data.expandLevel,n.expandNLevels(y))}if(g.forEach(function(e){e.setState({state:"partiallyExpanded"})}),l._terminologies_SortElmt.sortingNodesUnsensitiveCase(),n.options.children=null===n.options.children?[]:n.options.children,e.data.explicitMethodToBeExecuted&&e.data.explicitMethodToBeExecuted(),!l.isInitialized&&(l.isInitialized=!0,l._terminologies_TreeDocument.getXSO().isEmpty()&&"read"===U.getCurrentModeType()))if(C.getTreeFilter().isFilterSet())l._rootNodeTerminologies.select();else if(l._terminologyStructurePreference.getSelection().length>0){var T=l._terminologyStructurePreference.getSelection().split(","),v=T[T.length-1];V.getNavigateDataforTerminology({pids:[v],onComplete:function(e){var t=JSON.parse(e);if(t.error)l._rootNodeTerminologies.select();else{for(var o=t[v],n=l._rootNodeTerminologies,i=null,r=0;r<o.length;r++){var a=o[r],s={useAsyncPreExpand:!0};s.label=a.label,s.children=[],s.id=a.id,s.mxid=a.mxid,s.plmType=a.type,s.created=a.created,n=l._createTreeNodeModel(s,n),0===r&&(i=n)}u.addInTerminologyCSO(n,"TREE"),i.remove(),l._terminologyStructurePreference.add(i.pathId),m.displayNotification({message:h.replace(h.get("msg_warning_TerminologyNotVisibleinTree"),{name:n.getLabel()}),className:"warning"})}},onFailure:function(e){l._rootNodeTerminologies.select()}})}M.removeComponentToLoad("global","tree")},onFailure:function(t){e.data.explicitMethodToBeExecuted&&e.data.explicitMethodToBeExecuted(),n.loadHasFailed=!0,l._preExpandDone(n),l._logger.log("WebService terminologies Err : "+t),M.removeComponentToLoad("global","tree")}};"read"===U.getCurrentModeType()?(d.indexMode=!0,c.terminologyTree(d)):(d.indexMode=!1,c.terminologyTree(d),l._indexModeforReadData.resetInfoIndex())}},updateTreeWithNewTerminology:function(e){var t,o=this,n=this._rootNodeTerminologies;n&&n.isAscendantOf(e)?e.isVisible()&&(t=e):t=n===e?e:o._getVisibleNodeById(e.id,null),t&&c.terminologyTree({isRoot:"TerminologySection_AllTerminologies"===t.plmType,pid:t.id,onComplete:function(e){e=JSON.parse(e),"TerminologySection_AllTerminologies"===t.plmType?(o.refreshTreeWithServerData(e.member,"Terminology",t),o._tagNavigator.removeFilters()):o.refreshTreeWithServerData(e.member,"Term",t)},onFailure:function(e){o._logger.log("WebService terminologies Err : "+e)}})},refreshTreeWithServerData:function(t,o,n){var i,r,l=p.generateJSON(t),a=n.getChildren().slice(0),s=0;for(e.is(a)&&(s=a.length),i=0;i<s;++i)l[(r=a[i]).id]||this.removeFromTree(r),delete l[r.id];for(var d in l){r=l[d];var c={useAsyncPreExpand:!0},u=this._getIcon(r);c.label=r.label,c.icons=[u],c.children=[],c.id=d,c.mxid=r.mxid,c.plmType=o,c.created=r.created,c.terminologyClassification=r.terminologyClassification,this._createTreeNodeModel(c,n)}this._terminologies_SortElmt.sortingNodesUnsensitiveCase()},removeFromTree:function(e){if(e){var t,o,n=this._rootNodeTerminologies;n&&n.isAscendantOf(e)?e.isVisible()&&(t=e,o=e.getParent()):(t=this._getVisibleNodeById(e.id,null),o=t?t.getParent():null),o&&t&&(!0===o.hasChildren()&&o.removeChild(t),!1===o.hasChildren()&&(o.withTransactionUpdate(function(){o.setState({state:"collapsed"})}),o.options.children=[]))}},updateNodeLabel:function(t,o){var n=this,i=[],r=e.is(t,"string")?t:t.physicalid?t.physicalid:null;i=r?this._getNodesById(r):[t];var l=function(t){var o=u.getCurrentTerminologyID();i.forEach(function(n){if(n.getLabel()!==t){n._lastUpdateTime=Date.now();var r=e.extend(n.options,{label:t,oldLabel:t},!0);n.withTransactionUpdate(function(){n.updateOptions(r)})}1===i.length&&o===i[0].getID()&&(u.updateLabelCurrentTerminologyPath(),C.getIdCardCont().setCurrentLocation(),e.is(widget)&&widget.setTitle(n.getLabel()))})};if(i.length>0)if(o)l(o),this._terminologies_SortElmt.sortingChildrenNodes(i[0].getParent());else if(e.is(i[0].getID,"function")){let t=i[0];var a=t.getID();c.getTerminologyProperties({pid:a,onComplete:function(o){if(e.is(o,"string")&&(o=JSON.parse(o)),!o.id||p.hasDeniedAttributes(o))t.isSelected()&&t.getParent().select(),t.remove();else{var i=o.hasOwnProperty("label")?o.label:o.hasOwnProperty("title")?o.title:"";l(i),n._terminologies_SortElmt&&n._terminologies_SortElmt.sortingChildrenNodes(t.getParent())}},onFailure:function(){console.error("Unable to update Tree Label, Error in getting terminology Properties")}})}},_updateFilterIconOnToolbox:function(e){e?this._terminologies_SortElmt._filterFonticon.show():this._terminologies_SortElmt._filterFonticon.hide()},expandTreeAndSelectTerminology:function(e){var t=this,o=e&&e.hasOwnProperty("terminologyToFindAndSelect")?e.terminologyToFindAndSelect:void 0;void 0===o&&(o=e&&e.hasOwnProperty("folderToFindAndSelect")?e.folderToFindAndSelect:void 0);var n=o?o.ids:void 0,i=[],l=!0;if(e.findInTree&&l&&(this.findInTree=!0,e.findInTreeLoader.setMessage(O.loader.formulatingPaths),e.findInTreeLoader.loader.addEventListener(x.POINTERHIT,function(t){if(l=!1,e.onComplete){var n={terminologyToFindAndSelect:o,folderToFindAndSelect:o};e.onComplete(n)}})),n&&l){i=JSON.parse(JSON.stringify(n));for(var a=0;a<n.length;a++){var s=t._getVisibleNodeById(n[a],null);if(s){const o=i.indexOf(n[a]);o>-1&&i.splice(o,1);u.getCurrentTerminology();if(e.doNotSelectInTree?this.findInTree||u.addInTerminologyCSO(s,"TREE"):(t._scrollToVisibleNode(s),s.select(!0)),!l)break}}if(i.length>0&&l){var d=[],g=u.getCurrentTerminology(),p={pids:n,onComplete:function(n){if(!(n=JSON.parse(n)).error&&l){var i=Object.keys(n),a=function(s){r.allSettled(d).then(function(){var c=n[i[s]];if(e.findInTree){var m=s/i.length*100;e.findInTreeLoader.updateLoader(m.toString())}if(!c&&n.error&&(t._logger.warn("Unable to retrieve TerminologyPath using WebService"),e.onFailure))return e.onFailure(n.error);if(!function(e){var t=!1;if(u.getCurrentTerminology()!==g&&(t=!0,e.onGiveUp)){var o={terminologyToFindAndSelect:e.terminologyToFindAndSelect};e.onGiveUp(o)}return t}(e))if(t._rootNodeTerminologies){for(var p=null,f=null,T=t._rootNodeTerminologies,v=T.pathId,_=0;_<c.length;_++){var C=c[_],S=C.id;if(y.isTerm(C.type)?"Term":y.isTerminology(C.type)&&("Terminology",f=S),S){if(!p){var E=t._getVisibleNodeById(S,T);E&&E.isVisible()?(T=E,v=E.pathId):p=T}if(p){var w=v;t._terminologyStructurePreference.add(w,null,null,e.partiallyExpandPath),T=null,v=v+","+S}}else t._logger.log("unexpected undefined parentObjectId")}if(f)if(p){var b=w+","+i[s];e.doNotSelectInTree?(t._terminologyStructurePreference.select(""),t._terminologyStructurePreference.scrollAfterSelect(""),t._TreeNodeToBeAddedtoTerminologyCSOWithoutSelection_pathId=b):(t._terminologyStructurePreference.select(b),t._terminologyStructurePreference.scrollAfterSelect(i[s])),e.partiallyExpandPath?(t._terminologyStructurePreference.add(b),t._terminologyStructurePreference.remove(b)):t._terminologyStructurePreference.remove(b),"expanding"!==p.getState()&&l&&d.push(new r(function(e,t){try{p.expand({updateView:!0,postExpandResolvePromise:function(){e()}})}catch(e){console.log(e),t()}}))}else console.log("   Damnation, no firstUnexpandedTreeNodeModelParentFound");else e.onFailure&&e.onFailure(new Error(h.msg_error_NoVisibleRootTerminology.title,h.msg_error_NoVisibleRootTerminology.subtitle))}else t._logger.log("  No TerminologySection_AllTerminologies to start expandTreeAndSelectTerminology"),e.onFailure&&e.onFailure(new Error(h.msg_error_TreeExpandCancelledNotReady.title,h.msg_error_TreeExpandCancelledNotReady.subtitle));s!==Object.keys(n).length-1&&l?a(s+=1):r.allSettled(d).then(function(){if(e.onComplete&&l){var t={terminologyToFindAndSelect:o,folderToFindAndSelect:o};e.onComplete(t)}})})};l&&a(0)}else if(t._logger.warn("Unable to retrieve TerminologyPath using WebService"),e.onFailure&&n.error)return e.onFailure(n.error)},onFailure:function(e){C.checkRolesAvailability(function(e,t,o){!0===e||!0===t||!0===o?m.displayNotification({title:h.msg_error_terminologyPath.title,subtitle:h.msg_error_terminologyPath.subtitle,message:h.msg_error_terminologyPath.message,className:"error"}):m.displayNotification({title:h.msg_error_terminologyPath_roles.title,subtitle:h.msg_error_terminologyPath_roles.subtitle,message:h.msg_error_terminologyPath_roles.message,className:"error"})})}};"read"===U.getCurrentModeType()?V.getNavigateDataforTerminology(p):c.getTerminologyPath(p)}else if(e.onComplete){var f={terminologyToFindAndSelect:o,folderToFindAndSelect:o};e.onComplete(f)}}else t._logger.log("expandTreeAndSelectTerminology error : terminologyToFindAndSelect is undefined"),e.onFailure&&e.onFailure(new Error("Tree exploration stopped, terminologyToFindAndSelect is undefined"))},_getNodesById:function(t,o){var n=[],i=[],r=this;o?n=[o]:r._terminologies_TreeDocument.getRoots().forEach(function(e){e&&n.push(e)});return n.forEach(function(o){o.getID()===t&&i.push(o);var n=o.getChildren();e.is(n,"array")&&n.forEach(function(e){r._getNodesById(t,e).forEach(function(e){i.push(e)})})}),i},_getVisibleNodeById:function(e,t){var o=t||this._rootNodeTerminologies,n=null;if(o&&o.isVisible())if(o.getID()===e)n=o;else if(o.isExpanded()){var i=o.getChildren();if(Array.isArray(i)&&i.length>=1)for(var r=0;r<i.length;r++){var l=i[r];if(l){if(l.id===e){n=l;break}var a=this._getVisibleNodeById(e,l);if(a&&a.isVisible()){n=a;break}}}}return n},_terminologyStructurePreference:{_prefixes:["_X_","_P_"],_partialExpandPrefix:"_P_",_getID:function(e,t){if(e[t])return e[t];for(var o=0;o<this._prefixes.length;++o){var n=e[this._prefixes[o]+t];if(n)return n}return null},_getPreferenceID:function(e,t){if(e[t])return t;for(var o=0;o<this._prefixes.length;++o)if(e[this._prefixes[o]+t])return this._prefixes[o]+t;return t},_scrollToNode:function(){return"scrollToNode - "+N.getTenantID()},_getPreferenceTree:function(e){return e||(e={}),e},_getStoredTerminologyTreeStructure:function(){var e=widget.getValue("terminologyTreeStructure");try{e=e?JSON.parse(p.jsonUnzip(e)):{}}catch(t){e={}}return this._getPreferenceTree(e)},add:function(e,t,o,n){var i=this;function r(e,t){for(var o=0;o<i._prefixes.length;++o)if(e[i._prefixes[o]+t])return e[t]=e[i._prefixes[o]+t],void delete e[i._prefixes[o]+t]}if(!o||!0!==o.isFailure){var l=this._getStoredTerminologyTreeStructure(),a=e.split(","),s=l;a.forEach(function(e,o){s[e]||s[i._partialExpandPrefix+e]?!1===t&&(r(s,e),o===a.length-1&&(s[e]={})):n?s["_X_"+e]?(s[i._partialExpandPrefix+e]=s["_X_"+e],delete s["_X_"+e]):s[i._partialExpandPrefix+e]={}:!function(e,t){for(var o=0;o<i._prefixes.length;++o)if(e[i._prefixes[o]+t])return!0;return!1}(s,e)?s[e]={}:r(s,e),o!==a.length-1||n||r(s,e),s=s[e]?s[e]:s[i._partialExpandPrefix+e]}),i.saveTerminologyStruture(l)}},remove:function(e,t){var o=this,n=this._getStoredTerminologyTreeStructure(),i=e.split(","),r=n,l=!1;i.forEach(function(e,n){r&&(n<i.length-1?(n===i.length-2&&r[o._partialExpandPrefix+e]&&(l=!0),r=o._getID(r,e)):(!t&&(r[e]&&Object.keys(r[e]).length>0||r[o._partialExpandPrefix+e]&&Object.keys(r[o._partialExpandPrefix+e]).length>0||l)&&(r["_X_"+e]=r[e]?r[e]:r[o._partialExpandPrefix+e]),t&&r["_X_"+e]?delete r["_X_"+e]:r[e]?delete r[e]:delete r[o._partialExpandPrefix+e]))}),o.saveTerminologyStruture(n)},isExpanded:function(e,t){var o=this,n=this._getStoredTerminologyTreeStructure(),i=e.split(","),r=!1,l=n;i.forEach(function(e,t){l&&t<i.length-1?l=o._getID(l,e):l&&(r=void 0!==l[e]||void 0!==l["_P_"+e])}),t.call(window,r)},recursive:function(e,t,o,n){var i=this;function r(e){return e.replace(i._partialExpandPrefix,"")}var l=null,a=e?Object.keys(e).length:0,s=0===o.length?[]:o[o.length-1];function d(e,t){var n=!!l?l:s;a>1&&!t&&(l=n.slice()),n=t?[]:n,o.indexOf(n)<0&&o.push(n),n.push(e)}for(var c in e){var u=-1!==c.indexOf(i._partialExpandPrefix),g=-1!==c.indexOf("_X_");if(e[c])if(n){var m=-1!==t.indexOf(i._partialExpandPrefix);g?m&&d(c.replace("_X_","")):(u?d(r(c),!m):m&&d(c),this.recursive(e[c],c,o,n))}else g||(u||o.push(r(c)),this.recursive(e[c],c,o,n))}},getExpandedChildren:function(e,t,o,n){var i=this,r=this._getStoredTerminologyTreeStructure(),l=e.split(","),a=[],s=r;l.forEach(function(e,t){if(s&&t<l.length-1)s=i._getID(s,e);else if(s){var r=i._getID(s,e),d=i._getPreferenceID(s,e),c=-1!==d.indexOf(i._partialExpandPrefix);if(o&&c&&n){var u=d.replace(i._partialExpandPrefix,"");u="TerminologySection_AllTerminologies"===u?"root":u,a.push([u])}i.recursive(r,d,a,o)}}),t.call(window,a)},saveTerminologyStruture:function(e){if(e&&e.root&&e.root.e&&(e={}),e=JSON.stringify(e),e=p.jsonZip(e),!1!==widget.getValue("expandSaveLimitation")&&e.length>this.options.limitExpand){let e=h.get("msg_warning_expandSaveLimitation");m.displayNotification({title:e.Title,subtitle:e.Advice,message:e.Details,className:"warning",id:"expandLimitation",debounce:!0})}else widget.setValue("terminologyTreeStructure",e)},select:function(e){var t=p.jsonUnzip(widget.getValue("terminologyTreeSelectedNode")||"{}");(t=JSON.parse(t))[N.getTenantID()]=e,t=JSON.stringify(t),widget.setValue("terminologyTreeSelectedNode",p.jsonZip(t))},isSelected:function(e){return this.getSelection()===e},isSelectValuated:function(){return!!this.getSelection()},getSelection:function(){var e=p.jsonUnzip(widget.getValue("terminologyTreeSelectedNode")||"{}");return(e=JSON.parse(e))[N.getTenantID()]},scrollAfterSelect:function(e){widget.setValue(this._scrollToNode(),e)},doScrollAfterSelect:function(e){return widget.getValue(this._scrollToNode())===e}},_indexModeforReadData:{_indexInfo:null,_nextStart:0,_infinteScrollinginProcess:!1,isInfiniteScrollingInProcess:function(){return this._infinteScrollinginProcess},setInfiniteScrollingStatus:function(e){this._infinteScrollinginProcess=e},getInfoIndex:function(){return this._indexInfo},getNextStart:function(){return this._nextStart},setNextStart:function(e){this._nextStart=e},resetInfoIndex:function(){this._indexInfo=null,this._nextStart=0,this._infinteScrollinginProcess=!1},setInfoIndex:function(e){this._indexInfo=e||null}},_scrollOnPostUpdateView:function(e){var t=this,o=this._terminologies_TreeView?this._terminologies_TreeView:null;o&&o.onPostUpdateViewOnce(function(){t._terminologyStructurePreference.doScrollAfterSelect(e.getID())&&(t._scrollToVisibleNode(e),t._terminologyStructurePreference.scrollAfterSelect(""))})},_doScrolltotheSavedPosition:function(){var e=this._terminologies_TreeView;if(e._getScroller()){var t=p.getTreeViewScrollerPosition();void 0!==t.x&&null!==t.x&&void 0!==t.y&&null!==t.y&&e.setScrollerPosition(t)}},_createTreeNodeModel:function(e,t,o){var n=this,i=t instanceof a,r=new s(e);r.id=e.id,r.plmType=e.plmType,e.created&&(r.created=e.created),r._instanceType="TerminologyEditor/TreeNodeModel",r._loadingcounter=0,r.getID=function(){var e=this.id;return e&&""!==e||(e=this.plmType),e},r.getType=function(){return this.plmType},r.options.oldLabel=e.label,r.pathId=(i?"root":t.pathId)+","+r.getID(),r.onPostExpand(function(e){if(!e||!e.data||!0!==e.data.updateView&&!e.data.onlyUI||e.data.expandLevel){var t=!1;!1!==e.data.clearLast&&e.data.nodeModel.getNodeDepth()-e.data.initialLevel==e.data.expandLevel-1||(t=!0),n._terminologyStructurePreference.add(this.pathId,t,{isFailure:!0===this.loadHasFailed})}else e.data.postExpandResolvePromise&&e.data.postExpandResolvePromise()}),r.addEventListener("preCollapseAll",function(){n.deactivatePostCollapse=!0}),r.addEventListener("postCollapseAll",function(){n.deactivatePostCollapse=!1,n._terminologyStructurePreference.remove(this.pathId,!0)}),r.onPostCollapse(function(e){!0===n.deactivatePostCollapse||e.data.updateView||n._terminologyStructurePreference.remove(this.pathId)}),z(r).subscribe({event:"removeChild"},function(e){if(r.isExpanded()&&r.isVisible()){var t=e.nodeModel;!t&&e.data&&(t=e.data.nodeModel),t&&n._terminologyStructurePreference.remove(t.pathId)}}),z(r).subscribe({event:"addChild"},function(e){if(r.isExpanded()&&r.isVisible()){var t=e.nodeModel;!t&&e.data&&(t=e.data.nodeModel),t&&t._isExpanded&&n._terminologyStructurePreference.add(t.pathId)}}),i?t.addRoot(r):("partiallyExpanded"===t.getState()&&(n._terminologyStructurePreference.add(r.pathId),n._terminologyStructurePreference.remove(r.pathId),n._terminologyStructurePreference.add(t.pathId)),t.addChild(r,o));if(n._terminologyStructurePreference.isExpanded(r.pathId,function(e){var o;e&&(o="expand",i?r[o]({updateView:!0}):t.isExpanded()?("expand"!==o||!r.isExpanded()&&"expanding"!==r.getState())&&r[o]({onlyUI:!0}):z(t).subscribeOnce({event:"postExpand"},function(e){"expanding"!==r.getState()&&("partiallyExpanded"===r.getState()&&"expand"===o||r[o]({onlyUI:!0}))}))}),"TerminologySection_AllTerminologies"===e.plmType&&(n._terminologyStructurePreference.isSelectValuated()||n._terminologyStructurePreference.select(r.pathId)),n._terminologyStructurePreference.isSelected(r.pathId)){for(var l=r;null!==l&&!l.isVisible();)l=l.getParent();l===r?r.select():z(l).subscribeOnce({event:"postExpand"},function(e){n._terminologies_TreeDocument.getXSO().empty(),r.select()})}else r.pathId===n._TreeNodeToBeAddedtoTerminologyCSOWithoutSelection_pathId&&(this.findInTree||(u.addInTerminologyCSO(r,"TREE"),n._TreeNodeToBeAddedtoTerminologyCSOWithoutSelection_pathId=void 0));return r},__onContextualMenuReady:function(e){return new r(function(t){var o=e.cellInfos;o.cellView;if(o.cellModel){var n=u.getSelectedNodes(),i=[];n.length&&n.forEach(function(e){i.push(e)}),i.length&&i.forEach(function(e){e.unselect()});var r=!1;if(o.nodeModel)if(!1===o.nodeModel._isSelected&&(o.nodeModel._isSelected=!0,o.nodeModel.select(!0)),!0===o.nodeModel._isSelected)(o.nodeModel?o.nodeModel:o.cellModel)&&(r=!0);r?T.GetContextualMenu(o,"TREE",e).then(function(e){e&&t(e)}):t([])}else t([])})},refreshTerminologyTreeAndContent:function(e){var t=this.changeInPreference(),o=null;if(t.isPreferenceChangeCauseOfRefresh&&Object.keys(t.change).length>0)for(var n in t.change){if(!this.refreshMap.has(n)){o="allRefresh";break}1!==this.refreshMap.get(n)||(o="contentRefresh")}if(!t.isPreferenceChangeCauseOfRefresh||o){var i=C.getContent().getPADTreeListView(),r=i?i.getManager():null;r&&(C.getContent()._componentScrollerPosition=r.getScrollerPosition());var l=u.getCurrentTerminology();l.getType();if(!this._terminologyStructurePreference.isSelectValuated()||l&&e&&e.indexOf(l.id)>=0){l&&l.unselect(),this._terminologyStructurePreference.select("root,TerminologySection_AllTerminologies"),this._rootNodeTerminologies.select()}this._rootNodeTerminologies.isExpanded()?t.isPreferenceChangeCauseOfRefresh&&"contentRefresh"===o?l.pathId.contains("TerminologySection_AllTerminologies")&&C.getContent().loadContentAndSelect(l):(("TerminologySection_AllTerminologies"===l.plmType||!l.isVisible()&&l.pathId.contains("TerminologySection_AllTerminologies"))&&C.getContent().loadContentAndSelect(l),this._rootNodeTerminologies.collapse({updateView:!0}),this._rootNodeTerminologies.expand({updateView:!0})):("TerminologySection_AllTerminologies"===l.plmType||!l.isVisible()&&l.pathId.contains("TerminologySection_AllTerminologies"))&&C.getContent().loadContentAndSelect(l)}},switchTerminologyTreeNodeLabelToWriteView:function(e){try{var t=!1;if(e instanceof s&&y.inFamilyTerminology(e.plmType)&&e.getTreeDocument()===this._terminologies_TreeDocument&&this._terminologies_TreeView){var o=this._terminologies_TreeView;if(o){var n=o.layout.getColumnIndex("tree"),i=o.layout.getCellsFromNodeModel(e)[n];o.setCellInEdition(i),t=!0}}return t}catch(e){}},getSortingContainer:function(){return this._terminologies_SortElmt.elements.container},getFindInTreeIcon:function(){return this._terminologies_FindInTree.elements.container},_scrollToVisibleNode:function(e){var t=this._terminologies_TreeView,o=t.layout.getColumnIndex("tree"),n=t.layout.getCellsFromNodeModel(e)[o];t.scrollToCellAt({cellID:n})},modeChange:function(e){if(!1!==widget.getValue("compactModeForLeftSidebar")){var t=this._terminologies_TreeView.layout.cellHeight,o=t;if("comfortable"===e.viewMode)o=38;else{if("compact"!==e.viewMode)return;o=26}var n=o!==t;this._terminologies_TreeView.layout.cellHeight=o,n&&this._terminologies_TreeView.updateView(!0)}},changeInPreference:function(){return{change:widget.changeInPreference,isPreferenceChangeCauseOfRefresh:widget.refreshDuetoChangeInPreference}},activateTreeFilter:function(t){if(t!==N.getWidgetPreference("bsdActivateTreeFilter").value){N.getWidgetObject().setValue("bsdActivateTreeFilter",t);var o=C.getContent();t?(e.extendElement(o.elements.padshell._leftPanel).addClassName("TerminologyEditor_LeftView_Select"),e.extendElement(this._commonToolSection).addClassName("terminology-common-tool-Section_Select")):(e.extendElement(o.elements.padshell._leftPanel).removeClassName("TerminologyEditor_LeftView_Select"),e.extendElement(this._commonToolSection).removeClassName("terminology-common-tool-Section_Select")),f.notifyTaggerStatusChange()}},setOrderToolAreaSelectable:function(e){this._terminologies_SortElmt.setOrderToolAreaSelectable(e)},getGridViewRowHeight:function(){let e=JSON.parse(L).settings.dgvOptions.value.dgvLayout.cellHeight,t=this._terminologies_TreeView.layout;return t&&(e=t.getRowHeight()),e},getContentHeight:function(){let e=0;if(document){let t=document.getElementsByClassName("TerminologyTree_Cont-root_treeview_container");if(t&&t.length>0){e=t[0].clientHeight}}return e}});return G}),define("DS/TerminologyEditor/xTermDocument",["UWA/Core","DS/Logger/Logger","DS/i3DXCompassServices/i3DXCompassPubSub","DS/IPClassifyUXUtil/CredentialsView","DS/IPClassifyUtil/bsd_utils/BSDSettingsMgt","DS/WidgetServices/WidgetServices","DS/TreeModel/TreeDocument","DS/TerminologyEditor/models/xTermNodeModel","DS/IPClassifyUtil/bsd_utils/BSDPUWSAccess","DS/IPClassifyUtil/bsd_utils/BSDPredicateNls","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUtil/bsd_utils/BSDCommandProxy","DS/IPClassifyUtil/bsd_utils/BSDTransactionManager","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor"],function(e,t,o,n,i,r,l,a,s,d,c,u,g,m){"use strict";return l.extend(g,{_broadcastSelect:!0,_selected_paths:[],id:"mainNodeModel",_selection:[],_selectedIdx:null,_focusOn:!1,_reframeFocus:!1,_currentApp:null,_emptyFromProxy:!1,_isVolumeFilter:!1,init:function(o){var n=o||{},i=this;if(this._logger=t.getLogger("DS/TerminologyEditor/xTermDocument"),i.renderTo=o.renderTo?o.renderTo:document.body,n.nodeModelClass=a,this._parent(n),this.options.viewport={graph:null,tree:null},this.forceSyncModel4TreeListView=function(){},this.addEvent("onTransactionEnd",function(e,t){t||(i.getModelEvents().publish({event:"setPathTags",context:i}),i.fromTransactionEnd=!0)}),!e.is(n.remove_broadcast)||!0===n.remove_broadcast){i._commandProxy=u.create({events:{onSelect:function(e,t){}}});var l=function(){i._doNotBroadcastSelect||(i._directSelection=!0,i._selected_paths=[],!0!==i.searchProgress&&i._commandProxy.select(i._buildSelectData()),i.broadcastSelect(i.getXSO().get())),0===i.getSelectedNodes().length&&!0!==i._focusOn&&!0!==i._reframeFocus&&(i._reframeFocus=!1,i._commandProxy.closePager({sharedID:r.getWidgetValue("x3dAppId")}))};this.getXSO().onPostAdd(function(){l(),i._focusOn=!1}),this.getXSO().onPostRemove?this.getXSO().onPostRemove(l):this.getXSO().onRemove(l),this.getXSO().onEmpty(function(){!1===i._emptyFromProxy?i._doNotBroadcastSelect=!1:i._emptyFromProxy=!1,l()}),this.getXSO().onPreEmpty(function(){!1===i._emptyFromProxy&&(i._doNotBroadcastSelect=!0)}),document.addEventListener("keyup",function(e){27===e.keyCode&&i.getXSO().empty()})}},broadcastSelect:function(e){if(e&&e.length>0){var t={objectId:e[0].getID(),envId:r.getTenantID(),contextId:n.getCredential(),serviceId:"3DSpace"};o.publish("setObject",t)}},prepareBroadcastSelect:function(){this._doNotBroadcastSelect=!0},pushBroadcastSelect:function(){!0!==this.searchProgress&&this._commandProxy.select(this._buildSelectData()),this.broadcastSelect(),this._doNotBroadcastSelect=!1},invalidateViewPort:function(){this.options.viewport={graph:null,tree:null,datagrid:null}},getNodesById:function(e){var t=[];return this.getRoots().forEach(function(o){var n=o.getNodesById(e);t=t.concat(n)}),t},getRoots:function(t){var o=this._parent();if(Boolean(t)&&e.is(this._getChildrenFilterInfo,"function")){var n=this._getChildrenFilterInfo();n&&e.is(n.childrenBeforeFiltering,"array")&&(o=n.childrenBeforeFiltering.slice(0))}return o},removeRoot:function(t,o){var n=this;if(this.wrapInTransaction(function(){n._doNotBroadcastSelect=!0,n.invalidateViewPort(),n.getRoots().indexOf(t)>=0&&n._parent(t),n._doNotBroadcastSelect=!1}),!e.is(o,"boolean")||!o){var i=this.getRoots().length;this.getModelEvents().publish({event:"onRemoveRoot",data:{pid:t.getID(),remainingRoots:i}});var r=null;this.getRoots().length>0&&(r=this.getRoots()[0]),this.getModelEvents().publish({event:"onRootAdded",data:{isremove:!0,added_node:r,nb_root:i}})}},searchRootById:function(e){for(var t,o=this.getRoots(!0),n=0;n<o.length;n++)if(o[n].options.resourceid===e){t=o[n];break}return t},refreshNodeById:function(t){var o=[],n=this,l=[],a=[],u=function(){o.forEach(function(t){var o=n.getNodesById(t);e.is(o,"array")&&o.forEach(function(e){var t=e.getParent();e.remove(),!1===t.hasChildren()&&(t.setState({state:"collapsed"}),t.options.children=[])})});var t=m.cannot_insert_branch;0!==a.length&&(t=m.cannot_access_after_changeowner),c.displayNotification({message:t,className:"error"})};if(o=e.is(t.created)?o.concat(t.created):o,e.is(t.modified)&&e.is(t.modified,"array")&&this.withTransactionUpdate(function(){t.modified.forEach(function(t){if(e.is(t,"object")){var i=t.physicalid;if(e.is(t.attributes,"array")){var r=require("DS/IPClassifyUtil/bsd_utils/BSDAttributeMgt");n.getNodesById(i).forEach(function(e){e.updateAttributes(t.attributes,r.getAvailableColumns()),d.updateNLS(e)})}else{if(-1===o.indexOf(i)){var s=n.getNodesById(i);s&&s.length>0&&(o.push(i),l.push(i))}"ownerChanged"===t.key&&a.push(i)}}else if(-1===o.indexOf(t)){var c=n.getNodesById(t);c&&c.length>0&&(o.push(t),l.push(t))}})}),o.length>0){var g=i.getWebAPI_Options("fetch");g.include_param_Attributes=!1,s.fetch({enopad_webapis:r.getWidgetPreferenceValue("enopad_webapis"),data:g,pids:o,onComplete:function(i){n.invalidateViewPort();var r=e.is(i,"string"),l=r?i.replace(/\\u0007/g,";"):i;(r?JSON.parse(l):l).results.length!==o.length&&(console.error("Inconsistent number of results"),u()),void 0!==t.onComplete&&t.onComplete()},onFailure:function(){u()}})}},deleteNodes:function(e){var t=this;this.wrapInTransaction(function(){t.withTransactionUpdate(function(){e.forEach(function(e){e.isRoot()&&t.removeRoot(e)})})})},_buildSelectData:function(){var e=[];e=this.getXSO().get();var t,o={paths:[],tenant:r.getTenantID()};o.attributes={},o.version="1.1";return t=function(e){var t=e.getID();this.attributes.hasOwnProperty(t)||(this.attributes[t]={type:e.options.type,label:e.options.label})}.bind(o),o.paths=e.map(function(e){return e.getOccurencePath(t)}),this._currentApp=r.getWidgetValue("x3dAppId"),o.sharedID=this._currentApp,o.focusOn=!1,o},applyActiveView:function(e){this.options.active_view=e},multiselect:function(e){var t=this.getXSO();this.prepareUpdate(),t.add(e),this.pushUpdate()},multiunselect:function(e){var t=this.getXSO();this.prepareUpdate(),t.remove(e),this.pushUpdate()},fillAttributesAsync4VisibleNodes:function(t,o){this.options.additionalColumnsModules=o;var n=this;function i(e,t){for(var o=0;o<n.options.additionalColumnsModules.length;o++){for(var i=n.options.additionalColumnsModules[o],r=i.getManagedColumnNames(),l={},a=0;a<r.length;a++)l[r[a]]=e.options.grid[r[a]];if(!0===i.toBeUpdated(l,e)){var s=i.getName(),d=t[s];d||(d={pids:[]},t[s]=d);var c=e.getID();d.pids.push(c)}}}if(this.options.additionalColumnsModules&&this.options.additionalColumnsModules.length){var r=this.getVisibleAdditionalColumns();r.length&&require(["UWA/Promise"],function(o){for(var l={},a=0;a<t.length;a++)i(t[a],l);for(var s=[],d=0;d<r.length;d++){var c=r[d],u=c.module.getName();if(l[u]){var g=new o(function(t){c.module.updateAttributes(l[u],function(o){var n=e.is(o,"string")?JSON.parse(o):o;t(n)})});s.push(g)}}s.length&&o.all(s).then(function(o){n.withTransactionUpdate(function(){t.forEach(t=>{var i=t.getID(),r={grid:{}},l=!1;o.forEach(e=>{if(e&&e.pids){var t=e.pids[i];if(t){l=!0;var o=t._root;if(o){for(var n in o)r[n]=o[n];delete t._root}for(var n in t)r.grid[n]=t[n]}}}),l&&t.updateOptions(function(t,o){var i=o;return e.is(n.filterAttributesForUpdate,"function")&&(i=n.filterAttributesForUpdate({node:t,node_opts:i})),i}(t,r))})})})})}}})}),define("DS/TerminologyEditor/utils/xTermCustoStorageOptim",["UWA/Core","DS/TerminologyEditor/utils/TerminologyEditorUtil"],function(e,t){"use strict";var o={dataIndex:void 0,text:void 0,isDraggable:!0,visibleFlag:!0,isHidden:!1,isSortable:void 0,type:void 0,isAdditionalColumn:void 0,xnav_options:{name:void 0,dataIndex:void 0,tree:void 0,hardcoded:void 0,exportable:{lock:!1,value:!0},layout:{removable:void 0,hidden:void 0,width:150,minWidth:void 0,maxWidth:void 0},kind:void 0}},n={dataIndex:void 0,text:void 0,isDraggable:!0,visibleFlag:void 0,sortableFlag:void 0,pinned:void 0,kind:void 0,isAdditionalColumn:void 0,customisation:{layout:{width:200,minWidth:50,maxWidth:300,removable:!0,pinEditable:!0},exportable:{lock:!1,value:!0},titleModified:void 0}};function i(t,o){var n={};if(void 0===o)n=t;else for(var r=Object.getOwnPropertyNames(t),l=0;l<r.length;l++)if(e.is(t[r[l]],"object")){var a=i(t[r[l]],o[r[l]]);Object.getOwnPropertyNames(a).length>0&&(n[r[l]]=a)}else t[r[l]]!==o[r[l]]&&"text"!==r[l]&&(n[r[l]]=t[r[l]]);return n}function r(t,o,n){var i={};if(void 0===t)i=o;else{for(var l=Object.getOwnPropertyNames(o),a=Object.getOwnPropertyNames(t),s=0;s<l.length;s++)if(e.is(o[l[s]],"object")){if("bi_color"!==n){var d=r(t[l[s]],o[l[s]],n);Object.getOwnPropertyNames(d).length>0&&(i[l[s]]=d)}}else void 0===t[l[s]]?i[l[s]]=o[l[s]]:i[l[s]]=t[l[s]];for(var c=0;c<a.length;c++)void 0===i[a[c]]&&(i[a[c]]=t[a[c]])}return i}return{convertCusto4Preference:function(e,r,l){var a={custoOptimized:!0,viewMode:e.viewMode,defaultCellHeight:e.defaultCellHeight,rowsHeader:e.rowsHeader,selectedTypes:e.selectedTypes,selectedExtensions:e.selectedExtensions,columnsOptimized:[],lang:widget.getValue("lang")};t.setContentSortmodel(e.sortModel),e.custoFromTree&&(a.custoFromTree=e.custoFromTree);for(var s=0;s<e.columns.length;s++){var d=e.columns[s],c=o;"datagridview"===l&&(c=n);var u=i(d,c);r[d.dataIndex]&&(u.text=d.text),a.columnsOptimized.push(u)}return a},convertPreference2Custo:function(i,l){var a={viewMode:i.viewMode,defaultCellHeight:i.defaultCellHeight,rowsHeader:i.rowsHeader,selectedTypes:i.selectedTypes,selectedExtensions:i.selectedExtensions,columns:[]},s=t.getContentSortmodel();a.sortModel=s,i.custoFromTree&&(a.custoFromTree=i.custoFromTree),i.lang&&i.lang!==widget.getValue("lang")&&function(e){for(var t=0;t<e.columnsOptimized.length;t++){var o=e.columnsOptimized[t];o.xnav_options&&o.xnav_options.titleModified&&(delete o.text,delete o.xnav_options.titleModified)}}(i);for(var d=0;d<i.columnsOptimized.length;d++){var c=i.columnsOptimized[d],u=o;"datagridview"===l&&(u=n);var g=r(c,e.clone(u),c.dataIndex);a.columns.push(g)}return a}}}),define("DS/TerminologyEditor/models/xTermDocumentRefresh",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/IPClassifyUtil/bsd_utils/BSDPUWSAccess","DS/WidgetServices/WidgetServices","DS/TerminologyEditor/utils/TerminologyEditorcontrol","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor.json"],function(e,t,o,n,i,r,l){"use strict";var a=t.extend({});return!0!==i.getWidgetPreferenceValue("refresh_v2")&&(a.prototype.refresh=function(t){var a=this,s=[],d=function(e){e&&0!==e.length||(e=[{msg:l.refresh_ok}]);for(var o=0;o<e.length;o++){var n=e[o];t.cb&&t.cb(n)}},c=(t=t||{}).roots||this.getRoots();if(c.length>0){var u=[],g=[];if(null!=c&&c.forEach(function(e){for(var t=[],o=[e];o.length;){var n=o.pop();if(null!=n)t.push(n.getOccurencePath()),n.getOccurencePath().forEach(function(e){g.indexOf(e)<0&&g.push(e)}),o=o.concat(n.getChildren())}u.push(t)}),0===u.length&&0===[].length)d();else{var m=[];if(u.length>0){var p=new o(function(t,o){var s,d={session:u,intent:"explore_2D",debug:i.getWidgetPreferenceValue("enopad_webapis_debug"),type_filter_bo:i.getWidgetPreferenceValue("type_filter_bo")};n.refresh({data:d,onComplete:function(o){if(void 0!==(e.is(o,"string")?JSON.parse(o):o)){s=a.startTransaction("refresh");var n=r.getContent().getPADTreeListView();if(n)n.getManager().reapplySortModel();a.invalidateViewPort(),s&&s.end()}t()},onFailure:o.bind(this,l.generic_service_failure)})});m.push(p)}o.all(m).catch(function(e,t,o){t=t||"Exception thrown during the process of the refresh answer "+(o?o.toString():""),e.push({msg:t,eventID:"error"})}.bind(this,s)).finally(function(){d(s)})}this.withTransactionUpdate(function(){for(var t=e.clone(c,!1);t.length;){var o=t.pop();null!=o&&(o.isSelected()&&o.unselect(),t=t.concat(o.getChildren()))}})}}),a}),define("DS/TerminologyEditor/TerminologyTreeDocument",["UWA/Core","DS/Logger/Logger","DS/TerminologyEditor/xTermDocument","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/service/TerminologyTypeService","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/TerminologyEditor/models/xTermDocumentRefresh","DS/Utilities/Utils","DS/TerminologyEditor/utils/TerminologyEditorcontrol"],function(e,t,o,n,i,r,l,a,s,d){"use strict";var c=o.extend(a,{name:"TerminologyTreeDocument",_doNotAddTerminology:!1,init:function(o){o.allowUnsafeHTMLContent=!1,o.insert=this.insert.bind(this),o.shouldBeEditable=l.shouldBeEditable,this._parent(o),this.onNodeModelUpdate(l.onNodeModelUpdate);var i=this;this._commandProxy&&this._commandProxy.addProxyEvents({events:{onRefresh:function(t){if((e.is(t.authored.created,"array")||e.is(t.authored.modified,"array"))&&i.refreshNodeById({created:t.authored.created,modified:t.authored.modified}),e.is(t.authored.deleted,"array")){var o=[];t.authored.deleted.forEach(function(e){o=o.concat(i.getNodesById(e))}),i.deleteNodes(o,!0)}}}}),this._logger=t.getLogger(c),this._logger.log("init");i=this;this.selection_broadcast_fn=s.debounce(function(){var e=d.getIdCardCont();if(e&&e.updateSelectionCount(i.getSelectedNodes().length),!i._doNotAddTerminology){var t=i.getXSO().get();if(t&&t.length>0){var o=t[0];o.getID||(o.getID=function(){return this.id}),o.getType||(o.getType=function(){return this.plmType})}n.addInTerminologyCSO(t,"CONTENT")}},100),this.getXSO().onChange(i.selection_broadcast_fn),this.getXSO().onEmpty(function(){i._doNotAddTerminology=!1,i.selection_broadcast_fn()}),this.getXSO().onPreEmpty(function(){i._doNotAddTerminology=!0})},_buildSelectData:function(){var e=this._parent();if(e){var t=n.getCurrentTerminology(),o=Array.isArray(e.paths)&&e.paths.length>=1;if(t&&i.inFamilyTerminology(t.plmType)){for(var r=n.getCurrentTerminologyPath(),l=[],a=Array.isArray(r)?r.length:0,s=0;s<a;s++)l.push({resourceid:r[s].id,type:r[s].type});if(!o){var d={};if(a>=1){var c=a-1;r[c].id&&(d[r[c].id]={type:r[c].type,label:r[c].label})}e.paths=[[t.id]],e.attributes=d}e.terminologyPath=l}}return e},prepareBroadcastSelect:function(){this._doNotAddTerminology=!0,this._parent()},pushBroadcastSelect:function(){this._doNotAddTerminology=!1,this.selection_broadcast_fn(),this._parent()},insert:function(e,t,o){return!1},deleteNodes:function(e){var t,o=e.length,i=!1;for(t=0;t<o;++t){if("noExpandState"!==e[t]._expandState){i=!0;break}}if(i){var r=n.getSelectedNodesID(),l=n.getCurrentTerminology();d.getContent().loadContentAndSelect(l,r)}else{this._parent(e),0===d.getContent().getObjectsInTree()&&d.getContent()._addPlaceHolder()}},refreshNodeById:function(t){var o,a=this,s=t.modified,c=[],u=!1,g=this.getRoots(),m=g.length;for(o=0;o<m;++o){var p=g[o],f=p.getID();if(i.inFamilyTerminology(p.plmType)){var h=s.indexOf(f);if(-1!==h)s.splice(h,1),c.push(f);else t.modified.forEach(function(e){if(e.physicalid===f){var t=e.key;t&&"ownerChanged"===t&&(u=!0),c.push(f);var o=s.indexOf(e);-1!==o&&s.splice(o,1)}})}}if(t.modified=s,u){var y=n.getCurrentTerminology(),T=n.getSelectedNodes(),v=[];T.forEach(function(e){v.push(e.getID())}),d.getContent().loadContentAndSelect(y,v)}else c.length>0&&c.forEach(function(t){r.getTerminologyProperties({pid:t,onComplete:function(o){if(e.is(o,"string")&&(o=JSON.parse(o)),l.hasDeniedAttributes(o))a.deleteNodes([a.getNodesById(t)],!0);else{var n=l.convertToExaleadDataFormat(o),i=a.searchRootById(t);i&&(i._resetting=!0,i.options.oldLabel=n.label,a.wrapInTransaction(function(){i.updateOptions(n),require("DS/IPClassifyUtil/bsd_utils/BSDPredicateNls").updateNLS(i)}))}},onFailure:function(){console.error("Unable to update Tree Label, Error in getting terminology Properties")}})}),this._parent(t)}});return c}),define("DS/TerminologyEditor/views/customize_views/TerminologyDGVParametrization",["UWA/Core","UWA/Class","UWA/Promise","DS/Utilities/Utils","DS/Core/PointerEvents","DS/TerminologyEditor/utils/xTermCustoStorageOptim","DS/IPClassifyUtil/bsd_utils/BSDConfiguration","DS/IPClassifyUtil/bsd_utils/BSDAttributeMgt","DS/IPClassifyUtil/bsd_utils/BSDDictionaryAccess","DS/TerminologyEditor/service/TerminologyServices","DS/TerminologyEditor/commands/TerminologyCommands","DS/TerminologyEditor/service/TerminologyTypeService","DS/TerminologyEditor/utils/ColorUtil","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/TerminologyEditor/utils/TerminologyEditorcontrol"],function(e,t,o,n,i,r,l,a,s,d,c,u,g,m,p){"use strict";function f(e,t,o,n,i){var r=u.inFamilyTerminology(o.plmType),l=u.inFamilyTerminology(n.plmType);if(r&&!l)return-1*this.reverseFactor;if(!r&&l)return 1*this.reverseFactor;var a=0;return"defaultSort"===i&&(a=(o.options.relationOrder?o.options.relationOrder:0)-(n.options.relationOrder?n.options.relationOrder:0),e=o.getAttribute("label"),t=n.getAttribute("label")),o&&o.options&&o.options.grid&&o.options.grid[i+"_SortKey"]&&(e=o.options.grid[i+"_SortKey"]),n&&n.options&&n.options.grid&&n.options.grid[i+"_SortKey"]&&(t=n.options.grid[i+"_SortKey"]),0===a?m.compareLabels(e,t):a}return t.extend({buildDGVOpts:function(t){var n=this;return t=t||{},new o(function(o){var i,d=function(t){var i=e.clone(l.getConfig("dgvOptions")),r=i&&i.dgv?i.dgv:{};if(t=e.extend(r,t),n.options.additionalColumnsModules){for(var d=[],c=0;c<n.options.additionalColumnsModules.length;c++)e.is(n.options.additionalColumnsModules[c].getAdditionalColumnsUXDGV,"function")&&(n.options.additionalColumnsModules[c].getAdditionalColumnsUXDGV(t.columns),d=d.concat(n.options.additionalColumnsModules[c].getManagedColumnNames()));var u=function(e){for(var t={},o=0;o<e.length;o++){var n=e[o];t[n.dataIndex]=void 0!==n.visibleFlag&&!n.visibleFlag}return t}(t.columns);d.length&&(function(e,t,o){for(var n=0;n<e.length;n++){var i=e[n];-1!==t.indexOf(i.dataIndex)&&(i.isAdditionalColumn=!0),void 0!==o[i.dataIndex]&&(i.visibleFlag=!o[i.dataIndex])}}(t.columns,d,u),function(e){for(var t=0;t<e.length;t++){var o=e[t],n=o.customisation;n&&n.layout&&o.visibleFlag!==!n.layout.hidden&&(n.layout.hidden=!o.visibleFlag)}}(t.columns))}else n.options.additionalColumnsModules=[];if(t.selectionBehavior.toggle=!1,t.infiniteScrolling=!0,t.onContextualEvent=n._onContextualEvent.bind(n),t.onDelayedModelDataRequest=n.options.context.updateAttributesDelayed.bind(n.options.context),n.options.callbacks){var m=Object.keys(n.options.callbacks);for(c=0;c<m.length;c++)t[m[c]]=n.options.callbacks[m[c]]}t.columns.forEach(function(e){"tree"===e.dataIndex&&(e.getCellKPIColor=g.getCellKPIColor.bind(g)),e.compareFunction=f,e.onCellRequest=function(e){if(!e.isHeader){e.nodeModel&&e.nodeModel.options.isBeingCut?e.cellView.getContent().addClassName("pad-state-is-being-cut"):e.cellView.getContent().removeClassName("pad-state-is-being-cut");var t=this.getColumnOrGroup(e.columnID);let o=n.options.dgv.layout.getDisplayedColumnsIndexes();if(o&&o.indexOf(e.columnID)>=0)for(let o=0;o<n.options.additionalColumnsModules.length;++o)if(n.options.additionalColumnsModules[o]._columnDataIndex&&n.options.additionalColumnsModules[o]._columnDataIndex[0]===t.dataIndex&&n.options.additionalColumnsModules[o].onCellRequest&&n.options.additionalColumnsModules[o].onCellRequest(e))return;t&&"boolean"===t.typeRepresentation&&(e.cellModel="string"==typeof e.cellModel?"TRUE"===e.cellModel:e.cellModel)}if(e.nodeModel){var o=e.nodeModel.options.icons;o&&o.length>0&&("string"==typeof o[0]?e.nodeModel.options.icons=[{iconPath:"url("+o[0]+")"}]:"object"==typeof o[0]&&(e.nodeModel.options.icons=[o[0]]))}this.defaultOnCellRequest(e)}}),s.updateColumnsWithNLS(t.columns,function(e){"success"===e.status&&(t.columns=e.columns),a.updateAttributesList(t.columns),n.completeDGVOptions(t).then(o)})};n.options.view_customization&&!0!==t.reset&&!0!==n.options.view_customization.custoFromTree?(!0===n.options.view_customization.custoOptimized&&(n.options.view_customization=r.convertPreference2Custo(n.options.view_customization,"datagridview")),(i=n.options.view_customization).columns=n.buildColumnsFromStorage(i.columns).then(function(e){i.columns=e,d(i)})):(i={},n.buildColumns("datagridview").then(function(e){i.columns=e.columns,d(i)}))})},completeDGVOptions:function(e){return o.resolve(e)},completeCB:function(){return o.resolve()},addColumnCB:function(e){var t=this;this.options.dgv.prepareUpdateView();var n=[];e.forEach(function(e){e&&e.convertInfos&&e.convertInfos.dimension&&(e.kind="string"),n.push(new o(function(o){a.addAvailableColumn(e.dataIndex,e).then(function(e){var n=t.buildColumnFromSetting(e);n&&(n.compareFunction=f,t.options.dgv.addColumnOrGroup(n),"thumbnail"===n.dataIndex&&(t.options.dgvLayout.cellHeight=80)),o()})}))}),o.all(n).then(function(){this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)}.bind(this))},removeColumnCB:function(t){var o=this;this.options.dgv.prepareUpdateView(),t.forEach(function(t){var n=e.is(t,"string")?JSON.parse(t):t,i=o.options.dgv.getColumnOrGroup(n.dataIndex);i&&void 0!==i.dataIndex&&(o.options.dgv.removeColumnOrGroup(n.dataIndex),"thumbnail"===n.dataIndex&&(o.options.dgvLayout.cellHeight=38,"compact"===o.options.viewMode&&(o.options.dgvLayout.cellHeight=26)),a.removeAvailableColumn(n.dataIndex))}),this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)},changeTitleCB:function(e,t){var o=this.options.dgv.getColumnOrGroup(e);o&&(this.options.dgv.prepareUpdateView(),o.text=t,o.customisation.titleModified=!0,this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0},!0))},changeDBAttributeCB:function(e){if(e&&0!==e.length){var t=this;this.options.dgv.prepareUpdateView(),e.forEach(function(e){var o=t.options.dgv.getColumnOrGroup(e.dataIndex);o&&void 0!==o.dataIndex&&(o.attrDBName=e.attrDBName)}),this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)}},changeVisibilityCB:function(e,t){this.options.dgvLayout.setColumnVisibleFlag(e,t,{isUserInteraction:!0})},changePinCB:function(e,t){this.options.dgvLayout.setColumnPinned(e,t,{isUserInteraction:!0})},moveColumnCB:function(e){if(e.move2perform){let t=e.move2perform.fromIndex?e.move2perform.fromIndex:e.move2perform.fromID,o=e.move2perform.toIndex?e.move2perform.toIndex:e.move2perform.toID;this.options.dgvLayout.moveColumn(t,o,{isUserInteraction:!0})}},changeDgvLayout:function(e){void 0!==typeof e.rowsHeader&&(this.options.dgvLayout.rowsHeader=e.rowsHeader)},changeExportCB:function(e,t){var o=this.options.dgv.getColumnOrGroup(e);o&&(o.customisation.exportable={lock:!1,value:t})},compactMode:function(e){"comfortable"===e.viewMode?(this.options.dgvLayout.cellHeight=38,this.options.viewMode="comfortable"):"compact"===e.viewMode&&(this.options.dgvLayout.cellHeight=26,this.options.viewMode="compact")},saveCustoView:function(e){var t=this;this._prepareOptsToStore({onComplete:function(o){var n=e?"onCustoViewChange":"onSaveAsTemplate";t.options.context.dispatchEvent(n,o)}})},reset:function(e){return new o(function(t){var o=this;delete o.options.view_customization,this.buildDGVOpts({reset:!0}).then(function(n){var i=l.getConfig("dgvOptions")?l.getConfig("dgvOptions"):{};o.options.dgv.prepareUpdateView(),i.dgvLayout&&(o.options.dgvLayout.cellHeight=i.dgvLayout.cellHeight),o.changePinCB(o.ctxColOpts.dataIndex,"right"),n.columns.push(o.ctxColOpts),o.ctxColOpts.visibleFlag=!0,o.options.dgvLayout.columns=n.columns,o.options.dgv.columns=n.columns,o.options.dgvLayout.deleteDataGridViewPreferences(),o.options.viewMode=i.viewMode;var r=p.getTreeCont();r&&r.modeChange({viewMode:o.options.viewMode}),o.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!1},!0),o.options.dgvLayout.applyColumns(),o.saveCustoView(e),t()})}.bind(this))},_onContextualEvent:function(e){return new o(function(t){c.getCtxMenu(e).then(function(e){t(e)})})},eventHandlerOnGridView:function(e){var t=this;return new o(function(o){e.addEventListener("click",function(e,o){if(void 0!==o&&-1!==o.rowID){var n=e.dsModel.layout.getDataIndexFromColumnIndex(o.columnID);if(t.options.clickEvent[n])t.options.clickEvent[n](o);else if(t.options.additionalColumnsModules&&!0===e.dsModel.layout.getColumnOptionValue(o.columnID,"isAdditionalColumn"))for(var i=0;i<t.options.additionalColumnsModules.length;i++){if(t.options.additionalColumnsModules[i].getOnCellClickCB){var r=t.options.additionalColumnsModules[i].getOnCellClickCB(n,e);if(r){r(o);break}}}}}),e.addEventListener("userPreferencesChange",function(e){t.saveCustoView(!0)}),e.addEventListener("columnWidthChange",function(e){if(e&&e.dsModel&&e.dsModel.layout&&t.options&&t.options.dgv&&t.options.dgv.layout&&t.options.dgv.model){let o=e.dsModel.layout.getDataIndexFromColumnIndex(e.options.columnID),n=t.options.dgv.layout.getDisplayedColumnsIndexes();if(n&&n.indexOf(e.options.columnID)>=0)for(let n=0;n<t.options.additionalColumnsModules.length;++n)if(t.options.additionalColumnsModules[n]._columnDataIndex&&t.options.additionalColumnsModules[n]._columnDataIndex[0]===o&&t.options.additionalColumnsModules[n].updateAttributesOnResize){let o=t.options.dgv.layout.getMinMaxVisibleRowIDs(),i=o.minRowID,r=o.maxRowID,l=[];(l=r>=0?t.options.dgv.model.slice(i,r+1):t.options.dgv.model.slice(i,r)).length>0&&t.options.additionalColumnsModules[n].updateAttributesOnResize(l,e.options.columnID);break}}}),e.addEventListener(i.POINTERHIT,function(e,t){if(2===e.multipleHitCount&&t&&-1!==t.rowID){var o=t.nodeModel;o&&d.activateTerminologyEditorItem(o.id,o.getType(),o.getLabel()),require(["DS/IPClassifyUtil/IPClassifyCommunication"],function(e){if(!0===widget.getValue("noCompass")){var t={id:o.getID(),label:o.getLabel(),type:o.options.type,cadMaster:o.options.grid["ds6w:cadMaster"],kind:o.options.grid["ds6w:kind"],contentStructure:o.options.grid["ds6w:contentStructure"]};e.publish("doubleClickonContentInTerminology",t)}})}}),t.completeCB(e).then(o)})},_prepareOptsToStore:function(e){var t=this;n.debounce(function(e){for(var o=t.options.dgvLayout.getOrderedColumnsIndexes(),n=[],i={},l=0;l<o.length;l++){var a=t.options.dgv.getColumnOrGroup(o[l]);"ContextualMenuColumn"!==a.dataIndex?(n.push(a),!0===a.customisation.titleModified&&(i[a.dataIndex]=!0)):t.ctxColOpts&&n.push(t.ctxColOpts)}var s={viewMode:t.options.viewMode,defaultCellHeight:t.options.dgvLayout.cellHeight,rowsHeader:t.options.dgvLayout.rowsHeader,columns:n,sortModel:t.options.dgv.sortModel},d=r.convertCusto4Preference(s,i,"datagridview");[].forEach(e=>n.push(e)),t.options.dgv.columns=n,e.onComplete(d)},500)(e)}})}),define("DS/TerminologyEditor/views/TerminologyDataGridView",["UWA/Core","UWA/Promise","UWA/Class","UWA/Class/Options","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/IPClassifyUtil/bsd_utils/BSDCommandProxy","DS/TerminologyEditor/views/customize_views/TerminologyDGVParametrization","DS/TerminologyEditor/views/customize_views/_TerminologyDGVUtils","DS/IPClassifyUtil/bsd_utils/BSDConfiguration","DS/TerminologyEditor/utils/TerminologySearch","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/commands/TerminologyCommands","DS/TerminologyEditor/utils/TerminologyEditorKeyboardListener","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/CollectionView/commands/CollectionViewCommands","DS/Controls/Button","DS/IPClassifyUtil/IPClassifyModelEvents","DS/IPClassifyUtil/bsd_utils/BSDAttributeMgt","DS/TerminologyEditor/utils/TerminologyEditorEvents","DS/TerminologyEditor/views/TerminologyMode","DS/TerminologyEditor/Terminology_CSO","DS/IPClassifyUtil/DimensionUtils"],function(e,t,o,n,i,r,l,a,s,d,c,u,g,m,p,f,h,y,T,v,_,C,S){"use strict";var E=new m;return o.extend(n,a,s,{name:"TerminologyTreeListView",defaultOptions:{renderTo:null,context:null,modelEvents:null,subscribeTokens:[],columnsManagement:!0,dgv:null,dgvLayout:null,viewMode:"",clickEvent:{},doubleClickEvent:{}},init:function(e){this._parent(e),this.setOptions(e)},initialize:function(){var o=this;return new t(function(n){var a=e.clone(d.getConfig("dgvOptions"));o.options.viewMode=a.viewMode;var s=u.getPlaceholder(),g=o.buildDGVOpts();t.all([s,g]).then(function(t){var s=t[1],d=t[0],g=!1!==o.options.context.options.settings.view_settings.sortPersistence;g||(s.sortModel=[{dataIndex:"defaultSort",sort:"asc"}]);var m=e.extend({identifier:"DataGridView-"+o.name+"-"+widget.id},s);if("undefined"!==a.dgvLayout){var f=e.clone(a.dgvLayout);void 0!==s.defaultCellHeight&&(f.cellHeight=s.defaultCellHeight,delete s.defaultCellHeight),!window.__karma__&&navigator.webdriver&&(s.rowsHeader=!0),void 0!==s.rowsHeader&&(f.rowsHeader=s.rowsHeader,delete s.rowsHeader),s.columns.forEach(function(e){e.minWidth=50}),m.layout=o.options.dgvLayout=new r(f),m.layout.useLastColumnWidthAutoFlag=!0}m.placeholder=d.getContent();var h=null,T=!0;m.columns.forEach(function(e,t){"ContextualMenuColumn"===e.dataIndex&&(h=t,T=e.visibleFlag)}),null!==h&&m.columns.splice(h,1),m.showContextualMenuColumnFlag=!0,m.useAsyncPreExpand=!0,o.options.dataGridPlaceHolder=m.placeholder,o.options.viewMode=s.viewMode?s.viewMode:"comfortable";var v=u.getTreeCont();v&&v.modeChange({viewMode:o.options.viewMode});var C=o.options.dgv=new i(m);C.selectNextCellOnEnterFlag=!1,C.setUseClipboardFlag(!1),C.onEndResizeOrOnReadyModelRequest(function(e){e.RowMaxNumber>=c.getNumberResults()&&e.RowMaxNumber>=C.getModelLength()&&(e.reachBottom=!0,u.getContent().processForInfiniteScroll(e,C)),C.EndResizeOrOnReadyModelRequestDone()}),o.ctxColOpts=C.getColumnOrGroup("ContextualMenuColumn"),o.ctxColOpts&&(o.options.dgv.prepareUpdateView(),o.ctxColOpts.visibleFlag=T,o.ctxColOpts.customisation={exportable:{lock:!0,value:!1},layout:{pinEditable:!0,removable:!0}},o.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0},!0));var S=p.getContentSortmodel();s.sortModel=!g||s.sortModel?s.sortModel:S,s.sortModel&&(o.options.dgv.prepareUpdateView(),o.options.dgv.sortModel=s.sortModel,o.options.dgv.layout.saveColumnSortModelInPreferences(),o.options.dgv.pushUpdateView({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1},!0)),C.onCopy=E.launchKeyAction.bind(E,"ctrl+c"),C.onCut=E.launchKeyAction.bind(E,"ctrl+x"),C.onPaste=E.launchKeyAction.bind(E,"ctrl+v");["esc","del","ctrl+f","alt+return","f2"].forEach(function(e){C._keymapManager.registerKeymap(e,void 0)}),C.addEventListener("sortModelChange",function(){"read"===_.getCurrentModeType()&&u.getContent().loadContentAndSelect()}),C.onInfiniteScroll(function(e){u.getContent().processForInfiniteScroll(e,C)}),o._commandProxy=l.create(),o.eventHandlerOnGridView(C).then(function(){C.getContent().addClassName(o.name),o.options.renderTo&&!0===o.options.isActiveView&&C.inject(o.options.renderTo),n()}),y.getModelEvents().subscribe({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification"},function(t){switch(t.what){case"addRemoveColumns":t.removedColumns&&t.removedColumns.length>0&&o.removeColumn(t.removedColumns),t.addedColumns&&t.addedColumns.length>0&&o.addColumn(e.clone(p.filterDBOnlyAttrs(t.addedColumns)));break;case"reset":o.resetColumn()}})})})},escape:function(){this.options.dgv.commands.escape.bind(this.options.dgv)()},getManager:function(){return this.options.dgv},addColumn:function(e){e.length>0&&(c.addPredicates(e),v.notifyCurrentTerminologyColumnChange())},removeColumn:function(e){c.removePredicates(e)},resetColumn:function(){c.setPredicates(T.getAvailableColumnsOpts()),v.notifyCurrentTerminologyColumnChange()},setModel:function(e){this.options.dgv.getContent().inject(this.options.renderTo),this.options.isActiveView=!0,this.options.dgv.treeDocument=e},unsetModel:function(){this.options.isActiveView&&(this.options.renderTo.removeChild(this.options.dgv.getContent()),this.options.isActiveView=!1,this.options.dgv.treeDocument=null)},isColumnHidden:function(e){return!this.options.dgv.layout.getColumnVisibleState(e)},showColumn:function(e){this.changeVisibilityCB(e,!0)},hideColumn:function(e){this.changeVisibilityCB(e,!1)},changeColumnTitle:function(e,t){this.changeTitleCB(e,t)},getDatagridPlaceHolder:function(){return this.options.dataGridPlaceHolder},getFontDetails:function(){var e=this.options.dgv,t=12,o=10;e&&e.layout&&e.layout.collectionView&&e.layout.collectionView._getCurrentTouchMode()&&(t=14,o=20);var n="Ariel";if(e&&e.layout&&e.layout.collectionView){let o=e.layout.collectionView.elements.leftPoolContainer;if(o){let e=o.getElementsByClassName("wux-tweakers-string-label");if(e&&e.length>0){let o=e[0];t=(t=o.getStyle("font-size"))?parseInt(t.replace("px","")):12,n=o.getStyle("font-family")}}}return{fontSize:t,fontMargin:o,fontSytle:n}},getColumnWidth:function(e){var t=0,o=this.options.dgv;return o&&o.layout&&o.layout.getColumnWidth&&(t=o.layout.getColumnWidth(e)),t},getRowHeight:function(){var e=0,t=this.options.dgv;return t&&t.layout&&t.layout.getRowHeight&&(e=t.layout.getRowHeight()),e},scrollToVisibleNode:function(e){var t=this.options.dgv,o=t.layout.getColumnIndex("tree"),n=t.layout.getCellsFromNodeModel(e)[o];t.scrollToCellAt({cellID:n})},getColumnUnitNls:function(e,t){let o=null;var n=this.options.dgv;if(n&&n.layout&&n.layout.getLeafColumns){let r=n.layout.getLeafColumns();for(var i=0;i<r.length;++i)if(r[i].dataIndex===e){r[i].convertInfos&&(o=r[i].convertInfos.nls),r[i].convertInfos&&r[i].convertInfos.manipulationUnit&&r[i].convertInfos.manipulationUnit!==r[i].convertInfos.unit&&(o=!0===t?null:r[i].convertInfos.manipulationNls);break}}return o},getManipulationUnitColumns:function(){let e=[];var t=this.options.dgv;if(t&&t.layout&&t.layout.getLeafColumns){let n=t.layout.getLeafColumns();for(var o=0;o<n.length;++o)n[o].convertInfos&&n[o].convertInfos.manipulationUnit&&n[o].convertInfos.manipulationUnit!==n[o].convertInfos.unit&&e.push(n[o])}return e},getManipulationUnitVisibleValues:function(t,o){let n=[];var i=this.options.dgv;if(i&&i.model&&i.layout){var r=i.layout.getMinMaxVisibleRowIDs();if(r&&r.hasOwnProperty("minRowID")&&r.hasOwnProperty("maxRowID"))for(var l=r.minRowID;l<=r.maxRowID;++l){let r=i.model[l];if(o&&r.getID()!==o)continue;let a=(r.grid||r.options.grid)[t];if(e.is(a,"array")?n=n.concat(a):a&&n.push(a),o&&r.getID()===o)break}}return n},enrichSearchValue:function(e){let o=this;return new t(function(t){var n=o.options.dgv;e&&n&&n.layout&&n.layout.getLeafColumns||t(e);let i=e;if(-1!==e.indexOf(":")){let o=e.substring(0,e.indexOf(":")),l=o,a=e.substring(e.indexOf(":")+1,e.length),s=n.layout.getLeafColumns(),d=null;for(var r=0;r<s.length;++r)if(s[r].text===o){if(l="["+s[r].dataIndex+"]",s[r].convertInfos&&s[r].convertInfos.manipulationUnit&&s[r].convertInfos.manipulationUnit!==s[r].convertInfos.unit){(d={}).Data=[];let e={};e.Dimension=s[r].convertInfos.dimension,e.UnitFrom=s[r].convertInfos.manipulationUnit,e.UnitTo=s[r].convertInfos.unit,e.Values=a,d.Data.push(e)}break}i=i.replace(o,l),d?S.convertToPreferdUnits(d).then(function(e){e&&0!==e.length||t(i),t(l+":"+e[0].ConvertedValues)}):t(i)}else t(i)})}})});